<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MC Loader</title>
  <style>
    body {
      margin: 0;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
      font-family: "Segoe UI", Arial, sans-serif;
      color: #fff;
    }
    #container {
      text-align: center;
    }
    h1 {
      font-size: 24px;
      margin-bottom: 20px;
    }
    button {
      padding: 14px 24px;
      font-size: 18px;
      font-weight: bold;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      background: #2a9df4;
      color: white;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
      transition: background 0.25s ease;
    }
    button:hover:enabled {
      background: #1b7fc9;
    }
    button:disabled {
      background: #555;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <div id="container">
    <h1>Click to download MC.html forever</h1>
    <button id="downloadBtn">Download</button>
  </div>

<script>
const DB_NAME = "mc_storage";
const DB_STORE = "files";
const DB_KEY = "mc_html";

function openDB() {
  return new Promise((resolve, reject) => {
    const req = indexedDB.open(DB_NAME, 1);
    req.onupgradeneeded = e => {
      e.target.result.createObjectStore(DB_STORE);
    };
    req.onsuccess = e => resolve(e.target.result);
    req.onerror = e => reject(e.target.error);
  });
}

function putData(db, key, value) {
  return new Promise((resolve, reject) => {
    const tx = db.transaction(DB_STORE, "readwrite");
    tx.objectStore(DB_STORE).put(value, key);
    tx.oncomplete = () => resolve();
    tx.onerror = e => reject(e.target.error);
  });
}

function getData(db, key) {
  return new Promise((resolve, reject) => {
    const tx = db.transaction(DB_STORE, "readonly");
    const req = tx.objectStore(DB_STORE).get(key);
    req.onsuccess = () => resolve(req.result);
    req.onerror = e => reject(e.target.error);
  });
}

function loadMC(html) {
  document.open();
  document.write(html);
  document.close();
}

(async () => {
  const db = await openDB();
  const saved = await getData(db, DB_KEY);

  if (saved) {
    loadMC(saved);
  } else {
    const btn = document.getElementById("downloadBtn");
    btn.addEventListener("click", async () => {
      btn.disabled = true;
      btn.textContent = "Downloading...";
      try {
        const res = await fetch("https://raw.githubusercontent.com/beak2825/special-bassoon/refs/heads/main/mc/index_all_in_one.html");
        if (!res.ok) throw new Error("Failed to fetch MC.html");
        const html = await res.text();
        await putData(db, DB_KEY, html);
        btn.textContent = "Loading...";
        loadMC(html);
      } catch (err) {
        btn.textContent = "Error â€” Try Again";
        btn.disabled = false;
        alert("Download failed: " + err.message);
      }
    });
  }
})();
</script>
</body>
</html>
