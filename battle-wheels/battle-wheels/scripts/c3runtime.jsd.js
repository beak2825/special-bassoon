data:application/octet-stream;base64,Ly8gR2VuZXJhdGVkIGJ5IENvbnN0cnVjdCwgdGhlIGdhbWUgYW5kIGFwcCBjcmVhdG9yIDo6IGh0dHBzOi8vd3d3LmNvbnN0cnVjdC5uZXQKInVzZSBzdHJpY3QiOwooZnVuY3Rpb24oYSwgYikgewogICAgIm9iamVjdCIgPT09IHR5cGVvZiBleHBvcnRzICYmICJ1bmRlZmluZWQiICE9PSB0eXBlb2YgbW9kdWxlID8gYihleHBvcnRzKSA6ICJmdW5jdGlvbiIgPT09IHR5cGVvZiBkZWZpbmUgJiYgZGVmaW5lLmFtZCA/IGRlZmluZShbImV4cG9ydHMiXSwgYikgOiAoYSA9ICJ1bmRlZmluZWQiICE9PSB0eXBlb2YgZ2xvYmFsVGhpcyA/IGdsb2JhbFRoaXMgOiBhIHx8IHNlbGYsIGIoYS5nbE1hdHJpeCA9IHt9KSkKfSkodGhpcywgZnVuY3Rpb24oYSkgewogICAgZnVuY3Rpb24gYihmLCBoLCBsKSB7CiAgICAgICAgdmFyIHAgPSBoWzBdLAogICAgICAgICAgICByID0gaFsxXSwKICAgICAgICAgICAgdCA9IGhbMl07CiAgICAgICAgaCA9IGhbM107CiAgICAgICAgdmFyIHYgPSBsWzBdLAogICAgICAgICAgICB4ID0gbFsxXSwKICAgICAgICAgICAgeSA9IGxbMl07CiAgICAgICAgbCA9IGxbM107CiAgICAgICAgZlswXSA9IHAgKiB2ICsgdCAqIHg7CiAgICAgICAgZlsxXSA9IHIgKiB2ICsgaCAqIHg7CiAgICAgICAgZlsyXSA9IHAgKiB5ICsgdCAqIGw7CiAgICAgICAgZlszXSA9IHIgKiB5ICsgaCAqIGw7CiAgICAgICAgcmV0dXJuIGYKICAgIH0KCiAgICBmdW5jdGlvbiBkKGYsIGgsIGwpIHsKICAgICAgICBmWzBdID0gaFswXSAtIGxbMF07CiAgICAgICAgZlsxXSA9IGhbMV0gLSBsWzFdOwogICAgICAgIGZbMl0gPSBoWzJdIC0gbFsyXTsKICAgICAgICBmWzNdID0gaFszXSAtIGxbM107CiAgICAgICAgcmV0dXJuIGYKICAgIH0KCiAgICBmdW5jdGlvbiBjKGYsIGgsIGwpIHsKICAgICAgICB2YXIgcCA9IGhbMF0sCiAgICAgICAgICAgIHIgPSBoWzFdLAogICAgICAgICAgICB0ID0KICAgICAgICAgICAgaFsyXSwKICAgICAgICAgICAgdiA9IGhbM10sCiAgICAgICAgICAgIHggPSBoWzRdOwogICAgICAgIGggPSBoWzVdOwogICAgICAgIHZhciB5ID0gbFswXSwKICAgICAgICAgICAgQSA9IGxbMV0sCiAgICAgICAgICAgIEIgPSBsWzJdLAogICAgICAgICAgICBHID0gbFszXSwKICAgICAgICAgICAgSSA9IGxbNF07CiAgICAgICAgbCA9IGxbNV07CiAgICAgICAgZlswXSA9IHAgKiB5ICsgdCAqIEE7CiAgICAgICAgZlsxXSA9IHIgKiB5ICsgdiAqIEE7CiAgICAgICAgZlsyXSA9IHAgKiBCICsgdCAqIEc7CiAgICAgICAgZlszXSA9IHIgKiBCICsgdiAqIEc7CiAgICAgICAgZls0XSA9IHAgKiBJICsgdCAqIGwgKyB4OwogICAgICAgIGZbNV0gPSByICogSSArIHYgKiBsICsgaDsKICAgICAgICByZXR1cm4gZgogICAgfQoKICAgIGZ1bmN0aW9uIGUoZiwgaCwgbCkgewogICAgICAgIGZbMF0gPSBoWzBdIC0gbFswXTsKICAgICAgICBmWzFdID0gaFsxXSAtIGxbMV07CiAgICAgICAgZlsyXSA9IGhbMl0gLSBsWzJdOwogICAgICAgIGZbM10gPSBoWzNdIC0gbFszXTsKICAgICAgICBmWzRdID0gaFs0XSAtIGxbNF07CiAgICAgICAgZls1XSA9IGhbNV0gLSBsWzVdOwogICAgICAgIHJldHVybiBmCiAgICB9CgogICAgZnVuY3Rpb24gZygpIHsKICAgICAgICB2YXIgZiA9IG5ldyBVKDkpOwogICAgICAgIFUgIT0gRmxvYXQzMkFycmF5ICYmIChmWzFdID0gMCwgZlsyXSA9IDAsIGZbM10gPSAwLCBmWzVdID0gMCwgZls2XSA9IDAsIGZbN10gPSAwKTsKICAgICAgICBmWzBdID0gMTsKICAgICAgICBmWzRdID0gMTsKICAgICAgICBmWzhdID0gMTsKICAgICAgICByZXR1cm4gZgogICAgfQoKICAgIGZ1bmN0aW9uIGsoZiwgaCwgbCkgewogICAgICAgIHZhciBwID0gaFswXSwKICAgICAgICAgICAgciA9IGhbMV0sCiAgICAgICAgICAgIHQgPSBoWzJdLAogICAgICAgICAgICB2ID0gaFszXSwKICAgICAgICAgICAgeCA9IGhbNF0sCiAgICAgICAgICAgIHkgPSBoWzVdLAogICAgICAgICAgICBBID0gaFs2XSwKICAgICAgICAgICAgQiA9IGhbN107CiAgICAgICAgaCA9IGhbOF07CiAgICAgICAgdmFyIEcgPSBsWzBdLAogICAgICAgICAgICBJID0gbFsxXSwKICAgICAgICAgICAgSCA9IGxbMl0sCiAgICAgICAgICAgIE0gPSBsWzNdLAogICAgICAgICAgICBOID0gbFs0XSwKICAgICAgICAgICAgTCA9IGxbNV0sCiAgICAgICAgICAgIFEgPSBsWzZdLAogICAgICAgICAgICBQID0gbFs3XTsKICAgICAgICBsID0gbFs4XTsKICAgICAgICBmWzBdID0gRyAqIHAgKyBJICogdiArIEggKiBBOwogICAgICAgIGZbMV0gPSBHICogciArIEkgKiB4ICsgSCAqIEI7CiAgICAgICAgZlsyXSA9IEcgKiB0ICsgSSAqIHkgKyBIICogaDsKICAgICAgICBmWzNdID0gTSAqIHAgKyBOICogdiArIEwgKiBBOwogICAgICAgIGZbNF0gPSBNICogciArIE4gKiB4ICsgTCAqIEI7CiAgICAgICAgZls1XSA9IE0gKiB0ICsgTiAqIHkgKyBMICogaDsKICAgICAgICBmWzZdID0gUSAqIHAgKyBQICogdiArIGwgKiBBOwogICAgICAgIGZbN10gPSBRICogciArIFAgKiB4ICsgbCAqIEI7CiAgICAgICAgZls4XSA9IFEgKiB0ICsgUCAqIHkgKyBsICogaDsKICAgICAgICByZXR1cm4gZgogICAgfQoKICAgIGZ1bmN0aW9uIG0oZiwgaCwgbCkgewogICAgICAgIGZbMF0gPSBoWzBdIC0gbFswXTsKICAgICAgICBmWzFdID0gaFsxXSAtIGxbMV07CiAgICAgICAgZlsyXSA9IGhbMl0gLSBsWzJdOwogICAgICAgIGZbM10gPSBoWzNdIC0gbFszXTsKICAgICAgICBmWzRdID0gaFs0XSAtIGxbNF07CiAgICAgICAgZls1XSA9IGhbNV0gLSBsWzVdOwogICAgICAgIGZbNl0gPSBoWzZdIC0gbFs2XTsKICAgICAgICBmWzddID0gaFs3XSAtIGxbN107CiAgICAgICAgZls4XSA9IGhbOF0gLSBsWzhdOwogICAgICAgIHJldHVybiBmCiAgICB9CgogICAgZnVuY3Rpb24gbihmKSB7CiAgICAgICAgZlswXSA9IDE7CiAgICAgICAgZlsxXSA9IDA7CiAgICAgICAgZlsyXSA9IDA7CiAgICAgICAgZlszXSA9IDA7CiAgICAgICAgZls0XSA9IDA7CiAgICAgICAgZls1XSA9IDE7CiAgICAgICAgZls2XSA9IDA7CiAgICAgICAgZls3XSA9IDA7CiAgICAgICAgZls4XSA9IDA7CiAgICAgICAgZls5XSA9IDA7CiAgICAgICAgZlsxMF0gPSAxOwogICAgICAgIGZbMTFdID0gMDsKICAgICAgICBmWzEyXSA9IDA7CiAgICAgICAgZlsxM10gPSAwOwogICAgICAgIGZbMTRdID0gMDsKICAgICAgICBmWzE1XSA9CiAgICAgICAgICAgIDE7CiAgICAgICAgcmV0dXJuIGYKICAgIH0KCiAgICBmdW5jdGlvbiBxKGYsIGgsIGwpIHsKICAgICAgICB2YXIgcCA9IGhbMF0sCiAgICAgICAgICAgIHIgPSBoWzFdLAogICAgICAgICAgICB0ID0gaFsyXSwKICAgICAgICAgICAgdiA9IGhbM10sCiAgICAgICAgICAgIHggPSBoWzRdLAogICAgICAgICAgICB5ID0gaFs1XSwKICAgICAgICAgICAgQSA9IGhbNl0sCiAgICAgICAgICAgIEIgPSBoWzddLAogICAgICAgICAgICBHID0gaFs4XSwKICAgICAgICAgICAgSSA9IGhbOV0sCiAgICAgICAgICAgIEggPSBoWzEwXSwKICAgICAgICAgICAgTSA9IGhbMTFdLAogICAgICAgICAgICBOID0gaFsxMl0sCiAgICAgICAgICAgIEwgPSBoWzEzXSwKICAgICAgICAgICAgUSA9IGhbMTRdOwogICAgICAgIGggPSBoWzE1XTsKICAgICAgICB2YXIgUCA9IGxbMF0sCiAgICAgICAgICAgIFMgPSBsWzFdLAogICAgICAgICAgICBUID0gbFsyXSwKICAgICAgICAgICAgUiA9IGxbM107CiAgICAgICAgZlswXSA9IFAgKiBwICsgUyAqIHggKyBUICogRyArIFIgKiBOOwogICAgICAgIGZbMV0gPSBQICogciArIFMgKiB5ICsgVCAqIEkgKyBSICogTDsKICAgICAgICBmWzJdID0gUCAqIHQgKyBTICogQSArIFQgKiBIICsgUiAqIFE7CiAgICAgICAgZlszXSA9IFAgKiB2ICsgUyAqIEIgKyBUICogTSArIFIgKiBoOwogICAgICAgIFAgPSBsWzRdOwogICAgICAgIFMgPSBsWzVdOwogICAgICAgIFQgPSBsWzZdOwogICAgICAgIFIgPSBsWzddOwogICAgICAgIGZbNF0gPSBQICogcCArIFMgKiB4ICsgVCAqIEcgKyBSICogTjsKICAgICAgICBmWzVdID0gUCAqIHIgKyBTICogeSArIFQgKiBJICsgUiAqIEw7CiAgICAgICAgZls2XSA9IFAgKiB0ICsgUyAqIEEgKyBUICogSCArIFIgKiBROwogICAgICAgIGZbN10gPSBQICogdiArIFMgKiBCICsgVCAqIE0gKyBSICogaDsKICAgICAgICBQID0gbFs4XTsKICAgICAgICBTID0gbFs5XTsKICAgICAgICBUID0gbFsxMF07CiAgICAgICAgUiA9IGxbMTFdOwogICAgICAgIGZbOF0gPSBQICogcCArIFMgKiB4ICsgVCAqIEcgKyBSICogTjsKICAgICAgICBmWzldID0gUCAqIHIgKyBTICogeSArIFQgKiBJICsgUiAqIEw7CiAgICAgICAgZlsxMF0gPSBQICogdCArIFMgKiBBICsgVCAqIEggKyBSICogUTsKICAgICAgICBmWzExXSA9IFAgKiB2ICsgUyAqIEIgKyBUICogTSArIFIgKiBoOwogICAgICAgIFAgPSBsWzEyXTsKICAgICAgICBTID0gbFsxM107CiAgICAgICAgVCA9IGxbMTRdOwogICAgICAgIFIgPSBsWzE1XTsKICAgICAgICBmWzEyXSA9IFAgKiBwICsgUyAqIHggKyBUICogRyArIFIgKiBOOwogICAgICAgIGZbMTNdID0gUCAqIHIgKyBTICogeSArIFQgKiBJICsgUiAqIEw7CiAgICAgICAgZlsxNF0gPSBQICogdCArIFMgKiBBICsgVCAqIEggKyBSICogUTsKICAgICAgICBmWzE1XSA9IFAgKiB2ICsgUyAqIEIgKyBUICogTSArIFIgKiBoOwogICAgICAgIHJldHVybiBmCiAgICB9CgogICAgZnVuY3Rpb24gdShmLCBoLCBsKSB7CiAgICAgICAgdmFyIHAgPSBoWzBdLAogICAgICAgICAgICByID0gaFsxXSwKICAgICAgICAgICAgdCA9IGhbMl0sCiAgICAgICAgICAgIHYgPSBoWzNdLAogICAgICAgICAgICB4ID0gcCArIHAsCiAgICAgICAgICAgIHkgPSByICsgciwKICAgICAgICAgICAgQSA9IHQgKyB0OwogICAgICAgIGggPSBwICogeDsKICAgICAgICB2YXIgQiA9IHAgKiB5OwogICAgICAgIHAgKj0gQTsKICAgICAgICB2YXIgRyA9IHIgKiB5OwogICAgICAgIHIgKj0gQTsKICAgICAgICB0ICo9IEE7CiAgICAgICAgeCAqPSB2OwogICAgICAgIHkgKj0gdjsKICAgICAgICB2ICo9IEE7CiAgICAgICAgZlswXSA9IDEgLSAoRyArIHQpOwogICAgICAgIGZbMV0gPSBCICsgdjsKICAgICAgICBmWzJdID0gcCAtIHk7CiAgICAgICAgZlszXSA9IDA7CiAgICAgICAgZls0XSA9IEIgLSB2OwogICAgICAgIGZbNV0gPSAxIC0gKGggKyB0KTsKICAgICAgICBmWzZdID0gciArIHg7CiAgICAgICAgZls3XSA9IDA7CiAgICAgICAgZls4XSA9IHAgKyB5OwogICAgICAgIGZbOV0gPSByIC0geDsKICAgICAgICBmWzEwXSA9IDEgLSAoaCArIEcpOwogICAgICAgIGZbMTFdID0gMDsKICAgICAgICBmWzEyXSA9IGxbMF07CiAgICAgICAgZlsxM10gPSBsWzFdOwogICAgICAgIGZbMTRdID0gbFsyXTsKICAgICAgICBmWzE1XSA9IDE7CiAgICAgICAgcmV0dXJuIGYKICAgIH0KCiAgICBmdW5jdGlvbiB3KGYsIGgpIHsKICAgICAgICBmWzBdID0gaFsxMl07CiAgICAgICAgZlsxXSA9IGhbMTNdOwogICAgICAgIGZbMl0gPSBoWzE0XTsKICAgICAgICByZXR1cm4gZgogICAgfQoKICAgIGZ1bmN0aW9uIHooZiwgaCkgewogICAgICAgIHZhciBsID0gaFs0XSwKICAgICAgICAgICAgcCA9IGhbNV0sCiAgICAgICAgICAgIHIgPSBoWzZdLAogICAgICAgICAgICB0ID0gaFs4XSwKICAgICAgICAgICAgdiA9IGhbOV0sCiAgICAgICAgICAgIHggPSBoWzEwXTsKICAgICAgICBmWzBdID0gTWF0aC5oeXBvdChoWzBdLCBoWzFdLCBoWzJdKTsKICAgICAgICBmWzFdID0gTWF0aC5oeXBvdChsLCBwLCByKTsKICAgICAgICBmWzJdID0gTWF0aC5oeXBvdCh0LCB2LCB4KTsKICAgICAgICByZXR1cm4gZgogICAgfQoKICAgIGZ1bmN0aW9uIEMoZiwgaCkgewogICAgICAgIHZhciBsID0gbmV3IFUoMyk7CiAgICAgICAgeihsLCBoKTsKICAgICAgICB2YXIgcCA9IDEgLyBsWzBdLAogICAgICAgICAgICByID0gMSAvIGxbMV0sCiAgICAgICAgICAgIHQgPSAxIC8gbFsyXSwKICAgICAgICAgICAgdiA9IGhbMF0gKiBwOwogICAgICAgIGwgPSBoWzFdICogcjsKICAgICAgICB2YXIgeCA9IGhbMl0gKiB0LAogICAgICAgICAgICB5ID0gaFs0XSAqIHAsCiAgICAgICAgICAgIEEgPSBoWzVdICogciwKICAgICAgICAgICAgQiA9IGhbNl0gKiB0OwogICAgICAgIHAgKj0gaFs4XTsKICAgICAgICByICo9IGhbOV07CiAgICAgICAgaCA9IGhbMTBdICogdDsKICAgICAgICB0ID0gdiArIEEgKyBoOwogICAgICAgIDAgPCB0ID8gKHYgPSAyICogTWF0aC5zcXJ0KHQgKyAxKSwgZlszXSA9IC4yNSAqIHYsIGZbMF0gPSAoQiAtIHIpIC8gdiwgZlsxXSA9IChwIC0geCkgLyB2LCBmWzJdID0gKGwgLSB5KSAvIHYpIDogdiA+IEEgJiYgdiA+IGggPyAodiA9IDIgKiBNYXRoLnNxcnQoMSArIHYgLSBBIC0gaCksIGZbM10gPSAoQiAtIHIpIC8gdiwgZlswXSA9IC4yNSAqIHYsIGZbMV0gPSAobCArIHkpIC8gdiwgZlsyXSA9IChwICsgeCkgLyB2KSA6IEEgPiBoID8gKHYgPSAyICogTWF0aC5zcXJ0KDEgKyBBIC0gdiAtIGgpLCBmWzNdID0gKHAgLSB4KSAvIHYsIGZbMF0gPSAobCArIHkpIC8gdiwgZlsxXSA9IC4yNSAqIHYsCiAgICAgICAgICAgIGZbMl0gPSAoQiArIHIpIC8gdikgOiAodiA9IDIgKiBNYXRoLnNxcnQoMSArIGggLSB2IC0gQSksIGZbM10gPSAobCAtIHkpIC8gdiwgZlswXSA9IChwICsgeCkgLyB2LCBmWzFdID0gKEIgKyByKSAvIHYsIGZbMl0gPSAuMjUgKiB2KTsKICAgICAgICByZXR1cm4gZgogICAgfQoKICAgIGZ1bmN0aW9uIEQoZiwgaCwgbCwgcCwgcikgewogICAgICAgIGggPSAxIC8gTWF0aC50YW4oaCAvIDIpOwogICAgICAgIGZbMF0gPSBoIC8gbDsKICAgICAgICBmWzFdID0gMDsKICAgICAgICBmWzJdID0gMDsKICAgICAgICBmWzNdID0gMDsKICAgICAgICBmWzRdID0gMDsKICAgICAgICBmWzVdID0gaDsKICAgICAgICBmWzZdID0gMDsKICAgICAgICBmWzddID0gMDsKICAgICAgICBmWzhdID0gMDsKICAgICAgICBmWzldID0gMDsKICAgICAgICBmWzExXSA9IC0xOwogICAgICAgIGZbMTJdID0gMDsKICAgICAgICBmWzEzXSA9IDA7CiAgICAgICAgZlsxNV0gPSAwOwogICAgICAgIG51bGwgIT0gciAmJiBJbmZpbml0eSAhPT0gciA/IChsID0gMSAvIChwIC0gciksIGZbMTBdID0gKHIgKyBwKSAqIGwsIGZbMTRdID0gMiAqIHIgKiBwICogbCkgOiAoZlsxMF0gPSAtMSwgZlsxNF0gPSAtMiAqIHApOwogICAgICAgIHJldHVybiBmCiAgICB9CgogICAgZnVuY3Rpb24gRihmLCBoLCBsLCBwLCByLCB0LCB2KSB7CiAgICAgICAgdmFyIHggPSAxIC8gKGggLSBsKSwKICAgICAgICAgICAgeSA9IDEgLyAocCAtIHIpLAogICAgICAgICAgICBBID0gMSAvICh0IC0gdik7CiAgICAgICAgZlswXSA9IC0yICogeDsKICAgICAgICBmWzFdID0gMDsKICAgICAgICBmWzJdID0gMDsKICAgICAgICBmWzNdID0gMDsKICAgICAgICBmWzRdID0gMDsKICAgICAgICBmWzVdID0gLTIgKiB5OwogICAgICAgIGZbNl0gPSAwOwogICAgICAgIGZbN10gPSAwOwogICAgICAgIGZbOF0gPSAwOwogICAgICAgIGZbOV0gPSAwOwogICAgICAgIGZbMTBdID0gMiAqIEE7CiAgICAgICAgZlsxMV0gPSAwOwogICAgICAgIGZbMTJdID0gKGggKyBsKSAqCiAgICAgICAgICAgIHg7CiAgICAgICAgZlsxM10gPSAociArIHApICogeTsKICAgICAgICBmWzE0XSA9ICh2ICsgdCkgKiBBOwogICAgICAgIGZbMTVdID0gMTsKICAgICAgICByZXR1cm4gZgogICAgfQoKICAgIGZ1bmN0aW9uIEUoZiwgaCwgbCkgewogICAgICAgIGZbMF0gPSBoWzBdIC0gbFswXTsKICAgICAgICBmWzFdID0gaFsxXSAtIGxbMV07CiAgICAgICAgZlsyXSA9IGhbMl0gLSBsWzJdOwogICAgICAgIGZbM10gPSBoWzNdIC0gbFszXTsKICAgICAgICBmWzRdID0gaFs0XSAtIGxbNF07CiAgICAgICAgZls1XSA9IGhbNV0gLSBsWzVdOwogICAgICAgIGZbNl0gPSBoWzZdIC0gbFs2XTsKICAgICAgICBmWzddID0gaFs3XSAtIGxbN107CiAgICAgICAgZls4XSA9IGhbOF0gLSBsWzhdOwogICAgICAgIGZbOV0gPSBoWzldIC0gbFs5XTsKICAgICAgICBmWzEwXSA9IGhbMTBdIC0gbFsxMF07CiAgICAgICAgZlsxMV0gPSBoWzExXSAtIGxbMTFdOwogICAgICAgIGZbMTJdID0gaFsxMl0gLSBsWzEyXTsKICAgICAgICBmWzEzXSA9IGhbMTNdIC0gbFsxM107CiAgICAgICAgZlsxNF0gPSBoWzE0XSAtIGxbMTRdOwogICAgICAgIGZbMTVdID0gaFsxNV0gLSBsWzE1XTsKICAgICAgICByZXR1cm4gZgogICAgfQoKICAgIGZ1bmN0aW9uIEooKSB7CiAgICAgICAgdmFyIGYgPSBuZXcgVSgzKTsKICAgICAgICBVICE9IEZsb2F0MzJBcnJheSAmJiAoZlswXSA9IDAsIGZbMV0gPSAwLCBmWzJdID0gMCk7CiAgICAgICAgcmV0dXJuIGYKICAgIH0KCiAgICBmdW5jdGlvbiBLKGYpIHsKICAgICAgICByZXR1cm4gTWF0aC5oeXBvdChmWzBdLCBmWzFdLCBmWzJdKQogICAgfQoKICAgIGZ1bmN0aW9uIE8oZiwgaCwgbCkgewogICAgICAgIHZhciBwID0gbmV3IFUoMyk7CiAgICAgICAgcFswXSA9IGY7CiAgICAgICAgcFsxXSA9CiAgICAgICAgICAgIGg7CiAgICAgICAgcFsyXSA9IGw7CiAgICAgICAgcmV0dXJuIHAKICAgIH0KCiAgICBmdW5jdGlvbiBWKGYsIGgsIGwpIHsKICAgICAgICBmWzBdID0gaFswXSAtIGxbMF07CiAgICAgICAgZlsxXSA9IGhbMV0gLSBsWzFdOwogICAgICAgIGZbMl0gPSBoWzJdIC0gbFsyXTsKICAgICAgICByZXR1cm4gZgogICAgfQoKICAgIGZ1bmN0aW9uIFcoZiwgaCwgbCkgewogICAgICAgIGZbMF0gPSBoWzBdICogbFswXTsKICAgICAgICBmWzFdID0gaFsxXSAqIGxbMV07CiAgICAgICAgZlsyXSA9IGhbMl0gKiBsWzJdOwogICAgICAgIHJldHVybiBmCiAgICB9CgogICAgZnVuY3Rpb24gY2EoZiwgaCwgbCkgewogICAgICAgIGZbMF0gPSBoWzBdIC8gbFswXTsKICAgICAgICBmWzFdID0gaFsxXSAvIGxbMV07CiAgICAgICAgZlsyXSA9IGhbMl0gLyBsWzJdOwogICAgICAgIHJldHVybiBmCiAgICB9CgogICAgZnVuY3Rpb24gbGEoZiwgaCkgewogICAgICAgIHJldHVybiBNYXRoLmh5cG90KGhbMF0gLSBmWzBdLCBoWzFdIC0gZlsxXSwgaFsyXSAtIGZbMl0pCiAgICB9CgogICAgZnVuY3Rpb24gbWEoZiwgaCkgewogICAgICAgIHZhciBsID0gaFswXSAtIGZbMF0sCiAgICAgICAgICAgIHAgPSBoWzFdIC0gZlsxXTsKICAgICAgICBmID0gaFsyXSAtIGZbMl07CiAgICAgICAgcmV0dXJuIGwgKiBsICsgcCAqIHAgKyBmICogZgogICAgfQoKICAgIGZ1bmN0aW9uIHphKGYpIHsKICAgICAgICB2YXIgaCA9IGZbMF0sCiAgICAgICAgICAgIGwgPSBmWzFdOwogICAgICAgIGYgPSBmWzJdOwogICAgICAgIHJldHVybiBoICogaCArIGwgKiBsICsgZiAqIGYKICAgIH0KCiAgICBmdW5jdGlvbiBBYShmLCBoKSB7CiAgICAgICAgdmFyIGwgPSBoWzBdLAogICAgICAgICAgICBwID0gaFsxXSwKICAgICAgICAgICAgciA9IGhbMl07CiAgICAgICAgbCA9IGwgKiBsICsgcCAqIHAgKyByICogcjsKICAgICAgICAwIDwgbCAmJiAobCA9IDEgLwogICAgICAgICAgICBNYXRoLnNxcnQobCkpOwogICAgICAgIGZbMF0gPSBoWzBdICogbDsKICAgICAgICBmWzFdID0gaFsxXSAqIGw7CiAgICAgICAgZlsyXSA9IGhbMl0gKiBsOwogICAgICAgIHJldHVybiBmCiAgICB9CgogICAgZnVuY3Rpb24gb2EoZiwgaCkgewogICAgICAgIHJldHVybiBmWzBdICogaFswXSArIGZbMV0gKiBoWzFdICsgZlsyXSAqIGhbMl0KICAgIH0KCiAgICBmdW5jdGlvbiBwYShmLCBoLCBsKSB7CiAgICAgICAgdmFyIHAgPSBoWzBdLAogICAgICAgICAgICByID0gaFsxXTsKICAgICAgICBoID0gaFsyXTsKICAgICAgICB2YXIgdCA9IGxbMF0sCiAgICAgICAgICAgIHYgPSBsWzFdOwogICAgICAgIGwgPSBsWzJdOwogICAgICAgIGZbMF0gPSByICogbCAtIGggKiB2OwogICAgICAgIGZbMV0gPSBoICogdCAtIHAgKiBsOwogICAgICAgIGZbMl0gPSBwICogdiAtIHIgKiB0OwogICAgICAgIHJldHVybiBmCiAgICB9CgogICAgZnVuY3Rpb24gQmEoKSB7CiAgICAgICAgdmFyIGYgPSBuZXcgVSg0KTsKICAgICAgICBVICE9IEZsb2F0MzJBcnJheSAmJiAoZlswXSA9IDAsIGZbMV0gPSAwLCBmWzJdID0gMCwgZlszXSA9IDApOwogICAgICAgIHJldHVybiBmCiAgICB9CgogICAgZnVuY3Rpb24gQ2EoZikgewogICAgICAgIHZhciBoID0gbmV3IFUoNCk7CiAgICAgICAgaFswXSA9IGZbMF07CiAgICAgICAgaFsxXSA9IGZbMV07CiAgICAgICAgaFsyXSA9IGZbMl07CiAgICAgICAgaFszXSA9IGZbM107CiAgICAgICAgcmV0dXJuIGgKICAgIH0KCiAgICBmdW5jdGlvbiBEYShmLCBoLCBsLCBwKSB7CiAgICAgICAgdmFyIHIgPSBuZXcgVSg0KTsKICAgICAgICByWzBdID0gZjsKICAgICAgICByWzFdID0gaDsKICAgICAgICByWzJdID0gbDsKICAgICAgICByWzNdID0gcDsKICAgICAgICByZXR1cm4gcgogICAgfQoKICAgIGZ1bmN0aW9uIHFhKGYsIGgpIHsKICAgICAgICBmWzBdID0gaFswXTsKICAgICAgICBmWzFdID0gaFsxXTsKICAgICAgICBmWzJdID0gaFsyXTsKICAgICAgICBmWzNdID0gaFszXTsKICAgICAgICByZXR1cm4gZgogICAgfQoKICAgIGZ1bmN0aW9uIEVhKGYsIGgsIGwsIHAsIHIpIHsKICAgICAgICBmWzBdID0gaDsKICAgICAgICBmWzFdID0gbDsKICAgICAgICBmWzJdID0gcDsKICAgICAgICBmWzNdID0gcjsKICAgICAgICByZXR1cm4gZgogICAgfQoKICAgIGZ1bmN0aW9uIEZhKGYsIGgsIGwpIHsKICAgICAgICBmWzBdID0gaFswXSArIGxbMF07CiAgICAgICAgZlsxXSA9IGhbMV0gKyBsWzFdOwogICAgICAgIGZbMl0gPSBoWzJdICsgbFsyXTsKICAgICAgICBmWzNdID0gaFszXSArIGxbM107CiAgICAgICAgcmV0dXJuIGYKICAgIH0KCiAgICBmdW5jdGlvbiBHYShmLCBoLCBsKSB7CiAgICAgICAgZlswXSA9IGhbMF0gLSBsWzBdOwogICAgICAgIGZbMV0gPSBoWzFdIC0gbFsxXTsKICAgICAgICBmWzJdID0gaFsyXSAtIGxbMl07CiAgICAgICAgZlszXSA9IGhbM10gLSBsWzNdOwogICAgICAgIHJldHVybiBmCiAgICB9CgogICAgZnVuY3Rpb24gSGEoZiwgaCwgbCkgewogICAgICAgIGZbMF0gPSBoWzBdICogbFswXTsKICAgICAgICBmWzFdID0gaFsxXSAqIGxbMV07CiAgICAgICAgZlsyXSA9IGhbMl0gKiBsWzJdOwogICAgICAgIGZbM10gPSBoWzNdICogbFszXTsKICAgICAgICByZXR1cm4gZgogICAgfQoKICAgIGZ1bmN0aW9uIElhKGYsIGgsIGwpIHsKICAgICAgICBmWzBdID0gaFswXSAvIGxbMF07CiAgICAgICAgZlsxXSA9IGhbMV0gLyBsWzFdOwogICAgICAgIGZbMl0gPSBoWzJdIC8gbFsyXTsKICAgICAgICBmWzNdID0gaFszXSAvIGxbM107CiAgICAgICAgcmV0dXJuIGYKICAgIH0KCiAgICBmdW5jdGlvbiB1YShmLCBoLCBsKSB7CiAgICAgICAgZlswXSA9IGhbMF0gKiBsOwogICAgICAgIGZbMV0gPSBoWzFdICogbDsKICAgICAgICBmWzJdID0gaFsyXSAqIGw7CiAgICAgICAgZlszXSA9CiAgICAgICAgICAgIGhbM10gKiBsOwogICAgICAgIHJldHVybiBmCiAgICB9CgogICAgZnVuY3Rpb24gSmEoZiwgaCkgewogICAgICAgIHJldHVybiBNYXRoLmh5cG90KGhbMF0gLSBmWzBdLCBoWzFdIC0gZlsxXSwgaFsyXSAtIGZbMl0sIGhbM10gLSBmWzNdKQogICAgfQoKICAgIGZ1bmN0aW9uIEthKGYsIGgpIHsKICAgICAgICB2YXIgbCA9IGhbMF0gLSBmWzBdLAogICAgICAgICAgICBwID0gaFsxXSAtIGZbMV0sCiAgICAgICAgICAgIHIgPSBoWzJdIC0gZlsyXTsKICAgICAgICBmID0gaFszXSAtIGZbM107CiAgICAgICAgcmV0dXJuIGwgKiBsICsgcCAqIHAgKyByICogciArIGYgKiBmCiAgICB9CgogICAgZnVuY3Rpb24gamEoZikgewogICAgICAgIHJldHVybiBNYXRoLmh5cG90KGZbMF0sIGZbMV0sIGZbMl0sIGZbM10pCiAgICB9CgogICAgZnVuY3Rpb24gaWEoZikgewogICAgICAgIHZhciBoID0gZlswXSwKICAgICAgICAgICAgbCA9IGZbMV0sCiAgICAgICAgICAgIHAgPSBmWzJdOwogICAgICAgIGYgPSBmWzNdOwogICAgICAgIHJldHVybiBoICogaCArIGwgKiBsICsgcCAqIHAgKyBmICogZgogICAgfQoKICAgIGZ1bmN0aW9uIHJhKGYsIGgpIHsKICAgICAgICB2YXIgbCA9IGhbMF0sCiAgICAgICAgICAgIHAgPSBoWzFdLAogICAgICAgICAgICByID0gaFsyXTsKICAgICAgICBoID0gaFszXTsKICAgICAgICB2YXIgdCA9IGwgKiBsICsgcCAqIHAgKyByICogciArIGggKiBoOwogICAgICAgIDAgPCB0ICYmICh0ID0gMSAvIE1hdGguc3FydCh0KSk7CiAgICAgICAgZlswXSA9IGwgKiB0OwogICAgICAgIGZbMV0gPSBwICogdDsKICAgICAgICBmWzJdID0gciAqIHQ7CiAgICAgICAgZlszXSA9IGggKiB0OwogICAgICAgIHJldHVybiBmCiAgICB9CgogICAgZnVuY3Rpb24ga2EoZiwgaCkgewogICAgICAgIHJldHVybiBmWzBdICogaFswXSArIGZbMV0gKiBoWzFdICsgZlsyXSAqIGhbMl0gKwogICAgICAgICAgICBmWzNdICogaFszXQogICAgfQoKICAgIGZ1bmN0aW9uIExhKGYsIGgsIGwsIHApIHsKICAgICAgICB2YXIgciA9IGhbMF0sCiAgICAgICAgICAgIHQgPSBoWzFdLAogICAgICAgICAgICB2ID0gaFsyXTsKICAgICAgICBoID0gaFszXTsKICAgICAgICBmWzBdID0gciArIHAgKiAobFswXSAtIHIpOwogICAgICAgIGZbMV0gPSB0ICsgcCAqIChsWzFdIC0gdCk7CiAgICAgICAgZlsyXSA9IHYgKyBwICogKGxbMl0gLSB2KTsKICAgICAgICBmWzNdID0gaCArIHAgKiAobFszXSAtIGgpOwogICAgICAgIHJldHVybiBmCiAgICB9CgogICAgZnVuY3Rpb24gTWEoZiwgaCkgewogICAgICAgIHJldHVybiBmWzBdID09PSBoWzBdICYmIGZbMV0gPT09IGhbMV0gJiYgZlsyXSA9PT0gaFsyXSAmJiBmWzNdID09PSBoWzNdCiAgICB9CgogICAgZnVuY3Rpb24gc2EoKSB7CiAgICAgICAgdmFyIGYgPSBuZXcgVSg0KTsKICAgICAgICBVICE9IEZsb2F0MzJBcnJheSAmJiAoZlswXSA9IDAsIGZbMV0gPSAwLCBmWzJdID0gMCk7CiAgICAgICAgZlszXSA9IDE7CiAgICAgICAgcmV0dXJuIGYKICAgIH0KCiAgICBmdW5jdGlvbiBOYShmLCBoLCBsKSB7CiAgICAgICAgbCAqPSAuNTsKICAgICAgICB2YXIgcCA9IE1hdGguc2luKGwpOwogICAgICAgIGZbMF0gPSBwICogaFswXTsKICAgICAgICBmWzFdID0gcCAqIGhbMV07CiAgICAgICAgZlsyXSA9IHAgKiBoWzJdOwogICAgICAgIGZbM10gPSBNYXRoLmNvcyhsKTsKICAgICAgICByZXR1cm4gZgogICAgfQoKICAgIGZ1bmN0aW9uIE9hKGYsIGgsIGwpIHsKICAgICAgICB2YXIgcCA9IGhbMF0sCiAgICAgICAgICAgIHIgPSBoWzFdLAogICAgICAgICAgICB0ID0gaFsyXTsKICAgICAgICBoID0gaFszXTsKICAgICAgICB2YXIgdiA9IGxbMF0sCiAgICAgICAgICAgIHggPSBsWzFdLAogICAgICAgICAgICB5ID0gbFsyXTsKICAgICAgICBsID0gbFszXTsKICAgICAgICBmWzBdID0gcCAqIGwgKwogICAgICAgICAgICBoICogdiArIHIgKiB5IC0gdCAqIHg7CiAgICAgICAgZlsxXSA9IHIgKiBsICsgaCAqIHggKyB0ICogdiAtIHAgKiB5OwogICAgICAgIGZbMl0gPSB0ICogbCArIGggKiB5ICsgcCAqIHggLSByICogdjsKICAgICAgICBmWzNdID0gaCAqIGwgLSBwICogdiAtIHIgKiB4IC0gdCAqIHk7CiAgICAgICAgcmV0dXJuIGYKICAgIH0KCiAgICBmdW5jdGlvbiBQYShmLCBoLCBsKSB7CiAgICAgICAgbCAqPSAuNTsKICAgICAgICB2YXIgcCA9IGhbMF0sCiAgICAgICAgICAgIHIgPSBoWzFdLAogICAgICAgICAgICB0ID0gaFsyXTsKICAgICAgICBoID0gaFszXTsKICAgICAgICB2YXIgdiA9IE1hdGguc2luKGwpOwogICAgICAgIGwgPSBNYXRoLmNvcyhsKTsKICAgICAgICBmWzBdID0gcCAqIGwgKyBoICogdjsKICAgICAgICBmWzFdID0gciAqIGwgKyB0ICogdjsKICAgICAgICBmWzJdID0gdCAqIGwgLSByICogdjsKICAgICAgICBmWzNdID0gaCAqIGwgLSBwICogdjsKICAgICAgICByZXR1cm4gZgogICAgfQoKICAgIGZ1bmN0aW9uIFFhKGYsIGgsIGwpIHsKICAgICAgICBsICo9IC41OwogICAgICAgIHZhciBwID0gaFswXSwKICAgICAgICAgICAgciA9IGhbMV0sCiAgICAgICAgICAgIHQgPSBoWzJdOwogICAgICAgIGggPSBoWzNdOwogICAgICAgIHZhciB2ID0gTWF0aC5zaW4obCk7CiAgICAgICAgbCA9IE1hdGguY29zKGwpOwogICAgICAgIGZbMF0gPSBwICogbCAtIHQgKiB2OwogICAgICAgIGZbMV0gPSByICogbCArIGggKiB2OwogICAgICAgIGZbMl0gPSB0ICogbCArIHAgKiB2OwogICAgICAgIGZbM10gPSBoICogbCAtIHIgKiB2OwogICAgICAgIHJldHVybiBmCiAgICB9CgogICAgZnVuY3Rpb24gUmEoZiwgaCwgbCkgewogICAgICAgIGwgKj0gLjU7CiAgICAgICAgdmFyIHAgPSBoWzBdLAogICAgICAgICAgICByID0gaFsxXSwKICAgICAgICAgICAgdCA9IGhbMl07CiAgICAgICAgaCA9IGhbM107CiAgICAgICAgdmFyIHYgPSBNYXRoLnNpbihsKTsKICAgICAgICBsID0gTWF0aC5jb3MobCk7CiAgICAgICAgZlswXSA9IHAgKiBsICsgciAqIHY7CiAgICAgICAgZlsxXSA9IHIgKiBsIC0gcCAqIHY7CiAgICAgICAgZlsyXSA9CiAgICAgICAgICAgIHQgKiBsICsgaCAqIHY7CiAgICAgICAgZlszXSA9IGggKiBsIC0gdCAqIHY7CiAgICAgICAgcmV0dXJuIGYKICAgIH0KCiAgICBmdW5jdGlvbiBTYShmLCBoKSB7CiAgICAgICAgdmFyIGwgPSBoWzBdLAogICAgICAgICAgICBwID0gaFsxXSwKICAgICAgICAgICAgciA9IGhbMl0sCiAgICAgICAgICAgIHQgPSBNYXRoLnNxcnQobCAqIGwgKyBwICogcCArIHIgKiByKTsKICAgICAgICBoID0gTWF0aC5leHAoaFszXSk7CiAgICAgICAgdmFyIHYgPSAwIDwgdCA/IGggKiBNYXRoLnNpbih0KSAvIHQgOiAwOwogICAgICAgIGZbMF0gPSBsICogdjsKICAgICAgICBmWzFdID0gcCAqIHY7CiAgICAgICAgZlsyXSA9IHIgKiB2OwogICAgICAgIGZbM10gPSBoICogTWF0aC5jb3ModCk7CiAgICAgICAgcmV0dXJuIGYKICAgIH0KCiAgICBmdW5jdGlvbiBUYShmLCBoKSB7CiAgICAgICAgdmFyIGwgPSBoWzBdLAogICAgICAgICAgICBwID0gaFsxXSwKICAgICAgICAgICAgciA9IGhbMl07CiAgICAgICAgaCA9IGhbM107CiAgICAgICAgdmFyIHQgPSBNYXRoLnNxcnQobCAqIGwgKyBwICogcCArIHIgKiByKTsKICAgICAgICB0ID0gMCA8IHQgPyBNYXRoLmF0YW4yKHQsIGgpIC8gdCA6IDA7CiAgICAgICAgZlswXSA9IGwgKiB0OwogICAgICAgIGZbMV0gPSBwICogdDsKICAgICAgICBmWzJdID0gciAqIHQ7CiAgICAgICAgZlszXSA9IC41ICogTWF0aC5sb2cobCAqIGwgKyBwICogcCArIHIgKiByICsgaCAqIGgpOwogICAgICAgIHJldHVybiBmCiAgICB9CgogICAgZnVuY3Rpb24gdGEoZiwgaCwgbCwgcCkgewogICAgICAgIHZhciByID0gaFswXSwKICAgICAgICAgICAgdCA9IGhbMV0sCiAgICAgICAgICAgIHYgPSBoWzJdOwogICAgICAgIGggPSBoWzNdOwogICAgICAgIHZhciB4ID0gbFswXSwKICAgICAgICAgICAgeSA9IGxbMV0sCiAgICAgICAgICAgIEEgPSBsWzJdOwogICAgICAgIGwgPSBsWzNdOwogICAgICAgIHZhciBCID0gciAqIHggKyB0ICogeSArIHYgKiBBICsgaCAqIGw7CiAgICAgICAgMCA+IEIgJiYgKEIgPSAtQiwgeCA9IC14LCB5ID0gLXksIEEgPSAtQSwgbCA9IC1sKTsKICAgICAgICBpZiAoMUUtNiA8IDEgLSBCKSB7CiAgICAgICAgICAgIHZhciBHID0gTWF0aC5hY29zKEIpOwogICAgICAgICAgICB2YXIgSSA9IE1hdGguc2luKEcpOwogICAgICAgICAgICBCID0gTWF0aC5zaW4oKDEgLSBwKSAqIEcpIC8gSTsKICAgICAgICAgICAgcCA9IE1hdGguc2luKHAgKiBHKSAvIEkKICAgICAgICB9IGVsc2UgQiA9IDEgLSBwOwogICAgICAgIGZbMF0gPSBCICogciArIHAgKiB4OwogICAgICAgIGZbMV0gPSBCICogdCArIHAgKiB5OwogICAgICAgIGZbMl0gPSBCICogdiArIHAgKiBBOwogICAgICAgIGZbM10gPSBCICogaCArIHAgKiBsOwogICAgICAgIHJldHVybiBmCiAgICB9CgogICAgZnVuY3Rpb24gVWEoZiwgaCkgewogICAgICAgIHZhciBsID0gaFswXSArIGhbNF0gKyBoWzhdOwogICAgICAgIGlmICgwIDwgbCkgbCA9IE1hdGguc3FydChsICsgMSksIGZbM10gPSAuNSAqIGwsIGwgPSAuNSAvIGwsIGZbMF0gPSAoaFs1XSAtIGhbN10pICogbCwgZlsxXSA9IChoWzZdIC0gaFsyXSkgKiBsLCBmWzJdID0gKGhbMV0gLSBoWzNdKSAqIGw7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHZhciBwID0gMDsKICAgICAgICAgICAgaFs0XSA+IGhbMF0gJiYgKHAgPSAxKTsKICAgICAgICAgICAgaFs4XSA+IGhbMyAqIHAgKyBwXSAmJiAocCA9IDIpOwogICAgICAgICAgICB2YXIgciA9IChwICsgMSkgJSAzLAogICAgICAgICAgICAgICAgdCA9IChwICsgMikgJSAzOwogICAgICAgICAgICBsID0gTWF0aC5zcXJ0KGhbMyAqIHAgKyBwXSAtIGhbMyAqIHIgKyByXSAtIGhbMyAqIHQgKyB0XSArIDEpOwogICAgICAgICAgICBmW3BdID0gLjUgKiBsOwogICAgICAgICAgICBsID0gLjUgLyBsOwogICAgICAgICAgICBmWzNdID0gKGhbMyAqIHIgKyB0XSAtIGhbMyAqIHQgKyByXSkgKiBsOwogICAgICAgICAgICBmW3JdID0gKGhbMyAqIHIgKyBwXSArIGhbMyAqIHAgKyByXSkgKiBsOwogICAgICAgICAgICBmW3RdID0gKGhbMyAqCiAgICAgICAgICAgICAgICB0ICsgcF0gKyBoWzMgKiBwICsgdF0pICogbAogICAgICAgIH0KICAgICAgICByZXR1cm4gZgogICAgfQoKICAgIGZ1bmN0aW9uIFZhKGYsIGgsIGwpIHsKICAgICAgICB2YXIgcCA9IC41ICogbFswXSwKICAgICAgICAgICAgciA9IC41ICogbFsxXTsKICAgICAgICBsID0gLjUgKiBsWzJdOwogICAgICAgIHZhciB0ID0gaFswXSwKICAgICAgICAgICAgdiA9IGhbMV0sCiAgICAgICAgICAgIHggPSBoWzJdOwogICAgICAgIGggPSBoWzNdOwogICAgICAgIGZbMF0gPSB0OwogICAgICAgIGZbMV0gPSB2OwogICAgICAgIGZbMl0gPSB4OwogICAgICAgIGZbM10gPSBoOwogICAgICAgIGZbNF0gPSBwICogaCArIHIgKiB4IC0gbCAqIHY7CiAgICAgICAgZls1XSA9IHIgKiBoICsgbCAqIHQgLSBwICogeDsKICAgICAgICBmWzZdID0gbCAqIGggKyBwICogdiAtIHIgKiB0OwogICAgICAgIGZbN10gPSAtcCAqIHQgLSByICogdiAtIGwgKiB4OwogICAgICAgIHJldHVybiBmCiAgICB9CgogICAgZnVuY3Rpb24gV2EoZiwgaCkgewogICAgICAgIGZbMF0gPSBoWzBdOwogICAgICAgIGZbMV0gPSBoWzFdOwogICAgICAgIGZbMl0gPSBoWzJdOwogICAgICAgIGZbM10gPSBoWzNdOwogICAgICAgIGZbNF0gPSBoWzRdOwogICAgICAgIGZbNV0gPSBoWzVdOwogICAgICAgIGZbNl0gPSBoWzZdOwogICAgICAgIGZbN10gPSBoWzddOwogICAgICAgIHJldHVybiBmCiAgICB9CgogICAgZnVuY3Rpb24gWGEoZiwgaCwgbCkgewogICAgICAgIHZhciBwID0gaFswXSwKICAgICAgICAgICAgciA9IGhbMV0sCiAgICAgICAgICAgIHQgPSBoWzJdLAogICAgICAgICAgICB2ID0gaFszXSwKICAgICAgICAgICAgeCA9IGxbNF0sCiAgICAgICAgICAgIHkgPSBsWzVdLAogICAgICAgICAgICBBID0gbFs2XSwKICAgICAgICAgICAgQiA9IGxbN10sCiAgICAgICAgICAgIEcgPSBoWzRdLAogICAgICAgICAgICBJID0gaFs1XSwKICAgICAgICAgICAgSCA9IGhbNl07CiAgICAgICAgaCA9IGhbN107CiAgICAgICAgdmFyIE0gPSBsWzBdLAogICAgICAgICAgICBOID0gbFsxXSwKICAgICAgICAgICAgTCA9IGxbMl07CiAgICAgICAgbCA9IGxbM107CiAgICAgICAgZlswXSA9IHAgKiBsICsgdiAqIE0gKyByICogTCAtIHQgKiBOOwogICAgICAgIGZbMV0gPSByICogbCArIHYgKiBOICsgdCAqIE0gLSBwICoKICAgICAgICAgICAgTDsKICAgICAgICBmWzJdID0gdCAqIGwgKyB2ICogTCArIHAgKiBOIC0gciAqIE07CiAgICAgICAgZlszXSA9IHYgKiBsIC0gcCAqIE0gLSByICogTiAtIHQgKiBMOwogICAgICAgIGZbNF0gPSBwICogQiArIHYgKiB4ICsgciAqIEEgLSB0ICogeSArIEcgKiBsICsgaCAqIE0gKyBJICogTCAtIEggKiBOOwogICAgICAgIGZbNV0gPSByICogQiArIHYgKiB5ICsgdCAqIHggLSBwICogQSArIEkgKiBsICsgaCAqIE4gKyBIICogTSAtIEcgKiBMOwogICAgICAgIGZbNl0gPSB0ICogQiArIHYgKiBBICsgcCAqIHkgLSByICogeCArIEggKiBsICsgaCAqIEwgKyBHICogTiAtIEkgKiBNOwogICAgICAgIGZbN10gPSB2ICogQiAtIHAgKiB4IC0gciAqIHkgLSB0ICogQSArIGggKiBsIC0gRyAqIE0gLSBJICogTiAtIEggKiBMOwogICAgICAgIHJldHVybiBmCiAgICB9CgogICAgZnVuY3Rpb24gWWEoKSB7CiAgICAgICAgdmFyIGYgPSBuZXcgVSgyKTsKICAgICAgICBVICE9IEZsb2F0MzJBcnJheSAmJiAoZlswXSA9IDAsIGZbMV0gPSAwKTsKICAgICAgICByZXR1cm4gZgogICAgfQoKICAgIGZ1bmN0aW9uIFphKGYsIGgsIGwpIHsKICAgICAgICBmWzBdID0gaFswXSAtIGxbMF07CiAgICAgICAgZlsxXSA9IGhbMV0gLSBsWzFdOwogICAgICAgIHJldHVybiBmCiAgICB9CgogICAgZnVuY3Rpb24gJGEoZiwgaCwgbCkgewogICAgICAgIGZbMF0gPSBoWzBdICogbFswXTsKICAgICAgICBmWzFdID0gaFsxXSAqIGxbMV07CiAgICAgICAgcmV0dXJuIGYKICAgIH0KCiAgICBmdW5jdGlvbiBhYihmLCBoLCBsKSB7CiAgICAgICAgZlswXSA9IGhbMF0gLyBsWzBdOwogICAgICAgIGZbMV0gPSBoWzFdIC8gbFsxXTsKICAgICAgICByZXR1cm4gZgogICAgfQoKICAgIGZ1bmN0aW9uIGJiKGYsIGgpIHsKICAgICAgICByZXR1cm4gTWF0aC5oeXBvdChoWzBdIC0gZlswXSwgaFsxXSAtIGZbMV0pCiAgICB9CgogICAgZnVuY3Rpb24gY2IoZiwgaCkgewogICAgICAgIHZhciBsID0gaFswXSAtIGZbMF07CiAgICAgICAgZiA9IGhbMV0gLSBmWzFdOwogICAgICAgIHJldHVybiBsICogbCArIGYgKiBmCiAgICB9CgogICAgZnVuY3Rpb24gZGIoZikgewogICAgICAgIHJldHVybiBNYXRoLmh5cG90KGZbMF0sIGZbMV0pCiAgICB9CgogICAgZnVuY3Rpb24gZWIoZikgewogICAgICAgIHZhciBoID0gZlswXTsKICAgICAgICBmID0gZlsxXTsKICAgICAgICByZXR1cm4gaCAqIGggKyBmICogZgogICAgfQogICAgdmFyIFUgPSAidW5kZWZpbmVkIiAhPT0gdHlwZW9mIEZsb2F0MzJBcnJheSA/IEZsb2F0MzJBcnJheSA6IEFycmF5LAogICAgICAgIGhhID0gTWF0aC5yYW5kb20sCiAgICAgICAgaGIgPSBNYXRoLlBJIC8gMTgwOwogICAgTWF0aC5oeXBvdCB8fCAoTWF0aC5oeXBvdCA9IGZ1bmN0aW9uKCkgewogICAgICAgIGZvciAodmFyIGYgPSAwLCBoID0gYXJndW1lbnRzLmxlbmd0aDsgaC0tOykgZiArPSBhcmd1bWVudHNbaF0gKiBhcmd1bWVudHNbaF07CiAgICAgICAgcmV0dXJuIE1hdGguc3FydChmKQogICAgfSk7CiAgICB2YXIgaWIgPSBPYmplY3QuZnJlZXplKHsKICAgICAgICAgICAgX19wcm90b19fOiBudWxsLAogICAgICAgICAgICBFUFNJTE9OOiAxRS02LAogICAgICAgICAgICBnZXQgQVJSQVlfVFlQRSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBVCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFJBTkRPTTogaGEsCiAgICAgICAgICAgIEFOR0xFX09SREVSOiAienl4IiwKICAgICAgICAgICAgc2V0TWF0cml4QXJyYXlUeXBlOiBmdW5jdGlvbihmKSB7CiAgICAgICAgICAgICAgICBVID0KICAgICAgICAgICAgICAgICAgICBmCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHRvUmFkaWFuOiBmdW5jdGlvbihmKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZiAqIGhiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVxdWFsczogZnVuY3Rpb24oZiwgaCkgewogICAgICAgICAgICAgICAgcmV0dXJuIE1hdGguYWJzKGYgLSBoKSA8PSAxRS02ICogTWF0aC5tYXgoMSwgTWF0aC5hYnMoZiksIE1hdGguYWJzKGgpKQogICAgICAgICAgICB9CiAgICAgICAgfSksCiAgICAgICAgamIgPSBPYmplY3QuZnJlZXplKHsKICAgICAgICAgICAgX19wcm90b19fOiBudWxsLAogICAgICAgICAgICBjcmVhdGU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdmFyIGYgPSBuZXcgVSg0KTsKICAgICAgICAgICAgICAgIFUgIT0gRmxvYXQzMkFycmF5ICYmIChmWzFdID0gMCwgZlsyXSA9IDApOwogICAgICAgICAgICAgICAgZlswXSA9IDE7CiAgICAgICAgICAgICAgICBmWzNdID0gMTsKICAgICAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNsb25lOiBmdW5jdGlvbihmKSB7CiAgICAgICAgICAgICAgICB2YXIgaCA9IG5ldyBVKDQpOwogICAgICAgICAgICAgICAgaFswXSA9IGZbMF07CiAgICAgICAgICAgICAgICBoWzFdID0gZlsxXTsKICAgICAgICAgICAgICAgIGhbMl0gPSBmWzJdOwogICAgICAgICAgICAgICAgaFszXSA9IGZbM107CiAgICAgICAgICAgICAgICByZXR1cm4gaAogICAgICAgICAgICB9LAogICAgICAgICAgICBjb3B5OiBmdW5jdGlvbihmLCBoKSB7CiAgICAgICAgICAgICAgICBmWzBdID0gaFswXTsKICAgICAgICAgICAgICAgIGZbMV0gPSBoWzFdOwogICAgICAgICAgICAgICAgZlsyXSA9IGhbMl07CiAgICAgICAgICAgICAgICBmWzNdID0gaFszXTsKICAgICAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGlkZW50aXR5OiBmdW5jdGlvbihmKSB7CiAgICAgICAgICAgICAgICBmWzBdID0gMTsKICAgICAgICAgICAgICAgIGZbMV0gPSAwOwogICAgICAgICAgICAgICAgZlsyXSA9IDA7CiAgICAgICAgICAgICAgICBmWzNdID0gMTsKICAgICAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGZyb21WYWx1ZXM6IGZ1bmN0aW9uKGYsIGgsIGwsIHApIHsKICAgICAgICAgICAgICAgIHZhciByID0gbmV3IFUoNCk7CiAgICAgICAgICAgICAgICByWzBdID0gZjsKICAgICAgICAgICAgICAgIHJbMV0gPSBoOwogICAgICAgICAgICAgICAgclsyXSA9IGw7CiAgICAgICAgICAgICAgICByWzNdID0gcDsKICAgICAgICAgICAgICAgIHJldHVybiByCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNldDogZnVuY3Rpb24oZiwgaCwgbCwgcCwgcikgewogICAgICAgICAgICAgICAgZlswXSA9IGg7CiAgICAgICAgICAgICAgICBmWzFdID0gbDsKICAgICAgICAgICAgICAgIGZbMl0gPSBwOwogICAgICAgICAgICAgICAgZlszXSA9IHI7CiAgICAgICAgICAgICAgICByZXR1cm4gZgogICAgICAgICAgICB9LAogICAgICAgICAgICB0cmFuc3Bvc2U6IGZ1bmN0aW9uKGYsIGgpIHsKICAgICAgICAgICAgICAgIGlmIChmID09PSBoKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGwgPSBoWzFdOwogICAgICAgICAgICAgICAgICAgIGZbMV0gPSBoWzJdOwogICAgICAgICAgICAgICAgICAgIGZbMl0gPSBsCiAgICAgICAgICAgICAgICB9IGVsc2UgZlswXSA9IGhbMF0sIGZbMV0gPSBoWzJdLCBmWzJdID0gaFsxXSwgZlszXSA9IGhbM107CiAgICAgICAgICAgICAgICByZXR1cm4gZgogICAgICAgICAgICB9LAogICAgICAgICAgICBpbnZlcnQ6IGZ1bmN0aW9uKGYsIGgpIHsKICAgICAgICAgICAgICAgIHZhciBsID0gaFswXSwKICAgICAgICAgICAgICAgICAgICBwID0gaFsxXSwKICAgICAgICAgICAgICAgICAgICByID0gaFsyXTsKICAgICAgICAgICAgICAgIGggPSBoWzNdOwogICAgICAgICAgICAgICAgdmFyIHQgPSBsICogaCAtIHIgKiBwOwogICAgICAgICAgICAgICAgaWYgKCF0KSByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICAgIHQgPSAxIC8gdDsKICAgICAgICAgICAgICAgIGZbMF0gPSBoICogdDsKICAgICAgICAgICAgICAgIGZbMV0gPSAtcCAqIHQ7CiAgICAgICAgICAgICAgICBmWzJdID0gLXIgKiB0OwogICAgICAgICAgICAgICAgZlszXSA9IGwgKiB0OwogICAgICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgYWRqb2ludDogZnVuY3Rpb24oZiwgaCkgewogICAgICAgICAgICAgICAgdmFyIGwgPSBoWzBdOwogICAgICAgICAgICAgICAgZlswXSA9IGhbM107CiAgICAgICAgICAgICAgICBmWzFdID0gLWhbMV07CiAgICAgICAgICAgICAgICBmWzJdID0gLWhbMl07CiAgICAgICAgICAgICAgICBmWzNdID0gbDsKICAgICAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGRldGVybWluYW50OiBmdW5jdGlvbihmKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZlswXSAqIGZbM10gLSBmWzJdICogZlsxXQogICAgICAgICAgICB9LAogICAgICAgICAgICBtdWx0aXBseTogYiwKICAgICAgICAgICAgcm90YXRlOiBmdW5jdGlvbihmLCBoLCBsKSB7CiAgICAgICAgICAgICAgICB2YXIgcCA9IGhbMF0sCiAgICAgICAgICAgICAgICAgICAgciA9IGhbMV0sCiAgICAgICAgICAgICAgICAgICAgdCA9IGhbMl07CiAgICAgICAgICAgICAgICBoID0gaFszXTsKICAgICAgICAgICAgICAgIHZhciB2ID0gTWF0aC5zaW4obCk7CiAgICAgICAgICAgICAgICBsID0gTWF0aC5jb3MobCk7CiAgICAgICAgICAgICAgICBmWzBdID0gcCAqIGwgKyB0ICogdjsKICAgICAgICAgICAgICAgIGZbMV0gPSByICogbCArIGggKiB2OwogICAgICAgICAgICAgICAgZlsyXSA9IHAgKiAtdiArIHQgKiBsOwogICAgICAgICAgICAgICAgZlszXSA9IHIgKiAtdiArIGggKiBsOwogICAgICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2NhbGU6IGZ1bmN0aW9uKGYsIGgsIGwpIHsKICAgICAgICAgICAgICAgIHZhciBwID0gaFsxXSwKICAgICAgICAgICAgICAgICAgICByID0gaFsyXSwKICAgICAgICAgICAgICAgICAgICB0ID0gaFszXSwKICAgICAgICAgICAgICAgICAgICB2ID0gbFswXTsKICAgICAgICAgICAgICAgIGwgPSBsWzFdOwogICAgICAgICAgICAgICAgZlswXSA9IGhbMF0gKiB2OwogICAgICAgICAgICAgICAgZlsxXSA9IHAgKiB2OwogICAgICAgICAgICAgICAgZlsyXSA9IHIgKiBsOwogICAgICAgICAgICAgICAgZlszXSA9IHQgKiBsOwogICAgICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZnJvbVJvdGF0aW9uOiBmdW5jdGlvbihmLCBoKSB7CiAgICAgICAgICAgICAgICB2YXIgbCA9IE1hdGguc2luKGgpOwogICAgICAgICAgICAgICAgaCA9IE1hdGguY29zKGgpOwogICAgICAgICAgICAgICAgZlswXSA9IGg7CiAgICAgICAgICAgICAgICBmWzFdID0gbDsKICAgICAgICAgICAgICAgIGZbMl0gPSAtbDsKICAgICAgICAgICAgICAgIGZbM10gPSBoOwogICAgICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZnJvbVNjYWxpbmc6IGZ1bmN0aW9uKGYsIGgpIHsKICAgICAgICAgICAgICAgIGZbMF0gPSBoWzBdOwogICAgICAgICAgICAgICAgZlsxXSA9IDA7CiAgICAgICAgICAgICAgICBmWzJdID0gMDsKICAgICAgICAgICAgICAgIGZbM10gPSBoWzFdOwogICAgICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc3RyOiBmdW5jdGlvbihmKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gIm1hdDIoIiArIGZbMF0gKyAiLCAiICsgZlsxXSArICIsICIgKyBmWzJdICsgIiwgIiArIGZbM10gKyAiKSIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZnJvYjogZnVuY3Rpb24oZikgewogICAgICAgICAgICAgICAgcmV0dXJuIE1hdGguaHlwb3QoZlswXSwKICAgICAgICAgICAgICAgICAgICBmWzFdLCBmWzJdLCBmWzNdKQogICAgICAgICAgICB9LAogICAgICAgICAgICBMRFU6IGZ1bmN0aW9uKGYsIGgsIGwsIHApIHsKICAgICAgICAgICAgICAgIGZbMl0gPSBwWzJdIC8gcFswXTsKICAgICAgICAgICAgICAgIGxbMF0gPSBwWzBdOwogICAgICAgICAgICAgICAgbFsxXSA9IHBbMV07CiAgICAgICAgICAgICAgICBsWzNdID0gcFszXSAtIGZbMl0gKiBsWzFdOwogICAgICAgICAgICAgICAgcmV0dXJuIFtmLCBoLCBsXQogICAgICAgICAgICB9LAogICAgICAgICAgICBhZGQ6IGZ1bmN0aW9uKGYsIGgsIGwpIHsKICAgICAgICAgICAgICAgIGZbMF0gPSBoWzBdICsgbFswXTsKICAgICAgICAgICAgICAgIGZbMV0gPSBoWzFdICsgbFsxXTsKICAgICAgICAgICAgICAgIGZbMl0gPSBoWzJdICsgbFsyXTsKICAgICAgICAgICAgICAgIGZbM10gPSBoWzNdICsgbFszXTsKICAgICAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHN1YnRyYWN0OiBkLAogICAgICAgICAgICBleGFjdEVxdWFsczogZnVuY3Rpb24oZiwgaCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZbMF0gPT09IGhbMF0gJiYgZlsxXSA9PT0gaFsxXSAmJiBmWzJdID09PSBoWzJdICYmIGZbM10gPT09IGhbM10KICAgICAgICAgICAgfSwKICAgICAgICAgICAgZXF1YWxzOiBmdW5jdGlvbihmLCBoKSB7CiAgICAgICAgICAgICAgICB2YXIgbCA9IGZbMF0sCiAgICAgICAgICAgICAgICAgICAgcCA9IGZbMV0sCiAgICAgICAgICAgICAgICAgICAgciA9IGZbMl07CiAgICAgICAgICAgICAgICBmID0gZlszXTsKICAgICAgICAgICAgICAgIHZhciB0ID0gaFswXSwKICAgICAgICAgICAgICAgICAgICB2ID0gaFsxXSwKICAgICAgICAgICAgICAgICAgICB4ID0gaFsyXTsKICAgICAgICAgICAgICAgIGggPSBoWzNdOwogICAgICAgICAgICAgICAgcmV0dXJuIE1hdGguYWJzKGwgLSB0KSA8PSAxRS02ICogTWF0aC5tYXgoMSwgTWF0aC5hYnMobCksIE1hdGguYWJzKHQpKSAmJiBNYXRoLmFicyhwIC0gdikgPD0gMUUtNiAqIE1hdGgubWF4KDEsIE1hdGguYWJzKHApLCBNYXRoLmFicyh2KSkgJiYKICAgICAgICAgICAgICAgICAgICBNYXRoLmFicyhyIC0geCkgPD0gMUUtNiAqIE1hdGgubWF4KDEsIE1hdGguYWJzKHIpLCBNYXRoLmFicyh4KSkgJiYgTWF0aC5hYnMoZiAtIGgpIDw9IDFFLTYgKiBNYXRoLm1heCgxLCBNYXRoLmFicyhmKSwgTWF0aC5hYnMoaCkpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG11bHRpcGx5U2NhbGFyOiBmdW5jdGlvbihmLCBoLCBsKSB7CiAgICAgICAgICAgICAgICBmWzBdID0gaFswXSAqIGw7CiAgICAgICAgICAgICAgICBmWzFdID0gaFsxXSAqIGw7CiAgICAgICAgICAgICAgICBmWzJdID0gaFsyXSAqIGw7CiAgICAgICAgICAgICAgICBmWzNdID0gaFszXSAqIGw7CiAgICAgICAgICAgICAgICByZXR1cm4gZgogICAgICAgICAgICB9LAogICAgICAgICAgICBtdWx0aXBseVNjYWxhckFuZEFkZDogZnVuY3Rpb24oZiwgaCwgbCwgcCkgewogICAgICAgICAgICAgICAgZlswXSA9IGhbMF0gKyBsWzBdICogcDsKICAgICAgICAgICAgICAgIGZbMV0gPSBoWzFdICsgbFsxXSAqIHA7CiAgICAgICAgICAgICAgICBmWzJdID0gaFsyXSArIGxbMl0gKiBwOwogICAgICAgICAgICAgICAgZlszXSA9IGhbM10gKyBsWzNdICogcDsKICAgICAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG11bDogYiwKICAgICAgICAgICAgc3ViOiBkCiAgICAgICAgfSksCiAgICAgICAga2IgPSBPYmplY3QuZnJlZXplKHsKICAgICAgICAgICAgX19wcm90b19fOiBudWxsLAogICAgICAgICAgICBjcmVhdGU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdmFyIGYgPSBuZXcgVSg2KTsKICAgICAgICAgICAgICAgIFUgIT0gRmxvYXQzMkFycmF5ICYmIChmWzFdID0gMCwgZlsyXSA9IDAsIGZbNF0gPSAwLCBmWzVdID0gMCk7CiAgICAgICAgICAgICAgICBmWzBdID0gMTsKICAgICAgICAgICAgICAgIGZbM10gPSAxOwogICAgICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgY2xvbmU6IGZ1bmN0aW9uKGYpIHsKICAgICAgICAgICAgICAgIHZhciBoID0gbmV3IFUoNik7CiAgICAgICAgICAgICAgICBoWzBdID0gZlswXTsKICAgICAgICAgICAgICAgIGhbMV0gPSBmWzFdOwogICAgICAgICAgICAgICAgaFsyXSA9IGZbMl07CiAgICAgICAgICAgICAgICBoWzNdID0gZlszXTsKICAgICAgICAgICAgICAgIGhbNF0gPSBmWzRdOwogICAgICAgICAgICAgICAgaFs1XSA9IGZbNV07CiAgICAgICAgICAgICAgICByZXR1cm4gaAogICAgICAgICAgICB9LAogICAgICAgICAgICBjb3B5OiBmdW5jdGlvbihmLCBoKSB7CiAgICAgICAgICAgICAgICBmWzBdID0gaFswXTsKICAgICAgICAgICAgICAgIGZbMV0gPSBoWzFdOwogICAgICAgICAgICAgICAgZlsyXSA9IGhbMl07CiAgICAgICAgICAgICAgICBmWzNdID0gaFszXTsKICAgICAgICAgICAgICAgIGZbNF0gPSBoWzRdOwogICAgICAgICAgICAgICAgZls1XSA9IGhbNV07CiAgICAgICAgICAgICAgICByZXR1cm4gZgogICAgICAgICAgICB9LAogICAgICAgICAgICBpZGVudGl0eTogZnVuY3Rpb24oZikgewogICAgICAgICAgICAgICAgZlswXSA9IDE7CiAgICAgICAgICAgICAgICBmWzFdID0gMDsKICAgICAgICAgICAgICAgIGZbMl0gPSAwOwogICAgICAgICAgICAgICAgZlszXSA9IDE7CiAgICAgICAgICAgICAgICBmWzRdID0gMDsKICAgICAgICAgICAgICAgIGZbNV0gPSAwOwogICAgICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZnJvbVZhbHVlczogZnVuY3Rpb24oZiwgaCwgbCwgcCwgciwgdCkgewogICAgICAgICAgICAgICAgdmFyIHYgPSBuZXcgVSg2KTsKICAgICAgICAgICAgICAgIHZbMF0gPSBmOwogICAgICAgICAgICAgICAgdlsxXSA9IGg7CiAgICAgICAgICAgICAgICB2WzJdID0gbDsKICAgICAgICAgICAgICAgIHZbM10gPSBwOwogICAgICAgICAgICAgICAgdls0XSA9IHI7CiAgICAgICAgICAgICAgICB2WzVdID0gdDsKICAgICAgICAgICAgICAgIHJldHVybiB2CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNldDogZnVuY3Rpb24oZiwgaCwgbCwgcCwgciwgdCwgdikgewogICAgICAgICAgICAgICAgZlswXSA9IGg7CiAgICAgICAgICAgICAgICBmWzFdID0gbDsKICAgICAgICAgICAgICAgIGZbMl0gPSBwOwogICAgICAgICAgICAgICAgZlszXSA9IHI7CiAgICAgICAgICAgICAgICBmWzRdID0gdDsKICAgICAgICAgICAgICAgIGZbNV0gPSB2OwogICAgICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgaW52ZXJ0OiBmdW5jdGlvbihmLCBoKSB7CiAgICAgICAgICAgICAgICB2YXIgbCA9IGhbMF0sCiAgICAgICAgICAgICAgICAgICAgcCA9IGhbMV0sCiAgICAgICAgICAgICAgICAgICAgciA9IGhbMl0sCiAgICAgICAgICAgICAgICAgICAgdCA9IGhbM10sCiAgICAgICAgICAgICAgICAgICAgdiA9IGhbNF07CiAgICAgICAgICAgICAgICBoID0gaFs1XTsKICAgICAgICAgICAgICAgIHZhciB4ID0gbCAqIHQgLSBwICogcjsKICAgICAgICAgICAgICAgIGlmICgheCkgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgICB4ID0gMSAvIHg7CiAgICAgICAgICAgICAgICBmWzBdID0gdCAqIHg7CiAgICAgICAgICAgICAgICBmWzFdID0gLXAgKiB4OwogICAgICAgICAgICAgICAgZlsyXSA9IC1yICogeDsKICAgICAgICAgICAgICAgIGZbM10gPSBsICogeDsKICAgICAgICAgICAgICAgIGZbNF0gPSAociAqIGggLSB0ICogdikgKiB4OwogICAgICAgICAgICAgICAgZls1XSA9IChwICogdiAtIGwgKiBoKSAqIHg7CiAgICAgICAgICAgICAgICByZXR1cm4gZgogICAgICAgICAgICB9LAogICAgICAgICAgICBkZXRlcm1pbmFudDogZnVuY3Rpb24oZikgewogICAgICAgICAgICAgICAgcmV0dXJuIGZbMF0gKiBmWzNdIC0gZlsxXSAqIGZbMl0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgbXVsdGlwbHk6IGMsCiAgICAgICAgICAgIHJvdGF0ZTogZnVuY3Rpb24oZiwgaCwgbCkgewogICAgICAgICAgICAgICAgdmFyIHAgPSBoWzBdLAogICAgICAgICAgICAgICAgICAgIHIgPSBoWzFdLAogICAgICAgICAgICAgICAgICAgIHQgPSBoWzJdLAogICAgICAgICAgICAgICAgICAgIHYgPSBoWzNdLAogICAgICAgICAgICAgICAgICAgIHggPSBoWzRdOwogICAgICAgICAgICAgICAgaCA9IGhbNV07CiAgICAgICAgICAgICAgICB2YXIgeSA9IE1hdGguc2luKGwpOwogICAgICAgICAgICAgICAgbCA9IE1hdGguY29zKGwpOwogICAgICAgICAgICAgICAgZlswXSA9IHAgKiBsICsgdCAqIHk7CiAgICAgICAgICAgICAgICBmWzFdID0gciAqIGwgKyB2ICogeTsKICAgICAgICAgICAgICAgIGZbMl0gPSBwICogLXkgKyB0ICogbDsKICAgICAgICAgICAgICAgIGZbM10gPSByICogLXkgKyB2ICogbDsKICAgICAgICAgICAgICAgIGZbNF0gPSB4OwogICAgICAgICAgICAgICAgZls1XSA9IGg7CiAgICAgICAgICAgICAgICByZXR1cm4gZgogICAgICAgICAgICB9LAogICAgICAgICAgICBzY2FsZTogZnVuY3Rpb24oZiwgaCwgbCkgewogICAgICAgICAgICAgICAgdmFyIHAgPSBoWzFdLAogICAgICAgICAgICAgICAgICAgIHIgPSBoWzJdLAogICAgICAgICAgICAgICAgICAgIHQgPSBoWzNdLAogICAgICAgICAgICAgICAgICAgIHYgPSBoWzRdLAogICAgICAgICAgICAgICAgICAgIHggPSBoWzVdLAogICAgICAgICAgICAgICAgICAgIHkgPSBsWzBdOwogICAgICAgICAgICAgICAgbCA9IGxbMV07CiAgICAgICAgICAgICAgICBmWzBdID0gaFswXSAqIHk7CiAgICAgICAgICAgICAgICBmWzFdID0gcCAqIHk7CiAgICAgICAgICAgICAgICBmWzJdID0gciAqIGw7CiAgICAgICAgICAgICAgICBmWzNdID0gdCAqIGw7CiAgICAgICAgICAgICAgICBmWzRdID0gdjsKICAgICAgICAgICAgICAgIGZbNV0gPSB4OwogICAgICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgdHJhbnNsYXRlOiBmdW5jdGlvbihmLCBoLCBsKSB7CiAgICAgICAgICAgICAgICB2YXIgcCA9IGhbMF0sCiAgICAgICAgICAgICAgICAgICAgciA9IGhbMV0sCiAgICAgICAgICAgICAgICAgICAgdCA9IGhbMl0sCiAgICAgICAgICAgICAgICAgICAgdiA9IGhbM10sCiAgICAgICAgICAgICAgICAgICAgeCA9IGhbNF07CiAgICAgICAgICAgICAgICBoID0gaFs1XTsKICAgICAgICAgICAgICAgIHZhciB5ID0gbFswXTsKICAgICAgICAgICAgICAgIGwgPSBsWzFdOwogICAgICAgICAgICAgICAgZlswXSA9IHA7CiAgICAgICAgICAgICAgICBmWzFdID0gcjsKICAgICAgICAgICAgICAgIGZbMl0gPSB0OwogICAgICAgICAgICAgICAgZlszXSA9IHY7CiAgICAgICAgICAgICAgICBmWzRdID0gcCAqIHkgKyB0ICogbCArIHg7CiAgICAgICAgICAgICAgICBmWzVdID0gciAqIHkgKyB2ICogbCArIGg7CiAgICAgICAgICAgICAgICByZXR1cm4gZgogICAgICAgICAgICB9LAogICAgICAgICAgICBmcm9tUm90YXRpb246IGZ1bmN0aW9uKGYsIGgpIHsKICAgICAgICAgICAgICAgIHZhciBsID0gTWF0aC5zaW4oaCk7CiAgICAgICAgICAgICAgICBoID0gTWF0aC5jb3MoaCk7CiAgICAgICAgICAgICAgICBmWzBdID0gaDsKICAgICAgICAgICAgICAgIGZbMV0gPSBsOwogICAgICAgICAgICAgICAgZlsyXSA9IC1sOwogICAgICAgICAgICAgICAgZlszXSA9IGg7CiAgICAgICAgICAgICAgICBmWzRdID0gMDsKICAgICAgICAgICAgICAgIGZbNV0gPSAwOwogICAgICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZnJvbVNjYWxpbmc6IGZ1bmN0aW9uKGYsIGgpIHsKICAgICAgICAgICAgICAgIGZbMF0gPSBoWzBdOwogICAgICAgICAgICAgICAgZlsxXSA9IDA7CiAgICAgICAgICAgICAgICBmWzJdID0gMDsKICAgICAgICAgICAgICAgIGZbM10gPSBoWzFdOwogICAgICAgICAgICAgICAgZls0XSA9IDA7CiAgICAgICAgICAgICAgICBmWzVdID0gMDsKICAgICAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGZyb21UcmFuc2xhdGlvbjogZnVuY3Rpb24oZiwgaCkgewogICAgICAgICAgICAgICAgZlswXSA9IDE7CiAgICAgICAgICAgICAgICBmWzFdID0gMDsKICAgICAgICAgICAgICAgIGZbMl0gPSAwOwogICAgICAgICAgICAgICAgZlszXSA9IDE7CiAgICAgICAgICAgICAgICBmWzRdID0gaFswXTsKICAgICAgICAgICAgICAgIGZbNV0gPSBoWzFdOwogICAgICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc3RyOiBmdW5jdGlvbihmKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gIm1hdDJkKCIgKyBmWzBdICsgIiwgIiArIGZbMV0gKyAiLCAiICsgZlsyXSArICIsICIgKyBmWzNdICsgIiwgIiArIGZbNF0gKyAiLCAiICsgZls1XSArICIpIgogICAgICAgICAgICB9LAogICAgICAgICAgICBmcm9iOiBmdW5jdGlvbihmKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gTWF0aC5oeXBvdChmWzBdLAogICAgICAgICAgICAgICAgICAgIGZbMV0sIGZbMl0sIGZbM10sIGZbNF0sIGZbNV0sIDEpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGFkZDogZnVuY3Rpb24oZiwgaCwgbCkgewogICAgICAgICAgICAgICAgZlswXSA9IGhbMF0gKyBsWzBdOwogICAgICAgICAgICAgICAgZlsxXSA9IGhbMV0gKyBsWzFdOwogICAgICAgICAgICAgICAgZlsyXSA9IGhbMl0gKyBsWzJdOwogICAgICAgICAgICAgICAgZlszXSA9IGhbM10gKyBsWzNdOwogICAgICAgICAgICAgICAgZls0XSA9IGhbNF0gKyBsWzRdOwogICAgICAgICAgICAgICAgZls1XSA9IGhbNV0gKyBsWzVdOwogICAgICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc3VidHJhY3Q6IGUsCiAgICAgICAgICAgIG11bHRpcGx5U2NhbGFyOiBmdW5jdGlvbihmLCBoLCBsKSB7CiAgICAgICAgICAgICAgICBmWzBdID0gaFswXSAqIGw7CiAgICAgICAgICAgICAgICBmWzFdID0gaFsxXSAqIGw7CiAgICAgICAgICAgICAgICBmWzJdID0gaFsyXSAqIGw7CiAgICAgICAgICAgICAgICBmWzNdID0gaFszXSAqIGw7CiAgICAgICAgICAgICAgICBmWzRdID0gaFs0XSAqIGw7CiAgICAgICAgICAgICAgICBmWzVdID0gaFs1XSAqIGw7CiAgICAgICAgICAgICAgICByZXR1cm4gZgogICAgICAgICAgICB9LAogICAgICAgICAgICBtdWx0aXBseVNjYWxhckFuZEFkZDogZnVuY3Rpb24oZiwgaCwgbCwgcCkgewogICAgICAgICAgICAgICAgZlswXSA9IGhbMF0gKyBsWzBdICogcDsKICAgICAgICAgICAgICAgIGZbMV0gPSBoWzFdICsgbFsxXSAqIHA7CiAgICAgICAgICAgICAgICBmWzJdID0gaFsyXSArIGxbMl0gKiBwOwogICAgICAgICAgICAgICAgZlszXSA9IGhbM10gKyBsWzNdICogcDsKICAgICAgICAgICAgICAgIGZbNF0gPSBoWzRdICsgbFs0XSAqIHA7CiAgICAgICAgICAgICAgICBmWzVdID0gaFs1XSArIGxbNV0gKiBwOwogICAgICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZXhhY3RFcXVhbHM6IGZ1bmN0aW9uKGYsIGgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmWzBdID09PSBoWzBdICYmIGZbMV0gPT09IGhbMV0gJiYgZlsyXSA9PT0gaFsyXSAmJiBmWzNdID09PQogICAgICAgICAgICAgICAgICAgIGhbM10gJiYgZls0XSA9PT0gaFs0XSAmJiBmWzVdID09PSBoWzVdCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVxdWFsczogZnVuY3Rpb24oZiwgaCkgewogICAgICAgICAgICAgICAgdmFyIGwgPSBmWzBdLAogICAgICAgICAgICAgICAgICAgIHAgPSBmWzFdLAogICAgICAgICAgICAgICAgICAgIHIgPSBmWzJdLAogICAgICAgICAgICAgICAgICAgIHQgPSBmWzNdLAogICAgICAgICAgICAgICAgICAgIHYgPSBmWzRdOwogICAgICAgICAgICAgICAgZiA9IGZbNV07CiAgICAgICAgICAgICAgICB2YXIgeCA9IGhbMF0sCiAgICAgICAgICAgICAgICAgICAgeSA9IGhbMV0sCiAgICAgICAgICAgICAgICAgICAgQSA9IGhbMl0sCiAgICAgICAgICAgICAgICAgICAgQiA9IGhbM10sCiAgICAgICAgICAgICAgICAgICAgRyA9IGhbNF07CiAgICAgICAgICAgICAgICBoID0gaFs1XTsKICAgICAgICAgICAgICAgIHJldHVybiBNYXRoLmFicyhsIC0geCkgPD0gMUUtNiAqIE1hdGgubWF4KDEsIE1hdGguYWJzKGwpLCBNYXRoLmFicyh4KSkgJiYgTWF0aC5hYnMocCAtIHkpIDw9IDFFLTYgKiBNYXRoLm1heCgxLCBNYXRoLmFicyhwKSwgTWF0aC5hYnMoeSkpICYmIE1hdGguYWJzKHIgLSBBKSA8PSAxRS02ICogTWF0aC5tYXgoMSwgTWF0aC5hYnMociksIE1hdGguYWJzKEEpKSAmJiBNYXRoLmFicyh0IC0gQikgPD0gMUUtNiAqIE1hdGgubWF4KDEsIE1hdGguYWJzKHQpLCBNYXRoLmFicyhCKSkgJiYgTWF0aC5hYnModiAtIEcpIDw9IDFFLTYgKiBNYXRoLm1heCgxLCBNYXRoLmFicyh2KSwgTWF0aC5hYnMoRykpICYmIE1hdGguYWJzKGYgLSBoKSA8PSAxRS02ICogTWF0aC5tYXgoMSwgTWF0aC5hYnMoZiksIE1hdGguYWJzKGgpKQogICAgICAgICAgICB9LAogICAgICAgICAgICBtdWw6IGMsCiAgICAgICAgICAgIHN1YjogZQogICAgICAgIH0pLAogICAgICAgIGxiID0gT2JqZWN0LmZyZWV6ZSh7CiAgICAgICAgICAgIF9fcHJvdG9fXzogbnVsbCwKICAgICAgICAgICAgY3JlYXRlOiBnLAogICAgICAgICAgICBmcm9tTWF0NDogZnVuY3Rpb24oZiwgaCkgewogICAgICAgICAgICAgICAgZlswXSA9IGhbMF07CiAgICAgICAgICAgICAgICBmWzFdID0gaFsxXTsKICAgICAgICAgICAgICAgIGZbMl0gPSBoWzJdOwogICAgICAgICAgICAgICAgZlszXSA9IGhbNF07CiAgICAgICAgICAgICAgICBmWzRdID0gaFs1XTsKICAgICAgICAgICAgICAgIGZbNV0gPSBoWzZdOwogICAgICAgICAgICAgICAgZls2XSA9IGhbOF07CiAgICAgICAgICAgICAgICBmWzddID0gaFs5XTsKICAgICAgICAgICAgICAgIGZbOF0gPSBoWzEwXTsKICAgICAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNsb25lOiBmdW5jdGlvbihmKSB7CiAgICAgICAgICAgICAgICB2YXIgaCA9IG5ldyBVKDkpOwogICAgICAgICAgICAgICAgaFswXSA9IGZbMF07CiAgICAgICAgICAgICAgICBoWzFdID0gZlsxXTsKICAgICAgICAgICAgICAgIGhbMl0gPSBmWzJdOwogICAgICAgICAgICAgICAgaFszXSA9IGZbM107CiAgICAgICAgICAgICAgICBoWzRdID0gZls0XTsKICAgICAgICAgICAgICAgIGhbNV0gPSBmWzVdOwogICAgICAgICAgICAgICAgaFs2XSA9IGZbNl07CiAgICAgICAgICAgICAgICBoWzddID0gZls3XTsKICAgICAgICAgICAgICAgIGhbOF0gPSBmWzhdOwogICAgICAgICAgICAgICAgcmV0dXJuIGgKICAgICAgICAgICAgfSwKICAgICAgICAgICAgY29weTogZnVuY3Rpb24oZiwgaCkgewogICAgICAgICAgICAgICAgZlswXSA9IGhbMF07CiAgICAgICAgICAgICAgICBmWzFdID0gaFsxXTsKICAgICAgICAgICAgICAgIGZbMl0gPSBoWzJdOwogICAgICAgICAgICAgICAgZlszXSA9IGhbM107CiAgICAgICAgICAgICAgICBmWzRdID0gaFs0XTsKICAgICAgICAgICAgICAgIGZbNV0gPSBoWzVdOwogICAgICAgICAgICAgICAgZls2XSA9IGhbNl07CiAgICAgICAgICAgICAgICBmWzddID0gaFs3XTsKICAgICAgICAgICAgICAgIGZbOF0gPSBoWzhdOwogICAgICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZnJvbVZhbHVlczogZnVuY3Rpb24oZiwgaCwgbCwgcCwgciwgdCwgdiwgeCwgeSkgewogICAgICAgICAgICAgICAgdmFyIEEgPSBuZXcgVSg5KTsKICAgICAgICAgICAgICAgIEFbMF0gPSBmOwogICAgICAgICAgICAgICAgQVsxXSA9IGg7CiAgICAgICAgICAgICAgICBBWzJdID0gbDsKICAgICAgICAgICAgICAgIEFbM10gPSBwOwogICAgICAgICAgICAgICAgQVs0XSA9CiAgICAgICAgICAgICAgICAgICAgcjsKICAgICAgICAgICAgICAgIEFbNV0gPSB0OwogICAgICAgICAgICAgICAgQVs2XSA9IHY7CiAgICAgICAgICAgICAgICBBWzddID0geDsKICAgICAgICAgICAgICAgIEFbOF0gPSB5OwogICAgICAgICAgICAgICAgcmV0dXJuIEEKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2V0OiBmdW5jdGlvbihmLCBoLCBsLCBwLCByLCB0LCB2LCB4LCB5LCBBKSB7CiAgICAgICAgICAgICAgICBmWzBdID0gaDsKICAgICAgICAgICAgICAgIGZbMV0gPSBsOwogICAgICAgICAgICAgICAgZlsyXSA9IHA7CiAgICAgICAgICAgICAgICBmWzNdID0gcjsKICAgICAgICAgICAgICAgIGZbNF0gPSB0OwogICAgICAgICAgICAgICAgZls1XSA9IHY7CiAgICAgICAgICAgICAgICBmWzZdID0geDsKICAgICAgICAgICAgICAgIGZbN10gPSB5OwogICAgICAgICAgICAgICAgZls4XSA9IEE7CiAgICAgICAgICAgICAgICByZXR1cm4gZgogICAgICAgICAgICB9LAogICAgICAgICAgICBpZGVudGl0eTogZnVuY3Rpb24oZikgewogICAgICAgICAgICAgICAgZlswXSA9IDE7CiAgICAgICAgICAgICAgICBmWzFdID0gMDsKICAgICAgICAgICAgICAgIGZbMl0gPSAwOwogICAgICAgICAgICAgICAgZlszXSA9IDA7CiAgICAgICAgICAgICAgICBmWzRdID0gMTsKICAgICAgICAgICAgICAgIGZbNV0gPSAwOwogICAgICAgICAgICAgICAgZls2XSA9IDA7CiAgICAgICAgICAgICAgICBmWzddID0gMDsKICAgICAgICAgICAgICAgIGZbOF0gPSAxOwogICAgICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgdHJhbnNwb3NlOiBmdW5jdGlvbihmLCBoKSB7CiAgICAgICAgICAgICAgICBpZiAoZiA9PT0gaCkgewogICAgICAgICAgICAgICAgICAgIHZhciBsID0gaFsxXSwKICAgICAgICAgICAgICAgICAgICAgICAgcCA9IGhbMl0sCiAgICAgICAgICAgICAgICAgICAgICAgIHIgPSBoWzVdOwogICAgICAgICAgICAgICAgICAgIGZbMV0gPSBoWzNdOwogICAgICAgICAgICAgICAgICAgIGZbMl0gPSBoWzZdOwogICAgICAgICAgICAgICAgICAgIGZbM10gPSBsOwogICAgICAgICAgICAgICAgICAgIGZbNV0gPSBoWzddOwogICAgICAgICAgICAgICAgICAgIGZbNl0gPSBwOwogICAgICAgICAgICAgICAgICAgIGZbN10gPSByCiAgICAgICAgICAgICAgICB9IGVsc2UgZlswXSA9IGhbMF0sIGZbMV0gPSBoWzNdLCBmWzJdID0gaFs2XSwgZlszXSA9IGhbMV0sIGZbNF0gPSBoWzRdLCBmWzVdID0gaFs3XSwgZls2XSA9IGhbMl0sIGZbN10gPSBoWzVdLCBmWzhdID0gaFs4XTsKICAgICAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGludmVydDogZnVuY3Rpb24oZiwgaCkgewogICAgICAgICAgICAgICAgdmFyIGwgPSBoWzBdLAogICAgICAgICAgICAgICAgICAgIHAgPSBoWzFdLAogICAgICAgICAgICAgICAgICAgIHIgPSBoWzJdLAogICAgICAgICAgICAgICAgICAgIHQgPSBoWzNdLAogICAgICAgICAgICAgICAgICAgIHYgPSBoWzRdLAogICAgICAgICAgICAgICAgICAgIHggPSBoWzVdLAogICAgICAgICAgICAgICAgICAgIHkgPSBoWzZdLAogICAgICAgICAgICAgICAgICAgIEEgPSBoWzddOwogICAgICAgICAgICAgICAgaCA9IGhbOF07CiAgICAgICAgICAgICAgICB2YXIgQiA9IGggKiB2IC0geCAqIEEsCiAgICAgICAgICAgICAgICAgICAgRyA9IC1oICogdCArIHggKiB5LAogICAgICAgICAgICAgICAgICAgIEkgPSBBICogdCAtIHYgKiB5LAogICAgICAgICAgICAgICAgICAgIEggPSBsICogQiArIHAgKiBHICsgciAqIEk7CiAgICAgICAgICAgICAgICBpZiAoIUgpIHJldHVybiBudWxsOwogICAgICAgICAgICAgICAgSCA9IDEgLyBIOwogICAgICAgICAgICAgICAgZlswXSA9IEIgKiBIOwogICAgICAgICAgICAgICAgZlsxXSA9ICgtaCAqIHAgKyByICogQSkgKiBIOwogICAgICAgICAgICAgICAgZlsyXSA9ICh4ICogcCAtIHIgKiB2KSAqIEg7CiAgICAgICAgICAgICAgICBmWzNdID0gRyAqIEg7CiAgICAgICAgICAgICAgICBmWzRdID0gKGggKiBsIC0gciAqIHkpICogSDsKICAgICAgICAgICAgICAgIGZbNV0gPSAoLXggKiBsICsgciAqIHQpICogSDsKICAgICAgICAgICAgICAgIGZbNl0gPSBJICogSDsKICAgICAgICAgICAgICAgIGZbN10gPSAoLUEgKiBsICsgcCAqIHkpICogSDsKICAgICAgICAgICAgICAgIGZbOF0gPSAodiAqIGwgLSBwICogdCkgKiBIOwogICAgICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgYWRqb2ludDogZnVuY3Rpb24oZiwgaCkgewogICAgICAgICAgICAgICAgdmFyIGwgPSBoWzBdLAogICAgICAgICAgICAgICAgICAgIHAgPSBoWzFdLAogICAgICAgICAgICAgICAgICAgIHIgPSBoWzJdLAogICAgICAgICAgICAgICAgICAgIHQgPSBoWzNdLAogICAgICAgICAgICAgICAgICAgIHYgPSBoWzRdLAogICAgICAgICAgICAgICAgICAgIHggPSBoWzVdLAogICAgICAgICAgICAgICAgICAgIHkgPSBoWzZdLAogICAgICAgICAgICAgICAgICAgIEEgPSBoWzddOwogICAgICAgICAgICAgICAgaCA9IGhbOF07CiAgICAgICAgICAgICAgICBmWzBdID0gdiAqIGggLSB4ICogQTsKICAgICAgICAgICAgICAgIGZbMV0gPSByICogQSAtIHAgKiBoOwogICAgICAgICAgICAgICAgZlsyXSA9IHAgKiB4IC0gciAqIHY7CiAgICAgICAgICAgICAgICBmWzNdID0geCAqIHkgLSB0ICogaDsKICAgICAgICAgICAgICAgIGZbNF0gPSBsICogaCAtIHIgKiB5OwogICAgICAgICAgICAgICAgZls1XSA9IHIgKiB0IC0gbCAqIHg7CiAgICAgICAgICAgICAgICBmWzZdID0gdCAqIEEgLSB2ICogeTsKICAgICAgICAgICAgICAgIGZbN10gPSBwICogeSAtIGwgKiBBOwogICAgICAgICAgICAgICAgZls4XSA9IGwgKiB2IC0gcCAqIHQ7CiAgICAgICAgICAgICAgICByZXR1cm4gZgogICAgICAgICAgICB9LAogICAgICAgICAgICBkZXRlcm1pbmFudDogZnVuY3Rpb24oZikgewogICAgICAgICAgICAgICAgdmFyIGggPQogICAgICAgICAgICAgICAgICAgIGZbM10sCiAgICAgICAgICAgICAgICAgICAgbCA9IGZbNF0sCiAgICAgICAgICAgICAgICAgICAgcCA9IGZbNV0sCiAgICAgICAgICAgICAgICAgICAgciA9IGZbNl0sCiAgICAgICAgICAgICAgICAgICAgdCA9IGZbN10sCiAgICAgICAgICAgICAgICAgICAgdiA9IGZbOF07CiAgICAgICAgICAgICAgICByZXR1cm4gZlswXSAqICh2ICogbCAtIHAgKiB0KSArIGZbMV0gKiAoLXYgKiBoICsgcCAqIHIpICsgZlsyXSAqICh0ICogaCAtIGwgKiByKQogICAgICAgICAgICB9LAogICAgICAgICAgICBtdWx0aXBseTogaywKICAgICAgICAgICAgdHJhbnNsYXRlOiBmdW5jdGlvbihmLCBoLCBsKSB7CiAgICAgICAgICAgICAgICB2YXIgcCA9IGhbMF0sCiAgICAgICAgICAgICAgICAgICAgciA9IGhbMV0sCiAgICAgICAgICAgICAgICAgICAgdCA9IGhbMl0sCiAgICAgICAgICAgICAgICAgICAgdiA9IGhbM10sCiAgICAgICAgICAgICAgICAgICAgeCA9IGhbNF0sCiAgICAgICAgICAgICAgICAgICAgeSA9IGhbNV0sCiAgICAgICAgICAgICAgICAgICAgQSA9IGhbNl0sCiAgICAgICAgICAgICAgICAgICAgQiA9IGhbN107CiAgICAgICAgICAgICAgICBoID0gaFs4XTsKICAgICAgICAgICAgICAgIHZhciBHID0gbFswXTsKICAgICAgICAgICAgICAgIGwgPSBsWzFdOwogICAgICAgICAgICAgICAgZlswXSA9IHA7CiAgICAgICAgICAgICAgICBmWzFdID0gcjsKICAgICAgICAgICAgICAgIGZbMl0gPSB0OwogICAgICAgICAgICAgICAgZlszXSA9IHY7CiAgICAgICAgICAgICAgICBmWzRdID0geDsKICAgICAgICAgICAgICAgIGZbNV0gPSB5OwogICAgICAgICAgICAgICAgZls2XSA9IEcgKiBwICsgbCAqIHYgKyBBOwogICAgICAgICAgICAgICAgZls3XSA9IEcgKiByICsgbCAqIHggKyBCOwogICAgICAgICAgICAgICAgZls4XSA9IEcgKiB0ICsgbCAqIHkgKyBoOwogICAgICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgcm90YXRlOiBmdW5jdGlvbihmLCBoLCBsKSB7CiAgICAgICAgICAgICAgICB2YXIgcCA9IGhbMF0sCiAgICAgICAgICAgICAgICAgICAgciA9IGhbMV0sCiAgICAgICAgICAgICAgICAgICAgdCA9IGhbMl0sCiAgICAgICAgICAgICAgICAgICAgdiA9IGhbM10sCiAgICAgICAgICAgICAgICAgICAgeCA9IGhbNF0sCiAgICAgICAgICAgICAgICAgICAgeSA9IGhbNV0sCiAgICAgICAgICAgICAgICAgICAgQSA9IGhbNl0sCiAgICAgICAgICAgICAgICAgICAgQiA9IGhbN107CiAgICAgICAgICAgICAgICBoID0gaFs4XTsKICAgICAgICAgICAgICAgIHZhciBHID0gTWF0aC5zaW4obCk7CiAgICAgICAgICAgICAgICBsID0gTWF0aC5jb3MobCk7CiAgICAgICAgICAgICAgICBmWzBdID0gbCAqIHAgKyBHICogdjsKICAgICAgICAgICAgICAgIGZbMV0gPSBsICogciArIEcgKiB4OwogICAgICAgICAgICAgICAgZlsyXSA9IGwgKiB0ICsgRyAqIHk7CiAgICAgICAgICAgICAgICBmWzNdID0gbCAqIHYgLSBHICogcDsKICAgICAgICAgICAgICAgIGZbNF0gPSBsICogeCAtIEcgKiByOwogICAgICAgICAgICAgICAgZls1XSA9CiAgICAgICAgICAgICAgICAgICAgbCAqIHkgLSBHICogdDsKICAgICAgICAgICAgICAgIGZbNl0gPSBBOwogICAgICAgICAgICAgICAgZls3XSA9IEI7CiAgICAgICAgICAgICAgICBmWzhdID0gaDsKICAgICAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNjYWxlOiBmdW5jdGlvbihmLCBoLCBsKSB7CiAgICAgICAgICAgICAgICB2YXIgcCA9IGxbMF07CiAgICAgICAgICAgICAgICBsID0gbFsxXTsKICAgICAgICAgICAgICAgIGZbMF0gPSBwICogaFswXTsKICAgICAgICAgICAgICAgIGZbMV0gPSBwICogaFsxXTsKICAgICAgICAgICAgICAgIGZbMl0gPSBwICogaFsyXTsKICAgICAgICAgICAgICAgIGZbM10gPSBsICogaFszXTsKICAgICAgICAgICAgICAgIGZbNF0gPSBsICogaFs0XTsKICAgICAgICAgICAgICAgIGZbNV0gPSBsICogaFs1XTsKICAgICAgICAgICAgICAgIGZbNl0gPSBoWzZdOwogICAgICAgICAgICAgICAgZls3XSA9IGhbN107CiAgICAgICAgICAgICAgICBmWzhdID0gaFs4XTsKICAgICAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGZyb21UcmFuc2xhdGlvbjogZnVuY3Rpb24oZiwgaCkgewogICAgICAgICAgICAgICAgZlswXSA9IDE7CiAgICAgICAgICAgICAgICBmWzFdID0gMDsKICAgICAgICAgICAgICAgIGZbMl0gPSAwOwogICAgICAgICAgICAgICAgZlszXSA9IDA7CiAgICAgICAgICAgICAgICBmWzRdID0gMTsKICAgICAgICAgICAgICAgIGZbNV0gPSAwOwogICAgICAgICAgICAgICAgZls2XSA9IGhbMF07CiAgICAgICAgICAgICAgICBmWzddID0gaFsxXTsKICAgICAgICAgICAgICAgIGZbOF0gPSAxOwogICAgICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZnJvbVJvdGF0aW9uOiBmdW5jdGlvbihmLCBoKSB7CiAgICAgICAgICAgICAgICB2YXIgbCA9IE1hdGguc2luKGgpOwogICAgICAgICAgICAgICAgaCA9IE1hdGguY29zKGgpOwogICAgICAgICAgICAgICAgZlswXSA9IGg7CiAgICAgICAgICAgICAgICBmWzFdID0gbDsKICAgICAgICAgICAgICAgIGZbMl0gPSAwOwogICAgICAgICAgICAgICAgZlszXSA9IC1sOwogICAgICAgICAgICAgICAgZls0XSA9IGg7CiAgICAgICAgICAgICAgICBmWzVdID0gMDsKICAgICAgICAgICAgICAgIGZbNl0gPSAwOwogICAgICAgICAgICAgICAgZls3XSA9IDA7CiAgICAgICAgICAgICAgICBmWzhdID0gMTsKICAgICAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGZyb21TY2FsaW5nOiBmdW5jdGlvbihmLCBoKSB7CiAgICAgICAgICAgICAgICBmWzBdID0gaFswXTsKICAgICAgICAgICAgICAgIGZbMV0gPSAwOwogICAgICAgICAgICAgICAgZlsyXSA9IDA7CiAgICAgICAgICAgICAgICBmWzNdID0gMDsKICAgICAgICAgICAgICAgIGZbNF0gPSBoWzFdOwogICAgICAgICAgICAgICAgZls1XSA9CiAgICAgICAgICAgICAgICAgICAgMDsKICAgICAgICAgICAgICAgIGZbNl0gPSAwOwogICAgICAgICAgICAgICAgZls3XSA9IDA7CiAgICAgICAgICAgICAgICBmWzhdID0gMTsKICAgICAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGZyb21NYXQyZDogZnVuY3Rpb24oZiwgaCkgewogICAgICAgICAgICAgICAgZlswXSA9IGhbMF07CiAgICAgICAgICAgICAgICBmWzFdID0gaFsxXTsKICAgICAgICAgICAgICAgIGZbMl0gPSAwOwogICAgICAgICAgICAgICAgZlszXSA9IGhbMl07CiAgICAgICAgICAgICAgICBmWzRdID0gaFszXTsKICAgICAgICAgICAgICAgIGZbNV0gPSAwOwogICAgICAgICAgICAgICAgZls2XSA9IGhbNF07CiAgICAgICAgICAgICAgICBmWzddID0gaFs1XTsKICAgICAgICAgICAgICAgIGZbOF0gPSAxOwogICAgICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZnJvbVF1YXQ6IGZ1bmN0aW9uKGYsIGgpIHsKICAgICAgICAgICAgICAgIHZhciBsID0gaFswXSwKICAgICAgICAgICAgICAgICAgICBwID0gaFsxXSwKICAgICAgICAgICAgICAgICAgICByID0gaFsyXTsKICAgICAgICAgICAgICAgIGggPSBoWzNdOwogICAgICAgICAgICAgICAgdmFyIHQgPSBsICsgbCwKICAgICAgICAgICAgICAgICAgICB2ID0gcCArIHAsCiAgICAgICAgICAgICAgICAgICAgeCA9IHIgKyByOwogICAgICAgICAgICAgICAgbCAqPSB0OwogICAgICAgICAgICAgICAgdmFyIHkgPSBwICogdDsKICAgICAgICAgICAgICAgIHAgKj0gdjsKICAgICAgICAgICAgICAgIHZhciBBID0gciAqIHQsCiAgICAgICAgICAgICAgICAgICAgQiA9IHIgKiB2OwogICAgICAgICAgICAgICAgciAqPSB4OwogICAgICAgICAgICAgICAgdCAqPSBoOwogICAgICAgICAgICAgICAgdiAqPSBoOwogICAgICAgICAgICAgICAgaCAqPSB4OwogICAgICAgICAgICAgICAgZlswXSA9IDEgLSBwIC0gcjsKICAgICAgICAgICAgICAgIGZbM10gPSB5IC0gaDsKICAgICAgICAgICAgICAgIGZbNl0gPSBBICsgdjsKICAgICAgICAgICAgICAgIGZbMV0gPSB5ICsgaDsKICAgICAgICAgICAgICAgIGZbNF0gPSAxIC0gbCAtIHI7CiAgICAgICAgICAgICAgICBmWzddID0gQiAtIHQ7CiAgICAgICAgICAgICAgICBmWzJdID0gQSAtIHY7CiAgICAgICAgICAgICAgICBmWzVdID0gQiArIHQ7CiAgICAgICAgICAgICAgICBmWzhdID0gMSAtIGwgLSBwOwogICAgICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgbm9ybWFsRnJvbU1hdDQ6IGZ1bmN0aW9uKGYsIGgpIHsKICAgICAgICAgICAgICAgIHZhciBsID0gaFswXSwKICAgICAgICAgICAgICAgICAgICBwID0gaFsxXSwKICAgICAgICAgICAgICAgICAgICByID0gaFsyXSwKICAgICAgICAgICAgICAgICAgICB0ID0gaFszXSwKICAgICAgICAgICAgICAgICAgICB2ID0gaFs0XSwKICAgICAgICAgICAgICAgICAgICB4ID0gaFs1XSwKICAgICAgICAgICAgICAgICAgICB5ID0gaFs2XSwKICAgICAgICAgICAgICAgICAgICBBID0gaFs3XSwKICAgICAgICAgICAgICAgICAgICBCID0gaFs4XSwKICAgICAgICAgICAgICAgICAgICBHID0gaFs5XSwKICAgICAgICAgICAgICAgICAgICBJID0gaFsxMF0sCiAgICAgICAgICAgICAgICAgICAgSCA9IGhbMTFdLAogICAgICAgICAgICAgICAgICAgIE0gPSBoWzEyXSwKICAgICAgICAgICAgICAgICAgICBOID0gaFsxM10sCiAgICAgICAgICAgICAgICAgICAgTCA9IGhbMTRdOwogICAgICAgICAgICAgICAgaCA9IGhbMTVdOwogICAgICAgICAgICAgICAgdmFyIFEgPSBsICogeCAtIHAgKiB2LAogICAgICAgICAgICAgICAgICAgIFAgPSBsICogeSAtIHIgKiB2LAogICAgICAgICAgICAgICAgICAgIFMgPSBsICogQSAtIHQgKiB2LAogICAgICAgICAgICAgICAgICAgIFQgPSBwICogeSAtIHIgKiB4LAogICAgICAgICAgICAgICAgICAgIFIgPSBwICogQSAtIHQgKiB4LAogICAgICAgICAgICAgICAgICAgIFggPSByICogQSAtIHQgKiB5LAogICAgICAgICAgICAgICAgICAgIFkgPSBCICogTiAtIEcgKiBNLAogICAgICAgICAgICAgICAgICAgIFogPSBCICogTCAtIEkgKiBNOwogICAgICAgICAgICAgICAgQiA9IEIgKiBoIC0gSCAqIE07CiAgICAgICAgICAgICAgICB2YXIgYWEgPSBHICogTCAtIEkgKiBOOwogICAgICAgICAgICAgICAgRyA9IEcgKiBoIC0gSCAqIE47CiAgICAgICAgICAgICAgICBJID0gSSAqIGggLSBIICogTDsKICAgICAgICAgICAgICAgIEggPSBRICogSSAtIFAgKiBHICsgUyAqIGFhICsgVCAqIEIgLSBSICogWiArIFggKiBZOwogICAgICAgICAgICAgICAgaWYgKCFIKSByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICAgIEggPSAxIC8gSDsKICAgICAgICAgICAgICAgIGZbMF0gPSAoeCAqIEkgLSB5ICogRyArIEEgKiBhYSkgKiBIOwogICAgICAgICAgICAgICAgZlsxXSA9ICh5ICogQiAtIHYgKiBJIC0gQSAqIFopICogSDsKICAgICAgICAgICAgICAgIGZbMl0gPSAodiAqIEcgLSB4ICogQiArIEEgKiBZKSAqIEg7CiAgICAgICAgICAgICAgICBmWzNdID0gKHIgKiBHIC0gcCAqIEkgLSB0ICogYWEpICogSDsKICAgICAgICAgICAgICAgIGZbNF0gPSAobCAqIEkgLSByICogQiArIHQgKiBaKSAqIEg7CiAgICAgICAgICAgICAgICBmWzVdID0gKHAgKiBCIC0gbCAqIEcgLSB0ICogWSkgKiBIOwogICAgICAgICAgICAgICAgZls2XSA9IChOICogWCAtIEwgKiBSICsgaCAqIFQpICogSDsKICAgICAgICAgICAgICAgIGZbN10gPSAoTCAqIFMgLSBNICogWCAtIGggKiBQKSAqIEg7CiAgICAgICAgICAgICAgICBmWzhdID0gKE0gKiBSIC0gTiAqIFMgKyBoICogUSkgKiBIOwogICAgICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgcHJvamVjdGlvbjogZnVuY3Rpb24oZiwgaCwgbCkgewogICAgICAgICAgICAgICAgZlswXSA9IDIgLyBoOwogICAgICAgICAgICAgICAgZlsxXSA9IDA7CiAgICAgICAgICAgICAgICBmWzJdID0gMDsKICAgICAgICAgICAgICAgIGZbM10gPSAwOwogICAgICAgICAgICAgICAgZls0XSA9IC0yIC8gbDsKICAgICAgICAgICAgICAgIGZbNV0gPSAwOwogICAgICAgICAgICAgICAgZls2XSA9IC0xOwogICAgICAgICAgICAgICAgZls3XSA9IDE7CiAgICAgICAgICAgICAgICBmWzhdID0gMTsKICAgICAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHN0cjogZnVuY3Rpb24oZikgewogICAgICAgICAgICAgICAgcmV0dXJuICJtYXQzKCIgKyBmWzBdICsgIiwgIiArIGZbMV0gKyAiLCAiICsgZlsyXSArICIsICIgKyBmWzNdICsgIiwgIiArIGZbNF0gKyAiLCAiICsgZls1XSArICIsICIgKyBmWzZdICsgIiwgIiArIGZbN10gKyAiLCAiICsgZls4XSArICIpIgogICAgICAgICAgICB9LAogICAgICAgICAgICBmcm9iOiBmdW5jdGlvbihmKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gTWF0aC5oeXBvdChmWzBdLCBmWzFdLCBmWzJdLCBmWzNdLCBmWzRdLCBmWzVdLCBmWzZdLCBmWzddLCBmWzhdKQogICAgICAgICAgICB9LAogICAgICAgICAgICBhZGQ6IGZ1bmN0aW9uKGYsIGgsIGwpIHsKICAgICAgICAgICAgICAgIGZbMF0gPSBoWzBdICsgbFswXTsKICAgICAgICAgICAgICAgIGZbMV0gPSBoWzFdICsgbFsxXTsKICAgICAgICAgICAgICAgIGZbMl0gPSBoWzJdICsgbFsyXTsKICAgICAgICAgICAgICAgIGZbM10gPSBoWzNdICsgbFszXTsKICAgICAgICAgICAgICAgIGZbNF0gPSBoWzRdICsgbFs0XTsKICAgICAgICAgICAgICAgIGZbNV0gPSBoWzVdICsgbFs1XTsKICAgICAgICAgICAgICAgIGZbNl0gPSBoWzZdICsgbFs2XTsKICAgICAgICAgICAgICAgIGZbN10gPSBoWzddICsgbFs3XTsKICAgICAgICAgICAgICAgIGZbOF0gPSBoWzhdICsgbFs4XTsKICAgICAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHN1YnRyYWN0OiBtLAogICAgICAgICAgICBtdWx0aXBseVNjYWxhcjogZnVuY3Rpb24oZiwgaCwgbCkgewogICAgICAgICAgICAgICAgZlswXSA9IGhbMF0gKiBsOwogICAgICAgICAgICAgICAgZlsxXSA9IGhbMV0gKiBsOwogICAgICAgICAgICAgICAgZlsyXSA9IGhbMl0gKiBsOwogICAgICAgICAgICAgICAgZlszXSA9IGhbM10gKiBsOwogICAgICAgICAgICAgICAgZls0XSA9IGhbNF0gKiBsOwogICAgICAgICAgICAgICAgZls1XSA9IGhbNV0gKiBsOwogICAgICAgICAgICAgICAgZls2XSA9IGhbNl0gKgogICAgICAgICAgICAgICAgICAgIGw7CiAgICAgICAgICAgICAgICBmWzddID0gaFs3XSAqIGw7CiAgICAgICAgICAgICAgICBmWzhdID0gaFs4XSAqIGw7CiAgICAgICAgICAgICAgICByZXR1cm4gZgogICAgICAgICAgICB9LAogICAgICAgICAgICBtdWx0aXBseVNjYWxhckFuZEFkZDogZnVuY3Rpb24oZiwgaCwgbCwgcCkgewogICAgICAgICAgICAgICAgZlswXSA9IGhbMF0gKyBsWzBdICogcDsKICAgICAgICAgICAgICAgIGZbMV0gPSBoWzFdICsgbFsxXSAqIHA7CiAgICAgICAgICAgICAgICBmWzJdID0gaFsyXSArIGxbMl0gKiBwOwogICAgICAgICAgICAgICAgZlszXSA9IGhbM10gKyBsWzNdICogcDsKICAgICAgICAgICAgICAgIGZbNF0gPSBoWzRdICsgbFs0XSAqIHA7CiAgICAgICAgICAgICAgICBmWzVdID0gaFs1XSArIGxbNV0gKiBwOwogICAgICAgICAgICAgICAgZls2XSA9IGhbNl0gKyBsWzZdICogcDsKICAgICAgICAgICAgICAgIGZbN10gPSBoWzddICsgbFs3XSAqIHA7CiAgICAgICAgICAgICAgICBmWzhdID0gaFs4XSArIGxbOF0gKiBwOwogICAgICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZXhhY3RFcXVhbHM6IGZ1bmN0aW9uKGYsIGgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmWzBdID09PSBoWzBdICYmIGZbMV0gPT09IGhbMV0gJiYgZlsyXSA9PT0gaFsyXSAmJiBmWzNdID09PSBoWzNdICYmIGZbNF0gPT09IGhbNF0gJiYgZls1XSA9PT0gaFs1XSAmJiBmWzZdID09PSBoWzZdICYmIGZbN10gPT09IGhbN10gJiYgZls4XSA9PT0gaFs4XQogICAgICAgICAgICB9LAogICAgICAgICAgICBlcXVhbHM6IGZ1bmN0aW9uKGYsIGgpIHsKICAgICAgICAgICAgICAgIHZhciBsID0gZlswXSwKICAgICAgICAgICAgICAgICAgICBwID0gZlsxXSwKICAgICAgICAgICAgICAgICAgICByID0gZlsyXSwKICAgICAgICAgICAgICAgICAgICB0ID0gZlszXSwKICAgICAgICAgICAgICAgICAgICB2ID0gZls0XSwKICAgICAgICAgICAgICAgICAgICB4ID0gZls1XSwKICAgICAgICAgICAgICAgICAgICB5ID0gZls2XSwKICAgICAgICAgICAgICAgICAgICBBID0gZls3XTsKICAgICAgICAgICAgICAgIGYgPSBmWzhdOwogICAgICAgICAgICAgICAgdmFyIEIgPSBoWzBdLAogICAgICAgICAgICAgICAgICAgIEcgPSBoWzFdLAogICAgICAgICAgICAgICAgICAgIEkgPSBoWzJdLAogICAgICAgICAgICAgICAgICAgIEggPSBoWzNdLAogICAgICAgICAgICAgICAgICAgIE0gPSBoWzRdLAogICAgICAgICAgICAgICAgICAgIE4gPSBoWzVdLAogICAgICAgICAgICAgICAgICAgIEwgPSBoWzZdLAogICAgICAgICAgICAgICAgICAgIFEgPSBoWzddOwogICAgICAgICAgICAgICAgaCA9IGhbOF07CiAgICAgICAgICAgICAgICByZXR1cm4gTWF0aC5hYnMobCAtIEIpIDw9IDFFLTYgKiBNYXRoLm1heCgxLCBNYXRoLmFicyhsKSwgTWF0aC5hYnMoQikpICYmIE1hdGguYWJzKHAgLSBHKSA8PSAxRS02ICogTWF0aC5tYXgoMSwgTWF0aC5hYnMocCksIE1hdGguYWJzKEcpKSAmJiBNYXRoLmFicyhyIC0gSSkgPD0gMUUtNiAqIE1hdGgubWF4KDEsIE1hdGguYWJzKHIpLCBNYXRoLmFicyhJKSkgJiYgTWF0aC5hYnModCAtIEgpIDw9IDFFLTYgKiBNYXRoLm1heCgxLCBNYXRoLmFicyh0KSwgTWF0aC5hYnMoSCkpICYmIE1hdGguYWJzKHYgLSBNKSA8PSAxRS02ICogTWF0aC5tYXgoMSwgTWF0aC5hYnModiksIE1hdGguYWJzKE0pKSAmJiBNYXRoLmFicyh4IC0gTikgPD0gMUUtNiAqIE1hdGgubWF4KDEsIE1hdGguYWJzKHgpLCBNYXRoLmFicyhOKSkgJiYgTWF0aC5hYnMoeSAtIEwpIDw9IDFFLTYgKiBNYXRoLm1heCgxLCBNYXRoLmFicyh5KSwgTWF0aC5hYnMoTCkpICYmIE1hdGguYWJzKEEgLSBRKSA8PSAxRS02ICogTWF0aC5tYXgoMSwgTWF0aC5hYnMoQSksIE1hdGguYWJzKFEpKSAmJgogICAgICAgICAgICAgICAgICAgIE1hdGguYWJzKGYgLSBoKSA8PSAxRS02ICogTWF0aC5tYXgoMSwgTWF0aC5hYnMoZiksIE1hdGguYWJzKGgpKQogICAgICAgICAgICB9LAogICAgICAgICAgICBtdWw6IGssCiAgICAgICAgICAgIHN1YjogbQogICAgICAgIH0pLAogICAgICAgIG1iID0gT2JqZWN0LmZyZWV6ZSh7CiAgICAgICAgICAgIF9fcHJvdG9fXzogbnVsbCwKICAgICAgICAgICAgY3JlYXRlOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHZhciBmID0gbmV3IFUoMTYpOwogICAgICAgICAgICAgICAgVSAhPSBGbG9hdDMyQXJyYXkgJiYgKGZbMV0gPSAwLCBmWzJdID0gMCwgZlszXSA9IDAsIGZbNF0gPSAwLCBmWzZdID0gMCwgZls3XSA9IDAsIGZbOF0gPSAwLCBmWzldID0gMCwgZlsxMV0gPSAwLCBmWzEyXSA9IDAsIGZbMTNdID0gMCwgZlsxNF0gPSAwKTsKICAgICAgICAgICAgICAgIGZbMF0gPSAxOwogICAgICAgICAgICAgICAgZls1XSA9IDE7CiAgICAgICAgICAgICAgICBmWzEwXSA9IDE7CiAgICAgICAgICAgICAgICBmWzE1XSA9IDE7CiAgICAgICAgICAgICAgICByZXR1cm4gZgogICAgICAgICAgICB9LAogICAgICAgICAgICBjbG9uZTogZnVuY3Rpb24oZikgewogICAgICAgICAgICAgICAgdmFyIGggPSBuZXcgVSgxNik7CiAgICAgICAgICAgICAgICBoWzBdID0gZlswXTsKICAgICAgICAgICAgICAgIGhbMV0gPSBmWzFdOwogICAgICAgICAgICAgICAgaFsyXSA9IGZbMl07CiAgICAgICAgICAgICAgICBoWzNdID0gZlszXTsKICAgICAgICAgICAgICAgIGhbNF0gPSBmWzRdOwogICAgICAgICAgICAgICAgaFs1XSA9IGZbNV07CiAgICAgICAgICAgICAgICBoWzZdID0gZls2XTsKICAgICAgICAgICAgICAgIGhbN10gPSBmWzddOwogICAgICAgICAgICAgICAgaFs4XSA9IGZbOF07CiAgICAgICAgICAgICAgICBoWzldID0gZls5XTsKICAgICAgICAgICAgICAgIGhbMTBdID0gZlsxMF07CiAgICAgICAgICAgICAgICBoWzExXSA9IGZbMTFdOwogICAgICAgICAgICAgICAgaFsxMl0gPSBmWzEyXTsKICAgICAgICAgICAgICAgIGhbMTNdID0gZlsxM107CiAgICAgICAgICAgICAgICBoWzE0XSA9IGZbMTRdOwogICAgICAgICAgICAgICAgaFsxNV0gPSBmWzE1XTsKICAgICAgICAgICAgICAgIHJldHVybiBoCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNvcHk6IGZ1bmN0aW9uKGYsIGgpIHsKICAgICAgICAgICAgICAgIGZbMF0gPSBoWzBdOwogICAgICAgICAgICAgICAgZlsxXSA9IGhbMV07CiAgICAgICAgICAgICAgICBmWzJdID0gaFsyXTsKICAgICAgICAgICAgICAgIGZbM10gPSBoWzNdOwogICAgICAgICAgICAgICAgZls0XSA9IGhbNF07CiAgICAgICAgICAgICAgICBmWzVdID0gaFs1XTsKICAgICAgICAgICAgICAgIGZbNl0gPSBoWzZdOwogICAgICAgICAgICAgICAgZls3XSA9IGhbN107CiAgICAgICAgICAgICAgICBmWzhdID0gaFs4XTsKICAgICAgICAgICAgICAgIGZbOV0gPSBoWzldOwogICAgICAgICAgICAgICAgZlsxMF0gPSBoWzEwXTsKICAgICAgICAgICAgICAgIGZbMTFdID0gaFsxMV07CiAgICAgICAgICAgICAgICBmWzEyXSA9IGhbMTJdOwogICAgICAgICAgICAgICAgZlsxM10gPSBoWzEzXTsKICAgICAgICAgICAgICAgIGZbMTRdID0gaFsxNF07CiAgICAgICAgICAgICAgICBmWzE1XSA9IGhbMTVdOwogICAgICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZnJvbVZhbHVlczogZnVuY3Rpb24oZiwgaCwgbCwgcCwgciwgdCwgdiwgeCwgeSwgQSwgQiwgRywgSSwgSCwgTSwgTikgewogICAgICAgICAgICAgICAgdmFyIEwgPSBuZXcgVSgxNik7CiAgICAgICAgICAgICAgICBMWzBdID0gZjsKICAgICAgICAgICAgICAgIExbMV0gPSBoOwogICAgICAgICAgICAgICAgTFsyXSA9IGw7CiAgICAgICAgICAgICAgICBMWzNdID0gcDsKICAgICAgICAgICAgICAgIExbNF0gPSByOwogICAgICAgICAgICAgICAgTFs1XSA9IHQ7CiAgICAgICAgICAgICAgICBMWzZdID0gdjsKICAgICAgICAgICAgICAgIExbN10gPSB4OwogICAgICAgICAgICAgICAgTFs4XSA9IHk7CiAgICAgICAgICAgICAgICBMWzldID0gQTsKICAgICAgICAgICAgICAgIExbMTBdID0gQjsKICAgICAgICAgICAgICAgIExbMTFdID0gRzsKICAgICAgICAgICAgICAgIExbMTJdID0gSTsKICAgICAgICAgICAgICAgIExbMTNdID0gSDsKICAgICAgICAgICAgICAgIExbMTRdID0gTTsKICAgICAgICAgICAgICAgIExbMTVdID0gTjsKICAgICAgICAgICAgICAgIHJldHVybiBMCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNldDogZnVuY3Rpb24oZiwgaCwgbCwgcCwgciwgdCwgdiwgeCwgeSwgQSwgQiwgRywgSSwgSCwgTSwgTiwgTCkgewogICAgICAgICAgICAgICAgZlswXSA9IGg7CiAgICAgICAgICAgICAgICBmWzFdID0gbDsKICAgICAgICAgICAgICAgIGZbMl0gPSBwOwogICAgICAgICAgICAgICAgZlszXSA9IHI7CiAgICAgICAgICAgICAgICBmWzRdID0gdDsKICAgICAgICAgICAgICAgIGZbNV0gPSB2OwogICAgICAgICAgICAgICAgZls2XSA9IHg7CiAgICAgICAgICAgICAgICBmWzddID0geTsKICAgICAgICAgICAgICAgIGZbOF0gPSBBOwogICAgICAgICAgICAgICAgZls5XSA9IEI7CiAgICAgICAgICAgICAgICBmWzEwXSA9IEc7CiAgICAgICAgICAgICAgICBmWzExXSA9IEk7CiAgICAgICAgICAgICAgICBmWzEyXSA9IEg7CiAgICAgICAgICAgICAgICBmWzEzXSA9IE07CiAgICAgICAgICAgICAgICBmWzE0XSA9IE47CiAgICAgICAgICAgICAgICBmWzE1XSA9IEw7CiAgICAgICAgICAgICAgICByZXR1cm4gZgogICAgICAgICAgICB9LAogICAgICAgICAgICBpZGVudGl0eTogbiwKICAgICAgICAgICAgdHJhbnNwb3NlOiBmdW5jdGlvbihmLCBoKSB7CiAgICAgICAgICAgICAgICBpZiAoZiA9PT0gaCkgewogICAgICAgICAgICAgICAgICAgIHZhciBsID0gaFsxXSwKICAgICAgICAgICAgICAgICAgICAgICAgcCA9IGhbMl0sCiAgICAgICAgICAgICAgICAgICAgICAgIHIgPSBoWzNdLAogICAgICAgICAgICAgICAgICAgICAgICB0ID0gaFs2XSwKICAgICAgICAgICAgICAgICAgICAgICAgdiA9IGhbN10sCiAgICAgICAgICAgICAgICAgICAgICAgIHggPSBoWzExXTsKICAgICAgICAgICAgICAgICAgICBmWzFdID0gaFs0XTsKICAgICAgICAgICAgICAgICAgICBmWzJdID0gaFs4XTsKICAgICAgICAgICAgICAgICAgICBmWzNdID0gaFsxMl07CiAgICAgICAgICAgICAgICAgICAgZls0XSA9IGw7CiAgICAgICAgICAgICAgICAgICAgZls2XSA9IGhbOV07CiAgICAgICAgICAgICAgICAgICAgZls3XSA9IGhbMTNdOwogICAgICAgICAgICAgICAgICAgIGZbOF0gPSBwOwogICAgICAgICAgICAgICAgICAgIGZbOV0gPSB0OwogICAgICAgICAgICAgICAgICAgIGZbMTFdID0gaFsxNF07CiAgICAgICAgICAgICAgICAgICAgZlsxMl0gPSByOwogICAgICAgICAgICAgICAgICAgIGZbMTNdID0gdjsKICAgICAgICAgICAgICAgICAgICBmWzE0XSA9IHgKICAgICAgICAgICAgICAgIH0gZWxzZSBmWzBdID0gaFswXSwgZlsxXSA9IGhbNF0sIGZbMl0gPSBoWzhdLCBmWzNdID0gaFsxMl0sIGZbNF0gPSBoWzFdLCBmWzVdID0gaFs1XSwgZls2XSA9IGhbOV0sIGZbN10gPSBoWzEzXSwgZls4XSA9IGhbMl0sIGZbOV0gPSBoWzZdLCBmWzEwXSA9IGhbMTBdLCBmWzExXSA9IGhbMTRdLCBmWzEyXSA9IGhbM10sIGZbMTNdID0gaFs3XSwgZlsxNF0gPSBoWzExXSwgZlsxNV0gPSBoWzE1XTsKICAgICAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGludmVydDogZnVuY3Rpb24oZiwgaCkgewogICAgICAgICAgICAgICAgdmFyIGwgPSBoWzBdLAogICAgICAgICAgICAgICAgICAgIHAgPSBoWzFdLAogICAgICAgICAgICAgICAgICAgIHIgPQogICAgICAgICAgICAgICAgICAgIGhbMl0sCiAgICAgICAgICAgICAgICAgICAgdCA9IGhbM10sCiAgICAgICAgICAgICAgICAgICAgdiA9IGhbNF0sCiAgICAgICAgICAgICAgICAgICAgeCA9IGhbNV0sCiAgICAgICAgICAgICAgICAgICAgeSA9IGhbNl0sCiAgICAgICAgICAgICAgICAgICAgQSA9IGhbN10sCiAgICAgICAgICAgICAgICAgICAgQiA9IGhbOF0sCiAgICAgICAgICAgICAgICAgICAgRyA9IGhbOV0sCiAgICAgICAgICAgICAgICAgICAgSSA9IGhbMTBdLAogICAgICAgICAgICAgICAgICAgIEggPSBoWzExXSwKICAgICAgICAgICAgICAgICAgICBNID0gaFsxMl0sCiAgICAgICAgICAgICAgICAgICAgTiA9IGhbMTNdLAogICAgICAgICAgICAgICAgICAgIEwgPSBoWzE0XTsKICAgICAgICAgICAgICAgIGggPSBoWzE1XTsKICAgICAgICAgICAgICAgIHZhciBRID0gbCAqIHggLSBwICogdiwKICAgICAgICAgICAgICAgICAgICBQID0gbCAqIHkgLSByICogdiwKICAgICAgICAgICAgICAgICAgICBTID0gbCAqIEEgLSB0ICogdiwKICAgICAgICAgICAgICAgICAgICBUID0gcCAqIHkgLSByICogeCwKICAgICAgICAgICAgICAgICAgICBSID0gcCAqIEEgLSB0ICogeCwKICAgICAgICAgICAgICAgICAgICBYID0gciAqIEEgLSB0ICogeSwKICAgICAgICAgICAgICAgICAgICBZID0gQiAqIE4gLSBHICogTSwKICAgICAgICAgICAgICAgICAgICBaID0gQiAqIEwgLSBJICogTSwKICAgICAgICAgICAgICAgICAgICBhYSA9IEIgKiBoIC0gSCAqIE0sCiAgICAgICAgICAgICAgICAgICAgZGEgPSBHICogTCAtIEkgKiBOLAogICAgICAgICAgICAgICAgICAgIGVhID0gRyAqIGggLSBIICogTiwKICAgICAgICAgICAgICAgICAgICBmYSA9IEkgKiBoIC0gSCAqIEwsCiAgICAgICAgICAgICAgICAgICAgYmEgPSBRICogZmEgLSBQICogZWEgKyBTICogZGEgKyBUICogYWEgLSBSICogWiArIFggKiBZOwogICAgICAgICAgICAgICAgaWYgKCFiYSkgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgICBiYSA9IDEgLyBiYTsKICAgICAgICAgICAgICAgIGZbMF0gPSAoeCAqIGZhIC0geSAqIGVhICsgQSAqIGRhKSAqIGJhOwogICAgICAgICAgICAgICAgZlsxXSA9IChyICogZWEgLSBwICogZmEgLSB0ICogZGEpICogYmE7CiAgICAgICAgICAgICAgICBmWzJdID0gKE4gKiBYIC0gTCAqIFIgKyBoICogVCkgKiBiYTsKICAgICAgICAgICAgICAgIGZbM10gPSAoSSAqIFIgLSBHICogWCAtIEggKiBUKSAqIGJhOwogICAgICAgICAgICAgICAgZls0XSA9ICh5ICogYWEgLSB2ICogZmEgLSBBICogWikgKiBiYTsKICAgICAgICAgICAgICAgIGZbNV0gPSAobCAqIGZhIC0gciAqIGFhICsgdCAqIFopICogYmE7CiAgICAgICAgICAgICAgICBmWzZdID0gKEwgKiBTIC0gTSAqIFggLSBoICogUCkgKiBiYTsKICAgICAgICAgICAgICAgIGZbN10gPSAoQiAqIFggLSBJICogUyArIEggKiBQKSAqIGJhOwogICAgICAgICAgICAgICAgZls4XSA9ICh2ICogZWEgLSB4ICogYWEgKyBBICogWSkgKiBiYTsKICAgICAgICAgICAgICAgIGZbOV0gPQogICAgICAgICAgICAgICAgICAgIChwICogYWEgLSBsICogZWEgLSB0ICogWSkgKiBiYTsKICAgICAgICAgICAgICAgIGZbMTBdID0gKE0gKiBSIC0gTiAqIFMgKyBoICogUSkgKiBiYTsKICAgICAgICAgICAgICAgIGZbMTFdID0gKEcgKiBTIC0gQiAqIFIgLSBIICogUSkgKiBiYTsKICAgICAgICAgICAgICAgIGZbMTJdID0gKHggKiBaIC0gdiAqIGRhIC0geSAqIFkpICogYmE7CiAgICAgICAgICAgICAgICBmWzEzXSA9IChsICogZGEgLSBwICogWiArIHIgKiBZKSAqIGJhOwogICAgICAgICAgICAgICAgZlsxNF0gPSAoTiAqIFAgLSBNICogVCAtIEwgKiBRKSAqIGJhOwogICAgICAgICAgICAgICAgZlsxNV0gPSAoQiAqIFQgLSBHICogUCArIEkgKiBRKSAqIGJhOwogICAgICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgYWRqb2ludDogZnVuY3Rpb24oZiwgaCkgewogICAgICAgICAgICAgICAgdmFyIGwgPSBoWzBdLAogICAgICAgICAgICAgICAgICAgIHAgPSBoWzFdLAogICAgICAgICAgICAgICAgICAgIHIgPSBoWzJdLAogICAgICAgICAgICAgICAgICAgIHQgPSBoWzNdLAogICAgICAgICAgICAgICAgICAgIHYgPSBoWzRdLAogICAgICAgICAgICAgICAgICAgIHggPSBoWzVdLAogICAgICAgICAgICAgICAgICAgIHkgPSBoWzZdLAogICAgICAgICAgICAgICAgICAgIEEgPSBoWzddLAogICAgICAgICAgICAgICAgICAgIEIgPSBoWzhdLAogICAgICAgICAgICAgICAgICAgIEcgPSBoWzldLAogICAgICAgICAgICAgICAgICAgIEkgPSBoWzEwXSwKICAgICAgICAgICAgICAgICAgICBIID0gaFsxMV0sCiAgICAgICAgICAgICAgICAgICAgTSA9IGhbMTJdLAogICAgICAgICAgICAgICAgICAgIE4gPSBoWzEzXSwKICAgICAgICAgICAgICAgICAgICBMID0gaFsxNF07CiAgICAgICAgICAgICAgICBoID0gaFsxNV07CiAgICAgICAgICAgICAgICB2YXIgUSA9IGwgKiB4IC0gcCAqIHYsCiAgICAgICAgICAgICAgICAgICAgUCA9IGwgKiB5IC0gciAqIHYsCiAgICAgICAgICAgICAgICAgICAgUyA9IGwgKiBBIC0gdCAqIHYsCiAgICAgICAgICAgICAgICAgICAgVCA9IHAgKiB5IC0gciAqIHgsCiAgICAgICAgICAgICAgICAgICAgUiA9IHAgKiBBIC0gdCAqIHgsCiAgICAgICAgICAgICAgICAgICAgWCA9IHIgKiBBIC0gdCAqIHksCiAgICAgICAgICAgICAgICAgICAgWSA9IEIgKiBOIC0gRyAqIE0sCiAgICAgICAgICAgICAgICAgICAgWiA9IEIgKiBMIC0gSSAqIE0sCiAgICAgICAgICAgICAgICAgICAgYWEgPSBCICogaCAtIEggKiBNLAogICAgICAgICAgICAgICAgICAgIGRhID0gRyAqIEwgLSBJICogTiwKICAgICAgICAgICAgICAgICAgICBlYSA9IEcgKiBoIC0gSCAqIE4sCiAgICAgICAgICAgICAgICAgICAgZmEgPSBJICogaCAtIEggKiBMOwogICAgICAgICAgICAgICAgZlswXSA9IHggKiBmYSAtIHkgKiBlYSArIEEgKiBkYTsKICAgICAgICAgICAgICAgIGZbMV0gPSByICogZWEgLSBwICogZmEgLSB0ICogZGE7CiAgICAgICAgICAgICAgICBmWzJdID0gTiAqIFggLSBMICogUiArIGggKiBUOwogICAgICAgICAgICAgICAgZlszXSA9CiAgICAgICAgICAgICAgICAgICAgSSAqIFIgLSBHICogWCAtIEggKiBUOwogICAgICAgICAgICAgICAgZls0XSA9IHkgKiBhYSAtIHYgKiBmYSAtIEEgKiBaOwogICAgICAgICAgICAgICAgZls1XSA9IGwgKiBmYSAtIHIgKiBhYSArIHQgKiBaOwogICAgICAgICAgICAgICAgZls2XSA9IEwgKiBTIC0gTSAqIFggLSBoICogUDsKICAgICAgICAgICAgICAgIGZbN10gPSBCICogWCAtIEkgKiBTICsgSCAqIFA7CiAgICAgICAgICAgICAgICBmWzhdID0gdiAqIGVhIC0geCAqIGFhICsgQSAqIFk7CiAgICAgICAgICAgICAgICBmWzldID0gcCAqIGFhIC0gbCAqIGVhIC0gdCAqIFk7CiAgICAgICAgICAgICAgICBmWzEwXSA9IE0gKiBSIC0gTiAqIFMgKyBoICogUTsKICAgICAgICAgICAgICAgIGZbMTFdID0gRyAqIFMgLSBCICogUiAtIEggKiBROwogICAgICAgICAgICAgICAgZlsxMl0gPSB4ICogWiAtIHYgKiBkYSAtIHkgKiBZOwogICAgICAgICAgICAgICAgZlsxM10gPSBsICogZGEgLSBwICogWiArIHIgKiBZOwogICAgICAgICAgICAgICAgZlsxNF0gPSBOICogUCAtIE0gKiBUIC0gTCAqIFE7CiAgICAgICAgICAgICAgICBmWzE1XSA9IEIgKiBUIC0gRyAqIFAgKyBJICogUTsKICAgICAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGRldGVybWluYW50OiBmdW5jdGlvbihmKSB7CiAgICAgICAgICAgICAgICB2YXIgaCA9IGZbMF0sCiAgICAgICAgICAgICAgICAgICAgbCA9IGZbMV0sCiAgICAgICAgICAgICAgICAgICAgcCA9IGZbMl0sCiAgICAgICAgICAgICAgICAgICAgciA9IGZbNF0sCiAgICAgICAgICAgICAgICAgICAgdCA9IGZbNV0sCiAgICAgICAgICAgICAgICAgICAgdiA9IGZbNl0sCiAgICAgICAgICAgICAgICAgICAgeCA9IGZbOF0sCiAgICAgICAgICAgICAgICAgICAgeSA9IGZbOV0sCiAgICAgICAgICAgICAgICAgICAgQSA9IGZbMTBdLAogICAgICAgICAgICAgICAgICAgIEIgPSBmWzEyXSwKICAgICAgICAgICAgICAgICAgICBHID0gZlsxM10sCiAgICAgICAgICAgICAgICAgICAgSSA9IGZbMTRdLAogICAgICAgICAgICAgICAgICAgIEggPSBoICogdCAtIGwgKiByLAogICAgICAgICAgICAgICAgICAgIE0gPSBoICogdiAtIHAgKiByLAogICAgICAgICAgICAgICAgICAgIE4gPSBsICogdiAtIHAgKiB0LAogICAgICAgICAgICAgICAgICAgIEwgPSB4ICogRyAtIHkgKiBCLAogICAgICAgICAgICAgICAgICAgIFEgPSB4ICogSSAtIEEgKiBCLAogICAgICAgICAgICAgICAgICAgIFAgPSB5ICogSSAtIEEgKiBHOwogICAgICAgICAgICAgICAgcmV0dXJuIGZbN10gKiAoaCAqIFAgLSBsICogUSArIHAgKiBMKSAtIGZbM10gKiAociAqIFAgLSB0ICogUSArIHYgKiBMKSArIGZbMTVdICogKHggKiBOIC0geSAqIE0gKyBBICogSCkgLSBmWzExXSAqIChCICogTiAtIEcgKiBNICsgSSAqIEgpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG11bHRpcGx5OiBxLAogICAgICAgICAgICB0cmFuc2xhdGU6IGZ1bmN0aW9uKGYsIGgsIGwpIHsKICAgICAgICAgICAgICAgIHZhciBwID0gbFswXSwKICAgICAgICAgICAgICAgICAgICByID0gbFsxXTsKICAgICAgICAgICAgICAgIGwgPSBsWzJdOwogICAgICAgICAgICAgICAgaWYgKGggPT09IGYpIGZbMTJdID0gaFswXSAqIHAgKyBoWzRdICogciArIGhbOF0gKiBsICsgaFsxMl0sIGZbMTNdID0gaFsxXSAqIHAgKyBoWzVdICogciArIGhbOV0gKiBsICsgaFsxM10sIGZbMTRdID0gaFsyXSAqIHAgKyBoWzZdICogciArIGhbMTBdICogbCArIGhbMTRdLCBmWzE1XSA9IGhbM10gKiBwICsgaFs3XSAqIHIgKyBoWzExXSAqIGwgKyBoWzE1XTsKICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIHZhciB0ID0gaFswXTsKICAgICAgICAgICAgICAgICAgICB2YXIgdiA9IGhbMV07CiAgICAgICAgICAgICAgICAgICAgdmFyIHggPSBoWzJdOwogICAgICAgICAgICAgICAgICAgIHZhciB5ID0gaFszXTsKICAgICAgICAgICAgICAgICAgICB2YXIgQSA9IGhbNF07CiAgICAgICAgICAgICAgICAgICAgdmFyIEIgPSBoWzVdOwogICAgICAgICAgICAgICAgICAgIHZhciBHID0gaFs2XTsKICAgICAgICAgICAgICAgICAgICB2YXIgSSA9IGhbN107CiAgICAgICAgICAgICAgICAgICAgdmFyIEggPSBoWzhdOwogICAgICAgICAgICAgICAgICAgIHZhciBNID0gaFs5XTsKICAgICAgICAgICAgICAgICAgICB2YXIgTiA9IGhbMTBdOwogICAgICAgICAgICAgICAgICAgIHZhciBMID0gaFsxMV07CiAgICAgICAgICAgICAgICAgICAgZlswXSA9IHQ7CiAgICAgICAgICAgICAgICAgICAgZlsxXSA9IHY7CiAgICAgICAgICAgICAgICAgICAgZlsyXSA9IHg7CiAgICAgICAgICAgICAgICAgICAgZlszXSA9IHk7CiAgICAgICAgICAgICAgICAgICAgZls0XSA9IEE7CiAgICAgICAgICAgICAgICAgICAgZls1XSA9IEI7CiAgICAgICAgICAgICAgICAgICAgZls2XSA9IEc7CiAgICAgICAgICAgICAgICAgICAgZls3XSA9IEk7CiAgICAgICAgICAgICAgICAgICAgZls4XSA9IEg7CiAgICAgICAgICAgICAgICAgICAgZls5XSA9IE07CiAgICAgICAgICAgICAgICAgICAgZlsxMF0gPSBOOwogICAgICAgICAgICAgICAgICAgIGZbMTFdID0gTDsKICAgICAgICAgICAgICAgICAgICBmWzEyXSA9IHQgKiBwICsgQSAqIHIgKyBIICogbCArIGhbMTJdOwogICAgICAgICAgICAgICAgICAgIGZbMTNdID0gdiAqIHAgKyBCICogciArIE0gKiBsICsgaFsxM107CiAgICAgICAgICAgICAgICAgICAgZlsxNF0gPSB4ICogcCArIEcgKiByICsgTiAqIGwgKyBoWzE0XTsKICAgICAgICAgICAgICAgICAgICBmWzE1XSA9IHkgKiBwICsgSSAqIHIgKyBMICogbCArIGhbMTVdCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gZgogICAgICAgICAgICB9LAogICAgICAgICAgICBzY2FsZTogZnVuY3Rpb24oZiwgaCwgbCkgewogICAgICAgICAgICAgICAgdmFyIHAgPSBsWzBdLAogICAgICAgICAgICAgICAgICAgIHIgPSBsWzFdOwogICAgICAgICAgICAgICAgbCA9IGxbMl07CiAgICAgICAgICAgICAgICBmWzBdID0gaFswXSAqIHA7CiAgICAgICAgICAgICAgICBmWzFdID0gaFsxXSAqIHA7CiAgICAgICAgICAgICAgICBmWzJdID0gaFsyXSAqIHA7CiAgICAgICAgICAgICAgICBmWzNdID0gaFszXSAqIHA7CiAgICAgICAgICAgICAgICBmWzRdID0gaFs0XSAqIHI7CiAgICAgICAgICAgICAgICBmWzVdID0gaFs1XSAqIHI7CiAgICAgICAgICAgICAgICBmWzZdID0gaFs2XSAqIHI7CiAgICAgICAgICAgICAgICBmWzddID0gaFs3XSAqIHI7CiAgICAgICAgICAgICAgICBmWzhdID0gaFs4XSAqIGw7CiAgICAgICAgICAgICAgICBmWzldID0gaFs5XSAqIGw7CiAgICAgICAgICAgICAgICBmWzEwXSA9IGhbMTBdICogbDsKICAgICAgICAgICAgICAgIGZbMTFdID0gaFsxMV0gKiBsOwogICAgICAgICAgICAgICAgZlsxMl0gPSBoWzEyXTsKICAgICAgICAgICAgICAgIGZbMTNdID0gaFsxM107CiAgICAgICAgICAgICAgICBmWzE0XSA9IGhbMTRdOwogICAgICAgICAgICAgICAgZlsxNV0gPSBoWzE1XTsKICAgICAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHJvdGF0ZTogZnVuY3Rpb24oZiwgaCwgbCwgcCkgewogICAgICAgICAgICAgICAgdmFyIHIgPSBwWzBdLAogICAgICAgICAgICAgICAgICAgIHQgPSBwWzFdOwogICAgICAgICAgICAgICAgcCA9IHBbMl07CiAgICAgICAgICAgICAgICB2YXIgdiA9IE1hdGguaHlwb3QociwgdCwgcCk7CiAgICAgICAgICAgICAgICBpZiAoMUUtNiA+IHYpIHJldHVybiBudWxsOwogICAgICAgICAgICAgICAgdiA9IDEgLyB2OwogICAgICAgICAgICAgICAgciAqPSB2OwogICAgICAgICAgICAgICAgdCAqPSB2OwogICAgICAgICAgICAgICAgcCAqPSB2OwogICAgICAgICAgICAgICAgdmFyIHggPSBNYXRoLnNpbihsKTsKICAgICAgICAgICAgICAgIHZhciB5ID0gTWF0aC5jb3MobCk7CiAgICAgICAgICAgICAgICB2YXIgQSA9IDEgLSB5OwogICAgICAgICAgICAgICAgbCA9IGhbMF07CiAgICAgICAgICAgICAgICB2ID0gaFsxXTsKICAgICAgICAgICAgICAgIHZhciBCID0gaFsyXTsKICAgICAgICAgICAgICAgIHZhciBHID0gaFszXTsKICAgICAgICAgICAgICAgIHZhciBJID0gaFs0XTsKICAgICAgICAgICAgICAgIHZhciBIID0KICAgICAgICAgICAgICAgICAgICBoWzVdOwogICAgICAgICAgICAgICAgdmFyIE0gPSBoWzZdOwogICAgICAgICAgICAgICAgdmFyIE4gPSBoWzddOwogICAgICAgICAgICAgICAgdmFyIEwgPSBoWzhdOwogICAgICAgICAgICAgICAgdmFyIFEgPSBoWzldOwogICAgICAgICAgICAgICAgdmFyIFAgPSBoWzEwXTsKICAgICAgICAgICAgICAgIHZhciBTID0gaFsxMV07CiAgICAgICAgICAgICAgICB2YXIgVCA9IHIgKiByICogQSArIHk7CiAgICAgICAgICAgICAgICB2YXIgUiA9IHQgKiByICogQSArIHAgKiB4OwogICAgICAgICAgICAgICAgdmFyIFggPSBwICogciAqIEEgLSB0ICogeDsKICAgICAgICAgICAgICAgIHZhciBZID0gciAqIHQgKiBBIC0gcCAqIHg7CiAgICAgICAgICAgICAgICB2YXIgWiA9IHQgKiB0ICogQSArIHk7CiAgICAgICAgICAgICAgICB2YXIgYWEgPSBwICogdCAqIEEgKyByICogeDsKICAgICAgICAgICAgICAgIHZhciBkYSA9IHIgKiBwICogQSArIHQgKiB4OwogICAgICAgICAgICAgICAgciA9IHQgKiBwICogQSAtIHIgKiB4OwogICAgICAgICAgICAgICAgdCA9IHAgKiBwICogQSArIHk7CiAgICAgICAgICAgICAgICBmWzBdID0gbCAqIFQgKyBJICogUiArIEwgKiBYOwogICAgICAgICAgICAgICAgZlsxXSA9IHYgKiBUICsgSCAqIFIgKyBRICogWDsKICAgICAgICAgICAgICAgIGZbMl0gPSBCICogVCArIE0gKiBSICsgUCAqIFg7CiAgICAgICAgICAgICAgICBmWzNdID0gRyAqIFQgKyBOICogUiArIFMgKiBYOwogICAgICAgICAgICAgICAgZls0XSA9IGwgKiBZICsgSSAqIFogKyBMICogYWE7CiAgICAgICAgICAgICAgICBmWzVdID0gdiAqIFkgKyBIICogWiArIFEgKiBhYTsKICAgICAgICAgICAgICAgIGZbNl0gPSBCICogWSArIE0gKiBaICsgUCAqIGFhOwogICAgICAgICAgICAgICAgZls3XSA9IEcgKiBZICsgTiAqIFogKyBTICogYWE7CiAgICAgICAgICAgICAgICBmWzhdID0gbCAqIGRhICsgSSAqIHIgKyBMICogdDsKICAgICAgICAgICAgICAgIGZbOV0gPSB2ICogZGEgKyBIICogciArIFEgKiB0OwogICAgICAgICAgICAgICAgZlsxMF0gPSBCICogZGEgKyBNICogciArIFAgKiB0OwogICAgICAgICAgICAgICAgZlsxMV0gPSBHICogZGEgKyBOICogciArIFMgKiB0OwogICAgICAgICAgICAgICAgaCAhPT0gZiAmJiAoZlsxMl0gPSBoWzEyXSwgZlsxM10gPSBoWzEzXSwgZlsxNF0gPSBoWzE0XSwgZlsxNV0gPSBoWzE1XSk7CiAgICAgICAgICAgICAgICByZXR1cm4gZgogICAgICAgICAgICB9LAogICAgICAgICAgICByb3RhdGVYOiBmdW5jdGlvbihmLAogICAgICAgICAgICAgICAgaCwgbCkgewogICAgICAgICAgICAgICAgdmFyIHAgPSBNYXRoLnNpbihsKTsKICAgICAgICAgICAgICAgIGwgPSBNYXRoLmNvcyhsKTsKICAgICAgICAgICAgICAgIHZhciByID0gaFs0XSwKICAgICAgICAgICAgICAgICAgICB0ID0gaFs1XSwKICAgICAgICAgICAgICAgICAgICB2ID0gaFs2XSwKICAgICAgICAgICAgICAgICAgICB4ID0gaFs3XSwKICAgICAgICAgICAgICAgICAgICB5ID0gaFs4XSwKICAgICAgICAgICAgICAgICAgICBBID0gaFs5XSwKICAgICAgICAgICAgICAgICAgICBCID0gaFsxMF0sCiAgICAgICAgICAgICAgICAgICAgRyA9IGhbMTFdOwogICAgICAgICAgICAgICAgaCAhPT0gZiAmJiAoZlswXSA9IGhbMF0sIGZbMV0gPSBoWzFdLCBmWzJdID0gaFsyXSwgZlszXSA9IGhbM10sIGZbMTJdID0gaFsxMl0sIGZbMTNdID0gaFsxM10sIGZbMTRdID0gaFsxNF0sIGZbMTVdID0gaFsxNV0pOwogICAgICAgICAgICAgICAgZls0XSA9IHIgKiBsICsgeSAqIHA7CiAgICAgICAgICAgICAgICBmWzVdID0gdCAqIGwgKyBBICogcDsKICAgICAgICAgICAgICAgIGZbNl0gPSB2ICogbCArIEIgKiBwOwogICAgICAgICAgICAgICAgZls3XSA9IHggKiBsICsgRyAqIHA7CiAgICAgICAgICAgICAgICBmWzhdID0geSAqIGwgLSByICogcDsKICAgICAgICAgICAgICAgIGZbOV0gPSBBICogbCAtIHQgKiBwOwogICAgICAgICAgICAgICAgZlsxMF0gPSBCICogbCAtIHYgKiBwOwogICAgICAgICAgICAgICAgZlsxMV0gPSBHICogbCAtIHggKiBwOwogICAgICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgcm90YXRlWTogZnVuY3Rpb24oZiwgaCwgbCkgewogICAgICAgICAgICAgICAgdmFyIHAgPSBNYXRoLnNpbihsKTsKICAgICAgICAgICAgICAgIGwgPSBNYXRoLmNvcyhsKTsKICAgICAgICAgICAgICAgIHZhciByID0gaFswXSwKICAgICAgICAgICAgICAgICAgICB0ID0gaFsxXSwKICAgICAgICAgICAgICAgICAgICB2ID0gaFsyXSwKICAgICAgICAgICAgICAgICAgICB4ID0gaFszXSwKICAgICAgICAgICAgICAgICAgICB5ID0gaFs4XSwKICAgICAgICAgICAgICAgICAgICBBID0gaFs5XSwKICAgICAgICAgICAgICAgICAgICBCID0gaFsxMF0sCiAgICAgICAgICAgICAgICAgICAgRyA9IGhbMTFdOwogICAgICAgICAgICAgICAgaCAhPT0gZiAmJiAoZls0XSA9IGhbNF0sIGZbNV0gPSBoWzVdLCBmWzZdID0gaFs2XSwgZls3XSA9IGhbN10sIGZbMTJdID0gaFsxMl0sIGZbMTNdID0gaFsxM10sCiAgICAgICAgICAgICAgICAgICAgZlsxNF0gPSBoWzE0XSwgZlsxNV0gPSBoWzE1XSk7CiAgICAgICAgICAgICAgICBmWzBdID0gciAqIGwgLSB5ICogcDsKICAgICAgICAgICAgICAgIGZbMV0gPSB0ICogbCAtIEEgKiBwOwogICAgICAgICAgICAgICAgZlsyXSA9IHYgKiBsIC0gQiAqIHA7CiAgICAgICAgICAgICAgICBmWzNdID0geCAqIGwgLSBHICogcDsKICAgICAgICAgICAgICAgIGZbOF0gPSByICogcCArIHkgKiBsOwogICAgICAgICAgICAgICAgZls5XSA9IHQgKiBwICsgQSAqIGw7CiAgICAgICAgICAgICAgICBmWzEwXSA9IHYgKiBwICsgQiAqIGw7CiAgICAgICAgICAgICAgICBmWzExXSA9IHggKiBwICsgRyAqIGw7CiAgICAgICAgICAgICAgICByZXR1cm4gZgogICAgICAgICAgICB9LAogICAgICAgICAgICByb3RhdGVaOiBmdW5jdGlvbihmLCBoLCBsKSB7CiAgICAgICAgICAgICAgICB2YXIgcCA9IE1hdGguc2luKGwpOwogICAgICAgICAgICAgICAgbCA9IE1hdGguY29zKGwpOwogICAgICAgICAgICAgICAgdmFyIHIgPSBoWzBdLAogICAgICAgICAgICAgICAgICAgIHQgPSBoWzFdLAogICAgICAgICAgICAgICAgICAgIHYgPSBoWzJdLAogICAgICAgICAgICAgICAgICAgIHggPSBoWzNdLAogICAgICAgICAgICAgICAgICAgIHkgPSBoWzRdLAogICAgICAgICAgICAgICAgICAgIEEgPSBoWzVdLAogICAgICAgICAgICAgICAgICAgIEIgPSBoWzZdLAogICAgICAgICAgICAgICAgICAgIEcgPSBoWzddOwogICAgICAgICAgICAgICAgaCAhPT0gZiAmJiAoZls4XSA9IGhbOF0sIGZbOV0gPSBoWzldLCBmWzEwXSA9IGhbMTBdLCBmWzExXSA9IGhbMTFdLCBmWzEyXSA9IGhbMTJdLCBmWzEzXSA9IGhbMTNdLCBmWzE0XSA9IGhbMTRdLCBmWzE1XSA9IGhbMTVdKTsKICAgICAgICAgICAgICAgIGZbMF0gPSByICogbCArIHkgKiBwOwogICAgICAgICAgICAgICAgZlsxXSA9IHQgKiBsICsgQSAqIHA7CiAgICAgICAgICAgICAgICBmWzJdID0gdiAqIGwgKyBCICogcDsKICAgICAgICAgICAgICAgIGZbM10gPSB4ICogbCArIEcgKiBwOwogICAgICAgICAgICAgICAgZls0XSA9IHkgKiBsIC0gciAqIHA7CiAgICAgICAgICAgICAgICBmWzVdID0gQSAqIGwgLSB0ICogcDsKICAgICAgICAgICAgICAgIGZbNl0gPSBCICogbCAtIHYgKiBwOwogICAgICAgICAgICAgICAgZls3XSA9IEcgKiBsIC0geCAqIHA7CiAgICAgICAgICAgICAgICByZXR1cm4gZgogICAgICAgICAgICB9LAogICAgICAgICAgICBmcm9tVHJhbnNsYXRpb246IGZ1bmN0aW9uKGYsIGgpIHsKICAgICAgICAgICAgICAgIGZbMF0gPQogICAgICAgICAgICAgICAgICAgIDE7CiAgICAgICAgICAgICAgICBmWzFdID0gMDsKICAgICAgICAgICAgICAgIGZbMl0gPSAwOwogICAgICAgICAgICAgICAgZlszXSA9IDA7CiAgICAgICAgICAgICAgICBmWzRdID0gMDsKICAgICAgICAgICAgICAgIGZbNV0gPSAxOwogICAgICAgICAgICAgICAgZls2XSA9IDA7CiAgICAgICAgICAgICAgICBmWzddID0gMDsKICAgICAgICAgICAgICAgIGZbOF0gPSAwOwogICAgICAgICAgICAgICAgZls5XSA9IDA7CiAgICAgICAgICAgICAgICBmWzEwXSA9IDE7CiAgICAgICAgICAgICAgICBmWzExXSA9IDA7CiAgICAgICAgICAgICAgICBmWzEyXSA9IGhbMF07CiAgICAgICAgICAgICAgICBmWzEzXSA9IGhbMV07CiAgICAgICAgICAgICAgICBmWzE0XSA9IGhbMl07CiAgICAgICAgICAgICAgICBmWzE1XSA9IDE7CiAgICAgICAgICAgICAgICByZXR1cm4gZgogICAgICAgICAgICB9LAogICAgICAgICAgICBmcm9tU2NhbGluZzogZnVuY3Rpb24oZiwgaCkgewogICAgICAgICAgICAgICAgZlswXSA9IGhbMF07CiAgICAgICAgICAgICAgICBmWzFdID0gMDsKICAgICAgICAgICAgICAgIGZbMl0gPSAwOwogICAgICAgICAgICAgICAgZlszXSA9IDA7CiAgICAgICAgICAgICAgICBmWzRdID0gMDsKICAgICAgICAgICAgICAgIGZbNV0gPSBoWzFdOwogICAgICAgICAgICAgICAgZls2XSA9IDA7CiAgICAgICAgICAgICAgICBmWzddID0gMDsKICAgICAgICAgICAgICAgIGZbOF0gPSAwOwogICAgICAgICAgICAgICAgZls5XSA9IDA7CiAgICAgICAgICAgICAgICBmWzEwXSA9IGhbMl07CiAgICAgICAgICAgICAgICBmWzExXSA9IDA7CiAgICAgICAgICAgICAgICBmWzEyXSA9IDA7CiAgICAgICAgICAgICAgICBmWzEzXSA9IDA7CiAgICAgICAgICAgICAgICBmWzE0XSA9IDA7CiAgICAgICAgICAgICAgICBmWzE1XSA9IDE7CiAgICAgICAgICAgICAgICByZXR1cm4gZgogICAgICAgICAgICB9LAogICAgICAgICAgICBmcm9tUm90YXRpb246IGZ1bmN0aW9uKGYsIGgsIGwpIHsKICAgICAgICAgICAgICAgIHZhciBwID0gbFswXSwKICAgICAgICAgICAgICAgICAgICByID0gbFsxXTsKICAgICAgICAgICAgICAgIGwgPSBsWzJdOwogICAgICAgICAgICAgICAgdmFyIHQgPSBNYXRoLmh5cG90KHAsIHIsIGwpOwogICAgICAgICAgICAgICAgaWYgKDFFLTYgPiB0KSByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICAgIHQgPSAxIC8gdDsKICAgICAgICAgICAgICAgIHAgKj0gdDsKICAgICAgICAgICAgICAgIHIgKj0gdDsKICAgICAgICAgICAgICAgIGwgKj0gdDsKICAgICAgICAgICAgICAgIHQgPSBNYXRoLnNpbihoKTsKICAgICAgICAgICAgICAgIGggPSBNYXRoLmNvcyhoKTsKICAgICAgICAgICAgICAgIHZhciB2ID0gMSAtIGg7CiAgICAgICAgICAgICAgICBmWzBdID0gcCAqIHAgKiB2ICsgaDsKICAgICAgICAgICAgICAgIGZbMV0gPSByICogcCAqIHYgKyBsICogdDsKICAgICAgICAgICAgICAgIGZbMl0gPSBsICogcCAqIHYgLSByICogdDsKICAgICAgICAgICAgICAgIGZbM10gPQogICAgICAgICAgICAgICAgICAgIDA7CiAgICAgICAgICAgICAgICBmWzRdID0gcCAqIHIgKiB2IC0gbCAqIHQ7CiAgICAgICAgICAgICAgICBmWzVdID0gciAqIHIgKiB2ICsgaDsKICAgICAgICAgICAgICAgIGZbNl0gPSBsICogciAqIHYgKyBwICogdDsKICAgICAgICAgICAgICAgIGZbN10gPSAwOwogICAgICAgICAgICAgICAgZls4XSA9IHAgKiBsICogdiArIHIgKiB0OwogICAgICAgICAgICAgICAgZls5XSA9IHIgKiBsICogdiAtIHAgKiB0OwogICAgICAgICAgICAgICAgZlsxMF0gPSBsICogbCAqIHYgKyBoOwogICAgICAgICAgICAgICAgZlsxMV0gPSAwOwogICAgICAgICAgICAgICAgZlsxMl0gPSAwOwogICAgICAgICAgICAgICAgZlsxM10gPSAwOwogICAgICAgICAgICAgICAgZlsxNF0gPSAwOwogICAgICAgICAgICAgICAgZlsxNV0gPSAxOwogICAgICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZnJvbVhSb3RhdGlvbjogZnVuY3Rpb24oZiwgaCkgewogICAgICAgICAgICAgICAgdmFyIGwgPSBNYXRoLnNpbihoKTsKICAgICAgICAgICAgICAgIGggPSBNYXRoLmNvcyhoKTsKICAgICAgICAgICAgICAgIGZbMF0gPSAxOwogICAgICAgICAgICAgICAgZlsxXSA9IDA7CiAgICAgICAgICAgICAgICBmWzJdID0gMDsKICAgICAgICAgICAgICAgIGZbM10gPSAwOwogICAgICAgICAgICAgICAgZls0XSA9IDA7CiAgICAgICAgICAgICAgICBmWzVdID0gaDsKICAgICAgICAgICAgICAgIGZbNl0gPSBsOwogICAgICAgICAgICAgICAgZls3XSA9IDA7CiAgICAgICAgICAgICAgICBmWzhdID0gMDsKICAgICAgICAgICAgICAgIGZbOV0gPSAtbDsKICAgICAgICAgICAgICAgIGZbMTBdID0gaDsKICAgICAgICAgICAgICAgIGZbMTFdID0gMDsKICAgICAgICAgICAgICAgIGZbMTJdID0gMDsKICAgICAgICAgICAgICAgIGZbMTNdID0gMDsKICAgICAgICAgICAgICAgIGZbMTRdID0gMDsKICAgICAgICAgICAgICAgIGZbMTVdID0gMTsKICAgICAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGZyb21ZUm90YXRpb246IGZ1bmN0aW9uKGYsIGgpIHsKICAgICAgICAgICAgICAgIHZhciBsID0gTWF0aC5zaW4oaCk7CiAgICAgICAgICAgICAgICBoID0gTWF0aC5jb3MoaCk7CiAgICAgICAgICAgICAgICBmWzBdID0gaDsKICAgICAgICAgICAgICAgIGZbMV0gPSAwOwogICAgICAgICAgICAgICAgZlsyXSA9IC1sOwogICAgICAgICAgICAgICAgZlszXSA9IDA7CiAgICAgICAgICAgICAgICBmWzRdID0gMDsKICAgICAgICAgICAgICAgIGZbNV0gPSAxOwogICAgICAgICAgICAgICAgZls2XSA9IDA7CiAgICAgICAgICAgICAgICBmWzddID0gMDsKICAgICAgICAgICAgICAgIGZbOF0gPSBsOwogICAgICAgICAgICAgICAgZls5XSA9IDA7CiAgICAgICAgICAgICAgICBmWzEwXSA9IGg7CiAgICAgICAgICAgICAgICBmWzExXSA9IDA7CiAgICAgICAgICAgICAgICBmWzEyXSA9IDA7CiAgICAgICAgICAgICAgICBmWzEzXSA9IDA7CiAgICAgICAgICAgICAgICBmWzE0XSA9CiAgICAgICAgICAgICAgICAgICAgMDsKICAgICAgICAgICAgICAgIGZbMTVdID0gMTsKICAgICAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGZyb21aUm90YXRpb246IGZ1bmN0aW9uKGYsIGgpIHsKICAgICAgICAgICAgICAgIHZhciBsID0gTWF0aC5zaW4oaCk7CiAgICAgICAgICAgICAgICBoID0gTWF0aC5jb3MoaCk7CiAgICAgICAgICAgICAgICBmWzBdID0gaDsKICAgICAgICAgICAgICAgIGZbMV0gPSBsOwogICAgICAgICAgICAgICAgZlsyXSA9IDA7CiAgICAgICAgICAgICAgICBmWzNdID0gMDsKICAgICAgICAgICAgICAgIGZbNF0gPSAtbDsKICAgICAgICAgICAgICAgIGZbNV0gPSBoOwogICAgICAgICAgICAgICAgZls2XSA9IDA7CiAgICAgICAgICAgICAgICBmWzddID0gMDsKICAgICAgICAgICAgICAgIGZbOF0gPSAwOwogICAgICAgICAgICAgICAgZls5XSA9IDA7CiAgICAgICAgICAgICAgICBmWzEwXSA9IDE7CiAgICAgICAgICAgICAgICBmWzExXSA9IDA7CiAgICAgICAgICAgICAgICBmWzEyXSA9IDA7CiAgICAgICAgICAgICAgICBmWzEzXSA9IDA7CiAgICAgICAgICAgICAgICBmWzE0XSA9IDA7CiAgICAgICAgICAgICAgICBmWzE1XSA9IDE7CiAgICAgICAgICAgICAgICByZXR1cm4gZgogICAgICAgICAgICB9LAogICAgICAgICAgICBmcm9tUm90YXRpb25UcmFuc2xhdGlvbjogdSwKICAgICAgICAgICAgZnJvbVF1YXQyOiBmdW5jdGlvbihmLCBoKSB7CiAgICAgICAgICAgICAgICB2YXIgbCA9IG5ldyBVKDMpLAogICAgICAgICAgICAgICAgICAgIHAgPSAtaFswXSwKICAgICAgICAgICAgICAgICAgICByID0gLWhbMV0sCiAgICAgICAgICAgICAgICAgICAgdCA9IC1oWzJdLAogICAgICAgICAgICAgICAgICAgIHYgPSBoWzNdLAogICAgICAgICAgICAgICAgICAgIHggPSBoWzRdLAogICAgICAgICAgICAgICAgICAgIHkgPSBoWzVdLAogICAgICAgICAgICAgICAgICAgIEEgPSBoWzZdLAogICAgICAgICAgICAgICAgICAgIEIgPSBoWzddLAogICAgICAgICAgICAgICAgICAgIEcgPSBwICogcCArIHIgKiByICsgdCAqIHQgKyB2ICogdjsKICAgICAgICAgICAgICAgIDAgPCBHID8gKGxbMF0gPSAyICogKHggKiB2ICsgQiAqIHAgKyB5ICogdCAtIEEgKiByKSAvIEcsIGxbMV0gPSAyICogKHkgKiB2ICsgQiAqIHIgKyBBICogcCAtIHggKiB0KSAvIEcsIGxbMl0gPSAyICogKEEgKiB2ICsgQiAqIHQgKyB4ICogciAtIHkgKiBwKSAvIEcpIDogKGxbMF0gPSAyICogKHggKiB2ICsgQiAqIHAgKyB5ICogdCAtIEEgKiByKSwgbFsxXSA9IDIgKiAoeSAqIHYgKyBCICogciArIEEgKiBwIC0geCAqIHQpLCBsWzJdID0gMiAqIChBICogdiArCiAgICAgICAgICAgICAgICAgICAgQiAqIHQgKyB4ICogciAtIHkgKiBwKSk7CiAgICAgICAgICAgICAgICB1KGYsIGgsIGwpOwogICAgICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZ2V0VHJhbnNsYXRpb246IHcsCiAgICAgICAgICAgIGdldFNjYWxpbmc6IHosCiAgICAgICAgICAgIGdldFJvdGF0aW9uOiBDLAogICAgICAgICAgICBkZWNvbXBvc2U6IGZ1bmN0aW9uKGYsIGgsIGwsIHApIHsKICAgICAgICAgICAgICAgIGhbMF0gPSBwWzEyXTsKICAgICAgICAgICAgICAgIGhbMV0gPSBwWzEzXTsKICAgICAgICAgICAgICAgIGhbMl0gPSBwWzE0XTsKICAgICAgICAgICAgICAgIHZhciByID0gcFswXSwKICAgICAgICAgICAgICAgICAgICB0ID0gcFsxXSwKICAgICAgICAgICAgICAgICAgICB2ID0gcFsyXSwKICAgICAgICAgICAgICAgICAgICB4ID0gcFs0XSwKICAgICAgICAgICAgICAgICAgICB5ID0gcFs1XSwKICAgICAgICAgICAgICAgICAgICBBID0gcFs2XSwKICAgICAgICAgICAgICAgICAgICBCID0gcFs4XTsKICAgICAgICAgICAgICAgIGggPSBwWzldOwogICAgICAgICAgICAgICAgcCA9IHBbMTBdOwogICAgICAgICAgICAgICAgbFswXSA9IE1hdGguaHlwb3QociwgdCwgdik7CiAgICAgICAgICAgICAgICBsWzFdID0gTWF0aC5oeXBvdCh4LCB5LCBBKTsKICAgICAgICAgICAgICAgIGxbMl0gPSBNYXRoLmh5cG90KEIsIGgsIHApOwogICAgICAgICAgICAgICAgdmFyIEcgPSAxIC8gbFswXSwKICAgICAgICAgICAgICAgICAgICBJID0gMSAvIGxbMV0sCiAgICAgICAgICAgICAgICAgICAgSCA9IDEgLyBsWzJdOwogICAgICAgICAgICAgICAgbCA9IHIgKiBHOwogICAgICAgICAgICAgICAgdCAqPSBJOwogICAgICAgICAgICAgICAgdiAqPSBIOwogICAgICAgICAgICAgICAgeCAqPSBHOwogICAgICAgICAgICAgICAgeSAqPSBJOwogICAgICAgICAgICAgICAgQSAqPSBIOwogICAgICAgICAgICAgICAgQiAqPSBHOwogICAgICAgICAgICAgICAgaCAqPSBJOwogICAgICAgICAgICAgICAgcCAqPSBIOwogICAgICAgICAgICAgICAgSSA9IGwgKyB5ICsgcDsKICAgICAgICAgICAgICAgIDAgPCBJID8gKHAgPSAyICogTWF0aC5zcXJ0KEkgKyAxKSwgZlszXSA9IC4yNSAqIHAsIGZbMF0gPSAoQSAtIGgpIC8gcCwgZlsxXSA9IChCIC0gdikgLyBwLCBmWzJdID0gKHQgLSB4KSAvIHApIDogbCA+IHkgJiYgbCA+IHAgPyAocCA9IDIgKiBNYXRoLnNxcnQoMSArIGwgLSB5IC0gcCksIGZbM10gPSAoQSAtIGgpIC8gcCwgZlswXSA9IC4yNSAqIHAsIGZbMV0gPSAodCArIHgpIC8KICAgICAgICAgICAgICAgICAgICBwLCBmWzJdID0gKEIgKyB2KSAvIHApIDogeSA+IHAgPyAocCA9IDIgKiBNYXRoLnNxcnQoMSArIHkgLSBsIC0gcCksIGZbM10gPSAoQiAtIHYpIC8gcCwgZlswXSA9ICh0ICsgeCkgLyBwLCBmWzFdID0gLjI1ICogcCwgZlsyXSA9IChBICsgaCkgLyBwKSA6IChwID0gMiAqIE1hdGguc3FydCgxICsgcCAtIGwgLSB5KSwgZlszXSA9ICh0IC0geCkgLyBwLCBmWzBdID0gKEIgKyB2KSAvIHAsIGZbMV0gPSAoQSArIGgpIC8gcCwgZlsyXSA9IC4yNSAqIHApOwogICAgICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZnJvbVJvdGF0aW9uVHJhbnNsYXRpb25TY2FsZTogZnVuY3Rpb24oZiwgaCwgbCwgcCkgewogICAgICAgICAgICAgICAgdmFyIHIgPSBoWzBdLAogICAgICAgICAgICAgICAgICAgIHQgPSBoWzFdLAogICAgICAgICAgICAgICAgICAgIHYgPSBoWzJdLAogICAgICAgICAgICAgICAgICAgIHggPSBoWzNdLAogICAgICAgICAgICAgICAgICAgIHkgPSByICsgciwKICAgICAgICAgICAgICAgICAgICBBID0gdCArIHQsCiAgICAgICAgICAgICAgICAgICAgQiA9IHYgKyB2OwogICAgICAgICAgICAgICAgaCA9IHIgKiB5OwogICAgICAgICAgICAgICAgdmFyIEcgPSByICogQTsKICAgICAgICAgICAgICAgIHIgKj0gQjsKICAgICAgICAgICAgICAgIHZhciBJID0gdCAqIEE7CiAgICAgICAgICAgICAgICB0ICo9IEI7CiAgICAgICAgICAgICAgICB2ICo9IEI7CiAgICAgICAgICAgICAgICB5ICo9IHg7CiAgICAgICAgICAgICAgICBBICo9IHg7CiAgICAgICAgICAgICAgICB4ICo9IEI7CiAgICAgICAgICAgICAgICBCID0gcFswXTsKICAgICAgICAgICAgICAgIHZhciBIID0gcFsxXTsKICAgICAgICAgICAgICAgIHAgPSBwWzJdOwogICAgICAgICAgICAgICAgZlswXSA9ICgxIC0gKEkgKyB2KSkgKiBCOwogICAgICAgICAgICAgICAgZlsxXSA9IChHICsgeCkgKiBCOwogICAgICAgICAgICAgICAgZlsyXSA9IChyIC0gQSkgKiBCOwogICAgICAgICAgICAgICAgZlszXSA9IDA7CiAgICAgICAgICAgICAgICBmWzRdID0gKEcgLSB4KSAqIEg7CiAgICAgICAgICAgICAgICBmWzVdID0gKDEgLSAoaCArIHYpKSAqIEg7CiAgICAgICAgICAgICAgICBmWzZdID0gKHQgKyB5KSAqIEg7CiAgICAgICAgICAgICAgICBmWzddID0gMDsKICAgICAgICAgICAgICAgIGZbOF0gPSAociArIEEpICogcDsKICAgICAgICAgICAgICAgIGZbOV0gPSAodCAtIHkpICogcDsKICAgICAgICAgICAgICAgIGZbMTBdID0gKDEgLSAoaCArIEkpKSAqIHA7CiAgICAgICAgICAgICAgICBmWzExXSA9IDA7CiAgICAgICAgICAgICAgICBmWzEyXSA9IGxbMF07CiAgICAgICAgICAgICAgICBmWzEzXSA9IGxbMV07CiAgICAgICAgICAgICAgICBmWzE0XSA9IGxbMl07CiAgICAgICAgICAgICAgICBmWzE1XSA9IDE7CiAgICAgICAgICAgICAgICByZXR1cm4gZgogICAgICAgICAgICB9LAogICAgICAgICAgICBmcm9tUm90YXRpb25UcmFuc2xhdGlvblNjYWxlT3JpZ2luOiBmdW5jdGlvbihmLCBoLCBsLCBwLCByKSB7CiAgICAgICAgICAgICAgICB2YXIgdCA9IGhbMF0sCiAgICAgICAgICAgICAgICAgICAgdiA9IGhbMV0sCiAgICAgICAgICAgICAgICAgICAgeCA9IGhbMl0sCiAgICAgICAgICAgICAgICAgICAgeSA9IGhbM10sCiAgICAgICAgICAgICAgICAgICAgQSA9IHQgKyB0LAogICAgICAgICAgICAgICAgICAgIEIgPSB2ICsgdiwKICAgICAgICAgICAgICAgICAgICBHID0geCArIHg7CiAgICAgICAgICAgICAgICBoID0gdCAqIEE7CiAgICAgICAgICAgICAgICB2YXIgSSA9IHQgKiBCLAogICAgICAgICAgICAgICAgICAgIEggPSB0ICogRzsKICAgICAgICAgICAgICAgIHQgPSB2ICogQjsKICAgICAgICAgICAgICAgIHYgKj0gRzsKICAgICAgICAgICAgICAgIHZhciBNID0geCAqIEc7CiAgICAgICAgICAgICAgICB4ID0geSAqIEE7CiAgICAgICAgICAgICAgICBCICo9IHk7CiAgICAgICAgICAgICAgICB2YXIgTiA9IHkgKiBHLAogICAgICAgICAgICAgICAgICAgIEwgPSBwWzBdLAogICAgICAgICAgICAgICAgICAgIFEgPSBwWzFdOwogICAgICAgICAgICAgICAgRyA9IHBbMl07CiAgICAgICAgICAgICAgICBwID0gclswXTsKICAgICAgICAgICAgICAgIHkgPSByWzFdOwogICAgICAgICAgICAgICAgciA9IHJbMl07CiAgICAgICAgICAgICAgICBBID0gKDEgLSAodCArIE0pKSAqIEw7CiAgICAgICAgICAgICAgICB2YXIgUCA9IChJICsgTikgKiBMOwogICAgICAgICAgICAgICAgTCAqPSBIIC0gQjsKICAgICAgICAgICAgICAgIEkgPSAoSSAtIE4pICogUTsKICAgICAgICAgICAgICAgIE0gPSAoMSAtIChoICsgTSkpICogUTsKICAgICAgICAgICAgICAgIFEgKj0gdiArIHg7CiAgICAgICAgICAgICAgICBIID0gKEggKyBCKSAqIEc7CiAgICAgICAgICAgICAgICB2ID0gKHYgLSB4KSAqIEc7CiAgICAgICAgICAgICAgICBoID0gKDEgLSAoaCArIHQpKSAqIEc7CiAgICAgICAgICAgICAgICBmWzBdID0gQTsKICAgICAgICAgICAgICAgIGZbMV0gPSBQOwogICAgICAgICAgICAgICAgZlsyXSA9IEw7CiAgICAgICAgICAgICAgICBmWzNdID0gMDsKICAgICAgICAgICAgICAgIGZbNF0gPSBJOwogICAgICAgICAgICAgICAgZls1XSA9IE07CiAgICAgICAgICAgICAgICBmWzZdID0gUTsKICAgICAgICAgICAgICAgIGZbN10gPSAwOwogICAgICAgICAgICAgICAgZls4XSA9IEg7CiAgICAgICAgICAgICAgICBmWzldID0gdjsKICAgICAgICAgICAgICAgIGZbMTBdID0gaDsKICAgICAgICAgICAgICAgIGZbMTFdID0gMDsKICAgICAgICAgICAgICAgIGZbMTJdID0gbFswXSArIHAgLSAoQSAqIHAgKyBJICogeSArIEggKiByKTsKICAgICAgICAgICAgICAgIGZbMTNdID0gbFsxXSArIHkgLSAoUCAqIHAgKwogICAgICAgICAgICAgICAgICAgIE0gKiB5ICsgdiAqIHIpOwogICAgICAgICAgICAgICAgZlsxNF0gPSBsWzJdICsgciAtIChMICogcCArIFEgKiB5ICsgaCAqIHIpOwogICAgICAgICAgICAgICAgZlsxNV0gPSAxOwogICAgICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZnJvbVF1YXQ6IGZ1bmN0aW9uKGYsIGgpIHsKICAgICAgICAgICAgICAgIHZhciBsID0gaFswXSwKICAgICAgICAgICAgICAgICAgICBwID0gaFsxXSwKICAgICAgICAgICAgICAgICAgICByID0gaFsyXTsKICAgICAgICAgICAgICAgIGggPSBoWzNdOwogICAgICAgICAgICAgICAgdmFyIHQgPSBsICsgbCwKICAgICAgICAgICAgICAgICAgICB2ID0gcCArIHAsCiAgICAgICAgICAgICAgICAgICAgeCA9IHIgKyByOwogICAgICAgICAgICAgICAgbCAqPSB0OwogICAgICAgICAgICAgICAgdmFyIHkgPSBwICogdDsKICAgICAgICAgICAgICAgIHAgKj0gdjsKICAgICAgICAgICAgICAgIHZhciBBID0gciAqIHQsCiAgICAgICAgICAgICAgICAgICAgQiA9IHIgKiB2OwogICAgICAgICAgICAgICAgciAqPSB4OwogICAgICAgICAgICAgICAgdCAqPSBoOwogICAgICAgICAgICAgICAgdiAqPSBoOwogICAgICAgICAgICAgICAgaCAqPSB4OwogICAgICAgICAgICAgICAgZlswXSA9IDEgLSBwIC0gcjsKICAgICAgICAgICAgICAgIGZbMV0gPSB5ICsgaDsKICAgICAgICAgICAgICAgIGZbMl0gPSBBIC0gdjsKICAgICAgICAgICAgICAgIGZbM10gPSAwOwogICAgICAgICAgICAgICAgZls0XSA9IHkgLSBoOwogICAgICAgICAgICAgICAgZls1XSA9IDEgLSBsIC0gcjsKICAgICAgICAgICAgICAgIGZbNl0gPSBCICsgdDsKICAgICAgICAgICAgICAgIGZbN10gPSAwOwogICAgICAgICAgICAgICAgZls4XSA9IEEgKyB2OwogICAgICAgICAgICAgICAgZls5XSA9IEIgLSB0OwogICAgICAgICAgICAgICAgZlsxMF0gPSAxIC0gbCAtIHA7CiAgICAgICAgICAgICAgICBmWzExXSA9IDA7CiAgICAgICAgICAgICAgICBmWzEyXSA9IDA7CiAgICAgICAgICAgICAgICBmWzEzXSA9IDA7CiAgICAgICAgICAgICAgICBmWzE0XSA9IDA7CiAgICAgICAgICAgICAgICBmWzE1XSA9IDE7CiAgICAgICAgICAgICAgICByZXR1cm4gZgogICAgICAgICAgICB9LAogICAgICAgICAgICBmcnVzdHVtOiBmdW5jdGlvbihmLCBoLCBsLCBwLCByLCB0LCB2KSB7CiAgICAgICAgICAgICAgICB2YXIgeCA9IDEgLyAobCAtIGgpLAogICAgICAgICAgICAgICAgICAgIHkgPSAxIC8gKHIgLSBwKSwKICAgICAgICAgICAgICAgICAgICBBID0gMSAvICh0IC0gdik7CiAgICAgICAgICAgICAgICBmWzBdID0gMiAqIHQgKiB4OwogICAgICAgICAgICAgICAgZlsxXSA9IDA7CiAgICAgICAgICAgICAgICBmWzJdID0gMDsKICAgICAgICAgICAgICAgIGZbM10gPSAwOwogICAgICAgICAgICAgICAgZls0XSA9IDA7CiAgICAgICAgICAgICAgICBmWzVdID0gMiAqIHQgKiB5OwogICAgICAgICAgICAgICAgZls2XSA9IDA7CiAgICAgICAgICAgICAgICBmWzddID0gMDsKICAgICAgICAgICAgICAgIGZbOF0gPSAobCArIGgpICogeDsKICAgICAgICAgICAgICAgIGZbOV0gPSAociArIHApICogeTsKICAgICAgICAgICAgICAgIGZbMTBdID0KICAgICAgICAgICAgICAgICAgICAodiArIHQpICogQTsKICAgICAgICAgICAgICAgIGZbMTFdID0gLTE7CiAgICAgICAgICAgICAgICBmWzEyXSA9IDA7CiAgICAgICAgICAgICAgICBmWzEzXSA9IDA7CiAgICAgICAgICAgICAgICBmWzE0XSA9IHYgKiB0ICogMiAqIEE7CiAgICAgICAgICAgICAgICBmWzE1XSA9IDA7CiAgICAgICAgICAgICAgICByZXR1cm4gZgogICAgICAgICAgICB9LAogICAgICAgICAgICBwZXJzcGVjdGl2ZU5POiBELAogICAgICAgICAgICBwZXJzcGVjdGl2ZTogRCwKICAgICAgICAgICAgcGVyc3BlY3RpdmVaTzogZnVuY3Rpb24oZiwgaCwgbCwgcCwgcikgewogICAgICAgICAgICAgICAgaCA9IDEgLyBNYXRoLnRhbihoIC8gMik7CiAgICAgICAgICAgICAgICBmWzBdID0gaCAvIGw7CiAgICAgICAgICAgICAgICBmWzFdID0gMDsKICAgICAgICAgICAgICAgIGZbMl0gPSAwOwogICAgICAgICAgICAgICAgZlszXSA9IDA7CiAgICAgICAgICAgICAgICBmWzRdID0gMDsKICAgICAgICAgICAgICAgIGZbNV0gPSBoOwogICAgICAgICAgICAgICAgZls2XSA9IDA7CiAgICAgICAgICAgICAgICBmWzddID0gMDsKICAgICAgICAgICAgICAgIGZbOF0gPSAwOwogICAgICAgICAgICAgICAgZls5XSA9IDA7CiAgICAgICAgICAgICAgICBmWzExXSA9IC0xOwogICAgICAgICAgICAgICAgZlsxMl0gPSAwOwogICAgICAgICAgICAgICAgZlsxM10gPSAwOwogICAgICAgICAgICAgICAgZlsxNV0gPSAwOwogICAgICAgICAgICAgICAgbnVsbCAhPSByICYmIEluZmluaXR5ICE9PSByID8gKGwgPSAxIC8gKHAgLSByKSwgZlsxMF0gPSByICogbCwgZlsxNF0gPSByICogcCAqIGwpIDogKGZbMTBdID0gLTEsIGZbMTRdID0gLXApOwogICAgICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgcGVyc3BlY3RpdmVGcm9tRmllbGRPZlZpZXc6IGZ1bmN0aW9uKGYsIGgsIGwsIHApIHsKICAgICAgICAgICAgICAgIHZhciByID0gTWF0aC50YW4oaC51cERlZ3JlZXMgKiBNYXRoLlBJIC8gMTgwKSwKICAgICAgICAgICAgICAgICAgICB0ID0gTWF0aC50YW4oaC5kb3duRGVncmVlcyAqIE1hdGguUEkgLyAxODApLAogICAgICAgICAgICAgICAgICAgIHYgPSBNYXRoLnRhbihoLmxlZnREZWdyZWVzICogTWF0aC5QSSAvIDE4MCk7CiAgICAgICAgICAgICAgICBoID0KICAgICAgICAgICAgICAgICAgICBNYXRoLnRhbihoLnJpZ2h0RGVncmVlcyAqIE1hdGguUEkgLyAxODApOwogICAgICAgICAgICAgICAgdmFyIHggPSAyIC8gKHYgKyBoKSwKICAgICAgICAgICAgICAgICAgICB5ID0gMiAvIChyICsgdCk7CiAgICAgICAgICAgICAgICBmWzBdID0geDsKICAgICAgICAgICAgICAgIGZbMV0gPSAwOwogICAgICAgICAgICAgICAgZlsyXSA9IDA7CiAgICAgICAgICAgICAgICBmWzNdID0gMDsKICAgICAgICAgICAgICAgIGZbNF0gPSAwOwogICAgICAgICAgICAgICAgZls1XSA9IHk7CiAgICAgICAgICAgICAgICBmWzZdID0gMDsKICAgICAgICAgICAgICAgIGZbN10gPSAwOwogICAgICAgICAgICAgICAgZls4XSA9IC0oKHYgLSBoKSAqIHggKiAuNSk7CiAgICAgICAgICAgICAgICBmWzldID0gKHIgLSB0KSAqIHkgKiAuNTsKICAgICAgICAgICAgICAgIGZbMTBdID0gcCAvIChsIC0gcCk7CiAgICAgICAgICAgICAgICBmWzExXSA9IC0xOwogICAgICAgICAgICAgICAgZlsxMl0gPSAwOwogICAgICAgICAgICAgICAgZlsxM10gPSAwOwogICAgICAgICAgICAgICAgZlsxNF0gPSBwICogbCAvIChsIC0gcCk7CiAgICAgICAgICAgICAgICBmWzE1XSA9IDA7CiAgICAgICAgICAgICAgICByZXR1cm4gZgogICAgICAgICAgICB9LAogICAgICAgICAgICBvcnRob05POiBGLAogICAgICAgICAgICBvcnRobzogRiwKICAgICAgICAgICAgb3J0aG9aTzogZnVuY3Rpb24oZiwgaCwgbCwgcCwgciwgdCwgdikgewogICAgICAgICAgICAgICAgdmFyIHggPSAxIC8gKGggLSBsKSwKICAgICAgICAgICAgICAgICAgICB5ID0gMSAvIChwIC0gcik7CiAgICAgICAgICAgICAgICB2ID0gMSAvICh0IC0gdik7CiAgICAgICAgICAgICAgICBmWzBdID0gLTIgKiB4OwogICAgICAgICAgICAgICAgZlsxXSA9IDA7CiAgICAgICAgICAgICAgICBmWzJdID0gMDsKICAgICAgICAgICAgICAgIGZbM10gPSAwOwogICAgICAgICAgICAgICAgZls0XSA9IDA7CiAgICAgICAgICAgICAgICBmWzVdID0gLTIgKiB5OwogICAgICAgICAgICAgICAgZls2XSA9IDA7CiAgICAgICAgICAgICAgICBmWzddID0gMDsKICAgICAgICAgICAgICAgIGZbOF0gPSAwOwogICAgICAgICAgICAgICAgZls5XSA9IDA7CiAgICAgICAgICAgICAgICBmWzEwXSA9IHY7CiAgICAgICAgICAgICAgICBmWzExXSA9IDA7CiAgICAgICAgICAgICAgICBmWzEyXSA9IChoICsgbCkgKiB4OwogICAgICAgICAgICAgICAgZlsxM10gPSAociArIHApICogeTsKICAgICAgICAgICAgICAgIGZbMTRdID0gdCAqIHY7CiAgICAgICAgICAgICAgICBmWzE1XSA9IDE7CiAgICAgICAgICAgICAgICByZXR1cm4gZgogICAgICAgICAgICB9LAogICAgICAgICAgICBsb29rQXQ6IGZ1bmN0aW9uKGYsIGgsIGwsIHApIHsKICAgICAgICAgICAgICAgIHZhciByID0gaFswXSwKICAgICAgICAgICAgICAgICAgICB0ID0gaFsxXTsKICAgICAgICAgICAgICAgIGggPQogICAgICAgICAgICAgICAgICAgIGhbMl07CiAgICAgICAgICAgICAgICB2YXIgdiA9IHBbMF07CiAgICAgICAgICAgICAgICB2YXIgeCA9IHBbMV07CiAgICAgICAgICAgICAgICB2YXIgeSA9IHBbMl07CiAgICAgICAgICAgICAgICB2YXIgQSA9IGxbMF07CiAgICAgICAgICAgICAgICBwID0gbFsxXTsKICAgICAgICAgICAgICAgIHZhciBCID0gbFsyXTsKICAgICAgICAgICAgICAgIGlmICgxRS02ID4gTWF0aC5hYnMociAtIEEpICYmIDFFLTYgPiBNYXRoLmFicyh0IC0gcCkgJiYgMUUtNiA+IE1hdGguYWJzKGggLSBCKSkgcmV0dXJuIG4oZik7CiAgICAgICAgICAgICAgICBsID0gciAtIEE7CiAgICAgICAgICAgICAgICBwID0gdCAtIHA7CiAgICAgICAgICAgICAgICBBID0gaCAtIEI7CiAgICAgICAgICAgICAgICB2YXIgRyA9IDEgLyBNYXRoLmh5cG90KGwsIHAsIEEpOwogICAgICAgICAgICAgICAgbCAqPSBHOwogICAgICAgICAgICAgICAgcCAqPSBHOwogICAgICAgICAgICAgICAgQSAqPSBHOwogICAgICAgICAgICAgICAgQiA9IHggKiBBIC0geSAqIHA7CiAgICAgICAgICAgICAgICB5ID0geSAqIGwgLSB2ICogQTsKICAgICAgICAgICAgICAgIHYgPSB2ICogcCAtIHggKiBsOwogICAgICAgICAgICAgICAgKEcgPSBNYXRoLmh5cG90KEIsIHksIHYpKSA/IChHID0gMSAvIEcsIEIgKj0gRywgeSAqPSBHLCB2ICo9IEcpIDogdiA9IHkgPSBCID0gMDsKICAgICAgICAgICAgICAgIHggPSBwICogdiAtIEEgKiB5OwogICAgICAgICAgICAgICAgdmFyIEkgPSBBICogQiAtIGwgKiB2OwogICAgICAgICAgICAgICAgdmFyIEggPSBsICogeSAtIHAgKiBCOwogICAgICAgICAgICAgICAgKEcgPSBNYXRoLmh5cG90KHgsIEksIEgpKSA/IChHID0gMSAvIEcsIHggKj0gRywgSSAqPSBHLCBIICo9IEcpIDogSCA9IEkgPSB4ID0gMDsKICAgICAgICAgICAgICAgIGZbMF0gPSBCOwogICAgICAgICAgICAgICAgZlsxXSA9IHg7CiAgICAgICAgICAgICAgICBmWzJdID0gbDsKICAgICAgICAgICAgICAgIGZbM10gPSAwOwogICAgICAgICAgICAgICAgZls0XSA9IHk7CiAgICAgICAgICAgICAgICBmWzVdID0gSTsKICAgICAgICAgICAgICAgIGZbNl0gPSBwOwogICAgICAgICAgICAgICAgZls3XSA9IDA7CiAgICAgICAgICAgICAgICBmWzhdID0gdjsKICAgICAgICAgICAgICAgIGZbOV0gPSBIOwogICAgICAgICAgICAgICAgZlsxMF0gPSBBOwogICAgICAgICAgICAgICAgZlsxMV0gPSAwOwogICAgICAgICAgICAgICAgZlsxMl0gPSAtKEIgKiByICsgeSAqIHQgKyB2ICogaCk7CiAgICAgICAgICAgICAgICBmWzEzXSA9IC0oeCAqIHIgKyBJICogdCArIEggKiBoKTsKICAgICAgICAgICAgICAgIGZbMTRdID0gLShsICogciArIHAgKiB0ICsgQSAqIGgpOwogICAgICAgICAgICAgICAgZlsxNV0gPSAxOwogICAgICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgdGFyZ2V0VG86IGZ1bmN0aW9uKGYsIGgsIGwsIHApIHsKICAgICAgICAgICAgICAgIHZhciByID0gaFswXSwKICAgICAgICAgICAgICAgICAgICB0ID0gaFsxXTsKICAgICAgICAgICAgICAgIGggPSBoWzJdOwogICAgICAgICAgICAgICAgdmFyIHYgPSBwWzBdLAogICAgICAgICAgICAgICAgICAgIHggPSBwWzFdLAogICAgICAgICAgICAgICAgICAgIHkgPSBwWzJdOwogICAgICAgICAgICAgICAgcCA9IHIgLSBsWzBdOwogICAgICAgICAgICAgICAgdmFyIEEgPSB0IC0gbFsxXTsKICAgICAgICAgICAgICAgIGwgPSBoIC0gbFsyXTsKICAgICAgICAgICAgICAgIHZhciBCID0gcCAqIHAgKyBBICogQSArIGwgKiBsOwogICAgICAgICAgICAgICAgMCA8IEIgJiYgKEIgPSAxIC8gTWF0aC5zcXJ0KEIpLCBwICo9IEIsIEEgKj0gQiwgbCAqPSBCKTsKICAgICAgICAgICAgICAgIHZhciBHID0geCAqIGwgLSB5ICogQTsKICAgICAgICAgICAgICAgIHkgPSB5ICogcCAtIHYgKiBsOwogICAgICAgICAgICAgICAgdiA9IHYgKiBBIC0geCAqIHA7CiAgICAgICAgICAgICAgICBCID0gRyAqIEcgKyB5ICogeSArIHYgKiB2OwogICAgICAgICAgICAgICAgMCA8IEIgJiYgKEIgPSAxIC8gTWF0aC5zcXJ0KEIpLCBHICo9IEIsIHkgKj0gQiwgdiAqPSBCKTsKICAgICAgICAgICAgICAgIGZbMF0gPSBHOwogICAgICAgICAgICAgICAgZlsxXSA9IHk7CiAgICAgICAgICAgICAgICBmWzJdID0gdjsKICAgICAgICAgICAgICAgIGZbM10gPSAwOwogICAgICAgICAgICAgICAgZls0XSA9IEEgKiB2IC0gbCAqIHk7CiAgICAgICAgICAgICAgICBmWzVdID0gbCAqIEcgLSBwICogdjsKICAgICAgICAgICAgICAgIGZbNl0gPSBwICogeSAtIEEgKiBHOwogICAgICAgICAgICAgICAgZls3XSA9IDA7CiAgICAgICAgICAgICAgICBmWzhdID0gcDsKICAgICAgICAgICAgICAgIGZbOV0gPSBBOwogICAgICAgICAgICAgICAgZlsxMF0gPSBsOwogICAgICAgICAgICAgICAgZlsxMV0gPSAwOwogICAgICAgICAgICAgICAgZlsxMl0gPSByOwogICAgICAgICAgICAgICAgZlsxM10gPSB0OwogICAgICAgICAgICAgICAgZlsxNF0gPSBoOwogICAgICAgICAgICAgICAgZlsxNV0gPSAxOwogICAgICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc3RyOiBmdW5jdGlvbihmKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gIm1hdDQoIiArIGZbMF0gKyAiLCAiICsgZlsxXSArICIsICIgKyBmWzJdICsgIiwgIiArIGZbM10gKwogICAgICAgICAgICAgICAgICAgICIsICIgKyBmWzRdICsgIiwgIiArIGZbNV0gKyAiLCAiICsgZls2XSArICIsICIgKyBmWzddICsgIiwgIiArIGZbOF0gKyAiLCAiICsgZls5XSArICIsICIgKyBmWzEwXSArICIsICIgKyBmWzExXSArICIsICIgKyBmWzEyXSArICIsICIgKyBmWzEzXSArICIsICIgKyBmWzE0XSArICIsICIgKyBmWzE1XSArICIpIgogICAgICAgICAgICB9LAogICAgICAgICAgICBmcm9iOiBmdW5jdGlvbihmKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gTWF0aC5oeXBvdChmWzBdLCBmWzFdLCBmWzJdLCBmWzNdLCBmWzRdLCBmWzVdLCBmWzZdLCBmWzddLCBmWzhdLCBmWzldLCBmWzEwXSwgZlsxMV0sIGZbMTJdLCBmWzEzXSwgZlsxNF0sIGZbMTVdKQogICAgICAgICAgICB9LAogICAgICAgICAgICBhZGQ6IGZ1bmN0aW9uKGYsIGgsIGwpIHsKICAgICAgICAgICAgICAgIGZbMF0gPSBoWzBdICsgbFswXTsKICAgICAgICAgICAgICAgIGZbMV0gPSBoWzFdICsgbFsxXTsKICAgICAgICAgICAgICAgIGZbMl0gPSBoWzJdICsgbFsyXTsKICAgICAgICAgICAgICAgIGZbM10gPSBoWzNdICsgbFszXTsKICAgICAgICAgICAgICAgIGZbNF0gPSBoWzRdICsgbFs0XTsKICAgICAgICAgICAgICAgIGZbNV0gPSBoWzVdICsgbFs1XTsKICAgICAgICAgICAgICAgIGZbNl0gPSBoWzZdICsgbFs2XTsKICAgICAgICAgICAgICAgIGZbN10gPSBoWzddICsgbFs3XTsKICAgICAgICAgICAgICAgIGZbOF0gPSBoWzhdICsgbFs4XTsKICAgICAgICAgICAgICAgIGZbOV0gPSBoWzldICsgbFs5XTsKICAgICAgICAgICAgICAgIGZbMTBdID0gaFsxMF0gKyBsWzEwXTsKICAgICAgICAgICAgICAgIGZbMTFdID0gaFsxMV0gKyBsWzExXTsKICAgICAgICAgICAgICAgIGZbMTJdID0gaFsxMl0gKyBsWzEyXTsKICAgICAgICAgICAgICAgIGZbMTNdID0gaFsxM10gKyBsWzEzXTsKICAgICAgICAgICAgICAgIGZbMTRdID0KICAgICAgICAgICAgICAgICAgICBoWzE0XSArIGxbMTRdOwogICAgICAgICAgICAgICAgZlsxNV0gPSBoWzE1XSArIGxbMTVdOwogICAgICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc3VidHJhY3Q6IEUsCiAgICAgICAgICAgIG11bHRpcGx5U2NhbGFyOiBmdW5jdGlvbihmLCBoLCBsKSB7CiAgICAgICAgICAgICAgICBmWzBdID0gaFswXSAqIGw7CiAgICAgICAgICAgICAgICBmWzFdID0gaFsxXSAqIGw7CiAgICAgICAgICAgICAgICBmWzJdID0gaFsyXSAqIGw7CiAgICAgICAgICAgICAgICBmWzNdID0gaFszXSAqIGw7CiAgICAgICAgICAgICAgICBmWzRdID0gaFs0XSAqIGw7CiAgICAgICAgICAgICAgICBmWzVdID0gaFs1XSAqIGw7CiAgICAgICAgICAgICAgICBmWzZdID0gaFs2XSAqIGw7CiAgICAgICAgICAgICAgICBmWzddID0gaFs3XSAqIGw7CiAgICAgICAgICAgICAgICBmWzhdID0gaFs4XSAqIGw7CiAgICAgICAgICAgICAgICBmWzldID0gaFs5XSAqIGw7CiAgICAgICAgICAgICAgICBmWzEwXSA9IGhbMTBdICogbDsKICAgICAgICAgICAgICAgIGZbMTFdID0gaFsxMV0gKiBsOwogICAgICAgICAgICAgICAgZlsxMl0gPSBoWzEyXSAqIGw7CiAgICAgICAgICAgICAgICBmWzEzXSA9IGhbMTNdICogbDsKICAgICAgICAgICAgICAgIGZbMTRdID0gaFsxNF0gKiBsOwogICAgICAgICAgICAgICAgZlsxNV0gPSBoWzE1XSAqIGw7CiAgICAgICAgICAgICAgICByZXR1cm4gZgogICAgICAgICAgICB9LAogICAgICAgICAgICBtdWx0aXBseVNjYWxhckFuZEFkZDogZnVuY3Rpb24oZiwgaCwgbCwgcCkgewogICAgICAgICAgICAgICAgZlswXSA9IGhbMF0gKyBsWzBdICogcDsKICAgICAgICAgICAgICAgIGZbMV0gPSBoWzFdICsgbFsxXSAqIHA7CiAgICAgICAgICAgICAgICBmWzJdID0gaFsyXSArIGxbMl0gKiBwOwogICAgICAgICAgICAgICAgZlszXSA9IGhbM10gKyBsWzNdICogcDsKICAgICAgICAgICAgICAgIGZbNF0gPSBoWzRdICsgbFs0XSAqIHA7CiAgICAgICAgICAgICAgICBmWzVdID0gaFs1XSArIGxbNV0gKiBwOwogICAgICAgICAgICAgICAgZls2XSA9IGhbNl0gKyBsWzZdICogcDsKICAgICAgICAgICAgICAgIGZbN10gPSBoWzddICsgbFs3XSAqIHA7CiAgICAgICAgICAgICAgICBmWzhdID0gaFs4XSArIGxbOF0gKiBwOwogICAgICAgICAgICAgICAgZls5XSA9IGhbOV0gKyBsWzldICoKICAgICAgICAgICAgICAgICAgICBwOwogICAgICAgICAgICAgICAgZlsxMF0gPSBoWzEwXSArIGxbMTBdICogcDsKICAgICAgICAgICAgICAgIGZbMTFdID0gaFsxMV0gKyBsWzExXSAqIHA7CiAgICAgICAgICAgICAgICBmWzEyXSA9IGhbMTJdICsgbFsxMl0gKiBwOwogICAgICAgICAgICAgICAgZlsxM10gPSBoWzEzXSArIGxbMTNdICogcDsKICAgICAgICAgICAgICAgIGZbMTRdID0gaFsxNF0gKyBsWzE0XSAqIHA7CiAgICAgICAgICAgICAgICBmWzE1XSA9IGhbMTVdICsgbFsxNV0gKiBwOwogICAgICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZXhhY3RFcXVhbHM6IGZ1bmN0aW9uKGYsIGgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmWzBdID09PSBoWzBdICYmIGZbMV0gPT09IGhbMV0gJiYgZlsyXSA9PT0gaFsyXSAmJiBmWzNdID09PSBoWzNdICYmIGZbNF0gPT09IGhbNF0gJiYgZls1XSA9PT0gaFs1XSAmJiBmWzZdID09PSBoWzZdICYmIGZbN10gPT09IGhbN10gJiYgZls4XSA9PT0gaFs4XSAmJiBmWzldID09PSBoWzldICYmIGZbMTBdID09PSBoWzEwXSAmJiBmWzExXSA9PT0gaFsxMV0gJiYgZlsxMl0gPT09IGhbMTJdICYmIGZbMTNdID09PSBoWzEzXSAmJiBmWzE0XSA9PT0gaFsxNF0gJiYgZlsxNV0gPT09IGhbMTVdCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVxdWFsczogZnVuY3Rpb24oZiwgaCkgewogICAgICAgICAgICAgICAgdmFyIGwgPSBmWzBdLAogICAgICAgICAgICAgICAgICAgIHAgPSBmWzFdLAogICAgICAgICAgICAgICAgICAgIHIgPSBmWzJdLAogICAgICAgICAgICAgICAgICAgIHQgPSBmWzNdLAogICAgICAgICAgICAgICAgICAgIHYgPSBmWzRdLAogICAgICAgICAgICAgICAgICAgIHggPSBmWzVdLAogICAgICAgICAgICAgICAgICAgIHkgPSBmWzZdLAogICAgICAgICAgICAgICAgICAgIEEgPSBmWzddLAogICAgICAgICAgICAgICAgICAgIEIgPSBmWzhdLAogICAgICAgICAgICAgICAgICAgIEcgPSBmWzldLAogICAgICAgICAgICAgICAgICAgIEkgPSBmWzEwXSwKICAgICAgICAgICAgICAgICAgICBIID0gZlsxMV0sCiAgICAgICAgICAgICAgICAgICAgTSA9IGZbMTJdLAogICAgICAgICAgICAgICAgICAgIE4gPSBmWzEzXSwKICAgICAgICAgICAgICAgICAgICBMID0gZlsxNF07CiAgICAgICAgICAgICAgICBmID0gZlsxNV07CiAgICAgICAgICAgICAgICB2YXIgUSA9IGhbMF0sCiAgICAgICAgICAgICAgICAgICAgUCA9IGhbMV0sCiAgICAgICAgICAgICAgICAgICAgUyA9IGhbMl0sCiAgICAgICAgICAgICAgICAgICAgVCA9IGhbM10sCiAgICAgICAgICAgICAgICAgICAgUiA9IGhbNF0sCiAgICAgICAgICAgICAgICAgICAgWCA9IGhbNV0sCiAgICAgICAgICAgICAgICAgICAgWSA9IGhbNl0sCiAgICAgICAgICAgICAgICAgICAgWiA9IGhbN10sCiAgICAgICAgICAgICAgICAgICAgYWEgPSBoWzhdLAogICAgICAgICAgICAgICAgICAgIGRhID0gaFs5XSwKICAgICAgICAgICAgICAgICAgICBlYSA9IGhbMTBdLAogICAgICAgICAgICAgICAgICAgIGZhID0gaFsxMV0sCiAgICAgICAgICAgICAgICAgICAgYmEgPSBoWzEyXSwKICAgICAgICAgICAgICAgICAgICBmYiA9IGhbMTNdLAogICAgICAgICAgICAgICAgICAgIGdiID0gaFsxNF07CiAgICAgICAgICAgICAgICBoID0gaFsxNV07CiAgICAgICAgICAgICAgICByZXR1cm4gTWF0aC5hYnMobCAtIFEpIDw9IDFFLTYgKiBNYXRoLm1heCgxLCBNYXRoLmFicyhsKSwgTWF0aC5hYnMoUSkpICYmIE1hdGguYWJzKHAgLSBQKSA8PSAxRS02ICogTWF0aC5tYXgoMSwgTWF0aC5hYnMocCksIE1hdGguYWJzKFApKSAmJiBNYXRoLmFicyhyIC0gUykgPD0gMUUtNiAqIE1hdGgubWF4KDEsIE1hdGguYWJzKHIpLCBNYXRoLmFicyhTKSkgJiYgTWF0aC5hYnModCAtIFQpIDw9IDFFLTYgKiBNYXRoLm1heCgxLCBNYXRoLmFicyh0KSwgTWF0aC5hYnMoVCkpICYmIE1hdGguYWJzKHYgLSBSKSA8PSAxRS02ICogTWF0aC5tYXgoMSwgTWF0aC5hYnModiksIE1hdGguYWJzKFIpKSAmJiBNYXRoLmFicyh4IC0gWCkgPD0gMUUtNiAqIE1hdGgubWF4KDEsIE1hdGguYWJzKHgpLCBNYXRoLmFicyhYKSkgJiYKICAgICAgICAgICAgICAgICAgICBNYXRoLmFicyh5IC0gWSkgPD0gMUUtNiAqIE1hdGgubWF4KDEsIE1hdGguYWJzKHkpLCBNYXRoLmFicyhZKSkgJiYgTWF0aC5hYnMoQSAtIFopIDw9IDFFLTYgKiBNYXRoLm1heCgxLCBNYXRoLmFicyhBKSwgTWF0aC5hYnMoWikpICYmIE1hdGguYWJzKEIgLSBhYSkgPD0gMUUtNiAqIE1hdGgubWF4KDEsIE1hdGguYWJzKEIpLCBNYXRoLmFicyhhYSkpICYmIE1hdGguYWJzKEcgLSBkYSkgPD0gMUUtNiAqIE1hdGgubWF4KDEsIE1hdGguYWJzKEcpLCBNYXRoLmFicyhkYSkpICYmIE1hdGguYWJzKEkgLSBlYSkgPD0gMUUtNiAqIE1hdGgubWF4KDEsIE1hdGguYWJzKEkpLCBNYXRoLmFicyhlYSkpICYmIE1hdGguYWJzKEggLSBmYSkgPD0gMUUtNiAqIE1hdGgubWF4KDEsIE1hdGguYWJzKEgpLCBNYXRoLmFicyhmYSkpICYmIE1hdGguYWJzKE0gLSBiYSkgPD0gMUUtNiAqIE1hdGgubWF4KDEsIE1hdGguYWJzKE0pLCBNYXRoLmFicyhiYSkpICYmIE1hdGguYWJzKE4gLSBmYikgPD0gMUUtNiAqIE1hdGgubWF4KDEsIE1hdGguYWJzKE4pLCBNYXRoLmFicyhmYikpICYmIE1hdGguYWJzKEwgLSBnYikgPD0gMUUtNiAqIE1hdGgubWF4KDEsIE1hdGguYWJzKEwpLAogICAgICAgICAgICAgICAgICAgICAgICBNYXRoLmFicyhnYikpICYmIE1hdGguYWJzKGYgLSBoKSA8PSAxRS02ICogTWF0aC5tYXgoMSwgTWF0aC5hYnMoZiksIE1hdGguYWJzKGgpKQogICAgICAgICAgICB9LAogICAgICAgICAgICBtdWw6IHEsCiAgICAgICAgICAgIHN1YjogRQogICAgICAgIH0pLAogICAgICAgIHZhID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBmID0gSigpOwogICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oaCwgbCwgcCwgciwgdCwgdikgewogICAgICAgICAgICAgICAgbCB8fCAobCA9IDMpOwogICAgICAgICAgICAgICAgcCB8fCAocCA9IDApOwogICAgICAgICAgICAgICAgZm9yIChyID0gciA/IE1hdGgubWluKHIgKiBsICsgcCwgaC5sZW5ndGgpIDogaC5sZW5ndGg7IHAgPCByOyBwICs9IGwpIGZbMF0gPSBoW3BdLCBmWzFdID0gaFtwICsgMV0sIGZbMl0gPSBoW3AgKyAyXSwgdChmLCBmLCB2KSwgaFtwXSA9IGZbMF0sIGhbcCArIDFdID0gZlsxXSwgaFtwICsgMl0gPSBmWzJdOwogICAgICAgICAgICAgICAgcmV0dXJuIGgKICAgICAgICAgICAgfQogICAgICAgIH0oKTsKICAgIHZhID0gT2JqZWN0LmZyZWV6ZSh7CiAgICAgICAgX19wcm90b19fOiBudWxsLAogICAgICAgIGNyZWF0ZTogSiwKICAgICAgICBjbG9uZTogZnVuY3Rpb24oZikgewogICAgICAgICAgICB2YXIgaCA9IG5ldyBVKDMpOwogICAgICAgICAgICBoWzBdID0gZlswXTsKICAgICAgICAgICAgaFsxXSA9IGZbMV07CiAgICAgICAgICAgIGhbMl0gPSBmWzJdOwogICAgICAgICAgICByZXR1cm4gaAogICAgICAgIH0sCiAgICAgICAgbGVuZ3RoOiBLLAogICAgICAgIGZyb21WYWx1ZXM6IE8sCiAgICAgICAgY29weTogZnVuY3Rpb24oZiwgaCkgewogICAgICAgICAgICBmWzBdID0gaFswXTsKICAgICAgICAgICAgZlsxXSA9IGhbMV07CiAgICAgICAgICAgIGZbMl0gPSBoWzJdOwogICAgICAgICAgICByZXR1cm4gZgogICAgICAgIH0sCiAgICAgICAgc2V0OiBmdW5jdGlvbihmLAogICAgICAgICAgICBoLCBsLCBwKSB7CiAgICAgICAgICAgIGZbMF0gPSBoOwogICAgICAgICAgICBmWzFdID0gbDsKICAgICAgICAgICAgZlsyXSA9IHA7CiAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgfSwKICAgICAgICBhZGQ6IGZ1bmN0aW9uKGYsIGgsIGwpIHsKICAgICAgICAgICAgZlswXSA9IGhbMF0gKyBsWzBdOwogICAgICAgICAgICBmWzFdID0gaFsxXSArIGxbMV07CiAgICAgICAgICAgIGZbMl0gPSBoWzJdICsgbFsyXTsKICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICB9LAogICAgICAgIHN1YnRyYWN0OiBWLAogICAgICAgIG11bHRpcGx5OiBXLAogICAgICAgIGRpdmlkZTogY2EsCiAgICAgICAgY2VpbDogZnVuY3Rpb24oZiwgaCkgewogICAgICAgICAgICBmWzBdID0gTWF0aC5jZWlsKGhbMF0pOwogICAgICAgICAgICBmWzFdID0gTWF0aC5jZWlsKGhbMV0pOwogICAgICAgICAgICBmWzJdID0gTWF0aC5jZWlsKGhbMl0pOwogICAgICAgICAgICByZXR1cm4gZgogICAgICAgIH0sCiAgICAgICAgZmxvb3I6IGZ1bmN0aW9uKGYsIGgpIHsKICAgICAgICAgICAgZlswXSA9IE1hdGguZmxvb3IoaFswXSk7CiAgICAgICAgICAgIGZbMV0gPSBNYXRoLmZsb29yKGhbMV0pOwogICAgICAgICAgICBmWzJdID0gTWF0aC5mbG9vcihoWzJdKTsKICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICB9LAogICAgICAgIG1pbjogZnVuY3Rpb24oZiwgaCwgbCkgewogICAgICAgICAgICBmWzBdID0gTWF0aC5taW4oaFswXSwgbFswXSk7CiAgICAgICAgICAgIGZbMV0gPSBNYXRoLm1pbihoWzFdLCBsWzFdKTsKICAgICAgICAgICAgZlsyXSA9IE1hdGgubWluKGhbMl0sIGxbMl0pOwogICAgICAgICAgICByZXR1cm4gZgogICAgICAgIH0sCiAgICAgICAgbWF4OiBmdW5jdGlvbihmLCBoLCBsKSB7CiAgICAgICAgICAgIGZbMF0gPSBNYXRoLm1heChoWzBdLCBsWzBdKTsKICAgICAgICAgICAgZlsxXSA9IE1hdGgubWF4KGhbMV0sCiAgICAgICAgICAgICAgICBsWzFdKTsKICAgICAgICAgICAgZlsyXSA9IE1hdGgubWF4KGhbMl0sIGxbMl0pOwogICAgICAgICAgICByZXR1cm4gZgogICAgICAgIH0sCiAgICAgICAgcm91bmQ6IGZ1bmN0aW9uKGYsIGgpIHsKICAgICAgICAgICAgZlswXSA9IE1hdGgucm91bmQoaFswXSk7CiAgICAgICAgICAgIGZbMV0gPSBNYXRoLnJvdW5kKGhbMV0pOwogICAgICAgICAgICBmWzJdID0gTWF0aC5yb3VuZChoWzJdKTsKICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICB9LAogICAgICAgIHNjYWxlOiBmdW5jdGlvbihmLCBoLCBsKSB7CiAgICAgICAgICAgIGZbMF0gPSBoWzBdICogbDsKICAgICAgICAgICAgZlsxXSA9IGhbMV0gKiBsOwogICAgICAgICAgICBmWzJdID0gaFsyXSAqIGw7CiAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgfSwKICAgICAgICBzY2FsZUFuZEFkZDogZnVuY3Rpb24oZiwgaCwgbCwgcCkgewogICAgICAgICAgICBmWzBdID0gaFswXSArIGxbMF0gKiBwOwogICAgICAgICAgICBmWzFdID0gaFsxXSArIGxbMV0gKiBwOwogICAgICAgICAgICBmWzJdID0gaFsyXSArIGxbMl0gKiBwOwogICAgICAgICAgICByZXR1cm4gZgogICAgICAgIH0sCiAgICAgICAgZGlzdGFuY2U6IGxhLAogICAgICAgIHNxdWFyZWREaXN0YW5jZTogbWEsCiAgICAgICAgc3F1YXJlZExlbmd0aDogemEsCiAgICAgICAgbmVnYXRlOiBmdW5jdGlvbihmLCBoKSB7CiAgICAgICAgICAgIGZbMF0gPSAtaFswXTsKICAgICAgICAgICAgZlsxXSA9IC1oWzFdOwogICAgICAgICAgICBmWzJdID0gLWhbMl07CiAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgfSwKICAgICAgICBpbnZlcnNlOiBmdW5jdGlvbihmLCBoKSB7CiAgICAgICAgICAgIGZbMF0gPSAxIC8gaFswXTsKICAgICAgICAgICAgZlsxXSA9IDEgLyBoWzFdOwogICAgICAgICAgICBmWzJdID0gMSAvIGhbMl07CiAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgfSwKICAgICAgICBub3JtYWxpemU6IEFhLAogICAgICAgIGRvdDogb2EsCiAgICAgICAgY3Jvc3M6IHBhLAogICAgICAgIGxlcnA6IGZ1bmN0aW9uKGYsIGgsIGwsIHApIHsKICAgICAgICAgICAgdmFyIHIgPSBoWzBdLAogICAgICAgICAgICAgICAgdCA9IGhbMV07CiAgICAgICAgICAgIGggPSBoWzJdOwogICAgICAgICAgICBmWzBdID0gciArIHAgKiAobFswXSAtIHIpOwogICAgICAgICAgICBmWzFdID0gdCArIHAgKiAobFsxXSAtIHQpOwogICAgICAgICAgICBmWzJdID0gaCArIHAgKiAobFsyXSAtIGgpOwogICAgICAgICAgICByZXR1cm4gZgogICAgICAgIH0sCiAgICAgICAgc2xlcnA6IGZ1bmN0aW9uKGYsIGgsIGwsIHApIHsKICAgICAgICAgICAgdmFyIHIgPSBNYXRoLmFjb3MoTWF0aC5taW4oTWF0aC5tYXgob2EoaCwgbCksIC0xKSwgMSkpLAogICAgICAgICAgICAgICAgdCA9IE1hdGguc2luKHIpLAogICAgICAgICAgICAgICAgdiA9IE1hdGguc2luKCgxIC0gcCkgKiByKSAvIHQ7CiAgICAgICAgICAgIHAgPSBNYXRoLnNpbihwICogcikgLyB0OwogICAgICAgICAgICBmWzBdID0gdiAqIGhbMF0gKyBwICogbFswXTsKICAgICAgICAgICAgZlsxXSA9IHYgKiBoWzFdICsgcCAqIGxbMV07CiAgICAgICAgICAgIGZbMl0gPSB2ICogaFsyXSArIHAgKiBsWzJdOwogICAgICAgICAgICByZXR1cm4gZgogICAgICAgIH0sCiAgICAgICAgaGVybWl0ZTogZnVuY3Rpb24oZiwgaCwgbCwgcCwgciwgdCkgewogICAgICAgICAgICB2YXIgdiA9IHQgKiB0LAogICAgICAgICAgICAgICAgeCA9IHYgKiAoMiAqIHQgLSAzKSArIDEsCiAgICAgICAgICAgICAgICB5ID0gdiAqICh0IC0gMikgKyB0LAogICAgICAgICAgICAgICAgQSA9IHYgKiAodCAtIDEpOwogICAgICAgICAgICB0ID0gdiAqICgzIC0gMiAqIHQpOwogICAgICAgICAgICBmWzBdID0gaFswXSAqIHggKyBsWzBdICogeSArIHBbMF0gKiBBICsgclswXSAqIHQ7CiAgICAgICAgICAgIGZbMV0gPSBoWzFdICogeCArIGxbMV0gKiB5ICsgcFsxXSAqIEEgKyByWzFdICogdDsKICAgICAgICAgICAgZlsyXSA9IGhbMl0gKiB4ICsgbFsyXSAqIHkgKyBwWzJdICogQSArIHJbMl0gKiB0OwogICAgICAgICAgICByZXR1cm4gZgogICAgICAgIH0sCiAgICAgICAgYmV6aWVyOiBmdW5jdGlvbihmLCBoLCBsLCBwLCByLCB0KSB7CiAgICAgICAgICAgIHZhciB2ID0gMSAtIHQsCiAgICAgICAgICAgICAgICB4ID0gdiAqIHYsCiAgICAgICAgICAgICAgICB5ID0gdCAqIHQsCiAgICAgICAgICAgICAgICBBID0geCAqIHY7CiAgICAgICAgICAgIHggKj0gMyAqIHQ7CiAgICAgICAgICAgIHYgKj0gMyAqIHk7CiAgICAgICAgICAgIHQgKj0geTsKICAgICAgICAgICAgZlswXSA9IGhbMF0gKiBBICsgbFswXSAqIHggKyBwWzBdICogdiArIHJbMF0gKiB0OwogICAgICAgICAgICBmWzFdID0gaFsxXSAqIEEgKyBsWzFdICogeCArIHBbMV0gKiB2ICsgclsxXSAqIHQ7CiAgICAgICAgICAgIGZbMl0gPSBoWzJdICogQSArIGxbMl0gKiB4ICsgcFsyXSAqIHYgKyByWzJdICogdDsKICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICB9LAogICAgICAgIHJhbmRvbTogZnVuY3Rpb24oZiwgaCkgewogICAgICAgICAgICBoID0gaCB8fCAxOwogICAgICAgICAgICB2YXIgbCA9IDIgKiBoYSgpICogTWF0aC5QSSwKICAgICAgICAgICAgICAgIHAgPSAyICogaGEoKSAtIDEsCiAgICAgICAgICAgICAgICByID0gTWF0aC5zcXJ0KDEgLSBwICogcCkgKiBoOwogICAgICAgICAgICBmWzBdID0gTWF0aC5jb3MobCkgKiByOwogICAgICAgICAgICBmWzFdID0gTWF0aC5zaW4obCkgKiByOwogICAgICAgICAgICBmWzJdID0gcCAqIGg7CiAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgfSwKICAgICAgICB0cmFuc2Zvcm1NYXQ0OiBmdW5jdGlvbihmLCBoLCBsKSB7CiAgICAgICAgICAgIHZhciBwID0gaFswXSwKICAgICAgICAgICAgICAgIHIgPSBoWzFdOwogICAgICAgICAgICBoID0gaFsyXTsKICAgICAgICAgICAgdmFyIHQgPSBsWzNdICogcCArIGxbN10gKiByICsgbFsxMV0gKiBoICsgbFsxNV07CiAgICAgICAgICAgIHQgPSB0IHx8IDE7CiAgICAgICAgICAgIGZbMF0gPSAobFswXSAqIHAgKyBsWzRdICogciArIGxbOF0gKiBoICsgbFsxMl0pIC8gdDsKICAgICAgICAgICAgZlsxXSA9IChsWzFdICogcCArIGxbNV0gKiByICsgbFs5XSAqIGggKyBsWzEzXSkgLyB0OwogICAgICAgICAgICBmWzJdID0gKGxbMl0gKgogICAgICAgICAgICAgICAgcCArIGxbNl0gKiByICsgbFsxMF0gKiBoICsgbFsxNF0pIC8gdDsKICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICB9LAogICAgICAgIHRyYW5zZm9ybU1hdDM6IGZ1bmN0aW9uKGYsIGgsIGwpIHsKICAgICAgICAgICAgdmFyIHAgPSBoWzBdLAogICAgICAgICAgICAgICAgciA9IGhbMV07CiAgICAgICAgICAgIGggPSBoWzJdOwogICAgICAgICAgICBmWzBdID0gcCAqIGxbMF0gKyByICogbFszXSArIGggKiBsWzZdOwogICAgICAgICAgICBmWzFdID0gcCAqIGxbMV0gKyByICogbFs0XSArIGggKiBsWzddOwogICAgICAgICAgICBmWzJdID0gcCAqIGxbMl0gKyByICogbFs1XSArIGggKiBsWzhdOwogICAgICAgICAgICByZXR1cm4gZgogICAgICAgIH0sCiAgICAgICAgdHJhbnNmb3JtUXVhdDogZnVuY3Rpb24oZiwgaCwgbCkgewogICAgICAgICAgICB2YXIgcCA9IGxbMF0sCiAgICAgICAgICAgICAgICByID0gbFsxXSwKICAgICAgICAgICAgICAgIHQgPSBsWzJdLAogICAgICAgICAgICAgICAgdiA9IGhbMF0sCiAgICAgICAgICAgICAgICB4ID0gaFsxXTsKICAgICAgICAgICAgaCA9IGhbMl07CiAgICAgICAgICAgIHZhciB5ID0gciAqIGggLSB0ICogeCwKICAgICAgICAgICAgICAgIEEgPSB0ICogdiAtIHAgKiBoLAogICAgICAgICAgICAgICAgQiA9IHAgKiB4IC0gciAqIHY7CiAgICAgICAgICAgIGwgPSAyICogbFszXTsKICAgICAgICAgICAgZlswXSA9IHYgKyB5ICogbCArIDIgKiAociAqIEIgLSB0ICogQSk7CiAgICAgICAgICAgIGZbMV0gPSB4ICsgQSAqIGwgKyAyICogKHQgKiB5IC0gcCAqIEIpOwogICAgICAgICAgICBmWzJdID0gaCArIEIgKiBsICsgMiAqIChwICogQSAtIHIgKiB5KTsKICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICB9LAogICAgICAgIHJvdGF0ZVg6IGZ1bmN0aW9uKGYsIGgsIGwsIHApIHsKICAgICAgICAgICAgdmFyIHIgPSBbXSwKICAgICAgICAgICAgICAgIHQgPSBbXTsKICAgICAgICAgICAgclswXSA9IGhbMF0gLSBsWzBdOwogICAgICAgICAgICByWzFdID0gaFsxXSAtIGxbMV07CiAgICAgICAgICAgIHJbMl0gPSBoWzJdIC0gbFsyXTsKICAgICAgICAgICAgdFswXSA9IHJbMF07CiAgICAgICAgICAgIHRbMV0gPSByWzFdICogTWF0aC5jb3MocCkgLSByWzJdICogTWF0aC5zaW4ocCk7CiAgICAgICAgICAgIHRbMl0gPSByWzFdICogTWF0aC5zaW4ocCkgKyByWzJdICogTWF0aC5jb3MocCk7CiAgICAgICAgICAgIGZbMF0gPSB0WzBdICsgbFswXTsKICAgICAgICAgICAgZlsxXSA9IHRbMV0gKyBsWzFdOwogICAgICAgICAgICBmWzJdID0gdFsyXSArIGxbMl07CiAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgfSwKICAgICAgICByb3RhdGVZOiBmdW5jdGlvbihmLCBoLCBsLCBwKSB7CiAgICAgICAgICAgIHZhciByID0gW10sCiAgICAgICAgICAgICAgICB0ID0gW107CiAgICAgICAgICAgIHJbMF0gPSBoWzBdIC0gbFswXTsKICAgICAgICAgICAgclsxXSA9IGhbMV0gLSBsWzFdOwogICAgICAgICAgICByWzJdID0gaFsyXSAtIGxbMl07CiAgICAgICAgICAgIHRbMF0gPSByWzJdICogTWF0aC5zaW4ocCkgKyByWzBdICogTWF0aC5jb3MocCk7CiAgICAgICAgICAgIHRbMV0gPSByWzFdOwogICAgICAgICAgICB0WzJdID0gclsyXSAqIE1hdGguY29zKHApIC0gclswXSAqIE1hdGguc2luKHApOwogICAgICAgICAgICBmWzBdID0gdFswXSArIGxbMF07CiAgICAgICAgICAgIGZbMV0gPSB0WzFdICsgbFsxXTsKICAgICAgICAgICAgZlsyXSA9IHRbMl0gKyBsWzJdOwogICAgICAgICAgICByZXR1cm4gZgogICAgICAgIH0sCiAgICAgICAgcm90YXRlWjogZnVuY3Rpb24oZiwgaCwgbCwgcCkgewogICAgICAgICAgICB2YXIgciA9IFtdLAogICAgICAgICAgICAgICAgdCA9IFtdOwogICAgICAgICAgICByWzBdID0gaFswXSAtIGxbMF07CiAgICAgICAgICAgIHJbMV0gPSBoWzFdIC0gbFsxXTsKICAgICAgICAgICAgclsyXSA9IGhbMl0gLSBsWzJdOwogICAgICAgICAgICB0WzBdID0gclswXSAqIE1hdGguY29zKHApIC0gclsxXSAqIE1hdGguc2luKHApOwogICAgICAgICAgICB0WzFdID0gclswXSAqIE1hdGguc2luKHApICsgclsxXSAqIE1hdGguY29zKHApOwogICAgICAgICAgICB0WzJdID0gclsyXTsKICAgICAgICAgICAgZlswXSA9IHRbMF0gKwogICAgICAgICAgICAgICAgbFswXTsKICAgICAgICAgICAgZlsxXSA9IHRbMV0gKyBsWzFdOwogICAgICAgICAgICBmWzJdID0gdFsyXSArIGxbMl07CiAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgfSwKICAgICAgICBhbmdsZTogZnVuY3Rpb24oZiwgaCkgewogICAgICAgICAgICB2YXIgbCA9IGZbMF0sCiAgICAgICAgICAgICAgICBwID0gZlsxXSwKICAgICAgICAgICAgICAgIHIgPSBmWzJdLAogICAgICAgICAgICAgICAgdCA9IGhbMF0sCiAgICAgICAgICAgICAgICB2ID0gaFsxXSwKICAgICAgICAgICAgICAgIHggPSBoWzJdOwogICAgICAgICAgICBmID0gKGwgPSBNYXRoLnNxcnQoKGwgKiBsICsgcCAqIHAgKyByICogcikgKiAodCAqIHQgKyB2ICogdiArIHggKiB4KSkpICYmIG9hKGYsIGgpIC8gbDsKICAgICAgICAgICAgcmV0dXJuIE1hdGguYWNvcyhNYXRoLm1pbihNYXRoLm1heChmLCAtMSksIDEpKQogICAgICAgIH0sCiAgICAgICAgemVybzogZnVuY3Rpb24oZikgewogICAgICAgICAgICBmWzBdID0gMDsKICAgICAgICAgICAgZlsxXSA9IDA7CiAgICAgICAgICAgIGZbMl0gPSAwOwogICAgICAgICAgICByZXR1cm4gZgogICAgICAgIH0sCiAgICAgICAgc3RyOiBmdW5jdGlvbihmKSB7CiAgICAgICAgICAgIHJldHVybiAidmVjMygiICsgZlswXSArICIsICIgKyBmWzFdICsgIiwgIiArIGZbMl0gKyAiKSIKICAgICAgICB9LAogICAgICAgIGV4YWN0RXF1YWxzOiBmdW5jdGlvbihmLCBoKSB7CiAgICAgICAgICAgIHJldHVybiBmWzBdID09PSBoWzBdICYmIGZbMV0gPT09IGhbMV0gJiYgZlsyXSA9PT0gaFsyXQogICAgICAgIH0sCiAgICAgICAgZXF1YWxzOiBmdW5jdGlvbihmLCBoKSB7CiAgICAgICAgICAgIHZhciBsID0gZlswXSwKICAgICAgICAgICAgICAgIHAgPSBmWzFdOwogICAgICAgICAgICBmID0gZlsyXTsKICAgICAgICAgICAgdmFyIHIgPSBoWzBdLAogICAgICAgICAgICAgICAgdCA9IGhbMV07CiAgICAgICAgICAgIGggPSBoWzJdOwogICAgICAgICAgICByZXR1cm4gTWF0aC5hYnMobCAtIHIpIDw9IDFFLTYgKiBNYXRoLm1heCgxLAogICAgICAgICAgICAgICAgTWF0aC5hYnMobCksIE1hdGguYWJzKHIpKSAmJiBNYXRoLmFicyhwIC0gdCkgPD0gMUUtNiAqIE1hdGgubWF4KDEsIE1hdGguYWJzKHApLCBNYXRoLmFicyh0KSkgJiYgTWF0aC5hYnMoZiAtIGgpIDw9IDFFLTYgKiBNYXRoLm1heCgxLCBNYXRoLmFicyhmKSwgTWF0aC5hYnMoaCkpCiAgICAgICAgfSwKICAgICAgICBzdWI6IFYsCiAgICAgICAgbXVsOiBXLAogICAgICAgIGRpdjogY2EsCiAgICAgICAgZGlzdDogbGEsCiAgICAgICAgc3FyRGlzdDogbWEsCiAgICAgICAgbGVuOiBLLAogICAgICAgIHNxckxlbjogemEsCiAgICAgICAgZm9yRWFjaDogdmEKICAgIH0pOwogICAgdmFyIHdhID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGYgPSBCYSgpOwogICAgICAgIHJldHVybiBmdW5jdGlvbihoLCBsLCBwLCByLCB0LCB2KSB7CiAgICAgICAgICAgIGwgfHwgKGwgPSA0KTsKICAgICAgICAgICAgcCB8fCAocCA9IDApOwogICAgICAgICAgICBmb3IgKHIgPSByID8gTWF0aC5taW4ociAqIGwgKyBwLCBoLmxlbmd0aCkgOiBoLmxlbmd0aDsgcCA8IHI7IHAgKz0gbCkgZlswXSA9IGhbcF0sIGZbMV0gPSBoW3AgKyAxXSwgZlsyXSA9IGhbcCArIDJdLCBmWzNdID0gaFtwICsgM10sIHQoZiwgZiwgdiksIGhbcF0gPSBmWzBdLCBoW3AgKyAxXSA9IGZbMV0sIGhbcCArIDJdID0gZlsyXSwgaFtwICsgM10gPSBmWzNdOwogICAgICAgICAgICByZXR1cm4gaAogICAgICAgIH0KICAgIH0oKTsKICAgIHdhID0gT2JqZWN0LmZyZWV6ZSh7CiAgICAgICAgX19wcm90b19fOiBudWxsLAogICAgICAgIGNyZWF0ZTogQmEsCiAgICAgICAgY2xvbmU6IENhLAogICAgICAgIGZyb21WYWx1ZXM6IERhLAogICAgICAgIGNvcHk6IHFhLAogICAgICAgIHNldDogRWEsCiAgICAgICAgYWRkOiBGYSwKICAgICAgICBzdWJ0cmFjdDogR2EsCiAgICAgICAgbXVsdGlwbHk6IEhhLAogICAgICAgIGRpdmlkZTogSWEsCiAgICAgICAgY2VpbDogZnVuY3Rpb24oZiwgaCkgewogICAgICAgICAgICBmWzBdID0gTWF0aC5jZWlsKGhbMF0pOwogICAgICAgICAgICBmWzFdID0gTWF0aC5jZWlsKGhbMV0pOwogICAgICAgICAgICBmWzJdID0gTWF0aC5jZWlsKGhbMl0pOwogICAgICAgICAgICBmWzNdID0gTWF0aC5jZWlsKGhbM10pOwogICAgICAgICAgICByZXR1cm4gZgogICAgICAgIH0sCiAgICAgICAgZmxvb3I6IGZ1bmN0aW9uKGYsIGgpIHsKICAgICAgICAgICAgZlswXSA9IE1hdGguZmxvb3IoaFswXSk7CiAgICAgICAgICAgIGZbMV0gPSBNYXRoLmZsb29yKGhbMV0pOwogICAgICAgICAgICBmWzJdID0gTWF0aC5mbG9vcihoWzJdKTsKICAgICAgICAgICAgZlszXSA9IE1hdGguZmxvb3IoaFszXSk7CiAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgfSwKICAgICAgICBtaW46IGZ1bmN0aW9uKGYsIGgsIGwpIHsKICAgICAgICAgICAgZlswXSA9IE1hdGgubWluKGhbMF0sIGxbMF0pOwogICAgICAgICAgICBmWzFdID0gTWF0aC5taW4oaFsxXSwgbFsxXSk7CiAgICAgICAgICAgIGZbMl0gPSBNYXRoLm1pbihoWzJdLCBsWzJdKTsKICAgICAgICAgICAgZlszXSA9IE1hdGgubWluKGhbM10sIGxbM10pOwogICAgICAgICAgICByZXR1cm4gZgogICAgICAgIH0sCiAgICAgICAgbWF4OiBmdW5jdGlvbihmLCBoLCBsKSB7CiAgICAgICAgICAgIGZbMF0gPSBNYXRoLm1heChoWzBdLCBsWzBdKTsKICAgICAgICAgICAgZlsxXSA9IE1hdGgubWF4KGhbMV0sIGxbMV0pOwogICAgICAgICAgICBmWzJdID0gTWF0aC5tYXgoaFsyXSwKICAgICAgICAgICAgICAgIGxbMl0pOwogICAgICAgICAgICBmWzNdID0gTWF0aC5tYXgoaFszXSwgbFszXSk7CiAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgfSwKICAgICAgICByb3VuZDogZnVuY3Rpb24oZiwgaCkgewogICAgICAgICAgICBmWzBdID0gTWF0aC5yb3VuZChoWzBdKTsKICAgICAgICAgICAgZlsxXSA9IE1hdGgucm91bmQoaFsxXSk7CiAgICAgICAgICAgIGZbMl0gPSBNYXRoLnJvdW5kKGhbMl0pOwogICAgICAgICAgICBmWzNdID0gTWF0aC5yb3VuZChoWzNdKTsKICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICB9LAogICAgICAgIHNjYWxlOiB1YSwKICAgICAgICBzY2FsZUFuZEFkZDogZnVuY3Rpb24oZiwgaCwgbCwgcCkgewogICAgICAgICAgICBmWzBdID0gaFswXSArIGxbMF0gKiBwOwogICAgICAgICAgICBmWzFdID0gaFsxXSArIGxbMV0gKiBwOwogICAgICAgICAgICBmWzJdID0gaFsyXSArIGxbMl0gKiBwOwogICAgICAgICAgICBmWzNdID0gaFszXSArIGxbM10gKiBwOwogICAgICAgICAgICByZXR1cm4gZgogICAgICAgIH0sCiAgICAgICAgZGlzdGFuY2U6IEphLAogICAgICAgIHNxdWFyZWREaXN0YW5jZTogS2EsCiAgICAgICAgbGVuZ3RoOiBqYSwKICAgICAgICBzcXVhcmVkTGVuZ3RoOiBpYSwKICAgICAgICBuZWdhdGU6IGZ1bmN0aW9uKGYsIGgpIHsKICAgICAgICAgICAgZlswXSA9IC1oWzBdOwogICAgICAgICAgICBmWzFdID0gLWhbMV07CiAgICAgICAgICAgIGZbMl0gPSAtaFsyXTsKICAgICAgICAgICAgZlszXSA9IC1oWzNdOwogICAgICAgICAgICByZXR1cm4gZgogICAgICAgIH0sCiAgICAgICAgaW52ZXJzZTogZnVuY3Rpb24oZiwgaCkgewogICAgICAgICAgICBmWzBdID0gMSAvIGhbMF07CiAgICAgICAgICAgIGZbMV0gPSAxIC8gaFsxXTsKICAgICAgICAgICAgZlsyXSA9IDEgLyBoWzJdOwogICAgICAgICAgICBmWzNdID0gMSAvIGhbM107CiAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgfSwKICAgICAgICBub3JtYWxpemU6IHJhLAogICAgICAgIGRvdDoga2EsCiAgICAgICAgY3Jvc3M6IGZ1bmN0aW9uKGYsIGgsIGwsIHApIHsKICAgICAgICAgICAgdmFyIHIgPSBsWzBdICogcFsxXSAtIGxbMV0gKiBwWzBdLAogICAgICAgICAgICAgICAgdCA9IGxbMF0gKiBwWzJdIC0gbFsyXSAqIHBbMF0sCiAgICAgICAgICAgICAgICB2ID0gbFswXSAqIHBbM10gLSBsWzNdICogcFswXSwKICAgICAgICAgICAgICAgIHggPSBsWzFdICogcFsyXSAtIGxbMl0gKiBwWzFdLAogICAgICAgICAgICAgICAgeSA9IGxbMV0gKiBwWzNdIC0gbFszXSAqIHBbMV07CiAgICAgICAgICAgIGwgPSBsWzJdICogcFszXSAtIGxbM10gKiBwWzJdOwogICAgICAgICAgICBwID0gaFswXTsKICAgICAgICAgICAgdmFyIEEgPSBoWzFdLAogICAgICAgICAgICAgICAgQiA9IGhbMl07CiAgICAgICAgICAgIGggPSBoWzNdOwogICAgICAgICAgICBmWzBdID0gQSAqIGwgLSBCICogeSArIGggKiB4OwogICAgICAgICAgICBmWzFdID0gLShwICogbCkgKyBCICogdiAtIGggKiB0OwogICAgICAgICAgICBmWzJdID0gcCAqIHkgLSBBICogdiArIGggKiByOwogICAgICAgICAgICBmWzNdID0gLShwICogeCkgKyBBICogdCAtIEIgKiByOwogICAgICAgICAgICByZXR1cm4gZgogICAgICAgIH0sCiAgICAgICAgbGVycDogTGEsCiAgICAgICAgcmFuZG9tOiBmdW5jdGlvbihmLCBoKSB7CiAgICAgICAgICAgIGggPSBoIHx8IDE7CiAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgIHZhciBsID0gMiAqIGhhKCkgLSAxOwogICAgICAgICAgICAgICAgdmFyIHAgPSAyICogaGEoKSAtIDE7CiAgICAgICAgICAgICAgICB2YXIgciA9IGwgKiBsICsgcCAqIHAKICAgICAgICAgICAgfSB3aGlsZSAoMSA8PSByKTsKICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgICAgdmFyIHQgPSAyICogaGEoKSAtIDE7CiAgICAgICAgICAgICAgICB2YXIgdiA9IDIgKiBoYSgpIC0gMTsKICAgICAgICAgICAgICAgIHZhciB4ID0gdCAqIHQgKyB2ICogdgogICAgICAgICAgICB9IHdoaWxlICgxIDw9IHgpOwogICAgICAgICAgICByID0gTWF0aC5zcXJ0KCgxIC0gcikgLyB4KTsKICAgICAgICAgICAgZlswXSA9IGggKiBsOwogICAgICAgICAgICBmWzFdID0gaCAqIHA7CiAgICAgICAgICAgIGZbMl0gPSBoICogdCAqIHI7CiAgICAgICAgICAgIGZbM10gPSBoICogdiAqIHI7CiAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgfSwKICAgICAgICB0cmFuc2Zvcm1NYXQ0OiBmdW5jdGlvbihmLCBoLCBsKSB7CiAgICAgICAgICAgIHZhciBwID0gaFswXSwKICAgICAgICAgICAgICAgIHIgPSBoWzFdLAogICAgICAgICAgICAgICAgdCA9IGhbMl07CiAgICAgICAgICAgIGggPSBoWzNdOwogICAgICAgICAgICBmWzBdID0gbFswXSAqIHAgKyBsWzRdICogciArIGxbOF0gKiB0ICsgbFsxMl0gKiBoOwogICAgICAgICAgICBmWzFdID0gbFsxXSAqIHAgKyBsWzVdICogciArIGxbOV0gKiB0ICsgbFsxM10gKiBoOwogICAgICAgICAgICBmWzJdID0gbFsyXSAqIHAgKyBsWzZdICogciArIGxbMTBdICogdCArIGxbMTRdICogaDsKICAgICAgICAgICAgZlszXSA9IGxbM10gKiBwICsgbFs3XSAqIHIgKyBsWzExXSAqIHQgKyBsWzE1XSAqIGg7CiAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgfSwKICAgICAgICB0cmFuc2Zvcm1RdWF0OiBmdW5jdGlvbihmLCBoLCBsKSB7CiAgICAgICAgICAgIHZhciBwID0gaFswXSwKICAgICAgICAgICAgICAgIHIgPSBoWzFdLAogICAgICAgICAgICAgICAgdCA9IGhbMl0sCiAgICAgICAgICAgICAgICB2ID0gbFswXSwKICAgICAgICAgICAgICAgIHggPSBsWzFdLAogICAgICAgICAgICAgICAgeSA9IGxbMl07CiAgICAgICAgICAgIGwgPSBsWzNdOwogICAgICAgICAgICB2YXIgQSA9IGwgKiBwICsgeCAqIHQgLSB5ICogciwKICAgICAgICAgICAgICAgIEIgPSBsICogciArIHkgKiBwIC0gdiAqIHQsCiAgICAgICAgICAgICAgICBHID0gbCAqIHQgKyB2ICogciAtIHggKiBwOwogICAgICAgICAgICBwID0gLXYgKiBwIC0geCAqIHIgLSB5ICogdDsKICAgICAgICAgICAgZlswXSA9IEEgKiBsICsgcCAqIC12ICsgQiAqIC15IC0gRyAqIC14OwogICAgICAgICAgICBmWzFdID0gQiAqIGwgKyBwICogLXggKyBHICogLXYgLSBBICogLXk7CiAgICAgICAgICAgIGZbMl0gPSBHICogbCArIHAgKiAteSArIEEgKiAteCAtIEIgKiAtdjsKICAgICAgICAgICAgZlszXSA9IGhbM107CiAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgfSwKICAgICAgICB6ZXJvOiBmdW5jdGlvbihmKSB7CiAgICAgICAgICAgIGZbMF0gPSAwOwogICAgICAgICAgICBmWzFdID0gMDsKICAgICAgICAgICAgZlsyXSA9IDA7CiAgICAgICAgICAgIGZbM10gPSAwOwogICAgICAgICAgICByZXR1cm4gZgogICAgICAgIH0sCiAgICAgICAgc3RyOiBmdW5jdGlvbihmKSB7CiAgICAgICAgICAgIHJldHVybiAidmVjNCgiICsgZlswXSArICIsICIgKyBmWzFdICsgIiwgIiArIGZbMl0gKyAiLCAiICsgZlszXSArICIpIgogICAgICAgIH0sCiAgICAgICAgZXhhY3RFcXVhbHM6IE1hLAogICAgICAgIGVxdWFsczogZnVuY3Rpb24oZiwgaCkgewogICAgICAgICAgICB2YXIgbCA9IGZbMF0sCiAgICAgICAgICAgICAgICBwID0gZlsxXSwKICAgICAgICAgICAgICAgIHIgPSBmWzJdOwogICAgICAgICAgICBmID0gZlszXTsKICAgICAgICAgICAgdmFyIHQgPSBoWzBdLAogICAgICAgICAgICAgICAgdiA9IGhbMV0sCiAgICAgICAgICAgICAgICB4ID0gaFsyXTsKICAgICAgICAgICAgaCA9IGhbM107CiAgICAgICAgICAgIHJldHVybiBNYXRoLmFicyhsIC0gdCkgPD0gMUUtNiAqIE1hdGgubWF4KDEsIE1hdGguYWJzKGwpLCBNYXRoLmFicyh0KSkgJiYgTWF0aC5hYnMocCAtIHYpIDw9IDFFLTYgKiBNYXRoLm1heCgxLCBNYXRoLmFicyhwKSwgTWF0aC5hYnModikpICYmIE1hdGguYWJzKHIgLSB4KSA8PSAxRS02ICogTWF0aC5tYXgoMSwgTWF0aC5hYnMociksIE1hdGguYWJzKHgpKSAmJiBNYXRoLmFicyhmIC0gaCkgPD0gMUUtNiAqIE1hdGgubWF4KDEsIE1hdGguYWJzKGYpLCBNYXRoLmFicyhoKSkKICAgICAgICB9LAogICAgICAgIHN1YjogR2EsCiAgICAgICAgbXVsOiBIYSwKICAgICAgICBkaXY6IElhLAogICAgICAgIGRpc3Q6IEphLAogICAgICAgIHNxckRpc3Q6IEthLAogICAgICAgIGxlbjogamEsCiAgICAgICAgc3FyTGVuOiBpYSwKICAgICAgICBmb3JFYWNoOiB3YQogICAgfSk7CiAgICB2YXIgeGEgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIGYgPSBKKCksCiAgICAgICAgICAgICAgICBoID0gTygxLCAwLCAwKSwKICAgICAgICAgICAgICAgIGwgPSBPKDAsIDEsIDApOwogICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24ocCwgciwgdCkgewogICAgICAgICAgICAgICAgdmFyIHYgPSBvYShyLCB0KTsKICAgICAgICAgICAgICAgIGlmICgtLjk5OTk5OSA+IHYpIHJldHVybiBwYShmLCBoLCByKSwgMUUtNiA+IEsoZikgJiYgcGEoZiwgbCwgciksIEFhKGYsIGYpLCBOYShwLCBmLCBNYXRoLlBJKSwgcDsKICAgICAgICAgICAgICAgIGlmICguOTk5OTk5IDwgdikgcmV0dXJuIHBbMF0gPSAwLCBwWzFdID0gMCwgcFsyXSA9IDAsIHBbM10gPSAxLCBwOwogICAgICAgICAgICAgICAgcGEoZiwgciwgdCk7CiAgICAgICAgICAgICAgICBwWzBdID0gZlswXTsKICAgICAgICAgICAgICAgIHBbMV0gPSBmWzFdOwogICAgICAgICAgICAgICAgcFsyXSA9IGZbMl07CiAgICAgICAgICAgICAgICBwWzNdID0gMSArIHY7CiAgICAgICAgICAgICAgICByZXR1cm4gcmEocCwgcCkKICAgICAgICAgICAgfQogICAgICAgIH0oKSwKICAgICAgICB5YSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgZiA9IHNhKCksCiAgICAgICAgICAgICAgICBoID0gc2EoKTsKICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGwsIHAsIHIsIHQsIHYsIHgpIHsKICAgICAgICAgICAgICAgIHRhKGYsIHAsIHYsIHgpOwogICAgICAgICAgICAgICAgdGEoaCwgciwgdCwgeCk7CiAgICAgICAgICAgICAgICB0YShsLCBmLCBoLCAyICogeCAqICgxIC0geCkpOwogICAgICAgICAgICAgICAgcmV0dXJuIGwKICAgICAgICAgICAgfQogICAgICAgIH0oKSwKICAgICAgICBuYSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgZiA9IGcoKTsKICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGgsIGwsIHAsIHIpIHsKICAgICAgICAgICAgICAgIGZbMF0gPSBwWzBdOwogICAgICAgICAgICAgICAgZlszXSA9IHBbMV07CiAgICAgICAgICAgICAgICBmWzZdID0gcFsyXTsKICAgICAgICAgICAgICAgIGZbMV0gPSByWzBdOwogICAgICAgICAgICAgICAgZls0XSA9IHJbMV07CiAgICAgICAgICAgICAgICBmWzddID0gclsyXTsKICAgICAgICAgICAgICAgIGZbMl0gPSAtbFswXTsKICAgICAgICAgICAgICAgIGZbNV0gPSAtbFsxXTsKICAgICAgICAgICAgICAgIGZbOF0gPSAtbFsyXTsKICAgICAgICAgICAgICAgIHJldHVybiByYShoLCBVYShoLCBmKSkKICAgICAgICAgICAgfQogICAgICAgIH0oKTsKICAgIHhhID0gT2JqZWN0LmZyZWV6ZSh7CiAgICAgICAgX19wcm90b19fOiBudWxsLAogICAgICAgIGNyZWF0ZTogc2EsCiAgICAgICAgaWRlbnRpdHk6IGZ1bmN0aW9uKGYpIHsKICAgICAgICAgICAgZlswXSA9IDA7CiAgICAgICAgICAgIGZbMV0gPSAwOwogICAgICAgICAgICBmWzJdID0gMDsKICAgICAgICAgICAgZlszXSA9IDE7CiAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgfSwKICAgICAgICBzZXRBeGlzQW5nbGU6IE5hLAogICAgICAgIGdldEF4aXNBbmdsZTogZnVuY3Rpb24oZiwgaCkgewogICAgICAgICAgICB2YXIgbCA9IDIgKiBNYXRoLmFjb3MoaFszXSksCiAgICAgICAgICAgICAgICBwID0gTWF0aC5zaW4obCAvIDIpOwogICAgICAgICAgICAxRS02IDwgcCA/IChmWzBdID0gaFswXSAvIHAsIGZbMV0gPSBoWzFdIC8gcCwgZlsyXSA9IGhbMl0gLyBwKSA6IChmWzBdID0gMSwgZlsxXSA9IDAsIGZbMl0gPSAwKTsKICAgICAgICAgICAgcmV0dXJuIGwKICAgICAgICB9LAogICAgICAgIGdldEFuZ2xlOiBmdW5jdGlvbihmLCBoKSB7CiAgICAgICAgICAgIGYgPSBrYShmLCBoKTsKICAgICAgICAgICAgcmV0dXJuIE1hdGguYWNvcygyICogZiAqIGYgLSAxKQogICAgICAgIH0sCiAgICAgICAgbXVsdGlwbHk6IE9hLAogICAgICAgIHJvdGF0ZVg6IFBhLAogICAgICAgIHJvdGF0ZVk6IFFhLAogICAgICAgIHJvdGF0ZVo6IFJhLAogICAgICAgIGNhbGN1bGF0ZVc6IGZ1bmN0aW9uKGYsIGgpIHsKICAgICAgICAgICAgdmFyIGwgPSBoWzBdLAogICAgICAgICAgICAgICAgcCA9IGhbMV07CiAgICAgICAgICAgIGggPSBoWzJdOwogICAgICAgICAgICBmWzBdID0gbDsKICAgICAgICAgICAgZlsxXSA9IHA7CiAgICAgICAgICAgIGZbMl0gPSBoOwogICAgICAgICAgICBmWzNdID0gTWF0aC5zcXJ0KE1hdGguYWJzKDEgLQogICAgICAgICAgICAgICAgbCAqIGwgLSBwICogcCAtIGggKiBoKSk7CiAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgfSwKICAgICAgICBleHA6IFNhLAogICAgICAgIGxuOiBUYSwKICAgICAgICBwb3c6IGZ1bmN0aW9uKGYsIGgsIGwpIHsKICAgICAgICAgICAgVGEoZiwgaCk7CiAgICAgICAgICAgIHVhKGYsIGYsIGwpOwogICAgICAgICAgICBTYShmLCBmKTsKICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICB9LAogICAgICAgIHNsZXJwOiB0YSwKICAgICAgICByYW5kb206IGZ1bmN0aW9uKGYpIHsKICAgICAgICAgICAgdmFyIGggPSBoYSgpLAogICAgICAgICAgICAgICAgbCA9IGhhKCksCiAgICAgICAgICAgICAgICBwID0gaGEoKSwKICAgICAgICAgICAgICAgIHIgPSBNYXRoLnNxcnQoMSAtIGgpOwogICAgICAgICAgICBoID0gTWF0aC5zcXJ0KGgpOwogICAgICAgICAgICBmWzBdID0gciAqIE1hdGguc2luKDIgKiBNYXRoLlBJICogbCk7CiAgICAgICAgICAgIGZbMV0gPSByICogTWF0aC5jb3MoMiAqIE1hdGguUEkgKiBsKTsKICAgICAgICAgICAgZlsyXSA9IGggKiBNYXRoLnNpbigyICogTWF0aC5QSSAqIHApOwogICAgICAgICAgICBmWzNdID0gaCAqIE1hdGguY29zKDIgKiBNYXRoLlBJICogcCk7CiAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgfSwKICAgICAgICBpbnZlcnQ6IGZ1bmN0aW9uKGYsIGgpIHsKICAgICAgICAgICAgdmFyIGwgPSBoWzBdLAogICAgICAgICAgICAgICAgcCA9IGhbMV0sCiAgICAgICAgICAgICAgICByID0gaFsyXTsKICAgICAgICAgICAgaCA9IGhbM107CiAgICAgICAgICAgIHZhciB0ID0gbCAqIGwgKyBwICogcCArIHIgKiByICsgaCAqIGg7CiAgICAgICAgICAgIHQgPSB0ID8gMSAvIHQgOiAwOwogICAgICAgICAgICBmWzBdID0gLWwgKiB0OwogICAgICAgICAgICBmWzFdID0gLXAgKiB0OwogICAgICAgICAgICBmWzJdID0gLXIgKiB0OwogICAgICAgICAgICBmWzNdID0gaCAqIHQ7CiAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgfSwKICAgICAgICBjb25qdWdhdGU6IGZ1bmN0aW9uKGYsIGgpIHsKICAgICAgICAgICAgZlswXSA9IC1oWzBdOwogICAgICAgICAgICBmWzFdID0gLWhbMV07CiAgICAgICAgICAgIGZbMl0gPSAtaFsyXTsKICAgICAgICAgICAgZlszXSA9IGhbM107CiAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgfSwKICAgICAgICBmcm9tTWF0MzogVWEsCiAgICAgICAgZnJvbUV1bGVyOiBmdW5jdGlvbihmLCBoLCBsLCBwKSB7CiAgICAgICAgICAgIHZhciByID0gNCA8IGFyZ3VtZW50cy5sZW5ndGggJiYgdm9pZCAwICE9PSBhcmd1bWVudHNbNF0gPyBhcmd1bWVudHNbNF0gOiAienl4IiwKICAgICAgICAgICAgICAgIHQgPSBNYXRoLlBJIC8gMzYwOwogICAgICAgICAgICBoICo9IHQ7CiAgICAgICAgICAgIHAgKj0gdDsKICAgICAgICAgICAgbCAqPSB0OwogICAgICAgICAgICB0ID0gTWF0aC5zaW4oaCk7CiAgICAgICAgICAgIHZhciB2ID0gTWF0aC5jb3MoaCksCiAgICAgICAgICAgICAgICB4ID0gTWF0aC5zaW4obCksCiAgICAgICAgICAgICAgICB5ID0gTWF0aC5jb3MobCksCiAgICAgICAgICAgICAgICBBID0gTWF0aC5zaW4ocCksCiAgICAgICAgICAgICAgICBCID0gTWF0aC5jb3MocCk7CiAgICAgICAgICAgIHN3aXRjaCAocikgewogICAgICAgICAgICAgICAgY2FzZSAieHl6IjoKICAgICAgICAgICAgICAgICAgICBmWzBdID0gdCAqIHkgKiBCICsgdiAqIHggKiBBOwogICAgICAgICAgICAgICAgICAgIGZbMV0gPSB2ICogeCAqIEIgLSB0ICogeSAqIEE7CiAgICAgICAgICAgICAgICAgICAgZlsyXSA9IHYgKiB5ICogQSArIHQgKiB4ICogQjsKICAgICAgICAgICAgICAgICAgICBmWzNdID0gdiAqIHkgKiBCIC0gdCAqIHggKiBBOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAieHp5IjoKICAgICAgICAgICAgICAgICAgICBmWzBdID0gdCAqIHkgKiBCIC0gdiAqIHggKiBBOwogICAgICAgICAgICAgICAgICAgIGZbMV0gPSB2ICogeCAqIEIgLSB0ICogeSAqIEE7CiAgICAgICAgICAgICAgICAgICAgZlsyXSA9IHYgKiB5ICogQSArIHQgKiB4ICogQjsKICAgICAgICAgICAgICAgICAgICBmWzNdID0gdiAqIHkgKiBCICsgdCAqIHggKiBBOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAieXh6IjoKICAgICAgICAgICAgICAgICAgICBmWzBdID0gdCAqIHkgKiBCICsgdiAqIHggKiBBOwogICAgICAgICAgICAgICAgICAgIGZbMV0gPSB2ICogeCAqIEIgLSB0ICogeSAqIEE7CiAgICAgICAgICAgICAgICAgICAgZlsyXSA9IHYgKiB5ICogQSAtIHQgKiB4ICogQjsKICAgICAgICAgICAgICAgICAgICBmWzNdID0gdiAqIHkgKiBCICsgdCAqIHggKiBBOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAieXp4IjoKICAgICAgICAgICAgICAgICAgICBmWzBdID0KICAgICAgICAgICAgICAgICAgICAgICAgdCAqIHkgKiBCICsgdiAqIHggKiBBOwogICAgICAgICAgICAgICAgICAgIGZbMV0gPSB2ICogeCAqIEIgKyB0ICogeSAqIEE7CiAgICAgICAgICAgICAgICAgICAgZlsyXSA9IHYgKiB5ICogQSAtIHQgKiB4ICogQjsKICAgICAgICAgICAgICAgICAgICBmWzNdID0gdiAqIHkgKiBCIC0gdCAqIHggKiBBOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAienh5IjoKICAgICAgICAgICAgICAgICAgICBmWzBdID0gdCAqIHkgKiBCIC0gdiAqIHggKiBBOwogICAgICAgICAgICAgICAgICAgIGZbMV0gPSB2ICogeCAqIEIgKyB0ICogeSAqIEE7CiAgICAgICAgICAgICAgICAgICAgZlsyXSA9IHYgKiB5ICogQSArIHQgKiB4ICogQjsKICAgICAgICAgICAgICAgICAgICBmWzNdID0gdiAqIHkgKiBCIC0gdCAqIHggKiBBOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAienl4IjoKICAgICAgICAgICAgICAgICAgICBmWzBdID0gdCAqIHkgKiBCIC0gdiAqIHggKiBBOwogICAgICAgICAgICAgICAgICAgIGZbMV0gPSB2ICogeCAqIEIgKyB0ICogeSAqIEE7CiAgICAgICAgICAgICAgICAgICAgZlsyXSA9IHYgKiB5ICogQSAtIHQgKiB4ICogQjsKICAgICAgICAgICAgICAgICAgICBmWzNdID0gdiAqIHkgKiBCICsgdCAqIHggKiBBOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICB0aHJvdyBFcnJvcigiVW5rbm93biBhbmdsZSBvcmRlciAiICsgcik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICB9LAogICAgICAgIHN0cjogZnVuY3Rpb24oZikgewogICAgICAgICAgICByZXR1cm4gInF1YXQoIiArIGZbMF0gKyAiLCAiICsgZlsxXSArICIsICIgKyBmWzJdICsgIiwgIiArIGZbM10gKyAiKSIKICAgICAgICB9LAogICAgICAgIGNsb25lOiBDYSwKICAgICAgICBmcm9tVmFsdWVzOiBEYSwKICAgICAgICBjb3B5OiBxYSwKICAgICAgICBzZXQ6IEVhLAogICAgICAgIGFkZDogRmEsCiAgICAgICAgbXVsOiBPYSwKICAgICAgICBzY2FsZTogdWEsCiAgICAgICAgZG90OiBrYSwKICAgICAgICBsZXJwOiBMYSwKICAgICAgICBsZW5ndGg6IGphLAogICAgICAgIGxlbjogamEsCiAgICAgICAgc3F1YXJlZExlbmd0aDogaWEsCiAgICAgICAgc3FyTGVuOiBpYSwKICAgICAgICBub3JtYWxpemU6IHJhLAogICAgICAgIGV4YWN0RXF1YWxzOiBNYSwKICAgICAgICBlcXVhbHM6IGZ1bmN0aW9uKGYsIGgpIHsKICAgICAgICAgICAgcmV0dXJuIC45OTk5OTkgPD0gTWF0aC5hYnMoa2EoZiwgaCkpCiAgICAgICAgfSwKICAgICAgICByb3RhdGlvblRvOiB4YSwKICAgICAgICBzcWxlcnA6IHlhLAogICAgICAgIHNldEF4ZXM6IG5hCiAgICB9KTsKICAgIHlhID0gT2JqZWN0LmZyZWV6ZSh7CiAgICAgICAgX19wcm90b19fOiBudWxsLAogICAgICAgIGNyZWF0ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBmID0gbmV3IFUoOCk7CiAgICAgICAgICAgIFUgIT0gRmxvYXQzMkFycmF5ICYmIChmWzBdID0gMCwgZlsxXSA9IDAsIGZbMl0gPSAwLCBmWzRdID0gMCwgZls1XSA9IDAsIGZbNl0gPSAwLCBmWzddID0gMCk7CiAgICAgICAgICAgIGZbM10gPSAxOwogICAgICAgICAgICByZXR1cm4gZgogICAgICAgIH0sCiAgICAgICAgY2xvbmU6IGZ1bmN0aW9uKGYpIHsKICAgICAgICAgICAgdmFyIGggPSBuZXcgVSg4KTsKICAgICAgICAgICAgaFswXSA9IGZbMF07CiAgICAgICAgICAgIGhbMV0gPSBmWzFdOwogICAgICAgICAgICBoWzJdID0gZlsyXTsKICAgICAgICAgICAgaFszXSA9IGZbM107CiAgICAgICAgICAgIGhbNF0gPSBmWzRdOwogICAgICAgICAgICBoWzVdID0gZls1XTsKICAgICAgICAgICAgaFs2XSA9IGZbNl07CiAgICAgICAgICAgIGhbN10gPSBmWzddOwogICAgICAgICAgICByZXR1cm4gaAogICAgICAgIH0sCiAgICAgICAgZnJvbVZhbHVlczogZnVuY3Rpb24oZiwgaCwgbCwgcCwgciwgdCwgdiwgeCkgewogICAgICAgICAgICB2YXIgeSA9IG5ldyBVKDgpOwogICAgICAgICAgICB5WzBdID0gZjsKICAgICAgICAgICAgeVsxXSA9IGg7CiAgICAgICAgICAgIHlbMl0gPSBsOwogICAgICAgICAgICB5WzNdID0gcDsKICAgICAgICAgICAgeVs0XSA9IHI7CiAgICAgICAgICAgIHlbNV0gPSB0OwogICAgICAgICAgICB5WzZdID0gdjsKICAgICAgICAgICAgeVs3XSA9IHg7CiAgICAgICAgICAgIHJldHVybiB5CiAgICAgICAgfSwKICAgICAgICBmcm9tUm90YXRpb25UcmFuc2xhdGlvblZhbHVlczogZnVuY3Rpb24oZiwKICAgICAgICAgICAgaCwgbCwgcCwgciwgdCwgdikgewogICAgICAgICAgICB2YXIgeCA9IG5ldyBVKDgpOwogICAgICAgICAgICB4WzBdID0gZjsKICAgICAgICAgICAgeFsxXSA9IGg7CiAgICAgICAgICAgIHhbMl0gPSBsOwogICAgICAgICAgICB4WzNdID0gcDsKICAgICAgICAgICAgciAqPSAuNTsKICAgICAgICAgICAgdCAqPSAuNTsKICAgICAgICAgICAgdiAqPSAuNTsKICAgICAgICAgICAgeFs0XSA9IHIgKiBwICsgdCAqIGwgLSB2ICogaDsKICAgICAgICAgICAgeFs1XSA9IHQgKiBwICsgdiAqIGYgLSByICogbDsKICAgICAgICAgICAgeFs2XSA9IHYgKiBwICsgciAqIGggLSB0ICogZjsKICAgICAgICAgICAgeFs3XSA9IC1yICogZiAtIHQgKiBoIC0gdiAqIGw7CiAgICAgICAgICAgIHJldHVybiB4CiAgICAgICAgfSwKICAgICAgICBmcm9tUm90YXRpb25UcmFuc2xhdGlvbjogVmEsCiAgICAgICAgZnJvbVRyYW5zbGF0aW9uOiBmdW5jdGlvbihmLCBoKSB7CiAgICAgICAgICAgIGZbMF0gPSAwOwogICAgICAgICAgICBmWzFdID0gMDsKICAgICAgICAgICAgZlsyXSA9IDA7CiAgICAgICAgICAgIGZbM10gPSAxOwogICAgICAgICAgICBmWzRdID0gLjUgKiBoWzBdOwogICAgICAgICAgICBmWzVdID0gLjUgKiBoWzFdOwogICAgICAgICAgICBmWzZdID0gLjUgKiBoWzJdOwogICAgICAgICAgICBmWzddID0gMDsKICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICB9LAogICAgICAgIGZyb21Sb3RhdGlvbjogZnVuY3Rpb24oZiwgaCkgewogICAgICAgICAgICBmWzBdID0gaFswXTsKICAgICAgICAgICAgZlsxXSA9IGhbMV07CiAgICAgICAgICAgIGZbMl0gPSBoWzJdOwogICAgICAgICAgICBmWzNdID0gaFszXTsKICAgICAgICAgICAgZls0XSA9IDA7CiAgICAgICAgICAgIGZbNV0gPSAwOwogICAgICAgICAgICBmWzZdID0gMDsKICAgICAgICAgICAgZls3XSA9IDA7CiAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgfSwKICAgICAgICBmcm9tTWF0NDogZnVuY3Rpb24oZiwgaCkgewogICAgICAgICAgICB2YXIgbCA9IHNhKCk7CiAgICAgICAgICAgIEMobCwgaCk7CiAgICAgICAgICAgIHZhciBwID0gbmV3IFUoMyk7CiAgICAgICAgICAgIHcocCwgaCk7CiAgICAgICAgICAgIFZhKGYsIGwsIHApOwogICAgICAgICAgICByZXR1cm4gZgogICAgICAgIH0sCiAgICAgICAgY29weTogV2EsCiAgICAgICAgaWRlbnRpdHk6IGZ1bmN0aW9uKGYpIHsKICAgICAgICAgICAgZlswXSA9CiAgICAgICAgICAgICAgICAwOwogICAgICAgICAgICBmWzFdID0gMDsKICAgICAgICAgICAgZlsyXSA9IDA7CiAgICAgICAgICAgIGZbM10gPSAxOwogICAgICAgICAgICBmWzRdID0gMDsKICAgICAgICAgICAgZls1XSA9IDA7CiAgICAgICAgICAgIGZbNl0gPSAwOwogICAgICAgICAgICBmWzddID0gMDsKICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICB9LAogICAgICAgIHNldDogZnVuY3Rpb24oZiwgaCwgbCwgcCwgciwgdCwgdiwgeCwgeSkgewogICAgICAgICAgICBmWzBdID0gaDsKICAgICAgICAgICAgZlsxXSA9IGw7CiAgICAgICAgICAgIGZbMl0gPSBwOwogICAgICAgICAgICBmWzNdID0gcjsKICAgICAgICAgICAgZls0XSA9IHQ7CiAgICAgICAgICAgIGZbNV0gPSB2OwogICAgICAgICAgICBmWzZdID0geDsKICAgICAgICAgICAgZls3XSA9IHk7CiAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgfSwKICAgICAgICBnZXRSZWFsOiBxYSwKICAgICAgICBnZXREdWFsOiBmdW5jdGlvbihmLCBoKSB7CiAgICAgICAgICAgIGZbMF0gPSBoWzRdOwogICAgICAgICAgICBmWzFdID0gaFs1XTsKICAgICAgICAgICAgZlsyXSA9IGhbNl07CiAgICAgICAgICAgIGZbM10gPSBoWzddOwogICAgICAgICAgICByZXR1cm4gZgogICAgICAgIH0sCiAgICAgICAgc2V0UmVhbDogcWEsCiAgICAgICAgc2V0RHVhbDogZnVuY3Rpb24oZiwgaCkgewogICAgICAgICAgICBmWzRdID0gaFswXTsKICAgICAgICAgICAgZls1XSA9IGhbMV07CiAgICAgICAgICAgIGZbNl0gPSBoWzJdOwogICAgICAgICAgICBmWzddID0gaFszXTsKICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICB9LAogICAgICAgIGdldFRyYW5zbGF0aW9uOiBmdW5jdGlvbihmLCBoKSB7CiAgICAgICAgICAgIHZhciBsID0gaFs0XSwKICAgICAgICAgICAgICAgIHAgPSBoWzVdLAogICAgICAgICAgICAgICAgciA9IGhbNl0sCiAgICAgICAgICAgICAgICB0ID0gaFs3XSwKICAgICAgICAgICAgICAgIHYgPSAtaFswXSwKICAgICAgICAgICAgICAgIHggPSAtaFsxXSwKICAgICAgICAgICAgICAgIHkgPSAtaFsyXTsKICAgICAgICAgICAgaCA9IGhbM107CiAgICAgICAgICAgIGZbMF0gPSAyICogKGwgKiBoICsgdCAqIHYgKyBwICogeSAtIHIgKiB4KTsKICAgICAgICAgICAgZlsxXSA9IDIgKiAocCAqIGggKyB0ICogeCArIHIgKiB2IC0gbCAqIHkpOwogICAgICAgICAgICBmWzJdID0gMiAqIChyICogaCArIHQgKiB5ICsgbCAqIHggLSBwICogdik7CiAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgfSwKICAgICAgICB0cmFuc2xhdGU6IGZ1bmN0aW9uKGYsIGgsIGwpIHsKICAgICAgICAgICAgdmFyIHAgPSBoWzBdLAogICAgICAgICAgICAgICAgciA9IGhbMV0sCiAgICAgICAgICAgICAgICB0ID0gaFsyXSwKICAgICAgICAgICAgICAgIHYgPSBoWzNdLAogICAgICAgICAgICAgICAgeCA9IC41ICogbFswXSwKICAgICAgICAgICAgICAgIHkgPSAuNSAqIGxbMV07CiAgICAgICAgICAgIGwgPSAuNSAqIGxbMl07CiAgICAgICAgICAgIHZhciBBID0gaFs0XSwKICAgICAgICAgICAgICAgIEIgPSBoWzVdLAogICAgICAgICAgICAgICAgRyA9IGhbNl07CiAgICAgICAgICAgIGggPSBoWzddOwogICAgICAgICAgICBmWzBdID0gcDsKICAgICAgICAgICAgZlsxXSA9IHI7CiAgICAgICAgICAgIGZbMl0gPSB0OwogICAgICAgICAgICBmWzNdID0gdjsKICAgICAgICAgICAgZls0XSA9IHYgKiB4ICsgciAqIGwgLSB0ICogeSArIEE7CiAgICAgICAgICAgIGZbNV0gPSB2ICogeSArIHQgKiB4IC0gcCAqIGwgKyBCOwogICAgICAgICAgICBmWzZdID0gdiAqIGwgKyBwICogeSAtIHIgKiB4ICsgRzsKICAgICAgICAgICAgZls3XSA9IC1wICogeCAtIHIgKiB5IC0gdCAqIGwgKyBoOwogICAgICAgICAgICByZXR1cm4gZgogICAgICAgIH0sCiAgICAgICAgcm90YXRlWDogZnVuY3Rpb24oZiwgaCwgbCkgewogICAgICAgICAgICB2YXIgcCA9IC1oWzBdLAogICAgICAgICAgICAgICAgciA9IC1oWzFdLAogICAgICAgICAgICAgICAgdCA9IC1oWzJdLAogICAgICAgICAgICAgICAgdiA9IGhbM10sCiAgICAgICAgICAgICAgICB4ID0gaFs0XSwKICAgICAgICAgICAgICAgIHkgPSBoWzVdLAogICAgICAgICAgICAgICAgQSA9IGhbNl0sCiAgICAgICAgICAgICAgICBCID0gaFs3XSwKICAgICAgICAgICAgICAgIEcgPSB4ICogdiArIEIgKiBwICsgeSAqIHQgLSBBICogciwKICAgICAgICAgICAgICAgIEkgPSB5ICogdiArIEIgKiByICsgQSAqIHAgLSB4ICogdCwKICAgICAgICAgICAgICAgIEggPSBBICogdiArIEIgKiB0ICsgeCAqIHIgLSB5ICogcDsKICAgICAgICAgICAgeCA9IEIgKiB2IC0geCAqIHAgLSB5ICogciAtIEEgKiB0OwogICAgICAgICAgICBQYShmLCBoLCBsKTsKICAgICAgICAgICAgcCA9IGZbMF07CiAgICAgICAgICAgIHIgPSBmWzFdOwogICAgICAgICAgICB0ID0gZlsyXTsKICAgICAgICAgICAgdiA9IGZbM107CiAgICAgICAgICAgIGZbNF0gPSBHICogdiArIHggKiBwICsgSSAqIHQgLSBIICogcjsKICAgICAgICAgICAgZls1XSA9IEkgKiB2ICsgeCAqIHIgKyBIICogcCAtIEcgKiB0OwogICAgICAgICAgICBmWzZdID0gSCAqIHYgKyB4ICogdCArIEcgKiByIC0gSSAqIHA7CiAgICAgICAgICAgIGZbN10gPSB4ICoKICAgICAgICAgICAgICAgIHYgLSBHICogcCAtIEkgKiByIC0gSCAqIHQ7CiAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgfSwKICAgICAgICByb3RhdGVZOiBmdW5jdGlvbihmLCBoLCBsKSB7CiAgICAgICAgICAgIHZhciBwID0gLWhbMF0sCiAgICAgICAgICAgICAgICByID0gLWhbMV0sCiAgICAgICAgICAgICAgICB0ID0gLWhbMl0sCiAgICAgICAgICAgICAgICB2ID0gaFszXSwKICAgICAgICAgICAgICAgIHggPSBoWzRdLAogICAgICAgICAgICAgICAgeSA9IGhbNV0sCiAgICAgICAgICAgICAgICBBID0gaFs2XSwKICAgICAgICAgICAgICAgIEIgPSBoWzddLAogICAgICAgICAgICAgICAgRyA9IHggKiB2ICsgQiAqIHAgKyB5ICogdCAtIEEgKiByLAogICAgICAgICAgICAgICAgSSA9IHkgKiB2ICsgQiAqIHIgKyBBICogcCAtIHggKiB0LAogICAgICAgICAgICAgICAgSCA9IEEgKiB2ICsgQiAqIHQgKyB4ICogciAtIHkgKiBwOwogICAgICAgICAgICB4ID0gQiAqIHYgLSB4ICogcCAtIHkgKiByIC0gQSAqIHQ7CiAgICAgICAgICAgIFFhKGYsIGgsIGwpOwogICAgICAgICAgICBwID0gZlswXTsKICAgICAgICAgICAgciA9IGZbMV07CiAgICAgICAgICAgIHQgPSBmWzJdOwogICAgICAgICAgICB2ID0gZlszXTsKICAgICAgICAgICAgZls0XSA9IEcgKiB2ICsgeCAqIHAgKyBJICogdCAtIEggKiByOwogICAgICAgICAgICBmWzVdID0gSSAqIHYgKyB4ICogciArIEggKiBwIC0gRyAqIHQ7CiAgICAgICAgICAgIGZbNl0gPSBIICogdiArIHggKiB0ICsgRyAqIHIgLSBJICogcDsKICAgICAgICAgICAgZls3XSA9IHggKiB2IC0gRyAqIHAgLSBJICogciAtIEggKiB0OwogICAgICAgICAgICByZXR1cm4gZgogICAgICAgIH0sCiAgICAgICAgcm90YXRlWjogZnVuY3Rpb24oZiwgaCwgbCkgewogICAgICAgICAgICB2YXIgcCA9IC1oWzBdLAogICAgICAgICAgICAgICAgciA9IC1oWzFdLAogICAgICAgICAgICAgICAgdCA9IC1oWzJdLAogICAgICAgICAgICAgICAgdiA9IGhbM10sCiAgICAgICAgICAgICAgICB4ID0gaFs0XSwKICAgICAgICAgICAgICAgIHkgPSBoWzVdLAogICAgICAgICAgICAgICAgQSA9IGhbNl0sCiAgICAgICAgICAgICAgICBCID0gaFs3XSwKICAgICAgICAgICAgICAgIEcgPSB4ICogdiArIEIgKiBwICsgeSAqIHQgLSBBICogciwKICAgICAgICAgICAgICAgIEkgPSB5ICogdiArIEIgKiByICsgQSAqIHAgLSB4ICogdCwKICAgICAgICAgICAgICAgIEggPSBBICogdiArIEIgKiB0ICsgeCAqIHIgLSB5ICogcDsKICAgICAgICAgICAgeCA9IEIgKiB2IC0geCAqIHAgLSB5ICogciAtIEEgKiB0OwogICAgICAgICAgICBSYShmLCBoLCBsKTsKICAgICAgICAgICAgcCA9IGZbMF07CiAgICAgICAgICAgIHIgPSBmWzFdOwogICAgICAgICAgICB0ID0gZlsyXTsKICAgICAgICAgICAgdiA9IGZbM107CiAgICAgICAgICAgIGZbNF0gPSBHICogdiArIHggKiBwICsgSSAqIHQgLSBIICogcjsKICAgICAgICAgICAgZls1XSA9IEkgKiB2ICsgeCAqIHIgKyBIICogcCAtIEcgKiB0OwogICAgICAgICAgICBmWzZdID0gSCAqIHYgKyB4ICogdCArIEcgKiByIC0gSSAqIHA7CiAgICAgICAgICAgIGZbN10gPSB4ICogdiAtIEcgKiBwIC0gSSAqIHIgLSBIICogdDsKICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICB9LAogICAgICAgIHJvdGF0ZUJ5UXVhdEFwcGVuZDogZnVuY3Rpb24oZiwgaCwgbCkgewogICAgICAgICAgICB2YXIgcCA9IGxbMF0sCiAgICAgICAgICAgICAgICByID0gbFsxXSwKICAgICAgICAgICAgICAgIHQgPSBsWzJdOwogICAgICAgICAgICBsID0gbFszXTsKICAgICAgICAgICAgdmFyIHYgPSBoWzBdLAogICAgICAgICAgICAgICAgeCA9IGhbMV0sCiAgICAgICAgICAgICAgICB5ID0gaFsyXSwKICAgICAgICAgICAgICAgIEEgPSBoWzNdOwogICAgICAgICAgICBmWzBdID0gdiAqIGwgKyBBICogcCArIHggKiB0IC0geSAqIHI7CiAgICAgICAgICAgIGZbMV0gPSB4ICogbCArIEEgKiByICsgeSAqIHAgLSB2ICogdDsKICAgICAgICAgICAgZlsyXSA9IHkgKiBsICsgQSAqIHQgKyB2ICogciAtIHggKiBwOwogICAgICAgICAgICBmWzNdID0gQSAqIGwgLSB2ICogcCAtIHggKiByIC0geSAqIHQ7CiAgICAgICAgICAgIHYgPSBoWzRdOwogICAgICAgICAgICB4ID0gaFs1XTsKICAgICAgICAgICAgeSA9IGhbNl07CiAgICAgICAgICAgIEEgPSBoWzddOwogICAgICAgICAgICBmWzRdID0gdiAqIGwgKyBBICogcCArIHggKiB0IC0geSAqIHI7CiAgICAgICAgICAgIGZbNV0gPSB4ICogbCArIEEgKiByICsgeSAqIHAgLSB2ICogdDsKICAgICAgICAgICAgZls2XSA9IHkgKiBsICsgQSAqIHQgKyB2ICogciAtIHggKiBwOwogICAgICAgICAgICBmWzddID0gQSAqIGwgLSB2ICogcCAtIHggKiByIC0geSAqIHQ7CiAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgfSwKICAgICAgICByb3RhdGVCeVF1YXRQcmVwZW5kOiBmdW5jdGlvbihmLCBoLCBsKSB7CiAgICAgICAgICAgIHZhciBwID0gaFswXSwKICAgICAgICAgICAgICAgIHIgPSBoWzFdLAogICAgICAgICAgICAgICAgdCA9IGhbMl07CiAgICAgICAgICAgIGggPSBoWzNdOwogICAgICAgICAgICB2YXIgdiA9IGxbMF0sCiAgICAgICAgICAgICAgICB4ID0gbFsxXSwKICAgICAgICAgICAgICAgIHkgPSBsWzJdLAogICAgICAgICAgICAgICAgQSA9CiAgICAgICAgICAgICAgICBsWzNdOwogICAgICAgICAgICBmWzBdID0gcCAqIEEgKyBoICogdiArIHIgKiB5IC0gdCAqIHg7CiAgICAgICAgICAgIGZbMV0gPSByICogQSArIGggKiB4ICsgdCAqIHYgLSBwICogeTsKICAgICAgICAgICAgZlsyXSA9IHQgKiBBICsgaCAqIHkgKyBwICogeCAtIHIgKiB2OwogICAgICAgICAgICBmWzNdID0gaCAqIEEgLSBwICogdiAtIHIgKiB4IC0gdCAqIHk7CiAgICAgICAgICAgIHYgPSBsWzRdOwogICAgICAgICAgICB4ID0gbFs1XTsKICAgICAgICAgICAgeSA9IGxbNl07CiAgICAgICAgICAgIEEgPSBsWzddOwogICAgICAgICAgICBmWzRdID0gcCAqIEEgKyBoICogdiArIHIgKiB5IC0gdCAqIHg7CiAgICAgICAgICAgIGZbNV0gPSByICogQSArIGggKiB4ICsgdCAqIHYgLSBwICogeTsKICAgICAgICAgICAgZls2XSA9IHQgKiBBICsgaCAqIHkgKyBwICogeCAtIHIgKiB2OwogICAgICAgICAgICBmWzddID0gaCAqIEEgLSBwICogdiAtIHIgKiB4IC0gdCAqIHk7CiAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgfSwKICAgICAgICByb3RhdGVBcm91bmRBeGlzOiBmdW5jdGlvbihmLCBoLCBsLCBwKSB7CiAgICAgICAgICAgIGlmICgxRS02ID4gTWF0aC5hYnMocCkpIHJldHVybiBXYShmLCBoKTsKICAgICAgICAgICAgdmFyIHIgPSBNYXRoLmh5cG90KGxbMF0sIGxbMV0sIGxbMl0pOwogICAgICAgICAgICBwICo9IC41OwogICAgICAgICAgICB2YXIgdCA9IE1hdGguc2luKHApLAogICAgICAgICAgICAgICAgdiA9IHQgKiBsWzBdIC8gciwKICAgICAgICAgICAgICAgIHggPSB0ICogbFsxXSAvIHI7CiAgICAgICAgICAgIGwgPSB0ICogbFsyXSAvIHI7CiAgICAgICAgICAgIHAgPSBNYXRoLmNvcyhwKTsKICAgICAgICAgICAgciA9IGhbMF07CiAgICAgICAgICAgIHQgPSBoWzFdOwogICAgICAgICAgICB2YXIgeSA9IGhbMl0sCiAgICAgICAgICAgICAgICBBID0gaFszXTsKICAgICAgICAgICAgZlswXSA9IHIgKiBwICsgQSAqIHYgKyB0ICogbCAtIHkgKiB4OwogICAgICAgICAgICBmWzFdID0gdCAqIHAgKyBBICogeCArIHkgKiB2IC0gciAqIGw7CiAgICAgICAgICAgIGZbMl0gPSB5ICogcCArIEEgKiBsICsgciAqIHggLSB0ICogdjsKICAgICAgICAgICAgZlszXSA9IEEgKiBwIC0gciAqIHYgLSB0ICogeCAtIHkgKiBsOwogICAgICAgICAgICByID0gaFs0XTsKICAgICAgICAgICAgdCA9IGhbNV07CiAgICAgICAgICAgIHkgPSBoWzZdOwogICAgICAgICAgICBoID0gaFs3XTsKICAgICAgICAgICAgZls0XSA9IHIgKiBwICsgaCAqIHYgKyB0ICogbCAtIHkgKiB4OwogICAgICAgICAgICBmWzVdID0gdCAqIHAgKyBoICogeCArIHkgKiB2IC0gciAqIGw7CiAgICAgICAgICAgIGZbNl0gPSB5ICogcCArIGggKiBsICsgciAqIHggLSB0ICogdjsKICAgICAgICAgICAgZls3XSA9IGggKiBwIC0gciAqIHYgLSB0ICogeCAtIHkgKiBsOwogICAgICAgICAgICByZXR1cm4gZgogICAgICAgIH0sCiAgICAgICAgYWRkOiBmdW5jdGlvbihmLCBoLCBsKSB7CiAgICAgICAgICAgIGZbMF0gPSBoWzBdICsgbFswXTsKICAgICAgICAgICAgZlsxXSA9IGhbMV0gKyBsWzFdOwogICAgICAgICAgICBmWzJdID0gaFsyXSArIGxbMl07CiAgICAgICAgICAgIGZbM10gPSBoWzNdICsgbFszXTsKICAgICAgICAgICAgZls0XSA9IGhbNF0gKyBsWzRdOwogICAgICAgICAgICBmWzVdID0gaFs1XSArIGxbNV07CiAgICAgICAgICAgIGZbNl0gPSBoWzZdICsgbFs2XTsKICAgICAgICAgICAgZls3XSA9IGhbN10gKyBsWzddOwogICAgICAgICAgICByZXR1cm4gZgogICAgICAgIH0sCiAgICAgICAgbXVsdGlwbHk6IFhhLAogICAgICAgIG11bDogWGEsCiAgICAgICAgc2NhbGU6IGZ1bmN0aW9uKGYsIGgsIGwpIHsKICAgICAgICAgICAgZlswXSA9IGhbMF0gKiBsOwogICAgICAgICAgICBmWzFdID0gaFsxXSAqIGw7CiAgICAgICAgICAgIGZbMl0gPSBoWzJdICogbDsKICAgICAgICAgICAgZlszXSA9IGhbM10gKiBsOwogICAgICAgICAgICBmWzRdID0gaFs0XSAqIGw7CiAgICAgICAgICAgIGZbNV0gPSBoWzVdICogbDsKICAgICAgICAgICAgZls2XSA9IGhbNl0gKiBsOwogICAgICAgICAgICBmWzddID0gaFs3XSAqIGw7CiAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgfSwKICAgICAgICBkb3Q6IGthLAogICAgICAgIGxlcnA6IGZ1bmN0aW9uKGYsIGgsIGwsIHApIHsKICAgICAgICAgICAgdmFyIHIgPSAxIC0gcDsKICAgICAgICAgICAgMCA+IGthKGgsIGwpICYmIChwID0gLXApOwogICAgICAgICAgICBmWzBdID0gaFswXSAqIHIgKyBsWzBdICogcDsKICAgICAgICAgICAgZlsxXSA9CiAgICAgICAgICAgICAgICBoWzFdICogciArIGxbMV0gKiBwOwogICAgICAgICAgICBmWzJdID0gaFsyXSAqIHIgKyBsWzJdICogcDsKICAgICAgICAgICAgZlszXSA9IGhbM10gKiByICsgbFszXSAqIHA7CiAgICAgICAgICAgIGZbNF0gPSBoWzRdICogciArIGxbNF0gKiBwOwogICAgICAgICAgICBmWzVdID0gaFs1XSAqIHIgKyBsWzVdICogcDsKICAgICAgICAgICAgZls2XSA9IGhbNl0gKiByICsgbFs2XSAqIHA7CiAgICAgICAgICAgIGZbN10gPSBoWzddICogciArIGxbN10gKiBwOwogICAgICAgICAgICByZXR1cm4gZgogICAgICAgIH0sCiAgICAgICAgaW52ZXJ0OiBmdW5jdGlvbihmLCBoKSB7CiAgICAgICAgICAgIHZhciBsID0gaWEoaCk7CiAgICAgICAgICAgIGZbMF0gPSAtaFswXSAvIGw7CiAgICAgICAgICAgIGZbMV0gPSAtaFsxXSAvIGw7CiAgICAgICAgICAgIGZbMl0gPSAtaFsyXSAvIGw7CiAgICAgICAgICAgIGZbM10gPSBoWzNdIC8gbDsKICAgICAgICAgICAgZls0XSA9IC1oWzRdIC8gbDsKICAgICAgICAgICAgZls1XSA9IC1oWzVdIC8gbDsKICAgICAgICAgICAgZls2XSA9IC1oWzZdIC8gbDsKICAgICAgICAgICAgZls3XSA9IGhbN10gLyBsOwogICAgICAgICAgICByZXR1cm4gZgogICAgICAgIH0sCiAgICAgICAgY29uanVnYXRlOiBmdW5jdGlvbihmLCBoKSB7CiAgICAgICAgICAgIGZbMF0gPSAtaFswXTsKICAgICAgICAgICAgZlsxXSA9IC1oWzFdOwogICAgICAgICAgICBmWzJdID0gLWhbMl07CiAgICAgICAgICAgIGZbM10gPSBoWzNdOwogICAgICAgICAgICBmWzRdID0gLWhbNF07CiAgICAgICAgICAgIGZbNV0gPSAtaFs1XTsKICAgICAgICAgICAgZls2XSA9IC1oWzZdOwogICAgICAgICAgICBmWzddID0gaFs3XTsKICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICB9LAogICAgICAgIGxlbmd0aDogamEsCiAgICAgICAgbGVuOiBqYSwKICAgICAgICBzcXVhcmVkTGVuZ3RoOiBpYSwKICAgICAgICBzcXJMZW46IGlhLAogICAgICAgIG5vcm1hbGl6ZTogZnVuY3Rpb24oZiwgaCkgewogICAgICAgICAgICB2YXIgbCA9IGlhKGgpOwogICAgICAgICAgICBpZiAoMCA8IGwpIHsKICAgICAgICAgICAgICAgIGwgPSBNYXRoLnNxcnQobCk7CiAgICAgICAgICAgICAgICB2YXIgcCA9IGhbMF0gLyBsLAogICAgICAgICAgICAgICAgICAgIHIgPSBoWzFdIC8gbCwKICAgICAgICAgICAgICAgICAgICB0ID0gaFsyXSAvIGwsCiAgICAgICAgICAgICAgICAgICAgdiA9IGhbM10gLyBsLAogICAgICAgICAgICAgICAgICAgIHggPSBoWzRdLAogICAgICAgICAgICAgICAgICAgIHkgPSBoWzVdLAogICAgICAgICAgICAgICAgICAgIEEgPSBoWzZdOwogICAgICAgICAgICAgICAgaCA9IGhbN107CiAgICAgICAgICAgICAgICB2YXIgQiA9IHAgKiB4ICsgciAqIHkgKyB0ICogQSArIHYgKiBoOwogICAgICAgICAgICAgICAgZlswXSA9IHA7CiAgICAgICAgICAgICAgICBmWzFdID0gcjsKICAgICAgICAgICAgICAgIGZbMl0gPSB0OwogICAgICAgICAgICAgICAgZlszXSA9IHY7CiAgICAgICAgICAgICAgICBmWzRdID0gKHggLSBwICogQikgLyBsOwogICAgICAgICAgICAgICAgZls1XSA9ICh5IC0gciAqIEIpIC8gbDsKICAgICAgICAgICAgICAgIGZbNl0gPSAoQSAtIHQgKiBCKSAvIGw7CiAgICAgICAgICAgICAgICBmWzddID0gKGggLSB2ICogQikgLyBsCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICB9LAogICAgICAgIHN0cjogZnVuY3Rpb24oZikgewogICAgICAgICAgICByZXR1cm4gInF1YXQyKCIgKyBmWzBdICsgIiwgIiArIGZbMV0gKyAiLCAiICsgZlsyXSArICIsICIgKyBmWzNdICsgIiwgIiArIGZbNF0gKyAiLCAiICsgZls1XSArICIsICIgKyBmWzZdICsgIiwgIiArIGZbN10gKyAiKSIKICAgICAgICB9LAogICAgICAgIGV4YWN0RXF1YWxzOiBmdW5jdGlvbihmLCBoKSB7CiAgICAgICAgICAgIHJldHVybiBmWzBdID09PSBoWzBdICYmIGZbMV0gPT09IGhbMV0gJiYgZlsyXSA9PT0gaFsyXSAmJiBmWzNdID09PSBoWzNdICYmIGZbNF0gPT09IGhbNF0gJiYgZls1XSA9PT0gaFs1XSAmJiBmWzZdID09PSBoWzZdICYmIGZbN10gPT09IGhbN10KICAgICAgICB9LAogICAgICAgIGVxdWFsczogZnVuY3Rpb24oZiwgaCkgewogICAgICAgICAgICB2YXIgbCA9IGZbMF0sCiAgICAgICAgICAgICAgICBwID0gZlsxXSwKICAgICAgICAgICAgICAgIHIgPSBmWzJdLAogICAgICAgICAgICAgICAgdCA9IGZbM10sCiAgICAgICAgICAgICAgICB2ID0gZls0XSwKICAgICAgICAgICAgICAgIHggPSBmWzVdLAogICAgICAgICAgICAgICAgeSA9IGZbNl07CiAgICAgICAgICAgIGYgPSBmWzddOwogICAgICAgICAgICB2YXIgQSA9IGhbMF0sCiAgICAgICAgICAgICAgICBCID0gaFsxXSwKICAgICAgICAgICAgICAgIEcgPSBoWzJdLAogICAgICAgICAgICAgICAgSSA9IGhbM10sCiAgICAgICAgICAgICAgICBIID0gaFs0XSwKICAgICAgICAgICAgICAgIE0gPSBoWzVdLAogICAgICAgICAgICAgICAgTiA9IGhbNl07CiAgICAgICAgICAgIGggPSBoWzddOwogICAgICAgICAgICByZXR1cm4gTWF0aC5hYnMobCAtIEEpIDw9IDFFLTYgKiBNYXRoLm1heCgxLCBNYXRoLmFicyhsKSwgTWF0aC5hYnMoQSkpICYmIE1hdGguYWJzKHAgLSBCKSA8PSAxRS02ICogTWF0aC5tYXgoMSwgTWF0aC5hYnMocCksIE1hdGguYWJzKEIpKSAmJiBNYXRoLmFicyhyIC0gRykgPD0gMUUtNiAqIE1hdGgubWF4KDEsIE1hdGguYWJzKHIpLCBNYXRoLmFicyhHKSkgJiYgTWF0aC5hYnModCAtIEkpIDw9IDFFLTYgKiBNYXRoLm1heCgxLCBNYXRoLmFicyh0KSwgTWF0aC5hYnMoSSkpICYmIE1hdGguYWJzKHYgLSBIKSA8PSAxRS02ICogTWF0aC5tYXgoMSwgTWF0aC5hYnModiksIE1hdGguYWJzKEgpKSAmJiBNYXRoLmFicyh4IC0gTSkgPD0gMUUtNiAqIE1hdGgubWF4KDEsIE1hdGguYWJzKHgpLCBNYXRoLmFicyhNKSkgJiYgTWF0aC5hYnMoeSAtIE4pIDw9IDFFLTYgKiBNYXRoLm1heCgxLCBNYXRoLmFicyh5KSwgTWF0aC5hYnMoTikpICYmIE1hdGguYWJzKGYgLSBoKSA8PSAxRS02ICogTWF0aC5tYXgoMSwKICAgICAgICAgICAgICAgIE1hdGguYWJzKGYpLCBNYXRoLmFicyhoKSkKICAgICAgICB9CiAgICB9KTsKICAgIG5hID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGYgPSBZYSgpOwogICAgICAgIHJldHVybiBmdW5jdGlvbihoLCBsLCBwLCByLCB0LCB2KSB7CiAgICAgICAgICAgIGwgfHwgKGwgPSAyKTsKICAgICAgICAgICAgcCB8fCAocCA9IDApOwogICAgICAgICAgICBmb3IgKHIgPSByID8gTWF0aC5taW4ociAqIGwgKyBwLCBoLmxlbmd0aCkgOiBoLmxlbmd0aDsgcCA8IHI7IHAgKz0gbCkgZlswXSA9IGhbcF0sIGZbMV0gPSBoW3AgKyAxXSwgdChmLCBmLCB2KSwgaFtwXSA9IGZbMF0sIGhbcCArIDFdID0gZlsxXTsKICAgICAgICAgICAgcmV0dXJuIGgKICAgICAgICB9CiAgICB9KCk7CiAgICBuYSA9IE9iamVjdC5mcmVlemUoewogICAgICAgIF9fcHJvdG9fXzogbnVsbCwKICAgICAgICBjcmVhdGU6IFlhLAogICAgICAgIGNsb25lOiBmdW5jdGlvbihmKSB7CiAgICAgICAgICAgIHZhciBoID0gbmV3IFUoMik7CiAgICAgICAgICAgIGhbMF0gPSBmWzBdOwogICAgICAgICAgICBoWzFdID0gZlsxXTsKICAgICAgICAgICAgcmV0dXJuIGgKICAgICAgICB9LAogICAgICAgIGZyb21WYWx1ZXM6IGZ1bmN0aW9uKGYsIGgpIHsKICAgICAgICAgICAgdmFyIGwgPSBuZXcgVSgyKTsKICAgICAgICAgICAgbFswXSA9IGY7CiAgICAgICAgICAgIGxbMV0gPSBoOwogICAgICAgICAgICByZXR1cm4gbAogICAgICAgIH0sCiAgICAgICAgY29weTogZnVuY3Rpb24oZiwgaCkgewogICAgICAgICAgICBmWzBdID0gaFswXTsKICAgICAgICAgICAgZlsxXSA9IGhbMV07CiAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgfSwKICAgICAgICBzZXQ6IGZ1bmN0aW9uKGYsIGgsIGwpIHsKICAgICAgICAgICAgZlswXSA9IGg7CiAgICAgICAgICAgIGZbMV0gPSBsOwogICAgICAgICAgICByZXR1cm4gZgogICAgICAgIH0sCiAgICAgICAgYWRkOiBmdW5jdGlvbihmLCBoLCBsKSB7CiAgICAgICAgICAgIGZbMF0gPQogICAgICAgICAgICAgICAgaFswXSArIGxbMF07CiAgICAgICAgICAgIGZbMV0gPSBoWzFdICsgbFsxXTsKICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICB9LAogICAgICAgIHN1YnRyYWN0OiBaYSwKICAgICAgICBtdWx0aXBseTogJGEsCiAgICAgICAgZGl2aWRlOiBhYiwKICAgICAgICBjZWlsOiBmdW5jdGlvbihmLCBoKSB7CiAgICAgICAgICAgIGZbMF0gPSBNYXRoLmNlaWwoaFswXSk7CiAgICAgICAgICAgIGZbMV0gPSBNYXRoLmNlaWwoaFsxXSk7CiAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgfSwKICAgICAgICBmbG9vcjogZnVuY3Rpb24oZiwgaCkgewogICAgICAgICAgICBmWzBdID0gTWF0aC5mbG9vcihoWzBdKTsKICAgICAgICAgICAgZlsxXSA9IE1hdGguZmxvb3IoaFsxXSk7CiAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgfSwKICAgICAgICBtaW46IGZ1bmN0aW9uKGYsIGgsIGwpIHsKICAgICAgICAgICAgZlswXSA9IE1hdGgubWluKGhbMF0sIGxbMF0pOwogICAgICAgICAgICBmWzFdID0gTWF0aC5taW4oaFsxXSwgbFsxXSk7CiAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgfSwKICAgICAgICBtYXg6IGZ1bmN0aW9uKGYsIGgsIGwpIHsKICAgICAgICAgICAgZlswXSA9IE1hdGgubWF4KGhbMF0sIGxbMF0pOwogICAgICAgICAgICBmWzFdID0gTWF0aC5tYXgoaFsxXSwgbFsxXSk7CiAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgfSwKICAgICAgICByb3VuZDogZnVuY3Rpb24oZiwgaCkgewogICAgICAgICAgICBmWzBdID0gTWF0aC5yb3VuZChoWzBdKTsKICAgICAgICAgICAgZlsxXSA9IE1hdGgucm91bmQoaFsxXSk7CiAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgfSwKICAgICAgICBzY2FsZTogZnVuY3Rpb24oZiwgaCwgbCkgewogICAgICAgICAgICBmWzBdID0gaFswXSAqIGw7CiAgICAgICAgICAgIGZbMV0gPSBoWzFdICogbDsKICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICB9LAogICAgICAgIHNjYWxlQW5kQWRkOiBmdW5jdGlvbihmLCBoLCBsLCBwKSB7CiAgICAgICAgICAgIGZbMF0gPSBoWzBdICsgbFswXSAqIHA7CiAgICAgICAgICAgIGZbMV0gPSBoWzFdICsgbFsxXSAqIHA7CiAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgfSwKICAgICAgICBkaXN0YW5jZTogYmIsCiAgICAgICAgc3F1YXJlZERpc3RhbmNlOiBjYiwKICAgICAgICBsZW5ndGg6IGRiLAogICAgICAgIHNxdWFyZWRMZW5ndGg6IGViLAogICAgICAgIG5lZ2F0ZTogZnVuY3Rpb24oZiwgaCkgewogICAgICAgICAgICBmWzBdID0gLWhbMF07CiAgICAgICAgICAgIGZbMV0gPSAtaFsxXTsKICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICB9LAogICAgICAgIGludmVyc2U6IGZ1bmN0aW9uKGYsIGgpIHsKICAgICAgICAgICAgZlswXSA9IDEgLyBoWzBdOwogICAgICAgICAgICBmWzFdID0gMSAvIGhbMV07CiAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgfSwKICAgICAgICBub3JtYWxpemU6IGZ1bmN0aW9uKGYsIGgpIHsKICAgICAgICAgICAgdmFyIGwgPSBoWzBdLAogICAgICAgICAgICAgICAgcCA9IGhbMV07CiAgICAgICAgICAgIGwgPSBsICogbCArIHAgKiBwOwogICAgICAgICAgICAwIDwgbCAmJiAobCA9IDEgLyBNYXRoLnNxcnQobCkpOwogICAgICAgICAgICBmWzBdID0gaFswXSAqIGw7CiAgICAgICAgICAgIGZbMV0gPSBoWzFdICogbDsKICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICB9LAogICAgICAgIGRvdDogZnVuY3Rpb24oZiwgaCkgewogICAgICAgICAgICByZXR1cm4gZlswXSAqIGhbMF0gKyBmWzFdICogaFsxXQogICAgICAgIH0sCiAgICAgICAgY3Jvc3M6IGZ1bmN0aW9uKGYsIGgsIGwpIHsKICAgICAgICAgICAgaCA9IGhbMF0gKiBsWzFdIC0gaFsxXSAqIGxbMF07CiAgICAgICAgICAgIGZbMF0gPSBmWzFdID0gMDsKICAgICAgICAgICAgZlsyXSA9IGg7CiAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgfSwKICAgICAgICBsZXJwOiBmdW5jdGlvbihmLCBoLCBsLCBwKSB7CiAgICAgICAgICAgIHZhciByID0gaFswXTsKICAgICAgICAgICAgaCA9IGhbMV07CiAgICAgICAgICAgIGZbMF0gPSByICsgcCAqIChsWzBdIC0gcik7CiAgICAgICAgICAgIGZbMV0gPSBoICsgcCAqIChsWzFdIC0gaCk7CiAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgfSwKICAgICAgICByYW5kb206IGZ1bmN0aW9uKGYsIGgpIHsKICAgICAgICAgICAgaCA9IGggfHwgMTsKICAgICAgICAgICAgdmFyIGwgPSAyICogaGEoKSAqIE1hdGguUEk7CiAgICAgICAgICAgIGZbMF0gPSBNYXRoLmNvcyhsKSAqIGg7CiAgICAgICAgICAgIGZbMV0gPSBNYXRoLnNpbihsKSAqIGg7CiAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgfSwKICAgICAgICB0cmFuc2Zvcm1NYXQyOiBmdW5jdGlvbihmLCBoLCBsKSB7CiAgICAgICAgICAgIHZhciBwID0gaFswXTsKICAgICAgICAgICAgaCA9IGhbMV07CiAgICAgICAgICAgIGZbMF0gPSBsWzBdICogcCArIGxbMl0gKiBoOwogICAgICAgICAgICBmWzFdID0gbFsxXSAqIHAgKyBsWzNdICogaDsKICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICB9LAogICAgICAgIHRyYW5zZm9ybU1hdDJkOiBmdW5jdGlvbihmLCBoLCBsKSB7CiAgICAgICAgICAgIHZhciBwID0gaFswXTsKICAgICAgICAgICAgaCA9IGhbMV07CiAgICAgICAgICAgIGZbMF0gPSBsWzBdICogcCArIGxbMl0gKiBoICsgbFs0XTsKICAgICAgICAgICAgZlsxXSA9IGxbMV0gKiBwICsgbFszXSAqIGggKyBsWzVdOwogICAgICAgICAgICByZXR1cm4gZgogICAgICAgIH0sCiAgICAgICAgdHJhbnNmb3JtTWF0MzogZnVuY3Rpb24oZiwgaCwgbCkgewogICAgICAgICAgICB2YXIgcCA9IGhbMF07CiAgICAgICAgICAgIGggPSBoWzFdOwogICAgICAgICAgICBmWzBdID0gbFswXSAqIHAgKyBsWzNdICogaCArIGxbNl07CiAgICAgICAgICAgIGZbMV0gPSBsWzFdICogcCArIGxbNF0gKiBoICsgbFs3XTsKICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICB9LAogICAgICAgIHRyYW5zZm9ybU1hdDQ6IGZ1bmN0aW9uKGYsIGgsIGwpIHsKICAgICAgICAgICAgdmFyIHAgPSBoWzBdOwogICAgICAgICAgICBoID0KICAgICAgICAgICAgICAgIGhbMV07CiAgICAgICAgICAgIGZbMF0gPSBsWzBdICogcCArIGxbNF0gKiBoICsgbFsxMl07CiAgICAgICAgICAgIGZbMV0gPSBsWzFdICogcCArIGxbNV0gKiBoICsgbFsxM107CiAgICAgICAgICAgIHJldHVybiBmCiAgICAgICAgfSwKICAgICAgICByb3RhdGU6IGZ1bmN0aW9uKGYsIGgsIGwsIHApIHsKICAgICAgICAgICAgdmFyIHIgPSBoWzBdIC0gbFswXTsKICAgICAgICAgICAgaCA9IGhbMV0gLSBsWzFdOwogICAgICAgICAgICB2YXIgdCA9IE1hdGguc2luKHApOwogICAgICAgICAgICBwID0gTWF0aC5jb3MocCk7CiAgICAgICAgICAgIGZbMF0gPSByICogcCAtIGggKiB0ICsgbFswXTsKICAgICAgICAgICAgZlsxXSA9IHIgKiB0ICsgaCAqIHAgKyBsWzFdOwogICAgICAgICAgICByZXR1cm4gZgogICAgICAgIH0sCiAgICAgICAgYW5nbGU6IGZ1bmN0aW9uKGYsIGgpIHsKICAgICAgICAgICAgdmFyIGwgPSBmWzBdOwogICAgICAgICAgICBmID0gZlsxXTsKICAgICAgICAgICAgdmFyIHAgPSBoWzBdOwogICAgICAgICAgICBoID0gaFsxXTsKICAgICAgICAgICAgdmFyIHIgPSBNYXRoLnNxcnQoKGwgKiBsICsgZiAqIGYpICogKHAgKiBwICsgaCAqIGgpKTsKICAgICAgICAgICAgcmV0dXJuIE1hdGguYWNvcyhNYXRoLm1pbihNYXRoLm1heChyICYmIChsICogcCArIGYgKiBoKSAvIHIsIC0xKSwgMSkpCiAgICAgICAgfSwKICAgICAgICB6ZXJvOiBmdW5jdGlvbihmKSB7CiAgICAgICAgICAgIGZbMF0gPSAwOwogICAgICAgICAgICBmWzFdID0gMDsKICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICB9LAogICAgICAgIHN0cjogZnVuY3Rpb24oZikgewogICAgICAgICAgICByZXR1cm4gInZlYzIoIiArIGZbMF0gKyAiLCAiICsgZlsxXSArICIpIgogICAgICAgIH0sCiAgICAgICAgZXhhY3RFcXVhbHM6IGZ1bmN0aW9uKGYsIGgpIHsKICAgICAgICAgICAgcmV0dXJuIGZbMF0gPT09IGhbMF0gJiYgZlsxXSA9PT0gaFsxXQogICAgICAgIH0sCiAgICAgICAgZXF1YWxzOiBmdW5jdGlvbihmLAogICAgICAgICAgICBoKSB7CiAgICAgICAgICAgIHZhciBsID0gZlswXTsKICAgICAgICAgICAgZiA9IGZbMV07CiAgICAgICAgICAgIHZhciBwID0gaFswXTsKICAgICAgICAgICAgaCA9IGhbMV07CiAgICAgICAgICAgIHJldHVybiBNYXRoLmFicyhsIC0gcCkgPD0gMUUtNiAqIE1hdGgubWF4KDEsIE1hdGguYWJzKGwpLCBNYXRoLmFicyhwKSkgJiYgTWF0aC5hYnMoZiAtIGgpIDw9IDFFLTYgKiBNYXRoLm1heCgxLCBNYXRoLmFicyhmKSwgTWF0aC5hYnMoaCkpCiAgICAgICAgfSwKICAgICAgICBsZW46IGRiLAogICAgICAgIHN1YjogWmEsCiAgICAgICAgbXVsOiAkYSwKICAgICAgICBkaXY6IGFiLAogICAgICAgIGRpc3Q6IGJiLAogICAgICAgIHNxckRpc3Q6IGNiLAogICAgICAgIHNxckxlbjogZWIsCiAgICAgICAgZm9yRWFjaDogbmEKICAgIH0pOwogICAgYS5nbE1hdHJpeCA9IGliOwogICAgYS5tYXQyID0gamI7CiAgICBhLm1hdDJkID0ga2I7CiAgICBhLm1hdDMgPSBsYjsKICAgIGEubWF0NCA9IG1iOwogICAgYS5xdWF0ID0geGE7CiAgICBhLnF1YXQyID0geWE7CiAgICBhLnZlYzIgPSBuYTsKICAgIGEudmVjMyA9IHZhOwogICAgYS52ZWM0ID0gd2E7CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoYSwgIl9fZXNNb2R1bGUiLCB7CiAgICAgICAgdmFsdWU6ICEwCiAgICB9KQp9KTsKc2VsZi5HcmFwaGVtZVNwbGl0dGVyID0gZnVuY3Rpb24oKSB7CiAgICBmdW5jdGlvbiBhKGMsIGUpIHsKICAgICAgICB2b2lkIDAgPT09IGUgJiYgKGUgPSAwKTsKICAgICAgICB2YXIgZyA9IGMuY2hhckNvZGVBdChlKTsKICAgICAgICBpZiAoNTUyOTYgPD0gZyAmJiA1NjMxOSA+PSBnICYmIGUgPCBjLmxlbmd0aCAtIDEpIHsKICAgICAgICAgICAgdmFyIGsgPSBnOwogICAgICAgICAgICBjID0gYy5jaGFyQ29kZUF0KGUgKyAxKTsKICAgICAgICAgICAgcmV0dXJuIDU2MzIwIDw9IGMgJiYgNTczNDMgPj0gYyA/IDEwMjQgKiAoayAtIDU1Mjk2KSArIChjIC0gNTYzMjApICsgNjU1MzYgOiBrCiAgICAgICAgfQogICAgICAgIHJldHVybiA1NjMyMCA8PSBnICYmIDU3MzQzID49IGcgJiYgMSA8PSBlID8gKGsgPSBjLmNoYXJDb2RlQXQoZSAtIDEpLCBjID0gZywgNTUyOTYgPD0gayAmJiA1NjMxOSA+PSBrID8gMTAyNCAqIChrIC0gNTUyOTYpICsgKGMgLSA1NjMyMCkgKyA2NTUzNiA6IGMpIDogZwogICAgfQoKICAgIGZ1bmN0aW9uIGIoYywgZSwgZykgewogICAgICAgIHZhciBrID0gW2NdLmNvbmNhdChlKS5jb25jYXQoW2ddKSwKICAgICAgICAgICAgbSA9IGtbay5sZW5ndGggLSAyXSwKICAgICAgICAgICAgbiA9IGsubGFzdEluZGV4T2YoMTQpOwogICAgICAgIGlmICgxIDwgbiAmJiBrLnNsaWNlKDEsIG4pLmV2ZXJ5KGZ1bmN0aW9uKHEpIHsKICAgICAgICAgICAgICAgIHJldHVybiAzID09IHEKICAgICAgICAgICAgfSkgJiYgLTEgPT0gWzMsIDEzLCAxN10uaW5kZXhPZihjKSkgcmV0dXJuIDI7CiAgICAgICAgYyA9CiAgICAgICAgICAgIGsubGFzdEluZGV4T2YoNCk7CiAgICAgICAgaWYgKDAgPCBjICYmIGsuc2xpY2UoMSwgYykuZXZlcnkoZnVuY3Rpb24ocSkgewogICAgICAgICAgICAgICAgcmV0dXJuIDQgPT0gcQogICAgICAgICAgICB9KSAmJiAtMSA9PSBbMTIsIDRdLmluZGV4T2YobSkpIHJldHVybiAxID09IGsuZmlsdGVyKGZ1bmN0aW9uKHEpIHsKICAgICAgICAgICAgcmV0dXJuIDQgPT0gcQogICAgICAgIH0pLmxlbmd0aCAlIDIgPyAzIDogNDsKICAgICAgICBpZiAoMCA9PSBtICYmIDEgPT0gZykgcmV0dXJuIDA7CiAgICAgICAgaWYgKDIgPT0gbSB8fCAwID09IG0gfHwgMSA9PSBtKSByZXR1cm4gMTQgPT0gZyAmJiBlLmV2ZXJ5KGZ1bmN0aW9uKHEpIHsKICAgICAgICAgICAgcmV0dXJuIDMgPT0gcQogICAgICAgIH0pID8gMiA6IDE7CiAgICAgICAgaWYgKDIgPT0gZyB8fCAwID09IGcgfHwgMSA9PSBnKSByZXR1cm4gMTsKICAgICAgICBpZiAoNiAhPSBtIHx8IDYgIT0gZyAmJiA3ICE9IGcgJiYgOSAhPSBnICYmIDEwICE9IGcpCiAgICAgICAgICAgIGlmICg5ICE9IG0gJiYgNyAhPSBtIHx8IDcgIT0gZyAmJiA4ICE9IGcpCiAgICAgICAgICAgICAgICBpZiAoMTAgIT0gbSAmJiA4ICE9IG0gfHwgOCAhPSBnKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKDMgPT0gZyB8fCAxNSA9PSBnIHx8IDUgPT0gZyB8fCAxMiA9PSBtKSByZXR1cm4gMAogICAgICAgICAgICAgICAgfSBlbHNlIHJldHVybiAwOwogICAgICAgIGVsc2UgcmV0dXJuIDA7CiAgICAgICAgZWxzZSByZXR1cm4gMDsKICAgICAgICBjID0gLTEgIT0gay5pbmRleE9mKDMpID8gay5sYXN0SW5kZXhPZigzKSAtIDEgOiBrLmxlbmd0aCAtIDI7CiAgICAgICAgcmV0dXJuIC0xICE9IFsxMywgMTddLmluZGV4T2Yoa1tjXSkgJiYKICAgICAgICAgICAgay5zbGljZShjICsgMSwgLTEpLmV2ZXJ5KGZ1bmN0aW9uKHEpIHsKICAgICAgICAgICAgICAgIHJldHVybiAzID09IHEKICAgICAgICAgICAgfSkgJiYgMTQgPT0gZyB8fCAxNSA9PSBtICYmIC0xICE9IFsxNiwgMTddLmluZGV4T2YoZykgPyAwIDogLTEgIT0gZS5pbmRleE9mKDQpID8gMiA6IDQgPT0gbSAmJiA0ID09IGcgPyAwIDogMQogICAgfQoKICAgIGZ1bmN0aW9uIGQoYykgewogICAgICAgIHJldHVybiAxNTM2IDw9IGMgJiYgMTU0MSA+PSBjIHx8IDE3NTcgPT0gYyB8fCAxODA3ID09IGMgfHwgMjI3NCA9PSBjIHx8IDM0MDYgPT0gYyB8fCA2OTgyMSA9PSBjIHx8IDcwMDgyIDw9IGMgJiYgNzAwODMgPj0gYyB8fCA3MjI1MCA9PSBjIHx8IDcyMzI2IDw9IGMgJiYgNzIzMjkgPj0gYyB8fCA3MzAzMCA9PSBjID8gMTIgOiAxMyA9PSBjID8gMCA6IDEwID09IGMgPyAxIDogMCA8PSBjICYmIDkgPj0gYyB8fCAxMSA8PSBjICYmIDEyID49IGMgfHwgMTQgPD0gYyAmJiAzMSA+PSBjIHx8IDEyNyA8PSBjICYmIDE1OSA+PSBjIHx8IDE3MyA9PSBjIHx8IDE1NjQgPT0gYyB8fCA2MTU4ID09IGMgfHwgODIwMyA9PSBjIHx8IDgyMDYgPD0gYyAmJiA4MjA3ID49IGMgfHwgODIzMiA9PSBjIHx8IDgyMzMgPT0gYyB8fCA4MjM0IDw9IGMgJiYgODIzOCA+PSBjIHx8IDgyODggPD0gYyAmJiA4MjkyID49IGMgfHwgODI5MyA9PSBjIHx8IDgyOTQgPD0gYyAmJiA4MzAzID49IGMgfHwgNTUyOTYgPD0gYyAmJiA1NzM0MyA+PSBjIHx8IDY1Mjc5ID09CiAgICAgICAgICAgIGMgfHwgNjU1MjAgPD0gYyAmJiA2NTUyOCA+PSBjIHx8IDY1NTI5IDw9IGMgJiYgNjU1MzEgPj0gYyB8fCAxMTM4MjQgPD0gYyAmJiAxMTM4MjcgPj0gYyB8fCAxMTkxNTUgPD0gYyAmJiAxMTkxNjIgPj0gYyB8fCA5MTc1MDQgPT0gYyB8fCA5MTc1MDUgPT0gYyB8fCA5MTc1MDYgPD0gYyAmJiA5MTc1MzUgPj0gYyB8fCA5MTc2MzIgPD0gYyAmJiA5MTc3NTkgPj0gYyB8fCA5MThFMyA8PSBjICYmIDkyMTU5OSA+PSBjID8gMiA6IDc2OCA8PSBjICYmIDg3OSA+PSBjIHx8IDExNTUgPD0gYyAmJiAxMTU5ID49IGMgfHwgMTE2MCA8PSBjICYmIDExNjEgPj0gYyB8fCAxNDI1IDw9IGMgJiYgMTQ2OSA+PSBjIHx8IDE0NzEgPT0gYyB8fCAxNDczIDw9IGMgJiYgMTQ3NCA+PSBjIHx8IDE0NzYgPD0gYyAmJiAxNDc3ID49IGMgfHwgMTQ3OSA9PSBjIHx8IDE1NTIgPD0gYyAmJiAxNTYyID49IGMgfHwgMTYxMSA8PSBjICYmIDE2MzEgPj0gYyB8fCAxNjQ4ID09IGMgfHwgMTc1MCA8PSBjICYmIDE3NTYgPj0gYyB8fCAxNzU5IDw9IGMgJiYgMTc2NCA+PSBjIHx8IDE3NjcgPD0gYyAmJiAxNzY4ID49IGMgfHwgMTc3MCA8PSBjICYmIDE3NzMgPj0gYyB8fCAxODA5ID09IGMgfHwgMTg0MCA8PSBjICYmIDE4NjYgPj0gYyB8fCAxOTU4IDw9IGMgJiYgMTk2OCA+PSBjIHx8IDIwMjcgPD0gYyAmJiAyMDM1ID49IGMgfHwgMjA3MCA8PSBjICYmIDIwNzMgPj0gYyB8fCAyMDc1IDw9CiAgICAgICAgICAgIGMgJiYgMjA4MyA+PSBjIHx8IDIwODUgPD0gYyAmJiAyMDg3ID49IGMgfHwgMjA4OSA8PSBjICYmIDIwOTMgPj0gYyB8fCAyMTM3IDw9IGMgJiYgMjEzOSA+PSBjIHx8IDIyNjAgPD0gYyAmJiAyMjczID49IGMgfHwgMjI3NSA8PSBjICYmIDIzMDYgPj0gYyB8fCAyMzYyID09IGMgfHwgMjM2NCA9PSBjIHx8IDIzNjkgPD0gYyAmJiAyMzc2ID49IGMgfHwgMjM4MSA9PSBjIHx8IDIzODUgPD0gYyAmJiAyMzkxID49IGMgfHwgMjQwMiA8PSBjICYmIDI0MDMgPj0gYyB8fCAyNDMzID09IGMgfHwgMjQ5MiA9PSBjIHx8IDI0OTQgPT0gYyB8fCAyNDk3IDw9IGMgJiYgMjUwMCA+PSBjIHx8IDI1MDkgPT0gYyB8fCAyNTE5ID09IGMgfHwgMjUzMCA8PSBjICYmIDI1MzEgPj0gYyB8fCAyNTYxIDw9IGMgJiYgMjU2MiA+PSBjIHx8IDI2MjAgPT0gYyB8fCAyNjI1IDw9IGMgJiYgMjYyNiA+PSBjIHx8IDI2MzEgPD0gYyAmJiAyNjMyID49IGMgfHwgMjYzNSA8PSBjICYmIDI2MzcgPj0gYyB8fCAyNjQxID09IGMgfHwgMjY3MiA8PSBjICYmIDI2NzMgPj0gYyB8fCAyNjc3ID09IGMgfHwgMjY4OSA8PSBjICYmIDI2OTAgPj0gYyB8fCAyNzQ4ID09IGMgfHwgMjc1MyA8PSBjICYmIDI3NTcgPj0gYyB8fCAyNzU5IDw9IGMgJiYgMjc2MCA+PSBjIHx8IDI3NjUgPT0gYyB8fCAyNzg2IDw9IGMgJiYgMjc4NyA+PSBjIHx8IDI4MTAgPD0gYyAmJiAyODE1ID49IGMgfHwgMjgxNyA9PSBjIHx8IDI4NzYgPT0KICAgICAgICAgICAgYyB8fCAyODc4ID09IGMgfHwgMjg3OSA9PSBjIHx8IDI4ODEgPD0gYyAmJiAyODg0ID49IGMgfHwgMjg5MyA9PSBjIHx8IDI5MDIgPT0gYyB8fCAyOTAzID09IGMgfHwgMjkxNCA8PSBjICYmIDI5MTUgPj0gYyB8fCAyOTQ2ID09IGMgfHwgMzAwNiA9PSBjIHx8IDMwMDggPT0gYyB8fCAzMDIxID09IGMgfHwgMzAzMSA9PSBjIHx8IDMwNzIgPT0gYyB8fCAzMTM0IDw9IGMgJiYgMzEzNiA+PSBjIHx8IDMxNDIgPD0gYyAmJiAzMTQ0ID49IGMgfHwgMzE0NiA8PSBjICYmIDMxNDkgPj0gYyB8fCAzMTU3IDw9IGMgJiYgMzE1OCA+PSBjIHx8IDMxNzAgPD0gYyAmJiAzMTcxID49IGMgfHwgMzIwMSA9PSBjIHx8IDMyNjAgPT0gYyB8fCAzMjYzID09IGMgfHwgMzI2NiA9PSBjIHx8IDMyNzAgPT0gYyB8fCAzMjc2IDw9IGMgJiYgMzI3NyA+PSBjIHx8IDMyODUgPD0gYyAmJiAzMjg2ID49IGMgfHwgMzI5OCA8PSBjICYmIDMyOTkgPj0gYyB8fCAzMzI4IDw9IGMgJiYgMzMyOSA+PSBjIHx8IDMzODcgPD0gYyAmJiAzMzg4ID49IGMgfHwgMzM5MCA9PSBjIHx8IDMzOTMgPD0gYyAmJiAzMzk2ID49IGMgfHwgMzQwNSA9PSBjIHx8IDM0MTUgPT0gYyB8fCAzNDI2IDw9IGMgJiYgMzQyNyA+PSBjIHx8IDM1MzAgPT0gYyB8fCAzNTM1ID09IGMgfHwgMzUzOCA8PSBjICYmIDM1NDAgPj0gYyB8fCAzNTQyID09IGMgfHwgMzU1MSA9PSBjIHx8IDM2MzMgPT0gYyB8fCAzNjM2IDw9IGMgJiYgMzY0MiA+PQogICAgICAgICAgICBjIHx8IDM2NTUgPD0gYyAmJiAzNjYyID49IGMgfHwgMzc2MSA9PSBjIHx8IDM3NjQgPD0gYyAmJiAzNzY5ID49IGMgfHwgMzc3MSA8PSBjICYmIDM3NzIgPj0gYyB8fCAzNzg0IDw9IGMgJiYgMzc4OSA+PSBjIHx8IDM4NjQgPD0gYyAmJiAzODY1ID49IGMgfHwgMzg5MyA9PSBjIHx8IDM4OTUgPT0gYyB8fCAzODk3ID09IGMgfHwgMzk1MyA8PSBjICYmIDM5NjYgPj0gYyB8fCAzOTY4IDw9IGMgJiYgMzk3MiA+PSBjIHx8IDM5NzQgPD0gYyAmJiAzOTc1ID49IGMgfHwgMzk4MSA8PSBjICYmIDM5OTEgPj0gYyB8fCAzOTkzIDw9IGMgJiYgNDAyOCA+PSBjIHx8IDQwMzggPT0gYyB8fCA0MTQxIDw9IGMgJiYgNDE0NCA+PSBjIHx8IDQxNDYgPD0gYyAmJiA0MTUxID49IGMgfHwgNDE1MyA8PSBjICYmIDQxNTQgPj0gYyB8fCA0MTU3IDw9IGMgJiYgNDE1OCA+PSBjIHx8IDQxODQgPD0gYyAmJiA0MTg1ID49IGMgfHwgNDE5MCA8PSBjICYmIDQxOTIgPj0gYyB8fCA0MjA5IDw9IGMgJiYgNDIxMiA+PSBjIHx8IDQyMjYgPT0gYyB8fCA0MjI5IDw9IGMgJiYgNDIzMCA+PSBjIHx8IDQyMzcgPT0gYyB8fCA0MjUzID09IGMgfHwgNDk1NyA8PSBjICYmIDQ5NTkgPj0gYyB8fCA1OTA2IDw9IGMgJiYgNTkwOCA+PSBjIHx8IDU5MzggPD0gYyAmJiA1OTQwID49IGMgfHwgNTk3MCA8PSBjICYmIDU5NzEgPj0gYyB8fCA2MDAyIDw9IGMgJiYgNjAwMyA+PSBjIHx8IDYwNjggPD0gYyAmJiA2MDY5ID49CiAgICAgICAgICAgIGMgfHwgNjA3MSA8PSBjICYmIDYwNzcgPj0gYyB8fCA2MDg2ID09IGMgfHwgNjA4OSA8PSBjICYmIDYwOTkgPj0gYyB8fCA2MTA5ID09IGMgfHwgNjE1NSA8PSBjICYmIDYxNTcgPj0gYyB8fCA2Mjc3IDw9IGMgJiYgNjI3OCA+PSBjIHx8IDYzMTMgPT0gYyB8fCA2NDMyIDw9IGMgJiYgNjQzNCA+PSBjIHx8IDY0MzkgPD0gYyAmJiA2NDQwID49IGMgfHwgNjQ1MCA9PSBjIHx8IDY0NTcgPD0gYyAmJiA2NDU5ID49IGMgfHwgNjY3OSA8PSBjICYmIDY2ODAgPj0gYyB8fCA2NjgzID09IGMgfHwgNjc0MiA9PSBjIHx8IDY3NDQgPD0gYyAmJiA2NzUwID49IGMgfHwgNjc1MiA9PSBjIHx8IDY3NTQgPT0gYyB8fCA2NzU3IDw9IGMgJiYgNjc2NCA+PSBjIHx8IDY3NzEgPD0gYyAmJiA2NzgwID49IGMgfHwgNjc4MyA9PSBjIHx8IDY4MzIgPD0gYyAmJiA2ODQ1ID49IGMgfHwgNjg0NiA9PSBjIHx8IDY5MTIgPD0gYyAmJiA2OTE1ID49IGMgfHwgNjk2NCA9PSBjIHx8IDY5NjYgPD0gYyAmJiA2OTcwID49IGMgfHwgNjk3MiA9PSBjIHx8IDY5NzggPT0gYyB8fCA3MDE5IDw9IGMgJiYgNzAyNyA+PSBjIHx8IDcwNDAgPD0gYyAmJiA3MDQxID49IGMgfHwgNzA3NCA8PSBjICYmIDcwNzcgPj0gYyB8fCA3MDgwIDw9IGMgJiYgNzA4MSA+PSBjIHx8IDcwODMgPD0gYyAmJiA3MDg1ID49IGMgfHwgNzE0MiA9PSBjIHx8IDcxNDQgPD0gYyAmJiA3MTQ1ID49IGMgfHwgNzE0OSA9PSBjIHx8IDcxNTEgPD0KICAgICAgICAgICAgYyAmJiA3MTUzID49IGMgfHwgNzIxMiA8PSBjICYmIDcyMTkgPj0gYyB8fCA3MjIyIDw9IGMgJiYgNzIyMyA+PSBjIHx8IDczNzYgPD0gYyAmJiA3Mzc4ID49IGMgfHwgNzM4MCA8PSBjICYmIDczOTIgPj0gYyB8fCA3Mzk0IDw9IGMgJiYgNzQwMCA+PSBjIHx8IDc0MDUgPT0gYyB8fCA3NDEyID09IGMgfHwgNzQxNiA8PSBjICYmIDc0MTcgPj0gYyB8fCA3NjE2IDw9IGMgJiYgNzY3MyA+PSBjIHx8IDc2NzUgPD0gYyAmJiA3Njc5ID49IGMgfHwgODIwNCA9PSBjIHx8IDg0MDAgPD0gYyAmJiA4NDEyID49IGMgfHwgODQxMyA8PSBjICYmIDg0MTYgPj0gYyB8fCA4NDE3ID09IGMgfHwgODQxOCA8PSBjICYmIDg0MjAgPj0gYyB8fCA4NDIxIDw9IGMgJiYgODQzMiA+PSBjIHx8IDExNTAzIDw9IGMgJiYgMTE1MDUgPj0gYyB8fCAxMTY0NyA9PSBjIHx8IDExNzQ0IDw9IGMgJiYgMTE3NzUgPj0gYyB8fCAxMjMzMCA8PSBjICYmIDEyMzMzID49IGMgfHwgMTIzMzQgPD0gYyAmJiAxMjMzNSA+PSBjIHx8IDEyNDQxIDw9IGMgJiYgMTI0NDIgPj0gYyB8fCA0MjYwNyA9PSBjIHx8IDQyNjA4IDw9IGMgJiYgNDI2MTAgPj0gYyB8fCA0MjYxMiA8PSBjICYmIDQyNjIxID49IGMgfHwgNDI2NTQgPD0gYyAmJiA0MjY1NSA+PSBjIHx8IDQyNzM2IDw9IGMgJiYgNDI3MzcgPj0gYyB8fCA0MzAxMCA9PSBjIHx8IDQzMDE0ID09IGMgfHwgNDMwMTkgPT0gYyB8fCA0MzA0NSA8PQogICAgICAgICAgICBjICYmIDQzMDQ2ID49IGMgfHwgNDMyMDQgPD0gYyAmJiA0MzIwNSA+PSBjIHx8IDQzMjMyIDw9IGMgJiYgNDMyNDkgPj0gYyB8fCA0MzMwMiA8PSBjICYmIDQzMzA5ID49IGMgfHwgNDMzMzUgPD0gYyAmJiA0MzM0NSA+PSBjIHx8IDQzMzkyIDw9IGMgJiYgNDMzOTQgPj0gYyB8fCA0MzQ0MyA9PSBjIHx8IDQzNDQ2IDw9IGMgJiYgNDM0NDkgPj0gYyB8fCA0MzQ1MiA9PSBjIHx8IDQzNDkzID09IGMgfHwgNDM1NjEgPD0gYyAmJiA0MzU2NiA+PSBjIHx8IDQzNTY5IDw9IGMgJiYgNDM1NzAgPj0gYyB8fCA0MzU3MyA8PSBjICYmIDQzNTc0ID49IGMgfHwgNDM1ODcgPT0gYyB8fCA0MzU5NiA9PSBjIHx8IDQzNjQ0ID09IGMgfHwgNDM2OTYgPT0gYyB8fCA0MzY5OCA8PSBjICYmIDQzNzAwID49IGMgfHwgNDM3MDMgPD0gYyAmJiA0MzcwNCA+PSBjIHx8IDQzNzEwIDw9IGMgJiYgNDM3MTEgPj0gYyB8fCA0MzcxMyA9PSBjIHx8IDQzNzU2IDw9IGMgJiYgNDM3NTcgPj0gYyB8fCA0Mzc2NiA9PSBjIHx8IDQ0MDA1ID09IGMgfHwgNDQwMDggPT0gYyB8fCA0NDAxMyA9PSBjIHx8IDY0Mjg2ID09IGMgfHwgNjUwMjQgPD0gYyAmJiA2NTAzOSA+PSBjIHx8IDY1MDU2IDw9IGMgJiYgNjUwNzEgPj0gYyB8fCA2NTQzOCA8PSBjICYmIDY1NDM5ID49IGMgfHwgNjYwNDUgPT0gYyB8fCA2NjI3MiA9PSBjIHx8IDY2NDIyIDw9IGMgJiYgNjY0MjYgPj0gYyB8fAogICAgICAgICAgICA2ODA5NyA8PSBjICYmIDY4MDk5ID49IGMgfHwgNjgxMDEgPD0gYyAmJiA2ODEwMiA+PSBjIHx8IDY4MTA4IDw9IGMgJiYgNjgxMTEgPj0gYyB8fCA2ODE1MiA8PSBjICYmIDY4MTU0ID49IGMgfHwgNjgxNTkgPT0gYyB8fCA2ODMyNSA8PSBjICYmIDY4MzI2ID49IGMgfHwgNjk2MzMgPT0gYyB8fCA2OTY4OCA8PSBjICYmIDY5NzAyID49IGMgfHwgNjk3NTkgPD0gYyAmJiA2OTc2MSA+PSBjIHx8IDY5ODExIDw9IGMgJiYgNjk4MTQgPj0gYyB8fCA2OTgxNyA8PSBjICYmIDY5ODE4ID49IGMgfHwgNjk4ODggPD0gYyAmJiA2OTg5MCA+PSBjIHx8IDY5OTI3IDw9IGMgJiYgNjk5MzEgPj0gYyB8fCA2OTkzMyA8PSBjICYmIDY5OTQwID49IGMgfHwgNzAwMDMgPT0gYyB8fCA3MDAxNiA8PSBjICYmIDcwMDE3ID49IGMgfHwgNzAwNzAgPD0gYyAmJiA3MDA3OCA+PSBjIHx8IDcwMDkwIDw9IGMgJiYgNzAwOTIgPj0gYyB8fCA3MDE5MSA8PSBjICYmIDcwMTkzID49IGMgfHwgNzAxOTYgPT0gYyB8fCA3MDE5OCA8PSBjICYmIDcwMTk5ID49IGMgfHwgNzAyMDYgPT0gYyB8fCA3MDM2NyA9PSBjIHx8IDcwMzcxIDw9IGMgJiYgNzAzNzggPj0gYyB8fCA3MDQwMCA8PSBjICYmIDcwNDAxID49IGMgfHwgNzA0NjAgPT0gYyB8fCA3MDQ2MiA9PSBjIHx8IDcwNDY0ID09IGMgfHwgNzA0ODcgPT0gYyB8fCA3MDUwMiA8PSBjICYmIDcwNTA4ID49IGMgfHwgNzA1MTIgPD0KICAgICAgICAgICAgYyAmJiA3MDUxNiA+PSBjIHx8IDcwNzEyIDw9IGMgJiYgNzA3MTkgPj0gYyB8fCA3MDcyMiA8PSBjICYmIDcwNzI0ID49IGMgfHwgNzA3MjYgPT0gYyB8fCA3MDgzMiA9PSBjIHx8IDcwODM1IDw9IGMgJiYgNzA4NDAgPj0gYyB8fCA3MDg0MiA9PSBjIHx8IDcwODQ1ID09IGMgfHwgNzA4NDcgPD0gYyAmJiA3MDg0OCA+PSBjIHx8IDcwODUwIDw9IGMgJiYgNzA4NTEgPj0gYyB8fCA3MTA4NyA9PSBjIHx8IDcxMDkwIDw9IGMgJiYgNzEwOTMgPj0gYyB8fCA3MTEwMCA8PSBjICYmIDcxMTAxID49IGMgfHwgNzExMDMgPD0gYyAmJiA3MTEwNCA+PSBjIHx8IDcxMTMyIDw9IGMgJiYgNzExMzMgPj0gYyB8fCA3MTIxOSA8PSBjICYmIDcxMjI2ID49IGMgfHwgNzEyMjkgPT0gYyB8fCA3MTIzMSA8PSBjICYmIDcxMjMyID49IGMgfHwgNzEzMzkgPT0gYyB8fCA3MTM0MSA9PSBjIHx8IDcxMzQ0IDw9IGMgJiYgNzEzNDkgPj0gYyB8fCA3MTM1MSA9PSBjIHx8IDcxNDUzIDw9IGMgJiYgNzE0NTUgPj0gYyB8fCA3MTQ1OCA8PSBjICYmIDcxNDYxID49IGMgfHwgNzE0NjMgPD0gYyAmJiA3MTQ2NyA+PSBjIHx8IDcyMTkzIDw9IGMgJiYgNzIxOTggPj0gYyB8fCA3MjIwMSA8PSBjICYmIDcyMjAyID49IGMgfHwgNzIyNDMgPD0gYyAmJiA3MjI0OCA+PSBjIHx8IDcyMjUxIDw9IGMgJiYgNzIyNTQgPj0gYyB8fCA3MjI2MyA9PSBjIHx8IDcyMjczIDw9IGMgJiYKICAgICAgICAgICAgNzIyNzggPj0gYyB8fCA3MjI4MSA8PSBjICYmIDcyMjgzID49IGMgfHwgNzIzMzAgPD0gYyAmJiA3MjM0MiA+PSBjIHx8IDcyMzQ0IDw9IGMgJiYgNzIzNDUgPj0gYyB8fCA3Mjc1MiA8PSBjICYmIDcyNzU4ID49IGMgfHwgNzI3NjAgPD0gYyAmJiA3Mjc2NSA+PSBjIHx8IDcyNzY3ID09IGMgfHwgNzI4NTAgPD0gYyAmJiA3Mjg3MSA+PSBjIHx8IDcyODc0IDw9IGMgJiYgNzI4ODAgPj0gYyB8fCA3Mjg4MiA8PSBjICYmIDcyODgzID49IGMgfHwgNzI4ODUgPD0gYyAmJiA3Mjg4NiA+PSBjIHx8IDczMDA5IDw9IGMgJiYgNzMwMTQgPj0gYyB8fCA3MzAxOCA9PSBjIHx8IDczMDIwIDw9IGMgJiYgNzMwMjEgPj0gYyB8fCA3MzAyMyA8PSBjICYmIDczMDI5ID49IGMgfHwgNzMwMzEgPT0gYyB8fCA5MjkxMiA8PSBjICYmIDkyOTE2ID49IGMgfHwgOTI5NzYgPD0gYyAmJiA5Mjk4MiA+PSBjIHx8IDk0MDk1IDw9IGMgJiYgOTQwOTggPj0gYyB8fCAxMTM4MjEgPD0gYyAmJiAxMTM4MjIgPj0gYyB8fCAxMTkxNDEgPT0gYyB8fCAxMTkxNDMgPD0gYyAmJiAxMTkxNDUgPj0gYyB8fCAxMTkxNTAgPD0gYyAmJiAxMTkxNTQgPj0gYyB8fCAxMTkxNjMgPD0gYyAmJiAxMTkxNzAgPj0gYyB8fCAxMTkxNzMgPD0gYyAmJiAxMTkxNzkgPj0gYyB8fCAxMTkyMTAgPD0gYyAmJiAxMTkyMTMgPj0gYyB8fCAxMTkzNjIgPD0gYyAmJiAxMTkzNjQgPj0KICAgICAgICAgICAgYyB8fCAxMjEzNDQgPD0gYyAmJiAxMjEzOTggPj0gYyB8fCAxMjE0MDMgPD0gYyAmJiAxMjE0NTIgPj0gYyB8fCAxMjE0NjEgPT0gYyB8fCAxMjE0NzYgPT0gYyB8fCAxMjE0OTkgPD0gYyAmJiAxMjE1MDMgPj0gYyB8fCAxMjE1MDUgPD0gYyAmJiAxMjE1MTkgPj0gYyB8fCAxMjI4ODAgPD0gYyAmJiAxMjI4ODYgPj0gYyB8fCAxMjI4ODggPD0gYyAmJiAxMjI5MDQgPj0gYyB8fCAxMjI5MDcgPD0gYyAmJiAxMjI5MTMgPj0gYyB8fCAxMjI5MTUgPD0gYyAmJiAxMjI5MTYgPj0gYyB8fCAxMjI5MTggPD0gYyAmJiAxMjI5MjIgPj0gYyB8fCAxMjUxMzYgPD0gYyAmJiAxMjUxNDIgPj0gYyB8fCAxMjUyNTIgPD0gYyAmJiAxMjUyNTggPj0gYyB8fCA5MTc1MzYgPD0gYyAmJiA5MTc2MzEgPj0gYyB8fCA5MTc3NjAgPD0gYyAmJiA5MTc5OTkgPj0gYyA/IDMgOiAxMjc0NjIgPD0gYyAmJiAxMjc0ODcgPj0gYyA/IDQgOiAyMzA3ID09IGMgfHwgMjM2MyA9PSBjIHx8IDIzNjYgPD0gYyAmJiAyMzY4ID49IGMgfHwgMjM3NyA8PSBjICYmIDIzODAgPj0gYyB8fCAyMzgyIDw9IGMgJiYgMjM4MyA+PSBjIHx8IDI0MzQgPD0gYyAmJiAyNDM1ID49IGMgfHwgMjQ5NSA8PSBjICYmIDI0OTYgPj0gYyB8fCAyNTAzIDw9IGMgJiYgMjUwNCA+PSBjIHx8IDI1MDcgPD0gYyAmJiAyNTA4ID49IGMgfHwgMjU2MyA9PSBjIHx8IDI2MjIgPD0gYyAmJiAyNjI0ID49CiAgICAgICAgICAgIGMgfHwgMjY5MSA9PSBjIHx8IDI3NTAgPD0gYyAmJiAyNzUyID49IGMgfHwgMjc2MSA9PSBjIHx8IDI3NjMgPD0gYyAmJiAyNzY0ID49IGMgfHwgMjgxOCA8PSBjICYmIDI4MTkgPj0gYyB8fCAyODgwID09IGMgfHwgMjg4NyA8PSBjICYmIDI4ODggPj0gYyB8fCAyODkxIDw9IGMgJiYgMjg5MiA+PSBjIHx8IDMwMDcgPT0gYyB8fCAzMDA5IDw9IGMgJiYgMzAxMCA+PSBjIHx8IDMwMTQgPD0gYyAmJiAzMDE2ID49IGMgfHwgMzAxOCA8PSBjICYmIDMwMjAgPj0gYyB8fCAzMDczIDw9IGMgJiYgMzA3NSA+PSBjIHx8IDMxMzcgPD0gYyAmJiAzMTQwID49IGMgfHwgMzIwMiA8PSBjICYmIDMyMDMgPj0gYyB8fCAzMjYyID09IGMgfHwgMzI2NCA8PSBjICYmIDMyNjUgPj0gYyB8fCAzMjY3IDw9IGMgJiYgMzI2OCA+PSBjIHx8IDMyNzEgPD0gYyAmJiAzMjcyID49IGMgfHwgMzI3NCA8PSBjICYmIDMyNzUgPj0gYyB8fCAzMzMwIDw9IGMgJiYgMzMzMSA+PSBjIHx8IDMzOTEgPD0gYyAmJiAzMzkyID49IGMgfHwgMzM5OCA8PSBjICYmIDM0MDAgPj0gYyB8fCAzNDAyIDw9IGMgJiYgMzQwNCA+PSBjIHx8IDM0NTggPD0gYyAmJiAzNDU5ID49IGMgfHwgMzUzNiA8PSBjICYmIDM1MzcgPj0gYyB8fCAzNTQ0IDw9IGMgJiYgMzU1MCA+PSBjIHx8IDM1NzAgPD0gYyAmJiAzNTcxID49IGMgfHwgMzYzNSA9PSBjIHx8IDM3NjMgPT0gYyB8fCAzOTAyIDw9IGMgJiYgMzkwMyA+PSBjIHx8IDM5NjcgPT0KICAgICAgICAgICAgYyB8fCA0MTQ1ID09IGMgfHwgNDE1NSA8PSBjICYmIDQxNTYgPj0gYyB8fCA0MTgyIDw9IGMgJiYgNDE4MyA+PSBjIHx8IDQyMjggPT0gYyB8fCA2MDcwID09IGMgfHwgNjA3OCA8PSBjICYmIDYwODUgPj0gYyB8fCA2MDg3IDw9IGMgJiYgNjA4OCA+PSBjIHx8IDY0MzUgPD0gYyAmJiA2NDM4ID49IGMgfHwgNjQ0MSA8PSBjICYmIDY0NDMgPj0gYyB8fCA2NDQ4IDw9IGMgJiYgNjQ0OSA+PSBjIHx8IDY0NTEgPD0gYyAmJiA2NDU2ID49IGMgfHwgNjY4MSA8PSBjICYmIDY2ODIgPj0gYyB8fCA2NzQxID09IGMgfHwgNjc0MyA9PSBjIHx8IDY3NjUgPD0gYyAmJiA2NzcwID49IGMgfHwgNjkxNiA9PSBjIHx8IDY5NjUgPT0gYyB8fCA2OTcxID09IGMgfHwgNjk3MyA8PSBjICYmIDY5NzcgPj0gYyB8fCA2OTc5IDw9IGMgJiYgNjk4MCA+PSBjIHx8IDcwNDIgPT0gYyB8fCA3MDczID09IGMgfHwgNzA3OCA8PSBjICYmIDcwNzkgPj0gYyB8fCA3MDgyID09IGMgfHwgNzE0MyA9PSBjIHx8IDcxNDYgPD0gYyAmJiA3MTQ4ID49IGMgfHwgNzE1MCA9PSBjIHx8IDcxNTQgPD0gYyAmJiA3MTU1ID49IGMgfHwgNzIwNCA8PSBjICYmIDcyMTEgPj0gYyB8fCA3MjIwIDw9IGMgJiYgNzIyMSA+PSBjIHx8IDczOTMgPT0gYyB8fCA3NDEwIDw9IGMgJiYgNzQxMSA+PSBjIHx8IDc0MTUgPT0gYyB8fCA0MzA0MyA8PSBjICYmIDQzMDQ0ID49IGMgfHwgNDMwNDcgPT0gYyB8fCA0MzEzNiA8PSBjICYmCiAgICAgICAgICAgIDQzMTM3ID49IGMgfHwgNDMxODggPD0gYyAmJiA0MzIwMyA+PSBjIHx8IDQzMzQ2IDw9IGMgJiYgNDMzNDcgPj0gYyB8fCA0MzM5NSA9PSBjIHx8IDQzNDQ0IDw9IGMgJiYgNDM0NDUgPj0gYyB8fCA0MzQ1MCA8PSBjICYmIDQzNDUxID49IGMgfHwgNDM0NTMgPD0gYyAmJiA0MzQ1NiA+PSBjIHx8IDQzNTY3IDw9IGMgJiYgNDM1NjggPj0gYyB8fCA0MzU3MSA8PSBjICYmIDQzNTcyID49IGMgfHwgNDM1OTcgPT0gYyB8fCA0Mzc1NSA9PSBjIHx8IDQzNzU4IDw9IGMgJiYgNDM3NTkgPj0gYyB8fCA0Mzc2NSA9PSBjIHx8IDQ0MDAzIDw9IGMgJiYgNDQwMDQgPj0gYyB8fCA0NDAwNiA8PSBjICYmIDQ0MDA3ID49IGMgfHwgNDQwMDkgPD0gYyAmJiA0NDAxMCA+PSBjIHx8IDQ0MDEyID09IGMgfHwgNjk2MzIgPT0gYyB8fCA2OTYzNCA9PSBjIHx8IDY5NzYyID09IGMgfHwgNjk4MDggPD0gYyAmJiA2OTgxMCA+PSBjIHx8IDY5ODE1IDw9IGMgJiYgNjk4MTYgPj0gYyB8fCA2OTkzMiA9PSBjIHx8IDcwMDE4ID09IGMgfHwgNzAwNjcgPD0gYyAmJiA3MDA2OSA+PSBjIHx8IDcwMDc5IDw9IGMgJiYgNzAwODAgPj0gYyB8fCA3MDE4OCA8PSBjICYmIDcwMTkwID49IGMgfHwgNzAxOTQgPD0gYyAmJiA3MDE5NSA+PSBjIHx8IDcwMTk3ID09IGMgfHwgNzAzNjggPD0gYyAmJiA3MDM3MCA+PSBjIHx8IDcwNDAyIDw9IGMgJiYgNzA0MDMgPj0gYyB8fCA3MDQ2MyA9PQogICAgICAgICAgICBjIHx8IDcwNDY1IDw9IGMgJiYgNzA0NjggPj0gYyB8fCA3MDQ3MSA8PSBjICYmIDcwNDcyID49IGMgfHwgNzA0NzUgPD0gYyAmJiA3MDQ3NyA+PSBjIHx8IDcwNDk4IDw9IGMgJiYgNzA0OTkgPj0gYyB8fCA3MDcwOSA8PSBjICYmIDcwNzExID49IGMgfHwgNzA3MjAgPD0gYyAmJiA3MDcyMSA+PSBjIHx8IDcwNzI1ID09IGMgfHwgNzA4MzMgPD0gYyAmJiA3MDgzNCA+PSBjIHx8IDcwODQxID09IGMgfHwgNzA4NDMgPD0gYyAmJiA3MDg0NCA+PSBjIHx8IDcwODQ2ID09IGMgfHwgNzA4NDkgPT0gYyB8fCA3MTA4OCA8PSBjICYmIDcxMDg5ID49IGMgfHwgNzEwOTYgPD0gYyAmJiA3MTA5OSA+PSBjIHx8IDcxMTAyID09IGMgfHwgNzEyMTYgPD0gYyAmJiA3MTIxOCA+PSBjIHx8IDcxMjI3IDw9IGMgJiYgNzEyMjggPj0gYyB8fCA3MTIzMCA9PSBjIHx8IDcxMzQwID09IGMgfHwgNzEzNDIgPD0gYyAmJiA3MTM0MyA+PSBjIHx8IDcxMzUwID09IGMgfHwgNzE0NTYgPD0gYyAmJiA3MTQ1NyA+PSBjIHx8IDcxNDYyID09IGMgfHwgNzIxOTkgPD0gYyAmJiA3MjIwMCA+PSBjIHx8IDcyMjQ5ID09IGMgfHwgNzIyNzkgPD0gYyAmJiA3MjI4MCA+PSBjIHx8IDcyMzQzID09IGMgfHwgNzI3NTEgPT0gYyB8fCA3Mjc2NiA9PSBjIHx8IDcyODczID09IGMgfHwgNzI4ODEgPT0gYyB8fCA3Mjg4NCA9PSBjIHx8IDk0MDMzIDw9IGMgJiYgOTQwNzggPj0gYyB8fAogICAgICAgICAgICAxMTkxNDIgPT0gYyB8fCAxMTkxNDkgPT0gYyA/IDUgOiA0MzUyIDw9IGMgJiYgNDQ0NyA+PSBjIHx8IDQzMzYwIDw9IGMgJiYgNDMzODggPj0gYyA/IDYgOiA0NDQ4IDw9IGMgJiYgNDUxOSA+PSBjIHx8IDU1MjE2IDw9IGMgJiYgNTUyMzggPj0gYyA/IDcgOiA0NTIwIDw9IGMgJiYgNDYwNyA+PSBjIHx8IDU1MjQzIDw9IGMgJiYgNTUyOTEgPj0gYyA/IDggOiA0NDAzMiA9PSBjIHx8IDQ0MDYwID09IGMgfHwgNDQwODggPT0gYyB8fCA0NDExNiA9PSBjIHx8IDQ0MTQ0ID09IGMgfHwgNDQxNzIgPT0gYyB8fCA0NDIwMCA9PSBjIHx8IDQ0MjI4ID09IGMgfHwgNDQyNTYgPT0gYyB8fCA0NDI4NCA9PSBjIHx8IDQ0MzEyID09IGMgfHwgNDQzNDAgPT0gYyB8fCA0NDM2OCA9PSBjIHx8IDQ0Mzk2ID09IGMgfHwgNDQ0MjQgPT0gYyB8fCA0NDQ1MiA9PSBjIHx8IDQ0NDgwID09IGMgfHwgNDQ1MDggPT0gYyB8fCA0NDUzNiA9PSBjIHx8IDQ0NTY0ID09IGMgfHwgNDQ1OTIgPT0gYyB8fCA0NDYyMCA9PSBjIHx8IDQ0NjQ4ID09IGMgfHwgNDQ2NzYgPT0gYyB8fCA0NDcwNCA9PSBjIHx8IDQ0NzMyID09IGMgfHwgNDQ3NjAgPT0gYyB8fCA0NDc4OCA9PSBjIHx8IDQ0ODE2ID09IGMgfHwgNDQ4NDQgPT0gYyB8fCA0NDg3MiA9PSBjIHx8IDQ0OTAwID09IGMgfHwgNDQ5MjggPT0gYyB8fCA0NDk1NiA9PSBjIHx8IDQ0OTg0ID09IGMgfHwgNDUwMTIgPT0gYyB8fCA0NTA0MCA9PQogICAgICAgICAgICBjIHx8IDQ1MDY4ID09IGMgfHwgNDUwOTYgPT0gYyB8fCA0NTEyNCA9PSBjIHx8IDQ1MTUyID09IGMgfHwgNDUxODAgPT0gYyB8fCA0NTIwOCA9PSBjIHx8IDQ1MjM2ID09IGMgfHwgNDUyNjQgPT0gYyB8fCA0NTI5MiA9PSBjIHx8IDQ1MzIwID09IGMgfHwgNDUzNDggPT0gYyB8fCA0NTM3NiA9PSBjIHx8IDQ1NDA0ID09IGMgfHwgNDU0MzIgPT0gYyB8fCA0NTQ2MCA9PSBjIHx8IDQ1NDg4ID09IGMgfHwgNDU1MTYgPT0gYyB8fCA0NTU0NCA9PSBjIHx8IDQ1NTcyID09IGMgfHwgNDU2MDAgPT0gYyB8fCA0NTYyOCA9PSBjIHx8IDQ1NjU2ID09IGMgfHwgNDU2ODQgPT0gYyB8fCA0NTcxMiA9PSBjIHx8IDQ1NzQwID09IGMgfHwgNDU3NjggPT0gYyB8fCA0NTc5NiA9PSBjIHx8IDQ1ODI0ID09IGMgfHwgNDU4NTIgPT0gYyB8fCA0NTg4MCA9PSBjIHx8IDQ1OTA4ID09IGMgfHwgNDU5MzYgPT0gYyB8fCA0NTk2NCA9PSBjIHx8IDQ1OTkyID09IGMgfHwgNDYwMjAgPT0gYyB8fCA0NjA0OCA9PSBjIHx8IDQ2MDc2ID09IGMgfHwgNDYxMDQgPT0gYyB8fCA0NjEzMiA9PSBjIHx8IDQ2MTYwID09IGMgfHwgNDYxODggPT0gYyB8fCA0NjIxNiA9PSBjIHx8IDQ2MjQ0ID09IGMgfHwgNDYyNzIgPT0gYyB8fCA0NjMwMCA9PSBjIHx8IDQ2MzI4ID09IGMgfHwgNDYzNTYgPT0gYyB8fCA0NjM4NCA9PSBjIHx8IDQ2NDEyID09IGMgfHwgNDY0NDAgPT0gYyB8fAogICAgICAgICAgICA0NjQ2OCA9PSBjIHx8IDQ2NDk2ID09IGMgfHwgNDY1MjQgPT0gYyB8fCA0NjU1MiA9PSBjIHx8IDQ2NTgwID09IGMgfHwgNDY2MDggPT0gYyB8fCA0NjYzNiA9PSBjIHx8IDQ2NjY0ID09IGMgfHwgNDY2OTIgPT0gYyB8fCA0NjcyMCA9PSBjIHx8IDQ2NzQ4ID09IGMgfHwgNDY3NzYgPT0gYyB8fCA0NjgwNCA9PSBjIHx8IDQ2ODMyID09IGMgfHwgNDY4NjAgPT0gYyB8fCA0Njg4OCA9PSBjIHx8IDQ2OTE2ID09IGMgfHwgNDY5NDQgPT0gYyB8fCA0Njk3MiA9PSBjIHx8IDQ3RTMgPT0gYyB8fCA0NzAyOCA9PSBjIHx8IDQ3MDU2ID09IGMgfHwgNDcwODQgPT0gYyB8fCA0NzExMiA9PSBjIHx8IDQ3MTQwID09IGMgfHwgNDcxNjggPT0gYyB8fCA0NzE5NiA9PSBjIHx8IDQ3MjI0ID09IGMgfHwgNDcyNTIgPT0gYyB8fCA0NzI4MCA9PSBjIHx8IDQ3MzA4ID09IGMgfHwgNDczMzYgPT0gYyB8fCA0NzM2NCA9PSBjIHx8IDQ3MzkyID09IGMgfHwgNDc0MjAgPT0gYyB8fCA0NzQ0OCA9PSBjIHx8IDQ3NDc2ID09IGMgfHwgNDc1MDQgPT0gYyB8fCA0NzUzMiA9PSBjIHx8IDQ3NTYwID09IGMgfHwgNDc1ODggPT0gYyB8fCA0NzYxNiA9PSBjIHx8IDQ3NjQ0ID09IGMgfHwgNDc2NzIgPT0gYyB8fCA0NzcwMCA9PSBjIHx8IDQ3NzI4ID09IGMgfHwgNDc3NTYgPT0gYyB8fCA0Nzc4NCA9PSBjIHx8IDQ3ODEyID09IGMgfHwgNDc4NDAgPT0gYyB8fCA0Nzg2OCA9PQogICAgICAgICAgICBjIHx8IDQ3ODk2ID09IGMgfHwgNDc5MjQgPT0gYyB8fCA0Nzk1MiA9PSBjIHx8IDQ3OTgwID09IGMgfHwgNDgwMDggPT0gYyB8fCA0ODAzNiA9PSBjIHx8IDQ4MDY0ID09IGMgfHwgNDgwOTIgPT0gYyB8fCA0ODEyMCA9PSBjIHx8IDQ4MTQ4ID09IGMgfHwgNDgxNzYgPT0gYyB8fCA0ODIwNCA9PSBjIHx8IDQ4MjMyID09IGMgfHwgNDgyNjAgPT0gYyB8fCA0ODI4OCA9PSBjIHx8IDQ4MzE2ID09IGMgfHwgNDgzNDQgPT0gYyB8fCA0ODM3MiA9PSBjIHx8IDQ4NDAwID09IGMgfHwgNDg0MjggPT0gYyB8fCA0ODQ1NiA9PSBjIHx8IDQ4NDg0ID09IGMgfHwgNDg1MTIgPT0gYyB8fCA0ODU0MCA9PSBjIHx8IDQ4NTY4ID09IGMgfHwgNDg1OTYgPT0gYyB8fCA0ODYyNCA9PSBjIHx8IDQ4NjUyID09IGMgfHwgNDg2ODAgPT0gYyB8fCA0ODcwOCA9PSBjIHx8IDQ4NzM2ID09IGMgfHwgNDg3NjQgPT0gYyB8fCA0ODc5MiA9PSBjIHx8IDQ4ODIwID09IGMgfHwgNDg4NDggPT0gYyB8fCA0ODg3NiA9PSBjIHx8IDQ4OTA0ID09IGMgfHwgNDg5MzIgPT0gYyB8fCA0ODk2MCA9PSBjIHx8IDQ4OTg4ID09IGMgfHwgNDkwMTYgPT0gYyB8fCA0OTA0NCA9PSBjIHx8IDQ5MDcyID09IGMgfHwgNDkxMDAgPT0gYyB8fCA0OTEyOCA9PSBjIHx8IDQ5MTU2ID09IGMgfHwgNDkxODQgPT0gYyB8fCA0OTIxMiA9PSBjIHx8IDQ5MjQwID09IGMgfHwgNDkyNjggPT0gYyB8fAogICAgICAgICAgICA0OTI5NiA9PSBjIHx8IDQ5MzI0ID09IGMgfHwgNDkzNTIgPT0gYyB8fCA0OTM4MCA9PSBjIHx8IDQ5NDA4ID09IGMgfHwgNDk0MzYgPT0gYyB8fCA0OTQ2NCA9PSBjIHx8IDQ5NDkyID09IGMgfHwgNDk1MjAgPT0gYyB8fCA0OTU0OCA9PSBjIHx8IDQ5NTc2ID09IGMgfHwgNDk2MDQgPT0gYyB8fCA0OTYzMiA9PSBjIHx8IDQ5NjYwID09IGMgfHwgNDk2ODggPT0gYyB8fCA0OTcxNiA9PSBjIHx8IDQ5NzQ0ID09IGMgfHwgNDk3NzIgPT0gYyB8fCA0OTgwMCA9PSBjIHx8IDQ5ODI4ID09IGMgfHwgNDk4NTYgPT0gYyB8fCA0OTg4NCA9PSBjIHx8IDQ5OTEyID09IGMgfHwgNDk5NDAgPT0gYyB8fCA0OTk2OCA9PSBjIHx8IDQ5OTk2ID09IGMgfHwgNTAwMjQgPT0gYyB8fCA1MDA1MiA9PSBjIHx8IDUwMDgwID09IGMgfHwgNTAxMDggPT0gYyB8fCA1MDEzNiA9PSBjIHx8IDUwMTY0ID09IGMgfHwgNTAxOTIgPT0gYyB8fCA1MDIyMCA9PSBjIHx8IDUwMjQ4ID09IGMgfHwgNTAyNzYgPT0gYyB8fCA1MDMwNCA9PSBjIHx8IDUwMzMyID09IGMgfHwgNTAzNjAgPT0gYyB8fCA1MDM4OCA9PSBjIHx8IDUwNDE2ID09IGMgfHwgNTA0NDQgPT0gYyB8fCA1MDQ3MiA9PSBjIHx8IDUwNTAwID09IGMgfHwgNTA1MjggPT0gYyB8fCA1MDU1NiA9PSBjIHx8IDUwNTg0ID09IGMgfHwgNTA2MTIgPT0gYyB8fCA1MDY0MCA9PSBjIHx8IDUwNjY4ID09IGMgfHwgNTA2OTYgPT0KICAgICAgICAgICAgYyB8fCA1MDcyNCA9PSBjIHx8IDUwNzUyID09IGMgfHwgNTA3ODAgPT0gYyB8fCA1MDgwOCA9PSBjIHx8IDUwODM2ID09IGMgfHwgNTA4NjQgPT0gYyB8fCA1MDg5MiA9PSBjIHx8IDUwOTIwID09IGMgfHwgNTA5NDggPT0gYyB8fCA1MDk3NiA9PSBjIHx8IDUxMDA0ID09IGMgfHwgNTEwMzIgPT0gYyB8fCA1MTA2MCA9PSBjIHx8IDUxMDg4ID09IGMgfHwgNTExMTYgPT0gYyB8fCA1MTE0NCA9PSBjIHx8IDUxMTcyID09IGMgfHwgNTEyMDAgPT0gYyB8fCA1MTIyOCA9PSBjIHx8IDUxMjU2ID09IGMgfHwgNTEyODQgPT0gYyB8fCA1MTMxMiA9PSBjIHx8IDUxMzQwID09IGMgfHwgNTEzNjggPT0gYyB8fCA1MTM5NiA9PSBjIHx8IDUxNDI0ID09IGMgfHwgNTE0NTIgPT0gYyB8fCA1MTQ4MCA9PSBjIHx8IDUxNTA4ID09IGMgfHwgNTE1MzYgPT0gYyB8fCA1MTU2NCA9PSBjIHx8IDUxNTkyID09IGMgfHwgNTE2MjAgPT0gYyB8fCA1MTY0OCA9PSBjIHx8IDUxNjc2ID09IGMgfHwgNTE3MDQgPT0gYyB8fCA1MTczMiA9PSBjIHx8IDUxNzYwID09IGMgfHwgNTE3ODggPT0gYyB8fCA1MTgxNiA9PSBjIHx8IDUxODQ0ID09IGMgfHwgNTE4NzIgPT0gYyB8fCA1MTkwMCA9PSBjIHx8IDUxOTI4ID09IGMgfHwgNTE5NTYgPT0gYyB8fCA1MTk4NCA9PSBjIHx8IDUyMDEyID09IGMgfHwgNTIwNDAgPT0gYyB8fCA1MjA2OCA9PSBjIHx8IDUyMDk2ID09IGMgfHwKICAgICAgICAgICAgNTIxMjQgPT0gYyB8fCA1MjE1MiA9PSBjIHx8IDUyMTgwID09IGMgfHwgNTIyMDggPT0gYyB8fCA1MjIzNiA9PSBjIHx8IDUyMjY0ID09IGMgfHwgNTIyOTIgPT0gYyB8fCA1MjMyMCA9PSBjIHx8IDUyMzQ4ID09IGMgfHwgNTIzNzYgPT0gYyB8fCA1MjQwNCA9PSBjIHx8IDUyNDMyID09IGMgfHwgNTI0NjAgPT0gYyB8fCA1MjQ4OCA9PSBjIHx8IDUyNTE2ID09IGMgfHwgNTI1NDQgPT0gYyB8fCA1MjU3MiA9PSBjIHx8IDUyNjAwID09IGMgfHwgNTI2MjggPT0gYyB8fCA1MjY1NiA9PSBjIHx8IDUyNjg0ID09IGMgfHwgNTI3MTIgPT0gYyB8fCA1Mjc0MCA9PSBjIHx8IDUyNzY4ID09IGMgfHwgNTI3OTYgPT0gYyB8fCA1MjgyNCA9PSBjIHx8IDUyODUyID09IGMgfHwgNTI4ODAgPT0gYyB8fCA1MjkwOCA9PSBjIHx8IDUyOTM2ID09IGMgfHwgNTI5NjQgPT0gYyB8fCA1Mjk5MiA9PSBjIHx8IDUzMDIwID09IGMgfHwgNTMwNDggPT0gYyB8fCA1MzA3NiA9PSBjIHx8IDUzMTA0ID09IGMgfHwgNTMxMzIgPT0gYyB8fCA1MzE2MCA9PSBjIHx8IDUzMTg4ID09IGMgfHwgNTMyMTYgPT0gYyB8fCA1MzI0NCA9PSBjIHx8IDUzMjcyID09IGMgfHwgNTMzMDAgPT0gYyB8fCA1MzMyOCA9PSBjIHx8IDUzMzU2ID09IGMgfHwgNTMzODQgPT0gYyB8fCA1MzQxMiA9PSBjIHx8IDUzNDQwID09IGMgfHwgNTM0NjggPT0gYyB8fCA1MzQ5NiA9PSBjIHx8IDUzNTI0ID09CiAgICAgICAgICAgIGMgfHwgNTM1NTIgPT0gYyB8fCA1MzU4MCA9PSBjIHx8IDUzNjA4ID09IGMgfHwgNTM2MzYgPT0gYyB8fCA1MzY2NCA9PSBjIHx8IDUzNjkyID09IGMgfHwgNTM3MjAgPT0gYyB8fCA1Mzc0OCA9PSBjIHx8IDUzNzc2ID09IGMgfHwgNTM4MDQgPT0gYyB8fCA1MzgzMiA9PSBjIHx8IDUzODYwID09IGMgfHwgNTM4ODggPT0gYyB8fCA1MzkxNiA9PSBjIHx8IDUzOTQ0ID09IGMgfHwgNTM5NzIgPT0gYyB8fCA1NEUzID09IGMgfHwgNTQwMjggPT0gYyB8fCA1NDA1NiA9PSBjIHx8IDU0MDg0ID09IGMgfHwgNTQxMTIgPT0gYyB8fCA1NDE0MCA9PSBjIHx8IDU0MTY4ID09IGMgfHwgNTQxOTYgPT0gYyB8fCA1NDIyNCA9PSBjIHx8IDU0MjUyID09IGMgfHwgNTQyODAgPT0gYyB8fCA1NDMwOCA9PSBjIHx8IDU0MzM2ID09IGMgfHwgNTQzNjQgPT0gYyB8fCA1NDM5MiA9PSBjIHx8IDU0NDIwID09IGMgfHwgNTQ0NDggPT0gYyB8fCA1NDQ3NiA9PSBjIHx8IDU0NTA0ID09IGMgfHwgNTQ1MzIgPT0gYyB8fCA1NDU2MCA9PSBjIHx8IDU0NTg4ID09IGMgfHwgNTQ2MTYgPT0gYyB8fCA1NDY0NCA9PSBjIHx8IDU0NjcyID09IGMgfHwgNTQ3MDAgPT0gYyB8fCA1NDcyOCA9PSBjIHx8IDU0NzU2ID09IGMgfHwgNTQ3ODQgPT0gYyB8fCA1NDgxMiA9PSBjIHx8IDU0ODQwID09IGMgfHwgNTQ4NjggPT0gYyB8fCA1NDg5NiA9PSBjIHx8IDU0OTI0ID09IGMgfHwKICAgICAgICAgICAgNTQ5NTIgPT0gYyB8fCA1NDk4MCA9PSBjIHx8IDU1MDA4ID09IGMgfHwgNTUwMzYgPT0gYyB8fCA1NTA2NCA9PSBjIHx8IDU1MDkyID09IGMgfHwgNTUxMjAgPT0gYyB8fCA1NTE0OCA9PSBjIHx8IDU1MTc2ID09IGMgPyA5IDogNDQwMzMgPD0gYyAmJiA0NDA1OSA+PSBjIHx8IDQ0MDYxIDw9IGMgJiYgNDQwODcgPj0gYyB8fCA0NDA4OSA8PSBjICYmIDQ0MTE1ID49IGMgfHwgNDQxMTcgPD0gYyAmJiA0NDE0MyA+PSBjIHx8IDQ0MTQ1IDw9IGMgJiYgNDQxNzEgPj0gYyB8fCA0NDE3MyA8PSBjICYmIDQ0MTk5ID49IGMgfHwgNDQyMDEgPD0gYyAmJiA0NDIyNyA+PSBjIHx8IDQ0MjI5IDw9IGMgJiYgNDQyNTUgPj0gYyB8fCA0NDI1NyA8PSBjICYmIDQ0MjgzID49IGMgfHwgNDQyODUgPD0gYyAmJiA0NDMxMSA+PSBjIHx8IDQ0MzEzIDw9IGMgJiYgNDQzMzkgPj0gYyB8fCA0NDM0MSA8PSBjICYmIDQ0MzY3ID49IGMgfHwgNDQzNjkgPD0gYyAmJiA0NDM5NSA+PSBjIHx8IDQ0Mzk3IDw9IGMgJiYgNDQ0MjMgPj0gYyB8fCA0NDQyNSA8PSBjICYmIDQ0NDUxID49IGMgfHwgNDQ0NTMgPD0gYyAmJiA0NDQ3OSA+PSBjIHx8IDQ0NDgxIDw9IGMgJiYgNDQ1MDcgPj0gYyB8fCA0NDUwOSA8PSBjICYmIDQ0NTM1ID49IGMgfHwgNDQ1MzcgPD0gYyAmJiA0NDU2MyA+PSBjIHx8IDQ0NTY1IDw9IGMgJiYgNDQ1OTEgPj0gYyB8fCA0NDU5MyA8PSBjICYmCiAgICAgICAgICAgIDQ0NjE5ID49IGMgfHwgNDQ2MjEgPD0gYyAmJiA0NDY0NyA+PSBjIHx8IDQ0NjQ5IDw9IGMgJiYgNDQ2NzUgPj0gYyB8fCA0NDY3NyA8PSBjICYmIDQ0NzAzID49IGMgfHwgNDQ3MDUgPD0gYyAmJiA0NDczMSA+PSBjIHx8IDQ0NzMzIDw9IGMgJiYgNDQ3NTkgPj0gYyB8fCA0NDc2MSA8PSBjICYmIDQ0Nzg3ID49IGMgfHwgNDQ3ODkgPD0gYyAmJiA0NDgxNSA+PSBjIHx8IDQ0ODE3IDw9IGMgJiYgNDQ4NDMgPj0gYyB8fCA0NDg0NSA8PSBjICYmIDQ0ODcxID49IGMgfHwgNDQ4NzMgPD0gYyAmJiA0NDg5OSA+PSBjIHx8IDQ0OTAxIDw9IGMgJiYgNDQ5MjcgPj0gYyB8fCA0NDkyOSA8PSBjICYmIDQ0OTU1ID49IGMgfHwgNDQ5NTcgPD0gYyAmJiA0NDk4MyA+PSBjIHx8IDQ0OTg1IDw9IGMgJiYgNDUwMTEgPj0gYyB8fCA0NTAxMyA8PSBjICYmIDQ1MDM5ID49IGMgfHwgNDUwNDEgPD0gYyAmJiA0NTA2NyA+PSBjIHx8IDQ1MDY5IDw9IGMgJiYgNDUwOTUgPj0gYyB8fCA0NTA5NyA8PSBjICYmIDQ1MTIzID49IGMgfHwgNDUxMjUgPD0gYyAmJiA0NTE1MSA+PSBjIHx8IDQ1MTUzIDw9IGMgJiYgNDUxNzkgPj0gYyB8fCA0NTE4MSA8PSBjICYmIDQ1MjA3ID49IGMgfHwgNDUyMDkgPD0gYyAmJiA0NTIzNSA+PSBjIHx8IDQ1MjM3IDw9IGMgJiYgNDUyNjMgPj0gYyB8fCA0NTI2NSA8PSBjICYmIDQ1MjkxID49IGMgfHwgNDUyOTMgPD0gYyAmJiA0NTMxOSA+PQogICAgICAgICAgICBjIHx8IDQ1MzIxIDw9IGMgJiYgNDUzNDcgPj0gYyB8fCA0NTM0OSA8PSBjICYmIDQ1Mzc1ID49IGMgfHwgNDUzNzcgPD0gYyAmJiA0NTQwMyA+PSBjIHx8IDQ1NDA1IDw9IGMgJiYgNDU0MzEgPj0gYyB8fCA0NTQzMyA8PSBjICYmIDQ1NDU5ID49IGMgfHwgNDU0NjEgPD0gYyAmJiA0NTQ4NyA+PSBjIHx8IDQ1NDg5IDw9IGMgJiYgNDU1MTUgPj0gYyB8fCA0NTUxNyA8PSBjICYmIDQ1NTQzID49IGMgfHwgNDU1NDUgPD0gYyAmJiA0NTU3MSA+PSBjIHx8IDQ1NTczIDw9IGMgJiYgNDU1OTkgPj0gYyB8fCA0NTYwMSA8PSBjICYmIDQ1NjI3ID49IGMgfHwgNDU2MjkgPD0gYyAmJiA0NTY1NSA+PSBjIHx8IDQ1NjU3IDw9IGMgJiYgNDU2ODMgPj0gYyB8fCA0NTY4NSA8PSBjICYmIDQ1NzExID49IGMgfHwgNDU3MTMgPD0gYyAmJiA0NTczOSA+PSBjIHx8IDQ1NzQxIDw9IGMgJiYgNDU3NjcgPj0gYyB8fCA0NTc2OSA8PSBjICYmIDQ1Nzk1ID49IGMgfHwgNDU3OTcgPD0gYyAmJiA0NTgyMyA+PSBjIHx8IDQ1ODI1IDw9IGMgJiYgNDU4NTEgPj0gYyB8fCA0NTg1MyA8PSBjICYmIDQ1ODc5ID49IGMgfHwgNDU4ODEgPD0gYyAmJiA0NTkwNyA+PSBjIHx8IDQ1OTA5IDw9IGMgJiYgNDU5MzUgPj0gYyB8fCA0NTkzNyA8PSBjICYmIDQ1OTYzID49IGMgfHwgNDU5NjUgPD0gYyAmJiA0NTk5MSA+PSBjIHx8IDQ1OTkzIDw9IGMgJiYgNDYwMTkgPj0gYyB8fAogICAgICAgICAgICA0NjAyMSA8PSBjICYmIDQ2MDQ3ID49IGMgfHwgNDYwNDkgPD0gYyAmJiA0NjA3NSA+PSBjIHx8IDQ2MDc3IDw9IGMgJiYgNDYxMDMgPj0gYyB8fCA0NjEwNSA8PSBjICYmIDQ2MTMxID49IGMgfHwgNDYxMzMgPD0gYyAmJiA0NjE1OSA+PSBjIHx8IDQ2MTYxIDw9IGMgJiYgNDYxODcgPj0gYyB8fCA0NjE4OSA8PSBjICYmIDQ2MjE1ID49IGMgfHwgNDYyMTcgPD0gYyAmJiA0NjI0MyA+PSBjIHx8IDQ2MjQ1IDw9IGMgJiYgNDYyNzEgPj0gYyB8fCA0NjI3MyA8PSBjICYmIDQ2Mjk5ID49IGMgfHwgNDYzMDEgPD0gYyAmJiA0NjMyNyA+PSBjIHx8IDQ2MzI5IDw9IGMgJiYgNDYzNTUgPj0gYyB8fCA0NjM1NyA8PSBjICYmIDQ2MzgzID49IGMgfHwgNDYzODUgPD0gYyAmJiA0NjQxMSA+PSBjIHx8IDQ2NDEzIDw9IGMgJiYgNDY0MzkgPj0gYyB8fCA0NjQ0MSA8PSBjICYmIDQ2NDY3ID49IGMgfHwgNDY0NjkgPD0gYyAmJiA0NjQ5NSA+PSBjIHx8IDQ2NDk3IDw9IGMgJiYgNDY1MjMgPj0gYyB8fCA0NjUyNSA8PSBjICYmIDQ2NTUxID49IGMgfHwgNDY1NTMgPD0gYyAmJiA0NjU3OSA+PSBjIHx8IDQ2NTgxIDw9IGMgJiYgNDY2MDcgPj0gYyB8fCA0NjYwOSA8PSBjICYmIDQ2NjM1ID49IGMgfHwgNDY2MzcgPD0gYyAmJiA0NjY2MyA+PSBjIHx8IDQ2NjY1IDw9IGMgJiYgNDY2OTEgPj0gYyB8fCA0NjY5MyA8PSBjICYmIDQ2NzE5ID49IGMgfHwgNDY3MjEgPD0KICAgICAgICAgICAgYyAmJiA0Njc0NyA+PSBjIHx8IDQ2NzQ5IDw9IGMgJiYgNDY3NzUgPj0gYyB8fCA0Njc3NyA8PSBjICYmIDQ2ODAzID49IGMgfHwgNDY4MDUgPD0gYyAmJiA0NjgzMSA+PSBjIHx8IDQ2ODMzIDw9IGMgJiYgNDY4NTkgPj0gYyB8fCA0Njg2MSA8PSBjICYmIDQ2ODg3ID49IGMgfHwgNDY4ODkgPD0gYyAmJiA0NjkxNSA+PSBjIHx8IDQ2OTE3IDw9IGMgJiYgNDY5NDMgPj0gYyB8fCA0Njk0NSA8PSBjICYmIDQ2OTcxID49IGMgfHwgNDY5NzMgPD0gYyAmJiA0Njk5OSA+PSBjIHx8IDQ3MDAxIDw9IGMgJiYgNDcwMjcgPj0gYyB8fCA0NzAyOSA8PSBjICYmIDQ3MDU1ID49IGMgfHwgNDcwNTcgPD0gYyAmJiA0NzA4MyA+PSBjIHx8IDQ3MDg1IDw9IGMgJiYgNDcxMTEgPj0gYyB8fCA0NzExMyA8PSBjICYmIDQ3MTM5ID49IGMgfHwgNDcxNDEgPD0gYyAmJiA0NzE2NyA+PSBjIHx8IDQ3MTY5IDw9IGMgJiYgNDcxOTUgPj0gYyB8fCA0NzE5NyA8PSBjICYmIDQ3MjIzID49IGMgfHwgNDcyMjUgPD0gYyAmJiA0NzI1MSA+PSBjIHx8IDQ3MjUzIDw9IGMgJiYgNDcyNzkgPj0gYyB8fCA0NzI4MSA8PSBjICYmIDQ3MzA3ID49IGMgfHwgNDczMDkgPD0gYyAmJiA0NzMzNSA+PSBjIHx8IDQ3MzM3IDw9IGMgJiYgNDczNjMgPj0gYyB8fCA0NzM2NSA8PSBjICYmIDQ3MzkxID49IGMgfHwgNDczOTMgPD0gYyAmJiA0NzQxOSA+PSBjIHx8IDQ3NDIxIDw9IGMgJiYKICAgICAgICAgICAgNDc0NDcgPj0gYyB8fCA0NzQ0OSA8PSBjICYmIDQ3NDc1ID49IGMgfHwgNDc0NzcgPD0gYyAmJiA0NzUwMyA+PSBjIHx8IDQ3NTA1IDw9IGMgJiYgNDc1MzEgPj0gYyB8fCA0NzUzMyA8PSBjICYmIDQ3NTU5ID49IGMgfHwgNDc1NjEgPD0gYyAmJiA0NzU4NyA+PSBjIHx8IDQ3NTg5IDw9IGMgJiYgNDc2MTUgPj0gYyB8fCA0NzYxNyA8PSBjICYmIDQ3NjQzID49IGMgfHwgNDc2NDUgPD0gYyAmJiA0NzY3MSA+PSBjIHx8IDQ3NjczIDw9IGMgJiYgNDc2OTkgPj0gYyB8fCA0NzcwMSA8PSBjICYmIDQ3NzI3ID49IGMgfHwgNDc3MjkgPD0gYyAmJiA0Nzc1NSA+PSBjIHx8IDQ3NzU3IDw9IGMgJiYgNDc3ODMgPj0gYyB8fCA0Nzc4NSA8PSBjICYmIDQ3ODExID49IGMgfHwgNDc4MTMgPD0gYyAmJiA0NzgzOSA+PSBjIHx8IDQ3ODQxIDw9IGMgJiYgNDc4NjcgPj0gYyB8fCA0Nzg2OSA8PSBjICYmIDQ3ODk1ID49IGMgfHwgNDc4OTcgPD0gYyAmJiA0NzkyMyA+PSBjIHx8IDQ3OTI1IDw9IGMgJiYgNDc5NTEgPj0gYyB8fCA0Nzk1MyA8PSBjICYmIDQ3OTc5ID49IGMgfHwgNDc5ODEgPD0gYyAmJiA0ODAwNyA+PSBjIHx8IDQ4MDA5IDw9IGMgJiYgNDgwMzUgPj0gYyB8fCA0ODAzNyA8PSBjICYmIDQ4MDYzID49IGMgfHwgNDgwNjUgPD0gYyAmJiA0ODA5MSA+PSBjIHx8IDQ4MDkzIDw9IGMgJiYgNDgxMTkgPj0gYyB8fCA0ODEyMSA8PSBjICYmIDQ4MTQ3ID49CiAgICAgICAgICAgIGMgfHwgNDgxNDkgPD0gYyAmJiA0ODE3NSA+PSBjIHx8IDQ4MTc3IDw9IGMgJiYgNDgyMDMgPj0gYyB8fCA0ODIwNSA8PSBjICYmIDQ4MjMxID49IGMgfHwgNDgyMzMgPD0gYyAmJiA0ODI1OSA+PSBjIHx8IDQ4MjYxIDw9IGMgJiYgNDgyODcgPj0gYyB8fCA0ODI4OSA8PSBjICYmIDQ4MzE1ID49IGMgfHwgNDgzMTcgPD0gYyAmJiA0ODM0MyA+PSBjIHx8IDQ4MzQ1IDw9IGMgJiYgNDgzNzEgPj0gYyB8fCA0ODM3MyA8PSBjICYmIDQ4Mzk5ID49IGMgfHwgNDg0MDEgPD0gYyAmJiA0ODQyNyA+PSBjIHx8IDQ4NDI5IDw9IGMgJiYgNDg0NTUgPj0gYyB8fCA0ODQ1NyA8PSBjICYmIDQ4NDgzID49IGMgfHwgNDg0ODUgPD0gYyAmJiA0ODUxMSA+PSBjIHx8IDQ4NTEzIDw9IGMgJiYgNDg1MzkgPj0gYyB8fCA0ODU0MSA8PSBjICYmIDQ4NTY3ID49IGMgfHwgNDg1NjkgPD0gYyAmJiA0ODU5NSA+PSBjIHx8IDQ4NTk3IDw9IGMgJiYgNDg2MjMgPj0gYyB8fCA0ODYyNSA8PSBjICYmIDQ4NjUxID49IGMgfHwgNDg2NTMgPD0gYyAmJiA0ODY3OSA+PSBjIHx8IDQ4NjgxIDw9IGMgJiYgNDg3MDcgPj0gYyB8fCA0ODcwOSA8PSBjICYmIDQ4NzM1ID49IGMgfHwgNDg3MzcgPD0gYyAmJiA0ODc2MyA+PSBjIHx8IDQ4NzY1IDw9IGMgJiYgNDg3OTEgPj0gYyB8fCA0ODc5MyA8PSBjICYmIDQ4ODE5ID49IGMgfHwgNDg4MjEgPD0gYyAmJiA0ODg0NyA+PSBjIHx8CiAgICAgICAgICAgIDQ4ODQ5IDw9IGMgJiYgNDg4NzUgPj0gYyB8fCA0ODg3NyA8PSBjICYmIDQ4OTAzID49IGMgfHwgNDg5MDUgPD0gYyAmJiA0ODkzMSA+PSBjIHx8IDQ4OTMzIDw9IGMgJiYgNDg5NTkgPj0gYyB8fCA0ODk2MSA8PSBjICYmIDQ4OTg3ID49IGMgfHwgNDg5ODkgPD0gYyAmJiA0OTAxNSA+PSBjIHx8IDQ5MDE3IDw9IGMgJiYgNDkwNDMgPj0gYyB8fCA0OTA0NSA8PSBjICYmIDQ5MDcxID49IGMgfHwgNDkwNzMgPD0gYyAmJiA0OTA5OSA+PSBjIHx8IDQ5MTAxIDw9IGMgJiYgNDkxMjcgPj0gYyB8fCA0OTEyOSA8PSBjICYmIDQ5MTU1ID49IGMgfHwgNDkxNTcgPD0gYyAmJiA0OTE4MyA+PSBjIHx8IDQ5MTg1IDw9IGMgJiYgNDkyMTEgPj0gYyB8fCA0OTIxMyA8PSBjICYmIDQ5MjM5ID49IGMgfHwgNDkyNDEgPD0gYyAmJiA0OTI2NyA+PSBjIHx8IDQ5MjY5IDw9IGMgJiYgNDkyOTUgPj0gYyB8fCA0OTI5NyA8PSBjICYmIDQ5MzIzID49IGMgfHwgNDkzMjUgPD0gYyAmJiA0OTM1MSA+PSBjIHx8IDQ5MzUzIDw9IGMgJiYgNDkzNzkgPj0gYyB8fCA0OTM4MSA8PSBjICYmIDQ5NDA3ID49IGMgfHwgNDk0MDkgPD0gYyAmJiA0OTQzNSA+PSBjIHx8IDQ5NDM3IDw9IGMgJiYgNDk0NjMgPj0gYyB8fCA0OTQ2NSA8PSBjICYmIDQ5NDkxID49IGMgfHwgNDk0OTMgPD0gYyAmJiA0OTUxOSA+PSBjIHx8IDQ5NTIxIDw9IGMgJiYgNDk1NDcgPj0gYyB8fCA0OTU0OSA8PQogICAgICAgICAgICBjICYmIDQ5NTc1ID49IGMgfHwgNDk1NzcgPD0gYyAmJiA0OTYwMyA+PSBjIHx8IDQ5NjA1IDw9IGMgJiYgNDk2MzEgPj0gYyB8fCA0OTYzMyA8PSBjICYmIDQ5NjU5ID49IGMgfHwgNDk2NjEgPD0gYyAmJiA0OTY4NyA+PSBjIHx8IDQ5Njg5IDw9IGMgJiYgNDk3MTUgPj0gYyB8fCA0OTcxNyA8PSBjICYmIDQ5NzQzID49IGMgfHwgNDk3NDUgPD0gYyAmJiA0OTc3MSA+PSBjIHx8IDQ5NzczIDw9IGMgJiYgNDk3OTkgPj0gYyB8fCA0OTgwMSA8PSBjICYmIDQ5ODI3ID49IGMgfHwgNDk4MjkgPD0gYyAmJiA0OTg1NSA+PSBjIHx8IDQ5ODU3IDw9IGMgJiYgNDk4ODMgPj0gYyB8fCA0OTg4NSA8PSBjICYmIDQ5OTExID49IGMgfHwgNDk5MTMgPD0gYyAmJiA0OTkzOSA+PSBjIHx8IDQ5OTQxIDw9IGMgJiYgNDk5NjcgPj0gYyB8fCA0OTk2OSA8PSBjICYmIDQ5OTk1ID49IGMgfHwgNDk5OTcgPD0gYyAmJiA1MDAyMyA+PSBjIHx8IDUwMDI1IDw9IGMgJiYgNTAwNTEgPj0gYyB8fCA1MDA1MyA8PSBjICYmIDUwMDc5ID49IGMgfHwgNTAwODEgPD0gYyAmJiA1MDEwNyA+PSBjIHx8IDUwMTA5IDw9IGMgJiYgNTAxMzUgPj0gYyB8fCA1MDEzNyA8PSBjICYmIDUwMTYzID49IGMgfHwgNTAxNjUgPD0gYyAmJiA1MDE5MSA+PSBjIHx8IDUwMTkzIDw9IGMgJiYgNTAyMTkgPj0gYyB8fCA1MDIyMSA8PSBjICYmIDUwMjQ3ID49IGMgfHwgNTAyNDkgPD0gYyAmJgogICAgICAgICAgICA1MDI3NSA+PSBjIHx8IDUwMjc3IDw9IGMgJiYgNTAzMDMgPj0gYyB8fCA1MDMwNSA8PSBjICYmIDUwMzMxID49IGMgfHwgNTAzMzMgPD0gYyAmJiA1MDM1OSA+PSBjIHx8IDUwMzYxIDw9IGMgJiYgNTAzODcgPj0gYyB8fCA1MDM4OSA8PSBjICYmIDUwNDE1ID49IGMgfHwgNTA0MTcgPD0gYyAmJiA1MDQ0MyA+PSBjIHx8IDUwNDQ1IDw9IGMgJiYgNTA0NzEgPj0gYyB8fCA1MDQ3MyA8PSBjICYmIDUwNDk5ID49IGMgfHwgNTA1MDEgPD0gYyAmJiA1MDUyNyA+PSBjIHx8IDUwNTI5IDw9IGMgJiYgNTA1NTUgPj0gYyB8fCA1MDU1NyA8PSBjICYmIDUwNTgzID49IGMgfHwgNTA1ODUgPD0gYyAmJiA1MDYxMSA+PSBjIHx8IDUwNjEzIDw9IGMgJiYgNTA2MzkgPj0gYyB8fCA1MDY0MSA8PSBjICYmIDUwNjY3ID49IGMgfHwgNTA2NjkgPD0gYyAmJiA1MDY5NSA+PSBjIHx8IDUwNjk3IDw9IGMgJiYgNTA3MjMgPj0gYyB8fCA1MDcyNSA8PSBjICYmIDUwNzUxID49IGMgfHwgNTA3NTMgPD0gYyAmJiA1MDc3OSA+PSBjIHx8IDUwNzgxIDw9IGMgJiYgNTA4MDcgPj0gYyB8fCA1MDgwOSA8PSBjICYmIDUwODM1ID49IGMgfHwgNTA4MzcgPD0gYyAmJiA1MDg2MyA+PSBjIHx8IDUwODY1IDw9IGMgJiYgNTA4OTEgPj0gYyB8fCA1MDg5MyA8PSBjICYmIDUwOTE5ID49IGMgfHwgNTA5MjEgPD0gYyAmJiA1MDk0NyA+PSBjIHx8IDUwOTQ5IDw9IGMgJiYgNTA5NzUgPj0KICAgICAgICAgICAgYyB8fCA1MDk3NyA8PSBjICYmIDUxMDAzID49IGMgfHwgNTEwMDUgPD0gYyAmJiA1MTAzMSA+PSBjIHx8IDUxMDMzIDw9IGMgJiYgNTEwNTkgPj0gYyB8fCA1MTA2MSA8PSBjICYmIDUxMDg3ID49IGMgfHwgNTEwODkgPD0gYyAmJiA1MTExNSA+PSBjIHx8IDUxMTE3IDw9IGMgJiYgNTExNDMgPj0gYyB8fCA1MTE0NSA8PSBjICYmIDUxMTcxID49IGMgfHwgNTExNzMgPD0gYyAmJiA1MTE5OSA+PSBjIHx8IDUxMjAxIDw9IGMgJiYgNTEyMjcgPj0gYyB8fCA1MTIyOSA8PSBjICYmIDUxMjU1ID49IGMgfHwgNTEyNTcgPD0gYyAmJiA1MTI4MyA+PSBjIHx8IDUxMjg1IDw9IGMgJiYgNTEzMTEgPj0gYyB8fCA1MTMxMyA8PSBjICYmIDUxMzM5ID49IGMgfHwgNTEzNDEgPD0gYyAmJiA1MTM2NyA+PSBjIHx8IDUxMzY5IDw9IGMgJiYgNTEzOTUgPj0gYyB8fCA1MTM5NyA8PSBjICYmIDUxNDIzID49IGMgfHwgNTE0MjUgPD0gYyAmJiA1MTQ1MSA+PSBjIHx8IDUxNDUzIDw9IGMgJiYgNTE0NzkgPj0gYyB8fCA1MTQ4MSA8PSBjICYmIDUxNTA3ID49IGMgfHwgNTE1MDkgPD0gYyAmJiA1MTUzNSA+PSBjIHx8IDUxNTM3IDw9IGMgJiYgNTE1NjMgPj0gYyB8fCA1MTU2NSA8PSBjICYmIDUxNTkxID49IGMgfHwgNTE1OTMgPD0gYyAmJiA1MTYxOSA+PSBjIHx8IDUxNjIxIDw9IGMgJiYgNTE2NDcgPj0gYyB8fCA1MTY0OSA8PSBjICYmIDUxNjc1ID49IGMgfHwKICAgICAgICAgICAgNTE2NzcgPD0gYyAmJiA1MTcwMyA+PSBjIHx8IDUxNzA1IDw9IGMgJiYgNTE3MzEgPj0gYyB8fCA1MTczMyA8PSBjICYmIDUxNzU5ID49IGMgfHwgNTE3NjEgPD0gYyAmJiA1MTc4NyA+PSBjIHx8IDUxNzg5IDw9IGMgJiYgNTE4MTUgPj0gYyB8fCA1MTgxNyA8PSBjICYmIDUxODQzID49IGMgfHwgNTE4NDUgPD0gYyAmJiA1MTg3MSA+PSBjIHx8IDUxODczIDw9IGMgJiYgNTE4OTkgPj0gYyB8fCA1MTkwMSA8PSBjICYmIDUxOTI3ID49IGMgfHwgNTE5MjkgPD0gYyAmJiA1MTk1NSA+PSBjIHx8IDUxOTU3IDw9IGMgJiYgNTE5ODMgPj0gYyB8fCA1MTk4NSA8PSBjICYmIDUyMDExID49IGMgfHwgNTIwMTMgPD0gYyAmJiA1MjAzOSA+PSBjIHx8IDUyMDQxIDw9IGMgJiYgNTIwNjcgPj0gYyB8fCA1MjA2OSA8PSBjICYmIDUyMDk1ID49IGMgfHwgNTIwOTcgPD0gYyAmJiA1MjEyMyA+PSBjIHx8IDUyMTI1IDw9IGMgJiYgNTIxNTEgPj0gYyB8fCA1MjE1MyA8PSBjICYmIDUyMTc5ID49IGMgfHwgNTIxODEgPD0gYyAmJiA1MjIwNyA+PSBjIHx8IDUyMjA5IDw9IGMgJiYgNTIyMzUgPj0gYyB8fCA1MjIzNyA8PSBjICYmIDUyMjYzID49IGMgfHwgNTIyNjUgPD0gYyAmJiA1MjI5MSA+PSBjIHx8IDUyMjkzIDw9IGMgJiYgNTIzMTkgPj0gYyB8fCA1MjMyMSA8PSBjICYmIDUyMzQ3ID49IGMgfHwgNTIzNDkgPD0gYyAmJiA1MjM3NSA+PSBjIHx8IDUyMzc3IDw9CiAgICAgICAgICAgIGMgJiYgNTI0MDMgPj0gYyB8fCA1MjQwNSA8PSBjICYmIDUyNDMxID49IGMgfHwgNTI0MzMgPD0gYyAmJiA1MjQ1OSA+PSBjIHx8IDUyNDYxIDw9IGMgJiYgNTI0ODcgPj0gYyB8fCA1MjQ4OSA8PSBjICYmIDUyNTE1ID49IGMgfHwgNTI1MTcgPD0gYyAmJiA1MjU0MyA+PSBjIHx8IDUyNTQ1IDw9IGMgJiYgNTI1NzEgPj0gYyB8fCA1MjU3MyA8PSBjICYmIDUyNTk5ID49IGMgfHwgNTI2MDEgPD0gYyAmJiA1MjYyNyA+PSBjIHx8IDUyNjI5IDw9IGMgJiYgNTI2NTUgPj0gYyB8fCA1MjY1NyA8PSBjICYmIDUyNjgzID49IGMgfHwgNTI2ODUgPD0gYyAmJiA1MjcxMSA+PSBjIHx8IDUyNzEzIDw9IGMgJiYgNTI3MzkgPj0gYyB8fCA1Mjc0MSA8PSBjICYmIDUyNzY3ID49IGMgfHwgNTI3NjkgPD0gYyAmJiA1Mjc5NSA+PSBjIHx8IDUyNzk3IDw9IGMgJiYgNTI4MjMgPj0gYyB8fCA1MjgyNSA8PSBjICYmIDUyODUxID49IGMgfHwgNTI4NTMgPD0gYyAmJiA1Mjg3OSA+PSBjIHx8IDUyODgxIDw9IGMgJiYgNTI5MDcgPj0gYyB8fCA1MjkwOSA8PSBjICYmIDUyOTM1ID49IGMgfHwgNTI5MzcgPD0gYyAmJiA1Mjk2MyA+PSBjIHx8IDUyOTY1IDw9IGMgJiYgNTI5OTEgPj0gYyB8fCA1Mjk5MyA8PSBjICYmIDUzMDE5ID49IGMgfHwgNTMwMjEgPD0gYyAmJiA1MzA0NyA+PSBjIHx8IDUzMDQ5IDw9IGMgJiYgNTMwNzUgPj0gYyB8fCA1MzA3NyA8PSBjICYmCiAgICAgICAgICAgIDUzMTAzID49IGMgfHwgNTMxMDUgPD0gYyAmJiA1MzEzMSA+PSBjIHx8IDUzMTMzIDw9IGMgJiYgNTMxNTkgPj0gYyB8fCA1MzE2MSA8PSBjICYmIDUzMTg3ID49IGMgfHwgNTMxODkgPD0gYyAmJiA1MzIxNSA+PSBjIHx8IDUzMjE3IDw9IGMgJiYgNTMyNDMgPj0gYyB8fCA1MzI0NSA8PSBjICYmIDUzMjcxID49IGMgfHwgNTMyNzMgPD0gYyAmJiA1MzI5OSA+PSBjIHx8IDUzMzAxIDw9IGMgJiYgNTMzMjcgPj0gYyB8fCA1MzMyOSA8PSBjICYmIDUzMzU1ID49IGMgfHwgNTMzNTcgPD0gYyAmJiA1MzM4MyA+PSBjIHx8IDUzMzg1IDw9IGMgJiYgNTM0MTEgPj0gYyB8fCA1MzQxMyA8PSBjICYmIDUzNDM5ID49IGMgfHwgNTM0NDEgPD0gYyAmJiA1MzQ2NyA+PSBjIHx8IDUzNDY5IDw9IGMgJiYgNTM0OTUgPj0gYyB8fCA1MzQ5NyA8PSBjICYmIDUzNTIzID49IGMgfHwgNTM1MjUgPD0gYyAmJiA1MzU1MSA+PSBjIHx8IDUzNTUzIDw9IGMgJiYgNTM1NzkgPj0gYyB8fCA1MzU4MSA8PSBjICYmIDUzNjA3ID49IGMgfHwgNTM2MDkgPD0gYyAmJiA1MzYzNSA+PSBjIHx8IDUzNjM3IDw9IGMgJiYgNTM2NjMgPj0gYyB8fCA1MzY2NSA8PSBjICYmIDUzNjkxID49IGMgfHwgNTM2OTMgPD0gYyAmJiA1MzcxOSA+PSBjIHx8IDUzNzIxIDw9IGMgJiYgNTM3NDcgPj0gYyB8fCA1Mzc0OSA8PSBjICYmIDUzNzc1ID49IGMgfHwgNTM3NzcgPD0gYyAmJiA1MzgwMyA+PQogICAgICAgICAgICBjIHx8IDUzODA1IDw9IGMgJiYgNTM4MzEgPj0gYyB8fCA1MzgzMyA8PSBjICYmIDUzODU5ID49IGMgfHwgNTM4NjEgPD0gYyAmJiA1Mzg4NyA+PSBjIHx8IDUzODg5IDw9IGMgJiYgNTM5MTUgPj0gYyB8fCA1MzkxNyA8PSBjICYmIDUzOTQzID49IGMgfHwgNTM5NDUgPD0gYyAmJiA1Mzk3MSA+PSBjIHx8IDUzOTczIDw9IGMgJiYgNTM5OTkgPj0gYyB8fCA1NDAwMSA8PSBjICYmIDU0MDI3ID49IGMgfHwgNTQwMjkgPD0gYyAmJiA1NDA1NSA+PSBjIHx8IDU0MDU3IDw9IGMgJiYgNTQwODMgPj0gYyB8fCA1NDA4NSA8PSBjICYmIDU0MTExID49IGMgfHwgNTQxMTMgPD0gYyAmJiA1NDEzOSA+PSBjIHx8IDU0MTQxIDw9IGMgJiYgNTQxNjcgPj0gYyB8fCA1NDE2OSA8PSBjICYmIDU0MTk1ID49IGMgfHwgNTQxOTcgPD0gYyAmJiA1NDIyMyA+PSBjIHx8IDU0MjI1IDw9IGMgJiYgNTQyNTEgPj0gYyB8fCA1NDI1MyA8PSBjICYmIDU0Mjc5ID49IGMgfHwgNTQyODEgPD0gYyAmJiA1NDMwNyA+PSBjIHx8IDU0MzA5IDw9IGMgJiYgNTQzMzUgPj0gYyB8fCA1NDMzNyA8PSBjICYmIDU0MzYzID49IGMgfHwgNTQzNjUgPD0gYyAmJiA1NDM5MSA+PSBjIHx8IDU0MzkzIDw9IGMgJiYgNTQ0MTkgPj0gYyB8fCA1NDQyMSA8PSBjICYmIDU0NDQ3ID49IGMgfHwgNTQ0NDkgPD0gYyAmJiA1NDQ3NSA+PSBjIHx8IDU0NDc3IDw9IGMgJiYgNTQ1MDMgPj0gYyB8fAogICAgICAgICAgICA1NDUwNSA8PSBjICYmIDU0NTMxID49IGMgfHwgNTQ1MzMgPD0gYyAmJiA1NDU1OSA+PSBjIHx8IDU0NTYxIDw9IGMgJiYgNTQ1ODcgPj0gYyB8fCA1NDU4OSA8PSBjICYmIDU0NjE1ID49IGMgfHwgNTQ2MTcgPD0gYyAmJiA1NDY0MyA+PSBjIHx8IDU0NjQ1IDw9IGMgJiYgNTQ2NzEgPj0gYyB8fCA1NDY3MyA8PSBjICYmIDU0Njk5ID49IGMgfHwgNTQ3MDEgPD0gYyAmJiA1NDcyNyA+PSBjIHx8IDU0NzI5IDw9IGMgJiYgNTQ3NTUgPj0gYyB8fCA1NDc1NyA8PSBjICYmIDU0NzgzID49IGMgfHwgNTQ3ODUgPD0gYyAmJiA1NDgxMSA+PSBjIHx8IDU0ODEzIDw9IGMgJiYgNTQ4MzkgPj0gYyB8fCA1NDg0MSA8PSBjICYmIDU0ODY3ID49IGMgfHwgNTQ4NjkgPD0gYyAmJiA1NDg5NSA+PSBjIHx8IDU0ODk3IDw9IGMgJiYgNTQ5MjMgPj0gYyB8fCA1NDkyNSA8PSBjICYmIDU0OTUxID49IGMgfHwgNTQ5NTMgPD0gYyAmJiA1NDk3OSA+PSBjIHx8IDU0OTgxIDw9IGMgJiYgNTUwMDcgPj0gYyB8fCA1NTAwOSA8PSBjICYmIDU1MDM1ID49IGMgfHwgNTUwMzcgPD0gYyAmJiA1NTA2MyA+PSBjIHx8IDU1MDY1IDw9IGMgJiYgNTUwOTEgPj0gYyB8fCA1NTA5MyA8PSBjICYmIDU1MTE5ID49IGMgfHwgNTUxMjEgPD0gYyAmJiA1NTE0NyA+PSBjIHx8IDU1MTQ5IDw9IGMgJiYgNTUxNzUgPj0gYyB8fCA1NTE3NyA8PSBjICYmIDU1MjAzID49IGMgPyAxMCA6CiAgICAgICAgICAgIDk3NTcgPT0gYyB8fCA5OTc3ID09IGMgfHwgOTk5NCA8PSBjICYmIDk5OTcgPj0gYyB8fCAxMjc4NzcgPT0gYyB8fCAxMjc5MzggPD0gYyAmJiAxMjc5NDAgPj0gYyB8fCAxMjc5NDMgPT0gYyB8fCAxMjc5NDYgPD0gYyAmJiAxMjc5NDggPj0gYyB8fCAxMjgwNjYgPD0gYyAmJiAxMjgwNjcgPj0gYyB8fCAxMjgwNzAgPD0gYyAmJiAxMjgwODAgPj0gYyB8fCAxMjgxMTAgPT0gYyB8fCAxMjgxMTIgPD0gYyAmJiAxMjgxMjAgPj0gYyB8fCAxMjgxMjQgPT0gYyB8fCAxMjgxMjkgPD0gYyAmJiAxMjgxMzEgPj0gYyB8fCAxMjgxMzMgPD0gYyAmJiAxMjgxMzUgPj0gYyB8fCAxMjgxNzAgPT0gYyB8fCAxMjgzNzIgPD0gYyAmJiAxMjgzNzMgPj0gYyB8fCAxMjgzNzggPT0gYyB8fCAxMjg0MDAgPT0gYyB8fCAxMjg0MDUgPD0gYyAmJiAxMjg0MDYgPj0gYyB8fCAxMjg1ODEgPD0gYyAmJiAxMjg1ODMgPj0gYyB8fCAxMjg1ODcgPD0gYyAmJiAxMjg1OTEgPj0gYyB8fCAxMjg2NzUgPT0gYyB8fCAxMjg2OTIgPD0gYyAmJiAxMjg2OTQgPj0gYyB8fCAxMjg3MDQgPT0gYyB8fCAxMjg3MTYgPT0gYyB8fCAxMjkzMDQgPD0gYyAmJiAxMjkzMDggPj0gYyB8fCAxMjkzMTAgPD0gYyAmJiAxMjkzMTEgPj0gYyB8fCAxMjkzMTggPT0gYyB8fCAxMjkzMjggPD0gYyAmJiAxMjkzMzcgPj0gYyB8fCAxMjkzNDEgPD0gYyAmJiAxMjkzNDIgPj0KICAgICAgICAgICAgYyB8fCAxMjk0ODkgPD0gYyAmJiAxMjk1MDEgPj0gYyA/IDEzIDogMTI3OTk1IDw9IGMgJiYgMTI3OTk5ID49IGMgPyAxNCA6IDgyMDUgPT0gYyA/IDE1IDogOTc5MiA9PSBjIHx8IDk3OTQgPT0gYyB8fCA5ODc3IDw9IGMgJiYgOTg3OCA+PSBjIHx8IDk5OTIgPT0gYyB8fCAxMDA4NCA9PSBjIHx8IDEyNzc1MiA9PSBjIHx8IDEyNzgwNiA9PSBjIHx8IDEyNzg1OSA9PSBjIHx8IDEyNzg5MSA9PSBjIHx8IDEyNzkwOCA9PSBjIHx8IDEyNzkxMiA9PSBjIHx8IDEyNzk3OSA9PSBjIHx8IDEyNzk4MSA9PSBjIHx8IDEyODEzOSA9PSBjIHx8IDEyODE4NyA8PSBjICYmIDEyODE4OCA+PSBjIHx8IDEyODI5NSA9PSBjIHx8IDEyODMwMCA9PSBjIHx8IDEyODQ4OCA9PSBjIHx8IDEyODY0MCA9PSBjIHx8IDEyODY1OCA9PSBjID8gMTYgOiAxMjgxMDIgPD0gYyAmJiAxMjgxMDUgPj0gYyA/IDE3IDogMTEKICAgIH0KICAgIHRoaXMubmV4dEJyZWFrID0gZnVuY3Rpb24oYywgZSkgewogICAgICAgIHZvaWQgMCA9PT0gZSAmJiAoZSA9IDApOwogICAgICAgIGlmICgwID4gZSkgcmV0dXJuIDA7CiAgICAgICAgaWYgKGUgPj0gYy5sZW5ndGggLSAxKSByZXR1cm4gYy5sZW5ndGg7CiAgICAgICAgdmFyIGcgPSBkKGEoYywgZSkpLAogICAgICAgICAgICBrID0gW107CiAgICAgICAgZm9yIChlICs9IDE7IGUgPCBjLmxlbmd0aDsgZSsrKSB7CiAgICAgICAgICAgIHZhciBtID0gYywKICAgICAgICAgICAgICAgIG4gPSBlIC0gMTsKICAgICAgICAgICAgaWYgKCEoNTUyOTYgPD0gbS5jaGFyQ29kZUF0KG4pICYmCiAgICAgICAgICAgICAgICAgICAgNTYzMTkgPj0gbS5jaGFyQ29kZUF0KG4pICYmIDU2MzIwIDw9IG0uY2hhckNvZGVBdChuICsgMSkgJiYgNTczNDMgPj0gbS5jaGFyQ29kZUF0KG4gKyAxKSkpIHsKICAgICAgICAgICAgICAgIG0gPSBkKGEoYywgZSkpOwogICAgICAgICAgICAgICAgaWYgKGIoZywgaywgbSkpIHJldHVybiBlOwogICAgICAgICAgICAgICAgay5wdXNoKG0pCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGMubGVuZ3RoCiAgICB9OwogICAgdGhpcy5zcGxpdEdyYXBoZW1lcyA9IGZ1bmN0aW9uKGMpIHsKICAgICAgICBmb3IgKHZhciBlID0gW10sIGcgPSAwLCBrOwogICAgICAgICAgICAoayA9IHRoaXMubmV4dEJyZWFrKGMsIGcpKSA8IGMubGVuZ3RoOykgZS5wdXNoKGMuc2xpY2UoZywgaykpLCBnID0gazsKICAgICAgICBnIDwgYy5sZW5ndGggJiYgZS5wdXNoKGMuc2xpY2UoZykpOwogICAgICAgIHJldHVybiBlCiAgICB9OwogICAgdGhpcy5pdGVyYXRlR3JhcGhlbWVzID0gZnVuY3Rpb24oYykgewogICAgICAgIHZhciBlID0gMCwKICAgICAgICAgICAgZyA9IHsKICAgICAgICAgICAgICAgIG5leHQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBrOwogICAgICAgICAgICAgICAgICAgIGlmICgoayA9IHRoaXMubmV4dEJyZWFrKGMsIGUpKSA8IGMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtID0gYy5zbGljZShlLCBrKTsKICAgICAgICAgICAgICAgICAgICAgICAgZSA9IGs7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogbSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvbmU6ICExCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGUgPCBjLmxlbmd0aCA/IChtID0gYy5zbGljZShlKSwgZSA9IGMubGVuZ3RoLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBtLAogICAgICAgICAgICAgICAgICAgICAgICBkb25lOiAhMQogICAgICAgICAgICAgICAgICAgIH0pIDogewogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdm9pZCAwLAogICAgICAgICAgICAgICAgICAgICAgICBkb25lOiAhMAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKQogICAgICAgICAgICB9OwogICAgICAgICJ1bmRlZmluZWQiICE9PSB0eXBlb2YgU3ltYm9sICYmIFN5bWJvbC5pdGVyYXRvciAmJiAoZ1tTeW1ib2wuaXRlcmF0b3JdID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiBnCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIGcKICAgIH07CiAgICB0aGlzLmNvdW50R3JhcGhlbWVzID0gZnVuY3Rpb24oYykgewogICAgICAgIGZvciAodmFyIGUgPSAwLCBnID0gMCwgazsKICAgICAgICAgICAgKGsgPSB0aGlzLm5leHRCcmVhayhjLCBnKSkgPCBjLmxlbmd0aDspIGcgPSBrLCBlKys7CiAgICAgICAgZyA8IGMubGVuZ3RoICYmIGUrKzsKICAgICAgICByZXR1cm4gZQogICAgfTsKICAgIHJldHVybiB0aGlzCn07CiJ1c2Ugc3RyaWN0IjsKCmZ1bmN0aW9uIGxpbmVJbnQoYSwgYiwgZCkgewogICAgdmFyIGMgPSBbMCwgMF07CiAgICB2YXIgZSA9IGFbMV1bMV0gLSBhWzBdWzFdOwogICAgdmFyIGcgPSBhWzBdWzBdIC0gYVsxXVswXTsKICAgIGEgPSBlICogYVswXVswXSArIGcgKiBhWzBdWzFdOwogICAgdmFyIGsgPSBiWzFdWzFdIC0gYlswXVsxXTsKICAgIHZhciBtID0gYlswXVswXSAtIGJbMV1bMF07CiAgICBiID0gayAqIGJbMF1bMF0gKyBtICogYlswXVsxXTsKICAgIHZhciBuID0gZSAqIG0gLSBrICogZzsKICAgIHNjYWxhcl9lcShuLCAwLCBkIHx8IDApIHx8IChjWzBdID0gKG0gKiBhIC0gZyAqIGIpIC8gbiwgY1sxXSA9IChlICogYiAtIGsgKiBhKSAvIG4pOwogICAgcmV0dXJuIGMKfQoKZnVuY3Rpb24gbGluZVNlZ21lbnRzSW50ZXJzZWN0KGEsIGIsIGQsIGMpIHsKICAgIHZhciBlID0gYlswXSAtIGFbMF07CiAgICBiID0gYlsxXSAtIGFbMV07CiAgICB2YXIgZyA9IGNbMF0gLSBkWzBdLAogICAgICAgIGsgPSBjWzFdIC0gZFsxXTsKICAgIGlmICgwID09PSBnICogYiAtIGsgKiBlKSByZXR1cm4gITE7CiAgICBjID0gKGUgKiAoZFsxXSAtIGFbMV0pICsgYiAqIChhWzBdIC0gZFswXSkpIC8gKGcgKiBiIC0gayAqIGUpOwogICAgYSA9IChnICogKGFbMV0gLSBkWzFdKSArIGsgKiAoZFswXSAtIGFbMF0pKSAvIChrICogZSAtIGcgKiBiKTsKICAgIHJldHVybiAwIDw9IGMgJiYgMSA+PSBjICYmIDAgPD0gYSAmJiAxID49IGEKfQoKZnVuY3Rpb24gdHJpYW5nbGVBcmVhKGEsIGIsIGQpIHsKICAgIHJldHVybiAoYlswXSAtIGFbMF0pICogKGRbMV0gLSBhWzFdKSAtIChkWzBdIC0gYVswXSkgKiAoYlsxXSAtIGFbMV0pCn0KCmZ1bmN0aW9uIGlzTGVmdChhLCBiLCBkKSB7CiAgICByZXR1cm4gMCA8IHRyaWFuZ2xlQXJlYShhLCBiLCBkKQp9CgpmdW5jdGlvbiBpc0xlZnRPbihhLCBiLCBkKSB7CiAgICByZXR1cm4gMCA8PSB0cmlhbmdsZUFyZWEoYSwgYiwgZCkKfQoKZnVuY3Rpb24gaXNSaWdodChhLCBiLCBkKSB7CiAgICByZXR1cm4gMCA+IHRyaWFuZ2xlQXJlYShhLCBiLCBkKQp9CgpmdW5jdGlvbiBpc1JpZ2h0T24oYSwgYiwgZCkgewogICAgcmV0dXJuIDAgPj0gdHJpYW5nbGVBcmVhKGEsIGIsIGQpCn0KdmFyIHRtcFBvaW50MSQkbW9kdWxlJHN0ciRjM3J1bnRpbWUgPSBbXSwKICAgIHRtcFBvaW50MiQkbW9kdWxlJHN0ciRjM3J1bnRpbWUgPSBbXTsKCmZ1bmN0aW9uIGNvbGxpbmVhcihhLCBiLCBkLCBjKSB7CiAgICBpZiAoYykgewogICAgICAgIHZhciBlID0gdG1wUG9pbnQxJCRtb2R1bGUkc3RyJGMzcnVudGltZSwKICAgICAgICAgICAgZyA9IHRtcFBvaW50MiQkbW9kdWxlJHN0ciRjM3J1bnRpbWU7CiAgICAgICAgZVswXSA9IGJbMF0gLSBhWzBdOwogICAgICAgIGVbMV0gPSBiWzFdIC0gYVsxXTsKICAgICAgICBnWzBdID0gZFswXSAtIGJbMF07CiAgICAgICAgZ1sxXSA9IGRbMV0gLSBiWzFdOwogICAgICAgIHJldHVybiBNYXRoLmFjb3MoKGVbMF0gKiBnWzBdICsgZVsxXSAqIGdbMV0pIC8gKE1hdGguc3FydChlWzBdICogZVswXSArIGVbMV0gKiBlWzFdKSAqIE1hdGguc3FydChnWzBdICogZ1swXSArIGdbMV0gKiBnWzFdKSkpIDwgYwogICAgfQogICAgcmV0dXJuIDAgPT09IHRyaWFuZ2xlQXJlYShhLCBiLCBkKQp9CgpmdW5jdGlvbiBzcWRpc3QoYSwgYikgewogICAgdmFyIGQgPSBiWzBdIC0gYVswXTsKICAgIGEgPSBiWzFdIC0gYVsxXTsKICAgIHJldHVybiBkICogZCArIGEgKiBhCn0KCmZ1bmN0aW9uIHBvbHlnb25BdChhLCBiKSB7CiAgICB2YXIgZCA9IGEubGVuZ3RoOwogICAgcmV0dXJuIGFbMCA+IGIgPyBiICUgZCArIGQgOiBiICUgZF0KfQoKZnVuY3Rpb24gcG9seWdvbkNsZWFyKGEpIHsKICAgIGEubGVuZ3RoID0gMAp9CgpmdW5jdGlvbiBwb2x5Z29uQXBwZW5kKGEsIGIsIGQsIGMpIHsKICAgIGZvciAoOyBkIDwgYzsgZCsrKSBhLnB1c2goYltkXSkKfQoKZnVuY3Rpb24gcG9seWdvblJldmVyc2UoYSkgewogICAgZm9yICh2YXIgYiA9IFtdLCBkID0gYS5sZW5ndGgsIGMgPSAwOyBjICE9PSBkOyBjKyspIGIucHVzaChhLnBvcCgpKTsKICAgIGZvciAoYyA9IDA7IGMgIT09IGQ7IGMrKykgYVtjXSA9IGJbY10KfQoKZnVuY3Rpb24gcG9seWdvbklzUmVmbGV4KGEsIGIpIHsKICAgIHJldHVybiBpc1JpZ2h0KHBvbHlnb25BdChhLCBiIC0gMSksIHBvbHlnb25BdChhLCBiKSwgcG9seWdvbkF0KGEsIGIgKyAxKSkKfQp2YXIgdG1wTGluZTEkJG1vZHVsZSRzdHIkYzNydW50aW1lID0gW10sCiAgICB0bXBMaW5lMiQkbW9kdWxlJHN0ciRjM3J1bnRpbWUgPSBbXTsKCmZ1bmN0aW9uIHBvbHlnb25DYW5TZWUoYSwgYiwgZCkgewogICAgdmFyIGMgPSB0bXBMaW5lMSQkbW9kdWxlJHN0ciRjM3J1bnRpbWUsCiAgICAgICAgZSA9IHRtcExpbmUyJCRtb2R1bGUkc3RyJGMzcnVudGltZTsKICAgIGlmIChpc0xlZnRPbihwb2x5Z29uQXQoYSwgYiArIDEpLCBwb2x5Z29uQXQoYSwgYiksIHBvbHlnb25BdChhLCBkKSkgJiYgaXNSaWdodE9uKHBvbHlnb25BdChhLCBiIC0gMSksIHBvbHlnb25BdChhLCBiKSwgcG9seWdvbkF0KGEsIGQpKSkgcmV0dXJuICExOwogICAgdmFyIGcgPSBzcWRpc3QocG9seWdvbkF0KGEsIGIpLCBwb2x5Z29uQXQoYSwgZCkpOwogICAgZm9yICh2YXIgayA9IDA7IGsgIT09IGEubGVuZ3RoOyArK2spCiAgICAgICAgaWYgKChrICsgMSkgJSBhLmxlbmd0aCAhPT0gYiAmJiBrICE9PSBiICYmIGlzTGVmdE9uKHBvbHlnb25BdChhLCBiKSwgcG9seWdvbkF0KGEsIGQpLCBwb2x5Z29uQXQoYSwgayArIDEpKSAmJiBpc1JpZ2h0T24ocG9seWdvbkF0KGEsIGIpLCBwb2x5Z29uQXQoYSwgZCksIHBvbHlnb25BdChhLCBrKSkpIHsKICAgICAgICAgICAgY1swXSA9IHBvbHlnb25BdChhLCBiKTsKICAgICAgICAgICAgY1sxXSA9IHBvbHlnb25BdChhLCBkKTsKICAgICAgICAgICAgZVswXSA9IHBvbHlnb25BdChhLAogICAgICAgICAgICAgICAgayk7CiAgICAgICAgICAgIGVbMV0gPSBwb2x5Z29uQXQoYSwgayArIDEpOwogICAgICAgICAgICB2YXIgbSA9IGxpbmVJbnQoYywgZSk7CiAgICAgICAgICAgIGlmIChzcWRpc3QocG9seWdvbkF0KGEsIGIpLCBtKSA8IGcpIHJldHVybiAhMQogICAgICAgIH0KICAgIHJldHVybiAhMAp9CgpmdW5jdGlvbiBwb2x5Z29uQ2FuU2VlMihhLCBiLCBkKSB7CiAgICBmb3IgKHZhciBjID0gMDsgYyAhPT0gYS5sZW5ndGg7ICsrYykKICAgICAgICBpZiAoYyAhPT0gYiAmJiBjICE9PSBkICYmIChjICsgMSkgJSBhLmxlbmd0aCAhPT0gYiAmJiAoYyArIDEpICUgYS5sZW5ndGggIT09IGQgJiYgbGluZVNlZ21lbnRzSW50ZXJzZWN0KHBvbHlnb25BdChhLCBiKSwgcG9seWdvbkF0KGEsIGQpLCBwb2x5Z29uQXQoYSwgYyksIHBvbHlnb25BdChhLCBjICsgMSkpKSByZXR1cm4gITE7CiAgICByZXR1cm4gITAKfQoKZnVuY3Rpb24gcG9seWdvbkNvcHkoYSwgYiwgZCwgYykgewogICAgYyA9IGMgfHwgW107CiAgICBwb2x5Z29uQ2xlYXIoYyk7CiAgICBpZiAoYiA8IGQpCiAgICAgICAgZm9yICh2YXIgZSA9IGI7IGUgPD0gZDsgZSsrKSBjLnB1c2goYVtlXSk7CiAgICBlbHNlIHsKICAgICAgICBmb3IgKGUgPSAwOyBlIDw9IGQ7IGUrKykgYy5wdXNoKGFbZV0pOwogICAgICAgIGZvciAoZSA9IGI7IGUgPCBhLmxlbmd0aDsgZSsrKSBjLnB1c2goYVtlXSkKICAgIH0KICAgIHJldHVybiBjCn0KCmZ1bmN0aW9uIHBvbHlnb25HZXRDdXRFZGdlcyhhKSB7CiAgICBmb3IgKHZhciBiID0gW10sIGQsIGMsIGUgPSBbXSwgZyA9IE51bWJlci5NQVhfVkFMVUUsIGsgPSAwOyBrIDwgYS5sZW5ndGg7ICsraykKICAgICAgICBpZiAocG9seWdvbklzUmVmbGV4KGEsIGspKQogICAgICAgICAgICBmb3IgKHZhciBtID0gMDsgbSA8IGEubGVuZ3RoOyArK20pCiAgICAgICAgICAgICAgICBpZiAocG9seWdvbkNhblNlZShhLCBrLCBtKSkgewogICAgICAgICAgICAgICAgICAgIGQgPSBwb2x5Z29uR2V0Q3V0RWRnZXMocG9seWdvbkNvcHkoYSwgaywgbSwgZSkpOwogICAgICAgICAgICAgICAgICAgIGMgPSBwb2x5Z29uR2V0Q3V0RWRnZXMocG9seWdvbkNvcHkoYSwgbSwgaywgZSkpOwogICAgICAgICAgICAgICAgICAgIGZvciAodmFyIG4gPSAwOyBuIDwgYy5sZW5ndGg7IG4rKykgZC5wdXNoKGNbbl0pOwogICAgICAgICAgICAgICAgICAgIGQubGVuZ3RoIDwgZyAmJiAoYiA9IGQsIGcgPSBkLmxlbmd0aCwgYi5wdXNoKFtwb2x5Z29uQXQoYSwgayksIHBvbHlnb25BdChhLCBtKV0pKQogICAgICAgICAgICAgICAgfQogICAgcmV0dXJuIGIKfQoKZnVuY3Rpb24gcG9seWdvblNsaWNlKGEsIGIpIHsKICAgIGlmICgwID09PSBiLmxlbmd0aCkgcmV0dXJuIFthXTsKICAgIGlmIChiIGluc3RhbmNlb2YgQXJyYXkgJiYgYi5sZW5ndGggJiYgYlswXSBpbnN0YW5jZW9mIEFycmF5ICYmIDIgPT09IGJbMF0ubGVuZ3RoICYmIGJbMF1bMF0gaW5zdGFuY2VvZiBBcnJheSkgewogICAgICAgIGEgPSBbYV07CiAgICAgICAgZm9yICh2YXIgZCA9IDA7IGQgPCBiLmxlbmd0aDsgZCsrKQogICAgICAgICAgICBmb3IgKHZhciBjID0gYltkXSwgZSA9IDA7IGUgPCBhLmxlbmd0aDsgZSsrKSB7CiAgICAgICAgICAgICAgICB2YXIgZyA9IHBvbHlnb25TbGljZShhW2VdLCBjKTsKICAgICAgICAgICAgICAgIGlmIChnKSB7CiAgICAgICAgICAgICAgICAgICAgYS5zcGxpY2UoZSwgMSk7CiAgICAgICAgICAgICAgICAgICAgYS5wdXNoKGdbMF0sIGdbMV0pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICByZXR1cm4gYQogICAgfQogICAgYyA9IGI7CiAgICBkID0gYS5pbmRleE9mKGNbMF0pOwogICAgZSA9IGEuaW5kZXhPZihjWzFdKTsKICAgIHJldHVybiAtMSAhPT0gZCAmJiAtMSAhPT0gZSA/IFtwb2x5Z29uQ29weShhLCBkLCBlKSwgcG9seWdvbkNvcHkoYSwgZSwgZCldIDogITEKfQoKZnVuY3Rpb24gZ2V0SW50ZXJzZWN0aW9uUG9pbnQoYSwgYiwgZCwgYywgZSkgewogICAgdmFyIGcgPSBiWzFdIC0gYVsxXTsKICAgIGIgPSBhWzBdIC0gYlswXTsKICAgIGEgPSBnICogYVswXSArIGIgKiBhWzFdOwogICAgdmFyIGsgPSBjWzFdIC0gZFsxXTsKICAgIGMgPSBkWzBdIC0gY1swXTsKICAgIGQgPSBrICogZFswXSArIGMgKiBkWzFdOwogICAgdmFyIG0gPSBnICogYyAtIGsgKiBiOwogICAgcmV0dXJuIHNjYWxhcl9lcShtLCAwLCBlIHx8IDApID8gWzAsIDBdIDogWyhjICogYSAtIGIgKiBkKSAvIG0sIChnICogZCAtIGsgKiBhKSAvIG1dCn0KCmZ1bmN0aW9uIHBvbHlnb25RdWlja0RlY29tcChhLCBiLCBkLCBjLCBlLCBnLCBrKSB7CiAgICBnID0gZyB8fCAxMDA7CiAgICBrID0gayB8fCAwOwogICAgZSA9IGUgfHwgMjU7CiAgICBiID0gInVuZGVmaW5lZCIgIT09IHR5cGVvZiBiID8gYiA6IFtdOwogICAgZCA9IGQgfHwgW107CiAgICBjID0gYyB8fCBbXTsKICAgIHZhciBtID0gWzAsIDBdLAogICAgICAgIG4gPSBbMCwgMF0sCiAgICAgICAgcSA9IFswLCAwXSwKICAgICAgICB1LCB3ID0gMCwKICAgICAgICB6ID0gMCwKICAgICAgICBDID0gMCwKICAgICAgICBEID0gW10sCiAgICAgICAgRiA9IFtdOwogICAgaWYgKDMgPiBhLmxlbmd0aCkgcmV0dXJuIGI7CiAgICBrKys7CiAgICBpZiAoayA+IGcpIHJldHVybiBjb25zb2xlLndhcm4oInF1aWNrRGVjb21wOiBtYXggbGV2ZWwgKCIgKyBnICsgIikgcmVhY2hlZC4iKSwgYjsKICAgIGZvciAodmFyIEUgPSAwOyBFIDwgYS5sZW5ndGg7ICsrRSkKICAgICAgICBpZiAocG9seWdvbklzUmVmbGV4KGEsIEUpKSB7CiAgICAgICAgICAgIGQucHVzaChhW0VdKTsKICAgICAgICAgICAgdmFyIEogPSB1ID0gTnVtYmVyLk1BWF9WQUxVRTsKICAgICAgICAgICAgZm9yICh2YXIgSyA9IDA7IEsgPCBhLmxlbmd0aDsgKytLKSB7CiAgICAgICAgICAgICAgICBpZiAoaXNMZWZ0KHBvbHlnb25BdChhLCBFIC0gMSksIHBvbHlnb25BdChhLCBFKSwgcG9seWdvbkF0KGEsIEspKSAmJiBpc1JpZ2h0T24ocG9seWdvbkF0KGEsIEUgLSAxKSwgcG9seWdvbkF0KGEsIEUpLCBwb2x5Z29uQXQoYSwgSyAtIDEpKSAmJgogICAgICAgICAgICAgICAgICAgIChxID0gZ2V0SW50ZXJzZWN0aW9uUG9pbnQocG9seWdvbkF0KGEsIEUgLSAxKSwgcG9seWdvbkF0KGEsIEUpLCBwb2x5Z29uQXQoYSwgSyksIHBvbHlnb25BdChhLCBLIC0gMSkpLCBpc1JpZ2h0KHBvbHlnb25BdChhLCBFICsgMSksIHBvbHlnb25BdChhLCBFKSwgcSkpKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIE8gPSBzcWRpc3QoYVtFXSwgcSk7CiAgICAgICAgICAgICAgICAgICAgTyA8IHUgJiYgKHUgPSBPLCBuID0gcSwgeiA9IEspCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpc0xlZnQocG9seWdvbkF0KGEsIEUgKyAxKSwgcG9seWdvbkF0KGEsIEUpLCBwb2x5Z29uQXQoYSwgSyArIDEpKSAmJiBpc1JpZ2h0T24ocG9seWdvbkF0KGEsIEUgKyAxKSwgcG9seWdvbkF0KGEsIEUpLCBwb2x5Z29uQXQoYSwgSykpICYmIChxID0gZ2V0SW50ZXJzZWN0aW9uUG9pbnQocG9seWdvbkF0KGEsIEUgKyAxKSwgcG9seWdvbkF0KGEsIEUpLCBwb2x5Z29uQXQoYSwgSyksIHBvbHlnb25BdChhLCBLICsgMSkpLCBpc0xlZnQocG9seWdvbkF0KGEsIEUgLSAxKSwgcG9seWdvbkF0KGEsIEUpLCBxKSAmJiAoTyA9IHNxZGlzdChhW0VdLCBxKSwgTyA8IEogJiYgKEogPSBPLCBtID0gcSwgdyA9IEspKSkKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoeiA9PT0gKHcgKyAxKSAlIGEubGVuZ3RoKSBxWzBdID0gKG5bMF0gKyBtWzBdKSAvCiAgICAgICAgICAgICAgICAyLCBxWzFdID0gKG5bMV0gKyBtWzFdKSAvIDIsIGMucHVzaChxKSwgRSA8IHcgPyAocG9seWdvbkFwcGVuZChELCBhLCBFLCB3ICsgMSksIEQucHVzaChxKSwgRi5wdXNoKHEpLCAwICE9PSB6ICYmIHBvbHlnb25BcHBlbmQoRiwgYSwgeiwgYS5sZW5ndGgpLCBwb2x5Z29uQXBwZW5kKEYsIGEsIDAsIEUgKyAxKSkgOiAoMCAhPT0gRSAmJiBwb2x5Z29uQXBwZW5kKEQsIGEsIEUsIGEubGVuZ3RoKSwgcG9seWdvbkFwcGVuZChELCBhLCAwLCB3ICsgMSksIEQucHVzaChxKSwgRi5wdXNoKHEpLCBwb2x5Z29uQXBwZW5kKEYsIGEsIHosIEUgKyAxKSk7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgeiA+IHcgJiYgKHcgKz0gYS5sZW5ndGgpOwogICAgICAgICAgICAgICAgbSA9IE51bWJlci5NQVhfVkFMVUU7CiAgICAgICAgICAgICAgICBpZiAodyA8IHopIHJldHVybiBiOwogICAgICAgICAgICAgICAgZm9yIChLID0gejsgSyA8PSB3OyArK0spIGlzTGVmdE9uKHBvbHlnb25BdChhLCBFIC0gMSksIHBvbHlnb25BdChhLCBFKSwgcG9seWdvbkF0KGEsIEspKSAmJiBpc1JpZ2h0T24ocG9seWdvbkF0KGEsIEUgKyAxKSwgcG9seWdvbkF0KGEsIEUpLCBwb2x5Z29uQXQoYSwgSykpICYmIChPID0gc3FkaXN0KHBvbHlnb25BdChhLCBFKSwgcG9seWdvbkF0KGEsIEspKSwgTyA8IG0gJiYgcG9seWdvbkNhblNlZTIoYSwKICAgICAgICAgICAgICAgICAgICBFLCBLKSAmJiAobSA9IE8sIEMgPSBLICUgYS5sZW5ndGgpKTsKICAgICAgICAgICAgICAgIEUgPCBDID8gKHBvbHlnb25BcHBlbmQoRCwgYSwgRSwgQyArIDEpLCAwICE9PSBDICYmIHBvbHlnb25BcHBlbmQoRiwgYSwgQywgYS5sZW5ndGgpLCBwb2x5Z29uQXBwZW5kKEYsIGEsIDAsIEUgKyAxKSkgOiAoMCAhPT0gRSAmJiBwb2x5Z29uQXBwZW5kKEQsIGEsIEUsIGEubGVuZ3RoKSwgcG9seWdvbkFwcGVuZChELCBhLCAwLCBDICsgMSksIHBvbHlnb25BcHBlbmQoRiwgYSwgQywgRSArIDEpKQogICAgICAgICAgICB9CiAgICAgICAgICAgIEQubGVuZ3RoIDwgRi5sZW5ndGggPyAocG9seWdvblF1aWNrRGVjb21wKEQsIGIsIGQsIGMsIGUsIGcsIGspLCBwb2x5Z29uUXVpY2tEZWNvbXAoRiwgYiwgZCwgYywgZSwgZywgaykpIDogKHBvbHlnb25RdWlja0RlY29tcChGLCBiLCBkLCBjLCBlLCBnLCBrKSwgcG9seWdvblF1aWNrRGVjb21wKEQsIGIsIGQsIGMsIGUsIGcsIGspKTsKICAgICAgICAgICAgcmV0dXJuIGIKICAgICAgICB9CiAgICBiLnB1c2goYSk7CiAgICByZXR1cm4gYgp9CgpmdW5jdGlvbiBzY2FsYXJfZXEoYSwgYiwgZCkgewogICAgcmV0dXJuIE1hdGguYWJzKGEgLSBiKSA8PSAoZCB8fCAwKQp9CgpmdW5jdGlvbiBwb2ludHNfZXEoYSwgYiwgZCkgewogICAgcmV0dXJuIHNjYWxhcl9lcShhWzBdLCBiWzBdLCBkKSAmJiBzY2FsYXJfZXEoYVsxXSwgYlsxXSwgZCkKfQpzZWxmLnBvbHlEZWNvbXAgPSB7CiAgICBkZWNvbXA6IGZ1bmN0aW9uKGEpIHsKICAgICAgICB2YXIgYiA9IHBvbHlnb25HZXRDdXRFZGdlcyhhKTsKICAgICAgICByZXR1cm4gMCA8IGIubGVuZ3RoID8gcG9seWdvblNsaWNlKGEsIGIpIDogW2FdCiAgICB9LAogICAgcXVpY2tEZWNvbXA6IHBvbHlnb25RdWlja0RlY29tcCwKICAgIGlzU2ltcGxlOiBmdW5jdGlvbihhKSB7CiAgICAgICAgdmFyIGI7CiAgICAgICAgZm9yIChiID0gMDsgYiA8IGEubGVuZ3RoIC0gMTsgYisrKQogICAgICAgICAgICBmb3IgKHZhciBkID0gMDsgZCA8IGIgLSAxOyBkKyspCiAgICAgICAgICAgICAgICBpZiAobGluZVNlZ21lbnRzSW50ZXJzZWN0KGFbYl0sIGFbYiArIDFdLCBhW2RdLCBhW2QgKyAxXSkpIHJldHVybiAhMTsKICAgICAgICBmb3IgKGIgPSAxOyBiIDwgYS5sZW5ndGggLSAyOyBiKyspCiAgICAgICAgICAgIGlmIChsaW5lU2VnbWVudHNJbnRlcnNlY3QoYVswXSwgYVthLmxlbmd0aCAtIDFdLCBhW2JdLCBhW2IgKyAxXSkpIHJldHVybiAhMTsKICAgICAgICByZXR1cm4gITAKICAgIH0sCiAgICByZW1vdmVDb2xsaW5lYXJQb2ludHM6IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICBmb3IgKHZhciBkID0gMCwgYyA9IGEubGVuZ3RoIC0gMTsgMyA8IGEubGVuZ3RoICYmIDAgPD0gYzsgLS1jKSBjb2xsaW5lYXIocG9seWdvbkF0KGEsIGMgLSAxKSwgcG9seWdvbkF0KGEsIGMpLCBwb2x5Z29uQXQoYSwKICAgICAgICAgICAgYyArIDEpLCBiKSAmJiAoYS5zcGxpY2UoYyAlIGEubGVuZ3RoLCAxKSwgZCsrKTsKICAgICAgICByZXR1cm4gZAogICAgfSwKICAgIHJlbW92ZUR1cGxpY2F0ZVBvaW50czogZnVuY3Rpb24oYSwgYikgewogICAgICAgIGZvciAodmFyIGQgPSBhLmxlbmd0aCAtIDE7IDEgPD0gZDsgLS1kKQogICAgICAgICAgICBmb3IgKHZhciBjID0gYVtkXSwgZSA9IGQgLSAxOyAwIDw9IGU7IC0tZSkgcG9pbnRzX2VxKGMsIGFbZV0sIGIpICYmIGEuc3BsaWNlKGQsIDEpCiAgICB9LAogICAgbWFrZUNDVzogZnVuY3Rpb24oYSkgewogICAgICAgIGZvciAodmFyIGIgPSAwLCBkID0gMTsgZCA8IGEubGVuZ3RoOyArK2QpCiAgICAgICAgICAgIGlmIChhW2RdWzFdIDwgYVtiXVsxXSB8fCBhW2RdWzFdID09PSBhW2JdWzFdICYmIGFbZF1bMF0gPiBhW2JdWzBdKSBiID0gZDsKICAgICAgICBpZiAoaXNMZWZ0KHBvbHlnb25BdChhLCBiIC0gMSksIHBvbHlnb25BdChhLCBiKSwgcG9seWdvbkF0KGEsIGIgKyAxKSkpIHJldHVybiAhMTsKICAgICAgICBwb2x5Z29uUmV2ZXJzZShhKTsKICAgICAgICByZXR1cm4gITAKICAgIH0KfTsKInVzZSBzdHJpY3QiOwpsZXQgaXNSZWFkeSA9ICExLAogICAgaGFzQXBwU3RhcnRlZCA9ICExLAogICAgYnVpbGRNb2RlID0gImRldiI7CmNvbnN0IEMzJGpzY29tcCQxID0gc2VsZi5DMyA9IGNsYXNzIHsKICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgIHRocm93IFR5cGVFcnJvcigic3RhdGljIGNsYXNzIGNhbid0IGJlIGluc3RhbnRpYXRlZCIpOwogICAgfQogICAgc3RhdGljIFNldFJlYWR5KCkgewogICAgICAgIGlzUmVhZHkgPSAhMAogICAgfQogICAgc3RhdGljIElzUmVhZHkoKSB7CiAgICAgICAgcmV0dXJuIGlzUmVhZHkKICAgIH0KICAgIHN0YXRpYyBTZXRBcHBTdGFydGVkKCkgewogICAgICAgIGhhc0FwcFN0YXJ0ZWQgPSAhMAogICAgfQogICAgc3RhdGljIEhhc0FwcFN0YXJ0ZWQoKSB7CiAgICAgICAgcmV0dXJuIGhhc0FwcFN0YXJ0ZWQKICAgIH0KICAgIHN0YXRpYyBTZXRCdWlsZE1vZGUoYSkgewogICAgICAgIGJ1aWxkTW9kZSA9IGEKICAgIH0KICAgIHN0YXRpYyBHZXRCdWlsZE1vZGUoKSB7CiAgICAgICAgcmV0dXJuIGJ1aWxkTW9kZQogICAgfQogICAgc3RhdGljIElzUmVsZWFzZUJ1aWxkKCkgewogICAgICAgIHJldHVybiAiZmluYWwiID09PSBidWlsZE1vZGUKICAgIH0KfTsKQzMkanNjb21wJDEuaXNEZWJ1ZyA9ICExOwpDMyRqc2NvbXAkMS5pc0RlYnVnRGVmZW5kID0gITE7CkMzJGpzY29tcCQxLmhhcmR3YXJlQ29uY3VycmVuY3kgPSBuYXZpZ2F0b3IuaGFyZHdhcmVDb25jdXJyZW5jeSB8fCAyOwpzZWxmLkMzWCA9IHt9OwoidXNlIHN0cmljdCI7CmNvbnN0IEMzJGpzY29tcCQzID0gc2VsZi5DMzsKQzMkanNjb21wJDMuUXVlcnlQYXJzZXIgPSBjbGFzcyB7CiAgICBjb25zdHJ1Y3RvcihhKSB7CiAgICAgICAgdGhpcy5fcXVlcnlTdHJpbmcgPSBhOwogICAgICAgIHRoaXMuX3BhcmFtZXRlcnMgPSBuZXcgTWFwOwogICAgICAgIHRoaXMuX1BhcnNlKCkKICAgIH0KICAgIF9QYXJzZSgpIHsKICAgICAgICB2YXIgYSA9IHRoaXMuX3F1ZXJ5U3RyaW5nOwogICAgICAgIGlmIChhLnN0YXJ0c1dpdGgoIj8iKSB8fCBhLnN0YXJ0c1dpdGgoIiMiKSkgYSA9IGEuc3Vic3RyKDEpOwogICAgICAgIGEgPSBhLnNwbGl0KCImIik7CiAgICAgICAgZm9yIChjb25zdCBiIG9mIGEpIHRoaXMuX1BhcnNlUGFyYW1ldGVyKGIpCiAgICB9CiAgICBfUGFyc2VQYXJhbWV0ZXIoYSkgewogICAgICAgIGlmIChhKQogICAgICAgICAgICBpZiAoYS5pbmNsdWRlcygiPSIpKSB7CiAgICAgICAgICAgICAgICB2YXIgYiA9IGEuaW5kZXhPZigiPSIpLAogICAgICAgICAgICAgICAgICAgIGQgPSBkZWNvZGVVUklDb21wb25lbnQoYS5zdWJzdHJpbmcoMCwgYikpOwogICAgICAgICAgICAgICAgYSA9IGRlY29kZVVSSUNvbXBvbmVudChhLnN1YnN0cmluZyhiICsgMSkpOwogICAgICAgICAgICAgICAgdGhpcy5fcGFyYW1ldGVycy5zZXQoZCwgYSkKICAgICAgICAgICAgfSBlbHNlIHRoaXMuX3BhcmFtZXRlcnMuc2V0KGEsIG51bGwpCiAgICB9CiAgICBMb2dBbGwoKSB7CiAgICAgICAgZm9yIChjb25zdCBhIG9mIHRoaXMuX3BhcmFtZXRlcnMpIGNvbnNvbGUubG9nKCJbUXVlcnlQYXJzZXJdIFBhcmFtZXRlciAnIiArIGFbMF0gKwogICAgICAgICAgICAiJyA9ICIgKyAobnVsbCA9PT0gYVsxXSA/ICJudWxsIiA6ICInIiArIGFbMV0gKyAiJyIpKQogICAgfQogICAgSGFzKGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcGFyYW1ldGVycy5oYXMoYSkKICAgIH0KICAgIEdldChhKSB7CiAgICAgICAgYSA9IHRoaXMuX3BhcmFtZXRlcnMuZ2V0KGEpOwogICAgICAgIHJldHVybiAidW5kZWZpbmVkIiA9PT0gdHlwZW9mIGEgPyBudWxsIDogYQogICAgfQogICAgQ2xlYXJIYXNoKCkgewogICAgICAgIGhpc3RvcnkucmVwbGFjZVN0YXRlKCIiLCBkb2N1bWVudC50aXRsZSwgbG9jYXRpb24ucGF0aG5hbWUgKyBsb2NhdGlvbi5zZWFyY2gpCiAgICB9CiAgICBSZXBhcnNlKGEpIHsKICAgICAgICB0aGlzLl9xdWVyeVN0cmluZyA9IGE7CiAgICAgICAgdGhpcy5fcGFyYW1ldGVycy5jbGVhcigpOwogICAgICAgIHRoaXMuX1BhcnNlKCkKICAgIH0KfTsKQzMkanNjb21wJDMuUXVlcnlTdHJpbmcgPSBuZXcgQzMkanNjb21wJDMuUXVlcnlQYXJzZXIobG9jYXRpb24uc2VhcmNoKTsKQzMkanNjb21wJDMuTG9jYXRpb25IYXNoU3RyaW5nID0gbmV3IEMzJGpzY29tcCQzLlF1ZXJ5UGFyc2VyKGxvY2F0aW9uLmhhc2gpOwpDMyRqc2NvbXAkMy5RdWVyeVN0cmluZy5IYXMoInBlcmYiKSAmJiAoQzMkanNjb21wJDMuaXNQZXJmb3JtYW5jZVByb2ZpbGluZyA9ICEwKTsKImRldiIgIT09IEMzJGpzY29tcCQzLlF1ZXJ5U3RyaW5nLkdldCgibW9kZSIpICYmIEMzJGpzY29tcCQzLlNldEJ1aWxkTW9kZSgiZmluYWwiKTsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkNCA9IHNlbGYuQzM7CkMzJGpzY29tcCQ0LlBsYXRmb3JtID0gewogICAgT1M6ICIodW5rbm93bikiLAogICAgT1NWZXJzaW9uOiAiKHVua25vd24pIiwKICAgIEJyb3dzZXI6ICIodW5rbm93bikiLAogICAgQnJvd3NlclZlcnNpb246ICIodW5rbm93bikiLAogICAgQnJvd3NlclZlcnNpb25OdW1iZXI6IE5hTiwKICAgIEJyb3dzZXJFbmdpbmU6ICIodW5rbm93bikiLAogICAgQ29udGV4dDogImJyb3dzZXIiLAogICAgSXNEZXNrdG9wOiAhMCwKICAgIElzTW9iaWxlOiAhMSwKICAgIElzQXBwbGVPUzogITEsCiAgICBJc0lwYWRPUzogITEsCiAgICBHZXREZXRhaWxlZEluZm86IGFzeW5jICgpID0+IHt9Cn07CmNvbnN0IHdpbmRvd3NOVFZlck1hcCA9IG5ldyBNYXAoWwogICAgWzUsICIyMDAwIl0sCiAgICBbNS4xLCAiWFAiXSwKICAgIFs1LjIsICJYUCJdLAogICAgWzYsICJWaXN0YSJdLAogICAgWzYuMSwgIjciXSwKICAgIFs2LjIsICI4Il0sCiAgICBbNi4zLCAiOC4xIl0sCiAgICBbMTAsICIxMCJdCl0pOwoKZnVuY3Rpb24gR2V0V2luZG93c05UVmVyc2lvbk5hbWUoYSkgewogICAgY29uc3QgYiA9IHBhcnNlRmxvYXQoYSksCiAgICAgICAgZCA9IHdpbmRvd3NOVFZlck1hcC5nZXQoYik7CiAgICByZXR1cm4gZCA/IGQgOiAxMyA8PSBiID8gIjExIiA6ICJOVCAiICsgYQp9CmNvbnN0IHVhU3RyID0gbmF2aWdhdG9yLnVzZXJBZ2VudCwKICAgIHVhRGF0YSA9IG5hdmlnYXRvci51c2VyQWdlbnREYXRhOwppZiAodWFEYXRhICYmIDAgPCB1YURhdGEuYnJhbmRzLmxlbmd0aCkgewogICAgQzMkanNjb21wJDQuUGxhdGZvcm0uT1MgPSB1YURhdGEucGxhdGZvcm07CiAgICBDMyRqc2NvbXAkNC5QbGF0Zm9ybS5Jc01vYmlsZSA9IHVhRGF0YS5tb2JpbGU7CiAgICBDMyRqc2NvbXAkNC5QbGF0Zm9ybS5Jc0Rlc2t0b3AgPSAhQzMkanNjb21wJDQuUGxhdGZvcm0uSXNNb2JpbGU7CiAgICBjb25zdCBhID0gbmV3IE1hcChbCiAgICAgICAgICAgIFsiR29vZ2xlIENocm9tZSIsICJDaHJvbWUiXSwKICAgICAgICAgICAgWyJNaWNyb3NvZnQgRWRnZSIsICJFZGdlIl0sCiAgICAgICAgICAgIFsiT3BlcmEiLCAiT3BlcmEiXSwKICAgICAgICAgICAgWyJPcGVyYSBHWCIsICJPcGVyYSBHWCJdLAogICAgICAgICAgICBbIk1vemlsbGEgRmlyZWZveCIsICJGaXJlZm94Il0sCiAgICAgICAgICAgIFsiQXBwbGUgU2FmYXJpIiwgIlNhZmFyaSJdLAogICAgICAgICAgICBbIk5XLmpzIiwgIk5XLmpzIl0KICAgICAgICBdKSwKICAgICAgICBiID0gbmV3IE1hcChbCiAgICAgICAgICAgIFsiQ2hyb21pdW0iLCAiQ2hyb21pdW0iXSwKICAgICAgICAgICAgWyJHZWNrbyIsICJHZWNrbyJdLAogICAgICAgICAgICBbIldlYktpdCIsICJXZWJLaXQiXQogICAgICAgIF0pOwoKICAgIGZ1bmN0aW9uIGQoZSkgewogICAgICAgIGxldCBnID0gIiIsCiAgICAgICAgICAgIGsgPSAiIiwKICAgICAgICAgICAgbSA9ICIiLAogICAgICAgICAgICBuID0gIiI7CiAgICAgICAgZm9yIChjb25zdCBxIG9mIGUpIGUgPQogICAgICAgICAgICBhLmdldChxLmJyYW5kKSwgIWcgJiYgZSAmJiAoZyA9IGUsIGsgPSBxLnZlcnNpb24pLCBlID0gYi5nZXQocS5icmFuZCksICFtICYmIGUgJiYgKG0gPSBlLCBuID0gcS52ZXJzaW9uKTsKICAgICAgICBnIHx8ICJDaHJvbWl1bSIgIT09IG0gfHwgKEMzJGpzY29tcCQ0LlBsYXRmb3JtLkJyb3dzZXIgPSAiQ2hyb21pdW0iLCBDMyRqc2NvbXAkNC5QbGF0Zm9ybS5Ccm93c2VyVmVyc2lvbiA9IG4pOwogICAgICAgIEMzJGpzY29tcCQ0LlBsYXRmb3JtLkJyb3dzZXIgPSBnIHx8ICIodW5rbm93bikiOwogICAgICAgIEMzJGpzY29tcCQ0LlBsYXRmb3JtLkJyb3dzZXJWZXJzaW9uID0gayB8fCAiKHVua25vd24pIjsKICAgICAgICBDMyRqc2NvbXAkNC5QbGF0Zm9ybS5Ccm93c2VyRW5naW5lID0gbSB8fCAiKHVua25vd24pIgogICAgfQogICAgZCh1YURhdGEuYnJhbmRzKTsKICAgIGxldCBjID0gITE7CiAgICBDMyRqc2NvbXAkNC5QbGF0Zm9ybS5HZXREZXRhaWxlZEluZm8gPSBhc3luYyAoKSA9PiB7CiAgICAgICAgaWYgKCFjKSB0cnkgewogICAgICAgICAgICBjb25zdCBlID0gYXdhaXQgbmF2aWdhdG9yLnVzZXJBZ2VudERhdGEuZ2V0SGlnaEVudHJvcHlWYWx1ZXMoWyJwbGF0Zm9ybVZlcnNpb24iLCAiZnVsbFZlcnNpb25MaXN0Il0pOwogICAgICAgICAgICBkKGUuZnVsbFZlcnNpb25MaXN0KTsKICAgICAgICAgICAgQzMkanNjb21wJDQuUGxhdGZvcm0uT1NWZXJzaW9uID0gIldpbmRvd3MiID09PSBDMyRqc2NvbXAkNC5QbGF0Zm9ybS5PUyA/IEdldFdpbmRvd3NOVFZlcnNpb25OYW1lKGUucGxhdGZvcm1WZXJzaW9uKSA6IGUucGxhdGZvcm1WZXJzaW9uOwogICAgICAgICAgICBjID0gITAKICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIGNvbnNvbGUud2FybigiRmFpbGVkIHRvIGdldCBkZXRhaWxlZCB1c2VyIGFnZW50IGluZm9ybWF0aW9uOiAiLCBlKQogICAgICAgIH0KICAgIH0KfSBlbHNlIHsKICAgIGZ1bmN0aW9uIGEocSwgdSkgewogICAgICAgIHEgPSBBcnJheS5pc0FycmF5KHEpID8gcSA6IFtxXTsKICAgICAgICBmb3IgKGNvbnN0IHcgb2YgcSkKICAgICAgICAgICAgaWYgKHEgPSB3LmV4ZWModWFTdHIpKSB7CiAgICAgICAgICAgICAgICB1KHEpOwogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgfQogICAgfQogICAgYSgvd2luZG93c1xzK250XHMrKFtcZFwuXSspL2ksIHEgPT4gewogICAgICAgIEMzJGpzY29tcCQ0LlBsYXRmb3JtLk9TID0gIldpbmRvd3MiOwogICAgICAgIEMzJGpzY29tcCQ0LlBsYXRmb3JtLk9TVmVyc2lvbiA9IEdldFdpbmRvd3NOVFZlcnNpb25OYW1lKHFbMV0pCiAgICB9KTsKICAgIGEoL21hY1xzK29zXHMreFxzKyhbXGRcLl9dKykvaSwgcSA9PiB7CiAgICAgICAgQzMkanNjb21wJDQuUGxhdGZvcm0uT1MgPQogICAgICAgICAgICAibWFjT1MiOwogICAgICAgIEMzJGpzY29tcCQ0LlBsYXRmb3JtLk9TVmVyc2lvbiA9IHFbMV0ucmVwbGFjZSgvXy9nLCAiLiIpCiAgICB9KTsKICAgIGEoL0NyT1MvLCAoKSA9PiB7CiAgICAgICAgQzMkanNjb21wJDQuUGxhdGZvcm0uT1MgPSAiQ2hyb21lIE9TIgogICAgfSk7CiAgICBhKC9saW51eHxvcGVuYnNkfGZyZWVic2R8bmV0YnNkL2ksICgpID0+IHsKICAgICAgICBDMyRqc2NvbXAkNC5QbGF0Zm9ybS5PUyA9ICJMaW51eCIKICAgIH0pOwogICAgYSgvYW5kcm9pZC9pLCAoKSA9PiB7CiAgICAgICAgQzMkanNjb21wJDQuUGxhdGZvcm0uT1MgPSAiQW5kcm9pZCIKICAgIH0pOwogICAgYSgvYW5kcm9pZFxzKyhbXGRcLl0rKS9pLCBxID0+IHsKICAgICAgICBDMyRqc2NvbXAkNC5QbGF0Zm9ybS5PUyA9ICJBbmRyb2lkIjsKICAgICAgICBDMyRqc2NvbXAkNC5QbGF0Zm9ybS5PU1ZlcnNpb24gPSBxWzFdCiAgICB9KTsKICAgICIodW5rbm93bikiID09PSBDMyRqc2NvbXAkNC5QbGF0Zm9ybS5PUyAmJiAoYSgvKGlwaG9uZXxpcG9kfGlwYWQpL2ksIHEgPT4gewogICAgICAgIEMzJGpzY29tcCQ0LlBsYXRmb3JtLk9TID0gImlPUyIKICAgIH0pLCBhKFsvaXBob25lXHMrb3NccysoW1xkXC5fXSspL2ksIC9pcGFkW14pXSpvc1xzKyhbXGRcLl9dKykvaV0sCiAgICAgICAgcSA9PiB7CiAgICAgICAgICAgIEMzJGpzY29tcCQ0LlBsYXRmb3JtLk9TID0gImlPUyI7CiAgICAgICAgICAgIEMzJGpzY29tcCQ0LlBsYXRmb3JtLk9TVmVyc2lvbiA9IHFbMV0ucmVwbGFjZSgvXy9nLCAiLiIpCiAgICAgICAgfSkpOwogICAgY29uc3QgYiA9IC9jaHJvbWVcLy9pLnRlc3QodWFTdHIpLAogICAgICAgIGQgPSAvY2hyb21pdW1cLy9pLnRlc3QodWFTdHIpLAogICAgICAgIGMgPSAvZWRnXC8vaS50ZXN0KHVhU3RyKSwKICAgICAgICBlID0gL09QUlwvLy50ZXN0KHVhU3RyKSwKICAgICAgICBnID0gL253anMvaS50ZXN0KHVhU3RyKSwKICAgICAgICBrID0gL3NhZmFyaVwvL2kudGVzdCh1YVN0ciksCiAgICAgICAgbSA9IC93ZWJraXQvaS50ZXN0KHVhU3RyKTsKICAgIGMgfHwgZSB8fCBhKC9jaHJvbWVcLyhbXGRcLl0rKS9pLCBxID0+IHsKICAgICAgICBDMyRqc2NvbXAkNC5QbGF0Zm9ybS5Ccm93c2VyID0gIkNocm9tZSI7CiAgICAgICAgQzMkanNjb21wJDQuUGxhdGZvcm0uQnJvd3NlclZlcnNpb24gPSBxWzFdOwogICAgICAgIEMzJGpzY29tcCQ0LlBsYXRmb3JtLkJyb3dzZXJFbmdpbmUgPSAiQ2hyb21pdW0iCiAgICB9KTsKICAgIGEoL2VkZ1wvKFtcZFwuXSspL2ksIHEgPT4gewogICAgICAgIEMzJGpzY29tcCQ0LlBsYXRmb3JtLkJyb3dzZXIgPSAiRWRnZSI7CiAgICAgICAgQzMkanNjb21wJDQuUGxhdGZvcm0uQnJvd3NlclZlcnNpb24gPQogICAgICAgICAgICBxWzFdOwogICAgICAgIEMzJGpzY29tcCQ0LlBsYXRmb3JtLkJyb3dzZXJFbmdpbmUgPSAiQ2hyb21pdW0iCiAgICB9KTsKICAgIGEoL09QUlwvKFtcZFwuXSspLywgcSA9PiB7CiAgICAgICAgQzMkanNjb21wJDQuUGxhdGZvcm0uQnJvd3NlciA9ICJPcGVyYSI7CiAgICAgICAgQzMkanNjb21wJDQuUGxhdGZvcm0uQnJvd3NlclZlcnNpb24gPSBxWzFdOwogICAgICAgIEMzJGpzY29tcCQ0LlBsYXRmb3JtLkJyb3dzZXJFbmdpbmUgPSAiQ2hyb21pdW0iCiAgICB9KTsKICAgIGEoL2Nocm9taXVtXC8oW1xkXC5dKykvaSwgcSA9PiB7CiAgICAgICAgQzMkanNjb21wJDQuUGxhdGZvcm0uQnJvd3NlciA9ICJDaHJvbWl1bSI7CiAgICAgICAgQzMkanNjb21wJDQuUGxhdGZvcm0uQnJvd3NlclZlcnNpb24gPSBxWzFdOwogICAgICAgIEMzJGpzY29tcCQ0LlBsYXRmb3JtLkJyb3dzZXJFbmdpbmUgPSAiQ2hyb21pdW0iCiAgICB9KTsKICAgIGEoL253anNcL1swLTkuXSsvaSwgcSA9PiB7CiAgICAgICAgQzMkanNjb21wJDQuUGxhdGZvcm0uQnJvd3NlciA9ICJOVy5qcyI7CiAgICAgICAgQzMkanNjb21wJDQuUGxhdGZvcm0uQnJvd3NlclZlcnNpb24gPSBxWzFdOwogICAgICAgIEMzJGpzY29tcCQ0LlBsYXRmb3JtLkJyb3dzZXJFbmdpbmUgPSAiQ2hyb21pdW0iOwogICAgICAgIEMzJGpzY29tcCQ0LlBsYXRmb3JtLkNvbnRleHQgPSAibndqcyIKICAgIH0pOwogICAgYSgvZmlyZWZveFwvKFtcZFwuXSspL2ksIHEgPT4gewogICAgICAgIEMzJGpzY29tcCQ0LlBsYXRmb3JtLkJyb3dzZXIgPSAiRmlyZWZveCI7CiAgICAgICAgQzMkanNjb21wJDQuUGxhdGZvcm0uQnJvd3NlclZlcnNpb24gPSBxWzFdOwogICAgICAgIEMzJGpzY29tcCQ0LlBsYXRmb3JtLkJyb3dzZXJFbmdpbmUgPSAiR2Vja28iCiAgICB9KTsKICAgICFrIHx8IGIgfHwgZCB8fCBjIHx8IGUgfHwgZyB8fCAoQzMkanNjb21wJDQuUGxhdGZvcm0uQnJvd3NlciA9ICJTYWZhcmkiLCBDMyRqc2NvbXAkNC5QbGF0Zm9ybS5Ccm93c2VyRW5naW5lID0gIldlYktpdCIsIGEoL3ZlcnNpb25cLyhbXGRcLl0rKS9pLCBxID0+IHsKICAgICAgICBDMyRqc2NvbXAkNC5QbGF0Zm9ybS5Ccm93c2VyVmVyc2lvbiA9IHFbMV0KICAgIH0pLCBhKC9jcmlvc1wvKFtcZFwuXSspL2ksIHEgPT4gewogICAgICAgIEMzJGpzY29tcCQ0LlBsYXRmb3JtLkJyb3dzZXIgPSAiQ2hyb21lIGZvciBpT1MiOwogICAgICAgIEMzJGpzY29tcCQ0LlBsYXRmb3JtLkJyb3dzZXJWZXJzaW9uID0gcVsxXQogICAgfSksIGEoL2Z4aW9zXC8oW1xkXC5dKykvaSwKICAgICAgICBxID0+IHsKICAgICAgICAgICAgQzMkanNjb21wJDQuUGxhdGZvcm0uQnJvd3NlciA9ICJGaXJlZm94IGZvciBpT1MiOwogICAgICAgICAgICBDMyRqc2NvbXAkNC5QbGF0Zm9ybS5Ccm93c2VyVmVyc2lvbiA9IHFbMV0KICAgICAgICB9KSwgYSgvZWRnaW9zXC8oW1xkXC5dKykvaSwgcSA9PiB7CiAgICAgICAgQzMkanNjb21wJDQuUGxhdGZvcm0uQnJvd3NlciA9ICJFZGdlIGZvciBpT1MiOwogICAgICAgIEMzJGpzY29tcCQ0LlBsYXRmb3JtLkJyb3dzZXJWZXJzaW9uID0gcVsxXQogICAgfSkpOwogICAgIih1bmtub3duKSIgPT09IEMzJGpzY29tcCQ0LlBsYXRmb3JtLkJyb3dzZXJFbmdpbmUgJiYgbSAmJiAoQzMkanNjb21wJDQuUGxhdGZvcm0uQnJvd3NlckVuZ2luZSA9ICJXZWJLaXQiKTsKICAgICJBbmRyb2lkIiA9PT0gQzMkanNjb21wJDQuUGxhdGZvcm0uT1MgJiYgIlNhZmFyaSIgPT09IEMzJGpzY29tcCQ0LlBsYXRmb3JtLkJyb3dzZXIgJiYgKEMzJGpzY29tcCQ0LlBsYXRmb3JtLkJyb3dzZXIgPSAiU3RvY2siKTsKICAgIGNvbnN0IG4gPSAobmV3IFNldChbIldpbmRvd3MiLCAibWFjT1MiLCAiTGludXgiLCAiQ2hyb21lIE9TIl0pKS5oYXMoQzMkanNjb21wJDQuUGxhdGZvcm0uT1MpIHx8CiAgICAgICAgIm53anMiID09PSBDMyRqc2NvbXAkNC5QbGF0Zm9ybS5Db250ZXh0OwogICAgQzMkanNjb21wJDQuUGxhdGZvcm0uSXNEZXNrdG9wID0gbjsKICAgIEMzJGpzY29tcCQ0LlBsYXRmb3JtLklzTW9iaWxlID0gIW4KfQoiQ2hyb21lIiA9PT0gQzMkanNjb21wJDQuUGxhdGZvcm0uQnJvd3NlciAmJiAiYnJvd3NlciIgPT09IEMzJGpzY29tcCQ0LlBsYXRmb3JtLkNvbnRleHQgJiYgL3d2XCkvLnRlc3QodWFTdHIpICYmIChDMyRqc2NvbXAkNC5QbGF0Zm9ybS5Db250ZXh0ID0gIndlYnZpZXciKTsKIm53anMiICE9PSBDMyRqc2NvbXAkNC5QbGF0Zm9ybS5Db250ZXh0ICYmICJ1bmRlZmluZWQiICE9PSB0eXBlb2Ygd2luZG93ICYmICh3aW5kb3cubWF0Y2hNZWRpYSAmJiB3aW5kb3cubWF0Y2hNZWRpYSgiKGRpc3BsYXktbW9kZTogc3RhbmRhbG9uZSkiKS5tYXRjaGVzIHx8IG5hdmlnYXRvci5zdGFuZGFsb25lKSAmJiAoQzMkanNjb21wJDQuUGxhdGZvcm0uQ29udGV4dCA9ICJ3ZWJhcHAiKTsKQzMkanNjb21wJDQuUGxhdGZvcm0uQnJvd3NlclZlcnNpb25OdW1iZXIgPSBwYXJzZUZsb2F0KEMzJGpzY29tcCQ0LlBsYXRmb3JtLkJyb3dzZXJWZXJzaW9uKTsKIm1hY09TIiA9PT0gQzMkanNjb21wJDQuUGxhdGZvcm0uT1MgJiYgbmF2aWdhdG9yLm1heFRvdWNoUG9pbnRzICYmIDIgPCBuYXZpZ2F0b3IubWF4VG91Y2hQb2ludHMgJiYgKEMzJGpzY29tcCQ0LlBsYXRmb3JtLk9TID0gImlPUyIsIEMzJGpzY29tcCQ0LlBsYXRmb3JtLk9TVmVyc2lvbiA9IEMzJGpzY29tcCQ0LlBsYXRmb3JtLkJyb3dzZXJWZXJzaW9uLCBDMyRqc2NvbXAkNC5QbGF0Zm9ybS5Jc0Rlc2t0b3AgPSAhMSwgQzMkanNjb21wJDQuUGxhdGZvcm0uSXNNb2JpbGUgPSAhMCwgQzMkanNjb21wJDQuUGxhdGZvcm0uSXNJcGFkT1MgPSAhMCk7CkMzJGpzY29tcCQ0LlBsYXRmb3JtLklzQXBwbGVPUyA9ICJtYWNPUyIgPT09IEMzJGpzY29tcCQ0LlBsYXRmb3JtLk9TIHx8ICJpT1MiID09PSBDMyRqc2NvbXAkNC5QbGF0Zm9ybS5PUzsKInVzZSBzdHJpY3QiOwpjb25zdCBEQVRBQkFTRV9QUk9NSVNFX01BUCA9IG5ldyBNYXAsCiAgICBTVVBQT1JUU19HRVRBTEwgPSAidW5kZWZpbmVkIiAhPT0gdHlwZW9mIElEQk9iamVjdFN0b3JlICYmICJmdW5jdGlvbiIgPT09IHR5cGVvZiBJREJPYmplY3RTdG9yZS5wcm90b3R5cGUuZ2V0QWxsLAogICAgU1VQUE9SVFNfR0VUQUxMS0VZUyA9ICJ1bmRlZmluZWQiICE9PSB0eXBlb2YgSURCT2JqZWN0U3RvcmUgJiYgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIElEQk9iamVjdFN0b3JlLnByb3RvdHlwZS5nZXRBbGxLZXlzOwoKZnVuY3Rpb24gYXN5bmNpZnlSZXF1ZXN0KGEpIHsKICAgIHJldHVybiBuZXcgUHJvbWlzZSgoYiwgZCkgPT4gewogICAgICAgIGEub25zdWNjZXNzID0gKCkgPT4gYihhLnJlc3VsdCk7CiAgICAgICAgYS5vbmVycm9yID0gKCkgPT4gZChhLmVycm9yKQogICAgfSkKfQoKZnVuY3Rpb24gYXN5bmNpZnlUcmFuc2FjdGlvbihhKSB7CiAgICByZXR1cm4gbmV3IFByb21pc2UoKGIsIGQpID0+IHsKICAgICAgICBhLm9uY29tcGxldGUgPSAoKSA9PiBiKCk7CiAgICAgICAgYS5vbmVycm9yID0gKCkgPT4gZChhLmVycm9yKTsKICAgICAgICBhLm9uYWJvcnQgPSAoKSA9PiBkKGEuZXJyb3IpCiAgICB9KQp9CgpmdW5jdGlvbiBvcGVuUmVhZE9ubHlUcmFuc2FjdGlvbihhLCBiKSB7CiAgICByZXR1cm4gb3BlblRyYW5zYWN0aW9uKGEsIGIpCn0KCmZ1bmN0aW9uIG9wZW5Xcml0ZVRyYW5zYWN0aW9uKGEsIGIpIHsKICAgIHJldHVybiBvcGVuVHJhbnNhY3Rpb24oYSwgYiwgITApCn0KYXN5bmMgZnVuY3Rpb24gb3BlblRyYW5zYWN0aW9uKGEsIGIsIGQgPSAhMSwgYyA9ICEwKSB7CiAgICBjb25zdCBlID0gYXdhaXQgbGF6eU9wZW5EYXRhYmFzZShhKTsKICAgIHRyeSB7CiAgICAgICAgY29uc3QgZyA9IGUudHJhbnNhY3Rpb24oWyJrZXl2YWx1ZXBhaXJzIl0sIGQgPyAicmVhZHdyaXRlIiA6ICJyZWFkb25seSIpOwogICAgICAgIHJldHVybiBiKGcpCiAgICB9IGNhdGNoIChnKSB7CiAgICAgICAgaWYgKGMgJiYgIkludmFsaWRTdGF0ZUVycm9yIiA9PT0gZy5uYW1lKSByZXR1cm4gREFUQUJBU0VfUFJPTUlTRV9NQVAuZGVsZXRlKGEpLCBvcGVuVHJhbnNhY3Rpb24oYSwgYiwgZCwgITEpOwogICAgICAgIHRocm93IGc7CiAgICB9Cn0KCmZ1bmN0aW9uIGxhenlPcGVuRGF0YWJhc2UoYSkgewogICAgUmVxdWlyZVN0cmluZyhhKTsKICAgIGxldCBiID0gREFUQUJBU0VfUFJPTUlTRV9NQVAuZ2V0KGEpOwogICAgYiBpbnN0YW5jZW9mIFByb21pc2UgfHwgKGIgPSBvcGVuRGF0YWJhc2UkanNjb21wJDEoYSksIERBVEFCQVNFX1BST01JU0VfTUFQLnNldChhLCBiKSwgYi5jYXRjaChkID0+IERBVEFCQVNFX1BST01JU0VfTUFQLmRlbGV0ZShhKSkpOwogICAgcmV0dXJuIGIKfQphc3luYyBmdW5jdGlvbiBvcGVuRGF0YWJhc2UkanNjb21wJDEoYSkgewogICAgUmVxdWlyZVN0cmluZyhhKTsKICAgIGNvbnN0IGIgPSBpbmRleGVkREIub3BlbihhLCAyKTsKICAgIGIuYWRkRXZlbnRMaXN0ZW5lcigidXBncmFkZW5lZWRlZCIsIGQgPT4gewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGQudGFyZ2V0LnJlc3VsdC5jcmVhdGVPYmplY3RTdG9yZSgia2V5dmFsdWVwYWlycyIpCiAgICAgICAgfSBjYXRjaCAoYykgewogICAgICAgICAgICBjb25zb2xlLmVycm9yKGBGYWlsZWQgdG8gY3JlYXRlIG9iamVjdHN0b3JlIGZvciBkYXRhYmFzZSAke2F9YCwgYykKICAgICAgICB9CiAgICB9KTsKICAgIHJldHVybiBhc3luY2lmeVJlcXVlc3QoYikKfQoKZnVuY3Rpb24gUmVxdWlyZVN0cmluZyhhKSB7CiAgICBpZiAoInN0cmluZyIgIT09IHR5cGVvZiBhKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJleHBlY3RlZCBzdHJpbmciKTsKfQoKZnVuY3Rpb24gZ2V0RW50cmllc0Zyb21DdXJzb3IoYSwgYikgewogICAgY29uc3QgZCA9IGEub2JqZWN0U3RvcmUoImtleXZhbHVlcGFpcnMiKS5vcGVuQ3Vyc29yKCk7CiAgICByZXR1cm4gbmV3IFByb21pc2UoYyA9PiB7CiAgICAgICAgY29uc3QgZSA9IFtdOwogICAgICAgIGQub25zdWNjZXNzID0gZyA9PiB7CiAgICAgICAgICAgIGlmIChnID0gZy50YXJnZXQucmVzdWx0KSB7CiAgICAgICAgICAgICAgICBzd2l0Y2ggKGIpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlICJlbnRyaWVzIjoKICAgICAgICAgICAgICAgICAgICAgICAgZS5wdXNoKFtnLmtleSwgZy52YWx1ZV0pOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICJrZXlzIjoKICAgICAgICAgICAgICAgICAgICAgICAgZS5wdXNoKGcua2V5KTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAidmFsdWVzIjoKICAgICAgICAgICAgICAgICAgICAgICAgZS5wdXNoKGcudmFsdWUpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBnLmNvbnRpbnVlKCkKICAgICAgICAgICAgfSBlbHNlIGMoZSkKICAgICAgICB9CiAgICB9KQp9CmNsYXNzIEtWU3RvcmFnZUNvbnRhaW5lciB7CiAgICBjb25zdHJ1Y3RvcihhKSB7CiAgICAgICAgUmVxdWlyZVN0cmluZyhhKTsKICAgICAgICB0aGlzLm5hbWUgPSBhCiAgICB9CiAgICBhc3luYyByZWFkeSgpIHsKICAgICAgICBhd2FpdCBsYXp5T3BlbkRhdGFiYXNlKHRoaXMubmFtZSkKICAgIH0KICAgIHNldChhLCBiKSB7CiAgICAgICAgUmVxdWlyZVN0cmluZyhhKTsKICAgICAgICByZXR1cm4gb3BlbldyaXRlVHJhbnNhY3Rpb24odGhpcy5uYW1lLCBhc3luYyBkID0+IHsKICAgICAgICAgICAgdmFyIGMgPSBkLm9iamVjdFN0b3JlKCJrZXl2YWx1ZXBhaXJzIikucHV0KGIsIGEpOwogICAgICAgICAgICBjID0gYXN5bmNpZnlSZXF1ZXN0KGMpOwogICAgICAgICAgICBkID0gYXN5bmNpZnlUcmFuc2FjdGlvbihkKTsKICAgICAgICAgICAgYXdhaXQgUHJvbWlzZS5hbGwoW2QsIGNdKQogICAgICAgIH0pCiAgICB9CiAgICBnZXQoYSkgewogICAgICAgIFJlcXVpcmVTdHJpbmcoYSk7CiAgICAgICAgcmV0dXJuIG9wZW5SZWFkT25seVRyYW5zYWN0aW9uKHRoaXMubmFtZSwgYXN5bmMgYiA9PiB7CiAgICAgICAgICAgIHZhciBkID0gYi5vYmplY3RTdG9yZSgia2V5dmFsdWVwYWlycyIpLmdldChhKTsKICAgICAgICAgICAgZCA9IGFzeW5jaWZ5UmVxdWVzdChkKTsKICAgICAgICAgICAgYiA9IGFzeW5jaWZ5VHJhbnNhY3Rpb24oYik7CiAgICAgICAgICAgIFssIGJdID0gYXdhaXQgUHJvbWlzZS5hbGwoW2IsCiAgICAgICAgICAgICAgICBkCiAgICAgICAgICAgIF0pOwogICAgICAgICAgICByZXR1cm4gYgogICAgICAgIH0pCiAgICB9CiAgICBkZWxldGUoYSkgewogICAgICAgIFJlcXVpcmVTdHJpbmcoYSk7CiAgICAgICAgcmV0dXJuIG9wZW5Xcml0ZVRyYW5zYWN0aW9uKHRoaXMubmFtZSwgYXN5bmMgYiA9PiB7CiAgICAgICAgICAgIHZhciBkID0gYi5vYmplY3RTdG9yZSgia2V5dmFsdWVwYWlycyIpLmRlbGV0ZShhKTsKICAgICAgICAgICAgZCA9IGFzeW5jaWZ5UmVxdWVzdChkKTsKICAgICAgICAgICAgYiA9IGFzeW5jaWZ5VHJhbnNhY3Rpb24oYik7CiAgICAgICAgICAgIGF3YWl0IFByb21pc2UuYWxsKFtiLCBkXSkKICAgICAgICB9KQogICAgfQogICAgY2xlYXIoKSB7CiAgICAgICAgcmV0dXJuIG9wZW5Xcml0ZVRyYW5zYWN0aW9uKHRoaXMubmFtZSwgYXN5bmMgYSA9PiB7CiAgICAgICAgICAgIHZhciBiID0gYS5vYmplY3RTdG9yZSgia2V5dmFsdWVwYWlycyIpLmNsZWFyKCk7CiAgICAgICAgICAgIGIgPSBhc3luY2lmeVJlcXVlc3QoYik7CiAgICAgICAgICAgIGEgPSBhc3luY2lmeVRyYW5zYWN0aW9uKGEpOwogICAgICAgICAgICBhd2FpdCBQcm9taXNlLmFsbChbYSwgYl0pCiAgICAgICAgfSkKICAgIH0KICAgIGtleXMoKSB7CiAgICAgICAgcmV0dXJuIG9wZW5SZWFkT25seVRyYW5zYWN0aW9uKHRoaXMubmFtZSwgYXN5bmMgYSA9PiB7CiAgICAgICAgICAgIGlmIChTVVBQT1JUU19HRVRBTExLRVlTKSB7CiAgICAgICAgICAgICAgICB2YXIgYiA9IGEub2JqZWN0U3RvcmUoImtleXZhbHVlcGFpcnMiKS5nZXRBbGxLZXlzKCk7CiAgICAgICAgICAgICAgICBiID0gYXN5bmNpZnlSZXF1ZXN0KGIpCiAgICAgICAgICAgIH0gZWxzZSBiID0gZ2V0RW50cmllc0Zyb21DdXJzb3IoYSwgImtleXMiKTsKICAgICAgICAgICAgYSA9IGFzeW5jaWZ5VHJhbnNhY3Rpb24oYSk7CiAgICAgICAgICAgIFssIGFdID0gYXdhaXQgUHJvbWlzZS5hbGwoW2EsIGJdKTsKICAgICAgICAgICAgcmV0dXJuIGEKICAgICAgICB9KQogICAgfQogICAgdmFsdWVzKCkgewogICAgICAgIHJldHVybiBvcGVuUmVhZE9ubHlUcmFuc2FjdGlvbih0aGlzLm5hbWUsIGFzeW5jIGEgPT4gewogICAgICAgICAgICBpZiAoU1VQUE9SVFNfR0VUQUxMKSB7CiAgICAgICAgICAgICAgICB2YXIgYiA9IGEub2JqZWN0U3RvcmUoImtleXZhbHVlcGFpcnMiKS5nZXRBbGwoKTsKICAgICAgICAgICAgICAgIGIgPSBhc3luY2lmeVJlcXVlc3QoYikKICAgICAgICAgICAgfSBlbHNlIGIgPSBnZXRFbnRyaWVzRnJvbUN1cnNvcihhLCAidmFsdWVzIik7CiAgICAgICAgICAgIGEgPSBhc3luY2lmeVRyYW5zYWN0aW9uKGEpOwogICAgICAgICAgICBbLCBhXSA9IGF3YWl0IFByb21pc2UuYWxsKFthLCBiXSk7CiAgICAgICAgICAgIHJldHVybiBhCiAgICAgICAgfSkKICAgIH0KICAgIGVudHJpZXMoKSB7CiAgICAgICAgcmV0dXJuIG9wZW5SZWFkT25seVRyYW5zYWN0aW9uKHRoaXMubmFtZSwgYXN5bmMgYSA9PiB7CiAgICAgICAgICAgIHZhciBiID0gZ2V0RW50cmllc0Zyb21DdXJzb3IoYSwgImVudHJpZXMiKTsKICAgICAgICAgICAgYSA9IGFzeW5jaWZ5VHJhbnNhY3Rpb24oYSk7CiAgICAgICAgICAgIFssIGJdID0gYXdhaXQgUHJvbWlzZS5hbGwoW2EsIGJdKTsKICAgICAgICAgICAgcmV0dXJuIGIKICAgICAgICB9KQogICAgfQp9CnNlbGYuS1ZTdG9yYWdlQ29udGFpbmVyID0gS1ZTdG9yYWdlQ29udGFpbmVyOwoidXNlIHN0cmljdCI7CmNvbnN0IEtWU3RvcmFnZUNvbnRhaW5lciRqc2NvbXAkMSA9IHNlbGYuS1ZTdG9yYWdlQ29udGFpbmVyLAogICAgQ1JJVElDQUxfRVJST1JTID0gWy9ubyBhdmFpbGFibGUgc3RvcmFnZSBtZXRob2QgZm91bmQvaSwgL2FuIGF0dGVtcHQgd2FzIG1hZGUgdG8gYnJlYWsgdGhyb3VnaCB0aGUgc2VjdXJpdHkgcG9saWN5IG9mIHRoZSB1c2VyIGFnZW50L2ksIC90aGUgdXNlciBkZW5pZWQgcGVybWlzc2lvbiB0byBhY2Nlc3MgdGhlIGRhdGFiYXNlL2ksIC9hIG11dGF0aW9uIG9wZXJhdGlvbiB3YXMgYXR0ZW1wdGVkIG9uIGEgZGF0YWJhc2UgdGhhdCBkaWQgbm90IGFsbG93IG11dGF0aW9ucy9pLCAvaWRiZmFjdG9yeVwub3BlblwoXCkgY2FsbGVkIGluIGFuIGludmFsaWQgc2VjdXJpdHkgY29udGV4dC9pXSwKICAgIG1lbW9yeVN0b3JhZ2UgPSBuZXcgV2Vha01hcDsKbGV0IGlzSW5NZW1vcnkgPSAhMTsKInVuZGVmaW5lZCIgPT09IHR5cGVvZiBpbmRleGVkREIgJiYgKGlzSW5NZW1vcnkgPSAhMCwgY29uc29sZS53YXJuKCJVbmFibGUgdG8gdXNlIGxvY2FsIHN0b3JhZ2UgYmVjYXVzZSBpbmRleGVkREIgaXMgbm90IGRlZmluZWQiKSk7CgpmdW5jdGlvbiBOT1RfSU1QTEVNRU5URUQoYSkgewogICAgdGhyb3cgRXJyb3IoYCIke2F9IiBpcyBub3QgaW1wbGVtZW50ZWRgKTsKfQoKZnVuY3Rpb24gRElTQUxMT1dfQ0FMTEJBQ0soYSkgewogICAgaWYgKCJmdW5jdGlvbiIgPT09IHR5cGVvZiBhKSB0aHJvdyBFcnJvcigibG9jYWxmb3JhZ2UgY2FsbGJhY2sgQVBJIGlzIG5vdCBpbXBsZW1lbnRlZDsgcGxlYXNlIHVzZSB0aGUgcHJvbWlzZSBBUEkgaW5zdGVhZCIpOwp9CgpmdW5jdGlvbiBTdHJ1Y3R1cmVkQ2xvbmUoYSkgewogICAgcmV0dXJuICJvYmplY3QiID09PSB0eXBlb2YgYSA/IG5ldyBQcm9taXNlKGIgPT4gewogICAgICAgIGNvbnN0IHsKICAgICAgICAgICAgcG9ydDE6IGQsCiAgICAgICAgICAgIHBvcnQyOiBjCiAgICAgICAgfSA9IG5ldyBNZXNzYWdlQ2hhbm5lbDsKICAgICAgICBjLm9ubWVzc2FnZSA9IGUgPT4gYihlLmRhdGEpOwogICAgICAgIGQucG9zdE1lc3NhZ2UoYSkKICAgIH0pIDogUHJvbWlzZS5yZXNvbHZlKGEpCn0KY2xhc3MgRm9yYWdlQWRhcHRvciB7CiAgICBjb25zdHJ1Y3RvcihhKSB7CiAgICAgICAgdGhpcy5faW5zdCA9IGE7CiAgICAgICAgbWVtb3J5U3RvcmFnZS5zZXQodGhpcywgbmV3IE1hcCkKICAgIH0KICAgIF9NYXliZVN3aXRjaFRvTWVtb3J5RmFsbGJhY2soYSkgewogICAgICAgIGlmICghaXNJbk1lbW9yeSkKICAgICAgICAgICAgZm9yIChjb25zdCBiIG9mIENSSVRJQ0FMX0VSUk9SUykKICAgICAgICAgICAgICAgIGlmIChhICYmIGIudGVzdChhLm1lc3NhZ2UpKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcigiVW5hYmxlIHRvIHVzZSBsb2NhbCBzdG9yYWdlLCByZXZlcnRpbmcgdG8gaW4tbWVtb3J5IHN0b3JlOiAiLCBhLCBhLm1lc3NhZ2UpOwogICAgICAgICAgICAgICAgICAgIGlzSW5NZW1vcnkgPSAhMDsKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgfQogICAgfQogICAgYXN5bmMgX2dldEl0ZW1GYWxsYmFjayhhKSB7CiAgICAgICAgYSA9IG1lbW9yeVN0b3JhZ2UuZ2V0KHRoaXMpLmdldChhKTsKICAgICAgICBhID0gYXdhaXQgU3RydWN0dXJlZENsb25lKGEpOwogICAgICAgIHJldHVybiAidW5kZWZpbmVkIiA9PT0gdHlwZW9mIGEgPyBudWxsIDogYQogICAgfQogICAgYXN5bmMgX3NldEl0ZW1GYWxsYmFjayhhLCBiKSB7CiAgICAgICAgYiA9IGF3YWl0IFN0cnVjdHVyZWRDbG9uZShiKTsKICAgICAgICBtZW1vcnlTdG9yYWdlLmdldCh0aGlzKS5zZXQoYSwgYikKICAgIH0KICAgIF9yZW1vdmVJdGVtRmFsbGJhY2soYSkgewogICAgICAgIG1lbW9yeVN0b3JhZ2UuZ2V0KHRoaXMpLmRlbGV0ZShhKQogICAgfQogICAgX2NsZWFyRmFsbGJhY2soKSB7CiAgICAgICAgbWVtb3J5U3RvcmFnZS5nZXQodGhpcykuY2xlYXIoKQogICAgfQogICAgX2tleXNGYWxsYmFjaygpIHsKICAgICAgICByZXR1cm4gQXJyYXkuZnJvbShtZW1vcnlTdG9yYWdlLmdldCh0aGlzKS5rZXlzKCkpCiAgICB9CiAgICBJc1VzaW5nRmFsbGJhY2soKSB7CiAgICAgICAgcmV0dXJuIGlzSW5NZW1vcnkKICAgIH0KICAgIGFzeW5jIGdldEl0ZW0oYSwKICAgICAgICBiKSB7CiAgICAgICAgRElTQUxMT1dfQ0FMTEJBQ0soYik7CiAgICAgICAgaWYgKGlzSW5NZW1vcnkpIHJldHVybiBhd2FpdCB0aGlzLl9nZXRJdGVtRmFsbGJhY2soYSk7CiAgICAgICAgbGV0IGQ7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZCA9IGF3YWl0IHRoaXMuX2luc3QuZ2V0KGEpCiAgICAgICAgfSBjYXRjaCAoYykgewogICAgICAgICAgICB0aGlzLl9NYXliZVN3aXRjaFRvTWVtb3J5RmFsbGJhY2soYyk7CiAgICAgICAgICAgIGlmIChpc0luTWVtb3J5KSByZXR1cm4gYXdhaXQgdGhpcy5fZ2V0SXRlbUZhbGxiYWNrKGEpOwogICAgICAgICAgICBjb25zb2xlLmVycm9yKGBFcnJvciByZWFkaW5nICcke2F9JyBmcm9tIHN0b3JhZ2UsIHJldHVybmluZyBudWxsOiBgLCBjKTsKICAgICAgICAgICAgcmV0dXJuIG51bGwKICAgICAgICB9CiAgICAgICAgcmV0dXJuICJ1bmRlZmluZWQiID09PSB0eXBlb2YgZCA/IG51bGwgOiBkCiAgICB9CiAgICBhc3luYyBzZXRJdGVtKGEsIGIsIGQpIHsKICAgICAgICBESVNBTExPV19DQUxMQkFDSyhkKTsKICAgICAgICAidW5kZWZpbmVkIiA9PT0gdHlwZW9mIGIgJiYgKGIgPSBudWxsKTsKICAgICAgICBpZiAoaXNJbk1lbW9yeSkgYXdhaXQgdGhpcy5fc2V0SXRlbUZhbGxiYWNrKGEsIGIpOwogICAgICAgIGVsc2UgdHJ5IHsKICAgICAgICAgICAgYXdhaXQgdGhpcy5faW5zdC5zZXQoYSwgYikKICAgICAgICB9IGNhdGNoIChjKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9NYXliZVN3aXRjaFRvTWVtb3J5RmFsbGJhY2soYyksCiAgICAgICAgICAgICAgICBpc0luTWVtb3J5KSBhd2FpdCB0aGlzLl9zZXRJdGVtRmFsbGJhY2soYSwgYik7CiAgICAgICAgICAgIGVsc2UgdGhyb3cgYzsKICAgICAgICB9CiAgICB9CiAgICBhc3luYyByZW1vdmVJdGVtKGEsIGIpIHsKICAgICAgICBESVNBTExPV19DQUxMQkFDSyhiKTsKICAgICAgICBpZiAoaXNJbk1lbW9yeSkgdGhpcy5fcmVtb3ZlSXRlbUZhbGxiYWNrKGEpOwogICAgICAgIGVsc2UgdHJ5IHsKICAgICAgICAgICAgYXdhaXQgdGhpcy5faW5zdC5kZWxldGUoYSkKICAgICAgICB9IGNhdGNoIChkKSB7CiAgICAgICAgICAgIHRoaXMuX01heWJlU3dpdGNoVG9NZW1vcnlGYWxsYmFjayhkKSwgaXNJbk1lbW9yeSA/IHRoaXMuX3JlbW92ZUl0ZW1GYWxsYmFjayhhKSA6IGNvbnNvbGUuZXJyb3IoYEVycm9yIHJlbW92aW5nICcke2F9JyBmcm9tIHN0b3JhZ2U6IGAsIGQpCiAgICAgICAgfQogICAgfQogICAgYXN5bmMgY2xlYXIoYSkgewogICAgICAgIERJU0FMTE9XX0NBTExCQUNLKGEpOwogICAgICAgIGlmIChpc0luTWVtb3J5KSB0aGlzLl9jbGVhckZhbGxiYWNrKCk7CiAgICAgICAgZWxzZSB0cnkgewogICAgICAgICAgICBhd2FpdCB0aGlzLl9pbnN0LmNsZWFyKCkKICAgICAgICB9IGNhdGNoIChiKSB7CiAgICAgICAgICAgIHRoaXMuX01heWJlU3dpdGNoVG9NZW1vcnlGYWxsYmFjayhiKSwgaXNJbk1lbW9yeSA/IHRoaXMuX2NsZWFyRmFsbGJhY2soKSA6CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBjbGVhcmluZyBzdG9yYWdlOiAiLCBiKQogICAgICAgIH0KICAgIH0KICAgIGFzeW5jIGtleXMoYSkgewogICAgICAgIERJU0FMTE9XX0NBTExCQUNLKGEpOwogICAgICAgIGlmIChpc0luTWVtb3J5KSByZXR1cm4gdGhpcy5fa2V5c0ZhbGxiYWNrKCk7CiAgICAgICAgYSA9IFtdOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGEgPSBhd2FpdCB0aGlzLl9pbnN0LmtleXMoKQogICAgICAgIH0gY2F0Y2ggKGIpIHsKICAgICAgICAgICAgdGhpcy5fTWF5YmVTd2l0Y2hUb01lbW9yeUZhbGxiYWNrKGIpOwogICAgICAgICAgICBpZiAoaXNJbk1lbW9yeSkgcmV0dXJuIHRoaXMuX2tleXNGYWxsYmFjaygpOwogICAgICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBnZXR0aW5nIHN0b3JhZ2Uga2V5czogIiwgYikKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGEKICAgIH0KICAgIHJlYWR5KGEpIHsKICAgICAgICBESVNBTExPV19DQUxMQkFDSyhhKTsKICAgICAgICByZXR1cm4gaXNJbk1lbW9yeSA/IFByb21pc2UucmVzb2x2ZSghMCkgOiB0aGlzLl9pbnN0LnJlYWR5KCkKICAgIH0KICAgIGNyZWF0ZUluc3RhbmNlKGEpIHsKICAgICAgICBpZiAoIm9iamVjdCIgIT09IHR5cGVvZiBhKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJpbnZhbGlkIG9wdGlvbnMgb2JqZWN0Iik7CiAgICAgICAgYSA9IGEubmFtZTsKICAgICAgICBpZiAoInN0cmluZyIgIT09IHR5cGVvZiBhKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJpbnZhbGlkIHN0b3JlIG5hbWUiKTsKICAgICAgICBhID0gbmV3IEtWU3RvcmFnZUNvbnRhaW5lciRqc2NvbXAkMShhKTsKICAgICAgICByZXR1cm4gbmV3IEZvcmFnZUFkYXB0b3IoYSkKICAgIH0KICAgIGxlbmd0aChhKSB7CiAgICAgICAgTk9UX0lNUExFTUVOVEVEKCJsb2NhbGZvcmFnZS5sZW5ndGgoKSIpCiAgICB9CiAgICBrZXkoYSwgYikgewogICAgICAgIE5PVF9JTVBMRU1FTlRFRCgibG9jYWxmb3JhZ2Uua2V5KCkiKQogICAgfQogICAgaXRlcmF0ZShhLCBiKSB7CiAgICAgICAgTk9UX0lNUExFTUVOVEVEKCJsb2NhbGZvcmFnZS5pdGVyYXRlKCkiKQogICAgfQogICAgc2V0RHJpdmVyKGEpIHsKICAgICAgICBOT1RfSU1QTEVNRU5URUQoImxvY2FsZm9yYWdlLnNldERyaXZlcigpIikKICAgIH0KICAgIGNvbmZpZyhhKSB7CiAgICAgICAgTk9UX0lNUExFTUVOVEVEKCJsb2NhbGZvcmFnZS5jb25maWcoKSIpCiAgICB9CiAgICBkZWZpbmVEcml2ZXIoYSkgewogICAgICAgIE5PVF9JTVBMRU1FTlRFRCgibG9jYWxmb3JhZ2UuZGVmaW5lRHJpdmVyKCkiKQogICAgfQogICAgZHJpdmVyKCkgewogICAgICAgIE5PVF9JTVBMRU1FTlRFRCgibG9jYWxmb3JhZ2UuZHJpdmVyKCkiKQogICAgfQogICAgc3VwcG9ydHMoYSkgewogICAgICAgIE5PVF9JTVBMRU1FTlRFRCgibG9jYWxmb3JhZ2Uuc3VwcG9ydHMoKSIpCiAgICB9CiAgICBkcm9wSW5zdGFuY2UoKSB7CiAgICAgICAgTk9UX0lNUExFTUVOVEVEKCJsb2NhbGZvcmFnZS5kcm9wSW5zdGFuY2UoKSIpCiAgICB9CiAgICBkaXNhYmxlTWVtb3J5TW9kZSgpIHsKICAgICAgICBpc0luTWVtb3J5ID0gITEKICAgIH0KfQpzZWxmLmxvY2FsZm9yYWdlID0gbmV3IEZvcmFnZUFkYXB0b3IobmV3IEtWU3RvcmFnZUNvbnRhaW5lciRqc2NvbXAkMSgibG9jYWxmb3JhZ2UiKSk7CiJ1c2Ugc3RyaWN0IjsKY29uc3QgQzMkanNjb21wJDUgPSBzZWxmLkMzOwpDMyRqc2NvbXAkNS5TdXBwb3J0cyA9IHt9OwpDMyRqc2NvbXAkNS5TdXBwb3J0cy5XZWJBbmltYXRpb25zID0gKCgpID0+IHsKICAgIHRyeSB7CiAgICAgICAgaWYgKCJTYWZhcmkiID09PSBDMyRqc2NvbXAkNS5QbGF0Zm9ybS5Ccm93c2VyIHx8ICJ1bmRlZmluZWQiID09PSB0eXBlb2YgZG9jdW1lbnQpIHJldHVybiAhMTsKICAgICAgICBjb25zdCBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgICAgcmV0dXJuICJ1bmRlZmluZWQiID09PSB0eXBlb2YgYS5hbmltYXRlID8gITEgOiAidW5kZWZpbmVkIiAhPT0gdHlwZW9mIGEuYW5pbWF0ZShbewogICAgICAgICAgICBvcGFjaXR5OiAiMCIKICAgICAgICB9LCB7CiAgICAgICAgICAgIG9wYWNpdHk6ICIxIgogICAgICAgIH1dLCAxRTMpLnJldmVyc2UKICAgIH0gY2F0Y2ggKGEpIHsKICAgICAgICByZXR1cm4gITEKICAgIH0KfSkoKTsKQzMkanNjb21wJDUuU3VwcG9ydHMuRGlhbG9nRWxlbWVudCA9ICJ1bmRlZmluZWQiICE9PSB0eXBlb2YgSFRNTERpYWxvZ0VsZW1lbnQ7CkMzJGpzY29tcCQ1LlN1cHBvcnRzLlJlcXVlc3RJZGxlQ2FsbGJhY2sgPSAhIXNlbGYucmVxdWVzdElkbGVDYWxsYmFjazsKQzMkanNjb21wJDUuU3VwcG9ydHMuSW1hZ2VCaXRtYXAgPSAhIXNlbGYuY3JlYXRlSW1hZ2VCaXRtYXA7CkMzJGpzY29tcCQ1LlN1cHBvcnRzLkltYWdlQml0bWFwT3B0aW9ucyA9ICExOwpDMyRqc2NvbXAkNS5TdXBwb3J0cy5JbWFnZUJpdG1hcE9wdGlvbnNSZXNpemUgPSAhMTsKaWYgKEMzJGpzY29tcCQ1LlN1cHBvcnRzLkltYWdlQml0bWFwKSB7CiAgICB0cnkgewogICAgICAgIHNlbGYuY3JlYXRlSW1hZ2VCaXRtYXAobmV3IEltYWdlRGF0YSgzMiwgMzIpLCB7CiAgICAgICAgICAgIHByZW11bHRpcGx5QWxwaGE6ICJub25lIgogICAgICAgIH0pLnRoZW4oKCkgPT4gewogICAgICAgICAgICBDMyRqc2NvbXAkNS5TdXBwb3J0cy5JbWFnZUJpdG1hcE9wdGlvbnMgPSAhMAogICAgICAgIH0pLmNhdGNoKCgpID0+IHsKICAgICAgICAgICAgQzMkanNjb21wJDUuU3VwcG9ydHMuSW1hZ2VCaXRtYXBPcHRpb25zID0gITEKICAgICAgICB9KQogICAgfSBjYXRjaCAoYSkgewogICAgICAgIEMzJGpzY29tcCQ1LlN1cHBvcnRzLkltYWdlQml0bWFwT3B0aW9ucyA9ICExCiAgICB9CiAgICB0cnkgewogICAgICAgIHNlbGYuY3JlYXRlSW1hZ2VCaXRtYXAobmV3IEltYWdlRGF0YSgzMiwgMzIpLCB7CiAgICAgICAgICAgIHJlc2l6ZVdpZHRoOiAxMCwKICAgICAgICAgICAgcmVzaXplSGVpZ2h0OiAxMAogICAgICAgIH0pLnRoZW4oYSA9PiB7CiAgICAgICAgICAgIEMzJGpzY29tcCQ1LlN1cHBvcnRzLkltYWdlQml0bWFwT3B0aW9uc1Jlc2l6ZSA9IDEwID09PSBhLndpZHRoICYmIDEwID09PSBhLmhlaWdodAogICAgICAgIH0pLmNhdGNoKCgpID0+IHsKICAgICAgICAgICAgQzMkanNjb21wJDUuU3VwcG9ydHMuSW1hZ2VCaXRtYXBPcHRpb25zUmVzaXplID0gITEKICAgICAgICB9KQogICAgfSBjYXRjaCAoYSkgewogICAgICAgIEMzJGpzY29tcCQ1LlN1cHBvcnRzLkltYWdlQml0bWFwT3B0aW9uc1Jlc2l6ZSA9ICExCiAgICB9Cn0KQzMkanNjb21wJDUuU3VwcG9ydHMuQ2xpcGJvYXJkUmVhZFRleHQgPSAhKCFuYXZpZ2F0b3IuY2xpcGJvYXJkIHx8ICFuYXZpZ2F0b3IuY2xpcGJvYXJkLnJlYWRUZXh0IHx8ICJGaXJlZm94IiA9PT0gQzMkanNjb21wJDUuUGxhdGZvcm0uQnJvd3Nlcik7CkMzJGpzY29tcCQ1LlN1cHBvcnRzLlBlcm1pc3Npb25zUXVlcnkgPSAhKCFuYXZpZ2F0b3IucGVybWlzc2lvbnMgfHwgIW5hdmlnYXRvci5wZXJtaXNzaW9ucy5xdWVyeSk7CkMzJGpzY29tcCQ1LlN1cHBvcnRzLlByb3hpZXMgPSAidW5kZWZpbmVkIiAhPT0gdHlwZW9mIFByb3h5OwpDMyRqc2NvbXAkNS5TdXBwb3J0cy5Eb3dubG9hZEF0dHJpYnV0ZSA9ICgoKSA9PiAidW5kZWZpbmVkIiA9PT0gdHlwZW9mIGRvY3VtZW50ID8gITEgOiAidW5kZWZpbmVkIiAhPT0gdHlwZW9mIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImEiKS5kb3dubG9hZCkoKTsKQzMkanNjb21wJDUuU3VwcG9ydHMuRmV0Y2ggPSAiZnVuY3Rpb24iID09PSB0eXBlb2YgZmV0Y2g7CkMzJGpzY29tcCQ1LlN1cHBvcnRzLlBlcnNpc3RlbnRTdG9yYWdlID0gISEoc2VsZi5pc1NlY3VyZUNvbnRleHQgJiYgIk9wZXJhIiAhPT0gQzMkanNjb21wJDUuUGxhdGZvcm0uQnJvd3NlciAmJiBuYXZpZ2F0b3Iuc3RvcmFnZSAmJiBuYXZpZ2F0b3Iuc3RvcmFnZS5wZXJzaXN0KTsKQzMkanNjb21wJDUuU3VwcG9ydHMuU3RvcmFnZVF1b3RhRXN0aW1hdGUgPSAhIShzZWxmLmlzU2VjdXJlQ29udGV4dCAmJiBuYXZpZ2F0b3Iuc3RvcmFnZSAmJiBuYXZpZ2F0b3Iuc3RvcmFnZS5lc3RpbWF0ZSk7CkMzJGpzY29tcCQ1LlN1cHBvcnRzLkZ1bGxzY3JlZW4gPSAoKCkgPT4gewogICAgaWYgKCJ1bmRlZmluZWQiID09PSB0eXBlb2YgZG9jdW1lbnQgfHwgImlPUyIgPT09IEMzJGpzY29tcCQ1LlBsYXRmb3JtLk9TKSByZXR1cm4gITE7CiAgICBjb25zdCBhID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50OwogICAgcmV0dXJuICEhKGEucmVxdWVzdEZ1bGxzY3JlZW4gfHwgYS5tc1JlcXVlc3RGdWxsc2NyZWVuIHx8IGEubW96UmVxdWVzdEZ1bGxTY3JlZW4gfHwgYS53ZWJraXRSZXF1ZXN0RnVsbHNjcmVlbikKfSkoKTsKQzMkanNjb21wJDUuU3VwcG9ydHMuSW1hZ2VEZWNvZGVyID0gInVuZGVmaW5lZCIgIT09IHR5cGVvZiBzZWxmLkltYWdlRGVjb2RlcjsKQzMkanNjb21wJDUuU3VwcG9ydHMuV2ViQ29kZWNzID0gISFzZWxmLlZpZGVvRW5jb2RlcjsKQzMkanNjb21wJDUuU3VwcG9ydHMuTmF0aXZlRmlsZVN5c3RlbUFQSSA9ICEhc2VsZi5zaG93T3BlbkZpbGVQaWNrZXI7CkMzJGpzY29tcCQ1LlN1cHBvcnRzLlF1ZXJ5TG9jYWxGb250cyA9ICEhc2VsZi5xdWVyeUxvY2FsRm9udHM7CkMzJGpzY29tcCQ1LlN1cHBvcnRzLlVzZXJBY3RpdmF0aW9uID0gISFuYXZpZ2F0b3IudXNlckFjdGl2YXRpb247CkMzJGpzY29tcCQ1LlN1cHBvcnRzLkNhbnZhc1RvQmxvYldlYlAgPSAhMTsKKGFzeW5jICgpID0+IHsKICAgIGxldCBhOwogICAgInVuZGVmaW5lZCIgPT09IHR5cGVvZiBkb2N1bWVudCA/IGEgPSBuZXcgT2Zmc2NyZWVuQ2FudmFzKDMyLCAzMikgOiAoYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImNhbnZhcyIpLCBhLndpZHRoID0gMzIsIGEuaGVpZ2h0ID0gMzIpOwogICAgdmFyIGIgPSBhLmdldENvbnRleHQoIjJkIik7CiAgICBiLmZpbGxTdHlsZSA9ICJibHVlIjsKICAgIGIuZmlsbFJlY3QoMCwgMCwgMzIsIDMyKTsKICAgIGIgPSBudWxsOwogICAgdHJ5IHsKICAgICAgICBhLnRvQmxvYiA/IGIgPSBhd2FpdCBuZXcgUHJvbWlzZShkID0+IGEudG9CbG9iKGQsICJpbWFnZS93ZWJwIiwgMSkpIDogYS5jb252ZXJ0VG9CbG9iICYmIChiID0gYXdhaXQgYS5jb252ZXJ0VG9CbG9iKHsKICAgICAgICAgICAgdHlwZTogImltYWdlL3dlYnAiLAogICAgICAgICAgICBxdWFsaXR5OiAxCiAgICAgICAgfSkpLCBDMyRqc2NvbXAkNS5TdXBwb3J0cy5DYW52YXNUb0Jsb2JXZWJQID0gYiAmJiAiaW1hZ2Uvd2VicCIgPT09IGIudHlwZQogICAgfSBjYXRjaCAoZCkgewogICAgICAgIEMzJGpzY29tcCQ1LlN1cHBvcnRzLkNhbnZhc1RvQmxvYldlYlAgPSAhMQogICAgfQp9KSgpOwoidXNlIHN0cmljdCI7CmNvbnN0IEMzJGpzY29tcCQ2ID0gc2VsZi5DMzsKaWYgKCFTdHJpbmcucHJvdG90eXBlLnRyaW1TdGFydCkgewogICAgY29uc3QgYSA9IC9eW1x4MDlceDBBXHgwQlx4MENceDBEXHgyMFx4QTBcdTE2ODBcdTE4MEVcdTIwMDBcdTIwMDFcdTIwMDJcdTIwMDNcdTIwMDRcdTIwMDVcdTIwMDZcdTIwMDdcdTIwMDhcdTIwMDlcdTIwMEFcdTIwMkZcdTIwNUZcdTMwMDBcdTIwMjhcdTIwMjlcdUZFRkZdKi87CiAgICBTdHJpbmcucHJvdG90eXBlLnRyaW1TdGFydCA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiB0aGlzLnJlcGxhY2UoYSwgIiIpCiAgICB9Cn0KaWYgKCFTdHJpbmcucHJvdG90eXBlLnRyaW1FbmQpIHsKICAgIGNvbnN0IGEgPSAvW1x4MDlceDBBXHgwQlx4MENceDBEXHgyMFx4QTBcdTE2ODBcdTE4MEVcdTIwMDBcdTIwMDFcdTIwMDJcdTIwMDNcdTIwMDRcdTIwMDVcdTIwMDZcdTIwMDdcdTIwMDhcdTIwMDlcdTIwMEFcdTIwMkZcdTIwNUZcdTMwMDBcdTIwMjhcdTIwMjlcdUZFRkZdKiQvOwogICAgU3RyaW5nLnByb3RvdHlwZS50cmltRW5kID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMucmVwbGFjZShhLCAiIikKICAgIH0KfQpTdHJpbmcucHJvdG90eXBlLnJlcGxhY2VBbGwgfHwgKFN0cmluZy5wcm90b3R5cGUucmVwbGFjZUFsbCA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgIHJldHVybiB0aGlzLnJlcGxhY2UobmV3IFJlZ0V4cChDMyRqc2NvbXAkNi5Fc2NhcGVSZWdleChhKSwgImciKSwgYikKfSk7CkFycmF5LnByb3RvdHlwZS52YWx1ZXMgfHwgKEFycmF5LnByb3RvdHlwZS52YWx1ZXMgPSBmdW5jdGlvbiooKSB7CiAgICBmb3IgKGNvbnN0IGEgb2YgdGhpcykgeWllbGQgYQp9KTsKaWYgKCFBcnJheS5wcm90b3R5cGUuZmxhdCkgewogICAgZnVuY3Rpb24gYShiLCBkKSB7CiAgICAgICAgcmV0dXJuIGIucmVkdWNlKChjLCBlKSA9PiB7CiAgICAgICAgICAgIDAgPCBkICYmIEFycmF5LmlzQXJyYXkoZSkgPyBBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseShjLCBhKGUsIGQgLSAxKSkgOiBjLnB1c2goZSk7CiAgICAgICAgICAgIHJldHVybiBjCiAgICAgICAgfSwgW10pCiAgICB9CiAgICBBcnJheS5wcm90b3R5cGUuZmxhdCA9IGZ1bmN0aW9uKGIgPSAxKSB7CiAgICAgICAgcmV0dXJuIGEodGhpcywgYikKICAgIH0KfQpBcnJheS5wcm90b3R5cGUuYXQgfHwgKEFycmF5LnByb3RvdHlwZS5hdCA9IGZ1bmN0aW9uKGEpIHsKICAgIGEgPSBNYXRoLnRydW5jKGEpIHx8IDA7CiAgICAwID4gYSAmJiAoYSArPSB0aGlzLmxlbmd0aCk7CiAgICBpZiAoISgwID4gYSB8fCBhID49IHRoaXMubGVuZ3RoKSkgcmV0dXJuIHRoaXNbYV0KfSk7ClN0cmluZy5wcm90b3R5cGUuYXQgfHwgKFN0cmluZy5wcm90b3R5cGUuYXQgPSBmdW5jdGlvbihhKSB7CiAgICBhID0gTWF0aC50cnVuYyhhKSB8fCAwOwogICAgMCA+IGEgJiYgKGEgKz0gdGhpcy5sZW5ndGgpOwogICAgaWYgKCEoMCA+IGEgfHwgYSA+PSB0aGlzLmxlbmd0aCkpIHJldHVybiB0aGlzW2FdCn0pOwpSZWdFeHAuZXNjYXBlIHx8IChSZWdFeHAuZXNjYXBlID0gZnVuY3Rpb24oYSkgewogICAgcmV0dXJuIFN0cmluZyhhKS5yZXBsYWNlKC9bXFxeJCorPy4oKXxbXF17fV0vZywgIlxcJCYiKQp9KTsKbmF2aWdhdG9yLnN0b3JhZ2UgJiYgIW5hdmlnYXRvci5zdG9yYWdlLmVzdGltYXRlICYmIG5hdmlnYXRvci53ZWJraXRUZW1wb3JhcnlTdG9yYWdlICYmIG5hdmlnYXRvci53ZWJraXRUZW1wb3JhcnlTdG9yYWdlLnF1ZXJ5VXNhZ2VBbmRRdW90YSAmJiAobmF2aWdhdG9yLnN0b3JhZ2UuZXN0aW1hdGUgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiBuZXcgUHJvbWlzZSgoYSwgYikgPT4gbmF2aWdhdG9yLndlYmtpdFRlbXBvcmFyeVN0b3JhZ2UucXVlcnlVc2FnZUFuZFF1b3RhKChkLCBjKSA9PiBhKHsKICAgICAgICB1c2FnZTogZCwKICAgICAgICBxdW90YTogYwogICAgfSksIGIpKQp9KTsKInVuZGVmaW5lZCIgPT09IHR5cGVvZiBzZWxmLmlzU2VjdXJlQ29udGV4dCAmJiAoc2VsZi5pc1NlY3VyZUNvbnRleHQgPSAiaHR0cHM6IiA9PT0gbG9jYXRpb24ucHJvdG9jb2wpOwoidW5kZWZpbmVkIiA9PT0gdHlwZW9mIHNlbGYuZ2xvYmFsVGhpcyAmJiAoc2VsZi5nbG9iYWxUaGlzID0gc2VsZik7CiJ1c2Ugc3RyaWN0IjsKY29uc3QgQzMkanNjb21wJDcgPSBzZWxmLkMzOwoKZnVuY3Rpb24gYXNzZXJ0RmFpbChhKSB7CiAgICBsZXQgYiA9IEMzJGpzY29tcCQ3LkdldENhbGxTdGFjaygpOwogICAgY29uc29sZS5lcnJvcigiQXNzZXJ0aW9uIGZhaWx1cmU6ICIgKyBhICsgIlxuXG5TdGFjayB0cmFjZTpcbiIgKyBiKQp9CnNlbGYuYXNzZXJ0ID0gZnVuY3Rpb24oYSwgYikgewogICAgYSB8fCBhc3NlcnRGYWlsKGIpCn07CiJ1c2Ugc3RyaWN0IjsKY29uc3QgQzMkanNjb21wJDggPSBzZWxmLkMzLAogICAgQzNYID0gc2VsZi5DM1g7CkMzJGpzY29tcCQ4LklzTnVtYmVyID0gZnVuY3Rpb24oYSkgewogICAgcmV0dXJuICJudW1iZXIiID09PSB0eXBlb2YgYQp9OwpDMyRqc2NvbXAkOC5Jc0Zpbml0ZU51bWJlciA9IGZ1bmN0aW9uKGEpIHsKICAgIHJldHVybiBDMyRqc2NvbXAkOC5Jc051bWJlcihhKSAmJiBpc0Zpbml0ZShhKQp9OwpDMyRqc2NvbXAkOC5SZXF1aXJlTnVtYmVyID0gZnVuY3Rpb24oYSkgewogICAgaWYgKCFDMyRqc2NvbXAkOC5Jc051bWJlcihhKSkgdGhyb3cgbmV3IFR5cGVFcnJvcigiZXhwZWN0ZWQgbnVtYmVyIik7Cn07CkMzJGpzY29tcCQ4LlJlcXVpcmVPcHRpb25hbE51bWJlciA9IGZ1bmN0aW9uKGEpIHsKICAgIEMzJGpzY29tcCQ4LklzTnVsbE9yVW5kZWZpbmVkKGEpCn07CkMzJGpzY29tcCQ4LlJlcXVpcmVOdW1iZXJJblJhbmdlID0gZnVuY3Rpb24oYSwgYiwgZCkgewogICAgaWYgKCFDMyRqc2NvbXAkOC5Jc051bWJlcihhKSB8fCBpc05hTihhKSB8fCBiID4gYSB8fCBkIDwgYSkgdGhyb3cgbmV3IFJhbmdlRXJyb3IoIm51bWJlciBvdXRzaWRlIG9mIHJhbmdlIik7Cn07CkMzJGpzY29tcCQ4LlJlcXVpcmVBbGxOdW1iZXIgPSBmdW5jdGlvbiguLi5hKSB7CiAgICBmb3IgKGxldCBiIG9mIGEpOwp9OwpDMyRqc2NvbXAkOC5SZXF1aXJlRmluaXRlTnVtYmVyID0gZnVuY3Rpb24oYSkgewogICAgaWYgKCFDMyRqc2NvbXAkOC5Jc0Zpbml0ZU51bWJlcihhKSkgdGhyb3cgbmV3IFR5cGVFcnJvcigiZXhwZWN0ZWQgZmluaXRlIG51bWJlciIpOwp9OwpDMyRqc2NvbXAkOC5SZXF1aXJlT3B0aW9uYWxGaW5pdGVOdW1iZXIgPSBmdW5jdGlvbihhKSB7CiAgICBDMyRqc2NvbXAkOC5Jc051bGxPclVuZGVmaW5lZChhKQp9OwpDMyRqc2NvbXAkOC5SZXF1aXJlQWxsRmluaXRlTnVtYmVyID0gZnVuY3Rpb24oLi4uYSkgewogICAgZm9yIChsZXQgYiBvZiBhKTsKfTsKQzMkanNjb21wJDguSXNTdHJpbmcgPSBmdW5jdGlvbihhKSB7CiAgICByZXR1cm4gInN0cmluZyIgPT09IHR5cGVvZiBhCn07CkMzJGpzY29tcCQ4LlJlcXVpcmVTdHJpbmcgPSBmdW5jdGlvbihhKSB7CiAgICBpZiAoIUMzJGpzY29tcCQ4LklzU3RyaW5nKGEpKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJleHBlY3RlZCBzdHJpbmciKTsKfTsKQzMkanNjb21wJDguUmVxdWlyZU9wdGlvbmFsU3RyaW5nID0gZnVuY3Rpb24oYSkgewogICAgQzMkanNjb21wJDguSXNOdWxsT3JVbmRlZmluZWQoYSkKfTsKQzMkanNjb21wJDguUmVxdWlyZUFsbFN0cmluZyA9IGZ1bmN0aW9uKC4uLmEpIHsKICAgIGZvciAobGV0IGIgb2YgYSk7Cn07CkMzJGpzY29tcCQ4LklzU2ltcGxlT2JqZWN0ID0gZnVuY3Rpb24oYSkgewogICAgcmV0dXJuICJvYmplY3QiICE9PSB0eXBlb2YgYSB8fCBudWxsID09PSBhID8gITEgOiAoYSA9IE9iamVjdC5nZXRQcm90b3R5cGVPZihhKSkgPyBhLmNvbnN0cnVjdG9yID09PSBPYmplY3QgOiBudWxsID09PSBhCn07CkMzJGpzY29tcCQ4LlJlcXVpcmVTaW1wbGVPYmplY3QgPSBmdW5jdGlvbihhKSB7CiAgICBpZiAoIUMzJGpzY29tcCQ4LklzU2ltcGxlT2JqZWN0KGEpKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJleHBlY3RlZCBzaW1wbGUgb2JqZWN0Iik7Cn07CkMzJGpzY29tcCQ4LlJlcXVpcmVPcHRpb25hbFNpbXBsZU9iamVjdCA9IGZ1bmN0aW9uKGEpIHsKICAgIGlmICghQzMkanNjb21wJDguSXNOdWxsT3JVbmRlZmluZWQoYSkgJiYgIUMzJGpzY29tcCQ4LklzU2ltcGxlT2JqZWN0KGEpKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJleHBlY3RlZCBzaW1wbGUgb2JqZWN0Iik7Cn07CkMzJGpzY29tcCQ4LklzT2JqZWN0ID0gZnVuY3Rpb24oYSkgewogICAgcmV0dXJuICJvYmplY3QiID09PSB0eXBlb2YgYSAmJiBudWxsICE9PSBhICYmICFBcnJheS5pc0FycmF5KGEpCn07CkMzJGpzY29tcCQ4LlJlcXVpcmVPYmplY3QgPSBmdW5jdGlvbihhKSB7CiAgICBpZiAoIUMzJGpzY29tcCQ4LklzT2JqZWN0KGEpKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJleHBlY3RlZCBvYmplY3QiKTsKfTsKQzMkanNjb21wJDguUmVxdWlyZU9wdGlvbmFsT2JqZWN0ID0gZnVuY3Rpb24oYSkgewogICAgQzMkanNjb21wJDguSXNOdWxsT3JVbmRlZmluZWQoYSkKfTsKQzMkanNjb21wJDguUmVxdWlyZUFsbE9iamVjdCA9IGZ1bmN0aW9uKC4uLmEpIHsKICAgIGZvciAobGV0IGIgb2YgYSk7Cn07CkMzJGpzY29tcCQ4LklzRmlsZUxpa2UgPSBmdW5jdGlvbihhKSB7CiAgICByZXR1cm4gQzMkanNjb21wJDguSXNJbnN0YW5jZU9mKGEsIEJsb2IpICYmICJzdHJpbmciID09PSB0eXBlb2YgYS5uYW1lCn07CkMzJGpzY29tcCQ4LlJlcXVpcmVGaWxlTGlrZSA9IGZ1bmN0aW9uKGEpIHsKICAgIGlmICghQzMkanNjb21wJDguSXNGaWxlTGlrZShhKSkgdGhyb3cgbmV3IFR5cGVFcnJvcigiZXhwZWN0ZWQgZmlsZSIpOwp9OwpDMyRqc2NvbXAkOC5SZXF1aXJlT3B0aW9uYWxGaWxlTGlrZSA9IGZ1bmN0aW9uKGEpIHsKICAgIEMzJGpzY29tcCQ4LklzTnVsbE9yVW5kZWZpbmVkKGEpCn07CkMzJGpzY29tcCQ4LklzQXJyYXkgPSBmdW5jdGlvbihhKSB7CiAgICByZXR1cm4gQXJyYXkuaXNBcnJheShhKQp9OwpDMyRqc2NvbXAkOC5SZXF1aXJlQXJyYXkgPSBmdW5jdGlvbihhKSB7CiAgICBpZiAoIUMzJGpzY29tcCQ4LklzQXJyYXkoYSkpIHRocm93IG5ldyBUeXBlRXJyb3IoImV4cGVjdGVkIGFycmF5Iik7Cn07CkMzJGpzY29tcCQ4LlJlcXVpcmVPcHRpb25hbEFycmF5ID0gZnVuY3Rpb24oYSkgewogICAgQzMkanNjb21wJDguSXNOdWxsT3JVbmRlZmluZWQoYSkKfTsKQzMkanNjb21wJDguUmVxdWlyZUFsbEFycmF5ID0gZnVuY3Rpb24oLi4uYSkgewogICAgZm9yIChsZXQgYiBvZiBhKTsKfTsKQzMkanNjb21wJDguSXMyREFycmF5ID0gZnVuY3Rpb24oYSkgewogICAgcmV0dXJuIEMzJGpzY29tcCQ4LklzQXJyYXkoYSkgPyBhLmxlbmd0aCA/IEMzJGpzY29tcCQ4LklzQXJyYXkoYVswXSkgPyAhMCA6ICExIDogITAgOiAhMQp9OwpDMyRqc2NvbXAkOC5SZXF1aXJlMkRBcnJheSA9IGZ1bmN0aW9uKGEpIHsKICAgIGlmICghQzMkanNjb21wJDguSXMyREFycmF5KGEpKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJleHBlY3RlZCAyZCBhcnJheSIpOwogICAgZm9yIChsZXQgYiBvZiBhKQogICAgICAgIGlmICghQzMkanNjb21wJDguSXNBcnJheShiKSkgdGhyb3cgbmV3IFR5cGVFcnJvcigiZXhwZWN0ZWQgMmQgYXJyYXkiKTsKfTsKQzMkanNjb21wJDguUmVxdWlyZU9wdGlvbmFsMkRBcnJheSA9IGZ1bmN0aW9uKGEpIHsKICAgIEMzJGpzY29tcCQ4LklzTnVsbE9yVW5kZWZpbmVkKGEpCn07CkMzJGpzY29tcCQ4LklzRnVuY3Rpb24gPSBmdW5jdGlvbihhKSB7CiAgICByZXR1cm4gImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGEKfTsKQzMkanNjb21wJDguUmVxdWlyZUZ1bmN0aW9uID0gZnVuY3Rpb24oYSwgYikgewogICAgaWYgKCFDMyRqc2NvbXAkOC5Jc0Z1bmN0aW9uKGEpKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJleHBlY3RlZCBmdW5jdGlvbiIpOwogICAgaWYgKCFDMyRqc2NvbXAkOC5Jc051bGxPclVuZGVmaW5lZChiKSAmJiBhICE9PSBiKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJleHBlY3RlZCBzYW1lIGZ1bmN0aW9uIHJlZmVyZW5jZSIpOwp9OwpDMyRqc2NvbXAkOC5SZXF1aXJlT3B0aW9uYWxGdW5jdGlvbiA9IGZ1bmN0aW9uKGEpIHsKICAgIEMzJGpzY29tcCQ4LklzTnVsbE9yVW5kZWZpbmVkKGEpCn07CkMzJGpzY29tcCQ4LlJlcXVpcmVBbGxGdW5jdGlvbiA9IGZ1bmN0aW9uKC4uLmEpIHsKICAgIGZvciAobGV0IGIgb2YgYSk7Cn07CkMzJGpzY29tcCQ4LlJlcXVpcmVBbnlGdW5jdGlvbiA9IGZ1bmN0aW9uKGEsIC4uLmIpIHsKICAgIGlmICghQzMkanNjb21wJDguSXNGdW5jdGlvbihhKSkgdGhyb3cgbmV3IFR5cGVFcnJvcigiZXhwZWN0ZWQgZnVuY3Rpb24iKTsKICAgIGlmICghYi5sZW5ndGgpIHRocm93IEVycm9yKCJtaXNzaW5nIGNvbXBhcmlzb24gZnVuY3Rpb25zIik7CiAgICBmb3IgKGxldCBkIG9mIGIpCiAgICAgICAgaWYgKCFDMyRqc2NvbXAkOC5Jc051bGxPclVuZGVmaW5lZChkKSAmJiBhID09PSBkKSByZXR1cm47CiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJleHBlY3RlZCBzYW1lIGZ1bmN0aW9uIHJlZmVyZW5jZSIpOwp9OwpDMyRqc2NvbXAkOC5SZXF1aXJlT3B0aW9uYWxBbGxGdW5jdGlvbiA9IGZ1bmN0aW9uKC4uLmEpIHsKICAgIGlmICghQzMkanNjb21wJDguSXNOdWxsT3JVbmRlZmluZWQoYSkpCiAgICAgICAgZm9yIChsZXQgYiBvZiBhKTsKfTsKQzMkanNjb21wJDguSXNJbnN0YW5jZU9mID0gZnVuY3Rpb24oYSwgYikgewogICAgcmV0dXJuIGEgaW5zdGFuY2VvZiBiCn07CkMzJGpzY29tcCQ4LklzSW5zdGFuY2VPZkFueSA9IGZ1bmN0aW9uKGEsIC4uLmIpIHsKICAgIGZvciAobGV0IGQgb2YgYikKICAgICAgICBpZiAoQzMkanNjb21wJDguSXNJbnN0YW5jZU9mKGEsIGQpKSByZXR1cm4gITA7CiAgICByZXR1cm4gITEKfTsKQzMkanNjb21wJDguUmVxdWlyZUluc3RhbmNlT2YgPSBmdW5jdGlvbihhLCBiKSB7CiAgICBpZiAoIUMzJGpzY29tcCQ4LklzSW5zdGFuY2VPZihhLCBiKSkgdGhyb3cgbmV3IFR5cGVFcnJvcigidW5leHBlY3RlZCB0eXBlIik7Cn07CkMzJGpzY29tcCQ4LlJlcXVpcmVPcHRpb25hbEluc3RhbmNlT2YgPSBmdW5jdGlvbihhLCBiKSB7CiAgICBDMyRqc2NvbXAkOC5Jc051bGxPclVuZGVmaW5lZChhKQp9OwpDMyRqc2NvbXAkOC5SZXF1aXJlQWxsSW5zdGFuY2VPZiA9IGZ1bmN0aW9uKGEsIC4uLmIpIHsKICAgIGZvciAobGV0IGQgb2YgYik7Cn07CkMzJGpzY29tcCQ4LlJlcXVpcmVBbnlJbnN0YW5jZU9mID0gZnVuY3Rpb24oYSwgLi4uYikgewogICAgaWYgKCFDMyRqc2NvbXAkOC5Jc0luc3RhbmNlT2ZBbnkoYSwgLi4uYikpIHRocm93IG5ldyBUeXBlRXJyb3IoInVuZXhwZWN0ZWQgdHlwZSIpOwp9OwpDMyRqc2NvbXAkOC5SZXF1aXJlQW55T3B0aW9uYWxJbnN0YW5jZU9mID0gZnVuY3Rpb24oYSwgLi4uYikgewogICAgaWYgKCFDMyRqc2NvbXAkOC5Jc051bGxPclVuZGVmaW5lZChhKSAmJiAhQzMkanNjb21wJDguSXNJbnN0YW5jZU9mQW55KGEsIC4uLmIpKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJ1bmV4cGVjdGVkIHR5cGUiKTsKfTsKQzMkanNjb21wJDguSXNBcnJheU9mID0gZnVuY3Rpb24oYSwgYikgewogICAgZm9yIChsZXQgZCBvZiBhKQogICAgICAgIGlmICghQzMkanNjb21wJDguSXNJbnN0YW5jZU9mKGQsIGIpKSByZXR1cm4gITE7CiAgICByZXR1cm4gITAKfTsKQzMkanNjb21wJDguSXNBcnJheU9mRmluaXRlTnVtYmVycyA9IGZ1bmN0aW9uKGEpIHsKICAgIGZvciAobGV0IGIgb2YgYSkKICAgICAgICBpZiAoIUMzJGpzY29tcCQ4LklzRmluaXRlTnVtYmVyKGIpKSByZXR1cm4gITE7CiAgICByZXR1cm4gITAKfTsKQzMkanNjb21wJDguUmVxdWlyZUFycmF5T2YgPSBmdW5jdGlvbihhLCBiKSB7CiAgICBmb3IgKGxldCBkIG9mIGEpOwp9OwpDMyRqc2NvbXAkOC5SZXF1aXJlT3B0aW9uYWxBcnJheU9mID0gZnVuY3Rpb24oYSwgYikgewogICAgaWYgKCFDMyRqc2NvbXAkOC5Jc051bGxPclVuZGVmaW5lZChhKSkKICAgICAgICBmb3IgKGxldCBkIG9mIGEpOwp9OwpDMyRqc2NvbXAkOC5SZXF1aXJlQXJyYXlPZkFueSA9IGZ1bmN0aW9uKGEsIC4uLmIpIHsKICAgIGZvciAobGV0IGQgb2YgYSk7Cn07CkMzJGpzY29tcCQ4LlJlcXVpcmVPcHRpb25hbEFycmF5T2ZBbnkgPSBmdW5jdGlvbihhLCAuLi5iKSB7CiAgICBpZiAoIUMzJGpzY29tcCQ4LklzTnVsbE9yVW5kZWZpbmVkKGEpKQogICAgICAgIGZvciAobGV0IGQgb2YgYSk7Cn07CkMzJGpzY29tcCQ4LklzRE9NTm9kZSA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgIHJldHVybiBDMyRqc2NvbXAkOC5Jc051bGxPclVuZGVmaW5lZChhKSB8fCAhQzMkanNjb21wJDguSXNTdHJpbmcoYS5ub2RlTmFtZSkgPyAhMSA6ICFiIHx8IEMzJGpzY29tcCQ4LmVxdWFsc05vQ2FzZShhLm5vZGVOYW1lLCBiKQp9OwpDMyRqc2NvbXAkOC5SZXF1aXJlRE9NTm9kZSA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgIGlmIChDMyRqc2NvbXAkOC5Jc051bGxPclVuZGVmaW5lZChhKSB8fCAhQzMkanNjb21wJDguSXNTdHJpbmcoYS5ub2RlTmFtZSkpIHRocm93IG5ldyBUeXBlRXJyb3IoImV4cGVjdGVkIERPTSBub2RlIik7CiAgICBpZiAoYiAmJiAhQzMkanNjb21wJDguZXF1YWxzTm9DYXNlKGEubm9kZU5hbWUsIGIpKSB0aHJvdyBuZXcgVHlwZUVycm9yKGBleHBlY3RlZCBET00gJyR7Yn0nIG5vZGVgKTsKfTsKQzMkanNjb21wJDguUmVxdWlyZU9wdGlvbmFsRE9NTm9kZSA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgIEMzJGpzY29tcCQ4LklzTnVsbE9yVW5kZWZpbmVkKGEpCn07CkMzJGpzY29tcCQ4LklzSFRNTEVsZW1lbnQgPSBmdW5jdGlvbihhLCBiKSB7CiAgICByZXR1cm4gQzMkanNjb21wJDguSXNOdWxsT3JVbmRlZmluZWQoYSkgfHwgIUMzJGpzY29tcCQ4LklzU3RyaW5nKGEudGFnTmFtZSkgPyAhMSA6ICFiIHx8IEMzJGpzY29tcCQ4LmVxdWFsc05vQ2FzZShhLnRhZ05hbWUsIGIpCn07CkMzJGpzY29tcCQ4LlJlcXVpcmVIVE1MRWxlbWVudCA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgIGlmIChDMyRqc2NvbXAkOC5Jc051bGxPclVuZGVmaW5lZChhKSB8fCAhQzMkanNjb21wJDguSXNTdHJpbmcoYS50YWdOYW1lKSkgdGhyb3cgbmV3IFR5cGVFcnJvcigiZXhwZWN0ZWQgSFRNTCBlbGVtZW50Iik7CiAgICBpZiAoYiAmJiAhQzMkanNjb21wJDguZXF1YWxzTm9DYXNlKGEudGFnTmFtZSwgYikpIHRocm93IG5ldyBUeXBlRXJyb3IoYGV4cGVjdGVkIEhUTUwgJyR7Yn0nIGVsZW1lbnRgKTsKfTsKQzMkanNjb21wJDguUmVxdWlyZU9wdGlvbmFsSFRNTEVsZW1lbnQgPSBmdW5jdGlvbihhLCBiKSB7CiAgICBDMyRqc2NvbXAkOC5Jc051bGxPclVuZGVmaW5lZChhKQp9OwpDMyRqc2NvbXAkOC5Jc0RyYXdhYmxlID0gZnVuY3Rpb24oYSkgewogICAgcmV0dXJuIEMzJGpzY29tcCQ4LklzSFRNTEVsZW1lbnQoYSwgImltZyIpIHx8IEMzJGpzY29tcCQ4LklzSFRNTEVsZW1lbnQoYSwgImNhbnZhcyIpIHx8IEMzJGpzY29tcCQ4LklzSFRNTEVsZW1lbnQoYSwgInZpZGVvIikgfHwgInVuZGVmaW5lZCIgIT09IHR5cGVvZiBPZmZzY3JlZW5DYW52YXMgJiYgYSBpbnN0YW5jZW9mIE9mZnNjcmVlbkNhbnZhcyB8fCAidW5kZWZpbmVkIiAhPT0gdHlwZW9mIEltYWdlQml0bWFwICYmIGEgaW5zdGFuY2VvZiBJbWFnZUJpdG1hcAp9OwpDMyRqc2NvbXAkOC5SZXF1aXJlRHJhd2FibGUgPSBmdW5jdGlvbihhKSB7CiAgICBpZiAoIUMzJGpzY29tcCQ4LklzRHJhd2FibGUoYSkpIHRocm93IG5ldyBUeXBlRXJyb3IoImV4cGVjdGVkIGRyYXdhYmxlIik7Cn07CkMzJGpzY29tcCQ4LlJlcXVpcmVPcHRpb25hbERyYXdhYmxlID0gZnVuY3Rpb24oYSkgewogICAgQzMkanNjb21wJDguSXNOdWxsT3JVbmRlZmluZWQoYSkKfTsKQzMkanNjb21wJDguSXNEcmF3YWJsZU9ySW1hZ2VEYXRhID0gZnVuY3Rpb24oYSkgewogICAgcmV0dXJuIGEgaW5zdGFuY2VvZiBJbWFnZURhdGEgPyAhMCA6IEMzJGpzY29tcCQ4LklzRHJhd2FibGUoYSkKfTsKQzMkanNjb21wJDguUmVxdWlyZURyYXdhYmxlT3JJbWFnZURhdGEgPSBmdW5jdGlvbihhKSB7CiAgICBpZiAoIUMzJGpzY29tcCQ4LklzRHJhd2FibGVPckltYWdlRGF0YShhKSkgdGhyb3cgbmV3IFR5cGVFcnJvcigiZXhwZWN0ZWQgZHJhd2FibGUgb3IgaW1hZ2UgZGF0YSIpOwp9OwpDMyRqc2NvbXAkOC5SZXF1aXJlT3B0aW9uYWxEcmF3YWJsZU9ySW1hZ2VEYXRhID0gZnVuY3Rpb24oYSkgewogICAgaWYgKCFDMyRqc2NvbXAkOC5Jc051bGxPclVuZGVmaW5lZChhKSAmJiAhQzMkanNjb21wJDguSXNEcmF3YWJsZU9ySW1hZ2VEYXRhKGEpKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJleHBlY3RlZCBkcmF3YWJsZSBvciBpbWFnZSBkYXRhIik7Cn07CkMzJGpzY29tcCQ4LklzU3RyaW5nTGlrZSA9IGZ1bmN0aW9uKGEpIHsKICAgIHJldHVybiAic3RyaW5nIiA9PT0gdHlwZW9mIGEgfHwgQzMkanNjb21wJDguSHRtbFN0cmluZyAmJiBhIGluc3RhbmNlb2YgQzMkanNjb21wJDguSHRtbFN0cmluZyB8fCBhIGluc3RhbmNlb2YgQzMkanNjb21wJDguQkJTdHJpbmcKfTsKQzMkanNjb21wJDguUmVxdWlyZVN0cmluZ0xpa2UgPSBmdW5jdGlvbihhKSB7CiAgICBpZiAoIUMzJGpzY29tcCQ4LklzU3RyaW5nTGlrZShhKSkgdGhyb3cgbmV3IFR5cGVFcnJvcigiZXhwZWN0ZWQgc3RyaW5nLWxpa2UiKTsKfTsKQzMkanNjb21wJDguUmVxdWlyZU9wdGlvbmFsU3RyaW5nTGlrZSA9IGZ1bmN0aW9uKGEpIHsKICAgIEMzJGpzY29tcCQ4LklzTnVsbE9yVW5kZWZpbmVkKGEpCn07CkMzJGpzY29tcCQ4LlJlcXVpcmVBbGxTdHJpbmdMaWtlID0gZnVuY3Rpb24oLi4uYSkgewogICAgZm9yIChsZXQgYiBvZiBhKTsKfTsKQzMkanNjb21wJDguUmVxdWlyZU92ZXJyaWRlID0gZnVuY3Rpb24oKSB7CiAgICB0aHJvdyBFcnJvcigibXVzdCBiZSBvdmVycmlkZGVuIik7Cn07CkMzJGpzY29tcCQ4Lk5vdFlldEltcGxlbWVudGVkID0gZnVuY3Rpb24oKSB7CiAgICB0aHJvdyBFcnJvcigibm90IHlldCBpbXBsZW1lbnRlZCIpOwp9OwpDMyRqc2NvbXAkOC5Jc0RlZmluZWQgPSBmdW5jdGlvbihhLCAuLi5iKSB7CiAgICBpZiAoInVuZGVmaW5lZCIgPT09IHR5cGVvZiBhKSByZXR1cm4gITE7CiAgICBmb3IgKGxldCBkIG9mIGIpIHsKICAgICAgICBpZiAoInVuZGVmaW5lZCIgPT09IHR5cGVvZiBhW2RdKSByZXR1cm4gITE7CiAgICAgICAgYSA9IGFbZF0KICAgIH0KICAgIHJldHVybiAhMAp9OwpDMyRqc2NvbXAkOC5Jc051bGxPclVuZGVmaW5lZCA9IGZ1bmN0aW9uKGEpIHsKICAgIHJldHVybiAidW5kZWZpbmVkIiA9PT0gdHlwZW9mIGEgfHwgbnVsbCA9PT0gYQp9OwpDMyRqc2NvbXAkOC5BcmVBcnJheUVsZW1lbnRzT2ZTYW1lVHlwZSA9IGZ1bmN0aW9uKGEpIHsKICAgIGxldCBiID0gYVswXS5jb25zdHJ1Y3RvcjsKICAgIGZvciAobGV0IGQgb2YgYSkKICAgICAgICBpZiAoZC5jb25zdHJ1Y3RvciAhPT0gYikgcmV0dXJuICExOwogICAgcmV0dXJuIGIKfTsKQzMkanNjb21wJDguQXJlQXJyYXlFbGVtZW50c09mVHlwZSA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgIGZvciAobGV0IGQgb2YgYSkKICAgICAgICBpZiAoIShkIGluc3RhbmNlb2YgYikpIHJldHVybiAhMTsKICAgIHJldHVybiAhMAp9Owpjb25zdCBUeXBlZEFycmF5JGpzY29tcCQxID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKFVpbnQ4QXJyYXkpOwpDMyRqc2NvbXAkOC5Jc1R5cGVkQXJyYXkgPSBmdW5jdGlvbihhKSB7CiAgICByZXR1cm4gQzMkanNjb21wJDguSXNJbnN0YW5jZU9mKGEsIFR5cGVkQXJyYXkkanNjb21wJDEpCn07CkMzJGpzY29tcCQ4LlJlcXVpcmVUeXBlZEFycmF5ID0gZnVuY3Rpb24oYSkge307CkMzJGpzY29tcCQ4LldlYWtSZXF1aXJlVHlwZWRBcnJheSA9IGZ1bmN0aW9uKGEpIHsKICAgIEMzJGpzY29tcCQ4LldlYWtSZXF1aXJlSW5zdGFuY2VPZihhLCBUeXBlZEFycmF5JGpzY29tcCQxKQp9OwpDMyRqc2NvbXAkOC5XZWFrUmVxdWlyZUFueUluc3RhbmNlT2YgPSBmdW5jdGlvbihhLCAuLi5iKSB7CiAgICBpZiAoIUMzJGpzY29tcCQ4LldlYWtJc0FueUluc3RhbmNlT2YoYSwgLi4uYikpIHRocm93IG5ldyBUeXBlRXJyb3IoInVuZXhwZWN0ZWQgdHlwZSIpOwp9OwpDMyRqc2NvbXAkOC5XZWFrSXNBbnlJbnN0YW5jZU9mID0gZnVuY3Rpb24oYSwgLi4uYikgewogICAgZm9yIChjb25zdCBkIG9mIGIpCiAgICAgICAgaWYgKEMzJGpzY29tcCQ4LldlYWtJc0luc3RhbmNlT2YoYSwgZCkpIHJldHVybiAhMDsKICAgIHJldHVybiAhMQp9OwpDMyRqc2NvbXAkOC5XZWFrUmVxdWlyZUluc3RhbmNlT2YgPSBmdW5jdGlvbihhLCBiKSB7CiAgICBpZiAoIUMzJGpzY29tcCQ4LldlYWtJc0luc3RhbmNlT2YoYSwgYikpIHRocm93IG5ldyBUeXBlRXJyb3IoInVuZXhwZWN0ZWQgdHlwZSIpOwp9OwpDMyRqc2NvbXAkOC5XZWFrSXNJbnN0YW5jZU9mID0gZnVuY3Rpb24oYSwgYikgewogICAgZm9yICg7IGEgPSBPYmplY3QuZ2V0UHJvdG90eXBlT2YoYSk7KQogICAgICAgIGlmIChhLmNvbnN0cnVjdG9yLm5hbWUgPT09IGIubmFtZSkgcmV0dXJuICEwOwogICAgcmV0dXJuICExCn07CkMzWC5SZXF1aXJlTnVtYmVyID0gQzMkanNjb21wJDguUmVxdWlyZU51bWJlcjsKQzNYLlJlcXVpcmVPcHRpb25hbE51bWJlciA9IEMzJGpzY29tcCQ4LlJlcXVpcmVPcHRpb25hbE51bWJlcjsKQzNYLlJlcXVpcmVGaW5pdGVOdW1iZXIgPSBDMyRqc2NvbXAkOC5SZXF1aXJlRmluaXRlTnVtYmVyOwpDM1guUmVxdWlyZU9wdGlvbmFsRmluaXRlTnVtYmVyID0gQzMkanNjb21wJDguUmVxdWlyZU9wdGlvbmFsRmluaXRlTnVtYmVyOwpDM1guUmVxdWlyZVN0cmluZyA9IEMzJGpzY29tcCQ4LlJlcXVpcmVTdHJpbmc7CkMzWC5SZXF1aXJlT3B0aW9uYWxTdHJpbmcgPSBDMyRqc2NvbXAkOC5SZXF1aXJlT3B0aW9uYWxTdHJpbmc7CkMzWC5SZXF1aXJlT2JqZWN0ID0gQzMkanNjb21wJDguUmVxdWlyZU9iamVjdDsKQzNYLlJlcXVpcmVPcHRpb25hbE9iamVjdCA9IEMzJGpzY29tcCQ4LlJlcXVpcmVPcHRpb25hbE9iamVjdDsKQzNYLlJlcXVpcmVBcnJheSA9IEMzJGpzY29tcCQ4LlJlcXVpcmVBcnJheTsKQzNYLlJlcXVpcmVPcHRpb25hbEFycmF5ID0gQzMkanNjb21wJDguUmVxdWlyZU9wdGlvbmFsQXJyYXk7CkMzWC5SZXF1aXJlRnVuY3Rpb24gPSBDMyRqc2NvbXAkOC5SZXF1aXJlRnVuY3Rpb247CkMzWC5SZXF1aXJlT3B0aW9uYWxGdW5jdGlvbiA9IEMzJGpzY29tcCQ4LlJlcXVpcmVPcHRpb25hbEZ1bmN0aW9uOwpDM1guUmVxdWlyZUluc3RhbmNlT2YgPSBDMyRqc2NvbXAkOC5SZXF1aXJlSW5zdGFuY2VPZjsKQzNYLlJlcXVpcmVPcHRpb25hbEluc3RhbmNlT2YgPSBDMyRqc2NvbXAkOC5SZXF1aXJlT3B0aW9uYWxJbnN0YW5jZU9mOwpDM1guSXNOdWxsT3JVbmRlZmluZWQgPSBDMyRqc2NvbXAkOC5Jc051bGxPclVuZGVmaW5lZDsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkOSA9IHNlbGYuQzMsCiAgICBsb2dSYWZJZHMgPSBuZXcgTWFwOwpDMyRqc2NvbXAkOS5Db2xvckxvZyA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgIGNvbnNvbGUubG9nKGAlYyR7YX1gLCBgZm9udC13ZWlnaHQ6IGJvbGQ7IGNvbG9yOiR7Yn1gKQp9OwpDMyRqc2NvbXAkOS5SYWZMb2cgPSBmdW5jdGlvbihhLCAuLi5iKSB7CiAgICBsb2dSYWZJZHMuaGFzKGEpIHx8IGxvZ1JhZklkcy5zZXQoYSwgLTEpOyAtIDEgPT09IGxvZ1JhZklkcy5nZXQoYSkgJiYgbG9nUmFmSWRzLnNldChhLCByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4gewogICAgICAgIGNvbnNvbGUubG9nKGAlYyR7YX1gLCAiZm9udC13ZWlnaHQ6IGJvbGQiLCAuLi5iKTsKICAgICAgICBsb2dSYWZJZHMuc2V0KGEsIC0xKQogICAgfSkpCn07CmxldCBtZWFzdXJlczsKQzMkanNjb21wJDkuU3RhcnRNZWFzdXJlID0gZnVuY3Rpb24oYSkgewogICAgcGVyZm9ybWFuY2UubWFyayhhKTsKICAgIG1lYXN1cmVzIHx8IChtZWFzdXJlcyA9IG5ldyBNYXApOwogICAgbWVhc3VyZXMuaGFzKGEpIHx8IG1lYXN1cmVzLnNldChhLCB7CiAgICAgICAgY3VycmVudDogMCwKICAgICAgICB0b3RhbDogMCwKICAgICAgICBhdmVyYWdlOiAwLAogICAgICAgIGNhbGxzOiAxLAogICAgICAgIHRvU3RyaW5nOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIGBjdXJyZW50ID0+ICR7dGhpcy5jdXJyZW50LnRvUHJlY2lzaW9uKDMpfSA6OiBhdmVyYWdlID0+ICR7dGhpcy5hdmVyYWdlLnRvUHJlY2lzaW9uKDMpfSA6OiBjYWxscyA9PiAke3RoaXMuY2FsbHN9YAogICAgICAgIH0KICAgIH0pCn07CkMzJGpzY29tcCQ5LkVuZE1lYXN1cmUgPSBmdW5jdGlvbihhKSB7CiAgICBwZXJmb3JtYW5jZS5tZWFzdXJlKCJtZWFzdXJlIiwgYSk7CiAgICBjb25zdCBiID0gcGVyZm9ybWFuY2UuZ2V0RW50cmllc0J5TmFtZSgibWVhc3VyZSIpWzBdOwogICAgYSA9IG1lYXN1cmVzLmdldChhKTsKICAgIGEuY3VycmVudCA9IGIuZHVyYXRpb247CiAgICBhLnRvdGFsICs9IGEuY3VycmVudDsKICAgIGEuYXZlcmFnZSA9IGEudG90YWwgLyBhLmNhbGxzOwogICAgYS5jYWxscysrOwogICAgY29uc29sZS5sb2coYS50b1N0cmluZygpKTsKICAgIHBlcmZvcm1hbmNlLmNsZWFyTWFya3MoKTsKICAgIHBlcmZvcm1hbmNlLmNsZWFyTWVhc3VyZXMoKQp9OwpDMyRqc2NvbXAkOS5HZXRDYWxsU3RhY2sgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiBFcnJvcigpLnN0YWNrCn07CkMzJGpzY29tcCQ5LkRlYnVnZ2VyID0gZnVuY3Rpb24oKSB7CiAgICBkZWJ1Z2dlcgp9OwpDMyRqc2NvbXAkOS5jYXN0ID0gZnVuY3Rpb24oYSwgYikgewogICAgcmV0dXJuIGEgJiYgYSBpbnN0YW5jZW9mIGIgPyBhIDogbnVsbAp9OwpDMyRqc2NvbXAkOS5nZXROYW1lID0gZnVuY3Rpb24oYSkgewogICAgcmV0dXJuICJ1bmRlZmluZWQiID09PSB0eXBlb2YgYSA/ICJ1bmRlZmluZWQiIDogbnVsbCA9PT0gYSA/ICJudWxsIiA6ICJib29sZWFuIiA9PT0gdHlwZW9mIGEgPyAiPGJvb2xlYW4+IiA6IEMzJGpzY29tcCQ5LklzTnVtYmVyKGEpID8gIjxudW1iZXI+IiA6IEMzJGpzY29tcCQ5LklzU3RyaW5nKGEpID8gIjxzdHJpbmc+IiA6IEMzJGpzY29tcCQ5LklzQXJyYXkoYSkgPyAiPGFycmF5PiIgOiAic3ltYm9sIiA9PT0gdHlwZW9mIGEgPyAiPCIgKyBhLnRvU3RyaW5nKCkgKyAiPiIgOiBDMyRqc2NvbXAkOS5Jc0Z1bmN0aW9uKGEpID8gYS5uYW1lICYmICJGdW5jdGlvbiIgIT09IGEubmFtZSA/IGEubmFtZSA6ICI8YW5vbnltb3VzIGZ1bmN0aW9uPiIgOiAib2JqZWN0IiA9PT0gdHlwZW9mIGEgPyBhLmNvbnN0cnVjdG9yICYmIGEuY29uc3RydWN0b3IubmFtZSAmJiAiT2JqZWN0IiAhPT0gYS5jb25zdHJ1Y3Rvci5uYW1lID8gYS5jb25zdHJ1Y3Rvci5uYW1lIDogIjxhbm9ueW1vdXMgb2JqZWN0PiIgOiAiPHVua25vd24+Igp9OwpDMyRqc2NvbXAkOS5nZXRUeXBlID0gZnVuY3Rpb24oYSkgewogICAgcmV0dXJuIG51bGwgPT09IGEgPyAibnVsbCIgOiBBcnJheS5pc0FycmF5KGEpID8gImFycmF5IiA6IHR5cGVvZiBhCn07CkMzJGpzY29tcCQ5LnJhbmdlID0gZnVuY3Rpb24qKGEsIGIpIHsKICAgIGlmICghaXNGaW5pdGUoTWF0aC5hYnMoYSAtIGIpKSkgdGhyb3cgRXJyb3IoIkludmFsaWQgcGFyYW1ldGVycyIpOwogICAgaWYgKGEgPiBiKQogICAgICAgIGZvciAoLS1hOyBhID49IGI7IGEtLSkgeWllbGQgYTsKICAgIGVsc2UKICAgICAgICBmb3IgKDsgYSA8IGI7IGErKykgeWllbGQgYQp9OwoKZnVuY3Rpb24gaXNWYWxpZFR5cGVDaGFuZ2UoYSwgYikgewogICAgYSA9IEMzJGpzY29tcCQ5LmdldFR5cGUoYSk7CiAgICBiID0gQzMkanNjb21wJDkuZ2V0VHlwZShiKTsKICAgIHJldHVybiAibnVsbCIgPT09IGEgfHwgIm51bGwiID09PSBiID8gITAgOiAidW5kZWZpbmVkIiA9PT0gYSB8fCAidW5kZWZpbmVkIiA9PT0gYiA/ICExIDogYSA9PT0gYgp9CmxldCBjdG9yT2JqZWN0VG9Qcm94eSA9IG5ldyBNYXAsCiAgICBjdG9yUHJveHlUb09iamVjdCA9IG5ldyBNYXAsCiAgICBwcm94eVRvT2JqZWN0ID0gbmV3IFdlYWtNYXAsCiAgICByZWxlYXNlZE9iamVjdHMgPSBuZXcgV2Vha01hcDsKQzMkanNjb21wJDkuRGVmZW5kSGFuZGxlciA9IHt9Owpjb25zdCBWQUxJRF9HRVRfTUlTU0lOR19LRVlTID0gbmV3IFNldChbInRoZW4iLCAic3BsaWNlIl0pOwoKZnVuY3Rpb24gbG9nRGVmZW5kZWRPYmplY3RXYXJuaW5nKGEpIHsKICAgIGNvbnNvbGUud2FybigiW0RlZmVuY2VdICIgKyBhICsgIiBAIiwgQzMkanNjb21wJDkuR2V0Q2FsbFN0YWNrKCkpCn0KQzMkanNjb21wJDkuRGVmZW5kSGFuZGxlci5nZXQgPSBmdW5jdGlvbihhLCBiKSB7CiAgICBiIGluIGEgfHwgInN5bWJvbCIgPT09IHR5cGVvZiBiIHx8IFZBTElEX0dFVF9NSVNTSU5HX0tFWVMuaGFzKGIpIHx8IGxvZ0RlZmVuZGVkT2JqZWN0V2FybmluZyhgQWNjZXNzZWQgbWlzc2luZyBwcm9wZXJ0eSAnJHtifScgZnJvbSBkZWZlbmRlZCBvYmplY3QgJyR7QzMkanNjb21wJDkuZ2V0TmFtZShhKX0nLCByZXR1cm5pbmcgdW5kZWZpbmVkYCk7CiAgICByZWxlYXNlZE9iamVjdHMuaGFzKGEpICYmICJzeW1ib2wiICE9PSB0eXBlb2YgYiAmJiAhVkFMSURfR0VUX01JU1NJTkdfS0VZUy5oYXMoYikgJiYgbG9nRGVmZW5kZWRPYmplY3RXYXJuaW5nKGBBY2Nlc3NlZCBwcm9wZXJ0eSAnJHtifScgb24gYSByZWxlYXNlZCBvYmplY3QgJyR7QzMkanNjb21wJDkuZ2V0TmFtZShhKX0nXG5PYmplY3Qgd2FzIG9yaWdpbmFsbHkgcmVsZWFzZWQgYXQ6ICR7cmVsZWFzZWRPYmplY3RzLmdldChhKX0pXG5DYWxsIHN0YWNrIGF0IGFjY2VzczogYCk7CiAgICByZXR1cm4gYVtiXQp9OwpDMyRqc2NvbXAkOS5EZWZlbmRIYW5kbGVyLnNldCA9IGZ1bmN0aW9uKGEsIGIsIGQpIHsKICAgIGIgaW4gYSB8fCBjdG9yT2JqZWN0VG9Qcm94eS5oYXMoYSkgfHwgbG9nRGVmZW5kZWRPYmplY3RXYXJuaW5nKGBTZXQgbm9uLWV4aXN0ZW50IHByb3BlcnR5ICcke2J9JyB0byAnJHtkfScgb24gZGVmZW5kZWQgb2JqZWN0ICcke0MzJGpzY29tcCQ5LmdldE5hbWUoYSl9J2ApOwogICAgaXNWYWxpZFR5cGVDaGFuZ2UoYVtiXSwgZCkgfHwgY3Rvck9iamVjdFRvUHJveHkuaGFzKGEpIHx8IGxvZ0RlZmVuZGVkT2JqZWN0V2FybmluZyhgU2V0ICcke0MzJGpzY29tcCQ5LmdldFR5cGUoYVtiXSl9JyBwcm9wZXJ0eSAnJHtifScgdG8gdHlwZSAnJHtDMyRqc2NvbXAkOS5nZXRUeXBlKGQpfScgb24gZGVmZW5kZWQgb2JqZWN0ICcke0MzJGpzY29tcCQ5LmdldE5hbWUoYSl9J2ApOwogICAgcmVsZWFzZWRPYmplY3RzLmhhcyhhKSAmJiBsb2dEZWZlbmRlZE9iamVjdFdhcm5pbmcoYFNldCBwcm9wZXJ0eSAnJHtifScgb24gYSByZWxlYXNlZCBvYmplY3QgJyR7QzMkanNjb21wJDkuZ2V0TmFtZShhKX0nXG5PYmplY3Qgd2FzIG9yaWdpbmFsbHkgcmVsZWFzZWQgYXQ6ICR7cmVsZWFzZWRPYmplY3RzLmdldChhKX0pXG5DYWxsIHN0YWNrIGF0IGFjY2VzczogYCk7CiAgICBhW2JdID0gZDsKICAgIHJldHVybiAhMAp9OwpDMyRqc2NvbXAkOS5EZWZlbmRIYW5kbGVyLmRlbGV0ZVByb3BlcnR5ID0gZnVuY3Rpb24oYSwgYikgewogICAgdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKGBDYW5ub3QgZGVsZXRlIHByb3BlcnR5ICcke2J9JyBmcm9tIGRlZmVuZGVkIG9iamVjdCAnJHtDMyRqc2NvbXAkOS5nZXROYW1lKGEpfSdgKTsKfTsKQzMkanNjb21wJDkuRGVmZW5kSGFuZGxlci5kZWZpbmVQcm9wZXJ0eSA9IGZ1bmN0aW9uKGEsIGIsIGQpIHsKICAgIHRocm93IG5ldyBSZWZlcmVuY2VFcnJvcihgQ2Fubm90IGRlZmluZSBwcm9wZXJ0eSAnJHtifScgb24gZGVmZW5kZWQgb2JqZWN0ICcke0MzJGpzY29tcCQ5LmdldE5hbWUoYSl9J2ApOwp9OwpDMyRqc2NvbXAkOS5EZWZlbmRIYW5kbGVyLmVudW1lcmF0ZSA9IGZ1bmN0aW9uKGEpIHsKICAgIHRocm93IG5ldyBSZWZlcmVuY2VFcnJvcihgQ2Fubm90IGVudW1lcmF0ZSBkZWZlbmRlZCBvYmplY3QgJyR7QzMkanNjb21wJDkuZ2V0TmFtZShhKX0nYCk7Cn07CmxldCBjaGVja1JhZklkID0gLTE7CgpmdW5jdGlvbiBDaGVja0RlZmVuZGVkT2JqZWN0c1VzZWRDb3JyZWN0bHkoKSB7CiAgICBjaGVja1JhZklkID0gLTE7CiAgICBpZiAoMCA8IGN0b3JPYmplY3RUb1Byb3h5LnNpemUgfHwgMCA8IGN0b3JQcm94eVRvT2JqZWN0LnNpemUpIHsKICAgICAgICBsZXQgYSA9IFsuLi4obmV3IFNldChbLi4uY3Rvck9iamVjdFRvUHJveHkua2V5cygpXS5tYXAoYiA9PiBDMyRqc2NvbXAkOS5nZXROYW1lKGIpKSkpXS5qb2luKCk7CiAgICAgICAgY29uc29sZS53YXJuKGBBbiBvYmplY3QgZGVyaXZlZCBmcm9tIERlZmVuZGVkQmFzZSB3YXMgbm90IHByb3RlY3RlZCB3aXRoIGRlYnVnRGVmZW5kKCkuIFRoaXMgd2lsbCBkaXNhYmxlIHNvbWUgY2hlY2tzLiBTZWUgdGhlIGNvZGluZyBndWlkZWxpbmVzISBQb3NzaWJsZSBhZmZlY3RlZCBjbGFzcyBuYW1lczogJHthfWApOwogICAgICAgIGN0b3JPYmplY3RUb1Byb3h5LmNsZWFyKCk7CiAgICAgICAgY3RvclByb3h5VG9PYmplY3QuY2xlYXIoKQogICAgfQp9CkMzJGpzY29tcCQ5LkRlZmVuZGVkQmFzZSA9IGNsYXNzIHsKICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgIGlmIChDMyRqc2NvbXAkOS5pc0RlYnVnRGVmZW5kICYmIEMzJGpzY29tcCQ5LlN1cHBvcnRzLlByb3hpZXMpIHsKICAgICAgICAgICAgdmFyIGEgPSBuZXcudGFyZ2V0OwogICAgICAgICAgICBhID0gT2JqZWN0LmNyZWF0ZShhLnByb3RvdHlwZSk7CiAgICAgICAgICAgIHZhciBiID0gbmV3IFByb3h5KGEsIEMzJGpzY29tcCQ5LkRlZmVuZEhhbmRsZXIpOwogICAgICAgICAgICBjdG9yT2JqZWN0VG9Qcm94eS5zZXQoYSwgYik7CiAgICAgICAgICAgIGN0b3JQcm94eVRvT2JqZWN0LnNldChiLCBhKTsKICAgICAgICAgICAgcHJveHlUb09iamVjdC5zZXQoYiwgYSk7IC0gMSA9PT0gY2hlY2tSYWZJZCAmJiAoY2hlY2tSYWZJZCA9IHJlcXVlc3RBbmltYXRpb25GcmFtZShDaGVja0RlZmVuZGVkT2JqZWN0c1VzZWRDb3JyZWN0bHkpKTsKICAgICAgICAgICAgcmV0dXJuIGIKICAgICAgICB9CiAgICB9Cn07CkMzJGpzY29tcCQ5LmRlYnVnRGVmZW5kID0gZnVuY3Rpb24oYSkgewogICAgaWYgKEMzJGpzY29tcCQ5LmlzRGVidWdEZWZlbmQgJiYgQzMkanNjb21wJDkuU3VwcG9ydHMuUHJveGllcyAmJiBhIGluc3RhbmNlb2YgQzMkanNjb21wJDkuRGVmZW5kZWRCYXNlKSB7CiAgICAgICAgaWYgKCFjdG9yUHJveHlUb09iamVjdC5oYXMoYSkpIHJldHVybiBhOwogICAgICAgIGxldCBiID0gY3RvclByb3h5VG9PYmplY3QuZ2V0KGEpOwogICAgICAgIGN0b3JQcm94eVRvT2JqZWN0LmRlbGV0ZShhKTsKICAgICAgICBjdG9yT2JqZWN0VG9Qcm94eS5kZWxldGUoYik7CiAgICAgICAgcmV0dXJuIGEKICAgIH0KICAgIHJldHVybiBDMyRqc2NvbXAkOS5pc0RlYnVnID8gT2JqZWN0LnNlYWwoYSkgOiBhCn07CkMzJGpzY29tcCQ5Lk5ldyA9IGZ1bmN0aW9uKGEsIC4uLmIpIHsKICAgIGxldCBkOwogICAgdHJ5IHsKICAgICAgICBkID0gbmV3IGEoLi4uYikKICAgIH0gY2F0Y2ggKGMpIHsKICAgICAgICB0aHJvdyBjdG9yUHJveHlUb09iamVjdC5jbGVhcigpLCBjdG9yT2JqZWN0VG9Qcm94eS5jbGVhcigpLCBjOwogICAgfQogICAgQzMkanNjb21wJDkuaXNEZWJ1Z0RlZmVuZCAmJiBWZXJpZnlPYmplY3RQcm9wZXJ0aWVzQ29uc2lzdGVudChhLCBkKTsKICAgIHJldHVybiBDMyRqc2NvbXAkOS5kZWJ1Z0RlZmVuZChkKQp9OwpDMyRqc2NvbXAkOS5SZWxlYXNlID0gZnVuY3Rpb24oYSkgewogICAgKGEgPSBwcm94eVRvT2JqZWN0LmdldChhKSkgJiYgcmVsZWFzZWRPYmplY3RzLnNldChhLCBDMyRqc2NvbXAkOS5HZXRDYWxsU3RhY2soKSkKfTsKQzMkanNjb21wJDkuV2FzUmVsZWFzZWQgPSBmdW5jdGlvbihhKSB7CiAgICByZXR1cm4gKGEgPSBwcm94eVRvT2JqZWN0LmdldChhKSkgPyAhIXJlbGVhc2VkT2JqZWN0cy5nZXQoYSkgOiAhMQp9OwpsZXQgdHlwZVByb3BlcnRpZXMgPSBuZXcgTWFwOwoKZnVuY3Rpb24gZ2V0T2JqZWN0UHJvcGVydHlTZXQoYSkgewogICAgbGV0IGIgPSBuZXcgU2V0OwogICAgZm9yIChsZXQgZCBpbiBhKSBiLmFkZChkKTsKICAgIHJldHVybiBiCn0KCmZ1bmN0aW9uIFZlcmlmeU9iamVjdFByb3BlcnRpZXNDb25zaXN0ZW50KGEsIGIpIHsKICAgIGIgPSBnZXRPYmplY3RQcm9wZXJ0eVNldChiKTsKICAgIGxldCBkID0gdHlwZVByb3BlcnRpZXMuZ2V0KGEpOwogICAgaWYgKGQpIHsKICAgICAgICBsZXQgYyA9IFtdOwogICAgICAgIGZvciAobGV0IGUgb2YgZC52YWx1ZXMoKSkgYi5oYXMoZSkgPyBiLmRlbGV0ZShlKSA6IGMucHVzaChlKTsKICAgICAgICBDMyRqc2NvbXAkOS5hcHBlbmRBcnJheShjLCBbLi4uYl0pOwogICAgICAgIGMubGVuZ3RoICYmIGNvbnNvbGUud2FybihgW0RlZmVuY2VdICcke0MzJGpzY29tcCQ5LmdldE5hbWUoYSl9JyBjb25zdHJ1Y3RvciBjcmVhdGVzIGluY29uc2lzdGVudCBwcm9wZXJ0aWVzOiAke2Muam9pbigiLCAiKX1gKQogICAgfSBlbHNlIHR5cGVQcm9wZXJ0aWVzLnNldChhLCBiKQp9CkMzJGpzY29tcCQ5LlBlcmZNYXJrID0gY2xhc3MgewogICAgY29uc3RydWN0b3IoYSkgewogICAgICAgIHRoaXMuX25hbWUgPSAiIjsKICAgICAgICBhICYmIHRoaXMuc3RhcnQoYSkKICAgIH0KICAgIHN0YXJ0KGEpIHsKICAgICAgICBDMyRqc2NvbXAkOS5pc1BlcmZvcm1hbmNlUHJvZmlsaW5nICYmICh0aGlzLl9uYW1lID0gYSwgcGVyZm9ybWFuY2UubWFyayh0aGlzLl9uYW1lICsgIi1TdGFydCIpKQogICAgfQogICAgZW5kKCkgewogICAgICAgIEMzJGpzY29tcCQ5LmlzUGVyZm9ybWFuY2VQcm9maWxpbmcgJiYgKHBlcmZvcm1hbmNlLm1hcmsodGhpcy5fbmFtZSArICItRW5kIiksIHBlcmZvcm1hbmNlLm1lYXN1cmUodGhpcy5fbmFtZSwgdGhpcy5fbmFtZSArICItU3RhcnQiLCB0aGlzLl9uYW1lICsgIi1FbmQiKSkKICAgIH0KICAgIG5leHQoYSkgewogICAgICAgIEMzJGpzY29tcCQ5LmlzUGVyZm9ybWFuY2VQcm9maWxpbmcgJiYgKHRoaXMuZW5kKCksIHRoaXMuX25hbWUgPSBhLCBwZXJmb3JtYW5jZS5tYXJrKHRoaXMuX25hbWUgKyAiLVN0YXJ0IikpCiAgICB9Cn07CiJ1c2Ugc3RyaWN0IjsKY29uc3QgQzMkanNjb21wJDEwID0gc2VsZi5DMywKICAgIFRXT19QSSA9IDIgKiBNYXRoLlBJLAogICAgRF9UT19SID0gTWF0aC5QSSAvIDE4MCwKICAgIFJfVE9fRCA9IDE4MCAvIE1hdGguUEk7CkMzJGpzY29tcCQxMC53cmFwID0gZnVuY3Rpb24oYSwgYiwgZCkgewogICAgYSA9IE1hdGguZmxvb3IoYSk7CiAgICBiID0gTWF0aC5mbG9vcihiKTsKICAgIGQgPSBNYXRoLmZsb29yKGQpOwogICAgcmV0dXJuIGEgPCBiID8gKGEgPSBkIC0gKGIgLSBhKSAlIChkIC0gYiksIGEgPT09IGQgPyAwIDogYSkgOiBiICsgKGEgLSBiKSAlIChkIC0gYikKfTsKQzMkanNjb21wJDEwLm1hcFRvUmFuZ2UgPSBmdW5jdGlvbihhLCBiLCBkLCBjLCBlKSB7CiAgICByZXR1cm4gKGEgLSBiKSAqIChlIC0gYykgLyAoZCAtIGIpICsgYwp9OwpDMyRqc2NvbXAkMTAubm9ybWFsaXplID0gZnVuY3Rpb24oYSwgYiwgZCkgewogICAgcmV0dXJuIChhIC0gYikgLyAoZCAtIGIpCn07CkMzJGpzY29tcCQxMC5jbGFtcCA9IGZ1bmN0aW9uKGEsIGIsIGQpIHsKICAgIHJldHVybiBhIDwgYiA/IGIgOiBhID4gZCA/IGQgOiBhCn07CkMzJGpzY29tcCQxMC5jbGFtcEFuZ2xlID0gZnVuY3Rpb24oYSkgewogICAgYSAlPSBUV09fUEk7CiAgICAwID4gYSAmJiAoYSArPSBUV09fUEkpOwogICAgcmV0dXJuIGEKfTsKQzMkanNjb21wJDEwLnRvUmFkaWFucyA9IGZ1bmN0aW9uKGEpIHsKICAgIHJldHVybiBhICogRF9UT19SCn07CkMzJGpzY29tcCQxMC50b0RlZ3JlZXMgPSBmdW5jdGlvbihhKSB7CiAgICByZXR1cm4gYSAqIFJfVE9fRAp9OwpDMyRqc2NvbXAkMTAuZGlzdGFuY2VUbyA9IGZ1bmN0aW9uKGEsIGIsIGQsIGMpIHsKICAgIHJldHVybiBNYXRoLmh5cG90KGQgLSBhLCBjIC0gYikKfTsKQzMkanNjb21wJDEwLmRpc3RhbmNlU3F1YXJlZCA9IGZ1bmN0aW9uKGEsIGIsIGQsIGMpIHsKICAgIGEgPSBkIC0gYTsKICAgIGIgPSBjIC0gYjsKICAgIHJldHVybiBhICogYSArIGIgKiBiCn07CkMzJGpzY29tcCQxMC5hbmdsZVRvID0gZnVuY3Rpb24oYSwgYiwgZCwgYykgewogICAgcmV0dXJuIE1hdGguYXRhbjIoYyAtIGIsIGQgLSBhKQp9OwpDMyRqc2NvbXAkMTAuYW5nbGVEaWZmID0gZnVuY3Rpb24oYSwgYikgewogICAgaWYgKGEgPT09IGIpIHJldHVybiAwOwogICAgYSA9IE1hdGguc2luKGEpICogTWF0aC5zaW4oYikgKyBNYXRoLmNvcyhhKSAqIE1hdGguY29zKGIpOwogICAgcmV0dXJuIDEgPD0gYSA/IDAgOiAtMSA+PSBhID8gTWF0aC5QSSA6IE1hdGguYWNvcyhhKQp9OwpDMyRqc2NvbXAkMTAuYW5nbGVSb3RhdGUgPSBmdW5jdGlvbihhLCBiLCBkKSB7CiAgICBsZXQgYyA9IE1hdGguc2luKGEpLAogICAgICAgIGUgPSBNYXRoLmNvcyhhKSwKICAgICAgICBnID0gTWF0aC5zaW4oYiksCiAgICAgICAgayA9IE1hdGguY29zKGIpOwogICAgcmV0dXJuIE1hdGguYWNvcyhjICogZyArIGUgKiBrKSA+IGQgPyAwIDwgZSAqIGcgLSBjICogayA/IEMzJGpzY29tcCQxMC5jbGFtcEFuZ2xlKGEgKyBkKSA6IEMzJGpzY29tcCQxMC5jbGFtcEFuZ2xlKGEgLSBkKSA6IEMzJGpzY29tcCQxMC5jbGFtcEFuZ2xlKGIpCn07CkMzJGpzY29tcCQxMC5hbmdsZUNsb2Nrd2lzZSA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgIHJldHVybiAwID49IE1hdGguY29zKGEpICogTWF0aC5zaW4oYikgLSBNYXRoLnNpbihhKSAqIE1hdGguY29zKGIpCn07CkMzJGpzY29tcCQxMC5hbmdsZUxlcnAgPSBmdW5jdGlvbihhLCBiLCBkLCBjID0gMCkgewogICAgbGV0IGUgPSBDMyRqc2NvbXAkMTAuYW5nbGVEaWZmKGEsIGIpOwogICAgYyAqPSBUV09fUEk7CiAgICByZXR1cm4gQzMkanNjb21wJDEwLmFuZ2xlQ2xvY2t3aXNlKGIsIGEpID8gQzMkanNjb21wJDEwLmNsYW1wQW5nbGUoYSArIChlICsgYykgKiBkKSA6IEMzJGpzY29tcCQxMC5jbGFtcEFuZ2xlKGEgLSAoZSArIGMpICogZCkKfTsKQzMkanNjb21wJDEwLmFuZ2xlTGVycENsb2Nrd2lzZSA9IGZ1bmN0aW9uKGEsIGIsIGQsIGMgPSAwKSB7CiAgICBjb25zdCBlID0gQzMkanNjb21wJDEwLmFuZ2xlRGlmZihhLCBiKTsKICAgIGMgKj0gVFdPX1BJOwogICAgcmV0dXJuIEMzJGpzY29tcCQxMC5hbmdsZUNsb2Nrd2lzZShiLCBhKSA/IEMzJGpzY29tcCQxMC5jbGFtcEFuZ2xlKGEgKyAoZSArIGMpICogZCkgOiBDMyRqc2NvbXAkMTAuY2xhbXBBbmdsZSgoVFdPX1BJIC0gZSArIGMpICogZCkKfTsKQzMkanNjb21wJDEwLmFuZ2xlTGVycEFudGlDbG9ja3dpc2UgPSBmdW5jdGlvbihhLCBiLCBkLCBjID0gMCkgewogICAgY29uc3QgZSA9IEMzJGpzY29tcCQxMC5hbmdsZURpZmYoYSwgYik7CiAgICBjICo9IFRXT19QSTsKICAgIHJldHVybiBDMyRqc2NvbXAkMTAuYW5nbGVDbG9ja3dpc2UoYiwgYSkgPyBDMyRqc2NvbXAkMTAuY2xhbXBBbmdsZSgoLVRXT19QSSArIGUgLSBjKSAqIGQpIDogQzMkanNjb21wJDEwLmNsYW1wQW5nbGUoYSAtIChlICsgYykgKiBkKQp9OwpDMyRqc2NvbXAkMTAubGVycCA9IGZ1bmN0aW9uKGEsIGIsIGQpIHsKICAgIHJldHVybiBhICsgZCAqIChiIC0gYSkKfTsKQzMkanNjb21wJDEwLnVubGVycCA9IGZ1bmN0aW9uKGEsIGIsIGQpIHsKICAgIHJldHVybiBhID09PSBiID8gMCA6IChkIC0gYSkgLyAoYiAtIGEpCn07CkMzJGpzY29tcCQxMC5yZWxlcnAgPSBmdW5jdGlvbihhLCBiLCBkLCBjLCBlKSB7CiAgICByZXR1cm4gQzMkanNjb21wJDEwLmxlcnAoYywgZSwgQzMkanNjb21wJDEwLnVubGVycChhLCBiLCBkKSkKfTsKQzMkanNjb21wJDEwLnFhcnAgPSBmdW5jdGlvbihhLCBiLCBkLCBjKSB7CiAgICByZXR1cm4gQzMkanNjb21wJDEwLmxlcnAoQzMkanNjb21wJDEwLmxlcnAoYSwgYiwgYyksIEMzJGpzY29tcCQxMC5sZXJwKGIsIGQsIGMpLCBjKQp9OwpDMyRqc2NvbXAkMTAuY3ViaWMgPSBmdW5jdGlvbihhLCBiLCBkLCBjLCBlKSB7CiAgICByZXR1cm4gQzMkanNjb21wJDEwLmxlcnAoQzMkanNjb21wJDEwLnFhcnAoYSwgYiwgZCwgZSksIEMzJGpzY29tcCQxMC5xYXJwKGIsIGQsIGMsIGUpLCBlKQp9OwpDMyRqc2NvbXAkMTAuY29zcCA9IGZ1bmN0aW9uKGEsIGIsIGQpIHsKICAgIHJldHVybiAoYSArIGIgKyAoYSAtIGIpICogTWF0aC5jb3MoZCAqIE1hdGguUEkpKSAvIDIKfTsKQzMkanNjb21wJDEwLmlzUE9UID0gZnVuY3Rpb24oYSkgewogICAgcmV0dXJuIDAgPCBhICYmIDAgPT09IChhIC0gMSAmIGEpCn07CkMzJGpzY29tcCQxMC5uZXh0SGlnaGVzdFBvd2VyT2ZUd28gPSBmdW5jdGlvbihhKSB7CiAgICAtLWE7CiAgICBmb3IgKGxldCBiID0gMTsgMzIgPiBiOyBiIDw8PSAxKSBhIHw9IGEgPj4gYjsKICAgIHJldHVybiBhICsgMQp9OwpDMyRqc2NvbXAkMTAucm91bmRUb05lYXJlc3RGcmFjdGlvbiA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgIHJldHVybiBNYXRoLnJvdW5kKGEgKiBiKSAvIGIKfTsKQzMkanNjb21wJDEwLmZsb29yVG9OZWFyZXN0RnJhY3Rpb24gPSBmdW5jdGlvbihhLCBiKSB7CiAgICByZXR1cm4gTWF0aC5mbG9vcihhICogYikgLyBiCn07CkMzJGpzY29tcCQxMC5yb3VuZDZkcCA9IGZ1bmN0aW9uKGEpIHsKICAgIHJldHVybiBNYXRoLnJvdW5kKDFFNiAqIGEpIC8gMUU2Cn07CkMzJGpzY29tcCQxMC50b0ZpeGVkID0gZnVuY3Rpb24oYSwgYikgewogICAgYSA9IGEudG9GaXhlZChiKTsKICAgIGZvciAoYiA9IGEubGVuZ3RoIC0gMTsgMCA8PSBiICYmICIwIiA9PT0gYS5jaGFyQXQoYik7IC0tYik7CiAgICAwIDw9IGIgJiYgIi4iID09PSBhLmNoYXJBdChiKSAmJiAtLWI7CiAgICByZXR1cm4gMCA+IGIgPyBhIDogYS5zdWJzdHIoMCwgYiArIDEpCn07CkMzJGpzY29tcCQxMC5QYWNrUkdCID0gZnVuY3Rpb24oYSwgYiwgZCkgewogICAgcmV0dXJuIEMzJGpzY29tcCQxMC5jbGFtcChhLCAwLCAyNTUpIHwgQzMkanNjb21wJDEwLmNsYW1wKGIsIDAsIDI1NSkgPDwgOCB8IEMzJGpzY29tcCQxMC5jbGFtcChkLCAwLCAyNTUpIDw8IDE2Cn07CmNvbnN0IEFMUEhBRVhfU0hJRlQgPSAxMDI0OwpDMyRqc2NvbXAkMTAuUGFja1JHQkFFeCA9IGZ1bmN0aW9uKGEsIGIsIGQsIGMpIHsKICAgIGEgPSBDMyRqc2NvbXAkMTAuY2xhbXAoTWF0aC5mbG9vcigxMDI0ICogYSksIC04MTkyLCA4MTkxKTsKICAgIGIgPSBDMyRqc2NvbXAkMTAuY2xhbXAoTWF0aC5mbG9vcigxMDI0ICogYiksIC04MTkyLCA4MTkxKTsKICAgIGQgPSBDMyRqc2NvbXAkMTAuY2xhbXAoTWF0aC5mbG9vcigxMDI0ICogZCksIC04MTkyLCA4MTkxKTsKICAgIGMgPSBDMyRqc2NvbXAkMTAuY2xhbXAoTWF0aC5mbG9vcigxMDIzICogYyksIDAsIDEwMjMpOwogICAgMCA+IGEgJiYgKGEgKz0gMTYzODQpOwogICAgMCA+IGIgJiYgKGIgKz0gMTYzODQpOwogICAgMCA+IGQgJiYgKGQgKz0gMTYzODQpOwogICAgcmV0dXJuIC0oMjY4NDM1NDU2ICogYSAqIEFMUEhBRVhfU0hJRlQgKyAxNjM4NCAqIGIgKiBBTFBIQUVYX1NISUZUICsgZCAqIEFMUEhBRVhfU0hJRlQgKyBjKQp9OwpDMyRqc2NvbXAkMTAuUGFja1JHQkV4ID0gZnVuY3Rpb24oYSwgYiwgZCkgewogICAgcmV0dXJuIEMzJGpzY29tcCQxMC5QYWNrUkdCQUV4KGEsIGIsIGQsIDEpCn07CgpmdW5jdGlvbiBpc05lZ2F0aXZlWmVybyhhKSB7CiAgICByZXR1cm4gMCA9PT0gYSAmJiAwID4gMSAvIGEKfQpDMyRqc2NvbXAkMTAuR2V0UlZhbHVlID0gZnVuY3Rpb24oYSkgewogICAgaWYgKDAgPD0gYSkgcmV0dXJuIChhICYgMjU1KSAvIDI1NTsKICAgIGEgPSBNYXRoLmZsb29yKC1hIC8gKDI2ODQzNTQ1NiAqIEFMUEhBRVhfU0hJRlQpKTsKICAgIDgxOTEgPCBhICYmIChhIC09IDE2Mzg0KTsKICAgIHJldHVybiBhIC8gMTAyNAp9OwpDMyRqc2NvbXAkMTAuR2V0R1ZhbHVlID0gZnVuY3Rpb24oYSkgewogICAgaWYgKDAgPD0gYSkgcmV0dXJuICgoYSAmIDY1MjgwKSA+PiA4KSAvIDI1NTsKICAgIGEgPSBNYXRoLmZsb29yKC1hICUgKDI2ODQzNTQ1NiAqIEFMUEhBRVhfU0hJRlQpIC8gKDE2Mzg0ICogQUxQSEFFWF9TSElGVCkpOwogICAgODE5MSA8IGEgJiYgKGEgLT0gMTYzODQpOwogICAgcmV0dXJuIGEgLyAxMDI0Cn07CkMzJGpzY29tcCQxMC5HZXRCVmFsdWUgPSBmdW5jdGlvbihhKSB7CiAgICBpZiAoMCA8PSBhKSByZXR1cm4gKChhICYgMTY3MTE2ODApID4+IDE2KSAvIDI1NTsKICAgIGEgPSBNYXRoLmZsb29yKC1hICUgKDE2Mzg0ICogQUxQSEFFWF9TSElGVCkgLyBBTFBIQUVYX1NISUZUKTsKICAgIDgxOTEgPCBhICYmIChhIC09IDE2Mzg0KTsKICAgIHJldHVybiBhIC8gMTAyNAp9OwpDMyRqc2NvbXAkMTAuR2V0QVZhbHVlID0gZnVuY3Rpb24oYSkgewogICAgcmV0dXJuIGlzTmVnYXRpdmVaZXJvKGEpID8gMCA6IDAgPD0gYSA/IDEgOiBNYXRoLmZsb29yKC1hICUgQUxQSEFFWF9TSElGVCkgLyAxMDIzCn07CkMzJGpzY29tcCQxMC5ncmVhdGVzdENvbW1vbkRpdmlzb3IgPSBmdW5jdGlvbihhLCBiKSB7CiAgICBhID0gTWF0aC5mbG9vcihhKTsKICAgIGZvciAoYiA9IE1hdGguZmxvb3IoYik7IDAgIT09IGI7KSB7CiAgICAgICAgbGV0IGQgPSBiOwogICAgICAgIGIgPSBhICUgYjsKICAgICAgICBhID0gZAogICAgfQogICAgcmV0dXJuIGEKfTsKY29uc3QgQ09NTU9OX0FTUEVDVF9SQVRJT1MgPSBbCiAgICBbMywgMl0sCiAgICBbNCwgM10sCiAgICBbNSwgNF0sCiAgICBbNSwgM10sCiAgICBbNiwgNV0sCiAgICBbMTQsIDldLAogICAgWzE2LCA5XSwKICAgIFsxNiwgMTBdLAogICAgWzIxLCA5XQpdOwpDMyRqc2NvbXAkMTAuZ2V0QXNwZWN0UmF0aW8gPSBmdW5jdGlvbihhLCBiKSB7CiAgICBhID0gTWF0aC5mbG9vcihhKTsKICAgIGIgPSBNYXRoLmZsb29yKGIpOwogICAgaWYgKGEgPT09IGIpIHJldHVybiBbMSwgMV07CiAgICBmb3IgKHZhciBkIG9mIENPTU1PTl9BU1BFQ1RfUkFUSU9TKSB7CiAgICAgICAgbGV0IGMgPSBhIC8gZFswXSAqIGRbMV07CiAgICAgICAgaWYgKDEgPiBNYXRoLmFicyhiIC0gYykpIHJldHVybiBkLnNsaWNlKDApOwogICAgICAgIGMgPSBhIC8gZFsxXSAqIGRbMF07CiAgICAgICAgaWYgKDEgPiBNYXRoLmFicyhiIC0gYykpIHJldHVybiBbZFsxXSwgZFswXV0KICAgIH0KICAgIGQgPSBDMyRqc2NvbXAkMTAuZ3JlYXRlc3RDb21tb25EaXZpc29yKGEsIGIpOwogICAgcmV0dXJuIFthIC8gZCwgYiAvIGRdCn07CkMzJGpzY29tcCQxMC5zZWdtZW50c0ludGVyc2VjdCA9IGZ1bmN0aW9uKGEsIGIsIGQsIGMsIGUsIGcsIGssIG0pIHsKICAgIHZhciBuID0gTWF0aC5taW4oYSwgZCksCiAgICAgICAgcSA9IE1hdGgubWF4KGUsIGspOwogICAgaWYgKE1hdGgubWF4KGEsIGQpIDwgTWF0aC5taW4oZSwgaykgfHwgbiA+IHEpIHJldHVybiAhMTsKICAgIG4gPSBNYXRoLm1pbihiLCBjKTsKICAgIHEgPSBNYXRoLm1heChnLCBtKTsKICAgIGlmIChNYXRoLm1heChiLCBjKSA8IE1hdGgubWluKGcsIG0pIHx8IG4gPiBxKSByZXR1cm4gITE7CiAgICBuID0gZSAtIGEgKyBrIC0gZDsKICAgIHEgPSBnIC0gYiArIG0gLSBjOwogICAgYSA9IGQgLSBhOwogICAgYiA9IGMgLSBiOwogICAgZSA9IGsgLSBlOwogICAgZyA9IG0gLSBnOwogICAgbSA9IE1hdGguYWJzKGIgKiBlIC0gZyAqIGEpOwogICAgcmV0dXJuIE1hdGguYWJzKGUgKiBxIC0gZyAqIG4pID4gbSA/ICExIDogTWF0aC5hYnMoYSAqIHEgLSBiICogbikgPD0gbQp9OwpDMyRqc2NvbXAkMTAuc2VnbWVudHNJbnRlcnNlY3RQcmVDYWxjID0gZnVuY3Rpb24oYSwgYiwgZCwgYywgZSwgZywgaywgbSwgbiwgcSwgdSwgdykgewogICAgY29uc3QgeiA9IE1hdGgubWF4KG4sIHUpOwogICAgaWYgKGcgPCBNYXRoLm1pbihuLCB1KSB8fCBlID4geikgcmV0dXJuICExOwogICAgZSA9IE1hdGgubWF4KHEsIHcpOwogICAgaWYgKG0gPCBNYXRoLm1pbihxLCB3KSB8fCBrID4gZSkgcmV0dXJuICExOwogICAgayA9IG4gLSBhICsgdSAtIGQ7CiAgICBtID0gcSAtIGIgKyB3IC0gYzsKICAgIGEgPSBkIC0gYTsKICAgIGIgPSBjIC0gYjsKICAgIG4gPSB1IC0gbjsKICAgIHEgPSB3IC0gcTsKICAgIHcgPSBNYXRoLmFicyhiICogbiAtIHEgKiBhKTsKICAgIHJldHVybiBNYXRoLmFicyhuICogbSAtIHEgKiBrKSA+IHcgPyAhMSA6IE1hdGguYWJzKGEgKiBtIC0gYiAqIGspIDw9IHcKfTsKQzMkanNjb21wJDEwLnNlZ21lbnRJbnRlcnNlY3RzUXVhZCA9IGZ1bmN0aW9uKGEsIGIsIGQsIGMsIGUpIHsKICAgIGNvbnN0IGcgPSBNYXRoLm1pbihhLCBkKSwKICAgICAgICBrID0gTWF0aC5tYXgoYSwgZCksCiAgICAgICAgbSA9IE1hdGgubWluKGIsIGMpLAogICAgICAgIG4gPSBNYXRoLm1heChiLCBjKSwKICAgICAgICBxID0gZS5nZXRUbHgoKSwKICAgICAgICB1ID0gZS5nZXRUbHkoKSwKICAgICAgICB3ID0gZS5nZXRUcngoKSwKICAgICAgICB6ID0gZS5nZXRUcnkoKSwKICAgICAgICBDID0gZS5nZXRCcngoKSwKICAgICAgICBEID0gZS5nZXRCcnkoKSwKICAgICAgICBGID0gZS5nZXRCbHgoKTsKICAgIGUgPSBlLmdldEJseSgpOwogICAgcmV0dXJuIEMzJGpzY29tcCQxMC5zZWdtZW50c0ludGVyc2VjdFByZUNhbGMoYSwgYiwgZCwgYywgZywgaywgbSwgbiwgcSwgdSwgdywgeikgfHwgQzMkanNjb21wJDEwLnNlZ21lbnRzSW50ZXJzZWN0UHJlQ2FsYyhhLCBiLCBkLCBjLCBnLCBrLCBtLCBuLCB3LCB6LCBDLCBEKSB8fCBDMyRqc2NvbXAkMTAuc2VnbWVudHNJbnRlcnNlY3RQcmVDYWxjKGEsIGIsIGQsIGMsIGcsIGssIG0sIG4sIEMsIEQsIEYsIGUpIHx8IEMzJGpzY29tcCQxMC5zZWdtZW50c0ludGVyc2VjdFByZUNhbGMoYSwgYiwgZCwgYywgZywgaywgbSwgbiwgRiwgZSwgcSwgdSkKfTsKQzMkanNjb21wJDEwLnNlZ21lbnRJbnRlcnNlY3RzQW55TiA9IGZ1bmN0aW9uKGEsIGIsIGQsIGMsIGUpIHsKICAgIGNvbnN0IGcgPSBNYXRoLm1pbihhLCBkKSwKICAgICAgICBrID0gTWF0aC5tYXgoYSwgZCksCiAgICAgICAgbSA9IE1hdGgubWluKGIsIGMpLAogICAgICAgIG4gPSBNYXRoLm1heChiLCBjKTsKICAgIGxldCBxID0gMDsKICAgIGZvciAobGV0IHUgPSBlLmxlbmd0aCAtIDQ7IHEgPD0gdTsgcSArPSAyKQogICAgICAgIGlmIChDMyRqc2NvbXAkMTAuc2VnbWVudHNJbnRlcnNlY3RQcmVDYWxjKGEsIGIsIGQsIGMsIGcsIGssIG0sIG4sIGVbcV0sIGVbcSArIDFdLCBlW3EgKyAyXSwgZVtxICsgM10pKSByZXR1cm4gITA7CiAgICByZXR1cm4gQzMkanNjb21wJDEwLnNlZ21lbnRzSW50ZXJzZWN0UHJlQ2FsYyhhLCBiLCBkLCBjLCBnLCBrLCBtLCBuLCBlW3FdLCBlW3EgKyAxXSwgZVswXSwgZVsxXSkKfTsKQzMkanNjb21wJDEwLnJheUludGVyc2VjdCA9IGZ1bmN0aW9uKGEsIGIsIGQsIGMsIGUsIGcsIGssIG0pIHsKICAgIGQgLT0gYTsKICAgIGcgPSBtIC0gZzsKICAgIGNvbnN0IG4gPSBkICogZyAtIChjIC0gYikgKiAoayAtIGUpOwogICAgaWYgKDAgPT09IG4pIHJldHVybiAyOwogICAgYyA9ICgoYiAtIGMpICogKGsgLSBhKSArIGQgKiAobSAtIGIpKSAvIG47CiAgICByZXR1cm4gMCA8IGMgJiYgMS4wMDAwMDEgPiBjID8gKGcgKiAoayAtIGEpICsgKGUgLSBrKSAqIChtIC0gYikpIC8gbiA6IDIKfTsKQzMkanNjb21wJDEwLnJheUludGVyc2VjdEV4dGVuZGVkID0gZnVuY3Rpb24oYSwgYiwgZCwgYywgZSwgZywgaywgbSwgbikgewogICAgY29uc3QgcSA9IChrIC0gZSkgKiBuOwogICAgbiAqPSBtIC0gZzsKICAgIHJldHVybiBDMyRqc2NvbXAkMTAucmF5SW50ZXJzZWN0KGEsIGIsIGQsIGMsIGUgLSBxLCBnIC0gbiwgayArIHEsIG0gKyBuKQp9OwpDMyRqc2NvbXAkMTAuaXNQb2ludEluVHJpYW5nbGVJbmNsdXNpdmUgPSBmdW5jdGlvbihhLCBiLCBkLCBjLCBlLCBnLCBrLCBtKSB7CiAgICBlIC09IGQ7CiAgICBnIC09IGM7CiAgICBrIC09IGQ7CiAgICBtIC09IGM7CiAgICBhIC09IGQ7CiAgICBkID0gYiAtIGM7CiAgICBiID0gZSAqIGUgKyBnICogZzsKICAgIGMgPSBlICogayArIGcgKiBtOwogICAgZSA9IGUgKiBhICsgZyAqIGQ7CiAgICBnID0gayAqIGsgKyBtICogbTsKICAgIGsgPSBrICogYSArIG0gKiBkOwogICAgbSA9IDEgLyAoYiAqIGcgLSBjICogYyk7CiAgICBnID0gKGcgKiBlIC0gYyAqIGspICogbTsKICAgIGUgPSAoYiAqIGsgLSBjICogZSkgKiBtOwogICAgcmV0dXJuIDAgPD0gZyAmJiAwIDw9IGUgJiYgMSA+PSBnICsgZQp9OwpDMyRqc2NvbXAkMTAudHJpYW5nbGVDYXJ0ZXNpYW5Ub0JhcnljZW50cmljID0gZnVuY3Rpb24oYSwgYiwgZCwgYywgZSwgZywgaywgbSkgewogICAgZSAtPSBkOwogICAgZyAtPSBjOwogICAgayAtPSBkOwogICAgbSAtPSBjOwogICAgYSAtPSBkOwogICAgY29uc3QgbiA9IGIgLSBjOwogICAgYiA9IGUgKiBlICsgZyAqIGc7CiAgICBjID0gZSAqIGsgKyBnICogbTsKICAgIGQgPSBrICogayArIG0gKiBtOwogICAgZSA9IGEgKiBlICsgbiAqIGc7CiAgICBnID0gYSAqIGsgKyBuICogbTsKICAgIGsgPSBiICogZCAtIGMgKiBjOwogICAgbSA9IChkICogZSAtIGMgKiBnKSAvIGs7CiAgICBlID0gKGIgKiBnIC0gYyAqIGUpIC8gazsKICAgIHJldHVybiBbMSAtIG0gLSBlLCBtLCBlXQp9OwpDMyRqc2NvbXAkMTAudHJpYW5nbGVCYXJ5Y2VudHJpY1RvQ2FydGVzaWFuID0gZnVuY3Rpb24oYSwgYiwgZCwgYywgZSwgZywgaywgbSwgbikgewogICAgcmV0dXJuIFthICogYyArIGIgKiBnICsgZCAqIG0sIGEgKiBlICsgYiAqIGsgKyBkICogbl0KfTsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkMTEgPSBzZWxmLkMzOwpsZXQgbWFpbkRvY3VtZW50ID0gbnVsbCwKICAgIGJhc2VIcmVmID0gIiI7CmlmICgidW5kZWZpbmVkIiAhPT0gdHlwZW9mIGRvY3VtZW50KSB7CiAgICBtYWluRG9jdW1lbnQgPSBkb2N1bWVudDsKICAgIGNvbnN0IGEgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJiYXNlIik7CiAgICBpZiAoYmFzZUhyZWYgPSBhICYmIGEuaGFzQXR0cmlidXRlKCJocmVmIikgPyBhLmdldEF0dHJpYnV0ZSgiaHJlZiIpIDogIiIpIGJhc2VIcmVmLnN0YXJ0c1dpdGgoIi8iKSAmJiAoYmFzZUhyZWYgPSBiYXNlSHJlZi5zdWJzdHIoMSkpLCBiYXNlSHJlZi5lbmRzV2l0aCgiLyIpIHx8IChiYXNlSHJlZiArPSAiLyIpCn0KQzMkanNjb21wJDExLkdldEJhc2VIcmVmID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gYmFzZUhyZWYKfTsKQzMkanNjb21wJDExLkdldEJhc2VVUkwgPSBmdW5jdGlvbigpIHsKICAgIGlmICghbWFpbkRvY3VtZW50KSByZXR1cm4gIiI7CiAgICBjb25zdCBhID0gbWFpbkRvY3VtZW50LmxvY2F0aW9uOwogICAgcmV0dXJuIEMzJGpzY29tcCQxMS5HZXRQYXRoRnJvbVVSTChhLm9yaWdpbiArIGEucGF0aG5hbWUpICsgYmFzZUhyZWYKfTsKQzMkanNjb21wJDExLkdldFBhdGhGcm9tVVJMID0gZnVuY3Rpb24oYSkgewogICAgaWYgKCFhLmxlbmd0aCB8fCBhLmVuZHNXaXRoKCIvIikgfHwgYS5lbmRzV2l0aCgiXFwiKSkgcmV0dXJuIGE7CiAgICBjb25zdCBiID0gTWF0aC5tYXgoYS5sYXN0SW5kZXhPZigiLyIpLCBhLmxhc3RJbmRleE9mKCJcXCIpKTsKICAgIHJldHVybiAtMSA9PT0gYiA/ICIiIDogYS5zdWJzdHIoMCwgYiArIDEpCn07CkMzJGpzY29tcCQxMS5HZXRGaWxlbmFtZUZyb21VUkwgPSBmdW5jdGlvbihhKSB7CiAgICBpZiAoIWEubGVuZ3RoKSByZXR1cm4gYTsKICAgIGlmIChhLmVuZHNXaXRoKCIvIikgfHwgYS5lbmRzV2l0aCgiXFwiKSkgcmV0dXJuICIiOwogICAgY29uc3QgYiA9IE1hdGgubWF4KGEubGFzdEluZGV4T2YoIi8iKSwgYS5sYXN0SW5kZXhPZigiXFwiKSk7CiAgICByZXR1cm4gLTEgPT09IGIgPyBhIDogYS5zdWJzdHIoYiArIDEpCn07CkMzJGpzY29tcCQxMS5HZXRGaWxlRXh0ZW5zaW9uID0gZnVuY3Rpb24oYSkgewogICAgbGV0IGIgPSBhLmxhc3RJbmRleE9mKCIuIik7CiAgICByZXR1cm4gMSA+IGIgPyAiIiA6IGEuc3Vic3RyKGIpCn07CkMzJGpzY29tcCQxMS5TZXRGaWxlRXh0ZW5zaW9uID0gZnVuY3Rpb24oYSwgYikgewogICAgY29uc3QgZCA9IGEubGFzdEluZGV4T2YoIi4iKTsKICAgIHJldHVybiAtMSA9PT0gZCA/IGEgKyAiLiIgKyBiIDogYS5zdWJzdHIoMCwgZCArIDEpICsgYgp9OwpDMyRqc2NvbXAkMTEuR2V0RmlsZU5hbWVQYXJ0ID0gZnVuY3Rpb24oYSkgewogICAgbGV0IGIgPSBhLmxhc3RJbmRleE9mKCIuIik7CiAgICByZXR1cm4gMSA+IGIgPyBhIDogYS5zdWJzdHIoMCwgYikKfTsKQzMkanNjb21wJDExLk5vcm1hbGl6ZUZpbGVTZXBhcmF0b3IgPSBmdW5jdGlvbihhKSB7CiAgICByZXR1cm4gYS5yZXBsYWNlKC9cXC9nLCAiLyIpCn07CkMzJGpzY29tcCQxMS5Jc0ZpbGVFeHRlbnNpb24gPSBmdW5jdGlvbihhLCBiKSB7CiAgICBhID0gYSA/IEMzJGpzY29tcCQxMS5HZXRGaWxlRXh0ZW5zaW9uKGEpLnNsaWNlKDEpIDogIiI7CiAgICByZXR1cm4gYiA9PT0gYQp9OwpDMyRqc2NvbXAkMTEuRmlsZU5hbWVFcXVhbHMgPSBmdW5jdGlvbihhLCBiKSB7CiAgICBsZXQgZCwgYzsKICAgIEMzJGpzY29tcCQxMS5Jc0ZpbGVMaWtlKGEpICYmIChkID0gQzMkanNjb21wJDExLkdldEZpbGVOYW1lUGFydChhLm5hbWUpKTsKICAgIEMzJGpzY29tcCQxMS5Jc1N0cmluZyhhKSAmJiAoZCA9IEMzJGpzY29tcCQxMS5HZXRGaWxlTmFtZVBhcnQoYSkpOwogICAgQzMkanNjb21wJDExLklzRmlsZUxpa2UoYikgJiYgKGMgPSBDMyRqc2NvbXAkMTEuR2V0RmlsZU5hbWVQYXJ0KGIubmFtZSkpOwogICAgQzMkanNjb21wJDExLklzU3RyaW5nKGIpICYmIChjID0gQzMkanNjb21wJDExLkdldEZpbGVOYW1lUGFydChiKSk7CiAgICByZXR1cm4gZCA9PT0gYwp9OwpDMyRqc2NvbXAkMTEuUGFyc2VGaWxlUGF0aCA9IGZ1bmN0aW9uKGEpIHsKICAgIGEgPSBDMyRqc2NvbXAkMTEuTm9ybWFsaXplRmlsZVNlcGFyYXRvcihhKTsKICAgIGxldCBiID0gL15cdzpcLy8uZXhlYyhhKTsKICAgIGIgPyAoYiA9IGJbMF0sIGEgPSBhLnNsaWNlKDMpLCAiLyIgIT09IGFbMF0gJiYgKGEgPSAiLyIgKyBhKSkgOiBiID0gIiI7CiAgICBhID0gYS5yZXBsYWNlKC9cL3syLH0vZywgIi8iKTsKICAgIDEgPCBhLmxlbmd0aCAmJiAiLyIgPT09IGEuc2xpY2UoLTEpICYmIChhID0gYS5zbGljZSgwLCAtMSkpOwogICAgdmFyIGQgPSBhLmxhc3RJbmRleE9mKCIvIikgKyAxOwogICAgbGV0IGMgPSAiIiwKICAgICAgICBlID0gYSwKICAgICAgICBnID0gIiI7CiAgICAwIDwgZCAmJiAoYyA9IGEuc2xpY2UoMCwgZCksIGUgPSBhLnNsaWNlKGQpKTsKICAgIGEgPSBlOwogICAgZCA9IGUubGFzdEluZGV4T2YoIi4iKTsKICAgIDAgPCBkICYmIChnID0gZS5zbGljZShkKSwgYSA9IGUuc2xpY2UoMCwgLWcubGVuZ3RoKSk7CiAgICByZXR1cm4gewogICAgICAgIGRpcjogYywKICAgICAgICBiYXNlOiBlLAogICAgICAgIG5hbWU6IGEsCiAgICAgICAgcm9vdDogYiwKICAgICAgICBleHQ6IGcsCiAgICAgICAgZnVsbDogYiArIGMgKyBlCiAgICB9Cn07CkMzJGpzY29tcCQxMS5XYWl0ID0gZnVuY3Rpb24oYSwgYikgewogICAgcmV0dXJuIG5ldyBQcm9taXNlKChkLCBjKSA9PiB7CiAgICAgICAgc2VsZi5zZXRUaW1lb3V0KGQsIGEsIGIpCiAgICB9KQp9OwpDMyRqc2NvbXAkMTEuc3dhbGxvd0V4Y2VwdGlvbiA9IGZ1bmN0aW9uKGEpIHsKICAgIHRyeSB7CiAgICAgICAgYSgpCiAgICB9IGNhdGNoIChiKSB7CiAgICAgICAgQzMkanNjb21wJDExLmlzRGVidWcgJiYgY29uc29sZS53YXJuKCJTd2FsbG93ZWQgZXhjZXB0aW9uOiAiLCBiKQogICAgfQp9OwpDMyRqc2NvbXAkMTEubm9vcCA9IGZ1bmN0aW9uKCkge307CkMzJGpzY29tcCQxMS5lcXVhbHNOb0Nhc2UgPSBmdW5jdGlvbihhLCBiKSB7CiAgICByZXR1cm4gInN0cmluZyIgIT09IHR5cGVvZiBhIHx8ICJzdHJpbmciICE9PSB0eXBlb2YgYiA/ICExIDogYSA9PT0gYiB8fCBhLm5vcm1hbGl6ZSgpLnRvTG93ZXJDYXNlKCkgPT09IGIubm9ybWFsaXplKCkudG9Mb3dlckNhc2UoKQp9OwpDMyRqc2NvbXAkMTEuZXF1YWxzQ2FzZSA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgIHJldHVybiAic3RyaW5nIiAhPT0gdHlwZW9mIGEgfHwgInN0cmluZyIgIT09IHR5cGVvZiBiID8gITEgOiBhID09PSBiID8gITAgOiBhLm5vcm1hbGl6ZSgpID09PSBiLm5vcm1hbGl6ZSgpCn07CkMzJGpzY29tcCQxMS50eXBlZEFycmF5U2V0MTYgPSBmdW5jdGlvbihhLCBiLCBkKSB7CiAgICBhW2QrK10gPSBiWzBdOwogICAgYVtkKytdID0gYlsxXTsKICAgIGFbZCsrXSA9IGJbMl07CiAgICBhW2QrK10gPSBiWzNdOwogICAgYVtkKytdID0gYls0XTsKICAgIGFbZCsrXSA9IGJbNV07CiAgICBhW2QrK10gPSBiWzZdOwogICAgYVtkKytdID0gYls3XTsKICAgIGFbZCsrXSA9IGJbOF07CiAgICBhW2QrK10gPSBiWzldOwogICAgYVtkKytdID0gYlsxMF07CiAgICBhW2QrK10gPSBiWzExXTsKICAgIGFbZCsrXSA9IGJbMTJdOwogICAgYVtkKytdID0gYlsxM107CiAgICBhW2QrK10gPSBiWzE0XTsKICAgIGFbZF0gPSBiWzE1XQp9OwpDMyRqc2NvbXAkMTEudHJ1bmNhdGVBcnJheSA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgIGEubGVuZ3RoID0gYgp9OwpDMyRqc2NvbXAkMTEuY2xlYXJBcnJheSA9IGZ1bmN0aW9uKGEpIHsKICAgIGEgJiYgMCAhPT0gYS5sZW5ndGggJiYgQzMkanNjb21wJDExLnRydW5jYXRlQXJyYXkoYSwgMCkKfTsKQzMkanNjb21wJDExLmNsZWFyMkRBcnJheSA9IGZ1bmN0aW9uKGEpIHsKICAgIGlmIChhKSB7CiAgICAgICAgZm9yIChsZXQgYiA9IDA7IGIgPCBhLmxlbmd0aDsgYisrKSBDMyRqc2NvbXAkMTEudHJ1bmNhdGVBcnJheShhW2JdLCAwKTsKICAgICAgICBDMyRqc2NvbXAkMTEudHJ1bmNhdGVBcnJheShhLCAwKQogICAgfQp9OwpDMyRqc2NvbXAkMTEuZXh0ZW5kQXJyYXkgPSBmdW5jdGlvbihhLCBiLCBkKSB7CiAgICBiIHw9IDA7CiAgICB2YXIgYyA9IGEubGVuZ3RoOwogICAgaWYgKCEoYiA8PSBjKSkKICAgICAgICBmb3IgKDsgYyA8IGI7ICsrYykgYS5wdXNoKGQpCn07CkMzJGpzY29tcCQxMS5yZXNpemVBcnJheSA9IGZ1bmN0aW9uKGEsIGIsIGQpIHsKICAgIGIgfD0gMDsKICAgIGNvbnN0IGMgPSBhLmxlbmd0aDsKICAgIGIgPCBjID8gQzMkanNjb21wJDExLnRydW5jYXRlQXJyYXkoYSwgYikgOiBiID4gYyAmJiBDMyRqc2NvbXAkMTEuZXh0ZW5kQXJyYXkoYSwgYiwgZCkKfTsKQzMkanNjb21wJDExLnNoYWxsb3dBc3NpZ25BcnJheSA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgIEMzJGpzY29tcCQxMS5jbGVhckFycmF5KGEpOwogICAgQzMkanNjb21wJDExLmFwcGVuZEFycmF5KGEsIGIpCn07CkMzJGpzY29tcCQxMS5hcHBlbmRBcnJheSA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgIGlmICgxRTQgPiBiLmxlbmd0aCkgYS5wdXNoKC4uLmIpOwogICAgZWxzZQogICAgICAgIGZvciAobGV0IGQgPSAwLCBjID0gYi5sZW5ndGg7IGQgPCBjOyArK2QpIGEucHVzaChiW2RdKQp9OwpDMyRqc2NvbXAkMTEuYXJyYXlSZW1vdmUgPSBmdW5jdGlvbihhLCBiKSB7CiAgICBiID0gTWF0aC5mbG9vcihiKTsKICAgIGlmICghKDAgPiBiIHx8IGIgPj0gYS5sZW5ndGgpKSB7CiAgICAgICAgZm9yICh2YXIgZCA9IGEubGVuZ3RoIC0gMTsgYiA8IGQ7ICsrYikgYVtiXSA9IGFbYiArIDFdOwogICAgICAgIEMzJGpzY29tcCQxMS50cnVuY2F0ZUFycmF5KGEsIGQpCiAgICB9Cn07CkMzJGpzY29tcCQxMS5hcnJheUZpbmRSZW1vdmUgPSBmdW5jdGlvbihhLCBiKSB7CiAgICBiID0gYS5pbmRleE9mKGIpOwogICAgMCA8PSBiICYmIGEuc3BsaWNlKGIsIDEpCn07CkMzJGpzY29tcCQxMS5hcnJheXNFcXVhbCA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgIGxldCBkID0gYS5sZW5ndGg7CiAgICBpZiAoYi5sZW5ndGggIT09IGQpIHJldHVybiAhMTsKICAgIGZvciAobGV0IGMgPSAwOyBjIDwgZDsgKytjKQogICAgICAgIGlmIChhW2NdICE9PSBiW2NdKSByZXR1cm4gITE7CiAgICByZXR1cm4gITAKfTsKQzMkanNjb21wJDExLmFycmF5RmlsdGVyT3V0ID0gZnVuY3Rpb24oYSwgYikgewogICAgbGV0IGQgPSBbXSwKICAgICAgICBjID0gMDsKICAgIGZvciAobGV0IGUgPSAwLCBnID0gYS5sZW5ndGg7IGUgPCBnOyArK2UpIHsKICAgICAgICBsZXQgayA9IGFbZV07CiAgICAgICAgYihrKSA/IGQucHVzaChrKSA6IChhW2NdID0gaywgKytjKQogICAgfQogICAgQzMkanNjb21wJDExLnRydW5jYXRlQXJyYXkoYSwgYyk7CiAgICByZXR1cm4gZAp9OwpDMyRqc2NvbXAkMTEuYXJyYXlSZW1vdmVBbGxJblNldCA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgIGNvbnN0IGQgPSBhLmxlbmd0aDsKICAgIGxldCBjID0gMDsKICAgIGZvciAobGV0IGUgPSAwLCBnID0gYS5sZW5ndGg7IGUgPCBnOyArK2UpIHsKICAgICAgICBsZXQgayA9IGFbZV07CiAgICAgICAgYi5oYXMoaykgfHwgKGFbYysrXSA9IGspCiAgICB9CiAgICBDMyRqc2NvbXAkMTEudHJ1bmNhdGVBcnJheShhLCBjKTsKICAgIHJldHVybiBkIC0gYwp9OwpDMyRqc2NvbXAkMTEuaXNBcnJheUluZGV4SW5Cb3VuZHMgPSBmdW5jdGlvbihhLCBiKSB7CiAgICByZXR1cm4gYSAhPT0gTWF0aC5mbG9vcihhKSA/ICExIDogMCA8PSBhICYmIGEgPCBiLmxlbmd0aAp9OwpDMyRqc2NvbXAkMTEudmFsaWRhdGVBcnJheUluZGV4ID0gZnVuY3Rpb24oYSwgYikgewogICAgaWYgKCFDMyRqc2NvbXAkMTEuaXNBcnJheUluZGV4SW5Cb3VuZHMoYSwgYikpIHRocm93IG5ldyBSYW5nZUVycm9yKCJhcnJheSBpbmRleCBvdXQgb2YgYm91bmRzIik7Cn07CkMzJGpzY29tcCQxMS5jbG9uZUFycmF5ID0gZnVuY3Rpb24oYSkgewogICAgcmV0dXJuIGEuc2xpY2UoKQp9OwpDMyRqc2NvbXAkMTEuZGVlcENsb25lQXJyYXkgPSBmdW5jdGlvbihhLCBiKSB7CiAgICBsZXQgZCA9IFtdOwogICAgZm9yIChsZXQgYyBvZiBhKQogICAgICAgIGlmIChDMyRqc2NvbXAkMTEuSXNPYmplY3QoYykpIHsKICAgICAgICAgICAgYSA9IGIoYyk7CiAgICAgICAgICAgIGlmICghYSkgdGhyb3cgRXJyb3IoIm1pc3NpbmcgY2xvbmUiKTsKICAgICAgICAgICAgaWYgKGEuY29uc3RydWN0b3IgIT09IGMuY29uc3RydWN0b3IpIHRocm93IEVycm9yKCJvYmplY3QgaXMgbm90IGEgY2xvbmUiKTsKICAgICAgICAgICAgZC5wdXNoKGEpCiAgICAgICAgfSBlbHNlIEMzJGpzY29tcCQxMS5Jc0FycmF5KGMpID8gZC5wdXNoKEMzJGpzY29tcCQxMS5kZWVwQ2xvbmVBcnJheShjLCBiKSkgOiBkLnB1c2goYyk7CiAgICByZXR1cm4gZAp9OwpDMyRqc2NvbXAkMTEuY2xvbmUyREFycmF5ID0gZnVuY3Rpb24oYSkgewogICAgbGV0IGIgPSBbXTsKICAgIGZvciAobGV0IGQgb2YgYSkgYi5wdXNoKGQuc2xpY2UoKSk7CiAgICByZXR1cm4gYgp9OwpDMyRqc2NvbXAkMTEubWVyZ2VTZXRzID0gZnVuY3Rpb24oYSwgYikgewogICAgcmV0dXJuIG5ldyBTZXQoWy4uLmEsIC4uLmJdKQp9OwpDMyRqc2NvbXAkMTEubWVyZ2VTZXRzSW5QbGFjZSA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgIGZvciAoY29uc3QgZCBvZiBiKSBhLmFkZChkKTsKICAgIHJldHVybiBhCn07CkMzJGpzY29tcCQxMS5maXJzdCA9IGZ1bmN0aW9uKGEpIHsKICAgIGZvciAobGV0IGIgb2YgYSkgcmV0dXJuIGI7CiAgICByZXR1cm4gbnVsbAp9OwpDMyRqc2NvbXAkMTEueG9yID0gZnVuY3Rpb24oYSwgYikgewogICAgcmV0dXJuICFhICE9PSAhYgp9OwpDMyRqc2NvbXAkMTEuY29tcGFyZSA9IGZ1bmN0aW9uKGEsIGIsIGQpIHsKICAgIHN3aXRjaCAoYikgewogICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgcmV0dXJuIGEgPT09IGQ7CiAgICAgICAgY2FzZSAxOgogICAgICAgICAgICByZXR1cm4gYSAhPT0gZDsKICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgIHJldHVybiBhIDwgZDsKICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgIHJldHVybiBhIDw9IGQ7CiAgICAgICAgY2FzZSA0OgogICAgICAgICAgICByZXR1cm4gYSA+IGQ7CiAgICAgICAgY2FzZSA1OgogICAgICAgICAgICByZXR1cm4gYSA+PSBkOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIHJldHVybiAhMQogICAgfQp9OwpDMyRqc2NvbXAkMTEuaGFzQW55T3duUHJvcGVydHkgPSBmdW5jdGlvbihhKSB7CiAgICBmb3IgKGxldCBiIGluIGEpCiAgICAgICAgaWYgKGEuaGFzT3duUHJvcGVydHkoYikpIHJldHVybiAhMDsKICAgIHJldHVybiAhMQp9OwpDMyRqc2NvbXAkMTEuUHJvbWlzZUFsbFdpdGhQcm9ncmVzcyA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgIHJldHVybiBhLmxlbmd0aCA/IG5ldyBQcm9taXNlKChkLCBjKSA9PiB7CiAgICAgICAgY29uc3QgZSA9IFtdOwogICAgICAgIGxldCBnID0gMCwKICAgICAgICAgICAgayA9ICExOwogICAgICAgIGZvciAobGV0IG0gPSAwLCBuID0gYS5sZW5ndGg7IG0gPCBuOyArK20pIGUucHVzaCh2b2lkIDApLCBhW21dLnRoZW4ocSA9PiB7CiAgICAgICAgICAgIGsgfHwgKGVbbV0gPSBxLCArK2csIGcgPT09IGEubGVuZ3RoID8gZChlKSA6IGIoZywgYS5sZW5ndGgpKQogICAgICAgIH0pLmNhdGNoKHEgPT4gewogICAgICAgICAgICBrID0gITA7CiAgICAgICAgICAgIGMocSkKICAgICAgICB9KQogICAgfSkgOiBQcm9taXNlLnJlc29sdmUoW10pCn07CmxldCBtZW1vcnlDYWxsYmFja3MgPSBbXTsKQzMkanNjb21wJDExLkFkZExpYnJhcnlNZW1vcnlDYWxsYmFjayA9IGZ1bmN0aW9uKGEpIHsKICAgIG1lbW9yeUNhbGxiYWNrcy5wdXNoKGEpCn07CkMzJGpzY29tcCQxMS5HZXRFc3RpbWF0ZWRMaWJyYXJ5TWVtb3J5VXNhZ2UgPSBmdW5jdGlvbigpIHsKICAgIGxldCBhID0gMDsKICAgIGZvciAobGV0IGIgb2YgbWVtb3J5Q2FsbGJhY2tzKSB7CiAgICAgICAgbGV0IGQgPSBiKCk7CiAgICAgICAgYSArPSBkCiAgICB9CiAgICByZXR1cm4gTWF0aC5mbG9vcihhKQp9OwpsZXQgbmV4dFRhc2tJZCA9IDE7CmNvbnN0IGFjdGl2ZVRhc2tJZHMgPSBuZXcgTWFwLAogICAgdGFza01lc3NhZ2VDaGFubmVsID0gbmV3IE1lc3NhZ2VDaGFubmVsOwp0YXNrTWVzc2FnZUNoYW5uZWwucG9ydDIub25tZXNzYWdlID0gZnVuY3Rpb24oYSkgewogICAgYSA9IGEuZGF0YTsKICAgIGNvbnN0IGIgPSBhY3RpdmVUYXNrSWRzLmdldChhKTsKICAgIGFjdGl2ZVRhc2tJZHMuZGVsZXRlKGEpOwogICAgYiAmJiBiKHBlcmZvcm1hbmNlLm5vdygpKQp9OwpDMyRqc2NvbXAkMTEuUmVxdWVzdFVubGltaXRlZEFuaW1hdGlvbkZyYW1lID0gZnVuY3Rpb24oYSkgewogICAgY29uc3QgYiA9IG5leHRUYXNrSWQrKzsKICAgIGFjdGl2ZVRhc2tJZHMuc2V0KGIsIGEpOwogICAgdGFza01lc3NhZ2VDaGFubmVsLnBvcnQxLnBvc3RNZXNzYWdlKGIpOwogICAgcmV0dXJuIGIKfTsKQzMkanNjb21wJDExLkNhbmNlbFVubGltaXRlZEFuaW1hdGlvbkZyYW1lID0gZnVuY3Rpb24oYSkgewogICAgYWN0aXZlVGFza0lkcy5kZWxldGUoYSkKfTsKQzMkanNjb21wJDExLlBvc3RUYXNrID0gQzMkanNjb21wJDExLlJlcXVlc3RVbmxpbWl0ZWRBbmltYXRpb25GcmFtZTsKQzMkanNjb21wJDExLldhaXRGb3JOZXh0VGFzayA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIG5ldyBQcm9taXNlKGEgPT4gQzMkanNjb21wJDExLlBvc3RUYXNrKGEpKQp9Owpjb25zdCBhY3RpdmVSUEFGaWRzID0gbmV3IFNldDsKQzMkanNjb21wJDExLlJlcXVlc3RQb3N0QW5pbWF0aW9uRnJhbWUgPSBmdW5jdGlvbihhKSB7CiAgICBjb25zdCBiID0gc2VsZi5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYXN5bmMgZCA9PiB7CiAgICAgICAgYXdhaXQgQzMkanNjb21wJDExLldhaXRGb3JOZXh0VGFzaygpOwogICAgICAgIGFjdGl2ZVJQQUZpZHMuaGFzKGIpICYmIChhY3RpdmVSUEFGaWRzLmRlbGV0ZShiKSwgYShkKSkKICAgIH0pOwogICAgYWN0aXZlUlBBRmlkcy5hZGQoYik7CiAgICByZXR1cm4gYgp9OwpDMyRqc2NvbXAkMTEuQ2FuY2VsUG9zdEFuaW1hdGlvbkZyYW1lID0gZnVuY3Rpb24oYSkgewogICAgYWN0aXZlUlBBRmlkcy5oYXMoYSkgJiYgKHNlbGYuY2FuY2VsQW5pbWF0aW9uRnJhbWUoYSksIGFjdGl2ZVJQQUZpZHMuZGVsZXRlKGEpKQp9OwoidXNlIHN0cmljdCI7CmNvbnN0IEMzJGpzY29tcCQxMiA9IHNlbGYuQzM7CkMzJGpzY29tcCQxMi5Jc0Fic29sdXRlVVJMID0gZnVuY3Rpb24oYSkgewogICAgcmV0dXJuIC9eKD86W2EtelwtXSs6KT9cL1wvLy50ZXN0KGEpIHx8ICJkYXRhOiIgPT09IGEuc3Vic3RyKDAsIDUpIHx8ICJibG9iOiIgPT09IGEuc3Vic3RyKDAsIDUpCn07CkMzJGpzY29tcCQxMi5Jc1JlbGF0aXZlVVJMID0gZnVuY3Rpb24oYSkgewogICAgcmV0dXJuICFDMyRqc2NvbXAkMTIuSXNBYnNvbHV0ZVVSTChhKQp9OwpDMyRqc2NvbXAkMTIuVGhyb3dJZk5vdE9rID0gZnVuY3Rpb24oYSkgewogICAgaWYgKCFhLm9rKSB0aHJvdyBFcnJvcihgZmV0Y2ggJyR7YS51cmx9JyByZXNwb25zZSByZXR1cm5lZCAke2Euc3RhdHVzfSAke2Euc3RhdHVzVGV4dH1gKTsKfTsKQzMkanNjb21wJDEyLkZldGNoT2sgPSBmdW5jdGlvbihhLCBiKSB7CiAgICByZXR1cm4gZmV0Y2goYSwgYikudGhlbihkID0+IHsKICAgICAgICBDMyRqc2NvbXAkMTIuVGhyb3dJZk5vdE9rKGQpOwogICAgICAgIHJldHVybiBkCiAgICB9KQp9OwpDMyRqc2NvbXAkMTIuRmV0Y2hUZXh0ID0gZnVuY3Rpb24oYSkgewogICAgcmV0dXJuIEMzJGpzY29tcCQxMi5GZXRjaE9rKGEpLnRoZW4oYiA9PiBiLnRleHQoKSkKfTsKQzMkanNjb21wJDEyLkZldGNoSnNvbiA9IGZ1bmN0aW9uKGEpIHsKICAgIHJldHVybiBDMyRqc2NvbXAkMTIuRmV0Y2hPayhhKS50aGVuKGIgPT4gYi5qc29uKCkpCn07CkMzJGpzY29tcCQxMi5GZXRjaEJsb2IgPSBmdW5jdGlvbihhKSB7CiAgICByZXR1cm4gQzMkanNjb21wJDEyLkZldGNoT2soYSkudGhlbihiID0+IGIuYmxvYigpKQp9OwpDMyRqc2NvbXAkMTIuRmV0Y2hBcnJheUJ1ZmZlciA9IGZ1bmN0aW9uKGEpIHsKICAgIHJldHVybiBDMyRqc2NvbXAkMTIuRmV0Y2hPayhhKS50aGVuKGIgPT4gYi5hcnJheUJ1ZmZlcigpKQp9OwpDMyRqc2NvbXAkMTIuRmV0Y2hJbWFnZSA9IGZ1bmN0aW9uKGEpIHsKICAgIHJldHVybiBuZXcgUHJvbWlzZSgoYiwgZCkgPT4gewogICAgICAgIGNvbnN0IGMgPSBuZXcgSW1hZ2U7CiAgICAgICAgYy5vbmxvYWQgPSAoKSA9PiBiKGMpOwogICAgICAgIGMub25lcnJvciA9IGUgPT4gZChlKTsKICAgICAgICBjLnNyYyA9IGEKICAgIH0pCn07CkMzJGpzY29tcCQxMi5CbG9iVG9BcnJheUJ1ZmZlciA9IGZ1bmN0aW9uKGEpIHsKICAgIHJldHVybiAiZnVuY3Rpb24iID09PSB0eXBlb2YgYS5hcnJheUJ1ZmZlciA/IGEuYXJyYXlCdWZmZXIoKSA6IG5ldyBQcm9taXNlKChiLCBkKSA9PiB7CiAgICAgICAgY29uc3QgYyA9IG5ldyBGaWxlUmVhZGVyOwogICAgICAgIGMub25sb2FkID0gKCkgPT4gYihjLnJlc3VsdCk7CiAgICAgICAgYy5vbmVycm9yID0gKCkgPT4gZChjLmVycm9yKTsKICAgICAgICBjLnJlYWRBc0FycmF5QnVmZmVyKGEpCiAgICB9KQp9OwpDMyRqc2NvbXAkMTIuQmxvYlRvU3RyaW5nID0gZnVuY3Rpb24oYSkgewogICAgcmV0dXJuICJmdW5jdGlvbiIgPT09IHR5cGVvZiBhLnRleHQgPyBhLnRleHQoKSA6IG5ldyBQcm9taXNlKChiLCBkKSA9PiB7CiAgICAgICAgY29uc3QgYyA9IG5ldyBGaWxlUmVhZGVyOwogICAgICAgIGMub25sb2FkID0gKCkgPT4gYihjLnJlc3VsdCk7CiAgICAgICAgYy5vbmVycm9yID0gKCkgPT4gZChjLmVycm9yKTsKICAgICAgICBjLnJlYWRBc1RleHQoYSkKICAgIH0pCn07CkMzJGpzY29tcCQxMi5CbG9iVG9Kc29uID0gZnVuY3Rpb24oYSkgewogICAgcmV0dXJuIEMzJGpzY29tcCQxMi5CbG9iVG9TdHJpbmcoYSkudGhlbihiID0+IEpTT04ucGFyc2UoYikpCn07CkMzJGpzY29tcCQxMi5CbG9iVG9JbWFnZSA9IGFzeW5jIGZ1bmN0aW9uKGEsIGIpIHsKICAgIGEgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGEpOwogICAgdHJ5IHsKICAgICAgICBjb25zdCBkID0gYXdhaXQgQzMkanNjb21wJDEyLkZldGNoSW1hZ2UoYSk7CiAgICAgICAgVVJMLnJldm9rZU9iamVjdFVSTChhKTsKICAgICAgICBhID0gIiI7CiAgICAgICAgYiAmJiAiZnVuY3Rpb24iID09PSB0eXBlb2YgZC5kZWNvZGUgJiYgYXdhaXQgZC5kZWNvZGUoKTsKICAgICAgICByZXR1cm4gZAogICAgfSBmaW5hbGx5IHsKICAgICAgICBhICYmIFVSTC5yZXZva2VPYmplY3RVUkwoYSkKICAgIH0KfTsKQzMkanNjb21wJDEyLkNyZWF0ZUNhbnZhcyA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgIGlmICgidW5kZWZpbmVkIiAhPT0gdHlwZW9mIGRvY3VtZW50ICYmICJmdW5jdGlvbiIgPT09IHR5cGVvZiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KSB7CiAgICAgICAgY29uc3QgZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImNhbnZhcyIpOwogICAgICAgIGQud2lkdGggPSBhOwogICAgICAgIGQuaGVpZ2h0ID0gYjsKICAgICAgICByZXR1cm4gZAogICAgfQogICAgcmV0dXJuIG5ldyBPZmZzY3JlZW5DYW52YXMoYSwgYikKfTsKQzMkanNjb21wJDEyLkNhbnZhc1RvQmxvYiA9IGZ1bmN0aW9uKGEsIGIsIGQpIHsKICAgICJudW1iZXIiICE9PSB0eXBlb2YgZCAmJiAoZCA9IDEpOwogICAgYiA9IGIgfHwgImltYWdlL3BuZyI7CiAgICBkID0gQzMkanNjb21wJDEyLmNsYW1wKGQsIDAsIDEpOwogICAgaWYgKGEudG9CbG9iKSByZXR1cm4gbmV3IFByb21pc2UoYyA9PiBhLnRvQmxvYihjLCBiLCBkKSk7CiAgICBpZiAoYS5jb252ZXJ0VG9CbG9iKSByZXR1cm4gYS5jb252ZXJ0VG9CbG9iKHsKICAgICAgICB0eXBlOiBiLAogICAgICAgIHF1YWxpdHk6IGQKICAgIH0pOwogICAgdGhyb3cgRXJyb3IoImNvdWxkIG5vdCBjb252ZXJ0IGNhbnZhcyB0byBibG9iIik7Cn07CkMzJGpzY29tcCQxMi5EcmF3YWJsZVRvQmxvYiA9IGZ1bmN0aW9uKGEsIGIsIGQpIHsKICAgIGNvbnN0IGMgPSBDMyRqc2NvbXAkMTIuQ3JlYXRlQ2FudmFzKGEud2lkdGgsIGEuaGVpZ2h0KTsKICAgIGMuZ2V0Q29udGV4dCgiMmQiKS5kcmF3SW1hZ2UoYSwgMCwgMCk7CiAgICByZXR1cm4gQzMkanNjb21wJDEyLkNhbnZhc1RvQmxvYihjLCBiLCBkKQp9OwpDMyRqc2NvbXAkMTIuSW1hZ2VEYXRhVG9CbG9iID0gZnVuY3Rpb24oYSwgYiwgZCkgewogICAgaWYgKEMzJGpzY29tcCQxMi5TdXBwb3J0cy5JbWFnZUJpdG1hcE9wdGlvbnMpIHJldHVybiBjcmVhdGVJbWFnZUJpdG1hcChhLCB7CiAgICAgICAgcHJlbXVsdGlwbHlBbHBoYTogIm5vbmUiCiAgICB9KS50aGVuKGUgPT4gQzMkanNjb21wJDEyLkRyYXdhYmxlVG9CbG9iKGUsIGIsIGQpKTsKICAgIGlmIChDMyRqc2NvbXAkMTIuU3VwcG9ydHMuSW1hZ2VCaXRtYXApIHJldHVybiBjcmVhdGVJbWFnZUJpdG1hcChhKS50aGVuKGUgPT4gQzMkanNjb21wJDEyLkRyYXdhYmxlVG9CbG9iKGUsIGIsIGQpKTsKICAgIGNvbnN0IGMgPSBDMyRqc2NvbXAkMTIuQ3JlYXRlQ2FudmFzKGEud2lkdGgsIGEuaGVpZ2h0KTsKICAgIGMuZ2V0Q29udGV4dCgiMmQiKS5wdXRJbWFnZURhdGEoYSwgMCwgMCk7CiAgICByZXR1cm4gQzMkanNjb21wJDEyLkNhbnZhc1RvQmxvYihjLCBiLCBkKQp9OwpDMyRqc2NvbXAkMTIuQ29weVNldCA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgIGEuY2xlYXIoKTsKICAgIGZvciAoY29uc3QgZCBvZiBiKSBhLmFkZChkKQp9OwpDMyRqc2NvbXAkMTIuTWFwVG9PYmplY3QgPSBmdW5jdGlvbihhKSB7CiAgICBjb25zdCBiID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIGZvciAoY29uc3QgW2QsIGNdIG9mIGEuZW50cmllcygpKSBiW2RdID0gYzsKICAgIHJldHVybiBiCn07CkMzJGpzY29tcCQxMi5PYmplY3RUb01hcCA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgIGIuY2xlYXIoKTsKICAgIGZvciAoY29uc3QgW2QsIGNdIG9mIE9iamVjdC5lbnRyaWVzKGEpKSBiLnNldChkLCBjKQp9OwpDMyRqc2NvbXAkMTIuVG9TdXBlckpTT04gPSBmdW5jdGlvbiBUb1N1cGVySlNPTihhKSB7CiAgICBpZiAoIm9iamVjdCIgPT09IHR5cGVvZiBhICYmIG51bGwgIT09IGEpIHsKICAgICAgICBpZiAoYSBpbnN0YW5jZW9mIFNldCkgcmV0dXJuIHsKICAgICAgICAgICAgX2MzdHlwZV86ICJzZXQiLAogICAgICAgICAgICBkYXRhOiBbLi4uYV0ubWFwKGMgPT4gVG9TdXBlckpTT04oYykpCiAgICAgICAgfTsKICAgICAgICBpZiAoYSBpbnN0YW5jZW9mIE1hcCkgcmV0dXJuIHsKICAgICAgICAgICAgX2MzdHlwZV86ICJtYXAiLAogICAgICAgICAgICBkYXRhOiBbLi4uYV0ubWFwKGMgPT4gW2NbMF0sIFRvU3VwZXJKU09OKGNbMV0pXSkKICAgICAgICB9OwogICAgICAgIGNvbnN0IGQgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICAgIGZvciAoY29uc3QgW2MsIGVdIG9mIE9iamVjdC5lbnRyaWVzKGEpKSBkW2NdID0gVG9TdXBlckpTT04oZSk7CiAgICAgICAgcmV0dXJuIGQKICAgIH0KICAgIHJldHVybiBhCn07CkMzJGpzY29tcCQxMi5Gcm9tU3VwZXJKU09OID0gZnVuY3Rpb24gRnJvbVN1cGVySlNPTihhKSB7CiAgICBpZiAoIm9iamVjdCIgPT09IHR5cGVvZiBhICYgbnVsbCAhPT0gYSkgewogICAgICAgIGlmICgic2V0IiA9PT0gYS5fYzN0eXBlXykgcmV0dXJuIG5ldyBTZXQoYS5kYXRhLm1hcChjID0+IEZyb21TdXBlckpTT04oYykpKTsKICAgICAgICBpZiAoIm1hcCIgPT09IGEuX2MzdHlwZV8pIHJldHVybiBuZXcgTWFwKGEuZGF0YS5tYXAoYyA9PiBbY1swXSwgRnJvbVN1cGVySlNPTihjWzFdKV0pKTsKICAgICAgICBjb25zdCBkID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgICBmb3IgKGNvbnN0IFtjLCBlXSBvZiBPYmplY3QuZW50cmllcyhhKSkgZFtjXSA9IEZyb21TdXBlckpTT04oZSk7CiAgICAgICAgcmV0dXJuIGQKICAgIH0KICAgIHJldHVybiBhCn07CkMzJGpzY29tcCQxMi5DU1NUb0NhbWVsQ2FzZSA9IGZ1bmN0aW9uKGEpIHsKICAgIGlmIChhLnN0YXJ0c1dpdGgoIi0tIikpIHJldHVybiBhOwogICAgbGV0IGIgPSAiIiwKICAgICAgICBkID0gITE7CiAgICBmb3IgKGNvbnN0IGMgb2YgYSkgIi0iID09PSBjID8gZCA9ICEwIDogZCA/IChiICs9IGMudG9VcHBlckNhc2UoKSwgZCA9ICExKSA6IGIgKz0gYzsKICAgIHJldHVybiBiCn07CkMzJGpzY29tcCQxMi5Jc0l0ZXJhdG9yID0gZnVuY3Rpb24oYSkgewogICAgcmV0dXJuICJvYmplY3QiID09PSB0eXBlb2YgYSAmJiAiZnVuY3Rpb24iID09PSB0eXBlb2YgYS5uZXh0Cn07CkMzJGpzY29tcCQxMi5NYWtlRmlsbGVkQXJyYXkgPSBmdW5jdGlvbihhLCBiKSB7CiAgICBjb25zdCBkID0gW107CiAgICBpZiAoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGIpCiAgICAgICAgZm9yICh2YXIgYyA9IDA7IGMgPCBhOyArK2MpIGQucHVzaChiKCkpOwogICAgZWxzZQogICAgICAgIGZvciAoYyA9IDA7IGMgPCBhOyArK2MpIGQucHVzaChiKTsKICAgIHJldHVybiBkCn07CiJ1c2Ugc3RyaWN0IjsKY29uc3QgQzMkanNjb21wJDEzID0gc2VsZi5DMywKICAgIEhTTF9URVNUID0gLyhbMC05Ll0rKSwoWzAtOS5dKyklPywoWzAtOS5dKyklPy9pLAogICAgSFNMQV9URVNUID0gLyhbMC05Ll0rKSwoWzAtOS5dKyklPywoWzAtOS5dKyklPywoWzAtOS5dKS9pOwoKZnVuY3Rpb24gcGFkVHdvRGlnaXRzKGEpIHsKICAgIHJldHVybiAwID09PSBhLmxlbmd0aCA/ICIwMCIgOiAxID09PSBhLmxlbmd0aCA/ICIwIiArIGEgOiBhCn0KCmZ1bmN0aW9uIGh1ZVRvUkdCKGEsIGIsIGQpIHsKICAgIDAgPiBkICYmIChkICs9IDEpOwogICAgMSA8IGQgJiYgLS1kOwogICAgcmV0dXJuIGQgPCAxIC8gNiA/IGEgKyA2ICogKGIgLSBhKSAqIGQgOiAuNSA+IGQgPyBiIDogZCA8IDIgLyAzID8gYSArIChiIC0gYSkgKiAoMiAvIDMgLSBkKSAqIDYgOiBhCn0KQzMkanNjb21wJDEzLkNvbG9yID0gY2xhc3MgewogICAgY29uc3RydWN0b3IoYSwgYiwgZCwgYykgewogICAgICAgIHRoaXMuX2EgPSB0aGlzLl9iID0gdGhpcy5fZyA9IHRoaXMuX3IgPSAwOwogICAgICAgIGEgaW5zdGFuY2VvZiBDMyRqc2NvbXAkMTMuQ29sb3IgPyB0aGlzLnNldChhKSA6IHRoaXMuc2V0UmdiYShhIHx8IDAsIGIgfHwgMCwgZCB8fCAwLCBjIHx8IDApCiAgICB9CiAgICBzZXRSZ2IoYSwgYiwgZCkgewogICAgICAgIHRoaXMuX3IgPSArYTsKICAgICAgICB0aGlzLl9nID0gK2I7CiAgICAgICAgdGhpcy5fYiA9ICtkOwogICAgICAgIHRoaXMuY2xhbXAoKTsKICAgICAgICByZXR1cm4gdGhpcwogICAgfQogICAgc2V0UmdiYShhLCBiLCBkLCBjKSB7CiAgICAgICAgdGhpcy5fciA9ICthOwogICAgICAgIHRoaXMuX2cgPSArYjsKICAgICAgICB0aGlzLl9iID0gK2Q7CiAgICAgICAgdGhpcy5fYSA9ICtjOwogICAgICAgIHRoaXMuY2xhbXAoKTsKICAgICAgICByZXR1cm4gdGhpcwogICAgfQogICAgc2V0KGEpIHsKICAgICAgICB0aGlzLl9yID0gYS5fcjsKICAgICAgICB0aGlzLl9nID0gYS5fZzsKICAgICAgICB0aGlzLl9iID0gYS5fYjsKICAgICAgICB0aGlzLl9hID0gYS5fYTsKICAgICAgICByZXR1cm4gdGhpcwogICAgfQogICAgY29weShhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuc2V0KGEpCiAgICB9CiAgICBhZGQoYSkgewogICAgICAgIHRoaXMuX3IgKz0gYS5fcjsKICAgICAgICB0aGlzLl9nICs9IGEuX2c7CiAgICAgICAgdGhpcy5fYiArPSBhLl9iOwogICAgICAgIHRoaXMuX2EgKz0gYS5fYTsKICAgICAgICB0aGlzLmNsYW1wKCkKICAgIH0KICAgIGFkZFJnYihhLCBiLAogICAgICAgIGQsIGMgPSAwKSB7CiAgICAgICAgdGhpcy5fciArPSArYTsKICAgICAgICB0aGlzLl9nICs9ICtiOwogICAgICAgIHRoaXMuX2IgKz0gK2Q7CiAgICAgICAgdGhpcy5fYSArPSArYzsKICAgICAgICB0aGlzLmNsYW1wKCkKICAgIH0KICAgIGRpZmYoYSkgewogICAgICAgIHRoaXMuc2V0UihNYXRoLm1heCh0aGlzLl9yLCBhLl9yKSAtIE1hdGgubWluKHRoaXMuX3IsIGEuX3IpKTsKICAgICAgICB0aGlzLnNldEcoTWF0aC5tYXgodGhpcy5fZywgYS5fZykgLSBNYXRoLm1pbih0aGlzLl9nLCBhLl9nKSk7CiAgICAgICAgdGhpcy5zZXRCKE1hdGgubWF4KHRoaXMuX2IsIGEuX2IpIC0gTWF0aC5taW4odGhpcy5fYiwgYS5fYikpOwogICAgICAgIHRoaXMuc2V0QShNYXRoLm1heCh0aGlzLl9hLCBhLl9hKSAtIE1hdGgubWluKHRoaXMuX2EsIGEuX2EpKTsKICAgICAgICB0aGlzLmNsYW1wKCkKICAgIH0KICAgIGNvcHlSZ2IoYSkgewogICAgICAgIHRoaXMuX3IgPSBhLl9yOwogICAgICAgIHRoaXMuX2cgPSBhLl9nOwogICAgICAgIHRoaXMuX2IgPSBhLl9iCiAgICB9CiAgICBzZXRSKGEpIHsKICAgICAgICB0aGlzLl9yID0gQzMkanNjb21wJDEzLmNsYW1wKCthLCAwLCAxKQogICAgfQogICAgZ2V0UigpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcgogICAgfQogICAgc2V0RyhhKSB7CiAgICAgICAgdGhpcy5fZyA9IEMzJGpzY29tcCQxMy5jbGFtcCgrYSwgMCwgMSkKICAgIH0KICAgIGdldEcoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2cKICAgIH0KICAgIHNldEIoYSkgewogICAgICAgIHRoaXMuX2IgPQogICAgICAgICAgICBDMyRqc2NvbXAkMTMuY2xhbXAoK2EsIDAsIDEpCiAgICB9CiAgICBnZXRCKCkgewogICAgICAgIHJldHVybiB0aGlzLl9iCiAgICB9CiAgICBzZXRBKGEpIHsKICAgICAgICB0aGlzLl9hID0gQzMkanNjb21wJDEzLmNsYW1wKCthLCAwLCAxKQogICAgfQogICAgZ2V0QSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fYQogICAgfQogICAgY2xvbmUoKSB7CiAgICAgICAgcmV0dXJuIEMzJGpzY29tcCQxMy5OZXcoQzMkanNjb21wJDEzLkNvbG9yLCB0aGlzLl9yLCB0aGlzLl9nLCB0aGlzLl9iLCB0aGlzLl9hKQogICAgfQogICAgdG9BcnJheSgpIHsKICAgICAgICByZXR1cm4gW3RoaXMuX3IsIHRoaXMuX2csIHRoaXMuX2IsIHRoaXMuX2FdCiAgICB9CiAgICB0b1R5cGVkQXJyYXkoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBGbG9hdDY0QXJyYXkodGhpcy50b0FycmF5KCkpCiAgICB9CiAgICB3cml0ZVRvVHlwZWRBcnJheShhLCBiKSB7CiAgICAgICAgYVtiKytdID0gdGhpcy5fcjsKICAgICAgICBhW2IrK10gPSB0aGlzLl9nOwogICAgICAgIGFbYisrXSA9IHRoaXMuX2I7CiAgICAgICAgYVtiXSA9IHRoaXMuX2EKICAgIH0KICAgIHdyaXRlUkdCVG9UeXBlZEFycmF5KGEsIGIpIHsKICAgICAgICBhW2IrK10gPSB0aGlzLl9yOwogICAgICAgIGFbYisrXSA9IHRoaXMuX2c7CiAgICAgICAgYVtiXSA9IHRoaXMuX2IKICAgIH0KICAgIGVxdWFscyhhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3IgPT09IGEuX3IgJiYgdGhpcy5fZyA9PT0gYS5fZyAmJgogICAgICAgICAgICB0aGlzLl9iID09PSBhLl9iICYmIHRoaXMuX2EgPT09IGEuX2EKICAgIH0KICAgIGVxdWFsc0lnbm9yaW5nQWxwaGEoYSkgewogICAgICAgIHJldHVybiB0aGlzLl9yID09PSBhLl9yICYmIHRoaXMuX2cgPT09IGEuX2cgJiYgdGhpcy5fYiA9PT0gYS5fYgogICAgfQogICAgZXF1YWxzUmdiKGEsIGIsIGQpIHsKICAgICAgICByZXR1cm4gdGhpcy5fciA9PT0gYSAmJiB0aGlzLl9nID09PSBiICYmIHRoaXMuX2IgPT09IGQKICAgIH0KICAgIGVxdWFsc1JnYmEoYSwgYiwgZCwgYykgewogICAgICAgIHJldHVybiB0aGlzLl9yID09PSBhICYmIHRoaXMuX2cgPT09IGIgJiYgdGhpcy5fYiA9PT0gZCAmJiB0aGlzLl9hID09PSBjCiAgICB9CiAgICBlcXVhbHNGMzJBcnJheShhLCBiKSB7CiAgICAgICAgcmV0dXJuIGFbYl0gPT09IE1hdGguZnJvdW5kKHRoaXMuX3IpICYmIGFbYiArIDFdID09PSBNYXRoLmZyb3VuZCh0aGlzLl9nKSAmJiBhW2IgKyAyXSA9PT0gTWF0aC5mcm91bmQodGhpcy5fYikgJiYgYVtiICsgM10gPT09IE1hdGguZnJvdW5kKHRoaXMuX2EpCiAgICB9CiAgICBlcXVhbHNSR0JGMzJBcnJheShhLCBiKSB7CiAgICAgICAgcmV0dXJuIGFbYl0gPT09IE1hdGguZnJvdW5kKHRoaXMuX3IpICYmIGFbYiArIDFdID09PSBNYXRoLmZyb3VuZCh0aGlzLl9nKSAmJiBhW2IgKyAyXSA9PT0gTWF0aC5mcm91bmQodGhpcy5fYikKICAgIH0KICAgIG11bHRpcGx5KGEpIHsKICAgICAgICB0aGlzLl9yICo9CiAgICAgICAgICAgIGEuX3I7CiAgICAgICAgdGhpcy5fZyAqPSBhLl9nOwogICAgICAgIHRoaXMuX2IgKj0gYS5fYjsKICAgICAgICB0aGlzLl9hICo9IGEuX2EKICAgIH0KICAgIG11bHRpcGx5QWxwaGEoYSkgewogICAgICAgIHRoaXMuX3IgKj0gYTsKICAgICAgICB0aGlzLl9nICo9IGE7CiAgICAgICAgdGhpcy5fYiAqPSBhOwogICAgICAgIHRoaXMuX2EgKj0gYQogICAgfQogICAgcHJlbXVsdGlwbHkoKSB7CiAgICAgICAgdGhpcy5fciAqPSB0aGlzLl9hOwogICAgICAgIHRoaXMuX2cgKj0gdGhpcy5fYTsKICAgICAgICB0aGlzLl9iICo9IHRoaXMuX2E7CiAgICAgICAgcmV0dXJuIHRoaXMKICAgIH0KICAgIHVucHJlbXVsdGlwbHkoKSB7CiAgICAgICAgdGhpcy5fciAvPSB0aGlzLl9hOwogICAgICAgIHRoaXMuX2cgLz0gdGhpcy5fYTsKICAgICAgICB0aGlzLl9iIC89IHRoaXMuX2E7CiAgICAgICAgcmV0dXJuIHRoaXMKICAgIH0KICAgIGNsYW1wKCkgewogICAgICAgIHRoaXMuX3IgPSBDMyRqc2NvbXAkMTMuY2xhbXAodGhpcy5fciwgMCwgMSk7CiAgICAgICAgdGhpcy5fZyA9IEMzJGpzY29tcCQxMy5jbGFtcCh0aGlzLl9nLCAwLCAxKTsKICAgICAgICB0aGlzLl9iID0gQzMkanNjb21wJDEzLmNsYW1wKHRoaXMuX2IsIDAsIDEpOwogICAgICAgIHRoaXMuX2EgPSBDMyRqc2NvbXAkMTMuY2xhbXAodGhpcy5fYSwgMCwgMSk7CiAgICAgICAgcmV0dXJuIHRoaXMKICAgIH0KICAgIHNldEZyb21SZ2JWYWx1ZShhKSB7CiAgICAgICAgdGhpcy5fciA9IEMzJGpzY29tcCQxMy5HZXRSVmFsdWUoYSk7CiAgICAgICAgdGhpcy5fZyA9CiAgICAgICAgICAgIEMzJGpzY29tcCQxMy5HZXRHVmFsdWUoYSk7CiAgICAgICAgdGhpcy5fYiA9IEMzJGpzY29tcCQxMy5HZXRCVmFsdWUoYSk7CiAgICAgICAgdGhpcy5fYSA9IEMzJGpzY29tcCQxMy5HZXRBVmFsdWUoYSkKICAgIH0KICAgIGdldENzc1JnYihhLCBiLCBkKSB7CiAgICAgICAgYSA9IEMzJGpzY29tcCQxMy5Jc0Zpbml0ZU51bWJlcihhKSA/IGEgOiB0aGlzLmdldFIoKTsKICAgICAgICBiID0gQzMkanNjb21wJDEzLklzRmluaXRlTnVtYmVyKGIpID8gYiA6IHRoaXMuZ2V0RygpOwogICAgICAgIGQgPSBDMyRqc2NvbXAkMTMuSXNGaW5pdGVOdW1iZXIoZCkgPyBkIDogdGhpcy5nZXRCKCk7CiAgICAgICAgcmV0dXJuIGByZ2IoJHsxMDAqYX0lLCAkezEwMCpifSUsICR7MTAwKmR9JSlgCiAgICB9CiAgICBnZXRDc3NSZ2JhKGEsIGIsIGQsIGMpIHsKICAgICAgICBhID0gQzMkanNjb21wJDEzLklzRmluaXRlTnVtYmVyKGEpID8gYSA6IHRoaXMuZ2V0UigpOwogICAgICAgIGIgPSBDMyRqc2NvbXAkMTMuSXNGaW5pdGVOdW1iZXIoYikgPyBiIDogdGhpcy5nZXRHKCk7CiAgICAgICAgZCA9IEMzJGpzY29tcCQxMy5Jc0Zpbml0ZU51bWJlcihkKSA/IGQgOiB0aGlzLmdldEIoKTsKICAgICAgICBjID0gQzMkanNjb21wJDEzLklzRmluaXRlTnVtYmVyKGMpID8gYyA6IHRoaXMuZ2V0QSgpOwogICAgICAgIHJldHVybiBgcmdiYSgkezEwMCphfSUsICR7MTAwKmJ9JSwgJHsxMDAqZH0lLCAke2N9KWAKICAgIH0KICAgIHRvSGV4U3RyaW5nKCkgewogICAgICAgIGNvbnN0IGEgPSBNYXRoLnJvdW5kKDI1NSAqIHRoaXMuZ2V0UigpKSwKICAgICAgICAgICAgYiA9IE1hdGgucm91bmQoMjU1ICogdGhpcy5nZXRHKCkpLAogICAgICAgICAgICBkID0gTWF0aC5yb3VuZCgyNTUgKiB0aGlzLmdldEIoKSk7CiAgICAgICAgcmV0dXJuICIjIiArIHBhZFR3b0RpZ2l0cyhhLnRvU3RyaW5nKDE2KSkgKyBwYWRUd29EaWdpdHMoYi50b1N0cmluZygxNikpICsgcGFkVHdvRGlnaXRzKGQudG9TdHJpbmcoMTYpKQogICAgfQogICAgcGFyc2VIZXhTdHJpbmcoYSkgewogICAgICAgIGlmICgic3RyaW5nIiAhPT0gdHlwZW9mIGEpIHJldHVybiAhMTsKICAgICAgICBhID0gYS50cmltKCk7CiAgICAgICAgIiMiID09PSBhLmNoYXJBdCgwKSAmJiAoYSA9IGEuc3Vic3RyKDEpKTsKICAgICAgICBsZXQgYiwgZDsKICAgICAgICBpZiAoMyA9PT0gYS5sZW5ndGgpIGIgPSBwYXJzZUludChhWzBdLCAxNikgLyAxNSwgZCA9IHBhcnNlSW50KGFbMV0sIDE2KSAvIDE1LCBhID0gcGFyc2VJbnQoYVsyXSwgMTYpIC8gMTU7CiAgICAgICAgZWxzZSBpZiAoNiA9PT0gYS5sZW5ndGgpIGIgPSBwYXJzZUludChhLnN1YnN0cigwLCAyKSwgMTYpIC8gMjU1LAogICAgICAgICAgICBkID0gcGFyc2VJbnQoYS5zdWJzdHIoMiwgMiksIDE2KSAvIDI1NSwgYSA9IHBhcnNlSW50KGEuc3Vic3RyKDQsIDIpLCAxNikgLyAyNTU7CiAgICAgICAgZWxzZSByZXR1cm4gITE7CiAgICAgICAgaXNGaW5pdGUoYikgJiYgdGhpcy5zZXRSKGIpOwogICAgICAgIGlzRmluaXRlKGQpICYmIHRoaXMuc2V0RyhkKTsKICAgICAgICBpc0Zpbml0ZShhKSAmJiB0aGlzLnNldEIoYSk7CiAgICAgICAgdGhpcy5zZXRBKDEpOwogICAgICAgIHJldHVybiAhMAogICAgfQogICAgdG9Db21tYVNlcGFyYXRlZFJnYigpIHsKICAgICAgICBjb25zdCBhID0gTWF0aC5yb3VuZCgyNTUgKiB0aGlzLmdldFIoKSksCiAgICAgICAgICAgIGIgPSBNYXRoLnJvdW5kKDI1NSAqIHRoaXMuZ2V0RygpKSwKICAgICAgICAgICAgZCA9IE1hdGgucm91bmQoMjU1ICogdGhpcy5nZXRCKCkpOwogICAgICAgIHJldHVybiBgJHthfSwgJHtifSwgJHtkfWAKICAgIH0KICAgIHRvUmdiQXJyYXkoKSB7CiAgICAgICAgY29uc3QgYSA9IE1hdGgucm91bmQoMjU1ICogdGhpcy5nZXRSKCkpLAogICAgICAgICAgICBiID0gTWF0aC5yb3VuZCgyNTUgKiB0aGlzLmdldEcoKSksCiAgICAgICAgICAgIGQgPSBNYXRoLnJvdW5kKDI1NSAqIHRoaXMuZ2V0QigpKTsKICAgICAgICByZXR1cm4gW2EsIGIsIGRdCiAgICB9CiAgICBwYXJzZUNvbW1hU2VwYXJhdGVkUmdiKGEpIHsKICAgICAgICBpZiAoInN0cmluZyIgIT09IHR5cGVvZiBhKSByZXR1cm4gITE7CiAgICAgICAgYSA9IGEucmVwbGFjZSgvXnJnYlwofFwpfCUvLCAiIik7CiAgICAgICAgdmFyIGIgPSBhLnNwbGl0KCIsIik7CiAgICAgICAgaWYgKDMgPiBiLmxlbmd0aCkgcmV0dXJuICExOwogICAgICAgIGEgPSBwYXJzZUludChiWzBdLnRyaW0oKSwgMTApIC8gMjU1OwogICAgICAgIGNvbnN0IGQgPSBwYXJzZUludChiWzFdLnRyaW0oKSwgMTApIC8gMjU1OwogICAgICAgIGIgPSBwYXJzZUludChiWzJdLnRyaW0oKSwgMTApIC8gMjU1OwogICAgICAgIGlzRmluaXRlKGEpICYmIHRoaXMuc2V0UihhKTsKICAgICAgICBpc0Zpbml0ZShkKSAmJiB0aGlzLnNldEcoZCk7CiAgICAgICAgaXNGaW5pdGUoYikgJiYgdGhpcy5zZXRCKGIpOwogICAgICAgIHRoaXMuc2V0QSgxKTsKICAgICAgICByZXR1cm4gITAKICAgIH0KICAgIHBhcnNlQ29tbWFTZXBhcmF0ZWRQZXJjZW50YWdlUmdiKGEpIHsKICAgICAgICBpZiAoInN0cmluZyIgIT09IHR5cGVvZiBhKSByZXR1cm4gITE7CiAgICAgICAgYSA9IGEucmVwbGFjZSgvXnJnYlwofFwpfCUvLCAiIik7CiAgICAgICAgdmFyIGIgPSBhLnNwbGl0KCIsIik7CiAgICAgICAgaWYgKDMgPiBiLmxlbmd0aCkgcmV0dXJuICExOwogICAgICAgIGEgPSBwYXJzZUludChiWzBdLnRyaW0oKSwgMTApIC8gMTAwOwogICAgICAgIGNvbnN0IGQgPSBwYXJzZUludChiWzFdLnRyaW0oKSwgMTApIC8gMTAwOwogICAgICAgIGIgPSBwYXJzZUludChiWzJdLnRyaW0oKSwKICAgICAgICAgICAgMTApIC8gMTAwOwogICAgICAgIGlzRmluaXRlKGEpICYmIHRoaXMuc2V0UihhKTsKICAgICAgICBpc0Zpbml0ZShkKSAmJiB0aGlzLnNldEcoZCk7CiAgICAgICAgaXNGaW5pdGUoYikgJiYgdGhpcy5zZXRCKGIpOwogICAgICAgIHRoaXMuc2V0QSgxKTsKICAgICAgICByZXR1cm4gITAKICAgIH0KICAgIHBhcnNlQ29tbWFTZXBhcmF0ZWRSZ2JhKGEpIHsKICAgICAgICBpZiAoInN0cmluZyIgIT09IHR5cGVvZiBhKSByZXR1cm4gITE7CiAgICAgICAgYSA9IGEucmVwbGFjZSgvXnJnYmFcKHxcKXwlLywgIiIpOwogICAgICAgIHZhciBiID0gYS5zcGxpdCgiLCIpOwogICAgICAgIGlmICg0ID4gYi5sZW5ndGgpIHJldHVybiAhMTsKICAgICAgICBhID0gcGFyc2VJbnQoYlswXS50cmltKCksIDEwKSAvIDI1NTsKICAgICAgICBjb25zdCBkID0gcGFyc2VJbnQoYlsxXS50cmltKCksIDEwKSAvIDI1NSwKICAgICAgICAgICAgYyA9IHBhcnNlSW50KGJbMl0udHJpbSgpLCAxMCkgLyAyNTU7CiAgICAgICAgYiA9IHBhcnNlRmxvYXQoYlszXS50cmltKCkpOwogICAgICAgIGlzRmluaXRlKGEpICYmIHRoaXMuc2V0UihhKTsKICAgICAgICBpc0Zpbml0ZShkKSAmJiB0aGlzLnNldEcoZCk7CiAgICAgICAgaXNGaW5pdGUoYykgJiYgdGhpcy5zZXRCKGMpOwogICAgICAgIGlzRmluaXRlKGIpICYmIHRoaXMuc2V0QShiKTsKICAgICAgICByZXR1cm4gITAKICAgIH0KICAgIHBhcnNlQ29tbWFTZXBhcmF0ZWRQZXJjZW50YWdlUmdiYShhKSB7CiAgICAgICAgaWYgKCJzdHJpbmciICE9PQogICAgICAgICAgICB0eXBlb2YgYSkgcmV0dXJuICExOwogICAgICAgIGEgPSBhLnJlcGxhY2UoL15yZ2JhXCh8XCl8JS8sICIiKTsKICAgICAgICB2YXIgYiA9IGEuc3BsaXQoIiwiKTsKICAgICAgICBpZiAoNCA+IGIubGVuZ3RoKSByZXR1cm4gITE7CiAgICAgICAgYSA9IHBhcnNlSW50KGJbMF0udHJpbSgpLCAxMCkgLyAxMDA7CiAgICAgICAgY29uc3QgZCA9IHBhcnNlSW50KGJbMV0udHJpbSgpLCAxMCkgLyAxMDAsCiAgICAgICAgICAgIGMgPSBwYXJzZUludChiWzJdLnRyaW0oKSwgMTApIC8gMTAwOwogICAgICAgIGIgPSBwYXJzZUZsb2F0KGJbM10udHJpbSgpKTsKICAgICAgICBpc0Zpbml0ZShhKSAmJiB0aGlzLnNldFIoYSk7CiAgICAgICAgaXNGaW5pdGUoZCkgJiYgdGhpcy5zZXRHKGQpOwogICAgICAgIGlzRmluaXRlKGMpICYmIHRoaXMuc2V0QihjKTsKICAgICAgICBpc0Zpbml0ZShiKSAmJiB0aGlzLnNldEEoYik7CiAgICAgICAgcmV0dXJuICEwCiAgICB9CiAgICBwYXJzZVN0cmluZyhhKSB7CiAgICAgICAgaWYgKCJzdHJpbmciICE9PSB0eXBlb2YgYSkgcmV0dXJuICExOwogICAgICAgIGEgPSBhLnJlcGxhY2UoL1xzKy8sICIiKTsKICAgICAgICBpZiAoYS5pbmNsdWRlcygiLCIpKSB7CiAgICAgICAgICAgIGlmIChhLnN0YXJ0c1dpdGgoInJnYigiKSkgcmV0dXJuIGEuaW5jbHVkZXMoIiUiKSA/IHRoaXMucGFyc2VDb21tYVNlcGFyYXRlZFBlcmNlbnRhZ2VSZ2IoYSkgOgogICAgICAgICAgICAgICAgdGhpcy5wYXJzZUNvbW1hU2VwYXJhdGVkUmdiKGEpOwogICAgICAgICAgICBpZiAoYS5zdGFydHNXaXRoKCJyZ2JhKCIpKSByZXR1cm4gYS5pbmNsdWRlcygiJSIpID8gdGhpcy5wYXJzZUNvbW1hU2VwYXJhdGVkUGVyY2VudGFnZVJnYmEoYSkgOiB0aGlzLnBhcnNlQ29tbWFTZXBhcmF0ZWRSZ2JhKGEpOwogICAgICAgICAgICBpZiAoYS5zdGFydHNXaXRoKCJoc2woIikgfHwgYS5zdGFydHNXaXRoKCJoc2xhKCIpKSByZXR1cm4gdGhpcy5wYXJzZUhTTFN0cmluZyhhKTsKICAgICAgICAgICAgY29uc3QgYiA9IGEuc3BsaXQoIiwiKTsKICAgICAgICAgICAgaWYgKGEuaW5jbHVkZXMoIiUiKSkgewogICAgICAgICAgICAgICAgaWYgKDMgPT09IGIubGVuZ3RoKSByZXR1cm4gdGhpcy5wYXJzZUNvbW1hU2VwYXJhdGVkUGVyY2VudGFnZVJnYihhKTsKICAgICAgICAgICAgICAgIGlmICg0ID09PSBiLmxlbmd0aCkgcmV0dXJuIHRoaXMucGFyc2VDb21tYVNlcGFyYXRlZFBlcmNlbnRhZ2VSZ2JhKGEpCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAoMyA9PT0gYi5sZW5ndGgpIHJldHVybiB0aGlzLnBhcnNlQ29tbWFTZXBhcmF0ZWRSZ2IoYSk7CiAgICAgICAgICAgICAgICBpZiAoNCA9PT0gYi5sZW5ndGgpIHJldHVybiB0aGlzLnBhcnNlQ29tbWFTZXBhcmF0ZWRSZ2JhKGEpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuICExCiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzLnBhcnNlSGV4U3RyaW5nKGEpCiAgICB9CiAgICB0b0pTT04oKSB7CiAgICAgICAgcmV0dXJuIFt0aGlzLl9yLAogICAgICAgICAgICB0aGlzLl9nLCB0aGlzLl9iLCB0aGlzLl9hCiAgICAgICAgXQogICAgfQogICAgc2V0RnJvbUhTTEEoYSwgYiwgZCwgYykgewogICAgICAgIGEgJT0gMzYwOwogICAgICAgIGIgPSBDMyRqc2NvbXAkMTMuY2xhbXAoYiwgMCwgMTAwKTsKICAgICAgICBkID0gQzMkanNjb21wJDEzLmNsYW1wKGQsIDAsIDEwMCk7CiAgICAgICAgYyA9IEMzJGpzY29tcCQxMy5jbGFtcChjLCAwLCAxKTsKICAgICAgICBhIC89IDM2MDsKICAgICAgICBiIC89IDEwMDsKICAgICAgICBkIC89IDEwMDsKICAgICAgICBpZiAoMCA9PT0gYikgZCA9IGIgPSBhID0gZDsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgY29uc3QgZSA9IC41ID4gZCA/IGQgKiAoMSArIGIpIDogZCArIGIgLSBkICogYiwKICAgICAgICAgICAgICAgIGcgPSAyICogZCAtIGU7CiAgICAgICAgICAgIGQgPSBodWVUb1JHQihnLCBlLCBhICsgMSAvIDMpOwogICAgICAgICAgICBiID0gaHVlVG9SR0IoZywgZSwgYSk7CiAgICAgICAgICAgIGEgPSBodWVUb1JHQihnLCBlLCBhIC0gMSAvIDMpCiAgICAgICAgfQogICAgICAgIHRoaXMuc2V0UihkKTsKICAgICAgICB0aGlzLnNldEcoYik7CiAgICAgICAgdGhpcy5zZXRCKGEpOwogICAgICAgIHRoaXMuc2V0QShjKTsKICAgICAgICByZXR1cm4gdGhpcwogICAgfQogICAgcGFyc2VIU0xTdHJpbmcoYSkgewogICAgICAgIHZhciBiID0gYS5yZXBsYWNlKC8gfGhzbHxoc2xhfFwofFwpfDsvZ2ksICIiKTsKICAgICAgICBhID0gSFNMX1RFU1QuZXhlYyhiKTsKICAgICAgICBiID0gSFNMQV9URVNULmV4ZWMoYik7CiAgICAgICAgcmV0dXJuIGEgJiYgNCA9PT0gYS5sZW5ndGggPyAodGhpcy5zZXRGcm9tSFNMQSgrYVsxXSwgK2FbMl0sICthWzNdLAogICAgICAgICAgICAxKSwgITApIDogYiAmJiA1ID09PSBiLmxlbmd0aCA/ICh0aGlzLnNldEZyb21IU0xBKCthWzFdLCArYVsyXSwgK2FbM10sICthWzRdKSwgITApIDogITEKICAgIH0KICAgIHRvSFNMQVN0cmluZygpIHsKICAgICAgICB2YXIgYSA9IHRoaXMuX3I7CiAgICAgICAgY29uc3QgYiA9IHRoaXMuX2csCiAgICAgICAgICAgIGQgPSB0aGlzLl9iLAogICAgICAgICAgICBjID0gdGhpcy5fYSwKICAgICAgICAgICAgZSA9IEMzJGpzY29tcCQxMy5Db2xvci5HZXRIdWUoYSwgYiwgZCksCiAgICAgICAgICAgIGcgPSBDMyRqc2NvbXAkMTMuQ29sb3IuR2V0U2F0dXJhdGlvbihhLCBiLCBkKTsKICAgICAgICBhID0gQzMkanNjb21wJDEzLkNvbG9yLkdldEx1bWlub3NpdHkoYSwgYiwgZCk7CiAgICAgICAgcmV0dXJuIGBoc2xhKCR7ZX0sICR7Z30lLCAke2F9JSwgJHtjfSlgCiAgICB9CiAgICB0b0hTTEFBcnJheSgpIHsKICAgICAgICBjb25zdCBhID0gdGhpcy5fciwKICAgICAgICAgICAgYiA9IHRoaXMuX2csCiAgICAgICAgICAgIGQgPSB0aGlzLl9iOwogICAgICAgIHJldHVybiBbQzMkanNjb21wJDEzLkNvbG9yLkdldEh1ZShhLCBiLCBkKSwgQzMkanNjb21wJDEzLkNvbG9yLkdldFNhdHVyYXRpb24oYSwgYiwgZCksIEMzJGpzY29tcCQxMy5Db2xvci5HZXRMdW1pbm9zaXR5KGEsIGIsIGQpLCB0aGlzLl9hXQogICAgfQogICAgc2V0RnJvbUpTT04oYSkgewogICAgICAgICFBcnJheS5pc0FycmF5KGEpIHx8CiAgICAgICAgICAgIDMgPiBhLmxlbmd0aCB8fCAodGhpcy5fciA9IGFbMF0sIHRoaXMuX2cgPSBhWzFdLCB0aGlzLl9iID0gYVsyXSwgdGhpcy5fYSA9IDQgPD0gYS5sZW5ndGggPyBhWzNdIDogMSkKICAgIH0KICAgIHNldCByKGEpIHsKICAgICAgICB0aGlzLnNldFIoYSkKICAgIH0KICAgIGdldCByKCkgewogICAgICAgIHJldHVybiB0aGlzLmdldFIoKQogICAgfQogICAgc2V0IGcoYSkgewogICAgICAgIHRoaXMuc2V0RyhhKQogICAgfQogICAgZ2V0IGcoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0RygpCiAgICB9CiAgICBzZXQgYihhKSB7CiAgICAgICAgdGhpcy5zZXRCKGEpCiAgICB9CiAgICBnZXQgYigpIHsKICAgICAgICByZXR1cm4gdGhpcy5nZXRCKCkKICAgIH0KICAgIHNldCBhKGEpIHsKICAgICAgICB0aGlzLnNldEEoYSkKICAgIH0KICAgIGdldCBhKCkgewogICAgICAgIHJldHVybiB0aGlzLmdldEEoKQogICAgfQogICAgc2V0QXRJbmRleChhLCBiKSB7CiAgICAgICAgc3dpdGNoIChhKSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIHRoaXMuc2V0UihiKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICB0aGlzLnNldEcoYik7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgdGhpcy5zZXRCKGIpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgIHRoaXMuc2V0QShiKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoImludmFsaWQgY29sb3IgaW5kZXgiKTsKICAgICAgICB9CiAgICB9CiAgICBnZXRBdEluZGV4KGEpIHsKICAgICAgICBzd2l0Y2ggKGEpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0UigpOwogICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRHKCk7CiAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldEIoKTsKICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0QSgpOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoImludmFsaWQgY29sb3IgaW5kZXgiKTsKICAgICAgICB9CiAgICB9CiAgICBzdGF0aWMgRXF1YWxzKGEsIGIpIHsKICAgICAgICBsZXQgZDsKICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShhKSkgZCA9IG5ldyBDMyRqc2NvbXAkMTMuQ29sb3IsIGQuc2V0RnJvbUpTT04oYSk7CiAgICAgICAgZWxzZSBpZiAoYSBpbnN0YW5jZW9mIEMzJGpzY29tcCQxMy5Db2xvcikgZCA9IGE7CiAgICAgICAgZWxzZSB0aHJvdyBFcnJvcigidW5leHBlY3RlZCB0eXBlIik7CiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoYikpIGEgPSBuZXcgQzMkanNjb21wJDEzLkNvbG9yLCBhLnNldEZyb21KU09OKGIpOwogICAgICAgIGVsc2UgaWYgKGIgaW5zdGFuY2VvZiBDMyRqc2NvbXAkMTMuQ29sb3IpIGEgPSBiOwogICAgICAgIGVsc2UgdGhyb3cgRXJyb3IoInVuZXhwZWN0ZWQgdHlwZSIpOwogICAgICAgIHJldHVybiBkLmVxdWFscyhhKQogICAgfQogICAgc3RhdGljIERpZmZDaGFubmVsKGEsIGIpIHsKICAgICAgICByZXR1cm4gQzMkanNjb21wJDEzLmNsYW1wKE1hdGgubWF4KGEsCiAgICAgICAgICAgIGIpIC0gTWF0aC5taW4oYSwgYiksIDAsIDEpCiAgICB9CiAgICBzdGF0aWMgRGlmZihhLCBiKSB7CiAgICAgICAgY29uc3QgZCA9IG5ldyBDMyRqc2NvbXAkMTMuQ29sb3I7CiAgICAgICAgZC5zZXRSKE1hdGgubWF4KGEuX3IsIGIuX3IpIC0gTWF0aC5taW4oYS5fciwgYi5fcikpOwogICAgICAgIGQuc2V0RyhNYXRoLm1heChhLl9nLCBiLl9nKSAtIE1hdGgubWluKGEuX2csIGIuX2cpKTsKICAgICAgICBkLnNldEIoTWF0aC5tYXgoYS5fYiwgYi5fYikgLSBNYXRoLm1pbihhLl9iLCBiLl9iKSk7CiAgICAgICAgZC5zZXRBKE1hdGgubWF4KGEuX2EsIGIuX2EpIC0gTWF0aC5taW4oYS5fYSwgYi5fYSkpOwogICAgICAgIHJldHVybiBkCiAgICB9CiAgICBzdGF0aWMgRGlmZk5vQWxwaGEoYSwgYikgewogICAgICAgIGNvbnN0IGQgPSBuZXcgQzMkanNjb21wJDEzLkNvbG9yKDAsIDAsIDAsIDEpOwogICAgICAgIGQuc2V0UihNYXRoLm1heChhLl9yLCBiLl9yKSAtIE1hdGgubWluKGEuX3IsIGIuX3IpKTsKICAgICAgICBkLnNldEcoTWF0aC5tYXgoYS5fZywgYi5fZykgLSBNYXRoLm1pbihhLl9nLCBiLl9nKSk7CiAgICAgICAgZC5zZXRCKE1hdGgubWF4KGEuX2IsIGIuX2IpIC0gTWF0aC5taW4oYS5fYiwgYi5fYikpOwogICAgICAgIHJldHVybiBkCiAgICB9CiAgICBzdGF0aWMgR2V0SHVlKGEsCiAgICAgICAgYiwgZCkgewogICAgICAgIGNvbnN0IGMgPSBNYXRoLm1heChhLCBiLCBkKSwKICAgICAgICAgICAgZSA9IE1hdGgubWluKGEsIGIsIGQpOwogICAgICAgIGlmIChjID09PSBlKSByZXR1cm4gMDsKICAgICAgICBsZXQgZyA9IDA7CiAgICAgICAgc3dpdGNoIChjKSB7CiAgICAgICAgICAgIGNhc2UgYToKICAgICAgICAgICAgICAgIGcgPSAoYiAtIGQpIC8gKGMgLSBlKSArIChiIDwgZCA/IDYgOiAwKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIGI6CiAgICAgICAgICAgICAgICBnID0gKGQgLSBhKSAvIChjIC0gZSkgKyAyOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgZDoKICAgICAgICAgICAgICAgIGcgPSAoYSAtIGIpIC8gKGMgLSBlKSArIDQKICAgICAgICB9CiAgICAgICAgcmV0dXJuIE1hdGgucm91bmQoZyAvIDYgKiAzNjApCiAgICB9CiAgICBzdGF0aWMgR2V0U2F0dXJhdGlvbihhLCBiLCBkKSB7CiAgICAgICAgY29uc3QgYyA9IE1hdGgubWF4KGEsIGIsIGQpOwogICAgICAgIGEgPSBNYXRoLm1pbihhLCBiLCBkKTsKICAgICAgICBpZiAoYyA9PT0gYSkgcmV0dXJuIDA7CiAgICAgICAgYiA9IGMgLSBhOwogICAgICAgIHJldHVybiBNYXRoLnJvdW5kKDEwMCAqICguNSA8IChjICsgYSkgLyAyID8gYiAvICgyIC0gYyAtIGEpIDogYiAvIChjICsgYSkpKQogICAgfQogICAgc3RhdGljIEdldEx1bWlub3NpdHkoYSwgYiwgZCkgewogICAgICAgIGNvbnN0IGMgPSBNYXRoLm1heChhLCBiLCBkKTsKICAgICAgICByZXR1cm4gYyA/IE1hdGgucm91bmQoKGMgKyBNYXRoLm1pbihhLCBiLCBkKSkgLyAyICogMTAwKSA6IDAKICAgIH0KfTsKQzMkanNjb21wJDEzLkNvbG9yLldoaXRlID0gT2JqZWN0LmZyZWV6ZShDMyRqc2NvbXAkMTMuTmV3KEMzJGpzY29tcCQxMy5Db2xvciwgMSwgMSwgMSwgMSkpOwpDMyRqc2NvbXAkMTMuQ29sb3IuQmxhY2sgPSBPYmplY3QuZnJlZXplKEMzJGpzY29tcCQxMy5OZXcoQzMkanNjb21wJDEzLkNvbG9yLCAwLCAwLCAwLCAxKSk7CkMzJGpzY29tcCQxMy5Db2xvci5UcmFuc3BhcmVudEJsYWNrID0gT2JqZWN0LmZyZWV6ZShDMyRqc2NvbXAkMTMuTmV3KEMzJGpzY29tcCQxMy5Db2xvciwgMCwgMCwgMCwgMCkpOwoidXNlIHN0cmljdCI7CmNvbnN0IEMzJGpzY29tcCQxNCA9IHNlbGYuQzM7CkMzJGpzY29tcCQxNC5WZWN0b3IyID0gY2xhc3MgewogICAgY29uc3RydWN0b3IoYSwgYikgewogICAgICAgIHRoaXMuX3kgPSB0aGlzLl94ID0gMDsKICAgICAgICBhIGluc3RhbmNlb2YgQzMkanNjb21wJDE0LlZlY3RvcjIgPyB0aGlzLmNvcHkoYSkgOiB0aGlzLnNldChhIHx8IDAsIGIgfHwgMCkKICAgIH0KICAgIHNldChhLCBiKSB7CiAgICAgICAgdGhpcy5feCA9ICthOwogICAgICAgIHRoaXMuX3kgPSArYgogICAgfQogICAgY29weShhKSB7CiAgICAgICAgdGhpcy5feCA9IGEuX3g7CiAgICAgICAgdGhpcy5feSA9IGEuX3kKICAgIH0KICAgIGVxdWFscyhhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3ggPT09IGEuX3ggJiYgdGhpcy5feSA9PT0gYS5feQogICAgfQogICAgZXF1YWxzVmFsdWVzKGEsIGIpIHsKICAgICAgICByZXR1cm4gdGhpcy5feCA9PT0gYSAmJiB0aGlzLl95ID09PSBiCiAgICB9CiAgICBlcXVhbHNGMzJBcnJheShhLCBiKSB7CiAgICAgICAgcmV0dXJuIGFbYl0gPT09IE1hdGguZnJvdW5kKHRoaXMuX3gpICYmIGFbYiArIDFdID09PSBNYXRoLmZyb3VuZCh0aGlzLl95KQogICAgfQogICAgc2V0WChhKSB7CiAgICAgICAgdGhpcy5feCA9ICthCiAgICB9CiAgICBnZXRYKCkgewogICAgICAgIHJldHVybiB0aGlzLl94CiAgICB9CiAgICBzZXRZKGEpIHsKICAgICAgICB0aGlzLl95ID0gK2EKICAgIH0KICAgIGdldFkoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3kKICAgIH0KICAgIHRvQXJyYXkoKSB7CiAgICAgICAgcmV0dXJuIFt0aGlzLl94LCB0aGlzLl95XQogICAgfQogICAgdG9UeXBlZEFycmF5KCkgewogICAgICAgIHJldHVybiBuZXcgRmxvYXQ2NEFycmF5KHRoaXMudG9BcnJheSgpKQogICAgfQogICAgd3JpdGVUb1R5cGVkQXJyYXkoYSwKICAgICAgICBiKSB7CiAgICAgICAgYVtiKytdID0gdGhpcy5feDsKICAgICAgICBhW2JdID0gdGhpcy5feQogICAgfQogICAgb2Zmc2V0KGEsIGIpIHsKICAgICAgICB0aGlzLl94ICs9ICthOwogICAgICAgIHRoaXMuX3kgKz0gK2IKICAgIH0KICAgIHNjYWxlKGEsIGIpIHsKICAgICAgICB0aGlzLl94ICo9IGE7CiAgICAgICAgdGhpcy5feSAqPSBiCiAgICB9CiAgICBkaXZpZGUoYSwgYikgewogICAgICAgIHRoaXMuX3ggLz0gYTsKICAgICAgICB0aGlzLl95IC89IGIKICAgIH0KICAgIHJvdW5kKCkgewogICAgICAgIHRoaXMuX3ggPSBNYXRoLnJvdW5kKHRoaXMuX3gpOwogICAgICAgIHRoaXMuX3kgPSBNYXRoLnJvdW5kKHRoaXMuX3kpCiAgICB9CiAgICBmbG9vcigpIHsKICAgICAgICB0aGlzLl94ID0gTWF0aC5mbG9vcih0aGlzLl94KTsKICAgICAgICB0aGlzLl95ID0gTWF0aC5mbG9vcih0aGlzLl95KQogICAgfQogICAgY2VpbCgpIHsKICAgICAgICB0aGlzLl94ID0gTWF0aC5jZWlsKHRoaXMuX3gpOwogICAgICAgIHRoaXMuX3kgPSBNYXRoLmNlaWwodGhpcy5feSkKICAgIH0KICAgIGFuZ2xlKCkgewogICAgICAgIHJldHVybiBDMyRqc2NvbXAkMTQuYW5nbGVUbygwLCAwLCB0aGlzLl94LCB0aGlzLl95KQogICAgfQogICAgbGVuZ3RoU3F1YXJlZCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5feCAqIHRoaXMuX3ggKyB0aGlzLl95ICogdGhpcy5feQogICAgfQogICAgbGVuZ3RoKCkgewogICAgICAgIHJldHVybiBNYXRoLmh5cG90KHRoaXMuX3gsIHRoaXMuX3kpCiAgICB9CiAgICByb3RhdGVQcmVjYWxjKGEsIGIpIHsKICAgICAgICBjb25zdCBkID0KICAgICAgICAgICAgdGhpcy5feCAqIGIgLSB0aGlzLl95ICogYTsKICAgICAgICB0aGlzLl95ID0gdGhpcy5feSAqIGIgKyB0aGlzLl94ICogYTsKICAgICAgICB0aGlzLl94ID0gZAogICAgfQogICAgcm90YXRlKGEpIHsKICAgICAgICAwICE9PSBhICYmIHRoaXMucm90YXRlUHJlY2FsYyhNYXRoLnNpbihhKSwgTWF0aC5jb3MoYSkpCiAgICB9CiAgICByb3RhdGVBYm91dChhLCBiLCBkKSB7CiAgICAgICAgMCA9PT0gYSB8fCBiID09PSB0aGlzLl94ICYmIGQgPT09IHRoaXMuX3kgfHwgKHRoaXMuX3ggLT0gYiwgdGhpcy5feSAtPSBkLCB0aGlzLnJvdGF0ZVByZWNhbGMoTWF0aC5zaW4oYSksIE1hdGguY29zKGEpKSwgdGhpcy5feCArPSArYiwgdGhpcy5feSArPSArZCkKICAgIH0KICAgIG1vdmUoYSwgYikgewogICAgICAgIDAgIT09IGIgJiYgKHRoaXMuX3ggKz0gTWF0aC5jb3MoYSkgKiBiLCB0aGlzLl95ICs9IE1hdGguc2luKGEpICogYikKICAgIH0KICAgIG5vcm1hbGl6ZSgpIHsKICAgICAgICBjb25zdCBhID0gdGhpcy5sZW5ndGgoKTsKICAgICAgICAwICE9PSBhICYmIDEgIT09IGEgJiYgKHRoaXMuX3ggLz0gYSwgdGhpcy5feSAvPSBhKQogICAgfQogICAgY2xhbXAoYSwgYikgewogICAgICAgIHRoaXMuX3ggPSBDMyRqc2NvbXAkMTQuY2xhbXAodGhpcy5feCwgYSwgYik7CiAgICAgICAgdGhpcy5feSA9IEMzJGpzY29tcCQxNC5jbGFtcCh0aGlzLl95LCBhLCBiKQogICAgfQp9OwoidXNlIHN0cmljdCI7CmNvbnN0IEMzJGpzY29tcCQxNSA9IHNlbGYuQzM7CkMzJGpzY29tcCQxNS5SZWN0ID0gY2xhc3MgewogICAgY29uc3RydWN0b3IoYSwgYiwgZCwgYykgewogICAgICAgIHRoaXMuX2JvdHRvbSA9IHRoaXMuX3JpZ2h0ID0gdGhpcy5fdG9wID0gdGhpcy5fbGVmdCA9IDA7CiAgICAgICAgYSBpbnN0YW5jZW9mIEMzJGpzY29tcCQxNS5SZWN0ID8gdGhpcy5jb3B5KGEpIDogdGhpcy5zZXQoYSB8fCAwLCBiIHx8IDAsIGQgfHwgMCwgYyB8fCAwKQogICAgfQogICAgc2V0KGEsIGIsIGQsIGMpIHsKICAgICAgICB0aGlzLl9sZWZ0ID0gK2E7CiAgICAgICAgdGhpcy5fdG9wID0gK2I7CiAgICAgICAgdGhpcy5fcmlnaHQgPSArZDsKICAgICAgICB0aGlzLl9ib3R0b20gPSArYwogICAgfQogICAgc2V0V0goYSwgYiwgZCwgYykgewogICAgICAgIGEgPSArYTsKICAgICAgICBiID0gK2I7CiAgICAgICAgdGhpcy5fbGVmdCA9IGE7CiAgICAgICAgdGhpcy5fdG9wID0gYjsKICAgICAgICB0aGlzLl9yaWdodCA9IGEgKyArZDsKICAgICAgICB0aGlzLl9ib3R0b20gPSBiICsgK2MKICAgIH0KICAgIGNvcHkoYSkgewogICAgICAgIHRoaXMuX2xlZnQgPSArYS5fbGVmdDsKICAgICAgICB0aGlzLl90b3AgPSArYS5fdG9wOwogICAgICAgIHRoaXMuX3JpZ2h0ID0gK2EuX3JpZ2h0OwogICAgICAgIHRoaXMuX2JvdHRvbSA9ICthLl9ib3R0b20KICAgIH0KICAgIGNsb25lKCkgewogICAgICAgIHJldHVybiBuZXcgQzMkanNjb21wJDE1LlJlY3QodGhpcy5fbGVmdCwgdGhpcy5fdG9wLCB0aGlzLl9yaWdodCwgdGhpcy5fYm90dG9tKQogICAgfQogICAgc3RhdGljIE1lcmdlKGEsCiAgICAgICAgYikgewogICAgICAgIGNvbnN0IGQgPSBuZXcgQzMkanNjb21wJDE1LlJlY3Q7CiAgICAgICAgZC5zZXRMZWZ0KE1hdGgubWluKGEuX2xlZnQsIGIuX2xlZnQpKTsKICAgICAgICBkLnNldFRvcChNYXRoLm1pbihhLl90b3AsIGIuX3RvcCkpOwogICAgICAgIGQuc2V0UmlnaHQoTWF0aC5tYXgoYS5fcmlnaHQsIGIuX3JpZ2h0KSk7CiAgICAgICAgZC5zZXRCb3R0b20oTWF0aC5tYXgoYS5fYm90dG9tLCBiLl9ib3R0b20pKTsKICAgICAgICByZXR1cm4gZAogICAgfQogICAgc3RhdGljIEZyb21PYmplY3QoYSkgewogICAgICAgIHJldHVybiBuZXcgQzMkanNjb21wJDE1LlJlY3QoYS5sZWZ0LCBhLnRvcCwgYS5yaWdodCwgYS5ib3R0b20pCiAgICB9CiAgICBlcXVhbHMoYSkgewogICAgICAgIHJldHVybiB0aGlzLl9sZWZ0ID09PSBhLl9sZWZ0ICYmIHRoaXMuX3RvcCA9PT0gYS5fdG9wICYmIHRoaXMuX3JpZ2h0ID09PSBhLl9yaWdodCAmJiB0aGlzLl9ib3R0b20gPT09IGEuX2JvdHRvbQogICAgfQogICAgZXF1YWxzV0goYSwgYiwgZCwgYykgewogICAgICAgIHJldHVybiB0aGlzLl9sZWZ0ID09PSBhICYmIHRoaXMuX3RvcCA9PT0gYiAmJiB0aGlzLndpZHRoKCkgPT09IGQgJiYgdGhpcy5oZWlnaHQoKSA9PT0gYwogICAgfQogICAgZXF1YWxzRjMyQXJyYXkoYSwgYikgewogICAgICAgIHJldHVybiBhW2JdID09PQogICAgICAgICAgICBNYXRoLmZyb3VuZCh0aGlzLl9sZWZ0KSAmJiBhW2IgKyAxXSA9PT0gTWF0aC5mcm91bmQodGhpcy5fdG9wKSAmJiBhW2IgKyAyXSA9PT0gTWF0aC5mcm91bmQodGhpcy5fcmlnaHQpICYmIGFbYiArIDNdID09PSBNYXRoLmZyb3VuZCh0aGlzLl9ib3R0b20pCiAgICB9CiAgICBzZXRMZWZ0KGEpIHsKICAgICAgICB0aGlzLl9sZWZ0ID0gK2EKICAgIH0KICAgIGdldExlZnQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2xlZnQKICAgIH0KICAgIHNldFRvcChhKSB7CiAgICAgICAgdGhpcy5fdG9wID0gK2EKICAgIH0KICAgIGdldFRvcCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdG9wCiAgICB9CiAgICBzZXRSaWdodChhKSB7CiAgICAgICAgdGhpcy5fcmlnaHQgPSArYQogICAgfQogICAgZ2V0UmlnaHQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3JpZ2h0CiAgICB9CiAgICBzZXRCb3R0b20oYSkgewogICAgICAgIHRoaXMuX2JvdHRvbSA9ICthCiAgICB9CiAgICBnZXRCb3R0b20oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2JvdHRvbQogICAgfQogICAgdG9BcnJheSgpIHsKICAgICAgICByZXR1cm4gW3RoaXMuX2xlZnQsIHRoaXMuX3RvcCwgdGhpcy5fcmlnaHQsIHRoaXMuX2JvdHRvbV0KICAgIH0KICAgIHRvVHlwZWRBcnJheSgpIHsKICAgICAgICByZXR1cm4gbmV3IEZsb2F0NjRBcnJheSh0aGlzLnRvQXJyYXkoKSkKICAgIH0KICAgIHRvRE9NUmVjdCgpIHsKICAgICAgICByZXR1cm4gbmV3IERPTVJlY3QodGhpcy5fbGVmdCwKICAgICAgICAgICAgdGhpcy5fdG9wLCB0aGlzLndpZHRoKCksIHRoaXMuaGVpZ2h0KCkpCiAgICB9CiAgICB3cml0ZVRvVHlwZWRBcnJheShhLCBiKSB7CiAgICAgICAgYVtiKytdID0gdGhpcy5fbGVmdDsKICAgICAgICBhW2IrK10gPSB0aGlzLl90b3A7CiAgICAgICAgYVtiKytdID0gdGhpcy5fcmlnaHQ7CiAgICAgICAgYVtiXSA9IHRoaXMuX2JvdHRvbQogICAgfQogICAgd3JpdGVBc1F1YWRUb1R5cGVkQXJyYXkoYSwgYikgewogICAgICAgIGFbYisrXSA9IHRoaXMuX2xlZnQ7CiAgICAgICAgYVtiKytdID0gdGhpcy5fdG9wOwogICAgICAgIGFbYisrXSA9IHRoaXMuX3JpZ2h0OwogICAgICAgIGFbYisrXSA9IHRoaXMuX3RvcDsKICAgICAgICBhW2IrK10gPSB0aGlzLl9yaWdodDsKICAgICAgICBhW2IrK10gPSB0aGlzLl9ib3R0b207CiAgICAgICAgYVtiKytdID0gdGhpcy5fbGVmdDsKICAgICAgICBhW2JdID0gdGhpcy5fYm90dG9tCiAgICB9CiAgICB3cml0ZUFzUXVhZFRvVHlwZWRBcnJheTNEKGEsIGIsIGQpIHsKICAgICAgICBhW2IrK10gPSB0aGlzLl9sZWZ0OwogICAgICAgIGFbYisrXSA9IHRoaXMuX3RvcDsKICAgICAgICBhW2IrK10gPSBkOwogICAgICAgIGFbYisrXSA9IHRoaXMuX3JpZ2h0OwogICAgICAgIGFbYisrXSA9IHRoaXMuX3RvcDsKICAgICAgICBhW2IrK10gPSBkOwogICAgICAgIGFbYisrXSA9IHRoaXMuX3JpZ2h0OwogICAgICAgIGFbYisrXSA9IHRoaXMuX2JvdHRvbTsKICAgICAgICBhW2IrK10gPSBkOwogICAgICAgIGFbYisrXSA9IHRoaXMuX2xlZnQ7CiAgICAgICAgYVtiKytdID0KICAgICAgICAgICAgdGhpcy5fYm90dG9tOwogICAgICAgIGFbYl0gPSBkCiAgICB9CiAgICB3aWR0aCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcmlnaHQgLSB0aGlzLl9sZWZ0CiAgICB9CiAgICBoZWlnaHQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2JvdHRvbSAtIHRoaXMuX3RvcAogICAgfQogICAgbWlkWCgpIHsKICAgICAgICByZXR1cm4gKHRoaXMuX2xlZnQgKyB0aGlzLl9yaWdodCkgLyAyCiAgICB9CiAgICBtaWRZKCkgewogICAgICAgIHJldHVybiAodGhpcy5fdG9wICsgdGhpcy5fYm90dG9tKSAvIDIKICAgIH0KICAgIG9mZnNldChhLCBiKSB7CiAgICAgICAgYSA9ICthOwogICAgICAgIGIgPSArYjsKICAgICAgICB0aGlzLl9sZWZ0ICs9IGE7CiAgICAgICAgdGhpcy5fdG9wICs9IGI7CiAgICAgICAgdGhpcy5fcmlnaHQgKz0gYTsKICAgICAgICB0aGlzLl9ib3R0b20gKz0gYgogICAgfQogICAgb2Zmc2V0TGVmdChhKSB7CiAgICAgICAgdGhpcy5fbGVmdCArPSArYQogICAgfQogICAgb2Zmc2V0VG9wKGEpIHsKICAgICAgICB0aGlzLl90b3AgKz0gK2EKICAgIH0KICAgIG9mZnNldFJpZ2h0KGEpIHsKICAgICAgICB0aGlzLl9yaWdodCArPSArYQogICAgfQogICAgb2Zmc2V0Qm90dG9tKGEpIHsKICAgICAgICB0aGlzLl9ib3R0b20gKz0gK2EKICAgIH0KICAgIHRvU3F1YXJlKGEpIHsKICAgICAgICBpZiAoIngiICE9PSBhKSB0aHJvdyBFcnJvcigiaW52YWxpZCBheGlzLCBvbmx5ICd4JyBzdXBwb3J0ZWQiKTsKICAgICAgICB0aGlzLl9ib3R0b20gPSB0aGlzLl90b3AgPCB0aGlzLl9ib3R0b20gPyB0aGlzLl9sZWZ0IDwgdGhpcy5fcmlnaHQgPwogICAgICAgICAgICB0aGlzLl90b3AgKyB0aGlzLndpZHRoKCkgOiB0aGlzLl90b3AgLSB0aGlzLndpZHRoKCkgOiB0aGlzLl9sZWZ0IDwgdGhpcy5fcmlnaHQgPyB0aGlzLl90b3AgLSB0aGlzLndpZHRoKCkgOiB0aGlzLl90b3AgKyB0aGlzLndpZHRoKCkKICAgIH0KICAgIGluZmxhdGUoYSwgYikgewogICAgICAgIGEgPSArYTsKICAgICAgICBiID0gK2I7CiAgICAgICAgdGhpcy5fbGVmdCAtPSBhOwogICAgICAgIHRoaXMuX3RvcCAtPSBiOwogICAgICAgIHRoaXMuX3JpZ2h0ICs9IGE7CiAgICAgICAgdGhpcy5fYm90dG9tICs9IGIKICAgIH0KICAgIGRlZmxhdGUoYSwgYikgewogICAgICAgIGEgPSArYTsKICAgICAgICBiID0gK2I7CiAgICAgICAgdGhpcy5fbGVmdCArPSBhOwogICAgICAgIHRoaXMuX3RvcCArPSBiOwogICAgICAgIHRoaXMuX3JpZ2h0IC09IGE7CiAgICAgICAgdGhpcy5fYm90dG9tIC09IGIKICAgIH0KICAgIG11bHRpcGx5KGEsIGIpIHsKICAgICAgICB0aGlzLl9sZWZ0ICo9IGE7CiAgICAgICAgdGhpcy5fdG9wICo9IGI7CiAgICAgICAgdGhpcy5fcmlnaHQgKj0gYTsKICAgICAgICB0aGlzLl9ib3R0b20gKj0gYgogICAgfQogICAgZGl2aWRlKGEsIGIpIHsKICAgICAgICB0aGlzLl9sZWZ0IC89IGE7CiAgICAgICAgdGhpcy5fdG9wIC89IGI7CiAgICAgICAgdGhpcy5fcmlnaHQgLz0gYTsKICAgICAgICB0aGlzLl9ib3R0b20gLz0gYgogICAgfQogICAgbWlycm9yQXJvdW5kKGEpIHsKICAgICAgICB0aGlzLl9sZWZ0ID0gK2EgLSB0aGlzLl9sZWZ0OwogICAgICAgIHRoaXMuX3JpZ2h0ID0gK2EgLSB0aGlzLl9yaWdodAogICAgfQogICAgZmxpcEFyb3VuZChhKSB7CiAgICAgICAgdGhpcy5fdG9wID0gK2EgLSB0aGlzLl90b3A7CiAgICAgICAgdGhpcy5fYm90dG9tID0gK2EgLSB0aGlzLl9ib3R0b20KICAgIH0KICAgIHJvdGF0ZTkwRGVncmVlc0Fyb3VuZChhLCBiKSB7CiAgICAgICAgY29uc3QgZCA9IHRoaXMud2lkdGgoKSwKICAgICAgICAgICAgYyA9IHRoaXMuaGVpZ2h0KCksCiAgICAgICAgICAgIGUgPSB0aGlzLmdldExlZnQoKSArIGQgKiBhLAogICAgICAgICAgICBnID0gdGhpcy5nZXRUb3AoKSArIGMgKiBiOwogICAgICAgIHRoaXMuc2V0V0goZSAtIGMgKiBiLCBnIC0gZCAqIGEsIGMsIGQpCiAgICB9CiAgICBzd2FwTGVmdFJpZ2h0KCkgewogICAgICAgIGNvbnN0IGEgPSB0aGlzLl9sZWZ0OwogICAgICAgIHRoaXMuX2xlZnQgPSB0aGlzLl9yaWdodDsKICAgICAgICB0aGlzLl9yaWdodCA9IGEKICAgIH0KICAgIHN3YXBUb3BCb3R0b20oKSB7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuX3RvcDsKICAgICAgICB0aGlzLl90b3AgPSB0aGlzLl9ib3R0b207CiAgICAgICAgdGhpcy5fYm90dG9tID0gYQogICAgfQogICAgc2h1bnRZKGEpIHsKICAgICAgICBjb25zdCBiID0gdGhpcy5fdG9wOwogICAgICAgIHRoaXMuX3RvcCA9ICthIC0gdGhpcy5fYm90dG9tOwogICAgICAgIHRoaXMuX2JvdHRvbSA9ICthIC0gYgogICAgfQogICAgcm91bmQoKSB7CiAgICAgICAgdGhpcy5fbGVmdCA9IE1hdGgucm91bmQodGhpcy5fbGVmdCk7CiAgICAgICAgdGhpcy5fdG9wID0gTWF0aC5yb3VuZCh0aGlzLl90b3ApOwogICAgICAgIHRoaXMuX3JpZ2h0ID0gTWF0aC5yb3VuZCh0aGlzLl9yaWdodCk7CiAgICAgICAgdGhpcy5fYm90dG9tID0gTWF0aC5yb3VuZCh0aGlzLl9ib3R0b20pCiAgICB9CiAgICByb3VuZElubmVyKCkgewogICAgICAgIHRoaXMuX2xlZnQgPSBNYXRoLmNlaWwodGhpcy5fbGVmdCk7CiAgICAgICAgdGhpcy5fdG9wID0gTWF0aC5jZWlsKHRoaXMuX3RvcCk7CiAgICAgICAgdGhpcy5fcmlnaHQgPSBNYXRoLmZsb29yKHRoaXMuX3JpZ2h0KTsKICAgICAgICB0aGlzLl9ib3R0b20gPSBNYXRoLmZsb29yKHRoaXMuX2JvdHRvbSkKICAgIH0KICAgIHJvdW5kT3V0ZXIoKSB7CiAgICAgICAgdGhpcy5fbGVmdCA9IE1hdGguZmxvb3IodGhpcy5fbGVmdCk7CiAgICAgICAgdGhpcy5fdG9wID0gTWF0aC5mbG9vcih0aGlzLl90b3ApOwogICAgICAgIHRoaXMuX3JpZ2h0ID0gTWF0aC5jZWlsKHRoaXMuX3JpZ2h0KTsKICAgICAgICB0aGlzLl9ib3R0b20gPSBNYXRoLmNlaWwodGhpcy5fYm90dG9tKQogICAgfQogICAgZmxvb3IoKSB7CiAgICAgICAgdGhpcy5fbGVmdCA9IE1hdGguZmxvb3IodGhpcy5fbGVmdCk7CiAgICAgICAgdGhpcy5fdG9wID0gTWF0aC5mbG9vcih0aGlzLl90b3ApOwogICAgICAgIHRoaXMuX3JpZ2h0ID0gTWF0aC5mbG9vcih0aGlzLl9yaWdodCk7CiAgICAgICAgdGhpcy5fYm90dG9tID0gTWF0aC5mbG9vcih0aGlzLl9ib3R0b20pCiAgICB9CiAgICBjZWlsKCkgewogICAgICAgIHRoaXMuX2xlZnQgPQogICAgICAgICAgICBNYXRoLmNlaWwodGhpcy5fbGVmdCk7CiAgICAgICAgdGhpcy5fdG9wID0gTWF0aC5jZWlsKHRoaXMuX3RvcCk7CiAgICAgICAgdGhpcy5fcmlnaHQgPSBNYXRoLmNlaWwodGhpcy5fcmlnaHQpOwogICAgICAgIHRoaXMuX2JvdHRvbSA9IE1hdGguY2VpbCh0aGlzLl9ib3R0b20pCiAgICB9CiAgICBjbGFtcChhLCBiLCBkLCBjKSB7CiAgICAgICAgdGhpcy5fbGVmdCA8IGEgJiYgKHRoaXMuX2xlZnQgPSArYSk7CiAgICAgICAgdGhpcy5fdG9wIDwgYiAmJiAodGhpcy5fdG9wID0gK2IpOwogICAgICAgIHRoaXMuX3JpZ2h0ID4gZCAmJiAodGhpcy5fcmlnaHQgPSArZCk7CiAgICAgICAgdGhpcy5fYm90dG9tID4gYyAmJiAodGhpcy5fYm90dG9tID0gK2MpCiAgICB9CiAgICBjbGFtcEZsaXBwZWQoYSwgYiwgZCwgYykgewogICAgICAgIHRoaXMuX2xlZnQgPCBhICYmICh0aGlzLl9sZWZ0ID0gK2EpOwogICAgICAgIHRoaXMuX3RvcCA+IGIgJiYgKHRoaXMuX3RvcCA9ICtiKTsKICAgICAgICB0aGlzLl9yaWdodCA+IGQgJiYgKHRoaXMuX3JpZ2h0ID0gK2QpOwogICAgICAgIHRoaXMuX2JvdHRvbSA8IGMgJiYgKHRoaXMuX2JvdHRvbSA9ICtjKQogICAgfQogICAgbm9ybWFsaXplKCkgewogICAgICAgIHRoaXMuX2xlZnQgPiB0aGlzLl9yaWdodCAmJiB0aGlzLnN3YXBMZWZ0UmlnaHQoKTsKICAgICAgICB0aGlzLl90b3AgPiB0aGlzLl9ib3R0b20gJiYgdGhpcy5zd2FwVG9wQm90dG9tKCkKICAgIH0KICAgIGludGVyc2VjdHNSZWN0KGEpIHsKICAgICAgICByZXR1cm4gIShhLl9yaWdodCA8CiAgICAgICAgICAgIHRoaXMuX2xlZnQgfHwgYS5fYm90dG9tIDwgdGhpcy5fdG9wIHx8IGEuX2xlZnQgPiB0aGlzLl9yaWdodCB8fCBhLl90b3AgPiB0aGlzLl9ib3R0b20pCiAgICB9CiAgICBpbnRlcnNlY3RzUmVjdE9mZnNldChhLCBiLCBkKSB7CiAgICAgICAgcmV0dXJuICEoYS5fcmlnaHQgKyBiIDwgdGhpcy5fbGVmdCB8fCBhLl9ib3R0b20gKyBkIDwgdGhpcy5fdG9wIHx8IGEuX2xlZnQgKyBiID4gdGhpcy5fcmlnaHQgfHwgYS5fdG9wICsgZCA+IHRoaXMuX2JvdHRvbSkKICAgIH0KICAgIGNvbnRhaW5zUG9pbnQoYSwgYikgewogICAgICAgIHJldHVybiBhID49IHRoaXMuX2xlZnQgJiYgYSA8PSB0aGlzLl9yaWdodCAmJiBiID49IHRoaXMuX3RvcCAmJiBiIDw9IHRoaXMuX2JvdHRvbQogICAgfQogICAgY29udGFpbnNSZWN0KGEpIHsKICAgICAgICByZXR1cm4gYS5fbGVmdCA+PSB0aGlzLl9sZWZ0ICYmIGEuX3RvcCA+PSB0aGlzLl90b3AgJiYgYS5fcmlnaHQgPD0gdGhpcy5fcmlnaHQgJiYgYS5fYm90dG9tIDw9IHRoaXMuX2JvdHRvbQogICAgfQogICAgZXhwYW5kVG9Db250YWluKGEpIHsKICAgICAgICBhLl9sZWZ0IDwgdGhpcy5fbGVmdCAmJiAodGhpcy5fbGVmdCA9ICthLl9sZWZ0KTsKICAgICAgICBhLl90b3AgPCB0aGlzLl90b3AgJiYgKHRoaXMuX3RvcCA9ICthLl90b3ApOwogICAgICAgIGEuX3JpZ2h0ID4KICAgICAgICAgICAgdGhpcy5fcmlnaHQgJiYgKHRoaXMuX3JpZ2h0ID0gK2EuX3JpZ2h0KTsKICAgICAgICBhLl9ib3R0b20gPiB0aGlzLl9ib3R0b20gJiYgKHRoaXMuX2JvdHRvbSA9ICthLl9ib3R0b20pCiAgICB9CiAgICBsZXJwSW50byhhKSB7CiAgICAgICAgdGhpcy5fbGVmdCA9IEMzJGpzY29tcCQxNS5sZXJwKGEuX2xlZnQsIGEuX3JpZ2h0LCB0aGlzLl9sZWZ0KTsKICAgICAgICB0aGlzLl90b3AgPSBDMyRqc2NvbXAkMTUubGVycChhLl90b3AsIGEuX2JvdHRvbSwgdGhpcy5fdG9wKTsKICAgICAgICB0aGlzLl9yaWdodCA9IEMzJGpzY29tcCQxNS5sZXJwKGEuX2xlZnQsIGEuX3JpZ2h0LCB0aGlzLl9yaWdodCk7CiAgICAgICAgdGhpcy5fYm90dG9tID0gQzMkanNjb21wJDE1LmxlcnAoYS5fdG9wLCBhLl9ib3R0b20sIHRoaXMuX2JvdHRvbSkKICAgIH0KfTsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkMTYgPSBzZWxmLkMzOwpDMyRqc2NvbXAkMTYuUXVhZCA9IGNsYXNzIHsKICAgIGNvbnN0cnVjdG9yKGEsIGIsIGQsIGMsIGUsIGcsIGssIG0pIHsKICAgICAgICB0aGlzLl9ibHkgPSB0aGlzLl9ibHggPSB0aGlzLl9icnkgPSB0aGlzLl9icnggPSB0aGlzLl90cnkgPSB0aGlzLl90cnggPSB0aGlzLl90bHkgPSB0aGlzLl90bHggPSAwOwogICAgICAgIGEgaW5zdGFuY2VvZiBDMyRqc2NvbXAkMTYuUXVhZCA/IHRoaXMuY29weShhKSA6IHRoaXMuc2V0KGEgfHwgMCwgYiB8fCAwLCBkIHx8IDAsIGMgfHwgMCwgZSB8fCAwLCBnIHx8IDAsIGsgfHwgMCwgbSB8fCAwKQogICAgfQogICAgc2V0KGEsIGIsIGQsIGMsIGUsIGcsIGssIG0pIHsKICAgICAgICB0aGlzLl90bHggPSArYTsKICAgICAgICB0aGlzLl90bHkgPSArYjsKICAgICAgICB0aGlzLl90cnggPSArZDsKICAgICAgICB0aGlzLl90cnkgPSArYzsKICAgICAgICB0aGlzLl9icnggPSArZTsKICAgICAgICB0aGlzLl9icnkgPSArZzsKICAgICAgICB0aGlzLl9ibHggPSArazsKICAgICAgICB0aGlzLl9ibHkgPSArbQogICAgfQogICAgc2V0UmVjdChhLCBiLCBkLCBjKSB7CiAgICAgICAgdGhpcy5zZXQoYSwgYiwgZCwgYiwgZCwgYywgYSwgYykKICAgIH0KICAgIGNvcHkoYSkgewogICAgICAgIHRoaXMuX3RseCA9IGEuX3RseDsKICAgICAgICB0aGlzLl90bHkgPSBhLl90bHk7CiAgICAgICAgdGhpcy5fdHJ4ID0gYS5fdHJ4OwogICAgICAgIHRoaXMuX3RyeSA9IGEuX3RyeTsKICAgICAgICB0aGlzLl9icnggPSBhLl9icng7CiAgICAgICAgdGhpcy5fYnJ5ID0gYS5fYnJ5OwogICAgICAgIHRoaXMuX2JseCA9IGEuX2JseDsKICAgICAgICB0aGlzLl9ibHkgPSBhLl9ibHkKICAgIH0KICAgIGVxdWFscyhhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3RseCA9PT0gYS5fdGx4ICYmIHRoaXMuX3RseSA9PT0gYS5fdGx5ICYmIHRoaXMuX3RyeCA9PT0gYS5fdHJ4ICYmIHRoaXMuX3RyeSA9PT0gYS5fdHJ5ICYmIHRoaXMuX2JyeCA9PT0gYS5fYnJ4ICYmIHRoaXMuX2JyeSA9PT0gYS5fYnJ5ICYmIHRoaXMuX2JseCA9PT0gYS5fYmx4ICYmIHRoaXMuX2JseSA9PT0gYS5fYmx5CiAgICB9CiAgICBzZXRUbHgoYSkgewogICAgICAgIHRoaXMuX3RseCA9ICthCiAgICB9CiAgICBnZXRUbHgoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3RseAogICAgfQogICAgc2V0VGx5KGEpIHsKICAgICAgICB0aGlzLl90bHkgPSArYQogICAgfQogICAgZ2V0VGx5KCkgewogICAgICAgIHJldHVybiB0aGlzLl90bHkKICAgIH0KICAgIHNldFRyeChhKSB7CiAgICAgICAgdGhpcy5fdHJ4ID0gK2EKICAgIH0KICAgIGdldFRyeCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdHJ4CiAgICB9CiAgICBzZXRUcnkoYSkgewogICAgICAgIHRoaXMuX3RyeSA9ICthCiAgICB9CiAgICBnZXRUcnkoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3RyeQogICAgfQogICAgc2V0QnJ4KGEpIHsKICAgICAgICB0aGlzLl9icnggPSArYQogICAgfQogICAgZ2V0QnJ4KCkgewogICAgICAgIHJldHVybiB0aGlzLl9icngKICAgIH0KICAgIHNldEJyeShhKSB7CiAgICAgICAgdGhpcy5fYnJ5ID0gK2EKICAgIH0KICAgIGdldEJyeSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fYnJ5CiAgICB9CiAgICBzZXRCbHgoYSkgewogICAgICAgIHRoaXMuX2JseCA9ICthCiAgICB9CiAgICBnZXRCbHgoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2JseAogICAgfQogICAgc2V0Qmx5KGEpIHsKICAgICAgICB0aGlzLl9ibHkgPSArYQogICAgfQogICAgZ2V0Qmx5KCkgewogICAgICAgIHJldHVybiB0aGlzLl9ibHkKICAgIH0KICAgIHRvRE9NUXVhZCgpIHsKICAgICAgICByZXR1cm4gbmV3IERPTVF1YWQobmV3IERPTVBvaW50KHRoaXMuX3RseCwgdGhpcy5fdGx5KSwgbmV3IERPTVBvaW50KHRoaXMuX3RyeCwgdGhpcy5fdHJ5KSwgbmV3IERPTVBvaW50KHRoaXMuX2JyeCwgdGhpcy5fYnJ5KSwgbmV3IERPTVBvaW50KHRoaXMuX2JseCwgdGhpcy5fYmx5KSkKICAgIH0KICAgIHRvQXJyYXkoKSB7CiAgICAgICAgcmV0dXJuIFt0aGlzLl90bHgsIHRoaXMuX3RseSwgdGhpcy5fdHJ4LCB0aGlzLl90cnksIHRoaXMuX2JyeCwgdGhpcy5fYnJ5LCB0aGlzLl9ibHgsIHRoaXMuX2JseV0KICAgIH0KICAgIHRvVHlwZWRBcnJheSgpIHsKICAgICAgICByZXR1cm4gbmV3IEZsb2F0NjRBcnJheSh0aGlzLnRvQXJyYXkoKSkKICAgIH0KICAgIHdyaXRlVG9UeXBlZEFycmF5KGEsIGIpIHsKICAgICAgICBhW2IrK10gPSB0aGlzLl90bHg7CiAgICAgICAgYVtiKytdID0gdGhpcy5fdGx5OwogICAgICAgIGFbYisrXSA9IHRoaXMuX3RyeDsKICAgICAgICBhW2IrK10gPSB0aGlzLl90cnk7CiAgICAgICAgYVtiKytdID0gdGhpcy5fYnJ4OwogICAgICAgIGFbYisrXSA9IHRoaXMuX2JyeTsKICAgICAgICBhW2IrK10gPSB0aGlzLl9ibHg7CiAgICAgICAgYVtiXSA9IHRoaXMuX2JseQogICAgfQogICAgd3JpdGVUb1R5cGVkQXJyYXkzRChhLCBiLCBkKSB7CiAgICAgICAgYVtiKytdID0gdGhpcy5fdGx4OwogICAgICAgIGFbYisrXSA9IHRoaXMuX3RseTsKICAgICAgICBhW2IrK10gPSBkOwogICAgICAgIGFbYisrXSA9IHRoaXMuX3RyeDsKICAgICAgICBhW2IrK10gPSB0aGlzLl90cnk7CiAgICAgICAgYVtiKytdID0gZDsKICAgICAgICBhW2IrK10gPSB0aGlzLl9icng7CiAgICAgICAgYVtiKytdID0gdGhpcy5fYnJ5OwogICAgICAgIGFbYisrXSA9IGQ7CiAgICAgICAgYVtiKytdID0gdGhpcy5fYmx4OwogICAgICAgIGFbYisrXSA9IHRoaXMuX2JseTsKICAgICAgICBhW2JdID0gZAogICAgfQogICAgb2Zmc2V0KGEsIGIpIHsKICAgICAgICBhID0gK2E7CiAgICAgICAgYiA9ICtiOwogICAgICAgIHRoaXMuX3RseCArPSBhOwogICAgICAgIHRoaXMuX3RseSArPSBiOwogICAgICAgIHRoaXMuX3RyeCArPSBhOwogICAgICAgIHRoaXMuX3RyeSArPSBiOwogICAgICAgIHRoaXMuX2JyeCArPSBhOwogICAgICAgIHRoaXMuX2JyeSArPSBiOwogICAgICAgIHRoaXMuX2JseCArPSBhOwogICAgICAgIHRoaXMuX2JseSArPSBiCiAgICB9CiAgICByb3VuZCgpIHsKICAgICAgICB0aGlzLl90bHggPSBNYXRoLnJvdW5kKHRoaXMuX3RseCk7CiAgICAgICAgdGhpcy5fdGx5ID0gTWF0aC5yb3VuZCh0aGlzLl90bHkpOwogICAgICAgIHRoaXMuX3RyeCA9IE1hdGgucm91bmQodGhpcy5fdHJ4KTsKICAgICAgICB0aGlzLl90cnkgPSBNYXRoLnJvdW5kKHRoaXMuX3RyeSk7CiAgICAgICAgdGhpcy5fYnJ4ID0gTWF0aC5yb3VuZCh0aGlzLl9icngpOwogICAgICAgIHRoaXMuX2JyeSA9IE1hdGgucm91bmQodGhpcy5fYnJ5KTsKICAgICAgICB0aGlzLl9ibHggPSBNYXRoLnJvdW5kKHRoaXMuX2JseCk7CiAgICAgICAgdGhpcy5fYmx5ID0gTWF0aC5yb3VuZCh0aGlzLl9ibHkpCiAgICB9CiAgICBmbG9vcigpIHsKICAgICAgICB0aGlzLl90bHggPSBNYXRoLmZsb29yKHRoaXMuX3RseCk7CiAgICAgICAgdGhpcy5fdGx5ID0gTWF0aC5mbG9vcih0aGlzLl90bHkpOwogICAgICAgIHRoaXMuX3RyeCA9IE1hdGguZmxvb3IodGhpcy5fdHJ4KTsKICAgICAgICB0aGlzLl90cnkgPSBNYXRoLmZsb29yKHRoaXMuX3RyeSk7CiAgICAgICAgdGhpcy5fYnJ4ID0gTWF0aC5mbG9vcih0aGlzLl9icngpOwogICAgICAgIHRoaXMuX2JyeSA9IE1hdGguZmxvb3IodGhpcy5fYnJ5KTsKICAgICAgICB0aGlzLl9ibHggPSBNYXRoLmZsb29yKHRoaXMuX2JseCk7CiAgICAgICAgdGhpcy5fYmx5ID0gTWF0aC5mbG9vcih0aGlzLl9ibHkpCiAgICB9CiAgICBjZWlsKCkgewogICAgICAgIHRoaXMuX3RseCA9IE1hdGguY2VpbCh0aGlzLl90bHgpOwogICAgICAgIHRoaXMuX3RseSA9IE1hdGguY2VpbCh0aGlzLl90bHkpOwogICAgICAgIHRoaXMuX3RyeCA9IE1hdGguY2VpbCh0aGlzLl90cngpOwogICAgICAgIHRoaXMuX3RyeSA9CiAgICAgICAgICAgIE1hdGguY2VpbCh0aGlzLl90cnkpOwogICAgICAgIHRoaXMuX2JyeCA9IE1hdGguY2VpbCh0aGlzLl9icngpOwogICAgICAgIHRoaXMuX2JyeSA9IE1hdGguY2VpbCh0aGlzLl9icnkpOwogICAgICAgIHRoaXMuX2JseCA9IE1hdGguY2VpbCh0aGlzLl9ibHgpOwogICAgICAgIHRoaXMuX2JseSA9IE1hdGguY2VpbCh0aGlzLl9ibHkpCiAgICB9CiAgICBzZXRGcm9tUmVjdChhKSB7CiAgICAgICAgdGhpcy5fdGx4ID0gYS5fbGVmdDsKICAgICAgICB0aGlzLl90bHkgPSBhLl90b3A7CiAgICAgICAgdGhpcy5fdHJ4ID0gYS5fcmlnaHQ7CiAgICAgICAgdGhpcy5fdHJ5ID0gYS5fdG9wOwogICAgICAgIHRoaXMuX2JyeCA9IGEuX3JpZ2h0OwogICAgICAgIHRoaXMuX2JyeSA9IGEuX2JvdHRvbTsKICAgICAgICB0aGlzLl9ibHggPSBhLl9sZWZ0OwogICAgICAgIHRoaXMuX2JseSA9IGEuX2JvdHRvbQogICAgfQogICAgc2V0RnJvbVJvdGF0ZWRSZWN0KGEsIGIpIHsKICAgICAgICAwID09PSBiID8gdGhpcy5zZXRGcm9tUmVjdChhKSA6IHRoaXMuc2V0RnJvbVJvdGF0ZWRSZWN0UHJlY2FsYyhhLCBNYXRoLnNpbihiKSwgTWF0aC5jb3MoYikpCiAgICB9CiAgICBzZXRGcm9tUm90YXRlZFJlY3RQcmVjYWxjKGEsIGIsIGQpIHsKICAgICAgICBjb25zdCBjID0gYS5fbGVmdCAqIGIsCiAgICAgICAgICAgIGUgPSBhLl90b3AgKiBiLAogICAgICAgICAgICBnID0gYS5fcmlnaHQgKiBiOwogICAgICAgIGIgKj0gYS5fYm90dG9tOwogICAgICAgIGNvbnN0IGsgPSBhLl9sZWZ0ICogZCwKICAgICAgICAgICAgbSA9IGEuX3RvcCAqIGQsCiAgICAgICAgICAgIG4gPSBhLl9yaWdodCAqIGQ7CiAgICAgICAgYSA9IGEuX2JvdHRvbSAqIGQ7CiAgICAgICAgdGhpcy5fdGx4ID0gayAtIGU7CiAgICAgICAgdGhpcy5fdGx5ID0gbSArIGM7CiAgICAgICAgdGhpcy5fdHJ4ID0gbiAtIGU7CiAgICAgICAgdGhpcy5fdHJ5ID0gbSArIGc7CiAgICAgICAgdGhpcy5fYnJ4ID0gbiAtIGI7CiAgICAgICAgdGhpcy5fYnJ5ID0gYSArIGc7CiAgICAgICAgdGhpcy5fYmx4ID0gayAtIGI7CiAgICAgICAgdGhpcy5fYmx5ID0gYSArIGMKICAgIH0KICAgIGdldEJvdW5kaW5nQm94KGEpIHsKICAgICAgICBhLnNldChNYXRoLm1pbih0aGlzLl90bHgsIHRoaXMuX3RyeCwgdGhpcy5fYnJ4LCB0aGlzLl9ibHgpLCBNYXRoLm1pbih0aGlzLl90bHksIHRoaXMuX3RyeSwgdGhpcy5fYnJ5LCB0aGlzLl9ibHkpLCBNYXRoLm1heCh0aGlzLl90bHgsIHRoaXMuX3RyeCwgdGhpcy5fYnJ4LCB0aGlzLl9ibHgpLCBNYXRoLm1heCh0aGlzLl90bHksIHRoaXMuX3RyeSwgdGhpcy5fYnJ5LCB0aGlzLl9ibHkpKQogICAgfQogICAgY29udGFpbnNQb2ludChhLCBiKSB7CiAgICAgICAgdmFyIGQgPSB0aGlzLl90cnggLSB0aGlzLl90bHgsCiAgICAgICAgICAgIGMgPSB0aGlzLl90cnkgLSB0aGlzLl90bHk7CiAgICAgICAgY29uc3QgZSA9IHRoaXMuX2JyeCAtIHRoaXMuX3RseCwKICAgICAgICAgICAgZyA9IHRoaXMuX2JyeSAtIHRoaXMuX3RseTsKICAgICAgICBhIC09IHRoaXMuX3RseDsKICAgICAgICBiIC09IHRoaXMuX3RseTsKICAgICAgICB2YXIgayA9IGQgKiBkICsgYyAqIGM7CiAgICAgICAgbGV0IG0gPSBkICogZSArIGMgKiBnOwogICAgICAgIGMgPSBkICogYSArIGMgKiBiOwogICAgICAgIGNvbnN0IG4gPSBlICogZSArIGcgKiBnLAogICAgICAgICAgICBxID0gZSAqIGEgKyBnICogYjsKICAgICAgICBsZXQgdSA9IDEgLyAoayAqIG4gLSBtICogbSk7CiAgICAgICAgZCA9IChuICogYyAtIG0gKiBxKSAqIHU7CiAgICAgICAgayA9IChrICogcSAtIG0gKiBjKSAqIHU7CiAgICAgICAgaWYgKDAgPD0gZCAmJiAwIDwgayAmJiAxID4gZCArIGspIHJldHVybiAhMDsKICAgICAgICBkID0gdGhpcy5fYmx4IC0gdGhpcy5fdGx4OwogICAgICAgIGMgPSB0aGlzLl9ibHkgLSB0aGlzLl90bHk7CiAgICAgICAgayA9IGQgKiBkICsgYyAqIGM7CiAgICAgICAgbSA9IGQgKiBlICsgYyAqIGc7CiAgICAgICAgYyA9IGQgKiBhICsgYyAqIGI7CiAgICAgICAgdSA9IDEgLyAoayAqIG4gLSBtICogbSk7CiAgICAgICAgZCA9IChuICogYyAtIG0gKiBxKSAqIHU7CiAgICAgICAgayA9IChrICogcSAtIG0gKiBjKSAqIHU7CiAgICAgICAgcmV0dXJuIDAgPD0gZCAmJiAwIDwgayAmJiAxID4gZCArIGsKICAgIH0KICAgIG1pZFgoKSB7CiAgICAgICAgcmV0dXJuICh0aGlzLl90bHggKyB0aGlzLl90cnggKyB0aGlzLl9icnggKyB0aGlzLl9ibHgpIC8gNAogICAgfQogICAgbWlkWSgpIHsKICAgICAgICByZXR1cm4gKHRoaXMuX3RseSArIHRoaXMuX3RyeSArIHRoaXMuX2JyeSArIHRoaXMuX2JseSkgLyA0CiAgICB9CiAgICBpbnRlcnNlY3RzU2VnbWVudChhLCBiLCBkLCBjKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY29udGFpbnNQb2ludChhLCBiKSB8fCB0aGlzLmNvbnRhaW5zUG9pbnQoZCwgYykgPwogICAgICAgICAgICAhMCA6IEMzJGpzY29tcCQxNi5zZWdtZW50SW50ZXJzZWN0c1F1YWQoYSwgYiwgZCwgYywgdGhpcykKICAgIH0KICAgIGludGVyc2VjdHNRdWFkKGEpIHsKICAgICAgICB2YXIgYiA9IGEubWlkWCgpLAogICAgICAgICAgICBkID0gYS5taWRZKCk7CiAgICAgICAgaWYgKHRoaXMuY29udGFpbnNQb2ludChiLCBkKSkgcmV0dXJuICEwOwogICAgICAgIGIgPSB0aGlzLm1pZFgoKTsKICAgICAgICBkID0gdGhpcy5taWRZKCk7CiAgICAgICAgaWYgKGEuY29udGFpbnNQb2ludChiLCBkKSkgcmV0dXJuICEwOwogICAgICAgIGIgPSB0aGlzLl90bHg7CiAgICAgICAgZCA9IHRoaXMuX3RseTsKICAgICAgICBjb25zdCBjID0gdGhpcy5fdHJ4LAogICAgICAgICAgICBlID0gdGhpcy5fdHJ5LAogICAgICAgICAgICBnID0gdGhpcy5fYnJ4LAogICAgICAgICAgICBrID0gdGhpcy5fYnJ5LAogICAgICAgICAgICBtID0gdGhpcy5fYmx4LAogICAgICAgICAgICBuID0gdGhpcy5fYmx5OwogICAgICAgIHJldHVybiBDMyRqc2NvbXAkMTYuc2VnbWVudEludGVyc2VjdHNRdWFkKGIsIGQsIGMsIGUsIGEpIHx8IEMzJGpzY29tcCQxNi5zZWdtZW50SW50ZXJzZWN0c1F1YWQoYywgZSwgZywgaywgYSkgfHwgQzMkanNjb21wJDE2LnNlZ21lbnRJbnRlcnNlY3RzUXVhZChnLCBrLCBtLCBuLCBhKSB8fCBDMyRqc2NvbXAkMTYuc2VnbWVudEludGVyc2VjdHNRdWFkKG0sIG4sIGIsIGQsIGEpCiAgICB9CiAgICByb3RhdGVQb2ludHNBbnRpY2xvY2t3aXNlKCkgewogICAgICAgIGNvbnN0IGEgPQogICAgICAgICAgICB0aGlzLl90bHgsCiAgICAgICAgICAgIGIgPSB0aGlzLl90bHk7CiAgICAgICAgdGhpcy5fdGx4ID0gdGhpcy5fdHJ4OwogICAgICAgIHRoaXMuX3RseSA9IHRoaXMuX3RyeTsKICAgICAgICB0aGlzLl90cnggPSB0aGlzLl9icng7CiAgICAgICAgdGhpcy5fdHJ5ID0gdGhpcy5fYnJ5OwogICAgICAgIHRoaXMuX2JyeCA9IHRoaXMuX2JseDsKICAgICAgICB0aGlzLl9icnkgPSB0aGlzLl9ibHk7CiAgICAgICAgdGhpcy5fYmx4ID0gYTsKICAgICAgICB0aGlzLl9ibHkgPSBiCiAgICB9CiAgICBtaXJyb3IoKSB7CiAgICAgICAgdGhpcy5fc3dhcCgwLCAyKTsKICAgICAgICB0aGlzLl9zd2FwKDEsIDMpOwogICAgICAgIHRoaXMuX3N3YXAoNiwgNCk7CiAgICAgICAgdGhpcy5fc3dhcCg3LCA1KQogICAgfQogICAgZmxpcCgpIHsKICAgICAgICB0aGlzLl9zd2FwKDAsIDYpOwogICAgICAgIHRoaXMuX3N3YXAoMSwgNyk7CiAgICAgICAgdGhpcy5fc3dhcCgyLCA0KTsKICAgICAgICB0aGlzLl9zd2FwKDMsIDUpCiAgICB9CiAgICBkaWFnKCkgewogICAgICAgIHRoaXMuX3N3YXAoMiwgNik7CiAgICAgICAgdGhpcy5fc3dhcCgzLCA3KQogICAgfQogICAgX3N3YXAoYSwgYikgewogICAgICAgIGNvbnN0IGQgPSB0aGlzLl9nZXRBdEluZGV4KGEpOwogICAgICAgIHRoaXMuX3NldEF0SW5kZXgoYSwgdGhpcy5fZ2V0QXRJbmRleChiKSk7CiAgICAgICAgdGhpcy5fc2V0QXRJbmRleChiLCBkKQogICAgfQogICAgX2dldEF0SW5kZXgoYSkgewogICAgICAgIHN3aXRjaCAoYSkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fdGx4OwogICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fdGx5OwogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fdHJ4OwogICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fdHJ5OwogICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fYnJ4OwogICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fYnJ5OwogICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fYmx4OwogICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fYmx5OwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoImludmFsaWQgcXVhZCBwb2ludCBpbmRleCIpOwogICAgICAgIH0KICAgIH0KICAgIF9zZXRBdEluZGV4KGEsIGIpIHsKICAgICAgICBiID0gK2I7CiAgICAgICAgc3dpdGNoIChhKSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIHRoaXMuX3RseCA9IGI7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgdGhpcy5fdGx5ID0gYjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICB0aGlzLl90cnggPSBiOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgIHRoaXMuX3RyeSA9IGI7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgdGhpcy5fYnJ4ID0gYjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICB0aGlzLl9icnkgPSBiOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICAgIHRoaXMuX2JseCA9IGI7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgdGhpcy5fYmx5ID0gYjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoImludmFsaWQgcXVhZCBwb2ludCBpbmRleCIpOwogICAgICAgIH0KICAgIH0KfTsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkMTcgPSBzZWxmLkMzLAogICAgREVGQVVMVF9QT0xZX1BPSU5UUyA9IFswLCAwLCAxLCAwLCAxLCAxLCAwLCAxXSwKICAgIHRlbXBRdWFkID0gQzMkanNjb21wJDE3Lk5ldyhDMyRqc2NvbXAkMTcuUXVhZCk7CkMzJGpzY29tcCQxNy5Db2xsaXNpb25Qb2x5ID0gY2xhc3MgZXh0ZW5kcyBDMyRqc2NvbXAkMTcuRGVmZW5kZWRCYXNlIHsKICAgIGNvbnN0cnVjdG9yKGEsIGIgPSAhMCkgewogICAgICAgIHN1cGVyKCk7CiAgICAgICAgYSB8fCAoYSA9IERFRkFVTFRfUE9MWV9QT0lOVFMpOwogICAgICAgIHRoaXMuX3B0c0FyciA9IEZsb2F0NjRBcnJheS5mcm9tKGEpOwogICAgICAgIHRoaXMuX2Jib3ggPSBuZXcgQzMkanNjb21wJDE3LlJlY3Q7CiAgICAgICAgdGhpcy5faXNCYm94Q2hhbmdlZCA9ICEwOwogICAgICAgIHRoaXMuX2VuYWJsZWQgPSBiCiAgICB9CiAgICBSZWxlYXNlKCkge30KICAgIHBvaW50c0FycigpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcHRzQXJyCiAgICB9CiAgICBwb2ludENvdW50KCkgewogICAgICAgIHJldHVybiB0aGlzLl9wdHNBcnIubGVuZ3RoIC8gMgogICAgfQogICAgc2V0UG9pbnRzKGEpIHsKICAgICAgICB0aGlzLl9wdHNBcnIubGVuZ3RoID09PSBhLmxlbmd0aCA/IHRoaXMuX3B0c0Fyci5zZXQoYSkgOiB0aGlzLl9wdHNBcnIgPSBGbG9hdDY0QXJyYXkuZnJvbShhKTsKICAgICAgICB0aGlzLl9pc0Jib3hDaGFuZ2VkID0gITAKICAgIH0KICAgIHNldERlZmF1bHRQb2ludHMoKSB7CiAgICAgICAgdGhpcy5zZXRQb2ludHMoREVGQVVMVF9QT0xZX1BPSU5UUykKICAgIH0KICAgIGNvcHkoYSkgewogICAgICAgIHRoaXMuc2V0UG9pbnRzKGEuX3B0c0FycikKICAgIH0KICAgIHNldEJib3hDaGFuZ2VkKCkgewogICAgICAgIHRoaXMuX2lzQmJveENoYW5nZWQgPSAhMAogICAgfQogICAgX3VwZGF0ZUJib3goKSB7CiAgICAgICAgaWYgKHRoaXMuX2lzQmJveENoYW5nZWQpIHsKICAgICAgICAgICAgdmFyIGEgPSB0aGlzLl9wdHNBcnIsCiAgICAgICAgICAgICAgICBiID0gYVswXSwKICAgICAgICAgICAgICAgIGQgPSBhWzFdLAogICAgICAgICAgICAgICAgYyA9IGIsCiAgICAgICAgICAgICAgICBlID0gZDsKICAgICAgICAgICAgZm9yIChsZXQgZyA9IDAsIGsgPSBhLmxlbmd0aDsgZyA8IGs7IGcgKz0gMikgewogICAgICAgICAgICAgICAgY29uc3QgbSA9IGFbZ10sCiAgICAgICAgICAgICAgICAgICAgbiA9IGFbZyArIDFdOwogICAgICAgICAgICAgICAgbSA8IGIgJiYgKGIgPSBtKTsKICAgICAgICAgICAgICAgIG0gPiBjICYmIChjID0gbSk7CiAgICAgICAgICAgICAgICBuIDwgZCAmJiAoZCA9IG4pOwogICAgICAgICAgICAgICAgbiA+IGUgJiYgKGUgPSBuKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuX2Jib3guc2V0KGIsIGQsIGMsIGUpOwogICAgICAgICAgICB0aGlzLl9pc0Jib3hDaGFuZ2VkID0gITEKICAgICAgICB9CiAgICB9CiAgICBzZXRGcm9tUmVjdChhLCBiLCBkKSB7CiAgICAgICAgbGV0IGMgPSB0aGlzLl9wdHNBcnI7CiAgICAgICAgOCAhPT0gYy5sZW5ndGggJiYgKHRoaXMuX3B0c0FyciA9IGMgPSBuZXcgRmxvYXQ2NEFycmF5KDgpKTsKICAgICAgICBjWzBdID0gYS5nZXRMZWZ0KCkgLSBiOwogICAgICAgIGNbMV0gPSBhLmdldFRvcCgpIC0gZDsKICAgICAgICBjWzJdID0gYS5nZXRSaWdodCgpIC0gYjsKICAgICAgICBjWzNdID0gYS5nZXRUb3AoKSAtIGQ7CiAgICAgICAgY1s0XSA9IGEuZ2V0UmlnaHQoKSAtIGI7CiAgICAgICAgY1s1XSA9IGEuZ2V0Qm90dG9tKCkgLSBkOwogICAgICAgIGNbNl0gPSBhLmdldExlZnQoKSAtIGI7CiAgICAgICAgY1s3XSA9IGEuZ2V0Qm90dG9tKCkgLSBkOwogICAgICAgIHRoaXMuX2Jib3guY29weShhKTsKICAgICAgICAwID09PSBiICYmIDAgPT09CiAgICAgICAgICAgIGQgfHwgdGhpcy5fYmJveC5vZmZzZXQoLWIsIC1kKTsKICAgICAgICB0aGlzLl9pc0Jib3hDaGFuZ2VkID0gITEKICAgIH0KICAgIHNldEZyb21RdWFkKGEsIGIsIGQpIHsKICAgICAgICB0ZW1wUXVhZC5jb3B5KGEpOwogICAgICAgIHRlbXBRdWFkLm9mZnNldChiLCBkKTsKICAgICAgICB0aGlzLnNldFBvaW50cyh0ZW1wUXVhZC50b0FycmF5KCkpOwogICAgICAgIHRoaXMuX2lzQmJveENoYW5nZWQgPSAhMAogICAgfQogICAgdHJhbnNmb3JtKGEsIGIsIGQpIHsKICAgICAgICBsZXQgYyA9IDAsCiAgICAgICAgICAgIGUgPSAxOwogICAgICAgIDAgIT09IGQgJiYgKGMgPSBNYXRoLnNpbihkKSwgZSA9IE1hdGguY29zKGQpKTsKICAgICAgICB0aGlzLnRyYW5zZm9ybVByZWNhbGMoYSwgYiwgYywgZSkKICAgIH0KICAgIHRyYW5zZm9ybVByZWNhbGMoYSwgYiwgZCwgYykgewogICAgICAgIGNvbnN0IGUgPSB0aGlzLl9wdHNBcnI7CiAgICAgICAgZm9yIChsZXQgZyA9IDAsIGsgPSBlLmxlbmd0aDsgZyA8IGs7IGcgKz0gMikgewogICAgICAgICAgICBjb25zdCBtID0gZyArIDEsCiAgICAgICAgICAgICAgICBuID0gZVtnXSAqIGEsCiAgICAgICAgICAgICAgICBxID0gZVttXSAqIGI7CiAgICAgICAgICAgIGVbZ10gPSBuICogYyAtIHEgKiBkOwogICAgICAgICAgICBlW21dID0gcSAqIGMgKyBuICogZAogICAgICAgIH0KICAgICAgICB0aGlzLl9pc0Jib3hDaGFuZ2VkID0gITAKICAgIH0KICAgIG9mZnNldChhLCBiKSB7CiAgICAgICAgY29uc3QgZCA9IHRoaXMuX3B0c0FycjsKICAgICAgICBmb3IgKGxldCBjID0gMCwgZSA9IGQubGVuZ3RoOyBjIDwgZTsgYyArPSAyKSBkW2NdICs9IGEsIGRbYyArIDFdICs9CiAgICAgICAgICAgIGIKICAgIH0KICAgIGNvbnRhaW5zUG9pbnQoYSwgYikgewogICAgICAgIGNvbnN0IGQgPSB0aGlzLl9wdHNBcnI7CiAgICAgICAgaWYgKGEgPT09IGRbMF0gJiYgYiA9PT0gZFsxXSkgcmV0dXJuICEwOwogICAgICAgIHRoaXMuX3VwZGF0ZUJib3goKTsKICAgICAgICB2YXIgYyA9IHRoaXMuX2Jib3g7CiAgICAgICAgY29uc3QgZSA9IGMuZ2V0TGVmdCgpIC0gMTEwLAogICAgICAgICAgICBnID0gYy5nZXRUb3AoKSAtIDEwMSwKICAgICAgICAgICAgayA9IGMuZ2V0UmlnaHQoKSArIDEzMTsKICAgICAgICBjID0gYy5nZXRCb3R0b20oKSArIDEyMDsKICAgICAgICBsZXQgbSwgbiwgcSwgdSwgdywgeiwgQywgRDsKICAgICAgICBlIDwgYSA/IChtID0gZSwgcSA9IGEpIDogKG0gPSBhLCBxID0gZSk7CiAgICAgICAgZyA8IGIgPyAobiA9IGcsIHUgPSBiKSA6IChuID0gYiwgdSA9IGcpOwogICAgICAgIGsgPCBhID8gKHcgPSBrLCBDID0gYSkgOiAodyA9IGEsIEMgPSBrKTsKICAgICAgICBjIDwgYiA/ICh6ID0gYywgRCA9IGIpIDogKHogPSBiLCBEID0gYyk7CiAgICAgICAgbGV0IEYgPSAwLAogICAgICAgICAgICBFID0gMDsKICAgICAgICBmb3IgKGxldCBLID0gMCwgTyA9IGQubGVuZ3RoOyBLIDwgTzsgSyArPSAyKSB7CiAgICAgICAgICAgIHZhciBKID0gKEsgKyAyKSAlIE87CiAgICAgICAgICAgIGNvbnN0IFYgPSBkW0tdLAogICAgICAgICAgICAgICAgVyA9IGRbSyArIDFdLAogICAgICAgICAgICAgICAgY2EgPSBkW0pdOwogICAgICAgICAgICBKID0gZFtKICsgMV07CiAgICAgICAgICAgIEMzJGpzY29tcCQxNy5zZWdtZW50c0ludGVyc2VjdFByZUNhbGMoZSwgZywgYSwgYiwgbSwgcSwgbiwgdSwgViwgVywgY2EsIEopICYmICsrRjsKICAgICAgICAgICAgQzMkanNjb21wJDE3LnNlZ21lbnRzSW50ZXJzZWN0UHJlQ2FsYyhrLAogICAgICAgICAgICAgICAgYywgYSwgYiwgdywgQywgeiwgRCwgViwgVywgY2EsIEopICYmICsrRQogICAgICAgIH0KICAgICAgICByZXR1cm4gMSA9PT0gRiAlIDIgfHwgMSA9PT0gRSAlIDIKICAgIH0KICAgIGludGVyc2VjdHNQb2x5KGEsIGIsIGQpIHsKICAgICAgICBjb25zdCBjID0gYS5fcHRzQXJyLAogICAgICAgICAgICBlID0gdGhpcy5fcHRzQXJyOwogICAgICAgIGlmICh0aGlzLmNvbnRhaW5zUG9pbnQoY1swXSArIGIsIGNbMV0gKyBkKSB8fCBhLmNvbnRhaW5zUG9pbnQoZVswXSAtIGIsIGVbMV0gLSBkKSkgcmV0dXJuICEwOwogICAgICAgIGZvciAobGV0IGsgPSAwLCBtID0gZS5sZW5ndGg7IGsgPCBtOyBrICs9IDIpIHsKICAgICAgICAgICAgdmFyIGcgPSAoayArIDIpICUgbTsKICAgICAgICAgICAgYSA9IGVba107CiAgICAgICAgICAgIGNvbnN0IG4gPSBlW2sgKyAxXSwKICAgICAgICAgICAgICAgIHEgPSBlW2ddOwogICAgICAgICAgICBnID0gZVtnICsgMV07CiAgICAgICAgICAgIGxldCB1LCB3LCB6LCBDOwogICAgICAgICAgICBhIDwgcSA/ICh1ID0gYSwgeiA9IHEpIDogKHUgPSBxLCB6ID0gYSk7CiAgICAgICAgICAgIG4gPCBnID8gKHcgPSBuLCBDID0gZykgOiAodyA9IGcsIEMgPSBuKTsKICAgICAgICAgICAgZm9yIChsZXQgRCA9IDAsIEYgPSBjLmxlbmd0aDsgRCA8IEY7IEQgKz0gMikgewogICAgICAgICAgICAgICAgY29uc3QgRSA9IChEICsgMikgJSBGOwogICAgICAgICAgICAgICAgaWYgKEMzJGpzY29tcCQxNy5zZWdtZW50c0ludGVyc2VjdFByZUNhbGMoYSwgbiwgcSwgZywgdSwgeiwgdywgQywgY1tEXSArIGIsIGNbRCArIDFdICsgZCwgY1tFXSArIGIsIGNbRSArIDFdICsgZCkpIHJldHVybiAhMAogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiAhMQogICAgfQogICAgaW50ZXJzZWN0c1NlZ21lbnQoYSwKICAgICAgICBiLCBkLCBjLCBlLCBnKSB7CiAgICAgICAgaWYgKHRoaXMuY29udGFpbnNQb2ludChkIC0gYSwgYyAtIGIpIHx8IHRoaXMuY29udGFpbnNQb2ludChlIC0gYSwgZyAtIGIpKSByZXR1cm4gITA7CiAgICAgICAgbGV0IGssIG0sIG4sIHE7CiAgICAgICAgZCA8IGUgPyAoayA9IGQsIG4gPSBlKSA6IChrID0gZSwgbiA9IGQpOwogICAgICAgIGMgPCBnID8gKG0gPSBjLCBxID0gZykgOiAobSA9IGcsIHEgPSBjKTsKICAgICAgICBjb25zdCB1ID0gdGhpcy5fcHRzQXJyOwogICAgICAgIGZvciAobGV0IHcgPSAwLCB6ID0gdS5sZW5ndGg7IHcgPCB6OyB3ICs9IDIpIHsKICAgICAgICAgICAgY29uc3QgQyA9ICh3ICsgMikgJSB6OwogICAgICAgICAgICBpZiAoQzMkanNjb21wJDE3LnNlZ21lbnRzSW50ZXJzZWN0UHJlQ2FsYyhkLCBjLCBlLCBnLCBrLCBuLCBtLCBxLCB1W3ddICsgYSwgdVt3ICsgMV0gKyBiLCB1W0NdICsgYSwgdVtDICsgMV0gKyBiKSkgcmV0dXJuICEwCiAgICAgICAgfQogICAgICAgIHJldHVybiAhMQogICAgfQogICAgbWlycm9yKGEpIHsKICAgICAgICBjb25zdCBiID0gdGhpcy5fcHRzQXJyOwogICAgICAgIGZvciAobGV0IGQgPSAwLCBjID0gYi5sZW5ndGg7IGQgPCBjOyBkICs9IDIpIGJbZF0gPSAyICogYSAtIGJbZF07CiAgICAgICAgdGhpcy5faXNCYm94Q2hhbmdlZCA9ICEwCiAgICB9CiAgICBmbGlwKGEpIHsKICAgICAgICBjb25zdCBiID0gdGhpcy5fcHRzQXJyOwogICAgICAgIGZvciAobGV0IGQgPSAwLCBjID0gYi5sZW5ndGg7IGQgPCBjOyBkICs9IDIpIHsKICAgICAgICAgICAgY29uc3QgZSA9IGQgKyAxOwogICAgICAgICAgICBiW2VdID0gMiAqIGEgLQogICAgICAgICAgICAgICAgYltlXQogICAgICAgIH0KICAgICAgICB0aGlzLl9pc0Jib3hDaGFuZ2VkID0gITAKICAgIH0KICAgIGRpYWcoKSB7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuX3B0c0FycjsKICAgICAgICBmb3IgKGxldCBiID0gMCwgZCA9IGEubGVuZ3RoOyBiIDwgZDsgYiArPSAyKSB7CiAgICAgICAgICAgIGNvbnN0IGMgPSBiICsgMSwKICAgICAgICAgICAgICAgIGUgPSBhW2JdOwogICAgICAgICAgICBhW2JdID0gYVtjXTsKICAgICAgICAgICAgYVtjXSA9IGUKICAgICAgICB9CiAgICAgICAgdGhpcy5faXNCYm94Q2hhbmdlZCA9ICEwCiAgICB9CiAgICBHZXRNaWRYKCkgewogICAgICAgIGNvbnN0IGEgPSB0aGlzLl9wdHNBcnI7CiAgICAgICAgbGV0IGIgPSAwOwogICAgICAgIGZvciAobGV0IGQgPSAwLCBjID0gYS5sZW5ndGg7IGQgPCBjOyBkICs9IDIpIGIgKz0gYVtkXTsKICAgICAgICByZXR1cm4gYiAvIHRoaXMucG9pbnRDb3VudCgpCiAgICB9CiAgICBHZXRNaWRZKCkgewogICAgICAgIGNvbnN0IGEgPSB0aGlzLl9wdHNBcnI7CiAgICAgICAgbGV0IGIgPSAwOwogICAgICAgIGZvciAobGV0IGQgPSAwLCBjID0gYS5sZW5ndGg7IGQgPCBjOyBkICs9IDIpIGIgKz0gYVtkICsgMV07CiAgICAgICAgcmV0dXJuIGIgLyB0aGlzLnBvaW50Q291bnQoKQogICAgfQogICAgR2V0UG9pbnRzQXJyYXkoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3B0c0FycgogICAgfQogICAgR2V0UG9pbnRDb3VudCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5wb2ludENvdW50KCkKICAgIH0KICAgIElzRW5hYmxlZCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZW5hYmxlZAogICAgfQp9OwoidXNlIHN0cmljdCI7CmNvbnN0IEMzJGpzY29tcCQxOCA9IHNlbGYuQzM7CkMzJGpzY29tcCQxOC5QYWlyTWFwID0gY2xhc3MgZXh0ZW5kcyBDMyRqc2NvbXAkMTguRGVmZW5kZWRCYXNlIHsKICAgIGNvbnN0cnVjdG9yKGEpIHsKICAgICAgICBzdXBlcigpOwogICAgICAgIHRoaXMuX2ZpcnN0TWFwID0gbmV3IE1hcDsKICAgICAgICBpZiAoYSkKICAgICAgICAgICAgZm9yIChjb25zdCBbYiwgZCwgY10gb2YgYSkgdGhpcy5TZXQoYiwgZCwgYykKICAgIH0KICAgIFJlbGVhc2UoKSB7CiAgICAgICAgdGhpcy5DbGVhcigpOwogICAgICAgIHRoaXMuX2ZpcnN0TWFwID0gbnVsbAogICAgfQogICAgQ2xlYXIoKSB7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuX2ZpcnN0TWFwOwogICAgICAgIGZvciAoY29uc3QgYiBvZiBhLnZhbHVlcygpKSBiLmNsZWFyKCk7CiAgICAgICAgYS5jbGVhcigpCiAgICB9CiAgICBTZXQoYSwgYiwgZCkgewogICAgICAgIGNvbnN0IGMgPSB0aGlzLl9maXJzdE1hcDsKICAgICAgICBsZXQgZSA9IGMuZ2V0KGEpOwogICAgICAgIGUgfHwgKGUgPSBuZXcgTWFwLCBjLnNldChhLCBlKSk7CiAgICAgICAgZS5zZXQoYiwgZCkKICAgIH0KICAgIEdldChhLCBiKSB7CiAgICAgICAgcmV0dXJuIChhID0gdGhpcy5fZmlyc3RNYXAuZ2V0KGEpKSA/IGEuZ2V0KGIpIDogYQogICAgfQogICAgSGFzKGEsIGIpIHsKICAgICAgICByZXR1cm4gKGEgPSB0aGlzLl9maXJzdE1hcC5nZXQoYSkpID8gYS5oYXMoYikgOiAhMQogICAgfQogICAgRGVsZXRlKGEsIGIpIHsKICAgICAgICBjb25zdCBkID0gdGhpcy5fZmlyc3RNYXAsCiAgICAgICAgICAgIGMgPSBkLmdldChhKTsKICAgICAgICBpZiAoIWMpIHJldHVybiAhMTsKICAgICAgICAoYiA9IGMuZGVsZXRlKGIpKSAmJiAwID09PSBjLnNpemUgJiYgZC5kZWxldGUoYSk7CiAgICAgICAgcmV0dXJuIGIKICAgIH0KICAgIERlbGV0ZUVpdGhlcihhKSB7CiAgICAgICAgY29uc3QgYiA9IHRoaXMuX2ZpcnN0TWFwLAogICAgICAgICAgICBkID0gYi5nZXQoYSk7CiAgICAgICAgZCAmJiAoZC5jbGVhcigpLCBiLmRlbGV0ZShhKSk7CiAgICAgICAgZm9yIChjb25zdCBbYywgZV0gb2YgYi5lbnRyaWVzKCkpIGUuZGVsZXRlKGEpICYmIDAgPT09IGUuc2l6ZSAmJiBiLmRlbGV0ZShjKQogICAgfQogICAgR2V0U2l6ZSgpIHsKICAgICAgICBsZXQgYSA9IDA7CiAgICAgICAgZm9yIChjb25zdCBiIG9mIHRoaXMuX2ZpcnN0TWFwLnZhbHVlcygpKSBhICs9IGIuc2l6ZTsKICAgICAgICByZXR1cm4gYQogICAgfSogdmFsdWVzKCkgewogICAgICAgIGZvciAoY29uc3QgYSBvZiB0aGlzLl9maXJzdE1hcC52YWx1ZXMoKSkgeWllbGQqIGEudmFsdWVzKCkKICAgIH0qIGtleVBhaXJzKCkgewogICAgICAgIGZvciAoY29uc3QgW2EsIGJdIG9mIHRoaXMuX2ZpcnN0TWFwLmVudHJpZXMoKSkKICAgICAgICAgICAgZm9yIChjb25zdCBkIG9mIGIua2V5cygpKSB5aWVsZCBbYSwgZF0KICAgIH0qIGVudHJpZXMoKSB7CiAgICAgICAgZm9yIChjb25zdCBbYSwgYl0gb2YgdGhpcy5fZmlyc3RNYXAuZW50cmllcygpKQogICAgICAgICAgICBmb3IgKGNvbnN0IFtkLAogICAgICAgICAgICAgICAgICAgIGMKICAgICAgICAgICAgICAgIF0gb2YgYi5lbnRyaWVzKCkpIHlpZWxkIFthLCBkLCBjXQogICAgfQp9OwoidXNlIHN0cmljdCI7CmNvbnN0IEMzJGpzY29tcCQxOSA9IHNlbGYuQzM7CkMzJGpzY29tcCQxOS5BcnJheVNldCA9IGNsYXNzIGV4dGVuZHMgQzMkanNjb21wJDE5LkRlZmVuZGVkQmFzZSB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgICBzdXBlcigpOwogICAgICAgIHRoaXMuX3NldCA9IG5ldyBTZXQ7CiAgICAgICAgdGhpcy5fYXJyID0gW107CiAgICAgICAgdGhpcy5fbmVlZFRvUmVidWlsZEFycmF5ID0gITEKICAgIH0KICAgIFJlbGVhc2UoKSB7CiAgICAgICAgdGhpcy5DbGVhcigpCiAgICB9CiAgICBDbGVhcigpIHsKICAgICAgICB0aGlzLl9zZXQuY2xlYXIoKTsKICAgICAgICBDMyRqc2NvbXAkMTkuY2xlYXJBcnJheSh0aGlzLl9hcnIpOwogICAgICAgIHRoaXMuX25lZWRUb1JlYnVpbGRBcnJheSA9ICExCiAgICB9CiAgICBBZGQoYSkgewogICAgICAgIHRoaXMuX3NldC5oYXMoYSkgfHwgKHRoaXMuX3NldC5hZGQoYSksIHRoaXMuX25lZWRUb1JlYnVpbGRBcnJheSB8fCB0aGlzLl9hcnIucHVzaChhKSkKICAgIH0KICAgIEhhcyhhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3NldC5oYXMoYSkKICAgIH0KICAgIERlbGV0ZShhKSB7CiAgICAgICAgdGhpcy5fc2V0LmRlbGV0ZShhKSAmJiAodGhpcy5fbmVlZFRvUmVidWlsZEFycmF5ID0gITApCiAgICB9CiAgICBHZXRTaXplKCkgewogICAgICAgIHJldHVybiB0aGlzLl9zZXQuc2l6ZQogICAgfQogICAgSXNFbXB0eSgpIHsKICAgICAgICByZXR1cm4gMCA9PT0gdGhpcy5fc2V0LnNpemUKICAgIH0KICAgIEdldEFycmF5KCkgewogICAgICAgIHRoaXMuX25lZWRUb1JlYnVpbGRBcnJheSAmJgogICAgICAgICAgICAodGhpcy5fUmVidWlsZEFycmF5KCksIHRoaXMuX25lZWRUb1JlYnVpbGRBcnJheSA9ICExKTsKICAgICAgICByZXR1cm4gdGhpcy5fYXJyCiAgICB9CiAgICBfUmVidWlsZEFycmF5KCkgewogICAgICAgIGNvbnN0IGEgPSB0aGlzLl9hcnI7CiAgICAgICAgQzMkanNjb21wJDE5LmNsZWFyQXJyYXkoYSk7CiAgICAgICAgZm9yIChjb25zdCBiIG9mIHRoaXMuX3NldCkgYS5wdXNoKGIpCiAgICB9Cn07CiJ1c2Ugc3RyaWN0IjsKY29uc3QgQzMkanNjb21wJDIwID0gc2VsZi5DMywKICAgIEVBU0VfTUFQID0gbmV3IE1hcCwKICAgIFBSRURFRklORURfRUFTRV9NQVAgPSBuZXcgTWFwLAogICAgQ1VTVE9NX0VBU0VfRURJVE9SX01BUCA9IG5ldyBNYXAsCiAgICBDVVNUT01fRUFTRV9SVU5USU1FX01BUCA9IG5ldyBNYXAsCiAgICBQUklWQVRFX0VBU0VfTUFQID0gbmV3IE1hcCwKICAgIEJVSUxUX0lOX1RSQU5TSVRJT05fTUFQID0gbmV3IE1hcCwKICAgIEFMSUFTX01BUCA9IG5ldyBNYXA7CkFMSUFTX01BUC5zZXQoImxpbmVhciIsICJub2Vhc2UiKTsKQUxJQVNfTUFQLnNldCgiZGVmYXVsdCIsICJub2Vhc2UiKTsKY29uc3QgRUFTRV9UUkFOU0xBVElPTl9LRVlTID0gImRlZmF1bHQgbm9lYXNlIGVhc2VpbnF1YWQgZWFzZW91dHF1YWQgZWFzZWlub3V0cXVhZCBlYXNlaW5jdWJpYyBlYXNlb3V0Y3ViaWMgZWFzZWlub3V0Y3ViaWMgZWFzZWlucXVhcnQgZWFzZW91dHF1YXJ0IGVhc2Vpbm91dHF1YXJ0IGVhc2VpbnF1aW50IGVhc2VvdXRxdWludCBlYXNlaW5vdXRxdWludCBlYXNlaW5zaW5lIGVhc2VvdXRzaW5lIGVhc2Vpbm91dHNpbmUgZWFzZWluZXhwbyBlYXNlb3V0ZXhwbyBlYXNlaW5vdXRleHBvIGVhc2VpbmNpcmMgZWFzZW91dGNpcmMgZWFzZWlub3V0Y2lyYyBlYXNlaW5lbGFzdGljIGVhc2VvdXRlbGFzdGljIGVhc2Vpbm91dGVsYXN0aWMgZWFzZWluYmFjayBlYXNlb3V0YmFjayBlYXNlaW5vdXRiYWNrIGVhc2VpbmJvdW5jZSBlYXNlb3V0Ym91bmNlIGVhc2Vpbm91dGJvdW5jZSIuc3BsaXQoIiAiKSwKICAgIFNIT1JUX0VBU0VfVFJBTlNMQVRJT05fS0VZUyA9ICJkZWZhdWx0IG5vZWFzZSBxdWFkIGN1YmljIHF1YXJ0IHF1aW50IHNpbmUgZXhwbyBjaXJjIGVsYXN0aWMgYmFjayBib3VuY2UiLnNwbGl0KCIgIiksCiAgICBFQVNFX0FQSTJJTlRFUk5BTF9OQU1FUyA9IG5ldyBNYXAoWwogICAgICAgIFsibGluZWFyIiwgIm5vZWFzZSJdLAogICAgICAgIFsiaW4tc2luZSIsICJlYXNlaW5zaW5lIl0sCiAgICAgICAgWyJvdXQtc2luZSIsICJlYXNlb3V0c2luZSJdLAogICAgICAgIFsiaW4tb3V0LXNpbmUiLCAiZWFzZWlub3V0c2luZSJdLAogICAgICAgIFsiaW4tZWxhc3RpYyIsICJlYXNlaW5lbGFzdGljIl0sCiAgICAgICAgWyJvdXQtZWxhc3RpYyIsICJlYXNlb3V0ZWxhc3RpYyJdLAogICAgICAgIFsiaW4tb3V0LWVsYXN0aWMiLCAiZWFzZWlub3V0ZWxhc3RpYyJdLAogICAgICAgIFsiaW4tYmFjayIsICJlYXNlaW5iYWNrIl0sCiAgICAgICAgWyJvdXQtYmFjayIsICJlYXNlb3V0YmFjayJdLAogICAgICAgIFsiaW4tb3V0LWJhY2siLCAiZWFzZWlub3V0YmFjayJdLAogICAgICAgIFsiaW4tYm91bmNlIiwgImVhc2VpbmJvdW5jZSJdLAogICAgICAgIFsib3V0LWJvdW5jZSIsICJlYXNlb3V0Ym91bmNlIl0sCiAgICAgICAgWyJpbi1vdXQtYm91bmNlIiwgImVhc2Vpbm91dGJvdW5jZSJdLAogICAgICAgIFsiaW4tY3ViaWMiLCAiZWFzZWluY3ViaWMiXSwKICAgICAgICBbIm91dC1jdWJpYyIsICJlYXNlb3V0Y3ViaWMiXSwKICAgICAgICBbImluLW91dC1jdWJpYyIsICJlYXNlaW5vdXRjdWJpYyJdLAogICAgICAgIFsiaW4tcXVhZHJhdGljIiwgImVhc2VpbnF1YWQiXSwKICAgICAgICBbIm91dC1xdWFkcmF0aWMiLCAiZWFzZW91dHF1YWQiXSwKICAgICAgICBbImluLW91dC1xdWFkcmF0aWMiLCAiZWFzZWlub3V0cXVhZCJdLAogICAgICAgIFsiaW4tcXVhcnRpYyIsICJlYXNlaW5xdWFydCJdLAogICAgICAgIFsib3V0LXF1YXJ0aWMiLCAiZWFzZW91dHF1YXJ0Il0sCiAgICAgICAgWyJpbi1vdXQtcXVhcnRpYyIsICJlYXNlaW5vdXRxdWFydCJdLAogICAgICAgIFsiaW4tcXVpbnRpYyIsICJlYXNlaW5xdWludCJdLAogICAgICAgIFsib3V0LXF1aW50aWMiLCAiZWFzZW91dHF1aW50Il0sCiAgICAgICAgWyJpbi1vdXQtcXVpbnRpYyIsICJlYXNlaW5vdXRxdWludCJdLAogICAgICAgIFsiaW4tY2lyY3VsYXIiLCAiZWFzZWluY2lyYyJdLAogICAgICAgIFsib3V0LWNpcmN1bGFyIiwgImVhc2VvdXRjaXJjIl0sCiAgICAgICAgWyJpbi1vdXQtY2lyY3VsYXIiLCAiZWFzZWlub3V0Y2lyYyJdLAogICAgICAgIFsiaW4tZXhwb25lbnRpYWwiLCAiZWFzZWluZXhwbyJdLAogICAgICAgIFsib3V0LWV4cG9uZW50aWFsIiwgImVhc2VvdXRleHBvIl0sCiAgICAgICAgWyJpbi1vdXQtZXhwb25lbnRpYWwiLCAiZWFzZWlub3V0ZXhwbyJdCiAgICBdKTsKc2VsZi5FYXNlID0gY2xhc3MgYSB7CiAgICBjb25zdHJ1Y3RvcigpIHt9CiAgICBzdGF0aWMgSW5oZXJpdEVhc2UoKSB7CiAgICAgICAgcmV0dXJuICJkZWZhdWx0IgogICAgfQogICAgc3RhdGljIERlZmF1bHRFYXNlKCkgewogICAgICAgIHJldHVybiAibm9lYXNlIgogICAgfQogICAgc3RhdGljIFRvSW50ZXJuYWwoYikgewogICAgICAgIHJldHVybiBFQVNFX0FQSTJJTlRFUk5BTF9OQU1FUy5nZXQoYikKICAgIH0KICAgIHN0YXRpYyBHZXRFZGl0b3JFYXNlTmFtZXMoYiwgLi4uZCkgewogICAgICAgIHRoaXMuX0NyZWF0ZUVhc2VNYXAoKTsKICAgICAgICBiID8gKENVU1RPTV9FQVNFX0VESVRPUl9NQVAuaGFzKGIpIHx8IENVU1RPTV9FQVNFX0VESVRPUl9NQVAuc2V0KGIsIG5ldyBNYXApLCBiID0gQ1VTVE9NX0VBU0VfRURJVE9SX01BUC5nZXQoYikpIDogYiA9IENVU1RPTV9FQVNFX1JVTlRJTUVfTUFQOwogICAgICAgIGIgPSBbLi4uYi5rZXlzKCldOwogICAgICAgIGIuc29ydCgpOwogICAgICAgIHJldHVybiBbLi4uUFJFREVGSU5FRF9FQVNFX01BUC5rZXlzKCldLmNvbmNhdChiKS5maWx0ZXIoYyA9PiAhZC5pbmNsdWRlcyhjKSkKICAgIH0KICAgIHN0YXRpYyBHZXRSdW50aW1lRWFzZU5hbWVzKCkgewogICAgICAgIHRoaXMuX0NyZWF0ZUVhc2VNYXAoKTsKICAgICAgICBjb25zdCBiID0gWy4uLkNVU1RPTV9FQVNFX1JVTlRJTUVfTUFQLmtleXMoKV07CiAgICAgICAgYi5zb3J0KCk7CiAgICAgICAgcmV0dXJuIFsuLi5QUkVERUZJTkVEX0VBU0VfTUFQLmtleXMoKV0uY29uY2F0KGIpCiAgICB9CiAgICBzdGF0aWMgR2V0Q3VzdG9tUnVudGltZUVhc2VOYW1lcygpIHsKICAgICAgICB0aGlzLl9DcmVhdGVFYXNlTWFwKCk7CiAgICAgICAgY29uc3QgYiA9IFsuLi5DVVNUT01fRUFTRV9SVU5USU1FX01BUC5rZXlzKCldOwogICAgICAgIGIuc29ydCgpOwogICAgICAgIHJldHVybiBiCiAgICB9CiAgICBzdGF0aWMgSXNQcmVkZWZpbmVkVHJhbnNsYXRlZE5hbWUoYikgewogICAgICAgIGZvciAoY29uc3QgZCBvZiBFQVNFX1RSQU5TTEFUSU9OX0tFWVMpCiAgICAgICAgICAgIGlmIChzZWxmLmxhbmcoYHVpLmJhcnMudGltZWxpbmUuZWFzZXMuJHtkfWApID09PSBiKSByZXR1cm4gITA7CiAgICAgICAgZm9yIChjb25zdCBkIG9mIFNIT1JUX0VBU0VfVFJBTlNMQVRJT05fS0VZUykKICAgICAgICAgICAgaWYgKHNlbGYubGFuZyhgdWkuYmFycy50aW1lbGluZS5zaG9ydC1lYXNlcy4ke2R9YCkgPT09IGIpIHJldHVybiAhMAogICAgfQogICAgc3RhdGljIElzTmFtZVByZWRlZmluZWQoYikgewogICAgICAgIHRoaXMuX0NyZWF0ZUVhc2VNYXAoKTsKICAgICAgICByZXR1cm4gWy4uLlBSRURFRklORURfRUFTRV9NQVAua2V5cygpXS5pbmNsdWRlcyhiKQogICAgfQogICAgc3RhdGljIF9HZXRFYXNlKGIpIHsKICAgICAgICBjb25zdCBkID0gQUxJQVNfTUFQLmdldChiKTsKICAgICAgICBpZiAoZCkgcmV0dXJuIEVBU0VfTUFQLmdldChkKTsKICAgICAgICBpZiAoYS5Jc05hbWVQcmVkZWZpbmVkKGIpKSByZXR1cm4gRUFTRV9NQVAuZ2V0KGIpOwogICAgICAgIGlmIChQUklWQVRFX0VBU0VfTUFQLmhhcyhiKSkgcmV0dXJuIFBSSVZBVEVfRUFTRV9NQVAuZ2V0KGIpCiAgICB9CiAgICBzdGF0aWMgR2V0QnVpbHRJblRyYW5zaXRpb24oYikgewogICAgICAgIHRoaXMuX0NyZWF0ZUVhc2VNYXAoKTsKICAgICAgICByZXR1cm4gQlVJTFRfSU5fVFJBTlNJVElPTl9NQVAuZ2V0KGIpCiAgICB9CiAgICBzdGF0aWMgR2V0RWRpdG9yRWFzZShiLCBkKSB7CiAgICAgICAgdGhpcy5fQ3JlYXRlRWFzZU1hcCgpOwogICAgICAgIGNvbnN0IGMgPSBhLl9HZXRFYXNlKGIpOwogICAgICAgIGlmIChjKSByZXR1cm4gYzsKICAgICAgICBpZiAoIWQpIHRocm93IEVycm9yKCJtaXNzaW5nIGVhc2UgZnVuY3Rpb24iKTsKICAgICAgICByZXR1cm4gQ1VTVE9NX0VBU0VfRURJVE9SX01BUC5nZXQoZCkuZ2V0KGIpCiAgICB9CiAgICBzdGF0aWMgR2V0UnVudGltZUVhc2UoYikgewogICAgICAgIHRoaXMuX0NyZWF0ZUVhc2VNYXAoKTsKICAgICAgICBjb25zdCBkID0gYS5fR2V0RWFzZShiKTsKICAgICAgICByZXR1cm4gZCA/IGQgOiBDVVNUT01fRUFTRV9SVU5USU1FX01BUC5nZXQoYikKICAgIH0KICAgIHN0YXRpYyBHZXRFYXNlRnJvbUluZGV4KGIpIHsKICAgICAgICB0aGlzLl9DcmVhdGVFYXNlTWFwKCk7CiAgICAgICAgcmV0dXJuIHRoaXMuR2V0UnVudGltZUVhc2VOYW1lcygpW2JdCiAgICB9CiAgICBzdGF0aWMgR2V0SW5kZXhGb3JFYXNlKGIsIGQpIHsKICAgICAgICB0aGlzLl9DcmVhdGVFYXNlTWFwKCk7CiAgICAgICAgcmV0dXJuIHRoaXMuR2V0RWRpdG9yRWFzZU5hbWVzKGQpLmluZGV4T2YoYikKICAgIH0KICAgIHN0YXRpYyBHZXRJbmRleEZvckVhc2VBdFJ1bnRpbWUoYikgewogICAgICAgIHJldHVybiB0aGlzLkdldEluZGV4Rm9yRWFzZShiKQogICAgfQogICAgc3RhdGljIF9DcmVhdGVFYXNlTWFwKCkgewogICAgICAgIDAgPT09IEVBU0VfTUFQLnNpemUgJiYgKHRoaXMuX0FkZFByZWRpZmluZWRFYXNlKCJkZWZhdWx0IiwgKCkgPT4ge30pLCB0aGlzLl9BZGRQcmVkaWZpbmVkRWFzZSgibm9lYXNlIiwgW3sKICAgICAgICAgICAgeDogMCwKICAgICAgICAgICAgeTogMCwKICAgICAgICAgICAgc2F4OiAuMzM2LAogICAgICAgICAgICBzYXk6IDAsCiAgICAgICAgICAgIGVheDogMCwKICAgICAgICAgICAgZWF5OiAwLAogICAgICAgICAgICBzZTogITAsCiAgICAgICAgICAgIGVlOiAhMQogICAgICAgIH0sIHsKICAgICAgICAgICAgeDogMSwKICAgICAgICAgICAgeTogMSwKICAgICAgICAgICAgc2F4OiAwLAogICAgICAgICAgICBzYXk6IDAsCiAgICAgICAgICAgIGVheDogLS4zMzYsCiAgICAgICAgICAgIGVheTogMCwKICAgICAgICAgICAgc2U6ICExLAogICAgICAgICAgICBlZTogITAKICAgICAgICB9XSwgITApLCB0aGlzLl9BZGRQcmVkaWZpbmVkRWFzZSgiZWFzZWluc2luZSIsIFt7CiAgICAgICAgICAgIHg6IDAsCiAgICAgICAgICAgIHk6IDAsCiAgICAgICAgICAgIHNheDogLjQ4NSwKICAgICAgICAgICAgc2F5OiAwLAogICAgICAgICAgICBlYXg6IDAsCiAgICAgICAgICAgIGVheTogMCwKICAgICAgICAgICAgc2U6ICEwLAogICAgICAgICAgICBlZTogITEKICAgICAgICB9LCB7CiAgICAgICAgICAgIHg6IDEsCiAgICAgICAgICAgIHk6IDEsCiAgICAgICAgICAgIHNheDogMCwKICAgICAgICAgICAgc2F5OiAwLAogICAgICAgICAgICBlYXg6IC0uMDM4LAogICAgICAgICAgICBlYXk6IDAsCiAgICAgICAgICAgIHNlOiAhMSwKICAgICAgICAgICAgZWU6ICEwCiAgICAgICAgfV0pLCB0aGlzLl9BZGRQcmVkaWZpbmVkRWFzZSgiZWFzZW91dHNpbmUiLCBbewogICAgICAgICAgICB4OiAwLAogICAgICAgICAgICB5OiAwLAogICAgICAgICAgICBzYXg6IC4wMzgsCiAgICAgICAgICAgIHNheTogMCwKICAgICAgICAgICAgZWF4OiAwLAogICAgICAgICAgICBlYXk6IDAsCiAgICAgICAgICAgIHNlOiAhMCwKICAgICAgICAgICAgZWU6ICExCiAgICAgICAgfSwgewogICAgICAgICAgICB4OiAxLAogICAgICAgICAgICB5OiAxLAogICAgICAgICAgICBzYXg6IDAsCiAgICAgICAgICAgIHNheTogMCwKICAgICAgICAgICAgZWF4OiAtLjQ4NSwKICAgICAgICAgICAgZWF5OiAwLAogICAgICAgICAgICBzZTogITEsCiAgICAgICAgICAgIGVlOiAhMAogICAgICAgIH1dKSwgdGhpcy5fQWRkUHJlZGlmaW5lZEVhc2UoImVhc2Vpbm91dHNpbmUiLCBbewogICAgICAgICAgICB4OiAwLAogICAgICAgICAgICB5OiAwLAogICAgICAgICAgICBzYXg6IC4zMzYsCiAgICAgICAgICAgIHNheTogMCwKICAgICAgICAgICAgZWF4OiAwLAogICAgICAgICAgICBlYXk6IDAsCiAgICAgICAgICAgIHNlOiAhMCwKICAgICAgICAgICAgZWU6ICExCiAgICAgICAgfSwgewogICAgICAgICAgICB4OiAxLAogICAgICAgICAgICB5OiAxLAogICAgICAgICAgICBzYXg6IDAsCiAgICAgICAgICAgIHNheTogMCwKICAgICAgICAgICAgZWF4OiAtLjMzNiwKICAgICAgICAgICAgZWF5OiAwLAogICAgICAgICAgICBzZTogITEsCiAgICAgICAgICAgIGVlOiAhMAogICAgICAgIH1dKSwgdGhpcy5fQWRkUHJlZGlmaW5lZEVhc2UoImVhc2VpbmVsYXN0aWMiLCBbewogICAgICAgICAgICB4OiAwLAogICAgICAgICAgICB5OiAwLAogICAgICAgICAgICBzYXg6IC4wMTgsCiAgICAgICAgICAgIHNheTogMCwKICAgICAgICAgICAgZWF4OiAwLAogICAgICAgICAgICBlYXk6IDAsCiAgICAgICAgICAgIHNlOiAhMCwKICAgICAgICAgICAgZWU6ICExCiAgICAgICAgfSwgewogICAgICAgICAgICB4OiAuMTE2LAogICAgICAgICAgICB5OiAuMDAyLAogICAgICAgICAgICBzYXg6IC4wMjUsCiAgICAgICAgICAgIHNheTogMCwKICAgICAgICAgICAgZWF4OiAtLjAyNSwKICAgICAgICAgICAgZWF5OiAwLAogICAgICAgICAgICBzZTogITAsCiAgICAgICAgICAgIGVlOiAhMAogICAgICAgIH0sIHsKICAgICAgICAgICAgeDogLjI2NiwKICAgICAgICAgICAgeTogLS4wMDUsCiAgICAgICAgICAgIHNheDogLjAyNCwKICAgICAgICAgICAgc2F5OiAwLAogICAgICAgICAgICBlYXg6IC0uMDIxLAogICAgICAgICAgICBlYXk6IDAsCiAgICAgICAgICAgIHNlOiAhMCwKICAgICAgICAgICAgZWU6ICEwCiAgICAgICAgfSwgewogICAgICAgICAgICB4OiAuNDE2LAogICAgICAgICAgICB5OiAuMDE2LAogICAgICAgICAgICBzYXg6IC4wMjQsCiAgICAgICAgICAgIHNheTogMCwKICAgICAgICAgICAgZWF4OiAtLjAyNiwKICAgICAgICAgICAgZWF5OiAwLAogICAgICAgICAgICBzZTogITAsCiAgICAgICAgICAgIGVlOiAhMAogICAgICAgIH0sIHsKICAgICAgICAgICAgeDogLjU2NiwKICAgICAgICAgICAgeTogLS4wNDUsCiAgICAgICAgICAgIHNheDogLjA2MSwKICAgICAgICAgICAgc2F5OiAwLAogICAgICAgICAgICBlYXg6IC0uMDI1LAogICAgICAgICAgICBlYXk6IDAsCiAgICAgICAgICAgIHNlOiAhMCwKICAgICAgICAgICAgZWU6ICEwCiAgICAgICAgfSwgewogICAgICAgICAgICB4OiAuNzE2LAogICAgICAgICAgICB5OiAuMTMyLAogICAgICAgICAgICBzYXg6IC4wNzIsCiAgICAgICAgICAgIHNheTogLS4wMDQsCiAgICAgICAgICAgIGVheDogLS4wNDUsCiAgICAgICAgICAgIGVheTogMCwKICAgICAgICAgICAgc2U6ICEwLAogICAgICAgICAgICBlZTogITAKICAgICAgICB9LCB7CiAgICAgICAgICAgIHg6IC44NjYsCiAgICAgICAgICAgIHk6IC0uMzczLAogICAgICAgICAgICBzYXg6IC4wNiwKICAgICAgICAgICAgc2F5OiAwLAogICAgICAgICAgICBlYXg6IC0uMDQ5LAogICAgICAgICAgICBlYXk6IC0uMDAyLAogICAgICAgICAgICBzZTogITAsCiAgICAgICAgICAgIGVlOiAhMAogICAgICAgIH0sIHsKICAgICAgICAgICAgeDogMSwKICAgICAgICAgICAgeTogMSwKICAgICAgICAgICAgc2F4OiAwLAogICAgICAgICAgICBzYXk6IDAsCiAgICAgICAgICAgIGVheDogLS4wMzgsCiAgICAgICAgICAgIGVheTogLS4yNjMsCiAgICAgICAgICAgIHNlOiAhMSwKICAgICAgICAgICAgZWU6ICEwCiAgICAgICAgfV0pLCB0aGlzLl9BZGRQcmVkaWZpbmVkRWFzZSgiZWFzZW91dGVsYXN0aWMiLCBbewogICAgICAgICAgICB4OiAwLAogICAgICAgICAgICB5OiAwLAogICAgICAgICAgICBzYXg6IC4wMzgsCiAgICAgICAgICAgIHNheTogLjI2MywKICAgICAgICAgICAgZWF4OiAwLAogICAgICAgICAgICBlYXk6IDAsCiAgICAgICAgICAgIHNlOiAhMCwKICAgICAgICAgICAgZWU6ICExCiAgICAgICAgfSwgewogICAgICAgICAgICB4OiAuMTM2LAogICAgICAgICAgICB5OiAxLjM3MywKICAgICAgICAgICAgc2F4OiAuMDQ5LAogICAgICAgICAgICBzYXk6IC4wMDIsCiAgICAgICAgICAgIGVheDogLS4wNiwKICAgICAgICAgICAgZWF5OiAwLAogICAgICAgICAgICBzZTogITAsCiAgICAgICAgICAgIGVlOiAhMAogICAgICAgIH0sIHsKICAgICAgICAgICAgeDogLjI4NiwKICAgICAgICAgICAgeTogLjg2OCwKICAgICAgICAgICAgc2F4OiAuMDQ1LAogICAgICAgICAgICBzYXk6IDAsCiAgICAgICAgICAgIGVheDogLS4wNzIsCiAgICAgICAgICAgIGVheTogLjAwNCwKICAgICAgICAgICAgc2U6ICEwLAogICAgICAgICAgICBlZTogITAKICAgICAgICB9LCB7CiAgICAgICAgICAgIHg6IC40MzYsCiAgICAgICAgICAgIHk6IDEuMDQ1LAogICAgICAgICAgICBzYXg6IC4wMjUsCiAgICAgICAgICAgIHNheTogMCwKICAgICAgICAgICAgZWF4OiAtLjA2MSwKICAgICAgICAgICAgZWF5OiAwLAogICAgICAgICAgICBzZTogITAsCiAgICAgICAgICAgIGVlOiAhMAogICAgICAgIH0sIHsKICAgICAgICAgICAgeDogLjU4NiwKICAgICAgICAgICAgeTogLjk4NCwKICAgICAgICAgICAgc2F4OiAuMDI2LAogICAgICAgICAgICBzYXk6IDAsCiAgICAgICAgICAgIGVheDogLS4wMjQsCiAgICAgICAgICAgIGVheTogMCwKICAgICAgICAgICAgc2U6ICEwLAogICAgICAgICAgICBlZTogITAKICAgICAgICB9LCB7CiAgICAgICAgICAgIHg6IC43MzYsCiAgICAgICAgICAgIHk6IDEuMDA1LAogICAgICAgICAgICBzYXg6IC4wMjEsCiAgICAgICAgICAgIHNheTogMCwKICAgICAgICAgICAgZWF4OiAtLjAyNCwKICAgICAgICAgICAgZWF5OiAwLAogICAgICAgICAgICBzZTogITAsCiAgICAgICAgICAgIGVlOiAhMAogICAgICAgIH0sIHsKICAgICAgICAgICAgeDogLjg4NiwKICAgICAgICAgICAgeTogLjk5OCwKICAgICAgICAgICAgc2F4OiAuMDI1LAogICAgICAgICAgICBzYXk6IDAsCiAgICAgICAgICAgIGVheDogLS4wMjUsCiAgICAgICAgICAgIGVheTogMCwKICAgICAgICAgICAgc2U6ICEwLAogICAgICAgICAgICBlZTogITAKICAgICAgICB9LCB7CiAgICAgICAgICAgIHg6IDEsCiAgICAgICAgICAgIHk6IDEsCiAgICAgICAgICAgIHNheDogMCwKICAgICAgICAgICAgc2F5OiAwLAogICAgICAgICAgICBlYXg6IC0uMDE4LAogICAgICAgICAgICBlYXk6IDAsCiAgICAgICAgICAgIHNlOiAhMSwKICAgICAgICAgICAgZWU6ICEwCiAgICAgICAgfV0pLCB0aGlzLl9BZGRQcmVkaWZpbmVkRWFzZSgiZWFzZWlub3V0ZWxhc3RpYyIsIFt7CiAgICAgICAgICAgIHg6IDAsCiAgICAgICAgICAgIHk6IDAsCiAgICAgICAgICAgIHNheDogLjAyNSwKICAgICAgICAgICAgc2F5OiAwLAogICAgICAgICAgICBlYXg6IDAsCiAgICAgICAgICAgIGVheTogMCwKICAgICAgICAgICAgc2U6ICEwLAogICAgICAgICAgICBlZTogITEKICAgICAgICB9LCB7CiAgICAgICAgICAgIHg6IC4wNjcsCiAgICAgICAgICAgIHk6IC4wMDEsCiAgICAgICAgICAgIHNheDogLjAyNSwKICAgICAgICAgICAgc2F5OiAwLAogICAgICAgICAgICBlYXg6IC0uMDI1LAogICAgICAgICAgICBlYXk6IDAsCiAgICAgICAgICAgIHNlOiAhMCwKICAgICAgICAgICAgZWU6ICEwCiAgICAgICAgfSwgewogICAgICAgICAgICB4OiAuMTgsCiAgICAgICAgICAgIHk6IC0uMDA1LAogICAgICAgICAgICBzYXg6IC4wMjUsCiAgICAgICAgICAgIHNheTogMCwKICAgICAgICAgICAgZWF4OiAtLjAyNSwKICAgICAgICAgICAgZWF5OiAwLAogICAgICAgICAgICBzZTogITAsCiAgICAgICAgICAgIGVlOiAhMAogICAgICAgIH0sIHsKICAgICAgICAgICAgeDogLjI5MiwKICAgICAgICAgICAgeTogLjAyNSwKICAgICAgICAgICAgc2F4OiAuMDUzLAogICAgICAgICAgICBzYXk6IDAsCiAgICAgICAgICAgIGVheDogLS4wMjUsCiAgICAgICAgICAgIGVheTogMCwKICAgICAgICAgICAgc2U6ICEwLAogICAgICAgICAgICBlZTogITAKICAgICAgICB9LCB7CiAgICAgICAgICAgIHg6IC40MDUsCiAgICAgICAgICAgIHk6IC0uMTE4LAogICAgICAgICAgICBzYXg6IC4wNjksCiAgICAgICAgICAgIHNheTogMCwKICAgICAgICAgICAgZWF4OiAtLjAyNywKICAgICAgICAgICAgZWF5OiAwLAogICAgICAgICAgICBzZTogITAsCiAgICAgICAgICAgIGVlOiAhMAogICAgICAgIH0sIHsKICAgICAgICAgICAgeDogLjU5NywKICAgICAgICAgICAgeTogMS4xMTgsCiAgICAgICAgICAgIHNheDogLjAyNywKICAgICAgICAgICAgc2F5OiAwLAogICAgICAgICAgICBlYXg6IC0uMDY5LAogICAgICAgICAgICBlYXk6IDAsCiAgICAgICAgICAgIHNlOiAhMCwKICAgICAgICAgICAgZWU6ICEwCiAgICAgICAgfSwgewogICAgICAgICAgICB4OiAuNzEsCiAgICAgICAgICAgIHk6IC45NzUsCiAgICAgICAgICAgIHNheDogLjAyNSwKICAgICAgICAgICAgc2F5OiAwLAogICAgICAgICAgICBlYXg6IC0uMDUzLAogICAgICAgICAgICBlYXk6IDAsCiAgICAgICAgICAgIHNlOiAhMCwKICAgICAgICAgICAgZWU6ICEwCiAgICAgICAgfSwgewogICAgICAgICAgICB4OiAuODIyLAogICAgICAgICAgICB5OiAxLjAwNSwKICAgICAgICAgICAgc2F4OiAuMDI1LAogICAgICAgICAgICBzYXk6IDAsCiAgICAgICAgICAgIGVheDogLS4wMjUsCiAgICAgICAgICAgIGVheTogMCwKICAgICAgICAgICAgc2U6ICEwLAogICAgICAgICAgICBlZTogITAKICAgICAgICB9LCB7CiAgICAgICAgICAgIHg6IC45MzUsCiAgICAgICAgICAgIHk6IC45OTksCiAgICAgICAgICAgIHNheDogLjAyNSwKICAgICAgICAgICAgc2F5OiAwLAogICAgICAgICAgICBlYXg6IC0uMDI1LAogICAgICAgICAgICBlYXk6IDAsCiAgICAgICAgICAgIHNlOiAhMCwKICAgICAgICAgICAgZWU6ICEwCiAgICAgICAgfSwgewogICAgICAgICAgICB4OiAxLAogICAgICAgICAgICB5OiAxLAogICAgICAgICAgICBzYXg6IDAsCiAgICAgICAgICAgIHNheTogMCwKICAgICAgICAgICAgZWF4OiAtLjAyNSwKICAgICAgICAgICAgZWF5OiAwLAogICAgICAgICAgICBzZTogITEsCiAgICAgICAgICAgIGVlOiAhMAogICAgICAgIH1dKSwgdGhpcy5fQWRkUHJlZGlmaW5lZEVhc2UoImVhc2VpbmJhY2siLCBbewogICAgICAgICAgICB4OiAwLAogICAgICAgICAgICB5OiAwLAogICAgICAgICAgICBzYXg6IC4zNSwKICAgICAgICAgICAgc2F5OiAwLAogICAgICAgICAgICBlYXg6IDAsCiAgICAgICAgICAgIGVheTogMCwKICAgICAgICAgICAgc2U6ICEwLAogICAgICAgICAgICBlZTogITEKICAgICAgICB9LCB7CiAgICAgICAgICAgIHg6IDEsCiAgICAgICAgICAgIHk6IDEsCiAgICAgICAgICAgIHNheDogMCwKICAgICAgICAgICAgc2F5OiAwLAogICAgICAgICAgICBlYXg6IC0uMzQsCiAgICAgICAgICAgIGVheTogLTEuNTc5LAogICAgICAgICAgICBzZTogITEsCiAgICAgICAgICAgIGVlOiAhMAogICAgICAgIH1dKSwgdGhpcy5fQWRkUHJlZGlmaW5lZEVhc2UoImVhc2VvdXRiYWNrIiwgW3sKICAgICAgICAgICAgeDogMCwKICAgICAgICAgICAgeTogMCwKICAgICAgICAgICAgc2F4OiAuMzQsCiAgICAgICAgICAgIHNheTogMS41NzksCiAgICAgICAgICAgIGVheDogMCwKICAgICAgICAgICAgZWF5OiAwLAogICAgICAgICAgICBzZTogITAsCiAgICAgICAgICAgIGVlOiAhMQogICAgICAgIH0sIHsKICAgICAgICAgICAgeDogMSwKICAgICAgICAgICAgeTogMSwKICAgICAgICAgICAgc2F4OiAwLAogICAgICAgICAgICBzYXk6IDAsCiAgICAgICAgICAgIGVheDogLS4zNSwKICAgICAgICAgICAgZWF5OiAwLAogICAgICAgICAgICBzZTogITEsCiAgICAgICAgICAgIGVlOiAhMAogICAgICAgIH1dKSwgdGhpcy5fQWRkUHJlZGlmaW5lZEVhc2UoImVhc2Vpbm91dGJhY2siLCBbewogICAgICAgICAgICAgICAgeDogMCwKICAgICAgICAgICAgICAgIHk6IDAsCiAgICAgICAgICAgICAgICBzYXg6IC4wMzUsCiAgICAgICAgICAgICAgICBzYXk6IDAsCiAgICAgICAgICAgICAgICBlYXg6IDAsCiAgICAgICAgICAgICAgICBlYXk6IDAsCiAgICAgICAgICAgICAgICBzZTogITAsCiAgICAgICAgICAgICAgICBlZTogITEKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgeDogLjI0MiwKICAgICAgICAgICAgICAgIHk6IC0uMSwKICAgICAgICAgICAgICAgIHNheDogLjI1OCwKICAgICAgICAgICAgICAgIHNheTogMCwKICAgICAgICAgICAgICAgIGVheDogLS4wMjUsCiAgICAgICAgICAgICAgICBlYXk6IDAsCiAgICAgICAgICAgICAgICBzZTogITAsCiAgICAgICAgICAgICAgICBlZTogITAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgeDogLjc2LAogICAgICAgICAgICAgICAgeTogMS4xLAogICAgICAgICAgICAgICAgc2F4OiAuMDI1LAogICAgICAgICAgICAgICAgc2F5OiAwLAogICAgICAgICAgICAgICAgZWF4OiAtLjI2LAogICAgICAgICAgICAgICAgZWF5OiAwLAogICAgICAgICAgICAgICAgc2U6ICEwLAogICAgICAgICAgICAgICAgZWU6ICEwCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgIHg6IDEsCiAgICAgICAgICAgICAgICB5OiAxLAogICAgICAgICAgICAgICAgc2F4OiAwLAogICAgICAgICAgICAgICAgc2F5OiAwLAogICAgICAgICAgICAgICAgZWF4OiAtLjAzNSwKICAgICAgICAgICAgICAgIGVheTogMCwKICAgICAgICAgICAgICAgIHNlOiAhMSwKICAgICAgICAgICAgICAgIGVlOiAhMAogICAgICAgICAgICB9CiAgICAgICAgXSksIHRoaXMuX0FkZFByZWRpZmluZWRFYXNlKCJlYXNlaW5ib3VuY2UiLCBbewogICAgICAgICAgICB4OiAwLAogICAgICAgICAgICB5OiAwLAogICAgICAgICAgICBzYXg6IC4wMzMsCiAgICAgICAgICAgIHNheTogLjAyNSwKICAgICAgICAgICAgZWF4OiAwLAogICAgICAgICAgICBlYXk6IDAsCiAgICAgICAgICAgIHNlOiAhMCwKICAgICAgICAgICAgZWU6ICExCiAgICAgICAgfSwgewogICAgICAgICAgICB4OiAuMDkyLAogICAgICAgICAgICB5OiAwLAogICAgICAgICAgICBzYXg6IC4wMjYsCiAgICAgICAgICAgIHNheTogLjA3OCwKICAgICAgICAgICAgZWF4OiAtLjAzMywKICAgICAgICAgICAgZWF5OiAuMDI1LAogICAgICAgICAgICBzZTogITAsCiAgICAgICAgICAgIGVlOiAhMAogICAgICAgIH0sIHsKICAgICAgICAgICAgeDogLjI3NCwKICAgICAgICAgICAgeTogMCwKICAgICAgICAgICAgc2F4OiAuMDk3LAogICAgICAgICAgICBzYXk6IC4zMTksCiAgICAgICAgICAgIGVheDogLS4wMjYsCiAgICAgICAgICAgIGVheTogLjA3OCwKICAgICAgICAgICAgc2U6ICEwLAogICAgICAgICAgICBlZTogITAKICAgICAgICB9LCB7CiAgICAgICAgICAgIHg6IC42MzcsCiAgICAgICAgICAgIHk6IDAsCiAgICAgICAgICAgIHNheDogLjEwNSwKICAgICAgICAgICAgc2F5OiAuNjI1LAogICAgICAgICAgICBlYXg6IC0uMDk3LAogICAgICAgICAgICBlYXk6IC4zMTksCiAgICAgICAgICAgIHNlOiAhMCwKICAgICAgICAgICAgZWU6ICEwCiAgICAgICAgfSwgewogICAgICAgICAgICB4OiAxLAogICAgICAgICAgICB5OiAxLAogICAgICAgICAgICBzYXg6IDAsCiAgICAgICAgICAgIHNheTogMCwKICAgICAgICAgICAgZWF4OiAtLjEyNSwKICAgICAgICAgICAgZWF5OiAtLjAwNCwKICAgICAgICAgICAgc2U6ICExLAogICAgICAgICAgICBlZTogITAKICAgICAgICB9XSksIHRoaXMuX0FkZFByZWRpZmluZWRFYXNlKCJlYXNlb3V0Ym91bmNlIiwgW3sKICAgICAgICAgICAgeDogMCwKICAgICAgICAgICAgeTogMCwKICAgICAgICAgICAgc2F4OiAuMTI1LAogICAgICAgICAgICBzYXk6IC4wMDQsCiAgICAgICAgICAgIGVheDogMCwKICAgICAgICAgICAgZWF5OiAwLAogICAgICAgICAgICBzZTogITAsCiAgICAgICAgICAgIGVlOiAhMQogICAgICAgIH0sIHsKICAgICAgICAgICAgeDogLjM2NSwKICAgICAgICAgICAgeTogMSwKICAgICAgICAgICAgc2F4OiAuMDk3LAogICAgICAgICAgICBzYXk6IC0uMzE5LAogICAgICAgICAgICBlYXg6IC0uMTA1LAogICAgICAgICAgICBlYXk6IC0uNjI1LAogICAgICAgICAgICBzZTogITAsCiAgICAgICAgICAgIGVlOiAhMAogICAgICAgIH0sIHsKICAgICAgICAgICAgeDogLjcyOCwKICAgICAgICAgICAgeTogMSwKICAgICAgICAgICAgc2F4OiAuMDI2LAogICAgICAgICAgICBzYXk6IC0uMDc4LAogICAgICAgICAgICBlYXg6IC0uMDk3LAogICAgICAgICAgICBlYXk6IC0uMzE5LAogICAgICAgICAgICBzZTogITAsCiAgICAgICAgICAgIGVlOiAhMAogICAgICAgIH0sIHsKICAgICAgICAgICAgeDogLjkxLAogICAgICAgICAgICB5OiAxLAogICAgICAgICAgICBzYXg6IC4wMzMsCiAgICAgICAgICAgIHNheTogLS4wMjUsCiAgICAgICAgICAgIGVheDogLS4wMjYsCiAgICAgICAgICAgIGVheTogLS4wNzgsCiAgICAgICAgICAgIHNlOiAhMCwKICAgICAgICAgICAgZWU6ICEwCiAgICAgICAgfSwgewogICAgICAgICAgICB4OiAxLAogICAgICAgICAgICB5OiAxLAogICAgICAgICAgICBzYXg6IDAsCiAgICAgICAgICAgIHNheTogMCwKICAgICAgICAgICAgZWF4OiAtLjAzMywKICAgICAgICAgICAgZWF5OiAtLjAyNSwKICAgICAgICAgICAgc2U6ICExLAogICAgICAgICAgICBlZTogITAKICAgICAgICB9XSksIHRoaXMuX0FkZFByZWRpZmluZWRFYXNlKCJlYXNlaW5vdXRib3VuY2UiLCBbewogICAgICAgICAgICB4OiAwLAogICAgICAgICAgICB5OiAwLAogICAgICAgICAgICBzYXg6IC4wMSwKICAgICAgICAgICAgc2F5OiAuMDA2LAogICAgICAgICAgICBlYXg6IDAsCiAgICAgICAgICAgIGVheTogMCwKICAgICAgICAgICAgc2U6ICEwLAogICAgICAgICAgICBlZTogITEKICAgICAgICB9LCB7CiAgICAgICAgICAgIHg6IC4wNDYsCiAgICAgICAgICAgIHk6IDAsCiAgICAgICAgICAgIHNheDogLjAyMSwKICAgICAgICAgICAgc2F5OiAuMDM4LAogICAgICAgICAgICBlYXg6IC0uMDEsCiAgICAgICAgICAgIGVheTogLjAwNiwKICAgICAgICAgICAgc2U6ICEwLAogICAgICAgICAgICBlZTogITAKICAgICAgICB9LCB7CiAgICAgICAgICAgIHg6IC4xMzcsCiAgICAgICAgICAgIHk6IDAsCiAgICAgICAgICAgIHNheDogLjA1OSwKICAgICAgICAgICAgc2F5OiAuMTU4LAogICAgICAgICAgICBlYXg6IC0uMDIxLAogICAgICAgICAgICBlYXk6IC4wMzgsCiAgICAgICAgICAgIHNlOiAhMCwKICAgICAgICAgICAgZWU6ICEwCiAgICAgICAgfSwgewogICAgICAgICAgICB4OiAuMzE5LAogICAgICAgICAgICB5OiAwLAogICAgICAgICAgICBzYXg6IC4xMTcsCiAgICAgICAgICAgIHNheTogLjc0NCwKICAgICAgICAgICAgZWF4OiAtLjA1OSwKICAgICAgICAgICAgZWF5OiAuMTU4LAogICAgICAgICAgICBzZTogITAsCiAgICAgICAgICAgIGVlOiAhMAogICAgICAgIH0sIHsKICAgICAgICAgICAgeDogLjY4MywKICAgICAgICAgICAgeTogMSwKICAgICAgICAgICAgc2F4OiAuMDU5LAogICAgICAgICAgICBzYXk6IC0uMTU4LAogICAgICAgICAgICBlYXg6IC0uMTE3LAogICAgICAgICAgICBlYXk6IC0uNzQ0LAogICAgICAgICAgICBzZTogITAsCiAgICAgICAgICAgIGVlOiAhMAogICAgICAgIH0sIHsKICAgICAgICAgICAgeDogLjg2NSwKICAgICAgICAgICAgeTogMSwKICAgICAgICAgICAgc2F4OiAuMDIxLAogICAgICAgICAgICBzYXk6IC0uMDM4LAogICAgICAgICAgICBlYXg6IC0uMDU5LAogICAgICAgICAgICBlYXk6IC0uMTU4LAogICAgICAgICAgICBzZTogITAsCiAgICAgICAgICAgIGVlOiAhMAogICAgICAgIH0sIHsKICAgICAgICAgICAgeDogLjk1NiwKICAgICAgICAgICAgeTogMSwKICAgICAgICAgICAgc2F4OiAuMDEsCiAgICAgICAgICAgIHNheTogLS4wMDYsCiAgICAgICAgICAgIGVheDogLS4wMjEsCiAgICAgICAgICAgIGVheTogLS4wMzgsCiAgICAgICAgICAgIHNlOiAhMCwKICAgICAgICAgICAgZWU6ICEwCiAgICAgICAgfSwgewogICAgICAgICAgICB4OiAxLAogICAgICAgICAgICB5OiAxLAogICAgICAgICAgICBzYXg6IDAsCiAgICAgICAgICAgIHNheTogMCwKICAgICAgICAgICAgZWF4OiAtLjAxLAogICAgICAgICAgICBlYXk6IC0uMDA2LAogICAgICAgICAgICBzZTogITEsCiAgICAgICAgICAgIGVlOiAhMAogICAgICAgIH1dKSwgdGhpcy5fQWRkUHJlZGlmaW5lZEVhc2UoImVhc2VpbmN1YmljIiwgW3sKICAgICAgICAgICAgeDogMCwKICAgICAgICAgICAgeTogMCwKICAgICAgICAgICAgc2F4OiAuNzUsCiAgICAgICAgICAgIHNheTogMCwKICAgICAgICAgICAgZWF4OiAwLAogICAgICAgICAgICBlYXk6IDAsCiAgICAgICAgICAgIHNlOiAhMCwKICAgICAgICAgICAgZWU6ICExCiAgICAgICAgfSwgewogICAgICAgICAgICB4OiAxLAogICAgICAgICAgICB5OiAxLAogICAgICAgICAgICBzYXg6IDAsCiAgICAgICAgICAgIHNheTogMCwKICAgICAgICAgICAgZWF4OiAtLjEzOCwKICAgICAgICAgICAgZWF5OiAtLjMyMSwKICAgICAgICAgICAgc2U6ICExLAogICAgICAgICAgICBlZTogITAKICAgICAgICB9XSksIHRoaXMuX0FkZFByZWRpZmluZWRFYXNlKCJlYXNlb3V0Y3ViaWMiLCBbewogICAgICAgICAgICB4OiAwLAogICAgICAgICAgICB5OiAwLAogICAgICAgICAgICBzYXg6IC4xMzgsCiAgICAgICAgICAgIHNheTogLjMyMSwKICAgICAgICAgICAgZWF4OiAwLAogICAgICAgICAgICBlYXk6IDAsCiAgICAgICAgICAgIHNlOiAhMCwKICAgICAgICAgICAgZWU6ICExCiAgICAgICAgfSwgewogICAgICAgICAgICB4OiAxLAogICAgICAgICAgICB5OiAxLAogICAgICAgICAgICBzYXg6IDAsCiAgICAgICAgICAgIHNheTogMCwKICAgICAgICAgICAgZWF4OiAtLjc1LAogICAgICAgICAgICBlYXk6IDAsCiAgICAgICAgICAgIHNlOiAhMSwKICAgICAgICAgICAgZWU6ICEwCiAgICAgICAgfV0pLCB0aGlzLl9BZGRQcmVkaWZpbmVkRWFzZSgiZWFzZWlub3V0Y3ViaWMiLCBbewogICAgICAgICAgICB4OiAwLAogICAgICAgICAgICB5OiAwLAogICAgICAgICAgICBzYXg6IC4yODUsCiAgICAgICAgICAgIHNheTogMCwKICAgICAgICAgICAgZWF4OiAwLAogICAgICAgICAgICBlYXk6IDAsCiAgICAgICAgICAgIHNlOiAhMCwKICAgICAgICAgICAgZWU6ICExCiAgICAgICAgfSwgewogICAgICAgICAgICB4OiAuNSwKICAgICAgICAgICAgeTogLjUsCiAgICAgICAgICAgIHNheDogLjA4MSwKICAgICAgICAgICAgc2F5OiAuMjcyLAogICAgICAgICAgICBlYXg6IC0uMDgxLAogICAgICAgICAgICBlYXk6IC0uMjcyLAogICAgICAgICAgICBzZTogITAsCiAgICAgICAgICAgIGVlOiAhMAogICAgICAgIH0sIHsKICAgICAgICAgICAgeDogMSwKICAgICAgICAgICAgeTogMSwKICAgICAgICAgICAgc2F4OiAwLAogICAgICAgICAgICBzYXk6IDAsCiAgICAgICAgICAgIGVheDogLS4yODUsCiAgICAgICAgICAgIGVheTogMCwKICAgICAgICAgICAgc2U6ICExLAogICAgICAgICAgICBlZTogITAKICAgICAgICB9XSksIHRoaXMuX0FkZFByZWRpZmluZWRFYXNlKCJlYXNlaW5xdWFkIiwgW3sKICAgICAgICAgICAgeDogMCwKICAgICAgICAgICAgeTogMCwKICAgICAgICAgICAgc2F4OiAuNCwKICAgICAgICAgICAgc2F5OiAwLAogICAgICAgICAgICBlYXg6IDAsCiAgICAgICAgICAgIGVheTogMCwKICAgICAgICAgICAgc2U6ICEwLAogICAgICAgICAgICBlZTogITEKICAgICAgICB9LCB7CiAgICAgICAgICAgIHg6IDEsCiAgICAgICAgICAgIHk6IDEsCiAgICAgICAgICAgIHNheDogMCwKICAgICAgICAgICAgc2F5OiAwLAogICAgICAgICAgICBlYXg6IC0uMTc4LAogICAgICAgICAgICBlYXk6IC0uMzkyLAogICAgICAgICAgICBzZTogITEsCiAgICAgICAgICAgIGVlOiAhMAogICAgICAgIH1dKSwgdGhpcy5fQWRkUHJlZGlmaW5lZEVhc2UoImVhc2VvdXRxdWFkIiwgW3sKICAgICAgICAgICAgeDogMCwKICAgICAgICAgICAgeTogMCwKICAgICAgICAgICAgc2F4OiAuMTc4LAogICAgICAgICAgICBzYXk6IC4zOTIsCiAgICAgICAgICAgIGVheDogMCwKICAgICAgICAgICAgZWF5OiAwLAogICAgICAgICAgICBzZTogITAsCiAgICAgICAgICAgIGVlOiAhMQogICAgICAgIH0sIHsKICAgICAgICAgICAgeDogMSwKICAgICAgICAgICAgeTogMSwKICAgICAgICAgICAgc2F4OiAwLAogICAgICAgICAgICBzYXk6IDAsCiAgICAgICAgICAgIGVheDogLS40LAogICAgICAgICAgICBlYXk6IDAsCiAgICAgICAgICAgIHNlOiAhMSwKICAgICAgICAgICAgZWU6ICEwCiAgICAgICAgfV0pLCB0aGlzLl9BZGRQcmVkaWZpbmVkRWFzZSgiZWFzZWlub3V0cXVhZCIsIFt7CiAgICAgICAgICAgIHg6IDAsCiAgICAgICAgICAgIHk6IDAsCiAgICAgICAgICAgIHNheDogLjI1LAogICAgICAgICAgICBzYXk6IDAsCiAgICAgICAgICAgIGVheDogMCwKICAgICAgICAgICAgZWF5OiAwLAogICAgICAgICAgICBzZTogITAsCiAgICAgICAgICAgIGVlOiAhMQogICAgICAgIH0sIHsKICAgICAgICAgICAgeDogLjUsCiAgICAgICAgICAgIHk6IC41LAogICAgICAgICAgICBzYXg6IC4wMywKICAgICAgICAgICAgc2F5OiAuMDY1LAogICAgICAgICAgICBlYXg6IC0uMDMsCiAgICAgICAgICAgIGVheTogLS4wNjUsCiAgICAgICAgICAgIHNlOiAhMCwKICAgICAgICAgICAgZWU6ICEwCiAgICAgICAgfSwgewogICAgICAgICAgICB4OiAxLAogICAgICAgICAgICB5OiAxLAogICAgICAgICAgICBzYXg6IDAsCiAgICAgICAgICAgIHNheTogMCwKICAgICAgICAgICAgZWF4OiAtLjI1LAogICAgICAgICAgICBlYXk6IDAsCiAgICAgICAgICAgIHNlOiAhMSwKICAgICAgICAgICAgZWU6ICEwCiAgICAgICAgfV0pLCB0aGlzLl9BZGRQcmVkaWZpbmVkRWFzZSgiZWFzZWlucXVhcnQiLCBbewogICAgICAgICAgICB4OiAwLAogICAgICAgICAgICB5OiAwLAogICAgICAgICAgICBzYXg6IC4yNjQsCiAgICAgICAgICAgIHNheTogLjA3OSwKICAgICAgICAgICAgZWF4OiAwLAogICAgICAgICAgICBlYXk6IDAsCiAgICAgICAgICAgIHNlOiAhMCwKICAgICAgICAgICAgZWU6ICExCiAgICAgICAgfSwgewogICAgICAgICAgICB4OiAxLAogICAgICAgICAgICB5OiAxLAogICAgICAgICAgICBzYXg6IDAsCiAgICAgICAgICAgIHNheTogMCwKICAgICAgICAgICAgZWF4OiAtLjMyOSwKICAgICAgICAgICAgZWF5OiAtMS4yODcsCiAgICAgICAgICAgIHNlOiAhMSwKICAgICAgICAgICAgZWU6ICEwCiAgICAgICAgfV0pLCB0aGlzLl9BZGRQcmVkaWZpbmVkRWFzZSgiZWFzZW91dHF1YXJ0IiwgW3sKICAgICAgICAgICAgeDogMCwKICAgICAgICAgICAgeTogMCwKICAgICAgICAgICAgc2F4OiAuMzI5LAogICAgICAgICAgICBzYXk6IDEuMjg3LAogICAgICAgICAgICBlYXg6IDAsCiAgICAgICAgICAgIGVheTogMCwKICAgICAgICAgICAgc2U6ICEwLAogICAgICAgICAgICBlZTogITEKICAgICAgICB9LCB7CiAgICAgICAgICAgIHg6IDEsCiAgICAgICAgICAgIHk6IDEsCiAgICAgICAgICAgIHNheDogMCwKICAgICAgICAgICAgc2F5OiAwLAogICAgICAgICAgICBlYXg6IC0uMjY0LAogICAgICAgICAgICBlYXk6IC0uMDc5LAogICAgICAgICAgICBzZTogITEsCiAgICAgICAgICAgIGVlOiAhMAogICAgICAgIH1dKSwgdGhpcy5fQWRkUHJlZGlmaW5lZEVhc2UoImVhc2Vpbm91dHF1YXJ0IiwgW3sKICAgICAgICAgICAgeDogMCwKICAgICAgICAgICAgeTogMCwKICAgICAgICAgICAgc2F4OiAuNzY1LAogICAgICAgICAgICBzYXk6IC4wMywKICAgICAgICAgICAgZWF4OiAwLAogICAgICAgICAgICBlYXk6IDAsCiAgICAgICAgICAgIHNlOiAhMCwKICAgICAgICAgICAgZWU6ICExCiAgICAgICAgfSwgewogICAgICAgICAgICB4OiAxLAogICAgICAgICAgICB5OiAxLAogICAgICAgICAgICBzYXg6IDAsCiAgICAgICAgICAgIHNheTogMCwKICAgICAgICAgICAgZWF4OiAtLjc2NSwKICAgICAgICAgICAgZWF5OiAtLjAzLAogICAgICAgICAgICBzZTogITEsCiAgICAgICAgICAgIGVlOiAhMAogICAgICAgIH1dKSwgdGhpcy5fQWRkUHJlZGlmaW5lZEVhc2UoImVhc2VpbnF1aW50IiwgW3sKICAgICAgICAgICAgeDogMCwKICAgICAgICAgICAgeTogMCwKICAgICAgICAgICAgc2F4OiAuNiwKICAgICAgICAgICAgc2F5OiAwLAogICAgICAgICAgICBlYXg6IDAsCiAgICAgICAgICAgIGVheTogMCwKICAgICAgICAgICAgc2U6ICEwLAogICAgICAgICAgICBlZTogITEKICAgICAgICB9LCB7CiAgICAgICAgICAgIHg6IDEsCiAgICAgICAgICAgIHk6IDEsCiAgICAgICAgICAgIHNheDogMCwKICAgICAgICAgICAgc2F5OiAwLAogICAgICAgICAgICBlYXg6IC0uMiwKICAgICAgICAgICAgZWF5OiAtMSwKICAgICAgICAgICAgc2U6ICExLAogICAgICAgICAgICBlZTogITAKICAgICAgICB9XSksIHRoaXMuX0FkZFByZWRpZmluZWRFYXNlKCJlYXNlb3V0cXVpbnQiLCBbewogICAgICAgICAgICB4OiAwLAogICAgICAgICAgICB5OiAwLAogICAgICAgICAgICBzYXg6IC4yLAogICAgICAgICAgICBzYXk6IDEsCiAgICAgICAgICAgIGVheDogMCwKICAgICAgICAgICAgZWF5OiAwLAogICAgICAgICAgICBzZTogITAsCiAgICAgICAgICAgIGVlOiAhMQogICAgICAgIH0sIHsKICAgICAgICAgICAgeDogMSwKICAgICAgICAgICAgeTogMSwKICAgICAgICAgICAgc2F4OiAwLAogICAgICAgICAgICBzYXk6IDAsCiAgICAgICAgICAgIGVheDogLS42LAogICAgICAgICAgICBlYXk6IDAsCiAgICAgICAgICAgIHNlOiAhMSwKICAgICAgICAgICAgZWU6ICEwCiAgICAgICAgfV0pLCB0aGlzLl9BZGRQcmVkaWZpbmVkRWFzZSgiZWFzZWlub3V0cXVpbnQiLCBbewogICAgICAgICAgICBlYXg6IDAsCiAgICAgICAgICAgIGVheTogMCwKICAgICAgICAgICAgZWU6ICExLAogICAgICAgICAgICBzYXg6IC44NCwKICAgICAgICAgICAgc2F5OiAwLAogICAgICAgICAgICBzZTogITAsCiAgICAgICAgICAgIHg6IDAsCiAgICAgICAgICAgIHk6IDAKICAgICAgICB9LCB7CiAgICAgICAgICAgIGVheDogLS44NCwKICAgICAgICAgICAgZWF5OiAwLAogICAgICAgICAgICBlZTogITAsCiAgICAgICAgICAgIHNheDogMCwKICAgICAgICAgICAgc2F5OiAwLAogICAgICAgICAgICBzZTogITEsCiAgICAgICAgICAgIHg6IDEsCiAgICAgICAgICAgIHk6IDEKICAgICAgICB9XSksIHRoaXMuX0FkZFByZWRpZmluZWRFYXNlKCJlYXNlaW5jaXJjIiwgW3sKICAgICAgICAgICAgeDogMCwKICAgICAgICAgICAgeTogMCwKICAgICAgICAgICAgc2F4OiAuMjUsCiAgICAgICAgICAgIHNheTogMCwKICAgICAgICAgICAgZWF4OiAwLAogICAgICAgICAgICBlYXk6IDAsCiAgICAgICAgICAgIHNlOiAhMCwKICAgICAgICAgICAgZWU6ICExCiAgICAgICAgfSwgewogICAgICAgICAgICB4OiAxLAogICAgICAgICAgICB5OiAxLAogICAgICAgICAgICBzYXg6IDAsCiAgICAgICAgICAgIHNheTogMCwKICAgICAgICAgICAgZWF4OiAtLjAyNCwKICAgICAgICAgICAgZWF5OiAtLjgwOCwKICAgICAgICAgICAgc2U6ICExLAogICAgICAgICAgICBlZTogITAKICAgICAgICB9XSksIHRoaXMuX0FkZFByZWRpZmluZWRFYXNlKCJlYXNlb3V0Y2lyYyIsIFt7CiAgICAgICAgICAgIHg6IDAsCiAgICAgICAgICAgIHk6IDAsCiAgICAgICAgICAgIHNheDogLjAyNCwKICAgICAgICAgICAgc2F5OiAuODA4LAogICAgICAgICAgICBlYXg6IDAsCiAgICAgICAgICAgIGVheTogMCwKICAgICAgICAgICAgc2U6ICEwLAogICAgICAgICAgICBlZTogITEKICAgICAgICB9LCB7CiAgICAgICAgICAgIHg6IDEsCiAgICAgICAgICAgIHk6IDEsCiAgICAgICAgICAgIHNheDogMCwKICAgICAgICAgICAgc2F5OiAwLAogICAgICAgICAgICBlYXg6IC0uMjUsCiAgICAgICAgICAgIGVheTogMCwKICAgICAgICAgICAgc2U6ICExLAogICAgICAgICAgICBlZTogITAKICAgICAgICB9XSksIHRoaXMuX0FkZFByZWRpZmluZWRFYXNlKCJlYXNlaW5vdXRjaXJjIiwgW3sKICAgICAgICAgICAgeDogMCwKICAgICAgICAgICAgeTogMCwKICAgICAgICAgICAgc2F4OiAuMTI1LAogICAgICAgICAgICBzYXk6IDAsCiAgICAgICAgICAgIGVheDogMCwKICAgICAgICAgICAgZWF5OiAwLAogICAgICAgICAgICBzZTogITAsCiAgICAgICAgICAgIGVlOiAhMQogICAgICAgIH0sIHsKICAgICAgICAgICAgeDogLjUsCiAgICAgICAgICAgIHk6IC41LAogICAgICAgICAgICBzYXg6IC4wMiwKICAgICAgICAgICAgc2F5OiAuNDI4LAogICAgICAgICAgICBlYXg6IC0uMDIsCiAgICAgICAgICAgIGVheTogLS40MjgsCiAgICAgICAgICAgIHNlOiAhMCwKICAgICAgICAgICAgZWU6ICEwCiAgICAgICAgfSwgewogICAgICAgICAgICB4OiAxLAogICAgICAgICAgICB5OiAxLAogICAgICAgICAgICBzYXg6IDAsCiAgICAgICAgICAgIHNheTogMCwKICAgICAgICAgICAgZWF4OiAtLjEyNSwKICAgICAgICAgICAgZWF5OiAwLAogICAgICAgICAgICBzZTogITEsCiAgICAgICAgICAgIGVlOiAhMAogICAgICAgIH1dKSwgdGhpcy5fQWRkUHJlZGlmaW5lZEVhc2UoImVhc2VpbmV4cG8iLCBbewogICAgICAgICAgICB4OiAwLAogICAgICAgICAgICB5OiAwLAogICAgICAgICAgICBzYXg6IC42NiwKICAgICAgICAgICAgc2F5OiAwLAogICAgICAgICAgICBlYXg6IDAsCiAgICAgICAgICAgIGVheTogMCwKICAgICAgICAgICAgc2U6ICEwLAogICAgICAgICAgICBlZTogITEKICAgICAgICB9LCB7CiAgICAgICAgICAgIHg6IDEsCiAgICAgICAgICAgIHk6IDEsCiAgICAgICAgICAgIHNheDogMCwKICAgICAgICAgICAgc2F5OiAwLAogICAgICAgICAgICBlYXg6IC0uMTQsCiAgICAgICAgICAgIGVheTogLTEsCiAgICAgICAgICAgIHNlOiAhMSwKICAgICAgICAgICAgZWU6ICEwCiAgICAgICAgfV0pLCB0aGlzLl9BZGRQcmVkaWZpbmVkRWFzZSgiZWFzZW91dGV4cG8iLCBbewogICAgICAgICAgICB4OiAwLAogICAgICAgICAgICB5OiAwLAogICAgICAgICAgICBzYXg6IC4xNCwKICAgICAgICAgICAgc2F5OiAxLAogICAgICAgICAgICBlYXg6IDAsCiAgICAgICAgICAgIGVheTogMCwKICAgICAgICAgICAgc2U6ICEwLAogICAgICAgICAgICBlZTogITEKICAgICAgICB9LCB7CiAgICAgICAgICAgIHg6IDEsCiAgICAgICAgICAgIHk6IDEsCiAgICAgICAgICAgIHNheDogMCwKICAgICAgICAgICAgc2F5OiAwLAogICAgICAgICAgICBlYXg6IC0uNjYsCiAgICAgICAgICAgIGVheTogMCwKICAgICAgICAgICAgc2U6ICExLAogICAgICAgICAgICBlZTogITAKICAgICAgICB9XSksIHRoaXMuX0FkZFByZWRpZmluZWRFYXNlKCJlYXNlaW5vdXRleHBvIiwgW3sKICAgICAgICAgICAgICAgIGVheDogMCwKICAgICAgICAgICAgICAgIGVheTogMCwKICAgICAgICAgICAgICAgIGVlOiAhMSwKICAgICAgICAgICAgICAgIHNheDogLjM0NSwKICAgICAgICAgICAgICAgIHNheTogMCwKICAgICAgICAgICAgICAgIHNlOiAhMCwKICAgICAgICAgICAgICAgIHg6IDAsCiAgICAgICAgICAgICAgICB5OiAwCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgIGVheDogLS4wNiwKICAgICAgICAgICAgICAgIGVheTogLS41LAogICAgICAgICAgICAgICAgZWU6ICEwLAogICAgICAgICAgICAgICAgc2F4OiAuMDYsCiAgICAgICAgICAgICAgICBzYXk6IC41LAogICAgICAgICAgICAgICAgc2U6ICEwLAogICAgICAgICAgICAgICAgeDogLjUsCiAgICAgICAgICAgICAgICB5OiAuNQogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBlYXg6IC0uMzM1LAogICAgICAgICAgICAgICAgZWF5OiAwLAogICAgICAgICAgICAgICAgZWU6ICEwLAogICAgICAgICAgICAgICAgc2F4OiAwLAogICAgICAgICAgICAgICAgc2F5OiAwLAogICAgICAgICAgICAgICAgc2U6ICExLAogICAgICAgICAgICAgICAgeDogMSwKICAgICAgICAgICAgICAgIHk6IDEKICAgICAgICAgICAgfQogICAgICAgIF0pLCB0aGlzLl9BZGRQcml2YXRlQ3VzdG9tRWFzZSgiY3ViaWNiZXppZXIiLCB0aGlzLkVhc2VDdWJpY0JlemllciksIHRoaXMuX0FkZFByaXZhdGVDdXN0b21FYXNlKCJzcGxpbmUiLCB0aGlzLkVhc2VTcGxpbmUpKQogICAgfQogICAgc3RhdGljIF9BZGRQcmVkaWZpbmVkRWFzZShiLCBkLCBjID0gITEpIHsKICAgICAgICBpZiAoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGQpIGEuX0FkZEVhc2UoYiwgZCwgInByZWRlZmluZWQiKTsKICAgICAgICBlbHNlIGlmIChDMyRqc2NvbXAkMjAuSXNBcnJheShkKSkKICAgICAgICAgICAgaWYgKHNlbGYuQnVpbHRJblRyYW5zaXRpb24pIHsKICAgICAgICAgICAgICAgIGNvbnN0IGUgPSBDMyRqc2NvbXAkMjAuTmV3KHNlbGYuQnVpbHRJblRyYW5zaXRpb24sIGIsIGMpOwogICAgICAgICAgICAgICAgZS5TZXRGcm9tSnNvbihkKTsKICAgICAgICAgICAgICAgIGEuX0FkZEVhc2UoYiwgKGcsIGssIG0sIG4pID0+IGUuSW50ZXJwb2xhdGUoZywgaywgbSwgbiksICJwcmVkZWZpbmVkIik7CiAgICAgICAgICAgICAgICBCVUlMVF9JTl9UUkFOU0lUSU9OX01BUC5zZXQoYiwgZSkKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbnN0IGUgPSBDMyRqc2NvbXAkMjAuTmV3KEMzJGpzY29tcCQyMC5UcmFuc2l0aW9uLCBbYiwgZC5tYXAoZyA9PiBbZy54LCBnLnksIGcuc2F4LCBnLnNheSwgZy5lYXgsIGcuZWF5LCBnLnNlLCBnLmVlXSldKTsKICAgICAgICAgICAgICAgIGUuTWFrZUxpbmVhcihjKTsKICAgICAgICAgICAgICAgIGEuX0FkZEVhc2UoYiwgKGcsIGssIG0sIG4pID0+IGUuSW50ZXJwb2xhdGUoZywgaywgbSwgbiksICJwcmVkZWZpbmVkIikKICAgICAgICAgICAgfQogICAgICAgIGVsc2UgdGhyb3cgRXJyb3IoInVuZXhwZWN0ZWQgYXJndW1lbnRzIik7CiAgICB9CiAgICBzdGF0aWMgX0FkZFByaXZhdGVDdXN0b21FYXNlKGIsIGQpIHsKICAgICAgICBhLl9BZGRFYXNlKGIsIGQsICJwcml2YXRlIikKICAgIH0KICAgIHN0YXRpYyBBZGRDdXN0b21FYXNlKGIsIGQsIGMpIHsKICAgICAgICB0aGlzLl9DcmVhdGVFYXNlTWFwKCk7CiAgICAgICAgYS5fQWRkRWFzZShiLCBkLCAiY3VzdG9tIiwgYykKICAgIH0KICAgIHN0YXRpYyBSZW1vdmVDdXN0b21FYXNlKGIsIGQpIHsKICAgICAgICB0aGlzLklzTmFtZVByZWRlZmluZWQoYikgfHwgWy4uLlBSSVZBVEVfRUFTRV9NQVAua2V5cygpXS5pbmNsdWRlcyhiKSB8fCAoZCA9IENVU1RPTV9FQVNFX0VESVRPUl9NQVAuZ2V0KGQpKSAmJiBkLmRlbGV0ZShiKQogICAgfQogICAgc3RhdGljIF9BZGRFYXNlKGIsIGQsIGMsIGUpIHsKICAgICAgICBzd2l0Y2ggKGMpIHsKICAgICAgICAgICAgY2FzZSAicHJlZGVmaW5lZCI6CiAgICAgICAgICAgICAgICBFQVNFX01BUC5zZXQoYiwKICAgICAgICAgICAgICAgICAgICBkKTsKICAgICAgICAgICAgICAgIFBSRURFRklORURfRUFTRV9NQVAuc2V0KGIsIGQpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgImN1c3RvbSI6CiAgICAgICAgICAgICAgICBlID8gKENVU1RPTV9FQVNFX0VESVRPUl9NQVAuaGFzKGUpIHx8IENVU1RPTV9FQVNFX0VESVRPUl9NQVAuc2V0KGUsIG5ldyBNYXApLCBDVVNUT01fRUFTRV9FRElUT1JfTUFQLmdldChlKS5zZXQoYiwgZCkpIDogQ1VTVE9NX0VBU0VfUlVOVElNRV9NQVAuc2V0KGIsIGQpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgInByaXZhdGUiOgogICAgICAgICAgICAgICAgRUFTRV9NQVAuc2V0KGIsIGQpOwogICAgICAgICAgICAgICAgUFJJVkFURV9FQVNFX01BUC5zZXQoYiwgZCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHRocm93IEVycm9yKCJ1bmV4cGVjdGVkIGVhc2UgbW9kZSIpOwogICAgICAgIH0KICAgIH0KICAgIHN0YXRpYyBOb0Vhc2UoYiwgZCwgYywgZSkgewogICAgICAgIHJldHVybiBjICogYiAvIGUgKyBkCiAgICB9CiAgICBzdGF0aWMgRWFzZUluUXVhZChiLCBkLCBjLCBlKSB7CiAgICAgICAgcmV0dXJuIGMgKiAoYiAvPSBlKSAqIGIgKyBkCiAgICB9CiAgICBzdGF0aWMgRWFzZU91dFF1YWQoYiwgZCwgYywgZSkgewogICAgICAgIHJldHVybiAtYyAqIChiIC89IGUpICogKGIgLSAyKSArIGQKICAgIH0KICAgIHN0YXRpYyBFYXNlSW5PdXRRdWFkKGIsIGQsIGMsIGUpIHsKICAgICAgICByZXR1cm4gMSA+IChiIC89IGUgLyAyKSA/IGMgLwogICAgICAgICAgICAyICogYiAqIGIgKyBkIDogLWMgLyAyICogKC0tYiAqIChiIC0gMikgLSAxKSArIGQKICAgIH0KICAgIHN0YXRpYyBFYXNlSW5DdWJpYyhiLCBkLCBjLCBlKSB7CiAgICAgICAgcmV0dXJuIGMgKiAoYiAvPSBlKSAqIGIgKiBiICsgZAogICAgfQogICAgc3RhdGljIEVhc2VPdXRDdWJpYyhiLCBkLCBjLCBlKSB7CiAgICAgICAgcmV0dXJuIGMgKiAoKGIgPSBiIC8gZSAtIDEpICogYiAqIGIgKyAxKSArIGQKICAgIH0KICAgIHN0YXRpYyBFYXNlSW5PdXRDdWJpYyhiLCBkLCBjLCBlKSB7CiAgICAgICAgcmV0dXJuIDEgPiAoYiAvPSBlIC8gMikgPyBjIC8gMiAqIGIgKiBiICogYiArIGQgOiBjIC8gMiAqICgoYiAtPSAyKSAqIGIgKiBiICsgMikgKyBkCiAgICB9CiAgICBzdGF0aWMgRWFzZUluUXVhcnQoYiwgZCwgYywgZSkgewogICAgICAgIHJldHVybiBjICogKGIgLz0gZSkgKiBiICogYiAqIGIgKyBkCiAgICB9CiAgICBzdGF0aWMgRWFzZU91dFF1YXJ0KGIsIGQsIGMsIGUpIHsKICAgICAgICByZXR1cm4gLWMgKiAoKGIgPSBiIC8gZSAtIDEpICogYiAqIGIgKiBiIC0gMSkgKyBkCiAgICB9CiAgICBzdGF0aWMgRWFzZUluT3V0UXVhcnQoYiwgZCwgYywgZSkgewogICAgICAgIHJldHVybiAxID4gKGIgLz0gZSAvIDIpID8gYyAvIDIgKiBiICogYiAqIGIgKiBiICsgZCA6IC1jIC8gMiAqICgoYiAtPSAyKSAqIGIgKiBiICogYiAtIDIpICsgZAogICAgfQogICAgc3RhdGljIEVhc2VJblF1aW50KGIsIGQsIGMsIGUpIHsKICAgICAgICByZXR1cm4gYyAqIChiIC89IGUpICogYiAqIGIgKiBiICogYiArIGQKICAgIH0KICAgIHN0YXRpYyBFYXNlT3V0UXVpbnQoYiwgZCwgYywgZSkgewogICAgICAgIHJldHVybiBjICoKICAgICAgICAgICAgKChiID0gYiAvIGUgLSAxKSAqIGIgKiBiICogYiAqIGIgKyAxKSArIGQKICAgIH0KICAgIHN0YXRpYyBFYXNlSW5PdXRRdWludChiLCBkLCBjLCBlKSB7CiAgICAgICAgcmV0dXJuIDEgPiAoYiAvPSBlIC8gMikgPyBjIC8gMiAqIGIgKiBiICogYiAqIGIgKiBiICsgZCA6IGMgLyAyICogKChiIC09IDIpICogYiAqIGIgKiBiICogYiArIDIpICsgZAogICAgfQogICAgc3RhdGljIEVhc2VJblNpbmUoYiwgZCwgYywgZSkgewogICAgICAgIHJldHVybiAtYyAqIE1hdGguY29zKGIgLyBlICogKE1hdGguUEkgLyAyKSkgKyBjICsgZAogICAgfQogICAgc3RhdGljIEVhc2VPdXRTaW5lKGIsIGQsIGMsIGUpIHsKICAgICAgICByZXR1cm4gYyAqIE1hdGguc2luKGIgLyBlICogKE1hdGguUEkgLyAyKSkgKyBkCiAgICB9CiAgICBzdGF0aWMgRWFzZUluT3V0U2luZShiLCBkLCBjLCBlKSB7CiAgICAgICAgcmV0dXJuIC1jIC8gMiAqIChNYXRoLmNvcyhNYXRoLlBJICogYiAvIGUpIC0gMSkgKyBkCiAgICB9CiAgICBzdGF0aWMgRWFzZUluRXhwbyhiLCBkLCBjLCBlKSB7CiAgICAgICAgcmV0dXJuIDAgPT09IGIgPyBkIDogYyAqIE1hdGgucG93KDIsIDEwICogKGIgLyBlIC0gMSkpICsgZAogICAgfQogICAgc3RhdGljIEVhc2VPdXRFeHBvKGIsIGQsIGMsIGUpIHsKICAgICAgICByZXR1cm4gYiA9PT0gZSA/IGQgKyBjIDogYyAqICgtTWF0aC5wb3coMiwgLTEwICogYiAvIGUpICsgMSkgKyBkCiAgICB9CiAgICBzdGF0aWMgRWFzZUluT3V0RXhwbyhiLCBkLCBjLCBlKSB7CiAgICAgICAgcmV0dXJuIDAgPT09IGIgPyBkIDoKICAgICAgICAgICAgYiA9PT0gZSA/IGQgKyBjIDogMSA+IChiIC89IGUgLyAyKSA/IGMgLyAyICogTWF0aC5wb3coMiwgMTAgKiAoYiAtIDEpKSArIGQgOiBjIC8gMiAqICgtTWF0aC5wb3coMiwgLTEwICogLS1iKSArIDIpICsgZAogICAgfQogICAgc3RhdGljIEVhc2VJbkNpcmMoYiwgZCwgYywgZSkgewogICAgICAgIHJldHVybiAtYyAqIChNYXRoLnNxcnQoMSAtIChiIC89IGUpICogYikgLSAxKSArIGQKICAgIH0KICAgIHN0YXRpYyBFYXNlT3V0Q2lyYyhiLCBkLCBjLCBlKSB7CiAgICAgICAgcmV0dXJuIGMgKiBNYXRoLnNxcnQoMSAtIChiID0gYiAvIGUgLSAxKSAqIGIpICsgZAogICAgfQogICAgc3RhdGljIEVhc2VJbk91dENpcmMoYiwgZCwgYywgZSkgewogICAgICAgIHJldHVybiAxID4gKGIgLz0gZSAvIDIpID8gLWMgLyAyICogKE1hdGguc3FydCgxIC0gYiAqIGIpIC0gMSkgKyBkIDogYyAvIDIgKiAoTWF0aC5zcXJ0KDEgLSAoYiAtPSAyKSAqIGIpICsgMSkgKyBkCiAgICB9CiAgICBzdGF0aWMgRWFzZUluRWxhc3RpYyhiLCBkLCBjLCBlKSB7CiAgICAgICAgbGV0IGcgPSAwLAogICAgICAgICAgICBrID0gYzsKICAgICAgICBpZiAoMCA9PT0gYikgcmV0dXJuIGQ7CiAgICAgICAgaWYgKDEgPT09IChiIC89IGUpKSByZXR1cm4gZCArIGM7CiAgICAgICAgZyB8fCAoZyA9IC4zICogZSk7CiAgICAgICAgayA8IE1hdGguYWJzKGMpID8gKGsgPSBjLCBjID0gZyAvIDQpIDogYyA9IGcgLyAoMiAqIE1hdGguUEkpICogTWF0aC5hc2luKGMgLyBrKTsKICAgICAgICByZXR1cm4gLShrICogTWF0aC5wb3coMiwgMTAgKiAtLWIpICogTWF0aC5zaW4oMiAqCiAgICAgICAgICAgIChiICogZSAtIGMpICogTWF0aC5QSSAvIGcpKSArIGQKICAgIH0KICAgIHN0YXRpYyBFYXNlT3V0RWxhc3RpYyhiLCBkLCBjLCBlKSB7CiAgICAgICAgbGV0IGcsIGsgPSAwLAogICAgICAgICAgICBtID0gYzsKICAgICAgICBpZiAoMCA9PT0gYikgcmV0dXJuIGQ7CiAgICAgICAgaWYgKDEgPT09IChiIC89IGUpKSByZXR1cm4gZCArIGM7CiAgICAgICAgayB8fCAoayA9IC4zICogZSk7CiAgICAgICAgbSA8IE1hdGguYWJzKGMpID8gKG0gPSBjLCBnID0gayAvIDQpIDogZyA9IGsgLyAoMiAqIE1hdGguUEkpICogTWF0aC5hc2luKGMgLyBtKTsKICAgICAgICByZXR1cm4gbSAqIE1hdGgucG93KDIsIC0xMCAqIGIpICogTWF0aC5zaW4oMiAqIChiICogZSAtIGcpICogTWF0aC5QSSAvIGspICsgYyArIGQKICAgIH0KICAgIHN0YXRpYyBFYXNlSW5PdXRFbGFzdGljKGIsIGQsIGMsIGUpIHsKICAgICAgICBsZXQgZywgayA9IDAsCiAgICAgICAgICAgIG0gPSBjOwogICAgICAgIGlmICgwID09PSBiKSByZXR1cm4gZDsKICAgICAgICBpZiAoMiA9PT0gKGIgLz0gZSAvIDIpKSByZXR1cm4gZCArIGM7CiAgICAgICAgayB8fCAoayA9IC4zICogZSAqIDEuNSk7CiAgICAgICAgbSA8IE1hdGguYWJzKGMpID8gKG0gPSBjLCBnID0gayAvIDQpIDogZyA9IGsgLyAoMiAqIE1hdGguUEkpICogTWF0aC5hc2luKGMgLyBtKTsKICAgICAgICByZXR1cm4gMSA+IGIgPyAtLjUgKiBtICogTWF0aC5wb3coMiwgMTAgKiAtLWIpICogTWF0aC5zaW4oMiAqIChiICogZSAtIGcpICogTWF0aC5QSSAvIGspICsgZCA6IG0gKiBNYXRoLnBvdygyLCAtMTAgKiAtLWIpICogTWF0aC5zaW4oMiAqCiAgICAgICAgICAgIChiICogZSAtIGcpICogTWF0aC5QSSAvIGspICogLjUgKyBjICsgZAogICAgfQogICAgc3RhdGljIEVhc2VJbkJhY2soYiwgZCwgYywgZSwgZykgewogICAgICAgIHZvaWQgMCA9PT0gZyAmJiAoZyA9IDEuNzAxNTgpOwogICAgICAgIHJldHVybiBjICogKGIgLz0gZSkgKiBiICogKChnICsgMSkgKiBiIC0gZykgKyBkCiAgICB9CiAgICBzdGF0aWMgRWFzZU91dEJhY2soYiwgZCwgYywgZSwgZykgewogICAgICAgIHZvaWQgMCA9PT0gZyAmJiAoZyA9IDEuNzAxNTgpOwogICAgICAgIHJldHVybiBjICogKChiID0gYiAvIGUgLSAxKSAqIGIgKiAoKGcgKyAxKSAqIGIgKyBnKSArIDEpICsgZAogICAgfQogICAgc3RhdGljIEVhc2VJbk91dEJhY2soYiwgZCwgYywgZSwgZykgewogICAgICAgIHZvaWQgMCA9PT0gZyAmJiAoZyA9IDEuNzAxNTgpOwogICAgICAgIHJldHVybiAxID4gKGIgLz0gZSAvIDIpID8gYyAvIDIgKiBiICogYiAqICgoKGcgKj0gMS41MjUpICsgMSkgKiBiIC0gZykgKyBkIDogYyAvIDIgKiAoKGIgLT0gMikgKiBiICogKCgoZyAqPSAxLjUyNSkgKyAxKSAqIGIgKyBnKSArIDIpICsgZAogICAgfQogICAgc3RhdGljIEVhc2VJbkJvdW5jZShiLCBkLCBjLCBlKSB7CiAgICAgICAgcmV0dXJuIGMgLSBhLkVhc2VPdXRCb3VuY2UoZSAtIGIsIDAsIGMsIGUpICsgZAogICAgfQogICAgc3RhdGljIEVhc2VPdXRCb3VuY2UoYiwgZCwgYywgZSkgewogICAgICAgIHJldHVybiAoYiAvPSBlKSA8IDEgLyAyLjc1ID8gNy41NjI1ICogYyAqIGIgKiBiICsgZCA6IGIgPCAyIC8gMi43NSA/IGMgKiAoNy41NjI1ICogKGIgLT0KICAgICAgICAgICAgMS41IC8gMi43NSkgKiBiICsgLjc1KSArIGQgOiBiIDwgMi41IC8gMi43NSA/IGMgKiAoNy41NjI1ICogKGIgLT0gMi4yNSAvIDIuNzUpICogYiArIC45Mzc1KSArIGQgOiBjICogKDcuNTYyNSAqIChiIC09IDIuNjI1IC8gMi43NSkgKiBiICsgLjk4NDM3NSkgKyBkCiAgICB9CiAgICBzdGF0aWMgRWFzZUluT3V0Qm91bmNlKGIsIGQsIGMsIGUpIHsKICAgICAgICByZXR1cm4gYiA8IGUgLyAyID8gLjUgKiBhLkVhc2VJbkJvdW5jZSgyICogYiwgMCwgYywgZSkgKyBkIDogLjUgKiBhLkVhc2VPdXRCb3VuY2UoMiAqIGIgLSBlLCAwLCBjLCBlKSArIC41ICogYyArIGQKICAgIH0KICAgIHN0YXRpYyBFYXNlQ3ViaWNCZXppZXIoYiwgZCwgYywgZSwgZykgewogICAgICAgIHJldHVybiBkICsgMyAqIGIgKiAoYyAtIGQpICsgMyAqIGIgKiogMiAqIChkICsgZSAtIDIgKiBjKSArIGIgKiogMyAqIChnIC0gZCArIDMgKiBjIC0gMyAqIGUpCiAgICB9CiAgICBzdGF0aWMgRWFzZVNwbGluZShiLCBkLCBjLCBlLCBnLCBrLCBtLCBuLCBxLCB1KSB7CiAgICAgICAgaWYgKGUgPT09IGcgJiYgayA9PT0gbSkgcmV0dXJuIGI7CiAgICAgICAgYiA9IGdldF90X2Zvcl94KGIsIGQsIGUsIGssIG4sIHUpOwogICAgICAgIGQgPSBhJGpzY29tcCQyODEoYywgZywgbSwgcSk7CiAgICAgICAgZSA9IGIkanNjb21wJDE1MChjLCBnLCBtLCBxKTsKICAgICAgICBjID0gYyRqc2NvbXAkNDIoYywgZywgbSwgcSk7CiAgICAgICAgcmV0dXJuIGNhbGNfYmV6aWVyKGIsIGQsIGUsIGMpCiAgICB9CiAgICBzdGF0aWMgR2V0QmV6aWVyU2FtcGxlcyhiLAogICAgICAgIGQsIGMsIGUpIHsKICAgICAgICBjb25zdCBnID0gW10sCiAgICAgICAgICAgIGsgPSBhJGpzY29tcCQyODEoYiwgZCwgYywgZSksCiAgICAgICAgICAgIG0gPSBiJGpzY29tcCQxNTAoYiwgZCwgYywgZSk7CiAgICAgICAgYiA9IGMkanNjb21wJDQyKGIsIGQsIGMsIGUpOwogICAgICAgIGZvciAoZCA9IDA7IDExID4gZDsgKytkKSBjID0gY2FsY19iZXppZXIoZCAqIFNBTVBMRV9TVEVQLCBrLCBtLCBiKSwgZy5wdXNoKGMpOwogICAgICAgIHJldHVybiBnCiAgICB9Cn07CmNvbnN0IFNBTVBMRV9TVEVQID0gLjEsCiAgICBhJGpzY29tcCQyODEgPSAoYSwgYiwgZCwgYykgPT4gYyAtIDMgKiBkICsgMyAqIGIgLSBhLAogICAgYiRqc2NvbXAkMTUwID0gKGEsIGIsIGQsIGMpID0+IDMgKiBkIC0gNiAqIGIgKyAzICogYSwKICAgIGMkanNjb21wJDQyID0gKGEsIGIsIGQsIGMpID0+IDMgKiAoYiAtIGEpLAogICAgY2FsY19iZXppZXIgPSAoYSwgYiwgZCwgYykgPT4gKChiICogYSArIGQpICogYSArIGMpICogYSwKICAgIGdldF9zbG9wZSA9IChhLCBiLCBkLCBjKSA9PiAzICogYiAqIGEgKiBhICsgMiAqIGQgKiBhICsgYywKICAgIGdldF90X2Zvcl94ID0gKGEsIGIsIGQsIGMsIGUsIGcpID0+IHsKICAgICAgICBpZiAoMSA9PSBhKSByZXR1cm4gMTsKICAgICAgICBmb3IgKHZhciBrID0gMCwgbSA9IDEsIG4gPSBnW21dOyAxMCAhPSBtICYmIG4gPD0gYTspIG0rKywgbiA9IGdbbV0sIGsgKz0gU0FNUExFX1NURVA7CiAgICAgICAgbS0tOwogICAgICAgIG4gPSBnW21dOwogICAgICAgIGcgPSBrICsgKGEgLSBuKSAvIChnW20gKyAxXSAtIG4pICogU0FNUExFX1NURVA7CiAgICAgICAgbSA9IGEkanNjb21wJDI4MShiLCBkLCBjLCBlKTsKICAgICAgICBuID0gYiRqc2NvbXAkMTUwKGIsIGQsIGMsIGUpOwogICAgICAgIGIgPSBjJGpzY29tcCQ0MihiLCBkLCBjLCBlKTsKICAgICAgICBkID0gZ2V0X3Nsb3BlKGcsIG0sIG4sIGIpOwogICAgICAgIGlmICgwICE9PSBkKQogICAgICAgICAgICBpZiAoLjAxIDw9IGQpCiAgICAgICAgICAgICAgICBmb3IgKGsgPSAwOyA0ID4gazsgKytrKSBkID0gY2FsY19iZXppZXIoZywgbSwgbiwgYikgLQogICAgICAgICAgICAgICAgICAgIGEsIGMgPSBnZXRfc2xvcGUoZywgbSwgbiwgYiksIGcgLT0gZCAvIGM7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgZCA9IGs7CiAgICAgICAgICAgICAgICBrICs9IFNBTVBMRV9TVEVQOwogICAgICAgICAgICAgICAgYyA9IDA7CiAgICAgICAgICAgICAgICBsZXQgcTsKICAgICAgICAgICAgICAgIGRvIGcgPSBkICsgKGsgLSBkKSAvIDIsIGUgPSBjYWxjX2JlemllcihnLCBtLCBuLCBiKSAtIGEsIDAgPCBlID8gayA9IGcgOiBkID0gZywgZSA9IDFFLTcgPCBNYXRoLmFicyhlKSwgcSA9IDEwID4gKytjOyB3aGlsZSAoZSAmJiBxKQogICAgICAgICAgICB9CiAgICAgICAgcmV0dXJuIGcKICAgIH07CiJ1c2Ugc3RyaWN0IjsKY29uc3QgQzMkanNjb21wJDIxID0gc2VsZi5DMzsKCmZ1bmN0aW9uIFJlcXVpcmVTdHJpbmdPck51bWJlcihhKSB7CiAgICBDMyRqc2NvbXAkMjEuSXNTdHJpbmcoYSkKfQpDMyRqc2NvbXAkMjEuUHJvYmFiaWxpdHlUYWJsZSA9IGNsYXNzIHsKICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgIHRoaXMuX2l0ZW1zID0gW107CiAgICAgICAgdGhpcy5fdG90YWxXZWlnaHQgPSAwCiAgICB9CiAgICBSZWxlYXNlKCkgewogICAgICAgIHRoaXMuQ2xlYXIoKTsKICAgICAgICB0aGlzLl9pdGVtcyA9IG51bGwKICAgIH0KICAgIENsZWFyKCkgewogICAgICAgIEMzJGpzY29tcCQyMS5jbGVhcjJEQXJyYXkodGhpcy5faXRlbXMpOwogICAgICAgIHRoaXMuX3RvdGFsV2VpZ2h0ID0gMAogICAgfQogICAgR2V0VG90YWxXZWlnaHQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3RvdGFsV2VpZ2h0CiAgICB9CiAgICBTYW1wbGUoYSA9IE1hdGgucmFuZG9tKCkgKiB0aGlzLkdldFRvdGFsV2VpZ2h0KCkpIHsKICAgICAgICBsZXQgYiA9IDA7CiAgICAgICAgZm9yIChjb25zdCBbZCwgY10gb2YgdGhpcy5faXRlbXMpCiAgICAgICAgICAgIGlmIChiICs9IGQsIGEgPCBiKSByZXR1cm4gYzsKICAgICAgICByZXR1cm4gMAogICAgfQogICAgQWRkSXRlbShhLCBiKSB7CiAgICAgICAgUmVxdWlyZVN0cmluZ09yTnVtYmVyKGIpOwogICAgICAgIHRoaXMuX3RvdGFsV2VpZ2h0ICs9IGE7CiAgICAgICAgdGhpcy5faXRlbXMucHVzaChbYSwgYl0pCiAgICB9CiAgICBSZW1vdmVJdGVtKGEsIGIpIHsKICAgICAgICBSZXF1aXJlU3RyaW5nT3JOdW1iZXIoYik7CiAgICAgICAgY29uc3QgZCA9IDAgPT09IGE7CiAgICAgICAgZm9yIChsZXQgYyA9IDA7IGMgPCB0aGlzLl9pdGVtcy5sZW5ndGg7IGMrKykgewogICAgICAgICAgICBjb25zdCBlID0KICAgICAgICAgICAgICAgIHRoaXMuX2l0ZW1zW2NdLAogICAgICAgICAgICAgICAgZyA9IGVbMV0gPT09IGI7CiAgICAgICAgICAgIGlmICgoZCB8fCBlWzBdID09PSBhKSAmJiBnKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9pdGVtcy5zcGxpY2UoYywgMSk7CiAgICAgICAgICAgICAgICB0aGlzLl90b3RhbFdlaWdodCAtPSBlWzBdOwogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIGFzSlNPTigpIHsKICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkodGhpcy5faXRlbXMpCiAgICB9CiAgICBzdGF0aWMgZnJvbUpTT04oYSkgewogICAgICAgIGNvbnN0IGIgPSBuZXcgQzMkanNjb21wJDIxLlByb2JhYmlsaXR5VGFibGU7CiAgICAgICAgYSA9IEpTT04ucGFyc2UoYSk7CiAgICAgICAgZm9yIChjb25zdCBkIG9mIGEpIGIuQWRkSXRlbShkWzBdLCBkWzFdKTsKICAgICAgICByZXR1cm4gYgogICAgfQp9OwoidXNlIHN0cmljdCI7CnNlbGYuQzMuRXZlbnQgPSBjbGFzcyB7CiAgICBjb25zdHJ1Y3RvcihhLCBiKSB7CiAgICAgICAgdGhpcy50eXBlID0gYTsKICAgICAgICB0aGlzLmNhbmNlbGFibGUgPSAhIWI7CiAgICAgICAgdGhpcy5pc0FzeW5jID0gdGhpcy5wcm9wYWdhdGlvblN0b3BwZWQgPSB0aGlzLmRlZmF1bHRQcmV2ZW50ZWQgPSAhMQogICAgfQogICAgcHJldmVudERlZmF1bHQoKSB7CiAgICAgICAgaWYgKCF0aGlzLmNhbmNlbGFibGUpIHRocm93IEVycm9yKGBldmVudCAnJHt0aGlzLnR5cGV9JyBpcyBub3QgY2FuY2VsYWJsZWApOwogICAgICAgIHRoaXMuZGVmYXVsdFByZXZlbnRlZCA9ICEwCiAgICB9CiAgICBzdG9wUHJvcGFnYXRpb24oKSB7CiAgICAgICAgaWYgKCF0aGlzLmNhbmNlbGFibGUpIHRocm93IEVycm9yKGBldmVudCAnJHt0aGlzLnR5cGV9JyBjYW5ub3QgYmUgc3RvcHBlZGApOwogICAgICAgIGlmICh0aGlzLmlzQXN5bmMpIHRocm93IEVycm9yKGBjYW5ub3Qgc3RvcCBhc3luYyBldmVudCAnJHt0aGlzLnR5cGV9JyBwcm9wYWdhdGlvbmApOwogICAgICAgIHRoaXMucHJvcGFnYXRpb25TdG9wcGVkID0gITAKICAgIH0KfTsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkMjMgPSBzZWxmLkMzOwpDMyRqc2NvbXAkMjMuRXZlbnQuSGFuZGxlciA9IGNsYXNzIGV4dGVuZHMgQzMkanNjb21wJDIzLkRlZmVuZGVkQmFzZSB7CiAgICBjb25zdHJ1Y3RvcihhKSB7CiAgICAgICAgc3VwZXIoKTsKICAgICAgICB0aGlzLl90eXBlID0gYTsKICAgICAgICB0aGlzLl9jYXB0dXJlTGlzdGVuZXJzID0gW107CiAgICAgICAgdGhpcy5fY2FwdHVyZUxpc3RlbmVyc1NldCA9IG5ldyBTZXQ7CiAgICAgICAgdGhpcy5fbGlzdGVuZXJzID0gW107CiAgICAgICAgdGhpcy5fbGlzdGVuZXJzU2V0ID0gbmV3IFNldDsKICAgICAgICB0aGlzLl9maXJlRGVwdGggPSAwOwogICAgICAgIHRoaXMuX3F1ZXVlTW9kaWZ5TGlzdGVuZXJzID0gW10KICAgIH0KICAgIFJlbGVhc2UoKSB7CiAgICAgICAgMCA8IHRoaXMuX2ZpcmVEZXB0aCB8fCAoQzMkanNjb21wJDIzLmNsZWFyQXJyYXkodGhpcy5fY2FwdHVyZUxpc3RlbmVycyksIHRoaXMuX2NhcHR1cmVMaXN0ZW5lcnNTZXQuY2xlYXIoKSwgQzMkanNjb21wJDIzLmNsZWFyQXJyYXkodGhpcy5fbGlzdGVuZXJzKSwgdGhpcy5fbGlzdGVuZXJzU2V0LmNsZWFyKCksIEMzJGpzY29tcCQyMy5jbGVhckFycmF5KHRoaXMuX3F1ZXVlTW9kaWZ5TGlzdGVuZXJzKSwgQzMkanNjb21wJDIzLlJlbGVhc2UodGhpcykpCiAgICB9CiAgICBfQWRkTGlzdGVuZXIoYSwKICAgICAgICBiKSB7CiAgICAgICAgdGhpcy5fSXNGaXJpbmcoKSA/IHRoaXMuX3F1ZXVlTW9kaWZ5TGlzdGVuZXJzLnB1c2goewogICAgICAgICAgICBvcDogImFkZCIsCiAgICAgICAgICAgIGZ1bmM6IGEsCiAgICAgICAgICAgIGNhcHR1cmU6IGIKICAgICAgICB9KSA6IGIgPyB0aGlzLl9jYXB0dXJlTGlzdGVuZXJzU2V0LmhhcyhhKSB8fCAodGhpcy5fY2FwdHVyZUxpc3RlbmVycy5wdXNoKGEpLCB0aGlzLl9jYXB0dXJlTGlzdGVuZXJzU2V0LmFkZChhKSkgOiB0aGlzLl9saXN0ZW5lcnNTZXQuaGFzKGEpIHx8ICh0aGlzLl9saXN0ZW5lcnMucHVzaChhKSwgdGhpcy5fbGlzdGVuZXJzU2V0LmFkZChhKSkKICAgIH0KICAgIF9SZW1vdmVMaXN0ZW5lcihhLCBiKSB7CiAgICAgICAgdGhpcy5fSXNGaXJpbmcoKSA/IHRoaXMuX3F1ZXVlTW9kaWZ5TGlzdGVuZXJzLnB1c2goewogICAgICAgICAgICAgICAgb3A6ICJyZW1vdmUiLAogICAgICAgICAgICAgICAgZnVuYzogYSwKICAgICAgICAgICAgICAgIGNhcHR1cmU6IGIKICAgICAgICAgICAgfSkgOiBiID8gdGhpcy5fY2FwdHVyZUxpc3RlbmVyc1NldC5oYXMoYSkgJiYgKHRoaXMuX2NhcHR1cmVMaXN0ZW5lcnNTZXQuZGVsZXRlKGEpLCBDMyRqc2NvbXAkMjMuYXJyYXlGaW5kUmVtb3ZlKHRoaXMuX2NhcHR1cmVMaXN0ZW5lcnMsIGEpKSA6IHRoaXMuX2xpc3RlbmVyc1NldC5oYXMoYSkgJiYKICAgICAgICAgICAgKHRoaXMuX2xpc3RlbmVyc1NldC5kZWxldGUoYSksIEMzJGpzY29tcCQyMy5hcnJheUZpbmRSZW1vdmUodGhpcy5fbGlzdGVuZXJzLCBhKSkKICAgIH0KICAgIF9Jc0VtcHR5KCkgewogICAgICAgIHJldHVybiAhdGhpcy5fY2FwdHVyZUxpc3RlbmVycy5sZW5ndGggJiYgIXRoaXMuX2xpc3RlbmVycy5sZW5ndGgKICAgIH0KICAgIF9Jc0ZpcmluZygpIHsKICAgICAgICByZXR1cm4gMCA8IHRoaXMuX2ZpcmVEZXB0aAogICAgfQogICAgX1Byb2Nlc3NRdWV1ZWRMaXN0ZW5lcnMoKSB7CiAgICAgICAgY29uc3QgYSA9IG5ldyBTZXQsCiAgICAgICAgICAgIGIgPSBuZXcgU2V0OwogICAgICAgIGZvciAoY29uc3QgZCBvZiB0aGlzLl9xdWV1ZU1vZGlmeUxpc3RlbmVycykKICAgICAgICAgICAgaWYgKCJhZGQiID09PSBkLm9wKSB0aGlzLl9BZGRMaXN0ZW5lcihkLmZ1bmMsIGQuY2FwdHVyZSksIGQuY2FwdHVyZSA/IGIuZGVsZXRlKGQuZnVuYykgOiBhLmRlbGV0ZShkLmZ1bmMpOwogICAgICAgICAgICBlbHNlIGlmICgicmVtb3ZlIiA9PT0gZC5vcCkgZC5jYXB0dXJlID8gKHRoaXMuX2NhcHR1cmVMaXN0ZW5lcnNTZXQuZGVsZXRlKGQuZnVuYyksIGIuYWRkKGQuZnVuYykpIDogKHRoaXMuX2xpc3RlbmVyc1NldC5kZWxldGUoZC5mdW5jKSwKICAgICAgICAgICAgYS5hZGQoZC5mdW5jKSk7CiAgICAgICAgZWxzZSB0aHJvdyBFcnJvcigiaW52YWxpZCBvcCIpOwogICAgICAgIEMzJGpzY29tcCQyMy5hcnJheVJlbW92ZUFsbEluU2V0KHRoaXMuX2xpc3RlbmVycywgYSk7CiAgICAgICAgQzMkanNjb21wJDIzLmFycmF5UmVtb3ZlQWxsSW5TZXQodGhpcy5fY2FwdHVyZUxpc3RlbmVycywgYik7CiAgICAgICAgQzMkanNjb21wJDIzLmNsZWFyQXJyYXkodGhpcy5fcXVldWVNb2RpZnlMaXN0ZW5lcnMpCiAgICB9CiAgICBfRmlyZUNhbmNlbGxhYmxlKGEpIHsKICAgICAgICB0aGlzLl9JbmNyZWFzZUZpcmVEZXB0aCgpOwogICAgICAgIGxldCBiID0gITE7CiAgICAgICAgZm9yIChsZXQgZCA9IDAsIGMgPSB0aGlzLl9jYXB0dXJlTGlzdGVuZXJzLmxlbmd0aDsgZCA8IGM7ICsrZCkKICAgICAgICAgICAgaWYgKHRoaXMuX2NhcHR1cmVMaXN0ZW5lcnNbZF0oYSksIGEucHJvcGFnYXRpb25TdG9wcGVkKSB7CiAgICAgICAgICAgICAgICBiID0gITA7CiAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICB9CiAgICAgICAgaWYgKCFiKQogICAgICAgICAgICBmb3IgKGxldCBkID0gMCwgYyA9IHRoaXMuX2xpc3RlbmVycy5sZW5ndGg7IGQgPCBjICYmICh0aGlzLl9saXN0ZW5lcnNbZF0oYSksICFhLnByb3BhZ2F0aW9uU3RvcHBlZCk7ICsrZCk7CiAgICAgICAgdGhpcy5fRGVjcmVhc2VGaXJlRGVwdGgoKTsKICAgICAgICByZXR1cm4gIWEuZGVmYXVsdFByZXZlbnRlZAogICAgfQogICAgX0ZpcmVOb25DYW5jZWxsYWJsZShhKSB7CiAgICAgICAgdGhpcy5fSW5jcmVhc2VGaXJlRGVwdGgoKTsKICAgICAgICBmb3IgKGxldCBiID0gMCwgZCA9IHRoaXMuX2NhcHR1cmVMaXN0ZW5lcnMubGVuZ3RoOyBiIDwgZDsgKytiKSB0aGlzLl9jYXB0dXJlTGlzdGVuZXJzW2JdKGEpOwogICAgICAgIGZvciAobGV0IGIgPSAwLCBkID0gdGhpcy5fbGlzdGVuZXJzLmxlbmd0aDsgYiA8IGQ7ICsrYikgdGhpcy5fbGlzdGVuZXJzW2JdKGEpOwogICAgICAgIHRoaXMuX0RlY3JlYXNlRmlyZURlcHRoKCk7CiAgICAgICAgcmV0dXJuICEwCiAgICB9CiAgICBfSW5jcmVhc2VGaXJlRGVwdGgoKSB7CiAgICAgICAgdGhpcy5fZmlyZURlcHRoKysKICAgIH0KICAgIF9EZWNyZWFzZUZpcmVEZXB0aCgpIHsKICAgICAgICB0aGlzLl9maXJlRGVwdGgtLTsKICAgICAgICAwID09PSB0aGlzLl9maXJlRGVwdGggJiYgMCA8IHRoaXMuX3F1ZXVlTW9kaWZ5TGlzdGVuZXJzLmxlbmd0aCAmJiB0aGlzLl9Qcm9jZXNzUXVldWVkTGlzdGVuZXJzKCkKICAgIH0KICAgIFNldERlbGF5UmVtb3ZlRXZlbnRzRW5hYmxlZChhKSB7CiAgICAgICAgYSA/IHRoaXMuX0luY3JlYXNlRmlyZURlcHRoKCkgOiB0aGlzLl9EZWNyZWFzZUZpcmVEZXB0aCgpCiAgICB9CiAgICBfRmlyZUFzeW5jKGEpIHsKICAgICAgICBsZXQgYiA9IFtdOwogICAgICAgIGZvciAobGV0IGQgPSAwLCBjID0gdGhpcy5fY2FwdHVyZUxpc3RlbmVycy5sZW5ndGg7IGQgPCBjOyArK2QpIHsKICAgICAgICAgICAgbGV0IGUgPSB0aGlzLl9jYXB0dXJlTGlzdGVuZXJzW2RdOwogICAgICAgICAgICBiLnB1c2goQzMkanNjb21wJDIzLkFzeW5jaWZ5KCgpID0+IGUoYSkpKQogICAgICAgIH0KICAgICAgICBmb3IgKGxldCBkID0gMCwgYyA9IHRoaXMuX2xpc3RlbmVycy5sZW5ndGg7IGQgPCBjOyArK2QpIHsKICAgICAgICAgICAgbGV0IGUgPSB0aGlzLl9saXN0ZW5lcnNbZF07CiAgICAgICAgICAgIGIucHVzaChDMyRqc2NvbXAkMjMuQXN5bmNpZnkoKCkgPT4gZShhKSkpCiAgICAgICAgfQogICAgICAgIHJldHVybiBQcm9taXNlLmFsbChiKS50aGVuKCgpID0+ICFhLmRlZmF1bHRQcmV2ZW50ZWQpCiAgICB9CiAgICBfRmlyZUFuZFdhaXRfQXN5bmNPcHRpb25hbChhKSB7CiAgICAgICAgY29uc3QgYiA9IFtdOwogICAgICAgIHRoaXMuX0luY3JlYXNlRmlyZURlcHRoKCk7CiAgICAgICAgZm9yIChsZXQgYyA9IDAsIGUgPSB0aGlzLl9jYXB0dXJlTGlzdGVuZXJzLmxlbmd0aDsgYyA8IGU7ICsrYykgewogICAgICAgICAgICB2YXIgZCA9IHRoaXMuX2NhcHR1cmVMaXN0ZW5lcnNbY10oYSk7CiAgICAgICAgICAgIGQgaW5zdGFuY2VvZiBQcm9taXNlICYmIGIucHVzaChkKQogICAgICAgIH0KICAgICAgICBmb3IgKGxldCBjID0gMCwgZSA9IHRoaXMuX2xpc3RlbmVycy5sZW5ndGg7IGMgPAogICAgICAgICAgICBlOyArK2MpIGQgPSB0aGlzLl9saXN0ZW5lcnNbY10oYSksIGQgaW5zdGFuY2VvZiBQcm9taXNlICYmIGIucHVzaChkKTsKICAgICAgICB0aGlzLl9EZWNyZWFzZUZpcmVEZXB0aCgpOwogICAgICAgIHJldHVybiBiLmxlbmd0aCA/IFByb21pc2UuYWxsKGIpLnRoZW4oKCkgPT4gIWEuZGVmYXVsdFByZXZlbnRlZCkgOiAhYS5kZWZhdWx0UHJldmVudGVkCiAgICB9CiAgICBhc3luYyBfRmlyZUFuZFdhaXRBc3luYyhhKSB7CiAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuX0ZpcmVBbmRXYWl0X0FzeW5jT3B0aW9uYWwoYSkKICAgIH0KICAgIGFzeW5jIF9GaXJlQW5kV2FpdEFzeW5jU2VxdWVudGlhbChhKSB7CiAgICAgICAgdGhpcy5fSW5jcmVhc2VGaXJlRGVwdGgoKTsKICAgICAgICBmb3IgKGxldCBkID0gMCwgYyA9IHRoaXMuX2NhcHR1cmVMaXN0ZW5lcnMubGVuZ3RoOyBkIDwgYzsgKytkKSB7CiAgICAgICAgICAgIHZhciBiID0gdGhpcy5fY2FwdHVyZUxpc3RlbmVyc1tkXShhKTsKICAgICAgICAgICAgYiBpbnN0YW5jZW9mIFByb21pc2UgJiYgYXdhaXQgYgogICAgICAgIH0KICAgICAgICBmb3IgKGxldCBkID0gMCwgYyA9IHRoaXMuX2xpc3RlbmVycy5sZW5ndGg7IGQgPCBjOyArK2QpIGIgPSB0aGlzLl9saXN0ZW5lcnNbZF0oYSksIGIgaW5zdGFuY2VvZgogICAgICAgIFByb21pc2UgJiYgYXdhaXQgYjsKICAgICAgICB0aGlzLl9EZWNyZWFzZUZpcmVEZXB0aCgpOwogICAgICAgIHJldHVybiAhYS5kZWZhdWx0UHJldmVudGVkCiAgICB9KiBfRmlyZUFzR2VuZXJhdG9yKGEpIHsKICAgICAgICB0aGlzLl9JbmNyZWFzZUZpcmVEZXB0aCgpOwogICAgICAgIGZvciAobGV0IGQgPSAwLCBjID0gdGhpcy5fY2FwdHVyZUxpc3RlbmVycy5sZW5ndGg7IGQgPCBjOyArK2QpIHsKICAgICAgICAgICAgdmFyIGIgPSB0aGlzLl9jYXB0dXJlTGlzdGVuZXJzW2RdKGEpOwogICAgICAgICAgICBDMyRqc2NvbXAkMjMuSXNJdGVyYXRvcihiKSAmJiAoeWllbGQqIGIpCiAgICAgICAgfQogICAgICAgIGZvciAobGV0IGQgPSAwLCBjID0gdGhpcy5fbGlzdGVuZXJzLmxlbmd0aDsgZCA8IGM7ICsrZCkgYiA9IHRoaXMuX2xpc3RlbmVyc1tkXShhKSwgQzMkanNjb21wJDIzLklzSXRlcmF0b3IoYikgJiYgKHlpZWxkKiBiKTsKICAgICAgICB0aGlzLl9EZWNyZWFzZUZpcmVEZXB0aCgpCiAgICB9Cn07CiJ1c2Ugc3RyaWN0IjsKY29uc3QgQzMkanNjb21wJDI0ID0gc2VsZi5DMzsKQzMkanNjb21wJDI0LkV2ZW50LkRpc3BhdGNoZXIgPSBjbGFzcyBleHRlbmRzIEMzJGpzY29tcCQyNC5EZWZlbmRlZEJhc2UgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgICAgc3VwZXIoKTsKICAgICAgICB0aGlzLl9ldmVudEhhbmRsZXJzID0gbmV3IE1hcDsKICAgICAgICB0aGlzLl9kaXNwYXRjaGVyV2FzUmVsZWFzZWQgPSAhMQogICAgfQogICAgUmVsZWFzZSgpIHsKICAgICAgICBpZiAodGhpcy5fZGlzcGF0Y2hlcldhc1JlbGVhc2VkKSB0aHJvdyBFcnJvcigiYWxyZWFkeSByZWxlYXNlZCIpOwogICAgICAgIHRoaXMuQ2xlYXJFdmVudHMoKTsKICAgICAgICB0aGlzLl9kaXNwYXRjaGVyV2FzUmVsZWFzZWQgPSAhMDsKICAgICAgICBDMyRqc2NvbXAkMjQuUmVsZWFzZSh0aGlzKQogICAgfQogICAgV2FzUmVsZWFzZWQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2Rpc3BhdGNoZXJXYXNSZWxlYXNlZAogICAgfQogICAgQ2xlYXJFdmVudHMoKSB7CiAgICAgICAgZm9yIChsZXQgYSBvZiB0aGlzLl9ldmVudEhhbmRsZXJzLnZhbHVlcygpKSBhLlJlbGVhc2UoKTsKICAgICAgICB0aGlzLl9ldmVudEhhbmRsZXJzLmNsZWFyKCkKICAgIH0KICAgIF9HZXRIYW5kbGVyQnlUeXBlKGEsIGIpIHsKICAgICAgICBsZXQgZCA9IHRoaXMuX2V2ZW50SGFuZGxlcnMuZ2V0KGEpOwogICAgICAgIHJldHVybiBkID8gZCA6IGIgPyAoZCA9IEMzJGpzY29tcCQyNC5OZXcoQzMkanNjb21wJDI0LkV2ZW50LkhhbmRsZXIsIGEpLCB0aGlzLl9ldmVudEhhbmRsZXJzLnNldChhLCBkKSwgZCkgOiBudWxsCiAgICB9CiAgICBIYXNBbnlIYW5kbGVyRm9yKGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZXZlbnRIYW5kbGVycy5oYXMoYSkKICAgIH0KICAgIGFkZEV2ZW50TGlzdGVuZXIoYSwgYiwgZCkgewogICAgICAgIHRoaXMuX0dldEhhbmRsZXJCeVR5cGUoYSwgITApLl9BZGRMaXN0ZW5lcihiLCAhIWQpCiAgICB9CiAgICByZW1vdmVFdmVudExpc3RlbmVyKGEsIGIsIGQpIHsKICAgICAgICBsZXQgYyA9IHRoaXMuX0dldEhhbmRsZXJCeVR5cGUoYSwgITEpOwogICAgICAgIGMgJiYgKGMuX1JlbW92ZUxpc3RlbmVyKGIsICEhZCksIGMuX0lzRW1wdHkoKSAmJiB0aGlzLl9ldmVudEhhbmRsZXJzLmRlbGV0ZShhKSkKICAgIH0KICAgIGRpc3BhdGNoRXZlbnQoYSkgewogICAgICAgIGNvbnN0IGIgPSB0aGlzLl9HZXRIYW5kbGVyQnlUeXBlKGEudHlwZSwgITEpOwogICAgICAgIHJldHVybiBiID8gYS5jYW5jZWxhYmxlID8gYi5fRmlyZUNhbmNlbGxhYmxlKGEpIDogYi5fRmlyZU5vbkNhbmNlbGxhYmxlKGEpIDogITAKICAgIH0KICAgIGRpc3BhdGNoRXZlbnRBc3luYyhhKSB7CiAgICAgICAgY29uc3QgYiA9CiAgICAgICAgICAgIHRoaXMuX0dldEhhbmRsZXJCeVR5cGUoYS50eXBlLCAhMSk7CiAgICAgICAgaWYgKCFiKSByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCEwKTsKICAgICAgICBhLmlzQXN5bmMgPSAhMDsKICAgICAgICByZXR1cm4gYi5fRmlyZUFzeW5jKGEpCiAgICB9CiAgICBhc3luYyBkaXNwYXRjaEV2ZW50QW5kQ2xlYXJBc3luYyhhKSB7CiAgICAgICAgY29uc3QgYiA9IHRoaXMuX0dldEhhbmRsZXJCeVR5cGUoYS50eXBlLCAhMSk7CiAgICAgICAgaWYgKCFiKSByZXR1cm4gITA7CiAgICAgICAgdGhpcy5fZXZlbnRIYW5kbGVycy5kZWxldGUoYS50eXBlKTsKICAgICAgICBhLmlzQXN5bmMgPSAhMDsKICAgICAgICBhID0gYXdhaXQgYi5fRmlyZUFzeW5jKGEpOwogICAgICAgIGIuUmVsZWFzZSgpOwogICAgICAgIHJldHVybiBhCiAgICB9CiAgICBhc3luYyBkaXNwYXRjaEV2ZW50QW5kV2FpdEFzeW5jKGEpIHsKICAgICAgICBjb25zdCBiID0gdGhpcy5fR2V0SGFuZGxlckJ5VHlwZShhLnR5cGUsICExKTsKICAgICAgICByZXR1cm4gYiA/IGF3YWl0IGIuX0ZpcmVBbmRXYWl0QXN5bmMoYSkgOiAhMAogICAgfQogICAgZGlzcGF0Y2hFdmVudEFuZFdhaXRfQXN5bmNPcHRpb25hbChhKSB7CiAgICAgICAgY29uc3QgYiA9IHRoaXMuX0dldEhhbmRsZXJCeVR5cGUoYS50eXBlLCAhMSk7CiAgICAgICAgcmV0dXJuIGIgPyBiLl9GaXJlQW5kV2FpdF9Bc3luY09wdGlvbmFsKGEpIDoKICAgICAgICAgICAgITAKICAgIH0KICAgIGFzeW5jIGRpc3BhdGNoRXZlbnRBbmRXYWl0QXN5bmNTZXF1ZW50aWFsKGEpIHsKICAgICAgICBjb25zdCBiID0gdGhpcy5fR2V0SGFuZGxlckJ5VHlwZShhLnR5cGUsICExKTsKICAgICAgICByZXR1cm4gYiA/IGF3YWl0IGIuX0ZpcmVBbmRXYWl0QXN5bmNTZXF1ZW50aWFsKGEpIDogITAKICAgIH0KICAgIGRpc3BhdGNoR2VuZXJhdG9yRXZlbnQoYSkgewogICAgICAgIGNvbnN0IGIgPSB0aGlzLl9HZXRIYW5kbGVyQnlUeXBlKGEudHlwZSwgITEpOwogICAgICAgIGlmICghYikgcmV0dXJuIG51bGw7CiAgICAgICAgaWYgKGEuY2FuY2VsYWJsZSkgdGhyb3cgRXJyb3IoIm5vdCBzdXBwb3J0ZWQiKTsKICAgICAgICByZXR1cm4gYi5fRmlyZUFzR2VuZXJhdG9yKGEpCiAgICB9CiAgICBTZXREZWxheVJlbW92ZUV2ZW50c0VuYWJsZWQoYSkgewogICAgICAgIGZvciAoY29uc3QgYiBvZiB0aGlzLl9ldmVudEhhbmRsZXJzLnZhbHVlcygpKSBiLlNldERlbGF5UmVtb3ZlRXZlbnRzRW5hYmxlZChhKQogICAgfQp9OwoidXNlIHN0cmljdCI7CmNvbnN0IEMzJGpzY29tcCQyNSA9IHNlbGYuQzMsCiAgICBTRVRUSU1FT1VUX0lOVEVSVkFMID0gMTYsCiAgICBTVVBQT1JUU19SSUMgPSAidW5kZWZpbmVkIiAhPT0gdHlwZW9mIHJlcXVlc3RJZGxlQ2FsbGJhY2s7CmxldCB3b3JrUXVldWUgPSBbXSwKICAgIGNhbGxiYWNrSWQgPSAtMSwKICAgIGhpZ2hUaHJvdWdocHV0TW9kZSA9IDA7CgpmdW5jdGlvbiBTZXROZXdDYWxsYmFjayhhKSB7CiAgICBjYWxsYmFja0lkID0gU1VQUE9SVFNfUklDICYmIDAgPT09IGhpZ2hUaHJvdWdocHV0TW9kZSA/IHJlcXVlc3RJZGxlQ2FsbGJhY2soRG9Bc3luY2lmaWVkV29yaywgewogICAgICAgIHRpbWVvdXQ6IDM1CiAgICB9KSA6IHNldFRpbWVvdXQoRG9Bc3luY2lmaWVkV29yaywgMCA8IGhpZ2hUaHJvdWdocHV0TW9kZSA/IDEgOiBhKQp9CgpmdW5jdGlvbiBEb0FzeW5jaWZpZWRXb3JrKGEpIHsKICAgIGNhbGxiYWNrSWQgPSAtMTsKICAgIGlmICh3b3JrUXVldWUubGVuZ3RoKSB7CiAgICAgICAgdmFyIGIgPSBwZXJmb3JtYW5jZS5ub3coKSwKICAgICAgICAgICAgZCA9IDA7CiAgICAgICAgZG8gewogICAgICAgICAgICBEb05leHRBc3luY2lmaWVkSm9iKHdvcmtRdWV1ZS5zaGlmdCgpKTsKICAgICAgICAgICAgdmFyIGMgPSBwZXJmb3JtYW5jZS5ub3coKTsKICAgICAgICAgICAgKytkOwogICAgICAgICAgICB2YXIgZSA9IChjIC0gYikgLyBkICogMS4xCiAgICAgICAgfSB3aGlsZSAod29ya1F1ZXVlLmxlbmd0aCAmJiAoU1VQUE9SVFNfUklDICYmIDAgPT09IGhpZ2hUaHJvdWdocHV0TW9kZSAmJiAidW5kZWZpbmVkIiAhPT0gdHlwZW9mIGEgPyBlIDwgYS50aW1lUmVtYWluaW5nKCkgOiAxMiA+IGMgLSBiICsgZSkpOyAtIDEgPT09IGNhbGxiYWNrSWQgJiYgd29ya1F1ZXVlLmxlbmd0aCAmJiBTZXROZXdDYWxsYmFjayhNYXRoLm1heChTRVRUSU1FT1VUX0lOVEVSVkFMIC0gKGMgLSBiKSwgNCkpCiAgICB9Cn0KCmZ1bmN0aW9uIERvTmV4dEFzeW5jaWZpZWRKb2IoYSkgewogICAgbGV0IGI7CiAgICB0cnkgewogICAgICAgIGIgPSBhLmZ1bmMoKQogICAgfSBjYXRjaCAoZCkgewogICAgICAgIGEucmVqZWN0KGQpOwogICAgICAgIHJldHVybgogICAgfQogICAgYS5yZXNvbHZlKGIpCn0KbGV0IGFzeW5jaWZ5RGlzYWJsZWQgPSBDMyRqc2NvbXAkMjUuUXVlcnlTdHJpbmcuSGFzKCJkaXNhYmxlLWFzeW5jaWZ5Iik7CmFzeW5jaWZ5RGlzYWJsZWQgJiYgY29uc29sZS53YXJuKCJbQXN5bmNpZnldIEFzeW5jaWZ5IGhhcyBiZWVuIGRpc2FibGVkIGR1ZSB0byBkaXNhYmxlLWFzeW5jaWZ5IGluIHRoZSBxdWVyeSBzdHJpbmcuIFNvbWUgd29yayB3aWxsIG5vdyBiZSBkb25lIHN5bmNocm9ub3VzbHkuIik7CkMzJGpzY29tcCQyNS5Bc3luY2lmeSA9IGZ1bmN0aW9uKGEpIHsKICAgIGxldCBiID0gbnVsbDsKICAgIEMzJGpzY29tcCQyNS5pc0RlYnVnICYmIChiID0gQzMkanNjb21wJDI1LkdldENhbGxTdGFjaygpKTsKICAgIHJldHVybiBuZXcgUHJvbWlzZSgoZCwgYykgPT4gewogICAgICAgIHdvcmtRdWV1ZS5wdXNoKHsKICAgICAgICAgICAgZnVuYzogYSwKICAgICAgICAgICAgcmVzb2x2ZTogZCwKICAgICAgICAgICAgcmVqZWN0OiBjLAogICAgICAgICAgICBzdGFjazogYgogICAgICAgIH0pOwogICAgICAgIGFzeW5jaWZ5RGlzYWJsZWQgPyBEb05leHRBc3luY2lmaWVkSm9iKHdvcmtRdWV1ZS5wb3AoKSkgOiAtMSA9PT0gY2FsbGJhY2tJZCAmJiBTZXROZXdDYWxsYmFjayhTRVRUSU1FT1VUX0lOVEVSVkFMKQogICAgfSkKfTsKQzMkanNjb21wJDI1LkFzeW5jaWZ5LlNldEhpZ2hUaHJvdWdocHV0TW9kZSA9IGZ1bmN0aW9uKGEpIHsKICAgIGlmIChhKSArK2hpZ2hUaHJvdWdocHV0TW9kZTsKICAgIGVsc2UgaWYgKC0taGlnaFRocm91Z2hwdXRNb2RlLCAwID4gaGlnaFRocm91Z2hwdXRNb2RlKSB0aHJvdyBFcnJvcigiYWxyZWFkeSB0dXJuZWQgb2ZmIGhpZ2ggdGhyb3VnaHB1dCBtb2RlIik7Cn07CiJ1c2Ugc3RyaWN0IjsKY29uc3QgQzMkanNjb21wJDI2ID0gc2VsZi5DMywKICAgIElETEVfQ0hFQ0tfTUlOX0lOVEVSVkFMID0gMUUzLAogICAgSURMRV9DSEVDS19USU1FUl9PVkVSU0hPT1QgPSAxMDA7CmxldCBjYWNoZWROb3dUaW1lID0gLTE7CgpmdW5jdGlvbiBDbGVhclRpbWVDYWNoZSgpIHsKICAgIGNhY2hlZE5vd1RpbWUgPSAtMQp9CkMzJGpzY29tcCQyNi5GYXN0R2V0RGF0ZU5vdyA9IGZ1bmN0aW9uKCkgewogICAgLTEgPT09IGNhY2hlZE5vd1RpbWUgJiYgKGNhY2hlZE5vd1RpbWUgPSBEYXRlLm5vdygpLCBzZWxmLnNldFRpbWVvdXQoQ2xlYXJUaW1lQ2FjaGUsIDE2KSk7CiAgICByZXR1cm4gY2FjaGVkTm93VGltZQp9OwpsZXQgdGltZXJJZCA9IC0xLAogICAgbmV4dERlYWRsaW5lID0gLTEsCiAgICBhY3RpdmVJZGxlVGltZW91dHMgPSBuZXcgU2V0OwoKZnVuY3Rpb24gQ2hlY2tBY3RpdmVJZGxlVGltZW91dHMoKSB7CiAgICBuZXh0RGVhZGxpbmUgPSB0aW1lcklkID0gLTE7CiAgICBsZXQgYSA9IERhdGUubm93KCk7CiAgICBmb3IgKGxldCBiIG9mIGFjdGl2ZUlkbGVUaW1lb3V0cykKICAgICAgICBpZiAoYi5fQ2hlY2tUaW1lb3V0KGEpKSB7CiAgICAgICAgICAgIGxldCBkID0gYi5fR2V0RGVhZGxpbmUoKTsKICAgICAgICAgICAgaWYgKC0xID09PSBuZXh0RGVhZGxpbmUgfHwgZCA8IG5leHREZWFkbGluZSkgbmV4dERlYWRsaW5lID0gZAogICAgICAgIH0gZWxzZSBhY3RpdmVJZGxlVGltZW91dHMuZGVsZXRlKGIpOyAtIDEgIT09IG5leHREZWFkbGluZSAmJiAodGltZXJJZCA9IHNlbGYuc2V0VGltZW91dChDaGVja0FjdGl2ZUlkbGVUaW1lb3V0cywgTWF0aC5tYXgobmV4dERlYWRsaW5lIC0gYSArIElETEVfQ0hFQ0tfVElNRVJfT1ZFUlNIT09ULCBJRExFX0NIRUNLX01JTl9JTlRFUlZBTCkpKQp9CkMzJGpzY29tcCQyNi5JZGxlVGltZW91dCA9IGNsYXNzIHsKICAgIGNvbnN0cnVjdG9yKGEsIGIpIHsKICAgICAgICB0aGlzLl9jYWxsYmFjayA9IGE7CiAgICAgICAgdGhpcy5fdGltZW91dCA9IDFFMyAqIGI7CiAgICAgICAgdGhpcy5fZGVhZGxpbmUgPSAwOwogICAgICAgIHRoaXMuX2lzQWN0aXZlID0gITEKICAgIH0KICAgIFJlc2V0KCkgewogICAgICAgIGxldCBhID0gQzMkanNjb21wJDI2LkZhc3RHZXREYXRlTm93KCk7CiAgICAgICAgdGhpcy5fZGVhZGxpbmUgPSBhICsgdGhpcy5fdGltZW91dDsKICAgICAgICB0aGlzLl9pc0FjdGl2ZSB8fCAoYWN0aXZlSWRsZVRpbWVvdXRzLmFkZCh0aGlzKSwgdGhpcy5faXNBY3RpdmUgPSAhMCk7IC0gMSA9PT0gdGltZXJJZCA/IChuZXh0RGVhZGxpbmUgPSB0aGlzLl9kZWFkbGluZSwgdGltZXJJZCA9IHNlbGYuc2V0VGltZW91dChDaGVja0FjdGl2ZUlkbGVUaW1lb3V0cywgdGhpcy5fdGltZW91dCArIElETEVfQ0hFQ0tfVElNRVJfT1ZFUlNIT09UKSkgOiB0aGlzLl9kZWFkbGluZSA8IG5leHREZWFkbGluZSAmJiBuZXh0RGVhZGxpbmUgPiBhICsgSURMRV9DSEVDS19NSU5fSU5URVJWQUwgJiYgKHNlbGYuY2xlYXJUaW1lb3V0KHRpbWVySWQpLCBuZXh0RGVhZGxpbmUgPQogICAgICAgICAgICB0aGlzLl9kZWFkbGluZSwgdGltZXJJZCA9IHNlbGYuc2V0VGltZW91dChDaGVja0FjdGl2ZUlkbGVUaW1lb3V0cywgdGhpcy5fdGltZW91dCArIElETEVfQ0hFQ0tfVElNRVJfT1ZFUlNIT09UKSkKICAgIH0KICAgIF9DaGVja1RpbWVvdXQoYSkgewogICAgICAgIHJldHVybiBhID49IHRoaXMuX2RlYWRsaW5lID8gdGhpcy5fY2FsbGJhY2soKSA/ICh0aGlzLl9kZWFkbGluZSA9IGEgKyB0aGlzLl90aW1lb3V0LCAhMCkgOiB0aGlzLl9pc0FjdGl2ZSA9ICExIDogITAKICAgIH0KICAgIF9HZXREZWFkbGluZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZGVhZGxpbmUKICAgIH0KICAgIENhbmNlbCgpIHsKICAgICAgICB0aGlzLl9pc0FjdGl2ZSAmJiAoYWN0aXZlSWRsZVRpbWVvdXRzLmRlbGV0ZSh0aGlzKSwgdGhpcy5faXNBY3RpdmUgPSAhMSwgMCA9PT0gYWN0aXZlSWRsZVRpbWVvdXRzLnNpemUgJiYgLTEgIT09IHRpbWVySWQgJiYgKHNlbGYuY2xlYXJUaW1lb3V0KHRpbWVySWQpLCBuZXh0RGVhZGxpbmUgPSB0aW1lcklkID0gLTEpKQogICAgfQogICAgUmVsZWFzZSgpIHsKICAgICAgICB0aGlzLkNhbmNlbCgpOwogICAgICAgIHRoaXMuX2NhbGxiYWNrID0gbnVsbAogICAgfQp9OwoidXNlIHN0cmljdCI7CmNvbnN0IEMzJGpzY29tcCQyNyA9IHNlbGYuQzM7CkMzJGpzY29tcCQyNy5EaXNwb3NhYmxlID0gY2xhc3MgYSB7CiAgICBjb25zdHJ1Y3RvcihiKSB7CiAgICAgICAgdGhpcy5fZGlzcG9zZWQgPSAhMTsKICAgICAgICB0aGlzLl9kaXNwb3NlQWN0aW9uID0gYgogICAgfQogICAgRGlzcG9zZSgpIHsKICAgICAgICB0aGlzLl9kaXNwb3NlZCB8fCAodGhpcy5fZGlzcG9zZWQgPSAhMCwgdGhpcy5fZGlzcG9zZUFjdGlvbiAmJiAodGhpcy5fZGlzcG9zZUFjdGlvbigpLCB0aGlzLl9kaXNwb3NlQWN0aW9uID0gbnVsbCkpCiAgICB9CiAgICBJc0Rpc3Bvc2VkKCkgewogICAgICAgIHJldHVybiB0aGlzLl9kaXNwb3NlZAogICAgfQogICAgUmVsZWFzZSgpIHsKICAgICAgICB0aGlzLkRpc3Bvc2UoKQogICAgfQogICAgc3RhdGljIFJlbGVhc2UoYikgewogICAgICAgIHJldHVybiBuZXcgYSgoKSA9PiBiLlJlbGVhc2UoKSkKICAgIH0KICAgIHN0YXRpYyBGcm9tKGIsIGQsIGMsIGUsIGcpIHsKICAgICAgICBpZiAoInVuZGVmaW5lZCIgPT09IHR5cGVvZiBlIHx8IG51bGwgPT09IGUpIGUgPSAhMTsKICAgICAgICBlbHNlIGlmICgiYm9vbGVhbiIgIT09IHR5cGVvZiBlICYmICJvYmplY3QiICE9PSB0eXBlb2YgZSkgdGhyb3cgbmV3IFR5cGVFcnJvcigiaW52YWxpZCBldmVudCBsaXN0ZW5lciBvcHRpb25zIik7CiAgICAgICAgZyAmJiAoYyA9IGMuYmluZChnKSk7CiAgICAgICAgaWYgKGQuaW5jbHVkZXMoIiAiKSkgewogICAgICAgICAgICBkID0KICAgICAgICAgICAgICAgIGQuc3BsaXQoIiAiKTsKICAgICAgICAgICAgZyA9IG5ldyBDMyRqc2NvbXAkMjcuQ29tcG9zaXRlRGlzcG9zYWJsZTsKICAgICAgICAgICAgZm9yIChsZXQgayBvZiBkKSBiLmFkZEV2ZW50TGlzdGVuZXIoaywgYywgZSksIGcuQWRkKEMzJGpzY29tcCQyNy5OZXcoQzMkanNjb21wJDI3LkRpc3Bvc2FibGUsICgpID0+IGIucmVtb3ZlRXZlbnRMaXN0ZW5lcihrLCBjLCBlKSkpOwogICAgICAgICAgICByZXR1cm4gZwogICAgICAgIH0KICAgICAgICBiLmFkZEV2ZW50TGlzdGVuZXIoZCwgYywgZSk7CiAgICAgICAgcmV0dXJuIEMzJGpzY29tcCQyNy5OZXcoQzMkanNjb21wJDI3LkRpc3Bvc2FibGUsICgpID0+IGIucmVtb3ZlRXZlbnRMaXN0ZW5lcihkLCBjLCBlKSkKICAgIH0KfTsKQzMkanNjb21wJDI3LlN0dWJEaXNwb3NhYmxlID0gY2xhc3MgZXh0ZW5kcyBDMyRqc2NvbXAkMjcuRGlzcG9zYWJsZSB7CiAgICBTZXRBY3Rpb24oYSkgewogICAgICAgIHRoaXMuX2Rpc3Bvc2VBY3Rpb24gPSBhCiAgICB9Cn07CkMzJGpzY29tcCQyNy5Db21wb3NpdGVEaXNwb3NhYmxlID0gY2xhc3MgZXh0ZW5kcyBDMyRqc2NvbXAkMjcuRGlzcG9zYWJsZSB7CiAgICBjb25zdHJ1Y3RvciguLi5hKSB7CiAgICAgICAgc3VwZXIoKTsKICAgICAgICB0aGlzLl9kaXNwb3NhYmxlcyA9IG5ldyBTZXQ7CiAgICAgICAgZm9yIChsZXQgYiBvZiBhKSB0aGlzLkFkZChiKQogICAgfQogICAgQWRkKC4uLmEpIHsKICAgICAgICBpZiAodGhpcy5fZGlzcG9zZWQpIHRocm93IEVycm9yKCJhbHJlYWR5IGRpc3Bvc2VkIik7CiAgICAgICAgZm9yIChsZXQgYiBvZiBhKSB0aGlzLl9kaXNwb3NhYmxlcy5hZGQoYikKICAgIH0KICAgIFJlbW92ZShhKSB7CiAgICAgICAgaWYgKHRoaXMuX2Rpc3Bvc2VkKSB0aHJvdyBFcnJvcigiYWxyZWFkeSBkaXNwb3NlZCIpOwogICAgICAgIHRoaXMuX2Rpc3Bvc2FibGVzLmRlbGV0ZShhKQogICAgfQogICAgUmVtb3ZlQWxsKCkgewogICAgICAgIGlmICh0aGlzLl9kaXNwb3NlZCkgdGhyb3cgRXJyb3IoImFscmVhZHkgZGlzcG9zZWQiKTsKICAgICAgICBpZiAodGhpcy5fZGlzcG9zYWJsZXMpIHsKICAgICAgICAgICAgZm9yIChsZXQgYSBvZiB0aGlzLl9kaXNwb3NhYmxlcykgYS5EaXNwb3NlKCk7CiAgICAgICAgICAgIHRoaXMuX2Rpc3Bvc2FibGVzLmNsZWFyKCkKICAgICAgICB9CiAgICB9CiAgICBJc0Rpc3Bvc2VkKCkgewogICAgICAgIHJldHVybiB0aGlzLl9kaXNwb3NlZAogICAgfQogICAgRGlzcG9zZSgpIHsKICAgICAgICBpZiAodGhpcy5fZGlzcG9zZWQpIHRocm93IEVycm9yKCJhbHJlYWR5IGRpc3Bvc2VkIik7CiAgICAgICAgdGhpcy5fZGlzcG9zZWQgPSAhMDsKICAgICAgICBmb3IgKGxldCBhIG9mIHRoaXMuX2Rpc3Bvc2FibGVzKSBhLkRpc3Bvc2UoKTsKICAgICAgICB0aGlzLl9kaXNwb3NhYmxlcy5jbGVhcigpOwogICAgICAgIHRoaXMuX2Rpc3Bvc2FibGVzID0gbnVsbAogICAgfQogICAgUmVsZWFzZSgpIHsKICAgICAgICB0aGlzLkRpc3Bvc2UoKQogICAgfQp9OwoidXNlIHN0cmljdCI7CmNvbnN0IEMzJGpzY29tcCQyOCA9IHNlbGYuQzM7CkMzJGpzY29tcCQyOC5LYWhhblN1bSA9IGNsYXNzIGV4dGVuZHMgQzMkanNjb21wJDI4LkRlZmVuZGVkQmFzZSB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgICBzdXBlcigpOwogICAgICAgIHRoaXMuX3N1bSA9IHRoaXMuX3QgPSB0aGlzLl95ID0gdGhpcy5fYyA9IDAKICAgIH0KICAgIEFkZChhKSB7CiAgICAgICAgdGhpcy5feSA9ICthIC0gdGhpcy5fYzsKICAgICAgICB0aGlzLl90ID0gdGhpcy5fc3VtICsgdGhpcy5feTsKICAgICAgICB0aGlzLl9jID0gdGhpcy5fdCAtIHRoaXMuX3N1bSAtIHRoaXMuX3k7CiAgICAgICAgdGhpcy5fc3VtID0gdGhpcy5fdAogICAgfQogICAgU3VidHJhY3QoYSkgewogICAgICAgIHRoaXMuX3N1bSAtPSArYQogICAgfQogICAgR2V0KCkgewogICAgICAgIHJldHVybiB0aGlzLl9zdW0KICAgIH0KICAgIFJlc2V0KCkgewogICAgICAgIHRoaXMuX3N1bSA9IHRoaXMuX3QgPSB0aGlzLl95ID0gdGhpcy5fYyA9IDAKICAgIH0KICAgIFNldChhKSB7CiAgICAgICAgdGhpcy5fdCA9IHRoaXMuX3kgPSB0aGlzLl9jID0gMDsKICAgICAgICB0aGlzLl9zdW0gPSArYQogICAgfQogICAgQ29weShhKSB7CiAgICAgICAgdGhpcy5fYyA9IGEuX2M7CiAgICAgICAgdGhpcy5feSA9IGEuX3k7CiAgICAgICAgdGhpcy5fdCA9IGEuX3Q7CiAgICAgICAgdGhpcy5fc3VtID0gYS5fc3VtCiAgICB9CiAgICBSZWxlYXNlKCkge30KfTsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkMjkgPSBzZWxmLkMzLAogICAganNfY29scyA9IHsKICAgICAgICBSQm5vZGU6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgdGhpcy50cmVlID0gYTsKICAgICAgICAgICAgdGhpcy5sZWZ0ID0gdGhpcy5yaWdodCA9IHRoaXMudHJlZS5zZW50aW5lbDsKICAgICAgICAgICAgdGhpcy5wYXJlbnQgPSBudWxsOwogICAgICAgICAgICB0aGlzLmNvbG9yID0gITE7CiAgICAgICAgICAgIHRoaXMua2V5ID0gbnVsbAogICAgICAgIH0sCiAgICAgICAgUmVkQmxhY2tTZXQ6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgdGhpcy5zaXplID0gMDsKICAgICAgICAgICAgdGhpcy5zZW50aW5lbCA9IG5ldyBqc19jb2xzLlJCbm9kZSh0aGlzKTsKICAgICAgICAgICAgdGhpcy5zZW50aW5lbC5jb2xvciA9ICExOwogICAgICAgICAgICB0aGlzLnJvb3QgPSB0aGlzLnNlbnRpbmVsOwogICAgICAgICAgICB0aGlzLnJvb3QucGFyZW50ID0gdGhpcy5zZW50aW5lbDsKICAgICAgICAgICAgdGhpcy5jb21wYXJlID0gYSB8fCB0aGlzLmRlZmF1bHRfY29tcGFyZQogICAgICAgIH0KICAgIH07CmpzX2NvbHMuUmVkQmxhY2tTZXQucHJvdG90eXBlLmRlZmF1bHRfY29tcGFyZSA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgIHJldHVybiBhIDwgYiA/IC0xIDogYiA8IGEgPyAxIDogMAp9Owpqc19jb2xzLlJlZEJsYWNrU2V0LnByb3RvdHlwZS5jbG9uZSA9IGZ1bmN0aW9uKCkgewogICAgdmFyIGEgPSBuZXcganNfY29scy5SZWRCbGFja1NldCh0aGlzLmNvbXBhcmUpOwogICAgYS5pbnNlcnRBbGwodGhpcyk7CiAgICByZXR1cm4gYQp9Owpqc19jb2xzLlJlZEJsYWNrU2V0LnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uKCkgewogICAgdGhpcy5zaXplID0gMDsKICAgIHRoaXMuc2VudGluZWwgPSBuZXcganNfY29scy5SQm5vZGUodGhpcyk7CiAgICB0aGlzLnNlbnRpbmVsLmNvbG9yID0gITE7CiAgICB0aGlzLnJvb3QgPSB0aGlzLnNlbnRpbmVsOwogICAgdGhpcy5yb290LnBhcmVudCA9IHRoaXMuc2VudGluZWwKfTsKanNfY29scy5SZWRCbGFja1NldC5wcm90b3R5cGUubGVmdFJvdGF0ZSA9IGZ1bmN0aW9uKGEpIHsKICAgIHZhciBiID0gYS5yaWdodDsKICAgIGEucmlnaHQgPSBiLmxlZnQ7CiAgICBiLmxlZnQgIT0gdGhpcy5zZW50aW5lbCAmJiAoYi5sZWZ0LnBhcmVudCA9IGEpOwogICAgYi5wYXJlbnQgPSBhLnBhcmVudDsKICAgIGEucGFyZW50ID09IHRoaXMuc2VudGluZWwgPyB0aGlzLnJvb3QgPSBiIDogYSA9PSBhLnBhcmVudC5sZWZ0ID8gYS5wYXJlbnQubGVmdCA9IGIgOiBhLnBhcmVudC5yaWdodCA9IGI7CiAgICBiLmxlZnQgPSBhOwogICAgYS5wYXJlbnQgPSBiCn07CmpzX2NvbHMuUmVkQmxhY2tTZXQucHJvdG90eXBlLnJpZ2h0Um90YXRlID0gZnVuY3Rpb24oYSkgewogICAgdmFyIGIgPSBhLmxlZnQ7CiAgICBhLmxlZnQgPSBiLnJpZ2h0OwogICAgYi5yaWdodCAhPSB0aGlzLnNlbnRpbmVsICYmIChiLnJpZ2h0LnBhcmVudCA9IGEpOwogICAgYi5wYXJlbnQgPSBhLnBhcmVudDsKICAgIGEucGFyZW50ID09IHRoaXMuc2VudGluZWwgPyB0aGlzLnJvb3QgPSBiIDogYSA9PSBhLnBhcmVudC5yaWdodCA/IGEucGFyZW50LnJpZ2h0ID0gYiA6IGEucGFyZW50LmxlZnQgPSBiOwogICAgYi5yaWdodCA9IGE7CiAgICBhLnBhcmVudCA9IGIKfTsKanNfY29scy5SZWRCbGFja1NldC5wcm90b3R5cGUuaW5zZXJ0ID0gZnVuY3Rpb24oYSkgewogICAgaWYgKHRoaXMuY29udGFpbnMoYSkpIHRoaXMuZ2V0XyhhKS5rZXkgPSBhOwogICAgZWxzZSB7CiAgICAgICAgdmFyIGIgPSBuZXcganNfY29scy5SQm5vZGUodGhpcyk7CiAgICAgICAgYi5rZXkgPSBhOwogICAgICAgIGEgPSB0aGlzLnNlbnRpbmVsOwogICAgICAgIGZvciAodmFyIGQgPSB0aGlzLnJvb3Q7IGQgIT0gdGhpcy5zZW50aW5lbDspIGEgPSBkLCBkID0gMCA+IHRoaXMuY29tcGFyZShiLmtleSwgZC5rZXkpID8gZC5sZWZ0IDogZC5yaWdodDsKICAgICAgICBiLnBhcmVudCA9IGE7CiAgICAgICAgYSA9PSB0aGlzLnNlbnRpbmVsID8gdGhpcy5yb290ID0gYiA6IDAgPiB0aGlzLmNvbXBhcmUoYi5rZXksIGEua2V5KSA/IGEubGVmdCA9IGIgOiBhLnJpZ2h0ID0gYjsKICAgICAgICBiLmxlZnQgPSB0aGlzLnNlbnRpbmVsOwogICAgICAgIGIucmlnaHQgPSB0aGlzLnNlbnRpbmVsOwogICAgICAgIGIuY29sb3IgPSAhMDsKICAgICAgICB0aGlzLmluc2VydEZpeHVwKGIpOwogICAgICAgIHRoaXMuc2l6ZSsrCiAgICB9Cn07CmpzX2NvbHMuUmVkQmxhY2tTZXQucHJvdG90eXBlLmluc2VydEZpeHVwID0gZnVuY3Rpb24oYSkgewogICAgZm9yICg7IGEgIT0gdGhpcy5zZW50aW5lbCAmJiBhICE9IHRoaXMucm9vdCAmJiAxID09IGEucGFyZW50LmNvbG9yOykKICAgICAgICBpZiAoYS5wYXJlbnQgPT0gYS5wYXJlbnQucGFyZW50LmxlZnQpIHsKICAgICAgICAgICAgdmFyIGIgPSBhLnBhcmVudC5wYXJlbnQucmlnaHQ7CiAgICAgICAgICAgIDEgPT0gYi5jb2xvciA/IChhLnBhcmVudC5jb2xvciA9ICExLCBiLmNvbG9yID0gITEsIGEucGFyZW50LnBhcmVudC5jb2xvciA9ICEwLCBhID0gYS5wYXJlbnQucGFyZW50KSA6IChhID09IGEucGFyZW50LnJpZ2h0ICYmIChhID0gYS5wYXJlbnQsIHRoaXMubGVmdFJvdGF0ZShhKSksIGEucGFyZW50LmNvbG9yID0gITEsIGEucGFyZW50LnBhcmVudC5jb2xvciA9ICEwLCBhLnBhcmVudC5wYXJlbnQgIT0gdGhpcy5zZW50aW5lbCAmJiB0aGlzLnJpZ2h0Um90YXRlKGEucGFyZW50LnBhcmVudCkpCiAgICAgICAgfSBlbHNlIGIgPSBhLnBhcmVudC5wYXJlbnQubGVmdCwgMSA9PSBiLmNvbG9yID8gKGEucGFyZW50LmNvbG9yID0gITEsIGIuY29sb3IgPSAhMSwgYS5wYXJlbnQucGFyZW50LmNvbG9yID0gITAsIGEgPSBhLnBhcmVudC5wYXJlbnQpIDogKGEgPT0gYS5wYXJlbnQubGVmdCAmJiAoYSA9IGEucGFyZW50LCB0aGlzLnJpZ2h0Um90YXRlKGEpKSwgYS5wYXJlbnQuY29sb3IgPSAhMSwgYS5wYXJlbnQucGFyZW50LmNvbG9yID0gITAsIGEucGFyZW50LnBhcmVudCAhPSB0aGlzLnNlbnRpbmVsICYmIHRoaXMubGVmdFJvdGF0ZShhLnBhcmVudC5wYXJlbnQpKTsKICAgIHRoaXMucm9vdC5jb2xvciA9ICExCn07CmpzX2NvbHMuUmVkQmxhY2tTZXQucHJvdG90eXBlLmRlbGV0ZV8gPSBmdW5jdGlvbihhKSB7CiAgICB2YXIgYiA9IGEubGVmdCA9PSB0aGlzLnNlbnRpbmVsIHx8IGEucmlnaHQgPT0gdGhpcy5zZW50aW5lbCA/IGEgOiB0aGlzLnN1Y2Nlc3Nvcl8oYSk7CiAgICB2YXIgZCA9IGIubGVmdCAhPSB0aGlzLnNlbnRpbmVsID8gYi5sZWZ0IDogYi5yaWdodDsKICAgIGQucGFyZW50ID0gYi5wYXJlbnQ7CiAgICBiLnBhcmVudCA9PSB0aGlzLnNlbnRpbmVsID8gdGhpcy5yb290ID0gZCA6IGIgPT0gYi5wYXJlbnQubGVmdCA/IGIucGFyZW50LmxlZnQgPSBkIDogYi5wYXJlbnQucmlnaHQgPSBkOwogICAgYiAhPSBhICYmIChhLmtleSA9IGIua2V5KTsKICAgIDAgPT0gYi5jb2xvciAmJiB0aGlzLmRlbGV0ZUZpeHVwKGQpOwogICAgdGhpcy5zaXplLS0KfTsKanNfY29scy5SZWRCbGFja1NldC5wcm90b3R5cGUuZGVsZXRlRml4dXAgPSBmdW5jdGlvbihhKSB7CiAgICBmb3IgKDsgYSAhPSB0aGlzLnJvb3QgJiYgMCA9PSBhLmNvbG9yOykKICAgICAgICBpZiAoYSA9PSBhLnBhcmVudC5sZWZ0KSB7CiAgICAgICAgICAgIHZhciBiID0gYS5wYXJlbnQucmlnaHQ7CiAgICAgICAgICAgIDEgPT0gYi5jb2xvciAmJiAoYi5jb2xvciA9ICExLCBhLnBhcmVudC5jb2xvciA9ICEwLCB0aGlzLmxlZnRSb3RhdGUoYS5wYXJlbnQpLCBiID0gYS5wYXJlbnQucmlnaHQpOwogICAgICAgICAgICAwID09IGIubGVmdC5jb2xvciAmJiAwID09IGIucmlnaHQuY29sb3IgPyAoYi5jb2xvciA9ICEwLCBhID0gYS5wYXJlbnQpIDogKDAgPT0gYi5yaWdodC5jb2xvciAmJiAoYi5sZWZ0LmNvbG9yID0gITEsIGIuY29sb3IgPSAhMCwgdGhpcy5yaWdodFJvdGF0ZShiKSwgYiA9IGEucGFyZW50LnJpZ2h0KSwgYi5jb2xvciA9IGEucGFyZW50LmNvbG9yLCBhLnBhcmVudC5jb2xvciA9ICExLCBiLnJpZ2h0LmNvbG9yID0gITEsIHRoaXMubGVmdFJvdGF0ZShhLnBhcmVudCksIGEgPSB0aGlzLnJvb3QpCiAgICAgICAgfSBlbHNlIGIgPSBhLnBhcmVudC5sZWZ0LCAxID09IGIuY29sb3IgJiYgKGIuY29sb3IgPSAhMSwgYS5wYXJlbnQuY29sb3IgPSAhMCwgdGhpcy5yaWdodFJvdGF0ZShhLnBhcmVudCksIGIgPSBhLnBhcmVudC5sZWZ0KSwgMCA9PSBiLnJpZ2h0LmNvbG9yICYmIDAgPT0gYi5sZWZ0LmNvbG9yID8gKGIuY29sb3IgPSAhMCwgYSA9IGEucGFyZW50KSA6ICgwID09IGIubGVmdC5jb2xvciAmJiAoYi5yaWdodC5jb2xvciA9ICExLCBiLmNvbG9yID0gITAsIHRoaXMubGVmdFJvdGF0ZShiKSwgYiA9IGEucGFyZW50LmxlZnQpLCBiLmNvbG9yID0gYS5wYXJlbnQuY29sb3IsIGEucGFyZW50LmNvbG9yID0gITEsIGIubGVmdC5jb2xvciA9ICExLCB0aGlzLnJpZ2h0Um90YXRlKGEucGFyZW50KSwgYSA9IHRoaXMucm9vdCk7CiAgICBhLmNvbG9yID0gITEKfTsKanNfY29scy5SZWRCbGFja1NldC5wcm90b3R5cGUucmVtb3ZlID0gZnVuY3Rpb24oYSkgewogICAgYSA9IHRoaXMuZ2V0XyhhKTsKICAgIGlmIChhICE9IHRoaXMuc2VudGluZWwpIHsKICAgICAgICB2YXIgYiA9IGEua2V5OwogICAgICAgIHRoaXMuZGVsZXRlXyhhKTsKICAgICAgICByZXR1cm4gYgogICAgfQogICAgcmV0dXJuIG51bGwKfTsKanNfY29scy5SZWRCbGFja1NldC5wcm90b3R5cGUucmVtb3ZlU3dhcHBlZCA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgIHRoaXMucmVtb3ZlKGIpCn07CmpzX2NvbHMuUmVkQmxhY2tTZXQucHJvdG90eXBlLm1pbiA9IGZ1bmN0aW9uKGEpIHsKICAgIGZvciAoOyBhLmxlZnQgIT0gdGhpcy5zZW50aW5lbDspIGEgPSBhLmxlZnQ7CiAgICByZXR1cm4gYQp9Owpqc19jb2xzLlJlZEJsYWNrU2V0LnByb3RvdHlwZS5tYXggPSBmdW5jdGlvbihhKSB7CiAgICBmb3IgKDsgYS5yaWdodCAhPSB0aGlzLnNlbnRpbmVsOykgYSA9IGEucmlnaHQ7CiAgICByZXR1cm4gYQp9Owpqc19jb2xzLlJlZEJsYWNrU2V0LnByb3RvdHlwZS5zdWNjZXNzb3JfID0gZnVuY3Rpb24oYSkgewogICAgaWYgKGEucmlnaHQgIT0gdGhpcy5zZW50aW5lbCkgcmV0dXJuIHRoaXMubWluKGEucmlnaHQpOwogICAgZm9yICh2YXIgYiA9IGEucGFyZW50OyBiICE9IHRoaXMuc2VudGluZWwgJiYgYSA9PSBiLnJpZ2h0OykgYSA9IGIsIGIgPSBiLnBhcmVudDsKICAgIHJldHVybiBiCn07CmpzX2NvbHMuUmVkQmxhY2tTZXQucHJvdG90eXBlLnByZWRlY2Nlc3Nvcl8gPSBmdW5jdGlvbihhKSB7CiAgICBpZiAoYS5sZWZ0ICE9IHRoaXMuc2VudGluZWwpIHJldHVybiB0aGlzLm1heChhLmxlZnQpOwogICAgZm9yICh2YXIgYiA9IGEucGFyZW50OyBiICE9IHRoaXMuc2VudGluZWwgJiYgYSA9PSBiLmxlZnQ7KSBhID0gYiwgYiA9IGIucGFyZW50OwogICAgcmV0dXJuIGIKfTsKanNfY29scy5SZWRCbGFja1NldC5wcm90b3R5cGUuc3VjY2Vzc29yID0gZnVuY3Rpb24oYSkgewogICAgaWYgKDAgPCB0aGlzLnNpemUpIHsKICAgICAgICBhID0gdGhpcy5nZXRfKGEpOwogICAgICAgIGlmIChhID09IHRoaXMuc2VudGluZWwpIHJldHVybiBudWxsOwogICAgICAgIGlmIChhLnJpZ2h0ICE9IHRoaXMuc2VudGluZWwpIHJldHVybiB0aGlzLm1pbihhLnJpZ2h0KS5rZXk7CiAgICAgICAgZm9yICh2YXIgYiA9IGEucGFyZW50OyBiICE9IHRoaXMuc2VudGluZWwgJiYgYSA9PSBiLnJpZ2h0OykgYSA9IGIsIGIgPSBiLnBhcmVudDsKICAgICAgICByZXR1cm4gYiAhPSB0aGlzLnNlbnRpbmVsID8gYi5rZXkgOiBudWxsCiAgICB9CiAgICByZXR1cm4gbnVsbAp9Owpqc19jb2xzLlJlZEJsYWNrU2V0LnByb3RvdHlwZS5wcmVkZWNlc3NvciA9IGZ1bmN0aW9uKGEpIHsKICAgIGlmICgwIDwgdGhpcy5zaXplKSB7CiAgICAgICAgYSA9IHRoaXMuZ2V0XyhhKTsKICAgICAgICBpZiAoYSA9PSB0aGlzLnNlbnRpbmVsKSByZXR1cm4gbnVsbDsKICAgICAgICBpZiAoYS5sZWZ0ICE9IHRoaXMuc2VudGluZWwpIHJldHVybiB0aGlzLm1heChhLmxlZnQpLmtleTsKICAgICAgICBmb3IgKHZhciBiID0gYS5wYXJlbnQ7IGIgIT0gdGhpcy5zZW50aW5lbCAmJiBhID09IGIubGVmdDspIGEgPSBiLCBiID0gYi5wYXJlbnQ7CiAgICAgICAgcmV0dXJuIGIgIT0gdGhpcy5zZW50aW5lbCA/IGIua2V5IDogbnVsbAogICAgfQogICAgcmV0dXJuIG51bGwKfTsKanNfY29scy5SZWRCbGFja1NldC5wcm90b3R5cGUuZ2V0TWluID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gdGhpcy5taW4odGhpcy5yb290KS5rZXkKfTsKanNfY29scy5SZWRCbGFja1NldC5wcm90b3R5cGUuZ2V0TWF4ID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gdGhpcy5tYXgodGhpcy5yb290KS5rZXkKfTsKanNfY29scy5SZWRCbGFja1NldC5wcm90b3R5cGUuZ2V0XyA9IGZ1bmN0aW9uKGEpIHsKICAgIGZvciAodmFyIGIgPSB0aGlzLnJvb3Q7IGIgIT0gdGhpcy5zZW50aW5lbCAmJiAwICE9IHRoaXMuY29tcGFyZShiLmtleSwgYSk7KSBiID0gMCA+IHRoaXMuY29tcGFyZShhLCBiLmtleSkgPyBiLmxlZnQgOiBiLnJpZ2h0OwogICAgcmV0dXJuIGIKfTsKanNfY29scy5SZWRCbGFja1NldC5wcm90b3R5cGUuY29udGFpbnMgPSBmdW5jdGlvbihhKSB7CiAgICByZXR1cm4gbnVsbCAhPSB0aGlzLmdldF8oYSkua2V5Cn07CmpzX2NvbHMuUmVkQmxhY2tTZXQucHJvdG90eXBlLmdldFZhbHVlcyA9IGZ1bmN0aW9uKCkgewogICAgdmFyIGEgPSBbXTsKICAgIHRoaXMuZm9yRWFjaChmdW5jdGlvbihiKSB7CiAgICAgICAgYS5wdXNoKGIpCiAgICB9KTsKICAgIHJldHVybiBhCn07CmpzX2NvbHMuUmVkQmxhY2tTZXQucHJvdG90eXBlLmluc2VydEFsbCA9IGZ1bmN0aW9uKGEpIHsKICAgIGlmICgiYXJyYXkiID09IGpzX2NvbHMudHlwZU9mKGEpKQogICAgICAgIGZvciAodmFyIGIgPSAwOyBiIDwgYS5sZW5ndGg7IGIrKykgdGhpcy5pbnNlcnQoYVtiXSk7CiAgICBlbHNlIGlmICgiZnVuY3Rpb24iID09IGpzX2NvbHMudHlwZU9mKGEuZm9yRWFjaCkpIGEuZm9yRWFjaCh0aGlzLmluc2VydCwgdGhpcyk7CiAgICBlbHNlIGlmICgiZnVuY3Rpb24iID09IGpzX2NvbHMudHlwZU9mKGEuZ2V0VmFsdWVzKSkKICAgICAgICBmb3IgKGEgPSBhLmdldFZhbHVlcygpLCBiID0gMDsgYiA8IGEubGVuZ3RoOyBiKyspIHRoaXMuaW5zZXJ0KGFbYl0pOwogICAgZWxzZSBpZiAoIm9iamVjdCIgPT0ganNfY29scy50eXBlT2YoYSkpCiAgICAgICAgZm9yIChiIGluIGEpIHRoaXMuaW5zZXJ0KGFbYl0pCn07CmpzX2NvbHMuUmVkQmxhY2tTZXQucHJvdG90eXBlLnJlbW92ZUFsbCA9IGZ1bmN0aW9uKGEpIHsKICAgIGlmICgiYXJyYXkiID09IGpzX2NvbHMudHlwZU9mKGEpKQogICAgICAgIGZvciAodmFyIGIgPSAwOyBiIDwgYS5sZW5ndGg7IGIrKykgdGhpcy5yZW1vdmUoYVtiXSk7CiAgICBlbHNlIGlmICgiZnVuY3Rpb24iID09IGpzX2NvbHMudHlwZU9mKGEuZm9yRWFjaCkpIGEuZm9yRWFjaCh0aGlzLnJlbW92ZVN3YXBwZWQsIHRoaXMpOwogICAgZWxzZSBpZiAoImZ1bmN0aW9uIiA9PSBqc19jb2xzLnR5cGVPZihhLmdldFZhbHVlcykpCiAgICAgICAgZm9yIChhID0gYS5nZXRWYWx1ZXMoKSwgYiA9IDA7IGIgPCBhLmxlbmd0aDsgYisrKSB0aGlzLnJlbW92ZShhW2JdKTsKICAgIGVsc2UgaWYgKCJvYmplY3QiID09IGpzX2NvbHMudHlwZU9mKGEpKQogICAgICAgIGZvciAoYiBpbiBhKSB0aGlzLnJlbW92ZShhW2JdKQp9Owpqc19jb2xzLlJlZEJsYWNrU2V0LnByb3RvdHlwZS5jb250YWluc0FsbCA9IGZ1bmN0aW9uKGEpIHsKICAgIGlmICgiYXJyYXkiID09IGpzX2NvbHMudHlwZU9mKGEpKSB7CiAgICAgICAgZm9yICh2YXIgYiA9IDA7IGIgPCBhLmxlbmd0aDsgYisrKQogICAgICAgICAgICBpZiAoIXRoaXMuY29udGFpbnMoYVtiXSkpIHJldHVybiAhMTsKICAgICAgICByZXR1cm4gITAKICAgIH0KICAgIGlmICgiZnVuY3Rpb24iID09IGpzX2NvbHMudHlwZU9mKGEuZm9yRWFjaCkpIHJldHVybiBhLmV2ZXJ5KHRoaXMuY29udGFpbnMsIHRoaXMpOwogICAgaWYgKCJmdW5jdGlvbiIgPT0ganNfY29scy50eXBlT2YoYS5nZXRWYWx1ZXMpKSB7CiAgICAgICAgYSA9IGEuZ2V0VmFsdWVzKCk7CiAgICAgICAgZm9yIChiID0gMDsgYiA8IGEubGVuZ3RoOyBiKyspCiAgICAgICAgICAgIGlmICghdGhpcy5jb250YWlucyhhW2JdKSkgcmV0dXJuICExOwogICAgICAgIHJldHVybiAhMAogICAgfQogICAgaWYgKCJvYmplY3QiID09IGpzX2NvbHMudHlwZU9mKGEpKSB7CiAgICAgICAgZm9yIChiIGluIGEpCiAgICAgICAgICAgIGlmICghdGhpcy5jb250YWlucyhhW2JdKSkgcmV0dXJuICExOwogICAgICAgIHJldHVybiAhMAogICAgfQp9Owpqc19jb2xzLlJlZEJsYWNrU2V0LnByb3RvdHlwZS5yYW5nZSA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgIHZhciBkID0gW107CiAgICB0aGlzLnRyYXZlcnNlRnJvbVRvKGZ1bmN0aW9uKGMpIHsKICAgICAgICBkLnB1c2goYykKICAgIH0sIGEsIGIpOwogICAgcmV0dXJuIGQKfTsKanNfY29scy5SZWRCbGFja1NldC5wcm90b3R5cGUudHJhdmVyc2UgPSBmdW5jdGlvbihhLCBiKSB7CiAgICBpZiAoIXRoaXMuaXNFbXB0eSgpKQogICAgICAgIGZvciAodmFyIGQgPSB0aGlzLm1pbih0aGlzLnJvb3QpOyBkICE9IHRoaXMuc2VudGluZWwgJiYgIWEuY2FsbChiLCBkLmtleSwgdGhpcyk7KSBkID0gdGhpcy5zdWNjZXNzb3JfKGQpCn07CmpzX2NvbHMuUmVkQmxhY2tTZXQucHJvdG90eXBlLnRyYXZlcnNlRnJvbSA9IGZ1bmN0aW9uKGEsIGIsIGQpIHsKICAgIGlmICghdGhpcy5pc0VtcHR5KCkpCiAgICAgICAgZm9yIChiID0gdGhpcy5nZXRfKGIpOyBiICE9IHRoaXMuc2VudGluZWwgJiYgIWEuY2FsbChkLCBiLmtleSwgdGhpcyk7KSBiID0gdGhpcy5zdWNjZXNzb3JfKGIpCn07CmpzX2NvbHMuUmVkQmxhY2tTZXQucHJvdG90eXBlLnRyYXZlcnNlVG8gPSBmdW5jdGlvbihhLCBiLCBkKSB7CiAgICBpZiAoIXRoaXMuaXNFbXB0eSgpKSB7CiAgICAgICAgdmFyIGMgPSB0aGlzLm1pbih0aGlzLnJvb3QpOwogICAgICAgIGZvciAoYiA9IHRoaXMuZ2V0XyhiKTsgYyAhPSBiICYmICFhLmNhbGwoZCwgYy5rZXksIHRoaXMpOykgYyA9IHRoaXMuc3VjY2Vzc29yXyhjKQogICAgfQp9Owpqc19jb2xzLlJlZEJsYWNrU2V0LnByb3RvdHlwZS50cmF2ZXJzZUZyb21UbyA9IGZ1bmN0aW9uKGEsIGIsIGQsIGMpIHsKICAgIGlmICghdGhpcy5pc0VtcHR5KCkpCiAgICAgICAgZm9yIChiID0gdGhpcy5nZXRfKGIpLCBkID0gdGhpcy5nZXRfKGQpOyBiICE9IGQgJiYgIWEuY2FsbChjLCBiLmtleSwgdGhpcyk7KSBiID0gdGhpcy5zdWNjZXNzb3JfKGIpCn07CmpzX2NvbHMuUmVkQmxhY2tTZXQucHJvdG90eXBlLnRyYXZlcnNlQmFja3dhcmRzID0gZnVuY3Rpb24oYSwgYikgewogICAgaWYgKCF0aGlzLmlzRW1wdHkoKSkKICAgICAgICBmb3IgKHZhciBkID0gdGhpcy5tYXgodGhpcy5yb290KTsgZCAhPSB0aGlzLnNlbnRpbmVsICYmICFhLmNhbGwoYiwgZC5rZXksIHRoaXMpOykgZCA9IHRoaXMucHJlZGVjY2Vzc29yXyhkKQp9Owpqc19jb2xzLlJlZEJsYWNrU2V0LnByb3RvdHlwZS5mb3JFYWNoID0gZnVuY3Rpb24oYSwgYikgewogICAgaWYgKCF0aGlzLmlzRW1wdHkoKSkKICAgICAgICBmb3IgKHZhciBkID0gdGhpcy5taW4odGhpcy5yb290KTsgZCAhPSB0aGlzLnNlbnRpbmVsOyBkID0gdGhpcy5zdWNjZXNzb3JfKGQpKSBhLmNhbGwoYiwgZC5rZXksIGQua2V5LCB0aGlzKQp9Owpqc19jb2xzLlJlZEJsYWNrU2V0LnByb3RvdHlwZS5zb21lID0gZnVuY3Rpb24oYSwgYikgewogICAgaWYgKHRoaXMuaXNFbXB0eSgpKSByZXR1cm4gITE7CiAgICBmb3IgKHZhciBkID0gdGhpcy5taW4odGhpcy5yb290KTsgZCAhPSB0aGlzLnNlbnRpbmVsOyBkID0gdGhpcy5zdWNjZXNzb3JfKGQpKQogICAgICAgIGlmIChhLmNhbGwoYiwgZC5rZXksIGQua2V5LCB0aGlzKSkgcmV0dXJuICEwOwogICAgcmV0dXJuICExCn07CmpzX2NvbHMuUmVkQmxhY2tTZXQucHJvdG90eXBlLmV2ZXJ5ID0gZnVuY3Rpb24oYSwgYikgewogICAgaWYgKHRoaXMuaXNFbXB0eSgpKSByZXR1cm4gITE7CiAgICBmb3IgKHZhciBkID0gdGhpcy5taW4odGhpcy5yb290KTsgZCAhPSB0aGlzLnNlbnRpbmVsOyBkID0gdGhpcy5zdWNjZXNzb3JfKGQpKQogICAgICAgIGlmICghYS5jYWxsKGIsIGQua2V5LCBkLmtleSwgdGhpcykpIHJldHVybiAhMTsKICAgIHJldHVybiAhMAp9Owpqc19jb2xzLlJlZEJsYWNrU2V0LnByb3RvdHlwZS5tYXAgPSBmdW5jdGlvbihhLCBiKSB7CiAgICB2YXIgZCA9IFtdOwogICAgaWYgKHRoaXMuaXNFbXB0eSgpKSByZXR1cm4gZDsKICAgIGZvciAodmFyIGMgPSB0aGlzLm1pbih0aGlzLnJvb3QpOyBjICE9IHRoaXMuc2VudGluZWw7IGMgPSB0aGlzLnN1Y2Nlc3Nvcl8oYykpIGQucHVzaChhLmNhbGwoYiwgYy5rZXksIGMua2V5LCB0aGlzKSk7CiAgICByZXR1cm4gZAp9Owpqc19jb2xzLlJlZEJsYWNrU2V0LnByb3RvdHlwZS5maWx0ZXIgPSBmdW5jdGlvbihhLCBiKSB7CiAgICB2YXIgZCA9IFtdOwogICAgaWYgKHRoaXMuaXNFbXB0eSgpKSByZXR1cm4gZDsKICAgIGZvciAodmFyIGMgPSB0aGlzLm1pbih0aGlzLnJvb3QpOyBjICE9IHRoaXMuc2VudGluZWw7IGMgPSB0aGlzLnN1Y2Nlc3Nvcl8oYykpIGEuY2FsbChiLCBjLmtleSwgYy5rZXksIHRoaXMpICYmIGQucHVzaChjLmtleSk7CiAgICByZXR1cm4gZAp9Owpqc19jb2xzLlJlZEJsYWNrU2V0LnByb3RvdHlwZS5nZXRDb3VudCA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIHRoaXMuc2l6ZQp9Owpqc19jb2xzLlJlZEJsYWNrU2V0LnByb3RvdHlwZS5pc0VtcHR5ID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gMCA9PSB0aGlzLnNpemUKfTsKanNfY29scy5SZWRCbGFja1NldC5wcm90b3R5cGUuaXNTdWJzZXRPZiA9IGZ1bmN0aW9uKGEpIHsKICAgIHZhciBiID0ganNfY29scy5nZXRDb3VudChhKTsKICAgIGlmICh0aGlzLmdldENvdW50KCkgPiBiKSByZXR1cm4gITE7CiAgICBiID0gMDsKICAgIGlmICh0aGlzLmlzRW1wdHkoKSkgcmV0dXJuICEwOwogICAgZm9yICh2YXIgZCA9IHRoaXMubWluKHRoaXMucm9vdCk7IGQgIT0gdGhpcy5zZW50aW5lbDsgZCA9IHRoaXMuc3VjY2Vzc29yXyhkKSkganNfY29scy5jb250YWlucy5jYWxsKGEsIGEsIGQua2V5KSAmJiBiKys7CiAgICByZXR1cm4gYiA9PSB0aGlzLmdldENvdW50KCkKfTsKanNfY29scy5SZWRCbGFja1NldC5wcm90b3R5cGUuaW50ZXJzZWN0aW9uID0gZnVuY3Rpb24oYSkgewogICAgdmFyIGIgPSBuZXcganNfY29scy5SZWRCbGFja1NldCh0aGlzLmNvbXBhcmUpOwogICAgaWYgKHRoaXMuaXNFbXB0eSgpKSByZXR1cm4gYjsKICAgIGZvciAodmFyIGQgPSB0aGlzLm1pbih0aGlzLnJvb3QpOyBkICE9IHRoaXMuc2VudGluZWw7IGQgPSB0aGlzLnN1Y2Nlc3Nvcl8oZCkpIGEuY29udGFpbnMuY2FsbChhLCBkLmtleSwgZC5rZXksIHRoaXMpICYmIGIuaW5zZXJ0KGQua2V5KTsKICAgIHJldHVybiBiCn07CkMzJGpzY29tcCQyOS5SZWRCbGFja1NldCA9IGNsYXNzIGV4dGVuZHMgQzMkanNjb21wJDI5LkRlZmVuZGVkQmFzZSB7CiAgICBjb25zdHJ1Y3RvcihhKSB7CiAgICAgICAgc3VwZXIoKTsKICAgICAgICB0aGlzLl9yYlNldCA9IG5ldyBqc19jb2xzLlJlZEJsYWNrU2V0KGEpOwogICAgICAgIHRoaXMuX2VuYWJsZVF1ZXVlID0gITE7CiAgICAgICAgdGhpcy5fcXVldWVJbnNlcnQgPSBuZXcgU2V0OwogICAgICAgIHRoaXMuX3F1ZXVlUmVtb3ZlID0gbmV3IFNldAogICAgfQogICAgQWRkKGEpIHsKICAgICAgICB0aGlzLl9lbmFibGVRdWV1ZSA/IHRoaXMuX3JiU2V0LmNvbnRhaW5zKGEpID8gdGhpcy5fcXVldWVSZW1vdmUuZGVsZXRlKGEpIDogdGhpcy5fcXVldWVJbnNlcnQuYWRkKGEpIDogdGhpcy5fcmJTZXQuaW5zZXJ0KGEpCiAgICB9CiAgICBSZW1vdmUoYSkgewogICAgICAgIHRoaXMuX2VuYWJsZVF1ZXVlID8gdGhpcy5fcmJTZXQuY29udGFpbnMoYSkgPyB0aGlzLl9xdWV1ZVJlbW92ZS5hZGQoYSkgOiB0aGlzLl9xdWV1ZUluc2VydC5kZWxldGUoYSkgOiB0aGlzLl9yYlNldC5yZW1vdmUoYSkKICAgIH0KICAgIEhhcyhhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2VuYWJsZVF1ZXVlID8gdGhpcy5fcXVldWVJbnNlcnQuaGFzKGEpID8KICAgICAgICAgICAgITAgOiAhdGhpcy5fcXVldWVSZW1vdmUuaGFzKGEpICYmIHRoaXMuX3JiU2V0LmNvbnRhaW5zKGEpIDogdGhpcy5fcmJTZXQuY29udGFpbnMoYSkKICAgIH0KICAgIENsZWFyKCkgewogICAgICAgIHRoaXMuX3JiU2V0LmNsZWFyKCk7CiAgICAgICAgdGhpcy5fcXVldWVJbnNlcnQuY2xlYXIoKTsKICAgICAgICB0aGlzLl9xdWV1ZVJlbW92ZS5jbGVhcigpCiAgICB9CiAgICB0b0FycmF5KCkgewogICAgICAgIGlmICh0aGlzLl9lbmFibGVRdWV1ZSkgdGhyb3cgRXJyb3IoImNhbm5vdCBiZSB1c2VkIGluIHF1ZXVlaW5nIG1vZGUiKTsKICAgICAgICByZXR1cm4gdGhpcy5fcmJTZXQuZ2V0VmFsdWVzKCkKICAgIH0KICAgIEdldFNpemUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3JiU2V0LmdldENvdW50KCkgKyB0aGlzLl9xdWV1ZUluc2VydC5zaXplIC0gdGhpcy5fcXVldWVSZW1vdmUuc2l6ZQogICAgfQogICAgSXNFbXB0eSgpIHsKICAgICAgICByZXR1cm4gMCA9PT0gdGhpcy5HZXRTaXplKCkKICAgIH0KICAgIEZyb250KCkgewogICAgICAgIGlmICh0aGlzLklzRW1wdHkoKSkgdGhyb3cgRXJyb3IoImVtcHR5IHNldCIpOwogICAgICAgIGlmICh0aGlzLl9lbmFibGVRdWV1ZSkgdGhyb3cgRXJyb3IoImNhbm5vdCBiZSB1c2VkIGluIHF1ZXVlaW5nIG1vZGUiKTsKICAgICAgICBjb25zdCBhID0gdGhpcy5fcmJTZXQ7CiAgICAgICAgcmV0dXJuIGEubWluKGEucm9vdCkua2V5CiAgICB9CiAgICBTaGlmdCgpIHsKICAgICAgICBpZiAodGhpcy5Jc0VtcHR5KCkpIHRocm93IEVycm9yKCJlbXB0eSBzZXQiKTsKICAgICAgICBpZiAodGhpcy5fZW5hYmxlUXVldWUpIHRocm93IEVycm9yKCJjYW5ub3QgYmUgdXNlZCBpbiBxdWV1ZWluZyBtb2RlIik7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuRnJvbnQoKTsKICAgICAgICB0aGlzLlJlbW92ZShhKTsKICAgICAgICByZXR1cm4gYQogICAgfQogICAgU2V0UXVldWVpbmdFbmFibGVkKGEpIHsKICAgICAgICBhID0gISFhOwogICAgICAgIGlmICh0aGlzLl9lbmFibGVRdWV1ZSAhPT0gYSAmJiAodGhpcy5fZW5hYmxlUXVldWUgPSBhLCAhYSkpIHsKICAgICAgICAgICAgZm9yIChjb25zdCBiIG9mIHRoaXMuX3F1ZXVlUmVtb3ZlKSB0aGlzLl9yYlNldC5yZW1vdmUoYik7CiAgICAgICAgICAgIHRoaXMuX3F1ZXVlUmVtb3ZlLmNsZWFyKCk7CiAgICAgICAgICAgIGZvciAoY29uc3QgYiBvZiB0aGlzLl9xdWV1ZUluc2VydCkgdGhpcy5fcmJTZXQuaW5zZXJ0KGIpOwogICAgICAgICAgICB0aGlzLl9xdWV1ZUluc2VydC5jbGVhcigpCiAgICAgICAgfQogICAgfQogICAgRm9yRWFjaChhKSB7CiAgICAgICAgdGhpcy5fcmJTZXQuZm9yRWFjaChhKQogICAgfSogdmFsdWVzKCkgewogICAgICAgIGlmICghdGhpcy5Jc0VtcHR5KCkpIHsKICAgICAgICAgICAgdmFyIGEgPQogICAgICAgICAgICAgICAgdGhpcy5fcmJTZXQ7CiAgICAgICAgICAgIGZvciAobGV0IGIgPSBhLm1pbihhLnJvb3QpOyBiICE9IGEuc2VudGluZWw7IGIgPSBhLnN1Y2Nlc3Nvcl8oYikpIHlpZWxkIGIua2V5CiAgICAgICAgfQogICAgfVtTeW1ib2wuaXRlcmF0b3JdKCkgewogICAgICAgIHJldHVybiB0aGlzLnZhbHVlcygpCiAgICB9Cn07CiJ1c2Ugc3RyaWN0IjsKY29uc3QgQzMkanNjb21wJDMwID0gc2VsZi5DMzsKQzMkanNjb21wJDMwLlByb21pc2VUaHJvdHRsZSA9IGNsYXNzIHsKICAgIGNvbnN0cnVjdG9yKGEgPSBDMyRqc2NvbXAkMzAuaGFyZHdhcmVDb25jdXJyZW5jeSkgewogICAgICAgIHRoaXMuX21heFBhcmFsbGVsID0gYTsKICAgICAgICB0aGlzLl9xdWV1ZSA9IFtdOwogICAgICAgIHRoaXMuX2FjdGl2ZUNvdW50ID0gMAogICAgfQogICAgQWRkKGEpIHsKICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKGIsIGQpID0+IHsKICAgICAgICAgICAgdGhpcy5fcXVldWUucHVzaCh7CiAgICAgICAgICAgICAgICBmdW5jOiBhLAogICAgICAgICAgICAgICAgcmVzb2x2ZTogYiwKICAgICAgICAgICAgICAgIHJlamVjdDogZAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdGhpcy5fTWF5YmVTdGFydE5leHQoKQogICAgICAgIH0pCiAgICB9CiAgICBfRmluZEluUXVldWUoYSkgewogICAgICAgIGZvciAobGV0IGIgPSAwLCBkID0gdGhpcy5fcXVldWUubGVuZ3RoOyBiIDwgZDsgKytiKQogICAgICAgICAgICBpZiAodGhpcy5fcXVldWVbYl0uZnVuYyA9PT0gYSkgcmV0dXJuIGI7CiAgICAgICAgcmV0dXJuIC0xCiAgICB9CiAgICBSZW1vdmVBbmRSZXNvbHZlKGEsIGIpIHsKICAgICAgICBhID0gdGhpcy5fRmluZEluUXVldWUoYSk7CiAgICAgICAgaWYgKC0xID09PSBhKSB0aHJvdyBFcnJvcigiY2Fubm90IGZpbmQgcHJvbWlzZSB0byByZXNvbHZlIik7CiAgICAgICAgdGhpcy5fcXVldWVbYV0ucmVzb2x2ZShiKTsKICAgICAgICB0aGlzLl9xdWV1ZS5zcGxpY2UoYSwgMSkKICAgIH0KICAgIFJlbW92ZUFuZFJlamVjdChhLAogICAgICAgIGIpIHsKICAgICAgICBhID0gdGhpcy5fRmluZEluUXVldWUoYSk7CiAgICAgICAgaWYgKC0xID09PSBhKSB0aHJvdyBFcnJvcigiY2Fubm90IGZpbmQgcHJvbWlzZSB0byByZWplY3QiKTsKICAgICAgICB0aGlzLl9xdWV1ZVthXS5yZWplY3QoYik7CiAgICAgICAgdGhpcy5fcXVldWUuc3BsaWNlKGEsIDEpCiAgICB9CiAgICBhc3luYyBfTWF5YmVTdGFydE5leHQoKSB7CiAgICAgICAgaWYgKHRoaXMuX3F1ZXVlLmxlbmd0aCAmJiAhKHRoaXMuX2FjdGl2ZUNvdW50ID49IHRoaXMuX21heFBhcmFsbGVsKSkgewogICAgICAgICAgICB0aGlzLl9hY3RpdmVDb3VudCsrOwogICAgICAgICAgICB2YXIgYSA9IHRoaXMuX3F1ZXVlLnNoaWZ0KCk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBjb25zdCBiID0gYXdhaXQgYS5mdW5jKCk7CiAgICAgICAgICAgICAgICBhLnJlc29sdmUoYikKICAgICAgICAgICAgfSBjYXRjaCAoYikgewogICAgICAgICAgICAgICAgYS5yZWplY3QoYikKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLl9hY3RpdmVDb3VudC0tOwogICAgICAgICAgICB0aGlzLl9NYXliZVN0YXJ0TmV4dCgpCiAgICAgICAgfQogICAgfQogICAgc3RhdGljIGFzeW5jIEJhdGNoKGEsIGIpIHsKICAgICAgICBjb25zdCBkID0gW107CiAgICAgICAgbGV0IGMgPSAhMTsKICAgICAgICBjb25zdCBlID0gYXN5bmMgayA9PiB7CiAgICAgICAgICAgICAgICBmb3IgKDsKICAgICAgICAgICAgICAgICAgICAoayA9IGIucG9wKCkpICYmICFjOykgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBkLnB1c2goYXdhaXQgaygpKQogICAgICAgICAgICAgICAgfSBjYXRjaCAobSkgewogICAgICAgICAgICAgICAgICAgIHRocm93IGMgPSAhMCwgbTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgZyA9IFtdOwogICAgICAgIGZvciAoOyBhLS07KSBnLnB1c2goZSgpKTsKICAgICAgICBhd2FpdCBQcm9taXNlLmFsbChnKTsKICAgICAgICByZXR1cm4gZAogICAgfQp9OwoidXNlIHN0cmljdCI7CmNvbnN0IEMzJGpzY29tcCQzMSA9IHNlbGYuQzM7CkMzJGpzY29tcCQzMS5SYXRlTGltaXRlciA9IGNsYXNzIHsKICAgIGNvbnN0cnVjdG9yKGEsIGIsIGQpIHsKICAgICAgICB0aGlzLl9jYWxsYmFjayA9IGE7CiAgICAgICAgdGhpcy5faW50ZXJ2YWwgPSBiOwogICAgICAgIHRoaXMuX2ludGVydmFsT25CYXR0ZXJ5ID0gZCB8fCAyICogYjsKICAgICAgICB0aGlzLl90aW1lcklkID0gLTE7CiAgICAgICAgdGhpcy5fbGFzdENhbGxUaW1lID0gLUluZmluaXR5OwogICAgICAgIHRoaXMuX3RpbWVyQ2FsbEZ1bmMgPSAoKSA9PiB0aGlzLl9PblRpbWVyKCk7CiAgICAgICAgdGhpcy5fY2FuUnVuSW1tZWRpYXRlID0gdGhpcy5faWdub3JlUmVzZXQgPSAhMTsKICAgICAgICB0aGlzLl9jYWxsYmFja0FyZ3VtZW50cyA9IG51bGwKICAgIH0KICAgIFNldENhblJ1bkltbWVkaWF0ZShhKSB7CiAgICAgICAgdGhpcy5fY2FuUnVuSW1tZWRpYXRlID0gISFhCiAgICB9CiAgICBfR2V0SW50ZXJ2YWwoKSB7CiAgICAgICAgcmV0dXJuICJ1bmRlZmluZWQiICE9PSB0eXBlb2YgQzMkanNjb21wJDMxLkJhdHRlcnkgJiYgQzMkanNjb21wJDMxLkJhdHRlcnkuSXNPbkJhdHRlcnlQb3dlcigpID8gdGhpcy5faW50ZXJ2YWxPbkJhdHRlcnkgOiB0aGlzLl9pbnRlcnZhbAogICAgfQogICAgQ2FsbCguLi5hKSB7CiAgICAgICAgaWYgKC0xID09PSB0aGlzLl90aW1lcklkKSB7CiAgICAgICAgICAgIHRoaXMuX2NhbGxiYWNrQXJndW1lbnRzID0KICAgICAgICAgICAgICAgIGE7CiAgICAgICAgICAgIGEgPSBDMyRqc2NvbXAkMzEuRmFzdEdldERhdGVOb3coKTsKICAgICAgICAgICAgdmFyIGIgPSBhIC0gdGhpcy5fbGFzdENhbGxUaW1lLAogICAgICAgICAgICAgICAgZCA9IHRoaXMuX0dldEludGVydmFsKCk7CiAgICAgICAgICAgIGIgPj0gZCAmJiB0aGlzLl9jYW5SdW5JbW1lZGlhdGUgPyAodGhpcy5fbGFzdENhbGxUaW1lID0gYSwgdGhpcy5fUnVuQ2FsbGJhY2soKSkgOiB0aGlzLl90aW1lcklkID0gc2VsZi5zZXRUaW1lb3V0KHRoaXMuX3RpbWVyQ2FsbEZ1bmMsIE1hdGgubWF4KGQgLSBiLCA0KSkKICAgICAgICB9CiAgICB9CiAgICBfUnVuQ2FsbGJhY2soKSB7CiAgICAgICAgdGhpcy5faWdub3JlUmVzZXQgPSAhMDsKICAgICAgICBjb25zdCBhID0gdGhpcy5fY2FsbGJhY2tBcmd1bWVudHM7CiAgICAgICAgdGhpcy5fY2FsbGJhY2tBcmd1bWVudHMgPSBudWxsOwogICAgICAgIGEgPyB0aGlzLl9jYWxsYmFjayguLi5hKSA6IHRoaXMuX2NhbGxiYWNrKCk7CiAgICAgICAgdGhpcy5faWdub3JlUmVzZXQgPSAhMQogICAgfQogICAgUmVzZXQoKSB7CiAgICAgICAgdGhpcy5faWdub3JlUmVzZXQgfHwgKHRoaXMuX0NhbmNlbFRpbWVyKCksIHRoaXMuX2NhbGxiYWNrQXJndW1lbnRzID0gbnVsbCwgdGhpcy5fbGFzdENhbGxUaW1lID0gQzMkanNjb21wJDMxLkZhc3RHZXREYXRlTm93KCkpCiAgICB9CiAgICBfT25UaW1lcigpIHsKICAgICAgICB0aGlzLl90aW1lcklkID0gLTE7CiAgICAgICAgdGhpcy5fbGFzdENhbGxUaW1lID0gQzMkanNjb21wJDMxLkZhc3RHZXREYXRlTm93KCk7CiAgICAgICAgdGhpcy5fUnVuQ2FsbGJhY2soKQogICAgfQogICAgX0NhbmNlbFRpbWVyKCkgewogICAgICAgIC0xICE9PSB0aGlzLl90aW1lcklkICYmIChzZWxmLmNsZWFyVGltZW91dCh0aGlzLl90aW1lcklkKSwgdGhpcy5fdGltZXJJZCA9IC0xKQogICAgfQogICAgUmVsZWFzZSgpIHsKICAgICAgICB0aGlzLl9DYW5jZWxUaW1lcigpOwogICAgICAgIHRoaXMuX3RpbWVyQ2FsbEZ1bmMgPSB0aGlzLl9jYWxsYmFja0FyZ3VtZW50cyA9IHRoaXMuX2NhbGxiYWNrID0gbnVsbAogICAgfQp9OwoidXNlIHN0cmljdCI7CmNvbnN0IEMzJGpzY29tcCQzMiA9IHNlbGYuQzM7CkMzJGpzY29tcCQzMi5TVkdSYXN0ZXJNYW5hZ2VyID0gY2xhc3MgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgICAgdGhpcy5faW1hZ2VzID0gbmV3IE1hcDsKICAgICAgICB0aGlzLl9hbGxvd05wb3RTdXJmYWNlcyA9ICExOwogICAgICAgIHRoaXMuX3JlZHJhd0NhbGxiYWNrID0gdGhpcy5fcmVsZWFzZVJlc3VsdENhbGxiYWNrID0gdGhpcy5fcmFzdGVyQXRTaXplQ2FsbGJhY2sgPSB0aGlzLl9nZXRCYXNlU2l6ZUNhbGxiYWNrID0gbnVsbAogICAgfQogICAgU2V0TnBvdFN1cmZhY2VBbGxvd2VkKGEpIHsKICAgICAgICB0aGlzLl9hbGxvd05wb3RTdXJmYWNlcyA9ICEhYQogICAgfQogICAgSXNOcG90U3VyZmFjZUFsbG93ZWQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2FsbG93TnBvdFN1cmZhY2VzCiAgICB9CiAgICBTZXRHZXRCYXNlU2l6ZUNhbGxiYWNrKGEpIHsKICAgICAgICB0aGlzLl9nZXRCYXNlU2l6ZUNhbGxiYWNrID0gYQogICAgfQogICAgR2V0QmFzZVNpemUoYSkgewogICAgICAgIGlmICghdGhpcy5fZ2V0QmFzZVNpemVDYWxsYmFjaykgdGhyb3cgRXJyb3IoIm5vIGdldCBiYXNlIHNpemUgY2FsbGJhY2sgc2V0Iik7CiAgICAgICAgcmV0dXJuIHRoaXMuX2dldEJhc2VTaXplQ2FsbGJhY2soYSkKICAgIH0KICAgIFNldFJhc3RlckF0U2l6ZUNhbGxiYWNrKGEpIHsKICAgICAgICB0aGlzLl9yYXN0ZXJBdFNpemVDYWxsYmFjayA9CiAgICAgICAgICAgIGEKICAgIH0KICAgIFJhc3RlckF0U2l6ZShhLCBiLCBkLCBjLCBlLCBnKSB7CiAgICAgICAgaWYgKCF0aGlzLl9yYXN0ZXJBdFNpemVDYWxsYmFjaykgdGhyb3cgRXJyb3IoIm5vIHJhc3RlciBhdCBzaXplIGNhbGxiYWNrIHNldCIpOwogICAgICAgIHJldHVybiB0aGlzLl9yYXN0ZXJBdFNpemVDYWxsYmFjayhhLCBiLCBkLCBjLCBlLCBnKQogICAgfQogICAgU2V0UmVsZWFzZVJlc3VsdENhbGxiYWNrKGEpIHsKICAgICAgICB0aGlzLl9yZWxlYXNlUmVzdWx0Q2FsbGJhY2sgPSBhCiAgICB9CiAgICBSZWxlYXNlUmVzdWx0KGEpIHsKICAgICAgICBpZiAoIXRoaXMuX3JlbGVhc2VSZXN1bHRDYWxsYmFjaykgdGhyb3cgRXJyb3IoIm5vIHJlbGVhc2UgcmVzdWx0IGNhbGxiYWNrIHNldCIpOwogICAgICAgIHRoaXMuX3JlbGVhc2VSZXN1bHRDYWxsYmFjayhhKQogICAgfQogICAgU2V0UmVkcmF3Q2FsbGJhY2soYSkgewogICAgICAgIHRoaXMuX3JlZHJhd0NhbGxiYWNrID0gYQogICAgfQogICAgUmVkcmF3KCkgewogICAgICAgIGlmICghdGhpcy5fcmVkcmF3Q2FsbGJhY2spIHRocm93IEVycm9yKCJubyByZWRyYXcgY2FsbGJhY2sgc2V0Iik7CiAgICAgICAgdGhpcy5fcmVkcmF3Q2FsbGJhY2soKQogICAgfQogICAgQWRkSW1hZ2UoYSkgewogICAgICAgIGxldCBiID0gdGhpcy5faW1hZ2VzLmdldChhKTsKICAgICAgICBiIHx8IChiID0gQzMkanNjb21wJDMyLk5ldyhDMyRqc2NvbXAkMzIuU1ZHUmFzdGVySW1hZ2UsIHRoaXMsIGEpLCB0aGlzLl9pbWFnZXMuc2V0KGEsIGIpKTsKICAgICAgICBiLkluY1JlZmVyZW5jZSgpOwogICAgICAgIHJldHVybiBiCiAgICB9CiAgICBfUmVtb3ZlSW1hZ2UoYSkgewogICAgICAgIHRoaXMuX2ltYWdlcy5kZWxldGUoYS5HZXREYXRhU291cmNlKCkpCiAgICB9CiAgICBPblRleHR1cmVzQ2hhbmdlZCgpIHsKICAgICAgICBmb3IgKGNvbnN0IGEgb2YgdGhpcy5faW1hZ2VzLnZhbHVlcygpKSBhLlJlbGVhc2VSYXN0ZXJpemVkUmVzdWx0KCksIGEuRm9yY2VSYXN0ZXJBZ2FpbigpCiAgICB9Cn07CiJ1c2Ugc3RyaWN0IjsKY29uc3QgQzMkanNjb21wJDMzID0gc2VsZi5DMzsKQzMkanNjb21wJDMzLlNWR1Jhc3RlckltYWdlID0gY2xhc3MgewogICAgY29uc3RydWN0b3IoYSwgYikgewogICAgICAgIHRoaXMuX21hbmFnZXIgPSBhOwogICAgICAgIHRoaXMuX2RhdGFTb3VyY2UgPSBiOwogICAgICAgIHRoaXMuX2Jhc2VIZWlnaHQgPSB0aGlzLl9iYXNlV2lkdGggPSB0aGlzLl9yZWZDb3VudCA9IDA7CiAgICAgICAgdGhpcy5fZ2V0QmFzZVNpemVQcm9taXNlID0gdGhpcy5fbWFuYWdlci5HZXRCYXNlU2l6ZShiKS50aGVuKGQgPT4gewogICAgICAgICAgICB0aGlzLl9iYXNlV2lkdGggPSBkWzBdOwogICAgICAgICAgICB0aGlzLl9iYXNlSGVpZ2h0ID0gZFsxXTsKICAgICAgICAgICAgdGhpcy5fbWFuYWdlci5SZWRyYXcoKQogICAgICAgIH0pLmNhdGNoKGQgPT4gewogICAgICAgICAgICBjb25zb2xlLmVycm9yKCJbU1ZHXSBFcnJvciBsb2FkaW5nIFNWRzogIiwgZCk7CiAgICAgICAgICAgIHRoaXMuX2hhZEVycm9yID0gITA7CiAgICAgICAgICAgIHRoaXMuX21hbmFnZXIuUmVkcmF3KCkKICAgICAgICB9KTsKICAgICAgICB0aGlzLl9yYXN0ZXJJbWFnZUhlaWdodCA9IHRoaXMuX3Jhc3RlckltYWdlV2lkdGggPSB0aGlzLl9yYXN0ZXJTdXJmYWNlSGVpZ2h0ID0gdGhpcy5fcmFzdGVyU3VyZmFjZVdpZHRoID0gMDsKICAgICAgICB0aGlzLl9pc1Jhc3Rlcml6aW5nID0gITE7CiAgICAgICAgdGhpcy5fcmFzdGVyaXplZFJlc3VsdCA9CiAgICAgICAgICAgIG51bGw7CiAgICAgICAgdGhpcy5faGFkRXJyb3IgPSB0aGlzLl9mb3JjZVJhc3RlciA9ICExCiAgICB9CiAgICBSZWxlYXNlKCkgewogICAgICAgIGlmICgwID49IHRoaXMuX3JlZkNvdW50KSB0aHJvdyBFcnJvcigiYWxyZWFkeSByZWxlYXNlZCIpOwogICAgICAgIHRoaXMuX3JlZkNvdW50LS07CiAgICAgICAgMCA9PT0gdGhpcy5fcmVmQ291bnQgJiYgdGhpcy5fUmVsZWFzZSgpCiAgICB9CiAgICBSZWxlYXNlUmFzdGVyaXplZFJlc3VsdCgpIHsKICAgICAgICB0aGlzLl9yYXN0ZXJpemVkUmVzdWx0ICYmICh0aGlzLl9tYW5hZ2VyLlJlbGVhc2VSZXN1bHQodGhpcy5fcmFzdGVyaXplZFJlc3VsdCksIHRoaXMuX3Jhc3Rlcml6ZWRSZXN1bHQgPSBudWxsKQogICAgfQogICAgX1JlbGVhc2UoKSB7CiAgICAgICAgdGhpcy5SZWxlYXNlUmFzdGVyaXplZFJlc3VsdCgpOwogICAgICAgIHRoaXMuX21hbmFnZXIuX1JlbW92ZUltYWdlKHRoaXMpOwogICAgICAgIHRoaXMuX21hbmFnZXIgPSBudWxsCiAgICB9CiAgICBHZXREYXRhU291cmNlKCkgewogICAgICAgIHJldHVybiB0aGlzLl9kYXRhU291cmNlCiAgICB9CiAgICBJbmNSZWZlcmVuY2UoKSB7CiAgICAgICAgdGhpcy5fcmVmQ291bnQrKwogICAgfQogICAgSGFzUmVmZXJlbmNlcygpIHsKICAgICAgICByZXR1cm4gMCA8IHRoaXMuX3JlZkNvdW50CiAgICB9CiAgICBHZXRSYXN0ZXJpemVkUmVzdWx0KCkgewogICAgICAgIHJldHVybiB0aGlzLl9yYXN0ZXJpemVkUmVzdWx0CiAgICB9CiAgICBGb3JjZVJhc3RlckFnYWluKCkgewogICAgICAgIHRoaXMuX2ZvcmNlUmFzdGVyID0gITAKICAgIH0KICAgIGFzeW5jIFN0YXJ0UmFzdGVyRm9yU2l6ZShhLCBiLCBkKSB7CiAgICAgICAgaWYgKDAgIT09IGIgJiYgMCAhPT0gZCAmJiAhdGhpcy5faGFkRXJyb3IgJiYgIXRoaXMuX2lzUmFzdGVyaXppbmcpIHsKICAgICAgICAgICAgdmFyIGMgPSBDMyRqc2NvbXAkMzMubmV4dEhpZ2hlc3RQb3dlck9mVHdvKE1hdGguY2VpbChiKSksCiAgICAgICAgICAgICAgICBlID0gQzMkanNjb21wJDMzLm5leHRIaWdoZXN0UG93ZXJPZlR3byhNYXRoLmNlaWwoZCkpLAogICAgICAgICAgICAgICAgZyA9IE1hdGgubWF4KGMsIGUpOwogICAgICAgICAgICA0MDk2IDwgZyAmJiAoZyA9IDQwOTYgLyBnLCBiICo9IGcsIGQgKj0gZywgYyA9IE1hdGgubWluKE1hdGguY2VpbChjICogZyksIDQwOTYpLCBlID0gTWF0aC5taW4oTWF0aC5jZWlsKGUgKiBnKSwgNDA5NikpOwogICAgICAgICAgICBiIDwgYyAmJiBkIDwgZSAmJiAoZCA9IGIgLyBkLCBjIC8gZSA+IGQgPyAoYiA9IGUgKiBkLCBkID0gZSkgOiAoYiA9IGMsIGQgPSBjIC8gZCkpOwogICAgICAgICAgICB0aGlzLl9tYW5hZ2VyLklzTnBvdFN1cmZhY2VBbGxvd2VkKCkgJiYgKGMgPSBNYXRoLmNlaWwoYiksIGUgPSBNYXRoLmNlaWwoZCkpOwogICAgICAgICAgICBjIDw9IHRoaXMuX3Jhc3RlclN1cmZhY2VXaWR0aCAmJiBlIDw9IHRoaXMuX3Jhc3RlclN1cmZhY2VIZWlnaHQgJiYgIXRoaXMuX2ZvcmNlUmFzdGVyIHx8CiAgICAgICAgICAgICAgICAodGhpcy5faXNSYXN0ZXJpemluZyA9ICEwLCB0aGlzLl9yYXN0ZXJTdXJmYWNlV2lkdGggPSBjLCB0aGlzLl9yYXN0ZXJTdXJmYWNlSGVpZ2h0ID0gZSwgYSA9IGF3YWl0IHRoaXMuX21hbmFnZXIuUmFzdGVyQXRTaXplKHRoaXMuX2RhdGFTb3VyY2UsIGEsIHRoaXMuX3Jhc3RlclN1cmZhY2VXaWR0aCwgdGhpcy5fcmFzdGVyU3VyZmFjZUhlaWdodCwgYiwgZCksIHRoaXMuX21hbmFnZXIgJiYgKHRoaXMuUmVsZWFzZVJhc3Rlcml6ZWRSZXN1bHQoKSwgdGhpcy5fcmFzdGVyaXplZFJlc3VsdCA9IGEsIHRoaXMuX3Jhc3RlckltYWdlV2lkdGggPSBiLCB0aGlzLl9yYXN0ZXJJbWFnZUhlaWdodCA9IGQsIHRoaXMuX2ZvcmNlUmFzdGVyID0gdGhpcy5faXNSYXN0ZXJpemluZyA9ICExLCB0aGlzLl9tYW5hZ2VyLlJlZHJhdygpKSkKICAgICAgICB9CiAgICB9CiAgICBXaGVuQmFzZVNpemVSZWFkeSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZ2V0QmFzZVNpemVQcm9taXNlCiAgICB9CiAgICBHZXRCYXNlV2lkdGgoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2Jhc2VXaWR0aAogICAgfQogICAgR2V0QmFzZUhlaWdodCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fYmFzZUhlaWdodAogICAgfQogICAgR2V0UmFzdGVyV2lkdGgoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3Jhc3RlckltYWdlV2lkdGgKICAgIH0KICAgIEdldFJhc3RlckhlaWdodCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcmFzdGVySW1hZ2VIZWlnaHQKICAgIH0KICAgIEhhZEVycm9yKCkgewogICAgICAgIHJldHVybiB0aGlzLl9oYWRFcnJvcgogICAgfQp9OwoidXNlIHN0cmljdCI7CmNvbnN0IEMzJGpzY29tcCQzNCA9IHNlbGYuQzM7CkMzJGpzY29tcCQzNC5VVEY4X0JPTSA9ICJcdWZlZmYiOwpjb25zdCBOVU1FUklDX0NIQVJTID0gbmV3IFNldChbLi4uIjAxMjM0NTY3ODkiXSk7CkMzJGpzY29tcCQzNC5Jc051bWVyaWNDaGFyID0gZnVuY3Rpb24oYSkgewogICAgcmV0dXJuIE5VTUVSSUNfQ0hBUlMuaGFzKGEpCn07CmNvbnN0IFdISVRFU1BBQ0VfQ0hBUlMgPSBuZXcgU2V0KFsuLi4iIFx0XG5cclx1MDBhMFx1MDA4NVx1MjAwMFx1MjAwMVx1MjAwMlx1MjAwM1x1MjAwNFx1MjAwNVx1MjAwNlx1MjAwN1x1MjAwOFx1MjAwOVx1MjAwYVx1MjAwYlx1MjAyOFx1MjAyOVx1MjAyZlx1MjA1Zlx1MzAwMCJdKTsKQzMkanNjb21wJDM0LklzV2hpdGVzcGFjZUNoYXIgPSBmdW5jdGlvbihhKSB7CiAgICByZXR1cm4gV0hJVEVTUEFDRV9DSEFSUy5oYXMoYSkKfTsKQzMkanNjb21wJDM0LkZpbHRlcldoaXRlc3BhY2UgPSBmdW5jdGlvbihhKSB7CiAgICByZXR1cm4gWy4uLmFdLmZpbHRlcihiID0+ICFDMyRqc2NvbXAkMzQuSXNXaGl0ZXNwYWNlQ2hhcihiKSkuam9pbigiIikKfTsKQzMkanNjb21wJDM0LklzU3RyaW5nQWxsV2hpdGVzcGFjZSA9IGZ1bmN0aW9uKGEpIHsKICAgIGZvciAoY29uc3QgYiBvZiBhKQogICAgICAgIGlmICghQzMkanNjb21wJDM0LklzV2hpdGVzcGFjZUNoYXIoYikpIHJldHVybiAhMTsKICAgIHJldHVybiAhMAp9OwpDMyRqc2NvbXAkMzQuSXNDaGFyQXJyYXlBbGxXaGl0ZXNwYWNlID0gZnVuY3Rpb24oYSkgewogICAgZm9yIChjb25zdCBiIG9mIGEpCiAgICAgICAgaWYgKCFDMyRqc2NvbXAkMzQuSXNXaGl0ZXNwYWNlQ2hhcihiKSkgcmV0dXJuICExOwogICAgcmV0dXJuICEwCn07CkMzJGpzY29tcCQzNC5Jc1VucHJpbnRhYmxlQ2hhciA9IGZ1bmN0aW9uKGEpIHsKICAgIHJldHVybiAxID09PSBhLmxlbmd0aCAmJiAzMiA+IGEuY2hhckNvZGVBdCgwKQp9OwpDMyRqc2NvbXAkMzQuRmlsdGVyVW5wcmludGFibGVDaGFycyA9IGZ1bmN0aW9uKGEpIHsKICAgIHJldHVybiBbLi4uYV0uZmlsdGVyKGIgPT4gIUMzJGpzY29tcCQzNC5Jc1VucHJpbnRhYmxlQ2hhcihiKSkuam9pbigiIikKfTsKY29uc3QgTlVNRVJJQ19TVFJJTkdfQ0hBUlMgPSBuZXcgU2V0KFsuLi4iMDEyMzQ1Njc4OS4rLWUiXSk7CkMzJGpzY29tcCQzNC5Jc1N0cmluZ051bWJlciA9IGZ1bmN0aW9uKGEpIHsKICAgIGEgPSBhLnRyaW0oKTsKICAgIGlmICghYS5sZW5ndGgpIHJldHVybiAhMTsKICAgIGxldCBiID0gYS5jaGFyQXQoMCk7CiAgICBpZiAoIi0iICE9PSBiICYmICFOVU1FUklDX0NIQVJTLmhhcyhiKSkgcmV0dXJuICExOwogICAgZm9yIChsZXQgZCBvZiBhKQogICAgICAgIGlmICghTlVNRVJJQ19TVFJJTkdfQ0hBUlMuaGFzKGQpKSByZXR1cm4gITE7CiAgICByZXR1cm4gITAKfTsKQzMkanNjb21wJDM0LlJlbW92ZVRyYWlsaW5nRGlnaXRzID0gZnVuY3Rpb24oYSkgewogICAgbGV0IGIgPSBhLmxlbmd0aDsKICAgIGZvciAoOyAwIDwgYjspIHsKICAgICAgICBsZXQgZCA9IGEuY2hhckF0KGIgLSAxKTsKICAgICAgICBpZiAoIUMzJGpzY29tcCQzNC5Jc051bWVyaWNDaGFyKGQpKSBicmVhazsKICAgICAgICAtLWIKICAgIH0KICAgIHJldHVybiBhLnN1YnN0cigwLCBiKQp9OwpDMyRqc2NvbXAkMzQuSW5jcmVtZW50TnVtYmVyQXRFbmRPZiA9IGZ1bmN0aW9uKGEpIHsKICAgIGxldCBiID0gQzMkanNjb21wJDM0LlJlbW92ZVRyYWlsaW5nRGlnaXRzKGEpOwogICAgYSA9IChhID0gYS5zdWJzdHIoYi5sZW5ndGgpKSA/IChwYXJzZUludChhLCAxMCkgKyAxKS50b1N0cmluZygpIDogIjIiOwogICAgcmV0dXJuIGIgKyBhCn07CmNvbnN0IEhUTUxfRU5USVRZX01BUCA9IG5ldyBNYXAoWwogICAgWyImIiwgIiZhbXA7Il0sCiAgICBbIjwiLCAiJmx0OyJdLAogICAgWyI+IiwgIiZndDsiXSwKICAgIFsnIicsICImcXVvdDsiXSwKICAgIFsiJyIsICImIzM5OyJdCl0pOwoKZnVuY3Rpb24gbG9va3VwSHRtbEVudGl0eShhKSB7CiAgICByZXR1cm4gSFRNTF9FTlRJVFlfTUFQLmdldChhKQp9CmNvbnN0IEhUTUxfRU5USVRZX1JFR0VYID0gL1smPD4iJ10vZzsKQzMkanNjb21wJDM0LkVzY2FwZUhUTUwgPSBmdW5jdGlvbihhKSB7CiAgICByZXR1cm4gYS5yZXBsYWNlKEhUTUxfRU5USVRZX1JFR0VYLCBsb29rdXBIdG1sRW50aXR5KQp9OwpDMyRqc2NvbXAkMzQuRXNjYXBlSlMgPSBmdW5jdGlvbihhKSB7CiAgICBhID0gQzMkanNjb21wJDM0LlJlcGxhY2VBbGwoYSwgIlxcIiwgIlxcXFwiKTsKICAgIGEgPSBDMyRqc2NvbXAkMzQuUmVwbGFjZUFsbChhLCAnIicsICdcXCInKTsKICAgIGEgPSBDMyRqc2NvbXAkMzQuUmVwbGFjZUFsbChhLCAiXHQiLCAiXFx0Iik7CiAgICBhID0gQzMkanNjb21wJDM0LlJlcGxhY2VBbGwoYSwgIlxyIiwgIiIpOwogICAgcmV0dXJuIEMzJGpzY29tcCQzNC5SZXBsYWNlQWxsKGEsICJcbiIsICJcXG4iKQp9OwpDMyRqc2NvbXAkMzQuRXNjYXBlWE1MID0gZnVuY3Rpb24oYSkgewogICAgYSA9IEMzJGpzY29tcCQzNC5SZXBsYWNlQWxsKGEsICImIiwgIiZhbXA7Iik7CiAgICBhID0gQzMkanNjb21wJDM0LlJlcGxhY2VBbGwoYSwgIjwiLCAiJmx0OyIpOwogICAgYSA9IEMzJGpzY29tcCQzNC5SZXBsYWNlQWxsKGEsICI+IiwgIiZndDsiKTsKICAgIHJldHVybiBDMyRqc2NvbXAkMzQuUmVwbGFjZUFsbChhLCAnIicsICImcXVvdDsiKQp9Owpjb25zdCBFU0NBUEVfUkVHRVggPSAvWy1bXF17fSgpKis/LixcXF4kfCNcc10vZzsKQzMkanNjb21wJDM0LkVzY2FwZVJlZ2V4ID0gZnVuY3Rpb24oYSkgewogICAgcmV0dXJuIGEucmVwbGFjZShFU0NBUEVfUkVHRVgsICJcXCQmIikKfTsKQzMkanNjb21wJDM0LkZpbmRBbGwgPSBmdW5jdGlvbihhLCBiLCBkID0gITEpIHsKICAgIGlmICghYikgcmV0dXJuIFtdOwogICAgZCB8fCAoYSA9IGEudG9Mb3dlckNhc2UoKSwgYiA9IGIudG9Mb3dlckNhc2UoKSk7CiAgICBkID0gYi5sZW5ndGg7CiAgICB2YXIgYyA9IDA7CiAgICBsZXQgZSA9IFtdOwogICAgZm9yICg7IC0gMSA8IChjID0gYS5pbmRleE9mKGIsIGMpKTspIGUucHVzaChjKSwgYyArPSBkOwogICAgcmV0dXJuIGUKfTsKQzMkanNjb21wJDM0LlJlcGxhY2VBbGwgPSBmdW5jdGlvbihhLCBiLCBkKSB7CiAgICByZXR1cm4gYS5yZXBsYWNlQWxsKGIsICgpID0+IGQpCn07CkMzJGpzY29tcCQzNC5SZXBsYWNlQWxsQ2FzZUluc2Vuc2l0aXZlID0gZnVuY3Rpb24oYSwgYiwgZCkgewogICAgcmV0dXJuIGEucmVwbGFjZShuZXcgUmVnRXhwKEMzJGpzY29tcCQzNC5Fc2NhcGVSZWdleChiKSwgImdpIiksICgpID0+IGQpCn07CkMzJGpzY29tcCQzNC5TZXRFbGVtZW50Q29udGVudCA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICJzdHJpbmciID09PSB0eXBlb2YgYiA/IGEudGV4dENvbnRlbnQgPSBiIDogYi5pc1BsYWluVGV4dCgpID8gYS50ZXh0Q29udGVudCA9IGIudG9TdHJpbmcoKSA6IChhLmlubmVySFRNTCA9IGIudG9IVE1MKCksIGIgaW5zdGFuY2VvZiBDMyRqc2NvbXAkMzQuQkJTdHJpbmcgJiYgYi5hdHRhY2hMaW5rSGFuZGxlcnMoYSkpCn07CkMzJGpzY29tcCQzNC5TdHJpbmdMaWtlRXF1YWxzID0gZnVuY3Rpb24oYSwgYikgewogICAgcmV0dXJuIGEgaW5zdGFuY2VvZiBDMyRqc2NvbXAkMzQuSHRtbFN0cmluZyB8fCBhIGluc3RhbmNlb2YgQzMkanNjb21wJDM0LkJCU3RyaW5nID8gYS5lcXVhbHMoYikgOiBiIGluc3RhbmNlb2YgQzMkanNjb21wJDM0Lkh0bWxTdHJpbmcgfHwgYiBpbnN0YW5jZW9mIEMzJGpzY29tcCQzNC5CQlN0cmluZyA/IGIuZXF1YWxzKGEpIDogYSA9PT0gYgp9OwpDMyRqc2NvbXAkMzQuU3RyaW5nU3Vic3RpdHV0ZSA9IGZ1bmN0aW9uKGEsIC4uLmIpIHsKICAgIGxldCBkID0gYTsKICAgIGZvciAobGV0IGMgPSAwLCBlID0gYi5sZW5ndGg7IGMgPCBlOyArK2MpIHsKICAgICAgICBjb25zdCBnID0gYHske2N9fWA7CiAgICAgICAgaWYgKCFhLmluY2x1ZGVzKGcpKSB0aHJvdyBFcnJvcihgbWlzc2luZyBwbGFjZWhvbGRlciAnJHtnfScgaW4gc3RyaW5nIHN1YnN0aXR1dGlvbmApOwogICAgICAgIGQgPSBkLnJlcGxhY2UoZywgYltjXS50b1N0cmluZygpKQogICAgfQogICAgcmV0dXJuIGQKfTsKQzMkanNjb21wJDM0LlN0cmluZ1N1YnN0aXR1dGVBbGxvd01pc3NpbmcgPSBmdW5jdGlvbihhLCAuLi5iKSB7CiAgICBsZXQgZCA9IGEsCiAgICAgICAgYyA9IC0xLAogICAgICAgIGUgPSAtMTsKICAgIGZvciAobGV0IGcgPSAwLCBrID0gYi5sZW5ndGg7IGcgPCBrOyArK2cpIHsKICAgICAgICBjb25zdCBtID0gYHske2d9fWA7CiAgICAgICAgYS5pbmNsdWRlcyhtKSA/IChlID0gZywgZCA9IGQucmVwbGFjZShtLCBiW2ddLnRvU3RyaW5nKCkpKSA6IC0xID09PSBjICYmIChjID0gZykKICAgIH0KICAgIGlmICgwIDw9IGMgJiYgMCA8PSBlICYmIGMgPCBlKSB0aHJvdyBFcnJvcihgbWlzc2luZyBwbGFjZWhvbGRlciAnJHtjfScgaW4gc3RyaW5nIHN1YnN0aXR1dGlvbmApOwogICAgcmV0dXJuIGQKfTsKQzMkanNjb21wJDM0LlN0cmluZ1N1YnN0aXR1dGVNYXAgPSBmdW5jdGlvbihhLCBiKSB7CiAgICBmb3IgKGxldCBbZCwgY10gb2YgT2JqZWN0LmVudHJpZXMoYikpIGEgPSBhLnJlcGxhY2VBbGwoZCwgYy50b1N0cmluZygpKTsKICAgIHJldHVybiBhCn07CkMzJGpzY29tcCQzNC5Tb3J0QVogPSBmdW5jdGlvbihhLCBiKSB7CiAgICByZXR1cm4gYSA+IGIgPyAxIDogYSA8IGIgPyAtMSA6IDAKfTsKQzMkanNjb21wJDM0LlNvcnRBWkNhc2VJbnNlbnNpdGl2ZSA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgIGEgPSBhLnRvTG93ZXJDYXNlKCk7CiAgICBiID0gYi50b0xvd2VyQ2FzZSgpOwogICAgcmV0dXJuIGEgPiBiID8gMSA6IGEgPCBiID8gLTEgOiAwCn07CmxldCBpbnRsU2VnbWVudGVyID0gbnVsbCwKICAgIGdyYXBoZW1lU3BsaXR0ZXIgPSBudWxsOwpzZWxmLkludGwgJiYgc2VsZi5JbnRsLlNlZ21lbnRlciA/IGludGxTZWdtZW50ZXIgPSBuZXcgc2VsZi5JbnRsLlNlZ21lbnRlciA6IGdyYXBoZW1lU3BsaXR0ZXIgPSBuZXcgc2VsZi5HcmFwaGVtZVNwbGl0dGVyOwpDMyRqc2NvbXAkMzQuU3BsaXRHcmFwaGVtZXMgPSBmdW5jdGlvbihhKSB7CiAgICBpZiAoaW50bFNlZ21lbnRlcikgewogICAgICAgIGNvbnN0IGIgPSBbXTsKICAgICAgICBmb3IgKGNvbnN0IGQgb2YgaW50bFNlZ21lbnRlci5zZWdtZW50KGEpKSBiLnB1c2goZC5zZWdtZW50KTsKICAgICAgICByZXR1cm4gYgogICAgfQogICAgcmV0dXJuIGdyYXBoZW1lU3BsaXR0ZXIuc3BsaXRHcmFwaGVtZXMoYSkKfTsKQzMkanNjb21wJDM0Lkl0ZXJhdGVHcmFwaGVtZXMgPSBmdW5jdGlvbiooYSkgewogICAgaWYgKGludGxTZWdtZW50ZXIpCiAgICAgICAgZm9yIChjb25zdCBiIG9mIGludGxTZWdtZW50ZXIuc2VnbWVudChhKSkgeWllbGQgYi5zZWdtZW50OwogICAgZWxzZSB5aWVsZCogZ3JhcGhlbWVTcGxpdHRlci5pdGVyYXRlR3JhcGhlbWVzKGEpCn07CkMzJGpzY29tcCQzNC5Db3VudEdyYXBoZW1lcyA9IGZ1bmN0aW9uKGEpIHsKICAgIGlmIChpbnRsU2VnbWVudGVyKSB7CiAgICAgICAgbGV0IGIgPSAwOwogICAgICAgIGZvciAoY29uc3QgZCBvZiBpbnRsU2VnbWVudGVyLnNlZ21lbnQoYSkpICsrYjsKICAgICAgICByZXR1cm4gYgogICAgfQogICAgcmV0dXJuIGdyYXBoZW1lU3BsaXR0ZXIuY291bnRHcmFwaGVtZXMoYSkKfTsKY29uc3QgTUVHQUJZVEUgPSAxMDQ4NTc2LAogICAgR0lHQUJZVEUgPSAxMDI0ICogTUVHQUJZVEUsCiAgICBURVJBQllURSA9IDEwMjQgKiBHSUdBQllURTsKQzMkanNjb21wJDM0LkZvcm1hdERhdGFTaXplID0gZnVuY3Rpb24oYSwgYikgewogICAgYiA9ICJjb21tb24uIiArIChiID8gImRhdGFSYXRlcyIgOiAiZGF0YVNpemVzIikgKyAiLiI7CiAgICBjb25zdCBkID0gc2VsZi5sYW5nU3ViOwogICAgaWYgKDEwMjQgPiBhKSByZXR1cm4gZChiICsgImJ5dGVzIiwgYSk7CiAgICBpZiAoYSA8IE1FR0FCWVRFKSByZXR1cm4gYSAvPSAxMDI0LCBhID0gMTAgPiBhID8gTWF0aC5yb3VuZCgxMCAqIGEpIC8gMTAgOiBNYXRoLnJvdW5kKGEpLCBkKGIgKyAia2lsb2J5dGVzIiwgYSk7CiAgICBpZiAoYSA8IEdJR0FCWVRFKSByZXR1cm4gYSAvPSBNRUdBQllURSwgYSA9IDEwID4gYSA/IE1hdGgucm91bmQoMTAgKiBhKSAvIDEwIDogTWF0aC5yb3VuZChhKSwgZChiICsgIm1lZ2FieXRlcyIsIGEpOwogICAgaWYgKGEgPCBURVJBQllURSkgcmV0dXJuIGEgLz0gR0lHQUJZVEUsIGEgPSAxMCA+IGEgPyBNYXRoLnJvdW5kKDEwICogYSkgLyAxMCA6IE1hdGgucm91bmQoYSksIGQoYiArICJnaWdhYnl0ZXMiLCBhKTsKICAgIGEgLz0gVEVSQUJZVEU7CiAgICBhID0gMTAgPiBhID8gTWF0aC5yb3VuZCgxMCAqIGEpIC8gMTAgOiBNYXRoLnJvdW5kKGEpOwogICAgcmV0dXJuIGQoYiArICJ0ZXJhYnl0ZXMiLCBhKQp9Owpjb25zdCBERUZBVUxUX0ZPUk1BVFRJTUVfT1BUUyA9IHsKICAgIGFwcHJveGltYXRlOiAhMSwKICAgIGRheXM6ICEwLAogICAgaG91cnM6ICEwLAogICAgbWludXRlczogITAsCiAgICBzZWNvbmRzOiAhMAp9OwpDMyRqc2NvbXAkMzQuRm9ybWF0VGltZSA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgIGIgPSBPYmplY3QuYXNzaWduKHt9LCBERUZBVUxUX0ZPUk1BVFRJTUVfT1BUUywgYik7CiAgICBDMyRqc2NvbXAkMzQuTGFuZy5QdXNoQ29udGV4dCgiY29tbW9uLnRpbWUiKTsKICAgIGNvbnN0IGQgPSBbXSwKICAgICAgICBjID0gc2VsZi5sYW5nLAogICAgICAgIGUgPSBzZWxmLmxhbmdQbHVyYWxTdWI7CiAgICBpZiAoYi5kYXlzKSB7CiAgICAgICAgdmFyIGcgPSBNYXRoLmZsb29yKGEgLyA4NjQwMCk7CiAgICAgICAgMCA8IGcgJiYgKGEgLT0gODY0MDAgKiBnLCBkLnB1c2goZSgiLmRheXMiLCBudWxsLCBnKSkpCiAgICB9CiAgICBiLmhvdXJzICYmIChnID0gTWF0aC5mbG9vcihhIC8gMzYwMCksIDAgPCBnIHx8IGQubGVuZ3RoKSAmJiAoYSAtPSAzNjAwICogZywgZC5wdXNoKGUoIi5ob3VycyIsIG51bGwsIGcpKSk7CiAgICBiLm1pbnV0ZXMgJiYgKGcgPSBNYXRoLmZsb29yKGEgLyA2MCksIDAgPCBnIHx8IGQubGVuZ3RoIHx8ICFiLnNlY29uZHMpICYmIChhIC09IDYwICogZywgZC5wdXNoKGUoIi5taW51dGVzIiwgbnVsbCwgZykpKTsKICAgIGIuc2Vjb25kcyAmJiBkLnB1c2goZSgiLnNlY29uZHMiLCBudWxsLCBNYXRoLmZsb29yKGEgJSA2MCkpKTsKICAgIGEgPSAoYi5hcHByb3hpbWF0ZSA/CiAgICAgICAgYygiLmFwcHJveC1wcmVmaXgiKSA6ICIiKSArIGQuam9pbihjKCIuc2VwYXJhdG9yIikpOwogICAgQzMkanNjb21wJDM0LkxhbmcuUG9wQ29udGV4dCgpOwogICAgcmV0dXJuIGEKfTsKQzMkanNjb21wJDM0Llplcm9QYWQgPSBmdW5jdGlvbihhLCBiKSB7CiAgICBsZXQgZCA9IDAgPiBhID8gIi0iIDogIiI7CiAgICBhID0gTWF0aC5hYnMoYSk7CiAgICBhID0gYS50b1N0cmluZygpOwogICAgYiAtPSBhLmxlbmd0aDsKICAgIGZvciAobGV0IGMgPSAwOyBjIDwgYjsgKytjKSBkICs9ICIwIjsKICAgIHJldHVybiBkICsgYQp9OwpDMyRqc2NvbXAkMzQuU3RyaW5nVG9UaXRsZUNhc2UgPSBmdW5jdGlvbihhKSB7CiAgICByZXR1cm4gYS50b0xvd2VyQ2FzZSgpLnJlcGxhY2UoL1xiXHcvZywgYiA9PiBiLnRvVXBwZXJDYXNlKCkpCn07CkMzJGpzY29tcCQzNC5Db21wYXJlVmVyc2lvblN0cmluZ3MgPSBmdW5jdGlvbihhLCBiKSB7CiAgICBhID0gYS5zcGxpdCgiLiIpLm1hcChkID0+IGQudHJpbSgpKTsKICAgIGIgPSBiLnNwbGl0KCIuIikubWFwKGQgPT4gZC50cmltKCkpOwogICAgQzMkanNjb21wJDM0LnJlc2l6ZUFycmF5KGEsIDQsICIwIik7CiAgICBDMyRqc2NvbXAkMzQucmVzaXplQXJyYXkoYiwgNCwgIjAiKTsKICAgIGEgPSBhLm1hcChkID0+IHBhcnNlSW50KGQsIDEwKSk7CiAgICBiID0gYi5tYXAoZCA9PiBwYXJzZUludChkLCAxMCkpOwogICAgZm9yIChsZXQgZCA9IDA7IDQgPiBkOyArK2QpIHsKICAgICAgICBjb25zdCBjID0gYVtkXSAtIGJbZF07CiAgICAgICAgaWYgKDAgIT09IGMpIHJldHVybiAwID4gYyA/IC0xIDogMQogICAgfQogICAgcmV0dXJuIDAKfTsKQzMkanNjb21wJDM0LkNyZWF0ZUdVSUQgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiAieHh4eHh4eHgteHh4eC00eHh4LXl4eHgteHh4eHh4eHh4eHh4Ii5yZXBsYWNlKC9beHldL2csIGEgPT4gewogICAgICAgIGNvbnN0IGIgPSBNYXRoLmZsb29yKDE2ICogTWF0aC5yYW5kb20oKSk7CiAgICAgICAgcmV0dXJuICgieCIgPT09IGEgPyBiIDogYiAmIDMgfCA4KS50b1N0cmluZygxNikKICAgIH0pCn07CkMzJGpzY29tcCQzNC5TdHJpbmdIYW1taW5nRGlzdGFuY2UgPSBmdW5jdGlvbihhLCBiKSB7CiAgICBpZiAoYS5sZW5ndGggIT09IGIubGVuZ3RoKSB0aHJvdyBFcnJvcigic3RyaW5ncyBtdXN0IGJlIHNhbWUgbGVuZ3RoIik7CiAgICBsZXQgZCA9IDA7CiAgICBmb3IgKGxldCBjID0gMCwgZSA9IGEubGVuZ3RoOyBjIDwgZTsgKytjKSBhLmNoYXJBdChjKSAhPT0gYi5jaGFyQXQoYykgJiYgKytkOwogICAgcmV0dXJuIGQKfTsKQzMkanNjb21wJDM0LlN0cmluZ0xldmVuc2h0ZWluRGlzdGFuY2UgPSBmdW5jdGlvbihhLCBiKSB7CiAgICBpZiAoMCA9PT0gYS5sZW5ndGgpIHJldHVybiBiLmxlbmd0aDsKICAgIGlmICgwID09PSBiLmxlbmd0aCkgcmV0dXJuIGEubGVuZ3RoOwogICAgbGV0IGQsIGMsIGUsIGc7CiAgICBpZiAoYS5sZW5ndGggPiBiLmxlbmd0aCkgewogICAgICAgIHZhciBrID0gYTsKICAgICAgICBhID0gYjsKICAgICAgICBiID0gawogICAgfQogICAgZyA9IEFycmF5KGEubGVuZ3RoICsgMSk7CiAgICBmb3IgKGsgPSAwOyBrIDw9IGEubGVuZ3RoOyBrKyspIGdba10gPSBrOwogICAgZm9yIChrID0gMTsgayA8PSBiLmxlbmd0aDsgaysrKSB7CiAgICAgICAgYyA9IGs7CiAgICAgICAgZm9yIChkID0gMTsgZCA8PSBhLmxlbmd0aDsgZCsrKSBlID0gYltrIC0gMV0gPT09IGFbZCAtIDFdID8gZ1tkIC0gMV0gOiBNYXRoLm1pbihnW2QgLSAxXSArIDEsIE1hdGgubWluKGMgKyAxLCBnW2RdICsgMSkpLCBnW2QgLSAxXSA9IGMsIGMgPSBlOwogICAgICAgIGdbYS5sZW5ndGhdID0gYwogICAgfQogICAgcmV0dXJuIGdbYS5sZW5ndGhdCn07CiJ1c2Ugc3RyaWN0IjsKY29uc3QgQzMkanNjb21wJDM1ID0gc2VsZi5DMywKICAgIEJCX0NPREVfTUFQID0gbmV3IE1hcChbCiAgICAgICAgWyJiIiwgInN0cm9uZyJdLAogICAgICAgIFsiaSIsICJlbSJdLAogICAgICAgIFsicyIsICJzIl0sCiAgICAgICAgWyJ1IiwgInUiXSwKICAgICAgICBbInN1YiIsICJzdWIiXSwKICAgICAgICBbInN1cCIsICJzdXAiXSwKICAgICAgICBbInNtYWxsIiwgInNtYWxsIl0sCiAgICAgICAgWyJtYXJrIiwgIm1hcmsiXSwKICAgICAgICBbImNvZGUiLCAiY29kZSJdLAogICAgICAgIFsiYTEiLCAiYSJdLAogICAgICAgIFsiYTIiLCAiYSJdLAogICAgICAgIFsiYTMiLCAiYSJdLAogICAgICAgIFsiYTQiLCAiYSJdLAogICAgICAgIFsiYTUiLCAiYSJdLAogICAgICAgIFsiYTYiLCAiYSJdLAogICAgICAgIFsiYTciLCAiYSJdLAogICAgICAgIFsiYTgiLCAiYSJdLAogICAgICAgIFsiYTkiLCAiYSJdLAogICAgICAgIFsidGlwMSIsICJhYmJyIl0sCiAgICAgICAgWyJ0aXAyIiwgImFiYnIiXSwKICAgICAgICBbInRpcDMiLCAiYWJiciJdLAogICAgICAgIFsidGlwNCIsICJhYmJyIl0sCiAgICAgICAgWyJ0aXA1IiwgImFiYnIiXSwKICAgICAgICBbInRpcDYiLCAiYWJiciJdLAogICAgICAgIFsidGlwNyIsICJhYmJyIl0sCiAgICAgICAgWyJ0aXA4IiwgImFiYnIiXSwKICAgICAgICBbInRpcDkiLCAiYWJiciJdLAogICAgICAgIFsiYmFkIiwgWyJzcGFuIiwgImJiQ29kZUJhZCJdXSwKICAgICAgICBbImdvb2QiLCBbInNwYW4iLCAiYmJDb2RlR29vZCJdXSwKICAgICAgICBbImluZm8iLCBbInNwYW4iLCAiYmJDb2RlSW5mbyJdXSwKICAgICAgICBbImgxIiwgWyJzcGFuIiwgImJiQ29kZUgxIl1dLAogICAgICAgIFsiaDIiLCBbInNwYW4iLCAiYmJDb2RlSDIiXV0sCiAgICAgICAgWyJoMyIsIFsic3BhbiIsICJiYkNvZGVIMyJdXSwKICAgICAgICBbImg0IiwgWyJzcGFuIiwgImJiQ29kZUg0Il1dLAogICAgICAgIFsiaXRlbSIsIFsic3BhbiIsICJiYkNvZGVJdGVtIl1dCiAgICBdKSwKICAgIEJCUkVHRVggPSAvXFsoXC8/KShbYS16QS1aMC05XSspXF0vZywKICAgIENVU1RPTV9CQlJFR0VYID0gL1xbKFwvPykoW15cW1xuXSo/KVxdL2c7CmxldCBsaW5rQWN0aW9ucyA9IG51bGwsCiAgICB0aXBMaXN0ID0gbnVsbCwKICAgIGNsYXNzSW5kZXggPSAwOwoKZnVuY3Rpb24gYmJUb0h0bWxSZXBsYWNlckZ1bmMoYSwgYiwgZCkgewogICAgdmFyIGMgPSBCQl9DT0RFX01BUC5nZXQoZCk7CiAgICBpZiAoYykgewogICAgICAgIGlmICgic3RyaW5nIiA9PT0gdHlwZW9mIGMpIHsKICAgICAgICAgICAgaWYgKCJhIiA9PT0gYyAmJiAwID09PSBsaW5rQWN0aW9ucy5sZW5ndGggfHwgImFiYnIiID09PSBjICYmIDAgPT09IHRpcExpc3QubGVuZ3RoKSByZXR1cm4gYTsKICAgICAgICAgICAgaWYgKCJhIiAhPT0gYyB8fCBiKSB7CiAgICAgICAgICAgICAgICBpZiAoImFiYnIiICE9PSBjIHx8IGIpIHJldHVybiAiPCIgKyBiICsgYyArICI+IjsKICAgICAgICAgICAgICAgIGIgPSBwYXJzZUludChkLnN1YnN0cmluZygzKSwgMTApIC0gMTsKICAgICAgICAgICAgICAgIGlmICgwID4gYiB8fCBiID49IHRpcExpc3QubGVuZ3RoKSB0aHJvdyBFcnJvcigiaW52YWxpZCBiYmNvZGUgdGlwIHN1YnN0aXR1dGlvbiIpOwogICAgICAgICAgICAgICAgYiA9IHRpcExpc3RbYl07CiAgICAgICAgICAgICAgICBjID0gIiI7CiAgICAgICAgICAgICAgICAic3RyaW5nIiA9PT0gdHlwZW9mIGIgPyBjID0gYiA6ICJmdW5jdGlvbiIgPT09IHR5cGVvZiBiICYmIChjID0gYigpKTsKICAgICAgICAgICAgICAgIGlmICgic3RyaW5nIiAhPT0gdHlwZW9mIGMpIHRocm93IG5ldyBUeXBlRXJyb3IoImludmFsaWQgYmJjb2RlIHRpcCIpOwogICAgICAgICAgICAgICAgcmV0dXJuIGA8YWJiciB0aXRsZT0iJHtDMyRqc2NvbXAkMzUuUmVwbGFjZUFsbChjLAonIicsIiZxdW90OyIpfSI+YAogICAgICAgICAgICB9CiAgICAgICAgICAgIGIgPSBwYXJzZUludChkLnN1YnN0cmluZygxKSwgMTApIC0gMTsKICAgICAgICAgICAgaWYgKDAgPiBiIHx8IGIgPj0gbGlua0FjdGlvbnMubGVuZ3RoKSB0aHJvdyBFcnJvcigiaW52YWxpZCBiYmNvZGUgbGluayBzdWJzdGl0dXRpb24iKTsKICAgICAgICAgICAgYyA9IGxpbmtBY3Rpb25zW2JdOwogICAgICAgICAgICBpZiAoInN0cmluZyIgPT09IHR5cGVvZiBjKSByZXR1cm4gYDxhIGhyZWY9IiR7bGlua0FjdGlvbnNbYl19Ij5gOwogICAgICAgICAgICBpZiAoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGMpIHJldHVybiBgPGEgY2xhc3M9ImJibGluayR7Yn0iPmA7CiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoImludmFsaWQgYmJjb2RlIGxpbmsgYWN0aW9uIik7CiAgICAgICAgfQogICAgICAgIGlmIChBcnJheS5pc0FycmF5KGMpKSByZXR1cm4gYSA9IGNbMF0sIGMgPSBjWzFdLCBiID8gIjwvIiArIGEgKyAiPiIgOiBgPCR7YX0gY2xhc3M9IiR7Y30iPmAKICAgIH0gZWxzZSByZXR1cm4gImNsYXNzIiA9PT0gZCA/IGIgPyAiPC9zcGFuPiIgOiBgPHNwYW4gY2xhc3M9ImJiY2xhc3Mke2NsYXNzSW5kZXgrK30iPmAgOiBhCn0KY29uc3QgTElORUJSRUFLX1JFR0VYID0gL1xuL2c7CkMzJGpzY29tcCQzNS5CQlN0cmluZyA9IGNsYXNzIHsKICAgIGNvbnN0cnVjdG9yKGEsIGIpIHsKICAgICAgICB0aGlzLl9iYnN0ciA9IGIgJiYgYi5ub0VzY2FwZSA/IGEgOiBDMyRqc2NvbXAkMzUuRXNjYXBlSFRNTChhKTsKICAgICAgICB0aGlzLl9odG1sc3RyID0gIiI7CiAgICAgICAgdGhpcy5fY29udmVydExpbmVCcmVha3MgPSAhMTsKICAgICAgICB0aGlzLl9saW5rQWN0aW9ucyA9IFtdOwogICAgICAgIHRoaXMuX3RpcExpc3QgPSBbXTsKICAgICAgICBpZiAoYikgewogICAgICAgICAgICB0aGlzLl9jb252ZXJ0TGluZUJyZWFrcyA9ICEhYi5jb252ZXJ0TGluZUJyZWFrczsKICAgICAgICAgICAgaWYgKGIubGlua3MpIHsKICAgICAgICAgICAgICAgIGlmICg5IDwgYi5saW5rcy5sZW5ndGgpIHRocm93IEVycm9yKCJ0b28gbWFueSBsaW5rcyIpOwogICAgICAgICAgICAgICAgdGhpcy5fbGlua0FjdGlvbnMgPSBiLmxpbmtzCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGIudGlwcykgewogICAgICAgICAgICAgICAgaWYgKDkgPCBiLnRpcHMubGVuZ3RoKSB0aHJvdyBFcnJvcigidG9vIG1hbnkgdGlwcyIpOwogICAgICAgICAgICAgICAgdGhpcy5fdGlwTGlzdCA9IGIudGlwcwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHRoaXMuX2hhc0FueUJCdGFncyA9IHRoaXMuX2Jic3RyLmluY2x1ZGVzKCJbIik7CiAgICAgICAgdGhpcy5fbmVlZHNMaW5lQnJlYWtDb252ZXJzaW9uID0gdGhpcy5fY29udmVydExpbmVCcmVha3MgJiYKICAgICAgICAgICAgdGhpcy5fYmJzdHIuaW5jbHVkZXMoIlxuIik7CiAgICAgICAgdGhpcy5faXNQbGFpbiA9ICF0aGlzLl9oYXNBbnlCQnRhZ3MgJiYgIXRoaXMuX25lZWRzTGluZUJyZWFrQ29udmVyc2lvbiAmJiAhdGhpcy5fYmJzdHIuaW5jbHVkZXMoIiYiKTsKICAgICAgICB0aGlzLl9oYXNQYXJzZWRGcmFnbWVudHMgPSAhMTsKICAgICAgICB0aGlzLl9mcmFnbWVudHMgPSBbXQogICAgfQogICAgdG9TdHJpbmcoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2Jic3RyCiAgICB9CiAgICB2YWx1ZU9mKCkgewogICAgICAgIHJldHVybiB0aGlzLl9iYnN0cgogICAgfQogICAgaXNQbGFpblRleHQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2lzUGxhaW4KICAgIH0KICAgIHRvUGxhaW5UZXh0KCkgewogICAgICAgIHJldHVybiB0aGlzLl9oYXNBbnlCQnRhZ3MgPyB0aGlzLl9iYnN0ci5yZXBsYWNlKEJCUkVHRVgsICIiKSA6IHRoaXMuX2Jic3RyCiAgICB9CiAgICB0b0hUTUwoKSB7CiAgICAgICAgaWYgKHRoaXMuX2lzUGxhaW4pIHJldHVybiB0aGlzLl9iYnN0cjsKICAgICAgICBpZiAoIXRoaXMuX2h0bWxzdHIgJiYgdGhpcy5fYmJzdHIpIHsKICAgICAgICAgICAgbGV0IGEgPSB0aGlzLl9iYnN0cjsKICAgICAgICAgICAgdGhpcy5faGFzQW55QkJ0YWdzICYmIChjbGFzc0luZGV4ID0gMCwgbGlua0FjdGlvbnMgPSB0aGlzLl9saW5rQWN0aW9ucywKICAgICAgICAgICAgICAgIHRpcExpc3QgPSB0aGlzLl90aXBMaXN0LCBhID0gYS5yZXBsYWNlKEJCUkVHRVgsIGJiVG9IdG1sUmVwbGFjZXJGdW5jKSwgdGlwTGlzdCA9IGxpbmtBY3Rpb25zID0gbnVsbCk7CiAgICAgICAgICAgIHRoaXMuX25lZWRzTGluZUJyZWFrQ29udmVyc2lvbiAmJiAoYSA9IGEucmVwbGFjZShMSU5FQlJFQUtfUkVHRVgsICI8YnI+IikpOwogICAgICAgICAgICB0aGlzLl9odG1sc3RyID0gYQogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpcy5faHRtbHN0cgogICAgfQogICAgYXR0YWNoTGlua0hhbmRsZXJzKGEpIHsKICAgICAgICBpZiAodGhpcy5fbGlua0FjdGlvbnMubGVuZ3RoKQogICAgICAgICAgICBmb3IgKGxldCBiID0gMCwgZCA9IHRoaXMuX2xpbmtBY3Rpb25zLmxlbmd0aDsgYiA8IGQ7ICsrYikgewogICAgICAgICAgICAgICAgY29uc3QgYyA9IHRoaXMuX2xpbmtBY3Rpb25zW2JdOwogICAgICAgICAgICAgICAgaWYgKCJmdW5jdGlvbiIgIT09IHR5cGVvZiBjKSBjb250aW51ZTsKICAgICAgICAgICAgICAgIGNvbnN0IGUgPSBhLnF1ZXJ5U2VsZWN0b3IoIi5iYmxpbmsiICsgYik7CiAgICAgICAgICAgICAgICBpZiAoIWUpIHRocm93IEVycm9yKCJ1bmFibGUgdG8gYXR0YWNoIEJCU3RyaW5nIGxpbmsgaGFuZGxlciIpOwogICAgICAgICAgICAgICAgZS5vbmNsaWNrID0gYwogICAgICAgICAgICB9CiAgICB9CiAgICBlcXVhbHMoYSkgewogICAgICAgIHJldHVybiBhIGluc3RhbmNlb2YgQzMkanNjb21wJDM1Lkh0bWxTdHJpbmcgPwogICAgICAgICAgICB0aGlzLnRvSFRNTCgpID09PSBhLnRvSFRNTCgpIDogYSBpbnN0YW5jZW9mIEMzJGpzY29tcCQzNS5CQlN0cmluZyA/IHRoaXMuX2Jic3RyID09PSBhLl9iYnN0ciA6IHRoaXMuX2Jic3RyID09PSBhCiAgICB9CiAgICB0b0ZyYWdtZW50TGlzdCgpIHsKICAgICAgICBpZiAodGhpcy5faGFzUGFyc2VkRnJhZ21lbnRzKSByZXR1cm4gdGhpcy5fZnJhZ21lbnRzOwogICAgICAgIGNvbnN0IGEgPSB0aGlzLl9iYnN0ciwKICAgICAgICAgICAgYiA9IFtdOwogICAgICAgIGxldCBkID0gQ1VTVE9NX0JCUkVHRVgubGFzdEluZGV4ID0gMDsKICAgICAgICBmb3IgKHZhciBjOyBudWxsICE9PSAoYyA9IENVU1RPTV9CQlJFR0VYLmV4ZWMoYSkpOykgewogICAgICAgICAgICB2YXIgZSA9IGMuaW5kZXg7CiAgICAgICAgICAgIGlmICgwIDwgZSAmJiAiXFwiID09PSBhLmNoYXJBdChlIC0gMSkpIGNvbnRpbnVlOwogICAgICAgICAgICB2YXIgZyA9IGNbMF0sCiAgICAgICAgICAgICAgICBrID0gY1sxXTsKICAgICAgICAgICAgYyA9IGNbMl07CiAgICAgICAgICAgIGNvbnN0IG0gPSBhLnN1YnN0cmluZyhkLCBlKTsKICAgICAgICAgICAgZCA9IGUgKyBnLmxlbmd0aDsKICAgICAgICAgICAgbSAmJiB0aGlzLl9mcmFnbWVudHMucHVzaCh7CiAgICAgICAgICAgICAgICB0ZXh0OiBtLAogICAgICAgICAgICAgICAgc3R5bGVzOiBiLnNsaWNlKDApCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBpZiAoYykKICAgICAgICAgICAgICAgIGlmIChrKQogICAgICAgICAgICAgICAgICAgIGZvciAoYyA9IGMudG9Mb3dlckNhc2UoKSwgZSA9IGIubGVuZ3RoIC0gMTsgMCA8PSBlOyAtLWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJbZV0udGFnID09PQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYi5zcGxpY2UoZSwgMSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGUgPSBjLCBnID0gbnVsbCwgayA9IGMuaW5kZXhPZigiPSIpLCAtMSAhPT0gayA/IChlID0gYy5zdWJzdHJpbmcoMCwgaykudG9Mb3dlckNhc2UoKSwgZyA9IGMuc3Vic3RyaW5nKGsgKyAxKSkgOiBlID0gZS50b0xvd2VyQ2FzZSgpLCBiLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICB0YWc6IGUsCiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtOiBnCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICB9CiAgICAgICAgZCA8IGEubGVuZ3RoICYmIHRoaXMuX2ZyYWdtZW50cy5wdXNoKHsKICAgICAgICAgICAgdGV4dDogYS5zdWJzdHJpbmcoZCksCiAgICAgICAgICAgIHN0eWxlczogYi5zbGljZSgwKQogICAgICAgIH0pOwogICAgICAgIGZvciAoY29uc3QgbSBvZiB0aGlzLl9mcmFnbWVudHMpIG0udGV4dCA9IHRoaXMuX1Byb2Nlc3NCQkNvZGVFc2NhcGVTZXF1ZW5jZXMobS50ZXh0KTsKICAgICAgICB0aGlzLl9oYXNQYXJzZWRGcmFnbWVudHMgPSAhMDsKICAgICAgICByZXR1cm4gdGhpcy5fZnJhZ21lbnRzCiAgICB9CiAgICBfUHJvY2Vzc0JCQ29kZUVzY2FwZVNlcXVlbmNlcyhhKSB7CiAgICAgICAgYSA9IEMzJGpzY29tcCQzNS5SZXBsYWNlQWxsKGEsICJcXFsiLCAiWyIpOwogICAgICAgIHJldHVybiBDMyRqc2NvbXAkMzUuUmVwbGFjZUFsbChhLCAiXFxcXCIsICJcXCIpCiAgICB9CiAgICBzdGF0aWMgU3RyaXBUYWdzKGEpIHsKICAgICAgICByZXR1cm4gQzMkanNjb21wJDM1Lk5ldyhDMyRqc2NvbXAkMzUuQkJTdHJpbmcsCiAgICAgICAgICAgIGEsIHsKICAgICAgICAgICAgICAgIG5vRXNjYXBlOiAhMAogICAgICAgICAgICB9KS50b1BsYWluVGV4dCgpCiAgICB9CiAgICBzdGF0aWMgU3RyaXBBbnlUYWdzKGEpIHsKICAgICAgICByZXR1cm4gYS5yZXBsYWNlKENVU1RPTV9CQlJFR0VYLCAiIikKICAgIH0KfTsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkMzYgPSBzZWxmLkMzOwoKZnVuY3Rpb24gSXNXb3JkQnJlYWtXaGl0ZVNwYWNlKGEpIHsKICAgIHJldHVybiAiXHUwMGEwIiA9PT0gYSB8fCAiXHUyMDJmIiA9PT0gYSA/ICExIDogQzMkanNjb21wJDM2LklzV2hpdGVzcGFjZUNoYXIoYSkKfQoKZnVuY3Rpb24gV29yZEJyZWFrVHJpbUVuZChhKSB7CiAgICBmb3IgKDsgMCA8IGEubGVuZ3RoICYmIElzV29yZEJyZWFrV2hpdGVTcGFjZShhLmF0KC0xKSk7KSBhLnBvcCgpCn0KCmZ1bmN0aW9uIElzTmV3bGluZShhKSB7CiAgICByZXR1cm4gIlxuIiA9PT0gYSB8fCAiXHJcbiIgPT09IGEKfQpDMyRqc2NvbXAkMzYuV29yZFdyYXAgPSBjbGFzcyB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgICB0aGlzLl9saW5lcyA9IFtdCiAgICB9CiAgICBHZXRMaW5lcygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fbGluZXMKICAgIH0KICAgIEdldExpbmVDb3VudCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fbGluZXMubGVuZ3RoCiAgICB9CiAgICBfTWVhc3VyZUxpbmUoYSwgYikgewogICAgICAgIGxldCBkID0gMCwKICAgICAgICAgICAgYyA9IDAsCiAgICAgICAgICAgIGUgPSAwLAogICAgICAgICAgICBnID0gMCwKICAgICAgICAgICAgayA9IDA7CiAgICAgICAgZm9yIChjb25zdCBtIG9mIGEpIC0gMSA9PT0gbS53aWR0aCAmJiAoYSA9IGIobS5jaEFyciwgbS5zdHlsZXMpLCBtLndpZHRoID0gYS53aWR0aCwgbS5oZWlnaHQgPSBhLmhlaWdodCwgbS5mb250Qm91bmRpbmdCb3hBc2NlbnQgPSBhLmZvbnRCb3VuZGluZ0JveEFzY2VudCB8fCAwLCBtLmZvbnRCb3VuZGluZ0JveERlc2NlbnQgPSBhLmZvbnRCb3VuZGluZ0JveERlc2NlbnQgfHwgMCwgbS50b3BUb0FscGhhYmV0aWNEaXN0YW5jZSA9IGEudG9wVG9BbHBoYWJldGljRGlzdGFuY2UgfHwgMCksIGQgKz0gbS53aWR0aCwgYyA9IE1hdGgubWF4KGMsIG0uaGVpZ2h0KSwgZSA9IE1hdGgubWF4KGUsIG0uZm9udEJvdW5kaW5nQm94QXNjZW50KSwgZyA9IE1hdGgubWF4KGcsCiAgICAgICAgICAgIG0uZm9udEJvdW5kaW5nQm94RGVzY2VudCksIGsgPSBNYXRoLm1heChrLCBtLnRvcFRvQWxwaGFiZXRpY0Rpc3RhbmNlKTsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICB3aWR0aDogZCwKICAgICAgICAgICAgaGVpZ2h0OiBjLAogICAgICAgICAgICBmb250Qm91bmRpbmdCb3hBc2NlbnQ6IGUsCiAgICAgICAgICAgIGZvbnRCb3VuZGluZ0JveERlc2NlbnQ6IGcsCiAgICAgICAgICAgIHRvcFRvQWxwaGFiZXRpY0Rpc3RhbmNlOiBrCiAgICAgICAgfQogICAgfQogICAgX0FkZExpbmUoYSwgYiwgZCwgYywgZSwgZykgewogICAgICAgIHRoaXMuX2xpbmVzLnB1c2goewogICAgICAgICAgICBmcmFnbWVudHM6IGEsCiAgICAgICAgICAgIHdpZHRoOiBiLAogICAgICAgICAgICBoZWlnaHQ6IGQsCiAgICAgICAgICAgIGZvbnRCb3VuZGluZ0JveEFzY2VudDogYywKICAgICAgICAgICAgZm9udEJvdW5kaW5nQm94RGVzY2VudDogZSwKICAgICAgICAgICAgdG9wVG9BbHBoYWJldGljRGlzdGFuY2U6IGcKICAgICAgICB9KQogICAgfQogICAgV29yZFdyYXAoYSwgYiwgZCwgYywgZSkgewogICAgICAgICJzdHJpbmciID09PSB0eXBlb2YgYSAmJiAoYSA9IFt7CiAgICAgICAgICAgIHRleHQ6IGEsCiAgICAgICAgICAgIHN0eWxlczogW10KICAgICAgICB9XSk7CiAgICAgICAgQzMkanNjb21wJDM2LmNsZWFyQXJyYXkodGhpcy5fbGluZXMpOwogICAgICAgIGlmICghKCFhLmxlbmd0aCB8fCAxID09PSBhLmxlbmd0aCAmJiAhYVswXS50ZXh0Lmxlbmd0aCB8fCAyID4gZCkpIHsKICAgICAgICAgICAgYSA9IGEubWFwKGsgPT4gKHsKICAgICAgICAgICAgICAgIGNoQXJyOiBDMyRqc2NvbXAkMzYuU3BsaXRHcmFwaGVtZXMoay50ZXh0KSwKICAgICAgICAgICAgICAgIHN0eWxlczogay5zdHlsZXMKICAgICAgICAgICAgfSkpOwogICAgICAgICAgICBpZiAoMSA9PT0gYS5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIHZhciBnID0gYVswXTsKICAgICAgICAgICAgICAgIGNvbnN0IGsgPSBnLmNoQXJyOwogICAgICAgICAgICAgICAgZyA9IGcuc3R5bGVzOwogICAgICAgICAgICAgICAgaWYgKDEwMCA+PSBrLmxlbmd0aCAmJiAhay5pbmNsdWRlcygiXG4iKSkgewogICAgICAgICAgICAgICAgICAgIGxldCB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiBtLAogICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IG4sCiAgICAgICAgICAgICAgICAgICAgICAgIGZvbnRCb3VuZGluZ0JveEFzY2VudDogcSwKICAgICAgICAgICAgICAgICAgICAgICAgZm9udEJvdW5kaW5nQm94RGVzY2VudDogdSwKICAgICAgICAgICAgICAgICAgICAgICAgdG9wVG9BbHBoYWJldGljRGlzdGFuY2U6IHcKICAgICAgICAgICAgICAgICAgICB9ID0gYihrLCBnKTsKICAgICAgICAgICAgICAgICAgICBtICs9IGU7CiAgICAgICAgICAgICAgICAgICAgcSA9IHEgfHwgMDsKICAgICAgICAgICAgICAgICAgICB1ID0gdSB8fCAwOwogICAgICAgICAgICAgICAgICAgIHcgPSB3IHx8IDA7CiAgICAgICAgICAgICAgICAgICAgaWYgKG0gPD0gZCkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9BZGRMaW5lKFt7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaEFycjogaywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlczogZywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiBtLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBuLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9udEJvdW5kaW5nQm94QXNjZW50OiBxLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9udEJvdW5kaW5nQm94RGVzY2VudDogdSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcFRvQWxwaGFiZXRpY0Rpc3RhbmNlOiB3CiAgICAgICAgICAgICAgICAgICAgICAgIH1dLCBtLCBuLCBxLCB1LCB3KTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgid29yZCIgPT09IGMpIGMgPSB0aGlzLl9Ub2tlbmlzZVdvcmRzKGEpOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGMgPSBbXTsKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgayBvZiBhKSBDMyRqc2NvbXAkMzYuYXBwZW5kQXJyYXkoYywgay5jaEFyci5tYXAobSA9PiBbewogICAgICAgICAgICAgICAgICAgIGNoQXJyOiBbbV0sCiAgICAgICAgICAgICAgICAgICAgc3R5bGVzOiBrLnN0eWxlcwogICAgICAgICAgICAgICAgfV0pKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuX1dyYXBUZXh0KGMsIGIsIGQsIGUpCiAgICAgICAgfQogICAgfQogICAgX1Rva2VuaXNlV29yZHMoYSkgewogICAgICAgIGNvbnN0IGIgPSBbXTsKICAgICAgICBsZXQgZCA9IFtdLAogICAgICAgICAgICBjID0gITE7CiAgICAgICAgZm9yIChjb25zdCBnIG9mIGEpIHsKICAgICAgICAgICAgdmFyIGUgPSBnLmNoQXJyOwogICAgICAgICAgICBhID0gZy5zdHlsZXM7CiAgICAgICAgICAgIGZvciAoY29uc3QgayBvZiBlKSBJc05ld2xpbmUoaykgPyAoMCA8IGQubGVuZ3RoICYmIGIucHVzaChkKSwgYi5wdXNoKFt7CiAgICAgICAgICAgICAgICBjaEFycjogWyJcbiJdLAogICAgICAgICAgICAgICAgc3R5bGVzOiBhCiAgICAgICAgICAgIH1dKSwgZCA9IFtdKSA6IDAgPT09IGQubGVuZ3RoID8gKGQucHVzaCh7CiAgICAgICAgICAgICAgICBjaEFycjogW2tdLAogICAgICAgICAgICAgICAgc3R5bGVzOiBhCiAgICAgICAgICAgIH0pLCBjID0gSXNXb3JkQnJlYWtXaGl0ZVNwYWNlKGspKSA6IChlID0gSXNXb3JkQnJlYWtXaGl0ZVNwYWNlKGspLCBlID09PSBjID8gKGUgPSBkLmF0KC0xKSwgZS5zdHlsZXMgPT09IGEgPyBlLmNoQXJyLnB1c2goaykgOiBkLnB1c2goewogICAgICAgICAgICAgICAgY2hBcnI6IFtrXSwKICAgICAgICAgICAgICAgIHN0eWxlczogYQogICAgICAgICAgICB9KSkgOiAoYi5wdXNoKGQpLCBkID0gW10sIGQucHVzaCh7CiAgICAgICAgICAgICAgICBjaEFycjogW2tdLAogICAgICAgICAgICAgICAgc3R5bGVzOiBhCiAgICAgICAgICAgIH0pLCBjID0gZSkpCiAgICAgICAgfQogICAgICAgIDAgPCBkLmxlbmd0aCAmJiBiLnB1c2goZCk7CiAgICAgICAgcmV0dXJuIGIKICAgIH0KICAgIF9Db3B5TGluZShhKSB7CiAgICAgICAgcmV0dXJuIGEubWFwKGIgPT4KICAgICAgICAgICAgKHsKICAgICAgICAgICAgICAgIGNoQXJyOiBiLmNoQXJyLnNsaWNlKDApLAogICAgICAgICAgICAgICAgc3R5bGVzOiBiLnN0eWxlcywKICAgICAgICAgICAgICAgIHdpZHRoOiBiLndpZHRoLAogICAgICAgICAgICAgICAgaGVpZ2h0OiBiLmhlaWdodCwKICAgICAgICAgICAgICAgIGZvbnRCb3VuZGluZ0JveEFzY2VudDogYi5mb250Qm91bmRpbmdCb3hBc2NlbnQsCiAgICAgICAgICAgICAgICBmb250Qm91bmRpbmdCb3hEZXNjZW50OiBiLmZvbnRCb3VuZGluZ0JveERlc2NlbnQsCiAgICAgICAgICAgICAgICB0b3BUb0FscGhhYmV0aWNEaXN0YW5jZTogYi50b3BUb0FscGhhYmV0aWNEaXN0YW5jZQogICAgICAgICAgICB9KSkKICAgIH0KICAgIF9BZGRXb3JkVG9MaW5lKGEsIGIpIHsKICAgICAgICB2YXIgZCA9IGEubGVuZ3RoID8gYS5hdCgtMSkgOiBudWxsOwogICAgICAgIGxldCBjID0gMDsKICAgICAgICBkICYmIGJbMF0uc3R5bGVzID09PSBkLnN0eWxlcyAmJiAoQzMkanNjb21wJDM2LmFwcGVuZEFycmF5KGQuY2hBcnIsIGJbMF0uY2hBcnIpLCBkLndpZHRoID0gLTEsIGQuaGVpZ2h0ID0gLTEsIGQuZm9udEJvdW5kaW5nQm94QXNjZW50ID0gLTEsIGQuZm9udEJvdW5kaW5nQm94RGVzY2VudCA9IC0xLCBkLnRvcFRvQWxwaGFiZXRpY0Rpc3RhbmNlID0gLTEsIGMgPSAxKTsKICAgICAgICBmb3IgKGQgPSBiLmxlbmd0aDsgYyA8IGQ7ICsrYykgewogICAgICAgICAgICBjb25zdCBlID0gYltjXTsKICAgICAgICAgICAgYS5wdXNoKHsKICAgICAgICAgICAgICAgIGNoQXJyOiBlLmNoQXJyLnNsaWNlKDApLAogICAgICAgICAgICAgICAgc3R5bGVzOiBlLnN0eWxlcywKICAgICAgICAgICAgICAgIHdpZHRoOiAtMSwKICAgICAgICAgICAgICAgIGhlaWdodDogLTEsCiAgICAgICAgICAgICAgICBmb250Qm91bmRpbmdCb3hBc2NlbnQ6IC0xLAogICAgICAgICAgICAgICAgZm9udEJvdW5kaW5nQm94RGVzY2VudDogLTEsCiAgICAgICAgICAgICAgICB0b3BUb0FscGhhYmV0aWNEaXN0YW5jZTogLTEKICAgICAgICAgICAgfSkKICAgICAgICB9CiAgICB9CiAgICBfV3JhcFRleHQoYSwgYiwgZCwgYykgewogICAgICAgIGxldCBlID0gW10sCiAgICAgICAgICAgIGcgPSAwLAogICAgICAgICAgICBrID0gMCwKICAgICAgICAgICAgbSA9IDAsCiAgICAgICAgICAgIG4gPSAwOwogICAgICAgIHZhciBxID0gMDsKICAgICAgICBmb3IgKGNvbnN0IHUgb2YgYSkgewogICAgICAgICAgICBpZiAoMSA9PT0gdS5sZW5ndGggJiYgMSA9PT0gdVswXS5jaEFyci5sZW5ndGggJiYgSXNOZXdsaW5lKHVbMF0uY2hBcnJbMF0pKSB7CiAgICAgICAgICAgICAgICAwID09PSBrICYmIChxID0gYihbIiAiXSwgdVswXS5zdHlsZXMpLCBrID0gcS5oZWlnaHQsIG0gPSBxLmZvbnRCb3VuZGluZ0JveEFzY2VudCB8fCAwLCBuID0gcS5mb250Qm91bmRpbmdCb3hEZXNjZW50IHx8IDAsIHEgPSBxLnRvcFRvQWxwaGFiZXRpY0Rpc3RhbmNlIHx8IDApOwogICAgICAgICAgICAgICAgdGhpcy5fQWRkTGluZShlLCBnLCBrLCBtLCBuLCBxKTsKICAgICAgICAgICAgICAgIGUgPSBbXTsKICAgICAgICAgICAgICAgIHEgPSBuID0gbSA9IGsgPSBnID0gMDsKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIH0KICAgICAgICAgICAgYSA9IHRoaXMuX0NvcHlMaW5lKGUpOwogICAgICAgICAgICB0aGlzLl9BZGRXb3JkVG9MaW5lKGEsIHUpOwogICAgICAgICAgICBjb25zdCB3ID0gdGhpcy5fTWVhc3VyZUxpbmUoYSwKICAgICAgICAgICAgICAgICAgICBiKSwKICAgICAgICAgICAgICAgIHogPSB3LndpZHRoOwogICAgICAgICAgICB6ID49IGQgPyAoMCA8IGUubGVuZ3RoICYmIHRoaXMuX0FkZExpbmUoZSwgZywgaywgbSwgbiwgcSksIGUgPSBbXSwgQzMkanNjb21wJDM2LklzQ2hhckFycmF5QWxsV2hpdGVzcGFjZSh1WzBdLmNoQXJyKSA/IHEgPSBuID0gbSA9IGsgPSBnID0gMCA6ICh0aGlzLl9BZGRXb3JkVG9MaW5lKGUsIHUpLCBxID0gdGhpcy5fTWVhc3VyZUxpbmUoZSwgYiksIGcgPSBxLndpZHRoLCBrID0gcS5oZWlnaHQsIG0gPSBxLmZvbnRCb3VuZGluZ0JveEFzY2VudCwgbiA9IHEuZm9udEJvdW5kaW5nQm94RGVzY2VudCwgcSA9IHEudG9wVG9BbHBoYWJldGljRGlzdGFuY2UpKSA6IChlID0gYSwgZyA9IHosIGsgPSB3LmhlaWdodCwgbSA9IHcuZm9udEJvdW5kaW5nQm94QXNjZW50LCBuID0gdy5mb250Qm91bmRpbmdCb3hEZXNjZW50LCBxID0gdy50b3BUb0FscGhhYmV0aWNEaXN0YW5jZSkKICAgICAgICB9CiAgICAgICAgMCA8IGUubGVuZ3RoICYmIHRoaXMuX0FkZExpbmUoZSwgZywgaywgbSwgbiwgcSk7CiAgICAgICAgdGhpcy5fVHJpbUxpbmVzVHJhaWxpbmdXaGl0ZXNwYWNlKGIsIGMpCiAgICB9CiAgICBfVHJpbUxpbmVzVHJhaWxpbmdXaGl0ZXNwYWNlKGEsIGIpIHsKICAgICAgICBmb3IgKGNvbnN0IGMgb2YgdGhpcy5fbGluZXMpIHsKICAgICAgICAgICAgY29uc3QgZSA9CiAgICAgICAgICAgICAgICBjLmZyYWdtZW50czsKICAgICAgICAgICAgaWYgKCFlLmxlbmd0aCkgY29udGludWU7CiAgICAgICAgICAgIGxldCBnID0gZS5hdCgtMSk7CiAgICAgICAgICAgIHZhciBkID0gZy5jaEFycjsKICAgICAgICAgICAgY29uc3QgayA9IGQuc2xpY2UoMCk7CiAgICAgICAgICAgIFdvcmRCcmVha1RyaW1FbmQoayk7CiAgICAgICAgICAgIGlmICgwID09PSBrLmxlbmd0aCkgYy53aWR0aCAtPSBnLndpZHRoLCBlLnBvcCgpOwogICAgICAgICAgICBlbHNlIGlmIChrLmxlbmd0aCA8IGQubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICBkID0gYShrLCBnLnN0eWxlcykud2lkdGg7CiAgICAgICAgICAgICAgICBjb25zdCBtID0gZy53aWR0aCAtIGQ7CiAgICAgICAgICAgICAgICBnLndpZHRoID0gZDsKICAgICAgICAgICAgICAgIGcuY2hBcnIgPSBrOwogICAgICAgICAgICAgICAgYy53aWR0aCAtPSBtCiAgICAgICAgICAgIH0KICAgICAgICAgICAgMCAhPT0gYiAmJiAwIDwgZS5sZW5ndGggJiYgKGcgPSBlLmF0KC0xKSwgZy53aWR0aCArPSBiLCBjLndpZHRoICs9IGIpCiAgICAgICAgfQogICAgfQogICAgQ2xlYXIoKSB7CiAgICAgICAgQzMkanNjb21wJDM2LmNsZWFyQXJyYXkodGhpcy5fbGluZXMpCiAgICB9CiAgICBHZXRNYXhMaW5lV2lkdGgoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2xpbmVzLnJlZHVjZSgoYSwgYikgPT4gTWF0aC5tYXgoYSwgYi53aWR0aCksIDApCiAgICB9CiAgICBHZXRUb3RhbExpbmVIZWlnaHQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2xpbmVzLnJlZHVjZSgoYSwgYikgPT4gYSArIGIuaGVpZ2h0LCAwKQogICAgfQp9OwoidXNlIHN0cmljdCI7CmNvbnN0IEMzJGpzY29tcCQzNyA9IHNlbGYuQzMsCiAgICBnbE1hdHJpeCA9IHNlbGYuZ2xNYXRyaXgsCiAgICB2ZWMzJGpzY29tcCQxID0gZ2xNYXRyaXgudmVjMywKICAgIHZlYzQkanNjb21wJDEgPSBnbE1hdHJpeC52ZWM0LAogICAgbWF0NCRqc2NvbXAkMSA9IGdsTWF0cml4Lm1hdDQsCiAgICB0ZW1wVmVjM2EgPSB2ZWMzJGpzY29tcCQxLmNyZWF0ZSgpLAogICAgdGVtcFZlYzNiID0gdmVjMyRqc2NvbXAkMS5jcmVhdGUoKSwKICAgIHRlbXBWZWMzYyA9IHZlYzMkanNjb21wJDEuY3JlYXRlKCksCiAgICB0ZW1wVmVjNCA9IHZlYzQkanNjb21wJDEuY3JlYXRlKCksCiAgICB0ZW1wTWF0NCA9IG1hdDQkanNjb21wJDEuY3JlYXRlKCksCiAgICBuZWFydGwgPSB2ZWMzJGpzY29tcCQxLmNyZWF0ZSgpLAogICAgbmVhcnRyID0gdmVjMyRqc2NvbXAkMS5jcmVhdGUoKSwKICAgIG5lYXJibCA9IHZlYzMkanNjb21wJDEuY3JlYXRlKCksCiAgICBuZWFyYnIgPSB2ZWMzJGpzY29tcCQxLmNyZWF0ZSgpLAogICAgZmFydGwgPSB2ZWMzJGpzY29tcCQxLmNyZWF0ZSgpLAogICAgZmFydHIgPSB2ZWMzJGpzY29tcCQxLmNyZWF0ZSgpLAogICAgZmFyYmwgPSB2ZWMzJGpzY29tcCQxLmNyZWF0ZSgpLAogICAgZmFyYnIgPSB2ZWMzJGpzY29tcCQxLmNyZWF0ZSgpLAogICAgdW5pdFZpZXdwb3J0ID0gdmVjNCRqc2NvbXAkMS5mcm9tVmFsdWVzKDAsIDAsIDEsIDEpOwpDMyRqc2NvbXAkMzcuR2Z4ID0gewogICAgUHJvamVjdChhLCBiLCBkLCBjLCBlLCBnLCBrKSB7CiAgICAgICAgY29uc3QgbSA9IGNbMF0gKiBhICsgY1s0XSAqIGIgKyBjWzhdICogZCArIGNbMTJdLAogICAgICAgICAgICBuID0gY1sxXSAqIGEgKyBjWzVdICogYiArIGNbOV0gKiBkICsgY1sxM10sCiAgICAgICAgICAgIHEgPSBjWzJdICogYSArIGNbNl0gKiBiICsgY1sxMF0gKiBkICsgY1sxNF07CiAgICAgICAgYyA9IGNbM10gKiBhICsgY1s3XSAqIGIgKyBjWzExXSAqIGQgKyBjWzE1XTsKICAgICAgICBhID0gZVswXSAqIG0gKyBlWzRdICogbiArIGVbOF0gKiBxICsgZVsxMl0gKiBjOwogICAgICAgIGIgPSBlWzFdICogbSArIGVbNV0gKiBuICsgZVs5XSAqIHEgKyBlWzEzXSAqIGM7CiAgICAgICAgZCA9IGVbMl0gKiBtICsgZVs2XSAqIG4gKyBlWzEwXSAqIHEgKyBlWzE0XSAqIGM7CiAgICAgICAgZSA9IGVbM10gKiBtICsgZVs3XSAqIG4gKyBlWzExXSAqIHEgKyBlWzE1XSAqIGM7CiAgICAgICAgaWYgKDAgPT09IGUpIHJldHVybiAhMTsKICAgICAgICBlID0gMSAvIGU7CiAgICAgICAga1swXSA9IChhICogZSAqIC41ICsgLjUpICogZ1syXSArIGdbMF07CiAgICAgICAga1sxXSA9IChiICogZSAqIC41ICsgLjUpICogZ1szXSArIGdbMV07CiAgICAgICAga1syXSA9IC41ICogKDEgKyBkICogZSk7CiAgICAgICAgcmV0dXJuICEwCiAgICB9LAogICAgVW5wcm9qZWN0KGEsIGIsIGQsIGMsIGUsIGcsIGspIHsKICAgICAgICBtYXQ0JGpzY29tcCQxLm11bHRpcGx5KHRlbXBNYXQ0LCBlLCBjKTsKICAgICAgICBpZiAobnVsbCA9PT0gbWF0NCRqc2NvbXAkMS5pbnZlcnQodGVtcE1hdDQsIHRlbXBNYXQ0KSkgcmV0dXJuICExOwogICAgICAgIHRlbXBWZWM0WzBdID0gKGEgLSBnWzBdKSAvIGdbMl0gKiAyIC0gMTsKICAgICAgICB0ZW1wVmVjNFsxXSA9IChiIC0gZ1sxXSkgLyBnWzNdICogMiAtIDE7CiAgICAgICAgdGVtcFZlYzRbMl0gPSAyICogZCAtIDE7CiAgICAgICAgdGVtcFZlYzRbM10gPSAxOwogICAgICAgIHZlYzQkanNjb21wJDEudHJhbnNmb3JtTWF0NCh0ZW1wVmVjNCwgdGVtcFZlYzQsIHRlbXBNYXQ0KTsKICAgICAgICBpZiAoMCA9PT0gdGVtcFZlYzRbM10pIHJldHVybiAhMTsKICAgICAgICB0ZW1wVmVjNFszXSA9IDEgLyB0ZW1wVmVjNFszXTsKICAgICAgICBrWzBdID0gdGVtcFZlYzRbMF0gKiB0ZW1wVmVjNFszXTsKICAgICAgICBrWzFdID0gdGVtcFZlYzRbMV0gKiB0ZW1wVmVjNFszXTsKICAgICAgICBrWzJdID0gdGVtcFZlYzRbMl0gKiB0ZW1wVmVjNFszXTsKICAgICAgICByZXR1cm4gITAKICAgIH0sCiAgICBVbnByb2plY3RTY3JlZW5Ub1dvcmxkWihhLCBiLCBkLCBjLCBlLCBnLCBrKSB7CiAgICAgICAgY29uc3QgbSA9IHRlbXBWZWMzYTsKICAgICAgICBpZiAoIUMzJGpzY29tcCQzNy5HZnguVW5wcm9qZWN0KGEsIGIsIDAsIGMsIGUsIGcsIG0pIHx8ICFDMyRqc2NvbXAkMzcuR2Z4LlVucHJvamVjdChhLCBiLCAxLCBjLCBlLCBnLCB0ZW1wVmVjM2IpKSByZXR1cm4gITE7CiAgICAgICAgdmVjMyRqc2NvbXAkMS5zdWJ0cmFjdCh0ZW1wVmVjM2IsIHRlbXBWZWMzYiwKICAgICAgICAgICAgbSk7CiAgICAgICAgYSA9IHRlbXBWZWMzYzsKICAgICAgICB2ZWMzJGpzY29tcCQxLnNldChhLCAwLCAwLCAxKTsKICAgICAgICBkID0gLWQ7CiAgICAgICAgYiA9IHZlYzMkanNjb21wJDEuZG90KGEsIHRlbXBWZWMzYik7CiAgICAgICAgYyA9IDA7CiAgICAgICAgaWYgKDAgPT09IGIpIHsKICAgICAgICAgICAgaWYgKDAgIT09IHZlYzMkanNjb21wJDEuZG90KGEsIG0pICsgZCkgcmV0dXJuICExCiAgICAgICAgfSBlbHNlIGlmIChjID0gLSh2ZWMzJGpzY29tcCQxLmRvdChtLCBhKSArIGQpIC8gYiwgMCA+IGMpIHJldHVybiAhMTsKICAgICAgICB2ZWMzJGpzY29tcCQxLnNjYWxlQW5kQWRkKGssIG0sIHRlbXBWZWMzYiwgYyk7CiAgICAgICAgcmV0dXJuICEwCiAgICB9Cn07CgpmdW5jdGlvbiBQbGFuZUZyb21Qb2ludHMoYSwgYiwgZCwgYykgewogICAgdmVjMyRqc2NvbXAkMS5zdWJ0cmFjdCh0ZW1wVmVjM2EsIGQsIGIpOwogICAgdmVjMyRqc2NvbXAkMS5zdWJ0cmFjdCh0ZW1wVmVjM2IsIGEsIGIpOwogICAgdmVjMyRqc2NvbXAkMS5jcm9zcyh0ZW1wVmVjM2MsIHRlbXBWZWMzYSwgdGVtcFZlYzNiKTsKICAgIHZlYzMkanNjb21wJDEubm9ybWFsaXplKHRlbXBWZWMzYywgdGVtcFZlYzNjKTsKICAgIGMuc2V0KHRlbXBWZWMzY1swXSwgdGVtcFZlYzNjWzFdLCB0ZW1wVmVjM2NbMl0sIHZlYzMkanNjb21wJDEuZG90KGEsIHRlbXBWZWMzYykpCn0KCmZ1bmN0aW9uIElzSW5Gcm9udE9mUGxhbmUoYSwgYiwgZCwgYywgZSwgZywgaykgewogICAgY29uc3QgbSA9IGsueCwKICAgICAgICBuID0gay55LAogICAgICAgIHEgPSBrLnosCiAgICAgICAgdSA9IGsudywKICAgICAgICB3ID0gay54RiwKICAgICAgICB6ID0gay55RjsKICAgIGsgPSBrLnpGOwogICAgY29uc3QgQyA9IDEgLSB3LAogICAgICAgIEQgPSAxIC0geiwKICAgICAgICBGID0gMSAtIGs7CiAgICByZXR1cm4gbSAqIGEgKiB3ICsgbSAqIGMgKiBDICsgbiAqIGIgKiB6ICsgbiAqIGUgKiBEICsgcSAqIGQgKiBrICsgcSAqIGcgKiBGID49IHUgPyAhMCA6IG0gKiBjICogdyArIG0gKiBhICogQyArIG4gKiBlICogeiArIG4gKiBiICogRCArIHEgKiBnICogayArIHEgKiBkICogRiA+IHUKfQoKZnVuY3Rpb24gSXNQb2ludEluRnJvbnRPZlBsYW5lKGEsIGIsIGQsIGMpIHsKICAgIHJldHVybiBjLnggKiBhICsgYy55ICogYiArIGMueiAqIGQgPj0gYy53Cn0KY2xhc3MgUGxhbmUgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgICAgdGhpcy56RiA9IHRoaXMueUYgPSB0aGlzLnhGID0gdGhpcy53ID0gdGhpcy56ID0gdGhpcy55ID0gdGhpcy54ID0gTmFOCiAgICB9CiAgICBzZXQoYSwgYiwgZCwgYykgewogICAgICAgIHRoaXMueCA9IGE7CiAgICAgICAgdGhpcy55ID0gYjsKICAgICAgICB0aGlzLnogPSBkOwogICAgICAgIHRoaXMudyA9IGM7CiAgICAgICAgdGhpcy54RiA9IDAgPCBhID8gMSA6IDA7CiAgICAgICAgdGhpcy55RiA9IDAgPCBiID8gMSA6IDA7CiAgICAgICAgdGhpcy56RiA9IDAgPCBkID8gMSA6IDAKICAgIH0KfQpDMyRqc2NvbXAkMzcuR2Z4LlZpZXdGcnVzdHVtID0gY2xhc3MgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgICAgdGhpcy5fbGVmdFAgPSBuZXcgUGxhbmU7CiAgICAgICAgdGhpcy5fdG9wUCA9IG5ldyBQbGFuZTsKICAgICAgICB0aGlzLl9yaWdodFAgPSBuZXcgUGxhbmU7CiAgICAgICAgdGhpcy5fYm90dG9tUCA9IG5ldyBQbGFuZTsKICAgICAgICB0aGlzLl9uZWFyUCA9IG5ldyBQbGFuZTsKICAgICAgICB0aGlzLl9mYXJQID0gbmV3IFBsYW5lCiAgICB9CiAgICBDYWxjdWxhdGVQbGFuZXMoYSwgYikgewogICAgICAgIEMzJGpzY29tcCQzNy5HZnguVW5wcm9qZWN0KDAsIDEsIDAsIGEsIGIsIHVuaXRWaWV3cG9ydCwgbmVhcnRsKTsKICAgICAgICBDMyRqc2NvbXAkMzcuR2Z4LlVucHJvamVjdCgxLCAxLCAwLCBhLCBiLCB1bml0Vmlld3BvcnQsIG5lYXJ0cik7CiAgICAgICAgQzMkanNjb21wJDM3LkdmeC5VbnByb2plY3QoMCwgMCwgMCwgYSwgYiwgdW5pdFZpZXdwb3J0LCBuZWFyYmwpOwogICAgICAgIEMzJGpzY29tcCQzNy5HZnguVW5wcm9qZWN0KDEsIDAsIDAsIGEsIGIsIHVuaXRWaWV3cG9ydCwgbmVhcmJyKTsKICAgICAgICBDMyRqc2NvbXAkMzcuR2Z4LlVucHJvamVjdCgwLCAxLCAxLCBhLCBiLCB1bml0Vmlld3BvcnQsIGZhcnRsKTsKICAgICAgICBDMyRqc2NvbXAkMzcuR2Z4LlVucHJvamVjdCgxLAogICAgICAgICAgICAxLCAxLCBhLCBiLCB1bml0Vmlld3BvcnQsIGZhcnRyKTsKICAgICAgICBDMyRqc2NvbXAkMzcuR2Z4LlVucHJvamVjdCgwLCAwLCAxLCBhLCBiLCB1bml0Vmlld3BvcnQsIGZhcmJsKTsKICAgICAgICBDMyRqc2NvbXAkMzcuR2Z4LlVucHJvamVjdCgxLCAwLCAxLCBhLCBiLCB1bml0Vmlld3BvcnQsIGZhcmJyKTsKICAgICAgICBQbGFuZUZyb21Qb2ludHMobmVhcmJsLCBuZWFydGwsIGZhcnRsLCB0aGlzLl9sZWZ0UCk7CiAgICAgICAgUGxhbmVGcm9tUG9pbnRzKG5lYXJ0bCwgbmVhcnRyLCBmYXJ0ciwgdGhpcy5fdG9wUCk7CiAgICAgICAgUGxhbmVGcm9tUG9pbnRzKG5lYXJ0ciwgbmVhcmJyLCBmYXJiciwgdGhpcy5fcmlnaHRQKTsKICAgICAgICBQbGFuZUZyb21Qb2ludHMobmVhcmJyLCBuZWFyYmwsIGZhcmJsLCB0aGlzLl9ib3R0b21QKTsKICAgICAgICBQbGFuZUZyb21Qb2ludHMoZmFyYmwsIGZhcnRsLCBmYXJ0ciwgdGhpcy5fZmFyUCk7CiAgICAgICAgUGxhbmVGcm9tUG9pbnRzKG5lYXJiciwgbmVhcnRyLCBuZWFydGwsIHRoaXMuX25lYXJQKQogICAgfQogICAgQ29udGFpbnNBQUJCKGEsIGIsIGQsIGMsIGUsIGcpIHsKICAgICAgICByZXR1cm4gSXNJbkZyb250T2ZQbGFuZShhLCBiLCBkLCBjLCBlLCBnLCB0aGlzLl9sZWZ0UCkgJiYKICAgICAgICAgICAgSXNJbkZyb250T2ZQbGFuZShhLCBiLCBkLCBjLCBlLCBnLCB0aGlzLl90b3BQKSAmJiBJc0luRnJvbnRPZlBsYW5lKGEsIGIsIGQsIGMsIGUsIGcsIHRoaXMuX3JpZ2h0UCkgJiYgSXNJbkZyb250T2ZQbGFuZShhLCBiLCBkLCBjLCBlLCBnLCB0aGlzLl9ib3R0b21QKSAmJiBJc0luRnJvbnRPZlBsYW5lKGEsIGIsIGQsIGMsIGUsIGcsIHRoaXMuX25lYXJQKSAmJiBJc0luRnJvbnRPZlBsYW5lKGEsIGIsIGQsIGMsIGUsIGcsIHRoaXMuX2ZhclApCiAgICB9CiAgICBJc0JlaGluZE5lYXJQbGFuZShhLCBiLCBkKSB7CiAgICAgICAgcmV0dXJuICFJc1BvaW50SW5Gcm9udE9mUGxhbmUoYSwgYiwgZCwgdGhpcy5fbmVhclApCiAgICB9Cn07CiJ1c2Ugc3RyaWN0IjsKY29uc3QgQzMkanNjb21wJDM4ID0gc2VsZi5DMywKICAgIGdsTWF0cml4JGpzY29tcCQxID0gc2VsZi5nbE1hdHJpeCwKICAgIHZlYzMkanNjb21wJDIgPSBnbE1hdHJpeCRqc2NvbXAkMS52ZWMzLAogICAgdmVjNCRqc2NvbXAkMiA9IGdsTWF0cml4JGpzY29tcCQxLnZlYzQsCiAgICBtYXQ0JGpzY29tcCQyID0gZ2xNYXRyaXgkanNjb21wJDEubWF0NCwKICAgIHRlbXBNYXQ0JGpzY29tcCQxID0gbWF0NCRqc2NvbXAkMi5jcmVhdGUoKSwKICAgIHRtcFZlYzNhID0gdmVjMyRqc2NvbXAkMi5mcm9tVmFsdWVzKDAsIDAsIDApLAogICAgdG1wVmVjM2IgPSB2ZWMzJGpzY29tcCQyLmZyb21WYWx1ZXMoMCwgMCwgMCksCiAgICB0bXBWZWMzYyA9IHZlYzMkanNjb21wJDIuZnJvbVZhbHVlcygwLCAwLCAwKSwKICAgIGRlZmF1bHRVcFZlY3RvciA9IHZlYzMkanNjb21wJDIuZnJvbVZhbHVlcygwLCAxLCAwKTsKdmVjNCRqc2NvbXAkMi5mcm9tVmFsdWVzKDAsIDAsIDAsIDApOwpjb25zdCB0bXBRdWFkID0gbmV3IEMzJGpzY29tcCQzOC5RdWFkLAogICAgdG1wUmVjdCA9IG5ldyBDMyRqc2NvbXAkMzguUmVjdCwKICAgIGRlZmF1bHRUZXhDb29yZHNRdWFkID0gbmV3IEMzJGpzY29tcCQzOC5RdWFkKDAsIDAsIDEsIDAsIDEsIDEsIDAsIDEpOwpDMyRqc2NvbXAkMzguR2Z4LlJlbmRlcmVyQmFzZSA9IGNsYXNzIHsKICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgIHRoaXMuX2hlaWdodCA9IHRoaXMuX3dpZHRoID0gMDsKICAgICAgICB0aGlzLl9mb3ZZID0gQzMkanNjb21wJDM4LnRvUmFkaWFucyg0NSk7CiAgICAgICAgdGhpcy5fdGFuX2ZvdllfMiA9IE1hdGgudGFuKHRoaXMuX2ZvdlkgLyAyKTsKICAgICAgICB0aGlzLl9tYXRQID0gbWF0NCRqc2NvbXAkMi5jcmVhdGUoKTsKICAgICAgICB0aGlzLl9tYXRNViA9IG1hdDQkanNjb21wJDIuY3JlYXRlKCk7CiAgICAgICAgdGhpcy5fekF4aXNTY2FsZSA9ICExOwogICAgICAgIHRoaXMuX2FsbFNoYWRlclByb2dyYW1zID0gW107CiAgICAgICAgdGhpcy5fc2hhZGVyUHJvZ3JhbXNCeU5hbWUgPSBuZXcgTWFwOwogICAgICAgIHRoaXMuX3NwU21vb3RoTGluZUZpbGwgPSB0aGlzLl9zcFNtb290aEVsbGlwc2VPdXRsaW5lID0gdGhpcy5fc3BTbW9vdGhFbGxpcHNlRmlsbCA9IHRoaXMuX3NwSGFyZEVsbGlwc2VPdXRsaW5lID0gdGhpcy5fc3BIYXJkRWxsaXBzZUZpbGwgPSB0aGlzLl9zcFBlbnVtYnJhRmlsbCA9IHRoaXMuX3NwTGluZWFyR3JhZGllbnRGaWxsID0gdGhpcy5fc3BDb2xvckZpbGwgPQogICAgICAgICAgICB0aGlzLl9zcFRpbGVtYXBGaWxsID0gdGhpcy5fc3BQb2ludHMgPSB0aGlzLl9zcFRleHR1cmVGaWxsID0gbnVsbDsKICAgICAgICB0aGlzLl9zdGF0ZUdyb3VwcyA9IG5ldyBNYXA7CiAgICAgICAgdGhpcy5fY3VycmVudFN0YXRlR3JvdXAgPSBudWxsOwogICAgICAgIHRoaXMuX2JsZW5kTW9kZVRhYmxlID0gW107CiAgICAgICAgdGhpcy5fbmFtZWRCbGVuZE1vZGVNYXAgPSBuZXcgTWFwOwogICAgICAgIHRoaXMuX2N1cnJlbnRaID0gdGhpcy5fYmFzZVogPSAwOwogICAgICAgIHRoaXMuX2xpbmVXaWR0aCA9IDE7CiAgICAgICAgdGhpcy5fbGluZVdpZHRoU3RhY2sgPSBbdGhpcy5fbGluZVdpZHRoXTsKICAgICAgICB0aGlzLl9saW5lQ2FwID0gMTsKICAgICAgICB0aGlzLl9saW5lQ2FwU3RhY2sgPSBbdGhpcy5fbGluZUNhcF07CiAgICAgICAgdGhpcy5fbGluZU9mZnNldCA9IC41OwogICAgICAgIHRoaXMuX2xpbmVPZmZzZXRTdGFjayA9IFt0aGlzLl9saW5lT2Zmc2V0XTsKICAgICAgICB0aGlzLl9mcmFtZU51bWJlciA9IDA7CiAgICAgICAgdGhpcy5fZW5hYmxlTWlwbWFwcyA9ICEwOwogICAgICAgIHRoaXMuX2hhc01ham9yUGVyZm9ybWFuY2VDYXZlYXQgPSAhMQogICAgfQogICAgRmlsbEluZGV4QnVmZmVyRGF0YShhKSB7CiAgICAgICAgbGV0IGIgPSAwLAogICAgICAgICAgICBkID0gYS5sZW5ndGgsCiAgICAgICAgICAgIGMgPSAwOwogICAgICAgIGZvciAoOyBiIDwgZDspIGFbYisrXSA9CiAgICAgICAgICAgIGMsIGFbYisrXSA9IGMgKyAxLCBhW2IrK10gPSBjICsgMiwgYVtiKytdID0gYywgYVtiKytdID0gYyArIDIsIGFbYisrXSA9IGMgKyAzLCBjICs9IDQKICAgIH0KICAgIF9DbGVhclN0YXRlKCkgewogICAgICAgIHRoaXMuX2N1cnJlbnRaID0gdGhpcy5fYmFzZVogPSAwOwogICAgICAgIHRoaXMuX3NwU21vb3RoTGluZUZpbGwgPSB0aGlzLl9zcFNtb290aEVsbGlwc2VPdXRsaW5lID0gdGhpcy5fc3BTbW9vdGhFbGxpcHNlRmlsbCA9IHRoaXMuX3NwSGFyZEVsbGlwc2VPdXRsaW5lID0gdGhpcy5fc3BIYXJkRWxsaXBzZUZpbGwgPSB0aGlzLl9zcFBlbnVtYnJhRmlsbCA9IHRoaXMuX3NwTGluZWFyR3JhZGllbnRGaWxsID0gdGhpcy5fc3BDb2xvckZpbGwgPSB0aGlzLl9zcFRpbGVtYXBGaWxsID0gdGhpcy5fc3BQb2ludHMgPSB0aGlzLl9zcFRleHR1cmVGaWxsID0gbnVsbDsKICAgICAgICB0aGlzLl9DbGVhckFsbFNoYWRlclByb2dyYW1zKCkKICAgIH0KICAgIEluaXRTdGF0ZSgpIHsKICAgICAgICB0aGlzLl9DbGVhclN0YXRlKCk7CiAgICAgICAgdGhpcy5fY3VycmVudFN0YXRlR3JvdXAgPSBudWxsCiAgICB9CiAgICBPbkRldmljZU9yQ29udGV4dExvc3QoKSB7CiAgICAgICAgZm9yIChjb25zdCBhIG9mIHRoaXMuX2FsbFNoYWRlclByb2dyYW1zKSBhLlJlbGVhc2UoKTsKICAgICAgICB0aGlzLl9DbGVhclN0YXRlKCkKICAgIH0KICAgIEdldFdpZHRoKCkgewogICAgICAgIHJldHVybiB0aGlzLl93aWR0aAogICAgfQogICAgR2V0SGVpZ2h0KCkgewogICAgICAgIHJldHVybiB0aGlzLl9oZWlnaHQKICAgIH0KICAgIEdldERlZmF1bHRDYW1lcmFaKGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5Jc1pBeGlzU2NhbGVOb3JtYWxpemVkKCkgPyAxMDAgOiBhIC8gKDIgKiB0aGlzLl9HZXRUYW5Gb3ZZRGl2MigpKQogICAgfQogICAgR2V0WkF4aXNTY2FsZUZhY3RvcihhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuSXNaQXhpc1NjYWxlTm9ybWFsaXplZCgpID8gYSAvICgyICogdGhpcy5fR2V0VGFuRm92WURpdjIoKSkgLyB0aGlzLkdldERlZmF1bHRDYW1lcmFaKGEpIDogMQogICAgfQogICAgR2V0TmVhclooKSB7CiAgICAgICAgcmV0dXJuIDEKICAgIH0KICAgIEdldEZhclooKSB7CiAgICAgICAgcmV0dXJuIDFFNAogICAgfQogICAgU2V0Rm92WShhKSB7CiAgICAgICAgdGhpcy5fZm92WSA9IGE7CiAgICAgICAgdGhpcy5fdGFuX2ZvdllfMiA9IE1hdGgudGFuKHRoaXMuX2ZvdlkgLyAyKQogICAgfQogICAgR2V0Rm92WSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZm92WQogICAgfQogICAgX0dldFRhbkZvdllEaXYyKCkgewogICAgICAgIHJldHVybiB0aGlzLl90YW5fZm92WV8yCiAgICB9CiAgICBTZXRaQXhpc1NjYWxlTm9ybWFsaXplZCgpIHsKICAgICAgICB0aGlzLl96QXhpc1NjYWxlID0gITEKICAgIH0KICAgIFNldFpBeGlzU2NhbGVSZWd1bGFyKCkgewogICAgICAgIHRoaXMuX3pBeGlzU2NhbGUgPSAhMAogICAgfQogICAgSXNaQXhpc1NjYWxlTm9ybWFsaXplZCgpIHsKICAgICAgICByZXR1cm4gIXRoaXMuX3pBeGlzU2NhbGUKICAgIH0KICAgIElzWkF4aXNTY2FsZVJlZ3VsYXIoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3pBeGlzU2NhbGUKICAgIH0KICAgIENhbGN1bGF0ZVBlcnNwZWN0aXZlTWF0cml4KGEsIGIsIGQgPSAuNSwgYyA9IC41KSB7CiAgICAgICAgY29uc3QgZSA9IHRoaXMuR2V0TmVhclooKSwKICAgICAgICAgICAgZyA9IHRoaXMuR2V0RmFyWigpOwogICAgICAgIHZhciBrID0gdGhpcy5HZXRGb3ZZKCk7CiAgICAgICAgaWYgKC41ID09PSBkICYmIC41ID09PSBjKSB0aGlzLklzV2ViR1BVKCkgPyBtYXQ0JGpzY29tcCQyLnBlcnNwZWN0aXZlWk8oYSwgaywgYiwgZSwgZykgOiBtYXQ0JGpzY29tcCQyLnBlcnNwZWN0aXZlKGEsIGssIGIsIGUsIGcpOwogICAgICAgIGVsc2UgewogICAgICAgICAgICBkID0gMSAtIGQ7CiAgICAgICAgICAgIGsgPSAyICogZCAtIDI7CiAgICAgICAgICAgIGQgKj0gMjsKICAgICAgICAgICAgY29uc3QgbSA9IDIgKiBjIC0gMjsKICAgICAgICAgICAgYyAqPSAyOwogICAgICAgICAgICBjb25zdCBuID0gdGhpcy5fR2V0VGFuRm92WURpdjIoKSAqIGU7CiAgICAgICAgICAgIGIgKj0gbjsKICAgICAgICAgICAgbWF0NCRqc2NvbXAkMi5mcnVzdHVtKGEsIGsgKiBiLCBkICogYiwgbSAqIG4sIGMgKiBuLCBlLCBnKQogICAgICAgIH0KICAgIH0KICAgIENhbGN1bGF0ZU9ydGhvZ3JhcGhpY01hdHJpeChhLAogICAgICAgIGIsIGQsIGMgPSAxKSB7CiAgICAgICAgdmFyIGUgPSBzZWxmLmRldmljZVBpeGVsUmF0aW87CiAgICAgICAgY29uc3QgZyA9IDIgKiB0aGlzLkdldERlZmF1bHRDYW1lcmFaKGQpICogZSAqIHRoaXMuX0dldFRhbkZvdllEaXYyKCkgLyBkOwogICAgICAgIGIgPSBiICogZyAvICgyICogZSAqIGMpOwogICAgICAgIGQgPSBkICogZyAvICgyICogZSAqIGMpOwogICAgICAgIGMgPSAtYjsKICAgICAgICBlID0gLWQ7CiAgICAgICAgdGhpcy5Jc1dlYkdQVSgpID8gbWF0NCRqc2NvbXAkMi5vcnRob1pPKGEsIGMsIGIsIGUsIGQsIHRoaXMuR2V0TmVhclooKSwgdGhpcy5HZXRGYXJaKCkpIDogbWF0NCRqc2NvbXAkMi5vcnRobyhhLCBjLCBiLCBlLCBkLCB0aGlzLkdldE5lYXJaKCksIHRoaXMuR2V0RmFyWigpKQogICAgfQogICAgQ2FsY3VsYXRlTG9va0F0TW9kZWxWaWV3KGEsIGIsIGQsIGMsIGUsIGcgPSAxKSB7CiAgICAgICAgbGV0IGsgPSAxOwogICAgICAgIHRoaXMuSXNaQXhpc1NjYWxlTm9ybWFsaXplZCgpICYmIChrID0gMjAwICogdGhpcy5fR2V0VGFuRm92WURpdjIoKSAvIGUpOwogICAgICAgIHZlYzMkanNjb21wJDIuc2V0KHRtcFZlYzNjLCBrLCAtaywgMSk7CiAgICAgICAgdmVjMyRqc2NvbXAkMi5tdWx0aXBseSh0bXBWZWMzYSwgYiwgdG1wVmVjM2MpOwogICAgICAgIHZlYzMkanNjb21wJDIubXVsdGlwbHkodG1wVmVjM2IsCiAgICAgICAgICAgIGQsIHRtcFZlYzNjKTsKICAgICAgICBtYXQ0JGpzY29tcCQyLmxvb2tBdChhLCB0bXBWZWMzYSwgdG1wVmVjM2IsIGMgfHwgZGVmYXVsdFVwVmVjdG9yKTsKICAgICAgICB0bXBWZWMzY1syXSA9IGc7CiAgICAgICAgbWF0NCRqc2NvbXAkMi5zY2FsZShhLCBhLCB0bXBWZWMzYykKICAgIH0KICAgIENhbGN1bGF0ZUxvb2tBdE1vZGVsVmlldzIoYSwgYiwgZCwgYywgZSwgZywgaywgbSkgewogICAgICAgIHZlYzMkanNjb21wJDIuc2V0KHRtcFZlYzNhLCBhLCBiLCBkKTsKICAgICAgICB2ZWMzJGpzY29tcCQyLnNldCh0bXBWZWMzYiwgYywgZSwgZyk7CiAgICAgICAgdGhpcy5DYWxjdWxhdGVMb29rQXRNb2RlbFZpZXcodGVtcE1hdDQkanNjb21wJDEsIHRtcFZlYzNhLCB0bXBWZWMzYiwgZGVmYXVsdFVwVmVjdG9yLCBrLCBtKTsKICAgICAgICByZXR1cm4gdGVtcE1hdDQkanNjb21wJDEKICAgIH0KICAgIF9BZGRTaGFkZXJQcm9ncmFtKGEpIHsKICAgICAgICB0aGlzLl9hbGxTaGFkZXJQcm9ncmFtcy5wdXNoKGEpOwogICAgICAgIHRoaXMuX3NoYWRlclByb2dyYW1zQnlOYW1lLnNldChhLkdldE5hbWUoKSwgYSkKICAgIH0KICAgIF9SZW1vdmVTaGFkZXJQcm9ncmFtKGEpIHsKICAgICAgICBjb25zdCBiID0gdGhpcy5fYWxsU2hhZGVyUHJvZ3JhbXMuaW5kZXhPZihhKTsgLQogICAgICAgIDEgIT09IGIgJiYgdGhpcy5fYWxsU2hhZGVyUHJvZ3JhbXMuc3BsaWNlKGIsIDEpOwogICAgICAgIHRoaXMuX3NoYWRlclByb2dyYW1zQnlOYW1lLmRlbGV0ZShhLkdldE5hbWUoKSkKICAgIH0KICAgIF9DbGVhckFsbFNoYWRlclByb2dyYW1zKCkgewogICAgICAgIEMzJGpzY29tcCQzOC5jbGVhckFycmF5KHRoaXMuX2FsbFNoYWRlclByb2dyYW1zKTsKICAgICAgICB0aGlzLl9zaGFkZXJQcm9ncmFtc0J5TmFtZS5jbGVhcigpCiAgICB9CiAgICBHZXRTaGFkZXJQcm9ncmFtQnlOYW1lKGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5fc2hhZGVyUHJvZ3JhbXNCeU5hbWUuZ2V0KGEpIHx8IG51bGwKICAgIH0KICAgIEdldFRleHR1cmVGaWxsU2hhZGVyUHJvZ3JhbSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fc3BUZXh0dXJlRmlsbAogICAgfQogICAgU2V0VGV4dHVyZUZpbGxNb2RlKCkgewogICAgICAgIHRoaXMuU2V0UHJvZ3JhbSh0aGlzLl9zcFRleHR1cmVGaWxsKQogICAgfQogICAgR2V0UG9pbnRzUmVuZGVyaW5nUHJvZ3JhbSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fc3BQb2ludHMKICAgIH0KICAgIFNldFBvaW50c1JlbmRlcmluZ1Byb2dyYW0oKSB7CiAgICAgICAgdGhpcy5TZXRQcm9ncmFtKHRoaXMuX3NwUG9pbnRzKQogICAgfQogICAgU2V0VGlsZW1hcEZpbGxNb2RlKCkgewogICAgICAgIHRoaXMuU2V0UHJvZ3JhbSh0aGlzLl9zcFRpbGVtYXBGaWxsKQogICAgfQogICAgU2V0Q29sb3JGaWxsTW9kZSgpIHsKICAgICAgICB0aGlzLlNldFByb2dyYW0odGhpcy5fc3BDb2xvckZpbGwpCiAgICB9CiAgICBTZXRMaW5lYXJHcmFkaWVudEZpbGxNb2RlKCkgewogICAgICAgIHRoaXMuU2V0UHJvZ3JhbSh0aGlzLl9zcExpbmVhckdyYWRpZW50RmlsbCkKICAgIH0KICAgIFNldFBlbnVtYnJhRmlsbE1vZGUoKSB7CiAgICAgICAgdGhpcy5TZXRQcm9ncmFtKHRoaXMuX3NwUGVudW1icmFGaWxsKQogICAgfQogICAgU2V0SGFyZEVsbGlwc2VGaWxsTW9kZSgpIHsKICAgICAgICB0aGlzLlNldFByb2dyYW0odGhpcy5fc3BIYXJkRWxsaXBzZUZpbGwpCiAgICB9CiAgICBTZXRIYXJkRWxsaXBzZU91dGxpbmVNb2RlKCkgewogICAgICAgIHRoaXMuU2V0UHJvZ3JhbSh0aGlzLl9zcEhhcmRFbGxpcHNlT3V0bGluZSkKICAgIH0KICAgIFNldFNtb290aEVsbGlwc2VGaWxsTW9kZSgpIHsKICAgICAgICB0aGlzLlNldFByb2dyYW0odGhpcy5fc3BTbW9vdGhFbGxpcHNlRmlsbCkKICAgIH0KICAgIFNldFNtb290aEVsbGlwc2VPdXRsaW5lTW9kZSgpIHsKICAgICAgICB0aGlzLlNldFByb2dyYW0odGhpcy5fc3BTbW9vdGhFbGxpcHNlT3V0bGluZSkKICAgIH0KICAgIFNldFNtb290aExpbmVGaWxsTW9kZSgpIHsKICAgICAgICB0aGlzLlNldFByb2dyYW0odGhpcy5fc3BTbW9vdGhMaW5lRmlsbCkKICAgIH0KICAgIF9TZXRDdXJyZW50U3RhdGVHcm91cChhKSB7CiAgICAgICAgdGhpcy5fY3VycmVudFN0YXRlR3JvdXAgPQogICAgICAgICAgICBhCiAgICB9CiAgICBHZXRDdXJyZW50U3RhdGVHcm91cCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fY3VycmVudFN0YXRlR3JvdXAKICAgIH0KICAgIEFjcXVpcmVTdGF0ZUdyb3VwKGEsIGIsIGQsIGMpIHsKICAgICAgICBjb25zdCBlID0gQzMkanNjb21wJDM4LkdmeC5TdGF0ZUdyb3VwLk1ha2VLZXkoYSwgYiwgZCwgYyk7CiAgICAgICAgbGV0IGcgPSB0aGlzLl9zdGF0ZUdyb3Vwcy5nZXQoZSk7CiAgICAgICAgZyB8fCAoZyA9IEMzJGpzY29tcCQzOC5OZXcoQzMkanNjb21wJDM4LkdmeC5TdGF0ZUdyb3VwLCB0aGlzLCBhLCBiLCBkLCBjKSwgdGhpcy5fc3RhdGVHcm91cHMuc2V0KGUsIGcpKTsKICAgICAgICBnLkFkZFJlZigpOwogICAgICAgIHJldHVybiBnCiAgICB9CiAgICBSZWxlYXNlU3RhdGVHcm91cChhKSB7CiAgICAgICAgYS5EZWNSZWYoKTsKICAgICAgICAwID09PSBhLl9HZXRSZWZDb3VudCgpICYmICh0aGlzLl9jdXJyZW50U3RhdGVHcm91cCA9PT0gYSAmJiAodGhpcy5fY3VycmVudFN0YXRlR3JvdXAgPSBudWxsKSwgdGhpcy5fc3RhdGVHcm91cHMuZGVsZXRlKGEuR2V0S2V5KCkpLCBhLlJlbGVhc2UoKSkKICAgIH0KICAgIF9Jbml0QmxlbmRNb2RlRGF0YShhKSB7CiAgICAgICAgQzMkanNjb21wJDM4LmNsZWFyQXJyYXkodGhpcy5fYmxlbmRNb2RlVGFibGUpOwogICAgICAgIHRoaXMuX25hbWVkQmxlbmRNb2RlTWFwLmNsZWFyKCk7CiAgICAgICAgbGV0IGIgPSAwOwogICAgICAgIGZvciAoY29uc3QgZCBvZiBhKSB7CiAgICAgICAgICAgIGEgPSBkWzBdOwogICAgICAgICAgICBjb25zdCBjID0gZFsxXSwKICAgICAgICAgICAgICAgIGUgPSBkWzJdOwogICAgICAgICAgICB0aGlzLl9ibGVuZE1vZGVUYWJsZS5wdXNoKFtjLCBlXSk7CiAgICAgICAgICAgIHRoaXMuX25hbWVkQmxlbmRNb2RlTWFwLnNldChhLCB7CiAgICAgICAgICAgICAgICBudW1iZXI6IGIsCiAgICAgICAgICAgICAgICBzcmNCbGVuZDogYywKICAgICAgICAgICAgICAgIGRlc3RCbGVuZDogZQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYisrCiAgICAgICAgfQogICAgfQogICAgX0dldEJsZW5kQnlJbmRleChhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2JsZW5kTW9kZVRhYmxlW2FdCiAgICB9CiAgICBHZXRTcmNCbGVuZEJ5SW5kZXgoYSkgewogICAgICAgIHJldHVybiB0aGlzLl9HZXRCbGVuZEJ5SW5kZXgoYSlbMF0KICAgIH0KICAgIEdldERlc3RCbGVuZEJ5SW5kZXgoYSkgewogICAgICAgIHJldHVybiB0aGlzLl9HZXRCbGVuZEJ5SW5kZXgoYSlbMV0KICAgIH0KICAgIEdldE5hbWVkQmxlbmQoYSkgewogICAgICAgIGEgPSB0aGlzLl9uYW1lZEJsZW5kTW9kZU1hcC5nZXQoYSk7CiAgICAgICAgaWYgKCJ1bmRlZmluZWQiID09PSB0eXBlb2YgYSkgdGhyb3cgRXJyb3IoImludmFsaWQgYmxlbmQgbmFtZSIpOwogICAgICAgIHJldHVybiBhCiAgICB9CiAgICBOYW1lZEJsZW5kVG9OdW1iZXIoYSkgewogICAgICAgIGEgPSB0aGlzLl9uYW1lZEJsZW5kTW9kZU1hcC5nZXQoYSk7CiAgICAgICAgaWYgKCJ1bmRlZmluZWQiID09PSB0eXBlb2YgYSkgdGhyb3cgRXJyb3IoImludmFsaWQgYmxlbmQgbmFtZSIpOwogICAgICAgIHJldHVybiBhLm51bWJlcgogICAgfQogICAgU2V0QmFzZVooYSkgewogICAgICAgIHRoaXMuX2Jhc2VaID0gYQogICAgfQogICAgR2V0QmFzZVooKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2Jhc2VaCiAgICB9CiAgICBTZXRDdXJyZW50WihhKSB7CiAgICAgICAgdGhpcy5fY3VycmVudFogPSBhOwogICAgICAgIHRoaXMuX2N1cnJlbnRTdGF0ZUdyb3VwID0gbnVsbAogICAgfQogICAgR2V0Q3VycmVudFooKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2N1cnJlbnRaCiAgICB9CiAgICBMaW5lKGEsIGIsIGQsIGMpIHsKICAgICAgICB2YXIgZSA9IEMzJGpzY29tcCQzOC5hbmdsZVRvKGEsIGIsIGQsIGMpLAogICAgICAgICAgICBnID0gLjUgKiB0aGlzLl9saW5lV2lkdGg7CiAgICAgICAgY29uc3QgayA9IE1hdGguc2luKGUpICogZzsKICAgICAgICBlID0gTWF0aC5jb3MoZSkgKiBnOwogICAgICAgIGcgPSB0aGlzLl9saW5lQ2FwOwogICAgICAgIDIgPT09IGcgPyB0aGlzLkxpbmVQcmVDYWxjX0xpbmVDYXAyKGEsIGIsIDAsIGQsIGMsIDAsIGssIGUpIDogMSA9PT0gZyA/IHRoaXMuTGluZVByZUNhbGNfTGluZUNhcDEoYSwgYiwgMCwgZCwgYywgMCwgaywgZSkgOiB0aGlzLkxpbmVQcmVDYWxjX0xpbmVDYXAwKGEsIGIsIDAsIGQsIGMsIDAsIGssIGUpCiAgICB9CiAgICBMaW5lM0QoYSwKICAgICAgICBiLCBkLCBjLCBlLCBnKSB7CiAgICAgICAgdmFyIGsgPSBDMyRqc2NvbXAkMzguYW5nbGVUbyhhLCBiLCBjLCBlKSwKICAgICAgICAgICAgbSA9IC41ICogdGhpcy5fbGluZVdpZHRoOwogICAgICAgIGNvbnN0IG4gPSBNYXRoLnNpbihrKSAqIG07CiAgICAgICAgayA9IE1hdGguY29zKGspICogbTsKICAgICAgICBtID0gdGhpcy5fbGluZUNhcDsKICAgICAgICAyID09PSBtID8gdGhpcy5MaW5lUHJlQ2FsY19MaW5lQ2FwMihhLCBiLCBkLCBjLCBlLCBnLCBuLCBrKSA6IDEgPT09IG0gPyB0aGlzLkxpbmVQcmVDYWxjX0xpbmVDYXAxKGEsIGIsIGQsIGMsIGUsIGcsIG4sIGspIDogdGhpcy5MaW5lUHJlQ2FsY19MaW5lQ2FwMChhLCBiLCBkLCBjLCBlLCBnLCBuLCBrKQogICAgfQogICAgTGluZVByZUNhbGNfTGluZUNhcDIoYSwgYiwgZCwgYywgZSwgZywgaywgbSkgewogICAgICAgIHZhciBuID0gdGhpcy5fbGluZU9mZnNldDsKICAgICAgICBhID0gYSArIG4gLSBtOwogICAgICAgIGIgPSBiICsgbiAtIGs7CiAgICAgICAgYyA9IGMgKyBuICsgbTsKICAgICAgICBlID0gZSArIG4gKyBrOwogICAgICAgIG4gPSAyICogbTsKICAgICAgICBjb25zdCBxID0gMiAqIGs7CiAgICAgICAgdGhpcy5RdWFkM0QyKGEgKyBrLCBiIC0gbSwgZCwgYyArIGssIGUgLSBtLCBnLCBjIC0gayAtIG4sIGUgKyBtIC0gcSwgZywgYSAtIGsgKyBuLCBiICsgbSArIHEsIGQsIGRlZmF1bHRUZXhDb29yZHNRdWFkKQogICAgfQogICAgTGluZVByZUNhbGNfTGluZUNhcDEoYSwgYiwgZCwgYywgZSwgZywgaywgbSkgewogICAgICAgIGNvbnN0IG4gPQogICAgICAgICAgICB0aGlzLl9saW5lT2Zmc2V0OwogICAgICAgIGEgPSBhICsgbiAtIG07CiAgICAgICAgYiA9IGIgKyBuIC0gazsKICAgICAgICBjID0gYyArIG4gKyBtOwogICAgICAgIGUgPSBlICsgbiArIGs7CiAgICAgICAgdGhpcy5RdWFkM0QyKGEgKyBrLCBiIC0gbSwgZCwgYyArIGssIGUgLSBtLCBnLCBjIC0gaywgZSArIG0sIGcsIGEgLSBrLCBiICsgbSwgZCwgZGVmYXVsdFRleENvb3Jkc1F1YWQpCiAgICB9CiAgICBMaW5lUHJlQ2FsY19MaW5lQ2FwMChhLCBiLCBkLCBjLCBlLCBnLCBrLCBtKSB7CiAgICAgICAgY29uc3QgbiA9IHRoaXMuX2xpbmVPZmZzZXQ7CiAgICAgICAgYSArPSBuOwogICAgICAgIGIgKz0gbjsKICAgICAgICBjICs9IG47CiAgICAgICAgZSArPSBuOwogICAgICAgIHRoaXMuUXVhZDNEMihhICsgaywgYiAtIG0sIGQsIGMgKyBrLCBlIC0gbSwgZywgYyAtIGssIGUgKyBtLCBnLCBhIC0gaywgYiArIG0sIGQsIGRlZmF1bHRUZXhDb29yZHNRdWFkKQogICAgfQogICAgVGV4dHVyZWRMaW5lKGEsIGIsIGQsIGMsIGUsIGcpIHsKICAgICAgICB2YXIgayA9IEMzJGpzY29tcCQzOC5hbmdsZVRvKGEsIGIsIGQsIGMpLAogICAgICAgICAgICBtID0gLjUgKiB0aGlzLl9saW5lV2lkdGg7CiAgICAgICAgY29uc3QgbiA9IE1hdGguc2luKGspICogbTsKICAgICAgICBrID0gTWF0aC5jb3MoaykgKiBtOwogICAgICAgIG0gPSB0aGlzLl9saW5lQ2FwOwogICAgICAgIDIgPT09IG0gPyB0aGlzLlRleHR1cmVkTGluZVByZUNhbGNfTGluZUNhcDIoYSwgYiwgZCwgYywgbiwgaywgZSwgZykgOiAxID09PSBtID8gdGhpcy5UZXh0dXJlZExpbmVQcmVDYWxjX0xpbmVDYXAxKGEsCiAgICAgICAgICAgIGIsIGQsIGMsIG4sIGssIGUsIGcpIDogdGhpcy5UZXh0dXJlZExpbmVQcmVDYWxjX0xpbmVDYXAwKGEsIGIsIGQsIGMsIG4sIGssIGUsIGcpCiAgICB9CiAgICBUZXh0dXJlZExpbmVQcmVDYWxjX0xpbmVDYXAyKGEsIGIsIGQsIGMsIGUsIGcsIGssIG0pIHsKICAgICAgICB2YXIgbiA9IHRoaXMuX2xpbmVPZmZzZXQ7CiAgICAgICAgYSA9IGEgKyBuIC0gZzsKICAgICAgICBiID0gYiArIG4gLSBlOwogICAgICAgIGQgPSBkICsgbiArIGc7CiAgICAgICAgYyA9IGMgKyBuICsgZTsKICAgICAgICBuID0gMiAqIGc7CiAgICAgICAgY29uc3QgcSA9IDIgKiBlOwogICAgICAgIHRtcFF1YWQuc2V0KGEgKyBlLCBiIC0gZywgZCArIGUsIGMgLSBnLCBkIC0gZSAtIG4sIGMgKyBnIC0gcSwgYSAtIGUgKyBuLCBiICsgZyArIHEpOwogICAgICAgIHRtcFJlY3Quc2V0KGssIDAsIG0sIDApOwogICAgICAgIHRoaXMuUXVhZDModG1wUXVhZCwgdG1wUmVjdCkKICAgIH0KICAgIFRleHR1cmVkTGluZVByZUNhbGNfTGluZUNhcDEoYSwgYiwgZCwgYywgZSwgZywgaywgbSkgewogICAgICAgIGNvbnN0IG4gPSB0aGlzLl9saW5lT2Zmc2V0OwogICAgICAgIGEgPSBhICsgbiAtIGc7CiAgICAgICAgYiA9IGIgKyBuIC0gZTsKICAgICAgICBkID0gZCArIG4gKyBnOwogICAgICAgIGMgPSBjICsgbiArIGU7CiAgICAgICAgdG1wUXVhZC5zZXQoYSArIGUsIGIgLSBnLCBkICsgZSwgYyAtIGcsIGQgLSBlLCBjICsgZywgYSAtIGUsIGIgKyBnKTsKICAgICAgICB0bXBSZWN0LnNldChrLCAwLCBtLCAwKTsKICAgICAgICB0aGlzLlF1YWQzKHRtcFF1YWQsIHRtcFJlY3QpCiAgICB9CiAgICBUZXh0dXJlZExpbmVQcmVDYWxjX0xpbmVDYXAwKGEsCiAgICAgICAgYiwgZCwgYywgZSwgZywgaywgbSkgewogICAgICAgIGNvbnN0IG4gPSB0aGlzLl9saW5lT2Zmc2V0OwogICAgICAgIGEgKz0gbjsKICAgICAgICBiICs9IG47CiAgICAgICAgZCArPSBuOwogICAgICAgIGMgKz0gbjsKICAgICAgICB0bXBRdWFkLnNldChhICsgZSwgYiAtIGcsIGQgKyBlLCBjIC0gZywgZCAtIGUsIGMgKyBnLCBhIC0gZSwgYiArIGcpOwogICAgICAgIHRtcFJlY3Quc2V0KGssIDAsIG0sIDApOwogICAgICAgIHRoaXMuUXVhZDModG1wUXVhZCwgdG1wUmVjdCkKICAgIH0KICAgIExpbmVSZWN0KGEsIGIsIGQsIGMpIHsKICAgICAgICBjb25zdCBlID0gLjUgKiB0aGlzLl9saW5lV2lkdGgsCiAgICAgICAgICAgIGcgPSB0aGlzLl9saW5lQ2FwOwogICAgICAgIDIgPT09IGcgPyB0aGlzLl9MaW5lUmVjdFByZUNhbGNfTGluZUNhcDIoYSwgYiwgZCwgYywgZSkgOiAxID09PSBnID8gdGhpcy5fTGluZVJlY3RQcmVDYWxjX0xpbmVDYXAxKGEsIGIsIGQsIGMsIGUpIDogdGhpcy5fTGluZVJlY3RQcmVDYWxjX0xpbmVDYXAwKGEsIGIsIGQsIGMsIGUpCiAgICB9CiAgICBfTGluZVJlY3RQcmVDYWxjX0xpbmVDYXAyKGEsIGIsIGQsIGMsIGUpIHsKICAgICAgICB0aGlzLkxpbmVQcmVDYWxjX0xpbmVDYXAyKGEsIGIsIDAsIGQsIGIsIDAsIDAsIGUpOwogICAgICAgIHRoaXMuTGluZVByZUNhbGNfTGluZUNhcDIoZCwgYiwgMCwgZCwgYywgMCwgZSwgMCk7CiAgICAgICAgdGhpcy5MaW5lUHJlQ2FsY19MaW5lQ2FwMihkLAogICAgICAgICAgICBjLCAwLCBhLCBjLCAwLCAwLCAtZSk7CiAgICAgICAgdGhpcy5MaW5lUHJlQ2FsY19MaW5lQ2FwMihhLCBjLCAwLCBhLCBiLCAwLCAtZSwgMCkKICAgIH0KICAgIF9MaW5lUmVjdFByZUNhbGNfTGluZUNhcDEoYSwgYiwgZCwgYywgZSkgewogICAgICAgIHRoaXMuTGluZVByZUNhbGNfTGluZUNhcDEoYSwgYiwgMCwgZCwgYiwgMCwgMCwgZSk7CiAgICAgICAgdGhpcy5MaW5lUHJlQ2FsY19MaW5lQ2FwMShkLCBiLCAwLCBkLCBjLCAwLCBlLCAwKTsKICAgICAgICB0aGlzLkxpbmVQcmVDYWxjX0xpbmVDYXAxKGQsIGMsIDAsIGEsIGMsIDAsIDAsIC1lKTsKICAgICAgICB0aGlzLkxpbmVQcmVDYWxjX0xpbmVDYXAxKGEsIGMsIDAsIGEsIGIsIDAsIC1lLCAwKQogICAgfQogICAgX0xpbmVSZWN0UHJlQ2FsY19MaW5lQ2FwMChhLCBiLCBkLCBjLCBlKSB7CiAgICAgICAgdGhpcy5MaW5lUHJlQ2FsY19MaW5lQ2FwMChhLCBiLCAwLCBkLCBiLCAwLCAwLCBlKTsKICAgICAgICB0aGlzLkxpbmVQcmVDYWxjX0xpbmVDYXAwKGQsIGIsIDAsIGQsIGMsIDAsIGUsIDApOwogICAgICAgIHRoaXMuTGluZVByZUNhbGNfTGluZUNhcDAoZCwgYywgMCwgYSwgYywgMCwgMCwgLWUpOwogICAgICAgIHRoaXMuTGluZVByZUNhbGNfTGluZUNhcDAoYSwgYywgMCwgYSwgYiwgMCwgLWUsIDApCiAgICB9CiAgICBMaW5lUmVjdDIoYSkgewogICAgICAgIHRoaXMuTGluZVJlY3QoYS5nZXRMZWZ0KCksCiAgICAgICAgICAgIGEuZ2V0VG9wKCksIGEuZ2V0UmlnaHQoKSwgYS5nZXRCb3R0b20oKSkKICAgIH0KICAgIExpbmVRdWFkKGEpIHsKICAgICAgICB2YXIgYiA9IEMzJGpzY29tcCQzOC5hbmdsZVRvKGEuZ2V0VGx4KCksIGEuZ2V0VGx5KCksIGEuZ2V0VHJ4KCksIGEuZ2V0VHJ5KCkpLAogICAgICAgICAgICBkID0gLjUgKiB0aGlzLl9saW5lV2lkdGg7CiAgICAgICAgY29uc3QgYyA9IE1hdGguc2luKGIpICogZDsKICAgICAgICBiID0gTWF0aC5jb3MoYikgKiBkOwogICAgICAgIGQgPSB0aGlzLl9saW5lQ2FwOwogICAgICAgIDIgPT09IGQgPyB0aGlzLl9MaW5lUXVhZFByZUNhbGNfTGluZUNhcDIoYSwgYywgYikgOiAxID09PSBkID8gdGhpcy5fTGluZVF1YWRQcmVDYWxjX0xpbmVDYXAxKGEsIGMsIGIpIDogdGhpcy5fTGluZVF1YWRQcmVDYWxjX0xpbmVDYXAwKGEsIGMsIGIpCiAgICB9CiAgICBfTGluZVF1YWRQcmVDYWxjX0xpbmVDYXAyKGEsIGIsIGQpIHsKICAgICAgICB0aGlzLkxpbmVQcmVDYWxjX0xpbmVDYXAyKGEuZ2V0VGx4KCksIGEuZ2V0VGx5KCksIDAsIGEuZ2V0VHJ4KCksIGEuZ2V0VHJ5KCksIDAsIGIsIGQpOwogICAgICAgIHRoaXMuTGluZVByZUNhbGNfTGluZUNhcDIoYS5nZXRUcngoKSwgYS5nZXRUcnkoKSwgMCwgYS5nZXRCcngoKSwgYS5nZXRCcnkoKSwKICAgICAgICAgICAgMCwgZCwgLWIpOwogICAgICAgIHRoaXMuTGluZVByZUNhbGNfTGluZUNhcDIoYS5nZXRCcngoKSwgYS5nZXRCcnkoKSwgMCwgYS5nZXRCbHgoKSwgYS5nZXRCbHkoKSwgMCwgLWIsIC1kKTsKICAgICAgICB0aGlzLkxpbmVQcmVDYWxjX0xpbmVDYXAyKGEuZ2V0Qmx4KCksIGEuZ2V0Qmx5KCksIDAsIGEuZ2V0VGx4KCksIGEuZ2V0VGx5KCksIDAsIC1kLCBiKQogICAgfQogICAgX0xpbmVRdWFkUHJlQ2FsY19MaW5lQ2FwMShhLCBiLCBkKSB7CiAgICAgICAgdGhpcy5MaW5lUHJlQ2FsY19MaW5lQ2FwMShhLmdldFRseCgpLCBhLmdldFRseSgpLCAwLCBhLmdldFRyeCgpLCBhLmdldFRyeSgpLCAwLCBiLCBkKTsKICAgICAgICB0aGlzLkxpbmVQcmVDYWxjX0xpbmVDYXAxKGEuZ2V0VHJ4KCksIGEuZ2V0VHJ5KCksIDAsIGEuZ2V0QnJ4KCksIGEuZ2V0QnJ5KCksIDAsIGQsIC1iKTsKICAgICAgICB0aGlzLkxpbmVQcmVDYWxjX0xpbmVDYXAxKGEuZ2V0QnJ4KCksIGEuZ2V0QnJ5KCksIDAsIGEuZ2V0Qmx4KCksIGEuZ2V0Qmx5KCksIDAsIC1iLCAtZCk7CiAgICAgICAgdGhpcy5MaW5lUHJlQ2FsY19MaW5lQ2FwMShhLmdldEJseCgpLCBhLmdldEJseSgpLCAwLCBhLmdldFRseCgpLAogICAgICAgICAgICBhLmdldFRseSgpLCAwLCAtZCwgYikKICAgIH0KICAgIF9MaW5lUXVhZFByZUNhbGNfTGluZUNhcDAoYSwgYiwgZCkgewogICAgICAgIHRoaXMuTGluZVByZUNhbGNfTGluZUNhcDAoYS5nZXRUbHgoKSwgYS5nZXRUbHkoKSwgMCwgYS5nZXRUcngoKSwgYS5nZXRUcnkoKSwgMCwgYiwgZCk7CiAgICAgICAgdGhpcy5MaW5lUHJlQ2FsY19MaW5lQ2FwMChhLmdldFRyeCgpLCBhLmdldFRyeSgpLCAwLCBhLmdldEJyeCgpLCBhLmdldEJyeSgpLCAwLCBkLCAtYik7CiAgICAgICAgdGhpcy5MaW5lUHJlQ2FsY19MaW5lQ2FwMChhLmdldEJyeCgpLCBhLmdldEJyeSgpLCAwLCBhLmdldEJseCgpLCBhLmdldEJseSgpLCAwLCAtYiwgLWQpOwogICAgICAgIHRoaXMuTGluZVByZUNhbGNfTGluZUNhcDAoYS5nZXRCbHgoKSwgYS5nZXRCbHkoKSwgMCwgYS5nZXRUbHgoKSwgYS5nZXRUbHkoKSwgMCwgLWQsIGIpCiAgICB9CiAgICBTZXRMaW5lV2lkdGgoYSkgewogICAgICAgIHRoaXMuX2xpbmVXaWR0aCA9IGE7CiAgICAgICAgdGhpcy5fbGluZVdpZHRoU3RhY2tbdGhpcy5fbGluZVdpZHRoU3RhY2subGVuZ3RoIC0gMV0gPSBhCiAgICB9CiAgICBHZXRMaW5lV2lkdGgoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2xpbmVXaWR0aAogICAgfQogICAgUHVzaExpbmVXaWR0aChhKSB7CiAgICAgICAgaWYgKDEwMCA8PQogICAgICAgICAgICB0aGlzLl9saW5lV2lkdGhTdGFjay5sZW5ndGgpIHRocm93IEVycm9yKCJwdXNoZWQgdG9vIG1hbnkgbGluZSB3aWR0aHMgLSBjaGVjayBwdXNoL3BvcCBwYWlycyIpOwogICAgICAgIHRoaXMuX2xpbmVXaWR0aFN0YWNrLnB1c2goYSk7CiAgICAgICAgdGhpcy5fbGluZVdpZHRoID0gYQogICAgfQogICAgUG9wTGluZVdpZHRoKCkgewogICAgICAgIGlmICgxID49IHRoaXMuX2xpbmVXaWR0aFN0YWNrLmxlbmd0aCkgdGhyb3cgRXJyb3IoImNhbm5vdCBwb3AgbGFzdCBsaW5lIHdpZHRoIC0gY2hlY2sgcHVzaC9wb3AgcGFpcnMiKTsKICAgICAgICB0aGlzLl9saW5lV2lkdGhTdGFjay5wb3AoKTsKICAgICAgICB0aGlzLl9saW5lV2lkdGggPSB0aGlzLl9saW5lV2lkdGhTdGFjay5hdCgtMSkKICAgIH0KICAgIFNldExpbmVDYXBCdXR0KCkgewogICAgICAgIHRoaXMuX2xpbmVDYXAgPSAwOwogICAgICAgIHRoaXMuX2xpbmVDYXBTdGFja1t0aGlzLl9saW5lQ2FwU3RhY2subGVuZ3RoIC0gMV0gPSAwCiAgICB9CiAgICBTZXRMaW5lQ2FwU3F1YXJlKCkgewogICAgICAgIHRoaXMuX2xpbmVDYXAgPSAxOwogICAgICAgIHRoaXMuX2xpbmVDYXBTdGFja1t0aGlzLl9saW5lQ2FwU3RhY2subGVuZ3RoIC0gMV0gPSAwCiAgICB9CiAgICBTZXRMaW5lQ2FwWmFnKCkgewogICAgICAgIHRoaXMuX2xpbmVDYXAgPQogICAgICAgICAgICAyOwogICAgICAgIHRoaXMuX2xpbmVDYXBTdGFja1t0aGlzLl9saW5lQ2FwU3RhY2subGVuZ3RoIC0gMV0gPSAwCiAgICB9CiAgICBQdXNoTGluZUNhcChhKSB7CiAgICAgICAgaWYgKCJidXR0IiA9PT0gYSkgdGhpcy5QdXNoTGluZUNhcEJ1dHQoKTsKICAgICAgICBlbHNlIGlmICgic3F1YXJlIiA9PT0gYSkgdGhpcy5QdXNoTGluZUNhcFNxdWFyZSgpOwogICAgICAgIGVsc2UgaWYgKCJ6YWciID09PSBhKSB0aGlzLlB1c2hMaW5lQ2FwWmFnKCk7CiAgICAgICAgZWxzZSB0aHJvdyBFcnJvcigiaW52YWxpZCBsaW5lIGNhcCIpOwogICAgfQogICAgUHVzaExpbmVDYXBCdXR0KCkgewogICAgICAgIGlmICgxMDAgPD0gdGhpcy5fbGluZUNhcFN0YWNrLmxlbmd0aCkgdGhyb3cgRXJyb3IoInB1c2hlZCB0b28gbWFueSBsaW5lIGNhcHMgLSBjaGVjayBwdXNoL3BvcCBwYWlycyIpOwogICAgICAgIHRoaXMuX2xpbmVDYXBTdGFjay5wdXNoKDApOwogICAgICAgIHRoaXMuX2xpbmVDYXAgPSAwCiAgICB9CiAgICBQdXNoTGluZUNhcFNxdWFyZSgpIHsKICAgICAgICBpZiAoMTAwIDw9IHRoaXMuX2xpbmVDYXBTdGFjay5sZW5ndGgpIHRocm93IEVycm9yKCJwdXNoZWQgdG9vIG1hbnkgbGluZSBjYXBzIC0gY2hlY2sgcHVzaC9wb3AgcGFpcnMiKTsKICAgICAgICB0aGlzLl9saW5lQ2FwU3RhY2sucHVzaCgxKTsKICAgICAgICB0aGlzLl9saW5lQ2FwID0gMQogICAgfQogICAgUHVzaExpbmVDYXBaYWcoKSB7CiAgICAgICAgaWYgKDEwMCA8PSB0aGlzLl9saW5lQ2FwU3RhY2subGVuZ3RoKSB0aHJvdyBFcnJvcigicHVzaGVkIHRvbyBtYW55IGxpbmUgY2FwcyAtIGNoZWNrIHB1c2gvcG9wIHBhaXJzIik7CiAgICAgICAgdGhpcy5fbGluZUNhcFN0YWNrLnB1c2goMik7CiAgICAgICAgdGhpcy5fbGluZUNhcCA9IDIKICAgIH0KICAgIFBvcExpbmVDYXAoKSB7CiAgICAgICAgaWYgKDEgPj0gdGhpcy5fbGluZUNhcFN0YWNrLmxlbmd0aCkgdGhyb3cgRXJyb3IoImNhbm5vdCBwb3AgbGFzdCBsaW5lIGNhcCAtIGNoZWNrIHB1c2gvcG9wIHBhaXJzIik7CiAgICAgICAgdGhpcy5fbGluZUNhcFN0YWNrLnBvcCgpOwogICAgICAgIHRoaXMuX2xpbmVDYXAgPSB0aGlzLl9saW5lQ2FwU3RhY2suYXQoLTEpCiAgICB9CiAgICBTZXRMaW5lT2Zmc2V0KGEpIHsKICAgICAgICB0aGlzLl9saW5lT2Zmc2V0ID0gYTsKICAgICAgICB0aGlzLl9saW5lT2Zmc2V0U3RhY2tbdGhpcy5fbGluZU9mZnNldFN0YWNrLmxlbmd0aCAtIDFdID0gYQogICAgfQogICAgR2V0TGluZU9mZnNldCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fbGluZU9mZnNldAogICAgfQogICAgUHVzaExpbmVPZmZzZXQoYSkgewogICAgICAgIGlmICgxMDAgPD0KICAgICAgICAgICAgdGhpcy5fbGluZU9mZnNldFN0YWNrLmxlbmd0aCkgdGhyb3cgRXJyb3IoInB1c2hlZCB0b28gbWFueSBsaW5lIG9mZnNldHMgLSBjaGVjayBwdXNoL3BvcCBwYWlycyIpOwogICAgICAgIHRoaXMuX2xpbmVPZmZzZXRTdGFjay5wdXNoKGEpOwogICAgICAgIHRoaXMuX2xpbmVPZmZzZXQgPSBhCiAgICB9CiAgICBQb3BMaW5lT2Zmc2V0KCkgewogICAgICAgIGlmICgxID49IHRoaXMuX2xpbmVPZmZzZXRTdGFjay5sZW5ndGgpIHRocm93IEVycm9yKCJjYW5ub3QgcG9wIGxhc3QgbGluZSBvZmZzZXQgLSBjaGVjayBwdXNoL3BvcCBwYWlycyIpOwogICAgICAgIHRoaXMuX2xpbmVPZmZzZXRTdGFjay5wb3AoKTsKICAgICAgICB0aGlzLl9saW5lT2Zmc2V0ID0gdGhpcy5fbGluZU9mZnNldFN0YWNrLmF0KC0xKQogICAgfQogICAgQ29udmV4UG9seShhKSB7CiAgICAgICAgdmFyIGIgPSBhLmxlbmd0aCAvIDI7CiAgICAgICAgaWYgKDMgPiBiKSB0aHJvdyBFcnJvcigibmVlZCBhdCBsZWFzdCAzIHBvaW50cyIpOwogICAgICAgIGIgLT0gMjsKICAgICAgICBjb25zdCBkID0gYiAtIDEsCiAgICAgICAgICAgIGMgPSBhWzBdLAogICAgICAgICAgICBlID0gYVsxXTsKICAgICAgICBmb3IgKGxldCBnID0gMDsgZyA8IGI7IGcgKz0gMikgewogICAgICAgICAgICBjb25zdCBrID0gMiAqIGcsCiAgICAgICAgICAgICAgICBtID0gYVtrICsgMl0sCiAgICAgICAgICAgICAgICBuID0gYVtrICsgM10sCiAgICAgICAgICAgICAgICBxID0gYVtrICsKICAgICAgICAgICAgICAgICAgICA0XSwKICAgICAgICAgICAgICAgIHUgPSBhW2sgKyA1XTsKICAgICAgICAgICAgZyA9PT0gZCA/IHRoaXMuUXVhZDIoYywgZSwgbSwgbiwgcSwgdSwgcSwgdSkgOiB0aGlzLlF1YWQyKGMsIGUsIG0sIG4sIHEsIHUsIGFbayArIDZdLCBhW2sgKyA3XSkKICAgICAgICB9CiAgICB9CiAgICBHZXROdW1WZXJ0ZXhDb21wb25lbnRzKCkgewogICAgICAgIHJldHVybiAzCiAgICB9CiAgICBGaW5pc2goKSB7CiAgICAgICAgdGhpcy5FbmRCYXRjaCghMCk7CiAgICAgICAgdGhpcy5fZnJhbWVOdW1iZXIrKwogICAgfQogICAgR2V0RnJhbWVOdW1iZXIoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2ZyYW1lTnVtYmVyCiAgICB9CiAgICBJbmNyZW1lbnRGcmFtZU51bWJlcigpIHsKICAgICAgICB0aGlzLl9mcmFtZU51bWJlcisrCiAgICB9CiAgICBTZXRNaXBtYXBzRW5hYmxlZChhKSB7CiAgICAgICAgdGhpcy5fZW5hYmxlTWlwbWFwcyA9ICEhYQogICAgfQogICAgQXJlTWlwbWFwc0VuYWJsZWQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2VuYWJsZU1pcG1hcHMKICAgIH0KICAgIFNldEhhc01ham9yUGVyZm9ybWFuY2VDYXZlYXQoYSkgewogICAgICAgIHRoaXMuX2hhc01ham9yUGVyZm9ybWFuY2VDYXZlYXQgPSAhIWEKICAgIH0KICAgIEhhc01ham9yUGVyZm9ybWFuY2VDYXZlYXQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2hhc01ham9yUGVyZm9ybWFuY2VDYXZlYXQKICAgIH0KICAgIElzV2ViR0woKSB7CiAgICAgICAgcmV0dXJuICExCiAgICB9CiAgICBJc1dlYkdQVSgpIHsKICAgICAgICByZXR1cm4gITEKICAgIH0KfTsKInVzZSBzdHJpY3QiOwpzZWxmLkMzLkdmeC5TaGFkZXJQcm9ncmFtQmFzZSA9IGNsYXNzIHsKICAgIGNvbnN0cnVjdG9yKGEsIGIsIGQpIHsKICAgICAgICB0aGlzLl9uYW1lID0gYjsKICAgICAgICB0aGlzLl9yZW5kZXJlciA9IGE7CiAgICAgICAgdGhpcy5fZXh0ZW5kQm94SG9yaXpvbnRhbCA9IGQuZXh0ZW5kQm94SG9yaXpvbnRhbCB8fCAwOwogICAgICAgIHRoaXMuX2V4dGVuZEJveFZlcnRpY2FsID0gZC5leHRlbmRCb3hWZXJ0aWNhbCB8fCAwOwogICAgICAgIHRoaXMuX2Nyb3NzU2FtcGxpbmcgPSAhIWQuY3Jvc3NTYW1wbGluZzsKICAgICAgICB0aGlzLl9tdXN0UHJlRHJhdyA9ICEhZC5tdXN0UHJlRHJhdzsKICAgICAgICB0aGlzLl9wcmVzZXJ2ZXNPcGFxdWVuZXNzID0gISFkLnByZXNlcnZlc09wYXF1ZW5lc3M7CiAgICAgICAgdGhpcy5fYW5pbWF0ZWQgPSAhIWQuYW5pbWF0ZWQ7CiAgICAgICAgdGhpcy5fYmxlbmRzQmFja2dyb3VuZCA9ICEhZC5ibGVuZHNCYWNrZ3JvdW5kOwogICAgICAgIHRoaXMuX3VzZXNEZXB0aCA9ICEhZC51c2VzRGVwdGg7CiAgICAgICAgdGhpcy5fdXNlc0FueVNyY1JlY3RPclBpeGVsU2l6ZSA9ICExOwogICAgICAgIHRoaXMuX25lZWRzUG9zdERyYXdPckV4dGVuZEJveCA9IHRoaXMuX2Nyb3NzU2FtcGxpbmcgfHwgdGhpcy5fYmxlbmRzQmFja2dyb3VuZCB8fAogICAgICAgICAgICAwICE9PSB0aGlzLl9leHRlbmRCb3hIb3Jpem9udGFsIHx8IDAgIT09IHRoaXMuX2V4dGVuZEJveFZlcnRpY2FsCiAgICB9CiAgICBSZWxlYXNlKCkgewogICAgICAgIHRoaXMuX3JlbmRlcmVyID0gbnVsbAogICAgfQogICAgR2V0UmVuZGVyZXIoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3JlbmRlcmVyCiAgICB9CiAgICBHZXROYW1lKCkgewogICAgICAgIHJldHVybiB0aGlzLl9uYW1lCiAgICB9CiAgICBFeHRlbmRzQm94KCkgewogICAgICAgIHJldHVybiAwICE9PSB0aGlzLl9leHRlbmRCb3hIb3Jpem9udGFsIHx8IDAgIT09IHRoaXMuX2V4dGVuZEJveFZlcnRpY2FsCiAgICB9CiAgICBHZXRCb3hFeHRlbmRIb3Jpem9udGFsKCkgewogICAgICAgIHJldHVybiB0aGlzLl9leHRlbmRCb3hIb3Jpem9udGFsCiAgICB9CiAgICBHZXRCb3hFeHRlbmRWZXJ0aWNhbCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZXh0ZW5kQm94VmVydGljYWwKICAgIH0KICAgIFVzZXNDcm9zc1NhbXBsaW5nKCkgewogICAgICAgIHJldHVybiB0aGlzLl9jcm9zc1NhbXBsaW5nCiAgICB9CiAgICBNdXN0UHJlRHJhdygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fbXVzdFByZURyYXcKICAgIH0KICAgIFByZXNlcnZlc09wYXF1ZW5lc3MoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3ByZXNlcnZlc09wYXF1ZW5lc3MKICAgIH0KICAgIElzQW5pbWF0ZWQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2FuaW1hdGVkCiAgICB9CiAgICBCbGVuZHNCYWNrZ3JvdW5kKCkgewogICAgICAgIHJldHVybiB0aGlzLl9ibGVuZHNCYWNrZ3JvdW5kCiAgICB9CiAgICBVc2VzRGVwdGgoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3VzZXNEZXB0aAogICAgfQogICAgVXNlc0FueVNyY1JlY3RPclBpeGVsU2l6ZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdXNlc0FueVNyY1JlY3RPclBpeGVsU2l6ZQogICAgfQogICAgTmVlZHNQb3N0RHJhd09yRXh0ZW5kc0JveCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fbmVlZHNQb3N0RHJhd09yRXh0ZW5kQm94CiAgICB9CiAgICBVc2VzSXNTcmNUZXhSb3RhdGVkKCkgewogICAgICAgIHJldHVybiAhMQogICAgfQp9OwoidXNlIHN0cmljdCI7CmNvbnN0IEMzJGpzY29tcCQ0MCA9IHNlbGYuQzM7CkMzJGpzY29tcCQ0MC5HZnguU3RhdGVHcm91cCA9IGNsYXNzIHsKICAgIGNvbnN0cnVjdG9yKGEsIGIsIGQsIGMsIGUpIHsKICAgICAgICB0aGlzLl9yZW5kZXJlciA9IGE7CiAgICAgICAgdGhpcy5fcmVmQ291bnQgPSAwOwogICAgICAgIHRoaXMuX3NoYWRlclByb2dyYW0gPSBudWxsOwogICAgICAgIHRoaXMuX3NoYWRlclByb2dyYW1OYW1lID0gIiI7CiAgICAgICAgdGhpcy5fYmxlbmRNb2RlID0gZDsKICAgICAgICB0aGlzLl9jb2xvciA9IEMzJGpzY29tcCQ0MC5OZXcoQzMkanNjb21wJDQwLkNvbG9yKTsKICAgICAgICB0aGlzLl9jb2xvci5zZXQoYyk7CiAgICAgICAgdGhpcy5fekVsZXZhdGlvbiA9IGU7CiAgICAgICAgInN0cmluZyIgPT09IHR5cGVvZiBiID8gdGhpcy5fc2hhZGVyUHJvZ3JhbU5hbWUgPSBiIDogKHRoaXMuX3NoYWRlclByb2dyYW0gPSBiLCB0aGlzLl9zaGFkZXJQcm9ncmFtTmFtZSA9IHRoaXMuX3NoYWRlclByb2dyYW0uR2V0TmFtZSgpKQogICAgfQogICAgUmVsZWFzZSgpIHsKICAgICAgICBpZiAoMCA8IHRoaXMuX3JlZkNvdW50KSB0aHJvdyBFcnJvcigicmVsZWFzaW5nIHN0YXRlIGdyb3VwIHN0aWxsIGluIHVzZSIpOwogICAgICAgIHRoaXMuX3NoYWRlclByb2dyYW0gPSB0aGlzLl9yZW5kZXJlciA9IG51bGw7CiAgICAgICAgdGhpcy5fc2hhZGVyUHJvZ3JhbU5hbWUgPQogICAgICAgICAgICAiIgogICAgfQogICAgQXBwbHkoKSB7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuX3JlbmRlcmVyOwogICAgICAgIGEuU2V0UHJvZ3JhbSh0aGlzLl9zaGFkZXJQcm9ncmFtKTsKICAgICAgICBhLlNldEJsZW5kTW9kZSh0aGlzLl9ibGVuZE1vZGUpOwogICAgICAgIGEuU2V0Q29sb3IodGhpcy5fY29sb3IpOwogICAgICAgIGEuU2V0Q3VycmVudFoodGhpcy5fekVsZXZhdGlvbik7CiAgICAgICAgYS5fU2V0Q3VycmVudFN0YXRlR3JvdXAodGhpcykKICAgIH0KICAgIEdldEtleSgpIHsKICAgICAgICByZXR1cm4gQzMkanNjb21wJDQwLkdmeC5TdGF0ZUdyb3VwLk1ha2VLZXkodGhpcy5fc2hhZGVyUHJvZ3JhbU5hbWUsIHRoaXMuX2JsZW5kTW9kZSwgdGhpcy5fY29sb3IsIHRoaXMuX3pFbGV2YXRpb24pCiAgICB9CiAgICBBZGRSZWYoKSB7CiAgICAgICAgKyt0aGlzLl9yZWZDb3VudAogICAgfQogICAgRGVjUmVmKCkgewogICAgICAgIC0tdGhpcy5fcmVmQ291bnQKICAgIH0KICAgIF9HZXRSZWZDb3VudCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcmVmQ291bnQKICAgIH0KICAgIE9uQ29udGV4dExvc3QoKSB7CiAgICAgICAgdGhpcy5fc2hhZGVyUHJvZ3JhbSA9IG51bGwKICAgIH0KICAgIE9uQ29udGV4dFJlc3RvcmVkKGEpIHsKICAgICAgICB0aGlzLl9zaGFkZXJQcm9ncmFtID0gYS5HZXRTaGFkZXJQcm9ncmFtQnlOYW1lKHRoaXMuX3NoYWRlclByb2dyYW1OYW1lKTsKICAgICAgICBpZiAoIXRoaXMuX3NoYWRlclByb2dyYW0pIHRocm93IEVycm9yKCJmYWlsZWQgdG8gcmVzdG9yZSBzaGFkZXIgcHJvZ3JhbSIpOwogICAgfQogICAgc3RhdGljIE1ha2VLZXkoYSwgYiwgZCwgYykgewogICAgICAgIHJldHVybiAoInN0cmluZyIgPT09IHR5cGVvZiBhID8gYSA6IGEuR2V0TmFtZSgpKSArICIsIiArIGIgKyAiLCIgKyBkLmdldFIoKSArICIsIiArIGQuZ2V0RygpICsgIiwiICsgZC5nZXRCKCkgKyAiLCIgKyBkLmdldEEoKSArICIsIiArIGMKICAgIH0KfTsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkNDEgPSBzZWxmLkMzLAogICAgdGVtcFF1YWRUZXggPSBDMyRqc2NvbXAkNDEuTmV3KEMzJGpzY29tcCQ0MS5RdWFkKTsKCmZ1bmN0aW9uIGludGVycG9sYXRlUXVhZChhLCBiLCBkKSB7CiAgICBjb25zdCBjID0gZC5nZXRUbHgoKSwKICAgICAgICBlID0gZC5nZXRUbHkoKSwKICAgICAgICBnID0gZC5nZXRUcngoKSAtIGMsCiAgICAgICAgayA9IGQuZ2V0VHJ5KCkgLSBlLAogICAgICAgIG0gPSBkLmdldEJseCgpIC0gYzsKICAgIGQgPSBkLmdldEJseSgpIC0gZTsKICAgIHJldHVybiBbYyArIGcgKiBhICsgbSAqIGIsIGUgKyBrICogYSArIGQgKiBiXQp9CkMzJGpzY29tcCQ0MS5HZnguTWVzaFBvaW50ID0gY2xhc3MgewogICAgY29uc3RydWN0b3IoYSwgYiwgZCkgewogICAgICAgIHRoaXMuX21lc2ggPSBhOwogICAgICAgIHRoaXMuX2NvbCA9IGI7CiAgICAgICAgdGhpcy5fcm93ID0gZDsKICAgICAgICB0aGlzLl92ID0gdGhpcy5fdSA9IHRoaXMuX3pFbGV2YXRpb24gPSB0aGlzLl95ID0gdGhpcy5feCA9IDAKICAgIH0KICAgIF9Jbml0KGEsIGIsIGQsIGMpIHsKICAgICAgICB0aGlzLl94ID0gYTsKICAgICAgICB0aGlzLl95ID0gYjsKICAgICAgICB0aGlzLl91ID0gZDsKICAgICAgICB0aGlzLl92ID0gYwogICAgfQogICAgR2V0WCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5feAogICAgfQogICAgU2V0WChhKSB7CiAgICAgICAgdGhpcy5feCAhPT0gYSAmJiAodGhpcy5feCA9IGEsIHRoaXMuX21lc2guX1NldFBvaW50c0NoYW5nZWQoKSkKICAgIH0KICAgIEdldFkoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3kKICAgIH0KICAgIFNldFkoYSkgewogICAgICAgIHRoaXMuX3kgIT09IGEgJiYgKHRoaXMuX3kgPSBhLCB0aGlzLl9tZXNoLl9TZXRQb2ludHNDaGFuZ2VkKCkpCiAgICB9CiAgICBHZXRaRWxldmF0aW9uKCkgewogICAgICAgIHJldHVybiB0aGlzLl96RWxldmF0aW9uCiAgICB9CiAgICBTZXRaRWxldmF0aW9uKGEpIHsKICAgICAgICB0aGlzLl96RWxldmF0aW9uICE9PSBhICYmICh0aGlzLl96RWxldmF0aW9uID0gTWF0aC5tYXgoYSwgMCksIHRoaXMuX21lc2guX1NldFBvaW50c0NoYW5nZWQoKSkKICAgIH0KICAgIEdldFUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3UKICAgIH0KICAgIFNldFUoYSkgewogICAgICAgIHRoaXMuX3UgPQogICAgICAgICAgICBhCiAgICB9CiAgICBHZXRWKCkgewogICAgICAgIHJldHVybiB0aGlzLl92CiAgICB9CiAgICBTZXRWKGEpIHsKICAgICAgICB0aGlzLl92ID0gYQogICAgfQogICAgX0ludGVycG9sYXRlX1RleFJlY3QoYSwgYiwgZCkgewogICAgICAgIFt0aGlzLl94LCB0aGlzLl95XSA9IGludGVycG9sYXRlUXVhZChhLl94LCBhLl95LCBiKTsKICAgICAgICB0aGlzLl96RWxldmF0aW9uID0gYS5fekVsZXZhdGlvbjsKICAgICAgICB0aGlzLl91ID0gQzMkanNjb21wJDQxLmxlcnAoZC5nZXRMZWZ0KCksIGQuZ2V0UmlnaHQoKSwgYS5fdSk7CiAgICAgICAgdGhpcy5fdiA9IEMzJGpzY29tcCQ0MS5sZXJwKGQuZ2V0VG9wKCksIGQuZ2V0Qm90dG9tKCksIGEuX3YpCiAgICB9CiAgICBfSW50ZXJwb2xhdGVfVGV4UXVhZChhLCBiLCBkKSB7CiAgICAgICAgW3RoaXMuX3gsIHRoaXMuX3ldID0gaW50ZXJwb2xhdGVRdWFkKGEuX3gsIGEuX3ksIGIpOwogICAgICAgIHRoaXMuX3pFbGV2YXRpb24gPSBhLl96RWxldmF0aW9uOwogICAgICAgIFt0aGlzLl91LCB0aGlzLl92XSA9IGludGVycG9sYXRlUXVhZChhLl91LCBhLl92LCBkKQogICAgfQogICAgU2F2ZVRvSnNvbigpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICB4OiB0aGlzLkdldFgoKSwKICAgICAgICAgICAgeTogdGhpcy5HZXRZKCksCiAgICAgICAgICAgIHo6IHRoaXMuR2V0WkVsZXZhdGlvbigpLAogICAgICAgICAgICB1OiB0aGlzLkdldFUoKSwKICAgICAgICAgICAgdjogdGhpcy5HZXRWKCkKICAgICAgICB9CiAgICB9CiAgICBMb2FkRnJvbUpzb24oYSkgewogICAgICAgIHRoaXMuU2V0WChhLngpOwogICAgICAgIHRoaXMuU2V0WShhLnkpOwogICAgICAgIGEuaGFzT3duUHJvcGVydHkoInoiKSAmJiB0aGlzLlNldFpFbGV2YXRpb24oYS56KTsKICAgICAgICB0aGlzLlNldFUoYS51KTsKICAgICAgICB0aGlzLlNldFYoYS52KQogICAgfQogICAgR2V0TWVzaCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fbWVzaAogICAgfQogICAgR2V0Q29sdW1uKCkgewogICAgICAgIHJldHVybiB0aGlzLl9jb2wKICAgIH0KICAgIEdldFJvdygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcm93CiAgICB9Cn07CkMzJGpzY29tcCQ0MS5HZnguTWVzaCA9IGNsYXNzIHsKICAgIGNvbnN0cnVjdG9yKGEsIGIsIGQpIHsKICAgICAgICBpZiAoMiA+IGEgfHwgMiA+IGIpIHRocm93IEVycm9yKCJpbnZhbGlkIG1lc2ggc2l6ZSIpOwogICAgICAgIHRoaXMuX2hzaXplID0gYTsKICAgICAgICB0aGlzLl92c2l6ZSA9IGI7CiAgICAgICAgdGhpcy5fb3duZXIgPSBkIHx8IG51bGw7CiAgICAgICAgdGhpcy5fcHRzID0gW107CiAgICAgICAgdGhpcy5fbWluWSA9IHRoaXMuX21pblggPSAwOwogICAgICAgIHRoaXMuX21heFkgPSB0aGlzLl9tYXhYID0gMTsKICAgICAgICB0aGlzLl9tYXhaID0gMDsKICAgICAgICB0aGlzLl9wb2ludHNDaGFuZ2VkID0gITE7CiAgICAgICAgZCA9IGEgLSAxOwogICAgICAgIGNvbnN0IGMgPSBiIC0gMTsKICAgICAgICBmb3IgKGxldCBlID0gMDsgZSA8IGI7ICsrZSkgewogICAgICAgICAgICBjb25zdCBnID0gW107CiAgICAgICAgICAgIGZvciAobGV0IGsgPSAwOyBrIDwgYTsgKytrKSB7CiAgICAgICAgICAgICAgICBjb25zdCBtID0gQzMkanNjb21wJDQxLk5ldyhDMyRqc2NvbXAkNDEuR2Z4Lk1lc2hQb2ludCwgdGhpcywgaywgZSksCiAgICAgICAgICAgICAgICAgICAgbiA9IGsgLyBkLAogICAgICAgICAgICAgICAgICAgIHEgPSBlIC8gYzsKICAgICAgICAgICAgICAgIG0uX0luaXQobiwgcSwgbiwgcSk7CiAgICAgICAgICAgICAgICBnLnB1c2gobSkKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLl9wdHMucHVzaChnKQogICAgICAgIH0KICAgIH0KICAgIFJlbGVhc2UoKSB7CiAgICAgICAgQzMkanNjb21wJDQxLmNsZWFyQXJyYXkodGhpcy5fcHRzKQogICAgfQogICAgR2V0SFNpemUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2hzaXplCiAgICB9CiAgICBHZXRWU2l6ZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdnNpemUKICAgIH0KICAgIEdldE93bmVyKCkgewogICAgICAgIHJldHVybiB0aGlzLl9vd25lcgogICAgfQogICAgX0dldFBvaW50cygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcHRzCiAgICB9CiAgICBfU2V0UG9pbnRzQ2hhbmdlZCgpIHsKICAgICAgICB0aGlzLl9wb2ludHNDaGFuZ2VkID0gITAKICAgIH0KICAgIF9NYXliZUNvbXB1dGVCb3VuZHMoKSB7CiAgICAgICAgaWYgKHRoaXMuX3BvaW50c0NoYW5nZWQpIHsKICAgICAgICAgICAgdmFyIGEgPSBJbmZpbml0eSwKICAgICAgICAgICAgICAgIGIgPSBJbmZpbml0eSwKICAgICAgICAgICAgICAgIGQgPSAtSW5maW5pdHksCiAgICAgICAgICAgICAgICBjID0gLUluZmluaXR5LAogICAgICAgICAgICAgICAgZSA9IDA7CiAgICAgICAgICAgIGZvciAoY29uc3QgZyBvZiB0aGlzLl9wdHMpCiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGsgb2YgZykgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IG0gPSBrLkdldFgoKSwKICAgICAgICAgICAgICAgICAgICAgICAgbiA9IGsuR2V0WSgpOwogICAgICAgICAgICAgICAgICAgIGEgPSBNYXRoLm1pbihhLCBtKTsKICAgICAgICAgICAgICAgICAgICBiID0gTWF0aC5taW4oYiwgbik7CiAgICAgICAgICAgICAgICAgICAgZCA9IE1hdGgubWF4KGQsIG0pOwogICAgICAgICAgICAgICAgICAgIGMgPSBNYXRoLm1heChjLCBuKTsKICAgICAgICAgICAgICAgICAgICBlID0gTWF0aC5tYXgoZSwgay5HZXRaRWxldmF0aW9uKCkpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuX21pblggPSBhOwogICAgICAgICAgICB0aGlzLl9taW5ZID0gYjsKICAgICAgICAgICAgdGhpcy5fbWF4WCA9IGQ7CiAgICAgICAgICAgIHRoaXMuX21heFkgPSBjOwogICAgICAgICAgICB0aGlzLl9tYXhaID0gZTsKICAgICAgICAgICAgdGhpcy5fcG9pbnRzQ2hhbmdlZCA9ICExCiAgICAgICAgfQogICAgfQogICAgR2V0TWluWCgpIHsKICAgICAgICB0aGlzLl9NYXliZUNvbXB1dGVCb3VuZHMoKTsKICAgICAgICByZXR1cm4gdGhpcy5fbWluWAogICAgfQogICAgR2V0TWluWSgpIHsKICAgICAgICB0aGlzLl9NYXliZUNvbXB1dGVCb3VuZHMoKTsKICAgICAgICByZXR1cm4gdGhpcy5fbWluWQogICAgfQogICAgR2V0TWF4WCgpIHsKICAgICAgICB0aGlzLl9NYXliZUNvbXB1dGVCb3VuZHMoKTsKICAgICAgICByZXR1cm4gdGhpcy5fbWF4WAogICAgfQogICAgR2V0TWF4WSgpIHsKICAgICAgICB0aGlzLl9NYXliZUNvbXB1dGVCb3VuZHMoKTsKICAgICAgICByZXR1cm4gdGhpcy5fbWF4WQogICAgfQogICAgR2V0TWF4WigpIHsKICAgICAgICB0aGlzLl9NYXliZUNvbXB1dGVCb3VuZHMoKTsKICAgICAgICByZXR1cm4gdGhpcy5fbWF4WgogICAgfQogICAgSGFzQW55WkVsZXZhdGlvbigpIHsKICAgICAgICByZXR1cm4gMCA8IHRoaXMuR2V0TWF4WigpCiAgICB9CiAgICBHZXRNZXNoUG9pbnRBdChhLCBiKSB7CiAgICAgICAgYSA9IE1hdGguZmxvb3IoYSk7CiAgICAgICAgYiA9IE1hdGguZmxvb3IoYik7CiAgICAgICAgcmV0dXJuIDAgPiBhIHx8IGEgPj0gdGhpcy5faHNpemUgfHwgMCA+IGIgfHwgYiA+PSB0aGlzLl92c2l6ZSA/IG51bGwgOiB0aGlzLl9wdHNbYl1bYV0KICAgIH0KICAgIENhbGN1bGF0ZVRyYW5zZm9ybWVkTWVzaChhLCBiLCBkKSB7CiAgICAgICAgY29uc3QgYyA9IGQgaW5zdGFuY2VvZiBDMyRqc2NvbXAkNDEuUmVjdDsKICAgICAgICBpZiAoYS5HZXRIU2l6ZSgpICE9PSB0aGlzLkdldEhTaXplKCkgfHwgYS5HZXRWU2l6ZSgpICE9PSB0aGlzLkdldFZTaXplKCkpIHRocm93IEVycm9yKCJzb3VyY2UgbWVzaCB3cm9uZyBzaXplIik7CiAgICAgICAgYSA9IGEuX3B0czsKICAgICAgICBjb25zdCBlID0gdGhpcy5fcHRzOwogICAgICAgIGZvciAobGV0IGcgPQogICAgICAgICAgICAgICAgMCwgayA9IGUubGVuZ3RoOyBnIDwgazsgKytnKSB7CiAgICAgICAgICAgIGNvbnN0IG0gPSBhW2ddLAogICAgICAgICAgICAgICAgbiA9IGVbZ107CiAgICAgICAgICAgIGZvciAobGV0IHEgPSAwLCB1ID0gbi5sZW5ndGg7IHEgPCB1OyArK3EpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHcgPSBtW3FdLAogICAgICAgICAgICAgICAgICAgIHogPSBuW3FdOwogICAgICAgICAgICAgICAgYyA/IHouX0ludGVycG9sYXRlX1RleFJlY3QodywgYiwgZCkgOiB6Ll9JbnRlcnBvbGF0ZV9UZXhRdWFkKHcsIGIsIGQpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBEcmF3KGEpIHsKICAgICAgICBjb25zdCBiID0gdGhpcy5fcHRzOwogICAgICAgIGxldCBkID0gYlswXTsKICAgICAgICBmb3IgKGxldCBjID0gMSwgZSA9IGIubGVuZ3RoOyBjIDwgZTsgKytjKSB7CiAgICAgICAgICAgIGNvbnN0IGcgPSBiW2NdOwogICAgICAgICAgICBsZXQgayA9IGRbMF0sCiAgICAgICAgICAgICAgICBtID0gZ1swXTsKICAgICAgICAgICAgZm9yIChsZXQgbiA9IDEsIHEgPSBnLmxlbmd0aDsgbiA8IHE7ICsrbikgewogICAgICAgICAgICAgICAgY29uc3QgdSA9IGRbbl0sCiAgICAgICAgICAgICAgICAgICAgdyA9IGdbbl07CiAgICAgICAgICAgICAgICB0ZW1wUXVhZFRleC5zZXQoay5HZXRVKCksIGsuR2V0VigpLCB1LkdldFUoKSwgdS5HZXRWKCksIHcuR2V0VSgpLCB3LkdldFYoKSwgbS5HZXRVKCksIG0uR2V0VigpKTsKICAgICAgICAgICAgICAgIGEuUXVhZDNEMihrLkdldFgoKSwgay5HZXRZKCksIGsuR2V0WkVsZXZhdGlvbigpLCB1LkdldFgoKSwgdS5HZXRZKCksIHUuR2V0WkVsZXZhdGlvbigpLCB3LkdldFgoKSwgdy5HZXRZKCksIHcuR2V0WkVsZXZhdGlvbigpLAogICAgICAgICAgICAgICAgICAgIG0uR2V0WCgpLCBtLkdldFkoKSwgbS5HZXRaRWxldmF0aW9uKCksIHRlbXBRdWFkVGV4KTsKICAgICAgICAgICAgICAgIGsgPSB1OwogICAgICAgICAgICAgICAgbSA9IHcKICAgICAgICAgICAgfQogICAgICAgICAgICBkID0gZwogICAgICAgIH0KICAgIH0KICAgIE91dGxpbmUoYSwgYikgewogICAgICAgIGIgfHwgKGIgPSAoZSwgZywgaykgPT4gW2UsIGcsIGtdKTsKICAgICAgICBjb25zdCBkID0gdGhpcy5fcHRzOwogICAgICAgIGxldCBjID0gZFswXTsKICAgICAgICBmb3IgKGxldCBlID0gMSwgZyA9IGQubGVuZ3RoOyBlIDwgZzsgKytlKSB7CiAgICAgICAgICAgIGNvbnN0IGsgPSBkW2VdOwogICAgICAgICAgICBsZXQgbSA9IGNbMF0sCiAgICAgICAgICAgICAgICBuID0ga1swXTsKICAgICAgICAgICAgZm9yIChsZXQgcSA9IDEsIHUgPSBrLmxlbmd0aDsgcSA8IHU7ICsrcSkgewogICAgICAgICAgICAgICAgY29uc3QgdyA9IGNbcV0sCiAgICAgICAgICAgICAgICAgICAgeiA9IGtbcV0sCiAgICAgICAgICAgICAgICAgICAgW0MsIEQsIEZdID0gYihtLkdldFgoKSwgbS5HZXRZKCksIG0uR2V0WkVsZXZhdGlvbigpKSwKICAgICAgICAgICAgICAgICAgICBbRSwgSiwgS10gPSBiKHcuR2V0WCgpLCB3LkdldFkoKSwgdy5HZXRaRWxldmF0aW9uKCkpLAogICAgICAgICAgICAgICAgICAgIFtPLCBWLCBXXSA9IGIoei5HZXRYKCksIHouR2V0WSgpLCB6LkdldFpFbGV2YXRpb24oKSksCiAgICAgICAgICAgICAgICAgICAgW2NhLCBsYSwgbWFdID0gYihuLkdldFgoKSwgbi5HZXRZKCksIG4uR2V0WkVsZXZhdGlvbigpKTsKICAgICAgICAgICAgICAgIGEuTGluZTNEKEMsIEQsIEYsIEUsIEosIEspOwogICAgICAgICAgICAgICAgYS5MaW5lM0QoQywgRCwgRiwgTywgViwgVyk7CiAgICAgICAgICAgICAgICBhLkxpbmUzRChDLCBELCBGLCBjYSwgbGEsIG1hKTsKICAgICAgICAgICAgICAgIHEgPT09IHUgLSAxICYmIGEuTGluZTNEKEUsIEosIEssIE8sIFYsIFcpOwogICAgICAgICAgICAgICAgZSA9PT0gZyAtIDEgJiYgYS5MaW5lM0QoY2EsIGxhLCBtYSwgTywgViwgVyk7CiAgICAgICAgICAgICAgICBtID0gdzsKICAgICAgICAgICAgICAgIG4gPSB6CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYyA9IGsKICAgICAgICB9CiAgICB9CiAgICBJbnNlcnRQb2x5TWVzaFZlcnRpY2VzKGEpIHsKICAgICAgICBhID0gYS5wb2ludHNBcnIoKTsKICAgICAgICBjb25zdCBiID0gW10sCiAgICAgICAgICAgIGQgPSB0aGlzLkdldEhTaXplKCkgLSAxLAogICAgICAgICAgICBjID0gdGhpcy5HZXRWU2l6ZSgpIC0gMSwKICAgICAgICAgICAgZSA9IDEgLyBkLAogICAgICAgICAgICBnID0gMSAvIGMsCiAgICAgICAgICAgIGsgPSBkIC0gMSwKICAgICAgICAgICAgbSA9IGMgLSAxOwogICAgICAgIGxldCBuID0gYVswXSwKICAgICAgICAgICAgcSA9IGFbMV0sCiAgICAgICAgICAgIHUgPSBDMyRqc2NvbXAkNDEuY2xhbXAoTWF0aC5mbG9vcihuICogZCksIDAsIGspLAogICAgICAgICAgICB3ID0gQzMkanNjb21wJDQxLmNsYW1wKE1hdGguZmxvb3IocSAqIGMpLCAwLCBtKSwKICAgICAgICAgICAgeiA9IDAsCiAgICAgICAgICAgIEMgPSAwLAogICAgICAgICAgICBEID0gMDsKICAgICAgICB2YXIgRiA9IC0xOwogICAgICAgIGNvbnN0IEUgPSAoKSA9PiB7CiAgICAgICAgICAgIG4gPSBDMyRqc2NvbXAkNDEuY2xhbXAoQzMkanNjb21wJDQxLmxlcnAobiwgeiwgRCksIDAsIDEpOwogICAgICAgICAgICBxID0gQzMkanNjb21wJDQxLmNsYW1wKEMzJGpzY29tcCQ0MS5sZXJwKHEsIEMsIEQpLCAwLCAxKTsKICAgICAgICAgICAgYi5wdXNoKG4sIHEpCiAgICAgICAgfTsKICAgICAgICBmb3IgKGxldCBKID0gMCwgSyA9IGEubGVuZ3RoOyBKIDwgSzsgSiArPSAyKQogICAgICAgICAgICBmb3IgKG4gPSBhW0pdLCBxID0gYVtKICsgMV0sIGIucHVzaChuLAogICAgICAgICAgICAgICAgICAgIHEpLCB1ID0gQzMkanNjb21wJDQxLmNsYW1wKE1hdGguZmxvb3IobiAqIGQpLCAwLCBrKSwgdyA9IEMzJGpzY29tcCQ0MS5jbGFtcChNYXRoLmZsb29yKHEgKiBjKSwgMCwgbSksIEYgPSAoSiArIDIpICUgSywgeiA9IGFbRl0sIEMgPSBhW0YgKyAxXSwgRiA9IC0xOzspIHsKICAgICAgICAgICAgICAgIGlmICgxRTYgPCBiLmxlbmd0aCkgdGhyb3cgRXJyb3IoIlRvbyBtYW55IG1lc2ggcG9seSBwb2ludHMiKTsKICAgICAgICAgICAgICAgIGNvbnN0IE8gPSB1ICogZSwKICAgICAgICAgICAgICAgICAgICBWID0gdyAqIGcsCiAgICAgICAgICAgICAgICAgICAgVyA9ICh1ICsgMSkgKiBlLAogICAgICAgICAgICAgICAgICAgIGNhID0gKHcgKyAxKSAqIGc7CiAgICAgICAgICAgICAgICBDMyRqc2NvbXAkNDEuaXNQb2ludEluVHJpYW5nbGVJbmNsdXNpdmUobiwgcSwgTywgViwgVywgViwgVywgY2EpOwogICAgICAgICAgICAgICAgaWYgKDAgIT09IEYgJiYgKEQgPSBDMyRqc2NvbXAkNDEucmF5SW50ZXJzZWN0RXh0ZW5kZWQobiwgcSwgeiwgQywgTywgViwgVywgY2EsIC0uMDAxKSwgMCA8PSBEICYmIC45OTk5OTk5OSA+PSBEKSkgewogICAgICAgICAgICAgICAgICAgIEUoKTsKICAgICAgICAgICAgICAgICAgICBGID0gMDsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKDAgPCB3ICYmIDIgIT09IEYgJiYgKEQgPSBDMyRqc2NvbXAkNDEucmF5SW50ZXJzZWN0RXh0ZW5kZWQobiwgcSwgeiwgQywgTywgViwgVywgViwgLjAwMSksIDAgPD0gRCAmJiAuOTk5OTk5OTkgPj0gRCkpIHsKICAgICAgICAgICAgICAgICAgICBFKCk7CiAgICAgICAgICAgICAgICAgICAgdy0tOwogICAgICAgICAgICAgICAgICAgIEYgPSA0OwogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodSA8CiAgICAgICAgICAgICAgICAgICAgayAmJiAzICE9PSBGICYmIChEID0gQzMkanNjb21wJDQxLnJheUludGVyc2VjdEV4dGVuZGVkKG4sIHEsIHosIEMsIFcsIFYsIFcsIGNhLCAuMDAxKSwgMCA8PSBEICYmIC45OTk5OTk5OSA+PSBEKSkgewogICAgICAgICAgICAgICAgICAgIEUoKTsKICAgICAgICAgICAgICAgICAgICB1Kys7CiAgICAgICAgICAgICAgICAgICAgRiA9IDE7CiAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICgwIDwgdSAmJiAxICE9PSBGICYmIChEID0gQzMkanNjb21wJDQxLnJheUludGVyc2VjdEV4dGVuZGVkKG4sIHEsIHosIEMsIE8sIFYsIE8sIGNhLCAuMDAxKSwgMCA8PSBEICYmIC45OTk5OTk5OSA+PSBEKSkgewogICAgICAgICAgICAgICAgICAgIEUoKTsKICAgICAgICAgICAgICAgICAgICB1LS07CiAgICAgICAgICAgICAgICAgICAgRiA9IDM7CiAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh3IDwgbSAmJiA0ICE9PSBGICYmIChEID0gQzMkanNjb21wJDQxLnJheUludGVyc2VjdEV4dGVuZGVkKG4sIHEsIHosIEMsIE8sIGNhLCBXLCBjYSwgLjAwMSksIDAgPD0gRCAmJiAuOTk5OTk5OTkgPj0gRCkpIHsKICAgICAgICAgICAgICAgICAgICBFKCk7CiAgICAgICAgICAgICAgICAgICAgdysrOwogICAgICAgICAgICAgICAgICAgIEYgPSAyOwogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICB9CiAgICAgICAgcmV0dXJuIEMzJGpzY29tcCQ0MS5OZXcoQzMkanNjb21wJDQxLkNvbGxpc2lvblBvbHksIGIpCiAgICB9CiAgICBUcmFuc2Zvcm1Db2xsaXNpb25Qb2x5KGEsIGIpIHsKICAgICAgICBhID0gdGhpcy5fVHJhbnNmb3JtUG9seVBvaW50cyhhKTsKICAgICAgICB0aGlzLl9TaW1wbGlmeVBvbHkoYSk7CiAgICAgICAgYi5zZXRQb2ludHMoYSkKICAgIH0KICAgIF9UcmFuc2Zvcm1Qb2x5UG9pbnRzKGEpIHsKICAgICAgICBjb25zdCBiID0gW107CiAgICAgICAgYSA9IGEucG9pbnRzQXJyKCk7CiAgICAgICAgZm9yIChsZXQgZCA9IDAsIGMgPSBhLmxlbmd0aDsgZCA8IGM7IGQgKz0gMikgewogICAgICAgICAgICBjb25zdCBbZSwgZ10gPSB0aGlzLlRyYW5zZm9ybVBvaW50KGFbZF0sIGFbZCArIDFdKTsKICAgICAgICAgICAgYi5wdXNoKGUsIGcpCiAgICAgICAgfQogICAgICAgIHJldHVybiBiCiAgICB9CiAgICBUcmFuc2Zvcm1Qb2ludChhLCBiKSB7CiAgICAgICAgdmFyIGQgPSB0aGlzLkdldEhTaXplKCkgLSAxLAogICAgICAgICAgICBjID0gdGhpcy5HZXRWU2l6ZSgpIC0gMSwKICAgICAgICAgICAgZSA9IDEgLyBkLAogICAgICAgICAgICBnID0gMSAvIGM7CiAgICAgICAgZCA9IEMzJGpzY29tcCQ0MS5jbGFtcChNYXRoLmZsb29yKGEgKiBkKSwgMCwgZCAtIDEpOwogICAgICAgIGNvbnN0IGsgPSBDMyRqc2NvbXAkNDEuY2xhbXAoTWF0aC5mbG9vcihiICogYyksIDAsIGMgLSAxKTsKICAgICAgICBjID0gZCAqIGU7CiAgICAgICAgY29uc3QgbSA9IGsgKiBnLAogICAgICAgICAgICBuID0gKGQgKyAxKSAqIGUsCiAgICAgICAgICAgIHEgPSAoayArIDEpICogZywKICAgICAgICAgICAgdSA9IHRoaXMuR2V0TWVzaFBvaW50QXQoZCwgayksCiAgICAgICAgICAgIHcgPSB0aGlzLkdldE1lc2hQb2ludEF0KGQgKyAxLCBrICsgMSksCiAgICAgICAgICAgIHogPSBDMyRqc2NvbXAkNDEuaXNQb2ludEluVHJpYW5nbGVJbmNsdXNpdmUoYSwgYiwgYywgbSwgbiwgbSwgbiwgcSk7CiAgICAgICAgZSA9IHogPyBjICsgZSA6IGM7CiAgICAgICAgZyA9IHogPyBtIDogbSArIGc7CiAgICAgICAgZCA9IHRoaXMuR2V0TWVzaFBvaW50QXQoZCArICh6ID8gMSA6IDApLCBrICsgKHogPyAwIDoKICAgICAgICAgICAgMSkpOwogICAgICAgIGNvbnN0IFtDLCBELCBGXSA9IEMzJGpzY29tcCQ0MS50cmlhbmdsZUNhcnRlc2lhblRvQmFyeWNlbnRyaWMoYSwgYiwgYywgbSwgZSwgZywgbiwgcSk7CiAgICAgICAgcmV0dXJuIEMzJGpzY29tcCQ0MS50cmlhbmdsZUJhcnljZW50cmljVG9DYXJ0ZXNpYW4oQywgRCwgRiwgdS5HZXRYKCksIHUuR2V0WSgpLCBkLkdldFgoKSwgZC5HZXRZKCksIHcuR2V0WCgpLCB3LkdldFkoKSkKICAgIH0KICAgIF9TaW1wbGlmeVBvbHkoYSkgewogICAgICAgIGNvbnN0IGIgPSBbXTsKICAgICAgICBsZXQgZCA9IGFbMF0sCiAgICAgICAgICAgIGMgPSBhWzFdLAogICAgICAgICAgICBlID0gZCAtIGEuYXQoLTIpLAogICAgICAgICAgICBnID0gYyAtIGEuYXQoLTEpOwogICAgICAgIGZvciAobGV0IG0gPSAwLCBuID0gYS5sZW5ndGg7IG0gPCBuOyBtICs9IDIpIHsKICAgICAgICAgICAgdmFyIGsgPSAobSArIDIpICUgbjsKICAgICAgICAgICAgY29uc3QgcSA9IGFba107CiAgICAgICAgICAgIGsgPSBhW2sgKyAxXTsKICAgICAgICAgICAgY29uc3QgdSA9IHEgLSBkLAogICAgICAgICAgICAgICAgdyA9IGsgLSBjLAogICAgICAgICAgICAgICAgeiA9IDFFLTcgPiBNYXRoLmFicyh3KSAmJiAxRS03ID4gTWF0aC5hYnMoZykgJiYgTWF0aC5zaWduKHUpID09PSBNYXRoLnNpZ24oZSk7CiAgICAgICAgICAgICghKDFFLTcgPiBNYXRoLmFicyh1KSAmJiAxRS03ID4gTWF0aC5hYnMoZSkgJiYgTWF0aC5zaWduKHcpID09PSBNYXRoLnNpZ24oZykgfHwgeikgJiYgLjAwMSA8IE1hdGguYWJzKHUgLwogICAgICAgICAgICAgICAgZSAtIHcgLyBnKSB8fCAwID09IHUgJiYgMCA9PT0gdykgJiYgYi5wdXNoKGQsIGMpOwogICAgICAgICAgICBkID0gcTsKICAgICAgICAgICAgYyA9IGs7CiAgICAgICAgICAgIGUgPSB1OwogICAgICAgICAgICBnID0gdwogICAgICAgIH0KICAgICAgICA2IDw9IGIubGVuZ3RoICYmIGIubGVuZ3RoIDwgYS5sZW5ndGggJiYgQzMkanNjb21wJDQxLnNoYWxsb3dBc3NpZ25BcnJheShhLCBiKQogICAgfQogICAgU2F2ZVRvSnNvbigpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBjb2xzOiB0aGlzLkdldEhTaXplKCksCiAgICAgICAgICAgIHJvd3M6IHRoaXMuR2V0VlNpemUoKSwKICAgICAgICAgICAgcG9pbnRzOiB0aGlzLl9wdHMubWFwKGEgPT4gYS5tYXAoYiA9PiBiLlNhdmVUb0pzb24oKSkpCiAgICAgICAgfQogICAgfQogICAgTG9hZEZyb21Kc29uKGEpIHsKICAgICAgICBjb25zdCBiID0gdGhpcy5HZXRIU2l6ZSgpLAogICAgICAgICAgICBkID0gdGhpcy5HZXRWU2l6ZSgpOwogICAgICAgIGlmIChhLmNvbHMgIT09IGIgfHwgYS5yb3dzICE9PSBkKSB0aHJvdyBFcnJvcigibWVzaCBkYXRhIHdyb25nIHNpemUiKTsKICAgICAgICBhID0gYS5wb2ludHM7CiAgICAgICAgZm9yIChsZXQgYyA9IDA7IGMgPCBkOyArK2MpIHsKICAgICAgICAgICAgY29uc3QgZSA9IGFbY107CiAgICAgICAgICAgIGZvciAobGV0IGcgPSAwOyBnIDwgYjsgKytnKSB0aGlzLkdldE1lc2hQb2ludEF0KGcsIGMpLkxvYWRGcm9tSnNvbihlW2ddKQogICAgICAgIH0KICAgIH0KfTsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkNDIgPSBzZWxmLkMzLAogICAgVkFMSURfUElYRUxfRk9STUFUUyA9IG5ldyBTZXQoWyJyZ2JhOCIsICJyZ2I4IiwgInJnYmE0IiwgInJnYjVfYTEiLCAicmdiNTY1Il0pLAogICAgVkFMSURfU0FNUExJTkdTID0gbmV3IFNldChbIm5lYXJlc3QiLCAiYmlsaW5lYXIiLCAidHJpbGluZWFyIl0pLAogICAgVkFMSURfTUlQTUFQX1FVQUxJVElFUyA9IG5ldyBTZXQoWyJkZWZhdWx0IiwgImxvdyIsICJoaWdoIl0pLAogICAgVkFMSURfV1JBUF9NT0RFUyA9IG5ldyBTZXQoWyJjbGFtcC10by1lZGdlIiwgInJlcGVhdCIsICJtaXJyb3ItcmVwZWF0Il0pOwoKZnVuY3Rpb24gR2V0Rm9ybWF0U3BlY2lmaWVycyhhLCBiKSB7CiAgICBsZXQgZCwgYzsKICAgIHN3aXRjaCAoYSkgewogICAgICAgIGNhc2UgInJnYmE4IjoKICAgICAgICAgICAgYSA9IGIuUkdCQTg7CiAgICAgICAgICAgIGMgPSBkID0gYi5SR0JBOwogICAgICAgICAgICBiID0gYi5VTlNJR05FRF9CWVRFOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJyZ2I4IjoKICAgICAgICAgICAgYSA9IGIuUkdCODsKICAgICAgICAgICAgYyA9IGQgPSBiLlJHQjsKICAgICAgICAgICAgYiA9IGIuVU5TSUdORURfQllURTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAicmdiYTQiOgogICAgICAgICAgICBhID0gYi5SR0JBNDsKICAgICAgICAgICAgYyA9IGQgPSBiLlJHQkE7CiAgICAgICAgICAgIGIgPSBiLlVOU0lHTkVEX1NIT1JUXzRfNF80XzQ7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgInJnYjVfYTEiOgogICAgICAgICAgICBhID0gYi5SR0I1X0ExOwogICAgICAgICAgICBjID0gZCA9IGIuUkdCQTsKICAgICAgICAgICAgYiA9IGIuVU5TSUdORURfU0hPUlRfNV81XzVfMTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAicmdiNTY1IjoKICAgICAgICAgICAgYSA9IGIuUkdCNTY1OwogICAgICAgICAgICBjID0gZCA9IGIuUkdCOwogICAgICAgICAgICBiID0gYi5VTlNJR05FRF9TSE9SVF81XzZfNTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgdGhyb3cgRXJyb3IoImludmFsaWQgcGl4ZWwgZm9ybWF0Iik7CiAgICB9CiAgICByZXR1cm4gewogICAgICAgIHNpemVkaW50ZXJuYWxmb3JtYXQ6IGEsCiAgICAgICAgaW50ZXJuYWxmb3JtYXQ6IGQsCiAgICAgICAgZm9ybWF0OiBjLAogICAgICAgIHR5cGU6IGIKICAgIH0KfQpjb25zdCBDUkVBVEVGUk9NX0RFRkFVTFRfT1BUSU9OUyA9IHsKICAgICAgICB3cmFwWDogImNsYW1wLXRvLWVkZ2UiLAogICAgICAgIHdyYXBZOiAiY2xhbXAtdG8tZWRnZSIsCiAgICAgICAgc2FtcGxpbmc6ICJ0cmlsaW5lYXIiLAogICAgICAgIGFuaXNvdHJvcHk6IDAsCiAgICAgICAgcGl4ZWxGb3JtYXQ6ICJyZ2JhOCIsCiAgICAgICAgbWlwTWFwOiAhMCwKICAgICAgICBtaXBNYXBRdWFsaXR5OiAiZGVmYXVsdCIsCiAgICAgICAgcHJlbXVsdGlwbHlBbHBoYTogITAsCiAgICAgICAgaXNTdmc6ICExLAogICAgICAgIHdpZHRoOiAtMSwKICAgICAgICBoZWlnaHQ6IC0xCiAgICB9LAogICAgVVBEQVRFX0RFRkFVTFRfT1BUSU9OUyA9IHsKICAgICAgICBwcmVtdWx0aXBseUFscGhhOiAhMCwKICAgICAgICBmbGlwWTogITEKICAgIH0sCiAgICBhbGxUZXh0dXJlcyA9IG5ldyBTZXQ7CkMzJGpzY29tcCQ0Mi5HZnguV2ViR0xSZW5kZXJlclRleHR1cmUgPSBjbGFzcyB7CiAgICBjb25zdHJ1Y3RvcihhKSB7CiAgICAgICAgdGhpcy5fcmVuZGVyZXIgPSBhOwogICAgICAgIHRoaXMuX3RleHR1cmUgPSBudWxsOwogICAgICAgIHRoaXMuX2hlaWdodCA9IHRoaXMuX3dpZHRoID0gMDsKICAgICAgICB0aGlzLl9pc1N0YXRpYyA9ICEwOwogICAgICAgIHRoaXMuX3dyYXBZID0gdGhpcy5fd3JhcFggPSAiY2xhbXAtdG8tZWRnZSI7CiAgICAgICAgdGhpcy5fc2FtcGxpbmcgPSAidHJpbGluZWFyIjsKICAgICAgICB0aGlzLl9hbmlzb3Ryb3B5ID0gMDsKICAgICAgICB0aGlzLl9waXhlbEZvcm1hdCA9ICJyZ2JhOCI7CiAgICAgICAgdGhpcy5faXNNaXBNYXBwZWQgPSAhMTsKICAgICAgICB0aGlzLl9taXBNYXBRdWFsaXR5ID0gImRlZmF1bHQiOwogICAgICAgIHRoaXMuX3JlZkNvdW50ID0gMAogICAgfQogICAgX0NyZWF0ZVN0YXRpYyhhLCBiKSB7CiAgICAgICAgaWYgKCEoInVuZGVmaW5lZCIgIT09IHR5cGVvZiBIVE1MSW1hZ2VFbGVtZW50ICYmIGEgaW5zdGFuY2VvZiBIVE1MSW1hZ2VFbGVtZW50IHx8ICJ1bmRlZmluZWQiICE9PSB0eXBlb2YgSFRNTENhbnZhc0VsZW1lbnQgJiYgYSBpbnN0YW5jZW9mIEhUTUxDYW52YXNFbGVtZW50IHx8ICJ1bmRlZmluZWQiICE9PSB0eXBlb2YgSW1hZ2VCaXRtYXAgJiYKICAgICAgICAgICAgICAgIGEgaW5zdGFuY2VvZiBJbWFnZUJpdG1hcCB8fCAidW5kZWZpbmVkIiAhPT0gdHlwZW9mIE9mZnNjcmVlbkNhbnZhcyAmJiBhIGluc3RhbmNlb2YgT2Zmc2NyZWVuQ2FudmFzIHx8IGEgaW5zdGFuY2VvZiBJbWFnZURhdGEgfHwgYSBpbnN0YW5jZW9mIEFycmF5QnVmZmVyKSAmJiBudWxsICE9PSBhKSB0aHJvdyBFcnJvcigiaW52YWxpZCB0ZXh0dXJlIHNvdXJjZSIpOwogICAgICAgIGIgPSBPYmplY3QuYXNzaWduKHt9LCBDUkVBVEVGUk9NX0RFRkFVTFRfT1BUSU9OUywgYik7CiAgICAgICAgaWYgKHRoaXMuX3RleHR1cmUpIHRocm93IEVycm9yKCJhbHJlYWR5IGNyZWF0ZWQgdGV4dHVyZSIpOwogICAgICAgIHRoaXMuX3dyYXBYID0gYi53cmFwWDsKICAgICAgICB0aGlzLl93cmFwWSA9IGIud3JhcFk7CiAgICAgICAgdGhpcy5fc2FtcGxpbmcgPSBiLnNhbXBsaW5nOwogICAgICAgIHRoaXMuX2FuaXNvdHJvcHkgPSBiLmFuaXNvdHJvcHk7CiAgICAgICAgdGhpcy5fcGl4ZWxGb3JtYXQgPSBiLnBpeGVsRm9ybWF0OwogICAgICAgIHRoaXMuX2lzTWlwTWFwcGVkID0gISFiLm1pcE1hcCAmJiB0aGlzLl9yZW5kZXJlci5BcmVNaXBtYXBzRW5hYmxlZCgpOwogICAgICAgIHRoaXMuX21pcE1hcFF1YWxpdHkgPQogICAgICAgICAgICBiLm1pcE1hcFF1YWxpdHk7CiAgICAgICAgaWYgKCFWQUxJRF9XUkFQX01PREVTLmhhcyh0aGlzLl93cmFwWCkgfHwgIVZBTElEX1dSQVBfTU9ERVMuaGFzKHRoaXMuX3dyYXBZKSkgdGhyb3cgRXJyb3IoImludmFsaWQgd3JhcCBtb2RlIik7CiAgICAgICAgaWYgKCFWQUxJRF9TQU1QTElOR1MuaGFzKHRoaXMuX3NhbXBsaW5nKSkgdGhyb3cgRXJyb3IoImludmFsaWQgc2FtcGxpbmciKTsKICAgICAgICBpZiAoIVZBTElEX1BJWEVMX0ZPUk1BVFMuaGFzKHRoaXMuX3BpeGVsRm9ybWF0KSkgdGhyb3cgRXJyb3IoImludmFsaWQgcGl4ZWwgZm9ybWF0Iik7CiAgICAgICAgaWYgKCFWQUxJRF9NSVBNQVBfUVVBTElUSUVTLmhhcyh0aGlzLl9taXBNYXBRdWFsaXR5KSkgdGhyb3cgRXJyb3IoImludmFsaWQgbWlwbWFwIHF1YWxpdHkiKTsKICAgICAgICB0aGlzLl9pc1N0YXRpYyA9ICEwOwogICAgICAgIGlmIChhIGluc3RhbmNlb2YgQXJyYXlCdWZmZXIgfHwgbnVsbCA9PT0gYSB8fCBiLmlzU3ZnKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl93aWR0aCA9IGIud2lkdGgsIHRoaXMuX2hlaWdodCA9IGIuaGVpZ2h0LCBhIGluc3RhbmNlb2YgQXJyYXlCdWZmZXIgJiYKICAgICAgICAgICAgICAgIGEuYnl0ZUxlbmd0aCAhPT0gdGhpcy5fd2lkdGggKiB0aGlzLl9oZWlnaHQgKiA0KSB0aHJvdyBFcnJvcigiQXJyYXlCdWZmZXIgd3Jvbmcgc2l6ZSIpOwogICAgICAgIH0gZWxzZSB0aGlzLl93aWR0aCA9IGEud2lkdGgsIHRoaXMuX2hlaWdodCA9IGEuaGVpZ2h0OwogICAgICAgIGlmICgwID49IHRoaXMuX3dpZHRoIHx8IDAgPj0gdGhpcy5faGVpZ2h0KSB0aHJvdyBFcnJvcigiaW52YWxpZCB0ZXh0dXJlIGRhdGEgc2l6ZSIpOwogICAgICAgIGlmIChiLmlzU3ZnKSB7CiAgICAgICAgICAgIHZhciBkID0gQzMkanNjb21wJDQyLkNyZWF0ZUNhbnZhcyh0aGlzLl93aWR0aCwgdGhpcy5faGVpZ2h0KTsKICAgICAgICAgICAgZC5nZXRDb250ZXh0KCIyZCIpLmRyYXdJbWFnZShhLCAwLCAwLCB0aGlzLl93aWR0aCwgdGhpcy5faGVpZ2h0KTsKICAgICAgICAgICAgYSA9IGQKICAgICAgICB9CiAgICAgICAgdmFyIGMgPSBDMyRqc2NvbXAkNDIuaXNQT1QodGhpcy5fd2lkdGgpICYmIEMzJGpzY29tcCQ0Mi5pc1BPVCh0aGlzLl9oZWlnaHQpOwogICAgICAgIGQgPSB0aGlzLl9yZW5kZXJlci5HZXRNYXhUZXh0dXJlU2l6ZSgpOwogICAgICAgIGlmICh0aGlzLl93aWR0aCA+IGQgfHwgdGhpcy5faGVpZ2h0ID4gZCkgdGhyb3cgRXJyb3IoInRleHR1cmUgZGF0YSBleGNlZWRzIG1heGltdW0gdGV4dHVyZSBzaXplIik7CiAgICAgICAgZCA9IHRoaXMuX3JlbmRlcmVyLkdldENvbnRleHQoKTsKICAgICAgICB2YXIgZSA9IHRoaXMuX3JlbmRlcmVyLkdldFdlYkdMVmVyc2lvbk51bWJlcigpOwogICAgICAgIHRoaXMuX3RleHR1cmUgPSBkLmNyZWF0ZVRleHR1cmUoKTsKICAgICAgICBkLmJpbmRUZXh0dXJlKGQuVEVYVFVSRV8yRCwgdGhpcy5fdGV4dHVyZSk7CiAgICAgICAgZC5waXhlbFN0b3JlaShkLlVOUEFDS19QUkVNVUxUSVBMWV9BTFBIQV9XRUJHTCwgYi5wcmVtdWx0aXBseUFscGhhKTsKICAgICAgICBkLnBpeGVsU3RvcmVpKGQuVU5QQUNLX0ZMSVBfWV9XRUJHTCwgITEpOwogICAgICAgIGIgPSBHZXRGb3JtYXRTcGVjaWZpZXJzKHRoaXMuX3BpeGVsRm9ybWF0LCBkKTsKICAgICAgICBpZiAodGhpcy5fcmVuZGVyZXIuU3VwcG9ydHNOUE9UVGV4dHVyZXMoKSB8fCBjIHx8ICF0aGlzLl9Jc1RpbGVkKCkpIDIgPD0gZSA/IChkLnRleFN0b3JhZ2UyRChkLlRFWFRVUkVfMkQsIHRoaXMuX2lzTWlwTWFwcGVkID8gTWF0aC5mbG9vcihNYXRoLmxvZzIoTWF0aC5tYXgodGhpcy5fd2lkdGgsIHRoaXMuX2hlaWdodCkpICsgMSkgOiAxLCBiLnNpemVkaW50ZXJuYWxmb3JtYXQsIHRoaXMuX3dpZHRoLAogICAgICAgICAgICB0aGlzLl9oZWlnaHQpLCBhIGluc3RhbmNlb2YgQXJyYXlCdWZmZXIgPyBkLnRleFN1YkltYWdlMkQoZC5URVhUVVJFXzJELCAwLCAwLCAwLCB0aGlzLl93aWR0aCwgdGhpcy5faGVpZ2h0LCBiLmZvcm1hdCwgYi50eXBlLCBuZXcgVWludDhBcnJheShhKSkgOiBudWxsICE9PSBhICYmIGQudGV4U3ViSW1hZ2UyRChkLlRFWFRVUkVfMkQsIDAsIDAsIDAsIGIuZm9ybWF0LCBiLnR5cGUsIGEpKSA6IGEgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlciA/IGQudGV4SW1hZ2UyRChkLlRFWFRVUkVfMkQsIDAsIGIuaW50ZXJuYWxmb3JtYXQsIHRoaXMuX3dpZHRoLCB0aGlzLl9oZWlnaHQsIDAsIGIuZm9ybWF0LCBiLnR5cGUsIG5ldyBVaW50OEFycmF5KGEpKSA6IG51bGwgPT09IGEgPyBkLnRleEltYWdlMkQoZC5URVhUVVJFXzJELCAwLCBiLmludGVybmFsZm9ybWF0LCB0aGlzLl93aWR0aCwgdGhpcy5faGVpZ2h0LCAwLCBiLmZvcm1hdCwgYi50eXBlLCBudWxsKSA6IGQudGV4SW1hZ2UyRChkLlRFWFRVUkVfMkQsIDAsIGIuaW50ZXJuYWxmb3JtYXQsIGIuZm9ybWF0LCBiLnR5cGUsIGEpOwogICAgICAgIGVsc2UgewogICAgICAgICAgICBpZiAobnVsbCA9PT0KICAgICAgICAgICAgICAgIGEpIHRocm93IEVycm9yKCJjYW5ub3QgcGFzcyBudWxsIGRhdGEgd2hlbiBjcmVhdGluZyBhIE5QT1QgdGlsZWQgdGV4dHVyZSB3aXRob3V0IE5QT1Qgc3VwcG9ydCIpOwogICAgICAgICAgICBhIGluc3RhbmNlb2YgQXJyYXlCdWZmZXIgJiYgKGEgPSBuZXcgSW1hZ2VEYXRhKG5ldyBVaW50OENsYW1wZWRBcnJheShhKSwgdGhpcy5fd2lkdGgsIHRoaXMuX2hlaWdodCkpOwogICAgICAgICAgICBhIGluc3RhbmNlb2YgSW1hZ2VEYXRhICYmIChjID0gQzMkanNjb21wJDQyLkNyZWF0ZUNhbnZhcyh0aGlzLl93aWR0aCwgdGhpcy5faGVpZ2h0KSwgYy5nZXRDb250ZXh0KCIyZCIpLnB1dEltYWdlRGF0YShhLCAwLCAwKSwgYSA9IGMpOwogICAgICAgICAgICBjID0gQzMkanNjb21wJDQyLkNyZWF0ZUNhbnZhcyhDMyRqc2NvbXAkNDIubmV4dEhpZ2hlc3RQb3dlck9mVHdvKHRoaXMuX3dpZHRoKSwgQzMkanNjb21wJDQyLm5leHRIaWdoZXN0UG93ZXJPZlR3byh0aGlzLl9oZWlnaHQpKTsKICAgICAgICAgICAgZSA9IGMuZ2V0Q29udGV4dCgiMmQiKTsKICAgICAgICAgICAgZS5pbWFnZVNtb290aGluZ0VuYWJsZWQgPSAibmVhcmVzdCIgIT09IHRoaXMuX3NhbXBsaW5nOwogICAgICAgICAgICBlLmRyYXdJbWFnZShhLCAwLCAwLCB0aGlzLl93aWR0aCwgdGhpcy5faGVpZ2h0LCAwLCAwLCBjLndpZHRoLCBjLmhlaWdodCk7CiAgICAgICAgICAgIGQudGV4SW1hZ2UyRChkLlRFWFRVUkVfMkQsIDAsIGIuaW50ZXJuYWxmb3JtYXQsIGIuZm9ybWF0LCBiLnR5cGUsIGMpCiAgICAgICAgfQogICAgICAgIG51bGwgIT09IGEgJiYgdGhpcy5fU2V0VGV4dHVyZVBhcmFtZXRlcnMoZCk7CiAgICAgICAgZC5iaW5kVGV4dHVyZShkLlRFWFRVUkVfMkQsIG51bGwpOwogICAgICAgIHRoaXMuX3JlbmRlcmVyLl9SZXNldExhc3RUZXh0dXJlKCk7CiAgICAgICAgdGhpcy5fcmVmQ291bnQgPSAxOwogICAgICAgIGFsbFRleHR1cmVzLmFkZCh0aGlzKQogICAgfQogICAgX0NyZWF0ZUR5bmFtaWMoYSwgYiwgZCkgewogICAgICAgIGQgPSBPYmplY3QuYXNzaWduKHt9LCBDUkVBVEVGUk9NX0RFRkFVTFRfT1BUSU9OUywgZCk7CiAgICAgICAgaWYgKHRoaXMuX3RleHR1cmUpIHRocm93IEVycm9yKCJhbHJlYWR5IGNyZWF0ZWQgdGV4dHVyZSIpOwogICAgICAgIHRoaXMuX3dyYXBYID0gZC53cmFwWDsKICAgICAgICB0aGlzLl93cmFwWSA9IGQud3JhcFk7CiAgICAgICAgdGhpcy5fc2FtcGxpbmcgPSBkLnNhbXBsaW5nOwogICAgICAgIHRoaXMuX3BpeGVsRm9ybWF0ID0gZC5waXhlbEZvcm1hdDsKICAgICAgICB0aGlzLl9pc01pcE1hcHBlZCA9ICEhZC5taXBNYXAgJiYgdGhpcy5fcmVuZGVyZXIuQXJlTWlwbWFwc0VuYWJsZWQoKTsKICAgICAgICB0aGlzLl9taXBNYXBRdWFsaXR5ID0gZC5taXBNYXBRdWFsaXR5OwogICAgICAgIGlmICghVkFMSURfV1JBUF9NT0RFUy5oYXModGhpcy5fd3JhcFgpIHx8ICFWQUxJRF9XUkFQX01PREVTLmhhcyh0aGlzLl93cmFwWSkpIHRocm93IEVycm9yKCJpbnZhbGlkIHdyYXAgbW9kZSIpOwogICAgICAgIGlmICghVkFMSURfU0FNUExJTkdTLmhhcyh0aGlzLl9zYW1wbGluZykpIHRocm93IEVycm9yKCJpbnZhbGlkIHNhbXBsaW5nIik7CiAgICAgICAgaWYgKCFWQUxJRF9QSVhFTF9GT1JNQVRTLmhhcyh0aGlzLl9waXhlbEZvcm1hdCkpIHRocm93IEVycm9yKCJpbnZhbGlkIHBpeGVsIGZvcm1hdCIpOwogICAgICAgIGlmICghVkFMSURfTUlQTUFQX1FVQUxJVElFUy5oYXModGhpcy5fbWlwTWFwUXVhbGl0eSkpIHRocm93IEVycm9yKCJpbnZhbGlkIG1pcG1hcCBxdWFsaXR5Iik7CiAgICAgICAgdGhpcy5faXNTdGF0aWMgPSAhMTsKICAgICAgICB0aGlzLl93aWR0aCA9IE1hdGguZmxvb3IoYSk7CiAgICAgICAgdGhpcy5faGVpZ2h0ID0KICAgICAgICAgICAgTWF0aC5mbG9vcihiKTsKICAgICAgICBhID0gQzMkanNjb21wJDQyLmlzUE9UKHRoaXMuX3dpZHRoKSAmJiBDMyRqc2NvbXAkNDIuaXNQT1QodGhpcy5faGVpZ2h0KTsKICAgICAgICBiID0gdGhpcy5fcmVuZGVyZXIuR2V0TWF4VGV4dHVyZVNpemUoKTsKICAgICAgICBpZiAoMCA+PSB0aGlzLl93aWR0aCB8fCAwID49IHRoaXMuX2hlaWdodCkgdGhyb3cgRXJyb3IoImludmFsaWQgdGV4dHVyZSBzaXplIik7CiAgICAgICAgaWYgKHRoaXMuX3dpZHRoID4gYiB8fCB0aGlzLl9oZWlnaHQgPiBiKSB0aHJvdyBFcnJvcigidGV4dHVyZSBleGNlZWRzIG1heGltdW0gdGV4dHVyZSBzaXplIik7CiAgICAgICAgaWYgKCF0aGlzLl9yZW5kZXJlci5TdXBwb3J0c05QT1RUZXh0dXJlcygpICYmIHRoaXMuX0lzVGlsZWQoKSAmJiAhYSkgdGhyb3cgRXJyb3IoIm5vbi1wb3dlci1vZi10d28gdGlsZWQgdGV4dHVyZXMgbm90IHN1cHBvcnRlZCIpOwogICAgICAgIGEgPSB0aGlzLl9yZW5kZXJlci5HZXRDb250ZXh0KCk7CiAgICAgICAgYiA9IHRoaXMuX3JlbmRlcmVyLkdldFdlYkdMVmVyc2lvbk51bWJlcigpOwogICAgICAgIHRoaXMuX3RleHR1cmUgPSBhLmNyZWF0ZVRleHR1cmUoKTsKICAgICAgICBhLmJpbmRUZXh0dXJlKGEuVEVYVFVSRV8yRCwgdGhpcy5fdGV4dHVyZSk7CiAgICAgICAgYS5waXhlbFN0b3JlaShhLlVOUEFDS19QUkVNVUxUSVBMWV9BTFBIQV9XRUJHTCwgZC5wcmVtdWx0aXBseUFscGhhKTsKICAgICAgICBhLnBpeGVsU3RvcmVpKGEuVU5QQUNLX0ZMSVBfWV9XRUJHTCwgITEpOwogICAgICAgIGQgPSBHZXRGb3JtYXRTcGVjaWZpZXJzKHRoaXMuX3BpeGVsRm9ybWF0LCBhKTsKICAgICAgICBhLnRleEltYWdlMkQoYS5URVhUVVJFXzJELCAwLCAyIDw9IGIgPyBkLnNpemVkaW50ZXJuYWxmb3JtYXQgOiBkLmludGVybmFsZm9ybWF0LCB0aGlzLl93aWR0aCwgdGhpcy5faGVpZ2h0LCAwLCBkLmZvcm1hdCwgZC50eXBlLCBudWxsKTsKICAgICAgICB0aGlzLl9TZXRUZXh0dXJlUGFyYW1ldGVycyhhKTsKICAgICAgICBhLmJpbmRUZXh0dXJlKGEuVEVYVFVSRV8yRCwgbnVsbCk7CiAgICAgICAgdGhpcy5fcmVuZGVyZXIuX1Jlc2V0TGFzdFRleHR1cmUoKTsKICAgICAgICB0aGlzLl9yZWZDb3VudCA9IDE7CiAgICAgICAgYWxsVGV4dHVyZXMuYWRkKHRoaXMpCiAgICB9CiAgICBfR2V0TWlwTWFwSGludChhKSB7CiAgICAgICAgaWYgKCJkZWZhdWx0IiA9PT0gdGhpcy5fbWlwTWFwUXVhbGl0eSkgcmV0dXJuIHRoaXMuX2lzU3RhdGljID8KICAgICAgICAgICAgYS5OSUNFU1QgOiBhLkZBU1RFU1Q7CiAgICAgICAgaWYgKCJsb3ciID09PSB0aGlzLl9taXBNYXBRdWFsaXR5KSByZXR1cm4gYS5GQVNURVNUOwogICAgICAgIGlmICgiaGlnaCIgPT09IHRoaXMuX21pcE1hcFF1YWxpdHkpIHJldHVybiBhLk5JQ0VTVDsKICAgICAgICB0aHJvdyBFcnJvcigiaW52YWxpZCBtaXBtYXAgcXVhbGl0eSIpOwogICAgfQogICAgX0lzVGlsZWQoKSB7CiAgICAgICAgcmV0dXJuICJjbGFtcC10by1lZGdlIiAhPT0gdGhpcy5fd3JhcFggfHwgImNsYW1wLXRvLWVkZ2UiICE9PSB0aGlzLl93cmFwWQogICAgfQogICAgX0dldFRleHR1cmVXcmFwTW9kZShhLCBiKSB7CiAgICAgICAgaWYgKCJjbGFtcC10by1lZGdlIiA9PT0gYikgcmV0dXJuIGEuQ0xBTVBfVE9fRURHRTsKICAgICAgICBpZiAoInJlcGVhdCIgPT09IGIpIHJldHVybiBhLlJFUEVBVDsKICAgICAgICBpZiAoIm1pcnJvci1yZXBlYXQiID09PSBiKSByZXR1cm4gYS5NSVJST1JFRF9SRVBFQVQ7CiAgICAgICAgdGhyb3cgRXJyb3IoImludmFsaWQgd3JhcCBtb2RlIik7CiAgICB9CiAgICBfU2V0VGV4dHVyZVBhcmFtZXRlcnMoYSkgewogICAgICAgIHZhciBiID0gQzMkanNjb21wJDQyLmlzUE9UKHRoaXMuX3dpZHRoKSAmJiBDMyRqc2NvbXAkNDIuaXNQT1QodGhpcy5faGVpZ2h0KTsKICAgICAgICBhLnRleFBhcmFtZXRlcmkoYS5URVhUVVJFXzJELCBhLlRFWFRVUkVfV1JBUF9TLCB0aGlzLl9HZXRUZXh0dXJlV3JhcE1vZGUoYSwgdGhpcy5fd3JhcFgpKTsKICAgICAgICBhLnRleFBhcmFtZXRlcmkoYS5URVhUVVJFXzJELCBhLlRFWFRVUkVfV1JBUF9ULCB0aGlzLl9HZXRUZXh0dXJlV3JhcE1vZGUoYSwgdGhpcy5fd3JhcFkpKTsKICAgICAgICAibmVhcmVzdCIgPT09IHRoaXMuX3NhbXBsaW5nID8gKGEudGV4UGFyYW1ldGVyaShhLlRFWFRVUkVfMkQsIGEuVEVYVFVSRV9NQUdfRklMVEVSLCBhLk5FQVJFU1QpLCBhLnRleFBhcmFtZXRlcmkoYS5URVhUVVJFXzJELCBhLlRFWFRVUkVfTUlOX0ZJTFRFUiwgYS5ORUFSRVNUKSwgdGhpcy5faXNNaXBNYXBwZWQgPSAhMSkgOiAoYS50ZXhQYXJhbWV0ZXJpKGEuVEVYVFVSRV8yRCwgYS5URVhUVVJFX01BR19GSUxURVIsIGEuTElORUFSKSwgKGIgfHwgdGhpcy5fcmVuZGVyZXIuU3VwcG9ydHNOUE9UVGV4dHVyZXMoKSkgJiYgdGhpcy5faXNNaXBNYXBwZWQgPyAoYS5oaW50KGEuR0VORVJBVEVfTUlQTUFQX0hJTlQsIHRoaXMuX0dldE1pcE1hcEhpbnQoYSkpLAogICAgICAgICAgICBhLmdlbmVyYXRlTWlwbWFwKGEuVEVYVFVSRV8yRCksIGIgPSAidHJpbGluZWFyIiA9PT0gdGhpcy5fc2FtcGxpbmcgJiYgIXRoaXMuX3JlbmRlcmVyLkhhc01ham9yUGVyZm9ybWFuY2VDYXZlYXQoKSwgYS50ZXhQYXJhbWV0ZXJpKGEuVEVYVFVSRV8yRCwgYS5URVhUVVJFX01JTl9GSUxURVIsIGIgPyBhLkxJTkVBUl9NSVBNQVBfTElORUFSIDogYS5MSU5FQVJfTUlQTUFQX05FQVJFU1QpKSA6IChhLnRleFBhcmFtZXRlcmkoYS5URVhUVVJFXzJELCBhLlRFWFRVUkVfTUlOX0ZJTFRFUiwgYS5MSU5FQVIpLCB0aGlzLl9pc01pcE1hcHBlZCA9ICExKSk7CiAgICAgICAgKGIgPSB0aGlzLl9yZW5kZXJlci5fR2V0QW5pc290cm9waWNFeHRlbnNpb24oKSkgJiYgMCA8IHRoaXMuX2FuaXNvdHJvcHkgJiYgIm5lYXJlc3QiICE9PSB0aGlzLl9zYW1wbGluZyAmJiBhLnRleFBhcmFtZXRlcmYoYS5URVhUVVJFXzJELCBiLlRFWFRVUkVfTUFYX0FOSVNPVFJPUFlfRVhULCBNYXRoLm1pbih0aGlzLl9hbmlzb3Ryb3B5LCB0aGlzLl9yZW5kZXJlci5fR2V0TWF4QW5pc290cm9weSgpKSkKICAgIH0KICAgIF9VcGRhdGUoYSwKICAgICAgICBiKSB7CiAgICAgICAgaWYgKCEoInVuZGVmaW5lZCIgIT09IHR5cGVvZiBIVE1MSW1hZ2VFbGVtZW50ICYmIGEgaW5zdGFuY2VvZiBIVE1MSW1hZ2VFbGVtZW50IHx8ICJ1bmRlZmluZWQiICE9PSB0eXBlb2YgSFRNTFZpZGVvRWxlbWVudCAmJiBhIGluc3RhbmNlb2YgSFRNTFZpZGVvRWxlbWVudCB8fCAidW5kZWZpbmVkIiAhPT0gdHlwZW9mIEhUTUxDYW52YXNFbGVtZW50ICYmIGEgaW5zdGFuY2VvZiBIVE1MQ2FudmFzRWxlbWVudCB8fCAidW5kZWZpbmVkIiAhPT0gdHlwZW9mIEltYWdlQml0bWFwICYmIGEgaW5zdGFuY2VvZiBJbWFnZUJpdG1hcCB8fCAidW5kZWZpbmVkIiAhPT0gdHlwZW9mIE9mZnNjcmVlbkNhbnZhcyAmJiBhIGluc3RhbmNlb2YgT2Zmc2NyZWVuQ2FudmFzIHx8IGEgaW5zdGFuY2VvZiBJbWFnZURhdGEpKSB0aHJvdyBFcnJvcigiaW52YWxpZCB0ZXh0dXJlIHNvdXJjZSIpOwogICAgICAgIGlmICghdGhpcy5fdGV4dHVyZSB8fCAwID49IHRoaXMuX3JlZkNvdW50KSB0aHJvdyBFcnJvcigidGV4dHVyZSBub3QgY3JlYXRlZCIpOwogICAgICAgIGlmICh0aGlzLl9pc1N0YXRpYykgdGhyb3cgRXJyb3IoImNhbm5vdCB1cGRhdGUgc3RhdGljIHRleHR1cmUiKTsKICAgICAgICBiID0gT2JqZWN0LmFzc2lnbih7fSwgVVBEQVRFX0RFRkFVTFRfT1BUSU9OUywgYik7CiAgICAgICAgY29uc3QgZCA9IGEud2lkdGggfHwgYS52aWRlb1dpZHRoLAogICAgICAgICAgICBjID0gYS5oZWlnaHQgfHwgYS52aWRlb0hlaWdodDsKICAgICAgICB2YXIgZSA9IHRoaXMuX3JlbmRlcmVyLkdldFdlYkdMVmVyc2lvbk51bWJlcigpOwogICAgICAgIGNvbnN0IGcgPSB0aGlzLl9yZW5kZXJlci5HZXRDb250ZXh0KCk7CiAgICAgICAgZy5iaW5kVGV4dHVyZShnLlRFWFRVUkVfMkQsIHRoaXMuX3RleHR1cmUpOwogICAgICAgIGcucGl4ZWxTdG9yZWkoZy5VTlBBQ0tfUFJFTVVMVElQTFlfQUxQSEFfV0VCR0wsIGIucHJlbXVsdGlwbHlBbHBoYSk7CiAgICAgICAgZy5waXhlbFN0b3JlaShnLlVOUEFDS19GTElQX1lfV0VCR0wsICEhYi5mbGlwWSk7CiAgICAgICAgYiA9IEdldEZvcm1hdFNwZWNpZmllcnModGhpcy5fcGl4ZWxGb3JtYXQsIGcpOwogICAgICAgIGUgPSAyIDw9IGUgPyBiLnNpemVkaW50ZXJuYWxmb3JtYXQgOiBiLmludGVybmFsZm9ybWF0OwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICh0aGlzLl93aWR0aCA9PT0gZCAmJiB0aGlzLl9oZWlnaHQgPT09IGMpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGsgPSBDMyRqc2NvbXAkNDIuaXNQT1QodGhpcy5fd2lkdGgpICYmCiAgICAgICAgICAgICAgICAgICAgQzMkanNjb21wJDQyLmlzUE9UKHRoaXMuX2hlaWdodCk7CiAgICAgICAgICAgICAgICBnLnRleFN1YkltYWdlMkQoZy5URVhUVVJFXzJELCAwLCAwLCAwLCBiLmZvcm1hdCwgYi50eXBlLCBhKTsKICAgICAgICAgICAgICAgIChrIHx8IHRoaXMuX3JlbmRlcmVyLlN1cHBvcnRzTlBPVFRleHR1cmVzKCkpICYmIHRoaXMuX2lzTWlwTWFwcGVkICYmIChnLmhpbnQoZy5HRU5FUkFURV9NSVBNQVBfSElOVCwgdGhpcy5fR2V0TWlwTWFwSGludChnKSksIGcuZ2VuZXJhdGVNaXBtYXAoZy5URVhUVVJFXzJEKSkKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuX3dpZHRoID0gZDsKICAgICAgICAgICAgICAgIHRoaXMuX2hlaWdodCA9IGM7CiAgICAgICAgICAgICAgICBjb25zdCBrID0gQzMkanNjb21wJDQyLmlzUE9UKHRoaXMuX3dpZHRoKSAmJiBDMyRqc2NvbXAkNDIuaXNQT1QodGhpcy5faGVpZ2h0KTsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5fcmVuZGVyZXIuU3VwcG9ydHNOUE9UVGV4dHVyZXMoKSAmJiB0aGlzLl9Jc1RpbGVkKCkgJiYgIWspIHRocm93IEVycm9yKCJub24tcG93ZXItb2YtdHdvIHRpbGVkIHRleHR1cmVzIG5vdCBzdXBwb3J0ZWQiKTsKICAgICAgICAgICAgICAgIGcudGV4SW1hZ2UyRChnLlRFWFRVUkVfMkQsIDAsIGUsIGIuZm9ybWF0LAogICAgICAgICAgICAgICAgICAgIGIudHlwZSwgYSk7CiAgICAgICAgICAgICAgICAoayB8fCB0aGlzLl9yZW5kZXJlci5TdXBwb3J0c05QT1RUZXh0dXJlcygpKSAmJiB0aGlzLl9pc01pcE1hcHBlZCAmJiAoZy5oaW50KGcuR0VORVJBVEVfTUlQTUFQX0hJTlQsIHRoaXMuX0dldE1pcE1hcEhpbnQoZykpLCBnLmdlbmVyYXRlTWlwbWFwKGcuVEVYVFVSRV8yRCkpCiAgICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChrKSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIHVwZGF0aW5nIFdlYkdMIHRleHR1cmU6ICIsIGspCiAgICAgICAgfQogICAgICAgIGcuYmluZFRleHR1cmUoZy5URVhUVVJFXzJELCBudWxsKTsKICAgICAgICB0aGlzLl9yZW5kZXJlci5fUmVzZXRMYXN0VGV4dHVyZSgpCiAgICB9CiAgICBfRGVsZXRlKCkgewogICAgICAgIGlmICgwIDwgdGhpcy5fcmVmQ291bnQpIHRocm93IEVycm9yKCJ0ZXh0dXJlIHN0aWxsIGhhcyByZWZlcmVuY2VzIik7CiAgICAgICAgaWYgKCF0aGlzLl90ZXh0dXJlKSB0aHJvdyBFcnJvcigiYWxyZWFkeSBkZWxldGVkIHRleHR1cmUiKTsKICAgICAgICBhbGxUZXh0dXJlcy5kZWxldGUodGhpcyk7CiAgICAgICAgdGhpcy5fcmVuZGVyZXIuR2V0Q29udGV4dCgpLmRlbGV0ZVRleHR1cmUodGhpcy5fdGV4dHVyZSk7CiAgICAgICAgdGhpcy5fdGV4dHVyZSA9IG51bGwKICAgIH0KICAgIElzVmFsaWQoKSB7CiAgICAgICAgcmV0dXJuICEhdGhpcy5fdGV4dHVyZQogICAgfQogICAgX0dldFRleHR1cmUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3RleHR1cmUKICAgIH0KICAgIEdldFJlbmRlcmVyKCkgewogICAgICAgIHJldHVybiB0aGlzLl9yZW5kZXJlcgogICAgfQogICAgQWRkUmVmZXJlbmNlKCkgewogICAgICAgIHRoaXMuX3JlZkNvdW50KysKICAgIH0KICAgIFN1YnRyYWN0UmVmZXJlbmNlKCkgewogICAgICAgIGlmICgwID49IHRoaXMuX3JlZkNvdW50KSB0aHJvdyBFcnJvcigibm8gbW9yZSByZWZlcmVuY2VzIik7CiAgICAgICAgdGhpcy5fcmVmQ291bnQtLQogICAgfQogICAgR2V0UmVmZXJlbmNlQ291bnQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3JlZkNvdW50CiAgICB9CiAgICBHZXRXaWR0aCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fd2lkdGgKICAgIH0KICAgIEdldEhlaWdodCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5faGVpZ2h0CiAgICB9CiAgICBJc1N0YXRpYygpIHsKICAgICAgICByZXR1cm4gdGhpcy5faXNTdGF0aWMKICAgIH0KICAgIEdldEVzdGltYXRlZE1lbW9yeVVzYWdlKCkgewogICAgICAgIGxldCBhID0gdGhpcy5fd2lkdGggKiB0aGlzLl9oZWlnaHQ7CiAgICAgICAgc3dpdGNoICh0aGlzLl9waXhlbEZvcm1hdCkgewogICAgICAgICAgICBjYXNlICJyZ2JhOCI6CiAgICAgICAgICAgICAgICBhICo9IDQ7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAicmdiOCI6CiAgICAgICAgICAgICAgICBhICo9CiAgICAgICAgICAgICAgICAgICAgMzsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICJyZ2JhNCI6CiAgICAgICAgICAgIGNhc2UgInJnYjVfYTEiOgogICAgICAgICAgICBjYXNlICJyZ2I1NjUiOgogICAgICAgICAgICAgICAgYSAqPSAyCiAgICAgICAgfQogICAgICAgIHRoaXMuX2lzTWlwTWFwcGVkICYmIChhICs9IE1hdGguZmxvb3IoYSAvIDMpKTsKICAgICAgICByZXR1cm4gYQogICAgfQogICAgc3RhdGljIE9uQ29udGV4dExvc3QoKSB7CiAgICAgICAgYWxsVGV4dHVyZXMuY2xlYXIoKQogICAgfQogICAgc3RhdGljIGFsbFRleHR1cmVzKCkgewogICAgICAgIHJldHVybiBhbGxUZXh0dXJlcy52YWx1ZXMoKQogICAgfQp9OwoidXNlIHN0cmljdCI7CmNvbnN0IEMzJGpzY29tcCQ0MyA9IHNlbGYuQzMsCiAgICBnbE1hdHJpeCRqc2NvbXAkMiA9IHNlbGYuZ2xNYXRyaXgsCiAgICBtYXQ0JGpzY29tcCQzID0gZ2xNYXRyaXgkanNjb21wJDIubWF0NCwKICAgIFZBTElEX1NBTVBMSU5HUyRqc2NvbXAkMSA9IG5ldyBTZXQoWyJuZWFyZXN0IiwgImJpbGluZWFyIiwgInRyaWxpbmVhciJdKSwKICAgIERFRkFVTFRfUkVOREVSVEFSR0VUX09QVElPTlMgPSB7CiAgICAgICAgc2FtcGxpbmc6ICJ0cmlsaW5lYXIiLAogICAgICAgIGFscGhhOiAhMCwKICAgICAgICBkZXB0aDogITEsCiAgICAgICAgaXNTYW1wbGVkOiAhMCwKICAgICAgICBpc0RlZmF1bHRTaXplOiAhMCwKICAgICAgICBtdWx0aXNhbXBsaW5nOiAwCiAgICB9LAogICAgYWxsUmVuZGVyVGFyZ2V0cyA9IG5ldyBTZXQ7CkMzJGpzY29tcCQ0My5HZnguV2ViR0xSZW5kZXJUYXJnZXQgPSBjbGFzcyB7CiAgICBjb25zdHJ1Y3RvcihhKSB7CiAgICAgICAgdGhpcy5fcmVuZGVyZXIgPSBhOwogICAgICAgIHRoaXMuX3JlbmRlckJ1ZmZlciA9IHRoaXMuX3RleHR1cmUgPSB0aGlzLl9mcmFtZUJ1ZmZlck5vRGVwdGggPSB0aGlzLl9mcmFtZUJ1ZmZlciA9IG51bGw7CiAgICAgICAgdGhpcy5faGVpZ2h0ID0gdGhpcy5fd2lkdGggPSAwOwogICAgICAgIHRoaXMuX2lzRGVmYXVsdFNpemUgPSAhMDsKICAgICAgICB0aGlzLl9zYW1wbGluZyA9ICJ0cmlsaW5lYXIiOwogICAgICAgIHRoaXMuX2FscGhhID0gITA7CiAgICAgICAgdGhpcy5fZGVwdGggPSAhMTsKICAgICAgICB0aGlzLl9pc1NhbXBsZWQgPSAhMDsKICAgICAgICB0aGlzLl9tdWx0aXNhbXBsaW5nID0gMDsKICAgICAgICB0aGlzLl9wcm9qZWN0aW9uTWF0cml4ID0gbWF0NCRqc2NvbXAkMy5jcmVhdGUoKTsKICAgICAgICB0aGlzLl9sYXN0Rm92ID0gMAogICAgfQogICAgX0NyZWF0ZShhLCBiLCBkKSB7CiAgICAgICAgZCA9IE9iamVjdC5hc3NpZ24oe30sIERFRkFVTFRfUkVOREVSVEFSR0VUX09QVElPTlMsIGQpOwogICAgICAgIGNvbnN0IGMgPSB0aGlzLl9yZW5kZXJlci5HZXRXZWJHTFZlcnNpb25OdW1iZXIoKTsKICAgICAgICBpZiAodGhpcy5fdGV4dHVyZSB8fCB0aGlzLl9yZW5kZXJCdWZmZXIpIHRocm93IEVycm9yKCJhbHJlYWR5IGNyZWF0ZWQgcmVuZGVyIHRhcmdldCIpOwogICAgICAgIHRoaXMuX3NhbXBsaW5nID0gZC5zYW1wbGluZzsKICAgICAgICB0aGlzLl9hbHBoYSA9ICEhZC5hbHBoYTsKICAgICAgICB0aGlzLl9kZXB0aCA9ICEhZC5kZXB0aDsKICAgICAgICB0aGlzLl9pc1NhbXBsZWQgPSAhIWQuaXNTYW1wbGVkOwogICAgICAgIHRoaXMuX2lzRGVmYXVsdFNpemUgPSAhIWQuaXNEZWZhdWx0U2l6ZTsKICAgICAgICB0aGlzLl9tdWx0aXNhbXBsaW5nID0gZC5tdWx0aXNhbXBsaW5nOwogICAgICAgIGlmICghVkFMSURfU0FNUExJTkdTJGpzY29tcCQxLmhhcyh0aGlzLl9zYW1wbGluZykpIHRocm93IEVycm9yKCJpbnZhbGlkIHNhbXBsaW5nIik7CiAgICAgICAgaWYgKDAgPCB0aGlzLl9tdWx0aXNhbXBsaW5nICYmICgyID4gYyB8fCB0aGlzLl9pc1NhbXBsZWQpKSB0aHJvdyBFcnJvcigiaW52YWxpZCB1c2Ugb2YgbXVsdGlzYW1wbGluZyIpOwogICAgICAgIDIgPiBjICYmICh0aGlzLl9pc1NhbXBsZWQgPSAhMCk7CiAgICAgICAgdGhpcy5fd2lkdGggPSBhOwogICAgICAgIHRoaXMuX2hlaWdodCA9IGI7CiAgICAgICAgaWYgKDAgPj0gdGhpcy5fd2lkdGggfHwgMCA+PSB0aGlzLl9oZWlnaHQpIHRocm93IEVycm9yKCJpbnZhbGlkIHJlbmRlciB0YXJnZXQgc2l6ZSIpOwogICAgICAgIHRoaXMuX0NhbGN1bGF0ZVByb2plY3Rpb24oKTsKICAgICAgICBhID0gdGhpcy5fcmVuZGVyZXIuR2V0Q29udGV4dCgpOwogICAgICAgIHRoaXMuX2ZyYW1lQnVmZmVyID0gYS5jcmVhdGVGcmFtZWJ1ZmZlcigpOwogICAgICAgIHRoaXMuX2RlcHRoICYmICh0aGlzLl9mcmFtZUJ1ZmZlck5vRGVwdGggPSBhLmNyZWF0ZUZyYW1lYnVmZmVyKCkpOwogICAgICAgIHRoaXMuX2lzU2FtcGxlZCA/ICh0aGlzLl90ZXh0dXJlID0gdGhpcy5fcmVuZGVyZXIuQ3JlYXRlRHluYW1pY1RleHR1cmUodGhpcy5fd2lkdGgsIHRoaXMuX2hlaWdodCwgewogICAgICAgICAgICBzYW1wbGluZzogdGhpcy5fc2FtcGxpbmcsCiAgICAgICAgICAgIHBpeGVsRm9ybWF0OiB0aGlzLl9hbHBoYSA/ICJyZ2JhOCIgOiAicmdiOCIsCiAgICAgICAgICAgIG1pcE1hcDogITEKICAgICAgICB9KSwgYiA9IHRoaXMuX3RleHR1cmUuX0dldFRleHR1cmUoKSwgYS5iaW5kRnJhbWVidWZmZXIoYS5GUkFNRUJVRkZFUiwgdGhpcy5fZnJhbWVCdWZmZXIpLCBhLmZyYW1lYnVmZmVyVGV4dHVyZTJEKGEuRlJBTUVCVUZGRVIsIGEuQ09MT1JfQVRUQUNITUVOVDAsIGEuVEVYVFVSRV8yRCwgYiwgMCksIHRoaXMuX2RlcHRoICYmIChhLmJpbmRGcmFtZWJ1ZmZlcihhLkZSQU1FQlVGRkVSLAogICAgICAgICAgICB0aGlzLl9mcmFtZUJ1ZmZlck5vRGVwdGgpLCBhLmZyYW1lYnVmZmVyVGV4dHVyZTJEKGEuRlJBTUVCVUZGRVIsIGEuQ09MT1JfQVRUQUNITUVOVDAsIGEuVEVYVFVSRV8yRCwgYiwgMCkpKSA6ICh0aGlzLl9yZW5kZXJCdWZmZXIgPSBhLmNyZWF0ZVJlbmRlcmJ1ZmZlcigpLCBhLmJpbmRSZW5kZXJidWZmZXIoYS5SRU5ERVJCVUZGRVIsIHRoaXMuX3JlbmRlckJ1ZmZlciksIGIgPSB0aGlzLl9hbHBoYSA/IGEuUkdCQTggOiBhLlJHQjgsIDAgPCB0aGlzLl9tdWx0aXNhbXBsaW5nICYmICgoZCA9IGEuZ2V0SW50ZXJuYWxmb3JtYXRQYXJhbWV0ZXIoYS5SRU5ERVJCVUZGRVIsIGIsIGEuU0FNUExFUykpICYmIGRbMF0gPyAoZCA9IGRbMF0sIHRoaXMuX211bHRpc2FtcGxpbmcgPiBkICYmICh0aGlzLl9tdWx0aXNhbXBsaW5nID0gZCkpIDogdGhpcy5fbXVsdGlzYW1wbGluZyA9IDApLCAwID09PSB0aGlzLl9tdWx0aXNhbXBsaW5nID8gYS5yZW5kZXJidWZmZXJTdG9yYWdlKGEuUkVOREVSQlVGRkVSLCBiLCB0aGlzLl93aWR0aCwgdGhpcy5faGVpZ2h0KSA6IGEucmVuZGVyYnVmZmVyU3RvcmFnZU11bHRpc2FtcGxlKGEuUkVOREVSQlVGRkVSLAogICAgICAgICAgICB0aGlzLl9tdWx0aXNhbXBsaW5nLCBiLCB0aGlzLl93aWR0aCwgdGhpcy5faGVpZ2h0KSwgYS5iaW5kRnJhbWVidWZmZXIoYS5GUkFNRUJVRkZFUiwgdGhpcy5fZnJhbWVCdWZmZXIpLCBhLmZyYW1lYnVmZmVyUmVuZGVyYnVmZmVyKGEuRlJBTUVCVUZGRVIsIGEuQ09MT1JfQVRUQUNITUVOVDAsIGEuUkVOREVSQlVGRkVSLCB0aGlzLl9yZW5kZXJCdWZmZXIpLCB0aGlzLl9kZXB0aCAmJiAoYS5iaW5kRnJhbWVidWZmZXIoYS5GUkFNRUJVRkZFUiwgdGhpcy5fZnJhbWVCdWZmZXJOb0RlcHRoKSwgYS5mcmFtZWJ1ZmZlclJlbmRlcmJ1ZmZlcihhLkZSQU1FQlVGRkVSLCBhLkNPTE9SX0FUVEFDSE1FTlQwLCBhLlJFTkRFUkJVRkZFUiwgdGhpcy5fcmVuZGVyQnVmZmVyKSksIGEuYmluZFJlbmRlcmJ1ZmZlcihhLlJFTkRFUkJVRkZFUiwgbnVsbCkpOwogICAgICAgIGIgPSB0aGlzLl9yZW5kZXJlci5fR2V0RGVwdGhCdWZmZXIoKTsKICAgICAgICB0aGlzLl9kZXB0aCAmJiBiICYmIChhLmJpbmRGcmFtZWJ1ZmZlcihhLkZSQU1FQlVGRkVSLCB0aGlzLl9mcmFtZUJ1ZmZlciksCiAgICAgICAgICAgIHRoaXMuX3JlbmRlcmVyLl9DYW5TYW1wbGVEZXB0aCgpID8gYS5mcmFtZWJ1ZmZlclRleHR1cmUyRChhLkZSQU1FQlVGRkVSLCBhLkRFUFRIX1NURU5DSUxfQVRUQUNITUVOVCwgYS5URVhUVVJFXzJELCBiLCAwKSA6IGEuZnJhbWVidWZmZXJSZW5kZXJidWZmZXIoYS5GUkFNRUJVRkZFUiwgYS5ERVBUSF9TVEVOQ0lMX0FUVEFDSE1FTlQsIGEuUkVOREVSQlVGRkVSLCBiKSk7CiAgICAgICAgYS5iaW5kRnJhbWVidWZmZXIoYS5GUkFNRUJVRkZFUiwgbnVsbCk7CiAgICAgICAgYWxsUmVuZGVyVGFyZ2V0cy5hZGQodGhpcykKICAgIH0KICAgIF9SZXNpemUoYSwgYikgewogICAgICAgIGlmICh0aGlzLl93aWR0aCAhPT0gYSB8fCB0aGlzLl9oZWlnaHQgIT09IGIpIHRoaXMuX3dpZHRoID0gYSwgdGhpcy5faGVpZ2h0ID0gYiwgdGhpcy5fQ2FsY3VsYXRlUHJvamVjdGlvbigpLCBhID0gdGhpcy5fcmVuZGVyZXIuR2V0Q29udGV4dCgpLCBhLmJpbmRGcmFtZWJ1ZmZlcihhLkZSQU1FQlVGRkVSLCB0aGlzLl9mcmFtZUJ1ZmZlciksIHRoaXMuX3RleHR1cmUgPyB0aGlzLl90ZXh0dXJlLl9VcGRhdGUobmV3IEltYWdlRGF0YSh0aGlzLl93aWR0aCwKICAgICAgICAgICAgdGhpcy5faGVpZ2h0KSkgOiAoYS5iaW5kUmVuZGVyYnVmZmVyKGEuUkVOREVSQlVGRkVSLCB0aGlzLl9yZW5kZXJCdWZmZXIpLCBhLnJlbmRlcmJ1ZmZlclN0b3JhZ2UoYS5SRU5ERVJCVUZGRVIsIHRoaXMuX2FscGhhID8gYS5SR0JBOCA6IGEuUkdCOCwgdGhpcy5fd2lkdGgsIHRoaXMuX2hlaWdodCksIGEuYmluZFJlbmRlcmJ1ZmZlcihhLlJFTkRFUkJVRkZFUiwgbnVsbCkpLCBiID0gdGhpcy5fcmVuZGVyZXIuX0dldERlcHRoQnVmZmVyKCksIHRoaXMuX2RlcHRoICYmIGIgJiYgKHRoaXMuX3JlbmRlcmVyLl9DYW5TYW1wbGVEZXB0aCgpID8gYS5mcmFtZWJ1ZmZlclRleHR1cmUyRChhLkZSQU1FQlVGRkVSLCBhLkRFUFRIX1NURU5DSUxfQVRUQUNITUVOVCwgYS5URVhUVVJFXzJELCBiLCAwKSA6IGEuZnJhbWVidWZmZXJSZW5kZXJidWZmZXIoYS5GUkFNRUJVRkZFUiwgYS5ERVBUSF9TVEVOQ0lMX0FUVEFDSE1FTlQsIGEuUkVOREVSQlVGRkVSLCBiKSksIGEuYmluZEZyYW1lYnVmZmVyKGEuRlJBTUVCVUZGRVIsIG51bGwpCiAgICB9CiAgICBfRGVsZXRlKCkgewogICAgICAgIGlmICghdGhpcy5fdGV4dHVyZSAmJgogICAgICAgICAgICAhdGhpcy5fcmVuZGVyQnVmZmVyKSB0aHJvdyBFcnJvcigiYWxyZWFkeSBkZWxldGVkIHJlbmRlciB0YXJnZXQiKTsKICAgICAgICBhbGxSZW5kZXJUYXJnZXRzLmRlbGV0ZSh0aGlzKTsKICAgICAgICB2YXIgYSA9IHRoaXMuX3JlbmRlcmVyLkdldENvbnRleHQoKTsKICAgICAgICB0aGlzLl90ZXh0dXJlID8gKGEuYmluZEZyYW1lYnVmZmVyKGEuRlJBTUVCVUZGRVIsIHRoaXMuX2ZyYW1lQnVmZmVyKSwgYS5mcmFtZWJ1ZmZlclRleHR1cmUyRChhLkZSQU1FQlVGRkVSLCBhLkNPTE9SX0FUVEFDSE1FTlQwLCBhLlRFWFRVUkVfMkQsIG51bGwsIDApLCB0aGlzLl9kZXB0aCAmJiAoYS5iaW5kRnJhbWVidWZmZXIoYS5GUkFNRUJVRkZFUiwgdGhpcy5fZnJhbWVCdWZmZXJOb0RlcHRoKSwgYS5mcmFtZWJ1ZmZlclRleHR1cmUyRChhLkZSQU1FQlVGRkVSLCBhLkNPTE9SX0FUVEFDSE1FTlQwLCBhLlRFWFRVUkVfMkQsIG51bGwsIDApKSwgdGhpcy5fcmVuZGVyZXIuRGVsZXRlVGV4dHVyZSh0aGlzLl90ZXh0dXJlKSwgdGhpcy5fdGV4dHVyZSA9IG51bGwpIDogdGhpcy5fcmVuZGVyQnVmZmVyICYmCiAgICAgICAgICAgIChhLmJpbmRGcmFtZWJ1ZmZlcihhLkZSQU1FQlVGRkVSLCB0aGlzLl9mcmFtZUJ1ZmZlciksIGEuZnJhbWVidWZmZXJSZW5kZXJidWZmZXIoYS5GUkFNRUJVRkZFUiwgYS5DT0xPUl9BVFRBQ0hNRU5UMCwgYS5SRU5ERVJCVUZGRVIsIG51bGwpLCB0aGlzLl9kZXB0aCAmJiAoYS5iaW5kRnJhbWVidWZmZXIoYS5GUkFNRUJVRkZFUiwgdGhpcy5fZnJhbWVCdWZmZXJOb0RlcHRoKSwgYS5mcmFtZWJ1ZmZlclJlbmRlcmJ1ZmZlcihhLkZSQU1FQlVGRkVSLCBhLkNPTE9SX0FUVEFDSE1FTlQwLCBhLlJFTkRFUkJVRkZFUiwgbnVsbCkpLCBhLmRlbGV0ZVJlbmRlcmJ1ZmZlcih0aGlzLl9yZW5kZXJCdWZmZXIpLCB0aGlzLl9yZW5kZXJCdWZmZXIgPSBudWxsKTsKICAgICAgICBhLmJpbmRGcmFtZWJ1ZmZlcihhLkZSQU1FQlVGRkVSLCBudWxsKTsKICAgICAgICAyIDw9IHRoaXMuX3JlbmRlcmVyLkdldFdlYkdMVmVyc2lvbk51bWJlcigpICYmIChhLmJpbmRGcmFtZWJ1ZmZlcihhLlJFQURfRlJBTUVCVUZGRVIsIG51bGwpLCBhLmJpbmRGcmFtZWJ1ZmZlcihhLkRSQVdfRlJBTUVCVUZGRVIsCiAgICAgICAgICAgIG51bGwpKTsKICAgICAgICBhLmRlbGV0ZUZyYW1lYnVmZmVyKHRoaXMuX2ZyYW1lQnVmZmVyKTsKICAgICAgICB0aGlzLl9kZXB0aCAmJiBhLmRlbGV0ZUZyYW1lYnVmZmVyKHRoaXMuX2ZyYW1lQnVmZmVyTm9EZXB0aCk7CiAgICAgICAgYSA9IHRoaXMuX3JlbmRlcmVyLkdldEJhdGNoU3RhdGUoKTsKICAgICAgICBhLmN1cnJlbnRGcmFtZWJ1ZmZlciA9IG51bGw7CiAgICAgICAgdGhpcy5fZnJhbWVCdWZmZXIgPSBhLmN1cnJlbnRGcmFtZWJ1ZmZlck5vRGVwdGggPSBudWxsCiAgICB9CiAgICBfQ2FsY3VsYXRlUHJvamVjdGlvbigpIHsKICAgICAgICB0aGlzLl9yZW5kZXJlci5DYWxjdWxhdGVQZXJzcGVjdGl2ZU1hdHJpeCh0aGlzLl9wcm9qZWN0aW9uTWF0cml4LCB0aGlzLl93aWR0aCAvIHRoaXMuX2hlaWdodCk7CiAgICAgICAgdGhpcy5fbGFzdEZvdiA9IHRoaXMuX3JlbmRlcmVyLkdldEZvdlkoKQogICAgfQogICAgX0dldEZyYW1lYnVmZmVyKCkgewogICAgICAgIHJldHVybiB0aGlzLl9mcmFtZUJ1ZmZlcgogICAgfQogICAgX0dldEZyYW1lYnVmZmVyTm9EZXB0aCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZnJhbWVCdWZmZXJOb0RlcHRoCiAgICB9CiAgICBHZXRSZW5kZXJlcigpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcmVuZGVyZXIKICAgIH0KICAgIEdldFRleHR1cmUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3RleHR1cmUKICAgIH0KICAgIEdldFByb2plY3Rpb25NYXRyaXgoKSB7CiAgICAgICAgdGhpcy5fcmVuZGVyZXIuR2V0Rm92WSgpICE9PQogICAgICAgICAgICB0aGlzLl9sYXN0Rm92ICYmIHRoaXMuX0NhbGN1bGF0ZVByb2plY3Rpb24oKTsKICAgICAgICByZXR1cm4gdGhpcy5fcHJvamVjdGlvbk1hdHJpeAogICAgfQogICAgSXNMaW5lYXJTYW1wbGluZygpIHsKICAgICAgICByZXR1cm4gIm5lYXJlc3QiICE9PSB0aGlzLl9zYW1wbGluZwogICAgfQogICAgSGFzQWxwaGEoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2FscGhhCiAgICB9CiAgICBJc1NhbXBsZWQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2lzU2FtcGxlZAogICAgfQogICAgSGFzRGVwdGhCdWZmZXIoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2RlcHRoCiAgICB9CiAgICBHZXRXaWR0aCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fd2lkdGgKICAgIH0KICAgIEdldEhlaWdodCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5faGVpZ2h0CiAgICB9CiAgICBJc0RlZmF1bHRTaXplKCkgewogICAgICAgIHJldHVybiB0aGlzLl9pc0RlZmF1bHRTaXplCiAgICB9CiAgICBHZXRNdWx0aXNhbXBsaW5nKCkgewogICAgICAgIHJldHVybiB0aGlzLl9tdWx0aXNhbXBsaW5nCiAgICB9CiAgICBHZXRPcHRpb25zKCkgewogICAgICAgIGNvbnN0IGEgPSB7CiAgICAgICAgICAgIHNhbXBsaW5nOiB0aGlzLl9zYW1wbGluZywKICAgICAgICAgICAgYWxwaGE6IHRoaXMuX2FscGhhLAogICAgICAgICAgICBpc1NhbXBsZWQ6IHRoaXMuX2lzU2FtcGxlZAogICAgICAgIH07CiAgICAgICAgdGhpcy5faXNEZWZhdWx0U2l6ZSB8fCAoYS53aWR0aCA9IHRoaXMuX3dpZHRoLAogICAgICAgICAgICBhLmhlaWdodCA9IHRoaXMuX2hlaWdodCk7CiAgICAgICAgcmV0dXJuIGEKICAgIH0KICAgIElzQ29tcGF0aWJsZVdpdGhPcHRpb25zKGEpIHsKICAgICAgICBhID0gT2JqZWN0LmFzc2lnbih7fSwgREVGQVVMVF9SRU5ERVJUQVJHRVRfT1BUSU9OUywgYSk7CiAgICAgICAgcmV0dXJuICJuZWFyZXN0IiAhPT0gYS5zYW1wbGluZyAhPT0gdGhpcy5Jc0xpbmVhclNhbXBsaW5nKCkgfHwgISFhLmFscGhhICE9PSB0aGlzLkhhc0FscGhhKCkgfHwgISFhLmRlcHRoICE9PSB0aGlzLkhhc0RlcHRoQnVmZmVyKCkgfHwgMiA8PSB0aGlzLl9yZW5kZXJlci5HZXRXZWJHTFZlcnNpb25OdW1iZXIoKSAmJiAhIWEuaXNTYW1wbGVkICE9PSB0aGlzLklzU2FtcGxlZCgpID8gITEgOiAibnVtYmVyIiA9PT0gdHlwZW9mIGEud2lkdGggfHwgIm51bWJlciIgPT09IHR5cGVvZiBhLmhlaWdodCA/ICF0aGlzLklzRGVmYXVsdFNpemUoKSAmJiB0aGlzLkdldFdpZHRoKCkgPT09IGEud2lkdGggJiYgdGhpcy5HZXRIZWlnaHQoKSA9PT0gYS5oZWlnaHQgOiB0aGlzLklzRGVmYXVsdFNpemUoKQogICAgfQogICAgX0dldFdlYkdMVGV4dHVyZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdGV4dHVyZSA/CiAgICAgICAgICAgIHRoaXMuX3RleHR1cmUuX0dldFRleHR1cmUoKSA6IG51bGwKICAgIH0KICAgIEdldEVzdGltYXRlZE1lbW9yeVVzYWdlKCkgewogICAgICAgIHJldHVybiB0aGlzLl90ZXh0dXJlID8gdGhpcy5fdGV4dHVyZS5HZXRFc3RpbWF0ZWRNZW1vcnlVc2FnZSgpIDogdGhpcy5fd2lkdGggKiB0aGlzLl9oZWlnaHQgKiAodGhpcy5fYWxwaGEgPyA0IDogMykKICAgIH0KICAgIHN0YXRpYyBhc3luYyBEZWJ1Z1JlYWRQaXhlbHNUb0Jsb2IoYSwgYikgewogICAgICAgIGEgPSBhd2FpdCBhLlJlYWRCYWNrUmVuZGVyVGFyZ2V0VG9JbWFnZURhdGEoYiwgITApOwogICAgICAgIHJldHVybiBhd2FpdCBDMyRqc2NvbXAkNDMuSW1hZ2VEYXRhVG9CbG9iKGEpCiAgICB9CiAgICBzdGF0aWMgT25Db250ZXh0TG9zdCgpIHsKICAgICAgICBhbGxSZW5kZXJUYXJnZXRzLmNsZWFyKCkKICAgIH0KICAgIHN0YXRpYyBhbGxSZW5kZXJUYXJnZXRzKCkgewogICAgICAgIHJldHVybiBhbGxSZW5kZXJUYXJnZXRzLnZhbHVlcygpCiAgICB9CiAgICBzdGF0aWMgUmVzaXplQWxsKGEsIGIpIHsKICAgICAgICBmb3IgKGNvbnN0IGQgb2YgYWxsUmVuZGVyVGFyZ2V0cykgZC5Jc0RlZmF1bHRTaXplKCkgJiYgZC5fUmVzaXplKGEsIGIpCiAgICB9Cn07CiJ1c2Ugc3RyaWN0IjsKY29uc3QgQzMkanNjb21wJDQ0ID0gc2VsZi5DMywKICAgIFJFU0VSVkVEX1VOSUZPUk1fTkFNRVMgPSBuZXcgU2V0KCJhUG9zIGFUZXggYVBvaW50cyBtYXRQIG1hdE1WIHNhbXBsZXJGcm9udCBzYW1wbGVyQmFjayBzYW1wbGVyRGVwdGggZGVzdFN0YXJ0IGRlc3RFbmQgc3JjU3RhcnQgc3JjRW5kIHNyY09yaWdpblN0YXJ0IHNyY09yaWdpbkVuZCBwaXhlbFNpemUgc2Vjb25kcyBkZXZpY2VQaXhlbFJhdGlvIGxheWVyU2NhbGUgbGF5ZXJBbmdsZSBsYXlvdXRTdGFydCBsYXlvdXRFbmQgY29sb3IgY29sb3IyXyBwb2ludFRleFN0YXJ0IHBvaW50VGV4RW5kIHpFbGV2YXRpb24gdGlsZVNpemUgdGlsZVNwYWNpbmcgb3V0bGluZVRoaWNrbmVzcyIuc3BsaXQoIiAiKSk7CkMzJGpzY29tcCQ0NC5HZnguV2ViR0xTaGFkZXJQcm9ncmFtID0gY2xhc3MgZXh0ZW5kcyBDMyRqc2NvbXAkNDQuR2Z4LlNoYWRlclByb2dyYW1CYXNlIHsKICAgIHN0YXRpYyBhc3luYyBDb21waWxlKGEsIGIsIGQsIGMpIHsKICAgICAgICBjb25zdCBlID0gYS5HZXRDb250ZXh0KCksCiAgICAgICAgICAgIGcgPSBlLmNyZWF0ZVNoYWRlcihlLkZSQUdNRU5UX1NIQURFUik7CiAgICAgICAgZS5zaGFkZXJTb3VyY2UoZywgYik7CiAgICAgICAgZS5jb21waWxlU2hhZGVyKGcpOwogICAgICAgIGIgPSBlLmNyZWF0ZVNoYWRlcihlLlZFUlRFWF9TSEFERVIpOwogICAgICAgIGUuc2hhZGVyU291cmNlKGIsIGQpOwogICAgICAgIGUuY29tcGlsZVNoYWRlcihiKTsKICAgICAgICBjb25zdCBrID0gZS5jcmVhdGVQcm9ncmFtKCk7CiAgICAgICAgZS5hdHRhY2hTaGFkZXIoaywgZyk7CiAgICAgICAgZS5hdHRhY2hTaGFkZXIoaywgYik7CiAgICAgICAgZS5iaW5kQXR0cmliTG9jYXRpb24oaywgMCwgImFQb3MiKTsKICAgICAgICBlLmJpbmRBdHRyaWJMb2NhdGlvbihrLCAxLCAiYVRleCIpOwogICAgICAgIGUuYmluZEF0dHJpYkxvY2F0aW9uKGssIDIsICJhUG9pbnRzIik7CiAgICAgICAgZS5saW5rUHJvZ3JhbShrKTsKICAgICAgICBjb25zdCBtID0gYS5fR2V0UGFyYWxsZWxTaGFkZXJDb21waWxlRXh0ZW5zaW9uKCk7CiAgICAgICAgbSA/IGF3YWl0IGEuX1dhaXRGb3JPYmplY3RSZWFkeSgoKSA9PiBlLmdldFByb2dyYW1QYXJhbWV0ZXIoaywgbS5DT01QTEVUSU9OX1NUQVRVU19LSFIpKSA6IGF3YWl0IEMzJGpzY29tcCQ0NC5XYWl0KDUpOwogICAgICAgIGlmICghZS5nZXRTaGFkZXJQYXJhbWV0ZXIoZywgZS5DT01QSUxFX1NUQVRVUykpIHRocm93IGMgPSBlLmdldFNoYWRlckluZm9Mb2coZyksIGUuZGVsZXRlU2hhZGVyKGcpLCBlLmRlbGV0ZVNoYWRlcihiKSwgZS5kZWxldGVQcm9ncmFtKGspLCBFcnJvcigiRXJyb3IgY29tcGlsaW5nIGZyYWdtZW50IHNoYWRlcjogIiArIGMpOwogICAgICAgIGlmICghZS5nZXRTaGFkZXJQYXJhbWV0ZXIoYiwgZS5DT01QSUxFX1NUQVRVUykpIHRocm93IGMgPSBlLmdldFNoYWRlckluZm9Mb2coYiksIGUuZGVsZXRlU2hhZGVyKGcpLCBlLmRlbGV0ZVNoYWRlcihiKSwgZS5kZWxldGVQcm9ncmFtKGspLCBFcnJvcigiRXJyb3IgY29tcGlsaW5nIHZlcnRleCBzaGFkZXI6ICIgKyBjKTsKICAgICAgICBpZiAoIWUuZ2V0UHJvZ3JhbVBhcmFtZXRlcihrLCBlLkxJTktfU1RBVFVTKSkgdGhyb3cgYyA9CiAgICAgICAgICAgIGUuZ2V0UHJvZ3JhbUluZm9Mb2coayksIGUuZGVsZXRlU2hhZGVyKGcpLCBlLmRlbGV0ZVNoYWRlcihiKSwgZS5kZWxldGVQcm9ncmFtKGspLCBFcnJvcigiRXJyb3IgbGlua2luZyBzaGFkZXIgcHJvZ3JhbTogIiArIGMpOwogICAgICAgIChhID0gQzMkanNjb21wJDQ0LkZpbHRlclVucHJpbnRhYmxlQ2hhcnMoZS5nZXRQcm9ncmFtSW5mb0xvZyhrKSB8fCAiIikudHJpbSgpKSAmJiAhQzMkanNjb21wJDQ0LklzU3RyaW5nQWxsV2hpdGVzcGFjZShhKSAmJiBjb25zb2xlLmluZm8oYFtXZWJHTF0gU2hhZGVyIHByb2dyYW0gJyR7Y30nIGNvbXBpbGF0aW9uIGxvZzogYCwgYSk7CiAgICAgICAgZS5kZWxldGVTaGFkZXIoZyk7CiAgICAgICAgZS5kZWxldGVTaGFkZXIoYik7CiAgICAgICAgcmV0dXJuIGsKICAgIH0KICAgIHN0YXRpYyBhc3luYyBDcmVhdGUoYSwgYiwgZCwgYykgewogICAgICAgIGQgPSBhd2FpdCBDMyRqc2NvbXAkNDQuR2Z4LldlYkdMU2hhZGVyUHJvZ3JhbS5Db21waWxlKGEsIGIuc3JjLCBkLCBjKTsKICAgICAgICByZXR1cm4gbmV3IEMzJGpzY29tcCQ0NC5HZnguV2ViR0xTaGFkZXJQcm9ncmFtKGEsIGQsIGIsIGMpCiAgICB9CiAgICBjb25zdHJ1Y3RvcihhLAogICAgICAgIGIsIGQsIGMpIHsKICAgICAgICBzdXBlcihhLCBjLCBkKTsKICAgICAgICBjb25zdCBlID0gYS5HZXRDb250ZXh0KCk7CiAgICAgICAgdmFyIGcgPSBhLkdldEJhdGNoU3RhdGUoKTsKICAgICAgICBhLkVuZEJhdGNoKCk7CiAgICAgICAgZS51c2VQcm9ncmFtKGIpOwogICAgICAgIHRoaXMuX2dsID0gZTsKICAgICAgICB0aGlzLl9zaGFkZXJQcm9ncmFtID0gYjsKICAgICAgICB0aGlzLl9pc0RldmljZVRyYW5zZm9ybSA9ICI8ZGVmYXVsdC1kZXZpY2UtdHJhbnNmb3JtPiIgPT09IGM7CiAgICAgICAgYyA9IGUuZ2V0QXR0cmliTG9jYXRpb24oYiwgImFQb3MiKTsKICAgICAgICBjb25zdCBrID0gZS5nZXRBdHRyaWJMb2NhdGlvbihiLCAiYVRleCIpOwogICAgICAgIHRoaXMuX2xvY0FQb2ludHMgPSBlLmdldEF0dHJpYkxvY2F0aW9uKGIsICJhUG9pbnRzIik7IC0gMSAhPT0gYyAmJiAoZS5iaW5kQnVmZmVyKGUuQVJSQVlfQlVGRkVSLCBhLl92ZXJ0ZXhCdWZmZXIpLCBlLnZlcnRleEF0dHJpYlBvaW50ZXIoYywgYS5HZXROdW1WZXJ0ZXhDb21wb25lbnRzKCksIGUuRkxPQVQsICExLCAwLCAwKSwgZS5lbmFibGVWZXJ0ZXhBdHRyaWJBcnJheShjKSk7IC0gMSAhPT0gayAmJiAoZS5iaW5kQnVmZmVyKGUuQVJSQVlfQlVGRkVSLCBhLl90ZXhjb29yZEJ1ZmZlciksCiAgICAgICAgICAgIGUudmVydGV4QXR0cmliUG9pbnRlcihrLCAyLCBlLkZMT0FULCAhMSwgMCwgMCksIGUuZW5hYmxlVmVydGV4QXR0cmliQXJyYXkoaykpOyAtIDEgIT09IHRoaXMuX2xvY0FQb2ludHMgJiYgKGUuYmluZEJ1ZmZlcihlLkFSUkFZX0JVRkZFUiwgYS5fcG9pbnRCdWZmZXIpLCBlLnZlcnRleEF0dHJpYlBvaW50ZXIodGhpcy5fbG9jQVBvaW50cywgNCwgZS5GTE9BVCwgITEsIDAsIDApLCBlLmVuYWJsZVZlcnRleEF0dHJpYkFycmF5KHRoaXMuX2xvY0FQb2ludHMpKTsKICAgICAgICBlLmJpbmRCdWZmZXIoZS5BUlJBWV9CVUZGRVIsIG51bGwpOwogICAgICAgIHRoaXMuX3VNYXRQID0gbmV3IEMzJGpzY29tcCQ0NC5HZnguV2ViR0xTaGFkZXJVbmlmb3JtKHRoaXMsICJtYXRQIiwgIm1hdDQiKTsKICAgICAgICB0aGlzLl91TWF0TVYgPSBuZXcgQzMkanNjb21wJDQ0LkdmeC5XZWJHTFNoYWRlclVuaWZvcm0odGhpcywgIm1hdE1WIiwgIm1hdDQiKTsKICAgICAgICB0aGlzLl91Q29sb3IgPSBuZXcgQzMkanNjb21wJDQ0LkdmeC5XZWJHTFNoYWRlclVuaWZvcm0odGhpcywgImNvbG9yIiwgInZlYzQiKTsKICAgICAgICB0aGlzLl91U2FtcGxlckZyb250ID0KICAgICAgICAgICAgbmV3IEMzJGpzY29tcCQ0NC5HZnguV2ViR0xTaGFkZXJVbmlmb3JtKHRoaXMsICJzYW1wbGVyRnJvbnQiLCAic2FtcGxlciIpOwogICAgICAgIHRoaXMuX3VQb2ludFRleFN0YXJ0ID0gbmV3IEMzJGpzY29tcCQ0NC5HZnguV2ViR0xTaGFkZXJVbmlmb3JtKHRoaXMsICJwb2ludFRleFN0YXJ0IiwgInZlYzIiKTsKICAgICAgICB0aGlzLl91UG9pbnRUZXhFbmQgPSBuZXcgQzMkanNjb21wJDQ0LkdmeC5XZWJHTFNoYWRlclVuaWZvcm0odGhpcywgInBvaW50VGV4RW5kIiwgInZlYzIiKTsKICAgICAgICB0aGlzLl91WkVsZXZhdGlvbiA9IG5ldyBDMyRqc2NvbXAkNDQuR2Z4LldlYkdMU2hhZGVyVW5pZm9ybSh0aGlzLCAiekVsZXZhdGlvbiIsICJmbG9hdCIpOwogICAgICAgIHRoaXMuX3VUaWxlU2l6ZSA9IG5ldyBDMyRqc2NvbXAkNDQuR2Z4LldlYkdMU2hhZGVyVW5pZm9ybSh0aGlzLCAidGlsZVNpemUiLCAidmVjMiIpOwogICAgICAgIHRoaXMuX3VUaWxlU3BhY2luZyA9IG5ldyBDMyRqc2NvbXAkNDQuR2Z4LldlYkdMU2hhZGVyVW5pZm9ybSh0aGlzLCAidGlsZVNwYWNpbmciLCAidmVjMiIpOwogICAgICAgIHRoaXMuX3VDb2xvcjIgPQogICAgICAgICAgICBuZXcgQzMkanNjb21wJDQ0LkdmeC5XZWJHTFNoYWRlclVuaWZvcm0odGhpcywgImNvbG9yMl8iLCAidmVjNCIpOwogICAgICAgIHRoaXMuX3VPdXRsaW5lVGhpY2tuZXNzID0gbmV3IEMzJGpzY29tcCQ0NC5HZnguV2ViR0xTaGFkZXJVbmlmb3JtKHRoaXMsICJvdXRsaW5lVGhpY2tuZXNzIiwgImZsb2F0Iik7CiAgICAgICAgdGhpcy5fdVNhbXBsZXJCYWNrID0gbmV3IEMzJGpzY29tcCQ0NC5HZnguV2ViR0xTaGFkZXJVbmlmb3JtKHRoaXMsICJzYW1wbGVyQmFjayIsICJzYW1wbGVyIik7CiAgICAgICAgdGhpcy5fdVNhbXBsZXJEZXB0aCA9IG5ldyBDMyRqc2NvbXAkNDQuR2Z4LldlYkdMU2hhZGVyVW5pZm9ybSh0aGlzLCAic2FtcGxlckRlcHRoIiwgInNhbXBsZXIiKTsKICAgICAgICB0aGlzLl91RGVzdFN0YXJ0ID0gbmV3IEMzJGpzY29tcCQ0NC5HZnguV2ViR0xTaGFkZXJVbmlmb3JtKHRoaXMsICJkZXN0U3RhcnQiLCAidmVjMiIpOwogICAgICAgIHRoaXMuX3VEZXN0RW5kID0gbmV3IEMzJGpzY29tcCQ0NC5HZnguV2ViR0xTaGFkZXJVbmlmb3JtKHRoaXMsICJkZXN0RW5kIiwgInZlYzIiKTsKICAgICAgICB0aGlzLl91U3JjU3RhcnQgPQogICAgICAgICAgICBuZXcgQzMkanNjb21wJDQ0LkdmeC5XZWJHTFNoYWRlclVuaWZvcm0odGhpcywgInNyY1N0YXJ0IiwgInZlYzIiKTsKICAgICAgICB0aGlzLl91U3JjRW5kID0gbmV3IEMzJGpzY29tcCQ0NC5HZnguV2ViR0xTaGFkZXJVbmlmb3JtKHRoaXMsICJzcmNFbmQiLCAidmVjMiIpOwogICAgICAgIHRoaXMuX3VTcmNPcmlnaW5TdGFydCA9IG5ldyBDMyRqc2NvbXAkNDQuR2Z4LldlYkdMU2hhZGVyVW5pZm9ybSh0aGlzLCAic3JjT3JpZ2luU3RhcnQiLCAidmVjMiIpOwogICAgICAgIHRoaXMuX3VTcmNPcmlnaW5FbmQgPSBuZXcgQzMkanNjb21wJDQ0LkdmeC5XZWJHTFNoYWRlclVuaWZvcm0odGhpcywgInNyY09yaWdpbkVuZCIsICJ2ZWMyIik7CiAgICAgICAgdGhpcy5fdVBpeGVsU2l6ZSA9IG5ldyBDMyRqc2NvbXAkNDQuR2Z4LldlYkdMU2hhZGVyVW5pZm9ybSh0aGlzLCAicGl4ZWxTaXplIiwgInZlYzIiKTsKICAgICAgICB0aGlzLl91U2Vjb25kcyA9IG5ldyBDMyRqc2NvbXAkNDQuR2Z4LldlYkdMU2hhZGVyVW5pZm9ybSh0aGlzLCAic2Vjb25kcyIsICJmbG9hdCIpOwogICAgICAgIHRoaXMuX3VEZXZpY2VQaXhlbFJhdGlvID0KICAgICAgICAgICAgbmV3IEMzJGpzY29tcCQ0NC5HZnguV2ViR0xTaGFkZXJVbmlmb3JtKHRoaXMsICJkZXZpY2VQaXhlbFJhdGlvIiwgImZsb2F0Iik7CiAgICAgICAgdGhpcy5fdUxheWVyU2NhbGUgPSBuZXcgQzMkanNjb21wJDQ0LkdmeC5XZWJHTFNoYWRlclVuaWZvcm0odGhpcywgImxheWVyU2NhbGUiLCAiZmxvYXQiKTsKICAgICAgICB0aGlzLl91TGF5ZXJBbmdsZSA9IG5ldyBDMyRqc2NvbXAkNDQuR2Z4LldlYkdMU2hhZGVyVW5pZm9ybSh0aGlzLCAibGF5ZXJBbmdsZSIsICJmbG9hdCIpOwogICAgICAgIHRoaXMuX3VMYXlvdXRTdGFydCA9IG5ldyBDMyRqc2NvbXAkNDQuR2Z4LldlYkdMU2hhZGVyVW5pZm9ybSh0aGlzLCAibGF5b3V0U3RhcnQiLCAidmVjMiIpOwogICAgICAgIHRoaXMuX3VMYXlvdXRFbmQgPSBuZXcgQzMkanNjb21wJDQ0LkdmeC5XZWJHTFNoYWRlclVuaWZvcm0odGhpcywgImxheW91dEVuZCIsICJ2ZWMyIik7CiAgICAgICAgdGhpcy5faGFzQW55T3B0aW9uYWxVbmlmb3JtcyA9ICEhKHRoaXMuX3VQaXhlbFNpemUuSXNVc2VkKCkgfHwgdGhpcy5fdVNlY29uZHMuSXNVc2VkKCkgfHwgdGhpcy5fdVNhbXBsZXJCYWNrLklzVXNlZCgpIHx8CiAgICAgICAgICAgIHRoaXMuX3VEZXN0U3RhcnQuSXNVc2VkKCkgfHwgdGhpcy5fdURlc3RFbmQuSXNVc2VkKCkgfHwgdGhpcy5fdVNyY1N0YXJ0LklzVXNlZCgpIHx8IHRoaXMuX3VTcmNFbmQuSXNVc2VkKCkgfHwgdGhpcy5fdVNyY09yaWdpblN0YXJ0LklzVXNlZCgpIHx8IHRoaXMuX3VTcmNPcmlnaW5FbmQuSXNVc2VkKCkgfHwgdGhpcy5fdURldmljZVBpeGVsUmF0aW8uSXNVc2VkKCkgfHwgdGhpcy5fdUxheWVyU2NhbGUuSXNVc2VkKCkgfHwgdGhpcy5fdUxheWVyQW5nbGUuSXNVc2VkKCkgfHwgdGhpcy5fdUxheW91dFN0YXJ0LklzVXNlZCgpIHx8IHRoaXMuX3VMYXlvdXRFbmQuSXNVc2VkKCkpOwogICAgICAgIGEgPSBkLnBhcmFtZXRlcnMgfHwgW107CiAgICAgICAgdGhpcy5fdUN1c3RvbVBhcmFtZXRlcnMgPSBbXTsKICAgICAgICB0aGlzLl91c2VzQW55U3JjUmVjdE9yUGl4ZWxTaXplID0gdGhpcy5fdVBpeGVsU2l6ZS5Jc1VzZWQoKSB8fCB0aGlzLl91U3JjU3RhcnQuSXNVc2VkKCkgfHwgdGhpcy5fdVNyY0VuZC5Jc1VzZWQoKSB8fCB0aGlzLl91U3JjT3JpZ2luU3RhcnQuSXNVc2VkKCkgfHwgdGhpcy5fdVNyY09yaWdpbkVuZC5Jc1VzZWQoKTsKICAgICAgICB0aGlzLl9oYXNDdXJyZW50TWF0TVYgPSB0aGlzLl9oYXNDdXJyZW50TWF0UCA9ICExOwogICAgICAgIHRoaXMuX3VDb2xvci5Jbml0NGYoMSwgMSwgMSwgMSk7CiAgICAgICAgdGhpcy5fdUNvbG9yMi5Jbml0NGYoMSwgMSwgMSwgMSk7CiAgICAgICAgdGhpcy5fdVNhbXBsZXJGcm9udC5Jbml0MWkoMCk7CiAgICAgICAgdGhpcy5fdVNhbXBsZXJCYWNrLkluaXQxaSgxKTsKICAgICAgICB0aGlzLl91U2FtcGxlckRlcHRoLkluaXQxaSgyKTsKICAgICAgICB0aGlzLl91UG9pbnRUZXhTdGFydC5Jbml0MmYoMCwgMCk7CiAgICAgICAgdGhpcy5fdVBvaW50VGV4RW5kLkluaXQyZigxLCAxKTsKICAgICAgICB0aGlzLl91WkVsZXZhdGlvbi5Jbml0MWYoMCk7CiAgICAgICAgdGhpcy5fdVRpbGVTaXplLkluaXQyZigwLCAwKTsKICAgICAgICB0aGlzLl91VGlsZVNwYWNpbmcuSW5pdDJmKDAsIDApOwogICAgICAgIHRoaXMuX3VEZXN0U3RhcnQuSW5pdDJmKDAsIDApOwogICAgICAgIHRoaXMuX3VEZXN0RW5kLkluaXQyZigxLCAxKTsKICAgICAgICB0aGlzLl91U3JjU3RhcnQuSW5pdDJmKDAsIDApOwogICAgICAgIHRoaXMuX3VTcmNFbmQuSW5pdDJmKDAsIDApOwogICAgICAgIHRoaXMuX3VTcmNPcmlnaW5TdGFydC5Jbml0MmYoMCwgMCk7CiAgICAgICAgdGhpcy5fdVNyY09yaWdpbkVuZC5Jbml0MmYoMCwKICAgICAgICAgICAgMCk7CiAgICAgICAgdGhpcy5fdVBpeGVsU2l6ZS5Jbml0MmYoMCwgMCk7CiAgICAgICAgdGhpcy5fdURldmljZVBpeGVsUmF0aW8uSW5pdDFmKDEpOwogICAgICAgIHRoaXMuX3VMYXllclNjYWxlLkluaXQxZigxKTsKICAgICAgICB0aGlzLl91TGF5ZXJBbmdsZS5Jbml0MWYoMCk7CiAgICAgICAgdGhpcy5fdVNlY29uZHMuSW5pdDFmKDApOwogICAgICAgIHRoaXMuX3VMYXlvdXRTdGFydC5Jbml0MmYoMCwgMCk7CiAgICAgICAgdGhpcy5fdUxheW91dEVuZC5Jbml0MmYoMCwgMCk7CiAgICAgICAgdGhpcy5fdU91dGxpbmVUaGlja25lc3MuSW5pdDFmKDEpOwogICAgICAgIGZvciAoY29uc3QgbSBvZiBhKSBhID0gbVsyXSwgYiA9IG5ldyBDMyRqc2NvbXAkNDQuR2Z4LldlYkdMU2hhZGVyVW5pZm9ybSh0aGlzLCBtWzBdLCBhKSwgImNvbG9yIiA9PT0gYSA/IGIuSW5pdDNmKDAsIDAsIDApIDogYi5Jbml0MWYoMCksIHRoaXMuX3VDdXN0b21QYXJhbWV0ZXJzLnB1c2goYik7CiAgICAgICAgdGhpcy5faXNEZXZpY2VUcmFuc2Zvcm0gPyB0aGlzLl9VcGRhdGVEZXZpY2VUcmFuc2Zvcm1Vbmlmb3JtcyhnLmN1cnJlbnRNYXRQKSA6ICh0aGlzLlVwZGF0ZU1hdFAoZy5jdXJyZW50TWF0UCwgITApLAogICAgICAgICAgICB0aGlzLlVwZGF0ZU1hdE1WKGcuY3VycmVudE1WLCAhMCkpOwogICAgICAgIGcgPSBnLmN1cnJlbnRTaGFkZXI7CiAgICAgICAgZS51c2VQcm9ncmFtKGcgPyBnLl9zaGFkZXJQcm9ncmFtIDogbnVsbCkKICAgIH0KICAgIFJlbGVhc2UoKSB7CiAgICAgICAgdGhpcy5fZ2wuZGVsZXRlUHJvZ3JhbSh0aGlzLl9zaGFkZXJQcm9ncmFtKTsKICAgICAgICB0aGlzLl9zaGFkZXJQcm9ncmFtID0gbnVsbDsKICAgICAgICB0aGlzLl9yZW5kZXJlci5fUmVtb3ZlU2hhZGVyUHJvZ3JhbSh0aGlzKTsKICAgICAgICB0aGlzLl9nbCA9IG51bGw7CiAgICAgICAgc3VwZXIuUmVsZWFzZSgpCiAgICB9CiAgICBHZXRXZWJHTENvbnRleHQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2dsCiAgICB9CiAgICBHZXRTaGFkZXJQcm9ncmFtKCkgewogICAgICAgIHJldHVybiB0aGlzLl9zaGFkZXJQcm9ncmFtCiAgICB9CiAgICBHZXRQYXJhbWV0ZXJDb3VudCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdUN1c3RvbVBhcmFtZXRlcnMubGVuZ3RoCiAgICB9CiAgICBHZXRQYXJhbWV0ZXJUeXBlKGEpIHsKICAgICAgICByZXR1cm4gMCA+IGEgfHwgYSA+PSB0aGlzLl91Q3VzdG9tUGFyYW1ldGVycy5sZW5ndGggPyBudWxsIDogdGhpcy5fdUN1c3RvbVBhcmFtZXRlcnNbYV0uR2V0VHlwZSgpCiAgICB9CiAgICBBcmVDdXN0b21QYXJhbWV0ZXJzQWxyZWFkeVNldEluQmF0Y2goYSkgewogICAgICAgIGZvciAobGV0IGIgPQogICAgICAgICAgICAgICAgMCwgZCA9IGEubGVuZ3RoOyBiIDwgZDsgKytiKQogICAgICAgICAgICBpZiAoIXRoaXMuX3VDdXN0b21QYXJhbWV0ZXJzW2JdLklzU2V0VG9DdXN0b21JbkJhdGNoKGFbYl0pKSByZXR1cm4gITE7CiAgICAgICAgcmV0dXJuICEwCiAgICB9CiAgICBTZXRDdXN0b21QYXJhbWV0ZXJzSW5CYXRjaChhKSB7CiAgICAgICAgZm9yIChsZXQgYiA9IDAsIGQgPSBhLmxlbmd0aDsgYiA8IGQ7ICsrYikgdGhpcy5fdUN1c3RvbVBhcmFtZXRlcnNbYl0uU2V0QmF0Y2hWYWx1ZUN1c3RvbShhW2JdKQogICAgfQogICAgQXJlT3B0aW9uYWxVbmlmb3Jtc0FscmVhZHlTZXRJbkJhdGNoKGEsIGIsIGQsIGMsIGUsIGcsIGssIG0sIG4sIHEpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdVNhbXBsZXJCYWNrLklzVXNlZCgpIHx8IHRoaXMuX3VQaXhlbFNpemUuSXNVc2VkKCkgJiYgIXRoaXMuX3VQaXhlbFNpemUuSXNTZXRUbzJJbkJhdGNoKGUsIGcpIHx8IHRoaXMuX3VEZXN0U3RhcnQuSXNVc2VkKCkgJiYgIXRoaXMuX3VEZXN0U3RhcnQuSXNTZXRUbzJJbkJhdGNoKGEuZ2V0TGVmdCgpLCBhLmdldFRvcCgpKSB8fCB0aGlzLl91RGVzdEVuZC5Jc1VzZWQoKSAmJiAhdGhpcy5fdURlc3RFbmQuSXNTZXRUbzJJbkJhdGNoKGEuZ2V0UmlnaHQoKSwKICAgICAgICAgICAgICAgIGEuZ2V0Qm90dG9tKCkpIHx8IHRoaXMuX3VEZXZpY2VQaXhlbFJhdGlvLklzVXNlZCgpICYmICF0aGlzLl91RGV2aWNlUGl4ZWxSYXRpby5Jc1NldFRvMUluQmF0Y2goaykgfHwgdGhpcy5fdUxheWVyU2NhbGUuSXNVc2VkKCkgJiYgIXRoaXMuX3VMYXllclNjYWxlLklzU2V0VG8xSW5CYXRjaChtKSB8fCB0aGlzLl91TGF5ZXJBbmdsZS5Jc1VzZWQoKSAmJiAhdGhpcy5fdUxheWVyQW5nbGUuSXNTZXRUbzFJbkJhdGNoKG4pIHx8IHRoaXMuX3VTcmNTdGFydC5Jc1VzZWQoKSAmJiAhdGhpcy5fdVNyY1N0YXJ0LklzU2V0VG8ySW5CYXRjaChiLmdldExlZnQoKSwgYi5nZXRUb3AoKSkgfHwgdGhpcy5fdVNyY0VuZC5Jc1VzZWQoKSAmJiAhdGhpcy5fdVNyY0VuZC5Jc1NldFRvMkluQmF0Y2goYi5nZXRSaWdodCgpLCBiLmdldEJvdHRvbSgpKSB8fCB0aGlzLl91U3JjT3JpZ2luU3RhcnQuSXNVc2VkKCkgJiYgIXRoaXMuX3VTcmNPcmlnaW5TdGFydC5Jc1NldFRvMkluQmF0Y2goZC5nZXRMZWZ0KCksIGQuZ2V0VG9wKCkpIHx8IHRoaXMuX3VTcmNPcmlnaW5FbmQuSXNVc2VkKCkgJiYKICAgICAgICAgICAgIXRoaXMuX3VTcmNPcmlnaW5FbmQuSXNTZXRUbzJJbkJhdGNoKGQuZ2V0UmlnaHQoKSwgZC5nZXRCb3R0b20oKSkgfHwgdGhpcy5fdUxheW91dFN0YXJ0LklzVXNlZCgpICYmICF0aGlzLl91TGF5b3V0U3RhcnQuSXNTZXRUbzJJbkJhdGNoKGMuZ2V0TGVmdCgpLCBjLmdldFRvcCgpKSB8fCB0aGlzLl91TGF5b3V0RW5kLklzVXNlZCgpICYmICF0aGlzLl91TGF5b3V0RW5kLklzU2V0VG8ySW5CYXRjaChjLmdldFRvcCgpLCBjLmdldEJvdHRvbSgpKSB8fCB0aGlzLl91U2Vjb25kcy5Jc1VzZWQoKSAmJiAhdGhpcy5fdVNlY29uZHMuSXNTZXRUbzFJbkJhdGNoKHEpID8gITEgOiAhMAogICAgfQogICAgU2V0T3B0aW9uYWxVbmlmb3Jtc0luQmF0Y2goYSwgYiwgZCwgYywgZSwgZywgaywgbSwgbiwgcSkgewogICAgICAgIHRoaXMuX3VTYW1wbGVyQmFjay5Jc1VzZWQoKSB8fCAodGhpcy5fdVBpeGVsU2l6ZS5Jc1VzZWQoKSAmJiB0aGlzLl91UGl4ZWxTaXplLlNldEJhdGNoMihlLCBnKSwgdGhpcy5fdURlc3RTdGFydC5Jc1VzZWQoKSAmJiB0aGlzLl91RGVzdFN0YXJ0LlNldEJhdGNoMihhLmdldExlZnQoKSwKICAgICAgICAgICAgYS5nZXRUb3AoKSksIHRoaXMuX3VEZXN0RW5kLklzVXNlZCgpICYmIHRoaXMuX3VEZXN0RW5kLlNldEJhdGNoMihhLmdldFJpZ2h0KCksIGEuZ2V0Qm90dG9tKCkpLCB0aGlzLl91RGV2aWNlUGl4ZWxSYXRpby5Jc1VzZWQoKSAmJiB0aGlzLl91RGV2aWNlUGl4ZWxSYXRpby5TZXRCYXRjaDEoayksIHRoaXMuX3VMYXllclNjYWxlLklzVXNlZCgpICYmIHRoaXMuX3VMYXllclNjYWxlLlNldEJhdGNoMShtKSwgdGhpcy5fdUxheWVyQW5nbGUuSXNVc2VkKCkgJiYgdGhpcy5fdUxheWVyQW5nbGUuU2V0QmF0Y2gxKG4pLCB0aGlzLl91U3JjU3RhcnQuSXNVc2VkKCkgJiYgdGhpcy5fdVNyY1N0YXJ0LlNldEJhdGNoMihiLmdldExlZnQoKSwgYi5nZXRUb3AoKSksIHRoaXMuX3VTcmNFbmQuSXNVc2VkKCkgJiYgdGhpcy5fdVNyY0VuZC5TZXRCYXRjaDIoYi5nZXRSaWdodCgpLCBiLmdldEJvdHRvbSgpKSwgdGhpcy5fdVNyY09yaWdpblN0YXJ0LklzVXNlZCgpICYmIHRoaXMuX3VTcmNPcmlnaW5TdGFydC5TZXRCYXRjaDIoZC5nZXRMZWZ0KCksCiAgICAgICAgICAgIGQuZ2V0VG9wKCkpLCB0aGlzLl91U3JjT3JpZ2luRW5kLklzVXNlZCgpICYmIHRoaXMuX3VTcmNPcmlnaW5FbmQuU2V0QmF0Y2gyKGQuZ2V0UmlnaHQoKSwgZC5nZXRCb3R0b20oKSksIHRoaXMuX3VMYXlvdXRTdGFydC5Jc1VzZWQoKSAmJiB0aGlzLl91TGF5b3V0U3RhcnQuU2V0QmF0Y2gyKGMuZ2V0TGVmdCgpLCBjLmdldFRvcCgpKSwgdGhpcy5fdUxheW91dEVuZC5Jc1VzZWQoKSAmJiB0aGlzLl91TGF5b3V0RW5kLlNldEJhdGNoMihjLmdldFRvcCgpLCBjLmdldEJvdHRvbSgpKSwgdGhpcy5fdVNlY29uZHMuSXNVc2VkKCkgJiYgdGhpcy5fdVNlY29uZHMuU2V0QmF0Y2gxKHEpKQogICAgfQogICAgVXBkYXRlTWF0UChhLCBiKSB7CiAgICAgICAgdGhpcy5faGFzQ3VycmVudE1hdFAgJiYgIWIgfHwgdGhpcy5faXNEZXZpY2VUcmFuc2Zvcm0gfHwgKHRoaXMuX3VNYXRQLklzVXNlZCgpICYmIHRoaXMuX3VNYXRQLlVwZGF0ZU1hdHJpeDRmdihhKSwgdGhpcy5faGFzQ3VycmVudE1hdFAgPSAhMCkKICAgIH0KICAgIFNldE1hdFBTdGFsZSgpIHsKICAgICAgICB0aGlzLl9oYXNDdXJyZW50TWF0UCA9ICExCiAgICB9CiAgICBVcGRhdGVNYXRNVihhLAogICAgICAgIGIpIHsKICAgICAgICB0aGlzLl9oYXNDdXJyZW50TWF0TVYgJiYgIWIgfHwgdGhpcy5faXNEZXZpY2VUcmFuc2Zvcm0gfHwgKHRoaXMuX3VNYXRNVi5Jc1VzZWQoKSAmJiB0aGlzLl91TWF0TVYuVXBkYXRlTWF0cml4NGZ2KGEpLCB0aGlzLl9oYXNDdXJyZW50TWF0TVYgPSAhMCkKICAgIH0KICAgIFNldE1hdE1WU3RhbGUoKSB7CiAgICAgICAgdGhpcy5faGFzQ3VycmVudE1hdE1WID0gITEKICAgIH0KICAgIF9VcGRhdGVEZXZpY2VUcmFuc2Zvcm1Vbmlmb3JtcyhhKSB7CiAgICAgICAgaWYgKCF0aGlzLl9pc0RldmljZVRyYW5zZm9ybSkgdGhyb3cgRXJyb3IoIm5vdCBkZXZpY2UgdHJhbnNmb3JtIHNoYWRlciIpOwogICAgICAgIHRoaXMuX3VNYXRQLlVwZGF0ZU1hdHJpeDRmdihhKTsKICAgICAgICBhID0gdGhpcy5fcmVuZGVyZXI7CiAgICAgICAgY29uc3QgYiA9IGEuR2V0V2lkdGgoKSAvIDIsCiAgICAgICAgICAgIGQgPSBhLkdldEhlaWdodCgpIC8gMjsKICAgICAgICBhID0gYS5DYWxjdWxhdGVMb29rQXRNb2RlbFZpZXcyKGIsIGQsIGEuR2V0RGVmYXVsdENhbWVyYVooYS5HZXRIZWlnaHQoKSksIGIsIGQsIDAsIGEuR2V0SGVpZ2h0KCkpOwogICAgICAgIHRoaXMuX3VNYXRNVi5VcGRhdGVNYXRyaXg0ZnYoYSkKICAgIH0KICAgIFVwZGF0ZUNvbG9yKGEpIHsKICAgICAgICB0aGlzLl91Q29sb3IuSXNVc2VkKCkgJiYKICAgICAgICAgICAgdGhpcy5fdUNvbG9yLlVwZGF0ZTRmKGFbMF0sIGFbMV0sIGFbMl0sIGFbM10pCiAgICB9CiAgICBzdGF0aWMgR2V0UmVzZXJ2ZWRVbmlmb3JtTmFtZXMoKSB7CiAgICAgICAgcmV0dXJuIFJFU0VSVkVEX1VOSUZPUk1fTkFNRVMKICAgIH0KICAgIHN0YXRpYyBHZXREZWZhdWx0VmVydGV4U2hhZGVyU291cmNlKGEpIHsKICAgICAgICBhID0gYSA/ICJoaWdobWVkcCIgOiAibWVkaXVtcCI7CiAgICAgICAgcmV0dXJuIFsiI2lmZGVmIEdMX0ZSQUdNRU5UX1BSRUNJU0lPTl9ISUdIXG4jZGVmaW5lIGhpZ2htZWRwIGhpZ2hwXG4jZWxzZVxuI2RlZmluZSBoaWdobWVkcCBtZWRpdW1wXG4jZW5kaWZcbmF0dHJpYnV0ZSBoaWdocCB2ZWMzIGFQb3M7IiwgYGF0dHJpYnV0ZSAke2F9IHZlYzIgYVRleDtgLCBgdmFyeWluZyAke2F9IHZlYzIgdlRleDtgLCAidW5pZm9ybSBoaWdocCBtYXQ0IG1hdFA7XG51bmlmb3JtIGhpZ2hwIG1hdDQgbWF0TVY7XG52b2lkIG1haW4odm9pZCkge1xuXHRnbF9Qb3NpdGlvbiA9IG1hdFAgKiBtYXRNViAqIHZlYzQoYVBvcywgMS4wKTtcblx0dlRleCA9IGFUZXg7XG59Il0uam9pbigiXG4iKQogICAgfQogICAgc3RhdGljIEdldERlZmF1bHRWZXJ0ZXhTaGFkZXJTb3VyY2VfV2ViR0wyKGEpIHsKICAgICAgICBhID0KICAgICAgICAgICAgYSA/ICJoaWdocCIgOiAibWVkaXVtcCI7CiAgICAgICAgcmV0dXJuIFsiI3ZlcnNpb24gMzAwIGVzXG5pbiBoaWdocCB2ZWMzIGFQb3M7IiwgYGluICR7YX0gdmVjMiBhVGV4O2AsIGBvdXQgJHthfSB2ZWMyIHZUZXg7YCwgInVuaWZvcm0gaGlnaHAgbWF0NCBtYXRQO1xudW5pZm9ybSBoaWdocCBtYXQ0IG1hdE1WO1xudm9pZCBtYWluKHZvaWQpIHtcblx0Z2xfUG9zaXRpb24gPSBtYXRQICogbWF0TVYgKiB2ZWM0KGFQb3MsIDEuMCk7XG5cdHZUZXggPSBhVGV4O1xufSJdLmpvaW4oIlxuIikKICAgIH0KICAgIHN0YXRpYyBHZXRUZXh0dXJlRmlsbEZyYWdtZW50U2hhZGVyU291cmNlX1dlYkdMMV9Ob0ZyYWdEZXB0aCgpIHsKICAgICAgICByZXR1cm4gInZhcnlpbmcgbWVkaXVtcCB2ZWMyIHZUZXg7XG51bmlmb3JtIGxvd3AgdmVjNCBjb2xvcjtcbnVuaWZvcm0gbG93cCBzYW1wbGVyMkQgc2FtcGxlckZyb250O1xudm9pZCBtYWluKHZvaWQpIHtcblx0Z2xfRnJhZ0NvbG9yID0gdGV4dHVyZTJEKHNhbXBsZXJGcm9udCwgdlRleCkgKiBjb2xvcjtcbn0iCiAgICB9CiAgICBzdGF0aWMgR2V0VGV4dHVyZUZpbGxGcmFnbWVudFNoYWRlclNvdXJjZV9XZWJHTDFfRnJhZ0RlcHRoRVhUKCkgewogICAgICAgIHJldHVybiAiI2V4dGVuc2lvbiBHTF9FWFRfZnJhZ19kZXB0aCA6IGVuYWJsZVxudmFyeWluZyBtZWRpdW1wIHZlYzIgdlRleDtcbnVuaWZvcm0gbG93cCB2ZWM0IGNvbG9yO1xudW5pZm9ybSBsb3dwIHNhbXBsZXIyRCBzYW1wbGVyRnJvbnQ7XG52b2lkIG1haW4odm9pZCkge1xuXHRnbF9GcmFnQ29sb3IgPSB0ZXh0dXJlMkQoc2FtcGxlckZyb250LCB2VGV4KSAqIGNvbG9yO1xuXHRnbF9GcmFnRGVwdGhFWFQgPSAoZ2xfRnJhZ0NvbG9yLmEgPT0gMC4wID8gMS4wIDogZ2xfRnJhZ0Nvb3JkLnopO1xufSIKICAgIH0KICAgIHN0YXRpYyBHZXRUZXh0dXJlRmlsbEZyYWdtZW50U2hhZGVyU291cmNlX1dlYkdMMigpIHsKICAgICAgICByZXR1cm4gIiN2ZXJzaW9uIDMwMCBlc1xuaW4gbWVkaXVtcCB2ZWMyIHZUZXg7XG5vdXQgbG93cCB2ZWM0IG91dENvbG9yO1xudW5pZm9ybSBsb3dwIHZlYzQgY29sb3I7XG51bmlmb3JtIGxvd3Agc2FtcGxlcjJEIHNhbXBsZXJGcm9udDtcbnZvaWQgbWFpbih2b2lkKSB7XG5cdG91dENvbG9yID0gdGV4dHVyZShzYW1wbGVyRnJvbnQsIHZUZXgpICogY29sb3I7XG5cdGdsX0ZyYWdEZXB0aCA9IChvdXRDb2xvci5hID09IDAuMCA/IDEuMCA6IGdsX0ZyYWdDb29yZC56KTtcbn0iCiAgICB9CiAgICBzdGF0aWMgR2V0VGlsZW1hcEZyYWdtZW50U2hhZGVyU291cmNlX1dlYkdMMV9Ob0ZyYWdEZXB0aCgpIHsKICAgICAgICByZXR1cm4gIiNpZmRlZiBHTF9GUkFHTUVOVF9QUkVDSVNJT05fSElHSFxuI2RlZmluZSBoaWdobWVkcCBoaWdocFxuI2Vsc2VcbiNkZWZpbmUgaGlnaG1lZHAgbWVkaXVtcFxuI2VuZGlmXG52YXJ5aW5nIGhpZ2htZWRwIHZlYzIgdlRleDtcbnVuaWZvcm0gbG93cCB2ZWM0IGNvbG9yO1xudW5pZm9ybSBsb3dwIHNhbXBsZXIyRCBzYW1wbGVyRnJvbnQ7XG51bmlmb3JtIGhpZ2htZWRwIHZlYzIgc3JjU3RhcnQ7XG51bmlmb3JtIGhpZ2htZWRwIHZlYzIgcGl4ZWxTaXplO1xudW5pZm9ybSBoaWdobWVkcCB2ZWMyIHRpbGVTaXplO1xudW5pZm9ybSBoaWdobWVkcCB2ZWMyIHRpbGVTcGFjaW5nO1xudm9pZCBtYWluKHZvaWQpIHtcblx0aGlnaG1lZHAgdmVjMiB0aWxlID0gZmxvb3IodlRleCk7XG5cdGhpZ2htZWRwIHZlYzIgdGV4ID0gZnJhY3QodlRleCk7XG5cdGhpZ2htZWRwIHZlYzIgdGlsZU9yaWdpbiA9IHNyY1N0YXJ0ICsgdGlsZSAqICh0aWxlU2l6ZSArIHRpbGVTcGFjaW5nKTtcblx0aGlnaG1lZHAgdmVjMiBsb3dlckJvdW5kID0gdGlsZU9yaWdpbiArIHBpeGVsU2l6ZSAvIDIuMDtcblx0aGlnaG1lZHAgdmVjMiB1cHBlckJvdW5kID0gdGlsZU9yaWdpbiArIHRpbGVTaXplIC0gcGl4ZWxTaXplIC8gMi4wO1xuXHRnbF9GcmFnQ29sb3IgPSB0ZXh0dXJlMkQoc2FtcGxlckZyb250LCBjbGFtcCh0ZXgsIGxvd2VyQm91bmQsIHVwcGVyQm91bmQpLCAtMTYuMCkgKiBjb2xvcjtcbn0iCiAgICB9CiAgICBzdGF0aWMgR2V0VGlsZW1hcEZyYWdtZW50U2hhZGVyU291cmNlX1dlYkdMMV9GcmFnRGVwdGhFWFQoKSB7CiAgICAgICAgcmV0dXJuICIjZXh0ZW5zaW9uIEdMX0VYVF9mcmFnX2RlcHRoIDogZW5hYmxlXG4jaWZkZWYgR0xfRlJBR01FTlRfUFJFQ0lTSU9OX0hJR0hcbiNkZWZpbmUgaGlnaG1lZHAgaGlnaHBcbiNlbHNlXG4jZGVmaW5lIGhpZ2htZWRwIG1lZGl1bXBcbiNlbmRpZlxudmFyeWluZyBoaWdobWVkcCB2ZWMyIHZUZXg7XG51bmlmb3JtIGxvd3AgdmVjNCBjb2xvcjtcbnVuaWZvcm0gbG93cCBzYW1wbGVyMkQgc2FtcGxlckZyb250O1xudW5pZm9ybSBoaWdobWVkcCB2ZWMyIHNyY1N0YXJ0O1xudW5pZm9ybSBoaWdobWVkcCB2ZWMyIHBpeGVsU2l6ZTtcbnVuaWZvcm0gaGlnaG1lZHAgdmVjMiB0aWxlU2l6ZTtcbnVuaWZvcm0gaGlnaG1lZHAgdmVjMiB0aWxlU3BhY2luZztcbnZvaWQgbWFpbih2b2lkKSB7XG5cdGhpZ2htZWRwIHZlYzIgdGlsZSA9IGZsb29yKHZUZXgpO1xuXHRoaWdobWVkcCB2ZWMyIHRleCA9IGZyYWN0KHZUZXgpO1xuXHRoaWdobWVkcCB2ZWMyIHRpbGVPcmlnaW4gPSBzcmNTdGFydCArIHRpbGUgKiAodGlsZVNpemUgKyB0aWxlU3BhY2luZyk7XG5cdGhpZ2htZWRwIHZlYzIgbG93ZXJCb3VuZCA9IHRpbGVPcmlnaW4gKyBwaXhlbFNpemUgLyAyLjA7XG5cdGhpZ2htZWRwIHZlYzIgdXBwZXJCb3VuZCA9IHRpbGVPcmlnaW4gKyB0aWxlU2l6ZSAtIHBpeGVsU2l6ZSAvIDIuMDtcblx0Z2xfRnJhZ0NvbG9yID0gdGV4dHVyZTJEKHNhbXBsZXJGcm9udCwgY2xhbXAodGV4LCBsb3dlckJvdW5kLCB1cHBlckJvdW5kKSwgLTE2LjApICogY29sb3I7XG5cdGdsX0ZyYWdEZXB0aEVYVCA9IChnbF9GcmFnQ29sb3IuYSA9PSAwLjAgPyAxLjAgOiBnbF9GcmFnQ29vcmQueik7XG59IgogICAgfQogICAgc3RhdGljIEdldFRpbGVtYXBGcmFnbWVudFNoYWRlclNvdXJjZV9XZWJHTDIoKSB7CiAgICAgICAgcmV0dXJuICIjdmVyc2lvbiAzMDAgZXNcbmluIGhpZ2hwIHZlYzIgdlRleDtcbm91dCBsb3dwIHZlYzQgb3V0Q29sb3I7XG51bmlmb3JtIGxvd3AgdmVjNCBjb2xvcjtcbnVuaWZvcm0gbG93cCBzYW1wbGVyMkQgc2FtcGxlckZyb250O1xudW5pZm9ybSBoaWdocCB2ZWMyIHNyY1N0YXJ0O1xudW5pZm9ybSBoaWdocCB2ZWMyIHBpeGVsU2l6ZTtcbnVuaWZvcm0gaGlnaHAgdmVjMiB0aWxlU2l6ZTtcbnVuaWZvcm0gaGlnaHAgdmVjMiB0aWxlU3BhY2luZztcbnZvaWQgbWFpbih2b2lkKSB7XG5cdGhpZ2hwIHZlYzIgdGlsZSA9IGZsb29yKHZUZXgpO1xuXHRoaWdocCB2ZWMyIHRleCA9IGZyYWN0KHZUZXgpO1xuXHRoaWdocCB2ZWMyIHRpbGVPcmlnaW4gPSBzcmNTdGFydCArIHRpbGUgKiAodGlsZVNpemUgKyB0aWxlU3BhY2luZyk7XG5cdGhpZ2hwIHZlYzIgbG93ZXJCb3VuZCA9IHRpbGVPcmlnaW4gKyBwaXhlbFNpemUgLyAyLjA7XG5cdGhpZ2hwIHZlYzIgdXBwZXJCb3VuZCA9IHRpbGVPcmlnaW4gKyB0aWxlU2l6ZSAtIHBpeGVsU2l6ZSAvIDIuMDtcblx0b3V0Q29sb3IgPSB0ZXh0dXJlKHNhbXBsZXJGcm9udCwgY2xhbXAodGV4LCBsb3dlckJvdW5kLCB1cHBlckJvdW5kKSwgLTE2LjApICogY29sb3I7XG5cdGdsX0ZyYWdEZXB0aCA9IChvdXRDb2xvci5hID09IDAuMCA/IDEuMCA6IGdsX0ZyYWdDb29yZC56KTtcbn0iCiAgICB9CiAgICBzdGF0aWMgR2V0UG9pbnRWZXJ0ZXhTaGFkZXJTb3VyY2VfV2ViR0wxKCkgewogICAgICAgIHJldHVybiAiYXR0cmlidXRlIHZlYzQgYVBvaW50cztcbnZhcnlpbmcgZmxvYXQgcG9pbnRPcGFjaXR5O1xudW5pZm9ybSBmbG9hdCB6RWxldmF0aW9uO1xudW5pZm9ybSBtYXQ0IG1hdFA7XG51bmlmb3JtIG1hdDQgbWF0TVY7XG52b2lkIG1haW4odm9pZCkge1xuXHRnbF9Qb3NpdGlvbiA9IG1hdFAgKiBtYXRNViAqIHZlYzQoYVBvaW50cy54eSwgekVsZXZhdGlvbiwgMS4wKTtcblx0Z2xfUG9pbnRTaXplID0gYVBvaW50cy56O1xuXHRwb2ludE9wYWNpdHkgPSBhUG9pbnRzLnc7XG59IgogICAgfQogICAgc3RhdGljIEdldFBvaW50VmVydGV4U2hhZGVyU291cmNlX1dlYkdMMigpIHsKICAgICAgICByZXR1cm4gIiN2ZXJzaW9uIDMwMCBlc1xuaW4gdmVjNCBhUG9pbnRzO1xub3V0IGZsb2F0IHBvaW50T3BhY2l0eTtcbnVuaWZvcm0gZmxvYXQgekVsZXZhdGlvbjtcbnVuaWZvcm0gbWF0NCBtYXRQO1xudW5pZm9ybSBtYXQ0IG1hdE1WO1xudm9pZCBtYWluKHZvaWQpIHtcblx0Z2xfUG9zaXRpb24gPSBtYXRQICogbWF0TVYgKiB2ZWM0KGFQb2ludHMueHksIHpFbGV2YXRpb24sIDEuMCk7XG5cdGdsX1BvaW50U2l6ZSA9IGFQb2ludHMuejtcblx0cG9pbnRPcGFjaXR5ID0gYVBvaW50cy53O1xufSIKICAgIH0KICAgIHN0YXRpYyBHZXRQb2ludEZyYWdtZW50U2hhZGVyU291cmNlX1dlYkdMMV9Ob0ZyYWdEZXB0aCgpIHsKICAgICAgICByZXR1cm4gInVuaWZvcm0gbG93cCBzYW1wbGVyMkQgc2FtcGxlckZyb250O1xudmFyeWluZyBsb3dwIGZsb2F0IHBvaW50T3BhY2l0eTtcbnVuaWZvcm0gbWVkaXVtcCB2ZWMyIHBvaW50VGV4U3RhcnQ7XG51bmlmb3JtIG1lZGl1bXAgdmVjMiBwb2ludFRleEVuZDtcbnVuaWZvcm0gbG93cCB2ZWM0IGNvbG9yO1xudm9pZCBtYWluKHZvaWQpIHtcblx0Z2xfRnJhZ0NvbG9yID0gdGV4dHVyZTJEKHNhbXBsZXJGcm9udCwgbWl4KHBvaW50VGV4U3RhcnQsIHBvaW50VGV4RW5kLCBnbF9Qb2ludENvb3JkKSkgKiBjb2xvciAqIHBvaW50T3BhY2l0eTtcbn0iCiAgICB9CiAgICBzdGF0aWMgR2V0UG9pbnRGcmFnbWVudFNoYWRlclNvdXJjZV9XZWJHTDFfRnJhZ0RlcHRoRVhUKCkgewogICAgICAgIHJldHVybiAiI2V4dGVuc2lvbiBHTF9FWFRfZnJhZ19kZXB0aCA6IGVuYWJsZVxudW5pZm9ybSBsb3dwIHNhbXBsZXIyRCBzYW1wbGVyRnJvbnQ7XG52YXJ5aW5nIGxvd3AgZmxvYXQgcG9pbnRPcGFjaXR5O1xudW5pZm9ybSBtZWRpdW1wIHZlYzIgcG9pbnRUZXhTdGFydDtcbnVuaWZvcm0gbWVkaXVtcCB2ZWMyIHBvaW50VGV4RW5kO1xudW5pZm9ybSBsb3dwIHZlYzQgY29sb3I7XG52b2lkIG1haW4odm9pZCkge1xuXHRnbF9GcmFnQ29sb3IgPSB0ZXh0dXJlMkQoc2FtcGxlckZyb250LCBtaXgocG9pbnRUZXhTdGFydCwgcG9pbnRUZXhFbmQsIGdsX1BvaW50Q29vcmQpKSAqIGNvbG9yICogcG9pbnRPcGFjaXR5O1xuXHRnbF9GcmFnRGVwdGhFWFQgPSAoZ2xfRnJhZ0NvbG9yLmEgPT0gMC4wID8gMS4wIDogZ2xfRnJhZ0Nvb3JkLnopO1xufSIKICAgIH0KICAgIHN0YXRpYyBHZXRQb2ludEZyYWdtZW50U2hhZGVyU291cmNlX1dlYkdMMigpIHsKICAgICAgICByZXR1cm4gIiN2ZXJzaW9uIDMwMCBlc1xudW5pZm9ybSBsb3dwIHNhbXBsZXIyRCBzYW1wbGVyRnJvbnQ7XG5pbiBsb3dwIGZsb2F0IHBvaW50T3BhY2l0eTtcbnVuaWZvcm0gbWVkaXVtcCB2ZWMyIHBvaW50VGV4U3RhcnQ7XG51bmlmb3JtIG1lZGl1bXAgdmVjMiBwb2ludFRleEVuZDtcbnVuaWZvcm0gbG93cCB2ZWM0IGNvbG9yO1xub3V0IGxvd3AgdmVjNCBvdXRDb2xvcjtcbnZvaWQgbWFpbih2b2lkKSB7XG5cdG91dENvbG9yID0gdGV4dHVyZShzYW1wbGVyRnJvbnQsIG1peChwb2ludFRleFN0YXJ0LCBwb2ludFRleEVuZCwgZ2xfUG9pbnRDb29yZCkpICogY29sb3IgKiBwb2ludE9wYWNpdHk7XG5cdGdsX0ZyYWdEZXB0aCA9IChvdXRDb2xvci5hID09IDAuMCA/IDEuMCA6IGdsX0ZyYWdDb29yZC56KTtcbn0iCiAgICB9CiAgICBzdGF0aWMgR2V0Q29sb3JGaWxsRnJhZ21lbnRTaGFkZXJTb3VyY2UoKSB7CiAgICAgICAgcmV0dXJuICJ1bmlmb3JtIGxvd3AgdmVjNCBjb2xvcjtcbnZvaWQgbWFpbih2b2lkKSB7XG5cdGdsX0ZyYWdDb2xvciA9IGNvbG9yO1xufSIKICAgIH0KICAgIHN0YXRpYyBHZXRMaW5lYXJHcmFkaWVudEZpbGxGcmFnbWVudFNoYWRlclNvdXJjZSgpIHsKICAgICAgICByZXR1cm4gInByZWNpc2lvbiBsb3dwIGZsb2F0O1xudmFyeWluZyBtZWRpdW1wIHZlYzIgdlRleDtcbnVuaWZvcm0gdmVjNCBjb2xvcjtcbnVuaWZvcm0gdmVjNCBjb2xvcjJfO1xudmVjMyBmcm9tTGluZWFyKHZlYzMgbGluZWFyUkdCKVxue1xuXHRidmVjMyBjdXRvZmYgPSBsZXNzVGhhbihsaW5lYXJSR0IsIHZlYzMoMC4wMDMxMzA4KSk7XG5cdHZlYzMgaGlnaGVyID0gdmVjMygxLjA1NSkgKiBwb3coYWJzKGxpbmVhclJHQiksIHZlYzMoMS4wLzIuNCkpIC0gdmVjMygwLjA1NSk7XG5cdHZlYzMgbG93ZXIgPSBsaW5lYXJSR0IgKiB2ZWMzKDEyLjkyKTtcblx0cmV0dXJuIG1peChoaWdoZXIsIGxvd2VyLCB2ZWMzKGN1dG9mZikpO1xufVxudmVjMyB0b0xpbmVhcih2ZWMzIHNSR0IpXG57XG5cdGJ2ZWMzIGN1dG9mZiA9IGxlc3NUaGFuKHNSR0IsIHZlYzMoMC4wNDA0NSkpO1xuXHR2ZWMzIGhpZ2hlciA9IHBvdyhhYnMoKHNSR0IgKyB2ZWMzKDAuMDU1KSkvdmVjMygxLjA1NSkpLCB2ZWMzKDIuNCkpO1xuXHR2ZWMzIGxvd2VyID0gc1JHQi92ZWMzKDEyLjkyKTtcblx0cmV0dXJuIG1peChoaWdoZXIsIGxvd2VyLCB2ZWMzKGN1dG9mZikpO1xufVxudm9pZCBtYWluKHZvaWQpIHtcblx0dmVjMyBsaW5lYXJHcmFkID0gbWl4KHRvTGluZWFyKGNvbG9yLnJnYiksIHRvTGluZWFyKGNvbG9yMl8ucmdiKSwgdlRleC54KTtcblx0ZmxvYXQgYSA9IG1peChjb2xvci5hLCBjb2xvcjJfLmEsIHZUZXgueCk7XG5cdGdsX0ZyYWdDb2xvciA9IHZlYzQoZnJvbUxpbmVhcihsaW5lYXJHcmFkKSAqIGEsIGEpO1xufSIKICAgIH0KICAgIHN0YXRpYyBHZXRQZW51bWJyYUZpbGxGcmFnbWVudFNoYWRlclNvdXJjZSgpIHsKICAgICAgICByZXR1cm4gIiNpZmRlZiBHTF9GUkFHTUVOVF9QUkVDSVNJT05fSElHSFxuI2RlZmluZSBoaWdobWVkcCBoaWdocFxuI2Vsc2VcbiNkZWZpbmUgaGlnaG1lZHAgbWVkaXVtcFxuI2VuZGlmXG5wcmVjaXNpb24gbG93cCBmbG9hdDtcbnZhcnlpbmcgaGlnaG1lZHAgdmVjMiB2VGV4O1xudW5pZm9ybSB2ZWM0IGNvbG9yO1xudm9pZCBtYWluKHZvaWQpIHtcblx0aGlnaG1lZHAgZmxvYXQgZ3JhZCA9IHZUZXgueCAvICgxLjAgLSB2VGV4LnkpO1xuXHRnbF9GcmFnQ29sb3IgPSBjb2xvciAqICgxLjAgLSAoY29zKGdyYWQgKiAzLjE0MTU5MjY1MzU4OTc5MykgKyAxLjApIC8gMi4wKTtcbn0iCiAgICB9CiAgICBzdGF0aWMgR2V0U21vb3RoTGluZUZpbGxGcmFnbWVudFNoYWRlclNvdXJjZSgpIHsKICAgICAgICByZXR1cm4gInZhcnlpbmcgbWVkaXVtcCB2ZWMyIHZUZXg7XG51bmlmb3JtIGxvd3AgdmVjNCBjb2xvcjtcbnZvaWQgbWFpbih2b2lkKSB7XG5cdGxvd3AgZmxvYXQgZiA9IDEuMCAtIGFicyh2VGV4LnkgLSAwLjUpICogMi4wO1xuXHRnbF9GcmFnQ29sb3IgPSBjb2xvciAqIGY7XG59IgogICAgfQogICAgc3RhdGljIEdldEhhcmRFbGxpcHNlRmlsbEZyYWdtZW50U2hhZGVyU291cmNlKCkgewogICAgICAgIHJldHVybiAidmFyeWluZyBtZWRpdW1wIHZlYzIgdlRleDtcbnVuaWZvcm0gbG93cCB2ZWM0IGNvbG9yO1xudm9pZCBtYWluKHZvaWQpIHtcblx0bWVkaXVtcCB2ZWMyIGRpZmYgPSB2VGV4IC0gdmVjMigwLjUsIDAuNSk7XG5cdG1lZGl1bXAgdmVjMiBkaWZmU3EgPSBkaWZmICogZGlmZjtcblx0bWVkaXVtcCBmbG9hdCBmID0gc3RlcChkaWZmU3EueCArIGRpZmZTcS55LCAwLjI1KTtcblx0Z2xfRnJhZ0NvbG9yID0gY29sb3IgKiBmO1xufSIKICAgIH0KICAgIHN0YXRpYyBHZXRIYXJkRWxsaXBzZU91dGxpbmVGcmFnbWVudFNoYWRlclNvdXJjZSgpIHsKICAgICAgICByZXR1cm4gInZhcnlpbmcgbWVkaXVtcCB2ZWMyIHZUZXg7XG51bmlmb3JtIGxvd3AgdmVjNCBjb2xvcjtcbnVuaWZvcm0gbWVkaXVtcCB2ZWMyIHBpeGVsU2l6ZTtcbnVuaWZvcm0gbWVkaXVtcCBmbG9hdCBvdXRsaW5lVGhpY2tuZXNzO1xudm9pZCBtYWluKHZvaWQpIHtcblx0bWVkaXVtcCB2ZWMyIGRpZmYgPSB2VGV4IC0gdmVjMigwLjUsIDAuNSk7XG5cdG1lZGl1bXAgdmVjMiBkaWZmU3EgPSBkaWZmICogZGlmZjtcblx0bWVkaXVtcCBmbG9hdCBkaXN0U3EgPSBkaWZmU3EueCArIGRpZmZTcS55O1xuXHRtZWRpdW1wIHZlYzIgbm9ybSA9IG5vcm1hbGl6ZShkaWZmKTtcblx0bWVkaXVtcCB2ZWMyIGhhbGZOb3JtID0gbm9ybSAqIDAuNTtcblx0bWVkaXVtcCBmbG9hdCBpbm5lckYgPSBzdGVwKGRpc3RTcSwgMC4yNSk7XG5cdG1lZGl1bXAgdmVjMiBpbm5lckVkZ2UgPSBoYWxmTm9ybSAtIHBpeGVsU2l6ZSAqIG5vcm0gKiBvdXRsaW5lVGhpY2tuZXNzO1xuXHRtZWRpdW1wIHZlYzIgaW5uZXJFZGdlU3EgPSBpbm5lckVkZ2UgKiBpbm5lckVkZ2U7XG5cdG1lZGl1bXAgZmxvYXQgb3V0ZXJGID0gc3RlcChpbm5lckVkZ2VTcS54ICsgaW5uZXJFZGdlU3EueSwgZGlzdFNxKTtcblx0Z2xfRnJhZ0NvbG9yID0gY29sb3IgKiBpbm5lckYgKiBvdXRlckY7XG59IgogICAgfQogICAgc3RhdGljIEdldFNtb290aEVsbGlwc2VGaWxsRnJhZ21lbnRTaGFkZXJTb3VyY2UoKSB7CiAgICAgICAgcmV0dXJuICJ2YXJ5aW5nIG1lZGl1bXAgdmVjMiB2VGV4O1xudW5pZm9ybSBsb3dwIHZlYzQgY29sb3I7XG51bmlmb3JtIG1lZGl1bXAgdmVjMiBwaXhlbFNpemU7XG52b2lkIG1haW4odm9pZCkge1xuXHRtZWRpdW1wIHZlYzIgZGlmZiA9IHZUZXggLSB2ZWMyKDAuNSwgMC41KTtcblx0bWVkaXVtcCB2ZWMyIGRpZmZTcSA9IGRpZmYgKiBkaWZmO1xuXHRtZWRpdW1wIHZlYzIgbm9ybSA9IG5vcm1hbGl6ZShkaWZmKTtcblx0bWVkaXVtcCB2ZWMyIGhhbGZOb3JtID0gbm9ybSAqIDAuNTtcblx0bWVkaXVtcCB2ZWMyIGhhbGZOb3JtU3EgPSBoYWxmTm9ybSAqIGhhbGZOb3JtO1xuXHRtZWRpdW1wIHZlYzIgaW5uZXJFZGdlID0gaGFsZk5vcm0gLSBwaXhlbFNpemUgKiBub3JtO1xuXHRtZWRpdW1wIHZlYzIgaW5uZXJFZGdlU3EgPSBpbm5lckVkZ2UgKiBpbm5lckVkZ2U7XG5cdG1lZGl1bXAgZmxvYXQgZiA9IHNtb290aHN0ZXAoaGFsZk5vcm1TcS54ICsgaGFsZk5vcm1TcS55LCBpbm5lckVkZ2VTcS54ICsgaW5uZXJFZGdlU3EueSwgZGlmZlNxLnggKyBkaWZmU3EueSk7XG5cdGdsX0ZyYWdDb2xvciA9IGNvbG9yICogZjtcbn0iCiAgICB9CiAgICBzdGF0aWMgR2V0U21vb3RoRWxsaXBzZU91dGxpbmVGcmFnbWVudFNoYWRlclNvdXJjZSgpIHsKICAgICAgICByZXR1cm4gInZhcnlpbmcgbWVkaXVtcCB2ZWMyIHZUZXg7XG51bmlmb3JtIGxvd3AgdmVjNCBjb2xvcjtcbnVuaWZvcm0gbWVkaXVtcCB2ZWMyIHBpeGVsU2l6ZTtcbnVuaWZvcm0gbWVkaXVtcCBmbG9hdCBvdXRsaW5lVGhpY2tuZXNzO1xudm9pZCBtYWluKHZvaWQpIHtcblx0bWVkaXVtcCB2ZWMyIGRpZmYgPSB2VGV4IC0gdmVjMigwLjUsIDAuNSk7XG5cdG1lZGl1bXAgdmVjMiBkaWZmU3EgPSBkaWZmICogZGlmZjtcblx0bWVkaXVtcCBmbG9hdCBkaXN0U3EgPSBkaWZmU3EueCArIGRpZmZTcS55O1xuXHRtZWRpdW1wIHZlYzIgbm9ybSA9IG5vcm1hbGl6ZShkaWZmKTtcblx0bWVkaXVtcCB2ZWMyIGhhbGZOb3JtID0gbm9ybSAqIDAuNTtcblx0bWVkaXVtcCB2ZWMyIGhhbGZOb3JtU3EgPSBoYWxmTm9ybSAqIGhhbGZOb3JtO1xuXHRtZWRpdW1wIHZlYzIgcHhOb3JtID0gcGl4ZWxTaXplICogbm9ybTtcblx0bWVkaXVtcCB2ZWMyIGlubmVyRWRnZTEgPSBoYWxmTm9ybSAtIHB4Tm9ybTtcblx0bWVkaXVtcCB2ZWMyIGlubmVyRWRnZTFTcSA9IGlubmVyRWRnZTEgKiBpbm5lckVkZ2UxO1xuXHRtZWRpdW1wIGZsb2F0IGlubmVyRiA9IHNtb290aHN0ZXAoaGFsZk5vcm1TcS54ICsgaGFsZk5vcm1TcS55LCBpbm5lckVkZ2UxU3EueCArIGlubmVyRWRnZTFTcS55LCBkaXN0U3EpO1xuXHRtZWRpdW1wIHZlYzIgaW5uZXJFZGdlMiA9IGhhbGZOb3JtIC0gcHhOb3JtICogb3V0bGluZVRoaWNrbmVzcztcblx0bWVkaXVtcCB2ZWMyIGlubmVyRWRnZTJTcSA9IGlubmVyRWRnZTIgKiBpbm5lckVkZ2UyO1xuXHRtZWRpdW1wIHZlYzIgaW5uZXJFZGdlMyA9IGhhbGZOb3JtIC0gcHhOb3JtICogKG91dGxpbmVUaGlja25lc3MgKyAxLjApO1xuXHRtZWRpdW1wIHZlYzIgaW5uZXJFZGdlM1NxID0gaW5uZXJFZGdlMyAqIGlubmVyRWRnZTM7XG5cdG1lZGl1bXAgZmxvYXQgb3V0ZXJGID0gc21vb3Roc3RlcChpbm5lckVkZ2UzU3EueCArIGlubmVyRWRnZTNTcS55LCBpbm5lckVkZ2UyU3EueCArIGlubmVyRWRnZTJTcS55LCBkaXN0U3EpO1xuXHRnbF9GcmFnQ29sb3IgPSBjb2xvciAqIGlubmVyRiAqIG91dGVyRjtcbn0iCiAgICB9Cn07CiJ1c2Ugc3RyaWN0IjsKY29uc3QgQzMkanNjb21wJDQ1ID0gc2VsZi5DMywKICAgIG1hdDQkanNjb21wJDUgPSBzZWxmLmdsTWF0cml4Lm1hdDQsCiAgICBUWVBFX1NJWkVTID0gbmV3IE1hcChbCiAgICAgICAgWyJmbG9hdCIsIDFdLAogICAgICAgIFsicGVyY2VudCIsIDFdLAogICAgICAgIFsic2FtcGxlciIsIDFdLAogICAgICAgIFsidmVjMiIsIDJdLAogICAgICAgIFsidmVjMyIsIDNdLAogICAgICAgIFsiY29sb3IiLCAzXSwKICAgICAgICBbInZlYzQiLCA0XSwKICAgICAgICBbIm1hdDQiLCAxNl0KICAgIF0pOwpDMyRqc2NvbXAkNDUuR2Z4LldlYkdMU2hhZGVyVW5pZm9ybSA9IGNsYXNzIHsKICAgIGNvbnN0cnVjdG9yKGEsIGIsIGQpIHsKICAgICAgICBpZiAoIVRZUEVfU0laRVMuaGFzKGQpKSB0aHJvdyBFcnJvcigiaW52YWxpZCB1bmlmb3JtIHR5cGUiKTsKICAgICAgICB0aGlzLl9vd25lciA9IGE7CiAgICAgICAgdGhpcy5fZ2wgPSB0aGlzLl9vd25lci5HZXRXZWJHTENvbnRleHQoKTsKICAgICAgICB0aGlzLl9uYW1lID0gYjsKICAgICAgICB0aGlzLl90eXBlID0gZDsKICAgICAgICB0aGlzLl9pc0NvbG9yVHlwZSA9ICJjb2xvciIgPT09IHRoaXMuX3R5cGU7CiAgICAgICAgdGhpcy5fbG9jYXRpb24gPSB0aGlzLl9nbC5nZXRVbmlmb3JtTG9jYXRpb24odGhpcy5fb3duZXIuR2V0U2hhZGVyUHJvZ3JhbSgpLCBiKTsKICAgICAgICB0aGlzLl9pc1VzZWQgPSAhIXRoaXMuX2xvY2F0aW9uOwogICAgICAgIGEgPSBUWVBFX1NJWkVTLmdldChkKTsKICAgICAgICB0aGlzLl9sYXN0VmFsdWUgPSBuZXcgRmxvYXQzMkFycmF5KGEpOwogICAgICAgIHRoaXMuX2xhc3RCYXRjaFZhbHVlID0gbmV3IEZsb2F0MzJBcnJheShhKQogICAgfQogICAgUmVsZWFzZSgpIHsKICAgICAgICB0aGlzLl9sb2NhdGlvbiA9IHRoaXMuX2dsID0gdGhpcy5fb3duZXIgPSBudWxsCiAgICB9CiAgICBJc1VzZWQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2lzVXNlZAogICAgfQogICAgR2V0VHlwZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdHlwZQogICAgfQogICAgSXNDb2xvclR5cGUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2lzQ29sb3JUeXBlCiAgICB9CiAgICBJbml0MWYoYSkgewogICAgICAgIHRoaXMuSXNVc2VkKCkgJiYKICAgICAgICAgICAgKHRoaXMuX2xhc3RWYWx1ZVswXSA9IGEsIHRoaXMuX2xhc3RCYXRjaFZhbHVlLnNldCh0aGlzLl9sYXN0VmFsdWUpLCB0aGlzLl9nbC51bmlmb3JtMWYodGhpcy5fbG9jYXRpb24sIGEpKQogICAgfQogICAgSW5pdDFpKGEpIHsKICAgICAgICB0aGlzLklzVXNlZCgpICYmICh0aGlzLl9sYXN0VmFsdWVbMF0gPSBhLCB0aGlzLl9sYXN0QmF0Y2hWYWx1ZS5zZXQodGhpcy5fbGFzdFZhbHVlKSwgdGhpcy5fZ2wudW5pZm9ybTFpKHRoaXMuX2xvY2F0aW9uLCBhKSkKICAgIH0KICAgIEluaXQyZihhLCBiKSB7CiAgICAgICAgdGhpcy5Jc1VzZWQoKSAmJiAodGhpcy5fbGFzdFZhbHVlWzBdID0gYSwgdGhpcy5fbGFzdFZhbHVlWzFdID0gYiwgdGhpcy5fbGFzdEJhdGNoVmFsdWUuc2V0KHRoaXMuX2xhc3RWYWx1ZSksIHRoaXMuX2dsLnVuaWZvcm0yZih0aGlzLl9sb2NhdGlvbiwgYSwgYikpCiAgICB9CiAgICBJbml0M2YoYSwgYiwgZCkgewogICAgICAgIHRoaXMuSXNVc2VkKCkgJiYgKHRoaXMuX2xhc3RWYWx1ZVswXSA9IGEsIHRoaXMuX2xhc3RWYWx1ZVsxXSA9IGIsIHRoaXMuX2xhc3RWYWx1ZVsyXSA9IGQsIHRoaXMuX2xhc3RCYXRjaFZhbHVlLnNldCh0aGlzLl9sYXN0VmFsdWUpLAogICAgICAgICAgICB0aGlzLl9nbC51bmlmb3JtM2YodGhpcy5fbG9jYXRpb24sIGEsIGIsIGQpKQogICAgfQogICAgSW5pdDRmKGEsIGIsIGQsIGMpIHsKICAgICAgICB0aGlzLklzVXNlZCgpICYmICh0aGlzLl9sYXN0VmFsdWVbMF0gPSBhLCB0aGlzLl9sYXN0VmFsdWVbMV0gPSBiLCB0aGlzLl9sYXN0VmFsdWVbMl0gPSBkLCB0aGlzLl9sYXN0VmFsdWVbM10gPSBjLCB0aGlzLl9sYXN0QmF0Y2hWYWx1ZS5zZXQodGhpcy5fbGFzdFZhbHVlKSwgdGhpcy5fZ2wudW5pZm9ybTRmKHRoaXMuX2xvY2F0aW9uLCBhLCBiLCBkLCBjKSkKICAgIH0KICAgIFVwZGF0ZTFmKGEpIHsKICAgICAgICBhID0gTWF0aC5mcm91bmQoYSk7CiAgICAgICAgY29uc3QgYiA9IHRoaXMuX2xhc3RWYWx1ZTsKICAgICAgICBiWzBdICE9PSBhICYmIChiWzBdID0gYSwgdGhpcy5fZ2wudW5pZm9ybTFmKHRoaXMuX2xvY2F0aW9uLCBhKSkKICAgIH0KICAgIFVwZGF0ZTFpKGEpIHsKICAgICAgICBjb25zdCBiID0gdGhpcy5fbGFzdFZhbHVlOwogICAgICAgIGJbMF0gIT09IGEgJiYgKGJbMF0gPSBhLCB0aGlzLl9nbC51bmlmb3JtMWkodGhpcy5fbG9jYXRpb24sIGEpKQogICAgfQogICAgVXBkYXRlMmYoYSwgYikgewogICAgICAgIGEgPSBNYXRoLmZyb3VuZChhKTsKICAgICAgICBiID0gTWF0aC5mcm91bmQoYik7CiAgICAgICAgY29uc3QgZCA9CiAgICAgICAgICAgIHRoaXMuX2xhc3RWYWx1ZTsKICAgICAgICBpZiAoZFswXSAhPT0gYSB8fCBkWzFdICE9PSBiKSBkWzBdID0gYSwgZFsxXSA9IGIsIHRoaXMuX2dsLnVuaWZvcm0yZih0aGlzLl9sb2NhdGlvbiwgYSwgYikKICAgIH0KICAgIFVwZGF0ZTNmKGEsIGIsIGQpIHsKICAgICAgICBhID0gTWF0aC5mcm91bmQoYSk7CiAgICAgICAgYiA9IE1hdGguZnJvdW5kKGIpOwogICAgICAgIGQgPSBNYXRoLmZyb3VuZChkKTsKICAgICAgICBjb25zdCBjID0gdGhpcy5fbGFzdFZhbHVlOwogICAgICAgIGlmIChjWzBdICE9PSBhIHx8IGNbMV0gIT09IGIgfHwgY1syXSAhPT0gZCkgY1swXSA9IGEsIGNbMV0gPSBiLCBjWzJdID0gZCwgdGhpcy5fZ2wudW5pZm9ybTNmKHRoaXMuX2xvY2F0aW9uLCBhLCBiLCBkKQogICAgfQogICAgVXBkYXRlNGYoYSwgYiwgZCwgYykgewogICAgICAgIGEgPSBNYXRoLmZyb3VuZChhKTsKICAgICAgICBiID0gTWF0aC5mcm91bmQoYik7CiAgICAgICAgZCA9IE1hdGguZnJvdW5kKGQpOwogICAgICAgIGMgPSBNYXRoLmZyb3VuZChjKTsKICAgICAgICBjb25zdCBlID0gdGhpcy5fbGFzdFZhbHVlOwogICAgICAgIGlmIChlWzBdICE9PSBhIHx8IGVbMV0gIT09IGIgfHwgZVsyXSAhPT0gZCB8fCBlWzNdICE9PSBjKSBlWzBdID0gYSwgZVsxXSA9IGIsIGVbMl0gPSBkLCBlWzNdID0gYywgdGhpcy5fZ2wudW5pZm9ybTRmKHRoaXMuX2xvY2F0aW9uLCBhLCBiLCBkLCBjKQogICAgfQogICAgVXBkYXRlTWF0cml4NGZ2KGEpIHsKICAgICAgICBjb25zdCBiID0KICAgICAgICAgICAgdGhpcy5fbGFzdFZhbHVlOwogICAgICAgIG1hdDQkanNjb21wJDUuZXhhY3RFcXVhbHMoYiwgYSkgfHwgKEMzJGpzY29tcCQ0NS50eXBlZEFycmF5U2V0MTYoYiwgYSwgMCksIHRoaXMuX2dsLnVuaWZvcm1NYXRyaXg0ZnYodGhpcy5fbG9jYXRpb24sICExLCBhKSkKICAgIH0KICAgIElzU2V0VG9DdXN0b21JbkJhdGNoKGEpIHsKICAgICAgICBjb25zdCBiID0gdGhpcy5fbGFzdEJhdGNoVmFsdWU7CiAgICAgICAgcmV0dXJuIHRoaXMuSXNDb2xvclR5cGUoKSA/IGJbMF0gPT09IE1hdGguZnJvdW5kKGEuZ2V0UigpKSAmJiBiWzFdID09PSBNYXRoLmZyb3VuZChhLmdldEcoKSkgJiYgYlsyXSA9PT0gTWF0aC5mcm91bmQoYS5nZXRCKCkpIDogYlswXSA9PT0gTWF0aC5mcm91bmQoYSkKICAgIH0KICAgIFNldEJhdGNoVmFsdWVDdXN0b20oYSkgewogICAgICAgIGNvbnN0IGIgPSB0aGlzLl9sYXN0QmF0Y2hWYWx1ZTsKICAgICAgICB0aGlzLklzQ29sb3JUeXBlKCkgPyAoYlswXSA9IGEuZ2V0UigpLCBiWzFdID0gYS5nZXRHKCksIGJbMl0gPSBhLmdldEIoKSkgOiBiWzBdID0gYQogICAgfQogICAgSXNTZXRUbzFJbkJhdGNoKGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5fbGFzdEJhdGNoVmFsdWVbMF0gPT09IE1hdGguZnJvdW5kKGEpCiAgICB9CiAgICBJc1NldFRvMkluQmF0Y2goYSwKICAgICAgICBiKSB7CiAgICAgICAgY29uc3QgZCA9IHRoaXMuX2xhc3RCYXRjaFZhbHVlOwogICAgICAgIHJldHVybiBkWzBdID09PSBNYXRoLmZyb3VuZChhKSAmJiBkWzFdID09PSBNYXRoLmZyb3VuZChiKQogICAgfQogICAgU2V0QmF0Y2gxKGEpIHsKICAgICAgICB0aGlzLl9sYXN0QmF0Y2hWYWx1ZVswXSA9IGEKICAgIH0KICAgIFNldEJhdGNoMihhLCBiKSB7CiAgICAgICAgY29uc3QgZCA9IHRoaXMuX2xhc3RCYXRjaFZhbHVlOwogICAgICAgIGRbMF0gPSBhOwogICAgICAgIGRbMV0gPSBiCiAgICB9Cn07CiJ1c2Ugc3RyaWN0IjsKY29uc3QgQzMkanNjb21wJDQ2ID0gc2VsZi5DMywKICAgIGdsTWF0cml4JGpzY29tcCQ1ID0gc2VsZi5nbE1hdHJpeCwKICAgIHZlYzQkanNjb21wJDMgPSBnbE1hdHJpeCRqc2NvbXAkNS52ZWM0LAogICAgbWF0NCRqc2NvbXAkNiA9IGdsTWF0cml4JGpzY29tcCQ1Lm1hdDQ7CkMzJGpzY29tcCQ0Ni5HZnguQmF0Y2hTdGF0ZSA9IGNsYXNzIHsKICAgIGNvbnN0cnVjdG9yKGEpIHsKICAgICAgICB0aGlzLnJlbmRlcmVyID0gYTsKICAgICAgICB0aGlzLmN1cnJlbnRNViA9IG1hdDQkanNjb21wJDYuY3JlYXRlKCk7CiAgICAgICAgdGhpcy5jdXJyZW50TWF0UCA9IG1hdDQkanNjb21wJDYuY3JlYXRlKCk7CiAgICAgICAgdGhpcy5jdXJyZW50RnJhbWVidWZmZXJOb0RlcHRoID0gdGhpcy5jdXJyZW50RnJhbWVidWZmZXIgPSBudWxsOwogICAgICAgIHRoaXMuaXNEZXB0aFNhbXBsaW5nRW5hYmxlZCA9ICExOwogICAgICAgIHRoaXMuY3VycmVudENvbG9yID0gdmVjNCRqc2NvbXAkMy5mcm9tVmFsdWVzKDEsIDEsIDEsIDEpOwogICAgICAgIHRoaXMuY3VycmVudFNoYWRlciA9IG51bGw7CiAgICAgICAgdGhpcy5wb2ludFRleENvb3JkcyA9IG5ldyBDMyRqc2NvbXAkNDYuUmVjdDsKICAgICAgICB0aGlzLmNsZWFyQ29sb3IgPSBDMyRqc2NvbXAkNDYuTmV3KEMzJGpzY29tcCQ0Ni5Db2xvciwgMCwgMCwgMCwgMCkKICAgIH0KfTsKQzMkanNjb21wJDQ2LkdmeC5XZWJHTEJhdGNoSm9iID0gY2xhc3MgewogICAgY29uc3RydWN0b3IoYSkgewogICAgICAgIGNvbnN0IGIgPSBuZXcgQXJyYXlCdWZmZXIoOTYpOwogICAgICAgIHRoaXMuX3R5cGUgPSAwOwogICAgICAgIHRoaXMuX2JhdGNoU3RhdGUgPSBhOwogICAgICAgIHRoaXMuX2dsID0gYS5yZW5kZXJlci5HZXRDb250ZXh0KCk7CiAgICAgICAgdGhpcy5faW5kZXhDb3VudCA9IHRoaXMuX3N0YXJ0SW5kZXggPSAwOwogICAgICAgIHRoaXMuX3RleFBhcmFtID0gbnVsbDsKICAgICAgICB0aGlzLl9tYXQ0cGFyYW0gPSBuZXcgRmxvYXQzMkFycmF5KGIsIDAsIDE2KTsKICAgICAgICB0aGlzLl9jb2xvclBhcmFtID0gbmV3IEZsb2F0MzJBcnJheShiLCA2NCwgNCk7CiAgICAgICAgdGhpcy5fc3JjT3JpZ2luUmVjdCA9IG5ldyBGbG9hdDMyQXJyYXkoYiwgODAsIDQpOwogICAgICAgIHRoaXMuX3NoYWRlclBhcmFtcyA9IFtdCiAgICB9CiAgICBJbml0UXVhZChhLCBiKSB7CiAgICAgICAgdGhpcy5fdHlwZSA9IDE7CiAgICAgICAgdGhpcy5fc3RhcnRJbmRleCA9IGE7CiAgICAgICAgdGhpcy5faW5kZXhDb3VudCA9IGIKICAgIH0KICAgIERvUXVhZCgpIHsKICAgICAgICBjb25zdCBhID0gdGhpcy5fZ2w7CiAgICAgICAgYS5kcmF3RWxlbWVudHMoYS5UUklBTkdMRVMsIHRoaXMuX2luZGV4Q291bnQsIGEuVU5TSUdORURfU0hPUlQsCiAgICAgICAgICAgIHRoaXMuX3N0YXJ0SW5kZXgpCiAgICB9CiAgICBJbml0U2V0VGV4dHVyZShhKSB7CiAgICAgICAgdGhpcy5fdHlwZSA9IDI7CiAgICAgICAgdGhpcy5fdGV4UGFyYW0gPSBhCiAgICB9CiAgICBEb1NldFRleHR1cmUoKSB7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuX2dsLAogICAgICAgICAgICBiID0gdGhpcy5fdGV4UGFyYW07CiAgICAgICAgYS5iaW5kVGV4dHVyZShhLlRFWFRVUkVfMkQsIGIgPyBiLl9HZXRUZXh0dXJlKCkgOiBudWxsKQogICAgfQogICAgSW5pdFNldENvbG9yKGEpIHsKICAgICAgICB0aGlzLl90eXBlID0gMzsKICAgICAgICBhLndyaXRlVG9UeXBlZEFycmF5KHRoaXMuX2NvbG9yUGFyYW0sIDApCiAgICB9CiAgICBEb1NldENvbG9yKCkgewogICAgICAgIGNvbnN0IGEgPSB0aGlzLl9jb2xvclBhcmFtLAogICAgICAgICAgICBiID0gdGhpcy5fYmF0Y2hTdGF0ZTsKICAgICAgICB2ZWM0JGpzY29tcCQzLmNvcHkoYi5jdXJyZW50Q29sb3IsIGEpOwogICAgICAgIGIuY3VycmVudFNoYWRlci5VcGRhdGVDb2xvcihhKQogICAgfQogICAgSW5pdFNldEdyYWRpZW50Q29sb3IoYSkgewogICAgICAgIHRoaXMuX3R5cGUgPSAyMTsKICAgICAgICBhLndyaXRlVG9UeXBlZEFycmF5KHRoaXMuX2NvbG9yUGFyYW0sIDApCiAgICB9CiAgICBEb1NldEdyYWRpZW50Q29sb3IoKSB7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuX2NvbG9yUGFyYW0sCiAgICAgICAgICAgIGIgPSB0aGlzLl9iYXRjaFN0YXRlLmN1cnJlbnRTaGFkZXI7CiAgICAgICAgYi5fdUNvbG9yMi5Jc1VzZWQoKSAmJiBiLl91Q29sb3IyLlVwZGF0ZTRmKGFbMF0sIGFbMV0sIGFbMl0sIGFbM10pCiAgICB9CiAgICBJbml0U2V0QmxlbmQoYSwgYikgewogICAgICAgIHRoaXMuX3R5cGUgPSA0OwogICAgICAgIHRoaXMuX3N0YXJ0SW5kZXggPSBhOwogICAgICAgIHRoaXMuX2luZGV4Q291bnQgPSBiCiAgICB9CiAgICBEb1NldEJsZW5kKCkgewogICAgICAgIHRoaXMuX2dsLmJsZW5kRnVuYyh0aGlzLl9zdGFydEluZGV4LCB0aGlzLl9pbmRleENvdW50KQogICAgfQogICAgSW5pdFNldFZpZXdwb3J0KGEsIGIsIGQsIGMpIHsKICAgICAgICB0aGlzLl90eXBlID0gNTsKICAgICAgICBjb25zdCBlID0gdGhpcy5fY29sb3JQYXJhbTsKICAgICAgICBlWzBdID0gYTsKICAgICAgICBlWzFdID0gYjsKICAgICAgICBlWzJdID0gZDsKICAgICAgICBlWzNdID0gYwogICAgfQogICAgRG9TZXRWaWV3cG9ydCgpIHsKICAgICAgICBjb25zdCBhID0gdGhpcy5fY29sb3JQYXJhbTsKICAgICAgICB0aGlzLl9nbC52aWV3cG9ydChhWzBdLCBhWzFdLCBhWzJdLCBhWzNdKQogICAgfQogICAgSW5pdFNldFByb2plY3Rpb24oYSkgewogICAgICAgIHRoaXMuX3R5cGUgPSA2OwogICAgICAgIG1hdDQkanNjb21wJDYuY29weSh0aGlzLl9tYXQ0cGFyYW0sIGEpCiAgICB9CiAgICBEb1NldFByb2plY3Rpb24oKSB7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuX2JhdGNoU3RhdGUsCiAgICAgICAgICAgIGIgPSBhLnJlbmRlcmVyLl9hbGxTaGFkZXJQcm9ncmFtcywKICAgICAgICAgICAgZCA9IGEuY3VycmVudFNoYWRlciwKICAgICAgICAgICAgYyA9IHRoaXMuX21hdDRwYXJhbTsKICAgICAgICBmb3IgKGxldCBlID0gMCwgZyA9IGIubGVuZ3RoOyBlIDwgZzsgKytlKSB7CiAgICAgICAgICAgIGNvbnN0IGsgPSBiW2VdOwogICAgICAgICAgICBrID09PSBkID8gay5VcGRhdGVNYXRQKGMsICEwKSA6IGsuU2V0TWF0UFN0YWxlKCkKICAgICAgICB9CiAgICAgICAgbWF0NCRqc2NvbXAkNi5jb3B5KGEuY3VycmVudE1hdFAsIGMpCiAgICB9CiAgICBJbml0U2V0TW9kZWxWaWV3KGEpIHsKICAgICAgICB0aGlzLl90eXBlID0gNzsKICAgICAgICBtYXQ0JGpzY29tcCQ2LmNvcHkodGhpcy5fbWF0NHBhcmFtLCBhKQogICAgfQogICAgRG9TZXRNb2RlbFZpZXcoKSB7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuX2JhdGNoU3RhdGUsCiAgICAgICAgICAgIGIgPSBhLnJlbmRlcmVyLl9hbGxTaGFkZXJQcm9ncmFtcywKICAgICAgICAgICAgZCA9IGEuY3VycmVudFNoYWRlciwKICAgICAgICAgICAgYyA9IHRoaXMuX21hdDRwYXJhbTsKICAgICAgICBmb3IgKGxldCBlID0gMCwgZyA9IGIubGVuZ3RoOyBlIDwgZzsgKytlKSB7CiAgICAgICAgICAgIGNvbnN0IGsgPSBiW2VdOwogICAgICAgICAgICBrID09PSBkID8gay5VcGRhdGVNYXRNVihjLCAhMCkgOiBrLlNldE1hdE1WU3RhbGUoKQogICAgICAgIH0KICAgICAgICBtYXQ0JGpzY29tcCQ2LmNvcHkoYS5jdXJyZW50TVYsIGMpCiAgICB9CiAgICBJbml0U2V0UmVuZGVyVGFyZ2V0KGEpIHsKICAgICAgICB0aGlzLl90eXBlID0gODsKICAgICAgICB0aGlzLl90ZXhQYXJhbSA9CiAgICAgICAgICAgIGEKICAgIH0KICAgIERvU2V0UmVuZGVyVGFyZ2V0KCkgewogICAgICAgIGNvbnN0IGEgPSB0aGlzLl9nbCwKICAgICAgICAgICAgYiA9IHRoaXMuX3RleFBhcmFtLAogICAgICAgICAgICBkID0gdGhpcy5fYmF0Y2hTdGF0ZTsKICAgICAgICBiID8gKGQuY3VycmVudEZyYW1lYnVmZmVyID0gYi5fR2V0RnJhbWVidWZmZXIoKSwgZC5jdXJyZW50RnJhbWVidWZmZXJOb0RlcHRoID0gYi5fR2V0RnJhbWVidWZmZXJOb0RlcHRoKCksIGQuaXNEZXB0aFNhbXBsaW5nRW5hYmxlZCAmJiBkLmN1cnJlbnRGcmFtZWJ1ZmZlck5vRGVwdGggPyBhLmJpbmRGcmFtZWJ1ZmZlcihhLkZSQU1FQlVGRkVSLCBkLmN1cnJlbnRGcmFtZWJ1ZmZlck5vRGVwdGgpIDogYS5iaW5kRnJhbWVidWZmZXIoYS5GUkFNRUJVRkZFUiwgZC5jdXJyZW50RnJhbWVidWZmZXIpKSA6IChkLmN1cnJlbnRGcmFtZWJ1ZmZlciA9IG51bGwsIGQuY3VycmVudEZyYW1lYnVmZmVyTm9EZXB0aCA9IG51bGwsIGEuYmluZEZyYW1lYnVmZmVyKGEuRlJBTUVCVUZGRVIsIG51bGwpKQogICAgfQogICAgSW5pdENsZWFyU3VyZmFjZShhKSB7CiAgICAgICAgdGhpcy5fdHlwZSA9IDk7CiAgICAgICAgYS53cml0ZVRvVHlwZWRBcnJheSh0aGlzLl9tYXQ0cGFyYW0sCiAgICAgICAgICAgIDApCiAgICB9CiAgICBJbml0Q2xlYXJTdXJmYWNlMihhLCBiLCBkLCBjKSB7CiAgICAgICAgdGhpcy5fdHlwZSA9IDk7CiAgICAgICAgY29uc3QgZSA9IHRoaXMuX21hdDRwYXJhbTsKICAgICAgICBlWzBdID0gYTsKICAgICAgICBlWzFdID0gYjsKICAgICAgICBlWzJdID0gZDsKICAgICAgICBlWzNdID0gYwogICAgfQogICAgRG9DbGVhclN1cmZhY2UoKSB7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuX2dsOwogICAgICAgIHZhciBiID0gdGhpcy5fbWF0NHBhcmFtOwogICAgICAgIGNvbnN0IGQgPSB0aGlzLl9iYXRjaFN0YXRlLmNsZWFyQ29sb3IsCiAgICAgICAgICAgIGMgPSBiWzBdLAogICAgICAgICAgICBlID0gYlsxXSwKICAgICAgICAgICAgZyA9IGJbMl07CiAgICAgICAgYiA9IGJbM107CiAgICAgICAgZC5lcXVhbHNSZ2JhKGMsIGUsIGcsIGIpIHx8IChhLmNsZWFyQ29sb3IoYywgZSwgZywgYiksIGQuc2V0UmdiYShjLCBlLCBnLCBiKSk7CiAgICAgICAgYS5jbGVhcihhLkNPTE9SX0JVRkZFUl9CSVQpCiAgICB9CiAgICBJbml0U2V0UG9pbnRUZXhDb29yZHMoYSkgewogICAgICAgIHRoaXMuX3R5cGUgPSAxNTsKICAgICAgICBhLndyaXRlVG9UeXBlZEFycmF5KHRoaXMuX21hdDRwYXJhbSwgMCkKICAgIH0KICAgIERvU2V0UG9pbnRUZXh0dXJlQ29vcmRzKCkgewogICAgICAgIGNvbnN0IGEgPSB0aGlzLl9tYXQ0cGFyYW07CiAgICAgICAgdGhpcy5fYmF0Y2hTdGF0ZS5wb2ludFRleENvb3Jkcy5zZXQoYVswXSwgYVsxXSwgYVsyXSwgYVszXSkKICAgIH0KICAgIEluaXRQb2ludHMoYSwKICAgICAgICBiKSB7CiAgICAgICAgdGhpcy5fdHlwZSA9IDEwOwogICAgICAgIHRoaXMuX3N0YXJ0SW5kZXggPSBhOwogICAgICAgIHRoaXMuX2luZGV4Q291bnQgPSAxOwogICAgICAgIHRoaXMuX21hdDRwYXJhbVswXSA9IGIKICAgIH0KICAgIERvUG9pbnRzKCkgewogICAgICAgIGNvbnN0IGEgPSB0aGlzLl9nbCwKICAgICAgICAgICAgYiA9IHRoaXMuX2JhdGNoU3RhdGUsCiAgICAgICAgICAgIGQgPSBiLnJlbmRlcmVyLl9zcFBvaW50czsKICAgICAgICBhLnVzZVByb2dyYW0oZC5fc2hhZGVyUHJvZ3JhbSk7CiAgICAgICAgZC5VcGRhdGVNYXRQKGIuY3VycmVudE1hdFAsICExKTsKICAgICAgICBkLlVwZGF0ZU1hdE1WKGIuY3VycmVudE1WLCAhMSk7CiAgICAgICAgdmFyIGMgPSBiLnBvaW50VGV4Q29vcmRzOwogICAgICAgIGQuX3VQb2ludFRleFN0YXJ0LklzVXNlZCgpICYmIGQuX3VQb2ludFRleFN0YXJ0LlVwZGF0ZTJmKGMuZ2V0TGVmdCgpLCBjLmdldFRvcCgpKTsKICAgICAgICBkLl91UG9pbnRUZXhFbmQuSXNVc2VkKCkgJiYgZC5fdVBvaW50VGV4RW5kLlVwZGF0ZTJmKGMuZ2V0UmlnaHQoKSwgYy5nZXRCb3R0b20oKSk7CiAgICAgICAgYyA9IHRoaXMuX21hdDRwYXJhbVswXTsKICAgICAgICBkLl91WkVsZXZhdGlvbi5Jc1VzZWQoKSAmJiBkLl91WkVsZXZhdGlvbi5VcGRhdGUxZihjKTsKICAgICAgICBkLl91Q29sb3IuSXNVc2VkKCkgJiYKICAgICAgICAgICAgKGMgPSBiLmN1cnJlbnRDb2xvciwgZC5fdUNvbG9yLlVwZGF0ZTRmKGNbMF0sIGNbMV0sIGNbMl0sIGNbM10pKTsKICAgICAgICBhLmRyYXdBcnJheXMoYS5QT0lOVFMsIHRoaXMuX3N0YXJ0SW5kZXggLyA0LCB0aGlzLl9pbmRleENvdW50KTsKICAgICAgICBhLnVzZVByb2dyYW0oYi5jdXJyZW50U2hhZGVyLl9zaGFkZXJQcm9ncmFtKQogICAgfQogICAgSW5pdFNldFByb2dyYW0oYSkgewogICAgICAgIHRoaXMuX3R5cGUgPSAxMTsKICAgICAgICB0aGlzLl90ZXhQYXJhbSA9IGEKICAgIH0KICAgIERvU2V0UHJvZ3JhbSgpIHsKICAgICAgICB2YXIgYSA9IHRoaXMuX2dsOwogICAgICAgIGNvbnN0IGIgPSB0aGlzLl9iYXRjaFN0YXRlLAogICAgICAgICAgICBkID0gdGhpcy5fdGV4UGFyYW07CiAgICAgICAgYi5jdXJyZW50U2hhZGVyID0gZDsKICAgICAgICBhLnVzZVByb2dyYW0oZC5fc2hhZGVyUHJvZ3JhbSk7CiAgICAgICAgZC5VcGRhdGVNYXRQKGIuY3VycmVudE1hdFAsICExKTsKICAgICAgICBkLlVwZGF0ZU1hdE1WKGIuY3VycmVudE1WLCAhMSk7CiAgICAgICAgZC5fdUNvbG9yLklzVXNlZCgpICYmIChhID0gYi5jdXJyZW50Q29sb3IsIGQuX3VDb2xvci5VcGRhdGU0ZihhWzBdLCBhWzFdLCBhWzJdLCBhWzNdKSkKICAgIH0KICAgIEluaXRTZXRQcm9ncmFtUGFyYW1ldGVycygpIHsKICAgICAgICB0aGlzLl90eXBlID0KICAgICAgICAgICAgMTIKICAgIH0KICAgIERvU2V0UHJvZ3JhbVBhcmFtZXRlcnMoKSB7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuX2JhdGNoU3RhdGUuY3VycmVudFNoYWRlciwKICAgICAgICAgICAgYiA9IHRoaXMuX2dsLAogICAgICAgICAgICBkID0gdGhpcy5fbWF0NHBhcmFtLAogICAgICAgICAgICBjID0gdGhpcy5fY29sb3JQYXJhbSwKICAgICAgICAgICAgZSA9IHRoaXMuX3NyY09yaWdpblJlY3Q7CiAgICAgICAgaWYgKGEuX3VTYW1wbGVyQmFjay5Jc1VzZWQoKSkgewogICAgICAgICAgICBjb25zdCBnID0gdGhpcy5fYmF0Y2hTdGF0ZS5yZW5kZXJlciwKICAgICAgICAgICAgICAgIGsgPSB0aGlzLl90ZXhQYXJhbTsKICAgICAgICAgICAgZy5fbGFzdFRleHR1cmUxICE9PSBrICYmIChiLmFjdGl2ZVRleHR1cmUoYi5URVhUVVJFMSksIGIuYmluZFRleHR1cmUoYi5URVhUVVJFXzJELCBrID8gay5fR2V0VGV4dHVyZSgpIDogbnVsbCksIGcuX2xhc3RUZXh0dXJlMSA9IGssIGIuYWN0aXZlVGV4dHVyZShiLlRFWFRVUkUwKSkKICAgICAgICB9CiAgICAgICAgYS5fdVBpeGVsU2l6ZS5Jc1VzZWQoKSAmJiBhLl91UGl4ZWxTaXplLlVwZGF0ZTJmKGRbMF0sIGRbMV0pOwogICAgICAgIGEuX3VEZXN0U3RhcnQuSXNVc2VkKCkgJiYgYS5fdURlc3RTdGFydC5VcGRhdGUyZihkWzJdLCBkWzNdKTsKICAgICAgICBhLl91RGVzdEVuZC5Jc1VzZWQoKSAmJgogICAgICAgICAgICBhLl91RGVzdEVuZC5VcGRhdGUyZihkWzRdLCBkWzVdKTsKICAgICAgICBhLl91RGV2aWNlUGl4ZWxSYXRpby5Jc1VzZWQoKSAmJiBhLl91RGV2aWNlUGl4ZWxSYXRpby5VcGRhdGUxZih0aGlzLl9pbmRleENvdW50KTsKICAgICAgICBhLl91TGF5ZXJTY2FsZS5Jc1VzZWQoKSAmJiBhLl91TGF5ZXJTY2FsZS5VcGRhdGUxZihkWzZdKTsKICAgICAgICBhLl91TGF5ZXJBbmdsZS5Jc1VzZWQoKSAmJiBhLl91TGF5ZXJBbmdsZS5VcGRhdGUxZihkWzddKTsKICAgICAgICBhLl91U3JjU3RhcnQuSXNVc2VkKCkgJiYgYS5fdVNyY1N0YXJ0LlVwZGF0ZTJmKGRbMTJdLCBkWzEzXSk7CiAgICAgICAgYS5fdVNyY0VuZC5Jc1VzZWQoKSAmJiBhLl91U3JjRW5kLlVwZGF0ZTJmKGRbMTRdLCBkWzE1XSk7CiAgICAgICAgYS5fdVNyY09yaWdpblN0YXJ0LklzVXNlZCgpICYmIGEuX3VTcmNPcmlnaW5TdGFydC5VcGRhdGUyZihlWzBdLCBlWzFdKTsKICAgICAgICBhLl91U3JjT3JpZ2luRW5kLklzVXNlZCgpICYmIGEuX3VTcmNPcmlnaW5FbmQuVXBkYXRlMmYoZVsyXSwgZVszXSk7CiAgICAgICAgYS5fdUxheW91dFN0YXJ0LklzVXNlZCgpICYmIGEuX3VMYXlvdXRTdGFydC5VcGRhdGUyZihjWzBdLAogICAgICAgICAgICBjWzFdKTsKICAgICAgICBhLl91TGF5b3V0RW5kLklzVXNlZCgpICYmIGEuX3VMYXlvdXRFbmQuVXBkYXRlMmYoY1syXSwgY1szXSk7CiAgICAgICAgYS5fdVNlY29uZHMuSXNVc2VkKCkgJiYgYS5fdVNlY29uZHMuVXBkYXRlMWYodGhpcy5fc3RhcnRJbmRleCkKICAgIH0KICAgIEluaXRTZXRQcm9ncmFtQ3VzdG9tUGFyYW1ldGVycygpIHsKICAgICAgICB0aGlzLl90eXBlID0gMTMKICAgIH0KICAgIERvU2V0UHJvZ3JhbUN1c3RvbVBhcmFtZXRlcnMoKSB7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuX2JhdGNoU3RhdGUuY3VycmVudFNoYWRlci5fdUN1c3RvbVBhcmFtZXRlcnMsCiAgICAgICAgICAgIGIgPSB0aGlzLl9zaGFkZXJQYXJhbXM7CiAgICAgICAgZm9yIChsZXQgZCA9IDAsIGMgPSBhLmxlbmd0aDsgZCA8IGM7ICsrZCkgewogICAgICAgICAgICBjb25zdCBlID0gYVtkXSwKICAgICAgICAgICAgICAgIGcgPSBiW2RdOwogICAgICAgICAgICBlLklzQ29sb3JUeXBlKCkgPyBlLlVwZGF0ZTNmKGcuZ2V0UigpLCBnLmdldEcoKSwgZy5nZXRCKCkpIDogZS5VcGRhdGUxZihnKQogICAgICAgIH0KICAgIH0KICAgIEluaXRJbnZhbGlkYXRlRnJhbWVidWZmZXIoYSkgewogICAgICAgIHRoaXMuX3R5cGUgPSAxNDsKICAgICAgICB0aGlzLl90ZXhQYXJhbSA9IGEKICAgIH0KICAgIERvSW52YWxpZGF0ZUZyYW1lYnVmZmVyKCkgewogICAgICAgIGNvbnN0IGEgPSB0aGlzLl9nbCwKICAgICAgICAgICAgYiA9IHRoaXMuX3RleFBhcmFtLAogICAgICAgICAgICBkID0gdGhpcy5fYmF0Y2hTdGF0ZS5jdXJyZW50RnJhbWVidWZmZXI7CiAgICAgICAgYiAhPT0gZCAmJiBhLmJpbmRGcmFtZWJ1ZmZlcihhLkZSQU1FQlVGRkVSLCBiKTsKICAgICAgICBhLmludmFsaWRhdGVGcmFtZWJ1ZmZlcihhLkZSQU1FQlVGRkVSLCBbYS5DT0xPUl9BVFRBQ0hNRU5UMF0pOwogICAgICAgIGIgIT09IGQgJiYgYS5iaW5kRnJhbWVidWZmZXIoYS5GUkFNRUJVRkZFUiwgZCkKICAgIH0KICAgIEluaXRCbGl0RnJhbWVidWZmZXIoYSwgYiwgZCkgewogICAgICAgIHRoaXMuX3R5cGUgPSAxNzsKICAgICAgICBjb25zdCBjID0gdGhpcy5fbWF0NHBhcmFtLAogICAgICAgICAgICBlID0gdGhpcy5fYmF0Y2hTdGF0ZS5yZW5kZXJlcjsKICAgICAgICBjWzBdID0gYS5HZXRXaWR0aCgpOwogICAgICAgIGNbMV0gPSBhLkdldEhlaWdodCgpOwogICAgICAgIGNbMl0gPSBiID8gYi5HZXRXaWR0aCgpIDogZS5HZXRXaWR0aCgpOwogICAgICAgIGNbM10gPSBiID8gYi5HZXRIZWlnaHQoKSA6IGUuR2V0SGVpZ2h0KCk7CiAgICAgICAgY1s0XSA9IGEuSXNMaW5lYXJTYW1wbGluZygpID8gMSA6IDA7CiAgICAgICAgY1s1XSA9ICJzdHJldGNoIiA9PT0gZDsKICAgICAgICBkID0gdGhpcy5fc2hhZGVyUGFyYW1zOwogICAgICAgIEMzJGpzY29tcCQ0Ni5jbGVhckFycmF5KGQpOwogICAgICAgIGQucHVzaChhLl9HZXRGcmFtZWJ1ZmZlcigpKTsKICAgICAgICBkLnB1c2goYiA/IGIuX0dldEZyYW1lYnVmZmVyKCkgOiBudWxsKQogICAgfQogICAgRG9CbGl0RnJhbWVidWZmZXIoKSB7CiAgICAgICAgdmFyIGEgPSB0aGlzLl9tYXQ0cGFyYW0sCiAgICAgICAgICAgIGIgPSB0aGlzLl9zaGFkZXJQYXJhbXM7CiAgICAgICAgY29uc3QgZCA9IHRoaXMuX2dsOwogICAgICAgIHZhciBjID0gYVswXSwKICAgICAgICAgICAgZSA9IGFbMV0sCiAgICAgICAgICAgIGcgPSBhWzJdOwogICAgICAgIGNvbnN0IGsgPSBhWzNdLAogICAgICAgICAgICBtID0gMCAhPT0gYVs0XTsKICAgICAgICBhID0gMCAhPT0gYVs1XTsKICAgICAgICBjb25zdCBuID0gYlsxXTsKICAgICAgICBkLmJpbmRGcmFtZWJ1ZmZlcihkLlJFQURfRlJBTUVCVUZGRVIsIGJbMF0pOwogICAgICAgIGQuYmluZEZyYW1lYnVmZmVyKGQuRFJBV19GUkFNRUJVRkZFUiwgbik7CiAgICAgICAgYSA/IGQuYmxpdEZyYW1lYnVmZmVyKDAsIDAsIGMsIGUsIDAsIDAsIGcsIGssIGQuQ09MT1JfQlVGRkVSX0JJVCwgbSA/IGQuTElORUFSIDogZC5ORUFSRVNUKSA6IChiID0gTWF0aC5taW4oYywgZyksIGMgPSBNYXRoLm1pbihlLCBrKSwgZyA9IE1hdGgubWF4KGUgLSBrLCAwKSwgZSA9IE1hdGgubWF4KGsgLSBlLCAwKSwgZC5ibGl0RnJhbWVidWZmZXIoMCwgZywgYiwgYyArIGcsIDAsIGUsIGIsIGMgKyBlLCBkLkNPTE9SX0JVRkZFUl9CSVQsIGQuTkVBUkVTVCkpCiAgICB9CiAgICBJbml0U3RhcnRRdWVyeShhKSB7CiAgICAgICAgdGhpcy5fdHlwZSA9CiAgICAgICAgICAgIDE4OwogICAgICAgIHRoaXMuX3RleFBhcmFtID0gYQogICAgfQogICAgRG9TdGFydFF1ZXJ5KCkgewogICAgICAgIHRoaXMuX3RleFBhcmFtLkJlZ2luVGltZUVsYXBzZWQoKTsKICAgICAgICB0aGlzLl90ZXhQYXJhbSA9IG51bGwKICAgIH0KICAgIEluaXRFbmRRdWVyeShhKSB7CiAgICAgICAgdGhpcy5fdHlwZSA9IDE5OwogICAgICAgIHRoaXMuX3RleFBhcmFtID0gYQogICAgfQogICAgRG9FbmRRdWVyeSgpIHsKICAgICAgICB0aGlzLl90ZXhQYXJhbS5FbmRUaW1lRWxhcHNlZCgpOwogICAgICAgIHRoaXMuX3RleFBhcmFtID0gbnVsbAogICAgfQogICAgSW5pdFNldEVsbGlwc2VQYXJhbXMoYSwgYiwgZCkgewogICAgICAgIHRoaXMuX3R5cGUgPSAyMDsKICAgICAgICBjb25zdCBjID0gdGhpcy5fbWF0NHBhcmFtOwogICAgICAgIGNbMF0gPSBhOwogICAgICAgIGNbMV0gPSBiOwogICAgICAgIGNbMl0gPSBkCiAgICB9CiAgICBEb1NldEVsbGlwc2VQYXJhbXMoKSB7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuX2JhdGNoU3RhdGUuY3VycmVudFNoYWRlciwKICAgICAgICAgICAgYiA9IHRoaXMuX21hdDRwYXJhbTsKICAgICAgICBhLl91UGl4ZWxTaXplLklzVXNlZCgpICYmIGEuX3VQaXhlbFNpemUuVXBkYXRlMmYoYlswXSwgYlsxXSk7CiAgICAgICAgYS5fdU91dGxpbmVUaGlja25lc3MuSXNVc2VkKCkgJiYgYS5fdU91dGxpbmVUaGlja25lc3MuVXBkYXRlMWYoYlsyXSkKICAgIH0KICAgIEluaXRTZXRUaWxlbWFwSW5mbyhhLAogICAgICAgIGIsIGQsIGMsIGUsIGcsIGspIHsKICAgICAgICB0aGlzLl90eXBlID0gMTY7CiAgICAgICAgY29uc3QgbSA9IHRoaXMuX21hdDRwYXJhbTsKICAgICAgICBhLndyaXRlVG9UeXBlZEFycmF5KG0sIDApOwogICAgICAgIG1bNF0gPSAxIC8gYjsKICAgICAgICBtWzVdID0gMSAvIGQ7CiAgICAgICAgbVs2XSA9IGMgLyBiOwogICAgICAgIG1bN10gPSBlIC8gZDsKICAgICAgICBtWzhdID0gZyAvIGI7CiAgICAgICAgbVs5XSA9IGsgLyBkCiAgICB9CiAgICBEb1NldFRpbGVtYXBJbmZvKCkgewogICAgICAgIGNvbnN0IGEgPSB0aGlzLl9iYXRjaFN0YXRlLmN1cnJlbnRTaGFkZXIsCiAgICAgICAgICAgIGIgPSB0aGlzLl9tYXQ0cGFyYW07CiAgICAgICAgYS5fdVNyY1N0YXJ0LklzVXNlZCgpICYmIGEuX3VTcmNTdGFydC5VcGRhdGUyZihiWzBdLCBiWzFdKTsKICAgICAgICBhLl91UGl4ZWxTaXplLklzVXNlZCgpICYmIGEuX3VQaXhlbFNpemUuVXBkYXRlMmYoYls0XSwgYls1XSk7CiAgICAgICAgYS5fdVRpbGVTaXplLklzVXNlZCgpICYmIGEuX3VUaWxlU2l6ZS5VcGRhdGUyZihiWzZdLCBiWzddKTsKICAgICAgICBhLl91VGlsZVNwYWNpbmcuSXNVc2VkKCkgJiYgYS5fdVRpbGVTcGFjaW5nLlVwZGF0ZTJmKGJbOF0sIGJbOV0pCiAgICB9CiAgICBJbml0Q2xlYXJEZXB0aChhKSB7CiAgICAgICAgdGhpcy5fdHlwZSA9IDIyOwogICAgICAgIHRoaXMuX3N0YXJ0SW5kZXggPSBhID8gMSA6IDAKICAgIH0KICAgIERvQ2xlYXJEZXB0aCgpIHsKICAgICAgICBjb25zdCBhID0KICAgICAgICAgICAgdGhpcy5fZ2wsCiAgICAgICAgICAgIGIgPSAwICE9PSB0aGlzLl9zdGFydEluZGV4OwogICAgICAgIGIgfHwgYS5kZXB0aE1hc2soITApOwogICAgICAgIGEuY2xlYXIoYS5ERVBUSF9CVUZGRVJfQklUKTsKICAgICAgICBiIHx8IGEuZGVwdGhNYXNrKCExKQogICAgfQogICAgSW5pdFNldERlcHRoRW5hYmxlZChhKSB7CiAgICAgICAgdGhpcy5fdHlwZSA9IDIzOwogICAgICAgIHRoaXMuX3N0YXJ0SW5kZXggPSBhID8gMSA6IDAKICAgIH0KICAgIERvU2V0RGVwdGhFbmFibGVkKCkgewogICAgICAgIGNvbnN0IGEgPSB0aGlzLl9nbDsKICAgICAgICAwID09PSB0aGlzLl9zdGFydEluZGV4ID8gKGEuZGlzYWJsZShhLkRFUFRIX1RFU1QpLCBhLmRlcHRoTWFzayghMSkpIDogKGEuZW5hYmxlKGEuREVQVEhfVEVTVCksIGEuZGVwdGhNYXNrKCEwKSkKICAgIH0KICAgIEluaXRTZXREZXB0aFNhbXBsaW5nRW5hYmxlZChhKSB7CiAgICAgICAgdGhpcy5fdHlwZSA9IDI0OwogICAgICAgIHRoaXMuX3N0YXJ0SW5kZXggPSBhID8gMSA6IDAKICAgIH0KICAgIERvU2V0RGVwdGhTYW1wbGluZ0VuYWJsZWQoKSB7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuX2dsLAogICAgICAgICAgICBiID0gdGhpcy5fYmF0Y2hTdGF0ZSwKICAgICAgICAgICAgZCA9IGIucmVuZGVyZXIsCiAgICAgICAgICAgIGMgPSAwICE9PSB0aGlzLl9zdGFydEluZGV4OwogICAgICAgIGIuaXNEZXB0aFNhbXBsaW5nRW5hYmxlZCA9IGM7CiAgICAgICAgYS5hY3RpdmVUZXh0dXJlKGEuVEVYVFVSRTIpOwogICAgICAgIGMgPyAoYi5jdXJyZW50RnJhbWVidWZmZXJOb0RlcHRoICYmIGEuYmluZEZyYW1lYnVmZmVyKGEuRlJBTUVCVUZGRVIsIGIuY3VycmVudEZyYW1lYnVmZmVyTm9EZXB0aCksIGEuYmluZFRleHR1cmUoYS5URVhUVVJFXzJELCBkLl9HZXREZXB0aEJ1ZmZlcigpKSkgOiAoYS5iaW5kVGV4dHVyZShhLlRFWFRVUkVfMkQsIG51bGwpLCBiLmN1cnJlbnRGcmFtZWJ1ZmZlck5vRGVwdGggJiYgYS5iaW5kRnJhbWVidWZmZXIoYS5GUkFNRUJVRkZFUiwgYi5jdXJyZW50RnJhbWVidWZmZXIpKTsKICAgICAgICBhLmFjdGl2ZVRleHR1cmUoYS5URVhUVVJFMCkKICAgIH0KICAgIEluaXRDb3BsYW5hclN0YXJ0U3RlbmNpbFBhc3MoKSB7CiAgICAgICAgdGhpcy5fdHlwZSA9IDI1CiAgICB9CiAgICBEb0NvcGxhbmFyU3RhcnRTdGVuY2lsUGFzcygpIHsKICAgICAgICBjb25zdCBhID0gdGhpcy5fZ2w7CiAgICAgICAgYS5jbGVhcihhLlNURU5DSUxfQlVGRkVSX0JJVCk7CiAgICAgICAgYS5lbmFibGUoYS5TVEVOQ0lMX1RFU1QpOwogICAgICAgIGEuc3RlbmNpbEZ1bmMoYS5BTFdBWVMsIDEsIDEpOwogICAgICAgIGEuc3RlbmNpbE9wKGEuS0VFUCwgYS5LRUVQLCBhLlJFUExBQ0UpOwogICAgICAgIGEuY29sb3JNYXNrKCExLCAhMSwgITEsICExKQogICAgfQogICAgSW5pdENvcGxhbmFyU3RhcnRDb2xvclBhc3MoKSB7CiAgICAgICAgdGhpcy5fdHlwZSA9IDI2CiAgICB9CiAgICBEb0NvcGxhbmFyU3RhcnRDb2xvclBhc3MoKSB7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuX2dsOwogICAgICAgIGEuY29sb3JNYXNrKCEwLCAhMCwgITAsICEwKTsKICAgICAgICBhLnN0ZW5jaWxGdW5jKGEuRVFVQUwsIDEsIDEpOwogICAgICAgIGEuc3RlbmNpbE9wKGEuS0VFUCwgYS5LRUVQLCBhLktFRVApCiAgICB9CiAgICBJbml0Q29wbGFuYXJSZXN0b3JlKCkgewogICAgICAgIHRoaXMuX3R5cGUgPSAyNwogICAgfQogICAgRG9Db3BsYW5hclJlc3RvcmUoKSB7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuX2dsOwogICAgICAgIGEuZGlzYWJsZShhLlNURU5DSUxfVEVTVCkKICAgIH0KICAgIEluaXRTZXRTY2lzc29yKGEsIGIsIGQsIGMsIGUpIHsKICAgICAgICB0aGlzLl90eXBlID0gMjg7CiAgICAgICAgdGhpcy5fc3RhcnRJbmRleCA9IGEgPyAxIDogMDsKICAgICAgICBhID0gdGhpcy5fbWF0NHBhcmFtOwogICAgICAgIGFbMF0gPSBiOwogICAgICAgIGFbMV0gPSBkOwogICAgICAgIGFbMl0gPSBjOwogICAgICAgIGFbM10gPSBlCiAgICB9CiAgICBEb1NldFNjaXNzb3IoKSB7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuX2dsLAogICAgICAgICAgICBiID0gdGhpcy5fbWF0NHBhcmFtOwogICAgICAgIDEgPT09IHRoaXMuX3N0YXJ0SW5kZXggPyAoYS5lbmFibGUoYS5TQ0lTU09SX1RFU1QpLCBhLnNjaXNzb3IoYlswXSwKICAgICAgICAgICAgYlsxXSwgYlsyXSwgYlszXSkpIDogYS5kaXNhYmxlKGEuU0NJU1NPUl9URVNUKQogICAgfQogICAgUnVuKCkgewogICAgICAgIHN3aXRjaCAodGhpcy5fdHlwZSkgewogICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICB0aGlzLkRvUXVhZCgpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgIHRoaXMuRG9TZXRUZXh0dXJlKCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgdGhpcy5Eb1NldENvbG9yKCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgdGhpcy5Eb1NldEJsZW5kKCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgICAgdGhpcy5Eb1NldFZpZXdwb3J0KCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgICAgdGhpcy5Eb1NldFByb2plY3Rpb24oKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgICB0aGlzLkRvU2V0TW9kZWxWaWV3KCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICAgICAgdGhpcy5Eb1NldFJlbmRlclRhcmdldCgpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICAgIHRoaXMuRG9DbGVhclN1cmZhY2UoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICAgICAgdGhpcy5Eb1BvaW50cygpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgICAgICB0aGlzLkRvU2V0UHJvZ3JhbSgpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgICAgICB0aGlzLkRvU2V0UHJvZ3JhbVBhcmFtZXRlcnMoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDEzOgogICAgICAgICAgICAgICAgdGhpcy5Eb1NldFByb2dyYW1DdXN0b21QYXJhbWV0ZXJzKCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAxNDoKICAgICAgICAgICAgICAgIHRoaXMuRG9JbnZhbGlkYXRlRnJhbWVidWZmZXIoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDE1OgogICAgICAgICAgICAgICAgdGhpcy5Eb1NldFBvaW50VGV4dHVyZUNvb3JkcygpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMTY6CiAgICAgICAgICAgICAgICB0aGlzLkRvU2V0VGlsZW1hcEluZm8oKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDE3OgogICAgICAgICAgICAgICAgdGhpcy5Eb0JsaXRGcmFtZWJ1ZmZlcigpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMTg6CiAgICAgICAgICAgICAgICB0aGlzLkRvU3RhcnRRdWVyeSgpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMTk6CiAgICAgICAgICAgICAgICB0aGlzLkRvRW5kUXVlcnkoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDIwOgogICAgICAgICAgICAgICAgdGhpcy5Eb1NldEVsbGlwc2VQYXJhbXMoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDIxOgogICAgICAgICAgICAgICAgdGhpcy5Eb1NldEdyYWRpZW50Q29sb3IoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDIyOgogICAgICAgICAgICAgICAgdGhpcy5Eb0NsZWFyRGVwdGgoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDIzOgogICAgICAgICAgICAgICAgdGhpcy5Eb1NldERlcHRoRW5hYmxlZCgpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMjQ6CiAgICAgICAgICAgICAgICB0aGlzLkRvU2V0RGVwdGhTYW1wbGluZ0VuYWJsZWQoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDI1OgogICAgICAgICAgICAgICAgdGhpcy5Eb0NvcGxhbmFyU3RhcnRTdGVuY2lsUGFzcygpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMjY6CiAgICAgICAgICAgICAgICB0aGlzLkRvQ29wbGFuYXJTdGFydENvbG9yUGFzcygpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMjc6CiAgICAgICAgICAgICAgICB0aGlzLkRvQ29wbGFuYXJSZXN0b3JlKCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAyODoKICAgICAgICAgICAgICAgIHRoaXMuRG9TZXRTY2lzc29yKCkKICAgICAgICB9CiAgICB9Cn07CiJ1c2Ugc3RyaWN0IjsKY29uc3QgQzMkanNjb21wJDQ3ID0gc2VsZi5DMywKICAgIEdFTkVSSUNfRk9OVF9GQU1JTElFUyA9IG5ldyBTZXQoInNlcmlmIHNhbnMtc2VyaWYgbW9ub3NwYWNlIGN1cnNpdmUgZmFudGFzeSBzeXN0ZW0tdWkgdWktc2VyaWYgdWktc2Fucy1zZXJpZiB1aS1tb25vc3BhY2UgdWktcm91bmRlZCBtYXRoIGVtb2ppIGZhbmdzb25nIi5zcGxpdCgiICIpKSwKICAgIERFRkFVTFRfT1BUUyA9IHsKICAgICAgICB0aW1lb3V0OiA2MAogICAgfSwKICAgIHRlbXBDb2xvciA9IG5ldyBDMyRqc2NvbXAkNDcuQ29sb3IoMCwgMCwgMCwgMSksCiAgICBWQUxJRF9IT1JJWl9BTElHTk1FTlRTID0gbmV3IFNldChbImxlZnQiLCAiY2VudGVyIiwgInJpZ2h0Il0pLAogICAgVkFMSURfVkVSVF9BTElHTk1FTlRTID0gbmV3IFNldChbInRvcCIsICJjZW50ZXIiLCAiYm90dG9tIl0pLAogICAgVkFMSURfV09SRF9XUkFQX01PREVTID0gbmV3IFNldChbIndvcmQiLCAiY2hhcmFjdGVyIl0pLAogICAgYWxsUmVuZGVyZXJUZXh0cyA9IG5ldyBTZXQ7CkMzJGpzY29tcCQ0Ny5Gb250TWFuYWdlciAmJiBDMyRqc2NvbXAkNDcuRm9udE1hbmFnZXIuYWRkRXZlbnRMaXN0ZW5lcigiZm9udGxvYWQiLCBhID0+IHsKICAgIGEgPSBhLmZvbnQuR2V0TmFtZSgpOwogICAgZm9yIChjb25zdCBiIG9mIGFsbFJlbmRlcmVyVGV4dHMpKGIuSXNCQkNvZGVFbmFibGVkKCkgfHwgQzMkanNjb21wJDQ3LmVxdWFsc05vQ2FzZShiLkdldEZvbnROYW1lKCksIGEpKSAmJiBiLl9TZXRUZXh0Q2hhbmdlZCgpCn0pOwoKZnVuY3Rpb24gZmlsbE9yU3Ryb2tlVGV4dChhLCBiLCBkLCBjLCBlLCBnKSB7CiAgICBiID8gIkdlY2tvIiA9PT0gQzMkanNjb21wJDQ3LlBsYXRmb3JtLkJyb3dzZXJFbmdpbmUgPyBhLnN0cm9rZVRleHQoZCwgYywgZSwgZykgOiBhLnN0cm9rZVRleHQoZCwgYywgZSkgOiAiR2Vja28iID09PSBDMyRqc2NvbXAkNDcuUGxhdGZvcm0uQnJvd3NlckVuZ2luZSA/IGEuZmlsbFRleHQoZCwgYywgZSwgZykgOiBhLmZpbGxUZXh0KGQsIGMsIGUpCn0KCmZ1bmN0aW9uIGZpbGxPclN0cm9rZVJlY3QoYSwgYiwgZCwgYywgZSwgZykgewogICAgYiA/IGEuc3Ryb2tlUmVjdChkLCBjLCBlLCBnKSA6IGEuZmlsbFJlY3QoZCwgYywgZSwgZykKfQoKZnVuY3Rpb24gcHRUb1B4KGEpIHsKICAgIHJldHVybiA0IC8gMyAqIGEKfQpsZXQgZGlkQ2hlY2tGb3VuZEJvdW5kaW5nQm94U3VwcG9ydCA9ICExLAogICAgc3VwcG9ydHNGb250Qm91bmRpbmdCb3hNZWFzdXJlbWVudHMgPSAhMTsKQzMkanNjb21wJDQ3LkdmeC5SZW5kZXJlclRleHQgPSBjbGFzcyB7CiAgICBjb25zdHJ1Y3RvcihhLCBiKSB7CiAgICAgICAgYiA9IE9iamVjdC5hc3NpZ24oe30sIERFRkFVTFRfT1BUUywgYik7CiAgICAgICAgdGhpcy5fcmVuZGVyZXIgPSBhOwogICAgICAgIHRoaXMuX2ZvbnROYW1lID0gIkFyaWFsIjsKICAgICAgICB0aGlzLl9mb250U2l6ZSA9IDE2OwogICAgICAgIHRoaXMuX2ZvbnRTaXplU2NhbGUgPSAxOwogICAgICAgIHRoaXMuX2xpbmVIZWlnaHQgPSAwOwogICAgICAgIHRoaXMuX2lzSXRhbGljID0gdGhpcy5faXNCb2xkID0gITE7CiAgICAgICAgdGhpcy5fY29sb3JTdHIgPSAiYmxhY2siOwogICAgICAgIHRoaXMuX2lzQkJjb2RlRW5hYmxlZCA9ICExOwogICAgICAgIHRoaXMub25sb2FkZm9udCA9IG51bGw7CiAgICAgICAgdGhpcy5fYWxyZWFkeUxvYWRlZEZvbnRzID0gbmV3IFNldDsKICAgICAgICB0aGlzLl9ob3Jpem9udGFsQWxpZ24gPSAibGVmdCI7CiAgICAgICAgdGhpcy5fdmVydGljYWxBbGlnbiA9ICJ0b3AiOwogICAgICAgIHRoaXMuX3RleHQgPSAiIjsKICAgICAgICB0aGlzLl9iYlN0cmluZyA9IG51bGw7CiAgICAgICAgdGhpcy5fd3JhcHBlZFRleHQgPSBDMyRqc2NvbXAkNDcuTmV3KEMzJGpzY29tcCQ0Ny5Xb3JkV3JhcCk7CiAgICAgICAgdGhpcy5fd3JhcE1vZGUgPSAid29yZCI7CiAgICAgICAgdGhpcy5faXNVcGRhdGluZyA9CiAgICAgICAgICAgIHRoaXMuX3RleHRDaGFuZ2VkID0gITE7CiAgICAgICAgdGhpcy5faXNBc3luYyA9ICEwOwogICAgICAgIHRoaXMuX2RyYXdNYXhDaGFyQ291bnQgPSAtMTsKICAgICAgICB0aGlzLl9oZWlnaHQgPSB0aGlzLl93aWR0aCA9IHRoaXMuX2Nzc0hlaWdodCA9IHRoaXMuX2Nzc1dpZHRoID0gdGhpcy5fZHJhd0NoYXJDb3VudCA9IDA7CiAgICAgICAgdGhpcy5fem9vbSA9IDE7CiAgICAgICAgdGhpcy5fY2hhbmdlZCA9ICExOwogICAgICAgIHRoaXMuX21lYXN1cmVDb250ZXh0VG9wID0gdGhpcy5fbWVhc3VyZUNvbnRleHQgPSB0aGlzLl90ZXh0Q29udGV4dCA9IHRoaXMuX3RleHRDYW52YXMgPSBudWxsOwogICAgICAgIHRoaXMuX2xhc3RDYW52YXNIZWlnaHQgPSB0aGlzLl9sYXN0Q2FudmFzV2lkdGggPSAtMTsKICAgICAgICB0aGlzLl9sYXN0VGV4dENhbnZhc0ZpbGxTdHlsZSA9IHRoaXMuX2xhc3RNZWFzdXJlQ2FudmFzRm9udCA9IHRoaXMuX2xhc3RUZXh0Q2FudmFzRm9udCA9ICIiOwogICAgICAgIHRoaXMuX2xhc3RUZXh0Q2FudmFzTGluZVdpZHRoID0gdGhpcy5fbGFzdFRleHRDYW52YXNPcGFjaXR5ID0gMTsKICAgICAgICB0aGlzLl9tZWFzdXJlVGV4dENhbGxiYWNrID0gKGQsIGMpID0+IHRoaXMuX01lYXN1cmVUZXh0KGQsCiAgICAgICAgICAgIGMpOwogICAgICAgIHRoaXMuX3RleHR1cmUgPSBudWxsOwogICAgICAgIHRoaXMuX3RleHR1cmVIZWlnaHQgPSB0aGlzLl90ZXh0dXJlV2lkdGggPSAwOwogICAgICAgIHRoaXMuX3JjVGV4ID0gbmV3IEMzJGpzY29tcCQ0Ny5SZWN0OwogICAgICAgIHRoaXMuX3NjYWxlRmFjdG9yID0gMTsKICAgICAgICB0aGlzLl9uZWVkVG9SZWNyZWF0ZVRleHR1cmUgPSAhMTsKICAgICAgICB0aGlzLl90ZXh0dXJlVGltZW91dCA9IG5ldyBDMyRqc2NvbXAkNDcuSWRsZVRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICB0aGlzLlJlbGVhc2VUZXh0dXJlKCk7CiAgICAgICAgICAgIHRoaXMuX1NldFRleHRDYW52YXNTaXplKDgsIDgpCiAgICAgICAgfSwgYi50aW1lb3V0KTsKICAgICAgICB0aGlzLm9udGV4dHVyZXVwZGF0ZSA9IG51bGw7CiAgICAgICAgdGhpcy5fd2FzUmVsZWFzZWQgPSAhMTsKICAgICAgICBhbGxSZW5kZXJlclRleHRzLmFkZCh0aGlzKQogICAgfQogICAgUmVsZWFzZSgpIHsKICAgICAgICB0aGlzLm9ubG9hZGZvbnQgPSBudWxsOwogICAgICAgIHRoaXMuX2FscmVhZHlMb2FkZWRGb250cy5jbGVhcigpOwogICAgICAgIHRoaXMuX21lYXN1cmVUZXh0Q2FsbGJhY2sgPSB0aGlzLl9tZWFzdXJlQ29udGV4dFRvcCA9IHRoaXMuX21lYXN1cmVDb250ZXh0ID0gdGhpcy5fdGV4dENvbnRleHQgPSB0aGlzLl90ZXh0Q2FudmFzID0KICAgICAgICAgICAgdGhpcy5fYmJTdHJpbmcgPSBudWxsOwogICAgICAgIHRoaXMuX3RleHR1cmVUaW1lb3V0LlJlbGVhc2UoKTsKICAgICAgICB0aGlzLm9udGV4dHVyZXVwZGF0ZSA9IG51bGw7CiAgICAgICAgdGhpcy5SZWxlYXNlVGV4dHVyZSgpOwogICAgICAgIHRoaXMuX3dyYXBwZWRUZXh0LkNsZWFyKCk7CiAgICAgICAgdGhpcy5fcmVuZGVyZXIgPSB0aGlzLl93cmFwcGVkVGV4dCA9IG51bGw7CiAgICAgICAgdGhpcy5fd2FzUmVsZWFzZWQgPSAhMDsKICAgICAgICBhbGxSZW5kZXJlclRleHRzLmRlbGV0ZSh0aGlzKQogICAgfQogICAgX1NldENoYW5nZWQoKSB7CiAgICAgICAgdGhpcy5fY2hhbmdlZCA9ICEwCiAgICB9CiAgICBfU2V0VGV4dENoYW5nZWQoKSB7CiAgICAgICAgdGhpcy5fU2V0Q2hhbmdlZCgpOwogICAgICAgIHRoaXMuX3dyYXBwZWRUZXh0LkNsZWFyKCk7CiAgICAgICAgdGhpcy5fdGV4dENoYW5nZWQgPSAhMAogICAgfQogICAgU2V0SXNBc3luYyhhKSB7CiAgICAgICAgdGhpcy5faXNBc3luYyA9ICEhYQogICAgfQogICAgSXNBc3luYygpIHsKICAgICAgICByZXR1cm4gdGhpcy5faXNBc3luYwogICAgfQogICAgU2V0QkJDb2RlRW5hYmxlZChhKSB7CiAgICAgICAgYSA9ICEhYTsKICAgICAgICB0aGlzLl9pc0JCY29kZUVuYWJsZWQgIT09IGEgJiYgKGEgPSAodGhpcy5faXNCQmNvZGVFbmFibGVkID0gYSkgPyAiYWxwaGFiZXRpYyIgOiAidG9wIiwgdGhpcy5fdGV4dENvbnRleHQgJiYKICAgICAgICAgICAgKHRoaXMuX3RleHRDb250ZXh0LnRleHRCYXNlbGluZSA9IGEpLCB0aGlzLl9tZWFzdXJlQ29udGV4dCAmJiAodGhpcy5fbWVhc3VyZUNvbnRleHQudGV4dEJhc2VsaW5lID0gYSksIHRoaXMuX1NldFRleHRDaGFuZ2VkKCkpCiAgICB9CiAgICBJc0JCQ29kZUVuYWJsZWQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2lzQkJjb2RlRW5hYmxlZAogICAgfQogICAgU2V0Rm9udE5hbWUoYSkgewogICAgICAgIGEgfHwgKGEgPSAic2VyaWYiKTsKICAgICAgICB0aGlzLl9mb250TmFtZSAhPT0gYSAmJiAodGhpcy5fZm9udE5hbWUgPSBhLCB0aGlzLl9TZXRUZXh0Q2hhbmdlZCgpKQogICAgfQogICAgR2V0Rm9udE5hbWUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2ZvbnROYW1lCiAgICB9CiAgICBTZXRGb250U2l6ZShhKSB7CiAgICAgICAgLjEgPiBhICYmIChhID0gLjEpOwogICAgICAgIHRoaXMuX2ZvbnRTaXplICE9PSBhICYmICh0aGlzLl9mb250U2l6ZSA9IGEsIHRoaXMuX1NldFRleHRDaGFuZ2VkKCkpCiAgICB9CiAgICBTZXRGb250U2l6ZVNjYWxlKGEpIHsKICAgICAgICB0aGlzLl9mb250U2l6ZVNjYWxlICE9PSBhICYmICh0aGlzLl9mb250U2l6ZVNjYWxlID0gYSwgdGhpcy5fU2V0VGV4dENoYW5nZWQoKSkKICAgIH0KICAgIFNldExpbmVIZWlnaHQoYSkgewogICAgICAgIHRoaXMuX2xpbmVIZWlnaHQgIT09CiAgICAgICAgICAgIGEgJiYgKHRoaXMuX2xpbmVIZWlnaHQgPSBhLCB0aGlzLl9TZXRDaGFuZ2VkKCkpCiAgICB9CiAgICBTZXRCb2xkKGEpIHsKICAgICAgICBhID0gISFhOwogICAgICAgIHRoaXMuX2lzQm9sZCAhPT0gYSAmJiAodGhpcy5faXNCb2xkID0gYSwgdGhpcy5fU2V0VGV4dENoYW5nZWQoKSkKICAgIH0KICAgIFNldEl0YWxpYyhhKSB7CiAgICAgICAgYSA9ICEhYTsKICAgICAgICB0aGlzLl9pc0l0YWxpYyAhPT0gYSAmJiAodGhpcy5faXNJdGFsaWMgPSBhLCB0aGlzLl9TZXRUZXh0Q2hhbmdlZCgpKQogICAgfQogICAgU2V0RHJhd01heENoYXJhY3RlckNvdW50KGEpIHsKICAgICAgICBhID0gTWF0aC5mbG9vcihhKTsKICAgICAgICB0aGlzLl9kcmF3TWF4Q2hhckNvdW50ICE9PSBhICYmICh0aGlzLl9kcmF3TWF4Q2hhckNvdW50ID0gYSwgdGhpcy5fU2V0Q2hhbmdlZCgpKQogICAgfQogICAgR2V0RHJhd01heENoYXJhY3RlckNvdW50KCkgewogICAgICAgIHJldHVybiB0aGlzLl9kcmF3TWF4Q2hhckNvdW50CiAgICB9CiAgICBfR2V0U3R5bGVUYWcoYSwgYikgewogICAgICAgIGZvciAobGV0IGQgPSBhLmxlbmd0aCAtIDE7IDAgPD0gZDsgLS1kKSB7CiAgICAgICAgICAgIGNvbnN0IGMgPSBhW2RdOwogICAgICAgICAgICBpZiAoYy50YWcgPT09IGIpIHJldHVybiBjCiAgICAgICAgfQogICAgICAgIHJldHVybiBudWxsCiAgICB9CiAgICBfSGFzU3R5bGVUYWcoYSwgYikgewogICAgICAgIHJldHVybiAhIXRoaXMuX0dldFN0eWxlVGFnKGEsCiAgICAgICAgICAgIGIpCiAgICB9CiAgICBfR2V0Rm9udFN0cmluZyhhLCBiKSB7CiAgICAgICAgbGV0IGQgPSBbXTsKICAgICAgICAodGhpcy5faXNCb2xkIHx8IHRoaXMuX0hhc1N0eWxlVGFnKGIsICJiIikpICYmIGQucHVzaCgiYm9sZCIpOwogICAgICAgICh0aGlzLl9pc0l0YWxpYyB8fCB0aGlzLl9IYXNTdHlsZVRhZyhiLCAiaSIpKSAmJiBkLnB1c2goIml0YWxpYyIpOwogICAgICAgIHZhciBjID0gdGhpcy5fR2V0U3R5bGVUYWcoYiwgInNpemUiKTsKICAgICAgICBjID0gKGMgPyBwYXJzZUZsb2F0KGMucGFyYW0pIDogdGhpcy5fZm9udFNpemUpICogdGhpcy5fZm9udFNpemVTY2FsZTsKICAgICAgICBhID8gZC5wdXNoKGMgKyAicHQiKSA6IGQucHVzaChjICogdGhpcy5fc2NhbGVGYWN0b3IgKiB0aGlzLl96b29tICogc2VsZi5kZXZpY2VQaXhlbFJhdGlvICsgInB0Iik7CiAgICAgICAgYSA9IHRoaXMuX2ZvbnROYW1lOwogICAgICAgIChiID0gdGhpcy5fR2V0U3R5bGVUYWcoYiwgImZvbnQiKSkgJiYgYi5wYXJhbSAmJiAoYSA9IGIucGFyYW0sIHRoaXMub25sb2FkZm9udCAmJiAhdGhpcy5fYWxyZWFkeUxvYWRlZEZvbnRzLmhhcyhhKSAmJiAodGhpcy5vbmxvYWRmb250KGEpLCB0aGlzLl9hbHJlYWR5TG9hZGVkRm9udHMuYWRkKGEpKSk7CiAgICAgICAgYSAmJiAoR0VORVJJQ19GT05UX0ZBTUlMSUVTLmhhcyhhKSA/IGQucHVzaChhKSA6IGQucHVzaCgnIicgKyBhICsgJyInKSk7CiAgICAgICAgcmV0dXJuIGQuam9pbigiICIpCiAgICB9CiAgICBTZXRDb2xvcihhKSB7CiAgICAgICAgYSBpbnN0YW5jZW9mIEMzJGpzY29tcCQ0Ny5Db2xvciAmJiAoYSA9IGEuZ2V0Q3NzUmdiKCkpOwogICAgICAgIHRoaXMuX2NvbG9yU3RyICE9PSBhICYmICh0aGlzLl9jb2xvclN0ciA9IGEsIHRoaXMuX1NldENoYW5nZWQoKSkKICAgIH0KICAgIFNldENvbG9yUmdiKGEsIGIsIGQpIHsKICAgICAgICB0ZW1wQ29sb3Iuc2V0UmdiKGEsIGIsIGQpOwogICAgICAgIHRoaXMuU2V0Q29sb3IodGVtcENvbG9yKQogICAgfQogICAgU2V0SG9yaXpvbnRhbEFsaWdubWVudChhKSB7CiAgICAgICAgaWYgKCFWQUxJRF9IT1JJWl9BTElHTk1FTlRTLmhhcyhhKSkgdGhyb3cgRXJyb3IoImludmFsaWQgaG9yaXpvbnRhbCBhbGlnbm1lbnQiKTsKICAgICAgICB0aGlzLl9ob3Jpem9udGFsQWxpZ24gIT09IGEgJiYgKHRoaXMuX2hvcml6b250YWxBbGlnbiA9IGEsIHRoaXMuX1NldENoYW5nZWQoKSkKICAgIH0KICAgIFNldFZlcnRpY2FsQWxpZ25tZW50KGEpIHsKICAgICAgICBpZiAoIVZBTElEX1ZFUlRfQUxJR05NRU5UUy5oYXMoYSkpIHRocm93IEVycm9yKCJpbnZhbGlkIHZlcnRpY2FsIGFsaWdubWVudCIpOwogICAgICAgIHRoaXMuX3ZlcnRpY2FsQWxpZ24gIT09IGEgJiYgKHRoaXMuX3ZlcnRpY2FsQWxpZ24gPSBhLCB0aGlzLl9TZXRDaGFuZ2VkKCkpCiAgICB9CiAgICBTZXRXb3JkV3JhcE1vZGUoYSkgewogICAgICAgIGlmICghVkFMSURfV09SRF9XUkFQX01PREVTLmhhcyhhKSkgdGhyb3cgRXJyb3IoImludmFsaWQgd29yZCB3cmFwIG1vZGUiKTsKICAgICAgICB0aGlzLl93cmFwTW9kZSAhPT0gYSAmJiAodGhpcy5fd3JhcE1vZGUgPSBhLCB0aGlzLl9TZXRUZXh0Q2hhbmdlZCgpKQogICAgfQogICAgU2V0VGV4dChhKSB7CiAgICAgICAgdGhpcy5fdGV4dCAhPT0gYSAmJiAodGhpcy5fdGV4dCA9IGEsIHRoaXMuX1NldFRleHRDaGFuZ2VkKCkpCiAgICB9CiAgICBTZXRTaXplKGEsIGIsIGQpIHsKICAgICAgICAidW5kZWZpbmVkIiA9PT0gdHlwZW9mIGQgJiYgKGQgPSAxKTsKICAgICAgICBpZiAoISgwID49IGEgfHwgMCA+PSBhIHx8IHRoaXMuX2Nzc1dpZHRoID09PSBhICYmIHRoaXMuX2Nzc0hlaWdodCA9PT0gYiAmJiB0aGlzLl96b29tID09PSBkKSkgewogICAgICAgICAgICAxID09PSB0aGlzLl96b29tICE9PSAoMSA9PT0gZCkgJiYgKHRoaXMuX25lZWRUb1JlY3JlYXRlVGV4dHVyZSA9ICEwKTsKICAgICAgICAgICAgdmFyIGMgPSB0aGlzLl9jc3NXaWR0aCwKICAgICAgICAgICAgICAgIGUgPSB0aGlzLl96b29tOwogICAgICAgICAgICB0aGlzLl9jc3NXaWR0aCA9CiAgICAgICAgICAgICAgICBhOwogICAgICAgICAgICB0aGlzLl9jc3NIZWlnaHQgPSBiOwogICAgICAgICAgICB0aGlzLl96b29tID0gZDsKICAgICAgICAgICAgYSA9IHNlbGYuZGV2aWNlUGl4ZWxSYXRpbzsKICAgICAgICAgICAgdGhpcy5fd2lkdGggPSB0aGlzLl9jc3NXaWR0aCAqIHRoaXMuX3pvb20gKiBhOwogICAgICAgICAgICB0aGlzLl9oZWlnaHQgPSB0aGlzLl9jc3NIZWlnaHQgKiB0aGlzLl96b29tICogYTsKICAgICAgICAgICAgYSA9IE1hdGgubWF4KHRoaXMuX3dpZHRoLCB0aGlzLl9oZWlnaHQpOwogICAgICAgICAgICBiID0gTWF0aC5taW4odGhpcy5fcmVuZGVyZXIuR2V0TWF4VGV4dHVyZVNpemUoKSwgNDA5Nik7CiAgICAgICAgICAgIGQgPSAxOwogICAgICAgICAgICBhID4gYiAmJiAoZCA9IGIgLyBhLCB0aGlzLl93aWR0aCA9IE1hdGgubWluKHRoaXMuX3dpZHRoICogZCwgYiksIHRoaXMuX2hlaWdodCA9IE1hdGgubWluKHRoaXMuX2hlaWdodCAqIGQsIGIpKTsKICAgICAgICAgICAgdGhpcy5fc2NhbGVGYWN0b3IgPSBkOwogICAgICAgICAgICAwIDwgdGhpcy5fdGV4dHVyZVdpZHRoICYmIDAgPCB0aGlzLl90ZXh0dXJlSGVpZ2h0ICYmIHRoaXMuX3pvb20gPT09IGUgJiYgdGhpcy5fcmNUZXguc2V0KDAsIDAsIHRoaXMuX3dpZHRoIC8gdGhpcy5fdGV4dHVyZVdpZHRoLCB0aGlzLl9oZWlnaHQgLyB0aGlzLl90ZXh0dXJlSGVpZ2h0KTsKICAgICAgICAgICAgdGhpcy5fY3NzV2lkdGggIT09CiAgICAgICAgICAgICAgICBjID8gdGhpcy5fU2V0VGV4dENoYW5nZWQoKSA6IHRoaXMuX1NldENoYW5nZWQoKQogICAgICAgIH0KICAgIH0KICAgIEdldFdpZHRoKCkgewogICAgICAgIHJldHVybiB0aGlzLl93aWR0aAogICAgfQogICAgR2V0SGVpZ2h0KCkgewogICAgICAgIHJldHVybiB0aGlzLl9oZWlnaHQKICAgIH0KICAgIEdldFRleHRXaWR0aCgpIHsKICAgICAgICB0aGlzLl9NYXliZVdyYXBUZXh0KCk7CiAgICAgICAgcmV0dXJuIHRoaXMuX3dyYXBwZWRUZXh0LkdldE1heExpbmVXaWR0aCgpCiAgICB9CiAgICBHZXRUZXh0SGVpZ2h0KCkgewogICAgICAgIHRoaXMuX01heWJlV3JhcFRleHQoKTsKICAgICAgICByZXR1cm4gdGhpcy5fd3JhcHBlZFRleHQuR2V0VG90YWxMaW5lSGVpZ2h0KCkgKyB0aGlzLl93cmFwcGVkVGV4dC5HZXRMaW5lQ291bnQoKSAqICh0aGlzLl9saW5lSGVpZ2h0ICsgNCkgLSB0aGlzLl9saW5lSGVpZ2h0CiAgICB9CiAgICBHZXRUZXh0dXJlKCkgewogICAgICAgIHRoaXMuX3RleHR1cmVUaW1lb3V0LlJlc2V0KCk7CiAgICAgICAgdGhpcy5fTWF5YmVVcGRhdGUoKTsKICAgICAgICByZXR1cm4gdGhpcy5fdGV4dHVyZQogICAgfQogICAgX01heWJlVXBkYXRlKCkgewogICAgICAgIHRoaXMuX3RleHR1cmUgJiYgIXRoaXMuX2NoYW5nZWQgJiYgIXRoaXMuX3RleHRDaGFuZ2VkIHx8IHRoaXMuX2lzVXBkYXRpbmcgfHwKICAgICAgICAgICAgMCA+PSB0aGlzLl93aWR0aCB8fCAwID49IHRoaXMuX2hlaWdodCB8fCAodGhpcy5fY2hhbmdlZCA9ICExLCB0aGlzLl9pc1VwZGF0aW5nID0gITAsIHRoaXMuX2lzQXN5bmMgPyBDMyRqc2NvbXAkNDcuQXN5bmNpZnkoKCkgPT4gdGhpcy5fRG9VcGRhdGUoKSkgOiB0aGlzLl9Eb1VwZGF0ZSgpKQogICAgfQogICAgX0RvVXBkYXRlKCkgewogICAgICAgIHRoaXMuX3dhc1JlbGVhc2VkIHx8ICh0aGlzLl9TZXRUZXh0Q2FudmFzU2l6ZShNYXRoLmNlaWwodGhpcy5fd2lkdGgpLCBNYXRoLmNlaWwodGhpcy5faGVpZ2h0KSksIHRoaXMuX01heWJlV3JhcFRleHQoKSwgdGhpcy5fRHJhd1RleHRUb0NhbnZhcygpLCB0aGlzLl9VcGRhdGVUZXh0dXJlKCksIHRoaXMuX3RleHR1cmVUaW1lb3V0LlJlc2V0KCksIHRoaXMuX2lzVXBkYXRpbmcgPSAhMSkKICAgIH0KICAgIF9TZXRUZXh0Q2FudmFzU2l6ZShhLCBiKSB7CiAgICAgICAgdGhpcy5fdGV4dENhbnZhcyB8fCAodGhpcy5fdGV4dENhbnZhcyA9IEMzJGpzY29tcCQ0Ny5DcmVhdGVDYW52YXMoMTYsIDE2KSk7CiAgICAgICAgbGV0IGQgPSAhMTsKICAgICAgICBpZiAodGhpcy5fbGFzdENhbnZhc1dpZHRoICE9PSBhIHx8CiAgICAgICAgICAgIHRoaXMuX2xhc3RDYW52YXNIZWlnaHQgIT09IGIpIHRoaXMuX2xhc3RDYW52YXNXaWR0aCA9IGEsIHRoaXMuX2xhc3RDYW52YXNIZWlnaHQgPSBiLCB0aGlzLl90ZXh0Q2FudmFzLndpZHRoID0gYSwgdGhpcy5fdGV4dENhbnZhcy5oZWlnaHQgPSBiLCBkID0gITA7CiAgICAgICAgdGhpcy5fdGV4dENvbnRleHQgfHwgKHRoaXMuX3RleHRDb250ZXh0ID0gdGhpcy5fdGV4dENhbnZhcy5nZXRDb250ZXh0KCIyZCIpLCBkID0gITApOwogICAgICAgIGQgPyAodGhpcy5fdGV4dENvbnRleHQudGV4dEJhc2VsaW5lID0gdGhpcy5faXNCQmNvZGVFbmFibGVkID8gImFscGhhYmV0aWMiIDogInRvcCIsIHRoaXMuX3RleHRDb250ZXh0LmZvbnQgPSB0aGlzLl9sYXN0VGV4dENhbnZhc0ZvbnQsIHRoaXMuX3RleHRDb250ZXh0LmZpbGxTdHlsZSA9IHRoaXMuX2xhc3RUZXh0Q2FudmFzRmlsbFN0eWxlLCB0aGlzLl90ZXh0Q29udGV4dC5zdHJva2VTdHlsZSA9IHRoaXMuX2xhc3RUZXh0Q2FudmFzRmlsbFN0eWxlLCB0aGlzLl90ZXh0Q29udGV4dC5nbG9iYWxBbHBoYSA9IHRoaXMuX2xhc3RUZXh0Q2FudmFzT3BhY2l0eSwKICAgICAgICAgICAgdGhpcy5fdGV4dENvbnRleHQubGluZVdpZHRoID0gdGhpcy5fbGFzdFRleHRDYW52YXNMaW5lV2lkdGgpIDogdGhpcy5fdGV4dENvbnRleHQuY2xlYXJSZWN0KDAsIDAsIGEsIGIpCiAgICB9CiAgICBfTWF5YmVDcmVhdGVNZWFzdXJlQ29udGV4dCgpIHsKICAgICAgICB0aGlzLl9tZWFzdXJlQ29udGV4dCB8fCAodGhpcy5fbWVhc3VyZUNvbnRleHQgPSBDMyRqc2NvbXAkNDcuQ3JlYXRlQ2FudmFzKDE2LCAxNikuZ2V0Q29udGV4dCgiMmQiKSwgdGhpcy5fbWVhc3VyZUNvbnRleHRUb3AgPSBDMyRqc2NvbXAkNDcuQ3JlYXRlQ2FudmFzKDE2LCAxNikuZ2V0Q29udGV4dCgiMmQiKSwgdGhpcy5fbWVhc3VyZUNvbnRleHQudGV4dEJhc2VsaW5lID0gdGhpcy5faXNCQmNvZGVFbmFibGVkID8gImFscGhhYmV0aWMiIDogInRvcCIsIHRoaXMuX21lYXN1cmVDb250ZXh0VG9wLnRleHRCYXNlbGluZSA9ICJ0b3AiKQogICAgfQogICAgX1NldE1lYXN1cmVGb250U3RyaW5nKGEpIHsKICAgICAgICB0aGlzLl9sYXN0TWVhc3VyZUNhbnZhc0ZvbnQgIT09IGEgJiYgKHRoaXMuX2xhc3RNZWFzdXJlQ2FudmFzRm9udCA9IGEsCiAgICAgICAgICAgIHRoaXMuX21lYXN1cmVDb250ZXh0LmZvbnQgPSBhLCB0aGlzLl9tZWFzdXJlQ29udGV4dFRvcC5mb250ID0gYSkKICAgIH0KICAgIF9TdXBwb3J0c0ZvbnRCb3VuZGluZ0JveE1lYXN1cmVtZW50cygpIHsKICAgICAgICBpZiAoIWRpZENoZWNrRm91bmRCb3VuZGluZ0JveFN1cHBvcnQpIHsKICAgICAgICAgICAgZGlkQ2hlY2tGb3VuZEJvdW5kaW5nQm94U3VwcG9ydCA9ICEwOwogICAgICAgICAgICB0aGlzLl9NYXliZUNyZWF0ZU1lYXN1cmVDb250ZXh0KCk7CiAgICAgICAgICAgIGNvbnN0IGEgPSB0aGlzLl9tZWFzdXJlQ29udGV4dC5tZWFzdXJlVGV4dCgidGVzdCIpOwogICAgICAgICAgICBzdXBwb3J0c0ZvbnRCb3VuZGluZ0JveE1lYXN1cmVtZW50cyA9ICJudW1iZXIiID09PSB0eXBlb2YgYS5mb250Qm91bmRpbmdCb3hBc2NlbnQgJiYgIm51bWJlciIgPT09IHR5cGVvZiBhLmZvbnRCb3VuZGluZ0JveERlc2NlbnQKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHN1cHBvcnRzRm9udEJvdW5kaW5nQm94TWVhc3VyZW1lbnRzCiAgICB9CiAgICBfTWF5YmVXcmFwVGV4dCgpIHsKICAgICAgICB0aGlzLl90ZXh0Q2hhbmdlZCAmJiAodGhpcy5fTWF5YmVDcmVhdGVNZWFzdXJlQ29udGV4dCgpLCAhdGhpcy5faXNCQmNvZGVFbmFibGVkIHx8CiAgICAgICAgICAgIHRoaXMuX2JiU3RyaW5nICYmIHRoaXMuX2JiU3RyaW5nLnRvU3RyaW5nKCkgPT09IHRoaXMuX3RleHQgfHwgKHRoaXMuX2JiU3RyaW5nID0gbmV3IEMzJGpzY29tcCQ0Ny5CQlN0cmluZyh0aGlzLl90ZXh0LCB7CiAgICAgICAgICAgICAgICBub0VzY2FwZTogITAKICAgICAgICAgICAgfSkpLCB0aGlzLl93cmFwcGVkVGV4dC5Xb3JkV3JhcCh0aGlzLl9pc0JCY29kZUVuYWJsZWQgPyB0aGlzLl9iYlN0cmluZy50b0ZyYWdtZW50TGlzdCgpIDogdGhpcy5fdGV4dCwgdGhpcy5fbWVhc3VyZVRleHRDYWxsYmFjaywgdGhpcy5fY3NzV2lkdGgsIHRoaXMuX3dyYXBNb2RlLCAwKSwgdGhpcy5fdGV4dENoYW5nZWQgPSAhMSkKICAgIH0KICAgIF9NZWFzdXJlVGV4dChhLCBiKSB7CiAgICAgICAgYSA9IGEuam9pbigiIik7CiAgICAgICAgdGhpcy5fU2V0TWVhc3VyZUZvbnRTdHJpbmcodGhpcy5fR2V0Rm9udFN0cmluZyghMCwgYikpOwogICAgICAgIGIgPSB0aGlzLl9HZXRTdHlsZVRhZyhiLCAic2l6ZSIpOwogICAgICAgIGIgPSAoYiA/IHBhcnNlRmxvYXQoYi5wYXJhbSkgOiB0aGlzLl9mb250U2l6ZSkgKiB0aGlzLl9mb250U2l6ZVNjYWxlOwogICAgICAgIGNvbnN0IGQgPSB0aGlzLl9tZWFzdXJlQ29udGV4dC5tZWFzdXJlVGV4dChhKTsKICAgICAgICBsZXQgYyA9IDA7CiAgICAgICAgdGhpcy5faXNCQmNvZGVFbmFibGVkICYmIHRoaXMuX1N1cHBvcnRzRm9udEJvdW5kaW5nQm94TWVhc3VyZW1lbnRzKCkgJiYgKGEgPSB0aGlzLl9tZWFzdXJlQ29udGV4dFRvcC5tZWFzdXJlVGV4dChhKSwgYyA9IGQuZm9udEJvdW5kaW5nQm94QXNjZW50IC0gYS5mb250Qm91bmRpbmdCb3hBc2NlbnQpOwogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHdpZHRoOiBkLndpZHRoLAogICAgICAgICAgICBoZWlnaHQ6IHB0VG9QeChiKSwKICAgICAgICAgICAgZm9udEJvdW5kaW5nQm94QXNjZW50OiBkLmZvbnRCb3VuZGluZ0JveEFzY2VudCB8fCAwLAogICAgICAgICAgICBmb250Qm91bmRpbmdCb3hEZXNjZW50OiBkLmZvbnRCb3VuZGluZ0JveERlc2NlbnQgfHwgMCwKICAgICAgICAgICAgdG9wVG9BbHBoYWJldGljRGlzdGFuY2U6IGMKICAgICAgICB9CiAgICB9CiAgICBfU2V0RHJhd0ZvbnRTdHJpbmcoYSkgewogICAgICAgIHRoaXMuX2xhc3RUZXh0Q2FudmFzRm9udCAhPT0gYSAmJiAodGhpcy5fbGFzdFRleHRDYW52YXNGb250ID0gYSwgdGhpcy5fdGV4dENvbnRleHQuZm9udCA9IGEpCiAgICB9CiAgICBfU2V0RHJhd0NhbnZhc0NvbG9yKGEpIHsKICAgICAgICB0aGlzLl9sYXN0VGV4dENhbnZhc0ZpbGxTdHlsZSAhPT0gYSAmJiAodGhpcy5fbGFzdFRleHRDYW52YXNGaWxsU3R5bGUgPQogICAgICAgICAgICBhLCB0aGlzLl90ZXh0Q29udGV4dC5maWxsU3R5bGUgPSBhLCB0aGlzLl90ZXh0Q29udGV4dC5zdHJva2VTdHlsZSA9IGEpCiAgICB9CiAgICBfU2V0RHJhd0NhbnZhc09wYWNpdHkoYSkgewogICAgICAgIHRoaXMuX2xhc3RUZXh0Q2FudmFzT3BhY2l0eSAhPT0gYSAmJiAodGhpcy5fbGFzdFRleHRDYW52YXNPcGFjaXR5ID0gYSwgdGhpcy5fdGV4dENvbnRleHQuZ2xvYmFsQWxwaGEgPSBhKQogICAgfQogICAgX1NldERyYXdDYW52YXNMaW5lV2l0aChhKSB7CiAgICAgICAgdGhpcy5fbGFzdFRleHRDYW52YXNMaW5lV2lkdGggIT09IGEgJiYgKHRoaXMuX2xhc3RUZXh0Q2FudmFzTGluZVdpZHRoID0gYSwgdGhpcy5fdGV4dENvbnRleHQubGluZVdpZHRoID0gYSkKICAgIH0KICAgIF9EcmF3VGV4dFRvQ2FudmFzKCkgewogICAgICAgIHRoaXMuX2RyYXdDaGFyQ291bnQgPSAwOwogICAgICAgIGNvbnN0IGEgPSB0aGlzLl9zY2FsZUZhY3RvciAqIHRoaXMuX3pvb20gKiBzZWxmLmRldmljZVBpeGVsUmF0aW8sCiAgICAgICAgICAgIGIgPSAoNCArIHRoaXMuX2xpbmVIZWlnaHQpICogYTsKICAgICAgICB2YXIgZCA9IDA7CiAgICAgICAgY29uc3QgYyA9IHRoaXMuX3dyYXBwZWRUZXh0LkdldExpbmVzKCk7CiAgICAgICAgaWYgKDAgIT09IGMubGVuZ3RoKSB7CiAgICAgICAgICAgIHZhciBlID0KICAgICAgICAgICAgICAgIHRoaXMuX2lzQkJjb2RlRW5hYmxlZCAmJiB0aGlzLl9TdXBwb3J0c0ZvbnRCb3VuZGluZ0JveE1lYXN1cmVtZW50cygpLAogICAgICAgICAgICAgICAgZyA9IGNbMF0uaGVpZ2h0ICogYTsKICAgICAgICAgICAgImNlbnRlciIgPT09IHRoaXMuX3ZlcnRpY2FsQWxpZ24gPyAoZCA9IGMucmVkdWNlKChrLCBtKSA9PiBrICsgbS5oZWlnaHQgKiBhICsgYiwgMCkgLSBiLCBkID0gTWF0aC5tYXgodGhpcy5faGVpZ2h0IC8gMiAtIGQgLyAyLCAwKSwgZSAmJiAoZyA9IGNbMF0udG9wVG9BbHBoYWJldGljRGlzdGFuY2UgKiBhKSkgOiAiYm90dG9tIiA9PT0gdGhpcy5fdmVydGljYWxBbGlnbiAmJiAoZCA9IGMucmVkdWNlKChrLCBtKSA9PiBrICsgbS5oZWlnaHQgKiBhICsgYiwgMCkgLSB0aGlzLl9saW5lSGVpZ2h0ICogYSwgZSA9IGUgPyBjLmF0KC0xKS5mb250Qm91bmRpbmdCb3hEZXNjZW50ICogYSA6IDAsIGQgPSB0aGlzLl9oZWlnaHQgLSBkIC0gZSAtIDIpOwogICAgICAgICAgICBmb3IgKGxldCBrID0gMCwgbSA9IGMubGVuZ3RoOyBrIDwgbTsgKytrKSB7CiAgICAgICAgICAgICAgICBlID0gY1trXTsKICAgICAgICAgICAgICAgIGNvbnN0IG4gPSBlLmhlaWdodCAqIGEsCiAgICAgICAgICAgICAgICAgICAgcSA9IGQ7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5faXNCQmNvZGVFbmFibGVkKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGQgKz0gMCA9PT0gayA/IGcgOiBuLCAwIDwgayAmJiBkID4gdGhpcy5faGVpZ2h0IC0gNCAqCiAgICAgICAgICAgICAgICAgICAgICAgIGEpIGJyZWFrCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKDAgPCBrICYmIGQgPj0gdGhpcy5faGVpZ2h0IC0gbikgYnJlYWs7CiAgICAgICAgICAgICAgICAwIDw9IHEgJiYgdGhpcy5fRHJhd1RleHRMaW5lKGUsIGQsIGEpOwogICAgICAgICAgICAgICAgdGhpcy5faXNCQmNvZGVFbmFibGVkIHx8IChkICs9IG4pOwogICAgICAgICAgICAgICAgZCArPSBiCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBfRHJhd1RleHRMaW5lKGEsIGIsIGQpIHsKICAgICAgICBsZXQgYyA9IDA7CiAgICAgICAgImNlbnRlciIgPT09IHRoaXMuX2hvcml6b250YWxBbGlnbiA/IGMgPSAodGhpcy5fd2lkdGggLSBhLndpZHRoICogZCkgLyAyIDogInJpZ2h0IiA9PT0gdGhpcy5faG9yaXpvbnRhbEFsaWduICYmIChjID0gdGhpcy5fd2lkdGggLSBhLndpZHRoICogZCk7CiAgICAgICAgZm9yIChjb25zdCBlIG9mIGEuZnJhZ21lbnRzKSB0aGlzLl9EcmF3VGV4dEZyYWdtZW50KGUsIGMsIGIsIGQsIGEuaGVpZ2h0KSwgYyArPSBlLndpZHRoICogZAogICAgfQogICAgX0RyYXdUZXh0RnJhZ21lbnQoYSwgYiwgZCwgYywgZSkgewogICAgICAgIGNvbnN0IGcgPSB0aGlzLl90ZXh0Q29udGV4dCwKICAgICAgICAgICAgayA9IGUgLyAxNjsKICAgICAgICBlID0gYS53aWR0aCAqIGM7CiAgICAgICAgY29uc3QgbSA9IGEuaGVpZ2h0ICogYywKICAgICAgICAgICAgbiA9IGEuaGVpZ2h0IC8gMTY7CiAgICAgICAgdmFyIHEgPSAoNCArIHRoaXMuX2xpbmVIZWlnaHQpICogYywKICAgICAgICAgICAgdSA9IGEuc3R5bGVzLAogICAgICAgICAgICB3ID0gYS5jaEFycjsKICAgICAgICBpZiAoLTEgIT09IHRoaXMuX2RyYXdNYXhDaGFyQ291bnQpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX2RyYXdDaGFyQ291bnQgPj0gdGhpcy5fZHJhd01heENoYXJDb3VudCkgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl9kcmF3Q2hhckNvdW50ICsgdy5sZW5ndGggPiB0aGlzLl9kcmF3TWF4Q2hhckNvdW50ICYmICh3ID0gdy5zbGljZSgwLCB0aGlzLl9kcmF3TWF4Q2hhckNvdW50IC0gdGhpcy5fZHJhd0NoYXJDb3VudCksIGUgPSB0aGlzLl9NZWFzdXJlVGV4dCh3LCB1KS53aWR0aCAqIGMpOwogICAgICAgICAgICB0aGlzLl9kcmF3Q2hhckNvdW50ICs9IHcubGVuZ3RoCiAgICAgICAgfQogICAgICAgIHZhciB6ID0gdGhpcy5fR2V0U3R5bGVUYWcodSwgImJhY2tncm91bmQiKTsKICAgICAgICBhID0gdGhpcy5fSGFzU3R5bGVUYWcodSwgInUiKTsKICAgICAgICBjb25zdCBDID0gdGhpcy5fSGFzU3R5bGVUYWcodSwgInMiKTsKICAgICAgICBpZiAoKCFDMyRqc2NvbXAkNDcuSXNDaGFyQXJyYXlBbGxXaGl0ZXNwYWNlKHcpIHx8IHogfHwgYSB8fCBDKSAmJiAhdGhpcy5fSGFzU3R5bGVUYWcodSwgImhpZGUiKSkgewogICAgICAgICAgICB3ID0gdy5qb2luKCIiKTsKICAgICAgICAgICAgdmFyIEQgPSB0aGlzLl9HZXRTdHlsZVRhZyh1LCAib2Zmc2V0eCIpOwogICAgICAgICAgICBiICs9IEQgPwogICAgICAgICAgICAgICAgcGFyc2VGbG9hdChELnBhcmFtKSAqIGMgOiAwOwogICAgICAgICAgICBEID0gdGhpcy5fR2V0U3R5bGVUYWcodSwgIm9mZnNldHkiKTsKICAgICAgICAgICAgZCArPSBEID8gcGFyc2VGbG9hdChELnBhcmFtKSAqIGMgOiAwOwogICAgICAgICAgICB6ICYmICh0aGlzLl9TZXREcmF3Q2FudmFzQ29sb3Ioei5wYXJhbSksIGcuZmlsbFJlY3QoYiwgZCAtIG0sIGUsIG0gKyBxKSk7CiAgICAgICAgICAgIHEgPSB0aGlzLl9HZXRTdHlsZVRhZyh1LCAiY29sb3IiKTsKICAgICAgICAgICAgdGhpcy5fU2V0RHJhd0NhbnZhc0NvbG9yKHEgPyBxLnBhcmFtIDogdGhpcy5fY29sb3JTdHIpOwogICAgICAgICAgICB6ID0gdGhpcy5fR2V0U3R5bGVUYWcodSwgIm9wYWNpdHkiKTsKICAgICAgICAgICAgdGhpcy5fU2V0RHJhd0NhbnZhc09wYWNpdHkoeiA/IHBhcnNlRmxvYXQoei5wYXJhbSkgLyAxMDAgOiAxKTsKICAgICAgICAgICAgeiA9ICh6ID0gdGhpcy5fR2V0U3R5bGVUYWcodSwgImxpbmV0aGlja25lc3MiKSkgPyBwYXJzZUZsb2F0KHoucGFyYW0pIDogMTsKICAgICAgICAgICAgKEQgPSB0aGlzLl9IYXNTdHlsZVRhZyh1LCAic3Ryb2tlIikpICYmIHRoaXMuX1NldERyYXdDYW52YXNMaW5lV2l0aCguNSAqIG4gKiB6ICogdGhpcy5fc2NhbGVGYWN0b3IgKiB0aGlzLl96b29tICogc2VsZi5kZXZpY2VQaXhlbFJhdGlvKTsKICAgICAgICAgICAgdGhpcy5fU2V0RHJhd0ZvbnRTdHJpbmcodGhpcy5fR2V0Rm9udFN0cmluZyghMSwgdSkpOwogICAgICAgICAgICBmaWxsT3JTdHJva2VUZXh0KGcsIEQsIHcsIGIsIGQsIGUpOwogICAgICAgICAgICAhRCAmJiAodGhpcy5fU2V0RHJhd0NhbnZhc0xpbmVXaXRoKC41ICogbiAqIHogKiB0aGlzLl9zY2FsZUZhY3RvciAqIHRoaXMuX3pvb20gKiBzZWxmLmRldmljZVBpeGVsUmF0aW8pLCB1ID0gdGhpcy5fR2V0U3R5bGVUYWcodSwgIm91dGxpbmUiKSkgJiYgKHRoaXMuX1NldERyYXdDYW52YXNDb2xvcih1LnBhcmFtKSwgZmlsbE9yU3Ryb2tlVGV4dChnLCAhMCwgdywgYiwgZCwgZSkpOwogICAgICAgICAgICB0aGlzLl9TZXREcmF3Q2FudmFzQ29sb3IocSA/IHEucGFyYW0gOiB0aGlzLl9jb2xvclN0cik7CiAgICAgICAgICAgIGEgJiYgZmlsbE9yU3Ryb2tlUmVjdChnLCBELCBiLCBkICsgYyAqIGssIGUsIGMgKiBrICogeik7CiAgICAgICAgICAgIEMgJiYgKGMgKj0gbiwgZy5maWxsUmVjdChiLCBkIC0gbSAvIDQgKyBjIC8gMiAtIGMgKiB6IC8gMiwgZSwgYyAqIHopKQogICAgICAgIH0KICAgIH0KICAgIF9VcGRhdGVUZXh0dXJlKCkgewogICAgICAgIGlmICghdGhpcy5fcmVuZGVyZXIuSXNDb250ZXh0TG9zdCgpICYmICh0aGlzLl90ZXh0dXJlV2lkdGggPSBNYXRoLmNlaWwodGhpcy5fd2lkdGgpLAogICAgICAgICAgICAgICAgdGhpcy5fdGV4dHVyZUhlaWdodCA9IE1hdGguY2VpbCh0aGlzLl9oZWlnaHQpLCB0aGlzLl9yY1RleC5zZXQoMCwgMCwgdGhpcy5fd2lkdGggLyB0aGlzLl90ZXh0dXJlV2lkdGgsIHRoaXMuX2hlaWdodCAvIHRoaXMuX3RleHR1cmVIZWlnaHQpLCB0aGlzLl9uZWVkVG9SZWNyZWF0ZVRleHR1cmUgJiYgKHRoaXMuUmVsZWFzZVRleHR1cmUoKSwgdGhpcy5fbmVlZFRvUmVjcmVhdGVUZXh0dXJlID0gITEpLCB0aGlzLl90ZXh0dXJlIHx8ICh0aGlzLl90ZXh0dXJlID0gdGhpcy5fcmVuZGVyZXIuQ3JlYXRlRHluYW1pY1RleHR1cmUodGhpcy5fdGV4dHVyZVdpZHRoLCB0aGlzLl90ZXh0dXJlSGVpZ2h0LCB7CiAgICAgICAgICAgICAgICAgICAgbWlwTWFwOiAxID09PSB0aGlzLl96b29tLAogICAgICAgICAgICAgICAgICAgIG1pcE1hcFF1YWxpdHk6ICJoaWdoIgogICAgICAgICAgICAgICAgfSkpLCB0aGlzLl9yZW5kZXJlci5VcGRhdGVUZXh0dXJlKHRoaXMuX3RleHRDYW52YXMsIHRoaXMuX3RleHR1cmUpLCB0aGlzLm9udGV4dHVyZXVwZGF0ZSkpIHRoaXMub250ZXh0dXJldXBkYXRlKCkKICAgIH0KICAgIEdldFRleFJlY3QoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3JjVGV4CiAgICB9CiAgICBSZWxlYXNlVGV4dHVyZSgpIHsKICAgICAgICB0aGlzLl90ZXh0dXJlICYmCiAgICAgICAgICAgICh0aGlzLl9yZW5kZXJlci5Jc0NvbnRleHRMb3N0KCkgfHwgdGhpcy5fcmVuZGVyZXIuRGVsZXRlVGV4dHVyZSh0aGlzLl90ZXh0dXJlKSwgdGhpcy5fdGV4dHVyZSA9IG51bGwpCiAgICB9CiAgICBzdGF0aWMgT25Db250ZXh0TG9zdCgpIHsKICAgICAgICBmb3IgKGNvbnN0IGEgb2YgYWxsUmVuZGVyZXJUZXh0cykgYS5SZWxlYXNlVGV4dHVyZSgpCiAgICB9CiAgICBzdGF0aWMgR2V0QWxsKCkgewogICAgICAgIHJldHVybiBhbGxSZW5kZXJlclRleHRzLnZhbHVlcygpCiAgICB9Cn07CiJ1c2Ugc3RyaWN0IjsKY29uc3QgQzMkanNjb21wJDQ4ID0gc2VsZi5DMzsKY2xhc3MgV2ViR0xSZWFsVGltZUVsYXBzZWRRdWVyeSB7CiAgICBjb25zdHJ1Y3RvcihhKSB7CiAgICAgICAgdGhpcy5fZ2wgPSBhLkdldENvbnRleHQoKTsKICAgICAgICB0aGlzLl92ZXJzaW9uID0gYS5HZXRXZWJHTFZlcnNpb25OdW1iZXIoKTsKICAgICAgICB0aGlzLl90aW1lckV4dCA9IGEuX0dldERpc2pvaW50VGltZXJRdWVyeUV4dGVuc2lvbigpOwogICAgICAgIHRoaXMuX3F1ZXJ5ID0gbnVsbDsKICAgICAgICB0aGlzLl9oYXNSZXN1bHQgPSB0aGlzLl9pc0FjdGl2ZSA9ICExOwogICAgICAgIHRoaXMuX3Jlc3VsdCA9IDA7CiAgICAgICAgdGhpcy5fcXVlcnkgPSAxID09PSB0aGlzLl92ZXJzaW9uID8gdGhpcy5fdGltZXJFeHQuY3JlYXRlUXVlcnlFWFQoKSA6IHRoaXMuX2dsLmNyZWF0ZVF1ZXJ5KCkKICAgIH0KICAgIFJlbGVhc2UoKSB7CiAgICAgICAgdGhpcy5fRGVsZXRlUXVlcnlPYmplY3QoKTsKICAgICAgICB0aGlzLl90aW1lckV4dCA9IHRoaXMuX2dsID0gbnVsbDsKICAgICAgICB0aGlzLl9oYXNSZXN1bHQgPSAhMQogICAgfQogICAgX0RlbGV0ZVF1ZXJ5T2JqZWN0KCkgewogICAgICAgIHRoaXMuX3F1ZXJ5ICYmICgxID09PSB0aGlzLl92ZXJzaW9uID8gdGhpcy5fdGltZXJFeHQuZGVsZXRlUXVlcnlFWFQodGhpcy5fcXVlcnkpIDogdGhpcy5fZ2wuZGVsZXRlUXVlcnkodGhpcy5fcXVlcnkpLAogICAgICAgICAgICB0aGlzLl9xdWVyeSA9IG51bGwpCiAgICB9CiAgICBCZWdpblRpbWVFbGFwc2VkKCkgewogICAgICAgIGlmICh0aGlzLl9pc0FjdGl2ZSkgdGhyb3cgRXJyb3IoInF1ZXJ5IGFscmVhZHkgYWN0aXZlIik7CiAgICAgICAgMSA9PT0gdGhpcy5fdmVyc2lvbiA/IHRoaXMuX3RpbWVyRXh0LmJlZ2luUXVlcnlFWFQodGhpcy5fdGltZXJFeHQuVElNRV9FTEFQU0VEX0VYVCwgdGhpcy5fcXVlcnkpIDogdGhpcy5fZ2wuYmVnaW5RdWVyeSh0aGlzLl90aW1lckV4dC5USU1FX0VMQVBTRURfRVhULCB0aGlzLl9xdWVyeSk7CiAgICAgICAgdGhpcy5faXNBY3RpdmUgPSAhMAogICAgfQogICAgRW5kVGltZUVsYXBzZWQoKSB7CiAgICAgICAgaWYgKCF0aGlzLl9pc0FjdGl2ZSkgdGhyb3cgRXJyb3IoInF1ZXJ5IG5vdCBhY3RpdmUiKTsKICAgICAgICAxID09PSB0aGlzLl92ZXJzaW9uID8gdGhpcy5fdGltZXJFeHQuZW5kUXVlcnlFWFQodGhpcy5fdGltZXJFeHQuVElNRV9FTEFQU0VEX0VYVCkgOiB0aGlzLl9nbC5lbmRRdWVyeSh0aGlzLl90aW1lckV4dC5USU1FX0VMQVBTRURfRVhUKTsKICAgICAgICB0aGlzLl9pc0FjdGl2ZSA9ICExCiAgICB9CiAgICBDaGVja0ZvclJlc3VsdCgpIHsKICAgICAgICBpZiAodGhpcy5fcXVlcnkgJiYKICAgICAgICAgICAgIXRoaXMuX2hhc1Jlc3VsdCAmJiAhdGhpcy5faXNBY3RpdmUpIHsKICAgICAgICAgICAgdmFyIGEgPSAxID09PSB0aGlzLl92ZXJzaW9uID8gdGhpcy5fdGltZXJFeHQuZ2V0UXVlcnlPYmplY3RFWFQodGhpcy5fcXVlcnksIHRoaXMuX3RpbWVyRXh0LlFVRVJZX1JFU1VMVF9BVkFJTEFCTEVfRVhUKSA6IHRoaXMuX2dsLmdldFF1ZXJ5UGFyYW1ldGVyKHRoaXMuX3F1ZXJ5LCB0aGlzLl9nbC5RVUVSWV9SRVNVTFRfQVZBSUxBQkxFKTsKICAgICAgICAgICAgdmFyIGIgPSB0aGlzLl9nbC5nZXRQYXJhbWV0ZXIodGhpcy5fdGltZXJFeHQuR1BVX0RJU0pPSU5UX0VYVCk7CiAgICAgICAgICAgIGEgJiYgIWIgJiYgKHRoaXMuX3Jlc3VsdCA9IDEgPT09IHRoaXMuX3ZlcnNpb24gPyB0aGlzLl90aW1lckV4dC5nZXRRdWVyeU9iamVjdEVYVCh0aGlzLl9xdWVyeSwgdGhpcy5fdGltZXJFeHQuUVVFUllfUkVTVUxUX0VYVCkgOiB0aGlzLl9nbC5nZXRRdWVyeVBhcmFtZXRlcih0aGlzLl9xdWVyeSwgdGhpcy5fZ2wuUVVFUllfUkVTVUxUKSwgdGhpcy5fcmVzdWx0IC89IDFFOSwgdGhpcy5faGFzUmVzdWx0ID0gITApOwogICAgICAgICAgICAoYSB8fAogICAgICAgICAgICAgICAgYikgJiYgdGhpcy5fRGVsZXRlUXVlcnlPYmplY3QoKQogICAgICAgIH0KICAgIH0KICAgIEhhc1Jlc3VsdCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5faGFzUmVzdWx0CiAgICB9CiAgICBHZXRSZXN1bHQoKSB7CiAgICAgICAgaWYgKCF0aGlzLl9oYXNSZXN1bHQpIHRocm93IEVycm9yKCJubyByZXN1bHQgYXZhaWxhYmxlIik7CiAgICAgICAgcmV0dXJuIHRoaXMuX3Jlc3VsdAogICAgfQp9CkMzJGpzY29tcCQ0OC5HZnguV2ViR0xUaW1lRWxhcHNlZFF1ZXJ5ID0gY2xhc3MgewogICAgY29uc3RydWN0b3IoYSkgewogICAgICAgIHRoaXMuX3JlbmRlcmVyID0gYTsKICAgICAgICB0aGlzLl9mcmFtZU51bWJlciA9IGEuR2V0RnJhbWVOdW1iZXIoKTsKICAgICAgICB0aGlzLl9pc0FjdGl2ZSA9ICExOwogICAgICAgIHRoaXMuX3BhcmVudFF1ZXJ5ID0gbnVsbDsKICAgICAgICB0aGlzLl9pc05lc3RlZCA9ICExOwogICAgICAgIHRoaXMuX3JlYWxRdWVyeSA9IG51bGw7CiAgICAgICAgdGhpcy5fcXVlcmllcyA9IFtdCiAgICB9CiAgICBSZWxlYXNlKCkgewogICAgICAgIGZvciAoY29uc3QgYSBvZiB0aGlzLl9xdWVyaWVzKSBhIGluc3RhbmNlb2YgV2ViR0xSZWFsVGltZUVsYXBzZWRRdWVyeSAmJiBhLlJlbGVhc2UoKTsKICAgICAgICBDMyRqc2NvbXAkNDguY2xlYXJBcnJheSh0aGlzLl9xdWVyaWVzKTsKICAgICAgICB0aGlzLl9yZW5kZXJlciA9IHRoaXMuX3JlYWxRdWVyeSA9IHRoaXMuX3BhcmVudFF1ZXJ5ID0gbnVsbAogICAgfQogICAgQmVnaW5UaW1lRWxhcHNlZCgpIHsKICAgICAgICBpZiAodGhpcy5faXNBY3RpdmUpIHRocm93IEVycm9yKCJxdWVyeSBhbHJlYWR5IGFjdGl2ZSIpOwogICAgICAgIGNvbnN0IGEgPSB0aGlzLl9yZW5kZXJlci5fR2V0VGltZVF1ZXJ5U3RhY2soKTsKICAgICAgICAwIDwgYS5sZW5ndGggPyAodGhpcy5faXNOZXN0ZWQgPSAhMCwgdGhpcy5fcGFyZW50UXVlcnkgPSBhLmF0KC0xKSwgdGhpcy5fcGFyZW50UXVlcnkuX0VuZFJlYWwoKSwgdGhpcy5fcGFyZW50UXVlcnkuX3F1ZXJpZXMucHVzaCh0aGlzKSkgOiAodGhpcy5faXNOZXN0ZWQgPSAhMSwgdGhpcy5fcGFyZW50UXVlcnkgPSBudWxsKTsKICAgICAgICB0aGlzLl9pc0FjdGl2ZSA9ICEwOwogICAgICAgIGEucHVzaCh0aGlzKTsKICAgICAgICB0aGlzLl9TdGFydFJlYWwoKQogICAgfQogICAgRW5kVGltZUVsYXBzZWQoKSB7CiAgICAgICAgaWYgKCF0aGlzLl9pc0FjdGl2ZSkgdGhyb3cgRXJyb3IoInF1ZXJ5IG5vdCBhY3RpdmUiKTsKICAgICAgICBpZiAodGhpcy5fcmVuZGVyZXIuX0dldFRpbWVRdWVyeVN0YWNrKCkucG9wKCkgIT09IHRoaXMpIHRocm93IEVycm9yKCJjYW4gb25seSBlbmQgbW9zdCBuZXN0ZWQgcXVlcnkiKTsKICAgICAgICB0aGlzLl9pc0FjdGl2ZSA9ICExOwogICAgICAgIHRoaXMuX0VuZFJlYWwoKTsKICAgICAgICB0aGlzLl9wYXJlbnRRdWVyeSAmJiAodGhpcy5fcGFyZW50UXVlcnkuX1N0YXJ0UmVhbCgpLCB0aGlzLl9wYXJlbnRRdWVyeSA9IG51bGwpCiAgICB9CiAgICBfU3RhcnRSZWFsKCkgewogICAgICAgIHRoaXMuX3JlYWxRdWVyeSA9CiAgICAgICAgICAgIEMzJGpzY29tcCQ0OC5OZXcoV2ViR0xSZWFsVGltZUVsYXBzZWRRdWVyeSwgdGhpcy5fcmVuZGVyZXIpOwogICAgICAgIHRoaXMuX3F1ZXJpZXMucHVzaCh0aGlzLl9yZWFsUXVlcnkpOwogICAgICAgIHRoaXMuX3JlYWxRdWVyeS5CZWdpblRpbWVFbGFwc2VkKCkKICAgIH0KICAgIF9FbmRSZWFsKCkgewogICAgICAgIHRoaXMuX3JlYWxRdWVyeS5FbmRUaW1lRWxhcHNlZCgpOwogICAgICAgIHRoaXMuX3JlYWxRdWVyeSA9IG51bGwKICAgIH0KICAgIENoZWNrRm9yUmVzdWx0KCkgewogICAgICAgIGZvciAoY29uc3QgYSBvZiB0aGlzLl9xdWVyaWVzKSBhLkNoZWNrRm9yUmVzdWx0KCkKICAgIH0KICAgIElzTmVzdGVkKCkgewogICAgICAgIHJldHVybiB0aGlzLl9pc05lc3RlZAogICAgfQogICAgSGFzUmVzdWx0KCkgewogICAgICAgIHJldHVybiB0aGlzLl9xdWVyaWVzLmV2ZXJ5KGEgPT4gYS5IYXNSZXN1bHQoKSkKICAgIH0KICAgIEdldFJlc3VsdCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcXVlcmllcy5yZWR1Y2UoKGEsIGIpID0+IGEgKyBiLkdldFJlc3VsdCgpLCAwKQogICAgfQogICAgR2V0RnJhbWVOdW1iZXIoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2ZyYW1lTnVtYmVyCiAgICB9Cn07CiJ1c2Ugc3RyaWN0IjsKY29uc3QgQzMkanNjb21wJDQ5ID0gc2VsZi5DMzsKQzMkanNjb21wJDQ5LkdmeC5XZWJHTFF1ZXJ5UmVzdWx0QnVmZmVyID0gY2xhc3MgewogICAgY29uc3RydWN0b3IoYSwgYiA9IDFFMykgewogICAgICAgIHRoaXMuX3JlbmRlcmVyID0gYTsKICAgICAgICB0aGlzLl9tYXhRdWVyaWVzID0gYjsKICAgICAgICB0aGlzLl9idWZmZXIgPSBbXTsKICAgICAgICB0aGlzLl9yZW5kZXJlci5fQWRkUXVlcnlSZXN1bHRCdWZmZXIodGhpcykKICAgIH0KICAgIFJlbGVhc2UoKSB7CiAgICAgICAgdGhpcy5DbGVhcigpOwogICAgICAgIHRoaXMuX3JlbmRlcmVyLl9SZW1vdmVRdWVyeVJlc3VsdEJ1ZmZlcih0aGlzKTsKICAgICAgICB0aGlzLl9yZW5kZXJlciA9IG51bGwKICAgIH0KICAgIENsZWFyKCkgewogICAgICAgIGZvciAoY29uc3QgYSBvZiB0aGlzLl9idWZmZXIpIGEuUmVsZWFzZSgpOwogICAgICAgIEMzJGpzY29tcCQ0OS5jbGVhckFycmF5KHRoaXMuX2J1ZmZlcikKICAgIH0KICAgIEFkZFRpbWVFbGFwc2VkUXVlcnkoKSB7CiAgICAgICAgY29uc3QgYSA9IG5ldyBDMyRqc2NvbXAkNDkuR2Z4LldlYkdMVGltZUVsYXBzZWRRdWVyeSh0aGlzLl9yZW5kZXJlcik7CiAgICAgICAgdGhpcy5fYnVmZmVyLnB1c2goYSk7CiAgICAgICAgdGhpcy5fYnVmZmVyLmxlbmd0aCA+IHRoaXMuX21heFF1ZXJpZXMgJiYgdGhpcy5fYnVmZmVyLnNoaWZ0KCkuUmVsZWFzZSgpOwogICAgICAgIHJldHVybiBhCiAgICB9CiAgICBDaGVja0ZvclJlc3VsdHMoYSkgewogICAgICAgIGZvciAoY29uc3QgYiBvZiB0aGlzLl9idWZmZXIpIHsKICAgICAgICAgICAgaWYgKGIuR2V0RnJhbWVOdW1iZXIoKSA+PSBhKSBicmVhazsKICAgICAgICAgICAgaWYgKGIuSXNOZXN0ZWQoKSkgYnJlYWs7CiAgICAgICAgICAgIGIuQ2hlY2tGb3JSZXN1bHQoKQogICAgICAgIH0KICAgIH0KICAgIEdldEZyYW1lUmFuZ2VSZXN1bHRTdW0oYSwgYikgewogICAgICAgIGlmIChiIDw9IGEpIHJldHVybiBOYU47CiAgICAgICAgbGV0IGQgPSAwOwogICAgICAgIGZvciAoY29uc3QgYyBvZiB0aGlzLl9idWZmZXIpIHsKICAgICAgICAgICAgaWYgKGMuR2V0RnJhbWVOdW1iZXIoKSA+PSBiKSBicmVhazsKICAgICAgICAgICAgaWYgKCEoYy5HZXRGcmFtZU51bWJlcigpIDwgYSkpCiAgICAgICAgICAgICAgICBpZiAoYy5IYXNSZXN1bHQoKSkgZCArPSBjLkdldFJlc3VsdCgpOwogICAgICAgICAgICAgICAgZWxzZSByZXR1cm4gTmFOCiAgICAgICAgfQogICAgICAgIHJldHVybiBkCiAgICB9CiAgICBEZWxldGVBbGxCZWZvcmVGcmFtZU51bWJlcihhKSB7CiAgICAgICAgZm9yIChsZXQgYiA9IDAsIGQgPSB0aGlzLl9idWZmZXIubGVuZ3RoOyBiIDwgZDsgKytiKSB7CiAgICAgICAgICAgIGNvbnN0IGMgPSB0aGlzLl9idWZmZXJbYl07CiAgICAgICAgICAgIGlmIChjLkdldEZyYW1lTnVtYmVyKCkgPCBhKSBjLlJlbGVhc2UoKTsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAwIDwgYiAmJiB0aGlzLl9idWZmZXIuc3BsaWNlKDAsIGIpOwogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfTsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkNTAgPSBzZWxmLkMzLAogICAgZ2xNYXRyaXgkanNjb21wJDYgPSBzZWxmLmdsTWF0cml4LAogICAgdmVjNCRqc2NvbXAkNCA9IGdsTWF0cml4JGpzY29tcCQ2LnZlYzQsCiAgICBtYXQ0JGpzY29tcCQ3ID0gZ2xNYXRyaXgkanNjb21wJDYubWF0NCwKICAgIERFRkFVTFRfV0VCR0xSRU5ERVJFUl9PUFRTID0gewogICAgICAgIHBvd2VyUHJlZmVyZW5jZTogImRlZmF1bHQiLAogICAgICAgIGVuYWJsZUdwdVByb2ZpbGluZzogITAsCiAgICAgICAgYWxwaGE6ICExLAogICAgICAgIGxvd0xhdGVuY3k6ICExLAogICAgICAgIGRlcHRoOiAhMSwKICAgICAgICBjYW5TYW1wbGVEZXB0aDogITEsCiAgICAgICAgbWF4V2ViR0xWZXJzaW9uOiAyLAogICAgICAgIGZhaWxJZk1ham9yUGVyZm9ybWFuY2VDYXZlYXQ6ICExCiAgICB9LAogICAgVkFMSURfUE9XRVJfUFJFRkVSRU5DRVMgPSBuZXcgU2V0KFsiZGVmYXVsdCIsICJsb3ctcG93ZXIiLCAiaGlnaC1wZXJmb3JtYW5jZSJdKSwKICAgIE1BWF9JTkRJQ0VTID0gMTJFMywKICAgIExBU1RfUE9JTlQgPSA3OTk2LAogICAgZGVmYXVsdFRleENvb3Jkc1F1YWQkanNjb21wJDEgPSBuZXcgQzMkanNjb21wJDUwLlF1YWQoMCwgMCwgMSwgMCwgMSwgMSwgMCwgMSksCiAgICB0bXBQcm9qZWN0aW9uID0KICAgIG1hdDQkanNjb21wJDcuY3JlYXRlKCksCiAgICB0bXBNb2RlbFZpZXcgPSBtYXQ0JGpzY29tcCQ3LmNyZWF0ZSgpLAogICAgdG1wUXVhZCRqc2NvbXAkMSA9IG5ldyBDMyRqc2NvbXAkNTAuUXVhZCwKICAgIHRtcFJlY3QkanNjb21wJDEgPSBuZXcgQzMkanNjb21wJDUwLlJlY3Q7CmxldCBsb3NlQ29udGV4dEV4dGVuc2lvbiA9IG51bGw7CkMzJGpzY29tcCQ1MC5pc0RlYnVnICYmIChzZWxmLmRlYnVnX2xvc2VfY29udGV4dCA9IGZ1bmN0aW9uKCkgewogICAgbG9zZUNvbnRleHRFeHRlbnNpb24gPyBsb3NlQ29udGV4dEV4dGVuc2lvbi5sb3NlQ29udGV4dCgpIDogY29uc29sZS53YXJuKCJXRUJHTF9sb3NlX2NvbnRleHQgbm90IHN1cHBvcnRlZCIpCn0sIHNlbGYuZGVidWdfcmVzdG9yZV9jb250ZXh0ID0gZnVuY3Rpb24oKSB7CiAgICBsb3NlQ29udGV4dEV4dGVuc2lvbiA/IGxvc2VDb250ZXh0RXh0ZW5zaW9uLnJlc3RvcmVDb250ZXh0KCkgOiBjb25zb2xlLndhcm4oIldFQkdMX2xvc2VfY29udGV4dCBub3Qgc3VwcG9ydGVkIikKfSk7CmNvbnN0IHBlbmRpbmdQb2xscyA9IG5ldyBTZXQ7CmxldCBwb2xsUmFmSWQgPSAtMTsKCmZ1bmN0aW9uIENoZWNrUGVuZGluZ1BvbGxzKCkgewogICAgcG9sbFJhZklkID0gLTE7CiAgICBmb3IgKGNvbnN0IGEgb2YgcGVuZGluZ1BvbGxzKSBhLmNoZWNrRnVuYygpICYmIChhLnJlc29sdmUoKSwgcGVuZGluZ1BvbGxzLmRlbGV0ZShhKSk7CiAgICAwIDwgcGVuZGluZ1BvbGxzLnNpemUgJiYgKHBvbGxSYWZJZCA9IHNlbGYucmVxdWVzdEFuaW1hdGlvbkZyYW1lKENoZWNrUGVuZGluZ1BvbGxzKSkKfQpDMyRqc2NvbXAkNTAuR2Z4LldlYkdMUmVuZGVyZXIgPSBjbGFzcyBleHRlbmRzIEMzJGpzY29tcCQ1MC5HZnguUmVuZGVyZXJCYXNlIHsKICAgIGNvbnN0cnVjdG9yKGEsIGIpIHsKICAgICAgICBzdXBlcigpOwogICAgICAgIGIgPSBPYmplY3QuYXNzaWduKHt9LCBERUZBVUxUX1dFQkdMUkVOREVSRVJfT1BUUywgYik7CiAgICAgICAgaWYgKCFWQUxJRF9QT1dFUl9QUkVGRVJFTkNFUy5oYXMoYi5wb3dlclByZWZlcmVuY2UpKSB0aHJvdyBFcnJvcigiaW52YWxpZCBwb3dlciBwcmVmZXJlbmNlIik7CiAgICAgICAgY29uc3QgZCA9IHsKICAgICAgICAgICAgYWxwaGE6ICEhYi5hbHBoYSwKICAgICAgICAgICAgZGVwdGg6ICExLAogICAgICAgICAgICBhbnRpYWxpYXM6ICExLAogICAgICAgICAgICBwb3dlclByZWZlcmVuY2U6IGIucG93ZXJQcmVmZXJlbmNlLAogICAgICAgICAgICBmYWlsSWZNYWpvclBlcmZvcm1hbmNlQ2F2ZWF0OiAhIWIuZmFpbElmTWFqb3JQZXJmb3JtYW5jZUNhdmVhdAogICAgICAgIH07CiAgICAgICAgYi5sb3dMYXRlbmN5ICYmIChkLmRlc3luY2hyb25pemVkID0gITAsIGQucHJlc2VydmVEcmF3aW5nQnVmZmVyID0gITApOwogICAgICAgIGxldCBjID0gbnVsbCwKICAgICAgICAgICAgZSA9IDA7CiAgICAgICAgMiA8PSBiLm1heFdlYkdMVmVyc2lvbiAmJiAoYyA9IGEuZ2V0Q29udGV4dCgid2ViZ2wyIiwKICAgICAgICAgICAgZCksIGUgPSAyKTsKICAgICAgICBjIHx8IChjID0gYS5nZXRDb250ZXh0KCJ3ZWJnbCIsIGQpLCBlID0gMSk7CiAgICAgICAgaWYgKCFjKSB0aHJvdyBFcnJvcigiZmFpbGVkIHRvIGluaXRpYWxpc2UgV2ViR0wgY29udGV4dCIpOwogICAgICAgIHRoaXMuX2dsID0gYzsKICAgICAgICB0aGlzLl9hdHRyaWJzID0gYy5nZXRDb250ZXh0QXR0cmlidXRlcygpOwogICAgICAgIGIubG93TGF0ZW5jeSAmJiAhdGhpcy5fYXR0cmlicy5kZXN5bmNocm9uaXplZCAmJiBjb25zb2xlLmluZm8oIltXZWJHTFJlbmRlcmVyXSBMb3ctbGF0ZW5jeSBtb2RlIHNwZWNpZmllZCBidXQgaXMgbm90IHN1cHBvcnRlZCBoZXJlIik7CiAgICAgICAgdGhpcy5fdmVyc2lvblN0cmluZyA9IGMuZ2V0UGFyYW1ldGVyKGMuVkVSU0lPTik7CiAgICAgICAgdGhpcy5fdmVyc2lvbiA9IGU7CiAgICAgICAgdGhpcy5fdmlld3BvcnQgPSB2ZWM0JGpzY29tcCQ0LmNyZWF0ZSgpOwogICAgICAgIHRoaXMuX2RpZENoYW5nZVRyYW5zZm9ybSA9ICExOwogICAgICAgIHRoaXMuX2JiUHJvamVjdGlvbk1hdHJpeCA9IG1hdDQkanNjb21wJDcuY3JlYXRlKCk7CiAgICAgICAgdGhpcy5fdXNlc0RlcHRoQnVmZmVyID0gISFiLmRlcHRoOwogICAgICAgIHRoaXMuX2NhblNhbXBsZURlcHRoID0gISghYi5kZXB0aCB8fCAhYi5jYW5TYW1wbGVEZXB0aCk7CiAgICAgICAgdGhpcy5faXNEZXB0aEVuYWJsZWQgPSB0aGlzLl91c2VzRGVwdGhCdWZmZXI7CiAgICAgICAgdGhpcy5faXNEZXB0aFNhbXBsaW5nRW5hYmxlZCA9ICExOwogICAgICAgIHRoaXMuX2RlcHRoQnVmZmVyID0gbnVsbDsKICAgICAgICB0aGlzLl9pc0F1dG9TaXplRGVwdGhCdWZmZXIgPSAhMDsKICAgICAgICB0aGlzLl9kZXB0aEJ1ZmZlckhlaWdodCA9IHRoaXMuX2RlcHRoQnVmZmVyV2lkdGggPSAwOwogICAgICAgIHRoaXMuX3BvaW50QnVmZmVyID0gdGhpcy5faW5kZXhCdWZmZXIgPSB0aGlzLl90ZXhjb29yZEJ1ZmZlciA9IHRoaXMuX3ZlcnRleEJ1ZmZlciA9IG51bGw7CiAgICAgICAgdGhpcy5fdmVydGV4RGF0YSA9IG5ldyBGbG9hdDMyQXJyYXkoOEUzICogdGhpcy5HZXROdW1WZXJ0ZXhDb21wb25lbnRzKCkpOwogICAgICAgIHRoaXMuX2luZGV4RGF0YSA9IG5ldyBVaW50MTZBcnJheShNQVhfSU5ESUNFUyk7CiAgICAgICAgdGhpcy5fdGV4Y29vcmREYXRhID0gbmV3IEZsb2F0MzJBcnJheSgxNkUzKTsKICAgICAgICB0aGlzLl9wb2ludERhdGEgPSBuZXcgRmxvYXQzMkFycmF5KDMyRTMpOwogICAgICAgIHRoaXMuX2xhc3RWZXJ0ZXhQdHIgPQogICAgICAgICAgICB0aGlzLl9wb2ludFB0ciA9IHRoaXMuX3RleFB0ciA9IHRoaXMuX3ZlcnRleFB0ciA9IDA7CiAgICAgICAgdGhpcy5fc3BEZXZpY2VUcmFuc2Zvcm1UZXh0dXJlRmlsbCA9IHRoaXMuX2xhc3RQcm9ncmFtID0gbnVsbDsKICAgICAgICB0aGlzLl9iYXRjaCA9IFtdOwogICAgICAgIHRoaXMuX3RvcE9mQmF0Y2ggPSB0aGlzLl9iYXRjaFB0ciA9IDA7CiAgICAgICAgdGhpcy5fY3VycmVudFJlbmRlclRhcmdldCA9IG51bGw7CiAgICAgICAgdGhpcy5fbGFzdFBvaW50WiA9IDA7CiAgICAgICAgdGhpcy5fYmF0Y2hTdGF0ZSA9IEMzJGpzY29tcCQ1MC5OZXcoQzMkanNjb21wJDUwLkdmeC5CYXRjaFN0YXRlLCB0aGlzKTsKICAgICAgICB0aGlzLl9sYXN0Q29sb3IgPSBDMyRqc2NvbXAkNTAuTmV3KEMzJGpzY29tcCQ1MC5Db2xvciwgMSwgMSwgMSwgMSk7CiAgICAgICAgdGhpcy5fbGFzdFRleHR1cmUxID0gdGhpcy5fbGFzdFRleHR1cmUwID0gbnVsbDsKICAgICAgICB0aGlzLl9sYXN0RGVzdEJsZW5kID0gdGhpcy5fbGFzdFNyY0JsZW5kID0gMDsKICAgICAgICB0aGlzLl9sYXN0UG9pbnRUZXhDb29yZHMgPSBuZXcgQzMkanNjb21wJDUwLlJlY3Q7CiAgICAgICAgdGhpcy5fbGFzdFNjaXNzb3JSZWN0ID0gQzMkanNjb21wJDUwLk5ldyhDMyRqc2NvbXAkNTAuUmVjdCwKICAgICAgICAgICAgMCwgMCwgLTEsIC0xKTsKICAgICAgICB0aGlzLl9tYXhUZXh0dXJlU2l6ZSA9IC0xOwogICAgICAgIHRoaXMuX2hpZ2hwUHJlY2lzaW9uID0gdGhpcy5fbWF4UG9pbnRTaXplID0gdGhpcy5fbWluUG9pbnRTaXplID0gMDsKICAgICAgICB0aGlzLl91bm1hc2tlZFJlbmRlcmVyID0gdGhpcy5fdW5tYXNrZWRWZW5kb3IgPSAiKHVuYXZhaWxhYmxlKSI7CiAgICAgICAgdGhpcy5fZXh0ZW5zaW9ucyA9IFtdOwogICAgICAgIHRoaXMuX2lzSW5pdGlhbGlzaW5nQWZ0ZXJDb250ZXh0UmVzdG9yZWQgPSAhMTsKICAgICAgICB0aGlzLl9mcmFnRGVwdGhFeHQgPSB0aGlzLl9kZXB0aFRleHR1cmVFeHQgPSB0aGlzLl9hbmlzb3Ryb3BpY0V4dCA9IHRoaXMuX3BhcmFsbGVsU2hhZGVyQ29tcGlsZUV4dCA9IG51bGw7CiAgICAgICAgdGhpcy5fbWF4QW5pc290cm9weSA9IDA7CiAgICAgICAgdGhpcy5faXNHcHVQcm9maWxpbmdFbmFibGVkID0gISFiLmVuYWJsZUdwdVByb2ZpbGluZzsKICAgICAgICB0aGlzLl90aW1lckV4dCA9IG51bGw7CiAgICAgICAgdGhpcy5fYWxsUXVlcnlSZXN1bHRCdWZmZXJzID0gbmV3IFNldDsKICAgICAgICB0aGlzLl90aW1lUXVlcnlTdGFjayA9IFtdOwogICAgICAgIHRoaXMuRmlsbEluZGV4QnVmZmVyRGF0YSh0aGlzLl9pbmRleERhdGEpCiAgICB9CiAgICBJc1dlYkdMKCkgewogICAgICAgIHJldHVybiAhMAogICAgfQogICAgYXN5bmMgSW5pdFN0YXRlKCkgewogICAgICAgIHN1cGVyLkluaXRTdGF0ZSgpOwogICAgICAgIHZhciBhID0gdGhpcy5fZ2wsCiAgICAgICAgICAgIGIgPSB0aGlzLkdldE51bVZlcnRleENvbXBvbmVudHMoKTsKICAgICAgICB0aGlzLl9sYXN0Q29sb3Iuc2V0UmdiYSgxLCAxLCAxLCAxKTsKICAgICAgICB0aGlzLl9sYXN0VGV4dHVyZTEgPSB0aGlzLl9sYXN0VGV4dHVyZTAgPSBudWxsOwogICAgICAgIHRoaXMuX3BvaW50UHRyID0gdGhpcy5fdmVydGV4UHRyID0gMDsKICAgICAgICB0aGlzLl9sYXN0VmVydGV4UHRyID0gOEUzICogYiAtIDQgKiBiOwogICAgICAgIEMzJGpzY29tcCQ1MC5jbGVhckFycmF5KHRoaXMuX2JhdGNoKTsKICAgICAgICB0aGlzLl90b3BPZkJhdGNoID0gdGhpcy5fYmF0Y2hQdHIgPSAwOwogICAgICAgIHRoaXMuX2N1cnJlbnRSZW5kZXJUYXJnZXQgPSB0aGlzLl9sYXN0UHJvZ3JhbSA9IG51bGw7CiAgICAgICAgdGhpcy5fbGFzdFBvaW50VGV4Q29vcmRzLnNldCgwLCAwLCAxLCAxKTsKICAgICAgICB0aGlzLl9sYXN0UG9pbnRaID0gMDsKICAgICAgICBiID0gdGhpcy5fYmF0Y2hTdGF0ZTsKICAgICAgICBiLmN1cnJlbnRTaGFkZXIgPSBudWxsOwogICAgICAgIGIuY3VycmVudEZyYW1lYnVmZmVyID0gbnVsbDsKICAgICAgICBiLmN1cnJlbnRGcmFtZWJ1ZmZlck5vRGVwdGggPSBudWxsOwogICAgICAgIHZlYzQkanNjb21wJDQuc2V0KGIuY3VycmVudENvbG9yLCAxLCAxLCAxLAogICAgICAgICAgICAxKTsKICAgICAgICBiLmNsZWFyQ29sb3Iuc2V0UmdiYSgwLCAwLCAwLCAwKTsKICAgICAgICBiLnBvaW50VGV4Q29vcmRzLnNldCgwLCAwLCAxLCAxKTsKICAgICAgICBhLmNsZWFyQ29sb3IoMCwgMCwgMCwgMCk7CiAgICAgICAgYS5jbGVhcihhLkNPTE9SX0JVRkZFUl9CSVQpOwogICAgICAgIGEuZW5hYmxlKGEuQkxFTkQpOwogICAgICAgIGEuYmxlbmRGdW5jKGEuT05FLCBhLk9ORV9NSU5VU19TUkNfQUxQSEEpOwogICAgICAgIHRoaXMuX2xhc3RTcmNCbGVuZCA9IGEuT05FOwogICAgICAgIHRoaXMuX2xhc3REZXN0QmxlbmQgPSBhLk9ORV9NSU5VU19TUkNfQUxQSEE7CiAgICAgICAgdGhpcy5fSW5pdEJsZW5kTW9kZXMoYSk7CiAgICAgICAgYS5kaXNhYmxlKGEuQ1VMTF9GQUNFKTsKICAgICAgICBhLmRpc2FibGUoYS5TVEVOQ0lMX1RFU1QpOwogICAgICAgIGEuZGlzYWJsZShhLkRJVEhFUik7CiAgICAgICAgdGhpcy5fdXNlc0RlcHRoQnVmZmVyID8gKGEuZW5hYmxlKGEuREVQVEhfVEVTVCksIGEuZGVwdGhNYXNrKCEwKSwgYS5kZXB0aEZ1bmMoYS5MRVFVQUwpKSA6IChhLmRpc2FibGUoYS5ERVBUSF9URVNUKSwgYS5kZXB0aE1hc2soITEpKTsKICAgICAgICB0aGlzLl9pc0RlcHRoRW5hYmxlZCA9IHRoaXMuX3VzZXNEZXB0aEJ1ZmZlcjsKICAgICAgICB0aGlzLl9pc0RlcHRoU2FtcGxpbmdFbmFibGVkID0gITE7CiAgICAgICAgdGhpcy5fcG9pbnRCdWZmZXIgPSBhLmNyZWF0ZUJ1ZmZlcigpOwogICAgICAgIGEuYmluZEJ1ZmZlcihhLkFSUkFZX0JVRkZFUiwgdGhpcy5fcG9pbnRCdWZmZXIpOwogICAgICAgIGEuYnVmZmVyRGF0YShhLkFSUkFZX0JVRkZFUiwgdGhpcy5fcG9pbnREYXRhLmJ5dGVMZW5ndGgsIGEuRFlOQU1JQ19EUkFXKTsKICAgICAgICB0aGlzLl92ZXJ0ZXhCdWZmZXIgPSBhLmNyZWF0ZUJ1ZmZlcigpOwogICAgICAgIGEuYmluZEJ1ZmZlcihhLkFSUkFZX0JVRkZFUiwgdGhpcy5fdmVydGV4QnVmZmVyKTsKICAgICAgICBhLmJ1ZmZlckRhdGEoYS5BUlJBWV9CVUZGRVIsIHRoaXMuX3ZlcnRleERhdGEuYnl0ZUxlbmd0aCwgYS5EWU5BTUlDX0RSQVcpOwogICAgICAgIHRoaXMuX3RleGNvb3JkQnVmZmVyID0gYS5jcmVhdGVCdWZmZXIoKTsKICAgICAgICBhLmJpbmRCdWZmZXIoYS5BUlJBWV9CVUZGRVIsIHRoaXMuX3RleGNvb3JkQnVmZmVyKTsKICAgICAgICBhLmJ1ZmZlckRhdGEoYS5BUlJBWV9CVUZGRVIsIHRoaXMuX3RleGNvb3JkRGF0YS5ieXRlTGVuZ3RoLCBhLkRZTkFNSUNfRFJBVyk7CiAgICAgICAgdGhpcy5faW5kZXhCdWZmZXIgPSBhLmNyZWF0ZUJ1ZmZlcigpOwogICAgICAgIGEuYmluZEJ1ZmZlcihhLkVMRU1FTlRfQVJSQVlfQlVGRkVSLCB0aGlzLl9pbmRleEJ1ZmZlcik7CiAgICAgICAgYS5idWZmZXJEYXRhKGEuRUxFTUVOVF9BUlJBWV9CVUZGRVIsIHRoaXMuX2luZGV4RGF0YSwgYS5TVEFUSUNfRFJBVyk7CiAgICAgICAgYS5hY3RpdmVUZXh0dXJlKGEuVEVYVFVSRTApOwogICAgICAgIGEuYmluZFRleHR1cmUoYS5URVhUVVJFXzJELCBudWxsKTsKICAgICAgICB0aGlzLl9tYXhUZXh0dXJlU2l6ZSA9IGEuZ2V0UGFyYW1ldGVyKGEuTUFYX1RFWFRVUkVfU0laRSk7CiAgICAgICAgYiA9IGEuZ2V0UGFyYW1ldGVyKGEuQUxJQVNFRF9QT0lOVF9TSVpFX1JBTkdFKTsKICAgICAgICB0aGlzLl9taW5Qb2ludFNpemUgPSBiWzBdOwogICAgICAgIHRoaXMuX21heFBvaW50U2l6ZSA9IGJbMV07CiAgICAgICAgYiA9IGEuZ2V0U2hhZGVyUHJlY2lzaW9uRm9ybWF0KGEuVkVSVEVYX1NIQURFUiwgYS5ISUdIX0ZMT0FUKTsKICAgICAgICB2YXIgZCA9IGEuZ2V0U2hhZGVyUHJlY2lzaW9uRm9ybWF0KGEuRlJBR01FTlRfU0hBREVSLCBhLkhJR0hfRkxPQVQpOwogICAgICAgIHRoaXMuX2hpZ2hwUHJlY2lzaW9uID0KICAgICAgICAgICAgYiAmJiBkID8gTWF0aC5taW4oYi5wcmVjaXNpb24sIGQucHJlY2lzaW9uKSA6IDA7CiAgICAgICAgMjA0OCA8IHRoaXMuX21heFBvaW50U2l6ZSAmJiAodGhpcy5fbWF4UG9pbnRTaXplID0gMjA0OCk7CiAgICAgICAgdGhpcy5fZXh0ZW5zaW9ucyA9IGEuZ2V0U3VwcG9ydGVkRXh0ZW5zaW9ucygpOwogICAgICAgIGlmIChiID0gYS5nZXRFeHRlbnNpb24oIldFQkdMX2RlYnVnX3JlbmRlcmVyX2luZm8iKSkgdGhpcy5fdW5tYXNrZWRWZW5kb3IgPSBhLmdldFBhcmFtZXRlcihiLlVOTUFTS0VEX1ZFTkRPUl9XRUJHTCksIHRoaXMuX3VubWFza2VkUmVuZGVyZXIgPSBhLmdldFBhcmFtZXRlcihiLlVOTUFTS0VEX1JFTkRFUkVSX1dFQkdMKTsKICAgICAgICB0aGlzLl9wYXJhbGxlbFNoYWRlckNvbXBpbGVFeHQgPSBhLmdldEV4dGVuc2lvbigiS0hSX3BhcmFsbGVsX3NoYWRlcl9jb21waWxlIik7CiAgICAgICAgQzMkanNjb21wJDUwLmlzRGVidWcgJiYgKGxvc2VDb250ZXh0RXh0ZW5zaW9uID0gYS5nZXRFeHRlbnNpb24oIldFQkdMX2xvc2VfY29udGV4dCIpKTsKICAgICAgICBpZiAodGhpcy5faXNHcHVQcm9maWxpbmdFbmFibGVkKQogICAgICAgICAgICBpZiAoMSA9PT0KICAgICAgICAgICAgICAgIHRoaXMuR2V0V2ViR0xWZXJzaW9uTnVtYmVyKCkpIHsKICAgICAgICAgICAgICAgIGlmICgiQ2hyb21pdW0iICE9PSBDMyRqc2NvbXAkNTAuUGxhdGZvcm0uQnJvd3NlckVuZ2luZSB8fCA4MSA8PSBDMyRqc2NvbXAkNTAuUGxhdGZvcm0uQnJvd3NlclZlcnNpb25OdW1iZXIgfHwgInVuZGVmaW5lZCIgIT09IHR5cGVvZiBkb2N1bWVudCkgdGhpcy5fdGltZXJFeHQgPSBhLmdldEV4dGVuc2lvbigiRVhUX2Rpc2pvaW50X3RpbWVyX3F1ZXJ5IikKICAgICAgICAgICAgfSBlbHNlIHRoaXMuX3RpbWVyRXh0ID0gYS5nZXRFeHRlbnNpb24oIkVYVF9kaXNqb2ludF90aW1lcl9xdWVyeV93ZWJnbDIiKSB8fCBhLmdldEV4dGVuc2lvbigiRVhUX2Rpc2pvaW50X3RpbWVyX3F1ZXJ5Iik7CiAgICAgICAgdGhpcy5fbWF4QW5pc290cm9weSA9ICh0aGlzLl9hbmlzb3Ryb3BpY0V4dCA9IGEuZ2V0RXh0ZW5zaW9uKCJFWFRfdGV4dHVyZV9maWx0ZXJfYW5pc290cm9waWMiKSkgPyBhLmdldFBhcmFtZXRlcih0aGlzLl9hbmlzb3Ryb3BpY0V4dC5NQVhfVEVYVFVSRV9NQVhfQU5JU09UUk9QWV9FWFQpIDogMDsKICAgICAgICBpZiAoMiA+IHRoaXMuR2V0V2ViR0xWZXJzaW9uTnVtYmVyKCkgJiYKICAgICAgICAgICAgdGhpcy5fdXNlc0RlcHRoQnVmZmVyICYmIHRoaXMuX2NhblNhbXBsZURlcHRoICYmICh0aGlzLl9kZXB0aFRleHR1cmVFeHQgPSBhLmdldEV4dGVuc2lvbigiV0VCR0xfZGVwdGhfdGV4dHVyZSIpLCAhdGhpcy5fZGVwdGhUZXh0dXJlRXh0KSkgdGhyb3cgRXJyb3IoIm5vIGRlcHRoIHRleHR1cmUgc3VwcG9ydCIpOwogICAgICAgIDIgPiB0aGlzLkdldFdlYkdMVmVyc2lvbk51bWJlcigpICYmICh0aGlzLl9mcmFnRGVwdGhFeHQgPSBhLmdldEV4dGVuc2lvbigiRVhUX2ZyYWdfZGVwdGgiKSk7CiAgICAgICAgYSA9IEMzJGpzY29tcCQ1MC5HZnguV2ViR0xTaGFkZXJQcm9ncmFtOwogICAgICAgIGIgPSBhLkdldERlZmF1bHRWZXJ0ZXhTaGFkZXJTb3VyY2UoITEpOwogICAgICAgIGQgPSBhLkdldFRleHR1cmVGaWxsRnJhZ21lbnRTaGFkZXJTb3VyY2VfV2ViR0wxX05vRnJhZ0RlcHRoKCk7CiAgICAgICAgbGV0IGMgPSBiLAogICAgICAgICAgICBlID0gYS5HZXRQb2ludEZyYWdtZW50U2hhZGVyU291cmNlX1dlYkdMMV9Ob0ZyYWdEZXB0aCgpLAogICAgICAgICAgICBnID0gYS5HZXRQb2ludFZlcnRleFNoYWRlclNvdXJjZV9XZWJHTDEoKSwKICAgICAgICAgICAgayA9IGEuR2V0VGlsZW1hcEZyYWdtZW50U2hhZGVyU291cmNlX1dlYkdMMV9Ob0ZyYWdEZXB0aCgpLAogICAgICAgICAgICBtID0gYS5HZXREZWZhdWx0VmVydGV4U2hhZGVyU291cmNlKCEwKTsKICAgICAgICB0aGlzLl91c2VzRGVwdGhCdWZmZXIgJiYgKCJTYWZhcmkiICE9PSBDMyRqc2NvbXAkNTAuUGxhdGZvcm0uQnJvd3NlciB8fCAxNS41IDw9IEMzJGpzY29tcCQ1MC5QbGF0Zm9ybS5Ccm93c2VyVmVyc2lvbk51bWJlcikgJiYgKDIgPiB0aGlzLkdldFdlYkdMVmVyc2lvbk51bWJlcigpID8gdGhpcy5fZnJhZ0RlcHRoRXh0ICYmIChkID0gYS5HZXRUZXh0dXJlRmlsbEZyYWdtZW50U2hhZGVyU291cmNlX1dlYkdMMV9GcmFnRGVwdGhFWFQoKSwgZSA9IGEuR2V0UG9pbnRGcmFnbWVudFNoYWRlclNvdXJjZV9XZWJHTDFfRnJhZ0RlcHRoRVhUKCksIGsgPSBhLkdldFRpbGVtYXBGcmFnbWVudFNoYWRlclNvdXJjZV9XZWJHTDFfRnJhZ0RlcHRoRVhUKCkpIDogKGMgPSBhLkdldERlZmF1bHRWZXJ0ZXhTaGFkZXJTb3VyY2VfV2ViR0wyKCksIGQgPSBhLkdldFRleHR1cmVGaWxsRnJhZ21lbnRTaGFkZXJTb3VyY2VfV2ViR0wyKCksIGUgPSBhLkdldFBvaW50RnJhZ21lbnRTaGFkZXJTb3VyY2VfV2ViR0wyKCksCiAgICAgICAgICAgIGcgPSBhLkdldFBvaW50VmVydGV4U2hhZGVyU291cmNlX1dlYkdMMigpLCBrID0gYS5HZXRUaWxlbWFwRnJhZ21lbnRTaGFkZXJTb3VyY2VfV2ViR0wyKCksIG0gPSBhLkdldERlZmF1bHRWZXJ0ZXhTaGFkZXJTb3VyY2VfV2ViR0wyKCEwKSkpOwogICAgICAgIGEgPSBbCiAgICAgICAgICAgIFtkLCBjLCAiPGRlZmF1bHQ+Il0sCiAgICAgICAgICAgIFtkLCBjLCAiPGRlZmF1bHQtZGV2aWNlLXRyYW5zZm9ybT4iXSwKICAgICAgICAgICAgW2UsIGcsICI8cG9pbnQ+Il0sCiAgICAgICAgICAgIFthLkdldENvbG9yRmlsbEZyYWdtZW50U2hhZGVyU291cmNlKCksIGIsICI8ZmlsbD4iXSwKICAgICAgICAgICAgW2EuR2V0TGluZWFyR3JhZGllbnRGaWxsRnJhZ21lbnRTaGFkZXJTb3VyY2UoKSwgYiwgIjxsaW5lYXJncmFkaWVudD4iXSwKICAgICAgICAgICAgW2EuR2V0UGVudW1icmFGaWxsRnJhZ21lbnRTaGFkZXJTb3VyY2UoKSwgYiwgIjxwZW51bWJyYT4iXSwKICAgICAgICAgICAgW2EuR2V0SGFyZEVsbGlwc2VGaWxsRnJhZ21lbnRTaGFkZXJTb3VyY2UoKSwgYiwgIjxoYXJkZWxsaXBzZT4iXSwKICAgICAgICAgICAgW2EuR2V0SGFyZEVsbGlwc2VPdXRsaW5lRnJhZ21lbnRTaGFkZXJTb3VyY2UoKSwgYiwgIjxoYXJkZWxsaXBzZW91dGxpbmU+Il0sCiAgICAgICAgICAgIFthLkdldFNtb290aEVsbGlwc2VGaWxsRnJhZ21lbnRTaGFkZXJTb3VyY2UoKSwgYiwgIjxzbW9vdGhlbGxpcHNlPiJdLAogICAgICAgICAgICBbYS5HZXRTbW9vdGhFbGxpcHNlT3V0bGluZUZyYWdtZW50U2hhZGVyU291cmNlKCksIGIsICI8c21vb3RoZWxsaXBzZW91dGxpbmU+Il0sCiAgICAgICAgICAgIFthLkdldFNtb290aExpbmVGaWxsRnJhZ21lbnRTaGFkZXJTb3VyY2UoKSwgYiwgIjxzbW9vdGhsaW5lPiJdLAogICAgICAgICAgICBbaywgbSwgIjx0aWxlbWFwPiJdCiAgICAgICAgXTsKICAgICAgICBhID0gYXdhaXQgUHJvbWlzZS5hbGwoYS5tYXAobiA9PiB0aGlzLkNyZWF0ZVNoYWRlclByb2dyYW0oewogICAgICAgICAgICBzcmM6IG5bMF0KICAgICAgICB9LCBuWzFdLCBuWzJdKSkpOwogICAgICAgIHRoaXMuX3NwVGV4dHVyZUZpbGwgPSBhWzBdOwogICAgICAgIHRoaXMuX3NwRGV2aWNlVHJhbnNmb3JtVGV4dHVyZUZpbGwgPSBhWzFdOwogICAgICAgIHRoaXMuX3NwUG9pbnRzID0gYVsyXTsKICAgICAgICB0aGlzLl9zcENvbG9yRmlsbCA9IGFbM107CiAgICAgICAgdGhpcy5fc3BMaW5lYXJHcmFkaWVudEZpbGwgPSBhWzRdOwogICAgICAgIHRoaXMuX3NwUGVudW1icmFGaWxsID0gYVs1XTsKICAgICAgICB0aGlzLl9zcEhhcmRFbGxpcHNlRmlsbCA9IGFbNl07CiAgICAgICAgdGhpcy5fc3BIYXJkRWxsaXBzZU91dGxpbmUgPQogICAgICAgICAgICBhWzddOwogICAgICAgIHRoaXMuX3NwU21vb3RoRWxsaXBzZUZpbGwgPSBhWzhdOwogICAgICAgIHRoaXMuX3NwU21vb3RoRWxsaXBzZU91dGxpbmUgPSBhWzldOwogICAgICAgIHRoaXMuX3NwU21vb3RoTGluZUZpbGwgPSBhWzEwXTsKICAgICAgICB0aGlzLl9zcFRpbGVtYXBGaWxsID0gYVsxMV07CiAgICAgICAgdGhpcy5TZXRUZXh0dXJlRmlsbE1vZGUoKQogICAgfQogICAgYXN5bmMgQ3JlYXRlU2hhZGVyUHJvZ3JhbShhLCBiLCBkKSB7CiAgICAgICAgYSA9IGF3YWl0IEMzJGpzY29tcCQ1MC5HZnguV2ViR0xTaGFkZXJQcm9ncmFtLkNyZWF0ZSh0aGlzLCBhLCBiLCBkKTsKICAgICAgICB0aGlzLl9BZGRTaGFkZXJQcm9ncmFtKGEpOwogICAgICAgIHJldHVybiBhCiAgICB9CiAgICBSZXNldExhc3RQcm9ncmFtKCkgewogICAgICAgIHRoaXMuX2xhc3RQcm9ncmFtID0gbnVsbAogICAgfQogICAgU2V0U2l6ZShhLCBiLCBkKSB7CiAgICAgICAgaWYgKHRoaXMuX3dpZHRoICE9PSBhIHx8IHRoaXMuX2hlaWdodCAhPT0gYiB8fCBkKSB7CiAgICAgICAgICAgIHRoaXMuRW5kQmF0Y2goKTsKICAgICAgICAgICAgZCA9IHRoaXMuX2dsOwogICAgICAgICAgICB2YXIgYyA9IHRoaXMuX2JhdGNoU3RhdGU7CiAgICAgICAgICAgIHRoaXMuX3dpZHRoID0gYTsKICAgICAgICAgICAgdGhpcy5faGVpZ2h0ID0gYjsKICAgICAgICAgICAgdGhpcy5fU2V0Vmlld3BvcnQoMCwgMCwgYSwgYik7CiAgICAgICAgICAgIHRoaXMuQ2FsY3VsYXRlUGVyc3BlY3RpdmVNYXRyaXgodGhpcy5fYmJQcm9qZWN0aW9uTWF0cml4LAogICAgICAgICAgICAgICAgYSAvIGIpOwogICAgICAgICAgICB0aGlzLlNldFByb2plY3Rpb25NYXRyaXgodGhpcy5fYmJQcm9qZWN0aW9uTWF0cml4KTsKICAgICAgICAgICAgdGhpcy5fc3BEZXZpY2VUcmFuc2Zvcm1UZXh0dXJlRmlsbCAmJiAoZC51c2VQcm9ncmFtKHRoaXMuX3NwRGV2aWNlVHJhbnNmb3JtVGV4dHVyZUZpbGwuR2V0U2hhZGVyUHJvZ3JhbSgpKSwgdGhpcy5fc3BEZXZpY2VUcmFuc2Zvcm1UZXh0dXJlRmlsbC5fVXBkYXRlRGV2aWNlVHJhbnNmb3JtVW5pZm9ybXModGhpcy5fbWF0UCksIHRoaXMuX2xhc3RQcm9ncmFtID0gdGhpcy5fc3BEZXZpY2VUcmFuc2Zvcm1UZXh0dXJlRmlsbCwgdGhpcy5fYmF0Y2hTdGF0ZS5jdXJyZW50U2hhZGVyID0gdGhpcy5fc3BEZXZpY2VUcmFuc2Zvcm1UZXh0dXJlRmlsbCk7CiAgICAgICAgICAgIGQuYmluZFRleHR1cmUoZC5URVhUVVJFXzJELCBudWxsKTsKICAgICAgICAgICAgZC5hY3RpdmVUZXh0dXJlKGQuVEVYVFVSRTEpOwogICAgICAgICAgICBkLmJpbmRUZXh0dXJlKGQuVEVYVFVSRV8yRCwgbnVsbCk7CiAgICAgICAgICAgIGQuYWN0aXZlVGV4dHVyZShkLlRFWFRVUkUwKTsKICAgICAgICAgICAgdGhpcy5fbGFzdFRleHR1cmUxID0gdGhpcy5fbGFzdFRleHR1cmUwID0KICAgICAgICAgICAgICAgIG51bGw7CiAgICAgICAgICAgIHRoaXMuX3VzZXNEZXB0aEJ1ZmZlciAmJiB0aGlzLl9pc0F1dG9TaXplRGVwdGhCdWZmZXIgJiYgdGhpcy5fU2V0RGVwdGhCdWZmZXJTaXplKHRoaXMuX3dpZHRoLCB0aGlzLl9oZWlnaHQpOwogICAgICAgICAgICB0aGlzLl9jdXJyZW50UmVuZGVyVGFyZ2V0ICYmIHRoaXMuX2N1cnJlbnRSZW5kZXJUYXJnZXQuX1Jlc2l6ZSh0aGlzLl93aWR0aCwgdGhpcy5faGVpZ2h0KTsKICAgICAgICAgICAgZC5iaW5kRnJhbWVidWZmZXIoZC5GUkFNRUJVRkZFUiwgbnVsbCk7CiAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRSZW5kZXJUYXJnZXQgPSBudWxsOwogICAgICAgICAgICBjLmN1cnJlbnRGcmFtZWJ1ZmZlciA9IG51bGw7CiAgICAgICAgICAgIGMuY3VycmVudEZyYW1lYnVmZmVyTm9EZXB0aCA9IG51bGwKICAgICAgICB9CiAgICB9CiAgICBfU2V0RGVwdGhCdWZmZXJTaXplKGEsIGIpIHsKICAgICAgICBjb25zdCBkID0gdGhpcy5fZ2w7CiAgICAgICAgdGhpcy5fZGVwdGhCdWZmZXIgJiYgdGhpcy5fZGVwdGhCdWZmZXJXaWR0aCA9PT0gYSAmJiB0aGlzLl9kZXB0aEJ1ZmZlckhlaWdodCA9PT0gYiB8fCAodGhpcy5fY2FuU2FtcGxlRGVwdGggPyAodGhpcy5fZGVwdGhCdWZmZXIgJiYgZC5kZWxldGVUZXh0dXJlKHRoaXMuX2RlcHRoQnVmZmVyKSwKICAgICAgICAgICAgdGhpcy5fZGVwdGhCdWZmZXIgPSBkLmNyZWF0ZVRleHR1cmUoKSwgZC5iaW5kVGV4dHVyZShkLlRFWFRVUkVfMkQsIHRoaXMuX2RlcHRoQnVmZmVyKSwgZC50ZXhQYXJhbWV0ZXJpKGQuVEVYVFVSRV8yRCwgZC5URVhUVVJFX01BR19GSUxURVIsIGQuTkVBUkVTVCksIGQudGV4UGFyYW1ldGVyaShkLlRFWFRVUkVfMkQsIGQuVEVYVFVSRV9NSU5fRklMVEVSLCBkLk5FQVJFU1QpLCBkLnRleFBhcmFtZXRlcmkoZC5URVhUVVJFXzJELCBkLlRFWFRVUkVfV1JBUF9TLCBkLkNMQU1QX1RPX0VER0UpLCBkLnRleFBhcmFtZXRlcmkoZC5URVhUVVJFXzJELCBkLlRFWFRVUkVfV1JBUF9ULCBkLkNMQU1QX1RPX0VER0UpLCAyIDw9IHRoaXMuR2V0V2ViR0xWZXJzaW9uTnVtYmVyKCkgPyBkLnRleEltYWdlMkQoZC5URVhUVVJFXzJELCAwLCBkLkRFUFRIMjRfU1RFTkNJTDgsIGEsIGIsIDAsIGQuREVQVEhfU1RFTkNJTCwgZC5VTlNJR05FRF9JTlRfMjRfOCwgbnVsbCkgOiB0aGlzLl9kZXB0aFRleHR1cmVFeHQgJiYgZC50ZXhJbWFnZTJEKGQuVEVYVFVSRV8yRCwKICAgICAgICAgICAgICAgIDAsIGQuREVQVEhfU1RFTkNJTCwgYSwgYiwgMCwgZC5ERVBUSF9TVEVOQ0lMLCB0aGlzLl9kZXB0aFRleHR1cmVFeHQuVU5TSUdORURfSU5UXzI0XzhfV0VCR0wsIG51bGwpLCBkLmJpbmRUZXh0dXJlKGQuVEVYVFVSRV8yRCwgbnVsbCkpIDogKHRoaXMuX2RlcHRoQnVmZmVyICYmIGQuZGVsZXRlUmVuZGVyYnVmZmVyKHRoaXMuX2RlcHRoQnVmZmVyKSwgdGhpcy5fZGVwdGhCdWZmZXIgPSBkLmNyZWF0ZVJlbmRlcmJ1ZmZlcigpLCBkLmJpbmRSZW5kZXJidWZmZXIoZC5SRU5ERVJCVUZGRVIsIHRoaXMuX2RlcHRoQnVmZmVyKSwgZC5yZW5kZXJidWZmZXJTdG9yYWdlKGQuUkVOREVSQlVGRkVSLCAyIDw9IHRoaXMuX3ZlcnNpb24gPyBkLkRFUFRIMjRfU1RFTkNJTDggOiBkLkRFUFRIX1NURU5DSUwsIGEsIGIpLCBkLmJpbmRSZW5kZXJidWZmZXIoZC5SRU5ERVJCVUZGRVIsIG51bGwpKSwgdGhpcy5fZGVwdGhCdWZmZXJXaWR0aCA9IGEsIHRoaXMuX2RlcHRoQnVmZmVySGVpZ2h0ID0gYikKICAgIH0KICAgIFNldEZpeGVkU2l6ZURlcHRoQnVmZmVyKGEsIGIpIHsKICAgICAgICB0aGlzLl91c2VzRGVwdGhCdWZmZXIgJiYKICAgICAgICAgICAgKHRoaXMuX2lzQXV0b1NpemVEZXB0aEJ1ZmZlciA9ICExLCB0aGlzLl9TZXREZXB0aEJ1ZmZlclNpemUoYSwgYikpCiAgICB9CiAgICBTZXRBdXRvU2l6ZURlcHRoQnVmZmVyKCkgewogICAgICAgIHRoaXMuX3VzZXNEZXB0aEJ1ZmZlciAmJiAodGhpcy5faXNBdXRvU2l6ZURlcHRoQnVmZmVyID0gITAsIHRoaXMuX1NldERlcHRoQnVmZmVyU2l6ZSh0aGlzLl93aWR0aCwgdGhpcy5faGVpZ2h0KSkKICAgIH0KICAgIF9TZXRWaWV3cG9ydChhLCBiLCBkLCBjKSB7CiAgICAgICAgY29uc3QgZSA9IHRoaXMuX3ZpZXdwb3J0OwogICAgICAgIGlmIChlWzBdICE9PSBhIHx8IGVbMV0gIT09IGIgfHwgZVsyXSAhPT0gZCB8fCBlWzNdICE9PSBjKSB0aGlzLlB1c2hCYXRjaCgpLkluaXRTZXRWaWV3cG9ydChhLCBiLCBkLCBjKSwgdmVjNCRqc2NvbXAkNC5zZXQoZSwgYSwgYiwgZCwgYyksIHRoaXMuX3RvcE9mQmF0Y2ggPSAwCiAgICB9CiAgICBTZXRGb3ZZKGEpIHsKICAgICAgICBzdXBlci5TZXRGb3ZZKGEpOwogICAgICAgIHRoaXMuQ2FsY3VsYXRlUGVyc3BlY3RpdmVNYXRyaXgodGhpcy5fYmJQcm9qZWN0aW9uTWF0cml4LCB0aGlzLl93aWR0aCAvIHRoaXMuX2hlaWdodCkKICAgIH0KICAgIFNldFByb2plY3Rpb25NYXRyaXgoYSkgewogICAgICAgIG1hdDQkanNjb21wJDcuZXhhY3RFcXVhbHModGhpcy5fbWF0UCwKICAgICAgICAgICAgYSkgfHwgKHRoaXMuUHVzaEJhdGNoKCkuSW5pdFNldFByb2plY3Rpb24oYSksIG1hdDQkanNjb21wJDcuY29weSh0aGlzLl9tYXRQLCBhKSwgdGhpcy5fdG9wT2ZCYXRjaCA9IDAsIHRoaXMuX2RpZENoYW5nZVRyYW5zZm9ybSA9ICEwKQogICAgfQogICAgU2V0RGVmYXVsdFJlbmRlclRhcmdldFByb2plY3Rpb25TdGF0ZSgpIHsKICAgICAgICBsZXQgYSwgYjsKICAgICAgICB2YXIgZCA9IHRoaXMuX2N1cnJlbnRSZW5kZXJUYXJnZXQ7CiAgICAgICAgbnVsbCA9PT0gZCA/IChhID0gdGhpcy5fYmJQcm9qZWN0aW9uTWF0cml4LCBiID0gdGhpcy5HZXRXaWR0aCgpLCBkID0gdGhpcy5HZXRIZWlnaHQoKSkgOiAoYSA9IGQuR2V0UHJvamVjdGlvbk1hdHJpeCgpLCBiID0gZC5HZXRXaWR0aCgpLCBkID0gZC5HZXRIZWlnaHQoKSk7CiAgICAgICAgdGhpcy5TZXRQcm9qZWN0aW9uTWF0cml4KGEpOwogICAgICAgIHRoaXMuX1NldFZpZXdwb3J0KDAsIDAsIGIsIGQpCiAgICB9CiAgICBTZXRNb2RlbFZpZXdNYXRyaXgoYSkgewogICAgICAgIG1hdDQkanNjb21wJDcuZXhhY3RFcXVhbHModGhpcy5fbWF0TVYsIGEpIHx8ICh0aGlzLlB1c2hCYXRjaCgpLkluaXRTZXRNb2RlbFZpZXcoYSksIG1hdDQkanNjb21wJDcuY29weSh0aGlzLl9tYXRNViwKICAgICAgICAgICAgYSksIHRoaXMuX3RvcE9mQmF0Y2ggPSAwLCB0aGlzLl9kaWRDaGFuZ2VUcmFuc2Zvcm0gPSAhMCkKICAgIH0KICAgIFJlc2V0RGlkQ2hhbmdlVHJhbnNmb3JtRmxhZygpIHsKICAgICAgICB0aGlzLl9kaWRDaGFuZ2VUcmFuc2Zvcm0gPSAhMQogICAgfQogICAgRGlkQ2hhbmdlVHJhbnNmb3JtKCkgewogICAgICAgIHJldHVybiB0aGlzLl9kaWRDaGFuZ2VUcmFuc2Zvcm0KICAgIH0KICAgIEdldEJhdGNoU3RhdGUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2JhdGNoU3RhdGUKICAgIH0KICAgIFB1c2hCYXRjaCgpIHsKICAgICAgICBjb25zdCBhID0gdGhpcy5fYmF0Y2g7CiAgICAgICAgdGhpcy5fYmF0Y2hQdHIgPT09IGEubGVuZ3RoICYmIGEucHVzaChuZXcgQzMkanNjb21wJDUwLkdmeC5XZWJHTEJhdGNoSm9iKHRoaXMuX2JhdGNoU3RhdGUpKTsKICAgICAgICByZXR1cm4gYVt0aGlzLl9iYXRjaFB0cisrXQogICAgfQogICAgRW5kQmF0Y2goKSB7CiAgICAgICAgMCA9PT0gdGhpcy5fYmF0Y2hQdHIgfHwgdGhpcy5Jc0NvbnRleHRMb3N0KCkgfHwgKHRoaXMuX1dyaXRlQnVmZmVycygpLCB0aGlzLl9FeGVjdXRlQmF0Y2goKSwgdGhpcy5fdG9wT2ZCYXRjaCA9IHRoaXMuX3BvaW50UHRyID0gdGhpcy5fdGV4UHRyID0gdGhpcy5fdmVydGV4UHRyID0KICAgICAgICAgICAgdGhpcy5fYmF0Y2hQdHIgPSAwKQogICAgfQogICAgX1dyaXRlQnVmZmVycygpIHsKICAgICAgICBjb25zdCBhID0gdGhpcy5fZ2w7CiAgICAgICAgMCA8IHRoaXMuX3BvaW50UHRyICYmIChhLmJpbmRCdWZmZXIoYS5BUlJBWV9CVUZGRVIsIHRoaXMuX3BvaW50QnVmZmVyKSwgYS5idWZmZXJTdWJEYXRhKGEuQVJSQVlfQlVGRkVSLCAwLCB0aGlzLl9wb2ludERhdGEuc3ViYXJyYXkoMCwgdGhpcy5fcG9pbnRQdHIpKSk7CiAgICAgICAgMCA8IHRoaXMuX3ZlcnRleFB0ciAmJiAoYS5iaW5kQnVmZmVyKGEuQVJSQVlfQlVGRkVSLCB0aGlzLl92ZXJ0ZXhCdWZmZXIpLCBhLmJ1ZmZlclN1YkRhdGEoYS5BUlJBWV9CVUZGRVIsIDAsIHRoaXMuX3ZlcnRleERhdGEuc3ViYXJyYXkoMCwgdGhpcy5fdmVydGV4UHRyKSksIGEuYmluZEJ1ZmZlcihhLkFSUkFZX0JVRkZFUiwgdGhpcy5fdGV4Y29vcmRCdWZmZXIpLCBhLmJ1ZmZlclN1YkRhdGEoYS5BUlJBWV9CVUZGRVIsIDAsIHRoaXMuX3RleGNvb3JkRGF0YS5zdWJhcnJheSgwLCB0aGlzLl90ZXhQdHIpKSkKICAgIH0KICAgIF9FeGVjdXRlQmF0Y2goKSB7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuX2JhdGNoOwogICAgICAgIGZvciAobGV0IGIgPSAwLCBkID0gdGhpcy5fYmF0Y2hQdHI7IGIgPCBkOyArK2IpIGFbYl0uUnVuKCkKICAgIH0KICAgIEdldE9wYWNpdHkoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2xhc3RDb2xvci5nZXRBKCkKICAgIH0KICAgIFNldENvbG9yUmdiYShhLCBiLCBkLCBjKSB7CiAgICAgICAgY29uc3QgZSA9IHRoaXMuX2xhc3RDb2xvcjsKICAgICAgICBlLmVxdWFsc1JnYmEoYSwgYiwgZCwgYykgfHwgKGUuc2V0UmdiYShhLCBiLCBkLCBjKSwgdGhpcy5QdXNoQmF0Y2goKS5Jbml0U2V0Q29sb3IoZSksIHRoaXMuX3RvcE9mQmF0Y2ggPSAwLCB0aGlzLl9jdXJyZW50U3RhdGVHcm91cCA9IG51bGwpCiAgICB9CiAgICBTZXRPcGFjaXR5KGEpIHsKICAgICAgICBjb25zdCBiID0gdGhpcy5fbGFzdENvbG9yOwogICAgICAgIGIuZ2V0QSgpICE9PSBhICYmIChiLnNldEEoYSksIHRoaXMuUHVzaEJhdGNoKCkuSW5pdFNldENvbG9yKGIpLCB0aGlzLl90b3BPZkJhdGNoID0gMCwgdGhpcy5fY3VycmVudFN0YXRlR3JvdXAgPSBudWxsKQogICAgfQogICAgU2V0Q29sb3IoYSkgewogICAgICAgIGNvbnN0IGIgPSB0aGlzLl9sYXN0Q29sb3I7CiAgICAgICAgYi5lcXVhbHMoYSkgfHwgKGIuc2V0KGEpLCB0aGlzLlB1c2hCYXRjaCgpLkluaXRTZXRDb2xvcihiKSwgdGhpcy5fdG9wT2ZCYXRjaCA9CiAgICAgICAgICAgIDAsIHRoaXMuX2N1cnJlbnRTdGF0ZUdyb3VwID0gbnVsbCkKICAgIH0KICAgIFJlc2V0Q29sb3IoKSB7CiAgICAgICAgdGhpcy5TZXRDb2xvclJnYmEoMSwgMSwgMSwgMSkKICAgIH0KICAgIEdldENvbG9yKCkgewogICAgICAgIHJldHVybiB0aGlzLl9sYXN0Q29sb3IKICAgIH0KICAgIFNldFRleHR1cmUoYSkgewogICAgICAgIGEgIT09IHRoaXMuX2xhc3RUZXh0dXJlMCAmJiAodGhpcy5QdXNoQmF0Y2goKS5Jbml0U2V0VGV4dHVyZShhKSwgdGhpcy5fbGFzdFRleHR1cmUwID0gYSwgdGhpcy5fdG9wT2ZCYXRjaCA9IDApCiAgICB9CiAgICBfUmVzZXRMYXN0VGV4dHVyZSgpIHsKICAgICAgICB0aGlzLl9sYXN0VGV4dHVyZTAgPSBudWxsCiAgICB9CiAgICBTZXRCbGVuZE1vZGUoYSkgewogICAgICAgIGEgPSB0aGlzLl9HZXRCbGVuZEJ5SW5kZXgoYSk7CiAgICAgICAgdGhpcy5fU2V0QmxlbmQoYVswXSwgYVsxXSkKICAgIH0KICAgIFNldE5hbWVkQmxlbmRNb2RlKGEpIHsKICAgICAgICBhID0gdGhpcy5HZXROYW1lZEJsZW5kKGEpOwogICAgICAgIHRoaXMuX1NldEJsZW5kKGEuc3JjQmxlbmQsIGEuZGVzdEJsZW5kKQogICAgfQogICAgX1NldEJsZW5kKGEsIGIpIHsKICAgICAgICBpZiAoYSAhPT0gdGhpcy5fbGFzdFNyY0JsZW5kIHx8IGIgIT09IHRoaXMuX2xhc3REZXN0QmxlbmQpIHRoaXMuUHVzaEJhdGNoKCkuSW5pdFNldEJsZW5kKGEsCiAgICAgICAgICAgIGIpLCB0aGlzLl9sYXN0U3JjQmxlbmQgPSBhLCB0aGlzLl9sYXN0RGVzdEJsZW5kID0gYiwgdGhpcy5fdG9wT2ZCYXRjaCA9IDAsIHRoaXMuX2N1cnJlbnRTdGF0ZUdyb3VwID0gbnVsbAogICAgfQogICAgSXNQcmVtdWx0aXBsaWVkQWxwaGFCbGVuZCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fbGFzdFNyY0JsZW5kID09PSB0aGlzLl9nbC5PTkUgJiYgdGhpcy5fbGFzdERlc3RCbGVuZCA9PT0gdGhpcy5fZ2wuT05FX01JTlVTX1NSQ19BTFBIQQogICAgfQogICAgU2V0QWxwaGFCbGVuZCgpIHsKICAgICAgICB0aGlzLl9TZXRCbGVuZCh0aGlzLl9nbC5PTkUsIHRoaXMuX2dsLk9ORV9NSU5VU19TUkNfQUxQSEEpCiAgICB9CiAgICBTZXROb1ByZW11bHRpcGx5QWxwaGFCbGVuZCgpIHsKICAgICAgICB0aGlzLl9TZXRCbGVuZCh0aGlzLl9nbC5TUkNfQUxQSEEsIHRoaXMuX2dsLk9ORV9NSU5VU19TUkNfQUxQSEEpCiAgICB9CiAgICBTZXRDb3B5QmxlbmQoKSB7CiAgICAgICAgdGhpcy5fU2V0QmxlbmQodGhpcy5fZ2wuT05FLCB0aGlzLl9nbC5aRVJPKQogICAgfQogICAgUmVjdChhKSB7CiAgICAgICAgdGhpcy5SZWN0MihhLmdldExlZnQoKSwgYS5nZXRUb3AoKSwgYS5nZXRSaWdodCgpLCBhLmdldEJvdHRvbSgpKQogICAgfQogICAgUmVjdDIoYSwKICAgICAgICBiLCBkLCBjKSB7CiAgICAgICAgdGhpcy5RdWFkMihhLCBiLCBkLCBiLCBkLCBjLCBhLCBjKQogICAgfQogICAgX0V4dGVuZFF1YWRCYXRjaCgpIHsKICAgICAgICBsZXQgYSA9IHRoaXMuX3ZlcnRleFB0cjsKICAgICAgICBhID49IHRoaXMuX2xhc3RWZXJ0ZXhQdHIgJiYgKHRoaXMuRW5kQmF0Y2goKSwgYSA9IDApOwogICAgICAgIDEgPT09IHRoaXMuX3RvcE9mQmF0Y2ggPyB0aGlzLl9iYXRjaFt0aGlzLl9iYXRjaFB0ciAtIDFdLl9pbmRleENvdW50ICs9IDYgOiAodGhpcy5QdXNoQmF0Y2goKS5Jbml0UXVhZChhLCA2KSwgdGhpcy5fdG9wT2ZCYXRjaCA9IDEpCiAgICB9CiAgICBfV3JpdGVRdWFkVG9WZXJ0ZXhCdWZmZXIoYSkgewogICAgICAgIGEud3JpdGVUb1R5cGVkQXJyYXkzRCh0aGlzLl92ZXJ0ZXhEYXRhLCB0aGlzLl92ZXJ0ZXhQdHIsIHRoaXMuX2Jhc2VaICsgdGhpcy5fY3VycmVudFopOwogICAgICAgIHRoaXMuX3ZlcnRleFB0ciArPSAxMgogICAgfQogICAgUXVhZChhKSB7CiAgICAgICAgdGhpcy5fRXh0ZW5kUXVhZEJhdGNoKCk7CiAgICAgICAgdGhpcy5fV3JpdGVRdWFkVG9WZXJ0ZXhCdWZmZXIoYSk7CiAgICAgICAgZGVmYXVsdFRleENvb3Jkc1F1YWQkanNjb21wJDEud3JpdGVUb1R5cGVkQXJyYXkodGhpcy5fdGV4Y29vcmREYXRhLAogICAgICAgICAgICB0aGlzLl90ZXhQdHIpOwogICAgICAgIHRoaXMuX3RleFB0ciArPSA4CiAgICB9CiAgICBRdWFkMihhLCBiLCBkLCBjLCBlLCBnLCBrLCBtKSB7CiAgICAgICAgdGhpcy5fRXh0ZW5kUXVhZEJhdGNoKCk7CiAgICAgICAgY29uc3QgbiA9IHRoaXMuX3ZlcnRleERhdGE7CiAgICAgICAgbGV0IHEgPSB0aGlzLl92ZXJ0ZXhQdHI7CiAgICAgICAgY29uc3QgdSA9IHRoaXMuX2Jhc2VaICsgdGhpcy5fY3VycmVudFo7CiAgICAgICAgbltxKytdID0gYTsKICAgICAgICBuW3ErK10gPSBiOwogICAgICAgIG5bcSsrXSA9IHU7CiAgICAgICAgbltxKytdID0gZDsKICAgICAgICBuW3ErK10gPSBjOwogICAgICAgIG5bcSsrXSA9IHU7CiAgICAgICAgbltxKytdID0gZTsKICAgICAgICBuW3ErK10gPSBnOwogICAgICAgIG5bcSsrXSA9IHU7CiAgICAgICAgbltxKytdID0gazsKICAgICAgICBuW3ErK10gPSBtOwogICAgICAgIG5bcSsrXSA9IHU7CiAgICAgICAgdGhpcy5fdmVydGV4UHRyID0gcTsKICAgICAgICBkZWZhdWx0VGV4Q29vcmRzUXVhZCRqc2NvbXAkMS53cml0ZVRvVHlwZWRBcnJheSh0aGlzLl90ZXhjb29yZERhdGEsIHRoaXMuX3RleFB0cik7CiAgICAgICAgdGhpcy5fdGV4UHRyICs9IDgKICAgIH0KICAgIFF1YWQzKGEsIGIpIHsKICAgICAgICB0aGlzLl9FeHRlbmRRdWFkQmF0Y2goKTsKICAgICAgICB0aGlzLl9Xcml0ZVF1YWRUb1ZlcnRleEJ1ZmZlcihhKTsKICAgICAgICBiLndyaXRlQXNRdWFkVG9UeXBlZEFycmF5KHRoaXMuX3RleGNvb3JkRGF0YSwgdGhpcy5fdGV4UHRyKTsKICAgICAgICB0aGlzLl90ZXhQdHIgKz0gOAogICAgfQogICAgUXVhZDQoYSwgYikgewogICAgICAgIHRoaXMuX0V4dGVuZFF1YWRCYXRjaCgpOwogICAgICAgIHRoaXMuX1dyaXRlUXVhZFRvVmVydGV4QnVmZmVyKGEpOwogICAgICAgIGIud3JpdGVUb1R5cGVkQXJyYXkodGhpcy5fdGV4Y29vcmREYXRhLCB0aGlzLl90ZXhQdHIpOwogICAgICAgIHRoaXMuX3RleFB0ciArPSA4CiAgICB9CiAgICBRdWFkM0QoYSwgYiwgZCwgYywgZSwgZywgaywgbSwgbiwgcSwgdSwgdywgeikgewogICAgICAgIHRoaXMuX0V4dGVuZFF1YWRCYXRjaCgpOwogICAgICAgIGNvbnN0IEMgPSB0aGlzLl92ZXJ0ZXhEYXRhOwogICAgICAgIGxldCBEID0gdGhpcy5fdmVydGV4UHRyOwogICAgICAgIGNvbnN0IEYgPSB0aGlzLl9iYXNlWiArIHRoaXMuX2N1cnJlbnRaOwogICAgICAgIENbRCsrXSA9IGE7CiAgICAgICAgQ1tEKytdID0gYjsKICAgICAgICBDW0QrK10gPSBGICsgZDsKICAgICAgICBDW0QrK10gPSBjOwogICAgICAgIENbRCsrXSA9IGU7CiAgICAgICAgQ1tEKytdID0gRiArIGc7CiAgICAgICAgQ1tEKytdID0gazsKICAgICAgICBDW0QrK10gPSBtOwogICAgICAgIENbRCsrXSA9IEYgKyBuOwogICAgICAgIENbRCsrXSA9IHE7CiAgICAgICAgQ1tEKytdID0gdTsKICAgICAgICBDW0QrK10gPSBGICsgdzsKICAgICAgICB0aGlzLl92ZXJ0ZXhQdHIgPSBEOwogICAgICAgIHoud3JpdGVBc1F1YWRUb1R5cGVkQXJyYXkodGhpcy5fdGV4Y29vcmREYXRhLCB0aGlzLl90ZXhQdHIpOwogICAgICAgIHRoaXMuX3RleFB0ciArPSA4CiAgICB9CiAgICBRdWFkM0QyKGEsCiAgICAgICAgYiwgZCwgYywgZSwgZywgaywgbSwgbiwgcSwgdSwgdywgeikgewogICAgICAgIHRoaXMuX0V4dGVuZFF1YWRCYXRjaCgpOwogICAgICAgIGNvbnN0IEMgPSB0aGlzLl92ZXJ0ZXhEYXRhOwogICAgICAgIGxldCBEID0gdGhpcy5fdmVydGV4UHRyOwogICAgICAgIGNvbnN0IEYgPSB0aGlzLl9iYXNlWiArIHRoaXMuX2N1cnJlbnRaOwogICAgICAgIENbRCsrXSA9IGE7CiAgICAgICAgQ1tEKytdID0gYjsKICAgICAgICBDW0QrK10gPSBGICsgZDsKICAgICAgICBDW0QrK10gPSBjOwogICAgICAgIENbRCsrXSA9IGU7CiAgICAgICAgQ1tEKytdID0gRiArIGc7CiAgICAgICAgQ1tEKytdID0gazsKICAgICAgICBDW0QrK10gPSBtOwogICAgICAgIENbRCsrXSA9IEYgKyBuOwogICAgICAgIENbRCsrXSA9IHE7CiAgICAgICAgQ1tEKytdID0gdTsKICAgICAgICBDW0QrK10gPSBGICsgdzsKICAgICAgICB0aGlzLl92ZXJ0ZXhQdHIgPSBEOwogICAgICAgIHoud3JpdGVUb1R5cGVkQXJyYXkodGhpcy5fdGV4Y29vcmREYXRhLCB0aGlzLl90ZXhQdHIpOwogICAgICAgIHRoaXMuX3RleFB0ciArPSA4CiAgICB9CiAgICBGdWxsc2NyZWVuUXVhZChhLCBiKSB7CiAgICAgICAgbWF0NCRqc2NvbXAkNy5jb3B5KHRtcFByb2plY3Rpb24sIHRoaXMuX21hdFApOwogICAgICAgIG1hdDQkanNjb21wJDcuY29weSh0bXBNb2RlbFZpZXcsIHRoaXMuX21hdE1WKTsKICAgICAgICB0aGlzLlNldERlZmF1bHRSZW5kZXJUYXJnZXRQcm9qZWN0aW9uU3RhdGUoKTsKICAgICAgICBjb25zdCBbZCwgY10gPQogICAgICAgIHRoaXMuR2V0UmVuZGVyVGFyZ2V0U2l6ZSh0aGlzLl9jdXJyZW50UmVuZGVyVGFyZ2V0KTsKICAgICAgICB2YXIgZSA9IHRoaXMuQ2FsY3VsYXRlTG9va0F0TW9kZWxWaWV3MigwLCAwLCB0aGlzLkdldERlZmF1bHRDYW1lcmFaKGMpLCAwLCAwLCAwLCBjKTsKICAgICAgICB0aGlzLlNldE1vZGVsVmlld01hdHJpeChlKTsKICAgICAgICBpZiAoImNyb3AiID09PSBhICYmIHRoaXMuX2N1cnJlbnRSZW5kZXJUYXJnZXQgJiYgYikgewogICAgICAgICAgICBhID0gdGhpcy5fd2lkdGggLyAyOwogICAgICAgICAgICBlID0gdGhpcy5faGVpZ2h0IC8gMjsKICAgICAgICAgICAgY29uc3QgbSA9IGIuR2V0V2lkdGgoKTsKICAgICAgICAgICAgYiA9IGIuR2V0SGVpZ2h0KCk7CiAgICAgICAgICAgIHZhciBnID0gdGhpcy5fY3VycmVudFJlbmRlclRhcmdldC5HZXRXaWR0aCgpLAogICAgICAgICAgICAgICAgayA9IHRoaXMuX2N1cnJlbnRSZW5kZXJUYXJnZXQuR2V0SGVpZ2h0KCk7CiAgICAgICAgICAgIGcgPSBNYXRoLm1pbihnLCBtKTsKICAgICAgICAgICAgY29uc3QgbiA9IE1hdGgubWluKGssIGIpLAogICAgICAgICAgICAgICAgcSA9IE1hdGgubWF4KGIgLSBrLCAwKTsKICAgICAgICAgICAgayA9IE1hdGgubWF4KGsgLSBiLCAwKTsKICAgICAgICAgICAgdG1wUmVjdCRqc2NvbXAkMS5zZXQoLWEsIGUgLSBrLCAtYSArIGcsIGUgLSBuIC0gayk7CiAgICAgICAgICAgIHRtcFF1YWQkanNjb21wJDEuc2V0RnJvbVJlY3QodG1wUmVjdCRqc2NvbXAkMSk7CiAgICAgICAgICAgIHRtcFJlY3QkanNjb21wJDEuc2V0KDAsIHEsIGcsIG4gKyBxKTsKICAgICAgICAgICAgdG1wUmVjdCRqc2NvbXAkMS5kaXZpZGUobSwgYik7CiAgICAgICAgICAgIHRoaXMuUXVhZDModG1wUXVhZCRqc2NvbXAkMSwgdG1wUmVjdCRqc2NvbXAkMSkKICAgICAgICB9IGVsc2UgYSA9IGQgLyAyLCBlID0gYyAvIDIsIHRoaXMuUmVjdDIoLWEsIGUsIGEsIC1lKTsKICAgICAgICB0aGlzLlNldFByb2plY3Rpb25NYXRyaXgodG1wUHJvamVjdGlvbik7CiAgICAgICAgdGhpcy5TZXRNb2RlbFZpZXdNYXRyaXgodG1wTW9kZWxWaWV3KQogICAgfQogICAgU3RhcnRSZW5kZXJpbmdQb2ludHMoYSkgewogICAgICAgIHRoaXMuX2xhc3RQb2ludFRleENvb3Jkcy5lcXVhbHMoYSkgfHwgKHRoaXMuX2xhc3RQb2ludFRleENvb3Jkcy5jb3B5KGEpLCB0aGlzLlB1c2hCYXRjaCgpLkluaXRTZXRQb2ludFRleENvb3JkcyhhKSwgdGhpcy5fdG9wT2ZCYXRjaCA9IDApCiAgICB9CiAgICBGaW5pc2hSZW5kZXJpbmdQb2ludHMoKSB7fQogICAgUG9pbnQoYSwgYiwgZCwgYykgewogICAgICAgIHRoaXMuX3BvaW50UHRyID49IExBU1RfUE9JTlQgJiYgdGhpcy5FbmRCYXRjaCgpOwogICAgICAgIGxldCBlID0gdGhpcy5fcG9pbnRQdHI7CiAgICAgICAgdmFyIGcgPSB0aGlzLl9iYXNlWiArCiAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRaOwogICAgICAgIDIgPT09IHRoaXMuX3RvcE9mQmF0Y2ggJiYgdGhpcy5fbGFzdFBvaW50WiA9PT0gZyA/IHRoaXMuX2JhdGNoW3RoaXMuX2JhdGNoUHRyIC0gMV0uX2luZGV4Q291bnQrKyA6ICh0aGlzLlB1c2hCYXRjaCgpLkluaXRQb2ludHMoZSwgZyksIHRoaXMuX3RvcE9mQmF0Y2ggPSAyLCB0aGlzLl9sYXN0UG9pbnRaID0gZyk7CiAgICAgICAgZyA9IHRoaXMuX3BvaW50RGF0YTsKICAgICAgICBnW2UrK10gPSBhOwogICAgICAgIGdbZSsrXSA9IGI7CiAgICAgICAgZ1tlKytdID0gZDsKICAgICAgICBnW2UrK10gPSBjOwogICAgICAgIHRoaXMuX3BvaW50UHRyID0gZQogICAgfQogICAgU2V0UHJvZ3JhbShhKSB7CiAgICAgICAgdGhpcy5fbGFzdFByb2dyYW0gIT09IGEgJiYgKHRoaXMuUHVzaEJhdGNoKCkuSW5pdFNldFByb2dyYW0oYSksIHRoaXMuX2xhc3RQcm9ncmFtID0gYSwgdGhpcy5fdG9wT2ZCYXRjaCA9IDAsIHRoaXMuX2N1cnJlbnRTdGF0ZUdyb3VwID0gbnVsbCkKICAgIH0KICAgIFNldERldmljZVRyYW5zZm9ybVRleHR1cmVGaWxsTW9kZSgpIHsKICAgICAgICB0aGlzLlNldFByb2dyYW0odGhpcy5fc3BEZXZpY2VUcmFuc2Zvcm1UZXh0dXJlRmlsbCkKICAgIH0KICAgIFNldEdyYWRpZW50Q29sb3IoYSkgewogICAgICAgIHRoaXMuUHVzaEJhdGNoKCkuSW5pdFNldEdyYWRpZW50Q29sb3IoYSk7CiAgICAgICAgdGhpcy5fdG9wT2ZCYXRjaCA9IDAKICAgIH0KICAgIFNldEVsbGlwc2VQYXJhbXMoYSwgYiwgZCA9IDEpIHsKICAgICAgICB0aGlzLlB1c2hCYXRjaCgpLkluaXRTZXRFbGxpcHNlUGFyYW1zKGEsIGIsIGQpOwogICAgICAgIHRoaXMuX3RvcE9mQmF0Y2ggPSAwCiAgICB9CiAgICBTZXRUaWxlbWFwSW5mbyhhLCBiLCBkLCBjLCBlLCBnLCBrKSB7CiAgICAgICAgaWYgKHRoaXMuX2xhc3RQcm9ncmFtICE9PSB0aGlzLl9zcFRpbGVtYXBGaWxsKSB0aHJvdyBFcnJvcigibXVzdCBzZXQgdGlsZW1hcCBmaWxsIG1vZGUgZmlyc3QiKTsKICAgICAgICB0aGlzLlB1c2hCYXRjaCgpLkluaXRTZXRUaWxlbWFwSW5mbyhhLCBiLCBkLCBjLCBlLCBnLCBrKTsKICAgICAgICB0aGlzLl90b3BPZkJhdGNoID0gMAogICAgfQogICAgU2V0UHJvZ3JhbVBhcmFtZXRlcnMoYSwgYiwgZCwgYywgZSwgZywgaywgbSwgbiwgcSwgdSkgewogICAgICAgIGNvbnN0IHcgPSB0aGlzLl9sYXN0UHJvZ3JhbTsKICAgICAgICBpZiAody5faGFzQW55T3B0aW9uYWxVbmlmb3JtcyAmJiAhdy5BcmVPcHRpb25hbFVuaWZvcm1zQWxyZWFkeVNldEluQmF0Y2goYiwgZCwgYywgZSwgZywgaywgbSwgbiwgcSwgdSkpIHsKICAgICAgICAgICAgdmFyIHogPSB0aGlzLlB1c2hCYXRjaCgpOwogICAgICAgICAgICB6LkluaXRTZXRQcm9ncmFtUGFyYW1ldGVycygpOwogICAgICAgICAgICB3LlNldE9wdGlvbmFsVW5pZm9ybXNJbkJhdGNoKGIsIGQsIGMsIGUsIGcsIGssIG0sIG4sIHEsIHUpOwogICAgICAgICAgICB2YXIgQyA9IHouX21hdDRwYXJhbTsKICAgICAgICAgICAgQ1swXSA9IGc7CiAgICAgICAgICAgIENbMV0gPSBrOwogICAgICAgICAgICBiLndyaXRlVG9UeXBlZEFycmF5KEMsIDIpOwogICAgICAgICAgICBDWzZdID0gbjsKICAgICAgICAgICAgQ1s3XSA9IHE7CiAgICAgICAgICAgIGQud3JpdGVUb1R5cGVkQXJyYXkoQywgMTIpOwogICAgICAgICAgICBiID0gei5fY29sb3JQYXJhbTsKICAgICAgICAgICAgZS53cml0ZVRvVHlwZWRBcnJheShiLCAwKTsKICAgICAgICAgICAgZSA9IGJbMV07CiAgICAgICAgICAgIGJbMV0gPSBiWzNdOwogICAgICAgICAgICBiWzNdID0gZTsKICAgICAgICAgICAgYy53cml0ZVRvVHlwZWRBcnJheSh6Ll9zcmNPcmlnaW5SZWN0LCAwKTsKICAgICAgICAgICAgei5fc3RhcnRJbmRleCA9IHU7CiAgICAgICAgICAgIHouX2luZGV4Q291bnQgPSBtOwogICAgICAgICAgICB3Ll91U2FtcGxlckJhY2suSXNVc2VkKCkgPyB6Ll90ZXhQYXJhbSA9IGEgPyBhLkdldFRleHR1cmUoKSA6IG51bGwgOiB6Ll90ZXhQYXJhbSA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3RvcE9mQmF0Y2ggPSAwCiAgICAgICAgfQogICAgfQogICAgU2V0UHJvZ3JhbUN1c3RvbVBhcmFtZXRlcnMoYSkgewogICAgICAgIGNvbnN0IGIgPSB0aGlzLl9sYXN0UHJvZ3JhbTsKICAgICAgICBpZiAoMCAhPT0gYS5sZW5ndGggJiYgIWIuQXJlQ3VzdG9tUGFyYW1ldGVyc0FscmVhZHlTZXRJbkJhdGNoKGEpKSB7CiAgICAgICAgICAgIHZhciBkID0KICAgICAgICAgICAgICAgIHRoaXMuUHVzaEJhdGNoKCk7CiAgICAgICAgICAgIGQuSW5pdFNldFByb2dyYW1DdXN0b21QYXJhbWV0ZXJzKCk7CiAgICAgICAgICAgIGIuU2V0Q3VzdG9tUGFyYW1ldGVyc0luQmF0Y2goYSk7CiAgICAgICAgICAgIEMzJGpzY29tcCQ1MC5zaGFsbG93QXNzaWduQXJyYXkoZC5fc2hhZGVyUGFyYW1zLCBhKTsKICAgICAgICAgICAgdGhpcy5fdG9wT2ZCYXRjaCA9IDAKICAgICAgICB9CiAgICB9CiAgICBDbGVhclJnYmEoYSwgYiwgZCwgYykgewogICAgICAgIHRoaXMuUHVzaEJhdGNoKCkuSW5pdENsZWFyU3VyZmFjZTIoYSwgYiwgZCwgYyk7CiAgICAgICAgdGhpcy5fdG9wT2ZCYXRjaCA9IDAKICAgIH0KICAgIENsZWFyKGEpIHsKICAgICAgICB0aGlzLlB1c2hCYXRjaCgpLkluaXRDbGVhclN1cmZhY2UoYSk7CiAgICAgICAgdGhpcy5fdG9wT2ZCYXRjaCA9IDAKICAgIH0KICAgIFN0YXJ0KCkge30KICAgIEZpbmlzaCgpIHsKICAgICAgICBzdXBlci5GaW5pc2goKTsKICAgICAgICB0aGlzLl9nbC5mbHVzaCgpCiAgICB9CiAgICBDbGVhckRlcHRoKCkgewogICAgICAgIHRoaXMuX3VzZXNEZXB0aEJ1ZmZlciAmJiB0aGlzLl9jdXJyZW50UmVuZGVyVGFyZ2V0ICYmIHRoaXMuX2N1cnJlbnRSZW5kZXJUYXJnZXQuSGFzRGVwdGhCdWZmZXIoKSAmJiAodGhpcy5QdXNoQmF0Y2goKS5Jbml0Q2xlYXJEZXB0aCh0aGlzLl9pc0RlcHRoRW5hYmxlZCksCiAgICAgICAgICAgIHRoaXMuX3RvcE9mQmF0Y2ggPSAwKQogICAgfQogICAgU2V0RGVwdGhFbmFibGVkKGEpIHsKICAgICAgICBhID0gISFhOwogICAgICAgIHRoaXMuX2lzRGVwdGhFbmFibGVkICE9PSBhICYmIHRoaXMuX3VzZXNEZXB0aEJ1ZmZlciAmJiAodGhpcy5faXNEZXB0aEVuYWJsZWQgPSBhLCB0aGlzLlB1c2hCYXRjaCgpLkluaXRTZXREZXB0aEVuYWJsZWQoYSksIHRoaXMuX3RvcE9mQmF0Y2ggPSAwKQogICAgfQogICAgSXNEZXB0aEVuYWJsZWQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2lzRGVwdGhFbmFibGVkCiAgICB9CiAgICBfR2V0RGVwdGhCdWZmZXIoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2RlcHRoQnVmZmVyCiAgICB9CiAgICBfQ2FuU2FtcGxlRGVwdGgoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2NhblNhbXBsZURlcHRoCiAgICB9CiAgICBTZXREZXB0aFNhbXBsaW5nRW5hYmxlZChhKSB7CiAgICAgICAgYSA9ICEhYTsKICAgICAgICBpZiAodGhpcy5fY2FuU2FtcGxlRGVwdGggJiYgdGhpcy5faXNEZXB0aFNhbXBsaW5nRW5hYmxlZCAhPT0gYSkgewogICAgICAgICAgICBpZiAoYSAmJiB0aGlzLklzRGVwdGhFbmFibGVkKCkpIHRocm93IEVycm9yKCJkZXB0aCBzdGlsbCBlbmFibGVkIik7CiAgICAgICAgICAgIHRoaXMuX2lzRGVwdGhTYW1wbGluZ0VuYWJsZWQgPSBhOwogICAgICAgICAgICB0aGlzLlB1c2hCYXRjaCgpLkluaXRTZXREZXB0aFNhbXBsaW5nRW5hYmxlZChhKTsKICAgICAgICAgICAgdGhpcy5fdG9wT2ZCYXRjaCA9IDAKICAgICAgICB9CiAgICB9CiAgICBTZXRTY2lzc29yUmVjdChhLCBiLCBkLCBjLCBlID0gMCkgewogICAgICAgIGEgPSBNYXRoLmZsb29yKGEpOwogICAgICAgIGIgPSBNYXRoLmZsb29yKGIpOwogICAgICAgIGQgPSBNYXRoLmZsb29yKGQpOwogICAgICAgIGMgPSBNYXRoLmZsb29yKGMpOwogICAgICAgIHRoaXMuX2xhc3RTY2lzc29yUmVjdC5lcXVhbHNXSChhLCBiLCBkLCBjKSB8fCAodGhpcy5fbGFzdFNjaXNzb3JSZWN0LnNldFdIKGEsIGIsIGQsIGMpLCBiID0gKGUgfHwgdGhpcy5HZXRSZW5kZXJUYXJnZXRTaXplKHRoaXMuR2V0UmVuZGVyVGFyZ2V0KCkpWzFdKSAtIGIgLSBjLCB0aGlzLlB1c2hCYXRjaCgpLkluaXRTZXRTY2lzc29yKCEwLCBhLCBiLCBkLCBjKSwgdGhpcy5fdG9wT2ZCYXRjaCA9IDApCiAgICB9CiAgICBSZW1vdmVTY2lzc29yUmVjdCgpIHsKICAgICAgICAtMSAhPT0gdGhpcy5fbGFzdFNjaXNzb3JSZWN0LmdldFJpZ2h0KCkgJiYgKHRoaXMuX2xhc3RTY2lzc29yUmVjdC5zZXQoMCwgMCwgLTEsIC0xKSwgdGhpcy5QdXNoQmF0Y2goKS5Jbml0U2V0U2Npc3NvcighMSwgMCwgMCwgMCwgMCksIHRoaXMuX3RvcE9mQmF0Y2ggPSAwKQogICAgfQogICAgQ2hlY2tGb3JRdWVyeVJlc3VsdHMoKSB7CiAgICAgICAgZm9yIChjb25zdCBhIG9mIHRoaXMuX2FsbFF1ZXJ5UmVzdWx0QnVmZmVycykgYS5DaGVja0ZvclJlc3VsdHModGhpcy5fZnJhbWVOdW1iZXIpCiAgICB9CiAgICBJc0NvbnRleHRMb3N0KCkgewogICAgICAgIHJldHVybiAhdGhpcy5fZ2wgfHwKICAgICAgICAgICAgdGhpcy5fZ2wuaXNDb250ZXh0TG9zdCgpIHx8IHRoaXMuX2lzSW5pdGlhbGlzaW5nQWZ0ZXJDb250ZXh0UmVzdG9yZWQKICAgIH0KICAgIE9uQ29udGV4dExvc3QoKSB7CiAgICAgICAgc3VwZXIuT25EZXZpY2VPckNvbnRleHRMb3N0KCk7CiAgICAgICAgQzMkanNjb21wJDUwLkdmeC5XZWJHTFJlbmRlcmVyVGV4dHVyZS5PbkNvbnRleHRMb3N0KCk7CiAgICAgICAgQzMkanNjb21wJDUwLkdmeC5XZWJHTFJlbmRlclRhcmdldC5PbkNvbnRleHRMb3N0KCk7CiAgICAgICAgQzMkanNjb21wJDUwLkdmeC5SZW5kZXJlclRleHQuT25Db250ZXh0TG9zdCgpOwogICAgICAgIGZvciAoY29uc3QgYSBvZiB0aGlzLl9hbGxRdWVyeVJlc3VsdEJ1ZmZlcnMpIGEuQ2xlYXIoKTsKICAgICAgICB0aGlzLl9leHRlbnNpb25zID0gW107CiAgICAgICAgdGhpcy5fZnJhZ0RlcHRoRXh0ID0gdGhpcy5fZGVwdGhUZXh0dXJlRXh0ID0gdGhpcy5fYW5pc290cm9waWNFeHQgPSB0aGlzLl9wYXJhbGxlbFNoYWRlckNvbXBpbGVFeHQgPSB0aGlzLl90aW1lckV4dCA9IG51bGw7CiAgICAgICAgdGhpcy5fbWF4QW5pc290cm9weSA9IDA7CiAgICAgICAgdGhpcy5fdW5tYXNrZWRSZW5kZXJlciA9IHRoaXMuX3VubWFza2VkVmVuZG9yID0KICAgICAgICAgICAgIih1bmF2YWlsYWJsZSkiOwogICAgICAgIHRoaXMuX2RlcHRoQnVmZmVyID0gdGhpcy5fc3BEZXZpY2VUcmFuc2Zvcm1UZXh0dXJlRmlsbCA9IHRoaXMuX2xhc3RQcm9ncmFtID0gbnVsbDsKICAgICAgICBmb3IgKGNvbnN0IGEgb2YgdGhpcy5fc3RhdGVHcm91cHMudmFsdWVzKCkpIGEuT25Db250ZXh0TG9zdCgpCiAgICB9CiAgICBhc3luYyBPbkNvbnRleHRSZXN0b3JlZCgpIHsKICAgICAgICB0aGlzLl9pc0luaXRpYWxpc2luZ0FmdGVyQ29udGV4dFJlc3RvcmVkID0gITA7CiAgICAgICAgYXdhaXQgdGhpcy5Jbml0U3RhdGUoKTsKICAgICAgICB0aGlzLl9pc0luaXRpYWxpc2luZ0FmdGVyQ29udGV4dFJlc3RvcmVkID0gITE7CiAgICAgICAgZm9yIChjb25zdCBhIG9mIHRoaXMuX3N0YXRlR3JvdXBzLnZhbHVlcygpKSBhLk9uQ29udGV4dFJlc3RvcmVkKHRoaXMpOwogICAgICAgIHRoaXMuU2V0U2l6ZSh0aGlzLl93aWR0aCwgdGhpcy5faGVpZ2h0LCAhMCkKICAgIH0KICAgIENyZWF0ZVN0YXRpY1RleHR1cmUoYSwgYikgewogICAgICAgIGlmICh0aGlzLklzQ29udGV4dExvc3QoKSkgdGhyb3cgRXJyb3IoImNvbnRleHQgbG9zdCIpOwogICAgICAgIHRoaXMuRW5kQmF0Y2goKTsKICAgICAgICBjb25zdCBkID0gQzMkanNjb21wJDUwLk5ldyhDMyRqc2NvbXAkNTAuR2Z4LldlYkdMUmVuZGVyZXJUZXh0dXJlLAogICAgICAgICAgICB0aGlzKTsKICAgICAgICBkLl9DcmVhdGVTdGF0aWMoYSwgYik7CiAgICAgICAgcmV0dXJuIGQKICAgIH0KICAgIGFzeW5jIENyZWF0ZVN0YXRpY1RleHR1cmVBc3luYyhhLCBiKSB7CiAgICAgICAgaWYgKHRoaXMuSXNDb250ZXh0TG9zdCgpKSB0aHJvdyBFcnJvcigiY29udGV4dCBsb3N0Iik7CiAgICAgICAgYiA9IE9iamVjdC5hc3NpZ24oe30sIGIpOwogICAgICAgIGlmICghQzMkanNjb21wJDUwLlN1cHBvcnRzLkltYWdlQml0bWFwT3B0aW9ucyB8fCAiU2FmYXJpIiA9PT0gQzMkanNjb21wJDUwLlBsYXRmb3JtLkJyb3dzZXIgJiYgYSBpbnN0YW5jZW9mIEltYWdlRGF0YSAmJiAidW5kZWZpbmVkIiAhPT0gdHlwZW9mIEltYWdlKSB7CiAgICAgICAgICAgIGlmIChhIGluc3RhbmNlb2YgQmxvYikgewogICAgICAgICAgICAgICAgaWYgKCJ1bmRlZmluZWQiID09PSB0eXBlb2YgSW1hZ2UpIHRocm93IEVycm9yKCJ0ZXh0dXJlIHVwbG9hZCB2YXJpYW50IG5vdCBzdXBwb3J0ZWQgaW4gd29ya2VyIik7CiAgICAgICAgICAgICAgICBhID0gYXdhaXQgQzMkanNjb21wJDUwLkJsb2JUb0ltYWdlKGEpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGF3YWl0IEMzJGpzY29tcCQ1MC5Bc3luY2lmeSgoKSA9PiB0aGlzLkNyZWF0ZVN0YXRpY1RleHR1cmUoYSwKICAgICAgICAgICAgICAgIGIpKQogICAgICAgIH0KICAgICAgICBsZXQgZCA9IGF3YWl0IGNyZWF0ZUltYWdlQml0bWFwKGEsIHsKICAgICAgICAgICAgcHJlbXVsdGlwbHlBbHBoYTogInByZW11bHRpcGx5IgogICAgICAgIH0pOwogICAgICAgIGNvbnN0IGMgPSBiLndyYXBYICYmICJjbGFtcC10by1lZGdlIiAhPT0gYi53cmFwWCB8fCBiLndyYXBZICYmICJjbGFtcC10by1lZGdlIiAhPT0gYi53cmFwWSwKICAgICAgICAgICAgZSA9IEMzJGpzY29tcCQ1MC5pc1BPVChkLndpZHRoKSAmJiBDMyRqc2NvbXAkNTAuaXNQT1QoZC5oZWlnaHQpOwogICAgICAgIHRoaXMuU3VwcG9ydHNOUE9UVGV4dHVyZXMoKSB8fCBlIHx8ICFjID8gYi5wcmVtdWx0aXBseUFscGhhID0gITEgOiBDMyRqc2NvbXAkNTAuU3VwcG9ydHMuSW1hZ2VCaXRtYXBPcHRpb25zUmVzaXplID8gKGQgPSBhd2FpdCBjcmVhdGVJbWFnZUJpdG1hcChhLCB7CiAgICAgICAgICAgIHByZW11bHRpcGx5QWxwaGE6ICJwcmVtdWx0aXBseSIsCiAgICAgICAgICAgIHJlc2l6ZVdpZHRoOiBDMyRqc2NvbXAkNTAubmV4dEhpZ2hlc3RQb3dlck9mVHdvKGQud2lkdGgpLAogICAgICAgICAgICByZXNpemVIZWlnaHQ6IEMzJGpzY29tcCQ1MC5uZXh0SGlnaGVzdFBvd2VyT2ZUd28oZC5oZWlnaHQpCiAgICAgICAgfSksIGIucHJlbXVsdGlwbHlBbHBoYSA9ICExKSA6IGQgPSBhd2FpdCBjcmVhdGVJbWFnZUJpdG1hcChhLCB7CiAgICAgICAgICAgIHByZW11bHRpcGx5QWxwaGE6ICJub25lIgogICAgICAgIH0pOwogICAgICAgIHJldHVybiBhd2FpdCBDMyRqc2NvbXAkNTAuQXN5bmNpZnkoKCkgPT4gdGhpcy5DcmVhdGVTdGF0aWNUZXh0dXJlKGQsIGIpKQogICAgfQogICAgQ3JlYXRlRHluYW1pY1RleHR1cmUoYSwgYiwgZCkgewogICAgICAgIHRoaXMuRW5kQmF0Y2goKTsKICAgICAgICBjb25zdCBjID0gQzMkanNjb21wJDUwLk5ldyhDMyRqc2NvbXAkNTAuR2Z4LldlYkdMUmVuZGVyZXJUZXh0dXJlLCB0aGlzKTsKICAgICAgICBjLl9DcmVhdGVEeW5hbWljKGEsIGIsIGQpOwogICAgICAgIHJldHVybiBjCiAgICB9CiAgICBVcGRhdGVUZXh0dXJlKGEsIGIsIGQpIHsKICAgICAgICB0aGlzLkVuZEJhdGNoKCk7CiAgICAgICAgYi5fVXBkYXRlKGEsIGQpCiAgICB9CiAgICBEZWxldGVUZXh0dXJlKGEpIHsKICAgICAgICBhICYmIChhLlN1YnRyYWN0UmVmZXJlbmNlKCksIDAgPCBhLkdldFJlZmVyZW5jZUNvdW50KCkgfHwgKHRoaXMuRW5kQmF0Y2goKSwgYSA9PT0gdGhpcy5fbGFzdFRleHR1cmUwICYmICh0aGlzLl9nbC5iaW5kVGV4dHVyZSh0aGlzLl9nbC5URVhUVVJFXzJELCBudWxsKSwgdGhpcy5fbGFzdFRleHR1cmUwID0KICAgICAgICAgICAgbnVsbCksIGEgPT09IHRoaXMuX2xhc3RUZXh0dXJlMSAmJiAodGhpcy5fZ2wuYWN0aXZlVGV4dHVyZSh0aGlzLl9nbC5URVhUVVJFMSksIHRoaXMuX2dsLmJpbmRUZXh0dXJlKHRoaXMuX2dsLlRFWFRVUkVfMkQsIG51bGwpLCB0aGlzLl9nbC5hY3RpdmVUZXh0dXJlKHRoaXMuX2dsLlRFWFRVUkUwKSwgdGhpcy5fbGFzdFRleHR1cmUxID0gbnVsbCksIGEuX0RlbGV0ZSgpKSkKICAgIH0KICAgIENyZWF0ZVJlbmRlclRhcmdldChhKSB7CiAgICAgICAgbGV0IGIgPSB0aGlzLl93aWR0aCwKICAgICAgICAgICAgZCA9IHRoaXMuX2hlaWdodCwKICAgICAgICAgICAgYyA9ICEwOwogICAgICAgIGEgJiYgKCJudW1iZXIiID09PSB0eXBlb2YgYS53aWR0aCAmJiAoYiA9IGEud2lkdGgsIGMgPSAhMSksICJudW1iZXIiID09PSB0eXBlb2YgYS5oZWlnaHQgJiYgKGQgPSBhLmhlaWdodCwgYyA9ICExKSk7CiAgICAgICAgaWYgKDAgPj0gYiB8fCAwID49IGQpIHRocm93IEVycm9yKCJpbnZhbGlkIHNpemUiKTsKICAgICAgICB0aGlzLkVuZEJhdGNoKCk7CiAgICAgICAgY29uc3QgZSA9IEMzJGpzY29tcCQ1MC5OZXcoQzMkanNjb21wJDUwLkdmeC5XZWJHTFJlbmRlclRhcmdldCwgdGhpcyk7CiAgICAgICAgZS5fQ3JlYXRlKGIsIGQsIE9iamVjdC5hc3NpZ24oewogICAgICAgICAgICAgICAgaXNEZWZhdWx0U2l6ZTogYwogICAgICAgICAgICB9LAogICAgICAgICAgICBhKSk7CiAgICAgICAgdGhpcy5fY3VycmVudFJlbmRlclRhcmdldCA9IG51bGw7CiAgICAgICAgdGhpcy5fYmF0Y2hTdGF0ZS5jdXJyZW50RnJhbWVidWZmZXIgPSBudWxsOwogICAgICAgIHRoaXMuX2JhdGNoU3RhdGUuY3VycmVudEZyYW1lYnVmZmVyTm9EZXB0aCA9IG51bGw7CiAgICAgICAgcmV0dXJuIGUKICAgIH0KICAgIFNldFJlbmRlclRhcmdldChhLCBiID0gITApIHsKICAgICAgICBhICE9PSB0aGlzLl9jdXJyZW50UmVuZGVyVGFyZ2V0ICYmIChhICYmIGEuSXNEZWZhdWx0U2l6ZSgpICYmIGEuX1Jlc2l6ZSh0aGlzLl93aWR0aCwgdGhpcy5faGVpZ2h0KSwgdGhpcy5QdXNoQmF0Y2goKS5Jbml0U2V0UmVuZGVyVGFyZ2V0KGEpLCB0aGlzLl9jdXJyZW50UmVuZGVyVGFyZ2V0ID0gYSwgdGhpcy5fdG9wT2ZCYXRjaCA9IDAsIGIgJiYgdGhpcy5TZXREZWZhdWx0UmVuZGVyVGFyZ2V0UHJvamVjdGlvblN0YXRlKCkpCiAgICB9CiAgICBHZXRSZW5kZXJUYXJnZXQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2N1cnJlbnRSZW5kZXJUYXJnZXQKICAgIH0KICAgIEdldFJlbmRlclRhcmdldFNpemUoYSkgewogICAgICAgIHJldHVybiBhID8gW2EuR2V0V2lkdGgoKSwgYS5HZXRIZWlnaHQoKV0gOiBbdGhpcy5fd2lkdGgsCiAgICAgICAgICAgIHRoaXMuX2hlaWdodAogICAgICAgIF0KICAgIH0KICAgIENvcHlSZW5kZXJUYXJnZXQoYSwgYiA9ICJzdHJldGNoIikgewogICAgICAgIDIgPiB0aGlzLl92ZXJzaW9uIHx8IHRoaXMuX2N1cnJlbnRSZW5kZXJUYXJnZXQgJiYgMCA8IHRoaXMuX2N1cnJlbnRSZW5kZXJUYXJnZXQuR2V0TXVsdGlzYW1wbGluZygpID8gKHRoaXMuU2V0Q29weUJsZW5kKCksIHRoaXMuUmVzZXRDb2xvcigpLCB0aGlzLkRyYXdSZW5kZXJUYXJnZXQoYSwgYikpIDogKHRoaXMuUHVzaEJhdGNoKCkuSW5pdEJsaXRGcmFtZWJ1ZmZlcihhLCB0aGlzLl9jdXJyZW50UmVuZGVyVGFyZ2V0LCBiKSwgdGhpcy5fdG9wT2ZCYXRjaCA9IDApCiAgICB9CiAgICBEcmF3UmVuZGVyVGFyZ2V0KGEsIGIgPSAic3RyZXRjaCIpIHsKICAgICAgICBhID0gYS5HZXRUZXh0dXJlKCk7CiAgICAgICAgaWYgKCFhKSB0aHJvdyBFcnJvcigibm90IGEgdGV4dHVyZS1iYWNrZWQgcmVuZGVyIHRhcmdldCIpOwogICAgICAgIHRoaXMuU2V0VGV4dHVyZShhKTsKICAgICAgICB0aGlzLkZ1bGxzY3JlZW5RdWFkKGIsIGEpCiAgICB9CiAgICBJbnZhbGlkYXRlUmVuZGVyVGFyZ2V0KGEpIHsKICAgICAgICAyID4gdGhpcy5fdmVyc2lvbiB8fCAodGhpcy5QdXNoQmF0Y2goKS5Jbml0SW52YWxpZGF0ZUZyYW1lYnVmZmVyKGEuX0dldEZyYW1lYnVmZmVyKCkpLAogICAgICAgICAgICB0aGlzLl90b3BPZkJhdGNoID0gMCkKICAgIH0KICAgIERlbGV0ZVJlbmRlclRhcmdldChhKSB7CiAgICAgICAgdGhpcy5TZXRSZW5kZXJUYXJnZXQobnVsbCk7CiAgICAgICAgdGhpcy5FbmRCYXRjaCgpOwogICAgICAgIGNvbnN0IGIgPSBhLkdldFRleHR1cmUoKTsKICAgICAgICBiID09PSB0aGlzLl9sYXN0VGV4dHVyZTAgJiYgKHRoaXMuX2dsLmJpbmRUZXh0dXJlKHRoaXMuX2dsLlRFWFRVUkVfMkQsIG51bGwpLCB0aGlzLl9sYXN0VGV4dHVyZTAgPSBudWxsKTsKICAgICAgICBiID09PSB0aGlzLl9sYXN0VGV4dHVyZTEgJiYgKHRoaXMuX2dsLmFjdGl2ZVRleHR1cmUodGhpcy5fZ2wuVEVYVFVSRTEpLCB0aGlzLl9nbC5iaW5kVGV4dHVyZSh0aGlzLl9nbC5URVhUVVJFXzJELCBudWxsKSwgdGhpcy5fZ2wuYWN0aXZlVGV4dHVyZSh0aGlzLl9nbC5URVhUVVJFMCksIHRoaXMuX2xhc3RUZXh0dXJlMSA9IG51bGwpOwogICAgICAgIGEuX0RlbGV0ZSgpCiAgICB9CiAgICBhc3luYyBSZWFkQmFja1JlbmRlclRhcmdldFRvSW1hZ2VEYXRhKGEsIGIsIGQpIHsKICAgICAgICB0aGlzLkVuZEJhdGNoKCk7CiAgICAgICAgY29uc3QgYyA9IHRoaXMuX2N1cnJlbnRSZW5kZXJUYXJnZXQ7CiAgICAgICAgaWYgKGEpIHsKICAgICAgICAgICAgdmFyIGUgPQogICAgICAgICAgICAgICAgYS5HZXRXaWR0aCgpOwogICAgICAgICAgICB2YXIgZyA9IGEuR2V0SGVpZ2h0KCk7CiAgICAgICAgICAgIHZhciBrID0gYS5fR2V0RnJhbWVidWZmZXIoKQogICAgICAgIH0gZWxzZSBlID0gdGhpcy5HZXRXaWR0aCgpLCBnID0gdGhpcy5HZXRIZWlnaHQoKSwgayA9IG51bGw7CiAgICAgICAgbGV0IG0gPSBhID0gMDsKICAgICAgICB2YXIgbiA9IGUsCiAgICAgICAgICAgIHEgPSBnOwogICAgICAgIGQgJiYgKGEgPSBDMyRqc2NvbXAkNTAuY2xhbXAoTWF0aC5mbG9vcihkLmdldExlZnQoKSksIDAsIGUgLSAxKSwgbSA9IEMzJGpzY29tcCQ1MC5jbGFtcChNYXRoLmZsb29yKGQuZ2V0VG9wKCkpLCAwLCBnIC0gMSksIG4gPSBkLndpZHRoKCksIG4gPSAwID09PSBuID8gZSAtIGEgOiBDMyRqc2NvbXAkNTAuY2xhbXAoTWF0aC5mbG9vcihuKSwgMCwgZSAtIGEpLCBxID0gZC5oZWlnaHQoKSwgcSA9IDAgPT09IHEgPyBnIC0gbSA6IEMzJGpzY29tcCQ1MC5jbGFtcChNYXRoLmZsb29yKHEpLCAwLCBnIC0gbSksIG0gPSBnIC0gKG0gKyBxKSk7CiAgICAgICAgY29uc3QgdSA9IHRoaXMuX2dsOwogICAgICAgIHUuYmluZEZyYW1lYnVmZmVyKHUuRlJBTUVCVUZGRVIsIGspOwogICAgICAgIGcgPSAoKSA9PiB7CiAgICAgICAgICAgIHUuYmluZEZyYW1lYnVmZmVyKHUuRlJBTUVCVUZGRVIsIG51bGwpOwogICAgICAgICAgICB0aGlzLl9jdXJyZW50UmVuZGVyVGFyZ2V0ID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fYmF0Y2hTdGF0ZS5jdXJyZW50RnJhbWVidWZmZXIgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9iYXRjaFN0YXRlLmN1cnJlbnRGcmFtZWJ1ZmZlck5vRGVwdGggPSBudWxsOwogICAgICAgICAgICB0aGlzLlNldFJlbmRlclRhcmdldChjKQogICAgICAgIH07CiAgICAgICAgaWYgKCFiICYmIDIgPD0gdGhpcy5HZXRXZWJHTFZlcnNpb25OdW1iZXIoKSkgewogICAgICAgICAgICB1LmJpbmRGcmFtZWJ1ZmZlcih1LlJFQURfRlJBTUVCVUZGRVIsIGspOwogICAgICAgICAgICBrID0gdS5jcmVhdGVCdWZmZXIoKTsKICAgICAgICAgICAgZCA9IG4gKiBxICogNDsKICAgICAgICAgICAgZSA9IHUuUElYRUxfUEFDS19CVUZGRVI7CiAgICAgICAgICAgIHUuYmluZEJ1ZmZlcihlLCBrKTsKICAgICAgICAgICAgdS5idWZmZXJEYXRhKGUsIGQsIHUuU1RSRUFNX1JFQUQpOwogICAgICAgICAgICB1LnJlYWRQaXhlbHMoYSwgbSwgbiwgcSwgdS5SR0JBLCB1LlVOU0lHTkVEX0JZVEUsIDApOwogICAgICAgICAgICB1LmJpbmRGcmFtZWJ1ZmZlcih1LlJFQURfRlJBTUVCVUZGRVIsIG51bGwpOwogICAgICAgICAgICB1LmJpbmRCdWZmZXIoZSwgbnVsbCk7CiAgICAgICAgICAgIGcoKTsKICAgICAgICAgICAgY29uc3QgdyA9IHUuZmVuY2VTeW5jKHUuU1lOQ19HUFVfQ09NTUFORFNfQ09NUExFVEUsIDApOwogICAgICAgICAgICBhd2FpdCB0aGlzLl9XYWl0Rm9yT2JqZWN0UmVhZHkoKCkgPT4gdS5nZXRTeW5jUGFyYW1ldGVyKHcsCiAgICAgICAgICAgICAgICB1LlNZTkNfU1RBVFVTKSA9PT0gdS5TSUdOQUxFRCk7CiAgICAgICAgICAgIHUuZGVsZXRlU3luYyh3KTsKICAgICAgICAgICAgYiA9IG5ldyBJbWFnZURhdGEobiwgcSk7CiAgICAgICAgICAgIHUuYmluZEJ1ZmZlcihlLCBrKTsKICAgICAgICAgICAgdS5nZXRCdWZmZXJTdWJEYXRhKGUsIDAsIG5ldyBVaW50OEFycmF5KGIuZGF0YS5idWZmZXIpLCAwLCBkKTsKICAgICAgICAgICAgdS5iaW5kQnVmZmVyKGUsIG51bGwpOwogICAgICAgICAgICB1LmRlbGV0ZUJ1ZmZlcihrKQogICAgICAgIH0gZWxzZSBiID0gbmV3IEltYWdlRGF0YShuLCBxKSwgdS5yZWFkUGl4ZWxzKGEsIG0sIG4sIHEsIHUuUkdCQSwgdS5VTlNJR05FRF9CWVRFLCBuZXcgVWludDhBcnJheShiLmRhdGEuYnVmZmVyKSksIGcoKTsKICAgICAgICByZXR1cm4gYgogICAgfQogICAgQ29wbGFuYXJTdGFydFN0ZW5jaWxQYXNzKCkgewogICAgICAgIHRoaXMuU2V0RGVwdGhFbmFibGVkKCEwKTsKICAgICAgICB0aGlzLlB1c2hCYXRjaCgpLkluaXRDb3BsYW5hclN0YXJ0U3RlbmNpbFBhc3MoKTsKICAgICAgICB0aGlzLl90b3BPZkJhdGNoID0gMAogICAgfQogICAgQ29wbGFuYXJTdGFydENvbG9yUGFzcygpIHsKICAgICAgICB0aGlzLlNldERlcHRoRW5hYmxlZCghMSk7CiAgICAgICAgdGhpcy5QdXNoQmF0Y2goKS5Jbml0Q29wbGFuYXJTdGFydENvbG9yUGFzcygpOwogICAgICAgIHRoaXMuX3RvcE9mQmF0Y2ggPSAwCiAgICB9CiAgICBDb3BsYW5hclJlc3RvcmVTdGFuZGFyZFJlbmRlcmluZygpIHsKICAgICAgICB0aGlzLlNldERlcHRoRW5hYmxlZCghMCk7CiAgICAgICAgdGhpcy5QdXNoQmF0Y2goKS5Jbml0Q29wbGFuYXJSZXN0b3JlKCk7CiAgICAgICAgdGhpcy5fdG9wT2ZCYXRjaCA9IDAKICAgIH0KICAgIFN0YXJ0UXVlcnkoYSkgewogICAgICAgIHRoaXMuU3VwcG9ydHNHUFVQcm9maWxpbmcoKSAmJiAodGhpcy5QdXNoQmF0Y2goKS5Jbml0U3RhcnRRdWVyeShhKSwgdGhpcy5fdG9wT2ZCYXRjaCA9IDApCiAgICB9CiAgICBFbmRRdWVyeShhKSB7CiAgICAgICAgdGhpcy5TdXBwb3J0c0dQVVByb2ZpbGluZygpICYmICh0aGlzLlB1c2hCYXRjaCgpLkluaXRFbmRRdWVyeShhKSwgdGhpcy5fdG9wT2ZCYXRjaCA9IDApCiAgICB9CiAgICBfV2FpdEZvck9iamVjdFJlYWR5KGEpIHsKICAgICAgICBjb25zdCBiID0gbmV3IFByb21pc2UoZCA9PiBwZW5kaW5nUG9sbHMuYWRkKHsKICAgICAgICAgICAgcmVzb2x2ZTogZCwKICAgICAgICAgICAgY2hlY2tGdW5jOiBhCiAgICAgICAgfSkpOyAtIDEgPT09IHBvbGxSYWZJZCAmJiAocG9sbFJhZklkID0gc2VsZi5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoQ2hlY2tQZW5kaW5nUG9sbHMpKTsKICAgICAgICByZXR1cm4gYgogICAgfQogICAgSXNEZXN5bmNocm9uaXplZCgpIHsKICAgICAgICByZXR1cm4gISF0aGlzLl9hdHRyaWJzLmRlc3luY2hyb25pemVkCiAgICB9CiAgICBHZXRFc3RpbWF0ZWRCYWNrQnVmZmVyTWVtb3J5VXNhZ2UoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3dpZHRoICoKICAgICAgICAgICAgdGhpcy5faGVpZ2h0ICogKHRoaXMuX2F0dHJpYnMuYWxwaGEgPyA0IDogMykKICAgIH0KICAgIEdldEVzdGltYXRlZFJlbmRlckJ1ZmZlck1lbW9yeVVzYWdlKCkgewogICAgICAgIGxldCBhID0gMDsKICAgICAgICBmb3IgKGNvbnN0IGIgb2YgQzMkanNjb21wJDUwLkdmeC5XZWJHTFJlbmRlclRhcmdldC5hbGxSZW5kZXJUYXJnZXRzKCkpIGIuR2V0VGV4dHVyZSgpIHx8IChhICs9IGIuR2V0RXN0aW1hdGVkTWVtb3J5VXNhZ2UoKSk7CiAgICAgICAgcmV0dXJuIGEKICAgIH0KICAgIEdldEVzdGltYXRlZFRleHR1cmVNZW1vcnlVc2FnZSgpIHsKICAgICAgICBsZXQgYSA9IDA7CiAgICAgICAgZm9yIChjb25zdCBiIG9mIEMzJGpzY29tcCQ1MC5HZnguV2ViR0xSZW5kZXJlclRleHR1cmUuYWxsVGV4dHVyZXMoKSkgYSArPSBiLkdldEVzdGltYXRlZE1lbW9yeVVzYWdlKCk7CiAgICAgICAgcmV0dXJuIGEKICAgIH0KICAgIEdldEVzdGltYXRlZFRvdGFsTWVtb3J5VXNhZ2UoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuR2V0RXN0aW1hdGVkQmFja0J1ZmZlck1lbW9yeVVzYWdlKCkgKyB0aGlzLkdldEVzdGltYXRlZFJlbmRlckJ1ZmZlck1lbW9yeVVzYWdlKCkgKyB0aGlzLkdldEVzdGltYXRlZFRleHR1cmVNZW1vcnlVc2FnZSgpCiAgICB9CiAgICBHZXRXZWJHTFZlcnNpb25TdHJpbmcoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3ZlcnNpb25TdHJpbmcKICAgIH0KICAgIEdldFdlYkdMVmVyc2lvbk51bWJlcigpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdmVyc2lvbgogICAgfQogICAgR2V0RGlzcGxheU5hbWUoKSB7CiAgICAgICAgcmV0dXJuICJ3ZWJnbCIgKwogICAgICAgICAgICB0aGlzLkdldFdlYkdMVmVyc2lvbk51bWJlcigpCiAgICB9CiAgICBTdXBwb3J0c05QT1RUZXh0dXJlcygpIHsKICAgICAgICByZXR1cm4gMiA8PSB0aGlzLkdldFdlYkdMVmVyc2lvbk51bWJlcigpCiAgICB9CiAgICBHZXRNYXhUZXh0dXJlU2l6ZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fbWF4VGV4dHVyZVNpemUKICAgIH0KICAgIEdldE1pblBvaW50U2l6ZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fbWluUG9pbnRTaXplCiAgICB9CiAgICBHZXRNYXhQb2ludFNpemUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX21heFBvaW50U2l6ZQogICAgfQogICAgU3VwcG9ydHNIaWdoUCgpIHsKICAgICAgICByZXR1cm4gMCAhPT0gdGhpcy5faGlnaHBQcmVjaXNpb24KICAgIH0KICAgIEdldEhpZ2hQUHJlY2lzaW9uKCkgewogICAgICAgIHJldHVybiB0aGlzLl9oaWdocFByZWNpc2lvbgogICAgfQogICAgR2V0VW5tYXNrZWRWZW5kb3IoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3VubWFza2VkVmVuZG9yCiAgICB9CiAgICBHZXRVbm1hc2tlZFJlbmRlcmVyKCkgewogICAgICAgIHJldHVybiB0aGlzLl91bm1hc2tlZFJlbmRlcmVyCiAgICB9CiAgICBHZXRFeHRlbnNpb25zKCkgewogICAgICAgIHJldHVybiB0aGlzLl9leHRlbnNpb25zCiAgICB9CiAgICBTdXBwb3J0c0dQVVByb2ZpbGluZygpIHsKICAgICAgICByZXR1cm4gISF0aGlzLl90aW1lckV4dAogICAgfQogICAgX0dldERpc2pvaW50VGltZXJRdWVyeUV4dGVuc2lvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdGltZXJFeHQKICAgIH0KICAgIF9HZXRQYXJhbGxlbFNoYWRlckNvbXBpbGVFeHRlbnNpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3BhcmFsbGVsU2hhZGVyQ29tcGlsZUV4dAogICAgfQogICAgX0dldEFuaXNvdHJvcGljRXh0ZW5zaW9uKCkgewogICAgICAgIHJldHVybiB0aGlzLl9hbmlzb3Ryb3BpY0V4dAogICAgfQogICAgX0dldE1heEFuaXNvdHJvcHkoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX21heEFuaXNvdHJvcHkKICAgIH0KICAgIF9BZGRRdWVyeVJlc3VsdEJ1ZmZlcihhKSB7CiAgICAgICAgdGhpcy5fYWxsUXVlcnlSZXN1bHRCdWZmZXJzLmFkZChhKQogICAgfQogICAgX1JlbW92ZVF1ZXJ5UmVzdWx0QnVmZmVyKGEpIHsKICAgICAgICB0aGlzLl9hbGxRdWVyeVJlc3VsdEJ1ZmZlcnMuZGVsZXRlKGEpCiAgICB9CiAgICBfR2V0VGltZVF1ZXJ5U3RhY2soKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3RpbWVRdWVyeVN0YWNrCiAgICB9CiAgICBHZXRDb250ZXh0KCkgewogICAgICAgIHJldHVybiB0aGlzLl9nbAogICAgfQogICAgX0luaXRCbGVuZE1vZGVzKGEpIHsKICAgICAgICB0aGlzLl9Jbml0QmxlbmRNb2RlRGF0YShbCiAgICAgICAgICAgIFsibm9ybWFsIiwKICAgICAgICAgICAgICAgIGEuT05FLCBhLk9ORV9NSU5VU19TUkNfQUxQSEEKICAgICAgICAgICAgXSwKICAgICAgICAgICAgWyJhZGRpdGl2ZSIsIGEuT05FLCBhLk9ORV0sCiAgICAgICAgICAgIFsieG9yIiwgYS5PTkUsIGEuT05FX01JTlVTX1NSQ19BTFBIQV0sCiAgICAgICAgICAgIFsiY29weSIsIGEuT05FLCBhLlpFUk9dLAogICAgICAgICAgICBbImRlc3RpbmF0aW9uLW92ZXIiLCBhLk9ORV9NSU5VU19EU1RfQUxQSEEsIGEuT05FXSwKICAgICAgICAgICAgWyJzb3VyY2UtaW4iLCBhLkRTVF9BTFBIQSwgYS5aRVJPXSwKICAgICAgICAgICAgWyJkZXN0aW5hdGlvbi1pbiIsIGEuWkVSTywgYS5TUkNfQUxQSEFdLAogICAgICAgICAgICBbInNvdXJjZS1vdXQiLCBhLk9ORV9NSU5VU19EU1RfQUxQSEEsIGEuWkVST10sCiAgICAgICAgICAgIFsiZGVzdGluYXRpb24tb3V0IiwgYS5aRVJPLCBhLk9ORV9NSU5VU19TUkNfQUxQSEFdLAogICAgICAgICAgICBbInNvdXJjZS1hdG9wIiwgYS5EU1RfQUxQSEEsIGEuT05FX01JTlVTX1NSQ19BTFBIQV0sCiAgICAgICAgICAgIFsiZGVzdGluYXRpb24tYXRvcCIsIGEuT05FX01JTlVTX0RTVF9BTFBIQSwgYS5TUkNfQUxQSEFdCiAgICAgICAgXSkKICAgIH0KICAgIENyZWF0ZVJlbmRlcmVyVGV4dCgpIHsKICAgICAgICByZXR1cm4gQzMkanNjb21wJDUwLk5ldyhDMyRqc2NvbXAkNTAuR2Z4LlJlbmRlcmVyVGV4dCwKICAgICAgICAgICAgdGhpcykKICAgIH0KICAgIENyZWF0ZVdlYkdMVGV4dCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5DcmVhdGVSZW5kZXJlclRleHQoKQogICAgfQp9OwoidXNlIHN0cmljdCI7CmNvbnN0IERFRkFVTFRfQ1RPUl9PUFRTID0gewogICAgZ2V0RHJhd1NpemU6IG51bGwsCiAgICBnZXRSZW5kZXJUYXJnZXQ6IG51bGwsCiAgICByZWxlYXNlUmVuZGVyVGFyZ2V0OiBudWxsLAogICAgZ2V0VGltZTogbnVsbCwKICAgIHJlZHJhdzogbnVsbAp9OwpzZWxmLkMzLkdmeC5FZmZlY3RDaGFpbk1hbmFnZXIgPSBjbGFzcyB7CiAgICBjb25zdHJ1Y3RvcihhKSB7CiAgICAgICAgYSA9IE9iamVjdC5hc3NpZ24oe30sIERFRkFVTFRfQ1RPUl9PUFRTLCBhKTsKICAgICAgICB0aGlzLl9jYkdldERyYXdTaXplID0gYS5nZXREcmF3U2l6ZTsKICAgICAgICB0aGlzLl9jYkdldFJlbmRlclRhcmdldCA9IGEuZ2V0UmVuZGVyVGFyZ2V0OwogICAgICAgIHRoaXMuX2NiUmVsZWFzZVJlbmRlclRhcmdldCA9IGEucmVsZWFzZVJlbmRlclRhcmdldDsKICAgICAgICB0aGlzLl9jYkdldFRpbWUgPSBhLmdldFRpbWU7CiAgICAgICAgdGhpcy5fY2JSZWRyYXcgPSBhLnJlZHJhdzsKICAgICAgICB0aGlzLl93ZWJncHVCYWNrVGV4dHVyZSA9IG51bGwKICAgIH0KICAgIEdldERyYXdTaXplKGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5fY2JHZXREcmF3U2l6ZSA/IHRoaXMuX2NiR2V0RHJhd1NpemUoYSkgOiBbYS5HZXRXaWR0aCgpLCBhLkdldEhlaWdodCgpXQogICAgfQogICAgR2V0UmVuZGVyVGFyZ2V0KGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5fY2JHZXRSZW5kZXJUYXJnZXQoYSkKICAgIH0KICAgIFJlbGVhc2VSZW5kZXJUYXJnZXQoYSwgYikgewogICAgICAgIHRoaXMuX2NiUmVsZWFzZVJlbmRlclRhcmdldChhLCBiKQogICAgfQogICAgR2V0VGltZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fY2JHZXRUaW1lKCkKICAgIH0KICAgIFJlZHJhdyhhKSB7CiAgICAgICAgdGhpcy5fY2JSZWRyYXcoYSkKICAgIH0KICAgIF9HZXRXZWJHUFVCYWNrVGV4dHVyZShhLAogICAgICAgIGIsIGQpIHsKICAgICAgICAhdGhpcy5fd2ViZ3B1QmFja1RleHR1cmUgfHwgdGhpcy5fd2ViZ3B1QmFja1RleHR1cmUuR2V0V2lkdGgoKSA9PT0gYiAmJiB0aGlzLl93ZWJncHVCYWNrVGV4dHVyZS5HZXRIZWlnaHQoKSA9PT0gZCB8fCAoYS5EZWxldGVUZXh0dXJlKHRoaXMuX3dlYmdwdUJhY2tUZXh0dXJlKSwgdGhpcy5fd2ViZ3B1QmFja1RleHR1cmUgPSBudWxsKTsKICAgICAgICBudWxsID09PSB0aGlzLl93ZWJncHVCYWNrVGV4dHVyZSAmJiAodGhpcy5fd2ViZ3B1QmFja1RleHR1cmUgPSBhLkNyZWF0ZVN0YXRpY1RleHR1cmUobnVsbCwgewogICAgICAgICAgICB3aWR0aDogYiwKICAgICAgICAgICAgaGVpZ2h0OiBkLAogICAgICAgICAgICBzYW1wbGluZzogIm5lYXJlc3QiLAogICAgICAgICAgICBtaXBNYXA6ICExCiAgICAgICAgfSkpOwogICAgICAgIHJldHVybiB0aGlzLl93ZWJncHVCYWNrVGV4dHVyZQogICAgfQp9OwoidXNlIHN0cmljdCI7CmNvbnN0IEMzJGpzY29tcCQ1MiA9IHNlbGYuQzMsCiAgICBtYXQ0JGpzY29tcCQ4ID0gc2VsZi5nbE1hdHJpeC5tYXQ0LAogICAgdGVtcFJlY3QgPSBDMyRqc2NvbXAkNTIuTmV3KEMzJGpzY29tcCQ1Mi5SZWN0KSwKICAgIHRlbXBSZWN0MiA9IEMzJGpzY29tcCQ1Mi5OZXcoQzMkanNjb21wJDUyLlJlY3QpLAogICAgdGVtcFJlY3QzID0gQzMkanNjb21wJDUyLk5ldyhDMyRqc2NvbXAkNTIuUmVjdCksCiAgICB0ZW1wUmVjdDQgPSBDMyRqc2NvbXAkNTIuTmV3KEMzJGpzY29tcCQ1Mi5SZWN0KSwKICAgIHRlbXBNYXQ0YSA9IG1hdDQkanNjb21wJDguY3JlYXRlKCksCiAgICB0ZW1wTWF0NGIkanNjb21wJDEgPSBtYXQ0JGpzY29tcCQ4LmNyZWF0ZSgpLAogICAgREVGQVVMVF9DVE9SX09QVFMkanNjb21wJDEgPSB7CiAgICAgICAgZHJhd0NvbnRlbnQ6IG51bGwsCiAgICAgICAgZ2V0U291cmNlVGV4dHVyZUluZm86IG51bGwsCiAgICAgICAgZ2V0U2hhZGVyUGFyYW1ldGVyczogbnVsbCwKICAgICAgICBpbnZhbGlkYXRlUmVuZGVyVGFyZ2V0czogITEKICAgIH0sCiAgICBERUZBVUxUX0JVSUxEU1RFUFNfT1BUUyA9IHsKICAgICAgICBpbmRleE1hcDogbnVsbCwKICAgICAgICBmb3JjZVByZURyYXc6ICExLAogICAgICAgIGZvcmNlUG9zdERyYXc6ICExLAogICAgICAgIGlzM0Q6ICExLAogICAgICAgIGlzU291cmNlVGV4dHVyZVJvdGF0ZWQ6ICExLAogICAgICAgIGlzUm90YXRlZE9yTmVnYXRpdmVTaXplSW5zdGFuY2U6ICExLAogICAgICAgIHVzZUZ1bGxTdXJmYWNlOiAhMQogICAgfTsKQzMkanNjb21wJDUyLkdmeC5FZmZlY3RDaGFpbiA9IGNsYXNzIHsKICAgIGNvbnN0cnVjdG9yKGEsIGIpIHsKICAgICAgICBiID0gT2JqZWN0LmFzc2lnbih7fSwgREVGQVVMVF9DVE9SX09QVFMkanNjb21wJDEsIGIpOwogICAgICAgIHRoaXMuX21hbmFnZXIgPSBhOwogICAgICAgIHRoaXMuX2NiRHJhd0NvbnRlbnQgPSBiLmRyYXdDb250ZW50OwogICAgICAgIHRoaXMuX2NiR2V0U291cmNlVGV4dHVyZUluZm8gPSBiLmdldFNvdXJjZVRleHR1cmVJbmZvOwogICAgICAgIHRoaXMuX2NiR2V0U2hhZGVyUGFyYW1ldGVycyA9IGIuZ2V0U2hhZGVyUGFyYW1ldGVyczsKICAgICAgICB0aGlzLl9jYkRyYXdDb250ZW50SG9vayA9IG51bGw7CiAgICAgICAgdGhpcy5fc2hhZGVyUHJvZ3JhbUxpc3QgPSBbXTsKICAgICAgICB0aGlzLl9zaGFkZXJQcm9ncmFtSW5kaWNlcyA9IFtdOwogICAgICAgIHRoaXMuX3N0ZXBzID0gW107CiAgICAgICAgdGhpcy5fYmxlbmRNb2RlID0gMDsKICAgICAgICB0aGlzLl9pc1NvdXJjZVRleHR1cmVSb3RhdGVkID0gdGhpcy5fdXNlRnVsbFN1cmZhY2UgPSB0aGlzLl9jYW5Vc2VGYXN0UGF0aCA9IHRoaXMuX2RlcHRoRW5hYmxlZEF0U3RhcnQgPSB0aGlzLl9kaWRDaGFuZ2VUcmFuc2Zvcm0gPSB0aGlzLl91c2VDb3B5VGV4dHVyZUJhY2tncm91bmRTYW1wbGluZyA9CiAgICAgICAgICAgIHRoaXMuX2lzQW55SXNTcmNUZXhSb3RhdGVkID0gdGhpcy5faXNBbnlTaGFkZXJDcm9zc1NhbXBsaW5nID0gdGhpcy5faXNBbnlTaGFkZXJCYWNrZ3JvdW5kQmxlbmRpbmcgPSB0aGlzLl9pc0FueVNoYWRlckRlcHRoU2FtcGxpbmcgPSB0aGlzLl9pc0FueVNoYWRlckFuaW1hdGVkID0gITE7CiAgICAgICAgdGhpcy5fbnVtVGVtcFN1cmZhY2VzUmVxdWlyZWQgPSAwOwogICAgICAgIHRoaXMuX3JlbmRlclRhcmdldHMgPSBbbnVsbCwgbnVsbCwgbnVsbF07CiAgICAgICAgdGhpcy5faW52YWxpZGF0ZVJlbmRlclRhcmdldHMgPSAhIWIuaW52YWxpZGF0ZVJlbmRlclRhcmdldHM7CiAgICAgICAgdGhpcy5fZHJhd0hlaWdodCA9IHRoaXMuX2RyYXdXaWR0aCA9IHRoaXMuX2JveEV4dGVuZFZlcnRpY2FsID0gdGhpcy5fYm94RXh0ZW5kSG9yaXpvbnRhbCA9IDA7CiAgICAgICAgdGhpcy5fY29udGV4dE9iamVjdCA9IHRoaXMuX2NvbnRlbnRPYmplY3QgPSBudWxsOwogICAgICAgIHRoaXMuX2xheW91dFJlY3QgPSBDMyRqc2NvbXAkNTIuTmV3KEMzJGpzY29tcCQ1Mi5SZWN0KTsKICAgICAgICB0aGlzLl9kcmF3U3VyZmFjZVJlY3QgPSBDMyRqc2NvbXAkNTIuTmV3KEMzJGpzY29tcCQ1Mi5SZWN0KTsKICAgICAgICB0aGlzLl9yY1RleE9yaWdpbmFsID0gQzMkanNjb21wJDUyLk5ldyhDMyRqc2NvbXAkNTIuUmVjdCk7CiAgICAgICAgdGhpcy5fcmNUZXhCb3VuY2UgPSBDMyRqc2NvbXAkNTIuTmV3KEMzJGpzY29tcCQ1Mi5SZWN0KTsKICAgICAgICB0aGlzLl9yY1RleERlc3QgPSBDMyRqc2NvbXAkNTIuTmV3KEMzJGpzY29tcCQ1Mi5SZWN0KTsKICAgICAgICB0aGlzLl9sYXllclNjYWxlID0gdGhpcy5fZGV2aWNlUGl4ZWxSYXRpbyA9IDE7CiAgICAgICAgdGhpcy5fdGltZSA9IHRoaXMuX2xheWVyQW5nbGUgPSAwOwogICAgICAgIHRoaXMuX2JhY2tUZXggPSB0aGlzLl9kZXN0UmVuZGVyVGFyZ2V0ID0gbnVsbDsKICAgICAgICB0aGlzLl9jb21wb3NpdE9mZlkgPSB0aGlzLl9jb21wb3NpdE9mZlggPSAwOwogICAgICAgIHRoaXMuX3VwZGF0ZU93blByb2plY3Rpb24gPSAhMTsKICAgICAgICB0aGlzLl9wcm9qZWN0aW9uTWF0cml4ID0gbWF0NCRqc2NvbXAkOC5jcmVhdGUoKTsKICAgICAgICB0aGlzLl9tb2RlbFZpZXdNYXRyaXggPSBtYXQ0JGpzY29tcCQ4LmNyZWF0ZSgpCiAgICB9CiAgICBSZWxlYXNlKCkgewogICAgICAgIEMzJGpzY29tcCQ1Mi5jbGVhckFycmF5KHRoaXMuX3N0ZXBzKTsKICAgICAgICBDMyRqc2NvbXAkNTIuY2xlYXJBcnJheSh0aGlzLl9zaGFkZXJQcm9ncmFtTGlzdCk7CiAgICAgICAgQzMkanNjb21wJDUyLmNsZWFyQXJyYXkodGhpcy5fc2hhZGVyUHJvZ3JhbUluZGljZXMpOwogICAgICAgIHRoaXMuX2NiR2V0U2hhZGVyUGFyYW1ldGVycyA9IHRoaXMuX2NiR2V0U291cmNlVGV4dHVyZUluZm8gPSB0aGlzLl9jYkRyYXdDb250ZW50ID0gdGhpcy5fY29udGV4dE9iamVjdCA9IHRoaXMuX2NvbnRlbnRPYmplY3QgPSBudWxsCiAgICB9CiAgICBCdWlsZFN0ZXBzKGEsIGIpIHsKICAgICAgICBiID0gT2JqZWN0LmFzc2lnbih7fSwgREVGQVVMVF9CVUlMRFNURVBTX09QVFMsIGIpOwogICAgICAgIEMzJGpzY29tcCQ1Mi5jbGVhckFycmF5KHRoaXMuX3N0ZXBzKTsKICAgICAgICB0aGlzLl9ib3hFeHRlbmRWZXJ0aWNhbCA9IHRoaXMuX2JveEV4dGVuZEhvcml6b250YWwgPSAwOwogICAgICAgIHRoaXMuX3VzZUNvcHlUZXh0dXJlQmFja2dyb3VuZFNhbXBsaW5nID0gdGhpcy5faXNBbnlJc1NyY1RleFJvdGF0ZWQgPSB0aGlzLl9pc0FueVNoYWRlckNyb3NzU2FtcGxpbmcgPSB0aGlzLl9pc0FueVNoYWRlckJhY2tncm91bmRCbGVuZGluZyA9IHRoaXMuX2lzQW55U2hhZGVyRGVwdGhTYW1wbGluZyA9IHRoaXMuX2lzQW55U2hhZGVyQW5pbWF0ZWQgPSAhMTsKICAgICAgICB0aGlzLl9udW1UZW1wU3VyZmFjZXNSZXF1aXJlZCA9IDA7CiAgICAgICAgdGhpcy5faXNTb3VyY2VUZXh0dXJlUm90YXRlZCA9ICEhYi5pc1NvdXJjZVRleHR1cmVSb3RhdGVkOwogICAgICAgIHRoaXMuX3VzZUZ1bGxTdXJmYWNlID0gISFiLnVzZUZ1bGxTdXJmYWNlOwogICAgICAgIEMzJGpzY29tcCQ1Mi5zaGFsbG93QXNzaWduQXJyYXkodGhpcy5fc2hhZGVyUHJvZ3JhbUxpc3QsIGEpOwogICAgICAgIGlmICgwICE9PSBhLmxlbmd0aCkgewogICAgICAgICAgICBpZiAoYi5pbmRleE1hcCkgewogICAgICAgICAgICAgICAgaWYgKGIuaW5kZXhNYXAubGVuZ3RoICE9PSBhLmxlbmd0aCkgdGhyb3cgRXJyb3IoImluY29ycmVjdCBpbmRleE1hcCBsZW5ndGgiKTsKICAgICAgICAgICAgICAgIEMzJGpzY29tcCQ1Mi5zaGFsbG93QXNzaWduQXJyYXkodGhpcy5fc2hhZGVyUHJvZ3JhbUluZGljZXMsIGIuaW5kZXhNYXApCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBDMyRqc2NvbXAkNTIuY2xlYXJBcnJheSh0aGlzLl9zaGFkZXJQcm9ncmFtSW5kaWNlcyk7CiAgICAgICAgICAgICAgICBmb3IgKGxldCBlID0gMCwgZyA9IGEubGVuZ3RoOyBlIDwgZzsgKytlKSB0aGlzLl9zaGFkZXJQcm9ncmFtSW5kaWNlcy5wdXNoKGUpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yICh2YXIgZCBvZiBhKSB0aGlzLl9ib3hFeHRlbmRIb3Jpem9udGFsICs9CiAgICAgICAgICAgICAgICBkLkdldEJveEV4dGVuZEhvcml6b250YWwoKSwgdGhpcy5fYm94RXh0ZW5kVmVydGljYWwgKz0gZC5HZXRCb3hFeHRlbmRWZXJ0aWNhbCgpLCBkLklzQW5pbWF0ZWQoKSAmJiAodGhpcy5faXNBbnlTaGFkZXJBbmltYXRlZCA9ICEwKSwgZC5Vc2VzRGVwdGgoKSAmJiAodGhpcy5faXNBbnlTaGFkZXJEZXB0aFNhbXBsaW5nID0gITApLCBkLkJsZW5kc0JhY2tncm91bmQoKSAmJiAodGhpcy5faXNBbnlTaGFkZXJCYWNrZ3JvdW5kQmxlbmRpbmcgPSAhMCksIGQuVXNlc0Nyb3NzU2FtcGxpbmcoKSAmJiAodGhpcy5faXNBbnlTaGFkZXJDcm9zc1NhbXBsaW5nID0gITApLCBkLlVzZXNJc1NyY1RleFJvdGF0ZWQoKSAmJiAodGhpcy5faXNBbnlJc1NyY1RleFJvdGF0ZWQgPSAhMCk7CiAgICAgICAgICAgIHRoaXMuX3VzZUNvcHlUZXh0dXJlQmFja2dyb3VuZFNhbXBsaW5nID0gdGhpcy5fU2hvdWxkVXNlQ29weVRleHR1cmVCYWNrZ3JvdW5kU2FtcGxpbmcoYVswXS5HZXRSZW5kZXJlcigpKTsKICAgICAgICAgICAgZCA9IHRoaXMuX1Nob3VsZFByZURyYXcoYVswXSwgYik7CiAgICAgICAgICAgIGIgPSB0aGlzLl9TaG91bGRQb3N0RHJhdyhhLmF0KC0xKSwKICAgICAgICAgICAgICAgIGIpOwogICAgICAgICAgICBpZiAoMSAhPT0gYS5sZW5ndGggfHwgZCB8fCBiKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9jYW5Vc2VGYXN0UGF0aCA9ICExOwogICAgICAgICAgICAgICAgdmFyIGMgPSAwOwogICAgICAgICAgICAgICAgZCAmJiAodGhpcy5fbnVtVGVtcFN1cmZhY2VzUmVxdWlyZWQgPSAxLCB0aGlzLl9zdGVwcy5wdXNoKEMzJGpzY29tcCQ1Mi5OZXcoQzMkanNjb21wJDUyLkdmeC5FZmZlY3RDaGFpbi5TdGVwLlByZURyYXcsIHRoaXMsIC0xLCAxKSksIGMgPSAxKTsKICAgICAgICAgICAgICAgIGZvciAobGV0IGUgPSAwLCBnID0gYS5sZW5ndGg7IGUgPCBnOyArK2UpIDAgIT09IGUgfHwgZCA/IChhID0gMSA9PT0gYyA/IDIgOiAxLCBlICE9PSBnIC0gMSB8fCBiIHx8IChhID0gMCksIHRoaXMuX251bVRlbXBTdXJmYWNlc1JlcXVpcmVkID0gTWF0aC5tYXgodGhpcy5fbnVtVGVtcFN1cmZhY2VzUmVxdWlyZWQsIGEpLCB0aGlzLl9zdGVwcy5wdXNoKEMzJGpzY29tcCQ1Mi5OZXcoQzMkanNjb21wJDUyLkdmeC5FZmZlY3RDaGFpbi5TdGVwLkJvdW5jZSwgdGhpcywgYywgYSwgZSkpLCBjID0gYSkgOiAodGhpcy5fbnVtVGVtcFN1cmZhY2VzUmVxdWlyZWQgPSAxLCB0aGlzLl9zdGVwcy5wdXNoKEMzJGpzY29tcCQ1Mi5OZXcoQzMkanNjb21wJDUyLkdmeC5FZmZlY3RDaGFpbi5TdGVwLkZpcnN0Qm91bmNlLAogICAgICAgICAgICAgICAgICAgIHRoaXMsIC0xLCAxLCBlKSksIGMgPSAxKTsKICAgICAgICAgICAgICAgIGIgJiYgdGhpcy5fc3RlcHMucHVzaChDMyRqc2NvbXAkNTIuTmV3KEMzJGpzY29tcCQ1Mi5HZnguRWZmZWN0Q2hhaW4uU3RlcC5Qb3N0RHJhdywgdGhpcywgYywgMCkpCiAgICAgICAgICAgIH0gZWxzZSB0aGlzLl9jYW5Vc2VGYXN0UGF0aCA9ICEwCiAgICAgICAgfQogICAgfQogICAgX1Nob3VsZFByZURyYXcoYSwgYikgewogICAgICAgIHJldHVybiBiLmZvcmNlUHJlRHJhdyB8fCBhLk11c3RQcmVEcmF3KCkgfHwgYi5pczNEIHx8IGEuVXNlc0RlcHRoKCkgJiYgIXRoaXMuX3VzZUZ1bGxTdXJmYWNlIHx8ICgwICE9PSB0aGlzLl9ib3hFeHRlbmRIb3Jpem9udGFsIHx8IDAgIT09IHRoaXMuX2JveEV4dGVuZFZlcnRpY2FsKSAmJiAhdGhpcy5fdXNlRnVsbFN1cmZhY2UgPyAhMCA6IGEuR2V0UmVuZGVyZXIoKS5Jc1dlYkdMKCkgPyBhLkJsZW5kc0JhY2tncm91bmQoKSAmJiAoYi5pc1JvdGF0ZWRPck5lZ2F0aXZlU2l6ZUluc3RhbmNlIHx8IGIuaXNTb3VyY2VUZXh0dXJlUm90YXRlZCkgfHwgYS5Vc2VzQW55U3JjUmVjdE9yUGl4ZWxTaXplKCkgJiYgYi5pc1NvdXJjZVRleHR1cmVSb3RhdGVkIDogITEKICAgIH0KICAgIF9TaG91bGRQb3N0RHJhdyhhLAogICAgICAgIGIpIHsKICAgICAgICByZXR1cm4gYi5mb3JjZVBvc3REcmF3ID8gITAgOiBhLkdldFJlbmRlcmVyKCkuSXNXZWJHTCgpID8gYS5CbGVuZHNCYWNrZ3JvdW5kKCkgfHwgYS5Vc2VzQ3Jvc3NTYW1wbGluZygpIDogKGEuQmxlbmRzQmFja2dyb3VuZCgpIHx8IGEuVXNlc0Nyb3NzU2FtcGxpbmcoKSkgJiYgdGhpcy5fVXNlUmVuZGVyVGFyZ2V0QmFja2dyb3VuZFNhbXBsaW5nKCkKICAgIH0KICAgIF9TaG91bGRVc2VDb3B5VGV4dHVyZUJhY2tncm91bmRTYW1wbGluZyhhKSB7CiAgICAgICAgcmV0dXJuIGEuSXNXZWJHUFUoKSAmJiB0aGlzLl9pc0FueVNoYWRlckJhY2tncm91bmRCbGVuZGluZyAmJiAhdGhpcy5faXNBbnlTaGFkZXJDcm9zc1NhbXBsaW5nCiAgICB9CiAgICBSZW5kZXIoYSwgYiwgZCkgewogICAgICAgIGEuSXNXZWJHUFUoKSAmJiBudWxsID09PSBiICYmIChiID0gYS5HZXRCYWNrYnVmZmVyUmVuZGVyVGFyZ2V0KCkpOwogICAgICAgIHRoaXMuX2Rlc3RSZW5kZXJUYXJnZXQgPSBiOwogICAgICAgIHRoaXMuX2NvbnRlbnRPYmplY3QgPSBkLmNvbnRlbnRPYmplY3QgfHwgbnVsbDsKICAgICAgICB0aGlzLl9jb250ZXh0T2JqZWN0ID0gZC5jb250ZXh0T2JqZWN0IHx8IG51bGw7CiAgICAgICAgdGhpcy5fYmxlbmRNb2RlID0gZC5ibGVuZE1vZGUgfHwgMDsKICAgICAgICB0aGlzLl9kZXZpY2VQaXhlbFJhdGlvID0gZC5kZXZpY2VQaXhlbFJhdGlvIHx8IDE7CiAgICAgICAgdGhpcy5fbGF5ZXJTY2FsZSA9IGQubGF5ZXJTY2FsZSB8fCAxOwogICAgICAgIHRoaXMuX2xheWVyQW5nbGUgPSBkLmxheWVyQW5nbGUgfHwgMDsKICAgICAgICB0aGlzLl90aW1lID0gIm51bWJlciIgPT09IHR5cGVvZiBkLnRpbWUgPyBkLnRpbWUgOiB0aGlzLl9tYW5hZ2VyLkdldFRpbWUoKTsKICAgICAgICB0aGlzLl9kaWRDaGFuZ2VUcmFuc2Zvcm0gPSAhMTsKICAgICAgICBhLlJlc2V0RGlkQ2hhbmdlVHJhbnNmb3JtRmxhZygpOwogICAgICAgIHRoaXMuX2lzQW55U2hhZGVyQW5pbWF0ZWQgJiYgdGhpcy5fUmVkcmF3KCk7CiAgICAgICAgbGV0IGMgPSAhMTsKICAgICAgICB0aGlzLl9Vc2VDb3B5VGV4dHVyZUJhY2tncm91bmRTYW1wbGluZygpICYmICh0aGlzLl9DYWxjdWxhdGVEcmF3U2l6ZUFuZFJlY3RhbmdsZXMoYSwgZCksIGMgPSAhMCwgdGhpcy5fYmFja1RleCA9IHRoaXMuX21hbmFnZXIuX0dldFdlYkdQVUJhY2tUZXh0dXJlKGEsIHRoaXMuX2RyYXdXaWR0aCwgdGhpcy5fZHJhd0hlaWdodCksIHRlbXBSZWN0LmNvcHkodGhpcy5fZHJhd1N1cmZhY2VSZWN0KSwKICAgICAgICAgICAgdGVtcFJlY3Qucm91bmRPdXRlcigpLCBhLkNvcHlUZXh0dXJlVG9UZXh0dXJlKHRoaXMuX2Rlc3RSZW5kZXJUYXJnZXQuR2V0VGV4dHVyZSgpLCB0aGlzLl9iYWNrVGV4LCB0ZW1wUmVjdC5nZXRMZWZ0KCksIHRlbXBSZWN0LmdldFRvcCgpLCB0ZW1wUmVjdC53aWR0aCgpLCB0ZW1wUmVjdC5oZWlnaHQoKSkpOwogICAgICAgIGlmICh0aGlzLl9jYW5Vc2VGYXN0UGF0aCkgdGhpcy5fUmVuZGVyX0Zhc3RQYXRoKGEsIGQpOwogICAgICAgIGVsc2UgewogICAgICAgICAgICBjIHx8IHRoaXMuX0NhbGN1bGF0ZURyYXdTaXplQW5kUmVjdGFuZ2xlcyhhLCBkKTsKICAgICAgICAgICAgYS5SZXNldENvbG9yKCk7CiAgICAgICAgICAgIGEuU2V0QmFzZVooMCk7CiAgICAgICAgICAgIGEuU2V0Q3VycmVudFooMCk7CiAgICAgICAgICAgIHRoaXMuX2NiRHJhd0NvbnRlbnRIb29rID0gZC5kcmF3Q29udGVudEhvb2sgfHwgbnVsbDsKICAgICAgICAgICAgdGhpcy5fY29tcG9zaXRPZmZYID0gZC5jb21wb3NpdE9mZlggfHwgMDsKICAgICAgICAgICAgdGhpcy5fY29tcG9zaXRPZmZZID0gZC5jb21wb3NpdE9mZlkgfHwgMDsKICAgICAgICAgICAgdGhpcy5fdXBkYXRlT3duUHJvamVjdGlvbiA9ICEhZC51cGRhdGVPd25Qcm9qZWN0aW9uOwogICAgICAgICAgICB0aGlzLl9PbkJlZm9yZVN0YXJ0RWZmZWN0Q2hhaW4oYSk7CiAgICAgICAgICAgIHRoaXMuX3JlbmRlclRhcmdldHNbMF0gPSBiOwogICAgICAgICAgICB0aGlzLl9yZW5kZXJUYXJnZXRzWzFdID0gMSA8PSB0aGlzLl9udW1UZW1wU3VyZmFjZXNSZXF1aXJlZCA/IHRoaXMuX0dldFJlbmRlclRhcmdldCgpIDogbnVsbDsKICAgICAgICAgICAgdGhpcy5fcmVuZGVyVGFyZ2V0c1syXSA9IDIgPT09IHRoaXMuX251bVRlbXBTdXJmYWNlc1JlcXVpcmVkID8gdGhpcy5fR2V0UmVuZGVyVGFyZ2V0KCkgOiBudWxsOwogICAgICAgICAgICBmb3IgKGNvbnN0IGUgb2YgdGhpcy5fc3RlcHMpIGIgPSB0aGlzLl9HZXRSZW5kZXJUYXJnZXRGb3JJZChlLkdldFNyY1RhcmdldElkKCkpLCBkID0gdGhpcy5fR2V0UmVuZGVyVGFyZ2V0Rm9ySWQoZS5HZXREZXN0VGFyZ2V0SWQoKSksIGEuSXNXZWJHUFUoKSA/IGUuUnVuX1dlYkdQVShhLCBiLCBkKSA6IGUuUnVuX1dlYkdMKGEsIGIsIGQpOwogICAgICAgICAgICB0aGlzLl9yZW5kZXJUYXJnZXRzWzFdICYmIHRoaXMuX1JlbGVhc2VSZW5kZXJUYXJnZXQodGhpcy5fcmVuZGVyVGFyZ2V0c1sxXSk7CiAgICAgICAgICAgIHRoaXMuX3JlbmRlclRhcmdldHNbMl0gJiYgdGhpcy5fUmVsZWFzZVJlbmRlclRhcmdldCh0aGlzLl9yZW5kZXJUYXJnZXRzWzJdKTsKICAgICAgICAgICAgdGhpcy5fcmVuZGVyVGFyZ2V0cy5maWxsKG51bGwpOwogICAgICAgICAgICB0aGlzLl9PbkFmdGVyRW5kRWZmZWN0Q2hhaW4oYSk7CiAgICAgICAgICAgIHRoaXMuX2NiRHJhd0NvbnRlbnRIb29rID0gdGhpcy5fY29udGV4dE9iamVjdCA9IHRoaXMuX2NvbnRlbnRPYmplY3QgPSB0aGlzLl9iYWNrVGV4ID0gdGhpcy5fZGVzdFJlbmRlclRhcmdldCA9IG51bGwKICAgICAgICB9CiAgICB9CiAgICBfQ2FsY3VsYXRlRHJhd1NpemVBbmRSZWN0YW5nbGVzKGEsIGIpIHsKICAgICAgICBjb25zdCBbZCwgY10gPSB0aGlzLl9tYW5hZ2VyLkdldERyYXdTaXplKGEpOwogICAgICAgIHRoaXMuX1NldERyYXdTaXplKGEsIGQsIGMpOwogICAgICAgIHRoaXMuX0NhbGN1bGF0ZVJlY3RhbmdsZXMoYikKICAgIH0KICAgIF9TZXREcmF3U2l6ZShhLCBiLCBkKSB7CiAgICAgICAgaWYgKDAgPj0gYiB8fCAwID49IGQpIHRocm93IEVycm9yKCJpbnZhbGlkIGRyYXcgc2l6ZSIpOwogICAgICAgIHRoaXMuX2RyYXdXaWR0aCA9PT0gYiAmJiB0aGlzLl9kcmF3SGVpZ2h0ID09PSBkIHx8IHRoaXMuX0NhbGN1bGF0ZURldmljZVRyYW5zZm9ybU1hdHJpY2VzKGEsIGIsIGQsIDAsIDAsIHRoaXMuX3Byb2plY3Rpb25NYXRyaXgsIHRoaXMuX21vZGVsVmlld01hdHJpeCk7CiAgICAgICAgdGhpcy5fZHJhd1dpZHRoID0gYjsKICAgICAgICB0aGlzLl9kcmF3SGVpZ2h0ID0gZAogICAgfQogICAgX0NhbGN1bGF0ZURldmljZVRyYW5zZm9ybU1hdHJpY2VzKGEsIGIsIGQsIGMsIGUsIGcsIGspIHsKICAgICAgICBjID0gYiAvIDIgKyBjOwogICAgICAgIGUgPSBkIC8gMiArIGU7CiAgICAgICAgYS5DYWxjdWxhdGVQZXJzcGVjdGl2ZU1hdHJpeChnLCBiIC8gZCk7CiAgICAgICAgYSA9IGEuQ2FsY3VsYXRlTG9va0F0TW9kZWxWaWV3MihjLCBlLCBhLkdldERlZmF1bHRDYW1lcmFaKGQpLCBjLCBlLCAwLCBkKTsKICAgICAgICBtYXQ0JGpzY29tcCQ4LmNvcHkoaywgYSkKICAgIH0KICAgIF9DYWxjdWxhdGVSZWN0YW5nbGVzKGEpIHsKICAgICAgICB0aGlzLl9sYXlvdXRSZWN0LmNvcHkoYS5sYXlvdXRSZWN0KTsKICAgICAgICBhLmRyYXdTdXJmYWNlUmVjdCA/IHRoaXMuX2RyYXdTdXJmYWNlUmVjdC5jb3B5KGEuZHJhd1N1cmZhY2VSZWN0KSA6IHRoaXMuX2RyYXdTdXJmYWNlUmVjdC5zZXQoMCwgMCwgdGhpcy5fZHJhd1dpZHRoLCB0aGlzLl9kcmF3SGVpZ2h0KTsKICAgICAgICB0aGlzLl9yY1RleE9yaWdpbmFsLmNvcHkodGhpcy5fZHJhd1N1cmZhY2VSZWN0KTsKICAgICAgICB0aGlzLl9yY1RleE9yaWdpbmFsLmRpdmlkZSh0aGlzLl9kcmF3V2lkdGgsCiAgICAgICAgICAgIHRoaXMuX2RyYXdIZWlnaHQpOwogICAgICAgIGEgPSB0aGlzLl9sYXllclNjYWxlICogdGhpcy5fZGV2aWNlUGl4ZWxSYXRpbzsKICAgICAgICB0aGlzLl9kcmF3U3VyZmFjZVJlY3QuaW5mbGF0ZSh0aGlzLl9ib3hFeHRlbmRIb3Jpem9udGFsICogYSwgdGhpcy5fYm94RXh0ZW5kVmVydGljYWwgKiBhKTsKICAgICAgICB0aGlzLl9yY1RleERlc3QuY29weSh0aGlzLl9kcmF3U3VyZmFjZVJlY3QpOwogICAgICAgIHRoaXMuX3JjVGV4RGVzdC5kaXZpZGUodGhpcy5fZHJhd1dpZHRoLCB0aGlzLl9kcmF3SGVpZ2h0KTsKICAgICAgICB0aGlzLl9kcmF3U3VyZmFjZVJlY3QuY2xhbXAoMCwgMCwgdGhpcy5fZHJhd1dpZHRoLCB0aGlzLl9kcmF3SGVpZ2h0KTsKICAgICAgICB0aGlzLl9yY1RleEJvdW5jZS5jb3B5KHRoaXMuX2RyYXdTdXJmYWNlUmVjdCk7CiAgICAgICAgdGhpcy5fcmNUZXhCb3VuY2UuZGl2aWRlKHRoaXMuX2RyYXdXaWR0aCwgdGhpcy5fZHJhd0hlaWdodCkKICAgIH0KICAgIF9PbkJlZm9yZVN0YXJ0RWZmZWN0Q2hhaW4oYSkgewogICAgICAgIHRoaXMuX2RlcHRoRW5hYmxlZEF0U3RhcnQgPSBhLklzRGVwdGhFbmFibGVkKCk7CiAgICAgICAgaWYgKHRoaXMuX3VzZUZ1bGxTdXJmYWNlKSBhLlNldERlcHRoRW5hYmxlZCghMSksCiAgICAgICAgICAgIHRoaXMuX2lzQW55U2hhZGVyRGVwdGhTYW1wbGluZyAmJiBhLlNldERlcHRoU2FtcGxpbmdFbmFibGVkKCEwKTsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgdGVtcFJlY3QuY29weSh0aGlzLl9kcmF3U3VyZmFjZVJlY3QpOwogICAgICAgICAgICBpZiAoYS5Jc1dlYkdMKCkpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGIgPSB0aGlzLl9sYXllclNjYWxlICogdGhpcy5fZGV2aWNlUGl4ZWxSYXRpbzsKICAgICAgICAgICAgICAgIHRlbXBSZWN0LmluZmxhdGUoTWF0aC5tYXgodGhpcy5fYm94RXh0ZW5kSG9yaXpvbnRhbCwgMSkgKiBiLCBNYXRoLm1heCh0aGlzLl9ib3hFeHRlbmRWZXJ0aWNhbCwgMSkgKiBiKTsKICAgICAgICAgICAgICAgIHRlbXBSZWN0LnJvdW5kT3V0ZXIoKTsKICAgICAgICAgICAgICAgIHRlbXBSZWN0LmNsYW1wKDAsIDAsIHRoaXMuX2RyYXdXaWR0aCwgdGhpcy5fZHJhd0hlaWdodCkKICAgICAgICAgICAgfSBlbHNlIHRlbXBSZWN0LnJvdW5kT3V0ZXIoKTsKICAgICAgICAgICAgYS5TZXRTY2lzc29yUmVjdCh0ZW1wUmVjdC5nZXRMZWZ0KCksIHRlbXBSZWN0LmdldFRvcCgpLCB0ZW1wUmVjdC53aWR0aCgpLCB0ZW1wUmVjdC5oZWlnaHQoKSwgdGhpcy5fZHJhd0hlaWdodCkKICAgICAgICB9CiAgICB9CiAgICBfT25BZnRlckVmZmVjdENoYWluRHJhd0NvbnRlbnQoYSkgewogICAgICAgIGEuUmVzZXRDb2xvcigpOwogICAgICAgIHRoaXMuX3VzZUZ1bGxTdXJmYWNlIHx8IChhLlNldERlcHRoRW5hYmxlZCghMSksIHRoaXMuX2lzQW55U2hhZGVyRGVwdGhTYW1wbGluZyAmJiBhLlNldERlcHRoU2FtcGxpbmdFbmFibGVkKCEwKSk7CiAgICAgICAgYS5Jc1dlYkdQVSgpICYmIGEuU2V0Tm9ybWFsaXplZENvb3Jkc1Byb2dyYW1WYXJpYW50KCEwKQogICAgfQogICAgX09uQWZ0ZXJFbmRFZmZlY3RDaGFpbihhKSB7CiAgICAgICAgYS5TZXREZXB0aFNhbXBsaW5nRW5hYmxlZCghMSk7CiAgICAgICAgYS5TZXREZXB0aEVuYWJsZWQodGhpcy5fZGVwdGhFbmFibGVkQXRTdGFydCk7CiAgICAgICAgdGhpcy5fdXNlRnVsbFN1cmZhY2UgfHwgYS5SZW1vdmVTY2lzc29yUmVjdCgpOwogICAgICAgIGEuSXNXZWJHUFUoKSAmJiBhLlNldE5vcm1hbGl6ZWRDb29yZHNQcm9ncmFtVmFyaWFudCghMSk7CiAgICAgICAgdGhpcy5fZGlkQ2hhbmdlVHJhbnNmb3JtID0gYS5EaWRDaGFuZ2VUcmFuc2Zvcm0oKQogICAgfQogICAgX0NsYW1wUmNUZXhEZXN0KCkgewogICAgICAgIHRoaXMuX3JjVGV4RGVzdC5jbGFtcCgwLCAwLCAxLCAxKQogICAgfQogICAgX0dldFJlbmRlclRhcmdldEZvcklkKGEpIHsKICAgICAgICByZXR1cm4gMCA+IGEgPyBudWxsIDogdGhpcy5fcmVuZGVyVGFyZ2V0c1thXQogICAgfQogICAgX0dldFJlbmRlclRhcmdldCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fbWFuYWdlci5HZXRSZW5kZXJUYXJnZXQodGhpcykKICAgIH0KICAgIF9HZXREZXN0UmVuZGVyVGFyZ2V0KCkgewogICAgICAgIHJldHVybiB0aGlzLl9kZXN0UmVuZGVyVGFyZ2V0CiAgICB9CiAgICBfUmVsZWFzZVJlbmRlclRhcmdldChhKSB7CiAgICAgICAgdGhpcy5fbWFuYWdlci5SZWxlYXNlUmVuZGVyVGFyZ2V0KGEsCiAgICAgICAgICAgIHRoaXMpCiAgICB9CiAgICBfR2V0U2hhZGVyUHJvZ3JhbUF0KGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5fc2hhZGVyUHJvZ3JhbUxpc3RbYV0KICAgIH0KICAgIF9EcmF3Q29udGVudChhKSB7CiAgICAgICAgdGhpcy5fY2JEcmF3Q29udGVudEhvb2sgPyB0aGlzLl9jYkRyYXdDb250ZW50SG9vayh0aGlzLCBhLCAoKSA9PiB0aGlzLl9jYkRyYXdDb250ZW50KGEsIHRoaXMpKSA6IHRoaXMuX2NiRHJhd0NvbnRlbnQoYSwgdGhpcyk7CiAgICAgICAgdGhpcy5fY2FuVXNlRmFzdFBhdGggfHwgdGhpcy5fT25BZnRlckVmZmVjdENoYWluRHJhd0NvbnRlbnQoYSkKICAgIH0KICAgIF9Jc1JlbmRlclRhcmdldFNhbWVTaXplQW5kT2Zmc2V0KGEpIHsKICAgICAgICBpZiAodGhpcy5fdXNlRnVsbFN1cmZhY2UpIHJldHVybiAhMDsKICAgICAgICBpZiAoMCAhPT0gdGhpcy5fY29tcG9zaXRPZmZYIHx8IDAgIT09IHRoaXMuX2NvbXBvc2l0T2ZmWSkgcmV0dXJuICExOwogICAgICAgIGNvbnN0IFtiLCBkXSA9IGEuR2V0UmVuZGVyVGFyZ2V0U2l6ZShhLkdldFJlbmRlclRhcmdldCgpKTsKICAgICAgICByZXR1cm4gYiAhPT0gdGhpcy5fZHJhd1dpZHRoIHx8IGQgIT09IHRoaXMuX2RyYXdIZWlnaHQgPyAhMSA6ICEwCiAgICB9CiAgICBfU2V0RGV2aWNlVHJhbnNmb3JtKGEsCiAgICAgICAgYikgewogICAgICAgIGxldCBkID0gdGhpcy5fcHJvamVjdGlvbk1hdHJpeCwKICAgICAgICAgICAgYyA9IHRoaXMuX21vZGVsVmlld01hdHJpeDsKICAgICAgICBpZiAoYiAmJiAhdGhpcy5fSXNSZW5kZXJUYXJnZXRTYW1lU2l6ZUFuZE9mZnNldChhKSkgewogICAgICAgICAgICBkID0gdGVtcE1hdDRhOwogICAgICAgICAgICBjID0gdGVtcE1hdDRiJGpzY29tcCQxOwogICAgICAgICAgICBjb25zdCBbZSwgZ10gPSBhLkdldFJlbmRlclRhcmdldFNpemUoYS5HZXRSZW5kZXJUYXJnZXQoKSk7CiAgICAgICAgICAgIHRoaXMuX0NhbGN1bGF0ZURldmljZVRyYW5zZm9ybU1hdHJpY2VzKGEsIGUsIGcsIHRoaXMuX2NvbXBvc2l0T2ZmWCwgdGhpcy5fY29tcG9zaXRPZmZZLCBkLCBjKTsKICAgICAgICAgICAgdGhpcy5fdXNlRnVsbFN1cmZhY2UgfHwgYS5SZW1vdmVTY2lzc29yUmVjdCgpCiAgICAgICAgfQogICAgICAgIGEuU2V0UHJvamVjdGlvbk1hdHJpeChkKTsKICAgICAgICBhLlNldE1vZGVsVmlld01hdHJpeChjKQogICAgfQogICAgX1JlZHJhdygpIHsKICAgICAgICB0aGlzLl9tYW5hZ2VyLlJlZHJhdyh0aGlzKQogICAgfQogICAgX0dldFNoYWRlclBhcmFtZXRlcnMoYSkgewogICAgICAgIHJldHVybiB0aGlzLl9jYkdldFNoYWRlclBhcmFtZXRlcnModGhpcy5fc2hhZGVyUHJvZ3JhbUluZGljZXNbYV0pCiAgICB9CiAgICBfU2V0UHJvZ3JhbVBhcmFtZXRlcnMoYSwKICAgICAgICBiKSB7CiAgICAgICAgbGV0IGQgPSB0aGlzLl9yY1RleERlc3QsCiAgICAgICAgICAgIGMgPSB0aGlzLl9yY1RleEJvdW5jZSwKICAgICAgICAgICAgZSA9IHRoaXMuX3JjVGV4T3JpZ2luYWw7CiAgICAgICAgYS5Jc1dlYkdMKCkgJiYgKHRlbXBSZWN0Mi5jb3B5KGQpLCB0ZW1wUmVjdDIuZmxpcEFyb3VuZCgxKSwgZCA9IHRlbXBSZWN0MiwgdGVtcFJlY3QzLmNvcHkoYyksIHRlbXBSZWN0My5mbGlwQXJvdW5kKDEpLCBjID0gdGVtcFJlY3QzLCB0ZW1wUmVjdDQuY29weShlKSwgdGVtcFJlY3Q0LmZsaXBBcm91bmQoMSksIGUgPSB0ZW1wUmVjdDQpOwogICAgICAgIHRoaXMuX0RvU2V0UHJvZ3JhbVBhcmFtZXRlcnMoYSwgYiwgYywgZSwgZCwgMSAvIHRoaXMuX2RyYXdXaWR0aCwgMSAvIHRoaXMuX2RyYXdIZWlnaHQpCiAgICB9CiAgICBfU2V0Rmlyc3RCb3VuY2VQcm9ncmFtUGFyYW1ldGVycyhhLCBiKSB7CiAgICAgICAgbGV0IGQgPSB0aGlzLl9yY1RleEJvdW5jZSwKICAgICAgICAgICAgYyA9IHRoaXMuX3JjVGV4T3JpZ2luYWwsCiAgICAgICAgICAgIGUgPSAxIC8gdGhpcy5fZHJhd1dpZHRoLAogICAgICAgICAgICBnID0gMSAvIHRoaXMuX2RyYXdIZWlnaHQ7CiAgICAgICAgaWYgKHRoaXMuX2NiR2V0U291cmNlVGV4dHVyZUluZm8pIHsKICAgICAgICAgICAgbGV0IHsKICAgICAgICAgICAgICAgIHNyY1RleFJlY3Q6IG0sCiAgICAgICAgICAgICAgICBzcmNXaWR0aDogbiwKICAgICAgICAgICAgICAgIHNyY0hlaWdodDogcQogICAgICAgICAgICB9ID0gdGhpcy5fY2JHZXRTb3VyY2VUZXh0dXJlSW5mbyh0aGlzLl9jb250ZW50T2JqZWN0KTsKICAgICAgICAgICAgbSB8fCAodGVtcFJlY3Quc2V0KDAsIDAsIDAsIDApLCBtID0gdGVtcFJlY3QpOwogICAgICAgICAgICBuIHx8IChuID0gdGhpcy5fZHJhd1dpZHRoKTsKICAgICAgICAgICAgcSB8fCAocSA9IHRoaXMuX2RyYXdIZWlnaHQpOwogICAgICAgICAgICBjID0gZCA9IG07CiAgICAgICAgICAgIGUgPSAxIC8gbjsKICAgICAgICAgICAgZyA9IDEgLyBxCiAgICAgICAgfSBlbHNlIGEuSXNXZWJHTCgpICYmICh0ZW1wUmVjdDMuY29weShkKSwgdGVtcFJlY3QzLmZsaXBBcm91bmQoMSksIGQgPSB0ZW1wUmVjdDMsIHRlbXBSZWN0NC5jb3B5KGMpLCB0ZW1wUmVjdDQuZmxpcEFyb3VuZCgxKSwgYyA9IHRlbXBSZWN0NCk7CiAgICAgICAgbGV0IGsgPSB0aGlzLl9yY1RleERlc3Q7CiAgICAgICAgYS5Jc1dlYkdMKCkgJiYgKGsgPSB0ZW1wUmVjdDIsIGsuY29weSh0aGlzLl9yY1RleERlc3QpLCBrLmZsaXBBcm91bmQoMSkpOwogICAgICAgIHRoaXMuX0RvU2V0UHJvZ3JhbVBhcmFtZXRlcnMoYSwgYiwgZCwgYywgaywgZSwgZyk7CiAgICAgICAgYS5Jc1dlYkdQVSgpICYmIHRoaXMuX2lzQW55SXNTcmNUZXhSb3RhdGVkICYmIGEuU2V0UHJvZ3JhbVBhcmFtZXRlcl9Jc1NyY1RleFJvdGF0ZWQodGhpcy5faXNTb3VyY2VUZXh0dXJlUm90YXRlZCkKICAgIH0KICAgIF9HZXRCYWNrVGV4KGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5faXNBbnlTaGFkZXJCYWNrZ3JvdW5kQmxlbmRpbmcgPwogICAgICAgICAgICBhLklzV2ViR1BVKCkgPyB0aGlzLl9Vc2VDb3B5VGV4dHVyZUJhY2tncm91bmRTYW1wbGluZygpID8gdGhpcy5fYmFja1RleCA6IHRoaXMuX2Rlc3RSZW5kZXJUYXJnZXQuR2V0VGV4dHVyZSgpIDogdGhpcy5fZGVzdFJlbmRlclRhcmdldCA6IG51bGwKICAgIH0KICAgIF9Eb1NldFByb2dyYW1QYXJhbWV0ZXJzKGEsIGIsIGQsIGMsIGUsIGcsIGspIHsKICAgICAgICBhLlNldFByb2dyYW1QYXJhbWV0ZXJzKHRoaXMuX0dldEJhY2tUZXgoYSksIGUsIGQsIGMsIHRoaXMuX2xheW91dFJlY3QsIGcsIGssIHRoaXMuX2RldmljZVBpeGVsUmF0aW8sIHRoaXMuX2xheWVyU2NhbGUsIHRoaXMuX2xheWVyQW5nbGUsIHRoaXMuX3RpbWUpOwogICAgICAgIGEuU2V0UHJvZ3JhbUN1c3RvbVBhcmFtZXRlcnModGhpcy5fR2V0U2hhZGVyUGFyYW1ldGVycyhiKSkKICAgIH0KICAgIF9SZW5kZXJfRmFzdFBhdGgoYSwgYikgewogICAgICAgIHZhciBkID0gdGhpcy5fc2hhZGVyUHJvZ3JhbUxpc3RbMF07CiAgICAgICAgY29uc3QgYyA9IGEuSXNEZXB0aEVuYWJsZWQoKSwKICAgICAgICAgICAgZSA9IGQuVXNlc0RlcHRoKCk7CiAgICAgICAgZSAmJiAoYS5TZXREZXB0aEVuYWJsZWQoITEpLCBhLlNldERlcHRoU2FtcGxpbmdFbmFibGVkKCEwKSwKICAgICAgICAgICAgdGhpcy5fcmNUZXhEZXN0LnNldCgwLCAwLCAxLCAxKSwgdGhpcy5fcmNUZXhPcmlnaW5hbC5zZXQoMCwgMCwgMSwgMSkpOwogICAgICAgIGEuU2V0UHJvZ3JhbShkKTsKICAgICAgICBhLlNldEJsZW5kTW9kZSh0aGlzLl9ibGVuZE1vZGUpOwogICAgICAgIGEuU2V0UmVuZGVyVGFyZ2V0KHRoaXMuX2Rlc3RSZW5kZXJUYXJnZXQpOwogICAgICAgIGxldCBnOwogICAgICAgIHRoaXMuX3JjVGV4T3JpZ2luYWwuc2V0KDAsIDAsIDEsIDEpOwogICAgICAgIGlmIChkLlVzZXNBbnlTcmNSZWN0T3JQaXhlbFNpemUoKSAmJiB0aGlzLl9jYkdldFNvdXJjZVRleHR1cmVJbmZvKSB7CiAgICAgICAgICAgIGNvbnN0IHsKICAgICAgICAgICAgICAgIHNyY1RleFJlY3Q6IGssCiAgICAgICAgICAgICAgICBzcmNXaWR0aDogbSwKICAgICAgICAgICAgICAgIHNyY0hlaWdodDogbgogICAgICAgICAgICB9ID0gdGhpcy5fY2JHZXRTb3VyY2VUZXh0dXJlSW5mbyh0aGlzLl9jb250ZW50T2JqZWN0KTsKICAgICAgICAgICAgayAmJiB0aGlzLl9yY1RleE9yaWdpbmFsLmNvcHkoayk7CiAgICAgICAgICAgIGQgPSBOdW1iZXIuaXNGaW5pdGUobSkgPyAxIC8gbSA6IDA7CiAgICAgICAgICAgIGcgPSBOdW1iZXIuaXNGaW5pdGUobikgPyAxIC8gbiA6IDAKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb25zdCBbaywgbV0gPSB0aGlzLl9tYW5hZ2VyLkdldERyYXdTaXplKGEpOwogICAgICAgICAgICBkID0gMSAvIGs7CiAgICAgICAgICAgIGcgPSAxIC8gbQogICAgICAgIH0KICAgICAgICBiLmxheW91dFJlY3QgPwogICAgICAgICAgICB0aGlzLl9sYXlvdXRSZWN0LmNvcHkoYi5sYXlvdXRSZWN0KSA6IHRoaXMuX2xheW91dFJlY3Quc2V0KDAsIDAsIDAsIDApOwogICAgICAgIGEuU2V0UHJvZ3JhbVBhcmFtZXRlcnModGhpcy5fR2V0QmFja1RleChhKSwgdGhpcy5fcmNUZXhEZXN0LCB0aGlzLl9yY1RleE9yaWdpbmFsLCB0aGlzLl9yY1RleE9yaWdpbmFsLCB0aGlzLl9sYXlvdXRSZWN0LCBkLCBnLCB0aGlzLl9kZXZpY2VQaXhlbFJhdGlvLCB0aGlzLl9sYXllclNjYWxlLCB0aGlzLl9sYXllckFuZ2xlLCB0aGlzLl90aW1lKTsKICAgICAgICBhLlNldFByb2dyYW1DdXN0b21QYXJhbWV0ZXJzKHRoaXMuX0dldFNoYWRlclBhcmFtZXRlcnMoMCkpOwogICAgICAgIGEuSXNXZWJHUFUoKSAmJiB0aGlzLl9pc0FueUlzU3JjVGV4Um90YXRlZCAmJiBhLlNldFByb2dyYW1QYXJhbWV0ZXJfSXNTcmNUZXhSb3RhdGVkKHRoaXMuX2lzU291cmNlVGV4dHVyZVJvdGF0ZWQpOwogICAgICAgIGEuU2V0QmFzZVooMCk7CiAgICAgICAgdGhpcy5fRHJhd0NvbnRlbnQoYSk7CiAgICAgICAgZSAmJiAoYS5TZXREZXB0aFNhbXBsaW5nRW5hYmxlZCghMSksIGEuU2V0RGVwdGhFbmFibGVkKGMpKQogICAgfQogICAgX1VzZUNvcHlUZXh0dXJlQmFja2dyb3VuZFNhbXBsaW5nKCkgewogICAgICAgIHJldHVybiB0aGlzLl91c2VDb3B5VGV4dHVyZUJhY2tncm91bmRTYW1wbGluZwogICAgfQogICAgX1VzZVJlbmRlclRhcmdldEJhY2tncm91bmRTYW1wbGluZygpIHsKICAgICAgICByZXR1cm4gIXRoaXMuX3VzZUNvcHlUZXh0dXJlQmFja2dyb3VuZFNhbXBsaW5nCiAgICB9CiAgICBJc0FueVNoYWRlckJhY2tncm91bmRCbGVuZGluZygpIHsKICAgICAgICByZXR1cm4gdGhpcy5faXNBbnlTaGFkZXJCYWNrZ3JvdW5kQmxlbmRpbmcKICAgIH0KICAgIENhblNraXBDYWxjdWxhdGluZ0RyYXdTdXJmYWNlUmVjdCgpIHsKICAgICAgICByZXR1cm4gIXRoaXMuX2NhblVzZUZhc3RQYXRoIHx8CiAgICAgICAgICAgIHRoaXMuX1VzZUNvcHlUZXh0dXJlQmFja2dyb3VuZFNhbXBsaW5nKCkgPyAhMSA6ICEwCiAgICB9CiAgICBVc2VGdWxsU3VyZmFjZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdXNlRnVsbFN1cmZhY2UKICAgIH0KICAgIEdldENvbnRlbnRPYmplY3QoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2NvbnRlbnRPYmplY3QKICAgIH0KICAgIEdldENvbnRleHRPYmplY3QoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2NvbnRleHRPYmplY3QKICAgIH0KICAgIF9HZXRCbGVuZE1vZGUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2JsZW5kTW9kZQogICAgfQogICAgX1VwZGF0ZU93blByb2plY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3VwZGF0ZU93blByb2plY3Rpb24KICAgIH0KICAgIERpZENoYW5nZVRyYW5zZm9ybSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZGlkQ2hhbmdlVHJhbnNmb3JtCiAgICB9CiAgICBfR2V0RHJhd1N1cmZhY2VSZWN0KCkgewogICAgICAgIHJldHVybiB0aGlzLl9kcmF3U3VyZmFjZVJlY3QKICAgIH0KICAgIF9HZXRSY1RleEJvdW5jZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcmNUZXhCb3VuY2UKICAgIH0KICAgIF9TaG91bGRJbnZhbGlkYXRlUmVuZGVyVGFyZ2V0cygpIHsKICAgICAgICByZXR1cm4gdGhpcy5faW52YWxpZGF0ZVJlbmRlclRhcmdldHMKICAgIH0KICAgIGFzeW5jIERlYnVnTG9nUmVuZGVyVGFyZ2V0Q29udGVudHMoYSwKICAgICAgICBiLCBkKSB7fQp9OwoidXNlIHN0cmljdCI7CnNlbGYuQzMuR2Z4LkVmZmVjdENoYWluLlN0ZXAgPSBjbGFzcyB7CiAgICBjb25zdHJ1Y3RvcihhLCBiLCBkLCBjID0gLTEpIHsKICAgICAgICB0aGlzLl9lZmZlY3RDaGFpbiA9IGE7CiAgICAgICAgdGhpcy5fc3JjVGFyZ2V0SWQgPSBiOwogICAgICAgIHRoaXMuX2Rlc3RUYXJnZXRJZCA9IGQ7CiAgICAgICAgdGhpcy5faW5kZXggPSBjCiAgICB9CiAgICBHZXRFZmZlY3RDaGFpbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZWZmZWN0Q2hhaW4KICAgIH0KICAgIEdldFNyY1RhcmdldElkKCkgewogICAgICAgIHJldHVybiB0aGlzLl9zcmNUYXJnZXRJZAogICAgfQogICAgR2V0RGVzdFRhcmdldElkKCkgewogICAgICAgIHJldHVybiB0aGlzLl9kZXN0VGFyZ2V0SWQKICAgIH0KICAgIEdldEluZGV4KCkgewogICAgICAgIHJldHVybiB0aGlzLl9pbmRleAogICAgfQogICAgR2V0U2hhZGVyUHJvZ3JhbSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5HZXRFZmZlY3RDaGFpbigpLl9HZXRTaGFkZXJQcm9ncmFtQXQodGhpcy5HZXRJbmRleCgpKQogICAgfQogICAgUnVuX1dlYkdMKGEsIGIsIGQpIHt9CiAgICBSdW5fV2ViR1BVKGEsIGIsIGQpIHt9Cn07CiJ1c2Ugc3RyaWN0IjsKY29uc3QgQzMkanNjb21wJDU0ID0gc2VsZi5DMzsKQzMkanNjb21wJDU0LkdmeC5FZmZlY3RDaGFpbi5TdGVwLlByZURyYXcgPSBjbGFzcyBleHRlbmRzIEMzJGpzY29tcCQ1NC5HZnguRWZmZWN0Q2hhaW4uU3RlcCB7CiAgICBjb25zdHJ1Y3RvcihhLCBiLCBkLCBjKSB7CiAgICAgICAgc3VwZXIoYSwgYiwgZCwgYykKICAgIH0KICAgIFJ1bl9XZWJHTChhLCBiLCBkKSB7CiAgICAgICAgYiA9IHRoaXMuR2V0RWZmZWN0Q2hhaW4oKTsKICAgICAgICBhLlNldEFscGhhQmxlbmQoKTsKICAgICAgICBhLlNldFRleHR1cmVGaWxsTW9kZSgpOwogICAgICAgIGEuU2V0UmVuZGVyVGFyZ2V0KGQsIGIuX1VwZGF0ZU93blByb2plY3Rpb24oKSk7CiAgICAgICAgYS5DbGVhclJnYmEoMCwgMCwgMCwgMCk7CiAgICAgICAgYi5fRHJhd0NvbnRlbnQoYSk7CiAgICAgICAgYi5fQ2xhbXBSY1RleERlc3QoKQogICAgfQogICAgUnVuX1dlYkdQVShhLCBiLCBkKSB7CiAgICAgICAgYiA9IHRoaXMuR2V0RWZmZWN0Q2hhaW4oKTsKICAgICAgICBhLlNldEFscGhhQmxlbmQoKTsKICAgICAgICBhLlNldFRleHR1cmVGaWxsTW9kZSgpOwogICAgICAgIGEuU2V0UmVuZGVyVGFyZ2V0KGQsICExKTsKICAgICAgICBhLkNsZWFyUmdiYSgwLCAwLCAwLCAwKTsKICAgICAgICBiLl9EcmF3Q29udGVudChhKTsKICAgICAgICBiLl9DbGFtcFJjVGV4RGVzdCgpCiAgICB9Cn07CiJ1c2Ugc3RyaWN0IjsKY29uc3QgQzMkanNjb21wJDU1ID0gc2VsZi5DMywKICAgIHRlbXBSZWN0JGpzY29tcCQxID0gQzMkanNjb21wJDU1Lk5ldyhDMyRqc2NvbXAkNTUuUmVjdCksCiAgICB0ZW1wUXVhZCRqc2NvbXAkMSA9IEMzJGpzY29tcCQ1NS5OZXcoQzMkanNjb21wJDU1LlF1YWQpOwpDMyRqc2NvbXAkNTUuR2Z4LkVmZmVjdENoYWluLlN0ZXAuUG9zdERyYXcgPSBjbGFzcyBleHRlbmRzIEMzJGpzY29tcCQ1NS5HZnguRWZmZWN0Q2hhaW4uU3RlcCB7CiAgICBjb25zdHJ1Y3RvcihhLCBiLCBkLCBjKSB7CiAgICAgICAgc3VwZXIoYSwgYiwgZCwgYykKICAgIH0KICAgIFJ1bl9XZWJHTChhLCBiLCBkKSB7CiAgICAgICAgY29uc3QgYyA9IHRoaXMuR2V0RWZmZWN0Q2hhaW4oKTsKICAgICAgICBhLlNldFRleHR1cmVGaWxsTW9kZSgpOwogICAgICAgIGEuU2V0UmVuZGVyVGFyZ2V0KGQpOwogICAgICAgIGMuX1NldERldmljZVRyYW5zZm9ybShhLCAhMCk7CiAgICAgICAgYS5TZXRCbGVuZE1vZGUoYy5fR2V0QmxlbmRNb2RlKCkpOwogICAgICAgIGEuU2V0VGV4dHVyZShiLkdldFRleHR1cmUoKSk7CiAgICAgICAgdGVtcFF1YWQkanNjb21wJDEuc2V0RnJvbVJlY3QoYy5fR2V0RHJhd1N1cmZhY2VSZWN0KCkpOwogICAgICAgIHRlbXBSZWN0JGpzY29tcCQxLmNvcHkoYy5fR2V0UmNUZXhCb3VuY2UoKSk7CiAgICAgICAgdGVtcFJlY3QkanNjb21wJDEuZmxpcEFyb3VuZCgxKTsKICAgICAgICBhLlF1YWQzKHRlbXBRdWFkJGpzY29tcCQxLCB0ZW1wUmVjdCRqc2NvbXAkMSk7CiAgICAgICAgYy5fU2hvdWxkSW52YWxpZGF0ZVJlbmRlclRhcmdldHMoKSAmJgogICAgICAgICAgICBhLkludmFsaWRhdGVSZW5kZXJUYXJnZXQoYikKICAgIH0KICAgIFJ1bl9XZWJHUFUoYSwgYiwgZCkgewogICAgICAgIGNvbnN0IGMgPSB0aGlzLkdldEVmZmVjdENoYWluKCk7CiAgICAgICAgYS5TZXRUZXh0dXJlRmlsbE1vZGUoKTsKICAgICAgICBhLlNldFJlbmRlclRhcmdldChkLCAhMSk7CiAgICAgICAgYy5fSXNSZW5kZXJUYXJnZXRTYW1lU2l6ZUFuZE9mZnNldChhKSA/IHRlbXBRdWFkJGpzY29tcCQxLnNldEZyb21SZWN0KGMuX0dldFJjVGV4Qm91bmNlKCkpIDogKGEuU2V0Tm9ybWFsaXplZENvb3Jkc1Byb2dyYW1WYXJpYW50KCExKSwgYy5fU2V0RGV2aWNlVHJhbnNmb3JtKGEsICEwKSwgdGVtcFF1YWQkanNjb21wJDEuc2V0RnJvbVJlY3QoYy5fR2V0RHJhd1N1cmZhY2VSZWN0KCkpKTsKICAgICAgICBhLlNldEJhY2tUZXh0dXJlKG51bGwpOwogICAgICAgIGEuU2V0QmxlbmRNb2RlKGMuX0dldEJsZW5kTW9kZSgpKTsKICAgICAgICBhLlNldFRleHR1cmUoYi5HZXRUZXh0dXJlKCkpOwogICAgICAgIGMuVXNlRnVsbFN1cmZhY2UoKSA/IGEuRnVsbHNjcmVlblF1YWQoKSA6IGEuUXVhZDModGVtcFF1YWQkanNjb21wJDEsIGMuX0dldFJjVGV4Qm91bmNlKCkpCiAgICB9Cn07CiJ1c2Ugc3RyaWN0IjsKY29uc3QgQzMkanNjb21wJDU2ID0gc2VsZi5DMzsKQzMkanNjb21wJDU2LkdmeC5FZmZlY3RDaGFpbi5TdGVwLkZpcnN0Qm91bmNlID0gY2xhc3MgZXh0ZW5kcyBDMyRqc2NvbXAkNTYuR2Z4LkVmZmVjdENoYWluLlN0ZXAgewogICAgY29uc3RydWN0b3IoYSwgYiwgZCwgYykgewogICAgICAgIHN1cGVyKGEsIGIsIGQsIGMpCiAgICB9CiAgICBSdW5fV2ViR0woYSwgYiwgZCkgewogICAgICAgIGIgPSB0aGlzLkdldEVmZmVjdENoYWluKCk7CiAgICAgICAgYS5TZXRSZW5kZXJUYXJnZXQoZCwgYi5fVXBkYXRlT3duUHJvamVjdGlvbigpKTsKICAgICAgICBhLkNsZWFyUmdiYSgwLCAwLCAwLCAwKTsKICAgICAgICBhLlNldENvcHlCbGVuZCgpOwogICAgICAgIGEuU2V0UHJvZ3JhbSh0aGlzLkdldFNoYWRlclByb2dyYW0oKSk7CiAgICAgICAgYi5fU2V0Rmlyc3RCb3VuY2VQcm9ncmFtUGFyYW1ldGVycyhhLCB0aGlzLkdldEluZGV4KCkpOwogICAgICAgIGIuX0RyYXdDb250ZW50KGEpOwogICAgICAgIGIuX0NsYW1wUmNUZXhEZXN0KCkKICAgIH0KICAgIFJ1bl9XZWJHUFUoYSwgYiwgZCkgewogICAgICAgIGIgPSB0aGlzLkdldEVmZmVjdENoYWluKCk7CiAgICAgICAgYS5TZXRSZW5kZXJUYXJnZXQoZCwgITEpOwogICAgICAgIGEuQ2xlYXJSZ2JhKDAsIDAsIDAsIDApOwogICAgICAgIGEuU2V0Q29weUJsZW5kKCk7CiAgICAgICAgYS5TZXRQcm9ncmFtKHRoaXMuR2V0U2hhZGVyUHJvZ3JhbSgpKTsKICAgICAgICBiLl9TZXRGaXJzdEJvdW5jZVByb2dyYW1QYXJhbWV0ZXJzKGEsIHRoaXMuR2V0SW5kZXgoKSk7CiAgICAgICAgYi5fRHJhd0NvbnRlbnQoYSk7CiAgICAgICAgYi5fQ2xhbXBSY1RleERlc3QoKQogICAgfQp9OwoidXNlIHN0cmljdCI7CmNvbnN0IEMzJGpzY29tcCQ1NyA9IHNlbGYuQzMsCiAgICB0ZW1wUmVjdCRqc2NvbXAkMiA9IEMzJGpzY29tcCQ1Ny5OZXcoQzMkanNjb21wJDU3LlJlY3QpLAogICAgdGVtcFF1YWQkanNjb21wJDIgPSBDMyRqc2NvbXAkNTcuTmV3KEMzJGpzY29tcCQ1Ny5RdWFkKTsKQzMkanNjb21wJDU3LkdmeC5FZmZlY3RDaGFpbi5TdGVwLkJvdW5jZSA9IGNsYXNzIGV4dGVuZHMgQzMkanNjb21wJDU3LkdmeC5FZmZlY3RDaGFpbi5TdGVwIHsKICAgIGNvbnN0cnVjdG9yKGEsIGIsIGQsIGMpIHsKICAgICAgICBzdXBlcihhLCBiLCBkLCBjKQogICAgfQogICAgUnVuX1dlYkdMKGEsIGIsIGQpIHsKICAgICAgICBjb25zdCBjID0gdGhpcy5HZXRFZmZlY3RDaGFpbigpOwogICAgICAgIGEuU2V0UmVuZGVyVGFyZ2V0KGQpOwogICAgICAgIChkID0gMCA9PT0gdGhpcy5HZXREZXN0VGFyZ2V0SWQoKSkgPyBhLlNldEJsZW5kTW9kZShjLl9HZXRCbGVuZE1vZGUoKSk6IChhLkNsZWFyUmdiYSgwLCAwLCAwLCAwKSwgYS5TZXRDb3B5QmxlbmQoKSk7CiAgICAgICAgYS5TZXRQcm9ncmFtKHRoaXMuR2V0U2hhZGVyUHJvZ3JhbSgpKTsKICAgICAgICBjLl9TZXRQcm9ncmFtUGFyYW1ldGVycyhhLCB0aGlzLkdldEluZGV4KCkpOwogICAgICAgIGEuU2V0VGV4dHVyZShiLkdldFRleHR1cmUoKSk7CiAgICAgICAgYy5fU2V0RGV2aWNlVHJhbnNmb3JtKGEsIGQpOwogICAgICAgIHRlbXBRdWFkJGpzY29tcCQyLnNldEZyb21SZWN0KGMuX0dldERyYXdTdXJmYWNlUmVjdCgpKTsKICAgICAgICB0ZW1wUmVjdCRqc2NvbXAkMi5jb3B5KGMuX0dldFJjVGV4Qm91bmNlKCkpOwogICAgICAgIHRlbXBSZWN0JGpzY29tcCQyLmZsaXBBcm91bmQoMSk7CiAgICAgICAgYS5RdWFkMyh0ZW1wUXVhZCRqc2NvbXAkMiwgdGVtcFJlY3QkanNjb21wJDIpOwogICAgICAgIGMuX1Nob3VsZEludmFsaWRhdGVSZW5kZXJUYXJnZXRzKCkgJiYgYS5JbnZhbGlkYXRlUmVuZGVyVGFyZ2V0KGIpCiAgICB9CiAgICBSdW5fV2ViR1BVKGEsIGIsIGQpIHsKICAgICAgICBjb25zdCBjID0gdGhpcy5HZXRFZmZlY3RDaGFpbigpOwogICAgICAgIGEuU2V0UmVuZGVyVGFyZ2V0KGQsICExKTsKICAgICAgICAwID09PSB0aGlzLkdldERlc3RUYXJnZXRJZCgpID8gKGEuU2V0QmxlbmRNb2RlKGMuX0dldEJsZW5kTW9kZSgpKSwgYS5TZXRCYWNrVGV4dHVyZShudWxsKSwgYy5fSXNSZW5kZXJUYXJnZXRTYW1lU2l6ZUFuZE9mZnNldChhKSA/IHRlbXBRdWFkJGpzY29tcCQyLnNldEZyb21SZWN0KGMuX0dldFJjVGV4Qm91bmNlKCkpIDogKGEuU2V0Tm9ybWFsaXplZENvb3Jkc1Byb2dyYW1WYXJpYW50KCExKSwgYy5fU2V0RGV2aWNlVHJhbnNmb3JtKGEsICEwKSwgdGVtcFF1YWQkanNjb21wJDIuc2V0RnJvbVJlY3QoYy5fR2V0RHJhd1N1cmZhY2VSZWN0KCkpKSkgOgogICAgICAgICAgICAoYS5DbGVhclJnYmEoMCwgMCwgMCwgMCksIGEuU2V0Q29weUJsZW5kKCksIHRlbXBRdWFkJGpzY29tcCQyLnNldEZyb21SZWN0KGMuX0dldFJjVGV4Qm91bmNlKCkpKTsKICAgICAgICBhLlNldFByb2dyYW0odGhpcy5HZXRTaGFkZXJQcm9ncmFtKCkpOwogICAgICAgIGMuX1NldFByb2dyYW1QYXJhbWV0ZXJzKGEsIHRoaXMuR2V0SW5kZXgoKSk7CiAgICAgICAgYS5TZXRUZXh0dXJlKGIuR2V0VGV4dHVyZSgpKTsKICAgICAgICBjLlVzZUZ1bGxTdXJmYWNlKCkgPyBhLkZ1bGxzY3JlZW5RdWFkKCkgOiBhLlF1YWQzKHRlbXBRdWFkJGpzY29tcCQyLCBjLl9HZXRSY1RleEJvdW5jZSgpKQogICAgfQp9OwoidXNlIHN0cmljdCI7CmNvbnN0IEMzJGpzY29tcCQ1OCA9IHNlbGYuQzMsCiAgICBDM1gkanNjb21wJDEgPSBzZWxmLkMzWDsKbGV0IHJ1bnRpbWUgPSBudWxsOwpjb25zdCBrZXlzRG93bkJ5S2V5ID0gbmV3IFNldDsKCmZ1bmN0aW9uIFNvcnRaT3JkZXJMaXN0KGEsIGIpIHsKICAgIGNvbnN0IGQgPSBhWzBdIC0gYlswXTsKICAgIHJldHVybiAwICE9PSBkID8gZCA6IGFbMV0gLSBiWzFdCn0KY29uc3QgdGVtcFpPcmRlckxpc3QgPSBbXSwKICAgIHRlbXBJbnN0YW5jZXMgPSBbXTsKbGV0IGRpZFdhcm5JbkFsZXJ0UG9seWZpbGwgPSAhMTsKc2VsZi5JUnVudGltZSA9IGNsYXNzIHsKICAgIGNvbnN0cnVjdG9yKGEsIGIpIHsKICAgICAgICBydW50aW1lID0gYTsKICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0aGlzLCB7CiAgICAgICAgICAgIGFzc2V0czogewogICAgICAgICAgICAgICAgdmFsdWU6IHJ1bnRpbWUuR2V0QXNzZXRNYW5hZ2VyKCkuR2V0SUFzc2V0TWFuYWdlcigpLAogICAgICAgICAgICAgICAgd3JpdGFibGU6ICExCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG9iamVjdHM6IHsKICAgICAgICAgICAgICAgIHZhbHVlOiBiLAogICAgICAgICAgICAgICAgd3JpdGFibGU6ICExCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGdsb2JhbFZhcnM6IHsKICAgICAgICAgICAgICAgIHZhbHVlOiB7fSwKICAgICAgICAgICAgICAgIHdyaXRhYmxlOiAhMQogICAgICAgICAgICB9LAogICAgICAgICAgICBwcm9qZWN0TmFtZTogewogICAgICAgICAgICAgICAgdmFsdWU6IHJ1bnRpbWUuR2V0UHJvamVjdE5hbWUoKSwKICAgICAgICAgICAgICAgIHdyaXRhYmxlOiAhMQogICAgICAgICAgICB9LAogICAgICAgICAgICBwcm9qZWN0VmVyc2lvbjogewogICAgICAgICAgICAgICAgdmFsdWU6IHJ1bnRpbWUuR2V0UHJvamVjdFZlcnNpb24oKSwKICAgICAgICAgICAgICAgIHdyaXRhYmxlOiAhMQogICAgICAgICAgICB9LAogICAgICAgICAgICBzdG9yYWdlOiB7CiAgICAgICAgICAgICAgICB2YWx1ZTogbmV3IHNlbGYuSVN0b3JhZ2UocnVudGltZSksCiAgICAgICAgICAgICAgICB3cml0YWJsZTogITEKICAgICAgICAgICAgfSwKICAgICAgICAgICAgaXNJbldvcmtlcjogewogICAgICAgICAgICAgICAgdmFsdWU6IHJ1bnRpbWUuSXNJbldvcmtlcigpLAogICAgICAgICAgICAgICAgd3JpdGFibGU6ICExCiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICBydW50aW1lLlVzZXJTY3JpcHREaXNwYXRjaGVyKCkuYWRkRXZlbnRMaXN0ZW5lcigia2V5ZG93biIsIGQgPT4gewogICAgICAgICAgICBrZXlzRG93bkJ5S2V5LmhhcyhkLmtleSkgPyBkLnN0b3BQcm9wYWdhdGlvbigpIDoga2V5c0Rvd25CeUtleS5hZGQoZC5rZXkpCiAgICAgICAgfSk7CiAgICAgICAgcnVudGltZS5Vc2VyU2NyaXB0RGlzcGF0Y2hlcigpLmFkZEV2ZW50TGlzdGVuZXIoImtleXVwIiwgZCA9PiBrZXlzRG93bkJ5S2V5LmRlbGV0ZShkLmtleSkpOwogICAgICAgIHJ1bnRpbWUuRGlzcGF0Y2hlcigpLmFkZEV2ZW50TGlzdGVuZXIoIndpbmRvdy1ibHVyIiwgKCkgPT4ga2V5c0Rvd25CeUtleS5jbGVhcigpKTsKICAgICAgICBydW50aW1lLklzSW5Xb3JrZXIoKSAmJiAoc2VsZi5hbGVydCA9IGQgPT4gewogICAgICAgICAgICBkaWRXYXJuSW5BbGVydFBvbHlmaWxsIHx8IChkaWRXYXJuSW5BbGVydFBvbHlmaWxsID0gITAsIGNvbnNvbGUud2FybigiW0NvbnN0cnVjdF0gYWxlcnQoKSB3YXMgY2FsbGVkIGZyb20gYSBXZWIgV29ya2VyLCBiZWNhdXNlIHRoZSBwcm9qZWN0ICdVc2Ugd29ya2VyJyBzZXR0aW5nIGlzIGVuYWJsZWQuIFRoaXMgbWV0aG9kIGlzIG5vdCBub3JtYWxseSBhdmFpbGFibGUgaW4gYSBXZWIgV29ya2VyLiBDb25zdHJ1Y3QgaGFzIGltcGxlbWVudGVkIHRoZSBhbGVydCBmb3IgeW91LCBidXQgbm90ZSB0aGF0IG90aGVyIGZlYXR1cmVzIG1heSBiZSBtaXNzaW5nIGluIHdvcmtlciBtb2RlLiBZb3UgbWF5IHdpc2ggdG8gZGlzYWJsZSAnVXNlIHdvcmtlcicsIG9yIHVzZSBhIG1vcmUgY29udmVuaWVudCBmdW5jdGlvbiBsaWtlIGNvbnNvbGUubG9nKCkuIEZvciBtb3JlIGluZm9ybWF0aW9uIHBsZWFzZSByZWZlciB0byB0aGUgc2NyaXB0aW5nIHNlY3Rpb24gb2YgdGhlIG1hbnVhbC4iKSk7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmFsZXJ0KGQpCiAgICAgICAgfSkKICAgIH0KICAgIF9Jbml0R2xvYmFsVmFycyhhKSB7CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGhpcy5nbG9iYWxWYXJzLCBhKQogICAgfQogICAgYWRkRXZlbnRMaXN0ZW5lcihhLCBiKSB7CiAgICAgICAgcnVudGltZS5Vc2VyU2NyaXB0RGlzcGF0Y2hlcigpLmFkZEV2ZW50TGlzdGVuZXIoYSwgYikKICAgIH0KICAgIHJlbW92ZUV2ZW50TGlzdGVuZXIoYSwgYikgewogICAgICAgIHJ1bnRpbWUuVXNlclNjcmlwdERpc3BhdGNoZXIoKS5yZW1vdmVFdmVudExpc3RlbmVyKGEsIGIpCiAgICB9CiAgICBjYWxsRnVuY3Rpb24oYSwgLi4uYikgewogICAgICAgIEMzWCRqc2NvbXAkMS5SZXF1aXJlU3RyaW5nKGEpOwogICAgICAgIGNvbnN0IGQgPSBydW50aW1lLkdldEV2ZW50U2hlZXRNYW5hZ2VyKCksCiAgICAgICAgICAgIGMgPSBkLkdldEZ1bmN0aW9uQmxvY2tCeU5hbWUoYSk7CiAgICAgICAgaWYgKCFjKSB0aHJvdyBFcnJvcihgY2Fubm90IGZpbmQgZnVuY3Rpb24gbmFtZSAnJHthfSdgKTsKICAgICAgICBpZiAoIWMuSXNFbmFibGVkKCkpIHJldHVybiBjLkdldERlZmF1bHRSZXR1cm5WYWx1ZSgpOwogICAgICAgIGlmIChiLmxlbmd0aCA8IGMuR2V0RnVuY3Rpb25QYXJhbWV0ZXJDb3VudCgpKSB0aHJvdyBFcnJvcihgbm90IGVub3VnaCBmdW5jdGlvbiBwYXJhbWV0ZXJzIHBhc3NlZCBmb3IgJyR7YX0nICgke2IubGVuZ3RofSBwYXNzZWQsICR7Yy5HZXRGdW5jdGlvblBhcmFtZXRlckNvdW50KCl9IGV4cGVjdGVkKWApOwogICAgICAgIGNvbnN0IGUgPSBjLkdldEV2ZW50QmxvY2soKTsKICAgICAgICBhID0gbnVsbDsKICAgICAgICB2YXIgZyA9IGQuR2V0Q3VycmVudEV2ZW50KCk7CiAgICAgICAgZyAmJiAoZyA9IGcuR2V0U29sTW9kaWZpZXJzSW5jbHVkaW5nUGFyZW50cygpLCAwIDwgZy5sZW5ndGggJiYgKGEgPSBnLCBjLklzQ29weVBpY2tlZCgpID8gZC5QdXNoQ29weVNvbChnKSA6IGQuUHVzaENsZWFuU29sKGcpKSk7CiAgICAgICAgYiA9IGUuUnVuQXNFeHByZXNzaW9uRnVuY3Rpb25DYWxsKGUuR2V0U29sTW9kaWZpZXJzSW5jbHVkaW5nUGFyZW50cygpLCBjLklzQ29weVBpY2tlZCgpLCBjLkdldFJldHVyblR5cGUoKSwgYy5HZXREZWZhdWx0UmV0dXJuVmFsdWUoKSwgLi4uYik7CiAgICAgICAgYSAmJiBkLlBvcFNvbChhKTsKICAgICAgICByZXR1cm4gYgogICAgfQogICAgc2V0UmV0dXJuVmFsdWUoYSkgewogICAgICAgIGNvbnN0IGIgPSBydW50aW1lLkdldEV2ZW50U3RhY2soKS5HZXRDdXJyZW50RXhwRnVuY1N0YWNrRnJhbWUoKTsKICAgICAgICBpZiAoIWIpIHRocm93IEVycm9yKCJub3QgaW4gYSBmdW5jdGlvbiB3aGljaCByZXR1cm5zIGEgdmFsdWUiKTsKICAgICAgICBzd2l0Y2ggKGIuR2V0RnVuY3Rpb25SZXR1cm5UeXBlKCkpIHsKICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgIm51bWJlciIgPT09CiAgICAgICAgICAgICAgICB0eXBlb2YgYSAmJiBiLlNldEZ1bmN0aW9uUmV0dXJuVmFsdWUoYSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgInN0cmluZyIgPT09IHR5cGVvZiBhICYmIGIuU2V0RnVuY3Rpb25SZXR1cm5WYWx1ZShhKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICAibnVtYmVyIiAhPT0gdHlwZW9mIGEgJiYgInN0cmluZyIgIT09IHR5cGVvZiBhIHx8IGIuU2V0RnVuY3Rpb25SZXR1cm5WYWx1ZShhKQogICAgICAgIH0KICAgIH0KICAgIGdldCBkdCgpIHsKICAgICAgICByZXR1cm4gcnVudGltZS5HZXREdCgpCiAgICB9CiAgICBnZXQgZ2FtZVRpbWUoKSB7CiAgICAgICAgcmV0dXJuIHJ1bnRpbWUuR2V0R2FtZVRpbWUoKQogICAgfQogICAgZ2V0IHdhbGxUaW1lKCkgewogICAgICAgIHJldHVybiBydW50aW1lLkdldFdhbGxUaW1lKCkKICAgIH0KICAgIHJhbmRvbSgpIHsKICAgICAgICByZXR1cm4gcnVudGltZS5SYW5kb20oKQogICAgfQogICAgZ2V0IGxheW91dCgpIHsKICAgICAgICByZXR1cm4gcnVudGltZS5HZXRNYWluUnVubmluZ0xheW91dCgpLkdldElMYXlvdXQoKQogICAgfQogICAgZ2V0TGF5b3V0KGEpIHsKICAgICAgICBjb25zdCBiID0gcnVudGltZS5HZXRMYXlvdXRNYW5hZ2VyKCk7CiAgICAgICAgaWYgKCJudW1iZXIiID09PSB0eXBlb2YgYSB8fCAic3RyaW5nIiA9PT0gdHlwZW9mIGEpIGEgPSBiLkdldExheW91dChhKTsKICAgICAgICBlbHNlIHRocm93IG5ldyBUeXBlRXJyb3IoImV4cGVjdGVkIHN0cmluZyBvciBudW1iZXIiKTsKICAgICAgICBpZiAoIWEpIHRocm93IEVycm9yKCJpbnZhbGlkIGxheW91dCIpOwogICAgICAgIHJldHVybiBhLkdldElMYXlvdXQoKQogICAgfQogICAgZ2V0QWxsTGF5b3V0cygpIHsKICAgICAgICByZXR1cm4gcnVudGltZS5HZXRMYXlvdXRNYW5hZ2VyKCkuR2V0QWxsTGF5b3V0cygpLm1hcChhID0+IGEuR2V0SUxheW91dCgpKQogICAgfQogICAgZ29Ub0xheW91dChhKSB7CiAgICAgICAgY29uc3QgYiA9IHJ1bnRpbWUuR2V0TGF5b3V0TWFuYWdlcigpOwogICAgICAgIGlmICgibnVtYmVyIiA9PT0gdHlwZW9mIGEgfHwgInN0cmluZyIgPT09IHR5cGVvZiBhKSBhID0gYi5HZXRMYXlvdXQoYSk7CiAgICAgICAgZWxzZSB0aHJvdyBuZXcgVHlwZUVycm9yKCJleHBlY3RlZCBzdHJpbmcgb3IgbnVtYmVyIik7CiAgICAgICAgaWYgKCFhKSB0aHJvdyBFcnJvcigiaW52YWxpZCBsYXlvdXQiKTsKICAgICAgICBiLklzUGVuZGluZ0NoYW5nZU1haW5MYXlvdXQoKSB8fCBiLkNoYW5nZU1haW5MYXlvdXQoYSkKICAgIH0KICAgIGdldCBrZXlib2FyZCgpIHsKICAgICAgICBjb25zdCBhID0gcnVudGltZS5fR2V0Q29tbW9uU2NyaXB0SW50ZXJmYWNlcygpLmtleWJvYXJkOwogICAgICAgIGlmICghYSkgdGhyb3cgRXJyb3IoInJ1bnRpbWUua2V5Ym9hcmQgdXNlZCBidXQgS2V5Ym9hcmQgb2JqZWN0IG1pc3NpbmcgLSBhZGQgaXQgdG8geW91ciBwcm9qZWN0IGZpcnN0Iik7CiAgICAgICAgcmV0dXJuIGEKICAgIH0KICAgIGdldCBtb3VzZSgpIHsKICAgICAgICBjb25zdCBhID0gcnVudGltZS5fR2V0Q29tbW9uU2NyaXB0SW50ZXJmYWNlcygpLm1vdXNlOwogICAgICAgIGlmICghYSkgdGhyb3cgRXJyb3IoInJ1bnRpbWUubW91c2UgdXNlZCBidXQgTW91c2Ugb2JqZWN0IG1pc3NpbmcgLSBhZGQgaXQgdG8geW91ciBwcm9qZWN0IGZpcnN0Iik7CiAgICAgICAgcmV0dXJuIGEKICAgIH0KICAgIGdldCB0b3VjaCgpIHsKICAgICAgICBjb25zdCBhID0gcnVudGltZS5fR2V0Q29tbW9uU2NyaXB0SW50ZXJmYWNlcygpLnRvdWNoOwogICAgICAgIGlmICghYSkgdGhyb3cgRXJyb3IoInJ1bnRpbWUudG91Y2ggdXNlZCBidXQgVG91Y2ggb2JqZWN0IG1pc3NpbmcgLSBhZGQgaXQgdG8geW91ciBwcm9qZWN0IGZpcnN0Iik7CiAgICAgICAgcmV0dXJuIGEKICAgIH0KICAgIGludm9rZURvd25sb2FkKGEsIGIpIHsKICAgICAgICBDM1gkanNjb21wJDEuUmVxdWlyZVN0cmluZyhhKTsKICAgICAgICBDM1gkanNjb21wJDEuUmVxdWlyZVN0cmluZyhiKTsKICAgICAgICBydW50aW1lLkludm9rZURvd25sb2FkKGEsIGIpCiAgICB9CiAgICBnZXRJbnN0YW5jZUJ5VWlkKGEpIHsKICAgICAgICBDM1gkanNjb21wJDEuUmVxdWlyZUZpbml0ZU51bWJlcihhKTsKICAgICAgICByZXR1cm4gKGEgPSBydW50aW1lLkdldEluc3RhbmNlQnlVSUQoYSkpID8gYS5HZXRJbnRlcmZhY2VDbGFzcygpIDogbnVsbAogICAgfQogICAgc29ydFpPcmRlcihhLCBiKSB7CiAgICAgICAgQzNYJGpzY29tcCQxLlJlcXVpcmVGdW5jdGlvbihiKTsKICAgICAgICBjb25zdCBkID0gcnVudGltZS5HZXRDdXJyZW50TGF5b3V0KCk7CiAgICAgICAgZm9yICh2YXIgYyBvZiBhKSB7CiAgICAgICAgICAgIGEgPSBydW50aW1lLl9VbndyYXBJV29ybGRJbnN0YW5jZShjKTsKICAgICAgICAgICAgdmFyIGUgPSBhLkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICB0ZW1wWk9yZGVyTGlzdC5wdXNoKFtlLkdldExheWVyKCkuR2V0SW5kZXgoKSwgZS5HZXRaSW5kZXgoKV0pOwogICAgICAgICAgICB0ZW1wSW5zdGFuY2VzLnB1c2goYSkKICAgICAgICB9CiAgICAgICAgaWYgKDAgIT09IHRlbXBaT3JkZXJMaXN0Lmxlbmd0aCkgewogICAgICAgICAgICB0ZW1wWk9yZGVyTGlzdC5zb3J0KFNvcnRaT3JkZXJMaXN0KTsKICAgICAgICAgICAgdGVtcEluc3RhbmNlcy5zb3J0KChnLCBrKSA9PiBiKGcuR2V0SW50ZXJmYWNlQ2xhc3MoKSwKICAgICAgICAgICAgICAgIGsuR2V0SW50ZXJmYWNlQ2xhc3MoKSkpOwogICAgICAgICAgICBjID0gITE7CiAgICAgICAgICAgIGZvciAobGV0IGcgPSAwLCBrID0gdGVtcFpPcmRlckxpc3QubGVuZ3RoOyBnIDwgazsgKytnKSB7CiAgICAgICAgICAgICAgICBhID0gdGVtcEluc3RhbmNlc1tnXTsKICAgICAgICAgICAgICAgIGUgPSBkLkdldExheWVyQnlJbmRleCh0ZW1wWk9yZGVyTGlzdFtnXVswXSk7CiAgICAgICAgICAgICAgICBjb25zdCBtID0gdGVtcFpPcmRlckxpc3RbZ11bMV0sCiAgICAgICAgICAgICAgICAgICAgbiA9IGUuX0dldEluc3RhbmNlcygpOwogICAgICAgICAgICAgICAgblttXSAhPT0gYSAmJiAoblttXSA9IGEsIGEuR2V0V29ybGRJbmZvKCkuX1NldExheWVyKGUpLCBlLlNldFpJbmRpY2VzQ2hhbmdlZCgpLCBjID0gITApCiAgICAgICAgICAgIH0KICAgICAgICAgICAgYyAmJiBydW50aW1lLlVwZGF0ZVJlbmRlcigpOwogICAgICAgICAgICBDMyRqc2NvbXAkNTguY2xlYXJBcnJheSh0ZW1wWk9yZGVyTGlzdCk7CiAgICAgICAgICAgIEMzJGpzY29tcCQ1OC5jbGVhckFycmF5KHRlbXBJbnN0YW5jZXMpCiAgICAgICAgfQogICAgfQogICAgYXN5bmMgY3JlYXRlV29ya2VyKGEsIGIpIHsKICAgICAgICB2YXIgZCA9IG5ldyBNZXNzYWdlQ2hhbm5lbDsKICAgICAgICBjb25zdCBjID0gZC5wb3J0MTsKICAgICAgICBkID0gZC5wb3J0MjsKICAgICAgICBhd2FpdCBydW50aW1lLlBvc3RDb21wb25lbnRNZXNzYWdlVG9ET01Bc3luYygicnVudGltZSIsICJzY3JpcHQtY3JlYXRlLXdvcmtlciIsIHsKICAgICAgICAgICAgdXJsOiBhLAogICAgICAgICAgICBvcHRzOiBiLAogICAgICAgICAgICBwb3J0MjogZAogICAgICAgIH0sIFtkXSk7CiAgICAgICAgcmV0dXJuIGMKICAgIH0KICAgIGFsZXJ0KGEpIHsKICAgICAgICByZXR1cm4gcnVudGltZS5Qb3N0Q29tcG9uZW50TWVzc2FnZVRvRE9NQXN5bmMoInJ1bnRpbWUiLCAiYWxlcnQiLCB7CiAgICAgICAgICAgIG1lc3NhZ2U6IGEgKyAocnVudGltZS5Jc0luV29ya2VyKCkgPyAiIFt2aWEgV2ViIFdvcmtlcl0iIDogIiIpCiAgICAgICAgfSkKICAgIH0KfTsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkNTkgPSBzZWxmLkMzOwpsZXQgYXNzZXRNYW5hZ2VyID0gbnVsbDsKc2VsZi5JQXNzZXRNYW5hZ2VyID0gY2xhc3MgewogICAgY29uc3RydWN0b3IoYSkgewogICAgICAgIGFzc2V0TWFuYWdlciA9IGE7CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGhpcywgewogICAgICAgICAgICBpc1dlYk1PcHVzU3VwcG9ydGVkOiB7CiAgICAgICAgICAgICAgICB2YWx1ZTogYXNzZXRNYW5hZ2VyLklzQXVkaW9Gb3JtYXRTdXBwb3J0ZWQoImF1ZGlvL3dlYm07IGNvZGVjcz1vcHVzIiksCiAgICAgICAgICAgICAgICB3cml0YWJsZTogITEKICAgICAgICAgICAgfQogICAgICAgIH0pCiAgICB9CiAgICBmZXRjaFRleHQoYSkgewogICAgICAgIHJldHVybiBhc3NldE1hbmFnZXIuRmV0Y2hUZXh0KGEpCiAgICB9CiAgICBmZXRjaEpzb24oYSkgewogICAgICAgIHJldHVybiBhc3NldE1hbmFnZXIuRmV0Y2hKc29uKGEpCiAgICB9CiAgICBmZXRjaEJsb2IoYSkgewogICAgICAgIHJldHVybiBhc3NldE1hbmFnZXIuRmV0Y2hCbG9iKGEpCiAgICB9CiAgICBmZXRjaEFycmF5QnVmZmVyKGEpIHsKICAgICAgICByZXR1cm4gYXNzZXRNYW5hZ2VyLkZldGNoQXJyYXlCdWZmZXIoYSkKICAgIH0KICAgIGdldFByb2plY3RGaWxlVXJsKGEpIHsKICAgICAgICByZXR1cm4gYXNzZXRNYW5hZ2VyLkdldFByb2plY3RGaWxlVXJsKGEpCiAgICB9CiAgICBnZXRNZWRpYUZpbGVVcmwoYSkgewogICAgICAgICJmbGF0IiA9PT0gYXNzZXRNYW5hZ2VyLkdldEZpbGVTdHJ1Y3R1cmUoKSAmJgogICAgICAgICAgICBDMyRqc2NvbXAkNTkuSXNSZWxhdGl2ZVVSTChhKSAmJiAoYSA9IGEudG9Mb3dlckNhc2UoKSk7CiAgICAgICAgcmV0dXJuIGFzc2V0TWFuYWdlci5HZXRNZWRpYUZpbGVVcmwoYSkKICAgIH0KICAgIGdldCBtZWRpYUZvbGRlcigpIHsKICAgICAgICByZXR1cm4gYXNzZXRNYW5hZ2VyLkdldE1lZGlhU3ViZm9sZGVyKCkKICAgIH0KICAgIGFzeW5jIGRlY29kZVdlYk1PcHVzKGEsIGIpIHsKICAgICAgICBpZiAodGhpcy5pc1dlYk1PcHVzU3VwcG9ydGVkKSB0aHJvdyBFcnJvcigiZGVjb2RlV2ViTU9wdXMoKTogbm90IHN1cHBvcnRlZCBiZWNhdXNlIFdlYk0gT3B1cyBpcyBzdXBwb3J0ZWQgYnkgdGhlIHBsYXRmb3JtIik7CiAgICAgICAgYiA9IGF3YWl0IGFzc2V0TWFuYWdlci5HZXRSdW50aW1lKCkuX1dhc21EZWNvZGVXZWJNT3B1cyhiKTsKICAgICAgICBiID0gbmV3IEZsb2F0MzJBcnJheShiKTsKICAgICAgICBhID0gYS5jcmVhdGVCdWZmZXIoMSwgYi5sZW5ndGgsIDQ4RTMpOwogICAgICAgIGEuZ2V0Q2hhbm5lbERhdGEoMCkuc2V0KGIpOwogICAgICAgIHJldHVybiBhCiAgICB9CiAgICBsb2FkU2NyaXB0cyguLi5hKSB7CiAgICAgICAgcmV0dXJuIGFzc2V0TWFuYWdlci5Mb2FkU2NyaXB0cyguLi5hKQogICAgfQogICAgY29tcGlsZVdlYkFzc2VtYmx5KGEpIHsKICAgICAgICByZXR1cm4gYXNzZXRNYW5hZ2VyLkNvbXBpbGVXZWJBc3NlbWJseShhKQogICAgfQogICAgbG9hZFN0eWxlU2hlZXQoYSkgewogICAgICAgIHJldHVybiBhc3NldE1hbmFnZXIuTG9hZFN0eWxlU2hlZXQoYSkKICAgIH0KfTsKInVzZSBzdHJpY3QiOwpjb25zdCBDM1gkanNjb21wJDMgPSBzZWxmLkMzWDsKc2VsZi5JU3RvcmFnZSA9IGNsYXNzIHsKICAgIGNvbnN0cnVjdG9yKGEpIHsKICAgICAgICB0aGlzLl9zdG9yYWdlID0gYS5fR2V0UHJvamVjdFN0b3JhZ2UoKQogICAgfQogICAgZ2V0SXRlbShhKSB7CiAgICAgICAgQzNYJGpzY29tcCQzLlJlcXVpcmVTdHJpbmcoYSk7CiAgICAgICAgcmV0dXJuIHRoaXMuX3N0b3JhZ2UuZ2V0SXRlbShhKQogICAgfQogICAgc2V0SXRlbShhLCBiKSB7CiAgICAgICAgQzNYJGpzY29tcCQzLlJlcXVpcmVTdHJpbmcoYSk7CiAgICAgICAgcmV0dXJuIHRoaXMuX3N0b3JhZ2Uuc2V0SXRlbShhLCBiKQogICAgfQogICAgcmVtb3ZlSXRlbShhKSB7CiAgICAgICAgQzNYJGpzY29tcCQzLlJlcXVpcmVTdHJpbmcoYSk7CiAgICAgICAgcmV0dXJuIHRoaXMuX3N0b3JhZ2UucmVtb3ZlSXRlbShhKQogICAgfQogICAgY2xlYXIoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3N0b3JhZ2UuY2xlYXIoKQogICAgfQogICAga2V5cygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fc3RvcmFnZS5rZXlzKCkKICAgIH0KfTsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkNjEgPSBzZWxmLkMzLAogICAgQzNYJGpzY29tcCQ0ID0gc2VsZi5DM1gsCiAgICBtYXAkanNjb21wJDIgPSBuZXcgV2Vha01hcDsKc2VsZi5JT2JqZWN0Q2xhc3MgPSBjbGFzcyB7CiAgICBjb25zdHJ1Y3RvcihhKSB7CiAgICAgICAgbWFwJGpzY29tcCQyLnNldCh0aGlzLCBhKTsKICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0aGlzLCB7CiAgICAgICAgICAgIG5hbWU6IHsKICAgICAgICAgICAgICAgIHZhbHVlOiBhLkdldE5hbWUoKSwKICAgICAgICAgICAgICAgIHdyaXRhYmxlOiAhMQogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgYS5HZXRSdW50aW1lKCkuX01hcFNjcmlwdEludGVyZmFjZSh0aGlzLCBhKQogICAgfQogICAgYWRkRXZlbnRMaXN0ZW5lcihhLCBiKSB7CiAgICAgICAgQzNYJGpzY29tcCQ0LlJlcXVpcmVTdHJpbmcoYSk7CiAgICAgICAgQzNYJGpzY29tcCQ0LlJlcXVpcmVGdW5jdGlvbihiKTsKICAgICAgICBtYXAkanNjb21wJDIuZ2V0KHRoaXMpLlVzZXJTY3JpcHREaXNwYXRjaGVyKCkuYWRkRXZlbnRMaXN0ZW5lcihhLCBiKQogICAgfQogICAgcmVtb3ZlRXZlbnRMaXN0ZW5lcihhLCBiKSB7CiAgICAgICAgQzNYJGpzY29tcCQ0LlJlcXVpcmVTdHJpbmcoYSk7CiAgICAgICAgQzNYJGpzY29tcCQ0LlJlcXVpcmVGdW5jdGlvbihiKTsKICAgICAgICBtYXAkanNjb21wJDIuZ2V0KHRoaXMpLlVzZXJTY3JpcHREaXNwYXRjaGVyKCkucmVtb3ZlRXZlbnRMaXN0ZW5lcihhLCBiKQogICAgfQogICAgZ2V0QWxsSW5zdGFuY2VzKCkgewogICAgICAgIHJldHVybiBbLi4udGhpcy5pbnN0YW5jZXMoKV0KICAgIH0KICAgIGdldEZpcnN0SW5zdGFuY2UoKSB7CiAgICAgICAgcmV0dXJuIEMzJGpzY29tcCQ2MS5maXJzdCh0aGlzLmluc3RhbmNlcygpKQogICAgfQogICAgZ2V0UGlja2VkSW5zdGFuY2VzKCkgewogICAgICAgIHJldHVybiBbLi4udGhpcy5waWNrZWRJbnN0YW5jZXMoKV0KICAgIH0KICAgIGdldEZpcnN0UGlja2VkSW5zdGFuY2UoKSB7CiAgICAgICAgcmV0dXJuIEMzJGpzY29tcCQ2MS5maXJzdCh0aGlzLnBpY2tlZEluc3RhbmNlcygpKQogICAgfSogaW5zdGFuY2VzKCkgewogICAgICAgIGZvciAoY29uc3QgYSBvZiBtYXAkanNjb21wJDIuZ2V0KHRoaXMpLmluc3RhbmNlc0luY2x1ZGluZ1BlbmRpbmdDcmVhdGUoKSkgeWllbGQgYS5HZXRJbnRlcmZhY2VDbGFzcygpCiAgICB9KiBwaWNrZWRJbnN0YW5jZXMoKSB7CiAgICAgICAgZm9yIChjb25zdCBhIG9mIG1hcCRqc2NvbXAkMi5nZXQodGhpcykuR2V0Q3VycmVudFNvbCgpLkdldEluc3RhbmNlcygpKSB5aWVsZCBhLkdldEludGVyZmFjZUNsYXNzKCkKICAgIH0KICAgIHNldEluc3RhbmNlQ2xhc3MoYSkgewogICAgICAgIEMzWCRqc2NvbXAkNC5SZXF1aXJlRnVuY3Rpb24oYSk7CiAgICAgICAgaWYgKDAgPCBtYXAkanNjb21wJDIuZ2V0KHRoaXMpLkdldEluc3RhbmNlQ291bnQoKSkgdGhyb3cgRXJyb3IoInNldEluc3RhbmNlQ2xhc3MoKSBjYWxsZWQgdG9vIGxhdGUsIGJlY2F1c2UgaW5zdGFuY2VzIGhhdmUgYWxyZWFkeSBiZWVuIGNyZWF0ZWQgLSBjYWxsIGluIHJ1bk9uU3RhcnR1cCIpOwogICAgICAgIG1hcCRqc2NvbXAkMi5nZXQodGhpcykuX1NldFVzZXJTY3JpcHRJbnN0YW5jZUNsYXNzKGEpCiAgICB9CiAgICBjcmVhdGVJbnN0YW5jZShhLCBiLCBkLCBjLCBlKSB7CiAgICAgICAgQzNYJGpzY29tcCQ0LlJlcXVpcmVOdW1iZXIoYik7CiAgICAgICAgQzNYJGpzY29tcCQ0LlJlcXVpcmVOdW1iZXIoZCk7CiAgICAgICAgaWYgKCJudW1iZXIiICE9PSB0eXBlb2YgYSAmJiAic3RyaW5nIiAhPT0gdHlwZW9mIGEpIHRocm93IG5ldyBUeXBlRXJyb3IoImludmFsaWQgbGF5ZXIgcGFyYW1ldGVyIik7CiAgICAgICAgY29uc3QgZyA9IG1hcCRqc2NvbXAkMi5nZXQodGhpcyksCiAgICAgICAgICAgIGsgPSBnLkdldFJ1bnRpbWUoKTsKICAgICAgICBhID0gay5HZXRNYWluUnVubmluZ0xheW91dCgpLkdldExheWVyKGEpOwogICAgICAgIGlmICghYSkgdGhyb3cgRXJyb3IoImludmFsaWQgbGF5ZXIiKTsKICAgICAgICBiID0gay5DcmVhdGVJbnN0YW5jZShnLCBhLCBiLCBkLCBjLCBlKTsKICAgICAgICBjICYmIGEuU29ydEFuZEFkZEluc3RhbmNlc0J5WkluZGV4KGIpOwogICAgICAgIGMgPSBrLkdldEV2ZW50U2hlZXRNYW5hZ2VyKCk7CiAgICAgICAgYy5CbG9ja0ZsdXNoaW5nSW5zdGFuY2VzKCEwKTsKICAgICAgICBiLl9UcmlnZ2VyT25DcmVhdGVkT25TZWxmQW5kUmVsYXRlZCgpOwogICAgICAgIGMuQmxvY2tGbHVzaGluZ0luc3RhbmNlcyghMSk7CiAgICAgICAgYy5Jc0luRXZlbnRFbmdpbmUoKSB8fCBrLkZsdXNoUGVuZGluZ0luc3RhbmNlcygpOwogICAgICAgIHJldHVybiBiLkdldEludGVyZmFjZUNsYXNzKCkKICAgIH0KfTsKInVzZSBzdHJpY3QiOwpjb25zdCBDM1gkanNjb21wJDUgPSBzZWxmLkMzWCwKICAgIG1hcCRqc2NvbXAkMyA9IG5ldyBXZWFrTWFwOwpzZWxmLklMYXlvdXQgPSBjbGFzcyB7CiAgICBjb25zdHJ1Y3RvcihhKSB7CiAgICAgICAgbWFwJGpzY29tcCQzLnNldCh0aGlzLCBhKTsKICAgICAgICBjb25zdCBiID0gW10sCiAgICAgICAgICAgIGQgPSBhLkdldEVmZmVjdExpc3QoKSwKICAgICAgICAgICAgYyA9IGQuR2V0QWxsRWZmZWN0VHlwZXMoKS5sZW5ndGg7CiAgICAgICAgZm9yIChsZXQgZSA9IDA7IGUgPCBjOyArK2UpIGIucHVzaChuZXcgc2VsZi5JRWZmZWN0SW5zdGFuY2UoZCwgZSkpOwogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRoaXMsIHsKICAgICAgICAgICAgbmFtZTogewogICAgICAgICAgICAgICAgdmFsdWU6IGEuR2V0TmFtZSgpLAogICAgICAgICAgICAgICAgd3JpdGFibGU6ICExCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGluZGV4OiB7CiAgICAgICAgICAgICAgICB2YWx1ZTogYS5HZXRJbmRleCgpLAogICAgICAgICAgICAgICAgd3JpdGFibGU6ICExCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVmZmVjdHM6IHsKICAgICAgICAgICAgICAgIHZhbHVlOiBiLAogICAgICAgICAgICAgICAgd3JpdGFibGU6ICExCiAgICAgICAgICAgIH0KICAgICAgICB9KQogICAgfQogICAgYWRkRXZlbnRMaXN0ZW5lcihhLCBiKSB7CiAgICAgICAgQzNYJGpzY29tcCQ1LlJlcXVpcmVTdHJpbmcoYSk7CiAgICAgICAgQzNYJGpzY29tcCQ1LlJlcXVpcmVGdW5jdGlvbihiKTsKICAgICAgICBtYXAkanNjb21wJDMuZ2V0KHRoaXMpLlVzZXJTY3JpcHREaXNwYXRjaGVyKCkuYWRkRXZlbnRMaXN0ZW5lcihhLCBiKQogICAgfQogICAgcmVtb3ZlRXZlbnRMaXN0ZW5lcihhLCBiKSB7CiAgICAgICAgQzNYJGpzY29tcCQ1LlJlcXVpcmVTdHJpbmcoYSk7CiAgICAgICAgQzNYJGpzY29tcCQ1LlJlcXVpcmVGdW5jdGlvbihiKTsKICAgICAgICBtYXAkanNjb21wJDMuZ2V0KHRoaXMpLlVzZXJTY3JpcHREaXNwYXRjaGVyKCkucmVtb3ZlRXZlbnRMaXN0ZW5lcihhLCBiKQogICAgfQogICAgZ2V0IHdpZHRoKCkgewogICAgICAgIHJldHVybiBtYXAkanNjb21wJDMuZ2V0KHRoaXMpLkdldFdpZHRoKCkKICAgIH0KICAgIHNldCB3aWR0aChhKSB7CiAgICAgICAgbWFwJGpzY29tcCQzLmdldCh0aGlzKS5TZXRXaWR0aChhKQogICAgfQogICAgZ2V0IGhlaWdodCgpIHsKICAgICAgICByZXR1cm4gbWFwJGpzY29tcCQzLmdldCh0aGlzKS5HZXRIZWlnaHQoKQogICAgfQogICAgc2V0IGhlaWdodChhKSB7CiAgICAgICAgbWFwJGpzY29tcCQzLmdldCh0aGlzKS5TZXRIZWlnaHQoYSkKICAgIH0KICAgIHNldCBzY2FsZShhKSB7CiAgICAgICAgQzNYJGpzY29tcCQ1LlJlcXVpcmVGaW5pdGVOdW1iZXIoYSk7CiAgICAgICAgbWFwJGpzY29tcCQzLmdldCh0aGlzKS5TZXRTY2FsZShhKQogICAgfQogICAgZ2V0IHNjYWxlKCkgewogICAgICAgIHJldHVybiBtYXAkanNjb21wJDMuZ2V0KHRoaXMpLkdldFNjYWxlKCkKICAgIH0KICAgIHNldCBhbmdsZShhKSB7CiAgICAgICAgQzNYJGpzY29tcCQ1LlJlcXVpcmVGaW5pdGVOdW1iZXIoYSk7CiAgICAgICAgbWFwJGpzY29tcCQzLmdldCh0aGlzKS5TZXRBbmdsZShhKQogICAgfQogICAgZ2V0IGFuZ2xlKCkgewogICAgICAgIHJldHVybiBtYXAkanNjb21wJDMuZ2V0KHRoaXMpLkdldEFuZ2xlKCkKICAgIH0KICAgIHNldCBzY3JvbGxYKGEpIHsKICAgICAgICBDM1gkanNjb21wJDUuUmVxdWlyZU51bWJlcihhKTsKICAgICAgICBtYXAkanNjb21wJDMuZ2V0KHRoaXMpLlNldFNjcm9sbFgoYSkKICAgIH0KICAgIGdldCBzY3JvbGxYKCkgewogICAgICAgIHJldHVybiBtYXAkanNjb21wJDMuZ2V0KHRoaXMpLkdldFNjcm9sbFgoKQogICAgfQogICAgc2V0IHNjcm9sbFkoYSkgewogICAgICAgIEMzWCRqc2NvbXAkNS5SZXF1aXJlTnVtYmVyKGEpOwogICAgICAgIG1hcCRqc2NvbXAkMy5nZXQodGhpcykuU2V0U2Nyb2xsWShhKQogICAgfQogICAgZ2V0IHNjcm9sbFkoKSB7CiAgICAgICAgcmV0dXJuIG1hcCRqc2NvbXAkMy5nZXQodGhpcykuR2V0U2Nyb2xsWSgpCiAgICB9CiAgICBzY3JvbGxUbyhhLCBiKSB7CiAgICAgICAgQzNYJGpzY29tcCQ1LlJlcXVpcmVOdW1iZXIoYSk7CiAgICAgICAgQzNYJGpzY29tcCQ1LlJlcXVpcmVOdW1iZXIoYik7CiAgICAgICAgY29uc3QgZCA9IG1hcCRqc2NvbXAkMy5nZXQodGhpcyk7CiAgICAgICAgZC5TZXRTY3JvbGxYKGEpOwogICAgICAgIGQuU2V0U2Nyb2xsWShiKQogICAgfQogICAgZ2V0TGF5ZXIoYSkgewogICAgICAgIGNvbnN0IGIgPSBtYXAkanNjb21wJDMuZ2V0KHRoaXMpOwogICAgICAgIGlmICgibnVtYmVyIiA9PT0gdHlwZW9mIGEgfHwgInN0cmluZyIgPT09IHR5cGVvZiBhKSBhID0gYi5HZXRMYXllcihhKTsKICAgICAgICBlbHNlIHRocm93IG5ldyBUeXBlRXJyb3IoImV4cGVjdGVkIHN0cmluZyBvciBudW1iZXIiKTsKICAgICAgICByZXR1cm4gYSA/IGEuR2V0SUxheWVyKCkgOiBudWxsCiAgICB9CiAgICBnZXRBbGxMYXllcnMoKSB7CiAgICAgICAgcmV0dXJuIG1hcCRqc2NvbXAkMy5nZXQodGhpcykuR2V0TGF5ZXJzKCkubWFwKGEgPT4gYS5HZXRJTGF5ZXIoKSkKICAgIH0qIGFsbExheWVycygpIHsKICAgICAgICBmb3IgKGNvbnN0IGEgb2YgbWFwJGpzY29tcCQzLmdldCh0aGlzKS5hbGxMYXllcnMoKSkgeWllbGQgYS5HZXRJTGF5ZXIoKQogICAgfQogICAgc2V0VmFuaXNoaW5nUG9pbnQoYSwgYikgewogICAgICAgIEMzWCRqc2NvbXAkNS5SZXF1aXJlRmluaXRlTnVtYmVyKGEpOwogICAgICAgIEMzWCRqc2NvbXAkNS5SZXF1aXJlRmluaXRlTnVtYmVyKGIpOwogICAgICAgIG1hcCRqc2NvbXAkMy5nZXQodGhpcykuU2V0VmFuaXNoaW5nUG9pbnRYWShhLCBiKQogICAgfQogICAgZ2V0VmFuaXNoaW5nUG9pbnQoKSB7CiAgICAgICAgcmV0dXJuIG1hcCRqc2NvbXAkMy5nZXQodGhpcykuX0dldFZhbmlzaGluZ1BvaW50KCkKICAgIH0KICAgIHNldCBwcm9qZWN0aW9uKGEpIHsKICAgICAgICBDM1gkanNjb21wJDUuUmVxdWlyZVN0cmluZyhhKTsKICAgICAgICBjb25zdCBiID0gbWFwJGpzY29tcCQzLmdldCh0aGlzKTsKICAgICAgICBpZiAoInBlcnNwZWN0aXZlIiA9PT0KICAgICAgICAgICAgYSkgYi5TZXRQZXJzcGVjdGl2ZVByb2plY3Rpb24oKTsKICAgICAgICBlbHNlIGlmICgib3J0aG9ncmFwaGljIiA9PT0gYSkgYi5TZXRPcnRob2dyYXBoaWNQcm9qZWN0aW9uKCk7CiAgICAgICAgZWxzZSB0aHJvdyBFcnJvcigiaW52YWxpZCBwcm9qZWN0aW9uIik7CiAgICB9CiAgICBnZXQgcHJvamVjdGlvbigpIHsKICAgICAgICByZXR1cm4gbWFwJGpzY29tcCQzLmdldCh0aGlzKS5Jc09ydGhvZ3JhcGhpY1Byb2plY3Rpb24oKSA/ICJvcnRob2dyYXBoaWMiIDogInBlcnNwZWN0aXZlIgogICAgfQp9OwoidXNlIHN0cmljdCI7CmNvbnN0IEMzJGpzY29tcCQ2MyA9IHNlbGYuQzMsCiAgICBDM1gkanNjb21wJDYgPSBzZWxmLkMzWCwKICAgIG1hcCRqc2NvbXAkNCA9IG5ldyBXZWFrTWFwLAogICAgQkxFTkRfTU9ERV9UT19JTkRFWCA9IG5ldyBNYXAoWwogICAgICAgIFsibm9ybWFsIiwgMF0sCiAgICAgICAgWyJhZGRpdGl2ZSIsIDFdLAogICAgICAgIFsiY29weSIsIDNdLAogICAgICAgIFsiZGVzdGluYXRpb24tb3ZlciIsIDRdLAogICAgICAgIFsic291cmNlLWluIiwgNV0sCiAgICAgICAgWyJkZXN0aW5hdGlvbi1pbiIsIDZdLAogICAgICAgIFsic291cmNlLW91dCIsIDddLAogICAgICAgIFsiZGVzdGluYXRpb24tb3V0IiwgOF0sCiAgICAgICAgWyJzb3VyY2UtYXRvcCIsIDldLAogICAgICAgIFsiZGVzdGluYXRpb24tYXRvcCIsIDEwXQogICAgXSksCiAgICBJTkRFWF9UT19CTEVORF9NT0RFID0gbmV3IE1hcChbLi4uQkxFTkRfTU9ERV9UT19JTkRFWC5lbnRyaWVzKCldLm1hcChhID0+IFthWzFdLCBhWzBdXSkpLAogICAgdGVtcENvbG9yJGpzY29tcCQxID0gQzMkanNjb21wJDYzLk5ldyhDMyRqc2NvbXAkNjMuQ29sb3IpOwpzZWxmLklMYXllciA9IGNsYXNzIHsKICAgIGNvbnN0cnVjdG9yKGEpIHsKICAgICAgICBtYXAkanNjb21wJDQuc2V0KHRoaXMsIGEpOwogICAgICAgIGNvbnN0IGIgPSBbXSwKICAgICAgICAgICAgZCA9IGEuR2V0RWZmZWN0TGlzdCgpLAogICAgICAgICAgICBjID0gZC5HZXRBbGxFZmZlY3RUeXBlcygpLmxlbmd0aDsKICAgICAgICBmb3IgKGxldCBlID0gMDsgZSA8IGM7ICsrZSkgYi5wdXNoKG5ldyBzZWxmLklFZmZlY3RJbnN0YW5jZShkLCBlKSk7CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGhpcywgewogICAgICAgICAgICBuYW1lOiB7CiAgICAgICAgICAgICAgICB2YWx1ZTogYS5HZXROYW1lKCksCiAgICAgICAgICAgICAgICB3cml0YWJsZTogITEKICAgICAgICAgICAgfSwKICAgICAgICAgICAgaW5kZXg6IHsKICAgICAgICAgICAgICAgIHZhbHVlOiBhLkdldEluZGV4KCksCiAgICAgICAgICAgICAgICB3cml0YWJsZTogITEKICAgICAgICAgICAgfSwKICAgICAgICAgICAgbGF5b3V0OiB7CiAgICAgICAgICAgICAgICB2YWx1ZTogYS5HZXRMYXlvdXQoKS5HZXRJTGF5b3V0KCksCiAgICAgICAgICAgICAgICB3cml0YWJsZTogITEKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZWZmZWN0czogewogICAgICAgICAgICAgICAgdmFsdWU6IGIsCiAgICAgICAgICAgICAgICB3cml0YWJsZTogITEKICAgICAgICAgICAgfQogICAgICAgIH0pCiAgICB9CiAgICBzdGF0aWMgX1Vud3JhcChhKSB7CiAgICAgICAgcmV0dXJuIG1hcCRqc2NvbXAkNC5nZXQoYSkKICAgIH0KICAgIGdldCBwYXJlbnRMYXllcigpIHsKICAgICAgICBjb25zdCBhID0gbWFwJGpzY29tcCQ0LmdldCh0aGlzKS5HZXRQYXJlbnRMYXllcigpOwogICAgICAgIHJldHVybiBhID8gYS5HZXRJTGF5ZXIoKSA6CiAgICAgICAgICAgIG51bGwKICAgIH0qIHBhcmVudExheWVycygpIHsKICAgICAgICBmb3IgKGNvbnN0IGEgb2YgbWFwJGpzY29tcCQ0LmdldCh0aGlzKS5wYXJlbnRMYXllcnMoKSkgeWllbGQgYS5HZXRJTGF5ZXIoKQogICAgfSogc3ViTGF5ZXJzKCkgewogICAgICAgIGZvciAoY29uc3QgYSBvZiBtYXAkanNjb21wJDQuZ2V0KHRoaXMpLkdldFN1YkxheWVycygpKSB5aWVsZCBhLkdldElMYXllcigpCiAgICB9KiBhbGxTdWJMYXllcnMoKSB7CiAgICAgICAgZm9yIChjb25zdCBhIG9mIG1hcCRqc2NvbXAkNC5nZXQodGhpcykuR2V0U3ViTGF5ZXJzKCkpCiAgICAgICAgICAgIGZvciAoY29uc3QgYiBvZiBhLnNlbGZBbmRBbGxTdWJMYXllcnMoKSkgeWllbGQgYi5HZXRJTGF5ZXIoKQogICAgfQogICAgZ2V0IGlzVmlzaWJsZSgpIHsKICAgICAgICByZXR1cm4gbWFwJGpzY29tcCQ0LmdldCh0aGlzKS5fSXNWaXNpYmxlRmxhZ1NldCgpCiAgICB9CiAgICBzZXQgaXNWaXNpYmxlKGEpIHsKICAgICAgICBtYXAkanNjb21wJDQuZ2V0KHRoaXMpLlNldFZpc2libGUoYSkKICAgIH0KICAgIGdldCBpc1NlbGZBbmRQYXJlbnRzVmlzaWJsZSgpIHsKICAgICAgICByZXR1cm4gbWFwJGpzY29tcCQ0LmdldCh0aGlzKS5Jc1Zpc2libGUoKQogICAgfQogICAgZ2V0IGlzSW50ZXJhY3RpdmUoKSB7CiAgICAgICAgcmV0dXJuIG1hcCRqc2NvbXAkNC5nZXQodGhpcykuSXNJbnRlcmFjdGl2ZSgpCiAgICB9CiAgICBzZXQgaXNJbnRlcmFjdGl2ZShhKSB7CiAgICAgICAgbWFwJGpzY29tcCQ0LmdldCh0aGlzKS5TZXRJbnRlcmFjdGl2ZShhKQogICAgfQogICAgZ2V0IGlzU2VsZkFuZFBhcmVudHNJbnRlcmFjdGl2ZSgpIHsKICAgICAgICByZXR1cm4gbWFwJGpzY29tcCQ0LmdldCh0aGlzKS5Jc1NlbGZBbmRQYXJlbnRzSW50ZXJhY3RpdmUoKQogICAgfQogICAgZ2V0IG9wYWNpdHkoKSB7CiAgICAgICAgcmV0dXJuIG1hcCRqc2NvbXAkNC5nZXQodGhpcykuR2V0T3BhY2l0eSgpCiAgICB9CiAgICBzZXQgb3BhY2l0eShhKSB7CiAgICAgICAgYSA9CiAgICAgICAgICAgIEMzJGpzY29tcCQ2My5jbGFtcCgrYSwgMCwgMSk7CiAgICAgICAgaXNOYU4oYSkgfHwgbWFwJGpzY29tcCQ0LmdldCh0aGlzKS5TZXRPcGFjaXR5KGEpCiAgICB9CiAgICBzZXQgc2NhbGUoYSkgewogICAgICAgIEMzWCRqc2NvbXAkNi5SZXF1aXJlRmluaXRlTnVtYmVyKGEpOwogICAgICAgIG1hcCRqc2NvbXAkNC5nZXQodGhpcykuU2V0T3duU2NhbGUoYSkKICAgIH0KICAgIGdldCBzY2FsZSgpIHsKICAgICAgICByZXR1cm4gbWFwJGpzY29tcCQ0LmdldCh0aGlzKS5HZXRPd25TY2FsZSgpCiAgICB9CiAgICBzZXQgc2NhbGVSYXRlKGEpIHsKICAgICAgICBDM1gkanNjb21wJDYuUmVxdWlyZUZpbml0ZU51bWJlcihhKTsKICAgICAgICBtYXAkanNjb21wJDQuZ2V0KHRoaXMpLlNldFNjYWxlUmF0ZShhKQogICAgfQogICAgZ2V0IHNjYWxlUmF0ZSgpIHsKICAgICAgICByZXR1cm4gbWFwJGpzY29tcCQ0LmdldCh0aGlzKS5HZXRTY2FsZVJhdGUoKQogICAgfQogICAgc2V0IGFuZ2xlKGEpIHsKICAgICAgICBDM1gkanNjb21wJDYuUmVxdWlyZUZpbml0ZU51bWJlcihhKTsKICAgICAgICBtYXAkanNjb21wJDQuZ2V0KHRoaXMpLlNldEFuZ2xlKGEpCiAgICB9CiAgICBnZXQgYW5nbGUoKSB7CiAgICAgICAgcmV0dXJuIG1hcCRqc2NvbXAkNC5nZXQodGhpcykuR2V0T3duQW5nbGUoKQogICAgfQogICAgc2V0IHBhcmFsbGF4WChhKSB7CiAgICAgICAgQzNYJGpzY29tcCQ2LlJlcXVpcmVGaW5pdGVOdW1iZXIoYSk7CiAgICAgICAgbWFwJGpzY29tcCQ0LmdldCh0aGlzKS5TZXRQYXJhbGxheFgoYSkKICAgIH0KICAgIGdldCBwYXJhbGxheFgoKSB7CiAgICAgICAgcmV0dXJuIG1hcCRqc2NvbXAkNC5nZXQodGhpcykuR2V0UGFyYWxsYXhYKCkKICAgIH0KICAgIHNldCBwYXJhbGxheFkoYSkgewogICAgICAgIEMzWCRqc2NvbXAkNi5SZXF1aXJlRmluaXRlTnVtYmVyKGEpOwogICAgICAgIG1hcCRqc2NvbXAkNC5nZXQodGhpcykuU2V0UGFyYWxsYXhZKGEpCiAgICB9CiAgICBnZXQgcGFyYWxsYXhZKCkgewogICAgICAgIHJldHVybiBtYXAkanNjb21wJDQuZ2V0KHRoaXMpLkdldFBhcmFsbGF4WSgpCiAgICB9CiAgICBzZXQgekVsZXZhdGlvbihhKSB7CiAgICAgICAgQzNYJGpzY29tcCQ2LlJlcXVpcmVGaW5pdGVOdW1iZXIoYSk7CiAgICAgICAgbWFwJGpzY29tcCQ0LmdldCh0aGlzKS5TZXRaRWxldmF0aW9uKGEpCiAgICB9CiAgICBnZXQgekVsZXZhdGlvbigpIHsKICAgICAgICByZXR1cm4gbWFwJGpzY29tcCQ0LmdldCh0aGlzKS5HZXRaRWxldmF0aW9uKCkKICAgIH0KICAgIHNldCBpc1RyYW5zcGFyZW50KGEpIHsKICAgICAgICBtYXAkanNjb21wJDQuZ2V0KHRoaXMpLlNldFRyYW5zcGFyZW50KGEpCiAgICB9CiAgICBnZXQgaXNUcmFuc3BhcmVudCgpIHsKICAgICAgICByZXR1cm4gbWFwJGpzY29tcCQ0LmdldCh0aGlzKS5Jc1RyYW5zcGFyZW50KCkKICAgIH0KICAgIHNldCBpc0ZvcmNlT3duVGV4dHVyZShhKSB7CiAgICAgICAgbWFwJGpzY29tcCQ0LmdldCh0aGlzKS5TZXRGb3JjZU93blRleHR1cmUoYSkKICAgIH0KICAgIGdldCBpc0ZvcmNlT3duVGV4dHVyZSgpIHsKICAgICAgICByZXR1cm4gbWFwJGpzY29tcCQ0LmdldCh0aGlzKS5Jc0ZvcmNlT3duVGV4dHVyZSgpCiAgICB9CiAgICBzZXQgYmxlbmRNb2RlKGEpIHsKICAgICAgICBDM1gkanNjb21wJDYuUmVxdWlyZVN0cmluZyhhKTsKICAgICAgICBhID0gQkxFTkRfTU9ERV9UT19JTkRFWC5nZXQoYSk7CiAgICAgICAgaWYgKCJudW1iZXIiICE9PSB0eXBlb2YgYSkgdGhyb3cgRXJyb3IoImludmFsaWQgYmxlbmQgbW9kZSIpOwogICAgICAgIG1hcCRqc2NvbXAkNC5nZXQodGhpcykuU2V0QmxlbmRNb2RlKGEpCiAgICB9CiAgICBnZXQgYmxlbmRNb2RlKCkgewogICAgICAgIHJldHVybiBJTkRFWF9UT19CTEVORF9NT0RFLmdldChtYXAkanNjb21wJDQuZ2V0KHRoaXMpLkdldEJsZW5kTW9kZSgpKQogICAgfQogICAgc2V0IGJhY2tncm91bmRDb2xvcihhKSB7CiAgICAgICAgQzNYJGpzY29tcCQ2LlJlcXVpcmVBcnJheShhKTsKICAgICAgICBpZiAoMyA+IGEubGVuZ3RoKSB0aHJvdyBFcnJvcigiZXhwZWN0ZWQgMyBlbGVtZW50cyIpOwogICAgICAgIHRlbXBDb2xvciRqc2NvbXAkMS5zZXRSZ2IoYVswXSwgYVsxXSwgYVsyXSk7CiAgICAgICAgYSA9IG1hcCRqc2NvbXAkNC5nZXQodGhpcyk7CiAgICAgICAgY29uc3QgYiA9IGEuR2V0QmFja2dyb3VuZENvbG9yKCk7CiAgICAgICAgYi5lcXVhbHNJZ25vcmluZ0FscGhhKHRlbXBDb2xvciRqc2NvbXAkMSkgfHwgKGIuY29weVJnYih0ZW1wQ29sb3IkanNjb21wJDEpLCBhLkdldFJ1bnRpbWUoKS5VcGRhdGVSZW5kZXIoKSkKICAgIH0KICAgIGdldCBiYWNrZ3JvdW5kQ29sb3IoKSB7CiAgICAgICAgY29uc3QgYSA9CiAgICAgICAgICAgIG1hcCRqc2NvbXAkNC5nZXQodGhpcykuR2V0QmFja2dyb3VuZENvbG9yKCk7CiAgICAgICAgcmV0dXJuIFthLmdldFIoKSwgYS5nZXRHKCksIGEuZ2V0QigpXQogICAgfQogICAgc2V0IHNjcm9sbFgoYSkgewogICAgICAgIEMzWCRqc2NvbXAkNi5SZXF1aXJlTnVtYmVyKGEpOwogICAgICAgIGNvbnN0IGIgPSBtYXAkanNjb21wJDQuZ2V0KHRoaXMpOwogICAgICAgIGIuU2V0T3duU2Nyb2xsUG9zaXRpb25FbmFibGVkKCEwKTsKICAgICAgICBiLlNldFNjcm9sbFgoYSkKICAgIH0KICAgIGdldCBzY3JvbGxYKCkgewogICAgICAgIHJldHVybiBtYXAkanNjb21wJDQuZ2V0KHRoaXMpLkdldFNjcm9sbFgoKQogICAgfQogICAgc2V0IHNjcm9sbFkoYSkgewogICAgICAgIEMzWCRqc2NvbXAkNi5SZXF1aXJlTnVtYmVyKGEpOwogICAgICAgIGNvbnN0IGIgPSBtYXAkanNjb21wJDQuZ2V0KHRoaXMpOwogICAgICAgIGIuU2V0T3duU2Nyb2xsUG9zaXRpb25FbmFibGVkKCEwKTsKICAgICAgICBiLlNldFNjcm9sbFkoYSkKICAgIH0KICAgIGdldCBzY3JvbGxZKCkgewogICAgICAgIHJldHVybiBtYXAkanNjb21wJDQuZ2V0KHRoaXMpLkdldFNjcm9sbFkoKQogICAgfQogICAgc2Nyb2xsVG8oYSwgYikgewogICAgICAgIEMzWCRqc2NvbXAkNi5SZXF1aXJlTnVtYmVyKGEpOwogICAgICAgIEMzWCRqc2NvbXAkNi5SZXF1aXJlTnVtYmVyKGIpOwogICAgICAgIGNvbnN0IGQgPSBtYXAkanNjb21wJDQuZ2V0KHRoaXMpOwogICAgICAgIGQuU2V0T3duU2Nyb2xsUG9zaXRpb25FbmFibGVkKCEwKTsKICAgICAgICBkLlNldFNjcm9sbFgoYSk7CiAgICAgICAgZC5TZXRTY3JvbGxZKGIpCiAgICB9CiAgICByZXN0b3JlU2Nyb2xsUG9zaXRpb24oKSB7CiAgICAgICAgbWFwJGpzY29tcCQ0LmdldCh0aGlzKS5TZXRPd25TY3JvbGxQb3NpdGlvbkVuYWJsZWQoITEpCiAgICB9CiAgICBnZXRWaWV3cG9ydCgpIHsKICAgICAgICByZXR1cm4gbWFwJGpzY29tcCQ0LmdldCh0aGlzKS5HZXRWaWV3cG9ydCgpLnRvRE9NUmVjdCgpCiAgICB9CiAgICBjc3NQeFRvTGF5ZXIoYSwgYiwgZCA9IDApIHsKICAgICAgICBDM1gkanNjb21wJDYuUmVxdWlyZU51bWJlcihhKTsKICAgICAgICBDM1gkanNjb21wJDYuUmVxdWlyZU51bWJlcihiKTsKICAgICAgICBDM1gkanNjb21wJDYuUmVxdWlyZU51bWJlcihkKTsKICAgICAgICBjb25zdCBjID0gbWFwJGpzY29tcCQ0LmdldCh0aGlzKSwKICAgICAgICAgICAgZSA9IGMuR2V0UnVudGltZSgpOwogICAgICAgIHJldHVybiBjLkNhbnZhc0Nzc1RvTGF5ZXIoYSAtIGUuR2V0Q2FudmFzQ2xpZW50WCgpLCBiIC0gZS5HZXRDYW52YXNDbGllbnRZKCksIGQpCiAgICB9CiAgICBsYXllclRvQ3NzUHgoYSwgYiwgZCA9IDApIHsKICAgICAgICBDM1gkanNjb21wJDYuUmVxdWlyZU51bWJlcihhKTsKICAgICAgICBDM1gkanNjb21wJDYuUmVxdWlyZU51bWJlcihiKTsKICAgICAgICBDM1gkanNjb21wJDYuUmVxdWlyZU51bWJlcihkKTsKICAgICAgICBjb25zdCBjID0gbWFwJGpzY29tcCQ0LmdldCh0aGlzKSwKICAgICAgICAgICAgZSA9IGMuR2V0UnVudGltZSgpLAogICAgICAgICAgICBbZywga10gPSBjLkxheWVyVG9DYW52YXNDc3MoYSwgYiwgZCk7CiAgICAgICAgcmV0dXJuIFtnICsgZS5HZXRDYW52YXNDbGllbnRYKCksIGsgKyBlLkdldENhbnZhc0NsaWVudFkoKV0KICAgIH0KfTsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkNjQgPSBzZWxmLkMzLAogICAgQzNYJGpzY29tcCQ3ID0gc2VsZi5DM1gsCiAgICBtYXAkanNjb21wJDUgPSBuZXcgV2Vha01hcCwKICAgIGRpc3BhdGNoZXJzID0gbmV3IFdlYWtNYXA7CgpmdW5jdGlvbiBHZXREaXNwYXRjaGVyKGEpIHsKICAgIGxldCBiID0gZGlzcGF0Y2hlcnMuZ2V0KGEpOwogICAgaWYgKGIpIHJldHVybiBiOwogICAgYiA9IEMzJGpzY29tcCQ2NC5OZXcoQzMkanNjb21wJDY0LkV2ZW50LkRpc3BhdGNoZXIpOwogICAgZGlzcGF0Y2hlcnMuc2V0KGEsIGIpOwogICAgcmV0dXJuIGIKfQpsZXQgaW5pdEluc3QgPSBudWxsOwpzZWxmLklJbnN0YW5jZSA9IGNsYXNzIHsKICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgIG1hcCRqc2NvbXAkNS5zZXQodGhpcywgaW5pdEluc3QpOwogICAgICAgIGNvbnN0IGEgPSB7CiAgICAgICAgICAgIHJ1bnRpbWU6IHsKICAgICAgICAgICAgICAgIHZhbHVlOiBpbml0SW5zdC5HZXRSdW50aW1lKCkuR2V0SVJ1bnRpbWUoKSwKICAgICAgICAgICAgICAgIHdyaXRhYmxlOiAhMQogICAgICAgICAgICB9LAogICAgICAgICAgICBvYmplY3RUeXBlOiB7CiAgICAgICAgICAgICAgICB2YWx1ZTogaW5pdEluc3QuR2V0T2JqZWN0Q2xhc3MoKS5HZXRJT2JqZWN0Q2xhc3MoKSwKICAgICAgICAgICAgICAgIHdyaXRhYmxlOiAhMQogICAgICAgICAgICB9LAogICAgICAgICAgICB1aWQ6IHsKICAgICAgICAgICAgICAgIHZhbHVlOiBpbml0SW5zdC5HZXRVSUQoKSwKICAgICAgICAgICAgICAgIHdyaXRhYmxlOiAhMQogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICBpbml0SW5zdC5fR2V0SW5zdFZhcnNTY3JpcHREZXNjcmlwdG9yKGEpOwogICAgICAgIGluaXRJbnN0Ll9HZXRCZWhhdmlvcnNTY3JpcHREZXNjcmlwdG9yKGEpOwogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRoaXMsIGEpOwogICAgICAgIGluaXRJbnN0LkdldFJ1bnRpbWUoKS5fTWFwU2NyaXB0SW50ZXJmYWNlKHRoaXMsIGluaXRJbnN0KQogICAgfQogICAgc3RhdGljIF9Jbml0KGEpIHsKICAgICAgICBpbml0SW5zdCA9IGEKICAgIH0KICAgIHN0YXRpYyBfR2V0SW5pdEluc3QoKSB7CiAgICAgICAgcmV0dXJuIGluaXRJbnN0CiAgICB9CiAgICBfUmVsZWFzZSgpIHsKICAgICAgICBjb25zdCBhID0KICAgICAgICAgICAgZGlzcGF0Y2hlcnMuZ2V0KHRoaXMpOwogICAgICAgIGEgJiYgKGEuUmVsZWFzZSgpLCBkaXNwYXRjaGVycy5kZWxldGUodGhpcykpOwogICAgICAgIG1hcCRqc2NvbXAkNS5kZWxldGUodGhpcykKICAgIH0KICAgIGFkZEV2ZW50TGlzdGVuZXIoYSwgYiwgZCkgewogICAgICAgIEMzWCRqc2NvbXAkNy5SZXF1aXJlU3RyaW5nKGEpOwogICAgICAgIEMzWCRqc2NvbXAkNy5SZXF1aXJlRnVuY3Rpb24oYik7CiAgICAgICAgR2V0RGlzcGF0Y2hlcih0aGlzKS5hZGRFdmVudExpc3RlbmVyKGEsIGIsIGQpCiAgICB9CiAgICByZW1vdmVFdmVudExpc3RlbmVyKGEsIGIsIGQpIHsKICAgICAgICBDM1gkanNjb21wJDcuUmVxdWlyZVN0cmluZyhhKTsKICAgICAgICBDM1gkanNjb21wJDcuUmVxdWlyZUZ1bmN0aW9uKGIpOwogICAgICAgIEdldERpc3BhdGNoZXIodGhpcykucmVtb3ZlRXZlbnRMaXN0ZW5lcihhLCBiLCBkKQogICAgfQogICAgZGlzcGF0Y2hFdmVudChhKSB7CiAgICAgICAgR2V0RGlzcGF0Y2hlcih0aGlzKS5kaXNwYXRjaEV2ZW50KGEpCiAgICB9CiAgICBkZXN0cm95KCkgewogICAgICAgIGNvbnN0IGEgPSBtYXAkanNjb21wJDUuZ2V0KHRoaXMpLAogICAgICAgICAgICBiID0gYS5HZXRSdW50aW1lKCk7CiAgICAgICAgYi5EZXN0cm95SW5zdGFuY2UoYSk7CiAgICAgICAgYi5HZXRFdmVudFNoZWV0TWFuYWdlcigpLklzSW5FdmVudEVuZ2luZSgpIHx8CiAgICAgICAgICAgIGIuRmx1c2hQZW5kaW5nSW5zdGFuY2VzKCkKICAgIH0KICAgIGdldE90aGVyQ29udGFpbmVySW5zdGFuY2VzKCkgewogICAgICAgIGNvbnN0IGEgPSBtYXAkanNjb21wJDUuZ2V0KHRoaXMpLkdldFNpYmxpbmdzKCk7CiAgICAgICAgcmV0dXJuIGEgPyBhLm1hcChiID0+IGIuR2V0SW50ZXJmYWNlQ2xhc3MoKSkgOiBbXQogICAgfSogb3RoZXJDb250YWluZXJJbnN0YW5jZXMoKSB7CiAgICAgICAgY29uc3QgYSA9IG1hcCRqc2NvbXAkNS5nZXQodGhpcyk7CiAgICAgICAgaWYgKGEuSXNJbkNvbnRhaW5lcigpKQogICAgICAgICAgICBmb3IgKGNvbnN0IGIgb2YgYS5zaWJsaW5ncygpKSB5aWVsZCBiLkdldEludGVyZmFjZUNsYXNzKCkKICAgIH0KfTsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkNjUgPSBzZWxmLkMzLAogICAgQzNYJGpzY29tcCQ4ID0gc2VsZi5DM1gsCiAgICBJSW5zdGFuY2UkanNjb21wJDEgPSBzZWxmLklJbnN0YW5jZSwKICAgIElMYXllciRqc2NvbXAkMSA9IHNlbGYuSUxheWVyLAogICAgbWFwJGpzY29tcCQ2ID0gbmV3IFdlYWtNYXAsCiAgICBCTEVORF9NT0RFX1RPX0lOREVYJGpzY29tcCQxID0gbmV3IE1hcChbCiAgICAgICAgWyJub3JtYWwiLCAwXSwKICAgICAgICBbImFkZGl0aXZlIiwgMV0sCiAgICAgICAgWyJjb3B5IiwgM10sCiAgICAgICAgWyJkZXN0aW5hdGlvbi1vdmVyIiwgNF0sCiAgICAgICAgWyJzb3VyY2UtaW4iLCA1XSwKICAgICAgICBbImRlc3RpbmF0aW9uLWluIiwgNl0sCiAgICAgICAgWyJzb3VyY2Utb3V0IiwgN10sCiAgICAgICAgWyJkZXN0aW5hdGlvbi1vdXQiLCA4XSwKICAgICAgICBbInNvdXJjZS1hdG9wIiwgOV0sCiAgICAgICAgWyJkZXN0aW5hdGlvbi1hdG9wIiwgMTBdCiAgICBdKSwKICAgIElOREVYX1RPX0JMRU5EX01PREUkanNjb21wJDEgPSBuZXcgTWFwKFsuLi5CTEVORF9NT0RFX1RPX0lOREVYJGpzY29tcCQxLmVudHJpZXMoKV0ubWFwKGEgPT4gW2FbMV0sIGFbMF1dKSksCiAgICB0ZW1wQ29sb3IkanNjb21wJDIgPSBDMyRqc2NvbXAkNjUuTmV3KEMzJGpzY29tcCQ2NS5Db2xvcik7CnNlbGYuSVdvcmxkSW5zdGFuY2UgPSBjbGFzcyBhIGV4dGVuZHMgSUluc3RhbmNlJGpzY29tcCQxIHsKICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgIHN1cGVyKCk7CiAgICAgICAgdmFyIGIgPSBJSW5zdGFuY2UkanNjb21wJDEuX0dldEluaXRJbnN0KCk7CiAgICAgICAgbWFwJGpzY29tcCQ2LnNldCh0aGlzLCBiKTsKICAgICAgICBjb25zdCBkID0gW107CiAgICAgICAgdmFyIGMgPSBiLkdldFdvcmxkSW5mbygpOwogICAgICAgIGlmIChiID0gYy5HZXRJbnN0YW5jZUVmZmVjdExpc3QoKSkgewogICAgICAgICAgICBjID0gYy5HZXRPYmplY3RDbGFzcygpLkdldEVmZmVjdExpc3QoKS5HZXRBbGxFZmZlY3RUeXBlcygpLmxlbmd0aDsKICAgICAgICAgICAgZm9yIChsZXQgZSA9IDA7IGUgPCBjOyArK2UpIGQucHVzaChuZXcgc2VsZi5JRWZmZWN0SW5zdGFuY2UoYiwgZSkpCiAgICAgICAgfQogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRoaXMsIHsKICAgICAgICAgICAgZWZmZWN0czogewogICAgICAgICAgICAgICAgdmFsdWU6IGQsCiAgICAgICAgICAgICAgICB3cml0YWJsZTogITEKICAgICAgICAgICAgfQogICAgICAgIH0pCiAgICB9CiAgICBnZXQgbGF5b3V0KCkgewogICAgICAgIHJldHVybiBtYXAkanNjb21wJDYuZ2V0KHRoaXMpLkdldFdvcmxkSW5mbygpLkdldExheW91dCgpLkdldElMYXlvdXQoKQogICAgfQogICAgZ2V0IGxheWVyKCkgewogICAgICAgIHJldHVybiBtYXAkanNjb21wJDYuZ2V0KHRoaXMpLkdldFdvcmxkSW5mbygpLkdldExheWVyKCkuR2V0SUxheWVyKCkKICAgIH0KICAgIGdldCB4KCkgewogICAgICAgIHJldHVybiBtYXAkanNjb21wJDYuZ2V0KHRoaXMpLkdldFdvcmxkSW5mbygpLkdldFgoKQogICAgfQogICAgc2V0IHgoYikgewogICAgICAgIGIgPSArYjsKICAgICAgICBjb25zdCBkID0gbWFwJGpzY29tcCQ2LmdldCh0aGlzKS5HZXRXb3JsZEluZm8oKTsKICAgICAgICBpc05hTihiKSB8fCBkLkdldFgoKSA9PT0gYiB8fCAoZC5TZXRYKGIpLCBkLlNldEJib3hDaGFuZ2VkKCkpCiAgICB9CiAgICBnZXQgeSgpIHsKICAgICAgICByZXR1cm4gbWFwJGpzY29tcCQ2LmdldCh0aGlzKS5HZXRXb3JsZEluZm8oKS5HZXRZKCkKICAgIH0KICAgIHNldCB5KGIpIHsKICAgICAgICBiID0gK2I7CiAgICAgICAgY29uc3QgZCA9IG1hcCRqc2NvbXAkNi5nZXQodGhpcykuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgaXNOYU4oYikgfHwgZC5HZXRZKCkgPT09IGIgfHwgKGQuU2V0WShiKSwgZC5TZXRCYm94Q2hhbmdlZCgpKQogICAgfQogICAgZ2V0IHpFbGV2YXRpb24oKSB7CiAgICAgICAgcmV0dXJuIG1hcCRqc2NvbXAkNi5nZXQodGhpcykuR2V0V29ybGRJbmZvKCkuR2V0WkVsZXZhdGlvbigpCiAgICB9CiAgICBzZXQgekVsZXZhdGlvbihiKSB7CiAgICAgICAgYiA9ICtiOwogICAgICAgIGNvbnN0IGQgPSBtYXAkanNjb21wJDYuZ2V0KHRoaXMpLAogICAgICAgICAgICBjID0gZC5HZXRXb3JsZEluZm8oKTsKICAgICAgICBpc05hTihiKSB8fCBjLkdldFpFbGV2YXRpb24oKSA9PT0gYiB8fCAoYy5TZXRaRWxldmF0aW9uKGIpLCBkLkdldFJ1bnRpbWUoKS5VcGRhdGVSZW5kZXIoKSkKICAgIH0KICAgIGdldCB0b3RhbFpFbGV2YXRpb24oKSB7CiAgICAgICAgcmV0dXJuIG1hcCRqc2NvbXAkNi5nZXQodGhpcykuR2V0V29ybGRJbmZvKCkuR2V0VG90YWxaRWxldmF0aW9uKCkKICAgIH0KICAgIGdldCB3aWR0aCgpIHsKICAgICAgICByZXR1cm4gbWFwJGpzY29tcCQ2LmdldCh0aGlzKS5HZXRXb3JsZEluZm8oKS5HZXRXaWR0aCgpCiAgICB9CiAgICBzZXQgd2lkdGgoYikgewogICAgICAgIGIgPSArYjsKICAgICAgICBjb25zdCBkID0gbWFwJGpzY29tcCQ2LmdldCh0aGlzKS5HZXRXb3JsZEluZm8oKTsKICAgICAgICBpc05hTihiKSB8fCBkLkdldFdpZHRoKCkgPT09IGIgfHwgKGQuU2V0V2lkdGgoYiksIGQuU2V0QmJveENoYW5nZWQoKSkKICAgIH0KICAgIGdldCBoZWlnaHQoKSB7CiAgICAgICAgcmV0dXJuIG1hcCRqc2NvbXAkNi5nZXQodGhpcykuR2V0V29ybGRJbmZvKCkuR2V0SGVpZ2h0KCkKICAgIH0KICAgIHNldCBoZWlnaHQoYikgewogICAgICAgIGIgPSArYjsKICAgICAgICBjb25zdCBkID0gbWFwJGpzY29tcCQ2LmdldCh0aGlzKS5HZXRXb3JsZEluZm8oKTsKICAgICAgICBpc05hTihiKSB8fCBkLkdldEhlaWdodCgpID09PSBiIHx8IChkLlNldEhlaWdodChiKSwgZC5TZXRCYm94Q2hhbmdlZCgpKQogICAgfQogICAgZ2V0IGFuZ2xlKCkgewogICAgICAgIHJldHVybiBtYXAkanNjb21wJDYuZ2V0KHRoaXMpLkdldFdvcmxkSW5mbygpLkdldEFuZ2xlKCkKICAgIH0KICAgIHNldCBhbmdsZShiKSB7CiAgICAgICAgYiA9IEMzJGpzY29tcCQ2NS5jbGFtcEFuZ2xlKCtiKTsKICAgICAgICBjb25zdCBkID0gbWFwJGpzY29tcCQ2LmdldCh0aGlzKS5HZXRXb3JsZEluZm8oKTsKICAgICAgICBpc05hTihiKSB8fCBkLkdldEFuZ2xlKCkgPT09IGIgfHwgKGQuU2V0QW5nbGUoYiksCiAgICAgICAgICAgIGQuU2V0QmJveENoYW5nZWQoKSkKICAgIH0KICAgIGdldCBhbmdsZURlZ3JlZXMoKSB7CiAgICAgICAgcmV0dXJuIEMzJGpzY29tcCQ2NS50b0RlZ3JlZXModGhpcy5hbmdsZSkKICAgIH0KICAgIHNldCBhbmdsZURlZ3JlZXMoYikgewogICAgICAgIHRoaXMuYW5nbGUgPSBDMyRqc2NvbXAkNjUudG9SYWRpYW5zKGIpCiAgICB9CiAgICBnZXRCb3VuZGluZ0JveCgpIHsKICAgICAgICByZXR1cm4gbWFwJGpzY29tcCQ2LmdldCh0aGlzKS5HZXRXb3JsZEluZm8oKS5HZXRCb3VuZGluZ0JveCgpLnRvRE9NUmVjdCgpCiAgICB9CiAgICBnZXRCb3VuZGluZ1F1YWQoKSB7CiAgICAgICAgcmV0dXJuIG1hcCRqc2NvbXAkNi5nZXQodGhpcykuR2V0V29ybGRJbmZvKCkuR2V0Qm91bmRpbmdRdWFkKCkudG9ET01RdWFkKCkKICAgIH0KICAgIGdldCBpc1Zpc2libGUoKSB7CiAgICAgICAgcmV0dXJuIG1hcCRqc2NvbXAkNi5nZXQodGhpcykuR2V0V29ybGRJbmZvKCkuSXNWaXNpYmxlKCkKICAgIH0KICAgIHNldCBpc1Zpc2libGUoYikgewogICAgICAgIGIgPSAhIWI7CiAgICAgICAgY29uc3QgZCA9IG1hcCRqc2NvbXAkNi5nZXQodGhpcyksCiAgICAgICAgICAgIGMgPSBkLkdldFdvcmxkSW5mbygpOwogICAgICAgIGMuSXNWaXNpYmxlKCkgIT09IGIgJiYgKGMuU2V0VmlzaWJsZShiKSwKICAgICAgICAgICAgZC5HZXRSdW50aW1lKCkuVXBkYXRlUmVuZGVyKCkpCiAgICB9CiAgICBnZXQgb3BhY2l0eSgpIHsKICAgICAgICByZXR1cm4gbWFwJGpzY29tcCQ2LmdldCh0aGlzKS5HZXRXb3JsZEluZm8oKS5HZXRPcGFjaXR5KCkKICAgIH0KICAgIHNldCBvcGFjaXR5KGIpIHsKICAgICAgICBiID0gQzMkanNjb21wJDY1LmNsYW1wKCtiLCAwLCAxKTsKICAgICAgICBjb25zdCBkID0gbWFwJGpzY29tcCQ2LmdldCh0aGlzKSwKICAgICAgICAgICAgYyA9IGQuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgaXNOYU4oYikgfHwgYy5HZXRPcGFjaXR5KCkgPT09IGIgfHwgKGMuU2V0T3BhY2l0eShiKSwgZC5HZXRSdW50aW1lKCkuVXBkYXRlUmVuZGVyKCkpCiAgICB9CiAgICBzZXQgY29sb3JSZ2IoYikgewogICAgICAgIEMzWCRqc2NvbXAkOC5SZXF1aXJlQXJyYXkoYik7CiAgICAgICAgaWYgKDMgPiBiLmxlbmd0aCkgdGhyb3cgRXJyb3IoImV4cGVjdGVkIDMgZWxlbWVudHMiKTsKICAgICAgICB0ZW1wQ29sb3IkanNjb21wJDIuc2V0UmdiKGJbMF0sIGJbMV0sIGJbMl0pOwogICAgICAgIGIgPSBtYXAkanNjb21wJDYuZ2V0KHRoaXMpOwogICAgICAgIGNvbnN0IGQgPSBiLkdldFdvcmxkSW5mbygpOwogICAgICAgIGQuR2V0VW5wcmVtdWx0aXBsaWVkQ29sb3IoKS5lcXVhbHNJZ25vcmluZ0FscGhhKHRlbXBDb2xvciRqc2NvbXAkMikgfHwKICAgICAgICAgICAgKGQuU2V0VW5wcmVtdWx0aXBsaWVkQ29sb3IodGVtcENvbG9yJGpzY29tcCQyKSwgYi5HZXRSdW50aW1lKCkuVXBkYXRlUmVuZGVyKCkpCiAgICB9CiAgICBnZXQgY29sb3JSZ2IoKSB7CiAgICAgICAgY29uc3QgYiA9IG1hcCRqc2NvbXAkNi5nZXQodGhpcykuR2V0V29ybGRJbmZvKCkuR2V0VW5wcmVtdWx0aXBsaWVkQ29sb3IoKTsKICAgICAgICByZXR1cm4gW2IuZ2V0UigpLCBiLmdldEcoKSwgYi5nZXRCKCldCiAgICB9CiAgICBzZXQgYmxlbmRNb2RlKGIpIHsKICAgICAgICBDM1gkanNjb21wJDguUmVxdWlyZVN0cmluZyhiKTsKICAgICAgICBiID0gQkxFTkRfTU9ERV9UT19JTkRFWCRqc2NvbXAkMS5nZXQoYik7CiAgICAgICAgaWYgKCJudW1iZXIiICE9PSB0eXBlb2YgYikgdGhyb3cgRXJyb3IoImludmFsaWQgYmxlbmQgbW9kZSIpOwogICAgICAgIGNvbnN0IGQgPSBtYXAkanNjb21wJDYuZ2V0KHRoaXMpOwogICAgICAgIGQuR2V0V29ybGRJbmZvKCkuU2V0QmxlbmRNb2RlKGIpOwogICAgICAgIGQuR2V0UnVudGltZSgpLlVwZGF0ZVJlbmRlcigpCiAgICB9CiAgICBnZXQgYmxlbmRNb2RlKCkgewogICAgICAgIHJldHVybiBJTkRFWF9UT19CTEVORF9NT0RFJGpzY29tcCQxLmdldChtYXAkanNjb21wJDYuZ2V0KHRoaXMpLkdldFdvcmxkSW5mbygpLkdldEJsZW5kTW9kZSgpKQogICAgfQogICAgbW92ZVRvVG9wKCkgewogICAgICAgIG1hcCRqc2NvbXAkNi5nZXQodGhpcykuR2V0V29ybGRJbmZvKCkuWk9yZGVyTW92ZVRvVG9wKCkKICAgIH0KICAgIG1vdmVUb0JvdHRvbSgpIHsKICAgICAgICBtYXAkanNjb21wJDYuZ2V0KHRoaXMpLkdldFdvcmxkSW5mbygpLlpPcmRlck1vdmVUb0JvdHRvbSgpCiAgICB9CiAgICBtb3ZlVG9MYXllcihiKSB7CiAgICAgICAgQzNYJGpzY29tcCQ4LlJlcXVpcmVJbnN0YW5jZU9mKGIsCiAgICAgICAgICAgIElMYXllciRqc2NvbXAkMSk7CiAgICAgICAgYiA9IElMYXllciRqc2NvbXAkMS5fVW53cmFwKGIpOwogICAgICAgIGlmICghYikgdGhyb3cgRXJyb3IoImludmFsaWQgbGF5ZXIiKTsKICAgICAgICBtYXAkanNjb21wJDYuZ2V0KHRoaXMpLkdldFdvcmxkSW5mbygpLlpPcmRlck1vdmVUb0xheWVyKGIpCiAgICB9CiAgICBtb3ZlQWRqYWNlbnRUb0luc3RhbmNlKGIsIGQpIHsKICAgICAgICBDM1gkanNjb21wJDguUmVxdWlyZUluc3RhbmNlT2YoYiwgYSk7CiAgICAgICAgbWFwJGpzY29tcCQ2LmdldCh0aGlzKS5HZXRXb3JsZEluZm8oKS5aT3JkZXJNb3ZlQWRqYWNlbnRUb0luc3RhbmNlKG1hcCRqc2NvbXAkNi5nZXQoYiksIGQpCiAgICB9CiAgICBnZXQgekluZGV4KCkgewogICAgICAgIHJldHVybiBtYXAkanNjb21wJDYuZ2V0KHRoaXMpLkdldFdvcmxkSW5mbygpLkdldFpJbmRleCgpCiAgICB9CiAgICBjb250YWluc1BvaW50KGIsIGQpIHsKICAgICAgICBDM1gkanNjb21wJDguUmVxdWlyZU51bWJlcihiKTsKICAgICAgICBDM1gkanNjb21wJDguUmVxdWlyZU51bWJlcihkKTsKICAgICAgICByZXR1cm4gbWFwJGpzY29tcCQ2LmdldCh0aGlzKS5HZXRXb3JsZEluZm8oKS5Db250YWluc1BvaW50KCtiLCArZCkKICAgIH0KICAgIHRlc3RPdmVybGFwKGIpIHsKICAgICAgICBDM1gkanNjb21wJDguUmVxdWlyZUluc3RhbmNlT2YoYiwgYSk7CiAgICAgICAgY29uc3QgZCA9IG1hcCRqc2NvbXAkNi5nZXQodGhpcyk7CiAgICAgICAgYiA9IG1hcCRqc2NvbXAkNi5nZXQoYik7CiAgICAgICAgcmV0dXJuIGQuR2V0UnVudGltZSgpLkdldENvbGxpc2lvbkVuZ2luZSgpLlRlc3RPdmVybGFwKGQsIGIpCiAgICB9CiAgICB0ZXN0T3ZlcmxhcFNvbGlkKCkgewogICAgICAgIHZhciBiID0gbWFwJGpzY29tcCQ2LmdldCh0aGlzKTsKICAgICAgICByZXR1cm4gKGIgPSBiLkdldFJ1bnRpbWUoKS5HZXRDb2xsaXNpb25FbmdpbmUoKS5UZXN0T3ZlcmxhcFNvbGlkKGIpKSA/IGIuR2V0SW50ZXJmYWNlQ2xhc3MoKSA6IG51bGwKICAgIH0KICAgIGdldFBhcmVudCgpIHsKICAgICAgICBjb25zdCBiID0gbWFwJGpzY29tcCQ2LmdldCh0aGlzKS5HZXRQYXJlbnQoKTsKICAgICAgICByZXR1cm4gYiA/IGIuR2V0SW50ZXJmYWNlQ2xhc3MoKSA6IG51bGwKICAgIH0KICAgIGdldFRvcFBhcmVudCgpIHsKICAgICAgICBjb25zdCBiID0gbWFwJGpzY29tcCQ2LmdldCh0aGlzKS5HZXRUb3BQYXJlbnQoKTsKICAgICAgICByZXR1cm4gYiA/IGIuR2V0SW50ZXJmYWNlQ2xhc3MoKSA6IG51bGwKICAgIH0qIHBhcmVudHMoKSB7CiAgICAgICAgZm9yIChjb25zdCBiIG9mIG1hcCRqc2NvbXAkNi5nZXQodGhpcykucGFyZW50cygpKSB5aWVsZCBiLkdldEludGVyZmFjZUNsYXNzKCkKICAgIH0KICAgIGdldENoaWxkQ291bnQoKSB7CiAgICAgICAgcmV0dXJuIG1hcCRqc2NvbXAkNi5nZXQodGhpcykuR2V0Q2hpbGRDb3VudCgpCiAgICB9CiAgICBnZXRDaGlsZEF0KGIpIHsKICAgICAgICByZXR1cm4gKGIgPQogICAgICAgICAgICBtYXAkanNjb21wJDYuZ2V0KHRoaXMpLkdldENoaWxkQXQoYikpID8gYi5HZXRJbnRlcmZhY2VDbGFzcygpIDogbnVsbAogICAgfSogY2hpbGRyZW4oKSB7CiAgICAgICAgZm9yIChjb25zdCBiIG9mIG1hcCRqc2NvbXAkNi5nZXQodGhpcykuY2hpbGRyZW4oKSkgeWllbGQgYi5HZXRJbnRlcmZhY2VDbGFzcygpCiAgICB9KiBhbGxDaGlsZHJlbigpIHsKICAgICAgICBmb3IgKGNvbnN0IGIgb2YgbWFwJGpzY29tcCQ2LmdldCh0aGlzKS5hbGxDaGlsZHJlbigpKSB5aWVsZCBiLkdldEludGVyZmFjZUNsYXNzKCkKICAgIH0KICAgIGFkZENoaWxkKGIsIGQpIHsKICAgICAgICBDM1gkanNjb21wJDguUmVxdWlyZUluc3RhbmNlT2YoYiwgYSk7CiAgICAgICAgQzNYJGpzY29tcCQ4LlJlcXVpcmVPcHRpb25hbE9iamVjdChkKTsKICAgICAgICBkIHx8IChkID0ge30pOwogICAgICAgIGNvbnN0IGMgPSBtYXAkanNjb21wJDYuZ2V0KHRoaXMpOwogICAgICAgIGIgPSBtYXAkanNjb21wJDYuZ2V0KGIpOwogICAgICAgIGMuQWRkQ2hpbGQoYiwgZCkKICAgIH0KICAgIHJlbW92ZUNoaWxkKGIpIHsKICAgICAgICBDM1gkanNjb21wJDguUmVxdWlyZUluc3RhbmNlT2YoYiwgYSk7CiAgICAgICAgY29uc3QgZCA9IG1hcCRqc2NvbXAkNi5nZXQodGhpcyk7CiAgICAgICAgYiA9IG1hcCRqc2NvbXAkNi5nZXQoYik7CiAgICAgICAgZC5SZW1vdmVDaGlsZChiKQogICAgfQogICAgcmVtb3ZlRnJvbVBhcmVudCgpIHsKICAgICAgICBjb25zdCBiID0gbWFwJGpzY29tcCQ2LmdldCh0aGlzKTsKICAgICAgICBiLkhhc1BhcmVudCgpICYmIGIuR2V0UGFyZW50KCkuUmVtb3ZlQ2hpbGQoYikKICAgIH0KICAgIGNyZWF0ZU1lc2goYiwgZCkgewogICAgICAgIEMzWCRqc2NvbXAkOC5SZXF1aXJlRmluaXRlTnVtYmVyKGIpOwogICAgICAgIEMzWCRqc2NvbXAkOC5SZXF1aXJlRmluaXRlTnVtYmVyKGQpOwogICAgICAgIG1hcCRqc2NvbXAkNi5nZXQodGhpcykuR2V0V29ybGRJbmZvKCkuQ3JlYXRlTWVzaChiLCBkKQogICAgfQogICAgcmVsZWFzZU1lc2goKSB7CiAgICAgICAgY29uc3QgYiA9IG1hcCRqc2NvbXAkNi5nZXQodGhpcykuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgYi5SZWxlYXNlTWVzaCgpOwogICAgICAgIGIuU2V0QmJveENoYW5nZWQoKQogICAgfQogICAgc2V0TWVzaFBvaW50KGIsIGQsIGMpIHsKICAgICAgICBDM1gkanNjb21wJDguUmVxdWlyZUZpbml0ZU51bWJlcihiKTsKICAgICAgICBDM1gkanNjb21wJDguUmVxdWlyZUZpbml0ZU51bWJlcihkKTsKICAgICAgICBDM1gkanNjb21wJDguUmVxdWlyZU9iamVjdChjKTsKICAgICAgICBjb25zdCBlID0gbWFwJGpzY29tcCQ2LmdldCh0aGlzKS5HZXRXb3JsZEluZm8oKTsKICAgICAgICBlLlNldE1lc2hQb2ludChiLCBkLCBjKSAmJiBlLlNldEJib3hDaGFuZ2VkKCkKICAgIH0KICAgIGdldE1lc2hTaXplKCkgewogICAgICAgIHZhciBiID0gbWFwJGpzY29tcCQ2LmdldCh0aGlzKS5HZXRXb3JsZEluZm8oKTsKICAgICAgICBpZiAoIWIuSGFzTWVzaCgpKSByZXR1cm4gWzAsIDBdOwogICAgICAgIGIgPSBiLkdldFNvdXJjZU1lc2goKTsKICAgICAgICByZXR1cm4gW2IuR2V0SFNpemUoKSwgYi5HZXRWU2l6ZSgpXQogICAgfQp9OwoidXNlIHN0cmljdCI7CmNvbnN0IEMzWCRqc2NvbXAkOSA9IHNlbGYuQzNYLAogICAgbWFwJGpzY29tcCQ3ID0gbmV3IFdlYWtNYXA7CnNlbGYuSURPTUluc3RhbmNlID0gY2xhc3MgZXh0ZW5kcyBzZWxmLklXb3JsZEluc3RhbmNlIHsKICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgIHN1cGVyKCk7CiAgICAgICAgbWFwJGpzY29tcCQ3LnNldCh0aGlzLCBzZWxmLklJbnN0YW5jZS5fR2V0SW5pdEluc3QoKSkKICAgIH0KICAgIGdldEVsZW1lbnQoKSB7CiAgICAgICAgcmV0dXJuIG1hcCRqc2NvbXAkNy5nZXQodGhpcykuR2V0U2RrSW5zdGFuY2UoKS5fR2V0RWxlbWVudEluRE9NTW9kZSgpCiAgICB9CiAgICBmb2N1cygpIHsKICAgICAgICBtYXAkanNjb21wJDcuZ2V0KHRoaXMpLkdldFNka0luc3RhbmNlKCkuRm9jdXNFbGVtZW50KCkKICAgIH0KICAgIGJsdXIoKSB7CiAgICAgICAgbWFwJGpzY29tcCQ3LmdldCh0aGlzKS5HZXRTZGtJbnN0YW5jZSgpLkJsdXJFbGVtZW50KCkKICAgIH0KICAgIHNldENzc1N0eWxlKGEsIGIpIHsKICAgICAgICBDM1gkanNjb21wJDkuUmVxdWlyZVN0cmluZyhhKTsKICAgICAgICBtYXAkanNjb21wJDcuZ2V0KHRoaXMpLkdldFNka0luc3RhbmNlKCkuU2V0RWxlbWVudENTU1N0eWxlKGEsIGIpCiAgICB9Cn07CiJ1c2Ugc3RyaWN0IjsKY29uc3QgQzMkanNjb21wJDY3ID0gc2VsZi5DMywKICAgIEMzWCRqc2NvbXAkMTAgPSBzZWxmLkMzWCwKICAgIG1hcCRqc2NvbXAkOCA9IG5ldyBXZWFrTWFwLAogICAgZGlzcGF0Y2hlcnMkanNjb21wJDEgPSBuZXcgV2Vha01hcDsKCmZ1bmN0aW9uIEdldERpc3BhdGNoZXIkanNjb21wJDEoYSkgewogICAgbGV0IGIgPSBkaXNwYXRjaGVycyRqc2NvbXAkMS5nZXQoYSk7CiAgICBpZiAoYikgcmV0dXJuIGI7CiAgICBiID0gQzMkanNjb21wJDY3Lk5ldyhDMyRqc2NvbXAkNjcuRXZlbnQuRGlzcGF0Y2hlcik7CiAgICBkaXNwYXRjaGVycyRqc2NvbXAkMS5zZXQoYSwgYik7CiAgICByZXR1cm4gYgp9CmxldCBpbml0QmVoSW5zdCA9IG51bGw7CnNlbGYuSUJlaGF2aW9ySW5zdGFuY2UgPSBjbGFzcyB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgICBtYXAkanNjb21wJDguc2V0KHRoaXMsIGluaXRCZWhJbnN0KTsKICAgICAgICBjb25zdCBhID0gewogICAgICAgICAgICBydW50aW1lOiB7CiAgICAgICAgICAgICAgICB2YWx1ZTogaW5pdEJlaEluc3QuR2V0UnVudGltZSgpLkdldElSdW50aW1lKCksCiAgICAgICAgICAgICAgICB3cml0YWJsZTogITEKICAgICAgICAgICAgfSwKICAgICAgICAgICAgYmVoYXZpb3I6IHsKICAgICAgICAgICAgICAgIHZhbHVlOiBpbml0QmVoSW5zdC5HZXRCZWhhdmlvcigpLkdldElCZWhhdmlvcigpLAogICAgICAgICAgICAgICAgd3JpdGFibGU6ICExCiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRoaXMsIGEpCiAgICB9CiAgICBzdGF0aWMgX0luaXQoYSkgewogICAgICAgIGluaXRCZWhJbnN0ID0gYQogICAgfQogICAgc3RhdGljIF9HZXRJbml0SW5zdCgpIHsKICAgICAgICByZXR1cm4gaW5pdEJlaEluc3QKICAgIH0KICAgIGdldCBpbnN0YW5jZSgpIHsKICAgICAgICByZXR1cm4gbWFwJGpzY29tcCQ4LmdldCh0aGlzKS5HZXRPYmplY3RJbnN0YW5jZSgpLkdldEludGVyZmFjZUNsYXNzKCkKICAgIH0KICAgIF9SZWxlYXNlKCkgewogICAgICAgIGNvbnN0IGEgPSBkaXNwYXRjaGVycyRqc2NvbXAkMS5nZXQodGhpcyk7CiAgICAgICAgYSAmJiAoYS5SZWxlYXNlKCksIGRpc3BhdGNoZXJzJGpzY29tcCQxLmRlbGV0ZSh0aGlzKSk7CiAgICAgICAgbWFwJGpzY29tcCQ4LmRlbGV0ZSh0aGlzKQogICAgfQogICAgYWRkRXZlbnRMaXN0ZW5lcihhLCBiLCBkKSB7CiAgICAgICAgQzNYJGpzY29tcCQxMC5SZXF1aXJlU3RyaW5nKGEpOwogICAgICAgIEMzWCRqc2NvbXAkMTAuUmVxdWlyZUZ1bmN0aW9uKGIpOwogICAgICAgIEdldERpc3BhdGNoZXIkanNjb21wJDEodGhpcykuYWRkRXZlbnRMaXN0ZW5lcihhLCBiLCBkKQogICAgfQogICAgcmVtb3ZlRXZlbnRMaXN0ZW5lcihhLCBiLCBkKSB7CiAgICAgICAgQzNYJGpzY29tcCQxMC5SZXF1aXJlU3RyaW5nKGEpOwogICAgICAgIEMzWCRqc2NvbXAkMTAuUmVxdWlyZUZ1bmN0aW9uKGIpOwogICAgICAgIEdldERpc3BhdGNoZXIkanNjb21wJDEodGhpcykucmVtb3ZlRXZlbnRMaXN0ZW5lcihhLCBiLCBkKQogICAgfQogICAgZGlzcGF0Y2hFdmVudChhKSB7CiAgICAgICAgR2V0RGlzcGF0Y2hlciRqc2NvbXAkMSh0aGlzKS5kaXNwYXRjaEV2ZW50KGEpCiAgICB9Cn07CiJ1c2Ugc3RyaWN0IjsKY29uc3QgbWFwJGpzY29tcCQ5ID0gbmV3IFdlYWtNYXA7CnNlbGYuSUJlaGF2aW9yID0gY2xhc3MgewogICAgY29uc3RydWN0b3IoYSkgewogICAgICAgIG1hcCRqc2NvbXAkOS5zZXQodGhpcywgYSk7CiAgICAgICAgYSA9IHsKICAgICAgICAgICAgcnVudGltZTogewogICAgICAgICAgICAgICAgdmFsdWU6IGEuR2V0UnVudGltZSgpLkdldElSdW50aW1lKCksCiAgICAgICAgICAgICAgICB3cml0YWJsZTogITEKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGhpcywgYSkKICAgIH0KICAgIGdldEFsbEluc3RhbmNlcygpIHsKICAgICAgICByZXR1cm4gbWFwJGpzY29tcCQ5LmdldCh0aGlzKS5HZXRJbnN0YW5jZXMoKS5tYXAoYSA9PiBhLkdldEludGVyZmFjZUNsYXNzKCkpCiAgICB9Cn07CiJ1c2Ugc3RyaWN0IjsKY29uc3QgQzMkanNjb21wJDY5ID0gc2VsZi5DMywKICAgIEMzWCRqc2NvbXAkMTIgPSBzZWxmLkMzWCwKICAgIG1hcCRqc2NvbXAkMTAgPSBuZXcgV2Vha01hcCwKICAgIHRlbXBDb2xvciRqc2NvbXAkMyA9IEMzJGpzY29tcCQ2OS5OZXcoQzMkanNjb21wJDY5LkNvbG9yKTsKc2VsZi5JRWZmZWN0SW5zdGFuY2UgPSBjbGFzcyB7CiAgICBjb25zdHJ1Y3RvcihhLCBiKSB7CiAgICAgICAgbWFwJGpzY29tcCQxMC5zZXQodGhpcywgYSk7CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGhpcywgewogICAgICAgICAgICBpbmRleDogewogICAgICAgICAgICAgICAgdmFsdWU6IGIsCiAgICAgICAgICAgICAgICB3cml0YWJsZTogITEKICAgICAgICAgICAgfQogICAgICAgIH0pCiAgICB9CiAgICBnZXQgbmFtZSgpIHsKICAgICAgICByZXR1cm4gbWFwJGpzY29tcCQxMC5nZXQodGhpcykuR2V0QWxsRWZmZWN0VHlwZXMoKVt0aGlzLmluZGV4XS5HZXROYW1lKCkKICAgIH0KICAgIGdldCBpc0FjdGl2ZSgpIHsKICAgICAgICByZXR1cm4gbWFwJGpzY29tcCQxMC5nZXQodGhpcykuSXNFZmZlY3RJbmRleEFjdGl2ZSh0aGlzLmluZGV4KQogICAgfQogICAgc2V0IGlzQWN0aXZlKGEpIHsKICAgICAgICBhID0gISFhOwogICAgICAgIGNvbnN0IGIgPSBtYXAkanNjb21wJDEwLmdldCh0aGlzKTsKICAgICAgICBiLklzRWZmZWN0SW5kZXhBY3RpdmUodGhpcy5pbmRleCkgIT09IGEgJiYgKGIuU2V0RWZmZWN0SW5kZXhBY3RpdmUodGhpcy5pbmRleCwgYSksIGIuVXBkYXRlQWN0aXZlRWZmZWN0cygpLCBiLkdldFJ1bnRpbWUoKS5VcGRhdGVSZW5kZXIoKSkKICAgIH0KICAgIHNldFBhcmFtZXRlcihhLCBiKSB7CiAgICAgICAgQzNYJGpzY29tcCQxMi5SZXF1aXJlRmluaXRlTnVtYmVyKGEpOwogICAgICAgIGEgPSBNYXRoLmZsb29yKCthKTsKICAgICAgICBjb25zdCBkID0gbWFwJGpzY29tcCQxMC5nZXQodGhpcyksCiAgICAgICAgICAgIGMgPSBkLkdldEVmZmVjdFBhcmFtZXRlcih0aGlzLmluZGV4LCBhKTsKICAgICAgICBpZiAobnVsbCA9PT0gYykgdGhyb3cgbmV3IFJhbmdlRXJyb3IoImludmFsaWQgaW5kZXgiKTsKICAgICAgICBpZiAoYyBpbnN0YW5jZW9mIEMzJGpzY29tcCQ2OS5Db2xvcikgewogICAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkoYikgfHwgMyA+IGIubGVuZ3RoKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJleHBlY3RlZCBhcnJheSB3aXRoIDMgZWxlbWVudHMiKTsKICAgICAgICAgICAgdGVtcENvbG9yJGpzY29tcCQzLnNldFJnYihiWzBdLCBiWzFdLCBiWzJdKTsKICAgICAgICAgICAgYiA9IHRlbXBDb2xvciRqc2NvbXAkMwogICAgICAgIH0gZWxzZSBpZiAoIm51bWJlciIgIT09IHR5cGVvZiBiKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJleHBlY3RlZCBudW1iZXIiKTsKICAgICAgICBkLlNldEVmZmVjdFBhcmFtZXRlcih0aGlzLmluZGV4LCBhLCBiKSAmJiBkLklzRWZmZWN0SW5kZXhBY3RpdmUodGhpcy5pbmRleCkgJiYgZC5HZXRSdW50aW1lKCkuVXBkYXRlUmVuZGVyKCkKICAgIH0KICAgIGdldFBhcmFtZXRlcihhKSB7CiAgICAgICAgQzNYJGpzY29tcCQxMi5SZXF1aXJlRmluaXRlTnVtYmVyKGEpOwogICAgICAgIGEgPSBNYXRoLmZsb29yKCthKTsKICAgICAgICBhID0gbWFwJGpzY29tcCQxMC5nZXQodGhpcykuR2V0RWZmZWN0UGFyYW1ldGVyKHRoaXMuaW5kZXgsIGEpOwogICAgICAgIGlmIChudWxsID09PSBhKSB0aHJvdyBuZXcgUmFuZ2VFcnJvcigiaW52YWxpZCBpbmRleCIpOwogICAgICAgIHJldHVybiBhIGluc3RhbmNlb2YgQzMkanNjb21wJDY5LkNvbG9yID8gW2EuZ2V0UigpLCBhLmdldEcoKSwgYS5nZXRCKCldIDogYQogICAgfQp9OwoidXNlIHN0cmljdCI7CmNvbnN0IG1hcCRqc2NvbXAkMTEgPSBuZXcgV2Vha01hcDsKc2VsZi5JQW5pbWF0aW9uID0gY2xhc3MgewogICAgY29uc3RydWN0b3IoYSkgewogICAgICAgIG1hcCRqc2NvbXAkMTEuc2V0KHRoaXMsIGEpOwogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRoaXMsIHsKICAgICAgICAgICAgbmFtZTogewogICAgICAgICAgICAgICAgdmFsdWU6IGEuR2V0TmFtZSgpLAogICAgICAgICAgICAgICAgd3JpdGFibGU6ICExCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNwZWVkOiB7CiAgICAgICAgICAgICAgICB2YWx1ZTogYS5HZXRTcGVlZCgpLAogICAgICAgICAgICAgICAgd3JpdGFibGU6ICExCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGlzTG9vcGluZzogewogICAgICAgICAgICAgICAgdmFsdWU6IGEuSXNMb29waW5nKCksCiAgICAgICAgICAgICAgICB3cml0YWJsZTogITEKICAgICAgICAgICAgfSwKICAgICAgICAgICAgcmVwZWF0Q291bnQ6IHsKICAgICAgICAgICAgICAgIHZhbHVlOiBhLkdldFJlcGVhdENvdW50KCksCiAgICAgICAgICAgICAgICB3cml0YWJsZTogITEKICAgICAgICAgICAgfSwKICAgICAgICAgICAgcmVwZWF0VG86IHsKICAgICAgICAgICAgICAgIHZhbHVlOiBhLkdldFJlcGVhdFRvKCksCiAgICAgICAgICAgICAgICB3cml0YWJsZTogITEKICAgICAgICAgICAgfSwKICAgICAgICAgICAgaXNQaW5nUG9uZzogewogICAgICAgICAgICAgICAgdmFsdWU6IGEuSXNQaW5nUG9uZygpLAogICAgICAgICAgICAgICAgd3JpdGFibGU6ICExCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGZyYW1lQ291bnQ6IHsKICAgICAgICAgICAgICAgIHZhbHVlOiBhLkdldEZyYW1lQ291bnQoKSwKICAgICAgICAgICAgICAgIHdyaXRhYmxlOiAhMQogICAgICAgICAgICB9CiAgICAgICAgfSkKICAgIH0KICAgIGdldEZyYW1lcygpIHsKICAgICAgICByZXR1cm4gbWFwJGpzY29tcCQxMS5nZXQodGhpcykuR2V0RnJhbWVzKCkubWFwKGEgPT4gYS5HZXRJQW5pbWF0aW9uRnJhbWUoKSkKICAgIH0qIGZyYW1lcygpIHsKICAgICAgICBmb3IgKGNvbnN0IGEgb2YgbWFwJGpzY29tcCQxMS5nZXQodGhpcykuR2V0RnJhbWVzKCkpIHlpZWxkIGEuR2V0SUFuaW1hdGlvbkZyYW1lKCkKICAgIH0KfTsKInVzZSBzdHJpY3QiOwpjb25zdCBtYXAkanNjb21wJDEyID0gbmV3IFdlYWtNYXA7CnNlbGYuSUltYWdlSW5mbyA9IGNsYXNzIHsKICAgIGNvbnN0cnVjdG9yKGEpIHsKICAgICAgICBtYXAkanNjb21wJDEyLnNldCh0aGlzLCBhKQogICAgfQogICAgZ2V0IHdpZHRoKCkgewogICAgICAgIHJldHVybiBtYXAkanNjb21wJDEyLmdldCh0aGlzKS5HZXRXaWR0aCgpCiAgICB9CiAgICBnZXQgaGVpZ2h0KCkgewogICAgICAgIHJldHVybiBtYXAkanNjb21wJDEyLmdldCh0aGlzKS5HZXRIZWlnaHQoKQogICAgfQp9OwoidXNlIHN0cmljdCI7CmNvbnN0IG1hcCRqc2NvbXAkMTMgPSBuZXcgV2Vha01hcDsKc2VsZi5JQW5pbWF0aW9uRnJhbWUgPSBjbGFzcyBleHRlbmRzIHNlbGYuSUltYWdlSW5mbyB7CiAgICBjb25zdHJ1Y3RvcihhKSB7CiAgICAgICAgc3VwZXIoYS5HZXRJbWFnZUluZm8oKSk7CiAgICAgICAgbWFwJGpzY29tcCQxMy5zZXQodGhpcywgYSk7CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGhpcywgewogICAgICAgICAgICBkdXJhdGlvbjogewogICAgICAgICAgICAgICAgdmFsdWU6IGEuR2V0RHVyYXRpb24oKSwKICAgICAgICAgICAgICAgIHdyaXRhYmxlOiAhMQogICAgICAgICAgICB9LAogICAgICAgICAgICBvcmlnaW5YOiB7CiAgICAgICAgICAgICAgICB2YWx1ZTogYS5HZXRPcmlnaW5YKCksCiAgICAgICAgICAgICAgICB3cml0YWJsZTogITEKICAgICAgICAgICAgfSwKICAgICAgICAgICAgb3JpZ2luWTogewogICAgICAgICAgICAgICAgdmFsdWU6IGEuR2V0T3JpZ2luWSgpLAogICAgICAgICAgICAgICAgd3JpdGFibGU6ICExCiAgICAgICAgICAgIH0KICAgICAgICB9KQogICAgfQp9OwoidXNlIHN0cmljdCI7CmNvbnN0IEMzWCRqc2NvbXAkMTYgPSBzZWxmLkMzWCwKICAgIG1hcCRqc2NvbXAkMTQgPSBuZXcgV2Vha01hcDsKCmZ1bmN0aW9uIEdldFRpbWVsaW5lU3RhdGUoYSkgewogICAgYSA9IG1hcCRqc2NvbXAkMTQuZ2V0KGEpOwogICAgaWYgKGEuSXNSZWxlYXNlZCgpKSB0aHJvdyBFcnJvcigidGltZWxpbmUvdHdlZW4gd2FzIHJlbGVhc2VkIGFuZCBpcyBubyBsb25nZXIgdmFsaWQiKTsKICAgIHJldHVybiBhCn0Kc2VsZi5JVGltZWxpbmVTdGF0ZSA9IGNsYXNzIHsKICAgIGNvbnN0cnVjdG9yKGEpIHsKICAgICAgICBtYXAkanNjb21wJDE0LnNldCh0aGlzLCBhKQogICAgfQogICAgcGF1c2UoKSB7CiAgICAgICAgR2V0VGltZWxpbmVTdGF0ZSh0aGlzKS5TdG9wKCkKICAgIH0KICAgIHJlc3VtZSgpIHsKICAgICAgICBHZXRUaW1lbGluZVN0YXRlKHRoaXMpLlJlc3VtZSgpCiAgICB9CiAgICBoYXNUYWdzKGEpIHsKICAgICAgICByZXR1cm4gR2V0VGltZWxpbmVTdGF0ZSh0aGlzKS5IYXNUYWdzKGEpCiAgICB9CiAgICBzZXQgdGltZShhKSB7CiAgICAgICAgQzNYJGpzY29tcCQxNi5SZXF1aXJlRmluaXRlTnVtYmVyKGEpOwogICAgICAgIEdldFRpbWVsaW5lU3RhdGUodGhpcykuU2V0VGltZShhKQogICAgfQogICAgZ2V0IHRpbWUoKSB7CiAgICAgICAgcmV0dXJuIEdldFRpbWVsaW5lU3RhdGUodGhpcykuR2V0VGltZSgpCiAgICB9CiAgICBzZXQgdG90YWxUaW1lKGEpIHsKICAgICAgICBDM1gkanNjb21wJDE2LlJlcXVpcmVGaW5pdGVOdW1iZXIoYSk7CiAgICAgICAgR2V0VGltZWxpbmVTdGF0ZSh0aGlzKS5TZXRUb3RhbFRpbWUoYSkKICAgIH0KICAgIGdldCB0b3RhbFRpbWUoKSB7CiAgICAgICAgcmV0dXJuIEdldFRpbWVsaW5lU3RhdGUodGhpcykuR2V0VG90YWxUaW1lKCkKICAgIH0KICAgIHNldCBpc0xvb3BpbmcoYSkgewogICAgICAgIEdldFRpbWVsaW5lU3RhdGUodGhpcykuU2V0TG9vcCghIWEpCiAgICB9CiAgICBnZXQgaXNMb29waW5nKCkgewogICAgICAgIHJldHVybiBHZXRUaW1lbGluZVN0YXRlKHRoaXMpLkdldExvb3AoKQogICAgfQogICAgc2V0IGlzUGluZ1BvbmcoYSkgewogICAgICAgIEdldFRpbWVsaW5lU3RhdGUodGhpcykuU2V0UGluZ1BvbmcoISFhKQogICAgfQogICAgZ2V0IGlzUGluZ1BvbmcoKSB7CiAgICAgICAgcmV0dXJuIEdldFRpbWVsaW5lU3RhdGUodGhpcykuR2V0UGluZ1BvbmcoKQogICAgfQogICAgc2V0IHBsYXliYWNrUmF0ZShhKSB7CiAgICAgICAgQzNYJGpzY29tcCQxNi5SZXF1aXJlRmluaXRlTnVtYmVyKGEpOwogICAgICAgIEdldFRpbWVsaW5lU3RhdGUodGhpcykuU2V0UGxheWJhY2tSYXRlKGEpCiAgICB9CiAgICBnZXQgcGxheWJhY2tSYXRlKCkgewogICAgICAgIHJldHVybiBHZXRUaW1lbGluZVN0YXRlKHRoaXMpLkdldFBsYXliYWNrUmF0ZSgpCiAgICB9CiAgICBnZXQgcHJvZ3Jlc3MoKSB7CiAgICAgICAgY29uc3QgYSA9IEdldFRpbWVsaW5lU3RhdGUodGhpcyk7CiAgICAgICAgcmV0dXJuIGEuR2V0VGltZSgpIC8gYS5HZXRUb3RhbFRpbWUoKQogICAgfQogICAgZ2V0IHRhZ3MoKSB7CiAgICAgICAgcmV0dXJuIEdldFRpbWVsaW5lU3RhdGUodGhpcykuR2V0VGFncygpCiAgICB9CiAgICBnZXQgZmluaXNoZWQoKSB7CiAgICAgICAgcmV0dXJuIEdldFRpbWVsaW5lU3RhdGUodGhpcykuR2V0UGxheVByb21pc2UoKQogICAgfQogICAgZ2V0IGlzUGxheWluZygpIHsKICAgICAgICByZXR1cm4gR2V0VGltZWxpbmVTdGF0ZSh0aGlzKS5Jc1BsYXlpbmcoKQogICAgfQogICAgZ2V0IGlzUGF1c2VkKCkgewogICAgICAgIHJldHVybiBHZXRUaW1lbGluZVN0YXRlKHRoaXMpLklzUGF1c2VkKCkKICAgIH0KICAgIGdldCBpc1JlbGVhc2VkKCkgewogICAgICAgIHJldHVybiBtYXAkanNjb21wJDE0LmdldCh0aGlzKS5Jc1JlbGVhc2VkKCkKICAgIH0KfTsKInVzZSBzdHJpY3QiOwpjb25zdCBDM1gkanNjb21wJDE3ID0gc2VsZi5DM1gsCiAgICBtYXAkanNjb21wJDE1ID0gbmV3IFdlYWtNYXAsCiAgICBiZWhJbnN0TWFwID0gbmV3IFdlYWtNYXA7CmxldCBlYXNlVG9JbmRleEZ1bmMgPSBudWxsOwoKZnVuY3Rpb24gR2V0VHdlZW5TdGF0ZShhKSB7CiAgICBhID0gbWFwJGpzY29tcCQxNS5nZXQoYSk7CiAgICBpZiAoYS5Jc1JlbGVhc2VkKCkpIHRocm93IEVycm9yKCJ0aW1lbGluZS90d2VlbiB3YXMgcmVsZWFzZWQgYW5kIGlzIG5vIGxvbmdlciB2YWxpZCIpOwogICAgcmV0dXJuIGEKfQpzZWxmLklUd2VlblN0YXRlID0gY2xhc3MgZXh0ZW5kcyBzZWxmLklUaW1lbGluZVN0YXRlIHsKICAgIGNvbnN0cnVjdG9yKGEsIGIsIGQpIHsKICAgICAgICBzdXBlcihhKTsKICAgICAgICBlYXNlVG9JbmRleEZ1bmMgfHwgKGVhc2VUb0luZGV4RnVuYyA9IGQuZWFzZVRvSW5kZXhGdW5jKTsKICAgICAgICBtYXAkanNjb21wJDE1LnNldCh0aGlzLCBhKTsKICAgICAgICBiICYmIGJlaEluc3RNYXAuc2V0KHRoaXMsIGIpCiAgICB9CiAgICBzdG9wKCkgewogICAgICAgIGNvbnN0IGEgPSBHZXRUd2VlblN0YXRlKHRoaXMpOwogICAgICAgIGJlaEluc3RNYXAuZ2V0KHRoaXMpLlJlbGVhc2VUd2VlbihhKQogICAgfQogICAgc2V0RWFzZShhKSB7CiAgICAgICAgQzNYJGpzY29tcCQxNy5SZXF1aXJlU3RyaW5nKGEpOwogICAgICAgIGEgPSBzZWxmLkVhc2UuR2V0RWFzZUZyb21JbmRleChlYXNlVG9JbmRleEZ1bmMoYSkpOwogICAgICAgIEdldFR3ZWVuU3RhdGUodGhpcykuU2V0RWFzZShhKQogICAgfQogICAgZ2V0IGluc3RhbmNlKCkgewogICAgICAgIGNvbnN0IGEgPSBHZXRUd2VlblN0YXRlKHRoaXMpLkdldEluc3RhbmNlKCk7CiAgICAgICAgcmV0dXJuIGEgPyBhLkdldEludGVyZmFjZUNsYXNzKCkgOiBudWxsCiAgICB9CiAgICBnZXQgaXNEZXN0cm95T25Db21wbGV0ZSgpIHsKICAgICAgICByZXR1cm4gR2V0VHdlZW5TdGF0ZSh0aGlzKS5HZXREZXN0cm95SW5zdGFuY2VPbkNvbXBsZXRlKCkKICAgIH0KICAgIHNldCBpc0Rlc3Ryb3lPbkNvbXBsZXRlKGEpIHsKICAgICAgICBHZXRUd2VlblN0YXRlKHRoaXMpLlNldERlc3Ryb3lJbnN0YW5jZU9uQ29tcGxldGUoISFhKQogICAgfQogICAgZ2V0IHZhbHVlKCkgewogICAgICAgIGNvbnN0IGEgPQogICAgICAgICAgICBHZXRUd2VlblN0YXRlKHRoaXMpOwogICAgICAgIGlmICgidmFsdWUiICE9PSBhLkdldElkKCkpIHRocm93IEVycm9yKCJub3QgYSB2YWx1ZSB0d2VlbiIpOwogICAgICAgIHJldHVybiBhLkdldFByb3BlcnR5VHJhY2soInZhbHVlIikuR2V0U291cmNlQWRhcHRlclZhbHVlKCkKICAgIH0KfTsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkNzUgPSBzZWxmLkMzLAogICAgVkFMSURfTE9BRF9QT0xJQ0lFUyA9IG5ldyBTZXQoWyJsb2NhbCIsICJyZW1vdGUiXSksCiAgICBFWFRfVE9fVFlQRSA9IG5ldyBNYXAoWwogICAgICAgIFsibXA0IiwgInZpZGVvL21wNCJdLAogICAgICAgIFsid2VibSIsICJ2aWRlby93ZWJtIl0sCiAgICAgICAgWyJtNGEiLCAiYXVkaW8vbXA0Il0sCiAgICAgICAgWyJtcDMiLCAiYXVkaW8vbXBlZyJdLAogICAgICAgIFsianMiLCAiYXBwbGljYXRpb24vamF2YXNjcmlwdCJdLAogICAgICAgIFsid2FzbSIsICJhcHBsaWNhdGlvbi93YXNtIl0sCiAgICAgICAgWyJzdmciLCAiaW1hZ2Uvc3ZnK3htbCJdLAogICAgICAgIFsiaHRtbCIsICJ0ZXh0L2h0bWwiXQogICAgXSk7CgpmdW5jdGlvbiBHZXRUeXBlRnJvbUZpbGVFeHRlbnNpb24oYSkgewogICAgaWYgKCFhKSByZXR1cm4gIiI7CiAgICBhID0gYS5zcGxpdCgiLiIpOwogICAgaWYgKDIgPiBhLmxlbmd0aCkgcmV0dXJuICIiOwogICAgYSA9IGEuYXQoLTEpLnRvTG93ZXJDYXNlKCk7CiAgICByZXR1cm4gRVhUX1RPX1RZUEUuZ2V0KGEpIHx8ICIiCn0KCmZ1bmN0aW9uIEFkZFNjcmlwdChhKSB7CiAgICByZXR1cm4gbmV3IFByb21pc2UoKGIsIGQpID0+IHsKICAgICAgICBjb25zdCBjID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic2NyaXB0Iik7CiAgICAgICAgYy5vbmxvYWQgPSBiOwogICAgICAgIGMub25lcnJvciA9IGQ7CiAgICAgICAgYy5hc3luYyA9ICExOwogICAgICAgIGMudHlwZSA9ICJtb2R1bGUiOwogICAgICAgIGMuc3JjID0gYTsKICAgICAgICBkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKGMpCiAgICB9KQp9CkMzJGpzY29tcCQ3NS5Bc3NldE1hbmFnZXIgPSBjbGFzcyBleHRlbmRzIEMzJGpzY29tcCQ3NS5EZWZlbmRlZEJhc2UgewogICAgY29uc3RydWN0b3IoYSwgYikgewogICAgICAgIHN1cGVyKCk7CiAgICAgICAgdmFyIGQgPSBiLmV4cG9ydFR5cGU7CiAgICAgICAgdGhpcy5fcnVudGltZSA9IGE7CiAgICAgICAgdGhpcy5fZmlsZVN0cnVjdHVyZSA9ICJmb2xkZXJzIjsKICAgICAgICB0aGlzLl9sb2NhbFVybEJsb2JzID0gbmV3IE1hcDsKICAgICAgICB0aGlzLl9sb2NhbEJsb2JVcmxDYWNoZSA9IG5ldyBNYXA7CiAgICAgICAgdGhpcy5fbG9jYWxCbG9iU1dVcmxzID0gbmV3IE1hcDsKICAgICAgICB0aGlzLl9pc0NvcmRvdmEgPSAiY29yZG92YSIgPT09IGQ7CiAgICAgICAgdGhpcy5faXNpT1NDb3Jkb3ZhID0gISFiLmlzaU9TQ29yZG92YTsKICAgICAgICB0aGlzLl9pc0ZpbGVQcm90b2NvbCA9ICEhYi5pc0ZpbGVQcm90b2NvbDsKICAgICAgICB0aGlzLl9zd0NsaWVudElkID0gYi5zd0NsaWVudElkOwogICAgICAgIHRoaXMuX3N1cHBvcnRlZEF1ZGlvRm9ybWF0cyA9IGIuc3VwcG9ydGVkQXVkaW9Gb3JtYXRzIHx8IHt9OwogICAgICAgIHRoaXMuX2F1ZGlvRmlsZXMgPSBuZXcgTWFwOwogICAgICAgIHRoaXMuX3ByZWxvYWRTb3VuZHMgPSAhMTsKICAgICAgICB0aGlzLl9pY29uc1N1YmZvbGRlciA9CiAgICAgICAgICAgIHRoaXMuX2ZvbnRzU3ViZm9sZGVyID0gdGhpcy5fbWVkaWFTdWJmb2xkZXIgPSAiIjsKICAgICAgICB0aGlzLl9kZWZhdWx0TG9hZFBvbGljeSA9ICJodG1sNSIgPT09IGQgfHwgInNjaXJyYS1hcmNhZGUiID09PSBkIHx8ICJpbnN0YW50LWdhbWVzIiA9PT0gZCA/ICJyZW1vdGUiIDogImxvY2FsIjsKICAgICAgICB0aGlzLl9hbGxBc3NldHMgPSBbXTsKICAgICAgICB0aGlzLl9hc3NldHNCeVVybCA9IG5ldyBNYXA7CiAgICAgICAgdGhpcy5fd2ViRm9udHMgPSBbXTsKICAgICAgICB0aGlzLl9sb2FkUHJvbWlzZXMgPSBbXTsKICAgICAgICB0aGlzLl9oYXNGaW5pc2hlZEluaXRpYWxMb2FkID0gITE7CiAgICAgICAgdGhpcy5fbGFzdExvYWRQcm9ncmVzcyA9IHRoaXMuX2Fzc2V0U2l6ZUxvYWRlZCA9IHRoaXMuX3RvdGFsQXNzZXRTaXplVG9Mb2FkID0gMDsKICAgICAgICB0aGlzLl9oYXNIYWRFcnJvckxvYWRpbmcgPSAhMTsKICAgICAgICB0aGlzLl9sb2FkaW5nUmF0ZUxpbWl0ZXIgPSBDMyRqc2NvbXAkNzUuTmV3KEMzJGpzY29tcCQ3NS5SYXRlTGltaXRlciwgKCkgPT4gdGhpcy5fRmlyZUxvYWRpbmdQcm9ncmVzc0V2ZW50KCksIDUwKTsKICAgICAgICB0aGlzLl9wcm9taXNlVGhyb3R0bGUgPSBuZXcgQzMkanNjb21wJDc1LlByb21pc2VUaHJvdHRsZShNYXRoLm1heChDMyRqc2NvbXAkNzUuaGFyZHdhcmVDb25jdXJyZW5jeSwKICAgICAgICAgICAgOCkpOwogICAgICAgIGlmIChhID0gYi5wcmV2aWV3SW1hZ2VCbG9icykgewogICAgICAgICAgICAoZCA9IGIucHJldmlld1Byb2plY3RGaWxlQmxvYnMpICYmIE9iamVjdC5hc3NpZ24oYSwgZCk7CiAgICAgICAgICAgIChkID0gYi5wcm9qZWN0RGF0YSkgJiYgKGFbImRhdGEuanNvbiJdID0gZCk7CiAgICAgICAgICAgIGZvciAoY29uc3QgW2MsIGVdIG9mIE9iamVjdC5lbnRyaWVzKGEpKSB0aGlzLl9sb2NhbFVybEJsb2JzLnNldChjLCBlKQogICAgICAgIH0KICAgICAgICBpZiAoYiA9IGIucHJldmlld1Byb2plY3RGaWxlU1dVcmxzKQogICAgICAgICAgICBmb3IgKGNvbnN0IFtjLCBlXSBvZiBPYmplY3QuZW50cmllcyhiKSkgdGhpcy5fbG9jYWxCbG9iU1dVcmxzLnNldChjLCBlKTsKICAgICAgICB0aGlzLl9pQXNzZXRNYW5hZ2VyID0gbmV3IHNlbGYuSUFzc2V0TWFuYWdlcih0aGlzKQogICAgfQogICAgUmVsZWFzZSgpIHsKICAgICAgICB0aGlzLl9sb2NhbFVybEJsb2JzLmNsZWFyKCk7CiAgICAgICAgZm9yIChjb25zdCBhIG9mIHRoaXMuX2xvY2FsQmxvYlVybENhY2hlLnZhbHVlcygpKSBhLnN0YXJ0c1dpdGgoImJsb2I6IikgJiYgVVJMLnJldm9rZU9iamVjdFVSTChhKTsKICAgICAgICB0aGlzLl9sb2NhbEJsb2JVcmxDYWNoZS5jbGVhcigpOwogICAgICAgIGZvciAoY29uc3QgYSBvZiB0aGlzLl9hbGxBc3NldHMpIGEuUmVsZWFzZSgpOwogICAgICAgIEMzJGpzY29tcCQ3NS5jbGVhckFycmF5KHRoaXMuX2FsbEFzc2V0cyk7CiAgICAgICAgdGhpcy5fYXNzZXRzQnlVcmwuY2xlYXIoKTsKICAgICAgICBDMyRqc2NvbXAkNzUuY2xlYXJBcnJheSh0aGlzLl9sb2FkUHJvbWlzZXMpOwogICAgICAgIHRoaXMuX3J1bnRpbWUgPSBudWxsCiAgICB9CiAgICBHZXRSdW50aW1lKCkgewogICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lCiAgICB9CiAgICBfU2V0RmlsZVN0cnVjdHVyZShhKSB7CiAgICAgICAgdGhpcy5fZmlsZVN0cnVjdHVyZSA9IGE7CiAgICAgICAgaWYgKCJmbGF0IiA9PT0gYSkgewogICAgICAgICAgICBhID0gbmV3IE1hcDsKICAgICAgICAgICAgZm9yIChjb25zdCBbYiwgZF0gb2YgdGhpcy5fbG9jYWxVcmxCbG9icy5lbnRyaWVzKCkpIGEuc2V0KGIudG9Mb3dlckNhc2UoKSwgZCk7CiAgICAgICAgICAgIHRoaXMuX2xvY2FsVXJsQmxvYnMgPSBhCiAgICAgICAgfQogICAgfQogICAgR2V0RmlsZVN0cnVjdHVyZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZmlsZVN0cnVjdHVyZQogICAgfQogICAgX1NldE1lZGlhU3ViZm9sZGVyKGEpIHsKICAgICAgICB0aGlzLl9tZWRpYVN1YmZvbGRlciA9IGEKICAgIH0KICAgIEdldE1lZGlhU3ViZm9sZGVyKCkgewogICAgICAgIHJldHVybiB0aGlzLl9tZWRpYVN1YmZvbGRlcgogICAgfQogICAgX1NldEZvbnRzU3ViZm9sZGVyKGEpIHsKICAgICAgICB0aGlzLl9mb250c1N1YmZvbGRlciA9CiAgICAgICAgICAgIGEKICAgIH0KICAgIEdldEZvbnRzU3ViZm9sZGVyKCkgewogICAgICAgIHJldHVybiB0aGlzLl9mb250c1N1YmZvbGRlcgogICAgfQogICAgX1NldEljb25zU3ViZm9sZGVyKGEpIHsKICAgICAgICB0aGlzLl9pY29uc1N1YmZvbGRlciA9IGEKICAgIH0KICAgIEdldEljb25zU3ViZm9sZGVyKCkgewogICAgICAgIHJldHVybiB0aGlzLl9pY29uc1N1YmZvbGRlcgogICAgfQogICAgSXNGaWxlUHJvdG9jb2woKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2lzRmlsZVByb3RvY29sCiAgICB9CiAgICBfSGFzTG9jYWxVcmxCbG9iKGEpIHsKICAgICAgICAiZmxhdCIgPT09IHRoaXMuX2ZpbGVTdHJ1Y3R1cmUgJiYgKGEgPSBhLnRvTG93ZXJDYXNlKCkpOwogICAgICAgIHJldHVybiB0aGlzLl9sb2NhbFVybEJsb2JzLmhhcyhhKQogICAgfQogICAgX0dldExvY2FsVXJsQmxvYihhKSB7CiAgICAgICAgImZsYXQiID09PSB0aGlzLl9maWxlU3RydWN0dXJlICYmIChhID0gYS50b0xvd2VyQ2FzZSgpKTsKICAgICAgICByZXR1cm4gdGhpcy5fbG9jYWxVcmxCbG9icy5nZXQoYSkgfHwgbnVsbAogICAgfQogICAgR2V0TG9jYWxVcmxBc0Jsb2JVcmwoYSkgewogICAgICAgICJmbGF0IiA9PT0gdGhpcy5fZmlsZVN0cnVjdHVyZSAmJiAoYSA9IGEudG9Mb3dlckNhc2UoKSk7CiAgICAgICAgaWYgKCF0aGlzLl9IYXNMb2NhbFVybEJsb2IoYSkpIHJldHVybiBhOwogICAgICAgIHZhciBiID0gdGhpcy5fbG9jYWxCbG9iVXJsQ2FjaGUuZ2V0KGEpOwogICAgICAgIGIgfHwgKGIgPSB0aGlzLl9HZXRMb2NhbFVybEJsb2IoYSksIGIgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGIpLCB0aGlzLl9sb2NhbEJsb2JVcmxDYWNoZS5zZXQoYSwgYikpOwogICAgICAgIHJldHVybiBiCiAgICB9CiAgICBGZXRjaEJsb2IoYSwgYikgewogICAgICAgIGIgPSBiIHx8IHRoaXMuX2RlZmF1bHRMb2FkUG9saWN5OwogICAgICAgIGNvbnN0IGQgPSB0aGlzLl9HZXRMb2NhbFVybEJsb2IoYSk7CiAgICAgICAgcmV0dXJuIGQgPyBQcm9taXNlLnJlc29sdmUoZCkgOiBDMyRqc2NvbXAkNzUuSXNSZWxhdGl2ZVVSTChhKSA/ICgiZmxhdCIgPT09IHRoaXMuX2ZpbGVTdHJ1Y3R1cmUgJiYgKGEgPSBhLnRvTG93ZXJDYXNlKCkpLCB0aGlzLl9pc0NvcmRvdmEgJiYgdGhpcy5faXNGaWxlUHJvdG9jb2wgPyB0aGlzLkNvcmRvdmFGZXRjaExvY2FsRmlsZUFzQmxvYihhKSA6ICJsb2NhbCIgPT09IGIgPyB0aGlzLl9wcm9taXNlVGhyb3R0bGUuQWRkKCgpID0+IEMzJGpzY29tcCQ3NS5GZXRjaEJsb2IoYSkpIDogQzMkanNjb21wJDc1LkZldGNoQmxvYihhKSkgOiBDMyRqc2NvbXAkNzUuRmV0Y2hCbG9iKGEpCiAgICB9CiAgICBGZXRjaEFycmF5QnVmZmVyKGEpIHsKICAgICAgICBjb25zdCBiID0KICAgICAgICAgICAgdGhpcy5fR2V0TG9jYWxVcmxCbG9iKGEpOwogICAgICAgIHJldHVybiBiID8gQzMkanNjb21wJDc1LkJsb2JUb0FycmF5QnVmZmVyKGIpIDogQzMkanNjb21wJDc1LklzUmVsYXRpdmVVUkwoYSkgPyAoImZsYXQiID09PSB0aGlzLl9maWxlU3RydWN0dXJlICYmIChhID0gYS50b0xvd2VyQ2FzZSgpKSwgdGhpcy5faXNDb3Jkb3ZhICYmIHRoaXMuX2lzRmlsZVByb3RvY29sID8gdGhpcy5Db3Jkb3ZhRmV0Y2hMb2NhbEZpbGVBc0FycmF5QnVmZmVyKGEpIDogImxvY2FsIiA9PT0gdGhpcy5fZGVmYXVsdExvYWRQb2xpY3kgPyB0aGlzLl9wcm9taXNlVGhyb3R0bGUuQWRkKCgpID0+IEMzJGpzY29tcCQ3NS5GZXRjaEFycmF5QnVmZmVyKGEpKSA6IEMzJGpzY29tcCQ3NS5GZXRjaEFycmF5QnVmZmVyKGEpKSA6IEMzJGpzY29tcCQ3NS5GZXRjaEFycmF5QnVmZmVyKGEpCiAgICB9CiAgICBGZXRjaFRleHQoYSkgewogICAgICAgIGNvbnN0IGIgPSB0aGlzLl9HZXRMb2NhbFVybEJsb2IoYSk7CiAgICAgICAgcmV0dXJuIGIgPyBDMyRqc2NvbXAkNzUuQmxvYlRvU3RyaW5nKGIpIDogQzMkanNjb21wJDc1LklzUmVsYXRpdmVVUkwoYSkgPwogICAgICAgICAgICAoImZsYXQiID09PSB0aGlzLl9maWxlU3RydWN0dXJlICYmIChhID0gYS50b0xvd2VyQ2FzZSgpKSwgdGhpcy5faXNDb3Jkb3ZhICYmIHRoaXMuX2lzRmlsZVByb3RvY29sID8gdGhpcy5Db3Jkb3ZhRmV0Y2hMb2NhbEZpbGVBc1RleHQoYSkgOiAibG9jYWwiID09PSB0aGlzLl9kZWZhdWx0TG9hZFBvbGljeSA/IHRoaXMuX3Byb21pc2VUaHJvdHRsZS5BZGQoKCkgPT4gQzMkanNjb21wJDc1LkZldGNoVGV4dChhKSkgOiBDMyRqc2NvbXAkNzUuRmV0Y2hUZXh0KGEpKSA6IEMzJGpzY29tcCQ3NS5GZXRjaFRleHQoYSkKICAgIH0KICAgIGFzeW5jIEZldGNoSnNvbihhKSB7CiAgICAgICAgYSA9IGF3YWl0IHRoaXMuRmV0Y2hUZXh0KGEpOwogICAgICAgIHJldHVybiBKU09OLnBhcnNlKGEpCiAgICB9CiAgICBfQ29yZG92YUZldGNoTG9jYWxGaWxlQXMoYSwgYikgewogICAgICAgICJmbGF0IiA9PT0gdGhpcy5fZmlsZVN0cnVjdHVyZSAmJiAoYSA9IGEudG9Mb3dlckNhc2UoKSk7CiAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUuUG9zdENvbXBvbmVudE1lc3NhZ2VUb0RPTUFzeW5jKCJydW50aW1lIiwgImNvcmRvdmEtZmV0Y2gtbG9jYWwtZmlsZSIsIHsKICAgICAgICAgICAgZmlsZW5hbWU6IGEsCiAgICAgICAgICAgIGFzOiBiCiAgICAgICAgfSkKICAgIH0KICAgIENvcmRvdmFGZXRjaExvY2FsRmlsZUFzVGV4dChhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX0NvcmRvdmFGZXRjaExvY2FsRmlsZUFzKGEsICJ0ZXh0IikKICAgIH0KICAgIGFzeW5jIENvcmRvdmFGZXRjaExvY2FsRmlsZUFzQmxvYihhKSB7CiAgICAgICAgY29uc3QgYiA9IGF3YWl0IHRoaXMuX0NvcmRvdmFGZXRjaExvY2FsRmlsZUFzKGEsICJidWZmZXIiKTsKICAgICAgICBhID0gR2V0VHlwZUZyb21GaWxlRXh0ZW5zaW9uKGEpOwogICAgICAgIHJldHVybiBuZXcgQmxvYihbYl0sIHsKICAgICAgICAgICAgdHlwZTogYQogICAgICAgIH0pCiAgICB9CiAgICBhc3luYyBDb3Jkb3ZhRmV0Y2hMb2NhbEZpbGVBc0Jsb2JVUkwoYSkgewogICAgICAgICJmbGF0IiA9PT0gdGhpcy5fZmlsZVN0cnVjdHVyZSAmJiAoYSA9IGEudG9Mb3dlckNhc2UoKSk7CiAgICAgICAgdmFyIGIgPSB0aGlzLl9sb2NhbEJsb2JVcmxDYWNoZS5nZXQoYSk7CiAgICAgICAgaWYgKGIpIHJldHVybiBiOwogICAgICAgIGIgPSBhd2FpdCB0aGlzLkNvcmRvdmFGZXRjaExvY2FsRmlsZUFzQmxvYihhKTsKICAgICAgICBiID0gVVJMLmNyZWF0ZU9iamVjdFVSTChiKTsKICAgICAgICB0aGlzLl9sb2NhbEJsb2JVcmxDYWNoZS5zZXQoYSwgYik7CiAgICAgICAgcmV0dXJuIGIKICAgIH0KICAgIENvcmRvdmFGZXRjaExvY2FsRmlsZUFzQXJyYXlCdWZmZXIoYSkgewogICAgICAgIHJldHVybiB0aGlzLl9Db3Jkb3ZhRmV0Y2hMb2NhbEZpbGVBcyhhLAogICAgICAgICAgICAiYnVmZmVyIikKICAgIH0KICAgIEdldE1lZGlhRmlsZVVybChhKSB7CiAgICAgICAgImZsYXQiID09PSB0aGlzLl9maWxlU3RydWN0dXJlICYmIChhID0gYS50b0xvd2VyQ2FzZSgpKTsKICAgICAgICBhID0gdGhpcy5fbWVkaWFTdWJmb2xkZXIgKyBhOwogICAgICAgIHJldHVybiB0aGlzLl9IYXNMb2NhbFVybEJsb2IoYSkgPyB0aGlzLkdldExvY2FsVXJsQXNCbG9iVXJsKGEpIDogYQogICAgfQogICAgR2V0UHJvamVjdEZpbGVVcmwoYSkgewogICAgICAgIGlmIChDMyRqc2NvbXAkNzUuSXNBYnNvbHV0ZVVSTChhKSkgcmV0dXJuIFByb21pc2UucmVzb2x2ZShhKTsKICAgICAgICBpZiAodGhpcy5fSGFzTG9jYWxVcmxCbG9iKGEpKSByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHRoaXMuR2V0TG9jYWxVcmxBc0Jsb2JVcmwoYSkpOwogICAgICAgIGlmICh0aGlzLl9pc0NvcmRvdmEgJiYgdGhpcy5faXNGaWxlUHJvdG9jb2wpIHJldHVybiB0aGlzLkNvcmRvdmFGZXRjaExvY2FsRmlsZUFzQmxvYlVSTChhKTsKICAgICAgICAiZmxhdCIgPT09IHRoaXMuX2ZpbGVTdHJ1Y3R1cmUgJiYgKGEgPSBhLnRvTG93ZXJDYXNlKCkpOwogICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoYSkKICAgIH0KICAgIEdldFByb2plY3RGaWxlSWZyYW1lVXJsKGEpIHsKICAgICAgICBpZiAoQzMkanNjb21wJDc1LklzQWJzb2x1dGVVUkwoYSkpIHJldHVybiBQcm9taXNlLnJlc29sdmUoYSk7CiAgICAgICAgdmFyIGIgPSBhLmluZGV4T2YoIj8iKSwKICAgICAgICAgICAgZCA9IC0xID09PSBiID8gIiIgOiBhLnN1YnN0cihiKTsKICAgICAgICBiID0gLTEgPT09IGIgPyBhIDogYS5zdWJzdHIoMCwgYik7CiAgICAgICAgaWYgKHRoaXMuX0hhc0xvY2FsVXJsQmxvYihiKSkgcmV0dXJuIGEgPSB0aGlzLl9sb2NhbEJsb2JTV1VybHMuZ2V0KGIpIHx8IHRoaXMuR2V0TG9jYWxVcmxBc0Jsb2JVcmwoYiksICFhLnN0YXJ0c1dpdGgoImJsb2I6IikgJiYgdGhpcy5fc3dDbGllbnRJZCAmJiAoYSA9IG5ldyBVUkwoYSksIGQgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKGQpLCBkLnNldCgiX19jM19jbGllbnRfaWQiLCB0aGlzLl9zd0NsaWVudElkKSwgYS5zZWFyY2ggPSBkLnRvU3RyaW5nKCksIGEgPSBhLnRvU3RyaW5nKCkpLCBQcm9taXNlLnJlc29sdmUoYSk7CiAgICAgICAgaWYgKHRoaXMuX2lzQ29yZG92YSAmJiB0aGlzLl9pc0ZpbGVQcm90b2NvbCkgcmV0dXJuIHRoaXMuQ29yZG92YUZldGNoTG9jYWxGaWxlQXNCbG9iVVJMKGIpOwogICAgICAgICJmbGF0IiA9PT0gdGhpcy5fZmlsZVN0cnVjdHVyZSAmJiAoYSA9IGEudG9Mb3dlckNhc2UoKSk7CiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShhKQogICAgfQogICAgTG9hZFByb2plY3RGaWxlVXJsKGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5HZXRQcm9qZWN0RmlsZVVybChhKQogICAgfQogICAgTG9hZEltYWdlKGEpIHsKICAgICAgICBpZiAoYS5sb2FkUG9saWN5ICYmCiAgICAgICAgICAgICFWQUxJRF9MT0FEX1BPTElDSUVTLmhhcyhhLmxvYWRQb2xpY3kpKSB0aHJvdyBFcnJvcigiaW52YWxpZCBsb2FkIHBvbGljeSIpOwogICAgICAgIGxldCBiID0gdGhpcy5fYXNzZXRzQnlVcmwuZ2V0KGEudXJsKTsKICAgICAgICBpZiAoYikgcmV0dXJuIGI7CiAgICAgICAgYiA9IEMzJGpzY29tcCQ3NS5OZXcoQzMkanNjb21wJDc1LkltYWdlQXNzZXQsIHRoaXMsIHsKICAgICAgICAgICAgdXJsOiBhLnVybCwKICAgICAgICAgICAgc2l6ZTogYS5zaXplIHx8IDAsCiAgICAgICAgICAgIGxvYWRQb2xpY3k6IGEubG9hZFBvbGljeSB8fCB0aGlzLl9kZWZhdWx0TG9hZFBvbGljeQogICAgICAgIH0pOwogICAgICAgIHRoaXMuX2FsbEFzc2V0cy5wdXNoKGIpOwogICAgICAgIHRoaXMuX2Fzc2V0c0J5VXJsLnNldChiLkdldFVSTCgpLCBiKTsKICAgICAgICB0aGlzLl9oYXNGaW5pc2hlZEluaXRpYWxMb2FkIHx8ICh0aGlzLl90b3RhbEFzc2V0U2l6ZVRvTG9hZCArPSBiLkdldFNpemUoKSwgdGhpcy5fbG9hZFByb21pc2VzLnB1c2goYi5Mb2FkKCkudGhlbigoKSA9PiB0aGlzLl9BZGRMb2FkZWRTaXplKGIuR2V0U2l6ZSgpKSkpKTsKICAgICAgICByZXR1cm4gYgogICAgfQogICAgYXN5bmMgV2FpdEZvckFsbFRvTG9hZCgpIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBhd2FpdCBQcm9taXNlLmFsbCh0aGlzLl9sb2FkUHJvbWlzZXMpLAogICAgICAgICAgICAgICAgdGhpcy5fbGFzdExvYWRQcm9ncmVzcyA9IDEKICAgICAgICB9IGNhdGNoIChhKSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIGxvYWRpbmc6ICIsIGEpLCB0aGlzLl9oYXNIYWRFcnJvckxvYWRpbmcgPSAhMCwgdGhpcy5fRmlyZUxvYWRpbmdQcm9ncmVzc0V2ZW50KCkKICAgICAgICB9CiAgICB9CiAgICBTZXRJbml0aWFsTG9hZEZpbmlzaGVkKCkgewogICAgICAgIHRoaXMuX2hhc0ZpbmlzaGVkSW5pdGlhbExvYWQgPSAhMAogICAgfQogICAgSGFzSGFkRXJyb3JMb2FkaW5nKCkgewogICAgICAgIHJldHVybiB0aGlzLl9oYXNIYWRFcnJvckxvYWRpbmcKICAgIH0KICAgIF9BZGRMb2FkZWRTaXplKGEpIHsKICAgICAgICB0aGlzLl9hc3NldFNpemVMb2FkZWQgKz0gYTsKICAgICAgICB0aGlzLl9sb2FkaW5nUmF0ZUxpbWl0ZXIuQ2FsbCgpCiAgICB9CiAgICBfRmlyZUxvYWRpbmdQcm9ncmVzc0V2ZW50KCkgewogICAgICAgIGNvbnN0IGEgPSBDMyRqc2NvbXAkNzUuTmV3KEMzJGpzY29tcCQ3NS5FdmVudCwgImxvYWRpbmdwcm9ncmVzcyIpOwogICAgICAgIHRoaXMuX2xhc3RMb2FkUHJvZ3Jlc3MgPSBDMyRqc2NvbXAkNzUuY2xhbXAodGhpcy5fYXNzZXRTaXplTG9hZGVkIC8gdGhpcy5fdG90YWxBc3NldFNpemVUb0xvYWQsIDAsIDEpOwogICAgICAgIGEucHJvZ3Jlc3MgPSB0aGlzLl9sYXN0TG9hZFByb2dyZXNzOwogICAgICAgIHRoaXMuX3J1bnRpbWUuRGlzcGF0Y2hlcigpLmRpc3BhdGNoRXZlbnQoYSkKICAgIH0KICAgIEdldExvYWRQcm9ncmVzcygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fbGFzdExvYWRQcm9ncmVzcwogICAgfQogICAgX1NldFdlYkZvbnRzKGEpIHsKICAgICAgICBDMyRqc2NvbXAkNzUuc2hhbGxvd0Fzc2lnbkFycmF5KHRoaXMuX3dlYkZvbnRzLCBhKTsKICAgICAgICB0aGlzLl93ZWJGb250cy5sZW5ndGggJiYgdGhpcy5fbG9hZFByb21pc2VzLnB1c2godGhpcy5fTG9hZFdlYkZvbnRzKCkpCiAgICB9CiAgICBfTG9hZFdlYkZvbnRzKCkgewogICAgICAgIGlmICgidW5kZWZpbmVkIiA9PT0gdHlwZW9mIEZvbnRGYWNlKSByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7CiAgICAgICAgY29uc3QgYSA9IFtdOwogICAgICAgIGZvciAoY29uc3QgW2IsIGQsIGNdIG9mIHRoaXMuX3dlYkZvbnRzKSB0aGlzLl90b3RhbEFzc2V0U2l6ZVRvTG9hZCArPSBjLCBhLnB1c2godGhpcy5fTG9hZFdlYkZvbnQoYiwgZCkudGhlbigoKSA9PiB0aGlzLl9BZGRMb2FkZWRTaXplKGMpKSk7CiAgICAgICAgcmV0dXJuIFByb21pc2UuYWxsKGEpCiAgICB9CiAgICBhc3luYyBfTG9hZFdlYkZvbnQoYSwKICAgICAgICBiKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgY29uc3QgZCA9IGF3YWl0IHRoaXMuR2V0UHJvamVjdEZpbGVVcmwoYiksCiAgICAgICAgICAgICAgICBjID0gbmV3IEZvbnRGYWNlKGEsIGB1cmwoJyR7ZH0nKWApOwogICAgICAgICAgICB0aGlzLl9ydW50aW1lLklzSW5Xb3JrZXIoKSA/IHNlbGYuZm9udHMuYWRkKGMpIDogZG9jdW1lbnQuZm9udHMuYWRkKGMpOwogICAgICAgICAgICBhd2FpdCBjLmxvYWQoKQogICAgICAgIH0gY2F0Y2ggKGQpIHsKICAgICAgICAgICAgY29uc29sZS53YXJuKGBbQzMgcnVudGltZV0gRmFpbGVkIHRvIGxvYWQgd2ViIGZvbnQgJyR7YX0nOiBgLCBkKQogICAgICAgIH0KICAgIH0KICAgIElzQXVkaW9Gb3JtYXRTdXBwb3J0ZWQoYSkgewogICAgICAgIHJldHVybiAhIXRoaXMuX3N1cHBvcnRlZEF1ZGlvRm9ybWF0c1thXQogICAgfQogICAgX1NldEF1ZGlvRmlsZXMoYSwgYikgewogICAgICAgIHRoaXMuX3ByZWxvYWRTb3VuZHMgPSAhIWI7CiAgICAgICAgZm9yIChjb25zdCBbZCwgYywgZV0gb2YgYSkgdGhpcy5fYXVkaW9GaWxlcy5zZXQoZCwgewogICAgICAgICAgICBmaWxlTmFtZTogZCwKICAgICAgICAgICAgZm9ybWF0czogYy5tYXAoZyA9PiAoewogICAgICAgICAgICAgICAgdHlwZTogZ1swXSwKICAgICAgICAgICAgICAgIGZpbGVFeHRlbnNpb246IGdbMV0sCiAgICAgICAgICAgICAgICBmdWxsTmFtZTogZCArIGdbMV0sCiAgICAgICAgICAgICAgICBmaWxlU2l6ZTogZ1syXQogICAgICAgICAgICB9KSksCiAgICAgICAgICAgIGlzTXVzaWM6IGUKICAgICAgICB9KQogICAgfQogICAgR2V0UHJlZmVycmVkQXVkaW9GaWxlKGEpIHsKICAgICAgICAiZmxhdCIgPT09CiAgICAgICAgdGhpcy5fZmlsZVN0cnVjdHVyZSAmJiAoYSA9IGEudG9Mb3dlckNhc2UoKSk7CiAgICAgICAgYSA9IHRoaXMuX2F1ZGlvRmlsZXMuZ2V0KGEpOwogICAgICAgIGlmICghYSkgcmV0dXJuIG51bGw7CiAgICAgICAgbGV0IGIgPSBudWxsOwogICAgICAgIGZvciAoY29uc3QgZCBvZiBhLmZvcm1hdHMpCiAgICAgICAgICAgIGlmIChiIHx8ICJhdWRpby93ZWJtOyBjb2RlY3M9b3B1cyIgIT09IGQudHlwZSB8fCAoYiA9IGQpLCB0aGlzLklzQXVkaW9Gb3JtYXRTdXBwb3J0ZWQoZC50eXBlKSkgcmV0dXJuIGQ7CiAgICAgICAgcmV0dXJuIGIKICAgIH0KICAgIEdldFByb2plY3RBdWRpb0ZpbGVVcmwoYSkgewogICAgICAgIHJldHVybiAoYSA9IHRoaXMuR2V0UHJlZmVycmVkQXVkaW9GaWxlKGEpKSA/IHsKICAgICAgICAgICAgdXJsOiB0aGlzLkdldE1lZGlhRmlsZVVybChhLmZ1bGxOYW1lKSwKICAgICAgICAgICAgdHlwZTogYS50eXBlCiAgICAgICAgfSA6IG51bGwKICAgIH0KICAgIEdldEF1ZGlvVG9QcmVsb2FkKCkgewogICAgICAgIGlmICh0aGlzLl9wcmVsb2FkU291bmRzKSB7CiAgICAgICAgICAgIGNvbnN0IGEgPSBbXTsKICAgICAgICAgICAgZm9yIChjb25zdCBiIG9mIHRoaXMuX2F1ZGlvRmlsZXMudmFsdWVzKCkpIHsKICAgICAgICAgICAgICAgIGlmIChiLmlzTXVzaWMpIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgY29uc3QgZCA9IHRoaXMuR2V0UHJlZmVycmVkQXVkaW9GaWxlKGIuZmlsZU5hbWUpOwogICAgICAgICAgICAgICAgZCAmJiBhLnB1c2goewogICAgICAgICAgICAgICAgICAgIG9yaWdpbmFsVXJsOiBiLmZpbGVOYW1lLAogICAgICAgICAgICAgICAgICAgIHVybDogdGhpcy5HZXRNZWRpYUZpbGVVcmwoZC5mdWxsTmFtZSksCiAgICAgICAgICAgICAgICAgICAgdHlwZTogZC50eXBlLAogICAgICAgICAgICAgICAgICAgIGZpbGVTaXplOiBkLmZpbGVTaXplCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBhCiAgICAgICAgfQogICAgICAgIHJldHVybiBbXQogICAgfQogICAgR2V0SUFzc2V0TWFuYWdlcigpIHsKICAgICAgICByZXR1cm4gdGhpcy5faUFzc2V0TWFuYWdlcgogICAgfQogICAgYXN5bmMgTG9hZFNjcmlwdHMoLi4uYSkgewogICAgICAgIGNvbnN0IGIgPSBhd2FpdCBQcm9taXNlLmFsbChhLm1hcChkID0+IHRoaXMuR2V0UHJvamVjdEZpbGVVcmwoZCkpKTsKICAgICAgICB0aGlzLl9ydW50aW1lLklzSW5Xb3JrZXIoKSA/IDEgPT09IGEubGVuZ3RoID8gKGEgPSBhWzBdLCBhd2FpdCBzZWxmLmMzX2ltcG9ydCgoQzMkanNjb21wJDc1LklzUmVsYXRpdmVVUkwoYSkgPyAiLi8iIDogIiIpICsgYSkpIDogKGEgPSBhLm1hcChkID0+IGBpbXBvcnQgIiR7QzMkanNjb21wJDc1LklzUmVsYXRpdmVVUkwoZCk/Ii4vIjoiIn0ke2R9IjtgKS5qb2luKCJcbiIpLCBhID0gVVJMLmNyZWF0ZU9iamVjdFVSTChuZXcgQmxvYihbYV0sIHsKICAgICAgICAgICAgICAgIHR5cGU6ICJhcHBsaWNhdGlvbi9qYXZhc2NyaXB0IgogICAgICAgICAgICB9KSksCiAgICAgICAgICAgIGF3YWl0IHNlbGYuYzNfaW1wb3J0KGEpKSA6IGF3YWl0IFByb21pc2UuYWxsKGIubWFwKGQgPT4gQWRkU2NyaXB0KGQpKSkKICAgIH0KICAgIGFzeW5jIENvbXBpbGVXZWJBc3NlbWJseShhKSB7CiAgICAgICAgaWYgKFdlYkFzc2VtYmx5LmNvbXBpbGVTdHJlYW1pbmcpIHJldHVybiBhID0gYXdhaXQgdGhpcy5HZXRQcm9qZWN0RmlsZVVybChhKSwgYXdhaXQgV2ViQXNzZW1ibHkuY29tcGlsZVN0cmVhbWluZyhmZXRjaChhKSk7CiAgICAgICAgYSA9IGF3YWl0IEMzJGpzY29tcCQ3NS5GZXRjaEFycmF5QnVmZmVyKGEpOwogICAgICAgIHJldHVybiBhd2FpdCBXZWJBc3NlbWJseS5jb21waWxlKGEpCiAgICB9CiAgICBhc3luYyBMb2FkU3R5bGVTaGVldChhKSB7CiAgICAgICAgYSA9IGF3YWl0IHRoaXMuR2V0UHJvamVjdEZpbGVVcmwoYSk7CiAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuX3J1bnRpbWUuUG9zdENvbXBvbmVudE1lc3NhZ2VUb0RPTUFzeW5jKCJydW50aW1lIiwgImFkZC1zdHlsZXNoZWV0IiwgewogICAgICAgICAgICB1cmw6IGEKICAgICAgICB9KQogICAgfQp9OwoidXNlIHN0cmljdCI7CmNvbnN0IEMzJGpzY29tcCQ3NiA9IHNlbGYuQzM7CkMzJGpzY29tcCQ3Ni5Bc3NldCA9IGNsYXNzIGV4dGVuZHMgQzMkanNjb21wJDc2LkRlZmVuZGVkQmFzZSB7CiAgICBjb25zdHJ1Y3RvcihhLCBiKSB7CiAgICAgICAgc3VwZXIoKTsKICAgICAgICB0aGlzLl9hc3NldE1hbmFnZXIgPSBhOwogICAgICAgIHRoaXMuX3J1bnRpbWUgPSBhLkdldFJ1bnRpbWUoKTsKICAgICAgICB0aGlzLl91cmwgPSBiLnVybDsKICAgICAgICB0aGlzLl9zaXplID0gYi5zaXplOwogICAgICAgIHRoaXMuX2xvYWRQb2xpY3kgPSBiLmxvYWRQb2xpY3k7CiAgICAgICAgdGhpcy5fYmxvYiA9IG51bGw7CiAgICAgICAgdGhpcy5faXNMb2FkZWQgPSAhMTsKICAgICAgICB0aGlzLl9sb2FkUHJvbWlzZSA9IG51bGwKICAgIH0KICAgIFJlbGVhc2UoKSB7CiAgICAgICAgdGhpcy5fYmxvYiA9IHRoaXMuX3J1bnRpbWUgPSB0aGlzLl9hc3NldE1hbmFnZXIgPSB0aGlzLl9sb2FkUHJvbWlzZSA9IG51bGwKICAgIH0KICAgIEdldFVSTCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdXJsCiAgICB9CiAgICBHZXRTaXplKCkgewogICAgICAgIHJldHVybiB0aGlzLl9zaXplCiAgICB9CiAgICBMb2FkKCkgewogICAgICAgIHJldHVybiAibG9jYWwiID09PSB0aGlzLl9sb2FkUG9saWN5IHx8IHRoaXMuX2Jsb2IgPyAodGhpcy5faXNMb2FkZWQgPSAhMCwgUHJvbWlzZS5yZXNvbHZlKCkpIDogdGhpcy5fbG9hZFByb21pc2UgPyB0aGlzLl9sb2FkUHJvbWlzZSA6CiAgICAgICAgICAgIHRoaXMuX2xvYWRQcm9taXNlID0gdGhpcy5fYXNzZXRNYW5hZ2VyLkZldGNoQmxvYih0aGlzLl91cmwsIHRoaXMuX2xvYWRQb2xpY3kpLnRoZW4oYSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLl9pc0xvYWRlZCA9ICEwOwogICAgICAgICAgICAgICAgdGhpcy5fbG9hZFByb21pc2UgPSBudWxsOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2Jsb2IgPSBhCiAgICAgICAgICAgIH0pLmNhdGNoKGEgPT4gY29uc29sZS5lcnJvcigiRXJyb3IgbG9hZGluZyByZXNvdXJjZTogIiwgYSkpCiAgICB9CiAgICBJc0xvYWRlZCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5faXNMb2FkZWQKICAgIH0KICAgIEdldEJsb2IoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2Jsb2IgPyBQcm9taXNlLnJlc29sdmUodGhpcy5fYmxvYikgOiB0aGlzLl9sb2FkUHJvbWlzZSA/IHRoaXMuX2xvYWRQcm9taXNlIDogdGhpcy5fYXNzZXRNYW5hZ2VyLkZldGNoQmxvYih0aGlzLl91cmwsIHRoaXMuX2xvYWRQb2xpY3kpCiAgICB9Cn07CiJ1c2Ugc3RyaWN0IjsKY29uc3QgQzMkanNjb21wJDc3ID0gc2VsZi5DMywKICAgIHByb21pc2VUaHJvdHRsZSA9IG5ldyBDMyRqc2NvbXAkNzcuUHJvbWlzZVRocm90dGxlLAogICAgYWxsSW1hZ2VBc3NldHMgPSBuZXcgU2V0OwpDMyRqc2NvbXAkNzcuSW1hZ2VBc3NldCA9IGNsYXNzIGV4dGVuZHMgQzMkanNjb21wJDc3LkFzc2V0IHsKICAgIGNvbnN0cnVjdG9yKGEsIGIpIHsKICAgICAgICBzdXBlcihhLCBiKTsKICAgICAgICB0aGlzLl93ZWJnbFRleHR1cmUgPSB0aGlzLl90ZXh0dXJlUHJvbWlzZSA9IG51bGw7CiAgICAgICAgdGhpcy5fcmVmQ291bnQgPSAwOwogICAgICAgIHRoaXMuX2ltYWdlSGVpZ2h0ID0gdGhpcy5faW1hZ2VXaWR0aCA9IC0xOwogICAgICAgIGFsbEltYWdlQXNzZXRzLmFkZCh0aGlzKQogICAgfQogICAgUmVsZWFzZSgpIHsKICAgICAgICB0aGlzLlJlbGVhc2VUZXh0dXJlKCk7CiAgICAgICAgaWYgKDAgIT09IHRoaXMuX3JlZkNvdW50KSB0aHJvdyBFcnJvcigicmVsZWFzZWQgaW1hZ2UgYXNzZXQgd2hpY2ggc3RpbGwgaGFzIHRleHR1cmUgcmVmZXJlbmNlcyIpOwogICAgICAgIHRoaXMuX3RleHR1cmVQcm9taXNlID0gbnVsbDsKICAgICAgICBhbGxJbWFnZUFzc2V0cy5kZWxldGUodGhpcyk7CiAgICAgICAgc3VwZXIuUmVsZWFzZSgpCiAgICB9CiAgICBzdGF0aWMgT25XZWJHTENvbnRleHRMb3N0KCkgewogICAgICAgIGZvciAoY29uc3QgYSBvZiBhbGxJbWFnZUFzc2V0cykgYS5fdGV4dHVyZVByb21pc2UgPSBudWxsLCBhLl93ZWJnbFRleHR1cmUgPQogICAgICAgICAgICBudWxsLCBhLl9yZWZDb3VudCA9IDAKICAgIH0KICAgIExvYWRTdGF0aWNUZXh0dXJlKGEsIGIpIHsKICAgICAgICBiID0gYiB8fCB7fTsKICAgICAgICB0aGlzLl9yZWZDb3VudCsrOwogICAgICAgIGlmICh0aGlzLl93ZWJnbFRleHR1cmUpIHJldHVybiBQcm9taXNlLnJlc29sdmUodGhpcy5fd2ViZ2xUZXh0dXJlKTsKICAgICAgICBpZiAodGhpcy5fdGV4dHVyZVByb21pc2UpIHJldHVybiB0aGlzLl90ZXh0dXJlUHJvbWlzZTsKICAgICAgICBiLmFuaXNvdHJvcHkgPSB0aGlzLl9ydW50aW1lLkdldENhbnZhc01hbmFnZXIoKS5HZXRUZXh0dXJlQW5pc290cm9weSgpOwogICAgICAgIHJldHVybiB0aGlzLl90ZXh0dXJlUHJvbWlzZSA9IHRoaXMuR2V0QmxvYigpLnRoZW4oZCA9PiBwcm9taXNlVGhyb3R0bGUuQWRkKCgpID0+IGEuQ3JlYXRlU3RhdGljVGV4dHVyZUFzeW5jKGQsIGIpLnRoZW4oYyA9PiB7CiAgICAgICAgICAgIHRoaXMuX3RleHR1cmVQcm9taXNlID0gbnVsbDsKICAgICAgICAgICAgaWYgKDAgPT09IHRoaXMuX3JlZkNvdW50KSByZXR1cm4gYS5EZWxldGVUZXh0dXJlKGMpLCBudWxsOwogICAgICAgICAgICB0aGlzLl93ZWJnbFRleHR1cmUgPSBjOwogICAgICAgICAgICB0aGlzLl9pbWFnZVdpZHRoID0gYy5HZXRXaWR0aCgpOwogICAgICAgICAgICB0aGlzLl9pbWFnZUhlaWdodCA9CiAgICAgICAgICAgICAgICBjLkdldEhlaWdodCgpOwogICAgICAgICAgICByZXR1cm4gdGhpcy5fd2ViZ2xUZXh0dXJlCiAgICAgICAgfSkpKS5jYXRjaChkID0+IHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcigiRmFpbGVkIHRvIGxvYWQgdGV4dHVyZTogIiwgZCk7CiAgICAgICAgICAgIHRocm93IGQ7CiAgICAgICAgfSkKICAgIH0KICAgIFJlbGVhc2VUZXh0dXJlKCkgewogICAgICAgIGlmICgwID49IHRoaXMuX3JlZkNvdW50KSB0aHJvdyBFcnJvcigidGV4dHVyZSByZWxlYXNlZCB0b28gbWFueSB0aW1lcyIpOwogICAgICAgIHRoaXMuX3JlZkNvdW50LS07CiAgICAgICAgMCA9PT0gdGhpcy5fcmVmQ291bnQgJiYgdGhpcy5fd2ViZ2xUZXh0dXJlICYmICh0aGlzLl93ZWJnbFRleHR1cmUuR2V0UmVuZGVyZXIoKS5EZWxldGVUZXh0dXJlKHRoaXMuX3dlYmdsVGV4dHVyZSksIHRoaXMuX3dlYmdsVGV4dHVyZSA9IG51bGwpCiAgICB9CiAgICBHZXRUZXh0dXJlKCkgewogICAgICAgIHJldHVybiB0aGlzLl93ZWJnbFRleHR1cmUKICAgIH0KICAgIEdldFdpZHRoKCkgewogICAgICAgIHJldHVybiB0aGlzLl9pbWFnZVdpZHRoCiAgICB9CiAgICBHZXRIZWlnaHQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2ltYWdlSGVpZ2h0CiAgICB9CiAgICBhc3luYyBMb2FkVG9EcmF3YWJsZSgpIHsKICAgICAgICBjb25zdCBhID0gYXdhaXQgdGhpcy5HZXRCbG9iKCk7CiAgICAgICAgcmV0dXJuIEMzJGpzY29tcCQ3Ny5TdXBwb3J0cy5JbWFnZUJpdG1hcE9wdGlvbnMgPyBhd2FpdCBjcmVhdGVJbWFnZUJpdG1hcChhLCB7CiAgICAgICAgICAgIHByZW11bHRpcGx5QWxwaGE6ICJub25lIgogICAgICAgIH0pIDogQzMkanNjb21wJDc3LlN1cHBvcnRzLkltYWdlQml0bWFwID8gYXdhaXQgY3JlYXRlSW1hZ2VCaXRtYXAoYSkgOiBhd2FpdCBDMyRqc2NvbXAkNzcuQmxvYlRvSW1hZ2UoYSkKICAgIH0KfTsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkNzggPSBzZWxmLkMzOwoKZnVuY3Rpb24gU29ydEJ5SW5zdExhc3RDYWNoZWRaSW5kZXgoYSwgYikgewogICAgcmV0dXJuIGEuR2V0V29ybGRJbmZvKCkuX0dldExhc3RDYWNoZWRaSW5kZXgoKSAtIGIuR2V0V29ybGRJbmZvKCkuX0dldExhc3RDYWNoZWRaSW5kZXgoKQp9CkMzJGpzY29tcCQ3OC5SZW5kZXJDZWxsID0gY2xhc3MgZXh0ZW5kcyBDMyRqc2NvbXAkNzguRGVmZW5kZWRCYXNlIHsKICAgIGNvbnN0cnVjdG9yKGEsIGIsIGQpIHsKICAgICAgICBzdXBlcigpOwogICAgICAgIHRoaXMuX2dyaWQgPSBhOwogICAgICAgIHRoaXMuX3ggPSBiOwogICAgICAgIHRoaXMuX3kgPSBkOwogICAgICAgIHRoaXMuX2luc3RhbmNlcyA9IFtdOwogICAgICAgIHRoaXMuX2lzU29ydGVkID0gITA7CiAgICAgICAgdGhpcy5fcGVuZGluZ1JlbW92YWwgPSBuZXcgU2V0OwogICAgICAgIHRoaXMuX2lzQW55UGVuZGluZ1JlbW92YWwgPSAhMQogICAgfQogICAgUmVsZWFzZSgpIHsKICAgICAgICBDMyRqc2NvbXAkNzguY2xlYXJBcnJheSh0aGlzLl9pbnN0YW5jZXMpOwogICAgICAgIHRoaXMuX3BlbmRpbmdSZW1vdmFsLmNsZWFyKCk7CiAgICAgICAgdGhpcy5fZ3JpZCA9IG51bGwKICAgIH0KICAgIFJlc2V0KCkgewogICAgICAgIEMzJGpzY29tcCQ3OC5jbGVhckFycmF5KHRoaXMuX2luc3RhbmNlcyk7CiAgICAgICAgdGhpcy5faXNTb3J0ZWQgPSAhMDsKICAgICAgICB0aGlzLl9wZW5kaW5nUmVtb3ZhbC5jbGVhcigpOwogICAgICAgIHRoaXMuX2lzQW55UGVuZGluZ1JlbW92YWwgPSAhMQogICAgfQogICAgU2V0Q2hhbmdlZCgpIHsKICAgICAgICB0aGlzLl9pc1NvcnRlZCA9ICExCiAgICB9CiAgICBJc0VtcHR5KCkgewogICAgICAgIGlmICghdGhpcy5faW5zdGFuY2VzLmxlbmd0aCkgcmV0dXJuICEwOwogICAgICAgIGlmICh0aGlzLl9pbnN0YW5jZXMubGVuZ3RoID4gdGhpcy5fcGVuZGluZ1JlbW92YWwuc2l6ZSkgcmV0dXJuICExOwogICAgICAgIHRoaXMuX0ZsdXNoUGVuZGluZygpOwogICAgICAgIHJldHVybiAhMAogICAgfQogICAgSW5zZXJ0KGEpIHsKICAgICAgICB0aGlzLl9wZW5kaW5nUmVtb3ZhbC5oYXMoYSkgPyAodGhpcy5fcGVuZGluZ1JlbW92YWwuZGVsZXRlKGEpLCAwID09PSB0aGlzLl9wZW5kaW5nUmVtb3ZhbC5zaXplICYmICh0aGlzLl9pc0FueVBlbmRpbmdSZW1vdmFsID0gITEpKSA6ICh0aGlzLl9pbnN0YW5jZXMucHVzaChhKSwgdGhpcy5faXNTb3J0ZWQgPSAxID09PSB0aGlzLl9pbnN0YW5jZXMubGVuZ3RoKQogICAgfQogICAgUmVtb3ZlKGEpIHsKICAgICAgICB0aGlzLl9wZW5kaW5nUmVtb3ZhbC5hZGQoYSk7CiAgICAgICAgdGhpcy5faXNBbnlQZW5kaW5nUmVtb3ZhbCA9ICEwOwogICAgICAgIDUwIDw9IHRoaXMuX3BlbmRpbmdSZW1vdmFsLnNpemUgJiYgdGhpcy5fRmx1c2hQZW5kaW5nKCkKICAgIH0KICAgIF9GbHVzaFBlbmRpbmcoKSB7CiAgICAgICAgdGhpcy5faXNBbnlQZW5kaW5nUmVtb3ZhbCAmJiAodGhpcy5faW5zdGFuY2VzLmxlbmd0aCA9PT0gdGhpcy5fcGVuZGluZ1JlbW92YWwuc2l6ZSA/CiAgICAgICAgICAgIHRoaXMuUmVzZXQoKSA6IChDMyRqc2NvbXAkNzguYXJyYXlSZW1vdmVBbGxJblNldCh0aGlzLl9pbnN0YW5jZXMsIHRoaXMuX3BlbmRpbmdSZW1vdmFsKSwgdGhpcy5fcGVuZGluZ1JlbW92YWwuY2xlYXIoKSwgdGhpcy5faXNBbnlQZW5kaW5nUmVtb3ZhbCA9ICExKSkKICAgIH0KICAgIF9FbnN1cmVTb3J0ZWQoKSB7CiAgICAgICAgdGhpcy5faXNTb3J0ZWQgfHwgKHRoaXMuX2luc3RhbmNlcy5zb3J0KFNvcnRCeUluc3RMYXN0Q2FjaGVkWkluZGV4KSwgdGhpcy5faXNTb3J0ZWQgPSAhMCkKICAgIH0KICAgIER1bXAoYSkgewogICAgICAgIHRoaXMuX0ZsdXNoUGVuZGluZygpOwogICAgICAgIHRoaXMuX0Vuc3VyZVNvcnRlZCgpOwogICAgICAgIHRoaXMuX2luc3RhbmNlcy5sZW5ndGggJiYgYS5wdXNoKHRoaXMuX2luc3RhbmNlcykKICAgIH0KfTsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkNzkgPSBzZWxmLkMzOwpDMyRqc2NvbXAkNzkuUmVuZGVyR3JpZCA9IGNsYXNzIGV4dGVuZHMgQzMkanNjb21wJDc5LkRlZmVuZGVkQmFzZSB7CiAgICBjb25zdHJ1Y3RvcihhLCBiKSB7CiAgICAgICAgc3VwZXIoKTsKICAgICAgICB0aGlzLl9jZWxsV2lkdGggPSBhOwogICAgICAgIHRoaXMuX2NlbGxIZWlnaHQgPSBiOwogICAgICAgIHRoaXMuX2NlbGxzID0gQzMkanNjb21wJDc5Lk5ldyhDMyRqc2NvbXAkNzkuUGFpck1hcCkKICAgIH0KICAgIFJlbGVhc2UoKSB7CiAgICAgICAgdGhpcy5fY2VsbHMuUmVsZWFzZSgpOwogICAgICAgIHRoaXMuX2NlbGxzID0gbnVsbAogICAgfQogICAgR2V0Q2VsbChhLCBiLCBkKSB7CiAgICAgICAgbGV0IGMgPSB0aGlzLl9jZWxscy5HZXQoYSwgYik7CiAgICAgICAgcmV0dXJuIGMgPyBjIDogZCA/IChjID0gQzMkanNjb21wJDc5Lk5ldyhDMyRqc2NvbXAkNzkuUmVuZGVyQ2VsbCwgdGhpcywgYSwgYiksIHRoaXMuX2NlbGxzLlNldChhLCBiLCBjKSwgYykgOiBudWxsCiAgICB9CiAgICBYVG9DZWxsKGEpIHsKICAgICAgICByZXR1cm4gTWF0aC5mbG9vcihhIC8gdGhpcy5fY2VsbFdpZHRoKQogICAgfQogICAgWVRvQ2VsbChhKSB7CiAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IoYSAvIHRoaXMuX2NlbGxIZWlnaHQpCiAgICB9CiAgICBVcGRhdGUoYSwgYiwgZCkgewogICAgICAgIGlmIChiKQogICAgICAgICAgICBmb3IgKGxldCBjID0gYi5nZXRMZWZ0KCksCiAgICAgICAgICAgICAgICAgICAgZSA9IGIuZ2V0UmlnaHQoKTsgYyA8PSBlOyArK2MpCiAgICAgICAgICAgICAgICBmb3IgKGxldCBnID0gYi5nZXRUb3AoKSwgayA9IGIuZ2V0Qm90dG9tKCk7IGcgPD0gazsgKytnKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGQgJiYgZC5jb250YWluc1BvaW50KGMsIGcpKSBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBtID0gdGhpcy5HZXRDZWxsKGMsIGcsICExKTsKICAgICAgICAgICAgICAgICAgICBtICYmIChtLlJlbW92ZShhKSwgbS5Jc0VtcHR5KCkgJiYgdGhpcy5fY2VsbHMuRGVsZXRlKGMsIGcpKQogICAgICAgICAgICAgICAgfQogICAgICAgIGlmIChkKQogICAgICAgICAgICBmb3IgKGxldCBjID0gZC5nZXRMZWZ0KCksIGUgPSBkLmdldFJpZ2h0KCk7IGMgPD0gZTsgKytjKQogICAgICAgICAgICAgICAgZm9yIChsZXQgZyA9IGQuZ2V0VG9wKCksIGsgPSBkLmdldEJvdHRvbSgpOyBnIDw9IGs7ICsrZykgYiAmJiBiLmNvbnRhaW5zUG9pbnQoYywgZykgfHwgdGhpcy5HZXRDZWxsKGMsIGcsICEwKS5JbnNlcnQoYSkKICAgIH0KICAgIFF1ZXJ5UmFuZ2UoYSwgYikgewogICAgICAgIGxldCBkID0gdGhpcy5YVG9DZWxsKGEuZ2V0TGVmdCgpKTsKICAgICAgICBjb25zdCBjID0gdGhpcy5ZVG9DZWxsKGEuZ2V0VG9wKCkpLAogICAgICAgICAgICBlID0gdGhpcy5YVG9DZWxsKGEuZ2V0UmlnaHQoKSk7CiAgICAgICAgZm9yIChhID0gdGhpcy5ZVG9DZWxsKGEuZ2V0Qm90dG9tKCkpOyBkIDw9IGU7ICsrZCkKICAgICAgICAgICAgZm9yIChsZXQgZyA9CiAgICAgICAgICAgICAgICAgICAgYzsgZyA8PSBhOyArK2cpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGsgPSB0aGlzLkdldENlbGwoZCwgZywgITEpOwogICAgICAgICAgICAgICAgayAmJiBrLkR1bXAoYikKICAgICAgICAgICAgfQogICAgfQogICAgTWFya1JhbmdlQ2hhbmdlZChhKSB7CiAgICAgICAgbGV0IGIgPSBhLmdldExlZnQoKTsKICAgICAgICBjb25zdCBkID0gYS5nZXRUb3AoKSwKICAgICAgICAgICAgYyA9IGEuZ2V0UmlnaHQoKTsKICAgICAgICBmb3IgKGEgPSBhLmdldEJvdHRvbSgpOyBiIDw9IGM7ICsrYikKICAgICAgICAgICAgZm9yIChsZXQgZSA9IGQ7IGUgPD0gYTsgKytlKSB7CiAgICAgICAgICAgICAgICBjb25zdCBnID0gdGhpcy5HZXRDZWxsKGIsIGUsICExKTsKICAgICAgICAgICAgICAgIGcgJiYgZy5TZXRDaGFuZ2VkKCkKICAgICAgICAgICAgfQogICAgfQp9OwoidXNlIHN0cmljdCI7CmNvbnN0IEMzJGpzY29tcCQ4MCA9IHNlbGYuQzMsCiAgICB0bXBSZWN0JGpzY29tcCQyID0gbmV3IEMzJGpzY29tcCQ4MC5SZWN0LAogICAgdG1wUXVhZCRqc2NvbXAkMiA9IG5ldyBDMyRqc2NvbXAkODAuUXVhZCwKICAgIHJlbmRlckNlbGxBcnIgPSBbXTsKbmV3IEMzJGpzY29tcCQ4MC5SZWN0OwpuZXcgQzMkanNjb21wJDgwLlJlY3Q7CmNvbnN0IGdsTWF0cml4JGpzY29tcCQ4ID0gc2VsZi5nbE1hdHJpeCwKICAgIHZlYzMkanNjb21wJDYgPSBnbE1hdHJpeCRqc2NvbXAkOC52ZWMzLAogICAgdmVjNCRqc2NvbXAkNSA9IGdsTWF0cml4JGpzY29tcCQ4LnZlYzQsCiAgICBtYXQ0JGpzY29tcCQ5ID0gZ2xNYXRyaXgkanNjb21wJDgubWF0NCwKICAgIHRlbXBNYXQ0JGpzY29tcCQ0ID0gbWF0NCRqc2NvbXAkOS5jcmVhdGUoKSwKICAgIHRlbXBWZWMzID0gdmVjMyRqc2NvbXAkNi5jcmVhdGUoKSwKICAgIHRlbXBWZWM0JGpzY29tcCQxID0gdmVjNCRqc2NvbXAkNS5jcmVhdGUoKSwKICAgIGNhbVZlY3RvciA9IHZlYzMkanNjb21wJDYuY3JlYXRlKCksCiAgICBsb29rVmVjdG9yID0gdmVjMyRqc2NvbXAkNi5jcmVhdGUoKSwKICAgIHVwVmVjdG9yID0gdmVjMyRqc2NvbXAkNi5jcmVhdGUoKSwKICAgIHRlbXBWZWMyID0gQzMkanNjb21wJDgwLk5ldyhDMyRqc2NvbXAkODAuVmVjdG9yMik7CkMzJGpzY29tcCQ4MC5OZXcoQzMkanNjb21wJDgwLlJlY3QpOwoKZnVuY3Rpb24gU29ydEJ5SW5zdExhc3RDYWNoZWRaSW5kZXgkanNjb21wJDEoYSwgYikgewogICAgcmV0dXJuIGEuR2V0V29ybGRJbmZvKCkuX0dldExhc3RDYWNoZWRaSW5kZXgoKSAtIGIuR2V0V29ybGRJbmZvKCkuX0dldExhc3RDYWNoZWRaSW5kZXgoKQp9CgpmdW5jdGlvbiBTb3J0QnlJbnN0WkVsZXZhdGlvbihhLCBiKSB7CiAgICByZXR1cm4gYS5HZXRXb3JsZEluZm8oKS5HZXRaRWxldmF0aW9uKCkgLSBiLkdldFdvcmxkSW5mbygpLkdldFpFbGV2YXRpb24oKQp9CmNvbnN0IHRlbXBJbnN0YW5jZUxpc3QxID0gW10sCiAgICB0ZW1wSW5zdGFuY2VMaXN0MiA9IFtdLAogICAgdGVtcEluc3RhbmNlc0J5Q2FtZXJhRGlzdCA9IFtdOwpDMyRqc2NvbXAkODAuTGF5ZXIgPSBjbGFzcyBleHRlbmRzIEMzJGpzY29tcCQ4MC5EZWZlbmRlZEJhc2UgewogICAgY29uc3RydWN0b3IoYSwgYiwgZCkgewogICAgICAgIHN1cGVyKCk7CiAgICAgICAgdGhpcy5fbGF5b3V0ID0gYTsKICAgICAgICB0aGlzLl9ydW50aW1lID0gYS5HZXRSdW50aW1lKCk7CiAgICAgICAgdGhpcy5fcGFyZW50TGF5ZXIgPSBiOwogICAgICAgIHRoaXMuX25hbWUgPSBkWzBdOwogICAgICAgIHRoaXMuX2luZGV4ID0gLTE7CiAgICAgICAgdGhpcy5fc2lkID0gZFsyXTsKICAgICAgICB0aGlzLl9pc1Zpc2libGUgPSAhIWRbM107CiAgICAgICAgdGhpcy5faXNJbnRlcmFjdGl2ZSA9ICEhZFsxM107CiAgICAgICAgdGhpcy5fYmFja2dyb3VuZENvbG9yID0gQzMkanNjb21wJDgwLk5ldyhDMyRqc2NvbXAkODAuQ29sb3IpOwogICAgICAgIHRoaXMuX2JhY2tncm91bmRDb2xvci5zZXRGcm9tSlNPTihkWzRdLm1hcChlID0+IGUgLyAyNTUpKTsKICAgICAgICB0aGlzLl9pc1RyYW5zcGFyZW50ID0gISFkWzVdOwogICAgICAgIHRoaXMuX3BhcmFsbGF4WCA9IGRbNl07CiAgICAgICAgdGhpcy5fcGFyYWxsYXhZID0gZFs3XTsKICAgICAgICB0aGlzLl9jb2xvciA9IEMzJGpzY29tcCQ4MC5OZXcoQzMkanNjb21wJDgwLkNvbG9yLCAxLCAxLCAxLCBkWzhdKTsKICAgICAgICB0aGlzLl9wcmVtdWx0aXBsaWVkQ29sb3IgPQogICAgICAgICAgICBDMyRqc2NvbXAkODAuTmV3KEMzJGpzY29tcCQ4MC5Db2xvcik7CiAgICAgICAgdGhpcy5faXNGb3JjZU93blRleHR1cmUgPSBkWzldOwogICAgICAgIHRoaXMuX3JlbmRlckFzM2QgPSBkWzE3XTsKICAgICAgICB0aGlzLl91c2VDYW1lcmFEaXN0YW5jZURyYXdPcmRlciA9IGRbMThdOwogICAgICAgIHRoaXMuX3VzZVJlbmRlckNlbGxzID0gZFsxMF07CiAgICAgICAgdGhpcy5fc2NhbGVSYXRlID0gZFsxMV07CiAgICAgICAgdGhpcy5fYmxlbmRNb2RlID0gZFsxMl07CiAgICAgICAgdGhpcy5fY3VyUmVuZGVyVGFyZ2V0ID0gbnVsbDsKICAgICAgICB0aGlzLl9zY2FsZSA9IDE7CiAgICAgICAgdGhpcy5fekVsZXZhdGlvbiA9IGRbMTZdOwogICAgICAgIHRoaXMuX3Njcm9sbFkgPSB0aGlzLl9zY3JvbGxYID0gdGhpcy5fYW5nbGUgPSAwOwogICAgICAgIHRoaXMuX2hhc093blNjcm9sbFBvc2l0aW9uID0gITE7CiAgICAgICAgdGhpcy5fdmlld3BvcnQgPSBDMyRqc2NvbXAkODAuTmV3KEMzJGpzY29tcCQ4MC5SZWN0KTsKICAgICAgICB0aGlzLl92aWV3cG9ydFowID0gQzMkanNjb21wJDgwLk5ldyhDMyRqc2NvbXAkODAuUmVjdCk7CiAgICAgICAgdGhpcy5fdmlld3BvcnQzRCA9IEMzJGpzY29tcCQ4MC5OZXcoQzMkanNjb21wJDgwLlJlY3QpOwogICAgICAgIHRoaXMuX2lzVmlld3BvcnRDaGFuZ2VkID0gITA7CiAgICAgICAgdGhpcy5fcHJvamVjdGlvbk1hdHJpeCA9IG1hdDQkanNjb21wJDkuY3JlYXRlKCk7CiAgICAgICAgdGhpcy5faXNQcm9qZWN0aW9uTWF0cml4Q2hhbmdlZCA9ICEwOwogICAgICAgIHRoaXMuX21vZGVsVmlld01hdHJpeCA9IG1hdDQkanNjb21wJDkuY3JlYXRlKCk7CiAgICAgICAgdGhpcy5faXNNVk1hdHJpeENoYW5nZWQgPSAhMDsKICAgICAgICB0aGlzLl92aWV3RnJ1c3R1bSA9IEMzJGpzY29tcCQ4MC5OZXcoQzMkanNjb21wJDgwLkdmeC5WaWV3RnJ1c3R1bSk7CiAgICAgICAgdGhpcy5faXNWaWV3RnJ1c3R1bUNoYW5nZWQgPSAhMDsKICAgICAgICB0aGlzLl9zdGFydHVwSW5pdGlhbEluc3RhbmNlcyA9IFtdOwogICAgICAgIHRoaXMuX2luaXRpYWxJbnN0YW5jZXNEYXRhID0gZFsxNF07CiAgICAgICAgdGhpcy5faW5pdGlhbEluc3RhbmNlcyA9IFtdOwogICAgICAgIHRoaXMuX2NyZWF0ZWRHbG9iYWxVaWRzID0gW107CiAgICAgICAgdGhpcy5faW5pdGlhbFVJRHNUb0luc3RhbmNlRGF0YSA9IG5ldyBNYXA7CiAgICAgICAgdGhpcy5faW5zdGFuY2VzID0gW107CiAgICAgICAgdGhpcy5fYW55SW5zdGFuY2VaRWxldmF0ZWQgPSB0aGlzLl96SW5kaWNlc1VwVG9EYXRlID0gITE7CiAgICAgICAgY29uc3QgYyA9IHRoaXMuX3J1bnRpbWUuR2V0Q2FudmFzTWFuYWdlcigpOwogICAgICAgIHRoaXMuX2VmZmVjdExpc3QgPSBDMyRqc2NvbXAkODAuTmV3KEMzJGpzY29tcCQ4MC5FZmZlY3RMaXN0LCB0aGlzLCBkWzE1XSk7CiAgICAgICAgdGhpcy5fZWZmZWN0Q2hhaW4gPSBDMyRqc2NvbXAkODAuTmV3KEMzJGpzY29tcCQ4MC5HZnguRWZmZWN0Q2hhaW4sIGMuR2V0RWZmZWN0Q2hhaW5NYW5hZ2VyKCksIHsKICAgICAgICAgICAgZHJhd0NvbnRlbnQ6IChlLCBnKSA9PiB7CiAgICAgICAgICAgICAgICBnID0gZy5HZXRDb250ZW50T2JqZWN0KCk7CiAgICAgICAgICAgICAgICBjb25zdCBrID0gZy5HZXRSZW5kZXJUYXJnZXQoKTsKICAgICAgICAgICAgICAgIGUuU2V0Q29sb3IoZy5HZXRQcmVtdWx0aXBsaWVkQ29sb3IoKSk7CiAgICAgICAgICAgICAgICBlLkRyYXdSZW5kZXJUYXJnZXQoayk7CiAgICAgICAgICAgICAgICBlLkludmFsaWRhdGVSZW5kZXJUYXJnZXQoayk7CiAgICAgICAgICAgICAgICBjLlJlbGVhc2VBZGRpdGlvbmFsUmVuZGVyVGFyZ2V0KGspCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGdldFNoYWRlclBhcmFtZXRlcnM6IGUgPT4gdGhpcy5HZXRFZmZlY3RMaXN0KCkuX0dldEVmZmVjdENoYWluU2hhZGVyUGFyYW1ldGVyc0ZvckluZGV4KGUpCiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5fd2FzRGVmYXVsdENvbG9yID0gdGhpcy5fbmVlZHNSZWJ1aWxkRWZmZWN0Q2hhaW5TdGVwcyA9ICEwOwogICAgICAgIHRoaXMuX3JlbmRlckdyaWQgPSBudWxsOwogICAgICAgIHRoaXMuX2xhc3RSZW5kZXJMaXN0ID0gW107CiAgICAgICAgdGhpcy5faXNSZW5kZXJMaXN0VXBUb0RhdGUgPSAhMTsKICAgICAgICB0aGlzLl9sYXN0UmVuZGVyQ2VsbHMgPSBDMyRqc2NvbXAkODAuTmV3KEMzJGpzY29tcCQ4MC5SZWN0LCAwLCAwLCAtMSwgLTEpOwogICAgICAgIHRoaXMuX2N1clJlbmRlckNlbGxzID0gQzMkanNjb21wJDgwLk5ldyhDMyRqc2NvbXAkODAuUmVjdCwgMCwgMCwgLTEsIC0xKTsKICAgICAgICB0aGlzLl9pTGF5ZXIgPSBudWxsOwogICAgICAgIHRoaXMuX1VwZGF0ZVByZW11bHRpcGxpZWRDb2xvcigpOwogICAgICAgIHRoaXMuVXNlc1JlbmRlckNlbGxzKCkgJiYgKHRoaXMuX3JlbmRlckdyaWQgPSBDMyRqc2NvbXAkODAuTmV3KEMzJGpzY29tcCQ4MC5SZW5kZXJHcmlkLCB0aGlzLl9ydW50aW1lLkdldE9yaWdpbmFsVmlld3BvcnRXaWR0aCgpLCB0aGlzLl9ydW50aW1lLkdldE9yaWdpbmFsVmlld3BvcnRIZWlnaHQoKSkpOwogICAgICAgIHRoaXMuX3N1YkxheWVycyA9IGRbMTldLm1hcChlID0+IEMzJGpzY29tcCQ4MC5OZXcoQzMkanNjb21wJDgwLkxheWVyLCB0aGlzLl9sYXlvdXQsCiAgICAgICAgICAgIHRoaXMsIGUpKQogICAgfQogICAgX0luaXQoKSB7CiAgICAgICAgZm9yIChjb25zdCBhIG9mIHRoaXMuX2luaXRpYWxJbnN0YW5jZXNEYXRhKSB7CiAgICAgICAgICAgIGNvbnN0IGIgPSB0aGlzLl9ydW50aW1lLkdldE9iamVjdENsYXNzQnlJbmRleChhWzFdKTsKICAgICAgICAgICAgdGhpcy5fbGF5b3V0Ll9BZGRJbml0aWFsT2JqZWN0Q2xhc3MoYik7CiAgICAgICAgICAgIGIuR2V0RGVmYXVsdEluc3RhbmNlRGF0YSgpIHx8IChiLlNldERlZmF1bHRJbnN0YW5jZURhdGEoYSksIGIuX1NldERlZmF1bHRMYXllckluZGV4KHRoaXMuX2luZGV4KSk7CiAgICAgICAgICAgIHRoaXMuX2luaXRpYWxJbnN0YW5jZXMucHVzaChhKTsKICAgICAgICAgICAgdGhpcy5faW5pdGlhbFVJRHNUb0luc3RhbmNlRGF0YS5zZXQoYVsyXSwgYSkKICAgICAgICB9CiAgICAgICAgQzMkanNjb21wJDgwLnNoYWxsb3dBc3NpZ25BcnJheSh0aGlzLl9zdGFydHVwSW5pdGlhbEluc3RhbmNlcywgdGhpcy5faW5pdGlhbEluc3RhbmNlcyk7CiAgICAgICAgdGhpcy5faW5pdGlhbEluc3RhbmNlc0RhdGEgPSBudWxsOwogICAgICAgIHRoaXMuX2lMYXllciA9IG5ldyBzZWxmLklMYXllcih0aGlzKQogICAgfQogICAgUmVsZWFzZSgpIHsKICAgICAgICB0aGlzLl9ydW50aW1lID0gdGhpcy5fbGF5b3V0ID0KICAgICAgICAgICAgbnVsbAogICAgfQogICAgR2V0SW5pdGlhbEluc3RhbmNlRGF0YShhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2luaXRpYWxVSURzVG9JbnN0YW5jZURhdGEuZ2V0KGEpCiAgICB9CiAgICBDcmVhdGVJbml0aWFsSW5zdGFuY2VzKGEpIHsKICAgICAgICBjb25zdCBiID0gdGhpcy5fbGF5b3V0LklzRmlyc3RWaXNpdCgpOwogICAgICAgIGxldCBkID0gMDsKICAgICAgICBjb25zdCBjID0gdGhpcy5faW5pdGlhbEluc3RhbmNlczsKICAgICAgICBmb3IgKGxldCBnID0gMCwgayA9IGMubGVuZ3RoOyBnIDwgazsgKytnKSB7CiAgICAgICAgICAgIHZhciBlID0gY1tnXTsKICAgICAgICAgICAgY29uc3QgbSA9IHRoaXMuX3J1bnRpbWUuR2V0T2JqZWN0Q2xhc3NCeUluZGV4KGVbMV0pOwogICAgICAgICAgICBsZXQgbiA9ICEwOwogICAgICAgICAgICBpZiAoIW0uSGFzUGVyc2lzdEJlaGF2aW9yKCkgfHwgYikgZSA9IHRoaXMuX3J1bnRpbWUuQ3JlYXRlSW5zdGFuY2VGcm9tRGF0YShlLCB0aGlzLCAhMCksIGEucHVzaChlKSwgbS5Jc0dsb2JhbCgpICYmIChuID0gITEsIHRoaXMuX2NyZWF0ZWRHbG9iYWxVaWRzLnB1c2goZS5HZXRVSUQoKSkpOwogICAgICAgICAgICBuICYmIChjW2RdID0gY1tnXSwgKytkKQogICAgICAgIH0KICAgICAgICBDMyRqc2NvbXAkODAudHJ1bmNhdGVBcnJheShjLCBkKTsKICAgICAgICB0aGlzLl9ydW50aW1lLkZsdXNoUGVuZGluZ0luc3RhbmNlcygpOwogICAgICAgIHRoaXMuU2V0WkluZGljZXNDaGFuZ2VkKCkKICAgIH0KICAgIF9BZGRJbnN0YW5jZShhLCBiKSB7CiAgICAgICAgaWYgKCFhLkdldFBsdWdpbigpLklzV29ybGRUeXBlKCkpIHRocm93IEVycm9yKCJpbnN0YW5jZSBpcyBub3Qgb2Ygd29ybGQgdHlwZSIpOwogICAgICAgIGNvbnN0IGQgPSBhLkdldFdvcmxkSW5mbygpOwogICAgICAgIGlmIChkLkdldExheWVyKCkgIT09IHRoaXMpIHRocm93IEVycm9yKCJpbnN0YW5jZSBhZGRlZCB0byB3cm9uZyBsYXllciIpOwogICAgICAgIHRoaXMuX2luc3RhbmNlcy5wdXNoKGEpOwogICAgICAgIDAgIT09IGQuR2V0WkVsZXZhdGlvbigpICYmICh0aGlzLl9hbnlJbnN0YW5jZVpFbGV2YXRlZCA9ICEwKTsKICAgICAgICBiICYmIHRoaXMuVXNlc1JlbmRlckNlbGxzKCkgJiYgYS5HZXRXb3JsZEluZm8oKS5TZXRCYm94Q2hhbmdlZCgpOwogICAgICAgIHRoaXMuU2V0WkluZGljZXNDaGFuZ2VkKCkKICAgIH0KICAgIF9NYXliZUFkZEluc3RhbmNlKGEpIHsKICAgICAgICB0aGlzLl9pbnN0YW5jZXMuaW5jbHVkZXMoYSkgfHwgKHRoaXMuX2luc3RhbmNlcy5wdXNoKGEpLCAwICE9PSBhLkdldFdvcmxkSW5mbygpLkdldFpFbGV2YXRpb24oKSAmJiAodGhpcy5fYW55SW5zdGFuY2VaRWxldmF0ZWQgPSAhMCksIHRoaXMuU2V0WkluZGljZXNDaGFuZ2VkKCkpCiAgICB9CiAgICBfUHJlcGVuZEluc3RhbmNlKGEsIGIpIHsKICAgICAgICBjb25zdCBkID0gYS5HZXRXb3JsZEluZm8oKTsKICAgICAgICBpZiAoZC5HZXRMYXllcigpICE9PSB0aGlzKSB0aHJvdyBFcnJvcigiaW5zdGFuY2UgYWRkZWQgdG8gd3JvbmcgbGF5ZXIiKTsKICAgICAgICB0aGlzLl9pbnN0YW5jZXMudW5zaGlmdChhKTsKICAgICAgICAwICE9PSBkLkdldFpFbGV2YXRpb24oKSAmJiAodGhpcy5fYW55SW5zdGFuY2VaRWxldmF0ZWQgPSAhMCk7CiAgICAgICAgdGhpcy5TZXRaSW5kaWNlc0NoYW5nZWQoKTsKICAgICAgICBiICYmIHRoaXMuVXNlc1JlbmRlckNlbGxzKCkgJiYgYS5HZXRXb3JsZEluZm8oKS5TZXRCYm94Q2hhbmdlZCgpCiAgICB9CiAgICBfUmVtb3ZlSW5zdGFuY2UoYSwgYikgewogICAgICAgIGNvbnN0IGQgPSB0aGlzLl9pbnN0YW5jZXMuaW5kZXhPZihhKTsKICAgICAgICAwID4gZCB8fCAoYiAmJiB0aGlzLlVzZXNSZW5kZXJDZWxscygpICYmIGEuR2V0V29ybGRJbmZvKCkuX1JlbW92ZUZyb21SZW5kZXJDZWxscygpLCB0aGlzLl9pbnN0YW5jZXMuc3BsaWNlKGQsIDEpLCB0aGlzLlNldFpJbmRpY2VzQ2hhbmdlZCgpLCB0aGlzLl9NYXliZVJlc2V0QW55SW5zdGFuY2VaRWxldmF0ZWRGbGFnKCkpCiAgICB9CiAgICBfU2V0QW55SW5zdGFuY2VaRWxldmF0ZWQoKSB7CiAgICAgICAgdGhpcy5fYW55SW5zdGFuY2VaRWxldmF0ZWQgPSAhMAogICAgfQogICAgX01heWJlUmVzZXRBbnlJbnN0YW5jZVpFbGV2YXRlZEZsYWcoKSB7CiAgICAgICAgMCA9PT0gdGhpcy5faW5zdGFuY2VzLmxlbmd0aCAmJiAodGhpcy5fYW55SW5zdGFuY2VaRWxldmF0ZWQgPSAhMSkKICAgIH0KICAgIF9Tb3J0SW5zdGFuY2VzQnlMYXN0Q2FjaGVkWkluZGV4KGEpIHsKICAgICAgICBpZiAoYSkgewogICAgICAgICAgICBhID0gbmV3IFNldDsKICAgICAgICAgICAgZm9yICh2YXIgYiBvZiB0aGlzLl9pbnN0YW5jZXMpIHsKICAgICAgICAgICAgICAgIHZhciBkID0gYi5HZXRXb3JsZEluZm8oKS5fR2V0TGFzdENhY2hlZFpJbmRleCgpOwogICAgICAgICAgICAgICAgMCA8PSBkICYmIGEuYWRkKGQpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgYiA9IC0xOwogICAgICAgICAgICBmb3IgKGNvbnN0IGMgb2YgdGhpcy5faW5zdGFuY2VzKQogICAgICAgICAgICAgICAgaWYgKGQgPSBjLkdldFdvcmxkSW5mbygpLCAhKDAgPD0gZC5fR2V0TGFzdENhY2hlZFpJbmRleCgpKSkgewogICAgICAgICAgICAgICAgICAgIGZvciAoKytiOyBhLmhhcyhiKTspICsrYjsKICAgICAgICAgICAgICAgICAgICBkLl9TZXRaSW5kZXgoYikKICAgICAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdGhpcy5faW5zdGFuY2VzLnNvcnQoU29ydEJ5SW5zdExhc3RDYWNoZWRaSW5kZXgkanNjb21wJDEpCiAgICB9CiAgICBfU3RhcnQoKSB7fQogICAgX0VuZCgpIHsKICAgICAgICBmb3IgKGNvbnN0IGEgb2YgdGhpcy5faW5zdGFuY2VzKSBhLkdldE9iamVjdENsYXNzKCkuSXNHbG9iYWwoKSB8fAogICAgICAgICAgICB0aGlzLl9ydW50aW1lLkRlc3Ryb3lJbnN0YW5jZShhKTsKICAgICAgICB0aGlzLl9ydW50aW1lLkZsdXNoUGVuZGluZ0luc3RhbmNlcygpOwogICAgICAgIEMzJGpzY29tcCQ4MC5jbGVhckFycmF5KHRoaXMuX2luc3RhbmNlcyk7CiAgICAgICAgdGhpcy5fYW55SW5zdGFuY2VaRWxldmF0ZWQgPSAhMTsKICAgICAgICB0aGlzLlNldFpJbmRpY2VzQ2hhbmdlZCgpCiAgICB9CiAgICBSZWNyZWF0ZUluaXRpYWxPYmplY3RzKGEsIGIsIGQsIGMsIGUpIHsKICAgICAgICBjb25zdCBnID0gdGhpcy5fcnVudGltZS5HZXRFdmVudFNoZWV0TWFuYWdlcigpLAogICAgICAgICAgICBrID0gdGhpcy5fcnVudGltZS5HZXRBbGxPYmplY3RDbGFzc2VzKCksCiAgICAgICAgICAgIG0gPSBhLklzRmFtaWx5KCksCiAgICAgICAgICAgIG4gPSBbXTsKICAgICAgICBmb3IgKGNvbnN0IHcgb2YgdGhpcy5faW5pdGlhbEluc3RhbmNlcykgewogICAgICAgICAgICB2YXIgcSA9IHdbMF07CiAgICAgICAgICAgIGlmIChiLmNvbnRhaW5zUG9pbnQocVswXSwgcVsxXSkpIHsKICAgICAgICAgICAgICAgIHEgPSBrW3dbMV1dOwogICAgICAgICAgICAgICAgaWYgKHEgIT09IGEpCiAgICAgICAgICAgICAgICAgICAgaWYgKG0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFhLkZhbWlseUhhc01lbWJlcihxKSkgY29udGludWUKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgY29udGludWU7CiAgICAgICAgICAgICAgICBxID0gdGhpczsKICAgICAgICAgICAgICAgIHZhciB1ID0gdGhpcy5fcnVudGltZS5HZXRDdXJyZW50TGF5b3V0KCk7CiAgICAgICAgICAgICAgICB0aGlzLkdldExheW91dCgpICE9PSB1ICYmICgocSA9IHUuR2V0TGF5ZXJCeU5hbWUodGhpcy5HZXROYW1lKCkpKSB8fCAocSA9IHUuR2V0TGF5ZXJCeUluZGV4KHRoaXMuR2V0SW5kZXgoKSkpKTsKICAgICAgICAgICAgICAgIHUgPSB0aGlzLl9ydW50aW1lLkNyZWF0ZUluc3RhbmNlRnJvbURhdGEodywgcSwgITEsIHZvaWQgMCwgdm9pZCAwLCAhMSwgZSk7CiAgICAgICAgICAgICAgICBxLlNvcnRBbmRBZGRJbnN0YW5jZXNCeVpJbmRleCh1KTsKICAgICAgICAgICAgICAgIHEgPSB1LkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICAgICAgcS5PZmZzZXRYWShkLCBjKTsKICAgICAgICAgICAgICAgIHEuU2V0QmJveENoYW5nZWQoKTsKICAgICAgICAgICAgICAgIGcuQmxvY2tGbHVzaGluZ0luc3RhbmNlcyghMCk7CiAgICAgICAgICAgICAgICB1Ll9UcmlnZ2VyT25DcmVhdGVkT25TZWxmQW5kUmVsYXRlZCgpOwogICAgICAgICAgICAgICAgZy5CbG9ja0ZsdXNoaW5nSW5zdGFuY2VzKCExKTsKICAgICAgICAgICAgICAgIG4ucHVzaCh1KQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBuCiAgICB9CiAgICBHZXRJbnN0YW5jZUNvdW50KCkgewogICAgICAgIHJldHVybiB0aGlzLl9pbnN0YW5jZXMubGVuZ3RoCiAgICB9CiAgICBHZXRMYXlvdXQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2xheW91dAogICAgfQogICAgR2V0TmFtZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fbmFtZQogICAgfQogICAgX1NldEluZGV4KGEpIHsKICAgICAgICB0aGlzLl9pbmRleCA9CiAgICAgICAgICAgIGEKICAgIH0KICAgIEdldEluZGV4KCkgewogICAgICAgIHJldHVybiB0aGlzLl9pbmRleAogICAgfQogICAgR2V0U0lEKCkgewogICAgICAgIHJldHVybiB0aGlzLl9zaWQKICAgIH0KICAgIEdldFJ1bnRpbWUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUKICAgIH0KICAgIEdldERldmljZVBpeGVsUmF0aW8oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUuR2V0RGV2aWNlUGl4ZWxSYXRpbygpCiAgICB9CiAgICBHZXRFZmZlY3RMaXN0KCkgewogICAgICAgIHJldHVybiB0aGlzLl9lZmZlY3RMaXN0CiAgICB9CiAgICBHZXRFZmZlY3RDaGFpbigpIHsKICAgICAgICB0aGlzLl9NYXliZVJlYnVpbGRFZmZlY3RDaGFpblN0ZXBzKCk7CiAgICAgICAgcmV0dXJuIHRoaXMuX2VmZmVjdENoYWluCiAgICB9CiAgICBfTWF5YmVSZWJ1aWxkRWZmZWN0Q2hhaW5TdGVwcygpIHsKICAgICAgICBjb25zdCBhID0gdGhpcy5IYXNEZWZhdWx0Q29sb3IoKTsKICAgICAgICBpZiAodGhpcy5fbmVlZHNSZWJ1aWxkRWZmZWN0Q2hhaW5TdGVwcyB8fCBhICE9PSB0aGlzLl93YXNEZWZhdWx0Q29sb3IpIHsKICAgICAgICAgICAgdmFyIGIgPSB0aGlzLkdldEVmZmVjdExpc3QoKS5HZXRBY3RpdmVFZmZlY3RUeXBlcygpOwogICAgICAgICAgICB0aGlzLl9lZmZlY3RDaGFpbi5CdWlsZFN0ZXBzKGIubWFwKGQgPT4gZC5HZXRTaGFkZXJQcm9ncmFtKCkpLCB7CiAgICAgICAgICAgICAgICBpbmRleE1hcDogYi5tYXAoZCA9PiBkLkdldEluZGV4KCkpLAogICAgICAgICAgICAgICAgZm9yY2VQcmVEcmF3OiAhYSwKICAgICAgICAgICAgICAgIHVzZUZ1bGxTdXJmYWNlOiAhMAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdGhpcy5fbmVlZHNSZWJ1aWxkRWZmZWN0Q2hhaW5TdGVwcyA9ICExOwogICAgICAgICAgICB0aGlzLl93YXNEZWZhdWx0Q29sb3IgPSBhCiAgICAgICAgfQogICAgfQogICAgVXBkYXRlQWN0aXZlRWZmZWN0cygpIHsKICAgICAgICB0aGlzLkdldEVmZmVjdExpc3QoKS5VcGRhdGVBY3RpdmVFZmZlY3RzKCk7CiAgICAgICAgdGhpcy5fbmVlZHNSZWJ1aWxkRWZmZWN0Q2hhaW5TdGVwcyA9ICEwCiAgICB9CiAgICBVc2VzUmVuZGVyQ2VsbHMoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3VzZVJlbmRlckNlbGxzICYmICF0aGlzLl91c2VDYW1lcmFEaXN0YW5jZURyYXdPcmRlcgogICAgfQogICAgR2V0UmVuZGVyR3JpZCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcmVuZGVyR3JpZAogICAgfQogICAgU2V0UmVuZGVyTGlzdFN0YWxlKCkgewogICAgICAgIHRoaXMuX2lzUmVuZGVyTGlzdFVwVG9EYXRlID0gITEKICAgIH0KICAgIElzVmlzaWJsZSgpIHsKICAgICAgICBmb3IgKGNvbnN0IGEgb2YgdGhpcy5zZWxmQW5kUGFyZW50TGF5ZXJzKCkpCiAgICAgICAgICAgIGlmICghYS5fSXNWaXNpYmxlRmxhZ1NldCgpKSByZXR1cm4gITE7CiAgICAgICAgcmV0dXJuICEwCiAgICB9CiAgICBfSXNWaXNpYmxlRmxhZ1NldCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5faXNWaXNpYmxlCiAgICB9CiAgICBTZXRWaXNpYmxlKGEpIHsKICAgICAgICBhID0gISFhOwogICAgICAgIHRoaXMuX2lzVmlzaWJsZSAhPT0gYSAmJiAodGhpcy5faXNWaXNpYmxlID0gYSwgdGhpcy5fcnVudGltZS5VcGRhdGVSZW5kZXIoKSkKICAgIH0KICAgIFNldEludGVyYWN0aXZlKGEpIHsKICAgICAgICB0aGlzLl9pc0ludGVyYWN0aXZlID0gISFhCiAgICB9CiAgICBJc0ludGVyYWN0aXZlKCkgewogICAgICAgIHJldHVybiB0aGlzLl9pc0ludGVyYWN0aXZlCiAgICB9CiAgICBJc1NlbGZBbmRQYXJlbnRzSW50ZXJhY3RpdmUoKSB7CiAgICAgICAgZm9yIChjb25zdCBhIG9mIHRoaXMuc2VsZkFuZFBhcmVudExheWVycygpKQogICAgICAgICAgICBpZiAoIWEuSXNJbnRlcmFjdGl2ZSgpKSByZXR1cm4gITE7CiAgICAgICAgcmV0dXJuICEwCiAgICB9CiAgICBTZXRPd25TY3JvbGxQb3NpdGlvbkVuYWJsZWQoYSkgewogICAgICAgIGEgPSAhIWE7CiAgICAgICAgaWYgKHRoaXMuX2hhc093blNjcm9sbFBvc2l0aW9uICE9PSBhKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9oYXNPd25TY3JvbGxQb3NpdGlvbiA9IGEpIGEgPSB0aGlzLkdldExheW91dCgpLCB0aGlzLl9zY3JvbGxYID0gYS5HZXRTY3JvbGxYKCksIHRoaXMuX3Njcm9sbFkgPSBhLkdldFNjcm9sbFkoKTsKICAgICAgICAgICAgdGhpcy5fU2V0TVZNYXRyaXhDaGFuZ2VkKCk7CiAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuVXBkYXRlUmVuZGVyKCkKICAgICAgICB9CiAgICB9CiAgICBJc093blNjcm9sbFBvc2l0aW9uRW5hYmxlZCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5faGFzT3duU2Nyb2xsUG9zaXRpb24KICAgIH0KICAgIFNldFNjcm9sbFgoYSkgewogICAgICAgIHZhciBiID0KICAgICAgICAgICAgdGhpcy5HZXRMYXlvdXQoKTsKICAgICAgICBjb25zdCBkID0gYi5HZXRTY3JvbGxMZWZ0Qm91bmQoKTsKICAgICAgICBiID0gYi5HZXRTY3JvbGxSaWdodEJvdW5kKCk7CiAgICAgICAgYSA+IGIgJiYgKGEgPSBiKTsKICAgICAgICBhIDwgZCAmJiAoYSA9IGQpOwogICAgICAgIHRoaXMuX3Njcm9sbFggIT09IGEgJiYgKHRoaXMuX3Njcm9sbFggPSBhLCB0aGlzLklzT3duU2Nyb2xsUG9zaXRpb25FbmFibGVkKCkgJiYgKHRoaXMuX1NldE1WTWF0cml4Q2hhbmdlZCgpLCB0aGlzLl9ydW50aW1lLlVwZGF0ZVJlbmRlcigpKSkKICAgIH0KICAgIFNldFNjcm9sbFkoYSkgewogICAgICAgIHZhciBiID0gdGhpcy5HZXRMYXlvdXQoKTsKICAgICAgICBjb25zdCBkID0gYi5HZXRTY3JvbGxUb3BCb3VuZCgpOwogICAgICAgIGIgPSBiLkdldFNjcm9sbEJvdHRvbUJvdW5kKCk7CiAgICAgICAgYSA+IGIgJiYgKGEgPSBiKTsKICAgICAgICBhIDwgZCAmJiAoYSA9IGQpOwogICAgICAgIHRoaXMuX3Njcm9sbFkgIT09IGEgJiYgKHRoaXMuX3Njcm9sbFkgPSBhLCB0aGlzLklzT3duU2Nyb2xsUG9zaXRpb25FbmFibGVkKCkgJiYgKHRoaXMuX1NldE1WTWF0cml4Q2hhbmdlZCgpLCB0aGlzLl9ydW50aW1lLlVwZGF0ZVJlbmRlcigpKSkKICAgIH0KICAgIEdldFNjcm9sbFgoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuSXNPd25TY3JvbGxQb3NpdGlvbkVuYWJsZWQoKSA/CiAgICAgICAgICAgIHRoaXMuX3Njcm9sbFggOiB0aGlzLkdldExheW91dCgpLkdldFNjcm9sbFgoKQogICAgfQogICAgR2V0U2Nyb2xsWSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5Jc093blNjcm9sbFBvc2l0aW9uRW5hYmxlZCgpID8gdGhpcy5fc2Nyb2xsWSA6IHRoaXMuR2V0TGF5b3V0KCkuR2V0U2Nyb2xsWSgpCiAgICB9CiAgICBHZXRWaWV3cG9ydCgpIHsKICAgICAgICB0aGlzLl9NYXliZVVwZGF0ZVZpZXdwb3J0KCk7CiAgICAgICAgcmV0dXJuIHRoaXMuX3ZpZXdwb3J0CiAgICB9CiAgICBfR2V0Vmlld3BvcnRaMCgpIHsKICAgICAgICB0aGlzLl9NYXliZVVwZGF0ZVZpZXdwb3J0KCk7CiAgICAgICAgcmV0dXJuIHRoaXMuX3ZpZXdwb3J0WjAKICAgIH0KICAgIEdldFZpZXdwb3J0M0QoKSB7CiAgICAgICAgdGhpcy5fTWF5YmVVcGRhdGVWaWV3cG9ydCgpOwogICAgICAgIHJldHVybiB0aGlzLl92aWV3cG9ydDNECiAgICB9CiAgICBfR2V0VmFuaXNoaW5nUG9pbnQoKSB7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuR2V0TGF5b3V0KCk7CiAgICAgICAgcmV0dXJuIFthLkdldFZhbmlzaGluZ1BvaW50WCgpLCBhLkdldFZhbmlzaGluZ1BvaW50WSgpXQogICAgfQogICAgR2V0RGVmYXVsdENhbWVyYVooYSkgewogICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lLkdldERlZmF1bHRDYW1lcmFaKGEpCiAgICB9CiAgICBHZXRWaWV3cG9ydEZvclooYSwKICAgICAgICBiKSB7CiAgICAgICAgdmFyIGQgPSB0aGlzLl9HZXRWaWV3cG9ydFowKCk7CiAgICAgICAgaWYgKDAgPT09IGEpIGIuY29weShkKTsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgbGV0IGsgPSBkLm1pZFgoKSwKICAgICAgICAgICAgICAgIG0gPSBkLm1pZFkoKTsKICAgICAgICAgICAgdmFyIGMgPSB0aGlzLkdldDJEU2NhbGVGYWN0b3JUb1ooYSk7CiAgICAgICAgICAgIGNvbnN0IG4gPSBkLndpZHRoKCkgLyBjOwogICAgICAgICAgICBkID0gZC5oZWlnaHQoKSAvIGM7CiAgICAgICAgICAgIGNvbnN0IFtxLCB1XSA9IHRoaXMuX0dldFZhbmlzaGluZ1BvaW50KCk7CiAgICAgICAgICAgIGlmICguNSAhPT0gcSB8fCAuNSAhPT0gdSkgewogICAgICAgICAgICAgICAgY29uc3QgdyA9IHRoaXMuR2V0Q2FtZXJhWigpOwogICAgICAgICAgICAgICAgdmFyIGUgPSB0aGlzLl9ydW50aW1lLAogICAgICAgICAgICAgICAgICAgIGcgPSB0aGlzLkdldERlZmF1bHRDYW1lcmFaKCkgLyB3OwogICAgICAgICAgICAgICAgYyA9IChxIC0gLjUpICogZS5HZXRWaWV3cG9ydFdpZHRoKCkgLyBnOwogICAgICAgICAgICAgICAgZSA9ICh1IC0gLjUpICogZS5HZXRWaWV3cG9ydEhlaWdodCgpIC8gZzsKICAgICAgICAgICAgICAgIGcgPSB0aGlzLkdldEFuZ2xlKCk7CiAgICAgICAgICAgICAgICAwICE9PSBnICYmICh0ZW1wVmVjMi5zZXQoYywgZSksIHRlbXBWZWMyLnJvdGF0ZShnKSwgYyA9IHRlbXBWZWMyLmdldFgoKSwgZSA9IHRlbXBWZWMyLmdldFkoKSk7CiAgICAgICAgICAgICAgICBhID0gQzMkanNjb21wJDgwLnVubGVycCh3LCAwLCBhKTsKICAgICAgICAgICAgICAgIGsgKz0gQzMkanNjb21wJDgwLmxlcnAoYywgMCwKICAgICAgICAgICAgICAgICAgICBhKTsKICAgICAgICAgICAgICAgIG0gKz0gQzMkanNjb21wJDgwLmxlcnAoZSwgMCwgYSkKICAgICAgICAgICAgfQogICAgICAgICAgICBiLnNldChrIC0gbiAvIDIsIG0gLSBkIC8gMiwgayArIG4gLyAyLCBtICsgZCAvIDIpCiAgICAgICAgfQogICAgfQogICAgR2V0T3BhY2l0eSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fY29sb3IuZ2V0QSgpCiAgICB9CiAgICBTZXRPcGFjaXR5KGEpIHsKICAgICAgICBhID0gQzMkanNjb21wJDgwLmNsYW1wKGEsIDAsIDEpOwogICAgICAgIHRoaXMuX2NvbG9yLmdldEEoKSAhPT0gYSAmJiAodGhpcy5fY29sb3Iuc2V0QShhKSwgdGhpcy5fVXBkYXRlUHJlbXVsdGlwbGllZENvbG9yKCksIHRoaXMuX3J1bnRpbWUuVXBkYXRlUmVuZGVyKCkpCiAgICB9CiAgICBfVXBkYXRlUHJlbXVsdGlwbGllZENvbG9yKCkgewogICAgICAgIHRoaXMuX3ByZW11bHRpcGxpZWRDb2xvci5jb3B5KHRoaXMuX2NvbG9yKTsKICAgICAgICB0aGlzLl9wcmVtdWx0aXBsaWVkQ29sb3IucHJlbXVsdGlwbHkoKQogICAgfQogICAgR2V0UHJlbXVsdGlwbGllZENvbG9yKCkgewogICAgICAgIHJldHVybiB0aGlzLl9wcmVtdWx0aXBsaWVkQ29sb3IKICAgIH0KICAgIEhhc0RlZmF1bHRDb2xvcigpIHsKICAgICAgICByZXR1cm4gdGhpcy5fY29sb3IuZXF1YWxzUmdiYSgxLCAxLCAxLCAxKQogICAgfQogICAgR2V0U2NhbGVSYXRlKCkgewogICAgICAgIHJldHVybiB0aGlzLl9zY2FsZVJhdGUKICAgIH0KICAgIFNldFNjYWxlUmF0ZShhKSB7CiAgICAgICAgdGhpcy5fc2NhbGVSYXRlICE9PQogICAgICAgICAgICBhICYmICh0aGlzLl9zY2FsZVJhdGUgPSBhLCB0aGlzLl9TZXRNVk1hdHJpeENoYW5nZWQoKSwgdGhpcy5fcnVudGltZS5VcGRhdGVSZW5kZXIoKSkKICAgIH0KICAgIEdldFBhcmFsbGF4WCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcGFyYWxsYXhYCiAgICB9CiAgICBHZXRQYXJhbGxheFkoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3BhcmFsbGF4WQogICAgfQogICAgU2V0UGFyYWxsYXgoYSwgYikgewogICAgICAgIGlmICh0aGlzLl9wYXJhbGxheFggIT09IGEgfHwgdGhpcy5fcGFyYWxsYXhZICE9PSBiKQogICAgICAgICAgICBpZiAodGhpcy5fcGFyYWxsYXhYID0gYSwgdGhpcy5fcGFyYWxsYXhZID0gYiwgdGhpcy5fU2V0TVZNYXRyaXhDaGFuZ2VkKCksIHRoaXMuX3J1bnRpbWUuVXBkYXRlUmVuZGVyKCksIDEgIT09IHRoaXMuX3BhcmFsbGF4WCB8fCAxICE9PSB0aGlzLl9wYXJhbGxheFkpCiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGQgb2YgdGhpcy5faW5zdGFuY2VzKSBkLkdldE9iamVjdENsYXNzKCkuX1NldEFueUluc3RhbmNlUGFyYWxsYXhlZCghMCkKICAgIH0KICAgIFNldFBhcmFsbGF4WChhKSB7CiAgICAgICAgdGhpcy5TZXRQYXJhbGxheChhLCB0aGlzLkdldFBhcmFsbGF4WSgpKQogICAgfQogICAgU2V0UGFyYWxsYXhZKGEpIHsKICAgICAgICB0aGlzLlNldFBhcmFsbGF4KHRoaXMuR2V0UGFyYWxsYXhYKCksCiAgICAgICAgICAgIGEpCiAgICB9CiAgICBTZXRaRWxldmF0aW9uKGEpIHsKICAgICAgICB0aGlzLl96RWxldmF0aW9uICE9PSBhICYmICh0aGlzLl96RWxldmF0aW9uID0gYSwgdGhpcy5fcnVudGltZS5VcGRhdGVSZW5kZXIoKSkKICAgIH0KICAgIEdldFpFbGV2YXRpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3pFbGV2YXRpb24KICAgIH0KICAgIFNldEFuZ2xlKGEpIHsKICAgICAgICBhID0gQzMkanNjb21wJDgwLmNsYW1wQW5nbGUoYSk7CiAgICAgICAgdGhpcy5fYW5nbGUgIT09IGEgJiYgKHRoaXMuX2FuZ2xlID0gYSwgdGhpcy5fU2V0TVZNYXRyaXhDaGFuZ2VkKCksIHRoaXMuX3J1bnRpbWUuVXBkYXRlUmVuZGVyKCkpCiAgICB9CiAgICBHZXRBbmdsZSgpIHsKICAgICAgICByZXR1cm4gQzMkanNjb21wJDgwLmNsYW1wQW5nbGUodGhpcy5fbGF5b3V0LkdldEFuZ2xlKCkgKyB0aGlzLl9hbmdsZSkKICAgIH0KICAgIEdldE93bkFuZ2xlKCkgewogICAgICAgIHJldHVybiB0aGlzLl9hbmdsZQogICAgfQogICAgSGFzSW5zdGFuY2VzKCkgewogICAgICAgIHJldHVybiAwIDwgdGhpcy5faW5zdGFuY2VzLmxlbmd0aAogICAgfQogICAgX0dldEluc3RhbmNlcygpIHsKICAgICAgICByZXR1cm4gdGhpcy5faW5zdGFuY2VzCiAgICB9CiAgICBfR2V0SW5zdGFuY2VzSW5EcmF3T3JkZXIoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuUmVuZGVyc0luM0RNb2RlKCkgJiYKICAgICAgICAgICAgdGhpcy5fdXNlQ2FtZXJhRGlzdGFuY2VEcmF3T3JkZXIgPyAoQzMkanNjb21wJDgwLnNoYWxsb3dBc3NpZ25BcnJheSh0ZW1wSW5zdGFuY2VzQnlDYW1lcmFEaXN0LCB0aGlzLl9HZXRJbnN0YW5jZXMoKSksIHRlbXBJbnN0YW5jZXNCeUNhbWVyYURpc3Quc29ydCgoYSwgYikgPT4gdGhpcy5fU29ydEluc3RhbmNlc0J5Q2FtZXJhRGlzdGFuY2UoYSwgYikpLCB0ZW1wSW5zdGFuY2VzQnlDYW1lcmFEaXN0KSA6IHRoaXMuX0dldEluc3RhbmNlcygpCiAgICB9CiAgICBfQXBwZW5kQWxsSW5zdGFuY2VzSW5jbHVkaW5nU3ViTGF5ZXJzSW5EcmF3T3JkZXIoYSkgewogICAgICAgIEMzJGpzY29tcCQ4MC5hcHBlbmRBcnJheShhLCB0aGlzLl9HZXRJbnN0YW5jZXNJbkRyYXdPcmRlcigpKTsKICAgICAgICBmb3IgKGNvbnN0IGIgb2YgdGhpcy5fc3ViTGF5ZXJzKSBiLklzVmlzaWJsZSgpICYmIDAgPCBiLkdldE9wYWNpdHkoKSAmJiBiLl9BcHBlbmRBbGxJbnN0YW5jZXNJbmNsdWRpbmdTdWJMYXllcnNJbkRyYXdPcmRlcihhKQogICAgfQogICAgX1NvcnRJbnN0YW5jZXNCeUNhbWVyYURpc3RhbmNlKGEsCiAgICAgICAgYikgewogICAgICAgIHZhciBkID0gdGhpcy5HZXRMYXlvdXQoKS5HZXQzRENhbWVyYVBvc2l0aW9uKCksCiAgICAgICAgICAgIGMgPSBkWzBdLAogICAgICAgICAgICBlID0gZFsxXTsKICAgICAgICBkID0gZFsyXTsKICAgICAgICB2YXIgZyA9IGEuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgY29uc3QgayA9IGIuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgYiA9IGcuR2V0WCgpIC0gYzsKICAgICAgICBhID0gZy5HZXRZKCkgLSBlOwogICAgICAgIGcgPSBnLkdldFpFbGV2YXRpb24oKSAtIGQ7CiAgICAgICAgYyA9IGsuR2V0WCgpIC0gYzsKICAgICAgICBlID0gay5HZXRZKCkgLSBlOwogICAgICAgIGQgPSBrLkdldFpFbGV2YXRpb24oKSAtIGQ7CiAgICAgICAgcmV0dXJuIGMgKiBjICsgZSAqIGUgKyBkICogZCAtIChiICogYiArIGEgKiBhICsgZyAqIGcpCiAgICB9CiAgICBHZXRCYWNrZ3JvdW5kQ29sb3IoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2JhY2tncm91bmRDb2xvcgogICAgfQogICAgSXNUcmFuc3BhcmVudCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5faXNUcmFuc3BhcmVudAogICAgfQogICAgU2V0VHJhbnNwYXJlbnQoYSkgewogICAgICAgIGEgPSAhIWE7CiAgICAgICAgdGhpcy5faXNUcmFuc3BhcmVudCAhPT0gYSAmJiAodGhpcy5faXNUcmFuc3BhcmVudCA9IGEsIHRoaXMuX3J1bnRpbWUuVXBkYXRlUmVuZGVyKCkpCiAgICB9CiAgICBJc0ZvcmNlT3duVGV4dHVyZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5faXNGb3JjZU93blRleHR1cmUKICAgIH0KICAgIFNldEZvcmNlT3duVGV4dHVyZShhKSB7CiAgICAgICAgYSA9ICEhYTsKICAgICAgICB0aGlzLl9pc0ZvcmNlT3duVGV4dHVyZSAhPT0gYSAmJiAodGhpcy5faXNGb3JjZU93blRleHR1cmUgPSBhLCB0aGlzLl9ydW50aW1lLlVwZGF0ZVJlbmRlcigpKQogICAgfQogICAgUmVuZGVyc0luMkRNb2RlKCkgewogICAgICAgIHJldHVybiAhdGhpcy5HZXRSdW50aW1lKCkuVXNlczNERmVhdHVyZXMoKSB8fCAhdGhpcy5fcmVuZGVyQXMzZAogICAgfQogICAgUmVuZGVyc0luM0RNb2RlKCkgewogICAgICAgIHJldHVybiAhdGhpcy5SZW5kZXJzSW4yRE1vZGUoKQogICAgfQogICAgSGFzM0RDYW1lcmEoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuUmVuZGVyc0luM0RNb2RlKCkgJiYgdGhpcy5HZXRMYXlvdXQoKS5JczNEQ2FtZXJhRW5hYmxlZCgpCiAgICB9CiAgICBTZWxmQW5kQWxsU3ViTGF5ZXJzSGF2ZTNEQ2FtZXJhKCkgewogICAgICAgIGlmICghdGhpcy5IYXMzRENhbWVyYSgpKSByZXR1cm4gITE7CiAgICAgICAgZm9yIChjb25zdCBhIG9mIHRoaXMuX3N1YkxheWVycykKICAgICAgICAgICAgaWYgKCFhLlNlbGZBbmRBbGxTdWJMYXllcnNIYXZlM0RDYW1lcmEoKSkgcmV0dXJuICExOwogICAgICAgIHJldHVybiAhMAogICAgfQogICAgU2V0QmxlbmRNb2RlKGEpIHsKICAgICAgICB0aGlzLl9ibGVuZE1vZGUgIT09IGEgJiYgKHRoaXMuX2JsZW5kTW9kZSA9CiAgICAgICAgICAgIGEsIHRoaXMuX3J1bnRpbWUuVXBkYXRlUmVuZGVyKCkpCiAgICB9CiAgICBHZXRCbGVuZE1vZGUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2JsZW5kTW9kZQogICAgfQogICAgSXNSb290TGF5ZXIoKSB7CiAgICAgICAgcmV0dXJuICF0aGlzLl9wYXJlbnRMYXllcgogICAgfQogICAgR2V0UGFyZW50TGF5ZXIoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3BhcmVudExheWVyCiAgICB9CiAgICBHZXRTdWJMYXllcnMoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3N1YkxheWVycwogICAgfQogICAgSGFzQW55U3ViTGF5ZXJzKCkgewogICAgICAgIHJldHVybiAwIDwgdGhpcy5fc3ViTGF5ZXJzLmxlbmd0aAogICAgfQogICAgSGFzQW55VmlzaWJsZVN1YkxheWVyKCkgewogICAgICAgIGZvciAoY29uc3QgYSBvZiB0aGlzLl9zdWJMYXllcnMpCiAgICAgICAgICAgIGlmIChhLlNob3VsZERyYXcoKSkgcmV0dXJuICEwOwogICAgICAgIHJldHVybiAhMQogICAgfSogc2VsZkFuZEFsbFN1YkxheWVycygpIHsKICAgICAgICBmb3IgKGNvbnN0IGEgb2YgdGhpcy5fc3ViTGF5ZXJzKSB5aWVsZCogYS5zZWxmQW5kQWxsU3ViTGF5ZXJzKCk7CiAgICAgICAgeWllbGQgdGhpcwogICAgfSogcGFyZW50TGF5ZXJzKCkgewogICAgICAgIGxldCBhID0gdGhpcy5HZXRQYXJlbnRMYXllcigpOwogICAgICAgIGZvciAoOyBhOykgeWllbGQgYSwgYSA9IGEuR2V0UGFyZW50TGF5ZXIoKQogICAgfSogc2VsZkFuZFBhcmVudExheWVycygpIHsKICAgICAgICB5aWVsZCB0aGlzOwogICAgICAgIHlpZWxkKiB0aGlzLnBhcmVudExheWVycygpCiAgICB9CiAgICBJc1RyYW5zZm9ybUNvbXBhdGlibGVXaXRoKGEpIHsKICAgICAgICByZXR1cm4gdGhpcyA9PT0gYSB8fCB0aGlzLl9wYXJhbGxheFggPT09IGEuX3BhcmFsbGF4WCAmJiB0aGlzLl9wYXJhbGxheFkgPT09IGEuX3BhcmFsbGF4WSAmJiB0aGlzLl9zY2FsZSA9PT0gYS5fc2NhbGUgJiYgdGhpcy5fc2NhbGVSYXRlID09PSBhLl9zY2FsZVJhdGUgJiYgdGhpcy5fYW5nbGUgPT09IGEuX2FuZ2xlICYmIHRoaXMuR2V0U2Nyb2xsWCgpID09PSBhLkdldFNjcm9sbFgoKSAmJiB0aGlzLkdldFNjcm9sbFkoKSA9PT0gYS5HZXRTY3JvbGxZKCkKICAgIH0KICAgIFNhdmVUcmFuc2Zvcm0oKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgcGFyYWxsYXhYOiB0aGlzLkdldFBhcmFsbGF4WCgpLAogICAgICAgICAgICBwYXJhbGxheFk6IHRoaXMuR2V0UGFyYWxsYXhZKCksCiAgICAgICAgICAgIHNjYWxlOiB0aGlzLkdldE93blNjYWxlKCksCiAgICAgICAgICAgIHNjYWxlUmF0ZTogdGhpcy5HZXRTY2FsZVJhdGUoKSwKICAgICAgICAgICAgYW5nbGU6IHRoaXMuR2V0T3duQW5nbGUoKSwKICAgICAgICAgICAgaGFzT3duU2Nyb2xsOiB0aGlzLklzT3duU2Nyb2xsUG9zaXRpb25FbmFibGVkKCksCiAgICAgICAgICAgIHNjcm9sbFg6IHRoaXMuR2V0U2Nyb2xsWCgpLAogICAgICAgICAgICBzY3JvbGxZOiB0aGlzLkdldFNjcm9sbFkoKQogICAgICAgIH0KICAgIH0KICAgIFJlc3RvcmVUcmFuc2Zvcm0oYSkgewogICAgICAgIHRoaXMuU2V0UGFyYWxsYXgoYS5wYXJhbGxheFgsIGEucGFyYWxsYXhZKTsKICAgICAgICB0aGlzLlNldE93blNjYWxlKGEuc2NhbGUpOwogICAgICAgIHRoaXMuU2V0U2NhbGVSYXRlKGEuc2NhbGVSYXRlKTsKICAgICAgICB0aGlzLlNldEFuZ2xlKGEuYW5nbGUpOwogICAgICAgIHRoaXMuU2V0T3duU2Nyb2xsUG9zaXRpb25FbmFibGVkKGEuaGFzT3duU2Nyb2xsKTsKICAgICAgICB0aGlzLlNldFNjcm9sbFgoYS5zY3JvbGxYKTsKICAgICAgICB0aGlzLlNldFNjcm9sbFkoYS5zY3JvbGxZKTsKICAgICAgICB0aGlzLl9NYXliZVVwZGF0ZVZpZXdwb3J0KCkKICAgIH0KICAgIF9SZW1vdmVBbGxJbnN0YW5jZXNJblNldChhKSB7CiAgICAgICAgMCAhPT0gYS5zaXplICYmIDAgPCBDMyRqc2NvbXAkODAuYXJyYXlSZW1vdmVBbGxJblNldCh0aGlzLl9pbnN0YW5jZXMsIGEpICYmICh0aGlzLl9NYXliZVJlc2V0QW55SW5zdGFuY2VaRWxldmF0ZWRGbGFnKCksIHRoaXMuU2V0WkluZGljZXNDaGFuZ2VkKCkpCiAgICB9CiAgICBTZXRaSW5kaWNlc0NoYW5nZWQoKSB7CiAgICAgICAgdGhpcy5faXNSZW5kZXJMaXN0VXBUb0RhdGUgPQogICAgICAgICAgICB0aGlzLl96SW5kaWNlc1VwVG9EYXRlID0gITEKICAgIH0KICAgIF9VcGRhdGVaSW5kaWNlcygpIHsKICAgICAgICBpZiAoIXRoaXMuX3pJbmRpY2VzVXBUb0RhdGUpIHsKICAgICAgICAgICAgdGhpcy5faW5zdGFuY2VzLnNvcnQoU29ydEJ5SW5zdFpFbGV2YXRpb24pOwogICAgICAgICAgICBpZiAodGhpcy5Vc2VzUmVuZGVyQ2VsbHMoKSkKICAgICAgICAgICAgICAgIGZvciAobGV0IGEgPSAwLCBiID0gdGhpcy5faW5zdGFuY2VzLmxlbmd0aDsgYSA8IGI7ICsrYSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGQgPSB0aGlzLl9pbnN0YW5jZXNbYV0uR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgICAgICAgICAgZC5fU2V0WkluZGV4KGEpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlbmRlckdyaWQuTWFya1JhbmdlQ2hhbmdlZChkLkdldFJlbmRlckNlbGxSYW5nZSgpKQogICAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgYSA9IDAsIGIgPSB0aGlzLl9pbnN0YW5jZXMubGVuZ3RoOyBhIDwgYjsgKythKSB0aGlzLl9pbnN0YW5jZXNbYV0uR2V0V29ybGRJbmZvKCkuX1NldFpJbmRleChhKTsKICAgICAgICAgICAgdGhpcy5fekluZGljZXNVcFRvRGF0ZSA9ICEwCiAgICAgICAgfQogICAgfQogICAgTW92ZUluc3RhbmNlQWRqYWNlbnQoYSwgYiwgZCkgewogICAgICAgIHZhciBjID0gYS5HZXRXb3JsZEluZm8oKTsKICAgICAgICBiID0gYi5HZXRXb3JsZEluZm8oKTsKICAgICAgICBpZiAoYy5HZXRMYXllcigpICE9PQogICAgICAgICAgICB0aGlzIHx8IGIuR2V0TGF5ZXIoKSAhPT0gdGhpcykgdGhyb3cgRXJyb3IoImNhbid0IGFycmFuZ2UgWiBvcmRlciB1bmxlc3MgYm90aCBvYmplY3RzIG9uIHRoaXMgbGF5ZXIiKTsKICAgICAgICBjID0gYy5HZXRaSW5kZXgoKTsKICAgICAgICBiID0gYi5HZXRaSW5kZXgoKTsKICAgICAgICBpZiAoYyA9PT0gYiArIChkID8gMSA6IC0xKSkgcmV0dXJuICExOwogICAgICAgIEMzJGpzY29tcCQ4MC5hcnJheVJlbW92ZSh0aGlzLl9pbnN0YW5jZXMsIGMpOwogICAgICAgIGMgPCBiICYmIGItLTsKICAgICAgICBkICYmIGIrKzsKICAgICAgICBiID09PSB0aGlzLl9pbnN0YW5jZXMubGVuZ3RoID8gdGhpcy5faW5zdGFuY2VzLnB1c2goYSkgOiB0aGlzLl9pbnN0YW5jZXMuc3BsaWNlKGIsIDAsIGEpOwogICAgICAgIHRoaXMuU2V0WkluZGljZXNDaGFuZ2VkKCk7CiAgICAgICAgcmV0dXJuICEwCiAgICB9CiAgICBfTWVyZ2VTb3J0ZWRaQXJyYXlzKGEsIGIpIHsKICAgICAgICBjb25zdCBkID0gW107CiAgICAgICAgbGV0IGMgPSAwLAogICAgICAgICAgICBlID0gMCwKICAgICAgICAgICAgZyA9IGEubGVuZ3RoLAogICAgICAgICAgICBrID0gYi5sZW5ndGg7CiAgICAgICAgZm9yICg7IGMgPCBnICYmIGUgPCBrOykgewogICAgICAgICAgICBjb25zdCBtID0gYVtjXSwKICAgICAgICAgICAgICAgIG4gPSBiW2VdOwogICAgICAgICAgICBtLkdldFdvcmxkSW5mbygpLl9HZXRMYXN0Q2FjaGVkWkluZGV4KCkgPCBuLkdldFdvcmxkSW5mbygpLl9HZXRMYXN0Q2FjaGVkWkluZGV4KCkgPwogICAgICAgICAgICAgICAgKGQucHVzaChtKSwgKytjKSA6IChkLnB1c2gobiksICsrZSkKICAgICAgICB9CiAgICAgICAgZm9yICg7IGMgPCBnOyArK2MpIGQucHVzaChhW2NdKTsKICAgICAgICBmb3IgKDsgZSA8IGs7ICsrZSkgZC5wdXNoKGJbZV0pOwogICAgICAgIHJldHVybiBkCiAgICB9CiAgICBfTWVyZ2VBbGxTb3J0ZWRaQXJyYXlzX3Bhc3MoYSkgewogICAgICAgIGNvbnN0IGIgPSBbXSwKICAgICAgICAgICAgZCA9IGEubGVuZ3RoOwogICAgICAgIGZvciAobGV0IGMgPSAwOyBjIDwgZCAtIDE7IGMgKz0gMikgYi5wdXNoKHRoaXMuX01lcmdlU29ydGVkWkFycmF5cyhhW2NdLCBhW2MgKyAxXSkpOwogICAgICAgIDEgPT09IGQgJSAyICYmIGIucHVzaChhW2QgLSAxXSk7CiAgICAgICAgcmV0dXJuIGIKICAgIH0KICAgIF9NZXJnZUFsbFNvcnRlZFpBcnJheXMoYSkgewogICAgICAgIGZvciAoOyAxIDwgYS5sZW5ndGg7KSBhID0gdGhpcy5fTWVyZ2VBbGxTb3J0ZWRaQXJyYXlzX3Bhc3MoYSk7CiAgICAgICAgcmV0dXJuIGFbMF0KICAgIH0KICAgIF9HZXRSZW5kZXJDZWxsSW5zdGFuY2VzVG9EcmF3KCkgewogICAgICAgIHRoaXMuX1VwZGF0ZVpJbmRpY2VzKCk7CiAgICAgICAgQzMkanNjb21wJDgwLmNsZWFyQXJyYXkocmVuZGVyQ2VsbEFycik7CiAgICAgICAgdGhpcy5fcmVuZGVyR3JpZC5RdWVyeVJhbmdlKHRoaXMuR2V0Vmlld3BvcnQoKSwgcmVuZGVyQ2VsbEFycik7CiAgICAgICAgcmV0dXJuIHJlbmRlckNlbGxBcnIubGVuZ3RoID8KICAgICAgICAgICAgMSA9PT0gcmVuZGVyQ2VsbEFyci5sZW5ndGggPyByZW5kZXJDZWxsQXJyWzBdIDogdGhpcy5fTWVyZ2VBbGxTb3J0ZWRaQXJyYXlzKHJlbmRlckNlbGxBcnIpIDogW10KICAgIH0KICAgIFNob3VsZERyYXcoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuSXNWaXNpYmxlKCkgJiYgMCA8IHRoaXMuR2V0T3BhY2l0eSgpICYmIHRoaXMuX0RyYXdzQW55Q29udGVudEluU2VsZk9yU3ViTGF5ZXJzKCkKICAgIH0KICAgIF9EcmF3c0FueUNvbnRlbnRJblNlbGZPclN1YkxheWVycygpIHsKICAgICAgICBpZiAodGhpcy5IYXNJbnN0YW5jZXMoKSB8fCAhdGhpcy5Jc1RyYW5zcGFyZW50KCkpIHJldHVybiAhMDsKICAgICAgICBmb3IgKGNvbnN0IGEgb2YgdGhpcy5fc3ViTGF5ZXJzKQogICAgICAgICAgICBpZiAoYS5fRHJhd3NBbnlDb250ZW50SW5TZWxmT3JTdWJMYXllcnMoKSkgcmV0dXJuICEwOwogICAgICAgIHJldHVybiAhMQogICAgfQogICAgVXNlc093blRleHR1cmUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuSXNGb3JjZU93blRleHR1cmUoKSB8fCAhdGhpcy5IYXNEZWZhdWx0Q29sb3IoKSB8fCAwICE9PSB0aGlzLkdldEJsZW5kTW9kZSgpIHx8IHRoaXMuX2VmZmVjdExpc3QuSGFzQW55QWN0aXZlRWZmZWN0KCkKICAgIH0KICAgIFNlbGZPckFueVN1YkxheWVyVXNlc093blRleHR1cmUoKSB7CiAgICAgICAgaWYgKHRoaXMuVXNlc093blRleHR1cmUoKSkgcmV0dXJuICEwOwogICAgICAgIGZvciAoY29uc3QgYSBvZiB0aGlzLl9zdWJMYXllcnMpCiAgICAgICAgICAgIGlmIChhLlNlbGZPckFueVN1YkxheWVyVXNlc093blRleHR1cmUoKSkgcmV0dXJuICEwOwogICAgICAgIHJldHVybiAhMQogICAgfQogICAgR2V0UmVuZGVyVGFyZ2V0KCkgewogICAgICAgIHJldHVybiB0aGlzLl9jdXJSZW5kZXJUYXJnZXQKICAgIH0KICAgIEdldDJEU2NhbGVGYWN0b3JUb1ooYSkgewogICAgICAgIGlmICh0aGlzLl9sYXlvdXQuSXNPcnRob2dyYXBoaWNQcm9qZWN0aW9uKCkpIHJldHVybiAxOwogICAgICAgIGNvbnN0IGIgPSB0aGlzLkdldENhbWVyYVooKTsKICAgICAgICByZXR1cm4gYiAvIChiIC0gYSkKICAgIH0KICAgIEdldENhbWVyYVooYSkgewogICAgICAgIHJldHVybiB0aGlzLkdldERlZmF1bHRDYW1lcmFaKGEpIC8gdGhpcy5HZXROb3JtYWxTY2FsZSgpCiAgICB9CiAgICBfU2V0TVZNYXRyaXhDaGFuZ2VkKCkgewogICAgICAgIHRoaXMuX2lzVmlld3BvcnRDaGFuZ2VkID0gdGhpcy5faXNWaWV3RnJ1c3R1bUNoYW5nZWQgPSB0aGlzLl9pc01WTWF0cml4Q2hhbmdlZCA9ICEwCiAgICB9CiAgICBfR2V0TW9kZWxWaWV3TWF0cml4KGEpIHsKICAgICAgICB0aGlzLl9pc01WTWF0cml4Q2hhbmdlZCAmJiAodGhpcy5fQ2FsY3VsYXRlTW9kZWxWaWV3TWF0cml4KGEsCiAgICAgICAgICAgIHRoaXMuX21vZGVsVmlld01hdHJpeCwgMCwgMCwgbnVsbCksIHRoaXMuX2lzTVZNYXRyaXhDaGFuZ2VkID0gITEpOwogICAgICAgIHJldHVybiB0aGlzLl9tb2RlbFZpZXdNYXRyaXgKICAgIH0KICAgIEdldENhbWVyYVBvc2l0aW9uKCkgewogICAgICAgIGlmICh0aGlzLkhhczNEQ2FtZXJhKCkpIHsKICAgICAgICAgICAgY29uc3QgYSA9IHRoaXMuR2V0TGF5b3V0KCkuR2V0M0RDYW1lcmFQb3NpdGlvbigpOwogICAgICAgICAgICByZXR1cm4gW2FbMF0sIGFbMV0sIGFbMl1dCiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzLl9HZXQyRENhbWVyYVBvc2l0aW9uKCkKICAgIH0KICAgIF9HZXQyRENhbWVyYVBvc2l0aW9uKGEgPSAwLCBiID0gMCwgZCA9IDApIHsKICAgICAgICB2YXIgYyA9IHRoaXMuX3J1bnRpbWUsCiAgICAgICAgICAgIGUgPSB0aGlzLkdldExheW91dCgpLAogICAgICAgICAgICBnID0gYy5HZXRQYXJhbGxheFhPcmlnaW4oKSwKICAgICAgICAgICAgayA9IGMuR2V0UGFyYWxsYXhZT3JpZ2luKCk7CiAgICAgICAgZyA9ICh0aGlzLkdldFNjcm9sbFgoKSAtIGcpICogdGhpcy5fcGFyYWxsYXhYICsgZzsKICAgICAgICBrID0gKHRoaXMuR2V0U2Nyb2xsWSgpIC0gaykgKiB0aGlzLl9wYXJhbGxheFkgKyBrOwogICAgICAgIGMuSXNQaXhlbFJvdW5kaW5nRW5hYmxlZCgpICYmIChnID0gTWF0aC5yb3VuZChnKSwgayA9IE1hdGgucm91bmQoaykpOwogICAgICAgIGEgPSBnICsgYTsKICAgICAgICBiID0gayArIGI7CiAgICAgICAgZSA9IGUuSXNPcnRob2dyYXBoaWNQcm9qZWN0aW9uKCkgPyB0aGlzLkdldERlZmF1bHRDYW1lcmFaKGQpIDogdGhpcy5HZXRDYW1lcmFaKGQpOwogICAgICAgIGNvbnN0IFttLCBuXSA9IHRoaXMuX0dldFZhbmlzaGluZ1BvaW50KCk7CiAgICAgICAgaWYgKC41ICE9PSBtIHx8IC41ICE9PSBuKSBrID0gdGhpcy5HZXREZWZhdWx0Q2FtZXJhWihkKSAvIGUsIGQgPSAobSAtIC41KSAqIGMuR2V0Vmlld3BvcnRXaWR0aCgpIC8gaywgYyA9IChuIC0gLjUpICogYy5HZXRWaWV3cG9ydEhlaWdodCgpIC8gaywgayA9IHRoaXMuR2V0QW5nbGUoKSwgMCAhPT0gayAmJiAodGVtcFZlYzIuc2V0KGQsIGMpLCB0ZW1wVmVjMi5yb3RhdGUoayksIGQgPSB0ZW1wVmVjMi5nZXRYKCksIGMgPSB0ZW1wVmVjMi5nZXRZKCkpLCBhICs9IGQsIGIgKz0gYzsKICAgICAgICByZXR1cm4gW2EsIGIsIGVdCiAgICB9CiAgICBfQ2FsY3VsYXRlTW9kZWxWaWV3TWF0cml4KGEsIGIsIGQsIGMsIGUpIHsKICAgICAgICBjb25zdCBnID0gdGhpcy5fcnVudGltZTsKICAgICAgICB2YXIgayA9IHRoaXMuR2V0TGF5b3V0KCk7CiAgICAgICAgaWYgKHRoaXMuSGFzM0RDYW1lcmEoKSkgewogICAgICAgICAgICB2ZWMzJGpzY29tcCQ2LmNvcHkoY2FtVmVjdG9yLCBrLkdldDNEQ2FtZXJhUG9zaXRpb24oKSk7CiAgICAgICAgICAgIHZlYzMkanNjb21wJDYuY29weShsb29rVmVjdG9yLCBrLkdldDNEQ2FtZXJhTG9va0F0KCkpOwogICAgICAgICAgICB2ZWMzJGpzY29tcCQ2LmNvcHkodXBWZWN0b3IsIGsuR2V0M0RDYW1lcmFVcFZlY3RvcigpKTsKICAgICAgICAgICAgZCA9IGcuR2V0UGFyYWxsYXhYT3JpZ2luKCk7CiAgICAgICAgICAgIGMgPSBnLkdldFBhcmFsbGF4WU9yaWdpbigpOwogICAgICAgICAgICBrID0gbG9va1ZlY3RvclswXSAtIGNhbVZlY3RvclswXTsKICAgICAgICAgICAgY29uc3QgbSA9IGxvb2tWZWN0b3JbMV0gLSBjYW1WZWN0b3JbMV0sCiAgICAgICAgICAgICAgICBuID0gbG9va1ZlY3RvclsyXSAtIGNhbVZlY3RvclsyXTsKICAgICAgICAgICAgY2FtVmVjdG9yWzBdID0gKGNhbVZlY3RvclswXSAtIGQpICogdGhpcy5fcGFyYWxsYXhYICsgZDsKICAgICAgICAgICAgY2FtVmVjdG9yWzFdID0gKGNhbVZlY3RvclsxXSAtIGMpICogdGhpcy5fcGFyYWxsYXhZICsgYzsKICAgICAgICAgICAgY2FtVmVjdG9yWzJdICo9IE1hdGgubWF4KHRoaXMuX3BhcmFsbGF4WCwgdGhpcy5fcGFyYWxsYXhZKTsKICAgICAgICAgICAgbG9va1ZlY3RvclswXSA9IGNhbVZlY3RvclswXSArIGs7CiAgICAgICAgICAgIGxvb2tWZWN0b3JbMV0gPSBjYW1WZWN0b3JbMV0gKyBtOwogICAgICAgICAgICBsb29rVmVjdG9yWzJdID0gY2FtVmVjdG9yWzJdICsgbgogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbnN0IFttLAogICAgICAgICAgICAgICAgbiwgcQogICAgICAgICAgICBdID0gdGhpcy5fR2V0MkRDYW1lcmFQb3NpdGlvbihkLCBjLCBlKTsKICAgICAgICAgICAgdmVjMyRqc2NvbXAkNi5zZXQoY2FtVmVjdG9yLCBtLCBuLCBxKTsKICAgICAgICAgICAgdmVjMyRqc2NvbXAkNi5zZXQobG9va1ZlY3RvciwgbSwgbiwgcSAtIDEwMCk7CiAgICAgICAgICAgIGQgPSB0aGlzLkdldEFuZ2xlKCk7CiAgICAgICAgICAgIDAgPT09IGQgPyB2ZWMzJGpzY29tcCQ2LnNldCh1cFZlY3RvciwgMCwgMSwgMCkgOiB2ZWMzJGpzY29tcCQ2LnNldCh1cFZlY3RvciwgTWF0aC5zaW4oZCksIE1hdGguY29zKGQpLCAwKQogICAgICAgIH0KICAgICAgICBhLkNhbGN1bGF0ZUxvb2tBdE1vZGVsVmlldyhiLCBjYW1WZWN0b3IsIGxvb2tWZWN0b3IsIHVwVmVjdG9yLCBlIHx8IGcuR2V0Vmlld3BvcnRIZWlnaHQoKSkKICAgIH0KICAgIF9TZXRQcm9qZWN0aW9uTWF0cml4Q2hhbmdlZCgpIHsKICAgICAgICB0aGlzLl9pc1ZpZXdwb3J0Q2hhbmdlZCA9IHRoaXMuX2lzVmlld0ZydXN0dW1DaGFuZ2VkID0gdGhpcy5faXNQcm9qZWN0aW9uTWF0cml4Q2hhbmdlZCA9ICEwCiAgICB9CiAgICBfR2V0UHJvamVjdGlvbk1hdHJpeChhKSB7CiAgICAgICAgdGhpcy5faXNQcm9qZWN0aW9uTWF0cml4Q2hhbmdlZCAmJiAodGhpcy5fQ2FsY3VsYXRlUHJvamVjdGlvbk1hdHJpeChhKSwKICAgICAgICAgICAgdGhpcy5faXNQcm9qZWN0aW9uTWF0cml4Q2hhbmdlZCA9ICExKTsKICAgICAgICByZXR1cm4gdGhpcy5fcHJvamVjdGlvbk1hdHJpeAogICAgfQogICAgX0NhbGN1bGF0ZVByb2plY3Rpb25NYXRyaXgoYSkgewogICAgICAgIHZhciBiID0gdGhpcy5fcnVudGltZS5HZXRDYW52YXNNYW5hZ2VyKCk7CiAgICAgICAgY29uc3QgW2QsIGNdID0gdGhpcy5fR2V0VmFuaXNoaW5nUG9pbnQoKTsKICAgICAgICBpZiAodGhpcy5fbGF5b3V0LklzT3J0aG9ncmFwaGljUHJvamVjdGlvbigpKSBhLkNhbGN1bGF0ZU9ydGhvZ3JhcGhpY01hdHJpeCh0aGlzLl9wcm9qZWN0aW9uTWF0cml4LCBiLkdldERyYXdXaWR0aCgpLCBiLkdldERyYXdIZWlnaHQoKSk7CiAgICAgICAgZWxzZSBpZiAoLjUgPT09IGQgJiYgLjUgPT09IGMpIG1hdDQkanNjb21wJDkuY29weSh0aGlzLl9wcm9qZWN0aW9uTWF0cml4LCBiLkdldERlZmF1bHRQcm9qZWN0aW9uTWF0cml4KCkpOwogICAgICAgIGVsc2UgewogICAgICAgICAgICBjb25zdCBlID0gYi5HZXREcmF3V2lkdGgoKTsKICAgICAgICAgICAgYiA9IGIuR2V0RHJhd0hlaWdodCgpOwogICAgICAgICAgICBhLkNhbGN1bGF0ZVBlcnNwZWN0aXZlTWF0cml4KHRoaXMuX3Byb2plY3Rpb25NYXRyaXgsCiAgICAgICAgICAgICAgICBlIC8gYiwgZCwgYykKICAgICAgICB9CiAgICB9CiAgICBfU2V0VHJhbnNmb3JtKGEsIGIgPSAhMCwgZCA9IDAsIGMgPSAwLCBlID0gMCkgewogICAgICAgIGIgJiYgYS5TZXRQcm9qZWN0aW9uTWF0cml4KHRoaXMuX0dldFByb2plY3Rpb25NYXRyaXgoYSkpOwogICAgICAgIDAgPT09IGQgJiYgMCA9PT0gYyAmJiAwID09PSBlID8gYiA9IHRoaXMuX0dldE1vZGVsVmlld01hdHJpeChhKSA6ICh0aGlzLl9DYWxjdWxhdGVNb2RlbFZpZXdNYXRyaXgoYSwgdGVtcE1hdDQkanNjb21wJDQsIGQsIGMsIGUpLCBiID0gdGVtcE1hdDQkanNjb21wJDQpOwogICAgICAgIGEuU2V0TW9kZWxWaWV3TWF0cml4KGIpCiAgICB9CiAgICBQcmVwYXJlRm9yRHJhdyhhKSB7CiAgICAgICAgdGhpcy5fU2V0VHJhbnNmb3JtKGEpOwogICAgICAgIGEuU2V0QmFzZVoodGhpcy5HZXRaRWxldmF0aW9uKCkpCiAgICB9CiAgICBEcmF3KGEsIGIsIGQpIHsKICAgICAgICB2YXIgYyA9IHRoaXMuX3J1bnRpbWUuR2V0Q2FudmFzTWFuYWdlcigpOwogICAgICAgIGNvbnN0IGUgPSB0aGlzLlVzZXNPd25UZXh0dXJlKCk7CiAgICAgICAgdmFyIGcgPSBudWxsOwogICAgICAgIGxldCBrID0gbnVsbDsKICAgICAgICBpZiAodGhpcy5fcnVudGltZS5Jc0dQVVByb2ZpbGluZygpKQogICAgICAgICAgICBpZiAoYS5Jc1dlYkdMKCkpIHsKICAgICAgICAgICAgICAgIGNvbnN0IG0gPSBjLkdldExheWVyVGltaW5nc0J1ZmZlcih0aGlzKTsKICAgICAgICAgICAgICAgIG0gJiYgKGsgPSBtLkFkZFRpbWVFbGFwc2VkUXVlcnkoKSwgYS5TdGFydFF1ZXJ5KGspKQogICAgICAgICAgICB9IGVsc2UgYS5Jc1dlYkdQVSgpICYmIGEuV3JpdGVUaW1lc3RhbXAoMiAqICh0aGlzLkdldEluZGV4KCkgKyAxKSk7CiAgICAgICAgZSA/IChnID0gewogICAgICAgICAgICBzYW1wbGluZzogdGhpcy5fcnVudGltZS5HZXRTYW1wbGluZygpLAogICAgICAgICAgICBpc1NhbXBsZWQ6ICEwLAogICAgICAgICAgICBjYW5SZWFkUGl4ZWxzOiBhLklzV2ViR1BVKCkgPyB0aGlzLl9ydW50aW1lLlVzZXNBbnlCYWNrZ3JvdW5kQmxlbmRpbmcoKSA6ICExCiAgICAgICAgfSwgImxvdyIgPT09IGMuR2V0Q3VycmVudEZ1bGxzY3JlZW5TY2FsaW5nUXVhbGl0eSgpICYmIChnLndpZHRoID0gYy5HZXREcmF3V2lkdGgoKSwgZy5oZWlnaHQgPSBjLkdldERyYXdIZWlnaHQoKSksIHRoaXMuX2N1clJlbmRlclRhcmdldCA9IGcgPSB0aGlzLl9ydW50aW1lLkdldEFkZGl0aW9uYWxSZW5kZXJUYXJnZXQoZyksIGEuU2V0UmVuZGVyVGFyZ2V0KGcpLCB0aGlzLklzVHJhbnNwYXJlbnQoKSAmJiBhLkNsZWFyUmdiYSgwLCAwLCAwLCAwKSkgOiAodGhpcy5fY3VyUmVuZGVyVGFyZ2V0ID0gYiwgYS5TZXRSZW5kZXJUYXJnZXQoYikpOwogICAgICAgIHRoaXMuSXNUcmFuc3BhcmVudCgpIHx8IGEuQ2xlYXIodGhpcy5fYmFja2dyb3VuZENvbG9yKTsKICAgICAgICB0aGlzLl9sYXlvdXQuX0RyYXdMYXllckxpc3QoYSwgdGhpcy5fY3VyUmVuZGVyVGFyZ2V0LCB0aGlzLl9zdWJMYXllcnMsIGUgJiYgdGhpcy5Jc1RyYW5zcGFyZW50KCkpOwogICAgICAgIHRoaXMuX1NldFRyYW5zZm9ybShhKTsKICAgICAgICBhLlNldEJhc2VaKHRoaXMuR2V0WkVsZXZhdGlvbigpKTsKICAgICAgICBhLlNldERlcHRoRW5hYmxlZCh0aGlzLlJlbmRlcnNJbjNETW9kZSgpKTsKICAgICAgICB0aGlzLkdldE5vcm1hbFNjYWxlKCkgPiBOdW1iZXIuRVBTSUxPTiAmJiAodGhpcy5fVXBkYXRlWkluZGljZXMoKSwgYyA9IHRoaXMuVXNlc1JlbmRlckNlbGxzKCkgJiYgMCA9PT0gdGhpcy5HZXRaRWxldmF0aW9uKCkgJiYgIXRoaXMuX2FueUluc3RhbmNlWkVsZXZhdGVkLCB0aGlzLkhhczNEQ2FtZXJhKCkgPyB0aGlzLl9EcmF3SW5zdGFuY2VzXzNEQ2FtZXJhKGEpIDogYyA/IHRoaXMuX0RyYXdJbnN0YW5jZXNfUmVuZGVyQ2VsbHMoYSkgOiB0aGlzLl9EcmF3SW5zdGFuY2VzKGEsIHRoaXMuX0dldEluc3RhbmNlc0luRHJhd09yZGVyKCkpKTsKICAgICAgICBhLlNldEJhc2VaKDApOwogICAgICAgIGEuU2V0Q3VycmVudFooMCk7CiAgICAgICAgZSAmJiAoYS5TZXREZXB0aEVuYWJsZWQoITEpLCB0aGlzLl9EcmF3TGF5ZXJPd25UZXh0dXJlVG9SZW5kZXJUYXJnZXQoYSwgZywgYiwgZCkpOwogICAgICAgIGsgJiYgYS5FbmRRdWVyeShrKTsKICAgICAgICB0aGlzLl9ydW50aW1lLklzR1BVUHJvZmlsaW5nKCkgJiYgYS5Jc1dlYkdQVSgpICYmIGEuV3JpdGVUaW1lc3RhbXAoMiAqICh0aGlzLkdldEluZGV4KCkgKyAxKSArIDEpOwogICAgICAgIHRoaXMuX2N1clJlbmRlclRhcmdldCA9IG51bGwKICAgIH0KICAgIF9EcmF3SW5zdGFuY2VzKGEsIGIpIHsKICAgICAgICBjb25zdCBkID0gdGhpcy5HZXRWaWV3cG9ydCgpLAogICAgICAgICAgICBjID0gdGhpcy5fY3VyUmVuZGVyVGFyZ2V0LAogICAgICAgICAgICBlID0gdGhpcy5HZXRMYXlvdXQoKS5Jc09ydGhvZ3JhcGhpY1Byb2plY3Rpb24oKSwKICAgICAgICAgICAgZyA9IHRoaXMuR2V0TGF5b3V0KCkuSGFzVmFuaXNoaW5nUG9pbnRPdXRzaWRlVmlld3BvcnQoKTsKICAgICAgICBsZXQgayA9IG51bGw7CiAgICAgICAgZm9yIChsZXQgbSA9IDAsIG4gPSBiLmxlbmd0aDsgbSA8IG47ICsrbSkgewogICAgICAgICAgICBjb25zdCBxID0gYlttXTsKICAgICAgICAgICAgaWYgKHEgPT09IGspIGNvbnRpbnVlOwogICAgICAgICAgICBrID0gcTsKICAgICAgICAgICAgY29uc3QgdSA9IHEuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgIHUuSXNWaXNpYmxlKCkgJiYgdS5Jc0luVmlld3BvcnQoZCwgZywgZSkgJiYgdGhpcy5fRHJhd0luc3RhbmNlTWF5YmVXaXRoRWZmZWN0cyhxLCB1LCBhLCBjKQogICAgICAgIH0KICAgIH0KICAgIF9EcmF3SW5zdGFuY2VzXzNEQ2FtZXJhKGEpIHsKICAgICAgICBjb25zdCBiID0gdGhpcy5fY3VyUmVuZGVyVGFyZ2V0LAogICAgICAgICAgICBkID0gdGhpcy5fR2V0Vmlld0ZydXN0dW0oKSwKICAgICAgICAgICAgYyA9IHRoaXMuX0dldEluc3RhbmNlc0luRHJhd09yZGVyKCk7CiAgICAgICAgZm9yIChsZXQgbSA9IDAsIG4gPSBjLmxlbmd0aDsgbSA8IG47KSB7CiAgICAgICAgICAgIHZhciBlID0gY1ttXSwKICAgICAgICAgICAgICAgIGcgPSBlLkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICBpZiAoIWcuSXNWaXNpYmxlKCkgfHwgIWcuSXNJblZpZXdwb3J0M0QoZCkpIHsKICAgICAgICAgICAgICAgICsrbTsKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIH0oIWUuUmVuZGVyc1RvT3duWlBsYW5lKCkgfHwgMCA8IGcuR2V0RGVwdGgoKSkgJiYgdGVtcEluc3RhbmNlTGlzdDIucHVzaChlKTsKICAgICAgICAgICAgdmFyIGsgPSBlLkdldFdvcmxkSW5mbygpLkdldFRvdGFsWkVsZXZhdGlvbigpOwogICAgICAgICAgICB0ZW1wSW5zdGFuY2VMaXN0MS5wdXNoKGUpOwogICAgICAgICAgICBsZXQgcSA9IG0gKyAxOwogICAgICAgICAgICBmb3IgKDsgcSA8IG47ICsrcSkgewogICAgICAgICAgICAgICAgY29uc3QgdSA9IGNbcV0sCiAgICAgICAgICAgICAgICAgICAgdyA9IHUuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgICAgICBpZiAody5Jc1Zpc2libGUoKSAmJiB3LklzSW5WaWV3cG9ydDNEKGQpKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHcuR2V0VG90YWxaRWxldmF0aW9uKCkgIT09IGspIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIHUuUmVuZGVyc1RvT3duWlBsYW5lKCkgPyAoMCA8IHcuR2V0RGVwdGgoKSAmJiB0ZW1wSW5zdGFuY2VMaXN0Mi5wdXNoKHUpLCB0ZW1wSW5zdGFuY2VMaXN0MS5wdXNoKHUpKSA6IHRlbXBJbnN0YW5jZUxpc3QyLnB1c2godSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoMSAhPT0gdGVtcEluc3RhbmNlTGlzdDEubGVuZ3RoIHx8IHRlbXBJbnN0YW5jZUxpc3QxWzBdLk11c3RNaXRpZ2F0ZVpGaWdodGluZygpKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9EcmF3Q29wbGFuYXJJbnN0YW5jZXNfM0RDYW1lcmEoYSwgdGVtcEluc3RhbmNlTGlzdDEpOwogICAgICAgICAgICAgICAgZm9yIChsZXQgdSA9IDAsIHcgPSB0ZW1wSW5zdGFuY2VMaXN0Mi5sZW5ndGg7IHUgPCB3OyArK3UpIGUgPSB0ZW1wSW5zdGFuY2VMaXN0Mlt1XSwgZyA9IGUuR2V0V29ybGRJbmZvKCksIGcuX1NldERyYXdOb25CYWNrRmFjZXNPbmx5KCEwKSwgdGhpcy5fRHJhd0luc3RhbmNlTWF5YmVXaXRoRWZmZWN0cyhlLCBnLCBhLCBiKSwgZy5fU2V0RHJhd05vbkJhY2tGYWNlc09ubHkoITEpCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLl9EcmF3SW5zdGFuY2VNYXliZVdpdGhFZmZlY3RzKGUsCiAgICAgICAgICAgICAgICAgICAgZywgYSwgYik7CiAgICAgICAgICAgICAgICBmb3IgKGxldCB1ID0gMCwgdyA9IHRlbXBJbnN0YW5jZUxpc3QyLmxlbmd0aDsgdSA8IHc7ICsrdSkgZyA9IHRlbXBJbnN0YW5jZUxpc3QyW3VdLCBnICE9PSBlICYmIChrID0gZy5HZXRXb3JsZEluZm8oKSwgay5HZXRMYXllcigpLl9EcmF3SW5zdGFuY2VNYXliZVdpdGhFZmZlY3RzKGcsIGssIGEsIGIpKQogICAgICAgICAgICB9CiAgICAgICAgICAgIG0gPSBxOwogICAgICAgICAgICBDMyRqc2NvbXAkODAuY2xlYXJBcnJheSh0ZW1wSW5zdGFuY2VMaXN0MSk7CiAgICAgICAgICAgIEMzJGpzY29tcCQ4MC5jbGVhckFycmF5KHRlbXBJbnN0YW5jZUxpc3QyKQogICAgICAgIH0KICAgIH0KICAgIF9EcmF3Q29wbGFuYXJJbnN0YW5jZXNfM0RDYW1lcmEoYSwgYikgewogICAgICAgIGNvbnN0IGQgPSB0aGlzLl9jdXJSZW5kZXJUYXJnZXQ7CiAgICAgICAgYS5Db3BsYW5hclN0YXJ0U3RlbmNpbFBhc3MoKTsKICAgICAgICBmb3IgKGxldCBnID0gMCwgayA9IGIubGVuZ3RoOyBnIDwgazsgKytnKSB7CiAgICAgICAgICAgIHZhciBjID0gYltnXSwKICAgICAgICAgICAgICAgIGUgPSBjLkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICBlLl9TZXREcmF3QmFja0ZhY2VPbmx5KCEwKTsKICAgICAgICAgICAgdGhpcy5fRHJhd0luc3RhbmNlKGMsIGUsIGEpCiAgICAgICAgfQogICAgICAgIGEuQ29wbGFuYXJTdGFydENvbG9yUGFzcygpOwogICAgICAgIGZvciAobGV0IGcgPSAwLCBrID0gYi5sZW5ndGg7IGcgPAogICAgICAgICAgICBrOyArK2cpIGMgPSBiW2ddLCBlID0gYy5HZXRXb3JsZEluZm8oKSwgdGhpcy5fRHJhd0luc3RhbmNlTWF5YmVXaXRoRWZmZWN0cyhjLCBlLCBhLCBkKSwgZS5fU2V0RHJhd0JhY2tGYWNlT25seSghMSk7CiAgICAgICAgYS5Db3BsYW5hclJlc3RvcmVTdGFuZGFyZFJlbmRlcmluZygpCiAgICB9CiAgICBfRHJhd0luc3RhbmNlc19SZW5kZXJDZWxscyhhKSB7CiAgICAgICAgdmFyIGIgPSB0aGlzLl9yZW5kZXJHcmlkOwogICAgICAgIGNvbnN0IGQgPSB0aGlzLl9jdXJSZW5kZXJDZWxscywKICAgICAgICAgICAgYyA9IHRoaXMuX2xhc3RSZW5kZXJDZWxscywKICAgICAgICAgICAgZSA9IHRoaXMuR2V0Vmlld3BvcnQoKTsKICAgICAgICBkLnNldChiLlhUb0NlbGwoZS5nZXRMZWZ0KCkpLCBiLllUb0NlbGwoZS5nZXRUb3AoKSksIGIuWFRvQ2VsbChlLmdldFJpZ2h0KCkpLCBiLllUb0NlbGwoZS5nZXRCb3R0b20oKSkpOwogICAgICAgIHRoaXMuX2lzUmVuZGVyTGlzdFVwVG9EYXRlICYmIGQuZXF1YWxzKGMpID8gYiA9IHRoaXMuX2xhc3RSZW5kZXJMaXN0IDogKGIgPSB0aGlzLl9HZXRSZW5kZXJDZWxsSW5zdGFuY2VzVG9EcmF3KCksIHRoaXMuX2lzUmVuZGVyTGlzdFVwVG9EYXRlID0gITAsCiAgICAgICAgICAgIGMuY29weShkKSk7CiAgICAgICAgdGhpcy5fRHJhd0luc3RhbmNlcyhhLCBiKTsKICAgICAgICBiICE9PSB0aGlzLl9sYXN0UmVuZGVyTGlzdCAmJiBDMyRqc2NvbXAkODAuc2hhbGxvd0Fzc2lnbkFycmF5KHRoaXMuX2xhc3RSZW5kZXJMaXN0LCBiKQogICAgfQogICAgX0RyYXdJbnN0YW5jZU1heWJlV2l0aEVmZmVjdHMoYSwgYiwgZCwgYykgewogICAgICAgIGIuSGFzQW55QWN0aXZlRWZmZWN0KCkgPyB0aGlzLl9EcmF3SW5zdGFuY2VXaXRoRWZmZWN0c0FuZFJlc3RvcmUoYSwgYiwgZCwgYykgOiB0aGlzLl9EcmF3SW5zdGFuY2UoYSwgYiwgZCkKICAgIH0KICAgIF9EcmF3SW5zdGFuY2UoYSwgYiwgZCkgewogICAgICAgIGIgPSBiLkdldFJlbmRlcmVyU3RhdGVHcm91cCgpOwogICAgICAgIGQuR2V0Q3VycmVudFN0YXRlR3JvdXAoKSAhPT0gYiAmJiBiLkFwcGx5KCk7CiAgICAgICAgYS5EcmF3KGQpCiAgICB9CiAgICBfRHJhd0luc3RhbmNlV2l0aEVmZmVjdHNBbmRSZXN0b3JlKGEsIGIsIGQsIGMpIHsKICAgICAgICB0aGlzLl9EcmF3SW5zdGFuY2VXaXRoRWZmZWN0cyhhLCBiLCBkLCBjLCBudWxsKSAmJiB0aGlzLl9TZXRUcmFuc2Zvcm0oZCkKICAgIH0KICAgIF9EcmF3SW5zdGFuY2VXaXRoRWZmZWN0cyhhLCBiLCBkLCBjLCBlKSB7CiAgICAgICAgY29uc3QgZyA9CiAgICAgICAgICAgIGIuR2V0SW5zdGFuY2VFZmZlY3RMaXN0KCkuR2V0RWZmZWN0Q2hhaW4oKTsKICAgICAgICBnLlJlbmRlcihkLCBjLCB7CiAgICAgICAgICAgIGNvbnRlbnRPYmplY3Q6IGEsCiAgICAgICAgICAgIGJsZW5kTW9kZTogYi5HZXRCbGVuZE1vZGUoKSwKICAgICAgICAgICAgZGV2aWNlUGl4ZWxSYXRpbzogdGhpcy5fcnVudGltZS5HZXRFZmZlY3REZXZpY2VQaXhlbFJhdGlvUGFyYW0oKSwKICAgICAgICAgICAgdGltZTogYS5HZXRJbnN0YW5jZUdhbWVUaW1lKCksCiAgICAgICAgICAgIGxheWVyU2NhbGU6IHRoaXMuX3J1bnRpbWUuR2V0RWZmZWN0TGF5ZXJTY2FsZVBhcmFtKCkgKiB0aGlzLkdldE5vcm1hbFNjYWxlKCksCiAgICAgICAgICAgIGxheWVyQW5nbGU6IHRoaXMuR2V0QW5nbGUoKSwKICAgICAgICAgICAgbGF5b3V0UmVjdDogYi5HZXRCb3VuZGluZ0JveCgpLAogICAgICAgICAgICBkcmF3U3VyZmFjZVJlY3Q6IGcuQ2FuU2tpcENhbGN1bGF0aW5nRHJhd1N1cmZhY2VSZWN0KCkgPyBudWxsIDogdGhpcy5fSW5zdGFuY2VCb3hUb0RyYXdTdXJmYWNlKGIpLAogICAgICAgICAgICBkcmF3Q29udGVudEhvb2s6IGUgJiYgZS5kcmF3Q29udGVudEhvb2ssCiAgICAgICAgICAgIGNvbXBvc2l0T2ZmWDogZSAmJiBlLmNvbXBvc2l0T2ZmWCwKICAgICAgICAgICAgY29tcG9zaXRPZmZZOiBlICYmCiAgICAgICAgICAgICAgICBlLmNvbXBvc2l0T2ZmWSwKICAgICAgICAgICAgdXBkYXRlT3duUHJvamVjdGlvbjogZSAmJiBlLnVwZGF0ZU93blByb2plY3Rpb24KICAgICAgICB9KTsKICAgICAgICBkLlNldEJhc2VaKHRoaXMuR2V0WkVsZXZhdGlvbigpKTsKICAgICAgICByZXR1cm4gZy5EaWRDaGFuZ2VUcmFuc2Zvcm0oKQogICAgfQogICAgX0RyYXdMYXllck93blRleHR1cmVUb1JlbmRlclRhcmdldChhLCBiLCBkLCBjKSB7CiAgICAgICAgY29uc3QgZSA9IHRoaXMuX2VmZmVjdExpc3QuR2V0QWN0aXZlRWZmZWN0VHlwZXMoKSwKICAgICAgICAgICAgZyA9IHRoaXMuX3J1bnRpbWU7CiAgICAgICAgMCA9PT0gZS5sZW5ndGggPyAoYS5TZXRSZW5kZXJUYXJnZXQoZCksIGEuU2V0VGV4dHVyZUZpbGxNb2RlKCksIGMgJiYgMCA9PT0gdGhpcy5fYmxlbmRNb2RlICYmIHRoaXMuSGFzRGVmYXVsdENvbG9yKCkgPyBhLkNvcHlSZW5kZXJUYXJnZXQoYikgOiAoYS5TZXRCbGVuZE1vZGUodGhpcy5fYmxlbmRNb2RlKSwgYS5TZXRDb2xvcih0aGlzLl9wcmVtdWx0aXBsaWVkQ29sb3IpLCBhLkRyYXdSZW5kZXJUYXJnZXQoYikpLCBhLkludmFsaWRhdGVSZW5kZXJUYXJnZXQoYiksIGcuUmVsZWFzZUFkZGl0aW9uYWxSZW5kZXJUYXJnZXQoYikpIDoKICAgICAgICAgICAgdGhpcy5HZXRFZmZlY3RDaGFpbigpLlJlbmRlcihhLCBkLCB7CiAgICAgICAgICAgICAgICBjb250ZW50T2JqZWN0OiB0aGlzLAogICAgICAgICAgICAgICAgYmxlbmRNb2RlOiB0aGlzLkdldEJsZW5kTW9kZSgpLAogICAgICAgICAgICAgICAgZGV2aWNlUGl4ZWxSYXRpbzogZy5HZXRFZmZlY3REZXZpY2VQaXhlbFJhdGlvUGFyYW0oKSwKICAgICAgICAgICAgICAgIGxheWVyU2NhbGU6IGcuR2V0RWZmZWN0TGF5ZXJTY2FsZVBhcmFtKCkgKiB0aGlzLkdldE5vcm1hbFNjYWxlKCksCiAgICAgICAgICAgICAgICBsYXllckFuZ2xlOiB0aGlzLkdldEFuZ2xlKCksCiAgICAgICAgICAgICAgICBsYXlvdXRSZWN0OiB0aGlzLkdldFZpZXdwb3J0KCksCiAgICAgICAgICAgICAgICBkcmF3U3VyZmFjZVJlY3Q6IG51bGwsCiAgICAgICAgICAgICAgICBpbnZhbGlkYXRlUmVuZGVyVGFyZ2V0czogITAKICAgICAgICAgICAgfSkKICAgIH0KICAgIEdldE93blNjYWxlKCkgewogICAgICAgIHJldHVybiB0aGlzLl9zY2FsZQogICAgfQogICAgU2V0T3duU2NhbGUoYSkgewogICAgICAgIHRoaXMuX3NjYWxlICE9PSBhICYmICh0aGlzLl9zY2FsZSA9IGEsIHRoaXMuX2xheW91dC5Cb3VuZFNjcm9sbGluZygpLCB0aGlzLl9TZXRNVk1hdHJpeENoYW5nZWQoKSwgdGhpcy5fcnVudGltZS5VcGRhdGVSZW5kZXIoKSkKICAgIH0KICAgIEdldFJlbmRlclNjYWxlKCkgewogICAgICAgIHJldHVybiB0aGlzLkdldE5vcm1hbFNjYWxlKCkgKgogICAgICAgICAgICB0aGlzLl9ydW50aW1lLkdldFJlbmRlclNjYWxlKCkKICAgIH0KICAgIEdldERpc3BsYXlTY2FsZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5HZXROb3JtYWxTY2FsZSgpICogdGhpcy5fcnVudGltZS5HZXREaXNwbGF5U2NhbGUoKQogICAgfQogICAgR2V0Tm9ybWFsU2NhbGUoKSB7CiAgICAgICAgcmV0dXJuICh0aGlzLl9zY2FsZSAqIHRoaXMuX2xheW91dC5HZXRTY2FsZSgpIC0gMSkgKiB0aGlzLl9zY2FsZVJhdGUgKyAxCiAgICB9CiAgICBfTWF5YmVVcGRhdGVWaWV3cG9ydCgpIHsKICAgICAgICBpZiAodGhpcy5faXNWaWV3cG9ydENoYW5nZWQpIHsKICAgICAgICAgICAgdGhpcy5faXNWaWV3cG9ydENoYW5nZWQgPSAhMTsKICAgICAgICAgICAgdmFyIGEgPSB0aGlzLl9ydW50aW1lLkdldFBhcmFsbGF4WE9yaWdpbigpLAogICAgICAgICAgICAgICAgYiA9IHRoaXMuX3J1bnRpbWUuR2V0UGFyYWxsYXhZT3JpZ2luKCksCiAgICAgICAgICAgICAgICBkID0gKHRoaXMuR2V0U2Nyb2xsWCgpIC0gYSkgKiB0aGlzLl9wYXJhbGxheFggKyBhLAogICAgICAgICAgICAgICAgYyA9ICh0aGlzLkdldFNjcm9sbFkoKSAtIGIpICogdGhpcy5fcGFyYWxsYXhZICsgYjsKICAgICAgICAgICAgYSA9IHRoaXMuR2V0Tm9ybWFsU2NhbGUoKTsKICAgICAgICAgICAgYiA9IHRoaXMuX3J1bnRpbWUuR2V0Vmlld3BvcnRXaWR0aCgpIC8gYTsKICAgICAgICAgICAgYSA9IHRoaXMuX3J1bnRpbWUuR2V0Vmlld3BvcnRIZWlnaHQoKSAvCiAgICAgICAgICAgICAgICBhOwogICAgICAgICAgICBkIC09IGIgLyAyOwogICAgICAgICAgICB2YXIgZSA9IGMgLSBhIC8gMjsKICAgICAgICAgICAgdGhpcy5fcnVudGltZS5Jc1BpeGVsUm91bmRpbmdFbmFibGVkKCkgJiYgKGQgPSBNYXRoLnJvdW5kKGQpLCBlID0gTWF0aC5yb3VuZChlKSk7CiAgICAgICAgICAgIGMgPSB0aGlzLl92aWV3cG9ydFowOwogICAgICAgICAgICBjLnNldChkLCBlLCBkICsgYiwgZSArIGEpOwogICAgICAgICAgICBiID0gdGhpcy5HZXRBbmdsZSgpOwogICAgICAgICAgICAwICE9PSBiICYmICh0bXBSZWN0JGpzY29tcCQyLmNvcHkoYyksIHRtcFJlY3QkanNjb21wJDIub2Zmc2V0KC1jLm1pZFgoKSwgLWMubWlkWSgpKSwgdG1wUXVhZCRqc2NvbXAkMi5zZXRGcm9tUm90YXRlZFJlY3QodG1wUmVjdCRqc2NvbXAkMiwgYiksIHRtcFF1YWQkanNjb21wJDIuZ2V0Qm91bmRpbmdCb3godG1wUmVjdCRqc2NvbXAkMiksIHRtcFJlY3QkanNjb21wJDIub2Zmc2V0KGMubWlkWCgpLCBjLm1pZFkoKSksIGMuY29weSh0bXBSZWN0JGpzY29tcCQyKSk7CiAgICAgICAgICAgIGIgPSB0aGlzLl96RWxldmF0aW9uOwogICAgICAgICAgICB0aGlzLkdldFZpZXdwb3J0Rm9yWihiLCB0aGlzLl92aWV3cG9ydCk7CiAgICAgICAgICAgIHRoaXMuSGFzM0RDYW1lcmEoKSA/IHRoaXMuQ2FsY3VsYXRlVmlld3BvcnQzRChiLAogICAgICAgICAgICAgICAgdGhpcy5fdmlld3BvcnQzRCkgOiB0aGlzLl92aWV3cG9ydDNELmNvcHkodGhpcy5fdmlld3BvcnQpCiAgICAgICAgfQogICAgfQogICAgQ2FsY3VsYXRlVmlld3BvcnQzRChhLCBiKSB7CiAgICAgICAgdmFyIGQgPSB0aGlzLl9ydW50aW1lLkdldENhbnZhc01hbmFnZXIoKSwKICAgICAgICAgICAgYyA9IGQuR2V0Q3NzV2lkdGgoKTsKICAgICAgICBkID0gZC5HZXRDc3NIZWlnaHQoKTsKICAgICAgICBjb25zdCBbZSwgZ10gPSB0aGlzLkNhbnZhc0Nzc1RvTGF5ZXIoMCwgMCwgYSksIFtrLCBtXSA9IHRoaXMuQ2FudmFzQ3NzVG9MYXllcihjLCAwLCBhKSwgW24sIHFdID0gdGhpcy5DYW52YXNDc3NUb0xheWVyKGMsIGQsIGEpLCBbdSwgd10gPSB0aGlzLkNhbnZhc0Nzc1RvTGF5ZXIoMCwgZCwgYSk7CiAgICAgICAgYSA9IE1hdGgubWluKGUsIGssIG4sIHUpOwogICAgICAgIGMgPSBNYXRoLm1pbihnLCBtLCBxLCB3KTsKICAgICAgICBkID0gTWF0aC5tYXgoZSwgaywgbiwgdSk7CiAgICAgICAgbGV0IHogPSBNYXRoLm1heChnLCBtLCBxLCB3KTsKICAgICAgICBpc0Zpbml0ZShhKSB8fCAoYSA9IC1JbmZpbml0eSk7CiAgICAgICAgaXNGaW5pdGUoYykgfHwgKGMgPSAtSW5maW5pdHkpOwogICAgICAgIGlzRmluaXRlKGQpIHx8IChkID0gSW5maW5pdHkpOwogICAgICAgIGlzRmluaXRlKHopIHx8ICh6ID0gSW5maW5pdHkpOwogICAgICAgIGIuc2V0KGEsCiAgICAgICAgICAgIGMsIGQsIHopCiAgICB9CiAgICBDYW52YXNDc3NUb0xheWVyKGEsIGIsIGQgPSAwKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX0NhbnZhc1RvTGF5ZXIoYSwgYiwgZCwgdGhpcy5HZXREaXNwbGF5U2NhbGUoKSkKICAgIH0KICAgIERyYXdTdXJmYWNlVG9MYXllcihhLCBiLCBkID0gMCkgewogICAgICAgIHJldHVybiB0aGlzLl9DYW52YXNUb0xheWVyKGEsIGIsIGQsIHRoaXMuR2V0UmVuZGVyU2NhbGUoKSAqIHRoaXMuR2V0RGV2aWNlUGl4ZWxSYXRpbygpKQogICAgfQogICAgX0NhbnZhc1RvTGF5ZXIoYSwgYiwgZCwgYykgewogICAgICAgIHZhciBlID0gdGhpcy5fcnVudGltZSwKICAgICAgICAgICAgZyA9IGUuR2V0UmVuZGVyZXIoKSwKICAgICAgICAgICAgayA9IHRoaXMuR2V0Tm9ybWFsU2NhbGUoKSwKICAgICAgICAgICAgbSA9IGUuR2V0Vmlld3BvcnRXaWR0aCgpIC8gazsKICAgICAgICBrID0gZS5HZXRWaWV3cG9ydEhlaWdodCgpIC8gazsKICAgICAgICBlID0gdGVtcFZlYzQkanNjb21wJDE7CiAgICAgICAgdmVjNCRqc2NvbXAkNS5zZXQoZSwgMCwgMCwgbSwgayk7CiAgICAgICAgYSAvPSBjOwogICAgICAgIGIgPSBlWzNdIC0gYiAvIGM7CiAgICAgICAgYyA9IHRoaXMuX0dldFByb2plY3Rpb25NYXRyaXgoZyk7CiAgICAgICAgZyA9IHRoaXMuX0dldE1vZGVsVmlld01hdHJpeChnKTsKICAgICAgICBtID0gdGVtcFZlYzM7CiAgICAgICAgcmV0dXJuIEMzJGpzY29tcCQ4MC5HZnguVW5wcm9qZWN0U2NyZWVuVG9Xb3JsZFooYSwKICAgICAgICAgICAgYiwgZCwgZywgYywgZSwgbSkgPyBbbVswXSwgbVsxXV0gOiBbTmFOLCBOYU5dCiAgICB9CiAgICBDYW52YXNDc3NUb0xheWVyX0RlZmF1bHRUcmFuc2Zvcm0oYSwgYikgewogICAgICAgIGNvbnN0IGQgPSB0aGlzLl9zY2FsZSwKICAgICAgICAgICAgYyA9IHRoaXMuX3NjYWxlUmF0ZSwKICAgICAgICAgICAgZSA9IHRoaXMuX3BhcmFsbGF4WCwKICAgICAgICAgICAgZyA9IHRoaXMuX3BhcmFsbGF4WSwKICAgICAgICAgICAgayA9IHRoaXMuX2FuZ2xlOwogICAgICAgIHRoaXMuX3BhcmFsbGF4WSA9IHRoaXMuX3BhcmFsbGF4WCA9IHRoaXMuX3NjYWxlUmF0ZSA9IHRoaXMuX3NjYWxlID0gMTsKICAgICAgICB0aGlzLl9hbmdsZSA9IDA7CiAgICAgICAgdGhpcy5fU2V0TVZNYXRyaXhDaGFuZ2VkKCk7CiAgICAgICAgYSA9IHRoaXMuQ2FudmFzQ3NzVG9MYXllcihhLCBiKTsKICAgICAgICB0aGlzLl9zY2FsZSA9IGQ7CiAgICAgICAgdGhpcy5fc2NhbGVSYXRlID0gYzsKICAgICAgICB0aGlzLl9wYXJhbGxheFggPSBlOwogICAgICAgIHRoaXMuX3BhcmFsbGF4WSA9IGc7CiAgICAgICAgdGhpcy5fYW5nbGUgPSBrOwogICAgICAgIHRoaXMuX1NldE1WTWF0cml4Q2hhbmdlZCgpOwogICAgICAgIHJldHVybiBhCiAgICB9CiAgICBMYXllclRvQ2FudmFzQ3NzKGEsIGIsIGQgPSAwKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX0xheWVyVG9DYW52YXMoYSwgYiwgZCwgdGhpcy5HZXREaXNwbGF5U2NhbGUoKSkKICAgIH0KICAgIExheWVyVG9EcmF3U3VyZmFjZShhLAogICAgICAgIGIsIGQgPSAwKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX0xheWVyVG9DYW52YXMoYSwgYiwgZCwgdGhpcy5HZXRSZW5kZXJTY2FsZSgpICogdGhpcy5HZXREZXZpY2VQaXhlbFJhdGlvKCkpCiAgICB9CiAgICBfTGF5ZXJUb0NhbnZhcyhhLCBiLCBkLCBjKSB7CiAgICAgICAgdmFyIGUgPSB0aGlzLl9ydW50aW1lLAogICAgICAgICAgICBnID0gZS5HZXRSZW5kZXJlcigpLAogICAgICAgICAgICBrID0gdGhpcy5HZXROb3JtYWxTY2FsZSgpLAogICAgICAgICAgICBtID0gZS5HZXRWaWV3cG9ydFdpZHRoKCkgLyBrOwogICAgICAgIGsgPSBlLkdldFZpZXdwb3J0SGVpZ2h0KCkgLyBrOwogICAgICAgIGUgPSB0ZW1wVmVjNCRqc2NvbXAkMTsKICAgICAgICB2ZWM0JGpzY29tcCQ1LnNldChlLCAwLCAwLCBtLCBrKTsKICAgICAgICBtID0gdGhpcy5fR2V0UHJvamVjdGlvbk1hdHJpeChnKTsKICAgICAgICBnID0gdGhpcy5fR2V0TW9kZWxWaWV3TWF0cml4KGcpOwogICAgICAgIGsgPSB0ZW1wVmVjMzsKICAgICAgICByZXR1cm4gQzMkanNjb21wJDgwLkdmeC5Qcm9qZWN0KGEsIGIsIGQsIGcsIG0sIGUsIGspID8gW2tbMF0gKiBjLCAoZVszXSAtIGtbMV0pICogY10gOiBbTmFOLCBOYU5dCiAgICB9CiAgICBfR2V0TGF5ZXJUb0RyYXdTdXJmYWNlU2NhbGUoYSwgYikgewogICAgICAgIGEgKj0gdGhpcy5HZXRSZW5kZXJTY2FsZSgpICogdGhpcy5HZXREZXZpY2VQaXhlbFJhdGlvKCk7CiAgICAgICAgMCAhPT0gYiAmJiAoYSAqPSB0aGlzLkdldDJEU2NhbGVGYWN0b3JUb1ooYikpOwogICAgICAgIHJldHVybiBhCiAgICB9CiAgICBfSW5zdGFuY2VCb3hUb0RyYXdTdXJmYWNlKGEpIHsKICAgICAgICB2YXIgYiA9IGEuR2V0Qm91bmRpbmdCb3goKSwKICAgICAgICAgICAgZCA9IGEuR2V0VG90YWxaRWxldmF0aW9uKCk7CiAgICAgICAgYSA9IGEuR2V0RGVwdGgoKTsKICAgICAgICBjb25zdCBjID0gZCArIGEsCiAgICAgICAgICAgIGUgPSBiLmdldExlZnQoKSwKICAgICAgICAgICAgZyA9IGIuZ2V0VG9wKCksCiAgICAgICAgICAgIGsgPSBiLmdldFJpZ2h0KCk7CiAgICAgICAgYiA9IGIuZ2V0Qm90dG9tKCk7CiAgICAgICAgaWYgKHRoaXMuSGFzM0RDYW1lcmEoKSkgewogICAgICAgICAgICBpZiAodGhpcy5fSXNQb2ludEJlaGluZE5lYXJQbGFuZShlLCBnLCBkKSB8fCB0aGlzLl9Jc1BvaW50QmVoaW5kTmVhclBsYW5lKGssIGcsIGQpIHx8IHRoaXMuX0lzUG9pbnRCZWhpbmROZWFyUGxhbmUoaywgYiwgZCkgfHwgdGhpcy5fSXNQb2ludEJlaGluZE5lYXJQbGFuZShlLCBiLCBkKSB8fCAwIDwgYSAmJiAodGhpcy5fSXNQb2ludEJlaGluZE5lYXJQbGFuZShlLCBnLCBjKSB8fCB0aGlzLl9Jc1BvaW50QmVoaW5kTmVhclBsYW5lKGssIGcsIGMpIHx8IHRoaXMuX0lzUG9pbnRCZWhpbmROZWFyUGxhbmUoaywgYiwgYykgfHwKICAgICAgICAgICAgICAgICAgICB0aGlzLl9Jc1BvaW50QmVoaW5kTmVhclBsYW5lKGUsIGIsIGMpKSkgcmV0dXJuIG51bGwKICAgICAgICB9IGVsc2UgaWYgKGMgPj0gdGhpcy5HZXRDYW1lcmFaKCkpIHJldHVybiBudWxsOwogICAgICAgIGxldCBbbSwgbl0gPSB0aGlzLkxheWVyVG9EcmF3U3VyZmFjZShlLCBnLCBkKSwgW3EsIHVdID0gdGhpcy5MYXllclRvRHJhd1N1cmZhY2UoaywgYiwgZCk7CiAgICAgICAgaWYgKDAgIT09IHRoaXMuR2V0QW5nbGUoKSB8fCAwIDwgYSB8fCB0aGlzLkhhczNEQ2FtZXJhKCkpIHsKICAgICAgICAgICAgY29uc3QgW3csIHpdID0gdGhpcy5MYXllclRvRHJhd1N1cmZhY2UoaywgZywgZCksIFtDLCBEXSA9IHRoaXMuTGF5ZXJUb0RyYXdTdXJmYWNlKGUsIGIsIGQpOwogICAgICAgICAgICBpZiAoMCA8IGEpIHsKICAgICAgICAgICAgICAgIGNvbnN0IFtGLCBFXSA9IHRoaXMuTGF5ZXJUb0RyYXdTdXJmYWNlKGUsIGcsIGMpLCBbSiwgS10gPSB0aGlzLkxheWVyVG9EcmF3U3VyZmFjZShrLCBnLCBjKSwgW08sIFZdID0gdGhpcy5MYXllclRvRHJhd1N1cmZhY2UoaywgYiwgYyksIFtXLCBjYV0gPSB0aGlzLkxheWVyVG9EcmF3U3VyZmFjZShlLCBiLCBjKTsKICAgICAgICAgICAgICAgIGQgPSBNYXRoLm1pbihtLCBxLCB3LCBDLCBGLCBKLCBPLCBXKTsKICAgICAgICAgICAgICAgIHEgPSBNYXRoLm1heChtLAogICAgICAgICAgICAgICAgICAgIHEsIHcsIEMsIEYsIEosIE8sIFcpOwogICAgICAgICAgICAgICAgbSA9IGQ7CiAgICAgICAgICAgICAgICBkID0gTWF0aC5taW4obiwgdSwgeiwgRCwgRSwgSywgViwgY2EpOwogICAgICAgICAgICAgICAgdSA9IE1hdGgubWF4KG4sIHUsIHosIEQsIEUsIEssIFYsIGNhKTsKICAgICAgICAgICAgICAgIG4gPSBkCiAgICAgICAgICAgIH0gZWxzZSBkID0gTWF0aC5taW4obSwgcSwgdywgQyksIHEgPSBNYXRoLm1heChtLCBxLCB3LCBDKSwgbSA9IGQsIGQgPSBNYXRoLm1pbihuLCB1LCB6LCBEKSwgdSA9IE1hdGgubWF4KG4sIHUsIHosIEQpLCBuID0gZAogICAgICAgIH0KICAgICAgICB0bXBSZWN0JGpzY29tcCQyLnNldChtLCBuLCBxLCB1KTsKICAgICAgICByZXR1cm4gdG1wUmVjdCRqc2NvbXAkMgogICAgfQogICAgX0dldFZpZXdGcnVzdHVtKCkgewogICAgICAgIHRoaXMuX2lzVmlld0ZydXN0dW1DaGFuZ2VkICYmICh0aGlzLl9VcGRhdGVWaWV3RnJ1c3R1bSgpLCB0aGlzLl9pc1ZpZXdGcnVzdHVtQ2hhbmdlZCA9ICExKTsKICAgICAgICByZXR1cm4gdGhpcy5fdmlld0ZydXN0dW0KICAgIH0KICAgIF9VcGRhdGVWaWV3RnJ1c3R1bSgpIHsKICAgICAgICB2YXIgYSA9IHRoaXMuX3J1bnRpbWUuR2V0UmVuZGVyZXIoKTsKICAgICAgICBjb25zdCBiID0gdGhpcy5fR2V0UHJvamVjdGlvbk1hdHJpeChhKTsKICAgICAgICBhID0gdGhpcy5fR2V0TW9kZWxWaWV3TWF0cml4KGEpOwogICAgICAgIHRoaXMuX3ZpZXdGcnVzdHVtLkNhbGN1bGF0ZVBsYW5lcyhhLAogICAgICAgICAgICBiKQogICAgfQogICAgX0lzUG9pbnRCZWhpbmROZWFyUGxhbmUoYSwgYiwgZCkgewogICAgICAgIHJldHVybiB0aGlzLl9HZXRWaWV3RnJ1c3R1bSgpLklzQmVoaW5kTmVhclBsYW5lKGEsIGIsIGQpCiAgICB9CiAgICBfU2F2ZVRvSnNvbigpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBzOiB0aGlzLkdldE93blNjYWxlKCksCiAgICAgICAgICAgIGE6IHRoaXMuR2V0T3duQW5nbGUoKSwKICAgICAgICAgICAgdjogdGhpcy5fSXNWaXNpYmxlRmxhZ1NldCgpLAogICAgICAgICAgICBpOiB0aGlzLklzSW50ZXJhY3RpdmUoKSwKICAgICAgICAgICAgYmM6IHRoaXMuX2JhY2tncm91bmRDb2xvci50b0pTT04oKSwKICAgICAgICAgICAgdDogdGhpcy5Jc1RyYW5zcGFyZW50KCksCiAgICAgICAgICAgIHN4OiB0aGlzLl9zY3JvbGxYLAogICAgICAgICAgICBzeTogdGhpcy5fc2Nyb2xsWSwKICAgICAgICAgICAgaG9zcDogdGhpcy5faGFzT3duU2Nyb2xsUG9zaXRpb24sCiAgICAgICAgICAgIHB4OiB0aGlzLkdldFBhcmFsbGF4WCgpLAogICAgICAgICAgICBweTogdGhpcy5HZXRQYXJhbGxheFkoKSwKICAgICAgICAgICAgYzogdGhpcy5fY29sb3IudG9KU09OKCksCiAgICAgICAgICAgIHNyOiB0aGlzLkdldFNjYWxlUmF0ZSgpLAogICAgICAgICAgICBmeDogdGhpcy5fZWZmZWN0TGlzdC5TYXZlVG9Kc29uKCksCiAgICAgICAgICAgIGNnOiB0aGlzLl9jcmVhdGVkR2xvYmFsVWlkcwogICAgICAgIH0KICAgIH0KICAgIF9Mb2FkRnJvbUpzb24oYSkgewogICAgICAgIHRoaXMuX3NjYWxlID0KICAgICAgICAgICAgYS5zOwogICAgICAgIHRoaXMuX2FuZ2xlID0gYS5hOwogICAgICAgIHRoaXMuX2lzVmlzaWJsZSA9ICEhYS52OwogICAgICAgIHRoaXMuX2lzSW50ZXJhY3RpdmUgPSBhLmhhc093blByb3BlcnR5KCJpIikgPyBhLmkgOiAhMDsKICAgICAgICB0aGlzLl9iYWNrZ3JvdW5kQ29sb3Iuc2V0RnJvbUpTT04oYS5iYyk7CiAgICAgICAgdGhpcy5faXNUcmFuc3BhcmVudCA9ICEhYS50OwogICAgICAgIGEuaGFzT3duUHJvcGVydHkoInN4IikgJiYgKHRoaXMuX3Njcm9sbFggPSBhLnN4KTsKICAgICAgICBhLmhhc093blByb3BlcnR5KCJzeSIpICYmICh0aGlzLl9zY3JvbGxZID0gYS5zeSk7CiAgICAgICAgYS5oYXNPd25Qcm9wZXJ0eSgiaG9zcCIpICYmICh0aGlzLl9oYXNPd25TY3JvbGxQb3NpdGlvbiA9ICEhYS5ob3NwKTsKICAgICAgICB0aGlzLl9wYXJhbGxheFggPSBhLnB4OwogICAgICAgIHRoaXMuX3BhcmFsbGF4WSA9IGEucHk7CiAgICAgICAgdGhpcy5fY29sb3Iuc2V0RnJvbUpTT04oYS5jKTsKICAgICAgICB0aGlzLl9zY2FsZVJhdGUgPSBhLnNyOwogICAgICAgIEMzJGpzY29tcCQ4MC5zaGFsbG93QXNzaWduQXJyYXkodGhpcy5fY3JlYXRlZEdsb2JhbFVpZHMsIGEuY2cpOwogICAgICAgIEMzJGpzY29tcCQ4MC5zaGFsbG93QXNzaWduQXJyYXkodGhpcy5faW5pdGlhbEluc3RhbmNlcywKICAgICAgICAgICAgdGhpcy5fc3RhcnR1cEluaXRpYWxJbnN0YW5jZXMpOwogICAgICAgIGNvbnN0IGIgPSBuZXcgU2V0KHRoaXMuX2NyZWF0ZWRHbG9iYWxVaWRzKTsKICAgICAgICBsZXQgZCA9IDA7CiAgICAgICAgZm9yIChsZXQgYyA9IDAsIGUgPSB0aGlzLl9pbml0aWFsSW5zdGFuY2VzLmxlbmd0aDsgYyA8IGU7ICsrYykgYi5oYXModGhpcy5faW5pdGlhbEluc3RhbmNlc1tjXVsyXSkgfHwgKHRoaXMuX2luaXRpYWxJbnN0YW5jZXNbZF0gPSB0aGlzLl9pbml0aWFsSW5zdGFuY2VzW2NdLCArK2QpOwogICAgICAgIEMzJGpzY29tcCQ4MC50cnVuY2F0ZUFycmF5KHRoaXMuX2luaXRpYWxJbnN0YW5jZXMsIGQpOwogICAgICAgIHRoaXMuX2VmZmVjdExpc3QuTG9hZEZyb21Kc29uKGEuZngpOwogICAgICAgIHRoaXMuX25lZWRzUmVidWlsZEVmZmVjdENoYWluU3RlcHMgPSAhMDsKICAgICAgICB0aGlzLl9Tb3J0SW5zdGFuY2VzQnlMYXN0Q2FjaGVkWkluZGV4KCExKTsKICAgICAgICB0aGlzLlNldFpJbmRpY2VzQ2hhbmdlZCgpOwogICAgICAgIHRoaXMuX1NldE1WTWF0cml4Q2hhbmdlZCgpOwogICAgICAgIHRoaXMuX1NldFByb2plY3Rpb25NYXRyaXhDaGFuZ2VkKCkKICAgIH0KICAgIEdldElMYXllcigpIHsKICAgICAgICByZXR1cm4gdGhpcy5faUxheWVyCiAgICB9CiAgICBTb3J0QW5kQWRkSW5zdGFuY2VzQnlaSW5kZXgoYSkgewogICAgICAgIGlmICghdGhpcy5faW5zdGFuY2VzLmluY2x1ZGVzKGEpKQogICAgICAgICAgICBpZiAoYS5IYXNDaGlsZHJlbigpKSB7CiAgICAgICAgICAgICAgICB2YXIgYiA9IFsuLi5hLmFsbENoaWxkcmVuKCldOwogICAgICAgICAgICAgICAgYi5wdXNoKGEpOwogICAgICAgICAgICAgICAgYi5zb3J0KChjLCBlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgYyA9IGMuR2V0V29ybGRJbmZvKCkuR2V0U2NlbmVHcmFwaFpJbmRleCgpOwogICAgICAgICAgICAgICAgICAgIGUgPSBlLkdldFdvcmxkSW5mbygpLkdldFNjZW5lR3JhcGhaSW5kZXgoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYyAtIGUKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgZm9yICh2YXIgZCBvZiBiKQogICAgICAgICAgICAgICAgICAgIGlmIChkLklzSW5Db250YWluZXIoKSkKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBjIG9mIGQuc2libGluZ3MoKSkgYi5pbmNsdWRlcyhjKSB8fCAoYSA9IFsuLi5jLmFsbENoaWxkcmVuKCldLCBhLnB1c2goYyksIGEuc29ydCgoZSwgZykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZSA9IGUuR2V0V29ybGRJbmZvKCkuR2V0U2NlbmVHcmFwaFpJbmRleCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZyA9IGcuR2V0V29ybGRJbmZvKCkuR2V0U2NlbmVHcmFwaFpJbmRleCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGUgLSBnCiAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBhICYmIGEubGVuZ3RoICYmIGIuc3BsaWNlKGIubGVuZ3RoLCAwLCAuLi5hKSk7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGMgb2YgYikgYy5HZXRQbHVnaW4oKS5Jc1dvcmxkVHlwZSgpICYmIHRoaXMuX0FkZEluc3RhbmNlKGMsICEwKQogICAgICAgICAgICB9IGVsc2UgaWYgKGEuR2V0UGx1Z2luKCkuSXNXb3JsZFR5cGUoKSAmJgogICAgICAgICAgICB0aGlzLl9BZGRJbnN0YW5jZShhLCAhMCksIGEuSXNJbkNvbnRhaW5lcigpKQogICAgICAgICAgICBmb3IgKGIgb2YgYS5zaWJsaW5ncygpKQogICAgICAgICAgICAgICAgaWYgKGQgPSBbLi4uYi5hbGxDaGlsZHJlbigpXSwgZC5wdXNoKGIpLCBkLnNvcnQoKGMsIGUpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgYyA9IGMuR2V0V29ybGRJbmZvKCkuR2V0U2NlbmVHcmFwaFpJbmRleCgpOwogICAgICAgICAgICAgICAgICAgICAgICBlID0gZS5HZXRXb3JsZEluZm8oKS5HZXRTY2VuZUdyYXBoWkluZGV4KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjIC0gZQogICAgICAgICAgICAgICAgICAgIH0pLCBkICYmIGQubGVuZ3RoKQogICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgYyBvZiBkKSBjLkdldFBsdWdpbigpLklzV29ybGRUeXBlKCkgJiYgdGhpcy5fQWRkSW5zdGFuY2UoYywgITApCiAgICB9Cn07CiJ1c2Ugc3RyaWN0IjsKY29uc3QgQzMkanNjb21wJDgxID0gc2VsZi5DMywKICAgIEMzRGVidWdnZXIgPSBzZWxmLkMzRGVidWdnZXI7CkMzJGpzY29tcCQ4MS5OZXcoQzMkanNjb21wJDgxLlJlY3QpOwpDMyRqc2NvbXAkODEuTmV3KEMzJGpzY29tcCQ4MS5SZWN0KTsKY29uc3QgdGVtcExheW91dFJlY3QgPSBDMyRqc2NvbXAkODEuTmV3KEMzJGpzY29tcCQ4MS5SZWN0KSwKICAgIHRlbXBDb2xvciRqc2NvbXAkNCA9IEMzJGpzY29tcCQ4MS5OZXcoQzMkanNjb21wJDgxLkNvbG9yKSwKICAgIHZlYzMkanNjb21wJDcgPSBzZWxmLmdsTWF0cml4LnZlYzMsCiAgICB0ZW1wUmVuZGVyM2RMaXN0ID0gW10sCiAgICB0ZW1wSW5zdGFuY2VMaXN0MSRqc2NvbXAkMSA9IFtdLAogICAgdGVtcEluc3RhbmNlTGlzdDIkanNjb21wJDEgPSBbXSwKICAgIHRlbXBJbnN0YW5jZUxpc3QzID0gW107CgpmdW5jdGlvbiB2ZWMzRXF1YWxzWFlaKGEsIGIsIGQsIGMpIHsKICAgIHJldHVybiBhWzBdID09PSBNYXRoLmZyb3VuZChiKSAmJiBhWzFdID09PSBNYXRoLmZyb3VuZChkKSAmJiBhWzJdID09PSBNYXRoLmZyb3VuZChjKQp9CmxldCBsYXN0TGF5ZXJQcmVwYXJlZEZvckRyYXdpbmcgPSBudWxsOwoKZnVuY3Rpb24gTWF5YmVQcmVwYXJlTGF5ZXJEcmF3KGEsIGIpIHsKICAgIGxhc3RMYXllclByZXBhcmVkRm9yRHJhd2luZyAhPT0gYSAmJiAoYS5QcmVwYXJlRm9yRHJhdyhiKSwgbGFzdExheWVyUHJlcGFyZWRGb3JEcmF3aW5nID0gYSkKfQpDMyRqc2NvbXAkODEuTGF5b3V0ID0gY2xhc3MgZXh0ZW5kcyBDMyRqc2NvbXAkODEuRGVmZW5kZWRCYXNlIHsKICAgIGNvbnN0cnVjdG9yKGEsIGIsIGQpIHsKICAgICAgICBzdXBlcigpOwogICAgICAgIHRoaXMuX2xheW91dE1hbmFnZXIgPSBhOwogICAgICAgIHRoaXMuX3J1bnRpbWUgPSBhLkdldFJ1bnRpbWUoKTsKICAgICAgICB0aGlzLl9uYW1lID0gZFswXTsKICAgICAgICB0aGlzLl9vcmlnaW5hbFdpZHRoID0gZFsxXTsKICAgICAgICB0aGlzLl9vcmlnaW5hbEhlaWdodCA9IGRbMl07CiAgICAgICAgdGhpcy5fd2lkdGggPSBkWzFdOwogICAgICAgIHRoaXMuX2hlaWdodCA9IGRbMl07CiAgICAgICAgdGhpcy5faXNVbmJvdW5kZWRTY3JvbGxpbmcgPSAhIWRbM107CiAgICAgICAgdGhpcy5faXNPcnRob2dyYXBoaWNQcm9qZWN0aW9uID0gISFkWzRdOwogICAgICAgIHRoaXMuX3ZhbmlzaGluZ1BvaW50WCA9IGRbNV07CiAgICAgICAgdGhpcy5fdmFuaXNoaW5nUG9pbnRZID0gZFs2XTsKICAgICAgICB0aGlzLl9ldmVudFNoZWV0TmFtZSA9IGRbN107CiAgICAgICAgdGhpcy5fZXZlbnRTaGVldCA9IG51bGw7CiAgICAgICAgdGhpcy5fc2lkID0gZFs4XTsKICAgICAgICB0aGlzLl9pbmRleCA9IGI7CiAgICAgICAgdGhpcy5fc2Nyb2xsWSA9IHRoaXMuX3Njcm9sbFggPSAwOwogICAgICAgIHRoaXMuX3NjYWxlID0gMTsKICAgICAgICB0aGlzLl9hbmdsZSA9IDA7CiAgICAgICAgdGhpcy5faW5pdGlhbE9iamVjdENsYXNzZXMgPSBuZXcgU2V0OwogICAgICAgIHRoaXMuX3RleHR1cmVMb2FkZWRUeXBlcyA9IG5ldyBTZXQ7CiAgICAgICAgdGhpcy5fdGV4dHVyZUxvYWRQZW5kaW5nUHJvbWlzZXMgPSBuZXcgU2V0OwogICAgICAgIHRoaXMuX2NyZWF0ZWRJbnN0YW5jZXMgPSBbXTsKICAgICAgICB0aGlzLl9pbml0aWFsTm9uV29ybGQgPSBbXTsKICAgICAgICB0aGlzLl9pczNkQ2FtZXJhRW5hYmxlZCA9ICExOwogICAgICAgIHRoaXMuX2NhbTNkcG9zaXRpb24gPSB2ZWMzJGpzY29tcCQ3LmNyZWF0ZSgpOwogICAgICAgIHRoaXMuX2NhbTNkbG9vayA9IHZlYzMkanNjb21wJDcuY3JlYXRlKCk7CiAgICAgICAgdGhpcy5fY2FtM2R1cCA9IHZlYzMkanNjb21wJDcuY3JlYXRlKCk7CiAgICAgICAgdGhpcy5fcm9vdExheWVycyA9IFtdOwogICAgICAgIHRoaXMuX2FsbExheWVyc0ZsYXQgPSBbXTsKICAgICAgICB0aGlzLl9sYXllcnNCeU5hbWUgPSBuZXcgTWFwOwogICAgICAgIHRoaXMuX2xheWVyc0J5U2lkID0gbmV3IE1hcDsKICAgICAgICBjb25zdCBjID0gdGhpcy5fcnVudGltZS5HZXRDYW52YXNNYW5hZ2VyKCk7CiAgICAgICAgdGhpcy5fZWZmZWN0TGlzdCA9IEMzJGpzY29tcCQ4MS5OZXcoQzMkanNjb21wJDgxLkVmZmVjdExpc3QsCiAgICAgICAgICAgIHRoaXMsIGRbMTFdKTsKICAgICAgICB0aGlzLl9lZmZlY3RDaGFpbiA9IEMzJGpzY29tcCQ4MS5OZXcoQzMkanNjb21wJDgxLkdmeC5FZmZlY3RDaGFpbiwgYy5HZXRFZmZlY3RDaGFpbk1hbmFnZXIoKSwgewogICAgICAgICAgICBkcmF3Q29udGVudDogKGUsIGcpID0+IHsKICAgICAgICAgICAgICAgIGcgPSBnLkdldENvbnRlbnRPYmplY3QoKS5HZXRSZW5kZXJUYXJnZXQoKTsKICAgICAgICAgICAgICAgIGUuUmVzZXRDb2xvcigpOwogICAgICAgICAgICAgICAgZS5EcmF3UmVuZGVyVGFyZ2V0KGcpOwogICAgICAgICAgICAgICAgZS5JbnZhbGlkYXRlUmVuZGVyVGFyZ2V0KGcpOwogICAgICAgICAgICAgICAgYy5SZWxlYXNlQWRkaXRpb25hbFJlbmRlclRhcmdldChnKQogICAgICAgICAgICB9LAogICAgICAgICAgICBnZXRTaGFkZXJQYXJhbWV0ZXJzOiBlID0+IHRoaXMuR2V0RWZmZWN0TGlzdCgpLl9HZXRFZmZlY3RDaGFpblNoYWRlclBhcmFtZXRlcnNGb3JJbmRleChlKQogICAgICAgIH0pOwogICAgICAgIHRoaXMuX25lZWRzUmVidWlsZEVmZmVjdENoYWluU3RlcHMgPSAhMDsKICAgICAgICB0aGlzLl93YXNGdWxsU2NyZWVuUXVhbGl0eUxvdyA9ICExOwogICAgICAgIHRoaXMuX2N1clJlbmRlclRhcmdldCA9IG51bGw7CiAgICAgICAgdGhpcy5fcGVyc2lzdERhdGEgPSB7fTsKICAgICAgICB0aGlzLl9pc0ZpcnN0VmlzaXQgPSAhMDsKICAgICAgICB0aGlzLl9pTGF5b3V0ID0KICAgICAgICAgICAgbmV3IHNlbGYuSUxheW91dCh0aGlzKTsKICAgICAgICB0aGlzLl91c2VyU2NyaXB0RGlzcGF0Y2hlciA9IEMzJGpzY29tcCQ4MS5OZXcoQzMkanNjb21wJDgxLkV2ZW50LkRpc3BhdGNoZXIpOwogICAgICAgIGZvciAoY29uc3QgZSBvZiBkWzldKSB0aGlzLl9yb290TGF5ZXJzLnB1c2goQzMkanNjb21wJDgxLk5ldyhDMyRqc2NvbXAkODEuTGF5ZXIsIHRoaXMsIG51bGwsIGUpKTsKICAgICAgICB0aGlzLl9hbGxMYXllcnNGbGF0ID0gWy4uLnRoaXMuYWxsTGF5ZXJzKCldOwogICAgICAgIGZvciAobGV0IGUgPSAwLCBnID0gdGhpcy5fYWxsTGF5ZXJzRmxhdC5sZW5ndGg7IGUgPCBnOyArK2UpIGEgPSB0aGlzLl9hbGxMYXllcnNGbGF0W2VdLCBhLl9TZXRJbmRleChlKSwgYS5fSW5pdCgpLCB0aGlzLl9sYXllcnNCeU5hbWUuc2V0KGEuR2V0TmFtZSgpLnRvTG93ZXJDYXNlKCksIGEpLCB0aGlzLl9sYXllcnNCeVNpZC5zZXQoYS5HZXRTSUQoKSwgYSk7CiAgICAgICAgZm9yIChjb25zdCBlIG9mIGRbMTBdKSB7CiAgICAgICAgICAgIGQgPSB0aGlzLl9ydW50aW1lLkdldE9iamVjdENsYXNzQnlJbmRleChlWzFdKTsKICAgICAgICAgICAgaWYgKCFkKSB0aHJvdyBFcnJvcigibWlzc2luZyBub253b3JsZCBvYmplY3QgY2xhc3MiKTsKICAgICAgICAgICAgZC5HZXREZWZhdWx0SW5zdGFuY2VEYXRhKCkgfHwgZC5TZXREZWZhdWx0SW5zdGFuY2VEYXRhKGUpOwogICAgICAgICAgICB0aGlzLl9pbml0aWFsTm9uV29ybGQucHVzaChlKTsKICAgICAgICAgICAgdGhpcy5fQWRkSW5pdGlhbE9iamVjdENsYXNzKGQpCiAgICAgICAgfQogICAgfQogICAgUmVsZWFzZSgpIHsKICAgICAgICBmb3IgKGNvbnN0IGEgb2YgdGhpcy5fYWxsTGF5ZXJzRmxhdCkgYS5SZWxlYXNlKCk7CiAgICAgICAgQzMkanNjb21wJDgxLmNsZWFyQXJyYXkodGhpcy5fYWxsTGF5ZXJzRmxhdCk7CiAgICAgICAgdGhpcy5fdGV4dHVyZUxvYWRQZW5kaW5nUHJvbWlzZXMuY2xlYXIoKTsKICAgICAgICB0aGlzLl9ydW50aW1lID0gdGhpcy5fbGF5b3V0TWFuYWdlciA9IHRoaXMuX2V2ZW50U2hlZXQgPSBudWxsCiAgICB9CiAgICBHZXRSdW50aW1lKCkgewogICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lCiAgICB9CiAgICBHZXROYW1lKCkgewogICAgICAgIHJldHVybiB0aGlzLl9uYW1lCiAgICB9CiAgICBHZXRTSUQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3NpZAogICAgfQogICAgR2V0SW5kZXgoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2luZGV4CiAgICB9CiAgICBHZXRFZmZlY3RMaXN0KCkgewogICAgICAgIHJldHVybiB0aGlzLl9lZmZlY3RMaXN0CiAgICB9CiAgICBHZXRFZmZlY3RDaGFpbigpIHsKICAgICAgICB0aGlzLl9NYXliZVJlYnVpbGRFZmZlY3RDaGFpblN0ZXBzKCk7CiAgICAgICAgcmV0dXJuIHRoaXMuX2VmZmVjdENoYWluCiAgICB9CiAgICBfTWF5YmVSZWJ1aWxkRWZmZWN0Q2hhaW5TdGVwcygpIHsKICAgICAgICBjb25zdCBhID0gImxvdyIgPT09IHRoaXMuX3J1bnRpbWUuR2V0Q2FudmFzTWFuYWdlcigpLkdldEN1cnJlbnRGdWxsc2NyZWVuU2NhbGluZ1F1YWxpdHkoKTsKICAgICAgICBpZiAodGhpcy5fbmVlZHNSZWJ1aWxkRWZmZWN0Q2hhaW5TdGVwcyB8fCB0aGlzLl93YXNGdWxsU2NyZWVuUXVhbGl0eUxvdyAhPT0gYSkgewogICAgICAgICAgICB2YXIgYiA9IHRoaXMuR2V0RWZmZWN0TGlzdCgpLkdldEFjdGl2ZUVmZmVjdFR5cGVzKCk7CiAgICAgICAgICAgIHRoaXMuX2VmZmVjdENoYWluLkJ1aWxkU3RlcHMoYi5tYXAoZCA9PiBkLkdldFNoYWRlclByb2dyYW0oKSksIHsKICAgICAgICAgICAgICAgIGluZGV4TWFwOiBiLm1hcChkID0+IGQuR2V0SW5kZXgoKSksCiAgICAgICAgICAgICAgICBmb3JjZVBvc3REcmF3OiBhLAogICAgICAgICAgICAgICAgdXNlRnVsbFN1cmZhY2U6ICEwCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0aGlzLl9uZWVkc1JlYnVpbGRFZmZlY3RDaGFpblN0ZXBzID0gITE7CiAgICAgICAgICAgIHRoaXMuX3dhc0Z1bGxTY3JlZW5RdWFsaXR5TG93ID0gYQogICAgICAgIH0KICAgIH0KICAgIFVwZGF0ZUFjdGl2ZUVmZmVjdHMoKSB7CiAgICAgICAgdGhpcy5HZXRFZmZlY3RMaXN0KCkuVXBkYXRlQWN0aXZlRWZmZWN0cygpOwogICAgICAgIHRoaXMuX25lZWRzUmVidWlsZEVmZmVjdENoYWluU3RlcHMgPSAhMAogICAgfQogICAgR2V0TWluTGF5ZXJTY2FsZSgpIHsKICAgICAgICBsZXQgYSA9IHRoaXMuX2FsbExheWVyc0ZsYXRbMF0uR2V0Tm9ybWFsU2NhbGUoKTsKICAgICAgICBmb3IgKGxldCBiID0gMSwgZCA9IHRoaXMuX2FsbExheWVyc0ZsYXQubGVuZ3RoOyBiIDwgZDsgKytiKSB7CiAgICAgICAgICAgIGNvbnN0IGMgPSB0aGlzLl9hbGxMYXllcnNGbGF0W2JdOwogICAgICAgICAgICBpZiAoMCAhPT0gYy5HZXRQYXJhbGxheFgoKSB8fCAwICE9PSBjLkdldFBhcmFsbGF4WSgpKSBhID0gTWF0aC5taW4oYSwgYy5HZXROb3JtYWxTY2FsZSgpKQogICAgICAgIH0KICAgICAgICByZXR1cm4gYQogICAgfQogICAgX0dldFNjcm9sbEJvdW5kTWFyZ2luSG9yaXpvbnRhbCgpIHsKICAgICAgICByZXR1cm4gLjUgKiB0aGlzLl9ydW50aW1lLkdldFZpZXdwb3J0V2lkdGgoKSAvIHRoaXMuR2V0TWluTGF5ZXJTY2FsZSgpCiAgICB9CiAgICBfR2V0U2Nyb2xsQm91bmRNYXJnaW5WZXJ0aWNhbCgpIHsKICAgICAgICByZXR1cm4gLjUgKiB0aGlzLl9ydW50aW1lLkdldFZpZXdwb3J0SGVpZ2h0KCkgLyB0aGlzLkdldE1pbkxheWVyU2NhbGUoKQogICAgfQogICAgR2V0U2Nyb2xsTGVmdEJvdW5kKCkgewogICAgICAgIHJldHVybiB0aGlzLklzVW5ib3VuZGVkU2Nyb2xsaW5nKCkgPwogICAgICAgICAgICAtSW5maW5pdHkgOiB0aGlzLl9HZXRTY3JvbGxCb3VuZE1hcmdpbkhvcml6b250YWwoKQogICAgfQogICAgR2V0U2Nyb2xsUmlnaHRCb3VuZCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5Jc1VuYm91bmRlZFNjcm9sbGluZygpID8gSW5maW5pdHkgOiB0aGlzLkdldFdpZHRoKCkgLSB0aGlzLl9HZXRTY3JvbGxCb3VuZE1hcmdpbkhvcml6b250YWwoKQogICAgfQogICAgR2V0U2Nyb2xsVG9wQm91bmQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuSXNVbmJvdW5kZWRTY3JvbGxpbmcoKSA/IC1JbmZpbml0eSA6IHRoaXMuX0dldFNjcm9sbEJvdW5kTWFyZ2luVmVydGljYWwoKQogICAgfQogICAgR2V0U2Nyb2xsQm90dG9tQm91bmQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuSXNVbmJvdW5kZWRTY3JvbGxpbmcoKSA/IEluZmluaXR5IDogdGhpcy5HZXRIZWlnaHQoKSAtIHRoaXMuX0dldFNjcm9sbEJvdW5kTWFyZ2luVmVydGljYWwoKQogICAgfQogICAgU2V0U2Nyb2xsWChhKSB7CiAgICAgICAgY29uc3QgYiA9IHRoaXMuR2V0U2Nyb2xsTGVmdEJvdW5kKCksCiAgICAgICAgICAgIGQgPSB0aGlzLkdldFNjcm9sbFJpZ2h0Qm91bmQoKTsKICAgICAgICBhID4gZCAmJiAoYSA9IGQpOwogICAgICAgIGEgPCBiICYmIChhID0gYik7CiAgICAgICAgdGhpcy5fc2Nyb2xsWCAhPT0KICAgICAgICAgICAgYSAmJiAodGhpcy5fc2Nyb2xsWCA9IGEsIHRoaXMuX1NldEFsbExheWVyc01WQ2hhbmdlZCgpLCB0aGlzLl9ydW50aW1lLlVwZGF0ZVJlbmRlcigpKQogICAgfQogICAgR2V0U2Nyb2xsWCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fc2Nyb2xsWAogICAgfQogICAgU2V0U2Nyb2xsWShhKSB7CiAgICAgICAgY29uc3QgYiA9IHRoaXMuR2V0U2Nyb2xsVG9wQm91bmQoKSwKICAgICAgICAgICAgZCA9IHRoaXMuR2V0U2Nyb2xsQm90dG9tQm91bmQoKTsKICAgICAgICBhID4gZCAmJiAoYSA9IGQpOwogICAgICAgIGEgPCBiICYmIChhID0gYik7CiAgICAgICAgdGhpcy5fc2Nyb2xsWSAhPT0gYSAmJiAodGhpcy5fc2Nyb2xsWSA9IGEsIHRoaXMuX1NldEFsbExheWVyc01WQ2hhbmdlZCgpLCB0aGlzLl9ydW50aW1lLlVwZGF0ZVJlbmRlcigpKQogICAgfQogICAgR2V0U2Nyb2xsWSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fc2Nyb2xsWQogICAgfQogICAgSXNVbmJvdW5kZWRTY3JvbGxpbmcoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2lzVW5ib3VuZGVkU2Nyb2xsaW5nCiAgICB9CiAgICBCb3VuZFNjcm9sbGluZygpIHsKICAgICAgICB0aGlzLlNldFNjcm9sbFgodGhpcy5HZXRTY3JvbGxYKCkpOwogICAgICAgIHRoaXMuU2V0U2Nyb2xsWSh0aGlzLkdldFNjcm9sbFkoKSk7CiAgICAgICAgZm9yIChjb25zdCBhIG9mIHRoaXMuX2FsbExheWVyc0ZsYXQpIGEuSXNPd25TY3JvbGxQb3NpdGlvbkVuYWJsZWQoKSAmJgogICAgICAgICAgICAoYS5TZXRTY3JvbGxYKGEuR2V0U2Nyb2xsWCgpKSwgYS5TZXRTY3JvbGxZKGEuR2V0U2Nyb2xsWSgpKSkKICAgIH0KICAgIFNldFZhbmlzaGluZ1BvaW50WFkoYSwgYikgewogICAgICAgIGlmICh0aGlzLl92YW5pc2hpbmdQb2ludFggIT09IGEgfHwgdGhpcy5fdmFuaXNoaW5nUG9pbnRZICE9PSBiKSB0aGlzLl92YW5pc2hpbmdQb2ludFggPSBhLCB0aGlzLl92YW5pc2hpbmdQb2ludFkgPSBiLCB0aGlzLklzUGVyc3BlY3RpdmVQcm9qZWN0aW9uKCkgJiYgKHRoaXMuX1NldEFsbExheWVyc1Byb2plY3Rpb25DaGFuZ2VkKCksIHRoaXMuX1NldEFsbExheWVyc01WQ2hhbmdlZCgpLCB0aGlzLl9ydW50aW1lLlVwZGF0ZVJlbmRlcigpKQogICAgfQogICAgR2V0VmFuaXNoaW5nUG9pbnRYKCkgewogICAgICAgIHJldHVybiB0aGlzLklzT3J0aG9ncmFwaGljUHJvamVjdGlvbigpID8gLjUgOiB0aGlzLl92YW5pc2hpbmdQb2ludFgKICAgIH0KICAgIEdldFZhbmlzaGluZ1BvaW50WSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5Jc09ydGhvZ3JhcGhpY1Byb2plY3Rpb24oKSA/IC41IDogdGhpcy5fdmFuaXNoaW5nUG9pbnRZCiAgICB9CiAgICBIYXNWYW5pc2hpbmdQb2ludE91dHNpZGVWaWV3cG9ydCgpIHsKICAgICAgICBjb25zdCBhID0KICAgICAgICAgICAgdGhpcy5HZXRWYW5pc2hpbmdQb2ludFgoKSwKICAgICAgICAgICAgYiA9IHRoaXMuR2V0VmFuaXNoaW5nUG9pbnRZKCk7CiAgICAgICAgcmV0dXJuIDAgPiBhIHx8IDEgPCBhIHx8IDAgPiBiIHx8IDEgPCBiCiAgICB9CiAgICBTZXRQZXJzcGVjdGl2ZVByb2plY3Rpb24oKSB7CiAgICAgICAgdGhpcy5faXNPcnRob2dyYXBoaWNQcm9qZWN0aW9uICYmICh0aGlzLl9pc09ydGhvZ3JhcGhpY1Byb2plY3Rpb24gPSAhMSwgdGhpcy5fU2V0QWxsTGF5ZXJzUHJvamVjdGlvbkNoYW5nZWQoKSwgdGhpcy5fU2V0QWxsTGF5ZXJzTVZDaGFuZ2VkKCksIHRoaXMuX3J1bnRpbWUuVXBkYXRlUmVuZGVyKCkpCiAgICB9CiAgICBTZXRPcnRob2dyYXBoaWNQcm9qZWN0aW9uKCkgewogICAgICAgIHRoaXMuX2lzT3J0aG9ncmFwaGljUHJvamVjdGlvbiB8fCAodGhpcy5faXNPcnRob2dyYXBoaWNQcm9qZWN0aW9uID0gITAsIHRoaXMuX1NldEFsbExheWVyc1Byb2plY3Rpb25DaGFuZ2VkKCksIHRoaXMuX1NldEFsbExheWVyc01WQ2hhbmdlZCgpLCB0aGlzLl9ydW50aW1lLlVwZGF0ZVJlbmRlcigpKQogICAgfQogICAgSXNPcnRob2dyYXBoaWNQcm9qZWN0aW9uKCkgewogICAgICAgIHJldHVybiB0aGlzLl9pc09ydGhvZ3JhcGhpY1Byb2plY3Rpb24KICAgIH0KICAgIElzUGVyc3BlY3RpdmVQcm9qZWN0aW9uKCkgewogICAgICAgIHJldHVybiAhdGhpcy5Jc09ydGhvZ3JhcGhpY1Byb2plY3Rpb24oKQogICAgfQogICAgU2V0M0RDYW1lcmFFbmFibGVkKGEpIHsKICAgICAgICBhID0gISFhOwogICAgICAgIHRoaXMuX2lzM2RDYW1lcmFFbmFibGVkICE9PSBhICYmICh0aGlzLl9pczNkQ2FtZXJhRW5hYmxlZCA9IGEsIHRoaXMuX1NldEFsbExheWVyc01WQ2hhbmdlZCgpLCB0aGlzLl9ydW50aW1lLlVwZGF0ZVJlbmRlcigpKQogICAgfQogICAgSXMzRENhbWVyYUVuYWJsZWQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2lzM2RDYW1lcmFFbmFibGVkCiAgICB9CiAgICBTZXQzRENhbWVyYU9yaWVudGF0aW9uKGEsIGIsIGQsIGMsIGUsIGcsIGssIG0sIG4pIHsKICAgICAgICB2ZWMzRXF1YWxzWFlaKHRoaXMuX2NhbTNkcG9zaXRpb24sIGEsIGIsIGQpICYmIHZlYzNFcXVhbHNYWVoodGhpcy5fY2FtM2Rsb29rLCBjLCBlLCBnKSAmJiB2ZWMzRXF1YWxzWFlaKHRoaXMuX2NhbTNkdXAsIGssIG0sIG4pIHx8ICh2ZWMzJGpzY29tcCQ3LnNldCh0aGlzLl9jYW0zZHBvc2l0aW9uLCBhLCBiLCBkKSwgdmVjMyRqc2NvbXAkNy5zZXQodGhpcy5fY2FtM2Rsb29rLCBjLCBlLCBnKSwgdmVjMyRqc2NvbXAkNy5zZXQodGhpcy5fY2FtM2R1cCwgaywgbSwgbiksIHRoaXMuU2V0M0RDYW1lcmFDaGFuZ2VkKCkpCiAgICB9CiAgICBTZXQzRENhbWVyYUNoYW5nZWQoKSB7CiAgICAgICAgdGhpcy5fU2V0QWxsTGF5ZXJzTVZDaGFuZ2VkKCk7CiAgICAgICAgdGhpcy5fcnVudGltZS5VcGRhdGVSZW5kZXIoKQogICAgfQogICAgR2V0M0RDYW1lcmFQb3NpdGlvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5fY2FtM2Rwb3NpdGlvbgogICAgfQogICAgR2V0M0RDYW1lcmFMb29rQXQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2NhbTNkbG9vawogICAgfQogICAgR2V0M0RDYW1lcmFVcFZlY3RvcigpIHsKICAgICAgICByZXR1cm4gdGhpcy5fY2FtM2R1cAogICAgfQogICAgR2V0U2NhbGUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3NjYWxlCiAgICB9CiAgICBTZXRTY2FsZShhKSB7CiAgICAgICAgdGhpcy5fc2NhbGUgIT09IGEgJiYgKHRoaXMuX3NjYWxlID0gYSwgdGhpcy5fU2V0QWxsTGF5ZXJzTVZDaGFuZ2VkKCksIHRoaXMuQm91bmRTY3JvbGxpbmcoKSwgdGhpcy5fcnVudGltZS5VcGRhdGVSZW5kZXIoKSkKICAgIH0KICAgIFNldEFuZ2xlKGEpIHsKICAgICAgICBhID0gQzMkanNjb21wJDgxLmNsYW1wQW5nbGUoYSk7CiAgICAgICAgdGhpcy5fYW5nbGUgIT09IGEgJiYgKHRoaXMuX2FuZ2xlID0gYSwgdGhpcy5fU2V0QWxsTGF5ZXJzTVZDaGFuZ2VkKCksIHRoaXMuX3J1bnRpbWUuVXBkYXRlUmVuZGVyKCkpCiAgICB9CiAgICBHZXRBbmdsZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fYW5nbGUKICAgIH0KICAgIEdldFdpZHRoKCkgewogICAgICAgIHJldHVybiB0aGlzLl93aWR0aAogICAgfQogICAgU2V0V2lkdGgoYSkgewogICAgICAgICFpc0Zpbml0ZShhKSB8fAogICAgICAgICAgICAxID4gYSB8fCAodGhpcy5fd2lkdGggPSBhKQogICAgfQogICAgR2V0SGVpZ2h0KCkgewogICAgICAgIHJldHVybiB0aGlzLl9oZWlnaHQKICAgIH0KICAgIFNldEhlaWdodChhKSB7CiAgICAgICAgIWlzRmluaXRlKGEpIHx8IDEgPiBhIHx8ICh0aGlzLl9oZWlnaHQgPSBhKQogICAgfQogICAgR2V0RXZlbnRTaGVldCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZXZlbnRTaGVldAogICAgfSogYWxsTGF5ZXJzKCkgewogICAgICAgIGZvciAoY29uc3QgYSBvZiB0aGlzLl9yb290TGF5ZXJzKSB5aWVsZCogYS5zZWxmQW5kQWxsU3ViTGF5ZXJzKCkKICAgIH0KICAgIEdldExheWVycygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fYWxsTGF5ZXJzRmxhdAogICAgfQogICAgR2V0TGF5ZXJDb3VudCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fYWxsTGF5ZXJzRmxhdC5sZW5ndGgKICAgIH0KICAgIEdldExheWVyKGEpIHsKICAgICAgICByZXR1cm4gIm51bWJlciIgPT09IHR5cGVvZiBhID8gdGhpcy5HZXRMYXllckJ5SW5kZXgoYSkgOiB0aGlzLkdldExheWVyQnlOYW1lKGEudG9TdHJpbmcoKSkKICAgIH0KICAgIEdldExheWVyQnlJbmRleChhKSB7CiAgICAgICAgYSA9IEMzJGpzY29tcCQ4MS5jbGFtcChNYXRoLmZsb29yKGEpLCAwLCB0aGlzLl9hbGxMYXllcnNGbGF0Lmxlbmd0aCAtIDEpOwogICAgICAgIHJldHVybiB0aGlzLl9hbGxMYXllcnNGbGF0W2FdCiAgICB9CiAgICBHZXRMYXllckJ5TmFtZShhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2xheWVyc0J5TmFtZS5nZXQoYS50b0xvd2VyQ2FzZSgpKSB8fAogICAgICAgICAgICBudWxsCiAgICB9CiAgICBHZXRMYXllckJ5U0lEKGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5fbGF5ZXJzQnlTaWQuZ2V0KGEpIHx8IG51bGwKICAgIH0KICAgIF9TZXRBbGxMYXllcnNQcm9qZWN0aW9uQ2hhbmdlZCgpIHsKICAgICAgICBmb3IgKGNvbnN0IGEgb2YgdGhpcy5fYWxsTGF5ZXJzRmxhdCkgYS5fU2V0UHJvamVjdGlvbk1hdHJpeENoYW5nZWQoKQogICAgfQogICAgX1NldEFsbExheWVyc01WQ2hhbmdlZCgpIHsKICAgICAgICBmb3IgKGNvbnN0IGEgb2YgdGhpcy5fYWxsTGF5ZXJzRmxhdCkgYS5fU2V0TVZNYXRyaXhDaGFuZ2VkKCkKICAgIH0KICAgIFNhdmVUcmFuc2Zvcm0oKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgc2Nyb2xsWDogdGhpcy5HZXRTY3JvbGxYKCksCiAgICAgICAgICAgIHNjcm9sbFk6IHRoaXMuR2V0U2Nyb2xsWSgpLAogICAgICAgICAgICBzY2FsZTogdGhpcy5HZXRTY2FsZSgpLAogICAgICAgICAgICBhbmdsZTogdGhpcy5HZXRBbmdsZSgpLAogICAgICAgICAgICB2cFg6IHRoaXMuR2V0VmFuaXNoaW5nUG9pbnRYKCksCiAgICAgICAgICAgIHZwWTogdGhpcy5HZXRWYW5pc2hpbmdQb2ludFkoKQogICAgICAgIH0KICAgIH0KICAgIFJlc3RvcmVUcmFuc2Zvcm0oYSkgewogICAgICAgIHRoaXMuU2V0U2Nyb2xsWChhLnNjcm9sbFgpOwogICAgICAgIHRoaXMuU2V0U2Nyb2xsWShhLnNjcm9sbFkpOwogICAgICAgIHRoaXMuU2V0U2NhbGUoYS5zY2FsZSk7CiAgICAgICAgdGhpcy5TZXRBbmdsZShhLmFuZ2xlKTsKICAgICAgICB0aGlzLlNldFZhbmlzaGluZ1BvaW50WFkoYS52cFgsIGEudnBZKQogICAgfQogICAgR2V0TGF5b3V0QmFja2dyb3VuZENvbG9yKCkgewogICAgICAgIGxldCBhID0gdGhpcy5fcm9vdExheWVycy5maWx0ZXIoYiA9PiBiLlNob3VsZERyYXcoKSlbMF07CiAgICAgICAgZm9yICg7IGE7KSB7CiAgICAgICAgICAgIGlmICghYS5Jc1RyYW5zcGFyZW50KCkpIHJldHVybiB0ZW1wQ29sb3IkanNjb21wJDQuY29weVJnYihhLkdldEJhY2tncm91bmRDb2xvcigpKSwgdGVtcENvbG9yJGpzY29tcCQ0LnNldEEoMSksIHRlbXBDb2xvciRqc2NvbXAkNDsKICAgICAgICAgICAgaWYgKGEuVXNlc093blRleHR1cmUoKSkgcmV0dXJuIHRlbXBDb2xvciRqc2NvbXAkNC5zZXRSZ2JhKDAsIDAsIDAsIDApLCB0ZW1wQ29sb3IkanNjb21wJDQ7CiAgICAgICAgICAgIGEgPSBhLkdldFN1YkxheWVycygpLmZpbHRlcihiID0+IGIuU2hvdWxkRHJhdygpKVswXQogICAgICAgIH0KICAgICAgICB0ZW1wQ29sb3IkanNjb21wJDQuc2V0UmdiYSgwLCAwLCAwLCAwKTsKICAgICAgICByZXR1cm4gdGVtcENvbG9yJGpzY29tcCQ0CiAgICB9CiAgICBJc0ZpcnN0VmlzaXQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2lzRmlyc3RWaXNpdAogICAgfQogICAgX0dldEluaXRpYWxPYmplY3RDbGFzc2VzKCkgewogICAgICAgIHJldHVybiBbLi4udGhpcy5faW5pdGlhbE9iamVjdENsYXNzZXNdCiAgICB9CiAgICBfQWRkSW5pdGlhbE9iamVjdENsYXNzKGEpIHsKICAgICAgICBpZiAoYS5Jc0luQ29udGFpbmVyKCkpCiAgICAgICAgICAgIGZvciAoY29uc3QgYiBvZiBhLkdldENvbnRhaW5lcigpLkdldE9iamVjdFR5cGVzKCkpIHRoaXMuX2luaXRpYWxPYmplY3RDbGFzc2VzLmFkZChiKTsKICAgICAgICBlbHNlIHRoaXMuX2luaXRpYWxPYmplY3RDbGFzc2VzLmFkZChhKQogICAgfQogICAgX0dldFRleHR1cmVMb2FkZWRPYmplY3RUeXBlcygpIHsKICAgICAgICByZXR1cm4gWy4uLnRoaXMuX3RleHR1cmVMb2FkZWRUeXBlc10KICAgIH0KICAgIF9Mb2FkKGEsIGIpIHsKICAgICAgICBpZiAoYSA9PT0gdGhpcyB8fCAhYikgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpOwogICAgICAgIGEgJiYgKEMzJGpzY29tcCQ4MS5Db3B5U2V0KHRoaXMuX3RleHR1cmVMb2FkZWRUeXBlcywgYS5fdGV4dHVyZUxvYWRlZFR5cGVzKSwgYS5fdGV4dHVyZUxvYWRlZFR5cGVzLmNsZWFyKCkpOwogICAgICAgIGEgPSBbXTsKICAgICAgICBmb3IgKGNvbnN0IGQgb2YgdGhpcy5faW5pdGlhbE9iamVjdENsYXNzZXMpIHRoaXMuX3RleHR1cmVMb2FkZWRUeXBlcy5oYXMoZCkgfHwgKGEucHVzaChkLkxvYWRUZXh0dXJlcyhiKSksIHRoaXMuX3RleHR1cmVMb2FkZWRUeXBlcy5hZGQoZCkpOwogICAgICAgIHJldHVybiBQcm9taXNlLmFsbChhKQogICAgfQogICAgYXN5bmMgTWF5YmVMb2FkVGV4dHVyZXNGb3IoYSkgewogICAgICAgIGlmIChhLklzRmFtaWx5KCkpIHRocm93IEVycm9yKCJjYW5ub3QgbG9hZCB0ZXh0dXJlcyBmb3IgZmFtaWx5Iik7CiAgICAgICAgdmFyIGIgPSB0aGlzLl9ydW50aW1lLkdldFJlbmRlcmVyKCk7CiAgICAgICAgIWIgfHwgYi5Jc0NvbnRleHRMb3N0KCkgfHwgdGhpcy5fdGV4dHVyZUxvYWRlZFR5cGVzLmhhcyhhKSB8fCAodGhpcy5fdGV4dHVyZUxvYWRlZFR5cGVzLmFkZChhKSwgYiA9IGEuTG9hZFRleHR1cmVzKGIpLCB0aGlzLl9BZGRQZW5kaW5nVGV4dHVyZUxvYWRQcm9taXNlKGIpLCBhd2FpdCBiLCBhLk9uRHluYW1pY1RleHR1cmVMb2FkQ29tcGxldGUoKSwgdGhpcy5fcnVudGltZS5VcGRhdGVSZW5kZXIoKSkKICAgIH0KICAgIF9BZGRQZW5kaW5nVGV4dHVyZUxvYWRQcm9taXNlKGEpIHsKICAgICAgICB0aGlzLl90ZXh0dXJlTG9hZFBlbmRpbmdQcm9taXNlcy5hZGQoYSk7CiAgICAgICAgYS50aGVuKCgpID0+IHRoaXMuX3RleHR1cmVMb2FkUGVuZGluZ1Byb21pc2VzLmRlbGV0ZShhKSkuY2F0Y2goKCkgPT4gdGhpcy5fdGV4dHVyZUxvYWRQZW5kaW5nUHJvbWlzZXMuZGVsZXRlKGEpKQogICAgfQogICAgV2FpdEZvclBlbmRpbmdUZXh0dXJlTG9hZHNUb0NvbXBsZXRlKCkgewogICAgICAgIHJldHVybiBQcm9taXNlLmFsbChbLi4udGhpcy5fdGV4dHVyZUxvYWRQZW5kaW5nUHJvbWlzZXNdKQogICAgfQogICAgTWF5YmVVbmxvYWRUZXh0dXJlc0ZvcihhKSB7CiAgICAgICAgaWYgKGEuSXNGYW1pbHkoKSB8fAogICAgICAgICAgICAwIDwgYS5HZXRJbnN0YW5jZUNvdW50KCkpIHRocm93IEVycm9yKCJjYW5ub3QgdW5sb2FkIHRleHR1cmVzIik7CiAgICAgICAgY29uc3QgYiA9IHRoaXMuX3J1bnRpbWUuR2V0UmVuZGVyZXIoKTsKICAgICAgICBiICYmIHRoaXMuX3RleHR1cmVMb2FkZWRUeXBlcy5oYXMoYSkgJiYgKHRoaXMuX3RleHR1cmVMb2FkZWRUeXBlcy5kZWxldGUoYSksIGEuUmVsZWFzZVRleHR1cmVzKGIpKQogICAgfQogICAgX1VubG9hZChhLCBiKSB7CiAgICAgICAgaWYgKGEgIT09IHRoaXMgJiYgYikKICAgICAgICAgICAgZm9yIChjb25zdCBkIG9mIHRoaXMuX3RleHR1cmVMb2FkZWRUeXBlcykgZC5Jc0dsb2JhbCgpIHx8IGEuX2luaXRpYWxPYmplY3RDbGFzc2VzLmhhcyhkKSB8fCAoZC5SZWxlYXNlVGV4dHVyZXMoKSwgdGhpcy5fdGV4dHVyZUxvYWRlZFR5cGVzLmRlbGV0ZShkKSkKICAgIH0KICAgIF9PbldlYkdMQ29udGV4dExvc3QoKSB7CiAgICAgICAgdGhpcy5fdGV4dHVyZUxvYWRlZFR5cGVzLmNsZWFyKCkKICAgIH0KICAgIGFzeW5jIF9TdGFydFJ1bm5pbmcoYSkgewogICAgICAgIGNvbnN0IGIgPSB0aGlzLl9ydW50aW1lLAogICAgICAgICAgICBkID0gdGhpcy5fbGF5b3V0TWFuYWdlciwKICAgICAgICAgICAgYyA9IGIuR2V0RXZlbnRTaGVldE1hbmFnZXIoKTsKICAgICAgICB0aGlzLl9ldmVudFNoZWV0TmFtZSAmJiAodGhpcy5fZXZlbnRTaGVldCA9IGMuR2V0RXZlbnRTaGVldEJ5TmFtZSh0aGlzLl9ldmVudFNoZWV0TmFtZSksIHRoaXMuX2V2ZW50U2hlZXQuX1VwZGF0ZURlZXBJbmNsdWRlcygpKTsKICAgICAgICBkLl9TZXRNYWluUnVubmluZ0xheW91dCh0aGlzKTsKICAgICAgICB0aGlzLl93aWR0aCA9IHRoaXMuX29yaWdpbmFsV2lkdGg7CiAgICAgICAgdGhpcy5faGVpZ2h0ID0gdGhpcy5fb3JpZ2luYWxIZWlnaHQ7CiAgICAgICAgdGhpcy5fc2Nyb2xsWCA9IGIuR2V0T3JpZ2luYWxWaWV3cG9ydFdpZHRoKCkgLyAyOwogICAgICAgIHRoaXMuX3Njcm9sbFkgPSBiLkdldE9yaWdpbmFsVmlld3BvcnRIZWlnaHQoKSAvIDI7CiAgICAgICAgdGhpcy5Cb3VuZFNjcm9sbGluZygpOwogICAgICAgIHRoaXMuX1NldEFsbExheWVyc1Byb2plY3Rpb25DaGFuZ2VkKCk7CiAgICAgICAgdGhpcy5fU2V0QWxsTGF5ZXJzTVZDaGFuZ2VkKCk7CiAgICAgICAgdGhpcy5fTW92ZUdsb2JhbE9iamVjdHNUb1RoaXNMYXlvdXQoYSk7CiAgICAgICAgdGhpcy5fcnVudGltZS5TZXRVc2luZ0NyZWF0ZVByb21pc2VzKCEwKTsKICAgICAgICB0aGlzLl9DcmVhdGVJbml0aWFsSW5zdGFuY2VzKCk7CiAgICAgICAgdGhpcy5faXNGaXJzdFZpc2l0IHx8IHRoaXMuX0NyZWF0ZVBlcnNpc3RlZEluc3RhbmNlcygpOwogICAgICAgIHRoaXMuX0NyZWF0ZUFuZExpbmtDb250YWluZXJJbnN0YW5jZXModGhpcy5fY3JlYXRlZEluc3RhbmNlcyk7CiAgICAgICAgdGhpcy5fQ3JlYXRlSW5pdGlhbE5vbldvcmxkSW5zdGFuY2VzKCk7CiAgICAgICAgZC5DbGVhclBlbmRpbmdDaGFuZ2VMYXlvdXQoKTsKICAgICAgICBiLkZsdXNoUGVuZGluZ0luc3RhbmNlcygpOwogICAgICAgIHRoaXMuX3J1bnRpbWUuU2V0VXNpbmdDcmVhdGVQcm9taXNlcyghMSk7CiAgICAgICAgY29uc3QgZSA9IHRoaXMuX3J1bnRpbWUuR2V0Q3JlYXRlUHJvbWlzZXMoKTsKICAgICAgICBhd2FpdCBQcm9taXNlLmFsbChlKTsKICAgICAgICBDMyRqc2NvbXAkODEuY2xlYXJBcnJheShlKTsKICAgICAgICBpZiAoIWIuSXNMb2FkaW5nU3RhdGUoKSkgewogICAgICAgICAgICBmb3IgKGNvbnN0IGcgb2YgdGhpcy5fY3JlYXRlZEluc3RhbmNlcykgZy5TZXR1cEluaXRpYWxTY2VuZUdyYXBoQ29ubmVjdGlvbnMoKTsKICAgICAgICAgICAgZm9yIChjb25zdCBnIG9mIHRoaXMuX2NyZWF0ZWRJbnN0YW5jZXMpIGcuX1RyaWdnZXJPbkNyZWF0ZWQoKQogICAgICAgIH0KICAgICAgICBDMyRqc2NvbXAkODEuY2xlYXJBcnJheSh0aGlzLl9jcmVhdGVkSW5zdGFuY2VzKTsKICAgICAgICBhd2FpdCBQcm9taXNlLmFsbChbLi4udGhpcy5faW5pdGlhbE9iamVjdENsYXNzZXNdLm1hcChnID0+IGcuUHJlbG9hZFRleHR1cmVzV2l0aEluc3RhbmNlcyh0aGlzLl9ydW50aW1lLkdldFJlbmRlcmVyKCkpKSk7CiAgICAgICAgYSAmJiAoYi5EaXNwYXRjaGVyKCkuZGlzcGF0Y2hFdmVudChuZXcgQzMkanNjb21wJDgxLkV2ZW50KCJiZWZvcmVmaXJzdGxheW91dHN0YXJ0IikpLCBhd2FpdCBiLkRpc3BhdGNoVXNlclNjcmlwdEV2ZW50QXN5bmNXYWl0KG5ldyBDMyRqc2NvbXAkODEuRXZlbnQoImJlZm9yZXByb2plY3RzdGFydCIpKSk7CiAgICAgICAgYXdhaXQgdGhpcy5EaXNwYXRjaFVzZXJTY3JpcHRFdmVudEFzeW5jV2FpdChuZXcgQzMkanNjb21wJDgxLkV2ZW50KCJiZWZvcmVsYXlvdXRzdGFydCIpKTsKICAgICAgICBiLklzTG9hZGluZ1N0YXRlKCkgfHwgYXdhaXQgYi5UcmlnZ2VyQXN5bmMoQzMkanNjb21wJDgxLlBsdWdpbnMuU3lzdGVtLkNuZHMuT25MYXlvdXRTdGFydCwgbnVsbCwgbnVsbCk7CiAgICAgICAgYi5EaXNwYXRjaGVyKCkuZGlzcGF0Y2hFdmVudChuZXcgQzMkanNjb21wJDgxLkV2ZW50KCJhZnRlcmxheW91dHN0YXJ0IikpOwogICAgICAgIGF3YWl0IHRoaXMuRGlzcGF0Y2hVc2VyU2NyaXB0RXZlbnRBc3luY1dhaXQobmV3IEMzJGpzY29tcCQ4MS5FdmVudCgiYWZ0ZXJsYXlvdXRzdGFydCIpKTsKICAgICAgICBhICYmIChiLkRpc3BhdGNoZXIoKS5kaXNwYXRjaEV2ZW50KG5ldyBDMyRqc2NvbXAkODEuRXZlbnQoImFmdGVyZmlyc3RsYXlvdXRzdGFydCIpKSwgYXdhaXQgYi5EaXNwYXRjaFVzZXJTY3JpcHRFdmVudEFzeW5jV2FpdChuZXcgQzMkanNjb21wJDgxLkV2ZW50KCJhZnRlcnByb2plY3RzdGFydCIpKSk7CiAgICAgICAgYy5fUnVuUXVldWVkVHJpZ2dlcnMoZCk7CiAgICAgICAgYXdhaXQgdGhpcy5XYWl0Rm9yUGVuZGluZ1RleHR1cmVMb2Fkc1RvQ29tcGxldGUoKTsKICAgICAgICB0aGlzLl9pc0ZpcnN0VmlzaXQgPSAhMQogICAgfQogICAgX01vdmVHbG9iYWxPYmplY3RzVG9UaGlzTGF5b3V0KGEpIHsKICAgICAgICBmb3IgKGNvbnN0IGQgb2YgdGhpcy5fcnVudGltZS5HZXRBbGxPYmplY3RDbGFzc2VzKCkpCiAgICAgICAgICAgIGlmICghZC5Jc0ZhbWlseSgpICYmIGQuSXNXb3JsZFR5cGUoKSkKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgYyBvZiBkLkdldEluc3RhbmNlcygpKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZSA9CiAgICAgICAgICAgICAgICAgICAgICAgIGMuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSBlLkdldExheWVyKCk7CiAgICAgICAgICAgICAgICAgICAgYiA9IEMzJGpzY29tcCQ4MS5jbGFtcChiLkdldEluZGV4KCksIDAsIHRoaXMuX2FsbExheWVyc0ZsYXQubGVuZ3RoIC0gMSk7CiAgICAgICAgICAgICAgICAgICAgYiA9IHRoaXMuX2FsbExheWVyc0ZsYXRbYl07CiAgICAgICAgICAgICAgICAgICAgZS5fU2V0TGF5ZXIoYik7CiAgICAgICAgICAgICAgICAgICAgYi5fTWF5YmVBZGRJbnN0YW5jZShjKQogICAgICAgICAgICAgICAgfQogICAgICAgIGlmICghYSkKICAgICAgICAgICAgZm9yIChjb25zdCBkIG9mIHRoaXMuX2FsbExheWVyc0ZsYXQpIGQuX1NvcnRJbnN0YW5jZXNCeUxhc3RDYWNoZWRaSW5kZXgoITEpCiAgICB9CiAgICBfQ3JlYXRlSW5pdGlhbEluc3RhbmNlcygpIHsKICAgICAgICBmb3IgKGNvbnN0IGEgb2YgdGhpcy5fYWxsTGF5ZXJzRmxhdCkgYS5DcmVhdGVJbml0aWFsSW5zdGFuY2VzKHRoaXMuX2NyZWF0ZWRJbnN0YW5jZXMpLCBhLl9TdGFydCgpCiAgICB9CiAgICBfQ3JlYXRlUGVyc2lzdGVkSW5zdGFuY2VzKCkgewogICAgICAgIGxldCBhID0gITE7CiAgICAgICAgZm9yIChjb25zdCBbZCwgY10gb2YgT2JqZWN0LmVudHJpZXModGhpcy5fcGVyc2lzdERhdGEpKSB7CiAgICAgICAgICAgIGNvbnN0IGUgPSB0aGlzLl9ydW50aW1lLkdldE9iamVjdENsYXNzQnlTSUQocGFyc2VJbnQoZCwKICAgICAgICAgICAgICAgIDEwKSk7CiAgICAgICAgICAgIGlmIChlICYmICFlLklzRmFtaWx5KCkgJiYgZS5IYXNQZXJzaXN0QmVoYXZpb3IoKSkgewogICAgICAgICAgICAgICAgZm9yIChjb25zdCBnIG9mIGMpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYiA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgaWYgKGUuSXNXb3JsZFR5cGUoKSAmJiAoYiA9IHRoaXMuR2V0TGF5ZXJCeVNJRChnLncubCksICFiKSkgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgYiA9IHRoaXMuX3J1bnRpbWUuQ3JlYXRlSW5zdGFuY2VGcm9tRGF0YShlLCBiLCAhMSwgMCwgMCwgITApOwogICAgICAgICAgICAgICAgICAgIGIuTG9hZEZyb21Kc29uKGcpOwogICAgICAgICAgICAgICAgICAgIGEgPSAhMDsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9jcmVhdGVkSW5zdGFuY2VzLnB1c2goYikKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIEMzJGpzY29tcCQ4MS5jbGVhckFycmF5KGMpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZm9yIChjb25zdCBkIG9mIHRoaXMuX2FsbExheWVyc0ZsYXQpIGQuX1NvcnRJbnN0YW5jZXNCeUxhc3RDYWNoZWRaSW5kZXgoITApLCBkLlNldFpJbmRpY2VzQ2hhbmdlZCgpOwogICAgICAgIGEgJiYgKHRoaXMuX3J1bnRpbWUuRmx1c2hQZW5kaW5nSW5zdGFuY2VzKCksIHRoaXMuX3J1bnRpbWUuX1JlZnJlc2hVaWRNYXAoKSkKICAgIH0KICAgIF9DcmVhdGVBbmRMaW5rQ29udGFpbmVySW5zdGFuY2VzKGEpIHsKICAgICAgICBmb3IgKGNvbnN0IGQgb2YgYSkgewogICAgICAgICAgICBpZiAoIWQuSXNJbkNvbnRhaW5lcigpKSBjb250aW51ZTsKICAgICAgICAgICAgY29uc3QgYyA9IGQuR2V0V29ybGRJbmZvKCksCiAgICAgICAgICAgICAgICBlID0gZC5HZXRJSUQoKTsKICAgICAgICAgICAgZm9yIChjb25zdCBnIG9mIGQuR2V0T2JqZWN0Q2xhc3MoKS5HZXRDb250YWluZXIoKS5vYmplY3RUeXBlcygpKQogICAgICAgICAgICAgICAgaWYgKGcgIT09IGQuR2V0T2JqZWN0Q2xhc3MoKSkgewogICAgICAgICAgICAgICAgICAgIHZhciBiID0gZy5HZXRJbnN0YW5jZXMoKTsKICAgICAgICAgICAgICAgICAgICBiLmxlbmd0aCA+IGUgPyBkLl9BZGRTaWJsaW5nKGJbZV0pIDogKGIgPSBjID8gdGhpcy5fcnVudGltZS5DcmVhdGVJbnN0YW5jZUZyb21EYXRhKGcsIGMuR2V0TGF5ZXIoKSwgITAsIGMuR2V0WCgpLCBjLkdldFkoKSwgITApIDogdGhpcy5fcnVudGltZS5DcmVhdGVJbnN0YW5jZUZyb21EYXRhKGcsIG51bGwsICEwLCAwLCAwLCAhMCksIHRoaXMuX3J1bnRpbWUuRmx1c2hQZW5kaW5nSW5zdGFuY2VzKCksIGcuX1VwZGF0ZUlJRHMoKSwgZC5fQWRkU2libGluZyhiKSwgYS5wdXNoKGIpKQogICAgICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIF9DcmVhdGVJbml0aWFsTm9uV29ybGRJbnN0YW5jZXMoKSB7CiAgICAgICAgZm9yIChjb25zdCBhIG9mIHRoaXMuX2luaXRpYWxOb25Xb3JsZCkgdGhpcy5fcnVudGltZS5HZXRPYmplY3RDbGFzc0J5SW5kZXgoYVsxXSkuSXNJbkNvbnRhaW5lcigpIHx8CiAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuQ3JlYXRlSW5zdGFuY2VGcm9tRGF0YShhLCBudWxsLCAhMCkKICAgIH0KICAgIF9DcmVhdGVHbG9iYWxOb25Xb3JsZHMoKSB7CiAgICAgICAgY29uc3QgYSA9IFtdLAogICAgICAgICAgICBiID0gdGhpcy5faW5pdGlhbE5vbldvcmxkOwogICAgICAgIGxldCBkID0gMDsKICAgICAgICBmb3IgKGxldCBjID0gMCwgZSA9IGIubGVuZ3RoOyBjIDwgZTsgKytjKSB7CiAgICAgICAgICAgIGNvbnN0IGcgPSBiW2NdLAogICAgICAgICAgICAgICAgayA9IHRoaXMuX3J1bnRpbWUuR2V0T2JqZWN0Q2xhc3NCeUluZGV4KGdbMV0pOwogICAgICAgICAgICBrLklzR2xvYmFsKCkgPyBrLklzSW5Db250YWluZXIoKSAmJiBrLkdldENvbnRhaW5lcigpLkhhc0FueVdvcmxkVHlwZSgpIHx8IGEucHVzaCh0aGlzLl9ydW50aW1lLkNyZWF0ZUluc3RhbmNlRnJvbURhdGEoZywgbnVsbCwgITApKSA6IChiW2RdID0gZywgKytkKQogICAgICAgIH0KICAgICAgICBDMyRqc2NvbXAkODEudHJ1bmNhdGVBcnJheShiLCBkKTsKICAgICAgICB0aGlzLl9ydW50aW1lLkZsdXNoUGVuZGluZ0luc3RhbmNlcygpOwogICAgICAgIHRoaXMuX0NyZWF0ZUFuZExpbmtDb250YWluZXJJbnN0YW5jZXMoYSkKICAgIH0KICAgIFJlY3JlYXRlSW5pdGlhbE9iamVjdHMoYSwgYiwgZCwgYywgZSwgZykgewogICAgICAgIGlmIChkKSByZXR1cm4gZC5SZWNyZWF0ZUluaXRpYWxPYmplY3RzKGEsCiAgICAgICAgICAgIGIsIGMsIGUsIGcpOwogICAgICAgIGQgPSBbXTsKICAgICAgICBmb3IgKGNvbnN0IGsgb2YgdGhpcy5fYWxsTGF5ZXJzRmxhdCkgZC5wdXNoKGsuUmVjcmVhdGVJbml0aWFsT2JqZWN0cyhhLCBiLCBjLCBlLCBnKSk7CiAgICAgICAgcmV0dXJuIGQuZmxhdCgpCiAgICB9CiAgICBhc3luYyBfU3RvcFJ1bm5pbmcoKSB7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuX2xheW91dE1hbmFnZXI7CiAgICAgICAgdGhpcy5fcnVudGltZS5Jc0xvYWRpbmdTdGF0ZSgpIHx8IChhd2FpdCB0aGlzLkRpc3BhdGNoVXNlclNjcmlwdEV2ZW50QXN5bmNXYWl0KG5ldyBDMyRqc2NvbXAkODEuRXZlbnQoImJlZm9yZWxheW91dGVuZCIpKSwgYXdhaXQgdGhpcy5fcnVudGltZS5UcmlnZ2VyQXN5bmMoQzMkanNjb21wJDgxLlBsdWdpbnMuU3lzdGVtLkNuZHMuT25MYXlvdXRFbmQsIG51bGwsIG51bGwpLCBhd2FpdCB0aGlzLkRpc3BhdGNoVXNlclNjcmlwdEV2ZW50QXN5bmNXYWl0KG5ldyBDMyRqc2NvbXAkODEuRXZlbnQoImFmdGVybGF5b3V0ZW5kIikpKTsKICAgICAgICBhLlNldElzRW5kaW5nTGF5b3V0KCEwKTsKICAgICAgICB0aGlzLl9ydW50aW1lLkdldEV2ZW50U2hlZXRNYW5hZ2VyKCkuQ2xlYXJBbGxTY2hlZHVsZWRXYWl0cygpOwogICAgICAgIHRoaXMuX2lzRmlyc3RWaXNpdCB8fCB0aGlzLl9TYXZlUGVyc2lzdERhdGEoKTsKICAgICAgICBmb3IgKGNvbnN0IGIgb2YgdGhpcy5fYWxsTGF5ZXJzRmxhdCkgYi5fRW5kKCk7CiAgICAgICAgZm9yIChjb25zdCBiIG9mIHRoaXMuX3J1bnRpbWUuR2V0QWxsT2JqZWN0Q2xhc3NlcygpKQogICAgICAgICAgICBpZiAoIShiLklzR2xvYmFsKCkgfHwgYi5Jc1dvcmxkVHlwZSgpIHx8IGIuR2V0UGx1Z2luKCkuSXNTaW5nbGVHbG9iYWwoKSB8fCBiLklzRmFtaWx5KCkpKSB7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGQgb2YgYi5HZXRJbnN0YW5jZXMoKSkgdGhpcy5fcnVudGltZS5EZXN0cm95SW5zdGFuY2UoZCk7CiAgICAgICAgICAgICAgICB0aGlzLl9ydW50aW1lLkZsdXNoUGVuZGluZ0luc3RhbmNlcygpCiAgICAgICAgICAgIH0KICAgICAgICBhLlNldElzRW5kaW5nTGF5b3V0KCExKTsKICAgICAgICBhLkdldE1haW5SdW5uaW5nTGF5b3V0KCkgPT09IHRoaXMgJiYgYS5fU2V0TWFpblJ1bm5pbmdMYXlvdXQobnVsbCkKICAgIH0KICAgIF9TYXZlSW5zdGFuY2VUb1BlcnNpc3QoYSkgewogICAgICAgIGNvbnN0IGIgPSBhLkdldE9iamVjdENsYXNzKCkuR2V0U0lEKCkudG9TdHJpbmcoKTsKICAgICAgICB0aGlzLl9wZXJzaXN0RGF0YS5oYXNPd25Qcm9wZXJ0eShiKSB8fAogICAgICAgICAgICAodGhpcy5fcGVyc2lzdERhdGFbYl0gPSBbXSk7CiAgICAgICAgdGhpcy5fcGVyc2lzdERhdGFbYl0ucHVzaChhLlNhdmVUb0pzb24oKSkKICAgIH0KICAgIF9TYXZlUGVyc2lzdERhdGEoKSB7CiAgICAgICAgZm9yIChjb25zdCBhIG9mIHRoaXMuX2FsbExheWVyc0ZsYXQpIHsKICAgICAgICAgICAgYS5fVXBkYXRlWkluZGljZXMoKTsKICAgICAgICAgICAgZm9yIChjb25zdCBiIG9mIGEuX0dldEluc3RhbmNlcygpKSB7CiAgICAgICAgICAgICAgICBjb25zdCBkID0gYi5HZXRPYmplY3RDbGFzcygpOwogICAgICAgICAgICAgICAgIWQuSXNHbG9iYWwoKSAmJiBkLkhhc1BlcnNpc3RCZWhhdmlvcigpICYmIHRoaXMuX1NhdmVJbnN0YW5jZVRvUGVyc2lzdChiKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgUmVzZXRQZXJzaXN0RGF0YSgpIHsKICAgICAgICB0aGlzLl9wZXJzaXN0RGF0YSA9IHt9OwogICAgICAgIHRoaXMuX2lzRmlyc3RWaXNpdCA9ICEwCiAgICB9CiAgICBHZXRSZW5kZXJUYXJnZXQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2N1clJlbmRlclRhcmdldAogICAgfQogICAgVXNlc093blRleHR1cmUoKSB7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuX3J1bnRpbWUsCiAgICAgICAgICAgIGIgPSBhLkdldFJlbmRlcmVyKCkuSXNXZWJHTCgpOwogICAgICAgIHJldHVybiAibG93IiA9PT0gYS5HZXRDYW52YXNNYW5hZ2VyKCkuR2V0Q3VycmVudEZ1bGxzY3JlZW5TY2FsaW5nUXVhbGl0eSgpIHx8CiAgICAgICAgICAgIGIgJiYgYS5Vc2VzQW55QmFja2dyb3VuZEJsZW5kaW5nKCkgfHwgImxvdy1sYXRlbmN5IiA9PT0gYS5HZXRDb21wb3NpdGluZ01vZGUoKSB8fCB0aGlzLl9lZmZlY3RMaXN0Lkhhc0FueUFjdGl2ZUVmZmVjdCgpIHx8IGIgJiYgYS5Vc2VzM0RGZWF0dXJlcygpCiAgICB9CiAgICBEcmF3KGEpIHsKICAgICAgICBjb25zdCBiID0gdGhpcy5fcnVudGltZS5HZXRDYW52YXNNYW5hZ2VyKCksCiAgICAgICAgICAgIGQgPSB0aGlzLlVzZXNPd25UZXh0dXJlKCk7CiAgICAgICAgaWYgKGQpIHsKICAgICAgICAgICAgImxvdy1sYXRlbmN5IiAhPT0gdGhpcy5fcnVudGltZS5HZXRDb21wb3NpdGluZ01vZGUoKSAmJiAoYS5TZXRSZW5kZXJUYXJnZXQobnVsbCksIGEuQ2xlYXJSZ2JhKDAsIDAsIDAsIDApKTsKICAgICAgICAgICAgY29uc3QgYyA9IHsKICAgICAgICAgICAgICAgIHNhbXBsaW5nOiB0aGlzLl9ydW50aW1lLkdldFNhbXBsaW5nKCksCiAgICAgICAgICAgICAgICBpc1NhbXBsZWQ6IGEuSXNXZWJHUFUoKSB8fCB0aGlzLl9ydW50aW1lLlVzZXNBbnlCYWNrZ3JvdW5kQmxlbmRpbmcoKSB8fCB0aGlzLl9lZmZlY3RMaXN0Lkhhc0FueUFjdGl2ZUVmZmVjdCgpLAogICAgICAgICAgICAgICAgY2FuUmVhZFBpeGVsczogYS5Jc1dlYkdQVSgpID8gdGhpcy5fcnVudGltZS5Vc2VzQW55QmFja2dyb3VuZEJsZW5kaW5nKCkgOgogICAgICAgICAgICAgICAgICAgICExCiAgICAgICAgICAgIH07CiAgICAgICAgICAgICJsb3ciID09PSBiLkdldEN1cnJlbnRGdWxsc2NyZWVuU2NhbGluZ1F1YWxpdHkoKSAmJiAoYy53aWR0aCA9IGIuR2V0RHJhd1dpZHRoKCksIGMuaGVpZ2h0ID0gYi5HZXREcmF3SGVpZ2h0KCkpOwogICAgICAgICAgICB0aGlzLl9jdXJSZW5kZXJUYXJnZXQgPSB0aGlzLl9ydW50aW1lLkdldEFkZGl0aW9uYWxSZW5kZXJUYXJnZXQoYykKICAgICAgICB9IGVsc2UgdGhpcy5fY3VyUmVuZGVyVGFyZ2V0ID0gbnVsbDsKICAgICAgICBhLlNldFJlbmRlclRhcmdldCh0aGlzLl9jdXJSZW5kZXJUYXJnZXQpOwogICAgICAgIGEuQ2xlYXIodGhpcy5HZXRMYXlvdXRCYWNrZ3JvdW5kQ29sb3IoKSk7CiAgICAgICAgdGhpcy5fcnVudGltZS5Vc2VzM0RGZWF0dXJlcygpICYmIGEuQ2xlYXJEZXB0aCgpOwogICAgICAgIHRoaXMuX0RyYXdMYXllckxpc3QoYSwgdGhpcy5fY3VyUmVuZGVyVGFyZ2V0LCB0aGlzLl9yb290TGF5ZXJzLCAhMCk7CiAgICAgICAgZCAmJiAoYS5TZXREZXB0aEVuYWJsZWQoITEpLCB0aGlzLl9EcmF3TGF5b3V0T3duVGV4dHVyZVRvUmVuZGVyVGFyZ2V0KGEsIHRoaXMuX2N1clJlbmRlclRhcmdldCkpOwogICAgICAgIHRoaXMuX2N1clJlbmRlclRhcmdldCA9CiAgICAgICAgICAgIG51bGwKICAgIH0KICAgIF9EcmF3TGF5ZXJMaXN0KGEsIGIsIGQsIGMpIHsKICAgICAgICBkID0gZC5maWx0ZXIoZSA9PiBlLlNob3VsZERyYXcoKSk7CiAgICAgICAgZm9yIChsZXQgZSA9IDAsIGcgPSBkLmxlbmd0aDsgZSA8IGc7KSB7CiAgICAgICAgICAgIGNvbnN0IGsgPSBkW2VdOwogICAgICAgICAgICBpZiAoay5TZWxmQW5kQWxsU3ViTGF5ZXJzSGF2ZTNEQ2FtZXJhKCkgJiYgIWsuU2VsZk9yQW55U3ViTGF5ZXJVc2VzT3duVGV4dHVyZSgpKSB7CiAgICAgICAgICAgICAgICB0ZW1wUmVuZGVyM2RMaXN0LnB1c2goayk7CiAgICAgICAgICAgICAgICBmb3IgKGxldCBtID0gZSArIDE7IG0gPCBnOyArK20pIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBuID0gZFttXTsKICAgICAgICAgICAgICAgICAgICBpZiAobi5TZWxmQW5kQWxsU3ViTGF5ZXJzSGF2ZTNEQ2FtZXJhKCkgJiYgIW4uU2VsZk9yQW55U3ViTGF5ZXJVc2VzT3duVGV4dHVyZSgpKSB0ZW1wUmVuZGVyM2RMaXN0LnB1c2goZFttXSk7CiAgICAgICAgICAgICAgICAgICAgZWxzZSBicmVhawogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKDIgPD0gdGVtcFJlbmRlcjNkTGlzdC5sZW5ndGggfHwgMSA9PT0gdGVtcFJlbmRlcjNkTGlzdC5sZW5ndGggJiYgdGVtcFJlbmRlcjNkTGlzdFswXS5IYXNBbnlWaXNpYmxlU3ViTGF5ZXIoKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX0RyYXczRExheWVycyhhLCBiLCB0ZW1wUmVuZGVyM2RMaXN0KTsKICAgICAgICAgICAgICAgICAgICBlICs9IHRlbXBSZW5kZXIzZExpc3QubGVuZ3RoOwogICAgICAgICAgICAgICAgICAgIEMzJGpzY29tcCQ4MS5jbGVhckFycmF5KHRlbXBSZW5kZXIzZExpc3QpOwogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBDMyRqc2NvbXAkODEuY2xlYXJBcnJheSh0ZW1wUmVuZGVyM2RMaXN0KQogICAgICAgICAgICB9CiAgICAgICAgICAgIGsuRHJhdyhhLCBiLCBjICYmIDAgPT09IGUpOwogICAgICAgICAgICArK2UKICAgICAgICB9CiAgICB9CiAgICBfRHJhd0xheW91dE93blRleHR1cmVUb1JlbmRlclRhcmdldChhLCBiKSB7CiAgICAgICAgY29uc3QgZCA9IHRoaXMuX2VmZmVjdExpc3QuR2V0QWN0aXZlRWZmZWN0VHlwZXMoKSwKICAgICAgICAgICAgYyA9IHRoaXMuX3J1bnRpbWU7CiAgICAgICAgMCA9PT0gZC5sZW5ndGggPyAoYS5TZXRSZW5kZXJUYXJnZXQobnVsbCksIGEuU2V0VGV4dHVyZUZpbGxNb2RlKCksIGEuQ29weVJlbmRlclRhcmdldChiKSwgYS5JbnZhbGlkYXRlUmVuZGVyVGFyZ2V0KGIpLCBjLlJlbGVhc2VBZGRpdGlvbmFsUmVuZGVyVGFyZ2V0KGIpKSA6ICh0ZW1wTGF5b3V0UmVjdC5zZXQoMCwgMCwgYy5HZXRWaWV3cG9ydFdpZHRoKCksIGMuR2V0Vmlld3BvcnRIZWlnaHQoKSksIHRoaXMuR2V0RWZmZWN0Q2hhaW4oKS5SZW5kZXIoYSwgbnVsbCwgewogICAgICAgICAgICBjb250ZW50T2JqZWN0OiB0aGlzLAogICAgICAgICAgICBibGVuZE1vZGU6IDMsCiAgICAgICAgICAgIGRldmljZVBpeGVsUmF0aW86IHRoaXMuX3J1bnRpbWUuR2V0RWZmZWN0RGV2aWNlUGl4ZWxSYXRpb1BhcmFtKCksCiAgICAgICAgICAgIGxheWVyU2NhbGU6IHRoaXMuX3J1bnRpbWUuR2V0RWZmZWN0TGF5ZXJTY2FsZVBhcmFtKCkgKiB0aGlzLkdldFNjYWxlKCksCiAgICAgICAgICAgIGxheWVyQW5nbGU6IHRoaXMuR2V0QW5nbGUoKSwKICAgICAgICAgICAgbGF5b3V0UmVjdDogdGVtcExheW91dFJlY3QsCiAgICAgICAgICAgIGRyYXdTdXJmYWNlUmVjdDogbnVsbCwKICAgICAgICAgICAgaW52YWxpZGF0ZVJlbmRlclRhcmdldHM6ICEwCiAgICAgICAgfSkpCiAgICB9CiAgICBfRHJhdzNETGF5ZXJzKGEsIGIsIGQpIHsKICAgICAgICBkWzBdLklzVHJhbnNwYXJlbnQoKSB8fCAodGVtcENvbG9yJGpzY29tcCQ0LmNvcHlSZ2IoZFswXS5HZXRCYWNrZ3JvdW5kQ29sb3IoKSksIHRlbXBDb2xvciRqc2NvbXAkNC5zZXRBKDEpLCBhLkNsZWFyKHRlbXBDb2xvciRqc2NvbXAkNCkpOwogICAgICAgIHZhciBjID0gdGhpcy5fcnVudGltZS5HZXRDYW52YXNNYW5hZ2VyKCk7CiAgICAgICAgYS5TZXREZXB0aEVuYWJsZWQoITApOwogICAgICAgIGZvciAodmFyIGUgb2YgZCkgZS5fVXBkYXRlWkluZGljZXMoKSwKICAgICAgICAgICAgZS5fQXBwZW5kQWxsSW5zdGFuY2VzSW5jbHVkaW5nU3ViTGF5ZXJzSW5EcmF3T3JkZXIodGVtcEluc3RhbmNlTGlzdDEkanNjb21wJDEpOwogICAgICAgIGQgPSBkWzBdOwogICAgICAgIGUgPSBudWxsOwogICAgICAgIGlmICh0aGlzLl9ydW50aW1lLklzR1BVUHJvZmlsaW5nKCkpCiAgICAgICAgICAgIGlmIChhLklzV2ViR0woKSkgewogICAgICAgICAgICAgICAgaWYgKGMgPSBjLkdldExheWVyVGltaW5nc0J1ZmZlcihkKSkgZSA9IGMuQWRkVGltZUVsYXBzZWRRdWVyeSgpLCBhLlN0YXJ0UXVlcnkoZSkKICAgICAgICAgICAgfSBlbHNlIGEuSXNXZWJHUFUoKSAmJiBhLldyaXRlVGltZXN0YW1wKDIgKiAoZC5HZXRJbmRleCgpICsgMSkpOwogICAgICAgIGZvciAobGV0IHEgPSAwLCB1ID0gdGVtcEluc3RhbmNlTGlzdDEkanNjb21wJDEubGVuZ3RoOyBxIDwgdTspIHsKICAgICAgICAgICAgdmFyIGcgPSB0ZW1wSW5zdGFuY2VMaXN0MSRqc2NvbXAkMVtxXSwKICAgICAgICAgICAgICAgIGsgPSBnLkdldFdvcmxkSW5mbygpLAogICAgICAgICAgICAgICAgbSA9IGsuR2V0TGF5ZXIoKTsKICAgICAgICAgICAgaWYgKGsuSXNWaXNpYmxlKCkgJiYgay5Jc0luVmlld3BvcnQzRChtLl9HZXRWaWV3RnJ1c3R1bSgpKSkgewogICAgICAgICAgICAgICAgKCFnLlJlbmRlcnNUb093blpQbGFuZSgpIHx8IDAgPCBrLkdldERlcHRoKCkpICYmIHRlbXBJbnN0YW5jZUxpc3QzLnB1c2goZyk7CiAgICAgICAgICAgICAgICB2YXIgbiA9IGcuR2V0V29ybGRJbmZvKCkuR2V0VG90YWxaRWxldmF0aW9uKCk7CiAgICAgICAgICAgICAgICB0ZW1wSW5zdGFuY2VMaXN0MiRqc2NvbXAkMS5wdXNoKGcpOwogICAgICAgICAgICAgICAgZm9yIChjID0gcSArIDE7IGMgPCB1OyArK2MpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCB3ID0gdGVtcEluc3RhbmNlTGlzdDEkanNjb21wJDFbY10sCiAgICAgICAgICAgICAgICAgICAgICAgIHogPSB3LkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICAgICAgICAgIGlmICh6LklzVmlzaWJsZSgpICYmIHouSXNJblZpZXdwb3J0M0Qoei5HZXRMYXllcigpLl9HZXRWaWV3RnJ1c3R1bSgpKSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoei5HZXRUb3RhbFpFbGV2YXRpb24oKSAhPT0gbikgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIHcuUmVuZGVyc1RvT3duWlBsYW5lKCkgPyAoMCA8IHouR2V0RGVwdGgoKSAmJiB0ZW1wSW5zdGFuY2VMaXN0My5wdXNoKHcpLCB0ZW1wSW5zdGFuY2VMaXN0MiRqc2NvbXAkMS5wdXNoKHcpKSA6IHRlbXBJbnN0YW5jZUxpc3QzLnB1c2godykKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoMSAhPT0gdGVtcEluc3RhbmNlTGlzdDIkanNjb21wJDEubGVuZ3RoIHx8IHRlbXBJbnN0YW5jZUxpc3QyJGpzY29tcCQxWzBdLk11c3RNaXRpZ2F0ZVpGaWdodGluZygpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fRHJhdzNETGF5ZXJzQ29wbGFuYXJJbnN0YW5jZXMoYSwKICAgICAgICAgICAgICAgICAgICAgICAgYiwgdGVtcEluc3RhbmNlTGlzdDIkanNjb21wJDEpOwogICAgICAgICAgICAgICAgICAgIGZvciAobGV0IHcgPSAwLCB6ID0gdGVtcEluc3RhbmNlTGlzdDMubGVuZ3RoOyB3IDwgejsgKyt3KSBnID0gdGVtcEluc3RhbmNlTGlzdDNbd10sIGsgPSBnLkdldFdvcmxkSW5mbygpLCBtID0gay5HZXRMYXllcigpLCBrLl9TZXREcmF3Tm9uQmFja0ZhY2VzT25seSghMCksIE1heWJlUHJlcGFyZUxheWVyRHJhdyhtLCBhKSwgbS5fRHJhd0luc3RhbmNlTWF5YmVXaXRoRWZmZWN0cyhnLCBrLCBhLCBiKSwgay5fU2V0RHJhd05vbkJhY2tGYWNlc09ubHkoITEpCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIE1heWJlUHJlcGFyZUxheWVyRHJhdyhtLCBhKTsKICAgICAgICAgICAgICAgICAgICBtLl9EcmF3SW5zdGFuY2VNYXliZVdpdGhFZmZlY3RzKGcsIGssIGEsIGIpOwogICAgICAgICAgICAgICAgICAgIGZvciAobGV0IHcgPSAwLCB6ID0gdGVtcEluc3RhbmNlTGlzdDMubGVuZ3RoOyB3IDwgejsgKyt3KSBrID0gdGVtcEluc3RhbmNlTGlzdDNbd10sIGsgIT09IGcgJiYgKG0gPSBrLkdldFdvcmxkSW5mbygpLCBuID0gbS5HZXRMYXllcigpLCBNYXliZVByZXBhcmVMYXllckRyYXcobiwgYSksIG4uX0RyYXdJbnN0YW5jZU1heWJlV2l0aEVmZmVjdHMoaywKICAgICAgICAgICAgICAgICAgICAgICAgbSwgYSwgYikpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBxID0gYzsKICAgICAgICAgICAgICAgIEMzJGpzY29tcCQ4MS5jbGVhckFycmF5KHRlbXBJbnN0YW5jZUxpc3QyJGpzY29tcCQxKTsKICAgICAgICAgICAgICAgIEMzJGpzY29tcCQ4MS5jbGVhckFycmF5KHRlbXBJbnN0YW5jZUxpc3QzKQogICAgICAgICAgICB9IGVsc2UgKytxCiAgICAgICAgfQogICAgICAgIGUgJiYgYS5FbmRRdWVyeShlKTsKICAgICAgICB0aGlzLl9ydW50aW1lLklzR1BVUHJvZmlsaW5nKCkgJiYgYS5Jc1dlYkdQVSgpICYmIGEuV3JpdGVUaW1lc3RhbXAoMiAqIChkLkdldEluZGV4KCkgKyAxKSArIDEpOwogICAgICAgIEMzJGpzY29tcCQ4MS5jbGVhckFycmF5KHRlbXBJbnN0YW5jZUxpc3QxJGpzY29tcCQxKTsKICAgICAgICBsYXN0TGF5ZXJQcmVwYXJlZEZvckRyYXdpbmcgPSBudWxsCiAgICB9CiAgICBfRHJhdzNETGF5ZXJzQ29wbGFuYXJJbnN0YW5jZXMoYSwgYiwgZCkgewogICAgICAgIGEuQ29wbGFuYXJTdGFydFN0ZW5jaWxQYXNzKCk7CiAgICAgICAgZm9yIChsZXQgayA9IDAsIG0gPSBkLmxlbmd0aDsgayA8IG07ICsraykgewogICAgICAgICAgICB2YXIgYyA9IGRba10sCiAgICAgICAgICAgICAgICBlID0gYy5HZXRXb3JsZEluZm8oKSwKICAgICAgICAgICAgICAgIGcgPSBlLkdldExheWVyKCk7CiAgICAgICAgICAgIGUuX1NldERyYXdCYWNrRmFjZU9ubHkoITApOwogICAgICAgICAgICBNYXliZVByZXBhcmVMYXllckRyYXcoZywgYSk7CiAgICAgICAgICAgIGcuX0RyYXdJbnN0YW5jZShjLAogICAgICAgICAgICAgICAgZSwgYSkKICAgICAgICB9CiAgICAgICAgYS5Db3BsYW5hclN0YXJ0Q29sb3JQYXNzKCk7CiAgICAgICAgZm9yIChsZXQgayA9IDAsIG0gPSBkLmxlbmd0aDsgayA8IG07ICsraykgYyA9IGRba10sIGUgPSBjLkdldFdvcmxkSW5mbygpLCBnID0gZS5HZXRMYXllcigpLCBNYXliZVByZXBhcmVMYXllckRyYXcoZywgYSksIGcuX0RyYXdJbnN0YW5jZU1heWJlV2l0aEVmZmVjdHMoYywgZSwgYSwgYiksIGUuX1NldERyYXdCYWNrRmFjZU9ubHkoITEpOwogICAgICAgIGEuQ29wbGFuYXJSZXN0b3JlU3RhbmRhcmRSZW5kZXJpbmcoKQogICAgfQogICAgX1NhdmVUb0pzb24oKSB7CiAgICAgICAgY29uc3QgYSA9IHsKICAgICAgICAgICAgc3g6IHRoaXMuR2V0U2Nyb2xsWCgpLAogICAgICAgICAgICBzeTogdGhpcy5HZXRTY3JvbGxZKCksCiAgICAgICAgICAgIHM6IHRoaXMuR2V0U2NhbGUoKSwKICAgICAgICAgICAgYTogdGhpcy5HZXRBbmdsZSgpLAogICAgICAgICAgICB3OiB0aGlzLkdldFdpZHRoKCksCiAgICAgICAgICAgIGg6IHRoaXMuR2V0SGVpZ2h0KCksCiAgICAgICAgICAgIG9ydGhvOiB0aGlzLklzT3J0aG9ncmFwaGljUHJvamVjdGlvbigpLAogICAgICAgICAgICB2cFg6IHRoaXMuR2V0VmFuaXNoaW5nUG9pbnRYKCksCiAgICAgICAgICAgIHZwWTogdGhpcy5HZXRWYW5pc2hpbmdQb2ludFkoKSwKICAgICAgICAgICAgZnY6IHRoaXMuX2lzRmlyc3RWaXNpdCwKICAgICAgICAgICAgcGVyc2lzdDogdGhpcy5fcGVyc2lzdERhdGEsCiAgICAgICAgICAgIGZ4OiB0aGlzLl9lZmZlY3RMaXN0LlNhdmVUb0pzb24oKSwKICAgICAgICAgICAgbGF5ZXJzOiB7fQogICAgICAgIH07CiAgICAgICAgZm9yIChjb25zdCBiIG9mIHRoaXMuX2FsbExheWVyc0ZsYXQpIGEubGF5ZXJzW2IuR2V0U0lEKCkudG9TdHJpbmcoKV0gPSBiLl9TYXZlVG9Kc29uKCk7CiAgICAgICAgcmV0dXJuIGEKICAgIH0KICAgIF9Mb2FkRnJvbUpzb24oYSkgewogICAgICAgIHRoaXMuX3Njcm9sbFggPSBhLnN4OwogICAgICAgIHRoaXMuX3Njcm9sbFkgPSBhLnN5OwogICAgICAgIHRoaXMuX3NjYWxlID0gYS5zOwogICAgICAgIHRoaXMuX2FuZ2xlID0gYS5hOwogICAgICAgIHRoaXMuX3dpZHRoID0gYS53OwogICAgICAgIHRoaXMuX2hlaWdodCA9IGEuaDsKICAgICAgICB0aGlzLl9pc09ydGhvZ3JhcGhpY1Byb2plY3Rpb24gPSAhIWEub3J0aG87CiAgICAgICAgYS5oYXNPd25Qcm9wZXJ0eSgidnBYIikgJiYgKHRoaXMuX3ZhbmlzaGluZ1BvaW50WCA9IGEudnBYKTsKICAgICAgICBhLmhhc093blByb3BlcnR5KCJ2cFkiKSAmJiAodGhpcy5fdmFuaXNoaW5nUG9pbnRZID0gYS52cFkpOwogICAgICAgIHRoaXMuX2lzRmlyc3RWaXNpdCA9ICEhYS5mdjsKICAgICAgICB0aGlzLl9wZXJzaXN0RGF0YSA9IGEucGVyc2lzdDsKICAgICAgICB0aGlzLl9lZmZlY3RMaXN0LkxvYWRGcm9tSnNvbihhLmZ4KTsKICAgICAgICB0aGlzLl9uZWVkc1JlYnVpbGRFZmZlY3RDaGFpblN0ZXBzID0gITA7CiAgICAgICAgZm9yIChjb25zdCBbYiwgZF0gb2YgT2JqZWN0LmVudHJpZXMoYS5sYXllcnMpKSBhID0gcGFyc2VJbnQoYiwgMTApLCAoYSA9IHRoaXMuR2V0TGF5ZXJCeVNJRChhKSkgJiYgYS5fTG9hZEZyb21Kc29uKGQpOwogICAgICAgIHRoaXMuX1NldEFsbExheWVyc1Byb2plY3Rpb25DaGFuZ2VkKCk7CiAgICAgICAgdGhpcy5fU2V0QWxsTGF5ZXJzTVZDaGFuZ2VkKCkKICAgIH0KICAgIEdldElMYXlvdXQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2lMYXlvdXQKICAgIH0KICAgIFVzZXJTY3JpcHREaXNwYXRjaGVyKCkgewogICAgICAgIHJldHVybiB0aGlzLl91c2VyU2NyaXB0RGlzcGF0Y2hlcgogICAgfQogICAgRGlzcGF0Y2hVc2VyU2NyaXB0RXZlbnQoYSkgewogICAgICAgIGEubGF5b3V0ID0gdGhpcy5HZXRJTGF5b3V0KCk7CiAgICAgICAgdmFyIGIgPSB0aGlzLl9ydW50aW1lOwogICAgICAgIChiID0gYi5Jc0RlYnVnKCkgJiYgIWIuR2V0RXZlbnRTaGVldE1hbmFnZXIoKS5Jc0luRXZlbnRFbmdpbmUoKSkgJiYgQzNEZWJ1Z2dlci5TdGFydE1lYXN1cmluZ1NjcmlwdFRpbWUoKTsKICAgICAgICB0aGlzLl91c2VyU2NyaXB0RGlzcGF0Y2hlci5kaXNwYXRjaEV2ZW50KGEpOwogICAgICAgIGIgJiYgQzNEZWJ1Z2dlci5BZGRTY3JpcHRUaW1lKCkKICAgIH0KICAgIERpc3BhdGNoVXNlclNjcmlwdEV2ZW50QXN5bmNXYWl0KGEpIHsKICAgICAgICBhLmxheW91dCA9CiAgICAgICAgICAgIHRoaXMuR2V0SUxheW91dCgpOwogICAgICAgIHJldHVybiB0aGlzLl91c2VyU2NyaXB0RGlzcGF0Y2hlci5kaXNwYXRjaEV2ZW50QW5kV2FpdEFzeW5jKGEpCiAgICB9Cn07CiJ1c2Ugc3RyaWN0IjsKY29uc3QgQzMkanNjb21wJDgyID0gc2VsZi5DMzsKQzMkanNjb21wJDgyLkxheW91dE1hbmFnZXIgPSBjbGFzcyBleHRlbmRzIEMzJGpzY29tcCQ4Mi5EZWZlbmRlZEJhc2UgewogICAgY29uc3RydWN0b3IoYSkgewogICAgICAgIHN1cGVyKCk7CiAgICAgICAgdGhpcy5fcnVudGltZSA9IGE7CiAgICAgICAgdGhpcy5fYWxsTGF5b3V0cyA9IFtdOwogICAgICAgIHRoaXMuX2xheW91dHNCeU5hbWUgPSBuZXcgTWFwOwogICAgICAgIHRoaXMuX2xheW91dHNCeVNpZCA9IG5ldyBNYXA7CiAgICAgICAgdGhpcy5fbWFpblJ1bm5pbmdMYXlvdXQgPSBudWxsOwogICAgICAgIHRoaXMuX3J1bm5pbmdTdWJMYXlvdXRzID0gW107CiAgICAgICAgdGhpcy5fZmlyc3RMYXlvdXQgPSBudWxsOwogICAgICAgIHRoaXMuX2lzRW5kaW5nTGF5b3V0ID0gMDsKICAgICAgICB0aGlzLl9wZW5kaW5nQ2hhbmdlTGF5b3V0ID0gbnVsbAogICAgfQogICAgUmVsZWFzZSgpIHsKICAgICAgICB0aGlzLl9wZW5kaW5nQ2hhbmdlTGF5b3V0ID0gdGhpcy5fZmlyc3RMYXlvdXQgPSB0aGlzLl9tYWluUnVubmluZ0xheW91dCA9IHRoaXMuX3J1bnRpbWUgPSBudWxsOwogICAgICAgIEMzJGpzY29tcCQ4Mi5jbGVhckFycmF5KHRoaXMuX2FsbExheW91dHMpOwogICAgICAgIHRoaXMuX2xheW91dHNCeU5hbWUuY2xlYXIoKTsKICAgICAgICB0aGlzLl9sYXlvdXRzQnlTaWQuY2xlYXIoKTsKICAgICAgICBDMyRqc2NvbXAkODIuY2xlYXJBcnJheSh0aGlzLl9ydW5uaW5nU3ViTGF5b3V0cykKICAgIH0KICAgIENyZWF0ZShhKSB7CiAgICAgICAgYSA9IEMzJGpzY29tcCQ4Mi5OZXcoQzMkanNjb21wJDgyLkxheW91dCwgdGhpcywgdGhpcy5fYWxsTGF5b3V0cy5sZW5ndGgsIGEpOwogICAgICAgIHRoaXMuX2FsbExheW91dHMucHVzaChhKTsKICAgICAgICB0aGlzLl9sYXlvdXRzQnlOYW1lLnNldChhLkdldE5hbWUoKS50b0xvd2VyQ2FzZSgpLCBhKTsKICAgICAgICB0aGlzLl9sYXlvdXRzQnlTaWQuc2V0KGEuR2V0U0lEKCksIGEpCiAgICB9CiAgICBHZXRSdW50aW1lKCkgewogICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lCiAgICB9CiAgICBTZXRGaXJzdExheW91dChhKSB7CiAgICAgICAgdGhpcy5fZmlyc3RMYXlvdXQgPSBhCiAgICB9CiAgICBHZXRGaXJzdExheW91dCgpIHsKICAgICAgICBpZiAodGhpcy5fZmlyc3RMYXlvdXQpIHJldHVybiB0aGlzLl9maXJzdExheW91dDsKICAgICAgICBpZiAodGhpcy5fYWxsTGF5b3V0cy5sZW5ndGgpIHJldHVybiB0aGlzLl9hbGxMYXlvdXRzWzBdOwogICAgICAgIHRocm93IEVycm9yKCJubyBmaXJzdCBsYXlvdXQiKTsKICAgIH0KICAgIEdldExheW91dEJ5TmFtZShhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2xheW91dHNCeU5hbWUuZ2V0KGEudG9Mb3dlckNhc2UoKSkgfHwKICAgICAgICAgICAgbnVsbAogICAgfQogICAgR2V0TGF5b3V0QnlTSUQoYSkgewogICAgICAgIHJldHVybiB0aGlzLl9sYXlvdXRzQnlTaWQuZ2V0KGEpIHx8IG51bGwKICAgIH0KICAgIEdldExheW91dEJ5SW5kZXgoYSkgewogICAgICAgIGEgPSBDMyRqc2NvbXAkODIuY2xhbXAoTWF0aC5mbG9vcihhKSwgMCwgdGhpcy5fYWxsTGF5b3V0cy5sZW5ndGggLSAxKTsKICAgICAgICByZXR1cm4gdGhpcy5fYWxsTGF5b3V0c1thXQogICAgfQogICAgR2V0TGF5b3V0KGEpIHsKICAgICAgICByZXR1cm4gIm51bWJlciIgPT09IHR5cGVvZiBhID8gdGhpcy5HZXRMYXlvdXRCeUluZGV4KGEpIDogdGhpcy5HZXRMYXlvdXRCeU5hbWUoYS50b1N0cmluZygpKQogICAgfQogICAgR2V0QWxsTGF5b3V0cygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fYWxsTGF5b3V0cwogICAgfQogICAgX1NldE1haW5SdW5uaW5nTGF5b3V0KGEpIHsKICAgICAgICB0aGlzLl9tYWluUnVubmluZ0xheW91dCA9IGEKICAgIH0KICAgIEdldE1haW5SdW5uaW5nTGF5b3V0KCkgewogICAgICAgIHJldHVybiB0aGlzLl9tYWluUnVubmluZ0xheW91dAogICAgfQogICAgX0FkZFJ1bm5pbmdTdWJMYXlvdXQoYSkgewogICAgICAgIGlmICh0aGlzLl9ydW5uaW5nU3ViTGF5b3V0cy5pbmNsdWRlcyhhKSkgdGhyb3cgRXJyb3IoImxheW91dCBhbHJlYWR5IHJ1bm5pbmciKTsKICAgICAgICB0aGlzLl9ydW5uaW5nU3ViTGF5b3V0cy5wdXNoKGEpCiAgICB9CiAgICBfUmVtb3ZlUnVubmluZ1N1YkxheW91dChhKSB7CiAgICAgICAgYSA9IHRoaXMuX3J1bm5pbmdTdWJMYXlvdXRzLmluZGV4T2YoYSk7CiAgICAgICAgaWYgKC0xID09PSBhKSB0aHJvdyBFcnJvcigibGF5b3V0IG5vdCBydW5uaW5nIik7CiAgICAgICAgdGhpcy5fcnVubmluZ1N1YkxheW91dHMuc3BsaWNlKGEsIDEpCiAgICB9KiBydW5uaW5nTGF5b3V0cygpIHsKICAgICAgICB0aGlzLl9tYWluUnVubmluZ0xheW91dCAmJiAoeWllbGQgdGhpcy5fbWFpblJ1bm5pbmdMYXlvdXQpOwogICAgICAgIHRoaXMuX3J1bm5pbmdTdWJMYXlvdXRzLmxlbmd0aCAmJiAoeWllbGQqIHRoaXMuX3J1bm5pbmdTdWJMYXlvdXRzKQogICAgfQogICAgSXNMYXlvdXRSdW5uaW5nKGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5fbWFpblJ1bm5pbmdMYXlvdXQgPT09IGEgfHwgdGhpcy5fcnVubmluZ1N1YkxheW91dHMuaW5jbHVkZXMoYSkKICAgIH0KICAgIFNldElzRW5kaW5nTGF5b3V0KGEpIHsKICAgICAgICBpZiAoYSkgdGhpcy5faXNFbmRpbmdMYXlvdXQrKzsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgaWYgKDAgPj0gdGhpcy5faXNFbmRpbmdMYXlvdXQpIHRocm93IEVycm9yKCJhbHJlYWR5IHVuc2V0Iik7CiAgICAgICAgICAgIHRoaXMuX2lzRW5kaW5nTGF5b3V0LS0KICAgICAgICB9CiAgICB9CiAgICBJc0VuZGluZ0xheW91dCgpIHsKICAgICAgICByZXR1cm4gMCA8IHRoaXMuX2lzRW5kaW5nTGF5b3V0CiAgICB9CiAgICBDaGFuZ2VNYWluTGF5b3V0KGEpIHsKICAgICAgICB0aGlzLl9wZW5kaW5nQ2hhbmdlTGF5b3V0ID0gYQogICAgfQogICAgQ2xlYXJQZW5kaW5nQ2hhbmdlTGF5b3V0KCkgewogICAgICAgIHRoaXMuX3BlbmRpbmdDaGFuZ2VMYXlvdXQgPSBudWxsCiAgICB9CiAgICBJc1BlbmRpbmdDaGFuZ2VNYWluTGF5b3V0KCkgewogICAgICAgIHJldHVybiAhIXRoaXMuX3BlbmRpbmdDaGFuZ2VMYXlvdXQKICAgIH0KICAgIEdldFBlbmRpbmdDaGFuZ2VNYWluTGF5b3V0KCkgewogICAgICAgIHJldHVybiB0aGlzLl9wZW5kaW5nQ2hhbmdlTGF5b3V0CiAgICB9CiAgICBTZXRBbGxMYXllclByb2plY3Rpb25DaGFuZ2VkKCkgewogICAgICAgIGNvbnN0IGEgPSB0aGlzLkdldE1haW5SdW5uaW5nTGF5b3V0KCk7CiAgICAgICAgYSAmJiBhLl9TZXRBbGxMYXllcnNQcm9qZWN0aW9uQ2hhbmdlZCgpCiAgICB9CiAgICBTZXRBbGxMYXllck1WQ2hhbmdlZCgpIHsKICAgICAgICBjb25zdCBhID0gdGhpcy5HZXRNYWluUnVubmluZ0xheW91dCgpOwogICAgICAgIGEgJiYgYS5fU2V0QWxsTGF5ZXJzTVZDaGFuZ2VkKCkKICAgIH0KfTsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkODMgPSBzZWxmLkMzLAogICAgTkFNRVNfUkVHRVhQID0gUmVnRXhwKCI8KC4rPyk+IiwgImciKTsKQzMkanNjb21wJDgzLlRpbWVsaW5lTWFuYWdlciA9IGNsYXNzIGV4dGVuZHMgQzMkanNjb21wJDgzLkRlZmVuZGVkQmFzZSB7CiAgICBjb25zdHJ1Y3RvcihhKSB7CiAgICAgICAgc3VwZXIoKTsKICAgICAgICB0aGlzLl9ydW50aW1lID0gYTsKICAgICAgICB0aGlzLl90aW1lbGluZURhdGFNYW5hZ2VyID0gQzMkanNjb21wJDgzLk5ldyhDMyRqc2NvbXAkODMuVGltZWxpbmVEYXRhTWFuYWdlcik7CiAgICAgICAgdGhpcy5fcGx1Z2luSW5zdGFuY2UgPSBudWxsOwogICAgICAgIHRoaXMuX3RpbWVsaW5lcyA9IFtdOwogICAgICAgIHRoaXMuX3RpbWVsaW5lc0J5TmFtZSA9IG5ldyBNYXA7CiAgICAgICAgdGhpcy5fb2JqZWN0Q2xhc3NUb1RpbWVsaW5lTWFwID0gbmV3IE1hcDsKICAgICAgICB0aGlzLl90aW1lbGluZXNDcmVhdGVkQnlUZW1wbGF0ZSA9IG5ldyBNYXA7CiAgICAgICAgdGhpcy5fc2NoZWR1bGVkVGltZWxpbmVzID0gW107CiAgICAgICAgdGhpcy5fcGxheWluZ1RpbWVsaW5lcyA9IFtdOwogICAgICAgIHRoaXMuX21hcmtlZEZvclJlbW92YWxUaW1lbGluZXMgPSBbXTsKICAgICAgICB0aGlzLl9pc1RpY2tpbmdUaW1lbGluZXMgPSB0aGlzLl9jaGFuZ2luZ0xheW91dCA9IHRoaXMuX2hhc1J1bnRpbWVMaXN0ZW5lcnMgPSAhMTsKICAgICAgICB0aGlzLl90aWNrRnVuYyA9ICgpID0+IHRoaXMuX09uVGljaygpOwogICAgICAgIHRoaXMuX3RpY2syRnVuYyA9ICgpID0+IHRoaXMuX09uVGljazIoKTsKICAgICAgICB0aGlzLl9iZWZvcmVMYXlvdXRDaGFuZ2UgPSAoKSA9PiB0aGlzLl9PbkJlZm9yZUNoYW5nZUxheW91dCgpOwogICAgICAgIHRoaXMuX2xheW91dENoYW5nZSA9ICgpID0+IHRoaXMuX09uQWZ0ZXJDaGFuZ2VMYXlvdXQoKTsKICAgICAgICB0aGlzLl9pbnN0YW5jZURlc3Ryb3kgPSBiID0+IHRoaXMuX09uSW5zdGFuY2VEZXN0cm95KGIuaW5zdGFuY2UpOwogICAgICAgIHRoaXMuX2JlZm9yZUxvYWQgPSBiID0+IHRoaXMuX09uQmVmb3JlTG9hZCgpOwogICAgICAgIHRoaXMuX2FmdGVyTG9hZCA9IGIgPT4gdGhpcy5fT25BZnRlckxvYWQoKTsKICAgICAgICB0aGlzLl9hZnRlckxheW91dFN0YXJ0ID0gYiA9PiB0aGlzLl9PbkFmdGVyTGF5b3V0U3RhcnQoKTsKICAgICAgICB0aGlzLl9kZXN0cm95ZWRXaGlsZUxvYWRpbmdTdGF0ZSA9IFtdOwogICAgICAgIHRoaXMuX3JlbmRlckNoYW5nZSA9IDAKICAgIH0KICAgIFJlbGVhc2UoKSB7CiAgICAgICAgdGhpcy5SZW1vdmVSdW50aW1lTGlzdGVuZXJzKCk7CiAgICAgICAgdGhpcy5fYWZ0ZXJMb2FkID0gdGhpcy5faW5zdGFuY2VEZXN0cm95ID0KICAgICAgICAgICAgdGhpcy5fbGF5b3V0Q2hhbmdlID0gdGhpcy5fYmVmb3JlTGF5b3V0Q2hhbmdlID0gdGhpcy5fdGljazJGdW5jID0gdGhpcy5fdGlja0Z1bmMgPSBudWxsOwogICAgICAgIGZvciAoY29uc3QgYSBvZiB0aGlzLl90aW1lbGluZXMpIGEuU3RvcCgpLCBhLlJlbGVhc2UoKTsKICAgICAgICBDMyRqc2NvbXAkODMuY2xlYXJBcnJheSh0aGlzLl90aW1lbGluZXMpOwogICAgICAgIHRoaXMuX3RpbWVsaW5lcyA9IG51bGw7CiAgICAgICAgdGhpcy5fdGltZWxpbmVEYXRhTWFuYWdlci5SZWxlYXNlKCk7CiAgICAgICAgdGhpcy5fdGltZWxpbmVEYXRhTWFuYWdlciA9IG51bGw7CiAgICAgICAgQzMkanNjb21wJDgzLmNsZWFyQXJyYXkodGhpcy5fc2NoZWR1bGVkVGltZWxpbmVzKTsKICAgICAgICB0aGlzLl9zY2hlZHVsZWRUaW1lbGluZXMgPSBudWxsOwogICAgICAgIEMzJGpzY29tcCQ4My5jbGVhckFycmF5KHRoaXMuX3BsYXlpbmdUaW1lbGluZXMpOwogICAgICAgIHRoaXMuX3BsYXlpbmdUaW1lbGluZXMgPSBudWxsOwogICAgICAgIEMzJGpzY29tcCQ4My5jbGVhckFycmF5KHRoaXMuX21hcmtlZEZvclJlbW92YWxUaW1lbGluZXMpOwogICAgICAgIHRoaXMuX21hcmtlZEZvclJlbW92YWxUaW1lbGluZXMgPQogICAgICAgICAgICBudWxsOwogICAgICAgIHRoaXMuX3RpbWVsaW5lc0J5TmFtZS5jbGVhcigpOwogICAgICAgIHRoaXMuX3RpbWVsaW5lc0J5TmFtZSA9IG51bGw7CiAgICAgICAgdGhpcy5fb2JqZWN0Q2xhc3NUb1RpbWVsaW5lTWFwLmNsZWFyKCk7CiAgICAgICAgdGhpcy5fb2JqZWN0Q2xhc3NUb1RpbWVsaW5lTWFwID0gbnVsbDsKICAgICAgICB0aGlzLl90aW1lbGluZXNDcmVhdGVkQnlUZW1wbGF0ZS5jbGVhcigpOwogICAgICAgIHRoaXMuX3RpbWVsaW5lc0NyZWF0ZWRCeVRlbXBsYXRlID0gbnVsbDsKICAgICAgICBDMyRqc2NvbXAkODMuY2xlYXJBcnJheSh0aGlzLl9kZXN0cm95ZWRXaGlsZUxvYWRpbmdTdGF0ZSk7CiAgICAgICAgdGhpcy5fcnVudGltZSA9IHRoaXMuX2Rlc3Ryb3llZFdoaWxlTG9hZGluZ1N0YXRlID0gbnVsbAogICAgfQogICAgQWRkUnVudGltZUxpc3RlbmVycygpIHsKICAgICAgICBjb25zdCBhID0gdGhpcy5fcnVudGltZS5EaXNwYXRjaGVyKCk7CiAgICAgICAgYS5hZGRFdmVudExpc3RlbmVyKCJwcmV0aWNrIiwgdGhpcy5fdGlja0Z1bmMpOwogICAgICAgIGEuYWRkRXZlbnRMaXN0ZW5lcigidGljazIiLCB0aGlzLl90aWNrMkZ1bmMpOwogICAgICAgIGEuYWRkRXZlbnRMaXN0ZW5lcigiYmVmb3JlbGF5b3V0Y2hhbmdlIiwKICAgICAgICAgICAgdGhpcy5fYmVmb3JlTGF5b3V0Q2hhbmdlKTsKICAgICAgICBhLmFkZEV2ZW50TGlzdGVuZXIoImxheW91dGNoYW5nZSIsIHRoaXMuX2xheW91dENoYW5nZSk7CiAgICAgICAgYS5hZGRFdmVudExpc3RlbmVyKCJpbnN0YW5jZWRlc3Ryb3kiLCB0aGlzLl9pbnN0YW5jZURlc3Ryb3kpOwogICAgICAgIGEuYWRkRXZlbnRMaXN0ZW5lcigiYmVmb3JlbG9hZCIsIHRoaXMuX2JlZm9yZUxvYWQpOwogICAgICAgIGEuYWRkRXZlbnRMaXN0ZW5lcigiYWZ0ZXJsb2FkIiwgdGhpcy5fYWZ0ZXJMb2FkKTsKICAgICAgICBhLmFkZEV2ZW50TGlzdGVuZXIoImFmdGVybGF5b3V0c3RhcnQiLCB0aGlzLl9hZnRlckxheW91dFN0YXJ0KQogICAgfQogICAgUmVtb3ZlUnVudGltZUxpc3RlbmVycygpIHsKICAgICAgICBjb25zdCBhID0gdGhpcy5fcnVudGltZS5EaXNwYXRjaGVyKCk7CiAgICAgICAgYS5yZW1vdmVFdmVudExpc3RlbmVyKCJwcmV0aWNrIiwgdGhpcy5fdGlja0Z1bmMpOwogICAgICAgIGEucmVtb3ZlRXZlbnRMaXN0ZW5lcigidGljazIiLCB0aGlzLl90aWNrMkZ1bmMpOwogICAgICAgIGEucmVtb3ZlRXZlbnRMaXN0ZW5lcigiYmVmb3JlbGF5b3V0Y2hhbmdlIiwgdGhpcy5fYmVmb3JlTGF5b3V0Q2hhbmdlKTsKICAgICAgICBhLnJlbW92ZUV2ZW50TGlzdGVuZXIoImxheW91dGNoYW5nZSIsIHRoaXMuX2xheW91dENoYW5nZSk7CiAgICAgICAgYS5yZW1vdmVFdmVudExpc3RlbmVyKCJpbnN0YW5jZWRlc3Ryb3kiLCB0aGlzLl9pbnN0YW5jZURlc3Ryb3kpOwogICAgICAgIGEucmVtb3ZlRXZlbnRMaXN0ZW5lcigiYmVmb3JlbG9hZCIsIHRoaXMuX2JlZm9yZUxvYWQpOwogICAgICAgIGEucmVtb3ZlRXZlbnRMaXN0ZW5lcigiYWZ0ZXJsb2FkIiwgdGhpcy5fYWZ0ZXJMb2FkKTsKICAgICAgICBhLnJlbW92ZUV2ZW50TGlzdGVuZXIoImFmdGVybGF5b3V0c3RhcnQiLCB0aGlzLl9hZnRlckxheW91dFN0YXJ0KQogICAgfQogICAgQ3JlYXRlKGEpIHsKICAgICAgICB0aGlzLl90aW1lbGluZURhdGFNYW5hZ2VyLkFkZChhKTsKICAgICAgICBhID0gQzMkanNjb21wJDgzLlRpbWVsaW5lU3RhdGUuQ3JlYXRlSW5pdGlhbChhLCB0aGlzKTsKICAgICAgICB0aGlzLkFkZChhKTsKICAgICAgICB0aGlzLlNldFRpbWVsaW5lT2JqZWN0Q2xhc3Nlc1RvTWFwKGEpOwogICAgICAgIHRoaXMuX3RpbWVsaW5lc0NyZWF0ZWRCeVRlbXBsYXRlLnNldChhLkdldE5hbWUoKSwgMCkKICAgIH0KICAgIENyZWF0ZUZyb21UZW1wbGF0ZShhKSB7CiAgICAgICAgdmFyIGIgPQogICAgICAgICAgICB0aGlzLkdldFRpbWVsaW5lRGF0YU1hbmFnZXIoKTsKICAgICAgICBhID0gYS5HZXRUZW1wbGF0ZU5hbWUoKTsKICAgICAgICBiID0gYi5HZXQoYSk7CiAgICAgICAgYiA9IEMzJGpzY29tcCQ4My5UaW1lbGluZVN0YXRlLkNyZWF0ZUZyb21UZW1wbGF0ZShgJHthfToke3RoaXMuX3RpbWVsaW5lc0NyZWF0ZWRCeVRlbXBsYXRlLmdldChhKX1gLCBiLCB0aGlzKTsKICAgICAgICB0aGlzLl9JbmNyZWFzZVRlbXBsYXRlVGltZWxpbmVzQ291bnQoYSk7CiAgICAgICAgdGhpcy5BZGQoYik7CiAgICAgICAgcmV0dXJuIGIKICAgIH0KICAgIF9JbmNyZWFzZVRlbXBsYXRlVGltZWxpbmVzQ291bnQoYSkgewogICAgICAgIHRoaXMuX3RpbWVsaW5lc0NyZWF0ZWRCeVRlbXBsYXRlLnNldChhLCB0aGlzLl90aW1lbGluZXNDcmVhdGVkQnlUZW1wbGF0ZS5nZXQoYSkgKyAxKQogICAgfQogICAgX1NldENyZWF0ZWRUZW1wbGF0ZVRpbWVsaW5lc0NvdW50KCkgewogICAgICAgIGZvciAoY29uc3QgYSBvZiB0aGlzLl90aW1lbGluZXMpIHsKICAgICAgICAgICAgaWYgKGEuSXNUZW1wbGF0ZSgpKSBjb250aW51ZTsKICAgICAgICAgICAgY29uc3QgYiA9IGEuR2V0VGVtcGxhdGVOYW1lKCk7CiAgICAgICAgICAgIHRoaXMuX0luY3JlYXNlVGVtcGxhdGVUaW1lbGluZXNDb3VudChiKQogICAgICAgIH0KICAgIH0KICAgIF9DbGVhckNyZWF0ZWRUZW1wbGF0ZVRpbWVsaW5lc0NvdW50KCkgewogICAgICAgIGZvciAoY29uc3QgYSBvZiB0aGlzLl90aW1lbGluZXNDcmVhdGVkQnlUZW1wbGF0ZS5rZXlzKCkpIHRoaXMuX3RpbWVsaW5lc0NyZWF0ZWRCeVRlbXBsYXRlLnNldChhLAogICAgICAgICAgICAwKQogICAgfQogICAgQWRkKGEpIHsKICAgICAgICB0aGlzLl90aW1lbGluZXMucHVzaChhKTsKICAgICAgICB0aGlzLl90aW1lbGluZXNCeU5hbWUuc2V0KGEuR2V0TmFtZSgpLnRvTG93ZXJDYXNlKCksIGEpCiAgICB9CiAgICBSZW1vdmUoYSkgewogICAgICAgIGEuUmVtb3ZlZCgpOwogICAgICAgIGEuSXNUZW1wbGF0ZSgpIHx8IChDMyRqc2NvbXAkODMuYXJyYXlGaW5kUmVtb3ZlKHRoaXMuX3RpbWVsaW5lcywgYSksIEMzJGpzY29tcCQ4My5hcnJheUZpbmRSZW1vdmUodGhpcy5fc2NoZWR1bGVkVGltZWxpbmVzLCBhKSwgQzMkanNjb21wJDgzLmFycmF5RmluZFJlbW92ZSh0aGlzLl9wbGF5aW5nVGltZWxpbmVzLCBhKSwgQzMkanNjb21wJDgzLmFycmF5RmluZFJlbW92ZSh0aGlzLl9tYXJrZWRGb3JSZW1vdmFsVGltZWxpbmVzLCBhKSwgdGhpcy5fdGltZWxpbmVzQnlOYW1lLmRlbGV0ZShhLkdldE5hbWUoKS50b0xvd2VyQ2FzZSgpKSwgdGhpcy5SZW1vdmVUaW1lbGluZUZyb21PYmplY3RDbGFzc01hcChhKSwgYS5Jc1JlbGVhc2VkKCkgfHwgYS5SZWxlYXNlKCkpCiAgICB9CiAgICBUcmlnZ2VyKGEpIHsKICAgICAgICB0aGlzLl9ydW50aW1lLlRyaWdnZXIoYSwKICAgICAgICAgICAgdGhpcy5fcGx1Z2luSW5zdGFuY2UsIG51bGwpCiAgICB9CiAgICBHZXRSdW50aW1lKCkgewogICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lCiAgICB9CiAgICBHZXRUaW1lbGluZURhdGFNYW5hZ2VyKCkgewogICAgICAgIHJldHVybiB0aGlzLl90aW1lbGluZURhdGFNYW5hZ2VyCiAgICB9CiAgICBTZXRQbHVnaW5JbnN0YW5jZShhKSB7CiAgICAgICAgdGhpcy5fcGx1Z2luSW5zdGFuY2UgPSBhCiAgICB9CiAgICBHZXRQbHVnaW5JbnN0YW5jZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcGx1Z2luSW5zdGFuY2UKICAgIH0qIEdldFRpbWVsaW5lcygpIHsKICAgICAgICBmb3IgKGNvbnN0IGEgb2YgdGhpcy5fdGltZWxpbmVzKSB5aWVsZCBhCiAgICB9CiAgICBTZXRUaW1lbGluZU9iamVjdENsYXNzVG9NYXAoYSwgYikgewogICAgICAgIHRoaXMuX29iamVjdENsYXNzVG9UaW1lbGluZU1hcC5oYXMoYSkgfHwgdGhpcy5fb2JqZWN0Q2xhc3NUb1RpbWVsaW5lTWFwLnNldChhLCBuZXcgU2V0KTsKICAgICAgICB0aGlzLl9vYmplY3RDbGFzc1RvVGltZWxpbmVNYXAuZ2V0KGEpLmFkZChiKQogICAgfQogICAgU2V0VGltZWxpbmVPYmplY3RDbGFzc2VzVG9NYXAoYSkgewogICAgICAgIGZvciAoY29uc3QgYiBvZiBhLkdldE9iamVjdENsYXNzZXMoKSkgdGhpcy5TZXRUaW1lbGluZU9iamVjdENsYXNzVG9NYXAoYiwKICAgICAgICAgICAgYSkKICAgIH0KICAgIFJlbW92ZVRpbWVsaW5lRnJvbU9iamVjdENsYXNzTWFwKGEpIHsKICAgICAgICBmb3IgKGNvbnN0IFtiLCBkXSBvZiB0aGlzLl9vYmplY3RDbGFzc1RvVGltZWxpbmVNYXAuZW50cmllcygpKSBkLmhhcyhhKSAmJiAoZC5kZWxldGUoYSksIDAgPT09IGQuc2l6ZSAmJiB0aGlzLl9vYmplY3RDbGFzc1RvVGltZWxpbmVNYXAuZGVsZXRlKGIpKQogICAgfQogICAgR2V0VGltZWxpbmVzRm9yT2JqZWN0Q2xhc3MoYSkgewogICAgICAgIGlmICh0aGlzLl9vYmplY3RDbGFzc1RvVGltZWxpbmVNYXAuaGFzKGEpKSByZXR1cm4gdGhpcy5fb2JqZWN0Q2xhc3NUb1RpbWVsaW5lTWFwLmdldChhKQogICAgfQogICAgR2V0VGltZWxpbmVPZlRlbXBsYXRlRm9ySW5zdGFuY2VzKGEsIGIpIHsKICAgICAgICBpZiAoYikKICAgICAgICAgICAgZm9yIChjb25zdCBkIG9mIHRoaXMuX3RpbWVsaW5lcykKICAgICAgICAgICAgICAgIGlmIChiLmV2ZXJ5KGMgPT4gZC5IYXNUcmFja0luc3RhbmNlKGMuaW5zdGFuY2UsIGMudHJhY2tJZCkpICYmIGQuR2V0TmFtZSgpLmluY2x1ZGVzKGEuR2V0TmFtZSgpKSkgcmV0dXJuIGQKICAgIH0KICAgIEdldFRpbWVsaW5lQnlOYW1lKGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdGltZWxpbmVzQnlOYW1lLmdldChhLnRvTG93ZXJDYXNlKCkpIHx8CiAgICAgICAgICAgIG51bGwKICAgIH0KICAgIEdldFNjaGVkdWxlZE9yUGxheWluZ1RpbWVsaW5lQnlOYW1lKGEpIHsKICAgICAgICBmb3IgKGNvbnN0IGIgb2YgdGhpcy5fc2NoZWR1bGVkVGltZWxpbmVzKQogICAgICAgICAgICBpZiAoYi5HZXROYW1lKCkgPT09IGEpIHJldHVybiBiOwogICAgICAgIGZvciAoY29uc3QgYiBvZiB0aGlzLl9wbGF5aW5nVGltZWxpbmVzKQogICAgICAgICAgICBpZiAoYi5HZXROYW1lKCkgPT09IGEpIHJldHVybiBiOwogICAgICAgIHJldHVybiBudWxsCiAgICB9KiBHZXRUaW1lbGluZXNCeU5hbWUoYSkgewogICAgICAgIGlmIChOQU1FU19SRUdFWFAudGVzdChhKSkgewogICAgICAgICAgICBOQU1FU19SRUdFWFAubGFzdEluZGV4ID0gMDsKICAgICAgICAgICAgbGV0IGQ7CiAgICAgICAgICAgIHZhciBiID0gbmV3IFNldDsKICAgICAgICAgICAgZG8KICAgICAgICAgICAgICAgIGlmIChkID0gTkFNRVNfUkVHRVhQLmV4ZWMoYSkpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBjID0gZFsxXS5zcGxpdCgiLCIpOwogICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgZSBvZiBjKSBiLmFkZChlKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB3aGlsZSAoZCk7CiAgICAgICAgICAgIGZvciAoY29uc3QgYyBvZiBiLnZhbHVlcygpKShhID0gdGhpcy5HZXRUaW1lbGluZUJ5TmFtZShjKSkgJiYgKHlpZWxkIGEpOwogICAgICAgICAgICBiLmNsZWFyKCkKICAgICAgICB9IGVsc2UoYiA9IHRoaXMuR2V0VGltZWxpbmVCeU5hbWUoYSkpICYmICh5aWVsZCBiKQogICAgfSogR2V0VGltZWxpbmVzQnlUYWdzKGEpIHsKICAgICAgICBmb3IgKGNvbnN0IGIgb2YgdGhpcy5fdGltZWxpbmVzKSBiLkhhc1RhZ3MoYSkgJiYKICAgICAgICAgICAgKHlpZWxkIGIpCiAgICB9CiAgICBBZGRTY2hlZHVsZWRUaW1lbGluZShhKSB7CiAgICAgICAgdGhpcy5fc2NoZWR1bGVkVGltZWxpbmVzLmluY2x1ZGVzKGEpIHx8IHRoaXMuX3NjaGVkdWxlZFRpbWVsaW5lcy5wdXNoKGEpOwogICAgICAgIHRoaXMuX01heWJlRW5hYmxlUnVudGltZUxpc3RlbmVycygpCiAgICB9CiAgICBSZW1vdmVQbGF5aW5nVGltZWxpbmUoYSkgewogICAgICAgIEMzJGpzY29tcCQ4My5hcnJheUZpbmRSZW1vdmUodGhpcy5fcGxheWluZ1RpbWVsaW5lcywgYSk7CiAgICAgICAgdGhpcy5fTWF5YmVEaXNhYmxlUnVudGltZUxpc3RlbmVycygpCiAgICB9CiAgICBTY2hlZHVsZVRpbWVsaW5lKGEpIHsKICAgICAgICB0aGlzLl9wbGF5aW5nVGltZWxpbmVzLmluY2x1ZGVzKGEpID8gKGEuU2V0UGxheWluZyghMCksIGEuU2V0U2NoZWR1bGVkKCExKSwgYS5TZXRNYXJrZWRGb3JSZW1vdmFsKCExKSkgOiAoYS5TZXRQbGF5aW5nKCExKSwgYS5TZXRTY2hlZHVsZWQoITApLCBhLlNldE1hcmtlZEZvclJlbW92YWwoITEpLCB0aGlzLl9zY2hlZHVsZWRUaW1lbGluZXMuaW5jbHVkZXMoYSkgfHwgdGhpcy5fc2NoZWR1bGVkVGltZWxpbmVzLnB1c2goYSkpOwogICAgICAgIHRoaXMuX01heWJlRW5hYmxlUnVudGltZUxpc3RlbmVycygpCiAgICB9CiAgICBEZVNjaGVkdWxlVGltZWxpbmUoYSkgewogICAgICAgIGEuU2V0UGxheWluZyghMSk7CiAgICAgICAgYS5TZXRTY2hlZHVsZWQoITEpOwogICAgICAgIGEuUmVzb2x2ZVBsYXlQcm9taXNlKCk7CiAgICAgICAgQzMkanNjb21wJDgzLmFycmF5RmluZFJlbW92ZSh0aGlzLl9zY2hlZHVsZWRUaW1lbGluZXMsIGEpOwogICAgICAgIHRoaXMuX01heWJlRGlzYWJsZVJ1bnRpbWVMaXN0ZW5lcnMoKQogICAgfQogICAgQ29tcGxldGVUaW1lbGluZShhKSB7CiAgICAgICAgYS5TZXRQbGF5aW5nKCExKTsKICAgICAgICBhLlNldFNjaGVkdWxlZCghMSk7CiAgICAgICAgdGhpcy5fcGxheWluZ1RpbWVsaW5lcy5pbmNsdWRlcyhhKSAmJiAoYS5TZXRNYXJrZWRGb3JSZW1vdmFsKCEwKSwgdGhpcy5fbWFya2VkRm9yUmVtb3ZhbFRpbWVsaW5lcy5wdXNoKGEpLCBDMyRqc2NvbXAkODMuYXJyYXlGaW5kUmVtb3ZlKHRoaXMuX3BsYXlpbmdUaW1lbGluZXMsIGEpKQogICAgfQogICAgQ29tcGxldGVUaW1lbGluZUJlZm9yZUNoYW5nZU9mTGF5b3V0KGEpIHsKICAgICAgICBhLlNldFBsYXlpbmcoITEpOwogICAgICAgIGEuU2V0U2NoZWR1bGVkKCExKTsKICAgICAgICBhLlNldE1hcmtlZEZvclJlbW92YWwoITEpOwogICAgICAgIGEuU2V0UGxheWJhY2tSYXRlKDEpOwogICAgICAgIEMzJGpzY29tcCQ4My5hcnJheUZpbmRSZW1vdmUodGhpcy5fcGxheWluZ1RpbWVsaW5lcywgYSkKICAgIH0KICAgIENvbXBsZXRlVGltZWxpbmVBbmRSZXNvbHZlKGEpIHsKICAgICAgICB0aGlzLkNvbXBsZXRlVGltZWxpbmUoYSk7CiAgICAgICAgYS5SZXNvbHZlUGxheVByb21pc2UoKQogICAgfQogICAgX09uVGljaygpIHsKICAgICAgICBpZiAoIXRoaXMuR2V0UnVudGltZSgpLklzTG9hZGluZ1N0YXRlKCkgJiYgdGhpcy5faGFzUnVudGltZUxpc3RlbmVycyAmJiAhdGhpcy5fY2hhbmdpbmdMYXlvdXQpIHsKICAgICAgICAgICAgZm9yICh0aGlzLl9pc1RpY2tpbmdUaW1lbGluZXMgPSAhMDsgdGhpcy5fc2NoZWR1bGVkVGltZWxpbmVzLmxlbmd0aDspIHsKICAgICAgICAgICAgICAgIHZhciBhID0gdGhpcy5fc2NoZWR1bGVkVGltZWxpbmVzLnBvcCgpOwogICAgICAgICAgICAgICAgYS5TZXRJbml0aWFsU3RhdGUoKTsKICAgICAgICAgICAgICAgIDAgIT09IGEuR2V0UmVuZGVyQ2hhbmdlKCkgJiYgKHRoaXMuX3JlbmRlckNoYW5nZSA9IDEpOwogICAgICAgICAgICAgICAgdGhpcy5fcGxheWluZ1RpbWVsaW5lcy5wdXNoKGEpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgYSA9IHRoaXMuX3J1bnRpbWUuX0dldER0RmFzdCgpOwogICAgICAgICAgICB2YXIgYiA9IHRoaXMuX3J1bnRpbWUuR2V0RHQxKCksCiAgICAgICAgICAgICAgICBkID0gdGhpcy5fcnVudGltZS5HZXRUaW1lU2NhbGUoKTsKICAgICAgICAgICAgZm9yIChsZXQgYyA9IHRoaXMuX3BsYXlpbmdUaW1lbGluZXMubGVuZ3RoIC0gMTsgMCA8PSBjOyBjLS0pIHsKICAgICAgICAgICAgICAgIGNvbnN0IGUgPSB0aGlzLl9wbGF5aW5nVGltZWxpbmVzW2NdOwogICAgICAgICAgICAgICAgZSAmJiBlLlRpY2soYSwgZCwgYikKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLl9pc1RpY2tpbmdUaW1lbGluZXMgPSAhMTsKICAgICAgICAgICAgMCAhPT0gdGhpcy5fcmVuZGVyQ2hhbmdlICYmIHRoaXMuR2V0UnVudGltZSgpLlVwZGF0ZVJlbmRlcigpCiAgICAgICAgfQogICAgfQogICAgX09uVGljazIoKSB7CiAgICAgICAgaWYgKCF0aGlzLkdldFJ1bnRpbWUoKS5Jc0xvYWRpbmdTdGF0ZSgpICYmIHRoaXMuX2hhc1J1bnRpbWVMaXN0ZW5lcnMgJiYgIXRoaXMuX2NoYW5naW5nTGF5b3V0KSB7CiAgICAgICAgICAgIHZhciBhOwogICAgICAgICAgICBmb3IgKGxldCBiID0gMCwgZCA9IHRoaXMuX21hcmtlZEZvclJlbW92YWxUaW1lbGluZXMubGVuZ3RoOyBiIDwgZDsgYisrKSB7CiAgICAgICAgICAgICAgICBjb25zdCBjID0gdGhpcy5fbWFya2VkRm9yUmVtb3ZhbFRpbWVsaW5lc1tiXTsKICAgICAgICAgICAgICAgIGEgfHwgKGEgPSBuZXcgU2V0KTsKICAgICAgICAgICAgICAgIGMuUmVtb3ZlZCgpOwogICAgICAgICAgICAgICAgdGhpcy5fTWF5YmVFeGVjdXRlVGltZWxpbmVGaW5pc2hUcmlnZ2VycyhjKTsKICAgICAgICAgICAgICAgIGEuYWRkKGMpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGEpIHsKICAgICAgICAgICAgICAgIEMzJGpzY29tcCQ4My5hcnJheVJlbW92ZUFsbEluU2V0KHRoaXMuX21hcmtlZEZvclJlbW92YWxUaW1lbGluZXMsIGEpOwogICAgICAgICAgICAgICAgdGhpcy5fcmVuZGVyQ2hhbmdlID0gMDsKICAgICAgICAgICAgICAgIGZvciAobGV0IGIgPSAwLCBkID0gdGhpcy5fcGxheWluZ1RpbWVsaW5lcy5sZW5ndGg7IGIgPCBkOyBiKyspCiAgICAgICAgICAgICAgICAgICAgaWYgKDAgIT09IHRoaXMuX3BsYXlpbmdUaW1lbGluZXNbYl0uR2V0UmVuZGVyQ2hhbmdlKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVuZGVyQ2hhbmdlID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5fTWF5YmVEaXNhYmxlUnVudGltZUxpc3RlbmVycygpCiAgICAgICAgfQogICAgfQogICAgX01heWJlRXhlY3V0ZVRpbWVsaW5lRmluaXNoVHJpZ2dlcnMoYSkgewogICAgICAgIGEuSXNSZWxlYXNlZCgpIHx8IGEuSGFzVmFsaWRUcmFja3MoKSAmJiBhLklzQ29tcGxldGUoKSAmJiBhLkluaXRpYWxTdGF0ZVNldCgpICYmIGEuRmluaXNoVHJpZ2dlcnMoKQogICAgfQogICAgX01heWJlRW5hYmxlUnVudGltZUxpc3RlbmVycygpIHsKICAgICAgICB0aGlzLl9oYXNSdW50aW1lTGlzdGVuZXJzIHx8ICh0aGlzLl9oYXNSdW50aW1lTGlzdGVuZXJzID0gITApCiAgICB9CiAgICBfTWF5YmVEaXNhYmxlUnVudGltZUxpc3RlbmVycygpIHsKICAgICAgICB0aGlzLl9tYXJrZWRGb3JSZW1vdmFsVGltZWxpbmVzLmxlbmd0aCB8fAogICAgICAgICAgICB0aGlzLl9wbGF5aW5nVGltZWxpbmVzLmxlbmd0aCB8fCB0aGlzLl9zY2hlZHVsZWRUaW1lbGluZXMubGVuZ3RoIHx8IHRoaXMuX2lzVGlja2luZ1RpbWVsaW5lcyB8fCAodGhpcy5faGFzUnVudGltZUxpc3RlbmVycyA9ICExKQogICAgfQogICAgX09uQmVmb3JlQ2hhbmdlTGF5b3V0KCkgewogICAgICAgIGZvciAodGhpcy5fY2hhbmdpbmdMYXlvdXQgPSAhMDsgdGhpcy5fc2NoZWR1bGVkVGltZWxpbmVzLmxlbmd0aDspIHRoaXMuRGVTY2hlZHVsZVRpbWVsaW5lKHRoaXMuX3NjaGVkdWxlZFRpbWVsaW5lcy5wb3AoKSk7CiAgICAgICAgY29uc3QgYSA9IG5ldyBTZXQ7CiAgICAgICAgZm9yIChjb25zdCBiIG9mIHRoaXMuX3BsYXlpbmdUaW1lbGluZXMpIGIuX09uQmVmb3JlQ2hhbmdlTGF5b3V0KCkgJiYgKGIuUmVtb3ZlZCgpLCBhLmFkZChiKSk7CiAgICAgICAgQzMkanNjb21wJDgzLmFycmF5UmVtb3ZlQWxsSW5TZXQodGhpcy5fcGxheWluZ1RpbWVsaW5lcywgYSk7CiAgICAgICAgYS5jbGVhcigpOwogICAgICAgIGZvciAoY29uc3QgYiBvZiB0aGlzLl9tYXJrZWRGb3JSZW1vdmFsVGltZWxpbmVzKSBiLl9PbkJlZm9yZUNoYW5nZUxheW91dCgpICYmCiAgICAgICAgICAgIChiLlJlbW92ZWQoKSwgYS5hZGQoYikpOwogICAgICAgIEMzJGpzY29tcCQ4My5hcnJheVJlbW92ZUFsbEluU2V0KHRoaXMuX21hcmtlZEZvclJlbW92YWxUaW1lbGluZXMsIGEpOwogICAgICAgIHRoaXMuX01heWJlRGlzYWJsZVJ1bnRpbWVMaXN0ZW5lcnMoKTsKICAgICAgICBmb3IgKGNvbnN0IGIgb2YgdGhpcy5fdGltZWxpbmVzKSBiLkNsZWFuQ2FjaGVzKCkKICAgIH0KICAgIF9PbkFmdGVyQ2hhbmdlTGF5b3V0KCkgewogICAgICAgIHRoaXMuX2NoYW5naW5nTGF5b3V0ID0gITEKICAgIH0KICAgIF9Pbkluc3RhbmNlRGVzdHJveShhKSB7CiAgICAgICAgdmFyIGIgPSBhLkdldE9iamVjdENsYXNzKCk7CiAgICAgICAgaWYgKGIgPSB0aGlzLkdldFRpbWVsaW5lc0Zvck9iamVjdENsYXNzKGIpKQogICAgICAgICAgICBpZiAodGhpcy5fcnVudGltZS5Jc0xvYWRpbmdTdGF0ZSgpKSB0aGlzLl9kZXN0cm95ZWRXaGlsZUxvYWRpbmdTdGF0ZS5wdXNoKGEpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGQgb2YgYikgZC5Jc1RlbXBsYXRlKCkgfHwgKGQuSXNSZWxlYXNlZCgpID8gdGhpcy5SZW1vdmUoZCkgOiBkLkhhc1ZhbGlkVHJhY2tzKCkgfHwgKHRoaXMuX01heWJlRXhlY3V0ZVRpbWVsaW5lRmluaXNoVHJpZ2dlcnMoZCksCiAgICAgICAgICAgICAgICAgICAgdGhpcy5SZW1vdmUoZCkpKQogICAgfQogICAgX09uQmVmb3JlTG9hZCgpIHsKICAgICAgICBmb3IgKGNvbnN0IGEgb2YgdGhpcy5fc2NoZWR1bGVkVGltZWxpbmVzLm1hcChiID0+IGIpKSB0aGlzLl9NYXliZUV4ZWN1dGVUaW1lbGluZUZpbmlzaFRyaWdnZXJzKGEpLCB0aGlzLlJlbW92ZShhKTsKICAgICAgICBmb3IgKGNvbnN0IGEgb2YgdGhpcy5fcGxheWluZ1RpbWVsaW5lcy5tYXAoYiA9PiBiKSkgdGhpcy5fTWF5YmVFeGVjdXRlVGltZWxpbmVGaW5pc2hUcmlnZ2VycyhhKSwgdGhpcy5SZW1vdmUoYSkKICAgIH0KICAgIF9PbkFmdGVyTG9hZCgpIHsKICAgICAgICBmb3IgKGNvbnN0IGEgb2YgdGhpcy5fZGVzdHJveWVkV2hpbGVMb2FkaW5nU3RhdGUpIHRoaXMuX09uSW5zdGFuY2VEZXN0cm95KGEpOwogICAgICAgIEMzJGpzY29tcCQ4My5jbGVhckFycmF5KHRoaXMuX2Rlc3Ryb3llZFdoaWxlTG9hZGluZ1N0YXRlKQogICAgfQogICAgX09uQWZ0ZXJMYXlvdXRTdGFydCgpIHsKICAgICAgICBjb25zdCBhID0gdGhpcy5fcnVudGltZS5HZXRMYXlvdXRNYW5hZ2VyKCkuR2V0TWFpblJ1bm5pbmdMYXlvdXQoKTsKICAgICAgICBpZiAoYSkKICAgICAgICAgICAgZm9yIChjb25zdCBiIG9mIHRoaXMuX3RpbWVsaW5lcykgewogICAgICAgICAgICAgICAgY29uc3QgZCA9CiAgICAgICAgICAgICAgICAgICAgYi5HZXRTdGFydE9uTGF5b3V0KCk7CiAgICAgICAgICAgICAgICBkICYmIGEuR2V0TmFtZSgpID09PSBkICYmIHRoaXMuU2NoZWR1bGVUaW1lbGluZShiKQogICAgICAgICAgICB9CiAgICB9CiAgICBfU2F2ZVRvSnNvbigpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICB0aW1lbGluZXNKc29uOiB0aGlzLl9TYXZlVGltZWxpbmVzVG9Kc29uKCksCiAgICAgICAgICAgIHNjaGVkdWxlZFRpbWVsaW5lc0pzb246IHRoaXMuX1NhdmVTY2hlZHVsZWRUaW1lbGluZXNUb0pzb24oKSwKICAgICAgICAgICAgcGxheWluZ1RpbWVsaW5lc0pzb246IHRoaXMuX1NhdmVQbGF5aW5nVGltZWxpbmVzVG9Kc29uKCksCiAgICAgICAgICAgIG1hcmtlZEZvclJlbW92YWxUaW1lbGluZXNKc29uOiB0aGlzLl9TYXZlTWFya2VkRm9yUmVtb3ZhbFRpbWVsaW5lc1RvSnNvbigpLAogICAgICAgICAgICBoYXNSdW50aW1lTGlzdGVuZXJzOiB0aGlzLl9oYXNSdW50aW1lTGlzdGVuZXJzLAogICAgICAgICAgICBjaGFuZ2luZ0xheW91dDogdGhpcy5fY2hhbmdpbmdMYXlvdXQsCiAgICAgICAgICAgIGlzVGlja2luZ1RpbWVsaW5lczogdGhpcy5faXNUaWNraW5nVGltZWxpbmVzCiAgICAgICAgfQogICAgfQogICAgX0xvYWRGcm9tSnNvbihhKSB7CiAgICAgICAgYSAmJiAodGhpcy5fQ2xlYXJDcmVhdGVkVGVtcGxhdGVUaW1lbGluZXNDb3VudCgpLAogICAgICAgICAgICB0aGlzLl9Mb2FkVGltZWxpbmVzRnJvbUpzb24oYS50aW1lbGluZXNKc29uKSwgdGhpcy5fTG9hZFNjaGVkdWxlZFRpbWVsaW5lc0Zyb21Kc29uKGEuc2NoZWR1bGVkVGltZWxpbmVzSnNvbiksIHRoaXMuX0xvYWRQbGF5aW5nVGltZWxpbmVzRnJvbUpzb24oYS5wbGF5aW5nVGltZWxpbmVzSnNvbiksIHRoaXMuX0xvYWRNYXJrZWRGb3JSZW1vdmFsVGltZWxpbmVzRnJvbUpzb24oYS5tYXJrZWRGb3JSZW1vdmFsVGltZWxpbmVzSnNvbiksIHRoaXMuX2hhc1J1bnRpbWVMaXN0ZW5lcnMgPSAhYS5oYXNSdW50aW1lTGlzdGVuZXJzLCB0aGlzLl9jaGFuZ2luZ0xheW91dCA9ICEhYS5jaGFuZ2luZ0xheW91dCwgdGhpcy5faXNUaWNraW5nVGltZWxpbmVzID0gISFhLmlzVGlja2luZ1RpbWVsaW5lcywgdGhpcy5fU2V0Q3JlYXRlZFRlbXBsYXRlVGltZWxpbmVzQ291bnQoKSwgdGhpcy5fTWF5YmVFbmFibGVSdW50aW1lTGlzdGVuZXJzKCksIHRoaXMuX01heWJlRGlzYWJsZVJ1bnRpbWVMaXN0ZW5lcnMoKSkKICAgIH0KICAgIF9TYXZlVGltZWxpbmVzVG9Kc29uKCkgewogICAgICAgIHJldHVybiB0aGlzLl90aW1lbGluZXMubWFwKGEgPT4KICAgICAgICAgICAgYS5fU2F2ZVRvSnNvbigpKQogICAgfQogICAgX0xvYWRUaW1lbGluZXNGcm9tSnNvbihhKSB7CiAgICAgICAgZm9yIChjb25zdCBiIG9mIGEpIHsKICAgICAgICAgICAgYSA9IHRoaXMuR2V0VGltZWxpbmVCeU5hbWUoYi5uYW1lKTsKICAgICAgICAgICAgaWYgKCFhKSB7CiAgICAgICAgICAgICAgICBhID0gdGhpcy5fR2V0VGVtcGxhdGVOYW1lRnJvbUpzb24oYik7CiAgICAgICAgICAgICAgICBpZiAoIWEpIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgYSA9IHRoaXMuR2V0VGltZWxpbmVCeU5hbWUoYSk7CiAgICAgICAgICAgICAgICBhID0gdGhpcy5DcmVhdGVGcm9tVGVtcGxhdGUoYSkKICAgICAgICAgICAgfQogICAgICAgICAgICBhLl9Mb2FkRnJvbUpzb24oYik7CiAgICAgICAgICAgIGEuSGFzVHJhY2tzKCkgfHwgdGhpcy5SZW1vdmUoYSkKICAgICAgICB9CiAgICB9CiAgICBfR2V0VGVtcGxhdGVOYW1lRnJvbUpzb24oYSkgewogICAgICAgIHJldHVybiAoYSA9IGEubmFtZS5zcGxpdCgiOiIpKSAmJiAyID09PSBhLmxlbmd0aCA/IGFbMF0gOiBudWxsCiAgICB9CiAgICBfU2F2ZVNjaGVkdWxlZFRpbWVsaW5lc1RvSnNvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5fU2F2ZVRpbWVsaW5lcyh0aGlzLl9zY2hlZHVsZWRUaW1lbGluZXMpCiAgICB9CiAgICBfTG9hZFNjaGVkdWxlZFRpbWVsaW5lc0Zyb21Kc29uKGEpIHsKICAgICAgICB0aGlzLl9Mb2FkVGltZWxpbmVzKGEsIHRoaXMuX3NjaGVkdWxlZFRpbWVsaW5lcykKICAgIH0KICAgIF9TYXZlUGxheWluZ1RpbWVsaW5lc1RvSnNvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5fU2F2ZVRpbWVsaW5lcyh0aGlzLl9wbGF5aW5nVGltZWxpbmVzKQogICAgfQogICAgX0xvYWRQbGF5aW5nVGltZWxpbmVzRnJvbUpzb24oYSkgewogICAgICAgIHRoaXMuX0xvYWRUaW1lbGluZXMoYSwKICAgICAgICAgICAgdGhpcy5fcGxheWluZ1RpbWVsaW5lcykKICAgIH0KICAgIF9TYXZlTWFya2VkRm9yUmVtb3ZhbFRpbWVsaW5lc1RvSnNvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5fU2F2ZVRpbWVsaW5lcyh0aGlzLl9tYXJrZWRGb3JSZW1vdmFsVGltZWxpbmVzKQogICAgfQogICAgX0xvYWRNYXJrZWRGb3JSZW1vdmFsVGltZWxpbmVzRnJvbUpzb24oYSkgewogICAgICAgIHRoaXMuX0xvYWRUaW1lbGluZXMoYSwgdGhpcy5fbWFya2VkRm9yUmVtb3ZhbFRpbWVsaW5lcykKICAgIH0KICAgIF9Jc1RpbWVsaW5lSW5Kc29uKGEsIGIpIHsKICAgICAgICBpZiAoIWIpIHJldHVybiAhMTsKICAgICAgICBmb3IgKGNvbnN0IGQgb2YgYikKICAgICAgICAgICAgaWYgKGQgPT09IGEuR2V0TmFtZSgpKSByZXR1cm4gITA7CiAgICAgICAgcmV0dXJuICExCiAgICB9CiAgICBfU2F2ZVRpbWVsaW5lcyhhKSB7CiAgICAgICAgcmV0dXJuIGEubWFwKGIgPT4gYi5HZXROYW1lKCkpCiAgICB9CiAgICBfTG9hZFRpbWVsaW5lcyhhLCBiKSB7CiAgICAgICAgdmFyIGQgPSBuZXcgU2V0OwogICAgICAgIGZvciAoY29uc3QgYyBvZiBiKSB0aGlzLl9Jc1RpbWVsaW5lSW5Kc29uKGMsIGEpIHx8IGQuYWRkKGMpOwogICAgICAgIEMzJGpzY29tcCQ4My5hcnJheVJlbW92ZUFsbEluU2V0KGIsIGQpOwogICAgICAgIGlmIChhKSB7CiAgICAgICAgICAgIGQgPSBjID0+IGUgPT4gZS5HZXROYW1lKCkgPT09CiAgICAgICAgICAgICAgICBjOwogICAgICAgICAgICBmb3IgKGNvbnN0IGMgb2YgYSkoYSA9IHRoaXMuR2V0VGltZWxpbmVCeU5hbWUoYykpICYmIChiLmZpbmQoZChjKSkgfHwgYi5wdXNoKGEpKQogICAgICAgIH0KICAgIH0KfTsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkODQgPSBzZWxmLkMzOwpDMyRqc2NvbXAkODQuVGltZWxpbmVTdGF0ZSA9IGNsYXNzIGV4dGVuZHMgQzMkanNjb21wJDg0LkRlZmVuZGVkQmFzZSB7CiAgICBjb25zdHJ1Y3RvcihhLCBiLCBkKSB7CiAgICAgICAgc3VwZXIoKTsKICAgICAgICB0aGlzLl9ydW50aW1lID0gZC5HZXRSdW50aW1lKCk7CiAgICAgICAgdGhpcy5fdGltZWxpbmVNYW5hZ2VyID0gZDsKICAgICAgICB0aGlzLl90aW1lbGluZURhdGFJdGVtID0gYjsKICAgICAgICB0aGlzLl9uYW1lID0gYTsKICAgICAgICB0aGlzLl90cmFja3MgPSBbXTsKICAgICAgICB0aGlzLl90cmFja3NMZW5ndGggPSAwOwogICAgICAgIHRoaXMuX2JlZm9yZUFuZEFmdGVyVHJhY2tzID0gbnVsbDsKICAgICAgICB0aGlzLl9iZWZvcmVBbmRBZnRlclRyYWNrc0xlbmd0aCA9IDA7CiAgICAgICAgdGhpcy5DcmVhdGVUcmFja1N0YXRlcygpOwogICAgICAgIHRoaXMuX3BsYXlSZXNvbHZlID0gdGhpcy5fcGxheVByb21pc2UgPSBudWxsOwogICAgICAgIHRoaXMuX3BsYXloZWFkVGltZSA9IDA7CiAgICAgICAgdGhpcy5fcGxheWJhY2tSYXRlID0gMTsKICAgICAgICB0aGlzLl9waW5nUG9uZ1N0YXRlID0gMDsKICAgICAgICB0aGlzLl9jdXJyZW50UmVwZWF0Q291bnQgPSAxOwogICAgICAgIHRoaXMuX2luaXRpYWxTdGF0ZVNldCA9IHRoaXMuX2lzU2NoZWR1bGVkID0gdGhpcy5faXNQbGF5aW5nID0gITE7CiAgICAgICAgdGhpcy5fY29tcGxldGUgPSAhMDsKICAgICAgICB0aGlzLl9tYXJrZWRGb3JSZW1vdmFsID0gdGhpcy5fcmVsZWFzZWQgPSAhMTsKICAgICAgICB0aGlzLl9jb21wbGV0ZWRUaWNrID0gLTE7CiAgICAgICAgdGhpcy5fZmlyc3RUaWNrID0gdGhpcy5fZmluaXNoZWRUcmlnZ2VycyA9IHRoaXMuX2lzVGVtcGxhdGUgPSB0aGlzLl9pbXBsaWNpdFBhdXNlID0gITE7CiAgICAgICAgdGhpcy5fbGFzdERlbHRhID0gTmFOOwogICAgICAgIHRoaXMuX3RhZ3MgPSBbIiJdOwogICAgICAgIHRoaXMuX3N0cmluZ1RhZ3MgPSAiIjsKICAgICAgICB0aGlzLl90YWdzQ2hhbmdlZCA9ICExOwogICAgICAgIHRoaXMuX2hhc05lc3RlZENvbnRlbnQgPSB0aGlzLl9yZW5kZXJDaGFuZ2UgPSAwOwogICAgICAgIHRoaXMuX2lUaW1lbGluZVN0YXRlID0gbnVsbAogICAgfQogICAgc3RhdGljIENyZWF0ZUluaXRpYWwoYSwgYikgewogICAgICAgIHZhciBkID0gYi5HZXRUaW1lbGluZURhdGFNYW5hZ2VyKCk7CiAgICAgICAgY29uc3QgYyA9IGQuR2V0TmFtZUlkKCk7CiAgICAgICAgZCA9IGQuR2V0KGFbY10pOwogICAgICAgIGEgPSBDMyRqc2NvbXAkODQuTmV3KEMzJGpzY29tcCQ4NC5UaW1lbGluZVN0YXRlLCBhW2NdLCBkLCBiKTsKICAgICAgICBhLlNldElzVGVtcGxhdGUoITApOwogICAgICAgIHJldHVybiBhCiAgICB9CiAgICBzdGF0aWMgQ3JlYXRlRnJvbVRlbXBsYXRlKGEsCiAgICAgICAgYiwgZCkgewogICAgICAgIHJldHVybiBDMyRqc2NvbXAkODQuTmV3KEMzJGpzY29tcCQ4NC5UaW1lbGluZVN0YXRlLCBhLCBiLCBkKQogICAgfQogICAgUmVsZWFzZSgpIHsKICAgICAgICBpZiAoIXRoaXMuSXNSZWxlYXNlZCgpKSB7CiAgICAgICAgICAgIHZhciBhID0gdGhpcy5fcnVudGltZS5EaXNwYXRjaGVyKCk7CiAgICAgICAgICAgIHRoaXMuX3RpbWVsaW5lTWFuYWdlci5EZVNjaGVkdWxlVGltZWxpbmUodGhpcyk7CiAgICAgICAgICAgIHRoaXMuX3RpbWVsaW5lTWFuYWdlci5Db21wbGV0ZVRpbWVsaW5lQW5kUmVzb2x2ZSh0aGlzKTsKICAgICAgICAgICAgZm9yIChjb25zdCBiIG9mIHRoaXMuX3RyYWNrcykgYi5SZWxlYXNlKCk7CiAgICAgICAgICAgIEMzJGpzY29tcCQ4NC5jbGVhckFycmF5KHRoaXMuX3RyYWNrcyk7CiAgICAgICAgICAgIHRoaXMuX3RpbWVsaW5lRGF0YUl0ZW0gPSB0aGlzLl90aW1lbGluZU1hbmFnZXIgPSB0aGlzLl9ydW50aW1lID0gdGhpcy5fdHJhY2tzID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fcmVsZWFzZWQgPSAhMDsKICAgICAgICAgICAgdGhpcy5fcGxheVJlc29sdmUgPSB0aGlzLl9wbGF5UHJvbWlzZSA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuRmlyZVJlbGVhc2VFdmVudChhKQogICAgICAgIH0KICAgIH0KICAgIEZpcmVSZWxlYXNlRXZlbnQoYSkgewogICAgICAgIGNvbnN0IGIgPSBDMyRqc2NvbXAkODQuTmV3KEMzJGpzY29tcCQ4NC5FdmVudCwKICAgICAgICAgICAgInRpbWVsaW5lc3RhdGVyZWxlYXNlZCIpOwogICAgICAgIGIudGltZWxpbmVTdGF0ZSA9IHRoaXM7CiAgICAgICAgYS5kaXNwYXRjaEV2ZW50KGIpCiAgICB9CiAgICBDcmVhdGVUcmFja1N0YXRlcygpIHsKICAgICAgICBmb3IgKGNvbnN0IGEgb2YgdGhpcy5fdGltZWxpbmVEYXRhSXRlbS5HZXRUcmFja0RhdGEoKS50cmFja0RhdGFJdGVtcygpKSB0aGlzLl90cmFja3NMZW5ndGggPSB0aGlzLl90cmFja3MucHVzaChDMyRqc2NvbXAkODQuVHJhY2tTdGF0ZS5DcmVhdGUodGhpcywgYSkpCiAgICB9CiAgICBHZXRUaW1lbGluZU1hbmFnZXIoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3RpbWVsaW5lTWFuYWdlcgogICAgfQogICAgR2V0UnVudGltZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcnVudGltZQogICAgfQogICAgR2V0VHJhY2tzKCkgewogICAgICAgIHJldHVybiB0aGlzLl90cmFja3MKICAgIH0KICAgIEdldFNpbWlsYXJQcm9wZXJ0eVRyYWNrcyhhLCBiLCBkKSB7CiAgICAgICAgaWYgKHRoaXMuX2hhc05lc3RlZENvbnRlbnQpIHsKICAgICAgICAgICAgdmFyIGM7CiAgICAgICAgICAgIGZvciAobGV0IGcgPSAwOyBnIDwgdGhpcy5fdHJhY2tzLmxlbmd0aDsgZysrKSB7CiAgICAgICAgICAgICAgICB2YXIgZSA9IHRoaXMuX3RyYWNrc1tnXTsKICAgICAgICAgICAgICAgIGEgPT09IGUuR2V0SW5zdGFuY2UoKSAmJiAoZSA9IGUuR2V0UHJvcGVydHlUcmFjayhkKSkgJiYKICAgICAgICAgICAgICAgICAgICBiLmNvbnN0cnVjdG9yID09PSBlLkdldFNvdXJjZUFkYXB0ZXIoKS5jb25zdHJ1Y3RvciAmJiAoYyB8fCAoYyA9IFtdKSwgYy5wdXNoKGUpKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBjCiAgICAgICAgfQogICAgfQogICAgSGFzVHJhY2tzKCkgewogICAgICAgIHJldHVybiAhIXRoaXMuX3RyYWNrcy5sZW5ndGgKICAgIH0KICAgIEdldFRyYWNrQnlJZChhKSB7CiAgICAgICAgZm9yIChjb25zdCBiIG9mIHRoaXMuX3RyYWNrcykKICAgICAgICAgICAgaWYgKEMzJGpzY29tcCQ4NC5lcXVhbHNOb0Nhc2UoYi5HZXRJZCgpLCBhKSkgcmV0dXJuIGI7CiAgICAgICAgcmV0dXJuIG51bGwKICAgIH0KICAgIEdldFRyYWNrQnlOYW1lKGEpIHsKICAgICAgICBmb3IgKGNvbnN0IGIgb2YgdGhpcy5fdHJhY2tzKQogICAgICAgICAgICBpZiAoIWIuSXNJbnN0YW5jZVRyYWNrKCkgJiYgQzMkanNjb21wJDg0LmVxdWFsc05vQ2FzZShiLkdldE5hbWUoKSwgYSkpIHJldHVybiBiOwogICAgICAgIHJldHVybiBudWxsCiAgICB9CiAgICBTZXROYW1lKGEpIHsKICAgICAgICB0aGlzLl9uYW1lID0gYQogICAgfQogICAgR2V0TmFtZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fbmFtZQogICAgfQogICAgR2V0VGltZWxpbmVEYXRhSXRlbSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdGltZWxpbmVEYXRhSXRlbQogICAgfQogICAgR2V0VGVtcGxhdGVOYW1lKCkgewogICAgICAgIHJldHVybiB0aGlzLl90aW1lbGluZURhdGFJdGVtLkdldE5hbWUoKQogICAgfQogICAgR2V0VG90YWxUaW1lKCkgewogICAgICAgIHJldHVybiB0aGlzLl90aW1lbGluZURhdGFJdGVtLkdldFRvdGFsVGltZSgpCiAgICB9CiAgICBTZXRUb3RhbFRpbWUoYSkgewogICAgICAgIHRoaXMuX3RpbWVsaW5lRGF0YUl0ZW0uU2V0VG90YWxUaW1lKGEpCiAgICB9CiAgICBHZXRTdGVwKCkgewogICAgICAgIHJldHVybiB0aGlzLl90aW1lbGluZURhdGFJdGVtLkdldFN0ZXAoKQogICAgfQogICAgU2V0U3RlcChhKSB7CiAgICAgICAgdGhpcy5fdGltZWxpbmVEYXRhSXRlbS5TZXRTdGVwKGEpCiAgICB9CiAgICBHZXRJbnRlcnBvbGF0aW9uTW9kZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdGltZWxpbmVEYXRhSXRlbS5HZXRJbnRlcnBvbGF0aW9uTW9kZSgpCiAgICB9CiAgICBTZXRJbnRlcnBvbGF0aW9uTW9kZShhKSB7CiAgICAgICAgdGhpcy5fdGltZWxpbmVEYXRhSXRlbS5TZXRJbnRlcnBvbGF0aW9uTW9kZShhKQogICAgfQogICAgR2V0UmVzdWx0TW9kZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdGltZWxpbmVEYXRhSXRlbS5HZXRSZXN1bHRNb2RlKCkKICAgIH0KICAgIFNldFJlc3VsdE1vZGUoYSkgewogICAgICAgIHRoaXMuX3RpbWVsaW5lRGF0YUl0ZW0uR2V0UmVzdWx0TW9kZShhKQogICAgfQogICAgU2V0RWFzZShhKSB7CiAgICAgICAgZm9yIChjb25zdCBiIG9mIHRoaXMuR2V0VHJhY2tzKCkpIGIuU2V0RWFzZShhKQogICAgfQogICAgR2V0TG9vcCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdGltZWxpbmVEYXRhSXRlbS5HZXRMb29wKCkKICAgIH0KICAgIFNldExvb3AoYSkgewogICAgICAgIHJldHVybiB0aGlzLl90aW1lbGluZURhdGFJdGVtLlNldExvb3AoYSkKICAgIH0KICAgIEdldFBpbmdQb25nKCkgewogICAgICAgIHJldHVybiB0aGlzLl90aW1lbGluZURhdGFJdGVtLkdldFBpbmdQb25nKCkKICAgIH0KICAgIFNldFBpbmdQb25nKGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdGltZWxpbmVEYXRhSXRlbS5TZXRQaW5nUG9uZyhhKQogICAgfQogICAgR2V0UmVwZWF0Q291bnQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3RpbWVsaW5lRGF0YUl0ZW0uR2V0UmVwZWF0Q291bnQoKQogICAgfQogICAgU2V0UGxheWJhY2tSYXRlKGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcGxheWJhY2tSYXRlID0KICAgICAgICAgICAgYQogICAgfQogICAgR2V0UGxheWJhY2tSYXRlKCkgewogICAgICAgIHJldHVybiB0aGlzLl9wbGF5YmFja1JhdGUKICAgIH0KICAgIEdldFN0YXJ0T25MYXlvdXQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3RpbWVsaW5lRGF0YUl0ZW0uR2V0U3RhcnRPbkxheW91dCgpCiAgICB9CiAgICBHZXRUcmFuc2Zvcm1XaXRoU2NlbmVHcmFwaCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdGltZWxpbmVEYXRhSXRlbS5HZXRUcmFuc2Zvcm1XaXRoU2NlbmVHcmFwaCgpCiAgICB9CiAgICBJc0ZvcndhcmRQbGF5QmFjaygpIHsKICAgICAgICByZXR1cm4gdGhpcy5Jc1BsYXlpbmcoKSA/IDAgPCB0aGlzLl9wbGF5YmFja1JhdGUgOiAhMAogICAgfQogICAgR2V0UGxheVByb21pc2UoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3BsYXlQcm9taXNlID8gdGhpcy5fcGxheVByb21pc2UgOiB0aGlzLl9wbGF5UHJvbWlzZSA9IG5ldyBQcm9taXNlKGEgPT4gewogICAgICAgICAgICB0aGlzLl9wbGF5UmVzb2x2ZSA9IGEKICAgICAgICB9KQogICAgfQogICAgUmVzb2x2ZVBsYXlQcm9taXNlKCkgewogICAgICAgIHRoaXMuX3BsYXlQcm9taXNlICYmICh0aGlzLl9wbGF5UmVzb2x2ZSgpLCB0aGlzLl9wbGF5UmVzb2x2ZSA9IHRoaXMuX3BsYXlQcm9taXNlID0gbnVsbCkKICAgIH0KICAgIFNldFRhZ3MoYSkgewogICAgICAgIHRoaXMuX3RhZ3MgPQogICAgICAgICAgICBDMyRqc2NvbXAkODQuVGltZWxpbmVTdGF0ZS5fR2V0VGFnQXJyYXkoYSk7CiAgICAgICAgdGhpcy5fdGFnc0NoYW5nZWQgPSAhMAogICAgfQogICAgR2V0VGFncygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdGFncwogICAgfQogICAgR2V0U3RyaW5nVGFncygpIHsKICAgICAgICB0aGlzLl90YWdzQ2hhbmdlZCAmJiAodGhpcy5fc3RyaW5nVGFncyA9IHRoaXMuX3RhZ3Muam9pbigiICIpKTsKICAgICAgICB0aGlzLl90YWdzQ2hhbmdlZCA9ICExOwogICAgICAgIHJldHVybiB0aGlzLl9zdHJpbmdUYWdzCiAgICB9CiAgICBIYXNUYWdzKGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdGFncyAmJiB0aGlzLl90YWdzLmxlbmd0aCA/IChhID0gQzMkanNjb21wJDg0LlRpbWVsaW5lU3RhdGUuX0dldFRhZ0FycmF5KGEpKSAmJiBhLmxlbmd0aCA/IGEuZXZlcnkoQzMkanNjb21wJDg0LlRpbWVsaW5lU3RhdGUuX0hhc1RhZywgdGhpcykgOiAhMSA6ICExCiAgICB9CiAgICBPblN0YXJ0ZWQoKSB7CiAgICAgICAgQzMkanNjb21wJDg0LlBsdWdpbnMuVGltZWxpbmUgJiYgdGhpcy5jb25zdHJ1Y3RvciA9PT0gQzMkanNjb21wJDg0LlRpbWVsaW5lU3RhdGUgJiYgKEMzJGpzY29tcCQ4NC5QbHVnaW5zLlRpbWVsaW5lLkNuZHMuU2V0VHJpZ2dlclRpbWVsaW5lKHRoaXMpLAogICAgICAgICAgICB0aGlzLl90aW1lbGluZU1hbmFnZXIuVHJpZ2dlcihDMyRqc2NvbXAkODQuUGx1Z2lucy5UaW1lbGluZS5DbmRzLk9uVGltZWxpbmVTdGFydGVkKSwgdGhpcy5fdGltZWxpbmVNYW5hZ2VyLlRyaWdnZXIoQzMkanNjb21wJDg0LlBsdWdpbnMuVGltZWxpbmUuQ25kcy5PblRpbWVsaW5lU3RhcnRlZEJ5TmFtZSksIHRoaXMuX3RpbWVsaW5lTWFuYWdlci5UcmlnZ2VyKEMzJGpzY29tcCQ4NC5QbHVnaW5zLlRpbWVsaW5lLkNuZHMuT25UaW1lbGluZVN0YXJ0ZWRCeVRhZ3MpLCB0aGlzLl90aW1lbGluZU1hbmFnZXIuVHJpZ2dlcihDMyRqc2NvbXAkODQuUGx1Z2lucy5UaW1lbGluZS5DbmRzLk9uQW55VGltZWxpbmVTdGFydGVkKSwgQzMkanNjb21wJDg0LlBsdWdpbnMuVGltZWxpbmUuQ25kcy5TZXRUcmlnZ2VyVGltZWxpbmUobnVsbCkpCiAgICB9CiAgICBPbkNvbXBsZXRlZCgpIHsKICAgICAgICB0aGlzLl9jb21wbGV0ZWRUaWNrID0gdGhpcy5fcnVudGltZS5HZXRUaWNrQ291bnQoKQogICAgfQogICAgRmluaXNoVHJpZ2dlcnMoKSB7CiAgICAgICAgdGhpcy5fZmluaXNoZWRUcmlnZ2VycyB8fAogICAgICAgICAgICAodGhpcy5fZmluaXNoZWRUcmlnZ2VycyA9ICEwLCBDMyRqc2NvbXAkODQuUGx1Z2lucy5UaW1lbGluZSAmJiB0aGlzLmNvbnN0cnVjdG9yID09PSBDMyRqc2NvbXAkODQuVGltZWxpbmVTdGF0ZSAmJiAoQzMkanNjb21wJDg0LlBsdWdpbnMuVGltZWxpbmUuQ25kcy5TZXRUcmlnZ2VyVGltZWxpbmUodGhpcyksIHRoaXMuX3RpbWVsaW5lTWFuYWdlci5UcmlnZ2VyKEMzJGpzY29tcCQ4NC5QbHVnaW5zLlRpbWVsaW5lLkNuZHMuT25UaW1lbGluZUZpbmlzaGVkKSwgdGhpcy5fdGltZWxpbmVNYW5hZ2VyLlRyaWdnZXIoQzMkanNjb21wJDg0LlBsdWdpbnMuVGltZWxpbmUuQ25kcy5PblRpbWVsaW5lRmluaXNoZWRCeU5hbWUpLCB0aGlzLl90aW1lbGluZU1hbmFnZXIuVHJpZ2dlcihDMyRqc2NvbXAkODQuUGx1Z2lucy5UaW1lbGluZS5DbmRzLk9uVGltZWxpbmVGaW5pc2hlZEJ5VGFncyksIHRoaXMuX3RpbWVsaW5lTWFuYWdlci5UcmlnZ2VyKEMzJGpzY29tcCQ4NC5QbHVnaW5zLlRpbWVsaW5lLkNuZHMuT25BbnlUaW1lbGluZUZpbmlzaGVkKSwKICAgICAgICAgICAgICAgIEMzJGpzY29tcCQ4NC5QbHVnaW5zLlRpbWVsaW5lLkNuZHMuU2V0VHJpZ2dlclRpbWVsaW5lKG51bGwpKSkKICAgIH0KICAgIFNldFBsYXlpbmcoYSkgewogICAgICAgIHRoaXMuX2lzUGxheWluZyA9IGEKICAgIH0KICAgIElzQ29tcGxldGVkVGljaygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fY29tcGxldGVkVGljayA9PT0gdGhpcy5fcnVudGltZS5HZXRUaWNrQ291bnQoKQogICAgfQogICAgSXNQbGF5aW5nKGEgPSAhMSkgewogICAgICAgIHJldHVybiB0aGlzLklzQ29tcGxldGVkVGljaygpIHx8IHRoaXMuSXNTY2hlZHVsZWQoKSAmJiAhYSA/ICEwIDogdGhpcy5faXNQbGF5aW5nCiAgICB9CiAgICBfSXNQbGF5aW5nKCkgewogICAgICAgIHJldHVybiB0aGlzLklzUGxheWluZyghMCkKICAgIH0KICAgIElzUGF1c2VkKCkgewogICAgICAgIHJldHVybiB0aGlzLl9Jc1BhdXNlZCgpCiAgICB9CiAgICBfSXNQYXVzZWQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuSXNSZWxlYXNlZCgpIHx8IHRoaXMuSXNTY2hlZHVsZWQoKSB8fCB0aGlzLl9Jc1BsYXlpbmcoKSB8fCB0aGlzLklzQ29tcGxldGUoKSA/ICExIDogITAKICAgIH0KICAgIFNldFNjaGVkdWxlZChhKSB7CiAgICAgICAgdGhpcy5faXNTY2hlZHVsZWQgPSBhCiAgICB9CiAgICBJc1NjaGVkdWxlZCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5faXNTY2hlZHVsZWQKICAgIH0KICAgIFNldENvbXBsZXRlKGEpIHsKICAgICAgICB0aGlzLl9jb21wbGV0ZSA9CiAgICAgICAgICAgIGE7CiAgICAgICAgYSA9IHRoaXMuR2V0VGltZSgpOwogICAgICAgIGlmICgwID49IGEgfHwgYSA+PSB0aGlzLkdldFRvdGFsVGltZSgpKSB0aGlzLl9jb21wbGV0ZSA9ICEwCiAgICB9CiAgICBJc0NvbXBsZXRlKCkgewogICAgICAgIHJldHVybiB0aGlzLl9jb21wbGV0ZQogICAgfQogICAgSXNSZWxlYXNlZCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcmVsZWFzZWQKICAgIH0KICAgIFNldE1hcmtlZEZvclJlbW92YWwoYSkgewogICAgICAgIHRoaXMuX21hcmtlZEZvclJlbW92YWwgPSBhCiAgICB9CiAgICBJc01hcmtlZEZvclJlbW92YWwoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX21hcmtlZEZvclJlbW92YWwKICAgIH0KICAgIFNldEltcGxpY2l0UGF1c2UoYSkgewogICAgICAgIHRoaXMuX2ltcGxpY2l0UGF1c2UgPSBhCiAgICB9CiAgICBJc0ltcGxpY2l0UGF1c2UoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2ltcGxpY2l0UGF1c2UKICAgIH0KICAgIFNldElzVGVtcGxhdGUoYSkgewogICAgICAgIHRoaXMuX2lzVGVtcGxhdGUgPSAhIWEKICAgIH0KICAgIElzVGVtcGxhdGUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2lzVGVtcGxhdGUKICAgIH0KICAgIEluaXRpYWxTdGF0ZVNldCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5faW5pdGlhbFN0YXRlU2V0CiAgICB9CiAgICBHZXRUaW1lKCkgewogICAgICAgIHJldHVybiB0aGlzLl9wbGF5aGVhZFRpbWUKICAgIH0KICAgIFNldFRpbWUoYSkgewogICAgICAgIGNvbnN0IGIgPQogICAgICAgICAgICB0aGlzLkdldFRpbWUoKTsKICAgICAgICB0aGlzLl9TZXRUaW1lKGEpOwogICAgICAgIHRoaXMuU2V0Q29tcGxldGUoITEpOwogICAgICAgIHRoaXMuSXNDb21wbGV0ZSgpIHx8IHRoaXMuU2V0SW1wbGljaXRQYXVzZSghMCk7CiAgICAgICAgaWYgKHRoaXMuX0lzUGxheWluZygpIHx8IHRoaXMuSXNTY2hlZHVsZWQoKSB8fCAhdGhpcy5faW5pdGlhbFN0YXRlU2V0KSB0aGlzLl9Jc1BsYXlpbmcoKSB8fCB0aGlzLklzU2NoZWR1bGVkKCkgfHwgdGhpcy5faW5pdGlhbFN0YXRlU2V0ID8gdGhpcy5fSXNQbGF5aW5nKCkgPyB0aGlzLlN0b3AoKSA6IHRoaXMuSXNTY2hlZHVsZWQoKSAmJiAodGhpcy5fdGltZWxpbmVNYW5hZ2VyLkRlU2NoZWR1bGVUaW1lbGluZSh0aGlzKSwgdGhpcy5TZXRJbml0aWFsU3RhdGVGcm9tU2V0VGltZSgpKSA6IHRoaXMuU2V0SW5pdGlhbFN0YXRlRnJvbVNldFRpbWUoKTsKICAgICAgICB0aGlzLl9TZXRVcGRhdGVTdGF0ZUJlZm9yZSgpOwogICAgICAgIHRoaXMuX0ludGVycG9sYXRlKHRoaXMuR2V0VGltZSgpLCAhMSwgITAsICEwLCBiKTsKICAgICAgICB0aGlzLl9TZXRVcGRhdGVTdGF0ZUFmdGVyKCk7CiAgICAgICAgdGhpcy5fcmVuZGVyQ2hhbmdlICYmCiAgICAgICAgICAgIHRoaXMuR2V0UnVudGltZSgpLlVwZGF0ZVJlbmRlcigpOwogICAgICAgIHRoaXMuX09uU2V0VGltZSgpCiAgICB9CiAgICBfU2V0VGltZShhKSB7CiAgICAgICAgQzMkanNjb21wJDg0LklzRmluaXRlTnVtYmVyKGEpIHx8IChhID0gdGhpcy5HZXRUb3RhbFRpbWUoKSk7CiAgICAgICAgMCA+IGEgPyB0aGlzLl9wbGF5aGVhZFRpbWUgPSAwIDogYSA+PSB0aGlzLkdldFRvdGFsVGltZSgpID8gdGhpcy5fcGxheWhlYWRUaW1lID0gdGhpcy5HZXRUb3RhbFRpbWUoKSA6IHRoaXMuX3BsYXloZWFkVGltZSA9IGEKICAgIH0KICAgIF9TZXRUaW1lQW5kUmVzZXQoYSkgewogICAgICAgIEMzJGpzY29tcCQ4NC5Jc0Zpbml0ZU51bWJlcihhKSB8fCAoYSA9IHRoaXMuR2V0VG90YWxUaW1lKCkpOwogICAgICAgIDAgPiBhID8gdGhpcy5fcGxheWhlYWRUaW1lID0gMCA6IGEgPj0gdGhpcy5HZXRUb3RhbFRpbWUoKSA/IHRoaXMuX3BsYXloZWFkVGltZSA9IHRoaXMuR2V0VG90YWxUaW1lKCkgOiB0aGlzLl9wbGF5aGVhZFRpbWUgPSBhOwogICAgICAgIGZvciAoY29uc3QgYiBvZiB0aGlzLl90cmFja3MpIGIuU2V0UmVzZXRTdGF0ZSgpCiAgICB9CiAgICBfT25TZXRUaW1lKCkgewogICAgICAgIEMzJGpzY29tcCQ4NC5QbHVnaW5zLlRpbWVsaW5lICYmCiAgICAgICAgICAgIHRoaXMuY29uc3RydWN0b3IgPT09IEMzJGpzY29tcCQ4NC5UaW1lbGluZVN0YXRlICYmIChDMyRqc2NvbXAkODQuUGx1Z2lucy5UaW1lbGluZS5DbmRzLlNldFRyaWdnZXJUaW1lbGluZSh0aGlzKSwgdGhpcy5fdGltZWxpbmVNYW5hZ2VyLlRyaWdnZXIoQzMkanNjb21wJDg0LlBsdWdpbnMuVGltZWxpbmUuQ25kcy5PblRpbWVTZXQpLCB0aGlzLl90aW1lbGluZU1hbmFnZXIuVHJpZ2dlcihDMyRqc2NvbXAkODQuUGx1Z2lucy5UaW1lbGluZS5DbmRzLk9uVGltZVNldEJ5TmFtZSksIHRoaXMuX3RpbWVsaW5lTWFuYWdlci5UcmlnZ2VyKEMzJGpzY29tcCQ4NC5QbHVnaW5zLlRpbWVsaW5lLkNuZHMuT25UaW1lU2V0QnlUYWdzKSwgQzMkanNjb21wJDg0LlBsdWdpbnMuVGltZWxpbmUuQ25kcy5TZXRUcmlnZ2VyVGltZWxpbmUobnVsbCkpCiAgICB9CiAgICBfQ2FuUmVzdW1lKCkgewogICAgICAgIGlmICghdGhpcy5HZXRMb29wKCkpCiAgICAgICAgICAgIGlmICh0aGlzLkdldFBpbmdQb25nKCkgJiYgMSA9PT0gdGhpcy5fcGluZ1BvbmdTdGF0ZSkKICAgICAgICAgICAgICAgIGlmICh0aGlzLklzRm9yd2FyZFBsYXlCYWNrKCkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5HZXRUaW1lKCkgPj0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5HZXRUb3RhbFRpbWUoKSkgcmV0dXJuICExCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGlmICgwID49IHRoaXMuR2V0VGltZSgpKSByZXR1cm4gITEKICAgICAgICAgICAgICAgIH0KICAgICAgICBlbHNlIGlmICghdGhpcy5HZXRMb29wKCkgJiYgIXRoaXMuR2V0UGluZ1BvbmcoKSkKICAgICAgICAgICAgaWYgKHRoaXMuSXNGb3J3YXJkUGxheUJhY2soKSkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuR2V0VGltZSgpID49IHRoaXMuR2V0VG90YWxUaW1lKCkpIHJldHVybiAhMQogICAgICAgICAgICB9IGVsc2UgaWYgKDAgPj0gdGhpcy5HZXRUaW1lKCkpIHJldHVybiAhMTsKICAgICAgICByZXR1cm4gITAKICAgIH0KICAgIFJlc3VtZSgpIHsKICAgICAgICB0aGlzLklzUmVsZWFzZWQoKSB8fCB0aGlzLl9DYW5SZXN1bWUoKSAmJiB0aGlzLlBsYXkoITApCiAgICB9CiAgICBQbGF5KGEgPSAhMSkgewogICAgICAgIHJldHVybiB0aGlzLklzUmVsZWFzZWQoKSB8fCB0aGlzLklzU2NoZWR1bGVkKCkgPyAhMSA6IHRoaXMuX0lzUGxheWluZygpICYmIHRoaXMuSXNDb21wbGV0ZWRUaWNrKCkgPyB0aGlzLl9TY2hlZHVsZVBsYXlpbmdUaW1lbGluZSgpIDogdGhpcy5fSXNQbGF5aW5nKCkgfHwgIXRoaXMuSXNDb21wbGV0ZSgpICYmICFhICYmICF0aGlzLklzSW1wbGljaXRQYXVzZSgpID8gITEgOiB0aGlzLl9TY2hlZHVsZVN0b3BwZWRUaW1lbGluZSgpCiAgICB9CiAgICBfU2NoZWR1bGVQbGF5aW5nVGltZWxpbmUoKSB7CiAgICAgICAgdGhpcy5TZXRJbXBsaWNpdFBhdXNlKCExKTsKICAgICAgICB0aGlzLl90aW1lbGluZU1hbmFnZXIuUmVtb3ZlUGxheWluZ1RpbWVsaW5lKHRoaXMpOwogICAgICAgIHRoaXMuX3RpbWVsaW5lTWFuYWdlci5TY2hlZHVsZVRpbWVsaW5lKHRoaXMpOwogICAgICAgIHRoaXMuR2V0UGxheVByb21pc2UoKTsKICAgICAgICByZXR1cm4gITAKICAgIH0KICAgIF9TY2hlZHVsZVN0b3BwZWRUaW1lbGluZSgpIHsKICAgICAgICB0aGlzLlNldEltcGxpY2l0UGF1c2UoITEpOwogICAgICAgIHRoaXMuX3RpbWVsaW5lTWFuYWdlci5TY2hlZHVsZVRpbWVsaW5lKHRoaXMpOwogICAgICAgIHRoaXMuR2V0UGxheVByb21pc2UoKTsKICAgICAgICByZXR1cm4gITAKICAgIH0KICAgIFN0b3AoYSA9ICExKSB7CiAgICAgICAgdGhpcy5Jc1JlbGVhc2VkKCkgfHwgKHRoaXMuU2V0Q29tcGxldGUoYSksIHRoaXMuX3RpbWVsaW5lTWFuYWdlci5Db21wbGV0ZVRpbWVsaW5lKHRoaXMpLCB0aGlzLklzQ29tcGxldGUoKSAmJiB0aGlzLlJlc29sdmVQbGF5UHJvbWlzZSgpKQogICAgfQogICAgUmVzZXQoYSA9ICEwLCBiID0gITEpIHsKICAgICAgICBpZiAoIXRoaXMuSXNSZWxlYXNlZCgpKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5fSXNQbGF5aW5nKCkgJiYgdGhpcy5Jc1NjaGVkdWxlZCgpKSByZXR1cm4gdGhpcy5fdGltZWxpbmVNYW5hZ2VyLkRlU2NoZWR1bGVUaW1lbGluZSh0aGlzKTsKICAgICAgICAgICAgaWYgKCF0aGlzLklzQ29tcGxldGUoKSkgewogICAgICAgICAgICAgICAgdGhpcy5TdG9wKCEwKTsKICAgICAgICAgICAgICAgIHRoaXMuSXNGb3J3YXJkUGxheUJhY2soKSA/IHRoaXMuX1NldFRpbWUoMCkgOiB0aGlzLl9TZXRUaW1lKHRoaXMuR2V0VG90YWxUaW1lKCkpOwogICAgICAgICAgICAgICAgdmFyIGQgPSB0aGlzLkdldFRpbWUoKTsKICAgICAgICAgICAgICAgIHRoaXMuX1NldFVwZGF0ZVN0YXRlQmVmb3JlKCk7CiAgICAgICAgICAgICAgICBiID8gdGhpcy5fSW50ZXJwb2xhdGVCZWZvcmVDaGFuZ2VMYXlvdXQoZCkgOiB0aGlzLl9JbnRlcnBvbGF0ZShkLCAhMSwgITEsICEwKTsKICAgICAgICAgICAgICAgIGEgJiYgdGhpcy5fT25TZXRUaW1lKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9TZXRVcGRhdGVTdGF0ZUFmdGVyKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9yZW5kZXJDaGFuZ2UgJiYgYSAmJiB0aGlzLkdldFJ1bnRpbWUoKS5VcGRhdGVSZW5kZXIoKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgUmVzZXRCZWZvcmVDaGFuZ2VMYXlvdXQoKSB7CiAgICAgICAgdGhpcy5SZXNldCghMSwgITApCiAgICB9CiAgICBfSW50ZXJwb2xhdGVCZWZvcmVDaGFuZ2VMYXlvdXQoYSkgewogICAgICAgIHRoaXMuX0ludGVycG9sYXRlKGEsICExLCAhMSwgITAsIE5hTiwgITEsICEwKQogICAgfQogICAgX09uQmVmb3JlQ2hhbmdlTGF5b3V0KCkgewogICAgICAgIGlmICh0aGlzLklzUmVsZWFzZWQoKSkgcmV0dXJuICEwOwogICAgICAgIGlmICghdGhpcy5HZXRSdW50aW1lKCkuSXNMb2FkaW5nU3RhdGUoKSAmJiB0aGlzLkhhc1ZhbGlkR2xvYmFsVHJhY2tzKCkpIHJldHVybiAhMTsKICAgICAgICB0aGlzLl90aW1lbGluZU1hbmFnZXIuQ29tcGxldGVUaW1lbGluZUJlZm9yZUNoYW5nZU9mTGF5b3V0KHRoaXMpOwogICAgICAgIHRoaXMuR2V0UnVudGltZSgpLklzTG9hZGluZ1N0YXRlKCkgfHwgdGhpcy5SZXNldEJlZm9yZUNoYW5nZUxheW91dCgpOwogICAgICAgIHJldHVybiAhMAogICAgfQogICAgU2V0SW5pdGlhbFN0YXRlRnJvbVNldFRpbWUoKSB7CiAgICAgICAgdGhpcy5TZXRJbml0aWFsU3RhdGUoITApCiAgICB9CiAgICBTZXRJbml0aWFsU3RhdGUoYSkgewogICAgICAgIGlmICghdGhpcy5Jc01hcmtlZEZvclJlbW92YWwoKSkgewogICAgICAgICAgICBpZiAoYSkgewogICAgICAgICAgICAgICAgdGhpcy5fZmluaXNoZWRUcmlnZ2VycyA9ICExOwogICAgICAgICAgICAgICAgdGhpcy5fZmlyc3RUaWNrID0gdGhpcy5faW5pdGlhbFN0YXRlU2V0ID0gITA7CiAgICAgICAgICAgICAgICB0aGlzLl9TZXRVcGRhdGVTdGF0ZUJlZm9yZSgpOwogICAgICAgICAgICAgICAgZm9yIChjb25zdCBiIG9mIHRoaXMuX3RyYWNrcykgYi5TZXRJbml0aWFsU3RhdGUoKQogICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuU2V0UGxheWluZyghMCksIHRoaXMuU2V0U2NoZWR1bGVkKCExKSwKICAgICAgICAgICAgICAgIHRoaXMuT25TdGFydGVkKCksIHRoaXMuSXNDb21wbGV0ZSgpKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9jb21wbGV0ZWRUaWNrID0gLTE7CiAgICAgICAgICAgICAgICAwICE9PSB0aGlzLl9waW5nUG9uZ1N0YXRlICYmICh0aGlzLl9wbGF5YmFja1JhdGUgPSBNYXRoLmFicyh0aGlzLl9wbGF5YmFja1JhdGUpKTsKICAgICAgICAgICAgICAgIHRoaXMuX3BpbmdQb25nU3RhdGUgPSAwOwogICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudFJlcGVhdENvdW50ID0gMTsKICAgICAgICAgICAgICAgIHRoaXMuX2ZpbmlzaGVkVHJpZ2dlcnMgPSB0aGlzLl9jb21wbGV0ZSA9ICExOwogICAgICAgICAgICAgICAgdGhpcy5fZmlyc3RUaWNrID0gdGhpcy5faW5pdGlhbFN0YXRlU2V0ID0gITA7CiAgICAgICAgICAgICAgICB0aGlzLklzRm9yd2FyZFBsYXlCYWNrKCkgPyB0aGlzLl9TZXRUaW1lKDApIDogdGhpcy5fU2V0VGltZSh0aGlzLkdldFRvdGFsVGltZSgpKTsKICAgICAgICAgICAgICAgIHRoaXMuX1NldFVwZGF0ZVN0YXRlQmVmb3JlKCk7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGIgb2YgdGhpcy5fdHJhY2tzKSBiLlNldEluaXRpYWxTdGF0ZSgpCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLl9maXJzdFRpY2sgPSAhMDsKICAgICAgICAgICAgICAgIHRoaXMuX2ZpbmlzaGVkVHJpZ2dlcnMgPSAhMTsKICAgICAgICAgICAgICAgIHRoaXMuX1NldFVwZGF0ZVN0YXRlQmVmb3JlKCk7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGIgb2YgdGhpcy5fdHJhY2tzKSBiLlNldFJlc3VtZVN0YXRlKCkKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLl9TZXRVcGRhdGVTdGF0ZUFmdGVyKCkKICAgICAgICB9CiAgICB9CiAgICBHZXRSZW5kZXJDaGFuZ2UoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3JlbmRlckNoYW5nZQogICAgfQogICAgX1NldFVwZGF0ZVN0YXRlQmVmb3JlKCkgewogICAgICAgIHRoaXMuX2hhc05lc3RlZENvbnRlbnQgPQogICAgICAgICAgICAwOwogICAgICAgIGZvciAoY29uc3QgYSBvZiB0aGlzLl90cmFja3MpIGEuSXNOZXN0ZWQoKSAmJiAodGhpcy5faGFzTmVzdGVkQ29udGVudCA9IDEpCiAgICB9CiAgICBfU2V0VXBkYXRlU3RhdGVBZnRlcigpIHsKICAgICAgICB0aGlzLl9yZW5kZXJDaGFuZ2UgPSAwOwogICAgICAgIGZvciAoY29uc3QgYSBvZiB0aGlzLl90cmFja3MpIGEuX1NldFVwZGF0ZVN0YXRlKCksIDAgPT09IHRoaXMuX3JlbmRlckNoYW5nZSAmJiAxID09PSBhLkdldFJlbmRlckNoYW5nZSgpICYmICh0aGlzLl9yZW5kZXJDaGFuZ2UgPSAxKSwgdGhpcy5fYmVmb3JlQW5kQWZ0ZXJUcmFja3MgfHwgMSAhPT0gYS5HZXROZWVkc0JlZm9yZUFuZEFmdGVyKCkgfHwgKHRoaXMuX2JlZm9yZUFuZEFmdGVyVHJhY2tzIHx8ICh0aGlzLl9iZWZvcmVBbmRBZnRlclRyYWNrcyA9IFtdKSwgdGhpcy5fYmVmb3JlQW5kQWZ0ZXJUcmFja3NMZW5ndGggPSB0aGlzLl9iZWZvcmVBbmRBZnRlclRyYWNrcy5wdXNoKGEpKQogICAgfQogICAgVGljayhhLCBiLCBkKSB7CiAgICAgICAgaWYgKDAgIT09IGEgfHwgMCAhPT0gdGhpcy5fbGFzdERlbHRhKSB7CiAgICAgICAgICAgIHRoaXMuX2xhc3REZWx0YSA9IGE7CiAgICAgICAgICAgIGQgPSB0aGlzLl9wbGF5aGVhZFRpbWU7CiAgICAgICAgICAgIGIgPSBkICsgYSAqIGIgKiB0aGlzLl9wbGF5YmFja1JhdGU7CiAgICAgICAgICAgIGEgPSB0aGlzLl90aW1lbGluZURhdGFJdGVtLl90b3RhbFRpbWU7CiAgICAgICAgICAgIHRoaXMuX3BsYXloZWFkVGltZSA9IDAgPiBiID8gMCA6IGIgPj0gYSA/IGEgOiBiOwogICAgICAgICAgICB2YXIgYyA9ICExOwogICAgICAgICAgICBiID0gITE7CiAgICAgICAgICAgIHZhciBlID0gdGhpcy5HZXRMb29wKCksCiAgICAgICAgICAgICAgICBnID0gdGhpcy5HZXRQaW5nUG9uZygpOwogICAgICAgICAgICBlIHx8IGcgPyBlICYmICFnID8gMCA8IHRoaXMuX3BsYXliYWNrUmF0ZSA/IHRoaXMuX3BsYXloZWFkVGltZSA+PSBhICYmICh0aGlzLl9TZXRUaW1lQW5kUmVzZXQoMCksIGIgPSAhMCkgOiAwID49IHRoaXMuX3BsYXloZWFkVGltZSAmJiAodGhpcy5fU2V0VGltZUFuZFJlc2V0KGEpLCBiID0gITApIDogIWUgJiYgZyA/IDAgPCB0aGlzLl9wbGF5YmFja1JhdGUgPyB0aGlzLl9wbGF5aGVhZFRpbWUgPj0gYSAmJiAodGhpcy5fU2V0VGltZShhKSwgdGhpcy5TZXRQbGF5YmFja1JhdGUoLTEgKiB0aGlzLkdldFBsYXliYWNrUmF0ZSgpKSwgYiA9ICEwLCAxID09PSB0aGlzLl9waW5nUG9uZ1N0YXRlID8gdGhpcy5fY3VycmVudFJlcGVhdENvdW50IDwgdGhpcy5HZXRSZXBlYXRDb3VudCgpID8gKHRoaXMuX2N1cnJlbnRSZXBlYXRDb3VudCsrLAogICAgICAgICAgICAgICAgdGhpcy5fcGluZ1BvbmdTdGF0ZSA9IDApIDogYyA9ICEwIDogMCA9PT0gdGhpcy5fcGluZ1BvbmdTdGF0ZSAmJiAodGhpcy5fcGluZ1BvbmdTdGF0ZSA9IDEpKSA6IDAgPj0gdGhpcy5fcGxheWhlYWRUaW1lICYmICh0aGlzLl9TZXRUaW1lKDApLCB0aGlzLlNldFBsYXliYWNrUmF0ZSgtMSAqIHRoaXMuR2V0UGxheWJhY2tSYXRlKCkpLCBiID0gITAsIDEgPT09IHRoaXMuX3BpbmdQb25nU3RhdGUgPyB0aGlzLl9jdXJyZW50UmVwZWF0Q291bnQgPCB0aGlzLkdldFJlcGVhdENvdW50KCkgPyAodGhpcy5fY3VycmVudFJlcGVhdENvdW50KyssIHRoaXMuX3BpbmdQb25nU3RhdGUgPSAwKSA6IGMgPSAhMCA6IDAgPT09IHRoaXMuX3BpbmdQb25nU3RhdGUgJiYgKHRoaXMuX3BpbmdQb25nU3RhdGUgPSAxKSkgOiBlICYmIGcgJiYgKDAgPCB0aGlzLl9wbGF5YmFja1JhdGUgPyB0aGlzLl9wbGF5aGVhZFRpbWUgPj0gYSAmJiAodGhpcy5fU2V0VGltZShhKSwgdGhpcy5TZXRQbGF5YmFja1JhdGUoLTEgKiB0aGlzLkdldFBsYXliYWNrUmF0ZSgpKSwgYiA9ICEwLCB0aGlzLl9waW5nUG9uZ1N0YXRlKyssIEMzJGpzY29tcCQ4NC53cmFwKHRoaXMuX3BpbmdQb25nU3RhdGUsCiAgICAgICAgICAgICAgICAwLCAyKSkgOiAwID49IHRoaXMuX3BsYXloZWFkVGltZSAmJiAodGhpcy5fU2V0VGltZSgwKSwgdGhpcy5TZXRQbGF5YmFja1JhdGUoLTEgKiB0aGlzLkdldFBsYXliYWNrUmF0ZSgpKSwgYiA9ICEwLCB0aGlzLl9waW5nUG9uZ1N0YXRlKyssIEMzJGpzY29tcCQ4NC53cmFwKHRoaXMuX3BpbmdQb25nU3RhdGUsIDAsIDIpKSkgOiAwIDwgdGhpcy5fcGxheWJhY2tSYXRlID8gdGhpcy5fcGxheWhlYWRUaW1lID49IGEgJiYgKHRoaXMuX2N1cnJlbnRSZXBlYXRDb3VudCA8IHRoaXMuR2V0UmVwZWF0Q291bnQoKSA/ICh0aGlzLl9jdXJyZW50UmVwZWF0Q291bnQrKywgdGhpcy5fU2V0VGltZUFuZFJlc2V0KDApLCBiID0gITApIDogKHRoaXMuX1NldFRpbWUoYSksIGMgPSAhMCkpIDogMCA+PSB0aGlzLl9wbGF5aGVhZFRpbWUgJiYgKHRoaXMuX2N1cnJlbnRSZXBlYXRDb3VudCA8IHRoaXMuR2V0UmVwZWF0Q291bnQoKSA/ICh0aGlzLl9jdXJyZW50UmVwZWF0Q291bnQrKywgdGhpcy5fU2V0VGltZUFuZFJlc2V0KGEpLCBiID0gITApIDogKHRoaXMuX1NldFRpbWUoMCksIGMgPSAhMCkpOwogICAgICAgICAgICBlID0gdGhpcy5fdHJhY2tzTGVuZ3RoOwogICAgICAgICAgICBpZiAoYykgewogICAgICAgICAgICAgICAgZm9yIChjID0gMDsgYyA8IGU7IGMrKykgdGhpcy5fdHJhY2tzW2NdLlNldEVuZFN0YXRlKCk7CiAgICAgICAgICAgICAgICB0aGlzLlN0b3AoITApOwogICAgICAgICAgICAgICAgdGhpcy5PbkNvbXBsZXRlZCgpCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBnID0gdGhpcy5fYmVmb3JlQW5kQWZ0ZXJUcmFja3NMZW5ndGg7CiAgICAgICAgICAgICAgICBmb3IgKGMgPSAwOyBjIDwgZzsgYysrKSB0aGlzLl9iZWZvcmVBbmRBZnRlclRyYWNrc1tjXS5CZWZvcmVJbnRlcnBvbGF0ZSgpOwogICAgICAgICAgICAgICAgaWYgKDEgPT09IHRoaXMuX2hhc05lc3RlZENvbnRlbnQpCiAgICAgICAgICAgICAgICAgICAgZm9yIChjID0gMDsgYyA8IGU7IGMrKykgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBrID0gdGhpcy5fdHJhY2tzW2NdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbSA9IGsuR2V0U3RhcnRPZmZzZXQoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG4gPSBkIC0gbTsKICAgICAgICAgICAgICAgICAgICAgICAgMCA+IHRoaXMuX3BsYXloZWFkVGltZSAtIG0gJiYgMCA8IG4gPyAodGhpcy5fcGxheWhlYWRUaW1lID0gMCA+IG0gPyAwIDogbSA+PSBhID8gYSA6IG0sIGsuSW50ZXJwb2xhdGUobSwgITAsICExLCBiLCB0aGlzLl9maXJzdFRpY2ssICExKSkgOiBrLkludGVycG9sYXRlKHRoaXMuX3BsYXloZWFkVGltZSwgITAsICExLCBiLCB0aGlzLl9maXJzdFRpY2ssICExKQogICAgICAgICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGMgPSAwOyBjIDwgZTsgYysrKSB0aGlzLl90cmFja3NbY10uSW50ZXJwb2xhdGUodGhpcy5fcGxheWhlYWRUaW1lLCAhMCwgITEsIGIsIHRoaXMuX2ZpcnN0VGljaywgITEpOwogICAgICAgICAgICAgICAgZm9yIChjID0gMDsgYyA8IGc7IGMrKykgdGhpcy5fYmVmb3JlQW5kQWZ0ZXJUcmFja3NbY10uQWZ0ZXJJbnRlcnBvbGF0ZSgpOwogICAgICAgICAgICAgICAgdGhpcy5fZmlyc3RUaWNrICYmICh0aGlzLl9maXJzdFRpY2sgPSAhMSkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIF9JbnRlcnBvbGF0ZShhLCBiID0gITEsIGQgPSAhMSwgYyA9ICExLCBlID0gTmFOLCBnID0gITEsIGsgPSAhMSkgewogICAgICAgIGZvciAodmFyIG0gb2YgdGhpcy5fdHJhY2tzKSBtLkJlZm9yZUludGVycG9sYXRlKCk7CiAgICAgICAgZm9yIChjb25zdCBuIG9mIHRoaXMuX3RyYWNrcykgewogICAgICAgICAgICBtID0gYTsKICAgICAgICAgICAgaWYgKCJudW1iZXIiID09PSB0eXBlb2YgZSAmJiAhaXNOYU4oZSkpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHEgPSB0aGlzLkdldFRpbWUoKSAtIG4uR2V0U3RhcnRPZmZzZXQoKSwKICAgICAgICAgICAgICAgICAgICB1ID0gZSAtIG4uR2V0U3RhcnRPZmZzZXQoKTsKICAgICAgICAgICAgICAgIDAgPiBxICYmIDAgPCB1ICYmIChtID0gbi5HZXRTdGFydE9mZnNldCgpLCB0aGlzLl9TZXRUaW1lKG0pKQogICAgICAgICAgICB9CiAgICAgICAgICAgIG4uSW50ZXJwb2xhdGUobSwgYiwgZCwgYywgdGhpcy5fZmlyc3RUaWNrLCBrKQogICAgICAgIH0KICAgICAgICBmb3IgKGNvbnN0IG4gb2YgdGhpcy5fdHJhY2tzKSBuLkFmdGVySW50ZXJwb2xhdGUoKTsKICAgICAgICB0aGlzLl9maXJzdFRpY2sgJiYgZyAmJiAodGhpcy5fZmlyc3RUaWNrID0gITEpCiAgICB9CiAgICBBZGRUcmFjaygpIHsKICAgICAgICB2YXIgYSA9IHRoaXMuX3RpbWVsaW5lRGF0YUl0ZW0uR2V0VHJhY2tEYXRhKCkuQWRkRW1wdHlUcmFja0RhdGFJdGVtKCk7CiAgICAgICAgYSA9IEMzJGpzY29tcCQ4NC5UcmFja1N0YXRlLkNyZWF0ZSh0aGlzLCBhKTsKICAgICAgICB0aGlzLl90cmFja3NMZW5ndGggPSB0aGlzLl90cmFja3MucHVzaChhKTsKICAgICAgICByZXR1cm4gYQogICAgfQogICAgUmVtb3ZlZCgpIHsKICAgICAgICBpZiAoIXRoaXMuSXNSZWxlYXNlZCgpKQogICAgICAgICAgICBmb3IgKGNvbnN0IGEgb2YgdGhpcy5fdHJhY2tzKSBhLlRpbWVsaW5lUmVtb3ZlZCgpCiAgICB9CiAgICBDbGVhbkNhY2hlcygpIHsKICAgICAgICBmb3IgKGNvbnN0IGEgb2YgdGhpcy5fdHJhY2tzKSBhLkNsZWFuQ2FjaGVzKCkKICAgIH0KICAgIENsZWFyVHJhY2tJbnN0YW5jZXMoKSB7CiAgICAgICAgZm9yIChjb25zdCBhIG9mIHRoaXMuX3RyYWNrcykgYS5DbGVhckluc3RhbmNlKCkKICAgIH0KICAgIFNldFRyYWNrSW5zdGFuY2UoYSwgYikgewogICAgICAgIGlmIChiKQogICAgICAgICAgICBmb3IgKGNvbnN0IGQgb2YgdGhpcy5fdHJhY2tzKQogICAgICAgICAgICAgICAgaWYgKGQuSXNJbnN0YW5jZVRyYWNrKCkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoYSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZC5HZXRJZCgpICE9PQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYSkgY29udGludWUKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGQuSGFzSW5zdGFuY2UoKSkgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgZC5TZXRJbnN0YW5jZShiKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl90aW1lbGluZU1hbmFnZXIuU2V0VGltZWxpbmVPYmplY3RDbGFzc1RvTWFwKGIuR2V0T2JqZWN0Q2xhc3MoKSwgdGhpcyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIH0KICAgIH0KICAgIEhhc1RyYWNrSW5zdGFuY2UoYSwgYikgewogICAgICAgIGZvciAoY29uc3QgZCBvZiB0aGlzLl90cmFja3MpCiAgICAgICAgICAgIGlmIChkLklzSW5zdGFuY2VUcmFjaygpKQogICAgICAgICAgICAgICAgaWYgKGIpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoYiA9PT0gZC5HZXRJZCgpICYmIGEgPT09IGQuR2V0SW5zdGFuY2UoKSkgcmV0dXJuICEwCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGEgPT09IGQuR2V0SW5zdGFuY2UoKSkgcmV0dXJuICEwOwogICAgICAgIHJldHVybiAhMQogICAgfQogICAgSGFzVmFsaWRUcmFja3MoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3RyYWNrcy5zb21lKGEgPT4gYS5Jc0luc3RhbmNlVHJhY2soKSA/IGEuQ2FuSW5zdGFuY2VCZVZhbGlkKCkgOiAhMCkKICAgIH0KICAgIEhhc1ZhbGlkR2xvYmFsVHJhY2tzKCkgewogICAgICAgIHJldHVybiB0aGlzLl90cmFja3Muc29tZShhID0+IGEuSXNJbnN0YW5jZVRyYWNrKCkgPyBhLkNhbkluc3RhbmNlQmVWYWxpZCgpID8KICAgICAgICAgICAgKGEgPSBhLkdldE9iamVjdENsYXNzKCkpID8gYS5Jc0dsb2JhbCgpIDogITEgOiAhMSA6ICExKQogICAgfQogICAgR2V0UHJvcGVydHlUcmFjayhhKSB7CiAgICAgICAgZm9yIChjb25zdCBiIG9mIHRoaXMuR2V0VHJhY2tzKCkpCiAgICAgICAgICAgIGZvciAoY29uc3QgZCBvZiBiLkdldFByb3BlcnR5VHJhY2tzKCkpCiAgICAgICAgICAgICAgICBpZiAoZC5HZXRQcm9wZXJ0eU5hbWUoKSA9PT0gYSkgcmV0dXJuIGQKICAgIH0KICAgIEdldFRyYWNrRnJvbUluc3RhbmNlKGEpIHsKICAgICAgICBmb3IgKGNvbnN0IGIgb2YgdGhpcy5fdHJhY2tzKQogICAgICAgICAgICBpZiAoYSA9PT0gYi5HZXRJbnN0YW5jZSgpKSByZXR1cm4gYjsKICAgICAgICByZXR1cm4gbnVsbAogICAgfQogICAgR2V0S2V5ZnJhbWVXaXRoVGFncyhhKSB7CiAgICAgICAgYSA9IGEgPyBhLnNwbGl0KCIgIikgOiBbXTsKICAgICAgICBhID0gWy4uLihuZXcgU2V0KGEubWFwKGIgPT4gYi50b0xvd2VyQ2FzZSgpLnRyaW0oKSkpKS52YWx1ZXMoKV07CiAgICAgICAgZm9yIChjb25zdCBiIG9mIHRoaXMuR2V0VHJhY2tzKCkpCiAgICAgICAgICAgIGZvciAoY29uc3QgZCBvZiBiLkdldEtleWZyYW1lRGF0YUl0ZW1zKCkpCiAgICAgICAgICAgICAgICBpZiAoYS5ldmVyeShjID0+IGQuSGFzVGFnKGMpKSkgcmV0dXJuIGQKICAgIH0KICAgIEdldE9iamVjdENsYXNzZXMoKSB7CiAgICAgICAgY29uc3QgYSA9IFtdOwogICAgICAgIGZvciAoY29uc3QgYiBvZiB0aGlzLkdldFRyYWNrcygpKSBhLnB1c2goYi5HZXRPYmplY3RDbGFzcygpKTsKICAgICAgICByZXR1cm4gYS5maWx0ZXIoYiA9PiBiKQogICAgfQogICAgX1NhdmVUb0pzb24oKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgdHJhY2tzSnNvbjogdGhpcy5fU2F2ZVRyYWNrc1RvSnNvbigpLAogICAgICAgICAgICBuYW1lOiB0aGlzLl9uYW1lLAogICAgICAgICAgICBwbGF5aGVhZFRpbWU6IHRoaXMuR2V0VGltZSgpLAogICAgICAgICAgICBwbGF5YmFja1JhdGU6IHRoaXMuX3BsYXliYWNrUmF0ZSwKICAgICAgICAgICAgcGluZ1BvbmdTdGF0ZTogdGhpcy5fcGluZ1BvbmdTdGF0ZSwKICAgICAgICAgICAgY3VycmVudFJlcGVhdENvdW50OiB0aGlzLl9jdXJyZW50UmVwZWF0Q291bnQsCiAgICAgICAgICAgIGlzUGxheWluZzogdGhpcy5faXNQbGF5aW5nLAogICAgICAgICAgICBpc1NjaGVkdWxlZDogdGhpcy5faXNTY2hlZHVsZWQsCiAgICAgICAgICAgIGluaXRpYWxTdGF0ZVNldDogdGhpcy5faW5pdGlhbFN0YXRlU2V0LAogICAgICAgICAgICBmaW5pc2hlZFRyaWdnZXJzOiB0aGlzLl9maW5pc2hlZFRyaWdnZXJzLAogICAgICAgICAgICBjb21wbGV0ZTogdGhpcy5fY29tcGxldGUsCiAgICAgICAgICAgIHJlbGVhc2VkOiB0aGlzLl9yZWxlYXNlZCwKICAgICAgICAgICAgbWFya2VkRm9yUmVtb3ZhbDogdGhpcy5fbWFya2VkRm9yUmVtb3ZhbCwKICAgICAgICAgICAgY29tcGxldGVkVGljazogdGhpcy5fY29tcGxldGVkVGljaywKICAgICAgICAgICAgaW1wbGljaXRQYXVzZTogdGhpcy5faW1wbGljaXRQYXVzZSwKICAgICAgICAgICAgaXNUZW1wbGF0ZTogdGhpcy5faXNUZW1wbGF0ZSwKICAgICAgICAgICAgdGFnczogdGhpcy5fdGFncy5qb2luKCIgIiksCiAgICAgICAgICAgIHN0cmluZ1RhZ3M6IHRoaXMuX3N0cmluZ1RhZ3MsCiAgICAgICAgICAgIHRhZ3NDaGFuZ2VkOiB0aGlzLl90YWdzQ2hhbmdlZCwKICAgICAgICAgICAgZmlyc3RUaWNrOiB0aGlzLl9maXJzdFRpY2sKICAgICAgICB9CiAgICB9CiAgICBfTG9hZEZyb21Kc29uKGEpIHsKICAgICAgICBhICYmICh0aGlzLl9Mb2FkVHJhY2tzRnJvbUpzb24oYS50cmFja3NKc29uKSwgdGhpcy5fbmFtZSA9IGEubmFtZSwgdGhpcy5fcGxheWhlYWRUaW1lID0gYS5wbGF5aGVhZFRpbWUsIHRoaXMuX3BsYXliYWNrUmF0ZSA9IGEucGxheWJhY2tSYXRlLCB0aGlzLl9waW5nUG9uZ1N0YXRlID0gYS5waW5nUG9uZ1N0YXRlLCB0aGlzLl9jdXJyZW50UmVwZWF0Q291bnQgPSBhLmN1cnJlbnRSZXBlYXRDb3VudCwgdGhpcy5faXNQbGF5aW5nID0gISFhLmlzUGxheWluZywgdGhpcy5faXNTY2hlZHVsZWQgPSAhIWEuaXNTY2hlZHVsZWQsIHRoaXMuX2luaXRpYWxTdGF0ZVNldCA9ICEhYS5pbml0aWFsU3RhdGVTZXQsIHRoaXMuX2ZpbmlzaGVkVHJpZ2dlcnMgPSBhLmhhc093blByb3BlcnR5KCJmaW5pc2hlZFRyaWdnZXJzIikgPyAhIWEuZmluaXNoZWRUcmlnZ2VycyA6ICExLCB0aGlzLl9jb21wbGV0ZSA9ICEhYS5jb21wbGV0ZSwgdGhpcy5fcmVsZWFzZWQgPSAhIWEucmVsZWFzZWQsIHRoaXMuX21hcmtlZEZvclJlbW92YWwgPSAhIWEubWFya2VkRm9yUmVtb3ZhbCwgdGhpcy5fY29tcGxldGVkVGljayA9IGEuY29tcGxldGVkVGljaywgdGhpcy5faW1wbGljaXRQYXVzZSA9ICEhYS5pbXBsaWNpdFBhdXNlLCB0aGlzLl9pc1RlbXBsYXRlID0gISFhLmlzVGVtcGxhdGUsIHRoaXMuX3RhZ3MgPSBhLnRhZ3Muc3BsaXQoIiAiKSwgdGhpcy5fc3RyaW5nVGFncyA9IGEuc3RyaW5nVGFncywgdGhpcy5fdGFnc0NoYW5nZWQgPSAhIWEudGFnc0NoYW5nZWQsIHRoaXMuX2ZpcnN0VGljayA9ICEhYS5maXJzdFRpY2spCiAgICB9CiAgICBfU2F2ZVRyYWNrc1RvSnNvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdHJhY2tzLm1hcChhID0+IGEuX1NhdmVUb0pzb24oKSkKICAgIH0KICAgIF9Mb2FkVHJhY2tzRnJvbUpzb24oYSkgewogICAgICAgIGEuZm9yRWFjaCgoYiwKICAgICAgICAgICAgZCkgPT4gewogICAgICAgICAgICB0aGlzLl90cmFja3NbZF0uX0xvYWRGcm9tSnNvbihiKQogICAgICAgIH0pOwogICAgICAgIHRoaXMuX3RyYWNrcy5maWx0ZXIoYiA9PiBiLkNhbkluc3RhbmNlQmVWYWxpZCgpKQogICAgfQogICAgc3RhdGljIF9IYXNUYWcoYSkgewogICAgICAgIGNvbnN0IGIgPSB0aGlzLkdldFRhZ3MoKTsKICAgICAgICByZXR1cm4gIiIgPT09IGEgPyAxID09PSBiLmxlbmd0aCAmJiAiIiA9PT0gYlswXSA6IGIubWFwKGQgPT4gZC50b0xvd2VyQ2FzZSgpKS5pbmNsdWRlcyhhLnRvTG93ZXJDYXNlKCkpCiAgICB9CiAgICBzdGF0aWMgX0dldFRhZ0FycmF5KGEpIHsKICAgICAgICBpZiAoQzMkanNjb21wJDg0LklzQXJyYXkoYSkpIHJldHVybiBhLnNsaWNlKDApOwogICAgICAgIGlmIChDMyRqc2NvbXAkODQuSXNTdHJpbmcoYSkpIHJldHVybiBhLnNwbGl0KCIgIik7CiAgICAgICAgdGhyb3cgRXJyb3IoImludmFsaWQgdGFncyIpOwogICAgfQogICAgR2V0SVRpbWVsaW5lU3RhdGUoKSB7CiAgICAgICAgdGhpcy5faVRpbWVsaW5lU3RhdGUgfHwgKHRoaXMuX2lUaW1lbGluZVN0YXRlID0gQzMkanNjb21wJDg0Lk5ldyhzZWxmLklUaW1lbGluZVN0YXRlLCB0aGlzKSk7CiAgICAgICAgcmV0dXJuIHRoaXMuX2lUaW1lbGluZVN0YXRlCiAgICB9Cn07CiJ1c2Ugc3RyaWN0IjsKY29uc3QgQzMkanNjb21wJDg1ID0gc2VsZi5DMzsKQzMkanNjb21wJDg1LlRyYWNrU3RhdGUgPSBjbGFzcyBleHRlbmRzIEMzJGpzY29tcCQ4NS5EZWZlbmRlZEJhc2UgewogICAgY29uc3RydWN0b3IoYSwgYikgewogICAgICAgIHN1cGVyKCk7CiAgICAgICAgdGhpcy5fdGltZWxpbmUgPSBhOwogICAgICAgIHRoaXMuX3RyYWNrRGF0YUl0ZW0gPSBiOwogICAgICAgIHRoaXMuX3RyYWNrRGF0YSA9IGIuR2V0VHJhY2tEYXRhKCk7CiAgICAgICAgdGhpcy5fb2JqZWN0Q2xhc3NJbmRleCA9IHRoaXMuX2luc3RhbmNlVWlkID0gTmFOOwogICAgICAgIHRoaXMuX3dvcmxkSW5mbyA9IHRoaXMuX2luc3RhbmNlID0gbnVsbDsKICAgICAgICB0aGlzLl9pc05lc3RlZCA9IDAgPCBiLkdldFN0YXJ0T2Zmc2V0KCk7CiAgICAgICAgdGhpcy5fZW5kU3RhdGVPZk5lc3RlZFNldCA9IHRoaXMuX2luaXRpYWxTdGF0ZU9mTmVzdGVkU2V0ID0gITE7CiAgICAgICAgdGhpcy5fbGFzdEtleWZyYW1lRGF0YUl0ZW0gPSBudWxsOwogICAgICAgIHRoaXMuX2tleWZyYW1lRGF0YUl0ZW1zID0gdGhpcy5fdHJhY2tEYXRhSXRlbS5HZXRLZXlmcmFtZURhdGEoKS5HZXRLZXlmcmFtZURhdGFJdGVtQXJyYXkoKTsKICAgICAgICB0aGlzLl9wcm9wZXJ0eVRyYWNrcyA9IFtdOwogICAgICAgIHRoaXMuQ3JlYXRlUHJvcGVydHlUcmFja1N0YXRlcygpOwogICAgICAgIHRoaXMuX25lZWRzQmVmb3JlQW5kQWZ0ZXIgPSB0aGlzLl9yZW5kZXJDaGFuZ2UgPSB0aGlzLl93b3JsZEluZm9DaGFuZ2UgPSAwCiAgICB9CiAgICBzdGF0aWMgQ3JlYXRlKGEsIGIpIHsKICAgICAgICByZXR1cm4gQzMkanNjb21wJDg1Lk5ldyhDMyRqc2NvbXAkODUuVHJhY2tTdGF0ZSwgYSwgYikKICAgIH0KICAgIFJlbGVhc2UoKSB7CiAgICAgICAgdGhpcy5fa2V5ZnJhbWVEYXRhSXRlbXMgPSBudWxsOwogICAgICAgIGZvciAoY29uc3QgYSBvZiB0aGlzLl9wcm9wZXJ0eVRyYWNrcykgYS5SZWxlYXNlKCk7CiAgICAgICAgQzMkanNjb21wJDg1LmNsZWFyQXJyYXkodGhpcy5fcHJvcGVydHlUcmFja3MpOwogICAgICAgIHRoaXMuX2xhc3RLZXlmcmFtZURhdGFJdGVtID0gdGhpcy5fdHJhY2tEYXRhSXRlbSA9IHRoaXMuX3dvcmxkSW5mbyA9IHRoaXMuX2luc3RhbmNlID0gdGhpcy5fdGltZWxpbmUgPSB0aGlzLl9wcm9wZXJ0eVRyYWNrcyA9IG51bGwKICAgIH0KICAgIENyZWF0ZVByb3BlcnR5VHJhY2tTdGF0ZXMoKSB7CiAgICAgICAgZm9yIChjb25zdCBhIG9mIHRoaXMuX3RyYWNrRGF0YUl0ZW0uR2V0UHJvcGVydHlUcmFja0RhdGEoKS5wcm9wZXJ0eVRyYWNrRGF0YUl0ZW1zKCkpIHRoaXMuX3Byb3BlcnR5VHJhY2tzLnB1c2goQzMkanNjb21wJDg1LlByb3BlcnR5VHJhY2tTdGF0ZS5DcmVhdGUodGhpcywKICAgICAgICAgICAgYSkpCiAgICB9CiAgICBUaW1lbGluZVJlbW92ZWQoKSB7CiAgICAgICAgZm9yIChjb25zdCBhIG9mIHRoaXMuX3Byb3BlcnR5VHJhY2tzKSBhLlRpbWVsaW5lUmVtb3ZlZCgpCiAgICB9CiAgICBDbGVhbkNhY2hlcygpIHsKICAgICAgICBmb3IgKGNvbnN0IGEgb2YgdGhpcy5fcHJvcGVydHlUcmFja3MpIGEuQ2xlYW5DYWNoZXMoKTsKICAgICAgICB0aGlzLl93b3JsZEluZm8gPSB0aGlzLl9pbnN0YW5jZSA9IG51bGwKICAgIH0KICAgIEdldFRpbWVsaW5lKCkgewogICAgICAgIHJldHVybiB0aGlzLl90aW1lbGluZQogICAgfQogICAgR2V0UnVudGltZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdGltZWxpbmUuR2V0UnVudGltZSgpCiAgICB9CiAgICBHZXRLZXlmcmFtZURhdGFJdGVtcygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fa2V5ZnJhbWVEYXRhSXRlbXMgPyB0aGlzLl9rZXlmcmFtZURhdGFJdGVtcyA6IHRoaXMuX2tleWZyYW1lRGF0YUl0ZW1zID0gdGhpcy5fdHJhY2tEYXRhSXRlbS5HZXRLZXlmcmFtZURhdGEoKS5HZXRLZXlmcmFtZURhdGFJdGVtQXJyYXkoKQogICAgfQogICAgR2V0UHJvcGVydHlUcmFja3MoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3Byb3BlcnR5VHJhY2tzCiAgICB9CiAgICBHZXRQcm9wZXJ0eVRyYWNrKGEpIHsKICAgICAgICBmb3IgKGxldCBiID0KICAgICAgICAgICAgICAgIDA7IGIgPCB0aGlzLl9wcm9wZXJ0eVRyYWNrcy5sZW5ndGg7IGIrKykgewogICAgICAgICAgICBjb25zdCBkID0gdGhpcy5fcHJvcGVydHlUcmFja3NbYl07CiAgICAgICAgICAgIGlmIChkLkdldFByb3BlcnR5TmFtZSgpID09PSBhKSByZXR1cm4gZAogICAgICAgIH0KICAgIH0KICAgIE1heWJlR2V0SW5zdGFuY2UoKSB7CiAgICAgICAgdGhpcy5faW5zdGFuY2UgfHwgdGhpcy5HZXRJbnN0YW5jZSgpCiAgICB9CiAgICBJc0luc3RhbmNlVmFsaWQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2luc3RhbmNlID8gIXRoaXMuX2luc3RhbmNlLklzRGVzdHJveWVkKCkgOiAhMQogICAgfQogICAgQ2FuSW5zdGFuY2VCZVZhbGlkKCkgewogICAgICAgIGlmICghdGhpcy5Jc0luc3RhbmNlVHJhY2soKSkgcmV0dXJuICExOwogICAgICAgIHZhciBhID0gdGhpcy5HZXRJbnN0YW5jZVVJRCgpOwogICAgICAgIHJldHVybiAoYSA9IHRoaXMuR2V0UnVudGltZSgpLkdldEluc3RhbmNlQnlVSUQoYSkpID8gIWEuSXNEZXN0cm95ZWQoKSA6ICExCiAgICB9CiAgICBHZXRPYmplY3RDbGFzcygpIHsKICAgICAgICBpZiAodGhpcy5Jc0luc3RhbmNlVHJhY2soKSkgewogICAgICAgICAgICB2YXIgYSA9IHRoaXMuR2V0T2JqZWN0Q2xhc3NJbmRleCgpOwogICAgICAgICAgICBpZiAoLTEgIT09IGEpIHJldHVybiB0aGlzLkdldFJ1bnRpbWUoKS5HZXRPYmplY3RDbGFzc0J5SW5kZXgoYSkKICAgICAgICB9CiAgICB9CiAgICBDbGVhckluc3RhbmNlKCkgewogICAgICAgIHRoaXMuX2luc3RhbmNlID0KICAgICAgICAgICAgbnVsbDsKICAgICAgICB0aGlzLl9pbnN0YW5jZVVpZCA9IC0xOwogICAgICAgIHRoaXMuX3dvcmxkSW5mbyA9IG51bGw7CiAgICAgICAgdGhpcy5fb2JqZWN0Q2xhc3NJbmRleCA9IC0xCiAgICB9CiAgICBIYXNJbnN0YW5jZSgpIHsKICAgICAgICByZXR1cm4gISF0aGlzLl9pbnN0YW5jZQogICAgfQogICAgR2V0SW5zdGFuY2UoKSB7CiAgICAgICAgaWYgKHRoaXMuX2luc3RhbmNlICYmIHRoaXMuSXNJbnN0YW5jZVZhbGlkKCkpIHJldHVybiB0aGlzLl9pbnN0YW5jZTsKICAgICAgICBjb25zdCBhID0gdGhpcy5HZXRJbnN0YW5jZVVJRCgpOwogICAgICAgIHJldHVybiB0aGlzLl9pbnN0YW5jZSA9IHRoaXMuR2V0UnVudGltZSgpLkdldEluc3RhbmNlQnlVSUQoYSkKICAgIH0KICAgIFNldEluc3RhbmNlKGEpIHsKICAgICAgICBpZiAodGhpcy5faW5zdGFuY2UgIT09IGEpIHsKICAgICAgICAgICAgdGhpcy5DbGVhbkNhY2hlcygpOwogICAgICAgICAgICB0aGlzLl9pbnN0YW5jZSA9IGE7CiAgICAgICAgICAgIHRoaXMuX29iamVjdENsYXNzSW5kZXggPSBhLkdldE9iamVjdENsYXNzKCkuR2V0SW5kZXgoKTsKICAgICAgICAgICAgdGhpcy5faW5zdGFuY2VVaWQgPSBhLkdldFVJRCgpOwogICAgICAgICAgICB0aGlzLl93b3JsZEluZm8gPSBhLkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICBmb3IgKGNvbnN0IGcgb2YgdGhpcy5wcm9wZXJ0eVRyYWNrSXRlbXMoKSkgewogICAgICAgICAgICAgICAgY29uc3QgayA9CiAgICAgICAgICAgICAgICAgICAgZy5zb3VyY2VBZGFwdGVyOwogICAgICAgICAgICAgICAgc3dpdGNoIChnLnByb3BlcnR5VHJhY2suR2V0U291cmNlQWRhcHRlcklkKCkpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlICJpbnN0YW5jZS12YXJpYWJsZSI6CiAgICAgICAgICAgICAgICAgICAgICAgIGsuR2V0RWRpdG9ySW5kZXgoKTsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGIgPSBhLkdldE9iamVjdENsYXNzKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkID0gYi5HZXRJbnN0YW5jZVZhcmlhYmxlSW5kZXhCeU5hbWUoZy5uYW1lKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgPSBiLkdldEluc3RhbmNlVmFyaWFibGVOYW1lKGQpOwogICAgICAgICAgICAgICAgICAgICAgICBiID0gYi5HZXRJbnN0YW5jZVZhcmlhYmxlVHlwZShkKTsKICAgICAgICAgICAgICAgICAgICAgICAgYyA9PT0gZy5uYW1lICYmIGIgPT09IGcudHlwZSAmJiBrLlVwZGF0ZUluc3RhbmNlVmFyaWFibGVJbmRleChkKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAiYmVoYXZpb3IiOgogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZSA9IGcuYmVoYXZpb3JUeXBlOwogICAgICAgICAgICAgICAgICAgICAgICBkID0gdGhpcy5HZXRPYmplY3RDbGFzcygpOwogICAgICAgICAgICAgICAgICAgICAgICBjID0gYS5HZXRPYmplY3RDbGFzcygpOwogICAgICAgICAgICAgICAgICAgICAgICBiID0gay5HZXRCZWhhdmlvclR5cGUoYyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGUgJiYgYiAmJiAoZSA9IGUuR2V0TmFtZSgpLCBkLkdldEJlaGF2aW9ySW5kZXhCeU5hbWUoZSksIGMuR2V0QmVoYXZpb3JJbmRleEJ5TmFtZShlKSwgay5HZXRFZGl0b3JJbmRleCgpLCBrLlVwZGF0ZUJlaGF2aW9yVHlwZVNpZChiLkdldFNJRCgpKSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0qIHByb3BlcnR5VHJhY2tJdGVtcygpIHsKICAgICAgICBmb3IgKGNvbnN0IGQgb2YgdGhpcy5fcHJvcGVydHlUcmFja3MpIHsKICAgICAgICAgICAgdmFyIGEgPQogICAgICAgICAgICAgICAgZC5HZXRTb3VyY2VBZGFwdGVyKCksCiAgICAgICAgICAgICAgICBiID0gdGhpcy5HZXRPYmplY3RDbGFzcygpOwogICAgICAgICAgICBjb25zdCBjID0gewogICAgICAgICAgICAgICAgcHJvcGVydHlUcmFjazogZCwKICAgICAgICAgICAgICAgIHNvdXJjZUFkYXB0ZXI6IGEKICAgICAgICAgICAgfTsKICAgICAgICAgICAgc3dpdGNoIChkLkdldFNvdXJjZUFkYXB0ZXJJZCgpKSB7CiAgICAgICAgICAgICAgICBjYXNlICJ3b3JsZC1pbnN0YW5jZSI6CiAgICAgICAgICAgICAgICAgICAgYy5wcm9wZXJ0eSA9IGQuR2V0UHJvcGVydHlOYW1lKCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICJpbnN0YW5jZS12YXJpYWJsZSI6CiAgICAgICAgICAgICAgICAgICAgYSA9IGEuR2V0RWRpdG9ySW5kZXgoKTsKICAgICAgICAgICAgICAgICAgICBjLm5hbWUgPSBiLkdldEluc3RhbmNlVmFyaWFibGVOYW1lKGEpOwogICAgICAgICAgICAgICAgICAgIGMudHlwZSA9IGIuR2V0SW5zdGFuY2VWYXJpYWJsZVR5cGUoYSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICJlZmZlY3QiOgogICAgICAgICAgICAgICAgICAgIGIgPSBiLkdldEVmZmVjdExpc3QoKTsKICAgICAgICAgICAgICAgICAgICBhID0gYS5HZXRFZmZlY3RUeXBlKGIpOwogICAgICAgICAgICAgICAgICAgIGMuZWZmZWN0VHlwZSA9IGE7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICJiZWhhdmlvciI6CiAgICAgICAgICAgICAgICAgICAgYSA9IGEuR2V0QmVoYXZpb3JUeXBlKGIpOwogICAgICAgICAgICAgICAgICAgIGMuYmVoYXZpb3JUeXBlID0gYTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgInBsdWdpbiI6CiAgICAgICAgICAgICAgICAgICAgYy5wbHVnaW4gPSBiLkdldFBsdWdpbigpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgeWllbGQgYwogICAgICAgIH0KICAgIH0KICAgIEdldFdvcmxkSW5mbygpIHsKICAgICAgICBpZiAodGhpcy5fd29ybGRJbmZvICYmCiAgICAgICAgICAgIHRoaXMuSXNJbnN0YW5jZVZhbGlkKCkpIHJldHVybiB0aGlzLl93b3JsZEluZm87CiAgICAgICAgY29uc3QgYSA9IHRoaXMuR2V0SW5zdGFuY2UoKTsKICAgICAgICBhICYmICh0aGlzLl93b3JsZEluZm8gPSBhLkdldFdvcmxkSW5mbygpKTsKICAgICAgICByZXR1cm4gdGhpcy5fd29ybGRJbmZvCiAgICB9CiAgICBHZXRUcmFja0RhdGFJdGVtKCkgewogICAgICAgIHJldHVybiB0aGlzLl90cmFja0RhdGFJdGVtCiAgICB9CiAgICBHZXRJbnN0YW5jZVVJRCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5faW5zdGFuY2VVaWQgPyB0aGlzLl9pbnN0YW5jZVVpZCA6IHRoaXMuX3RyYWNrRGF0YUl0ZW0uR2V0SW5zdGFuY2VVSUQoKQogICAgfQogICAgU2V0SW5zdGFuY2VVSUQoYSkgewogICAgICAgIHRoaXMuX3RyYWNrRGF0YUl0ZW0uU2V0SW5zdGFuY2VVSUQoYSkKICAgIH0KICAgIEdldEludGVycG9sYXRpb25Nb2RlKCkgewogICAgICAgIHJldHVybiB0aGlzLl90cmFja0RhdGFJdGVtLkdldEludGVycG9sYXRpb25Nb2RlKCkKICAgIH0KICAgIFNldEludGVycG9sYXRpb25Nb2RlKGEpIHsKICAgICAgICB0aGlzLl90cmFja0RhdGFJdGVtLlNldEludGVycG9sYXRpb25Nb2RlKGEpCiAgICB9CiAgICBHZXRSZXN1bHRNb2RlKCkgewogICAgICAgIHJldHVybiB0aGlzLl90cmFja0RhdGFJdGVtLkdldFJlc3VsdE1vZGUoKQogICAgfQogICAgR2V0SWQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3RyYWNrRGF0YUl0ZW0uR2V0SWQoKQogICAgfQogICAgR2V0U3RhcnRPZmZzZXQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3RyYWNrRGF0YUl0ZW0uR2V0U3RhcnRPZmZzZXQoKQogICAgfQogICAgR2V0TG9jYWxUb3RhbFRpbWUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3RyYWNrRGF0YUl0ZW0uR2V0TG9jYWxUb3RhbFRpbWUoKQogICAgfQogICAgU2V0TG9jYWxUb3RhbFRpbWUoYSkgewogICAgICAgIHRoaXMuX3RyYWNrRGF0YUl0ZW0uU2V0TG9jYWxUb3RhbFRpbWUoYSkKICAgIH0KICAgIFNldFJlc3VsdE1vZGUoYSkgewogICAgICAgIHRoaXMuX3RyYWNrRGF0YUl0ZW0uU2V0UmVzdWx0TW9kZShhKQogICAgfQogICAgU2V0RWFzZShhKSB7CiAgICAgICAgZm9yIChjb25zdCBiIG9mIHRoaXMuR2V0S2V5ZnJhbWVEYXRhSXRlbXMoKSkgYi5TZXRFYXNlKGEpOwogICAgICAgIGZvciAoY29uc3QgYiBvZiB0aGlzLkdldFByb3BlcnR5VHJhY2tzKCkpIGIuU2V0RWFzZShhKQogICAgfQogICAgR2V0RW5hYmxlKCkgewogICAgICAgIHJldHVybiB0aGlzLl90cmFja0RhdGFJdGVtLkdldEVuYWJsZSgpCiAgICB9CiAgICBTZXRFbmFibGUoYSkgewogICAgICAgIHRoaXMuX3RyYWNrRGF0YUl0ZW0uU2V0RW5hYmxlKGEpCiAgICB9CiAgICBHZXRPYmplY3RDbGFzc0luZGV4KCkgewogICAgICAgIHJldHVybiBpc05hTih0aGlzLl9vYmplY3RDbGFzc0luZGV4KSA/IHRoaXMuX3RyYWNrRGF0YUl0ZW0uR2V0T2JqZWN0Q2xhc3NJbmRleCgpIDogdGhpcy5fb2JqZWN0Q2xhc3NJbmRleAogICAgfQogICAgU2V0T2JqZWN0Q2xhc3NJbmRleChhKSB7CiAgICAgICAgdGhpcy5fdHJhY2tEYXRhSXRlbS5TZXRPYmplY3RDbGFzc0luZGV4KGEpCiAgICB9CiAgICBTZXRPcmlnaW5hbFdpZHRoKGEpIHsKICAgICAgICB0aGlzLl90cmFja0RhdGFJdGVtLlNldE9yaWdpbmFsV2lkdGgoYSkKICAgIH0KICAgIEdldE9yaWdpbmFsV2lkdGgoKSB7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuR2V0SW5zdGFuY2UoKTsKICAgICAgICByZXR1cm4gYSAmJiBhLkdldFNka0luc3RhbmNlKCkuSXNPcmlnaW5hbFNpemVLbm93bigpID8gYS5HZXRTZGtJbnN0YW5jZSgpLkdldE9yaWdpbmFsV2lkdGgoKSA6CiAgICAgICAgICAgIHRoaXMuX3RyYWNrRGF0YUl0ZW0uR2V0T3JpZ2luYWxXaWR0aCgpCiAgICB9CiAgICBTZXRPcmlnaW5hbEhlaWdodChhKSB7CiAgICAgICAgdGhpcy5fdHJhY2tEYXRhSXRlbS5TZXRPcmlnaW5hbEhlaWdodChhKQogICAgfQogICAgR2V0T3JpZ2luYWxIZWlnaHQoKSB7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuR2V0SW5zdGFuY2UoKTsKICAgICAgICByZXR1cm4gYSAmJiBhLkdldFNka0luc3RhbmNlKCkuSXNPcmlnaW5hbFNpemVLbm93bigpID8gYS5HZXRTZGtJbnN0YW5jZSgpLkdldE9yaWdpbmFsSGVpZ2h0KCkgOiB0aGlzLl90cmFja0RhdGFJdGVtLkdldE9yaWdpbmFsSGVpZ2h0KCkKICAgIH0KICAgIEdldFR5cGUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3RyYWNrRGF0YUl0ZW0uR2V0VHlwZSgpCiAgICB9CiAgICBHZXROYW1lKCkgewogICAgICAgIHJldHVybiB0aGlzLl90cmFja0RhdGFJdGVtLkdldE5hbWUoKQogICAgfQogICAgSXNJbnN0YW5jZVRyYWNrKCkgewogICAgICAgIHJldHVybiAwID09PSB0aGlzLkdldFR5cGUoKQogICAgfQogICAgSXNWYWx1ZVRyYWNrKCkgewogICAgICAgIHJldHVybiAxID09PSB0aGlzLkdldFR5cGUoKQogICAgfQogICAgSXNBdWRpb1RyYWNrKCkgewogICAgICAgIHJldHVybiAyID09PSB0aGlzLkdldFR5cGUoKQogICAgfQogICAgR2V0V29ybGRJbmZvQ2hhbmdlKCkgewogICAgICAgIHJldHVybiB0aGlzLl93b3JsZEluZm9DaGFuZ2UKICAgIH0KICAgIEdldFJlbmRlckNoYW5nZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcmVuZGVyQ2hhbmdlCiAgICB9CiAgICBHZXROZWVkc0JlZm9yZUFuZEFmdGVyKCkgewogICAgICAgIHJldHVybiB0aGlzLl9uZWVkc0JlZm9yZUFuZEFmdGVyCiAgICB9CiAgICBJc05lc3RlZCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5faXNOZXN0ZWQKICAgIH0KICAgIFNldFJlc2V0U3RhdGUoKSB7CiAgICAgICAgZm9yIChjb25zdCBhIG9mIHRoaXMuX3Byb3BlcnR5VHJhY2tzKSBhLlNldFJlc2V0U3RhdGUoKQogICAgfQogICAgU2V0SW5pdGlhbFN0YXRlKCkgewogICAgICAgIHRoaXMuTWF5YmVHZXRJbnN0YW5jZSgpOwogICAgICAgIGlmICh0aGlzLklzSW5zdGFuY2VWYWxpZCgpIHx8ICF0aGlzLklzSW5zdGFuY2VUcmFjaygpKSB7CiAgICAgICAgICAgIHZhciBhID0gdGhpcy5HZXRUaW1lbGluZSgpLklzRm9yd2FyZFBsYXlCYWNrKCkgPyAwIDogdGhpcy5HZXRMb2NhbFRvdGFsVGltZSgpOwogICAgICAgICAgICBmb3IgKGNvbnN0IGIgb2YgdGhpcy5fcHJvcGVydHlUcmFja3MpIGIuU2V0SW5pdGlhbFN0YXRlKGEpLCAwID09PSB0aGlzLl93b3JsZEluZm9DaGFuZ2UgJiYgMSA9PT0gYi5HZXRXb3JsZEluZm9DaGFuZ2UoKSAmJiAodGhpcy5fd29ybGRJbmZvQ2hhbmdlID0gMSksIDAgPT09IHRoaXMuX3JlbmRlckNoYW5nZSAmJiAxID09PSBiLkdldFJlbmRlckNoYW5nZSgpICYmICh0aGlzLl9yZW5kZXJDaGFuZ2UgPSAxKTsKICAgICAgICAgICAgdGhpcy5fbmVlZHNCZWZvcmVBbmRBZnRlciA9IDA7CiAgICAgICAgICAgIHRoaXMuX3Byb3BlcnR5VHJhY2tzLnNvbWUoYiA9PiBiLkdldE5lZWRzQmVmb3JlQW5kQWZ0ZXIoKSkgJiYgKHRoaXMuX25lZWRzQmVmb3JlQW5kQWZ0ZXIgPSAxKTsKICAgICAgICAgICAgdGhpcy5fbGFzdEtleWZyYW1lRGF0YUl0ZW0gPSB0aGlzLl9HZXRMYXN0S2V5RnJhbWVCZWZvcmVUaW1lKGEpOwogICAgICAgICAgICB0aGlzLl9lbmRTdGF0ZU9mTmVzdGVkU2V0ID0gdGhpcy5faW5pdGlhbFN0YXRlT2ZOZXN0ZWRTZXQgPSAhMTsKICAgICAgICAgICAgdGhpcy5JbnRlcnBvbGF0ZShhKTsKICAgICAgICAgICAgdGhpcy5PbktleWZyYW1lUmVhY2hlZCh0aGlzLl9HZXRMYXN0S2V5RnJhbWVCZWZvcmVUaW1lKGEpKQogICAgICAgIH0KICAgIH0KICAgIFNldFJlc3VtZVN0YXRlKCkgewogICAgICAgIHRoaXMuTWF5YmVHZXRJbnN0YW5jZSgpOwogICAgICAgIGlmICh0aGlzLklzSW5zdGFuY2VWYWxpZCgpIHx8ICF0aGlzLklzSW5zdGFuY2VUcmFjaygpKSB7CiAgICAgICAgICAgIHRoaXMuX3RpbWVsaW5lLklzRm9yd2FyZFBsYXlCYWNrKCk7CiAgICAgICAgICAgIHZhciBhID0gdGhpcy5fdGltZWxpbmUuR2V0VGltZSgpIC0gdGhpcy5HZXRTdGFydE9mZnNldCgpOwogICAgICAgICAgICB0aGlzLl9sYXN0S2V5ZnJhbWVEYXRhSXRlbSA9IHRoaXMuX0dldExhc3RLZXlGcmFtZUJlZm9yZVRpbWUoYSk7CiAgICAgICAgICAgIGZvciAoY29uc3QgYiBvZiB0aGlzLl9wcm9wZXJ0eVRyYWNrcykgYi5TZXRSZXN1bWVTdGF0ZShhKQogICAgICAgIH0KICAgIH0KICAgIFNldEVuZFN0YXRlKCkgewogICAgICAgIGlmICghKHRoaXMuR2V0VGltZWxpbmUoKS5Jc0NvbXBsZXRlKCkgfHwgKHRoaXMuTWF5YmVHZXRJbnN0YW5jZSgpLCAhdGhpcy5Jc0luc3RhbmNlVmFsaWQoKSAmJiB0aGlzLklzSW5zdGFuY2VUcmFjaygpIHx8IHRoaXMuX2lzTmVzdGVkKSkpIHsKICAgICAgICAgICAgY29uc3QgYSA9IHRoaXMuX3RpbWVsaW5lLkdldFRpbWUoKSwKICAgICAgICAgICAgICAgIGIgPSB0aGlzLkdldFN0YXJ0T2Zmc2V0KCkgKyB0aGlzLkdldExvY2FsVG90YWxUaW1lKCk7CiAgICAgICAgICAgIGEgPj0gYiA/IHRoaXMuSW50ZXJwb2xhdGUodGhpcy5HZXRMb2NhbFRvdGFsVGltZSgpLCAhMCwgITEsICEwKSA6IDAgPj0gYSAmJiB0aGlzLkludGVycG9sYXRlKDAsICEwLCAhMSwgITApCiAgICAgICAgfQogICAgfQogICAgX1NldFVwZGF0ZVN0YXRlKCkgewogICAgICAgIGZvciAobGV0IGEgPSAwLCBiID0gdGhpcy5fcHJvcGVydHlUcmFja3MubGVuZ3RoOyBhIDwgYjsgYSsrKSB7CiAgICAgICAgICAgIGNvbnN0IGQgPSB0aGlzLl9wcm9wZXJ0eVRyYWNrc1thXTsKICAgICAgICAgICAgZC5fU2V0VXBkYXRlU3RhdGUoKTsKICAgICAgICAgICAgMCA9PT0gdGhpcy5fd29ybGRJbmZvQ2hhbmdlICYmIDEgPT09IGQuR2V0V29ybGRJbmZvQ2hhbmdlKCkgJiYgKHRoaXMuX3dvcmxkSW5mb0NoYW5nZSA9IDEpOwogICAgICAgICAgICAwID09PSB0aGlzLl9yZW5kZXJDaGFuZ2UgJiYgMSA9PT0gZC5HZXRSZW5kZXJDaGFuZ2UoKSAmJiAodGhpcy5fcmVuZGVyQ2hhbmdlID0KICAgICAgICAgICAgICAgIDEpCiAgICAgICAgfQogICAgfQogICAgQmVmb3JlSW50ZXJwb2xhdGUoKSB7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuX3Byb3BlcnR5VHJhY2tzLmxlbmd0aDsKICAgICAgICBmb3IgKGxldCBiID0gMDsgYiA8IGE7IGIrKykgdGhpcy5fcHJvcGVydHlUcmFja3NbYl0uQmVmb3JlSW50ZXJwb2xhdGUoKQogICAgfQogICAgSW50ZXJwb2xhdGUoYSwgYiA9ICExLCBkID0gITEsIGMgPSAhMSwgZSA9ICExLCBnID0gITEpIHsKICAgICAgICB0aGlzLl9pbnN0YW5jZSB8fCB0aGlzLkdldEluc3RhbmNlKCk7CiAgICAgICAgY29uc3QgayA9IHRoaXMuX2luc3RhbmNlICYmICF0aGlzLl9pbnN0YW5jZS5Jc0Rlc3Ryb3llZCgpLAogICAgICAgICAgICBtID0gMCA9PT0gdGhpcy5fdHJhY2tEYXRhSXRlbS5fdHlwZTsKICAgICAgICBpZiAoISghayAmJiBtIHx8IGcgJiYgbSAmJiB0aGlzLkdldE9iamVjdENsYXNzKCkuSXNHbG9iYWwoKSB8fCAoYSAtPSB0aGlzLkdldFN0YXJ0T2Zmc2V0KCksIDAgPiBhKSkpIHsKICAgICAgICAgICAgdGhpcy5NYXliZVNldEluaXRpYWxTdGF0ZU9mTmVzdGVkVHJhY2soYSwgYik7CiAgICAgICAgICAgIHRoaXMuTWF5YmVUcmlnZ2VyS2V5ZnJhbWVSZWFjaGVkQ29uZGl0aW9ucyhhLCBiLCBlKTsKICAgICAgICAgICAgZm9yIChsZXQgbiA9IDAsIHEgPSB0aGlzLl9wcm9wZXJ0eVRyYWNrcy5sZW5ndGg7IG4gPAogICAgICAgICAgICAgICAgcTsgbisrKSB0aGlzLl9wcm9wZXJ0eVRyYWNrc1tuXS5JbnRlcnBvbGF0ZShhLCBkLCBjKTsKICAgICAgICAgICAgdGhpcy5NYXliZVNldEVuZFN0YXRlT2ZOZXN0ZWRUcmFjayhhLCBiKTsKICAgICAgICAgICAgMCAhPT0gdGhpcy5fd29ybGRJbmZvQ2hhbmdlICYmICh0aGlzLl93b3JsZEluZm8gfHwgKHRoaXMuX3dvcmxkSW5mbyA9IHRoaXMuX2luc3RhbmNlLkdldFdvcmxkSW5mbygpKSwgdGhpcy5fd29ybGRJbmZvICYmIHRoaXMuX3dvcmxkSW5mby5TZXRCYm94Q2hhbmdlZCgpKQogICAgICAgIH0KICAgIH0KICAgIEFmdGVySW50ZXJwb2xhdGUoKSB7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuX3Byb3BlcnR5VHJhY2tzLmxlbmd0aDsKICAgICAgICBmb3IgKGxldCBiID0gMDsgYiA8IGE7IGIrKykgdGhpcy5fcHJvcGVydHlUcmFja3NbYl0uQWZ0ZXJJbnRlcnBvbGF0ZSgpCiAgICB9CiAgICBNYXliZVNldEluaXRpYWxTdGF0ZU9mTmVzdGVkVHJhY2soYSwgYikgewogICAgICAgIGlmIChiICYmIHRoaXMuX2lzTmVzdGVkICYmICF0aGlzLl9pbml0aWFsU3RhdGVPZk5lc3RlZFNldCkgewogICAgICAgICAgICBpZiAodGhpcy5HZXRUaW1lbGluZSgpLklzRm9yd2FyZFBsYXlCYWNrKCkpIHsKICAgICAgICAgICAgICAgIGlmICgwID4gYSkgcmV0dXJuOwogICAgICAgICAgICAgICAgZm9yIChjb25zdCBkIG9mIHRoaXMuX3Byb3BlcnR5VHJhY2tzKSBkLkludGVycG9sYXRlKDAsICExLCAhMCkKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlmIChhID4gdGhpcy5HZXRMb2NhbFRvdGFsVGltZSgpKSByZXR1cm47CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGQgb2YgdGhpcy5fcHJvcGVydHlUcmFja3MpIGQuSW50ZXJwb2xhdGUodGhpcy5HZXRMb2NhbFRvdGFsVGltZSgpLCAhMSwgITApCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yIChjb25zdCBkIG9mIHRoaXMuX3Byb3BlcnR5VHJhY2tzKSBkLlNldEluaXRpYWxTdGF0ZSgpOwogICAgICAgICAgICB0aGlzLl9pbml0aWFsU3RhdGVPZk5lc3RlZFNldCA9ICEwCiAgICAgICAgfQogICAgfQogICAgTWF5YmVTZXRFbmRTdGF0ZU9mTmVzdGVkVHJhY2soYSwgYikgewogICAgICAgIGlmIChiICYmIHRoaXMuX2lzTmVzdGVkICYmICF0aGlzLl9lbmRTdGF0ZU9mTmVzdGVkU2V0KQogICAgICAgICAgICBpZiAodGhpcy5HZXRUaW1lbGluZSgpLklzRm9yd2FyZFBsYXlCYWNrKCkpIHsKICAgICAgICAgICAgICAgIGlmIChhID49IHRoaXMuR2V0TG9jYWxUb3RhbFRpbWUoKSkgewogICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgZCBvZiB0aGlzLl9wcm9wZXJ0eVRyYWNrcykgZC5JbnRlcnBvbGF0ZSh0aGlzLkdldExvY2FsVG90YWxUaW1lKCksICExLCAhMCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZW5kU3RhdGVPZk5lc3RlZFNldCA9ICEwCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAoMCA+PSBhKSB7CiAgICAgICAgICAgIGZvciAoY29uc3QgZCBvZiB0aGlzLl9wcm9wZXJ0eVRyYWNrcykgZC5JbnRlcnBvbGF0ZSgwLCAhMSwgITApOwogICAgICAgICAgICB0aGlzLl9lbmRTdGF0ZU9mTmVzdGVkU2V0ID0gITAKICAgICAgICB9CiAgICB9CiAgICBNYXliZVRyaWdnZXJLZXlmcmFtZVJlYWNoZWRDb25kaXRpb25zKGEsIGIsIGQpIHsKICAgICAgICBpZiAoIWQgJiYgYiAmJiBDMyRqc2NvbXAkODUuUGx1Z2lucy5UaW1lbGluZSkgewogICAgICAgICAgICBiID0gdGhpcy5HZXRUaW1lbGluZSgpOwogICAgICAgICAgICBkID0gdGhpcy5fbGFzdEtleWZyYW1lRGF0YUl0ZW0uR2V0TmV4dCgpOwogICAgICAgICAgICB2YXIgYyA9IHRoaXMuX2xhc3RLZXlmcmFtZURhdGFJdGVtLkdldFRpbWUoKSwKICAgICAgICAgICAgICAgIGUgPSBkID8gZC5HZXRUaW1lKCkgOiBiLkdldFRvdGFsVGltZSgpOwogICAgICAgICAgICBpZiAoYSA8PSBjIHx8IGEgPj0gZSkgdGhpcy5fbGFzdEtleWZyYW1lRGF0YUl0ZW0gPSB0aGlzLl90cmFja0RhdGEuR2V0Rmlyc3RLZXlGcmFtZURhdGFJdGVtTG93ZXJPckVxdWFsVGhhbihhLCB0aGlzLl90cmFja0RhdGFJdGVtKSwgYi5Jc0ZvcndhcmRQbGF5QmFjaygpID8KICAgICAgICAgICAgICAgIGQgJiYgdGhpcy5PbktleWZyYW1lUmVhY2hlZCh0aGlzLl9sYXN0S2V5ZnJhbWVEYXRhSXRlbSkgOiAoYSA9IHRoaXMuX2xhc3RLZXlmcmFtZURhdGFJdGVtLkdldE5leHQoKSkgJiYgdGhpcy5PbktleWZyYW1lUmVhY2hlZChhKQogICAgICAgIH0KICAgIH0KICAgIF9HZXRMYXN0S2V5RnJhbWVCZWZvcmVUaW1lKGEpIHsKICAgICAgICBjb25zdCBiID0gdGhpcy5fdHJhY2tEYXRhLkdldEtleUZyYW1lRGF0YUl0ZW1BdFRpbWUoYSwgdGhpcy5fdHJhY2tEYXRhSXRlbSk7CiAgICAgICAgcmV0dXJuIGIgPyBiIDogdGhpcy5fdHJhY2tEYXRhLkdldEZpcnN0S2V5RnJhbWVEYXRhSXRlbUxvd2VyT3JFcXVhbFRoYW4oYSwgdGhpcy5fdHJhY2tEYXRhSXRlbSkKICAgIH0KICAgIE9uS2V5ZnJhbWVSZWFjaGVkKGEpIHsKICAgICAgICBjb25zdCBiID0gdGhpcy5HZXRUaW1lbGluZSgpOwogICAgICAgIEMzJGpzY29tcCQ4NS5QbHVnaW5zLlRpbWVsaW5lLkNuZHMuU2V0VHJpZ2dlclRpbWVsaW5lKGIpOwogICAgICAgIEMzJGpzY29tcCQ4NS5QbHVnaW5zLlRpbWVsaW5lLkNuZHMuU2V0VHJpZ2dlcktleWZyYW1lKGEpOwogICAgICAgIGEgPSBiLkdldFRpbWVsaW5lTWFuYWdlcigpOwogICAgICAgIGEuVHJpZ2dlcihDMyRqc2NvbXAkODUuUGx1Z2lucy5UaW1lbGluZS5DbmRzLk9uQW55S2V5ZnJhbWVSZWFjaGVkKTsKICAgICAgICBhLlRyaWdnZXIoQzMkanNjb21wJDg1LlBsdWdpbnMuVGltZWxpbmUuQ25kcy5PbktleWZyYW1lUmVhY2hlZCk7CiAgICAgICAgQzMkanNjb21wJDg1LlBsdWdpbnMuVGltZWxpbmUuQ25kcy5TZXRUcmlnZ2VyVGltZWxpbmUobnVsbCk7CiAgICAgICAgQzMkanNjb21wJDg1LlBsdWdpbnMuVGltZWxpbmUuQ25kcy5TZXRUcmlnZ2VyS2V5ZnJhbWUobnVsbCkKICAgIH0KICAgIEFkZEtleWZyYW1lKCkgewogICAgICAgIHJldHVybiB0aGlzLl90cmFja0RhdGFJdGVtLkdldEtleWZyYW1lRGF0YSgpLkFkZEVtcHR5S2V5ZnJhbWVEYXRhSXRlbSgpCiAgICB9CiAgICBBZGRQcm9wZXJ0eVRyYWNrKCkgewogICAgICAgIHZhciBhID0gdGhpcy5fdHJhY2tEYXRhSXRlbS5HZXRQcm9wZXJ0eVRyYWNrRGF0YSgpLkFkZEVtcHR5UHJvcGVydHlUcmFja0RhdGFJdGVtKCk7CiAgICAgICAgYSA9IEMzJGpzY29tcCQ4NS5Qcm9wZXJ0eVRyYWNrU3RhdGUuQ3JlYXRlKHRoaXMsIGEpOwogICAgICAgIHRoaXMuX3Byb3BlcnR5VHJhY2tzLnB1c2goYSk7CiAgICAgICAgcmV0dXJuIGEKICAgIH0KICAgIERlbGV0ZUtleWZyYW1lcyhhKSB7CiAgICAgICAgdGhpcy5fdHJhY2tEYXRhSXRlbS5HZXRLZXlmcmFtZURhdGEoKS5EZWxldGVLZXlmcmFtZURhdGFJdGVtcyhhKQogICAgfQogICAgRGVsZXRlUHJvcGVydHlLZXlmcmFtZXMoYSkgewogICAgICAgIGZvciAoY29uc3QgYiBvZiB0aGlzLl9wcm9wZXJ0eVRyYWNrcykgYi5EZWxldGVQcm9wZXJ0eUtleWZyYW1lcyhhKQogICAgfQogICAgU2F2ZVN0YXRlKCkgewogICAgICAgIGZvciAoY29uc3QgYSBvZiB0aGlzLl9wcm9wZXJ0eVRyYWNrcykgYS5TYXZlU3RhdGUoKQogICAgfQogICAgQ29tcGFyZUluaXRpYWxTdGF0ZVdpdGhDdXJyZW50KCkgewogICAgICAgIHRoaXMuTWF5YmVHZXRJbnN0YW5jZSgpOwogICAgICAgIGlmICh0aGlzLklzSW5zdGFuY2VWYWxpZCgpIHx8ICF0aGlzLklzSW5zdGFuY2VUcmFjaygpKQogICAgICAgICAgICBmb3IgKGNvbnN0IGEgb2YgdGhpcy5fcHJvcGVydHlUcmFja3MpIGEuQ29tcGFyZUluaXRpYWxTdGF0ZVdpdGhDdXJyZW50KCkKICAgIH0KICAgIENvbXBhcmVTYXZlU3RhdGVXaXRoQ3VycmVudCgpIHsKICAgICAgICB0aGlzLk1heWJlR2V0SW5zdGFuY2UoKTsKICAgICAgICBpZiAodGhpcy5Jc0luc3RhbmNlVmFsaWQoKSB8fAogICAgICAgICAgICAhdGhpcy5Jc0luc3RhbmNlVHJhY2soKSkgewogICAgICAgICAgICB2YXIgYSA9ICExOwogICAgICAgICAgICBmb3IgKGNvbnN0IGIgb2YgdGhpcy5fcHJvcGVydHlUcmFja3MpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGQgPSBiLkNvbXBhcmVTYXZlU3RhdGVXaXRoQ3VycmVudCgpOwogICAgICAgICAgICAgICAgIWEgJiYgZCAmJiAoYSA9ICEwKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGEgJiYgKGEgPSB0aGlzLkFkZEtleWZyYW1lKCksIGEuU2V0VGltZSh0aGlzLkdldFRpbWVsaW5lKCkuR2V0VGltZSgpKSwgYS5TZXRFYXNlKCJub2Vhc2UiKSwgYS5TZXRFbmFibGUoITApLCBhLlNldFRhZ3MoIiIpKQogICAgICAgIH0KICAgIH0KICAgIF9TYXZlVG9Kc29uKCkgewogICAgICAgIHZhciBhID0gdGhpcy5HZXRJbnN0YW5jZSgpOwogICAgICAgIGEgPSBhID8gYS5HZXRVSUQoKSA6IHRoaXMuR2V0SW5zdGFuY2VVSUQoKTsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBwcm9wZXJ0eVRyYWNrc0pzb246IHRoaXMuX1NhdmVQcm9wZXJ0eVRyYWNrc1RvSnNvbigpLAogICAgICAgICAgICBsYXN0S2V5ZnJhbWVEYXRhSXRlbUpzb246IHRoaXMuX1NhdmVMYXN0S2V5ZnJhbWVEYXRhSXRlbVRvSnNvbigpLAogICAgICAgICAgICBpbml0aWFsU3RhdGVPZk5lc3RlZFNldDogdGhpcy5faW5pdGlhbFN0YXRlT2ZOZXN0ZWRTZXQsCiAgICAgICAgICAgIGVuZFN0YXRlT2ZOZXN0ZWRTZXQ6IHRoaXMuX2VuZFN0YXRlT2ZOZXN0ZWRTZXQsCiAgICAgICAgICAgIGluc3RhbmNlVWlkOiBhCiAgICAgICAgfQogICAgfQogICAgX0xvYWRGcm9tSnNvbihhKSB7CiAgICAgICAgaWYgKGEpIHsKICAgICAgICAgICAgdGhpcy5fTG9hZFByb3BlcnR5VHJhY2tzRnJvbUpzb24oYS5wcm9wZXJ0eVRyYWNrc0pzb24pOwogICAgICAgICAgICB0aGlzLl9Mb2FkTGFzdEtleWZyYW1lRGF0YUl0ZW1Gcm9tSnNvbihhLmxhc3RLZXlmcmFtZURhdGFJdGVtSnNvbik7CiAgICAgICAgICAgIHRoaXMuX0xvYWRJbnN0YW5jZUZyb21Kc29uKGEuaW5zdGFuY2VVaWQpOwogICAgICAgICAgICB0aGlzLl9pbml0aWFsU3RhdGVPZk5lc3RlZFNldCA9ICExOwogICAgICAgICAgICBhLmhhc093blByb3BlcnR5LmluaXRpYWxTdGF0ZU9mTmVzdGVkU2V0ICYmICh0aGlzLl9pbml0aWFsU3RhdGVPZk5lc3RlZFNldCA9IGEuaW5pdGlhbFN0YXRlT2ZOZXN0ZWRTZXQpOwogICAgICAgICAgICB0aGlzLl9lbmRTdGF0ZU9mTmVzdGVkU2V0ID0gITE7CiAgICAgICAgICAgIGEuaGFzT3duUHJvcGVydHkuZW5kU3RhdGVPZk5lc3RlZFNldCAmJiAodGhpcy5fZW5kU3RhdGVPZk5lc3RlZFNldCA9IGEuZW5kU3RhdGVPZk5lc3RlZFNldCk7CiAgICAgICAgICAgIGZvciAoY29uc3QgYiBvZiB0aGlzLl9wcm9wZXJ0eVRyYWNrcykgMCA9PT0gdGhpcy5fd29ybGRJbmZvQ2hhbmdlICYmCiAgICAgICAgICAgICAgICAxID09PSBiLkdldFdvcmxkSW5mb0NoYW5nZSgpICYmICh0aGlzLl93b3JsZEluZm9DaGFuZ2UgPSAxKSwgMCA9PT0gdGhpcy5fcmVuZGVyQ2hhbmdlICYmIDEgPT09IGIuR2V0UmVuZGVyQ2hhbmdlKCkgJiYgKHRoaXMuX3JlbmRlckNoYW5nZSA9IDEpOwogICAgICAgICAgICB0aGlzLl9uZWVkc0JlZm9yZUFuZEFmdGVyID0gMDsKICAgICAgICAgICAgdGhpcy5fcHJvcGVydHlUcmFja3Muc29tZShiID0+IGIuR2V0TmVlZHNCZWZvcmVBbmRBZnRlcigpKSAmJiAodGhpcy5fbmVlZHNCZWZvcmVBbmRBZnRlciA9IDEpCiAgICAgICAgfQogICAgfQogICAgX1NhdmVMYXN0S2V5ZnJhbWVEYXRhSXRlbVRvSnNvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdHJhY2tEYXRhSXRlbS5HZXRLZXlmcmFtZURhdGEoKS5HZXRLZXlmcmFtZURhdGFJdGVtSW5kZXgodGhpcy5fbGFzdEtleWZyYW1lRGF0YUl0ZW0pCiAgICB9CiAgICBfU2F2ZVByb3BlcnR5VHJhY2tzVG9Kc29uKCkgewogICAgICAgIHJldHVybiB0aGlzLl9wcm9wZXJ0eVRyYWNrcy5tYXAoYSA9PiBhLl9TYXZlVG9Kc29uKCkpCiAgICB9CiAgICBfTG9hZFByb3BlcnR5VHJhY2tzRnJvbUpzb24oYSkgewogICAgICAgIGEuZm9yRWFjaCgoYiwgZCkgPT4gewogICAgICAgICAgICB0aGlzLl9wcm9wZXJ0eVRyYWNrc1tkXS5fTG9hZEZyb21Kc29uKGIpCiAgICAgICAgfSkKICAgIH0KICAgIF9Mb2FkSW5zdGFuY2VGcm9tSnNvbihhKSB7CiAgICAgICAgaWYgKEMzJGpzY29tcCQ4NS5Jc0Zpbml0ZU51bWJlcihhKSAmJiAoYSA9IHRoaXMuR2V0UnVudGltZSgpLkdldEluc3RhbmNlQnlVSUQoYSkpKSB7CiAgICAgICAgICAgIHZhciBiID0gdGhpcy5HZXRUaW1lbGluZSgpOwogICAgICAgICAgICBiLkNsZWFyVHJhY2tJbnN0YW5jZXMoKTsKICAgICAgICAgICAgYi5TZXRUcmFja0luc3RhbmNlKHRoaXMuX3RyYWNrRGF0YUl0ZW0uR2V0SWQoKSwgYSkKICAgICAgICB9CiAgICB9CiAgICBfTG9hZExhc3RLZXlmcmFtZURhdGFJdGVtRnJvbUpzb24oYSkgewogICAgICAgIHRoaXMuX2xhc3RLZXlmcmFtZURhdGFJdGVtID0gdGhpcy5fdHJhY2tEYXRhSXRlbS5HZXRLZXlmcmFtZURhdGEoKS5HZXRLZXlmcmFtZURhdGFJdGVtRnJvbUluZGV4KGEpCiAgICB9Cn07CiJ1c2Ugc3RyaWN0IjsKY29uc3QgQzMkanNjb21wJDg2ID0gc2VsZi5DMzsKQzMkanNjb21wJDg2LlByb3BlcnR5VHJhY2tTdGF0ZSA9IGNsYXNzIGV4dGVuZHMgQzMkanNjb21wJDg2LkRlZmVuZGVkQmFzZSB7CiAgICBjb25zdHJ1Y3RvcihhLCBiKSB7CiAgICAgICAgc3VwZXIoKTsKICAgICAgICB0aGlzLl90cmFjayA9IGE7CiAgICAgICAgdGhpcy5fcHJvcGVydHlUcmFja0RhdGFJdGVtID0gYjsKICAgICAgICB0aGlzLl9wcm9wZXJ0eVRyYWNrRGF0YSA9IGIuR2V0UHJvcGVydHlUcmFja0RhdGEoKTsKICAgICAgICB0aGlzLl9uZWVkc0JlZm9yZUFuZEFmdGVyID0gdGhpcy5fcmVuZGVyQ2hhbmdlID0gdGhpcy5fd29ybGRJbmZvQ2hhbmdlID0gMDsKICAgICAgICB0aGlzLl9zb3VyY2VBZGFwdGVyID0gdGhpcy5HZXRTb3VyY2VBZGFwdGVyKCk7CiAgICAgICAgdGhpcy5fcHJvcGVydHlLZXlmcmFtZURhdGFJdGVtcyA9IHRoaXMuX3Byb3BlcnR5VHJhY2tEYXRhSXRlbS5HZXRQcm9wZXJ0eUtleWZyYW1lRGF0YSgpLkdldFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbUFycmF5KCk7CiAgICAgICAgdGhpcy5fYWJzb2x1dGVWYWx1ZU9iamVjdCA9IHRoaXMuX2xhc3RQcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW0gPSBudWxsCiAgICB9CiAgICBzdGF0aWMgQ3JlYXRlKGEsCiAgICAgICAgYikgewogICAgICAgIHJldHVybiBDMyRqc2NvbXAkODYuTmV3KEMzJGpzY29tcCQ4Ni5Qcm9wZXJ0eVRyYWNrU3RhdGUsIGEsIGIpCiAgICB9CiAgICBSZWxlYXNlKCkgewogICAgICAgIHRoaXMuX3RyYWNrID0gbnVsbDsKICAgICAgICB0aGlzLl9zb3VyY2VBZGFwdGVyICYmICh0aGlzLl9zb3VyY2VBZGFwdGVyLlJlbGVhc2UoKSwgdGhpcy5fc291cmNlQWRhcHRlciA9IG51bGwpOwogICAgICAgIHRoaXMuX3Byb3BlcnR5VHJhY2tEYXRhID0gdGhpcy5fcHJvcGVydHlUcmFja0RhdGFJdGVtID0gdGhpcy5fcHJvcGVydHlLZXlmcmFtZURhdGFJdGVtcyA9IG51bGwKICAgIH0KICAgIEdldFdvcmxkSW5mb0NoYW5nZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fd29ybGRJbmZvQ2hhbmdlCiAgICB9CiAgICBHZXRSZW5kZXJDaGFuZ2UoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3JlbmRlckNoYW5nZQogICAgfQogICAgR2V0TmVlZHNCZWZvcmVBbmRBZnRlcigpIHsKICAgICAgICByZXR1cm4gdGhpcy5fbmVlZHNCZWZvcmVBbmRBZnRlcgogICAgfQogICAgSGFzQWJzb2x1dGVWYWx1ZU9iamVjdCgpIHsKICAgICAgICByZXR1cm4gISF0aGlzLl9hYnNvbHV0ZVZhbHVlT2JqZWN0CiAgICB9CiAgICBTZXRBYnNvbHV0ZVZhbHVlT2JqZWN0KGEpIHsKICAgICAgICB0aGlzLl9hYnNvbHV0ZVZhbHVlT2JqZWN0ID0KICAgICAgICAgICAgYQogICAgfQogICAgR2V0QWJzb2x1dGVWYWx1ZU9iamVjdCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fYWJzb2x1dGVWYWx1ZU9iamVjdAogICAgfQogICAgR2V0VHJhY2soKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3RyYWNrCiAgICB9CiAgICBHZXRQcm9wZXJ0eVRyYWNrRGF0YUl0ZW0oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3Byb3BlcnR5VHJhY2tEYXRhSXRlbQogICAgfQogICAgR2V0UHJvcGVydHlUcmFja0RhdGEoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3Byb3BlcnR5VHJhY2tEYXRhCiAgICB9CiAgICBHZXRUaW1lbGluZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdHJhY2suR2V0VGltZWxpbmUoKQogICAgfQogICAgR2V0UnVudGltZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdHJhY2suR2V0UnVudGltZSgpCiAgICB9CiAgICBHZXRJbnN0YW5jZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdHJhY2suR2V0SW5zdGFuY2UoKQogICAgfQogICAgR2V0U291cmNlQWRhcHRlcigpIHsKICAgICAgICBpZiAodGhpcy5fc291cmNlQWRhcHRlcikgcmV0dXJuIHRoaXMuX3NvdXJjZUFkYXB0ZXI7CiAgICAgICAgbGV0IGE7CiAgICAgICAgc3dpdGNoICh0aGlzLl9wcm9wZXJ0eVRyYWNrRGF0YUl0ZW0uR2V0U291cmNlQWRhcHRlcklkKCkpIHsKICAgICAgICAgICAgY2FzZSAiYmVoYXZpb3IiOgogICAgICAgICAgICAgICAgYSA9IG5ldyBDMyRqc2NvbXAkODYuUHJvcGVydHlUcmFja1N0YXRlLkJlaGF2aW9yU291cmNlQWRhcHRlcih0aGlzKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICJlZmZlY3QiOgogICAgICAgICAgICAgICAgYSA9IG5ldyBDMyRqc2NvbXAkODYuUHJvcGVydHlUcmFja1N0YXRlLkVmZmVjdFNvdXJjZUFkYXB0ZXIodGhpcyk7CiAgICAgICAgICAgICAgICB0aGlzLl9yZW5kZXJDaGFuZ2UgPSAxOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgImluc3RhbmNlLXZhcmlhYmxlIjoKICAgICAgICAgICAgICAgIGEgPSBuZXcgQzMkanNjb21wJDg2LlByb3BlcnR5VHJhY2tTdGF0ZS5JbnN0YW5jZVZhcmlhYmxlU291cmNlQWRhcHRlcih0aGlzKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICJwbHVnaW4iOgogICAgICAgICAgICAgICAgYSA9IG5ldyBDMyRqc2NvbXAkODYuUHJvcGVydHlUcmFja1N0YXRlLlBsdWdpblNvdXJjZUFkYXB0ZXIodGhpcyk7CiAgICAgICAgICAgICAgICB0aGlzLl9yZW5kZXJDaGFuZ2UgPSAxOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgIndvcmxkLWluc3RhbmNlIjoKICAgICAgICAgICAgICAgIGEgPSBuZXcgQzMkanNjb21wJDg2LlByb3BlcnR5VHJhY2tTdGF0ZS5Qcm9wZXJ0eVNvdXJjZUFkYXB0ZXIodGhpcyk7CiAgICAgICAgICAgICAgICB0aGlzLl93b3JsZEluZm9DaGFuZ2UgPSB0aGlzLl9yZW5kZXJDaGFuZ2UgPSAxOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgInZhbHVlIjoKICAgICAgICAgICAgICAgIGEgPSBuZXcgQzMkanNjb21wJDg2LlByb3BlcnR5VHJhY2tTdGF0ZS5WYWx1ZVNvdXJjZUFkYXB0ZXIodGhpcyk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAiYXVkaW8iOgogICAgICAgICAgICAgICAgYSA9IG5ldyBDMyRqc2NvbXAkODYuUHJvcGVydHlUcmFja1N0YXRlLkF1ZGlvU291cmNlQWRhcHRlcih0aGlzKQogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpcy5fc291cmNlQWRhcHRlciA9IGEKICAgIH0KICAgIEdldFNvdXJjZUFkYXB0ZXJJZCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcHJvcGVydHlUcmFja0RhdGFJdGVtLkdldFNvdXJjZUFkYXB0ZXJJZCgpCiAgICB9CiAgICBTZXRTb3VyY2VBZGFwdGVySWQoYSkgewogICAgICAgIHRoaXMuX3Byb3BlcnR5VHJhY2tEYXRhSXRlbS5TZXRTb3VyY2VBZGFwdGVySWQoYSkKICAgIH0KICAgIEdldFNvdXJjZUFkYXB0ZXJBcmdzKCkgewogICAgICAgIHJldHVybiB0aGlzLl9wcm9wZXJ0eVRyYWNrRGF0YUl0ZW0uR2V0U291cmNlQWRhcHRlckFyZ3VtZW50cygpCiAgICB9CiAgICBTZXRTb3VyY2VBZGFwdGVyQXJncyhhKSB7CiAgICAgICAgdGhpcy5fcHJvcGVydHlUcmFja0RhdGFJdGVtLlNldFNvdXJjZUFkYXB0ZXJBcmd1bWVudHMoYSkKICAgIH0KICAgIEdldFNvdXJjZUFkYXB0ZXJWYWx1ZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5HZXRTb3VyY2VBZGFwdGVyKCkuR2V0VmFsdWUoKQogICAgfQogICAgR2V0UHJvcGVydHlOYW1lKCkgewogICAgICAgIHJldHVybiB0aGlzLl9wcm9wZXJ0eVRyYWNrRGF0YUl0ZW0uR2V0UHJvcGVydHkoKQogICAgfQogICAgU2V0UHJvcGVydHlOYW1lKGEpIHsKICAgICAgICB0aGlzLl9wcm9wZXJ0eVRyYWNrRGF0YUl0ZW0uU2V0UHJvcGVydHkoYSkKICAgIH0KICAgIEdldFByb3BlcnR5VHlwZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcHJvcGVydHlUcmFja0RhdGFJdGVtLkdldFR5cGUoKQogICAgfQogICAgU2V0UHJvcGVydHlUeXBlKGEpIHsKICAgICAgICB0aGlzLl9wcm9wZXJ0eVRyYWNrRGF0YUl0ZW0uU2V0VHlwZShhKQogICAgfQogICAgR2V0UHJvcGVydHlLZXlmcmFtZVR5cGUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuR2V0UHJvcGVydHlUcmFja0RhdGEoKS5HZXRGaXJzdFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbSh0aGlzLl9wcm9wZXJ0eVRyYWNrRGF0YUl0ZW0pLkdldFR5cGUoKQogICAgfQogICAgR2V0TWluKCkgewogICAgICAgIHJldHVybiB0aGlzLl9wcm9wZXJ0eVRyYWNrRGF0YUl0ZW0uR2V0TWluKCkKICAgIH0KICAgIFNldE1pbihhKSB7CiAgICAgICAgdGhpcy5fcHJvcGVydHlUcmFja0RhdGFJdGVtLlNldE1pbihhKQogICAgfQogICAgR2V0TWF4KCkgewogICAgICAgIHJldHVybiB0aGlzLl9wcm9wZXJ0eVRyYWNrRGF0YUl0ZW0uR2V0TWF4KCkKICAgIH0KICAgIFNldE1heChhKSB7CiAgICAgICAgdGhpcy5fcHJvcGVydHlUcmFja0RhdGFJdGVtLlNldE1heChhKQogICAgfQogICAgR2V0RW5hYmxlKCkgewogICAgICAgIHJldHVybiB0aGlzLl9wcm9wZXJ0eVRyYWNrRGF0YUl0ZW0uR2V0RW5hYmxlKCkKICAgIH0KICAgIFNldEVuYWJsZShhKSB7CiAgICAgICAgdGhpcy5fcHJvcGVydHlUcmFja0RhdGFJdGVtLlNldEVuYWJsZShhKQogICAgfQogICAgR2V0SW50ZXJwb2xhdGlvbk1vZGUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3Byb3BlcnR5VHJhY2tEYXRhSXRlbS5HZXRJbnRlcnBvbGF0aW9uTW9kZSgpCiAgICB9CiAgICBTZXRJbnRlcnBvbGF0aW9uTW9kZShhKSB7CiAgICAgICAgdGhpcy5fcHJvcGVydHlUcmFja0RhdGFJdGVtLlNldEludGVycG9sYXRpb25Nb2RlKGEpCiAgICB9CiAgICBHZXRSZXN1bHRNb2RlKCkgewogICAgICAgIHJldHVybiB0aGlzLl9wcm9wZXJ0eVRyYWNrRGF0YUl0ZW0uR2V0UmVzdWx0TW9kZSgpCiAgICB9CiAgICBTZXRSZXN1bHRNb2RlKGEpIHsKICAgICAgICB0aGlzLl9wcm9wZXJ0eVRyYWNrRGF0YUl0ZW0uU2V0UmVzdWx0TW9kZShhKQogICAgfQogICAgU2V0RWFzZShhKSB7CiAgICAgICAgZm9yIChjb25zdCBiIG9mIHRoaXMuR2V0UHJvcGVydHlLZXlmcmFtZURhdGFJdGVtcygpKSBiLlNldEVhc2UoYSkKICAgIH0KICAgIENhbkhhdmVQcm9wZXJ0eUtleWZyYW1lcygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcHJvcGVydHlUcmFja0RhdGFJdGVtLkNhbkhhdmVQcm9wZXJ0eUtleWZyYW1lcygpCiAgICB9CiAgICBHZXRQcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW1zKCkgewogICAgICAgIHJldHVybiB0aGlzLl9wcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW1zID8KICAgICAgICAgICAgdGhpcy5fcHJvcGVydHlLZXlmcmFtZURhdGFJdGVtcyA6IHRoaXMuX3Byb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbXMgPSB0aGlzLl9wcm9wZXJ0eVRyYWNrRGF0YUl0ZW0uR2V0UHJvcGVydHlLZXlmcmFtZURhdGEoKS5HZXRQcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW1BcnJheSgpCiAgICB9KiBHZXRQcm9wZXJ0eUtleWZyYW1lVmFsdWVzKCkgewogICAgICAgIGZvciAoY29uc3QgYSBvZiB0aGlzLkdldFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbXMoKSkgeWllbGQgYS5HZXRWYWx1ZVdpdGhSZXN1bHRNb2RlKCkKICAgIH0KICAgIFRpbWVsaW5lUmVtb3ZlZCgpIHsKICAgICAgICB0aGlzLkdldFNvdXJjZUFkYXB0ZXIoKS5UaW1lbGluZVJlbW92ZWQoKQogICAgfQogICAgQ2xlYW5DYWNoZXMoKSB7CiAgICAgICAgdGhpcy5HZXRTb3VyY2VBZGFwdGVyKCkuQ2xlYW5DYWNoZXMoKQogICAgfQogICAgR2V0Q3VycmVudFN0YXRlKCkgewogICAgICAgIHJldHVybiB0aGlzLkdldFNvdXJjZUFkYXB0ZXIoKS5HZXRDdXJyZW50U3RhdGUoKQogICAgfQogICAgU2V0UmVzZXRTdGF0ZSgpIHsKICAgICAgICB0aGlzLkdldFNvdXJjZUFkYXB0ZXIoKS5TZXRSZXNldFN0YXRlKCkKICAgIH0KICAgIFNldEluaXRpYWxTdGF0ZShhKSB7CiAgICAgICAgdGhpcy5HZXRTb3VyY2VBZGFwdGVyKCkuU2V0SW5pdGlhbFN0YXRlKCk7CiAgICAgICAgdGhpcy5fbGFzdFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbSA9IHRoaXMuX0dldExhc3RQcm9wZXJ0eUtleUZyYW1lQmVmb3JlVGltZShhKTsKICAgICAgICB0aGlzLl9TZXRVcGRhdGVTdGF0ZSgpCiAgICB9CiAgICBTZXRSZXN1bWVTdGF0ZShhKSB7CiAgICAgICAgdGhpcy5HZXRTb3VyY2VBZGFwdGVyKCkuU2V0UmVzdW1lU3RhdGUoKTsKICAgICAgICB0aGlzLl9sYXN0UHJvcGVydHlLZXlmcmFtZURhdGFJdGVtID0gdGhpcy5fR2V0TGFzdFByb3BlcnR5S2V5RnJhbWVCZWZvcmVUaW1lKGEpCiAgICB9CiAgICBfU2V0VXBkYXRlU3RhdGUoKSB7CiAgICAgICAgdmFyIGEgPSB0aGlzLkdldFRyYWNrKCk7CiAgICAgICAgdGhpcy5fbmVlZHNCZWZvcmVBbmRBZnRlciA9IDA7CiAgICAgICAgaWYgKGEuSXNJbnN0YW5jZVRyYWNrKCkpIHsKICAgICAgICAgICAgdmFyIGIgPSB0aGlzLkdldFRpbWVsaW5lKCk7CiAgICAgICAgICAgIGEgPSBhLkdldEluc3RhbmNlKCk7CiAgICAgICAgICAgIGNvbnN0IGQgPSB0aGlzLkdldFNvdXJjZUFkYXB0ZXIoKSwKICAgICAgICAgICAgICAgIGMgPSB0aGlzLkdldFByb3BlcnR5TmFtZSgpOwogICAgICAgICAgICBkLk1heU5lZWRCZWZvcmVBbmRBZnRlckludGVycG9sYXRlKCkgPyAoYiA9IGIuR2V0U2ltaWxhclByb3BlcnR5VHJhY2tzKGEsIGQsCiAgICAgICAgICAgICAgICBjKSkgJiYgYi5sZW5ndGggJiYgKHRoaXMuX25lZWRzQmVmb3JlQW5kQWZ0ZXIgPSAxKSA6IHRoaXMuX25lZWRzQmVmb3JlQW5kQWZ0ZXIgPSAwCiAgICAgICAgfQogICAgfQogICAgX0dldExhc3RQcm9wZXJ0eUtleUZyYW1lQmVmb3JlVGltZShhKSB7CiAgICAgICAgY29uc3QgYiA9IHRoaXMuR2V0VGltZWxpbmUoKSwKICAgICAgICAgICAgZCA9IHRoaXMuX3Byb3BlcnR5VHJhY2tEYXRhLkdldFByb3BlcnR5S2V5RnJhbWVEYXRhSXRlbUF0VGltZShhLCB0aGlzLl9wcm9wZXJ0eVRyYWNrRGF0YUl0ZW0pOwogICAgICAgIHJldHVybiBkID8gZCA6IGIuSXNGb3J3YXJkUGxheUJhY2soKSA/IHRoaXMuX3Byb3BlcnR5VHJhY2tEYXRhLkdldEZpcnN0UHJvcGVydHlLZXlGcmFtZURhdGFJdGVtTG93ZXJPckVxdWFsVGhhbihhLCB0aGlzLl9wcm9wZXJ0eVRyYWNrRGF0YUl0ZW0pIDogdGhpcy5fcHJvcGVydHlUcmFja0RhdGEuR2V0Rmlyc3RQcm9wZXJ0eUtleUZyYW1lRGF0YUl0ZW1IaWdoZXJPckVxdWFsVGhhbihhLCB0aGlzLl9wcm9wZXJ0eVRyYWNrRGF0YUl0ZW0pCiAgICB9CiAgICBCZWZvcmVJbnRlcnBvbGF0ZSgpIHsKICAgICAgICB0aGlzLl9zb3VyY2VBZGFwdGVyLkJlZm9yZUludGVycG9sYXRlKCkKICAgIH0KICAgIEludGVycG9sYXRlKGEsCiAgICAgICAgYiA9ICExLCBkID0gITEpIHsKICAgICAgICBsZXQgYzsKICAgICAgICBpZiAoYikgdmFyIGUgPSB0aGlzLl9wcm9wZXJ0eVRyYWNrRGF0YS5HZXRGaXJzdFByb3BlcnR5S2V5RnJhbWVEYXRhSXRlbUxvd2VyT3JFcXVhbFRoYW4oYSwgdGhpcy5fcHJvcGVydHlUcmFja0RhdGFJdGVtKTsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgaWYgKHRoaXMuX2xhc3RQcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW0pIHsKICAgICAgICAgICAgICAgIHZhciBnID0gdGhpcy5HZXRUaW1lbGluZSgpOwogICAgICAgICAgICAgICAgY29uc3QgayA9IHRoaXMuX2xhc3RQcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW0uR2V0TmV4dCgpOwogICAgICAgICAgICAgICAgZSA9IHRoaXMuX2xhc3RQcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW0uR2V0VGltZSgpOwogICAgICAgICAgICAgICAgZyA9IGsgPyBrLkdldFRpbWUoKSA6IGcuR2V0VG90YWxUaW1lKCk7CiAgICAgICAgICAgICAgICBpZiAoYSA8PSBlIHx8IGEgPj0gZykgdGhpcy5fbGFzdFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbSA9IHRoaXMuX3Byb3BlcnR5VHJhY2tEYXRhLkdldEZpcnN0UHJvcGVydHlLZXlGcmFtZURhdGFJdGVtTG93ZXJPckVxdWFsVGhhbihhLCB0aGlzLl9wcm9wZXJ0eVRyYWNrRGF0YUl0ZW0pCiAgICAgICAgICAgIH0gZWxzZSB0aGlzLl9sYXN0UHJvcGVydHlLZXlmcmFtZURhdGFJdGVtID0KICAgICAgICAgICAgICAgIHRoaXMuX3Byb3BlcnR5VHJhY2tEYXRhLkdldEZpcnN0UHJvcGVydHlLZXlGcmFtZURhdGFJdGVtTG93ZXJPckVxdWFsVGhhbihhLCB0aGlzLl9wcm9wZXJ0eVRyYWNrRGF0YUl0ZW0pOwogICAgICAgICAgICBlID0gdGhpcy5fbGFzdFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbQogICAgICAgIH0KICAgICAgICBlICYmIChjID0gZS5HZXROZXh0KCkpOwogICAgICAgIHRoaXMuX3NvdXJjZUFkYXB0ZXIuSW50ZXJwb2xhdGUoYSwgZSwgYywgYiwgZCkKICAgIH0KICAgIEdldEludGVycG9sYXRlZFZhbHVlKGEpIHsKICAgICAgICBpZiAodGhpcy5fbGFzdFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbSkgewogICAgICAgICAgICB2YXIgYiA9IHRoaXMuR2V0VGltZWxpbmUoKTsKICAgICAgICAgICAgY29uc3QgYyA9IHRoaXMuX2xhc3RQcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW0uR2V0TmV4dCgpOwogICAgICAgICAgICB2YXIgZCA9IHRoaXMuX2xhc3RQcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW0uR2V0VGltZSgpOwogICAgICAgICAgICBiID0gYyA/IGMuR2V0VGltZSgpIDogYi5HZXRUb3RhbFRpbWUoKTsKICAgICAgICAgICAgaWYgKGEgPD0gZCB8fCBhID49IGIpIHRoaXMuX2xhc3RQcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW0gPSB0aGlzLl9wcm9wZXJ0eVRyYWNrRGF0YS5HZXRGaXJzdFByb3BlcnR5S2V5RnJhbWVEYXRhSXRlbUxvd2VyT3JFcXVhbFRoYW4oYSwKICAgICAgICAgICAgICAgIHRoaXMuX3Byb3BlcnR5VHJhY2tEYXRhSXRlbSkKICAgICAgICB9IGVsc2UgdGhpcy5fbGFzdFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbSA9IHRoaXMuX3Byb3BlcnR5VHJhY2tEYXRhLkdldEZpcnN0UHJvcGVydHlLZXlGcmFtZURhdGFJdGVtTG93ZXJPckVxdWFsVGhhbihhLCB0aGlzLl9wcm9wZXJ0eVRyYWNrRGF0YUl0ZW0pOwogICAgICAgIGQgPSB0aGlzLl9sYXN0UHJvcGVydHlLZXlmcmFtZURhdGFJdGVtOwogICAgICAgIGIgPSBkLkdldE5leHQoKTsKICAgICAgICByZXR1cm4gdGhpcy5fc291cmNlQWRhcHRlci5HZXRJbnRlcnBvbGF0ZWRWYWx1ZShhLCBkLCBiKQogICAgfQogICAgQWZ0ZXJJbnRlcnBvbGF0ZSgpIHsKICAgICAgICB0aGlzLl9zb3VyY2VBZGFwdGVyLkFmdGVySW50ZXJwb2xhdGUoKQogICAgfQogICAgc3RhdGljIEdldFN0YXJ0UHJvcGVydHlLZXlmcmFtZUZvclRpbWUoYSwgYikgewogICAgICAgIGNvbnN0IGQgPSBiLkdldFByb3BlcnR5VHJhY2tEYXRhSXRlbSgpOwogICAgICAgIHJldHVybiBiLl9wcm9wZXJ0eVRyYWNrRGF0YS5HZXRGaXJzdFByb3BlcnR5S2V5RnJhbWVEYXRhSXRlbUxvd2VyT3JFcXVhbFRoYW4oYSwgZCkKICAgIH0KICAgIHN0YXRpYyBHZXRFbmRQcm9wZXJ0eUtleWZyYW1lRm9yVGltZShhLAogICAgICAgIGIpIHsKICAgICAgICBjb25zdCBkID0gYi5HZXRQcm9wZXJ0eVRyYWNrRGF0YUl0ZW0oKTsKICAgICAgICByZXR1cm4gYi5fcHJvcGVydHlUcmFja0RhdGEuR2V0Rmlyc3RQcm9wZXJ0eUtleUZyYW1lRGF0YUl0ZW1IaWdoZXJPckVxdWFsVGhhbihhLCBkKQogICAgfQogICAgQWRkUHJvcGVydHlLZXlmcmFtZSgpIHsKICAgICAgICBjb25zdCBhID0gdGhpcy5fcHJvcGVydHlUcmFja0RhdGFJdGVtLkdldFByb3BlcnR5S2V5ZnJhbWVEYXRhKCkuQWRkRW1wdHlQcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW0oKTsKICAgICAgICB0aGlzLl9sYXN0UHJvcGVydHlLZXlmcmFtZURhdGFJdGVtID0gbnVsbDsKICAgICAgICByZXR1cm4gYQogICAgfQogICAgRGVsZXRlUHJvcGVydHlLZXlmcmFtZXMoYSkgewogICAgICAgIHRoaXMuX2xhc3RQcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW0gPSBudWxsOwogICAgICAgIHRoaXMuX3Byb3BlcnR5VHJhY2tEYXRhSXRlbS5HZXRQcm9wZXJ0eUtleWZyYW1lRGF0YSgpLkRlbGV0ZVByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbXMoYSkKICAgIH0KICAgIFNhdmVTdGF0ZSgpIHsKICAgICAgICB0aGlzLkdldFNvdXJjZUFkYXB0ZXIoKS5TYXZlU3RhdGUoKQogICAgfQogICAgQ29tcGFyZUluaXRpYWxTdGF0ZVdpdGhDdXJyZW50KCkgewogICAgICAgIGlmICh0aGlzLkdldFNvdXJjZUFkYXB0ZXIoKS5Db21wYXJlSW5pdGlhbFN0YXRlV2l0aEN1cnJlbnQoKSkgewogICAgICAgICAgICBjb25zdCBhID0KICAgICAgICAgICAgICAgIHRoaXMuX3Byb3BlcnR5VHJhY2tEYXRhLkdldEZpcnN0UHJvcGVydHlLZXlmcmFtZURhdGFJdGVtKHRoaXMuX3Byb3BlcnR5VHJhY2tEYXRhSXRlbSksCiAgICAgICAgICAgICAgICBiID0gdGhpcy5HZXRTb3VyY2VBZGFwdGVyKCkuR2V0Q3VycmVudFN0YXRlKCk7CiAgICAgICAgICAgIGEuU2V0QWJzb2x1dGVWYWx1ZShiKQogICAgICAgIH0KICAgIH0KICAgIENvbXBhcmVTYXZlU3RhdGVXaXRoQ3VycmVudCgpIHsKICAgICAgICBjb25zdCBhID0gdGhpcy5HZXRTb3VyY2VBZGFwdGVyKCkuQ29tcGFyZVNhdmVTdGF0ZVdpdGhDdXJyZW50KCk7CiAgICAgICAgYSAmJiB0aGlzLkFkZFByb3BlcnR5S2V5ZnJhbWVBdEN1cnJlbnRUaW1lKCk7CiAgICAgICAgdGhpcy5HZXRTb3VyY2VBZGFwdGVyKCkuQ2xlYXJTYXZlU3RhdGUoKTsKICAgICAgICByZXR1cm4gYQogICAgfQogICAgQWRkUHJvcGVydHlLZXlmcmFtZUF0Q3VycmVudFRpbWUoKSB7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuR2V0VGltZWxpbmUoKS5HZXRUaW1lKCksCiAgICAgICAgICAgIGIgPSB0aGlzLkdldFNvdXJjZUFkYXB0ZXIoKSwKICAgICAgICAgICAgZCA9IEMzJGpzY29tcCQ4Ni5Qcm9wZXJ0eVRyYWNrU3RhdGUuR2V0U3RhcnRQcm9wZXJ0eUtleWZyYW1lRm9yVGltZShhLAogICAgICAgICAgICAgICAgdGhpcyksCiAgICAgICAgICAgIGMgPSB0aGlzLkFkZFByb3BlcnR5S2V5ZnJhbWUoKTsKICAgICAgICBjLlNldFR5cGUoZC5HZXRUeXBlKCkpOwogICAgICAgIGMuU2V0VGltZShhKTsKICAgICAgICBjLlNldEVhc2UoZC5HZXRFYXNlKCkpOwogICAgICAgIGMuU2V0RW5hYmxlKCEwKTsKICAgICAgICBjLlNldFZhbHVlKGIuR2V0VmFsdWVBdFRpbWUoKSk7CiAgICAgICAgYy5TZXRBYnNvbHV0ZVZhbHVlKGIuR2V0Q3VycmVudFN0YXRlKCkpCiAgICB9CiAgICBfU2F2ZVRvSnNvbigpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBzb3VyY2VBZGFwdGVySnNvbjogdGhpcy5HZXRTb3VyY2VBZGFwdGVyKCkuX1NhdmVUb0pzb24oKQogICAgICAgIH0KICAgIH0KICAgIF9Mb2FkRnJvbUpzb24oYSkgewogICAgICAgIGEgJiYgdGhpcy5HZXRTb3VyY2VBZGFwdGVyKCkuX0xvYWRGcm9tSnNvbihhLnNvdXJjZUFkYXB0ZXJKc29uKQogICAgfQp9OwoidXNlIHN0cmljdCI7CmNvbnN0IE5TID0gc2VsZi5DMy5Qcm9wZXJ0eVRyYWNrU3RhdGU7Ck5TLlByb3BlcnR5U291cmNlQWRhcHRlciA9IGNsYXNzIHsKICAgIGNvbnN0cnVjdG9yKGEpIHsKICAgICAgICB0aGlzLl9wcm9wZXJ0eVRyYWNrID0gYTsKICAgICAgICB0aGlzLl9wcm9wZXJ0eUFkYXB0ZXIgPSBudWxsOwogICAgICAgIHRoaXMuR2V0UHJvcGVydHlBZGFwdGVyKCkKICAgIH0KICAgIFJlbGVhc2UoKSB7CiAgICAgICAgdGhpcy5fcHJvcGVydHlBZGFwdGVyICYmICh0aGlzLl9wcm9wZXJ0eUFkYXB0ZXIuUmVsZWFzZSgpLCB0aGlzLl9wcm9wZXJ0eUFkYXB0ZXIgPSBudWxsKTsKICAgICAgICB0aGlzLl9wcm9wZXJ0eVRyYWNrID0gbnVsbAogICAgfQogICAgTWF5TmVlZEJlZm9yZUFuZEFmdGVySW50ZXJwb2xhdGUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3Byb3BlcnR5QWRhcHRlci5NYXlOZWVkQmVmb3JlQW5kQWZ0ZXJJbnRlcnBvbGF0ZSgpCiAgICB9CiAgICBHZXRQcm9wZXJ0eVRyYWNrKCkgewogICAgICAgIHJldHVybiB0aGlzLl9wcm9wZXJ0eVRyYWNrCiAgICB9CiAgICBUaW1lbGluZVJlbW92ZWQoKSB7CiAgICAgICAgdGhpcy5fcHJvcGVydHlBZGFwdGVyICYmIHRoaXMuX3Byb3BlcnR5QWRhcHRlci5UaW1lbGluZVJlbW92ZWQoKQogICAgfQogICAgQ2xlYW5DYWNoZXMoKSB7CiAgICAgICAgdGhpcy5fcHJvcGVydHlBZGFwdGVyICYmCiAgICAgICAgICAgIHRoaXMuX3Byb3BlcnR5QWRhcHRlci5DbGVhbkNhY2hlcygpCiAgICB9CiAgICBHZXRQcm9wZXJ0eUFkYXB0ZXIoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3Byb3BlcnR5QWRhcHRlciA/IHRoaXMuX3Byb3BlcnR5QWRhcHRlciA6IHRoaXMuX3Byb3BlcnR5QWRhcHRlciA9IHRoaXMuX0NyZWF0ZVByb3BlcnR5QWRhcHRlcigpCiAgICB9CiAgICBHZXRFZGl0b3JJbmRleCgpIHt9CiAgICBHZXRJbmRleCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5HZXRFZGl0b3JJbmRleCgpCiAgICB9CiAgICBHZXRUYXJnZXQoKSB7fQogICAgU2V0UmVzZXRTdGF0ZSgpIHsKICAgICAgICB0aGlzLkdldFByb3BlcnR5QWRhcHRlcigpLlNldFJlc2V0U3RhdGUoKQogICAgfQogICAgU2V0SW5pdGlhbFN0YXRlKCkgewogICAgICAgIHRoaXMuR2V0UHJvcGVydHlBZGFwdGVyKCkuU2V0SW5pdGlhbFN0YXRlKCkKICAgIH0KICAgIFNldFJlc3VtZVN0YXRlKCkgewogICAgICAgIHRoaXMuR2V0UHJvcGVydHlBZGFwdGVyKCkuU2V0UmVzdW1lU3RhdGUoKQogICAgfQogICAgQmVmb3JlSW50ZXJwb2xhdGUoKSB7CiAgICAgICAgdGhpcy5fcHJvcGVydHlBZGFwdGVyLkJlZm9yZUNoYW5nZVByb3BlcnR5KCkKICAgIH0KICAgIEludGVycG9sYXRlKGEsIGIsIGQsIGMsIGUpIHsKICAgICAgICBsZXQgZzsKICAgICAgICBzd2l0Y2ggKHRoaXMuX3Byb3BlcnR5VHJhY2suR2V0UHJvcGVydHlLZXlmcmFtZVR5cGUoKSkgewogICAgICAgICAgICBjYXNlICJudW1lcmljIjoKICAgICAgICAgICAgICAgIGcgPSBOUy5OdW1lcmljVHlwZUFkYXB0ZXIuSW50ZXJwb2xhdGUoYSwgYiwgZCwgdGhpcy5fcHJvcGVydHlUcmFjayk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAiYW5nbGUiOgogICAgICAgICAgICAgICAgZyA9IE5TLkFuZ2xlVHlwZUFkYXB0ZXIuSW50ZXJwb2xhdGUoYSwgYiwgZCwgdGhpcy5fcHJvcGVydHlUcmFjayk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAiYm9vbGVhbiI6CiAgICAgICAgICAgICAgICBnID0gTlMuQm9vbGVhblR5cGVBZGFwdGVyLkludGVycG9sYXRlKGEsIGIsIGQsIHRoaXMuX3Byb3BlcnR5VHJhY2spOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgImNvbG9yIjoKICAgICAgICAgICAgICAgIGcgPSBOUy5Db2xvclR5cGVBZGFwdGVyLkludGVycG9sYXRlKGEsIGIsIGQsIHRoaXMuX3Byb3BlcnR5VHJhY2spOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgInRleHQiOgogICAgICAgICAgICAgICAgZyA9IE5TLlRleHRUeXBlQWRhcHRlci5JbnRlcnBvbGF0ZShhLCBiLCBkLCB0aGlzLl9wcm9wZXJ0eVRyYWNrKQogICAgICAgIH0KICAgICAgICB0aGlzLl9wcm9wZXJ0eUFkYXB0ZXIuQ2hhbmdlUHJvcGVydHkoYSwgZywgYiwgZCwgYywKICAgICAgICAgICAgZSkKICAgIH0KICAgIEdldEludGVycG9sYXRlZFZhbHVlKGEsIGIsIGQpIHsKICAgICAgICBzd2l0Y2ggKHRoaXMuX3Byb3BlcnR5VHJhY2suR2V0UHJvcGVydHlLZXlmcmFtZVR5cGUoKSkgewogICAgICAgICAgICBjYXNlICJudW1lcmljIjoKICAgICAgICAgICAgICAgIHJldHVybiBOUy5OdW1lcmljVHlwZUFkYXB0ZXIuSW50ZXJwb2xhdGUoYSwgYiwgZCwgdGhpcy5fcHJvcGVydHlUcmFjayk7CiAgICAgICAgICAgIGNhc2UgImFuZ2xlIjoKICAgICAgICAgICAgICAgIHJldHVybiBOUy5BbmdsZVR5cGVBZGFwdGVyLkludGVycG9sYXRlKGEsIGIsIGQsIHRoaXMuX3Byb3BlcnR5VHJhY2spOwogICAgICAgICAgICBjYXNlICJib29sZWFuIjoKICAgICAgICAgICAgICAgIHJldHVybiBOUy5Cb29sZWFuVHlwZUFkYXB0ZXIuSW50ZXJwb2xhdGUoYSwgYiwgZCwgdGhpcy5fcHJvcGVydHlUcmFjayk7CiAgICAgICAgICAgIGNhc2UgImNvbG9yIjoKICAgICAgICAgICAgICAgIHJldHVybiBOUy5Db2xvclR5cGVBZGFwdGVyLkludGVycG9sYXRlKGEsIGIsIGQsIHRoaXMuX3Byb3BlcnR5VHJhY2spOwogICAgICAgICAgICBjYXNlICJ0ZXh0IjoKICAgICAgICAgICAgICAgIHJldHVybiBOUy5UZXh0VHlwZUFkYXB0ZXIuSW50ZXJwb2xhdGUoYSwgYiwgZCwgdGhpcy5fcHJvcGVydHlUcmFjaykKICAgICAgICB9CiAgICB9CiAgICBBZnRlckludGVycG9sYXRlKCkgewogICAgICAgIHRoaXMuX3Byb3BlcnR5QWRhcHRlci5BZnRlckNoYW5nZVByb3BlcnR5KCkKICAgIH0KICAgIFNhdmVTdGF0ZSgpIHsKICAgICAgICB0aGlzLkdldFByb3BlcnR5QWRhcHRlcigpLlNldFNhdmVTdGF0ZSgpCiAgICB9CiAgICBDbGVhclNhdmVTdGF0ZSgpIHsKICAgICAgICB0aGlzLkdldFByb3BlcnR5QWRhcHRlcigpLkNsZWFyU2F2ZVN0YXRlKCkKICAgIH0KICAgIEdldEN1cnJlbnRTdGF0ZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5HZXRQcm9wZXJ0eUFkYXB0ZXIoKS5HZXRDdXJyZW50U3RhdGUoKQogICAgfQogICAgQ29tcGFyZUluaXRpYWxTdGF0ZVdpdGhDdXJyZW50KCkgewogICAgICAgIHJldHVybiB0aGlzLkdldFByb3BlcnR5QWRhcHRlcigpLkNvbXBhcmVJbml0aWFsU3RhdGVXaXRoQ3VycmVudCgpCiAgICB9CiAgICBDb21wYXJlU2F2ZVN0YXRlV2l0aEN1cnJlbnQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuR2V0UHJvcGVydHlBZGFwdGVyKCkuQ29tcGFyZVNhdmVTdGF0ZVdpdGhDdXJyZW50KCkKICAgIH0KICAgIEdldFZhbHVlQXRUaW1lKCkgewogICAgICAgIGNvbnN0IGEgPQogICAgICAgICAgICB0aGlzLl9wcm9wZXJ0eVRyYWNrLAogICAgICAgICAgICBiID0gYS5HZXRUcmFjaygpLkdldFRpbWVsaW5lKCkuR2V0VGltZSgpLAogICAgICAgICAgICBkID0gTlMuR2V0U3RhcnRQcm9wZXJ0eUtleWZyYW1lRm9yVGltZShiLCBhKSwKICAgICAgICAgICAgYyA9IGQuR2V0TmV4dCgpOwogICAgICAgIHN3aXRjaCAoYS5HZXRQcm9wZXJ0eUtleWZyYW1lVHlwZSgpKSB7CiAgICAgICAgICAgIGNhc2UgIm51bWVyaWMiOgogICAgICAgICAgICAgICAgcmV0dXJuIE5TLk51bWVyaWNUeXBlQWRhcHRlci5JbnRlcnBvbGF0ZShiLCBkLCBjLCBhKTsKICAgICAgICAgICAgY2FzZSAiYW5nbGUiOgogICAgICAgICAgICAgICAgcmV0dXJuIE5TLkFuZ2xlVHlwZUFkYXB0ZXIuSW50ZXJwb2xhdGUoYiwgZCwgYywgYSk7CiAgICAgICAgICAgIGNhc2UgImJvb2xlYW4iOgogICAgICAgICAgICAgICAgcmV0dXJuIE5TLkJvb2xlYW5UeXBlQWRhcHRlci5JbnRlcnBvbGF0ZShiLCBkLCBjLCBhKTsKICAgICAgICAgICAgY2FzZSAiY29sb3IiOgogICAgICAgICAgICAgICAgcmV0dXJuIE5TLkNvbG9yVHlwZUFkYXB0ZXIuSW50ZXJwb2xhdGUoYiwgZCwgYywgYSk7CiAgICAgICAgICAgIGNhc2UgInRleHQiOgogICAgICAgICAgICAgICAgcmV0dXJuIE5TLlRleHRUeXBlQWRhcHRlci5JbnRlcnBvbGF0ZShiLCBkLCBjLCBhKQogICAgICAgIH0KICAgIH0KICAgIF9DcmVhdGVQcm9wZXJ0eUFkYXB0ZXIoKSB7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuX3Byb3BlcnR5VHJhY2s7CiAgICAgICAgc3dpdGNoIChhLkNhbkhhdmVQcm9wZXJ0eUtleWZyYW1lcygpID8gYS5HZXRQcm9wZXJ0eUtleWZyYW1lVHlwZSgpIDogIiIpIHsKICAgICAgICAgICAgY2FzZSAiY29tYm8iOgogICAgICAgICAgICBjYXNlICJib29sZWFuIjoKICAgICAgICAgICAgY2FzZSAidGV4dCI6CiAgICAgICAgICAgIGNhc2UgInN0cmluZyI6CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IE5TLlByb3BlcnR5SW50ZXJwb2xhdGlvbkFkYXB0ZXIuTm9JbnRlcnBvbGF0aW9uQWRhcHRlcih0aGlzKTsKICAgICAgICAgICAgY2FzZSAibnVtZXJpYyI6CiAgICAgICAgICAgIGNhc2UgIm51bWJlciI6CiAgICAgICAgICAgIGNhc2UgImFuZ2xlIjoKICAgICAgICAgICAgICAgIHJldHVybiAiY29tYm8iID09PSB0aGlzLl9wcm9wZXJ0eVRyYWNrLkdldFByb3BlcnR5VHlwZSgpID8gbmV3IE5TLlByb3BlcnR5SW50ZXJwb2xhdGlvbkFkYXB0ZXIuTm9JbnRlcnBvbGF0aW9uQWRhcHRlcih0aGlzKSA6IG5ldyBOUy5Qcm9wZXJ0eUludGVycG9sYXRpb25BZGFwdGVyLk51bWVyaWNJbnRlcnBvbGF0aW9uQWRhcHRlcih0aGlzKTsKICAgICAgICAgICAgY2FzZSAiY29sb3IiOgogICAgICAgICAgICBjYXNlICJvZmZzZXRDb2xvciI6CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IE5TLlByb3BlcnR5SW50ZXJwb2xhdGlvbkFkYXB0ZXIuQ29sb3JJbnRlcnBvbGF0aW9uQWRhcHRlcih0aGlzKTsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgTlMuUHJvcGVydHlJbnRlcnBvbGF0aW9uQWRhcHRlci5OdW1lcmljSW50ZXJwb2xhdGlvbkFkYXB0ZXIodGhpcykKICAgICAgICB9CiAgICB9CiAgICBfU2F2ZVRvSnNvbigpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBwcm9wZXJ0eUFkYXB0ZXJKc29uOiB0aGlzLkdldFByb3BlcnR5QWRhcHRlcigpLl9TYXZlVG9Kc29uKCkKICAgICAgICB9CiAgICB9CiAgICBfTG9hZEZyb21Kc29uKGEpIHsKICAgICAgICBhICYmIHRoaXMuR2V0UHJvcGVydHlBZGFwdGVyKCkuX0xvYWRGcm9tSnNvbihhLnByb3BlcnR5QWRhcHRlckpzb24pCiAgICB9Cn07CiJ1c2Ugc3RyaWN0IjsKY29uc3QgQzMkanNjb21wJDg4ID0gc2VsZi5DMywKICAgIElOREVYID0gMDsKY2xhc3MgSW5zdGFuY2VWYXJpYWJsZVNvdXJjZUFkYXB0ZXIgZXh0ZW5kcyBDMyRqc2NvbXAkODguUHJvcGVydHlUcmFja1N0YXRlLlByb3BlcnR5U291cmNlQWRhcHRlciB7CiAgICBjb25zdHJ1Y3RvcihhKSB7CiAgICAgICAgc3VwZXIoYSk7CiAgICAgICAgdGhpcy5fdXBkYXRlZEluZGV4ID0gTmFOCiAgICB9CiAgICBHZXRFZGl0b3JJbmRleCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcHJvcGVydHlUcmFjay5HZXRQcm9wZXJ0eVRyYWNrRGF0YUl0ZW0oKS5HZXRTb3VyY2VBZGFwdGVyQXJndW1lbnRzKClbSU5ERVhdCiAgICB9CiAgICBHZXRJbmRleCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdXBkYXRlZEluZGV4ID8gdGhpcy5fdXBkYXRlZEluZGV4IDogc3VwZXIuR2V0SW5kZXgoKQogICAgfQogICAgR2V0VGFyZ2V0KCkgewogICAgICAgIHJldHVybiB0aGlzLl9wcm9wZXJ0eVRyYWNrLkdldFRyYWNrKCkuR2V0SW5zdGFuY2UoKQogICAgfQogICAgVXBkYXRlSW5zdGFuY2VWYXJpYWJsZUluZGV4KGEpIHsKICAgICAgICB0aGlzLl9wcm9wZXJ0eVRyYWNrLkdldFByb3BlcnR5VHJhY2tEYXRhSXRlbSgpLkdldFNvdXJjZUFkYXB0ZXJBcmd1bWVudHMoKVtJTkRFWF0gIT09CiAgICAgICAgICAgIGEgJiYgKHRoaXMuX3VwZGF0ZWRJbmRleCA9IGEpCiAgICB9CiAgICBJbnRlcnBvbGF0ZShhLCBiLCBkLCBjLCBlKSB7CiAgICAgICAgdGhpcy5HZXRQcm9wZXJ0eUFkYXB0ZXIoKS5DYW5DaGFuZ2UoYi5HZXRWYWx1ZSgpKSAmJiBzdXBlci5JbnRlcnBvbGF0ZShhLCBiLCBkLCBjLCBlKQogICAgfQogICAgR2V0SW50ZXJwb2xhdGVkVmFsdWUoYSwgYiwgZCkgewogICAgICAgIGlmICh0aGlzLkdldFByb3BlcnR5QWRhcHRlcigpLkNhbkNoYW5nZShiLkdldFZhbHVlKCkpKSByZXR1cm4gc3VwZXIuR2V0SW50ZXJwb2xhdGVkVmFsdWUoYSwgYiwgZCkKICAgIH0KICAgIF9TYXZlVG9Kc29uKCkgewogICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKHN1cGVyLl9TYXZlVG9Kc29uKCksIHsKICAgICAgICAgICAgaW5kZXg6IHRoaXMuX3VwZGF0ZWRJbmRleAogICAgICAgIH0pCiAgICB9CiAgICBfTG9hZEZyb21Kc29uKGEpIHsKICAgICAgICBhICYmIChzdXBlci5fTG9hZEZyb21Kc29uKGEpLCB0aGlzLl91cGRhdGVkSW5kZXggPSBhLmluZGV4KQogICAgfQp9CkMzJGpzY29tcCQ4OC5Qcm9wZXJ0eVRyYWNrU3RhdGUuSW5zdGFuY2VWYXJpYWJsZVNvdXJjZUFkYXB0ZXIgPSBJbnN0YW5jZVZhcmlhYmxlU291cmNlQWRhcHRlcjsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkODkgPSBzZWxmLkMzOwpjbGFzcyBCZWhhdmlvclNvdXJjZUFkYXB0ZXIgZXh0ZW5kcyBDMyRqc2NvbXAkODkuUHJvcGVydHlUcmFja1N0YXRlLlByb3BlcnR5U291cmNlQWRhcHRlciB7CiAgICBjb25zdHJ1Y3RvcihhKSB7CiAgICAgICAgc3VwZXIoYSk7CiAgICAgICAgdGhpcy5fc2lkID0gTmFOCiAgICB9CiAgICBHZXRFZGl0b3JJbmRleCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcHJvcGVydHlUcmFjay5HZXRQcm9wZXJ0eVRyYWNrRGF0YUl0ZW0oKS5HZXRTb3VyY2VBZGFwdGVyQXJndW1lbnRzKClbMV0KICAgIH0KICAgIEdldFRhcmdldCgpIHsKICAgICAgICB2YXIgYSA9IHRoaXMuX3Byb3BlcnR5VHJhY2suR2V0UHJvcGVydHlUcmFja0RhdGFJdGVtKCksCiAgICAgICAgICAgIGIgPSB0aGlzLl9wcm9wZXJ0eVRyYWNrLkdldFRyYWNrKCk7CiAgICAgICAgYSA9IHRoaXMuX3NpZCA/IHRoaXMuX3NpZCA6IGEuR2V0U291cmNlQWRhcHRlckFyZ3VtZW50cygpWzBdOwogICAgICAgIGIgPSBiLkdldEluc3RhbmNlKCk7CiAgICAgICAgYSA9IGIuR2V0QmVoYXZpb3JJbmRleEJ5U0lEKGEpOwogICAgICAgIHJldHVybiBiLkdldEJlaGF2aW9ySW5zdGFuY2VzKClbYV0uR2V0U2RrSW5zdGFuY2UoKQogICAgfQogICAgR2V0QmVoYXZpb3JUeXBlKGEpIHsKICAgICAgICBjb25zdCBiID0gdGhpcy5fcHJvcGVydHlUcmFjay5HZXRQcm9wZXJ0eVRyYWNrRGF0YUl0ZW0oKS5HZXRTb3VyY2VBZGFwdGVyQXJndW1lbnRzKClbMl07CiAgICAgICAgcmV0dXJuIGEuR2V0QmVoYXZpb3JUeXBlQnlOYW1lKGIpCiAgICB9CiAgICBVcGRhdGVCZWhhdmlvclR5cGVTaWQoYSkgewogICAgICAgIHRoaXMuX3Byb3BlcnR5VHJhY2suR2V0UHJvcGVydHlUcmFja0RhdGFJdGVtKCkuR2V0U291cmNlQWRhcHRlckFyZ3VtZW50cygpWzBdICE9PSBhICYmICh0aGlzLl9zaWQgPSBhKQogICAgfQogICAgSW50ZXJwb2xhdGUoYSwgYiwgZCwgYywgZSkgewogICAgICAgIGNvbnN0IGcgPSB0aGlzLl9wcm9wZXJ0eVRyYWNrLkdldFRyYWNrKCkuR2V0SW5zdGFuY2UoKTsKICAgICAgICB0aGlzLkdldEJlaGF2aW9yVHlwZShnLkdldE9iamVjdENsYXNzKCkpICYmIHN1cGVyLkludGVycG9sYXRlKGEsIGIsIGQsIGMsIGUpCiAgICB9CiAgICBHZXRJbnRlcnBvbGF0ZWRWYWx1ZShhLCBiLCBkKSB7CiAgICAgICAgY29uc3QgYyA9IHRoaXMuX3Byb3BlcnR5VHJhY2suR2V0VHJhY2soKS5HZXRJbnN0YW5jZSgpOwogICAgICAgIGlmICh0aGlzLkdldEJlaGF2aW9yVHlwZShjLkdldE9iamVjdENsYXNzKCkpKSByZXR1cm4gc3VwZXIuR2V0SW50ZXJwb2xhdGVkVmFsdWUoYSwgYiwgZCkKICAgIH0KICAgIF9TYXZlVG9Kc29uKCkgewogICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKHN1cGVyLl9TYXZlVG9Kc29uKCksIHsKICAgICAgICAgICAgc2lkOiB0aGlzLl9zaWQKICAgICAgICB9KQogICAgfQogICAgX0xvYWRGcm9tSnNvbihhKSB7CiAgICAgICAgYSAmJiAoc3VwZXIuX0xvYWRGcm9tSnNvbihhKSwgdGhpcy5fc2lkID0gYS5zaWQpCiAgICB9Cn0KQzMkanNjb21wJDg5LlByb3BlcnR5VHJhY2tTdGF0ZS5CZWhhdmlvclNvdXJjZUFkYXB0ZXIgPSBCZWhhdmlvclNvdXJjZUFkYXB0ZXI7CiJ1c2Ugc3RyaWN0IjsKY29uc3QgQzMkanNjb21wJDkwID0gc2VsZi5DMzsKY2xhc3MgRWZmZWN0U291cmNlQWRhcHRlciBleHRlbmRzIEMzJGpzY29tcCQ5MC5Qcm9wZXJ0eVRyYWNrU3RhdGUuUHJvcGVydHlTb3VyY2VBZGFwdGVyIHsKICAgIGNvbnN0cnVjdG9yKGEpIHsKICAgICAgICBzdXBlcihhKQogICAgfQogICAgR2V0RWRpdG9ySW5kZXgoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3Byb3BlcnR5VHJhY2suR2V0UHJvcGVydHlUcmFja0RhdGFJdGVtKCkuR2V0U291cmNlQWRhcHRlckFyZ3VtZW50cygpWzFdCiAgICB9CiAgICBHZXRUYXJnZXQoKSB7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuX3Byb3BlcnR5VHJhY2suR2V0VHJhY2soKS5HZXRXb3JsZEluZm8oKS5HZXRJbnN0YW5jZUVmZmVjdExpc3QoKTsKICAgICAgICB2YXIgYiA9IGEuR2V0RWZmZWN0TGlzdCgpOwogICAgICAgIGIgPSB0aGlzLkdldEVmZmVjdFR5cGUoYikuR2V0SW5kZXgoKTsKICAgICAgICByZXR1cm4gYS5Jc0VmZmVjdEluZGV4QWN0aXZlKGIpID8gYS5HZXRFZmZlY3RQYXJhbWV0ZXJzRm9ySW5kZXgoYikgOiBudWxsCiAgICB9CiAgICBHZXRFZmZlY3RUeXBlKGEpIHsKICAgICAgICBjb25zdCBiID0gdGhpcy5fcHJvcGVydHlUcmFjay5HZXRQcm9wZXJ0eVRyYWNrRGF0YUl0ZW0oKS5HZXRTb3VyY2VBZGFwdGVyQXJndW1lbnRzKClbMF07CiAgICAgICAgcmV0dXJuIGEuR2V0RWZmZWN0VHlwZUJ5TmFtZShiKQogICAgfQogICAgSW50ZXJwb2xhdGUoYSwgYiwgZCwgYywgZSkgewogICAgICAgIHRoaXMuX0lzRWZmZWN0QWN0aXZlKCkgJiYgc3VwZXIuSW50ZXJwb2xhdGUoYSwgYiwgZCwgYywgZSkKICAgIH0KICAgIEdldEludGVycG9sYXRlZFZhbHVlKGEsIGIsIGQpIHsKICAgICAgICBpZiAodGhpcy5fSXNFZmZlY3RBY3RpdmUoKSkgcmV0dXJuIHN1cGVyLkdldEludGVycG9sYXRlZFZhbHVlKGEsIGIsIGQpCiAgICB9CiAgICBfSXNFZmZlY3RBY3RpdmUoKSB7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuX3Byb3BlcnR5VHJhY2suR2V0VHJhY2soKS5HZXRXb3JsZEluZm8oKS5HZXRJbnN0YW5jZUVmZmVjdExpc3QoKTsKICAgICAgICB2YXIgYiA9IGEuR2V0RWZmZWN0TGlzdCgpOwogICAgICAgIGlmIChiID0gdGhpcy5HZXRFZmZlY3RUeXBlKGIpKSByZXR1cm4gYiA9IGIuR2V0SW5kZXgoKSwgYS5Jc0VmZmVjdEluZGV4QWN0aXZlKGIpCiAgICB9Cn0KQzMkanNjb21wJDkwLlByb3BlcnR5VHJhY2tTdGF0ZS5FZmZlY3RTb3VyY2VBZGFwdGVyID0gRWZmZWN0U291cmNlQWRhcHRlcjsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkOTEgPSBzZWxmLkMzOwpjbGFzcyBQbHVnaW5Tb3VyY2VBZGFwdGVyIGV4dGVuZHMgQzMkanNjb21wJDkxLlByb3BlcnR5VHJhY2tTdGF0ZS5Qcm9wZXJ0eVNvdXJjZUFkYXB0ZXIgewogICAgY29uc3RydWN0b3IoYSkgewogICAgICAgIHN1cGVyKGEpCiAgICB9CiAgICBHZXRFZGl0b3JJbmRleCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcHJvcGVydHlUcmFjay5HZXRQcm9wZXJ0eVRyYWNrRGF0YUl0ZW0oKS5HZXRTb3VyY2VBZGFwdGVyQXJndW1lbnRzKClbMF0KICAgIH0KICAgIEdldFRhcmdldCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcHJvcGVydHlUcmFjay5HZXRUcmFjaygpLkdldEluc3RhbmNlKCkuR2V0U2RrSW5zdGFuY2UoKQogICAgfQogICAgSW50ZXJwb2xhdGUoYSwgYiwgZCwgYywgZSkgewogICAgICAgIHZhciBnID0gdGhpcy5fcHJvcGVydHlUcmFjay5HZXRUcmFjaygpOwogICAgICAgIGNvbnN0IGsgPSBnLkdldE9iamVjdENsYXNzKCkuR2V0UGx1Z2luKCk7CiAgICAgICAgZyA9IGcuR2V0SW5zdGFuY2UoKS5HZXRPYmplY3RDbGFzcygpLkdldFBsdWdpbigpOwogICAgICAgIGsgPT09IGcgJiYgc3VwZXIuSW50ZXJwb2xhdGUoYSwgYiwgZCwgYywgZSkKICAgIH0KICAgIEdldEludGVycG9sYXRlZFZhbHVlKGEsIGIsCiAgICAgICAgZCkgewogICAgICAgIHZhciBjID0gdGhpcy5fcHJvcGVydHlUcmFjay5HZXRUcmFjaygpOwogICAgICAgIGNvbnN0IGUgPSBjLkdldE9iamVjdENsYXNzKCkuR2V0UGx1Z2luKCk7CiAgICAgICAgYyA9IGMuR2V0SW5zdGFuY2UoKS5HZXRPYmplY3RDbGFzcygpLkdldFBsdWdpbigpOwogICAgICAgIGlmIChlID09PSBjKSByZXR1cm4gc3VwZXIuR2V0SW50ZXJwb2xhdGVkVmFsdWUoYSwgYiwgZCkKICAgIH0KfQpDMyRqc2NvbXAkOTEuUHJvcGVydHlUcmFja1N0YXRlLlBsdWdpblNvdXJjZUFkYXB0ZXIgPSBQbHVnaW5Tb3VyY2VBZGFwdGVyOwoidXNlIHN0cmljdCI7CmNvbnN0IEMzJGpzY29tcCQ5MiA9IHNlbGYuQzM7CmNsYXNzIFZhbHVlU291cmNlQWRhcHRlciBleHRlbmRzIEMzJGpzY29tcCQ5Mi5Qcm9wZXJ0eVRyYWNrU3RhdGUuUHJvcGVydHlTb3VyY2VBZGFwdGVyIHsKICAgIGNvbnN0cnVjdG9yKGEpIHsKICAgICAgICBzdXBlcihhKTsKICAgICAgICB0aGlzLl92YWx1ZSA9IDA7CiAgICAgICAgdGhpcy5faW5pdCA9ICExCiAgICB9CiAgICBNYXlOZWVkQmVmb3JlQW5kQWZ0ZXJJbnRlcnBvbGF0ZSgpIHsKICAgICAgICByZXR1cm4gITEKICAgIH0KICAgIFNldEluaXRpYWxTdGF0ZSgpIHsKICAgICAgICBjb25zdCBhID0gdGhpcy5fcHJvcGVydHlUcmFjay5HZXRQcm9wZXJ0eVRyYWNrRGF0YSgpOwogICAgICAgIGxldCBiID0gdGhpcy5fcHJvcGVydHlUcmFjay5HZXRQcm9wZXJ0eVRyYWNrRGF0YUl0ZW0oKTsKICAgICAgICBiID0gYS5HZXRGaXJzdFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbShiKTsKICAgICAgICB0aGlzLl92YWx1ZSA9IGIuR2V0VmFsdWVXaXRoUmVzdWx0TW9kZSgpCiAgICB9CiAgICBTZXRSZXN1bWVTdGF0ZSgpIHt9CiAgICBHZXRWYWx1ZSgpIHsKICAgICAgICB0aGlzLl9pbml0IHx8IHRoaXMuX3Byb3BlcnR5VHJhY2suSW50ZXJwb2xhdGUoMCk7CiAgICAgICAgcmV0dXJuIHRoaXMuX3ZhbHVlCiAgICB9CiAgICBJbnRlcnBvbGF0ZShhLCBiLCBkLCBjLCBlKSB7CiAgICAgICAgdGhpcy5fdmFsdWUgPQogICAgICAgICAgICBDMyRqc2NvbXAkOTIuUHJvcGVydHlUcmFja1N0YXRlLk51bWVyaWNUeXBlQWRhcHRlci5JbnRlcnBvbGF0ZShhLCBiLCBkLCB0aGlzLl9wcm9wZXJ0eVRyYWNrKTsKICAgICAgICB0aGlzLl9pbml0ID0gITAKICAgIH0KICAgIFNhdmVTdGF0ZSgpIHt9CiAgICBDbGVhclNhdmVTdGF0ZSgpIHt9CiAgICBHZXRDdXJyZW50U3RhdGUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3ZhbHVlCiAgICB9CiAgICBDb21wYXJlSW5pdGlhbFN0YXRlV2l0aEN1cnJlbnQoKSB7CiAgICAgICAgcmV0dXJuICExCiAgICB9CiAgICBDb21wYXJlU2F2ZVN0YXRlV2l0aEN1cnJlbnQoKSB7CiAgICAgICAgcmV0dXJuICExCiAgICB9CiAgICBfU2F2ZVRvSnNvbigpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICB2YWx1ZTogdGhpcy5fdmFsdWUsCiAgICAgICAgICAgIGluaXQ6IHRoaXMuX2luaXQKICAgICAgICB9CiAgICB9CiAgICBfTG9hZEZyb21Kc29uKGEpIHsKICAgICAgICBhICYmICh0aGlzLl92YWx1ZSA9IGEudmFsdWUsIHRoaXMuX2luaXQgPSBhLmhhc093blByb3BlcnR5KCJpbml0IikgPyBhLmluaXQgOiAhMCkKICAgIH0KfQpDMyRqc2NvbXAkOTIuUHJvcGVydHlUcmFja1N0YXRlLlZhbHVlU291cmNlQWRhcHRlciA9IFZhbHVlU291cmNlQWRhcHRlcjsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkOTMgPSBzZWxmLkMzOwpjbGFzcyBBdWRpb1NvdXJjZUFkYXB0ZXIgZXh0ZW5kcyBDMyRqc2NvbXAkOTMuUHJvcGVydHlUcmFja1N0YXRlLlByb3BlcnR5U291cmNlQWRhcHRlciB7CiAgICBjb25zdHJ1Y3RvcihhKSB7CiAgICAgICAgc3VwZXIoYSk7CiAgICAgICAgdGhpcy5fYXVkaW9QbGF5YmFja1N0YXJ0ZWQgPSAhMTsKICAgICAgICB0aGlzLl9leHByZXNzaW9ucyA9IHRoaXMuX2FjdGlvbnMgPSB0aGlzLl9zZGtJbnN0YW5jZSA9IG51bGw7CiAgICAgICAgdGhpcy5fdGltZWxpbmUgPSB0aGlzLl9wcm9wZXJ0eVRyYWNrLkdldFRpbWVsaW5lKCk7CiAgICAgICAgdGhpcy5fdHJhY2sgPSB0aGlzLl9wcm9wZXJ0eVRyYWNrLkdldFRyYWNrKCk7CiAgICAgICAgdGhpcy5fc291cmNlQWRhcHRlckFyZ3MgPSB0aGlzLl9wcm9wZXJ0eVRyYWNrLkdldFNvdXJjZUFkYXB0ZXJBcmdzKCk7CiAgICAgICAgdGhpcy5fZmlsZUFyZ3MgPSB0aGlzLl9zb3VyY2VBZGFwdGVyQXJnc1swXTsKICAgICAgICB0aGlzLl9zdGFydE9mZnNldFRpbWUgPSB0aGlzLl9zb3VyY2VBZGFwdGVyQXJnc1sxXTsKICAgICAgICB0aGlzLl9hdWRpb1RhZyA9IHRoaXMuX3NvdXJjZUFkYXB0ZXJBcmdzWzNdID8gdGhpcy5fc291cmNlQWRhcHRlckFyZ3NbM10gOgogICAgICAgICAgICBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zbGljZSgyKTsKICAgICAgICB0aGlzLl92b2x1bWUgPSB0aGlzLl9wYXVzZVZvbHVtZSA9IHRoaXMuX3BhdXNlVGltZSA9IE5hTjsKICAgICAgICB0aGlzLl9hdWRpb1NvdXJjZSA9IG51bGw7CiAgICAgICAgdGhpcy5fSW5pdGlhbGl6ZSgpCiAgICB9CiAgICBSZWxlYXNlKCkgewogICAgICAgIHN1cGVyLlJlbGVhc2UoKTsKICAgICAgICB0aGlzLl9hdWRpb1NvdXJjZSA9IHRoaXMuX2ZpbGVBcmdzID0gdGhpcy5fc291cmNlQWRhcHRlckFyZ3MgPSB0aGlzLl90cmFjayA9IHRoaXMuX3RpbWVsaW5lID0gdGhpcy5fZXhwcmVzc2lvbnMgPSB0aGlzLl9hY3Rpb25zID0gdGhpcy5fc2RrSW5zdGFuY2UgPSBudWxsCiAgICB9CiAgICBfSW5pdGlhbGl6ZSgpIHsKICAgICAgICBpZiAoc2VsZi5DMy5QbHVnaW5zLkF1ZGlvKSB7CiAgICAgICAgICAgIHZhciBhID0gdGhpcy5fcHJvcGVydHlUcmFjay5HZXRSdW50aW1lKCkuR2V0T2JqZWN0Q2xhc3NCeU5hbWUoImF1ZGlvIik7CiAgICAgICAgICAgIGEgJiYgKHRoaXMuX3Nka0luc3RhbmNlID0gYS5HZXRTaW5nbGVHbG9iYWxJbnN0YW5jZSgpLkdldFNka0luc3RhbmNlKCkpOwogICAgICAgICAgICB0aGlzLl9hY3Rpb25zID0gc2VsZi5DMy5QbHVnaW5zLkF1ZGlvLkFjdHM7CiAgICAgICAgICAgIHRoaXMuX2V4cHJlc3Npb25zID0gc2VsZi5DMy5QbHVnaW5zLkF1ZGlvLkV4cHMKICAgICAgICB9CiAgICB9CiAgICBfTWF5YmVTZXRBdWRpb1NvdXJjZSgpIHsKICAgICAgICBpZiAoIXRoaXMuX2F1ZGlvU291cmNlKSB7CiAgICAgICAgICAgIHZhciBhID0gdGhpcy5fcHJvcGVydHlUcmFjay5HZXRUcmFjaygpLkdldFByb3BlcnR5VHJhY2soImF1ZGlvU291cmNlIik7CiAgICAgICAgICAgIGEgJiYgKHRoaXMuX2F1ZGlvU291cmNlID0gYS5HZXRTb3VyY2VBZGFwdGVyKCkpCiAgICAgICAgfQogICAgfQogICAgX0dldFBhdXNlVm9sdW1lKCkgewogICAgICAgIGNvbnN0IGEgPSB0aGlzLl9wcm9wZXJ0eVRyYWNrLkdldFRyYWNrKCkuR2V0UHJvcGVydHlUcmFjaygidm9sdW1lIik7CiAgICAgICAgcmV0dXJuIGEgPyBhLkdldFNvdXJjZUFkYXB0ZXIoKS5fcGF1c2VWb2x1bWUgOiB0aGlzLl9wYXVzZVZvbHVtZQogICAgfQogICAgVGltZWxpbmVSZW1vdmVkKCkgewogICAgICAgIHN1cGVyLlRpbWVsaW5lUmVtb3ZlZCgpOwogICAgICAgIHRoaXMuX2F1ZGlvUGxheWJhY2tTdGFydGVkID0gITE7CiAgICAgICAgdGhpcy5fc2RrSW5zdGFuY2UgJiYgKHRoaXMuX2V4cHJlc3Npb25zICYmICh0aGlzLl9wYXVzZVRpbWUgPSB0aGlzLl9leHByZXNzaW9ucy5QbGF5YmFja1RpbWUuY2FsbCh0aGlzLl9zZGtJbnN0YW5jZSwKICAgICAgICAgICAgdGhpcy5fYXVkaW9UYWcpLCB0aGlzLl9wYXVzZVZvbHVtZSA9IHRoaXMuX2V4cHJlc3Npb25zLlZvbHVtZS5jYWxsKHRoaXMuX3Nka0luc3RhbmNlLCB0aGlzLl9hdWRpb1RhZykpLCB0aGlzLl9hY3Rpb25zICYmIHRoaXMuX2FjdGlvbnMuU3RvcC5jYWxsKHRoaXMuX3Nka0luc3RhbmNlLCB0aGlzLl9hdWRpb1RhZykpCiAgICB9CiAgICBHZXRBdWRpb1RhZygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fYXVkaW9UYWcKICAgIH0KICAgIEdldFZvbHVtZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdm9sdW1lCiAgICB9CiAgICBTZXRWb2x1bWUoYSkgewogICAgICAgIHRoaXMuX3ZvbHVtZSA9IGEKICAgIH0KICAgIFNldEluaXRpYWxTdGF0ZSgpIHsKICAgICAgICBzdXBlci5TZXRJbml0aWFsU3RhdGUoKTsKICAgICAgICB0aGlzLl9wYXVzZVRpbWUgPSBOYU47CiAgICAgICAgdGhpcy5fYXVkaW9QbGF5YmFja1N0YXJ0ZWQgPSAhMQogICAgfQogICAgU2V0UmVzdW1lU3RhdGUoKSB7CiAgICAgICAgc3VwZXIuU2V0UmVzdW1lU3RhdGUoKTsKICAgICAgICBjb25zdCBhID0gdGhpcy5fcHJvcGVydHlUcmFjay5HZXRUaW1lbGluZSgpLkdldFRpbWUoKTsKICAgICAgICB0aGlzLl9wYXVzZVRpbWUgPSBhIC0gdGhpcy5fc3RhcnRPZmZzZXRUaW1lOwogICAgICAgIHN3aXRjaCAodGhpcy5fcHJvcGVydHlUcmFjay5HZXRQcm9wZXJ0eU5hbWUoKSkgewogICAgICAgICAgICBjYXNlICJ2b2x1bWUiOgogICAgICAgICAgICAgICAgdGhpcy5fcGF1c2VWb2x1bWUgPQogICAgICAgICAgICAgICAgICAgIHRoaXMuX3Byb3BlcnR5VHJhY2suR2V0SW50ZXJwb2xhdGVkVmFsdWUoYSkKICAgICAgICB9CiAgICAgICAgdGhpcy5fYXVkaW9QbGF5YmFja1N0YXJ0ZWQgPSAhMQogICAgfQogICAgSW50ZXJwb2xhdGUoYSwgYiwgZCwgYywgZSkgewogICAgICAgIGlmICh0aGlzLl9zZGtJbnN0YW5jZSkgc3dpdGNoICh0aGlzLl9wcm9wZXJ0eVRyYWNrLkdldFByb3BlcnR5TmFtZSgpKSB7CiAgICAgICAgICAgIGNhc2UgImF1ZGlvU291cmNlIjoKICAgICAgICAgICAgICAgIGlmICghdGhpcy5fdGltZWxpbmUuSXNGb3J3YXJkUGxheUJhY2soKSkgYnJlYWs7CiAgICAgICAgICAgICAgICBpZiAoYykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX2FjdGlvbnMgJiYgdGhpcy5fYWN0aW9ucy5TdG9wLmNhbGwodGhpcy5fc2RrSW5zdGFuY2UsIHRoaXMuX2F1ZGlvVGFnKTsKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGEgPCB0aGlzLl9zdGFydE9mZnNldFRpbWUpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9hdWRpb1BsYXliYWNrU3RhcnRlZCA9ICExOwogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBiID0gdGhpcy5fZXhwcmVzc2lvbnMuUGxheWJhY2tSYXRlLmNhbGwodGhpcy5fc2RrSW5zdGFuY2UsIHRoaXMuX2F1ZGlvVGFnKTsKICAgICAgICAgICAgICAgIGQgPSB0aGlzLl90aW1lbGluZS5HZXRQbGF5YmFja1JhdGUoKTsKICAgICAgICAgICAgICAgIGQgIT09IGIgJiYgdGhpcy5fYWN0aW9ucy5TZXRQbGF5YmFja1JhdGUuY2FsbCh0aGlzLl9zZGtJbnN0YW5jZSwKICAgICAgICAgICAgICAgICAgICB0aGlzLl9hdWRpb1RhZywgZCk7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fYXVkaW9QbGF5YmFja1N0YXJ0ZWQpIGJyZWFrOwogICAgICAgICAgICAgICAgdGhpcy5fYXVkaW9QbGF5YmFja1N0YXJ0ZWQgPSAhMDsKICAgICAgICAgICAgICAgIGlzTmFOKHRoaXMuX3BhdXNlVGltZSkgPyAoYiA9IHNlbGYucGVyZm9ybWFuY2Uubm93KCksIGEgLT0gdGhpcy5fc3RhcnRPZmZzZXRUaW1lLCAic3VzcGVuZGVkIiA9PT0gdGhpcy5fc2RrSW5zdGFuY2UuR2V0QXVkaW9Db250ZXh0U3RhdGUoKSA/IHRoaXMuX2F1ZGlvUGxheWJhY2tTdGFydGVkID0gITEgOiAoYiA9IChzZWxmLnBlcmZvcm1hbmNlLm5vdygpIC0gYikgLyAxRTMsIGEgKz0gYiwgdGhpcy5fYWN0aW9ucyAmJiAoYiA9IHRoaXMuR2V0Vm9sdW1lKCksIGlzTmFOKGIpID8gKHRoaXMuU2V0Vm9sdW1lKDApLCBiID0gMCkgOiB0aGlzLlNldFZvbHVtZShiKSwgdGhpcy5fYWN0aW9ucy5QbGF5LmNhbGwodGhpcy5fc2RrSW5zdGFuY2UsIHRoaXMuX2ZpbGVBcmdzLCAwLCBiLCB0aGlzLl9hdWRpb1RhZywgYSkpKSkgOiAoYSA9IHRoaXMuX3BhdXNlVGltZSwgdGhpcy5fcGF1c2VUaW1lID0gTmFOLCBiID0gdGhpcy5fR2V0UGF1c2VWb2x1bWUoKSwKICAgICAgICAgICAgICAgICAgICB0aGlzLl9wYXVzZVZvbHVtZSA9IE5hTiwgInN1c3BlbmRlZCIgPT09IHRoaXMuX3Nka0luc3RhbmNlLkdldEF1ZGlvQ29udGV4dFN0YXRlKCkgPyB0aGlzLl9hdWRpb1BsYXliYWNrU3RhcnRlZCA9ICExIDogdGhpcy5fYWN0aW9ucyAmJiAodGhpcy5TZXRWb2x1bWUoYiksIHRoaXMuX2FjdGlvbnMuUGxheS5jYWxsKHRoaXMuX3Nka0luc3RhbmNlLCB0aGlzLl9maWxlQXJncywgMCwgYiwgdGhpcy5fYXVkaW9UYWcsIGEpKSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAidm9sdW1lIjoKICAgICAgICAgICAgICAgIHRoaXMuX01heWJlU2V0QXVkaW9Tb3VyY2UoKSwgc3VwZXIuSW50ZXJwb2xhdGUoYSwgYiwgZCwgYywgZSkKICAgICAgICB9CiAgICB9CiAgICBHZXRJbnRlcnBvbGF0ZWRWYWx1ZShhLCBiLCBkKSB7CiAgICAgICAgaWYgKHRoaXMuX3Nka0luc3RhbmNlKSBzd2l0Y2ggKHRoaXMuX3Byb3BlcnR5VHJhY2suR2V0UHJvcGVydHlOYW1lKCkpIHsKICAgICAgICAgICAgY2FzZSAidm9sdW1lIjoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9NYXliZVNldEF1ZGlvU291cmNlKCksIHN1cGVyLkdldEludGVycG9sYXRlZFZhbHVlKGEsIGIsIGQpCiAgICAgICAgfQogICAgfQogICAgR2V0dGVyKGEsIGIpIHsKICAgICAgICByZXR1cm4gdGhpcy5fYXVkaW9Tb3VyY2UgPwogICAgICAgICAgICB0aGlzLl9hdWRpb1NvdXJjZS5HZXRWb2x1bWUoKSA6IDAKICAgIH0KICAgIFNldHRlcihhLCBiLCBkLCBjKSB7CiAgICAgICAgdGhpcy5fYXVkaW9Tb3VyY2UgJiYgdGhpcy5fYXVkaW9Tb3VyY2UuU2V0Vm9sdW1lKHRoaXMuR2V0dGVyKCkgKyBiKTsKICAgICAgICB0aGlzLl9hY3Rpb25zICYmIHRoaXMuX2F1ZGlvU291cmNlICYmIHRoaXMuX2FjdGlvbnMuU2V0Vm9sdW1lLmNhbGwodGhpcy5fc2RrSW5zdGFuY2UsIHRoaXMuX2F1ZGlvU291cmNlLkdldEF1ZGlvVGFnKCksIHRoaXMuX2F1ZGlvU291cmNlLkdldFZvbHVtZSgpKQogICAgfQogICAgQWJzb2x1dGVTZXR0ZXIoYSwgYiwgZCkgewogICAgICAgIHRoaXMuX2F1ZGlvU291cmNlICYmIHRoaXMuX2F1ZGlvU291cmNlLlNldFZvbHVtZShiKTsKICAgICAgICB0aGlzLl9hY3Rpb25zICYmIHRoaXMuX2F1ZGlvU291cmNlICYmIHRoaXMuX2FjdGlvbnMuU2V0Vm9sdW1lLmNhbGwodGhpcy5fc2RrSW5zdGFuY2UsIHRoaXMuX2F1ZGlvU291cmNlLkdldEF1ZGlvVGFnKCksIHRoaXMuX2F1ZGlvU291cmNlLkdldFZvbHVtZSgpKQogICAgfQogICAgRG9lc1JvdW5kaW5nKCkgewogICAgICAgIHJldHVybiAhMAogICAgfQogICAgX1NhdmVUb0pzb24oKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgYXVkaW9QbGF5YmFja1N0YXJ0ZWQ6IHRoaXMuX2F1ZGlvUGxheWJhY2tTdGFydGVkLAogICAgICAgICAgICBhdWRpb1RhZzogdGhpcy5fYXVkaW9UYWcsCiAgICAgICAgICAgIHBhdXNlVGltZTogdGhpcy5fcGF1c2VUaW1lLAogICAgICAgICAgICBwYXVzZVZvbHVtZTogdGhpcy5fcGF1c2VWb2x1bWUsCiAgICAgICAgICAgIHZvbHVtZTogdGhpcy5fdm9sdW1lCiAgICAgICAgfQogICAgfQogICAgX0xvYWRGcm9tSnNvbihhKSB7CiAgICAgICAgYSAmJiAodGhpcy5fYXVkaW9QbGF5YmFja1N0YXJ0ZWQgPSBhLmF1ZGlvUGxheWJhY2tTdGFydGVkLCB0aGlzLl9hdWRpb1RhZyA9IGEuYXVkaW9UYWcsIHRoaXMuX3BhdXNlVGltZSA9IGEucGF1c2VUaW1lLCB0aGlzLl9wYXVzZVZvbHVtZSA9IGEucGF1c2VWb2x1bWUsIHRoaXMuX3ZvbHVtZSA9IGEudm9sdW1lLCB0aGlzLl9Jbml0aWFsaXplKCkpCiAgICB9Cn0KQzMkanNjb21wJDkzLlByb3BlcnR5VHJhY2tTdGF0ZS5BdWRpb1NvdXJjZUFkYXB0ZXIgPSBBdWRpb1NvdXJjZUFkYXB0ZXI7CiJ1c2Ugc3RyaWN0IjsKc2VsZi5DMy5Qcm9wZXJ0eVRyYWNrU3RhdGUuUHJvcGVydHlJbnRlcnBvbGF0aW9uQWRhcHRlciA9IGNsYXNzIHsKICAgIGNvbnN0cnVjdG9yKGEpIHsKICAgICAgICB0aGlzLl9zb3VyY2VBZGFwdGVyID0gYTsKICAgICAgICB0aGlzLl9wcm9wZXJ0eVRyYWNrID0gYS5HZXRQcm9wZXJ0eVRyYWNrKCk7CiAgICAgICAgdGhpcy5fd29ybGRJbmZvID0gdGhpcy5fcHJvcGVydHlUcmFjay5HZXRUcmFjaygpLkdldFdvcmxkSW5mbygpOwogICAgICAgIHRoaXMuX3Byb3BlcnR5ID0gdGhpcy5fcHJvcGVydHlUcmFjay5HZXRQcm9wZXJ0eU5hbWUoKTsKICAgICAgICB0aGlzLl9maXJzdEFic29sdXRlVXBkYXRlID0gITE7CiAgICAgICAgdGhpcy5fdGFyZ2V0ID0gdGhpcy5fc2F2ZVN0YXRlID0gbnVsbAogICAgfQogICAgUmVsZWFzZSgpIHsKICAgICAgICB0aGlzLl90YXJnZXQgPSB0aGlzLl9zYXZlU3RhdGUgPSB0aGlzLl93b3JsZEluZm8gPSB0aGlzLl9wcm9wZXJ0eVRyYWNrID0gdGhpcy5fc291cmNlQWRhcHRlciA9IG51bGwKICAgIH0KICAgIE1heU5lZWRCZWZvcmVBbmRBZnRlckludGVycG9sYXRlKCkgewogICAgICAgIHJldHVybiAhMQogICAgfQogICAgVGltZWxpbmVSZW1vdmVkKCkge30KICAgIENsZWFuQ2FjaGVzKCkgewogICAgICAgIHRoaXMuX3RhcmdldCA9CiAgICAgICAgICAgIHRoaXMuX3NhdmVTdGF0ZSA9IHRoaXMuX3dvcmxkSW5mbyA9IG51bGwKICAgIH0KICAgIEdldFNvdXJjZUFkYXB0ZXIoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3NvdXJjZUFkYXB0ZXIKICAgIH0KICAgIEdldFByb3BlcnR5VHJhY2soKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3Byb3BlcnR5VHJhY2sKICAgIH0KICAgIEdldFdvcmxkSW5mbygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fd29ybGRJbmZvID8gdGhpcy5fd29ybGRJbmZvIDogdGhpcy5fd29ybGRJbmZvID0gdGhpcy5fcHJvcGVydHlUcmFjay5HZXRUcmFjaygpLkdldFdvcmxkSW5mbygpCiAgICB9CiAgICBTZXRGaXJzdEFic29sdXRlVXBkYXRlKGEpIHsKICAgICAgICB0aGlzLl9maXJzdEFic29sdXRlVXBkYXRlID0gISFhCiAgICB9CiAgICBHZXRGaXJzdEFic29sdXRlVXBkYXRlKCkgewogICAgICAgIHJldHVybiB0aGlzLl9maXJzdEFic29sdXRlVXBkYXRlCiAgICB9CiAgICBTZXRSZXNldFN0YXRlKCkge30KICAgIFNldEluaXRpYWxTdGF0ZSgpIHt9CiAgICBTZXRSZXN1bWVTdGF0ZSgpIHt9CiAgICBTZXRTYXZlU3RhdGUoKSB7CiAgICAgICAgdGhpcy5fc2F2ZVN0YXRlID0gdGhpcy5HZXRDdXJyZW50U3RhdGUoKQogICAgfQogICAgQ2xlYXJTYXZlU3RhdGUoKSB7CiAgICAgICAgdGhpcy5fc2F2ZVN0YXRlID0gbnVsbAogICAgfQogICAgR2V0Q3VycmVudFN0YXRlKCkge30KICAgIENvbXBhcmVJbml0aWFsU3RhdGVXaXRoQ3VycmVudCgpIHt9CiAgICBDb21wYXJlU2F2ZVN0YXRlV2l0aEN1cnJlbnQoKSB7fQogICAgQ2FuQ2hhbmdlKGEpIHsKICAgICAgICByZXR1cm4gdHlwZW9mIHRoaXMuX0dldHRlcigpID09PQogICAgICAgICAgICB0eXBlb2YgYQogICAgfQogICAgQmVmb3JlQ2hhbmdlUHJvcGVydHkoKSB7fQogICAgQ2hhbmdlUHJvcGVydHkoYSwgYiwgZCwgYywgZSkge30KICAgIEFmdGVyQ2hhbmdlUHJvcGVydHkoKSB7fQogICAgX0ZpcnN0S2V5ZnJhbWVHZXR0ZXIoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX1BpY2tUaW1lbGluZVBsYXliYWNrTW9kZSgoKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IGEgPSB0aGlzLl9wcm9wZXJ0eVRyYWNrLkdldFByb3BlcnR5VHJhY2tEYXRhSXRlbSgpOwogICAgICAgICAgICByZXR1cm4gdGhpcy5fcHJvcGVydHlUcmFjay5HZXRQcm9wZXJ0eVRyYWNrRGF0YSgpLkdldEZpcnN0UHJvcGVydHlLZXlmcmFtZURhdGFJdGVtKGEpCiAgICAgICAgfSwgKCkgPT4gewogICAgICAgICAgICBjb25zdCBhID0gdGhpcy5fcHJvcGVydHlUcmFjay5HZXRQcm9wZXJ0eVRyYWNrRGF0YUl0ZW0oKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3Byb3BlcnR5VHJhY2suR2V0UHJvcGVydHlUcmFja0RhdGEoKS5HZXRMYXN0UHJvcGVydHlLZXlmcmFtZURhdGFJdGVtKGEpCiAgICAgICAgfSkuR2V0QWJzb2x1dGVWYWx1ZSgpCiAgICB9CiAgICBfQ3VycmVudEtleWZyYW1lR2V0dGVyKCkgewogICAgICAgIGNvbnN0IGEgPSB0aGlzLl9wcm9wZXJ0eVRyYWNrLkdldFRpbWVsaW5lKCkuR2V0VGltZSgpIC0KICAgICAgICAgICAgdGhpcy5fcHJvcGVydHlUcmFjay5HZXRUcmFjaygpLkdldFN0YXJ0T2Zmc2V0KCk7CiAgICAgICAgcmV0dXJuIHRoaXMuX1BpY2tUaW1lbGluZVBsYXliYWNrTW9kZSgoKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IGIgPSB0aGlzLl9wcm9wZXJ0eVRyYWNrLkdldFByb3BlcnR5VHJhY2tEYXRhSXRlbSgpOwogICAgICAgICAgICByZXR1cm4gdGhpcy5fcHJvcGVydHlUcmFjay5HZXRQcm9wZXJ0eVRyYWNrRGF0YSgpLkdldEZpcnN0UHJvcGVydHlLZXlGcmFtZURhdGFJdGVtTG93ZXJPckVxdWFsVGhhbihhLCBiKQogICAgICAgIH0sICgpID0+IHsKICAgICAgICAgICAgY29uc3QgYiA9IHRoaXMuX3Byb3BlcnR5VHJhY2suR2V0UHJvcGVydHlUcmFja0RhdGFJdGVtKCksCiAgICAgICAgICAgICAgICBkID0gdGhpcy5fcHJvcGVydHlUcmFjay5HZXRQcm9wZXJ0eVRyYWNrRGF0YSgpLAogICAgICAgICAgICAgICAgYyA9IGQuR2V0Rmlyc3RQcm9wZXJ0eUtleUZyYW1lRGF0YUl0ZW1IaWdoZXJPckVxdWFsVGhhbihhLCBiKTsKICAgICAgICAgICAgcmV0dXJuIGMgPyBjIDogZC5HZXRMYXN0UHJvcGVydHlLZXlmcmFtZURhdGFJdGVtKGIpCiAgICAgICAgfSkuR2V0QWJzb2x1dGVWYWx1ZSgpCiAgICB9CiAgICBfUGlja1RpbWVsaW5lUGxheWJhY2tNb2RlKGEsCiAgICAgICAgYikgewogICAgICAgIHJldHVybiB0aGlzLl9wcm9wZXJ0eVRyYWNrLkdldFRpbWVsaW5lKCkuSXNGb3J3YXJkUGxheUJhY2soKSA/IGEoKSA6IGIoKQogICAgfQogICAgX1BpY2tSZXN1bHRNb2RlKGEsIGIpIHsKICAgICAgICByZXR1cm4gInJlbGF0aXZlIiA9PT0gdGhpcy5fcHJvcGVydHlUcmFjay5HZXRSZXN1bHRNb2RlKCkgPyBhKCkgOiBiKCkKICAgIH0KICAgIF9QaWNrRmlyc3RBYnNvbHV0ZVVwZGF0ZShhLCBiKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuR2V0Rmlyc3RBYnNvbHV0ZVVwZGF0ZSgpID8gKHRoaXMuU2V0Rmlyc3RBYnNvbHV0ZVVwZGF0ZSghMSksIGEoKSkgOiBiKCkKICAgIH0KICAgIF9HZXRBYnNvbHV0ZUluaXRpYWxWYWx1ZShhKSB7fQogICAgX0dldEluZGV4KCkgewogICAgICAgIHJldHVybiB0aGlzLl9zb3VyY2VBZGFwdGVyLkdldEluZGV4KCkKICAgIH0KICAgIF9HZXRUYXJnZXQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3RhcmdldCA/IHRoaXMuX3RhcmdldCA6IHRoaXMuX3RhcmdldCA9IHRoaXMuX3NvdXJjZUFkYXB0ZXIuR2V0VGFyZ2V0KCkKICAgIH0KICAgIF9QaWNrU291cmNlKGEsIGIsIGQsIGMsIGUsIGcpIHsKICAgICAgICBzd2l0Y2ggKHRoaXMuX3Byb3BlcnR5VHJhY2suR2V0U291cmNlQWRhcHRlcklkKCkpIHsKICAgICAgICAgICAgY2FzZSAiYmVoYXZpb3IiOgogICAgICAgICAgICAgICAgcmV0dXJuIGEoKTsKICAgICAgICAgICAgY2FzZSAiZWZmZWN0IjoKICAgICAgICAgICAgICAgIHJldHVybiBiKCk7CiAgICAgICAgICAgIGNhc2UgImluc3RhbmNlLXZhcmlhYmxlIjoKICAgICAgICAgICAgICAgIHJldHVybiBkKCk7CiAgICAgICAgICAgIGNhc2UgInBsdWdpbiI6CiAgICAgICAgICAgICAgICByZXR1cm4gYygpOwogICAgICAgICAgICBjYXNlICJ3b3JsZC1pbnN0YW5jZSI6CiAgICAgICAgICAgICAgICByZXR1cm4gZSgpOwogICAgICAgICAgICBjYXNlICJhdWRpbyI6CiAgICAgICAgICAgICAgICByZXR1cm4gZygpCiAgICAgICAgfQogICAgfQogICAgX1NhdmVUb0pzb24oKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgZmlyc3RBYnNvbHV0ZVVwZGF0ZTogdGhpcy5fZmlyc3RBYnNvbHV0ZVVwZGF0ZSwKICAgICAgICAgICAgc2F2ZVN0YXRlOiB0aGlzLl9zYXZlU3RhdGUKICAgICAgICB9CiAgICB9CiAgICBfTG9hZEZyb21Kc29uKGEpIHsKICAgICAgICBhICYmICh0aGlzLl9maXJzdEFic29sdXRlVXBkYXRlID0gYS5maXJzdEFic29sdXRlVXBkYXRlLCB0aGlzLl9zYXZlU3RhdGUgPSBhLnNhdmVTdGF0ZSkKICAgIH0KICAgIF9HZXRQcm9wZXJ0eUtleWZyYW1lU3R1YnMoYSwgYiA9ICExKSB7CiAgICAgICAgY29uc3QgZCA9IFtdOwogICAgICAgIGZvciAoY29uc3QgYyBvZiBhKSB7CiAgICAgICAgICAgIGEgPSBjLkdldFRyYWNrKCkuR2V0U3RhcnRPZmZzZXQoKTsKICAgICAgICAgICAgZm9yIChjb25zdCBlIG9mIGMuR2V0UHJvcGVydHlLZXlmcmFtZURhdGFJdGVtcygpKSBiICYmIDAgPT09IGUuR2V0VGltZSgpID8gZC5wdXNoKHsKICAgICAgICAgICAgICAgIHRpbWU6IGEgKwogICAgICAgICAgICAgICAgICAgIGUuR2V0VGltZSgpLAogICAgICAgICAgICAgICAgdmFsdWU6IGUuR2V0QWJzb2x1dGVWYWx1ZSgpCiAgICAgICAgICAgIH0pIDogYiB8fCBkLnB1c2goewogICAgICAgICAgICAgICAgdGltZTogYSArIGUuR2V0VGltZSgpLAogICAgICAgICAgICAgICAgdmFsdWU6IGUuR2V0QWJzb2x1dGVWYWx1ZSgpCiAgICAgICAgICAgIH0pCiAgICAgICAgfQogICAgICAgIHJldHVybiBkLnNvcnQoKGMsIGUpID0+IGMudGltZSAtIGUudGltZSkKICAgIH0KICAgIF9HZXRMYXN0UHJvcGVydHlLZXlmcmFtZVN0dWIoYSwgYiwgZCkgewogICAgICAgIHJldHVybiB0aGlzLl9HZXRQcm9wZXJ0eUtleWZyYW1lU3R1Ykxvd2VyVGhhblBsYXloZWFkKGIsIGQpCiAgICB9CiAgICBfR2V0UHJvcGVydHlLZXlmcmFtZVN0dWJMb3dlclRoYW5QbGF5aGVhZChhLCBiKSB7CiAgICAgICAgZm9yIChsZXQgZCA9IGIubGVuZ3RoIC0gMTsgMCA8PSBkOyBkLS0pCiAgICAgICAgICAgIGlmIChiW2RdLnRpbWUgPD0gYSkgcmV0dXJuIGJbZF07CiAgICAgICAgcmV0dXJuIG51bGwKICAgIH0KfTsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkOTUgPSBzZWxmLkMzLAogICAgVE1QX0NPTE9SU19NQVAgPSBuZXcgTWFwLAogICAgVE1QX0NPTE9SID0gWzAsIDAsIDBdOwpjbGFzcyBDb2xvckludGVycG9sYXRpb25BZGFwdGVyIGV4dGVuZHMgQzMkanNjb21wJDk1LlByb3BlcnR5VHJhY2tTdGF0ZS5Qcm9wZXJ0eUludGVycG9sYXRpb25BZGFwdGVyIHsKICAgIGNvbnN0cnVjdG9yKGEpIHsKICAgICAgICBzdXBlcihhKQogICAgfQogICAgU2V0UmVzZXRTdGF0ZSgpIHt9CiAgICBTZXRJbml0aWFsU3RhdGUoKSB7fQogICAgU2V0UmVzdW1lU3RhdGUoKSB7fQogICAgR2V0Q3VycmVudFN0YXRlKCkgewogICAgICAgIGNvbnN0IGEgPSB0aGlzLl9wcm9wZXJ0eVRyYWNrLkdldFNvdXJjZUFkYXB0ZXJJZCgpLAogICAgICAgICAgICBiID0gdGhpcy5fR2V0VGFyZ2V0KCksCiAgICAgICAgICAgIGQgPSB0aGlzLl9HZXRJbmRleCgpOwogICAgICAgIHN3aXRjaCAoYSkgewogICAgICAgICAgICBjYXNlICJiZWhhdmlvciI6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fVG9Db2xvckFycmF5KGIuR2V0UHJvcGVydHlWYWx1ZUJ5SW5kZXgoZCkpOwogICAgICAgICAgICBjYXNlICJlZmZlY3QiOgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX1RvQ29sb3JBcnJheShiW2RdKTsKICAgICAgICAgICAgY2FzZSAicGx1Z2luIjoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9Ub0NvbG9yQXJyYXkoYi5HZXRQcm9wZXJ0eVZhbHVlQnlJbmRleChkKSk7CiAgICAgICAgICAgIGNhc2UgIndvcmxkLWluc3RhbmNlIjoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9Ub0NvbG9yQXJyYXkodGhpcy5fR2V0dGVyKCkpCiAgICAgICAgfQogICAgfQogICAgQ29tcGFyZUluaXRpYWxTdGF0ZVdpdGhDdXJyZW50KCkgewogICAgICAgIGNvbnN0IGEgPQogICAgICAgICAgICB0aGlzLl9GaXJzdEtleWZyYW1lR2V0dGVyKCk7CiAgICAgICAgcmV0dXJuICF0aGlzLl9Db21wYXJlQ29sb3JzKGEsIHRoaXMuX0dldHRlcigpKQogICAgfQogICAgQ29tcGFyZVNhdmVTdGF0ZVdpdGhDdXJyZW50KCkgewogICAgICAgIHJldHVybiBDMyRqc2NvbXAkOTUuSXNOdWxsT3JVbmRlZmluZWQodGhpcy5fc2F2ZVN0YXRlKSA/ICExIDogIXRoaXMuX0NvbXBhcmVDb2xvcnModGhpcy5fc2F2ZVN0YXRlLCB0aGlzLl9HZXR0ZXIoKSkKICAgIH0KICAgIF9Db21wYXJlQ29sb3JzKGEsIGIpIHsKICAgICAgICBhID0gdGhpcy5fR2V0Q29sb3JGcm9tQXJyYXkoYSk7CiAgICAgICAgYiA9IHRoaXMuX0dldENvbG9yRnJvbUFycmF5KGIpOwogICAgICAgIHJldHVybiBhLmVxdWFsc0lnbm9yaW5nQWxwaGEoYikKICAgIH0KICAgIF9GaXJzdEtleWZyYW1lR2V0dGVyKCkgewogICAgICAgIGNvbnN0IGEgPSBzdXBlci5fRmlyc3RLZXlmcmFtZUdldHRlcigpOwogICAgICAgIHJldHVybiB0aGlzLl9HZXRDb2xvckZyb21BcnJheShhKQogICAgfQogICAgX0N1cnJlbnRLZXlmcmFtZUdldHRlcigpIHsKICAgICAgICBjb25zdCBhID0gc3VwZXIuX0N1cnJlbnRLZXlmcmFtZUdldHRlcigpOwogICAgICAgIHJldHVybiB0aGlzLl9HZXRDb2xvckZyb21BcnJheShhKQogICAgfQogICAgX0dldEFic29sdXRlSW5pdGlhbFZhbHVlKGEpIHt9CiAgICBfVG9Db2xvckFycmF5KGEpIHsKICAgICAgICByZXR1cm4gQzMkanNjb21wJDk1LklzSW5zdGFuY2VPZihhLAogICAgICAgICAgICBDMyRqc2NvbXAkOTUuQ29sb3IpID8gYS50b0FycmF5KCkuc2xpY2UoMCwgMykgOiBhLnNsaWNlKDAsIDMpCiAgICB9CiAgICBfR2V0Q29sb3JGcm9tQXJyYXkoYSkgewogICAgICAgIHJldHVybiBDMyRqc2NvbXAkOTUuSXNJbnN0YW5jZU9mKGEsIEMzJGpzY29tcCQ5NS5Db2xvcikgPyBhIDogbmV3IEMzJGpzY29tcCQ5NS5Db2xvcihhWzBdLCBhWzFdLCBhWzJdLCAxKQogICAgfQogICAgQ2FuQ2hhbmdlKGEpIHsKICAgICAgICByZXR1cm4gITAKICAgIH0KICAgIE1heU5lZWRCZWZvcmVBbmRBZnRlckludGVycG9sYXRlKCkgewogICAgICAgIHJldHVybiAhMAogICAgfQogICAgQmVmb3JlQ2hhbmdlUHJvcGVydHkoKSB7CiAgICAgICAgdmFyIGEgPSB0aGlzLl9wcm9wZXJ0eVRyYWNrLkdldFRpbWVsaW5lKCksCiAgICAgICAgICAgIGIgPSB0aGlzLl9wcm9wZXJ0eVRyYWNrLkdldEluc3RhbmNlKCk7CiAgICAgICAgY29uc3QgZCA9IHRoaXMuX3Byb3BlcnR5VHJhY2suR2V0U291cmNlQWRhcHRlcigpOwogICAgICAgIChhID0gYS5HZXRTaW1pbGFyUHJvcGVydHlUcmFja3MoYiwgZCwgdGhpcy5fcHJvcGVydHkpKSAmJiAxIDwgYS5sZW5ndGggJiYgKFRNUF9DT0xPUlNfTUFQLmhhcyhiKSB8fCBUTVBfQ09MT1JTX01BUC5zZXQoYiwgbmV3IE1hcCksCiAgICAgICAgICAgIGIgPSBUTVBfQ09MT1JTX01BUC5nZXQoYiksIGEgPSB0aGlzLl9wcm9wZXJ0eVRyYWNrLkdldFNvdXJjZUFkYXB0ZXJJZCgpLCBiLmhhcyhhKSB8fCBiLnNldChhLCBuZXcgTWFwKSwgYiA9IGIuZ2V0KGEpLCBiLmhhcyh0aGlzLl9wcm9wZXJ0eSkgfHwgYi5zZXQodGhpcy5fcHJvcGVydHksIHsKICAgICAgICAgICAgICAgIHVzZWQ6ICExLAogICAgICAgICAgICAgICAgY29sb3I6IG5ldyBDMyRqc2NvbXAkOTUuQ29sb3IoMCwgMCwgMCwgMSkKICAgICAgICAgICAgfSkpCiAgICB9CiAgICBfR2V0VG1wQ29sb3IoYSwgYiwgZCkgewogICAgICAgIGEgPSBUTVBfQ09MT1JTX01BUC5nZXQoYSkuZ2V0KGIpLmdldChkKTsKICAgICAgICBhLnVzZWQgPSAhMDsKICAgICAgICByZXR1cm4gYS5jb2xvcgogICAgfQogICAgQ2hhbmdlUHJvcGVydHkoYSwgYiwgZCwgYywgZSkgewogICAgICAgIGUgPSB0aGlzLl9wcm9wZXJ0eVRyYWNrLkdldFRpbWVsaW5lKCk7CiAgICAgICAgYyA9IHRoaXMuX3Byb3BlcnR5VHJhY2suR2V0VHJhY2soKTsKICAgICAgICBhID0gdGhpcy5fcHJvcGVydHlUcmFjay5HZXRJbnN0YW5jZSgpOwogICAgICAgIHZhciBnID0gdGhpcy5fcHJvcGVydHlUcmFjay5HZXRTb3VyY2VBZGFwdGVyKCk7CiAgICAgICAgZCA9IHRoaXMuX3Byb3BlcnR5VHJhY2suR2V0U291cmNlQWRhcHRlcklkKCk7CiAgICAgICAgaWYgKChnID0gZS5HZXRTaW1pbGFyUHJvcGVydHlUcmFja3MoYSwgZywgdGhpcy5fcHJvcGVydHkpKSAmJiAxIDwgZy5sZW5ndGgpIHsKICAgICAgICAgICAgaWYgKGcgPSB0aGlzLl9HZXRQcm9wZXJ0eUtleWZyYW1lU3R1YnMoZywgITApLCBlID0gdGhpcy5fR2V0TGFzdFByb3BlcnR5S2V5ZnJhbWVTdHViKGUsIGUuR2V0VGltZSgpLCBnKSkgYyA9IGMuR2V0U3RhcnRPZmZzZXQoKSwgZyA9IGUudGltZSAtIGMsIDAgPT09IGcgPyB0aGlzLl9HZXRUbXBDb2xvcihhLCBkLCB0aGlzLl9wcm9wZXJ0eSkuYWRkUmdiKGJbMF0sIGJbMV0sIGJbMl0pIDogMCA+IGcgfHwgKGUgPSBiWzBdLCBjID0gYlsxXSwgYiA9IGJbMl0sIGcgPSB0aGlzLl9wcm9wZXJ0eVRyYWNrLkludGVycG9sYXRlKGcsICExLCAhMCksIGUgPSBDMyRqc2NvbXAkOTUuQ29sb3IuRGlmZkNoYW5uZWwoZSwgZ1swXSksIGMgPSBDMyRqc2NvbXAkOTUuQ29sb3IuRGlmZkNoYW5uZWwoYywgZ1sxXSksIGIgPSBDMyRqc2NvbXAkOTUuQ29sb3IuRGlmZkNoYW5uZWwoYiwgZ1syXSksIHRoaXMuX0dldFRtcENvbG9yKGEsIGQsIHRoaXMuX3Byb3BlcnR5KS5hZGRSZ2IoZSwKICAgICAgICAgICAgICAgIGMsIGIpKQogICAgICAgIH0gZWxzZSB0aGlzLl9TZXR0ZXIoYlswXSwgYlsxXSwgYlsyXSkKICAgIH0KICAgIEFmdGVyQ2hhbmdlUHJvcGVydHkoKSB7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuX3Byb3BlcnR5VHJhY2suR2V0SW5zdGFuY2UoKTsKICAgICAgICBpZiAoVE1QX0NPTE9SU19NQVAuaGFzKGEpKSB7CiAgICAgICAgICAgIHZhciBiID0gVE1QX0NPTE9SU19NQVAuZ2V0KGEpLAogICAgICAgICAgICAgICAgZCA9IHRoaXMuX3Byb3BlcnR5VHJhY2suR2V0U291cmNlQWRhcHRlcklkKCk7CiAgICAgICAgICAgIGlmIChiLmhhcyhkKSkgewogICAgICAgICAgICAgICAgdmFyIGMgPSBiLmdldChkKTsKICAgICAgICAgICAgICAgIGlmIChjLmhhcyh0aGlzLl9wcm9wZXJ0eSkpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZSA9IGMuZ2V0KHRoaXMuX3Byb3BlcnR5KSwKICAgICAgICAgICAgICAgICAgICAgICAgZyA9IGUuY29sb3I7CiAgICAgICAgICAgICAgICAgICAgZS51c2VkICYmIHRoaXMuX1NldHRlcihnLmdldFIoKSwgZy5nZXRHKCksIGcuZ2V0QigpKTsKICAgICAgICAgICAgICAgICAgICAwID09PSBjLnNpemUgJiYgYi5kZWxldGUoZCk7CiAgICAgICAgICAgICAgICAgICAgMCA9PT0gYi5zaXplICYmIFRNUF9DT0xPUlNfTUFQLmRlbGV0ZShhKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgX0dldHRlcigpIHsKICAgICAgICBjb25zdCBhID0gdGhpcy5fcHJvcGVydHlUcmFjay5HZXRTb3VyY2VBZGFwdGVySWQoKSwKICAgICAgICAgICAgYiA9IHRoaXMuX0dldFRhcmdldCgpLAogICAgICAgICAgICBkID0gdGhpcy5fR2V0SW5kZXgoKTsKICAgICAgICBzd2l0Y2ggKGEpIHsKICAgICAgICAgICAgY2FzZSAiYmVoYXZpb3IiOgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX0dldENvbG9yRnJvbUFycmF5KGIuR2V0UHJvcGVydHlWYWx1ZUJ5SW5kZXgoZCkpOwogICAgICAgICAgICBjYXNlICJlZmZlY3QiOgogICAgICAgICAgICAgICAgcmV0dXJuIGJbZF0uY2xvbmUoKTsKICAgICAgICAgICAgY2FzZSAicGx1Z2luIjoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9HZXRDb2xvckZyb21BcnJheShiLkdldFByb3BlcnR5VmFsdWVCeUluZGV4KGQpKTsKICAgICAgICAgICAgY2FzZSAid29ybGQtaW5zdGFuY2UiOgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuR2V0V29ybGRJbmZvKCkuR2V0VW5wcmVtdWx0aXBsaWVkQ29sb3IoKS5jbG9uZSgpCiAgICAgICAgfQogICAgfQogICAgX1NldHRlcihhLCBiLCBkKSB7CiAgICAgICAgY29uc3QgYyA9IHRoaXMuX3Byb3BlcnR5VHJhY2suR2V0U291cmNlQWRhcHRlcklkKCksCiAgICAgICAgICAgIGUgPSB0aGlzLl9HZXRUYXJnZXQoKSwKICAgICAgICAgICAgZyA9IHRoaXMuX0dldEluZGV4KCk7CiAgICAgICAgc3dpdGNoIChjKSB7CiAgICAgICAgICAgIGNhc2UgImJlaGF2aW9yIjoKICAgICAgICAgICAgICAgIFRNUF9DT0xPUlswXSA9IGE7CiAgICAgICAgICAgICAgICBUTVBfQ09MT1JbMV0gPSBiOwogICAgICAgICAgICAgICAgVE1QX0NPTE9SWzJdID0gZDsKICAgICAgICAgICAgICAgIGUuU2V0UHJvcGVydHlWYWx1ZUJ5SW5kZXgoZywgVE1QX0NPTE9SKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICJlZmZlY3QiOgogICAgICAgICAgICAgICAgZVtnXS5zZXRSZ2IoYSwKICAgICAgICAgICAgICAgICAgICBiLCBkKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICJwbHVnaW4iOgogICAgICAgICAgICAgICAgVE1QX0NPTE9SWzBdID0gYTsKICAgICAgICAgICAgICAgIFRNUF9DT0xPUlsxXSA9IGI7CiAgICAgICAgICAgICAgICBUTVBfQ09MT1JbMl0gPSBkOwogICAgICAgICAgICAgICAgZS5TZXRQcm9wZXJ0eVZhbHVlQnlJbmRleChnLCBUTVBfQ09MT1IpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgIndvcmxkLWluc3RhbmNlIjoKICAgICAgICAgICAgICAgIHRoaXMuR2V0V29ybGRJbmZvKCkuU2V0VW5wcmVtdWx0aXBsaWVkQ29sb3JSR0IoYSwgYiwgZCkKICAgICAgICB9CiAgICB9CiAgICBfU2F2ZVRvSnNvbigpIHt9CiAgICBfTG9hZEZyb21Kc29uKGEpIHt9Cn0KQzMkanNjb21wJDk1LlByb3BlcnR5VHJhY2tTdGF0ZS5Qcm9wZXJ0eUludGVycG9sYXRpb25BZGFwdGVyLkNvbG9ySW50ZXJwb2xhdGlvbkFkYXB0ZXIgPSBDb2xvckludGVycG9sYXRpb25BZGFwdGVyOwoidXNlIHN0cmljdCI7CmNvbnN0IEMzJGpzY29tcCQ5NiA9IHNlbGYuQzMsCiAgICBOUyRqc2NvbXAkMSA9IEMzJGpzY29tcCQ5Ni5Qcm9wZXJ0eVRyYWNrU3RhdGU7CmNsYXNzIE5vSW50ZXJwb2xhdGlvbkFkYXB0ZXIgZXh0ZW5kcyBDMyRqc2NvbXAkOTYuUHJvcGVydHlUcmFja1N0YXRlLlByb3BlcnR5SW50ZXJwb2xhdGlvbkFkYXB0ZXIgewogICAgY29uc3RydWN0b3IoYSkgewogICAgICAgIHN1cGVyKGEpCiAgICB9CiAgICBTZXRSZXNldFN0YXRlKCkge30KICAgIFNldEluaXRpYWxTdGF0ZSgpIHt9CiAgICBTZXRSZXN1bWVTdGF0ZSgpIHt9CiAgICBHZXRDdXJyZW50U3RhdGUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX0dldHRlcigpCiAgICB9CiAgICBDb21wYXJlSW5pdGlhbFN0YXRlV2l0aEN1cnJlbnQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX0ZpcnN0S2V5ZnJhbWVHZXR0ZXIoKSAhPT0gdGhpcy5HZXRDdXJyZW50U3RhdGUoKQogICAgfQogICAgQ29tcGFyZVNhdmVTdGF0ZVdpdGhDdXJyZW50KCkgewogICAgICAgIHJldHVybiBDMyRqc2NvbXAkOTYuSXNOdWxsT3JVbmRlZmluZWQodGhpcy5fc2F2ZVN0YXRlKSA/ICExIDogdGhpcy5fc2F2ZVN0YXRlICE9PSB0aGlzLkdldEN1cnJlbnRTdGF0ZSgpCiAgICB9CiAgICBNYXlOZWVkQmVmb3JlQW5kQWZ0ZXJJbnRlcnBvbGF0ZSgpIHsKICAgICAgICByZXR1cm4gITEKICAgIH0KICAgIENoYW5nZVByb3BlcnR5KGEsIGIsCiAgICAgICAgZCwgYywgZSkgewogICAgICAgIGQgPSB0aGlzLl9wcm9wZXJ0eVRyYWNrOwogICAgICAgIGNvbnN0IGcgPSBkLkdldFRyYWNrKCk7CiAgICAgICAgYyA9IGQuR2V0U291cmNlQWRhcHRlcklkKCk7CiAgICAgICAgZSA9IGQuR2V0VGltZWxpbmUoKTsKICAgICAgICB2YXIgayA9IGcuR2V0SW5zdGFuY2UoKTsKICAgICAgICBjb25zdCBtID0gZC5HZXRTb3VyY2VBZGFwdGVyKCk7CiAgICAgICAgKGsgPSBlLkdldFNpbWlsYXJQcm9wZXJ0eVRyYWNrcyhrLCBtLCB0aGlzLl9wcm9wZXJ0eSkpICYmIDEgPCBrLmxlbmd0aCAmJiAoayA9IHRoaXMuX0dldFByb3BlcnR5S2V5ZnJhbWVTdHVicyhrKSwgYSArPSBnLkdldFN0YXJ0T2Zmc2V0KCksIGEgPSB0aGlzLl9HZXRMYXN0UHJvcGVydHlLZXlmcmFtZVN0dWIoZSwgYSwgaykpICYmIChiID0gYS52YWx1ZSk7CiAgICAgICAgc3dpdGNoIChkLkdldFByb3BlcnR5S2V5ZnJhbWVUeXBlKCkpIHsKICAgICAgICAgICAgY2FzZSAibnVtZXJpYyI6CiAgICAgICAgICAgICAgICBpZiAoIU5TJGpzY29tcCQxLk51bWVyaWNUeXBlQWRhcHRlci5XaWxsQ2hhbmdlKHRoaXMuX0dldEluZGV4KCksIHRoaXMuX0dldFRhcmdldCgpLCBiLCBjKSkgcmV0dXJuOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgImFuZ2xlIjoKICAgICAgICAgICAgICAgIGlmICghTlMkanNjb21wJDEuQW5nbGVUeXBlQWRhcHRlci5XaWxsQ2hhbmdlKHRoaXMuX0dldEluZGV4KCksCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX0dldFRhcmdldCgpLCBiLCBjKSkgcmV0dXJuOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgImJvb2xlYW4iOgogICAgICAgICAgICAgICAgaWYgKCFOUyRqc2NvbXAkMS5Cb29sZWFuVHlwZUFkYXB0ZXIuV2lsbENoYW5nZSh0aGlzLl9HZXRJbmRleCgpLCB0aGlzLl9HZXRUYXJnZXQoKSwgYiwgYykpIHJldHVybjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICJjb2xvciI6CiAgICAgICAgICAgICAgICBpZiAoIU5TJGpzY29tcCQxLkNvbG9yVHlwZUFkYXB0ZXIuV2lsbENoYW5nZSh0aGlzLl9HZXRJbmRleCgpLCB0aGlzLl9HZXRUYXJnZXQoKSwgYiwgYykpIHJldHVybjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICJ0ZXh0IjoKICAgICAgICAgICAgICAgIGlmICghTlMkanNjb21wJDEuVGV4dFR5cGVBZGFwdGVyLldpbGxDaGFuZ2UodGhpcy5fR2V0SW5kZXgoKSwgdGhpcy5fR2V0VGFyZ2V0KCksIGIsIGMpKSByZXR1cm4KICAgICAgICB9CiAgICAgICAgdGhpcy5fU2V0dGVyKGIpCiAgICB9CiAgICBfR2V0dGVyKCkgewogICAgICAgIGNvbnN0IGEgPSB0aGlzLl9wcm9wZXJ0eVRyYWNrLkdldFNvdXJjZUFkYXB0ZXJJZCgpLAogICAgICAgICAgICBiID0gdGhpcy5fR2V0VGFyZ2V0KCksCiAgICAgICAgICAgIGQgPSB0aGlzLl9HZXRJbmRleCgpOwogICAgICAgIHN3aXRjaCAoYSkgewogICAgICAgICAgICBjYXNlICJiZWhhdmlvciI6CiAgICAgICAgICAgICAgICByZXR1cm4gYi5HZXRQcm9wZXJ0eVZhbHVlQnlJbmRleChkKTsKICAgICAgICAgICAgY2FzZSAiZWZmZWN0IjoKICAgICAgICAgICAgICAgIHJldHVybiBiW2RdOwogICAgICAgICAgICBjYXNlICJpbnN0YW5jZS12YXJpYWJsZSI6CiAgICAgICAgICAgICAgICByZXR1cm4gYi5HZXRJbnN0YW5jZVZhcmlhYmxlVmFsdWUoZCk7CiAgICAgICAgICAgIGNhc2UgInBsdWdpbiI6CiAgICAgICAgICAgICAgICByZXR1cm4gYi5HZXRQcm9wZXJ0eVZhbHVlQnlJbmRleChkKQogICAgICAgIH0KICAgIH0KICAgIF9TZXR0ZXIoYSkgewogICAgICAgIGNvbnN0IGIgPSB0aGlzLl9wcm9wZXJ0eVRyYWNrLkdldFNvdXJjZUFkYXB0ZXJJZCgpLAogICAgICAgICAgICBkID0gdGhpcy5fR2V0VGFyZ2V0KCksCiAgICAgICAgICAgIGMgPSB0aGlzLl9HZXRJbmRleCgpOwogICAgICAgIHN3aXRjaCAoYikgewogICAgICAgICAgICBjYXNlICJiZWhhdmlvciI6CiAgICAgICAgICAgICAgICBkLlNldFByb3BlcnR5VmFsdWVCeUluZGV4KGMsIGEpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgImVmZmVjdCI6CiAgICAgICAgICAgICAgICBkW2NdID0gYTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICJpbnN0YW5jZS12YXJpYWJsZSI6CiAgICAgICAgICAgICAgICBkLlNldEluc3RhbmNlVmFyaWFibGVWYWx1ZShjLCBhKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICJwbHVnaW4iOgogICAgICAgICAgICAgICAgZC5TZXRQcm9wZXJ0eVZhbHVlQnlJbmRleChjLCBhKQogICAgICAgIH0KICAgIH0KfQpDMyRqc2NvbXAkOTYuUHJvcGVydHlUcmFja1N0YXRlLlByb3BlcnR5SW50ZXJwb2xhdGlvbkFkYXB0ZXIuTm9JbnRlcnBvbGF0aW9uQWRhcHRlciA9IE5vSW50ZXJwb2xhdGlvbkFkYXB0ZXI7CiJ1c2Ugc3RyaWN0IjsKY29uc3QgQzMkanNjb21wJDk3ID0gc2VsZi5DMywKICAgIElOU1RBTkNFX0ZVTkNfTUFQID0gbmV3IE1hcCwKICAgIGFkZCRqc2NvbXAkMSA9IChhLCBiLCBkLCBjLCBlLCBnID0gITEsIGsgPSBudWxsLCBtID0gbnVsbCkgPT4gewogICAgICAgIElOU1RBTkNFX0ZVTkNfTUFQLnNldChhLCB7CiAgICAgICAgICAgIHNldHRlcjogYiwKICAgICAgICAgICAgYWJzb2x1dGVfc2V0dGVyOiBkLAogICAgICAgICAgICBnZXR0ZXI6IGMsCiAgICAgICAgICAgIHJvdW5kOiBlLAogICAgICAgICAgICBmUm91bmQ6IGcsCiAgICAgICAgICAgIGluaXQ6IGssCiAgICAgICAgICAgIHJlc2V0OiBtCiAgICAgICAgfSkKICAgIH07CmFkZCRqc2NvbXAkMSgib2Zmc2V0WCIsIChhLCBiLCBkLCBjKSA9PiB7CiAgICAicmVsYXRpdmUiID09PSBjLl9wcm9wZXJ0eVRyYWNrLkdldFJlc3VsdE1vZGUoKSA/IGEuT2Zmc2V0WChiLCBkLkdldFRpbWVsaW5lKCkuR2V0VHJhbnNmb3JtV2l0aFNjZW5lR3JhcGgoKSkgOiBhLk9mZnNldFgoYikKfSwgKGEsIGIpID0+IGEuU2V0WChiKSwgYSA9PiBhLkdldFgoKSwgITApOwphZGQkanNjb21wJDEoIm9mZnNldFkiLCAoYSwgYiwgZCwgYykgPT4gewogICAgInJlbGF0aXZlIiA9PT0gYy5fcHJvcGVydHlUcmFjay5HZXRSZXN1bHRNb2RlKCkgPyBhLk9mZnNldFkoYiwgZC5HZXRUaW1lbGluZSgpLkdldFRyYW5zZm9ybVdpdGhTY2VuZUdyYXBoKCkpIDogYS5PZmZzZXRZKGIpCn0sIChhLCBiKSA9PiBhLlNldFkoYiksIGEgPT4gYS5HZXRZKCksICEwKTsKYWRkJGpzY29tcCQxKCJvZmZzZXRXaWR0aCIsIChhLCBiLCBkLCBjLCBlKSA9PiB7CiAgICBpZiAoMCAhPT0gYikKICAgICAgICBpZiAoInJlbGF0aXZlIiA9PT0gYy5fcHJvcGVydHlUcmFjay5HZXRSZXN1bHRNb2RlKCkgJiYgYS5IYXNQYXJlbnQoKSAmJiBhLkdldFRyYW5zZm9ybVdpdGhQYXJlbnRXaWR0aCgpKSB7CiAgICAgICAgICAgIGlmIChpc05hTihjLl9hYnNvbHV0ZVRvRmFjdG9yKSkgewogICAgICAgICAgICAgICAgY29uc3QgbiA9IFtdOwogICAgICAgICAgICAgICAgZm9yICh2YXIgZyA9IGEuR2V0UGFyZW50KCk7IGc7KSBuLnB1c2goZyksIGcgPSBnLkdldFBhcmVudCgpOwogICAgICAgICAgICAgICAgbi5yZXZlcnNlKCk7CiAgICAgICAgICAgICAgICBnID0gKHcsIHopID0+IHsKICAgICAgICAgICAgICAgICAgICBpZiAoeiA9IHouR2V0VGltZWxpbmUoKS5HZXRUcmFja0Zyb21JbnN0YW5jZSh3LkdldEluc3RhbmNlKCkpKSByZXR1cm4gei5HZXRPcmlnaW5hbFdpZHRoKCk7CiAgICAgICAgICAgICAgICAgICAgeiA9IHcuR2V0SW5zdGFuY2UoKS5HZXRTZGtJbnN0YW5jZSgpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB6LklzT3JpZ2luYWxTaXplS25vd24oKSA/IHouR2V0T3JpZ2luYWxXaWR0aCgpIDogdy5fR2V0U2NlbmVHcmFwaEluZm8oKS5fR2V0U3RhcnRXaWR0aCgpCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgY29uc3QgcSA9ICh3LCB6LCBDKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgdyA9IHouR2V0VGltZWxpbmUoKS5HZXRUcmFja0Zyb21JbnN0YW5jZSh3LkdldEluc3RhbmNlKCkpOwogICAgICAgICAgICAgICAgICAgIGlmICghdykgcmV0dXJuIDA7CiAgICAgICAgICAgICAgICAgICAgQyA9IHcuR2V0UHJvcGVydHlUcmFjayhDKTsKICAgICAgICAgICAgICAgICAgICBpZiAoIUMpIHJldHVybiAwOwogICAgICAgICAgICAgICAgICAgIEMgPSBDLkdldFByb3BlcnR5VHJhY2tEYXRhSXRlbSgpLkdldFByb3BlcnR5S2V5ZnJhbWVEYXRhKCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEMgPyAoQyA9IEMuR2V0TGFzdFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbSgpKSA/IEMuR2V0VmFsdWUoKSA6IDAgOiAwCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgbGV0IHUgPSBuWzBdOwogICAgICAgICAgICAgICAgdmFyIGsgPSB1Ll9HZXRTY2VuZUdyYXBoSW5mbygpLl9HZXRTdGFydFdpZHRoKCksCiAgICAgICAgICAgICAgICAgICAgbSA9IHUuX0dldFNjZW5lR3JhcGhJbmZvKCkuR2V0U3RhcnRTY2FsZVgoKTsKICAgICAgICAgICAgICAgIGsgKj0gbTsKICAgICAgICAgICAgICAgIGsgKz0gcSh1LCBkLCAib2Zmc2V0V2lkdGgiKTsKICAgICAgICAgICAgICAgIGsgKz0gZyh1LCBkKSAqIHEodSwgZCwgIm9mZnNldFNjYWxlWCIpOwogICAgICAgICAgICAgICAgZm9yIChtID0gMTsgbSA8IG4ubGVuZ3RoOyBtKyspIHUgPSBuW21dLCBrICo9IHUuX0dldFNjZW5lR3JhcGhJbmZvKCkuR2V0U3RhcnRTY2FsZVgoKSwgayArPSBxKHUsIGQsICJvZmZzZXRXaWR0aCIpLCBrICs9IGcodSwgZCkgKiBxKHUsIGQsICJvZmZzZXRTY2FsZVgiKTsKICAgICAgICAgICAgICAgIGMuX2Fic29sdXRlVG9GYWN0b3IgPSAwID09PSBrID8gTnVtYmVyLkVQU0lMT04gOgogICAgICAgICAgICAgICAgICAgIGsKICAgICAgICAgICAgfQogICAgICAgICAgICBlIHx8IGEuT2Zmc2V0V2lkdGgoYiAvIGMuX2Fic29sdXRlVG9GYWN0b3IsICEwKQogICAgICAgIH0gZWxzZSBhLk9mZnNldFdpZHRoKGIpCn0sIChhLCBiKSA9PiBhLlNldFdpZHRoKGIpLCBhID0+IGEuR2V0V2lkdGgoKSwgITApOwphZGQkanNjb21wJDEoIm9mZnNldEhlaWdodCIsIChhLCBiLCBkLCBjLCBlKSA9PiB7CiAgICBpZiAoMCAhPT0gYikKICAgICAgICBpZiAoInJlbGF0aXZlIiA9PT0gYy5fcHJvcGVydHlUcmFjay5HZXRSZXN1bHRNb2RlKCkgJiYgYS5IYXNQYXJlbnQoKSAmJiBhLkdldFRyYW5zZm9ybVdpdGhQYXJlbnRIZWlnaHQoKSkgewogICAgICAgICAgICBpZiAoaXNOYU4oYy5fYWJzb2x1dGVUb0ZhY3RvcikpIHsKICAgICAgICAgICAgICAgIGNvbnN0IG4gPSBbXTsKICAgICAgICAgICAgICAgIGZvciAodmFyIGcgPSBhLkdldFBhcmVudCgpOyBnOykgbi5wdXNoKGcpLCBnID0gZy5HZXRQYXJlbnQoKTsKICAgICAgICAgICAgICAgIG4ucmV2ZXJzZSgpOwogICAgICAgICAgICAgICAgZyA9ICh3LCB6KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHogPSB6LkdldFRpbWVsaW5lKCkuR2V0VHJhY2tGcm9tSW5zdGFuY2Uody5HZXRJbnN0YW5jZSgpKSkgcmV0dXJuIHouR2V0T3JpZ2luYWxIZWlnaHQoKTsKICAgICAgICAgICAgICAgICAgICB6ID0gdy5HZXRJbnN0YW5jZSgpLkdldFNka0luc3RhbmNlKCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHouSXNPcmlnaW5hbFNpemVLbm93bigpID8gei5HZXRPcmlnaW5hbEhlaWdodCgpIDogdy5fR2V0U2NlbmVHcmFwaEluZm8oKS5fR2V0U3RhcnRIZWlnaHQoKQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIGNvbnN0IHEgPSAodywgeiwgQykgPT4gewogICAgICAgICAgICAgICAgICAgIHcgPSB6LkdldFRpbWVsaW5lKCkuR2V0VHJhY2tGcm9tSW5zdGFuY2Uody5HZXRJbnN0YW5jZSgpKTsKICAgICAgICAgICAgICAgICAgICBpZiAoIXcpIHJldHVybiAwOwogICAgICAgICAgICAgICAgICAgIEMgPSB3LkdldFByb3BlcnR5VHJhY2soQyk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFDKSByZXR1cm4gMDsKICAgICAgICAgICAgICAgICAgICBDID0gQy5HZXRQcm9wZXJ0eVRyYWNrRGF0YUl0ZW0oKS5HZXRQcm9wZXJ0eUtleWZyYW1lRGF0YSgpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBDID8gKEMgPSBDLkdldExhc3RQcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW0oKSkgPyBDLkdldFZhbHVlKCkgOiAwIDogMAogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIGxldCB1ID0gblswXTsKICAgICAgICAgICAgICAgIHZhciBrID0gdS5fR2V0U2NlbmVHcmFwaEluZm8oKS5fR2V0U3RhcnRIZWlnaHQoKSwKICAgICAgICAgICAgICAgICAgICBtID0gdS5fR2V0U2NlbmVHcmFwaEluZm8oKS5HZXRTdGFydFNjYWxlWSgpOwogICAgICAgICAgICAgICAgayAqPSBtOwogICAgICAgICAgICAgICAgayArPSBxKHUsIGQsICJvZmZzZXRIZWlnaHQiKTsKICAgICAgICAgICAgICAgIGsgKz0gZyh1LCBkKSAqIHEodSwgZCwgIm9mZnNldFNjYWxlWSIpOwogICAgICAgICAgICAgICAgZm9yIChtID0gMTsgbSA8IG4ubGVuZ3RoOyBtKyspIHUgPSBuW21dLCBrICo9IHUuX0dldFNjZW5lR3JhcGhJbmZvKCkuR2V0U3RhcnRTY2FsZVkoKSwgayArPSBxKHUsIGQpLCBrICs9IGcodSwgZCkgKiBxKHUsIGQsICJvZmZzZXRTY2FsZVkiKTsKICAgICAgICAgICAgICAgIGMuX2Fic29sdXRlVG9GYWN0b3IgPSAwID09PSBrID8gTnVtYmVyLkVQU0lMT04gOiBrCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZSB8fCBhLk9mZnNldEhlaWdodChiIC8gYy5fYWJzb2x1dGVUb0ZhY3RvciwgITApCiAgICAgICAgfSBlbHNlIGEuT2Zmc2V0SGVpZ2h0KGIpCn0sIChhLCBiKSA9PiBhLlNldEhlaWdodChiKSwgYSA9PiBhLkdldEhlaWdodCgpLCAhMCk7CmFkZCRqc2NvbXAkMSgib2Zmc2V0QW5nbGUiLCAoYSwgYikgPT4gYS5PZmZzZXRBbmdsZShiKSwgKGEsIGIpID0+IGEuU2V0QW5nbGUoYiksIGEgPT4gYS5HZXRBbmdsZSgpLCAhMSk7CmFkZCRqc2NvbXAkMSgib2Zmc2V0T3BhY2l0eSIsIChhLCBiLCBkLCBjKSA9PiB7CiAgICAgICAgZCA9IGEuR2V0T3BhY2l0eSgpICsgYjsKICAgICAgICAwID09PSBjLl9jbGFtcEFjY3VtdWxhdG9yID8gKDEgPCBkID8gYy5fY2xhbXBBY2N1bXVsYXRvciArPSBkIC0gMSA6IDAgPiBkICYmIChjLl9jbGFtcEFjY3VtdWxhdG9yICs9IGQpLCBhLk9mZnNldE9wYWNpdHkoYikpIDogKGEgPSBhLkdldE9wYWNpdHkoKSArIGIsIDAgPCBiICYmIDAgPCBjLl9jbGFtcEFjY3VtdWxhdG9yID8gMSA8IGEgJiYgKGMuX2NsYW1wQWNjdW11bGF0b3IgKz0gYSAtIDEpIDogMCA8IGIgJiYgMCA+IGMuX2NsYW1wQWNjdW11bGF0b3IgPyAoYy5fY2xhbXBBY2N1bXVsYXRvciArPSBiLCAwIDwgYy5fY2xhbXBBY2N1bXVsYXRvciAmJiAoYy5fY2xhbXBBY2N1bXVsYXRvciA9IDApKSA6IDAgPiBiICYmIDAgPCBjLl9jbGFtcEFjY3VtdWxhdG9yID8gKGMuX2NsYW1wQWNjdW11bGF0b3IgKz0gYiwgMCA+IGMuX2NsYW1wQWNjdW11bGF0b3IgJiYgKGMuX2NsYW1wQWNjdW11bGF0b3IgPSAwKSkgOiAwID4gYiAmJiAwID4gYy5fY2xhbXBBY2N1bXVsYXRvciAmJiAwID4gYSAmJiAoYy5fY2xhbXBBY2N1bXVsYXRvciArPSBhKSkKICAgIH0sCiAgICAoYSwgYikgPT4gewogICAgICAgIGEuU2V0T3BhY2l0eShiKQogICAgfSwgYSA9PiBhLkdldE9wYWNpdHkoKSwgITEsICEwLCBhID0+IHsKICAgICAgICBhLl9jbGFtcEFjY3VtdWxhdG9yID0gMDsKICAgICAgICBzd2l0Y2ggKGEuX3Byb3BlcnR5VHJhY2suR2V0UmVzdWx0TW9kZSgpKSB7CiAgICAgICAgICAgIGNhc2UgInJlbGF0aXZlIjoKICAgICAgICAgICAgICAgIGEuX3Byb3BlcnR5VHJhY2suR2V0UHJvcGVydHlUcmFja0RhdGEoKTsKICAgICAgICAgICAgICAgIGNvbnN0IGUgPSBhLl9wcm9wZXJ0eVRyYWNrLkdldFByb3BlcnR5VHJhY2tEYXRhSXRlbSgpLkdldFByb3BlcnR5S2V5ZnJhbWVEYXRhKCkuR2V0UHJvcGVydHlLZXlmcmFtZURhdGFJdGVtQXJyYXkoKTsKICAgICAgICAgICAgICAgIHZhciBiID0gYS5HZXRXb3JsZEluZm8oKS5HZXRPcGFjaXR5KCksCiAgICAgICAgICAgICAgICAgICAgZCA9IGI7CiAgICAgICAgICAgICAgICBmb3IgKHZhciBjIG9mIGUpIGQgPSBjLkdldFRpbWUoKSwgZCA9IGEuX3Byb3BlcnR5VHJhY2suR2V0SW50ZXJwb2xhdGVkVmFsdWUoZCksIGQgPSBiICsgZCwgZCA9IEMzJGpzY29tcCQ5Ny5jbGFtcChkLCAwLCAxKTsKICAgICAgICAgICAgICAgIGEuX3RvdGFsRm9yZXdhcmRPcGFjaXR5RGVsdGEgPSBiIC0gZDsKICAgICAgICAgICAgICAgIGEuX3RvdGFsRm9yZXdhcmRPcGFjaXR5RGVsdGEgPSBNYXRoLnJvdW5kKDEwMCAqCiAgICAgICAgICAgICAgICAgICAgKGEuX3RvdGFsRm9yZXdhcmRPcGFjaXR5RGVsdGEgKyBOdW1iZXIuRVBTSUxPTikpIC8gMTAwOwogICAgICAgICAgICAgICAgZCA9IGI7CiAgICAgICAgICAgICAgICBmb3IgKGIgPSBlLmxlbmd0aCAtIDE7IDAgPD0gYjsgYi0tKSBjID0gZVtiXS5HZXRUaW1lKCksIGMgPSBhLl9wcm9wZXJ0eVRyYWNrLkdldEludGVycG9sYXRlZFZhbHVlKGMpLCBkIC09IGMsIGQgPSBDMyRqc2NvbXAkOTcuY2xhbXAoZCwgMCwgMSk7CiAgICAgICAgICAgICAgICBhLl90b3RhbEJhY2t3YXJkT3BhY2l0eURlbHRhID0gZDsKICAgICAgICAgICAgICAgIGEuX3RvdGFsQmFja3dhcmRPcGFjaXR5RGVsdGEgPSBNYXRoLnJvdW5kKDEwMCAqIChhLl90b3RhbEJhY2t3YXJkT3BhY2l0eURlbHRhICsgTnVtYmVyLkVQU0lMT04pKSAvIDEwMAogICAgICAgIH0KICAgIH0sIGEgPT4gewogICAgICAgIHN3aXRjaCAoYS5fcHJvcGVydHlUcmFjay5HZXRSZXN1bHRNb2RlKCkpIHsKICAgICAgICAgICAgY2FzZSAicmVsYXRpdmUiOgogICAgICAgICAgICAgICAgYS5fY2xhbXBBY2N1bXVsYXRvciA9IDA7CiAgICAgICAgICAgICAgICBjb25zdCBiID0gYS5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgICAgIGxldCBkID0gYi5HZXRPcGFjaXR5KCk7CiAgICAgICAgICAgICAgICBkID0gTWF0aC5yb3VuZCgxMDAgKiAoZCArIE51bWJlci5FUFNJTE9OKSkgLyAxMDA7CiAgICAgICAgICAgICAgICBhLl9wcm9wZXJ0eVRyYWNrLkdldFRpbWVsaW5lKCkuSXNGb3J3YXJkUGxheUJhY2soKSA/CiAgICAgICAgICAgICAgICAgICAgKGIuU2V0T3BhY2l0eShkICsgYS5fdG90YWxGb3Jld2FyZE9wYWNpdHlEZWx0YSksIGEuX2xhc3RWYWx1ZSA9IDApIDogKGIuU2V0T3BhY2l0eShkIC0gYS5fdG90YWxCYWNrd2FyZE9wYWNpdHlEZWx0YSksIGEuX2xhc3RWYWx1ZSA9IGEuR2V0U291cmNlQWRhcHRlcigpLkdldFZhbHVlQXRUaW1lKCkpCiAgICAgICAgfQogICAgfSk7CmFkZCRqc2NvbXAkMSgib2Zmc2V0T3JpZ2luWCIsIChhLCBiKSA9PiBhLk9mZnNldE9yaWdpblgoYiksIChhLCBiKSA9PiBhLlNldE9yaWdpblgoYiksIGEgPT4gYS5HZXRPcmlnaW5YKCksICExKTsKYWRkJGpzY29tcCQxKCJvZmZzZXRPcmlnaW5ZIiwgKGEsIGIpID0+IGEuT2Zmc2V0T3JpZ2luWShiKSwgKGEsIGIpID0+IGEuU2V0T3JpZ2luWShiKSwgYSA9PiBhLkdldE9yaWdpblkoKSwgITEpOwphZGQkanNjb21wJDEoIm9mZnNldFpFbGV2YXRpb24iLCAoYSwgYikgPT4gYS5PZmZzZXRaRWxldmF0aW9uKGIpLCAoYSwgYikgPT4gYS5TZXRaRWxldmF0aW9uKGIpLCBhID0+IGEuR2V0WkVsZXZhdGlvbigpLCAhMCk7CmFkZCRqc2NvbXAkMSgib2Zmc2V0U2NhbGVYIiwgKGEsIGIsIGQsIGMpID0+IHsKICAgIGlmICgwICE9PSBiKSB7CiAgICAgICAgdmFyIGUgPSAwID4gYS5HZXRXaWR0aCgpID8gLTEgOiAxOwogICAgICAgICJyZWxhdGl2ZSIgPT09IGMuX3Byb3BlcnR5VHJhY2suR2V0UmVzdWx0TW9kZSgpICYmIGEuSGFzUGFyZW50KCkgJiYgYS5HZXRUcmFuc2Zvcm1XaXRoUGFyZW50V2lkdGgoKSA/IChiICo9IGQuR2V0T3JpZ2luYWxXaWR0aCgpICogZSwgaXNOYU4oYy5fYWJzb2x1dGVUb0ZhY3RvcikgJiYgSU5TVEFOQ0VfRlVOQ19NQVAuZ2V0KCJvZmZzZXRXaWR0aCIpLnNldHRlcihhLCAxLCBkLCBjLCAhMCksIGEuT2Zmc2V0V2lkdGgoYiAvIGMuX2Fic29sdXRlVG9GYWN0b3IsICEwKSkgOiBhLk9mZnNldFdpZHRoKGQuR2V0T3JpZ2luYWxXaWR0aCgpICogZSAqIGIpCiAgICB9Cn0sIChhLCBiLCBkKSA9PiB7CiAgICBhLlNldFdpZHRoKGQuR2V0T3JpZ2luYWxXaWR0aCgpICogYikKfSwgKGEsIGIpID0+IHsKICAgIGNvbnN0IGQgPSAwID4gYS5HZXRXaWR0aCgpID8gLTEgOiAxOwogICAgaWYgKGEuR2V0VHJhbnNmb3JtV2l0aFBhcmVudFdpZHRoKCkpIHsKICAgICAgICB2YXIgYyA9IGEuR2V0UGFyZW50KCksCiAgICAgICAgICAgIGUgPSBiLkdldFRpbWVsaW5lKCkuR2V0VHJhY2tGcm9tSW5zdGFuY2UoYy5HZXRJbnN0YW5jZSgpKTsKICAgICAgICBlID8gYyA9IGMuR2V0V2lkdGgoKSAvIGUuR2V0T3JpZ2luYWxXaWR0aCgpIDogKGUgPSBjLkdldEluc3RhbmNlKCkuR2V0U2RrSW5zdGFuY2UoKSwgYyA9IGUuSXNPcmlnaW5hbFNpemVLbm93bigpID8gYy5HZXRXaWR0aCgpIC8gZS5HZXRPcmlnaW5hbFdpZHRoKCkgOiAxKTsKICAgICAgICByZXR1cm4gYS5HZXRXaWR0aCgpICogZCAvIChiLkdldE9yaWdpbmFsV2lkdGgoKSAqIGMpCiAgICB9CiAgICByZXR1cm4gYS5HZXRXaWR0aCgpICogZCAvIGIuR2V0T3JpZ2luYWxXaWR0aCgpCn0sICExKTsKYWRkJGpzY29tcCQxKCJvZmZzZXRTY2FsZVkiLCAoYSwgYiwgZCwgYykgPT4gewogICAgaWYgKDAgIT09IGIpIHsKICAgICAgICB2YXIgZSA9IDAgPiBhLkdldEhlaWdodCgpID8gLTEgOiAxOwogICAgICAgICJyZWxhdGl2ZSIgPT09IGMuX3Byb3BlcnR5VHJhY2suR2V0UmVzdWx0TW9kZSgpICYmIGEuSGFzUGFyZW50KCkgJiYgYS5HZXRUcmFuc2Zvcm1XaXRoUGFyZW50SGVpZ2h0KCkgPyAoYiAqPSBkLkdldE9yaWdpbmFsSGVpZ2h0KCkgKiBlLCBpc05hTihjLl9hYnNvbHV0ZVRvRmFjdG9yKSAmJiBJTlNUQU5DRV9GVU5DX01BUC5nZXQoIm9mZnNldEhlaWdodCIpLnNldHRlcihhLCAxLCBkLCBjLCAhMCksIGEuT2Zmc2V0SGVpZ2h0KGIgLyBjLl9hYnNvbHV0ZVRvRmFjdG9yLCAhMCkpIDogYS5PZmZzZXRIZWlnaHQoZC5HZXRPcmlnaW5hbEhlaWdodCgpICogZSAqIGIpCiAgICB9Cn0sIChhLCBiLCBkKSA9PiB7CiAgICBhLlNldEhlaWdodChkLkdldE9yaWdpbmFsSGVpZ2h0KCkgKiBiKQp9LCAoYSwgYikgPT4gewogICAgY29uc3QgZCA9IDAgPiBhLkdldEhlaWdodCgpID8gLTEgOiAxOwogICAgaWYgKGEuR2V0VHJhbnNmb3JtV2l0aFBhcmVudEhlaWdodCgpKSB7CiAgICAgICAgdmFyIGMgPSBhLkdldFBhcmVudCgpLAogICAgICAgICAgICBlID0gYi5HZXRUaW1lbGluZSgpLkdldFRyYWNrRnJvbUluc3RhbmNlKGMuR2V0SW5zdGFuY2UoKSk7CiAgICAgICAgZSA/IGMgPSBjLkdldEhlaWdodCgpIC8gZS5HZXRPcmlnaW5hbEhlaWdodCgpIDogKGUgPSBjLkdldEluc3RhbmNlKCkuR2V0U2RrSW5zdGFuY2UoKSwgYyA9IGUuSXNPcmlnaW5hbFNpemVLbm93bigpID8gYy5HZXRIZWlnaHQoKSAvIGUuR2V0T3JpZ2luYWxIZWlnaHQoKSA6IDEpOwogICAgICAgIHJldHVybiBhLkdldEhlaWdodCgpICogZCAvIChiLkdldE9yaWdpbmFsSGVpZ2h0KCkgKiBjKQogICAgfQogICAgcmV0dXJuIGEuR2V0SGVpZ2h0KCkgKiBkIC8gYi5HZXRPcmlnaW5hbEhlaWdodCgpCn0sICExKTsKY2xhc3MgTnVtZXJpY0ludGVycG9sYXRpb25BZGFwdGVyIGV4dGVuZHMgQzMkanNjb21wJDk3LlByb3BlcnR5VHJhY2tTdGF0ZS5Qcm9wZXJ0eUludGVycG9sYXRpb25BZGFwdGVyIHsKICAgIGNvbnN0cnVjdG9yKGEpIHsKICAgICAgICBzdXBlcihhKTsKICAgICAgICB0aGlzLl90b3RhbEJhY2t3YXJkT3BhY2l0eURlbHRhID0gdGhpcy5fdG90YWxGb3Jld2FyZE9wYWNpdHlEZWx0YSA9IHRoaXMuX2NsYW1wQWNjdW11bGF0b3IgPSB0aGlzLl9sYXN0VmFsdWUgPSAwOwogICAgICAgIHRoaXMuX2Fic29sdXRlVG9GYWN0b3IgPSBOYU47CiAgICAgICAgdGhpcy5fc291cmNlX2FkYXB0ZXJfYWJzb2x1dGVfc2V0dGVyID0gdGhpcy5fc291cmNlX2FkYXB0ZXJfc2V0dGVyID0gdGhpcy5fc291cmNlX2FkYXB0ZXJfZ2V0dGVyID0gdGhpcy5faW5pdF9hY3Rpb24gPSB0aGlzLl9yZXNldF9hY3Rpb24gPSB0aGlzLl9pbnN0YW5jZV9hYnNvbHV0ZV9zZXR0ZXIgPSB0aGlzLl9pbnN0YW5jZV9zZXR0ZXIgPSB0aGlzLl9pbnN0YW5jZV9nZXR0ZXIgPSBudWxsOwogICAgICAgIHRoaXMuX2ZSb3VuZCA9IHRoaXMuX3JvdW5kID0gITE7CiAgICAgICAgQzMkanNjb21wJDk3LklzSW5zdGFuY2VPZih0aGlzLl9wcm9wZXJ0eVRyYWNrLkdldFRpbWVsaW5lKCksCiAgICAgICAgICAgIEMzJGpzY29tcCQ5Ny5Ud2VlblN0YXRlKSA/IHRoaXMuX3R5cGVBZGFwdGVyID0gbmV3IEMzJGpzY29tcCQ5Ny5Qcm9wZXJ0eVRyYWNrU3RhdGUuUHJvcGVydHlJbnRlcnBvbGF0aW9uQWRhcHRlci5OdW1lcmljSW50ZXJwb2xhdGlvbkFkYXB0ZXJGb3JUd2Vlbih0aGlzKSA6IHRoaXMuX3R5cGVBZGFwdGVyID0gbmV3IEMzJGpzY29tcCQ5Ny5Qcm9wZXJ0eVRyYWNrU3RhdGUuUHJvcGVydHlJbnRlcnBvbGF0aW9uQWRhcHRlci5OdW1lcmljSW50ZXJwb2xhdGlvbkFkYXB0ZXJGb3JUaW1lbGluZSh0aGlzKTsKICAgICAgICBjb25zdCBiID0gdGhpcy5fcHJvcGVydHlUcmFjay5HZXRQcm9wZXJ0eU5hbWUoKTsKICAgICAgICBzd2l0Y2ggKHRoaXMuX3Byb3BlcnR5VHJhY2suR2V0U291cmNlQWRhcHRlcklkKCkpIHsKICAgICAgICAgICAgY2FzZSAid29ybGQtaW5zdGFuY2UiOgogICAgICAgICAgICAgICAgYSA9IElOU1RBTkNFX0ZVTkNfTUFQLmdldChiKTsKICAgICAgICAgICAgICAgIHRoaXMuX2luc3RhbmNlX2dldHRlciA9IGEuZ2V0dGVyOwogICAgICAgICAgICAgICAgdGhpcy5faW5zdGFuY2Vfc2V0dGVyID0gYS5zZXR0ZXI7CiAgICAgICAgICAgICAgICB0aGlzLl9pbnN0YW5jZV9hYnNvbHV0ZV9zZXR0ZXIgPQogICAgICAgICAgICAgICAgICAgIGEuYWJzb2x1dGVfc2V0dGVyOwogICAgICAgICAgICAgICAgdGhpcy5fcm91bmQgPSBhLnJvdW5kOwogICAgICAgICAgICAgICAgdGhpcy5fZlJvdW5kID0gYS5mUm91bmQ7CiAgICAgICAgICAgICAgICB0aGlzLl9pbml0X2FjdGlvbiA9IGEuaW5pdDsKICAgICAgICAgICAgICAgIHRoaXMuX3Jlc2V0X2FjdGlvbiA9IGEucmVzZXQ7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAiYXVkaW8iOgogICAgICAgICAgICAgICAgdGhpcy5fc291cmNlX2FkYXB0ZXJfZ2V0dGVyID0gYS5HZXR0ZXIsIHRoaXMuX3NvdXJjZV9hZGFwdGVyX3NldHRlciA9IGEuU2V0dGVyLCB0aGlzLl9zb3VyY2VfYWRhcHRlcl9hYnNvbHV0ZV9zZXR0ZXIgPSBhLkFic29sdXRlU2V0dGVyLCB0aGlzLl9yb3VuZCA9ICEhYS5Eb2VzUm91bmRpbmcoKSwgdGhpcy5fZlJvdW5kID0gITEKICAgICAgICB9CiAgICB9CiAgICBSZWxlYXNlKCkgewogICAgICAgIHRoaXMuX2luc3RhbmNlX2Fic29sdXRlX3NldHRlciA9IHRoaXMuX2luc3RhbmNlX3NldHRlciA9IHRoaXMuX2luc3RhbmNlX2dldHRlciA9IHRoaXMuX3R5cGVBZGFwdGVyID0gbnVsbDsKICAgICAgICB0aGlzLl9hYnNvbHV0ZVRvRmFjdG9yID0gTmFOOwogICAgICAgIHN1cGVyLlJlbGVhc2UoKQogICAgfQogICAgTWF5TmVlZEJlZm9yZUFuZEFmdGVySW50ZXJwb2xhdGUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3R5cGVBZGFwdGVyLk1heU5lZWRCZWZvcmVBbmRBZnRlckludGVycG9sYXRlKCkKICAgIH0KICAgIEdldExhc3RWYWx1ZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fbGFzdFZhbHVlCiAgICB9CiAgICBTZXRMYXN0VmFsdWUoYSkgewogICAgICAgIHRoaXMuX2xhc3RWYWx1ZSA9CiAgICAgICAgICAgIGEKICAgIH0KICAgIFNldFJlc2V0U3RhdGUoKSB7CiAgICAgICAgdGhpcy5fcmVzZXRfYWN0aW9uICYmIHRoaXMuX3Jlc2V0X2FjdGlvbih0aGlzKQogICAgfQogICAgU2V0SW5pdGlhbFN0YXRlKCkgewogICAgICAgIGNvbnN0IGEgPSB0aGlzLl90eXBlQWRhcHRlci5TZXRJbml0aWFsU3RhdGUoKTsKICAgICAgICAibnVtYmVyIiA9PT0gdHlwZW9mIGEgJiYgKHRoaXMuX2xhc3RWYWx1ZSA9IGEpOwogICAgICAgIHRoaXMuX2luaXRfYWN0aW9uICYmIHRoaXMuX2luaXRfYWN0aW9uKHRoaXMpCiAgICB9CiAgICBTZXRSZXN1bWVTdGF0ZSgpIHsKICAgICAgICBjb25zdCBhID0gdGhpcy5fdHlwZUFkYXB0ZXIuU2V0UmVzdW1lU3RhdGUoKTsKICAgICAgICAibnVtYmVyIiA9PT0gdHlwZW9mIGEgJiYgKHRoaXMuX2xhc3RWYWx1ZSA9IGEpCiAgICB9CiAgICBHZXRDdXJyZW50U3RhdGUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX0dldHRlcigpCiAgICB9CiAgICBDb21wYXJlSW5pdGlhbFN0YXRlV2l0aEN1cnJlbnQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX0ZpcnN0S2V5ZnJhbWVHZXR0ZXIoKSAhPT0gdGhpcy5HZXRDdXJyZW50U3RhdGUoKQogICAgfQogICAgQ29tcGFyZVNhdmVTdGF0ZVdpdGhDdXJyZW50KCkgewogICAgICAgIHJldHVybiBDMyRqc2NvbXAkOTcuSXNOdWxsT3JVbmRlZmluZWQodGhpcy5fc2F2ZVN0YXRlKSA/CiAgICAgICAgICAgICExIDogdGhpcy5fc2F2ZVN0YXRlICE9PSB0aGlzLkdldEN1cnJlbnRTdGF0ZSgpCiAgICB9CiAgICBCZWZvcmVDaGFuZ2VQcm9wZXJ0eSgpIHsKICAgICAgICB0aGlzLl90eXBlQWRhcHRlci5CZWZvcmVDaGFuZ2VQcm9wZXJ0eSgpCiAgICB9CiAgICBDaGFuZ2VQcm9wZXJ0eShhLCBiLCBkLCBjLCBlLCBnLCBrKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3R5cGVBZGFwdGVyLkNoYW5nZVByb3BlcnR5KGEsIGIsIGQsIGMsIGUsIGcsIGspCiAgICB9CiAgICBBZnRlckNoYW5nZVByb3BlcnR5KCkgewogICAgICAgIHRoaXMuX3R5cGVBZGFwdGVyLkFmdGVyQ2hhbmdlUHJvcGVydHkoKQogICAgfQogICAgX0dldHRlcigpIHsKICAgICAgICBjb25zdCBhID0gdGhpcy5fR2V0VGFyZ2V0KCksCiAgICAgICAgICAgIGIgPSB0aGlzLl9HZXRJbmRleCgpLAogICAgICAgICAgICBkID0gdGhpcy5HZXRXb3JsZEluZm8oKSwKICAgICAgICAgICAgYyA9IHRoaXMuX3Byb3BlcnR5VHJhY2suR2V0VHJhY2soKTsKICAgICAgICBzd2l0Y2ggKHRoaXMuX3Byb3BlcnR5VHJhY2suR2V0U291cmNlQWRhcHRlcklkKCkpIHsKICAgICAgICAgICAgY2FzZSAiYmVoYXZpb3IiOgogICAgICAgICAgICAgICAgcmV0dXJuIGEuR2V0UHJvcGVydHlWYWx1ZUJ5SW5kZXgoYik7CiAgICAgICAgICAgIGNhc2UgImVmZmVjdCI6CiAgICAgICAgICAgICAgICByZXR1cm4gYVtiXTsKICAgICAgICAgICAgY2FzZSAiaW5zdGFuY2UtdmFyaWFibGUiOgogICAgICAgICAgICAgICAgcmV0dXJuIGEuR2V0SW5zdGFuY2VWYXJpYWJsZVZhbHVlKGIpOwogICAgICAgICAgICBjYXNlICJwbHVnaW4iOgogICAgICAgICAgICAgICAgcmV0dXJuIGEuR2V0UHJvcGVydHlWYWx1ZUJ5SW5kZXgoYik7CiAgICAgICAgICAgIGNhc2UgIndvcmxkLWluc3RhbmNlIjoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9pbnN0YW5jZV9nZXR0ZXIoZCwgYyk7CiAgICAgICAgICAgIGNhc2UgImF1ZGlvIjoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9zb3VyY2VfYWRhcHRlcl9nZXR0ZXIuY2FsbCh0aGlzLkdldFNvdXJjZUFkYXB0ZXIoKSwgZCwgYykKICAgICAgICB9CiAgICB9CiAgICBfU2V0dGVyKGEsIGIsIGQpIHsKICAgICAgICBiID0gdGhpcy5fR2V0VGFyZ2V0KCk7CiAgICAgICAgZCA9IHRoaXMuX0dldEluZGV4KCk7CiAgICAgICAgY29uc3QgYyA9IHRoaXMuR2V0V29ybGRJbmZvKCksCiAgICAgICAgICAgIGUgPSB0aGlzLl9wcm9wZXJ0eVRyYWNrLkdldFRyYWNrKCk7CiAgICAgICAgc3dpdGNoICh0aGlzLl9wcm9wZXJ0eVRyYWNrLkdldFNvdXJjZUFkYXB0ZXJJZCgpKSB7CiAgICAgICAgICAgIGNhc2UgImJlaGF2aW9yIjoKICAgICAgICAgICAgICAgIGIuT2Zmc2V0UHJvcGVydHlWYWx1ZUJ5SW5kZXgoZCwgYSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAiZWZmZWN0IjoKICAgICAgICAgICAgICAgIGJbZF0gKz0gYTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICJpbnN0YW5jZS12YXJpYWJsZSI6CiAgICAgICAgICAgICAgICBiLlNldEluc3RhbmNlVmFyaWFibGVPZmZzZXQoZCwgYSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAicGx1Z2luIjoKICAgICAgICAgICAgICAgIGIuT2Zmc2V0UHJvcGVydHlWYWx1ZUJ5SW5kZXgoZCwgYSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAid29ybGQtaW5zdGFuY2UiOgogICAgICAgICAgICAgICAgdGhpcy5faW5zdGFuY2Vfc2V0dGVyKGMsIGEsIGUsIHRoaXMpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgImF1ZGlvIjoKICAgICAgICAgICAgICAgIHRoaXMuX3NvdXJjZV9hZGFwdGVyX3NldHRlci5jYWxsKHRoaXMuR2V0U291cmNlQWRhcHRlcigpLCBjLCBhLCBlLCB0aGlzKQogICAgICAgIH0KICAgIH0KICAgIF9TZXR0ZXJBYnNvbHV0ZShhLCBiLCBkKSB7CiAgICAgICAgYiA9IHRoaXMuX0dldFRhcmdldCgpOwogICAgICAgIGQgPSB0aGlzLl9HZXRJbmRleCgpOwogICAgICAgIGNvbnN0IGMgPSB0aGlzLkdldFdvcmxkSW5mbygpLAogICAgICAgICAgICBlID0gdGhpcy5fcHJvcGVydHlUcmFjay5HZXRUcmFjaygpOwogICAgICAgIHN3aXRjaCAodGhpcy5fcHJvcGVydHlUcmFjay5HZXRTb3VyY2VBZGFwdGVySWQoKSkgewogICAgICAgICAgICBjYXNlICJiZWhhdmlvciI6CiAgICAgICAgICAgICAgICBiLlNldFByb3BlcnR5VmFsdWVCeUluZGV4KGQsIGEpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgImVmZmVjdCI6CiAgICAgICAgICAgICAgICBiW2RdID0gYTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICJpbnN0YW5jZS12YXJpYWJsZSI6CiAgICAgICAgICAgICAgICBiLlNldEluc3RhbmNlVmFyaWFibGVWYWx1ZShkLAogICAgICAgICAgICAgICAgICAgIGEpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgInBsdWdpbiI6CiAgICAgICAgICAgICAgICBiLlNldFByb3BlcnR5VmFsdWVCeUluZGV4KGQsIGEpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgIndvcmxkLWluc3RhbmNlIjoKICAgICAgICAgICAgICAgIHRoaXMuX2luc3RhbmNlX2Fic29sdXRlX3NldHRlcihjLCBhLCBlKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICJhdWRpbyI6CiAgICAgICAgICAgICAgICB0aGlzLl9zb3VyY2VfYWRhcHRlcl9hYnNvbHV0ZV9zZXR0ZXIuY2FsbCh0aGlzLkdldFNvdXJjZUFkYXB0ZXIoKSwgYywgYSwgZSkKICAgICAgICB9CiAgICB9CiAgICBfTWF5YmVFbnN1cmVWYWx1ZShhLCBiLCBkLCBjLCBlLCBnKSB7CiAgICAgICAgdGhpcy5fdHlwZUFkYXB0ZXIuX01heWJlRW5zdXJlVmFsdWUoYSwgYiwgZCwgYywgZSwgZykKICAgIH0KICAgIF9BZGREZWx0YShhLCBiLCBkKSB7CiAgICAgICAgdmFyIGMgPSAoYS50b1N0cmluZygpLnNwbGl0KCIuIilbMV0gfHwgIiIpLmxlbmd0aDsKICAgICAgICBhID0gdGhpcy5fR2V0dGVyKCk7CiAgICAgICAgYyA9IDAgPT09IGMgPyB0aGlzLl9yb3VuZCA/IE1hdGgucm91bmQoYSkgOiB0aGlzLl9mUm91bmQgPyBNYXRoLnJvdW5kKDEwMCAqIChhICsgTnVtYmVyLkVQU0lMT04pKSAvIDEwMCA6IGEgOiB0aGlzLl9yb3VuZCA/IE51bWJlcihDMyRqc2NvbXAkOTcudG9GaXhlZChhLAogICAgICAgICAgICBjKSkgOiBhOwogICAgICAgIHRoaXMuX1NldHRlcihjIC0gYSwgYiwgZCkKICAgIH0KICAgIF9TYXZlVG9Kc29uKCkgewogICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKHN1cGVyLl9TYXZlVG9Kc29uKCksIHsKICAgICAgICAgICAgdjogdGhpcy5fbGFzdFZhbHVlLAogICAgICAgICAgICBhOiB0aGlzLl9jbGFtcEFjY3VtdWxhdG9yLAogICAgICAgICAgICBmb2Q6IHRoaXMuX3RvdGFsRm9yZXdhcmRPcGFjaXR5RGVsdGEsCiAgICAgICAgICAgIGJvZDogdGhpcy5fdG90YWxCYWNrd2FyZE9wYWNpdHlEZWx0YQogICAgICAgIH0pCiAgICB9CiAgICBfTG9hZEZyb21Kc29uKGEpIHsKICAgICAgICBhICYmIChzdXBlci5fTG9hZEZyb21Kc29uKGEpLCB0aGlzLl9sYXN0VmFsdWUgPSBhLnYsIHRoaXMuX2NsYW1wQWNjdW11bGF0b3IgPSBhLmEsIHRoaXMuX3RvdGFsRm9yZXdhcmRPcGFjaXR5RGVsdGEgPSBDMyRqc2NvbXAkOTcuSXNGaW5pdGVOdW1iZXIoYS5mb2QpID8gYS5mb2QgOiAwLCB0aGlzLl90b3RhbEJhY2t3YXJkT3BhY2l0eURlbHRhID0gQzMkanNjb21wJDk3LklzRmluaXRlTnVtYmVyKGEuYm9kKSA/IGEuYm9kIDogMCkKICAgIH0KfQpDMyRqc2NvbXAkOTcuUHJvcGVydHlUcmFja1N0YXRlLlByb3BlcnR5SW50ZXJwb2xhdGlvbkFkYXB0ZXIuTnVtZXJpY0ludGVycG9sYXRpb25BZGFwdGVyID0gTnVtZXJpY0ludGVycG9sYXRpb25BZGFwdGVyOwoidXNlIHN0cmljdCI7CmNsYXNzIEFic29sdXRlVmFsdWVPYmplY3QgewogICAgY29uc3RydWN0b3IoYSkgewogICAgICAgIHRoaXMuX3VzZWQgPSAhMTsKICAgICAgICB0aGlzLl92YWx1ZSA9IDA7CiAgICAgICAgdGhpcy5fcHJvcGVydHlUcmFja3MgPSBhOwogICAgICAgIGZvciAobGV0IGIgPSAwLCBkID0gdGhpcy5fcHJvcGVydHlUcmFja3MubGVuZ3RoOyBiIDwgZDsgYisrKSB0aGlzLl9wcm9wZXJ0eVRyYWNrc1tiXS5TZXRBYnNvbHV0ZVZhbHVlT2JqZWN0KHRoaXMpCiAgICB9CiAgICBHZXRQcm9wZXJ0eVRyYWNrcygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcHJvcGVydHlUcmFja3MKICAgIH0KICAgIFNldFVzZWQoKSB7CiAgICAgICAgdGhpcy5fdXNlZCA9ICEwCiAgICB9CiAgICBHZXRVc2VkKCkgewogICAgICAgIHJldHVybiB0aGlzLl91c2VkCiAgICB9CiAgICBTZXRWYWx1ZShhKSB7CiAgICAgICAgdGhpcy5fdmFsdWUgPSBhCiAgICB9CiAgICBHZXRWYWx1ZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdmFsdWUKICAgIH0KICAgIFJlc2V0KCkgewogICAgICAgIHRoaXMuX3VzZWQgPSAhMTsKICAgICAgICB0aGlzLl92YWx1ZSA9IDAKICAgIH0KfQpjbGFzcyBOdW1lcmljSW50ZXJwb2xhdGlvbkFkYXB0ZXJGb3JUaW1lbGluZSB7CiAgICBjb25zdHJ1Y3RvcihhKSB7CiAgICAgICAgdGhpcy5fbnVtZXJpY0ludGVycG9sYXRpb25BZGFwdGVyID0gYQogICAgfQogICAgUmVsZWFzZSgpIHsKICAgICAgICB0aGlzLl9udW1lcmljSW50ZXJwb2xhdGlvbkFkYXB0ZXIgPSBudWxsCiAgICB9CiAgICBTZXRJbml0aWFsU3RhdGUoKSB7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuX251bWVyaWNJbnRlcnBvbGF0aW9uQWRhcHRlcjsKICAgICAgICB0aGlzLl9udW1lcmljSW50ZXJwb2xhdGlvbkFkYXB0ZXIuR2V0UHJvcGVydHlUcmFjaygpOwogICAgICAgIHJldHVybiBhLl9QaWNrUmVzdWx0TW9kZSgoKSA9PiBhLl9QaWNrVGltZWxpbmVQbGF5YmFja01vZGUoKCkgPT4gMCwgKCkgPT4gYS5HZXRTb3VyY2VBZGFwdGVyKCkuR2V0VmFsdWVBdFRpbWUoKSksICgpID0+IHt9KQogICAgfQogICAgU2V0UmVzdW1lU3RhdGUoKSB7fQogICAgTWF5TmVlZEJlZm9yZUFuZEFmdGVySW50ZXJwb2xhdGUoKSB7CiAgICAgICAgc3dpdGNoICh0aGlzLl9udW1lcmljSW50ZXJwb2xhdGlvbkFkYXB0ZXIuR2V0UHJvcGVydHlUcmFjaygpLkdldFJlc3VsdE1vZGUoKSkgewogICAgICAgICAgICBjYXNlICJyZWxhdGl2ZSI6CiAgICAgICAgICAgICAgICByZXR1cm4gITE7CiAgICAgICAgICAgIGNhc2UgImFic29sdXRlIjoKICAgICAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgIH0KICAgIH0KICAgIEJlZm9yZUNoYW5nZVByb3BlcnR5KCkgewogICAgICAgIHZhciBhID0gdGhpcy5fbnVtZXJpY0ludGVycG9sYXRpb25BZGFwdGVyLkdldFByb3BlcnR5VHJhY2soKSwKICAgICAgICAgICAgYiA9IGEuR2V0UHJvcGVydHlOYW1lKCk7CiAgICAgICAgc3dpdGNoIChhLkdldFJlc3VsdE1vZGUoKSkgewogICAgICAgICAgICBjYXNlICJhYnNvbHV0ZSI6CiAgICAgICAgICAgICAgICBpZiAoYS5IYXNBYnNvbHV0ZVZhbHVlT2JqZWN0KCkpIGEuR2V0QWJzb2x1dGVWYWx1ZU9iamVjdCgpLlJlc2V0KCk7CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBkID0gYS5HZXRUaW1lbGluZSgpLAogICAgICAgICAgICAgICAgICAgICAgICBjID0gYS5HZXRJbnN0YW5jZSgpOwogICAgICAgICAgICAgICAgICAgIGEgPSBhLkdldFNvdXJjZUFkYXB0ZXIoKTsKICAgICAgICAgICAgICAgICAgICAoYiA9IGQuR2V0U2ltaWxhclByb3BlcnR5VHJhY2tzKGMsIGEsIGIpKSAmJiAxIDwgYi5sZW5ndGggJiYgbmV3IEFic29sdXRlVmFsdWVPYmplY3QoYikKICAgICAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBDaGFuZ2VQcm9wZXJ0eShhLCBiLCBkLCBjLCBlLCBnKSB7CiAgICAgICAgdmFyIGsgPSB0aGlzLl9udW1lcmljSW50ZXJwb2xhdGlvbkFkYXB0ZXIsCiAgICAgICAgICAgIG0gPSB0aGlzLl9udW1lcmljSW50ZXJwb2xhdGlvbkFkYXB0ZXIuR2V0UHJvcGVydHlUcmFjaygpOwogICAgICAgIHN3aXRjaCAobS5HZXRSZXN1bHRNb2RlKCkpIHsKICAgICAgICAgICAgY2FzZSAicmVsYXRpdmUiOgogICAgICAgICAgICAgICAgbSA9IGsuR2V0TGFzdFZhbHVlKCk7CiAgICAgICAgICAgICAgICBrLl9TZXR0ZXIoYiAtIG0sIGQsIGMpOwogICAgICAgICAgICAgICAgZyAmJiB0aGlzLl9NYXliZUVuc3VyZVZhbHVlKGEsIGQsIGMsIGUsIG0sIGIpOwogICAgICAgICAgICAgICAgay5TZXRMYXN0VmFsdWUoYik7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAiYWJzb2x1dGUiOgogICAgICAgICAgICAgICAgaWYgKGMgPSBtLkdldFRpbWVsaW5lKCksIGQgPSBtLkdldFRyYWNrKCksIG0uR2V0SW5zdGFuY2UoKSwgbS5HZXRTb3VyY2VBZGFwdGVyKCksIG0uSGFzQWJzb2x1dGVWYWx1ZU9iamVjdCgpKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGEgPSBtLkdldEFic29sdXRlVmFsdWVPYmplY3QoKSwgZSA9IGEuR2V0UHJvcGVydHlUcmFja3MoKSwgZSA9IGsuX0dldFByb3BlcnR5S2V5ZnJhbWVTdHVicyhlLCAhMCksIGsgPSBrLl9HZXRMYXN0UHJvcGVydHlLZXlmcmFtZVN0dWIoYywgYy5HZXRUaW1lKCksIGUpKSBkID0gZC5HZXRTdGFydE9mZnNldCgpLCBrID0gay50aW1lIC0gZCwgMCA9PT0gayA/IChhLlNldFVzZWQoKSwgYS5TZXRWYWx1ZShhLkdldFZhbHVlKCkgKyBiKSkgOiAwID4gayB8fCAobSA9IG0uR2V0SW50ZXJwb2xhdGVkVmFsdWUoayksCiAgICAgICAgICAgICAgICAgICAgICAgIGEuU2V0VXNlZCgpLCBhLlNldFZhbHVlKGEuR2V0VmFsdWUoKSArIChiIC0gbSkpKQogICAgICAgICAgICAgICAgfSBlbHNlIGsuX1NldHRlckFic29sdXRlKGIpCiAgICAgICAgfQogICAgfQogICAgQWZ0ZXJDaGFuZ2VQcm9wZXJ0eSgpIHsKICAgICAgICBjb25zdCBhID0gdGhpcy5fbnVtZXJpY0ludGVycG9sYXRpb25BZGFwdGVyOwogICAgICAgIHZhciBiID0gdGhpcy5fbnVtZXJpY0ludGVycG9sYXRpb25BZGFwdGVyLkdldFByb3BlcnR5VHJhY2soKTsKICAgICAgICBzd2l0Y2ggKGIuR2V0UmVzdWx0TW9kZSgpKSB7CiAgICAgICAgICAgIGNhc2UgImFic29sdXRlIjoKICAgICAgICAgICAgICAgIGIuSGFzQWJzb2x1dGVWYWx1ZU9iamVjdCgpICYmIChiID0gYi5HZXRBYnNvbHV0ZVZhbHVlT2JqZWN0KCksIGIuR2V0VXNlZCgpICYmIGEuX1NldHRlckFic29sdXRlKGIuR2V0VmFsdWUoKSkpCiAgICAgICAgfQogICAgfQogICAgX01heWJlRW5zdXJlVmFsdWUoYSwgYiwgZCwgYywgZSwgZykgewogICAgICAgIGNvbnN0IGsgPSB0aGlzLl9udW1lcmljSW50ZXJwb2xhdGlvbkFkYXB0ZXI7CiAgICAgICAgYyB8fCAoYiAmJiBhID09PSBiLkdldFRpbWUoKSA/IGsuX0FkZERlbHRhKGIuR2V0VmFsdWVXaXRoUmVzdWx0TW9kZSgpLCBiLCBkKSA6IGQgJiYgYSA9PT0gZC5HZXRUaW1lKCkgPyBrLl9BZGREZWx0YShkLkdldFZhbHVlV2l0aFJlc3VsdE1vZGUoKSwKICAgICAgICAgICAgYiwgZCkgOiAwID09PSBnIC0gZSAmJiBrLl9BZGREZWx0YShiLkdldFZhbHVlV2l0aFJlc3VsdE1vZGUoKSwgYiwgZCkpCiAgICB9Cn0Kc2VsZi5DMy5Qcm9wZXJ0eVRyYWNrU3RhdGUuUHJvcGVydHlJbnRlcnBvbGF0aW9uQWRhcHRlci5OdW1lcmljSW50ZXJwb2xhdGlvbkFkYXB0ZXJGb3JUaW1lbGluZSA9IE51bWVyaWNJbnRlcnBvbGF0aW9uQWRhcHRlckZvclRpbWVsaW5lOwoidXNlIHN0cmljdCI7CmNsYXNzIE51bWVyaWNJbnRlcnBvbGF0aW9uQWRhcHRlckZvclR3ZWVuIHsKICAgIGNvbnN0cnVjdG9yKGEpIHsKICAgICAgICB0aGlzLl9udW1lcmljSW50ZXJwb2xhdGlvbkFkYXB0ZXIgPSBhCiAgICB9CiAgICBSZWxlYXNlKCkgewogICAgICAgIHRoaXMuX251bWVyaWNJbnRlcnBvbGF0aW9uQWRhcHRlciA9IG51bGwKICAgIH0KICAgIFNldEluaXRpYWxTdGF0ZSgpIHsKICAgICAgICBjb25zdCBhID0gdGhpcy5fbnVtZXJpY0ludGVycG9sYXRpb25BZGFwdGVyOwogICAgICAgIGEuU2V0Rmlyc3RBYnNvbHV0ZVVwZGF0ZSghMCk7CiAgICAgICAgcmV0dXJuIHRoaXMuX0dldEFic29sdXRlSW5pdGlhbFZhbHVlKGEuX0ZpcnN0S2V5ZnJhbWVHZXR0ZXIoKSkKICAgIH0KICAgIFNldFJlc3VtZVN0YXRlKCkgewogICAgICAgIGNvbnN0IGEgPSB0aGlzLl9udW1lcmljSW50ZXJwb2xhdGlvbkFkYXB0ZXI7CiAgICAgICAgaWYgKGEuX0ZpcnN0S2V5ZnJhbWVHZXR0ZXIoKSAhPT0gYS5fQ3VycmVudEtleWZyYW1lR2V0dGVyKCkpIHJldHVybiBhLlNldEZpcnN0QWJzb2x1dGVVcGRhdGUoITApLCB0aGlzLl9HZXRBYnNvbHV0ZUluaXRpYWxWYWx1ZShhLl9DdXJyZW50S2V5ZnJhbWVHZXR0ZXIoKSkKICAgIH0KICAgIE1heU5lZWRCZWZvcmVBbmRBZnRlckludGVycG9sYXRlKCkgewogICAgICAgIHJldHVybiAhMQogICAgfQogICAgQmVmb3JlQ2hhbmdlUHJvcGVydHkoKSB7fQogICAgQ2hhbmdlUHJvcGVydHkoYSwKICAgICAgICBiLCBkLCBjLCBlLCBnKSB7CiAgICAgICAgY29uc3QgayA9IHRoaXMuX251bWVyaWNJbnRlcnBvbGF0aW9uQWRhcHRlciwKICAgICAgICAgICAgbSA9IGsuR2V0TGFzdFZhbHVlKCk7CiAgICAgICAgc3dpdGNoIChrLkdldFByb3BlcnR5VHJhY2soKS5HZXRSZXN1bHRNb2RlKCkpIHsKICAgICAgICAgICAgY2FzZSAicmVsYXRpdmUiOgogICAgICAgICAgICAgICAgay5fU2V0dGVyKGIgLSBtLCBkLCBjKTsKICAgICAgICAgICAgICAgIGcgJiYgdGhpcy5fTWF5YmVFbnN1cmVWYWx1ZShhLCBkLCBjLCBlLCBtLCBiKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICJhYnNvbHV0ZSI6CiAgICAgICAgICAgICAgICBrLkdldEZpcnN0QWJzb2x1dGVVcGRhdGUoKSA/IChrLlNldEZpcnN0QWJzb2x1dGVVcGRhdGUoITEpLCBrLl9TZXR0ZXIobSwgZCwgYykpIDogKGsuX1NldHRlcihiIC0gbSwgZCwgYyksIGcgJiYgdGhpcy5fTWF5YmVFbnN1cmVWYWx1ZShhLCBkLCBjLCBlLCBtLCBiKSkKICAgICAgICB9CiAgICAgICAgay5TZXRMYXN0VmFsdWUoYikKICAgIH0KICAgIEFmdGVyQ2hhbmdlUHJvcGVydHkoKSB7fQogICAgX0dldEFic29sdXRlSW5pdGlhbFZhbHVlKGEpIHsKICAgICAgICByZXR1cm4gYSAtIHRoaXMuX251bWVyaWNJbnRlcnBvbGF0aW9uQWRhcHRlci5HZXRDdXJyZW50U3RhdGUoKQogICAgfQogICAgX01heWJlRW5zdXJlVmFsdWUoYSwgYiwgZCwKICAgICAgICBjLCBlLCBnKSB7CiAgICAgICAgY29uc3QgayA9IHRoaXMuX251bWVyaWNJbnRlcnBvbGF0aW9uQWRhcHRlcjsKICAgICAgICBjID8gYiAmJiBhID09PSBiLkdldFRpbWUoKSA/IGsuX0FkZERlbHRhKGIuR2V0VmFsdWVXaXRoUmVzdWx0TW9kZSgpLCBiLCBkKSA6IGQgJiYgYSA9PT0gZC5HZXRUaW1lKCkgPyBrLl9BZGREZWx0YShkLkdldFZhbHVlV2l0aFJlc3VsdE1vZGUoKSwgYiwgZCkgOiBkIHx8IGsuX0FkZERlbHRhKGIuR2V0VmFsdWVXaXRoUmVzdWx0TW9kZSgpLCBiLCBkKSA6IGIgJiYgYSA9PT0gYi5HZXRUaW1lKCkgPyBrLl9BZGREZWx0YShiLkdldFZhbHVlV2l0aFJlc3VsdE1vZGUoKSwgYiwgZCkgOiBkICYmIGEgPT09IGQuR2V0VGltZSgpID8gay5fQWRkRGVsdGEoZC5HZXRWYWx1ZVdpdGhSZXN1bHRNb2RlKCksIGIsIGQpIDogMCA9PT0gZyAtIGUgJiYgay5fQWRkRGVsdGEoYi5HZXRWYWx1ZVdpdGhSZXN1bHRNb2RlKCksIGIsIGQpCiAgICB9Cn0Kc2VsZi5DMy5Qcm9wZXJ0eVRyYWNrU3RhdGUuUHJvcGVydHlJbnRlcnBvbGF0aW9uQWRhcHRlci5OdW1lcmljSW50ZXJwb2xhdGlvbkFkYXB0ZXJGb3JUd2VlbiA9IE51bWVyaWNJbnRlcnBvbGF0aW9uQWRhcHRlckZvclR3ZWVuOwoidXNlIHN0cmljdCI7CmNvbnN0IEMzJGpzY29tcCQxMDAgPSBzZWxmLkMzLAogICAgRWFzZSRqc2NvbXAkMSA9IHNlbGYuRWFzZTsKQzMkanNjb21wJDEwMC5Qcm9wZXJ0eVRyYWNrU3RhdGUuTnVtZXJpY1R5cGVBZGFwdGVyID0gY2xhc3MgewogICAgY29uc3RydWN0b3IoKSB7fQogICAgc3RhdGljIFdpbGxDaGFuZ2UoYSwgYiwgZCwgYykgewogICAgICAgIGxldCBlOwogICAgICAgIHN3aXRjaCAoYykgewogICAgICAgICAgICBjYXNlICJiZWhhdmlvciI6CiAgICAgICAgICAgICAgICBlID0gYi5HZXRQcm9wZXJ0eVZhbHVlQnlJbmRleChhKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICJlZmZlY3QiOgogICAgICAgICAgICAgICAgZSA9IGJbYV07CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAiaW5zdGFuY2UtdmFyaWFibGUiOgogICAgICAgICAgICAgICAgZSA9IGIuR2V0SW5zdGFuY2VWYXJpYWJsZVZhbHVlKGEpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgInBsdWdpbiI6CiAgICAgICAgICAgICAgICBlID0gYi5HZXRQcm9wZXJ0eVZhbHVlQnlJbmRleChhKQogICAgICAgIH0KICAgICAgICByZXR1cm4gZSA9PT0gZCA/ICExIDogITAKICAgIH0KICAgIHN0YXRpYyBJbnRlcnBvbGF0ZShhLCBiLCBkLCBjKSB7CiAgICAgICAgaWYgKCFkKSByZXR1cm4gYiA9IGMuR2V0UHJvcGVydHlUcmFja0RhdGFJdGVtKCksIGIgPSBjLkdldFByb3BlcnR5VHJhY2tEYXRhKCkuR2V0TGFzdFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbShiKSwgYi5HZXRWYWx1ZVdpdGhSZXN1bHRNb2RlKCk7CiAgICAgICAgdmFyIGUgPSBjLkdldEludGVycG9sYXRpb25Nb2RlKCk7CiAgICAgICAgImRlZmF1bHQiID09PSBlICYmIChlID0gImNvbnRpbnVvdXMiKTsKICAgICAgICAiY29tYm8iID09PSBjLkdldFByb3BlcnR5VHlwZSgpICYmIChlID0gImRpc2NyZXRlIik7CiAgICAgICAgaWYgKCJkaXNjcmV0ZSIgPT09IGUpIHJldHVybiBiLkdldFZhbHVlV2l0aFJlc3VsdE1vZGUoKTsKICAgICAgICBpZiAoImNvbnRpbnVvdXMiID09PSBlIHx8ICJzdGVwIiA9PT0gZSkgewogICAgICAgICAgICAic3RlcCIgPT09IGUgJiYgKGUgPSBjLkdldFRpbWVsaW5lKCkuR2V0U3RlcCgpLCAwICE9PSBlICYmIChlID0gMSAvIGUsIGEgPSBNYXRoLmZsb29yKGEgKiBlKSAvIGUpKTsKICAgICAgICAgICAgZSA9IGIuR2V0VmFsdWVXaXRoUmVzdWx0TW9kZSgpOwogICAgICAgICAgICBjb25zdCBnID0gZC5HZXRWYWx1ZVdpdGhSZXN1bHRNb2RlKCksCiAgICAgICAgICAgICAgICBrID0gYi5HZXRBZGRPbigiY3ViaWMtYmV6aWVyIiksCiAgICAgICAgICAgICAgICBtID0gZC5HZXRBZGRPbigiY3ViaWMtYmV6aWVyIiksCiAgICAgICAgICAgICAgICBuID0gayAmJiBrLkdldFN0YXJ0RW5hYmxlKCkgJiYgbSAmJiBtLkdldEVuZEVuYWJsZSgpOwogICAgICAgICAgICBpZiAoIW4gJiYgZSA9PT0gZykgcmV0dXJuIGU7CiAgICAgICAgICAgIGNvbnN0IHEgPSBiLkdldFRpbWUoKTsKICAgICAgICAgICAgZCA9IGQuR2V0VGltZSgpOwogICAgICAgICAgICBhID0gQzMkanNjb21wJDEwMC5ub3JtYWxpemUoYSwgcSwgZCk7CiAgICAgICAgICAgIGIgPSBiLkdldEVhc2UoKTsKICAgICAgICAgICAgbiA/IChkIC09IHEsIGIgPSBFYXNlJGpzY29tcCQxLkdldFJ1bnRpbWVFYXNlKGIpKGQgKiBhLCAwLCAxLCBkKSwgYiA9IEVhc2UkanNjb21wJDEuR2V0UnVudGltZUVhc2UoImN1YmljYmV6aWVyIikoYiwgZSwgZSArIGsuR2V0U3RhcnRBbmNob3IoKSwgZyArIG0uR2V0RW5kQW5jaG9yKCksIGcpKSA6IGIgPSBFYXNlJGpzY29tcCQxLkdldFJ1bnRpbWVFYXNlKGIpKChkIC0gcSkgKiBhLCBlLCBnIC0gZSwgZCAtIHEpOwogICAgICAgICAgICByZXR1cm4gImludGVnZXIiID09PSBjLkdldFByb3BlcnR5VHlwZSgpID8gTWF0aC5mbG9vcihiKSA6IGIKICAgICAgICB9CiAgICB9Cn07CiJ1c2Ugc3RyaWN0IjsKY29uc3QgQzMkanNjb21wJDEwMSA9IHNlbGYuQzM7CkMzJGpzY29tcCQxMDEuUHJvcGVydHlUcmFja1N0YXRlLkFuZ2xlVHlwZUFkYXB0ZXIgPSBjbGFzcyB7CiAgICBjb25zdHJ1Y3RvcigpIHt9CiAgICBzdGF0aWMgV2lsbENoYW5nZShhLCBiLCBkLCBjKSB7CiAgICAgICAgbGV0IGU7CiAgICAgICAgc3dpdGNoIChjKSB7CiAgICAgICAgICAgIGNhc2UgImJlaGF2aW9yIjoKICAgICAgICAgICAgICAgIGUgPSBiLkdldFByb3BlcnR5VmFsdWVCeUluZGV4KGEpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgImVmZmVjdCI6CiAgICAgICAgICAgICAgICBlID0gYlthXTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICJpbnN0YW5jZS12YXJpYWJsZSI6CiAgICAgICAgICAgICAgICBlID0gYi5HZXRJbnN0YW5jZVZhcmlhYmxlVmFsdWUoYSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAicGx1Z2luIjoKICAgICAgICAgICAgICAgIGUgPSBiLkdldFByb3BlcnR5VmFsdWVCeUluZGV4KGEpCiAgICAgICAgfQogICAgICAgIHJldHVybiBlID09PSBkID8gITEgOiAhMAogICAgfQogICAgc3RhdGljIEludGVycG9sYXRlKGEsIGIsIGQsIGMpIHsKICAgICAgICBpZiAoIWQpIHJldHVybiBiID0gYy5HZXRQcm9wZXJ0eVRyYWNrRGF0YUl0ZW0oKSwgYiA9IGMuR2V0UHJvcGVydHlUcmFja0RhdGEoKS5HZXRMYXN0UHJvcGVydHlLZXlmcmFtZURhdGFJdGVtKGIpLCBiLkdldFZhbHVlV2l0aFJlc3VsdE1vZGUoKTsKICAgICAgICB2YXIgZSA9IGMuR2V0SW50ZXJwb2xhdGlvbk1vZGUoKTsKICAgICAgICAiZGVmYXVsdCIgPT09IGUgJiYgKGUgPSAiY29udGludW91cyIpOwogICAgICAgICJjb21ibyIgPT09IGMuR2V0UHJvcGVydHlUeXBlKCkgJiYgKGUgPSAiZGlzY3JldGUiKTsKICAgICAgICBpZiAoImRpc2NyZXRlIiA9PT0gZSkgcmV0dXJuIGIuR2V0VmFsdWVXaXRoUmVzdWx0TW9kZSgpOwogICAgICAgIGlmICgiY29udGludW91cyIgPT09IGUgfHwgInN0ZXAiID09PSBlKSB7CiAgICAgICAgICAgICJzdGVwIiA9PT0gZSAmJiAoYyA9IGMuR2V0VGltZWxpbmUoKS5HZXRTdGVwKCksIDAgIT09IGMgJiYgKGMgPSAxIC8gYywgYSA9IE1hdGguZmxvb3IoYSAqIGMpIC8gYykpOwogICAgICAgICAgICBjb25zdCBnID0gYi5HZXRUaW1lKCksCiAgICAgICAgICAgICAgICBrID0gZC5HZXRUaW1lKCk7CiAgICAgICAgICAgIGMgPSBiLkdldFZhbHVlV2l0aFJlc3VsdE1vZGUoKTsKICAgICAgICAgICAgZCA9IGQuR2V0VmFsdWVXaXRoUmVzdWx0TW9kZSgpOwogICAgICAgICAgICBpZiAoZSA9IGIuR2V0QWRkT24oImFuZ2xlIikpIHsKICAgICAgICAgICAgICAgIGNvbnN0IG0gPSBlLkdldFJldm9sdXRpb25zKCk7CiAgICAgICAgICAgICAgICBpZiAoYyA9PT0gZCAmJiAwID09PSBtKSByZXR1cm4gYzsKICAgICAgICAgICAgICAgIGEgPSBDMyRqc2NvbXAkMTAxLm5vcm1hbGl6ZShhLCBnLCBrKTsKICAgICAgICAgICAgICAgIGIgPSBzZWxmLkVhc2UuR2V0UnVudGltZUVhc2UoYi5HZXRFYXNlKCkpKGEsIDAsIDEsIDEpOwogICAgICAgICAgICAgICAgc3dpdGNoIChlLkdldERpcmVjdGlvbigpKSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAiY2xvc2VzdCI6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBDMyRqc2NvbXAkMTAxLmFuZ2xlTGVycChjLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZCwgYiwgbSk7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAiY2xvY2t3aXNlIjoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEMzJGpzY29tcCQxMDEuYW5nbGVMZXJwQ2xvY2t3aXNlKGMsIGQsIGIsIG0pOwogICAgICAgICAgICAgICAgICAgIGNhc2UgImFudGktY2xvY2t3aXNlIjoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEMzJGpzY29tcCQxMDEuYW5nbGVMZXJwQW50aUNsb2Nrd2lzZShjLCBkLCBiLCBtKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaWYgKGMgPT09IGQpIHJldHVybiBjOwogICAgICAgICAgICAgICAgYSA9IEMzJGpzY29tcCQxMDEubm9ybWFsaXplKGEsIGcsIGspOwogICAgICAgICAgICAgICAgYiA9IHNlbGYuRWFzZS5HZXRSdW50aW1lRWFzZShiLkdldEVhc2UoKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gQzMkanNjb21wJDEwMS5hbmdsZUxlcnAoYywgZCwgYihhLCAwLCAxLCAxKSkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfTsKInVzZSBzdHJpY3QiOwpzZWxmLkMzLlByb3BlcnR5VHJhY2tTdGF0ZS5Cb29sZWFuVHlwZUFkYXB0ZXIgPSBjbGFzcyB7CiAgICBjb25zdHJ1Y3RvcigpIHt9CiAgICBzdGF0aWMgV2lsbENoYW5nZShhLCBiLCBkLCBjKSB7CiAgICAgICAgbGV0IGU7CiAgICAgICAgc3dpdGNoIChjKSB7CiAgICAgICAgICAgIGNhc2UgImJlaGF2aW9yIjoKICAgICAgICAgICAgICAgIGUgPSBiLkdldFByb3BlcnR5VmFsdWVCeUluZGV4KGEpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgImVmZmVjdCI6CiAgICAgICAgICAgICAgICBlID0gYlthXTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICJpbnN0YW5jZS12YXJpYWJsZSI6CiAgICAgICAgICAgICAgICBlID0gYi5HZXRJbnN0YW5jZVZhcmlhYmxlVmFsdWUoYSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAicGx1Z2luIjoKICAgICAgICAgICAgICAgIGUgPSBiLkdldFByb3BlcnR5VmFsdWVCeUluZGV4KGEpCiAgICAgICAgfQogICAgICAgIHJldHVybiAhIWUgPT09ICEhZCA/ICExIDogITAKICAgIH0KICAgIHN0YXRpYyBJbnRlcnBvbGF0ZShhLCBiLCBkLCBjKSB7CiAgICAgICAgcmV0dXJuIGQgPyBiLkdldFZhbHVlV2l0aFJlc3VsdE1vZGUoKSA/IDEgOiAwIDogKGEgPSBjLkdldFByb3BlcnR5VHJhY2tEYXRhSXRlbSgpLCBhID0gYy5HZXRQcm9wZXJ0eVRyYWNrRGF0YSgpLkdldExhc3RQcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW0oYSksIGEuR2V0VmFsdWVXaXRoUmVzdWx0TW9kZSgpID8KICAgICAgICAgICAgMSA6IDApCiAgICB9Cn07CiJ1c2Ugc3RyaWN0IjsKY29uc3QgQzMkanNjb21wJDEwMyA9IHNlbGYuQzMsCiAgICBURU1QX0NPTE9SX0FSUkFZID0gWzAsIDAsIDBdLAogICAgVEVNUF9DT0xPUl9BUlJBWV8yID0gWzAsIDAsIDBdLAogICAgVEVNUF9DT0xPUl9BUlJBWV8zID0gWzAsIDAsIDBdOwpDMyRqc2NvbXAkMTAzLlByb3BlcnR5VHJhY2tTdGF0ZS5Db2xvclR5cGVBZGFwdGVyID0gY2xhc3MgewogICAgY29uc3RydWN0b3IoKSB7fQogICAgc3RhdGljIFdpbGxDaGFuZ2UoYSwgYiwgZCwgYykgewogICAgICAgIGxldCBlOwogICAgICAgIHN3aXRjaCAoYykgewogICAgICAgICAgICBjYXNlICJiZWhhdmlvciI6CiAgICAgICAgICAgICAgICBlID0gYi5HZXRQcm9wZXJ0eVZhbHVlQnlJbmRleChhKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICJlZmZlY3QiOgogICAgICAgICAgICAgICAgZSA9IGJbYV07CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAiaW5zdGFuY2UtdmFyaWFibGUiOgogICAgICAgICAgICAgICAgZSA9IGIuR2V0SW5zdGFuY2VWYXJpYWJsZVZhbHVlKGEpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgInBsdWdpbiI6CiAgICAgICAgICAgICAgICBlID0gYi5HZXRQcm9wZXJ0eVZhbHVlQnlJbmRleChhKQogICAgICAgIH0KICAgICAgICBBcnJheS5pc0FycmF5KGQpID8gKFRFTVBfQ09MT1JfQVJSQVlbMF0gPSBkWzBdLCBURU1QX0NPTE9SX0FSUkFZWzFdID0gZFsxXSwgVEVNUF9DT0xPUl9BUlJBWVsyXSA9IGRbMl0pIDogKFRFTVBfQ09MT1JfQVJSQVlfMy5wYXJzZUNvbW1hU2VwYXJhdGVkUmdiKGQpLCBURU1QX0NPTE9SX0FSUkFZWzBdID0gTWF0aC5mbG9vcigyNTUgKiBURU1QX0NPTE9SX0FSUkFZXzMuZ2V0UigpKSwKICAgICAgICAgICAgVEVNUF9DT0xPUl9BUlJBWVsxXSA9IE1hdGguZmxvb3IoMjU1ICogVEVNUF9DT0xPUl9BUlJBWV8zLmdldEcoKSksIFRFTVBfQ09MT1JfQVJSQVlbMl0gPSBNYXRoLmZsb29yKDI1NSAqIFRFTVBfQ09MT1JfQVJSQVlfMy5nZXRCKCkpKTsKICAgICAgICBBcnJheS5pc0FycmF5KGUpID8gKFRFTVBfQ09MT1JfQVJSQVlfMlswXSA9IGVbMF0sIFRFTVBfQ09MT1JfQVJSQVlfMlsxXSA9IGVbMV0sIFRFTVBfQ09MT1JfQVJSQVlfMlsyXSA9IGVbMl0pIDogKFRFTVBfQ09MT1JfQVJSQVlfMy5wYXJzZUNvbW1hU2VwYXJhdGVkUmdiKGUpLCBURU1QX0NPTE9SX0FSUkFZXzJbMF0gPSBNYXRoLmZsb29yKDI1NSAqIFRFTVBfQ09MT1JfQVJSQVlfMy5nZXRSKCkpLCBURU1QX0NPTE9SX0FSUkFZXzJbMV0gPSBNYXRoLmZsb29yKDI1NSAqIFRFTVBfQ09MT1JfQVJSQVlfMy5nZXRHKCkpLCBURU1QX0NPTE9SX0FSUkFZXzJbMl0gPSBNYXRoLmZsb29yKDI1NSAqIFRFTVBfQ09MT1JfQVJSQVlfMy5nZXRCKCkpKTsKICAgICAgICByZXR1cm4gVEVNUF9DT0xPUl9BUlJBWVswXSAhPT0gVEVNUF9DT0xPUl9BUlJBWV8yWzBdIHx8CiAgICAgICAgICAgIFRFTVBfQ09MT1JfQVJSQVlbMV0gIT09IFRFTVBfQ09MT1JfQVJSQVlfMlsxXSB8fCBURU1QX0NPTE9SX0FSUkFZWzJdICE9PSBURU1QX0NPTE9SX0FSUkFZXzJbMl0gPyAhMCA6ICExCiAgICB9CiAgICBzdGF0aWMgSW50ZXJwb2xhdGUoYSwgYiwgZCwgYykgewogICAgICAgIGlmICghZCkgewogICAgICAgICAgICB2YXIgZSA9IGMuR2V0UHJvcGVydHlUcmFja0RhdGFJdGVtKCk7CiAgICAgICAgICAgIGUgPSBjLkdldFByb3BlcnR5VHJhY2tEYXRhKCkuR2V0TGFzdFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbShlKTsKICAgICAgICAgICAgYyA9IGUuR2V0VmFsdWVXaXRoUmVzdWx0TW9kZSgpOwogICAgICAgICAgICBURU1QX0NPTE9SX0FSUkFZWzBdID0gY1swXTsKICAgICAgICAgICAgVEVNUF9DT0xPUl9BUlJBWVsxXSA9IGNbMV07CiAgICAgICAgICAgIFRFTVBfQ09MT1JfQVJSQVlbMl0gPSBjWzJdOwogICAgICAgICAgICByZXR1cm4gVEVNUF9DT0xPUl9BUlJBWQogICAgICAgIH0KICAgICAgICBlID0gYy5HZXRJbnRlcnBvbGF0aW9uTW9kZSgpOwogICAgICAgICJkZWZhdWx0IiA9PT0gZSAmJiAoZSA9ICJjb250aW51b3VzIik7CiAgICAgICAgaWYgKCJkaXNjcmV0ZSIgPT09IGUpIHJldHVybiBjID0gYi5HZXRWYWx1ZVdpdGhSZXN1bHRNb2RlKCksIFRFTVBfQ09MT1JfQVJSQVlbMF0gPSBjWzBdLCBURU1QX0NPTE9SX0FSUkFZWzFdID0KICAgICAgICAgICAgY1sxXSwgVEVNUF9DT0xPUl9BUlJBWVsyXSA9IGNbMl0sIFRFTVBfQ09MT1JfQVJSQVk7CiAgICAgICAgaWYgKCJjb250aW51b3VzIiA9PT0gZSB8fCAic3RlcCIgPT09IGUpIHsKICAgICAgICAgICAgInN0ZXAiID09PSBlICYmIChjID0gYy5HZXRUaW1lbGluZSgpLkdldFN0ZXAoKSwgMCAhPT0gYyAmJiAoYyA9IDEgLyBjLCBhID0gTWF0aC5mbG9vcihhICogYykgLyBjKSk7CiAgICAgICAgICAgIGMgPSBiLkdldFRpbWUoKTsKICAgICAgICAgICAgZSA9IGQuR2V0VGltZSgpOwogICAgICAgICAgICB2YXIgZyA9IGIuR2V0VmFsdWVXaXRoUmVzdWx0TW9kZSgpLAogICAgICAgICAgICAgICAgayA9IGQuR2V0VmFsdWVXaXRoUmVzdWx0TW9kZSgpOwogICAgICAgICAgICBhID0gQzMkanNjb21wJDEwMy5ub3JtYWxpemUoYSwgYywgZSk7CiAgICAgICAgICAgIHZhciBtID0gYi5HZXRFYXNlKCk7CiAgICAgICAgICAgIGIgPSBnWzBdOwogICAgICAgICAgICBkID0gZ1sxXTsKICAgICAgICAgICAgZyA9IGdbMl07CiAgICAgICAgICAgIGNvbnN0IG4gPSBrWzBdLAogICAgICAgICAgICAgICAgcSA9IGtbMV07CiAgICAgICAgICAgIGsgPSBrWzJdOwogICAgICAgICAgICBtID0gc2VsZi5FYXNlLkdldFJ1bnRpbWVFYXNlKG0pOwogICAgICAgICAgICBjID0gZSAtIGM7CiAgICAgICAgICAgIGUgPSBjICogYTsKICAgICAgICAgICAgVEVNUF9DT0xPUl9BUlJBWVswXSA9IGIgPT09IG4gPyBiIDogbShlLCBiLCBuIC0gYiwgYyk7CiAgICAgICAgICAgIFRFTVBfQ09MT1JfQVJSQVlbMV0gPSBkID09PSBxID8gZCA6IG0oZSwgZCwgcSAtIGQsIGMpOwogICAgICAgICAgICBURU1QX0NPTE9SX0FSUkFZWzJdID0gZyA9PT0gayA/IGcgOiBtKGUsCiAgICAgICAgICAgICAgICBnLCBrIC0gZywgYyk7CiAgICAgICAgICAgIHJldHVybiBURU1QX0NPTE9SX0FSUkFZCiAgICAgICAgfQogICAgfQp9OwoidXNlIHN0cmljdCI7CnNlbGYuQzMuUHJvcGVydHlUcmFja1N0YXRlLlRleHRUeXBlQWRhcHRlciA9IGNsYXNzIHsKICAgIGNvbnN0cnVjdG9yKCkge30KICAgIHN0YXRpYyBXaWxsQ2hhbmdlKGEsIGIsIGQsIGMpIHsKICAgICAgICBsZXQgZTsKICAgICAgICBzd2l0Y2ggKGMpIHsKICAgICAgICAgICAgY2FzZSAiYmVoYXZpb3IiOgogICAgICAgICAgICAgICAgZSA9IGIuR2V0UHJvcGVydHlWYWx1ZUJ5SW5kZXgoYSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAiZWZmZWN0IjoKICAgICAgICAgICAgICAgIGUgPSBiW2FdOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgImluc3RhbmNlLXZhcmlhYmxlIjoKICAgICAgICAgICAgICAgIGUgPSBiLkdldEluc3RhbmNlVmFyaWFibGVWYWx1ZShhKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICJwbHVnaW4iOgogICAgICAgICAgICAgICAgZSA9IGIuR2V0UHJvcGVydHlWYWx1ZUJ5SW5kZXgoYSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGUgPT09IGQgPyAhMSA6ICEwCiAgICB9CiAgICBzdGF0aWMgSW50ZXJwb2xhdGUoYSwgYiwgZCwgYykgewogICAgICAgIHJldHVybiBkID8gYi5HZXRWYWx1ZVdpdGhSZXN1bHRNb2RlKCkgOiAoYSA9IGMuR2V0UHJvcGVydHlUcmFja0RhdGFJdGVtKCksIGEgPSBjLkdldFByb3BlcnR5VHJhY2tEYXRhKCkuR2V0TGFzdFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbShhKSwgYS5HZXRWYWx1ZVdpdGhSZXN1bHRNb2RlKCkpCiAgICB9Cn07CiJ1c2Ugc3RyaWN0IjsKY29uc3QgQzMkanNjb21wJDEwNSA9IHNlbGYuQzM7CkMzJGpzY29tcCQxMDUuVGltZWxpbmVEYXRhTWFuYWdlciA9IGNsYXNzIHsKICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgIHRoaXMuX3RpbWVsaW5lRGF0YUl0ZW1zID0gbmV3IE1hcAogICAgfQogICAgUmVsZWFzZSgpIHsKICAgICAgICBmb3IgKGNvbnN0IGEgb2YgdGhpcy5fdGltZWxpbmVEYXRhSXRlbXMudmFsdWVzKCkpIGEuUmVsZWFzZSgpOwogICAgICAgIHRoaXMuX3RpbWVsaW5lRGF0YUl0ZW1zLmNsZWFyKCk7CiAgICAgICAgdGhpcy5fdGltZWxpbmVEYXRhSXRlbXMgPSBudWxsCiAgICB9CiAgICBBZGQoYSkgewogICAgICAgIGEgPSBuZXcgQzMkanNjb21wJDEwNS5UaW1lbGluZURhdGFJdGVtKGEpOwogICAgICAgIGNvbnN0IGIgPSBhLkdldE5hbWUoKTsKICAgICAgICB0aGlzLl90aW1lbGluZURhdGFJdGVtcy5zZXQoYiwgYSkKICAgIH0KICAgIEdldChhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3RpbWVsaW5lRGF0YUl0ZW1zLmdldChhKQogICAgfQogICAgR2V0TmFtZUlkKCkgewogICAgICAgIHJldHVybiAwCiAgICB9CiAgICBzdGF0aWMgX0NyZWF0ZURhdGFJdGVtcyhhLCBiLCBkLCBjKSB7CiAgICAgICAgaWYgKGIpCiAgICAgICAgICAgIGZvciAoY29uc3QgZSBvZiBiKSBDMyRqc2NvbXAkMTA1LlRpbWVsaW5lRGF0YU1hbmFnZXIuX0NyZWF0ZURhdGFJdGVtKCJjcmVhdGUiLCBlLCBhLAogICAgICAgICAgICAgICAgZCwgYykKICAgIH0KICAgIHN0YXRpYyBfTG9hZERhdGFJdGVtc0Zyb21Kc29uKGEsIGIsIGQsIGMpIHsKICAgICAgICBhLmxlbmd0aCA/IGIuZm9yRWFjaCgoZSwgZykgPT4gewogICAgICAgICAgICBhW2ddLl9Mb2FkRnJvbUpzb24oZSkKICAgICAgICB9KSA6IGIuZm9yRWFjaChlID0+IHsKICAgICAgICAgICAgQzMkanNjb21wJDEwNS5UaW1lbGluZURhdGFNYW5hZ2VyLl9DcmVhdGVEYXRhSXRlbSgibG9hZCIsIGUsIGEsIGQsIGMpCiAgICAgICAgfSkKICAgIH0KICAgIHN0YXRpYyBfQ3JlYXRlRGF0YUl0ZW0oYSwgYiwgZCwgYywgZSkgewogICAgICAgIGxldCBnOwogICAgICAgIGlmICgiZnVuY3Rpb24iID09PSB0eXBlb2YgYykgc3dpdGNoIChhKSB7CiAgICAgICAgICAgIGNhc2UgImxvYWQiOgogICAgICAgICAgICAgICAgZyA9IG5ldyBjKG51bGwsIGUpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgImNyZWF0ZSI6CiAgICAgICAgICAgICAgICBnID0gbmV3IGMoYiwgZSkKICAgICAgICB9IGVsc2UgaWYgKCJvYmplY3QiID09PSB0eXBlb2YgYykgc3dpdGNoIChjID0gYy5tYXAuZ2V0KGJbYy5wcm9wXSksIGEpIHsKICAgICAgICAgICAgY2FzZSAibG9hZCI6CiAgICAgICAgICAgICAgICBnID0gbmV3IGMobnVsbCwgZSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAiY3JlYXRlIjoKICAgICAgICAgICAgICAgIGcgPSBuZXcgYyhiLCBlKQogICAgICAgIH0KICAgICAgICBzd2l0Y2ggKGEpIHsKICAgICAgICAgICAgY2FzZSAibG9hZCI6CiAgICAgICAgICAgICAgICBnLl9Mb2FkRnJvbUpzb24oYik7CiAgICAgICAgICAgICAgICBkLnB1c2goZyk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAiY3JlYXRlIjoKICAgICAgICAgICAgICAgIGlmICgiZnVuY3Rpb24iID09PQogICAgICAgICAgICAgICAgICAgIHR5cGVvZiBnLkdldEVuYWJsZSAmJiAhZy5HZXRFbmFibGUoKSkgcmV0dXJuIGcuUmVsZWFzZSgpOwogICAgICAgICAgICAgICAgZC5wdXNoKGcpCiAgICAgICAgfQogICAgfQp9OwoidXNlIHN0cmljdCI7CmNvbnN0IEMzJGpzY29tcCQxMDYgPSBzZWxmLkMzOwpDMyRqc2NvbXAkMTA2LlRpbWVsaW5lRGF0YUl0ZW0gPSBjbGFzcyB7CiAgICBjb25zdHJ1Y3RvcihhKSB7CiAgICAgICAgdGhpcy5fbmFtZSA9ICIiOwogICAgICAgIHRoaXMuX3RvdGFsVGltZSA9IE5hTjsKICAgICAgICB0aGlzLl9zdGVwID0gMDsKICAgICAgICB0aGlzLl9yZXN1bHRNb2RlID0gdGhpcy5faW50ZXJwb2xhdGlvbk1vZGUgPSAiZGVmYXVsdCI7CiAgICAgICAgdGhpcy5fcGluZ1BvbmcgPSB0aGlzLl9sb29wID0gITE7CiAgICAgICAgdGhpcy5fcmVwZWF0Q291bnQgPSAxOwogICAgICAgIHRoaXMuX3RyYWNrRGF0YSA9IG51bGw7CiAgICAgICAgdGhpcy5fc3RhcnRPbkxheW91dCA9ICIiOwogICAgICAgIHRoaXMuX3RyYW5zZm9ybVdpdGhTY2VuZUdyYXBoID0gITE7CiAgICAgICAgYSAmJiAodGhpcy5fbmFtZSA9IGFbMF0sIHRoaXMuX3RvdGFsVGltZSA9IGFbMV0sIHRoaXMuX3N0ZXAgPSBhWzJdLCB0aGlzLl9pbnRlcnBvbGF0aW9uTW9kZSA9IGFbM10sIHRoaXMuX3Jlc3VsdE1vZGUgPSBhWzRdLCB0aGlzLl9sb29wID0gISFhWzZdLCB0aGlzLl9waW5nUG9uZyA9ICEhYVs3XSwgdGhpcy5fcmVwZWF0Q291bnQgPSBhWzhdLCB0aGlzLl9zdGFydE9uTGF5b3V0ID0gYVs5XSwgdGhpcy5fdHJhbnNmb3JtV2l0aFNjZW5lR3JhcGggPSAhIWFbMTBdLCB0aGlzLl90cmFja0RhdGEgPSBuZXcgQzMkanNjb21wJDEwNi5UcmFja0RhdGEoYVs1XSwgdGhpcykpCiAgICB9CiAgICBSZWxlYXNlKCkgewogICAgICAgIHRoaXMuX3RyYWNrRGF0YS5SZWxlYXNlKCk7CiAgICAgICAgdGhpcy5fdHJhY2tEYXRhID0gbnVsbAogICAgfQogICAgR2V0VHJhY2tEYXRhKCkgewogICAgICAgIHRoaXMuX3RyYWNrRGF0YSB8fCAodGhpcy5fdHJhY2tEYXRhID0gbmV3IEMzJGpzY29tcCQxMDYuVHJhY2tEYXRhKG51bGwsIHRoaXMpKTsKICAgICAgICByZXR1cm4gdGhpcy5fdHJhY2tEYXRhCiAgICB9CiAgICBHZXROYW1lKCkgewogICAgICAgIHJldHVybiB0aGlzLl9uYW1lCiAgICB9CiAgICBTZXROYW1lKGEpIHsKICAgICAgICB0aGlzLl9uYW1lID0gYQogICAgfQogICAgR2V0VG90YWxUaW1lKCkgewogICAgICAgIHJldHVybiB0aGlzLl90b3RhbFRpbWUKICAgIH0KICAgIFNldFRvdGFsVGltZShhKSB7CiAgICAgICAgdGhpcy5fdG90YWxUaW1lID0gYQogICAgfQogICAgR2V0U3RlcCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fc3RlcAogICAgfQogICAgU2V0U3RlcChhKSB7CiAgICAgICAgdGhpcy5fc3RlcCA9IGEKICAgIH0KICAgIEdldEludGVycG9sYXRpb25Nb2RlKCkgewogICAgICAgIHJldHVybiB0aGlzLl9pbnRlcnBvbGF0aW9uTW9kZQogICAgfQogICAgU2V0SW50ZXJwb2xhdGlvbk1vZGUoYSkgewogICAgICAgIHRoaXMuX2ludGVycG9sYXRpb25Nb2RlID0KICAgICAgICAgICAgYQogICAgfQogICAgR2V0UmVzdWx0TW9kZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcmVzdWx0TW9kZQogICAgfQogICAgU2V0UmVzdWx0TW9kZShhKSB7CiAgICAgICAgdGhpcy5fcmVzdWx0TW9kZSA9IGEKICAgIH0KICAgIEdldExvb3AoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2xvb3AKICAgIH0KICAgIFNldExvb3AoYSkgewogICAgICAgIHRoaXMuX2xvb3AgPSBhCiAgICB9CiAgICBHZXRQaW5nUG9uZygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcGluZ1BvbmcKICAgIH0KICAgIFNldFBpbmdQb25nKGEpIHsKICAgICAgICB0aGlzLl9waW5nUG9uZyA9IGEKICAgIH0KICAgIEdldFJlcGVhdENvdW50KCkgewogICAgICAgIHJldHVybiB0aGlzLl9yZXBlYXRDb3VudAogICAgfQogICAgR2V0U3RhcnRPbkxheW91dCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fc3RhcnRPbkxheW91dAogICAgfQogICAgR2V0VHJhbnNmb3JtV2l0aFNjZW5lR3JhcGgoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3RyYW5zZm9ybVdpdGhTY2VuZUdyYXBoCiAgICB9CiAgICBfU2F2ZVRvSnNvbigpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICB0cmFja0RhdGFKc29uOiB0aGlzLl90cmFja0RhdGEuX1NhdmVUb0pzb24oKSwKICAgICAgICAgICAgbmFtZTogdGhpcy5fbmFtZSwKICAgICAgICAgICAgdG90YWxUaW1lOiB0aGlzLl90b3RhbFRpbWUsCiAgICAgICAgICAgIHN0ZXA6IHRoaXMuX3N0ZXAsCiAgICAgICAgICAgIGludGVycG9sYXRpb25Nb2RlOiB0aGlzLl9pbnRlcnBvbGF0aW9uTW9kZSwKICAgICAgICAgICAgcmVzdWx0TW9kZTogdGhpcy5fcmVzdWx0TW9kZSwKICAgICAgICAgICAgbG9vcDogdGhpcy5fbG9vcCwKICAgICAgICAgICAgcGluZ1Bvbmc6IHRoaXMuX3BpbmdQb25nLAogICAgICAgICAgICByZXBlYXRDb3VudDogdGhpcy5fcmVwZWF0Q291bnQsCiAgICAgICAgICAgIHN0YXJ0T25MYXlvdXQ6IHRoaXMuX3N0YXJ0T25MYXlvdXQsCiAgICAgICAgICAgIHRyYW5zZm9ybVdpdGhTY2VuZUdyYXBoOiAhIXRoaXMuX3RyYW5zZm9ybVdpdGhTY2VuZUdyYXBoCiAgICAgICAgfQogICAgfQogICAgX0xvYWRGcm9tSnNvbihhKSB7CiAgICAgICAgYSAmJiAodGhpcy5HZXRUcmFja0RhdGEoKS5fTG9hZEZyb21Kc29uKGEudHJhY2tEYXRhSnNvbiksIHRoaXMuX25hbWUgPSBhLm5hbWUsIHRoaXMuX3RvdGFsVGltZSA9IGEudG90YWxUaW1lLCB0aGlzLl9zdGVwID0gYS5zdGVwLCB0aGlzLl9pbnRlcnBvbGF0aW9uTW9kZSA9IGEuaW50ZXJwb2xhdGlvbk1vZGUsIHRoaXMuX3Jlc3VsdE1vZGUgPSBhLnJlc3VsdE1vZGUsIHRoaXMuX2xvb3AgPSBhLmxvb3AsIHRoaXMuX3BpbmdQb25nID0gYS5waW5nUG9uZywgdGhpcy5fcmVwZWF0Q291bnQgPSBhLnJlcGVhdENvdW50LCB0aGlzLl9zdGFydE9uTGF5b3V0ID0gYS5zdGFydE9uTGF5b3V0LAogICAgICAgICAgICB0aGlzLl90cmFuc2Zvcm1XaXRoU2NlbmVHcmFwaCA9ICEhYS50cmFuc2Zvcm1XaXRoU2NlbmVHcmFwaCkKICAgIH0KfTsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkMTA3ID0gc2VsZi5DMzsKY2xhc3MgVHJhY2tEYXRhSXRlbSB7CiAgICBjb25zdHJ1Y3RvcihhLCBiKSB7CiAgICAgICAgdGhpcy5fdHJhY2tEYXRhID0gYjsKICAgICAgICB0aGlzLl9hZGRpdGlvbmFsSW5zdGFuY2VEYXRhID0gdGhpcy5faW5zdGFuY2VEYXRhID0gbnVsbDsKICAgICAgICB0aGlzLl9vYmplY3RDbGFzc0luZGV4ID0gdGhpcy5faW5zdGFuY2VVaWQgPSBOYU47CiAgICAgICAgdGhpcy5fcmVzdWx0TW9kZSA9IHRoaXMuX2ludGVycG9sYXRpb25Nb2RlID0gImRlZmF1bHQiOwogICAgICAgIHRoaXMuX2VuYWJsZWQgPSAhMTsKICAgICAgICB0aGlzLl9wcm9wZXJ0eVRyYWNrRGF0YSA9IHRoaXMuX2tleWZyYW1lRGF0YSA9IG51bGw7CiAgICAgICAgdGhpcy5faWQgPSAiIjsKICAgICAgICB0aGlzLl9uZXN0ZWREYXRhID0gbnVsbDsKICAgICAgICB0aGlzLl9zdGFydE9mZnNldCA9IDA7CiAgICAgICAgdGhpcy5fbG9jYWxUb3RhbFRpbWUgPSB0aGlzLl90cmFja0RhdGEuR2V0VGltZWxpbmVEYXRhSXRlbSgpLkdldFRvdGFsVGltZSgpOwogICAgICAgIHRoaXMuX3R5cGUgPSAwOwogICAgICAgIHRoaXMuX25hbWUgPSAiIjsKICAgICAgICBhICYmIChhWzBdICYmICh0aGlzLl9pbnN0YW5jZURhdGEgPSBhWzBdLCB0aGlzLl9pbnN0YW5jZVVpZCA9IGFbMF1bMl0sIHRoaXMuX29iamVjdENsYXNzSW5kZXggPQogICAgICAgICAgICBhWzBdWzFdKSwgdGhpcy5faW50ZXJwb2xhdGlvbk1vZGUgPSBhWzFdLCB0aGlzLl9yZXN1bHRNb2RlID0gYVsyXSwgdGhpcy5fZW5hYmxlZCA9ICEhYVszXSwgYVs2XSAmJiAodGhpcy5faWQgPSBhWzZdKSwgYVs3XSAmJiAodGhpcy5fbmVzdGVkRGF0YSA9IGFbN10sIHRoaXMuX3N0YXJ0T2Zmc2V0ID0gYVs3XVswXSwgdGhpcy5fbG9jYWxUb3RhbFRpbWUgPSBhWzddWzFdKSwgYVs4XSAmJiAodGhpcy5fYWRkaXRpb25hbEluc3RhbmNlRGF0YSA9IGFbOF0pLCBhWzhdICYmICh0aGlzLl9hZGRpdGlvbmFsSW5zdGFuY2VEYXRhID0gYVs4XSksIGFbOV0gJiYgKHRoaXMuX3R5cGUgPSBhWzldKSwgYVsxMF0gJiYgKHRoaXMuX25hbWUgPSBhWzEwXSksIHRoaXMuX2tleWZyYW1lRGF0YSA9IG5ldyBDMyRqc2NvbXAkMTA3LktleWZyYW1lRGF0YShhWzRdLCB0aGlzKSwgdGhpcy5fcHJvcGVydHlUcmFja0RhdGEgPSBuZXcgQzMkanNjb21wJDEwNy5Qcm9wZXJ0eVRyYWNrRGF0YShhWzVdLCB0aGlzKSkKICAgIH0KICAgIFJlbGVhc2UoKSB7CiAgICAgICAgdGhpcy5fdHJhY2tEYXRhID0gdGhpcy5faW5zdGFuY2VEYXRhID0gbnVsbDsKICAgICAgICB0aGlzLl9rZXlmcmFtZURhdGEgJiYgKHRoaXMuX2tleWZyYW1lRGF0YS5SZWxlYXNlKCksIHRoaXMuX2tleWZyYW1lRGF0YSA9IG51bGwpOwogICAgICAgIHRoaXMuX3Byb3BlcnR5VHJhY2tEYXRhICYmICh0aGlzLl9wcm9wZXJ0eVRyYWNrRGF0YS5SZWxlYXNlKCksIHRoaXMuX3Byb3BlcnR5VHJhY2tEYXRhID0gbnVsbCk7CiAgICAgICAgdGhpcy5fbmVzdGVkRGF0YSA9IG51bGwKICAgIH0KICAgIEdldFRyYWNrRGF0YSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdHJhY2tEYXRhCiAgICB9CiAgICBHZXRLZXlmcmFtZURhdGEoKSB7CiAgICAgICAgdGhpcy5fa2V5ZnJhbWVEYXRhIHx8ICh0aGlzLl9rZXlmcmFtZURhdGEgPSBuZXcgQzMkanNjb21wJDEwNy5LZXlmcmFtZURhdGEobnVsbCwgdGhpcykpOwogICAgICAgIHJldHVybiB0aGlzLl9rZXlmcmFtZURhdGEKICAgIH0KICAgIEdldFByb3BlcnR5VHJhY2tEYXRhKCkgewogICAgICAgIHRoaXMuX3Byb3BlcnR5VHJhY2tEYXRhIHx8ICh0aGlzLl9wcm9wZXJ0eVRyYWNrRGF0YSA9IG5ldyBDMyRqc2NvbXAkMTA3LlByb3BlcnR5VHJhY2tEYXRhKG51bGwsIHRoaXMpKTsKICAgICAgICByZXR1cm4gdGhpcy5fcHJvcGVydHlUcmFja0RhdGEKICAgIH0KICAgIEdldEluc3RhbmNlRGF0YSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5faW5zdGFuY2VEYXRhCiAgICB9CiAgICBHZXRPYmplY3RDbGFzc0luZGV4KCkgewogICAgICAgIHJldHVybiB0aGlzLl9vYmplY3RDbGFzc0luZGV4CiAgICB9CiAgICBTZXRPYmplY3RDbGFzc0luZGV4KGEpIHsKICAgICAgICB0aGlzLl9vYmplY3RDbGFzc0luZGV4ID0KICAgICAgICAgICAgYQogICAgfQogICAgR2V0SW5zdGFuY2VVSUQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2luc3RhbmNlVWlkCiAgICB9CiAgICBTZXRJbnN0YW5jZVVJRChhKSB7CiAgICAgICAgdGhpcy5faW5zdGFuY2VVaWQgPSBhCiAgICB9CiAgICBHZXRJbnRlcnBvbGF0aW9uTW9kZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5faW50ZXJwb2xhdGlvbk1vZGUKICAgIH0KICAgIFNldEludGVycG9sYXRpb25Nb2RlKGEpIHsKICAgICAgICB0aGlzLl9pbnRlcnBvbGF0aW9uTW9kZSA9IGEKICAgIH0KICAgIEdldFJlc3VsdE1vZGUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3Jlc3VsdE1vZGUKICAgIH0KICAgIFNldFJlc3VsdE1vZGUoYSkgewogICAgICAgIHRoaXMuX3Jlc3VsdE1vZGUgPSBhCiAgICB9CiAgICBHZXRFbmFibGUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2VuYWJsZWQKICAgIH0KICAgIFNldEVuYWJsZShhKSB7CiAgICAgICAgdGhpcy5fZW5hYmxlZCA9ICEhYQogICAgfQogICAgR2V0SWQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2lkCiAgICB9CiAgICBHZXRTdGFydE9mZnNldCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fc3RhcnRPZmZzZXQKICAgIH0KICAgIEdldExvY2FsVG90YWxUaW1lKCkgewogICAgICAgIHJldHVybiB0aGlzLl9sb2NhbFRvdGFsVGltZQogICAgfQogICAgU2V0TG9jYWxUb3RhbFRpbWUoYSkgewogICAgICAgIHRoaXMuX2xvY2FsVG90YWxUaW1lID0gYQogICAgfQogICAgR2V0T3JpZ2luYWxXaWR0aCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fYWRkaXRpb25hbEluc3RhbmNlRGF0YVswXQogICAgfQogICAgU2V0T3JpZ2luYWxXaWR0aChhKSB7CiAgICAgICAgdGhpcy5fYWRkaXRpb25hbEluc3RhbmNlRGF0YSB8fAogICAgICAgICAgICAodGhpcy5fYWRkaXRpb25hbEluc3RhbmNlRGF0YSA9IFtdKTsKICAgICAgICB0aGlzLl9hZGRpdGlvbmFsSW5zdGFuY2VEYXRhWzBdID0gYQogICAgfQogICAgR2V0T3JpZ2luYWxIZWlnaHQoKSB7CiAgICAgICAgdGhpcy5fYWRkaXRpb25hbEluc3RhbmNlRGF0YSB8fCAodGhpcy5fYWRkaXRpb25hbEluc3RhbmNlRGF0YSA9IFtdKTsKICAgICAgICByZXR1cm4gdGhpcy5fYWRkaXRpb25hbEluc3RhbmNlRGF0YVsxXQogICAgfQogICAgU2V0T3JpZ2luYWxIZWlnaHQoYSkgewogICAgICAgIHRoaXMuX2FkZGl0aW9uYWxJbnN0YW5jZURhdGEgfHwgKHRoaXMuX2FkZGl0aW9uYWxJbnN0YW5jZURhdGEgPSBbXSk7CiAgICAgICAgdGhpcy5fYWRkaXRpb25hbEluc3RhbmNlRGF0YVsxXSA9IGEKICAgIH0KICAgIEdldFR5cGUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3R5cGUKICAgIH0KICAgIEdldE5hbWUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX25hbWUKICAgIH0KICAgIF9TYXZlVG9Kc29uKCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGtleWZyYW1lRGF0YUpzb246IHRoaXMuX2tleWZyYW1lRGF0YS5fU2F2ZVRvSnNvbigpLAogICAgICAgICAgICBwcm9wZXJ0eVRyYWNrRGF0YUpzb246IHRoaXMuX3Byb3BlcnR5VHJhY2tEYXRhLl9TYXZlVG9Kc29uKCksCiAgICAgICAgICAgIGluc3RhbmNlRGF0YTogdGhpcy5faW5zdGFuY2VEYXRhLAogICAgICAgICAgICBhZGRpdGlvbmFsSW5zdGFuY2VEYXRhOiB0aGlzLl9hZGRpdGlvbmFsSW5zdGFuY2VEYXRhLAogICAgICAgICAgICBpbnN0YW5jZVVpZDogdGhpcy5faW5zdGFuY2VVaWQsCiAgICAgICAgICAgIG9iamVjdENsYXNzSW5kZXg6IHRoaXMuX29iamVjdENsYXNzSW5kZXgsCiAgICAgICAgICAgIGludGVycG9sYXRpb25Nb2RlOiB0aGlzLl9pbnRlcnBvbGF0aW9uTW9kZSwKICAgICAgICAgICAgcmVzdWx0TW9kZTogdGhpcy5fcmVzdWx0TW9kZSwKICAgICAgICAgICAgZW5hYmxlZDogdGhpcy5fZW5hYmxlZCwKICAgICAgICAgICAgaWQ6IHRoaXMuX2lkLAogICAgICAgICAgICBuZXN0ZWREYXRhOiB0aGlzLl9uZXN0ZWREYXRhLAogICAgICAgICAgICB0eXBlOiB0aGlzLl90eXBlLAogICAgICAgICAgICBuYW1lOiB0aGlzLl9uYW1lCiAgICAgICAgfQogICAgfQogICAgX0xvYWRGcm9tSnNvbihhKSB7CiAgICAgICAgYSAmJiAodGhpcy5faW5zdGFuY2VEYXRhID0gYS5pbnN0YW5jZURhdGEsIHRoaXMuX2luc3RhbmNlVWlkID0gYS5pbnN0YW5jZVVpZCwgdGhpcy5fb2JqZWN0Q2xhc3NJbmRleCA9IGEub2JqZWN0Q2xhc3NJbmRleCwgdGhpcy5faW50ZXJwb2xhdGlvbk1vZGUgPSBhLmludGVycG9sYXRpb25Nb2RlLCB0aGlzLl9yZXN1bHRNb2RlID0gYS5yZXN1bHRNb2RlLCB0aGlzLl9lbmFibGVkID0KICAgICAgICAgICAgYS5lbmFibGVkLCB0aGlzLl9pZCA9IGEuaWQsIHRoaXMuX3R5cGUgPSBhLnR5cGUgPyBhLnR5cGUgOiAwLCB0aGlzLl9uYW1lID0gYS5uYW1lID8gYS5uYW1lIDogIiIsIHRoaXMuX2xvY2FsVG90YWxUaW1lID0gdGhpcy5fdHJhY2tEYXRhLkdldFRpbWVsaW5lRGF0YUl0ZW0oKS5HZXRUb3RhbFRpbWUoKSwgYS5uZXN0ZWREYXRhICYmICh0aGlzLl9uZXN0ZWREYXRhID0gYS5uZXN0ZWREYXRhLCB0aGlzLl9zdGFydE9mZnNldCA9IHRoaXMuX25lc3RlZERhdGFbMF0sIHRoaXMuX2xvY2FsVG90YWxUaW1lID0gdGhpcy5fbmVzdGVkRGF0YVsxXSksIGEuYWRkaXRpb25hbEluc3RhbmNlRGF0YSAmJiAodGhpcy5fYWRkaXRpb25hbEluc3RhbmNlRGF0YSA9IGEuYWRkaXRpb25hbEluc3RhbmNlRGF0YSksIHRoaXMuR2V0S2V5ZnJhbWVEYXRhKCkuX0xvYWRGcm9tSnNvbihhLmtleWZyYW1lRGF0YUpzb24pLCB0aGlzLkdldFByb3BlcnR5VHJhY2tEYXRhKCkuX0xvYWRGcm9tSnNvbihhLnByb3BlcnR5VHJhY2tEYXRhSnNvbikpCiAgICB9Cn0KQzMkanNjb21wJDEwNy5UcmFja0RhdGEgPSBjbGFzcyB7CiAgICBjb25zdHJ1Y3RvcihhLCBiKSB7CiAgICAgICAgdGhpcy5fdGltZWxpbmVEYXRhSXRlbSA9IGI7CiAgICAgICAgdGhpcy5fdHJhY2tEYXRhSXRlbXMgPSBbXTsKICAgICAgICBDMyRqc2NvbXAkMTA3LlRpbWVsaW5lRGF0YU1hbmFnZXIuX0NyZWF0ZURhdGFJdGVtcyh0aGlzLl90cmFja0RhdGFJdGVtcywgYSwgVHJhY2tEYXRhSXRlbSwgdGhpcykKICAgIH0KICAgIFJlbGVhc2UoKSB7CiAgICAgICAgdGhpcy5fdGltZWxpbmVEYXRhSXRlbSA9IG51bGw7CiAgICAgICAgZm9yIChjb25zdCBhIG9mIHRoaXMuX3RyYWNrRGF0YUl0ZW1zKSBhLlJlbGVhc2UoKTsKICAgICAgICBDMyRqc2NvbXAkMTA3LmNsZWFyQXJyYXkodGhpcy5fdHJhY2tEYXRhSXRlbXMpOwogICAgICAgIHRoaXMuX3RyYWNrRGF0YUl0ZW1zID0gbnVsbAogICAgfQogICAgR2V0VGltZWxpbmVEYXRhSXRlbSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdGltZWxpbmVEYXRhSXRlbQogICAgfQogICAgQWRkRW1wdHlUcmFja0RhdGFJdGVtKCkgewogICAgICAgIGNvbnN0IGEgPSBuZXcgVHJhY2tEYXRhSXRlbShudWxsLCB0aGlzKTsKICAgICAgICB0aGlzLl90cmFja0RhdGFJdGVtcy5wdXNoKGEpOwogICAgICAgIHJldHVybiBhCiAgICB9CiAgICBHZXRGaXJzdEtleWZyYW1lRGF0YUl0ZW0oYSkgewogICAgICAgIHJldHVybiBhLkdldEtleWZyYW1lRGF0YSgpLkdldEtleWZyYW1lRGF0YUl0ZW1BcnJheSgpWzBdCiAgICB9CiAgICBHZXRMYXN0S2V5ZnJhbWVEYXRhSXRlbShhKSB7CiAgICAgICAgcmV0dXJuIGEuR2V0S2V5ZnJhbWVEYXRhKCkuR2V0S2V5ZnJhbWVEYXRhSXRlbUFycmF5KCkuYXQoLTEpCiAgICB9CiAgICBHZXRLZXlGcmFtZURhdGFJdGVtQXRUaW1lKGEsCiAgICAgICAgYikgewogICAgICAgIGIgPSBiLkdldEtleWZyYW1lRGF0YSgpLkdldEtleWZyYW1lRGF0YUl0ZW1BcnJheSgpOwogICAgICAgIGNvbnN0IGQgPSBiLmxlbmd0aDsKICAgICAgICBmb3IgKGxldCBjID0gMDsgYyA8IGQ7IGMrKykgewogICAgICAgICAgICBjb25zdCBlID0gYltjXTsKICAgICAgICAgICAgaWYgKGUuR2V0VGltZSgpID09PSBhKSByZXR1cm4gZQogICAgICAgIH0KICAgIH0KICAgIEdldEZpcnN0S2V5RnJhbWVEYXRhSXRlbUhpZ2hlclRoYW4oYSwgYikgewogICAgICAgIGIgPSBiLkdldEtleWZyYW1lRGF0YSgpLkdldEtleWZyYW1lRGF0YUl0ZW1BcnJheSgpOwogICAgICAgIGNvbnN0IGQgPSBiLmxlbmd0aDsKICAgICAgICBmb3IgKGxldCBjID0gMDsgYyA8IGQ7IGMrKykgewogICAgICAgICAgICBjb25zdCBlID0gYltjXTsKICAgICAgICAgICAgaWYgKGUuR2V0VGltZSgpID4gYSkgcmV0dXJuIGUKICAgICAgICB9CiAgICB9CiAgICBHZXRGaXJzdEtleUZyYW1lRGF0YUl0ZW1IaWdoZXJPckVxdWFsVGhhbihhLCBiKSB7CiAgICAgICAgYiA9IGIuR2V0S2V5ZnJhbWVEYXRhKCkuR2V0S2V5ZnJhbWVEYXRhSXRlbUFycmF5KCk7CiAgICAgICAgY29uc3QgZCA9IGIubGVuZ3RoOwogICAgICAgIGZvciAobGV0IGMgPSAwOyBjIDwgZDsgYysrKSB7CiAgICAgICAgICAgIGNvbnN0IGUgPSBiW2NdOwogICAgICAgICAgICBpZiAoZS5HZXRUaW1lKCkgPj0gYSkgcmV0dXJuIGUKICAgICAgICB9CiAgICB9CiAgICBHZXRGaXJzdEtleUZyYW1lRGF0YUl0ZW1Mb3dlck9yRXF1YWxUaGFuKGEsCiAgICAgICAgYikgewogICAgICAgIGIgPSBiLkdldEtleWZyYW1lRGF0YSgpLkdldEtleWZyYW1lRGF0YUl0ZW1BcnJheSgpOwogICAgICAgIGZvciAobGV0IGQgPSBiLmxlbmd0aCAtIDE7IDAgPD0gZDsgZC0tKSB7CiAgICAgICAgICAgIGNvbnN0IGMgPSBiW2RdOwogICAgICAgICAgICBpZiAoYy5HZXRUaW1lKCkgPD0gYSkgcmV0dXJuIGMKICAgICAgICB9CiAgICB9KiB0cmFja0RhdGFJdGVtcygpIHsKICAgICAgICBmb3IgKGNvbnN0IGEgb2YgdGhpcy5fdHJhY2tEYXRhSXRlbXMpIHlpZWxkIGEKICAgIH0KICAgIF9TYXZlVG9Kc29uKCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHRyYWNrRGF0YUl0ZW1zSnNvbjogdGhpcy5fdHJhY2tEYXRhSXRlbXMubWFwKGEgPT4gYS5fU2F2ZVRvSnNvbigpKQogICAgICAgIH0KICAgIH0KICAgIF9Mb2FkRnJvbUpzb24oYSkgewogICAgICAgIGEgJiYgQzMkanNjb21wJDEwNy5UaW1lbGluZURhdGFNYW5hZ2VyLl9Mb2FkRGF0YUl0ZW1zRnJvbUpzb24odGhpcy5fdHJhY2tEYXRhSXRlbXMsIGEudHJhY2tEYXRhSXRlbXNKc29uLCBUcmFja0RhdGFJdGVtLCB0aGlzKQogICAgfQp9OwoidXNlIHN0cmljdCI7CmNvbnN0IEMzJGpzY29tcCQxMDggPSBzZWxmLkMzOwpjbGFzcyBQcm9wZXJ0eVRyYWNrRGF0YUl0ZW0gewogICAgY29uc3RydWN0b3IoYSwgYikgewogICAgICAgIHRoaXMuX3Byb3BlcnR5VHJhY2tEYXRhID0gYjsKICAgICAgICB0aGlzLl9zb3VyY2VBZGFwdGVySWQgPSAiIjsKICAgICAgICB0aGlzLl90eXBlID0gdGhpcy5fcHJvcGVydHkgPSB0aGlzLl9zb3VyY2VBZGFwdGVyQXJndW1lbnRzID0gbnVsbDsKICAgICAgICB0aGlzLl9tYXggPSB0aGlzLl9taW4gPSBOYU47CiAgICAgICAgdGhpcy5fcmVzdWx0TW9kZSA9IHRoaXMuX2ludGVycG9sYXRpb25Nb2RlID0gImRlZmF1bHQiOwogICAgICAgIHRoaXMuX2VuYWJsZWQgPSAhMTsKICAgICAgICB0aGlzLl9wcm9wZXJ0eUtleWZyYW1lRGF0YSA9IG51bGw7CiAgICAgICAgdGhpcy5fY2FuSGF2ZVByb3BlcnR5S2V5ZnJhbWVzID0gITA7CiAgICAgICAgYSAmJiAodGhpcy5fc291cmNlQWRhcHRlcklkID0gYVswXVswXSwgdGhpcy5fc291cmNlQWRhcHRlckFyZ3VtZW50cyA9IGFbMF0uc2xpY2UoMSksIHRoaXMuX3Byb3BlcnR5ID0gYVsxXSwgdGhpcy5fdHlwZSA9IGFbMl0sIHRoaXMuX21pbiA9IGFbM10sIHRoaXMuX21heCA9IGFbNF0sIHRoaXMuX2ludGVycG9sYXRpb25Nb2RlID0gYVs1XSwgdGhpcy5fcmVzdWx0TW9kZSA9CiAgICAgICAgICAgIGFbNl0sIHRoaXMuX2VuYWJsZWQgPSAhIWFbN10sIHRoaXMuX3Byb3BlcnR5S2V5ZnJhbWVEYXRhID0gbmV3IEMzJGpzY29tcCQxMDguUHJvcGVydHlLZXlmcmFtZURhdGEoYVs4XSwgdGhpcyksIHRoaXMuX2NhbkhhdmVQcm9wZXJ0eUtleWZyYW1lcyA9IGFbOV0pCiAgICB9CiAgICBSZWxlYXNlKCkgewogICAgICAgIHRoaXMuX3Byb3BlcnR5S2V5ZnJhbWVEYXRhLlJlbGVhc2UoKTsKICAgICAgICB0aGlzLl9zb3VyY2VBZGFwdGVyQXJndW1lbnRzID0gdGhpcy5fcHJvcGVydHlUcmFja0RhdGEgPSB0aGlzLl9wcm9wZXJ0eUtleWZyYW1lRGF0YSA9IG51bGwKICAgIH0KICAgIEdldFByb3BlcnR5VHJhY2tEYXRhKCkgewogICAgICAgIHJldHVybiB0aGlzLl9wcm9wZXJ0eVRyYWNrRGF0YQogICAgfQogICAgR2V0UHJvcGVydHlLZXlmcmFtZURhdGEoKSB7CiAgICAgICAgdGhpcy5fcHJvcGVydHlLZXlmcmFtZURhdGEgfHwgKHRoaXMuX3Byb3BlcnR5S2V5ZnJhbWVEYXRhID0gbmV3IEMzJGpzY29tcCQxMDguUHJvcGVydHlLZXlmcmFtZURhdGEobnVsbCwgdGhpcykpOwogICAgICAgIHJldHVybiB0aGlzLl9wcm9wZXJ0eUtleWZyYW1lRGF0YQogICAgfQogICAgR2V0U291cmNlQWRhcHRlcklkKCkgewogICAgICAgIHJldHVybiB0aGlzLl9zb3VyY2VBZGFwdGVySWQKICAgIH0KICAgIFNldFNvdXJjZUFkYXB0ZXJJZChhKSB7CiAgICAgICAgdGhpcy5fc291cmNlQWRhcHRlcklkID0KICAgICAgICAgICAgYQogICAgfQogICAgR2V0U291cmNlQWRhcHRlckFyZ3VtZW50cygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fc291cmNlQWRhcHRlckFyZ3VtZW50cwogICAgfQogICAgU2V0U291cmNlQWRhcHRlckFyZ3VtZW50cyhhKSB7CiAgICAgICAgdGhpcy5fc291cmNlQWRhcHRlckFyZ3VtZW50cyA9IGEKICAgIH0KICAgIEdldFByb3BlcnR5KCkgewogICAgICAgIHJldHVybiB0aGlzLl9wcm9wZXJ0eQogICAgfQogICAgU2V0UHJvcGVydHkoYSkgewogICAgICAgIHRoaXMuX3Byb3BlcnR5ID0gYQogICAgfQogICAgR2V0VHlwZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdHlwZQogICAgfQogICAgU2V0VHlwZShhKSB7CiAgICAgICAgdGhpcy5fdHlwZSA9IGEKICAgIH0KICAgIEdldE1pbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5fbWluCiAgICB9CiAgICBTZXRNaW4oYSkgewogICAgICAgIHRoaXMuX21pbiA9IGEKICAgIH0KICAgIEdldE1heCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fbWF4CiAgICB9CiAgICBTZXRNYXgoYSkgewogICAgICAgIHRoaXMuX21heCA9IGEKICAgIH0KICAgIEdldEludGVycG9sYXRpb25Nb2RlKCkgewogICAgICAgIHJldHVybiB0aGlzLl9pbnRlcnBvbGF0aW9uTW9kZQogICAgfQogICAgU2V0SW50ZXJwb2xhdGlvbk1vZGUoYSkgewogICAgICAgIHRoaXMuX2ludGVycG9sYXRpb25Nb2RlID0gYQogICAgfQogICAgR2V0UmVzdWx0TW9kZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcmVzdWx0TW9kZQogICAgfQogICAgU2V0UmVzdWx0TW9kZShhKSB7CiAgICAgICAgdGhpcy5fcmVzdWx0TW9kZSA9CiAgICAgICAgICAgIGEKICAgIH0KICAgIEdldEVuYWJsZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZW5hYmxlZAogICAgfQogICAgU2V0RW5hYmxlKGEpIHsKICAgICAgICB0aGlzLl9lbmFibGVkID0gISFhCiAgICB9CiAgICBDYW5IYXZlUHJvcGVydHlLZXlmcmFtZXMoKSB7CiAgICAgICAgcmV0dXJuICEhdGhpcy5fY2FuSGF2ZVByb3BlcnR5S2V5ZnJhbWVzCiAgICB9CiAgICBfU2F2ZVRvSnNvbigpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBwcm9wZXJ0eUtleWZyYW1lRGF0YUpzb246IHRoaXMuX3Byb3BlcnR5S2V5ZnJhbWVEYXRhLl9TYXZlVG9Kc29uKCksCiAgICAgICAgICAgIHNvdXJjZUFkYXB0ZXJJZDogdGhpcy5fc291cmNlQWRhcHRlcklkLAogICAgICAgICAgICBzb3VyY2VBZGFwdGVyQXJndW1lbnRzOiB0aGlzLl9zb3VyY2VBZGFwdGVyQXJndW1lbnRzLAogICAgICAgICAgICBwcm9wZXJ0eTogdGhpcy5fcHJvcGVydHksCiAgICAgICAgICAgIHR5cGU6IHRoaXMuX3R5cGUsCiAgICAgICAgICAgIG1pbjogdGhpcy5fbWluLAogICAgICAgICAgICBtYXg6IHRoaXMuX21heCwKICAgICAgICAgICAgaW50ZXJwb2xhdGlvbk1vZGU6IHRoaXMuX2ludGVycG9sYXRpb25Nb2RlLAogICAgICAgICAgICByZXN1bHRNb2RlOiB0aGlzLl9yZXN1bHRNb2RlLAogICAgICAgICAgICBlbmFibGVkOiB0aGlzLl9lbmFibGVkLAogICAgICAgICAgICBjYW5IYXZlUHJvcGVydHlLZXlmcmFtZXM6IHRoaXMuX2NhbkhhdmVQcm9wZXJ0eUtleWZyYW1lcwogICAgICAgIH0KICAgIH0KICAgIF9Mb2FkRnJvbUpzb24oYSkgewogICAgICAgIGEgJiYKICAgICAgICAgICAgKHRoaXMuX3NvdXJjZUFkYXB0ZXJJZCA9IGEuc291cmNlQWRhcHRlcklkLCB0aGlzLl9zb3VyY2VBZGFwdGVyQXJndW1lbnRzID0gYS5zb3VyY2VBZGFwdGVyQXJndW1lbnRzLCB0aGlzLl9wcm9wZXJ0eSA9IGEucHJvcGVydHksIHRoaXMuX3R5cGUgPSBhLnR5cGUsIHRoaXMuX21pbiA9IGEubWluLCB0aGlzLl9tYXggPSBhLm1heCwgdGhpcy5faW50ZXJwb2xhdGlvbk1vZGUgPSBhLmludGVycG9sYXRpb25Nb2RlLCB0aGlzLl9yZXN1bHRNb2RlID0gYS5yZXN1bHRNb2RlLCB0aGlzLl9lbmFibGVkID0gYS5lbmFibGVkLCB0aGlzLl9jYW5IYXZlUHJvcGVydHlLZXlmcmFtZXMgPSBhLmNhbkhhdmVQcm9wZXJ0eUtleWZyYW1lcywgdGhpcy5HZXRQcm9wZXJ0eUtleWZyYW1lRGF0YSgpLl9Mb2FkRnJvbUpzb24oYS5wcm9wZXJ0eUtleWZyYW1lRGF0YUpzb24pKQogICAgfQp9CkMzJGpzY29tcCQxMDguUHJvcGVydHlUcmFja0RhdGEgPSBjbGFzcyB7CiAgICBjb25zdHJ1Y3RvcihhLCBiKSB7CiAgICAgICAgdGhpcy5fdHJhY2tEYXRhSXRlbSA9IGI7CiAgICAgICAgdGhpcy5fcHJvcGVydHlUcmFja0RhdGFJdGVtcyA9IFtdOwogICAgICAgIEMzJGpzY29tcCQxMDguVGltZWxpbmVEYXRhTWFuYWdlci5fQ3JlYXRlRGF0YUl0ZW1zKHRoaXMuX3Byb3BlcnR5VHJhY2tEYXRhSXRlbXMsIGEsIFByb3BlcnR5VHJhY2tEYXRhSXRlbSwgdGhpcykKICAgIH0KICAgIFJlbGVhc2UoKSB7CiAgICAgICAgdGhpcy5fdHJhY2tEYXRhSXRlbSA9IG51bGw7CiAgICAgICAgZm9yIChjb25zdCBhIG9mIHRoaXMuX3Byb3BlcnR5VHJhY2tEYXRhSXRlbXMpIGEuUmVsZWFzZSgpOwogICAgICAgIEMzJGpzY29tcCQxMDguY2xlYXJBcnJheSh0aGlzLl9wcm9wZXJ0eVRyYWNrRGF0YUl0ZW1zKTsKICAgICAgICB0aGlzLl9wcm9wZXJ0eVRyYWNrRGF0YUl0ZW1zID0gbnVsbAogICAgfQogICAgR2V0VHJhY2tEYXRhSXRlbSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdHJhY2tEYXRhSXRlbQogICAgfQogICAgQWRkRW1wdHlQcm9wZXJ0eVRyYWNrRGF0YUl0ZW0oKSB7CiAgICAgICAgY29uc3QgYSA9IG5ldyBQcm9wZXJ0eVRyYWNrRGF0YUl0ZW0obnVsbCwKICAgICAgICAgICAgdGhpcyk7CiAgICAgICAgdGhpcy5fcHJvcGVydHlUcmFja0RhdGFJdGVtcy5wdXNoKGEpOwogICAgICAgIHJldHVybiBhCiAgICB9CiAgICBHZXRGaXJzdFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbShhKSB7CiAgICAgICAgcmV0dXJuIGEuR2V0UHJvcGVydHlLZXlmcmFtZURhdGEoKS5HZXRQcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW1BcnJheSgpWzBdCiAgICB9CiAgICBHZXRMYXN0UHJvcGVydHlLZXlmcmFtZURhdGFJdGVtKGEpIHsKICAgICAgICByZXR1cm4gYS5HZXRQcm9wZXJ0eUtleWZyYW1lRGF0YSgpLkdldFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbUFycmF5KCkuYXQoLTEpCiAgICB9CiAgICBHZXRQcm9wZXJ0eUtleUZyYW1lRGF0YUl0ZW1BdFRpbWUoYSwgYikgewogICAgICAgIGIgPSBiLkdldFByb3BlcnR5S2V5ZnJhbWVEYXRhKCkuR2V0UHJvcGVydHlLZXlmcmFtZURhdGFJdGVtQXJyYXkoKTsKICAgICAgICBjb25zdCBkID0gYi5sZW5ndGg7CiAgICAgICAgZm9yIChsZXQgYyA9IDA7IGMgPCBkOyBjKyspIHsKICAgICAgICAgICAgY29uc3QgZSA9IGJbY107CiAgICAgICAgICAgIGlmIChlLkdldFRpbWUoKSA9PT0gYSkgcmV0dXJuIGUKICAgICAgICB9CiAgICB9CiAgICBHZXRGaXJzdFByb3BlcnR5S2V5RnJhbWVEYXRhSXRlbUhpZ2hlclRoYW4oYSwKICAgICAgICBiKSB7CiAgICAgICAgYiA9IGIuR2V0UHJvcGVydHlLZXlmcmFtZURhdGEoKS5HZXRQcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW1BcnJheSgpOwogICAgICAgIGNvbnN0IGQgPSBiLmxlbmd0aDsKICAgICAgICBmb3IgKGxldCBjID0gMDsgYyA8IGQ7IGMrKykgewogICAgICAgICAgICBjb25zdCBlID0gYltjXTsKICAgICAgICAgICAgaWYgKGUuR2V0VGltZSgpID4gYSkgcmV0dXJuIGUKICAgICAgICB9CiAgICB9CiAgICBHZXRGaXJzdFByb3BlcnR5S2V5RnJhbWVEYXRhSXRlbUhpZ2hlck9yRXF1YWxUaGFuKGEsIGIpIHsKICAgICAgICBiID0gYi5HZXRQcm9wZXJ0eUtleWZyYW1lRGF0YSgpLkdldFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbUFycmF5KCk7CiAgICAgICAgY29uc3QgZCA9IGIubGVuZ3RoOwogICAgICAgIGZvciAobGV0IGMgPSAwOyBjIDwgZDsgYysrKSB7CiAgICAgICAgICAgIGNvbnN0IGUgPSBiW2NdOwogICAgICAgICAgICBpZiAoZS5HZXRUaW1lKCkgPj0gYSkgcmV0dXJuIGUKICAgICAgICB9CiAgICB9CiAgICBHZXRGaXJzdFByb3BlcnR5S2V5RnJhbWVEYXRhSXRlbUxvd2VyT3JFcXVhbFRoYW4oYSwgYikgewogICAgICAgIGIgPSBiLkdldFByb3BlcnR5S2V5ZnJhbWVEYXRhKCkuR2V0UHJvcGVydHlLZXlmcmFtZURhdGFJdGVtQXJyYXkoKTsKICAgICAgICBmb3IgKGxldCBkID0gYi5sZW5ndGggLSAxOyAwIDw9IGQ7IGQtLSkgewogICAgICAgICAgICBjb25zdCBjID0KICAgICAgICAgICAgICAgIGJbZF07CiAgICAgICAgICAgIGlmIChjLkdldFRpbWUoKSA8PSBhKSByZXR1cm4gYwogICAgICAgIH0KICAgIH0qIHByb3BlcnR5VHJhY2tEYXRhSXRlbXMoKSB7CiAgICAgICAgZm9yIChjb25zdCBhIG9mIHRoaXMuX3Byb3BlcnR5VHJhY2tEYXRhSXRlbXMpIHlpZWxkIGEKICAgIH0KICAgIF9TYXZlVG9Kc29uKCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHByb3BlcnR5VHJhY2tEYXRhSXRlbXNKc29uOiB0aGlzLl9wcm9wZXJ0eVRyYWNrRGF0YUl0ZW1zLm1hcChhID0+IGEuX1NhdmVUb0pzb24oKSkKICAgICAgICB9CiAgICB9CiAgICBfTG9hZEZyb21Kc29uKGEpIHsKICAgICAgICBhICYmIEMzJGpzY29tcCQxMDguVGltZWxpbmVEYXRhTWFuYWdlci5fTG9hZERhdGFJdGVtc0Zyb21Kc29uKHRoaXMuX3Byb3BlcnR5VHJhY2tEYXRhSXRlbXMsIGEucHJvcGVydHlUcmFja0RhdGFJdGVtc0pzb24sIFByb3BlcnR5VHJhY2tEYXRhSXRlbSwgdGhpcykKICAgIH0KfTsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkMTA5ID0gc2VsZi5DMzsKY2xhc3MgS2V5ZnJhbWVEYXRhSXRlbSB7CiAgICBjb25zdHJ1Y3RvcihhLCBiKSB7CiAgICAgICAgdGhpcy5fa2V5ZnJhbWVEYXRhID0gYjsKICAgICAgICB0aGlzLl90aW1lID0gLTE7CiAgICAgICAgdGhpcy5fZWFzZSA9ICJub2Vhc2UiOwogICAgICAgIHRoaXMuX2VuYWJsZSA9ICExOwogICAgICAgIHRoaXMuX2xvd2VyVGFncyA9IHRoaXMuX3RhZ3MgPSBudWxsOwogICAgICAgIGEgJiYgKHRoaXMuX3RpbWUgPSBhWzBdLCB0aGlzLl9lYXNlID0gYVsxXSwgdGhpcy5fZW5hYmxlID0gISFhWzJdLCB0aGlzLl90YWdzID0gKGEgPSBhWzNdKSA/IGEuc3BsaXQoIiAiKSA6IFtdLCB0aGlzLl9sb3dlclRhZ3MgPSBuZXcgU2V0KHRoaXMuX3RhZ3MubWFwKGQgPT4gZC50b0xvd2VyQ2FzZSgpKSksIHRoaXMuX25leHQgPSBudWxsKQogICAgfQogICAgUmVsZWFzZSgpIHsKICAgICAgICB0aGlzLl9rZXlmcmFtZURhdGEgPSBudWxsOwogICAgICAgIEMzJGpzY29tcCQxMDkuY2xlYXJBcnJheSh0aGlzLl90YWdzKTsKICAgICAgICB0aGlzLl90YWdzID0gbnVsbDsKICAgICAgICB0aGlzLl9sb3dlclRhZ3MuY2xlYXIoKTsKICAgICAgICB0aGlzLl9sb3dlclRhZ3MgPSBudWxsCiAgICB9CiAgICBHZXRLZXlmcmFtZURhdGEoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2tleWZyYW1lRGF0YQogICAgfQogICAgR2V0TmV4dCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fbmV4dAogICAgfQogICAgU2V0TmV4dChhKSB7CiAgICAgICAgdGhpcy5fbmV4dCA9CiAgICAgICAgICAgIGEKICAgIH0KICAgIEdldFRpbWUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3RpbWUKICAgIH0KICAgIFNldFRpbWUoYSkgewogICAgICAgIHRoaXMuX3RpbWUgPSBhOwogICAgICAgIHRoaXMuX2tleWZyYW1lRGF0YS5fTGlua0tleWZyYW1lRGF0YUl0ZW1zKCkKICAgIH0KICAgIEdldEVhc2UoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2Vhc2UKICAgIH0KICAgIFNldEVhc2UoYSkgewogICAgICAgIHRoaXMuX2Vhc2UgPSBhCiAgICB9CiAgICBHZXRFbmFibGUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2VuYWJsZQogICAgfQogICAgU2V0RW5hYmxlKGEpIHsKICAgICAgICB0aGlzLl9lbmFibGUgPSAhIWEKICAgIH0KICAgIEdldFRhZ3MoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3RhZ3MKICAgIH0KICAgIFNldFRhZ3MoYSkgewogICAgICAgIHRoaXMuX3RhZ3MgPSBhID8gYS5zcGxpdCgiICIpIDogW107CiAgICAgICAgdGhpcy5fbG93ZXJUYWdzID0gbmV3IFNldCh0aGlzLl90YWdzLm1hcChiID0+IGIudG9Mb3dlckNhc2UoKSkpCiAgICB9CiAgICBHZXRMb3dlclRhZ3MoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2xvd2VyVGFncwogICAgfQogICAgSGFzVGFnKGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5fbG93ZXJUYWdzLmhhcyhhLnRvTG93ZXJDYXNlKCkpCiAgICB9CiAgICBfU2F2ZVRvSnNvbigpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICB0aW1lOiB0aGlzLl90aW1lLAogICAgICAgICAgICBlYXNlOiB0aGlzLl9lYXNlLAogICAgICAgICAgICBlbmFibGU6IHRoaXMuX2VuYWJsZSwKICAgICAgICAgICAgdGFnczogdGhpcy5fdGFncwogICAgICAgIH0KICAgIH0KICAgIF9Mb2FkRnJvbUpzb24oYSkgewogICAgICAgIGEgJiYgKHRoaXMuX3RpbWUgPSBhLnRpbWUsIHRoaXMuX2Vhc2UgPSBhLmVhc2UsIHRoaXMuX2VuYWJsZSA9IGEuZW5hYmxlLCB0aGlzLl90YWdzID0gYS50YWdzLCB0aGlzLl9sb3dlclRhZ3MgPSBuZXcgU2V0KHRoaXMuX3RhZ3MubWFwKGIgPT4gYi50b0xvd2VyQ2FzZSgpKSkpCiAgICB9Cn0KQzMkanNjb21wJDEwOS5LZXlmcmFtZURhdGEgPSBjbGFzcyB7CiAgICBjb25zdHJ1Y3RvcihhLCBiKSB7CiAgICAgICAgdGhpcy5fdHJhY2tEYXRhSXRlbSA9IGI7CiAgICAgICAgdGhpcy5fa2V5ZnJhbWVEYXRhSXRlbXMgPSBbXTsKICAgICAgICBDMyRqc2NvbXAkMTA5LlRpbWVsaW5lRGF0YU1hbmFnZXIuX0NyZWF0ZURhdGFJdGVtcyh0aGlzLl9rZXlmcmFtZURhdGFJdGVtcywgYSwgS2V5ZnJhbWVEYXRhSXRlbSwgdGhpcyk7CiAgICAgICAgdGhpcy5fTGlua0tleWZyYW1lRGF0YUl0ZW1zKCkKICAgIH0KICAgIFJlbGVhc2UoKSB7CiAgICAgICAgdGhpcy5fdHJhY2tEYXRhSXRlbSA9IG51bGw7CiAgICAgICAgZm9yIChjb25zdCBhIG9mIHRoaXMuX2tleWZyYW1lRGF0YUl0ZW1zKSBhLlJlbGVhc2UoKTsKICAgICAgICBDMyRqc2NvbXAkMTA5LmNsZWFyQXJyYXkodGhpcy5fa2V5ZnJhbWVEYXRhSXRlbXMpOwogICAgICAgIHRoaXMuX2tleWZyYW1lRGF0YUl0ZW1zID0gbnVsbAogICAgfQogICAgX0xpbmtLZXlmcmFtZURhdGFJdGVtcygpIHsKICAgICAgICB0aGlzLl9rZXlmcmFtZURhdGFJdGVtcy5zb3J0KChhLCBiKSA9PiBhLkdldFRpbWUoKSAtIGIuR2V0VGltZSgpKTsKICAgICAgICBmb3IgKGxldCBhID0gMDsgYSA8IHRoaXMuX2tleWZyYW1lRGF0YUl0ZW1zLmxlbmd0aDsgYSsrKSB0aGlzLl9rZXlmcmFtZURhdGFJdGVtc1thXS5TZXROZXh0KHRoaXMuX2tleWZyYW1lRGF0YUl0ZW1zW2EgKwogICAgICAgICAgICAxXSkKICAgIH0KICAgIEdldFRyYWNrRGF0YUl0ZW0oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3RyYWNrRGF0YUl0ZW0KICAgIH0KICAgIEdldEtleWZyYW1lRGF0YUl0ZW1Db3VudCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fa2V5ZnJhbWVEYXRhSXRlbXMubGVuZ3RoCiAgICB9CiAgICBHZXRLZXlmcmFtZURhdGFJdGVtQXJyYXkoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2tleWZyYW1lRGF0YUl0ZW1zCiAgICB9CiAgICBBZGRFbXB0eUtleWZyYW1lRGF0YUl0ZW0oKSB7CiAgICAgICAgY29uc3QgYSA9IG5ldyBLZXlmcmFtZURhdGFJdGVtKG51bGwsIHRoaXMpOwogICAgICAgIHRoaXMuX2tleWZyYW1lRGF0YUl0ZW1zLnB1c2goYSk7CiAgICAgICAgdGhpcy5fTGlua0tleWZyYW1lRGF0YUl0ZW1zKCk7CiAgICAgICAgcmV0dXJuIGEKICAgIH0KICAgIERlbGV0ZUtleWZyYW1lRGF0YUl0ZW1zKGEpIHsKICAgICAgICBmb3IgKGNvbnN0IGIgb2YgdGhpcy5fa2V5ZnJhbWVEYXRhSXRlbXMpIHsKICAgICAgICAgICAgaWYgKCFhKGIpKSBjb250aW51ZTsKICAgICAgICAgICAgY29uc3QgZCA9IHRoaXMuX2tleWZyYW1lRGF0YUl0ZW1zLmluZGV4T2YoYik7IC0gMSAhPT0gZCAmJiAoYi5SZWxlYXNlKCksIHRoaXMuX2tleWZyYW1lRGF0YUl0ZW1zLnNwbGljZShkLCAxKSkKICAgICAgICB9CiAgICAgICAgdGhpcy5Tb3J0S2V5ZnJhbWVEYXRhSXRlbXMoKTsKICAgICAgICB0aGlzLl9MaW5rS2V5ZnJhbWVEYXRhSXRlbXMoKQogICAgfQogICAgU29ydEtleWZyYW1lRGF0YUl0ZW1zKCkgewogICAgICAgIHRoaXMuX2tleWZyYW1lRGF0YUl0ZW1zLnNvcnQoKGEsIGIpID0+IGEuR2V0VGltZSgpIC0gYi5HZXRUaW1lKCkpCiAgICB9CiAgICBHZXRLZXlmcmFtZURhdGFJdGVtSW5kZXgoYSkgewogICAgICAgIHJldHVybiB0aGlzLl9rZXlmcmFtZURhdGFJdGVtcy5pbmRleE9mKGEpCiAgICB9CiAgICBHZXRLZXlmcmFtZURhdGFJdGVtRnJvbUluZGV4KGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5fa2V5ZnJhbWVEYXRhSXRlbXNbYV0KICAgIH0qIGtleWZyYW1lRGF0YUl0ZW1zKCkgewogICAgICAgIGZvciAoY29uc3QgYSBvZiB0aGlzLl9rZXlmcmFtZURhdGFJdGVtcykgeWllbGQgYQogICAgfSoga2V5ZnJhbWVEYXRhSXRlbXNSZXZlcnNlKCkgewogICAgICAgIGZvciAobGV0IGEgPSB0aGlzLl9rZXlmcmFtZURhdGFJdGVtcy5sZW5ndGggLSAxOyAwIDw9IGE7IGEtLSkgeWllbGQgdGhpcy5fa2V5ZnJhbWVEYXRhSXRlbXNbYV0KICAgIH0KICAgIF9TYXZlVG9Kc29uKCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGtleWZyYW1lRGF0YUl0ZW1zSnNvbjogdGhpcy5fa2V5ZnJhbWVEYXRhSXRlbXMubWFwKGEgPT4KICAgICAgICAgICAgICAgIGEuX1NhdmVUb0pzb24oKSkKICAgICAgICB9CiAgICB9CiAgICBfTG9hZEZyb21Kc29uKGEpIHsKICAgICAgICBhICYmIChDMyRqc2NvbXAkMTA5LlRpbWVsaW5lRGF0YU1hbmFnZXIuX0xvYWREYXRhSXRlbXNGcm9tSnNvbih0aGlzLl9rZXlmcmFtZURhdGFJdGVtcywgYS5rZXlmcmFtZURhdGFJdGVtc0pzb24sIEtleWZyYW1lRGF0YUl0ZW0sIHRoaXMpLCB0aGlzLl9MaW5rS2V5ZnJhbWVEYXRhSXRlbXMoKSkKICAgIH0KfTsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkMTEwID0gc2VsZi5DMzsKY2xhc3MgUHJvcGVydHlLZXlmcmFtZURhdGFJdGVtIHsKICAgIGNvbnN0cnVjdG9yKGEsIGIpIHsKICAgICAgICB0aGlzLl9wcm9wZXJ0eUtleWZyYW1lRGF0YSA9IGI7CiAgICAgICAgdGhpcy5fYVZhbHVlID0gdGhpcy5fdmFsdWUgPSBudWxsOwogICAgICAgIHRoaXMuX3R5cGUgPSAiIjsKICAgICAgICB0aGlzLl90aW1lID0gTmFOOwogICAgICAgIHRoaXMuX2Vhc2UgPSAibm9lYXNlIjsKICAgICAgICB0aGlzLl9lbmFibGUgPSAhMTsKICAgICAgICB0aGlzLl9hZGRvbkRhdGEgPSBudWxsOwogICAgICAgIHRoaXMuX2FkZG9uSW5zdGFuY2UgPSB2b2lkIDA7CiAgICAgICAgYSAmJiAodGhpcy5fdmFsdWUgPSBhWzBdWzBdLCB0aGlzLl9hVmFsdWUgPSBhWzBdWzFdLCB0aGlzLl90eXBlID0gYVswXVsyXSwgdGhpcy5fdGltZSA9IGFbMV0sIHRoaXMuX2Vhc2UgPSBhWzJdLCB0aGlzLl9lbmFibGUgPSAhIWFbM10sIHRoaXMuX2FkZG9uRGF0YSA9IG51bGwsIGFbNF0gJiYgKHRoaXMuX2FkZG9uRGF0YSA9IG5ldyBDMyRqc2NvbXAkMTEwLkFkZG9uRGF0YShhWzRdLCB0aGlzKSksIHRoaXMuX25leHQgPSBudWxsKQogICAgfQogICAgUmVsZWFzZSgpIHsKICAgICAgICB0aGlzLl9wcm9wZXJ0eUtleWZyYW1lRGF0YSA9IG51bGw7CiAgICAgICAgdGhpcy5fYWRkb25EYXRhICYmICh0aGlzLl9hZGRvbkRhdGEuUmVsZWFzZSgpLAogICAgICAgICAgICB0aGlzLl9hZGRvbkRhdGEgPSBudWxsKQogICAgfQogICAgR2V0QWRkb25EYXRhKCkgewogICAgICAgIHJldHVybiB0aGlzLl9hZGRvbkRhdGEKICAgIH0KICAgIFNldE5leHQoYSkgewogICAgICAgIHRoaXMuX25leHQgPSBhCiAgICB9CiAgICBHZXROZXh0KCkgewogICAgICAgIHJldHVybiB0aGlzLl9uZXh0CiAgICB9CiAgICBHZXRWYWx1ZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdmFsdWUKICAgIH0KICAgIFNldFZhbHVlKGEpIHsKICAgICAgICAiY29sb3IiID09PSB0aGlzLl90eXBlICYmIEMzJGpzY29tcCQxMTAuSXNGaW5pdGVOdW1iZXIoYSkgPyAodGhpcy5fdmFsdWVbMF0gPSBDMyRqc2NvbXAkMTEwLkdldFJWYWx1ZShhKSwgdGhpcy5fdmFsdWVbMV0gPSBDMyRqc2NvbXAkMTEwLkdldEdWYWx1ZShhKSwgdGhpcy5fdmFsdWVbMl0gPSBDMyRqc2NvbXAkMTEwLkdldEJWYWx1ZShhKSkgOiB0aGlzLl92YWx1ZSA9IGEKICAgIH0KICAgIEdldEFic29sdXRlVmFsdWUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2FWYWx1ZQogICAgfQogICAgU2V0QWJzb2x1dGVWYWx1ZShhKSB7CiAgICAgICAgImNvbG9yIiA9PT0gdGhpcy5fdHlwZSAmJiBDMyRqc2NvbXAkMTEwLklzRmluaXRlTnVtYmVyKGEpID8gKHRoaXMuX2FWYWx1ZVswXSA9IEMzJGpzY29tcCQxMTAuR2V0UlZhbHVlKGEpLAogICAgICAgICAgICB0aGlzLl9hVmFsdWVbMV0gPSBDMyRqc2NvbXAkMTEwLkdldEdWYWx1ZShhKSwgdGhpcy5fYVZhbHVlWzJdID0gQzMkanNjb21wJDExMC5HZXRCVmFsdWUoYSkpIDogdGhpcy5fYVZhbHVlID0gYQogICAgfQogICAgR2V0VmFsdWVXaXRoUmVzdWx0TW9kZSgpIHsKICAgICAgICBjb25zdCBhID0gdGhpcy5fcHJvcGVydHlLZXlmcmFtZURhdGEuR2V0UHJvcGVydHlUcmFja0RhdGFJdGVtKCkuR2V0UmVzdWx0TW9kZSgpOwogICAgICAgIGlmICgicmVsYXRpdmUiID09PSBhKSByZXR1cm4gdGhpcy5HZXRWYWx1ZSgpOwogICAgICAgIGlmICgiYWJzb2x1dGUiID09PSBhKSByZXR1cm4gdGhpcy5HZXRBYnNvbHV0ZVZhbHVlKCkKICAgIH0KICAgIEdldFR5cGUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3R5cGUKICAgIH0KICAgIFNldFR5cGUoYSkgewogICAgICAgIHRoaXMuX3R5cGUgPSBhCiAgICB9CiAgICBHZXRUaW1lKCkgewogICAgICAgIHJldHVybiB0aGlzLl90aW1lCiAgICB9CiAgICBTZXRUaW1lKGEpIHsKICAgICAgICB0aGlzLl90aW1lID0gYTsKICAgICAgICB0aGlzLl9wcm9wZXJ0eUtleWZyYW1lRGF0YS5fTGlua1Byb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbXMoKQogICAgfQogICAgR2V0RWFzZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZWFzZQogICAgfQogICAgU2V0RWFzZShhKSB7CiAgICAgICAgdGhpcy5fZWFzZSA9CiAgICAgICAgICAgIGEKICAgIH0KICAgIEdldEVuYWJsZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZW5hYmxlCiAgICB9CiAgICBTZXRFbmFibGUoYSkgewogICAgICAgIHRoaXMuX2VuYWJsZSA9ICEhYQogICAgfQogICAgR2V0QWRkT24oYSkgewogICAgICAgIGlmICh0aGlzLl9hZGRvbkRhdGEpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX2FkZG9uSW5zdGFuY2UgfHwgbnVsbCA9PT0gdGhpcy5fYWRkb25JbnN0YW5jZSkgcmV0dXJuIHRoaXMuX2FkZG9uSW5zdGFuY2U7CiAgICAgICAgICAgIHZhciBiID0gdGhpcy5fYWRkb25EYXRhLkdldEFkZERhdGFJdGVtQXJyYXkoKTsKICAgICAgICAgICAgaWYgKCFiKSByZXR1cm4gdGhpcy5fYWRkb25JbnN0YW5jZSA9IG51bGw7CiAgICAgICAgICAgIHZhciBkID0gYi5sZW5ndGg7CiAgICAgICAgICAgIGZvciAobGV0IGMgPSAwOyBjIDwgZDsgYysrKSB7CiAgICAgICAgICAgICAgICBjb25zdCBlID0gYltjXTsKICAgICAgICAgICAgICAgIGlmIChlLkdldElkKCkgPT09IGEpIHJldHVybiB0aGlzLl9hZGRvbkluc3RhbmNlID0gZQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9hZGRvbkluc3RhbmNlID0gbnVsbAogICAgICAgIH0KICAgIH0KICAgIF9TYXZlVG9Kc29uKCkgewogICAgICAgIGNvbnN0IGEgPSB0aGlzLl9hZGRvbkRhdGE7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgYWRkb25EYXRhSnNvbjogYSA/IGEuX1NhdmVUb0pzb24oKSA6IGEsCiAgICAgICAgICAgIHZhbHVlOiB0aGlzLl92YWx1ZSwKICAgICAgICAgICAgYVZhbHVlOiB0aGlzLl9hVmFsdWUsCiAgICAgICAgICAgIHR5cGU6IHRoaXMuX3R5cGUsCiAgICAgICAgICAgIHRpbWU6IHRoaXMuX3RpbWUsCiAgICAgICAgICAgIGVhc2U6IHRoaXMuX2Vhc2UsCiAgICAgICAgICAgIGVuYWJsZTogdGhpcy5fZW5hYmxlCiAgICAgICAgfQogICAgfQogICAgX0xvYWRGcm9tSnNvbihhKSB7CiAgICAgICAgYSAmJiAoYS5hZGRvbkRhdGFKc29uICYmIHRoaXMuX2FkZG9uRGF0YS5fU2V0RnJvbUpzb24oYS5hZGRvbkRhdGFKc29uKSwgdGhpcy5fdmFsdWUgPSBhLnZhbHVlLCB0aGlzLl9hVmFsdWUgPSBhLmFWYWx1ZSwgdGhpcy5fdHlwZSA9IGEudHlwZSwgdGhpcy5fdGltZSA9IGEudGltZSwgdGhpcy5fZWFzZSA9IGEuZWFzZSwgdGhpcy5fZW5hYmxlID0gYS5lbmFibGUpCiAgICB9Cn0KQzMkanNjb21wJDExMC5Qcm9wZXJ0eUtleWZyYW1lRGF0YSA9IGNsYXNzIHsKICAgIGNvbnN0cnVjdG9yKGEsIGIpIHsKICAgICAgICB0aGlzLl9wcm9wZXJ0eVRyYWNrRGF0YUl0ZW0gPSBiOwogICAgICAgIHRoaXMuX3Byb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbXMgPSBbXTsKICAgICAgICBDMyRqc2NvbXAkMTEwLlRpbWVsaW5lRGF0YU1hbmFnZXIuX0NyZWF0ZURhdGFJdGVtcyh0aGlzLl9wcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW1zLCBhLCBQcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW0sIHRoaXMpOwogICAgICAgIHRoaXMuX0xpbmtQcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW1zKCkKICAgIH0KICAgIFJlbGVhc2UoKSB7CiAgICAgICAgdGhpcy5fcHJvcGVydHlUcmFja0RhdGFJdGVtID0gbnVsbDsKICAgICAgICBmb3IgKGNvbnN0IGEgb2YgdGhpcy5fcHJvcGVydHlLZXlmcmFtZURhdGFJdGVtcykgYS5SZWxlYXNlKCk7CiAgICAgICAgQzMkanNjb21wJDExMC5jbGVhckFycmF5KHRoaXMuX3Byb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbXMpOwogICAgICAgIHRoaXMuX3Byb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbXMgPSBudWxsCiAgICB9CiAgICBfTGlua1Byb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbXMoKSB7CiAgICAgICAgdGhpcy5fcHJvcGVydHlLZXlmcmFtZURhdGFJdGVtcy5zb3J0KChhLAogICAgICAgICAgICBiKSA9PiBhLkdldFRpbWUoKSAtIGIuR2V0VGltZSgpKTsKICAgICAgICBmb3IgKGxldCBhID0gMDsgYSA8IHRoaXMuX3Byb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbXMubGVuZ3RoOyBhKyspIHRoaXMuX3Byb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbXNbYV0uU2V0TmV4dCh0aGlzLl9wcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW1zW2EgKyAxXSkKICAgIH0KICAgIEFkZEVtcHR5UHJvcGVydHlLZXlmcmFtZURhdGFJdGVtKCkgewogICAgICAgIGNvbnN0IGEgPSBuZXcgUHJvcGVydHlLZXlmcmFtZURhdGFJdGVtKG51bGwsIHRoaXMpOwogICAgICAgIHRoaXMuX3Byb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbXMucHVzaChhKTsKICAgICAgICB0aGlzLl9MaW5rUHJvcGVydHlLZXlmcmFtZURhdGFJdGVtcygpOwogICAgICAgIHJldHVybiBhCiAgICB9CiAgICBEZWxldGVQcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW1zKGEpIHsKICAgICAgICBmb3IgKGNvbnN0IGIgb2YgdGhpcy5fcHJvcGVydHlLZXlmcmFtZURhdGFJdGVtcykgewogICAgICAgICAgICBpZiAoIWEoYikpIGNvbnRpbnVlOwogICAgICAgICAgICBjb25zdCBkID0gdGhpcy5fcHJvcGVydHlLZXlmcmFtZURhdGFJdGVtcy5pbmRleE9mKGIpOyAtIDEgIT09IGQgJiYgKGIuUmVsZWFzZSgpLAogICAgICAgICAgICAgICAgdGhpcy5fcHJvcGVydHlLZXlmcmFtZURhdGFJdGVtcy5zcGxpY2UoZCwgMSkpCiAgICAgICAgfQogICAgICAgIHRoaXMuU29ydFByb3BlcnR5S2V5RnJhbWVEYXRhSXRlbXMoKTsKICAgICAgICB0aGlzLl9MaW5rUHJvcGVydHlLZXlmcmFtZURhdGFJdGVtcygpCiAgICB9CiAgICBTb3J0UHJvcGVydHlLZXlGcmFtZURhdGFJdGVtcygpIHsKICAgICAgICB0aGlzLl9wcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW1zLnNvcnQoKGEsIGIpID0+IGEuR2V0VGltZSgpIC0gYi5HZXRUaW1lKCkpCiAgICB9CiAgICBHZXRQcm9wZXJ0eVRyYWNrRGF0YUl0ZW0oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3Byb3BlcnR5VHJhY2tEYXRhSXRlbQogICAgfQogICAgR2V0UHJvcGVydHlLZXlmcmFtZURhdGFJdGVtQ291bnQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3Byb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbXMubGVuZ3RoCiAgICB9CiAgICBHZXRMYXN0UHJvcGVydHlLZXlmcmFtZURhdGFJdGVtKCkgewogICAgICAgIHJldHVybiB0aGlzLl9wcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW1zW3RoaXMuX3Byb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbXMubGVuZ3RoIC0gMV0KICAgIH0KICAgIEdldFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbUFycmF5KCkgewogICAgICAgIHJldHVybiB0aGlzLl9wcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW1zCiAgICB9KiBwcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW1zKCkgewogICAgICAgIGZvciAoY29uc3QgYSBvZiB0aGlzLl9wcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW1zKSB5aWVsZCBhCiAgICB9KiBwcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW1zUmV2ZXJzZSgpIHsKICAgICAgICBmb3IgKGxldCBhID0KICAgICAgICAgICAgICAgIHRoaXMuX3Byb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbXMubGVuZ3RoIC0gMTsgMCA8PSBhOyBhLS0pIHlpZWxkIHRoaXMuX3Byb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbXNbYV0KICAgIH0KICAgIF9TYXZlVG9Kc29uKCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbXNKc29uOiB0aGlzLl9wcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW1zLm1hcChhID0+IGEuX1NhdmVUb0pzb24oKSkKICAgICAgICB9CiAgICB9CiAgICBfTG9hZEZyb21Kc29uKGEpIHsKICAgICAgICBhICYmIChDMyRqc2NvbXAkMTEwLlRpbWVsaW5lRGF0YU1hbmFnZXIuX0xvYWREYXRhSXRlbXNGcm9tSnNvbih0aGlzLl9wcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW1zLCBhLnByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbXNKc29uLCBQcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW0sIHRoaXMpLCB0aGlzLl9MaW5rUHJvcGVydHlLZXlmcmFtZURhdGFJdGVtcygpKQogICAgfQp9OwoidXNlIHN0cmljdCI7CmNvbnN0IEMzJGpzY29tcCQxMTEgPSBzZWxmLkMzOwpjbGFzcyBBZGRvbkRhdGFJdGVtIHsKICAgIGNvbnN0cnVjdG9yKGEsIGIpIHsKICAgICAgICB0aGlzLl9hZGRvbkRhdGEgPSBiOwogICAgICAgIHRoaXMuX2lkID0gYVswXTsKICAgICAgICB0aGlzLl9kYXRhID0gYVsxXQogICAgfQogICAgUmVsZWFzZSgpIHsKICAgICAgICB0aGlzLl9kYXRhID0gdGhpcy5fYWRkb25EYXRhID0gbnVsbAogICAgfQogICAgR2V0QWRkb25EYXRhKCkgewogICAgICAgIHJldHVybiB0aGlzLl9hZGRvbkRhdGEKICAgIH0KICAgIEdldElkKCkgewogICAgICAgIHJldHVybiB0aGlzLl9pZAogICAgfQogICAgX1NhdmVUb0pzb24oKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgaWQ6IHRoaXMuX2lkLAogICAgICAgICAgICBkYXRhOiB0aGlzLl9kYXRhCiAgICAgICAgfQogICAgfQogICAgX0xvYWRGcm9tSnNvbihhKSB7CiAgICAgICAgYSAmJiAodGhpcy5faWQgPSBhLmlkLCB0aGlzLl9kYXRhID0gYS5kYXRhKQogICAgfQp9CmNsYXNzIEFkZG9uRGF0YUN1YmljQmV6aWVySXRlbSBleHRlbmRzIEFkZG9uRGF0YUl0ZW0gewogICAgY29uc3RydWN0b3IoYSwgYikgewogICAgICAgIHN1cGVyKGEsIGIpOwogICAgICAgIHRoaXMuX3N0YXJ0QW5jaG9yID0gdGhpcy5fZGF0YVswXTsKICAgICAgICB0aGlzLl9zdGFydEVuYWJsZSA9ICEhdGhpcy5fZGF0YVsxXTsKICAgICAgICB0aGlzLl9lbmRBbmNob3IgPSB0aGlzLl9kYXRhWzJdOwogICAgICAgIHRoaXMuX2VuZEVuYWJsZSA9ICEhdGhpcy5fZGF0YVszXQogICAgfQogICAgUmVsZWFzZSgpIHsKICAgICAgICBzdXBlci5SZWxlYXNlKCkKICAgIH0KICAgIEdldFN0YXJ0QW5jaG9yKCkgewogICAgICAgIHJldHVybiB0aGlzLl9zdGFydEFuY2hvcgogICAgfQogICAgR2V0U3RhcnRFbmFibGUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3N0YXJ0RW5hYmxlCiAgICB9CiAgICBHZXRFbmRBbmNob3IoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2VuZEFuY2hvcgogICAgfQogICAgR2V0RW5kRW5hYmxlKCkgewogICAgICAgIHJldHVybiB0aGlzLl9lbmRFbmFibGUKICAgIH0KICAgIF9TYXZlVG9Kc29uKCkgewogICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKHN1cGVyLl9TYXZlVG9Kc29uKCksIHsKICAgICAgICAgICAgc3RhcnRBbmNob3I6IHRoaXMuX3N0YXJ0QW5jaG9yLAogICAgICAgICAgICBzdGFydEVuYWJsZTogISF0aGlzLl9zdGFydEVuYWJsZSwKICAgICAgICAgICAgZW5kQW5jaG9yOiB0aGlzLl9lbmRBbmNob3IsCiAgICAgICAgICAgIGVuZEVuYWJsZTogISF0aGlzLl9lbmRFbmFibGUKICAgICAgICB9KQogICAgfQogICAgX0xvYWRGcm9tSnNvbihhKSB7CiAgICAgICAgYSAmJiAoc3VwZXIuX0xvYWRGcm9tSnNvbihhKSwgdGhpcy5fc3RhcnRBbmNob3IgPSBhLnN0YXJ0QW5jaG9yLCB0aGlzLl9zdGFydEVuYWJsZSA9ICEhYS5zdGFydEVuYWJsZSwgdGhpcy5fZW5kQW5jaG9yID0gYS5lbmRBbmNob3IsIHRoaXMuX2VuZEVuYWJsZSA9ICEhYS5lbmRFbmFibGUpCiAgICB9Cn0KY2xhc3MgQWRkb25EYXRhQW5nbGVJdGVtIGV4dGVuZHMgQWRkb25EYXRhSXRlbSB7CiAgICBjb25zdHJ1Y3RvcihhLCBiKSB7CiAgICAgICAgc3VwZXIoYSwgYik7CiAgICAgICAgdGhpcy5fZGlyZWN0aW9uID0gdGhpcy5fZGF0YVswXTsKICAgICAgICB0aGlzLl9yZXZvbHV0aW9ucyA9IHRoaXMuX2RhdGFbMV0KICAgIH0KICAgIFJlbGVhc2UoKSB7CiAgICAgICAgc3VwZXIuUmVsZWFzZSgpCiAgICB9CiAgICBHZXREaXJlY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2RpcmVjdGlvbgogICAgfQogICAgR2V0UmV2b2x1dGlvbnMoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3Jldm9sdXRpb25zCiAgICB9CiAgICBfU2F2ZVRvSnNvbigpIHsKICAgICAgICByZXR1cm4gT2JqZWN0LmFzc2lnbihzdXBlci5fU2F2ZVRvSnNvbigpLCB7CiAgICAgICAgICAgIGRpcmVjdGlvbjogdGhpcy5fZGlyZWN0aW9uLAogICAgICAgICAgICByZXZvbHV0aW9uczogdGhpcy5fcmV2b2x1dGlvbnMKICAgICAgICB9KQogICAgfQogICAgX0xvYWRGcm9tSnNvbihhKSB7CiAgICAgICAgYSAmJiAoc3VwZXIuX0xvYWRGcm9tSnNvbihhKSwgdGhpcy5fZGlyZWN0aW9uID0gYS5kaXJlY3Rpb24sIHRoaXMuX3Jldm9sdXRpb25zID0gYS5yZXZvbHV0aW9ucykKICAgIH0KfQpDMyRqc2NvbXAkMTExLkFkZG9uRGF0YSA9IGNsYXNzIHsKICAgIGNvbnN0cnVjdG9yKGEsIGIpIHsKICAgICAgICB0aGlzLl9wcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW0gPSBiOwogICAgICAgIHRoaXMuX2FkZG9uRGF0YUl0ZW1zID0gW107CiAgICAgICAgQzMkanNjb21wJDExMS5UaW1lbGluZURhdGFNYW5hZ2VyLl9DcmVhdGVEYXRhSXRlbXModGhpcy5fYWRkb25EYXRhSXRlbXMsIGEsIHsKICAgICAgICAgICAgcHJvcDogMCwKICAgICAgICAgICAgbWFwOiBuZXcgTWFwKFsKICAgICAgICAgICAgICAgIFsiY3ViaWMtYmV6aWVyIiwgQWRkb25EYXRhQ3ViaWNCZXppZXJJdGVtXSwKICAgICAgICAgICAgICAgIFsiYW5nbGUiLCBBZGRvbkRhdGFBbmdsZUl0ZW1dCiAgICAgICAgICAgIF0pCiAgICAgICAgfSwgdGhpcykKICAgIH0KICAgIFJlbGVhc2UoKSB7CiAgICAgICAgdGhpcy5fcHJvcGVydHlLZXlmcmFtZURhdGFJdGVtID0gbnVsbDsKICAgICAgICBmb3IgKGNvbnN0IGEgb2YgdGhpcy5fYWRkb25EYXRhSXRlbXMpIGEuUmVsZWFzZSgpOwogICAgICAgIEMzJGpzY29tcCQxMTEuY2xlYXJBcnJheSh0aGlzLl9hZGRvbkRhdGFJdGVtcyk7CiAgICAgICAgdGhpcy5fYWRkb25EYXRhSXRlbXMgPSBudWxsCiAgICB9CiAgICBHZXRQcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW0oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3Byb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbQogICAgfQogICAgR2V0QWRkRGF0YUl0ZW1BcnJheSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fYWRkb25EYXRhSXRlbXMKICAgIH0qIGFkZG9uRGF0YUl0ZW1zKCkgewogICAgICAgIGZvciAoY29uc3QgYSBvZiB0aGlzLl9hZGRvbkRhdGFJdGVtcykgeWllbGQgYQogICAgfQogICAgX1NhdmVUb0pzb24oKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgYWRkb25EYXRhSXRlbXNKc29uOiB0aGlzLl9hZGRvbkRhdGFJdGVtcy5tYXAoYSA9PgogICAgICAgICAgICAgICAgYS5fU2F2ZVRvSnNvbigpKQogICAgICAgIH0KICAgIH0KICAgIF9Mb2FkRnJvbUpzb24oYSkgewogICAgICAgIGEgJiYgQzMkanNjb21wJDExMS5UaW1lbGluZURhdGFNYW5hZ2VyLl9Mb2FkRGF0YUl0ZW1zRnJvbUpzb24odGhpcy5fYWRkb25EYXRhSXRlbXMsIGEuYWRkb25EYXRhSXRlbXNKc29uLCB7CiAgICAgICAgICAgIHByb3A6ICJpZCIsCiAgICAgICAgICAgIG1hcDogbmV3IE1hcChbCiAgICAgICAgICAgICAgICBbImN1YmljLWJlemllciIsIEFkZG9uRGF0YUN1YmljQmV6aWVySXRlbV0sCiAgICAgICAgICAgICAgICBbImFuZ2xlIiwgQWRkb25EYXRhQW5nbGVJdGVtXQogICAgICAgICAgICBdKQogICAgICAgIH0sIHRoaXMpCiAgICB9Cn07CiJ1c2Ugc3RyaWN0IjsKY29uc3QgQzMkanNjb21wJDExMiA9IHNlbGYuQzM7CmxldCBjcmVhdGVkVHdlZW5zID0gMDsKQzMkanNjb21wJDExMi5Ud2VlblN0YXRlID0gY2xhc3MgZXh0ZW5kcyBDMyRqc2NvbXAkMTEyLlRpbWVsaW5lU3RhdGUgewogICAgY29uc3RydWN0b3IoYSwgYikgewogICAgICAgIHN1cGVyKGB0d2Vlbi0ke2NyZWF0ZWRUd2VlbnMrK31gLCBhLCBiKTsKICAgICAgICB0aGlzLl9pZCA9ICIiOwogICAgICAgIHRoaXMuX2Rlc3Ryb3lJbnN0YW5jZU9uQ29tcGxldGUgPSAhMTsKICAgICAgICB0aGlzLl9pbml0aWFsVmFsdWVNb2RlID0gInN0YXJ0LXZhbHVlIjsKICAgICAgICB0aGlzLl9pVHdlZW5TdGF0ZSA9IHRoaXMuX3RyYWNrID0gdGhpcy5fb25fc3RhcnRlZF9jYWxsYmFja3MgPSB0aGlzLl9vbl9jb21wbGV0ZWRfY2FsbGJhY2tzID0gdGhpcy5faW5zdGFuY2UgPSBudWxsCiAgICB9CiAgICBGaXJlUmVsZWFzZUV2ZW50KGEpIHsKICAgICAgICBjb25zdCBiID0gQzMkanNjb21wJDExMi5OZXcoQzMkanNjb21wJDExMi5FdmVudCwgInR3ZWVuc3RhdGVyZWxlYXNlZCIpOwogICAgICAgIGIudHdlZW5TdGF0ZSA9IHRoaXM7CiAgICAgICAgYS5kaXNwYXRjaEV2ZW50KGIpCiAgICB9CiAgICBDcmVhdGVUcmFja1N0YXRlcygpIHsKICAgICAgICBmb3IgKGNvbnN0IGEgb2YgdGhpcy5fdGltZWxpbmVEYXRhSXRlbS5HZXRUcmFja0RhdGEoKS50cmFja0RhdGFJdGVtcygpKSB0aGlzLl90cmFja3MucHVzaChDMyRqc2NvbXAkMTEyLlR3ZWVuVHJhY2tTdGF0ZS5DcmVhdGUodGhpcywKICAgICAgICAgICAgYSkpOwogICAgICAgIHRoaXMuX3RyYWNrID0gdGhpcy5fdHJhY2tzWzBdCiAgICB9CiAgICBBZGRUcmFjaygpIHsKICAgICAgICB2YXIgYSA9IHRoaXMuX3RpbWVsaW5lRGF0YUl0ZW0uR2V0VHJhY2tEYXRhKCkuQWRkRW1wdHlUcmFja0RhdGFJdGVtKCk7CiAgICAgICAgYSA9IEMzJGpzY29tcCQxMTIuVHdlZW5UcmFja1N0YXRlLkNyZWF0ZSh0aGlzLCBhKTsKICAgICAgICB0aGlzLl90cmFja3MucHVzaChhKTsKICAgICAgICB0aGlzLl90cmFjayA9IHRoaXMuX3RyYWNrc1swXTsKICAgICAgICByZXR1cm4gYQogICAgfQogICAgR2V0UHJvcGVydHlUcmFjayhhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3RyYWNrLkdldFByb3BlcnR5VHJhY2tzKClbMF0KICAgIH0KICAgIFNldFByb3BlcnR5VHlwZShhKSB7CiAgICAgICAgdGhpcy5fcHJvcGVydHlUeXBlID0gYQogICAgfQogICAgR2V0SW5zdGFuY2UoKSB7CiAgICAgICAgdmFyIGEgPSB0aGlzLkdldFRyYWNrcygpOwogICAgICAgIGlmIChhICYmIGEubGVuZ3RoICYmICh0aGlzLl90cmFjayA9IGEgPSBhWzBdKSkgewogICAgICAgICAgICB2YXIgYiA9IGEuR2V0SW5zdGFuY2UoKTsKICAgICAgICAgICAgcmV0dXJuIGEuSXNJbnN0YW5jZVZhbGlkKCkgPyBiIDogdm9pZCAwCiAgICAgICAgfQogICAgfQogICAgQWRkU3RhcnRlZENhbGxiYWNrKGEpIHsKICAgICAgICB0aGlzLl9vbl9zdGFydGVkX2NhbGxiYWNrcyB8fAogICAgICAgICAgICAodGhpcy5fb25fc3RhcnRlZF9jYWxsYmFja3MgPSBbXSk7CiAgICAgICAgdGhpcy5fb25fc3RhcnRlZF9jYWxsYmFja3MucHVzaChhKQogICAgfQogICAgQWRkQ29tcGxldGVkQ2FsbGJhY2soYSkgewogICAgICAgIHRoaXMuX29uX2NvbXBsZXRlZF9jYWxsYmFja3MgfHwgKHRoaXMuX29uX2NvbXBsZXRlZF9jYWxsYmFja3MgPSBbXSk7CiAgICAgICAgdGhpcy5fb25fY29tcGxldGVkX2NhbGxiYWNrcy5wdXNoKGEpCiAgICB9CiAgICBSZW1vdmVTdGFydGVkQ2FsbGJhY2soYSkgewogICAgICAgIHRoaXMuX29uX3N0YXJ0ZWRfY2FsbGJhY2tzICYmIChhID0gdGhpcy5fb25fc3RhcnRlZF9jYWxsYmFja3MuaW5kZXhPZihhKSwgLTEgIT09IGEgJiYgdGhpcy5fb25fc3RhcnRlZF9jYWxsYmFja3Muc3BsaWNlKGEsIDEpKQogICAgfQogICAgUmVtb3ZlQ29tcGxldGVkQ2FsbGJhY2soYSkgewogICAgICAgIHRoaXMuX29uX2NvbXBsZXRlZF9jYWxsYmFja3MgJiYgKGEgPSB0aGlzLl9vbl9jb21wbGV0ZWRfY2FsbGJhY2tzLmluZGV4T2YoYSksIC0xICE9PSBhICYmIHRoaXMuX29uX2NvbXBsZXRlZF9jYWxsYmFja3Muc3BsaWNlKGEsIDEpKQogICAgfQogICAgU2V0U3RhcnRWYWx1ZShhLCBiKSB7CiAgICAgICAgZm9yIChjb25zdCBjIG9mIHRoaXMuX3RyYWNrcykKICAgICAgICAgICAgZm9yIChjb25zdCBlIG9mIGMuX3Byb3BlcnR5VHJhY2tzKSB7CiAgICAgICAgICAgICAgICBpZiAoZS5HZXRQcm9wZXJ0eU5hbWUoKSAhPT0KICAgICAgICAgICAgICAgICAgICBiKSBjb250aW51ZTsKICAgICAgICAgICAgICAgIHZhciBkID0gZS5HZXRQcm9wZXJ0eVRyYWNrRGF0YSgpOwogICAgICAgICAgICAgICAgY29uc3QgZyA9IGUuR2V0UHJvcGVydHlUcmFja0RhdGFJdGVtKCk7CiAgICAgICAgICAgICAgICBkID0gZC5HZXRGaXJzdFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbShnKTsKICAgICAgICAgICAgICAgIGQuU2V0VmFsdWUoYSk7CiAgICAgICAgICAgICAgICBkLlNldEFic29sdXRlVmFsdWUoYSkKICAgICAgICAgICAgfQogICAgfQogICAgX0dldFByb3BlcnR5VHJhY2tTdGF0ZShhKSB7CiAgICAgICAgZm9yIChjb25zdCBiIG9mIHRoaXMuX3RyYWNrcykKICAgICAgICAgICAgZm9yIChjb25zdCBkIG9mIGIuX3Byb3BlcnR5VHJhY2tzKQogICAgICAgICAgICAgICAgaWYgKGQuR2V0UHJvcGVydHlOYW1lKCkgPT09IGEpIHJldHVybiBkCiAgICB9CiAgICBCZWZvcmVTZXRFbmRWYWx1ZXMoYSkgewogICAgICAgIGZvciAoY29uc3QgYyBvZiBhKSBhID0gdGhpcy5fR2V0UHJvcGVydHlUcmFja1N0YXRlKGMpLCB0aGlzLlNldFN0YXJ0VmFsdWUoYS5HZXRDdXJyZW50U3RhdGUoKSwgYyk7CiAgICAgICAgaWYgKHRoaXMuSXNGb3J3YXJkUGxheUJhY2soKSkgewogICAgICAgICAgICB2YXIgYiA9IHRoaXMuR2V0VG90YWxUaW1lKCkgLSB0aGlzLkdldFRpbWUoKTsKICAgICAgICAgICAgdGhpcy5TZXRUb3RhbFRpbWUoYik7CiAgICAgICAgICAgIGZvciAodmFyIGQgb2YgdGhpcy5fdHJhY2tzKSBkLlNldExvY2FsVG90YWxUaW1lKGIpOwogICAgICAgICAgICB0aGlzLl9TZXRUaW1lKDApCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZCA9IHRoaXMuR2V0VGltZSgpOwogICAgICAgICAgICB0aGlzLlNldFRvdGFsVGltZShkKTsKICAgICAgICAgICAgZm9yIChiIG9mIHRoaXMuX3RyYWNrcykgYi5TZXRMb2NhbFRvdGFsVGltZShkKTsKICAgICAgICAgICAgdGhpcy5fU2V0VGltZShkKQogICAgICAgIH0KICAgICAgICB0aGlzLlNldEluaXRpYWxTdGF0ZUZyb21TZXRUaW1lKCkKICAgIH0KICAgIFNldEVuZFZhbHVlKGEsIGIpIHsKICAgICAgICB2YXIgZCA9IHRoaXMuX0dldFByb3BlcnR5VHJhY2tTdGF0ZShiKTsKICAgICAgICBiID0gZC5HZXRQcm9wZXJ0eVRyYWNrRGF0YSgpOwogICAgICAgIGQgPSBkLkdldFByb3BlcnR5VHJhY2tEYXRhSXRlbSgpOwogICAgICAgIGIgPSBiLkdldExhc3RQcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW0oZCk7CiAgICAgICAgYi5TZXRUaW1lKHRoaXMuR2V0VG90YWxUaW1lKCkpOwogICAgICAgIGIuU2V0VmFsdWUoYSk7CiAgICAgICAgYi5TZXRBYnNvbHV0ZVZhbHVlKGEpCiAgICB9CiAgICBTZXRJZChhKSB7CiAgICAgICAgdGhpcy5faWQgPSBhCiAgICB9CiAgICBHZXRJZCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5faWQKICAgIH0KICAgIFNldEluaXRpYWxWYWx1ZU1vZGUoYSkgewogICAgICAgIHRoaXMuX2luaXRpYWxWYWx1ZU1vZGUgPSBhCiAgICB9CiAgICBHZXRJbml0aWFsVmFsdWVNb2RlKCkgewogICAgICAgIHJldHVybiB0aGlzLl9pbml0aWFsVmFsdWVNb2RlCiAgICB9CiAgICBTZXREZXN0cm95SW5zdGFuY2VPbkNvbXBsZXRlKGEpIHsKICAgICAgICB0aGlzLl9kZXN0cm95SW5zdGFuY2VPbkNvbXBsZXRlID0KICAgICAgICAgICAgYQogICAgfQogICAgR2V0RGVzdHJveUluc3RhbmNlT25Db21wbGV0ZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZGVzdHJveUluc3RhbmNlT25Db21wbGV0ZQogICAgfQogICAgT25TdGFydGVkKCkgewogICAgICAgIGlmICh0aGlzLl9vbl9zdGFydGVkX2NhbGxiYWNrcykKICAgICAgICAgICAgZm9yIChjb25zdCBhIG9mIHRoaXMuX29uX3N0YXJ0ZWRfY2FsbGJhY2tzKSBhKHRoaXMpOwogICAgICAgIGlmICghdGhpcy5Jc0NvbXBsZXRlKCkpCiAgICAgICAgICAgIGZvciAoY29uc3QgYSBvZiB0aGlzLl90cmFja3MpIGEuQ29tcGFyZVNhdmVTdGF0ZVdpdGhDdXJyZW50KCkKICAgIH0KICAgIE9uQ29tcGxldGVkKCkgewogICAgICAgIHRoaXMuX2NvbXBsZXRlZFRpY2sgPSB0aGlzLl9ydW50aW1lLkdldFRpY2tDb3VudCgpCiAgICB9CiAgICBGaW5pc2hUcmlnZ2VycygpIHsKICAgICAgICBpZiAoIXRoaXMuX2ZpbmlzaGVkVHJpZ2dlcnMgJiYgKHRoaXMuX2ZpbmlzaGVkVHJpZ2dlcnMgPSAhMCwgdGhpcy5fb25fY29tcGxldGVkX2NhbGxiYWNrcykpCiAgICAgICAgICAgIGZvciAoY29uc3QgYSBvZiB0aGlzLl9vbl9jb21wbGV0ZWRfY2FsbGJhY2tzKSBhKHRoaXMpCiAgICB9CiAgICBTZXRUaW1lKGEpIHsKICAgICAgICB0aGlzLl9EZWxldGVJbnRlcm1lZGlhdGVLZXlmcmFtZXMoKTsKICAgICAgICBzdXBlci5TZXRUaW1lKGEpCiAgICB9CiAgICBfU2V0VGltZUFuZFJlc2V0KGEpIHsKICAgICAgICBDMyRqc2NvbXAkMTEyLklzRmluaXRlTnVtYmVyKGEpIHx8IChhID0gdGhpcy5HZXRUb3RhbFRpbWUoKSk7CiAgICAgICAgMCA+IGEgPyB0aGlzLl9wbGF5aGVhZFRpbWUgPSAwIDogYSA+PSB0aGlzLkdldFRvdGFsVGltZSgpID8gdGhpcy5fcGxheWhlYWRUaW1lID0gdGhpcy5HZXRUb3RhbFRpbWUoKSA6IHRoaXMuX3BsYXloZWFkVGltZSA9IGE7CiAgICAgICAgdGhpcy5fdHJhY2suU2V0UmVzZXRTdGF0ZSgpCiAgICB9CiAgICBTZXRJbml0aWFsU3RhdGUoYSkgewogICAgICAgIGlmICghdGhpcy5Jbml0aWFsU3RhdGVTZXQoKSAmJiAiY3VycmVudC1zdGF0ZSIgPT09IHRoaXMuR2V0SW5pdGlhbFZhbHVlTW9kZSgpKQogICAgICAgICAgICBmb3IgKGNvbnN0IGIgb2YgdGhpcy5fdHJhY2tzKSBiLkNvbXBhcmVJbml0aWFsU3RhdGVXaXRoQ3VycmVudCgpOwogICAgICAgIHN1cGVyLlNldEluaXRpYWxTdGF0ZShhKQogICAgfQogICAgU3RvcChhID0gITEpIHsKICAgICAgICBzdXBlci5TdG9wKGEpOwogICAgICAgIGlmICghdGhpcy5Jc0NvbXBsZXRlKCkpCiAgICAgICAgICAgIGZvciAoY29uc3QgYiBvZiB0aGlzLl90cmFja3MpIGIuU2F2ZVN0YXRlKCkKICAgIH0KICAgIFJlc2V0KGEgPSAhMCwgYiA9ICExKSB7CiAgICAgICAgdGhpcy5fRGVsZXRlSW50ZXJtZWRpYXRlS2V5ZnJhbWVzKCk7CiAgICAgICAgc3VwZXIuUmVzZXQoYSwgYikKICAgIH0KICAgIF9EZWxldGVJbnRlcm1lZGlhdGVLZXlmcmFtZXMoKSB7CiAgICAgICAgZm9yIChjb25zdCBhIG9mIHRoaXMuX3RyYWNrcykgewogICAgICAgICAgICBjb25zdCBiID0gZCA9PiB7CiAgICAgICAgICAgICAgICBkID0gZC5HZXRUaW1lKCk7CiAgICAgICAgICAgICAgICBjb25zdCBjID0gdGhpcy5HZXRUb3RhbFRpbWUoKTsKICAgICAgICAgICAgICAgIHJldHVybiAwICE9PSBkICYmIGQgIT09IGMKICAgICAgICAgICAgfTsKICAgICAgICAgICAgYS5EZWxldGVLZXlmcmFtZXMoYik7CiAgICAgICAgICAgIGEuRGVsZXRlUHJvcGVydHlLZXlmcmFtZXMoYikKICAgICAgICB9CiAgICB9CiAgICBfT25CZWZvcmVDaGFuZ2VMYXlvdXQoKSB7CiAgICAgICAgaWYgKHRoaXMuSXNSZWxlYXNlZCgpKSByZXR1cm4gITA7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuR2V0SW5zdGFuY2UoKTsKICAgICAgICBpZiAoYSAmJiBhLkdldE9iamVjdENsYXNzKCkuSXNHbG9iYWwoKSkgcmV0dXJuICExOwogICAgICAgIHRoaXMuX3RpbWVsaW5lTWFuYWdlci5Db21wbGV0ZVRpbWVsaW5lQmVmb3JlQ2hhbmdlT2ZMYXlvdXQodGhpcyk7CiAgICAgICAgdGhpcy5SZXNldEJlZm9yZUNoYW5nZUxheW91dCgpOwogICAgICAgIHJldHVybiAhMAogICAgfQogICAgVGljayhhLCBiLCBkKSB7CiAgICAgICAgdGhpcy5faW5zdGFuY2UgfHwKICAgICAgICAgICAgKHRoaXMuX2luc3RhbmNlID0gdGhpcy5HZXRJbnN0YW5jZSgpKTsKICAgICAgICBpZiAoIXRoaXMuX2luc3RhbmNlIHx8IHRoaXMuX2luc3RhbmNlLklzRGVzdHJveWVkKCkpIHRoaXMuU3RvcCghMCksIHRoaXMuT25Db21wbGV0ZWQoKTsKICAgICAgICBlbHNlIGlmIChiID0gdGhpcy5faW5zdGFuY2UuR2V0VGltZVNjYWxlKCksIC0xICE9PSBiICYmIChhID0gZCAqIGIpLCAwICE9PSBhIHx8IDAgIT09IHRoaXMuX2xhc3REZWx0YSkgewogICAgICAgICAgICB0aGlzLl9sYXN0RGVsdGEgPSBhOwogICAgICAgICAgICBkID0gdGhpcy5fcGxheWhlYWRUaW1lICsgYSAqIHRoaXMuX3BsYXliYWNrUmF0ZTsKICAgICAgICAgICAgYSA9IHRoaXMuX3RpbWVsaW5lRGF0YUl0ZW0uX3RvdGFsVGltZTsKICAgICAgICAgICAgdGhpcy5fcGxheWhlYWRUaW1lID0gMCA+IGQgPyAwIDogZCA+PSBhID8gYSA6IGQ7CiAgICAgICAgICAgIGIgPSBkID0gITE7CiAgICAgICAgICAgIHZhciBjID0gdGhpcy5HZXRMb29wKCksCiAgICAgICAgICAgICAgICBlID0gdGhpcy5HZXRQaW5nUG9uZygpOwogICAgICAgICAgICBjIHx8IGUgPyBjICYmICFlID8gMCA8IHRoaXMuX3BsYXliYWNrUmF0ZSA/IHRoaXMuX3BsYXloZWFkVGltZSA+PSBhICYmICh0aGlzLl9TZXRUaW1lQW5kUmVzZXQoMCksIGIgPSAhMCkgOiAwID49IHRoaXMuX3BsYXloZWFkVGltZSAmJiAodGhpcy5fU2V0VGltZUFuZFJlc2V0KGEpLAogICAgICAgICAgICAgICAgYiA9ICEwKSA6ICFjICYmIGUgPyAwIDwgdGhpcy5fcGxheWJhY2tSYXRlID8gdGhpcy5fcGxheWhlYWRUaW1lID49IGEgJiYgKHRoaXMuX1NldFRpbWUoYSksIHRoaXMuU2V0UGxheWJhY2tSYXRlKC0xICogdGhpcy5HZXRQbGF5YmFja1JhdGUoKSksIGIgPSAhMCwgMSA9PT0gdGhpcy5fcGluZ1BvbmdTdGF0ZSA/IHRoaXMuX2N1cnJlbnRSZXBlYXRDb3VudCA8IHRoaXMuR2V0UmVwZWF0Q291bnQoKSA/ICh0aGlzLl9jdXJyZW50UmVwZWF0Q291bnQrKywgdGhpcy5fcGluZ1BvbmdTdGF0ZSA9IDApIDogZCA9ICEwIDogMCA9PT0gdGhpcy5fcGluZ1BvbmdTdGF0ZSAmJiAodGhpcy5fcGluZ1BvbmdTdGF0ZSA9IDEpKSA6IDAgPj0gdGhpcy5fcGxheWhlYWRUaW1lICYmICh0aGlzLl9TZXRUaW1lKDApLCB0aGlzLlNldFBsYXliYWNrUmF0ZSgtMSAqIHRoaXMuR2V0UGxheWJhY2tSYXRlKCkpLCBiID0gITAsIDEgPT09IHRoaXMuX3BpbmdQb25nU3RhdGUgPyB0aGlzLl9jdXJyZW50UmVwZWF0Q291bnQgPCB0aGlzLkdldFJlcGVhdENvdW50KCkgPyAodGhpcy5fY3VycmVudFJlcGVhdENvdW50KyssIHRoaXMuX3BpbmdQb25nU3RhdGUgPQogICAgICAgICAgICAgICAgMCkgOiBkID0gITAgOiAwID09PSB0aGlzLl9waW5nUG9uZ1N0YXRlICYmICh0aGlzLl9waW5nUG9uZ1N0YXRlID0gMSkpIDogYyAmJiBlICYmICgwIDwgdGhpcy5fcGxheWJhY2tSYXRlID8gdGhpcy5fcGxheWhlYWRUaW1lID49IGEgJiYgKHRoaXMuX1NldFRpbWUoYSksIHRoaXMuU2V0UGxheWJhY2tSYXRlKC0xICogdGhpcy5HZXRQbGF5YmFja1JhdGUoKSksIGIgPSAhMCwgdGhpcy5fcGluZ1BvbmdTdGF0ZSsrLCBDMyRqc2NvbXAkMTEyLndyYXAodGhpcy5fcGluZ1BvbmdTdGF0ZSwgMCwgMikpIDogMCA+PSB0aGlzLl9wbGF5aGVhZFRpbWUgJiYgKHRoaXMuX1NldFRpbWUoMCksIHRoaXMuU2V0UGxheWJhY2tSYXRlKC0xICogdGhpcy5HZXRQbGF5YmFja1JhdGUoKSksIGIgPSAhMCwgdGhpcy5fcGluZ1BvbmdTdGF0ZSsrLCBDMyRqc2NvbXAkMTEyLndyYXAodGhpcy5fcGluZ1BvbmdTdGF0ZSwgMCwgMikpKSA6IDAgPCB0aGlzLl9wbGF5YmFja1JhdGUgPyB0aGlzLl9wbGF5aGVhZFRpbWUgPj0gYSAmJiAodGhpcy5fY3VycmVudFJlcGVhdENvdW50IDwgdGhpcy5HZXRSZXBlYXRDb3VudCgpID8KICAgICAgICAgICAgICAgICh0aGlzLl9jdXJyZW50UmVwZWF0Q291bnQrKywgdGhpcy5fU2V0VGltZUFuZFJlc2V0KDApLCBiID0gITApIDogKHRoaXMuX1NldFRpbWUoYSksIGQgPSAhMCkpIDogMCA+PSB0aGlzLl9wbGF5aGVhZFRpbWUgJiYgKHRoaXMuX2N1cnJlbnRSZXBlYXRDb3VudCA8IHRoaXMuR2V0UmVwZWF0Q291bnQoKSA/ICh0aGlzLl9jdXJyZW50UmVwZWF0Q291bnQrKywgdGhpcy5fU2V0VGltZUFuZFJlc2V0KGEpLCBiID0gITApIDogKHRoaXMuX1NldFRpbWUoMCksIGQgPSAhMCkpOwogICAgICAgICAgICBkID8gKHRoaXMuX3RyYWNrLlNldEVuZFN0YXRlKCksIHRoaXMuU3RvcCghMCksIHRoaXMuT25Db21wbGV0ZWQoKSkgOiAodGhpcy5fdHJhY2suSW50ZXJwb2xhdGUodGhpcy5fcGxheWhlYWRUaW1lLCAhMCwgITEsIGIsIHRoaXMuX2ZpcnN0VGljaywgITEpLCB0aGlzLl9maXJzdFRpY2sgJiYgKHRoaXMuX2ZpcnN0VGljayA9ICExKSkKICAgICAgICB9CiAgICB9CiAgICBfU2F2ZVRvSnNvbigpIHsKICAgICAgICBjb25zdCBhID0gc3VwZXIuX1NhdmVUb0pzb24oKSwKICAgICAgICAgICAgYiA9IHRoaXMuR2V0VGltZWxpbmVEYXRhSXRlbSgpOwogICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKGEsIHsKICAgICAgICAgICAgdHdlZW5EYXRhSXRlbUpzb246IGIuX1NhdmVUb0pzb24oKSwKICAgICAgICAgICAgaWQ6IHRoaXMuX2lkLAogICAgICAgICAgICBkZXN0cm95SW5zdGFuY2VPbkNvbXBsZXRlOiB0aGlzLl9kZXN0cm95SW5zdGFuY2VPbkNvbXBsZXRlLAogICAgICAgICAgICBpbml0aWFsVmFsdWVNb2RlOiB0aGlzLl9pbml0aWFsVmFsdWVNb2RlCiAgICAgICAgfSkKICAgIH0KICAgIF9Mb2FkRnJvbUpzb24oYSkgewogICAgICAgIGEgJiYgKHRoaXMuR2V0VGltZWxpbmVEYXRhSXRlbSgpLl9Mb2FkRnJvbUpzb24oYS50d2VlbkRhdGFJdGVtSnNvbiksIHN1cGVyLl9Mb2FkRnJvbUpzb24oYSksIHRoaXMuX2lkID0gYS5pZCwgdGhpcy5fZGVzdHJveUluc3RhbmNlT25Db21wbGV0ZSA9IGEuZGVzdHJveUluc3RhbmNlT25Db21wbGV0ZSwgdGhpcy5faW5pdGlhbFZhbHVlTW9kZSA9IGEuaW5pdGlhbFZhbHVlTW9kZSkKICAgIH0KICAgIHN0YXRpYyBJc1BsYXlpbmcoYSkgewogICAgICAgIHJldHVybiBhLklzUGxheWluZygpCiAgICB9CiAgICBzdGF0aWMgSXNQYXVzZWQoYSkgewogICAgICAgIHJldHVybiBhLklzUGF1c2VkKCkKICAgIH0KICAgIHN0YXRpYyBCdWlsZChhKSB7CiAgICAgICAgdmFyIGIgPSBhLnJ1bnRpbWUuR2V0VGltZWxpbmVNYW5hZ2VyKCksCiAgICAgICAgICAgIGQgPSBuZXcgQzMkanNjb21wJDExMi5UaW1lbGluZURhdGFJdGVtOwogICAgICAgIGlmIChhLmpzb24pIHsKICAgICAgICAgICAgZC5fTG9hZEZyb21Kc29uKGEuanNvbi50d2VlbkRhdGFJdGVtSnNvbik7CiAgICAgICAgICAgIHZhciBjID0gbmV3IEMzJGpzY29tcCQxMTIuVHdlZW5TdGF0ZShkLCBiKTsKICAgICAgICAgICAgYy5fTG9hZEZyb21Kc29uKGEuanNvbik7CiAgICAgICAgICAgIHJldHVybiBjCiAgICAgICAgfQogICAgICAgIGIgPSBuZXcgQzMkanNjb21wJDExMi5Ud2VlblN0YXRlKGQsIGIpOwogICAgICAgIEMzJGpzY29tcCQxMTIuSXNBcnJheShhLnByb3BlcnR5VHJhY2tzQ29uZmlnKSB8fCAoYS5wcm9wZXJ0eVRyYWNrc0NvbmZpZyA9IFthLnByb3BlcnR5VHJhY2tzQ29uZmlnXSk7CiAgICAgICAgYi5TZXRJZChhLmlkKTsKICAgICAgICBiLlNldFRhZ3MoYS50YWdzKTsKICAgICAgICBiLlNldEluaXRpYWxWYWx1ZU1vZGUoYS5pbml0aWFsVmFsdWVNb2RlKTsKICAgICAgICBiLlNldERlc3Ryb3lJbnN0YW5jZU9uQ29tcGxldGUoYS5yZWxlYXNlT25Db21wbGV0ZSk7CiAgICAgICAgYi5TZXRMb29wKGEubG9vcCk7CiAgICAgICAgYi5TZXRQaW5nUG9uZyhhLnBpbmdQb25nKTsKICAgICAgICBiLlNldFRvdGFsVGltZShhLnRpbWUpOwogICAgICAgIGIuU2V0U3RlcCgwKTsKICAgICAgICBiLlNldEludGVycG9sYXRpb25Nb2RlKCJkZWZhdWx0Iik7CiAgICAgICAgYi5TZXRSZXN1bHRNb2RlKGEucHJvcGVydHlUcmFja3NDb25maWdbMF0ucmVzdWx0TW9kZSk7CiAgICAgICAgZCA9IGIuQWRkVHJhY2soKTsKICAgICAgICBkLlNldEluc3RhbmNlVUlEKGEuaW5zdGFuY2UuR2V0VUlEKCkpOwogICAgICAgIGQuU2V0SW50ZXJwb2xhdGlvbk1vZGUoImRlZmF1bHQiKTsKICAgICAgICBkLlNldFJlc3VsdE1vZGUoYS5wcm9wZXJ0eVRyYWNrc0NvbmZpZ1swXS5yZXN1bHRNb2RlKTsKICAgICAgICBkLlNldEVuYWJsZSghMCk7CiAgICAgICAgZC5TZXRPYmplY3RDbGFzc0luZGV4KGEuaW5zdGFuY2UuR2V0T2JqZWN0Q2xhc3MoKS5HZXRJbmRleCgpKTsKICAgICAgICB2YXIgZSA9IGEuaW5zdGFuY2UuR2V0U2RrSW5zdGFuY2UoKSwKICAgICAgICAgICAgZyA9IGUuSXNPcmlnaW5hbFNpemVLbm93bigpID8gZS5HZXRPcmlnaW5hbFdpZHRoKCkgOiBhLmluc3RhbmNlLkdldFdvcmxkSW5mbygpLkdldFdpZHRoKCk7CiAgICAgICAgZSA9IGUuSXNPcmlnaW5hbFNpemVLbm93bigpID8gZS5HZXRPcmlnaW5hbEhlaWdodCgpIDogYS5pbnN0YW5jZS5HZXRXb3JsZEluZm8oKS5HZXRIZWlnaHQoKTsKICAgICAgICBkLlNldE9yaWdpbmFsV2lkdGgoZyk7CiAgICAgICAgZC5TZXRPcmlnaW5hbEhlaWdodChlKTsKICAgICAgICBnID0gZC5BZGRLZXlmcmFtZSgpOwogICAgICAgIGcuU2V0VGltZSgwKTsKICAgICAgICBnLlNldEVhc2UoIm5vZWFzZSIpOwogICAgICAgIGcuU2V0RW5hYmxlKCEwKTsKICAgICAgICBnLlNldFRhZ3MoIiIpOwogICAgICAgIGcgPSBkLkFkZEtleWZyYW1lKCk7CiAgICAgICAgZy5TZXRUaW1lKGEudGltZSk7CiAgICAgICAgZy5TZXRFYXNlKCJub2Vhc2UiKTsKICAgICAgICBnLlNldEVuYWJsZSghMCk7CiAgICAgICAgZy5TZXRUYWdzKCIiKTsKICAgICAgICBmb3IgKGMgb2YgYS5wcm9wZXJ0eVRyYWNrc0NvbmZpZykgZyA9IGQuQWRkUHJvcGVydHlUcmFjaygpLCBnLlNldFNvdXJjZUFkYXB0ZXJJZChjLnNvdXJjZUlkKSwgZy5TZXRTb3VyY2VBZGFwdGVyQXJncyhjLnNvdXJjZUFyZ3MpLCBnLlNldFByb3BlcnR5TmFtZShjLnByb3BlcnR5KSwgZy5TZXRQcm9wZXJ0eVR5cGUoYy50eXBlKSwgZy5TZXRNaW4oTmFOKSwgZy5TZXRNYXgoTmFOKSwgZy5TZXRJbnRlcnBvbGF0aW9uTW9kZSgiZGVmYXVsdCIpLCBnLlNldFJlc3VsdE1vZGUoYy5yZXN1bHRNb2RlKSwgZy5TZXRFbmFibGUoITApLAogICAgICAgICAgICBlID0gZy5BZGRQcm9wZXJ0eUtleWZyYW1lKCksIGUuU2V0VHlwZShjLnZhbHVlVHlwZSksIGUuU2V0VGltZSgwKSwgZS5TZXRFYXNlKGMuZWFzZSksIGUuU2V0RW5hYmxlKCEwKSwgZS5TZXRWYWx1ZShjLnN0YXJ0VmFsdWUpLCBlLlNldEFic29sdXRlVmFsdWUoYy5zdGFydFZhbHVlKSwgZSA9IGcuQWRkUHJvcGVydHlLZXlmcmFtZSgpLCBlLlNldFR5cGUoYy52YWx1ZVR5cGUpLCBlLlNldFRpbWUoYS50aW1lKSwgZS5TZXRFYXNlKGMuZWFzZSksIGUuU2V0RW5hYmxlKCEwKSwgZS5TZXRWYWx1ZShjLmVuZFZhbHVlKSwgZS5TZXRBYnNvbHV0ZVZhbHVlKGMuZW5kVmFsdWUpLCBnLkdldFNvdXJjZUFkYXB0ZXIoKTsKICAgICAgICByZXR1cm4gYgogICAgfQogICAgR2V0SVR3ZWVuU3RhdGUoYSwgYikgewogICAgICAgIHRoaXMuX2lUd2VlblN0YXRlIHx8ICh0aGlzLl9pVHdlZW5TdGF0ZSA9IEMzJGpzY29tcCQxMTIuTmV3KHNlbGYuSVR3ZWVuU3RhdGUsIHRoaXMsIGEsIGIpKTsKICAgICAgICByZXR1cm4gdGhpcy5faVR3ZWVuU3RhdGUKICAgIH0KfTsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkMTEzID0gc2VsZi5DMzsKQzMkanNjb21wJDExMy5Ud2VlblRyYWNrU3RhdGUgPSBjbGFzcyBleHRlbmRzIEMzJGpzY29tcCQxMTMuVHJhY2tTdGF0ZSB7CiAgICBjb25zdHJ1Y3RvcihhLCBiKSB7CiAgICAgICAgc3VwZXIoYSwgYik7CiAgICAgICAgdGhpcy5fc2Vjb25kUHJvcGVydHlUcmFjayA9IHRoaXMuX2ZpcnN0UHJvcGVydHlUcmFjayA9IG51bGwKICAgIH0KICAgIHN0YXRpYyBDcmVhdGUoYSwgYikgewogICAgICAgIHJldHVybiBDMyRqc2NvbXAkMTEzLk5ldyhDMyRqc2NvbXAkMTEzLlR3ZWVuVHJhY2tTdGF0ZSwgYSwgYikKICAgIH0KICAgIF9DYWNoZVByb3BlcnR5VHJhY2tzKCkgewogICAgICAgIDEgPT09IHRoaXMuX3Byb3BlcnR5VHJhY2tzLmxlbmd0aCA/IHRoaXMuX2ZpcnN0UHJvcGVydHlUcmFjayA9IHRoaXMuX3Byb3BlcnR5VHJhY2tzWzBdIDogKHRoaXMuX2ZpcnN0UHJvcGVydHlUcmFjayA9IHRoaXMuX3Byb3BlcnR5VHJhY2tzWzBdLCB0aGlzLl9zZWNvbmRQcm9wZXJ0eVRyYWNrID0gdGhpcy5fcHJvcGVydHlUcmFja3NbMV0pCiAgICB9CiAgICBDcmVhdGVQcm9wZXJ0eVRyYWNrU3RhdGVzKCkgewogICAgICAgIGZvciAoY29uc3QgYSBvZiB0aGlzLl90cmFja0RhdGFJdGVtLkdldFByb3BlcnR5VHJhY2tEYXRhKCkucHJvcGVydHlUcmFja0RhdGFJdGVtcygpKSB0aGlzLl9wcm9wZXJ0eVRyYWNrcy5wdXNoKEMzJGpzY29tcCQxMTMuVHdlZW5Qcm9wZXJ0eVRyYWNrU3RhdGUuQ3JlYXRlKHRoaXMsIGEpKTsKICAgICAgICB0aGlzLl9DYWNoZVByb3BlcnR5VHJhY2tzKCkKICAgIH0KICAgIEFkZFByb3BlcnR5VHJhY2soKSB7CiAgICAgICAgdmFyIGEgPSB0aGlzLl90cmFja0RhdGFJdGVtLkdldFByb3BlcnR5VHJhY2tEYXRhKCkuQWRkRW1wdHlQcm9wZXJ0eVRyYWNrRGF0YUl0ZW0oKTsKICAgICAgICBhID0gQzMkanNjb21wJDExMy5Ud2VlblByb3BlcnR5VHJhY2tTdGF0ZS5DcmVhdGUodGhpcywgYSk7CiAgICAgICAgdGhpcy5fcHJvcGVydHlUcmFja3MucHVzaChhKTsKICAgICAgICB0aGlzLl9DYWNoZVByb3BlcnR5VHJhY2tzKCk7CiAgICAgICAgcmV0dXJuIGEKICAgIH0KICAgIFNldEluaXRpYWxTdGF0ZSgpIHsKICAgICAgICB0aGlzLk1heWJlR2V0SW5zdGFuY2UoKTsKICAgICAgICBpZiAodGhpcy5Jc0luc3RhbmNlVmFsaWQoKSB8fCAhdGhpcy5Jc0luc3RhbmNlVHJhY2soKSkgewogICAgICAgICAgICB2YXIgYSA9IHRoaXMuR2V0VGltZWxpbmUoKS5Jc0ZvcndhcmRQbGF5QmFjaygpID8gMCA6IHRoaXMuR2V0TG9jYWxUb3RhbFRpbWUoKTsKICAgICAgICAgICAgZm9yIChjb25zdCBiIG9mIHRoaXMuX3Byb3BlcnR5VHJhY2tzKSBiLlNldEluaXRpYWxTdGF0ZShhKSwgMCA9PT0gdGhpcy5fd29ybGRJbmZvQ2hhbmdlICYmIDEgPT09CiAgICAgICAgICAgICAgICBiLkdldFdvcmxkSW5mb0NoYW5nZSgpICYmICh0aGlzLl93b3JsZEluZm9DaGFuZ2UgPSAxKSwgMCA9PT0gdGhpcy5fcmVuZGVyQ2hhbmdlICYmIDEgPT09IGIuR2V0UmVuZGVyQ2hhbmdlKCkgJiYgKHRoaXMuX3JlbmRlckNoYW5nZSA9IDEpOwogICAgICAgICAgICB0aGlzLl9uZWVkc0JlZm9yZUFuZEFmdGVyID0gMDsKICAgICAgICAgICAgdGhpcy5fcHJvcGVydHlUcmFja3Muc29tZShiID0+IGIuR2V0TmVlZHNCZWZvcmVBbmRBZnRlcigpKSAmJiAodGhpcy5fbmVlZHNCZWZvcmVBbmRBZnRlciA9IDEpOwogICAgICAgICAgICB0aGlzLl9sYXN0S2V5ZnJhbWVEYXRhSXRlbSA9IHRoaXMuX0dldExhc3RLZXlGcmFtZUJlZm9yZVRpbWUoYSk7CiAgICAgICAgICAgIHRoaXMuX2VuZFN0YXRlT2ZOZXN0ZWRTZXQgPSB0aGlzLl9pbml0aWFsU3RhdGVPZk5lc3RlZFNldCA9ICExOwogICAgICAgICAgICB0aGlzLkludGVycG9sYXRlKGEpCiAgICAgICAgfQogICAgfQogICAgQmVmb3JlSW50ZXJwb2xhdGUoKSB7fQogICAgSW50ZXJwb2xhdGUoYSwgYiwgZCA9ICExLCBjID0gITEsIGUsIGcgPSAhMSkgewogICAgICAgIHRoaXMuX2luc3RhbmNlIHx8IHRoaXMuR2V0SW5zdGFuY2UoKTsKICAgICAgICBpZiAodGhpcy5faW5zdGFuY2UpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX2luc3RhbmNlLklzRGVzdHJveWVkKCkgfHwKICAgICAgICAgICAgICAgIGcgJiYgdGhpcy5HZXRPYmplY3RDbGFzcygpLklzR2xvYmFsKCkpIHJldHVybiAhMTsKICAgICAgICAgICAgdGhpcy5fc2Vjb25kUHJvcGVydHlUcmFjayA/ICh0aGlzLl9maXJzdFByb3BlcnR5VHJhY2suSW50ZXJwb2xhdGUoYSwgZCwgYyksIHRoaXMuX3NlY29uZFByb3BlcnR5VHJhY2suSW50ZXJwb2xhdGUoYSwgZCwgYykpIDogdGhpcy5fZmlyc3RQcm9wZXJ0eVRyYWNrLkludGVycG9sYXRlKGEsIGQsIGMpOwogICAgICAgICAgICAwICE9PSB0aGlzLl9maXJzdFByb3BlcnR5VHJhY2suR2V0V29ybGRJbmZvQ2hhbmdlKCkgJiYgKHRoaXMuX3dvcmxkSW5mbyB8fCAodGhpcy5fd29ybGRJbmZvID0gdGhpcy5faW5zdGFuY2UuR2V0V29ybGRJbmZvKCkpLCB0aGlzLl93b3JsZEluZm8gJiYgdGhpcy5fd29ybGRJbmZvLlNldEJib3hDaGFuZ2VkKCkpCiAgICAgICAgfQogICAgfQogICAgQWZ0ZXJJbnRlcnBvbGF0ZSgpIHt9CiAgICBfTG9hZEZyb21Kc29uKGEpIHsKICAgICAgICBzdXBlci5fTG9hZEZyb21Kc29uKGEpOwogICAgICAgIHRoaXMuX0NhY2hlUHJvcGVydHlUcmFja3MoKQogICAgfQp9OwoidXNlIHN0cmljdCI7CmNvbnN0IEMzJGpzY29tcCQxMTQgPSBzZWxmLkMzOwpDMyRqc2NvbXAkMTE0LlR3ZWVuUHJvcGVydHlUcmFja1N0YXRlID0gY2xhc3MgZXh0ZW5kcyBDMyRqc2NvbXAkMTE0LlByb3BlcnR5VHJhY2tTdGF0ZSB7CiAgICBjb25zdHJ1Y3RvcihhLCBiKSB7CiAgICAgICAgc3VwZXIoYSwgYik7CiAgICAgICAgdGhpcy5fYmFzaWMgPSAhMQogICAgfQogICAgc3RhdGljIENyZWF0ZShhLCBiKSB7CiAgICAgICAgcmV0dXJuIEMzJGpzY29tcCQxMTQuTmV3KEMzJGpzY29tcCQxMTQuVHdlZW5Qcm9wZXJ0eVRyYWNrU3RhdGUsIGEsIGIpCiAgICB9CiAgICBJbnRlcnBvbGF0ZShhLCBiID0gITEsIGQgPSAhMSkgewogICAgICAgIGlmICh0aGlzLl9iYXNpYykgewogICAgICAgICAgICB2YXIgYyA9IHRoaXMuX3Byb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbXNbMF07CiAgICAgICAgICAgIHZhciBlID0gdGhpcy5fcHJvcGVydHlLZXlmcmFtZURhdGFJdGVtc1sxXQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmIChiKSBjID0gdGhpcy5fcHJvcGVydHlUcmFja0RhdGEuR2V0Rmlyc3RQcm9wZXJ0eUtleUZyYW1lRGF0YUl0ZW1Mb3dlck9yRXF1YWxUaGFuKGEsIHRoaXMuX3Byb3BlcnR5VHJhY2tEYXRhSXRlbSk7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuX2xhc3RQcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICBlID0gdGhpcy5HZXRUaW1lbGluZSgpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGcgPSB0aGlzLl9sYXN0UHJvcGVydHlLZXlmcmFtZURhdGFJdGVtLkdldE5leHQoKTsKICAgICAgICAgICAgICAgICAgICBjID0gdGhpcy5fbGFzdFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbS5HZXRUaW1lKCk7CiAgICAgICAgICAgICAgICAgICAgZSA9IGcgPyBnLkdldFRpbWUoKSA6IGUuR2V0VG90YWxUaW1lKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGEgPD0gYyB8fCBhID49IGUpIHRoaXMuX2xhc3RQcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW0gPSB0aGlzLl9wcm9wZXJ0eVRyYWNrRGF0YS5HZXRGaXJzdFByb3BlcnR5S2V5RnJhbWVEYXRhSXRlbUxvd2VyT3JFcXVhbFRoYW4oYSwgdGhpcy5fcHJvcGVydHlUcmFja0RhdGFJdGVtKQogICAgICAgICAgICAgICAgfSBlbHNlIHRoaXMuX2xhc3RQcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW0gPSB0aGlzLl9wcm9wZXJ0eVRyYWNrRGF0YS5HZXRGaXJzdFByb3BlcnR5S2V5RnJhbWVEYXRhSXRlbUxvd2VyT3JFcXVhbFRoYW4oYSwgdGhpcy5fcHJvcGVydHlUcmFja0RhdGFJdGVtKTsKICAgICAgICAgICAgICAgIGMgPSB0aGlzLl9sYXN0UHJvcGVydHlLZXlmcmFtZURhdGFJdGVtCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZSA9IGMuR2V0TmV4dCgpCiAgICAgICAgfQogICAgICAgIHRoaXMuX3NvdXJjZUFkYXB0ZXIuSW50ZXJwb2xhdGUoYSwKICAgICAgICAgICAgYywgZSwgYiwgZCkKICAgIH0KICAgIEFkZFByb3BlcnR5S2V5ZnJhbWUoKSB7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuX3Byb3BlcnR5VHJhY2tEYXRhSXRlbS5HZXRQcm9wZXJ0eUtleWZyYW1lRGF0YSgpLkFkZEVtcHR5UHJvcGVydHlLZXlmcmFtZURhdGFJdGVtKCk7CiAgICAgICAgdGhpcy5fbGFzdFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbSA9IG51bGw7CiAgICAgICAgdGhpcy5fYmFzaWMgPSAyID49IHRoaXMuR2V0UHJvcGVydHlLZXlmcmFtZURhdGFJdGVtcygpLmxlbmd0aDsKICAgICAgICByZXR1cm4gYQogICAgfQogICAgRGVsZXRlUHJvcGVydHlLZXlmcmFtZXMoYSkgewogICAgICAgIHRoaXMuX2xhc3RQcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW0gPSBudWxsOwogICAgICAgIHRoaXMuX3Byb3BlcnR5VHJhY2tEYXRhSXRlbS5HZXRQcm9wZXJ0eUtleWZyYW1lRGF0YSgpLkRlbGV0ZVByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbXMoYSk7CiAgICAgICAgdGhpcy5fYmFzaWMgPSAyID49IHRoaXMuR2V0UHJvcGVydHlLZXlmcmFtZURhdGFJdGVtcygpLmxlbmd0aAogICAgfQogICAgX1NhdmVUb0pzb24oKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgc291cmNlQWRhcHRlckpzb246IHRoaXMuR2V0U291cmNlQWRhcHRlcigpLl9TYXZlVG9Kc29uKCksCiAgICAgICAgICAgIGJhc2ljOiB0aGlzLl9iYXNpYwogICAgICAgIH0KICAgIH0KICAgIF9Mb2FkRnJvbUpzb24oYSkgewogICAgICAgIGEgJiYgKHRoaXMuR2V0U291cmNlQWRhcHRlcigpLl9Mb2FkRnJvbUpzb24oYS5zb3VyY2VBZGFwdGVySnNvbiksIHRoaXMuX2Jhc2ljID0gYS5iYXNpYykKICAgIH0KfTsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkMTE1ID0gc2VsZi5DMywKICAgIEVhc2UkanNjb21wJDIgPSBzZWxmLkVhc2U7CkMzJGpzY29tcCQxMTUuVHJhbnNpdGlvbiA9IGNsYXNzIGV4dGVuZHMgQzMkanNjb21wJDExNS5EZWZlbmRlZEJhc2UgewogICAgY29uc3RydWN0b3IoYSkgewogICAgICAgIHN1cGVyKCk7CiAgICAgICAgdGhpcy5fbmFtZSA9IGFbMF07CiAgICAgICAgdGhpcy5fbGluZWFyID0gITE7CiAgICAgICAgdGhpcy5fdHJhbnNpdGlvbktleWZyYW1lcyA9IFtdOwogICAgICAgIGZvciAodmFyIGIgb2YgYVsxXSkgYSA9IEMzJGpzY29tcCQxMTUuVHJhbnNpdGlvbktleWZyYW1lLkNyZWF0ZSh0aGlzLCBiKSwgdGhpcy5fdHJhbnNpdGlvbktleWZyYW1lcy5wdXNoKGEpOwogICAgICAgIGZvciAoYiA9IDA7IGIgPCB0aGlzLl90cmFuc2l0aW9uS2V5ZnJhbWVzLmxlbmd0aDsgYisrKSB0aGlzLl90cmFuc2l0aW9uS2V5ZnJhbWVzW2JdLlNldE5leHQodGhpcy5fdHJhbnNpdGlvbktleWZyYW1lc1tiICsgMV0pOwogICAgICAgIHRoaXMuX3ByZWNhbGN1bGF0ZWRTYW1wbGVzID0gbmV3IE1hcDsKICAgICAgICB0aGlzLl90cmFuc2l0aW9uS2V5ZnJhbWVDYWNoZSA9IG5ldyBNYXA7CiAgICAgICAgdGhpcy5fUHJlQ2FsY1NhbXBsZXMoKTsKICAgICAgICBFYXNlJGpzY29tcCQyLkFkZEN1c3RvbUVhc2UodGhpcy5fbmFtZSwKICAgICAgICAgICAgKGQsIGMsIGUsIGcpID0+IHRoaXMuSW50ZXJwb2xhdGUoZCwgYywgZSwgZykpCiAgICB9CiAgICBzdGF0aWMgQ3JlYXRlKGEpIHsKICAgICAgICByZXR1cm4gQzMkanNjb21wJDExNS5OZXcoQzMkanNjb21wJDExNS5UcmFuc2l0aW9uLCBhKQogICAgfQogICAgUmVsZWFzZSgpIHsKICAgICAgICBmb3IgKGNvbnN0IGEgb2YgdGhpcy5fdHJhbnNpdGlvbktleWZyYW1lcykgYS5SZWxlYXNlKCk7CiAgICAgICAgQzMkanNjb21wJDExNS5jbGVhckFycmF5KHRoaXMuX3RyYW5zaXRpb25LZXlmcmFtZXMpOwogICAgICAgIHRoaXMuX3RyYW5zaXRpb25LZXlmcmFtZXMgPSBudWxsOwogICAgICAgIHRoaXMuX3ByZWNhbGN1bGF0ZWRTYW1wbGVzLmNsZWFyKCk7CiAgICAgICAgdGhpcy5fcHJlY2FsY3VsYXRlZFNhbXBsZXMgPSBudWxsOwogICAgICAgIHRoaXMuX3RyYW5zaXRpb25LZXlmcmFtZUNhY2hlLmNsZWFyKCk7CiAgICAgICAgdGhpcy5fdHJhbnNpdGlvbktleWZyYW1lQ2FjaGUgPSBudWxsCiAgICB9CiAgICBNYWtlTGluZWFyKGEpIHsKICAgICAgICB0aGlzLl9saW5lYXIgPSAhIWEKICAgIH0KICAgIEdldFRyYW5zaXRpb25LZXlGcmFtZUF0KGEpIHsKICAgICAgICBjb25zdCBiID0gdGhpcy5fdHJhbnNpdGlvbktleWZyYW1lQ2FjaGUuZ2V0KGEpOwogICAgICAgIGlmIChiKSByZXR1cm4gYjsKICAgICAgICBmb3IgKGNvbnN0IGQgb2YgdGhpcy5fdHJhbnNpdGlvbktleWZyYW1lcykKICAgICAgICAgICAgaWYgKGQuR2V0VmFsdWVYKCkgPT09IGEpIHJldHVybiB0aGlzLl90cmFuc2l0aW9uS2V5ZnJhbWVDYWNoZS5zZXQoYSwgZCksIGQKICAgIH0KICAgIEdldEZpcnN0VHJhbnNpdGlvbktleUZyYW1lSGlnaGVyVGhhbihhKSB7CiAgICAgICAgZm9yIChjb25zdCBiIG9mIHRoaXMuX3RyYW5zaXRpb25LZXlmcmFtZXMpCiAgICAgICAgICAgIGlmIChiLkdldFZhbHVlWCgpID4gYSkgcmV0dXJuIGIKICAgIH0KICAgIEdldEZpcnN0VHJhbnNpdGlvbktleUZyYW1lSGlnaGVyT3JFcXVhbFRoYW4oYSkgewogICAgICAgIGZvciAoY29uc3QgYiBvZiB0aGlzLl90cmFuc2l0aW9uS2V5ZnJhbWVzKQogICAgICAgICAgICBpZiAoYi5HZXRWYWx1ZVgoKSA+PSBhKSByZXR1cm4gYgogICAgfQogICAgR2V0Rmlyc3RUcmFuc2l0aW9uS2V5RnJhbWVMb3dlclRoYW4oYSkgewogICAgICAgIGZvciAobGV0IGIgPSB0aGlzLl90cmFuc2l0aW9uS2V5ZnJhbWVzLmxlbmd0aCAtIDE7IDAgPD0gYjsgYi0tKSB7CiAgICAgICAgICAgIGNvbnN0IGQgPSB0aGlzLl90cmFuc2l0aW9uS2V5ZnJhbWVzW2JdOwogICAgICAgICAgICBpZiAoZC5HZXRWYWx1ZVgoKSA8IGEpIHJldHVybiBkCiAgICAgICAgfQogICAgfQogICAgR2V0Rmlyc3RUcmFuc2l0aW9uS2V5RnJhbWVMb3dlck9yRXF1YWxUaGFuKGEpIHsKICAgICAgICBmb3IgKGxldCBiID0KICAgICAgICAgICAgICAgIHRoaXMuX3RyYW5zaXRpb25LZXlmcmFtZXMubGVuZ3RoIC0gMTsgMCA8PSBiOyBiLS0pIHsKICAgICAgICAgICAgY29uc3QgZCA9IHRoaXMuX3RyYW5zaXRpb25LZXlmcmFtZXNbYl07CiAgICAgICAgICAgIGlmIChkLkdldFZhbHVlWCgpIDw9IGEpIHJldHVybiBkCiAgICAgICAgfQogICAgfQogICAgSW50ZXJwb2xhdGUoYSwgYiwgZCwgYykgewogICAgICAgIGlmICh0aGlzLl9saW5lYXIpIHJldHVybiBFYXNlJGpzY29tcCQyLk5vRWFzZShhLCBiLCBkLCBjKTsKICAgICAgICB2YXIgZSA9IGEgLyBjOwogICAgICAgIGEgPSB0aGlzLkdldEZpcnN0VHJhbnNpdGlvbktleUZyYW1lTG93ZXJPckVxdWFsVGhhbihlKTsKICAgICAgICBjID0gYS5HZXROZXh0KCk7CiAgICAgICAgYyB8fCAoYSA9IHRoaXMuR2V0Rmlyc3RUcmFuc2l0aW9uS2V5RnJhbWVMb3dlclRoYW4oZSksIGMgPSBhLkdldE5leHQoKSk7CiAgICAgICAgdmFyIGcgPSBjLkdldFZhbHVlWCgpIC0gYS5HZXRWYWx1ZVgoKTsKICAgICAgICBlID0gQzMkanNjb21wJDExNS5tYXBUb1JhbmdlKGUsIGEuR2V0VmFsdWVYKCksIGMuR2V0VmFsdWVYKCksIDAsIGcpOwogICAgICAgIGcgPSBhLkdldFZhbHVlWCgpOwogICAgICAgIGNvbnN0IGsgPSBhLkdldFZhbHVlWSgpLAogICAgICAgICAgICBtID0gYS5HZXRWYWx1ZVgoKSArIGEuR2V0U3RhcnRBbmNob3JYKCksCiAgICAgICAgICAgIG4gPSBhLkdldFZhbHVlWSgpICsKICAgICAgICAgICAgYS5HZXRTdGFydEFuY2hvclkoKSwKICAgICAgICAgICAgcSA9IGMuR2V0VmFsdWVYKCkgKyBjLkdldEVuZEFuY2hvclgoKSwKICAgICAgICAgICAgdSA9IGMuR2V0VmFsdWVZKCkgKyBjLkdldEVuZEFuY2hvclkoKSwKICAgICAgICAgICAgdyA9IGMuR2V0VmFsdWVYKCk7CiAgICAgICAgYyA9IGMuR2V0VmFsdWVZKCk7CiAgICAgICAgYyA9IEVhc2UkanNjb21wJDIuR2V0UnVudGltZUVhc2UoInNwbGluZSIpKGUsIGcsIGssIG0sIG4sIHEsIHUsIHcsIGMsIHRoaXMuX3ByZWNhbGN1bGF0ZWRTYW1wbGVzLmdldChhKSk7CiAgICAgICAgYyArPSBhLkdldFZhbHVlWSgpOwogICAgICAgIHJldHVybiAoMSAtIGMpICogYiArIGMgKiAoYiArIGQpCiAgICB9CiAgICBfUHJlQ2FsY1NhbXBsZXMoKSB7CiAgICAgICAgdGhpcy5fcHJlY2FsY3VsYXRlZFNhbXBsZXMuY2xlYXIoKTsKICAgICAgICBmb3IgKGxldCBkID0gMDsgZCA8IHRoaXMuX3RyYW5zaXRpb25LZXlmcmFtZXMubGVuZ3RoIC0gMTsgZCsrKSB7CiAgICAgICAgICAgIHZhciBhID0gdGhpcy5fdHJhbnNpdGlvbktleWZyYW1lc1tkXTsKICAgICAgICAgICAgaWYgKCFhLkdldFN0YXJ0RW5hYmxlKCkpIGNvbnRpbnVlOwogICAgICAgICAgICB2YXIgYiA9IHRoaXMuX3RyYW5zaXRpb25LZXlmcmFtZXNbZCArIDFdOwogICAgICAgICAgICBjb25zdCBjID0gYS5HZXRWYWx1ZVgoKSwKICAgICAgICAgICAgICAgIGUgPSBhLkdldFZhbHVlWCgpICsKICAgICAgICAgICAgICAgIGEuR2V0U3RhcnRBbmNob3JYKCksCiAgICAgICAgICAgICAgICBnID0gYi5HZXRWYWx1ZVgoKSArIGIuR2V0RW5kQW5jaG9yWCgpOwogICAgICAgICAgICBiID0gYi5HZXRWYWx1ZVgoKTsKICAgICAgICAgICAgdGhpcy5fcHJlY2FsY3VsYXRlZFNhbXBsZXMuc2V0KGEsIEVhc2UkanNjb21wJDIuR2V0QmV6aWVyU2FtcGxlcyhjLCBlLCBnLCBiKSkKICAgICAgICB9CiAgICB9Cn07CiJ1c2Ugc3RyaWN0IjsKY29uc3QgQzMkanNjb21wJDExNiA9IHNlbGYuQzM7CkMzJGpzY29tcCQxMTYuVHJhbnNpdGlvbktleWZyYW1lID0gY2xhc3MgZXh0ZW5kcyBDMyRqc2NvbXAkMTE2LkRlZmVuZGVkQmFzZSB7CiAgICBjb25zdHJ1Y3RvcihhLCBiKSB7CiAgICAgICAgc3VwZXIoKTsKICAgICAgICB0aGlzLl90cmFuc2l0aW9uID0gYTsKICAgICAgICB0aGlzLl92YWx1ZVggPSBiWzBdOwogICAgICAgIHRoaXMuX3ZhbHVlWSA9IGJbMV07CiAgICAgICAgdGhpcy5fc3RhcnRBbmNob3JYID0gYlsyXTsKICAgICAgICB0aGlzLl9zdGFydEFuY2hvclkgPSBiWzNdOwogICAgICAgIHRoaXMuX2VuZEFuY2hvclggPSBiWzRdOwogICAgICAgIHRoaXMuX2VuZEFuY2hvclkgPSBiWzVdOwogICAgICAgIHRoaXMuX3N0YXJ0RW5hYmxlID0gYls2XTsKICAgICAgICB0aGlzLl9lbmRFbmFibGUgPSBiWzddOwogICAgICAgIHRoaXMuX25leHQgPSBudWxsCiAgICB9CiAgICBSZWxlYXNlKCkgewogICAgICAgIHRoaXMuX3RyYW5zaXRpb24gPSBudWxsCiAgICB9CiAgICBzdGF0aWMgQ3JlYXRlKGEsIGIpIHsKICAgICAgICByZXR1cm4gQzMkanNjb21wJDExNi5OZXcoQzMkanNjb21wJDExNi5UcmFuc2l0aW9uS2V5ZnJhbWUsIGEsIGIpCiAgICB9CiAgICBTZXROZXh0KGEpIHsKICAgICAgICB0aGlzLl9uZXh0ID0gYQogICAgfQogICAgR2V0TmV4dCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fbmV4dAogICAgfQogICAgR2V0VmFsdWVYKCkgewogICAgICAgIHJldHVybiB0aGlzLl92YWx1ZVgKICAgIH0KICAgIEdldFZhbHVlWSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdmFsdWVZCiAgICB9CiAgICBHZXRTdGFydEFuY2hvclgoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3N0YXJ0QW5jaG9yWAogICAgfQogICAgR2V0U3RhcnRBbmNob3JZKCkgewogICAgICAgIHJldHVybiB0aGlzLl9zdGFydEFuY2hvclkKICAgIH0KICAgIEdldEVuZEFuY2hvclgoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2VuZEFuY2hvclgKICAgIH0KICAgIEdldEVuZEFuY2hvclkoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2VuZEFuY2hvclkKICAgIH0KICAgIEdldFN0YXJ0RW5hYmxlKCkgewogICAgICAgIHJldHVybiB0aGlzLl9zdGFydEVuYWJsZQogICAgfQogICAgR2V0RW5kRW5hYmxlKCkgewogICAgICAgIHJldHVybiB0aGlzLl9lbmRFbmFibGUKICAgIH0KfTsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkMTE3ID0gc2VsZi5DMzsKQzMkanNjb21wJDExNy5UcmFuc2l0aW9uTWFuYWdlciA9IGNsYXNzIGV4dGVuZHMgQzMkanNjb21wJDExNy5EZWZlbmRlZEJhc2UgewogICAgY29uc3RydWN0b3IoYSkgewogICAgICAgIHN1cGVyKCk7CiAgICAgICAgdGhpcy5fcnVudGltZSA9IGE7CiAgICAgICAgdGhpcy5fdHJhbnNpdGlvbnMgPSBbXQogICAgfQogICAgUmVsZWFzZSgpIHsKICAgICAgICBmb3IgKGNvbnN0IGEgb2YgdGhpcy5fdHJhbnNpdGlvbnMpIGEuUmVsZWFzZSgpOwogICAgICAgIEMzJGpzY29tcCQxMTcuY2xlYXJBcnJheSh0aGlzLl90cmFuc2l0aW9ucyk7CiAgICAgICAgdGhpcy5fdHJhbnNpdGlvbnMgPSBudWxsCiAgICB9CiAgICBDcmVhdGUoYSkgewogICAgICAgIHRoaXMuX3RyYW5zaXRpb25zLnB1c2goQzMkanNjb21wJDExNy5UcmFuc2l0aW9uLkNyZWF0ZShhKSkKICAgIH0KfTsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkMTE4ID0gc2VsZi5DMzsKQzMkanNjb21wJDExOC5UZW1wbGF0ZU1hbmFnZXIgPSBjbGFzcyBleHRlbmRzIEMzJGpzY29tcCQxMTguRGVmZW5kZWRCYXNlIHsKICAgIGNvbnN0cnVjdG9yKGEpIHsKICAgICAgICBzdXBlcigpOwogICAgICAgIHRoaXMuX3J1bnRpbWUgPSBhOwogICAgICAgIHRoaXMuX2luc3RhbmNlVG9UZW1wbGF0ZU5hbWVNYXAgPSB0aGlzLl90ZW1wbGF0ZURhdGFNYXAgPSBudWxsOwogICAgICAgIHRoaXMuX2luc3RhbmNlRGVzdHJveSA9IGIgPT4gdGhpcy5fT25JbnN0YW5jZURlc3Ryb3koYi5pbnN0YW5jZSkKICAgIH0KICAgIFJlbGVhc2UoKSB7CiAgICAgICAgdGhpcy5SZW1vdmVSdW50aW1lTGlzdGVuZXJzKCk7CiAgICAgICAgaWYgKHRoaXMuX3RlbXBsYXRlRGF0YU1hcCkgewogICAgICAgICAgICBmb3IgKGNvbnN0IGEgb2YgdGhpcy5fdGVtcGxhdGVEYXRhTWFwLnZhbHVlcygpKSBhLmNsZWFyKCk7CiAgICAgICAgICAgIHRoaXMuX3RlbXBsYXRlRGF0YU1hcC5jbGVhcigpCiAgICAgICAgfQogICAgICAgIHRoaXMuX3J1bnRpbWUgPSB0aGlzLl90ZW1wbGF0ZURhdGFNYXAgPSBudWxsCiAgICB9CiAgICBDcmVhdGUoYSkgewogICAgICAgIHRoaXMuX3RlbXBsYXRlRGF0YU1hcCB8fCAodGhpcy5fdGVtcGxhdGVEYXRhTWFwID0gbmV3IE1hcCk7CiAgICAgICAgaWYgKGEpIHsKICAgICAgICAgICAgdmFyIGIgPSBhWzBdWzE2XVswXSwKICAgICAgICAgICAgICAgIGQgPSBhWzFdOwogICAgICAgICAgICB0aGlzLl90ZW1wbGF0ZURhdGFNYXAuaGFzKGQpIHx8IHRoaXMuX3RlbXBsYXRlRGF0YU1hcC5zZXQoZCwgbmV3IE1hcCk7CiAgICAgICAgICAgIHRoaXMuX3RlbXBsYXRlRGF0YU1hcC5nZXQoZCkuc2V0KGIsIGEpCiAgICAgICAgfQogICAgfQogICAgQWRkUnVudGltZUxpc3RlbmVycygpIHsKICAgICAgICBjb25zdCBhID0gdGhpcy5fcnVudGltZS5EaXNwYXRjaGVyKCk7CiAgICAgICAgYSAmJiBhLmFkZEV2ZW50TGlzdGVuZXIoImluc3RhbmNlZGVzdHJveSIsIHRoaXMuX2luc3RhbmNlRGVzdHJveSkKICAgIH0KICAgIFJlbW92ZVJ1bnRpbWVMaXN0ZW5lcnMoKSB7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuX3J1bnRpbWUuRGlzcGF0Y2hlcigpOwogICAgICAgIGEgJiYgYS5yZW1vdmVFdmVudExpc3RlbmVyKCJpbnN0YW5jZWRlc3Ryb3kiLCB0aGlzLl9pbnN0YW5jZURlc3Ryb3kpCiAgICB9CiAgICBIYXNUZW1wbGF0ZXMoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3RlbXBsYXRlRGF0YU1hcCA/IDAgIT09IHRoaXMuX3RlbXBsYXRlRGF0YU1hcC5zaXplIDogITEKICAgIH0KICAgIEdldFRlbXBsYXRlRGF0YShhLCBiKSB7CiAgICAgICAgYSA9IGEgaW5zdGFuY2VvZiBDMyRqc2NvbXAkMTE4Lk9iamVjdENsYXNzID8gYS5HZXRJbmRleCgpIDoKICAgICAgICAgICAgYTsKICAgICAgICBpZiAodGhpcy5fdGVtcGxhdGVEYXRhTWFwLmhhcyhhKSAmJiAoYiA9IHRoaXMuX3RlbXBsYXRlRGF0YU1hcC5nZXQoYSkuZ2V0KGIpKSkgcmV0dXJuIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoYikpCiAgICB9CiAgICBNYXBJbnN0YW5jZVRvVGVtcGxhdGVOYW1lKGEsIGIpIHsKICAgICAgICB0aGlzLl9pbnN0YW5jZVRvVGVtcGxhdGVOYW1lTWFwIHx8ICh0aGlzLl9pbnN0YW5jZVRvVGVtcGxhdGVOYW1lTWFwID0gbmV3IFdlYWtNYXApOwogICAgICAgIHRoaXMuX2luc3RhbmNlVG9UZW1wbGF0ZU5hbWVNYXAuaGFzKGEpIHx8IHRoaXMuX2luc3RhbmNlVG9UZW1wbGF0ZU5hbWVNYXAuc2V0KGEsIGIpCiAgICB9CiAgICBHZXRJbnN0YW5jZVRlbXBsYXRlTmFtZShhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2luc3RhbmNlVG9UZW1wbGF0ZU5hbWVNYXAgPyAoYSA9IHRoaXMuX2luc3RhbmNlVG9UZW1wbGF0ZU5hbWVNYXAuZ2V0KGEpKSA/IGEgOiAiIiA6ICIiCiAgICB9CiAgICBfT25JbnN0YW5jZURlc3Ryb3koYSkgewogICAgICAgIHRoaXMuX2luc3RhbmNlVG9UZW1wbGF0ZU5hbWVNYXAgJiYgdGhpcy5faW5zdGFuY2VUb1RlbXBsYXRlTmFtZU1hcC5oYXMoYSkgJiYKICAgICAgICAgICAgdGhpcy5faW5zdGFuY2VUb1RlbXBsYXRlTmFtZU1hcC5kZWxldGUoYSkKICAgIH0KfTsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkMTE5ID0gc2VsZi5DMzsKQzMkanNjb21wJDExOS5Tb2xTdGFjayA9IGNsYXNzIGV4dGVuZHMgQzMkanNjb21wJDExOS5EZWZlbmRlZEJhc2UgewogICAgY29uc3RydWN0b3IoYSkgewogICAgICAgIHN1cGVyKCk7CiAgICAgICAgdGhpcy5fb2JqZWN0Q2xhc3MgPSBhOwogICAgICAgIHRoaXMuX3N0YWNrID0gW107CiAgICAgICAgdGhpcy5fc3RhY2sucHVzaChDMyRqc2NvbXAkMTE5Lk5ldyhDMyRqc2NvbXAkMTE5LlNvbCwgdGhpcykpOwogICAgICAgIHRoaXMuX2luZGV4ID0gMDsKICAgICAgICB0aGlzLl9jdXJyZW50ID0gdGhpcy5fc3RhY2tbMF0KICAgIH0KICAgIFJlbGVhc2UoKSB7CiAgICAgICAgZm9yIChjb25zdCBhIG9mIHRoaXMuX3N0YWNrKSBhLlJlbGVhc2UoKTsKICAgICAgICBDMyRqc2NvbXAkMTE5LmNsZWFyQXJyYXkodGhpcy5fc3RhY2spOwogICAgICAgIHRoaXMuX29iamVjdENsYXNzID0gdGhpcy5fY3VycmVudCA9IG51bGwKICAgIH0KICAgIEdldE9iamVjdENsYXNzKCkgewogICAgICAgIHJldHVybiB0aGlzLl9vYmplY3RDbGFzcwogICAgfQogICAgR2V0Q3VycmVudFNvbCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fY3VycmVudAogICAgfQogICAgQ2xlYXIoKSB7CiAgICAgICAgdGhpcy5HZXRDdXJyZW50U29sKCkuQ2xlYXIoKQogICAgfQogICAgUHVzaENsZWFuKCkgewogICAgICAgIHZhciBhID0gdGhpcy5fc3RhY2ssCiAgICAgICAgICAgIGIgPSArK3RoaXMuX2luZGV4OwogICAgICAgIGIgPT09IGEubGVuZ3RoID8gKGIgPSBDMyRqc2NvbXAkMTE5Lk5ldyhDMyRqc2NvbXAkMTE5LlNvbCwgdGhpcyksIGEucHVzaChiKSwgdGhpcy5fY3VycmVudCA9IGIpIDogKGEgPSBhW2JdLCBhLlJlc2V0KCksIHRoaXMuX2N1cnJlbnQgPSBhKQogICAgfQogICAgUHVzaENvcHkoKSB7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuX3N0YWNrLAogICAgICAgICAgICBiID0gKyt0aGlzLl9pbmRleDsKICAgICAgICBiID09PSBhLmxlbmd0aCAmJiBhLnB1c2goQzMkanNjb21wJDExOS5OZXcoQzMkanNjb21wJDExOS5Tb2wsIHRoaXMpKTsKICAgICAgICBjb25zdCBkID0gYVtiXTsKICAgICAgICBkLkNvcHkoYVtiIC0gMV0pOwogICAgICAgIHRoaXMuX2N1cnJlbnQgPSBkCiAgICB9CiAgICBQb3AoKSB7CiAgICAgICAgdGhpcy5fY3VycmVudCA9IHRoaXMuX3N0YWNrWy0tdGhpcy5faW5kZXhdCiAgICB9CiAgICBSZW1vdmVJbnN0YW5jZXMoYSkgewogICAgICAgIGNvbnN0IGIgPSB0aGlzLl9zdGFjazsKICAgICAgICBmb3IgKGxldCBkID0gMCwgYyA9IGIubGVuZ3RoOyBkIDwgYzsgKytkKSBiW2RdLlJlbW92ZUluc3RhbmNlcyhhKQogICAgfQp9OwoidXNlIHN0cmljdCI7CmNvbnN0IEMzJGpzY29tcCQxMjAgPSBzZWxmLkMzOwpDMyRqc2NvbXAkMTIwLlNvbCA9IGNsYXNzIGV4dGVuZHMgQzMkanNjb21wJDEyMC5EZWZlbmRlZEJhc2UgewogICAgY29uc3RydWN0b3IoYSkgewogICAgICAgIHN1cGVyKCk7CiAgICAgICAgdGhpcy5fc3RhY2sgPSBhOwogICAgICAgIHRoaXMuX29iamVjdENsYXNzID0gdGhpcy5fc3RhY2suR2V0T2JqZWN0Q2xhc3MoKTsKICAgICAgICB0aGlzLl9ldmVudFN0YWNrID0gdGhpcy5fb2JqZWN0Q2xhc3MuR2V0UnVudGltZSgpLkdldEV2ZW50U3RhY2soKTsKICAgICAgICB0aGlzLl9zZWxlY3RBbGwgPSAhMDsKICAgICAgICB0aGlzLl9pbnN0YW5jZXMgPSBbXTsKICAgICAgICB0aGlzLl9lbHNlSW5zdGFuY2VzID0gW10KICAgIH0KICAgIFJlbGVhc2UoKSB7CiAgICAgICAgdGhpcy5DbGVhckFycmF5cygpOwogICAgICAgIHRoaXMuX2V2ZW50U3RhY2sgPSB0aGlzLl9vYmplY3RDbGFzcyA9IHRoaXMuX3N0YWNrID0gbnVsbAogICAgfQogICAgQ2xlYXJBcnJheXMoKSB7CiAgICAgICAgQzMkanNjb21wJDEyMC5jbGVhckFycmF5KHRoaXMuX2luc3RhbmNlcyk7CiAgICAgICAgQzMkanNjb21wJDEyMC5jbGVhckFycmF5KHRoaXMuX2Vsc2VJbnN0YW5jZXMpCiAgICB9CiAgICBHZXRPYmplY3RDbGFzcygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fb2JqZWN0Q2xhc3MKICAgIH0KICAgIElzU2VsZWN0QWxsKCkgewogICAgICAgIHJldHVybiB0aGlzLl9zZWxlY3RBbGwKICAgIH0KICAgIEhhc0FueUluc3RhbmNlcygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fc2VsZWN0QWxsID8KICAgICAgICAgICAgISF0aGlzLl9vYmplY3RDbGFzcy5HZXRJbnN0YW5jZUNvdW50KCkgOiAhIXRoaXMuX2luc3RhbmNlcy5sZW5ndGgKICAgIH0KICAgIEdldEluc3RhbmNlcygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fc2VsZWN0QWxsID8gdGhpcy5fb2JqZWN0Q2xhc3MuR2V0SW5zdGFuY2VzKCkgOiB0aGlzLl9pbnN0YW5jZXMKICAgIH0KICAgIEhhc0FueUVsc2VJbnN0YW5jZXMoKSB7CiAgICAgICAgcmV0dXJuICEhdGhpcy5fZWxzZUluc3RhbmNlcy5sZW5ndGgKICAgIH0KICAgIEdldEVsc2VJbnN0YW5jZXMoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2Vsc2VJbnN0YW5jZXMKICAgIH0KICAgIEdldEV4cHJlc3Npb25JbnN0YW5jZXMoKSB7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuR2V0SW5zdGFuY2VzKCk7CiAgICAgICAgcmV0dXJuIGEubGVuZ3RoID8gYSA6IHRoaXMuX2Vsc2VJbnN0YW5jZXMKICAgIH0KICAgIFJlc2V0KCkgewogICAgICAgIHRoaXMuX3NlbGVjdEFsbCA9ICEwOwogICAgICAgIEMzJGpzY29tcCQxMjAuY2xlYXJBcnJheSh0aGlzLl9lbHNlSW5zdGFuY2VzKQogICAgfQogICAgQ2xlYXIoKSB7CiAgICAgICAgdGhpcy5fc2VsZWN0QWxsID0gITAKICAgIH0KICAgIENvcHkoYSkgewogICAgICAgIGEuSXNTZWxlY3RBbGwoKSA/IHRoaXMuUmVzZXQoKSA6ICh0aGlzLl9zZWxlY3RBbGwgPSAhMSwKICAgICAgICAgICAgQzMkanNjb21wJDEyMC5zaGFsbG93QXNzaWduQXJyYXkodGhpcy5faW5zdGFuY2VzLCBhLl9pbnN0YW5jZXMpLCBDMyRqc2NvbXAkMTIwLmNsZWFyQXJyYXkodGhpcy5fZWxzZUluc3RhbmNlcykpCiAgICB9CiAgICBfUHVzaEluc3RhbmNlKGEpIHsKICAgICAgICB0aGlzLl9pbnN0YW5jZXMucHVzaChhKQogICAgfQogICAgX1B1c2hFbHNlSW5zdGFuY2UoYSkgewogICAgICAgIHRoaXMuX2Vsc2VJbnN0YW5jZXMucHVzaChhKQogICAgfQogICAgX1NldFNlbGVjdEFsbChhKSB7CiAgICAgICAgdGhpcy5fc2VsZWN0QWxsID0gISFhCiAgICB9CiAgICBfR2V0T3duSW5zdGFuY2VzKCkgewogICAgICAgIHJldHVybiB0aGlzLl9pbnN0YW5jZXMKICAgIH0KICAgIF9HZXRPd25FbHNlSW5zdGFuY2VzKCkgewogICAgICAgIHJldHVybiB0aGlzLl9lbHNlSW5zdGFuY2VzCiAgICB9CiAgICBTZXRTaW5nbGVQaWNrZWQoYSkgewogICAgICAgIHRoaXMuX3NlbGVjdEFsbCA9ICExOwogICAgICAgIEMzJGpzY29tcCQxMjAuY2xlYXJBcnJheSh0aGlzLl9pbnN0YW5jZXMpOwogICAgICAgIHRoaXMuX2luc3RhbmNlcy5wdXNoKGEpCiAgICB9CiAgICBTZXRBcnJheVBpY2tlZChhKSB7CiAgICAgICAgdGhpcy5fc2VsZWN0QWxsID0gITE7CiAgICAgICAgQzMkanNjb21wJDEyMC5zaGFsbG93QXNzaWduQXJyYXkodGhpcy5faW5zdGFuY2VzLAogICAgICAgICAgICBhKQogICAgfQogICAgU2V0U2V0UGlja2VkKGEpIHsKICAgICAgICB0aGlzLl9zZWxlY3RBbGwgPSAhMTsKICAgICAgICBDMyRqc2NvbXAkMTIwLmNsZWFyQXJyYXkodGhpcy5faW5zdGFuY2VzKTsKICAgICAgICBmb3IgKGNvbnN0IGIgb2YgYSkgdGhpcy5faW5zdGFuY2VzLnB1c2goYikKICAgIH0KICAgIEFkZEVsc2VJbnN0YW5jZXMoYSwgYikgewogICAgICAgIGZvciAoY29uc3QgZCBvZiBiKSBhLmhhcyhkKSB8fCB0aGlzLl9lbHNlSW5zdGFuY2VzLnB1c2goZCkKICAgIH0KICAgIFRyYW5zZmVyRWxzZUluc3RhbmNlc1RvT3duKGEpIHsKICAgICAgICBmb3IgKGNvbnN0IGIgb2YgYSkgdGhpcy5faW5zdGFuY2VzLnB1c2goYik7CiAgICAgICAgQzMkanNjb21wJDEyMC5hcnJheVJlbW92ZUFsbEluU2V0KHRoaXMuX2Vsc2VJbnN0YW5jZXMsIGEpCiAgICB9CiAgICBQaWNrT25lKGEpIHsKICAgICAgICBhICYmICh0aGlzLl9ldmVudFN0YWNrLkdldEN1cnJlbnRTdGFja0ZyYW1lKCkuR2V0Q3VycmVudEV2ZW50KCkuSXNPckJsb2NrKCkgPyAodGhpcy5Jc1NlbGVjdEFsbCgpICYmIChDMyRqc2NvbXAkMTIwLmNsZWFyQXJyYXkodGhpcy5faW5zdGFuY2VzKSwgQzMkanNjb21wJDEyMC5zaGFsbG93QXNzaWduQXJyYXkodGhpcy5fZWxzZUluc3RhbmNlcywKICAgICAgICAgICAgYS5HZXRPYmplY3RDbGFzcygpLkdldEluc3RhbmNlcygpKSwgdGhpcy5fc2VsZWN0QWxsID0gITEpLCBhID0gdGhpcy5fZWxzZUluc3RhbmNlcy5pbmRleE9mKGEpLCAtMSAhPT0gYSAmJiAodGhpcy5faW5zdGFuY2VzLnB1c2godGhpcy5fZWxzZUluc3RhbmNlc1thXSksIHRoaXMuX2Vsc2VJbnN0YW5jZXMuc3BsaWNlKGEsIDEpKSkgOiB0aGlzLlNldFNpbmdsZVBpY2tlZChhKSkKICAgIH0KICAgIFJlbW92ZUluc3RhbmNlcyhhKSB7CiAgICAgICAgQzMkanNjb21wJDEyMC5hcnJheVJlbW92ZUFsbEluU2V0KHRoaXMuX2luc3RhbmNlcywgYSk7CiAgICAgICAgQzMkanNjb21wJDEyMC5hcnJheVJlbW92ZUFsbEluU2V0KHRoaXMuX2Vsc2VJbnN0YW5jZXMsIGEpCiAgICB9Cn07CiJ1c2Ugc3RyaWN0IjsKY29uc3QgQzMkanNjb21wJDEyMSA9IHNlbGYuQzM7CkMzJGpzY29tcCQxMjEuRXZlbnRTdGFjayA9IGNsYXNzIGV4dGVuZHMgQzMkanNjb21wJDEyMS5EZWZlbmRlZEJhc2UgewogICAgY29uc3RydWN0b3IoYSkgewogICAgICAgIHN1cGVyKCk7CiAgICAgICAgdGhpcy5fZXZlbnRTaGVldE1hbmFnZXIgPSBhOwogICAgICAgIHRoaXMuX3J1bnRpbWUgPSB0aGlzLl9ldmVudFNoZWV0TWFuYWdlci5HZXRSdW50aW1lKCk7CiAgICAgICAgdGhpcy5fc3RhY2sgPSBbXTsKICAgICAgICB0aGlzLl9zdGFjay5wdXNoKEMzJGpzY29tcCQxMjEuTmV3KEMzJGpzY29tcCQxMjEuRXZlbnRTdGFja0ZyYW1lLCB0aGlzLCBudWxsKSk7CiAgICAgICAgdGhpcy5faW5kZXggPSAwOwogICAgICAgIHRoaXMuX2V4cEZ1bmNTdGFjayA9IFtdCiAgICB9CiAgICBSZWxlYXNlKCkgewogICAgICAgIGZvciAoY29uc3QgYSBvZiB0aGlzLl9zdGFjaykgYS5SZWxlYXNlKCk7CiAgICAgICAgQzMkanNjb21wJDEyMS5jbGVhckFycmF5KHRoaXMuX3N0YWNrKTsKICAgICAgICBDMyRqc2NvbXAkMTIxLmNsZWFyQXJyYXkodGhpcy5fZXhwRnVuY1N0YWNrKTsKICAgICAgICB0aGlzLl9ydW50aW1lID0gdGhpcy5fZXZlbnRTaGVldE1hbmFnZXIgPSBudWxsCiAgICB9CiAgICBHZXRFdmVudFNoZWV0TWFuYWdlcigpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZXZlbnRTaGVldE1hbmFnZXIKICAgIH0KICAgIEdldFJ1bnRpbWUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUKICAgIH0KICAgIEdldEN1cnJlbnRTdGFja0ZyYW1lKCkgewogICAgICAgIHJldHVybiB0aGlzLl9zdGFja1t0aGlzLl9pbmRleF0KICAgIH0KICAgIFB1c2goYSkgewogICAgICAgIHZhciBiID0KICAgICAgICAgICAgdGhpcy5fc3RhY2s7CiAgICAgICAgY29uc3QgZCA9ICsrdGhpcy5faW5kZXg7CiAgICAgICAgaWYgKGQgPT09IGIubGVuZ3RoKSByZXR1cm4gYSA9IEMzJGpzY29tcCQxMjEuTmV3KEMzJGpzY29tcCQxMjEuRXZlbnRTdGFja0ZyYW1lLCB0aGlzLCBhKSwgYi5wdXNoKGEpLCBhOwogICAgICAgIGIgPSBiW2RdOwogICAgICAgIGIuUmVzZXQoYSk7CiAgICAgICAgcmV0dXJuIGIKICAgIH0KICAgIFBvcCgpIHsKICAgICAgICAtLXRoaXMuX2luZGV4CiAgICB9CiAgICBQdXNoRXhwRnVuYyhhKSB7CiAgICAgICAgdGhpcy5fZXhwRnVuY1N0YWNrLnB1c2goYSkKICAgIH0KICAgIFBvcEV4cEZ1bmMoKSB7CiAgICAgICAgdGhpcy5fZXhwRnVuY1N0YWNrLnBvcCgpCiAgICB9CiAgICBHZXRDdXJyZW50RXhwRnVuY1N0YWNrRnJhbWUoKSB7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuX2V4cEZ1bmNTdGFjazsKICAgICAgICByZXR1cm4gMCA9PT0gYS5sZW5ndGggPyBudWxsIDogYS5hdCgtMSkKICAgIH0KfTsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkMTIyID0gc2VsZi5DMzsKQzMkanNjb21wJDEyMi5FdmVudFN0YWNrRnJhbWUgPSBjbGFzcyBleHRlbmRzIEMzJGpzY29tcCQxMjIuRGVmZW5kZWRCYXNlIHsKICAgIGNvbnN0cnVjdG9yKGEsIGIpIHsKICAgICAgICBzdXBlcigpOwogICAgICAgIHRoaXMuX3N0YWNrID0gYTsKICAgICAgICB0aGlzLl9ydW50aW1lID0gdGhpcy5fc3RhY2suR2V0UnVudGltZSgpOwogICAgICAgIHRoaXMuX2N1cnJlbnRFdmVudCA9IGI7CiAgICAgICAgdGhpcy5fYWN0SW5kZXggPSB0aGlzLl9jbmRJbmRleCA9IDA7CiAgICAgICAgdGhpcy5fZWxzZUJyYW5jaFJhbiA9IHRoaXMuX2xhc3RFdmVudFRydWUgPSAhMTsKICAgICAgICB0aGlzLl9leHByZXNzaW9uT2JqZWN0Q2xhc3MgPSBudWxsOwogICAgICAgIHRoaXMuX2Z1bmN0aW9uUmV0dXJuVmFsdWUgPSB0aGlzLl9mdW5jdGlvblJldHVyblR5cGUgPSAwCiAgICB9CiAgICBSZWxlYXNlKCkgewogICAgICAgIHRoaXMuUmVzZXQobnVsbCk7CiAgICAgICAgdGhpcy5fcnVudGltZSA9IHRoaXMuX3N0YWNrID0gbnVsbAogICAgfQogICAgUmVzZXQoYSkgewogICAgICAgIHRoaXMuX2N1cnJlbnRFdmVudCA9IGE7CiAgICAgICAgdGhpcy5fYWN0SW5kZXggPSB0aGlzLl9jbmRJbmRleCA9IDA7CiAgICAgICAgdGhpcy5fZWxzZUJyYW5jaFJhbiA9IHRoaXMuX2xhc3RFdmVudFRydWUgPSAhMQogICAgfQogICAgX1Jlc3RvcmUoYSwKICAgICAgICBiKSB7CiAgICAgICAgdGhpcy5fY3VycmVudEV2ZW50ID0gYTsKICAgICAgICB0aGlzLl9jbmRJbmRleCA9IDA7CiAgICAgICAgdGhpcy5fYWN0SW5kZXggPSBiCiAgICB9CiAgICBSZXNldFF1aWNrKCkgewogICAgICAgIHRoaXMuX2FjdEluZGV4ID0gdGhpcy5fY25kSW5kZXggPSAwCiAgICB9CiAgICBHZXRDdXJyZW50RXZlbnQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2N1cnJlbnRFdmVudAogICAgfQogICAgU2V0Q3VycmVudEV2ZW50KGEpIHsKICAgICAgICB0aGlzLl9jdXJyZW50RXZlbnQgPSBhCiAgICB9CiAgICBHZXRDb25kaXRpb25JbmRleCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fY25kSW5kZXgKICAgIH0KICAgIFNldENvbmRpdGlvbkluZGV4KGEpIHsKICAgICAgICB0aGlzLl9jbmRJbmRleCA9IGEKICAgIH0KICAgIEdldEFjdGlvbkluZGV4KCkgewogICAgICAgIHJldHVybiB0aGlzLl9hY3RJbmRleAogICAgfQogICAgU2V0QWN0aW9uSW5kZXgoYSkgewogICAgICAgIHRoaXMuX2FjdEluZGV4ID0gYQogICAgfQogICAgU2V0TGFzdEV2ZW50VHJ1ZShhKSB7CiAgICAgICAgdGhpcy5fbGFzdEV2ZW50VHJ1ZSA9ICEhYQogICAgfQogICAgR2V0TGFzdEV2ZW50VHJ1ZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fbGFzdEV2ZW50VHJ1ZQogICAgfQogICAgU2V0RWxzZUJyYW5jaFJhbihhKSB7CiAgICAgICAgdGhpcy5fZWxzZUJyYW5jaFJhbiA9ICEhYQogICAgfQogICAgR2V0RWxzZUJyYW5jaFJhbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZWxzZUJyYW5jaFJhbgogICAgfQogICAgU2V0RXhwcmVzc2lvbk9iamVjdENsYXNzKGEpIHsKICAgICAgICB0aGlzLl9leHByZXNzaW9uT2JqZWN0Q2xhc3MgPQogICAgICAgICAgICBhCiAgICB9CiAgICBHZXRFeHByZXNzaW9uT2JqZWN0Q2xhc3MoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2V4cHJlc3Npb25PYmplY3RDbGFzcwogICAgfQogICAgSW5pdENhbGxGdW5jdGlvbkV4cHJlc3Npb24oYSwgYikgewogICAgICAgIHRoaXMuX2Z1bmN0aW9uUmV0dXJuVHlwZSA9IGE7CiAgICAgICAgdGhpcy5fZnVuY3Rpb25SZXR1cm5WYWx1ZSA9IGIKICAgIH0KICAgIEdldEZ1bmN0aW9uUmV0dXJuVHlwZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZnVuY3Rpb25SZXR1cm5UeXBlCiAgICB9CiAgICBTZXRGdW5jdGlvblJldHVyblZhbHVlKGEpIHsKICAgICAgICB0aGlzLl9mdW5jdGlvblJldHVyblZhbHVlID0gYQogICAgfQogICAgR2V0RnVuY3Rpb25SZXR1cm5WYWx1ZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZnVuY3Rpb25SZXR1cm5WYWx1ZQogICAgfQogICAgSXNTb2xNb2RpZmllckFmdGVyQ25kcygpIHsKICAgICAgICBjb25zdCBhID0gdGhpcy5fY3VycmVudEV2ZW50OwogICAgICAgIHJldHVybiBhLklzU29sV3JpdGVyQWZ0ZXJDbmRzKCkgPyAhMCA6IHRoaXMuX2NuZEluZGV4IDwgYS5HZXRDb25kaXRpb25Db3VudCgpIC0gMSA/ICEhYS5HZXRTb2xNb2RpZmllcnMoKS5sZW5ndGggOiAhMQogICAgfQp9OwoidXNlIHN0cmljdCI7CmNvbnN0IEMzJGpzY29tcCQxMjMgPSBzZWxmLkMzOwpDMyRqc2NvbXAkMTIzLkxvY2FsVmFyU3RhY2sgPSBjbGFzcyBleHRlbmRzIEMzJGpzY29tcCQxMjMuRGVmZW5kZWRCYXNlIHsKICAgIGNvbnN0cnVjdG9yKGEpIHsKICAgICAgICBzdXBlcigpOwogICAgICAgIHRoaXMuX2V2ZW50U2hlZXRNYW5hZ2VyID0gYTsKICAgICAgICB0aGlzLl9ydW50aW1lID0gdGhpcy5fZXZlbnRTaGVldE1hbmFnZXIuR2V0UnVudGltZSgpOwogICAgICAgIHRoaXMuX3N0YWNrID0gW107CiAgICAgICAgdGhpcy5faW5kZXggPSAtMTsKICAgICAgICB0aGlzLl9jdXJyZW50ID0gbnVsbDsKICAgICAgICB0aGlzLl9pbml0aWFsVmFsdWVzID0gW10KICAgIH0KICAgIFJlbGVhc2UoKSB7CiAgICAgICAgQzMkanNjb21wJDEyMy5jbGVhckFycmF5KHRoaXMuX3N0YWNrKTsKICAgICAgICB0aGlzLl9ydW50aW1lID0gdGhpcy5fZXZlbnRTaGVldE1hbmFnZXIgPSBudWxsCiAgICB9CiAgICBfU2V0SW5pdGlhbFZhbHVlcyhhKSB7CiAgICAgICAgdGhpcy5faW5pdGlhbFZhbHVlcyA9IGE7CiAgICAgICAgYSA9IHRoaXMuX2luaXRpYWxWYWx1ZXMuc2xpY2UoMCk7CiAgICAgICAgdGhpcy5fc3RhY2sucHVzaChhKTsKICAgICAgICB0aGlzLl9pbmRleCA9IDA7CiAgICAgICAgdGhpcy5fY3VycmVudCA9IGEKICAgIH0KICAgIEdldEV2ZW50U2hlZXRNYW5hZ2VyKCkgewogICAgICAgIHJldHVybiB0aGlzLl9ldmVudFNoZWV0TWFuYWdlcgogICAgfQogICAgR2V0UnVudGltZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcnVudGltZQogICAgfQogICAgR2V0Q3VycmVudCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fY3VycmVudAogICAgfQogICAgUHVzaCgpIHsKICAgICAgICBjb25zdCBhID0gKyt0aGlzLl9pbmRleCwKICAgICAgICAgICAgYiA9IHRoaXMuX3N0YWNrOwogICAgICAgIGEgPT09IGIubGVuZ3RoID8gYi5wdXNoKHRoaXMuX2luaXRpYWxWYWx1ZXMuc2xpY2UoMCkpIDogQzMkanNjb21wJDEyMy5zaGFsbG93QXNzaWduQXJyYXkoYlthXSwgdGhpcy5faW5pdGlhbFZhbHVlcyk7CiAgICAgICAgdGhpcy5fY3VycmVudCA9IGJbYV0KICAgIH0KICAgIFBvcCgpIHsKICAgICAgICB0aGlzLl9jdXJyZW50ID0gdGhpcy5fc3RhY2tbLS10aGlzLl9pbmRleF0KICAgIH0KfTsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkMTI0ID0gc2VsZi5DMzsKQzMkanNjb21wJDEyNC5Mb29wU3RhY2sgPSBjbGFzcyBleHRlbmRzIEMzJGpzY29tcCQxMjQuRGVmZW5kZWRCYXNlIHsKICAgIGNvbnN0cnVjdG9yKGEpIHsKICAgICAgICBzdXBlcigpOwogICAgICAgIHRoaXMuX2V2ZW50U2hlZXRNYW5hZ2VyID0gYTsKICAgICAgICB0aGlzLl9ydW50aW1lID0gdGhpcy5fZXZlbnRTaGVldE1hbmFnZXIuR2V0UnVudGltZSgpOwogICAgICAgIHRoaXMuX3N0YWNrID0gW107CiAgICAgICAgdGhpcy5faW5kZXggPSAtMQogICAgfQogICAgUmVsZWFzZSgpIHsKICAgICAgICBDMyRqc2NvbXAkMTI0LmNsZWFyQXJyYXkodGhpcy5fc3RhY2spOwogICAgICAgIHRoaXMuX3J1bnRpbWUgPSB0aGlzLl9ldmVudFNoZWV0TWFuYWdlciA9IG51bGwKICAgIH0KICAgIEdldEV2ZW50U2hlZXRNYW5hZ2VyKCkgewogICAgICAgIHJldHVybiB0aGlzLl9ldmVudFNoZWV0TWFuYWdlcgogICAgfQogICAgR2V0UnVudGltZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcnVudGltZQogICAgfQogICAgSXNJbkxvb3AoKSB7CiAgICAgICAgcmV0dXJuIDAgPD0gdGhpcy5faW5kZXgKICAgIH0KICAgIEdldEN1cnJlbnQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3N0YWNrW3RoaXMuX2luZGV4XQogICAgfQogICAgUHVzaCgpIHsKICAgICAgICArK3RoaXMuX2luZGV4OwogICAgICAgIGlmICh0aGlzLl9pbmRleCA9PT0gdGhpcy5fc3RhY2subGVuZ3RoKSB7CiAgICAgICAgICAgIHZhciBhID0KICAgICAgICAgICAgICAgIEMzJGpzY29tcCQxMjQuTmV3KEMzJGpzY29tcCQxMjQuTG9vcCwgdGhpcyk7CiAgICAgICAgICAgIHRoaXMuX3N0YWNrLnB1c2goYSk7CiAgICAgICAgICAgIHJldHVybiBhCiAgICAgICAgfQogICAgICAgIGEgPSB0aGlzLl9zdGFja1t0aGlzLl9pbmRleF07CiAgICAgICAgYS5SZXNldCgpOwogICAgICAgIHJldHVybiBhCiAgICB9CiAgICBQb3AoKSB7CiAgICAgICAgLS10aGlzLl9pbmRleAogICAgfQogICAgRmluZEJ5TmFtZShhKSB7CiAgICAgICAgY29uc3QgYiA9IHRoaXMuX3N0YWNrOwogICAgICAgIGZvciAobGV0IGQgPSB0aGlzLl9pbmRleDsgMCA8PSBkOyAtLWQpIHsKICAgICAgICAgICAgY29uc3QgYyA9IGJbZF07CiAgICAgICAgICAgIGlmIChjLkdldE5hbWUoKSA9PT0gYSkgcmV0dXJuIGMKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG51bGwKICAgIH0KICAgIF9HZXRTdGFjaygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fc3RhY2suc2xpY2UoMCwgdGhpcy5faW5kZXggKyAxKQogICAgfQp9OwoidXNlIHN0cmljdCI7CmNvbnN0IEMzJGpzY29tcCQxMjUgPSBzZWxmLkMzOwpDMyRqc2NvbXAkMTI1Lkxvb3AgPSBjbGFzcyBleHRlbmRzIEMzJGpzY29tcCQxMjUuRGVmZW5kZWRCYXNlIHsKICAgIGNvbnN0cnVjdG9yKGEpIHsKICAgICAgICBzdXBlcigpOwogICAgICAgIHRoaXMuX2xvb3BTdGFjayA9IGE7CiAgICAgICAgdGhpcy5fbmFtZSA9ICIiOwogICAgICAgIHRoaXMuX2luZGV4ID0gMDsKICAgICAgICB0aGlzLl9pc1N0b3BwZWQgPSAhMTsKICAgICAgICB0aGlzLl9lbmQgPSBOYU4KICAgIH0KICAgIFJlc2V0KCkgewogICAgICAgIHRoaXMuX25hbWUgPSAiIjsKICAgICAgICB0aGlzLl9pbmRleCA9IDA7CiAgICAgICAgdGhpcy5faXNTdG9wcGVkID0gITE7CiAgICAgICAgdGhpcy5fZW5kID0gTmFOCiAgICB9CiAgICBTZXROYW1lKGEpIHsKICAgICAgICB0aGlzLl9uYW1lID0gYQogICAgfQogICAgR2V0TmFtZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fbmFtZQogICAgfQogICAgU2V0SW5kZXgoYSkgewogICAgICAgIHRoaXMuX2luZGV4ID0gYQogICAgfQogICAgR2V0SW5kZXgoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2luZGV4CiAgICB9CiAgICBTdG9wKCkgewogICAgICAgIHRoaXMuX2lzU3RvcHBlZCA9ICEwCiAgICB9CiAgICBJc1N0b3BwZWQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2lzU3RvcHBlZAogICAgfQogICAgU2V0RW5kKGEpIHsKICAgICAgICB0aGlzLl9lbmQgPSBhCiAgICB9CiAgICBHZXRFbmQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2VuZAogICAgfQp9OwoidXNlIHN0cmljdCI7CmNvbnN0IEMzJGpzY29tcCQxMjYgPSBzZWxmLkMzOwpDMyRqc2NvbXAkMTI2LkFycmF5U3RhY2sgPSBjbGFzcyBleHRlbmRzIEMzJGpzY29tcCQxMjYuRGVmZW5kZWRCYXNlIHsKICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgIHN1cGVyKCk7CiAgICAgICAgdGhpcy5fc3RhY2sgPSBbXTsKICAgICAgICB0aGlzLl9pbmRleCA9IC0xCiAgICB9CiAgICBSZWxlYXNlKCkgewogICAgICAgIEMzJGpzY29tcCQxMjYuY2xlYXJBcnJheSh0aGlzLl9zdGFjaykKICAgIH0KICAgIEdldEN1cnJlbnQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3N0YWNrW3RoaXMuX2luZGV4XQogICAgfQogICAgUHVzaCgpIHsKICAgICAgICArK3RoaXMuX2luZGV4OwogICAgICAgIGlmICh0aGlzLl9pbmRleCA9PT0gdGhpcy5fc3RhY2subGVuZ3RoKSB7CiAgICAgICAgICAgIGNvbnN0IGEgPSBbXTsKICAgICAgICAgICAgdGhpcy5fc3RhY2sucHVzaChhKTsKICAgICAgICAgICAgcmV0dXJuIGEKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXMuX3N0YWNrW3RoaXMuX2luZGV4XQogICAgfQogICAgUG9wKCkgewogICAgICAgIC0tdGhpcy5faW5kZXgKICAgIH0KfTsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkMTI3ID0gc2VsZi5DMzsKCmZ1bmN0aW9uIFNvcnRTb2xBcnJheShhLCBiKSB7CiAgICByZXR1cm4gYS5HZXRJbmRleCgpIC0gYi5HZXRJbmRleCgpCn0KCmZ1bmN0aW9uIElzU29sQXJyYXlJZGVudGljYWwoYSwgYikgewogICAgZm9yIChsZXQgZCA9IDAsIGMgPSBhLmxlbmd0aDsgZCA8IGM7ICsrZCkKICAgICAgICBpZiAoYVtkXSAhPT0gYltkXSkgcmV0dXJuICExOwogICAgcmV0dXJuICEwCn0KQzMkanNjb21wJDEyNy5FdmVudFNoZWV0TWFuYWdlciA9IGNsYXNzIGV4dGVuZHMgQzMkanNjb21wJDEyNy5EZWZlbmRlZEJhc2UgewogICAgY29uc3RydWN0b3IoYSkgewogICAgICAgIHN1cGVyKCk7CiAgICAgICAgdGhpcy5fcnVudGltZSA9IGE7CiAgICAgICAgdGhpcy5fYWxsU2hlZXRzID0gW107CiAgICAgICAgdGhpcy5fc2hlZXRzQnlOYW1lID0gbmV3IE1hcDsKICAgICAgICB0aGlzLl9hbGxHcm91cHMgPSBbXTsKICAgICAgICB0aGlzLl9ncm91cHNCeU5hbWUgPSBuZXcgTWFwOwogICAgICAgIHRoaXMuX2Jsb2Nrc0J5U2lkID0gbmV3IE1hcDsKICAgICAgICB0aGlzLl9jbmRzQnlTaWQgPSBuZXcgTWFwOwogICAgICAgIHRoaXMuX2FjdHNCeVNpZCA9IG5ldyBNYXA7CiAgICAgICAgdGhpcy5fYWxsVW5pcXVlU29sTW9kaWZpZXJzID0gbmV3IE1hcDsKICAgICAgICB0aGlzLl9ldmVudFZhcnNCeVNpZCA9IG5ldyBNYXA7CiAgICAgICAgdGhpcy5fbmV4dExvY2FsVmFySW5kZXggPSAwOwogICAgICAgIHRoaXMuX2FsbEdsb2JhbFZhcnMgPSBbXTsKICAgICAgICB0aGlzLl9hbGxMb2NhbFZhcnMgPSBbXTsKICAgICAgICB0aGlzLl9sb2NhbFZhckluaXRpYWxWYWx1ZXMgPSBbXTsKICAgICAgICB0aGlzLl9mdW5jdGlvbkJsb2Nrc0J5TmFtZSA9IG5ldyBNYXA7CiAgICAgICAgdGhpcy5fZXZlbnRTdGFjayA9IEMzJGpzY29tcCQxMjcuTmV3KEMzJGpzY29tcCQxMjcuRXZlbnRTdGFjaywKICAgICAgICAgICAgdGhpcyk7CiAgICAgICAgdGhpcy5fbG9jYWxWYXJTdGFjayA9IEMzJGpzY29tcCQxMjcuTmV3KEMzJGpzY29tcCQxMjcuTG9jYWxWYXJTdGFjaywgdGhpcyk7CiAgICAgICAgdGhpcy5fbG9vcFN0YWNrID0gQzMkanNjb21wJDEyNy5OZXcoQzMkanNjb21wJDEyNy5Mb29wU3RhY2ssIHRoaXMpOwogICAgICAgIHRoaXMuX3RyaWdnZXJzVG9Qb3N0SW5pdCA9IFtdOwogICAgICAgIHRoaXMuX3F1ZXVlZFRyaWdnZXJzID0gW107CiAgICAgICAgdGhpcy5fcXVldWVkRGVidWdUcmlnZ2VycyA9IFtdOwogICAgICAgIHRoaXMuX2Jsb2NrRmx1c2hpbmdEZXB0aCA9IHRoaXMuX2V4ZWN1dGluZ1RyaWdnZXJEZXB0aCA9IHRoaXMuX3J1bm5pbmdFdmVudHNEZXB0aCA9IDA7CiAgICAgICAgdGhpcy5fc2NoZWR1bGVkV2FpdHMgPSBbXTsKICAgICAgICB0aGlzLl9hc3luY0FjdGlvblByb21pc2VzID0gW107CiAgICAgICAgc2VsZi5jM19jYWxsRnVuY3Rpb24gPSAoYiwgZCkgPT4gdGhpcy5fSW52b2tlRnVuY3Rpb25Gcm9tSlMoYiwgZCkKICAgIH0KICAgIFJlbGVhc2UoKSB7CiAgICAgICAgdGhpcy5DbGVhckFsbFNjaGVkdWxlZFdhaXRzKCk7CiAgICAgICAgdGhpcy5fZXZlbnRTdGFjay5SZWxlYXNlKCk7CiAgICAgICAgdGhpcy5fZXZlbnRTdGFjayA9IG51bGw7CiAgICAgICAgdGhpcy5fbG9jYWxWYXJTdGFjay5SZWxlYXNlKCk7CiAgICAgICAgdGhpcy5fbG9jYWxWYXJTdGFjayA9IG51bGw7CiAgICAgICAgQzMkanNjb21wJDEyNy5jbGVhckFycmF5KHRoaXMuX3F1ZXVlZFRyaWdnZXJzKTsKICAgICAgICBDMyRqc2NvbXAkMTI3LmNsZWFyQXJyYXkodGhpcy5fcXVldWVkRGVidWdUcmlnZ2Vycyk7CiAgICAgICAgdGhpcy5fcnVudGltZSA9IG51bGw7CiAgICAgICAgQzMkanNjb21wJDEyNy5jbGVhckFycmF5KHRoaXMuX2FsbFNoZWV0cyk7CiAgICAgICAgdGhpcy5fc2hlZXRzQnlOYW1lLmNsZWFyKCkKICAgIH0KICAgIENyZWF0ZShhKSB7CiAgICAgICAgYSA9IEMzJGpzY29tcCQxMjcuTmV3KEMzJGpzY29tcCQxMjcuRXZlbnRTaGVldCwgdGhpcywgYSk7CiAgICAgICAgdGhpcy5fYWxsU2hlZXRzLnB1c2goYSk7CiAgICAgICAgdGhpcy5fc2hlZXRzQnlOYW1lLnNldChhLkdldE5hbWUoKS50b0xvd2VyQ2FzZSgpLCBhKQogICAgfQogICAgX0FkZFRyaWdnZXJUb1Bvc3RJbml0KGEpIHsKICAgICAgICB0aGlzLl90cmlnZ2Vyc1RvUG9zdEluaXQucHVzaChhKQogICAgfQogICAgX1Bvc3RJbml0KCkgewogICAgICAgIGZvciAoY29uc3QgYSBvZiB0aGlzLl9mdW5jdGlvbkJsb2Nrc0J5TmFtZS52YWx1ZXMoKSkgYS5fUG9zdEluaXQoITEpOwogICAgICAgIGZvciAoY29uc3QgYSBvZiB0aGlzLl9hbGxTaGVldHMpIGEuX1Bvc3RJbml0KCk7CiAgICAgICAgZm9yIChjb25zdCBhIG9mIHRoaXMuX2FsbFNoZWV0cykgYS5fVXBkYXRlRGVlcEluY2x1ZGVzKCk7CiAgICAgICAgZm9yIChjb25zdCBhIG9mIHRoaXMuX3RyaWdnZXJzVG9Qb3N0SW5pdCkgYS5fUG9zdEluaXQoITEpOwogICAgICAgIEMzJGpzY29tcCQxMjcuY2xlYXJBcnJheSh0aGlzLl90cmlnZ2Vyc1RvUG9zdEluaXQpOwogICAgICAgIHRoaXMuX2xvY2FsVmFyU3RhY2suX1NldEluaXRpYWxWYWx1ZXModGhpcy5fbG9jYWxWYXJJbml0aWFsVmFsdWVzKQogICAgfQogICAgR2V0UnVudGltZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcnVudGltZQogICAgfQogICAgR2V0RXZlbnRTaGVldEJ5TmFtZShhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3NoZWV0c0J5TmFtZS5nZXQoYS50b0xvd2VyQ2FzZSgpKSB8fCBudWxsCiAgICB9CiAgICBfUmVnaXN0ZXJHcm91cChhKSB7CiAgICAgICAgdGhpcy5fYWxsR3JvdXBzLnB1c2goYSk7CiAgICAgICAgdGhpcy5fZ3JvdXBzQnlOYW1lLnNldChhLkdldEdyb3VwTmFtZSgpLCBhKQogICAgfQogICAgX1JlZ2lzdGVyRXZlbnRCbG9jayhhKSB7CiAgICAgICAgdGhpcy5fYmxvY2tzQnlTaWQuc2V0KGEuR2V0U0lEKCksCiAgICAgICAgICAgIGEpCiAgICB9CiAgICBfUmVnaXN0ZXJDb25kaXRpb24oYSkgewogICAgICAgIHRoaXMuX2NuZHNCeVNpZC5zZXQoYS5HZXRTSUQoKSwgYSkKICAgIH0KICAgIF9SZWdpc3RlckFjdGlvbihhKSB7CiAgICAgICAgdGhpcy5fYWN0c0J5U2lkLnNldChhLkdldFNJRCgpLCBhKQogICAgfQogICAgX1JlZ2lzdGVyRnVuY3Rpb25CbG9jayhhKSB7CiAgICAgICAgdGhpcy5fZnVuY3Rpb25CbG9ja3NCeU5hbWUuc2V0KGEuR2V0RnVuY3Rpb25OYW1lKCkudG9Mb3dlckNhc2UoKSwgYSkKICAgIH0KICAgIF9SZWdpc3RlckV2ZW50VmFyaWFibGUoYSkgewogICAgICAgIHRoaXMuX2V2ZW50VmFyc0J5U2lkLnNldChhLkdldFNJRCgpLCBhKTsKICAgICAgICBhLklzR2xvYmFsKCkgPyB0aGlzLl9hbGxHbG9iYWxWYXJzLnB1c2goYSkgOiB0aGlzLl9hbGxMb2NhbFZhcnMucHVzaChhKQogICAgfQogICAgX0RlZHVwbGljYXRlU29sTW9kaWZpZXJMaXN0KGEpIHsKICAgICAgICAyIDw9IGEubGVuZ3RoICYmIGEuc29ydChTb3J0U29sQXJyYXkpOwogICAgICAgIGxldCBiID0gdGhpcy5fYWxsVW5pcXVlU29sTW9kaWZpZXJzLmdldChhLmxlbmd0aCk7CiAgICAgICAgYiB8fCAoYiA9IFtdLCB0aGlzLl9hbGxVbmlxdWVTb2xNb2RpZmllcnMuc2V0KGEubGVuZ3RoLAogICAgICAgICAgICBiKSk7CiAgICAgICAgZm9yIChsZXQgZCA9IDAsIGMgPSBiLmxlbmd0aDsgZCA8IGM7ICsrZCkgewogICAgICAgICAgICBjb25zdCBlID0gYltkXTsKICAgICAgICAgICAgaWYgKElzU29sQXJyYXlJZGVudGljYWwoYSwgZSkpIHJldHVybiBlCiAgICAgICAgfQogICAgICAgIGIucHVzaChhKTsKICAgICAgICByZXR1cm4gYQogICAgfQogICAgX0dldE5leHRMb2NhbFZhckluZGV4KGEpIHsKICAgICAgICB0aGlzLl9sb2NhbFZhckluaXRpYWxWYWx1ZXMucHVzaChhLkdldEluaXRpYWxWYWx1ZSgpKTsKICAgICAgICByZXR1cm4gdGhpcy5fbmV4dExvY2FsVmFySW5kZXgrKwogICAgfQogICAgR2V0RXZlbnRTdGFjaygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZXZlbnRTdGFjawogICAgfQogICAgR2V0Q3VycmVudEV2ZW50U3RhY2tGcmFtZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5HZXRFdmVudFN0YWNrKCkuR2V0Q3VycmVudFN0YWNrRnJhbWUoKQogICAgfQogICAgR2V0Q3VycmVudEV2ZW50KCkgewogICAgICAgIHJldHVybiB0aGlzLkdldEN1cnJlbnRFdmVudFN0YWNrRnJhbWUoKS5HZXRDdXJyZW50RXZlbnQoKQogICAgfQogICAgR2V0Q3VycmVudENvbmRpdGlvbigpIHsKICAgICAgICBjb25zdCBhID0gdGhpcy5HZXRDdXJyZW50RXZlbnRTdGFja0ZyYW1lKCk7CiAgICAgICAgcmV0dXJuIGEuR2V0Q3VycmVudEV2ZW50KCkuR2V0Q29uZGl0aW9uQXQoYS5HZXRDb25kaXRpb25JbmRleCgpKQogICAgfQogICAgR2V0Q3VycmVudEFjdGlvbigpIHsKICAgICAgICBjb25zdCBhID0KICAgICAgICAgICAgdGhpcy5HZXRDdXJyZW50RXZlbnRTdGFja0ZyYW1lKCk7CiAgICAgICAgcmV0dXJuIGEuR2V0Q3VycmVudEV2ZW50KCkuR2V0QWN0aW9uQXQoYS5HZXRBY3Rpb25JbmRleCgpKQogICAgfQogICAgR2V0TG9jYWxWYXJTdGFjaygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fbG9jYWxWYXJTdGFjawogICAgfQogICAgR2V0TG9vcFN0YWNrKCkgewogICAgICAgIHJldHVybiB0aGlzLl9sb29wU3RhY2sKICAgIH0KICAgIEdldEFsbExvY2FsVmFyaWFibGVzSW5TY29wZShhKSB7CiAgICAgICAgY29uc3QgYiA9IFtdOwogICAgICAgIGZvciAoYSA9IGEuR2V0U2NvcGVQYXJlbnQoKTsgYTspIEMzJGpzY29tcCQxMjcuYXBwZW5kQXJyYXkoYiwgYS5fR2V0QWxsTG9jYWxWYXJpYWJsZXNJblNjb3BlKCkpLCBhID0gYS5HZXRTY29wZVBhcmVudCgpOwogICAgICAgIHJldHVybiBiCiAgICB9CiAgICBfR2V0TG9jYWxWYXJpYWJsZXNTY3JpcHRJbnRlcmZhY2UoYSkgewogICAgICAgIGNvbnN0IGIgPSB7fTsKICAgICAgICBmb3IgKGNvbnN0IGQgb2YgdGhpcy5HZXRBbGxMb2NhbFZhcmlhYmxlc0luU2NvcGUoYSkpIGJbZC5HZXRKc1Byb3BOYW1lKCldID0gZC5fR2V0U2NyaXB0SW50ZXJmYWNlRGVzY3JpcHRvcigpOwogICAgICAgIHJldHVybiBPYmplY3QuY3JlYXRlKE9iamVjdC5wcm90b3R5cGUsCiAgICAgICAgICAgIGIpCiAgICB9CiAgICBHZXRFdmVudFZhcmlhYmxlQnlTSUQoYSkgewogICAgICAgIHJldHVybiB0aGlzLl9ldmVudFZhcnNCeVNpZC5nZXQoYSkgfHwgbnVsbAogICAgfQogICAgR2V0RXZlbnRCbG9ja0J5U0lEKGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5fYmxvY2tzQnlTaWQuZ2V0KGEpIHx8IG51bGwKICAgIH0KICAgIEdldENvbmRpdGlvbkJ5U0lEKGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5fY25kc0J5U2lkLmdldChhKSB8fCBudWxsCiAgICB9CiAgICBHZXRBY3Rpb25CeVNJRChhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2FjdHNCeVNpZC5nZXQoYSkgfHwgbnVsbAogICAgfQogICAgR2V0RnVuY3Rpb25CbG9ja0J5TmFtZShhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2Z1bmN0aW9uQmxvY2tzQnlOYW1lLmdldChhLnRvTG93ZXJDYXNlKCkpIHx8IG51bGwKICAgIH0KICAgIEdldEFsbEdsb2JhbFZhcmlhYmxlcygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fYWxsR2xvYmFsVmFycwogICAgfQogICAgR2V0QWxsTG9jYWxWYXJpYWJsZXMoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2FsbExvY2FsVmFycwogICAgfQogICAgUmVzZXRBbGxHbG9iYWxzVG9Jbml0aWFsVmFsdWUoKSB7CiAgICAgICAgZm9yIChjb25zdCBhIG9mIHRoaXMuX2FsbEdsb2JhbFZhcnMpIGEuUmVzZXRUb0luaXRpYWxWYWx1ZSgpCiAgICB9CiAgICBHZXRFdmVudEdyb3VwQnlOYW1lKGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZ3JvdXBzQnlOYW1lLmdldChhLnRvTG93ZXJDYXNlKCkpIHx8CiAgICAgICAgICAgIG51bGwKICAgIH0KICAgIEdldEV2ZW50R3JvdXBCeVNJRChhKSB7CiAgICAgICAgcmV0dXJuIChhID0gdGhpcy5fYmxvY2tzQnlTaWQuZ2V0KGEpKSAmJiBhLklzR3JvdXAoKSA/IGEgOiBudWxsCiAgICB9CiAgICBHZXRBbGxHcm91cHMoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2FsbEdyb3VwcwogICAgfQogICAgUmVzZXRBbGxHcm91cHNJbml0aWFsQWN0aXZhdGlvbigpIHsKICAgICAgICBmb3IgKGNvbnN0IGEgb2YgdGhpcy5fYWxsR3JvdXBzKSBhLlJlc2V0SW5pdGlhbEFjdGl2YXRpb24oKQogICAgfQogICAgX1Jlc2V0QWxsSGFzUnVuRmxhZ3MoKSB7CiAgICAgICAgZm9yIChjb25zdCBhIG9mIHRoaXMuX2FsbFNoZWV0cykgYS5fUmVzZXRIYXNSdW5GbGFnKCkKICAgIH0KICAgIFJ1bkV2ZW50cyhhKSB7CiAgICAgICAgdGhpcy5fUmVzZXRBbGxIYXNSdW5GbGFncygpOwogICAgICAgIHRoaXMuX3J1bm5pbmdFdmVudHNEZXB0aCsrOwogICAgICAgIGZvciAoY29uc3QgYiBvZiBhLnJ1bm5pbmdMYXlvdXRzKCkpCiAgICAgICAgICAgIGlmIChhID0gYi5HZXRFdmVudFNoZWV0KCkpIHRoaXMuX3J1bnRpbWUuUHVzaEN1cnJlbnRMYXlvdXQoYiksIGEuUnVuKCksIHRoaXMuX3J1bnRpbWUuUG9wQ3VycmVudExheW91dCgpOwogICAgICAgIHRoaXMuX3J1bm5pbmdFdmVudHNEZXB0aC0tCiAgICB9CiAgICBhc3luYyBEZWJ1Z1J1bkV2ZW50cyhhKSB7CiAgICAgICAgdGhpcy5fUmVzZXRBbGxIYXNSdW5GbGFncygpOwogICAgICAgIHRoaXMuX3J1bm5pbmdFdmVudHNEZXB0aCsrOwogICAgICAgIGZvciAoY29uc3QgYiBvZiB0aGlzLl9EZWJ1Z1J1bkV2ZW50c0dlbihhKSkgYXdhaXQgdGhpcy5fcnVudGltZS5EZWJ1Z0JyZWFrKGIpOwogICAgICAgIHRoaXMuX3J1bm5pbmdFdmVudHNEZXB0aC0tCiAgICB9KiBfRGVidWdSdW5FdmVudHNHZW4oYSkgewogICAgICAgIGZvciAoY29uc3QgYiBvZiBhLnJ1bm5pbmdMYXlvdXRzKCkpCiAgICAgICAgICAgIGlmIChhID0gYi5HZXRFdmVudFNoZWV0KCkpIHRoaXMuX3J1bnRpbWUuUHVzaEN1cnJlbnRMYXlvdXQoYiksIHlpZWxkKiBhLkRlYnVnUnVuKCksIHRoaXMuX3J1bnRpbWUuUG9wQ3VycmVudExheW91dCgpCiAgICB9CiAgICBfVHJpZ2dlcihhLCBiLCBkLCBjKSB7CiAgICAgICAgbGV0IGUgPSAhMTsKICAgICAgICBpZiAoIWEuR2V0TWFpblJ1bm5pbmdMYXlvdXQoKSkgcmV0dXJuIHRoaXMuUXVldWVUcmlnZ2VyKGIsIGQsIGMpOwogICAgICAgIHRoaXMuX2V4ZWN1dGluZ1RyaWdnZXJEZXB0aCsrOwogICAgICAgIGZvciAoY29uc3QgZyBvZiBhLnJ1bm5pbmdMYXlvdXRzKCkpCiAgICAgICAgICAgIGlmIChhID0gZy5HZXRFdmVudFNoZWV0KCkpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuUHVzaEN1cnJlbnRMYXlvdXQoZyk7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGsgb2YgYS5kZWVwSW5jbHVkZXMoKSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IG0gPSBrLl9UcmlnZ2VyKGIsIGQsIGMpOwogICAgICAgICAgICAgICAgICAgIGUgPSBlIHx8IG0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGEgPSBhLl9UcmlnZ2VyKGIsIGQsIGMpOwogICAgICAgICAgICAgICAgZSA9IGUgfHwgYTsKICAgICAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuUG9wQ3VycmVudExheW91dCgpCiAgICAgICAgICAgIH0KICAgICAgICB0aGlzLl9leGVjdXRpbmdUcmlnZ2VyRGVwdGgtLTsKICAgICAgICByZXR1cm4gZQogICAgfSogX0RlYnVnVHJpZ2dlcihhLCBiLCBkLCBjKSB7CiAgICAgICAgbGV0IGUgPSAhMTsKICAgICAgICBpZiAoIWEuR2V0TWFpblJ1bm5pbmdMYXlvdXQoKSkgcmV0dXJuIHRoaXMuUXVldWVUcmlnZ2VyKGIsIGQsIGMpOwogICAgICAgIHRoaXMuX2V4ZWN1dGluZ1RyaWdnZXJEZXB0aCsrOwogICAgICAgIGZvciAoY29uc3QgZyBvZiBhLnJ1bm5pbmdMYXlvdXRzKCkpCiAgICAgICAgICAgIGlmIChhID0gZy5HZXRFdmVudFNoZWV0KCkpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuUHVzaEN1cnJlbnRMYXlvdXQoZyk7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGsgb2YgYS5kZWVwSW5jbHVkZXMoKSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IG0gPSB5aWVsZCogay5fRGVidWdUcmlnZ2VyKGIsIGQsIGMpOwogICAgICAgICAgICAgICAgICAgIGUgPSBlIHx8IG0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGEgPSB5aWVsZCogYS5fRGVidWdUcmlnZ2VyKGIsIGQsIGMpOwogICAgICAgICAgICAgICAgZSA9IGUgfHwgYTsKICAgICAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuUG9wQ3VycmVudExheW91dCgpCiAgICAgICAgICAgIH0KICAgICAgICB0aGlzLl9leGVjdXRpbmdUcmlnZ2VyRGVwdGgtLTsKICAgICAgICByZXR1cm4gZQogICAgfQogICAgUXVldWVUcmlnZ2VyKGEsIGIsIGQpIHsKICAgICAgICB0aGlzLl9xdWV1ZWRUcmlnZ2Vycy5wdXNoKFthLCBiLCBkXSk7CiAgICAgICAgcmV0dXJuICExCiAgICB9CiAgICBRdWV1ZURlYnVnVHJpZ2dlcihhLCBiLCBkKSB7CiAgICAgICAgbGV0IGMgPSBudWxsOwogICAgICAgIGNvbnN0IGUgPSBuZXcgUHJvbWlzZShnID0+IGMgPSBnKTsKICAgICAgICB0aGlzLl9xdWV1ZWREZWJ1Z1RyaWdnZXJzLnB1c2goW2EsIGIsIGQsIGNdKTsKICAgICAgICByZXR1cm4gZQogICAgfSogX1J1blF1ZXVlZERlYnVnVHJpZ2dlcnNHZW4oKSB7CiAgICAgICAgaWYgKHRoaXMuX3J1bnRpbWUuSGl0QnJlYWtwb2ludCgpKSB0aHJvdyBFcnJvcigic2hvdWxkIG5vdCBiZSBpbiBicmVha3BvaW50Iik7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuX3J1bnRpbWUuR2V0TGF5b3V0TWFuYWdlcigpOwogICAgICAgIGZvciAoOyB0aGlzLl9xdWV1ZWREZWJ1Z1RyaWdnZXJzLmxlbmd0aDspIHsKICAgICAgICAgICAgY29uc3QgW2IsIGQsIGMsIGVdID0gdGhpcy5fcXVldWVkRGVidWdUcmlnZ2Vycy5zaGlmdCgpLCBnID0geWllbGQqIHRoaXMuX0RlYnVnVHJpZ2dlcihhLCBiLCBkLCBjKTsKICAgICAgICAgICAgZShnKQogICAgICAgIH0KICAgIH0KICAgIGFzeW5jIFJ1blF1ZXVlZERlYnVnVHJpZ2dlcnNBc3luYygpIHsKICAgICAgICBmb3IgKGNvbnN0IGEgb2YgdGhpcy5fUnVuUXVldWVkRGVidWdUcmlnZ2Vyc0dlbigpKSBhd2FpdCB0aGlzLl9ydW50aW1lLkRlYnVnQnJlYWsoYSkKICAgIH0KICAgIF9GYXN0VHJpZ2dlcihhLAogICAgICAgIGIsIGQsIGMpIHsKICAgICAgICBsZXQgZSA9ICExOwogICAgICAgIHZhciBnID0gYS5HZXRNYWluUnVubmluZ0xheW91dCgpOwogICAgICAgIGlmIChhID0gZy5HZXRFdmVudFNoZWV0KCkpIHsKICAgICAgICAgICAgdGhpcy5fZXhlY3V0aW5nVHJpZ2dlckRlcHRoKys7CiAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuUHVzaEN1cnJlbnRMYXlvdXQoZyk7CiAgICAgICAgICAgIGcgPSBhLmRlZXBJbmNsdWRlcygpOwogICAgICAgICAgICBmb3IgKGxldCBrID0gMCwgbSA9IGcubGVuZ3RoOyBrIDwgbTsgKytrKSB7CiAgICAgICAgICAgICAgICBjb25zdCBuID0gZ1trXS5fRmFzdFRyaWdnZXIoYiwgZCwgYyk7CiAgICAgICAgICAgICAgICBlID0gZSB8fCBuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgYiA9IGEuX0Zhc3RUcmlnZ2VyKGIsIGQsIGMpOwogICAgICAgICAgICBlID0gZSB8fCBiOwogICAgICAgICAgICB0aGlzLl9ydW50aW1lLlBvcEN1cnJlbnRMYXlvdXQoKTsKICAgICAgICAgICAgdGhpcy5fZXhlY3V0aW5nVHJpZ2dlckRlcHRoLS07CiAgICAgICAgICAgIHJldHVybiBlCiAgICAgICAgfQogICAgfSogX0RlYnVnRmFzdFRyaWdnZXIoYSwgYiwgZCwgYykgewogICAgICAgIGxldCBlID0gITE7CiAgICAgICAgdmFyIGcgPSBhLkdldE1haW5SdW5uaW5nTGF5b3V0KCk7CiAgICAgICAgaWYgKGEgPSBnLkdldEV2ZW50U2hlZXQoKSkgewogICAgICAgICAgICB0aGlzLl9leGVjdXRpbmdUcmlnZ2VyRGVwdGgrKzsKICAgICAgICAgICAgdGhpcy5fcnVudGltZS5QdXNoQ3VycmVudExheW91dChnKTsKICAgICAgICAgICAgZyA9IGEuZGVlcEluY2x1ZGVzKCk7CiAgICAgICAgICAgIGZvciAobGV0IGsgPSAwLCBtID0gZy5sZW5ndGg7IGsgPCBtOyArK2spIHsKICAgICAgICAgICAgICAgIGNvbnN0IG4gPSB5aWVsZCogZ1trXS5fRGVidWdGYXN0VHJpZ2dlcihiLCBkLCBjKTsKICAgICAgICAgICAgICAgIGUgPSBlIHx8IG4KICAgICAgICAgICAgfQogICAgICAgICAgICBiID0geWllbGQqIGEuX0RlYnVnRmFzdFRyaWdnZXIoYiwgZCwgYyk7CiAgICAgICAgICAgIGUgPSBlIHx8IGI7CiAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuUG9wQ3VycmVudExheW91dCgpOwogICAgICAgICAgICB0aGlzLl9leGVjdXRpbmdUcmlnZ2VyRGVwdGgtLTsKICAgICAgICAgICAgcmV0dXJuIGUKICAgICAgICB9CiAgICB9CiAgICBHZXRUcmlnZ2VyRGVwdGgoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2V4ZWN1dGluZ1RyaWdnZXJEZXB0aAogICAgfQogICAgSXNJblRyaWdnZXIoKSB7CiAgICAgICAgcmV0dXJuIDAgPCB0aGlzLkdldFRyaWdnZXJEZXB0aCgpCiAgICB9CiAgICBfSW5jVHJpZ2dlckRlcHRoKCkgewogICAgICAgIHJldHVybiArK3RoaXMuX2V4ZWN1dGluZ1RyaWdnZXJEZXB0aAogICAgfQogICAgX0RlY1RyaWdnZXJEZXB0aCgpIHsKICAgICAgICAtLXRoaXMuX2V4ZWN1dGluZ1RyaWdnZXJEZXB0aAogICAgfQogICAgSXNSdW5uaW5nRXZlbnRzKCkgewogICAgICAgIHJldHVybiAwIDwgdGhpcy5fcnVubmluZ0V2ZW50c0RlcHRoCiAgICB9CiAgICBJc0luRXZlbnRFbmdpbmUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuSXNSdW5uaW5nRXZlbnRzKCkgfHwKICAgICAgICAgICAgdGhpcy5Jc0luVHJpZ2dlcigpCiAgICB9CiAgICBfUnVuUXVldWVkVHJpZ2dlcnMoYSkgewogICAgICAgIGZvciAoY29uc3QgW2IsIGQsIGNdIG9mIHRoaXMuX3F1ZXVlZFRyaWdnZXJzKSB0aGlzLl9UcmlnZ2VyKGEsIGIsIGQsIGMpOwogICAgICAgIEMzJGpzY29tcCQxMjcuY2xlYXJBcnJheSh0aGlzLl9xdWV1ZWRUcmlnZ2VycykKICAgIH0KICAgIEJsb2NrRmx1c2hpbmdJbnN0YW5jZXMoYSkgewogICAgICAgIGEgPyB0aGlzLl9ibG9ja0ZsdXNoaW5nRGVwdGgrKyA6IHRoaXMuX2Jsb2NrRmx1c2hpbmdEZXB0aC0tCiAgICB9CiAgICBJc0ZsdXNoaW5nQmxvY2tlZCgpIHsKICAgICAgICByZXR1cm4gMCA8IHRoaXMuX2Jsb2NrRmx1c2hpbmdEZXB0aAogICAgfQogICAgQ2xlYXJTb2woYSkgewogICAgICAgIGZvciAobGV0IGIgPSAwLCBkID0gYS5sZW5ndGg7IGIgPCBkOyArK2IpIGFbYl0uR2V0U29sU3RhY2soKS5DbGVhcigpCiAgICB9CiAgICBQdXNoQ2xlYW5Tb2woYSkgewogICAgICAgIGZvciAobGV0IGIgPSAwLCBkID0gYS5sZW5ndGg7IGIgPCBkOyArK2IpIGFbYl0uR2V0U29sU3RhY2soKS5QdXNoQ2xlYW4oKQogICAgfQogICAgUHVzaENvcHlTb2woYSkgewogICAgICAgIGZvciAobGV0IGIgPSAwLCBkID0gYS5sZW5ndGg7IGIgPCBkOyArK2IpIGFbYl0uR2V0U29sU3RhY2soKS5QdXNoQ29weSgpCiAgICB9CiAgICBQb3BTb2woYSkgewogICAgICAgIGZvciAobGV0IGIgPQogICAgICAgICAgICAgICAgMCwgZCA9IGEubGVuZ3RoOyBiIDwgZDsgKytiKSBhW2JdLkdldFNvbFN0YWNrKCkuUG9wKCkKICAgIH0KICAgIEFkZFNjaGVkdWxlZFdhaXQoKSB7CiAgICAgICAgY29uc3QgYSA9IEMzJGpzY29tcCQxMjcuTmV3KEMzJGpzY29tcCQxMjcuU2NoZWR1bGVkV2FpdCwgdGhpcyk7CiAgICAgICAgdGhpcy5fc2NoZWR1bGVkV2FpdHMucHVzaChhKTsKICAgICAgICByZXR1cm4gYQogICAgfQogICAgc2NoZWR1bGVkV2FpdHMoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3NjaGVkdWxlZFdhaXRzCiAgICB9CiAgICBSdW5TY2hlZHVsZWRXYWl0cygpIHsKICAgICAgICBpZiAodGhpcy5fc2NoZWR1bGVkV2FpdHMubGVuZ3RoKSB7CiAgICAgICAgICAgIHZhciBhID0gdGhpcy5HZXRDdXJyZW50RXZlbnRTdGFja0ZyYW1lKCksCiAgICAgICAgICAgICAgICBiID0gITE7CiAgICAgICAgICAgIHRoaXMuX3J1bm5pbmdFdmVudHNEZXB0aCsrOwogICAgICAgICAgICBmb3IgKGxldCBkID0gMCwgYyA9IHRoaXMuX3NjaGVkdWxlZFdhaXRzLmxlbmd0aDsgZCA8IGM7ICsrZCkgewogICAgICAgICAgICAgICAgY29uc3QgZSA9IHRoaXMuX3NjaGVkdWxlZFdhaXRzW2RdOwogICAgICAgICAgICAgICAgZS5fU2hvdWxkUnVuKCkgJiYgZS5fUnVuKGEpOwogICAgICAgICAgICAgICAgZS5TaG91bGRSZWxlYXNlKCkgJiYgKGIgPSAhMCkKICAgICAgICAgICAgfQogICAgICAgICAgICBiICYmICh0aGlzLl9GaWx0ZXJTY2hlZHVsZWRXYWl0c1RvUmVsZWFzZSgpLAogICAgICAgICAgICAgICAgYS5SZXNldChudWxsKSk7CiAgICAgICAgICAgIHRoaXMuX3J1bm5pbmdFdmVudHNEZXB0aC0tCiAgICAgICAgfQogICAgfQogICAgYXN5bmMgRGVidWdSdW5TY2hlZHVsZWRXYWl0cygpIHsKICAgICAgICBpZiAodGhpcy5fc2NoZWR1bGVkV2FpdHMubGVuZ3RoKSB7CiAgICAgICAgICAgIHZhciBhID0gdGhpcy5HZXRDdXJyZW50RXZlbnRTdGFja0ZyYW1lKCksCiAgICAgICAgICAgICAgICBiID0gITE7CiAgICAgICAgICAgIHRoaXMuX3J1bm5pbmdFdmVudHNEZXB0aCsrOwogICAgICAgICAgICBmb3IgKGxldCBkID0gMCwgYyA9IHRoaXMuX3NjaGVkdWxlZFdhaXRzLmxlbmd0aDsgZCA8IGM7ICsrZCkgewogICAgICAgICAgICAgICAgY29uc3QgZSA9IHRoaXMuX3NjaGVkdWxlZFdhaXRzW2RdOwogICAgICAgICAgICAgICAgZS5fU2hvdWxkUnVuKCkgJiYgYXdhaXQgZS5fRGVidWdSdW4oYSk7CiAgICAgICAgICAgICAgICBlLlNob3VsZFJlbGVhc2UoKSAmJiAoYiA9ICEwKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGIgJiYgKHRoaXMuX0ZpbHRlclNjaGVkdWxlZFdhaXRzVG9SZWxlYXNlKCksIGEuUmVzZXQobnVsbCkpOwogICAgICAgICAgICB0aGlzLl9ydW5uaW5nRXZlbnRzRGVwdGgtLQogICAgICAgIH0KICAgIH0KICAgIF9GaWx0ZXJTY2hlZHVsZWRXYWl0c1RvUmVsZWFzZSgpIHsKICAgICAgICBjb25zdCBhID0gQzMkanNjb21wJDEyNy5hcnJheUZpbHRlck91dCh0aGlzLl9zY2hlZHVsZWRXYWl0cywgYiA9PgogICAgICAgICAgICBiLlNob3VsZFJlbGVhc2UoKSk7CiAgICAgICAgZm9yIChjb25zdCBiIG9mIGEpIGIuUmVsZWFzZSgpCiAgICB9CiAgICBDbGVhckFsbFNjaGVkdWxlZFdhaXRzKCkgewogICAgICAgIGZvciAoY29uc3QgYSBvZiB0aGlzLl9zY2hlZHVsZWRXYWl0cykgYS5SZWxlYXNlKCk7CiAgICAgICAgQzMkanNjb21wJDEyNy5jbGVhckFycmF5KHRoaXMuX3NjaGVkdWxlZFdhaXRzKQogICAgfQogICAgUmVtb3ZlSW5zdGFuY2VzRnJvbVNjaGVkdWxlZFdhaXRzKGEpIHsKICAgICAgICBmb3IgKGNvbnN0IGIgb2YgdGhpcy5fc2NoZWR1bGVkV2FpdHMpIGIuUmVtb3ZlSW5zdGFuY2VzKGEpCiAgICB9CiAgICBBZGRBc3luY0FjdGlvblByb21pc2UoYSkgewogICAgICAgIHRoaXMuX2FzeW5jQWN0aW9uUHJvbWlzZXMucHVzaChhKQogICAgfQogICAgQ2xlYXJBc3luY0FjdGlvblByb21pc2VzKCkgewogICAgICAgIEMzJGpzY29tcCQxMjcuY2xlYXJBcnJheSh0aGlzLl9hc3luY0FjdGlvblByb21pc2VzKQogICAgfQogICAgR2V0UHJvbWlzZUZvckFsbEFzeW5jQWN0aW9ucygpIHsKICAgICAgICBjb25zdCBhID0gUHJvbWlzZS5hbGwodGhpcy5fYXN5bmNBY3Rpb25Qcm9taXNlcyk7CiAgICAgICAgdGhpcy5fYXN5bmNBY3Rpb25Qcm9taXNlcyA9IFtdOwogICAgICAgIHJldHVybiBhCiAgICB9CiAgICBfU2F2ZVRvSnNvbigpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBncm91cHM6IHRoaXMuX1NhdmVHcm91cHNUb0pzb24oKSwKICAgICAgICAgICAgY25kczogdGhpcy5fU2F2ZUNuZHNUb0pzb24oKSwKICAgICAgICAgICAgYWN0czogdGhpcy5fU2F2ZUFjdHNUb0pzb24oKSwKICAgICAgICAgICAgdmFyczogdGhpcy5fU2F2ZVZhcnNUb0pzb24oKSwKICAgICAgICAgICAgd2FpdHM6IHRoaXMuX1NhdmVTY2hlZHVsZWRXYWl0c1RvSnNvbigpCiAgICAgICAgfQogICAgfQogICAgX0xvYWRGcm9tSnNvbihhKSB7CiAgICAgICAgdGhpcy5fTG9hZEdyb3Vwc0Zyb21Kc29uKGEuZ3JvdXBzKTsKICAgICAgICB0aGlzLl9Mb2FkQ25kc0Zyb21Kc29uKGEuY25kcyk7CiAgICAgICAgdGhpcy5fTG9hZEFjdHNGcm9tSnNvbihhLmFjdHMpOwogICAgICAgIHRoaXMuX0xvYWRWYXJzRnJvbUpzb24oYS52YXJzKTsKICAgICAgICB0aGlzLl9Mb2FkU2NoZWR1bGVkV2FpdHNGcm9tSnNvbihhLndhaXRzKQogICAgfQogICAgX1NhdmVHcm91cHNUb0pzb24oKSB7CiAgICAgICAgY29uc3QgYSA9IHt9OwogICAgICAgIGZvciAoY29uc3QgYiBvZiB0aGlzLkdldEFsbEdyb3VwcygpKSBhW2IuR2V0U0lEKCkudG9TdHJpbmcoKV0gPSBiLklzR3JvdXBBY3RpdmUoKTsKICAgICAgICByZXR1cm4gYQogICAgfQogICAgX0xvYWRHcm91cHNGcm9tSnNvbihhKSB7CiAgICAgICAgZm9yIChjb25zdCBbYiwKICAgICAgICAgICAgICAgIGQKICAgICAgICAgICAgXSBvZiBPYmplY3QuZW50cmllcyhhKSkgYSA9IHBhcnNlSW50KGIsIDEwKSwgKGEgPSB0aGlzLkdldEV2ZW50R3JvdXBCeVNJRChhKSkgJiYgYS5TZXRHcm91cEFjdGl2ZShkKQogICAgfQogICAgX1NhdmVDbmRzVG9Kc29uKCkgewogICAgICAgIGNvbnN0IGEgPSB7fTsKICAgICAgICBmb3IgKGNvbnN0IFtiLCBkXSBvZiB0aGlzLl9jbmRzQnlTaWQpIHsKICAgICAgICAgICAgY29uc3QgYyA9IGQuX1NhdmVUb0pzb24oKTsKICAgICAgICAgICAgYyAmJiAoYVtiLnRvU3RyaW5nKCldID0gYykKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGEKICAgIH0KICAgIF9Mb2FkQ25kc0Zyb21Kc29uKGEpIHsKICAgICAgICBjb25zdCBiID0gbmV3IE1hcDsKICAgICAgICBmb3IgKGNvbnN0IFtkLCBjXSBvZiBPYmplY3QuZW50cmllcyhhKSkgYi5zZXQocGFyc2VJbnQoZCwgMTApLCBjKTsKICAgICAgICBmb3IgKGNvbnN0IFtkLCBjXSBvZiB0aGlzLl9jbmRzQnlTaWQpIGMuX0xvYWRGcm9tSnNvbihiLmdldChkKSB8fCBudWxsKQogICAgfQogICAgX1NhdmVBY3RzVG9Kc29uKCkgewogICAgICAgIGNvbnN0IGEgPSB7fTsKICAgICAgICBmb3IgKGNvbnN0IFtiLCBkXSBvZiB0aGlzLl9hY3RzQnlTaWQpIHsKICAgICAgICAgICAgY29uc3QgYyA9IGQuX1NhdmVUb0pzb24oKTsKICAgICAgICAgICAgYyAmJiAoYVtiLnRvU3RyaW5nKCldID0gYykKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGEKICAgIH0KICAgIF9Mb2FkQWN0c0Zyb21Kc29uKGEpIHsKICAgICAgICBjb25zdCBiID0KICAgICAgICAgICAgbmV3IE1hcDsKICAgICAgICBmb3IgKGNvbnN0IFtkLCBjXSBvZiBPYmplY3QuZW50cmllcyhhKSkgYi5zZXQocGFyc2VJbnQoZCwgMTApLCBjKTsKICAgICAgICBmb3IgKGNvbnN0IFtkLCBjXSBvZiB0aGlzLl9hY3RzQnlTaWQpIGMuX0xvYWRGcm9tSnNvbihiLmdldChkKSB8fCBudWxsKQogICAgfQogICAgX1NhdmVWYXJzVG9Kc29uKCkgewogICAgICAgIGNvbnN0IGEgPSB7fTsKICAgICAgICBmb3IgKGNvbnN0IFtiLCBkXSBvZiB0aGlzLl9ldmVudFZhcnNCeVNpZCkgZC5Jc0NvbnN0YW50KCkgfHwgIWQuSXNHbG9iYWwoKSAmJiAhZC5Jc1N0YXRpYygpIHx8IChhW2IudG9TdHJpbmcoKV0gPSBkLkdldFZhbHVlKCkpOwogICAgICAgIHJldHVybiBhCiAgICB9CiAgICBfTG9hZFZhcnNGcm9tSnNvbihhKSB7CiAgICAgICAgZm9yIChjb25zdCBbYiwgZF0gb2YgT2JqZWN0LmVudHJpZXMoYSkpIGEgPSBwYXJzZUludChiLCAxMCksIChhID0gdGhpcy5HZXRFdmVudFZhcmlhYmxlQnlTSUQoYSkpICYmIGEuU2V0VmFsdWUoZCkKICAgIH0KICAgIF9TYXZlU2NoZWR1bGVkV2FpdHNUb0pzb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3NjaGVkdWxlZFdhaXRzLmZpbHRlcihhID0+ICFhLklzUHJvbWlzZSgpKS5tYXAoYSA9PiBhLl9TYXZlVG9Kc29uKCkpCiAgICB9CiAgICBfTG9hZFNjaGVkdWxlZFdhaXRzRnJvbUpzb24oYSkgewogICAgICAgIHRoaXMuQ2xlYXJBbGxTY2hlZHVsZWRXYWl0cygpOwogICAgICAgIGZvciAoY29uc3QgYiBvZiBhKShhID0gQzMkanNjb21wJDEyNy5TY2hlZHVsZWRXYWl0Ll9DcmVhdGVGcm9tSnNvbih0aGlzLCBiKSkgJiYgdGhpcy5fc2NoZWR1bGVkV2FpdHMucHVzaChhKQogICAgfQogICAgX0dldFBlcmZSZWNvcmRzKCkgewogICAgICAgIHJldHVybiBbLi4udGhpcy5fcnVudGltZS5HZXRMYXlvdXRNYW5hZ2VyKCkucnVubmluZ0xheW91dHMoKV0ubWFwKGEgPT4gYS5HZXRFdmVudFNoZWV0KCkpLmZpbHRlcihhID0+IGEpLm1hcChhID0+IGEuX0dldFBlcmZSZWNvcmQoKSkKICAgIH0KICAgIEZpbmRGaXJzdEZ1bmN0aW9uQmxvY2tQYXJlbnQoYSkgewogICAgICAgIGZvciAoOyBhOykKICAgICAgICAgICAgaWYgKGEgPSBhLkdldFNjb3BlUGFyZW50KCksIGEgaW5zdGFuY2VvZiBDMyRqc2NvbXAkMTI3LkZ1bmN0aW9uQmxvY2spIHJldHVybiBhOwogICAgICAgIHJldHVybiBudWxsCiAgICB9CiAgICBfSW52b2tlRnVuY3Rpb25Gcm9tSlMoYSwgYikgewogICAgICAgIEFycmF5LmlzQXJyYXkoYikgfHwgKGIgPSBbXSk7CiAgICAgICAgYSA9IHRoaXMuR2V0RnVuY3Rpb25CbG9ja0J5TmFtZShhLnRvTG93ZXJDYXNlKCkpOwogICAgICAgIGlmICghYSkgcmV0dXJuIG51bGw7CiAgICAgICAgaWYgKCFhLklzRW5hYmxlZCgpKSByZXR1cm4gYS5HZXREZWZhdWx0UmV0dXJuVmFsdWUoKTsKICAgICAgICB2YXIgZCA9IGEuR2V0RnVuY3Rpb25QYXJhbWV0ZXJzKCk7CiAgICAgICAgaWYgKGIubGVuZ3RoIDwgZC5sZW5ndGgpIHsKICAgICAgICAgICAgYiA9IGIuc2xpY2UoMCk7CiAgICAgICAgICAgIGRvIGIucHVzaChkW2IubGVuZ3RoXS5HZXRJbml0aWFsVmFsdWUoKSk7IHdoaWxlIChiLmxlbmd0aCA8IGQubGVuZ3RoKQogICAgICAgIH0KICAgICAgICBkID0gYS5HZXRFdmVudEJsb2NrKCk7CiAgICAgICAgcmV0dXJuIGQuUnVuQXNFeHByZXNzaW9uRnVuY3Rpb25DYWxsKGQuR2V0U29sTW9kaWZpZXJzSW5jbHVkaW5nUGFyZW50cygpLCAhMSwgYS5HZXRSZXR1cm5UeXBlKCksIGEuR2V0RGVmYXVsdFJldHVyblZhbHVlKCksIC4uLmIpCiAgICB9Cn07CiJ1c2Ugc3RyaWN0IjsKY29uc3QgQzMkanNjb21wJDEyOCA9IHNlbGYuQzM7CkMzJGpzY29tcCQxMjguRXZlbnRTaGVldCA9IGNsYXNzIGV4dGVuZHMgQzMkanNjb21wJDEyOC5EZWZlbmRlZEJhc2UgewogICAgY29uc3RydWN0b3IoYSwgYikgewogICAgICAgIHN1cGVyKCk7CiAgICAgICAgdGhpcy5fZXZlbnRTaGVldE1hbmFnZXIgPSBhOwogICAgICAgIHRoaXMuX3J1bnRpbWUgPSBhLkdldFJ1bnRpbWUoKTsKICAgICAgICB0aGlzLl9uYW1lID0gYlswXTsKICAgICAgICB0aGlzLl9ldmVudHMgPSBbXTsKICAgICAgICB0aGlzLl90cmlnZ2VycyA9IG5ldyBNYXA7CiAgICAgICAgdGhpcy5fZmFzdFRyaWdnZXJzID0gbmV3IE1hcDsKICAgICAgICB0aGlzLl9ldmVudHNCeURpc3BsYXlOdW1iZXIgPSBuZXcgTWFwOwogICAgICAgIHRoaXMuX2hhc1J1biA9ICExOwogICAgICAgIHRoaXMuX3NoYWxsb3dJbmNsdWRlcyA9IFtdOwogICAgICAgIHRoaXMuX2RlZXBJbmNsdWRlcyA9IFtdOwogICAgICAgIHRoaXMuX2FscmVhZHlJbmNsdWRlZFNoZWV0cyA9IG5ldyBTZXQ7CiAgICAgICAgZm9yIChjb25zdCBkIG9mIGJbMV0pIHRoaXMuX0NyZWF0ZUV2ZW50KGQsIG51bGwsIHRoaXMuX2V2ZW50cyk7CiAgICAgICAgdGhpcy5fcGVyZlJlY29yZCA9IHRoaXMuX3J1bnRpbWUuSXNEZWJ1ZygpID8gewogICAgICAgICAgICB0eXBlOiAic2hlZXQiLAogICAgICAgICAgICBuYW1lOiB0aGlzLl9uYW1lLAogICAgICAgICAgICB0b3RhbFRpbWVDb3VudGVyOiAwLAogICAgICAgICAgICBjaGlsZHJlbjogW10KICAgICAgICB9IDogbnVsbAogICAgfQogICAgUmVsZWFzZSgpIHsKICAgICAgICB0aGlzLl9ydW50aW1lID0gdGhpcy5fZXZlbnRTaGVldE1hbmFnZXIgPSBudWxsCiAgICB9CiAgICBfQ3JlYXRlRXZlbnQoYSwgYiwgZCkgewogICAgICAgIHN3aXRjaCAoYVswXSkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgIHRoaXMuX0NyZWF0ZUV2ZW50QmxvY2soYSwgYiwgZCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgdGhpcy5fQ3JlYXRlRXZlbnRWYXJpYWJsZShhLCBiLCBkKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICB0aGlzLl9DcmVhdGVJbmNsdWRlKGEsIGIsIGQpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgIHRoaXMuX0NyZWF0ZUZ1bmN0aW9uQmxvY2soYSwgYik7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgICAgdGhpcy5fQ3JlYXRlU2NyaXB0QmxvY2soYSwgYiwgZCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHRocm93IEVycm9yKCJpbnZhbGlkIGV2ZW50IHR5cGUiKTsKICAgICAgICB9CiAgICB9CiAgICBfQ3JlYXRlRXZlbnRCbG9jayhhLCBiLCBkKSB7CiAgICAgICAgYSA9IEMzJGpzY29tcCQxMjguRXZlbnRCbG9jay5DcmVhdGUodGhpcywgYiwgYSk7CiAgICAgICAgaWYgKGEuSXNPckJsb2NrKCkpIHsKICAgICAgICAgICAgZC5wdXNoKGEpOwogICAgICAgICAgICBkID0gYS5HZXRDb25kaXRpb25zKCk7CiAgICAgICAgICAgIGZvciAobGV0IGMgPSAwLAogICAgICAgICAgICAgICAgICAgIGUgPSBkLmxlbmd0aDsgYyA8IGU7ICsrYykgZFtjXS5Jc1RyaWdnZXIoKSAmJiB0aGlzLl9Jbml0VHJpZ2dlcihhLCBjKQogICAgICAgIH0gZWxzZSBhLklzVHJpZ2dlcigpID8gdGhpcy5fSW5pdFRyaWdnZXIoYSwgMCkgOiBkLnB1c2goYSkKICAgIH0KICAgIF9DcmVhdGVGdW5jdGlvbkJsb2NrKGEsIGIpIHsKICAgICAgICBhID0gQzMkanNjb21wJDEyOC5GdW5jdGlvbkJsb2NrLkNyZWF0ZSh0aGlzLCBiLCBhKTsKICAgICAgICB0aGlzLl9ldmVudFNoZWV0TWFuYWdlci5fUmVnaXN0ZXJGdW5jdGlvbkJsb2NrKGEpCiAgICB9CiAgICBfQ3JlYXRlRXZlbnRWYXJpYWJsZShhLCBiLCBkKSB7CiAgICAgICAgYSA9IEMzJGpzY29tcCQxMjguRXZlbnRWYXJpYWJsZS5DcmVhdGUodGhpcywgYiwgYSk7CiAgICAgICAgZC5wdXNoKGEpCiAgICB9CiAgICBfQ3JlYXRlSW5jbHVkZShhLCBiLCBkKSB7CiAgICAgICAgYSA9IEMzJGpzY29tcCQxMjguRXZlbnRJbmNsdWRlLkNyZWF0ZSh0aGlzLCBiLCBhKTsKICAgICAgICBkLnB1c2goYSkKICAgIH0KICAgIF9DcmVhdGVTY3JpcHRCbG9jayhhLCBiLCBkKSB7CiAgICAgICAgYSA9IEMzJGpzY29tcCQxMjguRXZlbnRTY3JpcHQuQ3JlYXRlKHRoaXMsIGIsIGEpOwogICAgICAgIGQucHVzaChhKQogICAgfQogICAgX0luaXRUcmlnZ2VyKGEsIGIpIHsKICAgICAgICBhLklzT3JCbG9jaygpIHx8CiAgICAgICAgICAgIHRoaXMuX2V2ZW50U2hlZXRNYW5hZ2VyLl9BZGRUcmlnZ2VyVG9Qb3N0SW5pdChhKTsKICAgICAgICB2YXIgZCA9IGEuR2V0Q29uZGl0aW9uQXQoYiksCiAgICAgICAgICAgIGMgPSBkLl9HZXRGdW5jKCksCiAgICAgICAgICAgIGUgPSBkLkdldE9iamVjdENsYXNzKCk7CiAgICAgICAgaWYgKGQuSXNGYXN0VHJpZ2dlcigpKSB7CiAgICAgICAgICAgIHZhciBnID0gdGhpcy5fZmFzdFRyaWdnZXJzLmdldChlKTsKICAgICAgICAgICAgZyB8fCAoZyA9IG5ldyBNYXAsIHRoaXMuX2Zhc3RUcmlnZ2Vycy5zZXQoZSwgZykpOwogICAgICAgICAgICBkID0gZC5HZXRGYXN0VHJpZ2dlclZhbHVlKCkudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgZSA9IGcuZ2V0KGMpOwogICAgICAgICAgICBlIHx8IChlID0gbmV3IE1hcCwgZy5zZXQoYywgZSkpOwogICAgICAgICAgICBjID0gZS5nZXQoZCk7CiAgICAgICAgICAgIGMgfHwgKGMgPSBbXSwgZS5zZXQoZCwgYykpOwogICAgICAgICAgICBjLnB1c2goW2EsIGJdKQogICAgICAgIH0gZWxzZSBnID0gdGhpcy5fdHJpZ2dlcnMuZ2V0KGUpLCBnIHx8IChnID0gewogICAgICAgICAgICBtZXRob2RNYXA6IG5ldyBNYXAsCiAgICAgICAgICAgIGJlaGF2aW9yczogbmV3IE1hcAogICAgICAgIH0sIHRoaXMuX3RyaWdnZXJzLnNldChlLCBnKSksIChlID0gZC5HZXRCZWhhdmlvclR5cGUoKSkgPyAoZCA9IGcuYmVoYXZpb3JzLmdldChlKSwgZCB8fCAoZCA9IG5ldyBNYXAsIGcuYmVoYXZpb3JzLnNldChlLAogICAgICAgICAgICBkKSkpIDogZCA9IGcubWV0aG9kTWFwLCBnID0gZC5nZXQoYyksIGcgfHwgKGcgPSBbXSwgZC5zZXQoYywgZykpLCBnLnB1c2goW2EsIGJdKQogICAgfQogICAgX1Bvc3RJbml0KCkgewogICAgICAgIGNvbnN0IGEgPSB0aGlzLl9ldmVudHM7CiAgICAgICAgZm9yIChsZXQgYiA9IDAsIGQgPSBhLmxlbmd0aDsgYiA8IGQ7ICsrYikgewogICAgICAgICAgICBjb25zdCBjID0gYiA8IGQgLSAxICYmIGFbYiArIDFdIGluc3RhbmNlb2YgQzMkanNjb21wJDEyOC5FdmVudEJsb2NrICYmIGFbYiArIDFdLklzRWxzZUJsb2NrKCk7CiAgICAgICAgICAgIGFbYl0uX1Bvc3RJbml0KGMpCiAgICAgICAgfQogICAgfQogICAgX0FkZFNoYWxsb3dJbmNsdWRlKGEpIHsKICAgICAgICB0aGlzLl9zaGFsbG93SW5jbHVkZXMucHVzaChhKQogICAgfQogICAgX1VwZGF0ZURlZXBJbmNsdWRlcygpIHsKICAgICAgICBDMyRqc2NvbXAkMTI4LmNsZWFyQXJyYXkodGhpcy5fZGVlcEluY2x1ZGVzKTsKICAgICAgICB0aGlzLl9BZGREZWVwSW5jbHVkZXModGhpcyk7CiAgICAgICAgdGhpcy5fYWxyZWFkeUluY2x1ZGVkU2hlZXRzLmNsZWFyKCkKICAgIH0KICAgIF9BZGREZWVwSW5jbHVkZXMoYSkgewogICAgICAgIGNvbnN0IGIgPSBhLl9kZWVwSW5jbHVkZXMsCiAgICAgICAgICAgIGQgPSBhLl9hbHJlYWR5SW5jbHVkZWRTaGVldHM7CiAgICAgICAgZm9yIChjb25zdCBjIG9mIHRoaXMuX3NoYWxsb3dJbmNsdWRlcykgewogICAgICAgICAgICBjb25zdCBlID0KICAgICAgICAgICAgICAgIGMuR2V0SW5jbHVkZVNoZWV0KCk7CiAgICAgICAgICAgIGMuSXNBY3RpdmUoKSAmJiBhICE9PSBlICYmICFkLmhhcyhlKSAmJiAoZC5hZGQoZSksIGUuX0FkZERlZXBJbmNsdWRlcyhhKSwgYi5wdXNoKGUpKQogICAgICAgIH0KICAgIH0KICAgIGRlZXBJbmNsdWRlcygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZGVlcEluY2x1ZGVzCiAgICB9CiAgICBHZXRFdmVudFNoZWV0TWFuYWdlcigpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZXZlbnRTaGVldE1hbmFnZXIKICAgIH0KICAgIEdldFJ1bnRpbWUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUKICAgIH0KICAgIEdldE5hbWUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX25hbWUKICAgIH0KICAgIF9SZWdpc3RlckV2ZW50QnlEaXNwbGF5TnVtYmVyKGEsIGIpIHsKICAgICAgICB0aGlzLl9ldmVudHNCeURpc3BsYXlOdW1iZXIuc2V0KGIsIGEpCiAgICB9CiAgICBfR2V0RXZlbnRCeURpc3BsYXlOdW1iZXIoYSkgewogICAgICAgIHJldHVybiB0aGlzLl9ldmVudHNCeURpc3BsYXlOdW1iZXIuZ2V0KGEpIHx8IG51bGwKICAgIH0KICAgIF9SZXNldEhhc1J1bkZsYWcoKSB7CiAgICAgICAgdGhpcy5faGFzUnVuID0gITEKICAgIH0KICAgIFJ1bigpIHsKICAgICAgICBpZiAoIXRoaXMuX2hhc1J1bikgewogICAgICAgICAgICB2YXIgYSA9IHRoaXMuX3J1bnRpbWUsCiAgICAgICAgICAgICAgICBiID0gYS5Jc0NQVVByb2ZpbGluZygpLAogICAgICAgICAgICAgICAgZCA9IGIgPyBwZXJmb3JtYW5jZS5ub3coKSA6IDA7CiAgICAgICAgICAgIHRoaXMuX2hhc1J1biA9ICEwOwogICAgICAgICAgICB2YXIgYyA9IHRoaXMuR2V0RXZlbnRTaGVldE1hbmFnZXIoKSwKICAgICAgICAgICAgICAgIGUgPSBjLkdldEN1cnJlbnRFdmVudFN0YWNrRnJhbWUoKTsKICAgICAgICAgICAgZm9yIChjb25zdCBnIG9mIHRoaXMuX2V2ZW50cykgZy5SdW4oZSksIGMuQ2xlYXJTb2woZy5HZXRTb2xNb2RpZmllcnMoKSksIGMuQ2xlYXJBc3luY0FjdGlvblByb21pc2VzKCksIGEuRmx1c2hQZW5kaW5nSW5zdGFuY2VzKCk7CiAgICAgICAgICAgIGUuUmVzZXQobnVsbCk7CiAgICAgICAgICAgIGIgJiYgKHRoaXMuX3BlcmZSZWNvcmQudG90YWxUaW1lQ291bnRlciArPSBwZXJmb3JtYW5jZS5ub3coKSAtIGQpCiAgICAgICAgfQogICAgfSogRGVidWdSdW4oKSB7CiAgICAgICAgaWYgKCF0aGlzLl9oYXNSdW4pIHsKICAgICAgICAgICAgdGhpcy5faGFzUnVuID0gITA7CiAgICAgICAgICAgIHZhciBhID0gdGhpcy5fcnVudGltZSwKICAgICAgICAgICAgICAgIGIgPSB0aGlzLkdldEV2ZW50U2hlZXRNYW5hZ2VyKCksCiAgICAgICAgICAgICAgICBkID0gYi5HZXRDdXJyZW50RXZlbnRTdGFja0ZyYW1lKCk7CiAgICAgICAgICAgIGZvciAoY29uc3QgYyBvZiB0aGlzLl9ldmVudHMpIHlpZWxkKiBjLkRlYnVnUnVuKGQpLCBiLkNsZWFyU29sKGMuR2V0U29sTW9kaWZpZXJzKCkpLAogICAgICAgICAgICAgICAgYi5DbGVhckFzeW5jQWN0aW9uUHJvbWlzZXMoKSwgYS5GbHVzaFBlbmRpbmdJbnN0YW5jZXMoKTsKICAgICAgICAgICAgZC5SZXNldChudWxsKQogICAgICAgIH0KICAgIH0KICAgIF9UcmlnZ2VyKGEsIGIsIGQpIHsKICAgICAgICBpZiAoYikgewogICAgICAgICAgICBjb25zdCBjID0gYi5HZXRPYmplY3RDbGFzcygpOwogICAgICAgICAgICB0aGlzLl9UcmlnZ2VyRm9yQ2xhc3MoYSwgYiwgYywgZCk7CiAgICAgICAgICAgIGZvciAoY29uc3QgZSBvZiBjLkdldEZhbWlsaWVzKCkpIHRoaXMuX1RyaWdnZXJGb3JDbGFzcyhhLCBiLCBlLCBkKQogICAgICAgIH0gZWxzZSByZXR1cm4gdGhpcy5fVHJpZ2dlckZvckNsYXNzKGEsIGIsIG51bGwsIG51bGwpCiAgICB9CiAgICBfVHJpZ2dlckZvckNsYXNzKGEsIGIsIGQsIGMpIHsKICAgICAgICBkID0gdGhpcy5fdHJpZ2dlcnMuZ2V0KGQpOwogICAgICAgIGlmICghZCkgcmV0dXJuICExOwogICAgICAgIGMgPSBjID8gZC5iZWhhdmlvcnMuZ2V0KGMpIDogZC5tZXRob2RNYXA7CiAgICAgICAgaWYgKCFjKSByZXR1cm4gITE7CiAgICAgICAgYyA9IGMuZ2V0KGEpOwogICAgICAgIGlmICghYykgcmV0dXJuICExOwogICAgICAgIGEgPSAhMTsKICAgICAgICBmb3IgKGNvbnN0IFtlLCBnXSBvZiBjKSBjID0gdGhpcy5fRXhlY3V0ZVRyaWdnZXIoYiwgZSwgZyksIGEgPSBhIHx8IGM7CiAgICAgICAgcmV0dXJuIGEKICAgIH0qIF9EZWJ1Z1RyaWdnZXIoYSwgYiwgZCkgewogICAgICAgIGlmIChiKSB7CiAgICAgICAgICAgIGNvbnN0IGMgPQogICAgICAgICAgICAgICAgYi5HZXRPYmplY3RDbGFzcygpOwogICAgICAgICAgICB5aWVsZCogdGhpcy5fRGVidWdUcmlnZ2VyRm9yQ2xhc3MoYSwgYiwgYywgZCk7CiAgICAgICAgICAgIGZvciAoY29uc3QgZSBvZiBjLkdldEZhbWlsaWVzKCkpIHlpZWxkKiB0aGlzLl9EZWJ1Z1RyaWdnZXJGb3JDbGFzcyhhLCBiLCBlLCBkKQogICAgICAgIH0gZWxzZSByZXR1cm4geWllbGQqIHRoaXMuX0RlYnVnVHJpZ2dlckZvckNsYXNzKGEsIGIsIG51bGwsIG51bGwpCiAgICB9KiBfRGVidWdUcmlnZ2VyRm9yQ2xhc3MoYSwgYiwgZCwgYykgewogICAgICAgIGQgPSB0aGlzLl90cmlnZ2Vycy5nZXQoZCk7CiAgICAgICAgaWYgKCFkKSByZXR1cm4gITE7CiAgICAgICAgYyA9IGMgPyBkLmJlaGF2aW9ycy5nZXQoYykgOiBkLm1ldGhvZE1hcDsKICAgICAgICBpZiAoIWMpIHJldHVybiAhMTsKICAgICAgICBjID0gYy5nZXQoYSk7CiAgICAgICAgaWYgKCFjKSByZXR1cm4gITE7CiAgICAgICAgYSA9ICExOwogICAgICAgIGZvciAoY29uc3QgW2UsIGddIG9mIGMpIGMgPSBlLkRlYnVnQ2FuUnVuRmFzdCgpID8gdGhpcy5fRXhlY3V0ZVRyaWdnZXIoYiwgZSwgZykgOiB5aWVsZCogdGhpcy5fRGVidWdFeGVjdXRlVHJpZ2dlcihiLCBlLCBnKSwgYSA9IGEgfHwgYzsKICAgICAgICByZXR1cm4gYQogICAgfQogICAgX0Zhc3RUcmlnZ2VyKGEsIGIsIGQpIHsKICAgICAgICBiID0gYi5HZXRPYmplY3RDbGFzcygpOwogICAgICAgIGIgPSB0aGlzLl9mYXN0VHJpZ2dlcnMuZ2V0KGIpOwogICAgICAgIGlmICghYikgcmV0dXJuICExOwogICAgICAgIGEgPSBiLmdldChhKTsKICAgICAgICBpZiAoIWEpIHJldHVybiAhMTsKICAgICAgICBkID0gYS5nZXQoZCk7CiAgICAgICAgaWYgKCFkKSByZXR1cm4gITE7CiAgICAgICAgYSA9ICExOwogICAgICAgIGZvciAobGV0IGMgPSAwLCBlID0gZC5sZW5ndGg7IGMgPCBlOyArK2MpIGIgPSBkW2NdLCBiID0gdGhpcy5fRXhlY3V0ZVRyaWdnZXIobnVsbCwgYlswXSwgYlsxXSksIGEgPSBhIHx8IGI7CiAgICAgICAgcmV0dXJuIGEKICAgIH0qIF9EZWJ1Z0Zhc3RUcmlnZ2VyKGEsIGIsIGQpIHsKICAgICAgICBiID0gYi5HZXRPYmplY3RDbGFzcygpOwogICAgICAgIGIgPSB0aGlzLl9mYXN0VHJpZ2dlcnMuZ2V0KGIpOwogICAgICAgIGlmICghYikgcmV0dXJuICExOwogICAgICAgIGEgPSBiLmdldChhKTsKICAgICAgICBpZiAoIWEpIHJldHVybiAhMTsKICAgICAgICBkID0gYS5nZXQoZCk7CiAgICAgICAgaWYgKCFkKSByZXR1cm4gITE7CiAgICAgICAgYSA9ICExOwogICAgICAgIGZvciAobGV0IGUgPSAwLCBnID0gZC5sZW5ndGg7IGUgPCBnOyArK2UpIHsKICAgICAgICAgICAgdmFyIGMgPSBkW2VdOwogICAgICAgICAgICBiID0gY1swXTsKICAgICAgICAgICAgYyA9IGNbMV07CiAgICAgICAgICAgIGIgPSBiLkRlYnVnQ2FuUnVuRmFzdCgpID8gdGhpcy5fRXhlY3V0ZVRyaWdnZXIobnVsbCwgYiwgYykgOiB5aWVsZCogdGhpcy5fRGVidWdFeGVjdXRlVHJpZ2dlcihudWxsLCBiLCBjKTsKICAgICAgICAgICAgYSA9IGEgfHwgYgogICAgICAgIH0KICAgICAgICByZXR1cm4gYQogICAgfQogICAgX0V4ZWN1dGVUcmlnZ2VyKGEsCiAgICAgICAgYiwgZCkgewogICAgICAgIGNvbnN0IGMgPSB0aGlzLl9ydW50aW1lLAogICAgICAgICAgICBlID0gdGhpcy5fZXZlbnRTaGVldE1hbmFnZXIsCiAgICAgICAgICAgIGcgPSBlLkdldEN1cnJlbnRFdmVudCgpLAogICAgICAgICAgICBrID0gZS5HZXRFdmVudFN0YWNrKCksCiAgICAgICAgICAgIG0gPSBlLkdldFRyaWdnZXJEZXB0aCgpOwogICAgICAgIGxldCBuID0gITE7CiAgICAgICAgZyAmJiBlLlB1c2hDbGVhblNvbChnLkdldFNvbE1vZGlmaWVyc0luY2x1ZGluZ1BhcmVudHMoKSk7CiAgICAgICAgZS5QdXNoQ2xlYW5Tb2woYi5HZXRTb2xNb2RpZmllcnNJbmNsdWRpbmdQYXJlbnRzKCkpOwogICAgICAgIGNvbnN0IHEgPSAxIDwgbTsKICAgICAgICBxICYmIGUuR2V0TG9jYWxWYXJTdGFjaygpLlB1c2goKTsKICAgICAgICBjb25zdCB1ID0gay5QdXNoKGIpOwogICAgICAgIGEgJiYgKGIuR2V0Q29uZGl0aW9ucygpW2RdLkdldE9iamVjdENsYXNzKCkuR2V0Q3VycmVudFNvbCgpLlNldFNpbmdsZVBpY2tlZChhKSwgYS5Jc0luQ29udGFpbmVyKCkgJiYgYS5TZXRTaWJsaW5nc1NpbmdsZVBpY2tlZCgpKTsKICAgICAgICBhID0gITA7CiAgICAgICAgaWYgKGIuR2V0UGFyZW50KCkpIHsKICAgICAgICAgICAgY29uc3QgdyA9IGIuR2V0VHJpZ2dlclBhcmVudHMoKTsKICAgICAgICAgICAgZm9yIChsZXQgeiA9IDAsIEMgPSB3Lmxlbmd0aDsgeiA8IEM7ICsreikKICAgICAgICAgICAgICAgIGlmICghd1t6XS5SdW5QcmVUcmlnZ2VyKHUpKSB7CiAgICAgICAgICAgICAgICAgICAgYSA9ICExOwogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGEgJiYgKGIuSXNPckJsb2NrKCkgPyBiLlJ1bk9yQmxvY2tUcmlnZ2VyKHUsIGQpIDogYi5SdW4odSksIG4gPSB1LkdldExhc3RFdmVudFRydWUoKSk7CiAgICAgICAgay5Qb3AoKTsKICAgICAgICBxICYmIGUuR2V0TG9jYWxWYXJTdGFjaygpLlBvcCgpOwogICAgICAgIGUuUG9wU29sKGIuR2V0U29sTW9kaWZpZXJzSW5jbHVkaW5nUGFyZW50cygpKTsKICAgICAgICBnICYmIGUuUG9wU29sKGcuR2V0U29sTW9kaWZpZXJzSW5jbHVkaW5nUGFyZW50cygpKTsKICAgICAgICBnIHx8IDEgIT09IG0gfHwgKGUuQ2xlYXJBc3luY0FjdGlvblByb21pc2VzKCksIGUuSXNGbHVzaGluZ0Jsb2NrZWQoKSB8fCBjLkZsdXNoUGVuZGluZ0luc3RhbmNlcygpKTsKICAgICAgICByZXR1cm4gbgogICAgfSogX0RlYnVnRXhlY3V0ZVRyaWdnZXIoYSwgYiwgZCkgewogICAgICAgIGNvbnN0IGMgPSB0aGlzLl9ydW50aW1lLAogICAgICAgICAgICBlID0gdGhpcy5fZXZlbnRTaGVldE1hbmFnZXIsCiAgICAgICAgICAgIGcgPSBlLkdldEN1cnJlbnRFdmVudCgpLAogICAgICAgICAgICBrID0gZS5HZXRFdmVudFN0YWNrKCksCiAgICAgICAgICAgIG0gPSBlLkdldFRyaWdnZXJEZXB0aCgpOwogICAgICAgIGxldCBuID0gITE7CiAgICAgICAgZyAmJiBlLlB1c2hDbGVhblNvbChnLkdldFNvbE1vZGlmaWVyc0luY2x1ZGluZ1BhcmVudHMoKSk7CiAgICAgICAgZS5QdXNoQ2xlYW5Tb2woYi5HZXRTb2xNb2RpZmllcnNJbmNsdWRpbmdQYXJlbnRzKCkpOwogICAgICAgIGNvbnN0IHEgPSAxIDwgbTsKICAgICAgICBxICYmIGUuR2V0TG9jYWxWYXJTdGFjaygpLlB1c2goKTsKICAgICAgICBjb25zdCB1ID0gay5QdXNoKGIpOwogICAgICAgIGEgJiYgKGIuR2V0Q29uZGl0aW9ucygpW2RdLkdldE9iamVjdENsYXNzKCkuR2V0Q3VycmVudFNvbCgpLlNldFNpbmdsZVBpY2tlZChhKSwgYS5Jc0luQ29udGFpbmVyKCkgJiYgYS5TZXRTaWJsaW5nc1NpbmdsZVBpY2tlZCgpKTsKICAgICAgICBhID0gITA7CiAgICAgICAgaWYgKGIuR2V0UGFyZW50KCkpIHsKICAgICAgICAgICAgY29uc3QgdyA9IGIuR2V0VHJpZ2dlclBhcmVudHMoKTsKICAgICAgICAgICAgZm9yIChsZXQgeiA9IDAsIEMgPSB3Lmxlbmd0aDsgeiA8IEM7ICsreikKICAgICAgICAgICAgICAgIGlmICghKHlpZWxkKiB3W3pdLkRlYnVnUnVuUHJlVHJpZ2dlcih1KSkpIHsKICAgICAgICAgICAgICAgICAgICBhID0gITE7CiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgYSAmJiAoYi5Jc09yQmxvY2soKSA/IHlpZWxkKiBiLkRlYnVnUnVuT3JCbG9ja1RyaWdnZXIodSwgZCk6IHlpZWxkKiBiLkRlYnVnUnVuKHUpLCBuID0gdS5HZXRMYXN0RXZlbnRUcnVlKCkpOwogICAgICAgIGsuUG9wKCk7CiAgICAgICAgcSAmJiBlLkdldExvY2FsVmFyU3RhY2soKS5Qb3AoKTsKICAgICAgICBlLlBvcFNvbChiLkdldFNvbE1vZGlmaWVyc0luY2x1ZGluZ1BhcmVudHMoKSk7CiAgICAgICAgZyAmJiBlLlBvcFNvbChnLkdldFNvbE1vZGlmaWVyc0luY2x1ZGluZ1BhcmVudHMoKSk7CiAgICAgICAgZyB8fCAxICE9PSBtIHx8IChlLkNsZWFyQXN5bmNBY3Rpb25Qcm9taXNlcygpLCBlLklzRmx1c2hpbmdCbG9ja2VkKCkgfHwgYy5GbHVzaFBlbmRpbmdJbnN0YW5jZXMoKSk7CiAgICAgICAgcmV0dXJuIG4KICAgIH0KICAgIF9HZXRQZXJmUmVjb3JkKCkgewogICAgICAgIHJldHVybiB0aGlzLl9wZXJmUmVjb3JkCiAgICB9Cn07CiJ1c2Ugc3RyaWN0IjsKY29uc3QgQzMkanNjb21wJDEyOSA9IHNlbGYuQzMsCiAgICBFTVBUWV9BUlJBWSA9IFtdOwoKZnVuY3Rpb24gTm9BY3Rpb25zKGEsIGIpIHsKICAgIHJldHVybiAhMAp9CgpmdW5jdGlvbiogRGVidWdOb0FjdGlvbnMoYSwgYikgewogICAgcmV0dXJuICEwCn0KQzMkanNjb21wJDEyOS5FdmVudEJsb2NrID0gY2xhc3MgZXh0ZW5kcyBDMyRqc2NvbXAkMTI5LkRlZmVuZGVkQmFzZSB7CiAgICBjb25zdHJ1Y3RvcihhLCBiLCBkKSB7CiAgICAgICAgc3VwZXIoKTsKICAgICAgICB0aGlzLl9ldmVudFNoZWV0ID0gYTsKICAgICAgICB0aGlzLl9ydW50aW1lID0gYS5HZXRSdW50aW1lKCk7CiAgICAgICAgdGhpcy5fcGFyZW50ID0gYjsKICAgICAgICB0aGlzLl9zY29wZVBhcmVudCA9IG51bGw7CiAgICAgICAgdGhpcy5fZXZlbnRTdGFjayA9IHRoaXMuX3J1bnRpbWUuR2V0RXZlbnRTaGVldE1hbmFnZXIoKS5HZXRFdmVudFN0YWNrKCk7CiAgICAgICAgdGhpcy5fc29sTW9kaWZpZXJzID0gW107CiAgICAgICAgdGhpcy5fc29sTW9kaWZpZXJzSW5jbHVkaW5nUGFyZW50cyA9IFtdOwogICAgICAgIHRoaXMuX2hhc0Vsc2VCbG9jayA9IHRoaXMuX2lzVG9wTGV2ZWxHcm91cCA9IHRoaXMuX2lzU29sV3JpdGVyQWZ0ZXJDbmRzID0gdGhpcy5faGFzR290U29sTW9kaWZpZXJzSW5jbHVkaW5nUGFyZW50cyA9ICExOwogICAgICAgIHRoaXMuX2lzT3JCbG9jayA9ICEhZFsyXTsKICAgICAgICB0aGlzLl9pc0Vsc2VCbG9jayA9ICExOwogICAgICAgIHRoaXMuX3RyaWdnZXJQYXJlbnRzID0gbnVsbDsKICAgICAgICB0aGlzLl9jb25kaXRpb25zID0gW107CiAgICAgICAgdGhpcy5fYWN0aW9ucyA9IFtdOwogICAgICAgIHRoaXMuX3N1YkV2ZW50cyA9IFtdOwogICAgICAgIHRoaXMuX1J1bkFjdGlvbnMgPSBOb0FjdGlvbnM7CiAgICAgICAgdGhpcy5fRGVidWdSdW5BY3Rpb25zID0gRGVidWdOb0FjdGlvbnM7CiAgICAgICAgdGhpcy5faXNJbml0aWFsbHlBY3RpdmUgPSB0aGlzLl9pc0dyb3VwID0gITE7CiAgICAgICAgdGhpcy5fZ3JvdXBOYW1lID0gIiI7CiAgICAgICAgdGhpcy5faXNHcm91cEFjdGl2ZSA9ICExOwogICAgICAgIHRoaXMuX3BlcmZSZWNvcmQgPSB0aGlzLl9jb250YWluZWRJbmNsdWRlcyA9IG51bGw7CiAgICAgICAgdGhpcy5fc2lkID0gZFs0XTsKICAgICAgICB0aGlzLl9kaXNwbGF5TnVtYmVyID0gZFs1XTsKICAgICAgICB0aGlzLl9ldmVudFNoZWV0Ll9SZWdpc3RlckV2ZW50QnlEaXNwbGF5TnVtYmVyKHRoaXMsIHRoaXMuX2Rpc3BsYXlOdW1iZXIpOwogICAgICAgIHRoaXMuX2RlYnVnRGF0YSA9IHRoaXMuX3J1bnRpbWUuSXNEZWJ1ZygpID8gewogICAgICAgICAgICBpc0JyZWFrcG9pbnQ6IGRbM11bMF0sCiAgICAgICAgICAgIGlzQnJlYWthYmxlOiBkWzNdWzFdLAogICAgICAgICAgICBjYW5SdW5BbGxDb25kaXRpb25zRmFzdDogITEsCiAgICAgICAgICAgIGNhblJ1bkFsbEFjdGlvbnNGYXN0OiAhMSwKICAgICAgICAgICAgY2FuUnVuQWxsU3ViRXZlbnRzRmFzdDogITEsCiAgICAgICAgICAgIGNhblJ1blNlbGZGYXN0OiAhMQogICAgICAgIH0gOiBudWxsOwogICAgICAgIHRoaXMuR2V0RXZlbnRTaGVldE1hbmFnZXIoKS5fUmVnaXN0ZXJFdmVudEJsb2NrKHRoaXMpOwogICAgICAgIDMgPT09IGRbMF0gJiYgdGhpcy5fSW5pdEdyb3VwKGRbMV0pOwogICAgICAgIGEgPSAwOwogICAgICAgIGZvciAodmFyIGMgb2YgZFs2XSkgYiA9IEMzJGpzY29tcCQxMjkuQ29uZGl0aW9uLkNyZWF0ZSh0aGlzLCBjLCBhKyspLCB0aGlzLl9jb25kaXRpb25zLnB1c2goYiksIHRoaXMuX0FkZFNvbE1vZGlmaWVyKGIuR2V0T2JqZWN0Q2xhc3MoKSk7CiAgICAgICAgYSA9IDA7CiAgICAgICAgZm9yIChjb25zdCBlIG9mIGRbN10pIGMgPSBDMyRqc2NvbXAkMTI5LkFjdGlvbi5DcmVhdGUodGhpcywgZSwgYSsrKSwgdGhpcy5fYWN0aW9ucy5wdXNoKGMpOwogICAgICAgIGlmICg5ID09PSBkLmxlbmd0aCkgewogICAgICAgICAgICBkID0gZFs4XTsKICAgICAgICAgICAgZm9yIChjb25zdCBlIG9mIGQpIHRoaXMuX2V2ZW50U2hlZXQuX0NyZWF0ZUV2ZW50KGUsIHRoaXMsIHRoaXMuX3N1YkV2ZW50cykKICAgICAgICB9CiAgICAgICAgdGhpcy5fY29uZGl0aW9ucy5sZW5ndGggJiYgKHRoaXMuX2lzRWxzZUJsb2NrID0gbnVsbCA9PT0gdGhpcy5fY29uZGl0aW9uc1swXS5HZXRPYmplY3RDbGFzcygpICYmCiAgICAgICAgICAgIHRoaXMuX2NvbmRpdGlvbnNbMF0uX0dldEZ1bmMoKSA9PT0gQzMkanNjb21wJDEyOS5QbHVnaW5zLlN5c3RlbS5DbmRzLkVsc2UpOwogICAgICAgIDAgPT09IHRoaXMuX2NvbmRpdGlvbnMubGVuZ3RoICYmICh0aGlzLl9jb25kaXRpb25zID0gRU1QVFlfQVJSQVkpOwogICAgICAgIDAgPT09IHRoaXMuX2FjdGlvbnMubGVuZ3RoICYmICh0aGlzLl9hY3Rpb25zID0gRU1QVFlfQVJSQVkpOwogICAgICAgIDAgPT09IHRoaXMuX3N1YkV2ZW50cy5sZW5ndGggJiYgKHRoaXMuX3N1YkV2ZW50cyA9IEVNUFRZX0FSUkFZKQogICAgfQogICAgc3RhdGljIENyZWF0ZShhLCBiLCBkKSB7CiAgICAgICAgcmV0dXJuIEMzJGpzY29tcCQxMjkuTmV3KEMzJGpzY29tcCQxMjkuRXZlbnRCbG9jaywgYSwgYiwgZCkKICAgIH0KICAgIF9Jbml0R3JvdXAoYSkgewogICAgICAgIHRoaXMuX2lzR3JvdXAgPSAhMDsKICAgICAgICB0aGlzLl9pc0dyb3VwQWN0aXZlID0gdGhpcy5faXNJbml0aWFsbHlBY3RpdmUgPSAhIWFbMF07CiAgICAgICAgdGhpcy5fZ3JvdXBOYW1lID0gYVsxXS50b0xvd2VyQ2FzZSgpOwogICAgICAgIHRoaXMuX2NvbnRhaW5lZEluY2x1ZGVzID0gW107CiAgICAgICAgdGhpcy5HZXRFdmVudFNoZWV0TWFuYWdlcigpLl9SZWdpc3Rlckdyb3VwKHRoaXMpOwogICAgICAgIHRoaXMuX3J1bnRpbWUuSXNEZWJ1ZygpICYmICh0aGlzLl9wZXJmUmVjb3JkID0gewogICAgICAgICAgICB0eXBlOiAiZ3JvdXAiLAogICAgICAgICAgICBuYW1lOiBhWzFdLAogICAgICAgICAgICB0b3RhbFRpbWVDb3VudGVyOiAwLAogICAgICAgICAgICBjaGlsZHJlbjogW10KICAgICAgICB9KQogICAgfQogICAgX0FkZENvbnRhaW5lZEluY2x1ZGUoYSkgewogICAgICAgIHRoaXMuX2NvbnRhaW5lZEluY2x1ZGVzLnB1c2goYSkKICAgIH0KICAgIF9BZGRDb250YWluZXJTb2xNb2RpZmllclRvTGlzdChhLCBiKSB7CiAgICAgICAgZm9yIChjb25zdCBkIG9mIGEuR2V0Q29udGFpbmVyKCkub2JqZWN0VHlwZXMoKSkgYi5pbmNsdWRlcyhkKSB8fCBiLnB1c2goZCkKICAgIH0KICAgIF9BZGRTb2xNb2RpZmllclRvTGlzdChhLCBiKSB7CiAgICAgICAgaWYgKGEpCiAgICAgICAgICAgIGlmIChiLmluY2x1ZGVzKGEpIHx8IGIucHVzaChhKSwgYS5Jc0ZhbWlseSgpKQogICAgICAgICAgICAgICAgZm9yIChjb25zdCBkIG9mIGEuR2V0RmFtaWx5TWVtYmVycygpKSBkLklzSW5Db250YWluZXIoKSAmJiB0aGlzLl9BZGRDb250YWluZXJTb2xNb2RpZmllclRvTGlzdChkLCBiKTsKICAgICAgICAgICAgZWxzZSBhLklzSW5Db250YWluZXIoKSAmJiB0aGlzLl9BZGRDb250YWluZXJTb2xNb2RpZmllclRvTGlzdChhLCBiKQogICAgfQogICAgX0FkZFNvbE1vZGlmaWVyKGEpIHsKICAgICAgICB0aGlzLl9BZGRTb2xNb2RpZmllclRvTGlzdChhLAogICAgICAgICAgICB0aGlzLl9zb2xNb2RpZmllcnMpCiAgICB9CiAgICBfQWRkUGFyZW50U29sTW9kaWZpZXIoYSkgewogICAgICAgIHRoaXMuX0FkZFNvbE1vZGlmaWVyVG9MaXN0KGEsIHRoaXMuX3NvbE1vZGlmaWVyc0luY2x1ZGluZ1BhcmVudHMpCiAgICB9CiAgICBTZXRBbGxTb2xNb2RpZmllcnMoKSB7CiAgICAgICAgdGhpcy5fc29sTW9kaWZpZXJzID0gdGhpcy5fcnVudGltZS5HZXRBbGxPYmplY3RDbGFzc2VzKCkKICAgIH0KICAgIF9Qb3N0SW5pdChhKSB7CiAgICAgICAgdGhpcy5faGFzRWxzZUJsb2NrID0gISFhOwogICAgICAgIHRoaXMuX0lkZW50aWZ5VG9wTGV2ZWxHcm91cCgpOwogICAgICAgIHRoaXMuX0lkZW50aWZ5VHJpZ2dlclBhcmVudHMoKTsKICAgICAgICBmb3IgKGNvbnN0IGQgb2YgdGhpcy5fY29uZGl0aW9ucykgZC5fUG9zdEluaXQoKTsKICAgICAgICBpZiAoMCA8IHRoaXMuX2FjdGlvbnMubGVuZ3RoKSB7CiAgICAgICAgICAgIGEgPSAhMTsKICAgICAgICAgICAgZm9yICh2YXIgYiBvZiB0aGlzLl9hY3Rpb25zKSBiLl9Qb3N0SW5pdCgpLCBiLkhhc1JldHVyblR5cGUoKSAmJiAoYSA9ICEwKTsKICAgICAgICAgICAgYSA/ICh0aGlzLl9SdW5BY3Rpb25zID0gdGhpcy5fUnVuQWN0aW9uc19SZXR1cm5WYWx1ZSwgdGhpcy5fRGVidWdSdW5BY3Rpb25zID0gdGhpcy5fRGVidWdSdW5BY3Rpb25zX1JldHVyblZhbHVlKSA6CiAgICAgICAgICAgICAgICAodGhpcy5fUnVuQWN0aW9ucyA9IHRoaXMuX1J1bkFjdGlvbnNfRmFzdCwgdGhpcy5fRGVidWdSdW5BY3Rpb25zID0gdGhpcy5fRGVidWdSdW5BY3Rpb25zX0Zhc3QpCiAgICAgICAgfQogICAgICAgIGIgPSB0aGlzLl9zdWJFdmVudHM7CiAgICAgICAgZm9yIChsZXQgZCA9IDAsIGMgPSBiLmxlbmd0aDsgZCA8IGM7ICsrZCkgYSA9IGQgPCBjIC0gMSAmJiBiW2QgKyAxXSBpbnN0YW5jZW9mIEMzJGpzY29tcCQxMjkuRXZlbnRCbG9jayAmJiBiW2QgKyAxXS5Jc0Vsc2VCbG9jaygpLCBiW2RdLl9Qb3N0SW5pdChhKTsKICAgICAgICB0aGlzLl9kZWJ1Z0RhdGEgJiYgdGhpcy5fVXBkYXRlQ2FuUnVuRmFzdCgpOwogICAgICAgIHRoaXMuX3BlcmZSZWNvcmQgJiYgdGhpcy5fR2V0UGVyZlJlY29yZFBhcmVudCgpLl9HZXRQZXJmUmVjb3JkKCkuY2hpbGRyZW4ucHVzaCh0aGlzLl9wZXJmUmVjb3JkKQogICAgfQogICAgX0dldFBlcmZSZWNvcmQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3BlcmZSZWNvcmQKICAgIH0KICAgIF9HZXRQZXJmUmVjb3JkUGFyZW50KCkgewogICAgICAgIGxldCBhID0gdGhpcy5HZXRQYXJlbnQoKTsKICAgICAgICBmb3IgKDsgYTspIHsKICAgICAgICAgICAgaWYgKGEuSXNHcm91cCgpKSByZXR1cm4gYTsKICAgICAgICAgICAgYSA9IGEuR2V0UGFyZW50KCkKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXMuX2V2ZW50U2hlZXQKICAgIH0KICAgIF9VcGRhdGVDYW5SdW5GYXN0KCkgewogICAgICAgIGNvbnN0IGEgPQogICAgICAgICAgICB0aGlzLl9kZWJ1Z0RhdGE7CiAgICAgICAgYS5jYW5SdW5BbGxDb25kaXRpb25zRmFzdCA9IHRoaXMuX2NvbmRpdGlvbnMuZXZlcnkoYiA9PiBiLkRlYnVnQ2FuUnVuRmFzdCgpKTsKICAgICAgICBhLmNhblJ1bkFsbEFjdGlvbnNGYXN0ID0gdGhpcy5fYWN0aW9ucy5ldmVyeShiID0+IGIuRGVidWdDYW5SdW5GYXN0KCkpOwogICAgICAgIGEuY2FuUnVuQWxsU3ViRXZlbnRzRmFzdCA9IHRoaXMuX3N1YkV2ZW50cy5ldmVyeShiID0+IGIuRGVidWdDYW5SdW5GYXN0KCkpOwogICAgICAgIGEuY2FuUnVuU2VsZkZhc3QgPSBhLmNhblJ1bkFsbENvbmRpdGlvbnNGYXN0ICYmIGEuY2FuUnVuQWxsQWN0aW9uc0Zhc3QgJiYgYS5jYW5SdW5BbGxTdWJFdmVudHNGYXN0CiAgICB9CiAgICBfVXBkYXRlQ2FuUnVuRmFzdFJlY3Vyc2l2ZSgpIHsKICAgICAgICBsZXQgYSA9IHRoaXM7CiAgICAgICAgZG8gYS5fVXBkYXRlQ2FuUnVuRmFzdCgpLCBhID0gYS5HZXRQYXJlbnQoKTsgd2hpbGUgKGEpCiAgICB9CiAgICBfSWRlbnRpZnlUb3BMZXZlbEdyb3VwKCkgewogICAgICAgIGlmICh0aGlzLklzR3JvdXAoKSkgewogICAgICAgICAgICB2YXIgYSA9IHRoaXMuR2V0UGFyZW50KCk7CiAgICAgICAgICAgIGZvciAodGhpcy5faXNUb3BMZXZlbEdyb3VwID0gITA7IGE7KSB7CiAgICAgICAgICAgICAgICBpZiAoIWEuSXNHcm91cCgpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5faXNUb3BMZXZlbEdyb3VwID0gITE7CiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGEgPSBhLkdldFBhcmVudCgpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBfSWRlbnRpZnlTb2xNb2RpZmllcnNJbmNsdWRpbmdQYXJlbnRzKCkgewogICAgICAgIHZhciBhID0gdGhpcy5fcnVudGltZS5HZXRBbGxPYmplY3RDbGFzc2VzKCk7CiAgICAgICAgaWYgKHRoaXMuX3NvbE1vZGlmaWVycyA9PT0gYSkgdGhpcy5fc29sTW9kaWZpZXJzSW5jbHVkaW5nUGFyZW50cyA9IGE7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHRoaXMuX3NvbE1vZGlmaWVyc0luY2x1ZGluZ1BhcmVudHMgPSBDMyRqc2NvbXAkMTI5LmNsb25lQXJyYXkodGhpcy5fc29sTW9kaWZpZXJzKTsKICAgICAgICAgICAgZm9yIChhID0gdGhpcy5HZXRQYXJlbnQoKTsgYTspIHsKICAgICAgICAgICAgICAgIGZvciAodmFyIGIgb2YgYS5fc29sTW9kaWZpZXJzKSB0aGlzLl9BZGRQYXJlbnRTb2xNb2RpZmllcihiKTsKICAgICAgICAgICAgICAgIGEgPSBhLkdldFBhcmVudCgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgYiA9IHRoaXMuR2V0RXZlbnRTaGVldE1hbmFnZXIoKTsKICAgICAgICAgICAgdGhpcy5fc29sTW9kaWZpZXJzID0gYi5fRGVkdXBsaWNhdGVTb2xNb2RpZmllckxpc3QodGhpcy5fc29sTW9kaWZpZXJzKTsKICAgICAgICAgICAgdGhpcy5fc29sTW9kaWZpZXJzSW5jbHVkaW5nUGFyZW50cyA9IGIuX0RlZHVwbGljYXRlU29sTW9kaWZpZXJMaXN0KHRoaXMuX3NvbE1vZGlmaWVyc0luY2x1ZGluZ1BhcmVudHMpCiAgICAgICAgfQogICAgfQogICAgX0lkZW50aWZ5VHJpZ2dlclBhcmVudHMoKSB7CiAgICAgICAgaWYgKHRoaXMuSGFzQW55VHJpZ2dlcmVkQ29uZGl0aW9uKCkpIHsKICAgICAgICAgICAgdGhpcy5fdHJpZ2dlclBhcmVudHMgPSBbXTsKICAgICAgICAgICAgZm9yICh2YXIgYSA9IHRoaXMuR2V0UGFyZW50KCk7IGE7KSB0aGlzLl90cmlnZ2VyUGFyZW50cy5wdXNoKGEpLCBhID0gYS5HZXRQYXJlbnQoKTsKICAgICAgICAgICAgdGhpcy5fdHJpZ2dlclBhcmVudHMucmV2ZXJzZSgpCiAgICAgICAgfQogICAgfQogICAgU2V0U29sV3JpdGVyQWZ0ZXJDbmRzKCkgewogICAgICAgIHRoaXMuX2lzU29sV3JpdGVyQWZ0ZXJDbmRzID0gITA7CiAgICAgICAgdGhpcy5fcGFyZW50ICYmIHRoaXMuX3BhcmVudC5TZXRTb2xXcml0ZXJBZnRlckNuZHMoKQogICAgfQogICAgSXNTb2xXcml0ZXJBZnRlckNuZHMoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2lzU29sV3JpdGVyQWZ0ZXJDbmRzCiAgICB9CiAgICBHZXRTb2xNb2RpZmllcnMoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3NvbE1vZGlmaWVycwogICAgfQogICAgR2V0U29sTW9kaWZpZXJzSW5jbHVkaW5nUGFyZW50cygpIHsKICAgICAgICB0aGlzLl9oYXNHb3RTb2xNb2RpZmllcnNJbmNsdWRpbmdQYXJlbnRzIHx8CiAgICAgICAgICAgICh0aGlzLl9oYXNHb3RTb2xNb2RpZmllcnNJbmNsdWRpbmdQYXJlbnRzID0gITAsIHRoaXMuX0lkZW50aWZ5U29sTW9kaWZpZXJzSW5jbHVkaW5nUGFyZW50cygpKTsKICAgICAgICByZXR1cm4gdGhpcy5fc29sTW9kaWZpZXJzSW5jbHVkaW5nUGFyZW50cwogICAgfQogICAgSGFzU29sTW9kaWZpZXIoYSkgewogICAgICAgIHJldHVybiB0aGlzLl9zb2xNb2RpZmllcnMuaW5jbHVkZXMoYSkKICAgIH0KICAgIEdldFRyaWdnZXJQYXJlbnRzKCkgewogICAgICAgIHJldHVybiB0aGlzLl90cmlnZ2VyUGFyZW50cwogICAgfQogICAgR2V0RXZlbnRTaGVldCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZXZlbnRTaGVldAogICAgfQogICAgR2V0RXZlbnRTaGVldE1hbmFnZXIoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2V2ZW50U2hlZXQuR2V0RXZlbnRTaGVldE1hbmFnZXIoKQogICAgfQogICAgR2V0UnVudGltZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcnVudGltZQogICAgfQogICAgR2V0UGFyZW50KCkgewogICAgICAgIHJldHVybiB0aGlzLl9wYXJlbnQKICAgIH0KICAgIF9TZXRTY29wZVBhcmVudChhKSB7CiAgICAgICAgdGhpcy5fc2NvcGVQYXJlbnQgPSBhCiAgICB9CiAgICBHZXRTY29wZVBhcmVudCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fc2NvcGVQYXJlbnQgfHwgdGhpcy5fcGFyZW50CiAgICB9CiAgICBHZXREaXNwbGF5TnVtYmVyKCkgewogICAgICAgIHJldHVybiB0aGlzLl9kaXNwbGF5TnVtYmVyCiAgICB9CiAgICBJc0RlYnVnQnJlYWthYmxlKCkgewogICAgICAgIHJldHVybiB0aGlzLl9kZWJ1Z0RhdGEgJiYKICAgICAgICAgICAgdGhpcy5fZGVidWdEYXRhLmlzQnJlYWthYmxlCiAgICB9CiAgICBJc0RlYnVnQnJlYWtwb2ludCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5Jc0RlYnVnQnJlYWthYmxlKCkgJiYgdGhpcy5fZGVidWdEYXRhLmlzQnJlYWtwb2ludAogICAgfQogICAgX1NldERlYnVnQnJlYWtwb2ludChhKSB7CiAgICAgICAgdGhpcy5fZGVidWdEYXRhLmlzQnJlYWtwb2ludCA9ICEhYTsKICAgICAgICB0aGlzLl9VcGRhdGVDYW5SdW5GYXN0UmVjdXJzaXZlKCkKICAgIH0KICAgIElzR3JvdXAoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2lzR3JvdXAKICAgIH0KICAgIElzVG9wTGV2ZWxHcm91cCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5faXNUb3BMZXZlbEdyb3VwCiAgICB9CiAgICBJc0Vsc2VCbG9jaygpIHsKICAgICAgICByZXR1cm4gdGhpcy5faXNFbHNlQmxvY2sKICAgIH0KICAgIEhhc0Vsc2VCbG9jaygpIHsKICAgICAgICByZXR1cm4gdGhpcy5faGFzRWxzZUJsb2NrCiAgICB9CiAgICBHZXRHcm91cE5hbWUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2dyb3VwTmFtZQogICAgfQogICAgSXNHcm91cEFjdGl2ZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5faXNHcm91cEFjdGl2ZQogICAgfQogICAgUmVzZXRJbml0aWFsQWN0aXZhdGlvbigpIHsKICAgICAgICB0aGlzLlNldEdyb3VwQWN0aXZlKHRoaXMuX2lzSW5pdGlhbGx5QWN0aXZlKQogICAgfQogICAgU2V0R3JvdXBBY3RpdmUoYSkgewogICAgICAgIGEgPSAhIWE7CiAgICAgICAgaWYgKCF0aGlzLl9pc0dyb3VwKSB0aHJvdyBFcnJvcigibm90IGEgZ3JvdXAiKTsKICAgICAgICBpZiAodGhpcy5faXNHcm91cEFjdGl2ZSAhPT0gYSkgewogICAgICAgICAgICB0aGlzLl9pc0dyb3VwQWN0aXZlID0gYTsKICAgICAgICAgICAgZm9yIChjb25zdCBiIG9mIHRoaXMuX2NvbnRhaW5lZEluY2x1ZGVzKSBiLlVwZGF0ZUFjdGl2ZSgpOwogICAgICAgICAgICB0aGlzLl9jb250YWluZWRJbmNsdWRlcy5sZW5ndGggJiYgKGEgPSB0aGlzLl9ydW50aW1lLkdldEN1cnJlbnRMYXlvdXQoKS5HZXRFdmVudFNoZWV0KCkpICYmIGEuX1VwZGF0ZURlZXBJbmNsdWRlcygpCiAgICAgICAgfQogICAgfQogICAgR2V0U0lEKCkgewogICAgICAgIHJldHVybiB0aGlzLl9zaWQKICAgIH0KICAgIElzT3JCbG9jaygpIHsKICAgICAgICByZXR1cm4gdGhpcy5faXNPckJsb2NrCiAgICB9CiAgICBJc1RyaWdnZXIoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2NvbmRpdGlvbnMubGVuZ3RoICYmIHRoaXMuX2NvbmRpdGlvbnNbMF0uSXNUcmlnZ2VyKCkKICAgIH0KICAgIElzRm9yRnVuY3Rpb25CbG9jaygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fc2NvcGVQYXJlbnQgJiYgdGhpcy5fc2NvcGVQYXJlbnQgaW5zdGFuY2VvZiBDMyRqc2NvbXAkMTI5LkZ1bmN0aW9uQmxvY2sKICAgIH0KICAgIEhhc0FueVRyaWdnZXJlZENvbmRpdGlvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5Jc0ZvckZ1bmN0aW9uQmxvY2soKSB8fAogICAgICAgICAgICB0aGlzLl9jb25kaXRpb25zLnNvbWUoYSA9PiBhLklzVHJpZ2dlcigpKQogICAgfQogICAgR2V0Q29uZGl0aW9ucygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fY29uZGl0aW9ucwogICAgfQogICAgR2V0Q29uZGl0aW9uQ291bnQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2NvbmRpdGlvbnMubGVuZ3RoCiAgICB9CiAgICBHZXRDb25kaXRpb25BdChhKSB7CiAgICAgICAgYSA9IE1hdGguZmxvb3IoYSk7CiAgICAgICAgaWYgKDAgPiBhIHx8IGEgPj0gdGhpcy5fY29uZGl0aW9ucy5sZW5ndGgpIHRocm93IG5ldyBSYW5nZUVycm9yKCJpbnZhbGlkIGNvbmRpdGlvbiBpbmRleCIpOwogICAgICAgIHJldHVybiB0aGlzLl9jb25kaXRpb25zW2FdCiAgICB9CiAgICBHZXRDb25kaXRpb25CeURlYnVnSW5kZXgoYSkgewogICAgICAgIHJldHVybiB0aGlzLkdldENvbmRpdGlvbkF0KGEpCiAgICB9CiAgICBJc0ZpcnN0Q29uZGl0aW9uT2ZUeXBlKGEpIHsKICAgICAgICBsZXQgYiA9IGEuR2V0SW5kZXgoKTsKICAgICAgICBpZiAoMCA9PT0gYikgcmV0dXJuICEwOwogICAgICAgIGZvciAoLS1iOyAwIDw9IGI7IC0tYikKICAgICAgICAgICAgaWYgKHRoaXMuX2NvbmRpdGlvbnNbYl0uR2V0T2JqZWN0Q2xhc3MoKSA9PT0gYS5HZXRPYmplY3RDbGFzcygpKSByZXR1cm4gITE7CiAgICAgICAgcmV0dXJuICEwCiAgICB9CiAgICBHZXRBY3Rpb25zKCkgewogICAgICAgIHJldHVybiB0aGlzLl9hY3Rpb25zCiAgICB9CiAgICBHZXRBY3Rpb25Db3VudCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fYWN0aW9ucy5sZW5ndGgKICAgIH0KICAgIEdldEFjdGlvbkF0KGEpIHsKICAgICAgICBhID0KICAgICAgICAgICAgTWF0aC5mbG9vcihhKTsKICAgICAgICBpZiAoMCA+IGEgfHwgYSA+PSB0aGlzLl9hY3Rpb25zLmxlbmd0aCkgdGhyb3cgbmV3IFJhbmdlRXJyb3IoImludmFsaWQgYWN0aW9uIGluZGV4Iik7CiAgICAgICAgcmV0dXJuIHRoaXMuX2FjdGlvbnNbYV0KICAgIH0KICAgIEdldEFjdGlvbkJ5RGVidWdJbmRleChhKSB7CiAgICAgICAgYSA9IE1hdGguZmxvb3IoYSk7CiAgICAgICAgY29uc3QgYiA9IHRoaXMuX2FjdGlvbnMuZmluZChkID0+IGQuR2V0RGVidWdJbmRleCgpID09PSBhKTsKICAgICAgICBpZiAoIWIpIHRocm93IG5ldyBSYW5nZUVycm9yKCJpbnZhbGlkIGFjdGlvbiBkZWJ1ZyBpbmRleCIpOwogICAgICAgIHJldHVybiBiCiAgICB9CiAgICBfSGFzQWN0aW9uSW5kZXgoYSkgewogICAgICAgIGEgPSBNYXRoLmZsb29yKGEpOwogICAgICAgIHJldHVybiAwIDw9IGEgJiYgYSA8IHRoaXMuX2FjdGlvbnMubGVuZ3RoCiAgICB9CiAgICBHZXRTdWJFdmVudHMoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3N1YkV2ZW50cwogICAgfQogICAgX0dldEFsbExvY2FsVmFyaWFibGVzSW5TY29wZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fc3ViRXZlbnRzLmZpbHRlcihhID0+IGEgaW5zdGFuY2VvZiBDMyRqc2NvbXAkMTI5LkV2ZW50VmFyaWFibGUpCiAgICB9CiAgICBSdW5QcmVUcmlnZ2VyKGEpIHsKICAgICAgICBhLlNldEN1cnJlbnRFdmVudCh0aGlzKTsKICAgICAgICBsZXQgYiA9ICExOwogICAgICAgIGNvbnN0IGQgPSB0aGlzLl9jb25kaXRpb25zOwogICAgICAgIGZvciAobGV0IGMgPSAwLCBlID0gZC5sZW5ndGg7IGMgPCBlOyArK2MpIHsKICAgICAgICAgICAgY29uc3QgZyA9IGRbY107CiAgICAgICAgICAgIGEuU2V0Q29uZGl0aW9uSW5kZXgoYyk7CiAgICAgICAgICAgIGlmIChnLklzTG9vcGluZygpKSB0aHJvdyBFcnJvcigidHJpZ2dlciBjYW5ub3QgYmUgdXNlZCBhcyBzdWItZXZlbnQgdG8gYSBsb29wIik7CiAgICAgICAgICAgIGlmIChnLlJ1bigpKSBiID0gITA7CiAgICAgICAgICAgIGVsc2UgaWYgKCF0aGlzLl9pc09yQmxvY2spIHJldHVybiAhMQogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpcy5faXNPckJsb2NrID8gYiA6ICEwCiAgICB9CiAgICBSdW5PckJsb2NrVHJpZ2dlcihhLCBiKSB7CiAgICAgICAgYS5TZXRDdXJyZW50RXZlbnQodGhpcyk7CiAgICAgICAgdGhpcy5fY29uZGl0aW9uc1tiXS5SdW4oKSAmJiAodGhpcy5fUnVuQWN0aW9ucyhhLCAwKSAmJiB0aGlzLl9SdW5TdWJFdmVudHMoYSksIGEuU2V0TGFzdEV2ZW50VHJ1ZSghMCkpCiAgICB9KiBEZWJ1Z1J1blByZVRyaWdnZXIoYSkgewogICAgICAgIGEuU2V0Q3VycmVudEV2ZW50KHRoaXMpOwogICAgICAgIGxldCBiID0gITE7CiAgICAgICAgY29uc3QgZCA9IHRoaXMuX2NvbmRpdGlvbnM7CiAgICAgICAgZm9yIChsZXQgYyA9IDAsIGUgPSBkLmxlbmd0aDsgYyA8CiAgICAgICAgICAgIGU7ICsrYykgewogICAgICAgICAgICBjb25zdCBnID0gZFtjXTsKICAgICAgICAgICAgYS5TZXRDb25kaXRpb25JbmRleChjKTsKICAgICAgICAgICAgaWYgKGcuSXNMb29waW5nKCkpIHRocm93IEVycm9yKCJ0cmlnZ2VyIGNhbm5vdCBiZSB1c2VkIGFzIHN1Yi1ldmVudCB0byBhIGxvb3AiKTsKICAgICAgICAgICAgaWYgKGcuRGVidWdDYW5SdW5GYXN0KCkgPyBnLlJ1bigpIDogeWllbGQqIGcuRGVidWdSdW4oKSkgYiA9ICEwOwogICAgICAgICAgICBlbHNlIGlmICghdGhpcy5faXNPckJsb2NrKSByZXR1cm4gITEKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXMuX2lzT3JCbG9jayA/IGIgOiAhMAogICAgfSogRGVidWdSdW5PckJsb2NrVHJpZ2dlcihhLCBiKSB7CiAgICAgICAgYS5TZXRDdXJyZW50RXZlbnQodGhpcyk7CiAgICAgICAgYiA9IHRoaXMuX2NvbmRpdGlvbnNbYl07CiAgICAgICAgaWYgKGIuRGVidWdDYW5SdW5GYXN0KCkgPyBiLlJ1bigpIDogeWllbGQqIGIuRGVidWdSdW4oKSkodGhpcy5EZWJ1Z0NhblJ1bkFjdGlvbnNGYXN0KCkgPyB0aGlzLl9SdW5BY3Rpb25zKGEsIDApIDogeWllbGQqIHRoaXMuX0RlYnVnUnVuQWN0aW9ucyhhLCAwKSkgJiYgKHRoaXMuRGVidWdDYW5SdW5TdWJFdmVudHNGYXN0KCkgPyB0aGlzLl9SdW5TdWJFdmVudHMoKSA6CiAgICAgICAgICAgIHlpZWxkKiB0aGlzLl9EZWJ1Z1J1blN1YkV2ZW50cygpKSwgYS5TZXRMYXN0RXZlbnRUcnVlKCEwKQogICAgfQogICAgUnVuKGEpIHsKICAgICAgICBhLlNldEN1cnJlbnRFdmVudCh0aGlzKTsKICAgICAgICB0aGlzLl9pc0Vsc2VCbG9jayB8fCBhLlNldEVsc2VCcmFuY2hSYW4oITEpOwogICAgICAgIHRoaXMuX2lzT3JCbG9jayA/IHRoaXMuX1J1bk9yQmxvY2soYSkgOiB0aGlzLl9SdW5BbmRCbG9jayhhKQogICAgfSogRGVidWdSdW4oYSkgewogICAgICAgIGlmICh0aGlzLklzRGVidWdCcmVha3BvaW50KCkgfHwgdGhpcy5fcnVudGltZS5EZWJ1Z0JyZWFrTmV4dCgpKSB5aWVsZCB0aGlzOwogICAgICAgIGEuU2V0Q3VycmVudEV2ZW50KHRoaXMpOwogICAgICAgIHRoaXMuX2lzRWxzZUJsb2NrIHx8IGEuU2V0RWxzZUJyYW5jaFJhbighMSk7CiAgICAgICAgdGhpcy5faXNPckJsb2NrID8geWllbGQqIHRoaXMuX0RlYnVnUnVuT3JCbG9jayhhKTogeWllbGQqIHRoaXMuX0RlYnVnUnVuQW5kQmxvY2soYSkKICAgIH0KICAgIF9SdW5PckJsb2NrKGEpIHsKICAgICAgICBjb25zdCBiID0gdGhpcy5fY29uZGl0aW9uczsKICAgICAgICBsZXQgZCA9IDAgPT09IGIubGVuZ3RoOwogICAgICAgIGZvciAobGV0IGUgPSAwLCBnID0gYi5sZW5ndGg7IGUgPCBnOyArK2UpIHsKICAgICAgICAgICAgdmFyIGMgPQogICAgICAgICAgICAgICAgYltlXTsKICAgICAgICAgICAgYy5Jc1RyaWdnZXIoKSB8fCAoYS5TZXRDb25kaXRpb25JbmRleChlKSwgYyA9IGMuUnVuKCksIGQgPSBkIHx8IGMpCiAgICAgICAgfQogICAgICAgIGEuU2V0TGFzdEV2ZW50VHJ1ZShkKTsKICAgICAgICBkICYmICh0aGlzLl9SdW5BY3Rpb25zKGEsIDApICYmIHRoaXMuX1J1blN1YkV2ZW50cyhhKSwgdGhpcy5faGFzRWxzZUJsb2NrICYmIGEuU2V0RWxzZUJyYW5jaFJhbighMCkpCiAgICB9KiBfRGVidWdSdW5PckJsb2NrKGEpIHsKICAgICAgICBjb25zdCBiID0gdGhpcy5fY29uZGl0aW9uczsKICAgICAgICBsZXQgZCA9IDAgPT09IGIubGVuZ3RoOwogICAgICAgIGZvciAobGV0IGUgPSAwLCBnID0gYi5sZW5ndGg7IGUgPCBnOyArK2UpIHsKICAgICAgICAgICAgdmFyIGMgPSBiW2VdOwogICAgICAgICAgICBjLklzVHJpZ2dlcigpIHx8IChhLlNldENvbmRpdGlvbkluZGV4KGUpLCBjID0gYy5EZWJ1Z0NhblJ1bkZhc3QoKSA/IGMuUnVuKCkgOiB5aWVsZCogYy5EZWJ1Z1J1bigpLCBkID0gZCB8fCBjKQogICAgICAgIH0KICAgICAgICBhLlNldExhc3RFdmVudFRydWUoZCk7CiAgICAgICAgZCAmJiAoKHRoaXMuRGVidWdDYW5SdW5BY3Rpb25zRmFzdCgpID8gdGhpcy5fUnVuQWN0aW9ucyhhLCAwKSA6IHlpZWxkKiB0aGlzLl9EZWJ1Z1J1bkFjdGlvbnMoYSwgMCkpICYmICh0aGlzLkRlYnVnQ2FuUnVuU3ViRXZlbnRzRmFzdCgpID8KICAgICAgICAgICAgdGhpcy5fUnVuU3ViRXZlbnRzKCkgOiB5aWVsZCogdGhpcy5fRGVidWdSdW5TdWJFdmVudHMoKSksIHRoaXMuX2hhc0Vsc2VCbG9jayAmJiBhLlNldEVsc2VCcmFuY2hSYW4oITApKQogICAgfQogICAgX1J1bkFuZEJsb2NrKGEpIHsKICAgICAgICBjb25zdCBiID0gdGhpcy5fY29uZGl0aW9uczsKICAgICAgICBmb3IgKGxldCBkID0gMCwgYyA9IGIubGVuZ3RoOyBkIDwgYzsgKytkKSB7CiAgICAgICAgICAgIGNvbnN0IGUgPSBiW2RdOwogICAgICAgICAgICBhLlNldENvbmRpdGlvbkluZGV4KGQpOwogICAgICAgICAgICBpZiAoIWUuUnVuKCkpIHsKICAgICAgICAgICAgICAgIGEuU2V0TGFzdEV2ZW50VHJ1ZSghMSk7CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBhLlNldExhc3RFdmVudFRydWUoITApOwogICAgICAgIHRoaXMuX1J1bkFjdGlvbnMoYSwgMCkgJiYgdGhpcy5fUnVuU3ViRXZlbnRzKGEpOwogICAgICAgIGEuR2V0TGFzdEV2ZW50VHJ1ZSgpICYmIHRoaXMuX2hhc0Vsc2VCbG9jayAmJiBhLlNldEVsc2VCcmFuY2hSYW4oITApCiAgICB9KiBfRGVidWdSdW5BbmRCbG9jayhhKSB7CiAgICAgICAgY29uc3QgYiA9IHRoaXMuX2NvbmRpdGlvbnM7CiAgICAgICAgZm9yIChsZXQgZCA9IDAsIGMgPSBiLmxlbmd0aDsgZCA8IGM7ICsrZCkgewogICAgICAgICAgICBjb25zdCBlID0gYltkXTsKICAgICAgICAgICAgYS5TZXRDb25kaXRpb25JbmRleChkKTsKICAgICAgICAgICAgaWYgKGUuRGVidWdDYW5SdW5GYXN0KCkgPwogICAgICAgICAgICAgICAgIWUuUnVuKCkgOiAhKHlpZWxkKiBlLkRlYnVnUnVuKCkpKSB7CiAgICAgICAgICAgICAgICBhLlNldExhc3RFdmVudFRydWUoITEpOwogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgYS5TZXRMYXN0RXZlbnRUcnVlKCEwKTsKICAgICAgICAodGhpcy5EZWJ1Z0NhblJ1bkFjdGlvbnNGYXN0KCkgPyB0aGlzLl9SdW5BY3Rpb25zKGEsIDApIDogeWllbGQqIHRoaXMuX0RlYnVnUnVuQWN0aW9ucyhhLCAwKSkgJiYgKHRoaXMuRGVidWdDYW5SdW5TdWJFdmVudHNGYXN0KCkgPyB0aGlzLl9SdW5TdWJFdmVudHMoKSA6IHlpZWxkKiB0aGlzLl9EZWJ1Z1J1blN1YkV2ZW50cygpKTsKICAgICAgICBhLkdldExhc3RFdmVudFRydWUoKSAmJiB0aGlzLl9oYXNFbHNlQmxvY2sgJiYgYS5TZXRFbHNlQnJhbmNoUmFuKCEwKQogICAgfQogICAgX1J1bkFjdGlvbnNfRmFzdChhLCBiKSB7CiAgICAgICAgY29uc3QgZCA9IHRoaXMuX2FjdGlvbnM7CiAgICAgICAgZm9yIChsZXQgYyA9IGIsIGUgPSBkLmxlbmd0aDsgYyA8IGU7ICsrYykgYiA9IGRbY10sIGEuU2V0QWN0aW9uSW5kZXgoYyksIGIuUnVuKCk7CiAgICAgICAgcmV0dXJuICEwCiAgICB9KiBfRGVidWdSdW5BY3Rpb25zX0Zhc3QoYSwgYikgewogICAgICAgIGNvbnN0IGQgPSB0aGlzLl9hY3Rpb25zOwogICAgICAgIGZvciAobGV0IGMgPQogICAgICAgICAgICAgICAgYiwgZSA9IGQubGVuZ3RoOyBjIDwgZTsgKytjKSBiID0gZFtjXSwgYS5TZXRBY3Rpb25JbmRleChjKSwgYi5EZWJ1Z0NhblJ1bkZhc3QoKSA/IGIuUnVuKCkgOiB5aWVsZCogYi5EZWJ1Z1J1bigpOwogICAgICAgIHJldHVybiAhMAogICAgfQogICAgX1J1bkFjdGlvbnNfUmV0dXJuVmFsdWUoYSwgYikgewogICAgICAgIGNvbnN0IGQgPSB0aGlzLkdldEV2ZW50U2hlZXRNYW5hZ2VyKCksCiAgICAgICAgICAgIGMgPSB0aGlzLl9hY3Rpb25zOwogICAgICAgIGZvciAobGV0IGUgPSBiLCBnID0gYy5sZW5ndGg7IGUgPCBnOyArK2UpIHsKICAgICAgICAgICAgYiA9IGNbZV07CiAgICAgICAgICAgIGEuU2V0QWN0aW9uSW5kZXgoZSk7CiAgICAgICAgICAgIGNvbnN0IGsgPSBiLlJ1bigpOwogICAgICAgICAgICBpZiAoYi5DYW5CYWlsT3V0KCkgJiYgITAgPT09IGspIHJldHVybiAhMTsKICAgICAgICAgICAgYi5Jc0FzeW5jKCkgJiYgayBpbnN0YW5jZW9mIFByb21pc2UgJiYgZC5BZGRBc3luY0FjdGlvblByb21pc2UoaykKICAgICAgICB9CiAgICAgICAgcmV0dXJuICEwCiAgICB9KiBfRGVidWdSdW5BY3Rpb25zX1JldHVyblZhbHVlKGEsIGIpIHsKICAgICAgICBjb25zdCBkID0gdGhpcy5HZXRFdmVudFNoZWV0TWFuYWdlcigpLAogICAgICAgICAgICBjID0gdGhpcy5fYWN0aW9uczsKICAgICAgICBmb3IgKGxldCBlID0gYiwgZyA9IGMubGVuZ3RoOyBlIDwgZzsgKytlKSB7CiAgICAgICAgICAgIGIgPSBjW2VdOwogICAgICAgICAgICBhLlNldEFjdGlvbkluZGV4KGUpOwogICAgICAgICAgICBsZXQgazsKICAgICAgICAgICAgayA9IGIuRGVidWdDYW5SdW5GYXN0KCkgPyBiLlJ1bigpIDogeWllbGQqIGIuRGVidWdSdW4oKTsKICAgICAgICAgICAgaWYgKGIuQ2FuQmFpbE91dCgpICYmICEwID09PSBrKSByZXR1cm4gITE7CiAgICAgICAgICAgIGIuSXNBc3luYygpICYmIGsgaW5zdGFuY2VvZiBQcm9taXNlICYmIGQuQWRkQXN5bmNBY3Rpb25Qcm9taXNlKGspCiAgICAgICAgfQogICAgICAgIHJldHVybiAhMAogICAgfQogICAgX1Jlc3VtZUFjdGlvbnNBbmRTdWJFdmVudHMoYSkgewogICAgICAgIHRoaXMuX1J1bkFjdGlvbnMoYSwgYS5HZXRBY3Rpb25JbmRleCgpKSAmJiB0aGlzLl9SdW5TdWJFdmVudHMoKQogICAgfSogX0RlYnVnUmVzdW1lQWN0aW9uc0FuZFN1YkV2ZW50cyhhKSB7CiAgICAgICAgaWYgKHlpZWxkKiB0aGlzLl9EZWJ1Z1J1bkFjdGlvbnMoYSwgYS5HZXRBY3Rpb25JbmRleCgpKSkgeWllbGQqIHRoaXMuX0RlYnVnUnVuU3ViRXZlbnRzKCkKICAgIH0KICAgIF9SdW5TdWJFdmVudHMoKSB7CiAgICAgICAgaWYgKHRoaXMuX3N1YkV2ZW50cy5sZW5ndGgpIHsKICAgICAgICAgICAgdmFyIGEgPSB0aGlzLklzR3JvdXAoKSAmJiB0aGlzLl9ydW50aW1lLklzQ1BVUHJvZmlsaW5nKCksCiAgICAgICAgICAgICAgICBiID0gYSA/IHBlcmZvcm1hbmNlLm5vdygpIDogMCwKICAgICAgICAgICAgICAgIGQgPSB0aGlzLl9ldmVudFN0YWNrLAogICAgICAgICAgICAgICAgYyA9IGQuUHVzaCh0aGlzKTsKICAgICAgICAgICAgdGhpcy5faXNTb2xXcml0ZXJBZnRlckNuZHMgPyB0aGlzLl9SdW5TdWJFdmVudHNfU29sV3JpdGVyQWZ0ZXJDbmRzKGMpIDogdGhpcy5fUnVuU3ViRXZlbnRzX0Zhc3QoYyk7CiAgICAgICAgICAgIGQuUG9wKCk7CiAgICAgICAgICAgIGEgJiYgKHRoaXMuX3BlcmZSZWNvcmQudG90YWxUaW1lQ291bnRlciArPSBwZXJmb3JtYW5jZS5ub3coKSAtIGIpCiAgICAgICAgfQogICAgfQogICAgX1J1blN1YkV2ZW50c19Tb2xXcml0ZXJBZnRlckNuZHMoYSkgewogICAgICAgIGNvbnN0IGIgPSB0aGlzLl9pc0dyb3VwLAogICAgICAgICAgICBkID0gdGhpcy5faXNUb3BMZXZlbEdyb3VwLAogICAgICAgICAgICBjID0gdGhpcy5HZXRFdmVudFNoZWV0TWFuYWdlcigpLAogICAgICAgICAgICBlID0gdGhpcy5fc3ViRXZlbnRzOwogICAgICAgIGZvciAobGV0IGcgPSAwLCBrID0gZS5sZW5ndGgsIG0gPSBrIC0gMTsgZyA8IGs7ICsrZykgewogICAgICAgICAgICBjb25zdCBuID0gZVtnXSwKICAgICAgICAgICAgICAgIHEgPSBuLkdldFNvbE1vZGlmaWVycygpLAogICAgICAgICAgICAgICAgdSA9ICFkIHx8ICFiICYmIGcgPCBtOwogICAgICAgICAgICB1ICYmIGMuUHVzaENvcHlTb2wocSk7CiAgICAgICAgICAgIG4uUnVuKGEpOwogICAgICAgICAgICB1ID8gYy5Qb3BTb2wocSkgOiBjLkNsZWFyU29sKHEpCiAgICAgICAgfQogICAgfQogICAgX1J1blN1YkV2ZW50c19GYXN0KGEpIHsKICAgICAgICBjb25zdCBiID0gdGhpcy5fc3ViRXZlbnRzOwogICAgICAgIGZvciAobGV0IGQgPQogICAgICAgICAgICAgICAgMCwgYyA9IGIubGVuZ3RoOyBkIDwgYzsgKytkKSBiW2RdLlJ1bihhKQogICAgfSogX0RlYnVnUnVuU3ViRXZlbnRzKCkgewogICAgICAgIGlmICh0aGlzLl9zdWJFdmVudHMubGVuZ3RoKSB7CiAgICAgICAgICAgIHZhciBhID0gdGhpcy5fZXZlbnRTdGFjaywKICAgICAgICAgICAgICAgIGIgPSBhLlB1c2godGhpcyk7CiAgICAgICAgICAgIHRoaXMuX2lzU29sV3JpdGVyQWZ0ZXJDbmRzID8geWllbGQqIHRoaXMuX0RlYnVnUnVuU3ViRXZlbnRzX1NvbFdyaXRlckFmdGVyQ25kcyhiKTogeWllbGQqIHRoaXMuX0RlYnVnUnVuU3ViRXZlbnRzX0Zhc3QoYik7CiAgICAgICAgICAgIGEuUG9wKCkKICAgICAgICB9CiAgICB9KiBfRGVidWdSdW5TdWJFdmVudHNfU29sV3JpdGVyQWZ0ZXJDbmRzKGEpIHsKICAgICAgICBjb25zdCBiID0gdGhpcy5faXNHcm91cCwKICAgICAgICAgICAgZCA9IHRoaXMuX2lzVG9wTGV2ZWxHcm91cCwKICAgICAgICAgICAgYyA9IHRoaXMuR2V0RXZlbnRTaGVldE1hbmFnZXIoKSwKICAgICAgICAgICAgZSA9IHRoaXMuX3N1YkV2ZW50czsKICAgICAgICBmb3IgKGxldCBnID0gMCwgayA9IGUubGVuZ3RoLCBtID0gayAtIDE7IGcgPCBrOyArK2cpIHsKICAgICAgICAgICAgY29uc3QgbiA9IGVbZ10sCiAgICAgICAgICAgICAgICBxID0gbi5HZXRTb2xNb2RpZmllcnMoKSwKICAgICAgICAgICAgICAgIHUgPSAhZCB8fCAhYiAmJiBnIDwgbTsKICAgICAgICAgICAgdSAmJiBjLlB1c2hDb3B5U29sKHEpOwogICAgICAgICAgICB5aWVsZCogbi5EZWJ1Z1J1bihhKTsKICAgICAgICAgICAgdSA/IGMuUG9wU29sKHEpIDogYy5DbGVhclNvbChxKQogICAgICAgIH0KICAgIH0qIF9EZWJ1Z1J1blN1YkV2ZW50c19GYXN0KGEpIHsKICAgICAgICBjb25zdCBiID0gdGhpcy5fc3ViRXZlbnRzOwogICAgICAgIGZvciAobGV0IGQgPSAwLCBjID0gYi5sZW5ndGg7IGQgPCBjOyArK2QpIHlpZWxkKiBiW2RdLkRlYnVnUnVuKGEpCiAgICB9CiAgICBSZXRyaWdnZXIoYSwgYikgewogICAgICAgIGIuUmVzZXRRdWljaygpOwogICAgICAgIGNvbnN0IGQgPSB0aGlzLl9jb25kaXRpb25zOwogICAgICAgIGlmICghdGhpcy5Jc09yQmxvY2soKSkKICAgICAgICAgICAgZm9yIChsZXQgYyA9IGEuR2V0Q29uZGl0aW9uSW5kZXgoKSArIDEsIGUgPSBkLmxlbmd0aDsgYyA8IGU7ICsrYykKICAgICAgICAgICAgICAgIGlmIChhID0gZFtjXSwgYi5TZXRDb25kaXRpb25JbmRleChjKSwgIWEuUnVuKCkpIHJldHVybiAhMTsKICAgICAgICB0aGlzLl9SdW5BY3Rpb25zKGIsIDApICYmIHRoaXMuX1J1blN1YkV2ZW50cyhiKTsKICAgICAgICByZXR1cm4gITAKICAgIH0qIERlYnVnUmV0cmlnZ2VyKGEsIGIpIHsKICAgICAgICBiLlJlc2V0UXVpY2soKTsKICAgICAgICBjb25zdCBkID0gdGhpcy5fY29uZGl0aW9uczsKICAgICAgICBpZiAoIXRoaXMuSXNPckJsb2NrKCkpCiAgICAgICAgICAgIGZvciAobGV0IGMgPSBhLkdldENvbmRpdGlvbkluZGV4KCkgKyAxLCBlID0gZC5sZW5ndGg7IGMgPCBlOyArK2MpCiAgICAgICAgICAgICAgICBpZiAoYSA9CiAgICAgICAgICAgICAgICAgICAgZFtjXSwgYi5TZXRDb25kaXRpb25JbmRleChjKSwgYS5EZWJ1Z0NhblJ1bkZhc3QoKSA/ICFhLlJ1bigpIDogISh5aWVsZCogYS5EZWJ1Z1J1bigpKSkgcmV0dXJuICExOwogICAgICAgICh0aGlzLkRlYnVnQ2FuUnVuQWN0aW9uc0Zhc3QoKSA/IHRoaXMuX1J1bkFjdGlvbnMoYiwgMCkgOiB5aWVsZCogdGhpcy5fRGVidWdSdW5BY3Rpb25zKGIsIDApKSAmJiAodGhpcy5EZWJ1Z0NhblJ1blN1YkV2ZW50c0Zhc3QoKSA/IHRoaXMuX1J1blN1YkV2ZW50cygpIDogeWllbGQqIHRoaXMuX0RlYnVnUnVuU3ViRXZlbnRzKCkpOwogICAgICAgIHJldHVybiAhMAogICAgfQogICAgRGVidWdDYW5SdW5GYXN0KCkgewogICAgICAgIHJldHVybiAhdGhpcy5Jc0RlYnVnQnJlYWtwb2ludCgpICYmICF0aGlzLl9ydW50aW1lLkRlYnVnQnJlYWtOZXh0KCkgJiYgdGhpcy5fZGVidWdEYXRhLmNhblJ1blNlbGZGYXN0CiAgICB9CiAgICBEZWJ1Z0NhblJ1bkFjdGlvbnNGYXN0KCkgewogICAgICAgIHJldHVybiAhdGhpcy5fcnVudGltZS5EZWJ1Z0JyZWFrTmV4dCgpICYmIHRoaXMuX2RlYnVnRGF0YS5jYW5SdW5BbGxBY3Rpb25zRmFzdAogICAgfQogICAgRGVidWdDYW5SdW5TdWJFdmVudHNGYXN0KCkgewogICAgICAgIHJldHVybiAhdGhpcy5fcnVudGltZS5EZWJ1Z0JyZWFrTmV4dCgpICYmCiAgICAgICAgICAgIHRoaXMuX2RlYnVnRGF0YS5jYW5SdW5BbGxTdWJFdmVudHNGYXN0CiAgICB9CiAgICBfQ2hlY2tQYXJlbnRzT0tUb1J1bihhKSB7CiAgICAgICAgaWYgKHRoaXMuR2V0UGFyZW50KCkpIHsKICAgICAgICAgICAgY29uc3QgYiA9IHRoaXMuR2V0VHJpZ2dlclBhcmVudHMoKTsKICAgICAgICAgICAgZm9yIChsZXQgZCA9IDAsIGMgPSBiLmxlbmd0aDsgZCA8IGM7ICsrZCkKICAgICAgICAgICAgICAgIGlmICghYltkXS5SdW5QcmVUcmlnZ2VyKGEpKSByZXR1cm4gITEKICAgICAgICB9CiAgICAgICAgcmV0dXJuICEwCiAgICB9KiBfRGVidWdDaGVja1BhcmVudHNPS1RvUnVuKGEpIHsKICAgICAgICBpZiAodGhpcy5HZXRQYXJlbnQoKSkgewogICAgICAgICAgICBjb25zdCBiID0gdGhpcy5HZXRUcmlnZ2VyUGFyZW50cygpOwogICAgICAgICAgICBmb3IgKGxldCBkID0gMCwgYyA9IGIubGVuZ3RoOyBkIDwgYzsgKytkKQogICAgICAgICAgICAgICAgaWYgKCEoeWllbGQqIGJbZF0uRGVidWdSdW5QcmVUcmlnZ2VyKGEpKSkgcmV0dXJuICExCiAgICAgICAgfQogICAgICAgIHJldHVybiAhMAogICAgfQogICAgX0V2YWx1YXRlRnVuY3Rpb25DYWxsUGFyYW1ldGVycyhhLCBiLCBkKSB7CiAgICAgICAgMCA8IGIubGVuZ3RoID8gZCA/IChiID0gYi5tYXAoYyA9PiBjLkdldCgwKSksIGEuR2V0TG9jYWxWYXJTdGFjaygpLlB1c2goKSwgdGhpcy5fc2NvcGVQYXJlbnQuU2V0RnVuY3Rpb25QYXJhbWV0ZXJzKGIpKSA6CiAgICAgICAgICAgIHRoaXMuX3Njb3BlUGFyZW50LkV2YWx1YXRlRnVuY3Rpb25QYXJhbWV0ZXJzKGIpIDogZCAmJiBhLkdldExvY2FsVmFyU3RhY2soKS5QdXNoKCkKICAgIH0KICAgIFJ1bkFzRnVuY3Rpb25DYWxsKGEsIGIsIGQpIHsKICAgICAgICBsZXQgYywgZTsKICAgICAgICBjb25zdCBnID0gMCA8IGEubGVuZ3RoLAogICAgICAgICAgICBrID0gdGhpcy5fZXZlbnRTdGFjaywKICAgICAgICAgICAgbSA9IHRoaXMuX3J1bnRpbWUuR2V0RXZlbnRTaGVldE1hbmFnZXIoKSwKICAgICAgICAgICAgbiA9IDEgPCBtLl9JbmNUcmlnZ2VyRGVwdGgoKTsKICAgICAgICB0aGlzLl9FdmFsdWF0ZUZ1bmN0aW9uQ2FsbFBhcmFtZXRlcnMobSwgYiwgbik7CiAgICAgICAgZyAmJiAoZCA/IG0uUHVzaENvcHlTb2woYSkgOiBtLlB1c2hDbGVhblNvbChhKSk7CiAgICAgICAgYiA9IGsuUHVzaCh0aGlzKTsKICAgICAgICB0aGlzLl9DaGVja1BhcmVudHNPS1RvUnVuKGIpICYmIChiLlNldEN1cnJlbnRFdmVudCh0aGlzKSwgKGQgPSB0aGlzLl9zY29wZVBhcmVudC5Jc0FzeW5jKCkpICYmIChbZSwgY10gPSB0aGlzLl9zY29wZVBhcmVudC5TdGFydEFzeW5jRnVuY3Rpb25DYWxsKCkpLCB0aGlzLl9SdW5BbmRCbG9jayhiKSwgZCAmJiB0aGlzLl9zY29wZVBhcmVudC5NYXliZUZpbmlzaEFzeW5jRnVuY3Rpb25DYWxsKGUpKTsKICAgICAgICBrLlBvcCgpOwogICAgICAgIG4gJiYgbS5HZXRMb2NhbFZhclN0YWNrKCkuUG9wKCk7CiAgICAgICAgZyAmJiBtLlBvcFNvbChhKTsKICAgICAgICBtLl9EZWNUcmlnZ2VyRGVwdGgoKTsKICAgICAgICByZXR1cm4gYwogICAgfSogRGVidWdSdW5Bc0Z1bmN0aW9uQ2FsbChhLCBiLCBkKSB7CiAgICAgICAgbGV0IGMsIGU7CiAgICAgICAgaWYgKHRoaXMuSXNEZWJ1Z0JyZWFrcG9pbnQoKSB8fCB0aGlzLl9ydW50aW1lLkRlYnVnQnJlYWtOZXh0KCkpIHlpZWxkIHRoaXM7CiAgICAgICAgY29uc3QgZyA9IDAgPCBhLmxlbmd0aCwKICAgICAgICAgICAgayA9IHRoaXMuX2V2ZW50U3RhY2ssCiAgICAgICAgICAgIG0gPSB0aGlzLl9ydW50aW1lLkdldEV2ZW50U2hlZXRNYW5hZ2VyKCksCiAgICAgICAgICAgIG4gPSAxIDwgbS5fSW5jVHJpZ2dlckRlcHRoKCk7CiAgICAgICAgdGhpcy5fRXZhbHVhdGVGdW5jdGlvbkNhbGxQYXJhbWV0ZXJzKG0sIGIsIG4pOwogICAgICAgIGcgJiYgKGQgPyBtLlB1c2hDb3B5U29sKGEpIDogbS5QdXNoQ2xlYW5Tb2woYSkpOwogICAgICAgIGIgPSBrLlB1c2godGhpcyk7CiAgICAgICAgaWYgKHlpZWxkKiB0aGlzLl9EZWJ1Z0NoZWNrUGFyZW50c09LVG9SdW4oYikpIGIuU2V0Q3VycmVudEV2ZW50KHRoaXMpLCAoZCA9IHRoaXMuX3Njb3BlUGFyZW50LklzQXN5bmMoKSkgJiYgKFtlLCBjXSA9CiAgICAgICAgICAgIHRoaXMuX3Njb3BlUGFyZW50LlN0YXJ0QXN5bmNGdW5jdGlvbkNhbGwoKSksIHlpZWxkKiB0aGlzLl9EZWJ1Z1J1bkFuZEJsb2NrKGIpLCBkICYmIHRoaXMuX3Njb3BlUGFyZW50Lk1heWJlRmluaXNoQXN5bmNGdW5jdGlvbkNhbGwoZSk7CiAgICAgICAgay5Qb3AoKTsKICAgICAgICBuICYmIG0uR2V0TG9jYWxWYXJTdGFjaygpLlBvcCgpOwogICAgICAgIGcgJiYgbS5Qb3BTb2woYSk7CiAgICAgICAgbS5fRGVjVHJpZ2dlckRlcHRoKCk7CiAgICAgICAgcmV0dXJuIGMKICAgIH0KICAgIFJ1bkFzTWFwcGVkRnVuY3Rpb25DYWxsKGEsIGIpIHsKICAgICAgICBjb25zdCBkID0gdGhpcy5HZXRTb2xNb2RpZmllcnNJbmNsdWRpbmdQYXJlbnRzKCksCiAgICAgICAgICAgIGMgPSAwIDwgZC5sZW5ndGgsCiAgICAgICAgICAgIGUgPSB0aGlzLl9ldmVudFN0YWNrLAogICAgICAgICAgICBnID0gdGhpcy5fcnVudGltZS5HZXRFdmVudFNoZWV0TWFuYWdlcigpLAogICAgICAgICAgICBrID0gMSA8IGcuX0luY1RyaWdnZXJEZXB0aCgpOwogICAgICAgIGsgJiYgZy5HZXRMb2NhbFZhclN0YWNrKCkuUHVzaCgpOwogICAgICAgIHRoaXMuX3Njb3BlUGFyZW50LlNldEZ1bmN0aW9uUGFyYW1ldGVycyhhKTsKICAgICAgICBjICYmIChiID8gZy5QdXNoQ29weVNvbChkKSA6IGcuUHVzaENsZWFuU29sKGQpKTsKICAgICAgICBhID0KICAgICAgICAgICAgZS5QdXNoKHRoaXMpOwogICAgICAgIHRoaXMuX0NoZWNrUGFyZW50c09LVG9SdW4oYSkgJiYgKGEuU2V0Q3VycmVudEV2ZW50KHRoaXMpLCB0aGlzLl9SdW5BbmRCbG9jayhhKSk7CiAgICAgICAgZS5Qb3AoKTsKICAgICAgICBrICYmIGcuR2V0TG9jYWxWYXJTdGFjaygpLlBvcCgpOwogICAgICAgIGMgJiYgZy5Qb3BTb2woZCk7CiAgICAgICAgZy5fRGVjVHJpZ2dlckRlcHRoKCkKICAgIH0qIERlYnVnUnVuQXNNYXBwZWRGdW5jdGlvbkNhbGwoYSwgYikgewogICAgICAgIGlmICh0aGlzLklzRGVidWdCcmVha3BvaW50KCkgfHwgdGhpcy5fcnVudGltZS5EZWJ1Z0JyZWFrTmV4dCgpKSB5aWVsZCB0aGlzOwogICAgICAgIGNvbnN0IGQgPSB0aGlzLkdldFNvbE1vZGlmaWVyc0luY2x1ZGluZ1BhcmVudHMoKSwKICAgICAgICAgICAgYyA9IDAgPCBkLmxlbmd0aCwKICAgICAgICAgICAgZSA9IHRoaXMuX2V2ZW50U3RhY2ssCiAgICAgICAgICAgIGcgPSB0aGlzLl9ydW50aW1lLkdldEV2ZW50U2hlZXRNYW5hZ2VyKCksCiAgICAgICAgICAgIGsgPSAxIDwgZy5fSW5jVHJpZ2dlckRlcHRoKCk7CiAgICAgICAgayAmJiBnLkdldExvY2FsVmFyU3RhY2soKS5QdXNoKCk7CiAgICAgICAgdGhpcy5fc2NvcGVQYXJlbnQuU2V0RnVuY3Rpb25QYXJhbWV0ZXJzKGEpOwogICAgICAgIGMgJiYgKGIgPyBnLlB1c2hDb3B5U29sKGQpIDoKICAgICAgICAgICAgZy5QdXNoQ2xlYW5Tb2woZCkpOwogICAgICAgIGEgPSBlLlB1c2godGhpcyk7CiAgICAgICAgaWYgKHlpZWxkKiB0aGlzLl9EZWJ1Z0NoZWNrUGFyZW50c09LVG9SdW4oYSkpIGEuU2V0Q3VycmVudEV2ZW50KHRoaXMpLCB5aWVsZCogdGhpcy5fRGVidWdSdW5BbmRCbG9jayhhKTsKICAgICAgICBlLlBvcCgpOwogICAgICAgIGsgJiYgZy5HZXRMb2NhbFZhclN0YWNrKCkuUG9wKCk7CiAgICAgICAgYyAmJiBnLlBvcFNvbChkKTsKICAgICAgICBnLl9EZWNUcmlnZ2VyRGVwdGgoKQogICAgfQogICAgUnVuQXNFeHByZXNzaW9uRnVuY3Rpb25DYWxsKGEsIGIsIGQsIGMsIC4uLmUpIHsKICAgICAgICBsZXQgZywgazsKICAgICAgICBjb25zdCBtID0gMCA8IGEubGVuZ3RoLAogICAgICAgICAgICBuID0gdGhpcy5fcnVudGltZSwKICAgICAgICAgICAgcSA9IHRoaXMuX2V2ZW50U3RhY2ssCiAgICAgICAgICAgIHUgPSBuLkdldEV2ZW50U2hlZXRNYW5hZ2VyKCksCiAgICAgICAgICAgIHcgPSAxIDwgdS5fSW5jVHJpZ2dlckRlcHRoKCk7CiAgICAgICAgdyAmJiB1LkdldExvY2FsVmFyU3RhY2soKS5QdXNoKCk7CiAgICAgICAgMCA8IGUubGVuZ3RoICYmIHRoaXMuX3Njb3BlUGFyZW50LlNldEZ1bmN0aW9uUGFyYW1ldGVycyhlKTsKICAgICAgICBtICYmIChiID8gdS5QdXNoQ29weVNvbChhKSA6IHUuUHVzaENsZWFuU29sKGEpKTsKICAgICAgICBiID0gcS5QdXNoKHRoaXMpOwogICAgICAgIGIuSW5pdENhbGxGdW5jdGlvbkV4cHJlc3Npb24oZCwgYyk7CiAgICAgICAgcS5QdXNoRXhwRnVuYyhiKTsKICAgICAgICBuLlNldERlYnVnZ2luZ0VuYWJsZWQoITEpOwogICAgICAgIHRoaXMuX0NoZWNrUGFyZW50c09LVG9SdW4oYikgJiYgKGIuU2V0Q3VycmVudEV2ZW50KHRoaXMpLCAoZCA9IHRoaXMuX3Njb3BlUGFyZW50LklzQXN5bmMoKSkgJiYgKFtrLCBnXSA9IHRoaXMuX3Njb3BlUGFyZW50LlN0YXJ0QXN5bmNGdW5jdGlvbkNhbGwoKSksIHRoaXMuX1J1bkFuZEJsb2NrKGIpLCBkICYmIHRoaXMuX3Njb3BlUGFyZW50Lk1heWJlRmluaXNoQXN5bmNGdW5jdGlvbkNhbGwoaykpOwogICAgICAgIG4uU2V0RGVidWdnaW5nRW5hYmxlZCghMCk7CiAgICAgICAgcS5Qb3AoKTsKICAgICAgICBxLlBvcEV4cEZ1bmMoKTsKICAgICAgICB3ICYmIHUuR2V0TG9jYWxWYXJTdGFjaygpLlBvcCgpOwogICAgICAgIG0gJiYgdS5Qb3BTb2woYSk7CiAgICAgICAgdS5fRGVjVHJpZ2dlckRlcHRoKCk7CiAgICAgICAgcmV0dXJuIGcgfHwgYi5HZXRGdW5jdGlvblJldHVyblZhbHVlKCkKICAgIH0KfTsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkMTMwID0gc2VsZi5DMywKICAgIEVNUFRZX1NPTF9NT0RJRklFUlMgPSBbXTsKbGV0IGhhZFVzZXJTY3JpcHRFeGNlcHRpb24gPSAhMTsKQzMkanNjb21wJDEzMC5FdmVudFNjcmlwdCA9IGNsYXNzIGV4dGVuZHMgQzMkanNjb21wJDEzMC5EZWZlbmRlZEJhc2UgewogICAgY29uc3RydWN0b3IoYSwgYiwgZCkgewogICAgICAgIHN1cGVyKCk7CiAgICAgICAgY29uc3QgYyA9IGEuR2V0UnVudGltZSgpLAogICAgICAgICAgICBlID0gYS5HZXRFdmVudFNoZWV0TWFuYWdlcigpOwogICAgICAgIHRoaXMuX2V2ZW50U2hlZXQgPSBhOwogICAgICAgIHRoaXMuX2V2ZW50U2hlZXRNYW5hZ2VyID0gZTsKICAgICAgICB0aGlzLl9ydW50aW1lID0gYS5HZXRSdW50aW1lKCk7CiAgICAgICAgdGhpcy5fcGFyZW50ID0gYjsKICAgICAgICB0aGlzLl9mdW5jID0gYy5HZXRPYmplY3RSZWZlcmVuY2UoZFsxXSk7CiAgICAgICAgdGhpcy5fZGlzcGxheU51bWJlciA9IGRbMl07CiAgICAgICAgdGhpcy5fZXZlbnRTaGVldC5fUmVnaXN0ZXJFdmVudEJ5RGlzcGxheU51bWJlcih0aGlzLCB0aGlzLl9kaXNwbGF5TnVtYmVyKTsKICAgICAgICB0aGlzLl9kZWJ1Z0RhdGEgPSBjLklzRGVidWcoKSA/IHsKICAgICAgICAgICAgaXNCcmVha3BvaW50OiBkWzNdWzBdLAogICAgICAgICAgICBpc0JyZWFrYWJsZTogZFszXVsxXQogICAgICAgIH0gOiBudWxsCiAgICB9CiAgICBzdGF0aWMgQ3JlYXRlKGEsIGIsIGQpIHsKICAgICAgICByZXR1cm4gQzMkanNjb21wJDEzMC5OZXcoQzMkanNjb21wJDEzMC5FdmVudFNjcmlwdCwKICAgICAgICAgICAgYSwgYiwgZCkKICAgIH0KICAgIF9Qb3N0SW5pdCgpIHsKICAgICAgICBjb25zdCBhID0gdGhpcy5fZnVuYywKICAgICAgICAgICAgYiA9IHRoaXMuX3J1bnRpbWUuR2V0RXZlbnRTaGVldE1hbmFnZXIoKS5fR2V0TG9jYWxWYXJpYWJsZXNTY3JpcHRJbnRlcmZhY2UodGhpcyk7CiAgICAgICAgdGhpcy5fZnVuYyA9IGEuYmluZChudWxsLCB0aGlzLl9ydW50aW1lLkdldElSdW50aW1lKCksIGIpCiAgICB9CiAgICBHZXRQYXJlbnQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3BhcmVudAogICAgfQogICAgR2V0U2NvcGVQYXJlbnQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3BhcmVudAogICAgfQogICAgR2V0RXZlbnRTaGVldCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZXZlbnRTaGVldAogICAgfQogICAgR2V0RGlzcGxheU51bWJlcigpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZGlzcGxheU51bWJlcgogICAgfQogICAgSXNEZWJ1Z0JyZWFrYWJsZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZGVidWdEYXRhICYmIHRoaXMuX2RlYnVnRGF0YS5pc0JyZWFrYWJsZQogICAgfQogICAgSXNEZWJ1Z0JyZWFrcG9pbnQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuSXNEZWJ1Z0JyZWFrYWJsZSgpICYmIHRoaXMuX2RlYnVnRGF0YS5pc0JyZWFrcG9pbnQKICAgIH0KICAgIF9TZXREZWJ1Z0JyZWFrcG9pbnQoYSkgewogICAgICAgIHRoaXMuX2RlYnVnRGF0YS5pc0JyZWFrcG9pbnQgPSAhIWEKICAgIH0KICAgIElzRWxzZUJsb2NrKCkgewogICAgICAgIHJldHVybiAhMQogICAgfQogICAgR2V0U29sTW9kaWZpZXJzKCkgewogICAgICAgIHJldHVybiBFTVBUWV9TT0xfTU9ESUZJRVJTCiAgICB9CiAgICBHZXRTb2xNb2RpZmllcnNJbmNsdWRpbmdQYXJlbnRzKCkgewogICAgICAgIHJldHVybiB0aGlzLl9wYXJlbnQgPyB0aGlzLl9wYXJlbnQuR2V0U29sTW9kaWZpZXJzSW5jbHVkaW5nUGFyZW50cygpIDogRU1QVFlfU09MX01PRElGSUVSUwogICAgfQogICAgUnVuKGEpIHsKICAgICAgICBhLlNldEN1cnJlbnRFdmVudCh0aGlzKTsKICAgICAgICB0aGlzLl9ldmVudFNoZWV0TWFuYWdlci5BZGRBc3luY0FjdGlvblByb21pc2UodGhpcy5fUnVuVXNlclNjcmlwdCgpKQogICAgfQogICAgYXN5bmMgX1J1blVzZXJTY3JpcHQoKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXdhaXQgdGhpcy5fZnVuYygpCiAgICAgICAgfSBjYXRjaCAoYSkgewogICAgICAgICAgICBjb25zb2xlLmVycm9yKGBVbmhhbmRsZWQgZXhjZXB0aW9uIHJ1bm5pbmcgc2NyaXB0ICVjJHt0aGlzLkdldEV2ZW50U2hlZXQoKS5HZXROYW1lKCl9LCBldmVudCAke3RoaXMuR2V0RGlzcGxheU51bWJlcigpfTpgLCAiZm9udC1zaXplOiAxLjJlbTsgZm9udC13ZWlnaHQ6IGJvbGQ7IiwKICAgICAgICAgICAgICAgIGEpLCBzZWxmLkMzRGVidWdnZXIgJiYgc2VsZi5DM0RlYnVnZ2VyLl9TZXRMYXN0RXJyb3JTY3JpcHQodGhpcyksIGhhZFVzZXJTY3JpcHRFeGNlcHRpb24gfHwgKGNvbnNvbGUuaW5mbygiJWNUaXA6JWMgcnVuIHRoaXMgdG8gaGlnaGxpZ2h0IGluIENvbnN0cnVjdCB0aGUgbGFzdCBzY3JpcHQgdGhhdCBoYWQgYW4gZXJyb3I6ICVjZ29Ub0xhc3RFcnJvclNjcmlwdCgpIiwgImZvbnQtd2VpZ2h0OiBib2xkOyB0ZXh0LWRlY29yYXRpb246IHVuZGVybGluZSIsICIiLCAiZm9udC13ZWlnaHQ6IGJvbGQiKSwgaGFkVXNlclNjcmlwdEV4Y2VwdGlvbiA9ICEwKQogICAgICAgIH0KICAgIH0qIERlYnVnUnVuKGEpIHsKICAgICAgICBhLlNldEN1cnJlbnRFdmVudCh0aGlzKTsKICAgICAgICBpZiAodGhpcy5Jc0RlYnVnQnJlYWtwb2ludCgpIHx8IHRoaXMuX3J1bnRpbWUuRGVidWdCcmVha05leHQoKSkgeWllbGQgdGhpczsKICAgICAgICB0aGlzLlJ1bihhKQogICAgfQogICAgRGVidWdDYW5SdW5GYXN0KCkgewogICAgICAgIHJldHVybiAhdGhpcy5Jc0RlYnVnQnJlYWtwb2ludCgpICYmICF0aGlzLl9ydW50aW1lLkRlYnVnQnJlYWtOZXh0KCkKICAgIH0KICAgIHN0YXRpYyBIYWRVc2VyU2NyaXB0RXhjZXB0aW9uKCkgewogICAgICAgIHJldHVybiBoYWRVc2VyU2NyaXB0RXhjZXB0aW9uCiAgICB9CiAgICBzdGF0aWMgU2V0SGFkVXNlclNjcmlwdEV4Y2VwdGlvbigpIHsKICAgICAgICBoYWRVc2VyU2NyaXB0RXhjZXB0aW9uID0gITAKICAgIH0KfTsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkMTMxID0gc2VsZi5DMzsKQzMkanNjb21wJDEzMS5GdW5jdGlvbkJsb2NrID0gY2xhc3MgZXh0ZW5kcyBDMyRqc2NvbXAkMTMxLkRlZmVuZGVkQmFzZSB7CiAgICBjb25zdHJ1Y3RvcihhLCBiLCBkKSB7CiAgICAgICAgc3VwZXIoKTsKICAgICAgICB0aGlzLl9ldmVudFNoZWV0ID0gYTsKICAgICAgICB0aGlzLl9ydW50aW1lID0gYS5HZXRSdW50aW1lKCk7CiAgICAgICAgdGhpcy5fcGFyZW50ID0gYjsKICAgICAgICBjb25zdCBjID0gZFsxXTsKICAgICAgICB0aGlzLl9mdW5jdGlvbk5hbWUgPSBjWzBdOwogICAgICAgIHRoaXMuX3JldHVyblR5cGUgPSBjWzFdOwogICAgICAgIHRoaXMuX2Z1bmN0aW9uUGFyYW1ldGVycyA9IGNbMl0ubWFwKGUgPT4gQzMkanNjb21wJDEzMS5FdmVudFZhcmlhYmxlLkNyZWF0ZShhLCB0aGlzLCBlKSk7CiAgICAgICAgdGhpcy5faXNFbmFibGVkID0gY1szXTsKICAgICAgICB0aGlzLl9pbm5lckxvY2FsVmFyaWFibGVzID0gW107CiAgICAgICAgdGhpcy5faXNDb3B5UGlja2VkID0gY1s1XTsKICAgICAgICB0aGlzLl9pc0FzeW5jID0gY1s0XTsKICAgICAgICB0aGlzLl9uZXh0QXN5bmNJZCA9IDA7CiAgICAgICAgdGhpcy5fY3VycmVudEFzeW5jSWQgPSAtMTsKICAgICAgICB0aGlzLl9hc3luY01hcCA9IG5ldyBNYXA7CiAgICAgICAgdGhpcy5fZXZlbnRCbG9jayA9IEMzJGpzY29tcCQxMzEuRXZlbnRCbG9jay5DcmVhdGUoYSwKICAgICAgICAgICAgYiwgZCk7CiAgICAgICAgdGhpcy5fZXZlbnRCbG9jay5fU2V0U2NvcGVQYXJlbnQodGhpcykKICAgIH0KICAgIHN0YXRpYyBDcmVhdGUoYSwgYiwgZCkgewogICAgICAgIHJldHVybiBDMyRqc2NvbXAkMTMxLk5ldyhDMyRqc2NvbXAkMTMxLkZ1bmN0aW9uQmxvY2ssIGEsIGIsIGQpCiAgICB9CiAgICBfUG9zdEluaXQoKSB7CiAgICAgICAgZm9yIChjb25zdCBhIG9mIHRoaXMuX2Z1bmN0aW9uUGFyYW1ldGVycykgYS5fUG9zdEluaXQoKTsKICAgICAgICB0aGlzLl9ldmVudEJsb2NrLl9Qb3N0SW5pdCghMSkKICAgIH0KICAgIF9HZXRBbGxMb2NhbFZhcmlhYmxlc0luU2NvcGUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2Z1bmN0aW9uUGFyYW1ldGVycwogICAgfQogICAgR2V0RnVuY3Rpb25QYXJhbWV0ZXJzKCkgewogICAgICAgIHJldHVybiB0aGlzLl9mdW5jdGlvblBhcmFtZXRlcnMKICAgIH0KICAgIEdldEZ1bmN0aW9uUGFyYW1ldGVyQ291bnQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2Z1bmN0aW9uUGFyYW1ldGVycy5sZW5ndGgKICAgIH0KICAgIF9SZWdpc3RlckxvY2FsVmFyaWFibGUoYSkgewogICAgICAgIHRoaXMuX2lubmVyTG9jYWxWYXJpYWJsZXMucHVzaChhKQogICAgfQogICAgX0dldEFsbElubmVyTG9jYWxWYXJpYWJsZXMoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2lubmVyTG9jYWxWYXJpYWJsZXMKICAgIH0KICAgIEV2YWx1YXRlRnVuY3Rpb25QYXJhbWV0ZXJzKGEpIHsKICAgICAgICBjb25zdCBiID0KICAgICAgICAgICAgdGhpcy5fZnVuY3Rpb25QYXJhbWV0ZXJzOwogICAgICAgIGZvciAobGV0IGQgPSAwLCBjID0gYi5sZW5ndGg7IGQgPCBjOyArK2QpIGJbZF0uU2V0VmFsdWUoYVtkXS5HZXQoMCkpCiAgICB9CiAgICBTZXRGdW5jdGlvblBhcmFtZXRlcnMoYSkgewogICAgICAgIGNvbnN0IGIgPSB0aGlzLl9mdW5jdGlvblBhcmFtZXRlcnM7CiAgICAgICAgZm9yIChsZXQgZCA9IDAsIGMgPSBiLmxlbmd0aDsgZCA8IGM7ICsrZCkgYltkXS5TZXRWYWx1ZShhW2RdKQogICAgfQogICAgQ2FwdHVyZUZ1bmN0aW9uUGFyYW1ldGVycygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZnVuY3Rpb25QYXJhbWV0ZXJzLm1hcChhID0+IGEuR2V0VmFsdWUoKSkKICAgIH0KICAgIEdldFBhcmVudCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcGFyZW50CiAgICB9CiAgICBHZXRTY29wZVBhcmVudCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcGFyZW50CiAgICB9CiAgICBHZXRGdW5jdGlvbk5hbWUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2Z1bmN0aW9uTmFtZQogICAgfQogICAgR2V0UmV0dXJuVHlwZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcmV0dXJuVHlwZQogICAgfQogICAgSXNFbmFibGVkKCkgewogICAgICAgIHJldHVybiB0aGlzLl9pc0VuYWJsZWQKICAgIH0KICAgIEdldERlZmF1bHRSZXR1cm5WYWx1ZSgpIHsKICAgICAgICBzd2l0Y2ggKHRoaXMuX3JldHVyblR5cGUpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgIHJldHVybiAiIjsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHJldHVybiAwCiAgICAgICAgfQogICAgfQogICAgR2V0RXZlbnRCbG9jaygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZXZlbnRCbG9jawogICAgfQogICAgSXNDb3B5UGlja2VkKCkgewogICAgICAgIHJldHVybiB0aGlzLl9pc0NvcHlQaWNrZWQKICAgIH0KICAgIElzQXN5bmMoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2lzQXN5bmMKICAgIH0KICAgIFN0YXJ0QXN5bmNGdW5jdGlvbkNhbGwoKSB7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuX25leHRBc3luY0lkKys7CiAgICAgICAgdGhpcy5fY3VycmVudEFzeW5jSWQgPSBhOwogICAgICAgIGxldCBiOwogICAgICAgIGNvbnN0IGQgPSBuZXcgUHJvbWlzZShjID0+IGIgPSBjKTsKICAgICAgICB0aGlzLl9hc3luY01hcC5zZXQoYSwgewogICAgICAgICAgICByZXNvbHZlOiBiLAogICAgICAgICAgICBwYXVzZUNvdW50OiAwCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIFthLCBkXQogICAgfQogICAgTWF5YmVGaW5pc2hBc3luY0Z1bmN0aW9uQ2FsbChhKSB7CiAgICAgICAgY29uc3QgYiA9IHRoaXMuX2FzeW5jTWFwLmdldChhKTsKICAgICAgICAwID09PSBiLnBhdXNlQ291bnQgJiYgKGIucmVzb2x2ZSgpLCB0aGlzLl9hc3luY01hcC5kZWxldGUoYSkpOwogICAgICAgIHRoaXMuX2N1cnJlbnRBc3luY0lkID0gLTEKICAgIH0KICAgIFBhdXNlQ3VycmVudEFzeW5jRnVuY3Rpb24oKSB7CiAgICAgICAgdGhpcy5fYXN5bmNNYXAuZ2V0KHRoaXMuX2N1cnJlbnRBc3luY0lkKS5wYXVzZUNvdW50Kys7CiAgICAgICAgcmV0dXJuIHRoaXMuX2N1cnJlbnRBc3luY0lkCiAgICB9CiAgICBSZXN1bWVBc3luY0Z1bmN0aW9uKGEpIHsKICAgICAgICB0aGlzLl9jdXJyZW50QXN5bmNJZCA9IGE7CiAgICAgICAgdGhpcy5fYXN5bmNNYXAuZ2V0KGEpLnBhdXNlQ291bnQtLQogICAgfQp9OwoidXNlIHN0cmljdCI7CmNvbnN0IEMzJGpzY29tcCQxMzIgPSBzZWxmLkMzLAogICAgRU1QVFlfU09MX01PRElGSUVSUyRqc2NvbXAkMSA9IFtdOwpDMyRqc2NvbXAkMTMyLkV2ZW50VmFyaWFibGUgPSBjbGFzcyBleHRlbmRzIEMzJGpzY29tcCQxMzIuRGVmZW5kZWRCYXNlIHsKICAgIGNvbnN0cnVjdG9yKGEsIGIsIGQpIHsKICAgICAgICBzdXBlcigpOwogICAgICAgIGNvbnN0IGMgPSBhLkdldEV2ZW50U2hlZXRNYW5hZ2VyKCk7CiAgICAgICAgdGhpcy5fZXZlbnRTaGVldCA9IGE7CiAgICAgICAgdGhpcy5fZXZlbnRTaGVldE1hbmFnZXIgPSBjOwogICAgICAgIHRoaXMuX3J1bnRpbWUgPSBhLkdldFJ1bnRpbWUoKTsKICAgICAgICB0aGlzLl9wYXJlbnQgPSBiOwogICAgICAgIHRoaXMuX2xvY2FsVmFyU3RhY2sgPSBjLkdldExvY2FsVmFyU3RhY2soKTsKICAgICAgICB0aGlzLl9uYW1lID0gZFsxXTsKICAgICAgICB0aGlzLl90eXBlID0gZFsyXTsKICAgICAgICB0aGlzLl9pbml0aWFsVmFsdWUgPSBkWzNdOwogICAgICAgIHRoaXMuX2lzU3RhdGljID0gISFkWzRdOwogICAgICAgIHRoaXMuX2lzQ29uc3RhbnQgPSAhIWRbNV07CiAgICAgICAgdGhpcy5faXNGdW5jdGlvblBhcmFtZXRlciA9IGIgaW5zdGFuY2VvZiBDMyRqc2NvbXAkMTMyLkZ1bmN0aW9uQmxvY2s7CiAgICAgICAgdGhpcy5fc2lkID0gZFs2XTsKICAgICAgICB0aGlzLl9qc1Byb3BOYW1lID0gdGhpcy5fcnVudGltZS5HZXRKc1Byb3BOYW1lKGRbOF0pOwogICAgICAgIHRoaXMuX3NjcmlwdFNldHRlciA9CiAgICAgICAgICAgIGUgPT4gdGhpcy5TZXRWYWx1ZShlKTsKICAgICAgICB0aGlzLl9zY3JpcHRHZXR0ZXIgPSAoKSA9PiB0aGlzLkdldFZhbHVlKCk7CiAgICAgICAgdGhpcy5faGFzU2luZ2xlVmFsdWUgPSAhdGhpcy5fcGFyZW50IHx8IHRoaXMuX2lzU3RhdGljIHx8IHRoaXMuX2lzQ29uc3RhbnQ7CiAgICAgICAgdGhpcy5fdmFsdWUgPSB0aGlzLl9pbml0aWFsVmFsdWU7CiAgICAgICAgdGhpcy5fbG9jYWxJbmRleCA9IC0xOwogICAgICAgIHRoaXMuSXNCb29sZWFuKCkgJiYgKHRoaXMuX3ZhbHVlID0gdGhpcy5fdmFsdWUgPyAxIDogMCk7CiAgICAgICAgIXRoaXMuSXNMb2NhbCgpIHx8IHRoaXMuSXNTdGF0aWMoKSB8fCB0aGlzLklzQ29uc3RhbnQoKSB8fCAodGhpcy5fbG9jYWxJbmRleCA9IGMuX0dldE5leHRMb2NhbFZhckluZGV4KHRoaXMpKTsKICAgICAgICBjLl9SZWdpc3RlckV2ZW50VmFyaWFibGUodGhpcykKICAgIH0KICAgIHN0YXRpYyBDcmVhdGUoYSwgYiwgZCkgewogICAgICAgIHJldHVybiBDMyRqc2NvbXAkMTMyLk5ldyhDMyRqc2NvbXAkMTMyLkV2ZW50VmFyaWFibGUsIGEsIGIsIGQpCiAgICB9CiAgICBfUG9zdEluaXQoKSB7CiAgICAgICAgaWYgKHRoaXMuSXNMb2NhbCgpICYmICF0aGlzLklzU3RhdGljKCkgJiYgIXRoaXMuSXNDb25zdGFudCgpICYmCiAgICAgICAgICAgICF0aGlzLklzRnVuY3Rpb25QYXJhbWV0ZXIoKSkgewogICAgICAgICAgICBjb25zdCBhID0gdGhpcy5fZXZlbnRTaGVldE1hbmFnZXIuRmluZEZpcnN0RnVuY3Rpb25CbG9ja1BhcmVudCh0aGlzKTsKICAgICAgICAgICAgYSAmJiBhLl9SZWdpc3RlckxvY2FsVmFyaWFibGUodGhpcykKICAgICAgICB9CiAgICB9CiAgICBHZXROYW1lKCkgewogICAgICAgIHJldHVybiB0aGlzLl9uYW1lCiAgICB9CiAgICBHZXRKc1Byb3BOYW1lKCkgewogICAgICAgIHJldHVybiB0aGlzLl9qc1Byb3BOYW1lCiAgICB9CiAgICBHZXRQYXJlbnQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3BhcmVudAogICAgfQogICAgR2V0U2NvcGVQYXJlbnQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuR2V0UGFyZW50KCkKICAgIH0KICAgIElzR2xvYmFsKCkgewogICAgICAgIHJldHVybiAhdGhpcy5HZXRQYXJlbnQoKQogICAgfQogICAgSXNMb2NhbCgpIHsKICAgICAgICByZXR1cm4gIXRoaXMuSXNHbG9iYWwoKQogICAgfQogICAgSXNGdW5jdGlvblBhcmFtZXRlcigpIHsKICAgICAgICByZXR1cm4gdGhpcy5faXNGdW5jdGlvblBhcmFtZXRlcgogICAgfQogICAgSXNTdGF0aWMoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2lzU3RhdGljCiAgICB9CiAgICBJc0NvbnN0YW50KCkgewogICAgICAgIHJldHVybiB0aGlzLl9pc0NvbnN0YW50CiAgICB9CiAgICBJc051bWJlcigpIHsKICAgICAgICByZXR1cm4gMCA9PT0gdGhpcy5fdHlwZQogICAgfQogICAgSXNTdHJpbmcoKSB7CiAgICAgICAgcmV0dXJuIDEgPT09CiAgICAgICAgICAgIHRoaXMuX3R5cGUKICAgIH0KICAgIElzQm9vbGVhbigpIHsKICAgICAgICByZXR1cm4gMiA9PT0gdGhpcy5fdHlwZQogICAgfQogICAgSXNFbHNlQmxvY2soKSB7CiAgICAgICAgcmV0dXJuICExCiAgICB9CiAgICBHZXRTSUQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3NpZAogICAgfQogICAgR2V0SW5pdGlhbFZhbHVlKCkgewogICAgICAgIHJldHVybiB0aGlzLl9pbml0aWFsVmFsdWUKICAgIH0KICAgIEdldFNvbE1vZGlmaWVycygpIHsKICAgICAgICByZXR1cm4gRU1QVFlfU09MX01PRElGSUVSUyRqc2NvbXAkMQogICAgfQogICAgUnVuKGEpIHsKICAgICAgICAhdGhpcy5Jc0xvY2FsKCkgfHwgdGhpcy5Jc1N0YXRpYygpIHx8IHRoaXMuSXNDb25zdGFudCgpIHx8IHRoaXMuU2V0VmFsdWUodGhpcy5HZXRJbml0aWFsVmFsdWUoKSkKICAgIH0KICAgIERlYnVnQ2FuUnVuRmFzdCgpIHsKICAgICAgICByZXR1cm4gITAKICAgIH0qIERlYnVnUnVuKGEpIHsKICAgICAgICB0aGlzLlJ1bihhKQogICAgfQogICAgU2V0VmFsdWUoYSkgewogICAgICAgIHRoaXMuSXNOdW1iZXIoKSA/ICJudW1iZXIiICE9PSB0eXBlb2YgYSAmJiAoYSA9IHBhcnNlRmxvYXQoYSkpIDogdGhpcy5Jc1N0cmluZygpID8gInN0cmluZyIgIT09IHR5cGVvZiBhICYmIChhID0gYS50b1N0cmluZygpKSA6IHRoaXMuSXNCb29sZWFuKCkgJiYgKGEgPSBhID8gMSA6IDApOwogICAgICAgIHRoaXMuX2hhc1NpbmdsZVZhbHVlID8KICAgICAgICAgICAgdGhpcy5fdmFsdWUgPSBhIDogdGhpcy5fbG9jYWxWYXJTdGFjay5HZXRDdXJyZW50KClbdGhpcy5fbG9jYWxJbmRleF0gPSBhCiAgICB9CiAgICBHZXRWYWx1ZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5faGFzU2luZ2xlVmFsdWUgPyB0aGlzLl92YWx1ZSA6IHRoaXMuX2xvY2FsVmFyU3RhY2suR2V0Q3VycmVudCgpW3RoaXMuX2xvY2FsSW5kZXhdCiAgICB9CiAgICBHZXRUeXBlZFZhbHVlKCkgewogICAgICAgIGxldCBhID0gdGhpcy5HZXRWYWx1ZSgpOwogICAgICAgIHRoaXMuSXNCb29sZWFuKCkgJiYgKGEgPSAhIWEpOwogICAgICAgIHJldHVybiBhCiAgICB9CiAgICBSZXNldFRvSW5pdGlhbFZhbHVlKCkgewogICAgICAgIHRoaXMuX3ZhbHVlID0gdGhpcy5faW5pdGlhbFZhbHVlCiAgICB9CiAgICBfR2V0U2NyaXB0SW50ZXJmYWNlRGVzY3JpcHRvcigpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBjb25maWd1cmFibGU6ICExLAogICAgICAgICAgICBlbnVtZXJhYmxlOiAhMCwKICAgICAgICAgICAgZ2V0OiB0aGlzLl9zY3JpcHRHZXR0ZXIsCiAgICAgICAgICAgIHNldDogdGhpcy5fc2NyaXB0U2V0dGVyCiAgICAgICAgfQogICAgfQp9OwoidXNlIHN0cmljdCI7CmNvbnN0IEMzJGpzY29tcCQxMzMgPSBzZWxmLkMzLAogICAgRU1QVFlfU09MX01PRElGSUVSUyRqc2NvbXAkMiA9IFtdOwpDMyRqc2NvbXAkMTMzLkV2ZW50SW5jbHVkZSA9IGNsYXNzIGV4dGVuZHMgQzMkanNjb21wJDEzMy5EZWZlbmRlZEJhc2UgewogICAgY29uc3RydWN0b3IoYSwgYiwgZCkgewogICAgICAgIHN1cGVyKCk7CiAgICAgICAgY29uc3QgYyA9IGEuR2V0RXZlbnRTaGVldE1hbmFnZXIoKTsKICAgICAgICB0aGlzLl9ldmVudFNoZWV0ID0gYTsKICAgICAgICB0aGlzLl9ldmVudFNoZWV0TWFuYWdlciA9IGM7CiAgICAgICAgdGhpcy5fcnVudGltZSA9IGEuR2V0UnVudGltZSgpOwogICAgICAgIHRoaXMuX3BhcmVudCA9IGI7CiAgICAgICAgdGhpcy5faW5jbHVkZVNoZWV0ID0gbnVsbDsKICAgICAgICB0aGlzLl9pbmNsdWRlU2hlZXROYW1lID0gZFsxXTsKICAgICAgICB0aGlzLl9pc0FjdGl2ZSA9ICEwCiAgICB9CiAgICBzdGF0aWMgQ3JlYXRlKGEsIGIsIGQpIHsKICAgICAgICByZXR1cm4gQzMkanNjb21wJDEzMy5OZXcoQzMkanNjb21wJDEzMy5FdmVudEluY2x1ZGUsIGEsIGIsIGQpCiAgICB9CiAgICBfUG9zdEluaXQoKSB7CiAgICAgICAgdGhpcy5faW5jbHVkZVNoZWV0ID0gdGhpcy5fZXZlbnRTaGVldE1hbmFnZXIuR2V0RXZlbnRTaGVldEJ5TmFtZSh0aGlzLl9pbmNsdWRlU2hlZXROYW1lKTsKICAgICAgICB0aGlzLl9ldmVudFNoZWV0Ll9BZGRTaGFsbG93SW5jbHVkZSh0aGlzKTsKICAgICAgICBsZXQgYSA9IHRoaXMuR2V0UGFyZW50KCk7CiAgICAgICAgZm9yICg7IGE7KSBhIGluc3RhbmNlb2YgQzMkanNjb21wJDEzMy5FdmVudEJsb2NrICYmIGEuSXNHcm91cCgpICYmIGEuX0FkZENvbnRhaW5lZEluY2x1ZGUodGhpcyksIGEgPSBhLkdldFBhcmVudCgpOwogICAgICAgIHRoaXMuVXBkYXRlQWN0aXZlKCk7CiAgICAgICAgdGhpcy5fcnVudGltZS5Jc0RlYnVnKCkgJiYgdGhpcy5fZXZlbnRTaGVldC5fR2V0UGVyZlJlY29yZCgpLmNoaWxkcmVuLnB1c2godGhpcy5faW5jbHVkZVNoZWV0Ll9HZXRQZXJmUmVjb3JkKCkpCiAgICB9CiAgICBHZXRQYXJlbnQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3BhcmVudAogICAgfQogICAgR2V0U29sTW9kaWZpZXJzKCkgewogICAgICAgIHJldHVybiBFTVBUWV9TT0xfTU9ESUZJRVJTJGpzY29tcCQyCiAgICB9CiAgICBHZXRJbmNsdWRlU2hlZXQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2luY2x1ZGVTaGVldAogICAgfQogICAgUnVuKGEpIHsKICAgICAgICBhID0gISF0aGlzLkdldFBhcmVudCgpOwogICAgICAgIGNvbnN0IGIgPSB0aGlzLl9ydW50aW1lLkdldEFsbE9iamVjdENsYXNzZXMoKTsKICAgICAgICBhICYmIHRoaXMuX2V2ZW50U2hlZXRNYW5hZ2VyLlB1c2hDbGVhblNvbChiKTsKICAgICAgICB0aGlzLl9pbmNsdWRlU2hlZXQuUnVuKCk7CiAgICAgICAgYSAmJiB0aGlzLl9ldmVudFNoZWV0TWFuYWdlci5Qb3BTb2woYikKICAgIH0qIERlYnVnUnVuKGEpIHsKICAgICAgICBhID0gISF0aGlzLkdldFBhcmVudCgpOwogICAgICAgIGNvbnN0IGIgPSB0aGlzLl9ydW50aW1lLkdldEFsbE9iamVjdENsYXNzZXMoKTsKICAgICAgICBhICYmIHRoaXMuX2V2ZW50U2hlZXRNYW5hZ2VyLlB1c2hDbGVhblNvbChiKTsKICAgICAgICB5aWVsZCogdGhpcy5faW5jbHVkZVNoZWV0LkRlYnVnUnVuKCk7CiAgICAgICAgYSAmJiB0aGlzLl9ldmVudFNoZWV0TWFuYWdlci5Qb3BTb2woYikKICAgIH0KICAgIERlYnVnQ2FuUnVuRmFzdCgpIHsKICAgICAgICByZXR1cm4gITEKICAgIH0KICAgIElzQWN0aXZlKCkgewogICAgICAgIHJldHVybiB0aGlzLl9pc0FjdGl2ZQogICAgfQogICAgVXBkYXRlQWN0aXZlKCkgewogICAgICAgIGxldCBhID0gdGhpcy5HZXRQYXJlbnQoKTsKICAgICAgICBmb3IgKDsgYTspIHsKICAgICAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBDMyRqc2NvbXAkMTMzLkV2ZW50QmxvY2sgJiYgYS5Jc0dyb3VwKCkgJiYgIWEuSXNHcm91cEFjdGl2ZSgpKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9pc0FjdGl2ZSA9ICExOwogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgYSA9IGEuR2V0UGFyZW50KCkKICAgICAgICB9CiAgICAgICAgdGhpcy5faXNBY3RpdmUgPSAhMAogICAgfQp9OwoidXNlIHN0cmljdCI7CmNvbnN0IEMzJGpzY29tcCQxMzQgPSBzZWxmLkMzOwpDMyRqc2NvbXAkMTM0LkV4cE5vZGUgPSBjbGFzcyBleHRlbmRzIEMzJGpzY29tcCQxMzQuRGVmZW5kZWRCYXNlIHsKICAgIGNvbnN0cnVjdG9yKGEpIHsKICAgICAgICBzdXBlcigpOwogICAgICAgIHRoaXMuX293bmVyID0gYTsKICAgICAgICB0aGlzLl9ydW50aW1lID0gYS5HZXRSdW50aW1lKCkKICAgIH0KICAgIF9Qb3N0SW5pdCgpIHt9CiAgICBzdGF0aWMgQ3JlYXRlTm9kZShhLCBiKSB7CiAgICAgICAgcmV0dXJuIEMzJGpzY29tcCQxMzQuTmV3KFtCZWhhdmlvckV4cHJlc3Npb25Ob2RlLCBPYmplY3RFeHByZXNzaW9uTm9kZSwgSW5zdFZhckV4cHJlc3Npb25Ob2RlLCBFdmVudFZhckV4cE5vZGUsIFN5c3RlbUV4cHJlc3Npb25FeHBOb2RlLCBDYWxsRnVuY3Rpb25FeHByZXNzaW9uRXhwTm9kZV1bYlswXV0sIGEsIGIpCiAgICB9Cn07CmNsYXNzIFN5c3RlbUV4cHJlc3Npb25FeHBOb2RlIGV4dGVuZHMgQzMkanNjb21wJDEzNC5FeHBOb2RlIHsKICAgIGNvbnN0cnVjdG9yKGEsIGIpIHsKICAgICAgICBzdXBlcihhKTsKICAgICAgICB0aGlzLl9zeXN0ZW1QbHVnaW4gPSB0aGlzLl9ydW50aW1lLkdldFN5c3RlbVBsdWdpbigpOwogICAgICAgIHRoaXMuX2Z1bmMgPSB0aGlzLl9ydW50aW1lLkdldE9iamVjdFJlZmVyZW5jZShiWzFdKTsKICAgICAgICB0aGlzLl9mdW5jICE9PSBDMyRqc2NvbXAkMTM0LlBsdWdpbnMuU3lzdGVtLkV4cHMucmFuZG9tICYmIHRoaXMuX2Z1bmMgIT09IEMzJGpzY29tcCQxMzQuUGx1Z2lucy5TeXN0ZW0uRXhwcy5jaG9vc2UgfHwgdGhpcy5fb3duZXIuU2V0VmFyaWVzUGVySW5zdGFuY2UoKQogICAgfQogICAgR2V0Qm91bmRNZXRob2QoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3N5c3RlbVBsdWdpbi5fR2V0Qm91bmRBQ0VNZXRob2QodGhpcy5fZnVuYywgdGhpcy5fc3lzdGVtUGx1Z2luKQogICAgfQp9CmNsYXNzIENhbGxGdW5jdGlvbkV4cHJlc3Npb25FeHBOb2RlIGV4dGVuZHMgQzMkanNjb21wJDEzNC5FeHBOb2RlIHsKICAgIGNvbnN0cnVjdG9yKGEsIGIpIHsKICAgICAgICBzdXBlcihhKTsKICAgICAgICB0aGlzLl9mdW5jdGlvbkJsb2NrID0gbnVsbDsKICAgICAgICB0aGlzLl9mdW5jdGlvbk5hbWUgPSBiWzFdOwogICAgICAgIHRoaXMuX293bmVyLlNldFZhcmllc1Blckluc3RhbmNlKCkKICAgIH0KICAgIF9Qb3N0SW5pdCgpIHsKICAgICAgICBjb25zdCBhID0gdGhpcy5fcnVudGltZS5HZXRFdmVudFNoZWV0TWFuYWdlcigpOwogICAgICAgIHRoaXMuX2Z1bmN0aW9uQmxvY2sgPSBhLkdldEZ1bmN0aW9uQmxvY2tCeU5hbWUodGhpcy5fZnVuY3Rpb25OYW1lKTsKICAgICAgICB0aGlzLl9mdW5jdGlvbk5hbWUgPSBudWxsOwogICAgICAgIGNvbnN0IGIgPSB0aGlzLl9vd25lci5HZXRFdmVudEJsb2NrKCksCiAgICAgICAgICAgIGQgPSB0aGlzLl9mdW5jdGlvbkJsb2NrLkdldEV2ZW50QmxvY2soKTsKICAgICAgICB0aGlzLl9jb21iaW5lZFNvbE1vZGlmaWVycyA9IFsuLi4obmV3IFNldChbLi4uYi5HZXRTb2xNb2RpZmllcnNJbmNsdWRpbmdQYXJlbnRzKCksIC4uLmQuR2V0U29sTW9kaWZpZXJzSW5jbHVkaW5nUGFyZW50cygpXSkpXTsKICAgICAgICB0aGlzLl9jb21iaW5lZFNvbE1vZGlmaWVycyA9IGEuX0RlZHVwbGljYXRlU29sTW9kaWZpZXJMaXN0KHRoaXMuX2NvbWJpbmVkU29sTW9kaWZpZXJzKQogICAgfQogICAgR2V0Qm91bmRNZXRob2QoKSB7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuX2Z1bmN0aW9uQmxvY2s7CiAgICAgICAgaWYgKGEuSXNFbmFibGVkKCkpIHsKICAgICAgICAgICAgY29uc3QgZCA9IGEuR2V0RXZlbnRCbG9jaygpOwogICAgICAgICAgICByZXR1cm4gQzMkanNjb21wJDEzNC5FdmVudEJsb2NrLnByb3RvdHlwZS5SdW5Bc0V4cHJlc3Npb25GdW5jdGlvbkNhbGwuYmluZChkLCB0aGlzLl9jb21iaW5lZFNvbE1vZGlmaWVycywgYS5Jc0NvcHlQaWNrZWQoKSwgYS5HZXRSZXR1cm5UeXBlKCksIGEuR2V0RGVmYXVsdFJldHVyblZhbHVlKCkpCiAgICAgICAgfQogICAgICAgIGNvbnN0IGIgPSBhLkdldERlZmF1bHRSZXR1cm5WYWx1ZSgpOwogICAgICAgIHJldHVybiAoKSA9PiBiCiAgICB9Cn0KCmZ1bmN0aW9uIFdyYXBJbmRleChhLCBiKSB7CiAgICBpZiAoYSA+PSBiKSByZXR1cm4gYSAlIGI7CiAgICAwID4gYSAmJiAoYSA8PSAtYiAmJiAoYSAlPSBiKSwgMCA+IGEgJiYgKGEgKz0gYikpOwogICAgcmV0dXJuIGEKfQpjbGFzcyBPYmplY3RFeHByZXNzaW9uTm9kZSBleHRlbmRzIEMzJGpzY29tcCQxMzQuRXhwTm9kZSB7CiAgICBjb25zdHJ1Y3RvcihhLCBiKSB7CiAgICAgICAgc3VwZXIoYSk7CiAgICAgICAgdGhpcy5fb2JqZWN0Q2xhc3MgPSB0aGlzLl9ydW50aW1lLkdldE9iamVjdENsYXNzQnlJbmRleChiWzFdKTsKICAgICAgICB0aGlzLl9mdW5jID0gdGhpcy5fcnVudGltZS5HZXRPYmplY3RSZWZlcmVuY2UoYlsyXSk7CiAgICAgICAgdGhpcy5fcmV0dXJuc1N0cmluZyA9ICEhYlszXTsKICAgICAgICB0aGlzLl9ldmVudFN0YWNrID0gdGhpcy5fcnVudGltZS5HZXRFdmVudFNoZWV0TWFuYWdlcigpLkdldEV2ZW50U3RhY2soKTsKICAgICAgICB0aGlzLl9vd25lci5fTWF5YmVWYXJ5Rm9yKHRoaXMuX29iamVjdENsYXNzKQogICAgfQogICAgR2V0Qm91bmRNZXRob2QoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX29iamVjdENsYXNzLkdldFBsdWdpbigpLl9HZXRCb3VuZEFDRU1ldGhvZCh0aGlzLl9mdW5jLCB0aGlzLl9vYmplY3RDbGFzcy5HZXRTaW5nbGVHbG9iYWxJbnN0YW5jZSgpLkdldFNka0luc3RhbmNlKCkpCiAgICB9CiAgICBFeHBPYmplY3QoLi4uYSkgewogICAgICAgIGNvbnN0IGIgPQogICAgICAgICAgICB0aGlzLl9vYmplY3RDbGFzcywKICAgICAgICAgICAgZCA9IGIuR2V0Q3VycmVudFNvbCgpLkdldEV4cHJlc3Npb25JbnN0YW5jZXMoKTsKICAgICAgICB2YXIgYyA9IGQubGVuZ3RoOwogICAgICAgIGlmICgwID09PSBjKSByZXR1cm4gdGhpcy5fcmV0dXJuc1N0cmluZyA/ICIiIDogMDsKICAgICAgICBjID0gV3JhcEluZGV4KHRoaXMuX293bmVyLkdldFNvbEluZGV4KCksIGMpOwogICAgICAgIHRoaXMuX2V2ZW50U3RhY2suR2V0Q3VycmVudFN0YWNrRnJhbWUoKS5TZXRFeHByZXNzaW9uT2JqZWN0Q2xhc3MoYik7CiAgICAgICAgcmV0dXJuIHRoaXMuX2Z1bmMuYXBwbHkoZFtjXS5HZXRTZGtJbnN0YW5jZSgpLCBhKQogICAgfQogICAgRXhwT2JqZWN0X0luc3RFeHByKGEsIC4uLmIpIHsKICAgICAgICBjb25zdCBkID0gdGhpcy5fb2JqZWN0Q2xhc3MsCiAgICAgICAgICAgIGMgPSBkLkdldEluc3RhbmNlcygpLAogICAgICAgICAgICBlID0gYy5sZW5ndGg7CiAgICAgICAgaWYgKDAgPT09IGUpIHJldHVybiB0aGlzLl9yZXR1cm5zU3RyaW5nID8gIiIgOiAwOwogICAgICAgIGEgPSBXcmFwSW5kZXgoYSwgZSk7CiAgICAgICAgdGhpcy5fZXZlbnRTdGFjay5HZXRDdXJyZW50U3RhY2tGcmFtZSgpLlNldEV4cHJlc3Npb25PYmplY3RDbGFzcyhkKTsKICAgICAgICByZXR1cm4gdGhpcy5fZnVuYy5hcHBseShjW2FdLkdldFNka0luc3RhbmNlKCksCiAgICAgICAgICAgIGIpCiAgICB9Cn0KY2xhc3MgSW5zdFZhckV4cHJlc3Npb25Ob2RlIGV4dGVuZHMgQzMkanNjb21wJDEzNC5FeHBOb2RlIHsKICAgIGNvbnN0cnVjdG9yKGEsIGIpIHsKICAgICAgICBzdXBlcihhKTsKICAgICAgICB0aGlzLl9vYmplY3RDbGFzcyA9IHRoaXMuX3J1bnRpbWUuR2V0T2JqZWN0Q2xhc3NCeUluZGV4KGJbMV0pOwogICAgICAgIHRoaXMuX3ZhckluZGV4ID0gYlszXTsKICAgICAgICB0aGlzLl9yZXR1cm5zU3RyaW5nID0gISFiWzJdOwogICAgICAgIHRoaXMuX293bmVyLl9NYXliZVZhcnlGb3IodGhpcy5fb2JqZWN0Q2xhc3MpCiAgICB9CiAgICBFeHBJbnN0VmFyKCkgewogICAgICAgIGNvbnN0IGEgPSB0aGlzLl9vYmplY3RDbGFzcy5HZXRDdXJyZW50U29sKCkuR2V0RXhwcmVzc2lvbkluc3RhbmNlcygpOwogICAgICAgIHZhciBiID0gYS5sZW5ndGg7CiAgICAgICAgaWYgKDAgPT09IGIpIHJldHVybiB0aGlzLl9yZXR1cm5zU3RyaW5nID8gIiIgOiAwOwogICAgICAgIGIgPSBXcmFwSW5kZXgodGhpcy5fb3duZXIuR2V0U29sSW5kZXgoKSwgYik7CiAgICAgICAgcmV0dXJuIGFbYl0uX0dldEluc3RhbmNlVmFyaWFibGVWYWx1ZVVuY2hlY2tlZCh0aGlzLl92YXJJbmRleCkKICAgIH0KICAgIEV4cEluc3RWYXJfRmFtaWx5KCkgewogICAgICAgIHZhciBhID0gdGhpcy5fb2JqZWN0Q2xhc3MsCiAgICAgICAgICAgIGIgPSBhLkdldEN1cnJlbnRTb2woKS5HZXRFeHByZXNzaW9uSW5zdGFuY2VzKCksCiAgICAgICAgICAgIGQgPSBiLmxlbmd0aDsKICAgICAgICBpZiAoMCA9PT0gZCkgcmV0dXJuIHRoaXMuX3JldHVybnNTdHJpbmcgPyAiIiA6IDA7CiAgICAgICAgZCA9IFdyYXBJbmRleCh0aGlzLl9vd25lci5HZXRTb2xJbmRleCgpLCBkKTsKICAgICAgICBiID0gYltkXTsKICAgICAgICBhID0gYi5HZXRPYmplY3RDbGFzcygpLkdldEZhbWlseUluc3RhbmNlVmFyaWFibGVPZmZzZXQoYS5HZXRGYW1pbHlJbmRleCgpKTsKICAgICAgICByZXR1cm4gYi5fR2V0SW5zdGFuY2VWYXJpYWJsZVZhbHVlVW5jaGVja2VkKHRoaXMuX3ZhckluZGV4ICsgYSkKICAgIH0KICAgIEV4cEluc3RWYXJfSW5zdEV4cHIoYSkgewogICAgICAgIGNvbnN0IGIgPSB0aGlzLl9vYmplY3RDbGFzczsKICAgICAgICB2YXIgZCA9IGIuR2V0SW5zdGFuY2VzKCk7CiAgICAgICAgY29uc3QgYyA9IGQubGVuZ3RoOwogICAgICAgIGlmICgwID09PSBjKSByZXR1cm4gdGhpcy5fcmV0dXJuc1N0cmluZyA/ICIiIDogMDsKICAgICAgICBhID0gV3JhcEluZGV4KGEsIGMpOwogICAgICAgIGQgPSBkW2FdOwogICAgICAgIGEgPSAwOwogICAgICAgIGIuSXNGYW1pbHkoKSAmJiAoYSA9IGQuR2V0T2JqZWN0Q2xhc3MoKS5HZXRGYW1pbHlJbnN0YW5jZVZhcmlhYmxlT2Zmc2V0KGIuR2V0RmFtaWx5SW5kZXgoKSkpOwogICAgICAgIHJldHVybiBkLl9HZXRJbnN0YW5jZVZhcmlhYmxlVmFsdWVVbmNoZWNrZWQodGhpcy5fdmFySW5kZXggKyBhKQogICAgfQp9CmNsYXNzIEJlaGF2aW9yRXhwcmVzc2lvbk5vZGUgZXh0ZW5kcyBDMyRqc2NvbXAkMTM0LkV4cE5vZGUgewogICAgY29uc3RydWN0b3IoYSwgYikgewogICAgICAgIHN1cGVyKGEpOwogICAgICAgIHRoaXMuX29iamVjdENsYXNzID0gdGhpcy5fcnVudGltZS5HZXRPYmplY3RDbGFzc0J5SW5kZXgoYlsxXSk7CiAgICAgICAgdGhpcy5fYmVoYXZpb3JUeXBlID0gdGhpcy5fb2JqZWN0Q2xhc3MuR2V0QmVoYXZpb3JUeXBlQnlOYW1lKGJbMl0pOwogICAgICAgIHRoaXMuX2JlaGF2aW9ySW5kZXggPSB0aGlzLl9vYmplY3RDbGFzcy5HZXRCZWhhdmlvckluZGV4QnlOYW1lKGJbMl0pOwogICAgICAgIHRoaXMuX2Z1bmMgPSB0aGlzLl9ydW50aW1lLkdldE9iamVjdFJlZmVyZW5jZShiWzNdKTsKICAgICAgICB0aGlzLl9yZXR1cm5zU3RyaW5nID0gISFiWzRdOwogICAgICAgIHRoaXMuX2V2ZW50U3RhY2sgPSB0aGlzLl9ydW50aW1lLkdldEV2ZW50U2hlZXRNYW5hZ2VyKCkuR2V0RXZlbnRTdGFjaygpOwogICAgICAgIHRoaXMuX293bmVyLl9NYXliZVZhcnlGb3IodGhpcy5fb2JqZWN0Q2xhc3MpCiAgICB9CiAgICBFeHBCZWhhdmlvciguLi5hKSB7CiAgICAgICAgY29uc3QgYiA9IHRoaXMuX29iamVjdENsYXNzOwogICAgICAgIHZhciBkID0gYi5HZXRDdXJyZW50U29sKCkuR2V0RXhwcmVzc2lvbkluc3RhbmNlcygpLAogICAgICAgICAgICBjID0gZC5sZW5ndGg7CiAgICAgICAgaWYgKDAgPT09IGMpIHJldHVybiB0aGlzLl9yZXR1cm5zU3RyaW5nID8gIiIgOiAwOwogICAgICAgIGMgPSBXcmFwSW5kZXgodGhpcy5fb3duZXIuR2V0U29sSW5kZXgoKSwgYyk7CiAgICAgICAgdGhpcy5fZXZlbnRTdGFjay5HZXRDdXJyZW50U3RhY2tGcmFtZSgpLlNldEV4cHJlc3Npb25PYmplY3RDbGFzcyhiKTsKICAgICAgICBkID0gZFtjXTsKICAgICAgICBjID0gMDsKICAgICAgICBiLklzRmFtaWx5KCkgJiYgKGMgPSBkLkdldE9iamVjdENsYXNzKCkuR2V0RmFtaWx5QmVoYXZpb3JPZmZzZXQoYi5HZXRGYW1pbHlJbmRleCgpKSk7CiAgICAgICAgcmV0dXJuIHRoaXMuX2Z1bmMuYXBwbHkoZC5HZXRCZWhhdmlvckluc3RhbmNlcygpW3RoaXMuX2JlaGF2aW9ySW5kZXggKyBjXS5HZXRTZGtJbnN0YW5jZSgpLCBhKQogICAgfQogICAgRXhwQmVoYXZpb3JfSW5zdEV4cHIoYSwgLi4uYikgewogICAgICAgIGNvbnN0IGQgPSB0aGlzLl9vYmplY3RDbGFzczsKICAgICAgICB2YXIgYyA9IGQuR2V0SW5zdGFuY2VzKCk7CiAgICAgICAgY29uc3QgZSA9IGMubGVuZ3RoOwogICAgICAgIGlmICgwID09PSBlKSByZXR1cm4gdGhpcy5fcmV0dXJuc1N0cmluZyA/CiAgICAgICAgICAgICIiIDogMDsKICAgICAgICBhID0gV3JhcEluZGV4KGEsIGUpOwogICAgICAgIHRoaXMuX2V2ZW50U3RhY2suR2V0Q3VycmVudFN0YWNrRnJhbWUoKS5TZXRFeHByZXNzaW9uT2JqZWN0Q2xhc3MoZCk7CiAgICAgICAgYyA9IGNbYV07CiAgICAgICAgYSA9IDA7CiAgICAgICAgZC5Jc0ZhbWlseSgpICYmIChhID0gYy5HZXRPYmplY3RDbGFzcygpLkdldEZhbWlseUJlaGF2aW9yT2Zmc2V0KGQuR2V0RmFtaWx5SW5kZXgoKSkpOwogICAgICAgIHJldHVybiB0aGlzLl9mdW5jLmFwcGx5KGMuR2V0QmVoYXZpb3JJbnN0YW5jZXMoKVt0aGlzLl9iZWhhdmlvckluZGV4ICsgYV0uR2V0U2RrSW5zdGFuY2UoKSwgYikKICAgIH0KfQpjbGFzcyBFdmVudFZhckV4cE5vZGUgZXh0ZW5kcyBDMyRqc2NvbXAkMTM0LkV4cE5vZGUgewogICAgY29uc3RydWN0b3IoYSwgYikgewogICAgICAgIHN1cGVyKGEpOwogICAgICAgIHRoaXMuX2V2ZW50VmFyID0gbnVsbDsKICAgICAgICB0aGlzLl9ldmVudFZhclNpZCA9IGJbMV0KICAgIH0KICAgIF9Qb3N0SW5pdCgpIHsKICAgICAgICB0aGlzLl9ldmVudFZhciA9IHRoaXMuX3J1bnRpbWUuR2V0RXZlbnRTaGVldE1hbmFnZXIoKS5HZXRFdmVudFZhcmlhYmxlQnlTSUQodGhpcy5fZXZlbnRWYXJTaWQpCiAgICB9CiAgICBHZXRWYXIoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2V2ZW50VmFyCiAgICB9Cn0KInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkMTM1ID0gc2VsZi5DMzsKQzMkanNjb21wJDEzNS5QYXJhbWV0ZXIgPSBjbGFzcyBleHRlbmRzIEMzJGpzY29tcCQxMzUuRGVmZW5kZWRCYXNlIHsKICAgIGNvbnN0cnVjdG9yKGEsIGIsIGQpIHsKICAgICAgICBzdXBlcigpOwogICAgICAgIHRoaXMuX293bmVyID0gYTsKICAgICAgICB0aGlzLl9pbmRleCA9IGQ7CiAgICAgICAgdGhpcy5fdHlwZSA9IGI7CiAgICAgICAgdGhpcy5HZXQgPSBudWxsOwogICAgICAgIHRoaXMuX2lzQ29uc3RhbnQgPSB0aGlzLl92YXJpZXNQZXJJbnN0YW5jZSA9ICExCiAgICB9CiAgICBzdGF0aWMgQ3JlYXRlKGEsIGIsIGQpIHsKICAgICAgICBjb25zdCBjID0gYlswXTsKICAgICAgICByZXR1cm4gQzMkanNjb21wJDEzNS5OZXcoW0V4cHJlc3Npb25QYXJhbWV0ZXIsIFN0cmluZ0V4cHJlc3Npb25QYXJhbWV0ZXIsIEZpbGVQYXJhbWV0ZXIsIENvbWJvUGFyYW1ldGVyLCBPYmplY3RQYXJhbWV0ZXIsIExheWVyRXhwcmVzc2lvblBhcmFtZXRlciwgTGF5b3V0UGFyYW1ldGVyLCBFeHByZXNzaW9uUGFyYW1ldGVyLCBDb21ib1BhcmFtZXRlciwgQ29tYm9QYXJhbWV0ZXIsIEluc3RWYXJQYXJhbWV0ZXIsIEV2ZW50VmFyUGFyYW1ldGVyLCBGaWxlUGFyYW1ldGVyLCBWYXJpYWRpY1BhcmFtZXRlciwgU3RyaW5nRXhwcmVzc2lvblBhcmFtZXRlciwKICAgICAgICAgICAgVGltZWxpbmVQYXJhbWV0ZXIsIEJvb2xlYW5QYXJhbWV0ZXIsIEZ1bmN0aW9uUGFyYW1ldGVyLCBFYXNlUGFyYW1ldGVyLCBUaWxlbWFwQnJ1c2hQYXJhbWV0ZXIsIFRlbXBsYXRlRXhwcmVzc2lvblBhcmFtZXRlcgogICAgICAgIF1bY10sIGEsIGMsIGQsIGIpCiAgICB9CiAgICBfUG9zdEluaXQoKSB7fQogICAgU2V0VmFyaWVzUGVySW5zdGFuY2UoKSB7CiAgICAgICAgdGhpcy5fdmFyaWVzUGVySW5zdGFuY2UgPSAhMAogICAgfQogICAgX01heWJlVmFyeUZvcihhKSB7CiAgICAgICAgdGhpcy5fdmFyaWVzUGVySW5zdGFuY2UgfHwgIWEgfHwgYS5HZXRQbHVnaW4oKS5Jc1NpbmdsZUdsb2JhbCgpIHx8ICh0aGlzLl92YXJpZXNQZXJJbnN0YW5jZSA9ICEwKQogICAgfQogICAgVmFyaWVzUGVySW5zdGFuY2UoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3Zhcmllc1Blckluc3RhbmNlCiAgICB9CiAgICBHZXRJbmRleCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5faW5kZXgKICAgIH0KICAgIEdldFJ1bnRpbWUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX293bmVyLkdldFJ1bnRpbWUoKQogICAgfQogICAgR2V0RXZlbnRCbG9jaygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fb3duZXIuR2V0RXZlbnRCbG9jaygpCiAgICB9CiAgICBJc0NvbnN0YW50KCkgewogICAgICAgIHJldHVybiB0aGlzLl9pc0NvbnN0YW50CiAgICB9Cn07CgpmdW5jdGlvbiBHZXRFeHByZXNzaW9uRnVuYyhhKSB7CiAgICBhID0gc2VsZi5DM19FeHByZXNzaW9uRnVuY3NbYV07CiAgICBpZiAoIWEpIHRocm93IEVycm9yKCJpbnZhbGlkIGV4cHJlc3Npb24gbnVtYmVyIik7CiAgICByZXR1cm4gYQp9CmNsYXNzIEV4cHJlc3Npb25QYXJhbWV0ZXIgZXh0ZW5kcyBDMyRqc2NvbXAkMTM1LlBhcmFtZXRlciB7CiAgICBjb25zdHJ1Y3RvcihhLCBiLCBkLCBjKSB7CiAgICAgICAgc3VwZXIoYSwgYiwgZCk7CiAgICAgICAgdGhpcy5fc29sSW5kZXggPSAwOwogICAgICAgIGEgPSBjWzFdOwogICAgICAgIHRoaXMuX2V4cHJlc3Npb25OdW1iZXIgPSBhWzBdOwogICAgICAgIHRoaXMuX251bWJlcmVkTm9kZXMgPSBbXTsKICAgICAgICB0aGlzLl9leHByZXNzaW9uRnVuYyA9IG51bGw7CiAgICAgICAgZm9yIChsZXQgZSA9IDEsIGcgPSBhLmxlbmd0aDsgZSA8IGc7ICsrZSkgdGhpcy5fbnVtYmVyZWROb2Rlcy5wdXNoKEMzJGpzY29tcCQxMzUuRXhwTm9kZS5DcmVhdGVOb2RlKHRoaXMsIGFbZV0pKTsKICAgICAgICB0aGlzLl9udW1iZXJlZE5vZGVzLmxlbmd0aCA/IHRoaXMuR2V0ID0gdGhpcy5HZXRFeHByZXNzaW9uIDogKHRoaXMuR2V0ID0gR2V0RXhwcmVzc2lvbkZ1bmModGhpcy5fZXhwcmVzc2lvbk51bWJlciksIHRoaXMuX2lzQ29uc3RhbnQgPSAhMCkKICAgIH0KICAgIF9HZXROb2RlKGEpIHsKICAgICAgICBpZiAoMCA+IGEgfHwgYSA+PSB0aGlzLl9udW1iZXJlZE5vZGVzLmxlbmd0aCkgdGhyb3cgbmV3IFJhbmdlRXJyb3IoImludmFsaWQgbnVtYmVyZWQgbm9kZSIpOwogICAgICAgIHJldHVybiB0aGlzLl9udW1iZXJlZE5vZGVzW2FdCiAgICB9CiAgICBfUG9zdEluaXQoKSB7CiAgICAgICAgZm9yICh2YXIgYSBvZiB0aGlzLl9udW1iZXJlZE5vZGVzKSBhLl9Qb3N0SW5pdCgpOwogICAgICAgIGEgPSBHZXRFeHByZXNzaW9uRnVuYyh0aGlzLl9leHByZXNzaW9uTnVtYmVyKTsKICAgICAgICB0aGlzLl9leHByZXNzaW9uRnVuYyA9IHRoaXMuX251bWJlcmVkTm9kZXMubGVuZ3RoID8gYSh0aGlzKSA6IGEKICAgIH0KICAgIEdldFNvbEluZGV4KCkgewogICAgICAgIHJldHVybiB0aGlzLl9zb2xJbmRleAogICAgfQogICAgR2V0RXhwcmVzc2lvbihhKSB7CiAgICAgICAgdGhpcy5fc29sSW5kZXggPSBhOwogICAgICAgIHJldHVybiB0aGlzLl9leHByZXNzaW9uRnVuYygpCiAgICB9Cn0KY2xhc3MgU3RyaW5nRXhwcmVzc2lvblBhcmFtZXRlciBleHRlbmRzIEV4cHJlc3Npb25QYXJhbWV0ZXIgewogICAgY29uc3RydWN0b3IoYSwgYiwgZCwgYykgewogICAgICAgIHN1cGVyKGEsIGIsIGQsIGMpOwogICAgICAgIHRoaXMuR2V0ID0gdGhpcy5HZXRTdHJpbmdFeHByZXNzaW9uOwogICAgICAgIDE0ID09PSBiICYmICh0aGlzLkdldEV2ZW50QmxvY2soKS5TZXRBbGxTb2xNb2RpZmllcnMoKSwgdGhpcy5fb3duZXIgaW5zdGFuY2VvZiBDMyRqc2NvbXAkMTM1LkFjdGlvbiAmJiB0aGlzLkdldEV2ZW50QmxvY2soKS5TZXRTb2xXcml0ZXJBZnRlckNuZHMoKSkKICAgIH0KICAgIEdldFN0cmluZ0V4cHJlc3Npb24oYSkgewogICAgICAgIHRoaXMuX3NvbEluZGV4ID0gYTsKICAgICAgICBhID0gdGhpcy5fZXhwcmVzc2lvbkZ1bmMoKTsKICAgICAgICByZXR1cm4gInN0cmluZyIgPT09IHR5cGVvZiBhID8gYSA6ICIiCiAgICB9CiAgICBfR2V0RmFzdFRyaWdnZXJWYWx1ZSgpIHsKICAgICAgICByZXR1cm4gR2V0RXhwcmVzc2lvbkZ1bmModGhpcy5fZXhwcmVzc2lvbk51bWJlcikoKQogICAgfQp9CmNsYXNzIExheWVyRXhwcmVzc2lvblBhcmFtZXRlciBleHRlbmRzIEV4cHJlc3Npb25QYXJhbWV0ZXIgewogICAgY29uc3RydWN0b3IoYSwgYiwgZCwgYykgewogICAgICAgIHN1cGVyKGEsIGIsIGQsIGMpOwogICAgICAgIHRoaXMuR2V0ID0gdGhpcy5HZXRMYXllcjsKICAgICAgICB0aGlzLl9pc0NvbnN0YW50ID0gITEKICAgIH0KICAgIEdldExheWVyKGEpIHsKICAgICAgICB0aGlzLl9zb2xJbmRleCA9IGE7CiAgICAgICAgYSA9IHRoaXMuX2V4cHJlc3Npb25GdW5jKCk7CiAgICAgICAgcmV0dXJuIHRoaXMuR2V0UnVudGltZSgpLkdldEN1cnJlbnRMYXlvdXQoKS5HZXRMYXllcihhKQogICAgfQp9CmNsYXNzIENvbWJvUGFyYW1ldGVyIGV4dGVuZHMgQzMkanNjb21wJDEzNS5QYXJhbWV0ZXIgewogICAgY29uc3RydWN0b3IoYSwgYiwgZCwgYykgewogICAgICAgIHN1cGVyKGEsIGIsIGQpOwogICAgICAgIHRoaXMuX2NvbWJvID0gY1sxXTsKICAgICAgICB0aGlzLkdldCA9IHRoaXMuR2V0Q29tYm87CiAgICAgICAgdGhpcy5faXNDb25zdGFudCA9ICEwCiAgICB9CiAgICBHZXRDb21ibygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fY29tYm8KICAgIH0KfQpjbGFzcyBCb29sZWFuUGFyYW1ldGVyIGV4dGVuZHMgQzMkanNjb21wJDEzNS5QYXJhbWV0ZXIgewogICAgY29uc3RydWN0b3IoYSwgYiwgZCwgYykgewogICAgICAgIHN1cGVyKGEsIGIsIGQpOwogICAgICAgIHRoaXMuX2Jvb2wgPSBjWzFdOwogICAgICAgIHRoaXMuR2V0ID0gdGhpcy5HZXRCb29sZWFuOwogICAgICAgIHRoaXMuX2lzQ29uc3RhbnQgPSAhMAogICAgfQogICAgR2V0Qm9vbGVhbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5fYm9vbAogICAgfQp9CmNsYXNzIE9iamVjdFBhcmFtZXRlciBleHRlbmRzIEMzJGpzY29tcCQxMzUuUGFyYW1ldGVyIHsKICAgIGNvbnN0cnVjdG9yKGEsIGIsIGQsIGMpIHsKICAgICAgICBzdXBlcihhLCBiLCBkKTsKICAgICAgICB0aGlzLl9vYmplY3RDbGFzcyA9IHRoaXMuR2V0UnVudGltZSgpLkdldE9iamVjdENsYXNzQnlJbmRleChjWzFdKTsKICAgICAgICB0aGlzLkdldCA9IHRoaXMuR2V0T2JqZWN0Q2xhc3M7CiAgICAgICAgYSA9IHRoaXMuR2V0RXZlbnRCbG9jaygpOwogICAgICAgIGEuX0FkZFNvbE1vZGlmaWVyKHRoaXMuX29iamVjdENsYXNzKTsKICAgICAgICB0aGlzLl9vd25lciBpbnN0YW5jZW9mIEMzJGpzY29tcCQxMzUuQWN0aW9uID8gYS5TZXRTb2xXcml0ZXJBZnRlckNuZHMoKSA6IGEuR2V0UGFyZW50KCkgJiYgYS5HZXRQYXJlbnQoKS5TZXRTb2xXcml0ZXJBZnRlckNuZHMoKTsKICAgICAgICB0aGlzLl9pc0NvbnN0YW50ID0gITAKICAgIH0KICAgIEdldE9iamVjdENsYXNzKCkgewogICAgICAgIHJldHVybiB0aGlzLl9vYmplY3RDbGFzcwogICAgfQp9CmNsYXNzIExheW91dFBhcmFtZXRlciBleHRlbmRzIEMzJGpzY29tcCQxMzUuUGFyYW1ldGVyIHsKICAgIGNvbnN0cnVjdG9yKGEsIGIsIGQsIGMpIHsKICAgICAgICBzdXBlcihhLCBiLCBkKTsKICAgICAgICB0aGlzLl9sYXlvdXQgPSB0aGlzLkdldFJ1bnRpbWUoKS5HZXRMYXlvdXRNYW5hZ2VyKCkuR2V0TGF5b3V0QnlOYW1lKGNbMV0pOwogICAgICAgIHRoaXMuR2V0ID0gdGhpcy5HZXRMYXlvdXQ7CiAgICAgICAgdGhpcy5faXNDb25zdGFudCA9ICEwCiAgICB9CiAgICBHZXRMYXlvdXQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2xheW91dAogICAgfQp9CmNsYXNzIFRpbWVsaW5lUGFyYW1ldGVyIGV4dGVuZHMgQzMkanNjb21wJDEzNS5QYXJhbWV0ZXIgewogICAgY29uc3RydWN0b3IoYSwgYiwgZCwgYykgewogICAgICAgIHN1cGVyKGEsIGIsIGQpOwogICAgICAgIHRoaXMuX3RpbWVsaW5lID0gdGhpcy5HZXRSdW50aW1lKCkuR2V0VGltZWxpbmVNYW5hZ2VyKCkuR2V0VGltZWxpbmVCeU5hbWUoY1sxXSk7CiAgICAgICAgdGhpcy5HZXQgPSB0aGlzLkdldFRpbWVsaW5lOwogICAgICAgIHRoaXMuX2lzQ29uc3RhbnQgPSAhMAogICAgfQogICAgR2V0VGltZWxpbmUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3RpbWVsaW5lCiAgICB9Cn0KY2xhc3MgRmlsZVBhcmFtZXRlciBleHRlbmRzIEMzJGpzY29tcCQxMzUuUGFyYW1ldGVyIHsKICAgIGNvbnN0cnVjdG9yKGEsIGIsIGQsIGMpIHsKICAgICAgICBzdXBlcihhLCBiLCBkKTsKICAgICAgICB0aGlzLl9maWxlSW5mbyA9IGNbMV07CiAgICAgICAgdGhpcy5HZXQgPSB0aGlzLkdldEZpbGU7CiAgICAgICAgdGhpcy5faXNDb25zdGFudCA9ICEwCiAgICB9CiAgICBHZXRGaWxlKCkgewogICAgICAgIHJldHVybiB0aGlzLl9maWxlSW5mbwogICAgfQp9CmNsYXNzIEluc3RWYXJQYXJhbWV0ZXIgZXh0ZW5kcyBDMyRqc2NvbXAkMTM1LlBhcmFtZXRlciB7CiAgICBjb25zdHJ1Y3RvcihhLCBiLCBkLCBjKSB7CiAgICAgICAgc3VwZXIoYSwgYiwgZCk7CiAgICAgICAgdGhpcy5faW5zdFZhckluZGV4ID0gY1sxXTsKICAgICAgICAoYSA9IHRoaXMuX293bmVyLkdldE9iamVjdENsYXNzKCkpICYmIGEuSXNGYW1pbHkoKSA/ICh0aGlzLkdldCA9IHRoaXMuR2V0RmFtaWx5SW5zdGFuY2VWYXJpYWJsZSwgdGhpcy5TZXRWYXJpZXNQZXJJbnN0YW5jZSgpKSA6ICh0aGlzLkdldCA9IHRoaXMuR2V0SW5zdGFuY2VWYXJpYWJsZSwgdGhpcy5faXNDb25zdGFudCA9ICEwKQogICAgfQogICAgR2V0SW5zdGFuY2VWYXJpYWJsZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5faW5zdFZhckluZGV4CiAgICB9CiAgICBHZXRGYW1pbHlJbnN0YW5jZVZhcmlhYmxlKGEpIHsKICAgICAgICBhID0gYSB8fCAwOwogICAgICAgIGNvbnN0IGIgPSB0aGlzLl9vd25lci5HZXRPYmplY3RDbGFzcygpOwogICAgICAgIHZhciBkID0gYi5HZXRDdXJyZW50U29sKCk7CiAgICAgICAgY29uc3QgYyA9IGQuR2V0SW5zdGFuY2VzKCk7CiAgICAgICAgaWYgKGMubGVuZ3RoKSBhID0gY1thICUgYy5sZW5ndGhdLkdldE9iamVjdENsYXNzKCk7CiAgICAgICAgZWxzZSBpZiAoZC5IYXNBbnlFbHNlSW5zdGFuY2VzKCkpIGQgPSBkLkdldEVsc2VJbnN0YW5jZXMoKSwgYSA9IGRbYSAlIGQubGVuZ3RoXS5HZXRPYmplY3RDbGFzcygpOwogICAgICAgIGVsc2UgaWYgKDAgPCBiLkdldEluc3RhbmNlQ291bnQoKSkgZCA9IGIuR2V0SW5zdGFuY2VzKCksIGEgPSBkW2EgJSBkLmxlbmd0aF0uR2V0T2JqZWN0Q2xhc3MoKTsKICAgICAgICBlbHNlIHJldHVybiAwOwogICAgICAgIHJldHVybiB0aGlzLl9pbnN0VmFySW5kZXggKyBhLkdldEZhbWlseUluc3RhbmNlVmFyaWFibGVPZmZzZXQoYi5HZXRGYW1pbHlJbmRleCgpKQogICAgfQp9CmNsYXNzIEV2ZW50VmFyUGFyYW1ldGVyIGV4dGVuZHMgQzMkanNjb21wJDEzNS5QYXJhbWV0ZXIgewogICAgY29uc3RydWN0b3IoYSwgYiwgZCwgYykgewogICAgICAgIHN1cGVyKGEsIGIsIGQpOwogICAgICAgIHRoaXMuX2V2ZW50VmFyU2lkID0gY1sxXTsKICAgICAgICB0aGlzLl9ldmVudFZhciA9IG51bGw7CiAgICAgICAgdGhpcy5HZXQgPSB0aGlzLkdldEV2ZW50VmFyaWFibGU7CiAgICAgICAgdGhpcy5faXNDb25zdGFudCA9ICEwCiAgICB9CiAgICBfUG9zdEluaXQoKSB7CiAgICAgICAgdGhpcy5fZXZlbnRWYXIgPSB0aGlzLkdldFJ1bnRpbWUoKS5HZXRFdmVudFNoZWV0TWFuYWdlcigpLkdldEV2ZW50VmFyaWFibGVCeVNJRCh0aGlzLl9ldmVudFZhclNpZCkKICAgIH0KICAgIEdldEV2ZW50VmFyaWFibGUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2V2ZW50VmFyCiAgICB9Cn0KY2xhc3MgRnVuY3Rpb25QYXJhbWV0ZXIgZXh0ZW5kcyBDMyRqc2NvbXAkMTM1LlBhcmFtZXRlciB7CiAgICBjb25zdHJ1Y3RvcihhLCBiLCBkLCBjKSB7CiAgICAgICAgc3VwZXIoYSwgYiwgZCk7CiAgICAgICAgdGhpcy5fZnVuY3Rpb25CbG9ja05hbWUgPSBjWzFdOwogICAgICAgIHRoaXMuX2Z1bmN0aW9uQmxvY2sgPSBudWxsOwogICAgICAgIHRoaXMuR2V0ID0gdGhpcy5HZXRGdW5jdGlvbjsKICAgICAgICB0aGlzLl9pc0NvbnN0YW50ID0gITAKICAgIH0KICAgIF9Qb3N0SW5pdCgpIHsKICAgICAgICB0aGlzLl9mdW5jdGlvbkJsb2NrID0gdGhpcy5HZXRSdW50aW1lKCkuR2V0RXZlbnRTaGVldE1hbmFnZXIoKS5HZXRGdW5jdGlvbkJsb2NrQnlOYW1lKHRoaXMuX2Z1bmN0aW9uQmxvY2tOYW1lKTsKICAgICAgICB0aGlzLl9mdW5jdGlvbkJsb2NrTmFtZSA9IG51bGwKICAgIH0KICAgIEdldEZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiB0aGlzLl9mdW5jdGlvbkJsb2NrCiAgICB9Cn0KY2xhc3MgVmFyaWFkaWNQYXJhbWV0ZXIgZXh0ZW5kcyBDMyRqc2NvbXAkMTM1LlBhcmFtZXRlciB7CiAgICBjb25zdHJ1Y3RvcihhLCBiLCBkLCBjKSB7CiAgICAgICAgc3VwZXIoYSwgYiwgZCk7CiAgICAgICAgdGhpcy5fc3ViUGFyYW1zID0gW107CiAgICAgICAgdGhpcy5fdmFyaWFkaWNSZXQgPSBbXTsKICAgICAgICB0aGlzLl9pc0NvbnN0YW50ID0gITA7CiAgICAgICAgZm9yIChsZXQgZSA9IDEsIGcgPSBjLmxlbmd0aDsgZSA8IGc7ICsrZSkgYSA9IEMzJGpzY29tcCQxMzUuUGFyYW1ldGVyLkNyZWF0ZSh0aGlzLl9vd25lciwgY1tlXSwgMCksIHRoaXMuX3N1YlBhcmFtcy5wdXNoKGEpLCB0aGlzLl92YXJpYWRpY1JldC5wdXNoKDApLCBhLklzQ29uc3RhbnQoKSB8fCAodGhpcy5faXNDb25zdGFudCA9ICExKTsKICAgICAgICB0aGlzLkdldCA9IHRoaXMuR2V0VmFyaWFkaWMKICAgIH0KICAgIF9Qb3N0SW5pdCgpIHsKICAgICAgICBmb3IgKGNvbnN0IGEgb2YgdGhpcy5fc3ViUGFyYW1zKSBhLl9Qb3N0SW5pdCgpCiAgICB9CiAgICBHZXRWYXJpYWRpYygpIHsKICAgICAgICBjb25zdCBhID0gdGhpcy5fc3ViUGFyYW1zLAogICAgICAgICAgICBiID0gdGhpcy5fdmFyaWFkaWNSZXQ7CiAgICAgICAgZm9yIChsZXQgZCA9IDAsIGMgPSBhLmxlbmd0aDsgZCA8IGM7ICsrZCkgYltkXSA9IGFbZF0uR2V0KDApOwogICAgICAgIHJldHVybiBiCiAgICB9Cn0KY2xhc3MgRWFzZVBhcmFtZXRlciBleHRlbmRzIEMzJGpzY29tcCQxMzUuUGFyYW1ldGVyIHsKICAgIGNvbnN0cnVjdG9yKGEsIGIsIGQsIGMpIHsKICAgICAgICBzdXBlcihhLCBiLCBkKTsKICAgICAgICB0aGlzLl9lYXNlSW5kZXggPSBjWzFdOwogICAgICAgIHRoaXMuR2V0ID0gdGhpcy5HZXRFYXNlOwogICAgICAgIHRoaXMuX2lzQ29uc3RhbnQgPSAhMAogICAgfQogICAgR2V0RWFzZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZWFzZUluZGV4CiAgICB9Cn0KY2xhc3MgVGlsZW1hcEJydXNoUGFyYW1ldGVyIGV4dGVuZHMgQzMkanNjb21wJDEzNS5QYXJhbWV0ZXIgewogICAgY29uc3RydWN0b3IoYSwgYiwgZCwgYykgewogICAgICAgIHN1cGVyKGEsIGIsIGQpOwogICAgICAgIHRoaXMuX2JydXNoSW5kZXggPSBjWzFdOwogICAgICAgIHRoaXMuR2V0ID0gdGhpcy5HZXRUaWxlbWFwQnJ1c2g7CiAgICAgICAgdGhpcy5faXNDb25zdGFudCA9ICEwCiAgICB9CiAgICBHZXRUaWxlbWFwQnJ1c2goKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2JydXNoSW5kZXgKICAgIH0KfQpjbGFzcyBUZW1wbGF0ZUV4cHJlc3Npb25QYXJhbWV0ZXIgZXh0ZW5kcyBFeHByZXNzaW9uUGFyYW1ldGVyIHsKICAgIGNvbnN0cnVjdG9yKGEsIGIsIGQsIGMpIHsKICAgICAgICBzdXBlcihhLCBiLCBkLCBjKTsKICAgICAgICB0aGlzLkdldCA9IHRoaXMuR2V0VGVtcGxhdGVOYW1lOwogICAgICAgIHRoaXMuX2lzQ29uc3RhbnQgPSAhMQogICAgfQogICAgR2V0VGVtcGxhdGVOYW1lKCkgewogICAgICAgIHJldHVybiB0aGlzLl9leHByZXNzaW9uRnVuYygpCiAgICB9Cn0KInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkMTM2ID0gc2VsZi5DMzsKCmZ1bmN0aW9uIEV2YWxQYXJhbXMoYSwgYikgewogICAgZm9yIChsZXQgZCA9IDAsIGMgPSBhLmxlbmd0aDsgZCA8IGM7ICsrZCkgYltkXSA9IGFbZF0uR2V0KDApCn0KY29uc3QgRU1QVFlfUEFSQU1TX0FSUkFZID0gW10sCiAgICBub29wJGpzY29tcCQxID0gZnVuY3Rpb24oKSB7fTsKQzMkanNjb21wJDEzNi5Db25kaXRpb24gPSBjbGFzcyBleHRlbmRzIEMzJGpzY29tcCQxMzYuRGVmZW5kZWRCYXNlIHsKICAgIGNvbnN0cnVjdG9yKGEsIGIsIGQpIHsKICAgICAgICBzdXBlcigpOwogICAgICAgIHRoaXMuX2V2ZW50QmxvY2sgPSBhOwogICAgICAgIHRoaXMuX3J1bnRpbWUgPSBhLkdldFJ1bnRpbWUoKTsKICAgICAgICB0aGlzLl9pbmRleCA9IGQ7CiAgICAgICAgdGhpcy5fZnVuYyA9IHRoaXMuX3J1bnRpbWUuR2V0T2JqZWN0UmVmZXJlbmNlKGJbMV0pOwogICAgICAgIHRoaXMuX2lzVHJpZ2dlciA9IDAgPCBiWzNdOwogICAgICAgIHRoaXMuX2lzRmFzdFRyaWdnZXIgPSAyID09PSBiWzNdOwogICAgICAgIHRoaXMuX2lzTG9vcGluZyA9ICEhYls0XTsKICAgICAgICB0aGlzLl9pc0ludmVydGVkID0gISFiWzVdOwogICAgICAgIHRoaXMuX2lzU3RhdGljID0gISFiWzZdOwogICAgICAgIHRoaXMuX3NpZCA9IGJbN107CiAgICAgICAgdGhpcy5faXNJbk9yQmxvY2sgPSB0aGlzLl9ldmVudEJsb2NrLklzT3JCbG9jaygpOwogICAgICAgIHRoaXMuX2JlaGF2aW9yVHlwZSA9IHRoaXMuX29iamVjdENsYXNzID0gbnVsbDsKICAgICAgICB0aGlzLl9iZWhhdmlvckluZGV4ID0gLTE7CiAgICAgICAgdGhpcy5fc3lzdGVtUGx1Z2luID0gbnVsbDsKICAgICAgICB0aGlzLkRlYnVnUnVuID0gdGhpcy5SdW4gPSBub29wJGpzY29tcCQxOwogICAgICAgIHRoaXMuX3BhcmFtZXRlcnMgPSBbXTsKICAgICAgICB0aGlzLl9yZXN1bHRzID0gW107CiAgICAgICAgdGhpcy5fYW55UGFyYW1WYXJpZXNQZXJJbnN0YW5jZSA9ICExOwogICAgICAgIHRoaXMuX3Vuc2F2ZWREYXRhID0gdGhpcy5fc2F2ZWREYXRhID0gbnVsbDsKICAgICAgICB0aGlzLl9kZWJ1Z0RhdGEgPSB0aGlzLl9ydW50aW1lLklzRGVidWcoKSA/IHsKICAgICAgICAgICAgaXNCcmVha3BvaW50OiBiWzhdWzBdLAogICAgICAgICAgICBjYW5EZWJ1ZzogYls4XVsxXQogICAgICAgIH0gOiBudWxsOyAtIDEgPT09IGJbMF0gPyB0aGlzLl9zeXN0ZW1QbHVnaW4gPSB0aGlzLl9ydW50aW1lLkdldFN5c3RlbVBsdWdpbigpIDogKHRoaXMuX29iamVjdENsYXNzID0gdGhpcy5fcnVudGltZS5HZXRPYmplY3RDbGFzc0J5SW5kZXgoYlswXSksIGJbMl0gJiYgKHRoaXMuX2JlaGF2aW9yVHlwZSA9IHRoaXMuX29iamVjdENsYXNzLkdldEJlaGF2aW9yVHlwZUJ5TmFtZShiWzJdKSwgdGhpcy5fYmVoYXZpb3JJbmRleCA9IHRoaXMuX29iamVjdENsYXNzLkdldEJlaGF2aW9ySW5kZXhCeU5hbWUoYlsyXSkpLCB0aGlzLl9ldmVudEJsb2NrLkdldFBhcmVudCgpICYmIHRoaXMuX2V2ZW50QmxvY2suR2V0UGFyZW50KCkuU2V0U29sV3JpdGVyQWZ0ZXJDbmRzKCkpOwogICAgICAgIGlmICgxMCA9PT0gYi5sZW5ndGgpIHsKICAgICAgICAgICAgYSA9IGJbOV07CiAgICAgICAgICAgIGZvciAobGV0IGMgb2YgYSkgdGhpcy5fcGFyYW1ldGVycy5wdXNoKEMzJGpzY29tcCQxMzYuUGFyYW1ldGVyLkNyZWF0ZSh0aGlzLCBjLCB0aGlzLl9wYXJhbWV0ZXJzLmxlbmd0aCkpLCB0aGlzLl9yZXN1bHRzLnB1c2goMCkKICAgICAgICB9CiAgICAgICAgMCA9PT0gdGhpcy5fcGFyYW1ldGVycy5sZW5ndGggJiYgKHRoaXMuX3Jlc3VsdHMgPSB0aGlzLl9wYXJhbWV0ZXJzID0gRU1QVFlfUEFSQU1TX0FSUkFZKTsKICAgICAgICB0aGlzLl9ldmVudEJsb2NrLkdldEV2ZW50U2hlZXRNYW5hZ2VyKCkuX1JlZ2lzdGVyQ29uZGl0aW9uKHRoaXMpCiAgICB9CiAgICBzdGF0aWMgQ3JlYXRlKGEsIGIsIGQpIHsKICAgICAgICByZXR1cm4gQzMkanNjb21wJDEzNi5OZXcoQzMkanNjb21wJDEzNi5Db25kaXRpb24sIGEsIGIsIGQpCiAgICB9CiAgICBfUG9zdEluaXQoKSB7CiAgICAgICAgZm9yIChjb25zdCBhIG9mIHRoaXMuX3BhcmFtZXRlcnMpIGEuX1Bvc3RJbml0KCksIGEuVmFyaWVzUGVySW5zdGFuY2UoKSAmJiAodGhpcy5fYW55UGFyYW1WYXJpZXNQZXJJbnN0YW5jZSA9ICEwKTsKICAgICAgICB0aGlzLl9pc0Zhc3RUcmlnZ2VyID8KICAgICAgICAgICAgKHRoaXMuUnVuID0gdGhpcy5fUnVuRmFzdFRyaWdnZXIsIHRoaXMuRGVidWdSdW4gPSB0aGlzLl9EZWJ1Z1J1bkZhc3RUcmlnZ2VyKSA6IHRoaXMuX3N5c3RlbVBsdWdpbiA/ICh0aGlzLl9TZXRTeXN0ZW1SdW5NZXRob2QoKSwgdGhpcy5EZWJ1Z1J1biA9IHRoaXMuX0RlYnVnUnVuU3lzdGVtKSA6IHRoaXMuX29iamVjdENsYXNzLkdldFBsdWdpbigpLklzU2luZ2xlR2xvYmFsKCkgPyAodGhpcy5fU2V0U2luZ2xlR2xvYmFsUnVuTWV0aG9kKCksIHRoaXMuRGVidWdSdW4gPSB0aGlzLl9EZWJ1Z1J1blNpbmdsZUdsb2JhbCkgOiB0aGlzLl9pc1N0YXRpYyA/ICh0aGlzLlJ1biA9IHRoaXMuX1J1blN0YXRpYywgdGhpcy5EZWJ1Z1J1biA9IHRoaXMuX0RlYnVnUnVuU3RhdGljKSA6ICh0aGlzLlJ1biA9IHRoaXMuX1J1bk9iamVjdCwgdGhpcy5EZWJ1Z1J1biA9IHRoaXMuX0RlYnVnUnVuT2JqZWN0KQogICAgfQogICAgX1NldFN5c3RlbVJ1bk1ldGhvZCgpIHsKICAgICAgICB0aGlzLl9TZXRSdW5NZXRob2RGb3JCb3VuZEZ1bmModGhpcy5fc3lzdGVtUGx1Z2luLCB0aGlzLl9zeXN0ZW1QbHVnaW4sCiAgICAgICAgICAgIHRoaXMuX1J1blN5c3RlbSkKICAgIH0KICAgIF9TZXRTaW5nbGVHbG9iYWxSdW5NZXRob2QoKSB7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuX29iamVjdENsYXNzLkdldFBsdWdpbigpLAogICAgICAgICAgICBiID0gdGhpcy5fb2JqZWN0Q2xhc3MuR2V0U2luZ2xlR2xvYmFsSW5zdGFuY2UoKS5HZXRTZGtJbnN0YW5jZSgpOwogICAgICAgIHRoaXMuX1NldFJ1bk1ldGhvZEZvckJvdW5kRnVuYyhhLCBiLCB0aGlzLl9SdW5TaW5nbGVHbG9iYWwpCiAgICB9CiAgICBfU2V0UnVuTWV0aG9kRm9yQm91bmRGdW5jKGEsIGIsIGQpIHsKICAgICAgICBjb25zdCBjID0gdGhpcy5fZnVuYywKICAgICAgICAgICAgZSA9IHRoaXMuX2lzSW52ZXJ0ZWQsCiAgICAgICAgICAgIGcgPSB0aGlzLl9wYXJhbWV0ZXJzOwogICAgICAgIGlmICgwID09PSBnLmxlbmd0aCkgewogICAgICAgICAgICBjb25zdCBrID0gYS5fR2V0Qm91bmRBQ0VNZXRob2QoYywgYik7CiAgICAgICAgICAgIHRoaXMuUnVuID0gZSA/IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIEMzJGpzY29tcCQxMzYueG9yKGsoKSwgZSkKICAgICAgICAgICAgfSA6IGsKICAgICAgICB9IGVsc2UgaWYgKDEgPT09IGcubGVuZ3RoKSB7CiAgICAgICAgICAgIGNvbnN0IGsgPSBnWzBdOwogICAgICAgICAgICBpZiAoIWUgJiYgay5Jc0NvbnN0YW50KCkpIHRoaXMuUnVuID0gYS5fR2V0Qm91bmRBQ0VNZXRob2RfMXBhcmFtKGMsIGIsIGsuR2V0KDApKTsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBjb25zdCBtID0gYS5fR2V0Qm91bmRBQ0VNZXRob2QoYywgYik7CiAgICAgICAgICAgICAgICB0aGlzLlJ1biA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBDMyRqc2NvbXAkMTM2LnhvcihtKGsuR2V0KDApKSwgZSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoMiA9PT0gZy5sZW5ndGgpIHsKICAgICAgICAgICAgY29uc3QgayA9IGdbMF0sCiAgICAgICAgICAgICAgICBtID0gZ1sxXTsKICAgICAgICAgICAgaWYgKCFlICYmIGsuSXNDb25zdGFudCgpICYmIG0uSXNDb25zdGFudCgpKSB0aGlzLlJ1biA9IGEuX0dldEJvdW5kQUNFTWV0aG9kXzJwYXJhbXMoYywgYiwgay5HZXQoMCksIG0uR2V0KDApKTsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBjb25zdCBuID0gYS5fR2V0Qm91bmRBQ0VNZXRob2QoYywgYik7CiAgICAgICAgICAgICAgICB0aGlzLlJ1biA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBDMyRqc2NvbXAkMTM2LnhvcihuKGsuR2V0KDApLCBtLkdldCgwKSksIGUpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKDMgPT09IGcubGVuZ3RoKSB7CiAgICAgICAgICAgIGNvbnN0IGsgPSBnWzBdLAogICAgICAgICAgICAgICAgbSA9IGdbMV0sCiAgICAgICAgICAgICAgICBuID0gZ1syXTsKICAgICAgICAgICAgaWYgKCFlICYmIGsuSXNDb25zdGFudCgpICYmIG0uSXNDb25zdGFudCgpICYmIG4uSXNDb25zdGFudCgpKSB0aGlzLlJ1biA9IGEuX0dldEJvdW5kQUNFTWV0aG9kXzNwYXJhbXMoYywgYiwgay5HZXQoMCksCiAgICAgICAgICAgICAgICBtLkdldCgwKSwgbi5HZXQoMCkpOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbnN0IHEgPSBhLl9HZXRCb3VuZEFDRU1ldGhvZChjLCBiKTsKICAgICAgICAgICAgICAgIHRoaXMuUnVuID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEMzJGpzY29tcCQxMzYueG9yKHEoay5HZXQoMCksIG0uR2V0KDApLCBuLkdldCgwKSksIGUpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgdGhpcy5SdW4gPSBkCiAgICB9CiAgICBHZXRTSUQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3NpZAogICAgfQogICAgX0dldEZ1bmMoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2Z1bmMKICAgIH0KICAgIEdldE9iamVjdENsYXNzKCkgewogICAgICAgIHJldHVybiB0aGlzLl9vYmplY3RDbGFzcwogICAgfQogICAgR2V0QmVoYXZpb3JUeXBlKCkgewogICAgICAgIHJldHVybiB0aGlzLl9iZWhhdmlvclR5cGUKICAgIH0KICAgIEdldEV2ZW50QmxvY2soKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2V2ZW50QmxvY2sKICAgIH0KICAgIEdldFJ1bnRpbWUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUKICAgIH0KICAgIEdldEluZGV4KCkgewogICAgICAgIHJldHVybiB0aGlzLl9pbmRleAogICAgfQogICAgR2V0RGVidWdJbmRleCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5HZXRJbmRleCgpCiAgICB9CiAgICBJc1RyaWdnZXIoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2lzVHJpZ2dlcgogICAgfQogICAgSXNGYXN0VHJpZ2dlcigpIHsKICAgICAgICByZXR1cm4gdGhpcy5faXNGYXN0VHJpZ2dlcgogICAgfQogICAgSXNJbnZlcnRlZCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5faXNJbnZlcnRlZAogICAgfQogICAgSXNMb29waW5nKCkgewogICAgICAgIHJldHVybiB0aGlzLl9pc0xvb3BpbmcKICAgIH0KICAgIElzQnJlYWtwb2ludCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZGVidWdEYXRhLmlzQnJlYWtwb2ludAogICAgfQogICAgX1NldEJyZWFrcG9pbnQoYSkgewogICAgICAgIHRoaXMuX2RlYnVnRGF0YS5pc0JyZWFrcG9pbnQgPSAhIWE7CiAgICAgICAgdGhpcy5fZXZlbnRCbG9jay5fVXBkYXRlQ2FuUnVuRmFzdFJlY3Vyc2l2ZSgpCiAgICB9CiAgICBfRGVidWdSZXR1cm5zR2VuZXJhdG9yKCkgewogICAgICAgIHJldHVybiB0aGlzLl9kZWJ1Z0RhdGEuY2FuRGVidWcKICAgIH0KICAgIERlYnVnQ2FuUnVuRmFzdCgpIHsKICAgICAgICByZXR1cm4gIXRoaXMuSXNCcmVha3BvaW50KCkgJiYgIXRoaXMuX3J1bnRpbWUuRGVidWdCcmVha05leHQoKSAmJiAhdGhpcy5fRGVidWdSZXR1cm5zR2VuZXJhdG9yKCkKICAgIH0KICAgIEdldFNhdmVkRGF0YU1hcCgpIHsKICAgICAgICB0aGlzLl9zYXZlZERhdGEgfHwgKHRoaXMuX3NhdmVkRGF0YSA9IG5ldyBNYXApOwogICAgICAgIHJldHVybiB0aGlzLl9zYXZlZERhdGEKICAgIH0KICAgIEdldFVuc2F2ZWREYXRhTWFwKCkgewogICAgICAgIHRoaXMuX3Vuc2F2ZWREYXRhIHx8ICh0aGlzLl91bnNhdmVkRGF0YSA9IG5ldyBNYXApOwogICAgICAgIHJldHVybiB0aGlzLl91bnNhdmVkRGF0YQogICAgfQogICAgX1J1blN5c3RlbSgpIHsKICAgICAgICBjb25zdCBhID0gdGhpcy5fcmVzdWx0czsKICAgICAgICBFdmFsUGFyYW1zKHRoaXMuX3BhcmFtZXRlcnMsIGEpOwogICAgICAgIHJldHVybiBDMyRqc2NvbXAkMTM2Lnhvcih0aGlzLl9mdW5jLmFwcGx5KHRoaXMuX3N5c3RlbVBsdWdpbiwKICAgICAgICAgICAgYSksIHRoaXMuX2lzSW52ZXJ0ZWQpCiAgICB9KiBfRGVidWdSdW5TeXN0ZW0oKSB7CiAgICAgICAgaWYgKHRoaXMuSXNCcmVha3BvaW50KCkgfHwgdGhpcy5fcnVudGltZS5EZWJ1Z0JyZWFrTmV4dCgpKSB5aWVsZCB0aGlzOwogICAgICAgIGlmICh0aGlzLl9EZWJ1Z1JldHVybnNHZW5lcmF0b3IoKSkgewogICAgICAgICAgICB2YXIgYSA9IHRoaXMuX3Jlc3VsdHM7CiAgICAgICAgICAgIEV2YWxQYXJhbXModGhpcy5fcGFyYW1ldGVycywgYSk7CiAgICAgICAgICAgIGEgPSB0aGlzLl9mdW5jLmFwcGx5KHRoaXMuX3N5c3RlbVBsdWdpbiwgYSk7CiAgICAgICAgICAgIEMzJGpzY29tcCQxMzYuSXNJdGVyYXRvcihhKSAmJiAoYSA9IHlpZWxkKiBhKTsKICAgICAgICAgICAgcmV0dXJuIEMzJGpzY29tcCQxMzYueG9yKGEsIHRoaXMuX2lzSW52ZXJ0ZWQpCiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzLlJ1bigpCiAgICB9CiAgICBfUnVuU2luZ2xlR2xvYmFsKCkgewogICAgICAgIGNvbnN0IGEgPSB0aGlzLl9yZXN1bHRzOwogICAgICAgIEV2YWxQYXJhbXModGhpcy5fcGFyYW1ldGVycywgYSk7CiAgICAgICAgY29uc3QgYiA9IHRoaXMuX29iamVjdENsYXNzLkdldFNpbmdsZUdsb2JhbEluc3RhbmNlKCkuR2V0U2RrSW5zdGFuY2UoKTsKICAgICAgICByZXR1cm4gQzMkanNjb21wJDEzNi54b3IodGhpcy5fZnVuYy5hcHBseShiLAogICAgICAgICAgICBhKSwgdGhpcy5faXNJbnZlcnRlZCkKICAgIH0qIF9EZWJ1Z1J1blNpbmdsZUdsb2JhbCgpIHsKICAgICAgICBpZiAodGhpcy5Jc0JyZWFrcG9pbnQoKSB8fCB0aGlzLl9ydW50aW1lLkRlYnVnQnJlYWtOZXh0KCkpIHlpZWxkIHRoaXM7CiAgICAgICAgaWYgKHRoaXMuX0RlYnVnUmV0dXJuc0dlbmVyYXRvcigpKSB7CiAgICAgICAgICAgIHZhciBhID0gdGhpcy5fcmVzdWx0czsKICAgICAgICAgICAgRXZhbFBhcmFtcyh0aGlzLl9wYXJhbWV0ZXJzLCBhKTsKICAgICAgICAgICAgY29uc3QgYiA9IHRoaXMuX29iamVjdENsYXNzLkdldFNpbmdsZUdsb2JhbEluc3RhbmNlKCkuR2V0U2RrSW5zdGFuY2UoKTsKICAgICAgICAgICAgYSA9IHRoaXMuX2Z1bmMuYXBwbHkoYiwgYSk7CiAgICAgICAgICAgIEMzJGpzY29tcCQxMzYuSXNJdGVyYXRvcihhKSAmJiAoYSA9IHlpZWxkKiBhKTsKICAgICAgICAgICAgcmV0dXJuIEMzJGpzY29tcCQxMzYueG9yKGEsIHRoaXMuX2lzSW52ZXJ0ZWQpCiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzLlJ1bigpCiAgICB9CiAgICBfUnVuRmFzdFRyaWdnZXIoKSB7CiAgICAgICAgcmV0dXJuICEwCiAgICB9KiBfRGVidWdSdW5GYXN0VHJpZ2dlcigpIHsKICAgICAgICBpZiAodGhpcy5Jc0JyZWFrcG9pbnQoKSB8fCB0aGlzLl9ydW50aW1lLkRlYnVnQnJlYWtOZXh0KCkpIHlpZWxkIHRoaXM7CiAgICAgICAgcmV0dXJuICEwCiAgICB9CiAgICBfUnVuU3RhdGljKCkgewogICAgICAgIHZhciBhID0gdGhpcy5fcmVzdWx0czsKICAgICAgICBFdmFsUGFyYW1zKHRoaXMuX3BhcmFtZXRlcnMsIGEpOwogICAgICAgIGEgPSB0aGlzLl9mdW5jLmFwcGx5KHRoaXMuX2JlaGF2aW9yVHlwZSB8fCB0aGlzLl9vYmplY3RDbGFzcywgYSk7CiAgICAgICAgdGhpcy5fb2JqZWN0Q2xhc3MuQXBwbHlTb2xUb0NvbnRhaW5lcigpOwogICAgICAgIHJldHVybiBhCiAgICB9KiBfRGVidWdSdW5TdGF0aWMoKSB7CiAgICAgICAgaWYgKHRoaXMuSXNCcmVha3BvaW50KCkgfHwgdGhpcy5fcnVudGltZS5EZWJ1Z0JyZWFrTmV4dCgpKSB5aWVsZCB0aGlzOwogICAgICAgIGlmICh0aGlzLl9EZWJ1Z1JldHVybnNHZW5lcmF0b3IoKSkgewogICAgICAgICAgICB2YXIgYSA9IHRoaXMuX3Jlc3VsdHM7CiAgICAgICAgICAgIEV2YWxQYXJhbXModGhpcy5fcGFyYW1ldGVycywgYSk7CiAgICAgICAgICAgIGEgPSB0aGlzLl9mdW5jLmFwcGx5KHRoaXMuX2JlaGF2aW9yVHlwZSB8fCB0aGlzLl9vYmplY3RDbGFzcywgYSk7CiAgICAgICAgICAgIEMzJGpzY29tcCQxMzYuSXNJdGVyYXRvcihhKSAmJiAoYSA9IHlpZWxkKiBhKTsKICAgICAgICAgICAgdGhpcy5fb2JqZWN0Q2xhc3MuQXBwbHlTb2xUb0NvbnRhaW5lcigpOwogICAgICAgICAgICByZXR1cm4gYQogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpcy5SdW4oKQogICAgfQogICAgX1J1bk9iamVjdCgpIHsKICAgICAgICBjb25zdCBhID0KICAgICAgICAgICAgdGhpcy5fcGFyYW1ldGVycywKICAgICAgICAgICAgYiA9IHRoaXMuX3Jlc3VsdHMsCiAgICAgICAgICAgIGQgPSB0aGlzLl9vYmplY3RDbGFzcy5HZXRDdXJyZW50U29sKCk7CiAgICAgICAgZm9yIChsZXQgYyA9IDAsIGUgPSBhLmxlbmd0aDsgYyA8IGU7ICsrYykgewogICAgICAgICAgICBjb25zdCBnID0gYVtjXTsKICAgICAgICAgICAgZy5WYXJpZXNQZXJJbnN0YW5jZSgpIHx8IChiW2NdID0gZy5HZXQoMCkpCiAgICAgICAgfQogICAgICAgIHJldHVybiBkLklzU2VsZWN0QWxsKCkgPyB0aGlzLl9SdW5PYmplY3RfRmlyc3RGaWx0ZXIoZCkgOiB0aGlzLl9SdW5PYmplY3RfTmV4dEZpbHRlcihkKQogICAgfSogX0RlYnVnUnVuT2JqZWN0KCkgewogICAgICAgIGlmICh0aGlzLklzQnJlYWtwb2ludCgpIHx8IHRoaXMuX3J1bnRpbWUuRGVidWdCcmVha05leHQoKSkgeWllbGQgdGhpczsKICAgICAgICByZXR1cm4gdGhpcy5fUnVuT2JqZWN0KCkKICAgIH0KICAgIF9FdmFsdWF0ZVZhcnlpbmdQYXJhbWV0ZXJzKGEpIHsKICAgICAgICBjb25zdCBiID0gdGhpcy5fcGFyYW1ldGVycywKICAgICAgICAgICAgZCA9IHRoaXMuX3Jlc3VsdHM7CiAgICAgICAgZm9yIChsZXQgYyA9IDAsIGUgPSBiLmxlbmd0aDsgYyA8IGU7ICsrYykgewogICAgICAgICAgICBjb25zdCBnID0gYltjXTsKICAgICAgICAgICAgZy5WYXJpZXNQZXJJbnN0YW5jZSgpICYmIChkW2NdID0gZy5HZXQoYSkpCiAgICAgICAgfQogICAgfQogICAgX1J1bk9iamVjdF9GaXJzdEZpbHRlcihhKSB7CiAgICAgICAgY29uc3QgYiA9CiAgICAgICAgICAgIHRoaXMuX29iamVjdENsYXNzLAogICAgICAgICAgICBkID0gYi5Jc0ZhbWlseSgpLAogICAgICAgICAgICBjID0gYi5HZXRGYW1pbHlJbmRleCgpLAogICAgICAgICAgICBlID0gdGhpcy5fYmVoYXZpb3JJbmRleCwKICAgICAgICAgICAgZyA9IDAgPD0gZSwKICAgICAgICAgICAgayA9IGIuR2V0SW5zdGFuY2VzKCksCiAgICAgICAgICAgIG0gPSB0aGlzLl9hbnlQYXJhbVZhcmllc1Blckluc3RhbmNlLAogICAgICAgICAgICBuID0gdGhpcy5fcmVzdWx0cywKICAgICAgICAgICAgcSA9IHRoaXMuX2Z1bmMsCiAgICAgICAgICAgIHUgPSB0aGlzLl9pc0ludmVydGVkLAogICAgICAgICAgICB3ID0gdGhpcy5faXNJbk9yQmxvY2sgJiYgIXRoaXMuX2lzVHJpZ2dlcjsKICAgICAgICBhLkNsZWFyQXJyYXlzKCk7CiAgICAgICAgZm9yIChsZXQgQyA9IDAsIEQgPSBrLmxlbmd0aDsgQyA8IEQ7ICsrQykgewogICAgICAgICAgICBjb25zdCBGID0ga1tDXTsKICAgICAgICAgICAgbSAmJiB0aGlzLl9FdmFsdWF0ZVZhcnlpbmdQYXJhbWV0ZXJzKEMpOwogICAgICAgICAgICB2YXIgeiA9IHZvaWQgMDsKICAgICAgICAgICAgZyA/ICh6ID0gZCA/IEYuR2V0T2JqZWN0Q2xhc3MoKS5HZXRGYW1pbHlCZWhhdmlvck9mZnNldChjKSA6IDAsIHogPSBxLmFwcGx5KEYuR2V0QmVoYXZpb3JJbnN0YW5jZXMoKVtlICsgel0uR2V0U2RrSW5zdGFuY2UoKSwgbikpIDogeiA9IHEuYXBwbHkoRi5HZXRTZGtJbnN0YW5jZSgpLCBuKTsKICAgICAgICAgICAgQzMkanNjb21wJDEzNi54b3IoeiwKICAgICAgICAgICAgICAgIHUpID8gYS5fUHVzaEluc3RhbmNlKEYpIDogdyAmJiBhLl9QdXNoRWxzZUluc3RhbmNlKEYpCiAgICAgICAgfQogICAgICAgIGIuRmluaXNoQ29uZGl0aW9uKCEwKTsKICAgICAgICBhLl9TZXRTZWxlY3RBbGwoITEpOwogICAgICAgIGIuQXBwbHlTb2xUb0NvbnRhaW5lcigpOwogICAgICAgIHJldHVybiBhLkhhc0FueUluc3RhbmNlcygpCiAgICB9CiAgICBfUnVuT2JqZWN0X05leHRGaWx0ZXIoYSkgewogICAgICAgIGNvbnN0IGIgPSB0aGlzLl9vYmplY3RDbGFzczsKICAgICAgICB2YXIgZCA9IGIuSXNGYW1pbHkoKTsKICAgICAgICBjb25zdCBjID0gYi5HZXRGYW1pbHlJbmRleCgpLAogICAgICAgICAgICBlID0gYi5Jc0luQ29udGFpbmVyKCksCiAgICAgICAgICAgIGcgPSB0aGlzLl9iZWhhdmlvckluZGV4LAogICAgICAgICAgICBrID0gMCA8PSBnLAogICAgICAgICAgICBtID0gdGhpcy5fYW55UGFyYW1WYXJpZXNQZXJJbnN0YW5jZSwKICAgICAgICAgICAgbiA9IHRoaXMuX3Jlc3VsdHMsCiAgICAgICAgICAgIHEgPSB0aGlzLl9mdW5jLAogICAgICAgICAgICB1ID0gdGhpcy5faXNJbnZlcnRlZCwKICAgICAgICAgICAgdyA9IHRoaXMuX2lzSW5PckJsb2NrICYmICF0aGlzLl9pc1RyaWdnZXIsCiAgICAgICAgICAgIHogPSBhLl9HZXRPd25JbnN0YW5jZXMoKSwKICAgICAgICAgICAgQyA9IGEuX0dldE93bkVsc2VJbnN0YW5jZXMoKSwKICAgICAgICAgICAgRCA9IHcgJiYgIXRoaXMuX2V2ZW50QmxvY2suSXNGaXJzdENvbmRpdGlvbk9mVHlwZSh0aGlzKSwKICAgICAgICAgICAgRiA9IEQgPyBDIDogejsKICAgICAgICBsZXQgRSA9IDAsCiAgICAgICAgICAgIEogPSAhMTsKICAgICAgICBmb3IgKGxldCBPID0gMCwgViA9IEYubGVuZ3RoOyBPIDwgVjsgKytPKSB7CiAgICAgICAgICAgIGNvbnN0IFcgPSBGW09dOwogICAgICAgICAgICBtICYmIHRoaXMuX0V2YWx1YXRlVmFyeWluZ1BhcmFtZXRlcnMoTyk7CiAgICAgICAgICAgIHZhciBLID0gdm9pZCAwOwogICAgICAgICAgICBrID8gKEsgPSBkID8gVy5HZXRPYmplY3RDbGFzcygpLkdldEZhbWlseUJlaGF2aW9yT2Zmc2V0KGMpIDogMCwgSyA9IHEuYXBwbHkoVy5HZXRCZWhhdmlvckluc3RhbmNlcygpW2cgKyBLXS5HZXRTZGtJbnN0YW5jZSgpLCBuKSkgOiBLID0gcS5hcHBseShXLkdldFNka0luc3RhbmNlKCksIG4pOwogICAgICAgICAgICBDMyRqc2NvbXAkMTM2LnhvcihLLCB1KSA/IChKID0gITAsIEQgPyAoei5wdXNoKFcpLCBlICYmIFcuX1B1c2hTaWJsaW5nc1RvU29sSW5zdGFuY2VzKCkpIDogKEZbRV0gPSBXLCBlICYmIFcuX1NldFNpYmxpbmdzVG9Tb2xJbnN0YW5jZXNJbmRleChFKSwgKytFKSkgOiBEID8gKEZbRV0gPSBXLCBlICYmIFcuX1NldFNpYmxpbmdzVG9Tb2xFbHNlSW5zdGFuY2VzSW5kZXgoRSksICsrRSkgOiB3ICYmIChDLnB1c2goVyksIGUgJiYgVy5fUHVzaFNpYmxpbmdzVG9Tb2xFbHNlSW5zdGFuY2VzKCkpCiAgICAgICAgfQogICAgICAgIEMzJGpzY29tcCQxMzYudHJ1bmNhdGVBcnJheShGLAogICAgICAgICAgICBFKTsKICAgICAgICBlICYmIGIuX1RydW5jYXRlQ29udGFpbmVyU29scyhELCBFKTsKICAgICAgICBkID0gSjsKICAgICAgICBEICYmICFKICYmIChKID0gdGhpcy5fT3JCbG9ja0NoZWNrSW5zdGFuY2VzKHopKTsKICAgICAgICBiLkZpbmlzaENvbmRpdGlvbihkIHx8IHcpOwogICAgICAgIHJldHVybiB3ID8gSiA6IGEuSGFzQW55SW5zdGFuY2VzKCkKICAgIH0KICAgIF9PckJsb2NrQ2hlY2tJbnN0YW5jZXMoYSkgewogICAgICAgIHZhciBiID0gdGhpcy5fb2JqZWN0Q2xhc3M7CiAgICAgICAgY29uc3QgZCA9IGIuSXNGYW1pbHkoKTsKICAgICAgICBiID0gYi5HZXRGYW1pbHlJbmRleCgpOwogICAgICAgIGNvbnN0IGMgPSB0aGlzLl9hbnlQYXJhbVZhcmllc1Blckluc3RhbmNlLAogICAgICAgICAgICBlID0gdGhpcy5fYmVoYXZpb3JJbmRleCwKICAgICAgICAgICAgZyA9IDAgPD0gZSwKICAgICAgICAgICAgayA9IHRoaXMuX3Jlc3VsdHMsCiAgICAgICAgICAgIG0gPSB0aGlzLl9mdW5jLAogICAgICAgICAgICBuID0gdGhpcy5faXNJbnZlcnRlZDsKICAgICAgICBmb3IgKGxldCB1ID0gMCwgdyA9IGEubGVuZ3RoOyB1IDwgdzsgKyt1KSB7CiAgICAgICAgICAgIHZhciBxID0gYVt1XTsKICAgICAgICAgICAgYyAmJiB0aGlzLl9FdmFsdWF0ZVZhcnlpbmdQYXJhbWV0ZXJzKHUpOwogICAgICAgICAgICBpZiAoZykgewogICAgICAgICAgICAgICAgY29uc3QgeiA9IGQgPyBxLkdldE9iamVjdENsYXNzKCkuR2V0RmFtaWx5QmVoYXZpb3JPZmZzZXQoYikgOiAwOwogICAgICAgICAgICAgICAgcSA9IG0uYXBwbHkocS5HZXRCZWhhdmlvckluc3RhbmNlcygpW2UgKwogICAgICAgICAgICAgICAgICAgIHpdLkdldFNka0luc3RhbmNlKCksIGspCiAgICAgICAgICAgIH0gZWxzZSBxID0gbS5hcHBseShxLkdldFNka0luc3RhbmNlKCksIGspOwogICAgICAgICAgICBpZiAoQzMkanNjb21wJDEzNi54b3IocSwgbikpIHJldHVybiAhMAogICAgICAgIH0KICAgICAgICByZXR1cm4gITEKICAgIH0KICAgIFJlZXZhbHVhdGVQYXJhbWV0ZXIoYSwgYikgewogICAgICAgIHJldHVybiB0aGlzLl9wYXJhbWV0ZXJzW2FdLkdldChiKQogICAgfQogICAgR2V0RmFzdFRyaWdnZXJWYWx1ZSgpIHsKICAgICAgICBjb25zdCBhID0gdGhpcy5fcGFyYW1ldGVyczsKICAgICAgICBpZiAoIWEubGVuZ3RoKSB0aHJvdyBFcnJvcigibm8gcGFyYW1ldGVycyIpOwogICAgICAgIHJldHVybiBhWzBdLl9HZXRGYXN0VHJpZ2dlclZhbHVlKCkKICAgIH0KICAgIF9TYXZlVG9Kc29uKCkgewogICAgICAgIGlmICghdGhpcy5fc2F2ZWREYXRhIHx8ICF0aGlzLl9zYXZlZERhdGEuc2l6ZSkgcmV0dXJuIG51bGw7CiAgICAgICAgY29uc3QgYSA9IHt9OwogICAgICAgIGZvciAoY29uc3QgW2IsIGRdIG9mIHRoaXMuX3NhdmVkRGF0YS5lbnRyaWVzKCkpIHsKICAgICAgICAgICAgbGV0IGMgPSBkOwogICAgICAgICAgICAiY29sbG1lbW9yeSIgPT09IGIgJiYgKGMgPSBbLi4uZC5lbnRyaWVzKCldLm1hcChlID0+IFtlWzBdLkdldFVJRCgpLCBlWzFdLkdldFVJRCgpLCBlWzJdXSkpOwogICAgICAgICAgICBhW2JdID0gYwogICAgICAgIH0KICAgICAgICByZXR1cm4gewogICAgICAgICAgICBleDogYQogICAgICAgIH0KICAgIH0KICAgIF9Mb2FkRnJvbUpzb24oYSkgewogICAgICAgIHRoaXMuX3NhdmVkRGF0YSAmJiAodGhpcy5fc2F2ZWREYXRhLmNsZWFyKCksIHRoaXMuX3NhdmVkRGF0YSA9IG51bGwpOwogICAgICAgIGlmIChhKSB7CiAgICAgICAgICAgIHZhciBiID0gdGhpcy5fcnVudGltZSwKICAgICAgICAgICAgICAgIGQgPSBhLmV4OwogICAgICAgICAgICBpZiAoZCkgewogICAgICAgICAgICAgICAgYSA9IHRoaXMuR2V0U2F2ZWREYXRhTWFwKCk7CiAgICAgICAgICAgICAgICBhLmNsZWFyKCk7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IFtjLCBlXSBvZiBPYmplY3QuZW50cmllcyhkKSkgZCA9IGUsICJjb2xsbWVtb3J5IiA9PT0gYyAmJiAoZCA9IEMzJGpzY29tcCQxMzYuTmV3KEMzJGpzY29tcCQxMzYuUGFpck1hcCwgZS5tYXAoZyA9PiBbYi5HZXRJbnN0YW5jZUJ5VUlEKGdbMF0pLCBiLkdldEluc3RhbmNlQnlVSUQoZ1sxXSksIGdbMl1dKS5maWx0ZXIoZyA9PiBnWzBdICYmIGdbMV0pKSksIGEuc2V0KGMsIGQpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn07CiJ1c2Ugc3RyaWN0IjsKY29uc3QgQzMkanNjb21wJDEzNyA9IHNlbGYuQzM7CgpmdW5jdGlvbiBFdmFsUGFyYW1zJGpzY29tcCQxKGEsIGIpIHsKICAgIGZvciAobGV0IGQgPSAwLCBjID0gYS5sZW5ndGg7IGQgPCBjOyArK2QpIGJbZF0gPSBhW2RdLkdldCgwKQp9CmNvbnN0IEVNUFRZX1BBUkFNU19BUlJBWSRqc2NvbXAkMSA9IFtdLAogICAgbm9vcCRqc2NvbXAkMiA9IGZ1bmN0aW9uKCkge30sCiAgICBub29wR2VuZXJhdG9yID0gZnVuY3Rpb24qKCkge307CkMzJGpzY29tcCQxMzcuQWN0aW9uID0gY2xhc3MgZXh0ZW5kcyBDMyRqc2NvbXAkMTM3LkRlZmVuZGVkQmFzZSB7CiAgICBjb25zdHJ1Y3RvcihhLCBiLCBkKSB7CiAgICAgICAgc3VwZXIoKTsKICAgICAgICB0aGlzLl9ldmVudEJsb2NrID0gYTsKICAgICAgICB0aGlzLl9ydW50aW1lID0gYSA9IGEuR2V0UnVudGltZSgpOwogICAgICAgIHRoaXMuX2luZGV4ID0gZDsKICAgICAgICB0aGlzLl9zaWQgPSA0IDw9IGIubGVuZ3RoID8gYlszXSA6IC0xOwogICAgICAgIHRoaXMuX2FjdGlvblR5cGUgPSA1IDw9IGIubGVuZ3RoID8gYls0XSAmIDI1NSA6IDA7CiAgICAgICAgdGhpcy5fZmxhZ3MgPSA1IDw9IGIubGVuZ3RoID8gYls0XSA+PiA4IDogMDsKICAgICAgICB0aGlzLl9iZWhhdmlvclR5cGUgPSB0aGlzLl9vYmplY3RDbGFzcyA9IHRoaXMuX2Z1bmMgPSBudWxsOwogICAgICAgIHRoaXMuX2JlaGF2aW9ySW5kZXggPSAtMTsKICAgICAgICB0aGlzLl9zeXN0ZW1QbHVnaW4gPSBudWxsOwogICAgICAgIHRoaXMuX2NhbGxGdW5jdGlvbk5hbWUgPSAiIjsKICAgICAgICB0aGlzLl9jYWxsRXZlbnRCbG9jayA9IG51bGw7CiAgICAgICAgdGhpcy5EZWJ1Z1J1biA9IHRoaXMuUnVuID0gbm9vcCRqc2NvbXAkMjsKICAgICAgICB0aGlzLl9wYXJhbWV0ZXJzID0gW107CiAgICAgICAgdGhpcy5fcmVzdWx0cyA9IFtdOwogICAgICAgIHRoaXMuX2FueVBhcmFtVmFyaWVzUGVySW5zdGFuY2UgPSAhMTsKICAgICAgICB0aGlzLl91bnNhdmVkRGF0YSA9IHRoaXMuX3NhdmVkRGF0YSA9IG51bGw7CiAgICAgICAgY29uc3QgYyA9IChkID0gLTMgPT09IGJbMF0pID8gYlsyXSA6IGJbNV07CiAgICAgICAgdGhpcy5fZGVidWdEYXRhID0gYS5Jc0RlYnVnKCkgfHwgZCA/IHsKICAgICAgICAgICAgaXNCcmVha3BvaW50OiBjWzBdLAogICAgICAgICAgICBjYW5EZWJ1ZzogY1sxXSwKICAgICAgICAgICAgaW5kZXg6IGNbMl0KICAgICAgICB9IDogbnVsbDsgLSAxID09PSBiWzBdID8gKHRoaXMuX3N5c3RlbVBsdWdpbiA9IGEuR2V0U3lzdGVtUGx1Z2luKCksIHRoaXMuX2Z1bmMgPSBhLkdldE9iamVjdFJlZmVyZW5jZShiWzFdKSkgOiAtMiA9PT0gYlswXSA/IHRoaXMuX2NhbGxGdW5jdGlvbk5hbWUgPSBiWzFdIDogZCA/ICh0aGlzLl9mdW5jID0gYS5HZXRPYmplY3RSZWZlcmVuY2UoYlsxXSksIHRoaXMuUnVuID0gdGhpcy5SdW5Vc2VyU2NyaXB0LCB0aGlzLkRlYnVnUnVuID0gdGhpcy5EZWJ1Z1J1blVzZXJTY3JpcHQsIHRoaXMuX2FjdGlvblR5cGUgPSAxKSA6ICh0aGlzLl9mdW5jID0gYS5HZXRPYmplY3RSZWZlcmVuY2UoYlsxXSksIHRoaXMuX29iamVjdENsYXNzID0gYS5HZXRPYmplY3RDbGFzc0J5SW5kZXgoYlswXSksIGJbMl0gJiYKICAgICAgICAgICAgKHRoaXMuX2JlaGF2aW9yVHlwZSA9IHRoaXMuX29iamVjdENsYXNzLkdldEJlaGF2aW9yVHlwZUJ5TmFtZShiWzJdKSwgdGhpcy5fYmVoYXZpb3JJbmRleCA9IHRoaXMuX29iamVjdENsYXNzLkdldEJlaGF2aW9ySW5kZXhCeU5hbWUoYlsyXSkpKTsKICAgICAgICBpZiAoNyA9PT0gYi5sZW5ndGgpIHsKICAgICAgICAgICAgYiA9IGJbNl07CiAgICAgICAgICAgIGZvciAoY29uc3QgZSBvZiBiKSB0aGlzLl9wYXJhbWV0ZXJzLnB1c2goQzMkanNjb21wJDEzNy5QYXJhbWV0ZXIuQ3JlYXRlKHRoaXMsIGUsIHRoaXMuX3BhcmFtZXRlcnMubGVuZ3RoKSksIHRoaXMuX3Jlc3VsdHMucHVzaCgwKQogICAgICAgIH0KICAgICAgICAwID09PSB0aGlzLl9wYXJhbWV0ZXJzLmxlbmd0aCAmJiAodGhpcy5fcmVzdWx0cyA9IHRoaXMuX3BhcmFtZXRlcnMgPSBFTVBUWV9QQVJBTVNfQVJSQVkkanNjb21wJDEpOwogICAgICAgIHRoaXMuQ2FuUGlja0FueU9iamVjdENsYXNzKCkgJiYgKHRoaXMuX2V2ZW50QmxvY2suU2V0QWxsU29sTW9kaWZpZXJzKCksIHRoaXMuX2V2ZW50QmxvY2suU2V0U29sV3JpdGVyQWZ0ZXJDbmRzKCkpOwogICAgICAgIHRoaXMuX2V2ZW50QmxvY2suR2V0RXZlbnRTaGVldE1hbmFnZXIoKS5fUmVnaXN0ZXJBY3Rpb24odGhpcykKICAgIH0KICAgIHN0YXRpYyBDcmVhdGUoYSwKICAgICAgICBiLCBkKSB7CiAgICAgICAgcmV0dXJuIEMzJGpzY29tcCQxMzcuTmV3KEMzJGpzY29tcCQxMzcuQWN0aW9uLCBhLCBiLCBkKQogICAgfQogICAgX1Bvc3RJbml0KCkgewogICAgICAgIGZvciAodmFyIGEgb2YgdGhpcy5fcGFyYW1ldGVycykgYS5fUG9zdEluaXQoKSwgYS5WYXJpZXNQZXJJbnN0YW5jZSgpICYmICh0aGlzLl9hbnlQYXJhbVZhcmllc1Blckluc3RhbmNlID0gITApOwogICAgICAgIGlmICh0aGlzLl9zeXN0ZW1QbHVnaW4pIHRoaXMuX1NldFN5c3RlbVJ1bk1ldGhvZCgpLCB0aGlzLkRlYnVnUnVuID0gdGhpcy5fRGVidWdSdW5TeXN0ZW07CiAgICAgICAgZWxzZSBpZiAodGhpcy5fY2FsbEZ1bmN0aW9uTmFtZSkgdGhpcy5fU2V0Q2FsbEZ1bmN0aW9uUnVuTWV0aG9kKCksIHRoaXMuX2NhbGxGdW5jdGlvbk5hbWUgPSAiIjsKICAgICAgICBlbHNlIGlmICh0aGlzLlJ1biA9PT0gdGhpcy5SdW5Vc2VyU2NyaXB0KSB7CiAgICAgICAgICAgIGEgPSB0aGlzLl9mdW5jOwogICAgICAgICAgICBjb25zdCBiID0gdGhpcy5fcnVudGltZS5HZXRFdmVudFNoZWV0TWFuYWdlcigpLl9HZXRMb2NhbFZhcmlhYmxlc1NjcmlwdEludGVyZmFjZSh0aGlzLl9ldmVudEJsb2NrKTsKICAgICAgICAgICAgdGhpcy5fZnVuYyA9CiAgICAgICAgICAgICAgICBhLmJpbmQobnVsbCwgdGhpcy5fcnVudGltZS5HZXRJUnVudGltZSgpLCBiKQogICAgICAgIH0gZWxzZSB0aGlzLl9iZWhhdmlvclR5cGUgPyB0aGlzLklzQXN5bmMoKSA/ICh0aGlzLlJ1biA9IHRoaXMuX1J1bkJlaGF2aW9yX0FzeW5jLCB0aGlzLkRlYnVnUnVuID0gdGhpcy5fRGVidWdSdW5CZWhhdmlvcl9Bc3luYykgOiAodGhpcy5SdW4gPSB0aGlzLl9SdW5CZWhhdmlvciwgdGhpcy5EZWJ1Z1J1biA9IHRoaXMuX0RlYnVnUnVuQmVoYXZpb3IpIDogdGhpcy5fb2JqZWN0Q2xhc3MuR2V0UGx1Z2luKCkuSXNTaW5nbGVHbG9iYWwoKSA/ICh0aGlzLl9TZXRTaW5nbGVHbG9iYWxSdW5NZXRob2QoKSwgdGhpcy5EZWJ1Z1J1biA9IHRoaXMuX0RlYnVnUnVuU2luZ2xlR2xvYmFsKSA6IHRoaXMuSXNBc3luYygpID8gKHRoaXMuUnVuID0gdGhpcy5fUnVuT2JqZWN0X0FzeW5jLCB0aGlzLkRlYnVnUnVuID0gdGhpcy5fRGVidWdSdW5PYmplY3RfQXN5bmMpIDogdGhpcy5DYWxsQmVmb3JlQWZ0ZXJIb29rcygpID8gKHRoaXMuUnVuID0gdGhpcy5fUnVuT2JqZWN0X0JlZm9yZUFmdGVySG9va3MsCiAgICAgICAgICAgICAgICB0aGlzLkRlYnVnUnVuID0gdGhpcy5fRGVidWdSdW5PYmplY3RfQmVmb3JlQWZ0ZXJIb29rcykgOiB0aGlzLl9wYXJhbWV0ZXJzLmxlbmd0aCA/IHRoaXMuX3BhcmFtZXRlcnMuZXZlcnkoYiA9PiBiLlZhcmllc1Blckluc3RhbmNlKCkpID8gKHRoaXMuUnVuID0gdGhpcy5fUnVuT2JqZWN0X0FsbFBhcmFtc1ZhcnksIHRoaXMuRGVidWdSdW4gPSB0aGlzLl9EZWJ1Z1J1bk9iamVjdF9BbGxQYXJhbXNWYXJ5KSA6IHRoaXMuX2FueVBhcmFtVmFyaWVzUGVySW5zdGFuY2UgPyAodGhpcy5SdW4gPSB0aGlzLl9SdW5PYmplY3RfU29tZVBhcmFtc1ZhcnksIHRoaXMuRGVidWdSdW4gPSB0aGlzLl9EZWJ1Z1J1bk9iamVjdF9Tb21lUGFyYW1zVmFyeSkgOiB0aGlzLl9wYXJhbWV0ZXJzLmV2ZXJ5KGIgPT4gYi5Jc0NvbnN0YW50KCkpID8gKEV2YWxQYXJhbXMkanNjb21wJDEodGhpcy5fcGFyYW1ldGVycywgdGhpcy5fcmVzdWx0cyksIHRoaXMuUnVuID0gdGhpcy5fUnVuT2JqZWN0X1BhcmFtc0NvbnN0LCB0aGlzLkRlYnVnUnVuID0gdGhpcy5fRGVidWdSdW5PYmplY3RfUGFyYW1zQ29uc3QpIDoKICAgICAgICAgICAgKHRoaXMuUnVuID0gdGhpcy5fUnVuT2JqZWN0X1BhcmFtc0RvbnRWYXJ5LCB0aGlzLkRlYnVnUnVuID0gdGhpcy5fRGVidWdSdW5PYmplY3RfUGFyYW1zRG9udFZhcnkpIDogKHRoaXMuUnVuID0gdGhpcy5fUnVuT2JqZWN0X1BhcmFtc0NvbnN0LCB0aGlzLkRlYnVnUnVuID0gdGhpcy5fRGVidWdSdW5PYmplY3RfUGFyYW1zQ29uc3QpCiAgICB9CiAgICBfU2V0U3lzdGVtUnVuTWV0aG9kKCkgewogICAgICAgIHRoaXMuX1NldFJ1bk1ldGhvZEZvckJvdW5kRnVuYyh0aGlzLl9zeXN0ZW1QbHVnaW4sIHRoaXMuX3N5c3RlbVBsdWdpbiwgdGhpcy5fUnVuU3lzdGVtKQogICAgfQogICAgX1NldFNpbmdsZUdsb2JhbFJ1bk1ldGhvZCgpIHsKICAgICAgICBjb25zdCBhID0gdGhpcy5fb2JqZWN0Q2xhc3MuR2V0UGx1Z2luKCksCiAgICAgICAgICAgIGIgPSB0aGlzLl9vYmplY3RDbGFzcy5HZXRTaW5nbGVHbG9iYWxJbnN0YW5jZSgpLkdldFNka0luc3RhbmNlKCk7CiAgICAgICAgdGhpcy5fU2V0UnVuTWV0aG9kRm9yQm91bmRGdW5jKGEsIGIsIHRoaXMuX1J1blNpbmdsZUdsb2JhbCkKICAgIH0KICAgIF9TZXRDYWxsRnVuY3Rpb25SdW5NZXRob2QoKSB7CiAgICAgICAgY29uc3QgYSA9CiAgICAgICAgICAgIHRoaXMuX2V2ZW50QmxvY2suR2V0RXZlbnRTaGVldE1hbmFnZXIoKSwKICAgICAgICAgICAgYiA9IGEuR2V0RnVuY3Rpb25CbG9ja0J5TmFtZSh0aGlzLl9jYWxsRnVuY3Rpb25OYW1lKTsKICAgICAgICBpZiAoYi5Jc0VuYWJsZWQoKSkgewogICAgICAgICAgICBjb25zdCBkID0gMCAhPT0gKHRoaXMuX2ZsYWdzICYgMik7CiAgICAgICAgICAgIHRoaXMuX2NhbGxFdmVudEJsb2NrID0gYi5HZXRFdmVudEJsb2NrKCk7CiAgICAgICAgICAgIGxldCBjID0gWy4uLihuZXcgU2V0KFsuLi50aGlzLl9ldmVudEJsb2NrLkdldFNvbE1vZGlmaWVyc0luY2x1ZGluZ1BhcmVudHMoKSwgLi4udGhpcy5fY2FsbEV2ZW50QmxvY2suR2V0U29sTW9kaWZpZXJzSW5jbHVkaW5nUGFyZW50cygpXSkpXTsKICAgICAgICAgICAgYyA9IGEuX0RlZHVwbGljYXRlU29sTW9kaWZpZXJMaXN0KGMpOwogICAgICAgICAgICB0aGlzLlJ1biA9IEMzJGpzY29tcCQxMzcuRXZlbnRCbG9jay5wcm90b3R5cGUuUnVuQXNGdW5jdGlvbkNhbGwuYmluZCh0aGlzLl9jYWxsRXZlbnRCbG9jaywgYywgdGhpcy5fcGFyYW1ldGVycywgZCk7CiAgICAgICAgICAgIGlmICh0aGlzLl9ydW50aW1lLklzRGVidWcoKSkgewogICAgICAgICAgICAgICAgY29uc3QgZSA9IHRoaXM7CiAgICAgICAgICAgICAgICB0aGlzLkRlYnVnUnVuID0KICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiooKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlLklzQnJlYWtwb2ludCgpIHx8IGUuX3J1bnRpbWUuRGVidWdCcmVha05leHQoKSkgeWllbGQgZTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHlpZWxkKiBlLl9jYWxsRXZlbnRCbG9jay5EZWJ1Z1J1bkFzRnVuY3Rpb25DYWxsKGMsIGUuX3BhcmFtZXRlcnMsIGQpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgdGhpcy5EZWJ1Z1J1biA9IG5vb3BHZW5lcmF0b3IKICAgICAgICB9IGVsc2UgdGhpcy5SdW4gPSBub29wJGpzY29tcCQyLCB0aGlzLkRlYnVnUnVuID0gbm9vcEdlbmVyYXRvcgogICAgfQogICAgX1NldFJ1bk1ldGhvZEZvckJvdW5kRnVuYyhhLCBiLCBkKSB7CiAgICAgICAgY29uc3QgYyA9IHRoaXMuX2Z1bmMsCiAgICAgICAgICAgIGUgPSB0aGlzLl9wYXJhbWV0ZXJzOwogICAgICAgIGlmICgwID09PSBlLmxlbmd0aCkgdGhpcy5SdW4gPSBhLl9HZXRCb3VuZEFDRU1ldGhvZChjLCBiKTsKICAgICAgICBlbHNlIGlmICgxID09PSBlLmxlbmd0aCkgewogICAgICAgICAgICBjb25zdCBnID0gZVswXTsKICAgICAgICAgICAgaWYgKGcuSXNDb25zdGFudCgpKSB0aGlzLlJ1biA9IGEuX0dldEJvdW5kQUNFTWV0aG9kXzFwYXJhbShjLCBiLCBnLkdldCgwKSk7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgY29uc3QgayA9IGEuX0dldEJvdW5kQUNFTWV0aG9kKGMsIGIpOwogICAgICAgICAgICAgICAgdGhpcy5SdW4gPQogICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gayhnLkdldCgwKSkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKDIgPT09IGUubGVuZ3RoKSB7CiAgICAgICAgICAgIGNvbnN0IGcgPSBlWzBdLAogICAgICAgICAgICAgICAgayA9IGVbMV07CiAgICAgICAgICAgIGlmIChnLklzQ29uc3RhbnQoKSAmJiBrLklzQ29uc3RhbnQoKSkgdGhpcy5SdW4gPSBhLl9HZXRCb3VuZEFDRU1ldGhvZF8ycGFyYW1zKGMsIGIsIGcuR2V0KDApLCBrLkdldCgwKSk7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgY29uc3QgbSA9IGEuX0dldEJvdW5kQUNFTWV0aG9kKGMsIGIpOwogICAgICAgICAgICAgICAgdGhpcy5SdW4gPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbShnLkdldCgwKSwgay5HZXQoMCkpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKDMgPT09IGUubGVuZ3RoKSB7CiAgICAgICAgICAgIGNvbnN0IGcgPSBlWzBdLAogICAgICAgICAgICAgICAgayA9IGVbMV0sCiAgICAgICAgICAgICAgICBtID0gZVsyXTsKICAgICAgICAgICAgaWYgKGcuSXNDb25zdGFudCgpICYmIGsuSXNDb25zdGFudCgpICYmIG0uSXNDb25zdGFudCgpKSB0aGlzLlJ1biA9IGEuX0dldEJvdW5kQUNFTWV0aG9kXzNwYXJhbXMoYywgYiwgZy5HZXQoMCksIGsuR2V0KDApLCBtLkdldCgwKSk7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgY29uc3QgbiA9IGEuX0dldEJvdW5kQUNFTWV0aG9kKGMsIGIpOwogICAgICAgICAgICAgICAgdGhpcy5SdW4gPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbihnLkdldCgwKSwKICAgICAgICAgICAgICAgICAgICAgICAgay5HZXQoMCksIG0uR2V0KDApKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHRoaXMuUnVuID0gZAogICAgfQogICAgR2V0U0lEKCkgewogICAgICAgIHJldHVybiB0aGlzLl9zaWQKICAgIH0KICAgIElzQXN5bmMoKSB7CiAgICAgICAgcmV0dXJuIDEgPT09IHRoaXMuX2FjdGlvblR5cGUKICAgIH0KICAgIENhbkJhaWxPdXQoKSB7CiAgICAgICAgcmV0dXJuIDIgPT09IHRoaXMuX2FjdGlvblR5cGUKICAgIH0KICAgIENhbGxCZWZvcmVBZnRlckhvb2tzKCkgewogICAgICAgIHJldHVybiAzID09PSB0aGlzLl9hY3Rpb25UeXBlCiAgICB9CiAgICBDYW5QaWNrQW55T2JqZWN0Q2xhc3MoKSB7CiAgICAgICAgcmV0dXJuIDAgIT09ICh0aGlzLl9mbGFncyAmIDEpCiAgICB9CiAgICBIYXNSZXR1cm5UeXBlKCkgewogICAgICAgIHJldHVybiB0aGlzLklzQXN5bmMoKSB8fCB0aGlzLkNhbkJhaWxPdXQoKQogICAgfQogICAgR2V0T2JqZWN0Q2xhc3MoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX29iamVjdENsYXNzCiAgICB9CiAgICBHZXRFdmVudEJsb2NrKCkgewogICAgICAgIHJldHVybiB0aGlzLl9ldmVudEJsb2NrCiAgICB9CiAgICBHZXRSdW50aW1lKCkgewogICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lCiAgICB9CiAgICBHZXRJbmRleCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5faW5kZXgKICAgIH0KICAgIEdldERlYnVnSW5kZXgoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2RlYnVnRGF0YS5pbmRleAogICAgfQogICAgSXNCcmVha3BvaW50KCkgewogICAgICAgIHJldHVybiB0aGlzLl9kZWJ1Z0RhdGEuaXNCcmVha3BvaW50CiAgICB9CiAgICBfU2V0QnJlYWtwb2ludChhKSB7CiAgICAgICAgdGhpcy5fZGVidWdEYXRhLmlzQnJlYWtwb2ludCA9ICEhYTsKICAgICAgICB0aGlzLl9ldmVudEJsb2NrLl9VcGRhdGVDYW5SdW5GYXN0UmVjdXJzaXZlKCkKICAgIH0KICAgIF9EZWJ1Z1JldHVybnNHZW5lcmF0b3IoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2RlYnVnRGF0YS5jYW5EZWJ1ZwogICAgfQogICAgRGVidWdDYW5SdW5GYXN0KCkgewogICAgICAgIHJldHVybiAhdGhpcy5Jc0JyZWFrcG9pbnQoKSAmJiAhdGhpcy5fcnVudGltZS5EZWJ1Z0JyZWFrTmV4dCgpICYmICF0aGlzLl9EZWJ1Z1JldHVybnNHZW5lcmF0b3IoKQogICAgfQogICAgR2V0U2F2ZWREYXRhTWFwKCkgewogICAgICAgIHRoaXMuX3NhdmVkRGF0YSB8fCAodGhpcy5fc2F2ZWREYXRhID0gbmV3IE1hcCk7CiAgICAgICAgcmV0dXJuIHRoaXMuX3NhdmVkRGF0YQogICAgfQogICAgR2V0VW5zYXZlZERhdGFNYXAoKSB7CiAgICAgICAgdGhpcy5fdW5zYXZlZERhdGEgfHwgKHRoaXMuX3Vuc2F2ZWREYXRhID0gbmV3IE1hcCk7CiAgICAgICAgcmV0dXJuIHRoaXMuX3Vuc2F2ZWREYXRhCiAgICB9CiAgICBfUnVuU3lzdGVtKCkgewogICAgICAgIGNvbnN0IGEgPSB0aGlzLl9yZXN1bHRzOwogICAgICAgIEV2YWxQYXJhbXMkanNjb21wJDEodGhpcy5fcGFyYW1ldGVycywgYSk7CiAgICAgICAgcmV0dXJuIHRoaXMuX2Z1bmMuYXBwbHkodGhpcy5fc3lzdGVtUGx1Z2luLAogICAgICAgICAgICBhKQogICAgfSogX0RlYnVnUnVuU3lzdGVtKCkgewogICAgICAgIGlmICh0aGlzLklzQnJlYWtwb2ludCgpIHx8IHRoaXMuX3J1bnRpbWUuRGVidWdCcmVha05leHQoKSkgeWllbGQgdGhpczsKICAgICAgICBpZiAodGhpcy5fRGVidWdSZXR1cm5zR2VuZXJhdG9yKCkpIHsKICAgICAgICAgICAgY29uc3QgYSA9IHRoaXMuX3Jlc3VsdHM7CiAgICAgICAgICAgIEV2YWxQYXJhbXMkanNjb21wJDEodGhpcy5fcGFyYW1ldGVycywgYSk7CiAgICAgICAgICAgIHJldHVybiB5aWVsZCogdGhpcy5fZnVuYy5hcHBseSh0aGlzLl9zeXN0ZW1QbHVnaW4sIGEpCiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzLlJ1bigpCiAgICB9CiAgICBfUnVuU2luZ2xlR2xvYmFsKCkgewogICAgICAgIGNvbnN0IGEgPSB0aGlzLl9yZXN1bHRzOwogICAgICAgIEV2YWxQYXJhbXMkanNjb21wJDEodGhpcy5fcGFyYW1ldGVycywgYSk7CiAgICAgICAgcmV0dXJuIHRoaXMuX2Z1bmMuYXBwbHkodGhpcy5fb2JqZWN0Q2xhc3MuR2V0U2luZ2xlR2xvYmFsSW5zdGFuY2UoKS5HZXRTZGtJbnN0YW5jZSgpLCBhKQogICAgfSogX0RlYnVnUnVuU2luZ2xlR2xvYmFsKCkgewogICAgICAgIGlmICh0aGlzLklzQnJlYWtwb2ludCgpIHx8IHRoaXMuX3J1bnRpbWUuRGVidWdCcmVha05leHQoKSkgeWllbGQgdGhpczsKICAgICAgICBpZiAodGhpcy5fRGVidWdSZXR1cm5zR2VuZXJhdG9yKCkpIHsKICAgICAgICAgICAgY29uc3QgYSA9IHRoaXMuX3Jlc3VsdHM7CiAgICAgICAgICAgIEV2YWxQYXJhbXMkanNjb21wJDEodGhpcy5fcGFyYW1ldGVycywgYSk7CiAgICAgICAgICAgIHJldHVybiB5aWVsZCogdGhpcy5fZnVuYy5hcHBseSh0aGlzLl9vYmplY3RDbGFzcy5HZXRTaW5nbGVHbG9iYWxJbnN0YW5jZSgpLkdldFNka0luc3RhbmNlKCksIGEpCiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzLlJ1bigpCiAgICB9CiAgICBfUnVuT2JqZWN0X1BhcmFtc0NvbnN0KCkgewogICAgICAgIGNvbnN0IGEgPSB0aGlzLl9yZXN1bHRzLAogICAgICAgICAgICBiID0gdGhpcy5fb2JqZWN0Q2xhc3MuR2V0Q3VycmVudFNvbCgpLkdldEluc3RhbmNlcygpOwogICAgICAgIGZvciAobGV0IGQgPSAwLCBjID0gYi5sZW5ndGg7IGQgPCBjOyArK2QpIHRoaXMuX2Z1bmMuYXBwbHkoYltkXS5HZXRTZGtJbnN0YW5jZSgpLCBhKQogICAgfSogX0RlYnVnUnVuT2JqZWN0X1BhcmFtc0NvbnN0KCkgewogICAgICAgIGlmICh0aGlzLklzQnJlYWtwb2ludCgpIHx8IHRoaXMuX3J1bnRpbWUuRGVidWdCcmVha05leHQoKSkgeWllbGQgdGhpczsKICAgICAgICBpZiAodGhpcy5fRGVidWdSZXR1cm5zR2VuZXJhdG9yKCkpIHsKICAgICAgICAgICAgY29uc3QgYSA9CiAgICAgICAgICAgICAgICB0aGlzLl9yZXN1bHRzLAogICAgICAgICAgICAgICAgYiA9IHRoaXMuX29iamVjdENsYXNzLkdldEN1cnJlbnRTb2woKS5HZXRJbnN0YW5jZXMoKTsKICAgICAgICAgICAgZm9yIChsZXQgZCA9IDAsIGMgPSBiLmxlbmd0aDsgZCA8IGM7ICsrZCkgeWllbGQqIHRoaXMuX2Z1bmMuYXBwbHkoYltkXS5HZXRTZGtJbnN0YW5jZSgpLCBhKQogICAgICAgIH0gZWxzZSB0aGlzLl9SdW5PYmplY3RfUGFyYW1zQ29uc3QoKQogICAgfQogICAgX1J1bk9iamVjdF9QYXJhbXNEb250VmFyeSgpIHsKICAgICAgICBjb25zdCBhID0gdGhpcy5fcmVzdWx0czsKICAgICAgICBFdmFsUGFyYW1zJGpzY29tcCQxKHRoaXMuX3BhcmFtZXRlcnMsIGEpOwogICAgICAgIGNvbnN0IGIgPSB0aGlzLl9vYmplY3RDbGFzcy5HZXRDdXJyZW50U29sKCkuR2V0SW5zdGFuY2VzKCk7CiAgICAgICAgZm9yIChsZXQgZCA9IDAsIGMgPSBiLmxlbmd0aDsgZCA8IGM7ICsrZCkgdGhpcy5fZnVuYy5hcHBseShiW2RdLkdldFNka0luc3RhbmNlKCksIGEpCiAgICB9KiBfRGVidWdSdW5PYmplY3RfUGFyYW1zRG9udFZhcnkoKSB7CiAgICAgICAgaWYgKHRoaXMuSXNCcmVha3BvaW50KCkgfHwgdGhpcy5fcnVudGltZS5EZWJ1Z0JyZWFrTmV4dCgpKSB5aWVsZCB0aGlzOwogICAgICAgIGlmICh0aGlzLl9EZWJ1Z1JldHVybnNHZW5lcmF0b3IoKSkgewogICAgICAgICAgICBjb25zdCBhID0KICAgICAgICAgICAgICAgIHRoaXMuX3Jlc3VsdHM7CiAgICAgICAgICAgIEV2YWxQYXJhbXMkanNjb21wJDEodGhpcy5fcGFyYW1ldGVycywgYSk7CiAgICAgICAgICAgIGNvbnN0IGIgPSB0aGlzLl9vYmplY3RDbGFzcy5HZXRDdXJyZW50U29sKCkuR2V0SW5zdGFuY2VzKCk7CiAgICAgICAgICAgIGZvciAobGV0IGQgPSAwLCBjID0gYi5sZW5ndGg7IGQgPCBjOyArK2QpIHlpZWxkKiB0aGlzLl9mdW5jLmFwcGx5KGJbZF0uR2V0U2RrSW5zdGFuY2UoKSwgYSkKICAgICAgICB9IGVsc2UgdGhpcy5fUnVuT2JqZWN0X1BhcmFtc0RvbnRWYXJ5KCkKICAgIH0KICAgIF9SdW5PYmplY3RfQWxsUGFyYW1zVmFyeSgpIHsKICAgICAgICBjb25zdCBhID0gdGhpcy5fcGFyYW1ldGVycywKICAgICAgICAgICAgYiA9IHRoaXMuX3Jlc3VsdHMsCiAgICAgICAgICAgIGQgPSB0aGlzLl9mdW5jLAogICAgICAgICAgICBjID0gdGhpcy5fb2JqZWN0Q2xhc3MuR2V0Q3VycmVudFNvbCgpLkdldEluc3RhbmNlcygpOwogICAgICAgIGZvciAobGV0IGUgPSAwLCBnID0gYy5sZW5ndGg7IGUgPCBnOyArK2UpIHsKICAgICAgICAgICAgY29uc3QgayA9IGNbZV07CiAgICAgICAgICAgIGZvciAobGV0IG0gPSAwLCBuID0gYS5sZW5ndGg7IG0gPCBuOyArK20pIGJbbV0gPSBhW21dLkdldChlKTsKICAgICAgICAgICAgZC5hcHBseShrLkdldFNka0luc3RhbmNlKCksIGIpCiAgICAgICAgfQogICAgfSogX0RlYnVnUnVuT2JqZWN0X0FsbFBhcmFtc1ZhcnkoKSB7CiAgICAgICAgaWYgKHRoaXMuSXNCcmVha3BvaW50KCkgfHwKICAgICAgICAgICAgdGhpcy5fcnVudGltZS5EZWJ1Z0JyZWFrTmV4dCgpKSB5aWVsZCB0aGlzOwogICAgICAgIGlmICh0aGlzLl9EZWJ1Z1JldHVybnNHZW5lcmF0b3IoKSkgewogICAgICAgICAgICBjb25zdCBhID0gdGhpcy5fcGFyYW1ldGVycywKICAgICAgICAgICAgICAgIGIgPSB0aGlzLl9yZXN1bHRzLAogICAgICAgICAgICAgICAgZCA9IHRoaXMuX2Z1bmMsCiAgICAgICAgICAgICAgICBjID0gdGhpcy5fb2JqZWN0Q2xhc3MuR2V0Q3VycmVudFNvbCgpLkdldEluc3RhbmNlcygpOwogICAgICAgICAgICBmb3IgKGxldCBlID0gMCwgZyA9IGMubGVuZ3RoOyBlIDwgZzsgKytlKSB7CiAgICAgICAgICAgICAgICBjb25zdCBrID0gY1tlXTsKICAgICAgICAgICAgICAgIGZvciAobGV0IG0gPSAwLCBuID0gYS5sZW5ndGg7IG0gPCBuOyArK20pIGJbbV0gPSBhW21dLkdldChlKTsKICAgICAgICAgICAgICAgIHlpZWxkKiBkLmFwcGx5KGsuR2V0U2RrSW5zdGFuY2UoKSwgYikKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB0aGlzLl9SdW5PYmplY3RfQWxsUGFyYW1zVmFyeSgpCiAgICB9CiAgICBfUnVuT2JqZWN0X1NvbWVQYXJhbXNWYXJ5KCkgewogICAgICAgIGNvbnN0IGEgPSB0aGlzLl9wYXJhbWV0ZXJzLAogICAgICAgICAgICBiID0gdGhpcy5fcmVzdWx0cywKICAgICAgICAgICAgZCA9IHRoaXMuX2Z1bmMsCiAgICAgICAgICAgIGMgPSB0aGlzLl9vYmplY3RDbGFzcy5HZXRDdXJyZW50U29sKCkuR2V0SW5zdGFuY2VzKCk7CiAgICAgICAgZm9yIChsZXQgZyA9IDAsIGsgPSBhLmxlbmd0aDsgZyA8CiAgICAgICAgICAgIGs7ICsrZykgewogICAgICAgICAgICB2YXIgZSA9IGFbZ107CiAgICAgICAgICAgIGUuVmFyaWVzUGVySW5zdGFuY2UoKSB8fCAoYltnXSA9IGUuR2V0KDApKQogICAgICAgIH0KICAgICAgICBmb3IgKGxldCBnID0gMCwgayA9IGMubGVuZ3RoOyBnIDwgazsgKytnKSB7CiAgICAgICAgICAgIGUgPSBjW2ddOwogICAgICAgICAgICBmb3IgKGxldCBtID0gMCwgbiA9IGEubGVuZ3RoOyBtIDwgbjsgKyttKSB7CiAgICAgICAgICAgICAgICBjb25zdCBxID0gYVttXTsKICAgICAgICAgICAgICAgIHEuVmFyaWVzUGVySW5zdGFuY2UoKSAmJiAoYlttXSA9IHEuR2V0KGcpKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGQuYXBwbHkoZS5HZXRTZGtJbnN0YW5jZSgpLCBiKQogICAgICAgIH0KICAgIH0qIF9EZWJ1Z1J1bk9iamVjdF9Tb21lUGFyYW1zVmFyeSgpIHsKICAgICAgICBpZiAodGhpcy5Jc0JyZWFrcG9pbnQoKSB8fCB0aGlzLl9ydW50aW1lLkRlYnVnQnJlYWtOZXh0KCkpIHlpZWxkIHRoaXM7CiAgICAgICAgaWYgKHRoaXMuX0RlYnVnUmV0dXJuc0dlbmVyYXRvcigpKSB7CiAgICAgICAgICAgIGNvbnN0IGIgPSB0aGlzLl9wYXJhbWV0ZXJzLAogICAgICAgICAgICAgICAgZCA9IHRoaXMuX3Jlc3VsdHMsCiAgICAgICAgICAgICAgICBjID0gdGhpcy5fZnVuYywKICAgICAgICAgICAgICAgIGUgPSB0aGlzLl9vYmplY3RDbGFzcy5HZXRDdXJyZW50U29sKCkuR2V0SW5zdGFuY2VzKCk7CiAgICAgICAgICAgIGZvciAobGV0IGcgPSAwLCBrID0gYi5sZW5ndGg7IGcgPCBrOyArK2cpIHsKICAgICAgICAgICAgICAgIHZhciBhID0gYltnXTsKICAgICAgICAgICAgICAgIGEuVmFyaWVzUGVySW5zdGFuY2UoKSB8fAogICAgICAgICAgICAgICAgICAgIChkW2ddID0gYS5HZXQoMCkpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yIChsZXQgZyA9IDAsIGsgPSBlLmxlbmd0aDsgZyA8IGs7ICsrZykgewogICAgICAgICAgICAgICAgYSA9IGVbZ107CiAgICAgICAgICAgICAgICBmb3IgKGxldCBtID0gMCwgbiA9IGIubGVuZ3RoOyBtIDwgbjsgKyttKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcSA9IGJbbV07CiAgICAgICAgICAgICAgICAgICAgcS5WYXJpZXNQZXJJbnN0YW5jZSgpICYmIChkW21dID0gcS5HZXQoZykpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB5aWVsZCogYy5hcHBseShhLkdldFNka0luc3RhbmNlKCksIGQpCiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgdGhpcy5fUnVuT2JqZWN0X1NvbWVQYXJhbXNWYXJ5KCkKICAgIH0KICAgIF9SdW5PYmplY3RfQmVmb3JlQWZ0ZXJIb29rcygpIHsKICAgICAgICBjb25zdCBhID0gdGhpcy5fcGFyYW1ldGVycywKICAgICAgICAgICAgYiA9IHRoaXMuX3Jlc3VsdHMsCiAgICAgICAgICAgIGQgPSB0aGlzLl9mdW5jOwogICAgICAgIHZhciBjID0gdGhpcy5fb2JqZWN0Q2xhc3M7CiAgICAgICAgY29uc3QgZSA9IGMuR2V0U2RrVHlwZSgpOwogICAgICAgIGMgPSBjLkdldEN1cnJlbnRTb2woKS5HZXRJbnN0YW5jZXMoKTsKICAgICAgICBlLkJlZm9yZVJ1bkFjdGlvbihkKTsKICAgICAgICBmb3IgKGxldCBnID0gMCwgayA9IGMubGVuZ3RoOyBnIDwgazsgKytnKSB7CiAgICAgICAgICAgIGNvbnN0IG0gPSBjW2ddOwogICAgICAgICAgICBmb3IgKGxldCBuID0gMCwgcSA9IGEubGVuZ3RoOyBuIDwgcTsgKytuKSBiW25dID0gYVtuXS5HZXQoZyk7CiAgICAgICAgICAgIGQuYXBwbHkobS5HZXRTZGtJbnN0YW5jZSgpLAogICAgICAgICAgICAgICAgYikKICAgICAgICB9CiAgICAgICAgZS5BZnRlclJ1bkFjdGlvbihkKQogICAgfSogX0RlYnVnUnVuT2JqZWN0X0JlZm9yZUFmdGVySG9va3MoKSB7CiAgICAgICAgaWYgKHRoaXMuSXNCcmVha3BvaW50KCkgfHwgdGhpcy5fcnVudGltZS5EZWJ1Z0JyZWFrTmV4dCgpKSB5aWVsZCB0aGlzOwogICAgICAgIGlmICh0aGlzLl9EZWJ1Z1JldHVybnNHZW5lcmF0b3IoKSkgewogICAgICAgICAgICBjb25zdCBiID0gdGhpcy5fcGFyYW1ldGVycywKICAgICAgICAgICAgICAgIGQgPSB0aGlzLl9yZXN1bHRzLAogICAgICAgICAgICAgICAgYyA9IHRoaXMuX2Z1bmM7CiAgICAgICAgICAgIHZhciBhID0gdGhpcy5fb2JqZWN0Q2xhc3M7CiAgICAgICAgICAgIGNvbnN0IGUgPSBhLkdldFNka1R5cGUoKTsKICAgICAgICAgICAgYSA9IGEuR2V0Q3VycmVudFNvbCgpLkdldEluc3RhbmNlcygpOwogICAgICAgICAgICBlLkJlZm9yZVJ1bkFjdGlvbihjKTsKICAgICAgICAgICAgZm9yIChsZXQgZyA9IDAsIGsgPSBhLmxlbmd0aDsgZyA8IGs7ICsrZykgewogICAgICAgICAgICAgICAgY29uc3QgbSA9IGFbZ107CiAgICAgICAgICAgICAgICBmb3IgKGxldCBuID0gMCwgcSA9IGIubGVuZ3RoOyBuIDwgcTsgKytuKSBkW25dID0gYltuXS5HZXQoZyk7CiAgICAgICAgICAgICAgICB5aWVsZCogYy5hcHBseShtLkdldFNka0luc3RhbmNlKCksIGQpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZS5BZnRlclJ1bkFjdGlvbihjKQogICAgICAgIH0gZWxzZSB0aGlzLl9SdW5PYmplY3RfQmVmb3JlQWZ0ZXJIb29rcygpCiAgICB9CiAgICBfUnVuQmVoYXZpb3IoKSB7CiAgICAgICAgdmFyIGEgPQogICAgICAgICAgICB0aGlzLl9vYmplY3RDbGFzczsKICAgICAgICBjb25zdCBiID0gYS5Jc0ZhbWlseSgpLAogICAgICAgICAgICBkID0gYS5HZXRGYW1pbHlJbmRleCgpLAogICAgICAgICAgICBjID0gdGhpcy5fcGFyYW1ldGVycywKICAgICAgICAgICAgZSA9IHRoaXMuX2FueVBhcmFtVmFyaWVzUGVySW5zdGFuY2UsCiAgICAgICAgICAgIGcgPSB0aGlzLl9yZXN1bHRzLAogICAgICAgICAgICBrID0gdGhpcy5fZnVuYywKICAgICAgICAgICAgbSA9IHRoaXMuX2JlaGF2aW9ySW5kZXg7CiAgICAgICAgYSA9IGEuR2V0Q3VycmVudFNvbCgpLkdldEluc3RhbmNlcygpOwogICAgICAgIGZvciAobGV0IHUgPSAwLCB3ID0gYy5sZW5ndGg7IHUgPCB3OyArK3UpIHsKICAgICAgICAgICAgdmFyIG4gPSBjW3VdOwogICAgICAgICAgICBuLlZhcmllc1Blckluc3RhbmNlKCkgfHwgKGdbdV0gPSBuLkdldCgwKSkKICAgICAgICB9CiAgICAgICAgZm9yIChsZXQgdSA9IDAsIHcgPSBhLmxlbmd0aDsgdSA8IHc7ICsrdSkgewogICAgICAgICAgICBuID0gYVt1XTsKICAgICAgICAgICAgaWYgKGUpCiAgICAgICAgICAgICAgICBmb3IgKGxldCB6ID0gMCwgQyA9IGMubGVuZ3RoOyB6IDwgQzsgKyt6KSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHEgPSBjW3pdOwogICAgICAgICAgICAgICAgICAgIHEuVmFyaWVzUGVySW5zdGFuY2UoKSAmJiAoZ1t6XSA9IHEuR2V0KHUpKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBxID0gYiA/IG4uR2V0T2JqZWN0Q2xhc3MoKS5HZXRGYW1pbHlCZWhhdmlvck9mZnNldChkKSA6IDA7CiAgICAgICAgICAgIGsuYXBwbHkobi5HZXRCZWhhdmlvckluc3RhbmNlcygpW20gKyBxXS5HZXRTZGtJbnN0YW5jZSgpLAogICAgICAgICAgICAgICAgZykKICAgICAgICB9CiAgICB9KiBfRGVidWdSdW5CZWhhdmlvcigpIHsKICAgICAgICBpZiAodGhpcy5Jc0JyZWFrcG9pbnQoKSB8fCB0aGlzLl9ydW50aW1lLkRlYnVnQnJlYWtOZXh0KCkpIHlpZWxkIHRoaXM7CiAgICAgICAgaWYgKHRoaXMuX0RlYnVnUmV0dXJuc0dlbmVyYXRvcigpKSB7CiAgICAgICAgICAgIHZhciBhID0gdGhpcy5fb2JqZWN0Q2xhc3M7CiAgICAgICAgICAgIGNvbnN0IGMgPSBhLklzRmFtaWx5KCksCiAgICAgICAgICAgICAgICBlID0gYS5HZXRGYW1pbHlJbmRleCgpLAogICAgICAgICAgICAgICAgZyA9IHRoaXMuX3BhcmFtZXRlcnMsCiAgICAgICAgICAgICAgICBrID0gdGhpcy5fYW55UGFyYW1WYXJpZXNQZXJJbnN0YW5jZSwKICAgICAgICAgICAgICAgIG0gPSB0aGlzLl9yZXN1bHRzLAogICAgICAgICAgICAgICAgbiA9IHRoaXMuX2Z1bmMsCiAgICAgICAgICAgICAgICBxID0gdGhpcy5fYmVoYXZpb3JJbmRleDsKICAgICAgICAgICAgYSA9IGEuR2V0Q3VycmVudFNvbCgpLkdldEluc3RhbmNlcygpOwogICAgICAgICAgICBmb3IgKGxldCB1ID0gMCwgdyA9IGcubGVuZ3RoOyB1IDwgdzsgKyt1KSB7CiAgICAgICAgICAgICAgICB2YXIgYiA9IGdbdV07CiAgICAgICAgICAgICAgICBiLlZhcmllc1Blckluc3RhbmNlKCkgfHwgKG1bdV0gPSBiLkdldCgwKSkKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IgKGxldCB1ID0gMCwgdyA9IGEubGVuZ3RoOyB1IDwgdzsgKyt1KSB7CiAgICAgICAgICAgICAgICBiID0gYVt1XTsKICAgICAgICAgICAgICAgIGlmIChrKQogICAgICAgICAgICAgICAgICAgIGZvciAobGV0IHogPSAwLCBDID0gZy5sZW5ndGg7IHogPCBDOyArK3opIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSBnW3pdOwogICAgICAgICAgICAgICAgICAgICAgICBkLlZhcmllc1Blckluc3RhbmNlKCkgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgIChtW3pdID0gZC5HZXQodSkpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZCA9IGMgPyBiLkdldE9iamVjdENsYXNzKCkuR2V0RmFtaWx5QmVoYXZpb3JPZmZzZXQoZSkgOiAwOwogICAgICAgICAgICAgICAgeWllbGQqIG4uYXBwbHkoYi5HZXRCZWhhdmlvckluc3RhbmNlcygpW3EgKyBkXS5HZXRTZGtJbnN0YW5jZSgpLCBtKQogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHRoaXMuX1J1bkJlaGF2aW9yKCkKICAgIH0KICAgIF9SdW5PYmplY3RfQXN5bmMoKSB7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuX3BhcmFtZXRlcnMsCiAgICAgICAgICAgIGIgPSB0aGlzLl9yZXN1bHRzLAogICAgICAgICAgICBkID0gdGhpcy5fZnVuYywKICAgICAgICAgICAgYyA9IHRoaXMuX29iamVjdENsYXNzLkdldEN1cnJlbnRTb2woKS5HZXRJbnN0YW5jZXMoKSwKICAgICAgICAgICAgZSA9IFtdOwogICAgICAgIGZvciAobGV0IGcgPSAwLCBrID0gYy5sZW5ndGg7IGcgPCBrOyArK2cpIHsKICAgICAgICAgICAgY29uc3QgbSA9IGNbZ107CiAgICAgICAgICAgIGZvciAobGV0IG4gPSAwLCBxID0gYS5sZW5ndGg7IG4gPCBxOyArK24pIGJbbl0gPSBhW25dLkdldChnKTsKICAgICAgICAgICAgZS5wdXNoKGQuYXBwbHkobS5HZXRTZGtJbnN0YW5jZSgpLCBiKSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuIFByb21pc2UuYWxsKGUpCiAgICB9KiBfRGVidWdSdW5PYmplY3RfQXN5bmMoKSB7CiAgICAgICAgaWYgKHRoaXMuSXNCcmVha3BvaW50KCkgfHwgdGhpcy5fcnVudGltZS5EZWJ1Z0JyZWFrTmV4dCgpKSB5aWVsZCB0aGlzOwogICAgICAgIGlmICh0aGlzLl9EZWJ1Z1JldHVybnNHZW5lcmF0b3IoKSkgewogICAgICAgICAgICBjb25zdCBhID0gdGhpcy5fcGFyYW1ldGVycywKICAgICAgICAgICAgICAgIGIgPSB0aGlzLl9yZXN1bHRzLAogICAgICAgICAgICAgICAgZCA9IHRoaXMuX2Z1bmMsCiAgICAgICAgICAgICAgICBjID0gdGhpcy5fb2JqZWN0Q2xhc3MuR2V0Q3VycmVudFNvbCgpLkdldEluc3RhbmNlcygpLAogICAgICAgICAgICAgICAgZSA9IFtdOwogICAgICAgICAgICBmb3IgKGxldCBnID0gMCwgayA9IGMubGVuZ3RoOyBnIDwgazsgKytnKSB7CiAgICAgICAgICAgICAgICBjb25zdCBtID0gY1tnXTsKICAgICAgICAgICAgICAgIGZvciAobGV0IG4gPSAwLCBxID0gYS5sZW5ndGg7IG4gPCBxOyArK24pIGJbbl0gPSBhW25dLkdldChnKTsKICAgICAgICAgICAgICAgIGUucHVzaCh5aWVsZCogZC5hcHBseShtLkdldFNka0luc3RhbmNlKCksIGIpKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLmFsbChlKQogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpcy5fUnVuT2JqZWN0X0FzeW5jKCkKICAgIH0KICAgIF9SdW5CZWhhdmlvcl9Bc3luYygpIHsKICAgICAgICB2YXIgYSA9IHRoaXMuX29iamVjdENsYXNzOwogICAgICAgIGNvbnN0IGIgPSBhLklzRmFtaWx5KCksCiAgICAgICAgICAgIGQgPSBhLkdldEZhbWlseUluZGV4KCksCiAgICAgICAgICAgIGMgPSB0aGlzLl9wYXJhbWV0ZXJzLAogICAgICAgICAgICBlID0gdGhpcy5fcmVzdWx0cywKICAgICAgICAgICAgZyA9IHRoaXMuX2Z1bmMsCiAgICAgICAgICAgIGsgPSB0aGlzLl9iZWhhdmlvckluZGV4OwogICAgICAgIGEgPSBhLkdldEN1cnJlbnRTb2woKS5HZXRJbnN0YW5jZXMoKTsKICAgICAgICBjb25zdCBtID0gW107CiAgICAgICAgZm9yIChsZXQgbiA9IDAsIHEgPSBhLmxlbmd0aDsgbiA8IHE7ICsrbikgewogICAgICAgICAgICBjb25zdCB1ID0gYVtuXTsKICAgICAgICAgICAgZm9yIChsZXQgeiA9IDAsIEMgPSBjLmxlbmd0aDsgeiA8IEM7ICsreikgZVt6XSA9IGNbel0uR2V0KG4pOwogICAgICAgICAgICBjb25zdCB3ID0gYiA/IHUuR2V0T2JqZWN0Q2xhc3MoKS5HZXRGYW1pbHlCZWhhdmlvck9mZnNldChkKSA6IDA7CiAgICAgICAgICAgIG0ucHVzaChnLmFwcGx5KHUuR2V0QmVoYXZpb3JJbnN0YW5jZXMoKVtrICsgd10uR2V0U2RrSW5zdGFuY2UoKSwgZSkpCiAgICAgICAgfQogICAgICAgIHJldHVybiBQcm9taXNlLmFsbChtKQogICAgfSogX0RlYnVnUnVuQmVoYXZpb3JfQXN5bmMoKSB7CiAgICAgICAgaWYgKHRoaXMuSXNCcmVha3BvaW50KCkgfHwgdGhpcy5fcnVudGltZS5EZWJ1Z0JyZWFrTmV4dCgpKSB5aWVsZCB0aGlzOwogICAgICAgIGlmICh0aGlzLl9EZWJ1Z1JldHVybnNHZW5lcmF0b3IoKSkgewogICAgICAgICAgICB2YXIgYSA9IHRoaXMuX29iamVjdENsYXNzOwogICAgICAgICAgICBjb25zdCBiID0gYS5Jc0ZhbWlseSgpLAogICAgICAgICAgICAgICAgZCA9IGEuR2V0RmFtaWx5SW5kZXgoKSwKICAgICAgICAgICAgICAgIGMgPSB0aGlzLl9wYXJhbWV0ZXJzLAogICAgICAgICAgICAgICAgZSA9IHRoaXMuX3Jlc3VsdHMsCiAgICAgICAgICAgICAgICBnID0gdGhpcy5fZnVuYywKICAgICAgICAgICAgICAgIGsgPSB0aGlzLl9iZWhhdmlvckluZGV4OwogICAgICAgICAgICBhID0gYS5HZXRDdXJyZW50U29sKCkuR2V0SW5zdGFuY2VzKCk7CiAgICAgICAgICAgIGNvbnN0IG0gPSBbXTsKICAgICAgICAgICAgZm9yIChsZXQgbiA9IDAsIHEgPSBhLmxlbmd0aDsgbiA8IHE7ICsrbikgewogICAgICAgICAgICAgICAgY29uc3QgdSA9IGFbbl07CiAgICAgICAgICAgICAgICBmb3IgKGxldCB6ID0gMCwgQyA9IGMubGVuZ3RoOyB6IDwgQzsgKyt6KSBlW3pdID0gY1t6XS5HZXQobik7CiAgICAgICAgICAgICAgICBjb25zdCB3ID0gYiA/IHUuR2V0T2JqZWN0Q2xhc3MoKS5HZXRGYW1pbHlCZWhhdmlvck9mZnNldChkKSA6IDA7CiAgICAgICAgICAgICAgICBtLnB1c2goeWllbGQqIGcuYXBwbHkodS5HZXRCZWhhdmlvckluc3RhbmNlcygpW2sgKyB3XS5HZXRTZGtJbnN0YW5jZSgpLCBlKSkKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGwobSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXMuX1J1bkJlaGF2aW9yX0FzeW5jKCkKICAgIH0KICAgIGFzeW5jIFJ1blVzZXJTY3JpcHQoKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXdhaXQgdGhpcy5fZnVuYygpCiAgICAgICAgfSBjYXRjaCAoYSkgewogICAgICAgICAgICBjb25zb2xlLmVycm9yKGBVbmhhbmRsZWQgZXhjZXB0aW9uIHJ1bm5pbmcgc2NyaXB0ICVjJHt0aGlzLl9ldmVudEJsb2NrLkdldEV2ZW50U2hlZXQoKS5HZXROYW1lKCl9LCBldmVudCAke3RoaXMuX2V2ZW50QmxvY2suR2V0RGlzcGxheU51bWJlcigpfSwgYWN0aW9uICR7dGhpcy5HZXREZWJ1Z0luZGV4KCkrCjF9OmAsICJmb250LXNpemU6IDEuMmVtOyBmb250LXdlaWdodDogYm9sZDsiLCBhKSwgc2VsZi5DM0RlYnVnZ2VyICYmIHNlbGYuQzNEZWJ1Z2dlci5fU2V0TGFzdEVycm9yU2NyaXB0KHRoaXMpLCBDMyRqc2NvbXAkMTM3LkV2ZW50U2NyaXB0LkhhZFVzZXJTY3JpcHRFeGNlcHRpb24oKSB8fCAoY29uc29sZS5pbmZvKCIlY1RpcDolYyBydW4gdGhpcyB0byBoaWdobGlnaHQgaW4gQ29uc3RydWN0IHRoZSBsYXN0IHNjcmlwdCB0aGF0IGhhZCBhbiBlcnJvcjogJWNnb1RvTGFzdEVycm9yU2NyaXB0KCkiLCAiZm9udC13ZWlnaHQ6IGJvbGQ7IHRleHQtZGVjb3JhdGlvbjogdW5kZXJsaW5lIiwgIiIsICJmb250LXdlaWdodDogYm9sZCIpLCBDMyRqc2NvbXAkMTM3LkV2ZW50U2NyaXB0LlNldEhhZFVzZXJTY3JpcHRFeGNlcHRpb24oKSkKICAgICAgICB9CiAgICB9KiBEZWJ1Z1J1blVzZXJTY3JpcHQoKSB7CiAgICAgICAgaWYgKHRoaXMuSXNCcmVha3BvaW50KCkgfHwgdGhpcy5fcnVudGltZS5EZWJ1Z0JyZWFrTmV4dCgpKSB5aWVsZCB0aGlzOwogICAgICAgIHJldHVybiB0aGlzLlJ1blVzZXJTY3JpcHQoKQogICAgfQogICAgX1NhdmVUb0pzb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3NhdmVkRGF0YSAmJgogICAgICAgICAgICB0aGlzLl9zYXZlZERhdGEuc2l6ZSA/IHsKICAgICAgICAgICAgICAgIGV4OiBDMyRqc2NvbXAkMTM3LlRvU3VwZXJKU09OKHRoaXMuX3NhdmVkRGF0YSkKICAgICAgICAgICAgfSA6IG51bGwKICAgIH0KICAgIF9Mb2FkRnJvbUpzb24oYSkgewogICAgICAgIHRoaXMuX3NhdmVkRGF0YSAmJiAodGhpcy5fc2F2ZWREYXRhLmNsZWFyKCksIHRoaXMuX3NhdmVkRGF0YSA9IG51bGwpOwogICAgICAgIGEgJiYgKGEgPSBhLmV4KSAmJiAodGhpcy5fc2F2ZWREYXRhID0gQzMkanNjb21wJDEzNy5Gcm9tU3VwZXJKU09OKGEpKQogICAgfQp9OwoidXNlIHN0cmljdCI7CmNvbnN0IEMzJGpzY29tcCQxMzggPSBzZWxmLkMzLAogICAgdGVtcENvbG9yJGpzY29tcCQ1ID0gbmV3IEMzJGpzY29tcCQxMzguQ29sb3I7CgpmdW5jdGlvbiBDb21wYXJlWChhLCBiKSB7CiAgICByZXR1cm4gQzMkanNjb21wJDEzOC5jb21wYXJlKHRoaXMuR2V0V29ybGRJbmZvKCkuR2V0WCgpLCBhLCBiKQp9CgpmdW5jdGlvbiBDb21wYXJlWShhLCBiKSB7CiAgICByZXR1cm4gQzMkanNjb21wJDEzOC5jb21wYXJlKHRoaXMuR2V0V29ybGRJbmZvKCkuR2V0WSgpLCBhLCBiKQp9CgpmdW5jdGlvbiBJc09uU2NyZWVuKCkgewogICAgcmV0dXJuIHRoaXMuR2V0V29ybGRJbmZvKCkuSXNJblZpZXdwb3J0MigpCn0KCmZ1bmN0aW9uIElzT3V0c2lkZUxheW91dCgpIHsKICAgIHZhciBhID0gdGhpcy5HZXRXb3JsZEluZm8oKTsKICAgIGNvbnN0IGIgPSBhLkdldExheW91dCgpOwogICAgYSA9IGEuR2V0Qm91bmRpbmdCb3goKTsKICAgIHJldHVybiAwID4gYS5nZXRSaWdodCgpIHx8IDAgPiBhLmdldEJvdHRvbSgpIHx8IGEuZ2V0TGVmdCgpID4gYi5HZXRXaWR0aCgpIHx8IGEuZ2V0VG9wKCkgPiBiLkdldEhlaWdodCgpCn0KCmZ1bmN0aW9uIFBpY2tEaXN0YW5jZShhLCBiLCBkKSB7CiAgICBjb25zdCBjID0gdGhpcy5HZXRDdXJyZW50U29sKCksCiAgICAgICAgZSA9IGMuR2V0SW5zdGFuY2VzKCk7CiAgICBpZiAoIWUubGVuZ3RoKSByZXR1cm4gITE7CiAgICBsZXQgZyA9IGVbMF07CiAgICB2YXIgayA9IGcuR2V0V29ybGRJbmZvKCk7CiAgICBsZXQgbSA9IGcsCiAgICAgICAgbiA9IEMzJGpzY29tcCQxMzguZGlzdGFuY2VTcXVhcmVkKGsuR2V0WCgpLCBrLkdldFkoKSwgYiwgZCk7CiAgICBmb3IgKGxldCBxID0gMSwgdSA9IGUubGVuZ3RoOyBxIDwgdTsgKytxKQogICAgICAgIGlmIChnID0gZVtxXSwgayA9IGcuR2V0V29ybGRJbmZvKCksIGsgPSBDMyRqc2NvbXAkMTM4LmRpc3RhbmNlU3F1YXJlZChrLkdldFgoKSwgay5HZXRZKCksIGIsIGQpLCAwID09PSBhICYmIGsgPCBuIHx8IDEgPT09IGEgJiYgayA+IG4pIG4gPSBrLCBtID0gZzsKICAgIGMuUGlja09uZShtKTsKICAgIHJldHVybiAhMAp9CgpmdW5jdGlvbiBTZXRYKGEpIHsKICAgIGNvbnN0IGIgPSB0aGlzLkdldFdvcmxkSW5mbygpOwogICAgYi5HZXRYKCkgIT09IGEgJiYgKGIuU2V0WChhKSwgYi5TZXRCYm94Q2hhbmdlZCgpKQp9CgpmdW5jdGlvbiBTZXRZKGEpIHsKICAgIGNvbnN0IGIgPSB0aGlzLkdldFdvcmxkSW5mbygpOwogICAgYi5HZXRZKCkgIT09IGEgJiYgKGIuU2V0WShhKSwgYi5TZXRCYm94Q2hhbmdlZCgpKQp9CgpmdW5jdGlvbiBTZXRQb3MoYSwgYikgewogICAgY29uc3QgZCA9IHRoaXMuR2V0V29ybGRJbmZvKCk7CiAgICBkLkVxdWFsc1hZKGEsIGIpIHx8IChkLlNldFhZKGEsIGIpLCBkLlNldEJib3hDaGFuZ2VkKCkpCn0KCmZ1bmN0aW9uIFNldFBvc1RvT2JqZWN0KGEsIGIpIHsKICAgIGlmIChhICYmIChhID0gYS5HZXRQYWlyZWRJbnN0YW5jZSh0aGlzLl9pbnN0KSkpIHsKICAgICAgICB2YXIgW2QsIGNdID0gYS5HZXRJbWFnZVBvaW50KGIpOwogICAgICAgIGIgPSB0aGlzLkdldFdvcmxkSW5mbygpOwogICAgICAgIGlmIChiLkdldFgoKSAhPT0gZCB8fCBiLkdldFkoKSAhPT0gYykgYi5TZXRYWShkLCBjKSwgYi5TZXRCYm94Q2hhbmdlZCgpCiAgICB9Cn0KCmZ1bmN0aW9uIE1vdmVGb3J3YXJkKGEpIHsKICAgIGlmICgwICE9PSBhKSB7CiAgICAgICAgdmFyIGIgPSB0aGlzLkdldFdvcmxkSW5mbygpOwogICAgICAgIGIuT2Zmc2V0WFkoYi5HZXRDb3NBbmdsZSgpICogYSwgYi5HZXRTaW5BbmdsZSgpICogYSk7CiAgICAgICAgYi5TZXRCYm94Q2hhbmdlZCgpCiAgICB9Cn0KCmZ1bmN0aW9uIE1vdmVBdEFuZ2xlKGEsIGIpIHsKICAgIGlmICgwICE9PSBiKSB7CiAgICAgICAgdmFyIGQgPSB0aGlzLkdldFdvcmxkSW5mbygpOwogICAgICAgIGEgPSBDMyRqc2NvbXAkMTM4LnRvUmFkaWFucyhhKTsKICAgICAgICBkLk9mZnNldFhZKE1hdGguY29zKGEpICogYiwgTWF0aC5zaW4oYSkgKiBiKTsKICAgICAgICBkLlNldEJib3hDaGFuZ2VkKCkKICAgIH0KfQoKZnVuY3Rpb24gR2V0WCgpIHsKICAgIHJldHVybiB0aGlzLkdldFdvcmxkSW5mbygpLkdldFgoKQp9CgpmdW5jdGlvbiBHZXRZKCkgewogICAgcmV0dXJuIHRoaXMuR2V0V29ybGRJbmZvKCkuR2V0WSgpCn0KCmZ1bmN0aW9uIEdldER0KCkgewogICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUuR2V0RHQodGhpcy5faW5zdCkKfQoKZnVuY3Rpb24gQ29tcGFyZVdpZHRoKGEsIGIpIHsKICAgIHJldHVybiBDMyRqc2NvbXAkMTM4LmNvbXBhcmUodGhpcy5HZXRXb3JsZEluZm8oKS5HZXRXaWR0aCgpLCBhLCBiKQp9CgpmdW5jdGlvbiBDb21wYXJlSGVpZ2h0KGEsIGIpIHsKICAgIHJldHVybiBDMyRqc2NvbXAkMTM4LmNvbXBhcmUodGhpcy5HZXRXb3JsZEluZm8oKS5HZXRIZWlnaHQoKSwgYSwgYikKfQoKZnVuY3Rpb24gU2V0V2lkdGgoYSkgewogICAgY29uc3QgYiA9IHRoaXMuR2V0V29ybGRJbmZvKCk7CiAgICBiLkdldFdpZHRoKCkgIT09IGEgJiYgKGIuU2V0V2lkdGgoYSksIGIuU2V0QmJveENoYW5nZWQoKSkKfQoKZnVuY3Rpb24gU2V0SGVpZ2h0KGEpIHsKICAgIGNvbnN0IGIgPSB0aGlzLkdldFdvcmxkSW5mbygpOwogICAgYi5HZXRIZWlnaHQoKSAhPT0gYSAmJiAoYi5TZXRIZWlnaHQoYSksIGIuU2V0QmJveENoYW5nZWQoKSkKfQoKZnVuY3Rpb24gU2V0U2l6ZShhLCBiKSB7CiAgICBjb25zdCBkID0gdGhpcy5HZXRXb3JsZEluZm8oKTsKICAgIGlmIChkLkdldFdpZHRoKCkgIT09IGEgfHwgZC5HZXRIZWlnaHQoKSAhPT0gYikgZC5TZXRTaXplKGEsIGIpLCBkLlNldEJib3hDaGFuZ2VkKCkKfQoKZnVuY3Rpb24gR2V0V2lkdGgoKSB7CiAgICByZXR1cm4gdGhpcy5HZXRXb3JsZEluZm8oKS5HZXRXaWR0aCgpCn0KCmZ1bmN0aW9uIEdldEhlaWdodCgpIHsKICAgIHJldHVybiB0aGlzLkdldFdvcmxkSW5mbygpLkdldEhlaWdodCgpCn0KCmZ1bmN0aW9uIEdldEJib3hMZWZ0KCkgewogICAgcmV0dXJuIHRoaXMuR2V0V29ybGRJbmZvKCkuR2V0Qm91bmRpbmdCb3goKS5nZXRMZWZ0KCkKfQoKZnVuY3Rpb24gR2V0QmJveFRvcCgpIHsKICAgIHJldHVybiB0aGlzLkdldFdvcmxkSW5mbygpLkdldEJvdW5kaW5nQm94KCkuZ2V0VG9wKCkKfQoKZnVuY3Rpb24gR2V0QmJveFJpZ2h0KCkgewogICAgcmV0dXJuIHRoaXMuR2V0V29ybGRJbmZvKCkuR2V0Qm91bmRpbmdCb3goKS5nZXRSaWdodCgpCn0KCmZ1bmN0aW9uIEdldEJib3hCb3R0b20oKSB7CiAgICByZXR1cm4gdGhpcy5HZXRXb3JsZEluZm8oKS5HZXRCb3VuZGluZ0JveCgpLmdldEJvdHRvbSgpCn0KCmZ1bmN0aW9uIElzQW5nbGVXaXRoaW4oYSwgYikgewogICAgcmV0dXJuIEMzJGpzY29tcCQxMzguYW5nbGVEaWZmKHRoaXMuR2V0V29ybGRJbmZvKCkuR2V0QW5nbGUoKSwgQzMkanNjb21wJDEzOC50b1JhZGlhbnMoYikpIDw9IEMzJGpzY29tcCQxMzgudG9SYWRpYW5zKGEpCn0KCmZ1bmN0aW9uIElzQW5nbGVDbG9ja3dpc2VGcm9tKGEpIHsKICAgIHJldHVybiBDMyRqc2NvbXAkMTM4LmFuZ2xlQ2xvY2t3aXNlKHRoaXMuR2V0V29ybGRJbmZvKCkuR2V0QW5nbGUoKSwgQzMkanNjb21wJDEzOC50b1JhZGlhbnMoYSkpCn0KCmZ1bmN0aW9uIElzQmV0d2VlbkFuZ2xlcyhhLCBiKSB7CiAgICBhID0gQzMkanNjb21wJDEzOC50b1JhZGlhbnMoYSk7CiAgICBiID0gQzMkanNjb21wJDEzOC50b1JhZGlhbnMoYik7CiAgICBjb25zdCBkID0gdGhpcy5HZXRXb3JsZEluZm8oKS5HZXRBbmdsZSgpOwogICAgcmV0dXJuIEMzJGpzY29tcCQxMzguYW5nbGVDbG9ja3dpc2UoYiwgYSkgPyBDMyRqc2NvbXAkMTM4LmFuZ2xlQ2xvY2t3aXNlKGQsIGEpICYmICFDMyRqc2NvbXAkMTM4LmFuZ2xlQ2xvY2t3aXNlKGQsIGIpIDogISghQzMkanNjb21wJDEzOC5hbmdsZUNsb2Nrd2lzZShkLCBhKSAmJiBDMyRqc2NvbXAkMTM4LmFuZ2xlQ2xvY2t3aXNlKGQsIGIpKQp9CgpmdW5jdGlvbiBTZXRBbmdsZShhKSB7CiAgICBjb25zdCBiID0gdGhpcy5HZXRXb3JsZEluZm8oKTsKICAgIGEgPSBDMyRqc2NvbXAkMTM4LmNsYW1wQW5nbGUoQzMkanNjb21wJDEzOC50b1JhZGlhbnMoYSkpOwogICAgaXNOYU4oYSkgfHwgYi5HZXRBbmdsZSgpID09PSBhIHx8IChiLlNldEFuZ2xlKGEpLCBiLlNldEJib3hDaGFuZ2VkKCkpCn0KCmZ1bmN0aW9uIFJvdGF0ZUNsb2Nrd2lzZShhKSB7CiAgICBpZiAoIWlzTmFOKGEpICYmIDAgIT09IGEpIHsKICAgICAgICB2YXIgYiA9IHRoaXMuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgYi5TZXRBbmdsZShiLkdldEFuZ2xlKCkgKyBDMyRqc2NvbXAkMTM4LnRvUmFkaWFucyhhKSk7CiAgICAgICAgYi5TZXRCYm94Q2hhbmdlZCgpCiAgICB9Cn0KCmZ1bmN0aW9uIFJvdGF0ZUNvdW50ZXJjbG9ja3dpc2UoYSkgewogICAgaWYgKCFpc05hTihhKSAmJiAwICE9PSBhKSB7CiAgICAgICAgdmFyIGIgPSB0aGlzLkdldFdvcmxkSW5mbygpOwogICAgICAgIGIuU2V0QW5nbGUoYi5HZXRBbmdsZSgpIC0gQzMkanNjb21wJDEzOC50b1JhZGlhbnMoYSkpOwogICAgICAgIGIuU2V0QmJveENoYW5nZWQoKQogICAgfQp9CgpmdW5jdGlvbiBSb3RhdGVUb3dhcmRBbmdsZShhLCBiKSB7CiAgICBjb25zdCBkID0gdGhpcy5HZXRXb3JsZEluZm8oKSwKICAgICAgICBjID0gZC5HZXRBbmdsZSgpOwogICAgYSA9IEMzJGpzY29tcCQxMzguYW5nbGVSb3RhdGUoYywgQzMkanNjb21wJDEzOC50b1JhZGlhbnMoYiksIEMzJGpzY29tcCQxMzgudG9SYWRpYW5zKGEpKTsKICAgIGlzTmFOKGEpIHx8IGMgPT09IGEgfHwgKGQuU2V0QW5nbGUoYSksIGQuU2V0QmJveENoYW5nZWQoKSkKfQoKZnVuY3Rpb24gUm90YXRlVG93YXJkUG9zaXRpb24oYSwgYiwgZCkgewogICAgY29uc3QgYyA9IHRoaXMuR2V0V29ybGRJbmZvKCksCiAgICAgICAgZSA9IGMuR2V0QW5nbGUoKTsKICAgIGIgLT0gYy5HZXRYKCk7CiAgICBkIC09IGMuR2V0WSgpOwogICAgYSA9IEMzJGpzY29tcCQxMzguYW5nbGVSb3RhdGUoZSwgTWF0aC5hdGFuMihkLCBiKSwgQzMkanNjb21wJDEzOC50b1JhZGlhbnMoYSkpOwogICAgaXNOYU4oYSkgfHwgZSA9PT0gYSB8fCAoYy5TZXRBbmdsZShhKSwgYy5TZXRCYm94Q2hhbmdlZCgpKQp9CgpmdW5jdGlvbiBTZXRUb3dhcmRQb3NpdGlvbihhLCBiKSB7CiAgICBjb25zdCBkID0gdGhpcy5HZXRXb3JsZEluZm8oKSwKICAgICAgICBjID0gZC5HZXRBbmdsZSgpOwogICAgYSAtPSBkLkdldFgoKTsKICAgIGIgLT0gZC5HZXRZKCk7CiAgICBiID0gTWF0aC5hdGFuMihiLCBhKTsKICAgIGlzTmFOKGIpIHx8IGMgPT09IGIgfHwgKGQuU2V0QW5nbGUoYiksIGQuU2V0QmJveENoYW5nZWQoKSkKfQoKZnVuY3Rpb24gR2V0QW5nbGUoKSB7CiAgICByZXR1cm4gQzMkanNjb21wJDEzOC50b0RlZ3JlZXModGhpcy5HZXRXb3JsZEluZm8oKS5HZXRBbmdsZSgpKQp9CgpmdW5jdGlvbiBDb21wYXJlT3BhY2l0eShhLCBiKSB7CiAgICByZXR1cm4gQzMkanNjb21wJDEzOC5jb21wYXJlKEMzJGpzY29tcCQxMzgucm91bmQ2ZHAoMTAwICogdGhpcy5HZXRXb3JsZEluZm8oKS5HZXRPcGFjaXR5KCkpLCBhLCBiKQp9CgpmdW5jdGlvbiBJc1Zpc2libGUoKSB7CiAgICByZXR1cm4gdGhpcy5HZXRXb3JsZEluZm8oKS5Jc1Zpc2libGUoKQp9CgpmdW5jdGlvbiBTZXRWaXNpYmxlKGEpIHsKICAgIGNvbnN0IGIgPSB0aGlzLkdldFdvcmxkSW5mbygpOwogICAgYSA9IDIgPT09IGEgPyAhYi5Jc1Zpc2libGUoKSA6IDAgIT09IGE7CiAgICBiLklzVmlzaWJsZSgpICE9PSBhICYmIChiLlNldFZpc2libGUoYSksIHRoaXMuX3J1bnRpbWUuVXBkYXRlUmVuZGVyKCkpCn0KCmZ1bmN0aW9uIFNldE9wYWNpdHkoYSkgewogICAgYSA9IEMzJGpzY29tcCQxMzguY2xhbXAoYSAvIDEwMCwgMCwgMSk7CiAgICBjb25zdCBiID0gdGhpcy5HZXRXb3JsZEluZm8oKTsKICAgIGIuR2V0T3BhY2l0eSgpICE9PSBhICYmIChiLlNldE9wYWNpdHkoYSksIHRoaXMuX3J1bnRpbWUuVXBkYXRlUmVuZGVyKCkpCn0KCmZ1bmN0aW9uIFNldERlZmF1bHRDb2xvcihhKSB7CiAgICB0ZW1wQ29sb3IkanNjb21wJDUuc2V0RnJvbVJnYlZhbHVlKGEpOwogICAgYSA9IHRoaXMuR2V0V29ybGRJbmZvKCk7CiAgICBhLkdldFVucHJlbXVsdGlwbGllZENvbG9yKCkuZXF1YWxzSWdub3JpbmdBbHBoYSh0ZW1wQ29sb3IkanNjb21wJDUpIHx8IChhLlNldFVucHJlbXVsdGlwbGllZENvbG9yKHRlbXBDb2xvciRqc2NvbXAkNSksIHRoaXMuX3J1bnRpbWUuVXBkYXRlUmVuZGVyKCkpCn0KCmZ1bmN0aW9uIEdldENvbG9yKCkgewogICAgY29uc3QgYSA9IHRoaXMuR2V0V29ybGRJbmZvKCkuR2V0VW5wcmVtdWx0aXBsaWVkQ29sb3IoKTsKICAgIHJldHVybiBDMyRqc2NvbXAkMTM4LlBhY2tSR0JBRXgoYS5nZXRSKCksIGEuZ2V0RygpLCBhLmdldEIoKSwgYS5nZXRBKCkpCn0KCmZ1bmN0aW9uIEdldE9wYWNpdHkoKSB7CiAgICByZXR1cm4gQzMkanNjb21wJDEzOC5yb3VuZDZkcCgxMDAgKiB0aGlzLkdldFdvcmxkSW5mbygpLkdldE9wYWNpdHkoKSkKfQoKZnVuY3Rpb24gSXNPbkxheWVyKGEpIHsKICAgIHJldHVybiBhID8gdGhpcy5HZXRXb3JsZEluZm8oKS5HZXRMYXllcigpID09PSBhIDogITEKfQoKZnVuY3Rpb24gUGlja1RvcEJvdHRvbShhKSB7CiAgICBjb25zdCBiID0gdGhpcy5HZXRDdXJyZW50U29sKCksCiAgICAgICAgZCA9IGIuR2V0SW5zdGFuY2VzKCk7CiAgICBpZiAoIWQubGVuZ3RoKSByZXR1cm4gITE7CiAgICBsZXQgYyA9IGRbMF07CiAgICBmb3IgKGxldCBlID0gMSwgZyA9IGQubGVuZ3RoOyBlIDwgZzsgKytlKSB7CiAgICAgICAgY29uc3QgayA9IGRbZV0sCiAgICAgICAgICAgIG0gPSBrLkdldFdvcmxkSW5mbygpLAogICAgICAgICAgICBuID0gYy5HZXRXb3JsZEluZm8oKSwKICAgICAgICAgICAgcSA9IG0uR2V0TGF5ZXIoKS5HZXRJbmRleCgpLAogICAgICAgICAgICB1ID0gbi5HZXRMYXllcigpLkdldEluZGV4KCk7CiAgICAgICAgaWYgKDAgPT09IGEpIHsKICAgICAgICAgICAgaWYgKHEgPiB1IHx8IHEgPT09IHUgJiYgbS5HZXRaSW5kZXgoKSA+IG4uR2V0WkluZGV4KCkpIGMgPSBrCiAgICAgICAgfSBlbHNlIGlmIChxIDwgdSB8fCBxID09PSB1ICYmIG0uR2V0WkluZGV4KCkgPCBuLkdldFpJbmRleCgpKSBjID0gawogICAgfQogICAgYi5QaWNrT25lKGMpOwogICAgcmV0dXJuICEwCn0KCmZ1bmN0aW9uIENvbXBhcmVaRWxldmF0aW9uKGEsIGIsIGQpIHsKICAgIGNvbnN0IGMgPSB0aGlzLkdldFdvcmxkSW5mbygpOwogICAgYSA9IDAgPT09IGEgPyBjLkdldFpFbGV2YXRpb24oKSA6IGMuR2V0VG90YWxaRWxldmF0aW9uKCk7CiAgICByZXR1cm4gQzMkanNjb21wJDEzOC5jb21wYXJlKGEsIGIsIGQpCn0KCmZ1bmN0aW9uIE1vdmVUb1RvcCgpIHsKICAgIHRoaXMuR2V0V29ybGRJbmZvKCkuWk9yZGVyTW92ZVRvVG9wKCkKfQoKZnVuY3Rpb24gTW92ZVRvQm90dG9tKCkgewogICAgdGhpcy5HZXRXb3JsZEluZm8oKS5aT3JkZXJNb3ZlVG9Cb3R0b20oKQp9CgpmdW5jdGlvbiBNb3ZlVG9MYXllcihhKSB7CiAgICBhICYmIHRoaXMuR2V0V29ybGRJbmZvKCkuWk9yZGVyTW92ZVRvTGF5ZXIoYSkKfQoKZnVuY3Rpb24gWk1vdmVUb09iamVjdChhLCBiKSB7CiAgICBhID0gMCA9PT0gYTsKICAgIGIgJiYgKGIgPSBiLkdldEZpcnN0UGlja2VkKHRoaXMuR2V0SW5zdGFuY2UoKSkpICYmIHRoaXMuR2V0V29ybGRJbmZvKCkuWk9yZGVyTW92ZUFkamFjZW50VG9JbnN0YW5jZShiLCBhKQp9CgpmdW5jdGlvbiBTZXRaRWxldmF0aW9uKGEpIHsKICAgIGNvbnN0IGIgPSB0aGlzLkdldFdvcmxkSW5mbygpOwogICAgYi5HZXRaRWxldmF0aW9uKCkgIT09IGEgJiYgKGIuU2V0WkVsZXZhdGlvbihhKSwgdGhpcy5fcnVudGltZS5VcGRhdGVSZW5kZXIoKSkKfQoKZnVuY3Rpb24gTGF5ZXJOdW1iZXIoKSB7CiAgICByZXR1cm4gdGhpcy5HZXRXb3JsZEluZm8oKS5HZXRMYXllcigpLkdldEluZGV4KCkKfQoKZnVuY3Rpb24gTGF5ZXJOYW1lKCkgewogICAgcmV0dXJuIHRoaXMuR2V0V29ybGRJbmZvKCkuR2V0TGF5ZXIoKS5HZXROYW1lKCkKfQoKZnVuY3Rpb24gWkluZGV4KCkgewogICAgcmV0dXJuIHRoaXMuR2V0V29ybGRJbmZvKCkuR2V0WkluZGV4KCkKfQoKZnVuY3Rpb24gWkVsZXZhdGlvbigpIHsKICAgIHJldHVybiB0aGlzLkdldFdvcmxkSW5mbygpLkdldFpFbGV2YXRpb24oKQp9CgpmdW5jdGlvbiBUb3RhbFpFbGV2YXRpb24oKSB7CiAgICByZXR1cm4gdGhpcy5HZXRXb3JsZEluZm8oKS5HZXRUb3RhbFpFbGV2YXRpb24oKQp9CgpmdW5jdGlvbiBJc0VmZmVjdEVuYWJsZWQoYSkgewogICAgaWYgKGEgPSB0aGlzLkdldE9iamVjdENsYXNzKCkuR2V0RWZmZWN0TGlzdCgpLkdldEVmZmVjdFR5cGVCeU5hbWUoYSkpIHJldHVybiBhID0gYS5HZXRJbmRleCgpLCB0aGlzLkdldFdvcmxkSW5mbygpLkdldEluc3RhbmNlRWZmZWN0TGlzdCgpLklzRWZmZWN0SW5kZXhBY3RpdmUoYSkKfQoKZnVuY3Rpb24gU2V0RWZmZWN0RW5hYmxlZChhLCBiKSB7CiAgICBpZiAoYiA9IHRoaXMuR2V0T2JqZWN0Q2xhc3MoKS5HZXRFZmZlY3RMaXN0KCkuR2V0RWZmZWN0VHlwZUJ5TmFtZShiKSkgewogICAgICAgIGIgPSBiLkdldEluZGV4KCk7CiAgICAgICAgYSA9IDEgPT09IGE7CiAgICAgICAgdmFyIGQgPSB0aGlzLkdldFdvcmxkSW5mbygpLkdldEluc3RhbmNlRWZmZWN0TGlzdCgpOwogICAgICAgIGQuSXNFZmZlY3RJbmRleEFjdGl2ZShiKSAhPT0gYSAmJiAoZC5TZXRFZmZlY3RJbmRleEFjdGl2ZShiLCBhKSwgZC5VcGRhdGVBY3RpdmVFZmZlY3RzKCksIHRoaXMuX3J1bnRpbWUuVXBkYXRlUmVuZGVyKCkpCiAgICB9Cn0KCmZ1bmN0aW9uIFNldEVmZmVjdFBhcmFtKGEsIGIsIGQpIHsKICAgIGlmIChhID0gdGhpcy5HZXRPYmplY3RDbGFzcygpLkdldEVmZmVjdExpc3QoKS5HZXRFZmZlY3RUeXBlQnlOYW1lKGEpKSB7CiAgICAgICAgYiA9IE1hdGguZmxvb3IoYik7CiAgICAgICAgdmFyIGMgPSBhLkdldFNoYWRlclByb2dyYW0oKS5HZXRQYXJhbWV0ZXJUeXBlKGIpOwogICAgICAgIGMgJiYgKCJjb2xvciIgPT09IGMgPyAodGVtcENvbG9yJGpzY29tcCQ1LnNldEZyb21SZ2JWYWx1ZShkKSwgZCA9IHRlbXBDb2xvciRqc2NvbXAkNSkgOiAicGVyY2VudCIgPT09IGMgJiYgKGQgLz0gMTAwKSwgYSA9IGEuR2V0SW5kZXgoKSwgYyA9IHRoaXMuR2V0V29ybGRJbmZvKCkuR2V0SW5zdGFuY2VFZmZlY3RMaXN0KCksIGMuU2V0RWZmZWN0UGFyYW1ldGVyKGEsIGIsIGQpICYmIGMuSXNFZmZlY3RJbmRleEFjdGl2ZShhKSAmJiB0aGlzLl9ydW50aW1lLlVwZGF0ZVJlbmRlcigpKQogICAgfQp9CmNvbnN0IHRlbXBSZWN0JGpzY29tcCQ0ID0gQzMkanNjb21wJDEzOC5OZXcoQzMkanNjb21wJDEzOC5SZWN0KSwKICAgIHRlbXBDYW5kaWRhdGVzMSA9IFtdLAogICAgdGVtcENhbmRpZGF0ZXMyID0gW107CmxldCBuZWVkc0NvbGxpc2lvbkZpbmlzaCA9ICExLAogICAgclBpY2tUeXBlID0gbnVsbCwKICAgIHJQaWNrRnJvbUVsc2VJbnN0YW5jZXMgPSAhMTsKY29uc3QgclRvUGljayA9IG5ldyBTZXQ7CgpmdW5jdGlvbiBDb2xsTWVtb3J5X0FkZChhLCBiLCBkLCBjKSB7CiAgICBjb25zdCBlID0gYi5HZXRVSUQoKSwKICAgICAgICBnID0gZC5HZXRVSUQoKTsKICAgIGUgPCBnID8gYS5TZXQoYiwgZCwgYykgOiBhLlNldChkLCBiLCBjKQp9CgpmdW5jdGlvbiBDb2xsTWVtb3J5X1JlbW92ZShhLCBiLCBkKSB7CiAgICBjb25zdCBjID0gYi5HZXRVSUQoKSwKICAgICAgICBlID0gZC5HZXRVSUQoKTsKICAgIGMgPCBlID8gYS5EZWxldGUoYiwgZCkgOiBhLkRlbGV0ZShkLCBiKQp9CgpmdW5jdGlvbiBDb2xsTWVtb3J5X1JlbW92ZUluc3RhbmNlKGEsIGIpIHsKICAgIGEuRGVsZXRlRWl0aGVyKGIpCn0KCmZ1bmN0aW9uIENvbGxNZW1vcnlfR2V0KGEsIGIsIGQpIHsKICAgIGNvbnN0IGMgPSBiLkdldFVJRCgpLAogICAgICAgIGUgPSBkLkdldFVJRCgpOwogICAgcmV0dXJuIGMgPCBlID8gYS5HZXQoYiwgZCkgOiBhLkdldChkLCBiKQp9CgpmdW5jdGlvbiBEb092ZXJsYXBDb25kaXRpb24oYSwgYiwgZCwgYykgewogICAgaWYgKCFiKSByZXR1cm4gITE7CiAgICBhID0gYS5HZXRJbnN0YW5jZSgpOwogICAgY29uc3QgZSA9IDAgIT09IGQgfHwgMCAhPT0gYywKICAgICAgICBnID0gYS5HZXRXb3JsZEluZm8oKSwKICAgICAgICBrID0gYS5HZXRSdW50aW1lKCksCiAgICAgICAgbSA9IGsuR2V0Q29sbGlzaW9uRW5naW5lKCk7CiAgICB2YXIgbiA9IGsuR2V0Q3VycmVudENvbmRpdGlvbigpOwogICAgY29uc3QgcSA9IG4uR2V0RXZlbnRCbG9jaygpLklzT3JCbG9jaygpOwogICAgdmFyIHUgPSBuLkdldE9iamVjdENsYXNzKCk7CiAgICBuID0gbi5Jc0ludmVydGVkKCk7CiAgICBjb25zdCB3ID0gYi5HZXRDdXJyZW50U29sKCk7CiAgICB1ID0gdSAhPT0gYjsKICAgIHJQaWNrVHlwZSA9IGI7CiAgICBuZWVkc0NvbGxpc2lvbkZpbmlzaCA9IHUgJiYgIW47CiAgICByUGlja0Zyb21FbHNlSW5zdGFuY2VzID0gITE7CiAgICBsZXQgeiA9IDAsCiAgICAgICAgQyA9IDAsCiAgICAgICAgRCA9ICExOwogICAgdy5Jc1NlbGVjdEFsbCgpID8gKHRlbXBSZWN0JGpzY29tcCQ0LmNvcHkoZy5HZXRCb3VuZGluZ0JveCgpKSwgdGVtcFJlY3QkanNjb21wJDQub2Zmc2V0KGQsIGMpLCBtLkdldENvbGxpc2lvbkNhbmRpZGF0ZXMoZy5HZXRMYXllcigpLAogICAgICAgIGIsIHRlbXBSZWN0JGpzY29tcCQ0LCB0ZW1wQ2FuZGlkYXRlczIpLCBiID0gdGVtcENhbmRpZGF0ZXMyKSA6IHEgPyBrLklzQ3VycmVudENvbmRpdGlvbkZpcnN0KCkgJiYgIXcuX0dldE93bkVsc2VJbnN0YW5jZXMoKS5sZW5ndGggJiYgdy5fR2V0T3duSW5zdGFuY2VzKCkubGVuZ3RoID8gYiA9IHcuX0dldE93bkluc3RhbmNlcygpIDogKGIgPSB3Ll9HZXRPd25FbHNlSW5zdGFuY2VzKCksIHJQaWNrRnJvbUVsc2VJbnN0YW5jZXMgPSAhMCkgOiBiID0gdy5fR2V0T3duSW5zdGFuY2VzKCk7CiAgICBlICYmICh6ID0gZy5HZXRYKCksIEMgPSBnLkdldFkoKSwgZy5PZmZzZXRYWShkLCBjKSwgZy5TZXRCYm94Q2hhbmdlZCgpKTsKICAgIGZvciAoY29uc3QgRiBvZiBiKQogICAgICAgIGlmIChtLlRlc3RPdmVybGFwKGEsIEYpKSB7CiAgICAgICAgICAgIEQgPSAhMDsKICAgICAgICAgICAgaWYgKG4pIGJyZWFrOwogICAgICAgICAgICB1ICYmIHJUb1BpY2suYWRkKEYpCiAgICAgICAgfQogICAgZSAmJiAoZy5TZXRYWSh6LCBDKSwgZy5TZXRCYm94Q2hhbmdlZCgpKTsKICAgIEMzJGpzY29tcCQxMzguY2xlYXJBcnJheSh0ZW1wQ2FuZGlkYXRlczIpOwogICAgcmV0dXJuIEQKfQoKZnVuY3Rpb24gRmluaXNoQ29sbGlzaW9uQ29uZGl0aW9uUGlja2luZyhhKSB7CiAgICBhID0gYS5HZXRSdW50aW1lKCkuR2V0Q3VycmVudEV2ZW50KCkuSXNPckJsb2NrKCk7CiAgICBjb25zdCBiID0gclBpY2tUeXBlLkdldEN1cnJlbnRTb2woKSwKICAgICAgICBkID0gYi5fR2V0T3duSW5zdGFuY2VzKCksCiAgICAgICAgYyA9IGIuX0dldE93bkVsc2VJbnN0YW5jZXMoKTsKICAgIGIuSXNTZWxlY3RBbGwoKSA/IChiLlNldFNldFBpY2tlZChyVG9QaWNrKSwgYSAmJiAoQzMkanNjb21wJDEzOC5jbGVhckFycmF5KGMpLCBiLkFkZEVsc2VJbnN0YW5jZXMoclRvUGljaywgclBpY2tUeXBlLkdldEluc3RhbmNlcygpKSkpIDogYSA/IHJQaWNrRnJvbUVsc2VJbnN0YW5jZXMgPyBiLlRyYW5zZmVyRWxzZUluc3RhbmNlc1RvT3duKHJUb1BpY2spIDogKGIuQWRkRWxzZUluc3RhbmNlcyhyVG9QaWNrLCBkKSwgYi5TZXRTZXRQaWNrZWQoclRvUGljaykpIDogYi5TZXRTZXRQaWNrZWQoclRvUGljayk7CiAgICByUGlja1R5cGUuQXBwbHlTb2xUb0NvbnRhaW5lcigpCn0KCmZ1bmN0aW9uIEZpbmlzaENvbGxpc2lvbkNvbmRpdGlvbihhLCBiKSB7CiAgICBuZWVkc0NvbGxpc2lvbkZpbmlzaCAmJiAoYiAmJiBGaW5pc2hDb2xsaXNpb25Db25kaXRpb25QaWNraW5nKGEpLCByVG9QaWNrLmNsZWFyKCksIHJQaWNrVHlwZSA9IG51bGwsIG5lZWRzQ29sbGlzaW9uRmluaXNoID0gITEpCn0KCmZ1bmN0aW9uIE9uQ29sbGlzaW9uKGEpIHsKICAgIGlmICh0aGlzLl9ydW50aW1lLklzRGVidWdnaW5nKCkpIHJldHVybiBEZWJ1Z09uQ29sbGlzaW9uLmNhbGwodGhpcywgYSk7CiAgICBpZiAoIWEpIHJldHVybiAhMTsKICAgIHZhciBiID0gdGhpcy5fcnVudGltZTsKICAgIGNvbnN0IGQgPSBiLkdldENvbGxpc2lvbkVuZ2luZSgpLAogICAgICAgIGMgPSBiLkdldEV2ZW50U2hlZXRNYW5hZ2VyKCksCiAgICAgICAgZSA9IGMuR2V0RXZlbnRTdGFjaygpOwogICAgdmFyIGcgPSBjLkdldEN1cnJlbnRDb25kaXRpb24oKTsKICAgIGNvbnN0IGsgPSBnLkdldE9iamVjdENsYXNzKCk7CiAgICB2YXIgbSA9IGcuR2V0U2F2ZWREYXRhTWFwKCksCiAgICAgICAgbiA9IGcuR2V0VW5zYXZlZERhdGFNYXAoKTsKICAgIGcgPSBlLkdldEN1cnJlbnRTdGFja0ZyYW1lKCk7CiAgICBjb25zdCBxID0gYi5HZXRUaWNrQ291bnQoKSwKICAgICAgICB1ID0gcSAtIDEsCiAgICAgICAgdyA9IGcuR2V0Q3VycmVudEV2ZW50KCksCiAgICAgICAgeiA9IGUuUHVzaCh3KTsKICAgIGxldCBDID0gbS5nZXQoImNvbGxtZW1vcnkiKTsKICAgIEMgfHwgKEMgPSBDMyRqc2NvbXAkMTM4Lk5ldyhDMyRqc2NvbXAkMTM4LlBhaXJNYXApLCBtLnNldCgiY29sbG1lbW9yeSIsIEMpKTsKICAgIG4uZ2V0KCJjb2xsaXNpb25DcmVhdGVkRGVzdHJveUNhbGxiYWNrIikgfHwKICAgICAgICAobi5zZXQoImNvbGxpc2lvbkNyZWF0ZWREZXN0cm95Q2FsbGJhY2siLCAhMCksIGIuRGlzcGF0Y2hlcigpLmFkZEV2ZW50TGlzdGVuZXIoImluc3RhbmNlZGVzdHJveSIsIEogPT4gQ29sbE1lbW9yeV9SZW1vdmVJbnN0YW5jZShDLCBKLmluc3RhbmNlKSkpOwogICAgbSA9IGsuR2V0Q3VycmVudFNvbCgpOwogICAgYiA9IGEuR2V0Q3VycmVudFNvbCgpOwogICAgbSA9IG0uR2V0SW5zdGFuY2VzKCk7CiAgICBuID0gbnVsbDsKICAgIGZvciAobGV0IEogPSAwOyBKIDwgbS5sZW5ndGg7ICsrSikgewogICAgICAgIGNvbnN0IEsgPSBtW0pdOwogICAgICAgIGIuSXNTZWxlY3RBbGwoKSA/IChkLkdldENvbGxpc2lvbkNhbmRpZGF0ZXMoSy5HZXRXb3JsZEluZm8oKS5HZXRMYXllcigpLCBhLCBLLkdldFdvcmxkSW5mbygpLkdldEJvdW5kaW5nQm94KCksIHRlbXBDYW5kaWRhdGVzMSksIG4gPSB0ZW1wQ2FuZGlkYXRlczEsIGQuQWRkUmVnaXN0ZXJlZENvbGxpc2lvbkNhbmRpZGF0ZXMoSywgYSwgbikpIDogbiA9IGIuR2V0SW5zdGFuY2VzKCk7CiAgICAgICAgZm9yIChsZXQgTyA9IDA7IE8gPCBuLmxlbmd0aDsgKytPKSB7CiAgICAgICAgICAgIGNvbnN0IFYgPSBuW09dOwogICAgICAgICAgICBpZiAoZC5UZXN0T3ZlcmxhcChLLAogICAgICAgICAgICAgICAgICAgIFYpIHx8IGQuQ2hlY2tSZWdpc3RlcmVkQ29sbGlzaW9uKEssIFYpKSB7CiAgICAgICAgICAgICAgICB2YXIgRCA9IENvbGxNZW1vcnlfR2V0KEMsIEssIFYpLAogICAgICAgICAgICAgICAgICAgIEYgPSAhMSwKICAgICAgICAgICAgICAgICAgICBFID0gLTI7CiAgICAgICAgICAgICAgICAibnVtYmVyIiA9PT0gdHlwZW9mIEQgJiYgKEYgPSAhMCwgRSA9IEQpOwogICAgICAgICAgICAgICAgRCA9ICFGIHx8IEUgPCB1OwogICAgICAgICAgICAgICAgQ29sbE1lbW9yeV9BZGQoQywgSywgViwgcSk7CiAgICAgICAgICAgICAgICBEICYmIChEID0gdy5HZXRTb2xNb2RpZmllcnMoKSwgYy5QdXNoQ29weVNvbChEKSwgRSA9IGsuR2V0Q3VycmVudFNvbCgpLCBGID0gYS5HZXRDdXJyZW50U29sKCksIEUuX1NldFNlbGVjdEFsbCghMSksIEYuX1NldFNlbGVjdEFsbCghMSksIGsgPT09IGEgPyAoRiA9IEUuX0dldE93bkluc3RhbmNlcygpLCBDMyRqc2NvbXAkMTM4LmNsZWFyQXJyYXkoRiksIEYucHVzaChLKSwgRi5wdXNoKFYpLCBrLkFwcGx5U29sVG9Db250YWluZXIoKSkgOiAoRSA9IEUuX0dldE93bkluc3RhbmNlcygpLCBGID0gRi5fR2V0T3duSW5zdGFuY2VzKCksIEMzJGpzY29tcCQxMzguY2xlYXJBcnJheShFKSwgQzMkanNjb21wJDEzOC5jbGVhckFycmF5KEYpLCBFLnB1c2goSyksIEYucHVzaChWKSwgay5BcHBseVNvbFRvQ29udGFpbmVyKCksCiAgICAgICAgICAgICAgICAgICAgYS5BcHBseVNvbFRvQ29udGFpbmVyKCkpLCB3LlJldHJpZ2dlcihnLCB6KSwgYy5Qb3BTb2woRCkpCiAgICAgICAgICAgIH0gZWxzZSBDb2xsTWVtb3J5X1JlbW92ZShDLCBLLCBWKQogICAgICAgIH0KICAgICAgICBDMyRqc2NvbXAkMTM4LmNsZWFyQXJyYXkodGVtcENhbmRpZGF0ZXMxKQogICAgfQogICAgZS5Qb3AoKTsKICAgIHJldHVybiAhMQp9CgpmdW5jdGlvbiogRGVidWdPbkNvbGxpc2lvbihhKSB7CiAgICBpZiAoIWEpIHJldHVybiAhMTsKICAgIHZhciBiID0gdGhpcy5fcnVudGltZTsKICAgIGNvbnN0IGQgPSBiLkdldENvbGxpc2lvbkVuZ2luZSgpLAogICAgICAgIGMgPSBiLkdldEV2ZW50U2hlZXRNYW5hZ2VyKCksCiAgICAgICAgZSA9IGMuR2V0RXZlbnRTdGFjaygpOwogICAgdmFyIGcgPSBjLkdldEN1cnJlbnRDb25kaXRpb24oKTsKICAgIGNvbnN0IGsgPSBnLkdldE9iamVjdENsYXNzKCk7CiAgICB2YXIgbSA9IGcuR2V0U2F2ZWREYXRhTWFwKCksCiAgICAgICAgbiA9IGcuR2V0VW5zYXZlZERhdGFNYXAoKTsKICAgIGcgPSBlLkdldEN1cnJlbnRTdGFja0ZyYW1lKCk7CiAgICBjb25zdCBxID0gYi5HZXRUaWNrQ291bnQoKSwKICAgICAgICB1ID0gcSAtIDEsCiAgICAgICAgdyA9IGcuR2V0Q3VycmVudEV2ZW50KCksCiAgICAgICAgeiA9IGUuUHVzaCh3KTsKICAgIGxldCBDID0gbS5nZXQoImNvbGxtZW1vcnkiKTsKICAgIEMgfHwgKEMgPSBDMyRqc2NvbXAkMTM4Lk5ldyhDMyRqc2NvbXAkMTM4LlBhaXJNYXApLCBtLnNldCgiY29sbG1lbW9yeSIsIEMpKTsKICAgIG4uZ2V0KCJjb2xsaXNpb25DcmVhdGVkRGVzdHJveUNhbGxiYWNrIikgfHwgKG4uc2V0KCJjb2xsaXNpb25DcmVhdGVkRGVzdHJveUNhbGxiYWNrIiwgITApLCBiLkRpc3BhdGNoZXIoKS5hZGRFdmVudExpc3RlbmVyKCJpbnN0YW5jZWRlc3Ryb3kiLCBKID0+IENvbGxNZW1vcnlfUmVtb3ZlSW5zdGFuY2UoQywgSi5pbnN0YW5jZSkpKTsKICAgIG0gPSBrLkdldEN1cnJlbnRTb2woKTsKICAgIGIgPSBhLkdldEN1cnJlbnRTb2woKTsKICAgIG0gPSBtLkdldEluc3RhbmNlcygpOwogICAgbiA9IG51bGw7CiAgICBmb3IgKGxldCBKID0gMDsgSiA8IG0ubGVuZ3RoOyArK0opIHsKICAgICAgICBjb25zdCBLID0gbVtKXTsKICAgICAgICBiLklzU2VsZWN0QWxsKCkgPyAoZC5HZXRDb2xsaXNpb25DYW5kaWRhdGVzKEsuR2V0V29ybGRJbmZvKCkuR2V0TGF5ZXIoKSwgYSwgSy5HZXRXb3JsZEluZm8oKS5HZXRCb3VuZGluZ0JveCgpLCB0ZW1wQ2FuZGlkYXRlczEpLCBuID0gdGVtcENhbmRpZGF0ZXMxLCBkLkFkZFJlZ2lzdGVyZWRDb2xsaXNpb25DYW5kaWRhdGVzKEssIGEsIG4pKSA6IG4gPSBiLkdldEluc3RhbmNlcygpOwogICAgICAgIGZvciAobGV0IE8gPSAwOyBPIDwgbi5sZW5ndGg7ICsrTykgewogICAgICAgICAgICBjb25zdCBWID0gbltPXTsKICAgICAgICAgICAgaWYgKGQuVGVzdE92ZXJsYXAoSywgVikgfHwgZC5DaGVja1JlZ2lzdGVyZWRDb2xsaXNpb24oSywKICAgICAgICAgICAgICAgICAgICBWKSkgewogICAgICAgICAgICAgICAgdmFyIEQgPSBDb2xsTWVtb3J5X0dldChDLCBLLCBWKSwKICAgICAgICAgICAgICAgICAgICBGID0gITEsCiAgICAgICAgICAgICAgICAgICAgRSA9IC0yOwogICAgICAgICAgICAgICAgIm51bWJlciIgPT09IHR5cGVvZiBEICYmIChGID0gITAsIEUgPSBEKTsKICAgICAgICAgICAgICAgIEQgPSAhRiB8fCBFIDwgdTsKICAgICAgICAgICAgICAgIENvbGxNZW1vcnlfQWRkKEMsIEssIFYsIHEpOwogICAgICAgICAgICAgICAgRCAmJiAoRCA9IHcuR2V0U29sTW9kaWZpZXJzKCksIGMuUHVzaENvcHlTb2woRCksIEUgPSBrLkdldEN1cnJlbnRTb2woKSwgRiA9IGEuR2V0Q3VycmVudFNvbCgpLCBFLl9TZXRTZWxlY3RBbGwoITEpLCBGLl9TZXRTZWxlY3RBbGwoITEpLCBrID09PSBhID8gKEYgPSBFLl9HZXRPd25JbnN0YW5jZXMoKSwgQzMkanNjb21wJDEzOC5jbGVhckFycmF5KEYpLCBGLnB1c2goSyksIEYucHVzaChWKSwgay5BcHBseVNvbFRvQ29udGFpbmVyKCkpIDogKEUgPSBFLl9HZXRPd25JbnN0YW5jZXMoKSwgRiA9IEYuX0dldE93bkluc3RhbmNlcygpLCBDMyRqc2NvbXAkMTM4LmNsZWFyQXJyYXkoRSksIEMzJGpzY29tcCQxMzguY2xlYXJBcnJheShGKSwgRS5wdXNoKEspLCBGLnB1c2goViksIGsuQXBwbHlTb2xUb0NvbnRhaW5lcigpLCBhLkFwcGx5U29sVG9Db250YWluZXIoKSksCiAgICAgICAgICAgICAgICAgICAgeWllbGQqIHcuRGVidWdSZXRyaWdnZXIoZywgeiksIGMuUG9wU29sKEQpKQogICAgICAgICAgICB9IGVsc2UgQ29sbE1lbW9yeV9SZW1vdmUoQywgSywgVikKICAgICAgICB9CiAgICAgICAgQzMkanNjb21wJDEzOC5jbGVhckFycmF5KHRlbXBDYW5kaWRhdGVzMSkKICAgIH0KICAgIGUuUG9wKCk7CiAgICByZXR1cm4gITEKfQoKZnVuY3Rpb24gSXNPdmVybGFwcGluZyhhKSB7CiAgICByZXR1cm4gRG9PdmVybGFwQ29uZGl0aW9uKHRoaXMsIGEsIDAsIDApCn0KCmZ1bmN0aW9uIElzT3ZlcmxhcHBpbmdPZmZzZXQoYSwgYiwgZCkgewogICAgcmV0dXJuIERvT3ZlcmxhcENvbmRpdGlvbih0aGlzLCBhLCBiLCBkKQp9CgpmdW5jdGlvbiBIYXNQYXJlbnQoKSB7CiAgICByZXR1cm4gdGhpcy5HZXRXb3JsZEluZm8oKS5IYXNQYXJlbnQoKQp9CgpmdW5jdGlvbiBIYXNDaGlsZHJlbigpIHsKICAgIHJldHVybiB0aGlzLkdldFdvcmxkSW5mbygpLkhhc0NoaWxkcmVuKCkKfQoKZnVuY3Rpb24gUGlja1BhcmVudChhLCBiKSB7CiAgICBjb25zdCBkID0gdGhpcy5HZXRDdXJyZW50U29sKCkuR2V0SW5zdGFuY2VzKCk7CiAgICBpZiAoMCA9PT0gZC5sZW5ndGgpIHJldHVybiAhMTsKICAgIGNvbnN0IGMgPSBhLkdldEN1cnJlbnRTb2woKTsKICAgIHZhciBlID0gYy5HZXRJbnN0YW5jZXMoKTsKICAgIGlmICgwID09PSBlLmxlbmd0aCkgcmV0dXJuICExOwogICAgZSA9IG5ldyBTZXQoZSk7CiAgICBjb25zdCBnID0gbmV3IFNldDsKICAgIGZvciAobGV0IG0gPSAwLCBuID0gZC5sZW5ndGg7IG0gPCBuOyArK20pIHsKICAgICAgICB2YXIgayA9IGRbbV07CiAgICAgICAgaWYgKDEgPT09IGIpCiAgICAgICAgICAgIGZvciAoY29uc3QgcSBvZiBrLnBhcmVudHMoKSkgcS5CZWxvbmdzVG9PYmplY3RDbGFzcyhhKSAmJiBlLmhhcyhxKSAmJiBnLmFkZChxKTsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgaWYgKDAgPT09IGIpIHsKICAgICAgICAgICAgICAgIGlmIChrID0gay5HZXRQYXJlbnQoKSwgbnVsbCA9PT0gaykgY29udGludWUKICAgICAgICAgICAgfSBlbHNlIGsgPSBrLkdldFRvcFBhcmVudCgpOwogICAgICAgICAgICBrLkJlbG9uZ3NUb09iamVjdENsYXNzKGEpICYmIGUuaGFzKGspICYmIGcuYWRkKGspCiAgICAgICAgfQogICAgfQogICAgaWYgKDAgPT09IGcuc2l6ZSkgcmV0dXJuICExOwogICAgYy5TZXRTZXRQaWNrZWQoZyk7CiAgICBhLkFwcGx5U29sVG9Db250YWluZXIoKTsKICAgIHJldHVybiAhMAp9CgpmdW5jdGlvbiBQaWNrQ2hpbGRyZW4oYSwgYikgewogICAgY29uc3QgZCA9IHRoaXMuR2V0Q3VycmVudFNvbCgpLkdldEluc3RhbmNlcygpOwogICAgaWYgKDAgPT09IGQubGVuZ3RoKSByZXR1cm4gITE7CiAgICBjb25zdCBjID0gYS5HZXRDdXJyZW50U29sKCk7CiAgICB2YXIgZSA9IGMuR2V0SW5zdGFuY2VzKCk7CiAgICBpZiAoYy5Jc1NlbGVjdEFsbCgpKSB7CiAgICAgICAgdmFyIGcgPSBbLi4udGhpcy5fcnVudGltZS5pbnN0YW5jZXNQZW5kaW5nQ3JlYXRlRm9yT2JqZWN0Q2xhc3MoYSldOwogICAgICAgIDAgPCBnLmxlbmd0aCAmJiAoZSA9IGUuY29uY2F0KGcpKQogICAgfQogICAgaWYgKDAgPT09IGUubGVuZ3RoKSByZXR1cm4gITE7CiAgICBlID0gbmV3IFNldChlKTsKICAgIGcgPSBuZXcgU2V0OwogICAgZm9yIChsZXQgayA9IDAsIG0gPSBkLmxlbmd0aDsgayA8IG07ICsraykgewogICAgICAgIGNvbnN0IG4gPSBkW2tdOwogICAgICAgIDIgPT09IGIgJiYgIW4uSGFzQ2hpbGRyZW4oKSAmJiBuLkJlbG9uZ3NUb09iamVjdENsYXNzKGEpICYmIGUuaGFzKG4pICYmIGcuYWRkKG4pOwogICAgICAgIGZvciAoY29uc3QgcSBvZiAwID09PSBiID8gbi5jaGlsZHJlbigpIDogbi5hbGxDaGlsZHJlbigpKSAyID09PSBiICYmIHEuSGFzQ2hpbGRyZW4oKSB8fCBxLkJlbG9uZ3NUb09iamVjdENsYXNzKGEpICYmCiAgICAgICAgICAgIGUuaGFzKHEpICYmIGcuYWRkKHEpCiAgICB9CiAgICBpZiAoMCA9PT0gZy5zaXplKSByZXR1cm4gITE7CiAgICBjLlNldFNldFBpY2tlZChnKTsKICAgIGEuQXBwbHlTb2xUb0NvbnRhaW5lcigpOwogICAgcmV0dXJuICEwCn0KCmZ1bmN0aW9uIFBpY2tOdGhDaGlsZChhLCBiKSB7CiAgICBjb25zdCBkID0gdGhpcy5HZXRDdXJyZW50U29sKCkuR2V0SW5zdGFuY2VzKCk7CiAgICBpZiAoMCA9PT0gZC5sZW5ndGgpIHJldHVybiAhMTsKICAgIGNvbnN0IGMgPSBhLkdldEN1cnJlbnRTb2woKTsKICAgIHZhciBlID0gYy5HZXRJbnN0YW5jZXMoKTsKICAgIGlmIChjLklzU2VsZWN0QWxsKCkpIHsKICAgICAgICB2YXIgZyA9IFsuLi50aGlzLl9ydW50aW1lLmluc3RhbmNlc1BlbmRpbmdDcmVhdGVGb3JPYmplY3RDbGFzcyhhKV07CiAgICAgICAgMCA8IGcubGVuZ3RoICYmIChlID0gZS5jb25jYXQoZykpCiAgICB9CiAgICBpZiAoMCA9PT0gZS5sZW5ndGgpIHJldHVybiAhMTsKICAgIGUgPSBuZXcgU2V0KGUpOwogICAgZyA9IFtdOwogICAgZm9yIChsZXQgayA9IDAsIG0gPSBkLmxlbmd0aDsgayA8IG07ICsraykgewogICAgICAgIGNvbnN0IG4gPSBkW2tdLkdldENoaWxkQXQoYik7CiAgICAgICAgbnVsbCAhPT0gbiAmJiBuLkJlbG9uZ3NUb09iamVjdENsYXNzKGEpICYmIGUuaGFzKG4pICYmIGcucHVzaChuKQogICAgfQogICAgaWYgKDAgPT09IGcubGVuZ3RoKSByZXR1cm4gITE7CiAgICBjLlNldEFycmF5UGlja2VkKGcpOwogICAgYS5BcHBseVNvbFRvQ29udGFpbmVyKCk7CiAgICByZXR1cm4gITAKfQoKZnVuY3Rpb24gQ29tcGFyZUNoaWxkQ291bnQoYSwgYiwgZCkgewogICAgc3dpdGNoIChhKSB7CiAgICAgICAgZGVmYXVsdDogcmV0dXJuIEMzJGpzY29tcCQxMzguY29tcGFyZSh0aGlzLl9pbnN0LkdldENoaWxkQ291bnQoKSwgYiwgZCk7CiAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgcmV0dXJuIEMzJGpzY29tcCQxMzguY29tcGFyZSh0aGlzLl9pbnN0LkdldEFsbENoaWxkQ291bnQoKSwgYiwgZCkKICAgIH0KfQoKZnVuY3Rpb24gQWRkQ2hpbGQoYSwgYiwgZCwgYywgZSwgZywgaywgbSkgewogICAgY29uc3QgbiA9IHRoaXMuX2luc3QsCiAgICAgICAgcSA9IHRoaXMuX3J1bnRpbWUuR2V0Q3VycmVudEFjdGlvbigpLkdldE9iamVjdENsYXNzKCk7CiAgICBmb3IgKGNvbnN0IHUgb2YgYS5hbGxDb3JyZXNwb25kaW5nSW5zdGFuY2VzKG4sIHEpKSB7CiAgICAgICAgaWYgKCF1LkdldFBsdWdpbigpLlN1cHBvcnRzU2NlbmVHcmFwaCgpKSBicmVhazsKICAgICAgICBuLkFkZENoaWxkKHUsIHsKICAgICAgICAgICAgdHJhbnNmb3JtWDogYiwKICAgICAgICAgICAgdHJhbnNmb3JtWTogZCwKICAgICAgICAgICAgdHJhbnNmb3JtV2lkdGg6IGMsCiAgICAgICAgICAgIHRyYW5zZm9ybUhlaWdodDogZSwKICAgICAgICAgICAgdHJhbnNmb3JtQW5nbGU6IGcsCiAgICAgICAgICAgIHRyYW5zZm9ybVpFbGV2YXRpb246IGssCiAgICAgICAgICAgIGRlc3Ryb3lXaXRoUGFyZW50OiBtCiAgICAgICAgfSkKICAgIH0KfQoKZnVuY3Rpb24gUmVtb3ZlQ2hpbGQoYSkgewogICAgY29uc3QgYiA9IHRoaXMuX2luc3QsCiAgICAgICAgZCA9IHRoaXMuX3J1bnRpbWUuR2V0Q3VycmVudEFjdGlvbigpLkdldE9iamVjdENsYXNzKCk7CiAgICBmb3IgKGNvbnN0IGMgb2YgYS5hbGxDb3JyZXNwb25kaW5nSW5zdGFuY2VzKGIsIGQpKSBiLlJlbW92ZUNoaWxkKGMpCn0KCmZ1bmN0aW9uIFJlbW92ZUZyb21QYXJlbnQoKSB7CiAgICB0aGlzLl9pbnN0Lkhhc1BhcmVudCgpICYmIHRoaXMuX2luc3QuR2V0UGFyZW50KCkuUmVtb3ZlQ2hpbGQodGhpcy5faW5zdCkKfQoKZnVuY3Rpb24gQ2hpbGRDb3VudCgpIHsKICAgIHJldHVybiB0aGlzLl9pbnN0LkdldENoaWxkQ291bnQoKQp9CgpmdW5jdGlvbiBBbGxDaGlsZENvdW50KCkgewogICAgcmV0dXJuIHRoaXMuX2luc3QuR2V0QWxsQ2hpbGRDb3VudCgpCn0KCmZ1bmN0aW9uIFNldE1lc2hTaXplKGEsIGIpIHsKICAgIGEgPSBNYXRoLmZsb29yKGEpOwogICAgYiA9IE1hdGguZmxvb3IoYik7CiAgICBjb25zdCBkID0gdGhpcy5HZXRXb3JsZEluZm8oKTsKICAgIDIgPiBhIHx8IDIgPiBiIHx8ICFpc0Zpbml0ZShhKSB8fCAhaXNGaW5pdGUoYikgPyAoZC5SZWxlYXNlTWVzaCgpLCBkLlNldEJib3hDaGFuZ2VkKCkpIDogZC5DcmVhdGVNZXNoKGEsIGIpCn0KCmZ1bmN0aW9uIFNldE1lc2hQb2ludChhLCBiLCBkLCBjLCBlLCBnLCBrLCBtKSB7CiAgICBjb25zdCBuID0gdGhpcy5HZXRXb3JsZEluZm8oKTsKICAgIG4uU2V0TWVzaFBvaW50KGEsIGIsIHsKICAgICAgICBtb2RlOiAwID09PSBkID8gImFic29sdXRlIiA6ICJyZWxhdGl2ZSIsCiAgICAgICAgeDogYywKICAgICAgICB5OiBlLAogICAgICAgIHpFbGV2YXRpb246IGcsCiAgICAgICAgdTogaywKICAgICAgICB2OiBtCiAgICB9KSAmJiBuLlNldEJib3hDaGFuZ2VkKCkKfQoKZnVuY3Rpb24gTWVzaENvbHVtbnMoKSB7CiAgICBjb25zdCBhID0gdGhpcy5HZXRXb3JsZEluZm8oKTsKICAgIHJldHVybiBhLkhhc01lc2goKSA/IGEuR2V0U291cmNlTWVzaCgpLkdldEhTaXplKCkgOiAwCn0KCmZ1bmN0aW9uIE1lc2hSb3dzKCkgewogICAgY29uc3QgYSA9IHRoaXMuR2V0V29ybGRJbmZvKCk7CiAgICByZXR1cm4gYS5IYXNNZXNoKCkgPyBhLkdldFNvdXJjZU1lc2goKS5HZXRWU2l6ZSgpIDogMAp9CgpmdW5jdGlvbiBTZXRFbGVtZW50VmlzaWJsZShhKSB7CiAgICBjb25zdCBiID0gdGhpcy5HZXRXb3JsZEluZm8oKTsKICAgIGEgPSAyID09PSBhID8gIWIuSXNWaXNpYmxlKCkgOiAwICE9PSBhOwogICAgYi5Jc1Zpc2libGUoKSAhPT0gYSAmJiBiLlNldFZpc2libGUoYSkKfQoKZnVuY3Rpb24gU2V0RWxlbWVudENTU1N0eWxlKGEsIGIpIHsKICAgIHRoaXMuU2V0RWxlbWVudENTU1N0eWxlKGEsIGIpCn0KCmZ1bmN0aW9uIFNldEVsZW1lbnRBdHRyaWJ1dGUoYSwgYikgewogICAgdGhpcy5TZXRFbGVtZW50QXR0cmlidXRlKGEsICIiICsgYikKfQoKZnVuY3Rpb24gUmVtb3ZlRWxlbWVudEF0dHJpYnV0ZShhKSB7CiAgICB0aGlzLlJlbW92ZUVsZW1lbnRBdHRyaWJ1dGUoYSkKfQoKZnVuY3Rpb24gU2V0RWxlbWVudEZvY3VzKCkgewogICAgdGhpcy5Gb2N1c0VsZW1lbnQoKQp9CgpmdW5jdGlvbiBTZXRFbGVtZW50Qmx1cigpIHsKICAgIHRoaXMuQmx1ckVsZW1lbnQoKQp9CgpmdW5jdGlvbiBJc0VsZW1lbnRGb2N1c2VkKCkgewogICAgcmV0dXJuIHRoaXMuSXNFbGVtZW50Rm9jdXNlZCgpCn0KCmZ1bmN0aW9uIFNldEVsZW1lbnRFbmFibGVkKGEpIHsKICAgIHRoaXMuX1NldEVuYWJsZWQoMCAhPT0gYSkKfQoKZnVuY3Rpb24gSXNFbGVtZW50RW5hYmxlZCgpIHsKICAgIHJldHVybiB0aGlzLl9Jc0VuYWJsZWQoKQp9CgpmdW5jdGlvbiBDb21wYXJlSW5zdGFuY2VWYXIoYSwgYiwgZCkgewogICAgcmV0dXJuIEMzJGpzY29tcCQxMzguY29tcGFyZSh0aGlzLkdldEluc3RhbmNlKCkuR2V0SW5zdGFuY2VWYXJpYWJsZVZhbHVlKGEpLCBiLCBkKQp9CgpmdW5jdGlvbiBJc0Jvb2xJbnN0YW5jZVZhclNldChhKSB7CiAgICByZXR1cm4gISF0aGlzLkdldEluc3RhbmNlKCkuR2V0SW5zdGFuY2VWYXJpYWJsZVZhbHVlKGEpCn0KCmZ1bmN0aW9uIFRlbXBsYXRlTmFtZSgpIHsKICAgIGNvbnN0IGEgPSB0aGlzLl9ydW50aW1lLkdldFRlbXBsYXRlTWFuYWdlcigpOwogICAgcmV0dXJuIGEgPyBhLkdldEluc3RhbmNlVGVtcGxhdGVOYW1lKHRoaXMuR2V0SW5zdGFuY2UoKSkgOiAiIgp9CgpmdW5jdGlvbiBQaWNrSW5zdFZhckhpTG93KGEsIGIpIHsKICAgIGNvbnN0IGQgPSB0aGlzLkdldEN1cnJlbnRTb2woKSwKICAgICAgICBjID0gZC5HZXRJbnN0YW5jZXMoKTsKICAgIGlmICghYy5sZW5ndGgpIHJldHVybiAhMTsKICAgIGxldCBlID0gY1swXSwKICAgICAgICBnID0gZSwKICAgICAgICBrID0gZS5HZXRJbnN0YW5jZVZhcmlhYmxlVmFsdWUoYik7CiAgICBmb3IgKGxldCBtID0gMSwgbiA9IGMubGVuZ3RoOyBtIDwgbjsgKyttKSB7CiAgICAgICAgZSA9IGNbbV07CiAgICAgICAgY29uc3QgcSA9IGUuR2V0SW5zdGFuY2VWYXJpYWJsZVZhbHVlKGIpOwogICAgICAgIGlmICgwID09PSBhICYmIHEgPCBrIHx8IDEgPT09IGEgJiYgcSA+IGspIGsgPSBxLCBnID0gZQogICAgfQogICAgZC5QaWNrT25lKGcpOwogICAgcmV0dXJuICEwCn0KCmZ1bmN0aW9uIFBpY2tCeVVJRChhKSB7CiAgICByZXR1cm4gdGhpcy5fcnVudGltZS5HZXRDdXJyZW50Q29uZGl0aW9uKCkuSXNJbnZlcnRlZCgpID8gUGlja0J5VUlEX0ludmVydGVkKHRoaXMsIGEpIDogUGlja0J5VUlEX05vcm1hbCh0aGlzLCBhKQp9CgpmdW5jdGlvbiBQaWNrQnlVSURfTm9ybWFsKGEsIGIpIHsKICAgIGIgPSBhLkdldFJ1bnRpbWUoKS5HZXRJbnN0YW5jZUJ5VUlEKGIpOwogICAgaWYgKCFiKSByZXR1cm4gITE7CiAgICBjb25zdCBkID0gYS5HZXRDdXJyZW50U29sKCk7CiAgICBpZiAoIWQuSXNTZWxlY3RBbGwoKSAmJiAhZC5fR2V0T3duSW5zdGFuY2VzKCkuaW5jbHVkZXMoYikpIHJldHVybiAhMTsKICAgIGlmIChhLklzRmFtaWx5KCkpIHsKICAgICAgICBpZiAoYi5HZXRPYmplY3RDbGFzcygpLkJlbG9uZ3NUb0ZhbWlseShhKSkgcmV0dXJuIGQuUGlja09uZShiKSwgYS5BcHBseVNvbFRvQ29udGFpbmVyKCksICEwCiAgICB9IGVsc2UgaWYgKGIuR2V0T2JqZWN0Q2xhc3MoKSA9PT0gYSkgcmV0dXJuIGQuUGlja09uZShiKSwgYS5BcHBseVNvbFRvQ29udGFpbmVyKCksICEwOwogICAgcmV0dXJuICExCn0KCmZ1bmN0aW9uIFBpY2tCeVVJRF9JbnZlcnRlZChhLCBiKSB7CiAgICBjb25zdCBkID0gYS5HZXRDdXJyZW50U29sKCk7CiAgICBpZiAoZC5Jc1NlbGVjdEFsbCgpKSB7CiAgICAgICAgZC5fU2V0U2VsZWN0QWxsKCExKTsKICAgICAgICBkLkNsZWFyQXJyYXlzKCk7CiAgICAgICAgdmFyIGMgPSBhLkdldEluc3RhbmNlcygpOwogICAgICAgIGZvciAobGV0IGcgPSAwLCBrID0gYy5sZW5ndGg7IGcgPCBrOyArK2cpIHsKICAgICAgICAgICAgdmFyIGUgPSBjW2ddOwogICAgICAgICAgICBlLkdldFVJRCgpID09PSBiID8gZC5fUHVzaEVsc2VJbnN0YW5jZShlKSA6IGQuX1B1c2hJbnN0YW5jZShlKQogICAgICAgIH0KICAgICAgICBhLkFwcGx5U29sVG9Db250YWluZXIoKTsKICAgICAgICByZXR1cm4gISFkLl9HZXRPd25JbnN0YW5jZXMoKS5sZW5ndGgKICAgIH0KICAgIGMgPSBkLl9HZXRPd25JbnN0YW5jZXMoKTsKICAgIGUgPSAwOwogICAgZm9yIChsZXQgZyA9IDAsIGsgPSBjLmxlbmd0aDsgZyA8IGs7ICsrZykgewogICAgICAgIGNvbnN0IG0gPSBjW2ddOwogICAgICAgIGNbZV0gPSBtOwogICAgICAgIG0uR2V0VUlEKCkgPT09IGIgPyBkLl9QdXNoRWxzZUluc3RhbmNlKG0pIDogKytlCiAgICB9CiAgICBDMyRqc2NvbXAkMTM4LnRydW5jYXRlQXJyYXkoYywgZSk7CiAgICBhLkFwcGx5U29sVG9Db250YWluZXIoKTsKICAgIHJldHVybiAhIWMubGVuZ3RoCn0KCmZ1bmN0aW9uIERlc3Ryb3koKSB7CiAgICB0aGlzLl9ydW50aW1lLkRlc3Ryb3lJbnN0YW5jZSh0aGlzLl9pbnN0KQp9CgpmdW5jdGlvbiBPbkNyZWF0ZWQoKSB7CiAgICByZXR1cm4gITAKfQoKZnVuY3Rpb24gT25EZXN0cm95ZWQoKSB7CiAgICByZXR1cm4gITAKfQoKZnVuY3Rpb24gU2V0SW5zdGFuY2VWYXIoYSwgYikgewogICAgdGhpcy5HZXRJbnN0YW5jZSgpLlNldEluc3RhbmNlVmFyaWFibGVWYWx1ZShhLCBiKQp9CgpmdW5jdGlvbiBBZGRJbnN0YW5jZVZhcihhLCBiKSB7CiAgICBjb25zdCBkID0gdGhpcy5HZXRJbnN0YW5jZSgpLAogICAgICAgIGMgPSBkLkdldEluc3RhbmNlVmFyaWFibGVWYWx1ZShhKTsKICAgICJudW1iZXIiID09PSB0eXBlb2YgYyAmJiAibnVtYmVyIiAhPT0gdHlwZW9mIGIgPyBiID0gcGFyc2VGbG9hdChiKSA6ICJzdHJpbmciID09PSB0eXBlb2YgYyAmJiAic3RyaW5nIiAhPT0gdHlwZW9mIGIgJiYgKGIgPSBiLnRvU3RyaW5nKCkpOwogICAgZC5TZXRJbnN0YW5jZVZhcmlhYmxlVmFsdWUoYSwgYyArIGIpCn0KCmZ1bmN0aW9uIFN1Ykluc3RhbmNlVmFyKGEsIGIpIHsKICAgIGNvbnN0IGQgPSB0aGlzLkdldEluc3RhbmNlKCksCiAgICAgICAgYyA9IGQuR2V0SW5zdGFuY2VWYXJpYWJsZVZhbHVlKGEpOwogICAgIm51bWJlciIgPT09IHR5cGVvZiBjICYmICgibnVtYmVyIiAhPT0gdHlwZW9mIGIgJiYgKGIgPSBwYXJzZUZsb2F0KGIpKSwgZC5TZXRJbnN0YW5jZVZhcmlhYmxlVmFsdWUoYSwgYyAtIGIpKQp9CgpmdW5jdGlvbiBTZXRCb29sSW5zdGFuY2VWYXIoYSwgYikgewogICAgdGhpcy5HZXRJbnN0YW5jZSgpLlNldEluc3RhbmNlVmFyaWFibGVWYWx1ZShhLCBiID8gMSA6IDApCn0KCmZ1bmN0aW9uIFRvZ2dsZUJvb2xJbnN0YW5jZVZhcihhKSB7CiAgICBjb25zdCBiID0gdGhpcy5HZXRJbnN0YW5jZSgpOwogICAgYi5TZXRJbnN0YW5jZVZhcmlhYmxlVmFsdWUoYSwgMCA9PT0gYi5HZXRJbnN0YW5jZVZhcmlhYmxlVmFsdWUoYSkgPyAxIDogMCkKfQoKZnVuY3Rpb24gTG9hZEZyb21Kc29uU3RyaW5nKGEpIHsKICAgIHRyeSB7CiAgICAgICAgdmFyIGIgPSBKU09OLnBhcnNlKGEpCiAgICB9IGNhdGNoIChkKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiRmFpbGVkIHRvIGxvYWQgZnJvbSBKU09OIHN0cmluZzogIiwgZCk7CiAgICAgICAgcmV0dXJuCiAgICB9CiAgICBhID0gdGhpcy5HZXRJbnN0YW5jZSgpOwogICAgYS5fT25CZWZvcmVMb2FkKCJzdGF0ZSIpOwogICAgYS5Mb2FkRnJvbUpzb24oYiwgInN0YXRlIik7CiAgICBiID0gQzMkanNjb21wJDEzOC5OZXcoQzMkanNjb21wJDEzOC5FdmVudCwgImFmdGVybG9hZGluc3RhbmNlIik7CiAgICBiLmluc3RhbmNlID0gYTsKICAgIHRoaXMuX3J1bnRpbWUuRGlzcGF0Y2hlcigpLmRpc3BhdGNoRXZlbnQoYikKfQoKZnVuY3Rpb24gQXNKU09OKCkgewogICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHRoaXMuR2V0SW5zdGFuY2UoKS5TYXZlVG9Kc29uKCJzdGF0ZSIpKQp9CgpmdW5jdGlvbiBPYmplY3RUeXBlTmFtZSgpIHsKICAgIHJldHVybiB0aGlzLkdldEluc3RhbmNlKCkuR2V0T2JqZWN0Q2xhc3MoKS5HZXROYW1lKCkKfQoKZnVuY3Rpb24gQ291bnQoKSB7CiAgICBjb25zdCBhID0gdGhpcy5fcnVudGltZS5HZXRDdXJyZW50RXZlbnRTdGFja0ZyYW1lKCkuR2V0RXhwcmVzc2lvbk9iamVjdENsYXNzKCk7CiAgICBsZXQgYiA9IGEuR2V0SW5zdGFuY2VDb3VudCgpOwogICAgZm9yIChjb25zdCBkIG9mIHRoaXMuX3J1bnRpbWUuaW5zdGFuY2VzUGVuZGluZ0NyZWF0ZUZvck9iamVjdENsYXNzKGEpKSArK2I7CiAgICByZXR1cm4gYgp9CgpmdW5jdGlvbiBQaWNrZWRDb3VudCgpIHsKICAgIHJldHVybiB0aGlzLl9ydW50aW1lLkdldEN1cnJlbnRFdmVudFN0YWNrRnJhbWUoKS5HZXRFeHByZXNzaW9uT2JqZWN0Q2xhc3MoKS5HZXRDdXJyZW50U29sKCkuR2V0SW5zdGFuY2VzKCkubGVuZ3RoCn0KCmZ1bmN0aW9uIEdldElJRCgpIHsKICAgIHJldHVybiB0aGlzLl9pbnN0LkdldElJRCgpCn0KCmZ1bmN0aW9uIEdldFVJRCgpIHsKICAgIHJldHVybiB0aGlzLl9pbnN0LkdldFVJRCgpCn0KQzMkanNjb21wJDEzOC5BZGRDb21tb25BQ0VzID0gZnVuY3Rpb24oYSwgYikgewogICAgY29uc3QgZCA9IGFbMV0sCiAgICAgICAgYyA9IGFbNF0sCiAgICAgICAgZSA9IGFbNV0sCiAgICAgICAgZyA9IGFbNl0sCiAgICAgICAgayA9IGFbN10sCiAgICAgICAgbSA9IGFbOF0sCiAgICAgICAgbiA9IGFbMTBdLAogICAgICAgIHEgPSBhWzExXSwKICAgICAgICB1ID0gYVsxMl0sCiAgICAgICAgdyA9IGFbMTNdLAogICAgICAgIHogPSBhWzE0XSwKICAgICAgICBDID0gYVsxNV0sCiAgICAgICAgRCA9IGFbMTZdLAogICAgICAgIEYgPSBiLkNuZHMsCiAgICAgICAgRSA9IGIuQWN0cywKICAgICAgICBKID0gYi5FeHBzOwogICAgYVszXSAmJiAoRi5Db21wYXJlWCA9IENvbXBhcmVYLCBGLkNvbXBhcmVZID0gQ29tcGFyZVksIEYuSXNPblNjcmVlbiA9IElzT25TY3JlZW4sIEYuSXNPdXRzaWRlTGF5b3V0ID0gSXNPdXRzaWRlTGF5b3V0LCBGLlBpY2tEaXN0YW5jZSA9IFBpY2tEaXN0YW5jZSwgRS5TZXRYID0gU2V0WCwgRS5TZXRZID0gU2V0WSwgRS5TZXRQb3MgPSBTZXRQb3MsIEUuU2V0UG9zVG9PYmplY3QgPSBTZXRQb3NUb09iamVjdCwgRS5Nb3ZlRm9yd2FyZCA9IE1vdmVGb3J3YXJkLCBFLk1vdmVBdEFuZ2xlID0gTW92ZUF0QW5nbGUsIEouWCA9IEdldFgsIEouWSA9IEdldFksIEouZHQgPSBHZXREdCk7CiAgICBjICYmIChGLkNvbXBhcmVXaWR0aCA9IENvbXBhcmVXaWR0aCwgRi5Db21wYXJlSGVpZ2h0ID0KICAgICAgICBDb21wYXJlSGVpZ2h0LCBFLlNldFdpZHRoID0gU2V0V2lkdGgsIEUuU2V0SGVpZ2h0ID0gU2V0SGVpZ2h0LCBFLlNldFNpemUgPSBTZXRTaXplLCBKLldpZHRoID0gR2V0V2lkdGgsIEouSGVpZ2h0ID0gR2V0SGVpZ2h0LCBKLkJCb3hMZWZ0ID0gR2V0QmJveExlZnQsIEouQkJveFRvcCA9IEdldEJib3hUb3AsIEouQkJveFJpZ2h0ID0gR2V0QmJveFJpZ2h0LCBKLkJCb3hCb3R0b20gPSBHZXRCYm94Qm90dG9tKTsKICAgIGUgJiYgKEYuQW5nbGVXaXRoaW4gPSBJc0FuZ2xlV2l0aGluLCBGLklzQ2xvY2t3aXNlRnJvbSA9IElzQW5nbGVDbG9ja3dpc2VGcm9tLCBGLklzQmV0d2VlbkFuZ2xlcyA9IElzQmV0d2VlbkFuZ2xlcywgRS5TZXRBbmdsZSA9IFNldEFuZ2xlLCBFLlJvdGF0ZUNsb2Nrd2lzZSA9IFJvdGF0ZUNsb2Nrd2lzZSwgRS5Sb3RhdGVDb3VudGVyY2xvY2t3aXNlID0gUm90YXRlQ291bnRlcmNsb2Nrd2lzZSwgRS5Sb3RhdGVUb3dhcmRBbmdsZSA9IFJvdGF0ZVRvd2FyZEFuZ2xlLCBFLlJvdGF0ZVRvd2FyZFBvc2l0aW9uID0gUm90YXRlVG93YXJkUG9zaXRpb24sIEUuU2V0VG93YXJkUG9zaXRpb24gPQogICAgICAgIFNldFRvd2FyZFBvc2l0aW9uLCBKLkFuZ2xlID0gR2V0QW5nbGUpOwogICAgZyAmJiAoRi5Jc1Zpc2libGUgPSBJc1Zpc2libGUsIEYuQ29tcGFyZU9wYWNpdHkgPSBDb21wYXJlT3BhY2l0eSwgRS5TZXRWaXNpYmxlID0gU2V0VmlzaWJsZSwgRS5TZXRPcGFjaXR5ID0gU2V0T3BhY2l0eSwgRS5TZXREZWZhdWx0Q29sb3IgPSBTZXREZWZhdWx0Q29sb3IsIEouT3BhY2l0eSA9IEdldE9wYWNpdHksIEouQ29sb3JWYWx1ZSA9IEdldENvbG9yKTsKICAgIGsgJiYgKEYuSXNPbkxheWVyID0gSXNPbkxheWVyLCBGLlBpY2tUb3BCb3R0b20gPSBQaWNrVG9wQm90dG9tLCBGLkNvbXBhcmVaRWxldmF0aW9uID0gQ29tcGFyZVpFbGV2YXRpb24sIEUuTW92ZVRvVG9wID0gTW92ZVRvVG9wLCBFLk1vdmVUb0JvdHRvbSA9IE1vdmVUb0JvdHRvbSwgRS5Nb3ZlVG9MYXllciA9IE1vdmVUb0xheWVyLCBFLlpNb3ZlVG9PYmplY3QgPSBaTW92ZVRvT2JqZWN0LCBFLlNldFpFbGV2YXRpb24gPSBTZXRaRWxldmF0aW9uLCBKLkxheWVyTnVtYmVyID0gTGF5ZXJOdW1iZXIsIEouTGF5ZXJOYW1lID0gTGF5ZXJOYW1lLCBKLlpJbmRleCA9CiAgICAgICAgWkluZGV4LCBKLlpFbGV2YXRpb24gPSBaRWxldmF0aW9uLCBKLlRvdGFsWkVsZXZhdGlvbiA9IFRvdGFsWkVsZXZhdGlvbik7CiAgICBtICYmIChGLklzRWZmZWN0RW5hYmxlZCA9IElzRWZmZWN0RW5hYmxlZCwgRS5TZXRFZmZlY3RFbmFibGVkID0gU2V0RWZmZWN0RW5hYmxlZCwgRS5TZXRFZmZlY3RQYXJhbSA9IFNldEVmZmVjdFBhcmFtKTsKICAgIHcgJiYgKEYuSGFzUGFyZW50ID0gSGFzUGFyZW50LCBGLkhhc0NoaWxkcmVuID0gSGFzQ2hpbGRyZW4sIEYuUGlja1BhcmVudCA9IFBpY2tQYXJlbnQsIEYuUGlja0NoaWxkcmVuID0gUGlja0NoaWxkcmVuLCBGLlBpY2tOdGhDaGlsZCA9IFBpY2tOdGhDaGlsZCwgRi5Db21wYXJlQ2hpbGRDb3VudCA9IENvbXBhcmVDaGlsZENvdW50LCBFLkFkZENoaWxkID0gQWRkQ2hpbGQsIEUuUmVtb3ZlQ2hpbGQgPSBSZW1vdmVDaGlsZCwgRS5SZW1vdmVGcm9tUGFyZW50ID0gUmVtb3ZlRnJvbVBhcmVudCwgSi5DaGlsZENvdW50ID0gQ2hpbGRDb3VudCwgSi5BbGxDaGlsZENvdW50ID0gQWxsQ2hpbGRDb3VudCk7CiAgICB6ICYmIChFLlNldE1lc2hTaXplID0gU2V0TWVzaFNpemUsCiAgICAgICAgRS5TZXRNZXNoUG9pbnQgPSBTZXRNZXNoUG9pbnQsIEouTWVzaENvbHVtbnMgPSBNZXNoQ29sdW1ucywgSi5NZXNoUm93cyA9IE1lc2hSb3dzKTsKICAgIG4gJiYgKEYuSXNWaXNpYmxlID0gSXNWaXNpYmxlLCBFLlNldFZpc2libGUgPSBTZXRFbGVtZW50VmlzaWJsZSwgRS5TZXRDU1NTdHlsZSA9IFNldEVsZW1lbnRDU1NTdHlsZSwgRS5TZXRFbGVtQXR0cmlidXRlID0gU2V0RWxlbWVudEF0dHJpYnV0ZSwgRS5SZW1vdmVFbGVtQXR0cmlidXRlID0gUmVtb3ZlRWxlbWVudEF0dHJpYnV0ZSk7CiAgICBxICYmIChGLklzRm9jdXNlZCA9IElzRWxlbWVudEZvY3VzZWQsIEUuU2V0Rm9jdXMgPSBTZXRFbGVtZW50Rm9jdXMsIEUuU2V0Qmx1ciA9IFNldEVsZW1lbnRCbHVyKTsKICAgIHUgJiYgKEYuSXNFbmFibGVkID0gSXNFbGVtZW50RW5hYmxlZCwgRS5TZXRFbmFibGVkID0gU2V0RWxlbWVudEVuYWJsZWQpOwogICAgQyAmJiAoRi5PbkNvbGxpc2lvbiA9IE9uQ29sbGlzaW9uLCBGLklzT3ZlcmxhcHBpbmcgPSBJc092ZXJsYXBwaW5nLCBGLklzT3ZlcmxhcHBpbmdPZmZzZXQgPSBJc092ZXJsYXBwaW5nT2Zmc2V0LAogICAgICAgIGIuRmluaXNoQ29sbGlzaW9uQ29uZGl0aW9uID0gRmluaXNoQ29sbGlzaW9uQ29uZGl0aW9uKTsKICAgIGQgfHwgKEYuQ29tcGFyZUluc3RhbmNlVmFyID0gQ29tcGFyZUluc3RhbmNlVmFyLCBGLklzQm9vbEluc3RhbmNlVmFyU2V0ID0gSXNCb29sSW5zdGFuY2VWYXJTZXQsIEYuUGlja0luc3RWYXJIaUxvdyA9IFBpY2tJbnN0VmFySGlMb3csIEYuUGlja0J5VUlEID0gUGlja0J5VUlELCBFLlNldEluc3RhbmNlVmFyID0gU2V0SW5zdGFuY2VWYXIsIEUuQWRkSW5zdGFuY2VWYXIgPSBBZGRJbnN0YW5jZVZhciwgRS5TdWJJbnN0YW5jZVZhciA9IFN1Ykluc3RhbmNlVmFyLCBFLlNldEJvb2xJbnN0YW5jZVZhciA9IFNldEJvb2xJbnN0YW5jZVZhciwgRS5Ub2dnbGVCb29sSW5zdGFuY2VWYXIgPSBUb2dnbGVCb29sSW5zdGFuY2VWYXIsIEYuT25DcmVhdGVkID0gT25DcmVhdGVkLCBGLk9uRGVzdHJveWVkID0gT25EZXN0cm95ZWQsIEUuRGVzdHJveSA9IERlc3Ryb3ksIEUuTG9hZEZyb21Kc29uU3RyaW5nIHx8IChFLkxvYWRGcm9tSnNvblN0cmluZyA9IExvYWRGcm9tSnNvblN0cmluZyksCiAgICAgICAgSi5Bc0pTT04gfHwgKEouQXNKU09OID0gQXNKU09OKSwgSi5Db3VudCA9IENvdW50LCBKLlBpY2tlZENvdW50ID0gUGlja2VkQ291bnQsIEouSUlEID0gR2V0SUlELCBKLlVJRCA9IEdldFVJRCwgSi5PYmplY3RUeXBlTmFtZSA9IE9iamVjdFR5cGVOYW1lKTsKICAgIEQgJiYgKEouVGVtcGxhdGVOYW1lID0gVGVtcGxhdGVOYW1lKQp9OwoidXNlIHN0cmljdCI7CmNvbnN0IEMzJGpzY29tcCQxMzkgPSBzZWxmLkMzOwpDMyRqc2NvbXAkMTM5LlNjaGVkdWxlZFdhaXQgPSBjbGFzcyBleHRlbmRzIEMzJGpzY29tcCQxMzkuRGVmZW5kZWRCYXNlIHsKICAgIGNvbnN0cnVjdG9yKGEpIHsKICAgICAgICBzdXBlcigpOwogICAgICAgIHRoaXMuX2V2ZW50U2hlZXRNYW5hZ2VyID0gYTsKICAgICAgICB0aGlzLl90eXBlID0gIiI7CiAgICAgICAgdGhpcy5fdGltZSA9IC0xOwogICAgICAgIHRoaXMuX3NpZ25hbFRhZyA9ICIiOwogICAgICAgIHRoaXMuX2lzU2lnbmFsbGVkID0gITE7CiAgICAgICAgdGhpcy5fZXZlbnQgPSBudWxsOwogICAgICAgIHRoaXMuX2FjdEluZGV4ID0gMDsKICAgICAgICB0aGlzLl9zb2xNb2RpZmllcnMgPSBbXTsKICAgICAgICB0aGlzLl9zb2xzID0gbmV3IE1hcDsKICAgICAgICB0aGlzLl9jYWxsaW5nRnVuY3Rpb25CbG9jayA9IG51bGw7CiAgICAgICAgdGhpcy5fYXN5bmNJZCA9IC0xOwogICAgICAgIHRoaXMuX2Z1bmN0aW9uSW5uZXJMb2NhbFZhcnMgPSB0aGlzLl9mdW5jdGlvblBhcmFtZXRlcnMgPSBudWxsOwogICAgICAgIHRoaXMuX3Nob3VsZFJlbGVhc2UgPSAhMQogICAgfQogICAgUmVsZWFzZSgpIHsKICAgICAgICB0aGlzLl90eXBlID0gIiI7CiAgICAgICAgdGhpcy5fdGltZSA9IC0xOwogICAgICAgIHRoaXMuX3NpZ25hbFRhZyA9ICIiOwogICAgICAgIHRoaXMuX2Z1bmN0aW9uSW5uZXJMb2NhbFZhcnMgPSB0aGlzLl9mdW5jdGlvblBhcmFtZXRlcnMgPQogICAgICAgICAgICB0aGlzLl9jYWxsaW5nRnVuY3Rpb25CbG9jayA9IHRoaXMuX2V2ZW50ID0gbnVsbDsKICAgICAgICB0aGlzLl9hc3luY0lkID0gLTE7CiAgICAgICAgQzMkanNjb21wJDEzOS5jbGVhckFycmF5KHRoaXMuX3NvbE1vZGlmaWVycyk7CiAgICAgICAgZm9yIChjb25zdCBhIG9mIHRoaXMuX3NvbHMudmFsdWVzKCkpIGEuUmVsZWFzZSgpOwogICAgICAgIHRoaXMuX3NvbHMuY2xlYXIoKQogICAgfQogICAgX0luaXQoKSB7CiAgICAgICAgdmFyIGEgPSB0aGlzLl9ldmVudFNoZWV0TWFuYWdlciwKICAgICAgICAgICAgYiA9IGEuR2V0UnVudGltZSgpLkdldEFsbE9iamVjdENsYXNzZXMoKTsKICAgICAgICBjb25zdCBkID0gYS5HZXRDdXJyZW50RXZlbnRTdGFja0ZyYW1lKCk7CiAgICAgICAgdGhpcy5fZXZlbnQgPSBkLkdldEN1cnJlbnRFdmVudCgpOwogICAgICAgIHRoaXMuX2FjdEluZGV4ID0gZC5HZXRBY3Rpb25JbmRleCgpICsgMTsKICAgICAgICBpZiAoYSA9IGEuRmluZEZpcnN0RnVuY3Rpb25CbG9ja1BhcmVudCh0aGlzLl9ldmVudCkpIHRoaXMuX2NhbGxpbmdGdW5jdGlvbkJsb2NrID0gYSwgdGhpcy5fZnVuY3Rpb25QYXJhbWV0ZXJzID0gYS5DYXB0dXJlRnVuY3Rpb25QYXJhbWV0ZXJzKCksIHRoaXMuX2Z1bmN0aW9uSW5uZXJMb2NhbFZhcnMgPQogICAgICAgICAgICBhLl9HZXRBbGxJbm5lckxvY2FsVmFyaWFibGVzKCkubWFwKGMgPT4gYy5HZXRWYWx1ZSgpKSwgYS5Jc0FzeW5jKCkgJiYgKHRoaXMuX2FzeW5jSWQgPSBhLlBhdXNlQ3VycmVudEFzeW5jRnVuY3Rpb24oKSk7CiAgICAgICAgZm9yIChjb25zdCBjIG9mIGIpCiAgICAgICAgICAgIGlmIChiID0gYy5HZXRDdXJyZW50U29sKCksICFiLklzU2VsZWN0QWxsKCkgfHwgdGhpcy5fZXZlbnQuSGFzU29sTW9kaWZpZXIoYykpIHRoaXMuX3NvbE1vZGlmaWVycy5wdXNoKGMpLCB0aGlzLl9zb2xzLnNldChjLCBDMyRqc2NvbXAkMTM5Lk5ldyhDMyRqc2NvbXAkMTM5LlNvbFN0YXRlLCBiKSkKICAgIH0KICAgIEluaXRUaW1lcihhKSB7CiAgICAgICAgdGhpcy5fdHlwZSA9ICJ0aW1lciI7CiAgICAgICAgdGhpcy5fSW5pdCgpOwogICAgICAgIHRoaXMuX3RpbWUgPSB0aGlzLl9ldmVudFNoZWV0TWFuYWdlci5HZXRSdW50aW1lKCkuR2V0R2FtZVRpbWUoKSArIGEKICAgIH0KICAgIEluaXRTaWduYWwoYSkgewogICAgICAgIHRoaXMuX3R5cGUgPSAic2lnbmFsIjsKICAgICAgICB0aGlzLl9Jbml0KCk7CiAgICAgICAgdGhpcy5fc2lnbmFsVGFnID0gYS50b0xvd2VyQ2FzZSgpCiAgICB9CiAgICBJbml0UHJvbWlzZShhKSB7CiAgICAgICAgdGhpcy5fdHlwZSA9CiAgICAgICAgICAgICJwcm9taXNlIjsKICAgICAgICB0aGlzLl9Jbml0KCk7CiAgICAgICAgYS50aGVuKCgpID0+IHRoaXMuU2V0U2lnbmFsbGVkKCkpLmNhdGNoKGIgPT4gewogICAgICAgICAgICBjb25zb2xlLndhcm4oIltDMyBydW50aW1lXSBQcm9taXNlIHJlamVjdGVkIGluICdXYWl0IGZvciBwcmV2aW91cyBhY3Rpb25zIHRvIGNvbXBsZXRlJzogIiwgYik7CiAgICAgICAgICAgIHRoaXMuU2V0U2lnbmFsbGVkKCkKICAgICAgICB9KQogICAgfQogICAgSXNUaW1lcigpIHsKICAgICAgICByZXR1cm4gInRpbWVyIiA9PT0gdGhpcy5fdHlwZQogICAgfQogICAgSXNTaWduYWwoKSB7CiAgICAgICAgcmV0dXJuICJzaWduYWwiID09PSB0aGlzLl90eXBlCiAgICB9CiAgICBJc1Byb21pc2UoKSB7CiAgICAgICAgcmV0dXJuICJwcm9taXNlIiA9PT0gdGhpcy5fdHlwZQogICAgfQogICAgR2V0U2lnbmFsVGFnKCkgewogICAgICAgIHJldHVybiB0aGlzLl9zaWduYWxUYWcKICAgIH0KICAgIElzU2lnbmFsbGVkKCkgewogICAgICAgIHJldHVybiB0aGlzLl9pc1NpZ25hbGxlZAogICAgfQogICAgU2V0U2lnbmFsbGVkKCkgewogICAgICAgIHRoaXMuX2lzU2lnbmFsbGVkID0gITAKICAgIH0KICAgIF9TaG91bGRSdW4oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuSXNUaW1lcigpID8gdGhpcy5fdGltZSA8PSB0aGlzLl9ldmVudFNoZWV0TWFuYWdlci5HZXRSdW50aW1lKCkuR2V0R2FtZVRpbWUoKSA6CiAgICAgICAgICAgIHRoaXMuSXNTaWduYWxsZWQoKQogICAgfQogICAgX1Jlc3RvcmVTdGF0ZShhKSB7CiAgICAgICAgYS5fUmVzdG9yZSh0aGlzLl9ldmVudCwgdGhpcy5fYWN0SW5kZXgpOwogICAgICAgIGZvciAoY29uc3QgW2IsIGRdIG9mIHRoaXMuX3NvbHMuZW50cmllcygpKSBhID0gYi5HZXRDdXJyZW50U29sKCksIGQuX1Jlc3RvcmUoYSk7CiAgICAgICAgaWYgKGEgPSB0aGlzLl9jYWxsaW5nRnVuY3Rpb25CbG9jaykgYS5TZXRGdW5jdGlvblBhcmFtZXRlcnModGhpcy5fZnVuY3Rpb25QYXJhbWV0ZXJzKSwgYS5fR2V0QWxsSW5uZXJMb2NhbFZhcmlhYmxlcygpLm1hcCgoYiwgZCkgPT4gYi5TZXRWYWx1ZSh0aGlzLl9mdW5jdGlvbklubmVyTG9jYWxWYXJzW2RdKSksIGEuSXNBc3luYygpICYmIGEuUmVzdW1lQXN5bmNGdW5jdGlvbih0aGlzLl9hc3luY0lkKQogICAgfQogICAgX1J1bihhKSB7CiAgICAgICAgdGhpcy5fUmVzdG9yZVN0YXRlKGEpOwogICAgICAgIHRoaXMuX2V2ZW50Ll9SZXN1bWVBY3Rpb25zQW5kU3ViRXZlbnRzKGEpOwogICAgICAgIHRoaXMuX2NhbGxpbmdGdW5jdGlvbkJsb2NrICYmIHRoaXMuX2NhbGxpbmdGdW5jdGlvbkJsb2NrLklzQXN5bmMoKSAmJgogICAgICAgICAgICB0aGlzLl9jYWxsaW5nRnVuY3Rpb25CbG9jay5NYXliZUZpbmlzaEFzeW5jRnVuY3Rpb25DYWxsKHRoaXMuX2FzeW5jSWQpOwogICAgICAgIHRoaXMuX2V2ZW50U2hlZXRNYW5hZ2VyLkNsZWFyU29sKHRoaXMuX3NvbE1vZGlmaWVycyk7CiAgICAgICAgdGhpcy5fc2hvdWxkUmVsZWFzZSA9ICEwCiAgICB9CiAgICBhc3luYyBfRGVidWdSdW4oYSkgewogICAgICAgIHRoaXMuX1Jlc3RvcmVTdGF0ZShhKTsKICAgICAgICBmb3IgKGNvbnN0IGIgb2YgdGhpcy5fZXZlbnQuX0RlYnVnUmVzdW1lQWN0aW9uc0FuZFN1YkV2ZW50cyhhKSkgYXdhaXQgdGhpcy5fZXZlbnRTaGVldE1hbmFnZXIuR2V0UnVudGltZSgpLkRlYnVnQnJlYWsoYik7CiAgICAgICAgdGhpcy5fY2FsbGluZ0Z1bmN0aW9uQmxvY2sgJiYgdGhpcy5fY2FsbGluZ0Z1bmN0aW9uQmxvY2suSXNBc3luYygpICYmIHRoaXMuX2NhbGxpbmdGdW5jdGlvbkJsb2NrLk1heWJlRmluaXNoQXN5bmNGdW5jdGlvbkNhbGwodGhpcy5fYXN5bmNJZCk7CiAgICAgICAgdGhpcy5fZXZlbnRTaGVldE1hbmFnZXIuQ2xlYXJTb2wodGhpcy5fc29sTW9kaWZpZXJzKTsKICAgICAgICB0aGlzLl9zaG91bGRSZWxlYXNlID0gITAKICAgIH0KICAgIFNob3VsZFJlbGVhc2UoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3Nob3VsZFJlbGVhc2UKICAgIH0KICAgIFJlbW92ZUluc3RhbmNlcyhhKSB7CiAgICAgICAgZm9yIChjb25zdCBiIG9mIHRoaXMuX3NvbHMudmFsdWVzKCkpIGIuUmVtb3ZlSW5zdGFuY2VzKGEpCiAgICB9CiAgICBfU2F2ZVRvSnNvbigpIHsKICAgICAgICBjb25zdCBhID0ge30sCiAgICAgICAgICAgIGIgPSB7CiAgICAgICAgICAgICAgICB0OiB0aGlzLl90aW1lLAogICAgICAgICAgICAgICAgc3Q6IHRoaXMuX3NpZ25hbFRhZywKICAgICAgICAgICAgICAgIHM6IHRoaXMuX2lzU2lnbmFsbGVkLAogICAgICAgICAgICAgICAgZXY6IHRoaXMuX2V2ZW50LkdldFNJRCgpLAogICAgICAgICAgICAgICAgc206IHRoaXMuX3NvbE1vZGlmaWVycy5tYXAoZCA9PiBkLkdldFNJRCgpKSwKICAgICAgICAgICAgICAgIHNvbHM6IGEKICAgICAgICAgICAgfTsKICAgICAgICB0aGlzLl9ldmVudC5fSGFzQWN0aW9uSW5kZXgodGhpcy5fYWN0SW5kZXgpICYmIChiLmFjdCA9IHRoaXMuX2V2ZW50LkdldEFjdGlvbkF0KHRoaXMuX2FjdEluZGV4KS5HZXRTSUQoKSk7CiAgICAgICAgZm9yIChjb25zdCBbZCwgY10gb2YgdGhpcy5fc29scykgYVtkLkdldFNJRCgpLnRvU3RyaW5nKCldID0gYy5fU2F2ZVRvSnNvbigpOwogICAgICAgIHJldHVybiBiCiAgICB9CiAgICBzdGF0aWMgX0NyZWF0ZUZyb21Kc29uKGEsIGIpIHsKICAgICAgICBjb25zdCBkID0gYS5HZXRSdW50aW1lKCk7CiAgICAgICAgdmFyIGMgPSBhLkdldEV2ZW50QmxvY2tCeVNJRChiLmV2KTsKICAgICAgICBpZiAoIWMpIHJldHVybiBudWxsOwogICAgICAgIGxldCBlID0gMDsKICAgICAgICBpZiAoYi5oYXNPd25Qcm9wZXJ0eSgiYWN0IikpIHsKICAgICAgICAgICAgdmFyIGcgPSBhLkdldEFjdGlvbkJ5U0lEKGIuYWN0KTsKICAgICAgICAgICAgaWYgKCFnKSByZXR1cm4gbnVsbDsKICAgICAgICAgICAgZSA9IGcuR2V0SW5kZXgoKQogICAgICAgIH0KICAgICAgICBnID0gQzMkanNjb21wJDEzOS5OZXcoQzMkanNjb21wJDEzOS5TY2hlZHVsZWRXYWl0LCBhKTsKICAgICAgICBnLl90aW1lID0gYi50OwogICAgICAgIGcuX3R5cGUgPSAtMSA9PT0gZy5fdGltZSA/ICJzaWduYWwiIDogInRpbWVyIjsKICAgICAgICBnLl9zaWduYWxUYWcgPSBiLnN0OwogICAgICAgIGcuX2lzU2lnbmFsbGVkID0gYi5zOwogICAgICAgIGcuX2V2ZW50ID0gYzsKICAgICAgICBnLl9hY3RJbmRleCA9IGU7CiAgICAgICAgZm9yICh2YXIgayBvZiBiLnNtKShjID0gZC5HZXRPYmplY3RDbGFzc0J5U0lEKGspKSAmJiBnLl9zb2xNb2RpZmllcnMucHVzaChjKTsKICAgICAgICBmb3IgKGNvbnN0IFttLCBuXSBvZiBPYmplY3QuZW50cmllcyhiLnNvbHMpKQogICAgICAgICAgICBpZiAoYiA9IHBhcnNlSW50KG0sIDEwKSwgYiA9IGQuR2V0T2JqZWN0Q2xhc3NCeVNJRChiKSkgayA9IEMzJGpzY29tcCQxMzkuTmV3KEMzJGpzY29tcCQxMzkuU29sU3RhdGUsCiAgICAgICAgICAgICAgICBudWxsKSwgay5fTG9hZEZyb21Kc29uKGEsIG4pLCBnLl9zb2xzLnNldChiLCBrKTsKICAgICAgICByZXR1cm4gZwogICAgfQp9OwoidXNlIHN0cmljdCI7CmNvbnN0IEMzJGpzY29tcCQxNDAgPSBzZWxmLkMzOwpDMyRqc2NvbXAkMTQwLlNvbFN0YXRlID0gY2xhc3MgZXh0ZW5kcyBDMyRqc2NvbXAkMTQwLkRlZmVuZGVkQmFzZSB7CiAgICBjb25zdHJ1Y3RvcihhKSB7CiAgICAgICAgc3VwZXIoKTsKICAgICAgICB0aGlzLl9vYmplY3RDbGFzcyA9IG51bGw7CiAgICAgICAgdGhpcy5faXNTZWxlY3RBbGwgPSAhMDsKICAgICAgICB0aGlzLl9pbnN0YW5jZXMgPSBbXTsKICAgICAgICBhICYmICh0aGlzLl9vYmplY3RDbGFzcyA9IGEuR2V0T2JqZWN0Q2xhc3MoKSwgdGhpcy5faXNTZWxlY3RBbGwgPSBhLklzU2VsZWN0QWxsKCksIEMzJGpzY29tcCQxNDAuc2hhbGxvd0Fzc2lnbkFycmF5KHRoaXMuX2luc3RhbmNlcywgYS5fR2V0T3duSW5zdGFuY2VzKCkpKQogICAgfQogICAgUmVsZWFzZSgpIHsKICAgICAgICB0aGlzLl9vYmplY3RDbGFzcyA9IG51bGw7CiAgICAgICAgQzMkanNjb21wJDE0MC5jbGVhckFycmF5KHRoaXMuX2luc3RhbmNlcykKICAgIH0KICAgIF9SZXN0b3JlKGEpIHsKICAgICAgICBhLl9TZXRTZWxlY3RBbGwodGhpcy5faXNTZWxlY3RBbGwpOwogICAgICAgIEMzJGpzY29tcCQxNDAuc2hhbGxvd0Fzc2lnbkFycmF5KGEuX0dldE93bkluc3RhbmNlcygpLCB0aGlzLl9pbnN0YW5jZXMpCiAgICB9CiAgICBSZW1vdmVJbnN0YW5jZXMoYSkgewogICAgICAgIEMzJGpzY29tcCQxNDAuYXJyYXlSZW1vdmVBbGxJblNldCh0aGlzLl9pbnN0YW5jZXMsCiAgICAgICAgICAgIGEpCiAgICB9CiAgICBfU2F2ZVRvSnNvbigpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBzYTogdGhpcy5faXNTZWxlY3RBbGwsCiAgICAgICAgICAgIGluc3RzOiB0aGlzLl9pbnN0YW5jZXMubWFwKGEgPT4gYS5HZXRVSUQoKSkKICAgICAgICB9CiAgICB9CiAgICBfTG9hZEZyb21Kc29uKGEsIGIpIHsKICAgICAgICBhID0gYS5HZXRSdW50aW1lKCk7CiAgICAgICAgdGhpcy5faXNTZWxlY3RBbGwgPSAhIWIuc2E7CiAgICAgICAgQzMkanNjb21wJDE0MC5jbGVhckFycmF5KHRoaXMuX2luc3RhbmNlcyk7CiAgICAgICAgZm9yIChjb25zdCBkIG9mIGIuaW5zdHMpKGIgPSBhLkdldEluc3RhbmNlQnlVSUQoZCkpICYmIHRoaXMuX2luc3RhbmNlcy5wdXNoKGIpCiAgICB9Cn07CiJ1c2Ugc3RyaWN0IjsKY29uc3QgQzMkanNjb21wJDE0MSA9IHNlbGYuQzM7CgpmdW5jdGlvbiBHZXROZXh0UGFyYW1NYXAoYSwgYikgewogICAgbGV0IGQgPSBhLmdldChiKTsKICAgIGQgfHwgKGQgPSBuZXcgTWFwLCBhLnNldChiLCBkKSk7CiAgICByZXR1cm4gZAp9CkMzJGpzY29tcCQxNDEuU0RLUGx1Z2luQmFzZSA9IGNsYXNzIGV4dGVuZHMgQzMkanNjb21wJDE0MS5EZWZlbmRlZEJhc2UgewogICAgY29uc3RydWN0b3IoYSkgewogICAgICAgIHN1cGVyKCk7CiAgICAgICAgdGhpcy5fcnVudGltZSA9IGEucnVudGltZTsKICAgICAgICB0aGlzLl9pc1NpbmdsZUdsb2JhbCA9ICEhYS5pc1NpbmdsZUdsb2JhbDsKICAgICAgICB0aGlzLl9pc1dvcmxkVHlwZSA9ICEhYS5pc1dvcmxkOwogICAgICAgIHRoaXMuX2lzUm90YXRhYmxlID0gISFhLmlzUm90YXRhYmxlOwogICAgICAgIHRoaXMuX211c3RQcmVkcmF3ID0gISFhLm11c3RQcmVkcmF3OwogICAgICAgIHRoaXMuX2hhc0VmZmVjdHMgPSAhIWEuaGFzRWZmZWN0czsKICAgICAgICB0aGlzLl9zdXBwb3J0c1NjZW5lR3JhcGggPSAhIWEuc3VwcG9ydHNTY2VuZUdyYXBoOwogICAgICAgIHRoaXMuX3N1cHBvcnRzTWVzaCA9ICEhYS5zdXBwb3J0c01lc2g7CiAgICAgICAgdGhpcy5fc2luZ2xlR2xvYmFsT2JqZWN0Q2xhc3MgPSBudWxsOwogICAgICAgIHRoaXMuX2JvdW5kQUNFTWV0aG9kQ2FjaGUgPSBuZXcgTWFwOwogICAgICAgIHRoaXMuX2JvdW5kQUNFTWV0aG9kQ2FjaGVfMXBhcmFtID0gbmV3IE1hcDsKICAgICAgICB0aGlzLl9ib3VuZEFDRU1ldGhvZENhY2hlXzJwYXJhbXMgPQogICAgICAgICAgICBuZXcgTWFwOwogICAgICAgIHRoaXMuX2JvdW5kQUNFTWV0aG9kQ2FjaGVfM3BhcmFtcyA9IG5ldyBNYXAKICAgIH0KICAgIFJlbGVhc2UoKSB7CiAgICAgICAgdGhpcy5fcnVudGltZSA9IG51bGwKICAgIH0KICAgIEdldFJ1bnRpbWUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUKICAgIH0KICAgIE9uQ3JlYXRlKCkge30KICAgIElzU2luZ2xlR2xvYmFsKCkgewogICAgICAgIHJldHVybiB0aGlzLl9pc1NpbmdsZUdsb2JhbAogICAgfQogICAgSXNXb3JsZFR5cGUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2lzV29ybGRUeXBlCiAgICB9CiAgICBJc1JvdGF0YWJsZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5faXNSb3RhdGFibGUKICAgIH0KICAgIE11c3RQcmVEcmF3KCkgewogICAgICAgIHJldHVybiB0aGlzLl9tdXN0UHJlZHJhdwogICAgfQogICAgSGFzRWZmZWN0cygpIHsKICAgICAgICByZXR1cm4gdGhpcy5faGFzRWZmZWN0cwogICAgfQogICAgU3VwcG9ydHNTY2VuZUdyYXBoKCkgewogICAgICAgIHJldHVybiB0aGlzLl9zdXBwb3J0c1NjZW5lR3JhcGgKICAgIH0KICAgIFN1cHBvcnRzTWVzaCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fc3VwcG9ydHNNZXNoCiAgICB9CiAgICBfR2V0Qm91bmRBQ0VNZXRob2QoYSwgYikgewogICAgICAgIGlmICghYikgdGhyb3cgRXJyb3IoIm1pc3NpbmcgJ3RoaXMnIGJpbmRpbmciKTsKICAgICAgICBsZXQgZCA9IHRoaXMuX2JvdW5kQUNFTWV0aG9kQ2FjaGUuZ2V0KGEpOwogICAgICAgIGlmIChkKSByZXR1cm4gZDsKICAgICAgICBkID0gYS5iaW5kKGIpOwogICAgICAgIHRoaXMuX2JvdW5kQUNFTWV0aG9kQ2FjaGUuc2V0KGEsIGQpOwogICAgICAgIHJldHVybiBkCiAgICB9CiAgICBfR2V0Qm91bmRBQ0VNZXRob2RfMXBhcmFtKGEsIGIsIGQpIHsKICAgICAgICBpZiAoIWIpIHRocm93IEVycm9yKCJtaXNzaW5nICd0aGlzJyBiaW5kaW5nIik7CiAgICAgICAgY29uc3QgYyA9IEdldE5leHRQYXJhbU1hcCh0aGlzLl9ib3VuZEFDRU1ldGhvZENhY2hlXzFwYXJhbSwgYSk7CiAgICAgICAgbGV0IGUgPSBjLmdldChkKTsKICAgICAgICBpZiAoZSkgcmV0dXJuIGU7CiAgICAgICAgZSA9IGEuYmluZChiLCBkKTsKICAgICAgICBjLnNldChkLCBlKTsKICAgICAgICByZXR1cm4gZQogICAgfQogICAgX0dldEJvdW5kQUNFTWV0aG9kXzJwYXJhbXMoYSwgYiwgZCwgYykgewogICAgICAgIGlmICghYikgdGhyb3cgRXJyb3IoIm1pc3NpbmcgJ3RoaXMnIGJpbmRpbmciKTsKICAgICAgICB2YXIgZSA9IEdldE5leHRQYXJhbU1hcCh0aGlzLl9ib3VuZEFDRU1ldGhvZENhY2hlXzJwYXJhbXMsIGEpOwogICAgICAgIGUgPSBHZXROZXh0UGFyYW1NYXAoZSwgZCk7CiAgICAgICAgbGV0IGcgPSBlLmdldChjKTsKICAgICAgICBpZiAoZykgcmV0dXJuIGc7CiAgICAgICAgZyA9IGEuYmluZChiLCBkLCBjKTsKICAgICAgICBlLnNldChjLCBnKTsKICAgICAgICByZXR1cm4gZwogICAgfQogICAgX0dldEJvdW5kQUNFTWV0aG9kXzNwYXJhbXMoYSwKICAgICAgICBiLCBkLCBjLCBlKSB7CiAgICAgICAgaWYgKCFiKSB0aHJvdyBFcnJvcigibWlzc2luZyAndGhpcycgYmluZGluZyIpOwogICAgICAgIHZhciBnID0gR2V0TmV4dFBhcmFtTWFwKHRoaXMuX2JvdW5kQUNFTWV0aG9kQ2FjaGVfM3BhcmFtcywgYSk7CiAgICAgICAgZyA9IEdldE5leHRQYXJhbU1hcChnLCBkKTsKICAgICAgICBnID0gR2V0TmV4dFBhcmFtTWFwKGcsIGMpOwogICAgICAgIGxldCBrID0gZy5nZXQoZSk7CiAgICAgICAgaWYgKGspIHJldHVybiBrOwogICAgICAgIGsgPSBhLmJpbmQoYiwgZCwgYywgZSk7CiAgICAgICAgZy5zZXQoZSwgayk7CiAgICAgICAgcmV0dXJuIGsKICAgIH0KICAgIF9TZXRTaW5nbGVHbG9iYWxPYmplY3RDbGFzcyhhKSB7CiAgICAgICAgaWYgKCF0aGlzLklzU2luZ2xlR2xvYmFsKCkpIHRocm93IEVycm9yKCJtdXN0IGJlIHNpbmdsZS1nbG9iYWwgcGx1Z2luIik7CiAgICAgICAgdGhpcy5fc2luZ2xlR2xvYmFsT2JqZWN0Q2xhc3MgPSBhCiAgICB9CiAgICBHZXRTaW5nbGVHbG9iYWxPYmplY3RDbGFzcygpIHsKICAgICAgICBpZiAoIXRoaXMuSXNTaW5nbGVHbG9iYWwoKSkgdGhyb3cgRXJyb3IoIm11c3QgYmUgc2luZ2xlLWdsb2JhbCBwbHVnaW4iKTsKICAgICAgICByZXR1cm4gdGhpcy5fc2luZ2xlR2xvYmFsT2JqZWN0Q2xhc3MKICAgIH0KICAgIEdldFNpbmdsZUdsb2JhbEluc3RhbmNlKCkgewogICAgICAgIGlmICghdGhpcy5Jc1NpbmdsZUdsb2JhbCgpKSB0aHJvdyBFcnJvcigibXVzdCBiZSBzaW5nbGUtZ2xvYmFsIHBsdWdpbiIpOwogICAgICAgIHJldHVybiB0aGlzLl9zaW5nbGVHbG9iYWxPYmplY3RDbGFzcy5HZXRTaW5nbGVHbG9iYWxJbnN0YW5jZSgpCiAgICB9Cn07CiJ1c2Ugc3RyaWN0IjsKY29uc3QgQzMkanNjb21wJDE0MiA9IHNlbGYuQzM7CkMzJGpzY29tcCQxNDIuU0RLRE9NUGx1Z2luQmFzZSA9IGNsYXNzIGV4dGVuZHMgQzMkanNjb21wJDE0Mi5TREtQbHVnaW5CYXNlIHsKICAgIGNvbnN0cnVjdG9yKGEsIGIpIHsKICAgICAgICBzdXBlcihhKTsKICAgICAgICB0aGlzLl9kb21Db21wb25lbnRJZCA9IGI7CiAgICAgICAgdGhpcy5fbmV4dEVsZW1lbnRJZCA9IDA7CiAgICAgICAgdGhpcy5faW5zdE1hcCA9IG5ldyBNYXA7CiAgICAgICAgdGhpcy5BZGRFbGVtZW50TWVzc2FnZUhhbmRsZXIoImVsZW0tZm9jdXNlZCIsIGQgPT4gZC5fT25FbGVtRm9jdXNlZCgpKTsKICAgICAgICB0aGlzLkFkZEVsZW1lbnRNZXNzYWdlSGFuZGxlcigiZWxlbS1ibHVycmVkIiwgZCA9PiB7CiAgICAgICAgICAgIGQgJiYgZC5fT25FbGVtQmx1cnJlZCgpCiAgICAgICAgfSkKICAgIH0KICAgIFJlbGVhc2UoKSB7CiAgICAgICAgc3VwZXIuUmVsZWFzZSgpCiAgICB9CiAgICBfQWRkRWxlbWVudChhKSB7CiAgICAgICAgY29uc3QgYiA9IHRoaXMuX25leHRFbGVtZW50SWQrKzsKICAgICAgICB0aGlzLl9pbnN0TWFwLnNldChiLCBhKTsKICAgICAgICByZXR1cm4gYgogICAgfQogICAgX1JlbW92ZUVsZW1lbnQoYSkgewogICAgICAgIHRoaXMuX2luc3RNYXAuZGVsZXRlKGEpCiAgICB9CiAgICBBZGRFbGVtZW50TWVzc2FnZUhhbmRsZXIoYSwgYikgewogICAgICAgIHRoaXMuX3J1bnRpbWUuQWRkRE9NQ29tcG9uZW50TWVzc2FnZUhhbmRsZXIodGhpcy5fZG9tQ29tcG9uZW50SWQsCiAgICAgICAgICAgIGEsIGQgPT4gewogICAgICAgICAgICAgICAgY29uc3QgYyA9IHRoaXMuX2luc3RNYXAuZ2V0KGQuZWxlbWVudElkKTsKICAgICAgICAgICAgICAgIGIoYywgZCkKICAgICAgICAgICAgfSkKICAgIH0KfTsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkMTQzID0gc2VsZi5DMzsKQzMkanNjb21wJDE0My5TREtUeXBlQmFzZSA9IGNsYXNzIGV4dGVuZHMgQzMkanNjb21wJDE0My5EZWZlbmRlZEJhc2UgewogICAgY29uc3RydWN0b3IoYSkgewogICAgICAgIHN1cGVyKCk7CiAgICAgICAgdGhpcy5fb2JqZWN0Q2xhc3MgPSBhOwogICAgICAgIHRoaXMuX3J1bnRpbWUgPSBhLkdldFJ1bnRpbWUoKTsKICAgICAgICB0aGlzLl9wbHVnaW4gPSBhLkdldFBsdWdpbigpCiAgICB9CiAgICBSZWxlYXNlKCkgewogICAgICAgIHRoaXMuX3BsdWdpbiA9IHRoaXMuX3J1bnRpbWUgPSB0aGlzLl9vYmplY3RDbGFzcyA9IG51bGwKICAgIH0KICAgIEdldE9iamVjdENsYXNzKCkgewogICAgICAgIHJldHVybiB0aGlzLl9vYmplY3RDbGFzcwogICAgfQogICAgR2V0UnVudGltZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcnVudGltZQogICAgfQogICAgR2V0UGx1Z2luKCkgewogICAgICAgIHJldHVybiB0aGlzLl9wbHVnaW4KICAgIH0KICAgIEdldEltYWdlSW5mbygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fb2JqZWN0Q2xhc3MuR2V0SW1hZ2VJbmZvKCkKICAgIH0KICAgIEZpbmlzaENvbmRpdGlvbihhKSB7fQogICAgQmVmb3JlUnVuQWN0aW9uKGEpIHt9CiAgICBBZnRlclJ1bkFjdGlvbihhKSB7fQogICAgTG9hZFRleHR1cmVzKGEpIHt9CiAgICBSZWxlYXNlVGV4dHVyZXMoKSB7fQogICAgT25EeW5hbWljVGV4dHVyZUxvYWRDb21wbGV0ZSgpIHt9CiAgICBQcmVsb2FkVGV4dHVyZXNXaXRoSW5zdGFuY2VzKGEpIHt9CiAgICBMb2FkVGlsZW1hcERhdGEoKSB7fQogICAgR2V0U2NyaXB0SW50ZXJmYWNlQ2xhc3MoKSB7CiAgICAgICAgcmV0dXJuIG51bGwKICAgIH0KICAgIERpc3BhdGNoU2NyaXB0RXZlbnQoYSwgYiwKICAgICAgICBkKSB7CiAgICAgICAgYSA9IEMzJGpzY29tcCQxNDMuTmV3KEMzJGpzY29tcCQxNDMuRXZlbnQsIGEsIGIpOwogICAgICAgIGEub2JqZWN0Q2xhc3MgPSB0aGlzOwogICAgICAgIGQgJiYgT2JqZWN0LmFzc2lnbihhLCBkKTsKICAgICAgICB0aGlzLkdldE9iamVjdENsYXNzKCkuRGlzcGF0Y2hVc2VyU2NyaXB0RXZlbnQoYSkKICAgIH0KfTsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkMTQ0ID0gc2VsZi5DMzsKQzMkanNjb21wJDE0NC5TREtJbnN0YW5jZUJhc2UgPSBjbGFzcyBleHRlbmRzIEMzJGpzY29tcCQxNDQuRGVmZW5kZWRCYXNlIHsKICAgIGNvbnN0cnVjdG9yKGEsIGIpIHsKICAgICAgICBzdXBlcigpOwogICAgICAgIHRoaXMuX2luc3QgPSBhOwogICAgICAgIHRoaXMuX2RvbUNvbXBvbmVudElkID0gYjsKICAgICAgICB0aGlzLl9ydW50aW1lID0gYS5HZXRSdW50aW1lKCk7CiAgICAgICAgdGhpcy5fb2JqZWN0Q2xhc3MgPSB0aGlzLl9pbnN0LkdldE9iamVjdENsYXNzKCk7CiAgICAgICAgdGhpcy5fc2RrVHlwZSA9IHRoaXMuX29iamVjdENsYXNzLkdldFNka1R5cGUoKTsKICAgICAgICB0aGlzLl90aWNrMkZ1bmMgPSB0aGlzLl90aWNrRnVuYyA9IG51bGw7CiAgICAgICAgdGhpcy5faXNUaWNraW5nMiA9IHRoaXMuX2lzVGlja2luZyA9ICExOwogICAgICAgIHRoaXMuX2Rpc3Bvc2FibGVzID0gbnVsbDsKICAgICAgICB0aGlzLl93YXNSZWxlYXNlZCA9ICExCiAgICB9CiAgICBSZWxlYXNlKCkgewogICAgICAgIHRoaXMuX3dhc1JlbGVhc2VkID0gITA7CiAgICAgICAgdGhpcy5fU3RvcFRpY2tpbmcoKTsKICAgICAgICB0aGlzLl9TdG9wVGlja2luZzIoKTsKICAgICAgICB0aGlzLl90aWNrMkZ1bmMgPSB0aGlzLl90aWNrRnVuYyA9IG51bGw7CiAgICAgICAgdGhpcy5fZGlzcG9zYWJsZXMgJiYgKHRoaXMuX2Rpc3Bvc2FibGVzLlJlbGVhc2UoKSwKICAgICAgICAgICAgdGhpcy5fZGlzcG9zYWJsZXMgPSBudWxsKTsKICAgICAgICB0aGlzLl9zZGtUeXBlID0gdGhpcy5fb2JqZWN0Q2xhc3MgPSB0aGlzLl9ydW50aW1lID0gdGhpcy5faW5zdCA9IG51bGwKICAgIH0KICAgIFdhc1JlbGVhc2VkKCkgewogICAgICAgIHJldHVybiB0aGlzLl93YXNSZWxlYXNlZAogICAgfQogICAgR2V0SW5zdGFuY2UoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2luc3QKICAgIH0KICAgIEdldFJ1bnRpbWUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUKICAgIH0KICAgIEdldE9iamVjdENsYXNzKCkgewogICAgICAgIHJldHVybiB0aGlzLl9vYmplY3RDbGFzcwogICAgfQogICAgR2V0UGx1Z2luKCkgewogICAgICAgIHJldHVybiB0aGlzLl9zZGtUeXBlLkdldFBsdWdpbigpCiAgICB9CiAgICBHZXRTZGtUeXBlKCkgewogICAgICAgIHJldHVybiB0aGlzLl9zZGtUeXBlCiAgICB9CiAgICBHZXRTY3JpcHRJbnRlcmZhY2UoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2luc3QuR2V0SW50ZXJmYWNlQ2xhc3MoKQogICAgfQogICAgVHJpZ2dlcihhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUuVHJpZ2dlcihhLCB0aGlzLl9pbnN0LCBudWxsKQogICAgfQogICAgRGVidWdUcmlnZ2VyKGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcnVudGltZS5EZWJ1Z1RyaWdnZXIoYSwgdGhpcy5faW5zdCwgbnVsbCkKICAgIH0KICAgIFRyaWdnZXJBc3luYyhhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUuVHJpZ2dlckFzeW5jKGEsCiAgICAgICAgICAgIHRoaXMuX2luc3QsIG51bGwpCiAgICB9CiAgICBGYXN0VHJpZ2dlcihhLCBiKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUuRmFzdFRyaWdnZXIoYSwgdGhpcy5faW5zdCwgYikKICAgIH0KICAgIERlYnVnRmFzdFRyaWdnZXIoYSwgYikgewogICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lLkRlYnVnRmFzdFRyaWdnZXIoYSwgdGhpcy5faW5zdCwgYikKICAgIH0KICAgIFNjaGVkdWxlVHJpZ2dlcnMoYSkgewogICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lLlNjaGVkdWxlVHJpZ2dlcnMoYSkKICAgIH0KICAgIEFkZERPTU1lc3NhZ2VIYW5kbGVyKGEsIGIpIHsKICAgICAgICB0aGlzLl9ydW50aW1lLkFkZERPTUNvbXBvbmVudE1lc3NhZ2VIYW5kbGVyKHRoaXMuX2RvbUNvbXBvbmVudElkLCBhLCBiKQogICAgfQogICAgQWRkRE9NTWVzc2FnZUhhbmRsZXJzKGEpIHsKICAgICAgICBmb3IgKGNvbnN0IFtiLCBkXSBvZiBhKSB0aGlzLkFkZERPTU1lc3NhZ2VIYW5kbGVyKGIsIGQpCiAgICB9CiAgICBQb3N0VG9ET00oYSwgYikgewogICAgICAgIHRoaXMuX3J1bnRpbWUuUG9zdENvbXBvbmVudE1lc3NhZ2VUb0RPTSh0aGlzLl9kb21Db21wb25lbnRJZCwgYSwgYikKICAgIH0KICAgIFBvc3RUb0RPTUFzeW5jKGEsIGIpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcnVudGltZS5Qb3N0Q29tcG9uZW50TWVzc2FnZVRvRE9NQXN5bmModGhpcy5fZG9tQ29tcG9uZW50SWQsCiAgICAgICAgICAgIGEsIGIpCiAgICB9CiAgICBfUG9zdFRvRE9NTWF5YmVTeW5jKGEsIGIpIHsKICAgICAgICBpZiAodGhpcy5fcnVudGltZS5Jc0luV29ya2VyKCkpIHRoaXMuUG9zdFRvRE9NKGEsIGIpOwogICAgICAgIGVsc2UgcmV0dXJuIHdpbmRvdy5jM19ydW50aW1lSW50ZXJmYWNlLl9Pbk1lc3NhZ2VGcm9tUnVudGltZSh7CiAgICAgICAgICAgIHR5cGU6ICJldmVudCIsCiAgICAgICAgICAgIGNvbXBvbmVudDogdGhpcy5fZG9tQ29tcG9uZW50SWQsCiAgICAgICAgICAgIGhhbmRsZXI6IGEsCiAgICAgICAgICAgIGRhdGE6IGIsCiAgICAgICAgICAgIHJlc3BvbnNlSWQ6IG51bGwKICAgICAgICB9KQogICAgfQogICAgVGljaygpIHt9CiAgICBUaWNrMigpIHt9CiAgICBfU3RhcnRUaWNraW5nKCkgewogICAgICAgIHRoaXMuX2lzVGlja2luZyB8fCAodGhpcy5fdGlja0Z1bmMgfHwgKHRoaXMuX3RpY2tGdW5jID0gKCkgPT4gdGhpcy5UaWNrKCkpLCB0aGlzLl9ydW50aW1lLkRpc3BhdGNoZXIoKS5hZGRFdmVudExpc3RlbmVyKCJ0aWNrIiwgdGhpcy5fdGlja0Z1bmMpLCB0aGlzLl9pc1RpY2tpbmcgPSAhMCkKICAgIH0KICAgIF9TdG9wVGlja2luZygpIHsKICAgICAgICB0aGlzLl9pc1RpY2tpbmcgJiYgKHRoaXMuX3J1bnRpbWUuRGlzcGF0Y2hlcigpLnJlbW92ZUV2ZW50TGlzdGVuZXIoInRpY2siLCB0aGlzLl90aWNrRnVuYyksCiAgICAgICAgICAgIHRoaXMuX2lzVGlja2luZyA9ICExKQogICAgfQogICAgSXNUaWNraW5nKCkgewogICAgICAgIHJldHVybiB0aGlzLl9pc1RpY2tpbmcKICAgIH0KICAgIF9TdGFydFRpY2tpbmcyKCkgewogICAgICAgIHRoaXMuX2lzVGlja2luZzIgfHwgKHRoaXMuX3RpY2syRnVuYyB8fCAodGhpcy5fdGljazJGdW5jID0gKCkgPT4gdGhpcy5UaWNrMigpKSwgdGhpcy5fcnVudGltZS5EaXNwYXRjaGVyKCkuYWRkRXZlbnRMaXN0ZW5lcigidGljazIiLCB0aGlzLl90aWNrMkZ1bmMpLCB0aGlzLl9pc1RpY2tpbmcyID0gITApCiAgICB9CiAgICBfU3RvcFRpY2tpbmcyKCkgewogICAgICAgIHRoaXMuX2lzVGlja2luZzIgJiYgKHRoaXMuX3J1bnRpbWUuRGlzcGF0Y2hlcigpLnJlbW92ZUV2ZW50TGlzdGVuZXIoInRpY2syIiwgdGhpcy5fdGljazJGdW5jKSwgdGhpcy5faXNUaWNraW5nMiA9ICExKQogICAgfQogICAgSXNUaWNraW5nMigpIHsKICAgICAgICByZXR1cm4gdGhpcy5faXNUaWNraW5nMgogICAgfQogICAgR2V0RGVidWdnZXJQcm9wZXJ0aWVzKCkgewogICAgICAgIHJldHVybiBbXQogICAgfQogICAgU2F2ZVRvSnNvbigpIHsKICAgICAgICByZXR1cm4gbnVsbAogICAgfQogICAgTG9hZEZyb21Kc29uKGEpIHt9CiAgICBHZXRQcm9wZXJ0eVZhbHVlQnlJbmRleChhKSB7fQogICAgU2V0UHJvcGVydHlWYWx1ZUJ5SW5kZXgoYSwKICAgICAgICBiKSB7fQogICAgT2Zmc2V0UHJvcGVydHlWYWx1ZUJ5SW5kZXgoYSwgYikgewogICAgICAgIGlmICgwICE9PSBiKSB7CiAgICAgICAgICAgIHZhciBkID0gdGhpcy5HZXRQcm9wZXJ0eVZhbHVlQnlJbmRleChhKTsKICAgICAgICAgICAgaWYgKCJudW1iZXIiICE9PSB0eXBlb2YgZCkgdGhyb3cgRXJyb3IoImV4cGVjdGVkIG51bWJlciIpOwogICAgICAgICAgICB0aGlzLlNldFByb3BlcnR5VmFsdWVCeUluZGV4KGEsIGQgKyBiKQogICAgICAgIH0KICAgIH0KICAgIFNldFByb3BlcnR5Q29sb3JPZmZzZXRWYWx1ZUJ5SW5kZXgoYSwgYiwgZCwgYykge30KICAgIENhbGxBY3Rpb24oYSwgLi4uYikgewogICAgICAgIGEuY2FsbCh0aGlzLCAuLi5iKQogICAgfQogICAgQ2FsbEV4cHJlc3Npb24oYSwgLi4uYikgewogICAgICAgIHJldHVybiBhLmNhbGwodGhpcywgLi4uYikKICAgIH0KICAgIEdldFNjcmlwdEludGVyZmFjZUNsYXNzKCkgewogICAgICAgIHJldHVybiBudWxsCiAgICB9CiAgICBEaXNwYXRjaFNjcmlwdEV2ZW50KGEsIGIsIGQpIHsKICAgICAgICBpZiAodGhpcy5faW5zdC5IYXNTY3JpcHRJbnRlcmZhY2UoKSkgewogICAgICAgICAgICB2YXIgYyA9IHRoaXMuR2V0U2NyaXB0SW50ZXJmYWNlKCk7CiAgICAgICAgICAgIGEgPSBDMyRqc2NvbXAkMTQ0Lk5ldyhDMyRqc2NvbXAkMTQ0LkV2ZW50LCBhLCBiKTsKICAgICAgICAgICAgYS5pbnN0YW5jZSA9IGM7CiAgICAgICAgICAgIGQgJiYgT2JqZWN0LmFzc2lnbihhLAogICAgICAgICAgICAgICAgZCk7CiAgICAgICAgICAgIGMuZGlzcGF0Y2hFdmVudChhKQogICAgICAgIH0KICAgIH0KfTsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkMTQ1ID0gc2VsZi5DMzsKQzMkanNjb21wJDE0NS5TREtXb3JsZEluc3RhbmNlQmFzZSA9IGNsYXNzIGV4dGVuZHMgQzMkanNjb21wJDE0NS5TREtJbnN0YW5jZUJhc2UgewogICAgY29uc3RydWN0b3IoYSwgYikgewogICAgICAgIHN1cGVyKGEsIGIpOwogICAgICAgIHRoaXMuX3dvcmxkSW5mbyA9IGEuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgdGhpcy5fd2ViZ2xjb250ZXh0cmVzdG9yZWRfaGFuZGxlciA9IHRoaXMuX3dlYmdsY29udGV4dGxvc3RfaGFuZGxlciA9IG51bGwKICAgIH0KICAgIFJlbGVhc2UoKSB7CiAgICAgICAgaWYgKHRoaXMuX3dlYmdsY29udGV4dGxvc3RfaGFuZGxlcikgewogICAgICAgICAgICBjb25zdCBhID0gdGhpcy5fcnVudGltZS5EaXNwYXRjaGVyKCk7CiAgICAgICAgICAgIGEucmVtb3ZlRXZlbnRMaXN0ZW5lcigid2ViZ2xjb250ZXh0bG9zdCIsIHRoaXMuX3dlYmdsY29udGV4dGxvc3RfaGFuZGxlcik7CiAgICAgICAgICAgIGEucmVtb3ZlRXZlbnRMaXN0ZW5lcigid2ViZ2xjb250ZXh0cmVzdG9yZWQiLCB0aGlzLl93ZWJnbGNvbnRleHRyZXN0b3JlZF9oYW5kbGVyKTsKICAgICAgICAgICAgdGhpcy5fd2ViZ2xjb250ZXh0cmVzdG9yZWRfaGFuZGxlciA9IHRoaXMuX3dlYmdsY29udGV4dGxvc3RfaGFuZGxlciA9CiAgICAgICAgICAgICAgICBudWxsCiAgICAgICAgfQogICAgICAgIHRoaXMuX3dvcmxkSW5mbyA9IG51bGw7CiAgICAgICAgc3VwZXIuUmVsZWFzZSgpCiAgICB9CiAgICBIYW5kbGVXZWJHTENvbnRleHRMb3NzKCkgewogICAgICAgIGlmICghdGhpcy5fd2ViZ2xjb250ZXh0bG9zdF9oYW5kbGVyKSB7CiAgICAgICAgICAgIHRoaXMuX3dlYmdsY29udGV4dGxvc3RfaGFuZGxlciA9ICgpID0+IHRoaXMuT25XZWJHTENvbnRleHRMb3N0KCk7CiAgICAgICAgICAgIHRoaXMuX3dlYmdsY29udGV4dHJlc3RvcmVkX2hhbmRsZXIgPSAoKSA9PiB0aGlzLk9uV2ViR0xDb250ZXh0UmVzdG9yZWQoKTsKICAgICAgICAgICAgdmFyIGEgPSB0aGlzLl9ydW50aW1lLkRpc3BhdGNoZXIoKTsKICAgICAgICAgICAgYS5hZGRFdmVudExpc3RlbmVyKCJ3ZWJnbGNvbnRleHRsb3N0IiwgdGhpcy5fd2ViZ2xjb250ZXh0bG9zdF9oYW5kbGVyKTsKICAgICAgICAgICAgYS5hZGRFdmVudExpc3RlbmVyKCJ3ZWJnbGNvbnRleHRyZXN0b3JlZCIsIHRoaXMuX3dlYmdsY29udGV4dHJlc3RvcmVkX2hhbmRsZXIpCiAgICAgICAgfQogICAgfQogICAgT25XZWJHTENvbnRleHRMb3N0KCkge30KICAgIE9uV2ViR0xDb250ZXh0UmVzdG9yZWQoKSB7fQogICAgR2V0V29ybGRJbmZvKCkgewogICAgICAgIHJldHVybiB0aGlzLl93b3JsZEluZm8KICAgIH0KICAgIElzT3JpZ2luYWxTaXplS25vd24oKSB7CiAgICAgICAgcmV0dXJuICExCiAgICB9CiAgICBHZXRPcmlnaW5hbFdpZHRoKCkgewogICAgICAgIGlmICghdGhpcy5Jc09yaWdpbmFsU2l6ZUtub3duKCkpIHRocm93IEVycm9yKCJvcmlnaW5hbCBzaXplIG5vdCBrbm93biIpOwogICAgICAgIGNvbnN0IGEgPSB0aGlzLkdldEN1cnJlbnRJbWFnZUluZm8oKTsKICAgICAgICBpZiAoYSkgcmV0dXJuIGEuR2V0V2lkdGgoKQogICAgfQogICAgR2V0T3JpZ2luYWxIZWlnaHQoKSB7CiAgICAgICAgaWYgKCF0aGlzLklzT3JpZ2luYWxTaXplS25vd24oKSkgdGhyb3cgRXJyb3IoIm9yaWdpbmFsIHNpemUgbm90IGtub3duIik7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuR2V0Q3VycmVudEltYWdlSW5mbygpOwogICAgICAgIGlmIChhKSByZXR1cm4gYS5HZXRIZWlnaHQoKQogICAgfQogICAgR2V0Q3VycmVudEltYWdlSW5mbygpIHsKICAgICAgICByZXR1cm4gbnVsbAogICAgfQogICAgR2V0Q3VycmVudFN1cmZhY2VTaXplKCkgewogICAgICAgIHZhciBhID0gdGhpcy5HZXRDdXJyZW50SW1hZ2VJbmZvKCk7CiAgICAgICAgcmV0dXJuIGEgJiYgKGEgPSBhLkdldFRleHR1cmUoKSkgPyBbYS5HZXRXaWR0aCgpLCBhLkdldEhlaWdodCgpXSA6IFsxMDAsIDEwMF0KICAgIH0KICAgIEdldEN1cnJlbnRUZXhSZWN0KCkgewogICAgICAgIGNvbnN0IGEgPSB0aGlzLkdldEN1cnJlbnRJbWFnZUluZm8oKTsKICAgICAgICByZXR1cm4gYSA/IGEuR2V0VGV4UmVjdCgpIDogbnVsbAogICAgfQogICAgR2V0Q3VycmVudFRleFF1YWQoKSB7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuR2V0Q3VycmVudEltYWdlSW5mbygpOwogICAgICAgIHJldHVybiBhID8gYS5HZXRUZXhRdWFkKCkgOiBudWxsCiAgICB9CiAgICBJc0N1cnJlbnRUZXhSb3RhdGVkKCkgewogICAgICAgIGNvbnN0IGEgPSB0aGlzLkdldEN1cnJlbnRJbWFnZUluZm8oKTsKICAgICAgICByZXR1cm4gYSA/IGEuSXNSb3RhdGVkKCkgOiAhMQogICAgfQogICAgR2V0SW1hZ2VQb2ludChhKSB7CiAgICAgICAgYSA9IHRoaXMuX2luc3QuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgcmV0dXJuIFthLkdldFgoKSwgYS5HZXRZKCldCiAgICB9CiAgICBMb2FkVGlsZW1hcERhdGEoYSwgYiwgZCkge30KICAgIFRlc3RQb2ludE92ZXJsYXBUaWxlKGEsIGIpIHt9CiAgICBSZW5kZXJzVG9Pd25aUGxhbmUoKSB7CiAgICAgICAgcmV0dXJuICEwCiAgICB9Cn07CiJ1c2Ugc3RyaWN0IjsKY29uc3QgQzMkanNjb21wJDE0NiA9IHNlbGYuQzMsCiAgICB0ZW1wUmVjdCRqc2NvbXAkNSA9IEMzJGpzY29tcCQxNDYuTmV3KEMzJGpzY29tcCQxNDYuUmVjdCk7CkMzJGpzY29tcCQxNDYuU0RLRE9NSW5zdGFuY2VCYXNlID0gY2xhc3MgZXh0ZW5kcyBDMyRqc2NvbXAkMTQ2LlNES1dvcmxkSW5zdGFuY2VCYXNlIHsKICAgIGNvbnN0cnVjdG9yKGEsIGIpIHsKICAgICAgICBzdXBlcihhLCBiKTsKICAgICAgICB0aGlzLl9lbGVtZW50SWQgPSB0aGlzLkdldFBsdWdpbigpLl9BZGRFbGVtZW50KHRoaXMpOwogICAgICAgIHRoaXMuX2lzRWxlbWVudFNob3dpbmcgPSAhMDsKICAgICAgICB0aGlzLl9hdXRvRm9udFNpemUgPSB0aGlzLl9lbGVtSGFzRm9jdXMgPSAhMTsKICAgICAgICB0aGlzLl9hdXRvRm9udFNpemVPZmZzZXQgPSAtLjI7CiAgICAgICAgdGhpcy5fbGFzdFJlY3QgPSBDMyRqc2NvbXAkMTQ2Lk5ldyhDMyRqc2NvbXAkMTQ2LlJlY3QsIDAsIDAsIC0xLCAtMSk7CiAgICAgICAgYSA9IHRoaXMuX3J1bnRpbWUuR2V0Q2FudmFzTWFuYWdlcigpOwogICAgICAgIHRoaXMuX2xhc3RXaW5kb3dXaWR0aCA9IGEuR2V0TGFzdFdpZHRoKCk7CiAgICAgICAgdGhpcy5fbGFzdFdpbmRvd0hlaWdodCA9IGEuR2V0TGFzdEhlaWdodCgpOwogICAgICAgIHRoaXMuX2lzUGVuZGluZ1VwZGF0ZVN0YXRlID0gITE7CiAgICAgICAgdGhpcy5fU3RhcnRUaWNraW5nKCkKICAgIH0KICAgIFJlbGVhc2UoKSB7CiAgICAgICAgdGhpcy5HZXRQbHVnaW4oKS5fUmVtb3ZlRWxlbWVudCh0aGlzLl9lbGVtZW50SWQpOwogICAgICAgIHRoaXMuUG9zdFRvRE9NRWxlbWVudCgiZGVzdHJveSIpOwogICAgICAgIHRoaXMuX2VsZW1lbnRJZCA9IC0xOwogICAgICAgIHN1cGVyLlJlbGVhc2UoKQogICAgfQogICAgX0dldEVsZW1lbnRJbkRPTU1vZGUoKSB7CiAgICAgICAgaWYgKHRoaXMuX3J1bnRpbWUuSXNJbldvcmtlcigpKSB0aHJvdyBFcnJvcigibm90IHZhbGlkIGluIHdvcmtlciBtb2RlIik7CiAgICAgICAgcmV0dXJuIHRoaXMuX1Bvc3RUb0RPTUVsZW1lbnRNYXliZVN5bmMoImdldC1lbGVtZW50IikKICAgIH0KICAgIFBvc3RUb0RPTUVsZW1lbnQoYSwgYikgewogICAgICAgIGIgfHwgKGIgPSB7fSk7CiAgICAgICAgYi5lbGVtZW50SWQgPSB0aGlzLl9lbGVtZW50SWQ7CiAgICAgICAgdGhpcy5Qb3N0VG9ET00oYSwgYikKICAgIH0KICAgIF9Qb3N0VG9ET01FbGVtZW50TWF5YmVTeW5jKGEsIGIpIHsKICAgICAgICBiIHx8IChiID0ge30pOwogICAgICAgIGIuZWxlbWVudElkID0gdGhpcy5fZWxlbWVudElkOwogICAgICAgIHJldHVybiB0aGlzLl9Qb3N0VG9ET01NYXliZVN5bmMoYSwgYikKICAgIH0KICAgIFBvc3RUb0RPTUVsZW1lbnRBc3luYyhhLCBiKSB7CiAgICAgICAgYiB8fCAoYiA9IHt9KTsKICAgICAgICBiLmVsZW1lbnRJZCA9IHRoaXMuX2VsZW1lbnRJZDsKICAgICAgICByZXR1cm4gdGhpcy5Qb3N0VG9ET01Bc3luYyhhLCBiKQogICAgfQogICAgQ3JlYXRlRWxlbWVudChhKSB7CiAgICAgICAgYSB8fAogICAgICAgICAgICAoYSA9IHt9KTsKICAgICAgICBjb25zdCBiID0gdGhpcy5HZXRXb3JsZEluZm8oKS5Jc1Zpc2libGUoKTsKICAgICAgICBhLmVsZW1lbnRJZCA9IHRoaXMuX2VsZW1lbnRJZDsKICAgICAgICBhLmlzVmlzaWJsZSA9IGI7CiAgICAgICAgT2JqZWN0LmFzc2lnbihhLCB0aGlzLkdldEVsZW1lbnRTdGF0ZSgpKTsKICAgICAgICB0aGlzLl9pc0VsZW1lbnRTaG93aW5nID0gISFhLmlzVmlzaWJsZTsKICAgICAgICB0aGlzLl9Qb3N0VG9ET01NYXliZVN5bmMoImNyZWF0ZSIsIGEpOwogICAgICAgIHRoaXMuX1VwZGF0ZVBvc2l0aW9uKCEwKQogICAgfQogICAgU2V0RWxlbWVudFZpc2libGUoYSkgewogICAgICAgIGEgPSAhIWE7CiAgICAgICAgdGhpcy5faXNFbGVtZW50U2hvd2luZyAhPT0gYSAmJiAodGhpcy5faXNFbGVtZW50U2hvd2luZyA9IGEsIHRoaXMuUG9zdFRvRE9NRWxlbWVudCgic2V0LXZpc2libGUiLCB7CiAgICAgICAgICAgIGlzVmlzaWJsZTogYQogICAgICAgIH0pKQogICAgfQogICAgVGljaygpIHsKICAgICAgICB0aGlzLl9VcGRhdGVQb3NpdGlvbighMSkKICAgIH0KICAgIF9TaG91bGRQcmVzZXJ2ZUVsZW1lbnQoKSB7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuX3J1bnRpbWUuR2V0Q2FudmFzTWFuYWdlcigpLkdldEZ1bGxzY3JlZW5Nb2RlKCk7CiAgICAgICAgcmV0dXJuICJBbmRyb2lkIiA9PT0gQzMkanNjb21wJDE0Ni5QbGF0Zm9ybS5PUyAmJgogICAgICAgICAgICAoInNjYWxlLWlubmVyIiA9PT0gYSB8fCAic2NhbGUtb3V0ZXIiID09PSBhIHx8ICJjcm9wIiA9PT0gYSkKICAgIH0KICAgIF9VcGRhdGVQb3NpdGlvbihhKSB7CiAgICAgICAgdmFyIGIgPSB0aGlzLkdldFdvcmxkSW5mbygpOwogICAgICAgIGNvbnN0IGQgPSBiLkdldExheWVyKCk7CiAgICAgICAgdmFyIGMgPSBiLkdldEJvdW5kaW5nQm94KCk7CiAgICAgICAgbGV0IFtlLCBnXSA9IGQuTGF5ZXJUb0NhbnZhc0NzcyhjLmdldExlZnQoKSwgYy5nZXRUb3AoKSksIFtrLCBtXSA9IGQuTGF5ZXJUb0NhbnZhc0NzcyhjLmdldFJpZ2h0KCksIGMuZ2V0Qm90dG9tKCkpOwogICAgICAgIGMgPSB0aGlzLl9ydW50aW1lLkdldENhbnZhc01hbmFnZXIoKTsKICAgICAgICB2YXIgbiA9IGMuR2V0Q3NzV2lkdGgoKTsKICAgICAgICBjb25zdCBxID0gYy5HZXRDc3NIZWlnaHQoKTsKICAgICAgICBpZiAoYi5Jc1Zpc2libGUoKSAmJiBkLklzVmlzaWJsZSgpKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5fU2hvdWxkUHJlc2VydmVFbGVtZW50KCkpIHsKICAgICAgICAgICAgICAgIGlmICgwID49IGsgfHwgMCA+PSBtIHx8IGUgPj0gbiB8fCBnID49IHEpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLlNldEVsZW1lbnRWaXNpYmxlKCExKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIDEgPiBlICYmIChlID0gMSk7CiAgICAgICAgICAgICAgICAxID4gZyAmJiAoZyA9IDEpOwogICAgICAgICAgICAgICAgayA+PSBuICYmIChrID0gbiAtIDEpOwogICAgICAgICAgICAgICAgbSA+PSBxICYmCiAgICAgICAgICAgICAgICAgICAgKG0gPSBxIC0gMSkKICAgICAgICAgICAgfQogICAgICAgICAgICB0ZW1wUmVjdCRqc2NvbXAkNS5zZXQoZSwgZywgaywgbSk7CiAgICAgICAgICAgIGIgPSBjLkdldExhc3RXaWR0aCgpOwogICAgICAgICAgICBuID0gYy5HZXRMYXN0SGVpZ2h0KCk7CiAgICAgICAgICAgICFhICYmIHRlbXBSZWN0JGpzY29tcCQ1LmVxdWFscyh0aGlzLl9sYXN0UmVjdCkgJiYgdGhpcy5fbGFzdFdpbmRvd1dpZHRoID09PSBiICYmIHRoaXMuX2xhc3RXaW5kb3dIZWlnaHQgPT09IG4gPyB0aGlzLlNldEVsZW1lbnRWaXNpYmxlKCEwKSA6ICh0aGlzLl9sYXN0UmVjdC5jb3B5KHRlbXBSZWN0JGpzY29tcCQ1KSwgdGhpcy5fbGFzdFdpbmRvd1dpZHRoID0gYiwgdGhpcy5fbGFzdFdpbmRvd0hlaWdodCA9IG4sIHRoaXMuU2V0RWxlbWVudFZpc2libGUoITApLCBhID0gbnVsbCwgdGhpcy5fYXV0b0ZvbnRTaXplICYmIChhID0gZC5HZXREaXNwbGF5U2NhbGUoKSArIHRoaXMuX2F1dG9Gb250U2l6ZU9mZnNldCksIHRoaXMuUG9zdFRvRE9NRWxlbWVudCgidXBkYXRlLXBvc2l0aW9uIiwgewogICAgICAgICAgICAgICAgbGVmdDogTWF0aC5yb3VuZCh0aGlzLl9sYXN0UmVjdC5nZXRMZWZ0KCkpICsgYy5HZXRDYW52YXNDbGllbnRYKCksCiAgICAgICAgICAgICAgICB0b3A6IE1hdGgucm91bmQodGhpcy5fbGFzdFJlY3QuZ2V0VG9wKCkpICsgYy5HZXRDYW52YXNDbGllbnRZKCksCiAgICAgICAgICAgICAgICB3aWR0aDogTWF0aC5yb3VuZCh0aGlzLl9sYXN0UmVjdC53aWR0aCgpKSwKICAgICAgICAgICAgICAgIGhlaWdodDogTWF0aC5yb3VuZCh0aGlzLl9sYXN0UmVjdC5oZWlnaHQoKSksCiAgICAgICAgICAgICAgICBmb250U2l6ZTogYQogICAgICAgICAgICB9KSkKICAgICAgICB9IGVsc2UgdGhpcy5TZXRFbGVtZW50VmlzaWJsZSghMSkKICAgIH0KICAgIEZvY3VzRWxlbWVudCgpIHsKICAgICAgICB0aGlzLl9Qb3N0VG9ET01FbGVtZW50TWF5YmVTeW5jKCJmb2N1cyIsIHsKICAgICAgICAgICAgZm9jdXM6ICEwCiAgICAgICAgfSkKICAgIH0KICAgIEJsdXJFbGVtZW50KCkgewogICAgICAgIHRoaXMuX1Bvc3RUb0RPTUVsZW1lbnRNYXliZVN5bmMoImZvY3VzIiwgewogICAgICAgICAgICBmb2N1czogITEKICAgICAgICB9KQogICAgfQogICAgX09uRWxlbUZvY3VzZWQoKSB7CiAgICAgICAgdGhpcy5fZWxlbUhhc0ZvY3VzID0gITAKICAgIH0KICAgIF9PbkVsZW1CbHVycmVkKCkgewogICAgICAgIHRoaXMuX2VsZW1IYXNGb2N1cyA9ICExCiAgICB9CiAgICBJc0VsZW1lbnRGb2N1c2VkKCkgewogICAgICAgIHJldHVybiB0aGlzLl9lbGVtSGFzRm9jdXMKICAgIH0KICAgIFNldEVsZW1lbnRDU1NTdHlsZShhLCBiKSB7CiAgICAgICAgdGhpcy5Qb3N0VG9ET01FbGVtZW50KCJzZXQtY3NzLXN0eWxlIiwgewogICAgICAgICAgICBwcm9wOiBDMyRqc2NvbXAkMTQ2LkNTU1RvQ2FtZWxDYXNlKGEpLAogICAgICAgICAgICB2YWw6IGIKICAgICAgICB9KQogICAgfQogICAgU2V0RWxlbWVudEF0dHJpYnV0ZShhLCBiKSB7CiAgICAgICAgdGhpcy5Qb3N0VG9ET01FbGVtZW50KCJzZXQtYXR0cmlidXRlIiwgewogICAgICAgICAgICBuYW1lOiBhLAogICAgICAgICAgICB2YWw6IGIKICAgICAgICB9KQogICAgfQogICAgUmVtb3ZlRWxlbWVudEF0dHJpYnV0ZShhKSB7CiAgICAgICAgdGhpcy5Qb3N0VG9ET01FbGVtZW50KCJyZW1vdmUtYXR0cmlidXRlIiwgewogICAgICAgICAgICBuYW1lOiBhCiAgICAgICAgfSkKICAgIH0KICAgIFVwZGF0ZUVsZW1lbnRTdGF0ZSgpIHsKICAgICAgICB0aGlzLl9pc1BlbmRpbmdVcGRhdGVTdGF0ZSB8fCAodGhpcy5faXNQZW5kaW5nVXBkYXRlU3RhdGUgPSAhMCwgUHJvbWlzZS5yZXNvbHZlKCkudGhlbigoKSA9PiB7CiAgICAgICAgICAgIHRoaXMuX2lzUGVuZGluZ1VwZGF0ZVN0YXRlID0gITE7CiAgICAgICAgICAgIHRoaXMuUG9zdFRvRE9NRWxlbWVudCgidXBkYXRlLXN0YXRlIiwgdGhpcy5HZXRFbGVtZW50U3RhdGUoKSkKICAgICAgICB9KSkKICAgIH0KICAgIEdldEVsZW1lbnRTdGF0ZSgpIHt9CiAgICBHZXRFbGVtZW50SWQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2VsZW1lbnRJZAogICAgfQp9OwoidXNlIHN0cmljdCI7CmNvbnN0IEMzJGpzY29tcCQxNDcgPSBzZWxmLkMzLAogICAgSUJlaGF2aW9yJGpzY29tcCQxID0gc2VsZi5JQmVoYXZpb3I7CkMzJGpzY29tcCQxNDcuU0RLQmVoYXZpb3JCYXNlID0gY2xhc3MgZXh0ZW5kcyBDMyRqc2NvbXAkMTQ3LkRlZmVuZGVkQmFzZSB7CiAgICBjb25zdHJ1Y3RvcihhKSB7CiAgICAgICAgc3VwZXIoKTsKICAgICAgICB0aGlzLl9ydW50aW1lID0gYS5ydW50aW1lOwogICAgICAgIHRoaXMuX215T2JqZWN0Q2xhc3NlcyA9IEMzJGpzY29tcCQxNDcuTmV3KEMzJGpzY29tcCQxNDcuQXJyYXlTZXQpOwogICAgICAgIHRoaXMuX215SW5zdGFuY2VzID0gQzMkanNjb21wJDE0Ny5OZXcoQzMkanNjb21wJDE0Ny5BcnJheVNldCk7CiAgICAgICAgdGhpcy5faUJlaGF2aW9yID0gbnVsbDsKICAgICAgICB0aGlzLl9zY3JpcHRJbnRlcmZhY2VDbGFzcyA9IGEuc2NyaXB0SW50ZXJmYWNlQ2xhc3MgfHwgbnVsbAogICAgfQogICAgUmVsZWFzZSgpIHsKICAgICAgICB0aGlzLl9teUluc3RhbmNlcy5SZWxlYXNlKCk7CiAgICAgICAgdGhpcy5fbXlPYmplY3RDbGFzc2VzLlJlbGVhc2UoKTsKICAgICAgICB0aGlzLl9ydW50aW1lID0gbnVsbAogICAgfQogICAgR2V0UnVudGltZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcnVudGltZQogICAgfQogICAgT25DcmVhdGUoKSB7fQogICAgX0FkZE9iamVjdENsYXNzKGEpIHsKICAgICAgICB0aGlzLl9teU9iamVjdENsYXNzZXMuQWRkKGEpCiAgICB9CiAgICBHZXRPYmplY3RDbGFzc2VzKCkgewogICAgICAgIHJldHVybiB0aGlzLl9teU9iamVjdENsYXNzZXMuR2V0QXJyYXkoKQogICAgfQogICAgX0FkZEluc3RhbmNlKGEpIHsKICAgICAgICB0aGlzLl9teUluc3RhbmNlcy5BZGQoYSkKICAgIH0KICAgIF9SZW1vdmVJbnN0YW5jZShhKSB7CiAgICAgICAgdGhpcy5fbXlJbnN0YW5jZXMuRGVsZXRlKGEpCiAgICB9CiAgICBHZXRJbnN0YW5jZXMoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX215SW5zdGFuY2VzLkdldEFycmF5KCkKICAgIH0KICAgIEdldElCZWhhdmlvcigpIHsKICAgICAgICBpZiAobnVsbCA9PT0gdGhpcy5faUJlaGF2aW9yKSB7CiAgICAgICAgICAgIGNvbnN0IGEgPQogICAgICAgICAgICAgICAgdGhpcy5fc2NyaXB0SW50ZXJmYWNlQ2xhc3M7CiAgICAgICAgICAgIGlmIChhKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5faUJlaGF2aW9yID0gbmV3IGEodGhpcyksICEodGhpcy5faUJlaGF2aW9yIGluc3RhbmNlb2YgSUJlaGF2aW9yJGpzY29tcCQxKSkgdGhyb3cgbmV3IFR5cGVFcnJvcigic2NyaXB0IGludGVyZmFjZSBjbGFzcyBtdXN0IGRlcml2ZSBmcm9tIElCZWhhdmlvciIpOwogICAgICAgICAgICB9IGVsc2UgdGhpcy5faUJlaGF2aW9yID0gbmV3IElCZWhhdmlvciRqc2NvbXAkMSh0aGlzKQogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpcy5faUJlaGF2aW9yCiAgICB9Cn07CiJ1c2Ugc3RyaWN0IjsKY29uc3QgQzMkanNjb21wJDE0OCA9IHNlbGYuQzM7CkMzJGpzY29tcCQxNDguU0RLQmVoYXZpb3JUeXBlQmFzZSA9IGNsYXNzIGV4dGVuZHMgQzMkanNjb21wJDE0OC5EZWZlbmRlZEJhc2UgewogICAgY29uc3RydWN0b3IoYSkgewogICAgICAgIHN1cGVyKCk7CiAgICAgICAgdGhpcy5fcnVudGltZSA9IGEuR2V0UnVudGltZSgpOwogICAgICAgIHRoaXMuX2JlaGF2aW9yVHlwZSA9IGE7CiAgICAgICAgdGhpcy5fb2JqZWN0Q2xhc3MgPSBhLkdldE9iamVjdENsYXNzKCk7CiAgICAgICAgdGhpcy5fYmVoYXZpb3IgPSBhLkdldEJlaGF2aW9yKCk7CiAgICAgICAgdGhpcy5fYmVoYXZpb3IuX0FkZE9iamVjdENsYXNzKHRoaXMuX29iamVjdENsYXNzKQogICAgfQogICAgUmVsZWFzZSgpIHsKICAgICAgICB0aGlzLl9iZWhhdmlvciA9IHRoaXMuX29iamVjdENsYXNzID0gdGhpcy5fYmVoYXZpb3JUeXBlID0gdGhpcy5fcnVudGltZSA9IG51bGwKICAgIH0KICAgIEdldEJlaGF2aW9yVHlwZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fYmVoYXZpb3JUeXBlCiAgICB9CiAgICBHZXRPYmplY3RDbGFzcygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fb2JqZWN0Q2xhc3MKICAgIH0KICAgIEdldFJ1bnRpbWUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUKICAgIH0KICAgIEdldEJlaGF2aW9yKCkgewogICAgICAgIHJldHVybiB0aGlzLl9iZWhhdmlvcgogICAgfQp9OwoidXNlIHN0cmljdCI7CmNvbnN0IEMzJGpzY29tcCQxNDkgPSBzZWxmLkMzOwpDMyRqc2NvbXAkMTQ5LlNES0JlaGF2aW9ySW5zdGFuY2VCYXNlID0gY2xhc3MgZXh0ZW5kcyBDMyRqc2NvbXAkMTQ5LkRlZmVuZGVkQmFzZSB7CiAgICBjb25zdHJ1Y3RvcihhLCBiKSB7CiAgICAgICAgc3VwZXIoKTsKICAgICAgICB0aGlzLl9iZWhJbnN0ID0gYTsKICAgICAgICB0aGlzLl9kb21Db21wb25lbnRJZCA9IGI7CiAgICAgICAgdGhpcy5faW5zdCA9IGEuR2V0T2JqZWN0SW5zdGFuY2UoKTsKICAgICAgICB0aGlzLl9ydW50aW1lID0gYS5HZXRSdW50aW1lKCk7CiAgICAgICAgdGhpcy5fYmVoYXZpb3JUeXBlID0gYS5HZXRCZWhhdmlvclR5cGUoKTsKICAgICAgICB0aGlzLl9zZGtUeXBlID0gdGhpcy5fYmVoYXZpb3JUeXBlLkdldFNka1R5cGUoKTsKICAgICAgICB0aGlzLl9pc1Bvc3RUaWNraW5nID0gdGhpcy5faXNUaWNraW5nMiA9IHRoaXMuX2lzVGlja2luZyA9ICExOwogICAgICAgIHRoaXMuX2Rpc3Bvc2FibGVzID0gbnVsbAogICAgfQogICAgUmVsZWFzZSgpIHsKICAgICAgICB0aGlzLl9TdG9wVGlja2luZygpOwogICAgICAgIHRoaXMuX1N0b3BUaWNraW5nMigpOwogICAgICAgIHRoaXMuX1N0b3BQb3N0VGlja2luZygpOwogICAgICAgIHRoaXMuX2Rpc3Bvc2FibGVzICYmICh0aGlzLl9kaXNwb3NhYmxlcy5SZWxlYXNlKCksIHRoaXMuX2Rpc3Bvc2FibGVzID0KICAgICAgICAgICAgbnVsbCk7CiAgICAgICAgdGhpcy5fc2RrVHlwZSA9IHRoaXMuX2JlaGF2aW9yVHlwZSA9IHRoaXMuX3J1bnRpbWUgPSB0aGlzLl9pbnN0ID0gdGhpcy5fYmVoSW5zdCA9IG51bGwKICAgIH0KICAgIEdldEJlaGF2aW9yKCkgewogICAgICAgIHJldHVybiB0aGlzLl9iZWhhdmlvclR5cGUuR2V0QmVoYXZpb3IoKQogICAgfQogICAgR2V0QmVoYXZpb3JJbnN0YW5jZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fYmVoSW5zdAogICAgfQogICAgR2V0T2JqZWN0SW5zdGFuY2UoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2luc3QKICAgIH0KICAgIEdldE9iamVjdENsYXNzKCkgewogICAgICAgIHJldHVybiB0aGlzLl9pbnN0LkdldE9iamVjdENsYXNzKCkKICAgIH0KICAgIEdldFdvcmxkSW5mbygpIHsKICAgICAgICByZXR1cm4gdGhpcy5faW5zdC5HZXRXb3JsZEluZm8oKQogICAgfQogICAgR2V0UnVudGltZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcnVudGltZQogICAgfQogICAgR2V0QmVoYXZpb3JUeXBlKCkgewogICAgICAgIHJldHVybiB0aGlzLl9iZWhhdmlvclR5cGUKICAgIH0KICAgIEdldFNka1R5cGUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3Nka1R5cGUKICAgIH0KICAgIEdldFNjcmlwdEludGVyZmFjZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fYmVoSW5zdC5HZXRTY3JpcHRJbnRlcmZhY2UoKQogICAgfQogICAgVHJpZ2dlcihhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUuVHJpZ2dlcihhLAogICAgICAgICAgICB0aGlzLl9pbnN0LCB0aGlzLl9iZWhhdmlvclR5cGUpCiAgICB9CiAgICBEZWJ1Z1RyaWdnZXIoYSkgewogICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lLkRlYnVnVHJpZ2dlcihhLCB0aGlzLl9pbnN0LCB0aGlzLl9iZWhhdmlvclR5cGUpCiAgICB9CiAgICBUcmlnZ2VyQXN5bmMoYSkgewogICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lLlRyaWdnZXJBc3luYyhhLCB0aGlzLl9pbnN0LCB0aGlzLl9iZWhhdmlvclR5cGUpCiAgICB9CiAgICBQb3N0Q3JlYXRlKCkge30KICAgIFRpY2soKSB7fQogICAgVGljazIoKSB7fQogICAgUG9zdFRpY2soKSB7fQogICAgX1N0YXJ0VGlja2luZygpIHsKICAgICAgICB0aGlzLl9pc1RpY2tpbmcgfHwgKHRoaXMuX3J1bnRpbWUuX0FkZEJlaEluc3RUb1RpY2sodGhpcyksIHRoaXMuX2lzVGlja2luZyA9ICEwKQogICAgfQogICAgX1N0b3BUaWNraW5nKCkgewogICAgICAgIHRoaXMuX2lzVGlja2luZyAmJiAodGhpcy5fcnVudGltZS5fUmVtb3ZlQmVoSW5zdFRvVGljayh0aGlzKSwgdGhpcy5faXNUaWNraW5nID0gITEpCiAgICB9CiAgICBJc1RpY2tpbmcoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2lzVGlja2luZwogICAgfQogICAgX1N0YXJ0VGlja2luZzIoKSB7CiAgICAgICAgdGhpcy5faXNUaWNraW5nMiB8fCAodGhpcy5fcnVudGltZS5fQWRkQmVoSW5zdFRvVGljazIodGhpcyksCiAgICAgICAgICAgIHRoaXMuX2lzVGlja2luZzIgPSAhMCkKICAgIH0KICAgIF9TdG9wVGlja2luZzIoKSB7CiAgICAgICAgdGhpcy5faXNUaWNraW5nMiAmJiAodGhpcy5fcnVudGltZS5fUmVtb3ZlQmVoSW5zdFRvVGljazIodGhpcyksIHRoaXMuX2lzVGlja2luZzIgPSAhMSkKICAgIH0KICAgIElzVGlja2luZzIoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2lzVGlja2luZzIKICAgIH0KICAgIF9TdGFydFBvc3RUaWNraW5nKCkgewogICAgICAgIHRoaXMuX2lzUG9zdFRpY2tpbmcgfHwgKHRoaXMuX3J1bnRpbWUuX0FkZEJlaEluc3RUb1Bvc3RUaWNrKHRoaXMpLCB0aGlzLl9pc1Bvc3RUaWNraW5nID0gITApCiAgICB9CiAgICBfU3RvcFBvc3RUaWNraW5nKCkgewogICAgICAgIHRoaXMuX2lzUG9zdFRpY2tpbmcgJiYgKHRoaXMuX3J1bnRpbWUuX1JlbW92ZUJlaEluc3RUb1Bvc3RUaWNrKHRoaXMpLCB0aGlzLl9pc1Bvc3RUaWNraW5nID0gITEpCiAgICB9CiAgICBJc1Bvc3RUaWNraW5nKCkgewogICAgICAgIHJldHVybiB0aGlzLl9pc1Bvc3RUaWNraW5nCiAgICB9CiAgICBHZXREZWJ1Z2dlclByb3BlcnRpZXMoKSB7CiAgICAgICAgcmV0dXJuIFtdCiAgICB9CiAgICBBZGRET01NZXNzYWdlSGFuZGxlcihhLCBiKSB7CiAgICAgICAgdGhpcy5fcnVudGltZS5BZGRET01Db21wb25lbnRNZXNzYWdlSGFuZGxlcih0aGlzLl9kb21Db21wb25lbnRJZCwKICAgICAgICAgICAgYSwgYikKICAgIH0KICAgIE9uU3ByaXRlRnJhbWVDaGFuZ2VkKGEsIGIpIHt9CiAgICBTYXZlVG9Kc29uKCkgewogICAgICAgIHJldHVybiBudWxsCiAgICB9CiAgICBMb2FkRnJvbUpzb24oYSkge30KICAgIEdldFByb3BlcnR5VmFsdWVCeUluZGV4KGEpIHt9CiAgICBTZXRQcm9wZXJ0eVZhbHVlQnlJbmRleChhLCBiKSB7fQogICAgT2Zmc2V0UHJvcGVydHlWYWx1ZUJ5SW5kZXgoYSwgYikgewogICAgICAgIGlmICgwICE9PSBiKSB7CiAgICAgICAgICAgIHZhciBkID0gdGhpcy5HZXRQcm9wZXJ0eVZhbHVlQnlJbmRleChhKTsKICAgICAgICAgICAgaWYgKCJudW1iZXIiICE9PSB0eXBlb2YgZCkgdGhyb3cgRXJyb3IoImV4cGVjdGVkIG51bWJlciIpOwogICAgICAgICAgICB0aGlzLlNldFByb3BlcnR5VmFsdWVCeUluZGV4KGEsIGQgKyBiKQogICAgICAgIH0KICAgIH0KICAgIFNldFByb3BlcnR5Q29sb3JPZmZzZXRWYWx1ZUJ5SW5kZXgoYSwgYiwgZCwgYykge30KICAgIENhbGxBY3Rpb24oYSwgLi4uYikgewogICAgICAgIGEuY2FsbCh0aGlzLCAuLi5iKQogICAgfQogICAgQ2FsbEV4cHJlc3Npb24oYSwgLi4uYikgewogICAgICAgIHJldHVybiBhLmNhbGwodGhpcywgLi4uYikKICAgIH0KICAgIEdldFNjcmlwdEludGVyZmFjZUNsYXNzKCkgewogICAgICAgIHJldHVybiBudWxsCiAgICB9CiAgICBEaXNwYXRjaFNjcmlwdEV2ZW50KGEsIGIsIGQpIHsKICAgICAgICBpZiAodGhpcy5fYmVoSW5zdC5IYXNTY3JpcHRJbnRlcmZhY2UoKSkgewogICAgICAgICAgICB2YXIgYyA9CiAgICAgICAgICAgICAgICB0aGlzLkdldFNjcmlwdEludGVyZmFjZSgpOwogICAgICAgICAgICBhID0gQzMkanNjb21wJDE0OS5OZXcoQzMkanNjb21wJDE0OS5FdmVudCwgYSwgYik7CiAgICAgICAgICAgIGEuYmVoYXZpb3JJbnN0YW5jZSA9IGM7CiAgICAgICAgICAgIGEuaW5zdGFuY2UgPSBjLmluc3RhbmNlOwogICAgICAgICAgICBkICYmIE9iamVjdC5hc3NpZ24oYSwgZCk7CiAgICAgICAgICAgIGMuZGlzcGF0Y2hFdmVudChhKQogICAgICAgIH0KICAgIH0KfTsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkMTUwID0gc2VsZi5DMzsKQzMkanNjb21wJDE1MC5QbHVnaW5zID0ge307CkMzJGpzY29tcCQxNTAuQmVoYXZpb3JzID0ge307CkMzJGpzY29tcCQxNTAuUGx1Z2luTWFuYWdlciA9IGNsYXNzIGV4dGVuZHMgQzMkanNjb21wJDE1MC5EZWZlbmRlZEJhc2UgewogICAgY29uc3RydWN0b3IoYSkgewogICAgICAgIHN1cGVyKCk7CiAgICAgICAgdGhpcy5fcnVudGltZSA9IGE7CiAgICAgICAgdGhpcy5fYWxsUGx1Z2lucyA9IFtdOwogICAgICAgIHRoaXMuX3BsdWdpbnNCeUN0b3IgPSBuZXcgTWFwOwogICAgICAgIHRoaXMuX3N5c3RlbVBsdWdpbiA9IG51bGw7CiAgICAgICAgdGhpcy5fYWxsQmVoYXZpb3JzID0gW107CiAgICAgICAgdGhpcy5fYmVoYXZpb3JzQnlDdG9yID0gbmV3IE1hcDsKICAgICAgICB0aGlzLl9qdW1wdGhydUJlaGF2aW9yID0gdGhpcy5fc29saWRCZWhhdmlvciA9IG51bGwKICAgIH0KICAgIENyZWF0ZVBsdWdpbihhKSB7CiAgICAgICAgY29uc3QgYiA9IHRoaXMuX3J1bnRpbWUuR2V0T2JqZWN0UmVmZXJlbmNlKGFbMF0pOwogICAgICAgIGlmICghYikgdGhyb3cgRXJyb3IoIm1pc3NpbmcgcGx1Z2luIik7CiAgICAgICAgQzMkanNjb21wJDE1MC5BZGRDb21tb25BQ0VzKGEsIGIpOwogICAgICAgIGEgPSBDMyRqc2NvbXAkMTUwLk5ldyhiLCB7CiAgICAgICAgICAgIHJ1bnRpbWU6IHRoaXMuX3J1bnRpbWUsCiAgICAgICAgICAgIGlzU2luZ2xlR2xvYmFsOiBhWzFdLAogICAgICAgICAgICBpc1dvcmxkOiBhWzJdLAogICAgICAgICAgICBpc1JvdGF0YWJsZTogYVs1XSwKICAgICAgICAgICAgaGFzRWZmZWN0czogYVs4XSwKICAgICAgICAgICAgbXVzdFByZWRyYXc6IGFbOV0sCiAgICAgICAgICAgIHN1cHBvcnRzU2NlbmVHcmFwaDogYVsxM10sCiAgICAgICAgICAgIHN1cHBvcnRzTWVzaDogYVsxNF0KICAgICAgICB9KTsKICAgICAgICBhLk9uQ3JlYXRlKCk7CiAgICAgICAgdGhpcy5fYWxsUGx1Z2lucy5wdXNoKGEpOwogICAgICAgIHRoaXMuX3BsdWdpbnNCeUN0b3Iuc2V0KGIsIGEpCiAgICB9CiAgICBDcmVhdGVTeXN0ZW1QbHVnaW4oKSB7CiAgICAgICAgdGhpcy5fc3lzdGVtUGx1Z2luID0gQzMkanNjb21wJDE1MC5OZXcoQzMkanNjb21wJDE1MC5QbHVnaW5zLlN5c3RlbSwgewogICAgICAgICAgICBydW50aW1lOiB0aGlzLl9ydW50aW1lLAogICAgICAgICAgICBpc1NpbmdsZUdsb2JhbDogITAKICAgICAgICB9KTsKICAgICAgICB0aGlzLl9zeXN0ZW1QbHVnaW4uT25DcmVhdGUoKQogICAgfQogICAgQ3JlYXRlQmVoYXZpb3IoYSkgewogICAgICAgIGEgPSB0aGlzLl9ydW50aW1lLkdldE9iamVjdFJlZmVyZW5jZShhWzFdKTsKICAgICAgICBpZiAoIWEpIHRocm93IEVycm9yKCJtaXNzaW5nIGJlaGF2aW9yIik7CiAgICAgICAgY29uc3QgYiA9IEMzJGpzY29tcCQxNTAuTmV3KGEsIHsKICAgICAgICAgICAgcnVudGltZTogdGhpcy5fcnVudGltZQogICAgICAgIH0pOwogICAgICAgIGIuT25DcmVhdGUoKTsKICAgICAgICB0aGlzLl9hbGxCZWhhdmlvcnMucHVzaChiKTsKICAgICAgICB0aGlzLl9iZWhhdmlvcnNCeUN0b3Iuc2V0KGEsCiAgICAgICAgICAgIGIpOwogICAgICAgICF0aGlzLl9zb2xpZEJlaGF2aW9yICYmIEMzJGpzY29tcCQxNTAuQmVoYXZpb3JzLnNvbGlkICYmIGIgaW5zdGFuY2VvZiBDMyRqc2NvbXAkMTUwLkJlaGF2aW9ycy5zb2xpZCA/IHRoaXMuX3NvbGlkQmVoYXZpb3IgPSBiIDogIXRoaXMuX2p1bXB0aHJ1QmVoYXZpb3IgJiYgQzMkanNjb21wJDE1MC5CZWhhdmlvcnMuanVtcHRocnUgJiYgYiBpbnN0YW5jZW9mIEMzJGpzY29tcCQxNTAuQmVoYXZpb3JzLmp1bXB0aHJ1ICYmICh0aGlzLl9qdW1wdGhydUJlaGF2aW9yID0gYikKICAgIH0KICAgIEdldFBsdWdpbkJ5Q29uc3RydWN0b3JGdW5jdGlvbihhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3BsdWdpbnNCeUN0b3IuZ2V0KGEpIHx8IG51bGwKICAgIH0KICAgIEhhc0JlaGF2aW9yQnlDb25zdHJ1Y3RvckZ1bmN0aW9uKGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5fYmVoYXZpb3JzQnlDdG9yLmhhcyhhKQogICAgfQogICAgR2V0QmVoYXZpb3JCeUNvbnN0cnVjdG9yRnVuY3Rpb24oYSkgewogICAgICAgIHJldHVybiB0aGlzLl9iZWhhdmlvcnNCeUN0b3IuZ2V0KGEpIHx8IG51bGwKICAgIH0KICAgIEdldFN5c3RlbVBsdWdpbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5fc3lzdGVtUGx1Z2luCiAgICB9CiAgICBHZXRTb2xpZEJlaGF2aW9yKCkgewogICAgICAgIHJldHVybiB0aGlzLl9zb2xpZEJlaGF2aW9yCiAgICB9CiAgICBHZXRKdW1wdGhydUJlaGF2aW9yKCkgewogICAgICAgIHJldHVybiB0aGlzLl9qdW1wdGhydUJlaGF2aW9yCiAgICB9Cn07CiJ1c2Ugc3RyaWN0IjsKY29uc3QgQzMkanNjb21wJDE1MSA9IHNlbGYuQzMsCiAgICBhbGxJbWFnZUluZm9zID0gbmV3IFNldDsKQzMkanNjb21wJDE1MS5JbWFnZUluZm8gPSBjbGFzcyBleHRlbmRzIEMzJGpzY29tcCQxNTEuRGVmZW5kZWRCYXNlIHsKICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgIHN1cGVyKCk7CiAgICAgICAgdGhpcy5fdXJsID0gIiI7CiAgICAgICAgdGhpcy5faGVpZ2h0ID0gdGhpcy5fd2lkdGggPSB0aGlzLl9vZmZzZXRZID0gdGhpcy5fb2Zmc2V0WCA9IHRoaXMuX3NpemUgPSAwOwogICAgICAgIHRoaXMuX2hhc01ldGFEYXRhID0gdGhpcy5faXNSb3RhdGVkID0gITE7CiAgICAgICAgdGhpcy5faW1hZ2VBc3NldCA9IG51bGw7CiAgICAgICAgdGhpcy5fdGV4dHVyZVN0YXRlID0gIiI7CiAgICAgICAgdGhpcy5fcmNUZXggPSBDMyRqc2NvbXAkMTUxLk5ldyhDMyRqc2NvbXAkMTUxLlJlY3QpOwogICAgICAgIHRoaXMuX3F1YWRUZXggPSBDMyRqc2NvbXAkMTUxLk5ldyhDMyRqc2NvbXAkMTUxLlF1YWQpOwogICAgICAgIHRoaXMuX2Jsb2JVcmwgPSAiIjsKICAgICAgICB0aGlzLl9pSW1hZ2VJbmZvID0gbmV3IHNlbGYuSUltYWdlSW5mbyh0aGlzKTsKICAgICAgICBhbGxJbWFnZUluZm9zLmFkZCh0aGlzKQogICAgfQogICAgUmVsZWFzZSgpIHsKICAgICAgICB0aGlzLlJlbGVhc2VUZXh0dXJlKCk7CiAgICAgICAgdGhpcy5faW1hZ2VBc3NldCA9IG51bGw7CiAgICAgICAgYWxsSW1hZ2VJbmZvcy5kZWxldGUodGhpcyk7CiAgICAgICAgdGhpcy5SZWxlYXNlQmxvYlVSTCgpCiAgICB9CiAgICBzdGF0aWMgT25XZWJHTENvbnRleHRMb3N0KCkgewogICAgICAgIGZvciAoY29uc3QgYSBvZiBhbGxJbWFnZUluZm9zKSBhLl90ZXh0dXJlU3RhdGUgPSAiIiwgYS5fcmNUZXguc2V0KDAsIDAsIDAsIDApLCBhLl9xdWFkVGV4LnNldEZyb21SZWN0KGEuX3JjVGV4KQogICAgfQogICAgTG9hZERhdGEoYSkgewogICAgICAgIHRoaXMuX3VybCA9IGFbMF07CiAgICAgICAgdGhpcy5fc2l6ZSA9IGFbMV07CiAgICAgICAgdGhpcy5fb2Zmc2V0WCA9IGFbMl07CiAgICAgICAgdGhpcy5fb2Zmc2V0WSA9IGFbM107CiAgICAgICAgdGhpcy5fd2lkdGggPSBhWzRdOwogICAgICAgIHRoaXMuX2hlaWdodCA9IGFbNV07CiAgICAgICAgdGhpcy5faXNSb3RhdGVkID0gYVs2XTsKICAgICAgICB0aGlzLl9oYXNNZXRhRGF0YSA9ICEwCiAgICB9CiAgICBMb2FkRHluYW1pY0Fzc2V0KGEsIGIpIHsKICAgICAgICBpZiAodGhpcy5faW1hZ2VBc3NldCkgdGhyb3cgRXJyb3IoImFscmVhZHkgbG9hZGVkIGFzc2V0Iik7CiAgICAgICAgdGhpcy5fdXJsID0gYjsKICAgICAgICBjb25zdCBkID0ge307CiAgICAgICAgQzMkanNjb21wJDE1MS5Jc0Fic29sdXRlVVJMKGIpICYmIChkLmxvYWRQb2xpY3kgPSAicmVtb3RlIik7CiAgICAgICAgdGhpcy5Mb2FkQXNzZXQoYSwgZCk7CiAgICAgICAgcmV0dXJuIHRoaXMuX2ltYWdlQXNzZXQuTG9hZCgpCiAgICB9CiAgICBSZXBsYWNlV2l0aChhKSB7CiAgICAgICAgaWYgKGEgPT09CiAgICAgICAgICAgIHRoaXMpIHRocm93IEVycm9yKCJjYW5ub3QgcmVwbGFjZSB3aXRoIHNlbGYiKTsKICAgICAgICB0aGlzLlJlbGVhc2VUZXh0dXJlKCk7CiAgICAgICAgdGhpcy5fdXJsID0gYS5fdXJsOwogICAgICAgIHRoaXMuX3NpemUgPSBhLl9zaXplOwogICAgICAgIHRoaXMuX29mZnNldFggPSBhLl9vZmZzZXRYOwogICAgICAgIHRoaXMuX29mZnNldFkgPSBhLl9vZmZzZXRZOwogICAgICAgIHRoaXMuX3dpZHRoID0gYS5fd2lkdGg7CiAgICAgICAgdGhpcy5faGVpZ2h0ID0gYS5faGVpZ2h0OwogICAgICAgIHRoaXMuX2lzUm90YXRlZCA9IGEuX2lzUm90YXRlZDsKICAgICAgICB0aGlzLl9oYXNNZXRhRGF0YSA9IGEuX2hhc01ldGFEYXRhOwogICAgICAgIHRoaXMuX2ltYWdlQXNzZXQgPSBhLl9pbWFnZUFzc2V0OwogICAgICAgIHRoaXMuX3RleHR1cmVTdGF0ZSA9IGEuX3RleHR1cmVTdGF0ZTsKICAgICAgICB0aGlzLl9yY1RleCA9IGEuX3JjVGV4OwogICAgICAgIHRoaXMuX3F1YWRUZXggPSBhLl9xdWFkVGV4OwogICAgICAgIHRoaXMuUmVsZWFzZUJsb2JVUkwoKQogICAgfQogICAgR2V0VVJMKCkgewogICAgICAgIHJldHVybiB0aGlzLl91cmwKICAgIH0KICAgIEdldFNpemUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3NpemUKICAgIH0KICAgIEdldE9mZnNldFgoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX29mZnNldFgKICAgIH0KICAgIEdldE9mZnNldFkoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX29mZnNldFkKICAgIH0KICAgIElzUm90YXRlZCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5faXNSb3RhdGVkCiAgICB9CiAgICBHZXRXaWR0aCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fd2lkdGgKICAgIH0KICAgIEdldEhlaWdodCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5faGVpZ2h0CiAgICB9CiAgICBHZXRTaGVldFdpZHRoKCkgewogICAgICAgIHJldHVybiB0aGlzLl9pbWFnZUFzc2V0LkdldFdpZHRoKCkKICAgIH0KICAgIEdldFNoZWV0SGVpZ2h0KCkgewogICAgICAgIHJldHVybiB0aGlzLl9pbWFnZUFzc2V0LkdldEhlaWdodCgpCiAgICB9CiAgICBMb2FkQXNzZXQoYSwKICAgICAgICBiKSB7CiAgICAgICAgaWYgKHRoaXMuX2ltYWdlQXNzZXQpIHRocm93IEVycm9yKCJhbHJlYWR5IGdvdCBhc3NldCIpOwogICAgICAgIGIgPSBPYmplY3QuYXNzaWduKHt9LCBiLCB7CiAgICAgICAgICAgIHVybDogdGhpcy5HZXRVUkwoKSwKICAgICAgICAgICAgc2l6ZTogdGhpcy5HZXRTaXplKCkKICAgICAgICB9KTsKICAgICAgICB0aGlzLl9pbWFnZUFzc2V0ID0gYS5Mb2FkSW1hZ2UoYikKICAgIH0KICAgIElzTG9hZGVkKCkgewogICAgICAgIHJldHVybiB0aGlzLl9pbWFnZUFzc2V0ICYmIHRoaXMuX2ltYWdlQXNzZXQuSXNMb2FkZWQoKQogICAgfQogICAgYXN5bmMgTG9hZFN0YXRpY1RleHR1cmUoYSwgYikgewogICAgICAgIGlmICghdGhpcy5faW1hZ2VBc3NldCkgdGhyb3cgRXJyb3IoIm5vIGFzc2V0Iik7CiAgICAgICAgaWYgKHRoaXMuX3RleHR1cmVTdGF0ZSkgdGhyb3cgRXJyb3IoImFscmVhZHkgbG9hZGVkIHRleHR1cmUiKTsKICAgICAgICB0aGlzLl90ZXh0dXJlU3RhdGUgPSAibG9hZGluZyI7CiAgICAgICAgYSA9IGF3YWl0IHRoaXMuX2ltYWdlQXNzZXQuTG9hZFN0YXRpY1RleHR1cmUoYSwgYik7CiAgICAgICAgaWYgKCFhKSByZXR1cm4gdGhpcy5fdGV4dHVyZVN0YXRlID0gIiIsIG51bGw7CiAgICAgICAgdGhpcy5fdGV4dHVyZVN0YXRlID0gImxvYWRlZCI7CiAgICAgICAgdGhpcy5faGFzTWV0YURhdGEgfHwKICAgICAgICAgICAgKHRoaXMuX3dpZHRoID0gYS5HZXRXaWR0aCgpLCB0aGlzLl9oZWlnaHQgPSBhLkdldEhlaWdodCgpLCB0aGlzLl9oYXNNZXRhRGF0YSA9ICEwKTsKICAgICAgICB0aGlzLl9yY1RleC5zZXQodGhpcy5fb2Zmc2V0WCwgdGhpcy5fb2Zmc2V0WSwgdGhpcy5fb2Zmc2V0WCArICh0aGlzLl9pc1JvdGF0ZWQgPyB0aGlzLl9oZWlnaHQgOiB0aGlzLl93aWR0aCksIHRoaXMuX29mZnNldFkgKyAodGhpcy5faXNSb3RhdGVkID8gdGhpcy5fd2lkdGggOiB0aGlzLl9oZWlnaHQpKTsKICAgICAgICB0aGlzLl9yY1RleC5kaXZpZGUoYS5HZXRXaWR0aCgpLCBhLkdldEhlaWdodCgpKTsKICAgICAgICB0aGlzLl9xdWFkVGV4LnNldEZyb21SZWN0KHRoaXMuX3JjVGV4KTsKICAgICAgICB0aGlzLl9pc1JvdGF0ZWQgJiYgdGhpcy5fcXVhZFRleC5yb3RhdGVQb2ludHNBbnRpY2xvY2t3aXNlKCk7CiAgICAgICAgcmV0dXJuIGEKICAgIH0KICAgIFJlbGVhc2VUZXh0dXJlKCkgewogICAgICAgIHRoaXMuX3RleHR1cmVTdGF0ZSAmJiAodGhpcy5faW1hZ2VBc3NldCAmJiB0aGlzLl9pbWFnZUFzc2V0LlJlbGVhc2VUZXh0dXJlKCksIHRoaXMuX3RleHR1cmVTdGF0ZSA9ICIiLCB0aGlzLl9yY1RleC5zZXQoMCwKICAgICAgICAgICAgMCwgMCwgMCksIHRoaXMuX3F1YWRUZXguc2V0RnJvbVJlY3QodGhpcy5fcmNUZXgpKQogICAgfQogICAgR2V0VGV4dHVyZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5faW1hZ2VBc3NldCA/IHRoaXMuX2ltYWdlQXNzZXQuR2V0VGV4dHVyZSgpIDogbnVsbAogICAgfQogICAgR2V0VGV4UmVjdCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcmNUZXgKICAgIH0KICAgIEdldFRleFF1YWQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3F1YWRUZXgKICAgIH0KICAgIEdldElJbWFnZUluZm8oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2lJbWFnZUluZm8KICAgIH0KICAgIGFzeW5jIEV4dHJhY3RJbWFnZVRvQ2FudmFzKCkgewogICAgICAgIGNvbnN0IGEgPSBhd2FpdCB0aGlzLl9pbWFnZUFzc2V0LkxvYWRUb0RyYXdhYmxlKCksCiAgICAgICAgICAgIGIgPSBDMyRqc2NvbXAkMTUxLkNyZWF0ZUNhbnZhcyh0aGlzLl93aWR0aCwgdGhpcy5faGVpZ2h0KSwKICAgICAgICAgICAgZCA9IGIuZ2V0Q29udGV4dCgiMmQiKTsKICAgICAgICB0aGlzLl9pc1JvdGF0ZWQgPyAoZC5yb3RhdGUoTWF0aC5QSSAvIC0yKSwgZC50cmFuc2xhdGUoLXRoaXMuX2hlaWdodCwgMCksIGQuZHJhd0ltYWdlKGEsIHRoaXMuX29mZnNldFgsIHRoaXMuX29mZnNldFksIHRoaXMuX2hlaWdodCwgdGhpcy5fd2lkdGgsCiAgICAgICAgICAgIDAsIDAsIHRoaXMuX2hlaWdodCwgdGhpcy5fd2lkdGgpKSA6IGQuZHJhd0ltYWdlKGEsIHRoaXMuX29mZnNldFgsIHRoaXMuX29mZnNldFksIHRoaXMuX3dpZHRoLCB0aGlzLl9oZWlnaHQsIDAsIDAsIHRoaXMuX3dpZHRoLCB0aGlzLl9oZWlnaHQpOwogICAgICAgIHJldHVybiBiCiAgICB9CiAgICBhc3luYyBFeHRyYWN0SW1hZ2VUb0Jsb2JVUkwoKSB7CiAgICAgICAgaWYgKHRoaXMuX2Jsb2JVcmwpIHJldHVybiB0aGlzLl9ibG9iVXJsOwogICAgICAgIHZhciBhID0gYXdhaXQgdGhpcy5FeHRyYWN0SW1hZ2VUb0NhbnZhcygpOwogICAgICAgIGEgPSBhd2FpdCBDMyRqc2NvbXAkMTUxLkNhbnZhc1RvQmxvYihhKTsKICAgICAgICByZXR1cm4gdGhpcy5fYmxvYlVybCA9IFVSTC5jcmVhdGVPYmplY3RVUkwoYSkKICAgIH0KICAgIFJlbGVhc2VCbG9iVVJMKCkgewogICAgICAgIHRoaXMuX2Jsb2JVcmwgJiYgKFVSTC5yZXZva2VPYmplY3RVUkwodGhpcy5fYmxvYlVybCksIHRoaXMuX2Jsb2JVcmwgPSAiIikKICAgIH0KfTsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkMTUyID0gc2VsZi5DMzsKQzMkanNjb21wJDE1Mi5BbmltYXRpb25JbmZvID0gY2xhc3MgZXh0ZW5kcyBDMyRqc2NvbXAkMTUyLkRlZmVuZGVkQmFzZSB7CiAgICBjb25zdHJ1Y3RvcihhKSB7CiAgICAgICAgc3VwZXIoKTsKICAgICAgICB0aGlzLl9uYW1lID0gYVswXTsKICAgICAgICB0aGlzLl9zcGVlZCA9IGFbMV07CiAgICAgICAgdGhpcy5faXNMb29waW5nID0gISFhWzJdOwogICAgICAgIHRoaXMuX3JlcGVhdENvdW50ID0gYVszXTsKICAgICAgICB0aGlzLl9yZXBlYXRUbyA9IGFbNF07CiAgICAgICAgdGhpcy5faXNQaW5nUG9uZyA9ICEhYVs1XTsKICAgICAgICB0aGlzLl9zaWQgPSBhWzZdOwogICAgICAgIHRoaXMuX2ZyYW1lcyA9IGFbN10ubWFwKGIgPT4gQzMkanNjb21wJDE1Mi5OZXcoQzMkanNjb21wJDE1Mi5BbmltYXRpb25GcmFtZUluZm8sIGIpKTsKICAgICAgICB0aGlzLl9pQW5pbWF0aW9uID0gbmV3IHNlbGYuSUFuaW1hdGlvbih0aGlzKQogICAgfQogICAgUmVsZWFzZSgpIHsKICAgICAgICBmb3IgKGNvbnN0IGEgb2YgdGhpcy5fZnJhbWVzKSBhLlJlbGVhc2UoKTsKICAgICAgICBDMyRqc2NvbXAkMTUyLmNsZWFyQXJyYXkodGhpcy5fZnJhbWVzKQogICAgfQogICAgTG9hZEFsbEFzc2V0cyhhKSB7CiAgICAgICAgZm9yIChjb25zdCBiIG9mIHRoaXMuX2ZyYW1lcykgYi5HZXRJbWFnZUluZm8oKS5Mb2FkQXNzZXQoYSkKICAgIH0KICAgIExvYWRBbGxUZXh0dXJlcyhhLAogICAgICAgIGIpIHsKICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGwodGhpcy5fZnJhbWVzLm1hcChkID0+IGQuR2V0SW1hZ2VJbmZvKCkuTG9hZFN0YXRpY1RleHR1cmUoYSwgYikpKQogICAgfQogICAgUmVsZWFzZUFsbFRleHR1cmVzKCkgewogICAgICAgIGZvciAoY29uc3QgYSBvZiB0aGlzLl9mcmFtZXMpIGEuR2V0SW1hZ2VJbmZvKCkuUmVsZWFzZVRleHR1cmUoKQogICAgfQogICAgR2V0TmFtZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fbmFtZQogICAgfQogICAgR2V0U0lEKCkgewogICAgICAgIHJldHVybiB0aGlzLl9zaWQKICAgIH0KICAgIEdldEZyYW1lQ291bnQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2ZyYW1lcy5sZW5ndGgKICAgIH0KICAgIEdldEZyYW1lcygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZnJhbWVzCiAgICB9CiAgICBHZXRGcmFtZUF0KGEpIHsKICAgICAgICBhID0gTWF0aC5mbG9vcihhKTsKICAgICAgICBpZiAoMCA+IGEgfHwgYSA+PSB0aGlzLl9mcmFtZXMubGVuZ3RoKSB0aHJvdyBuZXcgUmFuZ2VFcnJvcigiaW52YWxpZCBmcmFtZSIpOwogICAgICAgIHJldHVybiB0aGlzLl9mcmFtZXNbYV0KICAgIH0KICAgIEdldFNwZWVkKCkgewogICAgICAgIHJldHVybiB0aGlzLl9zcGVlZAogICAgfQogICAgSXNMb29waW5nKCkgewogICAgICAgIHJldHVybiB0aGlzLl9pc0xvb3BpbmcKICAgIH0KICAgIEdldFJlcGVhdENvdW50KCkgewogICAgICAgIHJldHVybiB0aGlzLl9yZXBlYXRDb3VudAogICAgfQogICAgR2V0UmVwZWF0VG8oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3JlcGVhdFRvCiAgICB9CiAgICBJc1BpbmdQb25nKCkgewogICAgICAgIHJldHVybiB0aGlzLl9pc1BpbmdQb25nCiAgICB9CiAgICBHZXRJQW5pbWF0aW9uKCkgewogICAgICAgIHJldHVybiB0aGlzLl9pQW5pbWF0aW9uCiAgICB9Cn07CiJ1c2Ugc3RyaWN0IjsKY29uc3QgQzMkanNjb21wJDE1MyA9IHNlbGYuQzM7CkMzJGpzY29tcCQxNTMuQW5pbWF0aW9uRnJhbWVJbmZvID0gY2xhc3MgZXh0ZW5kcyBDMyRqc2NvbXAkMTUzLkRlZmVuZGVkQmFzZSB7CiAgICBjb25zdHJ1Y3RvcihhKSB7CiAgICAgICAgc3VwZXIoKTsKICAgICAgICB0aGlzLl9pbWFnZUluZm8gPSBDMyRqc2NvbXAkMTUzLk5ldyhDMyRqc2NvbXAkMTUzLkltYWdlSW5mbyk7CiAgICAgICAgdGhpcy5faW1hZ2VJbmZvLkxvYWREYXRhKGEpOwogICAgICAgIHRoaXMuX2R1cmF0aW9uID0gYVs3XTsKICAgICAgICB0aGlzLl9vcmlnaW4gPSBDMyRqc2NvbXAkMTUzLk5ldyhDMyRqc2NvbXAkMTUzLlZlY3RvcjIsIGFbOF0sIGFbOV0pOwogICAgICAgIHRoaXMuX2ltYWdlUG9pbnRzID0gYVsxMF0ubWFwKGIgPT4gQzMkanNjb21wJDE1My5OZXcoQzMkanNjb21wJDE1My5JbWFnZVBvaW50LCB0aGlzLCBiKSk7CiAgICAgICAgdGhpcy5faW1hZ2VQb2ludHNCeU5hbWUgPSBuZXcgTWFwOwogICAgICAgIGZvciAoY29uc3QgYiBvZiB0aGlzLl9pbWFnZVBvaW50cykgdGhpcy5faW1hZ2VQb2ludHNCeU5hbWUuc2V0KGIuR2V0TmFtZSgpLnRvTG93ZXJDYXNlKCksIGIpOwogICAgICAgIHRoaXMuX2NvbGxpc2lvblBvbHkgPSBudWxsOwogICAgICAgIGEgPSBhWzExXTsKICAgICAgICA2IDw9IGEubGVuZ3RoICYmICh0aGlzLl9jb2xsaXNpb25Qb2x5ID0gQzMkanNjb21wJDE1My5OZXcoQzMkanNjb21wJDE1My5Db2xsaXNpb25Qb2x5LCBhKSk7CiAgICAgICAgdGhpcy5faUFuaW1hdGlvbkZyYW1lID0gbmV3IHNlbGYuSUFuaW1hdGlvbkZyYW1lKHRoaXMpCiAgICB9CiAgICBSZWxlYXNlKCkgewogICAgICAgIHRoaXMuX2NvbGxpc2lvblBvbHkgJiYgKHRoaXMuX2NvbGxpc2lvblBvbHkuUmVsZWFzZSgpLCB0aGlzLl9jb2xsaXNpb25Qb2x5ID0gbnVsbCk7CiAgICAgICAgdGhpcy5faW1hZ2VJbmZvLlJlbGVhc2UoKTsKICAgICAgICB0aGlzLl9pbWFnZUluZm8gPSBudWxsCiAgICB9CiAgICBHZXRJbWFnZUluZm8oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2ltYWdlSW5mbwogICAgfQogICAgR2V0RHVyYXRpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2R1cmF0aW9uCiAgICB9CiAgICBHZXRPcmlnaW5YKCkgewogICAgICAgIHJldHVybiB0aGlzLl9vcmlnaW4uZ2V0WCgpCiAgICB9CiAgICBHZXRPcmlnaW5ZKCkgewogICAgICAgIHJldHVybiB0aGlzLl9vcmlnaW4uZ2V0WSgpCiAgICB9CiAgICBHZXRDb2xsaXNpb25Qb2x5KCkgewogICAgICAgIHJldHVybiB0aGlzLl9jb2xsaXNpb25Qb2x5CiAgICB9CiAgICBHZXRJbWFnZVBvaW50QnlOYW1lKGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5faW1hZ2VQb2ludHNCeU5hbWUuZ2V0KGEudG9Mb3dlckNhc2UoKSkgfHwKICAgICAgICAgICAgbnVsbAogICAgfQogICAgR2V0SW1hZ2VQb2ludEJ5SW5kZXgoYSkgewogICAgICAgIGEgPSBNYXRoLmZsb29yKGEpOwogICAgICAgIHJldHVybiAwID4gYSB8fCBhID49IHRoaXMuX2ltYWdlUG9pbnRzLmxlbmd0aCA/IG51bGwgOiB0aGlzLl9pbWFnZVBvaW50c1thXQogICAgfQogICAgR2V0SW1hZ2VQb2ludENvdW50KCkgewogICAgICAgIHJldHVybiB0aGlzLl9pbWFnZVBvaW50cy5sZW5ndGgKICAgIH0KICAgIEdldElBbmltYXRpb25GcmFtZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5faUFuaW1hdGlvbkZyYW1lCiAgICB9Cn07CiJ1c2Ugc3RyaWN0IjsKY29uc3QgQzMkanNjb21wJDE1NCA9IHNlbGYuQzM7CkMzJGpzY29tcCQxNTQuSW1hZ2VQb2ludCA9IGNsYXNzIGV4dGVuZHMgQzMkanNjb21wJDE1NC5EZWZlbmRlZEJhc2UgewogICAgY29uc3RydWN0b3IoYSwgYikgewogICAgICAgIHN1cGVyKCk7CiAgICAgICAgdGhpcy5fYWZpID0gYTsKICAgICAgICB0aGlzLl9uYW1lID0gYlswXTsKICAgICAgICB0aGlzLl9wb3MgPSBDMyRqc2NvbXAkMTU0Lk5ldyhDMyRqc2NvbXAkMTU0LlZlY3RvcjIsIGJbMV0sIGJbMl0pCiAgICB9CiAgICBSZWxlYXNlKCkge30KICAgIEdldE5hbWUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX25hbWUKICAgIH0KICAgIEdldFgoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3Bvcy5nZXRYKCkKICAgIH0KICAgIEdldFkoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3Bvcy5nZXRZKCkKICAgIH0KICAgIEdldFZlYzIoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3BvcwogICAgfQp9OwoidXNlIHN0cmljdCI7CmNvbnN0IEMzJGpzY29tcCQxNTUgPSBzZWxmLkMzLAogICAgQzNEZWJ1Z2dlciRqc2NvbXAkMSA9IHNlbGYuQzNEZWJ1Z2dlciwKICAgIElPYmplY3RDbGFzcyRqc2NvbXAkMSA9IHNlbGYuSU9iamVjdENsYXNzOwpDMyRqc2NvbXAkMTU1Lk9iamVjdENsYXNzID0gY2xhc3MgZXh0ZW5kcyBDMyRqc2NvbXAkMTU1LkRlZmVuZGVkQmFzZSB7CiAgICBjb25zdHJ1Y3RvcihhLCBiLCBkKSB7CiAgICAgICAgc3VwZXIoKTsKICAgICAgICBjb25zdCBjID0gYS5HZXRPYmplY3RSZWZlcmVuY2UoZFsxXSk7CiAgICAgICAgdGhpcy5fcnVudGltZSA9IGE7CiAgICAgICAgdGhpcy5fcGx1Z2luID0gYS5HZXRQbHVnaW5NYW5hZ2VyKCkuR2V0UGx1Z2luQnlDb25zdHJ1Y3RvckZ1bmN0aW9uKGMpOwogICAgICAgIHRoaXMuX3Nka1R5cGUgPSBudWxsOwogICAgICAgIHRoaXMuX2luc3RTZGtDdG9yID0gYy5JbnN0YW5jZTsKICAgICAgICB0aGlzLl9pbmRleCA9IGI7CiAgICAgICAgdGhpcy5fc2lkID0gZFsxMV07CiAgICAgICAgdGhpcy5fbmFtZSA9IGRbMF07CiAgICAgICAgdGhpcy5fanNQcm9wTmFtZSA9IHRoaXMuX3J1bnRpbWUuR2V0SnNQcm9wTmFtZShkWzE0XSk7CiAgICAgICAgdGhpcy5faXNHbG9iYWwgPSAhIWRbOV07CiAgICAgICAgdGhpcy5faXNGYW1pbHkgPSAhIWRbMl07CiAgICAgICAgdGhpcy5faXNPbkxvYWRlckxheW91dCA9ICEhZFsxMF07CiAgICAgICAgdGhpcy5faW5zdFZhcnMgPSBkWzNdLm1hcChlID0+ICh7CiAgICAgICAgICAgIHNpZDogZVswXSwKICAgICAgICAgICAgdHlwZTogZVsxXSwKICAgICAgICAgICAgbmFtZTogZVsyXSwKICAgICAgICAgICAganNQcm9wTmFtZTogYS5HZXRKc1Byb3BOYW1lKGVbM10pCiAgICAgICAgfSkpOwogICAgICAgIHRoaXMuX2JlaGF2aW9yc0NvdW50ID0gZFs0XTsKICAgICAgICB0aGlzLl9lZmZlY3RzQ291bnQgPSBkWzVdOwogICAgICAgIHRoaXMuX2lzV29ybGRUeXBlID0gdGhpcy5fcGx1Z2luLklzV29ybGRUeXBlKCk7CiAgICAgICAgdGhpcy5fZWZmZWN0TGlzdCA9IG51bGw7CiAgICAgICAgdGhpcy5fY29sbGlzaW9uR3JpZCA9IEMzJGpzY29tcCQxNTUuTmV3KEMzJGpzY29tcCQxNTUuU3BhcnNlR3JpZCwgYS5HZXRPcmlnaW5hbFZpZXdwb3J0V2lkdGgoKSwgYS5HZXRPcmlnaW5hbFZpZXdwb3J0SGVpZ2h0KCkpOwogICAgICAgIHRoaXMuX2FueUNvbGxpc2lvbkNlbGxDaGFuZ2VkID0gITA7CiAgICAgICAgdGhpcy5fYW55SW5zdGFuY2VQYXJhbGxheGVkID0gITE7CiAgICAgICAgdGhpcy5fZmFtaWx5TWVtYmVyc1NldCA9IHRoaXMuX2ZhbWlseU1lbWJlcnMgPSBudWxsOwogICAgICAgIHRoaXMuX2ZhbWlseUluZGV4ID0gLTE7CiAgICAgICAgdGhpcy5fZmFtaWx5RWZmZWN0TWFwID0gdGhpcy5fZmFtaWx5QmVoYXZpb3JNYXAgPSB0aGlzLl9mYW1pbHlJbnN0VmFyTWFwID0gdGhpcy5fZmFtaWxpZXNTZXQgPSB0aGlzLl9mYW1pbGllcyA9IG51bGw7CiAgICAgICAgdGhpcy5faXNJbkNvbnRhaW5lciA9ICExOwogICAgICAgIHRoaXMuX2NvbnRhaW5lciA9IG51bGw7CiAgICAgICAgdGhpcy5fYmVoYXZpb3JUeXBlcyA9IGRbOF0ubWFwKGUgPT4gQzMkanNjb21wJDE1NS5CZWhhdmlvclR5cGUuQ3JlYXRlKHRoaXMsIGUpKTsKICAgICAgICB0aGlzLl9iZWhhdmlvclR5cGVzSW5jbHVkaW5nSW5oZXJpdGVkID0gW107CiAgICAgICAgdGhpcy5fYmVoYXZpb3JzQnlOYW1lID0gbmV3IE1hcDsKICAgICAgICB0aGlzLl9iZWhhdmlvck5hbWVUb0luZGV4ID0gbmV3IE1hcDsKICAgICAgICB0aGlzLl91c2VkQmVoYXZpb3JDdG9ycyA9IG5ldyBTZXQ7CiAgICAgICAgdGhpcy5fc29sU3RhY2sgPSBDMyRqc2NvbXAkMTU1Lk5ldyhDMyRqc2NvbXAkMTU1LlNvbFN0YWNrLCB0aGlzKTsKICAgICAgICB0aGlzLl9kZWZhdWx0SW5zdGFuY2VEYXRhID0gbnVsbDsKICAgICAgICB0aGlzLl9kZWZhdWx0TGF5ZXJJbmRleCA9IDA7CiAgICAgICAgdGhpcy5faXNDb250YWluZWQgPSAhMTsKICAgICAgICB0aGlzLl9hbmltYXRpb25zQnlTaWQgPSB0aGlzLl9hbmltYXRpb25zQnlOYW1lID0gdGhpcy5fYW5pbWF0aW9ucyA9IHRoaXMuX2ltYWdlSW5mbyA9IHRoaXMuX2NvbnRhaW5lciA9IG51bGw7CiAgICAgICAgdGhpcy5fdGV4dHVyZVJlZkNvdW50ID0gMDsKICAgICAgICB0aGlzLl9zYXZlZERhdGEgPQogICAgICAgICAgICBuZXcgTWFwOwogICAgICAgIHRoaXMuX3Vuc2F2ZWREYXRhID0gbmV3IE1hcDsKICAgICAgICB0aGlzLl9pbnN0YW5jZXMgPSBbXTsKICAgICAgICB0aGlzLl9paWRzU3RhbGUgPSAhMDsKICAgICAgICB0aGlzLl9wbHVnaW4uSGFzRWZmZWN0cygpICYmICh0aGlzLl9lZmZlY3RMaXN0ID0gQzMkanNjb21wJDE1NS5OZXcoQzMkanNjb21wJDE1NS5FZmZlY3RMaXN0LCB0aGlzLCBkWzEyXSkpOwogICAgICAgIGRbNl0gJiYgKHRoaXMuX2ltYWdlSW5mbyA9IEMzJGpzY29tcCQxNTUuTmV3KEMzJGpzY29tcCQxNTUuSW1hZ2VJbmZvKSwgdGhpcy5faW1hZ2VJbmZvLkxvYWREYXRhKGRbNl0pKTsKICAgICAgICBpZiAoZFs3XSkgewogICAgICAgICAgICB0aGlzLl9hbmltYXRpb25zID0gZFs3XS5tYXAoZSA9PiBDMyRqc2NvbXAkMTU1Lk5ldyhDMyRqc2NvbXAkMTU1LkFuaW1hdGlvbkluZm8sIGUpKTsKICAgICAgICAgICAgdGhpcy5fYW5pbWF0aW9uc0J5TmFtZSA9IG5ldyBNYXA7CiAgICAgICAgICAgIHRoaXMuX2FuaW1hdGlvbnNCeVNpZCA9IG5ldyBNYXA7CiAgICAgICAgICAgIGZvciAoY29uc3QgZSBvZiB0aGlzLl9hbmltYXRpb25zKSB0aGlzLl9hbmltYXRpb25zQnlOYW1lLnNldChlLkdldE5hbWUoKS50b0xvd2VyQ2FzZSgpLAogICAgICAgICAgICAgICAgZSksIHRoaXMuX2FuaW1hdGlvbnNCeVNpZC5zZXQoZS5HZXRTSUQoKSwgZSkKICAgICAgICB9CiAgICAgICAgdGhpcy5faXNGYW1pbHkgPyAodGhpcy5fZmFtaWx5TWVtYmVycyA9IFtdLCB0aGlzLl9mYW1pbHlNZW1iZXJzU2V0ID0gbmV3IFNldCwgdGhpcy5fZmFtaWx5SW5kZXggPSB0aGlzLl9ydW50aW1lLl9HZXROZXh0RmFtaWx5SW5kZXgoKSkgOiAodGhpcy5fZmFtaWxpZXMgPSBbXSwgdGhpcy5fZmFtaWxpZXNTZXQgPSBuZXcgU2V0LCB0aGlzLl9mYW1pbHlJbnN0VmFyTWFwID0gW10sIHRoaXMuX2ZhbWlseUJlaGF2aW9yTWFwID0gW10sIHRoaXMuX2ZhbWlseUVmZmVjdE1hcCA9IFtdKTsKICAgICAgICB0aGlzLl9zZGtUeXBlID0gQzMkanNjb21wJDE1NS5OZXcoYy5UeXBlLCB0aGlzLCBkWzE1XSk7CiAgICAgICAgdGhpcy5faW5zdGFuY2VVc2VyU2NyaXB0Q2xhc3MgPSB0aGlzLl9pT2JqZWN0Q2xhc3MgPSBudWxsOwogICAgICAgIHRoaXMuX3VzZXJTY3JpcHREaXNwYXRjaGVyID0gQzMkanNjb21wJDE1NS5OZXcoQzMkanNjb21wJDE1NS5FdmVudC5EaXNwYXRjaGVyKTsKICAgICAgICBpZiAoYiA9IHRoaXMuX3Nka1R5cGUuR2V0U2NyaXB0SW50ZXJmYWNlQ2xhc3MoKSkgewogICAgICAgICAgICBpZiAodGhpcy5faU9iamVjdENsYXNzID0KICAgICAgICAgICAgICAgIG5ldyBiKHRoaXMpLCAhKHRoaXMuX2lPYmplY3RDbGFzcyBpbnN0YW5jZW9mIElPYmplY3RDbGFzcyRqc2NvbXAkMSkpIHRocm93IG5ldyBUeXBlRXJyb3IoInNjcmlwdCBpbnRlcmZhY2UgY2xhc3MgbXVzdCBkZXJpdmUgZnJvbSBJT2JqZWN0Q2xhc3MiKTsKICAgICAgICB9IGVsc2UgdGhpcy5faU9iamVjdENsYXNzID0gbmV3IElPYmplY3RDbGFzcyRqc2NvbXAkMSh0aGlzKTsKICAgICAgICBkWzEzXSAmJiAoYiA9IGRbMTNdKSAmJiB0aGlzLl9zZGtUeXBlLkxvYWRUaWxlbWFwRGF0YShiWzBdLCBiWzFdLCBiWzJdKTsKICAgICAgICB0aGlzLl9ydW50aW1lLlVzZXNMb2FkZXJMYXlvdXQoKSAmJiAhdGhpcy5faXNGYW1pbHkgJiYgIXRoaXMuX2lzT25Mb2FkZXJMYXlvdXQgJiYgdGhpcy5faXNXb3JsZFR5cGUgfHwgdGhpcy5PbkNyZWF0ZSgpOwogICAgICAgIHRoaXMuX3BsdWdpbi5Jc1NpbmdsZUdsb2JhbCgpICYmICh0aGlzLl9wbHVnaW4uX1NldFNpbmdsZUdsb2JhbE9iamVjdENsYXNzKHRoaXMpLCB0aGlzLl9DcmVhdGVTaW5nbGVHbG9iYWxJbnN0YW5jZShkKSkKICAgIH0KICAgIHN0YXRpYyBDcmVhdGUoYSwKICAgICAgICBiLCBkKSB7CiAgICAgICAgcmV0dXJuIEMzJGpzY29tcCQxNTUuTmV3KEMzJGpzY29tcCQxNTUuT2JqZWN0Q2xhc3MsIGEsIGIsIGQpCiAgICB9CiAgICBSZWxlYXNlKCkgewogICAgICAgIHRoaXMuX2ltYWdlSW5mbyAmJiAodGhpcy5faW1hZ2VJbmZvLlJlbGVhc2UoKSwgdGhpcy5faW1hZ2VJbmZvID0gbnVsbCk7CiAgICAgICAgaWYgKHRoaXMuX2FuaW1hdGlvbnMpIHsKICAgICAgICAgICAgZm9yIChjb25zdCBhIG9mIHRoaXMuX2FuaW1hdGlvbnMpIGEuUmVsZWFzZSgpOwogICAgICAgICAgICBDMyRqc2NvbXAkMTU1LmNsZWFyQXJyYXkodGhpcy5fYW5pbWF0aW9ucyk7CiAgICAgICAgICAgIHRoaXMuX2FuaW1hdGlvbnNCeU5hbWUuY2xlYXIoKTsKICAgICAgICAgICAgdGhpcy5fYW5pbWF0aW9uc0J5U2lkLmNsZWFyKCkKICAgICAgICB9CiAgICAgICAgdGhpcy5fc29sU3RhY2suUmVsZWFzZSgpOwogICAgICAgIHRoaXMuX3NvbFN0YWNrID0gbnVsbDsKICAgICAgICB0aGlzLl9zYXZlZERhdGEuY2xlYXIoKTsKICAgICAgICB0aGlzLl91bnNhdmVkRGF0YS5jbGVhcigpOwogICAgICAgIHRoaXMuX3J1bnRpbWUgPSB0aGlzLl9jb250YWluZXIgPSBudWxsCiAgICB9CiAgICBfTG9hZEZhbWlseShhKSB7CiAgICAgICAgZm9yIChsZXQgYiA9IDEsIGQgPSBhLmxlbmd0aDsgYiA8IGQ7ICsrYikgewogICAgICAgICAgICBjb25zdCBjID0gdGhpcy5fcnVudGltZS5HZXRPYmplY3RDbGFzc0J5SW5kZXgoYVtiXSk7CiAgICAgICAgICAgIHRoaXMuX2ZhbWlseU1lbWJlcnMucHVzaChjKTsKICAgICAgICAgICAgdGhpcy5fZmFtaWx5TWVtYmVyc1NldC5hZGQoYyk7CiAgICAgICAgICAgIGMuX2ZhbWlsaWVzLnB1c2godGhpcyk7CiAgICAgICAgICAgIGMuX2ZhbWlsaWVzU2V0LmFkZCh0aGlzKQogICAgICAgIH0KICAgIH0KICAgIF9TZXRDb250YWluZXIoYSkgewogICAgICAgIHRoaXMuX2lzSW5Db250YWluZXIgPSAhMDsKICAgICAgICB0aGlzLl9jb250YWluZXIgPSBhCiAgICB9CiAgICBJc0luQ29udGFpbmVyKCkgewogICAgICAgIHJldHVybiB0aGlzLl9pc0luQ29udGFpbmVyCiAgICB9CiAgICBHZXRDb250YWluZXIoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2NvbnRhaW5lcgogICAgfQogICAgX09uQWZ0ZXJDcmVhdGUoKSB7CiAgICAgICAgdmFyIGEgPSAwOwogICAgICAgIGlmICghdGhpcy5faXNGYW1pbHkpCiAgICAgICAgICAgIGZvciAodmFyIGIgb2YgdGhpcy5fZmFtaWxpZXMpCiAgICAgICAgICAgICAgICBmb3IgKHZhciBkIG9mIGIuR2V0QmVoYXZpb3JUeXBlcygpKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZyA9IGQuR2V0TmFtZSgpLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYmVoYXZpb3JzQnlOYW1lLnNldChnLCBkKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9iZWhhdmlvck5hbWVUb0luZGV4LnNldChnLCBhKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9iZWhhdmlvclR5cGVzSW5jbHVkaW5nSW5oZXJpdGVkLnB1c2goZCk7CiAgICAgICAgICAgICAgICAgICAgKythCiAgICAgICAgICAgICAgICB9CiAgICAgICAgZm9yICh2YXIgYyBvZiB0aGlzLkdldEJlaGF2aW9yVHlwZXMoKSkgYiA9CiAgICAgICAgICAgIGMuR2V0TmFtZSgpLnRvTG93ZXJDYXNlKCksIHRoaXMuX2JlaGF2aW9yc0J5TmFtZS5zZXQoYiwgYyksIHRoaXMuX2JlaGF2aW9yTmFtZVRvSW5kZXguc2V0KGIsIGEpLCB0aGlzLl9iZWhhdmlvclR5cGVzSW5jbHVkaW5nSW5oZXJpdGVkLnB1c2goYyksICsrYTsKICAgICAgICBmb3IgKHZhciBlIG9mIHRoaXMuX2JlaGF2aW9yVHlwZXNJbmNsdWRpbmdJbmhlcml0ZWQpIHRoaXMuX3VzZWRCZWhhdmlvckN0b3JzLmFkZChlLkdldEJlaGF2aW9yKCkuY29uc3RydWN0b3IpOwogICAgICAgIGlmICghdGhpcy5faXNGYW1pbHkgJiYgdGhpcy5fZmFtaWxpZXMubGVuZ3RoKSB7CiAgICAgICAgICAgIGEgPSB0aGlzLl9ydW50aW1lLkdldEZhbWlseUNvdW50KCk7CiAgICAgICAgICAgIEMzJGpzY29tcCQxNTUuZXh0ZW5kQXJyYXkodGhpcy5fZmFtaWx5SW5zdFZhck1hcCwgYSwgMCk7CiAgICAgICAgICAgIEMzJGpzY29tcCQxNTUuZXh0ZW5kQXJyYXkodGhpcy5fZmFtaWx5QmVoYXZpb3JNYXAsIGEsIDApOwogICAgICAgICAgICBDMyRqc2NvbXAkMTU1LmV4dGVuZEFycmF5KHRoaXMuX2ZhbWlseUVmZmVjdE1hcCwgYSwgMCk7CiAgICAgICAgICAgIGEgPSBbXTsKICAgICAgICAgICAgYiA9IGUgPSBjID0gMDsKICAgICAgICAgICAgZm9yIChjb25zdCBnIG9mIHRoaXMuX2ZhbWlsaWVzKQogICAgICAgICAgICAgICAgaWYgKGQgPSBnLkdldEZhbWlseUluZGV4KCksIHRoaXMuX2ZhbWlseUluc3RWYXJNYXBbZF0gPSBjLCBjICs9IGcuR2V0SW5zdGFuY2VWYXJpYWJsZXNDb3VudCgpLCB0aGlzLl9mYW1pbHlCZWhhdmlvck1hcFtkXSA9IGUsIGUgKz0gZy5HZXRCZWhhdmlvclR5cGVzQ291bnQoKSwgdGhpcy5fZmFtaWx5RWZmZWN0TWFwW2RdID0gYiwgYiArPSBnLkdldEVmZmVjdFR5cGVzQ291bnQoKSwgKGQgPSBnLkdldEVmZmVjdExpc3QoKSkgJiYgdGhpcy5fZWZmZWN0TGlzdCkKICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGsgb2YgZC5HZXRBbGxFZmZlY3RUeXBlcygpKSBhLnB1c2goay5DbG9uZSh0aGlzLl9lZmZlY3RMaXN0KSk7CiAgICAgICAgICAgIHRoaXMuX2VmZmVjdExpc3QgJiYgdGhpcy5fZWZmZWN0TGlzdC5QcmVwZW5kRWZmZWN0VHlwZXMoYSkKICAgICAgICB9CiAgICB9CiAgICBfQ3JlYXRlU2luZ2xlR2xvYmFsSW5zdGFuY2UoYSkgewogICAgICAgIGNvbnN0IGIgPSB0aGlzLl9ydW50aW1lLl9HZXROZXdVSUQoKSwKICAgICAgICAgICAgZCA9IEMzJGpzY29tcCQxNTUuTmV3KEMzJGpzY29tcCQxNTUuSW5zdGFuY2UsIHsKICAgICAgICAgICAgICAgIHJ1bnRpbWU6IHRoaXMuX3J1bnRpbWUsCiAgICAgICAgICAgICAgICBvYmplY3RUeXBlOiB0aGlzLAogICAgICAgICAgICAgICAgdWlkOiBiCiAgICAgICAgICAgIH0pOwogICAgICAgIGQuX0NyZWF0ZVNka0luc3RhbmNlKGFbMTZdLCBbXSk7CiAgICAgICAgdGhpcy5fcnVudGltZS5fTWFwSW5zdGFuY2VCeVVJRChiLCBkKTsKICAgICAgICB0aGlzLl9pbnN0YW5jZXMucHVzaChkKQogICAgfQogICAgR2V0U2RrVHlwZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fc2RrVHlwZQogICAgfQogICAgSXNPbkxvYWRlckxheW91dCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5faXNPbkxvYWRlckxheW91dAogICAgfQogICAgT25DcmVhdGUoKSB7CiAgICAgICAgdGhpcy5faXNGYW1pbHkgfHwgdGhpcy5fc2RrVHlwZS5PbkNyZWF0ZSgpCiAgICB9CiAgICBIYXNMb2FkZWRUZXh0dXJlcygpIHsKICAgICAgICByZXR1cm4gMCA8IHRoaXMuX3RleHR1cmVSZWZDb3VudAogICAgfQogICAgTG9hZFRleHR1cmVzKGEpIHsKICAgICAgICBpZiAodGhpcy5faXNGYW1pbHkpIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTsKICAgICAgICB0aGlzLl90ZXh0dXJlUmVmQ291bnQrKzsKICAgICAgICByZXR1cm4gMSA9PT0gdGhpcy5fdGV4dHVyZVJlZkNvdW50ID8gdGhpcy5fc2RrVHlwZS5Mb2FkVGV4dHVyZXMoYSkgfHwgUHJvbWlzZS5yZXNvbHZlKCkgOiBQcm9taXNlLnJlc29sdmUoKQogICAgfQogICAgUmVsZWFzZVRleHR1cmVzKCkgewogICAgICAgIGlmICghdGhpcy5faXNGYW1pbHkpIHsKICAgICAgICAgICAgdGhpcy5fdGV4dHVyZVJlZkNvdW50LS07CiAgICAgICAgICAgIGlmICgwID4gdGhpcy5fdGV4dHVyZVJlZkNvdW50KSB0aHJvdyBFcnJvcigicmVsZWFzZWQgdGV4dHVyZXMgdG9vIG1hbnkgdGltZXMiKTsKICAgICAgICAgICAgMCA9PT0gdGhpcy5fdGV4dHVyZVJlZkNvdW50ICYmIHRoaXMuX3Nka1R5cGUuUmVsZWFzZVRleHR1cmVzKCkKICAgICAgICB9CiAgICB9CiAgICBPbkR5bmFtaWNUZXh0dXJlTG9hZENvbXBsZXRlKCkgewogICAgICAgIGlmICh0aGlzLl9pc0ZhbWlseSkgdGhyb3cgRXJyb3IoIm5vdCBhcHBsaWNhYmxlIHRvIGZhbWlseSIpOwogICAgICAgIHRoaXMuX3Nka1R5cGUuT25EeW5hbWljVGV4dHVyZUxvYWRDb21wbGV0ZSgpCiAgICB9CiAgICBQcmVsb2FkVGV4dHVyZXNXaXRoSW5zdGFuY2VzKGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5faXNGYW1pbHkgPyBQcm9taXNlLnJlc29sdmUoKSA6IHRoaXMuX3Nka1R5cGUuUHJlbG9hZFRleHR1cmVzV2l0aEluc3RhbmNlcyhhKQogICAgfQogICAgR2V0UnVudGltZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcnVudGltZQogICAgfQogICAgR2V0UGx1Z2luKCkgewogICAgICAgIHJldHVybiB0aGlzLl9wbHVnaW4KICAgIH0KICAgIEdldEluc3RhbmNlU2RrQ3RvcigpIHsKICAgICAgICByZXR1cm4gdGhpcy5faW5zdFNka0N0b3IKICAgIH0KICAgIEdldE5hbWUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX25hbWUKICAgIH0KICAgIEdldEpzUHJvcE5hbWUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2pzUHJvcE5hbWUKICAgIH0KICAgIEdldEluZGV4KCkgewogICAgICAgIHJldHVybiB0aGlzLl9pbmRleAogICAgfQogICAgR2V0U0lEKCkgewogICAgICAgIHJldHVybiB0aGlzLl9zaWQKICAgIH0KICAgIElzRmFtaWx5KCkgewogICAgICAgIHJldHVybiB0aGlzLl9pc0ZhbWlseQogICAgfQogICAgSXNHbG9iYWwoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2lzR2xvYmFsCiAgICB9CiAgICBJc1dvcmxkVHlwZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5faXNXb3JsZFR5cGUKICAgIH0KICAgIEdldEZhbWlseUluZGV4KCkgewogICAgICAgIHJldHVybiB0aGlzLl9mYW1pbHlJbmRleAogICAgfQogICAgR2V0QmVoYXZpb3JUeXBlcygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fYmVoYXZpb3JUeXBlcwogICAgfQogICAgR2V0QmVoYXZpb3JUeXBlc0NvdW50KCkgewogICAgICAgIHJldHVybiB0aGlzLl9iZWhhdmlvcnNDb3VudAogICAgfQogICAgVXNlc0JlaGF2aW9yQnlDdG9yKGEpIHsKICAgICAgICByZXR1cm4gYSAmJgogICAgICAgICAgICB0aGlzLl91c2VkQmVoYXZpb3JDdG9ycy5oYXMoYSkKICAgIH0KICAgIEdldEluc3RhbmNlVmFyaWFibGVzQ291bnQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2luc3RWYXJzLmxlbmd0aAogICAgfQogICAgR2V0SW5zdGFuY2VWYXJpYWJsZVNJRHMoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2luc3RWYXJzLm1hcChhID0+IGEuc2lkKQogICAgfQogICAgR2V0SW5zdGFuY2VWYXJpYWJsZUluZGV4QnlTSUQoYSkgewogICAgICAgIHJldHVybiB0aGlzLl9pbnN0VmFycy5maW5kSW5kZXgoYiA9PiBiLnNpZCA9PT0gYSkKICAgIH0KICAgIEdldEluc3RhbmNlVmFyaWFibGVJbmRleEJ5TmFtZShhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2luc3RWYXJzLmZpbmRJbmRleChiID0+IGIubmFtZSA9PT0gYSkKICAgIH0KICAgIF9HZXRBbGxJbnN0YW5jZVZhcmlhYmxlTmFtZXMoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2luc3RWYXJzLm1hcChhID0+IGEubmFtZSkKICAgIH0KICAgIF9HZXRBbGxJbnN0YW5jZVZhcmlhYmxlSnNQcm9wTmFtZXMoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2luc3RWYXJzLm1hcChhID0+IGEuanNQcm9wTmFtZSkKICAgIH0KICAgIEdldEluc3RhbmNlVmFyaWFibGVUeXBlKGEpIHsKICAgICAgICBhID0gTWF0aC5mbG9vcihhKTsKICAgICAgICBpZiAoMCA+IGEgfHwgYSA+PSB0aGlzLl9pbnN0VmFycy5sZW5ndGgpIHRocm93IG5ldyBSYW5nZUVycm9yKCJpbnZhbGlkIGluc3RhbmNlIHZhcmlhYmxlIGluZGV4Iik7CiAgICAgICAgcmV0dXJuIHRoaXMuX2luc3RWYXJzW2FdLnR5cGUKICAgIH0KICAgIEdldEluc3RhbmNlVmFyaWFibGVOYW1lKGEpIHsKICAgICAgICBhID0gTWF0aC5mbG9vcihhKTsKICAgICAgICBpZiAoMCA+IGEgfHwgYSA+PSB0aGlzLl9pbnN0VmFycy5sZW5ndGgpIHRocm93IG5ldyBSYW5nZUVycm9yKCJpbnZhbGlkIGluc3RhbmNlIHZhcmlhYmxlIGluZGV4Iik7CiAgICAgICAgcmV0dXJuIHRoaXMuX2luc3RWYXJzW2FdLm5hbWUKICAgIH0KICAgIEdldEVmZmVjdFR5cGVzQ291bnQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2VmZmVjdHNDb3VudAogICAgfQogICAgR2V0QmVoYXZpb3JUeXBlc0luY2x1ZGluZ0luaGVyaXRlZCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fYmVoYXZpb3JUeXBlc0luY2x1ZGluZ0luaGVyaXRlZAogICAgfQogICAgR2V0QmVoYXZpb3JUeXBlQnlOYW1lKGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5fYmVoYXZpb3JzQnlOYW1lLmdldChhLnRvTG93ZXJDYXNlKCkpIHx8IG51bGwKICAgIH0KICAgIEdldEJlaGF2aW9ySW5kZXhCeU5hbWUoYSkgewogICAgICAgIGEgPQogICAgICAgICAgICB0aGlzLl9iZWhhdmlvck5hbWVUb0luZGV4LmdldChhLnRvTG93ZXJDYXNlKCkpOwogICAgICAgIHJldHVybiAidW5kZWZpbmVkIiA9PT0gdHlwZW9mIGEgPyAtMSA6IGEKICAgIH0KICAgIEdldEVmZmVjdExpc3QoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2VmZmVjdExpc3QKICAgIH0KICAgIEhhc0VmZmVjdHMoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3BsdWdpbi5IYXNFZmZlY3RzKCkKICAgIH0KICAgIFVzZXNFZmZlY3RzKCkgewogICAgICAgIHJldHVybiB0aGlzLl9lZmZlY3RMaXN0ICYmIHRoaXMuX2VmZmVjdExpc3QuSGFzQW55RWZmZWN0VHlwZSgpCiAgICB9CiAgICBHZXRTb2xTdGFjaygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fc29sU3RhY2sKICAgIH0KICAgIEdldEN1cnJlbnRTb2woKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3NvbFN0YWNrLkdldEN1cnJlbnRTb2woKQogICAgfQogICAgR2V0SW1hZ2VJbmZvKCkgewogICAgICAgIHJldHVybiB0aGlzLl9pbWFnZUluZm8KICAgIH0KICAgIFNldERlZmF1bHRJbnN0YW5jZURhdGEoYSkgewogICAgICAgIHRoaXMuX2RlZmF1bHRJbnN0YW5jZURhdGEgPSBhCiAgICB9CiAgICBHZXREZWZhdWx0SW5zdGFuY2VEYXRhKCkgewogICAgICAgIHJldHVybiB0aGlzLl9kZWZhdWx0SW5zdGFuY2VEYXRhCiAgICB9CiAgICBfU2V0RGVmYXVsdExheWVySW5kZXgoYSkgewogICAgICAgIHRoaXMuX2RlZmF1bHRMYXllckluZGV4ID0KICAgICAgICAgICAgYQogICAgfQogICAgR2V0RGVmYXVsdExheWVySW5kZXgoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2RlZmF1bHRMYXllckluZGV4CiAgICB9CiAgICBHZXRBbmltYXRpb25zKCkgewogICAgICAgIHJldHVybiB0aGlzLl9hbmltYXRpb25zCiAgICB9CiAgICBHZXRBbmltYXRpb25Db3VudCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fYW5pbWF0aW9ucy5sZW5ndGgKICAgIH0KICAgIEdldEZhbWlsaWVzKCkgewogICAgICAgIHJldHVybiB0aGlzLl9mYW1pbGllcwogICAgfQogICAgQmVsb25nc1RvRmFtaWx5KGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZmFtaWxpZXNTZXQuaGFzKGEpCiAgICB9CiAgICBHZXRGYW1pbHlNZW1iZXJzKCkgewogICAgICAgIHJldHVybiB0aGlzLl9mYW1pbHlNZW1iZXJzCiAgICB9CiAgICBGYW1pbHlIYXNNZW1iZXIoYSkgewogICAgICAgIHJldHVybiB0aGlzLl9mYW1pbHlNZW1iZXJzU2V0LmhhcyhhKQogICAgfQogICAgR2V0RmFtaWx5QmVoYXZpb3JPZmZzZXQoYSkgewogICAgICAgIHJldHVybiB0aGlzLl9mYW1pbHlCZWhhdmlvck1hcFthXQogICAgfQogICAgR2V0RmFtaWx5SW5zdGFuY2VWYXJpYWJsZU9mZnNldChhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2ZhbWlseUluc3RWYXJNYXBbYV0KICAgIH0KICAgIEdldEFuaW1hdGlvbkJ5TmFtZShhKSB7CiAgICAgICAgaWYgKCF0aGlzLl9hbmltYXRpb25zKSB0aHJvdyBFcnJvcigibm8gYW5pbWF0aW9ucyIpOwogICAgICAgIHJldHVybiB0aGlzLl9hbmltYXRpb25zQnlOYW1lLmdldChhLnRvTG93ZXJDYXNlKCkpIHx8IG51bGwKICAgIH0KICAgIEdldEFuaW1hdGlvbkJ5U0lEKGEpIHsKICAgICAgICBpZiAoIXRoaXMuX2FuaW1hdGlvbnMpIHRocm93IEVycm9yKCJubyBhbmltYXRpb25zIik7CiAgICAgICAgcmV0dXJuIHRoaXMuX2FuaW1hdGlvbnNCeVNpZC5nZXQoYSkgfHwgbnVsbAogICAgfQogICAgR2V0Rmlyc3RBbmltYXRpb25GcmFtZSgpIHsKICAgICAgICBpZiAoIXRoaXMuX2FuaW1hdGlvbnMpIHRocm93IEVycm9yKCJubyBhbmltYXRpb25zIik7CiAgICAgICAgcmV0dXJuIHRoaXMuX2FuaW1hdGlvbnNbMF0uR2V0RnJhbWVBdCgwKQogICAgfQogICAgR2V0RGVmYXVsdEluc3RhbmNlU2l6ZSgpIHsKICAgICAgICBpZiAodGhpcy5fYW5pbWF0aW9ucykgewogICAgICAgICAgICBjb25zdCBhID0gdGhpcy5HZXRGaXJzdEFuaW1hdGlvbkZyYW1lKCkuR2V0SW1hZ2VJbmZvKCk7CiAgICAgICAgICAgIHJldHVybiBbYS5HZXRXaWR0aCgpLCBhLkdldEhlaWdodCgpXQogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpcy5faW1hZ2VJbmZvID8gW3RoaXMuX2ltYWdlSW5mby5HZXRXaWR0aCgpLCB0aGlzLl9pbWFnZUluZm8uR2V0SGVpZ2h0KCldIDogWzEwMCwKICAgICAgICAgICAgMTAwCiAgICAgICAgXQogICAgfQogICAgR2V0U2luZ2xlR2xvYmFsSW5zdGFuY2UoKSB7CiAgICAgICAgaWYgKCF0aGlzLl9wbHVnaW4uSXNTaW5nbGVHbG9iYWwoKSkgdGhyb3cgRXJyb3IoIm5vdCBhIHNpbmdsZS1nbG9iYWwgcGx1Z2luIik7CiAgICAgICAgcmV0dXJuIHRoaXMuX2luc3RhbmNlc1swXQogICAgfQogICAgR2V0SW5zdGFuY2VzKCkgewogICAgICAgIHJldHVybiB0aGlzLl9pbnN0YW5jZXMKICAgIH0qIGluc3RhbmNlcygpIHsKICAgICAgICB5aWVsZCogdGhpcy5faW5zdGFuY2VzCiAgICB9KiBpbnN0YW5jZXNJbmNsdWRpbmdQZW5kaW5nQ3JlYXRlKCkgewogICAgICAgIHlpZWxkKiB0aGlzLl9pbnN0YW5jZXM7CiAgICAgICAgeWllbGQqIHRoaXMuX3J1bnRpbWUuaW5zdGFuY2VzUGVuZGluZ0NyZWF0ZUZvck9iamVjdENsYXNzKHRoaXMpCiAgICB9CiAgICBHZXRJbnN0YW5jZUNvdW50KCkgewogICAgICAgIHJldHVybiB0aGlzLl9pbnN0YW5jZXMubGVuZ3RoCiAgICB9CiAgICBfQWRkSW5zdGFuY2UoYSkgewogICAgICAgIHRoaXMuX2luc3RhbmNlcy5wdXNoKGEpCiAgICB9CiAgICBfU2V0SUlEc1N0YWxlKCkgewogICAgICAgIHRoaXMuX2lpZHNTdGFsZSA9ICEwCiAgICB9CiAgICBfVXBkYXRlSUlEcygpIHsKICAgICAgICBpZiAodGhpcy5faWlkc1N0YWxlICYmICF0aGlzLl9pc0ZhbWlseSkgewogICAgICAgICAgICB2YXIgYSA9CiAgICAgICAgICAgICAgICB0aGlzLl9pbnN0YW5jZXMsCiAgICAgICAgICAgICAgICBiID0gMDsKICAgICAgICAgICAgZm9yIChsZXQgZCA9IGEubGVuZ3RoOyBiIDwgZDsgKytiKSBhW2JdLl9TZXRJSUQoYik7CiAgICAgICAgICAgIGEgPSB0aGlzLl9ydW50aW1lLl9HZXRJbnN0YW5jZXNQZW5kaW5nQ3JlYXRlKCk7CiAgICAgICAgICAgIGZvciAoY29uc3QgZCBvZiBhKSBkLkdldE9iamVjdENsYXNzKCkgPT09IHRoaXMgJiYgZC5fU2V0SUlEKGIrKyk7CiAgICAgICAgICAgIHRoaXMuX2lpZHNTdGFsZSA9ICExCiAgICAgICAgfQogICAgfQogICAgR2V0SW5zdGFuY2VCeUlJRChhKSB7CiAgICAgICAgdmFyIGIgPSB0aGlzLl9pbnN0YW5jZXM7CiAgICAgICAgaWYgKGEgPCBiLmxlbmd0aCkgcmV0dXJuIGJbYV07CiAgICAgICAgYSAtPSBiLmxlbmd0aDsKICAgICAgICBiID0gdGhpcy5fcnVudGltZS5fR2V0SW5zdGFuY2VzUGVuZGluZ0NyZWF0ZSgpOwogICAgICAgIGZvciAoY29uc3QgZCBvZiBiKQogICAgICAgICAgICBpZiAoZC5HZXRPYmplY3RDbGFzcygpID09PSB0aGlzKSB7CiAgICAgICAgICAgICAgICBpZiAoMCA9PT0gYSkgcmV0dXJuIGQ7CiAgICAgICAgICAgICAgICAtLWEKICAgICAgICAgICAgfQogICAgICAgIHJldHVybiBudWxsCiAgICB9CiAgICBHZXRGaXJzdFBpY2tlZChhKSB7CiAgICAgICAgaWYgKGEgJiYgYS5Jc0luQ29udGFpbmVyKCkgJiYgYS5HZXRPYmplY3RDbGFzcygpICE9PSB0aGlzKQogICAgICAgICAgICBmb3IgKGNvbnN0IGIgb2YgYS5zaWJsaW5ncygpKQogICAgICAgICAgICAgICAgaWYgKGIuR2V0T2JqZWN0Q2xhc3MoKSA9PT0KICAgICAgICAgICAgICAgICAgICB0aGlzKSByZXR1cm4gYjsKICAgICAgICBhID0gdGhpcy5HZXRDdXJyZW50U29sKCkuR2V0SW5zdGFuY2VzKCk7CiAgICAgICAgcmV0dXJuIGEubGVuZ3RoID8gYVswXSA6IG51bGwKICAgIH0KICAgIEdldFBhaXJlZEluc3RhbmNlKGEpIHsKICAgICAgICBjb25zdCBiID0gdGhpcy5HZXRDdXJyZW50U29sKCkuR2V0SW5zdGFuY2VzKCk7CiAgICAgICAgcmV0dXJuIDAgPCBiLmxlbmd0aCA/IGJbYS5HZXRJSUQoKSAlIGIubGVuZ3RoXSA6IG51bGwKICAgIH0qIGFsbENvcnJlc3BvbmRpbmdJbnN0YW5jZXMoYSwgYikgewogICAgICAgIGNvbnN0IGQgPSB0aGlzLkdldEN1cnJlbnRTb2woKS5HZXRJbnN0YW5jZXMoKTsKICAgICAgICB2YXIgYyA9IGQubGVuZ3RoOwogICAgICAgIGNvbnN0IGUgPSBiLkdldEN1cnJlbnRTb2woKSwKICAgICAgICAgICAgZyA9IGIuR2V0Q3VycmVudFNvbCgpLkdldEluc3RhbmNlcygpLAogICAgICAgICAgICBrID0gZy5sZW5ndGg7CiAgICAgICAgdmFyIG0gPSBhLkdldElJRCgpOwogICAgICAgIGlmIChiLklzRmFtaWx5KCkgfHwgIWUuSXNTZWxlY3RBbGwoKSkgbSA9IGcuaW5kZXhPZihhKTsKICAgICAgICBhID0gTWF0aC5jZWlsKGMgLyBrKTsKICAgICAgICBjICU9IGs7CiAgICAgICAgMCA9PT0gYyB8fCBtIDwgYyA/IChtICo9IGEsIGMgPSBhKSA6IChtID0gYyAqIGEgKyAobSAtIGMpICogKGEgLSAxKSwgYyA9IGEgLSAxKTsKICAgICAgICBmb3IgKGxldCBuID0gbSwgcSA9CiAgICAgICAgICAgICAgICBtICsgYzsgbiA8IHE7ICsrbikgeWllbGQgZFtuXQogICAgfQogICAgRmluaXNoQ29uZGl0aW9uKGEpIHsKICAgICAgICB0aGlzLl9zZGtUeXBlLkZpbmlzaENvbmRpdGlvbihhKQogICAgfQogICAgQXBwbHlTb2xUb0NvbnRhaW5lcigpIHsKICAgICAgICBpZiAodGhpcy5faXNJbkNvbnRhaW5lciAmJiAhdGhpcy5faXNGYW1pbHkpIHsKICAgICAgICAgICAgdGhpcy5fVXBkYXRlSUlEcygpOwogICAgICAgICAgICB2YXIgYSA9IHRoaXMuR2V0Q3VycmVudFNvbCgpLAogICAgICAgICAgICAgICAgYiA9IGEuX0dldE93bkluc3RhbmNlcygpLAogICAgICAgICAgICAgICAgZCA9IGEuSXNTZWxlY3RBbGwoKSwKICAgICAgICAgICAgICAgIGMgPSB0aGlzLl9ydW50aW1lLkdldEN1cnJlbnRFdmVudFN0YWNrRnJhbWUoKTsKICAgICAgICAgICAgYyA9IGMgJiYgYy5HZXRDdXJyZW50RXZlbnQoKSAmJiBjLkdldEN1cnJlbnRFdmVudCgpLklzT3JCbG9jaygpOwogICAgICAgICAgICBmb3IgKGNvbnN0IGsgb2YgdGhpcy5fY29udGFpbmVyLm9iamVjdFR5cGVzKCkpCiAgICAgICAgICAgICAgICBpZiAoayAhPT0gdGhpcykgewogICAgICAgICAgICAgICAgICAgIGsuX1VwZGF0ZUlJRHMoKTsKICAgICAgICAgICAgICAgICAgICB2YXIgZSA9IGsuR2V0Q3VycmVudFNvbCgpOwogICAgICAgICAgICAgICAgICAgIGUuX1NldFNlbGVjdEFsbChkKTsKICAgICAgICAgICAgICAgICAgICBpZiAoIWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGcgPSBlLl9HZXRPd25JbnN0YW5jZXMoKTsKICAgICAgICAgICAgICAgICAgICAgICAgQzMkanNjb21wJDE1NS5jbGVhckFycmF5KGcpOwogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IG0gb2YgYikgZy5wdXNoKGsuR2V0SW5zdGFuY2VCeUlJRChtLkdldElJRCgpKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnID0gYS5fR2V0T3duRWxzZUluc3RhbmNlcygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZSA9IGUuX0dldE93bkVsc2VJbnN0YW5jZXMoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEMzJGpzY29tcCQxNTUuY2xlYXJBcnJheShlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgbSBvZiBnKSBlLnB1c2goay5HZXRJbnN0YW5jZUJ5SUlEKG0uR2V0SUlEKCkpKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIF9UcnVuY2F0ZUNvbnRhaW5lclNvbHMoYSwgYikgewogICAgICAgIGZvciAoY29uc3QgZCBvZiB0aGlzLkdldENvbnRhaW5lcigpLm9iamVjdFR5cGVzKCkpIHsKICAgICAgICAgICAgY29uc3QgYyA9IGQuR2V0Q3VycmVudFNvbCgpOwogICAgICAgICAgICBhID8gQzMkanNjb21wJDE1NS50cnVuY2F0ZUFycmF5KGMuX0dldE93bkVsc2VJbnN0YW5jZXMoKSwgYikgOiBDMyRqc2NvbXAkMTU1LnRydW5jYXRlQXJyYXkoYy5fR2V0T3duSW5zdGFuY2VzKCksIGIpCiAgICAgICAgfQogICAgfQogICAgX0dldENvbGxpc2lvbkNlbGxHcmlkKCkgewogICAgICAgIHJldHVybiB0aGlzLl9jb2xsaXNpb25HcmlkCiAgICB9CiAgICBfU2V0QW55Q29sbGlzaW9uQ2VsbENoYW5nZWQoYSkgewogICAgICAgIHRoaXMuX2FueUNvbGxpc2lvbkNlbGxDaGFuZ2VkID0gISFhCiAgICB9CiAgICBfU2V0QW55SW5zdGFuY2VQYXJhbGxheGVkKGEpIHsKICAgICAgICB0aGlzLl9hbnlJbnN0YW5jZVBhcmFsbGF4ZWQgPSAhIWEKICAgIH0KICAgIElzQW55SW5zdGFuY2VQYXJhbGxheGVkKCkgewogICAgICAgIHJldHVybiB0aGlzLl9hbnlJbnN0YW5jZVBhcmFsbGF4ZWQKICAgIH0KICAgIF9VcGRhdGVBbGxDb2xsaXNpb25DZWxscygpIHsKICAgICAgICBpZiAodGhpcy5fYW55Q29sbGlzaW9uQ2VsbENoYW5nZWQgJiYgdGhpcy5faXNXb3JsZFR5cGUpIHsKICAgICAgICAgICAgZm9yIChjb25zdCBhIG9mIHRoaXMuX2luc3RhbmNlcykgYS5HZXRXb3JsZEluZm8oKS5fVXBkYXRlQ29sbGlzaW9uQ2VsbCgpOwogICAgICAgICAgICBmb3IgKGNvbnN0IGEgb2YgdGhpcy5fcnVudGltZS5fR2V0SW5zdGFuY2VzUGVuZGluZ0NyZWF0ZSgpKSBhLkdldE9iamVjdENsYXNzKCkgPT09IHRoaXMgJiYgYS5HZXRXb3JsZEluZm8oKS5fVXBkYXRlQ29sbGlzaW9uQ2VsbCgpOwogICAgICAgICAgICB0aGlzLl9hbnlDb2xsaXNpb25DZWxsQ2hhbmdlZCA9ICExCiAgICAgICAgfQogICAgfQogICAgR2V0U2F2ZWREYXRhTWFwKCkgewogICAgICAgIHRoaXMuX3NhdmVkRGF0YSB8fCAodGhpcy5fc2F2ZWREYXRhID0gbmV3IE1hcCk7CiAgICAgICAgcmV0dXJuIHRoaXMuX3NhdmVkRGF0YQogICAgfQogICAgR2V0VW5zYXZlZERhdGFNYXAoKSB7CiAgICAgICAgdGhpcy5fdW5zYXZlZERhdGEgfHwKICAgICAgICAgICAgKHRoaXMuX3Vuc2F2ZWREYXRhID0gbmV3IE1hcCk7CiAgICAgICAgcmV0dXJuIHRoaXMuX3Vuc2F2ZWREYXRhCiAgICB9CiAgICBIYXNTb2xpZEJlaGF2aW9yKCkgewogICAgICAgIHJldHVybiB0aGlzLlVzZXNCZWhhdmlvckJ5Q3RvcihDMyRqc2NvbXAkMTU1LkJlaGF2aW9ycy5zb2xpZCkKICAgIH0KICAgIEhhc0p1bXB0aHJ1QmVoYXZpb3IoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuVXNlc0JlaGF2aW9yQnlDdG9yKEMzJGpzY29tcCQxNTUuQmVoYXZpb3JzLmp1bXB0aHJ1KQogICAgfQogICAgSGFzTm9TYXZlQmVoYXZpb3IoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuVXNlc0JlaGF2aW9yQnlDdG9yKEMzJGpzY29tcCQxNTUuQmVoYXZpb3JzLk5vU2F2ZSkKICAgIH0KICAgIEhhc1BlcnNpc3RCZWhhdmlvcigpIHsKICAgICAgICByZXR1cm4gdGhpcy5Vc2VzQmVoYXZpb3JCeUN0b3IoQzMkanNjb21wJDE1NS5CZWhhdmlvcnMuUGVyc2lzdCkKICAgIH0KICAgIF9TYXZlVG9Kc29uKCkgewogICAgICAgIGNvbnN0IGEgPSB7CiAgICAgICAgICAgIGluc3RhbmNlczogdGhpcy5faW5zdGFuY2VzLm1hcChiID0+IGIuU2F2ZVRvSnNvbigpKQogICAgICAgIH07CiAgICAgICAgdGhpcy5fc2F2ZWREYXRhICYmIHRoaXMuX3NhdmVkRGF0YS5zaXplICYmCiAgICAgICAgICAgIChhLmV4ID0gQzMkanNjb21wJDE1NS5Ub1N1cGVySlNPTih0aGlzLl9zYXZlZERhdGEpKTsKICAgICAgICByZXR1cm4gYQogICAgfQogICAgX0xvYWRGcm9tSnNvbihhKSB7CiAgICAgICAgdGhpcy5fc2F2ZWREYXRhICYmICh0aGlzLl9zYXZlZERhdGEuY2xlYXIoKSwgdGhpcy5fc2F2ZWREYXRhID0gbnVsbCk7CiAgICAgICAgdmFyIGIgPSBhLmV4OwogICAgICAgIGIgJiYgKHRoaXMuX3NhdmVkRGF0YSA9IEMzJGpzY29tcCQxNTUuRnJvbVN1cGVySlNPTihiKSk7CiAgICAgICAgYiA9IHRoaXMuX2luc3RhbmNlczsKICAgICAgICBhID0gYS5pbnN0YW5jZXM7CiAgICAgICAgZm9yIChsZXQgZCA9IDAsIGMgPSBNYXRoLm1pbihiLmxlbmd0aCwgYS5sZW5ndGgpOyBkIDwgYzsgKytkKSBiW2RdLkxvYWRGcm9tSnNvbihhW2RdKTsKICAgICAgICBmb3IgKGxldCBkID0gYS5sZW5ndGgsIGMgPSBiLmxlbmd0aDsgZCA8IGM7ICsrZCkgdGhpcy5fcnVudGltZS5EZXN0cm95SW5zdGFuY2UoYltkXSk7CiAgICAgICAgZm9yIChsZXQgZCA9IGIubGVuZ3RoLCBjID0gYS5sZW5ndGg7IGQgPCBjOyArK2QpIHsKICAgICAgICAgICAgYiA9IGFbZF07CiAgICAgICAgICAgIGxldCBlID0gbnVsbDsKICAgICAgICAgICAgaWYgKHRoaXMuSXNXb3JsZFR5cGUoKSAmJiAoZSA9IHRoaXMuX3J1bnRpbWUuR2V0TWFpblJ1bm5pbmdMYXlvdXQoKS5HZXRMYXllckJ5U0lEKGIudy5sKSwgIWUpKSBjb250aW51ZTsKICAgICAgICAgICAgdGhpcy5fcnVudGltZS5DcmVhdGVJbnN0YW5jZUZyb21EYXRhKHRoaXMuX2RlZmF1bHRJbnN0YW5jZURhdGEgfHwgdGhpcywgZSwgITEsIDAsIDAsICEwKS5Mb2FkRnJvbUpzb24oYikKICAgICAgICB9CiAgICAgICAgdGhpcy5fU2V0SUlEc1N0YWxlKCkKICAgIH0KICAgIF9TZXR1cFNjZW5lR3JhcGhDb25uZWN0aW9uc09uQ2hhbmdlT2ZMYXlvdXQoKSB7CiAgICAgICAgZm9yIChsZXQgYSA9IDAsIGIgPSB0aGlzLl9pbnN0YW5jZXM7IGEgPCBiOyArK2EpIHRoaXMuX2luc3RhbmNlc1thXS5fU2V0dXBTY2VuZUdyYXBoQ29ubmVjdGlvbnNPbkNoYW5nZU9mTGF5b3V0KCkKICAgIH0KICAgIEdldElPYmplY3RDbGFzcygpIHsKICAgICAgICByZXR1cm4gdGhpcy5faU9iamVjdENsYXNzCiAgICB9CiAgICBVc2VyU2NyaXB0RGlzcGF0Y2hlcigpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdXNlclNjcmlwdERpc3BhdGNoZXIKICAgIH0KICAgIF9HZXRVc2VyU2NyaXB0SW5zdGFuY2VDbGFzcygpIHsKICAgICAgICByZXR1cm4gdGhpcy5faW5zdGFuY2VVc2VyU2NyaXB0Q2xhc3MKICAgIH0KICAgIF9TZXRVc2VyU2NyaXB0SW5zdGFuY2VDbGFzcyhhKSB7CiAgICAgICAgdGhpcy5faW5zdGFuY2VVc2VyU2NyaXB0Q2xhc3MgPQogICAgICAgICAgICBhCiAgICB9CiAgICBEaXNwYXRjaFVzZXJTY3JpcHRFdmVudChhKSB7CiAgICAgICAgdmFyIGIgPSB0aGlzLl9ydW50aW1lOwogICAgICAgIChiID0gYi5Jc0RlYnVnKCkgJiYgIWIuR2V0RXZlbnRTaGVldE1hbmFnZXIoKS5Jc0luRXZlbnRFbmdpbmUoKSkgJiYgQzNEZWJ1Z2dlciRqc2NvbXAkMS5TdGFydE1lYXN1cmluZ1NjcmlwdFRpbWUoKTsKICAgICAgICB0aGlzLl91c2VyU2NyaXB0RGlzcGF0Y2hlci5kaXNwYXRjaEV2ZW50KGEpOwogICAgICAgIGIgJiYgQzNEZWJ1Z2dlciRqc2NvbXAkMS5BZGRTY3JpcHRUaW1lKCkKICAgIH0KfTsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkMTU2ID0gc2VsZi5DMzsKQzMkanNjb21wJDE1Ni5Db250YWluZXIgPSBjbGFzcyBleHRlbmRzIEMzJGpzY29tcCQxNTYuRGVmZW5kZWRCYXNlIHsKICAgIGNvbnN0cnVjdG9yKGEsIGIpIHsKICAgICAgICBzdXBlcigpOwogICAgICAgIHRoaXMuX3J1bnRpbWUgPSBhOwogICAgICAgIHRoaXMuX29iamVjdFR5cGVzID0gYjsKICAgICAgICBmb3IgKGNvbnN0IGQgb2YgdGhpcy5fb2JqZWN0VHlwZXMpIGQuX1NldENvbnRhaW5lcih0aGlzKQogICAgfQogICAgUmVsZWFzZSgpIHsKICAgICAgICB0aGlzLl9ydW50aW1lID0gbnVsbAogICAgfQogICAgR2V0UnVudGltZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcnVudGltZQogICAgfQogICAgR2V0T2JqZWN0VHlwZXMoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX29iamVjdFR5cGVzCiAgICB9CiAgICBvYmplY3RUeXBlcygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fb2JqZWN0VHlwZXMKICAgIH0KICAgIEhhc0FueVdvcmxkVHlwZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fb2JqZWN0VHlwZXMuc29tZShhID0+IGEuSXNXb3JsZFR5cGUoKSkKICAgIH0KfTsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkMTU3ID0gc2VsZi5DMywKICAgIEMzRGVidWdnZXIkanNjb21wJDIgPSBzZWxmLkMzRGVidWdnZXIsCiAgICBJSW5zdGFuY2UkanNjb21wJDIgPSBzZWxmLklJbnN0YW5jZSwKICAgIEVNUFRZX0FSUkFZJGpzY29tcCQxID0gW107CmxldCBuZXh0UHVpZCA9IDA7CmNvbnN0IHNhdmVkRGF0YU1hcHMgPSBuZXcgV2Vha01hcCwKICAgIHVuc2F2ZWREYXRhTWFwcyA9IG5ldyBXZWFrTWFwLAogICAgRkxBR19ERVNUUk9ZRUQgPSAxLAogICAgRkxBR19USUxFTUFQID0gMiwKICAgIEZMQUdfTVVTVF9QUkVEUkFXID0gNCwKICAgIEZMQUdfU09MSURfRU5BQkxFRCA9IDgsCiAgICBGTEFHX0pVTVBUSFJVX0VOQUJMRUQgPSAxNiwKICAgIEZMQUdfTVVTVF9NSVRJR0FURV9aX0ZJR0hUSU5HID0gMzIsCiAgICBGTEFHX0lTX0RSQVdJTkdfV0lUSF9FRkZFQ1RTID0gNjQ7CkMzJGpzY29tcCQxNTcuSW5zdGFuY2UgPSBjbGFzcyBleHRlbmRzIEMzJGpzY29tcCQxNTcuRGVmZW5kZWRCYXNlIHsKICAgIGNvbnN0cnVjdG9yKGEpIHsKICAgICAgICBzdXBlcigpOwogICAgICAgIHRoaXMuX3J1bnRpbWUgPSBhLnJ1bnRpbWU7CiAgICAgICAgdGhpcy5fb2JqZWN0VHlwZSA9IGEub2JqZWN0VHlwZTsKICAgICAgICB0aGlzLl9pU2NyaXB0SW50ZXJmYWNlID0gdGhpcy5fc2RrSW5zdCA9IHRoaXMuX3dvcmxkSW5mbyA9IG51bGw7CiAgICAgICAgdGhpcy5faWlkID0gMDsKICAgICAgICB0aGlzLl91aWQgPSBhLnVpZDsKICAgICAgICB0aGlzLl9wdWlkID0gbmV4dFB1aWQrKzsKICAgICAgICB0aGlzLl9mbGFncyA9IDA7CiAgICAgICAgdGhpcy5fYmVoYXZpb3JJbnN0YW5jZXMgPSB0aGlzLl9pbnN0VmFyVmFsdWVzID0gRU1QVFlfQVJSQVkkanNjb21wJDE7CiAgICAgICAgdmFyIGIgPSB0aGlzLl9vYmplY3RUeXBlLkdldEJlaGF2aW9yVHlwZXNJbmNsdWRpbmdJbmhlcml0ZWQoKTsKICAgICAgICAwIDwgYi5sZW5ndGggJiYgKHRoaXMuX2JlaGF2aW9ySW5zdGFuY2VzID0gYi5tYXAoKGQsIGMpID0+IEMzJGpzY29tcCQxNTcuTmV3KEMzJGpzY29tcCQxNTcuQmVoYXZpb3JJbnN0YW5jZSwgewogICAgICAgICAgICBydW50aW1lOiB0aGlzLl9ydW50aW1lLAogICAgICAgICAgICBiZWhhdmlvclR5cGU6IGQsCiAgICAgICAgICAgIGluc3RhbmNlOiB0aGlzLAogICAgICAgICAgICBpbmRleDogYwogICAgICAgIH0pKSk7CiAgICAgICAgdGhpcy5fc2libGluZ3MgPSB0aGlzLl9vYmplY3RUeXBlLklzSW5Db250YWluZXIoKSA/IFtdIDogbnVsbDsKICAgICAgICB0aGlzLl90aW1lU2NhbGUgPSAtMTsKICAgICAgICB0aGlzLl9kaXNwYXRjaGVyID0gbnVsbDsKICAgICAgICBiID0gdGhpcy5HZXRQbHVnaW4oKTsKICAgICAgICBiLk11c3RQcmVEcmF3KCkgJiYgKHRoaXMuX2ZsYWdzIHw9IEZMQUdfTVVTVF9QUkVEUkFXKTsKICAgICAgICBpZiAoYi5Jc1dvcmxkVHlwZSgpKQogICAgICAgICAgICBpZiAodGhpcy5fd29ybGRJbmZvID0gQzMkanNjb21wJDE1Ny5OZXcoQzMkanNjb21wJDE1Ny5Xb3JsZEluZm8sIHRoaXMsIGEubGF5ZXIpLCBhLndvcmxkRGF0YSkgdGhpcy5fd29ybGRJbmZvLkluaXQoYS53b3JsZERhdGEpOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuX3dvcmxkSW5mby5Jbml0Tm9EYXRhKCk7CiAgICAgICAgICAgICAgICBjb25zdCBbZCwgY10gPSB0aGlzLl9vYmplY3RUeXBlLkdldERlZmF1bHRJbnN0YW5jZVNpemUoKTsKICAgICAgICAgICAgICAgIHRoaXMuX3dvcmxkSW5mby5TZXRTaXplKGQsIGMpOwogICAgICAgICAgICAgICAgdGhpcy5HZXRPYmplY3RDbGFzcygpLlVzZXNFZmZlY3RzKCkgJiYKICAgICAgICAgICAgICAgICAgICB0aGlzLl93b3JsZEluZm8uR2V0SW5zdGFuY2VFZmZlY3RMaXN0KCkuTG9hZERlZmF1bHRFZmZlY3RQYXJhbWV0ZXJzKCkKICAgICAgICAgICAgfQogICAgICAgIGEuaW5zdFZhckRhdGEgPyB0aGlzLl9Mb2FkSW5zdGFuY2VWYXJpYWJsZURhdGEoYS5pbnN0VmFyRGF0YSkgOiB0aGlzLl9Mb2FkRGVmYXVsdEluc3RhbmNlVmFyaWFibGVzKCkKICAgIH0KICAgIFJlbGVhc2UoKSB7CiAgICAgICAgdGhpcy5faVNjcmlwdEludGVyZmFjZSAmJiAodGhpcy5faVNjcmlwdEludGVyZmFjZS5fUmVsZWFzZSgpLCB0aGlzLl9pU2NyaXB0SW50ZXJmYWNlID0gbnVsbCk7CiAgICAgICAgaWYgKDAgPCB0aGlzLl9iZWhhdmlvckluc3RhbmNlcy5sZW5ndGgpIHsKICAgICAgICAgICAgZm9yICh2YXIgYSBvZiB0aGlzLl9iZWhhdmlvckluc3RhbmNlcykgYS5SZWxlYXNlKCk7CiAgICAgICAgICAgIEMzJGpzY29tcCQxNTcuY2xlYXJBcnJheSh0aGlzLl9iZWhhdmlvckluc3RhbmNlcykKICAgICAgICB9CiAgICAgICAgdGhpcy5fc2RrSW5zdC5SZWxlYXNlKCk7CiAgICAgICAgdGhpcy5fc2RrSW5zdCA9IG51bGw7CiAgICAgICAgaWYgKGEgPSBzYXZlZERhdGFNYXBzLmdldCh0aGlzKSkgYS5jbGVhcigpLCBzYXZlZERhdGFNYXBzLmRlbGV0ZSh0aGlzKTsKICAgICAgICBpZiAoYSA9IHVuc2F2ZWREYXRhTWFwcy5nZXQodGhpcykpIGEuY2xlYXIoKSwgdW5zYXZlZERhdGFNYXBzLmRlbGV0ZSh0aGlzKTsKICAgICAgICB0aGlzLl9zaWJsaW5ncyAmJiBDMyRqc2NvbXAkMTU3LmNsZWFyQXJyYXkodGhpcy5fc2libGluZ3MpOwogICAgICAgIHRoaXMuX2Rpc3BhdGNoZXIgJiYgKHRoaXMuX2Rpc3BhdGNoZXIuUmVsZWFzZSgpLCB0aGlzLl9kaXNwYXRjaGVyID0gbnVsbCk7CiAgICAgICAgdGhpcy5fb2JqZWN0VHlwZSA9IHRoaXMuX3J1bnRpbWUgPSBudWxsOwogICAgICAgIDAgPCB0aGlzLl9pbnN0VmFyVmFsdWVzLmxlbmd0aCAmJiBDMyRqc2NvbXAkMTU3LmNsZWFyQXJyYXkodGhpcy5faW5zdFZhclZhbHVlcyk7CiAgICAgICAgdGhpcy5fd29ybGRJbmZvICYmICh0aGlzLl93b3JsZEluZm8uUmVsZWFzZSgpLCB0aGlzLl93b3JsZEluZm8gPSBudWxsKQogICAgfQogICAgX0xvYWRJbnN0YW5jZVZhcmlhYmxlRGF0YShhKSB7CiAgICAgICAgMCA8IGEubGVuZ3RoICYmICh0aGlzLl9pbnN0VmFyVmFsdWVzID0gW10sIEMzJGpzY29tcCQxNTcuc2hhbGxvd0Fzc2lnbkFycmF5KHRoaXMuX2luc3RWYXJWYWx1ZXMsIGEpKQogICAgfQogICAgX0xvYWREZWZhdWx0SW5zdGFuY2VWYXJpYWJsZXMoKSB7CiAgICAgICAgY29uc3QgYSA9CiAgICAgICAgICAgIHRoaXMuX29iamVjdFR5cGUuR2V0SW5zdGFuY2VWYXJpYWJsZXNDb3VudCgpOwogICAgICAgIGlmICgwICE9PSBhKSB7CiAgICAgICAgICAgIHRoaXMuX2luc3RWYXJWYWx1ZXMgPSBbXTsKICAgICAgICAgICAgdmFyIGIgPSBbMCwgMCwgIiJdOwogICAgICAgICAgICBmb3IgKGxldCBkID0gMDsgZCA8IGE7ICsrZCkgdGhpcy5faW5zdFZhclZhbHVlcy5wdXNoKGJbdGhpcy5fb2JqZWN0VHlwZS5HZXRJbnN0YW5jZVZhcmlhYmxlVHlwZShkKV0pCiAgICAgICAgfQogICAgfQogICAgX0NyZWF0ZVNka0luc3RhbmNlKGEsIGIpIHsKICAgICAgICBpZiAodGhpcy5fc2RrSW5zdCkgdGhyb3cgRXJyb3IoImFscmVhZHkgZ290IHNkayBpbnN0YW5jZSIpOwogICAgICAgIGZvciAobGV0IGQgPSAwLCBjID0gdGhpcy5fYmVoYXZpb3JJbnN0YW5jZXMubGVuZ3RoOyBkIDwgYzsgKytkKSB0aGlzLl9iZWhhdmlvckluc3RhbmNlc1tkXS5fQ3JlYXRlU2RrSW5zdGFuY2UoYiA/IGJbZF0gOiBudWxsKTsKICAgICAgICB0aGlzLl9zZGtJbnN0ID0gQzMkanNjb21wJDE1Ny5OZXcodGhpcy5fb2JqZWN0VHlwZS5HZXRJbnN0YW5jZVNka0N0b3IoKSwgdGhpcywgYSk7CiAgICAgICAgaWYgKCEodGhpcy5fc2RrSW5zdCBpbnN0YW5jZW9mIEMzJGpzY29tcCQxNTcuU0RLSW5zdGFuY2VCYXNlKSkgdGhyb3cgRXJyb3IoInNkayB0eXBlIG11c3QgZGVyaXZlIGZyb20gU0RLSW5zdGFuY2VCYXNlIik7CiAgICAgICAgZm9yIChsZXQgZCA9IDAsIGMgPSB0aGlzLl9iZWhhdmlvckluc3RhbmNlcy5sZW5ndGg7IGQgPCBjOyArK2QpIHRoaXMuX2JlaGF2aW9ySW5zdGFuY2VzW2RdLlBvc3RDcmVhdGUoKTsKICAgICAgICB0aGlzLl9vYmplY3RUeXBlLl9HZXRVc2VyU2NyaXB0SW5zdGFuY2VDbGFzcygpICYmIHRoaXMuX0luaXRVc2VyU2NyaXB0SW50ZXJmYWNlKCkKICAgIH0KICAgIEdldFNka0luc3RhbmNlKCkgewogICAgICAgIHJldHVybiB0aGlzLl9zZGtJbnN0CiAgICB9CiAgICBHZXRXb3JsZEluZm8oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3dvcmxkSW5mbwogICAgfQogICAgR2V0UnVudGltZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcnVudGltZQogICAgfQogICAgR2V0VGltZVNjYWxlKCkgewogICAgICAgIHJldHVybiB0aGlzLl90aW1lU2NhbGUKICAgIH0KICAgIEdldEFjdGl2ZVRpbWVTY2FsZSgpIHsKICAgICAgICBjb25zdCBhID0gdGhpcy5fdGltZVNjYWxlOwogICAgICAgIHJldHVybiAtMSA9PT0gYSA/IHRoaXMuR2V0UnVudGltZSgpLkdldFRpbWVTY2FsZSgpIDogYQogICAgfQogICAgU2V0VGltZVNjYWxlKGEpIHsKICAgICAgICBhID0gK2E7CiAgICAgICAgaWYgKDAgPiBhIHx8ICFpc0Zpbml0ZShhKSkgYSA9IDA7CiAgICAgICAgdGhpcy5fdGltZVNjYWxlID0gYTsKICAgICAgICB0aGlzLkdldE9iamVjdENsYXNzKCkuVXNlc0VmZmVjdHMoKSAmJgogICAgICAgICAgICB0aGlzLl9ydW50aW1lLl9TZXRUcmFja2luZ0luc3RhbmNlVGltZSh0aGlzLCAhMCkKICAgIH0KICAgIFJlc3RvcmVUaW1lU2NhbGUoKSB7CiAgICAgICAgdGhpcy5fdGltZVNjYWxlID0gLTE7CiAgICAgICAgdGhpcy5HZXRPYmplY3RDbGFzcygpLlVzZXNFZmZlY3RzKCkgJiYgdGhpcy5fcnVudGltZS5fU2V0VHJhY2tpbmdJbnN0YW5jZVRpbWUodGhpcywgITEpCiAgICB9CiAgICBHZXRJbnN0YW5jZUdhbWVUaW1lKCkgewogICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lLl9HZXRJbnN0YW5jZUdhbWVUaW1lKHRoaXMpCiAgICB9CiAgICBEaXNwYXRjaGVyKCkgewogICAgICAgIHRoaXMuX2Rpc3BhdGNoZXIgfHwgKHRoaXMuX2Rpc3BhdGNoZXIgPSBDMyRqc2NvbXAkMTU3Lk5ldyhDMyRqc2NvbXAkMTU3LkV2ZW50LkRpc3BhdGNoZXIpKTsKICAgICAgICByZXR1cm4gdGhpcy5fZGlzcGF0Y2hlcgogICAgfQogICAgRHJhdyhhKSB7CiAgICAgICAgdGhpcy5fc2RrSW5zdC5EcmF3KGEpCiAgICB9CiAgICBPbkNyZWF0ZShhKSB7CiAgICAgICAgdGhpcy5fc2RrSW5zdC5PbkNyZWF0ZShhKQogICAgfQogICAgX1NldEhhc1RpbGVtYXAoKSB7CiAgICAgICAgdGhpcy5fZmxhZ3MgfD0gRkxBR19USUxFTUFQCiAgICB9CiAgICBIYXNUaWxlbWFwKCkgewogICAgICAgIHJldHVybiAwICE9PSAodGhpcy5fZmxhZ3MgJgogICAgICAgICAgICBGTEFHX1RJTEVNQVApCiAgICB9CiAgICBfTWFya0Rlc3Ryb3llZCgpIHsKICAgICAgICB0aGlzLl9mbGFncyB8PSBGTEFHX0RFU1RST1lFRAogICAgfQogICAgSXNEZXN0cm95ZWQoKSB7CiAgICAgICAgcmV0dXJuIDAgIT09ICh0aGlzLl9mbGFncyAmIEZMQUdfREVTVFJPWUVEKQogICAgfQogICAgTXVzdFByZURyYXcoKSB7CiAgICAgICAgcmV0dXJuIDAgIT09ICh0aGlzLl9mbGFncyAmIEZMQUdfTVVTVF9QUkVEUkFXKQogICAgfQogICAgU2V0TXVzdE1pdGlnYXRlWkZpZ2h0aW5nKCkgewogICAgICAgIHRoaXMuX2ZsYWdzIHw9IEZMQUdfTVVTVF9NSVRJR0FURV9aX0ZJR0hUSU5HCiAgICB9CiAgICBNdXN0TWl0aWdhdGVaRmlnaHRpbmcoKSB7CiAgICAgICAgcmV0dXJuIDAgIT09ICh0aGlzLl9mbGFncyAmIEZMQUdfTVVTVF9NSVRJR0FURV9aX0ZJR0hUSU5HKQogICAgfQogICAgX0lzU29saWRFbmFibGVkKCkgewogICAgICAgIHJldHVybiAwICE9PSAodGhpcy5fZmxhZ3MgJiBGTEFHX1NPTElEX0VOQUJMRUQpCiAgICB9CiAgICBfU2V0U29saWRFbmFibGVkKGEpIHsKICAgICAgICB0aGlzLl9mbGFncyA9IGEgPyB0aGlzLl9mbGFncyB8IEZMQUdfU09MSURfRU5BQkxFRCA6IHRoaXMuX2ZsYWdzICYgfkZMQUdfU09MSURfRU5BQkxFRAogICAgfQogICAgX0lzSnVtcHRocnVFbmFibGVkKCkgewogICAgICAgIHJldHVybiAwICE9PQogICAgICAgICAgICAodGhpcy5fZmxhZ3MgJiBGTEFHX0pVTVBUSFJVX0VOQUJMRUQpCiAgICB9CiAgICBfU2V0SnVtcHRocnVFbmFibGVkKGEpIHsKICAgICAgICB0aGlzLl9mbGFncyA9IGEgPyB0aGlzLl9mbGFncyB8IEZMQUdfSlVNUFRIUlVfRU5BQkxFRCA6IHRoaXMuX2ZsYWdzICYgfkZMQUdfSlVNUFRIUlVfRU5BQkxFRAogICAgfQogICAgX0lzRHJhd2luZ1dpdGhFZmZlY3RzKCkgewogICAgICAgIHJldHVybiAwICE9PSAodGhpcy5fZmxhZ3MgJiBGTEFHX0lTX0RSQVdJTkdfV0lUSF9FRkZFQ1RTKQogICAgfQogICAgX1NldElzRHJhd2luZ1dpdGhFZmZlY3RzKGEpIHsKICAgICAgICB0aGlzLl9mbGFncyA9IGEgPyB0aGlzLl9mbGFncyB8IEZMQUdfSVNfRFJBV0lOR19XSVRIX0VGRkVDVFMgOiB0aGlzLl9mbGFncyAmIH5GTEFHX0lTX0RSQVdJTkdfV0lUSF9FRkZFQ1RTCiAgICB9CiAgICBTZXRGbGFnKGEsIGIpIHsKICAgICAgICBhIDw8PSAxNjsKICAgICAgICB0aGlzLl9mbGFncyA9IGIgPyB0aGlzLl9mbGFncyB8IGEgOiB0aGlzLl9mbGFncyAmIH5hCiAgICB9CiAgICBHZXRGbGFnKGEpIHsKICAgICAgICByZXR1cm4gMCAhPT0gKHRoaXMuX2ZsYWdzICYgYSA8PCAxNikKICAgIH0KICAgIEdldEN1cnJlbnRJbWFnZUluZm8oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3Nka0luc3QuR2V0Q3VycmVudEltYWdlSW5mbygpCiAgICB9CiAgICBHZXRDdXJyZW50U3VyZmFjZVNpemUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3Nka0luc3QuR2V0Q3VycmVudFN1cmZhY2VTaXplKCkKICAgIH0KICAgIEdldEN1cnJlbnRUZXhSZWN0KCkgewogICAgICAgIHJldHVybiB0aGlzLl9zZGtJbnN0LkdldEN1cnJlbnRUZXhSZWN0KCkKICAgIH0KICAgIEdldEN1cnJlbnRUZXhRdWFkKCkgewogICAgICAgIHJldHVybiB0aGlzLl9zZGtJbnN0LkdldEN1cnJlbnRUZXhRdWFkKCkKICAgIH0KICAgIElzQ3VycmVudFRleFJvdGF0ZWQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3Nka0luc3QuSXNDdXJyZW50VGV4Um90YXRlZCgpCiAgICB9CiAgICBHZXRJbWFnZVBvaW50KGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5fc2RrSW5zdC5HZXRJbWFnZVBvaW50KGEpCiAgICB9CiAgICBHZXRPYmplY3RDbGFzcygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fb2JqZWN0VHlwZQogICAgfQogICAgUmVuZGVyc1RvT3duWlBsYW5lKCkgewogICAgICAgIHJldHVybiB0aGlzLl9zZGtJbnN0LlJlbmRlcnNUb093blpQbGFuZSgpCiAgICB9CiAgICBCZWxvbmdzVG9PYmplY3RDbGFzcyhhKSB7CiAgICAgICAgcmV0dXJuIGEuSXNGYW1pbHkoKSA/CiAgICAgICAgICAgIGEuRmFtaWx5SGFzTWVtYmVyKHRoaXMuR2V0T2JqZWN0Q2xhc3MoKSkgOiB0aGlzLkdldE9iamVjdENsYXNzKCkgPT09IGEKICAgIH0KICAgIENvbGxlY3RJbnN0YW5jZXNUb1BpY2soYSwgYiwgZCkgewogICAgICAgIGNvbnN0IGMgPSAoZSwgZykgPT4gewogICAgICAgICAgICBnID0gZyB8fCBlLkdldE9iamVjdENsYXNzKCk7CiAgICAgICAgICAgIGNvbnN0IGsgPSBhLmdldChnKTsKICAgICAgICAgICAgayA/IGsuYWRkKGUpIDogYS5zZXQoZywgbmV3IFNldChbZV0pKQogICAgICAgIH07CiAgICAgICAgYyh0aGlzLCBiKTsKICAgICAgICBpZiAodGhpcy5Jc0luQ29udGFpbmVyKCkpCiAgICAgICAgICAgIGZvciAoY29uc3QgZSBvZiB0aGlzLnNpYmxpbmdzKCkpIGMoZSk7CiAgICAgICAgaWYgKGQpCiAgICAgICAgICAgIGZvciAoY29uc3QgZSBvZiB0aGlzLmFsbENoaWxkcmVuKCkpIGMoZSkKICAgIH0KICAgIFZlcmlmeVN1cHBvcnRzU2NlbmVHcmFwaCgpIHsKICAgICAgICBpZiAoIXRoaXMuR2V0UGx1Z2luKCkuU3VwcG9ydHNTY2VuZUdyYXBoKCkpIHRocm93IEVycm9yKCJvYmplY3QgZG9lcyBub3Qgc3VwcG9ydCBzY2VuZSBncmFwaCIpOwogICAgfQogICAgSGFzUGFyZW50KCkgewogICAgICAgIHJldHVybiBudWxsICE9PSB0aGlzLkdldFBhcmVudCgpCiAgICB9CiAgICBHZXRQYXJlbnQoKSB7CiAgICAgICAgdmFyIGEgPSB0aGlzLkdldFdvcmxkSW5mbygpOwogICAgICAgIHJldHVybiBhID8gKGEgPSBhLkdldFBhcmVudCgpKSA/IGEuR2V0SW5zdGFuY2UoKSA6IG51bGwgOiBudWxsCiAgICB9CiAgICBHZXRUb3BQYXJlbnQoKSB7CiAgICAgICAgdmFyIGEgPSB0aGlzLkdldFdvcmxkSW5mbygpOwogICAgICAgIHJldHVybiBhID8gKGEgPSBhLkdldFRvcFBhcmVudCgpKSA/IGEuR2V0SW5zdGFuY2UoKSA6IG51bGwgOiBudWxsCiAgICB9KiBwYXJlbnRzKCkgewogICAgICAgIGNvbnN0IGEgPSB0aGlzLkdldFdvcmxkSW5mbygpOwogICAgICAgIGlmIChhKQogICAgICAgICAgICBmb3IgKGNvbnN0IGIgb2YgYS5wYXJlbnRzKCkpIHlpZWxkIGIuR2V0SW5zdGFuY2UoKQogICAgfQogICAgSGFzQ2hpbGQoYSkgewogICAgICAgIGlmICghYSkgcmV0dXJuICExOwogICAgICAgIGZvciAoY29uc3QgYiBvZiB0aGlzLmNoaWxkcmVuKCkpCiAgICAgICAgICAgIGlmIChiID09PSBhKSByZXR1cm4gITA7CiAgICAgICAgcmV0dXJuICExCiAgICB9CiAgICBIYXNDaGlsZHJlbigpIHsKICAgICAgICBjb25zdCBhID0gdGhpcy5HZXRXb3JsZEluZm8oKTsKICAgICAgICByZXR1cm4gYSA/IGEuSGFzQ2hpbGRyZW4oKSA6ICExCiAgICB9CiAgICBHZXRDaGlsZHJlbk9mT2JqZWN0Q2xhc3MoYSkgewogICAgICAgIGNvbnN0IGIgPSB0aGlzLkdldFdvcmxkSW5mbygpOwogICAgICAgIGlmICghYikgcmV0dXJuIFtdOwogICAgICAgIGNvbnN0IGQgPSBhLkdldE5hbWUoKTsKICAgICAgICByZXR1cm4gYi5HZXRDaGlsZHJlbigpLm1hcChjID0+CiAgICAgICAgICAgIGMuR2V0SW5zdGFuY2UoKSkuZmlsdGVyKGMgPT4gYy5HZXRPYmplY3RDbGFzcygpLkdldE5hbWUoKSA9PT0gZCkKICAgIH0KICAgIEdldENoaWxkcmVuKCkgewogICAgICAgIGNvbnN0IGEgPSB0aGlzLkdldFdvcmxkSW5mbygpOwogICAgICAgIHJldHVybiBhID8gYS5HZXRDaGlsZHJlbigpLm1hcChiID0+IGIuR2V0SW5zdGFuY2UoKSkgOiBbXQogICAgfSogY2hpbGRyZW4oKSB7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgaWYgKGEpCiAgICAgICAgICAgIGZvciAoY29uc3QgYiBvZiBhLmNoaWxkcmVuKCkpIHlpZWxkIGIuR2V0SW5zdGFuY2UoKQogICAgfSogYWxsQ2hpbGRyZW4oKSB7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgaWYgKGEpCiAgICAgICAgICAgIGZvciAoY29uc3QgYiBvZiBhLmFsbENoaWxkcmVuKCkpIHlpZWxkIGIuR2V0SW5zdGFuY2UoKQogICAgfQogICAgR2V0Q2hpbGRDb3VudCgpIHsKICAgICAgICBjb25zdCBhID0gdGhpcy5HZXRXb3JsZEluZm8oKTsKICAgICAgICByZXR1cm4gYSA/IGEuR2V0Q2hpbGRDb3VudCgpIDogMAogICAgfQogICAgR2V0UGFyZW50Q291bnQoKSB7CiAgICAgICAgcmV0dXJuIFsuLi50aGlzLnBhcmVudHMoKV0ubGVuZ3RoCiAgICB9CiAgICBHZXRBbGxDaGlsZENvdW50KCkgewogICAgICAgIGNvbnN0IGEgPQogICAgICAgICAgICB0aGlzLkdldFdvcmxkSW5mbygpOwogICAgICAgIHJldHVybiBhID8gYS5HZXRBbGxDaGlsZENvdW50KCkgOiAwCiAgICB9CiAgICBHZXRDaGlsZEF0KGEpIHsKICAgICAgICBjb25zdCBiID0gdGhpcy5HZXRXb3JsZEluZm8oKTsKICAgICAgICByZXR1cm4gYiA/IChhID0gYi5HZXRDaGlsZEF0KGEpKSA/IGEuR2V0SW5zdGFuY2UoKSA6IG51bGwgOiBudWxsCiAgICB9CiAgICBBZGRDaGlsZChhLCBiKSB7CiAgICAgICAgdGhpcy5WZXJpZnlTdXBwb3J0c1NjZW5lR3JhcGgoKTsKICAgICAgICBhLlZlcmlmeVN1cHBvcnRzU2NlbmVHcmFwaCgpOwogICAgICAgIHRoaXMuR2V0V29ybGRJbmZvKCkuQWRkQ2hpbGQoYS5HZXRXb3JsZEluZm8oKSwgYiB8fCB7fSkKICAgIH0KICAgIFJlbW92ZUNoaWxkKGEpIHsKICAgICAgICBjb25zdCBiID0gdGhpcy5HZXRXb3JsZEluZm8oKTsKICAgICAgICBiICYmIGIuUmVtb3ZlQ2hpbGQoYS5HZXRXb3JsZEluZm8oKSkKICAgIH0KICAgIEdldERlc3Ryb3lXaXRoUGFyZW50KCkgewogICAgICAgIGNvbnN0IGEgPSB0aGlzLkdldFdvcmxkSW5mbygpOwogICAgICAgIHJldHVybiBhID8gYS5HZXREZXN0cm95V2l0aFBhcmVudCgpIDogITEKICAgIH0KICAgIFNldHVwSW5pdGlhbFNjZW5lR3JhcGhDb25uZWN0aW9ucygpIHsKICAgICAgICB2YXIgYSA9IHRoaXMuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgaWYgKGEgJiYgKGEgPSBhLkdldFNjZW5lR3JhcGhDaGlsZHJlbkV4cG9ydERhdGEoKSkpCiAgICAgICAgICAgIGZvciAoY29uc3QgYiBvZiBhKQogICAgICAgICAgICAgICAgaWYgKGEgPSB0aGlzLl9ydW50aW1lLkdldEluc3RhbmNlQnlVSUQoYlsyXSkpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBkID0gYlszXTsKICAgICAgICAgICAgICAgICAgICB0aGlzLkFkZENoaWxkKGEsIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNmb3JtWDogISEoZCA+PiAwICYgMSksCiAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zZm9ybVk6ICEhKGQgPj4gMSAmIDEpLAogICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2Zvcm1XaWR0aDogISEoZCA+PiAyICYgMSksCiAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zZm9ybUhlaWdodDogISEoZCA+PiAzICYgMSksCiAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zZm9ybUFuZ2xlOiAhIShkID4+IDQgJiAxKSwKICAgICAgICAgICAgICAgICAgICAgICAgZGVzdHJveVdpdGhQYXJlbnQ6ICEhKGQgPj4gNSAmIDEpLAogICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2Zvcm1aRWxldmF0aW9uOiAhIShkID4+IDYgJiAxKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9CiAgICB9CiAgICBJc0luQ29udGFpbmVyKCkgewogICAgICAgIHJldHVybiBudWxsICE9PSB0aGlzLl9zaWJsaW5ncwogICAgfQogICAgX0FkZFNpYmxpbmcoYSkgewogICAgICAgIHRoaXMuX3NpYmxpbmdzLnB1c2goYSkKICAgIH0KICAgIEdldFNpYmxpbmdzKCkgewogICAgICAgIHJldHVybiB0aGlzLl9zaWJsaW5ncwogICAgfQogICAgSGFzU2libGluZyhhKSB7CiAgICAgICAgcmV0dXJuICEhdGhpcy5HZXRTaWJsaW5nKGEpCiAgICB9CiAgICBHZXRTaWJsaW5nKGEpIHsKICAgICAgICBjb25zdCBiID0KICAgICAgICAgICAgdGhpcy5zaWJsaW5ncygpOwogICAgICAgIGlmIChudWxsID09PSBiIHx8IDAgPT09IGIubGVuZ3RoKSByZXR1cm4gITE7CiAgICAgICAgZm9yIChjb25zdCBkIG9mIGIpCiAgICAgICAgICAgIGlmIChkLkdldE9iamVjdENsYXNzKCkgPT09IGEpIHJldHVybiBkOwogICAgICAgIHJldHVybiBudWxsCiAgICB9CiAgICBzaWJsaW5ncygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fc2libGluZ3MKICAgIH0KICAgIFNldFNpYmxpbmdzU2luZ2xlUGlja2VkKCkgewogICAgICAgIGZvciAoY29uc3QgYSBvZiB0aGlzLnNpYmxpbmdzKCkpIGEuR2V0T2JqZWN0Q2xhc3MoKS5HZXRDdXJyZW50U29sKCkuU2V0U2luZ2xlUGlja2VkKGEpCiAgICB9CiAgICBfUHVzaFNpYmxpbmdzVG9Tb2xJbnN0YW5jZXMoKSB7CiAgICAgICAgZm9yIChjb25zdCBhIG9mIHRoaXMuc2libGluZ3MoKSkgYS5HZXRPYmplY3RDbGFzcygpLkdldEN1cnJlbnRTb2woKS5fUHVzaEluc3RhbmNlKGEpCiAgICB9CiAgICBfU2V0U2libGluZ3NUb1NvbEluc3RhbmNlc0luZGV4KGEpIHsKICAgICAgICBmb3IgKGNvbnN0IGIgb2YgdGhpcy5zaWJsaW5ncygpKSBiLkdldE9iamVjdENsYXNzKCkuR2V0Q3VycmVudFNvbCgpLl9HZXRPd25JbnN0YW5jZXMoKVthXSA9IGIKICAgIH0KICAgIF9QdXNoU2libGluZ3NUb1NvbEVsc2VJbnN0YW5jZXMoKSB7CiAgICAgICAgZm9yIChjb25zdCBhIG9mIHRoaXMuc2libGluZ3MoKSkgYS5HZXRPYmplY3RDbGFzcygpLkdldEN1cnJlbnRTb2woKS5fUHVzaEVsc2VJbnN0YW5jZShhKQogICAgfQogICAgX1NldFNpYmxpbmdzVG9Tb2xFbHNlSW5zdGFuY2VzSW5kZXgoYSkgewogICAgICAgIGZvciAoY29uc3QgYiBvZiB0aGlzLnNpYmxpbmdzKCkpIGIuR2V0T2JqZWN0Q2xhc3MoKS5HZXRDdXJyZW50U29sKCkuX0dldE93bkVsc2VJbnN0YW5jZXMoKVthXSA9CiAgICAgICAgICAgIGIKICAgIH0KICAgIEdldFBsdWdpbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5fb2JqZWN0VHlwZS5HZXRQbHVnaW4oKQogICAgfQogICAgX1NldElJRChhKSB7CiAgICAgICAgdGhpcy5faWlkID0gYQogICAgfQogICAgR2V0SUlEKCkgewogICAgICAgIHRoaXMuX29iamVjdFR5cGUuX1VwZGF0ZUlJRHMoKTsKICAgICAgICByZXR1cm4gdGhpcy5faWlkCiAgICB9CiAgICBHZXRVSUQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3VpZAogICAgfQogICAgR2V0UFVJRCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcHVpZAogICAgfQogICAgR2V0QmVoYXZpb3JJbnN0YW5jZXMoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2JlaGF2aW9ySW5zdGFuY2VzCiAgICB9CiAgICBHZXRCZWhhdmlvckluc3RhbmNlRnJvbUN0b3IoYSkgewogICAgICAgIGlmICghYSkgcmV0dXJuIG51bGw7CiAgICAgICAgZm9yIChjb25zdCBiIG9mIHRoaXMuX2JlaGF2aW9ySW5zdGFuY2VzKQogICAgICAgICAgICBpZiAoYi5HZXRCZWhhdmlvcigpIGluc3RhbmNlb2YgYSkgcmV0dXJuIGI7CiAgICAgICAgcmV0dXJuIG51bGwKICAgIH0KICAgIEdldEJlaGF2aW9yU2RrSW5zdGFuY2VGcm9tQ3RvcihhKSB7CiAgICAgICAgcmV0dXJuIGEgPyAoYSA9IHRoaXMuR2V0QmVoYXZpb3JJbnN0YW5jZUZyb21DdG9yKGEpKSA/IGEuR2V0U2RrSW5zdGFuY2UoKSA6IG51bGwgOiBudWxsCiAgICB9CiAgICBHZXRCZWhhdmlvckluZGV4QnlTSUQoYSkgewogICAgICAgIGNvbnN0IGIgPQogICAgICAgICAgICB0aGlzLl9iZWhhdmlvckluc3RhbmNlczsKICAgICAgICBmb3IgKGxldCBkID0gMCwgYyA9IGIubGVuZ3RoOyBkIDwgYzsgKytkKQogICAgICAgICAgICBpZiAoYltkXS5HZXRCZWhhdmlvclR5cGUoKS5HZXRTSUQoKSA9PT0gYSkgcmV0dXJuIGQ7CiAgICAgICAgcmV0dXJuIC0xCiAgICB9CiAgICBHZXRBbGxJbnN0YW5jZVZhcmlhYmxlVmFsdWVzKCkgewogICAgICAgIHJldHVybiB0aGlzLl9pbnN0VmFyVmFsdWVzCiAgICB9CiAgICBfR2V0QWxsSW5zdGFuY2VWYXJpYWJsZU5hbWVzKCkgewogICAgICAgIHJldHVybiB0aGlzLl9vYmplY3RUeXBlLl9HZXRBbGxJbnN0YW5jZVZhcmlhYmxlTmFtZXMoKQogICAgfQogICAgR2V0SW5zdGFuY2VWYXJpYWJsZUNvdW50KCkgewogICAgICAgIHJldHVybiB0aGlzLl9pbnN0VmFyVmFsdWVzLmxlbmd0aAogICAgfQogICAgR2V0SW5zdGFuY2VWYXJpYWJsZVZhbHVlKGEpIHsKICAgICAgICBhIHw9IDA7CiAgICAgICAgY29uc3QgYiA9IHRoaXMuX2luc3RWYXJWYWx1ZXM7CiAgICAgICAgaWYgKDAgPiBhIHx8IGEgPj0gYi5sZW5ndGgpIHRocm93IG5ldyBSYW5nZUVycm9yKCJpbnZhbGlkIGluc3RhbmNlIHZhcmlhYmxlIik7CiAgICAgICAgcmV0dXJuIGJbYV0KICAgIH0KICAgIF9HZXRJbnN0YW5jZVZhcmlhYmxlVmFsdWVVbmNoZWNrZWQoYSkgewogICAgICAgIHJldHVybiB0aGlzLl9pbnN0VmFyVmFsdWVzW2FdCiAgICB9CiAgICBfR2V0SW5zdGFuY2VWYXJpYWJsZVR5cGVkVmFsdWUoYSkgewogICAgICAgIGNvbnN0IGIgPQogICAgICAgICAgICB0aGlzLl9pbnN0VmFyVmFsdWVzW2FdOwogICAgICAgIHJldHVybiAwID09PSB0aGlzLl9vYmplY3RUeXBlLkdldEluc3RhbmNlVmFyaWFibGVUeXBlKGEpID8gISFiIDogYgogICAgfQogICAgU2V0SW5zdGFuY2VWYXJpYWJsZVZhbHVlKGEsIGIpIHsKICAgICAgICBhIHw9IDA7CiAgICAgICAgY29uc3QgZCA9IHRoaXMuX2luc3RWYXJWYWx1ZXM7CiAgICAgICAgaWYgKDAgPiBhIHx8IGEgPj0gZC5sZW5ndGgpIHRocm93IG5ldyBSYW5nZUVycm9yKCJpbnZhbGlkIGluc3RhbmNlIHZhcmlhYmxlIik7CiAgICAgICAgc3dpdGNoICh0aGlzLl9vYmplY3RUeXBlLkdldEluc3RhbmNlVmFyaWFibGVUeXBlKGEpKSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGRbYV0gPSBiID8gMSA6IDA7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgZFthXSA9ICJudW1iZXIiID09PSB0eXBlb2YgYiA/IGIgOiBwYXJzZUZsb2F0KGIpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgIGRbYV0gPSAic3RyaW5nIiA9PT0gdHlwZW9mIGIgPyBiIDogYi50b1N0cmluZygpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICB0aHJvdyBFcnJvcigidW5rbm93biBpbnN0YW5jZSB2YXJpYWJsZSB0eXBlIik7CiAgICAgICAgfQogICAgfQogICAgU2V0SW5zdGFuY2VWYXJpYWJsZU9mZnNldChhLCBiKSB7CiAgICAgICAgaWYgKDAgIT09IGIpIHsKICAgICAgICAgICAgYSB8PSAwOwogICAgICAgICAgICB2YXIgZCA9IHRoaXMuX2luc3RWYXJWYWx1ZXM7CiAgICAgICAgICAgIGlmICgwID4gYSB8fCBhID49IGQubGVuZ3RoKSB0aHJvdyBuZXcgUmFuZ2VFcnJvcigiaW52YWxpZCBpbnN0YW5jZSB2YXJpYWJsZSIpOwogICAgICAgICAgICB2YXIgYyA9IGRbYV07CiAgICAgICAgICAgIGlmICgibnVtYmVyIiA9PT0gdHlwZW9mIGMpIGRbYV0gPSAibnVtYmVyIiA9PT0gdHlwZW9mIGIgPyBkW2FdICsgYiA6IGRbYV0gKyBwYXJzZUZsb2F0KGIpOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGlmICgiYm9vbGVhbiIgPT09IHR5cGVvZiBjKSB0aHJvdyBFcnJvcigiY2FuIG5vdCBzZXQgb2Zmc2V0IG9mIGJvb2xlYW4gdmFyaWFibGUiKTsKICAgICAgICAgICAgICAgIGlmICgic3RyaW5nIiA9PT0gdHlwZW9mIGMpIHRocm93IEVycm9yKCJjYW4gbm90IHNldCBvZmZzZXQgb2Ygc3RyaW5nIHZhcmlhYmxlIik7CiAgICAgICAgICAgICAgICB0aHJvdyBFcnJvcigidW5rbm93biBpbnN0YW5jZSB2YXJpYWJsZSB0eXBlIik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBHZXRTYXZlZERhdGFNYXAoKSB7CiAgICAgICAgbGV0IGEgPSBzYXZlZERhdGFNYXBzLmdldCh0aGlzKTsKICAgICAgICBpZiAoYSkgcmV0dXJuIGE7CiAgICAgICAgYSA9IG5ldyBNYXA7CiAgICAgICAgc2F2ZWREYXRhTWFwcy5zZXQodGhpcywgYSk7CiAgICAgICAgcmV0dXJuIGEKICAgIH0KICAgIEdldFVuc2F2ZWREYXRhTWFwKCkgewogICAgICAgIGxldCBhID0KICAgICAgICAgICAgdW5zYXZlZERhdGFNYXBzLmdldCh0aGlzKTsKICAgICAgICBpZiAoYSkgcmV0dXJuIGE7CiAgICAgICAgYSA9IG5ldyBNYXA7CiAgICAgICAgdW5zYXZlZERhdGFNYXBzLnNldCh0aGlzLCBhKTsKICAgICAgICByZXR1cm4gYQogICAgfQogICAgX0hhc0FueUNyZWF0ZURlc3Ryb3lIYW5kbGVyKGEpIHsKICAgICAgICBjb25zdCBiID0gdGhpcy5HZXRPYmplY3RDbGFzcygpOwogICAgICAgIGlmIChiLlVzZXJTY3JpcHREaXNwYXRjaGVyKCkuSGFzQW55SGFuZGxlckZvcihhKSkgcmV0dXJuICEwOwogICAgICAgIGZvciAoY29uc3QgZCBvZiBiLkdldEZhbWlsaWVzKCkpCiAgICAgICAgICAgIGlmIChkLlVzZXJTY3JpcHREaXNwYXRjaGVyKCkuSGFzQW55SGFuZGxlckZvcihhKSkgcmV0dXJuICEwOwogICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lLlVzZXJTY3JpcHREaXNwYXRjaGVyKCkuSGFzQW55SGFuZGxlckZvcihhKSA/ICEwIDogITEKICAgIH0KICAgIF9UcmlnZ2VyT25DcmVhdGVkT25TZWxmQW5kUmVsYXRlZCgpIHsKICAgICAgICBjb25zdCBhID0gbmV3IFNldDsKICAgICAgICBhLmFkZCh0aGlzKTsKICAgICAgICBjb25zdCBiID0gdGhpcy5HZXRXb3JsZEluZm8oKTsKICAgICAgICBpZiAoYiAmJiBiLkhhc0NoaWxkcmVuKCkpCiAgICAgICAgICAgIGZvciAoY29uc3QgZCBvZiB0aGlzLmFsbENoaWxkcmVuKCkpCiAgICAgICAgICAgICAgICBpZiAoYS5hZGQoZCksCiAgICAgICAgICAgICAgICAgICAgZC5Jc0luQ29udGFpbmVyKCkpCiAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBjIG9mIGQuc2libGluZ3MoKSkgYS5hZGQoYyk7CiAgICAgICAgaWYgKHRoaXMuSXNJbkNvbnRhaW5lcigpKQogICAgICAgICAgICBmb3IgKGNvbnN0IGQgb2YgdGhpcy5zaWJsaW5ncygpKSBhLmFkZChkKTsKICAgICAgICBmb3IgKGNvbnN0IGQgb2YgYS52YWx1ZXMoKSkgZC5fVHJpZ2dlck9uQ3JlYXRlZCgpCiAgICB9CiAgICBfVHJpZ2dlck9uQ3JlYXRlZCgpIHsKICAgICAgICBpZiAodGhpcy5fSGFzQW55Q3JlYXRlRGVzdHJveUhhbmRsZXIoImluc3RhbmNlY3JlYXRlIikpIHsKICAgICAgICAgICAgY29uc3QgYSA9IHRoaXMuR2V0T2JqZWN0Q2xhc3MoKSwKICAgICAgICAgICAgICAgIGIgPSBuZXcgQzMkanNjb21wJDE1Ny5FdmVudCgiaW5zdGFuY2VjcmVhdGUiKTsKICAgICAgICAgICAgYi5pbnN0YW5jZSA9IHRoaXMuR2V0SW50ZXJmYWNlQ2xhc3MoKTsKICAgICAgICAgICAgYS5EaXNwYXRjaFVzZXJTY3JpcHRFdmVudChiKTsKICAgICAgICAgICAgZm9yIChjb25zdCBkIG9mIGEuR2V0RmFtaWxpZXMoKSkgZC5EaXNwYXRjaFVzZXJTY3JpcHRFdmVudChiKTsKICAgICAgICAgICAgdGhpcy5fcnVudGltZS5EaXNwYXRjaFVzZXJTY3JpcHRFdmVudChiKQogICAgICAgIH0KICAgICAgICB0aGlzLl9ydW50aW1lLlRyaWdnZXIodGhpcy5HZXRQbHVnaW4oKS5jb25zdHJ1Y3Rvci5DbmRzLk9uQ3JlYXRlZCwKICAgICAgICAgICAgdGhpcywgbnVsbCkKICAgIH0KICAgIF9UcmlnZ2VyT25EZXN0cm95ZWQoKSB7CiAgICAgICAgdGhpcy5fcnVudGltZS5UcmlnZ2VyKHRoaXMuR2V0UGx1Z2luKCkuY29uc3RydWN0b3IuQ25kcy5PbkRlc3Ryb3llZCwgdGhpcywgbnVsbCkKICAgIH0KICAgIF9GaXJlRGVzdHJveWVkU2NyaXB0RXZlbnRzKGEpIHsKICAgICAgICBpZiAodGhpcy5faVNjcmlwdEludGVyZmFjZSkgewogICAgICAgICAgICB2YXIgYiA9IG5ldyBDMyRqc2NvbXAkMTU3LkV2ZW50KCJkZXN0cm95Iik7CiAgICAgICAgICAgIGIuaXNFbmRpbmdMYXlvdXQgPSBhOwogICAgICAgICAgICB0aGlzLkRpc3BhdGNoVXNlclNjcmlwdEV2ZW50KGIpCiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLl9IYXNBbnlDcmVhdGVEZXN0cm95SGFuZGxlcigiaW5zdGFuY2VkZXN0cm95IikpIHsKICAgICAgICAgICAgYiA9IHRoaXMuR2V0T2JqZWN0Q2xhc3MoKTsKICAgICAgICAgICAgdmFyIGQgPSBuZXcgQzMkanNjb21wJDE1Ny5FdmVudCgiaW5zdGFuY2VkZXN0cm95Iik7CiAgICAgICAgICAgIGQuaW5zdGFuY2UgPSB0aGlzLkdldEludGVyZmFjZUNsYXNzKCk7CiAgICAgICAgICAgIGQuaXNFbmRpbmdMYXlvdXQgPSBhOwogICAgICAgICAgICBiLkRpc3BhdGNoVXNlclNjcmlwdEV2ZW50KGQpOwogICAgICAgICAgICBmb3IgKGNvbnN0IGMgb2YgYi5HZXRGYW1pbGllcygpKSBjLkRpc3BhdGNoVXNlclNjcmlwdEV2ZW50KGQpOwogICAgICAgICAgICB0aGlzLl9ydW50aW1lLkRpc3BhdGNoVXNlclNjcmlwdEV2ZW50KGQpCiAgICAgICAgfQogICAgfQogICAgX0dldERlYnVnZ2VyUHJvcGVydGllcygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fc2RrSW5zdC5HZXREZWJ1Z2dlclByb3BlcnRpZXMoKQogICAgfQogICAgU2F2ZVRvSnNvbihhID0gImZ1bGwiKSB7CiAgICAgICAgY29uc3QgYiA9IHt9OwogICAgICAgICJmdWxsIiA9PT0gYSA/IGIudWlkID0gdGhpcy5HZXRVSUQoKSA6IGIuYzMgPSAhMDsKICAgICAgICBpZiAoInZpc3VhbC1zdGF0ZSIgIT09IGEpIHsKICAgICAgICAgICAgdmFyIGQgPSBzYXZlZERhdGFNYXBzLmdldCh0aGlzKTsKICAgICAgICAgICAgZCAmJiBkLnNpemUgJiYgKGIuZXggPSBDMyRqc2NvbXAkMTU3LlRvU3VwZXJKU09OKGQpKTsgLSAxICE9PSB0aGlzLkdldFRpbWVTY2FsZSgpICYmIChiLm10cyA9IHRoaXMuR2V0VGltZVNjYWxlKCkpOwogICAgICAgICAgICBpZiAoMCA8IHRoaXMuX29iamVjdFR5cGUuR2V0SW5zdGFuY2VWYXJpYWJsZXNDb3VudCgpKSB7CiAgICAgICAgICAgICAgICBkID0ge307CiAgICAgICAgICAgICAgICB2YXIgYyA9IHRoaXMuX29iamVjdFR5cGUuR2V0SW5zdGFuY2VWYXJpYWJsZVNJRHMoKTsKICAgICAgICAgICAgICAgIGZvciAobGV0IGUgPSAwLCBnID0gdGhpcy5faW5zdFZhclZhbHVlcy5sZW5ndGg7IGUgPCBnOyArK2UpIGRbY1tlXS50b1N0cmluZygpXSA9CiAgICAgICAgICAgICAgICAgICAgdGhpcy5faW5zdFZhclZhbHVlc1tlXTsKICAgICAgICAgICAgICAgIGIuaXZzID0gZAogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLl9iZWhhdmlvckluc3RhbmNlcy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIGQgPSB7fTsKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgZSBvZiB0aGlzLl9iZWhhdmlvckluc3RhbmNlcykoYyA9IGUuU2F2ZVRvSnNvbigpKSAmJiAoZFtlLkdldEJlaGF2aW9yVHlwZSgpLkdldFNJRCgpLnRvU3RyaW5nKCldID0gYyk7CiAgICAgICAgICAgICAgICBiLmJlaHMgPSBkCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdGhpcy5fd29ybGRJbmZvICYmIChiLncgPSB0aGlzLl93b3JsZEluZm8uX1NhdmVUb0pzb24oYSkpOwogICAgICAgIChhID0gdGhpcy5fc2RrSW5zdC5TYXZlVG9Kc29uKCkpICYmIChiLmRhdGEgPSBhKTsKICAgICAgICByZXR1cm4gYgogICAgfQogICAgX09uQmVmb3JlTG9hZChhID0gImZ1bGwiKSB7CiAgICAgICAgdGhpcy5fd29ybGRJbmZvICYmIHRoaXMuX3dvcmxkSW5mby5fT25CZWZvcmVMb2FkKGEpCiAgICB9CiAgICBfU2V0dXBTY2VuZUdyYXBoQ29ubmVjdGlvbnNPbkNoYW5nZU9mTGF5b3V0KCkgewogICAgICAgIHRoaXMuR2V0UGx1Z2luKCkuSXNXb3JsZFR5cGUoKSAmJiB0aGlzLl93b3JsZEluZm8uX1NldHVwU2NlbmVHcmFwaENvbm5lY3Rpb25zT25DaGFuZ2VPZkxheW91dCgpCiAgICB9CiAgICBMb2FkRnJvbUpzb24oYSwKICAgICAgICBiID0gImZ1bGwiKSB7CiAgICAgICAgaWYgKCJmdWxsIiA9PT0gYikgdGhpcy5fdWlkID0gYS51aWQ7CiAgICAgICAgZWxzZSBpZiAoIWEuYzMpIHJldHVybjsKICAgICAgICBpZiAoInZpc3VhbC1zdGF0ZSIgIT09IGIpIHsKICAgICAgICAgICAgdmFyIGQgPSBzYXZlZERhdGFNYXBzLmdldCh0aGlzKTsKICAgICAgICAgICAgZCAmJiAoZC5jbGVhcigpLCBzYXZlZERhdGFNYXBzLmRlbGV0ZSh0aGlzKSk7CiAgICAgICAgICAgIGlmIChkID0gYS5leCkgZCA9IEMzJGpzY29tcCQxNTcuRnJvbVN1cGVySlNPTihkKSwgc2F2ZWREYXRhTWFwcy5zZXQodGhpcywgZCk7CiAgICAgICAgICAgIHRoaXMuX3RpbWVTY2FsZSA9IGEuaGFzT3duUHJvcGVydHkoIm10cyIpID8gYS5tdHMgOiAtMTsKICAgICAgICAgICAgaWYgKGQgPSBhLml2cykKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgW2csIGtdIG9mIE9iamVjdC5lbnRyaWVzKGQpKQogICAgICAgICAgICAgICAgICAgIGlmIChkID0gcGFyc2VJbnQoZywgMTApLCBkID0gdGhpcy5fb2JqZWN0VHlwZS5HZXRJbnN0YW5jZVZhcmlhYmxlSW5kZXhCeVNJRChkKSwgISgwID4gZCB8fCBkID49IHRoaXMuX2luc3RWYXJWYWx1ZXMubGVuZ3RoKSkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IGs7CiAgICAgICAgICAgICAgICAgICAgICAgIG51bGwgPT09IGMgJiYgKGMgPSBOYU4pOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9pbnN0VmFyVmFsdWVzW2RdID0gYwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMuR2V0UGx1Z2luKCkuSXNXb3JsZFR5cGUoKSkgewogICAgICAgICAgICBkID0KICAgICAgICAgICAgICAgIGEudzsKICAgICAgICAgICAgdmFyIGUgPSBkLmw7CiAgICAgICAgICAgIHRoaXMuX3dvcmxkSW5mby5HZXRMYXllcigpLkdldFNJRCgpICE9PSBlICYmIChjID0gdGhpcy5fd29ybGRJbmZvLkdldExheWVyKCksIChlID0gYy5HZXRMYXlvdXQoKS5HZXRMYXllckJ5U0lEKGUpKSA/ICh0aGlzLl93b3JsZEluZm8uX1NldExheWVyKGUpLCBjLl9SZW1vdmVJbnN0YW5jZSh0aGlzLCAhMCksIGUuX0FkZEluc3RhbmNlKHRoaXMsICEwKSwgZS5TZXRaSW5kaWNlc0NoYW5nZWQoKSwgdGhpcy5fd29ybGRJbmZvLlNldEJib3hDaGFuZ2VkKCkpIDogImZ1bGwiID09PSBiICYmIHRoaXMuX3J1bnRpbWUuRGVzdHJveUluc3RhbmNlKHRoaXMpKTsKICAgICAgICAgICAgdGhpcy5fd29ybGRJbmZvLl9Mb2FkRnJvbUpzb24oZCwgYikKICAgICAgICB9CiAgICAgICAgaWYgKCJ2aXN1YWwtc3RhdGUiICE9PSBiICYmIChkID0gYS5iZWhzKSkKICAgICAgICAgICAgZm9yIChjb25zdCBbZywga10gb2YgT2JqZWN0LmVudHJpZXMoZCkpIGQgPSBwYXJzZUludChnLCAxMCksIGQgPSB0aGlzLkdldEJlaGF2aW9ySW5kZXhCeVNJRChkKSwgMCA+IGQgfHwgZCA+PSB0aGlzLl9iZWhhdmlvckluc3RhbmNlcy5sZW5ndGggfHwKICAgICAgICAgICAgICAgIHRoaXMuX2JlaGF2aW9ySW5zdGFuY2VzW2RdLkxvYWRGcm9tSnNvbihrKTsKICAgICAgICAoYSA9IGEuZGF0YSkgJiYgdGhpcy5fc2RrSW5zdC5Mb2FkRnJvbUpzb24oYSwgYikKICAgIH0KICAgIEdldEludGVyZmFjZUNsYXNzKCkgewogICAgICAgIHJldHVybiB0aGlzLl9pU2NyaXB0SW50ZXJmYWNlIHx8IHRoaXMuX0luaXRVc2VyU2NyaXB0SW50ZXJmYWNlKCkKICAgIH0KICAgIEhhc1NjcmlwdEludGVyZmFjZSgpIHsKICAgICAgICByZXR1cm4gISF0aGlzLl9pU2NyaXB0SW50ZXJmYWNlCiAgICB9CiAgICBfSW5pdFVzZXJTY3JpcHRJbnRlcmZhY2UoKSB7CiAgICAgICAgdmFyIGEgPSB0aGlzLl93b3JsZEluZm8gPyBzZWxmLklXb3JsZEluc3RhbmNlIDogSUluc3RhbmNlJGpzY29tcCQyOwogICAgICAgIGNvbnN0IGIgPSB0aGlzLl9zZGtJbnN0LkdldFNjcmlwdEludGVyZmFjZUNsYXNzKCksCiAgICAgICAgICAgIGQgPSB0aGlzLl9vYmplY3RUeXBlLl9HZXRVc2VyU2NyaXB0SW5zdGFuY2VDbGFzcygpLAogICAgICAgICAgICBjID0gZCB8fCBiIHx8IGE7CiAgICAgICAgSUluc3RhbmNlJGpzY29tcCQyLl9Jbml0KHRoaXMpOwogICAgICAgIHRoaXMuX2lTY3JpcHRJbnRlcmZhY2UgPSBuZXcgYzsKICAgICAgICBJSW5zdGFuY2UkanNjb21wJDIuX0luaXQobnVsbCk7CiAgICAgICAgaWYgKGIgJiYgISh0aGlzLl9pU2NyaXB0SW50ZXJmYWNlIGluc3RhbmNlb2YgYSkpIHRocm93IG5ldyBUeXBlRXJyb3IoYHNjcmlwdCBpbnRlcmZhY2UgY2xhc3MgJyR7Yi5uYW1lfScgZG9lcyBub3QgZXh0ZW5kIHRoZSByaWdodCBiYXNlIGNsYXNzICcke2EubmFtZX0nYCk7CiAgICAgICAgaWYgKGQgJiYgKGEgPSBiIHx8IGEsICEodGhpcy5faVNjcmlwdEludGVyZmFjZSBpbnN0YW5jZW9mIGEpKSkgdGhyb3cgbmV3IFR5cGVFcnJvcihgc2V0SW5zdGFuY2VDbGFzcygpOiBjbGFzcyAnJHtkLm5hbWV9JyBkb2VzIG5vdCBleHRlbmQgdGhlIHJpZ2h0IGJhc2UgY2xhc3MgJyR7YS5uYW1lfSdgKTsKICAgICAgICByZXR1cm4gdGhpcy5faVNjcmlwdEludGVyZmFjZQogICAgfQogICAgX0dldEluc3RWYXJzU2NyaXB0RGVzY3JpcHRvcihhKSB7CiAgICAgICAgaWYgKDAgIT09IHRoaXMuX2luc3RWYXJWYWx1ZXMubGVuZ3RoKSB7CiAgICAgICAgICAgIHZhciBiID0ge30sCiAgICAgICAgICAgICAgICBkID0gdGhpcy5fb2JqZWN0VHlwZS5fR2V0QWxsSW5zdGFuY2VWYXJpYWJsZUpzUHJvcE5hbWVzKCk7CiAgICAgICAgICAgIGZvciAobGV0IGMgPSAwLCBlID0gZC5sZW5ndGg7IGMgPAogICAgICAgICAgICAgICAgZTsgKytjKSBiW2RbY11dID0gewogICAgICAgICAgICAgICAgY29uZmlndXJhYmxlOiAhMSwKICAgICAgICAgICAgICAgIGVudW1lcmFibGU6ICEwLAogICAgICAgICAgICAgICAgZ2V0OiBDMyRqc2NvbXAkMTU3Lkluc3RhbmNlLnByb3RvdHlwZS5fR2V0SW5zdGFuY2VWYXJpYWJsZVR5cGVkVmFsdWUuYmluZCh0aGlzLCBjKSwKICAgICAgICAgICAgICAgIHNldDogQzMkanNjb21wJDE1Ny5JbnN0YW5jZS5wcm90b3R5cGUuU2V0SW5zdGFuY2VWYXJpYWJsZVZhbHVlLmJpbmQodGhpcywgYykKICAgICAgICAgICAgfTsKICAgICAgICAgICAgYiA9IE9iamVjdC5jcmVhdGUoT2JqZWN0LnByb3RvdHlwZSwgYik7CiAgICAgICAgICAgIGEuaW5zdFZhcnMgPSB7CiAgICAgICAgICAgICAgICB2YWx1ZTogYiwKICAgICAgICAgICAgICAgIHdyaXRhYmxlOiAhMQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgX0dldEJlaGF2aW9yc1NjcmlwdERlc2NyaXB0b3IoYSkgewogICAgICAgIHZhciBiID0gdGhpcy5fYmVoYXZpb3JJbnN0YW5jZXM7CiAgICAgICAgaWYgKDAgIT09IGIubGVuZ3RoKSB7CiAgICAgICAgICAgIHZhciBkID0ge307CiAgICAgICAgICAgIGZvciAoY29uc3QgYyBvZiBiKSBkW2MuR2V0QmVoYXZpb3JUeXBlKCkuR2V0SnNQcm9wTmFtZSgpXSA9IHsKICAgICAgICAgICAgICAgIHZhbHVlOiBjLkdldFNjcmlwdEludGVyZmFjZSgpLAogICAgICAgICAgICAgICAgd3JpdGFibGU6ICExCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGIgPSBPYmplY3QuY3JlYXRlKE9iamVjdC5wcm90b3R5cGUsIGQpOwogICAgICAgICAgICBhLmJlaGF2aW9ycyA9IHsKICAgICAgICAgICAgICAgIHZhbHVlOiBiLAogICAgICAgICAgICAgICAgd3JpdGFibGU6ICExCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBEaXNwYXRjaFVzZXJTY3JpcHRFdmVudChhKSB7CiAgICAgICAgaWYgKHRoaXMuSGFzU2NyaXB0SW50ZXJmYWNlKCkpIHsKICAgICAgICAgICAgdmFyIGIgPSB0aGlzLkdldEludGVyZmFjZUNsYXNzKCk7CiAgICAgICAgICAgIGEuaW5zdGFuY2UgPSBiOwogICAgICAgICAgICB2YXIgZCA9IHRoaXMuX3J1bnRpbWU7CiAgICAgICAgICAgIChkID0gZC5Jc0RlYnVnKCkgJiYgIWQuR2V0RXZlbnRTaGVldE1hbmFnZXIoKS5Jc0luRXZlbnRFbmdpbmUoKSkgJiYgQzNEZWJ1Z2dlciRqc2NvbXAkMi5TdGFydE1lYXN1cmluZ1NjcmlwdFRpbWUoKTsKICAgICAgICAgICAgYi5kaXNwYXRjaEV2ZW50KGEpOwogICAgICAgICAgICBkICYmIEMzRGVidWdnZXIkanNjb21wJDIuQWRkU2NyaXB0VGltZSgpCiAgICAgICAgfQogICAgfQp9OwoidXNlIHN0cmljdCI7CmNvbnN0IEMzJGpzY29tcCQxNTggPSBzZWxmLkMzOwpDMyRqc2NvbXAkMTU4LlNjZW5lR3JhcGhJbmZvID0gY2xhc3MgZXh0ZW5kcyBDMyRqc2NvbXAkMTU4LkRlZmVuZGVkQmFzZSB7CiAgICBjb25zdHJ1Y3RvcihhKSB7CiAgICAgICAgc3VwZXIoKTsKICAgICAgICB0aGlzLl9vd25lciA9IGE7CiAgICAgICAgdGhpcy5fcGFyZW50ID0gbnVsbDsKICAgICAgICB0aGlzLl9jaGlsZHJlbiA9IFtdOwogICAgICAgIHRoaXMuX3N0YXJ0V2lkdGggPSBhLkdldFdpZHRoKCk7CiAgICAgICAgdGhpcy5fc3RhcnRIZWlnaHQgPSBhLkdldEhlaWdodCgpOwogICAgICAgIHRoaXMuX3N0YXJ0U2NhbGVZID0gdGhpcy5fc3RhcnRTY2FsZVggPSAxOwogICAgICAgIHRoaXMuX3BhcmVudFN0YXJ0QW5nbGUgPSAwOwogICAgICAgIHRoaXMuX3RtcFNjZW5lR3JhcGhDaGlsZHJlbkluZGV4ZXMgPSB0aGlzLl90bXBTY2VuZUdyYXBoQ2hpbGRyZW4gPSBudWxsCiAgICB9CiAgICBSZWxlYXNlKCkgewogICAgICAgIHRoaXMuX3RtcFNjZW5lR3JhcGhDaGlsZHJlbkluZGV4ZXMgPSB0aGlzLl90bXBTY2VuZUdyYXBoQ2hpbGRyZW4gPSB0aGlzLl9wYXJlbnQgPSBudWxsOwogICAgICAgIEMzJGpzY29tcCQxNTguY2xlYXJBcnJheSh0aGlzLl9jaGlsZHJlbikKICAgIH0KICAgIFNldFBhcmVudChhKSB7CiAgICAgICAgdGhpcy5fcGFyZW50U3RhcnRBbmdsZSA9CiAgICAgICAgICAgICh0aGlzLl9wYXJlbnQgPSBhKSA/IGEuR2V0QW5nbGUoKSA6IDAKICAgIH0KICAgIEdldFBhcmVudCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcGFyZW50CiAgICB9CiAgICBIYXNDaGlsZHJlbigpIHsKICAgICAgICByZXR1cm4gMCA8IHRoaXMuX2NoaWxkcmVuLmxlbmd0aAogICAgfQogICAgR2V0Q2hpbGRyZW4oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2NoaWxkcmVuCiAgICB9CiAgICBfTWF5YmVTb3J0Q2hpbGRyZW4oKSB7CiAgICAgICAgdGhpcy5IYXNDaGlsZHJlbigpICYmIHRoaXMuX3RtcFNjZW5lR3JhcGhDaGlsZHJlbkluZGV4ZXMgJiYgMSAhPT0gdGhpcy5fY2hpbGRyZW4ubGVuZ3RoICYmIHRoaXMuX2NoaWxkcmVuLnNvcnQoKGEsIGIpID0+IHsKICAgICAgICAgICAgYSA9IHRoaXMuX3RtcFNjZW5lR3JhcGhDaGlsZHJlbkluZGV4ZXMuZ2V0KGEuR2V0SW5zdGFuY2UoKSk7CiAgICAgICAgICAgIGIgPSB0aGlzLl90bXBTY2VuZUdyYXBoQ2hpbGRyZW5JbmRleGVzLmdldChiLkdldEluc3RhbmNlKCkpOwogICAgICAgICAgICByZXR1cm4gQzMkanNjb21wJDE1OC5Jc0Zpbml0ZU51bWJlcihhKSAmJiBDMyRqc2NvbXAkMTU4LklzRmluaXRlTnVtYmVyKGIpID8gYSAtIGIgOiAwCiAgICAgICAgfSkKICAgIH0KICAgIEdldFN0YXJ0U2NhbGVYKCkgewogICAgICAgIHJldHVybiB0aGlzLl9zdGFydFNjYWxlWAogICAgfQogICAgU2V0U3RhcnRTY2FsZVgoYSkgewogICAgICAgIHRoaXMuX3N0YXJ0U2NhbGVYID0KICAgICAgICAgICAgYQogICAgfQogICAgR2V0U3RhcnRTY2FsZVkoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3N0YXJ0U2NhbGVZCiAgICB9CiAgICBTZXRTdGFydFNjYWxlWShhKSB7CiAgICAgICAgdGhpcy5fc3RhcnRTY2FsZVkgPSBhCiAgICB9CiAgICBfR2V0U3RhcnRXaWR0aCgpIHsKICAgICAgICByZXR1cm4gMCA9PT0gdGhpcy5fc3RhcnRXaWR0aCA/IE51bWJlci5FUFNJTE9OIDogdGhpcy5fc3RhcnRXaWR0aAogICAgfQogICAgX0dldFN0YXJ0SGVpZ2h0KCkgewogICAgICAgIHJldHVybiAwID09PSB0aGlzLl9zdGFydEhlaWdodCA/IE51bWJlci5FUFNJTE9OIDogdGhpcy5fc3RhcnRIZWlnaHQKICAgIH0KICAgIEdldFBhcmVudFNjYWxlWCgpIHsKICAgICAgICBpZiAodGhpcy5fb3duZXIuR2V0VHJhbnNmb3JtV2l0aFBhcmVudFdpZHRoKCkpIHsKICAgICAgICAgICAgdmFyIGEgPSB0aGlzLl9wYXJlbnQ7CiAgICAgICAgICAgIGxldCBiID0gYS5HZXRXaWR0aCgpLAogICAgICAgICAgICAgICAgZCA9IGEuX0dldFNjZW5lR3JhcGhJbmZvKCkuX0dldFN0YXJ0V2lkdGgoKTsKICAgICAgICAgICAgMCA9PT0gYiAmJiAoYiA9IE51bWJlci5FUFNJTE9OKTsKICAgICAgICAgICAgcmV0dXJuIGQgPT09IE51bWJlci5FUFNJTE9OICYmIGIgPT09IE51bWJlci5FUFNJTE9OID8gMSA6IGQgPT09IE51bWJlci5FUFNJTE9OICYmIGIgIT09IE51bWJlci5FUFNJTE9OICYmIChhID0gYS5HZXRJbnN0YW5jZSgpLkdldFNka0luc3RhbmNlKCksCiAgICAgICAgICAgICAgICBhLklzT3JpZ2luYWxTaXplS25vd24oKSkgPyAxICsgYiAvIGEuR2V0T3JpZ2luYWxXaWR0aCgpIDogYiAvIGQKICAgICAgICB9CiAgICAgICAgcmV0dXJuIDEKICAgIH0KICAgIEdldFBhcmVudFNjYWxlWSgpIHsKICAgICAgICBpZiAodGhpcy5fb3duZXIuR2V0VHJhbnNmb3JtV2l0aFBhcmVudEhlaWdodCgpKSB7CiAgICAgICAgICAgIHZhciBhID0gdGhpcy5fcGFyZW50OwogICAgICAgICAgICBsZXQgYiA9IGEuR2V0SGVpZ2h0KCksCiAgICAgICAgICAgICAgICBkID0gYS5fR2V0U2NlbmVHcmFwaEluZm8oKS5fR2V0U3RhcnRIZWlnaHQoKTsKICAgICAgICAgICAgMCA9PT0gYiAmJiAoYiA9IE51bWJlci5FUFNJTE9OKTsKICAgICAgICAgICAgcmV0dXJuIGQgPT09IE51bWJlci5FUFNJTE9OICYmIGIgPT09IE51bWJlci5FUFNJTE9OID8gMSA6IGQgPT09IE51bWJlci5FUFNJTE9OICYmIGIgIT09IE51bWJlci5FUFNJTE9OICYmIChhID0gYS5HZXRJbnN0YW5jZSgpLkdldFNka0luc3RhbmNlKCksIGEuSXNPcmlnaW5hbFNpemVLbm93bigpKSA/IDEgKyBiIC8gYS5HZXRPcmlnaW5hbEhlaWdodCgpIDogYiAvIGQKICAgICAgICB9CiAgICAgICAgcmV0dXJuIDEKICAgIH0KICAgIEdldFBhcmVudFN0YXJ0QW5nbGUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3BhcmVudFN0YXJ0QW5nbGUKICAgIH0KICAgIF9TYXZlVG9Kc29uKGEpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBzdzogdGhpcy5fc3RhcnRXaWR0aCwKICAgICAgICAgICAgc2g6IHRoaXMuX3N0YXJ0SGVpZ2h0LAogICAgICAgICAgICBzeDogdGhpcy5fc3RhcnRTY2FsZVgsCiAgICAgICAgICAgIHN5OiB0aGlzLl9zdGFydFNjYWxlWSwKICAgICAgICAgICAgcHNhOiB0aGlzLl9wYXJlbnRTdGFydEFuZ2xlLAogICAgICAgICAgICBwOiB0aGlzLl9HZXRQYXJlbnRKc29uKGEpLAogICAgICAgICAgICBjOiB0aGlzLl9HZXRDaGlsZHJlbkpzb24oYSkKICAgICAgICB9CiAgICB9CiAgICBfR2V0RmxhZ3NTdHJpbmcoYSkgewogICAgICAgIGxldCBiID0gIiI7CiAgICAgICAgYS5HZXRUcmFuc2Zvcm1XaXRoUGFyZW50WCgpICYmIChiICs9ICJ4Iik7CiAgICAgICAgYS5HZXRUcmFuc2Zvcm1XaXRoUGFyZW50WSgpICYmIChiICs9ICJ5Iik7CiAgICAgICAgYS5HZXRUcmFuc2Zvcm1XaXRoUGFyZW50V2lkdGgoKSAmJiAoYiArPSAidyIpOwogICAgICAgIGEuR2V0VHJhbnNmb3JtV2l0aFBhcmVudEhlaWdodCgpICYmIChiICs9ICJoIik7CiAgICAgICAgYS5HZXRUcmFuc2Zvcm1XaXRoUGFyZW50QW5nbGUoKSAmJiAoYiArPSAiYSIpOwogICAgICAgIGEuR2V0VHJhbnNmb3JtV2l0aFBhcmVudFpFbGV2YXRpb24oKSAmJiAoYiArPSAieiIpOwogICAgICAgIGEuR2V0RGVzdHJveVdpdGhQYXJlbnQoKSAmJiAoYiArPSAiZCIpOwogICAgICAgIHJldHVybiBiCiAgICB9CiAgICBfR2V0UGFyZW50SnNvbihhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3BhcmVudCAmJgogICAgICAgICAgICB0aGlzLl9wYXJlbnQuR2V0SW5zdGFuY2UoKSAmJiAhdGhpcy5fcGFyZW50LkdldEluc3RhbmNlKCkuSXNEZXN0cm95ZWQoKSA/IHRoaXMuX0dldEluc3RhbmNlSnNvbih0aGlzLl9wYXJlbnQsIHRoaXMuX293bmVyLCBhKSA6IG51bGwKICAgIH0KICAgIF9HZXRDaGlsZHJlbkpzb24oYSkgewogICAgICAgIHJldHVybiB0aGlzLl9jaGlsZHJlbi5tYXAoYiA9PiB0aGlzLl9HZXRJbnN0YW5jZUpzb24oYiwgYiwgYSkpCiAgICB9CiAgICBfR2V0SW5zdGFuY2VKc29uKGEsIGIsIGQpIHsKICAgICAgICBhID0gYS5HZXRJbnN0YW5jZSgpOwogICAgICAgIGNvbnN0IGMgPSB7fTsKICAgICAgICBjLnVpZCA9IGEuR2V0VUlEKCk7CiAgICAgICAgYy5mID0gdGhpcy5fR2V0RmxhZ3NTdHJpbmcoYik7CiAgICAgICAgYy5vZmZzZXRzID0gYi5fU2F2ZVNjZW5lR3JhcGhQcm9wZXJ0aWVzVG9Kc29uKCk7CiAgICAgICAgInN0YXRlIiA9PT0gZCAmJiAoYy5vY2kgPSBhLkdldE9iamVjdENsYXNzKCkuR2V0SW5kZXgoKSwgYy5pbnN0ID0gYS5TYXZlVG9Kc29uKCkpOwogICAgICAgIHJldHVybiBjCiAgICB9CiAgICBfTG9hZEZyb21Kc29uKGEpIHsKICAgICAgICB0aGlzLl9zdGFydFdpZHRoID0gYS5zdzsKICAgICAgICB0aGlzLl9zdGFydEhlaWdodCA9IGEuc2g7CiAgICAgICAgdGhpcy5fc3RhcnRTY2FsZVggPQogICAgICAgICAgICBhLnN4OwogICAgICAgIHRoaXMuX3N0YXJ0U2NhbGVZID0gYS5zeTsKICAgICAgICB0aGlzLl9wYXJlbnRTdGFydEFuZ2xlID0gYS5wc2EKICAgIH0KICAgIF9TZXRUbXBTY2VuZUdyYXBoQ2hpbGRyZW4oYSwgYikgewogICAgICAgIHRoaXMuX3RtcFNjZW5lR3JhcGhDaGlsZHJlbiA9IGE7CiAgICAgICAgdGhpcy5fdG1wU2NlbmVHcmFwaENoaWxkcmVuSW5kZXhlcyA9IGIKICAgIH0KICAgIF9PbkFmdGVyTG9hZChhLCBiKSB7CiAgICAgICAgY29uc3QgZCA9IHRoaXMuX293bmVyLAogICAgICAgICAgICBjID0gZC5HZXRSdW50aW1lKCksCiAgICAgICAgICAgIGUgPSBuZXcgU2V0OwogICAgICAgIGlmIChhLnAgJiYgIXRoaXMuX3BhcmVudCkgewogICAgICAgICAgICB2YXIgZyA9IGMuR2V0SW5zdGFuY2VCeVVJRChhLnAudWlkKTsKICAgICAgICAgICAgaWYgKGcpIHsKICAgICAgICAgICAgICAgIHZhciBrID0gZy5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgICAgIGcuSGFzQ2hpbGQodGhpcy5fb3duZXIuR2V0SW5zdGFuY2UoKSkgPyB0aGlzLl9wYXJlbnQgPSBrIDogKGcuQWRkQ2hpbGQodGhpcy5fb3duZXIuR2V0SW5zdGFuY2UoKSwgdGhpcy5fR2V0RmxhZ3NPYmooYS5wLmYpKSwgZS5oYXModGhpcy5fb3duZXIpIHx8IHRoaXMuX293bmVyLl9Mb2FkU2NlbmVHcmFwaFByb3BlcnRpZXNGcm9tSnNvbihhLnAub2Zmc2V0cyksCiAgICAgICAgICAgICAgICAgICAgZS5hZGQodGhpcy5fb3duZXIpLCBnLkdldFdvcmxkSW5mbygpLl9HZXRTY2VuZUdyYXBoSW5mbygpLl9NYXliZVNvcnRDaGlsZHJlbigpKQogICAgICAgICAgICB9IGVsc2UgQzMkanNjb21wJDE1OC5Jc0Zpbml0ZU51bWJlcihhLnAub2NpKSAmJiAoZyA9IGMuR2V0T2JqZWN0Q2xhc3NCeUluZGV4KGEucC5vY2kpLCBjLkdldFN5c3RlbVBsdWdpbigpLCBnID0gYy5DcmVhdGVJbnN0YW5jZShnLCBkLkdldExheWVyKCksIDAsIDAsICEwKSkgJiYgKGcuTG9hZEZyb21Kc29uKGEucC5pbnN0KSwgZy5HZXRXb3JsZEluZm8oKS5HZXRMYXllcigpLlNvcnRBbmRBZGRJbnN0YW5jZXNCeVpJbmRleChnKSwgZy5BZGRDaGlsZChkLkdldEluc3RhbmNlKCksIHRoaXMuX0dldEZsYWdzT2JqKGEucC5mKSksIGcuR2V0V29ybGRJbmZvKCkuX0dldFNjZW5lR3JhcGhJbmZvKCkuX01heWJlU29ydENoaWxkcmVuKCkpCiAgICAgICAgfQogICAgICAgIGcgPSBbXTsKICAgICAgICBmb3IgKHZhciBtIG9mIGEuYykoayA9IGMuR2V0SW5zdGFuY2VCeVVJRChtLnVpZCkpICYmIGcucHVzaChrKTsKICAgICAgICBtID0gMDsKICAgICAgICBmb3IgKGNvbnN0IHUgb2YgYS5jKSB7CiAgICAgICAgICAgIGlmIChrID0KICAgICAgICAgICAgICAgIGMuR2V0SW5zdGFuY2VCeVVJRCh1LnVpZCkpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl90bXBTY2VuZUdyYXBoQ2hpbGRyZW4gJiYgdGhpcy5fdG1wU2NlbmVHcmFwaENoaWxkcmVuW21dKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIG4gPSB0aGlzLl90bXBTY2VuZUdyYXBoQ2hpbGRyZW5bbV07CiAgICAgICAgICAgICAgICAgICAgaWYgKG4uR2V0T2JqZWN0Q2xhc3MoKSAhPT0gay5HZXRPYmplY3RDbGFzcygpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG0rKzsKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKG4uSXNEZXN0cm95ZWQoKSkgewogICAgICAgICAgICAgICAgICAgICAgICBtKys7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGsgPSBhLmNbbV07CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fQWRkQW5kU2V0Q2hpbGRJbnN0YW5jZShuLkdldFdvcmxkSW5mbygpLCBrLCBlLCAhMSk7CiAgICAgICAgICAgICAgICAgICAgbSsrOwogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB2YXIgcSA9IGsuR2V0T2JqZWN0Q2xhc3MoKTsKICAgICAgICAgICAgICAgIG4gPSB0aGlzLl9HZXRJbnN0YW5jZXNPZk9iamVjdENsYXNzQ291bnQoZywgcSk7CiAgICAgICAgICAgICAgICBxID0gZC5HZXRJbnN0YW5jZSgpLkdldENoaWxkcmVuT2ZPYmplY3RDbGFzcyhxKS5sZW5ndGg7CiAgICAgICAgICAgICAgICBpZiAobiA9PT0gcSkgewogICAgICAgICAgICAgICAgICAgIGlmIChrID0gZC5HZXRJbnN0YW5jZSgpLkdldENoaWxkQXQobSkuR2V0V29ybGRJbmZvKCkpIGUuaGFzKGspIHx8IGsuX0xvYWRTY2VuZUdyYXBoUHJvcGVydGllc0Zyb21Kc29uKHUub2Zmc2V0cyksCiAgICAgICAgICAgICAgICAgICAgICAgIGUuYWRkKGspOwogICAgICAgICAgICAgICAgICAgIG0rKzsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGsuSGFzUGFyZW50KCkpIHsKICAgICAgICAgICAgICAgICAgICBrID0gdGhpcy5fQ3JlYXRlTmV3Q2hpbGRJbnN0YW5jZSh1LCBiKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9BZGRBbmRTZXRDaGlsZEluc3RhbmNlKGssIHUsIGUpOwogICAgICAgICAgICAgICAgICAgIG0rKzsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5fQWRkQW5kU2V0Q2hpbGRJbnN0YW5jZShrLkdldFdvcmxkSW5mbygpLCB1LCBlKQogICAgICAgICAgICB9IGVsc2UgayA9IHRoaXMuX0NyZWF0ZU5ld0NoaWxkSW5zdGFuY2UodSwgYiksIHRoaXMuX0FkZEFuZFNldENoaWxkSW5zdGFuY2UoaywgdSwgZSk7CiAgICAgICAgICAgIG0rKwogICAgICAgIH0KICAgIH0KICAgIF9HZXRGbGFnc09iaihhKSB7CiAgICAgICAgY29uc3QgYiA9IHt9OwogICAgICAgIGIudHJhbnNmb3JtWCA9IGEuaW5jbHVkZXMoIngiKTsKICAgICAgICBiLnRyYW5zZm9ybVkgPSBhLmluY2x1ZGVzKCJ5Iik7CiAgICAgICAgYi50cmFuc2Zvcm1XaWR0aCA9IGEuaW5jbHVkZXMoInciKTsKICAgICAgICBiLnRyYW5zZm9ybUhlaWdodCA9IGEuaW5jbHVkZXMoImgiKTsKICAgICAgICBiLnRyYW5zZm9ybUFuZ2xlID0gYS5pbmNsdWRlcygiYSIpOwogICAgICAgIGIudHJhbnNmb3JtWkVsZXZhdGlvbiA9IGEuaW5jbHVkZXMoInoiKTsKICAgICAgICBiLmRlc3Ryb3lXaXRoUGFyZW50ID0KICAgICAgICAgICAgYS5pbmNsdWRlcygiZCIpOwogICAgICAgIHJldHVybiBiCiAgICB9CiAgICBfQ3JlYXRlTmV3Q2hpbGRJbnN0YW5jZShhLCBiKSB7CiAgICAgICAgaWYgKEMzJGpzY29tcCQxNTguSXNGaW5pdGVOdW1iZXIoYS5vY2kpKSB7CiAgICAgICAgICAgIGIgPSB0aGlzLl9vd25lcjsKICAgICAgICAgICAgdmFyIGQgPSBiLkdldFJ1bnRpbWUoKSwKICAgICAgICAgICAgICAgIGMgPSBkLkdldE9iamVjdENsYXNzQnlJbmRleChhLm9jaSk7CiAgICAgICAgICAgIGQuR2V0U3lzdGVtUGx1Z2luKCk7CiAgICAgICAgICAgIGlmIChiID0gZC5DcmVhdGVJbnN0YW5jZShjLCBiLkdldExheWVyKCksIDAsIDAsICEwKSkgcmV0dXJuIGIuTG9hZEZyb21Kc29uKGEuaW5zdCksIGEgPSBiLkdldFdvcmxkSW5mbygpLCBhLkdldExheWVyKCkuU29ydEFuZEFkZEluc3RhbmNlc0J5WkluZGV4KGIpLCBhCiAgICAgICAgfQogICAgfQogICAgX0FkZEFuZFNldENoaWxkSW5zdGFuY2UoYSwgYiwgZCwgYyA9ICEwKSB7CiAgICAgICAgdGhpcy5fb3duZXIuQWRkQ2hpbGQoYSwgdGhpcy5fR2V0RmxhZ3NPYmooYi5mKSk7CiAgICAgICAgYyAmJiAoZC5oYXMoYSkgfHwgYS5fTG9hZFNjZW5lR3JhcGhQcm9wZXJ0aWVzRnJvbUpzb24oYi5vZmZzZXRzKSwgZC5hZGQoYSkpOwogICAgICAgIHRoaXMuX01heWJlU29ydENoaWxkcmVuKCkKICAgIH0KICAgIF9HZXRJbnN0YW5jZXNPZk9iamVjdENsYXNzQ291bnQoYSwKICAgICAgICBiKSB7CiAgICAgICAgcmV0dXJuIGEuZmlsdGVyKGQgPT4gZC5HZXRPYmplY3RDbGFzcygpLkdldE5hbWUoKSA9PT0gYi5HZXROYW1lKCkpLmxlbmd0aAogICAgfQp9OwoidXNlIHN0cmljdCI7CmNvbnN0IEMzJGpzY29tcCQxNTkgPSBzZWxmLkMzLAogICAgdGVtcFJlY3QkanNjb21wJDYgPSBDMyRqc2NvbXAkMTU5Lk5ldyhDMyRqc2NvbXAkMTU5LlJlY3QpLAogICAgdGVtcFF1YWQkanNjb21wJDMgPSBDMyRqc2NvbXAkMTU5Lk5ldyhDMyRqc2NvbXAkMTU5LlF1YWQpLAogICAgYmJveENoYW5nZUV2ZW50ID0gQzMkanNjb21wJDE1OS5OZXcoQzMkanNjb21wJDE1OS5FdmVudCwgImJib3hjaGFuZ2UiLCAhMSksCiAgICB0ZW1wQ29sb3IkanNjb21wJDYgPSBDMyRqc2NvbXAkMTU5Lk5ldyhDMyRqc2NvbXAkMTU5LkNvbG9yLCAwLCAwLCAwLCAwKSwKICAgIHRlbXBDb2xsaXNpb25Qb2x5ID0gQzMkanNjb21wJDE1OS5OZXcoQzMkanNjb21wJDE1OS5Db2xsaXNpb25Qb2x5KSwKICAgIERFRkFVTFRfQ09MT1IgPSBDMyRqc2NvbXAkMTU5Lk5ldyhDMyRqc2NvbXAkMTU5LkNvbG9yLCAxLCAxLCAxLCAxKSwKICAgIERFRkFVTFRfUkVOREVSX0NFTExTID0gQzMkanNjb21wJDE1OS5OZXcoQzMkanNjb21wJDE1OS5SZWN0LCAwLCAwLCAtMSwgLTEpLAogICAgREVGQVVMVF9DT0xMSVNJT05fQ0VMTFMgPSBDMyRqc2NvbXAkMTU5Lk5ldyhDMyRqc2NvbXAkMTU5LlJlY3QsCiAgICAgICAgMCwgMCwgLTEsIC0xKSwKICAgIFZBTElEX1NFVF9NRVNIX1BPSU5UX01PREVTID0gbmV3IFNldChbImFic29sdXRlIiwgInJlbGF0aXZlIl0pLAogICAgRU1QVFlfQVJSQVkkanNjb21wJDIgPSBbXTsKbGV0IGVuYWJsZVVwZGF0ZVJlbmRlcmVyU3RhdGVHcm91cCA9ICEwOwpjb25zdCBGTEFHX0lTX1ZJU0lCTEUgPSAxLAogICAgRkxBR19CQk9YX0NIQU5HRUQgPSAyLAogICAgRkxBR19FTkFCTEVfQkJPWF9DSEFOR0VEX0VWRU5UID0gNCwKICAgIEZMQUdfQ09MTElTSU9OX0VOQUJMRUQgPSA4LAogICAgRkxBR19DT0xMSVNJT05fQ0VMTF9DSEFOR0VEID0gMTYsCiAgICBGTEFHX1NPTElEX0ZJTFRFUl9JTkNMVVNJVkUgPSAzMiwKICAgIEZMQUdfSEFTX0FOWV9BQ1RJVkVfRUZGRUNUID0gNjQsCiAgICBGTEFHX0lTX1JPVEFUQUJMRSA9IDEyOCwKICAgIEZMQUdfREVTVFJPWUVEJGpzY29tcCQxID0gMjU2LAogICAgRkxBR19ERVNUUk9ZX1dJVEhfUEFSRU5UID0gNTEyLAogICAgRkxBR19UUkFOU0ZPUk1fV0lUSF9QQVJFTlRfWCA9IDEwMjQsCiAgICBGTEFHX1RSQU5TRk9STV9XSVRIX1BBUkVOVF9ZID0gMjA0OCwKICAgIEZMQUdfVFJBTlNGT1JNX1dJVEhfUEFSRU5UX1cgPSA0MDk2LAogICAgRkxBR19UUkFOU0ZPUk1fV0lUSF9QQVJFTlRfSCA9IDgxOTIsCiAgICBGTEFHX1RSQU5TRk9STV9XSVRIX1BBUkVOVF9BID0gMTYzODQsCiAgICBGTEFHX1RSQU5TRk9STV9XSVRIX1BBUkVOVF9aX0VMRVZBVElPTiA9IDMyNzY4LAogICAgTUFTS19BTExfU0NFTkVfR1JBUEhfRkxBR1MgPQogICAgRkxBR19ERVNUUk9ZX1dJVEhfUEFSRU5UIHwgRkxBR19UUkFOU0ZPUk1fV0lUSF9QQVJFTlRfWCB8IEZMQUdfVFJBTlNGT1JNX1dJVEhfUEFSRU5UX1kgfCBGTEFHX1RSQU5TRk9STV9XSVRIX1BBUkVOVF9XIHwgRkxBR19UUkFOU0ZPUk1fV0lUSF9QQVJFTlRfSCB8IEZMQUdfVFJBTlNGT1JNX1dJVEhfUEFSRU5UX0EgfCBGTEFHX1RSQU5TRk9STV9XSVRIX1BBUkVOVF9aX0VMRVZBVElPTiwKICAgIEZMQUdfTUVTSF9DSEFOR0VEID0gNjU1MzYsCiAgICBGTEFHX1BIWVNJQ1NfQk9EWV9DSEFOR0VEID0gMTMxMDcyLAogICAgRkxBR19TSU5fQ09TX0FOR0xFX0NIQU5HRUQgPSAyNjIxNDQsCiAgICBGTEFHX1VTRV9QT0lOVFNfU0hBREVSX1BST0dSQU0gPSA1MjQyODgsCiAgICBGTEFHX0RSQVdfQkFDS19GQUNFX09OTFkgPSAxMDQ4NTc2LAogICAgRkxBR19EUkFXX05PTl9CQUNLX0ZBQ0VTX09OTFkgPSAyMDk3MTUyLAogICAgRkxBR19CTEVORF9NT0RFX01BU0sgPSAyMDgwMzc0Nzg0LAogICAgc2NlbmVHcmFwaEV4cG9ydERhdGFNYXAgPSBuZXcgV2Vha01hcCwKICAgIHNjZW5lR3JhcGhaSW5kZXhNYXAgPSBuZXcgV2Vha01hcCwKICAgIG5lZWRzU2NlbmVHcmFwaEFmdGVyTG9hZCA9IG5ldyBXZWFrTWFwOwpDMyRqc2NvbXAkMTU5LldvcmxkSW5mbyA9IGNsYXNzIGV4dGVuZHMgQzMkanNjb21wJDE1OS5EZWZlbmRlZEJhc2UgewogICAgY29uc3RydWN0b3IoYSwgYikgewogICAgICAgIHN1cGVyKCk7CiAgICAgICAgdGhpcy5faW5zdCA9IGE7CiAgICAgICAgdGhpcy5fb2JqZWN0Q2xhc3MgPSBhLkdldE9iamVjdENsYXNzKCk7CiAgICAgICAgdGhpcy5fcnVudGltZSA9IGEuR2V0UnVudGltZSgpOwogICAgICAgIHRoaXMuX2xheWVyID0gYjsKICAgICAgICB0aGlzLl96SW5kZXggPSAtMTsKICAgICAgICB0aGlzLl9mbGFncyA9IEZMQUdfSVNfVklTSUJMRSB8IEZMQUdfQkJPWF9DSEFOR0VEIHwgRkxBR19DT0xMSVNJT05fRU5BQkxFRCB8IEZMQUdfQ09MTElTSU9OX0NFTExfQ0hBTkdFRCB8IEZMQUdfTUVTSF9DSEFOR0VEIHwgRkxBR19QSFlTSUNTX0JPRFlfQ0hBTkdFRDsKICAgICAgICB0aGlzLl9vYmplY3RDbGFzcy5HZXRQbHVnaW4oKS5Jc1JvdGF0YWJsZSgpICYmICh0aGlzLl9mbGFncyB8PSBGTEFHX0lTX1JPVEFUQUJMRSk7CiAgICAgICAgdGhpcy5fb3kgPSB0aGlzLl9veCA9IHRoaXMuX2Nvc0EgPSB0aGlzLl9zaW5BID0gdGhpcy5fYSA9IHRoaXMuX2RlcHRoID0gdGhpcy5faCA9IHRoaXMuX3cgPSB0aGlzLl96RWxldmF0aW9uID0KICAgICAgICAgICAgdGhpcy5feSA9IHRoaXMuX3ggPSBOYU47CiAgICAgICAgdGhpcy5fYm91bmRpbmdCb3ggPSBDMyRqc2NvbXAkMTU5Lk5ldyhDMyRqc2NvbXAkMTU5LlJlY3QpOwogICAgICAgIHRoaXMuX2JvdW5kaW5nUXVhZCA9IEMzJGpzY29tcCQxNTkuTmV3KEMzJGpzY29tcCQxNTkuUXVhZCk7CiAgICAgICAgdGhpcy5fY29sbGlzaW9uQ2VsbHMgPSBERUZBVUxUX0NPTExJU0lPTl9DRUxMUzsKICAgICAgICB0aGlzLl9yZW5kZXJDZWxscyA9IERFRkFVTFRfUkVOREVSX0NFTExTOwogICAgICAgIHRoaXMuX3NvbGlkRmlsdGVyVGFncyA9IHRoaXMuX3RyYW5zZm9ybWVkUG9seUluZm8gPSB0aGlzLl9zb3VyY2VDb2xsaXNpb25Qb2x5ID0gbnVsbDsKICAgICAgICB0aGlzLl9jb2xvclByZW11bHRpcGxpZWQgPSB0aGlzLl9jb2xvciA9IERFRkFVTFRfQ09MT1I7CiAgICAgICAgdGhpcy5faW5zdGFuY2VFZmZlY3RMaXN0ID0gdGhpcy5fc3RhdGVHcm91cCA9IG51bGw7CiAgICAgICAgdGhpcy5faW5zdC5HZXRPYmplY3RDbGFzcygpLlVzZXNFZmZlY3RzKCkgJiYgKHRoaXMuX2luc3RhbmNlRWZmZWN0TGlzdCA9IEMzJGpzY29tcCQxNTkuTmV3KEMzJGpzY29tcCQxNTkuSW5zdGFuY2VFZmZlY3RMaXN0LAogICAgICAgICAgICB0aGlzLl9pbnN0LCB0aGlzKSk7CiAgICAgICAgdGhpcy5fbWVzaEluZm8gPSB0aGlzLl90bXBTY2VuZUdyYXBoQ2hpbGRyZW5JbmRleGVzID0gdGhpcy5fdG1wU2NlbmVHcmFwaENoaWxkcmVuID0gdGhpcy5fc2NlbmVHcmFwaEluZm8gPSBudWxsCiAgICB9CiAgICBfTWFya0Rlc3Ryb3llZCgpIHsKICAgICAgICB0aGlzLl9mbGFncyB8PSBGTEFHX0RFU1RST1lFRCRqc2NvbXAkMQogICAgfQogICAgUmVsZWFzZSgpIHsKICAgICAgICB0aGlzLl9zdGF0ZUdyb3VwICYmICh0aGlzLl9ydW50aW1lLkdldFJlbmRlcmVyKCkuUmVsZWFzZVN0YXRlR3JvdXAodGhpcy5fc3RhdGVHcm91cCksIHRoaXMuX3N0YXRlR3JvdXAgPSBudWxsKTsKICAgICAgICB0aGlzLl9zb3VyY2VDb2xsaXNpb25Qb2x5ID0gbnVsbDsKICAgICAgICB0aGlzLl90cmFuc2Zvcm1lZFBvbHlJbmZvICYmICh0aGlzLl90cmFuc2Zvcm1lZFBvbHlJbmZvLnBvbHkuUmVsZWFzZSgpLCB0aGlzLl90cmFuc2Zvcm1lZFBvbHlJbmZvID0gbnVsbCk7CiAgICAgICAgdGhpcy5fc29saWRGaWx0ZXJUYWdzICYmICh0aGlzLl9zb2xpZEZpbHRlclRhZ3MuY2xlYXIoKSwgdGhpcy5fc29saWRGaWx0ZXJUYWdzID0gbnVsbCk7CiAgICAgICAgdGhpcy5SZWxlYXNlTWVzaCgpOwogICAgICAgIHRoaXMuSGFzUGFyZW50KCkgJiYgdGhpcy5HZXRQYXJlbnQoKS5SZW1vdmVDaGlsZCh0aGlzKTsKICAgICAgICBpZiAodGhpcy5IYXNDaGlsZHJlbigpKSB7CiAgICAgICAgICAgIGNvbnN0IGEgPSBbLi4udGhpcy5HZXRDaGlsZHJlbigpXTsKICAgICAgICAgICAgZm9yIChjb25zdCBiIG9mIGEpIHRoaXMuUmVtb3ZlQ2hpbGQoYikKICAgICAgICB9CiAgICAgICAgdGhpcy5fUmVsZWFzZVNjZW5lR3JhcGhJbmZvKCk7CiAgICAgICAgdGhpcy5fUmVsZWFzZVRtcFNjZW5lR3JhcGhJbmZvKCk7CiAgICAgICAgc2NlbmVHcmFwaEV4cG9ydERhdGFNYXAuZGVsZXRlKHRoaXMpOwogICAgICAgIHNjZW5lR3JhcGhaSW5kZXhNYXAuZGVsZXRlKHRoaXMpOwogICAgICAgIHRoaXMuX2xheWVyID0gdGhpcy5fcnVudGltZSA9IHRoaXMuX29iamVjdENsYXNzID0gdGhpcy5faW5zdCA9IG51bGwKICAgIH0KICAgIEluaXQoYSkgewogICAgICAgIGVuYWJsZVVwZGF0ZVJlbmRlcmVyU3RhdGVHcm91cCA9ICExOwogICAgICAgIHRoaXMuU2V0WFkoYVswXSwgYVsxXSk7CiAgICAgICAgdGhpcy5TZXRaRWxldmF0aW9uKGFbMl0pOwogICAgICAgIHRoaXMuU2V0U2l6ZShhWzNdLCBhWzRdKTsKICAgICAgICB0aGlzLl9kZXB0aCA9IDA7CiAgICAgICAgdGhpcy5Jc1JvdGF0YWJsZSgpID8KICAgICAgICAgICAgdGhpcy5TZXRBbmdsZShhWzZdKSA6IHRoaXMuX2EgPSAwOwogICAgICAgIHRlbXBDb2xvciRqc2NvbXAkNi5zZXRGcm9tSlNPTihhWzddKTsKICAgICAgICB0aGlzLl9TZXRDb2xvcih0ZW1wQ29sb3IkanNjb21wJDYpOwogICAgICAgIHRoaXMuU2V0T3JpZ2luWChhWzhdKTsKICAgICAgICB0aGlzLlNldE9yaWdpblkoYVs5XSk7CiAgICAgICAgdGhpcy5TZXRCbGVuZE1vZGUoYVsxMF0pOwogICAgICAgIHRoaXMuX2luc3RhbmNlRWZmZWN0TGlzdCAmJiB0aGlzLl9pbnN0YW5jZUVmZmVjdExpc3QuX0xvYWRFZmZlY3RQYXJhbWV0ZXJzKGFbMTJdKTsKICAgICAgICBhWzE0XSAmJiBzY2VuZUdyYXBoRXhwb3J0RGF0YU1hcC5zZXQodGhpcywgewogICAgICAgICAgICBjaGlsZHJlbkRhdGE6IGFbMTRdWzFdLAogICAgICAgICAgICB6SW5kZXhEYXRhOiBhWzE0XVsyXQogICAgICAgIH0pOwogICAgICAgIGlmIChhWzE1XSkgewogICAgICAgICAgICB2YXIgYiA9IGFbMTVdOwogICAgICAgICAgICB0aGlzLkNyZWF0ZU1lc2goYlswXSwgYlsxXSk7CiAgICAgICAgICAgIHZhciBkID0gdGhpcy5HZXRTb3VyY2VNZXNoKCk7CiAgICAgICAgICAgIGIgPSBiWzJdOwogICAgICAgICAgICBmb3IgKGxldCBnID0gMCwgayA9IGIubGVuZ3RoOyBnIDwgazsgKytnKSB7CiAgICAgICAgICAgICAgICB2YXIgYyA9IGJbZ107CiAgICAgICAgICAgICAgICBmb3IgKGxldCBtID0gMCwgbiA9IGMubGVuZ3RoOyBtIDwgbjsgKyttKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGUgPSBjW21dOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHEgPSBkLkdldE1lc2hQb2ludEF0KG0sIGcpOwogICAgICAgICAgICAgICAgICAgIHEuU2V0WChlWzBdKTsKICAgICAgICAgICAgICAgICAgICBxLlNldFkoZVsxXSk7CiAgICAgICAgICAgICAgICAgICAgcS5TZXRaRWxldmF0aW9uKGVbMl0pOwogICAgICAgICAgICAgICAgICAgIHEuU2V0VShlWzNdKTsKICAgICAgICAgICAgICAgICAgICBxLlNldFYoZVs0XSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBhWzE2XSAmJiAoZCA9IGFbMTZdWzBdLCBhID0gYVsxNl1bMV0sIGIgPSAhIWEsIGMgPSAhYiwgZSA9IHRoaXMuX3J1bnRpbWUuR2V0VGVtcGxhdGVNYW5hZ2VyKCksIGIgJiYgZSAmJiBlLk1hcEluc3RhbmNlVG9UZW1wbGF0ZU5hbWUodGhpcy5HZXRJbnN0YW5jZSgpLCBhKSwgYyAmJiBlICYmIGUuTWFwSW5zdGFuY2VUb1RlbXBsYXRlTmFtZSh0aGlzLkdldEluc3RhbmNlKCksIGQpKTsKICAgICAgICBlbmFibGVVcGRhdGVSZW5kZXJlclN0YXRlR3JvdXAgPSAhMDsKICAgICAgICB0aGlzLl9VcGRhdGVSZW5kZXJlclN0YXRlR3JvdXAoKQogICAgfQogICAgSW5pdE5vRGF0YSgpIHsKICAgICAgICB0aGlzLl9zaW5BID0gdGhpcy5fYSA9IHRoaXMuX2RlcHRoID0gdGhpcy5faCA9IHRoaXMuX3cgPSB0aGlzLl96RWxldmF0aW9uID0gdGhpcy5feSA9IHRoaXMuX3ggPSAwOwogICAgICAgIHRoaXMuX2Nvc0EgPSAxOwogICAgICAgIHRoaXMuX295ID0gdGhpcy5fb3ggPSAwOwogICAgICAgIHRoaXMuX1VwZGF0ZVJlbmRlcmVyU3RhdGVHcm91cCgpCiAgICB9CiAgICBHZXRSdW50aW1lKCkgewogICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lCiAgICB9CiAgICBHZXRPYmplY3RDbGFzcygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fb2JqZWN0Q2xhc3MKICAgIH0KICAgIEdldEluc3RhbmNlKCkgewogICAgICAgIHJldHVybiB0aGlzLl9pbnN0CiAgICB9CiAgICBfR2V0UGFyZW50T2Zmc2V0QW5nbGUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuR2V0VHJhbnNmb3JtV2l0aFBhcmVudEFuZ2xlKCkgPwogICAgICAgICAgICB0aGlzLkdldFBhcmVudCgpLkdldEFuZ2xlKCkgLSB0aGlzLl9zY2VuZUdyYXBoSW5mby5HZXRQYXJlbnRTdGFydEFuZ2xlKCkgOiAwCiAgICB9CiAgICBTZXRYKGEpIHsKICAgICAgICBhID0gK2E7CiAgICAgICAgaWYgKHRoaXMuR2V0VHJhbnNmb3JtV2l0aFBhcmVudFgoKSkgewogICAgICAgICAgICBjb25zdCBiID0gdGhpcy5fc2NlbmVHcmFwaEluZm87CiAgICAgICAgICAgIGEgLT0gdGhpcy5HZXRYKCk7CiAgICAgICAgICAgIGNvbnN0IGQgPSAtdGhpcy5fR2V0UGFyZW50T2Zmc2V0QW5nbGUoKTsKICAgICAgICAgICAgMCA9PT0gZCA/IHRoaXMuX3ggKz0gYSAvIGIuR2V0UGFyZW50U2NhbGVYKCkgOiAodGhpcy5feCArPSBNYXRoLmNvcyhkKSAqIGEgLyBiLkdldFBhcmVudFNjYWxlWCgpLCB0aGlzLkdldFRyYW5zZm9ybVdpdGhQYXJlbnRZKCkgJiYgKHRoaXMuX3kgKz0gTWF0aC5zaW4oZCkgKiBhIC8gYi5HZXRQYXJlbnRTY2FsZVkoKSkpCiAgICAgICAgfSBlbHNlIHRoaXMuX3ggPSBhCiAgICB9CiAgICBPZmZzZXRYKGEsIGIgPSAhMSkgewogICAgICAgIGEgPSArYTsKICAgICAgICBiID8gdGhpcy5feCArPSBhIDogdGhpcy5HZXRUcmFuc2Zvcm1XaXRoUGFyZW50WCgpID8gdGhpcy5TZXRYKHRoaXMuR2V0WCgpICsgYSkgOiB0aGlzLl94ICs9IGEKICAgIH0KICAgIEdldFgoKSB7CiAgICAgICAgaWYgKHRoaXMuR2V0VHJhbnNmb3JtV2l0aFBhcmVudFgoKSkgewogICAgICAgICAgICBsZXQgYSA9CiAgICAgICAgICAgICAgICB0aGlzLl94OwogICAgICAgICAgICBjb25zdCBiID0gdGhpcy5fc2NlbmVHcmFwaEluZm8sCiAgICAgICAgICAgICAgICBkID0gdGhpcy5HZXRQYXJlbnQoKSwKICAgICAgICAgICAgICAgIGMgPSB0aGlzLl9HZXRQYXJlbnRPZmZzZXRBbmdsZSgpOwogICAgICAgICAgICAwID09PSBjID8gYSAqPSBiLkdldFBhcmVudFNjYWxlWCgpIDogKGEgPSBhICogYi5HZXRQYXJlbnRTY2FsZVgoKSAqIE1hdGguY29zKGMpLCB0aGlzLkdldFRyYW5zZm9ybVdpdGhQYXJlbnRZKCkgJiYgKGEgLT0gdGhpcy5feSAqIGIuR2V0UGFyZW50U2NhbGVZKCkgKiBNYXRoLnNpbihjKSkpOwogICAgICAgICAgICByZXR1cm4gZC5HZXRYKCkgKyBhCiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzLl94CiAgICB9CiAgICBTZXRZKGEpIHsKICAgICAgICBhID0gK2E7CiAgICAgICAgaWYgKHRoaXMuR2V0VHJhbnNmb3JtV2l0aFBhcmVudFkoKSkgewogICAgICAgICAgICBjb25zdCBiID0gdGhpcy5fc2NlbmVHcmFwaEluZm87CiAgICAgICAgICAgIGEgLT0gdGhpcy5HZXRZKCk7CiAgICAgICAgICAgIGNvbnN0IGQgPSAtdGhpcy5fR2V0UGFyZW50T2Zmc2V0QW5nbGUoKTsKICAgICAgICAgICAgMCA9PT0gZCA/IHRoaXMuX3kgKz0gYSAvIGIuR2V0UGFyZW50U2NhbGVZKCkgOiAodGhpcy5HZXRUcmFuc2Zvcm1XaXRoUGFyZW50WCgpICYmICh0aGlzLl94IC09IE1hdGguc2luKGQpICogYSAvIGIuR2V0UGFyZW50U2NhbGVYKCkpLAogICAgICAgICAgICAgICAgdGhpcy5feSArPSBNYXRoLmNvcyhkKSAqIGEgLyBiLkdldFBhcmVudFNjYWxlWSgpKQogICAgICAgIH0gZWxzZSB0aGlzLl95ID0gYQogICAgfQogICAgT2Zmc2V0WShhLCBiID0gITEpIHsKICAgICAgICBhID0gK2E7CiAgICAgICAgYiA/IHRoaXMuX3kgKz0gYSA6IHRoaXMuR2V0VHJhbnNmb3JtV2l0aFBhcmVudFkoKSA/IHRoaXMuU2V0WSh0aGlzLkdldFkoKSArIGEpIDogdGhpcy5feSArPSBhCiAgICB9CiAgICBHZXRZKCkgewogICAgICAgIGlmICh0aGlzLkdldFRyYW5zZm9ybVdpdGhQYXJlbnRZKCkpIHsKICAgICAgICAgICAgbGV0IGEgPSB0aGlzLl95OwogICAgICAgICAgICBjb25zdCBiID0gdGhpcy5fc2NlbmVHcmFwaEluZm8sCiAgICAgICAgICAgICAgICBkID0gdGhpcy5HZXRQYXJlbnQoKSwKICAgICAgICAgICAgICAgIGMgPSB0aGlzLl9HZXRQYXJlbnRPZmZzZXRBbmdsZSgpOwogICAgICAgICAgICAwID09PSBjID8gYSAqPSBiLkdldFBhcmVudFNjYWxlWSgpIDogKGEgPSBhICogYi5HZXRQYXJlbnRTY2FsZVkoKSAqIE1hdGguY29zKGMpLCB0aGlzLkdldFRyYW5zZm9ybVdpdGhQYXJlbnRYKCkgJiYgKGEgKz0gdGhpcy5feCAqIGIuR2V0UGFyZW50U2NhbGVYKCkgKiBNYXRoLnNpbihjKSkpOwogICAgICAgICAgICByZXR1cm4gZC5HZXRZKCkgKyBhCiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzLl95CiAgICB9CiAgICBTZXRYWShhLCBiKSB7CiAgICAgICAgYSA9ICthOwogICAgICAgIGIgPSArYjsKICAgICAgICBpZiAodGhpcy5HZXRUcmFuc2Zvcm1XaXRoUGFyZW50WE9yWSgpKSB7CiAgICAgICAgICAgIGNvbnN0IGMgPQogICAgICAgICAgICAgICAgdGhpcy5HZXRUcmFuc2Zvcm1XaXRoUGFyZW50WCgpLAogICAgICAgICAgICAgICAgZSA9IHRoaXMuR2V0VHJhbnNmb3JtV2l0aFBhcmVudFkoKSwKICAgICAgICAgICAgICAgIGcgPSB0aGlzLl9zY2VuZUdyYXBoSW5mbywKICAgICAgICAgICAgICAgIGsgPSBhIC0gdGhpcy5HZXRYKCksCiAgICAgICAgICAgICAgICBtID0gYiAtIHRoaXMuR2V0WSgpOwogICAgICAgICAgICB2YXIgZCA9IC10aGlzLl9HZXRQYXJlbnRPZmZzZXRBbmdsZSgpOwogICAgICAgICAgICBpZiAoMCA9PT0gZCkgdGhpcy5feCA9IGMgPyB0aGlzLl94ICsgayAvIGcuR2V0UGFyZW50U2NhbGVYKCkgOiBhLCB0aGlzLl95ID0gZSA/IHRoaXMuX3kgKyBtIC8gZy5HZXRQYXJlbnRTY2FsZVkoKSA6IGI7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgY29uc3QgbiA9IE1hdGguc2luKGQpOwogICAgICAgICAgICAgICAgZCA9IE1hdGguY29zKGQpOwogICAgICAgICAgICAgICAgdGhpcy5feCA9IGMgPyBlID8gdGhpcy5feCArIChkICogayAtIG4gKiBtKSAvIGcuR2V0UGFyZW50U2NhbGVYKCkgOiB0aGlzLl94ICsgZCAqIGsgLyBnLkdldFBhcmVudFNjYWxlWCgpIDogYTsKICAgICAgICAgICAgICAgIHRoaXMuX3kgPSBlID8gYyA/IHRoaXMuX3kgKyAobiAqIGsgKyBkICogbSkgLyBnLkdldFBhcmVudFNjYWxlWSgpIDogdGhpcy5feSArIGQgKiBtIC8gZy5HZXRQYXJlbnRTY2FsZVkoKSA6IGIKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB0aGlzLl94ID0gYSwgdGhpcy5feSA9IGIKICAgIH0KICAgIE9mZnNldFhZKGEsIGIpIHsKICAgICAgICBhID0gK2E7CiAgICAgICAgYiA9ICtiOwogICAgICAgIHRoaXMuR2V0VHJhbnNmb3JtV2l0aFBhcmVudFhPclkoKSA/IHRoaXMuU2V0WFkodGhpcy5HZXRYKCkgKyBhLCB0aGlzLkdldFkoKSArIGIpIDogKHRoaXMuX3ggKz0gYSwgdGhpcy5feSArPSBiKQogICAgfQogICAgRXF1YWxzWFkoYSwgYikgewogICAgICAgIHJldHVybiB0aGlzLkdldFgoKSA9PT0gYSAmJiB0aGlzLkdldFkoKSA9PT0gYgogICAgfQogICAgU2V0WkVsZXZhdGlvbihhKSB7CiAgICAgICAgYSA9ICthOwogICAgICAgIHRoaXMuR2V0VHJhbnNmb3JtV2l0aFBhcmVudFpFbGV2YXRpb24oKSAmJiAoYSAtPSB0aGlzLkdldFBhcmVudCgpLkdldFpFbGV2YXRpb24oKSk7CiAgICAgICAgdGhpcy5fekVsZXZhdGlvbiAhPT0gYSAmJiAodGhpcy5fekVsZXZhdGlvbiA9IGEsIHRoaXMuX1VwZGF0ZVpFbGV2YXRpb24oKSwgYSA9IHRoaXMuR2V0TGF5ZXIoKSwgMCAhPT0gdGhpcy5fekVsZXZhdGlvbiAmJiBhLl9TZXRBbnlJbnN0YW5jZVpFbGV2YXRlZCgpLCBhLlNldFpJbmRpY2VzQ2hhbmdlZCgpKQogICAgfQogICAgX1VwZGF0ZVpFbGV2YXRpb24oKSB7CiAgICAgICAgdGhpcy5fVXBkYXRlUmVuZGVyZXJTdGF0ZUdyb3VwKCk7CiAgICAgICAgaWYgKHRoaXMuSGFzQ2hpbGRyZW4oKSkgewogICAgICAgICAgICBjb25zdCBhID0gdGhpcy5HZXRDaGlsZHJlbigpOwogICAgICAgICAgICBmb3IgKGxldCBiID0gMCwgZCA9IGEubGVuZ3RoOyBiIDwgZDsgYisrKSB7CiAgICAgICAgICAgICAgICBjb25zdCBjID0gYVtiXTsKICAgICAgICAgICAgICAgIGMuR2V0VHJhbnNmb3JtV2l0aFBhcmVudFpFbGV2YXRpb24oKSAmJiBjLl9VcGRhdGVaRWxldmF0aW9uKCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIE9mZnNldFpFbGV2YXRpb24oYSkgewogICAgICAgIHRoaXMuU2V0WkVsZXZhdGlvbih0aGlzLkdldFpFbGV2YXRpb24oKSArIGEpCiAgICB9CiAgICBHZXRaRWxldmF0aW9uKCkgewogICAgICAgIHJldHVybiB0aGlzLkdldFRyYW5zZm9ybVdpdGhQYXJlbnRaRWxldmF0aW9uKCkgPyB0aGlzLkdldFBhcmVudCgpLkdldFpFbGV2YXRpb24oKSArIHRoaXMuX3pFbGV2YXRpb24gOiB0aGlzLl96RWxldmF0aW9uCiAgICB9CiAgICBHZXRUb3RhbFpFbGV2YXRpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuR2V0TGF5ZXIoKS5HZXRaRWxldmF0aW9uKCkgKyB0aGlzLkdldFpFbGV2YXRpb24oKQogICAgfQogICAgU2V0V2lkdGgoYSkgewogICAgICAgIGEgPSArYTsKICAgICAgICBpZiAodGhpcy5HZXRUcmFuc2Zvcm1XaXRoUGFyZW50V2lkdGgoKSkgewogICAgICAgICAgICBjb25zdCBiID0gdGhpcy5HZXRXaWR0aCgpOwogICAgICAgICAgICB0aGlzLl93ID0gMCA9PT0gYiA/IE51bWJlci5FUFNJTE9OIDogYSAvIGIgKiB0aGlzLl93CiAgICAgICAgfSBlbHNlIHRoaXMuX3cgPQogICAgICAgICAgICBhCiAgICB9CiAgICBPZmZzZXRXaWR0aChhLCBiKSB7CiAgICAgICAgYSA9ICthOwogICAgICAgIGIgPyB0aGlzLl93ICs9IGEgOiB0aGlzLkdldFRyYW5zZm9ybVdpdGhQYXJlbnRXaWR0aCgpID8gdGhpcy5TZXRXaWR0aCh0aGlzLkdldFdpZHRoKCkgKyBhKSA6IHRoaXMuX3cgKz0gYQogICAgfQogICAgR2V0V2lkdGgoKSB7CiAgICAgICAgaWYgKHRoaXMuR2V0VHJhbnNmb3JtV2l0aFBhcmVudFdpZHRoKCkpIHsKICAgICAgICAgICAgY29uc3QgYSA9IHRoaXMuR2V0UGFyZW50KCksCiAgICAgICAgICAgICAgICBiID0gYS5HZXRXaWR0aCgpOwogICAgICAgICAgICByZXR1cm4gYS5fR2V0U2NlbmVHcmFwaEluZm8oKS5fR2V0U3RhcnRXaWR0aCgpID09PSBOdW1iZXIuRVBTSUxPTiA/ICh0aGlzLl9HZXRTY2VuZUdyYXBoSW5mbygpLl9HZXRTdGFydFdpZHRoKCkgKyBiKSAqIHRoaXMuX3cgOiBiICogdGhpcy5fdwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpcy5fdwogICAgfQogICAgU2V0SGVpZ2h0KGEpIHsKICAgICAgICBhID0gK2E7CiAgICAgICAgaWYgKHRoaXMuR2V0VHJhbnNmb3JtV2l0aFBhcmVudEhlaWdodCgpKSB7CiAgICAgICAgICAgIGNvbnN0IGIgPSB0aGlzLkdldEhlaWdodCgpOwogICAgICAgICAgICB0aGlzLl9oID0gMCA9PT0gYiA/IE51bWJlci5FUFNJTE9OIDogYSAvIGIgKiB0aGlzLl9oCiAgICAgICAgfSBlbHNlIHRoaXMuX2ggPSBhCiAgICB9CiAgICBPZmZzZXRIZWlnaHQoYSwKICAgICAgICBiKSB7CiAgICAgICAgYSA9ICthOwogICAgICAgIGIgPyB0aGlzLl9oICs9IGEgOiB0aGlzLkdldFRyYW5zZm9ybVdpdGhQYXJlbnRIZWlnaHQoKSA/IHRoaXMuU2V0SGVpZ2h0KHRoaXMuR2V0SGVpZ2h0KCkgKyBhKSA6IHRoaXMuX2ggKz0gYQogICAgfQogICAgR2V0SGVpZ2h0KCkgewogICAgICAgIGlmICh0aGlzLkdldFRyYW5zZm9ybVdpdGhQYXJlbnRIZWlnaHQoKSkgewogICAgICAgICAgICBjb25zdCBhID0gdGhpcy5HZXRQYXJlbnQoKSwKICAgICAgICAgICAgICAgIGIgPSBhLkdldEhlaWdodCgpOwogICAgICAgICAgICByZXR1cm4gYS5fR2V0U2NlbmVHcmFwaEluZm8oKS5fR2V0U3RhcnRIZWlnaHQoKSA9PT0gTnVtYmVyLkVQU0lMT04gPyAodGhpcy5fR2V0U2NlbmVHcmFwaEluZm8oKS5fR2V0U3RhcnRIZWlnaHQoKSArIGIpICogdGhpcy5faCA6IGIgKiB0aGlzLl9oCiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzLl9oCiAgICB9CiAgICBTZXRTaXplKGEsIGIpIHsKICAgICAgICBhID0gK2E7CiAgICAgICAgYiA9ICtiOwogICAgICAgIGlmICh0aGlzLkdldFRyYW5zZm9ybVdpdGhQYXJlbnRXaWR0aCgpKSB7CiAgICAgICAgICAgIGNvbnN0IGQgPSB0aGlzLkdldFdpZHRoKCk7CiAgICAgICAgICAgIHRoaXMuX3cgPSAwID09PSBkID8gTnVtYmVyLkVQU0lMT04gOiBhIC8gZCAqIHRoaXMuX3cKICAgICAgICB9IGVsc2UgdGhpcy5fdyA9IGE7CiAgICAgICAgdGhpcy5HZXRUcmFuc2Zvcm1XaXRoUGFyZW50SGVpZ2h0KCkgPwogICAgICAgICAgICAoYSA9IHRoaXMuR2V0SGVpZ2h0KCksIHRoaXMuX2ggPSAwID09PSBhID8gTnVtYmVyLkVQU0lMT04gOiBiIC8gYSAqIHRoaXMuX2gpIDogdGhpcy5faCA9IGIKICAgIH0KICAgIEdldERlcHRoKCkgewogICAgICAgIHJldHVybiB0aGlzLl9kZXB0aAogICAgfQogICAgU2V0RGVwdGgoYSkgewogICAgICAgIGlmICgwID4gYSkgdGhyb3cgbmV3IFJhbmdlRXJyb3IoImludmFsaWQgZGVwdGgiKTsKICAgICAgICB0aGlzLl9kZXB0aCA9IGEKICAgIH0KICAgIEdldFNjZW5lR3JhcGhTY2FsZSgpIHsKICAgICAgICBpZiAodGhpcy5IYXNQYXJlbnQoKSkgewogICAgICAgICAgICBjb25zdCBhID0gdGhpcy5fc2NlbmVHcmFwaEluZm87CiAgICAgICAgICAgIHJldHVybiBNYXRoLm1pbihhLkdldFBhcmVudFNjYWxlWCgpLCBhLkdldFBhcmVudFNjYWxlWSgpKQogICAgICAgIH0KICAgICAgICByZXR1cm4gMQogICAgfQogICAgSXNSb3RhdGFibGUoKSB7CiAgICAgICAgcmV0dXJuIDAgIT09ICh0aGlzLl9mbGFncyAmIEZMQUdfSVNfUk9UQVRBQkxFKQogICAgfQogICAgU2V0QW5nbGUoYSkgewogICAgICAgIGEgPSArYTsKICAgICAgICB0aGlzLklzUm90YXRhYmxlKCkgJiYgKHRoaXMuR2V0VHJhbnNmb3JtV2l0aFBhcmVudEFuZ2xlKCkgJiYgKGEgLT0gdGhpcy5HZXRQYXJlbnQoKS5HZXRBbmdsZSgpKSwgYSA9IEMzJGpzY29tcCQxNTkuY2xhbXBBbmdsZShhKSwKICAgICAgICAgICAgdGhpcy5fYSAhPT0gYSAmJiAodGhpcy5fYSA9IGEsIHRoaXMuX01hcmtTaW5Db3NBbmdsZUNoYW5nZWQoKSkpCiAgICB9CiAgICBPZmZzZXRBbmdsZShhKSB7CiAgICAgICAgYSA9ICthOwogICAgICAgIDAgIT09IGEgJiYgdGhpcy5Jc1JvdGF0YWJsZSgpICYmICh0aGlzLl9hID0gQzMkanNjb21wJDE1OS5jbGFtcEFuZ2xlKHRoaXMuX2EgKyBhKSwgdGhpcy5fTWFya1NpbkNvc0FuZ2xlQ2hhbmdlZCgpKQogICAgfQogICAgX01hcmtTaW5Db3NBbmdsZUNoYW5nZWQoKSB7CiAgICAgICAgdGhpcy5fZmxhZ3MgfD0gRkxBR19TSU5fQ09TX0FOR0xFX0NIQU5HRUQ7CiAgICAgICAgaWYgKHRoaXMuSGFzQ2hpbGRyZW4oKSkgewogICAgICAgICAgICBjb25zdCBhID0gdGhpcy5HZXRDaGlsZHJlbigpOwogICAgICAgICAgICBmb3IgKGxldCBiID0gMCwgZCA9IGEubGVuZ3RoOyBiIDwgZDsgYisrKSBhW2JdLl9NYXJrU2luQ29zQW5nbGVDaGFuZ2VkKCkKICAgICAgICB9CiAgICB9CiAgICBHZXRBbmdsZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5HZXRUcmFuc2Zvcm1XaXRoUGFyZW50QW5nbGUoKSA/IEMzJGpzY29tcCQxNTkuY2xhbXBBbmdsZSh0aGlzLkdldFBhcmVudCgpLkdldEFuZ2xlKCkgKyB0aGlzLl9hKSA6IHRoaXMuX2EKICAgIH0KICAgIF9NYXliZVVwZGF0ZVNpbkNvc0FuZ2xlKCkgewogICAgICAgIGNvbnN0IGEgPQogICAgICAgICAgICB0aGlzLl9mbGFnczsKICAgICAgICBpZiAoMCAhPT0gKGEgJiBGTEFHX1NJTl9DT1NfQU5HTEVfQ0hBTkdFRCkpIHsKICAgICAgICAgICAgdmFyIGIgPSB0aGlzLkdldEFuZ2xlKCk7CiAgICAgICAgICAgIHRoaXMuX3NpbkEgPSBNYXRoLnNpbihiKTsKICAgICAgICAgICAgdGhpcy5fY29zQSA9IE1hdGguY29zKGIpOwogICAgICAgICAgICB0aGlzLl9mbGFncyA9IGEgJiB+RkxBR19TSU5fQ09TX0FOR0xFX0NIQU5HRUQKICAgICAgICB9CiAgICB9CiAgICBHZXRTaW5BbmdsZSgpIHsKICAgICAgICB0aGlzLl9NYXliZVVwZGF0ZVNpbkNvc0FuZ2xlKCk7CiAgICAgICAgcmV0dXJuIHRoaXMuX3NpbkEKICAgIH0KICAgIEdldENvc0FuZ2xlKCkgewogICAgICAgIHRoaXMuX01heWJlVXBkYXRlU2luQ29zQW5nbGUoKTsKICAgICAgICByZXR1cm4gdGhpcy5fY29zQQogICAgfQogICAgU2V0T3JpZ2luWChhKSB7CiAgICAgICAgdGhpcy5fb3ggPSArYQogICAgfQogICAgT2Zmc2V0T3JpZ2luWChhKSB7CiAgICAgICAgdGhpcy5fb3ggKz0gK2EKICAgIH0KICAgIEdldE9yaWdpblgoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX294CiAgICB9CiAgICBTZXRPcmlnaW5ZKGEpIHsKICAgICAgICB0aGlzLl9veSA9ICthCiAgICB9CiAgICBPZmZzZXRPcmlnaW5ZKGEpIHsKICAgICAgICB0aGlzLl9veSArPSArYQogICAgfQogICAgR2V0T3JpZ2luWSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fb3kKICAgIH0KICAgIF9TZXRDb2xvcihhKSB7CiAgICAgICAgdGhpcy5fY29sb3IuZXF1YWxzKGEpIHx8ICh0aGlzLl9jb2xvciA9PT0KICAgICAgICAgICAgREVGQVVMVF9DT0xPUiA/ICh0aGlzLl9jb2xvciA9IEMzJGpzY29tcCQxNTkuTmV3KEMzJGpzY29tcCQxNTkuQ29sb3IsIGEpLCB0aGlzLl9jb2xvclByZW11bHRpcGxpZWQgPSBDMyRqc2NvbXAkMTU5Lk5ldyhDMyRqc2NvbXAkMTU5LkNvbG9yLCBhKSwgdGhpcy5fY29sb3JQcmVtdWx0aXBsaWVkLnByZW11bHRpcGx5KCkpIDogYS5lcXVhbHNSZ2JhKDEsIDEsIDEsIDEpID8gdGhpcy5fY29sb3JQcmVtdWx0aXBsaWVkID0gdGhpcy5fY29sb3IgPSBERUZBVUxUX0NPTE9SIDogKHRoaXMuX2NvbG9yLnNldChhKSwgdGhpcy5fY29sb3JQcmVtdWx0aXBsaWVkLnNldChhKSwgdGhpcy5fY29sb3JQcmVtdWx0aXBsaWVkLnByZW11bHRpcGx5KCkpLCB0aGlzLl9VcGRhdGVSZW5kZXJlclN0YXRlR3JvdXAoKSkKICAgIH0KICAgIFNldE9wYWNpdHkoYSkgewogICAgICAgIGEgPSBDMyRqc2NvbXAkMTU5LmNsYW1wKCthLCAwLCAxKTsKICAgICAgICB0aGlzLl9jb2xvci5hICE9PSBhICYmICh0ZW1wQ29sb3IkanNjb21wJDYuY29weVJnYih0aGlzLl9jb2xvciksIHRlbXBDb2xvciRqc2NvbXAkNi5hID0gYSwgdGhpcy5fU2V0Q29sb3IodGVtcENvbG9yJGpzY29tcCQ2KSkKICAgIH0KICAgIE9mZnNldE9wYWNpdHkoYSkgewogICAgICAgIHRoaXMuU2V0T3BhY2l0eSh0aGlzLkdldE9wYWNpdHkoKSArCiAgICAgICAgICAgIGEpCiAgICB9CiAgICBHZXRPcGFjaXR5KCkgewogICAgICAgIHJldHVybiB0aGlzLl9jb2xvci5hCiAgICB9CiAgICBTZXRVbnByZW11bHRpcGxpZWRDb2xvcihhKSB7CiAgICAgICAgdGhpcy5fY29sb3IuZXF1YWxzSWdub3JpbmdBbHBoYShhKSB8fCAodGVtcENvbG9yJGpzY29tcCQ2LmNvcHlSZ2IoYSksIHRlbXBDb2xvciRqc2NvbXAkNi5hID0gdGhpcy5fY29sb3IuYSwgdGhpcy5fU2V0Q29sb3IodGVtcENvbG9yJGpzY29tcCQ2KSkKICAgIH0KICAgIFNldFVucHJlbXVsdGlwbGllZENvbG9yUkdCKGEsIGIsIGQpIHsKICAgICAgICB0ZW1wQ29sb3IkanNjb21wJDYuc2V0UmdiKGEsIGIsIGQpOwogICAgICAgIHRoaXMuU2V0VW5wcmVtdWx0aXBsaWVkQ29sb3IodGVtcENvbG9yJGpzY29tcCQ2KQogICAgfQogICAgT2Zmc2V0VW5wcmVtdWx0aXBsaWVkQ29sb3JSR0IoYSwgYiwgZCkgewogICAgICAgIGlmICgwICE9PSBhIHx8IDAgIT09IGIgfHwgMCAhPT0gZCkgdGVtcENvbG9yJGpzY29tcCQ2LmNvcHlSZ2IodGhpcy5fY29sb3IpLCB0ZW1wQ29sb3IkanNjb21wJDYuciArPSBhLCB0ZW1wQ29sb3IkanNjb21wJDYuZyArPSBiLCB0ZW1wQ29sb3IkanNjb21wJDYuYiArPSBkLCB0aGlzLlNldFVucHJlbXVsdGlwbGllZENvbG9yKHRlbXBDb2xvciRqc2NvbXAkNikKICAgIH0KICAgIEdldFVucHJlbXVsdGlwbGllZENvbG9yKCkgewogICAgICAgIHJldHVybiB0aGlzLl9jb2xvcgogICAgfQogICAgR2V0UHJlbXVsdGlwbGllZENvbG9yKCkgewogICAgICAgIHJldHVybiB0aGlzLl9jb2xvclByZW11bHRpcGxpZWQKICAgIH0KICAgIEdldERlc3Ryb3lXaXRoUGFyZW50KCkgewogICAgICAgIHJldHVybiAwICE9PQogICAgICAgICAgICAodGhpcy5fZmxhZ3MgJiBGTEFHX0RFU1RST1lfV0lUSF9QQVJFTlQpCiAgICB9CiAgICBTZXREZXN0cm95V2l0aFBhcmVudChhKSB7CiAgICAgICAgdGhpcy5fU2V0RmxhZyhGTEFHX0RFU1RST1lfV0lUSF9QQVJFTlQsIGEpCiAgICB9CiAgICBHZXRUcmFuc2Zvcm1XaXRoUGFyZW50WCgpIHsKICAgICAgICByZXR1cm4gMCAhPT0gKHRoaXMuX2ZsYWdzICYgRkxBR19UUkFOU0ZPUk1fV0lUSF9QQVJFTlRfWCkKICAgIH0KICAgIFNldFRyYW5zZm9ybVdpdGhQYXJlbnRYKGEpIHsKICAgICAgICB0aGlzLl9TZXRGbGFnKEZMQUdfVFJBTlNGT1JNX1dJVEhfUEFSRU5UX1gsIGEpCiAgICB9CiAgICBHZXRUcmFuc2Zvcm1XaXRoUGFyZW50WSgpIHsKICAgICAgICByZXR1cm4gMCAhPT0gKHRoaXMuX2ZsYWdzICYgRkxBR19UUkFOU0ZPUk1fV0lUSF9QQVJFTlRfWSkKICAgIH0KICAgIEdldFRyYW5zZm9ybVdpdGhQYXJlbnRYT3JZKCkgewogICAgICAgIHJldHVybiAwICE9PSAodGhpcy5fZmxhZ3MgJiAoRkxBR19UUkFOU0ZPUk1fV0lUSF9QQVJFTlRfWCB8IEZMQUdfVFJBTlNGT1JNX1dJVEhfUEFSRU5UX1kpKQogICAgfQogICAgU2V0VHJhbnNmb3JtV2l0aFBhcmVudFkoYSkgewogICAgICAgIHRoaXMuX1NldEZsYWcoRkxBR19UUkFOU0ZPUk1fV0lUSF9QQVJFTlRfWSwKICAgICAgICAgICAgYSkKICAgIH0KICAgIEdldFRyYW5zZm9ybVdpdGhQYXJlbnRXaWR0aCgpIHsKICAgICAgICByZXR1cm4gMCAhPT0gKHRoaXMuX2ZsYWdzICYgRkxBR19UUkFOU0ZPUk1fV0lUSF9QQVJFTlRfVykKICAgIH0KICAgIFNldFRyYW5zZm9ybVdpdGhQYXJlbnRXaWR0aChhKSB7CiAgICAgICAgdGhpcy5fU2V0RmxhZyhGTEFHX1RSQU5TRk9STV9XSVRIX1BBUkVOVF9XLCBhKQogICAgfQogICAgR2V0VHJhbnNmb3JtV2l0aFBhcmVudEhlaWdodCgpIHsKICAgICAgICByZXR1cm4gMCAhPT0gKHRoaXMuX2ZsYWdzICYgRkxBR19UUkFOU0ZPUk1fV0lUSF9QQVJFTlRfSCkKICAgIH0KICAgIFNldFRyYW5zZm9ybVdpdGhQYXJlbnRIZWlnaHQoYSkgewogICAgICAgIHRoaXMuX1NldEZsYWcoRkxBR19UUkFOU0ZPUk1fV0lUSF9QQVJFTlRfSCwgYSkKICAgIH0KICAgIEdldFRyYW5zZm9ybVdpdGhQYXJlbnRBbmdsZSgpIHsKICAgICAgICByZXR1cm4gMCAhPT0gKHRoaXMuX2ZsYWdzICYgRkxBR19UUkFOU0ZPUk1fV0lUSF9QQVJFTlRfQSkKICAgIH0KICAgIFNldFRyYW5zZm9ybVdpdGhQYXJlbnRBbmdsZShhKSB7CiAgICAgICAgdGhpcy5fU2V0RmxhZyhGTEFHX1RSQU5TRk9STV9XSVRIX1BBUkVOVF9BLCBhKQogICAgfQogICAgR2V0VHJhbnNmb3JtV2l0aFBhcmVudFpFbGV2YXRpb24oKSB7CiAgICAgICAgcmV0dXJuIDAgIT09CiAgICAgICAgICAgICh0aGlzLl9mbGFncyAmIEZMQUdfVFJBTlNGT1JNX1dJVEhfUEFSRU5UX1pfRUxFVkFUSU9OKQogICAgfQogICAgU2V0VHJhbnNmb3JtV2l0aFBhcmVudFpFbGV2YXRpb24oYSkgewogICAgICAgIHRoaXMuX1NldEZsYWcoRkxBR19UUkFOU0ZPUk1fV0lUSF9QQVJFTlRfWl9FTEVWQVRJT04sIGEpCiAgICB9CiAgICBfQ2xlYXJBbGxTY2VuZUdyYXBoRmxhZ3MoKSB7CiAgICAgICAgdGhpcy5fZmxhZ3MgJj0gfk1BU0tfQUxMX1NDRU5FX0dSQVBIX0ZMQUdTCiAgICB9CiAgICBBZGRDaGlsZChhLCBiKSB7CiAgICAgICAgaWYgKGEgIT09IHRoaXMgJiYgIWEuSGFzUGFyZW50KCkgJiYgIXRoaXMuX0hhc0NoaWxkUmVjdXJzaXZlKGEpICYmICF0aGlzLl9IYXNBbnlQYXJlbnQoYSkpIHsKICAgICAgICAgICAgdmFyIGQgPSBhLkdldFgoKSwKICAgICAgICAgICAgICAgIGMgPSBhLkdldFkoKSwKICAgICAgICAgICAgICAgIGUgPSBhLkdldFdpZHRoKCksCiAgICAgICAgICAgICAgICBnID0gYS5HZXRIZWlnaHQoKSwKICAgICAgICAgICAgICAgIGsgPSBhLkdldEFuZ2xlKCksCiAgICAgICAgICAgICAgICBtID0gYS5HZXRaRWxldmF0aW9uKCk7CiAgICAgICAgICAgIGEuX1NldFBhcmVudCh0aGlzKTsKICAgICAgICAgICAgYS5TZXRUcmFuc2Zvcm1XaXRoUGFyZW50WChiLnRyYW5zZm9ybVgpOwogICAgICAgICAgICBhLlNldFRyYW5zZm9ybVdpdGhQYXJlbnRZKGIudHJhbnNmb3JtWSk7CiAgICAgICAgICAgIGEuU2V0VHJhbnNmb3JtV2l0aFBhcmVudFdpZHRoKGIudHJhbnNmb3JtV2lkdGgpOwogICAgICAgICAgICBhLlNldFRyYW5zZm9ybVdpdGhQYXJlbnRIZWlnaHQoYi50cmFuc2Zvcm1IZWlnaHQpOwogICAgICAgICAgICBhLlNldFRyYW5zZm9ybVdpdGhQYXJlbnRBbmdsZShiLnRyYW5zZm9ybUFuZ2xlKTsKICAgICAgICAgICAgYS5TZXRUcmFuc2Zvcm1XaXRoUGFyZW50WkVsZXZhdGlvbihiLnRyYW5zZm9ybVpFbGV2YXRpb24pOwogICAgICAgICAgICBhLlNldERlc3Ryb3lXaXRoUGFyZW50KGIuZGVzdHJveVdpdGhQYXJlbnQpOwogICAgICAgICAgICBiLnRyYW5zZm9ybVggJiYgKGEuX3ggPSBkIC0gdGhpcy5HZXRYKCksIGIudHJhbnNmb3JtV2lkdGggJiYgKGEuX3ggLz0gdGhpcy5HZXRXaWR0aCgpIC8gdGhpcy5fc2NlbmVHcmFwaEluZm8uX0dldFN0YXJ0V2lkdGgoKSkpOwogICAgICAgICAgICBiLnRyYW5zZm9ybVkgJiYgKGEuX3kgPSBjIC0gdGhpcy5HZXRZKCksIGIudHJhbnNmb3JtSGVpZ2h0ICYmIChhLl95IC89IHRoaXMuR2V0SGVpZ2h0KCkgLyB0aGlzLl9zY2VuZUdyYXBoSW5mby5fR2V0U3RhcnRIZWlnaHQoKSkpOwogICAgICAgICAgICBiLnRyYW5zZm9ybVdpZHRoICYmIChkID0gdGhpcy5HZXRXaWR0aCgpLCAwID09PSBkIHx8IGQgPT09IE51bWJlci5FUFNJTE9OID8gKGEuX3cgPQogICAgICAgICAgICAgICAgMSwgYS5fc2NlbmVHcmFwaEluZm8uU2V0U3RhcnRTY2FsZVgoMSkpIDogKGEuX3cgPSBlIC8gdGhpcy5HZXRXaWR0aCgpLCBhLl9zY2VuZUdyYXBoSW5mby5TZXRTdGFydFNjYWxlWChhLl93KSkpOwogICAgICAgICAgICBiLnRyYW5zZm9ybUhlaWdodCAmJiAoZSA9IHRoaXMuR2V0SGVpZ2h0KCksIDAgPT09IGUgfHwgZSA9PT0gTnVtYmVyLkVQU0lMT04gPyAoYS5faCA9IDEsIGEuX3NjZW5lR3JhcGhJbmZvLlNldFN0YXJ0U2NhbGVZKDEpKSA6IChhLl9oID0gZyAvIHRoaXMuR2V0SGVpZ2h0KCksIGEuX3NjZW5lR3JhcGhJbmZvLlNldFN0YXJ0U2NhbGVZKGEuX2gpKSk7CiAgICAgICAgICAgIGIudHJhbnNmb3JtQW5nbGUgJiYgKGEuX2EgPSBrIC0gdGhpcy5HZXRBbmdsZSgpKTsKICAgICAgICAgICAgYi50cmFuc2Zvcm1aRWxldmF0aW9uICYmIChhLl96RWxldmF0aW9uID0gbSAtIHRoaXMuR2V0WkVsZXZhdGlvbigpKTsKICAgICAgICAgICAgdGhpcy5fQWRkQ2hpbGRUb1NjZW5lR3JhcGhJbmZvKGEpOwogICAgICAgICAgICB0aGlzLlNldEJib3hDaGFuZ2VkKCkKICAgICAgICB9CiAgICB9CiAgICBSZW1vdmVDaGlsZChhKSB7CiAgICAgICAgaWYgKGEuR2V0UGFyZW50KCkgPT09IHRoaXMpIHsKICAgICAgICAgICAgdmFyIGIgPSBhLkdldFgoKSwKICAgICAgICAgICAgICAgIGQgPSBhLkdldFkoKSwKICAgICAgICAgICAgICAgIGMgPSBhLkdldFdpZHRoKCksCiAgICAgICAgICAgICAgICBlID0gYS5HZXRIZWlnaHQoKSwKICAgICAgICAgICAgICAgIGcgPSBhLkdldEFuZ2xlKCksCiAgICAgICAgICAgICAgICBrID0gYS5HZXRaRWxldmF0aW9uKCk7CiAgICAgICAgICAgIGEuX1NldFBhcmVudChudWxsKTsKICAgICAgICAgICAgYS5fQ2xlYXJBbGxTY2VuZUdyYXBoRmxhZ3MoKTsKICAgICAgICAgICAgYS5TZXRYWShiLCBkKTsKICAgICAgICAgICAgYS5TZXRTaXplKGMsIGUpOwogICAgICAgICAgICBhLlNldEFuZ2xlKGcpOwogICAgICAgICAgICBhLlNldFpFbGV2YXRpb24oayk7CiAgICAgICAgICAgIHRoaXMuX1JlbW92ZUNoaWxkRnJvbVNjZW5lR3JhcGhJbmZvKGEpOwogICAgICAgICAgICB0aGlzLlNldEJib3hDaGFuZ2VkKCkKICAgICAgICB9CiAgICB9CiAgICBfUmVzZXRBbGxTY2VuZUdyYXBoU3RhdGUoKSB7CiAgICAgICAgdGhpcy5fQnVpbGRUbXBTY2VuZUdyYXBoQ2hpbGRyZW4oKTsKICAgICAgICB2YXIgYSA9IFsuLi50aGlzLmNoaWxkcmVuKCldOwogICAgICAgIGZvciAoY29uc3QgYiBvZiBhKSB0aGlzLlJlbW92ZUNoaWxkKGIpOwogICAgICAgIChhID0gdGhpcy5HZXRQYXJlbnQoKSkgJiYgYS5SZW1vdmVDaGlsZCh0aGlzKTsKICAgICAgICB0aGlzLl9DbGVhckFsbFNjZW5lR3JhcGhGbGFncygpCiAgICB9CiAgICBfQnVpbGRUbXBTY2VuZUdyYXBoQ2hpbGRyZW4oKSB7CiAgICAgICAgaWYgKCF0aGlzLl90bXBTY2VuZUdyYXBoQ2hpbGRyZW4pIHsKICAgICAgICAgICAgdmFyIGEgPSBbLi4udGhpcy5jaGlsZHJlbigpXTsKICAgICAgICAgICAgYS5sZW5ndGggJiYgKHRoaXMuX3RtcFNjZW5lR3JhcGhDaGlsZHJlbiA9IFtdLCB0aGlzLl90bXBTY2VuZUdyYXBoQ2hpbGRyZW5JbmRleGVzID0gbmV3IFdlYWtNYXApOwogICAgICAgICAgICB2YXIgYiA9IDA7CiAgICAgICAgICAgIGZvciAoY29uc3QgZCBvZiBhKSBhID0gZC5HZXRJbnN0YW5jZSgpLCB0aGlzLl90bXBTY2VuZUdyYXBoQ2hpbGRyZW4ucHVzaChhKSwgdGhpcy5fdG1wU2NlbmVHcmFwaENoaWxkcmVuSW5kZXhlcy5zZXQoYSwgYiksIGIrKwogICAgICAgIH0oYiA9IHRoaXMuR2V0UGFyZW50KCkpICYmIGIuX0J1aWxkVG1wU2NlbmVHcmFwaENoaWxkcmVuKCkKICAgIH0KICAgIF9SZWxlYXNlVG1wU2NlbmVHcmFwaEluZm8oKSB7CiAgICAgICAgdGhpcy5fdG1wU2NlbmVHcmFwaENoaWxkcmVuICYmICh0aGlzLl90bXBTY2VuZUdyYXBoQ2hpbGRyZW4ubGVuZ3RoID0gMCk7CiAgICAgICAgdGhpcy5fdG1wU2NlbmVHcmFwaENoaWxkcmVuSW5kZXhlcyA9IHRoaXMuX3RtcFNjZW5lR3JhcGhDaGlsZHJlbiA9IG51bGw7CiAgICAgICAgbmVlZHNTY2VuZUdyYXBoQWZ0ZXJMb2FkLmRlbGV0ZSh0aGlzKTsKICAgICAgICBjb25zdCBhID0KICAgICAgICAgICAgdGhpcy5HZXRQYXJlbnQoKTsKICAgICAgICBhICYmICFuZWVkc1NjZW5lR3JhcGhBZnRlckxvYWQuaGFzKGEpICYmIGEuX1JlbGVhc2VUbXBTY2VuZUdyYXBoSW5mbygpCiAgICB9CiAgICBIYXNQYXJlbnQoKSB7CiAgICAgICAgcmV0dXJuIG51bGwgIT09IHRoaXMuR2V0UGFyZW50KCkKICAgIH0KICAgIEdldFBhcmVudCgpIHsKICAgICAgICBjb25zdCBhID0gdGhpcy5fc2NlbmVHcmFwaEluZm87CiAgICAgICAgcmV0dXJuIG51bGwgIT09IGEgPyBhLkdldFBhcmVudCgpIDogbnVsbAogICAgfQogICAgR2V0VG9wUGFyZW50KCkgewogICAgICAgIGxldCBhID0gdGhpczsKICAgICAgICBmb3IgKDsgYS5IYXNQYXJlbnQoKTspIGEgPSBhLkdldFBhcmVudCgpOwogICAgICAgIHJldHVybiBhCiAgICB9KiBwYXJlbnRzKCkgewogICAgICAgIGxldCBhID0gdGhpcy5HZXRQYXJlbnQoKTsKICAgICAgICBmb3IgKDsgYTspIHlpZWxkIGEsIGEgPSBhLkdldFBhcmVudCgpCiAgICB9CiAgICBIYXNDaGlsZChhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuR2V0Q2hpbGRyZW4oKS5pbmNsdWRlcyhhKQogICAgfQogICAgSGFzQ2hpbGRyZW4oKSB7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuX3NjZW5lR3JhcGhJbmZvOwogICAgICAgIHJldHVybiBudWxsICE9PSBhID8gYS5IYXNDaGlsZHJlbigpIDogITEKICAgIH0KICAgIEdldENoaWxkcmVuKCkgewogICAgICAgIGNvbnN0IGEgPSB0aGlzLl9zY2VuZUdyYXBoSW5mbzsKICAgICAgICByZXR1cm4gbnVsbCAhPT0gYSA/IGEuR2V0Q2hpbGRyZW4oKSA6IEVNUFRZX0FSUkFZJGpzY29tcCQyCiAgICB9CiAgICBjaGlsZHJlbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5HZXRDaGlsZHJlbigpCiAgICB9KiBhbGxDaGlsZHJlbigpIHsKICAgICAgICBmb3IgKGNvbnN0IGEgb2YgdGhpcy5jaGlsZHJlbigpKSB5aWVsZCBhLCB5aWVsZCogYS5hbGxDaGlsZHJlbigpCiAgICB9CiAgICBHZXRDaGlsZENvdW50KCkgewogICAgICAgIHJldHVybiB0aGlzLkdldENoaWxkcmVuKCkubGVuZ3RoCiAgICB9CiAgICBHZXRBbGxDaGlsZENvdW50KCkgewogICAgICAgIHJldHVybiBbLi4udGhpcy5hbGxDaGlsZHJlbigpXS5sZW5ndGgKICAgIH0KICAgIEdldENoaWxkQXQoYSkgewogICAgICAgIGNvbnN0IGIgPSB0aGlzLkdldENoaWxkcmVuKCk7CiAgICAgICAgYSA9IE1hdGguZmxvb3IoK2EpOwogICAgICAgIHJldHVybiAwID4gYSB8fCBhID49IGIubGVuZ3RoID8gbnVsbCA6IGJbYV0KICAgIH0KICAgIF9DcmVhdGVTY2VuZUdyYXBoSW5mbyhhKSB7CiAgICAgICAgdGhpcy5fc2NlbmVHcmFwaEluZm8gfHwgKHRoaXMuX3NjZW5lR3JhcGhJbmZvID0gQzMkanNjb21wJDE1OS5OZXcoQzMkanNjb21wJDE1OS5TY2VuZUdyYXBoSW5mbywgdGhpcykpOwogICAgICAgIGEgJiYgdGhpcy5fc2NlbmVHcmFwaEluZm8uU2V0UGFyZW50KGEpCiAgICB9CiAgICBfR2V0U2NlbmVHcmFwaEluZm8oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3NjZW5lR3JhcGhJbmZvCiAgICB9CiAgICBfUmVsZWFzZVNjZW5lR3JhcGhJbmZvKCkgewogICAgICAgIHRoaXMuX3NjZW5lR3JhcGhJbmZvICYmCiAgICAgICAgICAgICh0aGlzLl9zY2VuZUdyYXBoSW5mby5SZWxlYXNlKCksIHRoaXMuX3NjZW5lR3JhcGhJbmZvID0gbnVsbCkKICAgIH0KICAgIF9TZXRQYXJlbnQoYSkgewogICAgICAgIGEgPyAoYS5fQ3JlYXRlU2NlbmVHcmFwaEluZm8obnVsbCksIHRoaXMuX0NyZWF0ZVNjZW5lR3JhcGhJbmZvKGEpKSA6ICh0aGlzLl9zY2VuZUdyYXBoSW5mbyAmJiB0aGlzLl9zY2VuZUdyYXBoSW5mby5TZXRQYXJlbnQobnVsbCksIHRoaXMuSGFzQ2hpbGRyZW4oKSB8fCB0aGlzLl9SZWxlYXNlU2NlbmVHcmFwaEluZm8oKSkKICAgIH0KICAgIF9IYXNBbnlQYXJlbnQoYSkgewogICAgICAgIGlmICghdGhpcy5IYXNQYXJlbnQoKSkgcmV0dXJuICExOwogICAgICAgIGNvbnN0IGIgPSB0aGlzLkdldFBhcmVudCgpOwogICAgICAgIHJldHVybiBiID09PSBhID8gITAgOiBiLl9IYXNBbnlQYXJlbnQoYSkKICAgIH0KICAgIF9IYXNDaGlsZFJlY3Vyc2l2ZShhKSB7CiAgICAgICAgaWYgKHRoaXMuSGFzQ2hpbGQoYSkpIHJldHVybiAhMDsKICAgICAgICBmb3IgKGNvbnN0IGIgb2YgdGhpcy5HZXRDaGlsZHJlbigpKQogICAgICAgICAgICBpZiAoYi5fSGFzQ2hpbGRSZWN1cnNpdmUoYSkpIHJldHVybiAhMDsKICAgICAgICByZXR1cm4gITEKICAgIH0KICAgIF9BZGRDaGlsZFRvU2NlbmVHcmFwaEluZm8oYSkgewogICAgICAgIHRoaXMuX3NjZW5lR3JhcGhJbmZvLkdldENoaWxkcmVuKCkucHVzaChhKQogICAgfQogICAgX1JlbW92ZUNoaWxkRnJvbVNjZW5lR3JhcGhJbmZvKGEpIHsKICAgICAgICBjb25zdCBiID0KICAgICAgICAgICAgdGhpcy5fc2NlbmVHcmFwaEluZm8uR2V0Q2hpbGRyZW4oKSwKICAgICAgICAgICAgZCA9IGIuaW5kZXhPZihhKTsgLSAxICE9PSBkICYmIGIuc3BsaWNlKGQsIDEpOwogICAgICAgIDAgIT09IGIubGVuZ3RoIHx8IHRoaXMuSGFzUGFyZW50KCkgfHwgdGhpcy5fUmVsZWFzZVNjZW5lR3JhcGhJbmZvKCk7CiAgICAgICAgYS5IYXNDaGlsZHJlbigpIHx8IGEuX1JlbGVhc2VTY2VuZUdyYXBoSW5mbygpCiAgICB9CiAgICBHZXRTY2VuZUdyYXBoQ2hpbGRyZW5FeHBvcnREYXRhKCkgewogICAgICAgIGNvbnN0IGEgPSBzY2VuZUdyYXBoRXhwb3J0RGF0YU1hcC5nZXQodGhpcyk7CiAgICAgICAgcmV0dXJuIGEgPyBhLmNoaWxkcmVuRGF0YSA6IG51bGwKICAgIH0KICAgIEdldFNjZW5lR3JhcGhaSW5kZXhFeHBvcnREYXRhKCkgewogICAgICAgIGNvbnN0IGEgPSBzY2VuZUdyYXBoRXhwb3J0RGF0YU1hcC5nZXQodGhpcyk7CiAgICAgICAgcmV0dXJuIGEgPyBhLnpJbmRleERhdGEgOiBOYU4KICAgIH0KICAgIEdldFNjZW5lR3JhcGhaSW5kZXgoKSB7CiAgICAgICAgY29uc3QgYSA9IHNjZW5lR3JhcGhaSW5kZXhNYXAuZ2V0KHRoaXMpOwogICAgICAgIHJldHVybiBDMyRqc2NvbXAkMTU5LklzRmluaXRlTnVtYmVyKGEpID8gYSA6IE5hTgogICAgfQogICAgU2V0U2NlbmVHcmFwaFpJbmRleChhKSB7CiAgICAgICAgc2NlbmVHcmFwaFpJbmRleE1hcC5zZXQodGhpcywKICAgICAgICAgICAgYSkKICAgIH0KICAgIFNldFVzZVBvaW50c1NoYWRlclByb2dyYW0oKSB7CiAgICAgICAgdGhpcy5fU2V0RmxhZyhGTEFHX1VTRV9QT0lOVFNfU0hBREVSX1BST0dSQU0sICEwKTsKICAgICAgICB0aGlzLl9VcGRhdGVSZW5kZXJlclN0YXRlR3JvdXAoKQogICAgfQogICAgX1VwZGF0ZVJlbmRlcmVyU3RhdGVHcm91cCgpIHsKICAgICAgICBpZiAoZW5hYmxlVXBkYXRlUmVuZGVyZXJTdGF0ZUdyb3VwKSB7CiAgICAgICAgICAgIHZhciBhID0gdGhpcy5fcnVudGltZS5HZXRSZW5kZXJlcigpOwogICAgICAgICAgICB0aGlzLl9zdGF0ZUdyb3VwICYmIGEuUmVsZWFzZVN0YXRlR3JvdXAodGhpcy5fc3RhdGVHcm91cCk7CiAgICAgICAgICAgIHZhciBiID0gMCAhPT0gKHRoaXMuX2ZsYWdzICYgRkxBR19VU0VfUE9JTlRTX1NIQURFUl9QUk9HUkFNKSA/IGEuR2V0UG9pbnRzUmVuZGVyaW5nUHJvZ3JhbSgpIHx8ICI8cG9pbnQ+IiA6IGEuR2V0VGV4dHVyZUZpbGxTaGFkZXJQcm9ncmFtKCkgfHwgIjxkZWZhdWx0PiI7CiAgICAgICAgICAgIHRoaXMuX3N0YXRlR3JvdXAgPSBhLkFjcXVpcmVTdGF0ZUdyb3VwKGIsIHRoaXMuR2V0QmxlbmRNb2RlKCksIHRoaXMuX2NvbG9yUHJlbXVsdGlwbGllZCwgdGhpcy5HZXRaRWxldmF0aW9uKCkpCiAgICAgICAgfQogICAgfQogICAgR2V0UmVuZGVyZXJTdGF0ZUdyb3VwKCkgewogICAgICAgIHJldHVybiB0aGlzLl9zdGF0ZUdyb3VwCiAgICB9CiAgICBIYXNEZWZhdWx0Q29sb3IoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2NvbG9yID09PQogICAgICAgICAgICBERUZBVUxUX0NPTE9SCiAgICB9CiAgICBTZXRCbGVuZE1vZGUoYSkgewogICAgICAgIGEgfD0gMDsKICAgICAgICBpZiAoMCA+IGEgfHwgMzEgPCBhKSB0aHJvdyBuZXcgUmFuZ2VFcnJvcigiaW52YWxpZCBibGVuZCBtb2RlIik7CiAgICAgICAgdGhpcy5HZXRCbGVuZE1vZGUoKSAhPT0gYSAmJiAodGhpcy5fZmxhZ3MgPSB0aGlzLl9mbGFncyAmIH5GTEFHX0JMRU5EX01PREVfTUFTSyB8IGEgPDwgMjYsIHRoaXMuX1VwZGF0ZVJlbmRlcmVyU3RhdGVHcm91cCgpKQogICAgfQogICAgR2V0QmxlbmRNb2RlKCkgewogICAgICAgIHJldHVybiAodGhpcy5fZmxhZ3MgJiBGTEFHX0JMRU5EX01PREVfTUFTSykgPj4gMjYKICAgIH0KICAgIF9TZXRMYXllcihhKSB7CiAgICAgICAgdGhpcy5fbGF5ZXIgPSBhOwogICAgICAgIDAgIT09IHRoaXMuR2V0WkVsZXZhdGlvbigpICYmIHRoaXMuX2xheWVyLl9TZXRBbnlJbnN0YW5jZVpFbGV2YXRlZCgpCiAgICB9CiAgICBHZXRMYXllcigpIHsKICAgICAgICByZXR1cm4gdGhpcy5fbGF5ZXIKICAgIH0KICAgIEdldExheW91dCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5HZXRMYXllcigpLkdldExheW91dCgpCiAgICB9CiAgICBfU2V0WkluZGV4KGEpIHsKICAgICAgICB0aGlzLl96SW5kZXggPSBhIHwgMAogICAgfQogICAgR2V0WkluZGV4KCkgewogICAgICAgIHRoaXMuX2xheWVyLl9VcGRhdGVaSW5kaWNlcygpOwogICAgICAgIHJldHVybiB0aGlzLl96SW5kZXgKICAgIH0KICAgIF9HZXRMYXN0Q2FjaGVkWkluZGV4KCkgewogICAgICAgIHJldHVybiB0aGlzLl96SW5kZXgKICAgIH0KICAgIF9TZXRGbGFnKGEsIGIpIHsKICAgICAgICB0aGlzLl9mbGFncyA9IGIgPyB0aGlzLl9mbGFncyB8IGEgOiB0aGlzLl9mbGFncyAmIH5hCiAgICB9CiAgICBJc1Zpc2libGUoKSB7CiAgICAgICAgcmV0dXJuIDAgIT09ICh0aGlzLl9mbGFncyAmIEZMQUdfSVNfVklTSUJMRSkKICAgIH0KICAgIFNldFZpc2libGUoYSkgewogICAgICAgIHRoaXMuX1NldEZsYWcoRkxBR19JU19WSVNJQkxFLCBhKQogICAgfQogICAgSXNDb2xsaXNpb25FbmFibGVkKCkgewogICAgICAgIHJldHVybiAwICE9PSAodGhpcy5fZmxhZ3MgJiBGTEFHX0NPTExJU0lPTl9FTkFCTEVEKQogICAgfQogICAgU2V0Q29sbGlzaW9uRW5hYmxlZChhKSB7CiAgICAgICAgYSA9ICEhYTsKICAgICAgICB0aGlzLklzQ29sbGlzaW9uRW5hYmxlZCgpICE9PSBhICYmICh0aGlzLl9TZXRGbGFnKEZMQUdfQ09MTElTSU9OX0VOQUJMRUQsIGEpLCBhID8gdGhpcy5TZXRCYm94Q2hhbmdlZCgpIDogdGhpcy5fUmVtb3ZlRnJvbUNvbGxpc2lvbkNlbGxzKCkpCiAgICB9CiAgICBTZXRTb2xpZENvbGxpc2lvbkZpbHRlcihhLCBiKSB7CiAgICAgICAgdGhpcy5fU2V0RmxhZyhGTEFHX1NPTElEX0ZJTFRFUl9JTkNMVVNJVkUsCiAgICAgICAgICAgIGEpOwogICAgICAgIHRoaXMuX3NvbGlkRmlsdGVyVGFncyAmJiB0aGlzLl9zb2xpZEZpbHRlclRhZ3MuY2xlYXIoKTsKICAgICAgICBpZiAoYi50cmltKCkpIHsKICAgICAgICAgICAgdGhpcy5fc29saWRGaWx0ZXJUYWdzIHx8ICh0aGlzLl9zb2xpZEZpbHRlclRhZ3MgPSBuZXcgU2V0KTsKICAgICAgICAgICAgZm9yIChjb25zdCBkIG9mIGIuc3BsaXQoIiAiKSkgZCAmJiB0aGlzLl9zb2xpZEZpbHRlclRhZ3MuYWRkKGQudG9Mb3dlckNhc2UoKSkKICAgICAgICB9IGVsc2UgdGhpcy5fc29saWRGaWx0ZXJUYWdzID0gbnVsbAogICAgfQogICAgSXNTb2xpZENvbGxpc2lvbkFsbG93ZWQoYSkgewogICAgICAgIGNvbnN0IGIgPSAwICE9PSAodGhpcy5fZmxhZ3MgJiBGTEFHX1NPTElEX0ZJTFRFUl9JTkNMVVNJVkUpLAogICAgICAgICAgICBkID0gdGhpcy5fc29saWRGaWx0ZXJUYWdzOwogICAgICAgIGlmICghYSB8fCAhZCkgcmV0dXJuICFiOwogICAgICAgIGZvciAoY29uc3QgYyBvZiBkKQogICAgICAgICAgICBpZiAoYS5oYXMoYykpIHJldHVybiBiOwogICAgICAgIHJldHVybiAhYgogICAgfQogICAgU2V0QmJveENoYW5nZWQoKSB7CiAgICAgICAgdGhpcy5fZmxhZ3MgPSB0aGlzLl9mbGFncyB8IEZMQUdfQkJPWF9DSEFOR0VEIHwgRkxBR19DT0xMSVNJT05fQ0VMTF9DSEFOR0VEIHwgRkxBR19NRVNIX0NIQU5HRUQ7CiAgICAgICAgdGhpcy5fb2JqZWN0Q2xhc3MuX1NldEFueUNvbGxpc2lvbkNlbGxDaGFuZ2VkKCEwKTsKICAgICAgICB0aGlzLl9ydW50aW1lLlVwZGF0ZVJlbmRlcigpOwogICAgICAgIHRoaXMuX2xheWVyLlVzZXNSZW5kZXJDZWxscygpICYmICh0aGlzLkNhbGN1bGF0ZUJib3godGhpcy5fYm91bmRpbmdCb3gsIHRoaXMuX2JvdW5kaW5nUXVhZCwgITApLCB0aGlzLl9mbGFncyAmPSB+RkxBR19CQk9YX0NIQU5HRUQsIHRoaXMuX1VwZGF0ZVJlbmRlckNlbGwoKSk7CiAgICAgICAgMCAhPT0gKHRoaXMuX2ZsYWdzICYgRkxBR19FTkFCTEVfQkJPWF9DSEFOR0VEX0VWRU5UKSAmJiB0aGlzLl9pbnN0LkRpc3BhdGNoZXIoKS5kaXNwYXRjaEV2ZW50KGJib3hDaGFuZ2VFdmVudCk7CiAgICAgICAgaWYgKG51bGwgIT09IHRoaXMuX3NjZW5lR3JhcGhJbmZvKSB7CiAgICAgICAgICAgIGNvbnN0IGEgPSB0aGlzLl9zY2VuZUdyYXBoSW5mby5HZXRDaGlsZHJlbigpOwogICAgICAgICAgICBmb3IgKGxldCBiID0gMCwgZCA9IGEubGVuZ3RoOyBiIDwgZDsgKytiKSBhW2JdLlNldEJib3hDaGFuZ2VkKCkKICAgICAgICB9CiAgICB9CiAgICBDYWxjdWxhdGVCYm94KGEsIGIsIGQpIHsKICAgICAgICBjb25zdCBjID0gdGhpcy5HZXRYKCksCiAgICAgICAgICAgIGUgPSB0aGlzLkdldFkoKSwKICAgICAgICAgICAgZyA9IHRoaXMuR2V0V2lkdGgoKSwKICAgICAgICAgICAgayA9IHRoaXMuR2V0SGVpZ2h0KCksCiAgICAgICAgICAgIG0gPSB0aGlzLkdldEFuZ2xlKCk7CiAgICAgICAgYS5zZXRXSChjIC0gdGhpcy5fb3ggKiBnLCBlIC0gdGhpcy5fb3kgKiBrLCBnLCBrKTsKICAgICAgICBkICYmIHRoaXMuSGFzTWVzaCgpICYmIHRoaXMuX0V4cGFuZEJib3hGb3JNZXNoKGEpOwogICAgICAgIDAgPT09IG0gPyBiLnNldEZyb21SZWN0KGEpIDogKGEub2Zmc2V0KC1jLCAtZSksIGIuc2V0RnJvbVJvdGF0ZWRSZWN0UHJlY2FsYyhhLCB0aGlzLkdldFNpbkFuZ2xlKCksIHRoaXMuR2V0Q29zQW5nbGUoKSksIGIub2Zmc2V0KGMsIGUpLCBiLmdldEJvdW5kaW5nQm94KGEpKTsKICAgICAgICBhLm5vcm1hbGl6ZSgpCiAgICB9CiAgICBfVXBkYXRlQmJveCgpIHsKICAgICAgICBjb25zdCBhID0gdGhpcy5fZmxhZ3M7CiAgICAgICAgMCAhPT0gKGEgJiBGTEFHX0JCT1hfQ0hBTkdFRCkgJiYgKHRoaXMuQ2FsY3VsYXRlQmJveCh0aGlzLl9ib3VuZGluZ0JveCwgdGhpcy5fYm91bmRpbmdRdWFkLCAhMCksIHRoaXMuX2ZsYWdzID0gYSAmIH5GTEFHX0JCT1hfQ0hBTkdFRCkKICAgIH0KICAgIEdldEJvdW5kaW5nQm94KCkgewogICAgICAgIHRoaXMuX1VwZGF0ZUJib3goKTsKICAgICAgICByZXR1cm4gdGhpcy5fYm91bmRpbmdCb3gKICAgIH0KICAgIEdldEJvdW5kaW5nUXVhZCgpIHsKICAgICAgICB0aGlzLl9VcGRhdGVCYm94KCk7CiAgICAgICAgcmV0dXJuIHRoaXMuX2JvdW5kaW5nUXVhZAogICAgfQogICAgUGl4ZWxSb3VuZFF1YWQoYSkgewogICAgICAgIHZhciBiID0gdGhpcy5HZXRYKCksCiAgICAgICAgICAgIGQgPSB0aGlzLkdldFkoKTsKICAgICAgICBiID0gTWF0aC5yb3VuZChiKSAtIGI7CiAgICAgICAgZCA9IE1hdGgucm91bmQoZCkgLSBkOwogICAgICAgIGlmICgwID09PSBiICYmIDAgPT09IGQpIHJldHVybiBhOwogICAgICAgIHRlbXBRdWFkJGpzY29tcCQzLmNvcHkoYSk7CiAgICAgICAgdGVtcFF1YWQkanNjb21wJDMub2Zmc2V0KGIsIGQpOwogICAgICAgIHJldHVybiB0ZW1wUXVhZCRqc2NvbXAkMwogICAgfQogICAgT3ZlcndyaXRlQm91bmRpbmdCb3goYSkgewogICAgICAgIHRoaXMuX2JvdW5kaW5nQm94LmNvcHkoYSk7CiAgICAgICAgdGhpcy5fYm91bmRpbmdRdWFkLnNldEZyb21SZWN0KHRoaXMuX2JvdW5kaW5nQm94KTsKICAgICAgICB0aGlzLl9mbGFncyAmPSB+RkxBR19CQk9YX0NIQU5HRUQ7CiAgICAgICAgdGhpcy5fVXBkYXRlQ29sbGlzaW9uQ2VsbCgpOwogICAgICAgIHRoaXMuX1VwZGF0ZVJlbmRlckNlbGwoKQogICAgfQogICAgU2V0QmJveENoYW5nZUV2ZW50RW5hYmxlZChhKSB7CiAgICAgICAgdGhpcy5fU2V0RmxhZyhGTEFHX0VOQUJMRV9CQk9YX0NIQU5HRURfRVZFTlQsCiAgICAgICAgICAgIGEpCiAgICB9CiAgICBJc0Jib3hDaGFuZ2VFdmVudEVuYWJsZWQoKSB7CiAgICAgICAgcmV0dXJuIDAgIT09ICh0aGlzLl9mbGFncyAmIEZMQUdfRU5BQkxFX0JCT1hfQ0hBTkdFRF9FVkVOVCkKICAgIH0KICAgIElzSW5WaWV3cG9ydChhLCBiLCBkKSB7CiAgICAgICAgcmV0dXJuIGIgJiYgMCAhPT0gdGhpcy5HZXREZXB0aCgpID8gdGhpcy5Jc0luVmlld3BvcnQzRCh0aGlzLkdldExheWVyKCkuX0dldFZpZXdGcnVzdHVtKCkpIDogMCA9PT0gdGhpcy5HZXRaRWxldmF0aW9uKCkgfHwgZCA/IGEuaW50ZXJzZWN0c1JlY3QodGhpcy5HZXRCb3VuZGluZ0JveCgpKSA6IHRoaXMuX0lzSW5WaWV3cG9ydF9aRWxldmF0ZWQoKQogICAgfQogICAgX0lzSW5WaWV3cG9ydF9aRWxldmF0ZWQoKSB7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuR2V0TGF5ZXIoKSwKICAgICAgICAgICAgYiA9IHRoaXMuR2V0VG90YWxaRWxldmF0aW9uKCk7CiAgICAgICAgaWYgKGIgPj0gYS5HZXRDYW1lcmFaKCkpIHJldHVybiAhMTsKICAgICAgICBhLkdldFZpZXdwb3J0Rm9yWihiLCB0ZW1wUmVjdCRqc2NvbXAkNik7CiAgICAgICAgcmV0dXJuIHRlbXBSZWN0JGpzY29tcCQ2LmludGVyc2VjdHNSZWN0KHRoaXMuR2V0Qm91bmRpbmdCb3goKSkKICAgIH0KICAgIElzSW5WaWV3cG9ydDNEKGEpIHsKICAgICAgICB2YXIgYiA9CiAgICAgICAgICAgIHRoaXMuR2V0Qm91bmRpbmdCb3goKTsKICAgICAgICBjb25zdCBkID0gYi5nZXRMZWZ0KCksCiAgICAgICAgICAgIGMgPSBiLmdldFJpZ2h0KCksCiAgICAgICAgICAgIGUgPSBiLmdldFRvcCgpOwogICAgICAgIGIgPSBiLmdldEJvdHRvbSgpOwogICAgICAgIGNvbnN0IGcgPSB0aGlzLkdldFRvdGFsWkVsZXZhdGlvbigpLAogICAgICAgICAgICBrID0gZyArIHRoaXMuR2V0RGVwdGgoKTsKICAgICAgICByZXR1cm4gYS5Db250YWluc0FBQkIoZCwgZSwgZywgYywgYiwgaykKICAgIH0KICAgIElzSW5WaWV3cG9ydDIoKSB7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuR2V0TGF5ZXIoKTsKICAgICAgICBpZiAoYS5IYXMzRENhbWVyYSgpKSByZXR1cm4gdGhpcy5Jc0luVmlld3BvcnQzRChhLl9HZXRWaWV3RnJ1c3R1bSgpKTsKICAgICAgICBjb25zdCBiID0gYS5HZXRMYXlvdXQoKTsKICAgICAgICByZXR1cm4gdGhpcy5Jc0luVmlld3BvcnQoYS5HZXRWaWV3cG9ydCgpLCBiLkhhc1ZhbmlzaGluZ1BvaW50T3V0c2lkZVZpZXdwb3J0KCksIGIuSXNPcnRob2dyYXBoaWNQcm9qZWN0aW9uKCkpCiAgICB9CiAgICBfU2V0RHJhd0JhY2tGYWNlT25seShhKSB7CiAgICAgICAgdGhpcy5fU2V0RmxhZyhGTEFHX0RSQVdfQkFDS19GQUNFX09OTFksIGEpCiAgICB9CiAgICBfU2V0RHJhd05vbkJhY2tGYWNlc09ubHkoYSkgewogICAgICAgIHRoaXMuX1NldEZsYWcoRkxBR19EUkFXX05PTl9CQUNLX0ZBQ0VTX09OTFksCiAgICAgICAgICAgIGEpCiAgICB9CiAgICBJc0RyYXdCYWNrRmFjZU9ubHkoKSB7CiAgICAgICAgcmV0dXJuIDAgIT09ICh0aGlzLl9mbGFncyAmIEZMQUdfRFJBV19CQUNLX0ZBQ0VfT05MWSkKICAgIH0KICAgIElzRHJhd05vbkJhY2tGYWNlc09ubHkoKSB7CiAgICAgICAgcmV0dXJuIDAgIT09ICh0aGlzLl9mbGFncyAmIEZMQUdfRFJBV19OT05fQkFDS19GQUNFU19PTkxZKQogICAgfQogICAgU2V0U291cmNlQ29sbGlzaW9uUG9seShhKSB7CiAgICAgICAgdGhpcy5fc291cmNlQ29sbGlzaW9uUG9seSA9IGE7CiAgICAgICAgdGhpcy5fRGlzY2FyZFRyYW5zZm9ybWVkQ29sbGlzaW9uUG9seSgpOwogICAgICAgIHRoaXMuSGFzTWVzaCgpICYmICh0aGlzLl9tZXNoSW5mby5tZXNoUG9seSA9IG51bGwpCiAgICB9CiAgICBHZXRTb3VyY2VDb2xsaXNpb25Qb2x5KCkgewogICAgICAgIHJldHVybiB0aGlzLl9zb3VyY2VDb2xsaXNpb25Qb2x5CiAgICB9CiAgICBIYXNPd25Db2xsaXNpb25Qb2x5KCkgewogICAgICAgIHJldHVybiBudWxsICE9PSB0aGlzLl9zb3VyY2VDb2xsaXNpb25Qb2x5IHx8IHRoaXMuSGFzTWVzaCgpCiAgICB9CiAgICBHZXRUcmFuc2Zvcm1lZENvbGxpc2lvblBvbHkoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX0dldEN1c3RvbVRyYW5zZm9ybWVkQ29sbGlzaW9uUG9seVByZWNhbGModGhpcy5HZXRXaWR0aCgpLAogICAgICAgICAgICB0aGlzLkdldEhlaWdodCgpLCB0aGlzLkdldEFuZ2xlKCksIHRoaXMuR2V0U2luQW5nbGUoKSwgdGhpcy5HZXRDb3NBbmdsZSgpKQogICAgfQogICAgR2V0Q3VzdG9tVHJhbnNmb3JtZWRDb2xsaXNpb25Qb2x5KGEsIGIsIGQpIHsKICAgICAgICBsZXQgYyA9IDAsCiAgICAgICAgICAgIGUgPSAxOwogICAgICAgIDAgIT09IGQgJiYgKGMgPSBNYXRoLnNpbihkKSwgZSA9IE1hdGguY29zKGQpKTsKICAgICAgICByZXR1cm4gdGhpcy5fR2V0Q3VzdG9tVHJhbnNmb3JtZWRDb2xsaXNpb25Qb2x5UHJlY2FsYyhhLCBiLCBkLCBjLCBlKQogICAgfQogICAgX0dldEN1c3RvbVRyYW5zZm9ybWVkQ29sbGlzaW9uUG9seVByZWNhbGMoYSwgYiwgZCwgYywgZSkgewogICAgICAgIGxldCBnID0gdGhpcy5fdHJhbnNmb3JtZWRQb2x5SW5mbzsKICAgICAgICBudWxsID09PSBnICYmICh0aGlzLl90cmFuc2Zvcm1lZFBvbHlJbmZvID0gZyA9IHsKICAgICAgICAgICAgcG9seTogQzMkanNjb21wJDE1OS5OZXcoQzMkanNjb21wJDE1OS5Db2xsaXNpb25Qb2x5KSwKICAgICAgICAgICAgd2lkdGg6IE5hTiwKICAgICAgICAgICAgaGVpZ2h0OiBOYU4sCiAgICAgICAgICAgIGFuZ2xlOiBOYU4KICAgICAgICB9KTsKICAgICAgICBjb25zdCBrID0gZy5wb2x5OwogICAgICAgIGlmIChnLndpZHRoID09PSBhICYmIGcuaGVpZ2h0ID09PSBiICYmIGcuYW5nbGUgPT09IGQpIHJldHVybiBrOwogICAgICAgIGNvbnN0IG0gPSB0aGlzLl9zb3VyY2VDb2xsaXNpb25Qb2x5OwogICAgICAgIGlmICh0aGlzLkhhc01lc2goKSkgewogICAgICAgICAgICBjb25zdCBuID0gdGhpcy5HZXRPcmlnaW5YKCksCiAgICAgICAgICAgICAgICBxID0gdGhpcy5HZXRPcmlnaW5ZKCksCiAgICAgICAgICAgICAgICB1ID0gdGhpcy5HZXRTb3VyY2VNZXNoKCk7CiAgICAgICAgICAgIGxldCB3ID0gdGhpcy5fbWVzaEluZm8ubWVzaFBvbHk7CiAgICAgICAgICAgIHcgfHwgKG0gPyAodGVtcENvbGxpc2lvblBvbHkuY29weShtKSwgdGVtcENvbGxpc2lvblBvbHkub2Zmc2V0KG4sIHEpKSA6IHRlbXBDb2xsaXNpb25Qb2x5LnNldERlZmF1bHRQb2ludHMoKSwgdyA9IHUuSW5zZXJ0UG9seU1lc2hWZXJ0aWNlcyh0ZW1wQ29sbGlzaW9uUG9seSksIHRoaXMuX21lc2hJbmZvLm1lc2hQb2x5ID0gdyk7CiAgICAgICAgICAgIHUuVHJhbnNmb3JtQ29sbGlzaW9uUG9seSh3LCBrKTsKICAgICAgICAgICAgay5vZmZzZXQoLW4sIC1xKTsKICAgICAgICAgICAgay50cmFuc2Zvcm1QcmVjYWxjKGEsIGIsIGMsIGUpCiAgICAgICAgfSBlbHNlIG0gPyAoay5jb3B5KG0pLCBrLnRyYW5zZm9ybVByZWNhbGMoYSwgYiwgYywgZSkpIDogay5zZXRGcm9tUXVhZCh0aGlzLkdldEJvdW5kaW5nUXVhZCgpLCAtdGhpcy5HZXRYKCksIC10aGlzLkdldFkoKSk7CiAgICAgICAgZy53aWR0aCA9IGE7CiAgICAgICAgZy5oZWlnaHQgPSBiOwogICAgICAgIGcuYW5nbGUgPSBkOwogICAgICAgIHJldHVybiBrCiAgICB9CiAgICBfRGlzY2FyZFRyYW5zZm9ybWVkQ29sbGlzaW9uUG9seSgpIHsKICAgICAgICB0aGlzLlNldFBoeXNpY3NCb2R5Q2hhbmdlZCghMCk7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuX3RyYW5zZm9ybWVkUG9seUluZm87CiAgICAgICAgbnVsbCAhPT0gYSAmJiAoYS53aWR0aCA9IE5hTikKICAgIH0KICAgIENyZWF0ZU1lc2goYSwgYikgewogICAgICAgIGEgPSBNYXRoLmZsb29yKGEpOwogICAgICAgIGIgPSBNYXRoLmZsb29yKGIpOwogICAgICAgIGlmICghdGhpcy5HZXRJbnN0YW5jZSgpLkdldFBsdWdpbigpLlN1cHBvcnRzTWVzaCgpKSB0aHJvdyBFcnJvcigib2JqZWN0IGRvZXMgbm90IHN1cHBvcnQgbWVzaCIpOwogICAgICAgIHRoaXMuUmVsZWFzZU1lc2goKTsKICAgICAgICB0aGlzLl9tZXNoSW5mbyA9IHsKICAgICAgICAgICAgc291cmNlTWVzaDogQzMkanNjb21wJDE1OS5OZXcoQzMkanNjb21wJDE1OS5HZnguTWVzaCwgYSwgYiksCiAgICAgICAgICAgIHRyYW5zZm9ybWVkTWVzaDogQzMkanNjb21wJDE1OS5OZXcoQzMkanNjb21wJDE1OS5HZnguTWVzaCwgYSwgYiksCiAgICAgICAgICAgIG1lc2hQb2x5OiBudWxsCiAgICAgICAgfQogICAgfQogICAgSGFzTWVzaCgpIHsKICAgICAgICByZXR1cm4gbnVsbCAhPT0gdGhpcy5fbWVzaEluZm8KICAgIH0KICAgIEdldFNvdXJjZU1lc2goKSB7CiAgICAgICAgaWYgKCF0aGlzLkhhc01lc2goKSkgdGhyb3cgRXJyb3IoIm5vIG1lc2giKTsKICAgICAgICByZXR1cm4gdGhpcy5fbWVzaEluZm8uc291cmNlTWVzaAogICAgfQogICAgR2V0VHJhbnNmb3JtZWRNZXNoKCkgewogICAgICAgIGlmICghdGhpcy5IYXNNZXNoKCkpIHRocm93IEVycm9yKCJubyBtZXNoIik7CiAgICAgICAgcmV0dXJuIHRoaXMuX21lc2hJbmZvLnRyYW5zZm9ybWVkTWVzaAogICAgfQogICAgU2V0TWVzaENoYW5nZWQoYSkgewogICAgICAgIHRoaXMuX1NldEZsYWcoRkxBR19NRVNIX0NIQU5HRUQsIGEpCiAgICB9CiAgICBJc01lc2hDaGFuZ2VkKCkgewogICAgICAgIHJldHVybiAwICE9PSAodGhpcy5fZmxhZ3MgJiBGTEFHX01FU0hfQ0hBTkdFRCkKICAgIH0KICAgIFNldFBoeXNpY3NCb2R5Q2hhbmdlZChhKSB7CiAgICAgICAgdGhpcy5fU2V0RmxhZyhGTEFHX1BIWVNJQ1NfQk9EWV9DSEFOR0VELCBhKQogICAgfQogICAgSXNQaHlzaWNzQm9keUNoYW5nZWQoKSB7CiAgICAgICAgcmV0dXJuIDAgIT09ICh0aGlzLl9mbGFncyAmIEZMQUdfUEhZU0lDU19CT0RZX0NIQU5HRUQpCiAgICB9CiAgICBfRXhwYW5kQmJveEZvck1lc2goYSkgewogICAgICAgIGNvbnN0IGIgPSB0aGlzLl9tZXNoSW5mby5zb3VyY2VNZXNoLAogICAgICAgICAgICBkID0gTWF0aC5taW4oYi5HZXRNaW5YKCksIDApLAogICAgICAgICAgICBjID0gTWF0aC5taW4oYi5HZXRNaW5ZKCksIDApLAogICAgICAgICAgICBlID0gTWF0aC5tYXgoYi5HZXRNYXhYKCksCiAgICAgICAgICAgICAgICAxKSwKICAgICAgICAgICAgZyA9IE1hdGgubWF4KGIuR2V0TWF4WSgpLCAxKSwKICAgICAgICAgICAgayA9IGEud2lkdGgoKSwKICAgICAgICAgICAgbSA9IGEuaGVpZ2h0KCk7CiAgICAgICAgYS5vZmZzZXRMZWZ0KGQgKiBrKTsKICAgICAgICBhLm9mZnNldFRvcChjICogbSk7CiAgICAgICAgYS5vZmZzZXRSaWdodCgoZSAtIDEpICogayk7CiAgICAgICAgYS5vZmZzZXRCb3R0b20oKGcgLSAxKSAqIG0pOwogICAgICAgIHRoaXMuX2RlcHRoID0gYi5HZXRNYXhaKCkKICAgIH0KICAgIFJlbGVhc2VNZXNoKCkgewogICAgICAgIHRoaXMuX21lc2hJbmZvICYmICh0aGlzLl9tZXNoSW5mby5zb3VyY2VNZXNoLlJlbGVhc2UoKSwgdGhpcy5fbWVzaEluZm8udHJhbnNmb3JtZWRNZXNoLlJlbGVhc2UoKSwgdGhpcy5fbWVzaEluZm8gPSBudWxsLCB0aGlzLl9EaXNjYXJkVHJhbnNmb3JtZWRDb2xsaXNpb25Qb2x5KCkpCiAgICB9CiAgICBTZXRNZXNoUG9pbnQoYSwgYiwgZCkgewogICAgICAgIGEgPSBNYXRoLmZsb29yKGEpOwogICAgICAgIGIgPSBNYXRoLmZsb29yKGIpOwogICAgICAgIHZhciBjID0gZC5tb2RlIHx8ICJhYnNvbHV0ZSI7CiAgICAgICAgaWYgKCFWQUxJRF9TRVRfTUVTSF9QT0lOVF9NT0RFUy5oYXMoYykpIHRocm93IEVycm9yKCJpbnZhbGlkIG1vZGUiKTsKICAgICAgICBjID0gInJlbGF0aXZlIiA9PT0gYzsKICAgICAgICBsZXQgZSA9IGQueCwKICAgICAgICAgICAgZyA9CiAgICAgICAgICAgIGQueTsKICAgICAgICBjb25zdCBrID0gZC56RWxldmF0aW9uOwogICAgICAgIGxldCBtID0gIm51bWJlciIgPT09IHR5cGVvZiBkLnUgPyBkLnUgOiBjID8gMCA6IC0xOwogICAgICAgIGQgPSAibnVtYmVyIiA9PT0gdHlwZW9mIGQudiA/IGQudiA6IGMgPyAwIDogLTE7CiAgICAgICAgaWYgKCF0aGlzLkhhc01lc2goKSkgcmV0dXJuICExOwogICAgICAgIGNvbnN0IG4gPSB0aGlzLkdldFNvdXJjZU1lc2goKSwKICAgICAgICAgICAgcSA9IG4uR2V0TWVzaFBvaW50QXQoYSwgYik7CiAgICAgICAgaWYgKG51bGwgPT09IHEpIHJldHVybiAhMTsKICAgICAgICBsZXQgdSA9ICExOwogICAgICAgICJudW1iZXIiID09PSB0eXBlb2YgayAmJiBxLkdldFpFbGV2YXRpb24oKSAhPT0gayAmJiAocS5TZXRaRWxldmF0aW9uKGspLCB1ID0gITApOwogICAgICAgIGMgJiYgKGUgKz0gYSAvIChuLkdldEhTaXplKCkgLSAxKSwgZyArPSBiIC8gKG4uR2V0VlNpemUoKSAtIDEpKTsgLSAxICE9PSBtIHx8IGMgPyAoYyAmJiAobSArPSBhIC8gKG4uR2V0SFNpemUoKSAtIDEpKSwgbSA9IEMzJGpzY29tcCQxNTkuY2xhbXAobSwgMCwgMSkpIDogbSA9IHEuR2V0VSgpOyAtIDEgIT09IGQgfHwgYyA/IChjICYmIChkICs9IGIgLyAobi5HZXRWU2l6ZSgpIC0gMSkpLCBkID0gQzMkanNjb21wJDE1OS5jbGFtcChkLCAwLCAxKSkgOiBkID0gcS5HZXRWKCk7CiAgICAgICAgaWYgKHEuR2V0WCgpID09PQogICAgICAgICAgICBlICYmIHEuR2V0WSgpID09PSBnICYmIHEuR2V0VSgpID09PSBtICYmIHEuR2V0VigpID09PSBkKSByZXR1cm4gdTsKICAgICAgICBxLlNldFgoZSk7CiAgICAgICAgcS5TZXRZKGcpOwogICAgICAgIHEuU2V0VShtKTsKICAgICAgICBxLlNldFYoZCk7CiAgICAgICAgdGhpcy5fRGlzY2FyZFRyYW5zZm9ybWVkQ29sbGlzaW9uUG9seSgpOwogICAgICAgIHJldHVybiAhMAogICAgfQogICAgSGFzVGlsZW1hcCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5faW5zdC5IYXNUaWxlbWFwKCkKICAgIH0KICAgIENvbnRhaW5zUG9pbnQoYSwgYikgewogICAgICAgIHJldHVybiB0aGlzLkdldEJvdW5kaW5nQm94KCkuY29udGFpbnNQb2ludChhLCBiKSAmJiB0aGlzLkdldEJvdW5kaW5nUXVhZCgpLmNvbnRhaW5zUG9pbnQoYSwgYikgPyB0aGlzLkhhc1RpbGVtYXAoKSA/IHRoaXMuX2luc3QuR2V0U2RrSW5zdGFuY2UoKS5UZXN0UG9pbnRPdmVybGFwVGlsZShhLCBiKSA6IHRoaXMuSGFzT3duQ29sbGlzaW9uUG9seSgpID8gdGhpcy5HZXRUcmFuc2Zvcm1lZENvbGxpc2lvblBvbHkoKS5jb250YWluc1BvaW50KGEgLSB0aGlzLkdldFgoKSwgYiAtIHRoaXMuR2V0WSgpKSA6ICEwIDogITEKICAgIH0KICAgIF9Jc0NvbGxpc2lvbkNlbGxDaGFuZ2VkKCkgewogICAgICAgIHJldHVybiAwICE9PQogICAgICAgICAgICAodGhpcy5fZmxhZ3MgJiBGTEFHX0NPTExJU0lPTl9DRUxMX0NIQU5HRUQpCiAgICB9CiAgICBfVXBkYXRlQ29sbGlzaW9uQ2VsbCgpIHsKICAgICAgICBpZiAodGhpcy5fSXNDb2xsaXNpb25DZWxsQ2hhbmdlZCgpICYmIHRoaXMuSXNDb2xsaXNpb25FbmFibGVkKCkgJiYgMCA9PT0gKHRoaXMuX2ZsYWdzICYgRkxBR19ERVNUUk9ZRUQkanNjb21wJDEpKSB7CiAgICAgICAgICAgIHZhciBhID0gdGhpcy5HZXRCb3VuZGluZ0JveCgpLAogICAgICAgICAgICAgICAgYiA9IHRoaXMuX29iamVjdENsYXNzLl9HZXRDb2xsaXNpb25DZWxsR3JpZCgpLAogICAgICAgICAgICAgICAgZCA9IHRoaXMuX2NvbGxpc2lvbkNlbGxzOwogICAgICAgICAgICB0ZW1wUmVjdCRqc2NvbXAkNi5zZXQoYi5YVG9DZWxsKGEuZ2V0TGVmdCgpKSwgYi5ZVG9DZWxsKGEuZ2V0VG9wKCkpLCBiLlhUb0NlbGwoYS5nZXRSaWdodCgpKSwgYi5ZVG9DZWxsKGEuZ2V0Qm90dG9tKCkpKTsKICAgICAgICAgICAgZC5lcXVhbHModGVtcFJlY3QkanNjb21wJDYpIHx8IChhID0gdGhpcy5faW5zdCwgZCA9PT0gREVGQVVMVF9DT0xMSVNJT05fQ0VMTFMgPyAoYi5VcGRhdGUoYSwgbnVsbCwgdGVtcFJlY3QkanNjb21wJDYpLCB0aGlzLl9jb2xsaXNpb25DZWxscyA9CiAgICAgICAgICAgICAgICBDMyRqc2NvbXAkMTU5Lk5ldyhDMyRqc2NvbXAkMTU5LlJlY3QsIHRlbXBSZWN0JGpzY29tcCQ2KSkgOiAoYi5VcGRhdGUoYSwgZCwgdGVtcFJlY3QkanNjb21wJDYpLCBkLmNvcHkodGVtcFJlY3QkanNjb21wJDYpKSwgdGhpcy5fZmxhZ3MgJj0gfkZMQUdfQ09MTElTSU9OX0NFTExfQ0hBTkdFRCkKICAgICAgICB9CiAgICB9CiAgICBfUmVtb3ZlRnJvbUNvbGxpc2lvbkNlbGxzKCkgewogICAgICAgIGNvbnN0IGEgPSB0aGlzLl9jb2xsaXNpb25DZWxsczsKICAgICAgICBhICE9PSBERUZBVUxUX0NPTExJU0lPTl9DRUxMUyAmJiAodGhpcy5fb2JqZWN0Q2xhc3MuX0dldENvbGxpc2lvbkNlbGxHcmlkKCkuVXBkYXRlKHRoaXMuX2luc3QsIGEsIG51bGwpLCB0aGlzLl9jb2xsaXNpb25DZWxscyA9IERFRkFVTFRfQ09MTElTSU9OX0NFTExTKQogICAgfQogICAgX1VwZGF0ZVJlbmRlckNlbGwoKSB7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuR2V0TGF5ZXIoKTsKICAgICAgICBpZiAoYS5Vc2VzUmVuZGVyQ2VsbHMoKSAmJiAwID09PSAodGhpcy5fZmxhZ3MgJiBGTEFHX0RFU1RST1lFRCRqc2NvbXAkMSkpIHsKICAgICAgICAgICAgdmFyIGIgPSBhLkdldFJlbmRlckdyaWQoKSwKICAgICAgICAgICAgICAgIGQgPSB0aGlzLkdldEJvdW5kaW5nQm94KCksCiAgICAgICAgICAgICAgICBjID0gdGhpcy5fcmVuZGVyQ2VsbHM7CiAgICAgICAgICAgIHRlbXBSZWN0JGpzY29tcCQ2LnNldChiLlhUb0NlbGwoZC5nZXRMZWZ0KCkpLCBiLllUb0NlbGwoZC5nZXRUb3AoKSksIGIuWFRvQ2VsbChkLmdldFJpZ2h0KCkpLCBiLllUb0NlbGwoZC5nZXRCb3R0b20oKSkpOwogICAgICAgICAgICBjLmVxdWFscyh0ZW1wUmVjdCRqc2NvbXAkNikgfHwgKGQgPSB0aGlzLl9pbnN0LCBjID09PSBERUZBVUxUX1JFTkRFUl9DRUxMUyA/IChiLlVwZGF0ZShkLCBudWxsLCB0ZW1wUmVjdCRqc2NvbXAkNiksIHRoaXMuX3JlbmRlckNlbGxzID0gQzMkanNjb21wJDE1OS5OZXcoQzMkanNjb21wJDE1OS5SZWN0LCB0ZW1wUmVjdCRqc2NvbXAkNikpIDogKGIuVXBkYXRlKGQsIGMsIHRlbXBSZWN0JGpzY29tcCQ2KSwgYy5jb3B5KHRlbXBSZWN0JGpzY29tcCQ2KSksIGEuU2V0UmVuZGVyTGlzdFN0YWxlKCkpCiAgICAgICAgfQogICAgfQogICAgX1JlbW92ZUZyb21SZW5kZXJDZWxscygpIHsKICAgICAgICBjb25zdCBhID0gdGhpcy5fcmVuZGVyQ2VsbHM7CiAgICAgICAgYSAhPT0gREVGQVVMVF9SRU5ERVJfQ0VMTFMgJiYgKHRoaXMuR2V0TGF5ZXIoKS5HZXRSZW5kZXJHcmlkKCkuVXBkYXRlKHRoaXMuX2luc3QsCiAgICAgICAgICAgIGEsIG51bGwpLCB0aGlzLl9yZW5kZXJDZWxscyA9IERFRkFVTFRfUkVOREVSX0NFTExTKQogICAgfQogICAgR2V0UmVuZGVyQ2VsbFJhbmdlKCkgewogICAgICAgIHJldHVybiB0aGlzLl9yZW5kZXJDZWxscwogICAgfQogICAgWk9yZGVyTW92ZVRvVG9wKCkgewogICAgICAgIGNvbnN0IGEgPSB0aGlzLl9pbnN0LAogICAgICAgICAgICBiID0gdGhpcy5fbGF5ZXIsCiAgICAgICAgICAgIGQgPSBiLl9HZXRJbnN0YW5jZXMoKTsKICAgICAgICBkLmxlbmd0aCAmJiBkLmF0KC0xKSA9PT0gYSB8fCAoYi5fUmVtb3ZlSW5zdGFuY2UoYSwgITEpLCBiLl9BZGRJbnN0YW5jZShhLCAhMSksIHRoaXMuX3J1bnRpbWUuVXBkYXRlUmVuZGVyKCkpCiAgICB9CiAgICBaT3JkZXJNb3ZlVG9Cb3R0b20oKSB7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuX2luc3QsCiAgICAgICAgICAgIGIgPSB0aGlzLl9sYXllciwKICAgICAgICAgICAgZCA9IGIuX0dldEluc3RhbmNlcygpOwogICAgICAgIGQubGVuZ3RoICYmIGRbMF0gPT09IGEgfHwgKGIuX1JlbW92ZUluc3RhbmNlKGEsICExKSwgYi5fUHJlcGVuZEluc3RhbmNlKGEsICExKSwgdGhpcy5fcnVudGltZS5VcGRhdGVSZW5kZXIoKSkKICAgIH0KICAgIFpPcmRlck1vdmVUb0xheWVyKGEpIHsKICAgICAgICBjb25zdCBiID0gdGhpcy5faW5zdCwKICAgICAgICAgICAgZCA9IHRoaXMuX2xheWVyOwogICAgICAgIGlmIChkLkdldExheW91dCgpICE9PQogICAgICAgICAgICBhLkdldExheW91dCgpKSB0aHJvdyBFcnJvcigibGF5ZXIgZnJvbSBkaWZmZXJlbnQgbGF5b3V0Iik7CiAgICAgICAgYSAhPT0gZCAmJiAoZC5fUmVtb3ZlSW5zdGFuY2UoYiwgITApLCB0aGlzLl9TZXRMYXllcihhKSwgYS5fQWRkSW5zdGFuY2UoYiwgITApLCB0aGlzLl9ydW50aW1lLlVwZGF0ZVJlbmRlcigpKQogICAgfQogICAgWk9yZGVyTW92ZUFkamFjZW50VG9JbnN0YW5jZShhLCBiKSB7CiAgICAgICAgY29uc3QgZCA9IHRoaXMuX2luc3Q7CiAgICAgICAgbGV0IGMgPSAhMTsKICAgICAgICBjb25zdCBlID0gdGhpcy5fbGF5ZXI7CiAgICAgICAgaWYgKGEuR2V0VUlEKCkgIT09IGQuR2V0VUlEKCkpIHsKICAgICAgICAgICAgdmFyIGcgPSBhLkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICBpZiAoIWcpIHRocm93IEVycm9yKCJleHBlY3RlZCB3b3JsZCBpbnN0YW5jZSIpOwogICAgICAgICAgICBnID0gZy5HZXRMYXllcigpOwogICAgICAgICAgICBlLkdldEluZGV4KCkgIT09IGcuR2V0SW5kZXgoKSAmJiAoZS5fUmVtb3ZlSW5zdGFuY2UoZCwgITApLCB0aGlzLl9TZXRMYXllcihnKSwgZy5fQWRkSW5zdGFuY2UoZCwgITApLCBjID0gITApOwogICAgICAgICAgICBhID0gZy5Nb3ZlSW5zdGFuY2VBZGphY2VudChkLCBhLCAhIWIpOwogICAgICAgICAgICAoYyB8fCBhKSAmJiB0aGlzLl9ydW50aW1lLlVwZGF0ZVJlbmRlcigpCiAgICAgICAgfQogICAgfQogICAgR2V0SW5zdGFuY2VFZmZlY3RMaXN0KCkgewogICAgICAgIHJldHVybiB0aGlzLl9pbnN0YW5jZUVmZmVjdExpc3QKICAgIH0KICAgIF9TZXRIYXNBbnlBY3RpdmVFZmZlY3QoYSkgewogICAgICAgIHRoaXMuX1NldEZsYWcoRkxBR19IQVNfQU5ZX0FDVElWRV9FRkZFQ1QsCiAgICAgICAgICAgIGEpCiAgICB9CiAgICBIYXNBbnlBY3RpdmVFZmZlY3QoKSB7CiAgICAgICAgcmV0dXJuIDAgIT09ICh0aGlzLl9mbGFncyAmIEZMQUdfSEFTX0FOWV9BQ1RJVkVfRUZGRUNUKQogICAgfQogICAgX1NhdmVUb0pzb24oYSkgewogICAgICAgIGNvbnN0IGIgPSB7CiAgICAgICAgICAgIHg6IHRoaXMuR2V0WCgpLAogICAgICAgICAgICB5OiB0aGlzLkdldFkoKSwKICAgICAgICAgICAgdzogdGhpcy5HZXRXaWR0aCgpLAogICAgICAgICAgICBoOiB0aGlzLkdldEhlaWdodCgpLAogICAgICAgICAgICBsOiB0aGlzLkdldExheWVyKCkuR2V0U0lEKCksCiAgICAgICAgICAgIHppOiB0aGlzLkdldFpJbmRleCgpCiAgICAgICAgfTsKICAgICAgICAwICE9PSB0aGlzLkdldFpFbGV2YXRpb24oKSAmJiAoYi56ZSA9IHRoaXMuR2V0WkVsZXZhdGlvbigpKTsKICAgICAgICAwICE9PSB0aGlzLkdldEFuZ2xlKCkgJiYgKGIuYSA9IHRoaXMuR2V0QW5nbGUoKSk7CiAgICAgICAgdGhpcy5IYXNEZWZhdWx0Q29sb3IoKSB8fCAoYi5jID0gdGhpcy5fY29sb3IudG9KU09OKCkpOwogICAgICAgIC41ICE9PSB0aGlzLkdldE9yaWdpblgoKSAmJiAoYi5vWCA9IHRoaXMuR2V0T3JpZ2luWCgpKTsKICAgICAgICAuNSAhPT0gdGhpcy5HZXRPcmlnaW5ZKCkgJiYgKGIub1kgPSB0aGlzLkdldE9yaWdpblkoKSk7CiAgICAgICAgMCAhPT0gdGhpcy5HZXRCbGVuZE1vZGUoKSAmJiAoYi5ibSA9IHRoaXMuR2V0QmxlbmRNb2RlKCkpOwogICAgICAgIHRoaXMuSXNWaXNpYmxlKCkgfHwgKGIudiA9IHRoaXMuSXNWaXNpYmxlKCkpOwogICAgICAgIHRoaXMuSXNDb2xsaXNpb25FbmFibGVkKCkgfHwgKGIuY2UgPSB0aGlzLklzQ29sbGlzaW9uRW5hYmxlZCgpKTsKICAgICAgICB0aGlzLklzQmJveENoYW5nZUV2ZW50RW5hYmxlZCgpICYmIChiLmJlID0gdGhpcy5Jc0Jib3hDaGFuZ2VFdmVudEVuYWJsZWQoKSk7CiAgICAgICAgdGhpcy5faW5zdGFuY2VFZmZlY3RMaXN0ICYmIChiLmZ4ID0gdGhpcy5faW5zdGFuY2VFZmZlY3RMaXN0Ll9TYXZlVG9Kc29uKCkpOwogICAgICAgIGNvbnN0IGQgPSAwICE9PSAodGhpcy5fZmxhZ3MgJiBGTEFHX1NPTElEX0ZJTFRFUl9JTkNMVVNJVkUpOwogICAgICAgIGQgJiYgKGIuc2ZpID0gZCk7CiAgICAgICAgdGhpcy5fc29saWRGaWx0ZXJUYWdzICYmIChiLnNmdCA9IFsuLi50aGlzLl9zb2xpZEZpbHRlclRhZ3NdLmpvaW4oIiAiKSk7CiAgICAgICAgdGhpcy5fc2NlbmVHcmFwaEluZm8gJiYgInZpc3VhbC1zdGF0ZSIgIT09IGEgJiYgKGIuc2dpID0gdGhpcy5fc2NlbmVHcmFwaEluZm8uX1NhdmVUb0pzb24oYSksIHNjZW5lR3JhcGhFeHBvcnREYXRhTWFwLmhhcyh0aGlzKSAmJiAoYi5zZ2NkID0KICAgICAgICAgICAgc2NlbmVHcmFwaEV4cG9ydERhdGFNYXAuZ2V0KHRoaXMpLmNoaWxkcmVuRGF0YSwgYi5zZ3ppZCA9IHNjZW5lR3JhcGhFeHBvcnREYXRhTWFwLmdldCh0aGlzKS56SW5kZXhEYXRhKSk7CiAgICAgICAgdGhpcy5IYXNNZXNoKCkgJiYgKGIubWVzaCA9IHRoaXMuR2V0U291cmNlTWVzaCgpLlNhdmVUb0pzb24oKSk7CiAgICAgICAgcmV0dXJuIGIKICAgIH0KICAgIF9TYXZlU2NlbmVHcmFwaFByb3BlcnRpZXNUb0pzb24oKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgeDogdGhpcy5feCwKICAgICAgICAgICAgeTogdGhpcy5feSwKICAgICAgICAgICAgejogdGhpcy5fekVsZXZhdGlvbiwKICAgICAgICAgICAgdzogdGhpcy5fdywKICAgICAgICAgICAgaDogdGhpcy5faCwKICAgICAgICAgICAgYTogdGhpcy5fYQogICAgICAgIH0KICAgIH0KICAgIF9Mb2FkU2NlbmVHcmFwaFByb3BlcnRpZXNGcm9tSnNvbihhKSB7CiAgICAgICAgYSAmJiAodGhpcy5feCA9IGEueCwgdGhpcy5feSA9IGEueSwgdGhpcy5fekVsZXZhdGlvbiA9IGEueiwgdGhpcy5fdyA9IGEudywgdGhpcy5faCA9IGEuaCwgdGhpcy5fYSA9IGEuYSwgdGhpcy5fTWFya1NpbkNvc0FuZ2xlQ2hhbmdlZCgpLCB0aGlzLlNldEJib3hDaGFuZ2VkKCkpCiAgICB9CiAgICBfU2V0dXBTY2VuZUdyYXBoQ29ubmVjdGlvbnNPbkNoYW5nZU9mTGF5b3V0KCkgewogICAgICAgIHRoaXMuX1JlbGVhc2VUbXBTY2VuZUdyYXBoSW5mbygpOwogICAgICAgIHRoaXMuX1Jlc2V0QWxsU2NlbmVHcmFwaFN0YXRlKCk7CiAgICAgICAgdGhpcy5fQ3JlYXRlU2NlbmVHcmFwaEluZm8obnVsbCk7CiAgICAgICAgdGhpcy5fc2NlbmVHcmFwaEluZm8gJiYgdGhpcy5fc2NlbmVHcmFwaEluZm8uX1NldFRtcFNjZW5lR3JhcGhDaGlsZHJlbih0aGlzLl90bXBTY2VuZUdyYXBoQ2hpbGRyZW4sIHRoaXMuX3RtcFNjZW5lR3JhcGhDaGlsZHJlbkluZGV4ZXMpCiAgICB9CiAgICBfT25CZWZvcmVMb2FkKGEpIHsKICAgICAgICAidmlzdWFsLXN0YXRlIiAhPT0gYSAmJiB0aGlzLl9SZXNldEFsbFNjZW5lR3JhcGhTdGF0ZSgpCiAgICB9CiAgICBfTG9hZEZyb21Kc29uKGEsIGIpIHsKICAgICAgICBlbmFibGVVcGRhdGVSZW5kZXJlclN0YXRlR3JvdXAgPSAhMTsKICAgICAgICB0aGlzLlNldFgoYS54KTsKICAgICAgICB0aGlzLlNldFkoYS55KTsKICAgICAgICB0aGlzLlNldFdpZHRoKGEudyk7CiAgICAgICAgdGhpcy5TZXRIZWlnaHQoYS5oKTsKICAgICAgICB0aGlzLl9TZXRaSW5kZXgoYS56aSk7CiAgICAgICAgdGhpcy5TZXRaRWxldmF0aW9uKGEuaGFzT3duUHJvcGVydHkoInplIikgPyBhLnplIDogMCk7CiAgICAgICAgdGhpcy5TZXRBbmdsZShhLmhhc093blByb3BlcnR5KCJhIikgPyBhLmEgOgogICAgICAgICAgICAwKTsKICAgICAgICBhLmhhc093blByb3BlcnR5KCJjIikgPyB0ZW1wQ29sb3IkanNjb21wJDYuc2V0RnJvbUpTT04oYS5jKSA6IGEuaGFzT3duUHJvcGVydHkoIm8iKSA/ICh0ZW1wQ29sb3IkanNjb21wJDYuY29weVJnYih0aGlzLl9jb2xvciksIHRlbXBDb2xvciRqc2NvbXAkNi5hID0gYS5vKSA6IHRlbXBDb2xvciRqc2NvbXAkNi5zZXRSZ2JhKDEsIDEsIDEsIDEpOwogICAgICAgIHRoaXMuX1NldENvbG9yKHRlbXBDb2xvciRqc2NvbXAkNik7CiAgICAgICAgdGhpcy5TZXRPcmlnaW5YKGEuaGFzT3duUHJvcGVydHkoIm9YIikgPyBhLm9YIDogLjUpOwogICAgICAgIHRoaXMuU2V0T3JpZ2luWShhLmhhc093blByb3BlcnR5KCJvWSIpID8gYS5vWSA6IC41KTsKICAgICAgICB0aGlzLlNldEJsZW5kTW9kZShhLmhhc093blByb3BlcnR5KCJibSIpID8gYS5ibSA6IDApOwogICAgICAgIHRoaXMuU2V0VmlzaWJsZShhLmhhc093blByb3BlcnR5KCJ2IikgPyBhLnYgOiAhMCk7CiAgICAgICAgdGhpcy5TZXRDb2xsaXNpb25FbmFibGVkKGEuaGFzT3duUHJvcGVydHkoImNlIikgPyBhLmNlIDogITApOwogICAgICAgIHRoaXMuU2V0QmJveENoYW5nZUV2ZW50RW5hYmxlZChhLmhhc093blByb3BlcnR5KCJiZSIpID8KICAgICAgICAgICAgYS5iZSA6ICExKTsKICAgICAgICB0aGlzLlNldFNvbGlkQ29sbGlzaW9uRmlsdGVyKGEuaGFzT3duUHJvcGVydHkoInNmaSIpID8gYS5zZmkgOiAhMSwgYS5oYXNPd25Qcm9wZXJ0eSgic2Z0IikgPyBhLnNmdCA6ICIiKTsKICAgICAgICB0aGlzLl9pbnN0YW5jZUVmZmVjdExpc3QgJiYgYS5oYXNPd25Qcm9wZXJ0eSgiZngiKSAmJiB0aGlzLl9pbnN0YW5jZUVmZmVjdExpc3QuX0xvYWRGcm9tSnNvbihhLmZ4KTsKICAgICAgICBpZiAoIWEuaGFzT3duUHJvcGVydHkoInNnaSIpICYmICJ2aXN1YWwtc3RhdGUiICE9PSBiICYmIHRoaXMuX3RtcFNjZW5lR3JhcGhDaGlsZHJlbikKICAgICAgICAgICAgZm9yIChjb25zdCBkIG9mIHRoaXMuX3RtcFNjZW5lR3JhcGhDaGlsZHJlbikgdGhpcy5fcnVudGltZS5EZXN0cm95SW5zdGFuY2UoZCk7CiAgICAgICAgaWYgKGEuaGFzT3duUHJvcGVydHkoInNnaSIpICYmICJ2aXN1YWwtc3RhdGUiICE9PSBiKSB7CiAgICAgICAgICAgIHRoaXMuX0NyZWF0ZVNjZW5lR3JhcGhJbmZvKG51bGwpOwogICAgICAgICAgICBjb25zdCBkID0gdGhpcy5fc2NlbmVHcmFwaEluZm8sCiAgICAgICAgICAgICAgICBjID0gYS5zZ2k7CiAgICAgICAgICAgIGQuX0xvYWRGcm9tSnNvbihjKTsKICAgICAgICAgICAgZC5fU2V0VG1wU2NlbmVHcmFwaENoaWxkcmVuKHRoaXMuX3RtcFNjZW5lR3JhcGhDaGlsZHJlbiwKICAgICAgICAgICAgICAgIHRoaXMuX3RtcFNjZW5lR3JhcGhDaGlsZHJlbkluZGV4ZXMpOwogICAgICAgICAgICBuZWVkc1NjZW5lR3JhcGhBZnRlckxvYWQuc2V0KHRoaXMsICEwKTsKICAgICAgICAgICAgY29uc3QgZSA9IHRoaXMuR2V0UnVudGltZSgpLkRpc3BhdGNoZXIoKSwKICAgICAgICAgICAgICAgIGcgPSAobSwgbikgPT4gewogICAgICAgICAgICAgICAgICAgIGUucmVtb3ZlRXZlbnRMaXN0ZW5lcigiYWZ0ZXJsb2FkIiwgZyk7CiAgICAgICAgICAgICAgICAgICAgZS5yZW1vdmVFdmVudExpc3RlbmVyKCJhZnRlcmxvYWRpbnN0YW5jZSIsIGspOwogICAgICAgICAgICAgICAgICAgIDAgPT09ICh0aGlzLl9mbGFncyAmIEZMQUdfREVTVFJPWUVEJGpzY29tcCQxKSAmJiAoZC5fT25BZnRlckxvYWQoYywgbiksIGQuX1NldFRtcFNjZW5lR3JhcGhDaGlsZHJlbihudWxsLCBudWxsKSwgdGhpcy5fUmVsZWFzZVRtcFNjZW5lR3JhcGhJbmZvKCksIHRoaXMuU2V0QmJveENoYW5nZWQoKSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBrID0gbSA9PiB7CiAgICAgICAgICAgICAgICAgICAgbS5pbnN0YW5jZSA9PT0gdGhpcy5HZXRJbnN0YW5jZSgpICYmIGcobSwgewogICAgICAgICAgICAgICAgICAgICAgICBpZ25vcmVNaXNzaW5nSW5zdGFuY2VzOiAhMAogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICBlLmFkZEV2ZW50TGlzdGVuZXIoImFmdGVybG9hZCIsIGcpOwogICAgICAgICAgICBlLmFkZEV2ZW50TGlzdGVuZXIoImFmdGVybG9hZGluc3RhbmNlIiwKICAgICAgICAgICAgICAgIGspOwogICAgICAgICAgICBhLnNnY2QgJiYgQzMkanNjb21wJDE1OS5Jc0Zpbml0ZU51bWJlcihhLnNnemlkKSAmJiBzY2VuZUdyYXBoRXhwb3J0RGF0YU1hcC5zZXQodGhpcywgewogICAgICAgICAgICAgICAgY2hpbGRyZW5EYXRhOiBhLnNnY2QsCiAgICAgICAgICAgICAgICB6SW5kZXhEYXRhOiBhLnNnemlkCiAgICAgICAgICAgIH0pCiAgICAgICAgfQogICAgICAgIGEuaGFzT3duUHJvcGVydHkoIm1lc2giKSA/IChhID0gYS5tZXNoLCB0aGlzLkNyZWF0ZU1lc2goYS5jb2xzLCBhLnJvd3MpLCB0aGlzLkdldFNvdXJjZU1lc2goKS5Mb2FkRnJvbUpzb24oYSkpIDogdGhpcy5SZWxlYXNlTWVzaCgpOwogICAgICAgIHRoaXMuU2V0QmJveENoYW5nZWQoKTsKICAgICAgICBlbmFibGVVcGRhdGVSZW5kZXJlclN0YXRlR3JvdXAgPSAhMDsKICAgICAgICB0aGlzLl9VcGRhdGVSZW5kZXJlclN0YXRlR3JvdXAoKQogICAgfQp9OwoidXNlIHN0cmljdCI7CmNvbnN0IEMzJGpzY29tcCQxNjAgPSBzZWxmLkMzOwpDMyRqc2NvbXAkMTYwLkJlaGF2aW9yVHlwZSA9IGNsYXNzIGV4dGVuZHMgQzMkanNjb21wJDE2MC5EZWZlbmRlZEJhc2UgewogICAgY29uc3RydWN0b3IoYSwgYikgewogICAgICAgIHN1cGVyKCk7CiAgICAgICAgY29uc3QgZCA9IGEuR2V0UnVudGltZSgpLAogICAgICAgICAgICBjID0gZC5HZXRQbHVnaW5NYW5hZ2VyKCksCiAgICAgICAgICAgIGUgPSBkLkdldE9iamVjdFJlZmVyZW5jZShiWzFdKTsKICAgICAgICBjLkhhc0JlaGF2aW9yQnlDb25zdHJ1Y3RvckZ1bmN0aW9uKGUpIHx8IGMuQ3JlYXRlQmVoYXZpb3IoYik7CiAgICAgICAgdGhpcy5fcnVudGltZSA9IGQ7CiAgICAgICAgdGhpcy5fb2JqZWN0Q2xhc3MgPSBhOwogICAgICAgIHRoaXMuX2JlaGF2aW9yID0gYy5HZXRCZWhhdmlvckJ5Q29uc3RydWN0b3JGdW5jdGlvbihlKTsKICAgICAgICB0aGlzLl9zZGtUeXBlID0gbnVsbDsKICAgICAgICB0aGlzLl9pbnN0U2RrQ3RvciA9IGUuSW5zdGFuY2U7CiAgICAgICAgdGhpcy5fc2lkID0gYlsyXTsKICAgICAgICB0aGlzLl9uYW1lID0gYlswXTsKICAgICAgICB0aGlzLl9qc1Byb3BOYW1lID0gdGhpcy5fcnVudGltZS5HZXRKc1Byb3BOYW1lKGJbM10pOwogICAgICAgIHRoaXMuX3Nka1R5cGUgPSBDMyRqc2NvbXAkMTYwLk5ldyhlLlR5cGUsIHRoaXMpOwogICAgICAgIHRoaXMuT25DcmVhdGUoKQogICAgfQogICAgc3RhdGljIENyZWF0ZShhLAogICAgICAgIGIpIHsKICAgICAgICByZXR1cm4gQzMkanNjb21wJDE2MC5OZXcoQzMkanNjb21wJDE2MC5CZWhhdmlvclR5cGUsIGEsIGIpCiAgICB9CiAgICBSZWxlYXNlKCkgewogICAgICAgIHRoaXMuX2JlaGF2aW9yID0gdGhpcy5fcnVudGltZSA9IG51bGw7CiAgICAgICAgdGhpcy5fc2RrVHlwZS5SZWxlYXNlKCk7CiAgICAgICAgdGhpcy5faW5zdFNka0N0b3IgPSB0aGlzLl9zZGtUeXBlID0gbnVsbAogICAgfQogICAgR2V0U2RrVHlwZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fc2RrVHlwZQogICAgfQogICAgT25DcmVhdGUoKSB7CiAgICAgICAgdGhpcy5fc2RrVHlwZS5PbkNyZWF0ZSgpCiAgICB9CiAgICBHZXRSdW50aW1lKCkgewogICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lCiAgICB9CiAgICBHZXRPYmplY3RDbGFzcygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fb2JqZWN0Q2xhc3MKICAgIH0KICAgIEdldEJlaGF2aW9yKCkgewogICAgICAgIHJldHVybiB0aGlzLl9iZWhhdmlvcgogICAgfQogICAgR2V0SW5zdGFuY2VTZGtDdG9yKCkgewogICAgICAgIHJldHVybiB0aGlzLl9pbnN0U2RrQ3RvcgogICAgfQogICAgR2V0TmFtZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fbmFtZQogICAgfQogICAgR2V0U0lEKCkgewogICAgICAgIHJldHVybiB0aGlzLl9zaWQKICAgIH0KICAgIEdldEpzUHJvcE5hbWUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2pzUHJvcE5hbWUKICAgIH0KfTsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkMTYxID0gc2VsZi5DMywKICAgIElCZWhhdmlvckluc3RhbmNlJGpzY29tcCQxID0gc2VsZi5JQmVoYXZpb3JJbnN0YW5jZTsKQzMkanNjb21wJDE2MS5CZWhhdmlvckluc3RhbmNlID0gY2xhc3MgZXh0ZW5kcyBDMyRqc2NvbXAkMTYxLkRlZmVuZGVkQmFzZSB7CiAgICBjb25zdHJ1Y3RvcihhKSB7CiAgICAgICAgc3VwZXIoKTsKICAgICAgICB0aGlzLl9ydW50aW1lID0gYS5ydW50aW1lOwogICAgICAgIHRoaXMuX2JlaGF2aW9yVHlwZSA9IGEuYmVoYXZpb3JUeXBlOwogICAgICAgIHRoaXMuX2JlaGF2aW9yID0gdGhpcy5fYmVoYXZpb3JUeXBlLkdldEJlaGF2aW9yKCk7CiAgICAgICAgdGhpcy5faW5zdCA9IGEuaW5zdGFuY2U7CiAgICAgICAgdGhpcy5faW5kZXggPSBhLmluZGV4OwogICAgICAgIHRoaXMuX2lTY3JpcHRJbnRlcmZhY2UgPSB0aGlzLl9zZGtJbnN0ID0gbnVsbDsKICAgICAgICB0aGlzLl9iZWhhdmlvci5fQWRkSW5zdGFuY2UodGhpcy5faW5zdCkKICAgIH0KICAgIFJlbGVhc2UoKSB7CiAgICAgICAgdGhpcy5faVNjcmlwdEludGVyZmFjZSAmJiAodGhpcy5faVNjcmlwdEludGVyZmFjZS5fUmVsZWFzZSgpLCB0aGlzLl9pU2NyaXB0SW50ZXJmYWNlID0gbnVsbCk7CiAgICAgICAgdGhpcy5fYmVoYXZpb3IuX1JlbW92ZUluc3RhbmNlKHRoaXMuX2luc3QpOwogICAgICAgIHRoaXMuX3Nka0luc3QuUmVsZWFzZSgpOwogICAgICAgIHRoaXMuX2luc3QgPQogICAgICAgICAgICB0aGlzLl9iZWhhdmlvciA9IHRoaXMuX2JlaGF2aW9yVHlwZSA9IHRoaXMuX3J1bnRpbWUgPSB0aGlzLl9zZGtJbnN0ID0gbnVsbAogICAgfQogICAgX0NyZWF0ZVNka0luc3RhbmNlKGEpIHsKICAgICAgICBpZiAodGhpcy5fc2RrSW5zdCkgdGhyb3cgRXJyb3IoImFscmVhZHkgZ290IHNkayBpbnN0YW5jZSIpOwogICAgICAgIHRoaXMuX3Nka0luc3QgPSBDMyRqc2NvbXAkMTYxLk5ldyh0aGlzLl9iZWhhdmlvclR5cGUuR2V0SW5zdGFuY2VTZGtDdG9yKCksIHRoaXMsIGEpCiAgICB9CiAgICBHZXRTZGtJbnN0YW5jZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fc2RrSW5zdAogICAgfQogICAgR2V0T2JqZWN0SW5zdGFuY2UoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2luc3QKICAgIH0KICAgIEdldFJ1bnRpbWUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUKICAgIH0KICAgIEdldEJlaGF2aW9yVHlwZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fYmVoYXZpb3JUeXBlCiAgICB9CiAgICBHZXRCZWhhdmlvcigpIHsKICAgICAgICByZXR1cm4gdGhpcy5fYmVoYXZpb3IKICAgIH0KICAgIF9HZXRJbmRleCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5faW5kZXgKICAgIH0KICAgIFBvc3RDcmVhdGUoKSB7CiAgICAgICAgdGhpcy5fc2RrSW5zdC5Qb3N0Q3JlYXRlKCkKICAgIH0KICAgIE9uU3ByaXRlRnJhbWVDaGFuZ2VkKGEsCiAgICAgICAgYikgewogICAgICAgIHRoaXMuX3Nka0luc3QuT25TcHJpdGVGcmFtZUNoYW5nZWQoYSwgYikKICAgIH0KICAgIF9HZXREZWJ1Z2dlclByb3BlcnRpZXMoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3Nka0luc3QuR2V0RGVidWdnZXJQcm9wZXJ0aWVzKCkKICAgIH0KICAgIFNhdmVUb0pzb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3Nka0luc3QuU2F2ZVRvSnNvbigpCiAgICB9CiAgICBMb2FkRnJvbUpzb24oYSkgewogICAgICAgIHJldHVybiB0aGlzLl9zZGtJbnN0LkxvYWRGcm9tSnNvbihhKQogICAgfQogICAgc3RhdGljIFNvcnRCeVRpY2tTZXF1ZW5jZShhLCBiKSB7CiAgICAgICAgdmFyIGQgPSBhLkdldE9iamVjdEluc3RhbmNlKCksCiAgICAgICAgICAgIGMgPSBiLkdldE9iamVjdEluc3RhbmNlKCk7CiAgICAgICAgY29uc3QgZSA9IGQuR2V0T2JqZWN0Q2xhc3MoKS5HZXRJbmRleCgpLAogICAgICAgICAgICBnID0gYy5HZXRPYmplY3RDbGFzcygpLkdldEluZGV4KCk7CiAgICAgICAgaWYgKGUgIT09IGcpIHJldHVybiBlIC0gZzsKICAgICAgICBkID0gZC5HZXRQVUlEKCk7CiAgICAgICAgYyA9IGMuR2V0UFVJRCgpOwogICAgICAgIHJldHVybiBkICE9PSBjID8gZCAtIGMgOiBhLkdldEJlaGF2aW9ySW5zdGFuY2UoKS5fR2V0SW5kZXgoKSAtIGIuR2V0QmVoYXZpb3JJbnN0YW5jZSgpLl9HZXRJbmRleCgpCiAgICB9CiAgICBfSW5pdFNjcmlwdEludGVyZmFjZSgpIHsKICAgICAgICBjb25zdCBhID0KICAgICAgICAgICAgdGhpcy5fc2RrSW5zdC5HZXRTY3JpcHRJbnRlcmZhY2VDbGFzcygpLAogICAgICAgICAgICBiID0gYSB8fCBJQmVoYXZpb3JJbnN0YW5jZSRqc2NvbXAkMTsKICAgICAgICBJQmVoYXZpb3JJbnN0YW5jZSRqc2NvbXAkMS5fSW5pdCh0aGlzKTsKICAgICAgICB0aGlzLl9pU2NyaXB0SW50ZXJmYWNlID0gbmV3IGI7CiAgICAgICAgSUJlaGF2aW9ySW5zdGFuY2UkanNjb21wJDEuX0luaXQobnVsbCk7CiAgICAgICAgaWYgKGEgJiYgISh0aGlzLl9pU2NyaXB0SW50ZXJmYWNlIGluc3RhbmNlb2YgSUJlaGF2aW9ySW5zdGFuY2UkanNjb21wJDEpKSB0aHJvdyBuZXcgVHlwZUVycm9yKGBzY3JpcHQgaW50ZXJmYWNlIGNsYXNzICcke2EubmFtZX0nIGRvZXMgbm90IGV4dGVuZCB0aGUgcmlnaHQgYmFzZSBjbGFzcyAnJHtJQmVoYXZpb3JJbnN0YW5jZSRqc2NvbXAkMS5uYW1lfSdgKTsKICAgICAgICByZXR1cm4gdGhpcy5faVNjcmlwdEludGVyZmFjZQogICAgfQogICAgR2V0U2NyaXB0SW50ZXJmYWNlKCkgewogICAgICAgIHJldHVybiB0aGlzLl9pU2NyaXB0SW50ZXJmYWNlIHx8IHRoaXMuX0luaXRTY3JpcHRJbnRlcmZhY2UoKQogICAgfQogICAgSGFzU2NyaXB0SW50ZXJmYWNlKCkgewogICAgICAgIHJldHVybiAhIXRoaXMuX2lTY3JpcHRJbnRlcmZhY2UKICAgIH0KfTsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkMTYyID0gc2VsZi5DMzsKQzMkanNjb21wJDE2Mi5FZmZlY3RMaXN0ID0gY2xhc3MgZXh0ZW5kcyBDMyRqc2NvbXAkMTYyLkRlZmVuZGVkQmFzZSB7CiAgICBjb25zdHJ1Y3RvcihhLCBiKSB7CiAgICAgICAgc3VwZXIoKTsKICAgICAgICB0aGlzLl9vd25lciA9IGE7CiAgICAgICAgdGhpcy5fYWxsRWZmZWN0VHlwZXMgPSBbXTsKICAgICAgICB0aGlzLl9hY3RpdmVFZmZlY3RUeXBlcyA9IFtdOwogICAgICAgIHRoaXMuX2VmZmVjdFR5cGVzQnlOYW1lID0gbmV3IE1hcDsKICAgICAgICB0aGlzLl9lZmZlY3RQYXJhbXMgPSBbXTsKICAgICAgICB0aGlzLl9lZmZlY3RQYXJhbUJ1ZmZlcnMgPSBbXTsKICAgICAgICB0aGlzLl9wcmVzZXJ2ZXNPcGFxdWVuZXNzID0gITA7CiAgICAgICAgZm9yIChjb25zdCBkIG9mIGIpIGEgPSBDMyRqc2NvbXAkMTYyLk5ldyhDMyRqc2NvbXAkMTYyLkVmZmVjdFR5cGUsIHRoaXMsIGQsIHRoaXMuX2FsbEVmZmVjdFR5cGVzLmxlbmd0aCksIHRoaXMuX2FsbEVmZmVjdFR5cGVzLnB1c2goYSksIHRoaXMuX2VmZmVjdFR5cGVzQnlOYW1lLnNldChhLkdldE5hbWUoKS50b0xvd2VyQ2FzZSgpLCBhKSwgMyA8PSBkLmxlbmd0aCAmJiB0aGlzLl9lZmZlY3RQYXJhbXMucHVzaCh0aGlzLl9Mb2FkU2luZ2xlRWZmZWN0UGFyYW1ldGVycyhhLAogICAgICAgICAgICBkWzJdKSk7CiAgICAgICAgdGhpcy5HZXRSdW50aW1lKCkuX0FkZEVmZmVjdExpc3QodGhpcykKICAgIH0KICAgIFJlbGVhc2UoKSB7CiAgICAgICAgZm9yIChjb25zdCBhIG9mIHRoaXMuX2VmZmVjdFBhcmFtQnVmZmVycykgYS5SZWxlYXNlKCk7CiAgICAgICAgQzMkanNjb21wJDE2Mi5jbGVhckFycmF5KHRoaXMuX2VmZmVjdFBhcmFtQnVmZmVycyk7CiAgICAgICAgQzMkanNjb21wJDE2Mi5jbGVhckFycmF5KHRoaXMuX2FsbEVmZmVjdFR5cGVzKTsKICAgICAgICBDMyRqc2NvbXAkMTYyLmNsZWFyQXJyYXkodGhpcy5fYWN0aXZlRWZmZWN0VHlwZXMpOwogICAgICAgIHRoaXMuX2VmZmVjdFR5cGVzQnlOYW1lLmNsZWFyKCk7CiAgICAgICAgQzMkanNjb21wJDE2Mi5jbGVhckFycmF5KHRoaXMuX2VmZmVjdFBhcmFtcyk7CiAgICAgICAgdGhpcy5fb3duZXIgPSBudWxsCiAgICB9CiAgICBfSW5pdFJlbmRlcmVyKGEpIHsKICAgICAgICBhLklzV2ViR1BVKCkgJiYgKHRoaXMuX2VmZmVjdFBhcmFtQnVmZmVycyA9IHRoaXMuX2FsbEVmZmVjdFR5cGVzLm1hcChiID0+IHsKICAgICAgICAgICAgYiA9IGIuR2V0U2hhZGVyUHJvZ3JhbSgpOwogICAgICAgICAgICByZXR1cm4gMCA8IGIuR2V0Q3VzdG9tUGFyYW1ldGVyc0J5dGVTaXplKCkgPyBDMyRqc2NvbXAkMTYyLk5ldyhDMyRqc2NvbXAkMTYyLkdmeC5XZWJHUFVFZmZlY3RDdXN0b21QYXJhbXNCdWZmZXIsCiAgICAgICAgICAgICAgICBiKSA6IG51bGwKICAgICAgICB9KSwgdGhpcy5fVXBkYXRlQWxsRWZmZWN0UGFyYW1CdWZmZXJzKCkpCiAgICB9CiAgICBQcmVwZW5kRWZmZWN0VHlwZXMoYSkgewogICAgICAgIGlmIChhLmxlbmd0aCkgewogICAgICAgICAgICB0aGlzLl9hbGxFZmZlY3RUeXBlcyA9IGEuY29uY2F0KHRoaXMuX2FsbEVmZmVjdFR5cGVzKTsKICAgICAgICAgICAgZm9yIChjb25zdCBiIG9mIGEpIHRoaXMuX2VmZmVjdFR5cGVzQnlOYW1lLnNldChiLkdldE5hbWUoKS50b0xvd2VyQ2FzZSgpLCBiKTsKICAgICAgICAgICAgZm9yIChsZXQgYiA9IDAsIGQgPSB0aGlzLl9hbGxFZmZlY3RUeXBlcy5sZW5ndGg7IGIgPCBkOyArK2IpIHRoaXMuX2FsbEVmZmVjdFR5cGVzW2JdLl9TZXRJbmRleChiKQogICAgICAgIH0KICAgIH0KICAgIF9Mb2FkU2luZ2xlRWZmZWN0UGFyYW1ldGVycyhhLCBiKSB7CiAgICAgICAgYS5TZXRBY3RpdmUoYlswXSk7CiAgICAgICAgYSA9IGIuc2xpY2UoMSk7CiAgICAgICAgZm9yIChsZXQgZCA9IDAsIGMgPSBhLmxlbmd0aDsgZCA8IGM7ICsrZCkKICAgICAgICAgICAgaWYgKGIgPSBhW2RdLCBBcnJheS5pc0FycmF5KGIpKSB7CiAgICAgICAgICAgICAgICBjb25zdCBlID0gQzMkanNjb21wJDE2Mi5OZXcoQzMkanNjb21wJDE2Mi5Db2xvcik7CiAgICAgICAgICAgICAgICBlLnNldEZyb21KU09OKGIpOwogICAgICAgICAgICAgICAgYVtkXSA9IGUKICAgICAgICAgICAgfQogICAgICAgIHJldHVybiBhCiAgICB9CiAgICBHZXRPd25lcigpIHsKICAgICAgICByZXR1cm4gdGhpcy5fb3duZXIKICAgIH0KICAgIEdldFJ1bnRpbWUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX293bmVyLkdldFJ1bnRpbWUoKQogICAgfQogICAgVXBkYXRlQWN0aXZlRWZmZWN0cygpIHsKICAgICAgICBDMyRqc2NvbXAkMTYyLmNsZWFyQXJyYXkodGhpcy5fYWN0aXZlRWZmZWN0VHlwZXMpOwogICAgICAgIGxldCBhID0gITA7CiAgICAgICAgZm9yIChjb25zdCBiIG9mIHRoaXMuX2FsbEVmZmVjdFR5cGVzKSBiLklzQWN0aXZlKCkgJiYgKHRoaXMuX2FjdGl2ZUVmZmVjdFR5cGVzLnB1c2goYiksIGIuR2V0U2hhZGVyUHJvZ3JhbSgpLlByZXNlcnZlc09wYXF1ZW5lc3MoKSB8fCAoYSA9ICExKSk7CiAgICAgICAgdGhpcy5fcHJlc2VydmVzT3BhcXVlbmVzcyA9IGEKICAgIH0KICAgIEdldEFsbEVmZmVjdFR5cGVzKCkgewogICAgICAgIHJldHVybiB0aGlzLl9hbGxFZmZlY3RUeXBlcwogICAgfQogICAgSGFzQW55RWZmZWN0VHlwZSgpIHsKICAgICAgICByZXR1cm4gMCA8IHRoaXMuX2FsbEVmZmVjdFR5cGVzLmxlbmd0aAogICAgfQogICAgR2V0RWZmZWN0VHlwZUJ5TmFtZShhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2VmZmVjdFR5cGVzQnlOYW1lLmdldChhLnRvTG93ZXJDYXNlKCkpIHx8IG51bGwKICAgIH0KICAgIEdldEVmZmVjdFR5cGVCeUluZGV4KGEpIHsKICAgICAgICBhID0gTWF0aC5mbG9vcigrYSk7CiAgICAgICAgaWYgKDAgPiBhIHx8IGEgPj0gdGhpcy5fYWxsRWZmZWN0VHlwZXMubGVuZ3RoKSB0aHJvdyBuZXcgUmFuZ2VFcnJvcigiaW52YWxpZCBlZmZlY3QgdHlwZSBpbmRleCIpOwogICAgICAgIHJldHVybiB0aGlzLl9hbGxFZmZlY3RUeXBlc1thXQogICAgfQogICAgSXNFZmZlY3RJbmRleEFjdGl2ZShhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuR2V0RWZmZWN0VHlwZUJ5SW5kZXgoYSkuSXNBY3RpdmUoKQogICAgfQogICAgU2V0RWZmZWN0SW5kZXhBY3RpdmUoYSwKICAgICAgICBiKSB7CiAgICAgICAgdGhpcy5HZXRFZmZlY3RUeXBlQnlJbmRleChhKS5TZXRBY3RpdmUoYikKICAgIH0KICAgIEdldEFjdGl2ZUVmZmVjdFR5cGVzKCkgewogICAgICAgIHJldHVybiB0aGlzLl9hY3RpdmVFZmZlY3RUeXBlcwogICAgfQogICAgSGFzQW55QWN0aXZlRWZmZWN0KCkgewogICAgICAgIHJldHVybiAwIDwgdGhpcy5fYWN0aXZlRWZmZWN0VHlwZXMubGVuZ3RoCiAgICB9CiAgICBQcmVzZXJ2ZXNPcGFxdWVuZXNzKCkgewogICAgICAgIHJldHVybiB0aGlzLl9wcmVzZXJ2ZXNPcGFxdWVuZXNzCiAgICB9CiAgICBHZXRFZmZlY3RQYXJhbWV0ZXJzRm9ySW5kZXgoYSkgewogICAgICAgIHJldHVybiB0aGlzLl9lZmZlY3RQYXJhbXNbYV0KICAgIH0KICAgIF9HZXRFZmZlY3RDaGFpblNoYWRlclBhcmFtZXRlcnNGb3JJbmRleChhKSB7CiAgICAgICAgcmV0dXJuIGEgPCB0aGlzLl9lZmZlY3RQYXJhbUJ1ZmZlcnMubGVuZ3RoID8gdGhpcy5fZWZmZWN0UGFyYW1CdWZmZXJzW2FdIDogdGhpcy5fZWZmZWN0UGFyYW1zW2FdCiAgICB9CiAgICBHZXRFZmZlY3RQYXJhbWV0ZXIoYSwgYikgewogICAgICAgIGlmICgwID4gYSB8fCBhID49IHRoaXMuX2VmZmVjdFBhcmFtcy5sZW5ndGgpIHJldHVybiBudWxsOwogICAgICAgIGEgPSB0aGlzLl9lZmZlY3RQYXJhbXNbYV07CiAgICAgICAgcmV0dXJuIDAgPiBiIHx8IGIgPj0gYS5sZW5ndGggPyBudWxsIDogYVtiXQogICAgfQogICAgU2V0RWZmZWN0UGFyYW1ldGVyKGEsIGIsIGQpIHsKICAgICAgICBpZiAoMCA+IGEgfHwgYSA+PSB0aGlzLl9lZmZlY3RQYXJhbXMubGVuZ3RoKSByZXR1cm4gITE7CiAgICAgICAgY29uc3QgYyA9IHRoaXMuX2VmZmVjdFBhcmFtc1thXTsKICAgICAgICBpZiAoMCA+IGIgfHwgYiA+PSBjLmxlbmd0aCkgcmV0dXJuICExOwogICAgICAgIGNvbnN0IGUgPSBjW2JdOwogICAgICAgIGlmIChlIGluc3RhbmNlb2YgQzMkanNjb21wJDE2Mi5Db2xvcikgewogICAgICAgICAgICBpZiAoZS5lcXVhbHNJZ25vcmluZ0FscGhhKGQpKSByZXR1cm4gITE7CiAgICAgICAgICAgIGUuY29weVJnYihkKQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmIChlID09PSBkKSByZXR1cm4gITE7CiAgICAgICAgICAgIGNbYl0gPSBkCiAgICAgICAgfQogICAgICAgIGEgPCB0aGlzLl9lZmZlY3RQYXJhbUJ1ZmZlcnMubGVuZ3RoICYmIHRoaXMuX2VmZmVjdFBhcmFtQnVmZmVyc1thXS5TZXRQYXJhbWV0ZXJWYWx1ZShiLCBkKTsKICAgICAgICByZXR1cm4gITAKICAgIH0KICAgIF9VcGRhdGVBbGxFZmZlY3RQYXJhbUJ1ZmZlcnMoKSB7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuX2VmZmVjdFBhcmFtcywKICAgICAgICAgICAgYiA9IHRoaXMuX2VmZmVjdFBhcmFtQnVmZmVyczsKICAgICAgICBmb3IgKGxldCBkID0gMCwgYyA9IE1hdGgubWluKGEubGVuZ3RoLAogICAgICAgICAgICAgICAgYi5sZW5ndGgpOyBkIDwgYzsgKytkKSB7CiAgICAgICAgICAgIGNvbnN0IGUgPSBiW2RdLAogICAgICAgICAgICAgICAgZyA9IGFbZF07CiAgICAgICAgICAgIGZvciAobGV0IGsgPSAwLCBtID0gZy5sZW5ndGg7IGsgPCBtOyArK2spIGUuU2V0UGFyYW1ldGVyVmFsdWUoaywgZ1trXSkKICAgICAgICB9CiAgICB9CiAgICBzdGF0aWMgU2F2ZUZ4UGFyYW1Ub0pzb24oYSkgewogICAgICAgIHJldHVybiBhICYmIGEgaW5zdGFuY2VvZiBDMyRqc2NvbXAkMTYyLkNvbG9yID8gewogICAgICAgICAgICB0OiAiY29sb3IiLAogICAgICAgICAgICB2OiBhLnRvSlNPTigpCiAgICAgICAgfSA6IGEKICAgIH0KICAgIHN0YXRpYyBMb2FkRnhQYXJhbUZyb21Kc29uKGEpIHsKICAgICAgICBpZiAobnVsbCA9PT0gYSkgcmV0dXJuIE5hTjsKICAgICAgICBpZiAoIm9iamVjdCIgPT09IHR5cGVvZiBhKSB7CiAgICAgICAgICAgIGlmICgiY29sb3IiID09PSBhLnQpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGIgPSBDMyRqc2NvbXAkMTYyLk5ldyhDMyRqc2NvbXAkMTYyLkNvbG9yKTsKICAgICAgICAgICAgICAgIGIuc2V0RnJvbUpTT04oYS52KTsKICAgICAgICAgICAgICAgIHJldHVybiBiCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhyb3cgRXJyb3IoImludmFsaWQgZWZmZWN0IHBhcmFtZXRlciB0eXBlIik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBhCiAgICB9CiAgICBzdGF0aWMgU2F2ZUZ4UGFyYW1zVG9Kc29uKGEpIHsKICAgICAgICByZXR1cm4gYS5tYXAoQzMkanNjb21wJDE2Mi5FZmZlY3RMaXN0LlNhdmVGeFBhcmFtVG9Kc29uKQogICAgfQogICAgc3RhdGljIExvYWRGeFBhcmFtc0Zyb21Kc29uKGEpIHsKICAgICAgICByZXR1cm4gYS5tYXAoQzMkanNjb21wJDE2Mi5FZmZlY3RMaXN0LkxvYWRGeFBhcmFtRnJvbUpzb24pCiAgICB9CiAgICBTYXZlVG9Kc29uKCkgewogICAgICAgIHJldHVybiB0aGlzLl9hbGxFZmZlY3RUeXBlcy5tYXAoYSA9PgogICAgICAgICAgICAoewogICAgICAgICAgICAgICAgbmFtZTogYS5HZXROYW1lKCksCiAgICAgICAgICAgICAgICBhY3RpdmU6IGEuSXNBY3RpdmUoKSwKICAgICAgICAgICAgICAgIHBhcmFtczogQzMkanNjb21wJDE2Mi5FZmZlY3RMaXN0LlNhdmVGeFBhcmFtc1RvSnNvbih0aGlzLl9lZmZlY3RQYXJhbXNbYS5HZXRJbmRleCgpXSkKICAgICAgICAgICAgfSkpCiAgICB9CiAgICBMb2FkRnJvbUpzb24oYSkgewogICAgICAgIGZvciAoY29uc3QgYiBvZiBhKQogICAgICAgICAgICBpZiAoYSA9IHRoaXMuR2V0RWZmZWN0VHlwZUJ5TmFtZShiLm5hbWUpKSBhLlNldEFjdGl2ZShiLmFjdGl2ZSksIHRoaXMuX2VmZmVjdFBhcmFtc1thLkdldEluZGV4KCldID0gQzMkanNjb21wJDE2Mi5FZmZlY3RMaXN0LkxvYWRGeFBhcmFtc0Zyb21Kc29uKGIucGFyYW1zKTsKICAgICAgICB0aGlzLlVwZGF0ZUFjdGl2ZUVmZmVjdHMoKTsKICAgICAgICB0aGlzLl9VcGRhdGVBbGxFZmZlY3RQYXJhbUJ1ZmZlcnMoKQogICAgfQp9OwoidXNlIHN0cmljdCI7CmNvbnN0IEMzJGpzY29tcCQxNjMgPSBzZWxmLkMzOwpDMyRqc2NvbXAkMTYzLkVmZmVjdFR5cGUgPSBjbGFzcyBleHRlbmRzIEMzJGpzY29tcCQxNjMuRGVmZW5kZWRCYXNlIHsKICAgIGNvbnN0cnVjdG9yKGEsIGIsIGQpIHsKICAgICAgICBzdXBlcigpOwogICAgICAgIHRoaXMuX2VmZmVjdExpc3QgPSBhOwogICAgICAgIHRoaXMuX2lkID0gYlswXTsKICAgICAgICB0aGlzLl9uYW1lID0gYlsxXTsKICAgICAgICB0aGlzLl9pbmRleCA9IGQ7CiAgICAgICAgdGhpcy5fc2hhZGVyUHJvZ3JhbSA9IG51bGw7CiAgICAgICAgdGhpcy5faXNBY3RpdmUgPSAhMAogICAgfQogICAgUmVsZWFzZSgpIHsKICAgICAgICB0aGlzLl9zaGFkZXJQcm9ncmFtID0gdGhpcy5fZWZmZWN0TGlzdCA9IG51bGwKICAgIH0KICAgIENsb25lKGEpIHsKICAgICAgICBhID0gQzMkanNjb21wJDE2My5OZXcoQzMkanNjb21wJDE2My5FZmZlY3RUeXBlLCBhLCBbdGhpcy5faWQsIHRoaXMuX25hbWVdLCAtMSk7CiAgICAgICAgYS5fc2hhZGVyUHJvZ3JhbSA9IHRoaXMuX3NoYWRlclByb2dyYW07CiAgICAgICAgYS5faXNBY3RpdmUgPSB0aGlzLl9pc0FjdGl2ZTsKICAgICAgICByZXR1cm4gYQogICAgfQogICAgX0luaXRSZW5kZXJlcihhKSB7CiAgICAgICAgYSA9IGEuR2V0U2hhZGVyUHJvZ3JhbUJ5TmFtZSh0aGlzLl9pZCk7CiAgICAgICAgaWYgKCFhKSB0aHJvdyBFcnJvcigiZmFpbGVkIHRvIGZpbmQgc2hhZGVyIHByb2dyYW0gJyIgKwogICAgICAgICAgICB0aGlzLl9pZCArICInIik7CiAgICAgICAgdGhpcy5fc2hhZGVyUHJvZ3JhbSA9IGEKICAgIH0KICAgIEdldEVmZmVjdExpc3QoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2VmZmVjdExpc3QKICAgIH0KICAgIEdldE5hbWUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX25hbWUKICAgIH0KICAgIF9TZXRJbmRleChhKSB7CiAgICAgICAgdGhpcy5faW5kZXggPSBhCiAgICB9CiAgICBHZXRJbmRleCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5faW5kZXgKICAgIH0KICAgIEdldE93bmVyKCkgewogICAgICAgIHJldHVybiB0aGlzLl9lZmZlY3RMaXN0LkdldE93bmVyKCkKICAgIH0KICAgIEdldFJ1bnRpbWUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2VmZmVjdExpc3QuR2V0UnVudGltZSgpCiAgICB9CiAgICBTZXRBY3RpdmUoYSkgewogICAgICAgIHRoaXMuX2lzQWN0aXZlID0gISFhCiAgICB9CiAgICBJc0FjdGl2ZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5faXNBY3RpdmUKICAgIH0KICAgIEdldFNoYWRlclByb2dyYW0oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3NoYWRlclByb2dyYW0KICAgIH0KICAgIEdldERlZmF1bHRQYXJhbWV0ZXJWYWx1ZXMoKSB7CiAgICAgICAgY29uc3QgYSA9IFtdOwogICAgICAgIGZvciAobGV0IGIgPSAwLCBkID0gdGhpcy5fc2hhZGVyUHJvZ3JhbS5HZXRQYXJhbWV0ZXJDb3VudCgpOyBiIDwgZDsgKytiKSB7CiAgICAgICAgICAgIGNvbnN0IGMgPSB0aGlzLl9zaGFkZXJQcm9ncmFtLkdldFBhcmFtZXRlclR5cGUoYik7CiAgICAgICAgICAgIGlmICgiZmxvYXQiID09PSBjIHx8ICJwZXJjZW50IiA9PT0gYykgYS5wdXNoKDApOwogICAgICAgICAgICBlbHNlIGlmICgiY29sb3IiID09PSBjKSBhLnB1c2goQzMkanNjb21wJDE2My5OZXcoQzMkanNjb21wJDE2My5Db2xvciwgMSwgMSwgMSwgMSkpOwogICAgICAgICAgICBlbHNlIHRocm93IG5ldyBUeXBlRXJyb3IoInVua25vd24gZWZmZWN0IHBhcmFtZXRlciB0eXBlIik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBhCiAgICB9Cn07CiJ1c2Ugc3RyaWN0IjsKY29uc3QgQzMkanNjb21wJDE2NCA9IHNlbGYuQzM7CkMzJGpzY29tcCQxNjQuSW5zdGFuY2VFZmZlY3RMaXN0ID0gY2xhc3MgZXh0ZW5kcyBDMyRqc2NvbXAkMTY0LkRlZmVuZGVkQmFzZSB7CiAgICBjb25zdHJ1Y3RvcihhLCBiKSB7CiAgICAgICAgc3VwZXIoKTsKICAgICAgICB0aGlzLl9pbnN0ID0gYTsKICAgICAgICB0aGlzLl93aSA9IGI7CiAgICAgICAgdGhpcy5fZWZmZWN0TGlzdCA9IGEuR2V0T2JqZWN0Q2xhc3MoKS5HZXRFZmZlY3RMaXN0KCk7CiAgICAgICAgdGhpcy5fd2FzRGVmYXVsdENvbG9yID0gdGhpcy5fbmVlZHNSZWJ1aWxkU3RlcHMgPSAhMDsKICAgICAgICB0aGlzLl93YXNUZXhSb3RhdGVkID0gdGhpcy5fd2FzUm90YXRlZE9yTmVnYXRpdmVTaXplID0gdGhpcy5fd2FzM0QgPSAhMTsKICAgICAgICB0aGlzLl9lZmZlY3RDaGFpbiA9IEMzJGpzY29tcCQxNjQuTmV3KEMzJGpzY29tcCQxNjQuR2Z4LkVmZmVjdENoYWluLCBhLkdldFJ1bnRpbWUoKS5HZXRDYW52YXNNYW5hZ2VyKCkuR2V0RWZmZWN0Q2hhaW5NYW5hZ2VyKCksIHsKICAgICAgICAgICAgZHJhd0NvbnRlbnQ6IChkLCBjKSA9PiB7CiAgICAgICAgICAgICAgICBjID0gYy5HZXRDb250ZW50T2JqZWN0KCk7CiAgICAgICAgICAgICAgICBjb25zdCBlID0gYy5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgICAgIGQuU2V0Q29sb3IoZS5HZXRQcmVtdWx0aXBsaWVkQ29sb3IoKSk7CiAgICAgICAgICAgICAgICBkLlNldEN1cnJlbnRaKGUuR2V0VG90YWxaRWxldmF0aW9uKCkpOwogICAgICAgICAgICAgICAgYy5EcmF3KGQpOwogICAgICAgICAgICAgICAgZC5TZXRDdXJyZW50WigwKQogICAgICAgICAgICB9LAogICAgICAgICAgICBnZXRTb3VyY2VUZXh0dXJlSW5mbzogZCA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBjID0gZC5HZXRDdXJyZW50VGV4UmVjdCgpLAogICAgICAgICAgICAgICAgICAgIFtlLCBnXSA9IGQuR2V0Q3VycmVudFN1cmZhY2VTaXplKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgIHNyY1RleFJlY3Q6IGMsCiAgICAgICAgICAgICAgICAgICAgc3JjV2lkdGg6IGUsCiAgICAgICAgICAgICAgICAgICAgc3JjSGVpZ2h0OiBnCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGdldFNoYWRlclBhcmFtZXRlcnM6IGQgPT4gdGhpcy5fR2V0RWZmZWN0Q2hhaW5TaGFkZXJQYXJhbWV0ZXJzRm9ySW5kZXgoZCkKICAgICAgICB9KTsKICAgICAgICB0aGlzLl9hY3RpdmVFZmZlY3RGbGFncyA9IFtdOwogICAgICAgIHRoaXMuX2FjdGl2ZUVmZmVjdFR5cGVzID0gW107CiAgICAgICAgdGhpcy5fcHJlc2VydmVzT3BhcXVlbmVzcyA9ICEwOwogICAgICAgIHRoaXMuX2VmZmVjdFBhcmFtcyA9IFtdOwogICAgICAgIHRoaXMuX2VmZmVjdFBhcmFtQnVmZmVycyA9IFtdOwogICAgICAgIGEuR2V0UnVudGltZSgpLkdldFJlbmRlcmVyKCkuSXNXZWJHUFUoKSAmJiAodGhpcy5fZWZmZWN0UGFyYW1CdWZmZXJzID0gdGhpcy5fZWZmZWN0TGlzdC5HZXRBbGxFZmZlY3RUeXBlcygpLm1hcChkID0+IHsKICAgICAgICAgICAgZCA9IGQuR2V0U2hhZGVyUHJvZ3JhbSgpOwogICAgICAgICAgICByZXR1cm4gMCA8IGQuR2V0Q3VzdG9tUGFyYW1ldGVyc0J5dGVTaXplKCkgPyBDMyRqc2NvbXAkMTY0Lk5ldyhDMyRqc2NvbXAkMTY0LkdmeC5XZWJHUFVFZmZlY3RDdXN0b21QYXJhbXNCdWZmZXIsIGQpIDogbnVsbAogICAgICAgIH0pKTsKICAgICAgICBmb3IgKGxldCBkID0gMCwgYyA9IHRoaXMuX2VmZmVjdExpc3QuR2V0QWxsRWZmZWN0VHlwZXMoKS5sZW5ndGg7IGQgPCBjOyArK2QpIHRoaXMuX2FjdGl2ZUVmZmVjdEZsYWdzLnB1c2goITApOwogICAgICAgIHRoaXMuVXBkYXRlQWN0aXZlRWZmZWN0cygpCiAgICB9CiAgICBSZWxlYXNlKCkgewogICAgICAgIGZvciAoY29uc3QgYSBvZiB0aGlzLl9lZmZlY3RQYXJhbUJ1ZmZlcnMpIGEuUmVsZWFzZSgpOwogICAgICAgIEMzJGpzY29tcCQxNjQuY2xlYXJBcnJheSh0aGlzLl9lZmZlY3RQYXJhbUJ1ZmZlcnMpOwogICAgICAgIHRoaXMuX2VmZmVjdENoYWluLlJlbGVhc2UoKTsKICAgICAgICB0aGlzLl9lZmZlY3RDaGFpbiA9IG51bGw7CiAgICAgICAgQzMkanNjb21wJDE2NC5jbGVhckFycmF5KHRoaXMuX2FjdGl2ZUVmZmVjdEZsYWdzKTsKICAgICAgICBDMyRqc2NvbXAkMTY0LmNsZWFyQXJyYXkodGhpcy5fYWN0aXZlRWZmZWN0VHlwZXMpOwogICAgICAgIEMzJGpzY29tcCQxNjQuY2xlYXJBcnJheSh0aGlzLl9lZmZlY3RQYXJhbXMpOwogICAgICAgIHRoaXMuX2VmZmVjdExpc3QgPSB0aGlzLl9pbnN0ID0gbnVsbAogICAgfQogICAgX0xvYWRFZmZlY3RQYXJhbWV0ZXJzKGEpIHsKICAgICAgICBsZXQgYiA9IDA7CiAgICAgICAgZm9yIChjb25zdCBkIG9mIGEpIHRoaXMuX2VmZmVjdFBhcmFtcy5wdXNoKHRoaXMuX0xvYWRTaW5nbGVFZmZlY3RQYXJhbWV0ZXJzKGIsIGQpKSwgKytiOwogICAgICAgIHRoaXMuX1VwZGF0ZUFsbEVmZmVjdFBhcmFtQnVmZmVycygpOwogICAgICAgIHRoaXMuVXBkYXRlQWN0aXZlRWZmZWN0cygpCiAgICB9CiAgICBfTG9hZFNpbmdsZUVmZmVjdFBhcmFtZXRlcnMoYSwgYikgewogICAgICAgIHRoaXMuX2FjdGl2ZUVmZmVjdEZsYWdzW2FdID0gYlswXTsKICAgICAgICBhID0gYi5zbGljZSgxKTsKICAgICAgICBmb3IgKGxldCBkID0gMCwgYyA9IGEubGVuZ3RoOyBkIDwgYzsgKytkKQogICAgICAgICAgICBpZiAoYiA9IGFbZF0sIEFycmF5LmlzQXJyYXkoYikpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGUgPSBDMyRqc2NvbXAkMTY0Lk5ldyhDMyRqc2NvbXAkMTY0LkNvbG9yKTsKICAgICAgICAgICAgICAgIGUuc2V0RnJvbUpTT04oYik7CiAgICAgICAgICAgICAgICBhW2RdID0gZQogICAgICAgICAgICB9CiAgICAgICAgcmV0dXJuIGEKICAgIH0KICAgIExvYWREZWZhdWx0RWZmZWN0UGFyYW1ldGVycygpIHsKICAgICAgICBmb3IgKGNvbnN0IGEgb2YgdGhpcy5fZWZmZWN0TGlzdC5HZXRBbGxFZmZlY3RUeXBlcygpKSB0aGlzLl9lZmZlY3RQYXJhbXMucHVzaChhLkdldERlZmF1bHRQYXJhbWV0ZXJWYWx1ZXMoKSk7CiAgICAgICAgdGhpcy5fVXBkYXRlQWxsRWZmZWN0UGFyYW1CdWZmZXJzKCkKICAgIH0KICAgIEdldE93bmVyKCkgewogICAgICAgIHJldHVybiB0aGlzLl9vd25lcgogICAgfQogICAgR2V0RWZmZWN0TGlzdCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZWZmZWN0TGlzdAogICAgfQogICAgR2V0RWZmZWN0Q2hhaW4oKSB7CiAgICAgICAgdGhpcy5fTWF5YmVSZWJ1aWxkRWZmZWN0Q2hhaW5TdGVwcygpOwogICAgICAgIHJldHVybiB0aGlzLl9lZmZlY3RDaGFpbgogICAgfQogICAgR2V0UnVudGltZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5faW5zdC5HZXRSdW50aW1lKCkKICAgIH0KICAgIFVwZGF0ZUFjdGl2ZUVmZmVjdHMoKSB7CiAgICAgICAgQzMkanNjb21wJDE2NC5jbGVhckFycmF5KHRoaXMuX2FjdGl2ZUVmZmVjdFR5cGVzKTsKICAgICAgICBjb25zdCBhID0gdGhpcy5fd2ksCiAgICAgICAgICAgIGIgPSB0aGlzLl9lZmZlY3RMaXN0LkdldEFsbEVmZmVjdFR5cGVzKCksCiAgICAgICAgICAgIGQgPSB0aGlzLl9hY3RpdmVFZmZlY3RUeXBlcywKICAgICAgICAgICAgYyA9IHRoaXMuX2FjdGl2ZUVmZmVjdEZsYWdzOwogICAgICAgIGxldCBlID0gITA7CiAgICAgICAgZm9yIChsZXQgZyA9IDAsIGsgPSBiLmxlbmd0aDsgZyA8IGs7ICsrZykKICAgICAgICAgICAgaWYgKGNbZ10pIHsKICAgICAgICAgICAgICAgIGNvbnN0IG0gPSBiW2ddOwogICAgICAgICAgICAgICAgZC5wdXNoKG0pOwogICAgICAgICAgICAgICAgbS5HZXRTaGFkZXJQcm9ncmFtKCkuUHJlc2VydmVzT3BhcXVlbmVzcygpIHx8CiAgICAgICAgICAgICAgICAgICAgKGUgPSAhMSkKICAgICAgICAgICAgfQogICAgICAgIHRoaXMuX3ByZXNlcnZlc09wYXF1ZW5lc3MgPSBlOwogICAgICAgIGEuX1NldEhhc0FueUFjdGl2ZUVmZmVjdCghIWQubGVuZ3RoKTsKICAgICAgICB0aGlzLl9uZWVkc1JlYnVpbGRTdGVwcyA9ICEwCiAgICB9CiAgICBfTWF5YmVSZWJ1aWxkRWZmZWN0Q2hhaW5TdGVwcygpIHsKICAgICAgICBjb25zdCBhID0gdGhpcy5faW5zdDsKICAgICAgICB2YXIgYiA9IHRoaXMuX3dpOwogICAgICAgIGNvbnN0IGQgPSBiLkhhc0RlZmF1bHRDb2xvcigpLAogICAgICAgICAgICBjID0gMCA8IGIuR2V0RGVwdGgoKTsKICAgICAgICBiID0gMCAhPT0gYi5HZXRBbmdsZSgpIHx8IDAgPiBiLkdldFdpZHRoKCkgfHwgMCA+IGIuR2V0SGVpZ2h0KCk7CiAgICAgICAgY29uc3QgZSA9IGEuSXNDdXJyZW50VGV4Um90YXRlZCgpOwogICAgICAgIGlmICh0aGlzLl9uZWVkc1JlYnVpbGRTdGVwcyB8fCBkICE9PSB0aGlzLl93YXNEZWZhdWx0Q29sb3IgfHwgYyAhPT0gdGhpcy5fd2FzM0QgfHwgYiAhPT0gdGhpcy5fd2FzUm90YXRlZE9yTmVnYXRpdmVTaXplIHx8IGUgIT09IHRoaXMuX3dhc1RleFJvdGF0ZWQpIHRoaXMuX2VmZmVjdENoYWluLkJ1aWxkU3RlcHModGhpcy5fYWN0aXZlRWZmZWN0VHlwZXMubWFwKGcgPT4gZy5HZXRTaGFkZXJQcm9ncmFtKCkpLCB7CiAgICAgICAgICAgIGluZGV4TWFwOiB0aGlzLl9hY3RpdmVFZmZlY3RUeXBlcy5tYXAoZyA9PiBnLkdldEluZGV4KCkpLAogICAgICAgICAgICBmb3JjZVByZURyYXc6ICFkIHx8IGEuTXVzdFByZURyYXcoKSwKICAgICAgICAgICAgaXMzRDogYywKICAgICAgICAgICAgaXNTb3VyY2VUZXh0dXJlUm90YXRlZDogZSwKICAgICAgICAgICAgaXNSb3RhdGVkT3JOZWdhdGl2ZVNpemVJbnN0YW5jZTogYgogICAgICAgIH0pLCB0aGlzLl9uZWVkc1JlYnVpbGRTdGVwcyA9ICExLCB0aGlzLl93YXNEZWZhdWx0Q29sb3IgPSBkLCB0aGlzLl93YXMzRCA9IGMsIHRoaXMuX3dhc1JvdGF0ZWRPck5lZ2F0aXZlU2l6ZSA9IGIsIHRoaXMuX3dhc1RleFJvdGF0ZWQgPSBlCiAgICB9CiAgICBHZXRBY3RpdmVFZmZlY3RUeXBlcygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fYWN0aXZlRWZmZWN0VHlwZXMKICAgIH0KICAgIEdldEVmZmVjdFBhcmFtZXRlcnNGb3JJbmRleChhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2VmZmVjdFBhcmFtc1thXQogICAgfQogICAgX0dldEVmZmVjdENoYWluU2hhZGVyUGFyYW1ldGVyc0ZvckluZGV4KGEpIHsKICAgICAgICByZXR1cm4gYSA8IHRoaXMuX2VmZmVjdFBhcmFtQnVmZmVycy5sZW5ndGggPyB0aGlzLl9lZmZlY3RQYXJhbUJ1ZmZlcnNbYV0gOgogICAgICAgICAgICB0aGlzLl9lZmZlY3RQYXJhbXNbYV0KICAgIH0KICAgIEdldEVmZmVjdFBhcmFtZXRlcihhLCBiKSB7CiAgICAgICAgaWYgKDAgPiBhIHx8IGEgPj0gdGhpcy5fZWZmZWN0UGFyYW1zLmxlbmd0aCkgcmV0dXJuIG51bGw7CiAgICAgICAgYSA9IHRoaXMuX2VmZmVjdFBhcmFtc1thXTsKICAgICAgICByZXR1cm4gMCA+IGIgfHwgYiA+PSBhLmxlbmd0aCA/IG51bGwgOiBhW2JdCiAgICB9CiAgICBTZXRFZmZlY3RQYXJhbWV0ZXIoYSwgYiwgZCkgewogICAgICAgIGlmICgwID4gYSB8fCBhID49IHRoaXMuX2VmZmVjdFBhcmFtcy5sZW5ndGgpIHJldHVybiAhMTsKICAgICAgICBjb25zdCBjID0gdGhpcy5fZWZmZWN0UGFyYW1zW2FdOwogICAgICAgIGlmICgwID4gYiB8fCBiID49IGMubGVuZ3RoKSByZXR1cm4gITE7CiAgICAgICAgY29uc3QgZSA9IGNbYl07CiAgICAgICAgaWYgKGUgaW5zdGFuY2VvZiBDMyRqc2NvbXAkMTY0LkNvbG9yKSB7CiAgICAgICAgICAgIGlmIChlLmVxdWFsc0lnbm9yaW5nQWxwaGEoZCkpIHJldHVybiAhMTsKICAgICAgICAgICAgZS5jb3B5UmdiKGQpCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKGUgPT09IGQpIHJldHVybiAhMTsKICAgICAgICAgICAgY1tiXSA9IGQKICAgICAgICB9CiAgICAgICAgYSA8IHRoaXMuX2VmZmVjdFBhcmFtQnVmZmVycy5sZW5ndGggJiYgdGhpcy5fZWZmZWN0UGFyYW1CdWZmZXJzW2FdLlNldFBhcmFtZXRlclZhbHVlKGIsIGQpOwogICAgICAgIHJldHVybiAhMAogICAgfQogICAgX1VwZGF0ZUFsbEVmZmVjdFBhcmFtQnVmZmVycygpIHsKICAgICAgICBjb25zdCBhID0KICAgICAgICAgICAgdGhpcy5fZWZmZWN0UGFyYW1zLAogICAgICAgICAgICBiID0gdGhpcy5fZWZmZWN0UGFyYW1CdWZmZXJzOwogICAgICAgIGZvciAobGV0IGQgPSAwLCBjID0gYi5sZW5ndGg7IGQgPCBjOyArK2QpIHsKICAgICAgICAgICAgY29uc3QgZSA9IGJbZF0sCiAgICAgICAgICAgICAgICBnID0gYVtkXTsKICAgICAgICAgICAgZm9yIChsZXQgayA9IDAsIG0gPSBnLmxlbmd0aDsgayA8IG07ICsraykgZS5TZXRQYXJhbWV0ZXJWYWx1ZShrLCBnW2tdKQogICAgICAgIH0KICAgIH0KICAgIFByZXNlcnZlc09wYXF1ZW5lc3MoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3ByZXNlcnZlc09wYXF1ZW5lc3MKICAgIH0KICAgIEhhc0FueUFjdGl2ZUJhY2tncm91bmRCbGVuZGluZ0VmZmVjdCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fYWN0aXZlRWZmZWN0VHlwZXMuc29tZShhID0+IGEuR2V0U2hhZGVyUHJvZ3JhbSgpLkJsZW5kc0JhY2tncm91bmQoKSkKICAgIH0KICAgIElzRWZmZWN0SW5kZXhBY3RpdmUoYSkgewogICAgICAgIHJldHVybiB0aGlzLl9hY3RpdmVFZmZlY3RGbGFnc1thXQogICAgfQogICAgU2V0RWZmZWN0SW5kZXhBY3RpdmUoYSwgYikgewogICAgICAgIHRoaXMuX2FjdGl2ZUVmZmVjdEZsYWdzW2FdID0gISFiCiAgICB9CiAgICBHZXRBbGxFZmZlY3RUeXBlcygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZWZmZWN0TGlzdC5HZXRBbGxFZmZlY3RUeXBlcygpCiAgICB9CiAgICBfU2F2ZVRvSnNvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZWZmZWN0TGlzdC5HZXRBbGxFZmZlY3RUeXBlcygpLm1hcChhID0+CiAgICAgICAgICAgICh7CiAgICAgICAgICAgICAgICBuYW1lOiBhLkdldE5hbWUoKSwKICAgICAgICAgICAgICAgIGFjdGl2ZTogdGhpcy5fYWN0aXZlRWZmZWN0RmxhZ3NbYS5HZXRJbmRleCgpXSwKICAgICAgICAgICAgICAgIHBhcmFtczogQzMkanNjb21wJDE2NC5FZmZlY3RMaXN0LlNhdmVGeFBhcmFtc1RvSnNvbih0aGlzLl9lZmZlY3RQYXJhbXNbYS5HZXRJbmRleCgpXSkKICAgICAgICAgICAgfSkpCiAgICB9CiAgICBfTG9hZEZyb21Kc29uKGEpIHsKICAgICAgICBmb3IgKGNvbnN0IGIgb2YgYSkKICAgICAgICAgICAgaWYgKGEgPSB0aGlzLl9lZmZlY3RMaXN0LkdldEVmZmVjdFR5cGVCeU5hbWUoYi5uYW1lKSkgdGhpcy5fYWN0aXZlRWZmZWN0RmxhZ3NbYS5HZXRJbmRleCgpXSA9IGIuYWN0aXZlLCB0aGlzLl9lZmZlY3RQYXJhbXNbYS5HZXRJbmRleCgpXSA9IEMzJGpzY29tcCQxNjQuRWZmZWN0TGlzdC5Mb2FkRnhQYXJhbXNGcm9tSnNvbihiLnBhcmFtcyk7CiAgICAgICAgdGhpcy5VcGRhdGVBY3RpdmVFZmZlY3RzKCk7CiAgICAgICAgdGhpcy5fVXBkYXRlQWxsRWZmZWN0UGFyYW1CdWZmZXJzKCkKICAgIH0KfTsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkMTY1ID0gc2VsZi5DMywKICAgIHRlbXBDYW5kaWRhdGVzID0gW10sCiAgICB0aWxlQ29sbFJlY3RDYW5kaWRhdGVzID0gW10sCiAgICB0ZW1wSnVtcHRocnVSZXQgPSBbXSwKICAgIHRlbXBQb2x5QSA9IEMzJGpzY29tcCQxNjUuTmV3KEMzJGpzY29tcCQxNjUuQ29sbGlzaW9uUG9seSksCiAgICB0ZW1wUG9seUIgPSBDMyRqc2NvbXAkMTY1Lk5ldyhDMyRqc2NvbXAkMTY1LkNvbGxpc2lvblBvbHkpLAogICAgdGVtcFF1YWQkanNjb21wJDQgPSBDMyRqc2NvbXAkMTY1Lk5ldyhDMyRqc2NvbXAkMTY1LlF1YWQpLAogICAgdGVtcFJlY3QkanNjb21wJDcgPSBDMyRqc2NvbXAkMTY1Lk5ldyhDMyRqc2NvbXAkMTY1LlJlY3QpLAogICAgdGVtcFJlY3QyJGpzY29tcCQxID0gQzMkanNjb21wJDE2NS5OZXcoQzMkanNjb21wJDE2NS5SZWN0KTsKbGV0IHRlbXBQb2x5QyA9IG51bGwsCiAgICB0ZW1wUmVjdDMkanNjb21wJDEgPSBudWxsLAogICAgdGVtcFF1YWRCID0gbnVsbDsKQzMkanNjb21wJDE2NS5Db2xsaXNpb25FbmdpbmUgPSBjbGFzcyBleHRlbmRzIEMzJGpzY29tcCQxNjUuRGVmZW5kZWRCYXNlIHsKICAgIGNvbnN0cnVjdG9yKGEpIHsKICAgICAgICBzdXBlcigpOwogICAgICAgIHRoaXMuX3J1bnRpbWUgPSBhOwogICAgICAgIHRoaXMuX3JlZ2lzdGVyZWRDb2xsaXNpb25zID0gW107CiAgICAgICAgdGhpcy5fcG9seUNoZWNrU2VjID0gdGhpcy5fcG9seUNoZWNrQ291bnQgPSB0aGlzLl9jb2xsaXNpb25DaGVja1NlYyA9IHRoaXMuX2NvbGxpc2lvbkNoZWNrQ291bnQgPSAwCiAgICB9CiAgICBSZWxlYXNlKCkgewogICAgICAgIHRoaXMuX3J1bnRpbWUgPSBudWxsCiAgICB9CiAgICBfVXBkYXRlMXNTdGF0cygpIHsKICAgICAgICB0aGlzLl9jb2xsaXNpb25DaGVja1NlYyA9IHRoaXMuX2NvbGxpc2lvbkNoZWNrQ291bnQ7CiAgICAgICAgdGhpcy5fY29sbGlzaW9uQ2hlY2tDb3VudCA9IDA7CiAgICAgICAgdGhpcy5fcG9seUNoZWNrU2VjID0gdGhpcy5fcG9seUNoZWNrQ291bnQ7CiAgICAgICAgdGhpcy5fcG9seUNoZWNrQ291bnQgPSAwCiAgICB9CiAgICBHZXQxc2VjQ29sbGlzaW9uQ2hlY2tzKCkgewogICAgICAgIHJldHVybiB0aGlzLl9jb2xsaXNpb25DaGVja1NlYwogICAgfQogICAgR2V0MXNlY1BvbHlDaGVja3MoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3BvbHlDaGVja1NlYwogICAgfQogICAgUmVnaXN0ZXJDb2xsaXNpb24oYSwKICAgICAgICBiKSB7CiAgICAgICAgY29uc3QgZCA9IGEuR2V0V29ybGRJbmZvKCksCiAgICAgICAgICAgIGMgPSBiLkdldFdvcmxkSW5mbygpOwogICAgICAgIGQgJiYgYyAmJiBkLklzQ29sbGlzaW9uRW5hYmxlZCgpICYmIGMuSXNDb2xsaXNpb25FbmFibGVkKCkgJiYgdGhpcy5fcmVnaXN0ZXJlZENvbGxpc2lvbnMucHVzaChbYSwgYl0pCiAgICB9CiAgICBBZGRSZWdpc3RlcmVkQ29sbGlzaW9uQ2FuZGlkYXRlcyhhLCBiLCBkKSB7CiAgICAgICAgZm9yIChjb25zdCBbYywgZV0gb2YgdGhpcy5fcmVnaXN0ZXJlZENvbGxpc2lvbnMpIHsKICAgICAgICAgICAgbGV0IGc7CiAgICAgICAgICAgIGlmIChhID09PSBjKSBnID0gZTsKICAgICAgICAgICAgZWxzZSBpZiAoYSA9PT0gZSkgZyA9IGM7CiAgICAgICAgICAgIGVsc2UgY29udGludWU7CiAgICAgICAgICAgIGcuQmVsb25nc1RvT2JqZWN0Q2xhc3MoYikgJiYgKGQuaW5jbHVkZXMoZykgfHwgZC5wdXNoKGcpKQogICAgICAgIH0KICAgIH0KICAgIENoZWNrUmVnaXN0ZXJlZENvbGxpc2lvbihhLCBiKSB7CiAgICAgICAgaWYgKCF0aGlzLl9yZWdpc3RlcmVkQ29sbGlzaW9ucy5sZW5ndGgpIHJldHVybiAhMTsKICAgICAgICBmb3IgKGNvbnN0IFtkLCBjXSBvZiB0aGlzLl9yZWdpc3RlcmVkQ29sbGlzaW9ucykKICAgICAgICAgICAgaWYgKGEgPT09IGQgJiYgYiA9PT0gYyB8fCBhID09PSBjICYmIGIgPT09IGQpIHJldHVybiAhMDsKICAgICAgICByZXR1cm4gITEKICAgIH0KICAgIENsZWFyUmVnaXN0ZXJlZENvbGxpc2lvbnMoKSB7CiAgICAgICAgQzMkanNjb21wJDE2NS5jbGVhckFycmF5KHRoaXMuX3JlZ2lzdGVyZWRDb2xsaXNpb25zKQogICAgfQogICAgVGVzdE92ZXJsYXAoYSwKICAgICAgICBiKSB7CiAgICAgICAgaWYgKCFhIHx8ICFiIHx8IGEgPT09IGIpIHJldHVybiAhMTsKICAgICAgICBhID0gYS5HZXRXb3JsZEluZm8oKTsKICAgICAgICBiID0gYi5HZXRXb3JsZEluZm8oKTsKICAgICAgICBpZiAoIWEuSXNDb2xsaXNpb25FbmFibGVkKCkgfHwgIWIuSXNDb2xsaXNpb25FbmFibGVkKCkpIHJldHVybiAhMTsKICAgICAgICB0aGlzLl9jb2xsaXNpb25DaGVja0NvdW50Kys7CiAgICAgICAgY29uc3QgZCA9IGEuR2V0TGF5ZXIoKSwKICAgICAgICAgICAgYyA9IGIuR2V0TGF5ZXIoKTsKICAgICAgICByZXR1cm4gZC5Jc1RyYW5zZm9ybUNvbXBhdGlibGVXaXRoKGMpID8gdGhpcy5fVGVzdE92ZXJsYXBfU2FtZUxheWVycyhhLCBiKSA6IHRoaXMuX1Rlc3RPdmVybGFwX0RpZmZlcmVudExheWVycyhhLCBiKQogICAgfQogICAgX1Rlc3RPdmVybGFwX1NhbWVMYXllcnMoYSwgYikgewogICAgICAgIGlmICghYS5HZXRCb3VuZGluZ0JveCgpLmludGVyc2VjdHNSZWN0KGIuR2V0Qm91bmRpbmdCb3goKSkpIHJldHVybiAhMTsKICAgICAgICB0aGlzLl9wb2x5Q2hlY2tDb3VudCsrOwogICAgICAgIGlmICghYS5HZXRCb3VuZGluZ1F1YWQoKS5pbnRlcnNlY3RzUXVhZChiLkdldEJvdW5kaW5nUXVhZCgpKSB8fCBhLkhhc1RpbGVtYXAoKSAmJiBiLkhhc1RpbGVtYXAoKSkgcmV0dXJuICExOwogICAgICAgIGlmIChhLkhhc1RpbGVtYXAoKSkgcmV0dXJuIHRoaXMuVGVzdFRpbGVtYXBPdmVybGFwKGEsIGIpOwogICAgICAgIGlmIChiLkhhc1RpbGVtYXAoKSkgcmV0dXJuIHRoaXMuVGVzdFRpbGVtYXBPdmVybGFwKGIsIGEpOwogICAgICAgIGlmICghYS5IYXNPd25Db2xsaXNpb25Qb2x5KCkgJiYgIWIuSGFzT3duQ29sbGlzaW9uUG9seSgpKSByZXR1cm4gITA7CiAgICAgICAgY29uc3QgZCA9IGEuR2V0VHJhbnNmb3JtZWRDb2xsaXNpb25Qb2x5KCksCiAgICAgICAgICAgIGMgPSBiLkdldFRyYW5zZm9ybWVkQ29sbGlzaW9uUG9seSgpOwogICAgICAgIHJldHVybiBkLmludGVyc2VjdHNQb2x5KGMsIGIuR2V0WCgpIC0gYS5HZXRYKCksIGIuR2V0WSgpIC0gYS5HZXRZKCkpCiAgICB9CiAgICBfVGVzdE92ZXJsYXBfRGlmZmVyZW50TGF5ZXJzKGEsIGIpIHsKICAgICAgICB2YXIgZCA9IGEuSGFzVGlsZW1hcCgpLAogICAgICAgICAgICBjID0gYi5IYXNUaWxlbWFwKCk7CiAgICAgICAgaWYgKGQgJiYgIWMpIHJldHVybiB0aGlzLlRlc3RUaWxlbWFwT3ZlcmxhcERpZmZlcmVudExheWVycyhhLCBiKTsKICAgICAgICBpZiAoYyAmJiAhZCkgcmV0dXJuIHRoaXMuVGVzdFRpbGVtYXBPdmVybGFwRGlmZmVyZW50TGF5ZXJzKGIsIGEpOwogICAgICAgIGlmIChjIHx8CiAgICAgICAgICAgIGQpIHJldHVybiAhMTsKICAgICAgICBjID0gYS5HZXRMYXllcigpOwogICAgICAgIGQgPSBiLkdldExheWVyKCk7CiAgICAgICAgdGVtcFBvbHlBLmNvcHkoYS5HZXRUcmFuc2Zvcm1lZENvbGxpc2lvblBvbHkoKSk7CiAgICAgICAgdGVtcFBvbHlCLmNvcHkoYi5HZXRUcmFuc2Zvcm1lZENvbGxpc2lvblBvbHkoKSk7CiAgICAgICAgdmFyIGUgPSB0ZW1wUG9seUEucG9pbnRzQXJyKCk7CiAgICAgICAgZm9yIChsZXQgZyA9IDAsIGsgPSBlLmxlbmd0aDsgZyA8IGs7IGcgKz0gMikgewogICAgICAgICAgICBjb25zdCBtID0gZyArIDEsCiAgICAgICAgICAgICAgICBuID0gZVttXSwKICAgICAgICAgICAgICAgIFtxLCB1XSA9IGMuTGF5ZXJUb0NhbnZhc0NzcyhlW2ddICsgYS5HZXRYKCksIG4gKyBhLkdldFkoKSk7CiAgICAgICAgICAgIGVbZ10gPSBxOwogICAgICAgICAgICBlW21dID0gdQogICAgICAgIH0KICAgICAgICBhID0gdGVtcFBvbHlCLnBvaW50c0FycigpOwogICAgICAgIGZvciAobGV0IGcgPSAwLCBrID0gYS5sZW5ndGg7IGcgPCBrOyBnICs9IDIpIHsKICAgICAgICAgICAgYyA9IGcgKyAxOwogICAgICAgICAgICBlID0gYVtjXTsKICAgICAgICAgICAgY29uc3QgW20sIG5dID0gZC5MYXllclRvQ2FudmFzQ3NzKGFbZ10gKyBiLkdldFgoKSwgZSArIGIuR2V0WSgpKTsKICAgICAgICAgICAgYVtnXSA9IG07CiAgICAgICAgICAgIGFbY10gPSBuCiAgICAgICAgfQogICAgICAgIHRlbXBQb2x5QS5zZXRCYm94Q2hhbmdlZCgpOwogICAgICAgIHRlbXBQb2x5Qi5zZXRCYm94Q2hhbmdlZCgpOwogICAgICAgIHRoaXMuX3BvbHlDaGVja0NvdW50Kys7CiAgICAgICAgcmV0dXJuIHRlbXBQb2x5QS5pbnRlcnNlY3RzUG9seSh0ZW1wUG9seUIsCiAgICAgICAgICAgIDAsIDApCiAgICB9CiAgICBUZXN0VGlsZW1hcE92ZXJsYXBEaWZmZXJlbnRMYXllcnMoYSwgYikgewogICAgICAgIHZhciBkID0gYS5HZXRMYXllcigpLAogICAgICAgICAgICBjID0gYi5HZXRMYXllcigpOwogICAgICAgIHRlbXBQb2x5QyB8fCAodGVtcFBvbHlDID0gQzMkanNjb21wJDE2NS5OZXcoQzMkanNjb21wJDE2NS5Db2xsaXNpb25Qb2x5KSk7CiAgICAgICAgdGVtcFJlY3QzJGpzY29tcCQxIHx8ICh0ZW1wUmVjdDMkanNjb21wJDEgPSBDMyRqc2NvbXAkMTY1Lk5ldyhDMyRqc2NvbXAkMTY1LlJlY3QpKTsKICAgICAgICB0ZW1wUXVhZEIgfHwgKHRlbXBRdWFkQiA9IEMzJGpzY29tcCQxNjUuTmV3KEMzJGpzY29tcCQxNjUuUXVhZCkpOwogICAgICAgIHZhciBlID0gYi5HZXRYKCksCiAgICAgICAgICAgIGcgPSBiLkdldFkoKTsKICAgICAgICBjb25zdCBbaywgbV0gPSBjLkxheWVyVG9DYW52YXNDc3MoZSwgZyksIFtuLCBxXSA9IGQuQ2FudmFzQ3NzVG9MYXllcihrLCBtKTsKICAgICAgICBkID0gbiAtIGU7CiAgICAgICAgZyA9IHEgLSBnOwogICAgICAgIHRlbXBSZWN0MyRqc2NvbXAkMS5jb3B5KGIuR2V0Qm91bmRpbmdCb3goKSk7CiAgICAgICAgdGVtcFJlY3QzJGpzY29tcCQxLm9mZnNldChkLCBnKTsKICAgICAgICBpZiAoIWEuR2V0Qm91bmRpbmdCb3goKS5pbnRlcnNlY3RzUmVjdCh0ZW1wUmVjdDMkanNjb21wJDEpKSByZXR1cm4gITE7CiAgICAgICAgdGVtcFF1YWRCLmNvcHkoYi5HZXRCb3VuZGluZ1F1YWQoKSk7CiAgICAgICAgdGVtcFF1YWRCLm9mZnNldChkLCBnKTsKICAgICAgICB0aGlzLl9wb2x5Q2hlY2tDb3VudCsrOwogICAgICAgIGlmICghYS5HZXRCb3VuZGluZ1F1YWQoKS5pbnRlcnNlY3RzUXVhZCh0ZW1wUXVhZEIpKSByZXR1cm4gITE7CiAgICAgICAgdGVtcFBvbHlDLmNvcHkoYi5HZXRUcmFuc2Zvcm1lZENvbGxpc2lvblBvbHkoKSk7CiAgICAgICAgYyA9IHRlbXBQb2x5Qy5wb2ludHNBcnIoKTsKICAgICAgICBmb3IgKGxldCB1ID0gMCwgdyA9IGMubGVuZ3RoOyB1IDwgdzsgdSArPSAyKSBlID0gdSArIDEsIGNbdV0gKz0gZCwgY1tlXSArPSBnOwogICAgICAgIHRlbXBQb2x5Qy5zZXRCYm94Q2hhbmdlZCgpOwogICAgICAgIHJldHVybiB0aGlzLlRlc3RUaWxlbWFwT3ZlcmxhcChhLCBiLCBuLCBxLCB0ZW1wUG9seUMsIHRlbXBSZWN0MyRqc2NvbXAkMSwgdGVtcFF1YWRCKQogICAgfQogICAgVGVzdFRpbGVtYXBPdmVybGFwKGEsIGIsIGQsIGMsIGUsIGcsIGspIHsKICAgICAgICBnID0gdm9pZCAwICE9PSBnID8gZyA6IGIuR2V0Qm91bmRpbmdCb3goKTsKICAgICAgICBjb25zdCBtID0gYS5HZXRYKCksCiAgICAgICAgICAgIG4gPSBhLkdldFkoKTsKICAgICAgICB2YXIgcSA9IGEuR2V0SW5zdGFuY2UoKS5HZXRTZGtJbnN0YW5jZSgpOwogICAgICAgIGQgPSB2b2lkIDAgIT09IGQgPyBkIDogYi5HZXRYKCk7CiAgICAgICAgYyA9IHZvaWQgMCAhPT0gYyA/IGMgOiBiLkdldFkoKTsKICAgICAgICBhID0gYi5IYXNPd25Db2xsaXNpb25Qb2x5KCk7CiAgICAgICAgayA9IHZvaWQgMCAhPT0gayA/IGsgOiBiLkdldEJvdW5kaW5nUXVhZCgpOwogICAgICAgIHEuR2V0Q29sbGlzaW9uUmVjdENhbmRpZGF0ZXMoZywgdGlsZUNvbGxSZWN0Q2FuZGlkYXRlcyk7CiAgICAgICAgZm9yIChsZXQgeiA9IDAsIEMgPSB0aWxlQ29sbFJlY3RDYW5kaWRhdGVzLmxlbmd0aDsgeiA8IEM7ICsreikgewogICAgICAgICAgICB2YXIgdSA9IHRpbGVDb2xsUmVjdENhbmRpZGF0ZXNbel07CiAgICAgICAgICAgIHEgPSB1LkdldFJlY3QoKTsKICAgICAgICAgICAgdGhpcy5fY29sbGlzaW9uQ2hlY2tDb3VudCsrOwogICAgICAgICAgICBpZiAoZy5pbnRlcnNlY3RzUmVjdE9mZnNldChxLCBtLCBuKSAmJiAodGVtcFF1YWQkanNjb21wJDQuc2V0RnJvbVJlY3QocSksIHRlbXBRdWFkJGpzY29tcCQ0Lm9mZnNldChtLCBuKSwgdGVtcFF1YWQkanNjb21wJDQuaW50ZXJzZWN0c1F1YWQoaykpKQogICAgICAgICAgICAgICAgaWYgKGEpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgdyA9IHZvaWQgMCAhPT0gZSA/IGUgOiBiLkdldFRyYW5zZm9ybWVkQ29sbGlzaW9uUG9seSgpOwogICAgICAgICAgICAgICAgICAgIGlmICh1ID0gdS5HZXRQb2x5KCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX3BvbHlDaGVja0NvdW50KyssCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1LmludGVyc2VjdHNQb2x5KHcsIGQgLSAobSArIHEuZ2V0TGVmdCgpKSwgYyAtIChuICsgcS5nZXRUb3AoKSkpKSByZXR1cm4gQzMkanNjb21wJDE2NS5jbGVhckFycmF5KHRpbGVDb2xsUmVjdENhbmRpZGF0ZXMpLCAhMAogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGVtcFBvbHlBLnNldEZyb21RdWFkKHRlbXBRdWFkJGpzY29tcCQ0LCAwLCAwKSwgdGVtcFBvbHlBLmludGVyc2VjdHNQb2x5KHcsIGQsIGMpKSByZXR1cm4gQzMkanNjb21wJDE2NS5jbGVhckFycmF5KHRpbGVDb2xsUmVjdENhbmRpZGF0ZXMpLCAhMAogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh3ID0gdS5HZXRQb2x5KCkpIHsKICAgICAgICAgICAgICAgIGlmICh0ZW1wUG9seUEuc2V0RnJvbVF1YWQoaywgMCwgMCksIHcuaW50ZXJzZWN0c1BvbHkodGVtcFBvbHlBLCAtKG0gKyBxLmdldExlZnQoKSksIC0obiArIHEuZ2V0VG9wKCkpKSkgcmV0dXJuIEMzJGpzY29tcCQxNjUuY2xlYXJBcnJheSh0aWxlQ29sbFJlY3RDYW5kaWRhdGVzKSwgITAKICAgICAgICAgICAgfSBlbHNlIHJldHVybiBDMyRqc2NvbXAkMTY1LmNsZWFyQXJyYXkodGlsZUNvbGxSZWN0Q2FuZGlkYXRlcyksICEwCiAgICAgICAgfQogICAgICAgIEMzJGpzY29tcCQxNjUuY2xlYXJBcnJheSh0aWxlQ29sbFJlY3RDYW5kaWRhdGVzKTsKICAgICAgICByZXR1cm4gITEKICAgIH0KICAgIFRlc3RBbmRTZWxlY3RDYW52YXNQb2ludE92ZXJsYXAoYSwgYiwgZCwgYykgewogICAgICAgIGNvbnN0IGUgPSBhLkdldEN1cnJlbnRTb2woKTsKICAgICAgICB2YXIgZyA9IHRoaXMuX3J1bnRpbWUuR2V0Q3VycmVudEV2ZW50KCk7CiAgICAgICAgaWYgKCFnKSB0aHJvdyBFcnJvcigiY2Fubm90IGNhbGwgb3V0c2lkZSBldmVudCIpOwogICAgICAgIGcgPSBnLklzT3JCbG9jaygpOwogICAgICAgIGNvbnN0IGsgPSBuZXcgTWFwLAogICAgICAgICAgICBtID0geiA9PiB7CiAgICAgICAgICAgICAgICBsZXQgQyA9IGsuZ2V0KHopOwogICAgICAgICAgICAgICAgInVuZGVmaW5lZCIgPT09IHR5cGVvZiBDICYmIChDID0gei5Jc1NlbGZBbmRQYXJlbnRzSW50ZXJhY3RpdmUoKSwgay5zZXQoeiwgQykpOwogICAgICAgICAgICAgICAgcmV0dXJuIEMKICAgICAgICAgICAgfTsKICAgICAgICBpZiAoZS5Jc1NlbGVjdEFsbCgpKSB7CiAgICAgICAgICAgIGMgfHwgKGUuX1NldFNlbGVjdEFsbCghMSksIEMzJGpzY29tcCQxNjUuY2xlYXJBcnJheShlLl9HZXRPd25JbnN0YW5jZXMoKSkpOwogICAgICAgICAgICBmb3IgKHZhciBuIG9mIGEuR2V0SW5zdGFuY2VzKCkpIHsKICAgICAgICAgICAgICAgIHZhciBxID0gbi5HZXRXb3JsZEluZm8oKSwKICAgICAgICAgICAgICAgICAgICB1ID0gcS5HZXRMYXllcigpLAogICAgICAgICAgICAgICAgICAgIHcgPSAhMTsKICAgICAgICAgICAgICAgIGlmIChtKHUpICYmIHEuSXNJblZpZXdwb3J0MigpKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgW3osIENdID0KICAgICAgICAgICAgICAgICAgICB1LkNhbnZhc0Nzc1RvTGF5ZXIoYiwgZCwgcS5HZXRUb3RhbFpFbGV2YXRpb24oKSk7CiAgICAgICAgICAgICAgICAgICAgdyA9IHEuQ29udGFpbnNQb2ludCh6LCBDKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHcpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoYykgcmV0dXJuICExOwogICAgICAgICAgICAgICAgICAgIGUuX1B1c2hJbnN0YW5jZShuKQogICAgICAgICAgICAgICAgfSBlbHNlIGcgJiYgZS5fUHVzaEVsc2VJbnN0YW5jZShuKQogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcSA9ICExOwogICAgICAgICAgICBnID8gdGhpcy5fcnVudGltZS5Jc0N1cnJlbnRDb25kaXRpb25GaXJzdCgpICYmICFlLl9HZXRPd25FbHNlSW5zdGFuY2VzKCkubGVuZ3RoICYmIGUuX0dldE93bkluc3RhbmNlcygpLmxlbmd0aCA/IG4gPSBlLl9HZXRPd25JbnN0YW5jZXMoKSA6IChuID0gZS5fR2V0T3duRWxzZUluc3RhbmNlcygpLCBxID0gITApIDogbiA9IGUuX0dldE93bkluc3RhbmNlcygpOwogICAgICAgICAgICB1ID0gMDsKICAgICAgICAgICAgZm9yIChsZXQgeiA9IDAsIEMgPSBuLmxlbmd0aDsgeiA8IEM7ICsreikgewogICAgICAgICAgICAgICAgdyA9IG5bel07CiAgICAgICAgICAgICAgICBjb25zdCBEID0gdy5HZXRXb3JsZEluZm8oKSwKICAgICAgICAgICAgICAgICAgICBGID0gRC5HZXRMYXllcigpOwogICAgICAgICAgICAgICAgbGV0IEUgPSAhMTsKICAgICAgICAgICAgICAgIGlmIChtKEYpICYmIEQuSXNJblZpZXdwb3J0MigpKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgW0osIEtdID0gRi5DYW52YXNDc3NUb0xheWVyKGIsIGQsIEQuR2V0VG90YWxaRWxldmF0aW9uKCkpOwogICAgICAgICAgICAgICAgICAgIEUgPSBELkNvbnRhaW5zUG9pbnQoSiwgSykKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChFKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGMpIHJldHVybiAhMTsKICAgICAgICAgICAgICAgICAgICBxID8gZS5fUHVzaEluc3RhbmNlKHcpIDogblt1KytdID0gdwogICAgICAgICAgICAgICAgfSBlbHNlIHEgPyBuW3UrK10gPSB3IDogZyAmJiBlLl9QdXNoRWxzZUluc3RhbmNlKHcpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgYyB8fCAobi5sZW5ndGggPSB1KQogICAgICAgIH0KICAgICAgICBhLkFwcGx5U29sVG9Db250YWluZXIoKTsKICAgICAgICBrLmNsZWFyKCk7CiAgICAgICAgcmV0dXJuIGMgPyAhMCA6IGUuSGFzQW55SW5zdGFuY2VzKCkKICAgIH0KICAgIEdldENvbGxpc2lvbkNhbmRpZGF0ZXMoYSwgYiwgZCwgYykgewogICAgICAgIGEgPSBhID8gMSAhPT0gYS5HZXRQYXJhbGxheFgoKSB8fCAxICE9PSBhLkdldFBhcmFsbGF4WSgpIDogITE7CiAgICAgICAgaWYgKGIuSXNGYW1pbHkoKSkKICAgICAgICAgICAgZm9yIChjb25zdCBlIG9mIGIuR2V0RmFtaWx5TWVtYmVycygpKSBhIHx8IGUuSXNBbnlJbnN0YW5jZVBhcmFsbGF4ZWQoKSA/IEMzJGpzY29tcCQxNjUuYXBwZW5kQXJyYXkoYywgZS5HZXRJbnN0YW5jZXMoKSkgOiAoZS5fVXBkYXRlQWxsQ29sbGlzaW9uQ2VsbHMoKSwgZS5fR2V0Q29sbGlzaW9uQ2VsbEdyaWQoKS5RdWVyeVJhbmdlKGQsIGMpKTsKICAgICAgICBlbHNlIGEgfHwgYi5Jc0FueUluc3RhbmNlUGFyYWxsYXhlZCgpID8KICAgICAgICAgICAgQzMkanNjb21wJDE2NS5hcHBlbmRBcnJheShjLCBiLkdldEluc3RhbmNlcygpKSA6IChiLl9VcGRhdGVBbGxDb2xsaXNpb25DZWxscygpLCBiLl9HZXRDb2xsaXNpb25DZWxsR3JpZCgpLlF1ZXJ5UmFuZ2UoZCwgYykpCiAgICB9CiAgICBHZXRPYmplY3RDbGFzc2VzQ29sbGlzaW9uQ2FuZGlkYXRlcyhhLCBiLCBkLCBjKSB7CiAgICAgICAgZm9yIChjb25zdCBlIG9mIGIpIHRoaXMuR2V0Q29sbGlzaW9uQ2FuZGlkYXRlcyhhLCBlLCBkLCBjKQogICAgfQogICAgR2V0U29saWRDb2xsaXNpb25DYW5kaWRhdGVzKGEsIGIsIGQpIHsKICAgICAgICBjb25zdCBjID0gdGhpcy5fcnVudGltZS5HZXRTb2xpZEJlaGF2aW9yKCk7CiAgICAgICAgYyAmJiB0aGlzLkdldE9iamVjdENsYXNzZXNDb2xsaXNpb25DYW5kaWRhdGVzKGEsIGMuR2V0T2JqZWN0Q2xhc3NlcygpLCBiLCBkKQogICAgfQogICAgR2V0SnVtcHRocnVDb2xsaXNpb25DYW5kaWRhdGVzKGEsIGIsIGQpIHsKICAgICAgICBjb25zdCBjID0gdGhpcy5fcnVudGltZS5HZXRKdW1wdGhydUJlaGF2aW9yKCk7CiAgICAgICAgYyAmJiB0aGlzLkdldE9iamVjdENsYXNzZXNDb2xsaXNpb25DYW5kaWRhdGVzKGEsIGMuR2V0T2JqZWN0Q2xhc3NlcygpLAogICAgICAgICAgICBiLCBkKQogICAgfQogICAgSXNTb2xpZENvbGxpc2lvbkFsbG93ZWQoYSwgYikgewogICAgICAgIHJldHVybiBhLl9Jc1NvbGlkRW5hYmxlZCgpICYmICghYiB8fCBiLkdldFdvcmxkSW5mbygpLklzU29saWRDb2xsaXNpb25BbGxvd2VkKGEuR2V0U2F2ZWREYXRhTWFwKCkuZ2V0KCJzb2xpZFRhZ3MiKSkpCiAgICB9CiAgICBUZXN0T3ZlcmxhcFNvbGlkKGEpIHsKICAgICAgICBjb25zdCBiID0gYS5HZXRXb3JsZEluZm8oKTsKICAgICAgICB0aGlzLkdldFNvbGlkQ29sbGlzaW9uQ2FuZGlkYXRlcyhiLkdldExheWVyKCksIGIuR2V0Qm91bmRpbmdCb3goKSwgdGVtcENhbmRpZGF0ZXMpOwogICAgICAgIGZvciAoY29uc3QgZCBvZiB0ZW1wQ2FuZGlkYXRlcykKICAgICAgICAgICAgaWYgKHRoaXMuSXNTb2xpZENvbGxpc2lvbkFsbG93ZWQoZCwgYSkgJiYgdGhpcy5UZXN0T3ZlcmxhcChhLCBkKSkgcmV0dXJuIEMzJGpzY29tcCQxNjUuY2xlYXJBcnJheSh0ZW1wQ2FuZGlkYXRlcyksIGQ7CiAgICAgICAgQzMkanNjb21wJDE2NS5jbGVhckFycmF5KHRlbXBDYW5kaWRhdGVzKTsKICAgICAgICByZXR1cm4gbnVsbAogICAgfQogICAgVGVzdFJlY3RPdmVybGFwU29saWQoYSwgYikgewogICAgICAgIHRoaXMuR2V0U29saWRDb2xsaXNpb25DYW5kaWRhdGVzKG51bGwsCiAgICAgICAgICAgIGEsIHRlbXBDYW5kaWRhdGVzKTsKICAgICAgICBmb3IgKGNvbnN0IGQgb2YgdGVtcENhbmRpZGF0ZXMpCiAgICAgICAgICAgIGlmICh0aGlzLklzU29saWRDb2xsaXNpb25BbGxvd2VkKGQsIGIpICYmIHRoaXMuVGVzdFJlY3RPdmVybGFwKGEsIGQpKSByZXR1cm4gQzMkanNjb21wJDE2NS5jbGVhckFycmF5KHRlbXBDYW5kaWRhdGVzKSwgZDsKICAgICAgICBDMyRqc2NvbXAkMTY1LmNsZWFyQXJyYXkodGVtcENhbmRpZGF0ZXMpOwogICAgICAgIHJldHVybiBudWxsCiAgICB9CiAgICBUZXN0T3ZlcmxhcEp1bXB0aHJ1KGEsIGIpIHsKICAgICAgICBsZXQgZCA9IG51bGw7CiAgICAgICAgYiAmJiAoZCA9IHRlbXBKdW1wdGhydVJldCwgQzMkanNjb21wJDE2NS5jbGVhckFycmF5KGQpKTsKICAgICAgICBjb25zdCBjID0gYS5HZXRXb3JsZEluZm8oKTsKICAgICAgICB0aGlzLkdldEp1bXB0aHJ1Q29sbGlzaW9uQ2FuZGlkYXRlcyhjLkdldExheWVyKCksIGMuR2V0Qm91bmRpbmdCb3goKSwgdGVtcENhbmRpZGF0ZXMpOwogICAgICAgIGZvciAoY29uc3QgZSBvZiB0ZW1wQ2FuZGlkYXRlcykKICAgICAgICAgICAgaWYgKGUuX0lzSnVtcHRocnVFbmFibGVkKCkgJiYgdGhpcy5UZXN0T3ZlcmxhcChhLCBlKSkKICAgICAgICAgICAgICAgIGlmIChiKSBkLnB1c2goZSk7CiAgICAgICAgICAgICAgICBlbHNlIHJldHVybiBDMyRqc2NvbXAkMTY1LmNsZWFyQXJyYXkodGVtcENhbmRpZGF0ZXMpLCBlOwogICAgICAgIEMzJGpzY29tcCQxNjUuY2xlYXJBcnJheSh0ZW1wQ2FuZGlkYXRlcyk7CiAgICAgICAgcmV0dXJuIGQKICAgIH0KICAgIFB1c2hPdXQoYSwgYiwgZCwgYywgZSkgewogICAgICAgIGMgPSBjIHx8IDUwOwogICAgICAgIGNvbnN0IGcgPSBhLkdldFdvcmxkSW5mbygpLAogICAgICAgICAgICBrID0gZy5HZXRYKCksCiAgICAgICAgICAgIG0gPSBnLkdldFkoKTsKICAgICAgICBmb3IgKGxldCBuID0gMDsgbiA8IGM7ICsrbikKICAgICAgICAgICAgaWYgKGcuU2V0WFkoayArIGIgKiBuLCBtICsgZCAqIG4pLCBnLlNldEJib3hDaGFuZ2VkKCksICF0aGlzLlRlc3RPdmVybGFwKGEsIGUpKSByZXR1cm4gITA7CiAgICAgICAgZy5TZXRYWShrLCBtKTsKICAgICAgICBnLlNldEJib3hDaGFuZ2VkKCk7CiAgICAgICAgcmV0dXJuICExCiAgICB9CiAgICBQdXNoT3V0U29saWQoYSwgYiwgZCwgYywgZSwgZykgewogICAgICAgIGMgPSBjIHx8IDUwOwogICAgICAgIGNvbnN0IGsgPSBhLkdldFdvcmxkSW5mbygpLAogICAgICAgICAgICBtID0gay5HZXRYKCksCiAgICAgICAgICAgIG4gPSBrLkdldFkoKTsKICAgICAgICBsZXQgcSA9IG51bGwsCiAgICAgICAgICAgIHUgPSBudWxsOwogICAgICAgIGZvciAobGV0IHcgPSAwOyB3IDwgYzsgKyt3KQogICAgICAgICAgICBpZiAoay5TZXRYWShtICsgYiAqIHcsIG4gKyBkICogdyksIGsuU2V0QmJveENoYW5nZWQoKSwgIXRoaXMuVGVzdE92ZXJsYXAoYSwgcSkpCiAgICAgICAgICAgICAgICBpZiAocSA9CiAgICAgICAgICAgICAgICAgICAgdGhpcy5UZXN0T3ZlcmxhcFNvbGlkKGEpKSB1ID0gcTsKICAgICAgICAgICAgICAgIGVsc2UgaWYgKGUgJiYgKHEgPSBnID8gdGhpcy5UZXN0T3ZlcmxhcChhLCBnKSA/IGcgOiBudWxsIDogdGhpcy5UZXN0T3ZlcmxhcEp1bXB0aHJ1KGEpKSAmJiAodSA9IHEpLCAhcSkgcmV0dXJuIHUgJiYgdGhpcy5QdXNoSW5GcmFjdGlvbmFsKGEsIGIsIGQsIHUsIDE2LCAhMCksICEwOwogICAgICAgIGsuU2V0WFkobSwgbik7CiAgICAgICAgay5TZXRCYm94Q2hhbmdlZCgpOwogICAgICAgIHJldHVybiAhMQogICAgfQogICAgUHVzaE91dFNvbGlkQXhpcyhhLCBiLCBkLCBjKSB7CiAgICAgICAgYyA9IGMgfHwgNTA7CiAgICAgICAgY29uc3QgZSA9IGEuR2V0V29ybGRJbmZvKCksCiAgICAgICAgICAgIGcgPSBlLkdldFgoKSwKICAgICAgICAgICAgayA9IGUuR2V0WSgpOwogICAgICAgIGxldCBtID0gbnVsbCwKICAgICAgICAgICAgbiA9IG51bGw7CiAgICAgICAgZm9yIChsZXQgcSA9IDA7IHEgPCBjOyArK3EpCiAgICAgICAgICAgIGZvciAobGV0IHUgPSAwOyAyID4gdTsgKyt1KSB7CiAgICAgICAgICAgICAgICBjb25zdCB3ID0gMiAqIHUgLSAxOwogICAgICAgICAgICAgICAgZS5TZXRYWShnICsgYiAqIHEgKiB3LCBrICsgZCAqIHEgKiB3KTsKICAgICAgICAgICAgICAgIGUuU2V0QmJveENoYW5nZWQoKTsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5UZXN0T3ZlcmxhcChhLCBtKSkKICAgICAgICAgICAgICAgICAgICBpZiAobSA9IHRoaXMuVGVzdE92ZXJsYXBTb2xpZChhKSkgbiA9IG07CiAgICAgICAgICAgICAgICAgICAgZWxzZSByZXR1cm4gbiAmJiB0aGlzLlB1c2hJbkZyYWN0aW9uYWwoYSwKICAgICAgICAgICAgICAgICAgICAgICAgYiAqIHcsIGQgKiB3LCBuLCAxNiwgITApLCAhMAogICAgICAgICAgICB9CiAgICAgICAgZS5TZXRYWShnLCBrKTsKICAgICAgICBlLlNldEJib3hDaGFuZ2VkKCk7CiAgICAgICAgcmV0dXJuICExCiAgICB9CiAgICBQdXNoSW5GcmFjdGlvbmFsKGEsIGIsIGQsIGMsIGUsIGcpIHsKICAgICAgICBsZXQgayA9IDIsCiAgICAgICAgICAgIG0gPSAhMTsKICAgICAgICB2YXIgbiA9ICExOwogICAgICAgIGNvbnN0IHEgPSBhLkdldFdvcmxkSW5mbygpOwogICAgICAgIGxldCB1ID0gcS5HZXRYKCksCiAgICAgICAgICAgIHcgPSBxLkdldFkoKTsKICAgICAgICBmb3IgKDsgayA8PSBlOykgbiA9IDEgLyBrLCBrICo9IDIsIHEuT2Zmc2V0WFkoYiAqIG4gKiAobSA/IDEgOiAtMSksIGQgKiBuICogKG0gPyAxIDogLTEpKSwgcS5TZXRCYm94Q2hhbmdlZCgpLCB0aGlzLlRlc3RPdmVybGFwKGEsIGMpIHx8IGcgJiYgdGhpcy5UZXN0T3ZlcmxhcFNvbGlkKGEpID8gbiA9IG0gPSAhMCA6IChuID0gbSA9ICExLCB1ID0gcS5HZXRYKCksIHcgPSBxLkdldFkoKSk7CiAgICAgICAgbiAmJiAocS5TZXRYWSh1LCB3KSwgcS5TZXRCYm94Q2hhbmdlZCgpKQogICAgfQogICAgUHVzaE91dFNvbGlkTmVhcmVzdChhLCBiID0gMTAwKSB7CiAgICAgICAgbGV0IGQgPSAwOwogICAgICAgIGNvbnN0IGMgPSBhLkdldFdvcmxkSW5mbygpLAogICAgICAgICAgICBlID0gYy5HZXRYKCksCiAgICAgICAgICAgIGcgPSBjLkdldFkoKTsKICAgICAgICBsZXQgayA9IDAsCiAgICAgICAgICAgIG0gPSB0aGlzLlRlc3RPdmVybGFwU29saWQoYSk7CiAgICAgICAgaWYgKCFtKSByZXR1cm4gITA7CiAgICAgICAgZm9yICg7IGQgPD0gYjspIHsKICAgICAgICAgICAgbGV0IG4gPSAwLAogICAgICAgICAgICAgICAgcSA9IDA7CiAgICAgICAgICAgIHN3aXRjaCAoaykgewogICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgIG4gPSAwOwogICAgICAgICAgICAgICAgICAgIHEgPSAtMTsKICAgICAgICAgICAgICAgICAgICBkKys7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICAgICAgbiA9IDE7CiAgICAgICAgICAgICAgICAgICAgcSA9IC0xOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgICAgIG4gPSAxOwogICAgICAgICAgICAgICAgICAgIHEgPSAwOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgICAgIHEgPSBuID0gMTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgICAgICBuID0gMDsKICAgICAgICAgICAgICAgICAgICBxID0gMTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgICAgICBuID0gLTE7CiAgICAgICAgICAgICAgICAgICAgcSA9IDE7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgICAgICAgbiA9IC0xOwogICAgICAgICAgICAgICAgICAgIHEgPSAwOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgICAgIHEgPSBuID0gLTEKICAgICAgICAgICAgfQogICAgICAgICAgICBrID0gKGsgKyAxKSAlIDg7CiAgICAgICAgICAgIGMuU2V0WFkoTWF0aC5mbG9vcihlICsgbiAqIGQpLCBNYXRoLmZsb29yKGcgKyBxICogZCkpOwogICAgICAgICAgICBjLlNldEJib3hDaGFuZ2VkKCk7CiAgICAgICAgICAgIGlmICghdGhpcy5UZXN0T3ZlcmxhcChhLCBtKSAmJiAobSA9IHRoaXMuVGVzdE92ZXJsYXBTb2xpZChhKSwgIW0pKSByZXR1cm4gITAKICAgICAgICB9CiAgICAgICAgYy5TZXRYWShlLCBnKTsKICAgICAgICBjLlNldEJib3hDaGFuZ2VkKCk7CiAgICAgICAgcmV0dXJuICExCiAgICB9CiAgICBDYWxjdWxhdGVCb3VuY2VBbmdsZShhLCBiLCBkLCBjKSB7CiAgICAgICAgY29uc3QgZSA9IGEuR2V0V29ybGRJbmZvKCksCiAgICAgICAgICAgIGcgPSBlLkdldFgoKSwKICAgICAgICAgICAgayA9IGUuR2V0WSgpLAogICAgICAgICAgICBtID0gTWF0aC5tYXgoMTAsIEMzJGpzY29tcCQxNjUuZGlzdGFuY2VUbyhiLAogICAgICAgICAgICAgICAgZCwgZywgaykpOwogICAgICAgIHZhciBuID0gQzMkanNjb21wJDE2NS5hbmdsZVRvKGIsIGQsIGcsIGspLAogICAgICAgICAgICBxID0gYyB8fCB0aGlzLlRlc3RPdmVybGFwU29saWQoYSk7CiAgICAgICAgaWYgKCFxKSByZXR1cm4gQzMkanNjb21wJDE2NS5jbGFtcEFuZ2xlKG4gKyBNYXRoLlBJKTsKICAgICAgICBsZXQgdSA9IHE7CiAgICAgICAgdmFyIHcgPSAwLAogICAgICAgICAgICB6ID0gMDsKICAgICAgICBjb25zdCBDID0gQzMkanNjb21wJDE2NS50b1JhZGlhbnMoNSk7CiAgICAgICAgbGV0IEQ7CiAgICAgICAgZm9yIChEID0gMTsgMzYgPiBEOyArK0QpIHsKICAgICAgICAgICAgY29uc3QgRiA9IG4gLSBEICogQzsKICAgICAgICAgICAgZS5TZXRYWShiICsgTWF0aC5jb3MoRikgKiBtLCBkICsgTWF0aC5zaW4oRikgKiBtKTsKICAgICAgICAgICAgZS5TZXRCYm94Q2hhbmdlZCgpOwogICAgICAgICAgICBpZiAoIXRoaXMuVGVzdE92ZXJsYXAoYSwgdSkgJiYgKHUgPSBjID8gbnVsbCA6IHRoaXMuVGVzdE92ZXJsYXBTb2xpZChhKSwgIXUpKSB7CiAgICAgICAgICAgICAgICB3ID0gRjsKICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgMzYgPT09IEQgJiYgKHcgPSBDMyRqc2NvbXAkMTY1LmNsYW1wQW5nbGUobiArIE1hdGguUEkpKTsKICAgICAgICB1ID0gcTsKICAgICAgICBmb3IgKEQgPSAxOyAzNiA+IEQ7ICsrRCkKICAgICAgICAgICAgaWYgKHEgPSBuICsgRCAqIEMsIGUuU2V0WFkoYiArIE1hdGguY29zKHEpICogbSwgZCArIE1hdGguc2luKHEpICogbSksIGUuU2V0QmJveENoYW5nZWQoKSwgIXRoaXMuVGVzdE92ZXJsYXAoYSwKICAgICAgICAgICAgICAgICAgICB1KSAmJiAodSA9IGMgPyBudWxsIDogdGhpcy5UZXN0T3ZlcmxhcFNvbGlkKGEpLCAhdSkpIHsKICAgICAgICAgICAgICAgIHogPSBxOwogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgfQogICAgICAgIDM2ID09PSBEICYmICh6ID0gQzMkanNjb21wJDE2NS5jbGFtcEFuZ2xlKG4gKyBNYXRoLlBJKSk7CiAgICAgICAgZS5TZXRYWShnLCBrKTsKICAgICAgICBlLlNldEJib3hDaGFuZ2VkKCk7CiAgICAgICAgaWYgKHogPT09IHcpIHJldHVybiB6OwogICAgICAgIGEgPSBDMyRqc2NvbXAkMTY1LmFuZ2xlRGlmZih6LCB3KSAvIDI7CiAgICAgICAgYSA9IEMzJGpzY29tcCQxNjUuYW5nbGVDbG9ja3dpc2UoeiwgdykgPyBDMyRqc2NvbXAkMTY1LmNsYW1wQW5nbGUodyArIGEgKyBNYXRoLlBJKSA6IEMzJGpzY29tcCQxNjUuY2xhbXBBbmdsZSh6ICsgYSk7CiAgICAgICAgdyA9IE1hdGguY29zKG4pOwogICAgICAgIG4gPSBNYXRoLnNpbihuKTsKICAgICAgICB6ID0gTWF0aC5jb3MoYSk7CiAgICAgICAgYSA9IE1hdGguc2luKGEpOwogICAgICAgIGIgPSB3ICogeiArIG4gKiBhOwogICAgICAgIHJldHVybiBDMyRqc2NvbXAkMTY1LmFuZ2xlVG8oMCwgMCwgdyAtIDIgKiBiICogeiwgbiAtIDIgKiBiICogYSkKICAgIH0KICAgIFRlc3RTZWdtZW50T3ZlcmxhcChhLCBiLCBkLCBjLCBlKSB7CiAgICAgICAgaWYgKCFlKSByZXR1cm4gITE7CiAgICAgICAgY29uc3QgZyA9IGUuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgaWYgKCFnLklzQ29sbGlzaW9uRW5hYmxlZCgpKSByZXR1cm4gITE7CiAgICAgICAgdGhpcy5fY29sbGlzaW9uQ2hlY2tDb3VudCsrOwogICAgICAgIHRlbXBSZWN0JGpzY29tcCQ3LnNldChNYXRoLm1pbihhLCBkKSwgTWF0aC5taW4oYiwgYyksIE1hdGgubWF4KGEsIGQpLCBNYXRoLm1heChiLCBjKSk7CiAgICAgICAgaWYgKCFnLkdldEJvdW5kaW5nQm94KCkuaW50ZXJzZWN0c1JlY3QodGVtcFJlY3QkanNjb21wJDcpKSByZXR1cm4gITE7CiAgICAgICAgaWYgKGUuSGFzVGlsZW1hcCgpKSByZXR1cm4gdGhpcy5fVGVzdFNlZ21lbnRPdmVybGFwVGlsZW1hcChhLCBiLCBkLCBjLCBlLCBnKTsKICAgICAgICB0aGlzLl9wb2x5Q2hlY2tDb3VudCsrOwogICAgICAgIHJldHVybiBnLkdldEJvdW5kaW5nUXVhZCgpLmludGVyc2VjdHNTZWdtZW50KGEsIGIsIGQsIGMpID8gZy5IYXNPd25Db2xsaXNpb25Qb2x5KCkgPyBnLkdldFRyYW5zZm9ybWVkQ29sbGlzaW9uUG9seSgpLmludGVyc2VjdHNTZWdtZW50KGcuR2V0WCgpLCBnLkdldFkoKSwgYSwgYiwgZCwgYykgOiAhMCA6ICExCiAgICB9CiAgICBfVGVzdFNlZ21lbnRPdmVybGFwVGlsZW1hcChhLCBiLCBkLCBjLCBlLCBnKSB7CiAgICAgICAgY29uc3QgayA9IGcuR2V0WCgpOwogICAgICAgIGcgPSBnLkdldFkoKTsKICAgICAgICBlID0gZS5HZXRTZGtJbnN0YW5jZSgpOwogICAgICAgIHRlbXBSZWN0MiRqc2NvbXAkMS5zZXQoYSwgYiwgZCwgYyk7CiAgICAgICAgdGVtcFJlY3QyJGpzY29tcCQxLm5vcm1hbGl6ZSgpOwogICAgICAgIGUuR2V0Q29sbGlzaW9uUmVjdENhbmRpZGF0ZXModGVtcFJlY3QyJGpzY29tcCQxLCB0aWxlQ29sbFJlY3RDYW5kaWRhdGVzKTsKICAgICAgICBmb3IgKGxldCBuID0gMCwgcSA9IHRpbGVDb2xsUmVjdENhbmRpZGF0ZXMubGVuZ3RoOyBuIDwgcTsgKytuKSB7CiAgICAgICAgICAgIHZhciBtID0gdGlsZUNvbGxSZWN0Q2FuZGlkYXRlc1tuXTsKICAgICAgICAgICAgZSA9IG0uR2V0UmVjdCgpOwogICAgICAgICAgICB0aGlzLl9jb2xsaXNpb25DaGVja0NvdW50Kys7CiAgICAgICAgICAgIGlmICh0ZW1wUmVjdCRqc2NvbXAkNy5pbnRlcnNlY3RzUmVjdE9mZnNldChlLCBrLCBnKSAmJiAodGVtcFF1YWQkanNjb21wJDQuc2V0RnJvbVJlY3QoZSksIHRlbXBRdWFkJGpzY29tcCQ0Lm9mZnNldChrLCBnKSwgdGVtcFF1YWQkanNjb21wJDQuaW50ZXJzZWN0c1NlZ21lbnQoYSwgYiwgZCwgYykpKQogICAgICAgICAgICAgICAgaWYgKG0gPSBtLkdldFBvbHkoKSkgewogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9wb2x5Q2hlY2tDb3VudCsrLCBtLmludGVyc2VjdHNTZWdtZW50KGsgKyBlLmdldExlZnQoKSwgZyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLmdldFRvcCgpLCBhLCBiLCBkLCBjKSkgcmV0dXJuIEMzJGpzY29tcCQxNjUuY2xlYXJBcnJheSh0aWxlQ29sbFJlY3RDYW5kaWRhdGVzKSwgITAKICAgICAgICAgICAgICAgIH0gZWxzZSByZXR1cm4gQzMkanNjb21wJDE2NS5jbGVhckFycmF5KHRpbGVDb2xsUmVjdENhbmRpZGF0ZXMpLCAhMAogICAgICAgIH0KICAgICAgICBDMyRqc2NvbXAkMTY1LmNsZWFyQXJyYXkodGlsZUNvbGxSZWN0Q2FuZGlkYXRlcyk7CiAgICAgICAgcmV0dXJuICExCiAgICB9CiAgICBUZXN0UmVjdE92ZXJsYXAoYSwgYikgewogICAgICAgIGlmICghYikgcmV0dXJuICExOwogICAgICAgIGNvbnN0IGQgPSBiLkdldFdvcmxkSW5mbygpOwogICAgICAgIGlmICghZC5Jc0NvbGxpc2lvbkVuYWJsZWQoKSkgcmV0dXJuICExOwogICAgICAgIHRoaXMuX2NvbGxpc2lvbkNoZWNrQ291bnQrKzsKICAgICAgICBpZiAoIWQuR2V0Qm91bmRpbmdCb3goKS5pbnRlcnNlY3RzUmVjdChhKSkgcmV0dXJuICExOwogICAgICAgIGlmIChiLkhhc1RpbGVtYXAoKSkgcmV0dXJuIHRoaXMuX1Rlc3RSZWN0T3ZlcmxhcFRpbGVtYXAoYSwgYiwgZCk7CiAgICAgICAgdGhpcy5fcG9seUNoZWNrQ291bnQrKzsKICAgICAgICB0ZW1wUXVhZCRqc2NvbXAkNC5zZXRGcm9tUmVjdChhKTsKICAgICAgICBpZiAoIWQuR2V0Qm91bmRpbmdRdWFkKCkuaW50ZXJzZWN0c1F1YWQodGVtcFF1YWQkanNjb21wJDQpKSByZXR1cm4gITE7CiAgICAgICAgaWYgKCFkLkhhc093bkNvbGxpc2lvblBvbHkoKSkgcmV0dXJuICEwOwogICAgICAgIHRlbXBQb2x5QS5zZXRGcm9tUmVjdChhLCBkLkdldFgoKSwgZC5HZXRZKCkpOwogICAgICAgIGEgPSBkLkdldFRyYW5zZm9ybWVkQ29sbGlzaW9uUG9seSgpOwogICAgICAgIHJldHVybiB0ZW1wUG9seUEuaW50ZXJzZWN0c1BvbHkoYSwgMCwgMCkKICAgIH0KICAgIF9UZXN0UmVjdE92ZXJsYXBUaWxlbWFwKGEsIGIsIGQpIHsKICAgICAgICBjb25zdCBjID0gZC5HZXRYKCk7CiAgICAgICAgZCA9IGQuR2V0WSgpOwogICAgICAgIGIuR2V0U2RrSW5zdGFuY2UoKS5HZXRDb2xsaXNpb25SZWN0Q2FuZGlkYXRlcyhhLCB0aWxlQ29sbFJlY3RDYW5kaWRhdGVzKTsKICAgICAgICBmb3IgKGxldCBnID0gMCwgayA9IHRpbGVDb2xsUmVjdENhbmRpZGF0ZXMubGVuZ3RoOyBnIDwgazsgKytnKSB7CiAgICAgICAgICAgIHZhciBlID0gdGlsZUNvbGxSZWN0Q2FuZGlkYXRlc1tnXTsKICAgICAgICAgICAgYiA9IGUuR2V0UmVjdCgpOwogICAgICAgICAgICB0aGlzLl9jb2xsaXNpb25DaGVja0NvdW50Kys7CiAgICAgICAgICAgIGlmIChhLmludGVyc2VjdHNSZWN0T2Zmc2V0KGIsIGMsIGQpKQogICAgICAgICAgICAgICAgaWYgKGUgPSBlLkdldFBvbHkoKSkgewogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9wb2x5Q2hlY2tDb3VudCsrLCB0ZW1wUG9seUEuc2V0RnJvbVJlY3QoYSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDAsIDApLCBlLmludGVyc2VjdHNQb2x5KHRlbXBQb2x5QSwgLShjICsgYi5nZXRMZWZ0KCkpLCAtKGQgKyBiLmdldFRvcCgpKSkpIHJldHVybiBDMyRqc2NvbXAkMTY1LmNsZWFyQXJyYXkodGlsZUNvbGxSZWN0Q2FuZGlkYXRlcyksICEwCiAgICAgICAgICAgICAgICB9IGVsc2UgcmV0dXJuIEMzJGpzY29tcCQxNjUuY2xlYXJBcnJheSh0aWxlQ29sbFJlY3RDYW5kaWRhdGVzKSwgITAKICAgICAgICB9CiAgICAgICAgQzMkanNjb21wJDE2NS5jbGVhckFycmF5KHRpbGVDb2xsUmVjdENhbmRpZGF0ZXMpOwogICAgICAgIHJldHVybiAhMQogICAgfQogICAgVGVzdFJheUludGVyc2VjdHNJbnN0YW5jZShhLCBiKSB7CiAgICAgICAgaWYgKGEpIHsKICAgICAgICAgICAgdmFyIGQgPSBhLkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICBkLklzQ29sbGlzaW9uRW5hYmxlZCgpICYmICh0aGlzLl9jb2xsaXNpb25DaGVja0NvdW50KyssIGQuR2V0Qm91bmRpbmdCb3goKS5pbnRlcnNlY3RzUmVjdChiLnJlY3QpICYmIChhLkhhc1RpbGVtYXAoKSA/IHRoaXMuX1Rlc3RSYXlJbnRlcnNlY3RzVGlsZW1hcChhLCBkLCBiKSA6ICh0aGlzLl9wb2x5Q2hlY2tDb3VudCsrLCBkLkhhc093bkNvbGxpc2lvblBvbHkoKSA/CiAgICAgICAgICAgICAgICBiLlRlc3RJbnN0YW5jZVBvbHkoYSwgZC5HZXRYKCksIGQuR2V0WSgpLCBkLkdldFRyYW5zZm9ybWVkQ29sbGlzaW9uUG9seSgpKSA6IGIuVGVzdEluc3RhbmNlUXVhZChhLCBkLkdldEJvdW5kaW5nUXVhZCgpKSkpKQogICAgICAgIH0KICAgIH0KICAgIF9UZXN0UmF5SW50ZXJzZWN0c1RpbGVtYXAoYSwgYiwgZCkgewogICAgICAgIGNvbnN0IGMgPSBiLkdldFgoKSwKICAgICAgICAgICAgZSA9IGIuR2V0WSgpOwogICAgICAgIGEuR2V0U2RrSW5zdGFuY2UoKS5HZXRDb2xsaXNpb25SZWN0Q2FuZGlkYXRlcyhkLnJlY3QsIHRpbGVDb2xsUmVjdENhbmRpZGF0ZXMpOwogICAgICAgIGZvciAobGV0IGsgPSAwLCBtID0gdGlsZUNvbGxSZWN0Q2FuZGlkYXRlcy5sZW5ndGg7IGsgPCBtOyBrKyspIHsKICAgICAgICAgICAgdmFyIGcgPSB0aWxlQ29sbFJlY3RDYW5kaWRhdGVzW2tdOwogICAgICAgICAgICBjb25zdCBuID0gZy5HZXRSZWN0KCk7CiAgICAgICAgICAgIHRoaXMuX2NvbGxpc2lvbkNoZWNrQ291bnQrKzsKICAgICAgICAgICAgZC5yZWN0LmludGVyc2VjdHNSZWN0T2Zmc2V0KG4sIGMsIGUpICYmIChnID0gZy5HZXRQb2x5KCksIHRoaXMuX3BvbHlDaGVja0NvdW50KyssIGcgPyBkLlRlc3RJbnN0YW5jZVBvbHkoYSwgYyArIG4uZ2V0TGVmdCgpLCBlICsKICAgICAgICAgICAgICAgIG4uZ2V0VG9wKCksIGcpIDogZC5UZXN0SW5zdGFuY2VSZWN0KGEsIGIuR2V0WCgpLCBiLkdldFkoKSwgbikpCiAgICAgICAgfQogICAgICAgIEMzJGpzY29tcCQxNjUuY2xlYXJBcnJheSh0aWxlQ29sbFJlY3RDYW5kaWRhdGVzKQogICAgfQp9OwoidXNlIHN0cmljdCI7CmNvbnN0IEMzJGpzY29tcCQxNjYgPSBzZWxmLkMzOwpDMyRqc2NvbXAkMTY2LlNwYXJzZUdyaWQgPSBjbGFzcyBleHRlbmRzIEMzJGpzY29tcCQxNjYuRGVmZW5kZWRCYXNlIHsKICAgIGNvbnN0cnVjdG9yKGEsIGIpIHsKICAgICAgICBzdXBlcigpOwogICAgICAgIHRoaXMuX2NlbGxXaWR0aCA9IGE7CiAgICAgICAgdGhpcy5fY2VsbEhlaWdodCA9IGI7CiAgICAgICAgdGhpcy5fY2VsbHMgPSBDMyRqc2NvbXAkMTY2Lk5ldyhDMyRqc2NvbXAkMTY2LlBhaXJNYXApCiAgICB9CiAgICBSZWxlYXNlKCkgewogICAgICAgIHRoaXMuX2NlbGxzLlJlbGVhc2UoKTsKICAgICAgICB0aGlzLl9jZWxscyA9IG51bGwKICAgIH0KICAgIEdldENlbGwoYSwgYiwgZCkgewogICAgICAgIGxldCBjID0gdGhpcy5fY2VsbHMuR2V0KGEsIGIpOwogICAgICAgIHJldHVybiBjID8gYyA6IGQgPyAoYyA9IEMzJGpzY29tcCQxNjYuTmV3KEMzJGpzY29tcCQxNjYuR3JpZENlbGwsIHRoaXMsIGEsIGIpLCB0aGlzLl9jZWxscy5TZXQoYSwgYiwgYyksIGMpIDogbnVsbAogICAgfQogICAgWFRvQ2VsbChhKSB7CiAgICAgICAgYSA9IE1hdGguZmxvb3IoYSAvIHRoaXMuX2NlbGxXaWR0aCk7CiAgICAgICAgcmV0dXJuIGlzRmluaXRlKGEpID8gYSA6IDAKICAgIH0KICAgIFlUb0NlbGwoYSkgewogICAgICAgIGEgPSBNYXRoLmZsb29yKGEgLyB0aGlzLl9jZWxsSGVpZ2h0KTsKICAgICAgICByZXR1cm4gaXNGaW5pdGUoYSkgPyBhIDoKICAgICAgICAgICAgMAogICAgfQogICAgVXBkYXRlKGEsIGIsIGQpIHsKICAgICAgICBpZiAoYikKICAgICAgICAgICAgZm9yIChsZXQgYyA9IGIuZ2V0TGVmdCgpLCBlID0gYi5nZXRSaWdodCgpOyBjIDw9IGU7ICsrYykKICAgICAgICAgICAgICAgIGZvciAobGV0IGcgPSBiLmdldFRvcCgpLCBrID0gYi5nZXRCb3R0b20oKTsgZyA8PSBrOyArK2cpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZCAmJiBkLmNvbnRhaW5zUG9pbnQoYywgZykpIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IG0gPSB0aGlzLkdldENlbGwoYywgZywgITEpOwogICAgICAgICAgICAgICAgICAgIG0gJiYgKG0uUmVtb3ZlKGEpLCBtLklzRW1wdHkoKSAmJiB0aGlzLl9jZWxscy5EZWxldGUoYywgZykpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgaWYgKGQpCiAgICAgICAgICAgIGZvciAobGV0IGMgPSBkLmdldExlZnQoKSwgZSA9IGQuZ2V0UmlnaHQoKTsgYyA8PSBlOyArK2MpCiAgICAgICAgICAgICAgICBmb3IgKGxldCBnID0gZC5nZXRUb3AoKSwgayA9IGQuZ2V0Qm90dG9tKCk7IGcgPD0gazsgKytnKSBiICYmIGIuY29udGFpbnNQb2ludChjLCBnKSB8fCB0aGlzLkdldENlbGwoYywgZywgITApLkluc2VydChhKQogICAgfQogICAgUXVlcnlSYW5nZShhLCBiKSB7CiAgICAgICAgbGV0IGQgPSB0aGlzLlhUb0NlbGwoYS5nZXRMZWZ0KCkpOwogICAgICAgIGNvbnN0IGMgPSB0aGlzLllUb0NlbGwoYS5nZXRUb3AoKSksCiAgICAgICAgICAgIGUgPSB0aGlzLlhUb0NlbGwoYS5nZXRSaWdodCgpKTsKICAgICAgICBhID0gdGhpcy5ZVG9DZWxsKGEuZ2V0Qm90dG9tKCkpOwogICAgICAgIGlmIChpc0Zpbml0ZShlKSAmJiBpc0Zpbml0ZShhKSkKICAgICAgICAgICAgZm9yICg7IGQgPD0gZTsgKytkKQogICAgICAgICAgICAgICAgZm9yIChsZXQgZyA9IGM7IGcgPD0gYTsgKytnKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgayA9IHRoaXMuR2V0Q2VsbChkLCBnLCAhMSk7CiAgICAgICAgICAgICAgICAgICAgayAmJiBrLkR1bXAoYikKICAgICAgICAgICAgICAgIH0KICAgIH0KfTsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkMTY3ID0gc2VsZi5DMzsKQzMkanNjb21wJDE2Ny5HcmlkQ2VsbCA9IGNsYXNzIGV4dGVuZHMgQzMkanNjb21wJDE2Ny5EZWZlbmRlZEJhc2UgewogICAgY29uc3RydWN0b3IoYSwgYiwgZCkgewogICAgICAgIHN1cGVyKCk7CiAgICAgICAgdGhpcy5fZ3JpZCA9IGE7CiAgICAgICAgdGhpcy5feCA9IGI7CiAgICAgICAgdGhpcy5feSA9IGQ7CiAgICAgICAgdGhpcy5faW5zdGFuY2VzID0gQzMkanNjb21wJDE2Ny5OZXcoQzMkanNjb21wJDE2Ny5BcnJheVNldCkKICAgIH0KICAgIFJlbGVhc2UoKSB7CiAgICAgICAgdGhpcy5faW5zdGFuY2VzLlJlbGVhc2UoKTsKICAgICAgICB0aGlzLl9ncmlkID0gdGhpcy5faW5zdGFuY2VzID0gbnVsbAogICAgfQogICAgSXNFbXB0eSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5faW5zdGFuY2VzLklzRW1wdHkoKQogICAgfQogICAgSW5zZXJ0KGEpIHsKICAgICAgICB0aGlzLl9pbnN0YW5jZXMuQWRkKGEpCiAgICB9CiAgICBSZW1vdmUoYSkgewogICAgICAgIHRoaXMuX2luc3RhbmNlcy5EZWxldGUoYSkKICAgIH0KICAgIER1bXAoYSkgewogICAgICAgIEMzJGpzY29tcCQxNjcuYXBwZW5kQXJyYXkoYSwgdGhpcy5faW5zdGFuY2VzLkdldEFycmF5KCkpCiAgICB9Cn07CiJ1c2Ugc3RyaWN0IjsKY29uc3QgQzMkanNjb21wJDE2OCA9IHNlbGYuQzM7CkMzJGpzY29tcCQxNjguUmF5ID0gY2xhc3MgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgICAgdGhpcy5keSA9IHRoaXMuZHggPSB0aGlzLnkyID0gdGhpcy54MiA9IHRoaXMueTEgPSB0aGlzLngxID0gMDsKICAgICAgICB0aGlzLnJlY3QgPSBuZXcgQzMkanNjb21wJDE2OC5SZWN0OwogICAgICAgIHRoaXMuaGl0RnJhY3Rpb24gPSAyOwogICAgICAgIHRoaXMuaGl0VWlkID0gbnVsbDsKICAgICAgICB0aGlzLmRpc3RhbmNlID0gdGhpcy5oaXRZID0gdGhpcy5oaXRYID0gdGhpcy5oaXROb3JtYWxEeSA9IHRoaXMuaGl0Tm9ybWFsRHggPSB0aGlzLmhpdE5vcm1hbCA9IDA7CiAgICAgICAgdGhpcy5ub3JtYWxYID0gMTsKICAgICAgICB0aGlzLm5vcm1hbFkgPSAwOwogICAgICAgIHRoaXMucmVmbGVjdGlvblggPSAxOwogICAgICAgIHRoaXMucmVmbGVjdGlvblkgPSAwCiAgICB9CiAgICBEaWRDb2xsaWRlKCkgewogICAgICAgIHJldHVybiAxLjAwMDAwMSA+IHRoaXMuaGl0RnJhY3Rpb24KICAgIH0KICAgIFNldChhLCBiLCBkLCBjKSB7CiAgICAgICAgdGhpcy54MSA9IGE7CiAgICAgICAgdGhpcy55MSA9IGI7CiAgICAgICAgdGhpcy54MiA9IGQ7CiAgICAgICAgdGhpcy55MiA9IGM7CiAgICAgICAgdGhpcy5keCA9IGQgLSBhOwogICAgICAgIHRoaXMuZHkgPSBjIC0gYjsKICAgICAgICB0aGlzLnJlY3Quc2V0KGEsIGIsIGQsIGMpOwogICAgICAgIHRoaXMucmVjdC5ub3JtYWxpemUoKTsKICAgICAgICB0aGlzLmhpdEZyYWN0aW9uID0gMjsKICAgICAgICB0aGlzLmhpdFVpZCA9CiAgICAgICAgICAgIG51bGw7CiAgICAgICAgdGhpcy5kaXN0YW5jZSA9IHRoaXMuaGl0WSA9IHRoaXMuaGl0WCA9IHRoaXMuaGl0Tm9ybWFsRHkgPSB0aGlzLmhpdE5vcm1hbER4ID0gdGhpcy5oaXROb3JtYWwgPSAwOwogICAgICAgIHRoaXMubm9ybWFsWCA9IDE7CiAgICAgICAgdGhpcy5ub3JtYWxZID0gMDsKICAgICAgICB0aGlzLnJlZmxlY3Rpb25YID0gMTsKICAgICAgICB0aGlzLnJlZmxlY3Rpb25ZID0gMDsKICAgICAgICByZXR1cm4gdGhpcwogICAgfQogICAgQ29tcGxldGUoKSB7CiAgICAgICAgaWYgKCExICE9PSB0aGlzLkRpZENvbGxpZGUoKSkgewogICAgICAgICAgICB2YXIgYSA9IHRoaXMuZHggKiB0aGlzLmhpdEZyYWN0aW9uLAogICAgICAgICAgICAgICAgYiA9IHRoaXMuZHkgKiB0aGlzLmhpdEZyYWN0aW9uLAogICAgICAgICAgICAgICAgZCA9IE1hdGguaHlwb3QoYSwgYik7CiAgICAgICAgICAgIGEgLz0gZDsKICAgICAgICAgICAgYiAvPSBkOwogICAgICAgICAgICB0aGlzLmRpc3RhbmNlID0gZCAtIDFFLTY7CiAgICAgICAgICAgIHRoaXMuaGl0WCA9IHRoaXMueDEgKyBhICogdGhpcy5kaXN0YW5jZTsKICAgICAgICAgICAgdGhpcy5oaXRZID0gdGhpcy55MSArIGIgKiB0aGlzLmRpc3RhbmNlOwogICAgICAgICAgICB0aGlzLmhpdE5vcm1hbCA9IE1hdGguYXRhbjIodGhpcy5oaXROb3JtYWxEeSwgdGhpcy5oaXROb3JtYWxEeCkgKyBNYXRoLlBJIC8gMjsKICAgICAgICAgICAgdGhpcy5ub3JtYWxYID0gTWF0aC5jb3ModGhpcy5oaXROb3JtYWwpOwogICAgICAgICAgICB0aGlzLm5vcm1hbFkgPQogICAgICAgICAgICAgICAgTWF0aC5zaW4odGhpcy5oaXROb3JtYWwpOwogICAgICAgICAgICBkID0gYSAqIHRoaXMubm9ybWFsWCArIGIgKiB0aGlzLm5vcm1hbFk7CiAgICAgICAgICAgIHRoaXMucmVmbGVjdGlvblggPSBhIC0gMiAqIHRoaXMubm9ybWFsWCAqIGQ7CiAgICAgICAgICAgIHRoaXMucmVmbGVjdGlvblkgPSBiIC0gMiAqIHRoaXMubm9ybWFsWSAqIGQ7CiAgICAgICAgICAgIDAgPCBkICYmICh0aGlzLmhpdE5vcm1hbCA9IEMzJGpzY29tcCQxNjguY2xhbXBBbmdsZSh0aGlzLmhpdE5vcm1hbCArIE1hdGguUEkpLCB0aGlzLm5vcm1hbFggPSAtdGhpcy5ub3JtYWxYLCB0aGlzLm5vcm1hbFkgPSAtdGhpcy5ub3JtYWxZKQogICAgICAgIH0KICAgIH0KICAgIFRlc3RJbnN0YW5jZVNlZ21lbnQoYSwgYiwgZCwgYywgZSkgewogICAgICAgIGNvbnN0IGcgPSBDMyRqc2NvbXAkMTY4LnJheUludGVyc2VjdCh0aGlzLngxLCB0aGlzLnkxLCB0aGlzLngyLCB0aGlzLnkyLCBiLCBkLCBjLCBlKTsKICAgICAgICAwIDw9IGcgJiYgZyA8IHRoaXMuaGl0RnJhY3Rpb24gJiYgKHRoaXMuaGl0RnJhY3Rpb24gPSBnLCB0aGlzLmhpdFVpZCA9IGEuR2V0VUlEKCksIHRoaXMuaGl0Tm9ybWFsRHggPSBiIC0gYywgdGhpcy5oaXROb3JtYWxEeSA9IGQgLSBlKQogICAgfQogICAgVGVzdEluc3RhbmNlUmVjdChhLCBiLCBkLCBjKSB7CiAgICAgICAgY29uc3QgZSA9CiAgICAgICAgICAgIGIgKyBjLmdldExlZnQoKTsKICAgICAgICBiICs9IGMuZ2V0UmlnaHQoKTsKICAgICAgICBjb25zdCBnID0gZCArIGMuZ2V0VG9wKCk7CiAgICAgICAgZCArPSBjLmdldEJvdHRvbSgpOwogICAgICAgIHRoaXMuVGVzdEluc3RhbmNlU2VnbWVudChhLCBlLCBnLCBiLCBnKTsKICAgICAgICB0aGlzLlRlc3RJbnN0YW5jZVNlZ21lbnQoYSwgYiwgZywgYiwgZCk7CiAgICAgICAgdGhpcy5UZXN0SW5zdGFuY2VTZWdtZW50KGEsIGIsIGQsIGUsIGQpOwogICAgICAgIHRoaXMuVGVzdEluc3RhbmNlU2VnbWVudChhLCBlLCBkLCBlLCBnKQogICAgfQogICAgVGVzdEluc3RhbmNlUXVhZChhLCBiKSB7CiAgICAgICAgY29uc3QgZCA9IGIuZ2V0VGx4KCksCiAgICAgICAgICAgIGMgPSBiLmdldFRseSgpLAogICAgICAgICAgICBlID0gYi5nZXRUcngoKSwKICAgICAgICAgICAgZyA9IGIuZ2V0VHJ5KCksCiAgICAgICAgICAgIGsgPSBiLmdldEJyeCgpLAogICAgICAgICAgICBtID0gYi5nZXRCcnkoKSwKICAgICAgICAgICAgbiA9IGIuZ2V0Qmx4KCk7CiAgICAgICAgYiA9IGIuZ2V0Qmx5KCk7CiAgICAgICAgdGhpcy5UZXN0SW5zdGFuY2VTZWdtZW50KGEsIGQsIGMsIGUsIGcpOwogICAgICAgIHRoaXMuVGVzdEluc3RhbmNlU2VnbWVudChhLCBlLCBnLCBrLCBtKTsKICAgICAgICB0aGlzLlRlc3RJbnN0YW5jZVNlZ21lbnQoYSwgaywgbSwgbiwgYik7CiAgICAgICAgdGhpcy5UZXN0SW5zdGFuY2VTZWdtZW50KGEsIG4sIGIsIGQsIGMpCiAgICB9CiAgICBUZXN0SW5zdGFuY2VQb2x5KGEsCiAgICAgICAgYiwgZCwgYykgewogICAgICAgIGMgPSBjLnBvaW50c0FycigpOwogICAgICAgIGZvciAobGV0IGUgPSAwLCBnID0gYy5sZW5ndGg7IGUgPCBnOyBlICs9IDIpIHsKICAgICAgICAgICAgY29uc3QgayA9IChlICsgMikgJSBnOwogICAgICAgICAgICB0aGlzLlRlc3RJbnN0YW5jZVNlZ21lbnQoYSwgY1tlXSArIGIsIGNbZSArIDFdICsgZCwgY1trXSArIGIsIGNbayArIDFdICsgZCkKICAgICAgICB9CiAgICB9Cn07CiJ1c2Ugc3RyaWN0IjsKY29uc3QgQzMkanNjb21wJDE2OSA9IHNlbGYuQzMsCiAgICBWQUxJRF9GVUxMU0NSRUVOX01PREVTID0gbmV3IFNldCgib2ZmIGNyb3Agc2NhbGUtaW5uZXIgc2NhbGUtb3V0ZXIgbGV0dGVyYm94LXNjYWxlIGxldHRlcmJveC1pbnRlZ2VyLXNjYWxlIi5zcGxpdCgiICIpKSwKICAgIFZBTElEX0ZVTExTQ1JFRU5fU0NBTElOR19RVUFMSVRJRVMgPSBuZXcgU2V0KFsiaGlnaCIsICJsb3ciXSksCiAgICBnbE1hdHJpeCRqc2NvbXAkMTEgPSBzZWxmLmdsTWF0cml4LAogICAgbWF0NCRqc2NvbXAkMTAgPSBnbE1hdHJpeCRqc2NvbXAkMTEubWF0NCwKICAgIHRlbXBQcm9qZWN0aW9uID0gbWF0NCRqc2NvbXAkMTAuY3JlYXRlKCksCiAgICB0ZW1wUXVhZCRqc2NvbXAkNSA9IEMzJGpzY29tcCQxNjkuTmV3KEMzJGpzY29tcCQxNjkuUXVhZCksCiAgICB0ZW1wUmVjdCRqc2NvbXAkOCA9IEMzJGpzY29tcCQxNjkuTmV3KEMzJGpzY29tcCQxNjkuUmVjdCk7CkMzJGpzY29tcCQxNjkuQ2FudmFzTWFuYWdlciA9IGNsYXNzIGV4dGVuZHMgQzMkanNjb21wJDE2OS5EZWZlbmRlZEJhc2UgewogICAgY29uc3RydWN0b3IoYSkgewogICAgICAgIHN1cGVyKCk7CiAgICAgICAgdGhpcy5fcnVudGltZSA9IGE7CiAgICAgICAgdGhpcy5fY2FudmFzID0gbnVsbDsKICAgICAgICB0aGlzLl9pc1dlYkdQVUVuYWJsZWQgPSAhMTsKICAgICAgICB0aGlzLl93ZWJncHVSZW5kZXJlciA9IHRoaXMuX3dlYmdsUmVuZGVyZXIgPSBudWxsOwogICAgICAgIHRoaXMuX2dwdVByZWZlcmVuY2UgPSAiaGlnaC1wZXJmb3JtYW5jZSI7CiAgICAgICAgdGhpcy5fY2FudmFzQ3NzT2Zmc2V0WSA9IHRoaXMuX2NhbnZhc0Nzc09mZnNldFggPSB0aGlzLl9jYW52YXNEZXZpY2VIZWlnaHQgPSB0aGlzLl9jYW52YXNEZXZpY2VXaWR0aCA9IHRoaXMuX2NhbnZhc0Nzc0hlaWdodCA9IHRoaXMuX2NhbnZhc0Nzc1dpZHRoID0gdGhpcy5fd2luZG93SW5uZXJIZWlnaHQgPSB0aGlzLl93aW5kb3dJbm5lcldpZHRoID0gMDsKICAgICAgICB0aGlzLl96QXhpc1NjYWxlID0gIm5vcm1hbGl6ZWQiOwogICAgICAgIHRoaXMuX2ZpZWxkT2ZWaWV3ID0gMDsKICAgICAgICB0aGlzLl9lbmFibGVNaXBtYXBzID0gITA7CiAgICAgICAgdGhpcy5fZHJhd0hlaWdodCA9CiAgICAgICAgICAgIHRoaXMuX2RyYXdXaWR0aCA9IHRoaXMuX3RleHR1cmVBbmlzb3Ryb3B5ID0gMDsKICAgICAgICB0aGlzLl9kb2N1bWVudEZ1bGxzY3JlZW5Nb2RlID0gdGhpcy5fZnVsbHNjcmVlbk1vZGUgPSAibGV0dGVyYm94LXNjYWxlIjsKICAgICAgICB0aGlzLl9kZXZpY2VUcmFuc2Zvcm1PZmZZID0gdGhpcy5fZGV2aWNlVHJhbnNmb3JtT2ZmWCA9IDA7CiAgICAgICAgdGhpcy5fZGVmYXVsdFByb2plY3Rpb25NYXRyaXggPSBtYXQ0JGpzY29tcCQxMC5jcmVhdGUoKTsKICAgICAgICB0aGlzLl9mdWxsc2NyZWVuU2NhbGluZ1F1YWxpdHkgPSB0aGlzLl93YW50RnVsbHNjcmVlblNjYWxpbmdRdWFsaXR5ID0gImhpZ2giOwogICAgICAgIHRoaXMuX2lzRG9jdW1lbnRGdWxsc2NyZWVuID0gITE7CiAgICAgICAgdGhpcy5fYXZhaWxhYmxlQWRkaXRpb25hbFJlbmRlclRhcmdldHMgPSBbXTsKICAgICAgICB0aGlzLl91c2VkQWRkaXRpb25hbFJlbmRlclRhcmdldHMgPSBuZXcgU2V0OwogICAgICAgIHRoaXMuX3NoYWRlckRhdGEgPSBzZWxmLkMzX1NoYWRlcnM7CiAgICAgICAgdGhpcy5fZWZmZWN0Q2hhaW5NYW5hZ2VyID0gQzMkanNjb21wJDE2OS5OZXcoQzMkanNjb21wJDE2OS5HZnguRWZmZWN0Q2hhaW5NYW5hZ2VyLCB7CiAgICAgICAgICAgIGdldERyYXdTaXplOiAoKSA9PiBbdGhpcy5HZXREcmF3V2lkdGgoKSwgdGhpcy5HZXREcmF3SGVpZ2h0KCldLAogICAgICAgICAgICBnZXRSZW5kZXJUYXJnZXQ6ICgpID0+IHRoaXMuR2V0RWZmZWN0Q29tcG9zaXRvclJlbmRlclRhcmdldCgpLAogICAgICAgICAgICByZWxlYXNlUmVuZGVyVGFyZ2V0OiBiID0+IHRoaXMuUmVsZWFzZUVmZmVjdENvbXBvc2l0b3JSZW5kZXJUYXJnZXQoYiksCiAgICAgICAgICAgIGdldFRpbWU6ICgpID0+IHRoaXMuR2V0UnVudGltZSgpLkdldEdhbWVUaW1lKCksCiAgICAgICAgICAgIHJlZHJhdzogKCkgPT4gdGhpcy5HZXRSdW50aW1lKCkuVXBkYXRlUmVuZGVyKCkKICAgICAgICB9KTsKICAgICAgICB0aGlzLl9ncHVUaW1lRW5kRnJhbWUgPSB0aGlzLl9ncHVUaW1lU3RhcnRGcmFtZSA9IDA7CiAgICAgICAgdGhpcy5fZ3B1TGFzdFV0aWxpc2F0aW9uID0gTmFOOwogICAgICAgIHRoaXMuX2dwdUZyYW1lVGltaW5nc0J1ZmZlciA9IG51bGw7CiAgICAgICAgdGhpcy5fbGF5ZXJzR3B1UHJvZmlsZSA9IG5ldyBNYXA7CiAgICAgICAgdGhpcy5fZ3B1Q3VyVXRpbGlzYXRpb24gPSBOYU47CiAgICAgICAgdGhpcy5fd2ViZ3B1RnJhbWVUaW1pbmdzID0gbmV3IE1hcDsKICAgICAgICB0aGlzLl9zbmFwc2hvdEZvcm1hdCA9ICIiOwogICAgICAgIHRoaXMuX3NuYXBzaG90UXVhbGl0eSA9IDE7CiAgICAgICAgdGhpcy5fc25hcHNob3RBcmVhID0gQzMkanNjb21wJDE2OS5OZXcoQzMkanNjb21wJDE2OS5SZWN0KTsKICAgICAgICB0aGlzLl9zbmFwc2hvdFVybCA9ICIiOwogICAgICAgIHRoaXMuX3NuYXBzaG90UmVzb2x2ZSA9IHRoaXMuX3NuYXBzaG90UHJvbWlzZSA9IG51bGw7CiAgICAgICAgdGhpcy5fbG9hZGVyU3RhcnRUaW1lID0gdGhpcy5faXNQYXN0aW5nVG9EcmF3aW5nQ2FudmFzID0gMDsKICAgICAgICB0aGlzLl9yYWZJZCA9IC0xOwogICAgICAgIHRoaXMuX2xvYWRpbmdQcm9ncmVzcyA9IDA7CiAgICAgICAgdGhpcy5fbG9hZGluZ3Byb2dyZXNzX2hhbmRsZXIgPSBiID0+IHRoaXMuX2xvYWRpbmdQcm9ncmVzcyA9IGIucHJvZ3Jlc3M7CiAgICAgICAgdGhpcy5fcGVyY2VudFRleHQgPSBudWxsOwogICAgICAgIHRoaXMuX3NwbGFzaFRleHR1cmVzID0gewogICAgICAgICAgICBsb2dvOiBudWxsLAogICAgICAgICAgICBwb3dlcmVkOiBudWxsLAogICAgICAgICAgICB3ZWJzaXRlOiBudWxsCiAgICAgICAgfTsKICAgICAgICB0aGlzLl9zcGxhc2hGYWRlT3V0U3RhcnRUaW1lID0gdGhpcy5fc3BsYXNoRmFkZUluRmluaXNoVGltZSA9IHRoaXMuX3NwbGFzaEZyYW1lTnVtYmVyID0gMDsKICAgICAgICB0aGlzLl9zcGxhc2hTdGF0ZSA9ICJmYWRlLWluIjsKICAgICAgICB0aGlzLl9zcGxhc2hEb25lUmVzb2x2ZSA9IG51bGw7CiAgICAgICAgdGhpcy5fc3BsYXNoRG9uZVByb21pc2UgPSBuZXcgUHJvbWlzZShiID0+IHRoaXMuX3NwbGFzaERvbmVSZXNvbHZlID0gYikKICAgIH0KICAgIF9TZXRHUFVQb3dlclByZWZlcmVuY2UoYSkgewogICAgICAgIHRoaXMuX2dwdVByZWZlcmVuY2UgPSBhCiAgICB9CiAgICBfU2V0V2ViR1BVRW5hYmxlZChhKSB7CiAgICAgICAgdGhpcy5faXNXZWJHUFVFbmFibGVkID0gISFhCiAgICB9CiAgICBfU2V0WkF4aXNTY2FsZShhKSB7CiAgICAgICAgdGhpcy5fekF4aXNTY2FsZSA9IGEKICAgIH0KICAgIF9TZXRGaWVsZE9mVmlldyhhKSB7CiAgICAgICAgdGhpcy5fZmllbGRPZlZpZXcgPSBhCiAgICB9CiAgICBhc3luYyBDcmVhdGVDYW52YXMoYSkgewogICAgICAgIHRoaXMuX2NhbnZhcyA9IGEuY2FudmFzOwogICAgICAgIHRoaXMuX3J1bnRpbWUuQWRkRE9NQ29tcG9uZW50TWVzc2FnZUhhbmRsZXIoInJ1bnRpbWUiLCAid2luZG93LXJlc2l6ZSIsIGMgPT4gdGhpcy5fT25XaW5kb3dSZXNpemUoYykpOwogICAgICAgIHRoaXMuX3J1bnRpbWUuQWRkRE9NQ29tcG9uZW50TWVzc2FnZUhhbmRsZXIoInJ1bnRpbWUiLCAiZnVsbHNjcmVlbmNoYW5nZSIsIGMgPT4gdGhpcy5fT25GdWxsc2NyZWVuQ2hhbmdlKGMpKTsKICAgICAgICB0aGlzLl9ydW50aW1lLkFkZERPTUNvbXBvbmVudE1lc3NhZ2VIYW5kbGVyKCJydW50aW1lIiwgImZ1bGxzY3JlZW5lcnJvciIsIGMgPT4gdGhpcy5fT25GdWxsc2NyZWVuRXJyb3IoYykpOwogICAgICAgIHRoaXMuX2NhbnZhcy5hZGRFdmVudExpc3RlbmVyKCJ3ZWJnbGNvbnRleHRsb3N0IiwgYyA9PiB0aGlzLl9PbldlYkdMQ29udGV4dExvc3QoYykpOwogICAgICAgIHRoaXMuX2NhbnZhcy5hZGRFdmVudExpc3RlbmVyKCJ3ZWJnbGNvbnRleHRyZXN0b3JlZCIsIGMgPT4gdGhpcy5fT25XZWJHTENvbnRleHRSZXN0b3JlZChjKSk7CiAgICAgICAgdGhpcy5faXNEb2N1bWVudEZ1bGxzY3JlZW4gPSAhIWEuaXNGdWxsc2NyZWVuOwogICAgICAgIHZhciBiID0gbmF2aWdhdG9yLmdwdSAmJiB0aGlzLl9pc1dlYkdQVUVuYWJsZWQ7CiAgICAgICAgbGV0IGQgPSAhMTsKICAgICAgICBpZiAoYikgdHJ5IHsKICAgICAgICAgICAgYXdhaXQgdGhpcy5fSW5pdFdlYkdQVUNvbnRleHQoITApCiAgICAgICAgfSBjYXRjaCAoYykgewogICAgICAgICAgICB0aGlzLl93ZWJncHVSZW5kZXJlciA9IG51bGwKICAgICAgICB9CiAgICAgICAgaWYgKCF0aGlzLkdldFJlbmRlcmVyKCkpIHRyeSB7CiAgICAgICAgICAgIGF3YWl0IHRoaXMuX0luaXRXZWJHTENvbnRleHQoITApCiAgICAgICAgfSBjYXRjaCAoYykgewogICAgICAgICAgICB0aGlzLl93ZWJnbFJlbmRlcmVyID0KICAgICAgICAgICAgICAgIG51bGwKICAgICAgICB9CiAgICAgICAgdGhpcy5HZXRSZW5kZXJlcigpIHx8IChkID0gITApOwogICAgICAgIGlmICghdGhpcy5HZXRSZW5kZXJlcigpICYmIGIpIHRyeSB7CiAgICAgICAgICAgIGF3YWl0IHRoaXMuX0luaXRXZWJHUFVDb250ZXh0KCExKQogICAgICAgIH0gY2F0Y2ggKGMpIHsKICAgICAgICAgICAgdGhpcy5fd2ViZ3B1UmVuZGVyZXIgPSBudWxsCiAgICAgICAgfQogICAgICAgIGlmICghdGhpcy5HZXRSZW5kZXJlcigpKSB0cnkgewogICAgICAgICAgICBhd2FpdCB0aGlzLl9Jbml0V2ViR0xDb250ZXh0KCExKQogICAgICAgIH0gY2F0Y2ggKGMpIHsKICAgICAgICAgICAgdGhpcy5fd2ViZ2xSZW5kZXJlciA9IG51bGwKICAgICAgICB9CiAgICAgICAgYiA9IHRoaXMuR2V0UmVuZGVyZXIoKTsKICAgICAgICBpZiAoIWIpIHRocm93IEVycm9yKCJmYWlsZWQgdG8gYWNxdWlyZSBhIHJlbmRlcmVyIC0gY2hlY2sgV2ViR0wgb3IgV2ViR1BVIGlzIHN1cHBvcnRlZCIpOwogICAgICAgIGIuU2V0SGFzTWFqb3JQZXJmb3JtYW5jZUNhdmVhdChkKTsKICAgICAgICAibm9ybWFsaXplZCIgPT09IHRoaXMuX3pBeGlzU2NhbGUgPyBiLlNldFpBeGlzU2NhbGVOb3JtYWxpemVkKCkgOiAoYi5TZXRaQXhpc1NjYWxlUmVndWxhcigpLCBiLlNldEZvdlkodGhpcy5fZmllbGRPZlZpZXcpKTsKICAgICAgICB0aGlzLlNldFNpemUoYS53aW5kb3dJbm5lcldpZHRoLAogICAgICAgICAgICBhLndpbmRvd0lubmVySGVpZ2h0LCAhMCk7CiAgICAgICAgdGhpcy5fd2ViZ3B1UmVuZGVyZXIgPyBhd2FpdCB0aGlzLl9Jbml0V2ViR1BVKCkgOiB0aGlzLl93ZWJnbFJlbmRlcmVyICYmIGF3YWl0IHRoaXMuX0luaXRXZWJHTCgpOwogICAgICAgIGIuU2V0TWlwbWFwc0VuYWJsZWQodGhpcy5fZW5hYmxlTWlwbWFwcyk7CiAgICAgICAgYi5TdXBwb3J0c0dQVVByb2ZpbGluZygpICYmICh0aGlzLl9ncHVMYXN0VXRpbGlzYXRpb24gPSAwKTsKICAgICAgICBmb3IgKGNvbnN0IGMgb2YgdGhpcy5fcnVudGltZS5fR2V0QWxsRWZmZWN0TGlzdHMoKSkgewogICAgICAgICAgICBmb3IgKGNvbnN0IGUgb2YgYy5HZXRBbGxFZmZlY3RUeXBlcygpKSBlLl9Jbml0UmVuZGVyZXIoYik7CiAgICAgICAgICAgIGMuX0luaXRSZW5kZXJlcihiKTsKICAgICAgICAgICAgYy5VcGRhdGVBY3RpdmVFZmZlY3RzKCkKICAgICAgICB9CiAgICB9CiAgICBhc3luYyBfSW5pdFdlYkdQVUNvbnRleHQoYSkgewogICAgICAgIGEgPSB7CiAgICAgICAgICAgIHBvd2VyUHJlZmVyZW5jZTogdGhpcy5fZ3B1UHJlZmVyZW5jZSwKICAgICAgICAgICAgZGVwdGg6IHRoaXMuX3J1bnRpbWUuVXNlczNERmVhdHVyZXMoKSwKICAgICAgICAgICAgZmFpbElmTWFqb3JQZXJmb3JtYW5jZUNhdmVhdDogYSwKICAgICAgICAgICAgdXNlc0JhY2tncm91bmRCbGVuZGluZzogdGhpcy5fcnVudGltZS5Vc2VzQW55QmFja2dyb3VuZEJsZW5kaW5nKCksCiAgICAgICAgICAgIGNhblNhbXBsZUJhY2tidWZmZXI6IHRoaXMuX3J1bnRpbWUuVXNlc0FueUNyb3NzU2FtcGxpbmcoKSwKICAgICAgICAgICAgY2FuU2FtcGxlRGVwdGg6IHRoaXMuX3J1bnRpbWUuVXNlc0FueURlcHRoU2FtcGxpbmcoKQogICAgICAgIH07CiAgICAgICAgdGhpcy5fd2ViZ3B1UmVuZGVyZXIgPSBDMyRqc2NvbXAkMTY5Lk5ldyhDMyRqc2NvbXAkMTY5LkdmeC5XZWJHUFVSZW5kZXJlcik7CiAgICAgICAgYXdhaXQgdGhpcy5fd2ViZ3B1UmVuZGVyZXIuQ3JlYXRlKHRoaXMuX2NhbnZhcywgYSkKICAgIH0KICAgIGFzeW5jIF9Jbml0V2ViR0xDb250ZXh0KGEpIHsKICAgICAgICBhID0gewogICAgICAgICAgICBwb3dlclByZWZlcmVuY2U6IHRoaXMuX2dwdVByZWZlcmVuY2UsCiAgICAgICAgICAgIGVuYWJsZUdwdVByb2ZpbGluZzogITAsCiAgICAgICAgICAgIGRlcHRoOiB0aGlzLl9ydW50aW1lLlVzZXMzREZlYXR1cmVzKCksCiAgICAgICAgICAgIGNhblNhbXBsZURlcHRoOiB0aGlzLl9ydW50aW1lLlVzZXNBbnlEZXB0aFNhbXBsaW5nKCksCiAgICAgICAgICAgIGZhaWxJZk1ham9yUGVyZm9ybWFuY2VDYXZlYXQ6IGEKICAgICAgICB9OwogICAgICAgICJBbmRyb2lkIiA9PT0gQzMkanNjb21wJDE2OS5QbGF0Zm9ybS5PUyAmJiAiQ2hyb21pdW0iID09PSBDMyRqc2NvbXAkMTY5LlBsYXRmb3JtLkJyb3dzZXJFbmdpbmUgJiYKICAgICAgICAgICAgNzUgPiBDMyRqc2NvbXAkMTY5LlBsYXRmb3JtLkJyb3dzZXJWZXJzaW9uTnVtYmVyICYmIChjb25zb2xlLndhcm4oIltDb25zdHJ1Y3RdIERpc2FibGluZyBXZWJHTCAyIGJlY2F1c2UgdGhpcyBkZXZpY2UgYXBwZWFycyB0byBiZSBhZmZlY3RlZCBieSBjcmJ1Zy5jb20vOTM0ODIzLiBJbnN0YWxsIHNvZnR3YXJlIHVwZGF0ZXMgdG8gYXZvaWQgdGhpcy4iKSwgYS5tYXhXZWJHTFZlcnNpb24gPSAxKTsKICAgICAgICAic3RhbmRhcmQiID09PSB0aGlzLl9ydW50aW1lLkdldENvbXBvc2l0aW5nTW9kZSgpID8gYS5hbHBoYSA9ICEwIDogKGEuYWxwaGEgPSAhMSwgYS5sb3dMYXRlbmN5ID0gITApOwogICAgICAgIHRoaXMuX3dlYmdsUmVuZGVyZXIgPSBDMyRqc2NvbXAkMTY5Lk5ldyhDMyRqc2NvbXAkMTY5LkdmeC5XZWJHTFJlbmRlcmVyLCB0aGlzLl9jYW52YXMsIGEpOwogICAgICAgIGF3YWl0IHRoaXMuX3dlYmdsUmVuZGVyZXIuSW5pdFN0YXRlKCkKICAgIH0KICAgIGFzeW5jIF9Jbml0V2ViR1BVKCkgewogICAgICAgIGlmICh0aGlzLl9zaGFkZXJEYXRhKSB7CiAgICAgICAgICAgIGNvbnN0IGEgPSBbXTsKICAgICAgICAgICAgZm9yIChjb25zdCBbYiwgZF0gb2YgT2JqZWN0LmVudHJpZXModGhpcy5fc2hhZGVyRGF0YSkpIHsKICAgICAgICAgICAgICAgIGQuc3JjID0KICAgICAgICAgICAgICAgICAgICBkLndnc2w7CiAgICAgICAgICAgICAgICBjb25zdCBjID0gQzMkanNjb21wJDE2OS5HZnguV2ViR1BVU2hhZGVyUHJvZ3JhbS5HZXREZWZhdWx0VmVydGV4U2hhZGVyU291cmNlKCk7CiAgICAgICAgICAgICAgICBhLnB1c2godGhpcy5fd2ViZ3B1UmVuZGVyZXIuQ3JlYXRlU2hhZGVyUHJvZ3JhbShkLCBjLCBiKSkKICAgICAgICAgICAgfQogICAgICAgICAgICBhd2FpdCBQcm9taXNlLmFsbChhKQogICAgICAgIH0KICAgIH0KICAgIGFzeW5jIF9Jbml0V2ViR0woKSB7CiAgICAgICAgaWYgKHRoaXMuX3NoYWRlckRhdGEpIHsKICAgICAgICAgICAgY29uc3QgYSA9IFtdOwogICAgICAgICAgICBmb3IgKGNvbnN0IFtiLCBkXSBvZiBPYmplY3QuZW50cmllcyh0aGlzLl9zaGFkZXJEYXRhKSkgewogICAgICAgICAgICAgICAgZC5zcmMgPSBkLmdsc2w7CiAgICAgICAgICAgICAgICBjb25zdCBjID0gQzMkanNjb21wJDE2OS5HZnguV2ViR0xTaGFkZXJQcm9ncmFtLkdldERlZmF1bHRWZXJ0ZXhTaGFkZXJTb3VyY2UoKTsKICAgICAgICAgICAgICAgIGEucHVzaCh0aGlzLl93ZWJnbFJlbmRlcmVyLkNyZWF0ZVNoYWRlclByb2dyYW0oZCwgYywgYikpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgYXdhaXQgUHJvbWlzZS5hbGwoYSk7CiAgICAgICAgICAgIHRoaXMuX3dlYmdsUmVuZGVyZXIuUmVzZXRMYXN0UHJvZ3JhbSgpOwogICAgICAgICAgICB0aGlzLl93ZWJnbFJlbmRlcmVyLlNldFRleHR1cmVGaWxsTW9kZSgpCiAgICAgICAgfQogICAgICAgIHRoaXMuX3dlYmdsUmVuZGVyZXIuU3VwcG9ydHNHUFVQcm9maWxpbmcoKSAmJgogICAgICAgICAgICAodGhpcy5fZ3B1RnJhbWVUaW1pbmdzQnVmZmVyID0gQzMkanNjb21wJDE2OS5OZXcoQzMkanNjb21wJDE2OS5HZnguV2ViR0xRdWVyeVJlc3VsdEJ1ZmZlciwgdGhpcy5fd2ViZ2xSZW5kZXJlcikpCiAgICB9CiAgICBSZWxlYXNlKCkgewogICAgICAgIHRoaXMuX2NhbnZhcyA9IHRoaXMuX3dlYmdsUmVuZGVyZXIgPSB0aGlzLl9ydW50aW1lID0gbnVsbAogICAgfQogICAgX09uV2luZG93UmVzaXplKGEpIHsKICAgICAgICBjb25zdCBiID0gdGhpcy5fcnVudGltZTsKICAgICAgICBpZiAoIWIuSXNFeHBvcnRUb1ZpZGVvKCkpIHsKICAgICAgICAgICAgdmFyIGQgPSBhLmRldmljZVBpeGVsUmF0aW87CiAgICAgICAgICAgIGIuSXNJbldvcmtlcigpICYmIChzZWxmLmRldmljZVBpeGVsUmF0aW8gPSBkKTsKICAgICAgICAgICAgYi5fU2V0RGV2aWNlUGl4ZWxSYXRpbyhkKTsKICAgICAgICAgICAgdGhpcy5faXNEb2N1bWVudEZ1bGxzY3JlZW4gPSAhIWEuaXNGdWxsc2NyZWVuOwogICAgICAgICAgICB0aGlzLlNldFNpemUoYS5pbm5lcldpZHRoLCBhLmlubmVySGVpZ2h0KTsKICAgICAgICAgICAgYi5VcGRhdGVSZW5kZXIoKTsKICAgICAgICAgICAgZCA9IG5ldyBDMyRqc2NvbXAkMTY5LkV2ZW50KCJ3aW5kb3ctcmVzaXplIik7CiAgICAgICAgICAgIGQuZGF0YSA9IGE7CiAgICAgICAgICAgIGIuRGlzcGF0Y2hlcigpLmRpc3BhdGNoRXZlbnRBbmRXYWl0QXN5bmNTZXF1ZW50aWFsKGQpOwogICAgICAgICAgICBhID0gbmV3IEMzJGpzY29tcCQxNjkuRXZlbnQoInJlc2l6ZSIpOwogICAgICAgICAgICBhLmNzc1dpZHRoID0gdGhpcy5HZXRDc3NXaWR0aCgpOwogICAgICAgICAgICBhLmNzc0hlaWdodCA9IHRoaXMuR2V0Q3NzSGVpZ2h0KCk7CiAgICAgICAgICAgIGEuZGV2aWNlV2lkdGggPSB0aGlzLkdldERldmljZVdpZHRoKCk7CiAgICAgICAgICAgIGEuZGV2aWNlSGVpZ2h0ID0gdGhpcy5HZXREZXZpY2VIZWlnaHQoKTsKICAgICAgICAgICAgYi5EaXNwYXRjaFVzZXJTY3JpcHRFdmVudChhKTsKICAgICAgICAgICAgYi5Jc0RlYnVnKCkgJiYgKGIuSGl0QnJlYWtwb2ludCgpIHx8IHNlbGYuQzNEZWJ1Z2dlci5Jc0RlYnVnZ2VyUGF1c2VkKCkpICYmIGIuUmVuZGVyKCkKICAgICAgICB9CiAgICB9CiAgICBfT25GdWxsc2NyZWVuQ2hhbmdlKGEpIHsKICAgICAgICB0aGlzLl9pc0RvY3VtZW50RnVsbHNjcmVlbiA9ICEhYS5pc0Z1bGxzY3JlZW47CiAgICAgICAgdGhpcy5TZXRTaXplKGEuaW5uZXJXaWR0aCwgYS5pbm5lckhlaWdodCwgITApOwogICAgICAgIHRoaXMuX3J1bnRpbWUuVXBkYXRlUmVuZGVyKCkKICAgIH0KICAgIF9PbkZ1bGxzY3JlZW5FcnJvcihhKSB7CiAgICAgICAgdGhpcy5faXNEb2N1bWVudEZ1bGxzY3JlZW4gPSAhIWEuaXNGdWxsc2NyZWVuOwogICAgICAgIHRoaXMuU2V0U2l6ZShhLmlubmVyV2lkdGgsCiAgICAgICAgICAgIGEuaW5uZXJIZWlnaHQsICEwKTsKICAgICAgICB0aGlzLl9ydW50aW1lLlVwZGF0ZVJlbmRlcigpCiAgICB9CiAgICBTZXRTaXplKGEsIGIsIGQgPSAhMSkgewogICAgICAgIGEgPSBNYXRoLmZsb29yKGEpOwogICAgICAgIGIgPSBNYXRoLmZsb29yKGIpOwogICAgICAgIGlmICgwID49IGEgfHwgMCA+PSBiKSB0aHJvdyBFcnJvcigiaW52YWxpZCBzaXplIik7CiAgICAgICAgaWYgKHRoaXMuX3dpbmRvd0lubmVyV2lkdGggIT09IGEgfHwgdGhpcy5fd2luZG93SW5uZXJIZWlnaHQgIT09IGIgfHwgZCkgewogICAgICAgICAgICB0aGlzLl93aW5kb3dJbm5lcldpZHRoID0gYTsKICAgICAgICAgICAgdGhpcy5fd2luZG93SW5uZXJIZWlnaHQgPSBiOwogICAgICAgICAgICBkID0gdGhpcy5HZXRDdXJyZW50RnVsbHNjcmVlbk1vZGUoKTsKICAgICAgICAgICAgImxldHRlcmJveC1zY2FsZSIgPT09IGQgPyB0aGlzLl9DYWxjdWxhdGVMZXR0ZXJib3hTY2FsZShhLCBiKSA6ICJsZXR0ZXJib3gtaW50ZWdlci1zY2FsZSIgPT09IGQgPyB0aGlzLl9DYWxjdWxhdGVMZXR0ZXJib3hJbnRlZ2VyU2NhbGUoYSwgYikgOiAib2ZmIiA9PT0gZCA/IHRoaXMuX0NhbGN1bGF0ZUZpeGVkU2l6ZUNhbnZhcyhhLCBiKSA6IHRoaXMuX0NhbGN1bGF0ZUZ1bGxzaXplQ2FudmFzKGEsIGIpOwogICAgICAgICAgICB0aGlzLl9VcGRhdGVGdWxsc2NyZWVuU2NhbGluZ1F1YWxpdHkoZCk7CiAgICAgICAgICAgIHRoaXMuX2NhbnZhcy53aWR0aCA9IHRoaXMuX2NhbnZhc0RldmljZVdpZHRoOwogICAgICAgICAgICB0aGlzLl9jYW52YXMuaGVpZ2h0ID0gdGhpcy5fY2FudmFzRGV2aWNlSGVpZ2h0OwogICAgICAgICAgICB0aGlzLl9ydW50aW1lLlBvc3RDb21wb25lbnRNZXNzYWdlVG9ET00oImNhbnZhcyIsICJ1cGRhdGUtc2l6ZSIsIHsKICAgICAgICAgICAgICAgIG1hcmdpbkxlZnQ6IHRoaXMuX2NhbnZhc0Nzc09mZnNldFgsCiAgICAgICAgICAgICAgICBtYXJnaW5Ub3A6IHRoaXMuX2NhbnZhc0Nzc09mZnNldFksCiAgICAgICAgICAgICAgICBzdHlsZVdpZHRoOiB0aGlzLl9jYW52YXNDc3NXaWR0aCwKICAgICAgICAgICAgICAgIHN0eWxlSGVpZ2h0OiB0aGlzLl9jYW52YXNDc3NIZWlnaHQsCiAgICAgICAgICAgICAgICBkaXNwbGF5U2NhbGU6IHRoaXMuR2V0RGlzcGxheVNjYWxlKCkKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGEgPSB0aGlzLkdldFJlbmRlcmVyKCk7CiAgICAgICAgICAgIGEuU2V0U2l6ZSh0aGlzLl9jYW52YXNEZXZpY2VXaWR0aCwgdGhpcy5fY2FudmFzRGV2aWNlSGVpZ2h0LCAhMCk7CiAgICAgICAgICAgIGZvciAodmFyIGMgb2YgdGhpcy5fYXZhaWxhYmxlQWRkaXRpb25hbFJlbmRlclRhcmdldHMpIGEuRGVsZXRlUmVuZGVyVGFyZ2V0KGMpOwogICAgICAgICAgICBDMyRqc2NvbXAkMTY5LmNsZWFyQXJyYXkodGhpcy5fYXZhaWxhYmxlQWRkaXRpb25hbFJlbmRlclRhcmdldHMpOwogICAgICAgICAgICBhLkNhbGN1bGF0ZVBlcnNwZWN0aXZlTWF0cml4KHRoaXMuX2RlZmF1bHRQcm9qZWN0aW9uTWF0cml4LCB0aGlzLkdldERyYXdXaWR0aCgpIC8gdGhpcy5HZXREcmF3SGVpZ2h0KCkpOwogICAgICAgICAgICBjID0gdGhpcy5fcnVudGltZS5HZXRMYXlvdXRNYW5hZ2VyKCk7CiAgICAgICAgICAgIGMuU2V0QWxsTGF5ZXJQcm9qZWN0aW9uQ2hhbmdlZCgpOwogICAgICAgICAgICBjLlNldEFsbExheWVyTVZDaGFuZ2VkKCkKICAgICAgICB9CiAgICB9CiAgICBHZXREZWZhdWx0UHJvamVjdGlvbk1hdHJpeCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZGVmYXVsdFByb2plY3Rpb25NYXRyaXgKICAgIH0KICAgIF9DYWxjdWxhdGVMZXR0ZXJib3hTY2FsZShhLCBiKSB7CiAgICAgICAgY29uc3QgZCA9IHRoaXMuX3J1bnRpbWUuR2V0RGV2aWNlUGl4ZWxSYXRpbygpLAogICAgICAgICAgICBjID0gdGhpcy5fcnVudGltZS5HZXRPcmlnaW5hbFZpZXdwb3J0V2lkdGgoKSwKICAgICAgICAgICAgZSA9IHRoaXMuX3J1bnRpbWUuR2V0T3JpZ2luYWxWaWV3cG9ydEhlaWdodCgpLAogICAgICAgICAgICBnID0gYyAvIGU7CiAgICAgICAgYSAvIGIgPiBnID8gKHRoaXMuX2NhbnZhc0Nzc1dpZHRoID0gTWF0aC5yb3VuZChiICogZyksIHRoaXMuX2NhbnZhc0Nzc0hlaWdodCA9IGIsIHRoaXMuX2NhbnZhc0Nzc09mZnNldFggPQogICAgICAgICAgICBNYXRoLmZsb29yKChhIC0gdGhpcy5fY2FudmFzQ3NzV2lkdGgpIC8gMiksIHRoaXMuX2NhbnZhc0Nzc09mZnNldFkgPSAwKSA6ICh0aGlzLl9jYW52YXNDc3NXaWR0aCA9IGEsIHRoaXMuX2NhbnZhc0Nzc0hlaWdodCA9IE1hdGgucm91bmQoYSAvIGcpLCB0aGlzLl9jYW52YXNDc3NPZmZzZXRYID0gMCwgdGhpcy5fY2FudmFzQ3NzT2Zmc2V0WSA9IE1hdGguZmxvb3IoKGIgLSB0aGlzLl9jYW52YXNDc3NIZWlnaHQpIC8gMikpOwogICAgICAgIHRoaXMuX2NhbnZhc0RldmljZVdpZHRoID0gTWF0aC5yb3VuZCh0aGlzLl9jYW52YXNDc3NXaWR0aCAqIGQpOwogICAgICAgIHRoaXMuX2NhbnZhc0RldmljZUhlaWdodCA9IE1hdGgucm91bmQodGhpcy5fY2FudmFzQ3NzSGVpZ2h0ICogZCk7CiAgICAgICAgdGhpcy5fcnVudGltZS5TZXRWaWV3cG9ydFNpemUoYywgZSkKICAgIH0KICAgIF9DYWxjdWxhdGVMZXR0ZXJib3hJbnRlZ2VyU2NhbGUoYSwgYikgewogICAgICAgIGNvbnN0IGQgPSB0aGlzLl9ydW50aW1lLkdldERldmljZVBpeGVsUmF0aW8oKTsKICAgICAgICAxICE9PSBkICYmIChhICs9IDEsIGIgKz0gMSk7CiAgICAgICAgY29uc3QgYyA9IHRoaXMuX3J1bnRpbWUuR2V0T3JpZ2luYWxWaWV3cG9ydFdpZHRoKCksCiAgICAgICAgICAgIGUgPSB0aGlzLl9ydW50aW1lLkdldE9yaWdpbmFsVmlld3BvcnRIZWlnaHQoKTsKICAgICAgICB2YXIgZyA9IGMgLyBlOwogICAgICAgIGcgPSBhIC8gYiA+IGcgPyBiICogZyAqIGQgLyBjIDogYSAvIGcgKiBkIC8gZTsKICAgICAgICAxIDwgZyA/IGcgPSBNYXRoLmZsb29yKGcpIDogMSA+IGcgJiYgKGcgPSAxIC8gTWF0aC5jZWlsKDEgLyBnKSk7CiAgICAgICAgdGhpcy5fY2FudmFzRGV2aWNlV2lkdGggPSBNYXRoLnJvdW5kKGMgKiBnKTsKICAgICAgICB0aGlzLl9jYW52YXNEZXZpY2VIZWlnaHQgPSBNYXRoLnJvdW5kKGUgKiBnKTsKICAgICAgICB0aGlzLl9jYW52YXNDc3NXaWR0aCA9IHRoaXMuX2NhbnZhc0RldmljZVdpZHRoIC8gZDsKICAgICAgICB0aGlzLl9jYW52YXNDc3NIZWlnaHQgPSB0aGlzLl9jYW52YXNEZXZpY2VIZWlnaHQgLyBkOwogICAgICAgIHRoaXMuX2NhbnZhc0Nzc09mZnNldFggPSBNYXRoLm1heChNYXRoLmZsb29yKChhIC0gdGhpcy5fY2FudmFzQ3NzV2lkdGgpIC8gMiksIDApOwogICAgICAgIHRoaXMuX2NhbnZhc0Nzc09mZnNldFkgPSBNYXRoLm1heChNYXRoLmZsb29yKChiIC0gdGhpcy5fY2FudmFzQ3NzSGVpZ2h0KSAvIDIpLCAwKTsKICAgICAgICB0aGlzLl9ydW50aW1lLlNldFZpZXdwb3J0U2l6ZShjLCBlKQogICAgfQogICAgX0NhbGN1bGF0ZUZ1bGxzaXplQ2FudmFzKGEsCiAgICAgICAgYikgewogICAgICAgIGNvbnN0IGQgPSB0aGlzLl9ydW50aW1lLkdldERldmljZVBpeGVsUmF0aW8oKTsKICAgICAgICB0aGlzLl9jYW52YXNDc3NXaWR0aCA9IGE7CiAgICAgICAgdGhpcy5fY2FudmFzQ3NzSGVpZ2h0ID0gYjsKICAgICAgICB0aGlzLl9jYW52YXNEZXZpY2VXaWR0aCA9IE1hdGgucm91bmQodGhpcy5fY2FudmFzQ3NzV2lkdGggKiBkKTsKICAgICAgICB0aGlzLl9jYW52YXNEZXZpY2VIZWlnaHQgPSBNYXRoLnJvdW5kKHRoaXMuX2NhbnZhc0Nzc0hlaWdodCAqIGQpOwogICAgICAgIHRoaXMuX2NhbnZhc0Nzc09mZnNldFkgPSB0aGlzLl9jYW52YXNDc3NPZmZzZXRYID0gMDsKICAgICAgICBhID0gdGhpcy5HZXREaXNwbGF5U2NhbGUoKTsKICAgICAgICB0aGlzLl9ydW50aW1lLlNldFZpZXdwb3J0U2l6ZSh0aGlzLl9jYW52YXNDc3NXaWR0aCAvIGEsIHRoaXMuX2NhbnZhc0Nzc0hlaWdodCAvIGEpCiAgICB9CiAgICBfQ2FsY3VsYXRlRml4ZWRTaXplQ2FudmFzKGEsIGIpIHsKICAgICAgICBjb25zdCBkID0gdGhpcy5fcnVudGltZS5HZXREZXZpY2VQaXhlbFJhdGlvKCk7CiAgICAgICAgdGhpcy5fY2FudmFzQ3NzV2lkdGggPSB0aGlzLl9ydW50aW1lLkdldFZpZXdwb3J0V2lkdGgoKTsKICAgICAgICB0aGlzLl9jYW52YXNDc3NIZWlnaHQgPQogICAgICAgICAgICB0aGlzLl9ydW50aW1lLkdldFZpZXdwb3J0SGVpZ2h0KCk7CiAgICAgICAgdGhpcy5fY2FudmFzRGV2aWNlV2lkdGggPSBNYXRoLnJvdW5kKHRoaXMuX2NhbnZhc0Nzc1dpZHRoICogZCk7CiAgICAgICAgdGhpcy5fY2FudmFzRGV2aWNlSGVpZ2h0ID0gTWF0aC5yb3VuZCh0aGlzLl9jYW52YXNDc3NIZWlnaHQgKiBkKTsKICAgICAgICB0aGlzLklzRG9jdW1lbnRGdWxsc2NyZWVuKCkgPyAodGhpcy5fY2FudmFzQ3NzT2Zmc2V0WCA9IE1hdGguZmxvb3IoKGEgLSB0aGlzLl9jYW52YXNDc3NXaWR0aCkgLyAyKSwgdGhpcy5fY2FudmFzQ3NzT2Zmc2V0WSA9IE1hdGguZmxvb3IoKGIgLSB0aGlzLl9jYW52YXNDc3NIZWlnaHQpIC8gMikpIDogdGhpcy5fY2FudmFzQ3NzT2Zmc2V0WSA9IHRoaXMuX2NhbnZhc0Nzc09mZnNldFggPSAwOwogICAgICAgIHRoaXMuX3J1bnRpbWUuU2V0Vmlld3BvcnRTaXplKHRoaXMuX3J1bnRpbWUuR2V0Vmlld3BvcnRXaWR0aCgpLCB0aGlzLl9ydW50aW1lLkdldFZpZXdwb3J0SGVpZ2h0KCkpCiAgICB9CiAgICBfVXBkYXRlRnVsbHNjcmVlblNjYWxpbmdRdWFsaXR5KGEpIHsKICAgICAgICBpZiAoImhpZ2giID09PQogICAgICAgICAgICB0aGlzLl93YW50RnVsbHNjcmVlblNjYWxpbmdRdWFsaXR5KSB0aGlzLl9kcmF3V2lkdGggPSB0aGlzLl9jYW52YXNEZXZpY2VXaWR0aCwgdGhpcy5fZHJhd0hlaWdodCA9IHRoaXMuX2NhbnZhc0RldmljZUhlaWdodCwgdGhpcy5fZnVsbHNjcmVlblNjYWxpbmdRdWFsaXR5ID0gImhpZ2giOwogICAgICAgIGVsc2UgewogICAgICAgICAgICBsZXQgZDsKICAgICAgICAgICAgaWYgKCJvZmYiID09PSB0aGlzLkdldEN1cnJlbnRGdWxsc2NyZWVuTW9kZSgpKSB7CiAgICAgICAgICAgICAgICB2YXIgYiA9IHRoaXMuX3J1bnRpbWUuR2V0Vmlld3BvcnRXaWR0aCgpOwogICAgICAgICAgICAgICAgZCA9IHRoaXMuX3J1bnRpbWUuR2V0Vmlld3BvcnRIZWlnaHQoKQogICAgICAgICAgICB9IGVsc2UgYiA9IHRoaXMuX3J1bnRpbWUuR2V0T3JpZ2luYWxWaWV3cG9ydFdpZHRoKCksIGQgPSB0aGlzLl9ydW50aW1lLkdldE9yaWdpbmFsVmlld3BvcnRIZWlnaHQoKTsKICAgICAgICAgICAgdGhpcy5fY2FudmFzRGV2aWNlV2lkdGggPCBiIHx8IHRoaXMuX2NhbnZhc0RldmljZUhlaWdodCA8IGQgPyAodGhpcy5fZHJhd1dpZHRoID0gdGhpcy5fY2FudmFzRGV2aWNlV2lkdGgsIHRoaXMuX2RyYXdIZWlnaHQgPSB0aGlzLl9jYW52YXNEZXZpY2VIZWlnaHQsCiAgICAgICAgICAgICAgICB0aGlzLl9mdWxsc2NyZWVuU2NhbGluZ1F1YWxpdHkgPSAiaGlnaCIpIDogKHRoaXMuX2RyYXdXaWR0aCA9IGIsIHRoaXMuX2RyYXdIZWlnaHQgPSBkLCB0aGlzLl9mdWxsc2NyZWVuU2NhbGluZ1F1YWxpdHkgPSAibG93IiwgInNjYWxlLWlubmVyIiA9PT0gYSA/IChhID0gYiAvIGQsIGIgPSB0aGlzLl93aW5kb3dJbm5lcldpZHRoIC8gdGhpcy5fd2luZG93SW5uZXJIZWlnaHQsIGIgPCBhID8gdGhpcy5fZHJhd1dpZHRoID0gdGhpcy5fZHJhd0hlaWdodCAqIGIgOiBiID4gYSAmJiAodGhpcy5fZHJhd0hlaWdodCA9IHRoaXMuX2RyYXdXaWR0aCAvIGIpKSA6ICJzY2FsZS1vdXRlciIgPT09IGEgJiYgKGEgPSBiIC8gZCwgYiA9IHRoaXMuX3dpbmRvd0lubmVyV2lkdGggLyB0aGlzLl93aW5kb3dJbm5lckhlaWdodCwgYiA+IGEgPyB0aGlzLl9kcmF3V2lkdGggPSB0aGlzLl9kcmF3SGVpZ2h0ICogYiA6IGIgPCBhICYmICh0aGlzLl9kcmF3SGVpZ2h0ID0gdGhpcy5fZHJhd1dpZHRoIC8gYikpKQogICAgICAgIH0KICAgIH0KICAgIEdldFJ1bnRpbWUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUKICAgIH0KICAgIEdldENhbnZhcygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fY2FudmFzCiAgICB9CiAgICBHZXRFZmZlY3RDaGFpbk1hbmFnZXIoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2VmZmVjdENoYWluTWFuYWdlcgogICAgfQogICAgSXNEb2N1bWVudEZ1bGxzY3JlZW4oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2lzRG9jdW1lbnRGdWxsc2NyZWVuCiAgICB9CiAgICBTZXRGdWxsc2NyZWVuTW9kZShhKSB7CiAgICAgICAgaWYgKCFWQUxJRF9GVUxMU0NSRUVOX01PREVTLmhhcyhhKSkgdGhyb3cgRXJyb3IoImludmFsaWQgZnVsbHNjcmVlbiBtb2RlIik7CiAgICAgICAgdGhpcy5fZnVsbHNjcmVlbk1vZGUgPSBhOwogICAgICAgIGEgPSB0aGlzLl9ydW50aW1lLkdldExheW91dE1hbmFnZXIoKTsKICAgICAgICBhLlNldEFsbExheWVyUHJvamVjdGlvbkNoYW5nZWQoKTsKICAgICAgICBhLlNldEFsbExheWVyTVZDaGFuZ2VkKCkKICAgIH0KICAgIEdldEZ1bGxzY3JlZW5Nb2RlKCkgewogICAgICAgIHJldHVybiB0aGlzLl9mdWxsc2NyZWVuTW9kZQogICAgfQogICAgU2V0RG9jdW1lbnRGdWxsc2NyZWVuTW9kZShhKSB7CiAgICAgICAgaWYgKCFWQUxJRF9GVUxMU0NSRUVOX01PREVTLmhhcyhhKSkgdGhyb3cgRXJyb3IoImludmFsaWQgZnVsbHNjcmVlbiBtb2RlIik7CiAgICAgICAgdGhpcy5fZG9jdW1lbnRGdWxsc2NyZWVuTW9kZSA9IGE7CiAgICAgICAgYSA9IHRoaXMuX3J1bnRpbWUuR2V0TGF5b3V0TWFuYWdlcigpOwogICAgICAgIGEuU2V0QWxsTGF5ZXJQcm9qZWN0aW9uQ2hhbmdlZCgpOwogICAgICAgIGEuU2V0QWxsTGF5ZXJNVkNoYW5nZWQoKQogICAgfQogICAgR2V0RG9jdW1lbnRGdWxsc2NyZWVuTW9kZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZG9jdW1lbnRGdWxsc2NyZWVuTW9kZQogICAgfQogICAgR2V0Q3VycmVudEZ1bGxzY3JlZW5Nb2RlKCkgewogICAgICAgIHJldHVybiB0aGlzLklzRG9jdW1lbnRGdWxsc2NyZWVuKCkgPwogICAgICAgICAgICB0aGlzLkdldERvY3VtZW50RnVsbHNjcmVlbk1vZGUoKSA6IHRoaXMuR2V0RnVsbHNjcmVlbk1vZGUoKQogICAgfQogICAgU2V0RnVsbHNjcmVlblNjYWxpbmdRdWFsaXR5KGEpIHsKICAgICAgICBpZiAoIVZBTElEX0ZVTExTQ1JFRU5fU0NBTElOR19RVUFMSVRJRVMuaGFzKGEpKSB0aHJvdyBFcnJvcigiaW52YWxpZCBmdWxsc2NyZWVuIHNjYWxpbmcgcXVhbGl0eSIpOwogICAgICAgIHRoaXMuX3dhbnRGdWxsc2NyZWVuU2NhbGluZ1F1YWxpdHkgPSBhOwogICAgICAgIHRoaXMuX3J1bnRpbWUuR2V0TGF5b3V0TWFuYWdlcigpLlNldEFsbExheWVyUHJvamVjdGlvbkNoYW5nZWQoKQogICAgfQogICAgR2V0U2V0RnVsbHNjcmVlblNjYWxpbmdRdWFsaXR5KCkgewogICAgICAgIHJldHVybiB0aGlzLl93YW50RnVsbHNjcmVlblNjYWxpbmdRdWFsaXR5CiAgICB9CiAgICBHZXRDdXJyZW50RnVsbHNjcmVlblNjYWxpbmdRdWFsaXR5KCkgewogICAgICAgIHJldHVybiB0aGlzLl9mdWxsc2NyZWVuU2NhbGluZ1F1YWxpdHkKICAgIH0KICAgIHN0YXRpYyBfRnVsbHNjcmVlbk1vZGVOdW1iZXJUb1N0cmluZyhhKSB7CiAgICAgICAgc3dpdGNoIChhKSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIHJldHVybiAib2ZmIjsKICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgcmV0dXJuICJjcm9wIjsKICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgcmV0dXJuICJzY2FsZS1pbm5lciI7CiAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgIHJldHVybiAic2NhbGUtb3V0ZXIiOwogICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICByZXR1cm4gImxldHRlcmJveC1zY2FsZSI7CiAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgIHJldHVybiAibGV0dGVyYm94LWludGVnZXItc2NhbGUiOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgdGhyb3cgRXJyb3IoImludmFsaWQgZnVsbHNjcmVlbiBtb2RlIik7CiAgICAgICAgfQogICAgfQogICAgR2V0TGFzdFdpZHRoKCkgewogICAgICAgIHJldHVybiB0aGlzLl93aW5kb3dJbm5lcldpZHRoCiAgICB9CiAgICBHZXRMYXN0SGVpZ2h0KCkgewogICAgICAgIHJldHVybiB0aGlzLl93aW5kb3dJbm5lckhlaWdodAogICAgfQogICAgR2V0RHJhd1dpZHRoKCkgewogICAgICAgIHJldHVybiB0aGlzLl9kcmF3V2lkdGgKICAgIH0KICAgIEdldERyYXdIZWlnaHQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2RyYXdIZWlnaHQKICAgIH0KICAgIFNldE1pcG1hcHNFbmFibGVkKGEpIHsKICAgICAgICB0aGlzLl9lbmFibGVNaXBtYXBzID0gISFhCiAgICB9CiAgICBfU2V0VGV4dHVyZUFuaXNvdHJvcHkoYSkgewogICAgICAgIHRoaXMuX3RleHR1cmVBbmlzb3Ryb3B5ID0gYQogICAgfQogICAgR2V0VGV4dHVyZUFuaXNvdHJvcHkoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3RleHR1cmVBbmlzb3Ryb3B5CiAgICB9CiAgICBJc1JlbmRlcmVyQ29udGV4dExvc3QoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuR2V0UmVuZGVyZXIoKS5Jc0NvbnRleHRMb3N0KCkKICAgIH0KICAgIF9PbldlYkdMQ29udGV4dExvc3QoYSkgewogICAgICAgIGNvbnNvbGUubG9nKCJbQ29uc3RydWN0XSBXZWJHTCBjb250ZXh0IGxvc3QiKTsKICAgICAgICBhLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgdGhpcy5fYXZhaWxhYmxlQWRkaXRpb25hbFJlbmRlclRhcmdldHMgPSBbXTsKICAgICAgICB0aGlzLl91c2VkQWRkaXRpb25hbFJlbmRlclRhcmdldHMuY2xlYXIoKTsKICAgICAgICB0aGlzLl93ZWJnbFJlbmRlcmVyLk9uQ29udGV4dExvc3QoKTsKICAgICAgICB0aGlzLl9ydW50aW1lLl9PbldlYkdMQ29udGV4dExvc3QoKQogICAgfQogICAgYXN5bmMgX09uV2ViR0xDb250ZXh0UmVzdG9yZWQoYSkgewogICAgICAgIGF3YWl0IHRoaXMuX3dlYmdsUmVuZGVyZXIuT25Db250ZXh0UmVzdG9yZWQoKTsKICAgICAgICBhd2FpdCB0aGlzLl9Mb2FkV2ViR0xTaGFkZXJQcm9ncmFtcygpOwogICAgICAgIGZvciAoY29uc3QgYiBvZiB0aGlzLl9ydW50aW1lLl9HZXRBbGxFZmZlY3RMaXN0cygpKSB7CiAgICAgICAgICAgIGZvciAoY29uc3QgZCBvZiBiLkdldEFsbEVmZmVjdFR5cGVzKCkpIGQuX0luaXRSZW5kZXJlcih0aGlzLl93ZWJnbFJlbmRlcmVyKTsKICAgICAgICAgICAgYi5fSW5pdFJlbmRlcmVyKHRoaXMuX3dlYmdsUmVuZGVyZXIpCiAgICAgICAgfQogICAgICAgIGF3YWl0IHRoaXMuX3J1bnRpbWUuX09uV2ViR0xDb250ZXh0UmVzdG9yZWQoKTsKICAgICAgICBjb25zb2xlLmxvZygiW0NvbnN0cnVjdF0gV2ViR0wgY29udGV4dCByZXN0b3JlZCIpCiAgICB9CiAgICBHZXRXZWJHTFJlbmRlcmVyKCkgewogICAgICAgIHJldHVybiB0aGlzLl93ZWJnbFJlbmRlcmVyCiAgICB9CiAgICBHZXRXZWJHUFVSZW5kZXJlcigpIHsKICAgICAgICByZXR1cm4gdGhpcy5fd2ViZ3B1UmVuZGVyZXIKICAgIH0KICAgIEdldFJlbmRlcmVyKCkgewogICAgICAgIHJldHVybiB0aGlzLl93ZWJncHVSZW5kZXJlciB8fAogICAgICAgICAgICB0aGlzLl93ZWJnbFJlbmRlcmVyCiAgICB9CiAgICBHZXRSZW5kZXJTY2FsZSgpIHsKICAgICAgICByZXR1cm4gImxvdyIgPT09IHRoaXMuX2Z1bGxzY3JlZW5TY2FsaW5nUXVhbGl0eSA/IDEgLyB0aGlzLl9ydW50aW1lLkdldERldmljZVBpeGVsUmF0aW8oKSA6IHRoaXMuR2V0RGlzcGxheVNjYWxlKCkKICAgIH0KICAgIEdldERpc3BsYXlTY2FsZSgpIHsKICAgICAgICBjb25zdCBhID0gdGhpcy5HZXRDdXJyZW50RnVsbHNjcmVlbk1vZGUoKTsKICAgICAgICBpZiAoIm9mZiIgPT09IGEgfHwgImNyb3AiID09PSBhKSByZXR1cm4gMTsKICAgICAgICBjb25zdCBiID0gdGhpcy5fcnVudGltZS5HZXRPcmlnaW5hbFZpZXdwb3J0V2lkdGgoKSwKICAgICAgICAgICAgZCA9IHRoaXMuX3J1bnRpbWUuR2V0T3JpZ2luYWxWaWV3cG9ydEhlaWdodCgpLAogICAgICAgICAgICBjID0gYiAvIGQsCiAgICAgICAgICAgIGUgPSB0aGlzLl9jYW52YXNEZXZpY2VXaWR0aCAvIHRoaXMuX2NhbnZhc0RldmljZUhlaWdodDsKICAgICAgICByZXR1cm4gInNjYWxlLWlubmVyIiAhPT0gYSAmJiBlID4gYyB8fCAic2NhbGUtaW5uZXIiID09PSBhICYmIGUgPCBjID8gdGhpcy5fY2FudmFzQ3NzSGVpZ2h0IC8gZCA6IHRoaXMuX2NhbnZhc0Nzc1dpZHRoIC8gYgogICAgfQogICAgR2V0RWZmZWN0TGF5ZXJTY2FsZVBhcmFtKCkgewogICAgICAgIHJldHVybiAibG93IiA9PT0KICAgICAgICAgICAgdGhpcy5HZXRDdXJyZW50RnVsbHNjcmVlblNjYWxpbmdRdWFsaXR5KCkgPyAxIDogdGhpcy5HZXREaXNwbGF5U2NhbGUoKQogICAgfQogICAgR2V0RWZmZWN0RGV2aWNlUGl4ZWxSYXRpb1BhcmFtKCkgewogICAgICAgIHJldHVybiAibG93IiA9PT0gdGhpcy5HZXRDdXJyZW50RnVsbHNjcmVlblNjYWxpbmdRdWFsaXR5KCkgPyAxIDogdGhpcy5fcnVudGltZS5HZXREZXZpY2VQaXhlbFJhdGlvKCkKICAgIH0KICAgIFNldERldmljZVRyYW5zZm9ybU9mZnNldChhLCBiKSB7CiAgICAgICAgdGhpcy5fZGV2aWNlVHJhbnNmb3JtT2ZmWCA9IGE7CiAgICAgICAgdGhpcy5fZGV2aWNlVHJhbnNmb3JtT2ZmWSA9IGIKICAgIH0KICAgIFNldERldmljZVRyYW5zZm9ybShhLCBiLCBkLCBjID0gITApIHsKICAgICAgICBiID0gYiB8fCB0aGlzLl9kcmF3V2lkdGg7CiAgICAgICAgZCA9IGQgfHwgdGhpcy5fZHJhd0hlaWdodDsKICAgICAgICBjb25zdCBlID0gYiAvIDIgKyB0aGlzLl9kZXZpY2VUcmFuc2Zvcm1PZmZYLAogICAgICAgICAgICBnID0gZCAvIDIgKyB0aGlzLl9kZXZpY2VUcmFuc2Zvcm1PZmZZOwogICAgICAgIGlmIChjKSB7CiAgICAgICAgICAgIGMgPSB0aGlzLkdldERlZmF1bHRQcm9qZWN0aW9uTWF0cml4KCk7CiAgICAgICAgICAgIGlmIChiICE9PSB0aGlzLl9kcmF3V2lkdGggfHwgZCAhPT0gdGhpcy5fZHJhd0hlaWdodCkgYS5DYWxjdWxhdGVQZXJzcGVjdGl2ZU1hdHJpeCh0ZW1wUHJvamVjdGlvbiwKICAgICAgICAgICAgICAgIGIgLyBkKSwgYyA9IHRlbXBQcm9qZWN0aW9uOwogICAgICAgICAgICBhLlNldFByb2plY3Rpb25NYXRyaXgoYykKICAgICAgICB9CiAgICAgICAgYiA9IGEuQ2FsY3VsYXRlTG9va0F0TW9kZWxWaWV3MihlLCBnLCBhLkdldERlZmF1bHRDYW1lcmFaKGQpLCBlLCBnLCAwLCBkKTsKICAgICAgICBhLlNldE1vZGVsVmlld01hdHJpeChiKQogICAgfQogICAgU2V0Q3NzVHJhbnNmb3JtKGEsIGIgPSAhMCkgewogICAgICAgIHZhciBkID0gdGhpcy5HZXRDc3NXaWR0aCgpOwogICAgICAgIGNvbnN0IGMgPSB0aGlzLkdldENzc0hlaWdodCgpOwogICAgICAgIGQgLz0gMjsKICAgICAgICBjb25zdCBlID0gYyAvIDI7CiAgICAgICAgYiAmJiBhLlNldFByb2plY3Rpb25NYXRyaXgodGhpcy5HZXREZWZhdWx0UHJvamVjdGlvbk1hdHJpeCgpKTsKICAgICAgICBiID0gYS5DYWxjdWxhdGVMb29rQXRNb2RlbFZpZXcyKGQsIGUsIGEuR2V0RGVmYXVsdENhbWVyYVooYyksIGQsIGUsIDAsIGMpOwogICAgICAgIGEuU2V0TW9kZWxWaWV3TWF0cml4KGIpCiAgICB9CiAgICBHZXREZXZpY2VXaWR0aCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fY2FudmFzRGV2aWNlV2lkdGgKICAgIH0KICAgIEdldERldmljZUhlaWdodCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fY2FudmFzRGV2aWNlSGVpZ2h0CiAgICB9CiAgICBHZXRDc3NXaWR0aCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fY2FudmFzQ3NzV2lkdGgKICAgIH0KICAgIEdldENzc0hlaWdodCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fY2FudmFzQ3NzSGVpZ2h0CiAgICB9CiAgICBHZXRDYW52YXNDbGllbnRYKCkgewogICAgICAgIHJldHVybiB0aGlzLl9jYW52YXNDc3NPZmZzZXRYCiAgICB9CiAgICBHZXRDYW52YXNDbGllbnRZKCkgewogICAgICAgIHJldHVybiB0aGlzLl9jYW52YXNDc3NPZmZzZXRZCiAgICB9CiAgICBHZXRBZGRpdGlvbmFsUmVuZGVyVGFyZ2V0KGEpIHsKICAgICAgICBhLmRlcHRoID0KICAgICAgICAgICAgdGhpcy5fcnVudGltZS5Vc2VzM0RGZWF0dXJlcygpOwogICAgICAgIGNvbnN0IGIgPSB0aGlzLl9hdmFpbGFibGVBZGRpdGlvbmFsUmVuZGVyVGFyZ2V0cywKICAgICAgICAgICAgZCA9IGIuZmluZEluZGV4KGUgPT4gZS5Jc0NvbXBhdGlibGVXaXRoT3B0aW9ucyhhKSk7CiAgICAgICAgbGV0IGM7IC0gMSAhPT0gZCA/IChjID0gYltkXSwgYi5zcGxpY2UoZCwgMSkpIDogYyA9IHRoaXMuR2V0UmVuZGVyZXIoKS5DcmVhdGVSZW5kZXJUYXJnZXQoYSk7CiAgICAgICAgdGhpcy5fdXNlZEFkZGl0aW9uYWxSZW5kZXJUYXJnZXRzLmFkZChjKTsKICAgICAgICByZXR1cm4gYwogICAgfQogICAgUmVsZWFzZUFkZGl0aW9uYWxSZW5kZXJUYXJnZXQoYSkgewogICAgICAgIGlmICghdGhpcy5fdXNlZEFkZGl0aW9uYWxSZW5kZXJUYXJnZXRzLmhhcyhhKSkgdGhyb3cgRXJyb3IoInJlbmRlciB0YXJnZXQgbm90IGluIHVzZSIpOwogICAgICAgIHRoaXMuX3VzZWRBZGRpdGlvbmFsUmVuZGVyVGFyZ2V0cy5kZWxldGUoYSk7CiAgICAgICAgdGhpcy5fYXZhaWxhYmxlQWRkaXRpb25hbFJlbmRlclRhcmdldHMucHVzaChhKQogICAgfQogICAgR2V0RWZmZWN0Q29tcG9zaXRvclJlbmRlclRhcmdldCgpIHsKICAgICAgICBjb25zdCBhID0gewogICAgICAgICAgICBzYW1wbGluZzogdGhpcy5fcnVudGltZS5HZXRTYW1wbGluZygpCiAgICAgICAgfTsKICAgICAgICAibG93IiA9PT0gdGhpcy5HZXRDdXJyZW50RnVsbHNjcmVlblNjYWxpbmdRdWFsaXR5KCkgJiYgKGEud2lkdGggPSB0aGlzLkdldERyYXdXaWR0aCgpLCBhLmhlaWdodCA9IHRoaXMuR2V0RHJhd0hlaWdodCgpKTsKICAgICAgICByZXR1cm4gdGhpcy5HZXRBZGRpdGlvbmFsUmVuZGVyVGFyZ2V0KGEpCiAgICB9CiAgICBSZWxlYXNlRWZmZWN0Q29tcG9zaXRvclJlbmRlclRhcmdldChhKSB7CiAgICAgICAgdGhpcy5SZWxlYXNlQWRkaXRpb25hbFJlbmRlclRhcmdldChhKQogICAgfSogYWN0aXZlTGF5ZXJzR3B1UHJvZmlsZXMoKSB7CiAgICAgICAgZm9yIChjb25zdCBhIG9mIHRoaXMuX3J1bnRpbWUuR2V0TGF5b3V0TWFuYWdlcigpLnJ1bm5pbmdMYXlvdXRzKCkpCiAgICAgICAgICAgIGZvciAoY29uc3QgYiBvZiBhLkdldExheWVycygpKSB7CiAgICAgICAgICAgICAgICBjb25zdCBkID0gdGhpcy5fbGF5ZXJzR3B1UHJvZmlsZS5nZXQoYik7CiAgICAgICAgICAgICAgICBkICYmICh5aWVsZCBkKQogICAgICAgICAgICB9CiAgICB9CiAgICBHZXRMYXllclRpbWluZ3NCdWZmZXIoYSkgewogICAgICAgIGlmICghdGhpcy5HZXRSZW5kZXJlcigpLlN1cHBvcnRzR1BVUHJvZmlsaW5nKCkpIHJldHVybiBudWxsOwogICAgICAgIGxldCBiID0gdGhpcy5fbGF5ZXJzR3B1UHJvZmlsZS5nZXQoYSk7CiAgICAgICAgYiB8fCAoYiA9IHsKICAgICAgICAgICAgbmFtZTogYS5HZXROYW1lKCksCiAgICAgICAgICAgIHRpbWluZ3NCdWZmZXI6IEMzJGpzY29tcCQxNjkuTmV3KEMzJGpzY29tcCQxNjkuR2Z4LldlYkdMUXVlcnlSZXN1bHRCdWZmZXIsIHRoaXMuX3dlYmdsUmVuZGVyZXIpLAogICAgICAgICAgICBjdXJVdGlsaXNhdGlvbjogMCwKICAgICAgICAgICAgbGFzdFV0aWxpc2F0aW9uOiAwCiAgICAgICAgfSwgdGhpcy5fbGF5ZXJzR3B1UHJvZmlsZS5zZXQoYSwgYikpOwogICAgICAgIHJldHVybiBiLnRpbWluZ3NCdWZmZXIKICAgIH0KICAgIF9VcGRhdGUxc0ZyYW1lUmFuZ2UoKSB7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuR2V0UmVuZGVyZXIoKTsKICAgICAgICBpZiAoYS5TdXBwb3J0c0dQVVByb2ZpbGluZygpICYmIDAgPT09IHRoaXMuX2dwdVRpbWVFbmRGcmFtZSkgewogICAgICAgICAgICB0aGlzLl9ncHVUaW1lRW5kRnJhbWUgPSBhLkdldEZyYW1lTnVtYmVyKCk7CiAgICAgICAgICAgIHRoaXMuX2dwdUN1clV0aWxpc2F0aW9uID0gTmFOOwogICAgICAgICAgICBmb3IgKGNvbnN0IGIgb2YgdGhpcy5hY3RpdmVMYXllcnNHcHVQcm9maWxlcygpKSBiLmN1clV0aWxpc2F0aW9uID0gTmFOCiAgICAgICAgfQogICAgfQogICAgX1VwZGF0ZVRpY2soKSB7CiAgICAgICAgdGhpcy5fd2ViZ2xSZW5kZXJlciAmJgogICAgICAgICAgICB0aGlzLl93ZWJnbFJlbmRlcmVyLlN1cHBvcnRzR1BVUHJvZmlsaW5nKCkgJiYgdGhpcy5fVXBkYXRlVGlja19XZWJHTCgpOwogICAgICAgIHRoaXMuX3dlYmdwdVJlbmRlcmVyICYmIHRoaXMuX3dlYmdwdVJlbmRlcmVyLlN1cHBvcnRzR1BVUHJvZmlsaW5nKCkgJiYgdGhpcy5fVXBkYXRlVGlja19XZWJHUFUoKQogICAgfQogICAgX1VwZGF0ZVRpY2tfV2ViR0woKSB7CiAgICAgICAgaWYgKGlzTmFOKHRoaXMuX2dwdUN1clV0aWxpc2F0aW9uKSAmJiAodGhpcy5fZ3B1Q3VyVXRpbGlzYXRpb24gPSB0aGlzLl9ncHVGcmFtZVRpbWluZ3NCdWZmZXIuR2V0RnJhbWVSYW5nZVJlc3VsdFN1bSh0aGlzLl9ncHVUaW1lU3RhcnRGcmFtZSwgdGhpcy5fZ3B1VGltZUVuZEZyYW1lKSwgIWlzTmFOKHRoaXMuX2dwdUN1clV0aWxpc2F0aW9uKSkpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX3J1bnRpbWUuSXNEZWJ1ZygpKQogICAgICAgICAgICAgICAgZm9yIChjb25zdCBhIG9mIHRoaXMuYWN0aXZlTGF5ZXJzR3B1UHJvZmlsZXMoKSkKICAgICAgICAgICAgICAgICAgICBpZiAoYS5jdXJVdGlsaXNhdGlvbiA9IGEudGltaW5nc0J1ZmZlci5HZXRGcmFtZVJhbmdlUmVzdWx0U3VtKHRoaXMuX2dwdVRpbWVTdGFydEZyYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fZ3B1VGltZUVuZEZyYW1lKSwgaXNOYU4oYS5jdXJVdGlsaXNhdGlvbikpIHJldHVybjsKICAgICAgICAgICAgdGhpcy5fZ3B1RnJhbWVUaW1pbmdzQnVmZmVyLkRlbGV0ZUFsbEJlZm9yZUZyYW1lTnVtYmVyKHRoaXMuX2dwdVRpbWVFbmRGcmFtZSk7CiAgICAgICAgICAgIHRoaXMuX2dwdUxhc3RVdGlsaXNhdGlvbiA9IE1hdGgubWluKHRoaXMuX2dwdUN1clV0aWxpc2F0aW9uLCAxKTsKICAgICAgICAgICAgaWYgKHRoaXMuX3J1bnRpbWUuSXNEZWJ1ZygpKSB7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGEgb2YgdGhpcy5hY3RpdmVMYXllcnNHcHVQcm9maWxlcygpKSBhLnRpbWluZ3NCdWZmZXIuRGVsZXRlQWxsQmVmb3JlRnJhbWVOdW1iZXIodGhpcy5fZ3B1VGltZUVuZEZyYW1lKSwgYS5sYXN0VXRpbGlzYXRpb24gPSBNYXRoLm1pbihhLmN1clV0aWxpc2F0aW9uLCAxKTsKICAgICAgICAgICAgICAgIHNlbGYuQzNEZWJ1Z2dlci5VcGRhdGVHUFVQcm9maWxlKHRoaXMuX2dwdUxhc3RVdGlsaXNhdGlvbiwgWy4uLnRoaXMuYWN0aXZlTGF5ZXJzR3B1UHJvZmlsZXMoKV0pCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5fZ3B1VGltZVN0YXJ0RnJhbWUgPSB0aGlzLl9ncHVUaW1lRW5kRnJhbWU7CiAgICAgICAgICAgIHRoaXMuX2dwdVRpbWVFbmRGcmFtZSA9IDAKICAgICAgICB9CiAgICB9CiAgICBHZXRHUFVGcmFtZVRpbWluZ3NCdWZmZXIoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2dwdUZyYW1lVGltaW5nc0J1ZmZlcgogICAgfQogICAgX1VwZGF0ZVRpY2tfV2ViR1BVKCkgewogICAgICAgIGlmICgwICE9PSB0aGlzLl9ncHVUaW1lRW5kRnJhbWUpIHsKICAgICAgICAgICAgZm9yICh2YXIgYSA9IHRoaXMuX2dwdVRpbWVTdGFydEZyYW1lOyBhIDwgdGhpcy5fZ3B1VGltZUVuZEZyYW1lOyArK2EpIHsKICAgICAgICAgICAgICAgIHZhciBiID0gdGhpcy5fd2ViZ3B1RnJhbWVUaW1pbmdzLmdldChhKTsKICAgICAgICAgICAgICAgIGlmIChiICYmICFiLkhhc1Jlc3VsdCgpKSByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBiID0gdGhpcy5fcnVudGltZS5HZXRNYWluUnVubmluZ0xheW91dCgpOwogICAgICAgICAgICBhID0gQzMkanNjb21wJDE2OS5NYWtlRmlsbGVkQXJyYXkoYi5HZXRMYXllckNvdW50KCkgKyAxLCAwKTsKICAgICAgICAgICAgZm9yICh2YXIgZCA9IHRoaXMuX2dwdVRpbWVTdGFydEZyYW1lOyBkIDwgdGhpcy5fZ3B1VGltZUVuZEZyYW1lOyArK2QpIHsKICAgICAgICAgICAgICAgIHZhciBjID0gdGhpcy5fd2ViZ3B1RnJhbWVUaW1pbmdzLmdldChkKTsKICAgICAgICAgICAgICAgIGlmIChjKSB7CiAgICAgICAgICAgICAgICAgICAgYyA9IGMuR2V0UmVzdWx0KCk7CiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgZSA9IDAsIGcgPSBNYXRoLm1pbihhLmxlbmd0aCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMubGVuZ3RoIC8gMik7IGUgPCBnOyArK2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgayA9IGNbMiAqIGVdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbSA9IGNbMiAqIGUgKyAxXTsKICAgICAgICAgICAgICAgICAgICAgICAgYVtlXSA9IDAgPT09IE51bWJlcihrKSB8fCAwID09PSBOdW1iZXIobSkgPyBOYU4gOiBhW2VdICsgTnVtYmVyKG0gLSBrKSAvIDFFOQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLl9ncHVMYXN0VXRpbGlzYXRpb24gPSBDMyRqc2NvbXAkMTY5LmNsYW1wKGFbMF0sIDAsIDEpOwogICAgICAgICAgICBpZiAodGhpcy5fcnVudGltZS5Jc0RlYnVnKCkpIHsKICAgICAgICAgICAgICAgIGQgPSBbXTsKICAgICAgICAgICAgICAgIGIgPSBiLkdldExheWVycygpOwogICAgICAgICAgICAgICAgZm9yIChsZXQgZSA9IDAsIGcgPSBNYXRoLm1pbihiLmxlbmd0aCwgYS5sZW5ndGggLSAxKTsgZSA8IGc7ICsrZSkgZC5wdXNoKHsKICAgICAgICAgICAgICAgICAgICBuYW1lOiBiW2VdLkdldE5hbWUoKSwKICAgICAgICAgICAgICAgICAgICBsYXN0VXRpbGlzYXRpb246IEMzJGpzY29tcCQxNjkuY2xhbXAoYVtlICsgMV0sIDAsIDEpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHNlbGYuQzNEZWJ1Z2dlci5VcGRhdGVHUFVQcm9maWxlKHRoaXMuX2dwdUxhc3RVdGlsaXNhdGlvbiwgZCkKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IgKGEgPSB0aGlzLl9ncHVUaW1lU3RhcnRGcmFtZTsgYSA8IHRoaXMuX2dwdVRpbWVFbmRGcmFtZTsgKythKSB0aGlzLl93ZWJncHVGcmFtZVRpbWluZ3MuZGVsZXRlKGEpOwogICAgICAgICAgICB0aGlzLl9ncHVUaW1lU3RhcnRGcmFtZSA9CiAgICAgICAgICAgICAgICB0aGlzLl9ncHVUaW1lRW5kRnJhbWU7CiAgICAgICAgICAgIHRoaXMuX2dwdVRpbWVFbmRGcmFtZSA9IDAKICAgICAgICB9CiAgICB9CiAgICBfQWRkV2ViR1BVRnJhbWVUaW1pbmcoYSkgewogICAgICAgIHRoaXMuX3dlYmdwdUZyYW1lVGltaW5ncy5zZXQodGhpcy5fd2ViZ3B1UmVuZGVyZXIuR2V0RnJhbWVOdW1iZXIoKSwgYSkKICAgIH0KICAgIEdldEdQVVV0aWxpc2F0aW9uKCkgewogICAgICAgIHJldHVybiB0aGlzLl9ncHVMYXN0VXRpbGlzYXRpb24KICAgIH0KICAgIFNuYXBzaG90Q2FudmFzKGEsIGIsIGQsIGMsIGUsIGcpIHsKICAgICAgICB0aGlzLl9zbmFwc2hvdEZvcm1hdCA9IGE7CiAgICAgICAgdGhpcy5fc25hcHNob3RRdWFsaXR5ID0gYjsKICAgICAgICB0aGlzLl9zbmFwc2hvdEFyZWEuc2V0V0goZCwgYywgZSwgZyk7CiAgICAgICAgcmV0dXJuIHRoaXMuX3NuYXBzaG90UHJvbWlzZSA/IHRoaXMuX3NuYXBzaG90UHJvbWlzZSA6IHRoaXMuX3NuYXBzaG90UHJvbWlzZSA9IG5ldyBQcm9taXNlKGsgPT4gewogICAgICAgICAgICB0aGlzLl9zbmFwc2hvdFJlc29sdmUgPSBrCiAgICAgICAgfSkKICAgIH0KICAgIF9NYXliZVRha2VTbmFwc2hvdCgpIHsKICAgICAgICBpZiAodGhpcy5fc25hcHNob3RGb3JtYXQpIHsKICAgICAgICAgICAgdmFyIGEgPSB0aGlzLl9jYW52YXMsCiAgICAgICAgICAgICAgICBiID0gdGhpcy5fc25hcHNob3RBcmVhLAogICAgICAgICAgICAgICAgZCA9IEMzJGpzY29tcCQxNjkuY2xhbXAoTWF0aC5mbG9vcihiLmdldExlZnQoKSksIDAsIGEud2lkdGgpLAogICAgICAgICAgICAgICAgYyA9IEMzJGpzY29tcCQxNjkuY2xhbXAoTWF0aC5mbG9vcihiLmdldFRvcCgpKSwgMCwgYS5oZWlnaHQpLAogICAgICAgICAgICAgICAgZSA9IGIud2lkdGgoKTsKICAgICAgICAgICAgZSA9IDAgPT09IGUgPyBhLndpZHRoIC0gZCA6IEMzJGpzY29tcCQxNjkuY2xhbXAoTWF0aC5mbG9vcihlKSwgMCwgYS53aWR0aCAtIGQpOwogICAgICAgICAgICBiID0gYi5oZWlnaHQoKTsKICAgICAgICAgICAgYiA9IDAgPT09IGIgPyBhLmhlaWdodCAtIGMgOiBDMyRqc2NvbXAkMTY5LmNsYW1wKE1hdGguZmxvb3IoYiksIDAsIGEuaGVpZ2h0IC0gYyk7CiAgICAgICAgICAgICgwICE9PSBkIHx8IDAgIT09IGMgfHwgZSAhPT0gYS53aWR0aCB8fCBiICE9PSBhLmhlaWdodCkgJiYgMCA8IGUgJiYgMCA8IGIgJiYgKGEgPSBDMyRqc2NvbXAkMTY5LkNyZWF0ZUNhbnZhcyhlLCBiKSwgYS5nZXRDb250ZXh0KCIyZCIpLmRyYXdJbWFnZSh0aGlzLl9jYW52YXMsIGQsIGMsIGUsIGIsIDAsIDAsIGUsIGIpKTsKICAgICAgICAgICAgQzMkanNjb21wJDE2OS5DYW52YXNUb0Jsb2IoYSwgdGhpcy5fc25hcHNob3RGb3JtYXQsIHRoaXMuX3NuYXBzaG90UXVhbGl0eSkudGhlbihnID0+IHsKICAgICAgICAgICAgICAgIHRoaXMuX3NuYXBzaG90VXJsICYmCiAgICAgICAgICAgICAgICAgICAgVVJMLnJldm9rZU9iamVjdFVSTCh0aGlzLl9zbmFwc2hvdFVybCk7CiAgICAgICAgICAgICAgICB0aGlzLl9zbmFwc2hvdFVybCA9IFVSTC5jcmVhdGVPYmplY3RVUkwoZyk7CiAgICAgICAgICAgICAgICB0aGlzLl9zbmFwc2hvdFByb21pc2UgPSBudWxsOwogICAgICAgICAgICAgICAgdGhpcy5fc25hcHNob3RSZXNvbHZlKHRoaXMuX3NuYXBzaG90VXJsKQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdGhpcy5fc25hcHNob3RGb3JtYXQgPSAiIjsKICAgICAgICAgICAgdGhpcy5fc25hcHNob3RRdWFsaXR5ID0gMQogICAgICAgIH0KICAgIH0KICAgIEdldENhbnZhc1NuYXBzaG90VXJsKCkgewogICAgICAgIHJldHVybiB0aGlzLl9zbmFwc2hvdFVybAogICAgfQogICAgU2V0SXNQYXN0aW5nVG9EcmF3aW5nQ2FudmFzKGEpIHsKICAgICAgICBhID8gdGhpcy5faXNQYXN0aW5nVG9EcmF3aW5nQ2FudmFzKysgOiB0aGlzLl9pc1Bhc3RpbmdUb0RyYXdpbmdDYW52YXMtLQogICAgfQogICAgSXNQYXN0aW5nVG9EcmF3aW5nQ2FudmFzKCkgewogICAgICAgIHJldHVybiAwIDwgdGhpcy5faXNQYXN0aW5nVG9EcmF3aW5nQ2FudmFzCiAgICB9CiAgICBJbml0TG9hZGluZ1NjcmVlbihhKSB7CiAgICAgICAgdGhpcy5fd2ViZ2xSZW5kZXJlciAmJiAoMiA9PT0gYSA/ICh0aGlzLl9wZXJjZW50VGV4dCA9IEMzJGpzY29tcCQxNjkuTmV3KEMzJGpzY29tcCQxNjkuR2Z4LlJlbmRlcmVyVGV4dCwKICAgICAgICAgICAgdGhpcy5HZXRSZW5kZXJlcigpKSwgdGhpcy5fcGVyY2VudFRleHQuU2V0SXNBc3luYyghMSksIHRoaXMuX3BlcmNlbnRUZXh0LlNldEZvbnROYW1lKCJBcmlhbCIpLCB0aGlzLl9wZXJjZW50VGV4dC5TZXRGb250U2l6ZSgxNiksIHRoaXMuX3BlcmNlbnRUZXh0LlNldEhvcml6b250YWxBbGlnbm1lbnQoImNlbnRlciIpLCB0aGlzLl9wZXJjZW50VGV4dC5TZXRWZXJ0aWNhbEFsaWdubWVudCgiY2VudGVyIiksIHRoaXMuX3BlcmNlbnRUZXh0LlNldFNpemUoMzAwLCAyMDApKSA6IDAgPT09IGEgPyAoYSA9IHRoaXMuX3J1bnRpbWUuR2V0TG9hZGluZ0xvZ29Bc3NldCgpKSAmJiBhLkxvYWRTdGF0aWNUZXh0dXJlKHRoaXMuX3dlYmdsUmVuZGVyZXIpLmNhdGNoKGIgPT4gY29uc29sZS53YXJuKCJbQzMgcnVudGltZV0gRmFpbGVkIHRvIGNyZWF0ZSB0ZXh0dXJlIGZvciBsb2FkaW5nIGxvZ286ICIsIGIpKSA6IDQgPT09IGEgJiYgKHRoaXMuX0xvYWRTdmdTcGxhc2hJbWFnZSgic3BsYXNoLWltYWdlcy9zcGxhc2gtbG9nby5zdmciKS50aGVuKGIgPT4gewogICAgICAgICAgICAiZG9uZSIgPT09IHRoaXMuX3NwbGFzaFN0YXRlID8gdGhpcy5fd2ViZ2xSZW5kZXJlci5EZWxldGVUZXh0dXJlKGIpIDogdGhpcy5fc3BsYXNoVGV4dHVyZXMubG9nbyA9IGIKICAgICAgICB9KS5jYXRjaChiID0+IGNvbnNvbGUud2FybigiRmFpbGVkIHRvIGxvYWQgc3BsYXNoIGltYWdlOiAiLCBiKSksIHRoaXMuX0xvYWRCaXRtYXBTcGxhc2hJbWFnZSgic3BsYXNoLWltYWdlcy9zcGxhc2gtcG93ZXJlZGJ5LTUxMi5wbmciKS50aGVuKGIgPT4gewogICAgICAgICAgICAiZG9uZSIgPT09IHRoaXMuX3NwbGFzaFN0YXRlID8gdGhpcy5fd2ViZ2xSZW5kZXJlci5EZWxldGVUZXh0dXJlKGIpIDogdGhpcy5fc3BsYXNoVGV4dHVyZXMucG93ZXJlZCA9IGIKICAgICAgICB9KS5jYXRjaChiID0+IGNvbnNvbGUud2FybigiRmFpbGVkIHRvIGxvYWQgc3BsYXNoIGltYWdlOiAiLCBiKSksIHRoaXMuX0xvYWRCaXRtYXBTcGxhc2hJbWFnZSgic3BsYXNoLWltYWdlcy9zcGxhc2gtd2Vic2l0ZS01MTIucG5nIikudGhlbihiID0+IHsKICAgICAgICAgICAgImRvbmUiID09PSB0aGlzLl9zcGxhc2hTdGF0ZSA/IHRoaXMuX3dlYmdsUmVuZGVyZXIuRGVsZXRlVGV4dHVyZShiKSA6CiAgICAgICAgICAgICAgICB0aGlzLl9zcGxhc2hUZXh0dXJlcy53ZWJzaXRlID0gYgogICAgICAgIH0pLmNhdGNoKGIgPT4gY29uc29sZS53YXJuKCJGYWlsZWQgdG8gbG9hZCBzcGxhc2ggaW1hZ2U6ICIsIGIpKSkpCiAgICB9CiAgICBhc3luYyBfTG9hZFN2Z1NwbGFzaEltYWdlKGEpIHsKICAgICAgICBhID0gKG5ldyBVUkwoYSwgdGhpcy5fcnVudGltZS5HZXRSdW50aW1lQmFzZVVSTCgpKSkudG9TdHJpbmcoKTsKICAgICAgICBhID0gYXdhaXQgQzMkanNjb21wJDE2OS5GZXRjaEJsb2IoYSk7CiAgICAgICAgYSA9IGF3YWl0IHRoaXMuX3J1bnRpbWUuUmFzdGVyU3ZnSW1hZ2UoYSwgMjA0OCwgMjA0OCk7CiAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuX3dlYmdsUmVuZGVyZXIuQ3JlYXRlU3RhdGljVGV4dHVyZUFzeW5jKGEsIHsKICAgICAgICAgICAgbWlwTWFwUXVhbGl0eTogImhpZ2giCiAgICAgICAgfSkKICAgIH0KICAgIGFzeW5jIF9Mb2FkQml0bWFwU3BsYXNoSW1hZ2UoYSkgewogICAgICAgIGEgPSAobmV3IFVSTChhLCB0aGlzLl9ydW50aW1lLkdldFJ1bnRpbWVCYXNlVVJMKCkpKS50b1N0cmluZygpOwogICAgICAgIGEgPSBhd2FpdCBDMyRqc2NvbXAkMTY5LkZldGNoQmxvYihhKTsKICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5fd2ViZ2xSZW5kZXJlci5DcmVhdGVTdGF0aWNUZXh0dXJlQXN5bmMoYSwgewogICAgICAgICAgICBtaXBNYXBRdWFsaXR5OiAiaGlnaCIKICAgICAgICB9KQogICAgfQogICAgSGlkZUNvcmRvdmFTcGxhc2hTY3JlZW4oKSB7CiAgICAgICAgdGhpcy5fcnVudGltZS5Qb3N0Q29tcG9uZW50TWVzc2FnZVRvRE9NKCJydW50aW1lIiwgImhpZGUtY29yZG92YS1zcGxhc2giKQogICAgfQogICAgU3RhcnRMb2FkaW5nU2NyZWVuKCkgewogICAgICAgIHRoaXMuX2xvYWRlclN0YXJ0VGltZSA9IERhdGUubm93KCk7CiAgICAgICAgdGhpcy5fcnVudGltZS5EaXNwYXRjaGVyKCkuYWRkRXZlbnRMaXN0ZW5lcigibG9hZGluZ3Byb2dyZXNzIiwgdGhpcy5fbG9hZGluZ3Byb2dyZXNzX2hhbmRsZXIpOwogICAgICAgIHRoaXMuX3JhZklkID0gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHRoaXMuX0RyYXdMb2FkaW5nU2NyZWVuKCkpOwogICAgICAgIDMgIT09IHRoaXMuX3J1bnRpbWUuR2V0TG9hZGVyU3R5bGUoKSAmJiB0aGlzLkhpZGVDb3Jkb3ZhU3BsYXNoU2NyZWVuKCkKICAgIH0KICAgIGFzeW5jIEVuZExvYWRpbmdTY3JlZW4oKSB7CiAgICAgICAgaWYgKHRoaXMuX3dlYmdsUmVuZGVyZXIpIHsKICAgICAgICAgICAgdGhpcy5fbG9hZGluZ1Byb2dyZXNzID0gMTsKICAgICAgICAgICAgdmFyIGEgPSB0aGlzLl9ydW50aW1lLkdldExvYWRlclN0eWxlKCk7CiAgICAgICAgICAgIDQgPT09IGEgJiYgYXdhaXQgdGhpcy5fc3BsYXNoRG9uZVByb21pc2U7CiAgICAgICAgICAgIHRoaXMuX3NwbGFzaERvbmVQcm9taXNlID0gdGhpcy5fc3BsYXNoRG9uZVJlc29sdmUgPSBudWxsOyAtIDEgIT09IHRoaXMuX3JhZklkICYmIChjYW5jZWxBbmltYXRpb25GcmFtZSh0aGlzLl9yYWZJZCksIHRoaXMuX3JhZklkID0gLTEpOwogICAgICAgICAgICB0aGlzLl9ydW50aW1lLkRpc3BhdGNoZXIoKS5yZW1vdmVFdmVudExpc3RlbmVyKCJsb2FkaW5ncHJvZ3Jlc3MiLCB0aGlzLl9sb2FkaW5ncHJvZ3Jlc3NfaGFuZGxlcik7CiAgICAgICAgICAgIHRoaXMuX2xvYWRpbmdwcm9ncmVzc19oYW5kbGVyID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fcGVyY2VudFRleHQgJiYgKHRoaXMuX3BlcmNlbnRUZXh0LlJlbGVhc2UoKSwgdGhpcy5fcGVyY2VudFRleHQgPSBudWxsKTsKICAgICAgICAgICAgdGhpcy5fcnVudGltZS5SZWxlYXNlTG9hZGluZ0xvZ29Bc3NldCgpOwogICAgICAgICAgICB0aGlzLl93ZWJnbFJlbmRlcmVyLlN0YXJ0KCk7CiAgICAgICAgICAgIHRoaXMuX3NwbGFzaFRleHR1cmVzLmxvZ28gJiYgKHRoaXMuX3dlYmdsUmVuZGVyZXIuRGVsZXRlVGV4dHVyZSh0aGlzLl9zcGxhc2hUZXh0dXJlcy5sb2dvKSwKICAgICAgICAgICAgICAgIHRoaXMuX3NwbGFzaFRleHR1cmVzLmxvZ28gPSBudWxsKTsKICAgICAgICAgICAgdGhpcy5fc3BsYXNoVGV4dHVyZXMucG93ZXJlZCAmJiAodGhpcy5fd2ViZ2xSZW5kZXJlci5EZWxldGVUZXh0dXJlKHRoaXMuX3NwbGFzaFRleHR1cmVzLnBvd2VyZWQpLCB0aGlzLl9zcGxhc2hUZXh0dXJlcy5wb3dlcmVkID0gbnVsbCk7CiAgICAgICAgICAgIHRoaXMuX3NwbGFzaFRleHR1cmVzLndlYnNpdGUgJiYgKHRoaXMuX3dlYmdsUmVuZGVyZXIuRGVsZXRlVGV4dHVyZSh0aGlzLl9zcGxhc2hUZXh0dXJlcy53ZWJzaXRlKSwgdGhpcy5fc3BsYXNoVGV4dHVyZXMud2Vic2l0ZSA9IG51bGwpOwogICAgICAgICAgICB0aGlzLl93ZWJnbFJlbmRlcmVyLkNsZWFyUmdiYSgwLCAwLCAwLCAwKTsKICAgICAgICAgICAgdGhpcy5fd2ViZ2xSZW5kZXJlci5GaW5pc2goKTsKICAgICAgICAgICAgdGhpcy5fc3BsYXNoU3RhdGUgPSAiZG9uZSI7CiAgICAgICAgICAgIHRoaXMuX2dwdVRpbWVTdGFydEZyYW1lID0gdGhpcy5fd2ViZ2xSZW5kZXJlci5HZXRGcmFtZU51bWJlcigpOwogICAgICAgICAgICAzID09PSBhICYmIHRoaXMuSGlkZUNvcmRvdmFTcGxhc2hTY3JlZW4oKQogICAgICAgIH0KICAgIH0KICAgIF9EcmF3TG9hZGluZ1NjcmVlbigpIHsKICAgICAgICBpZiAoLTEgIT09CiAgICAgICAgICAgIHRoaXMuX3JhZklkKSB7CiAgICAgICAgICAgIHZhciBhID0gdGhpcy5fd2ViZ2xSZW5kZXJlcjsKICAgICAgICAgICAgaWYgKGEpIHsKICAgICAgICAgICAgICAgIGEuU3RhcnQoKTsKICAgICAgICAgICAgICAgIHRoaXMuX3JhZklkID0gLTE7CiAgICAgICAgICAgICAgICB2YXIgYiA9IHRoaXMuX3J1bnRpbWUuR2V0QXNzZXRNYW5hZ2VyKCkuSGFzSGFkRXJyb3JMb2FkaW5nKCksCiAgICAgICAgICAgICAgICAgICAgZCA9IHRoaXMuX3J1bnRpbWUuR2V0TG9hZGVyU3R5bGUoKTsKICAgICAgICAgICAgICAgIDMgIT09IGQgJiYgKHRoaXMuU2V0Q3NzVHJhbnNmb3JtKGEpLCBhLkNsZWFyUmdiYSgwLCAwLCAwLCAwKSwgYS5SZXNldENvbG9yKCksIGEuU2V0VGV4dHVyZUZpbGxNb2RlKCksIGEuU2V0VGV4dHVyZShudWxsKSk7CiAgICAgICAgICAgICAgICBpZiAoMCA9PT0gZCkgdGhpcy5fRHJhd1Byb2dyZXNzQmFyQW5kTG9nb0xvYWRpbmdTY3JlZW4oYik7CiAgICAgICAgICAgICAgICBlbHNlIGlmICgxID09PSBkKSB0aGlzLl9EcmF3UHJvZ3Jlc3NCYXJMb2FkaW5nU2NyZWVuKGIsIDEyMCwgMCk7CiAgICAgICAgICAgICAgICBlbHNlIGlmICgyID09PSBkKSB0aGlzLl9EcmF3UGVyY2VudFRleHRMb2FkaW5nU2NyZWVuKGIpOwogICAgICAgICAgICAgICAgZWxzZSBpZiAoMyA9PT0gZCkgQzMkanNjb21wJDE2OS5ub29wKCk7CiAgICAgICAgICAgICAgICBlbHNlIGlmICg0ID09PSBkKSB0aGlzLl9EcmF3U3BsYXNoTG9hZGluZ1NjcmVlbihiKTsKICAgICAgICAgICAgICAgIGVsc2UgdGhyb3cgRXJyb3IoImludmFsaWQgbG9hZGVyIHN0eWxlIik7CiAgICAgICAgICAgICAgICBhLkZpbmlzaCgpOwogICAgICAgICAgICAgICAgdGhpcy5fcmFmSWQgPSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4gdGhpcy5fRHJhd0xvYWRpbmdTY3JlZW4oKSkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIF9EcmF3UGVyY2VudFRleHRMb2FkaW5nU2NyZWVuKGEpIHsKICAgICAgICBhID8gdGhpcy5fcGVyY2VudFRleHQuU2V0Q29sb3JSZ2IoMSwgMCwgMCkgOiB0aGlzLl9wZXJjZW50VGV4dC5TZXRDb2xvclJnYiguNiwgLjYsIC42KTsKICAgICAgICB0aGlzLl9wZXJjZW50VGV4dC5TZXRUZXh0KE1hdGgucm91bmQoMTAwICogdGhpcy5fbG9hZGluZ1Byb2dyZXNzKSArICIlIik7CiAgICAgICAgYSA9IHRoaXMuX2NhbnZhc0Nzc1dpZHRoIC8gMjsKICAgICAgICBjb25zdCBiID0gdGhpcy5fY2FudmFzQ3NzSGVpZ2h0IC8gMjsKICAgICAgICB0ZW1wUXVhZCRqc2NvbXAkNS5zZXRSZWN0KGEgLSAxNTAsIGIgLSAxMDAsIGEgKyAxNTAsIGIgKyAxMDApOwogICAgICAgIHRoaXMuX3dlYmdsUmVuZGVyZXIuU2V0VGV4dHVyZSh0aGlzLl9wZXJjZW50VGV4dC5HZXRUZXh0dXJlKCkpOwogICAgICAgIHRoaXMuX3dlYmdsUmVuZGVyZXIuUXVhZDModGVtcFF1YWQkanNjb21wJDUsCiAgICAgICAgICAgIHRoaXMuX3BlcmNlbnRUZXh0LkdldFRleFJlY3QoKSkKICAgIH0KICAgIF9EcmF3UHJvZ3Jlc3NCYXJMb2FkaW5nU2NyZWVuKGEsIGIsIGQpIHsKICAgICAgICBjb25zdCBjID0gdGhpcy5fd2ViZ2xSZW5kZXJlcjsKICAgICAgICBjLlNldENvbG9yRmlsbE1vZGUoKTsKICAgICAgICBhID8gYy5TZXRDb2xvclJnYmEoMSwgMCwgMCwgMSkgOiBjLlNldENvbG9yUmdiYSguMTE4LCAuNTY1LCAxLCAxKTsKICAgICAgICBhID0gdGhpcy5fY2FudmFzQ3NzV2lkdGggLyAyOwogICAgICAgIGNvbnN0IGUgPSB0aGlzLl9jYW52YXNDc3NIZWlnaHQgLyAyLAogICAgICAgICAgICBnID0gYiAvIDI7CiAgICAgICAgdGVtcFJlY3QkanNjb21wJDguc2V0V0goYSAtIGcsIGUgLSA0ICsgZCwgTWF0aC5mbG9vcihiICogdGhpcy5fbG9hZGluZ1Byb2dyZXNzKSwgOCk7CiAgICAgICAgYy5SZWN0KHRlbXBSZWN0JGpzY29tcCQ4KTsKICAgICAgICB0ZW1wUmVjdCRqc2NvbXAkOC5zZXRXSChhIC0gZywgZSAtIDQgKyBkLCBiLCA4KTsKICAgICAgICB0ZW1wUmVjdCRqc2NvbXAkOC5vZmZzZXQoLS41LCAtLjUpOwogICAgICAgIHRlbXBSZWN0JGpzY29tcCQ4LmluZmxhdGUoLjUsIC41KTsKICAgICAgICBjLlNldENvbG9yUmdiYSgwLCAwLCAwLCAxKTsKICAgICAgICBjLkxpbmVSZWN0Mih0ZW1wUmVjdCRqc2NvbXAkOCk7CiAgICAgICAgdGVtcFJlY3QkanNjb21wJDguaW5mbGF0ZSgxLAogICAgICAgICAgICAxKTsKICAgICAgICBjLlNldENvbG9yUmdiYSgxLCAxLCAxLCAxKTsKICAgICAgICBjLkxpbmVSZWN0Mih0ZW1wUmVjdCRqc2NvbXAkOCkKICAgIH0KICAgIF9EcmF3UHJvZ3Jlc3NCYXJBbmRMb2dvTG9hZGluZ1NjcmVlbihhKSB7CiAgICAgICAgdmFyIGIgPSB0aGlzLl9ydW50aW1lLkdldExvYWRpbmdMb2dvQXNzZXQoKTsKICAgICAgICBpZiAoYikKICAgICAgICAgICAgaWYgKGIgPSBiLkdldFRleHR1cmUoKSkgewogICAgICAgICAgICAgICAgdmFyIGQgPSBiLkdldFdpZHRoKCksCiAgICAgICAgICAgICAgICAgICAgYyA9IGIuR2V0SGVpZ2h0KCksCiAgICAgICAgICAgICAgICAgICAgZSA9IHRoaXMuX2NhbnZhc0Nzc1dpZHRoIC8gMiwKICAgICAgICAgICAgICAgICAgICBnID0gdGhpcy5fY2FudmFzQ3NzSGVpZ2h0IC8gMiwKICAgICAgICAgICAgICAgICAgICBrID0gZCAvIDI7CiAgICAgICAgICAgICAgICBjIC89IDI7CiAgICAgICAgICAgICAgICB0ZW1wUXVhZCRqc2NvbXAkNS5zZXRSZWN0KGUgLSBrLCBnIC0gYywgZSArIGssIGcgKyBjKTsKICAgICAgICAgICAgICAgIHRoaXMuX3dlYmdsUmVuZGVyZXIuU2V0VGV4dHVyZShiKTsKICAgICAgICAgICAgICAgIHRoaXMuX3dlYmdsUmVuZGVyZXIuUXVhZCh0ZW1wUXVhZCRqc2NvbXAkNSk7CiAgICAgICAgICAgICAgICB0aGlzLl9EcmF3UHJvZ3Jlc3NCYXJMb2FkaW5nU2NyZWVuKGEsIGQsIGMgKyAxNikKICAgICAgICAgICAgfSBlbHNlIHRoaXMuX0RyYXdQcm9ncmVzc0JhckxvYWRpbmdTY3JlZW4oYSwgMTIwLCAwKTsKICAgICAgICBlbHNlIHRoaXMuX0RyYXdQcm9ncmVzc0JhckxvYWRpbmdTY3JlZW4oYSwKICAgICAgICAgICAgMTIwLCAwKQogICAgfQogICAgX0RyYXdTcGxhc2hMb2FkaW5nU2NyZWVuKGEpIHsKICAgICAgICBjb25zdCBiID0gdGhpcy5fd2ViZ2xSZW5kZXJlciwKICAgICAgICAgICAgZCA9IHRoaXMuX3NwbGFzaFRleHR1cmVzLmxvZ28sCiAgICAgICAgICAgIGMgPSB0aGlzLl9zcGxhc2hUZXh0dXJlcy5wb3dlcmVkLAogICAgICAgICAgICBlID0gdGhpcy5fc3BsYXNoVGV4dHVyZXMud2Vic2l0ZSwKICAgICAgICAgICAgZyA9IERhdGUubm93KCk7CiAgICAgICAgMCA9PT0gdGhpcy5fc3BsYXNoRnJhbWVOdW1iZXIgJiYgKHRoaXMuX2xvYWRlclN0YXJ0VGltZSA9IGcpOwogICAgICAgIGNvbnN0IGsgPSB0aGlzLl9ydW50aW1lLklzUHJldmlldygpIHx8IHRoaXMuX3J1bnRpbWUuSXNGQkluc3RhbnRBdmFpbGFibGUoKSAmJiAhdGhpcy5fcnVudGltZS5Jc0NvcmRvdmEoKSwKICAgICAgICAgICAgbSA9IGsgPyAwIDogMjAwLAogICAgICAgICAgICBuID0gayA/IDAgOiAzRTM7CiAgICAgICAgbGV0IHEgPSAxOwogICAgICAgICJmYWRlLWluIiA9PT0gdGhpcy5fc3BsYXNoU3RhdGUgPyBxID0gTWF0aC5taW4oKGcgLSB0aGlzLl9sb2FkZXJTdGFydFRpbWUpIC8gMzAwLCAxKSA6ICJmYWRlLW91dCIgPT09IHRoaXMuX3NwbGFzaFN0YXRlICYmIChxID0gTWF0aC5tYXgoMSAtIChnIC0gdGhpcy5fc3BsYXNoRmFkZU91dFN0YXJ0VGltZSkgLwogICAgICAgICAgICAzMDAsIDApKTsKICAgICAgICBiLlNldENvbG9yRmlsbE1vZGUoKTsKICAgICAgICBiLlNldENvbG9yUmdiYSguMjMxICogcSwgLjI1MSAqIHEsIC4yNzEgKiBxLCBxKTsKICAgICAgICB0ZW1wUmVjdCRqc2NvbXAkOC5zZXQoMCwgMCwgdGhpcy5fY2FudmFzQ3NzV2lkdGgsIHRoaXMuX2NhbnZhc0Nzc0hlaWdodCk7CiAgICAgICAgYi5SZWN0KHRlbXBSZWN0JGpzY29tcCQ4KTsKICAgICAgICBjb25zdCB1ID0gTWF0aC5jZWlsKHRoaXMuX2NhbnZhc0Nzc1dpZHRoKSwKICAgICAgICAgICAgdyA9IE1hdGguY2VpbCh0aGlzLl9jYW52YXNDc3NIZWlnaHQpOwogICAgICAgIGxldCB6OwogICAgICAgIDI1NiA8IHRoaXMuX2NhbnZhc0Nzc0hlaWdodCA/IChiLlNldENvbG9yUmdiYSguMzAyICogcSwgLjMzNCAqIHEsIC4zNjUgKiBxLCBxKSwgeiA9IE1hdGgubWF4KC4wMDUgKiB3LCAyKSwgdGVtcFJlY3QkanNjb21wJDguc2V0V0goMCwgLjggKiB3IC0geiAvIDIsIHUsIHopLCBiLlJlY3QodGVtcFJlY3QkanNjb21wJDgpLCBhID8gYi5TZXRDb2xvclJnYmEocSwgMCwgMCwgcSkgOiBiLlNldENvbG9yUmdiYSguMTYxICogcSwgLjk1MyAqIHEsIC44MTYgKiBxLCBxKSwgYSA9IHUgKiB0aGlzLl9sb2FkaW5nUHJvZ3Jlc3MsIHRlbXBSZWN0JGpzY29tcCQ4LnNldFdIKC41ICoKICAgICAgICAgICAgICAgIHUgLSBhIC8gMiwgLjggKiB3IC0geiAvIDIsIGEsIHopLCBiLlJlY3QodGVtcFJlY3QkanNjb21wJDgpLCBiLlNldENvbG9yUmdiYShxLCBxLCBxLCBxKSwgYi5TZXRUZXh0dXJlRmlsbE1vZGUoKSwgYyAmJiAoYSA9IDEuNSAqIEMzJGpzY29tcCQxNjkuY2xhbXAoLjIyICogdywgMTA1LCAuNiAqIHUpLCB6ID0gYSAvIDgsIHRlbXBSZWN0JGpzY29tcCQ4LnNldFdIKC41ICogdSAtIGEgLyAyLCAuMiAqIHcgLSB6IC8gMiwgYSwgeiksIGIuU2V0VGV4dHVyZShjKSwgYi5SZWN0KHRlbXBSZWN0JGpzY29tcCQ4KSksIGQgJiYgKHogPSBhID0gTWF0aC5taW4oLjM5NSAqIHcsIC45NSAqIHUpLCB0ZW1wUmVjdCRqc2NvbXAkOC5zZXRXSCguNSAqIHUgLSBhIC8gMiwgLjQ4NSAqIHcgLSB6IC8gMiwgYSwgeiksIGIuU2V0VGV4dHVyZShkKSwgYi5SZWN0KHRlbXBSZWN0JGpzY29tcCQ4KSksIGUgJiYgKGEgPSAxLjUgKiBDMyRqc2NvbXAkMTY5LmNsYW1wKC4yMiAqIHcsIDEwNSwgLjYgKiB1KSwgeiA9IGEgLyA4LCB0ZW1wUmVjdCRqc2NvbXAkOC5zZXRXSCguNSAqIHUgLSBhIC8gMiwgLjg2OCAqIHcgLSB6IC8gMiwgYSwgeiksIGIuU2V0VGV4dHVyZShlKSwgYi5SZWN0KHRlbXBSZWN0JGpzY29tcCQ4KSkpIDoKICAgICAgICAgICAgKGIuU2V0Q29sb3JSZ2JhKC4zMDIgKiBxLCAuMzM0ICogcSwgLjM2NSAqIHEsIHEpLCB6ID0gTWF0aC5tYXgoLjAwNSAqIHcsIDIpLCB0ZW1wUmVjdCRqc2NvbXAkOC5zZXRXSCgwLCAuODUgKiB3IC0geiAvIDIsIHUsIHopLCBiLlJlY3QodGVtcFJlY3QkanNjb21wJDgpLCBhID8gYi5TZXRDb2xvclJnYmEocSwgMCwgMCwgcSkgOiBiLlNldENvbG9yUmdiYSguMTYxICogcSwgLjk1MyAqIHEsIC44MTYgKiBxLCBxKSwgYSA9IHUgKiB0aGlzLl9sb2FkaW5nUHJvZ3Jlc3MsIHRlbXBSZWN0JGpzY29tcCQ4LnNldFdIKC41ICogdSAtIGEgLyAyLCAuODUgKiB3IC0geiAvIDIsIGEsIHopLCBiLlJlY3QodGVtcFJlY3QkanNjb21wJDgpLCBiLlNldENvbG9yUmdiYShxLCBxLCBxLCBxKSwgYi5TZXRUZXh0dXJlRmlsbE1vZGUoKSwgZCAmJiAoeiA9IGEgPSAuNTUgKiB3LCB0ZW1wUmVjdCRqc2NvbXAkOC5zZXRXSCguNSAqIHUgLSBhIC8gMiwgLjQ1ICogdyAtIHogLyAyLCBhLCB6KSwgYi5TZXRUZXh0dXJlKGQpLCBiLlJlY3QodGVtcFJlY3QkanNjb21wJDgpKSk7CiAgICAgICAgdGhpcy5fc3BsYXNoRnJhbWVOdW1iZXIrKzsKICAgICAgICAiZmFkZS1pbiIgPT09IHRoaXMuX3NwbGFzaFN0YXRlICYmCiAgICAgICAgICAgIDMwMCA8PSBnIC0gdGhpcy5fbG9hZGVyU3RhcnRUaW1lICYmIDIgPD0gdGhpcy5fc3BsYXNoRnJhbWVOdW1iZXIgJiYgKHRoaXMuX3NwbGFzaFN0YXRlID0gIndhaXQiLCB0aGlzLl9zcGxhc2hGYWRlSW5GaW5pc2hUaW1lID0gZyk7CiAgICAgICAgIndhaXQiID09PSB0aGlzLl9zcGxhc2hTdGF0ZSAmJiBnIC0gdGhpcy5fc3BsYXNoRmFkZUluRmluaXNoVGltZSA+PSBuICYmIDEgPD0gdGhpcy5fbG9hZGluZ1Byb2dyZXNzICYmICh0aGlzLl9zcGxhc2hTdGF0ZSA9ICJmYWRlLW91dCIsIHRoaXMuX3NwbGFzaEZhZGVPdXRTdGFydFRpbWUgPSBnKTsKICAgICAgICAoImZhZGUtb3V0IiA9PT0gdGhpcy5fc3BsYXNoU3RhdGUgJiYgZyAtIHRoaXMuX3NwbGFzaEZhZGVPdXRTdGFydFRpbWUgPj0gMzAwICsgbSB8fCBrICYmIDEgPD0gdGhpcy5fbG9hZGluZ1Byb2dyZXNzICYmIDUwMCA+IGcgLSB0aGlzLl9sb2FkZXJTdGFydFRpbWUpICYmIHRoaXMuX3NwbGFzaERvbmVSZXNvbHZlKCkKICAgIH0KfTsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkMTcwID0gc2VsZi5DMywKICAgIEMzRGVidWdnZXIkanNjb21wJDMgPSBzZWxmLkMzRGVidWdnZXIsCiAgICBERUZBVUxUX1JVTlRJTUVfT1BUUyA9IHsKICAgICAgICBtZXNzYWdlUG9ydDogbnVsbCwKICAgICAgICBydW50aW1lQmFzZVVybDogIiIsCiAgICAgICAgaGVhZGxlc3M6ICExLAogICAgICAgIGhhc0RvbTogITAsCiAgICAgICAgaXNJbldvcmtlcjogITEsCiAgICAgICAgdXNlQXVkaW86ICEwLAogICAgICAgIHByb2plY3REYXRhOiAiIiwKICAgICAgICBleHBvcnRUeXBlOiAiIgogICAgfTsKbGV0IGlmZSA9ICEwOwpDMyRqc2NvbXAkMTcwLlJ1bnRpbWUgPSBjbGFzcyBleHRlbmRzIEMzJGpzY29tcCQxNzAuRGVmZW5kZWRCYXNlIHsKICAgIGNvbnN0cnVjdG9yKGEpIHsKICAgICAgICBhID0gT2JqZWN0LmFzc2lnbih7fSwgREVGQVVMVF9SVU5USU1FX09QVFMsIGEpOwogICAgICAgIHN1cGVyKCk7CiAgICAgICAgdGhpcy5fbWVzc2FnZVBvcnQgPSBhLm1lc3NhZ2VQb3J0OwogICAgICAgIHRoaXMuX3J1bnRpbWVCYXNlVXJsID0gYS5ydW50aW1lQmFzZVVybDsKICAgICAgICB0aGlzLl9wcmV2aWV3VXJsID0gYS5wcmV2aWV3VXJsOwogICAgICAgIHRoaXMuX2lzSGVhZGxlc3MgPSAhIWEuaGVhZGxlc3M7CiAgICAgICAgdGhpcy5faGFzRG9tID0gISFhLmhhc0RvbTsKICAgICAgICB0aGlzLl9pc0luV29ya2VyID0gISFhLmlzSW5Xb3JrZXI7CiAgICAgICAgaWZlID0gYS5pZmU7CiAgICAgICAgdGhpcy5fdXNlQXVkaW8gPSAhIWEudXNlQXVkaW87CiAgICAgICAgdGhpcy5fZXhwb3J0VHlwZSA9IGEuZXhwb3J0VHlwZTsKICAgICAgICB0aGlzLl9pc2lPU0NvcmRvdmEgPSAhIWEuaXNpT1NDb3Jkb3ZhOwogICAgICAgIHRoaXMuX2lzaU9TV2ViVmlldyA9ICEhYS5pc2lPU1dlYlZpZXc7CiAgICAgICAgdGhpcy5faXNGQkluc3RhbnRBdmFpbGFibGUgPSAhIWEuaXNGQkluc3RhbnRBdmFpbGFibGU7CiAgICAgICAgdGhpcy5fb3B1c1dhc21TY3JpcHRVcmwgPSBhLm9wdXNXYXNtU2NyaXB0VXJsOwogICAgICAgIHRoaXMuX29wdXNXYXNtQmluYXJ5VXJsID0gYS5vcHVzV2FzbUJpbmFyeVVybDsKICAgICAgICB0aGlzLl9pc0RlYnVnZ2luZyA9IHRoaXMuX2JyZWFrcG9pbnRzRW5hYmxlZCA9IHRoaXMuX2lzRGVidWcgPSAhKCJwcmV2aWV3IiAhPT0gdGhpcy5fZXhwb3J0VHlwZSB8fCAhYS5pc0RlYnVnKTsKICAgICAgICB0aGlzLl9kZWJ1Z2dpbmdEaXNhYmxlZCA9IDA7CiAgICAgICAgdGhpcy5fYWRkaXRpb25hbExvYWRQcm9taXNlcyA9IFtdOwogICAgICAgIHRoaXMuX2FkZGl0aW9uYWxDcmVhdGVQcm9taXNlcyA9IFtdOwogICAgICAgIHRoaXMuX2lzVXNpbmdDcmVhdGVQcm9taXNlcyA9ICExOwogICAgICAgIHRoaXMuX2FwcElkID0gdGhpcy5fcHJvamVjdFVuaXF1ZUlkID0gdGhpcy5fcHJvamVjdFZlcnNpb24gPSB0aGlzLl9wcm9qZWN0TmFtZSA9ICIiOwogICAgICAgIHRoaXMuX29yaWdpbmFsVmlld3BvcnRIZWlnaHQgPSB0aGlzLl9vcmlnaW5hbFZpZXdwb3J0V2lkdGggPSAwOwogICAgICAgIHRoaXMuX2RldmljZVBpeGVsUmF0aW8gPSBzZWxmLmRldmljZVBpeGVsUmF0aW87CiAgICAgICAgdGhpcy5fbG9hZGVyU3R5bGUgPQogICAgICAgICAgICB0aGlzLl92aWV3cG9ydEhlaWdodCA9IHRoaXMuX3ZpZXdwb3J0V2lkdGggPSB0aGlzLl9wYXJhbGxheFlvcmlnaW4gPSB0aGlzLl9wYXJhbGxheFhvcmlnaW4gPSAwOwogICAgICAgIHRoaXMuX3VzZXNMb2FkZXJMYXlvdXQgPSAhMTsKICAgICAgICB0aGlzLl9pc0xvYWRpbmcgPSAhMDsKICAgICAgICB0aGlzLl91c2VzQW55RGVwdGhTYW1wbGluZyA9IHRoaXMuX3VzZXNBbnlDcm9zc1NhbXBsaW5nID0gdGhpcy5fdXNlc0FueUJhY2tncm91bmRCbGVuZGluZyA9ICExOwogICAgICAgIHRoaXMuX2xvYWRpbmdMb2dvQXNzZXQgPSBudWxsOwogICAgICAgIHRoaXMuX2Fzc2V0TWFuYWdlciA9IEMzJGpzY29tcCQxNzAuTmV3KEMzJGpzY29tcCQxNzAuQXNzZXRNYW5hZ2VyLCB0aGlzLCBhKTsKICAgICAgICB0aGlzLl9sYXlvdXRNYW5hZ2VyID0gQzMkanNjb21wJDE3MC5OZXcoQzMkanNjb21wJDE3MC5MYXlvdXRNYW5hZ2VyLCB0aGlzKTsKICAgICAgICB0aGlzLl9ldmVudFNoZWV0TWFuYWdlciA9IEMzJGpzY29tcCQxNzAuTmV3KEMzJGpzY29tcCQxNzAuRXZlbnRTaGVldE1hbmFnZXIsIHRoaXMpOwogICAgICAgIHRoaXMuX3BsdWdpbk1hbmFnZXIgPSBDMyRqc2NvbXAkMTcwLk5ldyhDMyRqc2NvbXAkMTcwLlBsdWdpbk1hbmFnZXIsCiAgICAgICAgICAgIHRoaXMpOwogICAgICAgIHRoaXMuX2NvbGxpc2lvbkVuZ2luZSA9IEMzJGpzY29tcCQxNzAuTmV3KEMzJGpzY29tcCQxNzAuQ29sbGlzaW9uRW5naW5lLCB0aGlzKTsKICAgICAgICB0aGlzLl90aW1lbGluZU1hbmFnZXIgPSBDMyRqc2NvbXAkMTcwLk5ldyhDMyRqc2NvbXAkMTcwLlRpbWVsaW5lTWFuYWdlciwgdGhpcyk7CiAgICAgICAgdGhpcy5fdHJhbnNpdGlvbk1hbmFnZXIgPSBDMyRqc2NvbXAkMTcwLk5ldyhDMyRqc2NvbXAkMTcwLlRyYW5zaXRpb25NYW5hZ2VyLCB0aGlzKTsKICAgICAgICB0aGlzLl90ZW1wbGF0ZU1hbmFnZXIgPSBDMyRqc2NvbXAkMTcwLk5ldyhDMyRqc2NvbXAkMTcwLlRlbXBsYXRlTWFuYWdlciwgdGhpcyk7CiAgICAgICAgdGhpcy5fYWxsT2JqZWN0Q2xhc3NlcyA9IFtdOwogICAgICAgIHRoaXMuX29iamVjdENsYXNzZXNCeU5hbWUgPSBuZXcgTWFwOwogICAgICAgIHRoaXMuX29iamVjdENsYXNzZXNCeVNpZCA9IG5ldyBNYXA7CiAgICAgICAgdGhpcy5fZmFtaWx5Q291bnQgPSAwOwogICAgICAgIHRoaXMuX2FsbENvbnRhaW5lcnMgPSBbXTsKICAgICAgICB0aGlzLl9hbGxFZmZlY3RMaXN0cyA9IFtdOwogICAgICAgIHRoaXMuX2N1cnJlbnRMYXlvdXRTdGFjayA9IFtdOwogICAgICAgIHRoaXMuX2luc3RhbmNlc1BlbmRpbmdDcmVhdGUgPSBbXTsKICAgICAgICB0aGlzLl9pbnN0YW5jZXNQZW5kaW5nRGVzdHJveSA9IG5ldyBNYXA7CiAgICAgICAgdGhpcy5faXNGbHVzaGluZ1BlbmRpbmdJbnN0YW5jZXMgPSB0aGlzLl9oYXNQZW5kaW5nSW5zdGFuY2VzID0gITE7CiAgICAgICAgdGhpcy5fbmV4dFVpZCA9IHRoaXMuX29iamVjdENvdW50ID0gMDsKICAgICAgICB0aGlzLl9pbnN0YW5jZXNCeVVpZCA9IG5ldyBNYXA7CiAgICAgICAgdGhpcy5faW5zdGFuY2VzVG9SZWxlYXNlQXRFbmRPZlRpY2sgPSBuZXcgU2V0OwogICAgICAgIHRoaXMuX2luc3RhbmNlc1RvUmVsZWFzZUFmZmVjdGVkT2JqZWN0Q2xhc3NlcyA9IG5ldyBTZXQ7CiAgICAgICAgdGhpcy5fb2JqZWN0UmVmZXJlbmNlVGFibGUgPSBbXTsKICAgICAgICB0aGlzLl9qc1Byb3BOYW1lVGFibGUgPSBbXTsKICAgICAgICB0aGlzLl9jYW52YXNNYW5hZ2VyID0gbnVsbDsKICAgICAgICB0aGlzLl91c2VzM2RGZWF0dXJlcyA9ICExOwogICAgICAgIHRoaXMuX2ZyYW1lcmF0ZU1vZGUgPSAidnN5bmMiOwogICAgICAgIHRoaXMuX2NvbXBvc2l0aW5nTW9kZSA9ICJzdGFuZGFyZCI7CiAgICAgICAgdGhpcy5fc2FtcGxpbmcgPSAidHJpbGluZWFyIjsKICAgICAgICB0aGlzLl9pc1BpeGVsUm91bmRpbmdFbmFibGVkID0gITE7CiAgICAgICAgdGhpcy5fbmVlZFJlbmRlciA9ICEwOwogICAgICAgIHRoaXMuX2lzUGF1c2VkT25CbHVyID0gdGhpcy5fcGF1c2VPbkJsdXIgPSAhMTsKICAgICAgICB0aGlzLl9leHBvcnRUb1ZpZGVvID0gbnVsbDsKICAgICAgICB0aGlzLl90aWNrQ2FsbGJhY2tzID0gewogICAgICAgICAgICBub3JtYWw6IGIgPT4gewogICAgICAgICAgICAgICAgdGhpcy5fcnVhZklkID0gdGhpcy5fcmFmSWQgPSAtMTsKICAgICAgICAgICAgICAgIHRoaXMuVGljayhiKQogICAgICAgICAgICB9LAogICAgICAgICAgICB0aWNrT25seTogYiA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLl9ydWFmSWQgPSAtMTsKICAgICAgICAgICAgICAgIHRoaXMuVGljayhiLCAhMSwgInNraXAtcmVuZGVyIikKICAgICAgICAgICAgfSwKICAgICAgICAgICAgcmVuZGVyT25seTogKCkgPT4gewogICAgICAgICAgICAgICAgdGhpcy5fcmFmSWQgPSAtMTsKICAgICAgICAgICAgICAgIHRoaXMuUmVuZGVyKCkKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgdGhpcy5fcnVhZklkID0gdGhpcy5fcmFmSWQgPSAtMTsKICAgICAgICB0aGlzLl90aWNrQ291bnROb1NhdmUgPSB0aGlzLl90aWNrQ291bnQgPSAwOwogICAgICAgIHRoaXMuX2hhc1N0YXJ0ZWRUaWNraW5nID0gdGhpcy5faXNJblRpY2sgPSB0aGlzLl9oYXNTdGFydGVkID0gITE7CiAgICAgICAgdGhpcy5faXNMYXlvdXRGaXJzdFRpY2sgPSAhMDsKICAgICAgICB0aGlzLl9zdXNwZW5kQ291bnQgPSAwOwogICAgICAgIHRoaXMuX3NjaGVkdWxlVHJpZ2dlcnNUaHJvdHRsZSA9IG5ldyBDMyRqc2NvbXAkMTcwLlByb21pc2VUaHJvdHRsZSgxKTsKICAgICAgICB0aGlzLl9yYW5kb21OdW1iZXJDYWxsYmFjayA9ICgpID0+IE1hdGgucmFuZG9tKCk7CiAgICAgICAgdGhpcy5fZHQgPSB0aGlzLl9kdDEgPSB0aGlzLl9sYXN0VGlja1RpbWUgPSB0aGlzLl9zdGFydFRpbWUgPSAwOwogICAgICAgIHRoaXMuX3RpbWVTY2FsZSA9IDE7CiAgICAgICAgdGhpcy5fbWluaW11bUZyYW1lcmF0ZSA9IDMwOwogICAgICAgIHRoaXMuX2dhbWVUaW1lID0gQzMkanNjb21wJDE3MC5OZXcoQzMkanNjb21wJDE3MC5LYWhhblN1bSk7CiAgICAgICAgdGhpcy5fZ2FtZVRpbWVSYXcgPSBDMyRqc2NvbXAkMTcwLk5ldyhDMyRqc2NvbXAkMTcwLkthaGFuU3VtKTsKICAgICAgICB0aGlzLl93YWxsVGltZSA9IEMzJGpzY29tcCQxNzAuTmV3KEMzJGpzY29tcCQxNzAuS2FoYW5TdW0pOwogICAgICAgIHRoaXMuX2luc3RhbmNlVGltZXMgPSBuZXcgTWFwOwogICAgICAgIHRoaXMuX2Zwc0ZyYW1lQ291bnQgPSAtMTsKICAgICAgICB0aGlzLl9tYWluVGhyZWFkVGltZSA9IHRoaXMuX21haW5UaHJlYWRUaW1lQ291bnRlciA9IHRoaXMuX2ZwcyA9IHRoaXMuX2Zwc0xhc3RUaW1lID0gMDsKICAgICAgICB0aGlzLl9pc0xvYWRpbmdTdGF0ZSA9ICExOwogICAgICAgIHRoaXMuX2xvYWRGcm9tU2xvdE5hbWUgPSB0aGlzLl9zYXZlVG9TbG90TmFtZSA9CiAgICAgICAgICAgICIiOwogICAgICAgIHRoaXMuX2xvYWRGcm9tSnNvbiA9IG51bGw7CiAgICAgICAgdGhpcy5fbGFzdFNhdmVKc29uID0gIiI7CiAgICAgICAgdGhpcy5fc2F2ZWdhbWVzU3RvcmFnZSA9IHRoaXMuX3Byb2plY3RTdG9yYWdlID0gbnVsbDsKICAgICAgICB0aGlzLl9kaXNwYXRjaGVyID0gQzMkanNjb21wJDE3MC5OZXcoQzMkanNjb21wJDE3MC5FdmVudC5EaXNwYXRjaGVyKTsKICAgICAgICB0aGlzLl9kb21FdmVudEhhbmRsZXJzID0gbmV3IE1hcDsKICAgICAgICB0aGlzLl9wZW5kaW5nUmVzcG9uc2VQcm9taXNlcyA9IG5ldyBNYXA7CiAgICAgICAgdGhpcy5fbmV4dERvbVJlc3BvbnNlSWQgPSAwOwogICAgICAgIHRoaXMuX2lzUmVhZHlUb0hhbmRsZUV2ZW50cyA9IHRoaXMuX2RpZFJlcXVlc3REZXZpY2VNb3Rpb25FdmVudCA9IHRoaXMuX2RpZFJlcXVlc3REZXZpY2VPcmllbnRhdGlvbkV2ZW50ID0gITE7CiAgICAgICAgdGhpcy5fd2FpdGluZ1RvSGFuZGxlRXZlbnRzID0gW107CiAgICAgICAgdGhpcy5fZXZlbnRPYmplY3RzID0gewogICAgICAgICAgICBwcmV0aWNrOiBDMyRqc2NvbXAkMTcwLk5ldyhDMyRqc2NvbXAkMTcwLkV2ZW50LCAicHJldGljayIsICExKSwKICAgICAgICAgICAgdGljazogQzMkanNjb21wJDE3MC5OZXcoQzMkanNjb21wJDE3MC5FdmVudCwKICAgICAgICAgICAgICAgICJ0aWNrIiwgITEpLAogICAgICAgICAgICB0aWNrMjogQzMkanNjb21wJDE3MC5OZXcoQzMkanNjb21wJDE3MC5FdmVudCwgInRpY2syIiwgITEpLAogICAgICAgICAgICBpbnN0YW5jZWRlc3Ryb3k6IEMzJGpzY29tcCQxNzAuTmV3KEMzJGpzY29tcCQxNzAuRXZlbnQsICJpbnN0YW5jZWRlc3Ryb3kiLCAhMSksCiAgICAgICAgICAgIGJlZm9yZWxheW91dGNoYW5nZTogQzMkanNjb21wJDE3MC5OZXcoQzMkanNjb21wJDE3MC5FdmVudCwgImJlZm9yZWxheW91dGNoYW5nZSIsICExKSwKICAgICAgICAgICAgbGF5b3V0Y2hhbmdlOiBDMyRqc2NvbXAkMTcwLk5ldyhDMyRqc2NvbXAkMTcwLkV2ZW50LCAibGF5b3V0Y2hhbmdlIiwgITEpCiAgICAgICAgfTsKICAgICAgICB0aGlzLl9ldmVudE9iamVjdHMuaW5zdGFuY2VkZXN0cm95Lmluc3RhbmNlID0gbnVsbDsKICAgICAgICB0aGlzLl91c2VyU2NyaXB0RGlzcGF0Y2hlciA9IEMzJGpzY29tcCQxNzAuTmV3KEMzJGpzY29tcCQxNzAuRXZlbnQuRGlzcGF0Y2hlcik7CiAgICAgICAgdGhpcy5fdXNlclNjcmlwdEV2ZW50T2JqZWN0cyA9IG51bGw7CiAgICAgICAgdGhpcy5fYmVoSW5zdHNUb1RpY2sgPSBDMyRqc2NvbXAkMTcwLk5ldyhDMyRqc2NvbXAkMTcwLlJlZEJsYWNrU2V0LAogICAgICAgICAgICBDMyRqc2NvbXAkMTcwLkJlaGF2aW9ySW5zdGFuY2UuU29ydEJ5VGlja1NlcXVlbmNlKTsKICAgICAgICB0aGlzLl9iZWhJbnN0c1RvUG9zdFRpY2sgPSBDMyRqc2NvbXAkMTcwLk5ldyhDMyRqc2NvbXAkMTcwLlJlZEJsYWNrU2V0LCBDMyRqc2NvbXAkMTcwLkJlaGF2aW9ySW5zdGFuY2UuU29ydEJ5VGlja1NlcXVlbmNlKTsKICAgICAgICB0aGlzLl9iZWhJbnN0c1RvVGljazIgPSBDMyRqc2NvbXAkMTcwLk5ldyhDMyRqc2NvbXAkMTcwLlJlZEJsYWNrU2V0LCBDMyRqc2NvbXAkMTcwLkJlaGF2aW9ySW5zdGFuY2UuU29ydEJ5VGlja1NlcXVlbmNlKTsKICAgICAgICB0aGlzLl9qb2JTY2hlZHVsZXIgPSBDMyRqc2NvbXAkMTcwLk5ldyhDMyRqc2NvbXAkMTcwLkpvYlNjaGVkdWxlclJ1bnRpbWUsIHRoaXMsIGEuam9iU2NoZWR1bGVyKTsKICAgICAgICBhLmNhbnZhcyAmJiAodGhpcy5fY2FudmFzTWFuYWdlciA9IEMzJGpzY29tcCQxNzAuTmV3KEMzJGpzY29tcCQxNzAuQ2FudmFzTWFuYWdlciwgdGhpcykpOwogICAgICAgIHRoaXMuX21lc3NhZ2VQb3J0Lm9ubWVzc2FnZSA9IGIgPT4gdGhpcy5fT25NZXNzYWdlRnJvbURPTShiLmRhdGEpOwogICAgICAgIHRoaXMuQWRkRE9NQ29tcG9uZW50TWVzc2FnZUhhbmRsZXIoInJ1bnRpbWUiLCAidmlzaWJpbGl0eWNoYW5nZSIsIGIgPT4gdGhpcy5fT25WaXNpYmlsaXR5Q2hhbmdlKGIpKTsKICAgICAgICB0aGlzLkFkZERPTUNvbXBvbmVudE1lc3NhZ2VIYW5kbGVyKCJydW50aW1lIiwgIm9wdXMtZGVjb2RlIiwgYiA9PiB0aGlzLl9XYXNtRGVjb2RlV2ViTU9wdXMoYi5hcnJheUJ1ZmZlcikpOwogICAgICAgIHRoaXMuQWRkRE9NQ29tcG9uZW50TWVzc2FnZUhhbmRsZXIoInJ1bnRpbWUiLCAiZ2V0LXJlbW90ZS1wcmV2aWV3LXN0YXR1cy1pbmZvIiwgKCkgPT4gdGhpcy5fR2V0UmVtb3RlUHJldmlld1N0YXR1c0luZm8oKSk7CiAgICAgICAgdGhpcy5BZGRET01Db21wb25lbnRNZXNzYWdlSGFuZGxlcigicnVudGltZSIsICJqcy1pbnZva2UtZnVuY3Rpb24iLCBiID0+IHRoaXMuX0ludm9rZUZ1bmN0aW9uRnJvbUpTKGIpKTsKICAgICAgICB0aGlzLkFkZERPTUNvbXBvbmVudE1lc3NhZ2VIYW5kbGVyKCJydW50aW1lIiwgImdvLXRvLWxhc3QtZXJyb3Itc2NyaXB0Iiwgc2VsZi5nb1RvTGFzdEVycm9yU2NyaXB0KTsKICAgICAgICB0aGlzLkFkZERPTUNvbXBvbmVudE1lc3NhZ2VIYW5kbGVyKCJydW50aW1lIiwgIm9mZmxpbmUtYXVkaW8tcmVuZGVyLWNvbXBsZXRlZCIsIGIgPT4gdGhpcy5fT25PZmZsaW5lQXVkaW9SZW5kZXJDb21wbGV0ZWQoYikpOwogICAgICAgIHRoaXMuX2Rpc3BhdGNoZXIuYWRkRXZlbnRMaXN0ZW5lcigid2luZG93LWJsdXIiLCBiID0+IHRoaXMuX09uV2luZG93Qmx1cihiKSk7CiAgICAgICAgdGhpcy5fZGlzcGF0Y2hlci5hZGRFdmVudExpc3RlbmVyKCJ3aW5kb3ctZm9jdXMiLCAoKSA9PiB0aGlzLl9PbldpbmRvd0ZvY3VzKCkpOwogICAgICAgIHRoaXMuX3RpbWVsaW5lTWFuYWdlci5BZGRSdW50aW1lTGlzdGVuZXJzKCk7CiAgICAgICAgdGhpcy5fdGVtcGxhdGVNYW5hZ2VyLkFkZFJ1bnRpbWVMaXN0ZW5lcnMoKTsKICAgICAgICB0aGlzLl9pUnVudGltZSA9IG51bGw7CiAgICAgICAgdGhpcy5faW50ZXJmYWNlTWFwID0gbmV3IFdlYWtNYXA7CiAgICAgICAgdGhpcy5fY29tbW9uU2NyaXB0SW50ZXJmYWNlcyA9IHsKICAgICAgICAgICAga2V5Ym9hcmQ6IG51bGwsCiAgICAgICAgICAgIG1vdXNlOiBudWxsLAogICAgICAgICAgICB0b3VjaDogbnVsbAogICAgICAgIH0KICAgIH0KICAgIHN0YXRpYyBDcmVhdGUoYSkgewogICAgICAgIHJldHVybiBDMyRqc2NvbXAkMTcwLk5ldyhDMyRqc2NvbXAkMTcwLlJ1bnRpbWUsCiAgICAgICAgICAgIGEpCiAgICB9CiAgICBSZWxlYXNlKCkgewogICAgICAgIEMzJGpzY29tcCQxNzAuY2xlYXJBcnJheSh0aGlzLl9hbGxPYmplY3RDbGFzc2VzKTsKICAgICAgICB0aGlzLl9vYmplY3RDbGFzc2VzQnlOYW1lLmNsZWFyKCk7CiAgICAgICAgdGhpcy5fb2JqZWN0Q2xhc3Nlc0J5U2lkLmNsZWFyKCk7CiAgICAgICAgdGhpcy5fbGF5b3V0TWFuYWdlci5SZWxlYXNlKCk7CiAgICAgICAgdGhpcy5fbGF5b3V0TWFuYWdlciA9IG51bGw7CiAgICAgICAgdGhpcy5fZXZlbnRTaGVldE1hbmFnZXIuUmVsZWFzZSgpOwogICAgICAgIHRoaXMuX2V2ZW50U2hlZXRNYW5hZ2VyID0gbnVsbDsKICAgICAgICB0aGlzLl9wbHVnaW5NYW5hZ2VyLlJlbGVhc2UoKTsKICAgICAgICB0aGlzLl9wbHVnaW5NYW5hZ2VyID0gbnVsbDsKICAgICAgICB0aGlzLl9hc3NldE1hbmFnZXIuUmVsZWFzZSgpOwogICAgICAgIHRoaXMuX2Fzc2V0TWFuYWdlciA9IG51bGw7CiAgICAgICAgdGhpcy5fY29sbGlzaW9uRW5naW5lLlJlbGVhc2UoKTsKICAgICAgICB0aGlzLl9jb2xsaXNpb25FbmdpbmUgPSBudWxsOwogICAgICAgIHRoaXMuX3RpbWVsaW5lTWFuYWdlci5SZWxlYXNlKCk7CiAgICAgICAgdGhpcy5fdGltZWxpbmVNYW5hZ2VyID0gbnVsbDsKICAgICAgICB0aGlzLl90cmFuc2l0aW9uTWFuYWdlci5SZWxlYXNlKCk7CiAgICAgICAgdGhpcy5fdHJhbnNpdGlvbk1hbmFnZXIgPSBudWxsOwogICAgICAgIHRoaXMuX3RlbXBsYXRlTWFuYWdlci5SZWxlYXNlKCk7CiAgICAgICAgdGhpcy5fdGVtcGxhdGVNYW5hZ2VyID0gbnVsbDsKICAgICAgICB0aGlzLl9jYW52YXNNYW5hZ2VyICYmICh0aGlzLl9jYW52YXNNYW5hZ2VyLlJlbGVhc2UoKSwgdGhpcy5fY2FudmFzTWFuYWdlciA9IG51bGwpOwogICAgICAgIHRoaXMuX2Rpc3BhdGNoZXIuUmVsZWFzZSgpOwogICAgICAgIHRoaXMuX3RpY2tFdmVudCA9IHRoaXMuX2Rpc3BhdGNoZXIgPSBudWxsCiAgICB9CiAgICBfT25NZXNzYWdlRnJvbURPTShhKSB7CiAgICAgICAgY29uc3QgYiA9IGEudHlwZTsKICAgICAgICBpZiAoImV2ZW50IiA9PT0gYikgdGhpcy5fT25FdmVudEZyb21ET00oYSk7CiAgICAgICAgZWxzZSBpZiAoInJlc3VsdCIgPT09IGIpIHRoaXMuX09uUmVzdWx0RnJvbURPTShhKTsKICAgICAgICBlbHNlIHRocm93IEVycm9yKGB1bmtub3duIG1lc3NhZ2UgJyR7Yn0nYCk7CiAgICB9CiAgICBfT25FdmVudEZyb21ET00oYSkgewogICAgICAgIGlmICh0aGlzLl9pc1JlYWR5VG9IYW5kbGVFdmVudHMpIHsKICAgICAgICAgICAgdmFyIGIgPSBhLmNvbXBvbmVudCwKICAgICAgICAgICAgICAgIGQgPSBhLmhhbmRsZXIsCiAgICAgICAgICAgICAgICBjID0gYS5kYXRhLAogICAgICAgICAgICAgICAgZSA9IGEuZGlzcGF0Y2hPcHRzLAogICAgICAgICAgICAgICAgZyA9ICEoIWUgfHwgIWUuZGlzcGF0Y2hSdW50aW1lRXZlbnQpOwogICAgICAgICAgICBlID0gISghZSB8fCAhZS5kaXNwYXRjaFVzZXJTY3JpcHRFdmVudCk7CiAgICAgICAgICAgIHZhciBrID0gYS5yZXNwb25zZUlkOwogICAgICAgICAgICBpZiAoInJ1bnRpbWUiID09PSBiICYmIChnICYmIChhID0gbmV3IEMzJGpzY29tcCQxNzAuRXZlbnQoZCksIGEuZGF0YSA9IGMsIHRoaXMuX2Rpc3BhdGNoZXIuZGlzcGF0Y2hFdmVudEFuZFdhaXRBc3luY1NlcXVlbnRpYWwoYSkpLCBlKSkgewogICAgICAgICAgICAgICAgYSA9IG5ldyBDMyRqc2NvbXAkMTcwLkV2ZW50KGQsICEwKTsKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgW20sIG5dIG9mIE9iamVjdC5lbnRyaWVzKGMpKSBhW21dID0gbjsKICAgICAgICAgICAgICAgIHRoaXMuRGlzcGF0Y2hVc2VyU2NyaXB0RXZlbnQoYSkKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoYSA9IHRoaXMuX2RvbUV2ZW50SGFuZGxlcnMuZ2V0KGIpKQogICAgICAgICAgICAgICAgaWYgKGEgPSBhLmdldChkKSkgewogICAgICAgICAgICAgICAgICAgIGcgPSBudWxsOwogICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGcgPSBhKGMpCiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAobSkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGBFeGNlcHRpb24gaW4gJyR7Yn0nIGhhbmRsZXIgJyR7ZH0nOmAsIG0pOwogICAgICAgICAgICAgICAgICAgICAgICBudWxsICE9PSBrICYmIHRoaXMuX1Bvc3RSZXN1bHRUb0RPTShrLCAhMSwgIiIgKyBtKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIG51bGwgIT09CiAgICAgICAgICAgICAgICAgICAgICAgIGsgJiYgKGcgJiYgZy50aGVuID8gZy50aGVuKG0gPT4gdGhpcy5fUG9zdFJlc3VsdFRvRE9NKGssICEwLCBtKSkuY2F0Y2gobSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGBSZWplY3Rpb24gZnJvbSAnJHtifScgaGFuZGxlciAnJHtkfSc6YCwgbSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9Qb3N0UmVzdWx0VG9ET00oaywgITEsICIiICsgbSkKICAgICAgICAgICAgICAgICAgICAgICAgfSkgOiB0aGlzLl9Qb3N0UmVzdWx0VG9ET00oaywgITAsIGcpKQogICAgICAgICAgICAgICAgfSBlbHNlIGcgfHwgZSB8fCBjb25zb2xlLndhcm4oYFtSdW50aW1lXSBObyBET00gaGFuZGxlciAnJHtkfScgZm9yIGNvbXBvbmVudCAnJHtifSdgKTsKICAgICAgICAgICAgZWxzZSBnIHx8IGUgfHwgY29uc29sZS53YXJuKGBbUnVudGltZV0gTm8gRE9NIGV2ZW50IGhhbmRsZXJzIGZvciBjb21wb25lbnQgJyR7Yn0nYCkKICAgICAgICB9IGVsc2UgdGhpcy5fd2FpdGluZ1RvSGFuZGxlRXZlbnRzLnB1c2goYSkKICAgIH0KICAgIF9Qb3N0UmVzdWx0VG9ET00oYSwgYiwgZCkgewogICAgICAgIHRoaXMuX21lc3NhZ2VQb3J0LnBvc3RNZXNzYWdlKHsKICAgICAgICAgICAgdHlwZTogInJlc3VsdCIsCiAgICAgICAgICAgIHJlc3BvbnNlSWQ6IGEsCiAgICAgICAgICAgIGlzT2s6IGIsCiAgICAgICAgICAgIHJlc3VsdDogZAogICAgICAgIH0pCiAgICB9CiAgICBfT25SZXN1bHRGcm9tRE9NKGEpIHsKICAgICAgICBjb25zdCBiID0KICAgICAgICAgICAgYS5yZXNwb25zZUlkLAogICAgICAgICAgICBkID0gYS5pc09rOwogICAgICAgIGEgPSBhLnJlc3VsdDsKICAgICAgICBjb25zdCBjID0gdGhpcy5fcGVuZGluZ1Jlc3BvbnNlUHJvbWlzZXMuZ2V0KGIpOwogICAgICAgIGQgPyBjLnJlc29sdmUoYSkgOiBjLnJlamVjdChhKTsKICAgICAgICB0aGlzLl9wZW5kaW5nUmVzcG9uc2VQcm9taXNlcy5kZWxldGUoYikKICAgIH0KICAgIEFkZERPTUNvbXBvbmVudE1lc3NhZ2VIYW5kbGVyKGEsIGIsIGQpIHsKICAgICAgICBsZXQgYyA9IHRoaXMuX2RvbUV2ZW50SGFuZGxlcnMuZ2V0KGEpOwogICAgICAgIGMgfHwgKGMgPSBuZXcgTWFwLCB0aGlzLl9kb21FdmVudEhhbmRsZXJzLnNldChhLCBjKSk7CiAgICAgICAgaWYgKGMuaGFzKGIpKSB0aHJvdyBFcnJvcihgW1J1bnRpbWVdIENvbXBvbmVudCAnJHthfScgYWxyZWFkeSBoYXMgaGFuZGxlciAnJHtifSdgKTsKICAgICAgICBjLnNldChiLCBkKQogICAgfQogICAgUG9zdENvbXBvbmVudE1lc3NhZ2VUb0RPTShhLCBiLCBkLCBjKSB7CiAgICAgICAgdGhpcy5fbWVzc2FnZVBvcnQucG9zdE1lc3NhZ2UoewogICAgICAgICAgICB0eXBlOiAiZXZlbnQiLAogICAgICAgICAgICBjb21wb25lbnQ6IGEsCiAgICAgICAgICAgIGhhbmRsZXI6IGIsCiAgICAgICAgICAgIGRhdGE6IGQsCiAgICAgICAgICAgIHJlc3BvbnNlSWQ6IG51bGwKICAgICAgICB9LCBjKQogICAgfQogICAgUG9zdENvbXBvbmVudE1lc3NhZ2VUb0RPTUFzeW5jKGEsCiAgICAgICAgYiwgZCwgYykgewogICAgICAgIGNvbnN0IGUgPSB0aGlzLl9uZXh0RG9tUmVzcG9uc2VJZCsrLAogICAgICAgICAgICBnID0gbmV3IFByb21pc2UoKGssIG0pID0+IHsKICAgICAgICAgICAgICAgIHRoaXMuX3BlbmRpbmdSZXNwb25zZVByb21pc2VzLnNldChlLCB7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZTogaywKICAgICAgICAgICAgICAgICAgICByZWplY3Q6IG0KICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0pOwogICAgICAgIHRoaXMuX21lc3NhZ2VQb3J0LnBvc3RNZXNzYWdlKHsKICAgICAgICAgICAgdHlwZTogImV2ZW50IiwKICAgICAgICAgICAgY29tcG9uZW50OiBhLAogICAgICAgICAgICBoYW5kbGVyOiBiLAogICAgICAgICAgICBkYXRhOiBkLAogICAgICAgICAgICByZXNwb25zZUlkOiBlCiAgICAgICAgfSwgYyk7CiAgICAgICAgcmV0dXJuIGcKICAgIH0KICAgIFBvc3RUb0RlYnVnZ2VyKGEpIHsKICAgICAgICBpZiAoIXRoaXMuSXNEZWJ1ZygpKSB0aHJvdyBFcnJvcigibm90IGluIGRlYnVnIG1vZGUiKTsKICAgICAgICB0aGlzLlBvc3RDb21wb25lbnRNZXNzYWdlVG9ET00oInJ1bnRpbWUiLCAicG9zdC10by1kZWJ1Z2dlciIsIGEpCiAgICB9CiAgICBhc3luYyBJbml0KGEpIHsKICAgICAgICB0aGlzLklzRGVidWcoKSA/IGF3YWl0IEMzRGVidWdnZXIkanNjb21wJDMuSW5pdCh0aGlzKSA6IHNlbGYuQzNEZWJ1Z2dlciAmJiBzZWxmLkMzRGVidWdnZXIuSW5pdFByZXZpZXcodGhpcyk7CiAgICAgICAgdmFyIFtiXSA9IGF3YWl0IFByb21pc2UuYWxsKFt0aGlzLl9hc3NldE1hbmFnZXIuRmV0Y2hKc29uKCJkYXRhLmpzb24iKSwKICAgICAgICAgICAgdGhpcy5fTWF5YmVMb2FkT3B1c0RlY29kZXIoKSwgdGhpcy5fam9iU2NoZWR1bGVyLkluaXQoKQogICAgICAgIF0pOwogICAgICAgIGF3YWl0IHRoaXMuX0xvYWREYXRhSnNvbihiKTsKICAgICAgICBhd2FpdCB0aGlzLl9Jbml0aWFsaXNlQ2FudmFzKGEpOwogICAgICAgIHRoaXMuSXNQcmV2aWV3KCkgfHwgY29uc29sZS5pbmZvKCJNYWRlIHdpdGggQ29uc3RydWN0LCB0aGUgZ2FtZSBhbmQgYXBwIGNyZWF0b3IgOjogaHR0cHM6Ly93d3cuY29uc3RydWN0Lm5ldCIpOwogICAgICAgIHRoaXMuR2V0V2ViR0xSZW5kZXJlcigpID8gKGIgPSB0aGlzLkdldFdlYkdMUmVuZGVyZXIoKSwgY29uc29sZS5pbmZvKGBbQzMgcnVudGltZV0gSG9zdGVkIGluICR7dGhpcy5Jc0luV29ya2VyKCk/IndvcmtlciI6IkRPTSJ9LCByZW5kZXJpbmcgd2l0aCBXZWJHTCAke2IuR2V0V2ViR0xWZXJzaW9uTnVtYmVyKCl9IFske2IuR2V0VW5tYXNrZWRSZW5kZXJlcigpfV0gKCR7Yi5Jc0Rlc3luY2hyb25pemVkKCk/ImRlc3luY2hyb25pemVkIjoic3RhbmRhcmQifSBjb21wb3NpdGluZylgKSkgOiB0aGlzLkdldFdlYkdQVVJlbmRlcmVyKCkgJiYKICAgICAgICAgICAgY29uc29sZS5pbmZvKGBbQzMgcnVudGltZV0gSG9zdGVkIGluICR7dGhpcy5Jc0luV29ya2VyKCk/IndvcmtlciI6IkRPTSJ9LCByZW5kZXJpbmcgd2l0aCBleHBlcmltZW50YWwgV2ViR1BVYCk7CiAgICAgICAgdGhpcy5HZXRSZW5kZXJlcigpLkhhc01ham9yUGVyZm9ybWFuY2VDYXZlYXQoKSAmJiBjb25zb2xlLndhcm4oIltDMyBydW50aW1lXSBUaGUgcmVuZGVyZXIgaW5kaWNhdGVzIGEgbWFqb3IgcGVyZm9ybWFuY2UgY2F2ZWF0LiBTb2Z0d2FyZSByZW5kZXJpbmcgbWF5IGJlIGluIHVzZS4gVGhpcyBjYW4gcmVzdWx0IGluIHNpZ25pZmljYW50bHkgZGVncmFkZWQgcGVyZm9ybWFuY2UuIik7CiAgICAgICAgdGhpcy5faXNSZWFkeVRvSGFuZGxlRXZlbnRzID0gITA7CiAgICAgICAgZm9yIChjb25zdCBkIG9mIHRoaXMuX3dhaXRpbmdUb0hhbmRsZUV2ZW50cykgdGhpcy5fT25FdmVudEZyb21ET00oZCk7CiAgICAgICAgQzMkanNjb21wJDE3MC5jbGVhckFycmF5KHRoaXMuX3dhaXRpbmdUb0hhbmRsZUV2ZW50cyk7CiAgICAgICAgdGhpcy5fY2FudmFzTWFuYWdlciAmJgogICAgICAgICAgICB0aGlzLl9jYW52YXNNYW5hZ2VyLlN0YXJ0TG9hZGluZ1NjcmVlbigpOwogICAgICAgIGZvciAoY29uc3QgZCBvZiBhLnJ1bk9uU3RhcnR1cEZ1bmN0aW9ucykgdGhpcy5fYWRkaXRpb25hbExvYWRQcm9taXNlcy5wdXNoKHRoaXMuX1J1bk9uU3RhcnR1cEZ1bmN0aW9uKGQpKTsKICAgICAgICBhd2FpdCBQcm9taXNlLmFsbChbdGhpcy5fYXNzZXRNYW5hZ2VyLldhaXRGb3JBbGxUb0xvYWQoKSwgLi4udGhpcy5fYWRkaXRpb25hbExvYWRQcm9taXNlc10pOwogICAgICAgIEMzJGpzY29tcCQxNzAuY2xlYXJBcnJheSh0aGlzLl9hZGRpdGlvbmFsTG9hZFByb21pc2VzKTsKICAgICAgICBpZiAodGhpcy5fYXNzZXRNYW5hZ2VyLkhhc0hhZEVycm9yTG9hZGluZygpKSB0aGlzLl9jYW52YXNNYW5hZ2VyICYmIHRoaXMuX2NhbnZhc01hbmFnZXIuSGlkZUNvcmRvdmFTcGxhc2hTY3JlZW4oKTsKICAgICAgICBlbHNlIHJldHVybiB0aGlzLl9jYW52YXNNYW5hZ2VyICYmIGF3YWl0IHRoaXMuX2NhbnZhc01hbmFnZXIuRW5kTG9hZGluZ1NjcmVlbigpLCBhd2FpdCB0aGlzLl9kaXNwYXRjaGVyLmRpc3BhdGNoRXZlbnRBbmRXYWl0QXN5bmMobmV3IEMzJGpzY29tcCQxNzAuRXZlbnQoImJlZm9yZXJ1bnRpbWVzdGFydCIpKSwKICAgICAgICAgICAgYXdhaXQgdGhpcy5TdGFydCgpLCB0aGlzLl9tZXNzYWdlUG9ydC5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgICAgICB0eXBlOiAicnVudGltZS1yZWFkeSIKICAgICAgICAgICAgfSksIHRoaXMKICAgIH0KICAgIGFzeW5jIF9SdW5PblN0YXJ0dXBGdW5jdGlvbihhKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXdhaXQgYSh0aGlzLl9pUnVudGltZSkKICAgICAgICB9IGNhdGNoIChiKSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIltDMyBydW50aW1lXSBFcnJvciBpbiBydW5PblN0YXJ0dXAgZnVuY3Rpb246ICIsIGIpCiAgICAgICAgfQogICAgfQogICAgYXN5bmMgX0xvYWREYXRhSnNvbihhKSB7CiAgICAgICAgYSA9IGEucHJvamVjdDsKICAgICAgICB0aGlzLl9wcm9qZWN0TmFtZSA9IGFbMF07CiAgICAgICAgdGhpcy5fcHJvamVjdFZlcnNpb24gPSBhWzE2XTsKICAgICAgICB0aGlzLl9wcm9qZWN0VW5pcXVlSWQgPSBhWzMxXTsKICAgICAgICB0aGlzLl9hcHBJZCA9IGFbMzhdOwogICAgICAgIHZhciBiID0gYVszOV0gfHwgImxvYWRpbmctbG9nby5wbmciOwogICAgICAgIHRoaXMuX2lzUGl4ZWxSb3VuZGluZ0VuYWJsZWQgPSAhIWFbOV07CiAgICAgICAgdGhpcy5fb3JpZ2luYWxWaWV3cG9ydFdpZHRoID0gdGhpcy5fdmlld3BvcnRXaWR0aCA9IGFbMTBdOwogICAgICAgIHRoaXMuX29yaWdpbmFsVmlld3BvcnRIZWlnaHQgPSB0aGlzLl92aWV3cG9ydEhlaWdodCA9CiAgICAgICAgICAgIGFbMTFdOwogICAgICAgIHRoaXMuX3BhcmFsbGF4WG9yaWdpbiA9IHRoaXMuX29yaWdpbmFsVmlld3BvcnRXaWR0aCAvIDI7CiAgICAgICAgdGhpcy5fcGFyYWxsYXhZb3JpZ2luID0gdGhpcy5fb3JpZ2luYWxWaWV3cG9ydEhlaWdodCAvIDI7CiAgICAgICAgdGhpcy5fY29tcG9zaXRpbmdNb2RlID0gYVszNl07CiAgICAgICAgdGhpcy5fZnJhbWVyYXRlTW9kZSA9IGFbMzddOwogICAgICAgICJsb3ctbGF0ZW5jeSIgPT09IHRoaXMuX2NvbXBvc2l0aW5nTW9kZSAmJiB0aGlzLklzQW5kcm9pZFdlYlZpZXcoKSAmJiA3NyA+PSBDMyRqc2NvbXAkMTcwLlBsYXRmb3JtLkJyb3dzZXJWZXJzaW9uTnVtYmVyICYmIChjb25zb2xlLndhcm4oIltDMyBydW50aW1lXSBEZXN5bmNocm9uaXplZCAobG93LWxhdGVuY3kpIGNvbXBvc2l0aW5nIGlzIGVuYWJsZWQsIGJ1dCBpcyBkaXNhYmxlZCBpbiB0aGUgQW5kcm9pZCBXZWJWaWV3IDw9NzcgZHVlIHRvIGNyYnVnLmNvbS8xMDA4ODQyLiBSZXZlcnRpbmcgdG8gc3luY2hyb25pemVkIChzdGFuZGFyZCkgY29tcG9zaXRpbmcuIiksIHRoaXMuX2NvbXBvc2l0aW5nTW9kZSA9CiAgICAgICAgICAgICJzdGFuZGFyZCIpOwogICAgICAgIHRoaXMuX3VzZXMzZEZlYXR1cmVzID0gISFhWzQwXTsKICAgICAgICB0aGlzLl9zYW1wbGluZyA9IGFbMTRdOwogICAgICAgIHRoaXMuX3VzZXNBbnlCYWNrZ3JvdW5kQmxlbmRpbmcgPSBhWzE1XTsKICAgICAgICB0aGlzLl91c2VzQW55Q3Jvc3NTYW1wbGluZyA9IGFbNDJdOwogICAgICAgIHRoaXMuX3VzZXNBbnlEZXB0aFNhbXBsaW5nID0gYVsxN107CiAgICAgICAgdGhpcy5fdXNlc0xvYWRlckxheW91dCA9ICEhYVsxOF07CiAgICAgICAgdGhpcy5fbG9hZGVyU3R5bGUgPSBhWzE5XTsKICAgICAgICB0aGlzLl9uZXh0VWlkID0gYVsyMV07CiAgICAgICAgdGhpcy5fcGF1c2VPbkJsdXIgPSBhWzIyXTsKICAgICAgICBjb25zdCBkID0gdGhpcy5fYXNzZXRNYW5hZ2VyOwogICAgICAgIGQuX1NldEZpbGVTdHJ1Y3R1cmUoYVs0NV0pOwogICAgICAgIGQuX1NldEF1ZGlvRmlsZXMoYVs3XSwgYVsyNV0pOwogICAgICAgIGQuX1NldE1lZGlhU3ViZm9sZGVyKGFbOF0pOwogICAgICAgIGQuX1NldEZvbnRzU3ViZm9sZGVyKGFbMzJdKTsKICAgICAgICBkLl9TZXRJY29uc1N1YmZvbGRlcihhWzI4XSk7CiAgICAgICAgZC5fU2V0V2ViRm9udHMoYVsyOV0pOwogICAgICAgIGlmICgwID09PSB0aGlzLl9sb2FkZXJTdHlsZSkgewogICAgICAgICAgICBsZXQgbSA9ICIiOwogICAgICAgICAgICB0aGlzLklzUHJldmlldygpID8KICAgICAgICAgICAgICAgIGQuX0hhc0xvY2FsVXJsQmxvYihiKSAmJiAobSA9IGQuR2V0TG9jYWxVcmxBc0Jsb2JVcmwoYikpIDogbSA9ICJmbGF0IiA9PT0gZC5HZXRGaWxlU3RydWN0dXJlKCkgPyBkLkdldEljb25zU3ViZm9sZGVyKCkgKyBiIDogYjsKICAgICAgICAgICAgbSAmJiAodGhpcy5fbG9hZGluZ0xvZ29Bc3NldCA9IGQuTG9hZEltYWdlKHsKICAgICAgICAgICAgICAgIHVybDogbQogICAgICAgICAgICB9KSkKICAgICAgICB9CiAgICAgICAgdGhpcy5fY2FudmFzTWFuYWdlciAmJiAodGhpcy5fY2FudmFzTWFuYWdlci5TZXRGdWxsc2NyZWVuTW9kZShDMyRqc2NvbXAkMTcwLkNhbnZhc01hbmFnZXIuX0Z1bGxzY3JlZW5Nb2RlTnVtYmVyVG9TdHJpbmcoYVsxMl0pKSwgdGhpcy5fY2FudmFzTWFuYWdlci5TZXRGdWxsc2NyZWVuU2NhbGluZ1F1YWxpdHkoYVsyM10gPyAiaGlnaCIgOiAibG93IiksIHRoaXMuX2NhbnZhc01hbmFnZXIuU2V0TWlwbWFwc0VuYWJsZWQoMCAhPT0gYVsyNF0pLCB0aGlzLl9jYW52YXNNYW5hZ2VyLl9TZXRHUFVQb3dlclByZWZlcmVuY2UoYVszNF0pLCB0aGlzLl9jYW52YXNNYW5hZ2VyLl9TZXRUZXh0dXJlQW5pc290cm9weShhWzQxXSksCiAgICAgICAgICAgIHRoaXMuX2NhbnZhc01hbmFnZXIuX1NldFdlYkdQVUVuYWJsZWQoYVsxM10pLCB0aGlzLl9jYW52YXNNYW5hZ2VyLl9TZXRaQXhpc1NjYWxlKGFbMzBdKSwgdGhpcy5fY2FudmFzTWFuYWdlci5fU2V0RmllbGRPZlZpZXcoYVsyNl0pKTsKICAgICAgICAoYiA9IGFbNDNdKSAmJiBhd2FpdCB0aGlzLl9Mb2FkRXhwb3J0VG9WaWRlb0RhdGEoYik7CiAgICAgICAgdGhpcy5fcGx1Z2luTWFuYWdlci5DcmVhdGVTeXN0ZW1QbHVnaW4oKTsKICAgICAgICB0aGlzLl9vYmplY3RSZWZlcmVuY2VUYWJsZSA9IHNlbGYuQzNfR2V0T2JqZWN0UmVmVGFibGUoKTsKICAgICAgICBmb3IgKHZhciBjIG9mIGFbMl0pIHRoaXMuX3BsdWdpbk1hbmFnZXIuQ3JlYXRlUGx1Z2luKGMpOwogICAgICAgIHRoaXMuX29iamVjdFJlZmVyZW5jZVRhYmxlID0gc2VsZi5DM19HZXRPYmplY3RSZWZUYWJsZSgpOwogICAgICAgIHRoaXMuX0xvYWRKc1Byb3BOYW1lVGFibGUoKTsKICAgICAgICBmb3IgKHZhciBlIG9mIGFbM10pIGMgPSBDMyRqc2NvbXAkMTcwLk9iamVjdENsYXNzLkNyZWF0ZSh0aGlzLCB0aGlzLl9hbGxPYmplY3RDbGFzc2VzLmxlbmd0aCwgZSksCiAgICAgICAgICAgIHRoaXMuX2FsbE9iamVjdENsYXNzZXMucHVzaChjKSwgdGhpcy5fb2JqZWN0Q2xhc3Nlc0J5TmFtZS5zZXQoYy5HZXROYW1lKCkudG9Mb3dlckNhc2UoKSwgYyksIHRoaXMuX29iamVjdENsYXNzZXNCeVNpZC5zZXQoYy5HZXRTSUQoKSwgYyk7CiAgICAgICAgZm9yIChjb25zdCBtIG9mIGFbNF0pIHRoaXMuX2FsbE9iamVjdENsYXNzZXNbbVswXV0uX0xvYWRGYW1pbHkobSk7CiAgICAgICAgZm9yICh2YXIgZyBvZiBhWzI3XSkgZSA9IGcubWFwKG0gPT4gdGhpcy5fYWxsT2JqZWN0Q2xhc3Nlc1ttXSksIHRoaXMuX2FsbENvbnRhaW5lcnMucHVzaChDMyRqc2NvbXAkMTcwLk5ldyhDMyRqc2NvbXAkMTcwLkNvbnRhaW5lciwgdGhpcywgZSkpOwogICAgICAgIGZvciAoY29uc3QgbSBvZiB0aGlzLl9hbGxPYmplY3RDbGFzc2VzKSBtLl9PbkFmdGVyQ3JlYXRlKCk7CiAgICAgICAgZm9yIChjb25zdCBtIG9mIGFbNV0pIHRoaXMuX2xheW91dE1hbmFnZXIuQ3JlYXRlKG0pOwogICAgICAgIChnID0gYVsxXSkgJiYgKGcgPSB0aGlzLl9sYXlvdXRNYW5hZ2VyLkdldExheW91dEJ5TmFtZShnKSkgJiYgdGhpcy5fbGF5b3V0TWFuYWdlci5TZXRGaXJzdExheW91dChnKTsKICAgICAgICBmb3IgKHZhciBrIG9mIGFbMzNdKSB0aGlzLl90aW1lbGluZU1hbmFnZXIuQ3JlYXRlKGspOwogICAgICAgIGZvciAoY29uc3QgbSBvZiBhWzM1XSkgdGhpcy5fdHJhbnNpdGlvbk1hbmFnZXIuQ3JlYXRlKG0pOwogICAgICAgIGZvciAoY29uc3QgbSBvZiBhWzQ0XSkgdGhpcy5fdGVtcGxhdGVNYW5hZ2VyLkNyZWF0ZShtKTsKICAgICAgICB0aGlzLl90ZW1wbGF0ZU1hbmFnZXIuSGFzVGVtcGxhdGVzKCkgfHwgKHRoaXMuX3RlbXBsYXRlTWFuYWdlci5SZWxlYXNlKCksIHRoaXMuX3RlbXBsYXRlTWFuYWdlciA9IG51bGwpOwogICAgICAgIHRoaXMuX0luaXRTY3JpcHRJbnRlcmZhY2VzKCk7CiAgICAgICAgZm9yIChjb25zdCBtIG9mIGFbNl0pIHRoaXMuX2V2ZW50U2hlZXRNYW5hZ2VyLkNyZWF0ZShtKTsKICAgICAgICB0aGlzLl9ldmVudFNoZWV0TWFuYWdlci5fUG9zdEluaXQoKTsKICAgICAgICB0aGlzLl9Jbml0R2xvYmFsVmFyaWFibGVTY3JpcHRJbnRlcmZhY2UoKTsKICAgICAgICBDMyRqc2NvbXAkMTcwLmNsZWFyQXJyYXkodGhpcy5fb2JqZWN0UmVmZXJlbmNlVGFibGUpOwogICAgICAgIHRoaXMuRmx1c2hQZW5kaW5nSW5zdGFuY2VzKCk7CiAgICAgICAgayA9ICJhbnkiOwogICAgICAgIGEgPSBhWzIwXTsKICAgICAgICAxID09PSBhID8gayA9ICJwb3J0cmFpdCIgOiAyID09PSBhICYmIChrID0gImxhbmRzY2FwZSIpOwogICAgICAgIHRoaXMuUG9zdENvbXBvbmVudE1lc3NhZ2VUb0RPTSgicnVudGltZSIsICJzZXQtdGFyZ2V0LW9yaWVudGF0aW9uIiwgewogICAgICAgICAgICB0YXJnZXRPcmllbnRhdGlvbjogawogICAgICAgIH0pCiAgICB9CiAgICBhc3luYyBfTG9hZEV4cG9ydFRvVmlkZW9EYXRhKGEpIHsKICAgICAgICBjb25zdCBiID0gYS5mb3JtYXQ7CiAgICAgICAgImltYWdlLXNlcXVlbmNlIiA9PT0gYiA/IHRoaXMuX2V4cG9ydFRvVmlkZW8gPSBuZXcgc2VsZi5DM0V4cG9ydFRvSW1hZ2VTZXF1ZW5jZSh0aGlzLCBhKSA6ICJpbWFnZS1zZXF1ZW5jZS1naWYiID09PSBiID8gdGhpcy5fZXhwb3J0VG9WaWRlbyA9IG5ldyBzZWxmLkMzRXhwb3J0VG9HSUYodGhpcywgYSkgOiAid2VibSIgPT09IGIgPyB0aGlzLl9leHBvcnRUb1ZpZGVvID0gbmV3IHNlbGYuQzNFeHBvcnRUb1dlYk1WaWRlbyh0aGlzLCBhKSA6ICJtcDQiID09PSBiICYmICh0aGlzLl9leHBvcnRUb1ZpZGVvID0gbmV3IHNlbGYuQzNFeHBvcnRUb01QNFZpZGVvKHRoaXMsIGEpKTsKICAgICAgICB0aGlzLl9mcmFtZXJhdGVNb2RlID0KICAgICAgICAgICAgInVubGltaXRlZC1mcmFtZSI7CiAgICAgICAgdGhpcy5fY2FudmFzTWFuYWdlci5TZXRGdWxsc2NyZWVuTW9kZSgib2ZmIik7CiAgICAgICAgdGhpcy5fZGV2aWNlUGl4ZWxSYXRpbyA9IDE7CiAgICAgICAgc2VsZi5kZXZpY2VQaXhlbFJhdGlvID0gMTsKICAgICAgICBhd2FpdCB0aGlzLlBvc3RDb21wb25lbnRNZXNzYWdlVG9ET01Bc3luYygicnVudGltZSIsICJzZXQtZXhwb3J0aW5nLXRvLXZpZGVvIiwgewogICAgICAgICAgICBtZXNzYWdlOiB0aGlzLl9leHBvcnRUb1ZpZGVvLkdldEV4cG9ydGluZ01lc3NhZ2VGb3JQZXJjZW50KDApLAogICAgICAgICAgICBkdXJhdGlvbjogdGhpcy5fZXhwb3J0VG9WaWRlby5HZXREdXJhdGlvbigpCiAgICAgICAgfSkKICAgIH0KICAgIEdldExvYWRlclN0eWxlKCkgewogICAgICAgIHJldHVybiB0aGlzLl9sb2FkZXJTdHlsZQogICAgfQogICAgSXNFeHBvcnRUb1ZpZGVvKCkgewogICAgICAgIHJldHVybiBudWxsICE9PSB0aGlzLl9leHBvcnRUb1ZpZGVvCiAgICB9CiAgICBHZXRFeHBvcnRWaWRlb0R1cmF0aW9uKCkgewogICAgICAgIHJldHVybiB0aGlzLl9leHBvcnRUb1ZpZGVvLkdldER1cmF0aW9uKCkKICAgIH0KICAgIEdldEV4cG9ydFZpZGVvRnJhbWVyYXRlKCkgewogICAgICAgIHJldHVybiB0aGlzLl9leHBvcnRUb1ZpZGVvLkdldEZyYW1lcmF0ZSgpCiAgICB9CiAgICBfSW5pdEV4cG9ydFRvVmlkZW8oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2V4cG9ydFRvVmlkZW8uSW5pdCh7CiAgICAgICAgICAgIHdpZHRoOiB0aGlzLl9jYW52YXNNYW5hZ2VyLkdldERldmljZVdpZHRoKCksCiAgICAgICAgICAgIGhlaWdodDogdGhpcy5fY2FudmFzTWFuYWdlci5HZXREZXZpY2VIZWlnaHQoKQogICAgICAgIH0pCiAgICB9CiAgICBfRXhwb3J0VG9WaWRlb0FkZEZyYW1lKCkgewogICAgICAgIGNvbnN0IGEgPSB0aGlzLl90aWNrQ291bnQgLyB0aGlzLkdldEV4cG9ydFZpZGVvRnJhbWVyYXRlKCk7CiAgICAgICAgcmV0dXJuIHRoaXMuX2V4cG9ydFRvVmlkZW8uQWRkRnJhbWUodGhpcy5fY2FudmFzTWFuYWdlci5HZXRDYW52YXMoKSwgYSkKICAgIH0KICAgIF9FeHBvcnRUb1ZpZGVvQWRkS2V5ZnJhbWUoKSB7CiAgICAgICAgdGhpcy5fZXhwb3J0VG9WaWRlbyAmJiB0aGlzLl9leHBvcnRUb1ZpZGVvLkFkZEtleWZyYW1lKCkKICAgIH0KICAgIF9Pbk9mZmxpbmVBdWRpb1JlbmRlckNvbXBsZXRlZChhKSB7CiAgICAgICAgdGhpcy5fZXhwb3J0VG9WaWRlby5Pbk9mZmxpbmVBdWRpb1JlbmRlckNvbXBsZXRlZChhKQogICAgfQogICAgX0V4cG9ydFRvVmlkZW9GaW5pc2goKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2V4cG9ydFRvVmlkZW8uRmluaXNoKCkKICAgIH0KICAgIElzRkJJbnN0YW50QXZhaWxhYmxlKCkgewogICAgICAgIHJldHVybiB0aGlzLl9pc0ZCSW5zdGFudEF2YWlsYWJsZQogICAgfQogICAgSXNMb2FkaW5nKCkgewogICAgICAgIHJldHVybiB0aGlzLl9pc0xvYWRpbmcKICAgIH0KICAgIEFkZExvYWRQcm9taXNlKGEpIHsKICAgICAgICB0aGlzLl9hZGRpdGlvbmFsTG9hZFByb21pc2VzLnB1c2goYSkKICAgIH0KICAgIFNldFVzaW5nQ3JlYXRlUHJvbWlzZXMoYSkgewogICAgICAgIHRoaXMuX2lzVXNpbmdDcmVhdGVQcm9taXNlcyA9ICEhYQogICAgfQogICAgQWRkQ3JlYXRlUHJvbWlzZShhKSB7CiAgICAgICAgdGhpcy5faXNVc2luZ0NyZWF0ZVByb21pc2VzICYmIHRoaXMuX2FkZGl0aW9uYWxDcmVhdGVQcm9taXNlcy5wdXNoKGEpCiAgICB9CiAgICBHZXRDcmVhdGVQcm9taXNlcygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fYWRkaXRpb25hbENyZWF0ZVByb21pc2VzCiAgICB9CiAgICBfR2V0TmV4dEZhbWlseUluZGV4KCkgewogICAgICAgIHJldHVybiB0aGlzLl9mYW1pbHlDb3VudCsrCiAgICB9CiAgICBHZXRGYW1pbHlDb3VudCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZmFtaWx5Q291bnQKICAgIH0KICAgIF9BZGRFZmZlY3RMaXN0KGEpIHsKICAgICAgICB0aGlzLl9hbGxFZmZlY3RMaXN0cy5wdXNoKGEpCiAgICB9CiAgICBfR2V0QWxsRWZmZWN0TGlzdHMoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2FsbEVmZmVjdExpc3RzCiAgICB9CiAgICBhc3luYyBfSW5pdGlhbGlzZUNhbnZhcyhhKSB7CiAgICAgICAgdGhpcy5fY2FudmFzTWFuYWdlciAmJiAoYXdhaXQgdGhpcy5fY2FudmFzTWFuYWdlci5DcmVhdGVDYW52YXMoYSksIHRoaXMuX2NhbnZhc01hbmFnZXIuSW5pdExvYWRpbmdTY3JlZW4odGhpcy5fbG9hZGVyU3R5bGUpKQogICAgfQogICAgYXN5bmMgX01heWJlTG9hZE9wdXNEZWNvZGVyKCkgewogICAgICAgIGlmICghdGhpcy5fYXNzZXRNYW5hZ2VyLklzQXVkaW9Gb3JtYXRTdXBwb3J0ZWQoImF1ZGlvL3dlYm07IGNvZGVjcz1vcHVzIikpIHsKICAgICAgICAgICAgdmFyIGEgPQogICAgICAgICAgICAgICAgbnVsbDsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGEgPSB0aGlzLklzaU9TQ29yZG92YSgpICYmIHRoaXMuX2Fzc2V0TWFuYWdlci5Jc0ZpbGVQcm90b2NvbCgpID8gYXdhaXQgdGhpcy5fYXNzZXRNYW5hZ2VyLkNvcmRvdmFGZXRjaExvY2FsRmlsZUFzQXJyYXlCdWZmZXIodGhpcy5fb3B1c1dhc21CaW5hcnlVcmwpIDogYXdhaXQgdGhpcy5fYXNzZXRNYW5hZ2VyLkZldGNoQXJyYXlCdWZmZXIodGhpcy5fb3B1c1dhc21CaW5hcnlVcmwpCiAgICAgICAgICAgIH0gY2F0Y2ggKGIpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuaW5mbygiRmFpbGVkIHRvIGZldGNoIE9wdXMgZGVjb2RlciBXQVNNOyBhc3N1bWluZyBwcm9qZWN0IGhhcyBubyBPcHVzIGF1ZGlvLiIsIGIpOwogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgYSA/IHRoaXMuQWRkSm9iV29ya2VyQnVmZmVyKGEsICJvcHVzLWRlY29kZXItd2FzbSIpIDogdGhpcy5BZGRKb2JXb3JrZXJCbG9iKG51bGwsICJvcHVzLWRlY29kZXItd2FzbSIpOwogICAgICAgICAgICBhd2FpdCB0aGlzLkFkZEpvYldvcmtlclNjcmlwdHMoW3RoaXMuX29wdXNXYXNtU2NyaXB0VXJsXSkKICAgICAgICB9CiAgICB9CiAgICBhc3luYyBfV2FzbURlY29kZVdlYk1PcHVzKGEpIHsKICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5BZGRKb2IoIk9wdXNEZWNvZGUiLCB7CiAgICAgICAgICAgIGFycmF5QnVmZmVyOiBhCiAgICAgICAgfSwgW2FdKQogICAgfQogICAgYXN5bmMgU3RhcnQoKSB7CiAgICAgICAgdGhpcy5faGFzU3RhcnRlZCA9ICEwOwogICAgICAgIHRoaXMuX3N0YXJ0VGltZSA9IERhdGUubm93KCk7CiAgICAgICAgaWYgKHRoaXMuX3VzZXNMb2FkZXJMYXlvdXQpIHsKICAgICAgICAgICAgZm9yICh2YXIgYSBvZiB0aGlzLl9hbGxPYmplY3RDbGFzc2VzKSBhLklzRmFtaWx5KCkgfHwgYS5Jc09uTG9hZGVyTGF5b3V0KCkgfHwgIWEuSXNXb3JsZFR5cGUoKSB8fCBhLk9uQ3JlYXRlKCk7CiAgICAgICAgICAgIHRoaXMuX2Fzc2V0TWFuYWdlci5XYWl0Rm9yQWxsVG9Mb2FkKCkudGhlbigoKSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLl9pc0xvYWRpbmcgPSAhMTsKICAgICAgICAgICAgICAgIHRoaXMuX09uTG9hZEZpbmlzaGVkKCkKICAgICAgICAgICAgfSkKICAgICAgICB9IGVsc2UgdGhpcy5faXNMb2FkaW5nID0gITE7CiAgICAgICAgdGhpcy5fYXNzZXRNYW5hZ2VyLlNldEluaXRpYWxMb2FkRmluaXNoZWQoKTsKICAgICAgICB0aGlzLklzRGVidWcoKSAmJiBDM0RlYnVnZ2VyJGpzY29tcCQzLlJ1bnRpbWVJbml0KGlmZSk7CiAgICAgICAgZm9yIChjb25zdCBiIG9mIHRoaXMuX2xheW91dE1hbmFnZXIuR2V0QWxsTGF5b3V0cygpKSBiLl9DcmVhdGVHbG9iYWxOb25Xb3JsZHMoKTsKICAgICAgICB0aGlzLklzRXhwb3J0VG9WaWRlbygpICYmIGF3YWl0IHRoaXMuX0luaXRFeHBvcnRUb1ZpZGVvKCk7CiAgICAgICAgYSA9IHRoaXMuX2xheW91dE1hbmFnZXIuR2V0Rmlyc3RMYXlvdXQoKTsKICAgICAgICBhd2FpdCBhLl9Mb2FkKG51bGwsIHRoaXMuR2V0UmVuZGVyZXIoKSk7CiAgICAgICAgYXdhaXQgYS5fU3RhcnRSdW5uaW5nKCEwKTsKICAgICAgICB0aGlzLl9mcHNMYXN0VGltZSA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICAgIHRoaXMuX3VzZXNMb2FkZXJMYXlvdXQgfHwgdGhpcy5fT25Mb2FkRmluaXNoZWQoKTsKICAgICAgICAoYXdhaXQgdGhpcy5Qb3N0Q29tcG9uZW50TWVzc2FnZVRvRE9NQXN5bmMoInJ1bnRpbWUiLCAiYmVmb3JlLXN0YXJ0LXRpY2tpbmciKSkuaXNTdXNwZW5kZWQgJiYgIXRoaXMuSXNFeHBvcnRUb1ZpZGVvKCkgPyB0aGlzLl9zdXNwZW5kQ291bnQrKyA6IHRoaXMuVGljaygpCiAgICB9CiAgICBfT25Mb2FkRmluaXNoZWQoKSB7CiAgICAgICAgdGhpcy5UcmlnZ2VyKEMzJGpzY29tcCQxNzAuUGx1Z2lucy5TeXN0ZW0uQ25kcy5PbkxvYWRGaW5pc2hlZCwgbnVsbCwgbnVsbCk7CiAgICAgICAgdGhpcy5Qb3N0Q29tcG9uZW50TWVzc2FnZVRvRE9NKCJydW50aW1lIiwKICAgICAgICAgICAgInJlZ2lzdGVyLXN3IikKICAgIH0KICAgIEdldE9iamVjdFJlZmVyZW5jZShhKSB7CiAgICAgICAgYSA9IE1hdGguZmxvb3IoYSk7CiAgICAgICAgY29uc3QgYiA9IHRoaXMuX29iamVjdFJlZmVyZW5jZVRhYmxlOwogICAgICAgIGlmICgwID4gYSB8fCBhID49IGIubGVuZ3RoKSB0aHJvdyBFcnJvcigiaW52YWxpZCBvYmplY3QgcmVmZXJlbmNlIik7CiAgICAgICAgcmV0dXJuIGJbYV0KICAgIH0KICAgIF9Mb2FkSnNQcm9wTmFtZVRhYmxlKCkgewogICAgICAgIGZvciAoY29uc3QgYSBvZiBzZWxmLkMzX0pzUHJvcE5hbWVUYWJsZSkgewogICAgICAgICAgICBjb25zdCBiID0gQzMkanNjb21wJDE3MC5maXJzdChPYmplY3Qua2V5cyhhKSk7CiAgICAgICAgICAgIHRoaXMuX2pzUHJvcE5hbWVUYWJsZS5wdXNoKGIpCiAgICAgICAgfQogICAgfQogICAgR2V0SnNQcm9wTmFtZShhKSB7CiAgICAgICAgYSA9IE1hdGguZmxvb3IoYSk7CiAgICAgICAgY29uc3QgYiA9IHRoaXMuX2pzUHJvcE5hbWVUYWJsZTsKICAgICAgICBpZiAoMCA+IGEgfHwgYSA+PSBiLmxlbmd0aCkgdGhyb3cgRXJyb3IoImludmFsaWQgcHJvcCByZWZlcmVuY2UiKTsKICAgICAgICByZXR1cm4gYlthXQogICAgfQogICAgSGFzRE9NKCkgewogICAgICAgIHJldHVybiB0aGlzLl9oYXNEb20KICAgIH0KICAgIElzSGVhZGxlc3MoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2lzSGVhZGxlc3MKICAgIH0KICAgIElzSW5Xb3JrZXIoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2lzSW5Xb3JrZXIKICAgIH0KICAgIEdldFJ1bnRpbWVCYXNlVVJMKCkgewogICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lQmFzZVVybAogICAgfQogICAgR2V0UHJldmlld1VSTCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcHJldmlld1VybAogICAgfQogICAgR2V0RXZlbnRTaGVldE1hbmFnZXIoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2V2ZW50U2hlZXRNYW5hZ2VyCiAgICB9CiAgICBHZXRFdmVudFN0YWNrKCkgewogICAgICAgIHJldHVybiB0aGlzLl9ldmVudFNoZWV0TWFuYWdlci5HZXRFdmVudFN0YWNrKCkKICAgIH0KICAgIEdldEN1cnJlbnRFdmVudFN0YWNrRnJhbWUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2V2ZW50U2hlZXRNYW5hZ2VyLkdldEN1cnJlbnRFdmVudFN0YWNrRnJhbWUoKQogICAgfQogICAgR2V0Q3VycmVudEV2ZW50KCkgewogICAgICAgIHJldHVybiB0aGlzLl9ldmVudFNoZWV0TWFuYWdlci5HZXRDdXJyZW50RXZlbnQoKQogICAgfQogICAgR2V0Q3VycmVudENvbmRpdGlvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZXZlbnRTaGVldE1hbmFnZXIuR2V0Q3VycmVudENvbmRpdGlvbigpCiAgICB9CiAgICBJc0N1cnJlbnRDb25kaXRpb25GaXJzdCgpIHsKICAgICAgICByZXR1cm4gMCA9PT0KICAgICAgICAgICAgdGhpcy5HZXRDdXJyZW50RXZlbnRTdGFja0ZyYW1lKCkuR2V0Q29uZGl0aW9uSW5kZXgoKQogICAgfQogICAgR2V0Q3VycmVudEFjdGlvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZXZlbnRTaGVldE1hbmFnZXIuR2V0Q3VycmVudEFjdGlvbigpCiAgICB9CiAgICBHZXRQbHVnaW5NYW5hZ2VyKCkgewogICAgICAgIHJldHVybiB0aGlzLl9wbHVnaW5NYW5hZ2VyCiAgICB9CiAgICBHZXRTeXN0ZW1QbHVnaW4oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3BsdWdpbk1hbmFnZXIuR2V0U3lzdGVtUGx1Z2luKCkKICAgIH0KICAgIEdldE9iamVjdENsYXNzQnlJbmRleChhKSB7CiAgICAgICAgYSA9IE1hdGguZmxvb3IoYSk7CiAgICAgICAgaWYgKDAgPiBhIHx8IGEgPj0gdGhpcy5fYWxsT2JqZWN0Q2xhc3Nlcy5sZW5ndGgpIHRocm93IG5ldyBSYW5nZUVycm9yKCJpbnZhbGlkIGluZGV4Iik7CiAgICAgICAgcmV0dXJuIHRoaXMuX2FsbE9iamVjdENsYXNzZXNbYV0KICAgIH0KICAgIEdldE9iamVjdENsYXNzQnlOYW1lKGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5fb2JqZWN0Q2xhc3Nlc0J5TmFtZS5nZXQoYS50b0xvd2VyQ2FzZSgpKSB8fCBudWxsCiAgICB9CiAgICBHZXRPYmplY3RDbGFzc0J5U0lEKGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5fb2JqZWN0Q2xhc3Nlc0J5U2lkLmdldChhKSB8fAogICAgICAgICAgICBudWxsCiAgICB9CiAgICBHZXRTaW5nbGVHbG9iYWxPYmplY3RDbGFzc0J5Q3RvcihhKSB7CiAgICAgICAgcmV0dXJuIChhID0gdGhpcy5fcGx1Z2luTWFuYWdlci5HZXRQbHVnaW5CeUNvbnN0cnVjdG9yRnVuY3Rpb24oYSkpID8gYS5HZXRTaW5nbGVHbG9iYWxPYmplY3RDbGFzcygpIDogbnVsbAogICAgfQogICAgR2V0QWxsT2JqZWN0Q2xhc3NlcygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fYWxsT2JqZWN0Q2xhc3NlcwogICAgfSogYWxsSW5zdGFuY2VzKCkgewogICAgICAgIGZvciAoY29uc3QgYSBvZiB0aGlzLl9hbGxPYmplY3RDbGFzc2VzKSBhLklzRmFtaWx5KCkgfHwgKHlpZWxkKiBhLmluc3RhbmNlcygpKQogICAgfQogICAgRGlzcGF0Y2hlcigpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZGlzcGF0Y2hlcgogICAgfQogICAgVXNlclNjcmlwdERpc3BhdGNoZXIoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3VzZXJTY3JpcHREaXNwYXRjaGVyCiAgICB9CiAgICBEaXNwYXRjaFVzZXJTY3JpcHRFdmVudChhKSB7CiAgICAgICAgYS5ydW50aW1lID0gdGhpcy5HZXRJUnVudGltZSgpOwogICAgICAgIGNvbnN0IGIgPSB0aGlzLklzRGVidWcoKSAmJiAhdGhpcy5fZXZlbnRTaGVldE1hbmFnZXIuSXNJbkV2ZW50RW5naW5lKCk7CiAgICAgICAgYiAmJgogICAgICAgICAgICBDM0RlYnVnZ2VyJGpzY29tcCQzLlN0YXJ0TWVhc3VyaW5nU2NyaXB0VGltZSgpOwogICAgICAgIHRoaXMuX3VzZXJTY3JpcHREaXNwYXRjaGVyLmRpc3BhdGNoRXZlbnQoYSk7CiAgICAgICAgYiAmJiBDM0RlYnVnZ2VyJGpzY29tcCQzLkFkZFNjcmlwdFRpbWUoKQogICAgfQogICAgRGlzcGF0Y2hVc2VyU2NyaXB0RXZlbnRBc3luY1dhaXQoYSkgewogICAgICAgIGEucnVudGltZSA9IHRoaXMuR2V0SVJ1bnRpbWUoKTsKICAgICAgICByZXR1cm4gdGhpcy5fdXNlclNjcmlwdERpc3BhdGNoZXIuZGlzcGF0Y2hFdmVudEFuZFdhaXRBc3luYyhhKQogICAgfQogICAgR2V0T3JpZ2luYWxWaWV3cG9ydFdpZHRoKCkgewogICAgICAgIHJldHVybiB0aGlzLl9vcmlnaW5hbFZpZXdwb3J0V2lkdGgKICAgIH0KICAgIEdldE9yaWdpbmFsVmlld3BvcnRIZWlnaHQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX29yaWdpbmFsVmlld3BvcnRIZWlnaHQKICAgIH0KICAgIFNldE9yaWdpbmFsVmlld3BvcnRTaXplKGEsIGIpIHsKICAgICAgICBpZiAodGhpcy5fb3JpZ2luYWxWaWV3cG9ydFdpZHRoICE9PSBhIHx8IHRoaXMuX29yaWdpbmFsVmlld3BvcnRIZWlnaHQgIT09IGIpIHRoaXMuX29yaWdpbmFsVmlld3BvcnRXaWR0aCA9CiAgICAgICAgICAgIGEsIHRoaXMuX29yaWdpbmFsVmlld3BvcnRIZWlnaHQgPSBiLCBhID0gdGhpcy5HZXRMYXlvdXRNYW5hZ2VyKCksIGEuU2V0QWxsTGF5ZXJQcm9qZWN0aW9uQ2hhbmdlZCgpLCBhLlNldEFsbExheWVyTVZDaGFuZ2VkKCkKICAgIH0KICAgIEdldFZpZXdwb3J0V2lkdGgoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3ZpZXdwb3J0V2lkdGgKICAgIH0KICAgIEdldFZpZXdwb3J0SGVpZ2h0KCkgewogICAgICAgIHJldHVybiB0aGlzLl92aWV3cG9ydEhlaWdodAogICAgfQogICAgU2V0Vmlld3BvcnRTaXplKGEsIGIpIHsKICAgICAgICBpZiAodGhpcy5fdmlld3BvcnRXaWR0aCAhPT0gYSB8fCB0aGlzLl92aWV3cG9ydEhlaWdodCAhPT0gYikgdGhpcy5fdmlld3BvcnRXaWR0aCA9IGEsIHRoaXMuX3ZpZXdwb3J0SGVpZ2h0ID0gYiwgYSA9IHRoaXMuR2V0TGF5b3V0TWFuYWdlcigpLCBhLlNldEFsbExheWVyUHJvamVjdGlvbkNoYW5nZWQoKSwgYS5TZXRBbGxMYXllck1WQ2hhbmdlZCgpCiAgICB9CiAgICBfU2V0RGV2aWNlUGl4ZWxSYXRpbyhhKSB7CiAgICAgICAgdGhpcy5Jc0V4cG9ydFRvVmlkZW8oKSB8fCAodGhpcy5fZGV2aWNlUGl4ZWxSYXRpbyA9IGEpCiAgICB9CiAgICBHZXREZXZpY2VQaXhlbFJhdGlvKCkgewogICAgICAgIHJldHVybiB0aGlzLl9kZXZpY2VQaXhlbFJhdGlvCiAgICB9CiAgICBHZXRQYXJhbGxheFhPcmlnaW4oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3BhcmFsbGF4WG9yaWdpbgogICAgfQogICAgR2V0UGFyYWxsYXhZT3JpZ2luKCkgewogICAgICAgIHJldHVybiB0aGlzLl9wYXJhbGxheFlvcmlnaW4KICAgIH0KICAgIEdldENhbnZhc01hbmFnZXIoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2NhbnZhc01hbmFnZXIKICAgIH0KICAgIEdldERyYXdXaWR0aCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fY2FudmFzTWFuYWdlciA/CiAgICAgICAgICAgIHRoaXMuX2NhbnZhc01hbmFnZXIuR2V0RHJhd1dpZHRoKCkgOiB0aGlzLl92aWV3cG9ydFdpZHRoCiAgICB9CiAgICBHZXREcmF3SGVpZ2h0KCkgewogICAgICAgIHJldHVybiB0aGlzLl9jYW52YXNNYW5hZ2VyID8gdGhpcy5fY2FudmFzTWFuYWdlci5HZXREcmF3SGVpZ2h0KCkgOiB0aGlzLl92aWV3cG9ydEhlaWdodAogICAgfQogICAgR2V0UmVuZGVyU2NhbGUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2NhbnZhc01hbmFnZXIgPyB0aGlzLl9jYW52YXNNYW5hZ2VyLkdldFJlbmRlclNjYWxlKCkgOiAxCiAgICB9CiAgICBHZXREaXNwbGF5U2NhbGUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2NhbnZhc01hbmFnZXIgPyB0aGlzLl9jYW52YXNNYW5hZ2VyLkdldERpc3BsYXlTY2FsZSgpIDogMQogICAgfQogICAgR2V0RWZmZWN0TGF5ZXJTY2FsZVBhcmFtKCkgewogICAgICAgIHJldHVybiB0aGlzLl9jYW52YXNNYW5hZ2VyID8gdGhpcy5fY2FudmFzTWFuYWdlci5HZXRFZmZlY3RMYXllclNjYWxlUGFyYW0oKSA6IDEKICAgIH0KICAgIEdldEVmZmVjdERldmljZVBpeGVsUmF0aW9QYXJhbSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fY2FudmFzTWFuYWdlciA/IHRoaXMuX2NhbnZhc01hbmFnZXIuR2V0RWZmZWN0RGV2aWNlUGl4ZWxSYXRpb1BhcmFtKCkgOgogICAgICAgICAgICAxCiAgICB9CiAgICBHZXRDYW52YXNDbGllbnRYKCkgewogICAgICAgIHJldHVybiB0aGlzLl9jYW52YXNNYW5hZ2VyID8gdGhpcy5fY2FudmFzTWFuYWdlci5HZXRDYW52YXNDbGllbnRYKCkgOiAwCiAgICB9CiAgICBHZXRDYW52YXNDbGllbnRZKCkgewogICAgICAgIHJldHVybiB0aGlzLl9jYW52YXNNYW5hZ2VyID8gdGhpcy5fY2FudmFzTWFuYWdlci5HZXRDYW52YXNDbGllbnRZKCkgOiAwCiAgICB9CiAgICBHZXRDYW52YXNDc3NXaWR0aCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fY2FudmFzTWFuYWdlciA/IHRoaXMuX2NhbnZhc01hbmFnZXIuR2V0Q3NzV2lkdGgoKSA6IDAKICAgIH0KICAgIEdldENhbnZhc0Nzc0hlaWdodCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fY2FudmFzTWFuYWdlciA/IHRoaXMuX2NhbnZhc01hbmFnZXIuR2V0Q3NzSGVpZ2h0KCkgOiAwCiAgICB9CiAgICBHZXRGdWxsc2NyZWVuTW9kZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fY2FudmFzTWFuYWdlciA/IHRoaXMuX2NhbnZhc01hbmFnZXIuR2V0RnVsbHNjcmVlbk1vZGUoKSA6ICJvZmYiCiAgICB9CiAgICBHZXRBZGRpdGlvbmFsUmVuZGVyVGFyZ2V0KGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5fY2FudmFzTWFuYWdlciA/IHRoaXMuX2NhbnZhc01hbmFnZXIuR2V0QWRkaXRpb25hbFJlbmRlclRhcmdldChhKSA6CiAgICAgICAgICAgIG51bGwKICAgIH0KICAgIFJlbGVhc2VBZGRpdGlvbmFsUmVuZGVyVGFyZ2V0KGEpIHsKICAgICAgICB0aGlzLl9jYW52YXNNYW5hZ2VyICYmIHRoaXMuX2NhbnZhc01hbmFnZXIuUmVsZWFzZUFkZGl0aW9uYWxSZW5kZXJUYXJnZXQoYSkKICAgIH0KICAgIFVzZXNBbnlCYWNrZ3JvdW5kQmxlbmRpbmcoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3VzZXNBbnlCYWNrZ3JvdW5kQmxlbmRpbmcKICAgIH0KICAgIFVzZXNBbnlDcm9zc1NhbXBsaW5nKCkgewogICAgICAgIHJldHVybiB0aGlzLl91c2VzQW55Q3Jvc3NTYW1wbGluZwogICAgfQogICAgVXNlc0FueURlcHRoU2FtcGxpbmcoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3VzZXNBbnlEZXB0aFNhbXBsaW5nCiAgICB9CiAgICBHZXRHUFVVdGlsaXNhdGlvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5fY2FudmFzTWFuYWdlciA/IHRoaXMuX2NhbnZhc01hbmFnZXIuR2V0R1BVVXRpbGlzYXRpb24oKSA6IE5hTgogICAgfQogICAgSXNMaW5lYXJTYW1wbGluZygpIHsKICAgICAgICByZXR1cm4gIm5lYXJlc3QiICE9PSB0aGlzLkdldFNhbXBsaW5nKCkKICAgIH0KICAgIEdldEZyYW1lcmF0ZU1vZGUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2ZyYW1lcmF0ZU1vZGUKICAgIH0KICAgIEdldENvbXBvc2l0aW5nTW9kZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fY29tcG9zaXRpbmdNb2RlCiAgICB9CiAgICBHZXRTYW1wbGluZygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fc2FtcGxpbmcKICAgIH0KICAgIFVzZXNMb2FkZXJMYXlvdXQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3VzZXNMb2FkZXJMYXlvdXQKICAgIH0KICAgIEdldExvYWRpbmdMb2dvQXNzZXQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2xvYWRpbmdMb2dvQXNzZXQKICAgIH0KICAgIFJlbGVhc2VMb2FkaW5nTG9nb0Fzc2V0KCkgewogICAgICAgIHRoaXMuX2xvYWRpbmdMb2dvQXNzZXQgJiYKICAgICAgICAgICAgKHRoaXMuX2xvYWRpbmdMb2dvQXNzZXQuUmVsZWFzZSgpLCB0aGlzLl9sb2FkaW5nTG9nb0Fzc2V0ID0gbnVsbCkKICAgIH0KICAgIEdldExheW91dE1hbmFnZXIoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2xheW91dE1hbmFnZXIKICAgIH0KICAgIEdldE1haW5SdW5uaW5nTGF5b3V0KCkgewogICAgICAgIHJldHVybiB0aGlzLl9sYXlvdXRNYW5hZ2VyLkdldE1haW5SdW5uaW5nTGF5b3V0KCkKICAgIH0KICAgIEdldFRpbWVsaW5lTWFuYWdlcigpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdGltZWxpbmVNYW5hZ2VyCiAgICB9CiAgICBHZXRUcmFuc2l0aW9uTWFuYWdlcigpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdHJhbnNpdGlvbk1hbmFnZXIKICAgIH0KICAgIEdldFRlbXBsYXRlTWFuYWdlcigpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdGVtcGxhdGVNYW5hZ2VyCiAgICB9CiAgICBHZXRBc3NldE1hbmFnZXIoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2Fzc2V0TWFuYWdlcgogICAgfQogICAgTG9hZEltYWdlKGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5fYXNzZXRNYW5hZ2VyLkxvYWRJbWFnZShhKQogICAgfQogICAgQ3JlYXRlSW5zdGFuY2UoYSwgYiwgZCwgYywgZSwgZykgewogICAgICAgIGlmIChnICYmIHRoaXMuX3RlbXBsYXRlTWFuYWdlcikgewogICAgICAgICAgICBjb25zdCBrID0gdGhpcy5fdGVtcGxhdGVNYW5hZ2VyLkdldFRlbXBsYXRlRGF0YShhLAogICAgICAgICAgICAgICAgZyk7CiAgICAgICAgICAgIGlmIChrKSByZXR1cm4gYSA9IHRoaXMuQ3JlYXRlSW5zdGFuY2VGcm9tRGF0YShrLCBiLCAhMSwgZCwgYywgITEsIGUsIHZvaWQgMCwgZSksIHRoaXMuX3RlbXBsYXRlTWFuYWdlci5NYXBJbnN0YW5jZVRvVGVtcGxhdGVOYW1lKGEsIGcpLCBhCiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzLkNyZWF0ZUluc3RhbmNlRnJvbURhdGEoYSwgYiwgITEsIGQsIGMsICExLCBlLCB2b2lkIDAsIGUpCiAgICB9CiAgICBDcmVhdGVJbnN0YW5jZUZyb21EYXRhKGEsIGIsIGQsIGMsIGUsIGcsIGssIG0sIG4pIHsKICAgICAgICB2YXIgcSA9IG51bGw7CiAgICAgICAgbGV0IHUgPSBudWxsOwogICAgICAgIGlmIChhIGluc3RhbmNlb2YgQzMkanNjb21wJDE3MC5PYmplY3RDbGFzcykgewogICAgICAgICAgICB1ID0gYTsKICAgICAgICAgICAgaWYgKHUuSXNGYW1pbHkoKSkgewogICAgICAgICAgICAgICAgYSA9IHUuR2V0RmFtaWx5TWVtYmVycygpOwogICAgICAgICAgICAgICAgdmFyIHcgPSBNYXRoLmZsb29yKHRoaXMuUmFuZG9tKCkgKiBhLmxlbmd0aCk7CiAgICAgICAgICAgICAgICB1ID0gYVt3XQogICAgICAgICAgICB9CiAgICAgICAgICAgIHEgPSB1LkdldERlZmF1bHRJbnN0YW5jZURhdGEoKQogICAgICAgIH0gZWxzZSBxID0gYSwgdSA9IHRoaXMuR2V0T2JqZWN0Q2xhc3NCeUluZGV4KHFbMV0pOwogICAgICAgIHZhciB6ID0gdS5HZXRQbHVnaW4oKS5Jc1dvcmxkVHlwZSgpOwogICAgICAgIGlmICh0aGlzLl9pc0xvYWRpbmcgJiYKICAgICAgICAgICAgeiAmJiAhdS5Jc09uTG9hZGVyTGF5b3V0KCkpIHJldHVybiBudWxsOwogICAgICAgIGNvbnN0IEMgPSBiOwogICAgICAgIHogfHwgKGIgPSBudWxsKTsKICAgICAgICB2YXIgRCA9IGQgJiYgIWcgJiYgcSAmJiAhdGhpcy5faW5zdGFuY2VzQnlVaWQuaGFzKHFbMl0pID8gcVsyXSA6IHRoaXMuX25leHRVaWQrKzsKICAgICAgICB3ID0gcSA/IHFbMF0gOiBudWxsOwogICAgICAgIGEgPSBDMyRqc2NvbXAkMTcwLk5ldyhDMyRqc2NvbXAkMTcwLkluc3RhbmNlLCB7CiAgICAgICAgICAgIHJ1bnRpbWU6IHRoaXMsCiAgICAgICAgICAgIG9iamVjdFR5cGU6IHUsCiAgICAgICAgICAgIGxheWVyOiBiLAogICAgICAgICAgICB3b3JsZERhdGE6IHcsCiAgICAgICAgICAgIGluc3RWYXJEYXRhOiBxID8gcVszXSA6IG51bGwsCiAgICAgICAgICAgIHVpZDogRAogICAgICAgIH0pOwogICAgICAgIHRoaXMuX2luc3RhbmNlc0J5VWlkLnNldChELCBhKTsKICAgICAgICBEID0gbnVsbDsKICAgICAgICB6ICYmIChEID0gYS5HZXRXb3JsZEluZm8oKSwgInVuZGVmaW5lZCIgIT09IHR5cGVvZiBjICYmICJ1bmRlZmluZWQiICE9PSB0eXBlb2YgZSAmJiAoRC5TZXRYKGMpLCBELlNldFkoZSkpLCB1Ll9TZXRBbnlDb2xsaXNpb25DZWxsQ2hhbmdlZCghMCkpOwogICAgICAgIGIgJiYgKG4gfHwgYi5fQWRkSW5zdGFuY2UoYSwgITApLCAxID09PSBiLkdldFBhcmFsbGF4WCgpICYmIDEgPT09IGIuR2V0UGFyYWxsYXhZKCkgfHwKICAgICAgICAgICAgdS5fU2V0QW55SW5zdGFuY2VQYXJhbGxheGVkKCEwKSwgYi5HZXRMYXlvdXQoKS5NYXliZUxvYWRUZXh0dXJlc0Zvcih1KSk7CiAgICAgICAgdGhpcy5fb2JqZWN0Q291bnQrKzsKICAgICAgICBsZXQgRiA9ICEwOwogICAgICAgIGlmIChtKSB7CiAgICAgICAgICAgIHZhciBFID0gbS5HZXRPYmplY3RDbGFzcygpOwogICAgICAgICAgICBFLklzSW5Db250YWluZXIoKSAmJiB1LklzSW5Db250YWluZXIoKSAmJiAobSA9IHUuR2V0Q29udGFpbmVyKCksIEUgPSBFLkdldENvbnRhaW5lcigpLCBtID09PSBFICYmIChGID0gITEpKQogICAgICAgIH0KICAgICAgICBpZiAodS5Jc0luQ29udGFpbmVyKCkgJiYgIWQgJiYgIWcgJiYgRikgewogICAgICAgICAgICBmb3IgKHZhciBKIG9mIHUuR2V0Q29udGFpbmVyKCkub2JqZWN0VHlwZXMoKSkgSiAhPT0gdSAmJiAobSA9IHRoaXMuQ3JlYXRlSW5zdGFuY2VGcm9tRGF0YShKLCBDLCAhMSwgRCA/IEQuR2V0WCgpIDogYywgRCA/IEQuR2V0WSgpIDogZSwgITAsICExLCB2b2lkIDAsIG4pLCBhLl9BZGRTaWJsaW5nKG0pKTsKICAgICAgICAgICAgZm9yICh2YXIgSyBvZiBhLnNpYmxpbmdzKCkpIHsKICAgICAgICAgICAgICAgIEsuX0FkZFNpYmxpbmcoYSk7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IE8gb2YgYS5zaWJsaW5ncygpKSBLICE9PSBPICYmIEsuX0FkZFNpYmxpbmcoTykKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB6ICYmCiAgICAgICAgICAgICFkICYmIGsgJiYgdGhpcy5fQ3JlYXRlQ2hpbGRJbnN0YW5jZXNGcm9tRGF0YShhLCB3LCBELCBiLCBjLCBlLCBuKTsKICAgICAgICBpZiAodS5Jc0luQ29udGFpbmVyKCkgJiYgIWQgJiYgIWcgJiYgaykKICAgICAgICAgICAgZm9yIChjb25zdCBPIG9mIGEuc2libGluZ3MoKSkKICAgICAgICAgICAgICAgIGlmIChkID0gTy5HZXRXb3JsZEluZm8oKSkgSiA9IE8uR2V0UGx1Z2luKCksIEsgPSBPLkdldE9iamVjdENsYXNzKCkuR2V0RGVmYXVsdEluc3RhbmNlRGF0YSgpWzBdLCBKLklzV29ybGRUeXBlKCkgPyB0aGlzLl9DcmVhdGVDaGlsZEluc3RhbmNlc0Zyb21EYXRhKE8sIEssIGQsIGIsIGQuR2V0WCgpLCBkLkdldFkoKSwgbikgOiB0aGlzLl9DcmVhdGVDaGlsZEluc3RhbmNlc0Zyb21EYXRhKE8sIEssIGQsIGIsIHZvaWQgMCwgdm9pZCAwLCBuKTsKICAgICAgICAhZyAmJiBrICYmICgidW5kZWZpbmVkIiA9PT0gdHlwZW9mIGMgJiYgKGMgPSB3WzBdKSwgInVuZGVmaW5lZCIgPT09IHR5cGVvZiBlICYmIChlID0gd1sxXSksIGIgPSBELkdldFRvcFBhcmVudCgpLCBjID0gYyAtIEQuR2V0WCgpICsgYi5HZXRYKCksIGUgPSBlIC0gRC5HZXRZKCkgKyBiLkdldFkoKSwgYi5TZXRYWShjLCBlKSk7CiAgICAgICAgdS5fU2V0SUlEc1N0YWxlKCk7CiAgICAgICAgZSA9IHEgPyBDMyRqc2NvbXAkMTcwLmNsb25lQXJyYXkocVs1XSkgOiBudWxsOwogICAgICAgIHEgPSBxID8gcVs0XS5tYXAoTyA9PiBDMyRqc2NvbXAkMTcwLmNsb25lQXJyYXkoTykpIDogbnVsbDsKICAgICAgICAoeiA9IHogJiYgdyAmJiB3WzEzXSkgJiYgYS5fU2V0SGFzVGlsZW1hcCgpOwogICAgICAgIGEuX0NyZWF0ZVNka0luc3RhbmNlKGUsIHEpOwogICAgICAgIHogJiYgKHcgPSB3WzEzXSwgYS5HZXRTZGtJbnN0YW5jZSgpLkxvYWRUaWxlbWFwRGF0YSh3WzJdLCB3WzBdLCB3WzFdKSk7CiAgICAgICAgdGhpcy5faW5zdGFuY2VzUGVuZGluZ0NyZWF0ZS5wdXNoKGEpOwogICAgICAgIHRoaXMuX2hhc1BlbmRpbmdJbnN0YW5jZXMgPSAhMDsKICAgICAgICB0aGlzLklzRGVidWcoKSAmJiBDM0RlYnVnZ2VyJGpzY29tcCQzLkluc3RhbmNlQ3JlYXRlZChhKTsKICAgICAgICByZXR1cm4gYQogICAgfQogICAgX0NyZWF0ZUNoaWxkSW5zdGFuY2VzRnJvbURhdGEoYSwgYiwgZCwgYywgZSwgZywgaykgewogICAgICAgIHZhciBtID0gZC5HZXRTY2VuZUdyYXBoWkluZGV4RXhwb3J0RGF0YSgpLAogICAgICAgICAgICBuID0gZC5HZXRTY2VuZUdyYXBoQ2hpbGRyZW5FeHBvcnREYXRhKCk7CiAgICAgICAgYS5HZXRXb3JsZEluZm8oKS5TZXRTY2VuZUdyYXBoWkluZGV4KG0pOwogICAgICAgIGlmIChuKSB7CiAgICAgICAgICAgICJ1bmRlZmluZWQiID09PSB0eXBlb2YgZSAmJiAoZSA9IGJbMF0pOwogICAgICAgICAgICAidW5kZWZpbmVkIiA9PT0gdHlwZW9mIGcgJiYgKGcgPSBiWzFdKTsKICAgICAgICAgICAgbSA9IG5ldyBTZXQ7CiAgICAgICAgICAgIGQgPSBiWzBdOwogICAgICAgICAgICBiID0gYlsxXTsKICAgICAgICAgICAgZm9yIChjb25zdCBDIG9mIG4pIHsKICAgICAgICAgICAgICAgIHZhciBxID0gQ1sxXSwKICAgICAgICAgICAgICAgICAgICB1ID0gQ1syXTsKICAgICAgICAgICAgICAgIG4gPSBDWzNdOwogICAgICAgICAgICAgICAgdmFyIHcgPSAhIUNbNF07CiAgICAgICAgICAgICAgICBjb25zdCBEID0gQ1s1XTsKICAgICAgICAgICAgICAgIHUgPSB0aGlzLl9sYXlvdXRNYW5hZ2VyLkdldExheW91dEJ5U0lEKENbMF0pLkdldExheWVyKHEpLkdldEluaXRpYWxJbnN0YW5jZURhdGEodSk7CiAgICAgICAgICAgICAgICBxID0gdGhpcy5HZXRPYmplY3RDbGFzc0J5SW5kZXgodVsxXSk7CiAgICAgICAgICAgICAgICB2YXIgeiA9IGEuSGFzU2libGluZyhxKTsKICAgICAgICAgICAgICAgIGNvbnN0IEYgPSBtLmhhcyhxKTsKICAgICAgICAgICAgICAgIHogJiYgIUYgJiYgdyA/ICh3ID0gYS5HZXRTaWJsaW5nKHEpLCB6ID0gZSArIHVbMF1bMF0gLSBkLCB1ID0gZyArIHVbMF1bMV0gLSBiLCB3LkdldFdvcmxkSW5mbygpLlNldFhZKHosIHUpLCB3LkdldFdvcmxkSW5mbygpLlNldFNjZW5lR3JhcGhaSW5kZXgoRCksIGEuQWRkQ2hpbGQodywgewogICAgICAgICAgICAgICAgICAgIHRyYW5zZm9ybVg6ICEhKG4gPj4gMCAmIDEpLAogICAgICAgICAgICAgICAgICAgIHRyYW5zZm9ybVk6ICEhKG4gPj4gMSAmIDEpLAogICAgICAgICAgICAgICAgICAgIHRyYW5zZm9ybVdpZHRoOiAhIShuID4+IDIgJiAxKSwKICAgICAgICAgICAgICAgICAgICB0cmFuc2Zvcm1IZWlnaHQ6ICEhKG4gPj4gMyAmIDEpLAogICAgICAgICAgICAgICAgICAgIHRyYW5zZm9ybUFuZ2xlOiAhIShuID4+IDQgJiAxKSwKICAgICAgICAgICAgICAgICAgICBkZXN0cm95V2l0aFBhcmVudDogISEobiA+PiA1ICYgMSksCiAgICAgICAgICAgICAgICAgICAgdHJhbnNmb3JtWkVsZXZhdGlvbjogISEobiA+PiA2ICYgMSkKICAgICAgICAgICAgICAgIH0pLCBtLmFkZChxKSkgOiAocSA9IHRoaXMuQ3JlYXRlSW5zdGFuY2VGcm9tRGF0YSh1LCBjLCAhMSwgZSArIHVbMF1bMF0gLSBkLCBnICsgdVswXVsxXSAtIGIsICExLCAhMCwgYSwgayksIHEuR2V0V29ybGRJbmZvKCkuU2V0U2NlbmVHcmFwaFpJbmRleChEKSwgYS5BZGRDaGlsZChxLCB7CiAgICAgICAgICAgICAgICAgICAgdHJhbnNmb3JtWDogISEobiA+PiAwICYgMSksCiAgICAgICAgICAgICAgICAgICAgdHJhbnNmb3JtWTogISEobiA+PiAxICYgMSksCiAgICAgICAgICAgICAgICAgICAgdHJhbnNmb3JtV2lkdGg6ICEhKG4gPj4gMiAmIDEpLAogICAgICAgICAgICAgICAgICAgIHRyYW5zZm9ybUhlaWdodDogISEobiA+PiAzICYgMSksCiAgICAgICAgICAgICAgICAgICAgdHJhbnNmb3JtQW5nbGU6ICEhKG4gPj4gNCAmIDEpLAogICAgICAgICAgICAgICAgICAgIGRlc3Ryb3lXaXRoUGFyZW50OiAhIShuID4+IDUgJiAxKSwKICAgICAgICAgICAgICAgICAgICB0cmFuc2Zvcm1aRWxldmF0aW9uOiAhIShuID4+IDYgJiAxKQogICAgICAgICAgICAgICAgfSkpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBEZXN0cm95SW5zdGFuY2UoYSkgewogICAgICAgIGlmICghdGhpcy5faW5zdGFuY2VzVG9SZWxlYXNlQXRFbmRPZlRpY2suaGFzKGEpKSB7CiAgICAgICAgICAgIHZhciBiID0KICAgICAgICAgICAgICAgIGEuR2V0T2JqZWN0Q2xhc3MoKSwKICAgICAgICAgICAgICAgIGQgPSB0aGlzLl9pbnN0YW5jZXNQZW5kaW5nRGVzdHJveS5nZXQoYik7CiAgICAgICAgICAgIGlmIChkKSB7CiAgICAgICAgICAgICAgICBpZiAoZC5oYXMoYSkpIHJldHVybjsKICAgICAgICAgICAgICAgIGQuYWRkKGEpCiAgICAgICAgICAgIH0gZWxzZSBkID0gbmV3IFNldCwgZC5hZGQoYSksIHRoaXMuX2luc3RhbmNlc1BlbmRpbmdEZXN0cm95LnNldChiLCBkKTsKICAgICAgICAgICAgdGhpcy5Jc0RlYnVnKCkgJiYgQzNEZWJ1Z2dlciRqc2NvbXAkMy5JbnN0YW5jZURlc3Ryb3llZChhKTsKICAgICAgICAgICAgYS5fTWFya0Rlc3Ryb3llZCgpOwogICAgICAgICAgICB0aGlzLl9oYXNQZW5kaW5nSW5zdGFuY2VzID0gITA7CiAgICAgICAgICAgIGlmIChhLklzSW5Db250YWluZXIoKSkKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgYyBvZiBhLnNpYmxpbmdzKCkpIHRoaXMuRGVzdHJveUluc3RhbmNlKGMpOwogICAgICAgICAgICBmb3IgKGNvbnN0IGMgb2YgYS5jaGlsZHJlbigpKSBjLkdldERlc3Ryb3lXaXRoUGFyZW50KCkgJiYgdGhpcy5EZXN0cm95SW5zdGFuY2UoYyk7CiAgICAgICAgICAgIHRoaXMuX2xheW91dE1hbmFnZXIuSXNFbmRpbmdMYXlvdXQoKSB8fCB0aGlzLl9pc0xvYWRpbmdTdGF0ZSB8fCAoYiA9IHRoaXMuR2V0RXZlbnRTaGVldE1hbmFnZXIoKSwKICAgICAgICAgICAgICAgIGIuQmxvY2tGbHVzaGluZ0luc3RhbmNlcyghMCksIGEuX1RyaWdnZXJPbkRlc3Ryb3llZCgpLCBiLkJsb2NrRmx1c2hpbmdJbnN0YW5jZXMoITEpKTsKICAgICAgICAgICAgYS5fRmlyZURlc3Ryb3llZFNjcmlwdEV2ZW50cyh0aGlzLl9sYXlvdXRNYW5hZ2VyLklzRW5kaW5nTGF5b3V0KCkpCiAgICAgICAgfQogICAgfQogICAgRmx1c2hQZW5kaW5nSW5zdGFuY2VzKCkgewogICAgICAgIHRoaXMuX2hhc1BlbmRpbmdJbnN0YW5jZXMgJiYgKHRoaXMuX2lzRmx1c2hpbmdQZW5kaW5nSW5zdGFuY2VzID0gITAsIHRoaXMuX0ZsdXNoSW5zdGFuY2VzUGVuZGluZ0NyZWF0ZSgpLCB0aGlzLl9GbHVzaEluc3RhbmNlc1BlbmRpbmdEZXN0cm95KCksIHRoaXMuX2hhc1BlbmRpbmdJbnN0YW5jZXMgPSB0aGlzLl9pc0ZsdXNoaW5nUGVuZGluZ0luc3RhbmNlcyA9ICExLCB0aGlzLlVwZGF0ZVJlbmRlcigpKQogICAgfQogICAgX0ZsdXNoSW5zdGFuY2VzUGVuZGluZ0NyZWF0ZSgpIHsKICAgICAgICBmb3IgKGNvbnN0IGEgb2YgdGhpcy5faW5zdGFuY2VzUGVuZGluZ0NyZWF0ZSkgewogICAgICAgICAgICBjb25zdCBiID0gYS5HZXRPYmplY3RDbGFzcygpOwogICAgICAgICAgICBiLl9BZGRJbnN0YW5jZShhKTsKICAgICAgICAgICAgZm9yIChjb25zdCBkIG9mIGIuR2V0RmFtaWxpZXMoKSkgZC5fQWRkSW5zdGFuY2UoYSksIGQuX1NldElJRHNTdGFsZSgpCiAgICAgICAgfQogICAgICAgIEMzJGpzY29tcCQxNzAuY2xlYXJBcnJheSh0aGlzLl9pbnN0YW5jZXNQZW5kaW5nQ3JlYXRlKQogICAgfQogICAgX0ZsdXNoSW5zdGFuY2VzUGVuZGluZ0Rlc3Ryb3koKSB7CiAgICAgICAgdGhpcy5fZGlzcGF0Y2hlci5TZXREZWxheVJlbW92ZUV2ZW50c0VuYWJsZWQoITApOwogICAgICAgIGZvciAoY29uc3QgW2EsIGJdIG9mIHRoaXMuX2luc3RhbmNlc1BlbmRpbmdEZXN0cm95LmVudHJpZXMoKSkgdGhpcy5fRmx1c2hJbnN0YW5jZXNQZW5kaW5nRGVzdHJveUZvck9iamVjdENsYXNzKGEsIGIpLCBiLmNsZWFyKCk7CiAgICAgICAgdGhpcy5faW5zdGFuY2VzUGVuZGluZ0Rlc3Ryb3kuY2xlYXIoKTsKICAgICAgICB0aGlzLl9kaXNwYXRjaGVyLlNldERlbGF5UmVtb3ZlRXZlbnRzRW5hYmxlZCghMSkKICAgIH0KICAgIF9GbHVzaEluc3RhbmNlc1BlbmRpbmdEZXN0cm95Rm9yT2JqZWN0Q2xhc3MoYSwgYikgewogICAgICAgIGZvciAoY29uc3QgYyBvZiBiKSB7CiAgICAgICAgICAgIHZhciBkID0gdGhpcy5fZXZlbnRPYmplY3RzLmluc3RhbmNlZGVzdHJveTsKICAgICAgICAgICAgZC5pbnN0YW5jZSA9IGM7CiAgICAgICAgICAgIHRoaXMuX2Rpc3BhdGNoZXIuZGlzcGF0Y2hFdmVudChkKTsKICAgICAgICAgICAgdGhpcy5faW5zdGFuY2VzQnlVaWQuZGVsZXRlKGMuR2V0VUlEKCkpOwogICAgICAgICAgICB0aGlzLl9pbnN0YW5jZVRpbWVzLmRlbGV0ZShjKTsKICAgICAgICAgICAgaWYgKGQgPSBjLkdldFdvcmxkSW5mbygpKSBkLl9SZW1vdmVGcm9tQ29sbGlzaW9uQ2VsbHMoKSwgZC5fUmVtb3ZlRnJvbVJlbmRlckNlbGxzKCksIGQuX01hcmtEZXN0cm95ZWQoKTsKICAgICAgICAgICAgdGhpcy5faW5zdGFuY2VzVG9SZWxlYXNlQXRFbmRPZlRpY2suYWRkKGMpOwogICAgICAgICAgICB0aGlzLl9vYmplY3RDb3VudC0tCiAgICAgICAgfQogICAgICAgIEMzJGpzY29tcCQxNzAuYXJyYXlSZW1vdmVBbGxJblNldChhLkdldEluc3RhbmNlcygpLCBiKTsKICAgICAgICBhLl9TZXRJSURzU3RhbGUoKTsKICAgICAgICB0aGlzLl9pbnN0YW5jZXNUb1JlbGVhc2VBZmZlY3RlZE9iamVjdENsYXNzZXMuYWRkKGEpOwogICAgICAgIDAgPT09IGEuR2V0SW5zdGFuY2VzKCkubGVuZ3RoICYmIGEuX1NldEFueUluc3RhbmNlUGFyYWxsYXhlZCghMSk7CiAgICAgICAgZm9yIChjb25zdCBjIG9mIGEuR2V0RmFtaWxpZXMoKSkgQzMkanNjb21wJDE3MC5hcnJheVJlbW92ZUFsbEluU2V0KGMuR2V0SW5zdGFuY2VzKCksCiAgICAgICAgICAgIGIpLCBjLl9TZXRJSURzU3RhbGUoKSwgdGhpcy5faW5zdGFuY2VzVG9SZWxlYXNlQWZmZWN0ZWRPYmplY3RDbGFzc2VzLmFkZChjKTsKICAgICAgICBpZiAoYS5HZXRQbHVnaW4oKS5Jc1dvcmxkVHlwZSgpKSB7CiAgICAgICAgICAgIGEgPSBuZXcgU2V0KFsuLi5iXS5tYXAoYyA9PiBjLkdldFdvcmxkSW5mbygpLkdldExheWVyKCkpKTsKICAgICAgICAgICAgZm9yIChjb25zdCBjIG9mIGEpIGMuX1JlbW92ZUFsbEluc3RhbmNlc0luU2V0KGIpCiAgICAgICAgfQogICAgfQogICAgX0dldEluc3RhbmNlc1BlbmRpbmdDcmVhdGUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2luc3RhbmNlc1BlbmRpbmdDcmVhdGUKICAgIH0qIGluc3RhbmNlc1BlbmRpbmdDcmVhdGVGb3JPYmplY3RDbGFzcyhhKSB7CiAgICAgICAgZm9yIChjb25zdCBiIG9mIHRoaXMuX0dldEluc3RhbmNlc1BlbmRpbmdDcmVhdGUoKSkgYS5Jc0ZhbWlseSgpID8gYi5HZXRPYmplY3RDbGFzcygpLkJlbG9uZ3NUb0ZhbWlseShhKSAmJiAoeWllbGQgYikgOiBiLkdldE9iamVjdENsYXNzKCkgPT09IGEgJiYgKHlpZWxkIGIpCiAgICB9CiAgICBfR2V0TmV3VUlEKCkgewogICAgICAgIHJldHVybiB0aGlzLl9uZXh0VWlkKysKICAgIH0KICAgIF9NYXBJbnN0YW5jZUJ5VUlEKGEsCiAgICAgICAgYikgewogICAgICAgIHRoaXMuX2luc3RhbmNlc0J5VWlkLnNldChhLCBiKQogICAgfQogICAgX09uV2ViR0xDb250ZXh0TG9zdCgpIHsKICAgICAgICB0aGlzLl9kaXNwYXRjaGVyLmRpc3BhdGNoRXZlbnQoQzMkanNjb21wJDE3MC5OZXcoQzMkanNjb21wJDE3MC5FdmVudCwgIndlYmdsY29udGV4dGxvc3QiKSk7CiAgICAgICAgdGhpcy5TZXRTdXNwZW5kZWQoITApOwogICAgICAgIGZvciAodmFyIGEgb2YgdGhpcy5fYWxsT2JqZWN0Q2xhc3NlcykgIWEuSXNGYW1pbHkoKSAmJiBhLkhhc0xvYWRlZFRleHR1cmVzKCkgJiYgYS5SZWxlYXNlVGV4dHVyZXMoKTsKICAgICAgICAoYSA9IHRoaXMuR2V0TWFpblJ1bm5pbmdMYXlvdXQoKSkgJiYgYS5fT25XZWJHTENvbnRleHRMb3N0KCk7CiAgICAgICAgQzMkanNjb21wJDE3MC5JbWFnZUluZm8uT25XZWJHTENvbnRleHRMb3N0KCk7CiAgICAgICAgQzMkanNjb21wJDE3MC5JbWFnZUFzc2V0Lk9uV2ViR0xDb250ZXh0TG9zdCgpCiAgICB9CiAgICBhc3luYyBfT25XZWJHTENvbnRleHRSZXN0b3JlZCgpIHsKICAgICAgICBhd2FpdCB0aGlzLkdldE1haW5SdW5uaW5nTGF5b3V0KCkuX0xvYWQobnVsbCwgdGhpcy5HZXRXZWJHTFJlbmRlcmVyKCkpOwogICAgICAgIHRoaXMuX2Rpc3BhdGNoZXIuZGlzcGF0Y2hFdmVudChDMyRqc2NvbXAkMTcwLk5ldyhDMyRqc2NvbXAkMTcwLkV2ZW50LCAid2ViZ2xjb250ZXh0cmVzdG9yZWQiKSk7CiAgICAgICAgdGhpcy5TZXRTdXNwZW5kZWQoITEpOwogICAgICAgIHRoaXMuVXBkYXRlUmVuZGVyKCkKICAgIH0KICAgIF9PblZpc2liaWxpdHlDaGFuZ2UoYSkgewogICAgICAgIHRoaXMuU2V0U3VzcGVuZGVkKGEuaGlkZGVuKQogICAgfQogICAgX09uV2luZG93Qmx1cihhKSB7CiAgICAgICAgdGhpcy5Jc1ByZXZpZXcoKSAmJiB0aGlzLl9wYXVzZU9uQmx1ciAmJiAhQzMkanNjb21wJDE3MC5QbGF0Zm9ybS5Jc01vYmlsZSAmJiAhYS5kYXRhLnBhcmVudEhhc0ZvY3VzICYmICh0aGlzLlNldFN1c3BlbmRlZCghMCksIHRoaXMuX2lzUGF1c2VkT25CbHVyID0gITApCiAgICB9CiAgICBfT25XaW5kb3dGb2N1cygpIHsKICAgICAgICB0aGlzLl9pc1BhdXNlZE9uQmx1ciAmJiAodGhpcy5TZXRTdXNwZW5kZWQoITEpLCB0aGlzLl9pc1BhdXNlZE9uQmx1ciA9ICExKQogICAgfQogICAgX1JlcXVlc3RBbmltYXRpb25GcmFtZSgpIHsKICAgICAgICBjb25zdCBhID0gdGhpcy5fdGlja0NhbGxiYWNrczsKICAgICAgICAidnN5bmMiID09PSB0aGlzLl9mcmFtZXJhdGVNb2RlID8KICAgICAgICAgICAgLTEgPT09IHRoaXMuX3JhZklkICYmICh0aGlzLl9yYWZJZCA9IHNlbGYucmVxdWVzdEFuaW1hdGlvbkZyYW1lKGEubm9ybWFsKSkgOiAidW5saW1pdGVkLXRpY2siID09PSB0aGlzLl9mcmFtZXJhdGVNb2RlID8gKC0xID09PSB0aGlzLl9ydWFmSWQgJiYgKHRoaXMuX3J1YWZJZCA9IEMzJGpzY29tcCQxNzAuUmVxdWVzdFVubGltaXRlZEFuaW1hdGlvbkZyYW1lKGEudGlja09ubHkpKSwgLTEgPT09IHRoaXMuX3JhZklkICYmICh0aGlzLl9yYWZJZCA9IHNlbGYucmVxdWVzdEFuaW1hdGlvbkZyYW1lKGEucmVuZGVyT25seSkpKSA6IC0xID09PSB0aGlzLl9ydWFmSWQgJiYgKHRoaXMuX3J1YWZJZCA9IEMzJGpzY29tcCQxNzAuUmVxdWVzdFVubGltaXRlZEFuaW1hdGlvbkZyYW1lKGEubm9ybWFsKSkKICAgIH0KICAgIF9DYW5jZWxBbmltYXRpb25GcmFtZSgpIHsKICAgICAgICAtMSAhPT0gdGhpcy5fcmFmSWQgJiYgKHNlbGYuY2FuY2VsQW5pbWF0aW9uRnJhbWUodGhpcy5fcmFmSWQpLCB0aGlzLl9yYWZJZCA9IC0xKTsgLSAxICE9PSB0aGlzLl9ydWFmSWQgJiYgKEMzJGpzY29tcCQxNzAuQ2FuY2VsVW5saW1pdGVkQW5pbWF0aW9uRnJhbWUodGhpcy5fcnVhZklkKSwKICAgICAgICAgICAgdGhpcy5fcnVhZklkID0gLTEpCiAgICB9CiAgICBJc1N1c3BlbmRlZCgpIHsKICAgICAgICByZXR1cm4gMCA8IHRoaXMuX3N1c3BlbmRDb3VudAogICAgfQogICAgU2V0U3VzcGVuZGVkKGEpIHsKICAgICAgICBpZiAoIXRoaXMuSXNFeHBvcnRUb1ZpZGVvKCkpIHsKICAgICAgICAgICAgdmFyIGIgPSB0aGlzLklzU3VzcGVuZGVkKCk7CiAgICAgICAgICAgIHRoaXMuX3N1c3BlbmRDb3VudCArPSBhID8gMSA6IC0xOwogICAgICAgICAgICAwID4gdGhpcy5fc3VzcGVuZENvdW50ICYmICh0aGlzLl9zdXNwZW5kQ291bnQgPSAwKTsKICAgICAgICAgICAgYSA9IHRoaXMuSXNTdXNwZW5kZWQoKTsKICAgICAgICAgICAgIWIgJiYgYSA/IChjb25zb2xlLmxvZygiW0NvbnN0cnVjdF0gU3VzcGVuZGluZyIpLCB0aGlzLl9DYW5jZWxBbmltYXRpb25GcmFtZSgpLCB0aGlzLl9kaXNwYXRjaGVyLmRpc3BhdGNoRXZlbnQoQzMkanNjb21wJDE3MC5OZXcoQzMkanNjb21wJDE3MC5FdmVudCwgInN1c3BlbmQiKSksIHRoaXMuVHJpZ2dlcihDMyRqc2NvbXAkMTcwLlBsdWdpbnMuU3lzdGVtLkNuZHMuT25TdXNwZW5kLCBudWxsLCBudWxsKSkgOiBiICYmICFhICYmIChjb25zb2xlLmxvZygiW0NvbnN0cnVjdF0gUmVzdW1pbmciKSwgdGhpcy5fZnBzTGFzdFRpbWUgPQogICAgICAgICAgICAgICAgdGhpcy5fbGFzdFRpY2tUaW1lID0gYiA9IHBlcmZvcm1hbmNlLm5vdygpLCB0aGlzLl9tYWluVGhyZWFkVGltZUNvdW50ZXIgPSB0aGlzLl9tYWluVGhyZWFkVGltZSA9IHRoaXMuX2ZwcyA9IHRoaXMuX2Zwc0ZyYW1lQ291bnQgPSAwLCB0aGlzLl9kaXNwYXRjaGVyLmRpc3BhdGNoRXZlbnQoQzMkanNjb21wJDE3MC5OZXcoQzMkanNjb21wJDE3MC5FdmVudCwgInJlc3VtZSIpKSwgdGhpcy5UcmlnZ2VyKEMzJGpzY29tcCQxNzAuUGx1Z2lucy5TeXN0ZW0uQ25kcy5PblJlc3VtZSwgbnVsbCwgbnVsbCksIHRoaXMuSGl0QnJlYWtwb2ludCgpIHx8IHRoaXMuVGljayhiKSkKICAgICAgICB9CiAgICB9CiAgICBfQWRkQmVoSW5zdFRvVGljayhhKSB7CiAgICAgICAgdGhpcy5fYmVoSW5zdHNUb1RpY2suQWRkKGEpCiAgICB9CiAgICBfQWRkQmVoSW5zdFRvUG9zdFRpY2soYSkgewogICAgICAgIHRoaXMuX2JlaEluc3RzVG9Qb3N0VGljay5BZGQoYSkKICAgIH0KICAgIF9BZGRCZWhJbnN0VG9UaWNrMihhKSB7CiAgICAgICAgdGhpcy5fYmVoSW5zdHNUb1RpY2syLkFkZChhKQogICAgfQogICAgX1JlbW92ZUJlaEluc3RUb1RpY2soYSkgewogICAgICAgIHRoaXMuX2JlaEluc3RzVG9UaWNrLlJlbW92ZShhKQogICAgfQogICAgX1JlbW92ZUJlaEluc3RUb1Bvc3RUaWNrKGEpIHsKICAgICAgICB0aGlzLl9iZWhJbnN0c1RvUG9zdFRpY2suUmVtb3ZlKGEpCiAgICB9CiAgICBfUmVtb3ZlQmVoSW5zdFRvVGljazIoYSkgewogICAgICAgIHRoaXMuX2JlaEluc3RzVG9UaWNrMi5SZW1vdmUoYSkKICAgIH0KICAgIF9CZWhhdmlvclRpY2soKSB7CiAgICAgICAgdGhpcy5fYmVoSW5zdHNUb1RpY2suU2V0UXVldWVpbmdFbmFibGVkKCEwKTsKICAgICAgICBmb3IgKGNvbnN0IGEgb2YgdGhpcy5fYmVoSW5zdHNUb1RpY2spIGEuVGljaygpOwogICAgICAgIHRoaXMuX2JlaEluc3RzVG9UaWNrLlNldFF1ZXVlaW5nRW5hYmxlZCghMSkKICAgIH0KICAgIF9CZWhhdmlvclBvc3RUaWNrKCkgewogICAgICAgIHRoaXMuX2JlaEluc3RzVG9Qb3N0VGljay5TZXRRdWV1ZWluZ0VuYWJsZWQoITApOwogICAgICAgIGZvciAoY29uc3QgYSBvZiB0aGlzLl9iZWhJbnN0c1RvUG9zdFRpY2spIGEuUG9zdFRpY2soKTsKICAgICAgICB0aGlzLl9iZWhJbnN0c1RvUG9zdFRpY2suU2V0UXVldWVpbmdFbmFibGVkKCExKQogICAgfQogICAgX0JlaGF2aW9yVGljazIoKSB7CiAgICAgICAgdGhpcy5fYmVoSW5zdHNUb1RpY2syLlNldFF1ZXVlaW5nRW5hYmxlZCghMCk7CiAgICAgICAgZm9yIChjb25zdCBhIG9mIHRoaXMuX2JlaEluc3RzVG9UaWNrMikgYS5UaWNrMigpOwogICAgICAgIHRoaXMuX2JlaEluc3RzVG9UaWNrMi5TZXRRdWV1ZWluZ0VuYWJsZWQoITEpCiAgICB9KiBfRGVidWdCZWhhdmlvclRpY2soKSB7CiAgICAgICAgdGhpcy5fYmVoSW5zdHNUb1RpY2suU2V0UXVldWVpbmdFbmFibGVkKCEwKTsKICAgICAgICBmb3IgKGNvbnN0IGEgb2YgdGhpcy5fYmVoSW5zdHNUb1RpY2spIHsKICAgICAgICAgICAgY29uc3QgYiA9CiAgICAgICAgICAgICAgICBhLlRpY2soKTsKICAgICAgICAgICAgQzMkanNjb21wJDE3MC5Jc0l0ZXJhdG9yKGIpICYmICh5aWVsZCogYikKICAgICAgICB9CiAgICAgICAgdGhpcy5fYmVoSW5zdHNUb1RpY2suU2V0UXVldWVpbmdFbmFibGVkKCExKQogICAgfSogX0RlYnVnQmVoYXZpb3JQb3N0VGljaygpIHsKICAgICAgICB0aGlzLl9iZWhJbnN0c1RvUG9zdFRpY2suU2V0UXVldWVpbmdFbmFibGVkKCEwKTsKICAgICAgICBmb3IgKGNvbnN0IGEgb2YgdGhpcy5fYmVoSW5zdHNUb1Bvc3RUaWNrKSB7CiAgICAgICAgICAgIGNvbnN0IGIgPSBhLlBvc3RUaWNrKCk7CiAgICAgICAgICAgIEMzJGpzY29tcCQxNzAuSXNJdGVyYXRvcihiKSAmJiAoeWllbGQqIGIpCiAgICAgICAgfQogICAgICAgIHRoaXMuX2JlaEluc3RzVG9Qb3N0VGljay5TZXRRdWV1ZWluZ0VuYWJsZWQoITEpCiAgICB9KiBfRGVidWdCZWhhdmlvclRpY2syKCkgewogICAgICAgIHRoaXMuX2JlaEluc3RzVG9UaWNrMi5TZXRRdWV1ZWluZ0VuYWJsZWQoITApOwogICAgICAgIGZvciAoY29uc3QgYSBvZiB0aGlzLl9iZWhJbnN0c1RvVGljazIpIHsKICAgICAgICAgICAgY29uc3QgYiA9IGEuVGljazIoKTsKICAgICAgICAgICAgQzMkanNjb21wJDE3MC5Jc0l0ZXJhdG9yKGIpICYmICh5aWVsZCogYikKICAgICAgICB9CiAgICAgICAgdGhpcy5fYmVoSW5zdHNUb1RpY2syLlNldFF1ZXVlaW5nRW5hYmxlZCghMSkKICAgIH0KICAgIGFzeW5jIFRpY2soYSwKICAgICAgICBiLCBkKSB7CiAgICAgICAgdGhpcy5faGFzU3RhcnRlZFRpY2tpbmcgPSAhMDsKICAgICAgICBjb25zdCBjID0gImJhY2tncm91bmQtd2FrZSIgPT09IGQ7CiAgICAgICAgZCA9ICJiYWNrZ3JvdW5kLXdha2UiICE9PSBkICYmICJza2lwLXJlbmRlciIgIT09IGQ7CiAgICAgICAgaWYgKHRoaXMuX2hhc1N0YXJ0ZWQgJiYgKCF0aGlzLklzU3VzcGVuZGVkKCkgfHwgYiB8fCBjKSkgewogICAgICAgICAgICBiID0gcGVyZm9ybWFuY2Uubm93KCk7CiAgICAgICAgICAgIHRoaXMuX2lzSW5UaWNrID0gITA7CiAgICAgICAgICAgIHRoaXMuX01lYXN1cmVEdChhIHx8IDApOwogICAgICAgICAgICBhID0gdGhpcy5TdGVwX0JlZm9yZVByZVRpY2soKTsKICAgICAgICAgICAgdGhpcy5Jc0RlYnVnZ2luZygpICYmIGF3YWl0IGE7CiAgICAgICAgICAgIGEgPSB0aGlzLl9kaXNwYXRjaGVyLmRpc3BhdGNoRXZlbnRBbmRXYWl0X0FzeW5jT3B0aW9uYWwodGhpcy5fZXZlbnRPYmplY3RzLnByZXRpY2spOwogICAgICAgICAgICBhIGluc3RhbmNlb2YgUHJvbWlzZSAmJiBhd2FpdCBhOwogICAgICAgICAgICBhID0gdGhpcy5TdGVwX0FmdGVyUHJlVGljaygpOwogICAgICAgICAgICB0aGlzLklzRGVidWdnaW5nKCkgJiYgYXdhaXQgYTsKICAgICAgICAgICAgdGhpcy5fTmVlZHNIYW5kbGVTYXZlT3JMb2FkKCkgJiYgYXdhaXQgdGhpcy5fSGFuZGxlU2F2ZU9yTG9hZCgpOwogICAgICAgICAgICB0aGlzLkdldExheW91dE1hbmFnZXIoKS5Jc1BlbmRpbmdDaGFuZ2VNYWluTGF5b3V0KCkgJiYKICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuX01heWJlQ2hhbmdlTGF5b3V0KCk7CiAgICAgICAgICAgIGEgPSB0aGlzLlN0ZXBfUnVuRXZlbnRzRXRjKCk7CiAgICAgICAgICAgIHRoaXMuSXNEZWJ1Z2dpbmcoKSAmJiBhd2FpdCBhOwogICAgICAgICAgICBkICYmIHRoaXMuUmVuZGVyKCk7CiAgICAgICAgICAgIGlmICh0aGlzLklzRXhwb3J0VG9WaWRlbygpICYmIChhd2FpdCB0aGlzLl9FeHBvcnRUb1ZpZGVvQWRkRnJhbWUoKSwgdGhpcy5HZXRHYW1lVGltZSgpID49IHRoaXMuR2V0RXhwb3J0VmlkZW9EdXJhdGlvbigpKSkgewogICAgICAgICAgICAgICAgdGhpcy5fRXhwb3J0VG9WaWRlb0ZpbmlzaCgpOwogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5Jc1N1c3BlbmRlZCgpIHx8IGMgfHwgdGhpcy5fUmVxdWVzdEFuaW1hdGlvbkZyYW1lKCk7CiAgICAgICAgICAgIHRoaXMuX3RpY2tDb3VudCsrOwogICAgICAgICAgICB0aGlzLl90aWNrQ291bnROb1NhdmUrKzsKICAgICAgICAgICAgdGhpcy5faXNJblRpY2sgPSAhMTsKICAgICAgICAgICAgdGhpcy5fbWFpblRocmVhZFRpbWVDb3VudGVyICs9IHBlcmZvcm1hbmNlLm5vdygpIC0gYgogICAgICAgIH0KICAgIH0KICAgIGFzeW5jIFN0ZXBfQmVmb3JlUHJlVGljaygpIHsKICAgICAgICBjb25zdCBhID0gdGhpcy5fZXZlbnRTaGVldE1hbmFnZXIsCiAgICAgICAgICAgIGIgPSB0aGlzLklzRGVidWcoKTsKICAgICAgICB0aGlzLkZsdXNoUGVuZGluZ0luc3RhbmNlcygpOwogICAgICAgIGEuQmxvY2tGbHVzaGluZ0luc3RhbmNlcyghMCk7CiAgICAgICAgdGhpcy5QdXNoQ3VycmVudExheW91dCh0aGlzLkdldE1haW5SdW5uaW5nTGF5b3V0KCkpOwogICAgICAgIGIgJiYgQzNEZWJ1Z2dlciRqc2NvbXAkMy5TdGFydE1lYXN1cmluZ1RpbWUoKTsKICAgICAgICB0aGlzLklzRGVidWdnaW5nKCkgPyBhd2FpdCBhLkRlYnVnUnVuU2NoZWR1bGVkV2FpdHMoKSA6IGEuUnVuU2NoZWR1bGVkV2FpdHMoKTsKICAgICAgICBiICYmIEMzRGVidWdnZXIkanNjb21wJDMuQWRkRXZlbnRzVGltZSgpOwogICAgICAgIHRoaXMuUG9wQ3VycmVudExheW91dCgpOwogICAgICAgIGEuQmxvY2tGbHVzaGluZ0luc3RhbmNlcyghMSk7CiAgICAgICAgdGhpcy5GbHVzaFBlbmRpbmdJbnN0YW5jZXMoKTsKICAgICAgICBhLkJsb2NrRmx1c2hpbmdJbnN0YW5jZXMoITApCiAgICB9CiAgICBhc3luYyBTdGVwX0FmdGVyUHJlVGljaygpIHsKICAgICAgICBjb25zdCBhID0gdGhpcy5Jc0RlYnVnKCksCiAgICAgICAgICAgIGIgPSB0aGlzLklzRGVidWdnaW5nKCksCiAgICAgICAgICAgIGQgPSB0aGlzLl9kaXNwYXRjaGVyLAogICAgICAgICAgICBjID0gdGhpcy5fZXZlbnRPYmplY3RzLAogICAgICAgICAgICBlID0gdGhpcy5fdXNlclNjcmlwdEV2ZW50T2JqZWN0czsKICAgICAgICBhICYmIEMzRGVidWdnZXIkanNjb21wJDMuU3RhcnRNZWFzdXJpbmdUaW1lKCk7CiAgICAgICAgYiA/IGF3YWl0IHRoaXMuRGVidWdJdGVyYXRlQW5kQnJlYWsodGhpcy5fRGVidWdCZWhhdmlvclRpY2soKSkgOiB0aGlzLl9CZWhhdmlvclRpY2soKTsKICAgICAgICBiID8gYXdhaXQgdGhpcy5EZWJ1Z0l0ZXJhdGVBbmRCcmVhayh0aGlzLl9EZWJ1Z0JlaGF2aW9yUG9zdFRpY2soKSkgOiB0aGlzLl9CZWhhdmlvclBvc3RUaWNrKCk7CiAgICAgICAgYSAmJiBDM0RlYnVnZ2VyJGpzY29tcCQzLkFkZEJlaGF2aW9yVGlja1RpbWUoKTsKICAgICAgICBhICYmIEMzRGVidWdnZXIkanNjb21wJDMuU3RhcnRNZWFzdXJpbmdUaW1lKCk7CiAgICAgICAgYiA/IGF3YWl0IHRoaXMuRGVidWdGaXJlR2VuZXJhdG9yRXZlbnRBbmRCcmVhayhjLnRpY2spIDogZC5kaXNwYXRjaEV2ZW50KGMudGljayk7CiAgICAgICAgYSAmJiBDM0RlYnVnZ2VyJGpzY29tcCQzLkFkZFBsdWdpblRpY2tUaW1lKCk7CiAgICAgICAgdGhpcy5fZXZlbnRTaGVldE1hbmFnZXIuQmxvY2tGbHVzaGluZ0luc3RhbmNlcyghMSk7CiAgICAgICAgdGhpcy5EaXNwYXRjaFVzZXJTY3JpcHRFdmVudChlLnRpY2spCiAgICB9CiAgICBhc3luYyBTdGVwX1J1bkV2ZW50c0V0YygpIHsKICAgICAgICBjb25zdCBhID0KICAgICAgICAgICAgdGhpcy5fZXZlbnRTaGVldE1hbmFnZXIsCiAgICAgICAgICAgIGIgPSB0aGlzLl9kaXNwYXRjaGVyLAogICAgICAgICAgICBkID0gdGhpcy5fZXZlbnRPYmplY3RzLAogICAgICAgICAgICBjID0gdGhpcy5Jc0RlYnVnKCksCiAgICAgICAgICAgIGUgPSB0aGlzLklzRGVidWdnaW5nKCk7CiAgICAgICAgYyAmJiBDM0RlYnVnZ2VyJGpzY29tcCQzLlN0YXJ0TWVhc3VyaW5nVGltZSgpOwogICAgICAgIGUgPyBhd2FpdCBhLkRlYnVnUnVuRXZlbnRzKHRoaXMuX2xheW91dE1hbmFnZXIpIDogYS5SdW5FdmVudHModGhpcy5fbGF5b3V0TWFuYWdlcik7CiAgICAgICAgYyAmJiBDM0RlYnVnZ2VyJGpzY29tcCQzLkFkZEV2ZW50c1RpbWUoKTsKICAgICAgICB0aGlzLl9jb2xsaXNpb25FbmdpbmUuQ2xlYXJSZWdpc3RlcmVkQ29sbGlzaW9ucygpOwogICAgICAgIHRoaXMuX1JlbGVhc2VJbnN0YW5jZXNBdEVuZE9mVGljaygpOwogICAgICAgIHRoaXMuX2lzTGF5b3V0Rmlyc3RUaWNrID0gITE7CiAgICAgICAgYS5CbG9ja0ZsdXNoaW5nSW5zdGFuY2VzKCEwKTsKICAgICAgICBjICYmIEMzRGVidWdnZXIkanNjb21wJDMuU3RhcnRNZWFzdXJpbmdUaW1lKCk7CiAgICAgICAgZSA/IGF3YWl0IHRoaXMuRGVidWdJdGVyYXRlQW5kQnJlYWsodGhpcy5fRGVidWdCZWhhdmlvclRpY2syKCkpIDoKICAgICAgICAgICAgdGhpcy5fQmVoYXZpb3JUaWNrMigpOwogICAgICAgIGMgJiYgQzNEZWJ1Z2dlciRqc2NvbXAkMy5BZGRCZWhhdmlvclRpY2tUaW1lKCk7CiAgICAgICAgYyAmJiBDM0RlYnVnZ2VyJGpzY29tcCQzLlN0YXJ0TWVhc3VyaW5nVGltZSgpOwogICAgICAgIGUgPyBhd2FpdCB0aGlzLkRlYnVnRmlyZUdlbmVyYXRvckV2ZW50QW5kQnJlYWsoZC50aWNrMikgOiBiLmRpc3BhdGNoRXZlbnQoZC50aWNrMik7CiAgICAgICAgYyAmJiBDM0RlYnVnZ2VyJGpzY29tcCQzLkFkZFBsdWdpblRpY2tUaW1lKCk7CiAgICAgICAgYS5CbG9ja0ZsdXNoaW5nSW5zdGFuY2VzKCExKTsKICAgICAgICBlICYmIGF3YWl0IGEuUnVuUXVldWVkRGVidWdUcmlnZ2Vyc0FzeW5jKCkKICAgIH0KICAgIF9SZWxlYXNlSW5zdGFuY2VzQXRFbmRPZlRpY2soKSB7CiAgICAgICAgaWYgKDAgIT09IHRoaXMuX2luc3RhbmNlc1RvUmVsZWFzZUF0RW5kT2ZUaWNrLnNpemUpIHsKICAgICAgICAgICAgdmFyIGEgPSB0aGlzLl9kaXNwYXRjaGVyOwogICAgICAgICAgICBhLlNldERlbGF5UmVtb3ZlRXZlbnRzRW5hYmxlZCghMCk7CiAgICAgICAgICAgIGZvciAoY29uc3QgYiBvZiB0aGlzLl9pbnN0YW5jZXNUb1JlbGVhc2VBZmZlY3RlZE9iamVjdENsYXNzZXMpIGIuR2V0U29sU3RhY2soKS5SZW1vdmVJbnN0YW5jZXModGhpcy5faW5zdGFuY2VzVG9SZWxlYXNlQXRFbmRPZlRpY2spOwogICAgICAgICAgICB0aGlzLl9pbnN0YW5jZXNUb1JlbGVhc2VBZmZlY3RlZE9iamVjdENsYXNzZXMuY2xlYXIoKTsKICAgICAgICAgICAgdGhpcy5fZXZlbnRTaGVldE1hbmFnZXIuUmVtb3ZlSW5zdGFuY2VzRnJvbVNjaGVkdWxlZFdhaXRzKHRoaXMuX2luc3RhbmNlc1RvUmVsZWFzZUF0RW5kT2ZUaWNrKTsKICAgICAgICAgICAgZm9yIChjb25zdCBiIG9mIHRoaXMuX2luc3RhbmNlc1RvUmVsZWFzZUF0RW5kT2ZUaWNrKSBiLlJlbGVhc2UoKTsKICAgICAgICAgICAgdGhpcy5faW5zdGFuY2VzVG9SZWxlYXNlQXRFbmRPZlRpY2suY2xlYXIoKTsKICAgICAgICAgICAgYS5TZXREZWxheVJlbW92ZUV2ZW50c0VuYWJsZWQoITEpCiAgICAgICAgfQogICAgfQogICAgYXN5bmMgX01heWJlQ2hhbmdlTGF5b3V0KCkgewogICAgICAgIGNvbnN0IGEgPSB0aGlzLkdldExheW91dE1hbmFnZXIoKTsKICAgICAgICBsZXQgYiA9IDA7CiAgICAgICAgZm9yICg7IGEuSXNQZW5kaW5nQ2hhbmdlTWFpbkxheW91dCgpICYmIDEwID4gYisrOykgYXdhaXQgdGhpcy5fRG9DaGFuZ2VMYXlvdXQoYS5HZXRQZW5kaW5nQ2hhbmdlTWFpbkxheW91dCgpKQogICAgfQogICAgX01lYXN1cmVEdChhKSB7CiAgICAgICAgbGV0IGIgPSAwOwogICAgICAgIHRoaXMuSXNFeHBvcnRUb1ZpZGVvKCkgPwogICAgICAgICAgICB0aGlzLl9kdDEgPSBiID0gMSAvIHRoaXMuR2V0RXhwb3J0VmlkZW9GcmFtZXJhdGUoKSA6IDAgIT09IHRoaXMuX2xhc3RUaWNrVGltZSAmJiAoYiA9IE1hdGgubWF4KGEgLSB0aGlzLl9sYXN0VGlja1RpbWUsIDApIC8gMUUzLCAuNSA8IGIgJiYgKGIgPSAwKSwgdGhpcy5fZHQxID0gTWF0aC5taW4oYiwgMSAvIHRoaXMuX21pbmltdW1GcmFtZXJhdGUpKTsKICAgICAgICB0aGlzLl9sYXN0VGlja1RpbWUgPSBhOwogICAgICAgIHRoaXMuX2R0ID0gdGhpcy5fZHQxICogdGhpcy5fdGltZVNjYWxlOwogICAgICAgIHRoaXMuX2dhbWVUaW1lLkFkZCh0aGlzLl9kdCk7CiAgICAgICAgdGhpcy5fZ2FtZVRpbWVSYXcuQWRkKGIgKiB0aGlzLl90aW1lU2NhbGUpOwogICAgICAgIHRoaXMuX3dhbGxUaW1lLkFkZCh0aGlzLl9kdDEpOwogICAgICAgIGZvciAoY29uc3QgW2QsIGNdIG9mIHRoaXMuX2luc3RhbmNlVGltZXMpIGMuQWRkKHRoaXMuX2R0MSAqIGQuR2V0VGltZVNjYWxlKCkpOwogICAgICAgIHRoaXMuX2NhbnZhc01hbmFnZXIgJiYgdGhpcy5fY2FudmFzTWFuYWdlci5fVXBkYXRlVGljaygpOwogICAgICAgIDFFMyA8PSBhIC0gdGhpcy5fZnBzTGFzdFRpbWUgJiYgKHRoaXMuX2Zwc0xhc3RUaW1lICs9IDFFMywKICAgICAgICAgICAgMUUzIDw9IGEgLSB0aGlzLl9mcHNMYXN0VGltZSAmJiAodGhpcy5fZnBzTGFzdFRpbWUgPSBhKSwgdGhpcy5fZnBzID0gdGhpcy5fZnBzRnJhbWVDb3VudCwgdGhpcy5fZnBzRnJhbWVDb3VudCA9IDAsIHRoaXMuX21haW5UaHJlYWRUaW1lID0gTWF0aC5taW4odGhpcy5fbWFpblRocmVhZFRpbWVDb3VudGVyIC8gMUUzLCAxKSwgdGhpcy5fbWFpblRocmVhZFRpbWVDb3VudGVyID0gMCwgdGhpcy5fY2FudmFzTWFuYWdlciAmJiB0aGlzLl9jYW52YXNNYW5hZ2VyLl9VcGRhdGUxc0ZyYW1lUmFuZ2UoKSwgdGhpcy5fY29sbGlzaW9uRW5naW5lLl9VcGRhdGUxc1N0YXRzKCksIHRoaXMuSXNEZWJ1ZygpICYmIEMzRGVidWdnZXIkanNjb21wJDMuVXBkYXRlMXNQZXJmU3RhdHMoKSk7CiAgICAgICAgdGhpcy5fZnBzRnJhbWVDb3VudCsrCiAgICB9CiAgICBfU2V0VHJhY2tpbmdJbnN0YW5jZVRpbWUoYSwgYikgewogICAgICAgIGIgPyB0aGlzLl9pbnN0YW5jZVRpbWVzLmhhcyhhKSB8fCAoYiA9IEMzJGpzY29tcCQxNzAuTmV3KEMzJGpzY29tcCQxNzAuS2FoYW5TdW0pLCBiLkNvcHkodGhpcy5fZ2FtZVRpbWUpLAogICAgICAgICAgICB0aGlzLl9pbnN0YW5jZVRpbWVzLnNldChhLCBiKSkgOiB0aGlzLl9pbnN0YW5jZVRpbWVzLmRlbGV0ZShhKQogICAgfQogICAgX0dldEluc3RhbmNlR2FtZVRpbWUoYSkgewogICAgICAgIHJldHVybiAoYSA9IHRoaXMuX2luc3RhbmNlVGltZXMuZ2V0KGEpKSA/IGEuR2V0KCkgOiB0aGlzLkdldEdhbWVUaW1lKCkKICAgIH0KICAgIGFzeW5jIF9Eb0NoYW5nZUxheW91dChhKSB7CiAgICAgICAgY29uc3QgYiA9IHRoaXMuX2Rpc3BhdGNoZXIsCiAgICAgICAgICAgIGQgPSB0aGlzLkdldExheW91dE1hbmFnZXIoKS5HZXRNYWluUnVubmluZ0xheW91dCgpOwogICAgICAgIGF3YWl0IGQuX1N0b3BSdW5uaW5nKCk7CiAgICAgICAgZC5fVW5sb2FkKGEsIHRoaXMuR2V0UmVuZGVyZXIoKSk7CiAgICAgICAgZCA9PT0gYSAmJiB0aGlzLl9ldmVudFNoZWV0TWFuYWdlci5DbGVhckFsbFNjaGVkdWxlZFdhaXRzKCk7CiAgICAgICAgdGhpcy5fY29sbGlzaW9uRW5naW5lLkNsZWFyUmVnaXN0ZXJlZENvbGxpc2lvbnMoKTsKICAgICAgICB0aGlzLl9SZWxlYXNlSW5zdGFuY2VzQXRFbmRPZlRpY2soKTsKICAgICAgICBiLmRpc3BhdGNoRXZlbnQodGhpcy5fZXZlbnRPYmplY3RzLmJlZm9yZWxheW91dGNoYW5nZSk7CiAgICAgICAgQzMkanNjb21wJDE3MC5Bc3luY2lmeS5TZXRIaWdoVGhyb3VnaHB1dE1vZGUoITApOwogICAgICAgIGF3YWl0IGEuX0xvYWQoZCwgdGhpcy5HZXRSZW5kZXJlcigpKTsKICAgICAgICBDMyRqc2NvbXAkMTcwLkFzeW5jaWZ5LlNldEhpZ2hUaHJvdWdocHV0TW9kZSghMSk7CiAgICAgICAgYXdhaXQgYS5fU3RhcnRSdW5uaW5nKCExKTsKICAgICAgICBiLmRpc3BhdGNoRXZlbnQodGhpcy5fZXZlbnRPYmplY3RzLmxheW91dGNoYW5nZSk7CiAgICAgICAgdGhpcy5VcGRhdGVSZW5kZXIoKTsKICAgICAgICB0aGlzLl9pc0xheW91dEZpcnN0VGljayA9ICEwOwogICAgICAgIHRoaXMuRmx1c2hQZW5kaW5nSW5zdGFuY2VzKCk7CiAgICAgICAgdGhpcy5fRXhwb3J0VG9WaWRlb0FkZEtleWZyYW1lKCkKICAgIH0KICAgIFVwZGF0ZVJlbmRlcigpIHsKICAgICAgICB0aGlzLl9uZWVkUmVuZGVyID0gITAKICAgIH0KICAgIEdldFdlYkdMUmVuZGVyZXIoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2NhbnZhc01hbmFnZXIgPyB0aGlzLl9jYW52YXNNYW5hZ2VyLkdldFdlYkdMUmVuZGVyZXIoKSA6IG51bGwKICAgIH0KICAgIEdldFdlYkdQVVJlbmRlcmVyKCkgewogICAgICAgIHJldHVybiB0aGlzLl9jYW52YXNNYW5hZ2VyID8gdGhpcy5fY2FudmFzTWFuYWdlci5HZXRXZWJHUFVSZW5kZXJlcigpIDogbnVsbAogICAgfQogICAgR2V0UmVuZGVyZXIoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2NhbnZhc01hbmFnZXIgPwogICAgICAgICAgICB0aGlzLl9jYW52YXNNYW5hZ2VyLkdldFJlbmRlcmVyKCkgOiBudWxsCiAgICB9CiAgICBSZW5kZXIoKSB7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuX2NhbnZhc01hbmFnZXI7CiAgICAgICAgaWYgKGEgJiYgIWEuSXNSZW5kZXJlckNvbnRleHRMb3N0KCkpIHsKICAgICAgICAgICAgdmFyIGIgPSB0aGlzLkdldFJlbmRlcmVyKCksCiAgICAgICAgICAgICAgICBkID0gYi5TdXBwb3J0c0dQVVByb2ZpbGluZygpLAogICAgICAgICAgICAgICAgYyA9IGQgJiYgYi5Jc1dlYkdMKCk7CiAgICAgICAgICAgIGQgPSBkICYmIGIuSXNXZWJHUFUoKTsKICAgICAgICAgICAgYyAmJiBiLkNoZWNrRm9yUXVlcnlSZXN1bHRzKCk7CiAgICAgICAgICAgIGlmICh0aGlzLl9uZWVkUmVuZGVyIHx8IHRoaXMuSXNFeHBvcnRUb1ZpZGVvKCkpIHsKICAgICAgICAgICAgICAgIHZhciBlID0gdGhpcy5fbGF5b3V0TWFuYWdlci5HZXRNYWluUnVubmluZ0xheW91dCgpOwogICAgICAgICAgICAgICAgYi5TdGFydCgpOwogICAgICAgICAgICAgICAgdmFyIGcgPSB0aGlzLklzRGVidWcoKTsKICAgICAgICAgICAgICAgIGcgJiYgQzNEZWJ1Z2dlciRqc2NvbXAkMy5TdGFydE1lYXN1cmluZ1RpbWUoKTsKICAgICAgICAgICAgICAgIHRoaXMuX25lZWRSZW5kZXIgPSAhMTsKICAgICAgICAgICAgICAgIHZhciBrID0gbnVsbDsKICAgICAgICAgICAgICAgIGMgJiYgKGsgPSBhLkdldEdQVUZyYW1lVGltaW5nc0J1ZmZlcigpLkFkZFRpbWVFbGFwc2VkUXVlcnkoKSwgYi5TdGFydFF1ZXJ5KGspKTsKICAgICAgICAgICAgICAgIGMgPQogICAgICAgICAgICAgICAgICAgIG51bGw7CiAgICAgICAgICAgICAgICBkICYmIChjID0gYi5TdGFydEZyYW1lVGltaW5nKDIgKiAoMSArIGUuR2V0TGF5ZXJDb3VudCgpKSksIGIuV3JpdGVUaW1lc3RhbXAoMCkpOwogICAgICAgICAgICAgICAgdGhpcy5Vc2VzM0RGZWF0dXJlcygpICYmICJsb3ciID09PSBhLkdldEN1cnJlbnRGdWxsc2NyZWVuU2NhbGluZ1F1YWxpdHkoKSA/IGIuU2V0Rml4ZWRTaXplRGVwdGhCdWZmZXIoYS5HZXREcmF3V2lkdGgoKSwgYS5HZXREcmF3SGVpZ2h0KCkpIDogYi5TZXRBdXRvU2l6ZURlcHRoQnVmZmVyKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9SZW5kZXIodGhpcy5HZXRSZW5kZXJlcigpLCBlKTsKICAgICAgICAgICAgICAgIGsgJiYgYi5FbmRRdWVyeShrKTsKICAgICAgICAgICAgICAgIGQgJiYgKGIuV3JpdGVUaW1lc3RhbXAoMSksIHRoaXMuX2NhbnZhc01hbmFnZXIuX0FkZFdlYkdQVUZyYW1lVGltaW5nKGMpKTsKICAgICAgICAgICAgICAgIGIuRmluaXNoKCk7CiAgICAgICAgICAgICAgICBnICYmIChDM0RlYnVnZ2VyJGpzY29tcCQzLkFkZERyYXdDYWxsc1RpbWUoKSwgQzNEZWJ1Z2dlciRqc2NvbXAkMy5VcGRhdGVJbnNwZWN0SGlnaGxpZ2h0KCkpOwogICAgICAgICAgICAgICAgYSAmJiBhLl9NYXliZVRha2VTbmFwc2hvdCgpCiAgICAgICAgICAgIH0gZWxzZSBiLkluY3JlbWVudEZyYW1lTnVtYmVyKCkKICAgICAgICB9CiAgICB9CiAgICBfUmVuZGVyKGEsCiAgICAgICAgYikgewogICAgICAgIGEuU2V0VGV4dHVyZUZpbGxNb2RlKCk7CiAgICAgICAgYS5TZXRBbHBoYUJsZW5kKCk7CiAgICAgICAgYS5TZXRDb2xvclJnYmEoMSwgMSwgMSwgMSk7CiAgICAgICAgYS5TZXRSZW5kZXJUYXJnZXQobnVsbCk7CiAgICAgICAgYS5TZXRUZXh0dXJlKG51bGwpOwogICAgICAgIGEuU2V0RGVwdGhFbmFibGVkKHRoaXMuVXNlczNERmVhdHVyZXMoKSk7CiAgICAgICAgYi5EcmF3KGEpCiAgICB9CiAgICBUcmlnZ2VyKGEsIGIsIGQpIHsKICAgICAgICBpZiAoIXRoaXMuX2hhc1N0YXJ0ZWQpIHJldHVybiAhMTsKICAgICAgICB2YXIgYyA9ICF0aGlzLl9pc0luVGljayAmJiAhdGhpcy5fZXZlbnRTaGVldE1hbmFnZXIuSXNJblRyaWdnZXIoKTsKICAgICAgICBsZXQgZSA9IDA7CiAgICAgICAgYyAmJiAoZSA9IHBlcmZvcm1hbmNlLm5vdygpKTsKICAgICAgICBjb25zdCBnID0gdGhpcy5Jc0RlYnVnKCk7CiAgICAgICAgZyAmJiB0aGlzLlNldERlYnVnZ2luZ0VuYWJsZWQoITEpOwogICAgICAgIGEgPSB0aGlzLl9ldmVudFNoZWV0TWFuYWdlci5fVHJpZ2dlcih0aGlzLl9sYXlvdXRNYW5hZ2VyLCBhLCBiLCBkKTsKICAgICAgICBjICYmIChjID0gcGVyZm9ybWFuY2Uubm93KCkgLSBlLCB0aGlzLl9tYWluVGhyZWFkVGltZUNvdW50ZXIgKz0gYywgZyAmJiBDM0RlYnVnZ2VyJGpzY29tcCQzLkFkZFRyaWdnZXJzVGltZShjKSk7CiAgICAgICAgZyAmJiB0aGlzLlNldERlYnVnZ2luZ0VuYWJsZWQoITApOwogICAgICAgIHJldHVybiBhCiAgICB9CiAgICBEZWJ1Z1RyaWdnZXIoYSwgYiwgZCkgewogICAgICAgIGlmICghdGhpcy5Jc0RlYnVnKCkpIHJldHVybiB0aGlzLlRyaWdnZXIoYSwgYiwgZCk7CiAgICAgICAgaWYgKHRoaXMuSGl0QnJlYWtwb2ludCgpKSB0aHJvdyBFcnJvcigiY2FsbGVkIERlYnVnVHJpZ2dlcigpIHdoaWxlIHN0b3BwZWQgb24gYnJlYWtwb2ludCIpOwogICAgICAgIGlmICghdGhpcy5faXNJblRpY2sgJiYgIXRoaXMuX2V2ZW50U2hlZXRNYW5hZ2VyLklzSW5UcmlnZ2VyKCkpIHRocm93IEVycm9yKCJjYWxsZWQgRGVidWdUcmlnZ2VyKCkgb3V0c2lkZSBvZiBldmVudCBjb2RlIC0gdXNlIFRyaWdnZXJBc3luYygpIGluc3RlYWQiKTsKICAgICAgICByZXR1cm4gdGhpcy5fZXZlbnRTaGVldE1hbmFnZXIuX0RlYnVnVHJpZ2dlcih0aGlzLl9sYXlvdXRNYW5hZ2VyLCBhLCBiLCBkKQogICAgfQogICAgYXN5bmMgVHJpZ2dlckFzeW5jKGEsIGIsIGQpIHsKICAgICAgICBpZiAoIXRoaXMuSXNEZWJ1Z2dpbmcoKSkgcmV0dXJuIHRoaXMuVHJpZ2dlcihhLCBiLCBkKTsKICAgICAgICBpZiAoIXRoaXMuX2hhc1N0YXJ0ZWQpIHJldHVybiAhMTsKICAgICAgICBpZiAodGhpcy5IaXRCcmVha3BvaW50KCkpIHJldHVybiB0aGlzLl9ldmVudFNoZWV0TWFuYWdlci5RdWV1ZURlYnVnVHJpZ2dlcihhLCBiLCBkKTsKICAgICAgICBpZiAoIXRoaXMuR2V0TWFpblJ1bm5pbmdMYXlvdXQoKSkgcmV0dXJuIHRoaXMuX2V2ZW50U2hlZXRNYW5hZ2VyLlF1ZXVlVHJpZ2dlcihhLCBiLCBkKTsKICAgICAgICBjb25zdCBjID0gcGVyZm9ybWFuY2Uubm93KCk7CiAgICAgICAgYSA9IHRoaXMuX2V2ZW50U2hlZXRNYW5hZ2VyLl9EZWJ1Z1RyaWdnZXIodGhpcy5fbGF5b3V0TWFuYWdlciwgYSwgYiwgZCk7CiAgICAgICAgZm9yIChiID0gYS5uZXh0KCk7ICFiLmRvbmU7KSBhd2FpdCB0aGlzLkRlYnVnQnJlYWsoYi52YWx1ZSksIGIgPSBhLm5leHQoKTsKICAgICAgICB0aGlzLklzU3VzcGVuZGVkKCkgfHwgdGhpcy5fZXZlbnRTaGVldE1hbmFnZXIuSXNJblRyaWdnZXIoKSB8fCAoYXdhaXQgdGhpcy5fZXZlbnRTaGVldE1hbmFnZXIuUnVuUXVldWVkRGVidWdUcmlnZ2Vyc0FzeW5jKCksIHRoaXMuX2hhc1N0YXJ0ZWRUaWNraW5nICYmICF0aGlzLl9pc0luVGljayAmJiB0aGlzLl9SZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKSk7CiAgICAgICAgdGhpcy5fbWFpblRocmVhZFRpbWVDb3VudGVyICs9IHBlcmZvcm1hbmNlLm5vdygpIC0gYzsKICAgICAgICByZXR1cm4gYi52YWx1ZQogICAgfQogICAgRmFzdFRyaWdnZXIoYSwgYiwgZCkgewogICAgICAgIGNvbnN0IGMgPSB0aGlzLklzRGVidWcoKTsKICAgICAgICBjICYmIHRoaXMuU2V0RGVidWdnaW5nRW5hYmxlZCghMSk7CiAgICAgICAgYSA9IHRoaXMuX2V2ZW50U2hlZXRNYW5hZ2VyLl9GYXN0VHJpZ2dlcih0aGlzLl9sYXlvdXRNYW5hZ2VyLCBhLCBiLCBkKTsKICAgICAgICBjICYmIHRoaXMuU2V0RGVidWdnaW5nRW5hYmxlZCghMCk7CiAgICAgICAgcmV0dXJuIGEKICAgIH0KICAgIERlYnVnRmFzdFRyaWdnZXIoYSwgYiwgZCkgewogICAgICAgIHJldHVybiB0aGlzLl9ldmVudFNoZWV0TWFuYWdlci5fRGVidWdGYXN0VHJpZ2dlcih0aGlzLl9sYXlvdXRNYW5hZ2VyLCBhLCBiLCBkKQogICAgfQogICAgU2NoZWR1bGVUcmlnZ2VycyhhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3NjaGVkdWxlVHJpZ2dlcnNUaHJvdHRsZS5BZGQoYSkKICAgIH0KICAgIFB1c2hDdXJyZW50TGF5b3V0KGEpIHsKICAgICAgICB0aGlzLl9jdXJyZW50TGF5b3V0U3RhY2sucHVzaChhKQogICAgfQogICAgUG9wQ3VycmVudExheW91dCgpIHsKICAgICAgICBpZiAoIXRoaXMuX2N1cnJlbnRMYXlvdXRTdGFjay5sZW5ndGgpIHRocm93IEVycm9yKCJsYXlvdXQgc3RhY2sgZW1wdHkiKTsKICAgICAgICB0aGlzLl9jdXJyZW50TGF5b3V0U3RhY2sucG9wKCkKICAgIH0KICAgIEdldEN1cnJlbnRMYXlvdXQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2N1cnJlbnRMYXlvdXRTdGFjay5sZW5ndGggPyB0aGlzLl9jdXJyZW50TGF5b3V0U3RhY2suYXQoLTEpIDogdGhpcy5HZXRNYWluUnVubmluZ0xheW91dCgpCiAgICB9CiAgICBHZXREdChhKSB7CiAgICAgICAgcmV0dXJuIGEgJiYgLTEgIT09IGEuR2V0VGltZVNjYWxlKCkgPyB0aGlzLl9kdDEgKiBhLkdldFRpbWVTY2FsZSgpIDogdGhpcy5fZHQKICAgIH0KICAgIF9HZXREdEZhc3QoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2R0CiAgICB9CiAgICBHZXREdDEoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2R0MQogICAgfQogICAgR2V0VGltZVNjYWxlKCkgewogICAgICAgIHJldHVybiB0aGlzLl90aW1lU2NhbGUKICAgIH0KICAgIFNldFRpbWVTY2FsZShhKSB7CiAgICAgICAgaWYgKGlzTmFOKGEpIHx8IDAgPiBhKSBhID0gMDsKICAgICAgICB0aGlzLl90aW1lU2NhbGUgPSBhCiAgICB9CiAgICBTZXRNaW5pbXVtRnJhbWVyYXRlKGEpIHsKICAgICAgICB0aGlzLl9taW5pbXVtRnJhbWVyYXRlID0gQzMkanNjb21wJDE3MC5jbGFtcChhLCAxLCAxMjApCiAgICB9CiAgICBHZXRNaW5pbXVtRnJhbWVyYXRlKCkgewogICAgICAgIHJldHVybiB0aGlzLl9taW5pbXVtRnJhbWVyYXRlCiAgICB9CiAgICBHZXRGUFMoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2ZwcwogICAgfQogICAgR2V0TWFpblRocmVhZFRpbWUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX21haW5UaHJlYWRUaW1lCiAgICB9CiAgICBHZXRTdGFydFRpbWUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3N0YXJ0VGltZQogICAgfQogICAgR2V0R2FtZVRpbWUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2dhbWVUaW1lLkdldCgpCiAgICB9CiAgICBHZXRHYW1lVGltZVJhdygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZ2FtZVRpbWVSYXcuR2V0KCkKICAgIH0KICAgIEdldFdhbGxUaW1lKCkgewogICAgICAgIHJldHVybiB0aGlzLl93YWxsVGltZS5HZXQoKQogICAgfQogICAgR2V0VGlja0NvdW50KCkgewogICAgICAgIHJldHVybiB0aGlzLl90aWNrQ291bnQKICAgIH0KICAgIEdldFRpY2tDb3VudE5vU2F2ZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdGlja0NvdW50Tm9TYXZlCiAgICB9CiAgICBHZXRPYmplY3RDb3VudCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fb2JqZWN0Q291bnQKICAgIH0KICAgIEdldFByb2plY3ROYW1lKCkgewogICAgICAgIHJldHVybiB0aGlzLl9wcm9qZWN0TmFtZQogICAgfQogICAgR2V0UHJvamVjdFZlcnNpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3Byb2plY3RWZXJzaW9uCiAgICB9CiAgICBHZXRQcm9qZWN0VW5pcXVlSWQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3Byb2plY3RVbmlxdWVJZAogICAgfQogICAgR2V0QXBwSWQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2FwcElkCiAgICB9CiAgICBHZXRJbnN0YW5jZUJ5VUlEKGEpIHsKICAgICAgICBpZiAodGhpcy5faXNMb2FkaW5nU3RhdGUpIHRocm93IEVycm9yKCJjYW5ub3QgY2FsbCB3aGlsZSBsb2FkaW5nIHN0YXRlIC0gd2FpdCB1bnRpbCBhZnRlcmxvYWQgZXZlbnQiKTsKICAgICAgICByZXR1cm4gdGhpcy5faW5zdGFuY2VzQnlVaWQuZ2V0KGEpIHx8IG51bGwKICAgIH0KICAgIF9SZWZyZXNoVWlkTWFwKCkgewogICAgICAgIHRoaXMuX2luc3RhbmNlc0J5VWlkLmNsZWFyKCk7CiAgICAgICAgZm9yIChjb25zdCBhIG9mIHRoaXMuX2FsbE9iamVjdENsYXNzZXMpCiAgICAgICAgICAgIGlmICghYS5Jc0ZhbWlseSgpKQogICAgICAgICAgICAgICAgZm9yIChjb25zdCBiIG9mIGEuR2V0SW5zdGFuY2VzKCkpIHRoaXMuX2luc3RhbmNlc0J5VWlkLnNldChiLkdldFVJRCgpLCBiKQogICAgfQogICAgSXNQcmV2aWV3KCkgewogICAgICAgIHJldHVybiAicHJldmlldyIgPT09IHRoaXMuX2V4cG9ydFR5cGUKICAgIH0KICAgIElzRGVidWcoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2lzRGVidWcKICAgIH0KICAgIEdldEV4cG9ydFR5cGUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2V4cG9ydFR5cGUKICAgIH0KICAgIElzQ29yZG92YSgpIHsKICAgICAgICByZXR1cm4gImNvcmRvdmEiID09PSB0aGlzLl9leHBvcnRUeXBlCiAgICB9CiAgICBJc0FuZHJvaWRXZWJWaWV3KCkgewogICAgICAgIHJldHVybiAiQW5kcm9pZCIgPT09IEMzJGpzY29tcCQxNzAuUGxhdGZvcm0uT1MgJiYgKCJjb3Jkb3ZhIiA9PT0gdGhpcy5fZXhwb3J0VHlwZSB8fCAicGxheWFibGUtYWQiID09PSB0aGlzLl9leHBvcnRUeXBlIHx8CiAgICAgICAgICAgICJpbnN0YW50LWdhbWVzIiA9PT0gdGhpcy5fZXhwb3J0VHlwZSkKICAgIH0KICAgIElzaU9TQ29yZG92YSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5faXNpT1NDb3Jkb3ZhCiAgICB9CiAgICBJc2lPU1dlYlZpZXcoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2lzaU9TV2ViVmlldwogICAgfQogICAgR2V0Q29sbGlzaW9uRW5naW5lKCkgewogICAgICAgIHJldHVybiB0aGlzLl9jb2xsaXNpb25FbmdpbmUKICAgIH0KICAgIEdldFNvbGlkQmVoYXZpb3IoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3BsdWdpbk1hbmFnZXIuR2V0U29saWRCZWhhdmlvcigpCiAgICB9CiAgICBHZXRKdW1wdGhydUJlaGF2aW9yKCkgewogICAgICAgIHJldHVybiB0aGlzLl9wbHVnaW5NYW5hZ2VyLkdldEp1bXB0aHJ1QmVoYXZpb3IoKQogICAgfQogICAgVXNlczNERmVhdHVyZXMoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3VzZXMzZEZlYXR1cmVzCiAgICB9CiAgICBHZXRaU2NhbGVGYWN0b3IoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuR2V0UmVuZGVyZXIoKS5HZXRaQXhpc1NjYWxlRmFjdG9yKHRoaXMuR2V0Vmlld3BvcnRIZWlnaHQoKSkKICAgIH0KICAgIEdldERlZmF1bHRDYW1lcmFaKGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5HZXRSZW5kZXJlcigpLkdldERlZmF1bHRDYW1lcmFaKGEgfHwKICAgICAgICAgICAgdGhpcy5HZXRWaWV3cG9ydEhlaWdodCgpKQogICAgfQogICAgSXNMYXlvdXRGaXJzdFRpY2soKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2lzTGF5b3V0Rmlyc3RUaWNrCiAgICB9CiAgICBTZXRQaXhlbFJvdW5kaW5nRW5hYmxlZChhKSB7CiAgICAgICAgYSA9ICEhYTsKICAgICAgICB0aGlzLl9pc1BpeGVsUm91bmRpbmdFbmFibGVkICE9PSBhICYmICh0aGlzLl9pc1BpeGVsUm91bmRpbmdFbmFibGVkID0gYSwgdGhpcy5HZXRMYXlvdXRNYW5hZ2VyKCkuU2V0QWxsTGF5ZXJNVkNoYW5nZWQoKSwgdGhpcy5VcGRhdGVSZW5kZXIoKSkKICAgIH0KICAgIElzUGl4ZWxSb3VuZGluZ0VuYWJsZWQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2lzUGl4ZWxSb3VuZGluZ0VuYWJsZWQKICAgIH0KICAgIFNhdmVUb1Nsb3QoYSkgewogICAgICAgIHRoaXMuX3NhdmVUb1Nsb3ROYW1lID0gYQogICAgfQogICAgTG9hZEZyb21TbG90KGEpIHsKICAgICAgICB0aGlzLl9sb2FkRnJvbVNsb3ROYW1lID0gYQogICAgfQogICAgTG9hZEZyb21Kc29uU3RyaW5nKGEpIHsKICAgICAgICB0aGlzLl9sb2FkRnJvbUpzb24gPSBhCiAgICB9CiAgICBHZXRMYXN0U2F2ZUpzb25TdHJpbmcoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2xhc3RTYXZlSnNvbgogICAgfQogICAgX05lZWRzSGFuZGxlU2F2ZU9yTG9hZCgpIHsKICAgICAgICByZXR1cm4gISghdGhpcy5fc2F2ZVRvU2xvdE5hbWUgJiYKICAgICAgICAgICAgIXRoaXMuX2xvYWRGcm9tU2xvdE5hbWUgJiYgbnVsbCA9PT0gdGhpcy5fbG9hZEZyb21Kc29uKQogICAgfQogICAgYXN5bmMgX0hhbmRsZVNhdmVPckxvYWQoKSB7CiAgICAgICAgdGhpcy5fc2F2ZVRvU2xvdE5hbWUgJiYgKHRoaXMuRmx1c2hQZW5kaW5nSW5zdGFuY2VzKCksIGF3YWl0IHRoaXMuX0RvU2F2ZVRvU2xvdCh0aGlzLl9zYXZlVG9TbG90TmFtZSksIHRoaXMuX0NsZWFyU2F2ZU9yTG9hZCgpKTsKICAgICAgICB0aGlzLl9sb2FkRnJvbVNsb3ROYW1lICYmIChhd2FpdCB0aGlzLl9Eb0xvYWRGcm9tU2xvdCh0aGlzLl9sb2FkRnJvbVNsb3ROYW1lKSwgdGhpcy5fQ2xlYXJTYXZlT3JMb2FkKCksIHRoaXMuSXNEZWJ1ZygpICYmIEMzRGVidWdnZXIkanNjb21wJDMuU3RlcElmUGF1c2VkSW5EZWJ1Z2dlcigpKTsKICAgICAgICBpZiAobnVsbCAhPT0gdGhpcy5fbG9hZEZyb21Kc29uKSB7CiAgICAgICAgICAgIHRoaXMuRmx1c2hQZW5kaW5nSW5zdGFuY2VzKCk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLl9Eb0xvYWRGcm9tSnNvblN0cmluZyh0aGlzLl9sb2FkRnJvbUpzb24pLCB0aGlzLl9sYXN0U2F2ZUpzb24gPSB0aGlzLl9sb2FkRnJvbUpzb24sCiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5UcmlnZ2VyQXN5bmMoQzMkanNjb21wJDE3MC5QbHVnaW5zLlN5c3RlbS5DbmRzLk9uTG9hZENvbXBsZXRlLCBudWxsKSwgdGhpcy5fbGFzdFNhdmVKc29uID0gIiIKICAgICAgICAgICAgfSBjYXRjaCAoYSkgewogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcigiW0NvbnN0cnVjdF0gRmFpbGVkIHRvIGxvYWQgc3RhdGUgZnJvbSBKU09OIHN0cmluZzogIiwgYSksIGF3YWl0IHRoaXMuVHJpZ2dlckFzeW5jKEMzJGpzY29tcCQxNzAuUGx1Z2lucy5TeXN0ZW0uQ25kcy5PbkxvYWRGYWlsZWQsIG51bGwpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5fQ2xlYXJTYXZlT3JMb2FkKCkKICAgICAgICB9CiAgICB9CiAgICBfQ2xlYXJTYXZlT3JMb2FkKCkgewogICAgICAgIHRoaXMuX2xvYWRGcm9tU2xvdE5hbWUgPSB0aGlzLl9zYXZlVG9TbG90TmFtZSA9ICIiOwogICAgICAgIHRoaXMuX2xvYWRGcm9tSnNvbiA9IG51bGwKICAgIH0KICAgIF9HZXRQcm9qZWN0U3RvcmFnZSgpIHsKICAgICAgICB0aGlzLl9wcm9qZWN0U3RvcmFnZSB8fCAodGhpcy5fcHJvamVjdFN0b3JhZ2UgPSBsb2NhbGZvcmFnZS5jcmVhdGVJbnN0YW5jZSh7CiAgICAgICAgICAgIG5hbWU6ICJjMy1sb2NhbHN0b3JhZ2UtIiArIHRoaXMuR2V0UHJvamVjdFVuaXF1ZUlkKCksCiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiB0aGlzLkdldFByb2plY3ROYW1lKCkKICAgICAgICB9KSk7CiAgICAgICAgcmV0dXJuIHRoaXMuX3Byb2plY3RTdG9yYWdlCiAgICB9CiAgICBfR2V0U2F2ZWdhbWVzU3RvcmFnZSgpIHsKICAgICAgICB0aGlzLl9zYXZlZ2FtZXNTdG9yYWdlIHx8ICh0aGlzLl9zYXZlZ2FtZXNTdG9yYWdlID0gbG9jYWxmb3JhZ2UuY3JlYXRlSW5zdGFuY2UoewogICAgICAgICAgICBuYW1lOiAiYzMtc2F2ZWdhbWVzLSIgKyB0aGlzLkdldFByb2plY3RVbmlxdWVJZCgpLAogICAgICAgICAgICBkZXNjcmlwdGlvbjogdGhpcy5HZXRQcm9qZWN0TmFtZSgpCiAgICAgICAgfSkpOwogICAgICAgIHJldHVybiB0aGlzLl9zYXZlZ2FtZXNTdG9yYWdlCiAgICB9CiAgICBhc3luYyBfRG9TYXZlVG9TbG90KGEpIHsKICAgICAgICBjb25zdCBiID0gYXdhaXQgdGhpcy5fU2F2ZVRvSnNvblN0cmluZygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGF3YWl0IHRoaXMuX0dldFNhdmVnYW1lc1N0b3JhZ2UoKS5zZXRJdGVtKGEsIGIpLCBjb25zb2xlLmxvZygiW0NvbnN0cnVjdF0gU2F2ZWQgc3RhdGUgdG8gc3RvcmFnZSAoIiArIGIubGVuZ3RoICsgIiBjaGFycykiKSwgdGhpcy5fbGFzdFNhdmVKc29uID0gYiwgYXdhaXQgdGhpcy5UcmlnZ2VyQXN5bmMoQzMkanNjb21wJDE3MC5QbHVnaW5zLlN5c3RlbS5DbmRzLk9uU2F2ZUNvbXBsZXRlLAogICAgICAgICAgICAgICAgbnVsbCksIHRoaXMuX2xhc3RTYXZlSnNvbiA9ICIiCiAgICAgICAgfSBjYXRjaCAoZCkgewogICAgICAgICAgICBjb25zb2xlLmVycm9yKCJbQ29uc3RydWN0XSBGYWlsZWQgdG8gc2F2ZSBzdGF0ZSB0byBzdG9yYWdlOiAiLCBkKSwgYXdhaXQgdGhpcy5UcmlnZ2VyQXN5bmMoQzMkanNjb21wJDE3MC5QbHVnaW5zLlN5c3RlbS5DbmRzLk9uU2F2ZUZhaWxlZCwgbnVsbCkKICAgICAgICB9CiAgICB9CiAgICBhc3luYyBfRG9Mb2FkRnJvbVNsb3QoYSkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGNvbnN0IGIgPSBhd2FpdCB0aGlzLl9HZXRTYXZlZ2FtZXNTdG9yYWdlKCkuZ2V0SXRlbShhKTsKICAgICAgICAgICAgaWYgKCFiKSB0aHJvdyBFcnJvcigiZW1wdHkgc2xvdCIpOwogICAgICAgICAgICBjb25zb2xlLmxvZygiW0NvbnN0cnVjdF0gTG9hZGVkIHN0YXRlIGZyb20gc3RvcmFnZSAoIiArIGIubGVuZ3RoICsgIiBjaGFycykiKTsKICAgICAgICAgICAgYXdhaXQgdGhpcy5fRG9Mb2FkRnJvbUpzb25TdHJpbmcoYik7CiAgICAgICAgICAgIHRoaXMuX2xhc3RTYXZlSnNvbiA9IGI7CiAgICAgICAgICAgIGF3YWl0IHRoaXMuVHJpZ2dlckFzeW5jKEMzJGpzY29tcCQxNzAuUGx1Z2lucy5TeXN0ZW0uQ25kcy5PbkxvYWRDb21wbGV0ZSwgbnVsbCk7CiAgICAgICAgICAgIHRoaXMuX2xhc3RTYXZlSnNvbiA9ICIiCiAgICAgICAgfSBjYXRjaCAoYikgewogICAgICAgICAgICBjb25zb2xlLmVycm9yKCJbQ29uc3RydWN0XSBGYWlsZWQgdG8gbG9hZCBzdGF0ZSBmcm9tIHN0b3JhZ2U6ICIsIGIpLCBhd2FpdCB0aGlzLlRyaWdnZXJBc3luYyhDMyRqc2NvbXAkMTcwLlBsdWdpbnMuU3lzdGVtLkNuZHMuT25Mb2FkRmFpbGVkLCBudWxsKQogICAgICAgIH0KICAgIH0KICAgIGFzeW5jIF9TYXZlVG9Kc29uU3RyaW5nKCkgewogICAgICAgIGNvbnN0IGEgPSB7CiAgICAgICAgICAgIGMzc2F2ZTogITAsCiAgICAgICAgICAgIHZlcnNpb246IDEsCiAgICAgICAgICAgIHJ0OiB7CiAgICAgICAgICAgICAgICB0aW1lOiB0aGlzLkdldEdhbWVUaW1lKCksCiAgICAgICAgICAgICAgICB0aW1lUmF3OiB0aGlzLkdldEdhbWVUaW1lUmF3KCksCiAgICAgICAgICAgICAgICB3YWxsdGltZTogdGhpcy5HZXRXYWxsVGltZSgpLAogICAgICAgICAgICAgICAgdGltZXNjYWxlOiB0aGlzLkdldFRpbWVTY2FsZSgpLAogICAgICAgICAgICAgICAgdGlja2NvdW50OiB0aGlzLkdldFRpY2tDb3VudCgpLAogICAgICAgICAgICAgICAgbmV4dF91aWQ6IHRoaXMuX25leHRVaWQsCiAgICAgICAgICAgICAgICBydW5uaW5nX2xheW91dDogdGhpcy5HZXRNYWluUnVubmluZ0xheW91dCgpLkdldFNJRCgpLAogICAgICAgICAgICAgICAgc3RhcnRfdGltZV9vZmZzZXQ6IERhdGUubm93KCkgLSB0aGlzLl9zdGFydFRpbWUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgdHlwZXM6IHt9LAogICAgICAgICAgICBsYXlvdXRzOiB7fSwKICAgICAgICAgICAgZXZlbnRzOiB0aGlzLl9ldmVudFNoZWV0TWFuYWdlci5fU2F2ZVRvSnNvbigpLAogICAgICAgICAgICB0aW1lbGluZXM6IHRoaXMuX3RpbWVsaW5lTWFuYWdlci5fU2F2ZVRvSnNvbigpLAogICAgICAgICAgICB1c2VyX3NjcmlwdF9kYXRhOiBudWxsCiAgICAgICAgfTsKICAgICAgICBmb3IgKHZhciBiIG9mIHRoaXMuX2FsbE9iamVjdENsYXNzZXMpIGIuSXNGYW1pbHkoKSB8fCBiLkhhc05vU2F2ZUJlaGF2aW9yKCkgfHwgKGEudHlwZXNbYi5HZXRTSUQoKS50b1N0cmluZygpXSA9IGIuX1NhdmVUb0pzb24oKSk7CiAgICAgICAgZm9yIChjb25zdCBkIG9mIHRoaXMuX2xheW91dE1hbmFnZXIuR2V0QWxsTGF5b3V0cygpKSBhLmxheW91dHNbZC5HZXRTSUQoKS50b1N0cmluZygpXSA9IGQuX1NhdmVUb0pzb24oKTsKICAgICAgICBiID0gdGhpcy5fQ3JlYXRlVXNlclNjcmlwdEV2ZW50KCJzYXZlIik7CiAgICAgICAgYi5zYXZlRGF0YSA9IG51bGw7CiAgICAgICAgYXdhaXQgdGhpcy5EaXNwYXRjaFVzZXJTY3JpcHRFdmVudEFzeW5jV2FpdChiKTsKICAgICAgICBhLnVzZXJfc2NyaXB0X2RhdGEgPSBiLnNhdmVEYXRhOwogICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShhKQogICAgfQogICAgSXNMb2FkaW5nU3RhdGUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2lzTG9hZGluZ1N0YXRlCiAgICB9CiAgICBhc3luYyBfRG9Mb2FkRnJvbUpzb25TdHJpbmcoYSkgewogICAgICAgIHZhciBiID0KICAgICAgICAgICAgdGhpcy5HZXRMYXlvdXRNYW5hZ2VyKCk7CiAgICAgICAgYSA9IEpTT04ucGFyc2UoYSk7CiAgICAgICAgaWYgKGEuYzJzYXZlKSB0aHJvdyBFcnJvcigiQzIgc2F2ZXMgYXJlIGluY29tcGF0aWJsZSB3aXRoIEMzIHJ1bnRpbWUiKTsKICAgICAgICBpZiAoIWEuYzNzYXZlKSB0aHJvdyBFcnJvcigibm90IHZhbGlkIEMzIHNhdmUgZGF0YSIpOwogICAgICAgIGlmICgxIDwgYS52ZXJzaW9uKSB0aHJvdyBFcnJvcigiQzMgc2F2ZSBkYXRhIGZyb20gZnV0dXJlIHZlcnNpb24iKTsKICAgICAgICB0aGlzLl9kaXNwYXRjaGVyLmRpc3BhdGNoRXZlbnQoQzMkanNjb21wJDE3MC5OZXcoQzMkanNjb21wJDE3MC5FdmVudCwgImJlZm9yZWxvYWQiKSk7CiAgICAgICAgZm9yICh2YXIgZCBvZiB0aGlzLmFsbEluc3RhbmNlcygpKSBkLkdldE9iamVjdENsYXNzKCkuSGFzTm9TYXZlQmVoYXZpb3IoKSB8fCBkLl9PbkJlZm9yZUxvYWQoKTsKICAgICAgICBkID0gYS5ydDsKICAgICAgICB0aGlzLl9nYW1lVGltZS5TZXQoZC50aW1lKTsKICAgICAgICBkLmhhc093blByb3BlcnR5KCJ0aW1lUmF3IikgJiYgdGhpcy5fZ2FtZVRpbWVSYXcuU2V0KGQudGltZVJhdyk7CiAgICAgICAgdGhpcy5fd2FsbFRpbWUuU2V0KGQud2FsbHRpbWUpOwogICAgICAgIHRoaXMuX3RpbWVTY2FsZSA9IGQudGltZXNjYWxlOwogICAgICAgIHRoaXMuX3RpY2tDb3VudCA9IGQudGlja2NvdW50OwogICAgICAgIHRoaXMuX3N0YXJ0VGltZSA9IERhdGUubm93KCkgLSBkLnN0YXJ0X3RpbWVfb2Zmc2V0OwogICAgICAgIHZhciBjID0gZC5ydW5uaW5nX2xheW91dDsKICAgICAgICB0aGlzLl9pc0xvYWRpbmdTdGF0ZSA9ICEwOwogICAgICAgIHZhciBlID0gITE7CiAgICAgICAgaWYgKGMgIT09IHRoaXMuR2V0TWFpblJ1bm5pbmdMYXlvdXQoKS5HZXRTSUQoKSkKICAgICAgICAgICAgaWYgKGUgPSBiLkdldExheW91dEJ5U0lEKGMpKSBhd2FpdCB0aGlzLl9Eb0NoYW5nZUxheW91dChlKSwgZSA9ICEwOwogICAgICAgICAgICBlbHNlIHJldHVybjsKICAgICAgICBmb3IgKGNvbnN0IFtrLCBtXSBvZiBPYmplY3QuZW50cmllcyhhLnR5cGVzKSkgYyA9IHBhcnNlSW50KGssIDEwKSwgYyA9IHRoaXMuR2V0T2JqZWN0Q2xhc3NCeVNJRChjKSwgIWMgfHwgYy5Jc0ZhbWlseSgpIHx8IGMuSGFzTm9TYXZlQmVoYXZpb3IoKSB8fCBjLl9Mb2FkRnJvbUpzb24obSk7CiAgICAgICAgdGhpcy5GbHVzaFBlbmRpbmdJbnN0YW5jZXMoKTsKICAgICAgICB0aGlzLl9SZWZyZXNoVWlkTWFwKCk7CiAgICAgICAgdGhpcy5faXNMb2FkaW5nU3RhdGUgPSAhMTsKICAgICAgICBpZiAoZSkgewogICAgICAgICAgICBmb3IgKHZhciBnIG9mIHRoaXMuYWxsSW5zdGFuY2VzKCkpIGcuU2V0dXBJbml0aWFsU2NlbmVHcmFwaENvbm5lY3Rpb25zKCk7CiAgICAgICAgICAgIGZvciAoY29uc3QgW2ssIG1dIG9mIE9iamVjdC5lbnRyaWVzKGEudHlwZXMpKSBnID0gcGFyc2VJbnQoaywgMTApLCBnID0gdGhpcy5HZXRPYmplY3RDbGFzc0J5U0lEKGcpLCAhZyB8fCBnLklzRmFtaWx5KCkgfHwgZy5IYXNOb1NhdmVCZWhhdmlvcigpIHx8IGcuX1NldHVwU2NlbmVHcmFwaENvbm5lY3Rpb25zT25DaGFuZ2VPZkxheW91dChtKQogICAgICAgIH0KICAgICAgICB0aGlzLl9uZXh0VWlkID0gZC5uZXh0X3VpZDsKICAgICAgICBmb3IgKGNvbnN0IFtrLCBtXSBvZiBPYmplY3QuZW50cmllcyhhLmxheW91dHMpKSBkID0gcGFyc2VJbnQoaywgMTApLCAoZCA9IGIuR2V0TGF5b3V0QnlTSUQoZCkpICYmIGQuX0xvYWRGcm9tSnNvbihtKTsKICAgICAgICB0aGlzLl9ldmVudFNoZWV0TWFuYWdlci5fTG9hZEZyb21Kc29uKGEuZXZlbnRzKTsKICAgICAgICBmb3IgKGNvbnN0IGsgb2YgdGhpcy5fYWxsT2JqZWN0Q2xhc3NlcykKICAgICAgICAgICAgaWYgKCFrLklzRmFtaWx5KCkgJiYgay5Jc0luQ29udGFpbmVyKCkpCiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IG0gb2Ygay5HZXRJbnN0YW5jZXMoKSkgewogICAgICAgICAgICAgICAgICAgIGQgPSBtLkdldElJRCgpOwogICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgbiBvZiBrLkdldENvbnRhaW5lcigpLm9iamVjdFR5cGVzKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuICE9PQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZyA9IG4uR2V0SW5zdGFuY2VzKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoMCA+IGQgfHwgZCA+PSBnLmxlbmd0aCkgdGhyb3cgRXJyb3IoIm1pc3Npbmcgc2libGluZyBpbnN0YW5jZSIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbS5fQWRkU2libGluZyhnW2RdKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgdGhpcy5fdGltZWxpbmVNYW5hZ2VyLl9Mb2FkRnJvbUpzb24oYS50aW1lbGluZXMpOwogICAgICAgIGIuU2V0QWxsTGF5ZXJQcm9qZWN0aW9uQ2hhbmdlZCgpOwogICAgICAgIGIuU2V0QWxsTGF5ZXJNVkNoYW5nZWQoKTsKICAgICAgICB0aGlzLl9kaXNwYXRjaGVyLmRpc3BhdGNoRXZlbnQoQzMkanNjb21wJDE3MC5OZXcoQzMkanNjb21wJDE3MC5FdmVudCwgImFmdGVybG9hZCIpKTsKICAgICAgICBiID0gdGhpcy5fQ3JlYXRlVXNlclNjcmlwdEV2ZW50KCJsb2FkIik7CiAgICAgICAgYi5zYXZlRGF0YSA9IGEudXNlcl9zY3JpcHRfZGF0YTsKICAgICAgICBhd2FpdCB0aGlzLkRpc3BhdGNoVXNlclNjcmlwdEV2ZW50QXN5bmNXYWl0KGIpOwogICAgICAgIHRoaXMuVXBkYXRlUmVuZGVyKCkKICAgIH0KICAgIGFzeW5jIEFkZEpvYldvcmtlclNjcmlwdHMoYSkgewogICAgICAgIGEgPSBhd2FpdCBQcm9taXNlLmFsbChhLm1hcChhc3luYyBiID0+IHsKICAgICAgICAgICAgY29uc3QgZCA9CiAgICAgICAgICAgICAgICBDMyRqc2NvbXAkMTcwLklzQWJzb2x1dGVVUkwoYikgJiYgKG5ldyBVUkwoYikpLm9yaWdpbiAhPT0gbG9jYXRpb24ub3JpZ2luLAogICAgICAgICAgICAgICAgYyA9IHRoaXMuSXNDb3Jkb3ZhKCkgJiYgdGhpcy5fYXNzZXRNYW5hZ2VyLklzRmlsZVByb3RvY29sKCk7CiAgICAgICAgICAgIHJldHVybiBkIHx8IGMgfHwgdGhpcy5Jc1ByZXZpZXcoKSB8fCAicGxheWFibGUtYWQiID09PSB0aGlzLkdldEV4cG9ydFR5cGUoKSA/IChiID0gYXdhaXQgdGhpcy5fYXNzZXRNYW5hZ2VyLkZldGNoQmxvYihiKSwgVVJMLmNyZWF0ZU9iamVjdFVSTChiKSkgOiBDMyRqc2NvbXAkMTcwLklzUmVsYXRpdmVVUkwoYikgPyAobmV3IFVSTChiLCB0aGlzLl9ydW50aW1lQmFzZVVybCkpLnRvU3RyaW5nKCkgOiBiCiAgICAgICAgfSkpOwogICAgICAgIHRoaXMuX2pvYlNjaGVkdWxlci5JbXBvcnRTY3JpcHRzVG9Kb2JXb3JrZXJzKGEpCiAgICB9CiAgICBBZGRKb2JXb3JrZXJCbG9iKGEsIGIpIHsKICAgICAgICB0aGlzLl9qb2JTY2hlZHVsZXIuU2VuZEJsb2JUb0pvYldvcmtlcnMoYSwgYikKICAgIH0KICAgIEFkZEpvYldvcmtlckJ1ZmZlcihhLCBiKSB7CiAgICAgICAgdGhpcy5fam9iU2NoZWR1bGVyLlNlbmRCdWZmZXJUb0pvYldvcmtlcnMoYSwKICAgICAgICAgICAgYikKICAgIH0KICAgIEFkZEpvYihhLCBiLCBkKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2pvYlNjaGVkdWxlci5BZGRKb2IoYSwgYiwgZCkKICAgIH0KICAgIEJyb2FkY2FzdEpvYihhLCBiLCBkKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2pvYlNjaGVkdWxlci5Ccm9hZGNhc3RKb2IoYSwgYiwgZCkKICAgIH0KICAgIEludm9rZURvd25sb2FkKGEsIGIpIHsKICAgICAgICB0aGlzLlBvc3RDb21wb25lbnRNZXNzYWdlVG9ET00oInJ1bnRpbWUiLCAiaW52b2tlLWRvd25sb2FkIiwgewogICAgICAgICAgICB1cmw6IGEsCiAgICAgICAgICAgIGZpbGVuYW1lOiBiCiAgICAgICAgfSkKICAgIH0KICAgIGFzeW5jIFJhc3RlclN2Z0ltYWdlKGEsIGIsIGQsIGMsIGUsIGcpIHsKICAgICAgICBjID0gYyB8fCBiOwogICAgICAgIGUgPSBlIHx8IGQ7CiAgICAgICAgaWYgKHRoaXMuSXNJbldvcmtlcigpKSByZXR1cm4gKGF3YWl0IHRoaXMuUG9zdENvbXBvbmVudE1lc3NhZ2VUb0RPTUFzeW5jKCJydW50aW1lIiwgInJhc3Rlci1zdmctaW1hZ2UiLCB7CiAgICAgICAgICAgIGJsb2I6IGEsCiAgICAgICAgICAgIGltYWdlV2lkdGg6IGIsCiAgICAgICAgICAgIGltYWdlSGVpZ2h0OiBkLAogICAgICAgICAgICBzdXJmYWNlV2lkdGg6IGMsCiAgICAgICAgICAgIHN1cmZhY2VIZWlnaHQ6IGUsCiAgICAgICAgICAgIGltYWdlQml0bWFwT3B0czogZwogICAgICAgIH0pKS5pbWFnZUJpdG1hcDsKICAgICAgICBhID0gYXdhaXQgc2VsZi5DM19SYXN0ZXJTdmdJbWFnZUJsb2IoYSwKICAgICAgICAgICAgYiwgZCwgYywgZSk7CiAgICAgICAgcmV0dXJuIGcgPyBhd2FpdCBzZWxmLmNyZWF0ZUltYWdlQml0bWFwKGEsIGcpIDogYQogICAgfQogICAgYXN5bmMgR2V0U3ZnSW1hZ2VTaXplKGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5Jc0luV29ya2VyKCkgPyBhd2FpdCB0aGlzLlBvc3RDb21wb25lbnRNZXNzYWdlVG9ET01Bc3luYygicnVudGltZSIsICJnZXQtc3ZnLWltYWdlLXNpemUiLCB7CiAgICAgICAgICAgIGJsb2I6IGEKICAgICAgICB9KSA6IGF3YWl0IHNlbGYuQzNfR2V0U3ZnSW1hZ2VTaXplKGEpCiAgICB9CiAgICBSZXF1ZXN0RGV2aWNlT3JpZW50YXRpb25FdmVudCgpIHsKICAgICAgICB0aGlzLl9kaWRSZXF1ZXN0RGV2aWNlT3JpZW50YXRpb25FdmVudCB8fCAodGhpcy5fZGlkUmVxdWVzdERldmljZU9yaWVudGF0aW9uRXZlbnQgPSAhMCwgdGhpcy5Qb3N0Q29tcG9uZW50TWVzc2FnZVRvRE9NKCJydW50aW1lIiwgImVuYWJsZS1kZXZpY2Utb3JpZW50YXRpb24iKSkKICAgIH0KICAgIFJlcXVlc3REZXZpY2VNb3Rpb25FdmVudCgpIHsKICAgICAgICB0aGlzLl9kaWRSZXF1ZXN0RGV2aWNlTW90aW9uRXZlbnQgfHwgKHRoaXMuX2RpZFJlcXVlc3REZXZpY2VNb3Rpb25FdmVudCA9ICEwLCB0aGlzLlBvc3RDb21wb25lbnRNZXNzYWdlVG9ET00oInJ1bnRpbWUiLCAiZW5hYmxlLWRldmljZS1tb3Rpb24iKSkKICAgIH0KICAgIFJhbmRvbSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcmFuZG9tTnVtYmVyQ2FsbGJhY2soKQogICAgfQogICAgU2V0UmFuZG9tTnVtYmVyR2VuZXJhdG9yQ2FsbGJhY2soYSkgewogICAgICAgIHRoaXMuX3JhbmRvbU51bWJlckNhbGxiYWNrID0gYQogICAgfQogICAgX0dldFJlbW90ZVByZXZpZXdTdGF0dXNJbmZvKCkgewogICAgICAgIGNvbnN0IGEgPSB0aGlzLkdldFdlYkdMUmVuZGVyZXIoKTsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBmcHM6IHRoaXMuR2V0RlBTKCksCiAgICAgICAgICAgIGNwdTogdGhpcy5HZXRNYWluVGhyZWFkVGltZSgpLAogICAgICAgICAgICBncHU6IHRoaXMuR2V0R1BVVXRpbGlzYXRpb24oKSwKICAgICAgICAgICAgbGF5b3V0OiB0aGlzLkdldE1haW5SdW5uaW5nTGF5b3V0KCkgPyB0aGlzLkdldE1haW5SdW5uaW5nTGF5b3V0KCkuR2V0TmFtZSgpIDogIiIsCiAgICAgICAgICAgIHJlbmRlcmVyOiBhID8gYS5HZXRVbm1hc2tlZFJlbmRlcmVyKCkgOiAiPHVuYXZhaWxhYmxlPiIKICAgICAgICB9CiAgICB9CiAgICBIaXRCcmVha3BvaW50KCkgewogICAgICAgIHJldHVybiB0aGlzLklzRGVidWcoKSA/IEMzRGVidWdnZXIkanNjb21wJDMuSGl0QnJlYWtwb2ludCgpIDoKICAgICAgICAgICAgITEKICAgIH0KICAgIERlYnVnQnJlYWsoYSkgewogICAgICAgIHJldHVybiB0aGlzLklzRGVidWdnaW5nKCkgPyBDM0RlYnVnZ2VyJGpzY29tcCQzLkRlYnVnQnJlYWsoYSkgOiBQcm9taXNlLnJlc29sdmUoKQogICAgfQogICAgRGVidWdCcmVha05leHQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuSXNEZWJ1Z2dpbmcoKSA/IEMzRGVidWdnZXIkanNjb21wJDMuQnJlYWtOZXh0KCkgOiAhMQogICAgfQogICAgU2V0RGVidWdCcmVha3BvaW50c0VuYWJsZWQoYSkgewogICAgICAgIHRoaXMuX2JyZWFrcG9pbnRzRW5hYmxlZCA9ICEhYTsKICAgICAgICB0aGlzLl9VcGRhdGVEZWJ1Z2dpbmdGbGFnKCkKICAgIH0KICAgIEFyZURlYnVnQnJlYWtwb2ludHNFbmFibGVkKCkgewogICAgICAgIHJldHVybiB0aGlzLl9icmVha3BvaW50c0VuYWJsZWQKICAgIH0KICAgIElzRGVidWdnaW5nKCkgewogICAgICAgIHJldHVybiB0aGlzLl9pc0RlYnVnZ2luZwogICAgfQogICAgU2V0RGVidWdnaW5nRW5hYmxlZChhKSB7CiAgICAgICAgYSA/IHRoaXMuX2RlYnVnZ2luZ0Rpc2FibGVkLS0gOiB0aGlzLl9kZWJ1Z2dpbmdEaXNhYmxlZCsrOwogICAgICAgIHRoaXMuX1VwZGF0ZURlYnVnZ2luZ0ZsYWcoKQogICAgfQogICAgX1VwZGF0ZURlYnVnZ2luZ0ZsYWcoKSB7CiAgICAgICAgdGhpcy5faXNEZWJ1Z2dpbmcgPQogICAgICAgICAgICB0aGlzLklzRGVidWcoKSAmJiB0aGlzLl9icmVha3BvaW50c0VuYWJsZWQgJiYgMCA9PT0gdGhpcy5fZGVidWdnaW5nRGlzYWJsZWQKICAgIH0KICAgIElzQ1BVUHJvZmlsaW5nKCkgewogICAgICAgIHJldHVybiB0aGlzLklzRGVidWcoKSAmJiBDM0RlYnVnZ2VyJGpzY29tcCQzLklzQ1BVUHJvZmlsaW5nKCkKICAgIH0KICAgIElzR1BVUHJvZmlsaW5nKCkgewogICAgICAgIHJldHVybiB0aGlzLklzRGVidWcoKSAmJiB0aGlzLkdldFJlbmRlcmVyKCkuU3VwcG9ydHNHUFVQcm9maWxpbmcoKSAmJiBDM0RlYnVnZ2VyJGpzY29tcCQzLklzR1BVUHJvZmlsaW5nKCkKICAgIH0KICAgIGFzeW5jIERlYnVnSXRlcmF0ZUFuZEJyZWFrKGEpIHsKICAgICAgICBpZiAoYSkKICAgICAgICAgICAgZm9yIChjb25zdCBiIG9mIGEpIGF3YWl0IHRoaXMuRGVidWdCcmVhayhiKQogICAgfQogICAgRGVidWdGaXJlR2VuZXJhdG9yRXZlbnRBbmRCcmVhayhhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuRGVidWdJdGVyYXRlQW5kQnJlYWsodGhpcy5fZGlzcGF0Y2hlci5kaXNwYXRjaEdlbmVyYXRvckV2ZW50KGEpKQogICAgfQogICAgX0ludm9rZUZ1bmN0aW9uRnJvbUpTKGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZXZlbnRTaGVldE1hbmFnZXIuX0ludm9rZUZ1bmN0aW9uRnJvbUpTKGEubmFtZSwKICAgICAgICAgICAgYS5wYXJhbXMpCiAgICB9CiAgICBHZXRJUnVudGltZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5faVJ1bnRpbWUKICAgIH0KICAgIF9DcmVhdGVVc2VyU2NyaXB0RXZlbnQoYSkgewogICAgICAgIGEgPSBDMyRqc2NvbXAkMTcwLk5ldyhDMyRqc2NvbXAkMTcwLkV2ZW50LCBhLCAhMSk7CiAgICAgICAgYS5ydW50aW1lID0gdGhpcy5faVJ1bnRpbWU7CiAgICAgICAgcmV0dXJuIGEKICAgIH0KICAgIF9Jbml0U2NyaXB0SW50ZXJmYWNlcygpIHsKICAgICAgICB2YXIgYSA9IHt9OwogICAgICAgIGZvciAoY29uc3QgYiBvZiB0aGlzLl9hbGxPYmplY3RDbGFzc2VzKSBhW2IuR2V0SnNQcm9wTmFtZSgpXSA9IHsKICAgICAgICAgICAgdmFsdWU6IGIuR2V0SU9iamVjdENsYXNzKCksCiAgICAgICAgICAgIGVudW1lcmFibGU6ICEwLAogICAgICAgICAgICB3cml0YWJsZTogITEKICAgICAgICB9OwogICAgICAgIGEgPSBPYmplY3QuY3JlYXRlKE9iamVjdC5wcm90b3R5cGUsIGEpOwogICAgICAgIHRoaXMuX2lSdW50aW1lID0gbmV3IHNlbGYuSVJ1bnRpbWUodGhpcywgYSk7CiAgICAgICAgdGhpcy5fdXNlclNjcmlwdEV2ZW50T2JqZWN0cyA9IHsKICAgICAgICAgICAgdGljazogdGhpcy5fQ3JlYXRlVXNlclNjcmlwdEV2ZW50KCJ0aWNrIikKICAgICAgICB9CiAgICB9CiAgICBfSW5pdEdsb2JhbFZhcmlhYmxlU2NyaXB0SW50ZXJmYWNlKCkgewogICAgICAgIGNvbnN0IGEgPSB7fTsKICAgICAgICBmb3IgKGNvbnN0IGIgb2YgdGhpcy5HZXRFdmVudFNoZWV0TWFuYWdlcigpLkdldEFsbEdsb2JhbFZhcmlhYmxlcygpKSBhW2IuR2V0SnNQcm9wTmFtZSgpXSA9CiAgICAgICAgICAgIGIuX0dldFNjcmlwdEludGVyZmFjZURlc2NyaXB0b3IoKTsKICAgICAgICB0aGlzLl9pUnVudGltZS5fSW5pdEdsb2JhbFZhcnMoYSkKICAgIH0KICAgIF9HZXRDb21tb25TY3JpcHRJbnRlcmZhY2VzKCkgewogICAgICAgIHJldHVybiB0aGlzLl9jb21tb25TY3JpcHRJbnRlcmZhY2VzCiAgICB9CiAgICBfTWFwU2NyaXB0SW50ZXJmYWNlKGEsIGIpIHsKICAgICAgICB0aGlzLl9pbnRlcmZhY2VNYXAuc2V0KGEsIGIpCiAgICB9CiAgICBfVW53cmFwU2NyaXB0SW50ZXJmYWNlKGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5faW50ZXJmYWNlTWFwLmdldChhKQogICAgfQogICAgX1Vud3JhcElPYmplY3RDbGFzcyhhKSB7CiAgICAgICAgaWYgKCEoYSBpbnN0YW5jZW9mIHNlbGYuSU9iamVjdENsYXNzKSkgdGhyb3cgbmV3IFR5cGVFcnJvcigiZXhwZWN0ZWQgSU9iamVjdENsYXNzIik7CiAgICAgICAgYSA9IHRoaXMuX1Vud3JhcFNjcmlwdEludGVyZmFjZShhKTsKICAgICAgICBpZiAoIShhICYmIGEgaW5zdGFuY2VvZiBDMyRqc2NvbXAkMTcwLk9iamVjdENsYXNzKSkgdGhyb3cgRXJyb3IoImludmFsaWQgSU9iamVjdENsYXNzIik7CiAgICAgICAgcmV0dXJuIGEKICAgIH0KICAgIF9VbndyYXBJV29ybGRJbnN0YW5jZShhKSB7CiAgICAgICAgaWYgKCEoYSBpbnN0YW5jZW9mIHNlbGYuSVdvcmxkSW5zdGFuY2UpKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJleHBlY3RlZCBJV29ybGRJbnN0YW5jZSIpOwogICAgICAgIGEgPSB0aGlzLl9VbndyYXBTY3JpcHRJbnRlcmZhY2UoYSk7CiAgICAgICAgaWYgKCEoYSAmJiBhIGluc3RhbmNlb2YgQzMkanNjb21wJDE3MC5JbnN0YW5jZSkpIHRocm93IEVycm9yKCJpbnZhbGlkIElJbnN0YW5jZSIpOwogICAgICAgIHJldHVybiBhCiAgICB9Cn07CnNlbGYuQzNfQ3JlYXRlUnVudGltZSA9IEMzJGpzY29tcCQxNzAuUnVudGltZS5DcmVhdGU7CnNlbGYuQzNfSW5pdFJ1bnRpbWUgPSAoYSwgYikgPT4gYS5Jbml0KGIpOwoidXNlIHN0cmljdCI7CmNvbnN0IEMzJGpzY29tcCQxNzEgPSBzZWxmLkMzOwpDMyRqc2NvbXAkMTcxLkpvYlNjaGVkdWxlclJ1bnRpbWUgPSBjbGFzcyBleHRlbmRzIEMzJGpzY29tcCQxNzEuRGVmZW5kZWRCYXNlIHsKICAgIGNvbnN0cnVjdG9yKGEsIGIpIHsKICAgICAgICBzdXBlcigpOwogICAgICAgIHRoaXMuX3J1bnRpbWUgPSBhOwogICAgICAgIHRoaXMuX2pvYlByb21pc2VzID0gbmV3IE1hcDsKICAgICAgICB0aGlzLl9uZXh0Sm9iSWQgPSAwOwogICAgICAgIHRoaXMuX2lucHV0UG9ydCA9IGIuaW5wdXRQb3J0OwogICAgICAgIGIub3V0cHV0UG9ydC5vbm1lc3NhZ2UgPSBkID0+IHRoaXMuX09uSm9iV29ya2VyTWVzc2FnZShkKTsKICAgICAgICB0aGlzLl9tYXhOdW1Xb3JrZXJzID0gYi5tYXhOdW1Xb3JrZXJzOwogICAgICAgIHRoaXMuX2pvYldvcmtlckNvdW50ID0gMTsKICAgICAgICB0aGlzLl9oYWRFcnJvckNyZWF0aW5nV29ya2VyID0gdGhpcy5faXNDcmVhdGluZ1dvcmtlciA9ICExCiAgICB9CiAgICBhc3luYyBJbml0KCkge30KICAgIEltcG9ydFNjcmlwdHNUb0pvYldvcmtlcnMoYSkgewogICAgICAgIHRoaXMuX2lucHV0UG9ydC5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgIHR5cGU6ICJfaW1wb3J0X3NjcmlwdHMiLAogICAgICAgICAgICBzY3JpcHRzOiBhCiAgICAgICAgfSkKICAgIH0KICAgIFNlbmRCbG9iVG9Kb2JXb3JrZXJzKGEsIGIpIHsKICAgICAgICB0aGlzLl9pbnB1dFBvcnQucG9zdE1lc3NhZ2UoewogICAgICAgICAgICB0eXBlOiAiX3NlbmRfYmxvYiIsCiAgICAgICAgICAgIGJsb2I6IGEsCiAgICAgICAgICAgIGlkOiBiCiAgICAgICAgfSkKICAgIH0KICAgIFNlbmRCdWZmZXJUb0pvYldvcmtlcnMoYSwgYikgewogICAgICAgIHRoaXMuX2lucHV0UG9ydC5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgIHR5cGU6ICJfc2VuZF9idWZmZXIiLAogICAgICAgICAgICBidWZmZXI6IGEsCiAgICAgICAgICAgIGlkOiBiCiAgICAgICAgfSwgW2FdKQogICAgfQogICAgQWRkSm9iKGEsIGIsIGQsIGMsIGUpIHsKICAgICAgICBkIHx8IChkID0gW10pOwogICAgICAgIGNvbnN0IGcgPSB0aGlzLl9uZXh0Sm9iSWQrKzsKICAgICAgICBhID0gewogICAgICAgICAgICB0eXBlOiBhLAogICAgICAgICAgICBpc0Jyb2FkY2FzdDogITEsCiAgICAgICAgICAgIGpvYklkOiBnLAogICAgICAgICAgICBwYXJhbXM6IGIsCiAgICAgICAgICAgIHRyYW5zZmVyYWJsZXM6IGQKICAgICAgICB9OwogICAgICAgIGIgPSBuZXcgUHJvbWlzZSgoaywgbSkgPT4gewogICAgICAgICAgICB0aGlzLl9qb2JQcm9taXNlcy5zZXQoZywgewogICAgICAgICAgICAgICAgcmVzb2x2ZTogaywKICAgICAgICAgICAgICAgIHByb2dyZXNzOiBjLAogICAgICAgICAgICAgICAgcmVqZWN0OiBtLAogICAgICAgICAgICAgICAgY2FuY2VsbGVkOiAhMQogICAgICAgICAgICB9KQogICAgICAgIH0pOwogICAgICAgIGUgJiYgZS5TZXRBY3Rpb24oKCkgPT4gdGhpcy5fQ2FuY2VsSm9iKGcpKTsKICAgICAgICB0aGlzLl9pbnB1dFBvcnQucG9zdE1lc3NhZ2UoYSwgZCk7CiAgICAgICAgdGhpcy5fTWF5YmVDcmVhdGVFeHRyYVdvcmtlcigpOwogICAgICAgIHJldHVybiBiCiAgICB9CiAgICBCcm9hZGNhc3RKb2IoYSwgYiwgZCkgewogICAgICAgIGQgfHwgKGQgPSBbXSk7CiAgICAgICAgY29uc3QgYyA9IHRoaXMuX25leHRKb2JJZCsrOwogICAgICAgIHRoaXMuX2lucHV0UG9ydC5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgIHR5cGU6IGEsCiAgICAgICAgICAgIGlzQnJvYWRjYXN0OiAhMCwKICAgICAgICAgICAgam9iSWQ6IGMsCiAgICAgICAgICAgIHBhcmFtczogYiwKICAgICAgICAgICAgdHJhbnNmZXJhYmxlczogZAogICAgICAgIH0sIGQpCiAgICB9CiAgICBfQ2FuY2VsSm9iKGEpIHsKICAgICAgICBjb25zdCBiID0gdGhpcy5fam9iUHJvbWlzZXMuZ2V0KGEpOwogICAgICAgIGIgJiYgKGIuY2FuY2VsbGVkID0gITAsIGIucmVzb2x2ZSA9IG51bGwsIGIucHJvZ3Jlc3MgPSBudWxsLCBiLnJlamVjdCA9IG51bGwsIHRoaXMuX2lucHV0UG9ydC5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgIHR5cGU6ICJfY2FuY2VsIiwKICAgICAgICAgICAgam9iSWQ6IGEKICAgICAgICB9KSkKICAgIH0KICAgIF9PbkpvYldvcmtlck1lc3NhZ2UoYSkgewogICAgICAgIGEgPSBhLmRhdGE7CiAgICAgICAgY29uc3QgYiA9IGEudHlwZSwKICAgICAgICAgICAgZCA9IGEuam9iSWQ7CiAgICAgICAgc3dpdGNoIChiKSB7CiAgICAgICAgICAgIGNhc2UgInJlc3VsdCI6CiAgICAgICAgICAgICAgICB0aGlzLl9PbkpvYlJlc3VsdChkLCBhLnJlc3VsdCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAicHJvZ3Jlc3MiOgogICAgICAgICAgICAgICAgdGhpcy5fT25Kb2JQcm9ncmVzcyhkLCBhLnByb2dyZXNzKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICJlcnJvciI6CiAgICAgICAgICAgICAgICB0aGlzLl9PbkpvYkVycm9yKGQsIGEuZXJyb3IpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgInJlYWR5IjoKICAgICAgICAgICAgICAgIHRoaXMuX09uSm9iV29ya2VyUmVhZHkoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgdGhyb3cgRXJyb3IoYHVua25vd24gbWVzc2FnZSBmcm9tIHdvcmtlciAnJHtifSdgKTsKICAgICAgICB9CiAgICB9CiAgICBfT25Kb2JSZXN1bHQoYSwgYikgewogICAgICAgIGNvbnN0IGQgPSB0aGlzLl9qb2JQcm9taXNlcy5nZXQoYSk7CiAgICAgICAgaWYgKCFkKSB0aHJvdyBFcnJvcigiaW52YWxpZCBqb2IgSUQiKTsKICAgICAgICBkLmNhbmNlbGxlZCB8fCBkLnJlc29sdmUoYik7CiAgICAgICAgdGhpcy5fam9iUHJvbWlzZXMuZGVsZXRlKGEpCiAgICB9CiAgICBfT25Kb2JQcm9ncmVzcyhhLCBiKSB7CiAgICAgICAgYSA9IHRoaXMuX2pvYlByb21pc2VzLmdldChhKTsKICAgICAgICBpZiAoIWEpIHRocm93IEVycm9yKCJpbnZhbGlkIGpvYiBJRCIpOwogICAgICAgICFhLmNhbmNlbGxlZCAmJiBhLnByb2dyZXNzICYmIGEucHJvZ3Jlc3MoYikKICAgIH0KICAgIF9PbkpvYkVycm9yKGEsIGIpIHsKICAgICAgICBjb25zdCBkID0gdGhpcy5fam9iUHJvbWlzZXMuZ2V0KGEpOwogICAgICAgIGlmICghZCkgdGhyb3cgRXJyb3IoImludmFsaWQgam9iIElEIik7CiAgICAgICAgZC5jYW5jZWxsZWQgfHwgZC5yZWplY3QoYik7CiAgICAgICAgdGhpcy5fam9iUHJvbWlzZXMuZGVsZXRlKGEpCiAgICB9CiAgICBfT25Kb2JXb3JrZXJSZWFkeSgpIHsKICAgICAgICB0aGlzLl9pc0NyZWF0aW5nV29ya2VyICYmICh0aGlzLl9pc0NyZWF0aW5nV29ya2VyID0gITEsIHRoaXMuX2pvYldvcmtlckNvdW50KyssIHRoaXMuX2pvYldvcmtlckNvdW50IDwKICAgICAgICAgICAgdGhpcy5fbWF4TnVtV29ya2VycyA/IHRoaXMuX01heWJlQ3JlYXRlRXh0cmFXb3JrZXIoKSA6IHRoaXMuX2lucHV0UG9ydC5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgICAgICB0eXBlOiAiX25vX21vcmVfd29ya2VycyIKICAgICAgICAgICAgfSkpCiAgICB9CiAgICBhc3luYyBfTWF5YmVDcmVhdGVFeHRyYVdvcmtlcigpIHsKICAgICAgICBpZiAoISh0aGlzLl9qb2JXb3JrZXJDb3VudCA+PSB0aGlzLl9tYXhOdW1Xb3JrZXJzIHx8IHRoaXMuX2lzQ3JlYXRpbmdXb3JrZXIgfHwgdGhpcy5faGFkRXJyb3JDcmVhdGluZ1dvcmtlciB8fCB0aGlzLl9qb2JQcm9taXNlcy5zaXplIDw9IHRoaXMuX2pvYldvcmtlckNvdW50KSkgdHJ5IHsKICAgICAgICAgICAgdGhpcy5faXNDcmVhdGluZ1dvcmtlciA9ICEwLCAoYXdhaXQgdGhpcy5fcnVudGltZS5Qb3N0Q29tcG9uZW50TWVzc2FnZVRvRE9NQXN5bmMoInJ1bnRpbWUiLCAiY3JlYXRlLWpvYi13b3JrZXIiKSkub3V0cHV0UG9ydC5vbm1lc3NhZ2UgPSBhID0+IHRoaXMuX09uSm9iV29ya2VyTWVzc2FnZShhKQogICAgICAgIH0gY2F0Y2ggKGEpIHsKICAgICAgICAgICAgdGhpcy5faGFkRXJyb3JDcmVhdGluZ1dvcmtlciA9ICEwLCB0aGlzLl9pc0NyZWF0aW5nV29ya2VyID0gITEsIGNvbnNvbGUuZXJyb3IoYFtDb25zdHJ1Y3RdIEZhaWxlZCB0byBjcmVhdGUgam9iIHdvcmtlcjsgc3RvcHBpbmcgY3JlYXRpbmcgYW55IG1vcmUgKGNyZWF0ZWQgJHt0aGlzLl9qb2JXb3JrZXJDb3VudH0gc28gZmFyKWAsIGEpCiAgICAgICAgfQogICAgfQp9OwpzZWxmLkMzX1NoYWRlcnMgPSB7fTsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkMTcyID0gc2VsZi5DMzsKbGV0IGNhY2hlUmVnZXggPSBudWxsLAogICAgbGFzdFJlZ2V4ID0gIiIsCiAgICBsYXN0RmxhZ3MgPSAiIiwKICAgIHJlZ2V4TWF0Y2hlcyA9IFtdLAogICAgbGFzdE1hdGNoZXNTdHIgPSAiIiwKICAgIGxhc3RNYXRjaGVzUmVnZXggPSAiIiwKICAgIGxhc3RNYXRjaGVzRmxhZ3MgPSAiIjsKY29uc3QgZm9yRWFjaFN0YWNrID0gQzMkanNjb21wJDE3Mi5OZXcoQzMkanNjb21wJDE3Mi5BcnJheVN0YWNrKTsKCmZ1bmN0aW9uIEZvckVhY2hPcmRlcmVkX1NvcnRJbnN0YW5jZXMoYSwgYikgewogICAgYSA9IGFbMV07CiAgICBiID0gYlsxXTsKICAgIGlmICgibnVtYmVyIiA9PT0gdHlwZW9mIGEgJiYgIm51bWJlciIgPT09IHR5cGVvZiBiKSByZXR1cm4gYSAtIGI7CiAgICBhID0gIiIgKyBhOwogICAgYiA9ICIiICsgYjsKICAgIHJldHVybiBhIDwgYiA/IC0xIDogYSA+IGIgPyAxIDogMAp9CkMzJGpzY29tcCQxNzIuUGx1Z2lucy5TeXN0ZW0gPSBjbGFzcyBleHRlbmRzIEMzJGpzY29tcCQxNzIuU0RLUGx1Z2luQmFzZSB7CiAgICBjb25zdHJ1Y3RvcihhKSB7CiAgICAgICAgc3VwZXIoYSk7CiAgICAgICAgdGhpcy5fbG9vcFN0YWNrID0gdGhpcy5fcnVudGltZS5HZXRFdmVudFNoZWV0TWFuYWdlcigpLkdldExvb3BTdGFjaygpOwogICAgICAgIHRoaXMuX2V2ZW50U3RhY2sgPSB0aGlzLl9ydW50aW1lLkdldEV2ZW50U2hlZXRNYW5hZ2VyKCkuR2V0RXZlbnRTdGFjaygpOwogICAgICAgIHRoaXMuX2ltYWdlc0xvYWRpbmdDb21wbGV0ZSA9IHRoaXMuX2ltYWdlc0xvYWRpbmdUb3RhbCA9IDA7CiAgICAgICAgdGhpcy5fZnVuY3Rpb25NYXBzID0gbmV3IE1hcAogICAgfQogICAgUmVsZWFzZSgpIHsKICAgICAgICBzdXBlci5SZWxlYXNlKCkKICAgIH0KICAgIFVwZGF0ZVJlbmRlcigpIHsKICAgICAgICB0aGlzLl9ydW50aW1lLlVwZGF0ZVJlbmRlcigpCiAgICB9CiAgICBUcmlnZ2VyKGEpIHsKICAgICAgICB0aGlzLl9ydW50aW1lLlRyaWdnZXIoYSwgbnVsbCwgbnVsbCkKICAgIH0KICAgIEdldFJlZ2V4KGEsIGIpIHsKICAgICAgICBjYWNoZVJlZ2V4ICYmIGEgPT09IGxhc3RSZWdleCAmJiBiID09PSBsYXN0RmxhZ3MgfHwgKGNhY2hlUmVnZXggPSBuZXcgUmVnRXhwKGEsCiAgICAgICAgICAgIGIpLCBsYXN0UmVnZXggPSBhLCBsYXN0RmxhZ3MgPSBiKTsKICAgICAgICBjYWNoZVJlZ2V4Lmxhc3RJbmRleCA9IDA7CiAgICAgICAgcmV0dXJuIGNhY2hlUmVnZXgKICAgIH0KICAgIEdldFJlZ2V4TWF0Y2hlcyhhLCBiLCBkKSB7CiAgICAgICAgaWYgKGEgPT09IGxhc3RNYXRjaGVzU3RyICYmIGIgPT09IGxhc3RNYXRjaGVzUmVnZXggJiYgZCA9PT0gbGFzdE1hdGNoZXNGbGFncykgcmV0dXJuIHJlZ2V4TWF0Y2hlczsKICAgICAgICBjb25zdCBjID0gdGhpcy5HZXRSZWdleChiLCBkKTsKICAgICAgICByZWdleE1hdGNoZXMgPSBhLm1hdGNoKGMpOwogICAgICAgIGxhc3RNYXRjaGVzU3RyID0gYTsKICAgICAgICBsYXN0TWF0Y2hlc1JlZ2V4ID0gYjsKICAgICAgICBsYXN0TWF0Y2hlc0ZsYWdzID0gZDsKICAgICAgICByZXR1cm4gcmVnZXhNYXRjaGVzCiAgICB9CiAgICBhc3luYyBfTG9hZFRleHR1cmVzRm9yT2JqZWN0Q2xhc3NlcyhhLCBiKSB7CiAgICAgICAgaWYgKGIubGVuZ3RoKSB7CiAgICAgICAgICAgIHRoaXMuX2ltYWdlc0xvYWRpbmdUb3RhbCArPSBiLmxlbmd0aDsKICAgICAgICAgICAgdmFyIGQgPSBbXTsKICAgICAgICAgICAgZm9yIChjb25zdCBjIG9mIGIpIGQucHVzaChhLk1heWJlTG9hZFRleHR1cmVzRm9yKGMpKTsKICAgICAgICAgICAgYXdhaXQgQzMkanNjb21wJDE3Mi5Qcm9taXNlQWxsV2l0aFByb2dyZXNzKGQsICgpID0+IHsKICAgICAgICAgICAgICAgIHRoaXMuX2ltYWdlc0xvYWRpbmdDb21wbGV0ZSsrCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0aGlzLl9pbWFnZXNMb2FkaW5nQ29tcGxldGUrKzsKICAgICAgICAgICAgdGhpcy5faW1hZ2VzTG9hZGluZ0NvbXBsZXRlID09PSB0aGlzLl9pbWFnZXNMb2FkaW5nVG90YWwgJiYgKHRoaXMuX2ltYWdlc0xvYWRpbmdUb3RhbCA9IHRoaXMuX2ltYWdlc0xvYWRpbmdDb21wbGV0ZSA9IDAsIHRoaXMuX3J1bnRpbWUuVHJpZ2dlcihDMyRqc2NvbXAkMTcyLlBsdWdpbnMuU3lzdGVtLkNuZHMuT25JbWFnZUxvYWRpbmdDb21wbGV0ZSwgbnVsbCwgbnVsbCkpCiAgICAgICAgfQogICAgfQogICAgX1VubG9hZFRleHR1cmVzRm9yT2JqZWN0Q2xhc3NlcyhhLCBiKSB7CiAgICAgICAgZm9yIChjb25zdCBkIG9mIGIpIDAgPT09IGQuR2V0SW5zdGFuY2VDb3VudCgpICYmIGEuTWF5YmVVbmxvYWRUZXh0dXJlc0ZvcihkKQogICAgfQogICAgX0dldEZvckVhY2hTdGFjaygpIHsKICAgICAgICByZXR1cm4gZm9yRWFjaFN0YWNrCiAgICB9CiAgICBfUmVwZWF0KGEpIHsKICAgICAgICB2YXIgYiA9IHRoaXMuX3J1bnRpbWUuR2V0RXZlbnRTaGVldE1hbmFnZXIoKTsKICAgICAgICBjb25zdCBkID0gYi5HZXRFdmVudFN0YWNrKCksCiAgICAgICAgICAgIGMgPSBkLkdldEN1cnJlbnRTdGFja0ZyYW1lKCksCiAgICAgICAgICAgIGUgPSBjLkdldEN1cnJlbnRFdmVudCgpLAogICAgICAgICAgICBnID0gZS5HZXRTb2xNb2RpZmllcnMoKTsKICAgICAgICB2YXIgayA9IGMuSXNTb2xNb2RpZmllckFmdGVyQ25kcygpOwogICAgICAgIGNvbnN0IG0gPSBkLlB1c2goZSksCiAgICAgICAgICAgIG4gPSBiLkdldExvb3BTdGFjaygpLAogICAgICAgICAgICBxID0gbi5QdXNoKCk7CiAgICAgICAgcS5TZXRFbmQoYSk7CiAgICAgICAgaWYgKGspCiAgICAgICAgICAgIGZvciAoayA9IDA7IGsgPCBhICYmICFxLklzU3RvcHBlZCgpOyArK2spIGIuUHVzaENvcHlTb2woZyksIHEuU2V0SW5kZXgoayksIGUuUmV0cmlnZ2VyKGMsIG0pLCBiLlBvcFNvbChnKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIGZvciAoYiA9IDA7IGIgPCBhICYmICFxLklzU3RvcHBlZCgpOyArK2IpIHEuU2V0SW5kZXgoYiksIGUuUmV0cmlnZ2VyKGMsIG0pOwogICAgICAgIGQuUG9wKCk7CiAgICAgICAgbi5Qb3AoKTsKICAgICAgICByZXR1cm4gITEKICAgIH0qIF9EZWJ1Z1JlcGVhdChhKSB7CiAgICAgICAgdmFyIGIgPSB0aGlzLl9ydW50aW1lLkdldEV2ZW50U2hlZXRNYW5hZ2VyKCk7CiAgICAgICAgY29uc3QgZCA9IGIuR2V0RXZlbnRTdGFjaygpLAogICAgICAgICAgICBjID0gZC5HZXRDdXJyZW50U3RhY2tGcmFtZSgpLAogICAgICAgICAgICBlID0gYy5HZXRDdXJyZW50RXZlbnQoKSwKICAgICAgICAgICAgZyA9IGUuR2V0U29sTW9kaWZpZXJzKCk7CiAgICAgICAgdmFyIGsgPSBjLklzU29sTW9kaWZpZXJBZnRlckNuZHMoKTsKICAgICAgICBjb25zdCBtID0gZC5QdXNoKGUpLAogICAgICAgICAgICBuID0gYi5HZXRMb29wU3RhY2soKSwKICAgICAgICAgICAgcSA9IG4uUHVzaCgpOwogICAgICAgIHEuU2V0RW5kKGEpOwogICAgICAgIGlmIChrKQogICAgICAgICAgICBmb3IgKGsgPSAwOyBrIDwgYSAmJiAhcS5Jc1N0b3BwZWQoKTsgKytrKSBiLlB1c2hDb3B5U29sKGcpLCBxLlNldEluZGV4KGspLCB5aWVsZCogZS5EZWJ1Z1JldHJpZ2dlcihjLCBtKSwgYi5Qb3BTb2woZyk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBmb3IgKGIgPSAwOyBiIDwgYSAmJiAhcS5Jc1N0b3BwZWQoKTsgKytiKSBxLlNldEluZGV4KGIpLCB5aWVsZCogZS5EZWJ1Z1JldHJpZ2dlcihjLCBtKTsKICAgICAgICBkLlBvcCgpOwogICAgICAgIG4uUG9wKCk7CiAgICAgICAgcmV0dXJuICExCiAgICB9CiAgICBfV2hpbGUoKSB7CiAgICAgICAgdmFyIGEgPSB0aGlzLl9ydW50aW1lLkdldEV2ZW50U2hlZXRNYW5hZ2VyKCk7CiAgICAgICAgY29uc3QgYiA9IGEuR2V0RXZlbnRTdGFjaygpLAogICAgICAgICAgICBkID0gYi5HZXRDdXJyZW50U3RhY2tGcmFtZSgpLAogICAgICAgICAgICBjID0gZC5HZXRDdXJyZW50RXZlbnQoKSwKICAgICAgICAgICAgZSA9IGMuR2V0U29sTW9kaWZpZXJzKCk7CiAgICAgICAgdmFyIGcgPSBkLklzU29sTW9kaWZpZXJBZnRlckNuZHMoKTsKICAgICAgICBjb25zdCBrID0gYi5QdXNoKGMpLAogICAgICAgICAgICBtID0gYS5HZXRMb29wU3RhY2soKSwKICAgICAgICAgICAgbiA9IG0uUHVzaCgpOwogICAgICAgIGlmIChnKQogICAgICAgICAgICBmb3IgKGcgPSAwOyAhbi5Jc1N0b3BwZWQoKTsgKytnKSBhLlB1c2hDb3B5U29sKGUpLCBuLlNldEluZGV4KGcpLCBjLlJldHJpZ2dlcihkLCBrKSB8fCBuLlN0b3AoKSwgYS5Qb3BTb2woZSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBmb3IgKGEgPSAwOyAhbi5Jc1N0b3BwZWQoKTsgKythKSBuLlNldEluZGV4KGEpLCBjLlJldHJpZ2dlcihkLCBrKSB8fCBuLlN0b3AoKTsKICAgICAgICBiLlBvcCgpOwogICAgICAgIG0uUG9wKCk7CiAgICAgICAgcmV0dXJuICExCiAgICB9KiBfRGVidWdXaGlsZSgpIHsKICAgICAgICB2YXIgYSA9IHRoaXMuX3J1bnRpbWUuR2V0RXZlbnRTaGVldE1hbmFnZXIoKTsKICAgICAgICBjb25zdCBiID0gYS5HZXRFdmVudFN0YWNrKCksCiAgICAgICAgICAgIGQgPSBiLkdldEN1cnJlbnRTdGFja0ZyYW1lKCksCiAgICAgICAgICAgIGMgPSBkLkdldEN1cnJlbnRFdmVudCgpLAogICAgICAgICAgICBlID0gYy5HZXRTb2xNb2RpZmllcnMoKTsKICAgICAgICB2YXIgZyA9IGQuSXNTb2xNb2RpZmllckFmdGVyQ25kcygpOwogICAgICAgIGNvbnN0IGsgPSBiLlB1c2goYyksCiAgICAgICAgICAgIG0gPSBhLkdldExvb3BTdGFjaygpLAogICAgICAgICAgICBuID0gbS5QdXNoKCk7CiAgICAgICAgaWYgKGcpCiAgICAgICAgICAgIGZvciAoZyA9IDA7ICFuLklzU3RvcHBlZCgpOyArK2cpIGEuUHVzaENvcHlTb2woZSksIG4uU2V0SW5kZXgoZyksICh5aWVsZCogYy5EZWJ1Z1JldHJpZ2dlcihkLAogICAgICAgICAgICAgICAgaykpIHx8IG4uU3RvcCgpLCBhLlBvcFNvbChlKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIGZvciAoYSA9IDA7ICFuLklzU3RvcHBlZCgpOyArK2EpIG4uU2V0SW5kZXgoYSksICh5aWVsZCogYy5EZWJ1Z1JldHJpZ2dlcihkLCBrKSkgfHwgbi5TdG9wKCk7CiAgICAgICAgYi5Qb3AoKTsKICAgICAgICBtLlBvcCgpOwogICAgICAgIHJldHVybiAhMQogICAgfQogICAgX0ZvcihhLCBiLCBkKSB7CiAgICAgICAgdmFyIGMgPSB0aGlzLl9ydW50aW1lLkdldEV2ZW50U2hlZXRNYW5hZ2VyKCk7CiAgICAgICAgY29uc3QgZSA9IGMuR2V0RXZlbnRTdGFjaygpLAogICAgICAgICAgICBnID0gZS5HZXRDdXJyZW50U3RhY2tGcmFtZSgpLAogICAgICAgICAgICBrID0gZy5HZXRDdXJyZW50RXZlbnQoKSwKICAgICAgICAgICAgbSA9IGsuR2V0U29sTW9kaWZpZXJzKCksCiAgICAgICAgICAgIG4gPSBnLklzU29sTW9kaWZpZXJBZnRlckNuZHMoKSwKICAgICAgICAgICAgcSA9IGUuUHVzaChrKSwKICAgICAgICAgICAgdSA9IGMuR2V0TG9vcFN0YWNrKCksCiAgICAgICAgICAgIHcgPSB1LlB1c2goKTsKICAgICAgICB3LlNldE5hbWUoYSk7CiAgICAgICAgdy5TZXRFbmQoZCk7CiAgICAgICAgaWYgKGQgPCBiKQogICAgICAgICAgICBpZiAobikKICAgICAgICAgICAgICAgIGZvciAoYSA9IGI7IGEgPj0gZCAmJiAhdy5Jc1N0b3BwZWQoKTsgLS1hKSBjLlB1c2hDb3B5U29sKG0pLCB3LlNldEluZGV4KGEpLCBrLlJldHJpZ2dlcihnLCBxKSwgYy5Qb3BTb2wobSk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGZvciAoYyA9CiAgICAgICAgICAgICAgICAgICAgYjsgYyA+PSBkICYmICF3LklzU3RvcHBlZCgpOyAtLWMpIHcuU2V0SW5kZXgoYyksIGsuUmV0cmlnZ2VyKGcsIHEpOwogICAgICAgIGVsc2UgaWYgKG4pCiAgICAgICAgICAgIGZvciAoYSA9IGI7IGEgPD0gZCAmJiAhdy5Jc1N0b3BwZWQoKTsgKythKSBjLlB1c2hDb3B5U29sKG0pLCB3LlNldEluZGV4KGEpLCBrLlJldHJpZ2dlcihnLCBxKSwgYy5Qb3BTb2wobSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBmb3IgKGMgPSBiOyBjIDw9IGQgJiYgIXcuSXNTdG9wcGVkKCk7ICsrYykgdy5TZXRJbmRleChjKSwgay5SZXRyaWdnZXIoZywgcSk7CiAgICAgICAgZS5Qb3AoKTsKICAgICAgICB1LlBvcCgpOwogICAgICAgIHJldHVybiAhMQogICAgfSogX0RlYnVnRm9yKGEsIGIsIGQpIHsKICAgICAgICB2YXIgYyA9IHRoaXMuX3J1bnRpbWUuR2V0RXZlbnRTaGVldE1hbmFnZXIoKTsKICAgICAgICBjb25zdCBlID0gYy5HZXRFdmVudFN0YWNrKCksCiAgICAgICAgICAgIGcgPSBlLkdldEN1cnJlbnRTdGFja0ZyYW1lKCksCiAgICAgICAgICAgIGsgPSBnLkdldEN1cnJlbnRFdmVudCgpLAogICAgICAgICAgICBtID0gay5HZXRTb2xNb2RpZmllcnMoKSwKICAgICAgICAgICAgbiA9IGcuSXNTb2xNb2RpZmllckFmdGVyQ25kcygpLAogICAgICAgICAgICBxID0gZS5QdXNoKGspLAogICAgICAgICAgICB1ID0gYy5HZXRMb29wU3RhY2soKSwKICAgICAgICAgICAgdyA9IHUuUHVzaCgpOwogICAgICAgIHcuU2V0TmFtZShhKTsKICAgICAgICB3LlNldEVuZChkKTsKICAgICAgICBpZiAoZCA8IGIpCiAgICAgICAgICAgIGlmIChuKQogICAgICAgICAgICAgICAgZm9yIChhID0gYjsgYSA+PSBkICYmICF3LklzU3RvcHBlZCgpOyAtLWEpIGMuUHVzaENvcHlTb2wobSksIHcuU2V0SW5kZXgoYSksIHlpZWxkKiBrLkRlYnVnUmV0cmlnZ2VyKGcsIHEpLCBjLlBvcFNvbChtKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgZm9yIChjID0gYjsgYyA+PSBkICYmICF3LklzU3RvcHBlZCgpOyAtLWMpIHcuU2V0SW5kZXgoYyksIHlpZWxkKiBrLkRlYnVnUmV0cmlnZ2VyKGcsIHEpOwogICAgICAgIGVsc2UgaWYgKG4pCiAgICAgICAgICAgIGZvciAoYSA9IGI7IGEgPD0gZCAmJiAhdy5Jc1N0b3BwZWQoKTsgKythKSBjLlB1c2hDb3B5U29sKG0pLCB3LlNldEluZGV4KGEpLCB5aWVsZCogay5EZWJ1Z1JldHJpZ2dlcihnLCBxKSwgYy5Qb3BTb2wobSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBmb3IgKGMgPSBiOyBjIDw9IGQgJiYgIXcuSXNTdG9wcGVkKCk7ICsrYykgdy5TZXRJbmRleChjKSwgeWllbGQqIGsuRGVidWdSZXRyaWdnZXIoZywgcSk7CiAgICAgICAgZS5Qb3AoKTsKICAgICAgICB1LlBvcCgpOwogICAgICAgIHJldHVybiAhMQogICAgfQogICAgX0ZvckVhY2goYSkgewogICAgICAgIHZhciBiID0gdGhpcy5fcnVudGltZS5HZXRFdmVudFNoZWV0TWFuYWdlcigpOwogICAgICAgIGNvbnN0IGQgPSBiLkdldEV2ZW50U3RhY2soKSwKICAgICAgICAgICAgYyA9IGQuR2V0Q3VycmVudFN0YWNrRnJhbWUoKSwKICAgICAgICAgICAgZSA9IGMuR2V0Q3VycmVudEV2ZW50KCksCiAgICAgICAgICAgIGcgPSBlLkdldFNvbE1vZGlmaWVycygpOwogICAgICAgIHZhciBrID0gYy5Jc1NvbE1vZGlmaWVyQWZ0ZXJDbmRzKCk7CiAgICAgICAgY29uc3QgbSA9IGQuUHVzaChlKSwKICAgICAgICAgICAgbiA9IGIuR2V0TG9vcFN0YWNrKCksCiAgICAgICAgICAgIHEgPSBuLlB1c2goKSwKICAgICAgICAgICAgdSA9IGEuSXNJbkNvbnRhaW5lcigpLAogICAgICAgICAgICB3ID0gYS5HZXRDdXJyZW50U29sKCksCiAgICAgICAgICAgIHogPSBmb3JFYWNoU3RhY2suUHVzaCgpOwogICAgICAgIEMzJGpzY29tcCQxNzIuc2hhbGxvd0Fzc2lnbkFycmF5KHosIHcuR2V0SW5zdGFuY2VzKCkpOwogICAgICAgIHEuU2V0RW5kKHoubGVuZ3RoKTsKICAgICAgICBpZiAoaykKICAgICAgICAgICAgZm9yIChsZXQgQyA9IDAsIEQgPSB6Lmxlbmd0aDsgQyA8IEQgJiYgIXEuSXNTdG9wcGVkKCk7ICsrQykgYi5QdXNoQ29weVNvbChnKSwgayA9IHpbQ10sIGEuR2V0Q3VycmVudFNvbCgpLlNldFNpbmdsZVBpY2tlZChrKSwgdSAmJiBrLlNldFNpYmxpbmdzU2luZ2xlUGlja2VkKCksIHEuU2V0SW5kZXgoQyksIGUuUmV0cmlnZ2VyKGMsIG0pLCBiLlBvcFNvbChnKTsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgdy5fU2V0U2VsZWN0QWxsKCExKTsKICAgICAgICAgICAgYSA9IHcuX0dldE93bkluc3RhbmNlcygpOwogICAgICAgICAgICBDMyRqc2NvbXAkMTcyLmNsZWFyQXJyYXkoYSk7CiAgICAgICAgICAgIGEucHVzaChudWxsKTsKICAgICAgICAgICAgZm9yIChsZXQgQyA9IDAsIEQgPSB6Lmxlbmd0aDsgQyA8IEQgJiYgIXEuSXNTdG9wcGVkKCk7ICsrQykgYiA9IHpbQ10sIGFbMF0gPSBiLCB1ICYmIGIuU2V0U2libGluZ3NTaW5nbGVQaWNrZWQoKSwgcS5TZXRJbmRleChDKSwgZS5SZXRyaWdnZXIoYywgbSkKICAgICAgICB9CiAgICAgICAgZC5Qb3AoKTsKICAgICAgICBuLlBvcCgpOwogICAgICAgIEMzJGpzY29tcCQxNzIuY2xlYXJBcnJheSh6KTsKICAgICAgICBmb3JFYWNoU3RhY2suUG9wKCk7CiAgICAgICAgcmV0dXJuICExCiAgICB9KiBfRGVidWdGb3JFYWNoKGEpIHsKICAgICAgICB2YXIgYiA9IHRoaXMuX3J1bnRpbWUuR2V0RXZlbnRTaGVldE1hbmFnZXIoKTsKICAgICAgICBjb25zdCBkID0gYi5HZXRFdmVudFN0YWNrKCksCiAgICAgICAgICAgIGMgPSBkLkdldEN1cnJlbnRTdGFja0ZyYW1lKCksCiAgICAgICAgICAgIGUgPSBjLkdldEN1cnJlbnRFdmVudCgpLAogICAgICAgICAgICBnID0gZS5HZXRTb2xNb2RpZmllcnMoKTsKICAgICAgICB2YXIgayA9IGMuSXNTb2xNb2RpZmllckFmdGVyQ25kcygpOwogICAgICAgIGNvbnN0IG0gPSBkLlB1c2goZSksCiAgICAgICAgICAgIG4gPSBiLkdldExvb3BTdGFjaygpLAogICAgICAgICAgICBxID0gbi5QdXNoKCksCiAgICAgICAgICAgIHUgPSBhLklzSW5Db250YWluZXIoKSwKICAgICAgICAgICAgdyA9IGEuR2V0Q3VycmVudFNvbCgpLAogICAgICAgICAgICB6ID0gZm9yRWFjaFN0YWNrLlB1c2goKTsKICAgICAgICBDMyRqc2NvbXAkMTcyLnNoYWxsb3dBc3NpZ25BcnJheSh6LCB3LkdldEluc3RhbmNlcygpKTsKICAgICAgICBxLlNldEVuZCh6Lmxlbmd0aCk7CiAgICAgICAgaWYgKGspCiAgICAgICAgICAgIGZvciAobGV0IEMgPSAwLCBEID0gei5sZW5ndGg7IEMgPCBEICYmICFxLklzU3RvcHBlZCgpOyArK0MpIGIuUHVzaENvcHlTb2woZyksIGsgPSB6W0NdLCBhLkdldEN1cnJlbnRTb2woKS5TZXRTaW5nbGVQaWNrZWQoayksIHUgJiYgay5TZXRTaWJsaW5nc1NpbmdsZVBpY2tlZCgpLCBxLlNldEluZGV4KEMpLCB5aWVsZCogZS5EZWJ1Z1JldHJpZ2dlcihjLCBtKSwgYi5Qb3BTb2woZyk7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHcuX1NldFNlbGVjdEFsbCghMSk7CiAgICAgICAgICAgIGEgPSB3Ll9HZXRPd25JbnN0YW5jZXMoKTsKICAgICAgICAgICAgQzMkanNjb21wJDE3Mi5jbGVhckFycmF5KGEpOwogICAgICAgICAgICBhLnB1c2gobnVsbCk7CiAgICAgICAgICAgIGZvciAobGV0IEMgPSAwLCBEID0gei5sZW5ndGg7IEMgPCBEICYmICFxLklzU3RvcHBlZCgpOyArK0MpIGIgPSB6W0NdLCBhWzBdID0gYiwgdSAmJiBiLlNldFNpYmxpbmdzU2luZ2xlUGlja2VkKCksIHEuU2V0SW5kZXgoQyksIHlpZWxkKiBlLkRlYnVnUmV0cmlnZ2VyKGMsIG0pCiAgICAgICAgfQogICAgICAgIGQuUG9wKCk7CiAgICAgICAgbi5Qb3AoKTsKICAgICAgICBDMyRqc2NvbXAkMTcyLmNsZWFyQXJyYXkoeik7CiAgICAgICAgZm9yRWFjaFN0YWNrLlBvcCgpOwogICAgICAgIHJldHVybiAhMQogICAgfQogICAgX0ZvckVhY2hPcmRlcmVkKGEsIGIpIHsKICAgICAgICB2YXIgZCA9IHRoaXMuX3J1bnRpbWUuR2V0RXZlbnRTaGVldE1hbmFnZXIoKTsKICAgICAgICBjb25zdCBjID0gZC5HZXRFdmVudFN0YWNrKCksCiAgICAgICAgICAgIGUgPSBkLkdldEN1cnJlbnRDb25kaXRpb24oKSwKICAgICAgICAgICAgZyA9IGMuR2V0Q3VycmVudFN0YWNrRnJhbWUoKSwKICAgICAgICAgICAgayA9IGcuR2V0Q3VycmVudEV2ZW50KCksCiAgICAgICAgICAgIG0gPSBrLkdldFNvbE1vZGlmaWVycygpLAogICAgICAgICAgICBuID0gZy5Jc1NvbE1vZGlmaWVyQWZ0ZXJDbmRzKCksCiAgICAgICAgICAgIHEgPSBjLlB1c2goayksCiAgICAgICAgICAgIHUgPSBkLkdldExvb3BTdGFjaygpLAogICAgICAgICAgICB3ID0gdS5QdXNoKCksCiAgICAgICAgICAgIHogPSBhLklzSW5Db250YWluZXIoKSwKICAgICAgICAgICAgQyA9IGEuR2V0Q3VycmVudFNvbCgpLAogICAgICAgICAgICBEID0gZm9yRWFjaFN0YWNrLlB1c2goKTsKICAgICAgICBDMyRqc2NvbXAkMTcyLmNsZWFyQXJyYXkoRCk7CiAgICAgICAgY29uc3QgRiA9IEMuR2V0SW5zdGFuY2VzKCk7CiAgICAgICAgdy5TZXRFbmQoRi5sZW5ndGgpOwogICAgICAgIGZvciAobGV0IEUgPSAwLCBKID0gRi5sZW5ndGg7IEUgPCBKOyArK0UpIEQucHVzaChbRltFXSwgZS5SZWV2YWx1YXRlUGFyYW1ldGVyKDEsCiAgICAgICAgICAgIEUpXSk7CiAgICAgICAgRC5zb3J0KEZvckVhY2hPcmRlcmVkX1NvcnRJbnN0YW5jZXMpOwogICAgICAgIDEgPT09IGIgJiYgRC5yZXZlcnNlKCk7CiAgICAgICAgaWYgKG4pCiAgICAgICAgICAgIGZvciAobGV0IEUgPSAwLCBKID0gRC5sZW5ndGg7IEUgPCBKICYmICF3LklzU3RvcHBlZCgpOyArK0UpIGQuUHVzaENvcHlTb2wobSksIGIgPSBEW0VdWzBdLCBhLkdldEN1cnJlbnRTb2woKS5TZXRTaW5nbGVQaWNrZWQoYiksIHogJiYgYi5TZXRTaWJsaW5nc1NpbmdsZVBpY2tlZCgpLCB3LlNldEluZGV4KEUpLCBrLlJldHJpZ2dlcihnLCBxKSwgZC5Qb3BTb2wobSk7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIEMuX1NldFNlbGVjdEFsbCghMSk7CiAgICAgICAgICAgIGEgPSBDLl9HZXRPd25JbnN0YW5jZXMoKTsKICAgICAgICAgICAgQzMkanNjb21wJDE3Mi5jbGVhckFycmF5KGEpOwogICAgICAgICAgICBhLnB1c2gobnVsbCk7CiAgICAgICAgICAgIGZvciAobGV0IEUgPSAwLCBKID0gRC5sZW5ndGg7IEUgPCBKICYmICF3LklzU3RvcHBlZCgpOyArK0UpIGQgPSBEW0VdWzBdLCBhWzBdID0gZCwgeiAmJiBkLlNldFNpYmxpbmdzU2luZ2xlUGlja2VkKCksIHcuU2V0SW5kZXgoRSksIGsuUmV0cmlnZ2VyKGcsIHEpCiAgICAgICAgfQogICAgICAgIGMuUG9wKCk7CiAgICAgICAgdS5Qb3AoKTsKICAgICAgICBDMyRqc2NvbXAkMTcyLmNsZWFyQXJyYXkoRCk7CiAgICAgICAgZm9yRWFjaFN0YWNrLlBvcCgpOwogICAgICAgIHJldHVybiAhMQogICAgfSogX0RlYnVnRm9yRWFjaE9yZGVyZWQoYSwgYikgewogICAgICAgIHZhciBkID0gdGhpcy5fcnVudGltZS5HZXRFdmVudFNoZWV0TWFuYWdlcigpOwogICAgICAgIGNvbnN0IGMgPSBkLkdldEV2ZW50U3RhY2soKSwKICAgICAgICAgICAgZSA9IGQuR2V0Q3VycmVudENvbmRpdGlvbigpLAogICAgICAgICAgICBnID0gYy5HZXRDdXJyZW50U3RhY2tGcmFtZSgpLAogICAgICAgICAgICBrID0gZy5HZXRDdXJyZW50RXZlbnQoKSwKICAgICAgICAgICAgbSA9IGsuR2V0U29sTW9kaWZpZXJzKCksCiAgICAgICAgICAgIG4gPSBnLklzU29sTW9kaWZpZXJBZnRlckNuZHMoKSwKICAgICAgICAgICAgcSA9IGMuUHVzaChrKSwKICAgICAgICAgICAgdSA9IGQuR2V0TG9vcFN0YWNrKCksCiAgICAgICAgICAgIHcgPSB1LlB1c2goKSwKICAgICAgICAgICAgeiA9IGEuSXNJbkNvbnRhaW5lcigpLAogICAgICAgICAgICBDID0gYS5HZXRDdXJyZW50U29sKCksCiAgICAgICAgICAgIEQgPSBmb3JFYWNoU3RhY2suUHVzaCgpOwogICAgICAgIEMzJGpzY29tcCQxNzIuY2xlYXJBcnJheShEKTsKICAgICAgICBjb25zdCBGID0gQy5HZXRJbnN0YW5jZXMoKTsKICAgICAgICB3LlNldEVuZChGLmxlbmd0aCk7CiAgICAgICAgZm9yIChsZXQgRSA9IDAsIEogPSBGLmxlbmd0aDsgRSA8IEo7ICsrRSkgRC5wdXNoKFtGW0VdLCBlLlJlZXZhbHVhdGVQYXJhbWV0ZXIoMSwgRSldKTsKICAgICAgICBELnNvcnQoRm9yRWFjaE9yZGVyZWRfU29ydEluc3RhbmNlcyk7CiAgICAgICAgMSA9PT0gYiAmJiBELnJldmVyc2UoKTsKICAgICAgICBpZiAobikKICAgICAgICAgICAgZm9yIChsZXQgRSA9IDAsIEogPSBELmxlbmd0aDsgRSA8IEogJiYgIXcuSXNTdG9wcGVkKCk7ICsrRSkgZC5QdXNoQ29weVNvbChtKSwgYiA9IERbRV1bMF0sIGEuR2V0Q3VycmVudFNvbCgpLlNldFNpbmdsZVBpY2tlZChiKSwgeiAmJiBiLlNldFNpYmxpbmdzU2luZ2xlUGlja2VkKCksIHcuU2V0SW5kZXgoRSksIHlpZWxkKiBrLkRlYnVnUmV0cmlnZ2VyKGcsIHEpLCBkLlBvcFNvbChtKTsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgQy5fU2V0U2VsZWN0QWxsKCExKTsKICAgICAgICAgICAgYSA9IEMuX0dldE93bkluc3RhbmNlcygpOwogICAgICAgICAgICBDMyRqc2NvbXAkMTcyLmNsZWFyQXJyYXkoYSk7CiAgICAgICAgICAgIGEucHVzaChudWxsKTsKICAgICAgICAgICAgZm9yIChsZXQgRSA9IDAsIEogPSBELmxlbmd0aDsgRSA8IEogJiYgIXcuSXNTdG9wcGVkKCk7ICsrRSkgZCA9IERbRV1bMF0sIGFbMF0gPSBkLCB6ICYmIGQuU2V0U2libGluZ3NTaW5nbGVQaWNrZWQoKSwgdy5TZXRJbmRleChFKSwgeWllbGQqIGsuRGVidWdSZXRyaWdnZXIoZywgcSkKICAgICAgICB9CiAgICAgICAgYy5Qb3AoKTsKICAgICAgICB1LlBvcCgpOwogICAgICAgIEMzJGpzY29tcCQxNzIuY2xlYXJBcnJheShEKTsKICAgICAgICBmb3JFYWNoU3RhY2suUG9wKCk7CiAgICAgICAgcmV0dXJuICExCiAgICB9CiAgICBfR2V0RnVuY3Rpb25NYXAoYSwgYikgewogICAgICAgIGxldCBkID0gdGhpcy5fZnVuY3Rpb25NYXBzLmdldChhKTsKICAgICAgICBpZiAoZCkgcmV0dXJuIGQ7CiAgICAgICAgaWYgKCFiKSByZXR1cm4gbnVsbDsKICAgICAgICBkID0gewogICAgICAgICAgICBkZWZhdWx0RnVuYzogbnVsbCwKICAgICAgICAgICAgc3RyTWFwOiBuZXcgTWFwCiAgICAgICAgfTsKICAgICAgICB0aGlzLl9mdW5jdGlvbk1hcHMuc2V0KGEsIGQpOwogICAgICAgIHJldHVybiBkCiAgICB9CiAgICBfRG9DYWxsTWFwcGVkRnVuY3Rpb24oYSwgYiwgZCwgYywgZSkgewogICAgICAgIGIuR2V0RXZlbnRCbG9jaygpLlJ1bkFzTWFwcGVkRnVuY3Rpb25DYWxsKGQsIGIuSXNDb3B5UGlja2VkKCkpOwogICAgICAgIGMgJiYgYS5Qb3BTb2woZSkKICAgIH0qIF9EZWJ1Z0RvQ2FsbE1hcHBlZEZ1bmN0aW9uKGEsIGIsIGQsIGMsIGUpIHsKICAgICAgICB5aWVsZCogYi5HZXRFdmVudEJsb2NrKCkuRGVidWdSdW5Bc01hcHBlZEZ1bmN0aW9uQ2FsbChkLCBiLklzQ29weVBpY2tlZCgpKTsKICAgICAgICBjICYmIGEuUG9wU29sKGUpCiAgICB9Cn07CmNvbnN0IEMzJGpzY29tcCQxNzMgPSBzZWxmLkMzOwpDMyRqc2NvbXAkMTczLlBsdWdpbnMuU3lzdGVtLlR5cGUgPSBjbGFzcyBleHRlbmRzIEMzJGpzY29tcCQxNzMuRGVmZW5kZWRCYXNlIHsKICAgIGNvbnN0cnVjdG9yKGEpIHsKICAgICAgICBzdXBlcigpOwogICAgICAgIHRoaXMuX29iamVjdENsYXNzID0gYTsKICAgICAgICB0aGlzLl9ydW50aW1lID0gYS5HZXRSdW50aW1lKCk7CiAgICAgICAgdGhpcy5fcGx1Z2luID0gYS5HZXRQbHVnaW4oKQogICAgfQogICAgT25DcmVhdGUoKSB7fQogICAgUmVsZWFzZSgpIHsKICAgICAgICB0aGlzLl9wbHVnaW4gPSB0aGlzLl9ydW50aW1lID0gdGhpcy5fb2JqZWN0Q2xhc3MgPSBudWxsCiAgICB9Cn07CmNvbnN0IEMzJGpzY29tcCQxNzQgPSBzZWxmLkMzOwpDMyRqc2NvbXAkMTc0LlBsdWdpbnMuU3lzdGVtLkluc3RhbmNlID0gY2xhc3MgZXh0ZW5kcyBDMyRqc2NvbXAkMTc0LkRlZmVuZGVkQmFzZSB7CiAgICBjb25zdHJ1Y3RvcihhLCBiKSB7CiAgICAgICAgc3VwZXIoKTsKICAgICAgICB0aGlzLl9pbnN0ID0gYTsKICAgICAgICB0aGlzLl9vYmplY3RDbGFzcyA9IHRoaXMuX2luc3QuR2V0T2JqZWN0Q2xhc3MoKTsKICAgICAgICB0aGlzLl9zZGtUeXBlID0gdGhpcy5fb2JqZWN0Q2xhc3MuR2V0U2RrVHlwZSgpOwogICAgICAgIHRoaXMuX3J1bnRpbWUgPSB0aGlzLl9pbnN0LkdldFJ1bnRpbWUoKQogICAgfQogICAgUmVsZWFzZSgpIHsKICAgICAgICB0aGlzLl9ydW50aW1lID0gdGhpcy5fc2RrVHlwZSA9IHRoaXMuX29iamVjdENsYXNzID0gdGhpcy5faW5zdCA9IG51bGwKICAgIH0KfTsKY29uc3QgQzMkanNjb21wJDE3NSA9IHNlbGYuQzMsCiAgICB0bXBQaWNrQXJyYXkgPSBbXTsKQzMkanNjb21wJDE3NS5QbHVnaW5zLlN5c3RlbS5DbmRzID0gewogICAgRXZlcnlUaWNrKCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIE9uTGF5b3V0U3RhcnQoKSB7CiAgICAgICAgcmV0dXJuICEwCiAgICB9LAogICAgT25MYXlvdXRFbmQoKSB7CiAgICAgICAgcmV0dXJuICEwCiAgICB9LAogICAgT25TdXNwZW5kKCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIE9uUmVzdW1lKCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIElzU3VzcGVuZGVkKCkgewogICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lLklzU3VzcGVuZGVkKCkKICAgIH0sCiAgICBFbHNlKCkgewogICAgICAgIGNvbnN0IGEgPSB0aGlzLl9ydW50aW1lLkdldEN1cnJlbnRFdmVudFN0YWNrRnJhbWUoKTsKICAgICAgICByZXR1cm4gYS5HZXRFbHNlQnJhbmNoUmFuKCkgPyAhMSA6ICFhLkdldExhc3RFdmVudFRydWUoKQogICAgfSwKICAgIFRyaWdnZXJPbmNlKCkgewogICAgICAgIGNvbnN0IGEgPSB0aGlzLl9ydW50aW1lLkdldEN1cnJlbnRDb25kaXRpb24oKS5HZXRTYXZlZERhdGFNYXAoKTsKICAgICAgICBsZXQgYiA9IGEuZ2V0KCJUcmlnZ2VyT25jZV9sYXN0VGljayIpOwogICAgICAgICJ1bmRlZmluZWQiID09PSB0eXBlb2YgYiAmJiAoYiA9IC0xLCBhLnNldCgiVHJpZ2dlck9uY2VfbGFzdFRpY2siLCAtMSkpOwogICAgICAgIGNvbnN0IGQgPSB0aGlzLl9ydW50aW1lLkdldFRpY2tDb3VudCgpOwogICAgICAgIGEuc2V0KCJUcmlnZ2VyT25jZV9sYXN0VGljayIsIGQpOwogICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lLklzTGF5b3V0Rmlyc3RUaWNrKCkgfHwgYiAhPT0gZCAtIDEKICAgIH0sCiAgICBFdmVyeShhKSB7CiAgICAgICAgY29uc3QgYiA9IHRoaXMuX3J1bnRpbWUuR2V0Q3VycmVudENvbmRpdGlvbigpLkdldFNhdmVkRGF0YU1hcCgpLAogICAgICAgICAgICBkID0gYi5nZXQoIkV2ZXJ5X2xhc3RUaW1lIikgfHwgMCwKICAgICAgICAgICAgYyA9IHRoaXMuX3J1bnRpbWUuR2V0R2FtZVRpbWUoKTsKICAgICAgICBiLmhhcygiRXZlcnlfc2Vjb25kcyIpIHx8IGIuc2V0KCJFdmVyeV9zZWNvbmRzIiwgYSk7CiAgICAgICAgY29uc3QgZSA9IGIuZ2V0KCJFdmVyeV9zZWNvbmRzIik7CiAgICAgICAgaWYgKGMgPj0gZCArIGUpIHJldHVybiBiLnNldCgiRXZlcnlfbGFzdFRpbWUiLCBkICsgZSksIGMgPj0gYi5nZXQoIkV2ZXJ5X2xhc3RUaW1lIikgKyAuMDQgJiYgYi5zZXQoIkV2ZXJ5X2xhc3RUaW1lIiwgYyksIGIuc2V0KCJFdmVyeV9zZWNvbmRzIiwgYSksICEwOwogICAgICAgIGMgPCBkIC0gLjEgJiYgYi5zZXQoIkV2ZXJ5X2xhc3RUaW1lIiwgYyk7CiAgICAgICAgcmV0dXJuICExCiAgICB9LAogICAgSXNHcm91cEFjdGl2ZShhKSB7CiAgICAgICAgcmV0dXJuIChhID0gdGhpcy5fcnVudGltZS5HZXRFdmVudFNoZWV0TWFuYWdlcigpLkdldEV2ZW50R3JvdXBCeU5hbWUoYSkpICYmCiAgICAgICAgICAgIGEuSXNHcm91cEFjdGl2ZSgpCiAgICB9LAogICAgSXNQcmV2aWV3KCkgewogICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lLklzUHJldmlldygpCiAgICB9LAogICAgSXNNb2JpbGUoKSB7CiAgICAgICAgcmV0dXJuIEMzJGpzY29tcCQxNzUuUGxhdGZvcm0uSXNNb2JpbGUKICAgIH0sCiAgICBPbkxvYWRGaW5pc2hlZCgpIHsKICAgICAgICByZXR1cm4gITAKICAgIH0sCiAgICBPbkNhbnZhc1NuYXBzaG90KCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIEVmZmVjdHNTdXBwb3J0ZWQoKSB7CiAgICAgICAgcmV0dXJuICEwCiAgICB9LAogICAgT25TYXZlQ29tcGxldGUoKSB7CiAgICAgICAgcmV0dXJuICEwCiAgICB9LAogICAgT25TYXZlRmFpbGVkKCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIE9uTG9hZENvbXBsZXRlKCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIE9uTG9hZEZhaWxlZCgpIHsKICAgICAgICByZXR1cm4gITAKICAgIH0sCiAgICBPYmplY3RVSURFeGlzdHMoYSkgewogICAgICAgIHJldHVybiAhIXRoaXMuX3J1bnRpbWUuR2V0SW5zdGFuY2VCeVVJRChhKQogICAgfSwKICAgIElzT25QbGF0Zm9ybShhKSB7CiAgICAgICAgc3dpdGNoIChhKSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIHJldHVybiAiYnJvd3NlciIgPT09IEMzJGpzY29tcCQxNzUuUGxhdGZvcm0uQ29udGV4dDsKICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgcmV0dXJuICJpT1MiID09PSBDMyRqc2NvbXAkMTc1LlBsYXRmb3JtLk9TOwogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICByZXR1cm4gIkFuZHJvaWQiID09PQogICAgICAgICAgICAgICAgICAgIEMzJGpzY29tcCQxNzUuUGxhdGZvcm0uT1M7CiAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICAgIHJldHVybiAiY29yZG92YSIgPT09IEMzJGpzY29tcCQxNzUuUGxhdGZvcm0uQ29udGV4dDsKICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgICAgcmV0dXJuICJzY2lycmEtYXJjYWRlIiA9PT0gdGhpcy5fcnVudGltZS5HZXRFeHBvcnRUeXBlKCk7CiAgICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgICAgICByZXR1cm4gIm53anMiID09PSBDMyRqc2NvbXAkMTc1LlBsYXRmb3JtLkNvbnRleHQ7CiAgICAgICAgICAgIGNhc2UgMTM6CiAgICAgICAgICAgICAgICByZXR1cm4gIndpbmRvd3MtdXdwIiA9PT0gdGhpcy5fcnVudGltZS5HZXRFeHBvcnRUeXBlKCk7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICByZXR1cm4gITEKICAgICAgICB9CiAgICB9LAogICAgUmVnZXhUZXN0KGEsIGIsIGQpIHsKICAgICAgICByZXR1cm4gdGhpcy5HZXRSZWdleChiLCBkKS50ZXN0KGEpCiAgICB9LAogICAgQ29tcGFyZShhLCBiLCBkKSB7CiAgICAgICAgcmV0dXJuIEMzJGpzY29tcCQxNzUuY29tcGFyZShhLCBiLCBkKQogICAgfSwKICAgIENvbXBhcmVCZXR3ZWVuKGEsIGIsIGQpIHsKICAgICAgICByZXR1cm4gYSA+PSBiICYmIGEgPD0gZAogICAgfSwKICAgIENvbXBhcmVWYXIoYSwgYiwgZCkgewogICAgICAgIHJldHVybiBDMyRqc2NvbXAkMTc1LmNvbXBhcmUoYS5HZXRWYWx1ZSgpLCBiLCBkKQogICAgfSwKICAgIENvbXBhcmVCb29sVmFyKGEpIHsKICAgICAgICByZXR1cm4gISFhLkdldFZhbHVlKCkKICAgIH0sCiAgICBDb21wYXJlVGltZShhLCBiKSB7CiAgICAgICAgY29uc3QgZCA9IHRoaXMuX3J1bnRpbWUuR2V0R2FtZVRpbWUoKTsKICAgICAgICByZXR1cm4gMCA9PT0gYSA/IChhID0gdGhpcy5fcnVudGltZS5HZXRDdXJyZW50Q29uZGl0aW9uKCkuR2V0U2F2ZWREYXRhTWFwKCksICFhLmdldCgiQ29tcGFyZVRpbWVfZXhlY3V0ZWQiKSAmJiBkID49IGIgPyAoYS5zZXQoIkNvbXBhcmVUaW1lX2V4ZWN1dGVkIiwgITApLCAhMCkgOiAhMSkgOiBDMyRqc2NvbXAkMTc1LmNvbXBhcmUoZCwgYSwgYikKICAgIH0sCiAgICBJc05hTihhKSB7CiAgICAgICAgcmV0dXJuIGlzTmFOKGEpCiAgICB9LAogICAgQW5nbGVXaXRoaW4oYSwgYiwgZCkgewogICAgICAgIHJldHVybiBDMyRqc2NvbXAkMTc1LmFuZ2xlRGlmZihDMyRqc2NvbXAkMTc1LnRvUmFkaWFucyhhKSwgQzMkanNjb21wJDE3NS50b1JhZGlhbnMoZCkpIDw9IEMzJGpzY29tcCQxNzUudG9SYWRpYW5zKGIpCiAgICB9LAogICAgSXNDbG9ja3dpc2VGcm9tKGEsIGIpIHsKICAgICAgICByZXR1cm4gQzMkanNjb21wJDE3NS5hbmdsZUNsb2Nrd2lzZShDMyRqc2NvbXAkMTc1LnRvUmFkaWFucyhhKSwgQzMkanNjb21wJDE3NS50b1JhZGlhbnMoYikpCiAgICB9LAogICAgSXNCZXR3ZWVuQW5nbGVzKGEsIGIsIGQpIHsKICAgICAgICBhID0gQzMkanNjb21wJDE3NS50b1JhZGlhbnMoYSk7CiAgICAgICAgYiA9IEMzJGpzY29tcCQxNzUudG9SYWRpYW5zKGIpOwogICAgICAgIGQgPSBDMyRqc2NvbXAkMTc1LnRvUmFkaWFucyhkKTsKICAgICAgICByZXR1cm4gQzMkanNjb21wJDE3NS5hbmdsZUNsb2Nrd2lzZShkLCBiKSA/IEMzJGpzY29tcCQxNzUuYW5nbGVDbG9ja3dpc2UoYSwgYikgJiYgIUMzJGpzY29tcCQxNzUuYW5nbGVDbG9ja3dpc2UoYSwgZCkgOiAhKCFDMyRqc2NvbXAkMTc1LmFuZ2xlQ2xvY2t3aXNlKGEsIGIpICYmIEMzJGpzY29tcCQxNzUuYW5nbGVDbG9ja3dpc2UoYSwgZCkpCiAgICB9LAogICAgSXNWYWx1ZVR5cGUoYSwgYikgewogICAgICAgIHJldHVybiAibnVtYmVyIiA9PT0gdHlwZW9mIGEgPyAwID09PSBiIDogMSA9PT0gYgogICAgfSwKICAgIEV2YWx1YXRlRXhwcmVzc2lvbihhKSB7CiAgICAgICAgcmV0dXJuICEhYQogICAgfSwKICAgIFBpY2tCeUNvbXBhcmlzb24oYSwgYiwgZCwgYykgewogICAgICAgIGlmICghYSkgcmV0dXJuICExOwogICAgICAgIGNvbnN0IGUgPSB0aGlzLl9HZXRGb3JFYWNoU3RhY2soKSwKICAgICAgICAgICAgZyA9IGUuUHVzaCgpLAogICAgICAgICAgICBrID0gYS5HZXRDdXJyZW50U29sKCk7CiAgICAgICAgQzMkanNjb21wJDE3NS5zaGFsbG93QXNzaWduQXJyYXkoZywKICAgICAgICAgICAgay5HZXRJbnN0YW5jZXMoKSk7CiAgICAgICAgay5Jc1NlbGVjdEFsbCgpICYmIEMzJGpzY29tcCQxNzUuY2xlYXJBcnJheShrLl9HZXRPd25FbHNlSW5zdGFuY2VzKCkpOwogICAgICAgIGNvbnN0IG0gPSB0aGlzLl9ydW50aW1lLkdldEN1cnJlbnRDb25kaXRpb24oKTsKICAgICAgICBsZXQgbiA9IDA7CiAgICAgICAgZm9yIChsZXQgcSA9IDAsIHUgPSBnLmxlbmd0aDsgcSA8IHU7ICsrcSkgewogICAgICAgICAgICBjb25zdCB3ID0gZ1txXTsKICAgICAgICAgICAgZ1tuXSA9IHc7CiAgICAgICAgICAgIGIgPSBtLlJlZXZhbHVhdGVQYXJhbWV0ZXIoMSwgcSk7CiAgICAgICAgICAgIGMgPSBtLlJlZXZhbHVhdGVQYXJhbWV0ZXIoMywgcSk7CiAgICAgICAgICAgIEMzJGpzY29tcCQxNzUuY29tcGFyZShiLCBkLCBjKSA/ICsrbiA6IGsuX1B1c2hFbHNlSW5zdGFuY2UodykKICAgICAgICB9CiAgICAgICAgQzMkanNjb21wJDE3NS50cnVuY2F0ZUFycmF5KGcsIG4pOwogICAgICAgIGsuU2V0QXJyYXlQaWNrZWQoZyk7CiAgICAgICAgYiA9ICEhZy5sZW5ndGg7CiAgICAgICAgQzMkanNjb21wJDE3NS5jbGVhckFycmF5KGcpOwogICAgICAgIGUuUG9wKCk7CiAgICAgICAgYS5BcHBseVNvbFRvQ29udGFpbmVyKCk7CiAgICAgICAgcmV0dXJuIGIKICAgIH0sCiAgICBQaWNrQnlFdmFsdWF0ZShhLCBiKSB7CiAgICAgICAgaWYgKCFhKSByZXR1cm4gITE7CiAgICAgICAgY29uc3QgZCA9IHRoaXMuX0dldEZvckVhY2hTdGFjaygpLAogICAgICAgICAgICBjID0gZC5QdXNoKCksCiAgICAgICAgICAgIGUgPSBhLkdldEN1cnJlbnRTb2woKTsKICAgICAgICBDMyRqc2NvbXAkMTc1LnNoYWxsb3dBc3NpZ25BcnJheShjLCBlLkdldEluc3RhbmNlcygpKTsKICAgICAgICBlLklzU2VsZWN0QWxsKCkgJiYgQzMkanNjb21wJDE3NS5jbGVhckFycmF5KGUuX0dldE93bkVsc2VJbnN0YW5jZXMoKSk7CiAgICAgICAgY29uc3QgZyA9IHRoaXMuX3J1bnRpbWUuR2V0Q3VycmVudENvbmRpdGlvbigpOwogICAgICAgIGxldCBrID0gMDsKICAgICAgICBmb3IgKGxldCBtID0gMCwgbiA9IGMubGVuZ3RoOyBtIDwgbjsgKyttKSB7CiAgICAgICAgICAgIGNvbnN0IHEgPSBjW21dOwogICAgICAgICAgICBjW2tdID0gcTsKICAgICAgICAgICAgKGIgPSBnLlJlZXZhbHVhdGVQYXJhbWV0ZXIoMSwgbSkpID8gKytrOiBlLl9QdXNoRWxzZUluc3RhbmNlKHEpCiAgICAgICAgfQogICAgICAgIEMzJGpzY29tcCQxNzUudHJ1bmNhdGVBcnJheShjLCBrKTsKICAgICAgICBlLlNldEFycmF5UGlja2VkKGMpOwogICAgICAgIGIgPSAhIWMubGVuZ3RoOwogICAgICAgIEMzJGpzY29tcCQxNzUuY2xlYXJBcnJheShjKTsKICAgICAgICBkLlBvcCgpOwogICAgICAgIGEuQXBwbHlTb2xUb0NvbnRhaW5lcigpOwogICAgICAgIHJldHVybiBiCiAgICB9LAogICAgUGlja050aChhLCBiKSB7CiAgICAgICAgaWYgKCFhKSByZXR1cm4gITE7CiAgICAgICAgY29uc3QgZCA9IGEuR2V0Q3VycmVudFNvbCgpLAogICAgICAgICAgICBjID0gZC5HZXRJbnN0YW5jZXMoKTsKICAgICAgICBiID0gTWF0aC5mbG9vcihiKTsKICAgICAgICBpZiAoYiA+PSBjLmxlbmd0aCkgcmV0dXJuICExOwogICAgICAgIGQuUGlja09uZShjW2JdKTsKICAgICAgICBhLkFwcGx5U29sVG9Db250YWluZXIoKTsKICAgICAgICByZXR1cm4gITAKICAgIH0sCiAgICBQaWNrUmFuZG9tKGEpIHsKICAgICAgICBpZiAoIWEpIHJldHVybiAhMTsKICAgICAgICBjb25zdCBiID0gYS5HZXRDdXJyZW50U29sKCksCiAgICAgICAgICAgIGQgPSBiLkdldEluc3RhbmNlcygpLAogICAgICAgICAgICBjID0gTWF0aC5mbG9vcih0aGlzLl9ydW50aW1lLlJhbmRvbSgpICogZC5sZW5ndGgpOwogICAgICAgIGlmIChjID49IGQubGVuZ3RoKSByZXR1cm4gITE7CiAgICAgICAgYi5QaWNrT25lKGRbY10pOwogICAgICAgIGEuQXBwbHlTb2xUb0NvbnRhaW5lcigpOwogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIFBpY2tBbGwoYSkgewogICAgICAgIGlmICghYSB8fCAhYS5HZXRJbnN0YW5jZUNvdW50KCkpIHJldHVybiAhMTsKICAgICAgICBhLkdldEN1cnJlbnRTb2woKS5fU2V0U2VsZWN0QWxsKCEwKTsKICAgICAgICBhLkFwcGx5U29sVG9Db250YWluZXIoKTsKICAgICAgICByZXR1cm4gITAKICAgIH0sCiAgICBQaWNrT3ZlcmxhcHBpbmdQb2ludChhLCBiLCBkKSB7CiAgICAgICAgaWYgKCFhKSByZXR1cm4gITE7CiAgICAgICAgY29uc3QgYyA9IGEuR2V0Q3VycmVudFNvbCgpOwogICAgICAgIHZhciBlID0gYy5HZXRJbnN0YW5jZXMoKTsKICAgICAgICBjb25zdCBnID0gdGhpcy5fcnVudGltZS5HZXRDdXJyZW50RXZlbnQoKS5Jc09yQmxvY2soKSwKICAgICAgICAgICAgayA9IHRoaXMuX3J1bnRpbWUuR2V0Q3VycmVudENvbmRpdGlvbigpLklzSW52ZXJ0ZWQoKTsKICAgICAgICBjLklzU2VsZWN0QWxsKCkgPyAoQzMkanNjb21wJDE3NS5zaGFsbG93QXNzaWduQXJyYXkodG1wUGlja0FycmF5LCBlKSwgYy5DbGVhckFycmF5cygpLCBjLl9TZXRTZWxlY3RBbGwoITEpKSA6IGcgPyAoQzMkanNjb21wJDE3NS5zaGFsbG93QXNzaWduQXJyYXkodG1wUGlja0FycmF5LCBjLl9HZXRPd25FbHNlSW5zdGFuY2VzKCkpLCBDMyRqc2NvbXAkMTc1LmNsZWFyQXJyYXkoYy5fR2V0T3duRWxzZUluc3RhbmNlcygpKSkgOiAoQzMkanNjb21wJDE3NS5zaGFsbG93QXNzaWduQXJyYXkodG1wUGlja0FycmF5LCBjLl9HZXRPd25JbnN0YW5jZXMoKSksIEMzJGpzY29tcCQxNzUuY2xlYXJBcnJheShjLl9HZXRPd25JbnN0YW5jZXMoKSkpOwogICAgICAgIGZvciAobGV0IG0gPSAwLCBuID0gdG1wUGlja0FycmF5Lmxlbmd0aDsgbSA8IG47ICsrbSkgZSA9IHRtcFBpY2tBcnJheVttXSwKICAgICAgICAgICAgQzMkanNjb21wJDE3NS54b3IoZS5HZXRXb3JsZEluZm8oKS5Db250YWluc1BvaW50KGIsIGQpLCBrKSA/IGMuX1B1c2hJbnN0YW5jZShlKSA6IGMuX1B1c2hFbHNlSW5zdGFuY2UoZSk7CiAgICAgICAgYS5BcHBseVNvbFRvQ29udGFpbmVyKCk7CiAgICAgICAgcmV0dXJuIEMzJGpzY29tcCQxNzUueG9yKCEhYy5fR2V0T3duSW5zdGFuY2VzKCkubGVuZ3RoLCBrKQogICAgfSwKICAgIFBpY2tMYXN0Q3JlYXRlZChhKSB7CiAgICAgICAgaWYgKCFhKSByZXR1cm4gITE7CiAgICAgICAgdmFyIGIgPSBhLklzRmFtaWx5KCk7CiAgICAgICAgbGV0IGQgPSBudWxsOwogICAgICAgIGNvbnN0IGMgPSB0aGlzLl9ydW50aW1lLl9HZXRJbnN0YW5jZXNQZW5kaW5nQ3JlYXRlKCk7CiAgICAgICAgZm9yIChsZXQgZSA9IGMubGVuZ3RoIC0gMTsgMCA8PSBlOyAtLWUpIHsKICAgICAgICAgICAgY29uc3QgZyA9IGNbZV07CiAgICAgICAgICAgIGlmIChiKSB7CiAgICAgICAgICAgICAgICBpZiAoZy5HZXRPYmplY3RDbGFzcygpLkJlbG9uZ3NUb0ZhbWlseShhKSkgewogICAgICAgICAgICAgICAgICAgIGQgPSBnOwogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZy5HZXRPYmplY3RDbGFzcygpID09PSBhKSB7CiAgICAgICAgICAgICAgICBkID0gZzsKICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZCB8fCAoYiA9IGEuR2V0SW5zdGFuY2VzKCksIGIubGVuZ3RoICYmIChkID0gYi5hdCgtMSkpKTsKICAgICAgICBpZiAoIWQpIHJldHVybiAhMTsKICAgICAgICBhLkdldEN1cnJlbnRTb2woKS5QaWNrT25lKGQpOwogICAgICAgIGEuQXBwbHlTb2xUb0NvbnRhaW5lcigpOwogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIFJlcGVhdChhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUuSXNEZWJ1Z2dpbmcoKSA/IHRoaXMuX0RlYnVnUmVwZWF0KGEpIDogdGhpcy5fUmVwZWF0KGEpCiAgICB9LAogICAgV2hpbGUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUuSXNEZWJ1Z2dpbmcoKSA/IHRoaXMuX0RlYnVnV2hpbGUoKSA6IHRoaXMuX1doaWxlKCkKICAgIH0sCiAgICBGb3IoYSwgYiwgZCkgewogICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lLklzRGVidWdnaW5nKCkgPyB0aGlzLl9EZWJ1Z0ZvcihhLCBiLCBkKSA6IHRoaXMuX0ZvcihhLCBiLCBkKQogICAgfSwKICAgIEZvckVhY2goYSkgewogICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lLklzRGVidWdnaW5nKCkgPyB0aGlzLl9EZWJ1Z0ZvckVhY2goYSkgOiB0aGlzLl9Gb3JFYWNoKGEpCiAgICB9LAogICAgRm9yRWFjaE9yZGVyZWQoYSwgYiwgZCkgewogICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lLklzRGVidWdnaW5nKCkgPyB0aGlzLl9EZWJ1Z0ZvckVhY2hPcmRlcmVkKGEsIGQpIDogdGhpcy5fRm9yRWFjaE9yZGVyZWQoYSwKICAgICAgICAgICAgZCkKICAgIH0sCiAgICBMYXllclZpc2libGUoYSkgewogICAgICAgIHJldHVybiBhID8gYS5Jc1Zpc2libGUoKSA6ICExCiAgICB9LAogICAgTGF5ZXJJbnRlcmFjdGl2ZShhKSB7CiAgICAgICAgcmV0dXJuIGEgPyBhLklzU2VsZkFuZFBhcmVudHNJbnRlcmFjdGl2ZSgpIDogITEKICAgIH0sCiAgICBMYXllckVtcHR5KGEpIHsKICAgICAgICByZXR1cm4gYSA/ICFhLkdldEluc3RhbmNlQ291bnQoKSA6ICExCiAgICB9LAogICAgTGF5ZXJDbXBPcGFjaXR5KGEsIGIsIGQpIHsKICAgICAgICByZXR1cm4gYSA/IEMzJGpzY29tcCQxNzUuY29tcGFyZSgxMDAgKiBhLkdldE9wYWNpdHkoKSwgYiwgZCkgOiAhMQogICAgfSwKICAgIE9uSW1hZ2VMb2FkaW5nQ29tcGxldGUoKSB7CiAgICAgICAgcmV0dXJuICEwCiAgICB9LAogICAgSXNMb2FkaW5nSW1hZ2VzKCkgewogICAgICAgIHJldHVybiAwIDwgdGhpcy5faW1hZ2VzTG9hZGluZ1RvdGFsCiAgICB9LAogICAgVGVtcGxhdGVFeGlzdHMoYSwgYikgewogICAgICAgIGNvbnN0IGQgPSB0aGlzLl9ydW50aW1lLkdldFRlbXBsYXRlTWFuYWdlcigpOwogICAgICAgIHJldHVybiBkICYmIGIgPyAhIWQuR2V0VGVtcGxhdGVEYXRhKGEsIGIpIDogITEKICAgIH0KfTsKY29uc3QgQzMkanNjb21wJDE3NiA9IHNlbGYuQzM7CgpmdW5jdGlvbiBTb3J0Wk9yZGVyTGlzdCRqc2NvbXAkMShhLCBiKSB7CiAgICBjb25zdCBkID0gYVswXSAtIGJbMF07CiAgICByZXR1cm4gMCAhPT0gZCA/IGQgOiBhWzFdIC0gYlsxXQp9CgpmdW5jdGlvbiBTb3J0SW5zdGFuY2VzQnlWYWx1ZShhLCBiKSB7CiAgICByZXR1cm4gYVsxXSAtIGJbMV0KfQpjb25zdCB0ZW1wWk9yZGVyTGlzdCRqc2NvbXAkMSA9IFtdLAogICAgdGVtcEluc3RWYWx1ZXMgPSBbXSwKICAgIHRlbXBSZWN0JGpzY29tcCQ5ID0gQzMkanNjb21wJDE3Ni5OZXcoQzMkanNjb21wJDE3Ni5SZWN0KSwKICAgIHRlbXBDb2xvciRqc2NvbXAkNyA9IEMzJGpzY29tcCQxNzYuTmV3KEMzJGpzY29tcCQxNzYuQ29sb3IpOwpDMyRqc2NvbXAkMTc2LlBsdWdpbnMuU3lzdGVtLkFjdHMgPSB7CiAgICBTZXRWYXIoYSwgYikgewogICAgICAgIGEuU2V0VmFsdWUoYikKICAgIH0sCiAgICBBZGRWYXIoYSwgYikgewogICAgICAgIGEuSXNOdW1iZXIoKSAmJiAibnVtYmVyIiAhPT0gdHlwZW9mIGIgJiYgKGIgPSBwYXJzZUZsb2F0KGIpKTsKICAgICAgICBhLlNldFZhbHVlKGEuR2V0VmFsdWUoKSArIGIpCiAgICB9LAogICAgU3ViVmFyKGEsIGIpIHsKICAgICAgICBhLklzTnVtYmVyKCkgJiYgYS5TZXRWYWx1ZShhLkdldFZhbHVlKCkgLSBiKQogICAgfSwKICAgIFNldEJvb2xWYXIoYSwgYikgewogICAgICAgIGEuU2V0VmFsdWUoISFiKQogICAgfSwKICAgIFRvZ2dsZUJvb2xWYXIoYSkgewogICAgICAgIGEuU2V0VmFsdWUoIWEuR2V0VmFsdWUoKSkKICAgIH0sCiAgICBSZXNldEdsb2JhbHMoKSB7CiAgICAgICAgdGhpcy5fcnVudGltZS5HZXRFdmVudFNoZWV0TWFuYWdlcigpLlJlc2V0QWxsR2xvYmFsc1RvSW5pdGlhbFZhbHVlKCkKICAgIH0sCiAgICBDcmVhdGVPYmplY3QoYSwgYiwgZCwgYywgZSwgZykgewogICAgICAgIGlmIChhICYmIGIgJiYgKGQgPSB0aGlzLl9ydW50aW1lLkNyZWF0ZUluc3RhbmNlKGEsIGIsIGQsIGMsIGUsIGcpKSkgewogICAgICAgICAgICBlICYmIGIuU29ydEFuZEFkZEluc3RhbmNlc0J5WkluZGV4KGQpOwogICAgICAgICAgICBiID0gdGhpcy5fcnVudGltZS5HZXRFdmVudFNoZWV0TWFuYWdlcigpOwogICAgICAgICAgICBiLkJsb2NrRmx1c2hpbmdJbnN0YW5jZXMoITApOwogICAgICAgICAgICBkLl9UcmlnZ2VyT25DcmVhdGVkT25TZWxmQW5kUmVsYXRlZCgpOwogICAgICAgICAgICBiLkJsb2NrRmx1c2hpbmdJbnN0YW5jZXMoITEpOwogICAgICAgICAgICBiID0gbmV3IE1hcDsKICAgICAgICAgICAgZC5Db2xsZWN0SW5zdGFuY2VzVG9QaWNrKGIsIGEsIGUpOwogICAgICAgICAgICBmb3IgKGNvbnN0IFtrLCBtXSBvZiBiKSBrLkdldEN1cnJlbnRTb2woKS5TZXRTZXRQaWNrZWQobSkKICAgICAgICB9CiAgICB9LAogICAgQ3JlYXRlT2JqZWN0QnlOYW1lKGEsIGIsIGQsIGMsIGUsIGcpIHsKICAgICAgICBhICYmIGIgJiYgKGEgPSB0aGlzLl9ydW50aW1lLkdldE9iamVjdENsYXNzQnlOYW1lKGEpKSAmJiBDMyRqc2NvbXAkMTc2LlBsdWdpbnMuU3lzdGVtLkFjdHMuQ3JlYXRlT2JqZWN0LmNhbGwodGhpcywgYSwgYiwgZCwgYywgZSwgZykKICAgIH0sCiAgICBSZWNyZWF0ZUluaXRpYWxPYmplY3RzKGEsIGIsIGQsIGMsIGUsIGcsIGssIG0sIG4sIHEpIHsKICAgICAgICBpZiAoYSkgewogICAgICAgICAgICB2YXIgdSA9IHRoaXMuX3J1bnRpbWUuR2V0Q3VycmVudExheW91dCgpOwogICAgICAgICAgICBpZiAoZyAmJiAodSA9IHRoaXMuX3J1bnRpbWUuR2V0TGF5b3V0TWFuYWdlcigpLkdldExheW91dEJ5TmFtZShnKSwgIXUpKSByZXR1cm47CiAgICAgICAgICAgIGcgPSBudWxsOwogICAgICAgICAgICBpZiAoIm51bWJlciIgIT09IHR5cGVvZiBrIHx8IDAgPD0gaykKICAgICAgICAgICAgICAgIGlmIChnID0gdS5HZXRMYXllcihrKSwgIWcpIHJldHVybjsKICAgICAgICAgICAgdGVtcFJlY3QkanNjb21wJDkuc2V0KGIsIGQsIGMsIGUpOwogICAgICAgICAgICBiID0gdS5SZWNyZWF0ZUluaXRpYWxPYmplY3RzKGEsIHRlbXBSZWN0JGpzY29tcCQ5LCBnLCBtLCBuLCBxKTsKICAgICAgICAgICAgYS5HZXRDdXJyZW50U29sKCkuU2V0QXJyYXlQaWNrZWQoYik7CiAgICAgICAgICAgIGEuQXBwbHlTb2xUb0NvbnRhaW5lcigpCiAgICAgICAgfQogICAgfSwKICAgIFN0b3BMb29wKCkgewogICAgICAgIGNvbnN0IGEgPSB0aGlzLl9sb29wU3RhY2s7CiAgICAgICAgYS5Jc0luTG9vcCgpICYmIGEuR2V0Q3VycmVudCgpLlN0b3AoKQogICAgfSwKICAgIFNldEdyb3VwQWN0aXZlKGEsIGIpIHsKICAgICAgICAoYSA9IHRoaXMuX3J1bnRpbWUuR2V0RXZlbnRTaGVldE1hbmFnZXIoKS5HZXRFdmVudEdyb3VwQnlOYW1lKGEpKSAmJiAoMCA9PT0gYiA/IGEuU2V0R3JvdXBBY3RpdmUoITEpIDogMSA9PT0gYiA/IGEuU2V0R3JvdXBBY3RpdmUoITApIDogYS5TZXRHcm91cEFjdGl2ZSghYS5Jc0dyb3VwQWN0aXZlKCkpKQogICAgfSwKICAgIFNldFRpbWVzY2FsZShhKSB7CiAgICAgICAgdGhpcy5fcnVudGltZS5TZXRUaW1lU2NhbGUoYSkKICAgIH0sCiAgICBTZXRPYmplY3RUaW1lc2NhbGUoYSwgYikgewogICAgICAgIDAgPiBiICYmIChiID0gMCk7CiAgICAgICAgaWYgKGEpIHsKICAgICAgICAgICAgYSA9IGEuR2V0Q3VycmVudFNvbCgpLkdldEluc3RhbmNlcygpOwogICAgICAgICAgICBmb3IgKGNvbnN0IGQgb2YgYSkgZC5TZXRUaW1lU2NhbGUoYikKICAgICAgICB9CiAgICB9LAogICAgUmVzdG9yZU9iamVjdFRpbWVzY2FsZShhKSB7CiAgICAgICAgaWYgKGEpIHsKICAgICAgICAgICAgYSA9IGEuR2V0Q3VycmVudFNvbCgpLkdldEluc3RhbmNlcygpOwogICAgICAgICAgICBmb3IgKGNvbnN0IGIgb2YgYSkgYi5SZXN0b3JlVGltZVNjYWxlKCkKICAgICAgICB9CiAgICB9LAogICAgV2FpdChhKSB7CiAgICAgICAgaWYgKCEoMCA+IGEpKSByZXR1cm4gdGhpcy5fcnVudGltZS5HZXRFdmVudFNoZWV0TWFuYWdlcigpLkFkZFNjaGVkdWxlZFdhaXQoKS5Jbml0VGltZXIoYSksICEwCiAgICB9LAogICAgV2FpdEZvclNpZ25hbChhKSB7CiAgICAgICAgdGhpcy5fcnVudGltZS5HZXRFdmVudFNoZWV0TWFuYWdlcigpLkFkZFNjaGVkdWxlZFdhaXQoKS5Jbml0U2lnbmFsKGEpOwogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIFdhaXRGb3JQcmV2aW91c0FjdGlvbnMoKSB7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuX3J1bnRpbWUuR2V0RXZlbnRTaGVldE1hbmFnZXIoKTsKICAgICAgICBhLkFkZFNjaGVkdWxlZFdhaXQoKS5Jbml0UHJvbWlzZShhLkdldFByb21pc2VGb3JBbGxBc3luY0FjdGlvbnMoKSk7CiAgICAgICAgcmV0dXJuICEwCiAgICB9LAogICAgU2lnbmFsKGEpIHsKICAgICAgICBhID0gYS50b0xvd2VyQ2FzZSgpOwogICAgICAgIGZvciAoY29uc3QgYiBvZiB0aGlzLl9ydW50aW1lLkdldEV2ZW50U2hlZXRNYW5hZ2VyKCkuc2NoZWR1bGVkV2FpdHMoKSkgYi5Jc1NpZ25hbCgpICYmIGIuR2V0U2lnbmFsVGFnKCkgPT09IGEgJiYgYi5TZXRTaWduYWxsZWQoKQogICAgfSwKICAgIGFzeW5jIFNuYXBzaG90Q2FudmFzKGEsIGIsIGQsIGMsIGUsIGcpIHsKICAgICAgICBjb25zdCBrID0gdGhpcy5fcnVudGltZS5HZXRDYW52YXNNYW5hZ2VyKCk7CiAgICAgICAgayAmJiAodGhpcy5VcGRhdGVSZW5kZXIoKSwgYXdhaXQgay5TbmFwc2hvdENhbnZhcygwID09PSBhID8gImltYWdlL3BuZyIgOiAiaW1hZ2UvanBlZyIsIGIgLyAxMDAsIGQsIGMsIGUsIGcpLCBhd2FpdCB0aGlzLl9ydW50aW1lLlRyaWdnZXJBc3luYyhDMyRqc2NvbXAkMTc2LlBsdWdpbnMuU3lzdGVtLkNuZHMuT25DYW52YXNTbmFwc2hvdCwgbnVsbCkpCiAgICB9LAogICAgU2V0Q2FudmFzU2l6ZShhLCBiKSB7CiAgICAgICAgaWYgKCEoMCA+PSBhIHx8IDAgPj0gYikpIHsKICAgICAgICAgICAgdGhpcy5fcnVudGltZS5TZXRWaWV3cG9ydFNpemUoYSwgYik7CiAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuR2V0Q3VycmVudExheW91dCgpLkJvdW5kU2Nyb2xsaW5nKCk7CiAgICAgICAgICAgIHZhciBkID0gdGhpcy5fcnVudGltZS5HZXRDYW52YXNNYW5hZ2VyKCk7CiAgICAgICAgICAgIGQgJiYgKCJvZmYiICE9PSBkLkdldEN1cnJlbnRGdWxsc2NyZWVuTW9kZSgpICYmIHRoaXMuX3J1bnRpbWUuU2V0T3JpZ2luYWxWaWV3cG9ydFNpemUoYSwgYiksIGQuU2V0U2l6ZShkLkdldExhc3RXaWR0aCgpLCBkLkdldExhc3RIZWlnaHQoKSwgITApLCB0aGlzLl9ydW50aW1lLlVwZGF0ZVJlbmRlcigpKQogICAgICAgIH0KICAgIH0sCiAgICBTZXRGdWxsc2NyZWVuUXVhbGl0eShhKSB7CiAgICAgICAgY29uc3QgYiA9IHRoaXMuX3J1bnRpbWUuR2V0Q2FudmFzTWFuYWdlcigpOwogICAgICAgIGIgJiYgIm9mZiIgIT09IGIuR2V0Q3VycmVudEZ1bGxzY3JlZW5Nb2RlKCkgJiYgKGIuU2V0RnVsbHNjcmVlblNjYWxpbmdRdWFsaXR5KDAgIT09IGEgPyAiaGlnaCIgOiAibG93IiksIGIuU2V0U2l6ZShiLkdldExhc3RXaWR0aCgpLCBiLkdldExhc3RIZWlnaHQoKSwgITApKQogICAgfSwKICAgIFNhdmVTdGF0ZShhKSB7CiAgICAgICAgdGhpcy5fcnVudGltZS5TYXZlVG9TbG90KGEpCiAgICB9LAogICAgTG9hZFN0YXRlKGEpIHsKICAgICAgICB0aGlzLl9ydW50aW1lLkxvYWRGcm9tU2xvdChhKQogICAgfSwKICAgIExvYWRTdGF0ZUpTT04oYSkgewogICAgICAgIHRoaXMuX3J1bnRpbWUuTG9hZEZyb21Kc29uU3RyaW5nKGEpCiAgICB9LAogICAgU2V0SGFsZkZyYW1lcmF0ZU1vZGUoYSkge30sCiAgICBSZXNldFBlcnNpc3RlZCgpIHsKICAgICAgICBmb3IgKGNvbnN0IGEgb2YgdGhpcy5fcnVudGltZS5HZXRMYXlvdXRNYW5hZ2VyKCkuR2V0QWxsTGF5b3V0cygpKSBhLlJlc2V0UGVyc2lzdERhdGEoKQogICAgfSwKICAgIFNldFBpeGVsUm91bmRpbmcoYSkgewogICAgICAgIHRoaXMuX3J1bnRpbWUuU2V0UGl4ZWxSb3VuZGluZ0VuYWJsZWQoMCAhPT0gYSkKICAgIH0sCiAgICBTZXRNaW5pbXVtRnJhbWVyYXRlKGEpIHsKICAgICAgICB0aGlzLl9ydW50aW1lLlNldE1pbmltdW1GcmFtZXJhdGUoYSkKICAgIH0sCiAgICBTb3J0Wk9yZGVyQnlJbnN0VmFyKGEsIGIpIHsKICAgICAgICBpZiAoYSkgewogICAgICAgICAgICB2YXIgZCA9IGEuR2V0Q3VycmVudFNvbCgpLkdldEluc3RhbmNlcygpLAogICAgICAgICAgICAgICAgYyA9IHRoaXMuX3J1bnRpbWUuR2V0Q3VycmVudExheW91dCgpLAogICAgICAgICAgICAgICAgZSA9IGEuSXNGYW1pbHkoKTsKICAgICAgICAgICAgYSA9IGEuR2V0RmFtaWx5SW5kZXgoKTsKICAgICAgICAgICAgZm9yIChsZXQgayA9IDAsIG0gPSBkLmxlbmd0aDsgayA8IG07ICsraykgewogICAgICAgICAgICAgICAgdmFyIGcgPSBkW2tdOwogICAgICAgICAgICAgICAgY29uc3QgbiA9IGcuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgICAgICBpZiAoIW4pIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgbGV0IHE7CiAgICAgICAgICAgICAgICBxID0gZSA/IGcuR2V0SW5zdGFuY2VWYXJpYWJsZVZhbHVlKGIgKwogICAgICAgICAgICAgICAgICAgIGcuR2V0T2JqZWN0Q2xhc3MoKS5HZXRGYW1pbHlJbnN0YW5jZVZhcmlhYmxlT2Zmc2V0KGEpKSA6IGcuR2V0SW5zdGFuY2VWYXJpYWJsZVZhbHVlKGIpOwogICAgICAgICAgICAgICAgdGVtcFpPcmRlckxpc3QkanNjb21wJDEucHVzaChbbi5HZXRMYXllcigpLkdldEluZGV4KCksIG4uR2V0WkluZGV4KCldKTsKICAgICAgICAgICAgICAgIHRlbXBJbnN0VmFsdWVzLnB1c2goW2csIHFdKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0ZW1wWk9yZGVyTGlzdCRqc2NvbXAkMS5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIHRlbXBaT3JkZXJMaXN0JGpzY29tcCQxLnNvcnQoU29ydFpPcmRlckxpc3QkanNjb21wJDEpOwogICAgICAgICAgICAgICAgdGVtcEluc3RWYWx1ZXMuc29ydChTb3J0SW5zdGFuY2VzQnlWYWx1ZSk7CiAgICAgICAgICAgICAgICBiID0gITE7CiAgICAgICAgICAgICAgICBmb3IgKGxldCBrID0gMCwgbSA9IHRlbXBaT3JkZXJMaXN0JGpzY29tcCQxLmxlbmd0aDsgayA8IG07ICsraykgZCA9IHRlbXBJbnN0VmFsdWVzW2tdWzBdLCBlID0gYy5HZXRMYXllckJ5SW5kZXgodGVtcFpPcmRlckxpc3QkanNjb21wJDFba11bMF0pLCBhID0gdGVtcFpPcmRlckxpc3QkanNjb21wJDFba11bMV0sIGcgPSBlLl9HZXRJbnN0YW5jZXMoKSwgZ1thXSAhPT0KICAgICAgICAgICAgICAgICAgICBkICYmIChnW2FdID0gZCwgZC5HZXRXb3JsZEluZm8oKS5fU2V0TGF5ZXIoZSksIGUuU2V0WkluZGljZXNDaGFuZ2VkKCksIGIgPSAhMCk7CiAgICAgICAgICAgICAgICBiICYmIHRoaXMuX3J1bnRpbWUuVXBkYXRlUmVuZGVyKCk7CiAgICAgICAgICAgICAgICBDMyRqc2NvbXAkMTc2LmNsZWFyQXJyYXkodGVtcFpPcmRlckxpc3QkanNjb21wJDEpOwogICAgICAgICAgICAgICAgQzMkanNjb21wJDE3Ni5jbGVhckFycmF5KHRlbXBJbnN0VmFsdWVzKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSwKICAgIEdvVG9MYXlvdXQoYSkgewogICAgICAgIGlmICghdGhpcy5fcnVudGltZS5Jc0xvYWRpbmcoKSkgewogICAgICAgICAgICB2YXIgYiA9IHRoaXMuX3J1bnRpbWUuR2V0TGF5b3V0TWFuYWdlcigpOwogICAgICAgICAgICBiLklzUGVuZGluZ0NoYW5nZU1haW5MYXlvdXQoKSB8fCBiLkNoYW5nZU1haW5MYXlvdXQoYSkKICAgICAgICB9CiAgICB9LAogICAgR29Ub0xheW91dEJ5TmFtZShhKSB7CiAgICAgICAgaWYgKCF0aGlzLl9ydW50aW1lLklzTG9hZGluZygpKSB7CiAgICAgICAgICAgIHZhciBiID0gdGhpcy5fcnVudGltZS5HZXRMYXlvdXRNYW5hZ2VyKCk7CiAgICAgICAgICAgIGIuSXNQZW5kaW5nQ2hhbmdlTWFpbkxheW91dCgpIHx8IChhID0gYi5HZXRMYXlvdXRCeU5hbWUoYSkpICYmIGIuQ2hhbmdlTWFpbkxheW91dChhKQogICAgICAgIH0KICAgIH0sCiAgICBOZXh0UHJldkxheW91dChhKSB7CiAgICAgICAgaWYgKCF0aGlzLl9ydW50aW1lLklzTG9hZGluZygpKSB7CiAgICAgICAgICAgIHZhciBiID0gdGhpcy5fcnVudGltZS5HZXRMYXlvdXRNYW5hZ2VyKCk7CiAgICAgICAgICAgIGlmICghYi5Jc1BlbmRpbmdDaGFuZ2VNYWluTGF5b3V0KCkpIHsKICAgICAgICAgICAgICAgIHZhciBkID0gYi5HZXRBbGxMYXlvdXRzKCksCiAgICAgICAgICAgICAgICAgICAgYyA9IGQuaW5kZXhPZihiLkdldE1haW5SdW5uaW5nTGF5b3V0KCkpOwogICAgICAgICAgICAgICAgYSAmJiAwID09PSBjIHx8IChhIHx8IGMgIT09IGQubGVuZ3RoIC0gMSkgJiYgYi5DaGFuZ2VNYWluTGF5b3V0KGRbYyArIChhID8gLTEgOiAxKV0pCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9LAogICAgUmVzdGFydExheW91dCgpIHsKICAgICAgICBpZiAoIXRoaXMuX3J1bnRpbWUuSXNMb2FkaW5nKCkpIHsKICAgICAgICAgICAgdmFyIGEgPSB0aGlzLl9ydW50aW1lLkdldExheW91dE1hbmFnZXIoKTsKICAgICAgICAgICAgYS5Jc1BlbmRpbmdDaGFuZ2VNYWluTGF5b3V0KCkgfHwgKGEuQ2hhbmdlTWFpbkxheW91dChhLkdldE1haW5SdW5uaW5nTGF5b3V0KCkpLCB0aGlzLl9ydW50aW1lLkdldEV2ZW50U2hlZXRNYW5hZ2VyKCkuUmVzZXRBbGxHcm91cHNJbml0aWFsQWN0aXZhdGlvbigpKQogICAgICAgIH0KICAgIH0sCiAgICBTZXRMYXllclZpc2libGUoYSwKICAgICAgICBiKSB7CiAgICAgICAgYSAmJiBhLlNldFZpc2libGUoYikKICAgIH0sCiAgICBTZXRMYXllckludGVyYWN0aXZlKGEsIGIpIHsKICAgICAgICBhICYmIGEuU2V0SW50ZXJhY3RpdmUoYikKICAgIH0sCiAgICBTZXRMYXllck9wYWNpdHkoYSwgYikgewogICAgICAgIGEgJiYgYS5TZXRPcGFjaXR5KGIgLyAxMDApCiAgICB9LAogICAgU2V0TGF5ZXJTY2FsZShhLCBiKSB7CiAgICAgICAgYSAmJiBhLlNldE93blNjYWxlKGIpCiAgICB9LAogICAgU2V0TGF5ZXJTY2FsZVJhdGUoYSwgYikgewogICAgICAgIGEgJiYgYS5TZXRTY2FsZVJhdGUoYikKICAgIH0sCiAgICBTZXRMYXllckFuZ2xlKGEsIGIpIHsKICAgICAgICBhICYmIGEuU2V0QW5nbGUoQzMkanNjb21wJDE3Ni50b1JhZGlhbnMoK2IpKQogICAgfSwKICAgIFNldExheWVyU2Nyb2xsKGEsIGIsIGQpIHsKICAgICAgICBhICYmIChhLlNldE93blNjcm9sbFBvc2l0aW9uRW5hYmxlZCghMCksIGEuU2V0U2Nyb2xsWChiKSwgYS5TZXRTY3JvbGxZKGQpKQogICAgfSwKICAgIFJlc3RvcmVMYXllclNjcm9sbChhKSB7CiAgICAgICAgYSAmJiBhLlNldE93blNjcm9sbFBvc2l0aW9uRW5hYmxlZCghMSkKICAgIH0sCiAgICBTZXRMYXllclBhcmFsbGF4KGEsIGIsIGQpIHsKICAgICAgICBhICYmIGEuU2V0UGFyYWxsYXgoYiAvIDEwMCwgZCAvIDEwMCkKICAgIH0sCiAgICBTZXRMYXllclpFbGV2YXRpb24oYSwgYikgewogICAgICAgIGEgJiYKICAgICAgICAgICAgYS5TZXRaRWxldmF0aW9uKCtiKQogICAgfSwKICAgIFNldExheWVyQmFja2dyb3VuZChhLCBiKSB7CiAgICAgICAgYSAmJiAodGVtcENvbG9yJGpzY29tcCQ3LnNldEZyb21SZ2JWYWx1ZShiKSwgdGVtcENvbG9yJGpzY29tcCQ3LmNsYW1wKCksIGEgPSBhLkdldEJhY2tncm91bmRDb2xvcigpLCBhLmVxdWFsc0lnbm9yaW5nQWxwaGEodGVtcENvbG9yJGpzY29tcCQ3KSB8fCAoYS5jb3B5UmdiKHRlbXBDb2xvciRqc2NvbXAkNyksIHRoaXMuVXBkYXRlUmVuZGVyKCkpKQogICAgfSwKICAgIFNldExheWVyVHJhbnNwYXJlbnQoYSwgYikgewogICAgICAgIGEgJiYgYS5TZXRUcmFuc3BhcmVudChiKQogICAgfSwKICAgIFNldExheWVyQmxlbmRNb2RlKGEsIGIpIHsKICAgICAgICBhICYmIGEuU2V0QmxlbmRNb2RlKGIpCiAgICB9LAogICAgU2V0TGF5ZXJFZmZlY3RFbmFibGVkKGEsIGIsIGQpIHsKICAgICAgICBhICYmIChkID0gYS5HZXRFZmZlY3RMaXN0KCkuR2V0RWZmZWN0VHlwZUJ5TmFtZShkKSkgJiYgKGIgPSAxID09PSBiLCBkLklzQWN0aXZlKCkgIT09IGIgJiYgKGQuU2V0QWN0aXZlKGIpLCBhLlVwZGF0ZUFjdGl2ZUVmZmVjdHMoKSwgdGhpcy5fcnVudGltZS5VcGRhdGVSZW5kZXIoKSkpCiAgICB9LAogICAgU2V0TGF5ZXJFZmZlY3RQYXJhbShhLCBiLCBkLCBjKSB7CiAgICAgICAgaWYgKGEgJiYgKGEgPSBhLkdldEVmZmVjdExpc3QoKSwgYiA9IGEuR2V0RWZmZWN0VHlwZUJ5TmFtZShiKSkpIHsKICAgICAgICAgICAgZCA9IE1hdGguZmxvb3IoZCk7CiAgICAgICAgICAgIHZhciBlID0gYi5HZXRTaGFkZXJQcm9ncmFtKCkuR2V0UGFyYW1ldGVyVHlwZShkKTsKICAgICAgICAgICAgZSAmJiAoImNvbG9yIiA9PT0gZSA/ICh0ZW1wQ29sb3IkanNjb21wJDcuc2V0RnJvbVJnYlZhbHVlKGMpLCBjID0gdGVtcENvbG9yJGpzY29tcCQ3KSA6ICJwZXJjZW50IiA9PT0gZSAmJiAoYyAvPSAxMDApLCBhLlNldEVmZmVjdFBhcmFtZXRlcihiLkdldEluZGV4KCksIGQsIGMpICYmIGIuSXNBY3RpdmUoKSAmJiB0aGlzLl9ydW50aW1lLlVwZGF0ZVJlbmRlcigpKQogICAgICAgIH0KICAgIH0sCiAgICBTZXRMYXllckZvcmNlT3duVGV4dHVyZShhLCBiKSB7CiAgICAgICAgYSAmJiBhLlNldEZvcmNlT3duVGV4dHVyZShiKQogICAgfSwKICAgIFNldExheW91dFNjYWxlKGEpIHsKICAgICAgICB0aGlzLl9ydW50aW1lLkdldEN1cnJlbnRMYXlvdXQoKS5TZXRTY2FsZSgrYSkKICAgIH0sCiAgICBTZXRMYXlvdXRBbmdsZShhKSB7CiAgICAgICAgdGhpcy5fcnVudGltZS5HZXRDdXJyZW50TGF5b3V0KCkuU2V0QW5nbGUoQzMkanNjb21wJDE3Ni50b1JhZGlhbnMoK2EpKQogICAgfSwKICAgIFNldExheW91dEVmZmVjdEVuYWJsZWQoYSwgYikgewogICAgICAgIGNvbnN0IGQgPSB0aGlzLl9ydW50aW1lLkdldEN1cnJlbnRMYXlvdXQoKTsKICAgICAgICBpZiAoYiA9IGQuR2V0RWZmZWN0TGlzdCgpLkdldEVmZmVjdFR5cGVCeU5hbWUoYikpIGEgPSAxID09PSBhLCBiLklzQWN0aXZlKCkgIT09IGEgJiYgKGIuU2V0QWN0aXZlKGEpLCBkLlVwZGF0ZUFjdGl2ZUVmZmVjdHMoKSwgdGhpcy5fcnVudGltZS5VcGRhdGVSZW5kZXIoKSkKICAgIH0sCiAgICBTZXRMYXlvdXRFZmZlY3RQYXJhbShhLCBiLCBkKSB7CiAgICAgICAgY29uc3QgYyA9IHRoaXMuX3J1bnRpbWUuR2V0Q3VycmVudExheW91dCgpLkdldEVmZmVjdExpc3QoKTsKICAgICAgICBpZiAoYSA9IGMuR2V0RWZmZWN0VHlwZUJ5TmFtZShhKSkgewogICAgICAgICAgICBiID0gTWF0aC5mbG9vcihiKTsKICAgICAgICAgICAgdmFyIGUgPSBhLkdldFNoYWRlclByb2dyYW0oKS5HZXRQYXJhbWV0ZXJUeXBlKGIpOwogICAgICAgICAgICBlICYmICgiY29sb3IiID09PSBlID8gKHRlbXBDb2xvciRqc2NvbXAkNy5zZXRGcm9tUmdiVmFsdWUoZCksIGQgPSB0ZW1wQ29sb3IkanNjb21wJDcpIDogInBlcmNlbnQiID09PSBlICYmIChkIC89IDEwMCksIGMuU2V0RWZmZWN0UGFyYW1ldGVyKGEuR2V0SW5kZXgoKSwKICAgICAgICAgICAgICAgIGIsIGQpICYmIGEuSXNBY3RpdmUoKSAmJiB0aGlzLl9ydW50aW1lLlVwZGF0ZVJlbmRlcigpKQogICAgICAgIH0KICAgIH0sCiAgICBTZXRMYXlvdXRWYW5pc2hpbmdQb2ludChhLCBiKSB7CiAgICAgICAgdGhpcy5fcnVudGltZS5HZXRDdXJyZW50TGF5b3V0KCkuU2V0VmFuaXNoaW5nUG9pbnRYWShhIC8gMTAwLCBiIC8gMTAwKQogICAgfSwKICAgIFNldExheW91dFByb2plY3Rpb24oYSkgewogICAgICAgIGNvbnN0IGIgPSB0aGlzLl9ydW50aW1lLkdldEN1cnJlbnRMYXlvdXQoKTsKICAgICAgICAwID09PSBhID8gYi5TZXRQZXJzcGVjdGl2ZVByb2plY3Rpb24oKSA6IGIuU2V0T3J0aG9ncmFwaGljUHJvamVjdGlvbigpCiAgICB9LAogICAgU2Nyb2xsWChhKSB7CiAgICAgICAgdGhpcy5fcnVudGltZS5HZXRDdXJyZW50TGF5b3V0KCkuU2V0U2Nyb2xsWChhKQogICAgfSwKICAgIFNjcm9sbFkoYSkgewogICAgICAgIHRoaXMuX3J1bnRpbWUuR2V0Q3VycmVudExheW91dCgpLlNldFNjcm9sbFkoYSkKICAgIH0sCiAgICBTY3JvbGwoYSwgYikgewogICAgICAgIGNvbnN0IGQgPSB0aGlzLl9ydW50aW1lLkdldEN1cnJlbnRMYXlvdXQoKTsKICAgICAgICBkLlNldFNjcm9sbFgoYSk7CiAgICAgICAgZC5TZXRTY3JvbGxZKGIpCiAgICB9LAogICAgU2Nyb2xsVG9PYmplY3QoYSkgewogICAgICAgIGlmIChhICYmCiAgICAgICAgICAgIChhID0gYS5HZXRGaXJzdFBpY2tlZCgpKSAmJiAoYSA9IGEuR2V0V29ybGRJbmZvKCkpKSB7CiAgICAgICAgICAgIHZhciBiID0gdGhpcy5fcnVudGltZS5HZXRDdXJyZW50TGF5b3V0KCk7CiAgICAgICAgICAgIGIuU2V0U2Nyb2xsWChhLkdldFgoKSk7CiAgICAgICAgICAgIGIuU2V0U2Nyb2xsWShhLkdldFkoKSkKICAgICAgICB9CiAgICB9LAogICAgYXN5bmMgTG9hZE9iamVjdFRleHR1cmVzKGEpIHsKICAgICAgICBjb25zdCBiID0gdGhpcy5fcnVudGltZS5HZXRNYWluUnVubmluZ0xheW91dCgpOwogICAgICAgIGIgJiYgYSAmJiAhdGhpcy5fcnVudGltZS5Jc0xvYWRpbmcoKSAmJiAoYSA9IGEuSXNGYW1pbHkoKSA/IGEuR2V0RmFtaWx5TWVtYmVycygpIDogW2FdLCBhd2FpdCB0aGlzLl9Mb2FkVGV4dHVyZXNGb3JPYmplY3RDbGFzc2VzKGIsIGEpKQogICAgfSwKICAgIGFzeW5jIExvYWRPYmplY3RUZXh0dXJlc0J5TmFtZShhKSB7CiAgICAgICAgYXdhaXQgQzMkanNjb21wJDE3Ni5QbHVnaW5zLlN5c3RlbS5BY3RzLkxvYWRPYmplY3RUZXh0dXJlcy5jYWxsKHRoaXMsIHRoaXMuX3J1bnRpbWUuR2V0T2JqZWN0Q2xhc3NCeU5hbWUoYSkpCiAgICB9LAogICAgVW5sb2FkT2JqZWN0VGV4dHVyZXMoYSkgewogICAgICAgIGNvbnN0IGIgPQogICAgICAgICAgICB0aGlzLl9ydW50aW1lLkdldE1haW5SdW5uaW5nTGF5b3V0KCk7CiAgICAgICAgYiAmJiBhICYmIChhID0gYS5Jc0ZhbWlseSgpID8gYS5HZXRGYW1pbHlNZW1iZXJzKCkgOiBbYV0sIHRoaXMuX1VubG9hZFRleHR1cmVzRm9yT2JqZWN0Q2xhc3NlcyhiLCBhKSkKICAgIH0sCiAgICBVbmxvYWRPYmplY3RUZXh0dXJlc0J5TmFtZShhKSB7CiAgICAgICAgQzMkanNjb21wJDE3Ni5QbHVnaW5zLlN5c3RlbS5BY3RzLlVubG9hZE9iamVjdFRleHR1cmVzLmNhbGwodGhpcywgdGhpcy5fcnVudGltZS5HZXRPYmplY3RDbGFzc0J5TmFtZShhKSkKICAgIH0sCiAgICBVbmxvYWRVbnVzZWRUZXh0dXJlcygpIHsKICAgICAgICBjb25zdCBhID0gdGhpcy5fcnVudGltZS5HZXRNYWluUnVubmluZ0xheW91dCgpOwogICAgICAgIGlmIChhKSB7CiAgICAgICAgICAgIHZhciBiID0gYS5fR2V0VGV4dHVyZUxvYWRlZE9iamVjdFR5cGVzKCk7CiAgICAgICAgICAgIHRoaXMuX1VubG9hZFRleHR1cmVzRm9yT2JqZWN0Q2xhc3NlcyhhLCBiKQogICAgICAgIH0KICAgIH0sCiAgICBhc3luYyBMb2FkTGF5b3V0VGV4dHVyZXMoYSkgewogICAgICAgIGNvbnN0IGIgPSB0aGlzLl9ydW50aW1lLkdldE1haW5SdW5uaW5nTGF5b3V0KCk7CiAgICAgICAgYSAmJiBiICYmICF0aGlzLl9ydW50aW1lLklzTG9hZGluZygpICYmCiAgICAgICAgICAgIGF3YWl0IHRoaXMuX0xvYWRUZXh0dXJlc0Zvck9iamVjdENsYXNzZXMoYiwgYS5fR2V0SW5pdGlhbE9iamVjdENsYXNzZXMoKSkKICAgIH0sCiAgICBhc3luYyBMb2FkTGF5b3V0VGV4dHVyZXNCeU5hbWUoYSkgewogICAgICAgIGNvbnN0IGIgPSB0aGlzLl9ydW50aW1lLkdldE1haW5SdW5uaW5nTGF5b3V0KCk7CiAgICAgICAgKGEgPSB0aGlzLl9ydW50aW1lLkdldExheW91dE1hbmFnZXIoKS5HZXRMYXlvdXRCeU5hbWUoYSkpICYmIGIgJiYgIXRoaXMuX3J1bnRpbWUuSXNMb2FkaW5nKCkgJiYgYXdhaXQgdGhpcy5fTG9hZFRleHR1cmVzRm9yT2JqZWN0Q2xhc3NlcyhiLCBhLl9HZXRJbml0aWFsT2JqZWN0Q2xhc3NlcygpKQogICAgfSwKICAgIFNldEZ1bmN0aW9uUmV0dXJuVmFsdWUoYSkgewogICAgICAgIGNvbnN0IGIgPSB0aGlzLl9ldmVudFN0YWNrLkdldEN1cnJlbnRFeHBGdW5jU3RhY2tGcmFtZSgpOwogICAgICAgIGlmIChiKSBzd2l0Y2ggKGIuR2V0RnVuY3Rpb25SZXR1cm5UeXBlKCkpIHsKICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgIm51bWJlciIgPT09IHR5cGVvZiBhICYmIGIuU2V0RnVuY3Rpb25SZXR1cm5WYWx1ZShhKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICAic3RyaW5nIiA9PT0KICAgICAgICAgICAgICAgIHR5cGVvZiBhICYmIGIuU2V0RnVuY3Rpb25SZXR1cm5WYWx1ZShhKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICBiLlNldEZ1bmN0aW9uUmV0dXJuVmFsdWUoYSkKICAgICAgICB9CiAgICB9LAogICAgTWFwRnVuY3Rpb24oYSwgYiwgZCkgewogICAgICAgIHZhciBjID0gdGhpcy5fR2V0RnVuY3Rpb25NYXAoYS50b0xvd2VyQ2FzZSgpLCAhMCk7CiAgICAgICAgY29uc3QgZSA9IGMuc3RyTWFwLAogICAgICAgICAgICBnID0gYi50b0xvd2VyQ2FzZSgpOwogICAgICAgIGUuaGFzKGcpICYmIGNvbnNvbGUud2FybihgW0NvbnN0cnVjdF0gRnVuY3Rpb24gbWFwICcke2F9JyBzdHJpbmcgJyR7Yn0nIGFscmVhZHkgaW4gbWFwOyBvdmVyd3JpdGluZyBlbnRyeWApOwogICAgICAgIGlmIChjID0gQzMkanNjb21wJDE3Ni5maXJzdChlLnZhbHVlcygpKSB8fCBjLmRlZmF1bHRGdW5jKSB7CiAgICAgICAgICAgIGMgPSAwICE9PSBjLkdldFJldHVyblR5cGUoKTsKICAgICAgICAgICAgY29uc3QgayA9IDAgIT09IGQuR2V0UmV0dXJuVHlwZSgpOwogICAgICAgICAgICBpZiAoYyAhPT0gaykgewogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihgW0NvbnN0cnVjdF0gRnVuY3Rpb24gbWFwICcke2F9JyBzdHJpbmcgJyR7Yn0nIGZ1bmN0aW9uIHJldHVybiB0eXBlIG5vdCBjb21wYXRpYmxlIHdpdGggb3RoZXIgZnVuY3Rpb25zIGluIHRoZSBtYXA7IGVudHJ5IGlnbm9yZWRgKTsKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGUuc2V0KGcsIGQpCiAgICB9LAogICAgTWFwRnVuY3Rpb25EZWZhdWx0KGEsIGIpIHsKICAgICAgICBjb25zdCBkID0gdGhpcy5fR2V0RnVuY3Rpb25NYXAoYS50b0xvd2VyQ2FzZSgpLCAhMCk7CiAgICAgICAgZC5kZWZhdWx0RnVuYyAmJiBjb25zb2xlLndhcm4oYFtDb25zdHJ1Y3RdIEZ1bmN0aW9uIG1hcCAnJHthfScgYWxyZWFkeSBoYXMgYSBkZWZhdWx0OyBvdmVyd3JpdGluZyBlbnRyeWApOwogICAgICAgIHZhciBjID0gQzMkanNjb21wJDE3Ni5maXJzdChkLnN0ck1hcC52YWx1ZXMoKSkgfHwgZC5kZWZhdWx0RnVuYzsKICAgICAgICBpZiAoYykgewogICAgICAgICAgICBjID0gMCAhPT0gYy5HZXRSZXR1cm5UeXBlKCk7CiAgICAgICAgICAgIGNvbnN0IGUgPSAwICE9PSBiLkdldFJldHVyblR5cGUoKTsKICAgICAgICAgICAgaWYgKGMgIT09IGUpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYFtDb25zdHJ1Y3RdIEZ1bmN0aW9uIG1hcCAnJHthfScgZGVmYXVsdDogZnVuY3Rpb24gcmV0dXJuIHR5cGUgbm90IGNvbXBhdGlibGUgd2l0aCBvdGhlciBmdW5jdGlvbnMgaW4gdGhlIG1hcDsgZW50cnkgaWdub3JlZGApOwogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZC5kZWZhdWx0RnVuYyA9IGIKICAgIH0sCiAgICBDYWxsTWFwcGVkRnVuY3Rpb24oYSwKICAgICAgICBiLCBkKSB7CiAgICAgICAgZCA9IE1hdGguZmxvb3IoZCk7CiAgICAgICAgdmFyIGMgPSB0aGlzLl9HZXRGdW5jdGlvbk1hcChhLnRvTG93ZXJDYXNlKCksICExKTsKICAgICAgICBpZiAoYykgewogICAgICAgICAgICB2YXIgZSA9IGMuc3RyTWFwLmdldChiLnRvTG93ZXJDYXNlKCkpOwogICAgICAgICAgICBpZiAoIWUpCiAgICAgICAgICAgICAgICBpZiAoYy5kZWZhdWx0RnVuYykgZSA9IGMuZGVmYXVsdEZ1bmMsIGQgPSAwOwogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKGBbQ29uc3RydWN0XSBDYWxsIG1hcHBlZCBmdW5jdGlvbjogbm8gZnVuY3Rpb24gYXNzb2NpYXRlZCB3aXRoIG1hcCAnJHthfScgc3RyaW5nICcke2J9JzsgY2FsbCBpZ25vcmVkIChjb25zaWRlciBzZXR0aW5nIGEgZGVmYXVsdClgKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGUuSXNFbmFibGVkKCkpCiAgICAgICAgICAgICAgICBpZiAoMCAhPT0gZS5HZXRSZXR1cm5UeXBlKCkpIGNvbnNvbGUud2FybihgW0NvbnN0cnVjdF0gQ2FsbCBtYXBwZWQgZnVuY3Rpb246IG1hcCAnJHthfScgc3RyaW5nICcke2J9JyBoYXMgYSByZXR1cm4gdHlwZSBzbyBjYW5ub3QgYmUgY2FsbGVkYCk7CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBhID0gdGhpcy5fcnVudGltZTsKICAgICAgICAgICAgICAgICAgICBiID0gYS5HZXRFdmVudFNoZWV0TWFuYWdlcigpOwogICAgICAgICAgICAgICAgICAgIHZhciBnID0gYi5HZXRDdXJyZW50RXZlbnQoKTsKICAgICAgICAgICAgICAgICAgICBjID0gZy5HZXRTb2xNb2RpZmllcnNJbmNsdWRpbmdQYXJlbnRzKCk7CiAgICAgICAgICAgICAgICAgICAgdmFyIGsgPSAwIDwgYy5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgayAmJiAoZS5Jc0NvcHlQaWNrZWQoKSA/IGIuUHVzaENvcHlTb2woYykgOiBiLlB1c2hDbGVhblNvbChjKSk7CiAgICAgICAgICAgICAgICAgICAgdmFyIG0gPSBbXTsKICAgICAgICAgICAgICAgICAgICBpZiAoZyA9IGIuRmluZEZpcnN0RnVuY3Rpb25CbG9ja1BhcmVudChnKSkgewogICAgICAgICAgICAgICAgICAgICAgICBnID0gZy5HZXRGdW5jdGlvblBhcmFtZXRlcnMoKTsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgbiA9IGQsIHEgPSBnLmxlbmd0aDsgbiA8IHE7ICsrbikgbS5wdXNoKGdbbl0uR2V0VmFsdWUoKSkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZCA9IGUuR2V0RnVuY3Rpb25QYXJhbWV0ZXJzKCk7CiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgbiA9IG0ubGVuZ3RoLCBxID0gZC5sZW5ndGg7IG4gPCBxOyArK24pIG0ucHVzaChkW25dLkdldEluaXRpYWxWYWx1ZSgpKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYS5Jc0RlYnVnZ2luZygpID8gdGhpcy5fRGVidWdEb0NhbGxNYXBwZWRGdW5jdGlvbihiLCBlLCBtLCBrLCBjKSA6IHRoaXMuX0RvQ2FsbE1hcHBlZEZ1bmN0aW9uKGIsIGUsIG0sIGssIGMpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGNvbnNvbGUud2FybihgW0NvbnN0cnVjdF0gQ2FsbCBtYXBwZWQgZnVuY3Rpb246IG1hcCBuYW1lICcke2F9JyBub3QgZm91bmQ7IGNhbGwgaWdub3JlZGApCiAgICB9Cn07CmNvbnN0IEMzJGpzY29tcCQxNzcgPSBzZWxmLkMzOwpDMyRqc2NvbXAkMTc3LlBsdWdpbnMuU3lzdGVtLkV4cHMgPSB7CiAgICBpbnQ6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAic3RyaW5nIiA9PT0gdHlwZW9mIGEgJiYgKGEgPSBwYXJzZUludChhLCAxMCksIGlzTmFOKGEpICYmIChhID0gMCkpOwogICAgICAgIHJldHVybiBNYXRoLmZsb29yKGEpCiAgICB9LAogICAgZmxvYXQ6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAic3RyaW5nIiA9PT0gdHlwZW9mIGEgJiYgKGEgPSBwYXJzZUZsb2F0KGEpLCBpc05hTihhKSAmJiAoYSA9IDApKTsKICAgICAgICByZXR1cm4gYQogICAgfSwKICAgIHN0cihhKSB7CiAgICAgICAgcmV0dXJuIGEudG9TdHJpbmcoKQogICAgfSwKICAgIGxlbihhKSB7CiAgICAgICAgcmV0dXJuICJzdHJpbmciID09PSB0eXBlb2YgYSA/IGEubGVuZ3RoIDogMAogICAgfSwKICAgIHJhbmRvbShhLCBiKSB7CiAgICAgICAgcmV0dXJuICJ1bmRlZmluZWQiID09PSB0eXBlb2YgYiA/IHRoaXMuX3J1bnRpbWUuUmFuZG9tKCkgKiBhIDogdGhpcy5fcnVudGltZS5SYW5kb20oKSAqIChiIC0gYSkgKyBhCiAgICB9LAogICAgY2hvb3NlKC4uLmEpIHsKICAgICAgICBjb25zdCBiID0gTWF0aC5mbG9vcih0aGlzLl9ydW50aW1lLlJhbmRvbSgpICogYS5sZW5ndGgpOwogICAgICAgIHJldHVybiBhW2JdCiAgICB9LAogICAgY2hvb3NlaW5kZXgoYSwgLi4uYikgewogICAgICAgICJudW1iZXIiICE9PSB0eXBlb2YgYSAmJgogICAgICAgICAgICAoYSA9IDApOwogICAgICAgIGEgPSBDMyRqc2NvbXAkMTc3LmNsYW1wKE1hdGguZmxvb3IoYSksIDAsIGIubGVuZ3RoIC0gMSk7CiAgICAgICAgcmV0dXJuIGJbYV0KICAgIH0sCiAgICBwaSgpIHsKICAgICAgICByZXR1cm4gTWF0aC5QSQogICAgfSwKICAgIGluZmluaXR5KCkgewogICAgICAgIHJldHVybiBJbmZpbml0eQogICAgfSwKICAgIHNxcnQoYSkgewogICAgICAgIHJldHVybiBNYXRoLnNxcnQoYSkKICAgIH0sCiAgICBhYnMoYSkgewogICAgICAgIHJldHVybiBNYXRoLmFicyhhKQogICAgfSwKICAgIHJvdW5kKGEpIHsKICAgICAgICByZXR1cm4gTWF0aC5yb3VuZChhKQogICAgfSwKICAgIHJvdW5kdG9kcChhLCBiKSB7CiAgICAgICAgYiA9IE1hdGgubWF4KE1hdGguZmxvb3IoYiksIDApOwogICAgICAgIGIgPSBNYXRoLnBvdygxMCwgYik7CiAgICAgICAgcmV0dXJuIE1hdGgucm91bmQoKGEgKyBOdW1iZXIuRVBTSUxPTikgKiBiKSAvIGIKICAgIH0sCiAgICBmbG9vcihhKSB7CiAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IoYSkKICAgIH0sCiAgICBjZWlsKGEpIHsKICAgICAgICByZXR1cm4gTWF0aC5jZWlsKGEpCiAgICB9LAogICAgc2lnbihhKSB7CiAgICAgICAgcmV0dXJuIE1hdGguc2lnbihhKQogICAgfSwKICAgIHNpbihhKSB7CiAgICAgICAgcmV0dXJuIE1hdGguc2luKEMzJGpzY29tcCQxNzcudG9SYWRpYW5zKGEpKQogICAgfSwKICAgIGNvcyhhKSB7CiAgICAgICAgcmV0dXJuIE1hdGguY29zKEMzJGpzY29tcCQxNzcudG9SYWRpYW5zKGEpKQogICAgfSwKICAgIHRhbihhKSB7CiAgICAgICAgcmV0dXJuIE1hdGgudGFuKEMzJGpzY29tcCQxNzcudG9SYWRpYW5zKGEpKQogICAgfSwKICAgIGFzaW4oYSkgewogICAgICAgIHJldHVybiBDMyRqc2NvbXAkMTc3LnRvRGVncmVlcyhNYXRoLmFzaW4oYSkpCiAgICB9LAogICAgYWNvcyhhKSB7CiAgICAgICAgcmV0dXJuIEMzJGpzY29tcCQxNzcudG9EZWdyZWVzKE1hdGguYWNvcyhhKSkKICAgIH0sCiAgICBhdGFuKGEpIHsKICAgICAgICByZXR1cm4gQzMkanNjb21wJDE3Ny50b0RlZ3JlZXMoTWF0aC5hdGFuKGEpKQogICAgfSwKICAgIGV4cChhKSB7CiAgICAgICAgcmV0dXJuIE1hdGguZXhwKGEpCiAgICB9LAogICAgbG4oYSkgewogICAgICAgIHJldHVybiBNYXRoLmxvZyhhKQogICAgfSwKICAgIGxvZzEwKGEpIHsKICAgICAgICByZXR1cm4gTWF0aC5sb2coYSkgLyBNYXRoLkxOMTAKICAgIH0sCiAgICBtYXgoLi4uYSkgewogICAgICAgIGxldCBiID0gYVswXTsKICAgICAgICAibnVtYmVyIiAhPT0gdHlwZW9mIGIgJiYgKGIgPSAwKTsKICAgICAgICBmb3IgKGxldCBkID0gMSwgYyA9IGEubGVuZ3RoOyBkIDwgYzsgKytkKSB7CiAgICAgICAgICAgIGxldCBlID0gYVtkXTsKICAgICAgICAgICAgIm51bWJlciIgPT09IHR5cGVvZiBlICYmIGIgPCBlICYmIChiID0gZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGIKICAgIH0sCiAgICBtaW4oLi4uYSkgewogICAgICAgIGxldCBiID0gYVswXTsKICAgICAgICAibnVtYmVyIiAhPT0gdHlwZW9mIGIgJiYgKGIgPSAwKTsKICAgICAgICBmb3IgKGxldCBkID0gMSwgYyA9CiAgICAgICAgICAgICAgICBhLmxlbmd0aDsgZCA8IGM7ICsrZCkgewogICAgICAgICAgICBsZXQgZSA9IGFbZF07CiAgICAgICAgICAgICJudW1iZXIiID09PSB0eXBlb2YgZSAmJiBiID4gZSAmJiAoYiA9IGUpCiAgICAgICAgfQogICAgICAgIHJldHVybiBiCiAgICB9LAogICAgY2xhbXAoYSwgYiwgZCkgewogICAgICAgIHJldHVybiBDMyRqc2NvbXAkMTc3LmNsYW1wKGEsIGIsIGQpCiAgICB9LAogICAgZGlzdGFuY2UoYSwgYiwgZCwgYykgewogICAgICAgIHJldHVybiBDMyRqc2NvbXAkMTc3LmRpc3RhbmNlVG8oYSwgYiwgZCwgYykKICAgIH0sCiAgICBhbmdsZShhLCBiLCBkLCBjKSB7CiAgICAgICAgcmV0dXJuIEMzJGpzY29tcCQxNzcudG9EZWdyZWVzKEMzJGpzY29tcCQxNzcuYW5nbGVUbyhhLCBiLCBkLCBjKSkKICAgIH0sCiAgICBsZXJwKGEsIGIsIGQpIHsKICAgICAgICByZXR1cm4gQzMkanNjb21wJDE3Ny5sZXJwKGEsIGIsIGQpCiAgICB9LAogICAgdW5sZXJwKGEsIGIsIGQpIHsKICAgICAgICByZXR1cm4gQzMkanNjb21wJDE3Ny51bmxlcnAoYSwgYiwgZCkKICAgIH0sCiAgICBxYXJwKGEsIGIsIGQsIGMpIHsKICAgICAgICByZXR1cm4gQzMkanNjb21wJDE3Ny5xYXJwKGEsIGIsIGQsIGMpCiAgICB9LAogICAgY3ViaWMoYSwgYiwgZCwgYywgZSkgewogICAgICAgIHJldHVybiBDMyRqc2NvbXAkMTc3LmN1YmljKGEsIGIsIGQsIGMsIGUpCiAgICB9LAogICAgY29zcChhLCBiLCBkKSB7CiAgICAgICAgcmV0dXJuIEMzJGpzY29tcCQxNzcuY29zcChhLCBiLAogICAgICAgICAgICBkKQogICAgfSwKICAgIGFuZ2xlZGlmZihhLCBiKSB7CiAgICAgICAgcmV0dXJuIEMzJGpzY29tcCQxNzcudG9EZWdyZWVzKEMzJGpzY29tcCQxNzcuYW5nbGVEaWZmKEMzJGpzY29tcCQxNzcudG9SYWRpYW5zKGEpLCBDMyRqc2NvbXAkMTc3LnRvUmFkaWFucyhiKSkpCiAgICB9LAogICAgYW5nbGVsZXJwKGEsIGIsIGQpIHsKICAgICAgICByZXR1cm4gQzMkanNjb21wJDE3Ny50b0RlZ3JlZXMoQzMkanNjb21wJDE3Ny5hbmdsZUxlcnAoQzMkanNjb21wJDE3Ny50b1JhZGlhbnMoYSksIEMzJGpzY29tcCQxNzcudG9SYWRpYW5zKGIpLCBkKSkKICAgIH0sCiAgICBhbmdsZXJvdGF0ZShhLCBiLCBkKSB7CiAgICAgICAgcmV0dXJuIEMzJGpzY29tcCQxNzcudG9EZWdyZWVzKEMzJGpzY29tcCQxNzcuYW5nbGVSb3RhdGUoQzMkanNjb21wJDE3Ny50b1JhZGlhbnMoYSksIEMzJGpzY29tcCQxNzcudG9SYWRpYW5zKGIpLCBDMyRqc2NvbXAkMTc3LnRvUmFkaWFucyhkKSkpCiAgICB9LAogICAgc2V0Yml0KGEsIGIsIGQpIHsKICAgICAgICBiIHw9IDA7CiAgICAgICAgcmV0dXJuIChhIHwgMCkgJiB+KDEgPDwgYikgfCAoMCAhPT0gZCA/IDEgOiAwKSA8PCBiCiAgICB9LAogICAgdG9nZ2xlYml0KGEsIGIpIHsKICAgICAgICByZXR1cm4gKGEgfAogICAgICAgICAgICAwKSBeIDEgPDwgKGIgfCAwKQogICAgfSwKICAgIGdldGJpdChhLCBiKSB7CiAgICAgICAgcmV0dXJuIChhIHwgMCkgJiAxIDw8IChiIHwgMCkgPyAxIDogMAogICAgfSwKICAgIG5ld2xpbmUoKSB7CiAgICAgICAgcmV0dXJuICJcbiIKICAgIH0sCiAgICB1cHBlcmNhc2UoYSkgewogICAgICAgIHJldHVybiAic3RyaW5nIiA9PT0gdHlwZW9mIGEgPyBhLnRvVXBwZXJDYXNlKCkgOiAiIgogICAgfSwKICAgIGxvd2VyY2FzZShhKSB7CiAgICAgICAgcmV0dXJuICJzdHJpbmciID09PSB0eXBlb2YgYSA/IGEudG9Mb3dlckNhc2UoKSA6ICIiCiAgICB9LAogICAgbGVmdChhLCBiKSB7CiAgICAgICAgcmV0dXJuICJzdHJpbmciID09PSB0eXBlb2YgYSA/IGEuc3Vic3RyKDAsIGIpIDogIiIKICAgIH0sCiAgICBtaWQoYSwgYiwgZCkgewogICAgICAgIHJldHVybiAic3RyaW5nIiAhPT0gdHlwZW9mIGEgPyAiIiA6IDAgPiBkID8gYS5zdWJzdHIoYikgOiBhLnN1YnN0cihiLCBkKQogICAgfSwKICAgIHJpZ2h0KGEsIGIpIHsKICAgICAgICByZXR1cm4gInN0cmluZyIgPT09IHR5cGVvZiBhID8gYS5zdWJzdHIoTWF0aC5tYXgoYS5sZW5ndGggLSBiLCAwKSkgOiAiIgogICAgfSwKICAgIHRyaW0oYSkgewogICAgICAgIHJldHVybiAic3RyaW5nIiA9PT0gdHlwZW9mIGEgPyBhLnRyaW0oKSA6ICIiCiAgICB9LAogICAgdG9rZW5hdChhLCBiLCBkKSB7CiAgICAgICAgaWYgKCJzdHJpbmciICE9PSB0eXBlb2YgYSB8fCAic3RyaW5nIiAhPT0gdHlwZW9mIGQpIHJldHVybiAiIjsKICAgICAgICBhID0gYS5zcGxpdChkKTsKICAgICAgICBiID0gTWF0aC5mbG9vcihiKTsKICAgICAgICByZXR1cm4gMCA+IGIgfHwgYiA+PSBhLmxlbmd0aCA/ICIiIDogYVtiXQogICAgfSwKICAgIHRva2VuY291bnQoYSwgYikgewogICAgICAgIHJldHVybiAic3RyaW5nIiA9PT0gdHlwZW9mIGEgJiYgInN0cmluZyIgPT09IHR5cGVvZiBiICYmIGEubGVuZ3RoID8gYS5zcGxpdChiKS5sZW5ndGggOiAwCiAgICB9LAogICAgZmluZChhLCBiKSB7CiAgICAgICAgcmV0dXJuICJzdHJpbmciID09PSB0eXBlb2YgYSAmJiAic3RyaW5nIiA9PT0gdHlwZW9mIGIgPyBhLnNlYXJjaChuZXcgUmVnRXhwKEMzJGpzY29tcCQxNzcuRXNjYXBlUmVnZXgoYiksICJpIikpIDogLTEKICAgIH0sCiAgICBmaW5kY2FzZShhLCBiKSB7CiAgICAgICAgcmV0dXJuICJzdHJpbmciID09PSB0eXBlb2YgYSAmJiAic3RyaW5nIiA9PT0gdHlwZW9mIGIgPyBhLnNlYXJjaChuZXcgUmVnRXhwKEMzJGpzY29tcCQxNzcuRXNjYXBlUmVnZXgoYiksICIiKSkgOiAtMQogICAgfSwKICAgIHJlcGxhY2UoYSwgYiwgZCkgewogICAgICAgIHJldHVybiAic3RyaW5nIiA9PT0gdHlwZW9mIGEgJiYgInN0cmluZyIgPT09IHR5cGVvZiBiICYmICJzdHJpbmciID09PSB0eXBlb2YgZCA/IGEucmVwbGFjZShuZXcgUmVnRXhwKEMzJGpzY29tcCQxNzcuRXNjYXBlUmVnZXgoYiksCiAgICAgICAgICAgICJnaSIpLCBkKSA6ICJzdHJpbmciID09PSB0eXBlb2YgYSA/IGEgOiAiIgogICAgfSwKICAgIHJlZ2V4c2VhcmNoKGEsIGIsIGQpIHsKICAgICAgICBiID0gdGhpcy5HZXRSZWdleChiLCBkKTsKICAgICAgICByZXR1cm4gYSA/IGEuc2VhcmNoKGIpIDogLTEKICAgIH0sCiAgICByZWdleHJlcGxhY2UoYSwgYiwgZCwgYykgewogICAgICAgIGIgPSB0aGlzLkdldFJlZ2V4KGIsIGQpOwogICAgICAgIHJldHVybiBhID8gYS5yZXBsYWNlKGIsIGMpIDogIiIKICAgIH0sCiAgICByZWdleG1hdGNoY291bnQoYSwgYiwgZCkgewogICAgICAgIHJldHVybiAoYSA9IHRoaXMuR2V0UmVnZXhNYXRjaGVzKGEudG9TdHJpbmcoKSwgYiwgZCkpID8gYS5sZW5ndGggOiAwCiAgICB9LAogICAgcmVnZXhtYXRjaGF0KGEsIGIsIGQsIGMpIHsKICAgICAgICBjID0gTWF0aC5mbG9vcihjKTsKICAgICAgICBhID0gdGhpcy5HZXRSZWdleE1hdGNoZXMoYS50b1N0cmluZygpLCBiLCBkKTsKICAgICAgICByZXR1cm4gIWEgfHwgMCA+IGMgfHwgYyA+PSBhLmxlbmd0aCA/ICIiIDogYVtjXQogICAgfSwKICAgIHplcm9wYWQoYSwgYikgewogICAgICAgIGxldCBkID0gMCA+IGEgPyAiLSIgOiAiIjsKICAgICAgICAwID4gYSAmJiAoYSA9IC1hKTsKICAgICAgICBkICs9ICIwIi5yZXBlYXQoTWF0aC5tYXgoYiAtIGEudG9TdHJpbmcoKS5sZW5ndGgsIDApKTsKICAgICAgICByZXR1cm4gZCArIGEudG9TdHJpbmcoKQogICAgfSwKICAgIHVybGVuY29kZShhKSB7CiAgICAgICAgcmV0dXJuIGVuY29kZVVSSUNvbXBvbmVudChhKQogICAgfSwKICAgIHVybGRlY29kZShhKSB7CiAgICAgICAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChhKQogICAgfSwKICAgIGR0KCkgewogICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lLl9HZXREdEZhc3QoKQogICAgfSwKICAgIHRpbWVzY2FsZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcnVudGltZS5HZXRUaW1lU2NhbGUoKQogICAgfSwKICAgIHdhbGxjbG9ja3RpbWUoKSB7CiAgICAgICAgcmV0dXJuIChEYXRlLm5vdygpIC0gdGhpcy5fcnVudGltZS5HZXRTdGFydFRpbWUoKSkgLyAxRTMKICAgIH0sCiAgICB1bml4dGltZSgpIHsKICAgICAgICByZXR1cm4gRGF0ZS5ub3coKQogICAgfSwKICAgIHRpbWUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUuR2V0R2FtZVRpbWUoKQogICAgfSwKICAgIHRpY2tjb3VudCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcnVudGltZS5HZXRUaWNrQ291bnQoKQogICAgfSwKICAgIG9iamVjdGNvdW50KCkgewogICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lLkdldE9iamVjdENvdW50KCkKICAgIH0sCiAgICBmcHMoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUuR2V0RlBTKCkKICAgIH0sCiAgICBjcHV1dGlsaXNhdGlvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcnVudGltZS5HZXRNYWluVGhyZWFkVGltZSgpCiAgICB9LAogICAgZ3B1dXRpbGlzYXRpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUuR2V0R1BVVXRpbGlzYXRpb24oKQogICAgfSwKICAgIHdpbmRvd3dpZHRoKCkgewogICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lLkdldENhbnZhc01hbmFnZXIoKS5HZXREZXZpY2VXaWR0aCgpCiAgICB9LAogICAgd2luZG93aGVpZ2h0KCkgewogICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lLkdldENhbnZhc01hbmFnZXIoKS5HZXREZXZpY2VIZWlnaHQoKQogICAgfSwKICAgIG9yaWdpbmFsd2luZG93d2lkdGgoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUuR2V0T3JpZ2luYWxWaWV3cG9ydFdpZHRoKCkKICAgIH0sCiAgICBvcmlnaW5hbHdpbmRvd2hlaWdodCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcnVudGltZS5HZXRPcmlnaW5hbFZpZXdwb3J0SGVpZ2h0KCkKICAgIH0sCiAgICBvcmlnaW5hbHZpZXdwb3J0d2lkdGgoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUuR2V0T3JpZ2luYWxWaWV3cG9ydFdpZHRoKCkKICAgIH0sCiAgICBvcmlnaW5hbHZpZXdwb3J0aGVpZ2h0KCkgewogICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lLkdldE9yaWdpbmFsVmlld3BvcnRIZWlnaHQoKQogICAgfSwKICAgIHNjcm9sbHgoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUuR2V0Q3VycmVudExheW91dCgpLkdldFNjcm9sbFgoKQogICAgfSwKICAgIHNjcm9sbHkoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUuR2V0Q3VycmVudExheW91dCgpLkdldFNjcm9sbFkoKQogICAgfSwKICAgIGxheW91dG5hbWUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUuR2V0Q3VycmVudExheW91dCgpLkdldE5hbWUoKQogICAgfSwKICAgIGxheW91dHNjYWxlKCkgewogICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lLkdldEN1cnJlbnRMYXlvdXQoKS5HZXRTY2FsZSgpCiAgICB9LAogICAgbGF5b3V0YW5nbGUoKSB7CiAgICAgICAgcmV0dXJuIEMzJGpzY29tcCQxNzcudG9EZWdyZWVzKHRoaXMuX3J1bnRpbWUuR2V0Q3VycmVudExheW91dCgpLkdldEFuZ2xlKCkpCiAgICB9LAogICAgbGF5b3V0d2lkdGgoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUuR2V0Q3VycmVudExheW91dCgpLkdldFdpZHRoKCkKICAgIH0sCiAgICBsYXlvdXRoZWlnaHQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUuR2V0Q3VycmVudExheW91dCgpLkdldEhlaWdodCgpCiAgICB9LAogICAgdmFuaXNoaW5ncG9pbnR4KCkgewogICAgICAgIHJldHVybiAxMDAgKiB0aGlzLl9ydW50aW1lLkdldEN1cnJlbnRMYXlvdXQoKS5HZXRWYW5pc2hpbmdQb2ludFgoKQogICAgfSwKICAgIHZhbmlzaGluZ3BvaW50eSgpIHsKICAgICAgICByZXR1cm4gMTAwICogdGhpcy5fcnVudGltZS5HZXRDdXJyZW50TGF5b3V0KCkuR2V0VmFuaXNoaW5nUG9pbnRZKCkKICAgIH0sCiAgICB2aWV3cG9ydGxlZnQoYSkgewogICAgICAgIHJldHVybiAoYSA9IHRoaXMuX3J1bnRpbWUuR2V0Q3VycmVudExheW91dCgpLkdldExheWVyKGEpKSA/IGEuR2V0Vmlld3BvcnQzRCgpLmdldExlZnQoKSA6IDAKICAgIH0sCiAgICB2aWV3cG9ydHRvcChhKSB7CiAgICAgICAgcmV0dXJuIChhID0gdGhpcy5fcnVudGltZS5HZXRDdXJyZW50TGF5b3V0KCkuR2V0TGF5ZXIoYSkpID8gYS5HZXRWaWV3cG9ydDNEKCkuZ2V0VG9wKCkgOiAwCiAgICB9LAogICAgdmlld3BvcnRyaWdodChhKSB7CiAgICAgICAgcmV0dXJuIChhID0gdGhpcy5fcnVudGltZS5HZXRDdXJyZW50TGF5b3V0KCkuR2V0TGF5ZXIoYSkpID8gYS5HZXRWaWV3cG9ydDNEKCkuZ2V0UmlnaHQoKSA6IDAKICAgIH0sCiAgICB2aWV3cG9ydGJvdHRvbShhKSB7CiAgICAgICAgcmV0dXJuIChhID0gdGhpcy5fcnVudGltZS5HZXRDdXJyZW50TGF5b3V0KCkuR2V0TGF5ZXIoYSkpID8gYS5HZXRWaWV3cG9ydDNEKCkuZ2V0Qm90dG9tKCkgOiAwCiAgICB9LAogICAgdmlld3BvcnR3aWR0aChhKSB7CiAgICAgICAgcmV0dXJuIChhID0KICAgICAgICAgICAgdGhpcy5fcnVudGltZS5HZXRDdXJyZW50TGF5b3V0KCkuR2V0TGF5ZXIoYSkpID8gYS5HZXRWaWV3cG9ydDNEKCkud2lkdGgoKSA6IDAKICAgIH0sCiAgICB2aWV3cG9ydGhlaWdodChhKSB7CiAgICAgICAgcmV0dXJuIChhID0gdGhpcy5fcnVudGltZS5HZXRDdXJyZW50TGF5b3V0KCkuR2V0TGF5ZXIoYSkpID8gYS5HZXRWaWV3cG9ydDNEKCkuaGVpZ2h0KCkgOiAwCiAgICB9LAogICAgY2FudmFzdG9sYXllcngoYSwgYiwgZCkgewogICAgICAgIHJldHVybiAoYSA9IHRoaXMuX3J1bnRpbWUuR2V0Q3VycmVudExheW91dCgpLkdldExheWVyKGEpKSA/IGEuQ2FudmFzQ3NzVG9MYXllcihiLCBkKVswXSA6IDAKICAgIH0sCiAgICBjYW52YXN0b2xheWVyeShhLCBiLCBkKSB7CiAgICAgICAgcmV0dXJuIChhID0gdGhpcy5fcnVudGltZS5HZXRDdXJyZW50TGF5b3V0KCkuR2V0TGF5ZXIoYSkpID8gYS5DYW52YXNDc3NUb0xheWVyKGIsIGQpWzFdIDogMAogICAgfSwKICAgIGxheWVydG9jYW52YXN4KGEsIGIsIGQpIHsKICAgICAgICByZXR1cm4gKGEgPSB0aGlzLl9ydW50aW1lLkdldEN1cnJlbnRMYXlvdXQoKS5HZXRMYXllcihhKSkgPyBhLkxheWVyVG9DYW52YXNDc3MoYiwgZClbMF0gOiAwCiAgICB9LAogICAgbGF5ZXJ0b2NhbnZhc3koYSwKICAgICAgICBiLCBkKSB7CiAgICAgICAgcmV0dXJuIChhID0gdGhpcy5fcnVudGltZS5HZXRDdXJyZW50TGF5b3V0KCkuR2V0TGF5ZXIoYSkpID8gYS5MYXllclRvQ2FudmFzQ3NzKGIsIGQpWzFdIDogMAogICAgfSwKICAgIGxheWVyc2NhbGUoYSkgewogICAgICAgIHJldHVybiAoYSA9IHRoaXMuX3J1bnRpbWUuR2V0Q3VycmVudExheW91dCgpLkdldExheWVyKGEpKSA/IGEuR2V0T3duU2NhbGUoKSA6IDAKICAgIH0sCiAgICBsYXllcmFuZ2xlKGEpIHsKICAgICAgICByZXR1cm4gKGEgPSB0aGlzLl9ydW50aW1lLkdldEN1cnJlbnRMYXlvdXQoKS5HZXRMYXllcihhKSkgPyBDMyRqc2NvbXAkMTc3LnRvRGVncmVlcyhhLkdldE93bkFuZ2xlKCkpIDogMAogICAgfSwKICAgIGxheWVyb3BhY2l0eShhKSB7CiAgICAgICAgcmV0dXJuIChhID0gdGhpcy5fcnVudGltZS5HZXRDdXJyZW50TGF5b3V0KCkuR2V0TGF5ZXIoYSkpID8gMTAwICogYS5HZXRPcGFjaXR5KCkgOiAwCiAgICB9LAogICAgbGF5ZXJzY2FsZXJhdGUoYSkgewogICAgICAgIHJldHVybiAoYSA9IHRoaXMuX3J1bnRpbWUuR2V0Q3VycmVudExheW91dCgpLkdldExheWVyKGEpKSA/IGEuR2V0U2NhbGVSYXRlKCkgOiAwCiAgICB9LAogICAgbGF5ZXJzY3JvbGx4KGEpIHsKICAgICAgICByZXR1cm4gKGEgPQogICAgICAgICAgICB0aGlzLl9ydW50aW1lLkdldEN1cnJlbnRMYXlvdXQoKS5HZXRMYXllcihhKSkgPyBhLkdldFNjcm9sbFgoKSA6IDAKICAgIH0sCiAgICBsYXllcnNjcm9sbHkoYSkgewogICAgICAgIHJldHVybiAoYSA9IHRoaXMuX3J1bnRpbWUuR2V0Q3VycmVudExheW91dCgpLkdldExheWVyKGEpKSA/IGEuR2V0U2Nyb2xsWSgpIDogMAogICAgfSwKICAgIGxheWVycGFyYWxsYXh4KGEpIHsKICAgICAgICByZXR1cm4gKGEgPSB0aGlzLl9ydW50aW1lLkdldEN1cnJlbnRMYXlvdXQoKS5HZXRMYXllcihhKSkgPyAxMDAgKiBhLkdldFBhcmFsbGF4WCgpIDogMAogICAgfSwKICAgIGxheWVycGFyYWxsYXh5KGEpIHsKICAgICAgICByZXR1cm4gKGEgPSB0aGlzLl9ydW50aW1lLkdldEN1cnJlbnRMYXlvdXQoKS5HZXRMYXllcihhKSkgPyAxMDAgKiBhLkdldFBhcmFsbGF4WSgpIDogMAogICAgfSwKICAgIGxheWVyemVsZXZhdGlvbihhKSB7CiAgICAgICAgcmV0dXJuIChhID0gdGhpcy5fcnVudGltZS5HZXRDdXJyZW50TGF5b3V0KCkuR2V0TGF5ZXIoYSkpID8gYS5HZXRaRWxldmF0aW9uKCkgOiAwCiAgICB9LAogICAgbGF5ZXJpbmRleChhKSB7CiAgICAgICAgcmV0dXJuIChhID0gdGhpcy5fcnVudGltZS5HZXRDdXJyZW50TGF5b3V0KCkuR2V0TGF5ZXIoYSkpID8KICAgICAgICAgICAgYS5HZXRJbmRleCgpIDogLTEKICAgIH0sCiAgICBjYW52YXNzbmFwc2hvdCgpIHsKICAgICAgICBjb25zdCBhID0gdGhpcy5fcnVudGltZS5HZXRDYW52YXNNYW5hZ2VyKCk7CiAgICAgICAgcmV0dXJuIGEgPyBhLkdldENhbnZhc1NuYXBzaG90VXJsKCkgOiAiIgogICAgfSwKICAgIGxvb3BpbmRleChhKSB7CiAgICAgICAgY29uc3QgYiA9IHRoaXMuX2xvb3BTdGFjazsKICAgICAgICByZXR1cm4gYi5Jc0luTG9vcCgpID8gYSA/IChhID0gYi5GaW5kQnlOYW1lKGEpKSA/IGEuR2V0SW5kZXgoKSA6IDAgOiBiLkdldEN1cnJlbnQoKS5HZXRJbmRleCgpIDogMAogICAgfSwKICAgIHNhdmVzdGF0ZWpzb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUuR2V0TGFzdFNhdmVKc29uU3RyaW5nKCkKICAgIH0sCiAgICBjYWxsbWFwcGVkKGEsIGIsIC4uLmQpIHsKICAgICAgICB2YXIgYyA9IHRoaXMuX0dldEZ1bmN0aW9uTWFwKGEudG9Mb3dlckNhc2UoKSwgITEpOwogICAgICAgIGlmICghYykgcmV0dXJuIGNvbnNvbGUud2FybihgW0NvbnN0cnVjdF0gQ2FsbCBtYXBwZWQgZnVuY3Rpb246IG1hcCBuYW1lICcke2F9JyBub3QgZm91bmQ7IHJldHVybmluZyAwYCksIDA7CiAgICAgICAgbGV0IGUgPSBjLnN0ck1hcC5nZXQoYi50b0xvd2VyQ2FzZSgpKTsKICAgICAgICBpZiAoIWUpCiAgICAgICAgICAgIGlmIChjLmRlZmF1bHRGdW5jKSBlID0gYy5kZWZhdWx0RnVuYzsKICAgICAgICAgICAgZWxzZSByZXR1cm4gY29uc29sZS53YXJuKGBbQ29uc3RydWN0XSBDYWxsIG1hcHBlZCBmdW5jdGlvbjogbm8gZnVuY3Rpb24gYXNzb2NpYXRlZCB3aXRoIG1hcCAnJHthfScgc3RyaW5nICcke2J9JzsgcmV0dXJuaW5nIDAgKGNvbnNpZGVyIHNldHRpbmcgYSBkZWZhdWx0KWApLCAwOwogICAgICAgIGMgPSBlLkdldFJldHVyblR5cGUoKTsKICAgICAgICBjb25zdCBnID0gZS5HZXREZWZhdWx0UmV0dXJuVmFsdWUoKTsKICAgICAgICBpZiAoMCA9PT0gYykgcmV0dXJuIGNvbnNvbGUud2FybihgW0NvbnN0cnVjdF0gQ2FsbCBtYXBwZWQgZnVuY3Rpb246IG1hcCAnJHthfScgc3RyaW5nICcke2J9JyBoYXMgbm8gcmV0dXJuIHR5cGUgc28gY2Fubm90IGJlIGNhbGxlZCBmcm9tIGFuIGV4cHJlc3Npb247IHJldHVybmluZyAwYCksIDA7CiAgICAgICAgaWYgKCFlLklzRW5hYmxlZCgpKSByZXR1cm4gZzsKICAgICAgICBhID0gdGhpcy5fcnVudGltZS5HZXRFdmVudFNoZWV0TWFuYWdlcigpOwogICAgICAgIGIgPSBhLkdldEN1cnJlbnRFdmVudCgpLkdldFNvbE1vZGlmaWVyc0luY2x1ZGluZ1BhcmVudHMoKTsKICAgICAgICBjb25zdCBrID0gMCA8IGIubGVuZ3RoOwogICAgICAgIGsgJiYgKGUuSXNDb3B5UGlja2VkKCkgPyBhLlB1c2hDb3B5U29sKGIpIDogYS5QdXNoQ2xlYW5Tb2woYikpOwogICAgICAgIHZhciBtID0gZS5HZXRGdW5jdGlvblBhcmFtZXRlcnMoKTsKICAgICAgICBmb3IgKGxldCBuID0gZC5sZW5ndGgsIHEgPSBtLmxlbmd0aDsgbiA8IHE7ICsrbikgZC5wdXNoKG1bbl0uR2V0SW5pdGlhbFZhbHVlKCkpOwogICAgICAgIG0gPSBlLkdldEV2ZW50QmxvY2soKTsKICAgICAgICBkID0gbS5SdW5Bc0V4cHJlc3Npb25GdW5jdGlvbkNhbGwobS5HZXRTb2xNb2RpZmllcnNJbmNsdWRpbmdQYXJlbnRzKCksIGUuSXNDb3B5UGlja2VkKCksIGMsIGcsIC4uLmQpOwogICAgICAgIGsgJiYgYS5Qb3BTb2woYik7CiAgICAgICAgcmV0dXJuIGQKICAgIH0sCiAgICBsb2FkaW5ncHJvZ3Jlc3MoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUuR2V0QXNzZXRNYW5hZ2VyKCkuR2V0TG9hZFByb2dyZXNzKCkKICAgIH0sCiAgICBpbWFnZWxvYWRpbmdwcm9ncmVzcygpIHsKICAgICAgICByZXR1cm4gMCA9PT0gdGhpcy5faW1hZ2VzTG9hZGluZ1RvdGFsID8gMSA6IHRoaXMuX2ltYWdlc0xvYWRpbmdDb21wbGV0ZSAvIHRoaXMuX2ltYWdlc0xvYWRpbmdUb3RhbAogICAgfSwKICAgIHJlbmRlcmVyKCkgewogICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lLkdldFdlYkdQVVJlbmRlcmVyKCkgPyAid2ViZ3B1IiA6ICJ3ZWJnbCIKICAgIH0sCiAgICByZW5kZXJlcmRldGFpbCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcnVudGltZS5HZXRXZWJHUFVSZW5kZXJlcigpID8gIjx1bmF2YWlsYWJsZT4iIDogdGhpcy5fcnVudGltZS5HZXRXZWJHTFJlbmRlcmVyKCkuR2V0VW5tYXNrZWRSZW5kZXJlcigpCiAgICB9LAogICAgaW1hZ2VtZW1vcnl1c2FnZSgpIHsKICAgICAgICBsZXQgYSA9IHRoaXMuX3J1bnRpbWUuR2V0UmVuZGVyZXIoKS5HZXRFc3RpbWF0ZWRUZXh0dXJlTWVtb3J5VXNhZ2UoKTsKICAgICAgICByZXR1cm4gTWF0aC5yb3VuZCgxMDAgKiBhIC8gMTA0ODU3NikgLyAxMDAKICAgIH0sCiAgICByZ2IoYSwgYiwgZCkgewogICAgICAgIHJldHVybiBDMyRqc2NvbXAkMTc3LlBhY2tSR0IoYSwgYiwgZCkKICAgIH0sCiAgICByZ2JleChhLCBiLCBkKSB7CiAgICAgICAgcmV0dXJuIEMzJGpzY29tcCQxNzcuUGFja1JHQkV4KGEgLyAxMDAsIGIgLyAxMDAsIGQgLyAxMDApCiAgICB9LAogICAgcmdiYShhLCBiLCBkLCBjKSB7CiAgICAgICAgcmV0dXJuIEMzJGpzY29tcCQxNzcuUGFja1JHQkFFeChhIC8gMTAwLCBiIC8gMTAwLCBkIC8gMTAwLCBjIC8KICAgICAgICAgICAgMTAwKQogICAgfSwKICAgIHJnYmV4MjU1KGEsIGIsIGQpIHsKICAgICAgICByZXR1cm4gQzMkanNjb21wJDE3Ny5QYWNrUkdCRXgoYSAvIDI1NSwgYiAvIDI1NSwgZCAvIDI1NSkKICAgIH0sCiAgICByZ2JhMjU1KGEsIGIsIGQsIGMpIHsKICAgICAgICByZXR1cm4gQzMkanNjb21wJDE3Ny5QYWNrUkdCQUV4KGEgLyAyNTUsIGIgLyAyNTUsIGQgLyAyNTUsIGMgLyAyNTUpCiAgICB9LAogICAgcHJvamVjdG5hbWUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUuR2V0UHJvamVjdE5hbWUoKQogICAgfSwKICAgIHByb2plY3R2ZXJzaW9uKCkgewogICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lLkdldFByb2plY3RWZXJzaW9uKCkKICAgIH0sCiAgICBjdXJyZW50ZXZlbnRzaGVldG5hbWUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUuR2V0Q3VycmVudEV2ZW50KCkuR2V0RXZlbnRTaGVldCgpLkdldE5hbWUoKQogICAgfSwKICAgIGN1cnJlbnRldmVudG51bWJlcigpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcnVudGltZS5HZXRDdXJyZW50RXZlbnQoKS5HZXREaXNwbGF5TnVtYmVyKCkKICAgIH0KfTsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkMTc4ID0gc2VsZi5DMzsKQzMkanNjb21wJDE3OC5QbHVnaW5zLlNwcml0ZSA9IGNsYXNzIGV4dGVuZHMgQzMkanNjb21wJDE3OC5TREtQbHVnaW5CYXNlIHsKICAgIGNvbnN0cnVjdG9yKGEpIHsKICAgICAgICBzdXBlcihhKQogICAgfQogICAgUmVsZWFzZSgpIHsKICAgICAgICBzdXBlci5SZWxlYXNlKCkKICAgIH0KfTsKY29uc3QgQzMkanNjb21wJDE3OSA9IHNlbGYuQzMsCiAgICBzcGF3blBpY2tTdGFjayA9IFtdOwpDMyRqc2NvbXAkMTc5LlBsdWdpbnMuU3ByaXRlLlR5cGUgPSBjbGFzcyBleHRlbmRzIEMzJGpzY29tcCQxNzkuU0RLVHlwZUJhc2UgewogICAgY29uc3RydWN0b3IoYSkgewogICAgICAgIHN1cGVyKGEpOwogICAgICAgIHRoaXMuX2FuaW1hdGlvbnMgPSBhLkdldEFuaW1hdGlvbnMoKQogICAgfQogICAgUmVsZWFzZSgpIHsKICAgICAgICBDMyRqc2NvbXAkMTc5LmNsZWFyQXJyYXkodGhpcy5fYW5pbWF0aW9ucyk7CiAgICAgICAgc3VwZXIuUmVsZWFzZSgpCiAgICB9CiAgICBPbkNyZWF0ZSgpIHsKICAgICAgICBmb3IgKGNvbnN0IGEgb2YgdGhpcy5fYW5pbWF0aW9ucykgYS5Mb2FkQWxsQXNzZXRzKHRoaXMuX3J1bnRpbWUpCiAgICB9CiAgICBMb2FkVGV4dHVyZXMoYSkgewogICAgICAgIGNvbnN0IGIgPSB7CiAgICAgICAgICAgIHNhbXBsaW5nOiB0aGlzLl9ydW50aW1lLkdldFNhbXBsaW5nKCkKICAgICAgICB9OwogICAgICAgIHJldHVybiBQcm9taXNlLmFsbCh0aGlzLl9hbmltYXRpb25zLm1hcChkID0+IGQuTG9hZEFsbFRleHR1cmVzKGEsIGIpKSkKICAgIH0KICAgIFJlbGVhc2VUZXh0dXJlcygpIHsKICAgICAgICBmb3IgKGNvbnN0IGEgb2YgdGhpcy5fYW5pbWF0aW9ucykgYS5SZWxlYXNlQWxsVGV4dHVyZXMoKQogICAgfQogICAgT25EeW5hbWljVGV4dHVyZUxvYWRDb21wbGV0ZSgpIHsKICAgICAgICB0aGlzLl9VcGRhdGVBbGxDdXJyZW50VGV4dHVyZSgpCiAgICB9CiAgICBfVXBkYXRlQWxsQ3VycmVudFRleHR1cmUoKSB7CiAgICAgICAgZm9yIChjb25zdCBhIG9mIHRoaXMuX29iamVjdENsYXNzLmluc3RhbmNlc0luY2x1ZGluZ1BlbmRpbmdDcmVhdGUoKSkgYS5HZXRTZGtJbnN0YW5jZSgpLl9VcGRhdGVDdXJyZW50VGV4dHVyZSgpCiAgICB9CiAgICBGaW5pc2hDb25kaXRpb24oYSkgewogICAgICAgIEMzJGpzY29tcCQxNzkuUGx1Z2lucy5TcHJpdGUuRmluaXNoQ29sbGlzaW9uQ29uZGl0aW9uKHRoaXMsCiAgICAgICAgICAgIGEpCiAgICB9CiAgICBCZWZvcmVSdW5BY3Rpb24oYSkgewogICAgICAgIHNwYXduUGlja1N0YWNrLnB1c2goewogICAgICAgICAgICBvYmplY3RDbGFzczogbnVsbCwKICAgICAgICAgICAgY3JlYXRlSGllcmFyY2h5OiAhMSwKICAgICAgICAgICAgaW5zdGFuY2VzOiBbXQogICAgICAgIH0pCiAgICB9CiAgICBfU3Bhd25QaWNrSW5zdGFuY2UoYSwgYiwgZCkgewogICAgICAgIGNvbnN0IGMgPSBzcGF3blBpY2tTdGFjay5hdCgtMSk7CiAgICAgICAgYy5vYmplY3RDbGFzcyA9IGE7CiAgICAgICAgYy5jcmVhdGVIaWVyYXJjaHkgPSBkOwogICAgICAgIGMuaW5zdGFuY2VzLnB1c2goYikKICAgIH0KICAgIEFmdGVyUnVuQWN0aW9uKGEpIHsKICAgICAgICBhID0gc3Bhd25QaWNrU3RhY2sucG9wKCk7CiAgICAgICAgY29uc3QgYiA9IGEub2JqZWN0Q2xhc3MsCiAgICAgICAgICAgIGQgPSBhLmNyZWF0ZUhpZXJhcmNoeTsKICAgICAgICBpZiAoYikgewogICAgICAgICAgICB2YXIgYyA9IG5ldyBNYXA7CiAgICAgICAgICAgIGZvciAoY29uc3QgZSBvZiBhLmluc3RhbmNlcykgZS5Db2xsZWN0SW5zdGFuY2VzVG9QaWNrKGMsIGIsIGQpOwogICAgICAgICAgICBmb3IgKGNvbnN0IFtlLCBnXSBvZiBjKSBlLkdldEN1cnJlbnRTb2woKS5TZXRTZXRQaWNrZWQoZykKICAgICAgICB9CiAgICB9Cn07CmNvbnN0IEMzJGpzY29tcCQxODAgPSBzZWxmLkMzLAogICAgQzNYJGpzY29tcCQxOCA9IHNlbGYuQzNYLAogICAgdGVtcFJlY3QkanNjb21wJDEwID0gQzMkanNjb21wJDE4MC5OZXcoQzMkanNjb21wJDE4MC5SZWN0KSwKICAgIHRlbXBRdWFkJGpzY29tcCQ2ID0gQzMkanNjb21wJDE4MC5OZXcoQzMkanNjb21wJDE4MC5RdWFkKSwKICAgIHRlbXBWZWMyJGpzY29tcCQxID0gQzMkanNjb21wJDE4MC5OZXcoQzMkanNjb21wJDE4MC5WZWN0b3IyKSwKICAgIEZMQUdfUExBWUlOR19GT1JXQVJEUyA9IDEsCiAgICBGTEFHX0FOSU1BVElPTl9QTEFZSU5HID0gMiwKICAgIEZMQUdfQU5JTUFUSU9OX1RSSUdHRVIgPSA0OwpDMyRqc2NvbXAkMTgwLlBsdWdpbnMuU3ByaXRlLkluc3RhbmNlID0gY2xhc3MgZXh0ZW5kcyBDMyRqc2NvbXAkMTgwLlNES1dvcmxkSW5zdGFuY2VCYXNlIHsKICAgIGNvbnN0cnVjdG9yKGEsIGIpIHsKICAgICAgICBzdXBlcihhKTsKICAgICAgICBsZXQgZCA9ICEwLAogICAgICAgICAgICBjID0gIiIsCiAgICAgICAgICAgIGUgPSAwLAogICAgICAgICAgICBnID0gITA7CiAgICAgICAgYiAmJiAoZCA9ICEhYlswXSwgYyA9IGJbMV0sIGUgPSBiWzJdLCBnID0gYlszXSk7CiAgICAgICAgdGhpcy5fY3VycmVudEFuaW1hdGlvbiA9IHRoaXMuX29iamVjdENsYXNzLkdldEFuaW1hdGlvbkJ5TmFtZShjKSB8fCB0aGlzLl9vYmplY3RDbGFzcy5HZXRBbmltYXRpb25zKClbMF07CiAgICAgICAgdGhpcy5fY3VycmVudEZyYW1lSW5kZXggPSBDMyRqc2NvbXAkMTgwLmNsYW1wKGUsIDAsIHRoaXMuX2N1cnJlbnRBbmltYXRpb24uR2V0RnJhbWVDb3VudCgpIC0gMSk7CiAgICAgICAgdGhpcy5fY3VycmVudEFuaW1hdGlvbkZyYW1lID0gdGhpcy5fY3VycmVudEFuaW1hdGlvbi5HZXRGcmFtZUF0KHRoaXMuX2N1cnJlbnRGcmFtZUluZGV4KTsKICAgICAgICBiID0gdGhpcy5fY3VycmVudEFuaW1hdGlvbkZyYW1lLkdldEltYWdlSW5mbygpOwogICAgICAgIHRoaXMuX2N1cnJlbnRUZXh0dXJlID0KICAgICAgICAgICAgYi5HZXRUZXh0dXJlKCk7CiAgICAgICAgdGhpcy5fY3VycmVudFJjVGV4ID0gYi5HZXRUZXhSZWN0KCk7CiAgICAgICAgdGhpcy5fY3VycmVudFF1YWRUZXggPSBiLkdldFRleFF1YWQoKTsKICAgICAgICB0aGlzLkhhbmRsZVdlYkdMQ29udGV4dExvc3MoKTsKICAgICAgICBhLlNldEZsYWcoRkxBR19BTklNQVRJT05fUExBWUlORywgITApOwogICAgICAgIGEuU2V0RmxhZyhGTEFHX1BMQVlJTkdfRk9SV0FSRFMsIDAgPD0gdGhpcy5fY3VycmVudEFuaW1hdGlvbi5HZXRTcGVlZCgpKTsKICAgICAgICB0aGlzLl9jdXJyZW50QW5pbWF0aW9uU3BlZWQgPSBNYXRoLmFicyh0aGlzLl9jdXJyZW50QW5pbWF0aW9uLkdldFNwZWVkKCkpOwogICAgICAgIHRoaXMuX2N1cnJlbnRBbmltYXRpb25SZXBlYXRUbyA9IHRoaXMuX2N1cnJlbnRBbmltYXRpb24uR2V0UmVwZWF0VG8oKTsKICAgICAgICB0aGlzLl9hbmltYXRpb25UaW1lciA9IEMzJGpzY29tcCQxODAuTmV3KEMzJGpzY29tcCQxODAuS2FoYW5TdW0pOwogICAgICAgIHRoaXMuX2FuaW1hdGlvblJlcGVhdHMgPSB0aGlzLl9mcmFtZVN0YXJ0VGltZSA9IDA7CiAgICAgICAgdGhpcy5fYW5pbVRyaWdnZXJOYW1lID0gIiI7CiAgICAgICAgdGhpcy5fY2hhbmdlQW5pbUZyYW1lSW5kZXggPSAtMTsKICAgICAgICB0aGlzLl9jaGFuZ2VBbmltYXRpb25OYW1lID0gIiI7CiAgICAgICAgdGhpcy5fY2hhbmdlQW5pbWF0aW9uRnJvbSA9IDA7CiAgICAgICAgYSA9IHRoaXMuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgdGhpcy5fYnF1YWRSZWYgPSBhLkdldEJvdW5kaW5nUXVhZCgpOwogICAgICAgIGEuU2V0VmlzaWJsZShkKTsKICAgICAgICBhLlNldENvbGxpc2lvbkVuYWJsZWQoZyk7CiAgICAgICAgYS5TZXRPcmlnaW5YKHRoaXMuX2N1cnJlbnRBbmltYXRpb25GcmFtZS5HZXRPcmlnaW5YKCkpOwogICAgICAgIGEuU2V0T3JpZ2luWSh0aGlzLl9jdXJyZW50QW5pbWF0aW9uRnJhbWUuR2V0T3JpZ2luWSgpKTsKICAgICAgICBhLlNldFNvdXJjZUNvbGxpc2lvblBvbHkodGhpcy5fY3VycmVudEFuaW1hdGlvbkZyYW1lLkdldENvbGxpc2lvblBvbHkoKSk7CiAgICAgICAgYS5TZXRCYm94Q2hhbmdlZCgpOwogICAgICAgIDEgPT09IHRoaXMuX29iamVjdENsYXNzLkdldEFuaW1hdGlvbkNvdW50KCkgJiYgMSA9PT0gdGhpcy5fb2JqZWN0Q2xhc3MuR2V0QW5pbWF0aW9ucygpWzBdLkdldEZyYW1lQ291bnQoKSB8fCAwID09PSB0aGlzLl9jdXJyZW50QW5pbWF0aW9uU3BlZWQgfHwgdGhpcy5fU3RhcnRUaWNraW5nKCkKICAgIH0KICAgIFJlbGVhc2UoKSB7CiAgICAgICAgdGhpcy5fYW5pbWF0aW9uVGltZXIgPQogICAgICAgICAgICB0aGlzLl9jdXJyZW50VGV4dHVyZSA9IHRoaXMuX2N1cnJlbnRBbmltYXRpb25GcmFtZSA9IHRoaXMuX2N1cnJlbnRBbmltYXRpb24gPSBudWxsOwogICAgICAgIHN1cGVyLlJlbGVhc2UoKQogICAgfQogICAgR2V0Q3VycmVudEltYWdlSW5mbygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fY3VycmVudEFuaW1hdGlvbkZyYW1lLkdldEltYWdlSW5mbygpCiAgICB9CiAgICBJc09yaWdpbmFsU2l6ZUtub3duKCkgewogICAgICAgIHJldHVybiAhMAogICAgfQogICAgT25XZWJHTENvbnRleHRMb3N0KCkgewogICAgICAgIHRoaXMuX2N1cnJlbnRUZXh0dXJlID0gbnVsbAogICAgfQogICAgT25XZWJHTENvbnRleHRSZXN0b3JlZCgpIHsKICAgICAgICB0aGlzLl9VcGRhdGVDdXJyZW50VGV4dHVyZSgpCiAgICB9CiAgICBEcmF3KGEpIHsKICAgICAgICB2YXIgYiA9IHRoaXMuX2N1cnJlbnRUZXh0dXJlOwogICAgICAgIG51bGwgIT09IGIgJiYgKGEuU2V0VGV4dHVyZShiKSwgYiA9IHRoaXMuR2V0V29ybGRJbmZvKCksIGIuSGFzTWVzaCgpID8gdGhpcy5fRHJhd01lc2goYiwgYSkgOiB0aGlzLl9EcmF3U3RhbmRhcmQoYiwgYSkpCiAgICB9CiAgICBfRHJhd1N0YW5kYXJkKGEsIGIpIHsKICAgICAgICBsZXQgZCA9IHRoaXMuX2JxdWFkUmVmOwogICAgICAgIHRoaXMuX3J1bnRpbWUuSXNQaXhlbFJvdW5kaW5nRW5hYmxlZCgpICYmCiAgICAgICAgICAgIChkID0gYS5QaXhlbFJvdW5kUXVhZChkKSk7CiAgICAgICAgYi5RdWFkNChkLCB0aGlzLl9jdXJyZW50UXVhZFRleCkKICAgIH0KICAgIF9EcmF3TWVzaChhLCBiKSB7CiAgICAgICAgY29uc3QgZCA9IGEuR2V0VHJhbnNmb3JtZWRNZXNoKCk7CiAgICAgICAgaWYgKGEuSXNNZXNoQ2hhbmdlZCgpKSB7CiAgICAgICAgICAgIGEuQ2FsY3VsYXRlQmJveCh0ZW1wUmVjdCRqc2NvbXAkMTAsIHRlbXBRdWFkJGpzY29tcCQ2LCAhMSk7CiAgICAgICAgICAgIGxldCBjID0gdGVtcFF1YWQkanNjb21wJDY7CiAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuSXNQaXhlbFJvdW5kaW5nRW5hYmxlZCgpICYmIChjID0gYS5QaXhlbFJvdW5kUXVhZChjKSk7CiAgICAgICAgICAgIGQuQ2FsY3VsYXRlVHJhbnNmb3JtZWRNZXNoKGEuR2V0U291cmNlTWVzaCgpLCBjLCB0aGlzLl9jdXJyZW50UXVhZFRleCk7CiAgICAgICAgICAgIGEuU2V0TWVzaENoYW5nZWQoITEpCiAgICAgICAgfQogICAgICAgIGQuRHJhdyhiKQogICAgfQogICAgR2V0QW5pbWF0aW9uVGltZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fYW5pbWF0aW9uVGltZXIuR2V0KCkKICAgIH0KICAgIElzQW5pbWF0aW9uUGxheWluZygpIHsKICAgICAgICByZXR1cm4gdGhpcy5faW5zdC5HZXRGbGFnKEZMQUdfQU5JTUFUSU9OX1BMQVlJTkcpCiAgICB9CiAgICBTZXRBbmltYXRpb25QbGF5aW5nKGEpIHsKICAgICAgICB0aGlzLl9pbnN0LlNldEZsYWcoRkxBR19BTklNQVRJT05fUExBWUlORywKICAgICAgICAgICAgYSkKICAgIH0KICAgIElzUGxheWluZ0ZvcndhcmRzKCkgewogICAgICAgIHJldHVybiB0aGlzLl9pbnN0LkdldEZsYWcoRkxBR19QTEFZSU5HX0ZPUldBUkRTKQogICAgfQogICAgU2V0UGxheWluZ0ZvcndhcmRzKGEpIHsKICAgICAgICB0aGlzLl9pbnN0LlNldEZsYWcoRkxBR19QTEFZSU5HX0ZPUldBUkRTLCBhKQogICAgfQogICAgSXNJbkFuaW1hdGlvblRyaWdnZXIoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2luc3QuR2V0RmxhZyhGTEFHX0FOSU1BVElPTl9UUklHR0VSKQogICAgfQogICAgU2V0SW5BbmltYXRpb25UcmlnZ2VyKGEpIHsKICAgICAgICB0aGlzLl9pbnN0LlNldEZsYWcoRkxBR19BTklNQVRJT05fVFJJR0dFUiwgYSkKICAgIH0KICAgIFRpY2soKSB7CiAgICAgICAgdGhpcy5fY2hhbmdlQW5pbWF0aW9uTmFtZSAmJiB0aGlzLl9Eb0NoYW5nZUFuaW1hdGlvbigpOwogICAgICAgIDAgPD0gdGhpcy5fY2hhbmdlQW5pbUZyYW1lSW5kZXggJiYgdGhpcy5fRG9DaGFuZ2VBbmltRnJhbWUoKTsKICAgICAgICBjb25zdCBhID0gdGhpcy5fY3VycmVudEFuaW1hdGlvblNwZWVkOwogICAgICAgIGlmICh0aGlzLklzQW5pbWF0aW9uUGxheWluZygpICYmIDAgIT09IGEpIHsKICAgICAgICAgICAgdmFyIGIgPSB0aGlzLl9ydW50aW1lLkdldER0KHRoaXMuX2luc3QpOwogICAgICAgICAgICB0aGlzLl9hbmltYXRpb25UaW1lci5BZGQoYik7CiAgICAgICAgICAgIGIgPSB0aGlzLkdldEFuaW1hdGlvblRpbWUoKTsKICAgICAgICAgICAgdmFyIGQgPSB0aGlzLl9jdXJyZW50QW5pbWF0aW9uRnJhbWUsCiAgICAgICAgICAgICAgICBjID0gZC5HZXREdXJhdGlvbigpIC8gYTsKICAgICAgICAgICAgaWYgKCEoYiA8IHRoaXMuX2ZyYW1lU3RhcnRUaW1lICsgYykpIHsKICAgICAgICAgICAgICAgIHZhciBlID0gdGhpcy5fY3VycmVudEFuaW1hdGlvbiwKICAgICAgICAgICAgICAgICAgICBnID0gdGhpcy5fY3VycmVudEFuaW1hdGlvblJlcGVhdFRvLAogICAgICAgICAgICAgICAgICAgIGsgPSBlLkdldEZyYW1lQ291bnQoKSwKICAgICAgICAgICAgICAgICAgICBtID0gZS5HZXRSZXBlYXRDb3VudCgpLAogICAgICAgICAgICAgICAgICAgIG4gPSBlLklzTG9vcGluZygpLAogICAgICAgICAgICAgICAgICAgIHEgPSBlLklzUGluZ1BvbmcoKTsKICAgICAgICAgICAgICAgIHRoaXMuSXNQbGF5aW5nRm9yd2FyZHMoKSA/IHRoaXMuX2N1cnJlbnRGcmFtZUluZGV4KysgOiB0aGlzLl9jdXJyZW50RnJhbWVJbmRleC0tOwogICAgICAgICAgICAgICAgdGhpcy5fZnJhbWVTdGFydFRpbWUgKz0gYzsKICAgICAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRGcmFtZUluZGV4ID49IGsgJiYgKHEgPyAodGhpcy5TZXRQbGF5aW5nRm9yd2FyZHMoITEpLCB0aGlzLl9jdXJyZW50RnJhbWVJbmRleCA9IGsgLSAyKSA6IG4gPyB0aGlzLl9jdXJyZW50RnJhbWVJbmRleCA9IGcgOiAodGhpcy5fYW5pbWF0aW9uUmVwZWF0cysrLAogICAgICAgICAgICAgICAgICAgIHRoaXMuX2FuaW1hdGlvblJlcGVhdHMgPj0gbSA/IHRoaXMuX0ZpbmlzaEFuaW1hdGlvbighMSkgOiB0aGlzLl9jdXJyZW50RnJhbWVJbmRleCA9IGcpKTsKICAgICAgICAgICAgICAgIDAgPiB0aGlzLl9jdXJyZW50RnJhbWVJbmRleCAmJiAocSA/ICh0aGlzLl9jdXJyZW50RnJhbWVJbmRleCA9IDEsIHRoaXMuU2V0UGxheWluZ0ZvcndhcmRzKCEwKSwgbiB8fCAodGhpcy5fYW5pbWF0aW9uUmVwZWF0cysrLCB0aGlzLl9hbmltYXRpb25SZXBlYXRzID49IG0gJiYgdGhpcy5fRmluaXNoQW5pbWF0aW9uKCEwKSkpIDogbiA/IHRoaXMuX2N1cnJlbnRGcmFtZUluZGV4ID0gZyA6ICh0aGlzLl9hbmltYXRpb25SZXBlYXRzKyssIHRoaXMuX2FuaW1hdGlvblJlcGVhdHMgPj0gbSA/IHRoaXMuX0ZpbmlzaEFuaW1hdGlvbighMCkgOiB0aGlzLl9jdXJyZW50RnJhbWVJbmRleCA9IGcpKTsKICAgICAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRGcmFtZUluZGV4ID0gQzMkanNjb21wJDE4MC5jbGFtcCh0aGlzLl9jdXJyZW50RnJhbWVJbmRleCwgMCwgayAtIDEpOwogICAgICAgICAgICAgICAgYyA9IGUuR2V0RnJhbWVBdCh0aGlzLl9jdXJyZW50RnJhbWVJbmRleCk7CiAgICAgICAgICAgICAgICBiID4gdGhpcy5fZnJhbWVTdGFydFRpbWUgKwogICAgICAgICAgICAgICAgICAgIGMuR2V0RHVyYXRpb24oKSAvIGEgJiYgKHRoaXMuX2ZyYW1lU3RhcnRUaW1lID0gYik7CiAgICAgICAgICAgICAgICB0aGlzLl9PbkZyYW1lQ2hhbmdlZChkLCBjKQogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHRoaXMuX1N0b3BUaWNraW5nKCkKICAgIH0KICAgIF9GaW5pc2hBbmltYXRpb24oYSkgewogICAgICAgIHRoaXMuX2N1cnJlbnRGcmFtZUluZGV4ID0gYSA/IDAgOiB0aGlzLl9jdXJyZW50QW5pbWF0aW9uLkdldEZyYW1lQ291bnQoKSAtIDE7CiAgICAgICAgdGhpcy5TZXRBbmltYXRpb25QbGF5aW5nKCExKTsKICAgICAgICB0aGlzLl9hbmltVHJpZ2dlck5hbWUgPSB0aGlzLl9jdXJyZW50QW5pbWF0aW9uLkdldE5hbWUoKTsKICAgICAgICB0aGlzLlNldEluQW5pbWF0aW9uVHJpZ2dlcighMCk7CiAgICAgICAgdGhpcy5EaXNwYXRjaFNjcmlwdEV2ZW50KCJhbmltYXRpb25lbmQiLCAhMSwgewogICAgICAgICAgICBhbmltYXRpb25OYW1lOiB0aGlzLl9hbmltVHJpZ2dlck5hbWUKICAgICAgICB9KTsKICAgICAgICB0aGlzLlRyaWdnZXIoQzMkanNjb21wJDE4MC5QbHVnaW5zLlNwcml0ZS5DbmRzLk9uQW55QW5pbUZpbmlzaGVkKTsKICAgICAgICB0aGlzLlRyaWdnZXIoQzMkanNjb21wJDE4MC5QbHVnaW5zLlNwcml0ZS5DbmRzLk9uQW5pbUZpbmlzaGVkKTsKICAgICAgICB0aGlzLlNldEluQW5pbWF0aW9uVHJpZ2dlcighMSk7CiAgICAgICAgdGhpcy5fYW5pbWF0aW9uUmVwZWF0cyA9IDAKICAgIH0KICAgIF9PbkZyYW1lQ2hhbmdlZChhLCBiKSB7CiAgICAgICAgaWYgKGEgIT09IGIpIHsKICAgICAgICAgICAgdmFyIGQgPSB0aGlzLkdldFdvcmxkSW5mbygpLAogICAgICAgICAgICAgICAgYyA9IGEuR2V0SW1hZ2VJbmZvKCksCiAgICAgICAgICAgICAgICBlID0gYi5HZXRJbWFnZUluZm8oKSwKICAgICAgICAgICAgICAgIGcgPSBjLkdldFdpZHRoKCk7CiAgICAgICAgICAgIGMgPSBjLkdldEhlaWdodCgpOwogICAgICAgICAgICB2YXIgayA9IGUuR2V0V2lkdGgoKSwKICAgICAgICAgICAgICAgIG0gPSBlLkdldEhlaWdodCgpOwogICAgICAgICAgICBnICE9PSBrICYmIGQuU2V0V2lkdGgoZC5HZXRXaWR0aCgpICogKGsgLyBnKSk7CiAgICAgICAgICAgIGMgIT09IG0gJiYgZC5TZXRIZWlnaHQoZC5HZXRIZWlnaHQoKSAqIChtIC8gYykpOwogICAgICAgICAgICBkLlNldE9yaWdpblgoYi5HZXRPcmlnaW5YKCkpOwogICAgICAgICAgICBkLlNldE9yaWdpblkoYi5HZXRPcmlnaW5ZKCkpOwogICAgICAgICAgICBkLlNldFNvdXJjZUNvbGxpc2lvblBvbHkoYi5HZXRDb2xsaXNpb25Qb2x5KCkpOwogICAgICAgICAgICBkLlNldEJib3hDaGFuZ2VkKCk7CiAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRBbmltYXRpb25GcmFtZSA9IGI7CiAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRUZXh0dXJlID0gZS5HZXRUZXh0dXJlKCk7CiAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRSY1RleCA9CiAgICAgICAgICAgICAgICBlLkdldFRleFJlY3QoKTsKICAgICAgICAgICAgdGhpcy5fY3VycmVudFF1YWRUZXggPSBlLkdldFRleFF1YWQoKTsKICAgICAgICAgICAgZCA9IHRoaXMuR2V0SW5zdGFuY2UoKS5HZXRCZWhhdmlvckluc3RhbmNlcygpOwogICAgICAgICAgICBmb3IgKGxldCBuID0gMCwgcSA9IGQubGVuZ3RoOyBuIDwgcTsgKytuKSBkW25dLk9uU3ByaXRlRnJhbWVDaGFuZ2VkKGEsIGIpOwogICAgICAgICAgICB0aGlzLkRpc3BhdGNoU2NyaXB0RXZlbnQoImZyYW1lY2hhbmdlIiwgITEsIHsKICAgICAgICAgICAgICAgIGFuaW1hdGlvbk5hbWU6IHRoaXMuX2N1cnJlbnRBbmltYXRpb24uR2V0TmFtZSgpLAogICAgICAgICAgICAgICAgYW5pbWF0aW9uRnJhbWU6IHRoaXMuX2N1cnJlbnRGcmFtZUluZGV4CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0aGlzLlRyaWdnZXIoQzMkanNjb21wJDE4MC5QbHVnaW5zLlNwcml0ZS5DbmRzLk9uRnJhbWVDaGFuZ2VkKTsKICAgICAgICAgICAgdGhpcy5fcnVudGltZS5VcGRhdGVSZW5kZXIoKQogICAgICAgIH0KICAgIH0KICAgIF9TdGFydEFuaW0oYSkgewogICAgICAgIHRoaXMuU2V0QW5pbWF0aW9uUGxheWluZyghMCk7CiAgICAgICAgdGhpcy5fZnJhbWVTdGFydFRpbWUgPSB0aGlzLkdldEFuaW1hdGlvblRpbWUoKTsKICAgICAgICAxID09PSBhICYmIDAgIT09IHRoaXMuX2N1cnJlbnRGcmFtZUluZGV4ICYmCiAgICAgICAgICAgICh0aGlzLl9jaGFuZ2VBbmltRnJhbWVJbmRleCA9IDAsIHRoaXMuSXNJbkFuaW1hdGlvblRyaWdnZXIoKSB8fCB0aGlzLl9Eb0NoYW5nZUFuaW1GcmFtZSgpKTsKICAgICAgICB0aGlzLl9TdGFydFRpY2tpbmcoKQogICAgfQogICAgX1NldEFuaW0oYSwgYikgewogICAgICAgIHRoaXMuX2NoYW5nZUFuaW1hdGlvbk5hbWUgPSBhOwogICAgICAgIHRoaXMuX2NoYW5nZUFuaW1hdGlvbkZyb20gPSBiOwogICAgICAgIHRoaXMuX1N0YXJ0VGlja2luZygpOwogICAgICAgIHRoaXMuSXNJbkFuaW1hdGlvblRyaWdnZXIoKSB8fCB0aGlzLl9Eb0NoYW5nZUFuaW1hdGlvbigpCiAgICB9CiAgICBfR2V0Q3VycmVudEFuaW1hdGlvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5fY3VycmVudEFuaW1hdGlvbgogICAgfQogICAgX0dldEN1cnJlbnRBbmltYXRpb25OYW1lKCkgewogICAgICAgIHJldHVybiB0aGlzLl9jaGFuZ2VBbmltYXRpb25OYW1lID8gdGhpcy5fY2hhbmdlQW5pbWF0aW9uTmFtZSA6IHRoaXMuX2N1cnJlbnRBbmltYXRpb24uR2V0TmFtZSgpCiAgICB9CiAgICBfU2V0QW5pbUZyYW1lKGEpIHsKICAgICAgICBpc0Zpbml0ZShhKSAmJiAodGhpcy5fY2hhbmdlQW5pbUZyYW1lSW5kZXggPSBhLCB0aGlzLklzSW5BbmltYXRpb25UcmlnZ2VyKCkgfHwKICAgICAgICAgICAgdGhpcy5fRG9DaGFuZ2VBbmltRnJhbWUoKSkKICAgIH0KICAgIF9HZXRBbmltRnJhbWUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2N1cnJlbnRGcmFtZUluZGV4CiAgICB9CiAgICBfU2V0QW5pbVNwZWVkKGEpIHsKICAgICAgICB0aGlzLl9jdXJyZW50QW5pbWF0aW9uU3BlZWQgPSBNYXRoLmFicyhhKTsKICAgICAgICB0aGlzLlNldFBsYXlpbmdGb3J3YXJkcygwIDw9IGEpOwogICAgICAgIDAgPCB0aGlzLl9jdXJyZW50QW5pbWF0aW9uU3BlZWQgJiYgdGhpcy5fU3RhcnRUaWNraW5nKCkKICAgIH0KICAgIF9HZXRBbmltU3BlZWQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuSXNQbGF5aW5nRm9yd2FyZHMoKSA/IHRoaXMuX2N1cnJlbnRBbmltYXRpb25TcGVlZCA6IC10aGlzLl9jdXJyZW50QW5pbWF0aW9uU3BlZWQKICAgIH0KICAgIF9TZXRBbmltUmVwZWF0VG9GcmFtZShhKSB7CiAgICAgICAgdGhpcy5fY3VycmVudEFuaW1hdGlvblJlcGVhdFRvID0gYSA9IEMzJGpzY29tcCQxODAuY2xhbXAoTWF0aC5mbG9vcihhKSwgMCwgdGhpcy5fY3VycmVudEFuaW1hdGlvbi5HZXRGcmFtZUNvdW50KCkgLSAxKQogICAgfQogICAgX0dldEFuaW1SZXBlYXRUb0ZyYW1lKCkgewogICAgICAgIHJldHVybiB0aGlzLl9jdXJyZW50QW5pbWF0aW9uUmVwZWF0VG8KICAgIH0KICAgIF9Eb0NoYW5nZUFuaW1hdGlvbigpIHsKICAgICAgICBjb25zdCBhID0KICAgICAgICAgICAgdGhpcy5fY3VycmVudEFuaW1hdGlvbkZyYW1lOwogICAgICAgIHZhciBiID0gdGhpcy5fb2JqZWN0Q2xhc3MuR2V0QW5pbWF0aW9uQnlOYW1lKHRoaXMuX2NoYW5nZUFuaW1hdGlvbk5hbWUpOwogICAgICAgIHRoaXMuX2NoYW5nZUFuaW1hdGlvbk5hbWUgPSAiIjsKICAgICAgICAhYiB8fCBiID09PSB0aGlzLl9jdXJyZW50QW5pbWF0aW9uICYmIHRoaXMuSXNBbmltYXRpb25QbGF5aW5nKCkgfHwgKHRoaXMuX2N1cnJlbnRBbmltYXRpb24gPSBiLCB0aGlzLlNldFBsYXlpbmdGb3J3YXJkcygwIDw9IGIuR2V0U3BlZWQoKSksIHRoaXMuX2N1cnJlbnRBbmltYXRpb25TcGVlZCA9IE1hdGguYWJzKGIuR2V0U3BlZWQoKSksIHRoaXMuX2N1cnJlbnRBbmltYXRpb25SZXBlYXRUbyA9IGIuR2V0UmVwZWF0VG8oKSwgdGhpcy5fY3VycmVudEZyYW1lSW5kZXggPSBDMyRqc2NvbXAkMTgwLmNsYW1wKHRoaXMuX2N1cnJlbnRGcmFtZUluZGV4LCAwLCB0aGlzLl9jdXJyZW50QW5pbWF0aW9uLkdldEZyYW1lQ291bnQoKSAtIDEpLCAxID09PSB0aGlzLl9jaGFuZ2VBbmltYXRpb25Gcm9tICYmICh0aGlzLl9jdXJyZW50RnJhbWVJbmRleCA9CiAgICAgICAgICAgIDApLCB0aGlzLlNldEFuaW1hdGlvblBsYXlpbmcoITApLCB0aGlzLl9mcmFtZVN0YXJ0VGltZSA9IHRoaXMuR2V0QW5pbWF0aW9uVGltZSgpLCBiID0gdGhpcy5fY3VycmVudEFuaW1hdGlvbi5HZXRGcmFtZUF0KHRoaXMuX2N1cnJlbnRGcmFtZUluZGV4KSwgdGhpcy5fT25GcmFtZUNoYW5nZWQoYSwgYikpCiAgICB9CiAgICBfRG9DaGFuZ2VBbmltRnJhbWUoKSB7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuX2N1cnJlbnRBbmltYXRpb25GcmFtZTsKICAgICAgICB2YXIgYiA9IHRoaXMuX2N1cnJlbnRGcmFtZUluZGV4OwogICAgICAgIHRoaXMuX2N1cnJlbnRGcmFtZUluZGV4ID0gQzMkanNjb21wJDE4MC5jbGFtcChNYXRoLmZsb29yKHRoaXMuX2NoYW5nZUFuaW1GcmFtZUluZGV4KSwgMCwgdGhpcy5fY3VycmVudEFuaW1hdGlvbi5HZXRGcmFtZUNvdW50KCkgLSAxKTsKICAgICAgICB0aGlzLl9jaGFuZ2VBbmltRnJhbWVJbmRleCA9IC0xOwogICAgICAgIGIgIT09IHRoaXMuX2N1cnJlbnRGcmFtZUluZGV4ICYmIChiID0gdGhpcy5fY3VycmVudEFuaW1hdGlvbi5HZXRGcmFtZUF0KHRoaXMuX2N1cnJlbnRGcmFtZUluZGV4KSwgdGhpcy5fT25GcmFtZUNoYW5nZWQoYSwKICAgICAgICAgICAgYiksIHRoaXMuX2ZyYW1lU3RhcnRUaW1lID0gdGhpcy5HZXRBbmltYXRpb25UaW1lKCkpCiAgICB9CiAgICBfVXBkYXRlQ3VycmVudFRleHR1cmUoKSB7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuX2N1cnJlbnRBbmltYXRpb25GcmFtZS5HZXRJbWFnZUluZm8oKTsKICAgICAgICB0aGlzLl9jdXJyZW50VGV4dHVyZSA9IGEuR2V0VGV4dHVyZSgpOwogICAgICAgIHRoaXMuX2N1cnJlbnRSY1RleCA9IGEuR2V0VGV4UmVjdCgpOwogICAgICAgIHRoaXMuX2N1cnJlbnRRdWFkVGV4ID0gYS5HZXRUZXhRdWFkKCk7CiAgICAgICAgdGhpcy5HZXRXb3JsZEluZm8oKS5TZXRNZXNoQ2hhbmdlZCghMCkKICAgIH0KICAgIEdldFRleHR1cmUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2N1cnJlbnRUZXh0dXJlCiAgICB9CiAgICBHZXRUZXhSZWN0KCkgewogICAgICAgIHJldHVybiB0aGlzLl9jdXJyZW50UmNUZXgKICAgIH0KICAgIEdldFRleFF1YWQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2N1cnJlbnRRdWFkVGV4CiAgICB9CiAgICBHZXRJbWFnZVBvaW50Q291bnQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2N1cnJlbnRBbmltYXRpb25GcmFtZS5HZXRJbWFnZVBvaW50Q291bnQoKQogICAgfQogICAgR2V0SW1hZ2VQb2ludChhKSB7CiAgICAgICAgY29uc3QgYiA9IHRoaXMuX2N1cnJlbnRBbmltYXRpb25GcmFtZSwKICAgICAgICAgICAgZCA9IHRoaXMuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgaWYgKCJzdHJpbmciID09PSB0eXBlb2YgYSkgYSA9IGIuR2V0SW1hZ2VQb2ludEJ5TmFtZShhKTsKICAgICAgICBlbHNlIGlmICgibnVtYmVyIiA9PT0gdHlwZW9mIGEpIGEgPSBiLkdldEltYWdlUG9pbnRCeUluZGV4KGEgLSAxKTsKICAgICAgICBlbHNlIHRocm93IG5ldyBUeXBlRXJyb3IoImV4cGVjdGVkIHN0cmluZyBvciBudW1iZXIiKTsKICAgICAgICBpZiAoIWEpIHJldHVybiBbZC5HZXRYKCksIGQuR2V0WSgpXTsKICAgICAgICB0ZW1wVmVjMiRqc2NvbXAkMS5jb3B5KGEuR2V0VmVjMigpKTsKICAgICAgICBpZiAoZC5IYXNNZXNoKCkpIHsKICAgICAgICAgICAgY29uc3QgW2MsIGVdID0gZC5HZXRTb3VyY2VNZXNoKCkuVHJhbnNmb3JtUG9pbnQodGVtcFZlYzIkanNjb21wJDEuZ2V0WCgpLCB0ZW1wVmVjMiRqc2NvbXAkMS5nZXRZKCkpOwogICAgICAgICAgICB0ZW1wVmVjMiRqc2NvbXAkMS5zZXQoYywgZSkKICAgICAgICB9CiAgICAgICAgdGVtcFZlYzIkanNjb21wJDEub2Zmc2V0KC1iLkdldE9yaWdpblgoKSwgLWIuR2V0T3JpZ2luWSgpKTsKICAgICAgICB0ZW1wVmVjMiRqc2NvbXAkMS5zY2FsZShkLkdldFdpZHRoKCksIGQuR2V0SGVpZ2h0KCkpOwogICAgICAgIHRlbXBWZWMyJGpzY29tcCQxLnJvdGF0ZShkLkdldEFuZ2xlKCkpOwogICAgICAgIHRlbXBWZWMyJGpzY29tcCQxLm9mZnNldChkLkdldFgoKSwgZC5HZXRZKCkpOwogICAgICAgIHJldHVybiBbdGVtcFZlYzIkanNjb21wJDEuZ2V0WCgpLCB0ZW1wVmVjMiRqc2NvbXAkMS5nZXRZKCldCiAgICB9CiAgICBHZXRDb2xsaXNpb25Qb2x5UG9pbnRDb3VudCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5HZXRXb3JsZEluZm8oKS5HZXRUcmFuc2Zvcm1lZENvbGxpc2lvblBvbHkoKS5wb2ludENvdW50KCkKICAgIH0KICAgIEdldENvbGxpc2lvblBvbHlQb2ludChhKSB7CiAgICAgICAgYSA9IE1hdGguZmxvb3IoYSk7CiAgICAgICAgY29uc3QgYiA9IHRoaXMuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgdmFyIGQgPSBiLkdldFRyYW5zZm9ybWVkQ29sbGlzaW9uUG9seSgpOwogICAgICAgIGNvbnN0IGMgPSBkLnBvaW50Q291bnQoKTsKICAgICAgICBhID09PSBjICYmIChhID0gMCk7CiAgICAgICAgaWYgKDAgPiBhIHx8IGEgPj0gYykgcmV0dXJuIFswLCAwXTsKICAgICAgICBkID0gZC5wb2ludHNBcnIoKTsKICAgICAgICByZXR1cm4gW2RbMiAqIGFdICsgYi5HZXRYKCksIGRbMiAqIGEgKyAxXSArIGIuR2V0WSgpXQogICAgfQogICAgR2V0RGVidWdnZXJQcm9wZXJ0aWVzKCkgewogICAgICAgIGNvbnN0IGEgPSBDMyRqc2NvbXAkMTgwLlBsdWdpbnMuU3ByaXRlLkFjdHM7CiAgICAgICAgcmV0dXJuIFt7CiAgICAgICAgICAgIHRpdGxlOiAicGx1Z2lucy5zcHJpdGUuZGVidWdnZXIuYW5pbWF0aW9uLXByb3BlcnRpZXMudGl0bGUiLAogICAgICAgICAgICBwcm9wZXJ0aWVzOiBbewogICAgICAgICAgICAgICAgbmFtZTogInBsdWdpbnMuc3ByaXRlLmRlYnVnZ2VyLmFuaW1hdGlvbi1wcm9wZXJ0aWVzLmN1cnJlbnQtYW5pbWF0aW9uIiwKICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLl9jdXJyZW50QW5pbWF0aW9uLkdldE5hbWUoKSwKICAgICAgICAgICAgICAgIG9uZWRpdDogYiA9PiB0aGlzLkNhbGxBY3Rpb24oYS5TZXRBbmltLCBiLCAwKQogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICBuYW1lOiAicGx1Z2lucy5zcHJpdGUuZGVidWdnZXIuYW5pbWF0aW9uLXByb3BlcnRpZXMuY3VycmVudC1mcmFtZSIsCiAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5fY3VycmVudEZyYW1lSW5kZXgsCiAgICAgICAgICAgICAgICBvbmVkaXQ6IGIgPT4gdGhpcy5DYWxsQWN0aW9uKGEuU2V0QW5pbUZyYW1lLCBiKQogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICBuYW1lOiAicGx1Z2lucy5zcHJpdGUuZGVidWdnZXIuYW5pbWF0aW9uLXByb3BlcnRpZXMuaXMtcGxheWluZyIsCiAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5Jc0FuaW1hdGlvblBsYXlpbmcoKSwKICAgICAgICAgICAgICAgIG9uZWRpdDogYiA9PiBiID8gdGhpcy5DYWxsQWN0aW9uKGEuU3RhcnRBbmltLAogICAgICAgICAgICAgICAgICAgIDApIDogdGhpcy5DYWxsQWN0aW9uKGEuU3RvcEFuaW0pCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgIG5hbWU6ICJwbHVnaW5zLnNwcml0ZS5kZWJ1Z2dlci5hbmltYXRpb24tcHJvcGVydGllcy5zcGVlZCIsCiAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5fY3VycmVudEFuaW1hdGlvblNwZWVkLAogICAgICAgICAgICAgICAgb25lZGl0OiBiID0+IHRoaXMuQ2FsbEFjdGlvbihhLlNldEFuaW1TcGVlZCwgYikKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgbmFtZTogInBsdWdpbnMuc3ByaXRlLmRlYnVnZ2VyLmFuaW1hdGlvbi1wcm9wZXJ0aWVzLnJlcGVhdHMiLAogICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuX2FuaW1hdGlvblJlcGVhdHMsCiAgICAgICAgICAgICAgICBvbmVkaXQ6IGIgPT4gdGhpcy5fYW5pbWF0aW9uUmVwZWF0cyA9IGIKICAgICAgICAgICAgfV0KICAgICAgICB9XQogICAgfQogICAgU2F2ZVRvSnNvbigpIHsKICAgICAgICBjb25zdCBhID0gewogICAgICAgICAgICBhOiB0aGlzLl9jdXJyZW50QW5pbWF0aW9uLkdldFNJRCgpCiAgICAgICAgfTsKICAgICAgICAwICE9PSB0aGlzLl9mcmFtZVN0YXJ0VGltZSAmJiAoYS5mcyA9IHRoaXMuX2ZyYW1lU3RhcnRUaW1lKTsKICAgICAgICB2YXIgYiA9IHRoaXMuR2V0QW5pbWF0aW9uVGltZSgpOwogICAgICAgIDAgIT09IGIgJiYgKGEuYXQgPSBiKTsKICAgICAgICAwICE9PSB0aGlzLl9jdXJyZW50RnJhbWVJbmRleCAmJiAoYS5mID0gdGhpcy5fY3VycmVudEZyYW1lSW5kZXgpOwogICAgICAgIDAgIT09IHRoaXMuX2N1cnJlbnRBbmltYXRpb25TcGVlZCAmJiAoYS5jYXMgPSB0aGlzLl9jdXJyZW50QW5pbWF0aW9uU3BlZWQpOwogICAgICAgIDEgIT09IHRoaXMuX2FuaW1hdGlvblJlcGVhdHMgJiYgKGEuYXIgPSB0aGlzLl9hbmltYXRpb25SZXBlYXRzKTsKICAgICAgICAwICE9PSB0aGlzLl9jdXJyZW50QW5pbWF0aW9uUmVwZWF0VG8gJiYgKGEucnQgPSB0aGlzLl9jdXJyZW50QW5pbWF0aW9uUmVwZWF0VG8pOwogICAgICAgIHRoaXMuSXNBbmltYXRpb25QbGF5aW5nKCkgfHwgKGEuYXAgPSB0aGlzLklzQW5pbWF0aW9uUGxheWluZygpKTsKICAgICAgICB0aGlzLklzUGxheWluZ0ZvcndhcmRzKCkgfHwgKGEuYWYgPSB0aGlzLklzUGxheWluZ0ZvcndhcmRzKCkpOwogICAgICAgIGIgPSB0aGlzLkdldFdvcmxkSW5mbygpOwogICAgICAgIGIuSXNDb2xsaXNpb25FbmFibGVkKCkgJiYgKGEuY2UgPSBiLklzQ29sbGlzaW9uRW5hYmxlZCgpKTsKICAgICAgICByZXR1cm4gYQogICAgfQogICAgTG9hZEZyb21Kc29uKGEpIHsKICAgICAgICB2YXIgYiA9IHRoaXMuR2V0T2JqZWN0Q2xhc3MoKS5HZXRBbmltYXRpb25CeVNJRChhLmEpOwogICAgICAgIGIgJiYgKHRoaXMuX2N1cnJlbnRBbmltYXRpb24gPSBiKTsKICAgICAgICB0aGlzLl9mcmFtZVN0YXJ0VGltZSA9IGEuaGFzT3duUHJvcGVydHkoImZzIikgPyBhLmZzIDogMDsKICAgICAgICB0aGlzLl9hbmltYXRpb25UaW1lci5TZXQoYS5oYXNPd25Qcm9wZXJ0eSgiYXQiKSA/IGEuYXQgOiAwKTsKICAgICAgICBiID0gYS5oYXNPd25Qcm9wZXJ0eSgiZiIpID8gYS5mIDogMDsKICAgICAgICB0aGlzLl9jdXJyZW50RnJhbWVJbmRleCA9IEMzJGpzY29tcCQxODAuY2xhbXAoYiwgMCwgdGhpcy5fY3VycmVudEFuaW1hdGlvbi5HZXRGcmFtZUNvdW50KCkgLSAxKTsKICAgICAgICB0aGlzLl9jdXJyZW50QW5pbWF0aW9uU3BlZWQgPSBhLmhhc093blByb3BlcnR5KCJjYXMiKSA/IGEuY2FzIDogMDsKICAgICAgICB0aGlzLl9hbmltYXRpb25SZXBlYXRzID0gYS5oYXNPd25Qcm9wZXJ0eSgiYXIiKSA/IGEuYXIgOiAxOwogICAgICAgIGIgPSBhLmhhc093blByb3BlcnR5KCJydCIpID8gYS5ydCA6IDA7CiAgICAgICAgdGhpcy5fY3VycmVudEFuaW1hdGlvblJlcGVhdFRvID0gQzMkanNjb21wJDE4MC5jbGFtcChiLCAwLCB0aGlzLl9jdXJyZW50QW5pbWF0aW9uLkdldEZyYW1lQ291bnQoKSAtIDEpOwogICAgICAgIHRoaXMuU2V0QW5pbWF0aW9uUGxheWluZyhhLmhhc093blByb3BlcnR5KCJhcCIpID8KICAgICAgICAgICAgISFhLmFwIDogITApOwogICAgICAgIHRoaXMuU2V0UGxheWluZ0ZvcndhcmRzKGEuaGFzT3duUHJvcGVydHkoImFmIikgPyAhIWEuYWYgOiAhMCk7CiAgICAgICAgdGhpcy5fY3VycmVudEFuaW1hdGlvbkZyYW1lID0gYiA9IHRoaXMuX2N1cnJlbnRBbmltYXRpb24uR2V0RnJhbWVBdCh0aGlzLl9jdXJyZW50RnJhbWVJbmRleCk7CiAgICAgICAgdGhpcy5fVXBkYXRlQ3VycmVudFRleHR1cmUoKTsKICAgICAgICBjb25zdCBkID0gdGhpcy5HZXRXb3JsZEluZm8oKTsKICAgICAgICBkLlNldE9yaWdpblgoYi5HZXRPcmlnaW5YKCkpOwogICAgICAgIGQuU2V0T3JpZ2luWShiLkdldE9yaWdpblkoKSk7CiAgICAgICAgZC5TZXRTb3VyY2VDb2xsaXNpb25Qb2x5KGIuR2V0Q29sbGlzaW9uUG9seSgpKTsKICAgICAgICBkLlNldENvbGxpc2lvbkVuYWJsZWQoISFhLmNlKTsKICAgICAgICB0aGlzLklzQW5pbWF0aW9uUGxheWluZygpICYmIHRoaXMuX1N0YXJ0VGlja2luZygpCiAgICB9CiAgICBHZXRQcm9wZXJ0eVZhbHVlQnlJbmRleChhKSB7CiAgICAgICAgY29uc3QgYiA9IHRoaXMuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgc3dpdGNoIChhKSB7CiAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgIHJldHVybiBiLklzQ29sbGlzaW9uRW5hYmxlZCgpOwogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICByZXR1cm4gQzMkanNjb21wJDE4MC5jbGFtcCh0aGlzLl9jdXJyZW50RnJhbWVJbmRleCwKICAgICAgICAgICAgICAgICAgICAwLCB0aGlzLl9jdXJyZW50QW5pbWF0aW9uLkdldEZyYW1lQ291bnQoKSAtIDEpCiAgICAgICAgfQogICAgfQogICAgU2V0UHJvcGVydHlWYWx1ZUJ5SW5kZXgoYSwgYikgewogICAgICAgIHZhciBkID0gdGhpcy5HZXRXb3JsZEluZm8oKTsKICAgICAgICBzd2l0Y2ggKGEpIHsKICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgZC5TZXRDb2xsaXNpb25FbmFibGVkKCEhYik7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgdGhpcy5TZXRBbmltYXRpb25QbGF5aW5nKCExKTsKICAgICAgICAgICAgICAgIGEgPSB0aGlzLl9jdXJyZW50QW5pbWF0aW9uLkdldEZyYW1lQ291bnQoKSAtIDE7CiAgICAgICAgICAgICAgICBkID0gYiA9IEMzJGpzY29tcCQxODAuY2xhbXAoYiwgMCwgYSk7CiAgICAgICAgICAgICAgICBiID0gdGhpcy5fY3VycmVudEFuaW1hdGlvbi5HZXRGcmFtZUF0KHRoaXMuX2N1cnJlbnRGcmFtZUluZGV4KTsKICAgICAgICAgICAgICAgIGNvbnN0IGMgPSB0aGlzLl9jdXJyZW50QW5pbWF0aW9uLkdldEZyYW1lQXQoZCk7CiAgICAgICAgICAgICAgICB0aGlzLl9PbkZyYW1lQ2hhbmdlZChiLCBjKTsKICAgICAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRGcmFtZUluZGV4ID0gQzMkanNjb21wJDE4MC5jbGFtcChkLCAwLCBhKQogICAgICAgIH0KICAgIH0KICAgIEdldFNjcmlwdEludGVyZmFjZUNsYXNzKCkgewogICAgICAgIHJldHVybiBzZWxmLklTcHJpdGVJbnN0YW5jZQogICAgfQp9Owpjb25zdCBtYXAkanNjb21wJDE5ID0gbmV3IFdlYWtNYXAsCiAgICBBTklNX0ZST01fTU9ERVMgPSBuZXcgTWFwKFsKICAgICAgICBbImN1cnJlbnQtZnJhbWUiLCAwXSwKICAgICAgICBbImJlZ2lubmluZyIsIDFdCiAgICBdKTsKc2VsZi5JU3ByaXRlSW5zdGFuY2UgPSBjbGFzcyBleHRlbmRzIHNlbGYuSVdvcmxkSW5zdGFuY2UgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgICAgc3VwZXIoKTsKICAgICAgICBtYXAkanNjb21wJDE5LnNldCh0aGlzLCBzZWxmLklJbnN0YW5jZS5fR2V0SW5pdEluc3QoKS5HZXRTZGtJbnN0YW5jZSgpKQogICAgfQogICAgZ2V0SW1hZ2VQb2ludENvdW50KCkgewogICAgICAgIHJldHVybiBtYXAkanNjb21wJDE5LmdldCh0aGlzKS5HZXRJbWFnZVBvaW50Q291bnQoKQogICAgfQogICAgZ2V0SW1hZ2VQb2ludFgoYSkgewogICAgICAgIGlmICgic3RyaW5nIiAhPT0gdHlwZW9mIGEgJiYgIm51bWJlciIgIT09IHR5cGVvZiBhKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJleHBlY3RlZCBzdHJpbmcgb3IgbnVtYmVyIik7CiAgICAgICAgcmV0dXJuIG1hcCRqc2NvbXAkMTkuZ2V0KHRoaXMpLkdldEltYWdlUG9pbnQoYSlbMF0KICAgIH0KICAgIGdldEltYWdlUG9pbnRZKGEpIHsKICAgICAgICBpZiAoInN0cmluZyIgIT09IHR5cGVvZiBhICYmICJudW1iZXIiICE9PSB0eXBlb2YgYSkgdGhyb3cgbmV3IFR5cGVFcnJvcigiZXhwZWN0ZWQgc3RyaW5nIG9yIG51bWJlciIpOwogICAgICAgIHJldHVybiBtYXAkanNjb21wJDE5LmdldCh0aGlzKS5HZXRJbWFnZVBvaW50KGEpWzFdCiAgICB9CiAgICBnZXRJbWFnZVBvaW50KGEpIHsKICAgICAgICBpZiAoInN0cmluZyIgIT09CiAgICAgICAgICAgIHR5cGVvZiBhICYmICJudW1iZXIiICE9PSB0eXBlb2YgYSkgdGhyb3cgbmV3IFR5cGVFcnJvcigiZXhwZWN0ZWQgc3RyaW5nIG9yIG51bWJlciIpOwogICAgICAgIHJldHVybiBtYXAkanNjb21wJDE5LmdldCh0aGlzKS5HZXRJbWFnZVBvaW50KGEpCiAgICB9CiAgICBnZXRQb2x5UG9pbnRDb3VudCgpIHsKICAgICAgICByZXR1cm4gbWFwJGpzY29tcCQxOS5nZXQodGhpcykuR2V0Q29sbGlzaW9uUG9seVBvaW50Q291bnQoKQogICAgfQogICAgZ2V0UG9seVBvaW50WChhKSB7CiAgICAgICAgQzNYJGpzY29tcCQxOC5SZXF1aXJlRmluaXRlTnVtYmVyKGEpOwogICAgICAgIHJldHVybiBtYXAkanNjb21wJDE5LmdldCh0aGlzKS5HZXRDb2xsaXNpb25Qb2x5UG9pbnQoYSlbMF0KICAgIH0KICAgIGdldFBvbHlQb2ludFkoYSkgewogICAgICAgIEMzWCRqc2NvbXAkMTguUmVxdWlyZUZpbml0ZU51bWJlcihhKTsKICAgICAgICByZXR1cm4gbWFwJGpzY29tcCQxOS5nZXQodGhpcykuR2V0Q29sbGlzaW9uUG9seVBvaW50KGEpWzFdCiAgICB9CiAgICBnZXRQb2x5UG9pbnQoYSkgewogICAgICAgIEMzWCRqc2NvbXAkMTguUmVxdWlyZUZpbml0ZU51bWJlcihhKTsKICAgICAgICByZXR1cm4gbWFwJGpzY29tcCQxOS5nZXQodGhpcykuR2V0Q29sbGlzaW9uUG9seVBvaW50KGEpCiAgICB9CiAgICBzdG9wQW5pbWF0aW9uKCkgewogICAgICAgIG1hcCRqc2NvbXAkMTkuZ2V0KHRoaXMpLlNldEFuaW1hdGlvblBsYXlpbmcoITEpCiAgICB9CiAgICBzdGFydEFuaW1hdGlvbihhID0KICAgICAgICAiY3VycmVudC1mcmFtZSIpIHsKICAgICAgICBDM1gkanNjb21wJDE4LlJlcXVpcmVTdHJpbmcoYSk7CiAgICAgICAgYSA9IEFOSU1fRlJPTV9NT0RFUy5nZXQoYSk7CiAgICAgICAgaWYgKCJ1bmRlZmluZWQiID09PSB0eXBlb2YgYSkgdGhyb3cgRXJyb3IoImludmFsaWQgbW9kZSIpOwogICAgICAgIG1hcCRqc2NvbXAkMTkuZ2V0KHRoaXMpLl9TdGFydEFuaW0oYSkKICAgIH0KICAgIHNldEFuaW1hdGlvbihhLCBiID0gImJlZ2lubmluZyIpIHsKICAgICAgICBDM1gkanNjb21wJDE4LlJlcXVpcmVTdHJpbmcoYSk7CiAgICAgICAgQzNYJGpzY29tcCQxOC5SZXF1aXJlU3RyaW5nKGIpOwogICAgICAgIGIgPSBBTklNX0ZST01fTU9ERVMuZ2V0KGIpOwogICAgICAgIGlmICgidW5kZWZpbmVkIiA9PT0gdHlwZW9mIGIpIHRocm93IEVycm9yKCJpbnZhbGlkIG1vZGUiKTsKICAgICAgICBjb25zdCBkID0gbWFwJGpzY29tcCQxOS5nZXQodGhpcyk7CiAgICAgICAgaWYgKCFkLkdldE9iamVjdENsYXNzKCkuR2V0QW5pbWF0aW9uQnlOYW1lKGEpKSB0aHJvdyBFcnJvcihgYW5pbWF0aW9uIG5hbWUgIiR7YX0iIGRvZXMgbm90IGV4aXN0YCk7CiAgICAgICAgZC5fU2V0QW5pbShhLCBiKQogICAgfQogICAgZ2V0QW5pbWF0aW9uKGEpIHsKICAgICAgICBDM1gkanNjb21wJDE4LlJlcXVpcmVTdHJpbmcoYSk7CiAgICAgICAgcmV0dXJuIChhID0gbWFwJGpzY29tcCQxOS5nZXQodGhpcykuR2V0T2JqZWN0Q2xhc3MoKS5HZXRBbmltYXRpb25CeU5hbWUoYSkpID8gYS5HZXRJQW5pbWF0aW9uKCkgOiBudWxsCiAgICB9CiAgICBnZXQgYW5pbWF0aW9uKCkgewogICAgICAgIHJldHVybiBtYXAkanNjb21wJDE5LmdldCh0aGlzKS5fR2V0Q3VycmVudEFuaW1hdGlvbigpLkdldElBbmltYXRpb24oKQogICAgfQogICAgZ2V0IGFuaW1hdGlvbk5hbWUoKSB7CiAgICAgICAgcmV0dXJuIG1hcCRqc2NvbXAkMTkuZ2V0KHRoaXMpLl9HZXRDdXJyZW50QW5pbWF0aW9uTmFtZSgpCiAgICB9CiAgICBzZXQgYW5pbWF0aW9uRnJhbWUoYSkgewogICAgICAgIEMzWCRqc2NvbXAkMTguUmVxdWlyZUZpbml0ZU51bWJlcihhKTsKICAgICAgICBtYXAkanNjb21wJDE5LmdldCh0aGlzKS5fU2V0QW5pbUZyYW1lKGEpCiAgICB9CiAgICBnZXQgYW5pbWF0aW9uRnJhbWUoKSB7CiAgICAgICAgcmV0dXJuIG1hcCRqc2NvbXAkMTkuZ2V0KHRoaXMpLl9HZXRBbmltRnJhbWUoKQogICAgfQogICAgc2V0IGFuaW1hdGlvblNwZWVkKGEpIHsKICAgICAgICBDM1gkanNjb21wJDE4LlJlcXVpcmVGaW5pdGVOdW1iZXIoYSk7CiAgICAgICAgbWFwJGpzY29tcCQxOS5nZXQodGhpcykuX1NldEFuaW1TcGVlZChhKQogICAgfQogICAgZ2V0IGFuaW1hdGlvblNwZWVkKCkgewogICAgICAgIHJldHVybiBtYXAkanNjb21wJDE5LmdldCh0aGlzKS5fR2V0QW5pbVNwZWVkKCkKICAgIH0KICAgIHNldCBhbmltYXRpb25SZXBlYXRUb0ZyYW1lKGEpIHsKICAgICAgICBDM1gkanNjb21wJDE4LlJlcXVpcmVGaW5pdGVOdW1iZXIoYSk7CiAgICAgICAgbWFwJGpzY29tcCQxOS5nZXQodGhpcykuX1NldEFuaW1SZXBlYXRUb0ZyYW1lKGEpCiAgICB9CiAgICBnZXQgYW5pbWF0aW9uUmVwZWF0VG9GcmFtZSgpIHsKICAgICAgICByZXR1cm4gbWFwJGpzY29tcCQxOS5nZXQodGhpcykuX0dldEFuaW1SZXBlYXRUb0ZyYW1lKCkKICAgIH0KICAgIGdldCBpbWFnZVdpZHRoKCkgewogICAgICAgIHJldHVybiBtYXAkanNjb21wJDE5LmdldCh0aGlzKS5HZXRDdXJyZW50SW1hZ2VJbmZvKCkuR2V0V2lkdGgoKQogICAgfQogICAgZ2V0IGltYWdlSGVpZ2h0KCkgewogICAgICAgIHJldHVybiBtYXAkanNjb21wJDE5LmdldCh0aGlzKS5HZXRDdXJyZW50SW1hZ2VJbmZvKCkuR2V0SGVpZ2h0KCkKICAgIH0KICAgIHNldFNvbGlkQ29sbGlzaW9uRmlsdGVyKGEsIGIpIHsKICAgICAgICBDM1gkanNjb21wJDE4LlJlcXVpcmVTdHJpbmcoYik7CiAgICAgICAgbWFwJGpzY29tcCQxOS5nZXQodGhpcykuR2V0V29ybGRJbmZvKCkuU2V0U29saWRDb2xsaXNpb25GaWx0ZXIoISFhLCBiKQogICAgfQp9Owpjb25zdCBDMyRqc2NvbXAkMTgxID0gc2VsZi5DMzsKQzMkanNjb21wJDE4MS5QbHVnaW5zLlNwcml0ZS5DbmRzID0gewogICAgSXNBbmltUGxheWluZyhhKSB7CiAgICAgICAgcmV0dXJuIEMzJGpzY29tcCQxODEuZXF1YWxzTm9DYXNlKHRoaXMuX0dldEN1cnJlbnRBbmltYXRpb25OYW1lKCksIGEpCiAgICB9LAogICAgQ29tcGFyZUZyYW1lKGEsIGIpIHsKICAgICAgICByZXR1cm4gQzMkanNjb21wJDE4MS5jb21wYXJlKHRoaXMuX2N1cnJlbnRGcmFtZUluZGV4LCBhLCBiKQogICAgfSwKICAgIENvbXBhcmVBbmltU3BlZWQoYSwgYikgewogICAgICAgIHJldHVybiBDMyRqc2NvbXAkMTgxLmNvbXBhcmUodGhpcy5fR2V0QW5pbVNwZWVkKCksIGEsIGIpCiAgICB9LAogICAgT25BbmltRmluaXNoZWQoYSkgewogICAgICAgIHJldHVybiBDMyRqc2NvbXAkMTgxLmVxdWFsc05vQ2FzZSh0aGlzLl9hbmltVHJpZ2dlck5hbWUsIGEpCiAgICB9LAogICAgT25BbnlBbmltRmluaXNoZWQoKSB7CiAgICAgICAgcmV0dXJuICEwCiAgICB9LAogICAgT25GcmFtZUNoYW5nZWQoKSB7CiAgICAgICAgcmV0dXJuICEwCiAgICB9LAogICAgSXNNaXJyb3JlZCgpIHsKICAgICAgICByZXR1cm4gMCA+IHRoaXMuR2V0V29ybGRJbmZvKCkuR2V0V2lkdGgoKQogICAgfSwKICAgIElzRmxpcHBlZCgpIHsKICAgICAgICByZXR1cm4gMCA+IHRoaXMuR2V0V29ybGRJbmZvKCkuR2V0SGVpZ2h0KCkKICAgIH0sCiAgICBPblVSTExvYWRlZCgpIHsKICAgICAgICByZXR1cm4gITAKICAgIH0sCiAgICBPblVSTEZhaWxlZCgpIHsKICAgICAgICByZXR1cm4gITAKICAgIH0sCiAgICBJc0NvbGxpc2lvbkVuYWJsZWQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuR2V0V29ybGRJbmZvKCkuSXNDb2xsaXNpb25FbmFibGVkKCkKICAgIH0KfTsKY29uc3QgQzMkanNjb21wJDE4MiA9IHNlbGYuQzM7CkMzJGpzY29tcCQxODIuUGx1Z2lucy5TcHJpdGUuQWN0cyA9IHsKICAgIFNwYXduKGEsIGIsIGQsIGMpIHsKICAgICAgICBpZiAoYSAmJiBiKSB7CiAgICAgICAgICAgIHZhciBbZSwgZ10gPSB0aGlzLkdldEltYWdlUG9pbnQoZCk7CiAgICAgICAgICAgIGlmIChkID0gdGhpcy5fcnVudGltZS5DcmVhdGVJbnN0YW5jZShhLCBiLCBlLCBnLCBjKSkgYyAmJiBiLlNvcnRBbmRBZGRJbnN0YW5jZXNCeVpJbmRleChkKSwgYS5HZXRQbHVnaW4oKS5Jc1JvdGF0YWJsZSgpICYmIChiID0gZC5HZXRXb3JsZEluZm8oKSwgYi5TZXRBbmdsZSh0aGlzLkdldFdvcmxkSW5mbygpLkdldEFuZ2xlKCkpLCBiLlNldEJib3hDaGFuZ2VkKCkpLCBiID0gdGhpcy5fcnVudGltZS5HZXRFdmVudFNoZWV0TWFuYWdlcigpLCBiLkJsb2NrRmx1c2hpbmdJbnN0YW5jZXMoITApLCBkLl9UcmlnZ2VyT25DcmVhdGVkT25TZWxmQW5kUmVsYXRlZCgpLCBiLkJsb2NrRmx1c2hpbmdJbnN0YW5jZXMoITEpLCBhICE9PSB0aGlzLkdldE9iamVjdENsYXNzKCkgJiYgdGhpcy5fc2RrVHlwZS5fU3Bhd25QaWNrSW5zdGFuY2UoYSwgZCwgYykKICAgICAgICB9CiAgICB9LAogICAgU3RvcEFuaW0oKSB7CiAgICAgICAgdGhpcy5TZXRBbmltYXRpb25QbGF5aW5nKCExKQogICAgfSwKICAgIFN0YXJ0QW5pbShhKSB7CiAgICAgICAgdGhpcy5fU3RhcnRBbmltKGEpCiAgICB9LAogICAgU2V0QW5pbShhLCBiKSB7CiAgICAgICAgdGhpcy5fU2V0QW5pbShhLCBiKQogICAgfSwKICAgIFNldEFuaW1GcmFtZShhKSB7CiAgICAgICAgdGhpcy5fU2V0QW5pbUZyYW1lKGEpCiAgICB9LAogICAgU2V0QW5pbVNwZWVkKGEpIHsKICAgICAgICB0aGlzLl9TZXRBbmltU3BlZWQoYSkKICAgIH0sCiAgICBTZXRBbmltUmVwZWF0VG9GcmFtZShhKSB7CiAgICAgICAgdGhpcy5fU2V0QW5pbVJlcGVhdFRvRnJhbWUoYSkKICAgIH0sCiAgICBTZXRNaXJyb3JlZChhKSB7CiAgICAgICAgY29uc3QgYiA9IHRoaXMuR2V0V29ybGRJbmZvKCksCiAgICAgICAgICAgIGQgPSBiLkdldFdpZHRoKCk7CiAgICAgICAgYSA9IE1hdGguYWJzKGQpICogKDAgPT09IGEgPyAtMSA6IDEpOwogICAgICAgIGQgIT09IGEgJiYgKGIuU2V0V2lkdGgoYSksIGIuU2V0QmJveENoYW5nZWQoKSkKICAgIH0sCiAgICBTZXRGbGlwcGVkKGEpIHsKICAgICAgICBjb25zdCBiID0gdGhpcy5HZXRXb3JsZEluZm8oKSwKICAgICAgICAgICAgZCA9IGIuR2V0SGVpZ2h0KCk7CiAgICAgICAgYSA9IE1hdGguYWJzKGQpICogKDAgPT09IGEgPyAtMSA6IDEpOwogICAgICAgIGQgIT09IGEgJiYgKGIuU2V0SGVpZ2h0KGEpLCBiLlNldEJib3hDaGFuZ2VkKCkpCiAgICB9LAogICAgU2V0U2NhbGUoYSkgewogICAgICAgIGNvbnN0IGIgPSB0aGlzLl9jdXJyZW50QW5pbWF0aW9uRnJhbWUuR2V0SW1hZ2VJbmZvKCksCiAgICAgICAgICAgIGQgPSB0aGlzLkdldFdvcmxkSW5mbygpOwogICAgICAgIHZhciBjID0gMCA+IGQuR2V0V2lkdGgoKSA/IC0xIDogMTsKICAgICAgICBjb25zdCBlID0gMCA+IGQuR2V0SGVpZ2h0KCkgPyAtMSA6IDE7CiAgICAgICAgYyAqPSBiLkdldFdpZHRoKCkgKiBhOwogICAgICAgIGEgPSBiLkdldEhlaWdodCgpICogYSAqIGU7CiAgICAgICAgaWYgKGQuR2V0V2lkdGgoKSAhPT0gYyB8fCBkLkdldEhlaWdodCgpICE9PSBhKSBkLlNldFNpemUoYywgYSksIGQuU2V0QmJveENoYW5nZWQoKQogICAgfSwKICAgIGFzeW5jIExvYWRVUkwoYSwgYiwgZCkgewogICAgICAgIGQgPSB0aGlzLl9jdXJyZW50QW5pbWF0aW9uRnJhbWUuR2V0SW1hZ2VJbmZvKCk7CiAgICAgICAgY29uc3QgYyA9IHRoaXMuR2V0V29ybGRJbmZvKCksCiAgICAgICAgICAgIGUgPSB0aGlzLl9ydW50aW1lLAogICAgICAgICAgICBnID0gdGhpcy5fc2RrVHlwZTsKICAgICAgICBpZiAoZC5HZXRVUkwoKSA9PT0gYSkgMCA9PT0gYiAmJiAoYy5TZXRTaXplKGQuR2V0V2lkdGgoKSwgZC5HZXRIZWlnaHQoKSksIGMuU2V0QmJveENoYW5nZWQoKSksIHRoaXMuVHJpZ2dlcihDMyRqc2NvbXAkMTgyLlBsdWdpbnMuU3ByaXRlLkNuZHMuT25VUkxMb2FkZWQpOwogICAgICAgIGVsc2UgewogICAgICAgICAgICB2YXIgayA9IEMzJGpzY29tcCQxODIuTmV3KEMzJGpzY29tcCQxODIuSW1hZ2VJbmZvKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGF3YWl0IGsuTG9hZER5bmFtaWNBc3NldChlLCBhKTsKICAgICAgICAgICAgICAgIGlmICghay5Jc0xvYWRlZCgpKSB0aHJvdyBFcnJvcigiaW1hZ2UgZmFpbGVkIHRvIGxvYWQiKTsKICAgICAgICAgICAgICAgIGF3YWl0IGsuTG9hZFN0YXRpY1RleHR1cmUoZS5HZXRSZW5kZXJlcigpLCB7CiAgICAgICAgICAgICAgICAgICAgc2FtcGxpbmc6IHRoaXMuX3J1bnRpbWUuR2V0U2FtcGxpbmcoKQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSBjYXRjaCAobSkgewogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcigiTG9hZCBpbWFnZSBmcm9tIFVSTCBmYWlsZWQ6ICIsIG0pOwogICAgICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKEMzJGpzY29tcCQxODIuUGx1Z2lucy5TcHJpdGUuQ25kcy5PblVSTEZhaWxlZCk7CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBkLlJlcGxhY2VXaXRoKGspOwogICAgICAgICAgICBnLl9VcGRhdGVBbGxDdXJyZW50VGV4dHVyZSgpOwogICAgICAgICAgICBlLlVwZGF0ZVJlbmRlcigpOwogICAgICAgICAgICB0aGlzLldhc1JlbGVhc2VkKCkgfHwgKDAgPT09IGIgJiYgKGMuU2V0U2l6ZShkLkdldFdpZHRoKCksIGQuR2V0SGVpZ2h0KCkpLCBjLlNldEJib3hDaGFuZ2VkKCkpLCBhd2FpdCB0aGlzLlRyaWdnZXJBc3luYyhDMyRqc2NvbXAkMTgyLlBsdWdpbnMuU3ByaXRlLkNuZHMuT25VUkxMb2FkZWQpKQogICAgICAgIH0KICAgIH0sCiAgICBTZXRDb2xsaXNpb25zKGEpIHsKICAgICAgICB0aGlzLkdldFdvcmxkSW5mbygpLlNldENvbGxpc2lvbkVuYWJsZWQoYSkKICAgIH0sCiAgICBTZXRTb2xpZENvbGxpc2lvbkZpbHRlcihhLCBiKSB7CiAgICAgICAgdGhpcy5HZXRXb3JsZEluZm8oKS5TZXRTb2xpZENvbGxpc2lvbkZpbHRlcigwID09PSBhLCBiKQogICAgfSwKICAgIFNldEVmZmVjdChhKSB7CiAgICAgICAgdGhpcy5HZXRXb3JsZEluZm8oKS5TZXRCbGVuZE1vZGUoYSk7CiAgICAgICAgdGhpcy5fcnVudGltZS5VcGRhdGVSZW5kZXIoKQogICAgfQp9OwpzZWxmLkMzLlBsdWdpbnMuU3ByaXRlLkV4cHMgPSB7CiAgICBBbmltYXRpb25GcmFtZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fY3VycmVudEZyYW1lSW5kZXgKICAgIH0sCiAgICBBbmltYXRpb25GcmFtZUNvdW50KCkgewogICAgICAgIHJldHVybiB0aGlzLl9jdXJyZW50QW5pbWF0aW9uLkdldEZyYW1lQ291bnQoKQogICAgfSwKICAgIEFuaW1hdGlvbk5hbWUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2N1cnJlbnRBbmltYXRpb24uR2V0TmFtZSgpCiAgICB9LAogICAgQW5pbWF0aW9uU3BlZWQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX0dldEFuaW1TcGVlZCgpCiAgICB9LAogICAgT3JpZ2luYWxBbmltYXRpb25TcGVlZCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fY3VycmVudEFuaW1hdGlvbi5HZXRTcGVlZCgpCiAgICB9LAogICAgSW1hZ2VQb2ludFgoYSkgewogICAgICAgIHJldHVybiB0aGlzLkdldEltYWdlUG9pbnQoYSlbMF0KICAgIH0sCiAgICBJbWFnZVBvaW50WShhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuR2V0SW1hZ2VQb2ludChhKVsxXQogICAgfSwKICAgIEltYWdlUG9pbnRDb3VudCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5HZXRJbWFnZVBvaW50Q291bnQoKQogICAgfSwKICAgIEltYWdlV2lkdGgoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuR2V0Q3VycmVudEltYWdlSW5mbygpLkdldFdpZHRoKCkKICAgIH0sCiAgICBJbWFnZUhlaWdodCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5HZXRDdXJyZW50SW1hZ2VJbmZvKCkuR2V0SGVpZ2h0KCkKICAgIH0sCiAgICBQb2x5UG9pbnRYQXQoYSkgewogICAgICAgIHJldHVybiB0aGlzLkdldENvbGxpc2lvblBvbHlQb2ludChhKVswXQogICAgfSwKICAgIFBvbHlQb2ludFlBdChhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuR2V0Q29sbGlzaW9uUG9seVBvaW50KGEpWzFdCiAgICB9LAogICAgUG9seVBvaW50Q291bnQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuR2V0Q29sbGlzaW9uUG9seVBvaW50Q291bnQoKQogICAgfQp9OwoidXNlIHN0cmljdCI7CmNvbnN0IEMzJGpzY29tcCQxODQgPSBzZWxmLkMzOwpDMyRqc2NvbXAkMTg0LlBsdWdpbnMuUGFydGljbGVzID0gY2xhc3MgZXh0ZW5kcyBDMyRqc2NvbXAkMTg0LlNES1BsdWdpbkJhc2UgewogICAgY29uc3RydWN0b3IoYSkgewogICAgICAgIHN1cGVyKGEpCiAgICB9CiAgICBSZWxlYXNlKCkgewogICAgICAgIHN1cGVyLlJlbGVhc2UoKQogICAgfQp9Owpjb25zdCBDMyRqc2NvbXAkMTg1ID0gc2VsZi5DMzsKQzMkanNjb21wJDE4NS5QbHVnaW5zLlBhcnRpY2xlcy5UeXBlID0gY2xhc3MgZXh0ZW5kcyBDMyRqc2NvbXAkMTg1LlNES1R5cGVCYXNlIHsKICAgIGNvbnN0cnVjdG9yKGEpIHsKICAgICAgICBzdXBlcihhKQogICAgfQogICAgUmVsZWFzZSgpIHsKICAgICAgICBzdXBlci5SZWxlYXNlKCkKICAgIH0KICAgIE9uQ3JlYXRlKCkgewogICAgICAgIHRoaXMuR2V0SW1hZ2VJbmZvKCkuTG9hZEFzc2V0KHRoaXMuX3J1bnRpbWUpCiAgICB9CiAgICBMb2FkVGV4dHVyZXMoYSkgewogICAgICAgIHJldHVybiB0aGlzLkdldEltYWdlSW5mbygpLkxvYWRTdGF0aWNUZXh0dXJlKGEsIHsKICAgICAgICAgICAgc2FtcGxpbmc6IHRoaXMuX3J1bnRpbWUuR2V0U2FtcGxpbmcoKQogICAgICAgIH0pCiAgICB9CiAgICBSZWxlYXNlVGV4dHVyZXMoKSB7CiAgICAgICAgdGhpcy5HZXRJbWFnZUluZm8oKS5SZWxlYXNlVGV4dHVyZSgpCiAgICB9Cn07CmNvbnN0IEMzJGpzY29tcCQxODYgPSBzZWxmLkMzLAogICAgQzNYJGpzY29tcCQxOSA9IHNlbGYuQzNYLAogICAgdGVtcFJlY3QkanNjb21wJDExID0gQzMkanNjb21wJDE4Ni5OZXcoQzMkanNjb21wJDE4Ni5SZWN0KTsKQzMkanNjb21wJDE4Ni5QbHVnaW5zLlBhcnRpY2xlcy5JbnN0YW5jZSA9IGNsYXNzIGV4dGVuZHMgQzMkanNjb21wJDE4Ni5TREtXb3JsZEluc3RhbmNlQmFzZSB7CiAgICBjb25zdHJ1Y3RvcihhLCBiKSB7CiAgICAgICAgc3VwZXIoYSk7CiAgICAgICAgdGhpcy5faXNGaXJzdFRpY2sgPSAhMDsKICAgICAgICB0aGlzLl9wYXJ0aWNsZUVuZ2luZSA9IGEgPSBDMyRqc2NvbXAkMTg2Lk5ldyhzZWxmLlBhcnRpY2xlRW5naW5lKTsKICAgICAgICBhLm9ub25lc2hvdGZpbmlzaCA9ICgpID0+IHRoaXMuX09uT25lU2hvdEZpbmlzaCgpOwogICAgICAgIHRoaXMuX3NwYXduT2JqZWN0Q2xhc3MgPSBudWxsOwogICAgICAgIHRoaXMuX3BhcnRpY2xlVXBkYXRlQ2FsbGJhY2sgPSAoYywgZSwgZywgaywgbSwgbikgPT4gdGhpcy5fT25QYXJ0aWNsZVVwZGF0ZShjLCBlLCBnLCBrLCBtLCBuKTsKICAgICAgICB0aGlzLl9wYXJ0aWNsZURlc3Ryb3lDYWxsYmFjayA9IGMgPT4gdGhpcy5fT25QYXJ0aWNsZURlc3Ryb3koYyk7CiAgICAgICAgdGhpcy5faGFzQW55RGVmYXVsdFBhcnRpY2xlID0gITA7CiAgICAgICAgYiAmJiAoYS5TZXRSYXRlKGJbMF0pLCBhLlNldFNwcmF5Q29uZShDMyRqc2NvbXAkMTg2LnRvUmFkaWFucyhiWzFdKSksCiAgICAgICAgICAgIGEuU2V0U3ByYXlUeXBlKGJbMl0gPyAib25lLXNob3QiIDogImNvbnRpbnVvdXMtc3ByYXkiKSwgdGhpcy5fU2V0UGFydGljbGVPYmplY3RDbGFzcyh0aGlzLl9ydW50aW1lLkdldE9iamVjdENsYXNzQnlTSUQoYlszXSkpLCBhLlNldEluaXRTcGVlZChiWzRdKSwgYS5TZXRJbml0U2l6ZShiWzVdKSwgYS5TZXRJbml0T3BhY2l0eShiWzZdIC8gMTAwKSwgYS5TZXRHcm93UmF0ZShiWzddKSwgYS5TZXRJbml0WFJhbmRvbShiWzhdKSwgYS5TZXRJbml0WVJhbmRvbShiWzldKSwgYS5TZXRJbml0U3BlZWRSYW5kb20oYlsxMF0pLCBhLlNldEluaXRTaXplUmFuZG9tKGJbMTFdKSwgYS5TZXRHcm93UmFuZG9tKGJbMTJdKSwgYS5TZXRBY2NlbGVyYXRpb24oYlsxM10pLCBhLlNldEdyYXZpdHkoYlsxNF0pLCBhLlNldExpZmVBbmdsZVJhbmRvbShiWzE1XSksIGEuU2V0TGlmZVNwZWVkUmFuZG9tKGJbMTZdKSwgYS5TZXRMaWZlT3BhY2l0eVJhbmRvbShiWzE3XSksIGEuU2V0RGVzdHJveU1vZGVJbmRleChiWzE4XSksIGEuU2V0VGltZW91dChiWzE5XSkpOwogICAgICAgIHRoaXMuX1VwZGF0ZUVuZ2luZVBhcmFtZXRlcnMoKTsKICAgICAgICB0aGlzLl9zcGF3bk9iamVjdENsYXNzICYmICh0aGlzLl9oYXNBbnlEZWZhdWx0UGFydGljbGUgPSAhMSk7CiAgICAgICAgIm9uZS1zaG90IiA9PT0gYS5HZXRTcHJheVR5cGUoKSA/IGEuQ3JlYXRlT25lU2hvdFNwcmF5KCkgOiBhLlNldFNwcmF5aW5nKCEwKTsKICAgICAgICBjb25zdCBkID0gdGhpcy5HZXRXb3JsZEluZm8oKTsKICAgICAgICBkLlNldEJib3hDaGFuZ2VFdmVudEVuYWJsZWQoITApOwogICAgICAgIHRoaXMuX2luc3QuRGlzcGF0Y2hlcigpLmFkZEV2ZW50TGlzdGVuZXIoImJib3hjaGFuZ2UiLCAoKSA9PiB7CiAgICAgICAgICAgIGQuT3ZlcndyaXRlQm91bmRpbmdCb3godGhpcy5fcGFydGljbGVFbmdpbmUuR2V0Qm91bmRpbmdCb3goKSkKICAgICAgICB9KTsKICAgICAgICB0aGlzLkdldFJ1bnRpbWUoKS5HZXRSZW5kZXJlcigpLklzV2ViR1BVKCkgJiYgZC5TZXRVc2VQb2ludHNTaGFkZXJQcm9ncmFtKCk7CiAgICAgICAgdGhpcy5fYWZ0ZXJMb2FkID0gYyA9PiB0aGlzLl9PbkFmdGVyTG9hZChjKTsKICAgICAgICB0aGlzLkdldFJ1bnRpbWUoKS5EaXNwYXRjaGVyKCkuYWRkRXZlbnRMaXN0ZW5lcigiYWZ0ZXJsb2FkIiwKICAgICAgICAgICAgdGhpcy5fYWZ0ZXJMb2FkKTsKICAgICAgICB0aGlzLl9TdGFydFRpY2tpbmcoKQogICAgfQogICAgUmVsZWFzZSgpIHsKICAgICAgICB0aGlzLkdldFJ1bnRpbWUoKS5EaXNwYXRjaGVyKCkucmVtb3ZlRXZlbnRMaXN0ZW5lcigiYWZ0ZXJsb2FkIiwgdGhpcy5fYWZ0ZXJMb2FkKTsKICAgICAgICB0aGlzLl9hZnRlckxvYWQgPSBudWxsOwogICAgICAgIHRoaXMuX3BhcnRpY2xlRW5naW5lLlJlbGVhc2UoKTsKICAgICAgICB0aGlzLl9wYXJ0aWNsZURlc3Ryb3lDYWxsYmFjayA9IHRoaXMuX3BhcnRpY2xlVXBkYXRlQ2FsbGJhY2sgPSB0aGlzLl9wYXJ0aWNsZUVuZ2luZSA9IG51bGw7CiAgICAgICAgc3VwZXIuUmVsZWFzZSgpCiAgICB9CiAgICBHZXRQYXJ0aWNsZUVuZ2luZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcGFydGljbGVFbmdpbmUKICAgIH0KICAgIF9TZXRSYXRlKGEpIHsKICAgICAgICB0aGlzLl9wYXJ0aWNsZUVuZ2luZS5TZXRSYXRlKGEpOwogICAgICAgICJvbmUtc2hvdCIgPT09IHRoaXMuX3BhcnRpY2xlRW5naW5lLkdldFNwcmF5VHlwZSgpICYmIHRoaXMuX2lzRmlyc3RUaWNrICYmIHRoaXMuX3BhcnRpY2xlRW5naW5lLlNldFBhcnRpY2xlQ291bnQoYSkKICAgIH0KICAgIF9TZXRQYXJ0aWNsZU9iamVjdENsYXNzKGEpIHsKICAgICAgICBhID09PQogICAgICAgICAgICB0aGlzLkdldE9iamVjdENsYXNzKCkgJiYgKGEgPSBudWxsKTsKICAgICAgICBhICE9PSB0aGlzLl9zcGF3bk9iamVjdENsYXNzICYmICh0aGlzLl9zcGF3bk9iamVjdENsYXNzID0gYSwgdGhpcy5fcGFydGljbGVFbmdpbmUub25wYXJ0aWNsZWNyZWF0ZSA9IGEgPyBiID0+IHRoaXMuX09uUGFydGljbGVDcmVhdGUoYikgOiBudWxsLCB0aGlzLl9zcGF3bk9iamVjdENsYXNzIHx8ICh0aGlzLl9oYXNBbnlEZWZhdWx0UGFydGljbGUgPSAhMCkpCiAgICB9CiAgICBfVXBkYXRlRW5naW5lUGFyYW1ldGVycygpIHsKICAgICAgICBjb25zdCBhID0gdGhpcy5fcGFydGljbGVFbmdpbmUsCiAgICAgICAgICAgIGIgPSB0aGlzLkdldFdvcmxkSW5mbygpOwogICAgICAgIGEuU2V0TWFzdGVyT3BhY2l0eShiLkdldE9wYWNpdHkoKSk7CiAgICAgICAgYS5TZXRQaXhlbFJvdW5kaW5nKHRoaXMuX3J1bnRpbWUuSXNQaXhlbFJvdW5kaW5nRW5hYmxlZCgpKTsKICAgICAgICBhLlNldFNwYXduWChiLkdldFgoKSk7CiAgICAgICAgYS5TZXRTcGF3blkoYi5HZXRZKCkpOwogICAgICAgIGEuU2V0U3Bhd25BbmdsZShiLkdldEFuZ2xlKCkpOwogICAgICAgIGEuU2V0SW5pdFNpemVTY2FsZShiLkdldFNjZW5lR3JhcGhTY2FsZSgpKQogICAgfQogICAgX09uT25lU2hvdEZpbmlzaCgpIHsKICAgICAgICB0aGlzLl9ydW50aW1lLkRlc3Ryb3lJbnN0YW5jZSh0aGlzLl9pbnN0KQogICAgfQogICAgRHJhdyhhKSB7CiAgICAgICAgaWYgKHRoaXMuX2hhc0FueURlZmF1bHRQYXJ0aWNsZSkgewogICAgICAgICAgICB2YXIgYiA9CiAgICAgICAgICAgICAgICB0aGlzLl9vYmplY3RDbGFzcy5HZXRJbWFnZUluZm8oKSwKICAgICAgICAgICAgICAgIGQgPSBiLkdldFRleHR1cmUoKTsKICAgICAgICAgICAgaWYgKGQpIHsKICAgICAgICAgICAgICAgIHZhciBjID0gdGhpcy5HZXRXb3JsZEluZm8oKSwKICAgICAgICAgICAgICAgICAgICBlID0gYy5HZXRMYXllcigpOwogICAgICAgICAgICAgICAgdGhpcy5fcnVudGltZS5HZXRDYW52YXNNYW5hZ2VyKCkuSXNQYXN0aW5nVG9EcmF3aW5nQ2FudmFzKCkgPyB0ZW1wUmVjdCRqc2NvbXAkMTEuc2V0KC1JbmZpbml0eSwgLUluZmluaXR5LCBJbmZpbml0eSwgSW5maW5pdHkpIDogZS5IYXMzRENhbWVyYSgpID8gZS5DYWxjdWxhdGVWaWV3cG9ydDNEKGMuR2V0VG90YWxaRWxldmF0aW9uKCksIHRlbXBSZWN0JGpzY29tcCQxMSkgOiBlLkdldFZpZXdwb3J0Rm9yWihjLkdldFRvdGFsWkVsZXZhdGlvbigpLCB0ZW1wUmVjdCRqc2NvbXAkMTEpOwogICAgICAgICAgICAgICAgYS5TZXRUZXh0dXJlKGQpOwogICAgICAgICAgICAgICAgZCA9IGUuR2V0MkRTY2FsZUZhY3RvclRvWihjLkdldFRvdGFsWkVsZXZhdGlvbigpKTsKICAgICAgICAgICAgICAgIHRoaXMuX3BhcnRpY2xlRW5naW5lLlNldFBhcnRpY2xlU2NhbGUoZS5HZXRSZW5kZXJTY2FsZSgpICogZCk7CiAgICAgICAgICAgICAgICB0aGlzLl9wYXJ0aWNsZUVuZ2luZS5EcmF3KGEsCiAgICAgICAgICAgICAgICAgICAgYi5HZXRUZXhSZWN0KCksIHRlbXBSZWN0JGpzY29tcCQxMSwgZS5IYXMzRENhbWVyYSgpKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgU2F2ZVRvSnNvbigpIHsKICAgICAgICBjb25zdCBhID0gdGhpcy5fcGFydGljbGVFbmdpbmU7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgcjogYS5HZXRSYXRlKCksCiAgICAgICAgICAgIHNjOiBhLkdldFNwcmF5Q29uZSgpLAogICAgICAgICAgICBzdDogYS5HZXRTcHJheVR5cGUoKSwKICAgICAgICAgICAgaXNwOiBhLkdldEluaXRTcGVlZCgpLAogICAgICAgICAgICBpc3o6IGEuR2V0SW5pdFNpemUoKSwKICAgICAgICAgICAgaW86IGEuR2V0SW5pdE9wYWNpdHkoKSwKICAgICAgICAgICAgZ3I6IGEuR2V0R3Jvd1JhdGUoKSwKICAgICAgICAgICAgeHI6IGEuR2V0SW5pdFhSYW5kb20oKSwKICAgICAgICAgICAgeXI6IGEuR2V0SW5pdFlSYW5kb20oKSwKICAgICAgICAgICAgc3ByOiBhLkdldEluaXRTcGVlZFJhbmRvbSgpLAogICAgICAgICAgICBzenI6IGEuR2V0SW5pdFNpemVSYW5kb20oKSwKICAgICAgICAgICAgZ3JuZDogYS5HZXRHcm93UmFuZG9tKCksCiAgICAgICAgICAgIGFjYzogYS5HZXRBY2NlbGVyYXRpb24oKSwKICAgICAgICAgICAgZzogYS5HZXRHcmF2aXR5KCksCiAgICAgICAgICAgIGxhcjogYS5HZXRMaWZlQW5nbGVSYW5kb20oKSwKICAgICAgICAgICAgbHNyOiBhLkdldExpZmVTcGVlZFJhbmRvbSgpLAogICAgICAgICAgICBsb3I6IGEuR2V0TGlmZU9wYWNpdHlSYW5kb20oKSwKICAgICAgICAgICAgZG06IGEuR2V0RGVzdHJveU1vZGVJbmRleCgpLAogICAgICAgICAgICB0bzogYS5HZXRUaW1lb3V0KCksCiAgICAgICAgICAgIHM6IGEuSXNTcHJheWluZygpLAogICAgICAgICAgICBwY2M6IGEuX0dldENyZWF0ZUNvdW50ZXIoKSwKICAgICAgICAgICAgZnQ6IHRoaXMuX2lzRmlyc3RUaWNrLAogICAgICAgICAgICBzb2M6IHRoaXMuX3NwYXduT2JqZWN0Q2xhc3MgPyB0aGlzLl9zcGF3bk9iamVjdENsYXNzLkdldFNJRCgpIDogbnVsbCwKICAgICAgICAgICAgcDogYS5HZXRQYXJ0aWNsZXMoKS5tYXAoYiA9PiBiLnRvSlNPTigpKQogICAgICAgIH0KICAgIH0KICAgIExvYWRGcm9tSnNvbihhLCBiKSB7CiAgICAgICAgY29uc3QgZCA9IHRoaXMuX3BhcnRpY2xlRW5naW5lOwogICAgICAgIGQuU2V0UmF0ZShhLnIpOwogICAgICAgIGQuU2V0U3ByYXlDb25lKGEuc2MpOwogICAgICAgIGQuU2V0U3ByYXlUeXBlKGEuc3QpOwogICAgICAgIGQuU2V0SW5pdFNwZWVkKGEuaXNwKTsKICAgICAgICBkLlNldEluaXRTaXplKGEuaXN6KTsKICAgICAgICBkLlNldEluaXRPcGFjaXR5KGEuaW8pOwogICAgICAgIGQuU2V0R3Jvd1JhdGUoYS5ncik7CiAgICAgICAgZC5TZXRJbml0WFJhbmRvbShhLnhyKTsKICAgICAgICBkLlNldEluaXRZUmFuZG9tKGEueXIpOwogICAgICAgIGQuU2V0SW5pdFNwZWVkUmFuZG9tKGEuc3ByKTsKICAgICAgICBkLlNldEluaXRTaXplUmFuZG9tKGEuc3pyKTsKICAgICAgICBkLlNldEdyb3dSYW5kb20oYS5ncm5kKTsKICAgICAgICBkLlNldEFjY2VsZXJhdGlvbihhLmFjYyk7CiAgICAgICAgZC5TZXRHcmF2aXR5KGEuZyk7CiAgICAgICAgZC5TZXRMaWZlQW5nbGVSYW5kb20oYS5sYXIpOwogICAgICAgIGQuU2V0TGlmZVNwZWVkUmFuZG9tKGEubHNyKTsKICAgICAgICBkLlNldExpZmVPcGFjaXR5UmFuZG9tKGEubG9yKTsKICAgICAgICBkLlNldERlc3Ryb3lNb2RlSW5kZXgoYS5kbSk7CiAgICAgICAgZC5TZXRUaW1lb3V0KGEudG8pOwogICAgICAgIGQuU2V0U3ByYXlpbmcoYS5zKTsKICAgICAgICBkLl9TZXRDcmVhdGVDb3VudGVyKGEucGNjKTsKICAgICAgICB0aGlzLl9pc0ZpcnN0VGljayA9IGEuZnQ7CiAgICAgICAgaWYgKGEuaGFzT3duUHJvcGVydHkoInNvYyIpKSB7CiAgICAgICAgICAgIHZhciBjID0gdGhpcy5HZXRSdW50aW1lKCkuR2V0T2JqZWN0Q2xhc3NCeVNJRChhLnNvYyk7CiAgICAgICAgICAgIGMgJiYgdGhpcy5fU2V0UGFydGljbGVPYmplY3RDbGFzcyhjKQogICAgICAgIH0KICAgICAgICBhID0gYS5wOwogICAgICAgIGQuU2V0UGFydGljbGVDb3VudChhLmxlbmd0aCk7CiAgICAgICAgYyA9IGQuR2V0UGFydGljbGVzKCk7CiAgICAgICAgZm9yIChsZXQgZSA9IDAsIGcgPSBjLmxlbmd0aDsgZSA8IGc7ICsrZSkgY1tlXS5zZXRGcm9tSlNPTihhW2VdKTsKICAgICAgICAic3RhdGUiID09PSBiICYmIHRoaXMuX3NwYXduT2JqZWN0Q2xhc3MgJiYgKGQuVXBkYXRlQWxsUGFydGljbGVzVXNlckRhdGEoKSwKICAgICAgICAgICAgZC5BcHBseVBhcnRpY2xlRGF0YVRvVXNlckRhdGEodGhpcykpCiAgICB9CiAgICBfT25BZnRlckxvYWQoKSB7CiAgICAgICAgdmFyIGEgPSB0aGlzLl9wYXJ0aWNsZUVuZ2luZTsKICAgICAgICBhLlVwZGF0ZUFsbFBhcnRpY2xlc1VzZXJEYXRhKCk7CiAgICAgICAgYS5BcHBseVBhcnRpY2xlRGF0YVRvVXNlckRhdGEodGhpcyk7CiAgICAgICAgaWYgKCJvbmUtc2hvdCIgPT09IGEuR2V0U3ByYXlUeXBlKCkpIHsKICAgICAgICAgICAgYSA9IGEuR2V0UGFydGljbGVzKCk7CiAgICAgICAgICAgIGZvciAobGV0IGMgPSAwLCBlID0gYS5sZW5ndGg7IGMgPCBlOyArK2MpIHsKICAgICAgICAgICAgICAgIHZhciBiID0gYVtjXSwKICAgICAgICAgICAgICAgICAgICBkID0gYi5HZXRVc2VyRGF0YSgpOwogICAgICAgICAgICAgICAgZCAmJiAoZCA9IGQuR2V0V29ybGRJbmZvKCkpICYmIChkID0gZC5HZXRJbnN0YW5jZSgpKSAmJiAoYiA9IGIuR2V0VXNlckRhdGFVSUQoKSwgZCA9IGQuR2V0VUlEKCksICJudW1iZXIiICE9PSB0eXBlb2YgYiB8fCAibnVtYmVyIiAhPT0gdHlwZW9mIGQgfHwgYiAhPT0gZCkgJiYgKGQgPSB0aGlzLkdldFJ1bnRpbWUoKSwgKGIgPSBkLkdldEluc3RhbmNlQnlVSUQoYikpICYmIGQuRGVzdHJveUluc3RhbmNlKGIpKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgVGljaygpIHsKICAgICAgICBjb25zdCBhID0gdGhpcy5fcnVudGltZS5HZXREdCh0aGlzLl9pbnN0KTsKICAgICAgICB0aGlzLl9VcGRhdGVFbmdpbmVQYXJhbWV0ZXJzKCk7CiAgICAgICAgdGhpcy5faXNGaXJzdFRpY2sgJiYgIm9uZS1zaG90IiA9PT0gdGhpcy5fcGFydGljbGVFbmdpbmUuR2V0U3ByYXlUeXBlKCkgJiYgdGhpcy5fcGFydGljbGVFbmdpbmUuUmVJbml0QWxsUGFydGljbGVzKCk7CiAgICAgICAgdGhpcy5fcGFydGljbGVFbmdpbmUuVGljayhhKTsKICAgICAgICB0aGlzLl9wYXJ0aWNsZUVuZ2luZS5Jc1NwcmF5aW5nKCkgJiYgdGhpcy5fcnVudGltZS5VcGRhdGVSZW5kZXIoKTsKICAgICAgICB0aGlzLkdldFdvcmxkSW5mbygpLlNldEJib3hDaGFuZ2VkKCk7CiAgICAgICAgdGhpcy5faXNGaXJzdFRpY2sgPSAhMQogICAgfQogICAgX09uUGFydGljbGVDcmVhdGUoYSkgewogICAgICAgIGNvbnN0IGIgPSB0aGlzLl9ydW50aW1lLkNyZWF0ZUluc3RhbmNlKHRoaXMuX3NwYXduT2JqZWN0Q2xhc3MsIHRoaXMuR2V0V29ybGRJbmZvKCkuR2V0TGF5ZXIoKSwgYS5HZXRYKCksIGEuR2V0WSgpKSwKICAgICAgICAgICAgZCA9IGIuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgZC5TZXRTaXplKGEuR2V0U2l6ZSgpLCBhLkdldFNpemUoKSk7CiAgICAgICAgZC5TZXRBbmdsZShhLkdldEFuZ2xlKCkpOwogICAgICAgIGQuU2V0T3BhY2l0eShhLkdldE9wYWNpdHkoKSk7CiAgICAgICAgZC5TZXRVbnByZW11bHRpcGxpZWRDb2xvcih0aGlzLkdldFdvcmxkSW5mbygpLkdldFVucHJlbXVsdGlwbGllZENvbG9yKCkpOwogICAgICAgIGQuU2V0QmJveENoYW5nZWQoKTsKICAgICAgICBkLlpPcmRlck1vdmVBZGphY2VudFRvSW5zdGFuY2UodGhpcy5HZXRJbnN0YW5jZSgpLCAhMCk7CiAgICAgICAgYi5fVHJpZ2dlck9uQ3JlYXRlZCgpOwogICAgICAgIGEuU2V0VXBkYXRlQ2FsbGJhY2sodGhpcy5fcGFydGljbGVVcGRhdGVDYWxsYmFjayk7CiAgICAgICAgYS5TZXREZXN0cm95Q2FsbGJhY2sodGhpcy5fcGFydGljbGVEZXN0cm95Q2FsbGJhY2spOwogICAgICAgIHJldHVybiBiCiAgICB9CiAgICBfT25QYXJ0aWNsZVVwZGF0ZShhLCBiLCBkLCBjLCBlLCBnKSB7CiAgICAgICAgYS5Jc0Rlc3Ryb3llZCgpIHx8IChhID0gYS5HZXRXb3JsZEluZm8oKSwgYS5PZmZzZXRYWShiLCBkKSwgYS5TZXRTaXplKGEuR2V0V2lkdGgoKSArIGMsIGEuR2V0SGVpZ2h0KCkgKyBjKSwgYS5TZXRBbmdsZShhLkdldEFuZ2xlKCkgKyBlKSwgYS5TZXRPcGFjaXR5KGEuR2V0T3BhY2l0eSgpICsgZyksIGEuU2V0QmJveENoYW5nZWQoKSkKICAgIH0KICAgIF9PblBhcnRpY2xlRGVzdHJveShhKSB7CiAgICAgICAgYS5Jc0Rlc3Ryb3llZCgpIHx8CiAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuRGVzdHJveUluc3RhbmNlKGEpCiAgICB9CiAgICBHZXRQcm9wZXJ0eVZhbHVlQnlJbmRleChhKSB7CiAgICAgICAgY29uc3QgYiA9IHRoaXMuX3BhcnRpY2xlRW5naW5lOwogICAgICAgIHN3aXRjaCAoYSkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICByZXR1cm4gYi5HZXRSYXRlKCk7CiAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgIHJldHVybiBDMyRqc2NvbXAkMTg2LnRvRGVncmVlcyhiLkdldFNwcmF5Q29uZSgpKTsKICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgcmV0dXJuICJvbmUtc2hvdCIgPT09IGIuR2V0U3ByYXlUeXBlKCkgPyAxIDogMDsKICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgcmV0dXJuIGIuR2V0SW5pdFNwZWVkKCk7CiAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgIHJldHVybiBiLkdldEluaXRTaXplKCk7CiAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICAgIHJldHVybiAxMDAgKiBiLkdldEluaXRPcGFjaXR5KCk7CiAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICAgIHJldHVybiBiLkdldEdyb3dSYXRlKCk7CiAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICAgIHJldHVybiBiLkdldEluaXRYUmFuZG9tKCk7CiAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICAgIHJldHVybiBiLkdldEluaXRZUmFuZG9tKCk7CiAgICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgICAgICByZXR1cm4gYi5HZXRJbml0U3BlZWRSYW5kb20oKTsKICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgICAgIHJldHVybiBiLkdldEluaXRTaXplUmFuZG9tKCk7CiAgICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgICAgICByZXR1cm4gYi5HZXRHcm93UmFuZG9tKCk7CiAgICAgICAgICAgIGNhc2UgMTM6CiAgICAgICAgICAgICAgICByZXR1cm4gYi5HZXRBY2NlbGVyYXRpb24oKTsKICAgICAgICAgICAgY2FzZSAxNDoKICAgICAgICAgICAgICAgIHJldHVybiBiLkdldEdyYXZpdHkoKTsKICAgICAgICAgICAgY2FzZSAxNToKICAgICAgICAgICAgICAgIHJldHVybiBiLkdldExpZmVBbmdsZVJhbmRvbSgpOwogICAgICAgICAgICBjYXNlIDE2OgogICAgICAgICAgICAgICAgcmV0dXJuIGIuR2V0TGlmZVNwZWVkUmFuZG9tKCk7CiAgICAgICAgICAgIGNhc2UgMTc6CiAgICAgICAgICAgICAgICByZXR1cm4gYi5HZXRMaWZlT3BhY2l0eVJhbmRvbSgpOwogICAgICAgICAgICBjYXNlIDE4OgogICAgICAgICAgICAgICAgcmV0dXJuIGIuR2V0RGVzdHJveU1vZGVJbmRleCgpOwogICAgICAgICAgICBjYXNlIDE5OgogICAgICAgICAgICAgICAgcmV0dXJuIGIuR2V0VGltZW91dCgpCiAgICAgICAgfQogICAgfQogICAgU2V0UHJvcGVydHlWYWx1ZUJ5SW5kZXgoYSwgYikgewogICAgICAgIGNvbnN0IGQgPSB0aGlzLl9wYXJ0aWNsZUVuZ2luZTsKICAgICAgICBzd2l0Y2ggKGEpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgZC5TZXRSYXRlKGIpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgIGQuU2V0U3ByYXlDb25lKEMzJGpzY29tcCQxODYudG9SYWRpYW5zKGIpKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICBkLlNldFNwcmF5VHlwZShiID8gIm9uZS1zaG90IiA6ICJjb250aW51b3VzLXNwcmF5Iik7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgZC5TZXRJbml0U3BlZWQoYik7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgICAgZC5TZXRJbml0U2l6ZShiKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgICBkLlNldEluaXRPcGFjaXR5KGIgLyAxMDApOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICAgIGQuU2V0R3Jvd1JhdGUoYik7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICAgICAgZC5TZXRJbml0WFJhbmRvbShiKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgICAgICBkLlNldEluaXRZUmFuZG9tKGIpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgICAgICBkLlNldEluaXRTcGVlZFJhbmRvbShiKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICAgICAgZC5TZXRJbml0U2l6ZVJhbmRvbShiKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDEyOgogICAgICAgICAgICAgICAgZC5TZXRHcm93UmFuZG9tKGIpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMTM6CiAgICAgICAgICAgICAgICBkLlNldEFjY2VsZXJhdGlvbihiKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDE0OgogICAgICAgICAgICAgICAgZC5TZXRHcmF2aXR5KGIpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMTU6CiAgICAgICAgICAgICAgICBkLlNldExpZmVBbmdsZVJhbmRvbShiKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDE2OgogICAgICAgICAgICAgICAgZC5TZXRMaWZlU3BlZWRSYW5kb20oYik7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAxNzoKICAgICAgICAgICAgICAgIGQuU2V0TGlmZU9wYWNpdHlSYW5kb20oYik7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAxODoKICAgICAgICAgICAgICAgIGQuU2V0RGVzdHJveU1vZGVJbmRleChiKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDE5OgogICAgICAgICAgICAgICAgZC5TZXRUaW1lb3V0KGIpCiAgICAgICAgfQogICAgfQogICAgR2V0RGVidWdnZXJQcm9wZXJ0aWVzKCkgewogICAgICAgIGNvbnN0IGEgPQogICAgICAgICAgICB0aGlzLl9wYXJ0aWNsZUVuZ2luZTsKICAgICAgICByZXR1cm4gW3sKICAgICAgICAgICAgdGl0bGU6ICJwbHVnaW5zLnBhcnRpY2xlcy5uYW1lIiwKICAgICAgICAgICAgcHJvcGVydGllczogW3sKICAgICAgICAgICAgICAgICAgICBuYW1lOiAicGx1Z2lucy5wYXJ0aWNsZXMuZGVidWdnZXIucGFydGljbGUtY291bnQiLAogICAgICAgICAgICAgICAgICAgIHZhbHVlOiBhLkdldFBhcnRpY2xlQ291bnQoKQogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgIG5hbWU6ICJwbHVnaW5zLnBhcnRpY2xlcy5wcm9wZXJ0aWVzLnR5cGUubmFtZSIsCiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IFsicGx1Z2lucy5wYXJ0aWNsZXMucHJvcGVydGllcy50eXBlLml0ZW1zLiIgKyBhLkdldFNwcmF5VHlwZSgpXQogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgIG5hbWU6ICJwbHVnaW5zLnBhcnRpY2xlcy5kZWJ1Z2dlci5pcy1zcHJheWluZyIsCiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGEuSXNTcHJheWluZygpLAogICAgICAgICAgICAgICAgICAgIG9uZWRpdDogYiA9PiBhLlNldFNwcmF5aW5nKGIpCiAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgbmFtZTogInBsdWdpbnMucGFydGljbGVzLnByb3BlcnRpZXMucmF0ZS5uYW1lIiwKICAgICAgICAgICAgICAgICAgICB2YWx1ZTogYS5HZXRSYXRlKCksCiAgICAgICAgICAgICAgICAgICAgb25lZGl0OiBiID0+IGEuU2V0UmF0ZShiKQogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgIG5hbWU6ICJwbHVnaW5zLnBhcnRpY2xlcy5wcm9wZXJ0aWVzLnNwcmF5LWNvbmUubmFtZSIsCiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IEMzJGpzY29tcCQxODYudG9EZWdyZWVzKGEuR2V0U3ByYXlDb25lKCkpLAogICAgICAgICAgICAgICAgICAgIG9uZWRpdDogYiA9PiBhLlNldFNwcmF5Q29uZShDMyRqc2NvbXAkMTg2LnRvUmFkaWFucyhiKSkKICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICBuYW1lOiAicGx1Z2lucy5wYXJ0aWNsZXMucHJvcGVydGllcy5zcGVlZC5uYW1lIiwKICAgICAgICAgICAgICAgICAgICB2YWx1ZTogYS5HZXRJbml0U3BlZWQoKSwKICAgICAgICAgICAgICAgICAgICBvbmVkaXQ6IGIgPT4gYS5TZXRJbml0U3BlZWQoYikKICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICBuYW1lOiAicGx1Z2lucy5wYXJ0aWNsZXMucHJvcGVydGllcy5zaXplLm5hbWUiLAogICAgICAgICAgICAgICAgICAgIHZhbHVlOiBhLkdldEluaXRTaXplKCksCiAgICAgICAgICAgICAgICAgICAgb25lZGl0OiBiID0+IGEuU2V0SW5pdFNpemUoYikKICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICBuYW1lOiAicGx1Z2lucy5wYXJ0aWNsZXMucHJvcGVydGllcy5vcGFjaXR5Lm5hbWUiLAogICAgICAgICAgICAgICAgICAgIHZhbHVlOiBhLkdldEluaXRPcGFjaXR5KCksCiAgICAgICAgICAgICAgICAgICAgb25lZGl0OiBiID0+IGEuU2V0SW5pdE9wYWNpdHkoYikKICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICBuYW1lOiAicGx1Z2lucy5wYXJ0aWNsZXMucHJvcGVydGllcy5ncm93LXJhdGUubmFtZSIsCiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGEuR2V0R3Jvd1JhdGUoKSwKICAgICAgICAgICAgICAgICAgICBvbmVkaXQ6IGIgPT4gYS5TZXRHcm93UmF0ZShiKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBuYW1lOiAicGx1Z2lucy5wYXJ0aWNsZXMucHJvcGVydGllcy54LXJhbmRvbWlzZXIubmFtZSIsCiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGEuR2V0SW5pdFhSYW5kb20oKSwKICAgICAgICAgICAgICAgICAgICBvbmVkaXQ6IGIgPT4gYS5TZXRJbml0WFJhbmRvbShiKQogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgIG5hbWU6ICJwbHVnaW5zLnBhcnRpY2xlcy5wcm9wZXJ0aWVzLnktcmFuZG9taXNlci5uYW1lIiwKICAgICAgICAgICAgICAgICAgICB2YWx1ZTogYS5HZXRJbml0WVJhbmRvbSgpLAogICAgICAgICAgICAgICAgICAgIG9uZWRpdDogYiA9PiBhLlNldEluaXRZUmFuZG9tKGIpCiAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgbmFtZTogInBsdWdpbnMucGFydGljbGVzLnByb3BlcnRpZXMuaW5pdGlhbC1zcGVlZC1yYW5kb21pc2VyLm5hbWUiLAogICAgICAgICAgICAgICAgICAgIHZhbHVlOiBhLkdldEluaXRTcGVlZFJhbmRvbSgpLAogICAgICAgICAgICAgICAgICAgIG9uZWRpdDogYiA9PiBhLlNldEluaXRTcGVlZFJhbmRvbShiKQogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgIG5hbWU6ICJwbHVnaW5zLnBhcnRpY2xlcy5wcm9wZXJ0aWVzLnNpemUtcmFuZG9taXNlci5uYW1lIiwKICAgICAgICAgICAgICAgICAgICB2YWx1ZTogYS5HZXRJbml0U2l6ZVJhbmRvbSgpLAogICAgICAgICAgICAgICAgICAgIG9uZWRpdDogYiA9PiBhLlNldEluaXRTaXplUmFuZG9tKGIpCiAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgbmFtZTogInBsdWdpbnMucGFydGljbGVzLnByb3BlcnRpZXMuZ3Jvdy1yYXRlLXJhbmRvbWlzZXIubmFtZSIsCiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGEuR2V0R3Jvd1JhbmRvbSgpLAogICAgICAgICAgICAgICAgICAgIG9uZWRpdDogYiA9PiBhLlNldEdyb3dSYW5kb20oYikKICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICBuYW1lOiAicGx1Z2lucy5wYXJ0aWNsZXMucHJvcGVydGllcy5hY2NlbGVyYXRpb24ubmFtZSIsCiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGEuR2V0QWNjZWxlcmF0aW9uKCksCiAgICAgICAgICAgICAgICAgICAgb25lZGl0OiBiID0+IGEuU2V0QWNjZWxlcmF0aW9uKGIpCiAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgbmFtZTogInBsdWdpbnMucGFydGljbGVzLnByb3BlcnRpZXMuZ3Jhdml0eS5uYW1lIiwKICAgICAgICAgICAgICAgICAgICB2YWx1ZTogYS5HZXRHcmF2aXR5KCksCiAgICAgICAgICAgICAgICAgICAgb25lZGl0OiBiID0+IGEuU2V0R3Jhdml0eShiKQogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgIG5hbWU6ICJwbHVnaW5zLnBhcnRpY2xlcy5wcm9wZXJ0aWVzLmFuZ2xlLXJhbmRvbWlzZXIubmFtZSIsCiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGEuR2V0TGlmZUFuZ2xlUmFuZG9tKCksCiAgICAgICAgICAgICAgICAgICAgb25lZGl0OiBiID0+IGEuU2V0TGlmZUFuZ2xlUmFuZG9tKGIpCiAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgbmFtZTogInBsdWdpbnMucGFydGljbGVzLnByb3BlcnRpZXMubGlmZS1zcGVlZC1yYW5kb21pc2VyLm5hbWUiLAogICAgICAgICAgICAgICAgICAgIHZhbHVlOiBhLkdldExpZmVTcGVlZFJhbmRvbSgpLAogICAgICAgICAgICAgICAgICAgIG9uZWRpdDogYiA9PiBhLlNldExpZmVTcGVlZFJhbmRvbShiKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBuYW1lOiAicGx1Z2lucy5wYXJ0aWNsZXMucHJvcGVydGllcy5vcGFjaXR5LXJhbmRvbWlzZXIubmFtZSIsCiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGEuR2V0TGlmZU9wYWNpdHlSYW5kb20oKSwKICAgICAgICAgICAgICAgICAgICBvbmVkaXQ6IGIgPT4gYS5TZXRMaWZlT3BhY2l0eVJhbmRvbShiKQogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgIG5hbWU6ICJwbHVnaW5zLnBhcnRpY2xlcy5wcm9wZXJ0aWVzLnRpbWVvdXQubmFtZSIsCiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGEuR2V0VGltZW91dCgpLAogICAgICAgICAgICAgICAgICAgIG9uZWRpdDogYiA9PiBhLlNldFRpbWVvdXQoYikKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgXQogICAgICAgIH1dCiAgICB9CiAgICBHZXRTY3JpcHRJbnRlcmZhY2VDbGFzcygpIHsKICAgICAgICByZXR1cm4gc2VsZi5JUGFydGljbGVzSW5zdGFuY2UKICAgIH0KfTsKY29uc3QgbWFwJGpzY29tcCQyMCA9IG5ldyBXZWFrTWFwOwoKZnVuY3Rpb24gR2V0UGFydGljbGVFbmdpbmUoYSkgewogICAgcmV0dXJuIG1hcCRqc2NvbXAkMjAuZ2V0KGEpLkdldFBhcnRpY2xlRW5naW5lKCkKfQpzZWxmLklQYXJ0aWNsZXNJbnN0YW5jZSA9IGNsYXNzIGV4dGVuZHMgc2VsZi5JV29ybGRJbnN0YW5jZSB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgICBzdXBlcigpOwogICAgICAgIG1hcCRqc2NvbXAkMjAuc2V0KHRoaXMsIHNlbGYuSUluc3RhbmNlLl9HZXRJbml0SW5zdCgpLkdldFNka0luc3RhbmNlKCkpCiAgICB9CiAgICBzZXQgaXNTcHJheWluZyhhKSB7CiAgICAgICAgR2V0UGFydGljbGVFbmdpbmUodGhpcykuU2V0U3ByYXlpbmcoISFhKQogICAgfQogICAgZ2V0IGlzU3ByYXlpbmcoKSB7CiAgICAgICAgcmV0dXJuIEdldFBhcnRpY2xlRW5naW5lKHRoaXMpLklzU3ByYXlpbmcoKQogICAgfQogICAgc2V0IHJhdGUoYSkgewogICAgICAgIEMzWCRqc2NvbXAkMTkuUmVxdWlyZUZpbml0ZU51bWJlcihhKTsKICAgICAgICBtYXAkanNjb21wJDIwLmdldCh0aGlzKS5fU2V0UmF0ZShhKQogICAgfQogICAgZ2V0IHJhdGUoKSB7CiAgICAgICAgcmV0dXJuIEdldFBhcnRpY2xlRW5naW5lKHRoaXMpLkdldFJhdGUoKQogICAgfQogICAgc2V0IHNwcmF5Q29uZShhKSB7CiAgICAgICAgQzNYJGpzY29tcCQxOS5SZXF1aXJlRmluaXRlTnVtYmVyKGEpOwogICAgICAgIEdldFBhcnRpY2xlRW5naW5lKHRoaXMpLlNldFNwcmF5Q29uZShhKQogICAgfQogICAgZ2V0IHNwcmF5Q29uZSgpIHsKICAgICAgICByZXR1cm4gR2V0UGFydGljbGVFbmdpbmUodGhpcykuR2V0U3ByYXlDb25lKCkKICAgIH0KICAgIHNldCBpbml0U3BlZWQoYSkgewogICAgICAgIEMzWCRqc2NvbXAkMTkuUmVxdWlyZUZpbml0ZU51bWJlcihhKTsKICAgICAgICBHZXRQYXJ0aWNsZUVuZ2luZSh0aGlzKS5TZXRJbml0U3BlZWQoYSkKICAgIH0KICAgIGdldCBpbml0U3BlZWQoKSB7CiAgICAgICAgcmV0dXJuIEdldFBhcnRpY2xlRW5naW5lKHRoaXMpLkdldEluaXRTcGVlZCgpCiAgICB9CiAgICBzZXQgaW5pdFNpemUoYSkgewogICAgICAgIEMzWCRqc2NvbXAkMTkuUmVxdWlyZUZpbml0ZU51bWJlcihhKTsKICAgICAgICBHZXRQYXJ0aWNsZUVuZ2luZSh0aGlzKS5TZXRJbml0U2l6ZShhKQogICAgfQogICAgZ2V0IGluaXRTaXplKCkgewogICAgICAgIHJldHVybiBHZXRQYXJ0aWNsZUVuZ2luZSh0aGlzKS5HZXRJbml0U2l6ZSgpCiAgICB9CiAgICBzZXQgaW5pdE9wYWNpdHkoYSkgewogICAgICAgIEMzWCRqc2NvbXAkMTkuUmVxdWlyZUZpbml0ZU51bWJlcihhKTsKICAgICAgICBHZXRQYXJ0aWNsZUVuZ2luZSh0aGlzKS5TZXRJbml0T3BhY2l0eShhKQogICAgfQogICAgZ2V0IGluaXRPcGFjaXR5KCkgewogICAgICAgIHJldHVybiBHZXRQYXJ0aWNsZUVuZ2luZSh0aGlzKS5HZXRJbml0T3BhY2l0eSgpCiAgICB9CiAgICBzZXQgaW5pdFhSYW5kb20oYSkgewogICAgICAgIEMzWCRqc2NvbXAkMTkuUmVxdWlyZUZpbml0ZU51bWJlcihhKTsKICAgICAgICBHZXRQYXJ0aWNsZUVuZ2luZSh0aGlzKS5TZXRJbml0WFJhbmRvbShhKQogICAgfQogICAgZ2V0IGluaXRYUmFuZG9tKCkgewogICAgICAgIHJldHVybiBHZXRQYXJ0aWNsZUVuZ2luZSh0aGlzKS5HZXRJbml0WFJhbmRvbSgpCiAgICB9CiAgICBzZXQgaW5pdFlSYW5kb20oYSkgewogICAgICAgIEMzWCRqc2NvbXAkMTkuUmVxdWlyZUZpbml0ZU51bWJlcihhKTsKICAgICAgICBHZXRQYXJ0aWNsZUVuZ2luZSh0aGlzKS5TZXRJbml0WVJhbmRvbShhKQogICAgfQogICAgZ2V0IGluaXRZUmFuZG9tKCkgewogICAgICAgIHJldHVybiBHZXRQYXJ0aWNsZUVuZ2luZSh0aGlzKS5HZXRJbml0WVJhbmRvbSgpCiAgICB9CiAgICBzZXQgaW5pdFNwZWVkUmFuZG9tKGEpIHsKICAgICAgICBDM1gkanNjb21wJDE5LlJlcXVpcmVGaW5pdGVOdW1iZXIoYSk7CiAgICAgICAgR2V0UGFydGljbGVFbmdpbmUodGhpcykuU2V0SW5pdFNwZWVkUmFuZG9tKGEpCiAgICB9CiAgICBnZXQgaW5pdFNwZWVkUmFuZG9tKCkgewogICAgICAgIHJldHVybiBHZXRQYXJ0aWNsZUVuZ2luZSh0aGlzKS5HZXRJbml0U3BlZWRSYW5kb20oKQogICAgfQogICAgc2V0IGluaXRTaXplUmFuZG9tKGEpIHsKICAgICAgICBDM1gkanNjb21wJDE5LlJlcXVpcmVGaW5pdGVOdW1iZXIoYSk7CiAgICAgICAgR2V0UGFydGljbGVFbmdpbmUodGhpcykuU2V0SW5pdFNpemVSYW5kb20oYSkKICAgIH0KICAgIGdldCBpbml0U2l6ZVJhbmRvbSgpIHsKICAgICAgICByZXR1cm4gR2V0UGFydGljbGVFbmdpbmUodGhpcykuR2V0SW5pdFNpemVSYW5kb20oKQogICAgfQogICAgc2V0IGluaXRHcm93UmF0ZShhKSB7CiAgICAgICAgQzNYJGpzY29tcCQxOS5SZXF1aXJlRmluaXRlTnVtYmVyKGEpOwogICAgICAgIEdldFBhcnRpY2xlRW5naW5lKHRoaXMpLlNldEdyb3dSYXRlKGEpCiAgICB9CiAgICBnZXQgaW5pdEdyb3dSYXRlKCkgewogICAgICAgIHJldHVybiBHZXRQYXJ0aWNsZUVuZ2luZSh0aGlzKS5HZXRHcm93UmF0ZSgpCiAgICB9CiAgICBzZXQgaW5pdEdyb3dSYW5kb20oYSkgewogICAgICAgIEMzWCRqc2NvbXAkMTkuUmVxdWlyZUZpbml0ZU51bWJlcihhKTsKICAgICAgICBHZXRQYXJ0aWNsZUVuZ2luZSh0aGlzKS5TZXRHcm93UmFuZG9tKGEpCiAgICB9CiAgICBnZXQgaW5pdEdyb3dSYW5kb20oKSB7CiAgICAgICAgcmV0dXJuIEdldFBhcnRpY2xlRW5naW5lKHRoaXMpLkdldEdyb3dSYW5kb20oKQogICAgfQogICAgc2V0IGFjY2VsZXJhdGlvbihhKSB7CiAgICAgICAgQzNYJGpzY29tcCQxOS5SZXF1aXJlRmluaXRlTnVtYmVyKGEpOwogICAgICAgIEdldFBhcnRpY2xlRW5naW5lKHRoaXMpLlNldEFjY2VsZXJhdGlvbihhKQogICAgfQogICAgZ2V0IGFjY2VsZXJhdGlvbigpIHsKICAgICAgICByZXR1cm4gR2V0UGFydGljbGVFbmdpbmUodGhpcykuR2V0QWNjZWxlcmF0aW9uKCkKICAgIH0KICAgIHNldCBncmF2aXR5KGEpIHsKICAgICAgICBDM1gkanNjb21wJDE5LlJlcXVpcmVGaW5pdGVOdW1iZXIoYSk7CiAgICAgICAgR2V0UGFydGljbGVFbmdpbmUodGhpcykuU2V0R3Jhdml0eShhKQogICAgfQogICAgZ2V0IGdyYXZpdHkoKSB7CiAgICAgICAgcmV0dXJuIEdldFBhcnRpY2xlRW5naW5lKHRoaXMpLkdldEdyYXZpdHkoKQogICAgfQogICAgc2V0IGxpZmVBbmdsZVJhbmRvbShhKSB7CiAgICAgICAgQzNYJGpzY29tcCQxOS5SZXF1aXJlRmluaXRlTnVtYmVyKGEpOwogICAgICAgIEdldFBhcnRpY2xlRW5naW5lKHRoaXMpLlNldExpZmVBbmdsZVJhbmRvbShhKQogICAgfQogICAgZ2V0IGxpZmVBbmdsZVJhbmRvbSgpIHsKICAgICAgICByZXR1cm4gR2V0UGFydGljbGVFbmdpbmUodGhpcykuR2V0TGlmZUFuZ2xlUmFuZG9tKCkKICAgIH0KICAgIHNldCBsaWZlU3BlZWRSYW5kb20oYSkgewogICAgICAgIEMzWCRqc2NvbXAkMTkuUmVxdWlyZUZpbml0ZU51bWJlcihhKTsKICAgICAgICBHZXRQYXJ0aWNsZUVuZ2luZSh0aGlzKS5TZXRMaWZlU3BlZWRSYW5kb20oYSkKICAgIH0KICAgIGdldCBsaWZlU3BlZWRSYW5kb20oKSB7CiAgICAgICAgcmV0dXJuIEdldFBhcnRpY2xlRW5naW5lKHRoaXMpLkdldExpZmVTcGVlZFJhbmRvbSgpCiAgICB9CiAgICBzZXQgbGlmZU9wYWNpdHlSYW5kb20oYSkgewogICAgICAgIEMzWCRqc2NvbXAkMTkuUmVxdWlyZUZpbml0ZU51bWJlcihhKTsKICAgICAgICBHZXRQYXJ0aWNsZUVuZ2luZSh0aGlzKS5TZXRMaWZlT3BhY2l0eVJhbmRvbShhKQogICAgfQogICAgZ2V0IGxpZmVPcGFjaXR5UmFuZG9tKCkgewogICAgICAgIHJldHVybiBHZXRQYXJ0aWNsZUVuZ2luZSh0aGlzKS5HZXRMaWZlT3BhY2l0eVJhbmRvbSgpCiAgICB9CiAgICBzZXQgdGltZW91dChhKSB7CiAgICAgICAgQzNYJGpzY29tcCQxOS5SZXF1aXJlRmluaXRlTnVtYmVyKGEpOwogICAgICAgIEdldFBhcnRpY2xlRW5naW5lKHRoaXMpLlNldFRpbWVvdXQoYSkKICAgIH0KICAgIGdldCB0aW1lb3V0KCkgewogICAgICAgIHJldHVybiBHZXRQYXJ0aWNsZUVuZ2luZSh0aGlzKS5HZXRUaW1lb3V0KCkKICAgIH0KICAgIHNldFBhcnRpY2xlT2JqZWN0Q2xhc3MoYSkgewogICAgICAgIGNvbnN0IGIgPSBtYXAkanNjb21wJDIwLmdldCh0aGlzKTsKICAgICAgICBhID8gYi5fU2V0UGFydGljbGVPYmplY3RDbGFzcyhiLkdldFJ1bnRpbWUoKS5fVW53cmFwSU9iamVjdENsYXNzKGEpKSA6IGIuX1NldFBhcnRpY2xlT2JqZWN0Q2xhc3MobnVsbCkKICAgIH0KfTsKc2VsZi5DMy5QbHVnaW5zLlBhcnRpY2xlcy5DbmRzID0gewogICAgSXNTcHJheWluZygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcGFydGljbGVFbmdpbmUuSXNTcHJheWluZygpCiAgICB9Cn07CmNvbnN0IEMzJGpzY29tcCQxODggPSBzZWxmLkMzOwpDMyRqc2NvbXAkMTg4LlBsdWdpbnMuUGFydGljbGVzLkFjdHMgPSB7CiAgICBTZXRTcHJheWluZyhhKSB7CiAgICAgICAgdGhpcy5fcGFydGljbGVFbmdpbmUuU2V0U3ByYXlpbmcoMCAhPT0gYSkKICAgIH0sCiAgICBTZXRSYXRlKGEpIHsKICAgICAgICB0aGlzLl9TZXRSYXRlKGEpCiAgICB9LAogICAgU2V0UGFydGljbGVPYmplY3QoYSkgewogICAgICAgIHRoaXMuX1NldFBhcnRpY2xlT2JqZWN0Q2xhc3MoYSkKICAgIH0sCiAgICBVbnNldFBhcnRpY2xlT2JqZWN0KCkgewogICAgICAgIHRoaXMuX1NldFBhcnRpY2xlT2JqZWN0Q2xhc3MobnVsbCkKICAgIH0sCiAgICBTZXRTcHJheUNvbmUoYSkgewogICAgICAgIHRoaXMuX3BhcnRpY2xlRW5naW5lLlNldFNwcmF5Q29uZShDMyRqc2NvbXAkMTg4LnRvUmFkaWFucyhhKSkKICAgIH0sCiAgICBTZXRJbml0U3BlZWQoYSkgewogICAgICAgIHRoaXMuX3BhcnRpY2xlRW5naW5lLlNldEluaXRTcGVlZChhKQogICAgfSwKICAgIFNldEluaXRTaXplKGEpIHsKICAgICAgICB0aGlzLl9wYXJ0aWNsZUVuZ2luZS5TZXRJbml0U2l6ZShhKQogICAgfSwKICAgIFNldEluaXRPcGFjaXR5KGEpIHsKICAgICAgICB0aGlzLl9wYXJ0aWNsZUVuZ2luZS5TZXRJbml0T3BhY2l0eShhIC8gMTAwKQogICAgfSwKICAgIFNldEdyb3dSYXRlKGEpIHsKICAgICAgICB0aGlzLl9wYXJ0aWNsZUVuZ2luZS5TZXRHcm93UmF0ZShhKQogICAgfSwKICAgIFNldFhSYW5kb21pc2VyKGEpIHsKICAgICAgICB0aGlzLl9wYXJ0aWNsZUVuZ2luZS5TZXRJbml0WFJhbmRvbShhKQogICAgfSwKICAgIFNldFlSYW5kb21pc2VyKGEpIHsKICAgICAgICB0aGlzLl9wYXJ0aWNsZUVuZ2luZS5TZXRJbml0WVJhbmRvbShhKQogICAgfSwKICAgIFNldFNwZWVkUmFuZG9taXNlcihhKSB7CiAgICAgICAgdGhpcy5fcGFydGljbGVFbmdpbmUuU2V0SW5pdFNwZWVkUmFuZG9tKGEpCiAgICB9LAogICAgU2V0U2l6ZVJhbmRvbWlzZXIoYSkgewogICAgICAgIHRoaXMuX3BhcnRpY2xlRW5naW5lLlNldEluaXRTaXplUmFuZG9tKGEpCiAgICB9LAogICAgU2V0R3Jvd1JhdGVSYW5kb21pc2VyKGEpIHsKICAgICAgICB0aGlzLl9wYXJ0aWNsZUVuZ2luZS5TZXRHcm93UmFuZG9tKGEpCiAgICB9LAogICAgU2V0UGFydGljbGVBY2MoYSkgewogICAgICAgIHRoaXMuX3BhcnRpY2xlRW5naW5lLlNldEFjY2VsZXJhdGlvbihhKQogICAgfSwKICAgIFNldEdyYXZpdHkoYSkgewogICAgICAgIHRoaXMuX3BhcnRpY2xlRW5naW5lLlNldEdyYXZpdHkoYSkKICAgIH0sCiAgICBTZXRBbmdsZVJhbmRvbWlzZXIoYSkgewogICAgICAgIHRoaXMuX3BhcnRpY2xlRW5naW5lLlNldExpZmVBbmdsZVJhbmRvbShhKQogICAgfSwKICAgIFNldExpZmVTcGVlZFJhbmRvbWlzZXIoYSkgewogICAgICAgIHRoaXMuX3BhcnRpY2xlRW5naW5lLlNldExpZmVTcGVlZFJhbmRvbShhKQogICAgfSwKICAgIFNldE9wYWNpdHlSYW5kb21pc2VyKGEpIHsKICAgICAgICB0aGlzLl9wYXJ0aWNsZUVuZ2luZS5TZXRMaWZlT3BhY2l0eVJhbmRvbShhKQogICAgfSwKICAgIFNldFRpbWVvdXQoYSkgewogICAgICAgIHRoaXMuX3BhcnRpY2xlRW5naW5lLlNldFRpbWVvdXQoYSkKICAgIH0sCiAgICBTZXRFZmZlY3QoYSkgewogICAgICAgIHRoaXMuR2V0V29ybGRJbmZvKCkuU2V0QmxlbmRNb2RlKGEpOwogICAgICAgIHRoaXMuX3J1bnRpbWUuVXBkYXRlUmVuZGVyKCkKICAgIH0KfTsKY29uc3QgQzMkanNjb21wJDE4OSA9IHNlbGYuQzM7CkMzJGpzY29tcCQxODkuUGx1Z2lucy5QYXJ0aWNsZXMuRXhwcyA9IHsKICAgIFBhcnRpY2xlQ291bnQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3BhcnRpY2xlRW5naW5lLkdldFBhcnRpY2xlQ291bnQoKQogICAgfSwKICAgIFJhdGUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3BhcnRpY2xlRW5naW5lLkdldFJhdGUoKQogICAgfSwKICAgIFNwcmF5Q29uZSgpIHsKICAgICAgICByZXR1cm4gQzMkanNjb21wJDE4OS50b0RlZ3JlZXModGhpcy5fcGFydGljbGVFbmdpbmUuR2V0U3ByYXlDb25lKCkpCiAgICB9LAogICAgSW5pdFNwZWVkKCkgewogICAgICAgIHJldHVybiB0aGlzLl9wYXJ0aWNsZUVuZ2luZS5HZXRJbml0U3BlZWQoKQogICAgfSwKICAgIEluaXRTaXplKCkgewogICAgICAgIHJldHVybiB0aGlzLl9wYXJ0aWNsZUVuZ2luZS5HZXRJbml0U2l6ZSgpCiAgICB9LAogICAgSW5pdE9wYWNpdHkoKSB7CiAgICAgICAgcmV0dXJuIDEwMCAqIHRoaXMuX3BhcnRpY2xlRW5naW5lLkdldEluaXRPcGFjaXR5KCkKICAgIH0sCiAgICBJbml0R3Jvd1JhdGUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3BhcnRpY2xlRW5naW5lLkdldEdyb3dSYXRlKCkKICAgIH0sCiAgICBYUmFuZG9tKCkgewogICAgICAgIHJldHVybiB0aGlzLl9wYXJ0aWNsZUVuZ2luZS5HZXRJbml0WFJhbmRvbSgpCiAgICB9LAogICAgWVJhbmRvbSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcGFydGljbGVFbmdpbmUuR2V0SW5pdFlSYW5kb20oKQogICAgfSwKICAgIEluaXRTaXplUmFuZG9tKCkgewogICAgICAgIHJldHVybiB0aGlzLl9wYXJ0aWNsZUVuZ2luZS5HZXRJbml0U2l6ZVJhbmRvbSgpCiAgICB9LAogICAgSW5pdFNwZWVkUmFuZG9tKCkgewogICAgICAgIHJldHVybiB0aGlzLl9wYXJ0aWNsZUVuZ2luZS5HZXRJbml0U3BlZWRSYW5kb20oKQogICAgfSwKICAgIEluaXRHcm93UmFuZG9tKCkgewogICAgICAgIHJldHVybiB0aGlzLl9wYXJ0aWNsZUVuZ2luZS5HZXRHcm93UmFuZG9tKCkKICAgIH0sCiAgICBQYXJ0aWNsZUFjY2VsZXJhdGlvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcGFydGljbGVFbmdpbmUuR2V0QWNjZWxlcmF0aW9uKCkKICAgIH0sCiAgICBHcmF2aXR5KCkgewogICAgICAgIHJldHVybiB0aGlzLl9wYXJ0aWNsZUVuZ2luZS5HZXRHcmF2aXR5KCkKICAgIH0sCiAgICBQYXJ0aWNsZUFuZ2xlUmFuZG9tKCkgewogICAgICAgIHJldHVybiB0aGlzLl9wYXJ0aWNsZUVuZ2luZS5HZXRMaWZlQW5nbGVSYW5kb20oKQogICAgfSwKICAgIFBhcnRpY2xlU3BlZWRSYW5kb20oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3BhcnRpY2xlRW5naW5lLkdldExpZmVTcGVlZFJhbmRvbSgpCiAgICB9LAogICAgUGFydGljbGVPcGFjaXR5UmFuZG9tKCkgewogICAgICAgIHJldHVybiB0aGlzLl9wYXJ0aWNsZUVuZ2luZS5HZXRMaWZlT3BhY2l0eVJhbmRvbSgpCiAgICB9LAogICAgVGltZW91dCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcGFydGljbGVFbmdpbmUuR2V0VGltZW91dCgpCiAgICB9Cn07CiJ1c2Ugc3RyaWN0IjsKY29uc3QgQzMkanNjb21wJDE5MCA9IHNlbGYuQzMsCiAgICBpbmFjdGl2ZVBhcnRpY2xlcyA9IFtdLAogICAgVkFMSURfU1BSQVlfVFlQRVMgPSBuZXcgU2V0KFsiY29udGludW91cy1zcHJheSIsICJvbmUtc2hvdCJdKSwKICAgIERFU1RST1lfTU9ERVMgPSBbImZhZGUtdG8taW52aXNpYmxlIiwgInRpbWVvdXQtZXhwaXJlZCIsICJwYXJ0aWNsZS1zdG9wcGVkIl07CnNlbGYuUGFydGljbGVFbmdpbmUgPSBjbGFzcyB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgICB0aGlzLl9zcHJheUNvbmUgPSB0aGlzLl9yYXRlID0gMDsKICAgICAgICB0aGlzLl9zcHJheVR5cGUgPSAiY29udGludW91cy1zcHJheSI7CiAgICAgICAgdGhpcy5faXNTcHJheWluZyA9ICExOwogICAgICAgIHRoaXMuX21hc3Rlck9wYWNpdHkgPSAwOwogICAgICAgIHRoaXMuX2lzUGl4ZWxSb3VuZGluZyA9ICExOwogICAgICAgIHRoaXMuX2luaXRTaXplID0gdGhpcy5faW5pdFNwZWVkID0gdGhpcy5fc3Bhd25BbmdsZSA9IHRoaXMuX3NwYXduWSA9IHRoaXMuX3NwYXduWCA9IDA7CiAgICAgICAgdGhpcy5faW5pdFNpemVTY2FsZSA9IDE7CiAgICAgICAgdGhpcy5fY3JlYXRlQ291bnRlciA9IHRoaXMuX3RpbWVvdXQgPSB0aGlzLl9kZXN0cm95TW9kZSA9IHRoaXMuX2xpZmVPcGFjaXR5UmFuZG9tID0gdGhpcy5fbGlmZVNwZWVkUmFuZG9tID0gdGhpcy5fbGlmZUFuZ2xlUmFuZG9tID0gdGhpcy5fZ3Jhdml0eSA9IHRoaXMuX2FjY2VsZXJhdGlvbiA9IHRoaXMuX2dyb3dSYW5kb20gPSB0aGlzLl9pbml0U2l6ZVJhbmRvbSA9IHRoaXMuX2luaXRTcGVlZFJhbmRvbSA9IHRoaXMuX3lSYW5kb20gPSB0aGlzLl94UmFuZG9tID0KICAgICAgICAgICAgdGhpcy5fZ3Jvd1JhdGUgPSB0aGlzLl9pbml0T3BhY2l0eSA9IDA7CiAgICAgICAgdGhpcy5fcGFydGljbGVTY2FsZSA9IDE7CiAgICAgICAgdGhpcy5vbnBhcnRpY2xlY3JlYXRlID0gdGhpcy5vbm9uZXNob3RmaW5pc2ggPSBudWxsOwogICAgICAgIHRoaXMuX3BhcnRpY2xlcyA9IFtdOwogICAgICAgIHRoaXMuX2JvdW5kaW5nQm94ID0gbmV3IEMzJGpzY29tcCQxOTAuUmVjdDsKICAgICAgICB0aGlzLl9jb2xvciA9IG5ldyBDMyRqc2NvbXAkMTkwLkNvbG9yCiAgICB9CiAgICBSZWxlYXNlKCkgewogICAgICAgIHRoaXMuQ2FuY2VsKCk7CiAgICAgICAgQzMkanNjb21wJDE5MC5jbGVhckFycmF5KHRoaXMuX3BhcnRpY2xlcyk7CiAgICAgICAgdGhpcy5fY29sb3IgPSB0aGlzLl9ib3VuZGluZ0JveCA9IHRoaXMub25wYXJ0aWNsZWNyZWF0ZSA9IHRoaXMub25vbmVzaG90ZmluaXNoID0gdGhpcy5fcGFydGljbGVzID0gbnVsbAogICAgfQogICAgQ2FuY2VsKCkgewogICAgICAgIGNvbnN0IGEgPSB0aGlzLl9wYXJ0aWNsZXM7CiAgICAgICAgZm9yIChsZXQgYiA9IDAsIGQgPSBhLmxlbmd0aDsgYiA8IGQ7ICsrYikgYVtiXS5EZXN0cm95KCk7CiAgICAgICAgQzMkanNjb21wJDE5MC5hcHBlbmRBcnJheShpbmFjdGl2ZVBhcnRpY2xlcywgYSk7CiAgICAgICAgQzMkanNjb21wJDE5MC5jbGVhckFycmF5KGEpOwogICAgICAgIDFFMyA8IGluYWN0aXZlUGFydGljbGVzLmxlbmd0aCAmJiBDMyRqc2NvbXAkMTkwLnRydW5jYXRlQXJyYXkoaW5hY3RpdmVQYXJ0aWNsZXMsIDFFMyk7CiAgICAgICAgdGhpcy5faXNTcHJheWluZyA9ICExCiAgICB9CiAgICBDcmVhdGVPbmVTaG90U3ByYXkoKSB7CiAgICAgICAgZm9yIChsZXQgYSA9IDAsIGIgPSB0aGlzLl9yYXRlOyBhIDwgYjsgKythKSB0aGlzLl9DcmVhdGVQYXJ0aWNsZSgpOwogICAgICAgIHRoaXMuX3BhcnRpY2xlcy5sZW5ndGggJiYgKHRoaXMuX2lzU3ByYXlpbmcgPSAhMCkKICAgIH0KICAgIF9DcmVhdGVQYXJ0aWNsZSgpIHsKICAgICAgICBsZXQgYTsKICAgICAgICBpbmFjdGl2ZVBhcnRpY2xlcy5sZW5ndGggPyAoYSA9IGluYWN0aXZlUGFydGljbGVzLnBvcCgpLCBhLlNldEVuZ2luZSh0aGlzKSkgOiBhID0gQzMkanNjb21wJDE5MC5OZXcoc2VsZi5QYXJ0aWNsZSwgdGhpcyk7CiAgICAgICAgdGhpcy5fcGFydGljbGVzLnB1c2goYSk7CiAgICAgICAgYS5Jbml0KHRoaXMub25wYXJ0aWNsZWNyZWF0ZSk7CiAgICAgICAgcmV0dXJuIGEKICAgIH0KICAgIFJlSW5pdEFsbFBhcnRpY2xlcygpIHsKICAgICAgICBjb25zdCBhID0gdGhpcy5fcGFydGljbGVzLAogICAgICAgICAgICBiID0gdGhpcy5vbnBhcnRpY2xlY3JlYXRlOwogICAgICAgIGZvciAobGV0IGQgPQogICAgICAgICAgICAgICAgMCwgYyA9IGEubGVuZ3RoOyBkIDwgYzsgKytkKSBhW2RdLkluaXQoYikKICAgIH0KICAgIFVwZGF0ZUFsbFBhcnRpY2xlc1VzZXJEYXRhKCkgewogICAgICAgIGNvbnN0IGEgPSB0aGlzLl9wYXJ0aWNsZXMsCiAgICAgICAgICAgIGIgPSB0aGlzLm9ucGFydGljbGVjcmVhdGU7CiAgICAgICAgZm9yIChsZXQgZCA9IDAsIGMgPSBhLmxlbmd0aDsgZCA8IGM7ICsrZCkgYVtkXS5VcGRhdGVVc2VyRGF0YShiKQogICAgfQogICAgQXBwbHlQYXJ0aWNsZURhdGFUb1VzZXJEYXRhKGEpIHsKICAgICAgICBjb25zdCBiID0gdGhpcy5fcGFydGljbGVzOwogICAgICAgIGZvciAobGV0IGMgPSAwLCBlID0gYi5sZW5ndGg7IGMgPCBlOyArK2MpIHsKICAgICAgICAgICAgY29uc3QgZyA9IGJbY107CiAgICAgICAgICAgIHZhciBkID0gZy5HZXRVc2VyRGF0YSgpOwogICAgICAgICAgICBkICYmIChkID0gZC5HZXRXb3JsZEluZm8oKSwgZC5TZXRYKGcuR2V0WCgpKSwgZC5TZXRZKGcuR2V0WSgpKSwgZC5TZXRTaXplKGcuR2V0U2l6ZSgpLCBnLkdldFNpemUoKSksIGQuU2V0T3BhY2l0eShnLkdldE9wYWNpdHkoKSksIGQuU2V0QW5nbGUoZy5HZXRBbmdsZSgpKSwgZC5TZXRVbnByZW11bHRpcGxpZWRDb2xvcihhLkdldFdvcmxkSW5mbygpLkdldFVucHJlbXVsdGlwbGllZENvbG9yKCkpLAogICAgICAgICAgICAgICAgZC5TZXRCYm94Q2hhbmdlZCgpKQogICAgICAgIH0KICAgIH0KICAgIFNldFBhcnRpY2xlQ291bnQoYSkgewogICAgICAgIHZhciBiID0gdGhpcy5fcGFydGljbGVzOwogICAgICAgIGlmIChhIDwgYi5sZW5ndGgpIHsKICAgICAgICAgICAgYSA9IGIubGVuZ3RoIC0gYTsKICAgICAgICAgICAgZm9yIChsZXQgZCA9IDA7IGQgPCBhOyArK2QpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGMgPSBiLnBvcCgpOwogICAgICAgICAgICAgICAgYy5EZXN0cm95KCk7CiAgICAgICAgICAgICAgICBpbmFjdGl2ZVBhcnRpY2xlcy5wdXNoKGMpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgMUUzIDwgaW5hY3RpdmVQYXJ0aWNsZXMubGVuZ3RoICYmIEMzJGpzY29tcCQxOTAudHJ1bmNhdGVBcnJheShpbmFjdGl2ZVBhcnRpY2xlcywgMUUzKQogICAgICAgIH0gZWxzZSBpZiAoYSA+IGIubGVuZ3RoKQogICAgICAgICAgICBmb3IgKGIgPSBhIC0gYi5sZW5ndGgsIGEgPSAwOyBhIDwgYjsgKythKSB0aGlzLl9DcmVhdGVQYXJ0aWNsZSgpCiAgICB9CiAgICBHZXRQYXJ0aWNsZXMoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3BhcnRpY2xlcwogICAgfQogICAgR2V0UGFydGljbGVDb3VudCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcGFydGljbGVzLmxlbmd0aAogICAgfQogICAgVGljayhhKSB7CiAgICAgICAgdGhpcy5fU3Bhd25Db250aW51b3VzKGEpOwogICAgICAgIHRoaXMuX1RpY2tQYXJ0aWNsZXMoYSk7CiAgICAgICAgdGhpcy5fTWF5YmVGaW5pc2hPbmVTaG90KCkKICAgIH0KICAgIF9TcGF3bkNvbnRpbnVvdXMoYSkgewogICAgICAgIGlmICgiY29udGludW91cy1zcHJheSIgPT09CiAgICAgICAgICAgIHRoaXMuX3NwcmF5VHlwZSAmJiB0aGlzLl9pc1NwcmF5aW5nKSB7CiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZUNvdW50ZXIgKz0gYSAqIHRoaXMuX3JhdGU7CiAgICAgICAgICAgIGEgPSBNYXRoLmZsb29yKHRoaXMuX2NyZWF0ZUNvdW50ZXIpOwogICAgICAgICAgICB0aGlzLl9jcmVhdGVDb3VudGVyIC09IGE7CiAgICAgICAgICAgIGZvciAobGV0IGIgPSAwOyBiIDwgYTsgKytiKSB0aGlzLl9DcmVhdGVQYXJ0aWNsZSgpCiAgICAgICAgfQogICAgfQogICAgX1NldENyZWF0ZUNvdW50ZXIoYSkgewogICAgICAgIHRoaXMuX2NyZWF0ZUNvdW50ZXIgPSBhCiAgICB9CiAgICBfR2V0Q3JlYXRlQ291bnRlcigpIHsKICAgICAgICByZXR1cm4gdGhpcy5fY3JlYXRlQ291bnRlcgogICAgfQogICAgX1RpY2tQYXJ0aWNsZXMoYSkgewogICAgICAgIGNvbnN0IGIgPSB0aGlzLl9ib3VuZGluZ0JveDsKICAgICAgICBiLnNldCh0aGlzLl9zcGF3blgsIHRoaXMuX3NwYXduWSwgdGhpcy5fc3Bhd25YLCB0aGlzLl9zcGF3blkpOwogICAgICAgIGNvbnN0IGQgPSB0aGlzLl9wYXJ0aWNsZXM7CiAgICAgICAgbGV0IGMgPSAwOwogICAgICAgIGZvciAobGV0IGUgPSAwLCBnID0gZC5sZW5ndGg7IGUgPCBnOyArK2UpIHsKICAgICAgICAgICAgY29uc3QgayA9IGRbZV07CiAgICAgICAgICAgIGRbY10gPSBrOwogICAgICAgICAgICBrLlRpY2soYSk7CiAgICAgICAgICAgIGsuSXNBY3RpdmUoKSA/ICgrK2MsIGIuZXhwYW5kVG9Db250YWluKGsuR2V0Qm91bmRpbmdCb3goKSkpIDoKICAgICAgICAgICAgICAgIChrLkRlc3Ryb3koKSwgaW5hY3RpdmVQYXJ0aWNsZXMucHVzaChrKSkKICAgICAgICB9CiAgICAgICAgQzMkanNjb21wJDE5MC50cnVuY2F0ZUFycmF5KGQsIGMpOwogICAgICAgIDFFMyA8IGluYWN0aXZlUGFydGljbGVzLmxlbmd0aCAmJiBDMyRqc2NvbXAkMTkwLnRydW5jYXRlQXJyYXkoaW5hY3RpdmVQYXJ0aWNsZXMsIDFFMykKICAgIH0KICAgIF9NYXliZUZpbmlzaE9uZVNob3QoKSB7CiAgICAgICAgaWYgKCJvbmUtc2hvdCIgPT09IHRoaXMuX3NwcmF5VHlwZSAmJiAwID09PSB0aGlzLl9wYXJ0aWNsZXMubGVuZ3RoICYmIHRoaXMuX2lzU3ByYXlpbmcpIHsKICAgICAgICAgICAgaWYgKHRoaXMub25vbmVzaG90ZmluaXNoKSB0aGlzLm9ub25lc2hvdGZpbmlzaCgpOwogICAgICAgICAgICB0aGlzLl9pc1NwcmF5aW5nID0gITEKICAgICAgICB9CiAgICB9CiAgICBEcmF3KGEsIGIsIGQsIGMpIHsKICAgICAgICBhLlN0YXJ0UmVuZGVyaW5nUG9pbnRzKGIpOwogICAgICAgIHRoaXMuX2NvbG9yLmNvcHkoYS5HZXRDb2xvcigpKTsKICAgICAgICBjb25zdCBlID0gdGhpcy5fcGFydGljbGVzOwogICAgICAgIGZvciAobGV0IGcgPSAwLCBrID0gZS5sZW5ndGg7IGcgPCBrOyArK2cpIHsKICAgICAgICAgICAgY29uc3QgbSA9IGVbZ107CiAgICAgICAgICAgIGQuaW50ZXJzZWN0c1JlY3QobS5HZXRCb3VuZGluZ0JveCgpKSAmJgogICAgICAgICAgICAgICAgbS5EcmF3KGEsIGIsIGMpCiAgICAgICAgfQogICAgICAgIGEuRmluaXNoUmVuZGVyaW5nUG9pbnRzKCkKICAgIH0KICAgIEdldENvbG9yKCkgewogICAgICAgIHJldHVybiB0aGlzLl9jb2xvcgogICAgfQogICAgU2V0UmF0ZShhKSB7CiAgICAgICAgdGhpcy5fcmF0ZSA9ICthCiAgICB9CiAgICBHZXRSYXRlKCkgewogICAgICAgIHJldHVybiB0aGlzLl9yYXRlCiAgICB9CiAgICBTZXRTcHJheUNvbmUoYSkgewogICAgICAgIHRoaXMuX3NwcmF5Q29uZSA9ICthCiAgICB9CiAgICBHZXRTcHJheUNvbmUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3NwcmF5Q29uZQogICAgfQogICAgU2V0U3ByYXlUeXBlKGEpIHsKICAgICAgICBpZiAoIVZBTElEX1NQUkFZX1RZUEVTLmhhcyhhKSkgdGhyb3cgRXJyb3IoImludmFsaWQgc3ByYXkgdHlwZSIpOwogICAgICAgIHRoaXMuX3NwcmF5VHlwZSA9IGEKICAgIH0KICAgIEdldFNwcmF5VHlwZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fc3ByYXlUeXBlCiAgICB9CiAgICBTZXRTcHJheWluZyhhKSB7CiAgICAgICAgdGhpcy5faXNTcHJheWluZyA9ICEhYQogICAgfQogICAgSXNTcHJheWluZygpIHsKICAgICAgICByZXR1cm4gdGhpcy5faXNTcHJheWluZwogICAgfQogICAgU2V0TWFzdGVyT3BhY2l0eShhKSB7CiAgICAgICAgdGhpcy5fbWFzdGVyT3BhY2l0eSA9ICthCiAgICB9CiAgICBHZXRNYXN0ZXJPcGFjaXR5KCkgewogICAgICAgIHJldHVybiB0aGlzLl9tYXN0ZXJPcGFjaXR5CiAgICB9CiAgICBTZXRQaXhlbFJvdW5kaW5nKGEpIHsKICAgICAgICB0aGlzLl9pc1BpeGVsUm91bmRpbmcgPSAhIWEKICAgIH0KICAgIElzUGl4ZWxSb3VuZGluZygpIHsKICAgICAgICByZXR1cm4gdGhpcy5faXNQaXhlbFJvdW5kaW5nCiAgICB9CiAgICBTZXRTcGF3blgoYSkgewogICAgICAgIHRoaXMuX3NwYXduWCA9ICthCiAgICB9CiAgICBHZXRTcGF3blgoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3NwYXduWAogICAgfQogICAgU2V0U3Bhd25ZKGEpIHsKICAgICAgICB0aGlzLl9zcGF3blkgPSArYQogICAgfQogICAgR2V0U3Bhd25ZKCkgewogICAgICAgIHJldHVybiB0aGlzLl9zcGF3blkKICAgIH0KICAgIFNldFNwYXduQW5nbGUoYSkgewogICAgICAgIHRoaXMuX3NwYXduQW5nbGUgPSArYQogICAgfQogICAgR2V0SW5pdEFuZ2xlKCkgewogICAgICAgIHJldHVybiB0aGlzLl9zcGF3bkFuZ2xlCiAgICB9CiAgICBTZXRJbml0U3BlZWQoYSkgewogICAgICAgIHRoaXMuX2luaXRTcGVlZCA9ICthCiAgICB9CiAgICBHZXRJbml0U3BlZWQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2luaXRTcGVlZAogICAgfQogICAgU2V0SW5pdFNpemUoYSkgewogICAgICAgIHRoaXMuX2luaXRTaXplID0gK2EKICAgIH0KICAgIEdldEluaXRTaXplKCkgewogICAgICAgIHJldHVybiB0aGlzLl9pbml0U2l6ZQogICAgfQogICAgU2V0SW5pdFNpemVTY2FsZShhKSB7CiAgICAgICAgdGhpcy5faW5pdFNpemVTY2FsZSA9ICthCiAgICB9CiAgICBHZXRJbml0U2l6ZVNjYWxlKCkgewogICAgICAgIHJldHVybiB0aGlzLl9pbml0U2l6ZVNjYWxlCiAgICB9CiAgICBTZXRJbml0T3BhY2l0eShhKSB7CiAgICAgICAgdGhpcy5faW5pdE9wYWNpdHkgPSArYQogICAgfQogICAgR2V0SW5pdE9wYWNpdHkoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2luaXRPcGFjaXR5CiAgICB9CiAgICBTZXRHcm93UmF0ZShhKSB7CiAgICAgICAgdGhpcy5fZ3Jvd1JhdGUgPSArYQogICAgfQogICAgR2V0R3Jvd1JhdGUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2dyb3dSYXRlCiAgICB9CiAgICBTZXRJbml0WFJhbmRvbShhKSB7CiAgICAgICAgdGhpcy5feFJhbmRvbSA9ICthCiAgICB9CiAgICBHZXRJbml0WFJhbmRvbSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5feFJhbmRvbQogICAgfQogICAgU2V0SW5pdFlSYW5kb20oYSkgewogICAgICAgIHRoaXMuX3lSYW5kb20gPSArYQogICAgfQogICAgR2V0SW5pdFlSYW5kb20oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3lSYW5kb20KICAgIH0KICAgIFNldEluaXRTcGVlZFJhbmRvbShhKSB7CiAgICAgICAgdGhpcy5faW5pdFNwZWVkUmFuZG9tID0gK2EKICAgIH0KICAgIEdldEluaXRTcGVlZFJhbmRvbSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5faW5pdFNwZWVkUmFuZG9tCiAgICB9CiAgICBTZXRJbml0U2l6ZVJhbmRvbShhKSB7CiAgICAgICAgdGhpcy5faW5pdFNpemVSYW5kb20gPSArYQogICAgfQogICAgR2V0SW5pdFNpemVSYW5kb20oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2luaXRTaXplUmFuZG9tCiAgICB9CiAgICBTZXRHcm93UmFuZG9tKGEpIHsKICAgICAgICB0aGlzLl9ncm93UmFuZG9tID0gK2EKICAgIH0KICAgIEdldEdyb3dSYW5kb20oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2dyb3dSYW5kb20KICAgIH0KICAgIFNldEFjY2VsZXJhdGlvbihhKSB7CiAgICAgICAgdGhpcy5fYWNjZWxlcmF0aW9uID0gK2EKICAgIH0KICAgIEdldEFjY2VsZXJhdGlvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5fYWNjZWxlcmF0aW9uCiAgICB9CiAgICBTZXRHcmF2aXR5KGEpIHsKICAgICAgICB0aGlzLl9ncmF2aXR5ID0gK2EKICAgIH0KICAgIEdldEdyYXZpdHkoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2dyYXZpdHkKICAgIH0KICAgIFNldExpZmVBbmdsZVJhbmRvbShhKSB7CiAgICAgICAgdGhpcy5fbGlmZUFuZ2xlUmFuZG9tID0gK2EKICAgIH0KICAgIEdldExpZmVBbmdsZVJhbmRvbSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fbGlmZUFuZ2xlUmFuZG9tCiAgICB9CiAgICBTZXRMaWZlU3BlZWRSYW5kb20oYSkgewogICAgICAgIHRoaXMuX2xpZmVTcGVlZFJhbmRvbSA9ICthCiAgICB9CiAgICBHZXRMaWZlU3BlZWRSYW5kb20oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2xpZmVTcGVlZFJhbmRvbQogICAgfQogICAgU2V0TGlmZU9wYWNpdHlSYW5kb20oYSkgewogICAgICAgIHRoaXMuX2xpZmVPcGFjaXR5UmFuZG9tID0gK2EKICAgIH0KICAgIEdldExpZmVPcGFjaXR5UmFuZG9tKCkgewogICAgICAgIHJldHVybiB0aGlzLl9saWZlT3BhY2l0eVJhbmRvbQogICAgfQogICAgU2V0RGVzdHJveU1vZGUoYSkgewogICAgICAgIGEgPSBERVNUUk9ZX01PREVTLmluZGV4T2YoYSk7CiAgICAgICAgaWYgKC0xID09PSBhKSB0aHJvdyBFcnJvcigiaW52YWxpZCBkZXN0cm95IG1vZGUiKTsKICAgICAgICB0aGlzLl9kZXN0cm95TW9kZSA9IGEKICAgIH0KICAgIFNldERlc3Ryb3lNb2RlSW5kZXgoYSkgewogICAgICAgIHRoaXMuU2V0RGVzdHJveU1vZGUoREVTVFJPWV9NT0RFU1thXSkKICAgIH0KICAgIEdldERlc3Ryb3lNb2RlKCkgewogICAgICAgIHJldHVybiBERVNUUk9ZX01PREVTW3RoaXMuX2Rlc3Ryb3lNb2RlXQogICAgfQogICAgR2V0RGVzdHJveU1vZGVJbmRleCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZGVzdHJveU1vZGUKICAgIH0KICAgIFNldFRpbWVvdXQoYSkgewogICAgICAgIHRoaXMuX3RpbWVvdXQgPSArYQogICAgfQogICAgR2V0VGltZW91dCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdGltZW91dAogICAgfQogICAgU2V0UGFydGljbGVTY2FsZShhKSB7CiAgICAgICAgdGhpcy5fcGFydGljbGVTY2FsZSA9ICthCiAgICB9CiAgICBHZXRQYXJ0aWNsZVNjYWxlKCkgewogICAgICAgIHJldHVybiB0aGlzLl9wYXJ0aWNsZVNjYWxlCiAgICB9CiAgICBHZXRCb3VuZGluZ0JveCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fYm91bmRpbmdCb3gKICAgIH0KfTsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkMTkxID0gc2VsZi5DMzsKCmZ1bmN0aW9uIHJhbmRvbU9mZnNldChhKSB7CiAgICByZXR1cm4gTWF0aC5yYW5kb20oKSAqIGEgLSBhIC8gMgp9CmNvbnN0IHRtcFF1YWQkanNjb21wJDMgPSBuZXcgQzMkanNjb21wJDE5MS5RdWFkLAogICAgdG1wQ29sb3IgPSBuZXcgQzMkanNjb21wJDE5MS5Db2xvciwKICAgIERQUiA9IHNlbGYuZGV2aWNlUGl4ZWxSYXRpbyB8fCAxOwpsZXQgZGlkQ2hhbmdlQ29sb3IgPSAhMTsKc2VsZi5QYXJ0aWNsZSA9IGNsYXNzIHsKICAgIGNvbnN0cnVjdG9yKGEpIHsKICAgICAgICB0aGlzLl9lbmdpbmUgPSBhOwogICAgICAgIHRoaXMuX2lzQWN0aXZlID0gITE7CiAgICAgICAgdGhpcy5fYW5nbGUgPSB0aGlzLl9zcGVlZCA9IHRoaXMuX3kgPSB0aGlzLl94ID0gMDsKICAgICAgICB0aGlzLl9vcGFjaXR5ID0gMTsKICAgICAgICB0aGlzLl9hZ2UgPSB0aGlzLl9ncyA9IHRoaXMuX2hhbGZTaXplID0gdGhpcy5fc2l6ZSA9IHRoaXMuX2dyb3cgPSB0aGlzLl9sYXN0T3BhY2l0eSA9IDA7CiAgICAgICAgdGhpcy5fYmJveCA9IG5ldyBDMyRqc2NvbXAkMTkxLlJlY3Q7CiAgICAgICAgdGhpcy5fdXNlckRhdGEgPSBudWxsOwogICAgICAgIHRoaXMuX3VzZXJEYXRhVWlkID0gTmFOOwogICAgICAgIHRoaXMuX2Rlc3Ryb3lDYWxsYmFjayA9IHRoaXMuX3VwZGF0ZUNhbGxiYWNrID0gbnVsbAogICAgfQogICAgU2V0RW5naW5lKGEpIHsKICAgICAgICB0aGlzLl9lbmdpbmUgPSBhCiAgICB9CiAgICBJbml0KGEpIHsKICAgICAgICBjb25zdCBiID0gdGhpcy5fZW5naW5lOwogICAgICAgIHRoaXMuX2lzQWN0aXZlID0gITA7CiAgICAgICAgdGhpcy5feCA9IGIuR2V0U3Bhd25YKCkgKyByYW5kb21PZmZzZXQoYi5HZXRJbml0WFJhbmRvbSgpKTsKICAgICAgICB0aGlzLl95ID0gYi5HZXRTcGF3blkoKSArIHJhbmRvbU9mZnNldChiLkdldEluaXRZUmFuZG9tKCkpOwogICAgICAgIHRoaXMuX3NwZWVkID0gYi5HZXRJbml0U3BlZWQoKSArIHJhbmRvbU9mZnNldChiLkdldEluaXRTcGVlZFJhbmRvbSgpKTsKICAgICAgICB0aGlzLl9hbmdsZSA9IGIuR2V0SW5pdEFuZ2xlKCkgKyByYW5kb21PZmZzZXQoYi5HZXRTcHJheUNvbmUoKSk7CiAgICAgICAgdGhpcy5fbGFzdE9wYWNpdHkgPSB0aGlzLl9vcGFjaXR5ID0gYi5HZXRJbml0T3BhY2l0eSgpOwogICAgICAgIHRoaXMuX3NpemUgPSAoYi5HZXRJbml0U2l6ZSgpICsgcmFuZG9tT2Zmc2V0KGIuR2V0SW5pdFNpemVSYW5kb20oKSkpICogYi5HZXRJbml0U2l6ZVNjYWxlKCk7CiAgICAgICAgdGhpcy5faGFsZlNpemUgPSB0aGlzLl9zaXplIC8gMjsKICAgICAgICB0aGlzLl9ncm93ID0gYi5HZXRHcm93UmF0ZSgpICsgcmFuZG9tT2Zmc2V0KGIuR2V0R3Jvd1JhbmRvbSgpKTsKICAgICAgICB0aGlzLl9hZ2UgPSB0aGlzLl9ncyA9IDA7CiAgICAgICAgdGhpcy5fVXBkYXRlQm91bmRpbmdCb3goKTsKICAgICAgICBhID8gdGhpcy5fdXNlckRhdGEgfHwgKHRoaXMuX3VzZXJEYXRhID0gYSh0aGlzKSkgOiB0aGlzLl9kZXN0cm95Q2FsbGJhY2sgPSB0aGlzLl91cGRhdGVDYWxsYmFjayA9IHRoaXMuX3VzZXJEYXRhID0gbnVsbAogICAgfQogICAgVXBkYXRlVXNlckRhdGEoYSkgewogICAgICAgIGlmIChhKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5fdXNlckRhdGEgfHwKICAgICAgICAgICAgICAgIHRoaXMuX3VzZXJEYXRhLklzRGVzdHJveWVkKCkpIHRoaXMuX3VzZXJEYXRhID0gYSh0aGlzKQogICAgICAgIH0gZWxzZSB0aGlzLl9kZXN0cm95Q2FsbGJhY2sgPSB0aGlzLl91cGRhdGVDYWxsYmFjayA9IHRoaXMuX3VzZXJEYXRhID0gbnVsbAogICAgfQogICAgU2V0VXBkYXRlQ2FsbGJhY2soYSkgewogICAgICAgIHRoaXMuX3VwZGF0ZUNhbGxiYWNrID0gYQogICAgfQogICAgU2V0RGVzdHJveUNhbGxiYWNrKGEpIHsKICAgICAgICB0aGlzLl9kZXN0cm95Q2FsbGJhY2sgPSBhCiAgICB9CiAgICBEZXN0cm95KCkgewogICAgICAgIGNvbnN0IGEgPSB0aGlzLl9kZXN0cm95Q2FsbGJhY2s7CiAgICAgICAgYSAmJiBhKHRoaXMuX3VzZXJEYXRhKTsKICAgICAgICB0aGlzLl9kZXN0cm95Q2FsbGJhY2sgPSB0aGlzLl91cGRhdGVDYWxsYmFjayA9IHRoaXMuX3VzZXJEYXRhID0gbnVsbAogICAgfQogICAgdG9KU09OKCkgewogICAgICAgIGxldCBhOwogICAgICAgIHRoaXMuX3VzZXJEYXRhICYmIChhID0gdGhpcy5fdXNlckRhdGEuR2V0V29ybGRJbmZvKCkuR2V0SW5zdGFuY2UoKS5HZXRVSUQoKSk7CiAgICAgICAgcmV0dXJuIFt0aGlzLl94LCB0aGlzLl95LCB0aGlzLl9zcGVlZCwgdGhpcy5fYW5nbGUsIHRoaXMuX29wYWNpdHksIHRoaXMuX2dyb3csIHRoaXMuX3NpemUsCiAgICAgICAgICAgIHRoaXMuX2dzLCB0aGlzLl9hZ2UsIGEKICAgICAgICBdCiAgICB9CiAgICBzZXRGcm9tSlNPTihhKSB7CiAgICAgICAgdGhpcy5feCA9IGFbMF07CiAgICAgICAgdGhpcy5feSA9IGFbMV07CiAgICAgICAgdGhpcy5fc3BlZWQgPSBhWzJdOwogICAgICAgIHRoaXMuX2FuZ2xlID0gYVszXTsKICAgICAgICB0aGlzLl9vcGFjaXR5ID0gYVs0XTsKICAgICAgICB0aGlzLl9ncm93ID0gYVs1XTsKICAgICAgICB0aGlzLl9zaXplID0gYVs2XTsKICAgICAgICB0aGlzLl9ncyA9IGFbN107CiAgICAgICAgdGhpcy5fYWdlID0gYVs4XTsKICAgICAgICB0aGlzLl91c2VyRGF0YVVpZCA9IGFbOV07CiAgICAgICAgdGhpcy5faGFsZlNpemUgPSB0aGlzLl9zaXplIC8gMjsKICAgICAgICB0aGlzLl9VcGRhdGVCb3VuZGluZ0JveCgpCiAgICB9CiAgICBUaWNrKGEpIHsKICAgICAgICB2YXIgYiA9IHRoaXMuX2VuZ2luZSwKICAgICAgICAgICAgZCA9IHRoaXMuX3NwZWVkICogYSwKICAgICAgICAgICAgYyA9IHRoaXMuX2FuZ2xlOwogICAgICAgIGNvbnN0IGUgPSBNYXRoLmNvcyhjKSAqIGQ7CiAgICAgICAgZCA9IE1hdGguc2luKGMpICogZCArIHRoaXMuX2dzICogYTsKICAgICAgICB0aGlzLl94ICs9IGU7CiAgICAgICAgdGhpcy5feSArPSBkOwogICAgICAgIGMgPSB0aGlzLl9ncm93ICogYTsKICAgICAgICB0aGlzLl9zaXplICs9IGM7CiAgICAgICAgdGhpcy5faGFsZlNpemUgPSB0aGlzLl9zaXplIC8gMjsKICAgICAgICB0aGlzLl9zcGVlZCArPSBiLkdldEFjY2VsZXJhdGlvbigpICogYTsKICAgICAgICB0aGlzLl9ncyArPSBiLkdldEdyYXZpdHkoKSAqIGE7CiAgICAgICAgdGhpcy5fYWdlICs9IGE7CiAgICAgICAgdGhpcy5fVXBkYXRlQm91bmRpbmdCb3goKTsKICAgICAgICB2YXIgZyA9IGIuR2V0TGlmZUFuZ2xlUmFuZG9tKCksCiAgICAgICAgICAgIGsgPSBiLkdldExpZmVTcGVlZFJhbmRvbSgpOwogICAgICAgIGNvbnN0IG0gPSBiLkdldExpZmVPcGFjaXR5UmFuZG9tKCk7CiAgICAgICAgbGV0IG4gPSAwOwogICAgICAgIDAgIT09IGcgJiYgKG4gPSByYW5kb21PZmZzZXQoZyAqIGEpLCB0aGlzLl9hbmdsZSArPSBuKTsKICAgICAgICAwICE9PSBrICYmICh0aGlzLl9zcGVlZCArPSByYW5kb21PZmZzZXQoayAqIGEpKTsKICAgICAgICAwICE9PSBtICYmICh0aGlzLl9vcGFjaXR5ID0gQzMkanNjb21wJDE5MS5jbGFtcCh0aGlzLl9vcGFjaXR5ICsgcmFuZG9tT2Zmc2V0KG0gKiBhKSwgMCwgMSkpOwogICAgICAgIGEgPSAxIDw9IHRoaXMuX3NpemUgJiYgKDIgPT09IGIuR2V0RGVzdHJveU1vZGVJbmRleCgpID8gMCA8IHRoaXMuX3NwZWVkIDogdGhpcy5fYWdlIDwgYi5HZXRUaW1lb3V0KCkpOwogICAgICAgIChnID0gdGhpcy5fdXBkYXRlQ2FsbGJhY2spICYmIGEgJiYgKGsgPSBiLkdldE1hc3Rlck9wYWNpdHkoKSAqIHRoaXMuX29wYWNpdHksIDAgPT09IGIuR2V0RGVzdHJveU1vZGVJbmRleCgpICYmIChrICo9IDEgLSB0aGlzLl9hZ2UgLyBiLkdldFRpbWVvdXQoKSksCiAgICAgICAgICAgIGIgPSBrIC0gdGhpcy5fbGFzdE9wYWNpdHksIHRoaXMuX2xhc3RPcGFjaXR5ID0gaywgZyh0aGlzLl91c2VyRGF0YSwgZSwgZCwgYywgbiwgYikpOwogICAgICAgIHRoaXMuX2lzQWN0aXZlID0gYQogICAgfQogICAgSXNBY3RpdmUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2lzQWN0aXZlCiAgICB9CiAgICBHZXRCb3VuZGluZ0JveCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fYmJveAogICAgfQogICAgX1VwZGF0ZUJvdW5kaW5nQm94KCkgewogICAgICAgIGNvbnN0IGEgPSB0aGlzLl94LAogICAgICAgICAgICBiID0gdGhpcy5feSwKICAgICAgICAgICAgZCA9IHRoaXMuX2hhbGZTaXplOwogICAgICAgIHRoaXMuX2Jib3guc2V0KGEgLSBkLCBiIC0gZCwgYSArIGQsIGIgKyBkKQogICAgfQogICAgRHJhdyhhLCBiLCBkKSB7CiAgICAgICAgaWYgKCF0aGlzLl91c2VyRGF0YSkgewogICAgICAgICAgICB2YXIgYyA9IHRoaXMuX2VuZ2luZSwKICAgICAgICAgICAgICAgIGUgPSBjLkdldE1hc3Rlck9wYWNpdHkoKSAqIHRoaXMuX29wYWNpdHk7CiAgICAgICAgICAgIDAgPT09IGMuR2V0RGVzdHJveU1vZGVJbmRleCgpICYmIChlICo9IDEgLSB0aGlzLl9hZ2UgLyBjLkdldFRpbWVvdXQoKSk7CiAgICAgICAgICAgIGlmICghKDAgPj0gZSkpIHsKICAgICAgICAgICAgICAgIHZhciBnID0gdGhpcy5fc2l6ZSwKICAgICAgICAgICAgICAgICAgICBrID0gZyAqIGMuR2V0UGFydGljbGVTY2FsZSgpICogRFBSOwogICAgICAgICAgICAgICAgaWYgKCEoMSA+IGspKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIG0gPSB0aGlzLl94LAogICAgICAgICAgICAgICAgICAgICAgICBuID0gdGhpcy5feTsKICAgICAgICAgICAgICAgICAgICBjLklzUGl4ZWxSb3VuZGluZygpICYmCiAgICAgICAgICAgICAgICAgICAgICAgIChtID0gbSArIC41IHwgMCwgbiA9IG4gKyAuNSB8IDApOwogICAgICAgICAgICAgICAgICAgIGEuSXNXZWJHUFUoKSA/IGEuUG9pbnQobSwgbiwgZywgZSkgOiBkIHx8IGsgPiBhLkdldE1heFBvaW50U2l6ZSgpIHx8IGsgPCBhLkdldE1pblBvaW50U2l6ZSgpID8gKHRtcENvbG9yLmNvcHkoYy5HZXRDb2xvcigpKSwgdG1wQ29sb3IubXVsdGlwbHlBbHBoYShlKSwgYS5TZXRDb2xvcih0bXBDb2xvciksIGRpZENoYW5nZUNvbG9yID0gITAsIHRtcFF1YWQkanNjb21wJDMuc2V0RnJvbVJlY3QodGhpcy5fYmJveCksIGEuUXVhZDModG1wUXVhZCRqc2NvbXAkMywgYikpIDogKGRpZENoYW5nZUNvbG9yICYmIChhLlNldENvbG9yKGMuR2V0Q29sb3IoKSksIGRpZENoYW5nZUNvbG9yID0gITEpLCBhLlBvaW50KG0sIG4sIGssIGUpKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgR2V0VXNlckRhdGEoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3VzZXJEYXRhCiAgICB9CiAgICBHZXRVc2VyRGF0YVVJRCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdXNlckRhdGFVaWQKICAgIH0KICAgIEdldFgoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3gKICAgIH0KICAgIEdldFkoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3kKICAgIH0KICAgIEdldFNpemUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3NpemUKICAgIH0KICAgIEdldEFuZ2xlKCkgewogICAgICAgIHJldHVybiB0aGlzLl9hbmdsZQogICAgfQogICAgR2V0T3BhY2l0eSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fb3BhY2l0eQogICAgfQp9OwoidXNlIHN0cmljdCI7CmNvbnN0IEMzJGpzY29tcCQxOTIgPSBzZWxmLkMzOwpDMyRqc2NvbXAkMTkyLlBsdWdpbnMuVGV4dCA9IGNsYXNzIGV4dGVuZHMgQzMkanNjb21wJDE5Mi5TREtQbHVnaW5CYXNlIHsKICAgIGNvbnN0cnVjdG9yKGEpIHsKICAgICAgICBzdXBlcihhKQogICAgfQogICAgUmVsZWFzZSgpIHsKICAgICAgICBzdXBlci5SZWxlYXNlKCkKICAgIH0KfTsKY29uc3QgQzMkanNjb21wJDE5MyA9IHNlbGYuQzM7CkMzJGpzY29tcCQxOTMuUGx1Z2lucy5UZXh0LlR5cGUgPSBjbGFzcyBleHRlbmRzIEMzJGpzY29tcCQxOTMuU0RLVHlwZUJhc2UgewogICAgY29uc3RydWN0b3IoYSkgewogICAgICAgIHN1cGVyKGEpCiAgICB9CiAgICBSZWxlYXNlKCkgewogICAgICAgIHN1cGVyLlJlbGVhc2UoKQogICAgfQogICAgT25DcmVhdGUoKSB7fQogICAgTG9hZFRleHR1cmVzKGEpIHt9CiAgICBSZWxlYXNlVGV4dHVyZXMoKSB7fQp9Owpjb25zdCBDMyRqc2NvbXAkMTk0ID0gc2VsZi5DMywKICAgIEMzWCRqc2NvbXAkMjAgPSBzZWxmLkMzWCwKICAgIFRFTVBfQ09MT1JfQVJSQVkkanNjb21wJDEgPSBbMCwgMCwgMF0sCiAgICBIT1JJWk9OVEFMX0FMSUdOTUVOVFMgPSBbImxlZnQiLCAiY2VudGVyIiwgInJpZ2h0Il0sCiAgICBWRVJUSUNBTF9BTElHTk1FTlRTID0gWyJ0b3AiLCAiY2VudGVyIiwgImJvdHRvbSJdLAogICAgdGVtcFJlY3QkanNjb21wJDEyID0gbmV3IEMzJGpzY29tcCQxOTQuUmVjdCwKICAgIHRlbXBRdWFkJGpzY29tcCQ3ID0gbmV3IEMzJGpzY29tcCQxOTQuUXVhZCwKICAgIHRlbXBDb2xvciRqc2NvbXAkOCA9IG5ldyBDMyRqc2NvbXAkMTk0LkNvbG9yOwpDMyRqc2NvbXAkMTk0LlBsdWdpbnMuVGV4dC5JbnN0YW5jZSA9IGNsYXNzIGV4dGVuZHMgQzMkanNjb21wJDE5NC5TREtXb3JsZEluc3RhbmNlQmFzZSB7CiAgICBjb25zdHJ1Y3RvcihhLCBiKSB7CiAgICAgICAgc3VwZXIoYSk7CiAgICAgICAgdGhpcy5fdGV4dCA9ICIiOwogICAgICAgIHRoaXMuX2VuYWJsZUJCY29kZSA9ICEwOwogICAgICAgIHRoaXMuX2ZhY2VOYW1lID0gIkFyaWFsIjsKICAgICAgICB0aGlzLl9wdFNpemUgPSAxMjsKICAgICAgICB0aGlzLl9saW5lSGVpZ2h0T2Zmc2V0ID0gMDsKICAgICAgICB0aGlzLl9pc0l0YWxpYyA9IHRoaXMuX2lzQm9sZCA9ICExOwogICAgICAgIHRoaXMuX2NvbG9yID0gQzMkanNjb21wJDE5NC5OZXcoQzMkanNjb21wJDE5NC5Db2xvcik7CiAgICAgICAgdGhpcy5fdmVydGljYWxBbGlnbiA9IHRoaXMuX2hvcml6b250YWxBbGlnbiA9IDA7CiAgICAgICAgdGhpcy5fd3JhcEJ5V29yZCA9ICEwOwogICAgICAgIHRoaXMuX3R5cGV3cml0ZXJFbmRUaW1lID0gdGhpcy5fdHlwZXdyaXRlclN0YXJ0VGltZSA9IC0xOwogICAgICAgIHRoaXMuX3R5cGV3cml0ZXJMZW5ndGggPSAwOwogICAgICAgIHRoaXMuX3JlbmRlcmVyVGV4dCA9IEMzJGpzY29tcCQxOTQuTmV3KEMzJGpzY29tcCQxOTQuR2Z4LlJlbmRlcmVyVGV4dCwKICAgICAgICAgICAgdGhpcy5fcnVudGltZS5HZXRSZW5kZXJlcigpLCB7CiAgICAgICAgICAgICAgICB0aW1lb3V0OiA1CiAgICAgICAgICAgIH0pOwogICAgICAgIHRoaXMuX3JlbmRlcmVyVGV4dC5vbnRleHR1cmV1cGRhdGUgPSAoKSA9PiB0aGlzLl9ydW50aW1lLlVwZGF0ZVJlbmRlcigpOwogICAgICAgIHRoaXMuX3JlbmRlcmVyVGV4dC5TZXRJc0FzeW5jKCExKTsKICAgICAgICBiICYmICh0aGlzLl90ZXh0ID0gYlswXSwgdGhpcy5fZW5hYmxlQkJjb2RlID0gISFiWzFdLCB0aGlzLl9mYWNlTmFtZSA9IGJbMl0sIHRoaXMuX3B0U2l6ZSA9IGJbM10sIHRoaXMuX2xpbmVIZWlnaHRPZmZzZXQgPSBiWzRdLCB0aGlzLl9pc0JvbGQgPSAhIWJbNV0sIHRoaXMuX2lzSXRhbGljID0gISFiWzZdLCB0aGlzLl9ob3Jpem9udGFsQWxpZ24gPSBiWzhdLCB0aGlzLl92ZXJ0aWNhbEFsaWduID0gYls5XSwgdGhpcy5fd3JhcEJ5V29yZCA9IDAgPT09IGJbMTBdLCBhID0gYls3XSwgdGhpcy5fY29sb3Iuc2V0UmdiKGFbMF0sIGFbMV0sIGFbMl0pLCB0aGlzLkdldFdvcmxkSW5mbygpLlNldFZpc2libGUoYlsxMV0pKTsKICAgICAgICB0aGlzLl9VcGRhdGVUZXh0U2V0dGluZ3MoKQogICAgfQogICAgUmVsZWFzZSgpIHsKICAgICAgICB0aGlzLl9DYW5jZWxUeXBld3JpdGVyKCk7CiAgICAgICAgdGhpcy5fcmVuZGVyZXJUZXh0LlJlbGVhc2UoKTsKICAgICAgICB0aGlzLl9yZW5kZXJlclRleHQgPSBudWxsOwogICAgICAgIHN1cGVyLlJlbGVhc2UoKQogICAgfQogICAgX1VwZGF0ZVRleHRTZXR0aW5ncygpIHsKICAgICAgICBjb25zdCBhID0gdGhpcy5fcmVuZGVyZXJUZXh0OwogICAgICAgIGEuU2V0VGV4dCh0aGlzLl90ZXh0KTsKICAgICAgICBhLlNldEJCQ29kZUVuYWJsZWQodGhpcy5fZW5hYmxlQkJjb2RlKTsKICAgICAgICBhLlNldEZvbnROYW1lKHRoaXMuX2ZhY2VOYW1lKTsKICAgICAgICBhLlNldExpbmVIZWlnaHQodGhpcy5fbGluZUhlaWdodE9mZnNldCk7CiAgICAgICAgYS5TZXRCb2xkKHRoaXMuX2lzQm9sZCk7CiAgICAgICAgYS5TZXRJdGFsaWModGhpcy5faXNJdGFsaWMpOwogICAgICAgIGEuU2V0Q29sb3IodGhpcy5fY29sb3IpOwogICAgICAgIGEuU2V0SG9yaXpvbnRhbEFsaWdubWVudChIT1JJWk9OVEFMX0FMSUdOTUVOVFNbdGhpcy5faG9yaXpvbnRhbEFsaWduXSk7CiAgICAgICAgYS5TZXRWZXJ0aWNhbEFsaWdubWVudChWRVJUSUNBTF9BTElHTk1FTlRTW3RoaXMuX3ZlcnRpY2FsQWxpZ25dKTsKICAgICAgICBhLlNldFdvcmRXcmFwTW9kZSh0aGlzLl93cmFwQnlXb3JkID8gIndvcmQiIDoKICAgICAgICAgICAgImNoYXJhY3RlciIpCiAgICB9CiAgICBfVXBkYXRlVGV4dFNpemUoKSB7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgdGhpcy5fcmVuZGVyZXJUZXh0LlNldEZvbnRTaXplKHRoaXMuX3B0U2l6ZSk7CiAgICAgICAgdGhpcy5fcmVuZGVyZXJUZXh0LlNldEZvbnRTaXplU2NhbGUoYS5HZXRTY2VuZUdyYXBoU2NhbGUoKSk7CiAgICAgICAgdmFyIGIgPSBhLkdldExheWVyKCk7CiAgICAgICAgYiA9IGIuR2V0UmVuZGVyU2NhbGUoKSAqIGIuR2V0MkRTY2FsZUZhY3RvclRvWihhLkdldFRvdGFsWkVsZXZhdGlvbigpKTsKICAgICAgICB0aGlzLl9yZW5kZXJlclRleHQuU2V0U2l6ZShhLkdldFdpZHRoKCksIGEuR2V0SGVpZ2h0KCksIGIpCiAgICB9CiAgICBEcmF3KGEpIHsKICAgICAgICB2YXIgYiA9IHRoaXMuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgdGhpcy5fVXBkYXRlVGV4dFNpemUoKTsKICAgICAgICBjb25zdCBkID0gdGhpcy5fcmVuZGVyZXJUZXh0LkdldFRleHR1cmUoKTsKICAgICAgICBpZiAoZCkgewogICAgICAgICAgICB2YXIgYyA9IGIuR2V0TGF5ZXIoKTsKICAgICAgICAgICAgaWYgKDAgPT09IGIuR2V0QW5nbGUoKSAmJiAwID09PSBjLkdldEFuZ2xlKCkgJiYgMCA9PT0gYi5HZXRUb3RhbFpFbGV2YXRpb24oKSAmJiAhYi5IYXNNZXNoKCkgJiYKICAgICAgICAgICAgICAgIGMuUmVuZGVyc0luMkRNb2RlKCkpIHsKICAgICAgICAgICAgICAgIGIgPSBiLkdldEJvdW5kaW5nUXVhZCgpOwogICAgICAgICAgICAgICAgY29uc3QgW2UsIGddID0gYy5MYXllclRvRHJhd1N1cmZhY2UoYi5nZXRUbHgoKSwgYi5nZXRUbHkoKSksIFtrLCBtXSA9IGMuTGF5ZXJUb0RyYXdTdXJmYWNlKGIuZ2V0QnJ4KCksIGIuZ2V0QnJ5KCkpOwogICAgICAgICAgICAgICAgYiA9IGUgLSBNYXRoLnJvdW5kKGUpOwogICAgICAgICAgICAgICAgY29uc3QgbiA9IGcgLSBNYXRoLnJvdW5kKGcpOwogICAgICAgICAgICAgICAgdGVtcFJlY3QkanNjb21wJDEyLnNldChlLCBnLCBrLCBtKTsKICAgICAgICAgICAgICAgIHRlbXBSZWN0JGpzY29tcCQxMi5vZmZzZXQoLWIsIC1uKTsKICAgICAgICAgICAgICAgIHRlbXBRdWFkJGpzY29tcCQ3LnNldEZyb21SZWN0KHRlbXBSZWN0JGpzY29tcCQxMik7CiAgICAgICAgICAgICAgICBjb25zdCBbcSwgdV0gPSBhLkdldFJlbmRlclRhcmdldFNpemUoYS5HZXRSZW5kZXJUYXJnZXQoKSk7CiAgICAgICAgICAgICAgICB0aGlzLl9ydW50aW1lLkdldENhbnZhc01hbmFnZXIoKS5TZXREZXZpY2VUcmFuc2Zvcm0oYSwgcSwgdSk7CiAgICAgICAgICAgICAgICBhLlNldFRleHR1cmUoZCk7CiAgICAgICAgICAgICAgICBhLlF1YWQzKHRlbXBRdWFkJGpzY29tcCQ3LCB0aGlzLl9yZW5kZXJlclRleHQuR2V0VGV4UmVjdCgpKTsKICAgICAgICAgICAgICAgIGMuX1NldFRyYW5zZm9ybShhKQogICAgICAgICAgICB9IGVsc2UgYS5TZXRUZXh0dXJlKGQpLAogICAgICAgICAgICAgICAgYi5IYXNNZXNoKCkgPyB0aGlzLl9EcmF3TWVzaChiLCBhKSA6IHRoaXMuX0RyYXdTdGFuZGFyZChiLCBhKQogICAgICAgIH0KICAgIH0KICAgIF9EcmF3U3RhbmRhcmQoYSwgYikgewogICAgICAgIGEgPSBhLkdldEJvdW5kaW5nUXVhZCgpOwogICAgICAgIHRoaXMuX3J1bnRpbWUuSXNQaXhlbFJvdW5kaW5nRW5hYmxlZCgpICYmIChhID0gdGhpcy5fUGl4ZWxSb3VuZFF1YWQoYSkpOwogICAgICAgIGIuUXVhZDMoYSwgdGhpcy5fcmVuZGVyZXJUZXh0LkdldFRleFJlY3QoKSkKICAgIH0KICAgIF9EcmF3TWVzaChhLCBiKSB7CiAgICAgICAgY29uc3QgZCA9IGEuR2V0VHJhbnNmb3JtZWRNZXNoKCk7CiAgICAgICAgaWYgKGEuSXNNZXNoQ2hhbmdlZCgpKSB7CiAgICAgICAgICAgIGEuQ2FsY3VsYXRlQmJveCh0ZW1wUmVjdCRqc2NvbXAkMTIsIHRlbXBRdWFkJGpzY29tcCQ3LCAhMSk7CiAgICAgICAgICAgIGxldCBjID0gdGVtcFF1YWQkanNjb21wJDc7CiAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuSXNQaXhlbFJvdW5kaW5nRW5hYmxlZCgpICYmIChjID0gdGhpcy5fUGl4ZWxSb3VuZFF1YWQoYykpOwogICAgICAgICAgICBkLkNhbGN1bGF0ZVRyYW5zZm9ybWVkTWVzaChhLkdldFNvdXJjZU1lc2goKSwgYywgdGhpcy5fcmVuZGVyZXJUZXh0LkdldFRleFJlY3QoKSk7CiAgICAgICAgICAgIGEuU2V0TWVzaENoYW5nZWQoITEpCiAgICAgICAgfQogICAgICAgIGQuRHJhdyhiKQogICAgfQogICAgX1BpeGVsUm91bmRRdWFkKGEpIHsKICAgICAgICBjb25zdCBiID0gYS5nZXRUbHgoKSAtIE1hdGgucm91bmQoYS5nZXRUbHgoKSksCiAgICAgICAgICAgIGQgPSBhLmdldFRseSgpIC0gTWF0aC5yb3VuZChhLmdldFRseSgpKTsKICAgICAgICBpZiAoMCA9PT0gYiAmJiAwID09PSBkKSByZXR1cm4gYTsKICAgICAgICB0ZW1wUXVhZCRqc2NvbXAkNy5jb3B5KGEpOwogICAgICAgIHRlbXBRdWFkJGpzY29tcCQ3Lm9mZnNldCgtYiwgLWQpOwogICAgICAgIHJldHVybiB0ZW1wUXVhZCRqc2NvbXAkNwogICAgfQogICAgR2V0Q3VycmVudFN1cmZhY2VTaXplKCkgewogICAgICAgIGNvbnN0IGEgPSB0aGlzLl9yZW5kZXJlclRleHQuR2V0VGV4dHVyZSgpOwogICAgICAgIHJldHVybiBhID8gW2EuR2V0V2lkdGgoKSwgYS5HZXRIZWlnaHQoKV0gOiBbMTAwLCAxMDBdCiAgICB9CiAgICBHZXRDdXJyZW50VGV4UmVjdCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcmVuZGVyZXJUZXh0LkdldFRleFJlY3QoKQogICAgfQogICAgSXNDdXJyZW50VGV4Um90YXRlZCgpIHsKICAgICAgICByZXR1cm4gITEKICAgIH0KICAgIFNhdmVUb0pzb24oKSB7CiAgICAgICAgY29uc3QgYSA9IHsKICAgICAgICAgICAgdDogdGhpcy5fdGV4dCwKICAgICAgICAgICAgYzogdGhpcy5fY29sb3IudG9KU09OKCksCiAgICAgICAgICAgIGZuOiB0aGlzLl9mYWNlTmFtZSwKICAgICAgICAgICAgcHM6IHRoaXMuX3B0U2l6ZQogICAgICAgIH07CiAgICAgICAgdGhpcy5fZW5hYmxlQkJjb2RlICYmIChhLmJiYyA9IHRoaXMuX2VuYWJsZUJCY29kZSk7CiAgICAgICAgMCAhPT0gdGhpcy5faG9yaXpvbnRhbEFsaWduICYmIChhLmhhID0gdGhpcy5faG9yaXpvbnRhbEFsaWduKTsKICAgICAgICAwICE9PSB0aGlzLl92ZXJ0aWNhbEFsaWduICYmIChhLnZhID0gdGhpcy5fdmVydGljYWxBbGlnbik7CiAgICAgICAgdGhpcy5fd3JhcEJ5V29yZCB8fCAoYS53ciA9IHRoaXMuX3dyYXBCeVdvcmQpOwogICAgICAgIDAgIT09IHRoaXMuX2xpbmVIZWlnaHRPZmZzZXQgJiYgKGEubGhvID0gdGhpcy5fbGluZUhlaWdodE9mZnNldCk7CiAgICAgICAgdGhpcy5faXNCb2xkICYmIChhLmIgPSB0aGlzLl9pc0JvbGQpOwogICAgICAgIHRoaXMuX2lzSXRhbGljICYmIChhLmkgPSB0aGlzLl9pc0l0YWxpYyk7IC0gMSAhPT0gdGhpcy5fdHlwZXdyaXRlckVuZFRpbWUgJiYgKGEudHcgPSB7CiAgICAgICAgICAgIHN0OiB0aGlzLl90eXBld3JpdGVyU3RhcnRUaW1lLAogICAgICAgICAgICBlbjogdGhpcy5fdHlwZXdyaXRlckVuZFRpbWUsCiAgICAgICAgICAgIGw6IHRoaXMuX3R5cGV3cml0ZXJMZW5ndGgKICAgICAgICB9KTsKICAgICAgICByZXR1cm4gYQogICAgfQogICAgTG9hZEZyb21Kc29uKGEpIHsKICAgICAgICB0aGlzLl9DYW5jZWxUeXBld3JpdGVyKCk7CiAgICAgICAgdGhpcy5fdGV4dCA9IGEudDsKICAgICAgICB0aGlzLl9jb2xvci5zZXRGcm9tSlNPTihhLmMpOwogICAgICAgIHRoaXMuX2ZhY2VOYW1lID0gYS5mbjsKICAgICAgICB0aGlzLl9wdFNpemUgPSBhLnBzOwogICAgICAgIHRoaXMuX2VuYWJsZUJCY29kZSA9IGEuaGFzT3duUHJvcGVydHkoImJiYyIpID8gYS5iYmMgOiAhMTsKICAgICAgICB0aGlzLl9ob3Jpem9udGFsQWxpZ24gPSBhLmhhc093blByb3BlcnR5KCJoYSIpID8gYS5oYSA6IDA7CiAgICAgICAgdGhpcy5fdmVydGljYWxBbGlnbiA9IGEuaGFzT3duUHJvcGVydHkoInZhIikgPyBhLnZhIDogMDsKICAgICAgICB0aGlzLl93cmFwQnlXb3JkID0gYS5oYXNPd25Qcm9wZXJ0eSgid3IiKSA/IGEud3IgOiAhMDsKICAgICAgICB0aGlzLl9saW5lSGVpZ2h0T2Zmc2V0ID0gYS5oYXNPd25Qcm9wZXJ0eSgibGhvIikgPyBhLmxobyA6IDA7CiAgICAgICAgdGhpcy5faXNCb2xkID0gYS5oYXNPd25Qcm9wZXJ0eSgiYiIpID8gYS5iIDogITE7CiAgICAgICAgdGhpcy5faXNJdGFsaWMgPSBhLmhhc093blByb3BlcnR5KCJpIikgPyBhLmkgOiAhMTsKICAgICAgICBhLmhhc093blByb3BlcnR5KCJ0dyIpICYmIChhID0gYS50dywgdGhpcy5fdHlwZXdyaXRlclN0YXJ0VGltZSA9IGEuc3QsIHRoaXMuX3R5cGV3cml0ZXJFbmRUaW1lID0KICAgICAgICAgICAgYS5lbiwgdGhpcy5fdHlwZXdyaXRlckxlbmd0aCA9IGEubCk7CiAgICAgICAgdGhpcy5fVXBkYXRlVGV4dFNldHRpbmdzKCk7IC0gMSAhPT0gdGhpcy5fdHlwZXdyaXRlckVuZFRpbWUgJiYgdGhpcy5fU3RhcnRUaWNraW5nKCkKICAgIH0KICAgIEdldFByb3BlcnR5VmFsdWVCeUluZGV4KGEpIHsKICAgICAgICBzd2l0Y2ggKGEpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RleHQ7CiAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9lbmFibGVCQmNvZGU7CiAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9mYWNlTmFtZTsKICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3B0U2l6ZTsKICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2xpbmVIZWlnaHRPZmZzZXQ7CiAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9pc0JvbGQ7CiAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9pc0l0YWxpYzsKICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgcmV0dXJuIFRFTVBfQ09MT1JfQVJSQVkkanNjb21wJDFbMF0gPSB0aGlzLl9jb2xvci5nZXRSKCksIFRFTVBfQ09MT1JfQVJSQVkkanNjb21wJDFbMV0gPSB0aGlzLl9jb2xvci5nZXRHKCksIFRFTVBfQ09MT1JfQVJSQVkkanNjb21wJDFbMl0gPSB0aGlzLl9jb2xvci5nZXRCKCksCiAgICAgICAgICAgICAgICAgICAgVEVNUF9DT0xPUl9BUlJBWSRqc2NvbXAkMTsKICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2hvcml6b250YWxBbGlnbjsKICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3ZlcnRpY2FsQWxpZ247CiAgICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fd3JhcEJ5V29yZCA/IDEgOiAwCiAgICAgICAgfQogICAgfQogICAgU2V0UHJvcGVydHlWYWx1ZUJ5SW5kZXgoYSwgYikgewogICAgICAgIHN3aXRjaCAoYSkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fdGV4dCA9PT0gYikgYnJlYWs7CiAgICAgICAgICAgICAgICB0aGlzLl90ZXh0ID0gYjsKICAgICAgICAgICAgICAgIHRoaXMuX1VwZGF0ZVRleHRTZXR0aW5ncygpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9lbmFibGVCQmNvZGUgPT09ICEhYikgYnJlYWs7CiAgICAgICAgICAgICAgICB0aGlzLl9lbmFibGVCQmNvZGUgPSAhIWI7CiAgICAgICAgICAgICAgICB0aGlzLl9VcGRhdGVUZXh0U2V0dGluZ3MoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fZmFjZU5hbWUgPT09IGIpIGJyZWFrOwogICAgICAgICAgICAgICAgdGhpcy5fZmFjZU5hbWUgPSBiOwogICAgICAgICAgICAgICAgdGhpcy5fVXBkYXRlVGV4dFNldHRpbmdzKCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgaWYgKHRoaXMuX3B0U2l6ZSA9PT0gYikgYnJlYWs7CiAgICAgICAgICAgICAgICB0aGlzLl9wdFNpemUgPSBiOwogICAgICAgICAgICAgICAgdGhpcy5fVXBkYXRlVGV4dFNldHRpbmdzKCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgaWYgKHRoaXMuX2xpbmVIZWlnaHRPZmZzZXQgPT09IGIpIGJyZWFrOwogICAgICAgICAgICAgICAgdGhpcy5fbGluZUhlaWdodE9mZnNldCA9IGI7CiAgICAgICAgICAgICAgICB0aGlzLl9VcGRhdGVUZXh0U2V0dGluZ3MoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICBpZiAodGhpcy5faXNCb2xkID09PSAhIWIpIGJyZWFrOwogICAgICAgICAgICAgICAgdGhpcy5faXNCb2xkID0gISFiOwogICAgICAgICAgICAgICAgdGhpcy5fVXBkYXRlVGV4dFNldHRpbmdzKCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgICAgaWYgKHRoaXMuX2lzSXRhbGljID09PSAhIWIpIGJyZWFrOwogICAgICAgICAgICAgICAgdGhpcy5faXNJdGFsaWMgPSAhIWI7CiAgICAgICAgICAgICAgICB0aGlzLl9VcGRhdGVUZXh0U2V0dGluZ3MoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgICBhID0gdGhpcy5fY29sb3I7CiAgICAgICAgICAgICAgICBpZiAoYS5nZXRSKCkgPT09IGJbMF0gJiYgYS5nZXRHKCkgPT09IGJbMV0gJiYgYS5nZXRCKCkgPT09IGJbMl0pIGJyZWFrOwogICAgICAgICAgICAgICAgdGhpcy5fY29sb3Iuc2V0UmdiKGJbMF0sIGJbMV0sIGJbMl0pOwogICAgICAgICAgICAgICAgdGhpcy5fVXBkYXRlVGV4dFNldHRpbmdzKCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICAgICAgaWYgKHRoaXMuX2hvcml6b250YWxBbGlnbiA9PT0gYikgYnJlYWs7CiAgICAgICAgICAgICAgICB0aGlzLl9ob3Jpem9udGFsQWxpZ24gPSBiOwogICAgICAgICAgICAgICAgdGhpcy5fVXBkYXRlVGV4dFNldHRpbmdzKCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgICAgaWYgKHRoaXMuX3ZlcnRpY2FsQWxpZ24gPT09IGIpIGJyZWFrOwogICAgICAgICAgICAgICAgdGhpcy5fdmVydGljYWxBbGlnbiA9IGI7CiAgICAgICAgICAgICAgICB0aGlzLl9VcGRhdGVUZXh0U2V0dGluZ3MoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICAgICAgdGhpcy5fd3JhcEJ5V29yZCAhPT0gKDAgPT09IGIpICYmICh0aGlzLl93cmFwQnlXb3JkID0gMCA9PT0gYiwgdGhpcy5fVXBkYXRlVGV4dFNldHRpbmdzKCkpCiAgICAgICAgfQogICAgfQogICAgU2V0UHJvcGVydHlDb2xvck9mZnNldFZhbHVlQnlJbmRleChhLCBiLCBkLCBjKSB7CiAgICAgICAgaWYgKDAgIT09IGIgfHwgMCAhPT0gZCB8fCAwICE9PSBjKSBzd2l0Y2ggKGEpIHsKICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgdGhpcy5fY29sb3IuYWRkUmdiKGIsIGQsIGMpLCB0aGlzLl9VcGRhdGVUZXh0U2V0dGluZ3MoKQogICAgICAgIH0KICAgIH0KICAgIF9TZXRUZXh0KGEpIHsKICAgICAgICB0aGlzLl90ZXh0ICE9PSBhICYmICh0aGlzLl90ZXh0ID0gYSwgdGhpcy5fcmVuZGVyZXJUZXh0LlNldFRleHQoYSksIHRoaXMuX3J1bnRpbWUuVXBkYXRlUmVuZGVyKCkpCiAgICB9CiAgICBHZXRUZXh0KCkgewogICAgICAgIHJldHVybiB0aGlzLl90ZXh0CiAgICB9CiAgICBfU3RhcnRUeXBld3JpdGVyKGEsIGIpIHsKICAgICAgICB0aGlzLl9TZXRUZXh0KGEpOwogICAgICAgIHRoaXMuX3R5cGV3cml0ZXJTdGFydFRpbWUgPQogICAgICAgICAgICB0aGlzLl9ydW50aW1lLkdldFdhbGxUaW1lKCk7CiAgICAgICAgdGhpcy5fdHlwZXdyaXRlckVuZFRpbWUgPSB0aGlzLl90eXBld3JpdGVyU3RhcnRUaW1lICsgYiAvIHRoaXMuR2V0SW5zdGFuY2UoKS5HZXRBY3RpdmVUaW1lU2NhbGUoKTsKICAgICAgICB0aGlzLl90eXBld3JpdGVyTGVuZ3RoID0gQzMkanNjb21wJDE5NC5Db3VudEdyYXBoZW1lcyhDMyRqc2NvbXAkMTk0LkJCU3RyaW5nLlN0cmlwQW55VGFncyhhKSk7CiAgICAgICAgdGhpcy5fcmVuZGVyZXJUZXh0LlNldERyYXdNYXhDaGFyYWN0ZXJDb3VudCgwKTsKICAgICAgICB0aGlzLl9TdGFydFRpY2tpbmcoKQogICAgfQogICAgX0NhbmNlbFR5cGV3cml0ZXIoKSB7CiAgICAgICAgdGhpcy5fdHlwZXdyaXRlckVuZFRpbWUgPSB0aGlzLl90eXBld3JpdGVyU3RhcnRUaW1lID0gLTE7CiAgICAgICAgdGhpcy5fdHlwZXdyaXRlckxlbmd0aCA9IDA7CiAgICAgICAgdGhpcy5fcmVuZGVyZXJUZXh0LlNldERyYXdNYXhDaGFyYWN0ZXJDb3VudCgtMSk7CiAgICAgICAgdGhpcy5fU3RvcFRpY2tpbmcoKQogICAgfQogICAgX0ZpbmlzaFR5cGV3cml0ZXIoKSB7CiAgICAgICAgLTEgIT09IHRoaXMuX3R5cGV3cml0ZXJFbmRUaW1lICYmICh0aGlzLl9DYW5jZWxUeXBld3JpdGVyKCksCiAgICAgICAgICAgIHRoaXMuVHJpZ2dlcihDMyRqc2NvbXAkMTk0LlBsdWdpbnMuVGV4dC5DbmRzLk9uVHlwZXdyaXRlclRleHRGaW5pc2hlZCksIHRoaXMuX3J1bnRpbWUuVXBkYXRlUmVuZGVyKCkpCiAgICB9CiAgICBfU2V0Rm9udEZhY2UoYSkgewogICAgICAgIHRoaXMuX2ZhY2VOYW1lICE9PSBhICYmICh0aGlzLl9mYWNlTmFtZSA9IGEsIHRoaXMuX3JlbmRlcmVyVGV4dC5TZXRGb250TmFtZShhKSwgdGhpcy5fcnVudGltZS5VcGRhdGVSZW5kZXIoKSkKICAgIH0KICAgIF9HZXRGb250RmFjZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZmFjZU5hbWUKICAgIH0KICAgIF9TZXRCb2xkKGEpIHsKICAgICAgICBhID0gISFhOwogICAgICAgIHRoaXMuX2lzQm9sZCAhPT0gYSAmJiAodGhpcy5faXNCb2xkID0gYSwgdGhpcy5fcmVuZGVyZXJUZXh0LlNldEJvbGQoYSksIHRoaXMuX3J1bnRpbWUuVXBkYXRlUmVuZGVyKCkpCiAgICB9CiAgICBfSXNCb2xkKCkgewogICAgICAgIHJldHVybiB0aGlzLl9pc0JvbGQKICAgIH0KICAgIF9TZXRJdGFsaWMoYSkgewogICAgICAgIGEgPSAhIWE7CiAgICAgICAgdGhpcy5faXNJdGFsaWMgIT09IGEgJiYgKHRoaXMuX2lzSXRhbGljID0gYSwgdGhpcy5fcmVuZGVyZXJUZXh0LlNldEl0YWxpYyhhKSwgdGhpcy5fcnVudGltZS5VcGRhdGVSZW5kZXIoKSkKICAgIH0KICAgIF9Jc0l0YWxpYygpIHsKICAgICAgICByZXR1cm4gdGhpcy5faXNJdGFsaWMKICAgIH0KICAgIF9TZXRGb250U2l6ZShhKSB7CiAgICAgICAgdGhpcy5fcHRTaXplICE9PQogICAgICAgICAgICBhICYmICh0aGlzLl9wdFNpemUgPSBhLCB0aGlzLl9ydW50aW1lLlVwZGF0ZVJlbmRlcigpKQogICAgfQogICAgX0dldEZvbnRTaXplKCkgewogICAgICAgIHJldHVybiB0aGlzLl9wdFNpemUKICAgIH0KICAgIF9TZXRGb250Q29sb3IoYSkgewogICAgICAgIHRoaXMuX2NvbG9yLmVxdWFsc0lnbm9yaW5nQWxwaGEoYSkgfHwgKHRoaXMuX2NvbG9yLmNvcHlSZ2IoYSksIHRoaXMuX3JlbmRlcmVyVGV4dC5TZXRDb2xvcih0aGlzLl9jb2xvciksIHRoaXMuX3J1bnRpbWUuVXBkYXRlUmVuZGVyKCkpCiAgICB9CiAgICBfR2V0Rm9udENvbG9yKCkgewogICAgICAgIHJldHVybiB0aGlzLl9jb2xvcgogICAgfQogICAgX1NldExpbmVIZWlnaHQoYSkgewogICAgICAgIHRoaXMuX2xpbmVIZWlnaHRPZmZzZXQgIT09IGEgJiYgKHRoaXMuX2xpbmVIZWlnaHRPZmZzZXQgPSBhLCB0aGlzLl9VcGRhdGVUZXh0U2V0dGluZ3MoKSwgdGhpcy5fcnVudGltZS5VcGRhdGVSZW5kZXIoKSkKICAgIH0KICAgIF9HZXRMaW5lSGVpZ2h0KCkgewogICAgICAgIHJldHVybiB0aGlzLl9saW5lSGVpZ2h0T2Zmc2V0CiAgICB9CiAgICBfU2V0SEFsaWduKGEpIHsKICAgICAgICB0aGlzLl9ob3Jpem9udGFsQWxpZ24gIT09IGEgJiYgKHRoaXMuX2hvcml6b250YWxBbGlnbiA9CiAgICAgICAgICAgIGEsIHRoaXMuX1VwZGF0ZVRleHRTZXR0aW5ncygpLCB0aGlzLl9ydW50aW1lLlVwZGF0ZVJlbmRlcigpKQogICAgfQogICAgX0dldEhBbGlnbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5faG9yaXpvbnRhbEFsaWduCiAgICB9CiAgICBfU2V0VkFsaWduKGEpIHsKICAgICAgICB0aGlzLl92ZXJ0aWNhbEFsaWduICE9PSBhICYmICh0aGlzLl92ZXJ0aWNhbEFsaWduID0gYSwgdGhpcy5fVXBkYXRlVGV4dFNldHRpbmdzKCksIHRoaXMuX3J1bnRpbWUuVXBkYXRlUmVuZGVyKCkpCiAgICB9CiAgICBfR2V0VkFsaWduKCkgewogICAgICAgIHJldHVybiB0aGlzLl92ZXJ0aWNhbEFsaWduCiAgICB9CiAgICBfU2V0V3JhcEJ5V29yZChhKSB7CiAgICAgICAgYSA9ICEhYTsKICAgICAgICB0aGlzLl93cmFwQnlXb3JkICE9PSBhICYmICh0aGlzLl93cmFwQnlXb3JkID0gYSwgdGhpcy5fVXBkYXRlVGV4dFNldHRpbmdzKCksIHRoaXMuX3J1bnRpbWUuVXBkYXRlUmVuZGVyKCkpCiAgICB9CiAgICBfSXNXcmFwQnlXb3JkKCkgewogICAgICAgIHJldHVybiB0aGlzLl93cmFwQnlXb3JkCiAgICB9CiAgICBfR2V0VGV4dFdpZHRoKCkgewogICAgICAgIHRoaXMuX1VwZGF0ZVRleHRTaXplKCk7CiAgICAgICAgcmV0dXJuIHRoaXMuX3JlbmRlcmVyVGV4dC5HZXRUZXh0V2lkdGgoKQogICAgfQogICAgX0dldFRleHRIZWlnaHQoKSB7CiAgICAgICAgdGhpcy5fVXBkYXRlVGV4dFNpemUoKTsKICAgICAgICByZXR1cm4gdGhpcy5fcmVuZGVyZXJUZXh0LkdldFRleHRIZWlnaHQoKQogICAgfQogICAgVGljaygpIHsKICAgICAgICB2YXIgYSA9IHRoaXMuX3J1bnRpbWUuR2V0V2FsbFRpbWUoKTsKICAgICAgICBhID49IHRoaXMuX3R5cGV3cml0ZXJFbmRUaW1lID8gKHRoaXMuX0NhbmNlbFR5cGV3cml0ZXIoKSwgdGhpcy5UcmlnZ2VyKEMzJGpzY29tcCQxOTQuUGx1Z2lucy5UZXh0LkNuZHMuT25UeXBld3JpdGVyVGV4dEZpbmlzaGVkKSwgdGhpcy5fcnVudGltZS5VcGRhdGVSZW5kZXIoKSkgOiAoYSA9IEMzJGpzY29tcCQxOTQucmVsZXJwKHRoaXMuX3R5cGV3cml0ZXJTdGFydFRpbWUsIHRoaXMuX3R5cGV3cml0ZXJFbmRUaW1lLCBhLCAwLCB0aGlzLl90eXBld3JpdGVyTGVuZ3RoKSwgYSA9IE1hdGguZmxvb3IoYSksIGEgIT09IHRoaXMuX3JlbmRlcmVyVGV4dC5HZXREcmF3TWF4Q2hhcmFjdGVyQ291bnQoKSAmJiAodGhpcy5fcmVuZGVyZXJUZXh0LlNldERyYXdNYXhDaGFyYWN0ZXJDb3VudChhKSwgdGhpcy5fcnVudGltZS5VcGRhdGVSZW5kZXIoKSkpCiAgICB9CiAgICBHZXREZWJ1Z2dlclByb3BlcnRpZXMoKSB7CiAgICAgICAgcmV0dXJuIFt7CiAgICAgICAgICAgIHRpdGxlOiAicGx1Z2lucy50ZXh0Lm5hbWUiLAogICAgICAgICAgICBwcm9wZXJ0aWVzOiBbewogICAgICAgICAgICAgICAgbmFtZTogInBsdWdpbnMudGV4dC5wcm9wZXJ0aWVzLnRleHQubmFtZSIsCiAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5fdGV4dCwKICAgICAgICAgICAgICAgIG9uZWRpdDogYSA9PiB0aGlzLl9TZXRUZXh0KGEpCiAgICAgICAgICAgIH1dCiAgICAgICAgfV0KICAgIH0KICAgIEdldFNjcmlwdEludGVyZmFjZUNsYXNzKCkgewogICAgICAgIHJldHVybiBzZWxmLklUZXh0SW5zdGFuY2UKICAgIH0KfTsKY29uc3QgbWFwJGpzY29tcCQyMSA9IG5ldyBXZWFrTWFwLAogICAgU0NSSVBUX0hPUklaT05UQUxfQUxJR05NRU5UUyA9IG5ldyBNYXAoWwogICAgICAgIFsibGVmdCIsIDBdLAogICAgICAgIFsiY2VudGVyIiwgMV0sCiAgICAgICAgWyJyaWdodCIsIDJdCiAgICBdKSwKICAgIFNDUklQVF9WRVJUSUNBTF9BTElHTk1FTlRTID0gbmV3IE1hcChbCiAgICAgICAgWyJ0b3AiLCAwXSwKICAgICAgICBbImNlbnRlciIsIDFdLAogICAgICAgIFsiYm90dG9tIiwgMl0KICAgIF0pLAogICAgU0NSSVBUX1dSQVBfTU9ERVMgPSBuZXcgTWFwKFsKICAgICAgICBbIndvcmQiLCAhMF0sCiAgICAgICAgWyJjaGFyYWN0ZXIiLCAhMV0KICAgIF0pOwpzZWxmLklUZXh0SW5zdGFuY2UgPSBjbGFzcyBleHRlbmRzIHNlbGYuSVdvcmxkSW5zdGFuY2UgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgICAgc3VwZXIoKTsKICAgICAgICBtYXAkanNjb21wJDIxLnNldCh0aGlzLCBzZWxmLklJbnN0YW5jZS5fR2V0SW5pdEluc3QoKS5HZXRTZGtJbnN0YW5jZSgpKQogICAgfQogICAgZ2V0IHRleHQoKSB7CiAgICAgICAgcmV0dXJuIG1hcCRqc2NvbXAkMjEuZ2V0KHRoaXMpLkdldFRleHQoKQogICAgfQogICAgc2V0IHRleHQoYSkgewogICAgICAgIEMzWCRqc2NvbXAkMjAuUmVxdWlyZVN0cmluZyhhKTsKICAgICAgICBjb25zdCBiID0gbWFwJGpzY29tcCQyMS5nZXQodGhpcyk7CiAgICAgICAgYi5fQ2FuY2VsVHlwZXdyaXRlcigpOwogICAgICAgIGIuX1NldFRleHQoYSkKICAgIH0KICAgIHR5cGV3cml0ZXJUZXh0KGEsIGIpIHsKICAgICAgICBDM1gkanNjb21wJDIwLlJlcXVpcmVTdHJpbmcoYSk7CiAgICAgICAgQzNYJGpzY29tcCQyMC5SZXF1aXJlRmluaXRlTnVtYmVyKGIpOwogICAgICAgIGNvbnN0IGQgPSBtYXAkanNjb21wJDIxLmdldCh0aGlzKTsKICAgICAgICBkLl9DYW5jZWxUeXBld3JpdGVyKCk7CiAgICAgICAgZC5fU3RhcnRUeXBld3JpdGVyKGEsIGIpCiAgICB9CiAgICB0eXBld3JpdGVyRmluaXNoKCkgewogICAgICAgIG1hcCRqc2NvbXAkMjEuZ2V0KHRoaXMpLl9GaW5pc2hUeXBld3JpdGVyKCkKICAgIH0KICAgIHNldCBmb250RmFjZShhKSB7CiAgICAgICAgQzNYJGpzY29tcCQyMC5SZXF1aXJlU3RyaW5nKGEpOwogICAgICAgIG1hcCRqc2NvbXAkMjEuZ2V0KHRoaXMpLl9TZXRGb250RmFjZShhKQogICAgfQogICAgZ2V0IGZvbnRGYWNlKCkgewogICAgICAgIHJldHVybiBtYXAkanNjb21wJDIxLmdldCh0aGlzKS5fR2V0Rm9udEZhY2UoKQogICAgfQogICAgc2V0IGlzQm9sZChhKSB7CiAgICAgICAgbWFwJGpzY29tcCQyMS5nZXQodGhpcykuX1NldEJvbGQoYSkKICAgIH0KICAgIGdldCBpc0JvbGQoKSB7CiAgICAgICAgcmV0dXJuIG1hcCRqc2NvbXAkMjEuZ2V0KHRoaXMpLl9Jc0JvbGQoKQogICAgfQogICAgc2V0IGlzSXRhbGljKGEpIHsKICAgICAgICBtYXAkanNjb21wJDIxLmdldCh0aGlzKS5fU2V0SXRhbGljKGEpCiAgICB9CiAgICBnZXQgaXNJdGFsaWMoKSB7CiAgICAgICAgcmV0dXJuIG1hcCRqc2NvbXAkMjEuZ2V0KHRoaXMpLl9Jc0l0YWxpYygpCiAgICB9CiAgICBzZXQgc2l6ZVB0KGEpIHsKICAgICAgICBDM1gkanNjb21wJDIwLlJlcXVpcmVGaW5pdGVOdW1iZXIoYSk7CiAgICAgICAgbWFwJGpzY29tcCQyMS5nZXQodGhpcykuX1NldEZvbnRTaXplKGEpCiAgICB9CiAgICBnZXQgc2l6ZVB0KCkgewogICAgICAgIHJldHVybiBtYXAkanNjb21wJDIxLmdldCh0aGlzKS5fR2V0Rm9udFNpemUoKQogICAgfQogICAgc2V0IGZvbnRDb2xvcihhKSB7CiAgICAgICAgQzNYJGpzY29tcCQyMC5SZXF1aXJlQXJyYXkoYSk7CiAgICAgICAgaWYgKDMgPiBhLmxlbmd0aCkgdGhyb3cgRXJyb3IoImV4cGVjdGVkIDMgZWxlbWVudHMiKTsKICAgICAgICB0ZW1wQ29sb3IkanNjb21wJDguc2V0UmdiKGFbMF0sIGFbMV0sIGFbMl0pOwogICAgICAgIG1hcCRqc2NvbXAkMjEuZ2V0KHRoaXMpLl9TZXRGb250Q29sb3IodGVtcENvbG9yJGpzY29tcCQ4KQogICAgfQogICAgZ2V0IGZvbnRDb2xvcigpIHsKICAgICAgICBjb25zdCBhID0gbWFwJGpzY29tcCQyMS5nZXQodGhpcykuX0dldEZvbnRDb2xvcigpOwogICAgICAgIHJldHVybiBbYS5nZXRSKCksIGEuZ2V0RygpLCBhLmdldEIoKV0KICAgIH0KICAgIHNldCBsaW5lSGVpZ2h0KGEpIHsKICAgICAgICBDM1gkanNjb21wJDIwLlJlcXVpcmVGaW5pdGVOdW1iZXIoYSk7CiAgICAgICAgbWFwJGpzY29tcCQyMS5nZXQodGhpcykuX1NldExpbmVIZWlnaHQoYSkKICAgIH0KICAgIGdldCBsaW5lSGVpZ2h0KCkgewogICAgICAgIHJldHVybiBtYXAkanNjb21wJDIxLmdldCh0aGlzKS5fR2V0TGluZUhlaWdodCgpCiAgICB9CiAgICBzZXQgaG9yaXpvbnRhbEFsaWduKGEpIHsKICAgICAgICBDM1gkanNjb21wJDIwLlJlcXVpcmVTdHJpbmcoYSk7CiAgICAgICAgYSA9IFNDUklQVF9IT1JJWk9OVEFMX0FMSUdOTUVOVFMuZ2V0KGEpOwogICAgICAgIGlmICgidW5kZWZpbmVkIiA9PT0gdHlwZW9mIGEpIHRocm93IEVycm9yKCJpbnZhbGlkIG1vZGUiKTsKICAgICAgICBtYXAkanNjb21wJDIxLmdldCh0aGlzKS5fU2V0SEFsaWduKGEpCiAgICB9CiAgICBnZXQgaG9yaXpvbnRhbEFsaWduKCkgewogICAgICAgIHJldHVybiBIT1JJWk9OVEFMX0FMSUdOTUVOVFNbbWFwJGpzY29tcCQyMS5nZXQodGhpcykuX0dldEhBbGlnbigpXQogICAgfQogICAgc2V0IHZlcnRpY2FsQWxpZ24oYSkgewogICAgICAgIEMzWCRqc2NvbXAkMjAuUmVxdWlyZVN0cmluZyhhKTsKICAgICAgICBhID0gU0NSSVBUX1ZFUlRJQ0FMX0FMSUdOTUVOVFMuZ2V0KGEpOwogICAgICAgIGlmICgidW5kZWZpbmVkIiA9PT0gdHlwZW9mIGEpIHRocm93IEVycm9yKCJpbnZhbGlkIG1vZGUiKTsKICAgICAgICBtYXAkanNjb21wJDIxLmdldCh0aGlzKS5fU2V0VkFsaWduKGEpCiAgICB9CiAgICBnZXQgdmVydGljYWxBbGlnbigpIHsKICAgICAgICByZXR1cm4gVkVSVElDQUxfQUxJR05NRU5UU1ttYXAkanNjb21wJDIxLmdldCh0aGlzKS5fR2V0VkFsaWduKCldCiAgICB9CiAgICBzZXQgd29yZFdyYXBNb2RlKGEpIHsKICAgICAgICBDM1gkanNjb21wJDIwLlJlcXVpcmVTdHJpbmcoYSk7CiAgICAgICAgYSA9IFNDUklQVF9XUkFQX01PREVTLmdldChhKTsKICAgICAgICBpZiAoInVuZGVmaW5lZCIgPT09IHR5cGVvZiBhKSB0aHJvdyBFcnJvcigiaW52YWxpZCBtb2RlIik7CiAgICAgICAgbWFwJGpzY29tcCQyMS5nZXQodGhpcykuX1NldFdyYXBCeVdvcmQoYSkKICAgIH0KICAgIGdldCB3b3JkV3JhcE1vZGUoKSB7CiAgICAgICAgcmV0dXJuIG1hcCRqc2NvbXAkMjEuZ2V0KHRoaXMpLl9Jc1dyYXBCeVdvcmQoKSA/ICJ3b3JkIiA6ICJjaGFyYWN0ZXIiCiAgICB9CiAgICBnZXQgdGV4dFdpZHRoKCkgewogICAgICAgIHJldHVybiBtYXAkanNjb21wJDIxLmdldCh0aGlzKS5fR2V0VGV4dFdpZHRoKCkKICAgIH0KICAgIGdldCB0ZXh0SGVpZ2h0KCkgewogICAgICAgIHJldHVybiBtYXAkanNjb21wJDIxLmdldCh0aGlzKS5fR2V0VGV4dEhlaWdodCgpCiAgICB9Cn07CmNvbnN0IEMzJGpzY29tcCQxOTUgPSBzZWxmLkMzOwpDMyRqc2NvbXAkMTk1LlBsdWdpbnMuVGV4dC5DbmRzID0gewogICAgQ29tcGFyZVRleHQoYSwgYikgewogICAgICAgIHJldHVybiBiID8gdGhpcy5fdGV4dCA9PT0gYSA6IEMzJGpzY29tcCQxOTUuZXF1YWxzTm9DYXNlKHRoaXMuX3RleHQsIGEpCiAgICB9LAogICAgSXNSdW5uaW5nVHlwZXdyaXRlclRleHQoKSB7CiAgICAgICAgcmV0dXJuIC0xICE9PSB0aGlzLl90eXBld3JpdGVyRW5kVGltZQogICAgfSwKICAgIE9uVHlwZXdyaXRlclRleHRGaW5pc2hlZCgpIHsKICAgICAgICByZXR1cm4gITAKICAgIH0KfTsKY29uc3QgQzMkanNjb21wJDE5NiA9IHNlbGYuQzMsCiAgICB0ZW1wQ29sb3IkanNjb21wJDkgPSBDMyRqc2NvbXAkMTk2Lk5ldyhDMyRqc2NvbXAkMTk2LkNvbG9yKTsKQzMkanNjb21wJDE5Ni5QbHVnaW5zLlRleHQuQWN0cyA9IHsKICAgIFNldFRleHQoYSkgewogICAgICAgIHRoaXMuX0NhbmNlbFR5cGV3cml0ZXIoKTsKICAgICAgICAibnVtYmVyIiA9PT0gdHlwZW9mIGEgJiYgMUU5ID4gYSAmJiAoYSA9IE1hdGgucm91bmQoMUUxMCAqIGEpIC8gMUUxMCk7CiAgICAgICAgdGhpcy5fU2V0VGV4dChhLnRvU3RyaW5nKCkpCiAgICB9LAogICAgQXBwZW5kVGV4dChhKSB7CiAgICAgICAgdGhpcy5fQ2FuY2VsVHlwZXdyaXRlcigpOwogICAgICAgICJudW1iZXIiID09PSB0eXBlb2YgYSAmJiAxRTkgPiBhICYmIChhID0gTWF0aC5yb3VuZCgxRTEwICogYSkgLyAxRTEwKTsKICAgICAgICAoYSA9IGEudG9TdHJpbmcoKSkgJiYgdGhpcy5fU2V0VGV4dCh0aGlzLl90ZXh0ICsgYSkKICAgIH0sCiAgICBUeXBld3JpdGVyVGV4dChhLCBiKSB7CiAgICAgICAgdGhpcy5fQ2FuY2VsVHlwZXdyaXRlcigpOwogICAgICAgICJudW1iZXIiID09PSB0eXBlb2YgYSAmJiAxRTkgPiBhICYmIChhID0gTWF0aC5yb3VuZCgxRTEwICogYSkgLyAxRTEwKTsKICAgICAgICB0aGlzLl9TdGFydFR5cGV3cml0ZXIoYS50b1N0cmluZygpLCBiKQogICAgfSwKICAgIFNldEZvbnRGYWNlKGEsIGIpIHsKICAgICAgICBsZXQgZCA9ICExLAogICAgICAgICAgICBjID0gITE7CiAgICAgICAgc3dpdGNoIChiKSB7CiAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgIGQgPSAhMDsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICBjID0gITA7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgYyA9IGQgPSAhMAogICAgICAgIH0KICAgICAgICBpZiAoYSAhPT0gdGhpcy5fZmFjZU5hbWUgfHwgZCAhPT0gdGhpcy5faXNCb2xkIHx8IGMgIT09IHRoaXMuX2lzSXRhbGljKSB0aGlzLl9TZXRGb250RmFjZShhKSwgdGhpcy5fU2V0Qm9sZChkKSwgdGhpcy5fU2V0SXRhbGljKGMpCiAgICB9LAogICAgU2V0Rm9udFNpemUoYSkgewogICAgICAgIHRoaXMuX1NldEZvbnRTaXplKGEpCiAgICB9LAogICAgU2V0Rm9udENvbG9yKGEpIHsKICAgICAgICB0ZW1wQ29sb3IkanNjb21wJDkuc2V0RnJvbVJnYlZhbHVlKGEpOwogICAgICAgIHRlbXBDb2xvciRqc2NvbXAkOS5jbGFtcCgpOwogICAgICAgIHRoaXMuX1NldEZvbnRDb2xvcih0ZW1wQ29sb3IkanNjb21wJDkpCiAgICB9LAogICAgU2V0V2ViRm9udChhLCBiKSB7CiAgICAgICAgY29uc29sZS53YXJuKCJbVGV4dF0gJ1NldCB3ZWIgZm9udCcgYWN0aW9uIGlzIGRlcHJlY2F0ZWQgYW5kIG5vIGxvbmdlciBoYXMgYW55IGVmZmVjdCIpCiAgICB9LAogICAgU2V0RWZmZWN0KGEpIHsKICAgICAgICB0aGlzLkdldFdvcmxkSW5mbygpLlNldEJsZW5kTW9kZShhKTsKICAgICAgICB0aGlzLl9ydW50aW1lLlVwZGF0ZVJlbmRlcigpCiAgICB9LAogICAgVHlwZXdyaXRlckZpbmlzaCgpIHsKICAgICAgICB0aGlzLl9GaW5pc2hUeXBld3JpdGVyKCkKICAgIH0sCiAgICBTZXRMaW5lSGVpZ2h0KGEpIHsKICAgICAgICB0aGlzLl9TZXRMaW5lSGVpZ2h0KGEpCiAgICB9LAogICAgU2V0SEFsaWduKGEpIHsKICAgICAgICB0aGlzLl9TZXRIQWxpZ24oYSkKICAgIH0sCiAgICBTZXRWQWxpZ24oYSkgewogICAgICAgIHRoaXMuX1NldFZBbGlnbihhKQogICAgfSwKICAgIFNldFdyYXBwaW5nKGEpIHsKICAgICAgICB0aGlzLl9TZXRXcmFwQnlXb3JkKDAgPT09IGEpCiAgICB9Cn07CmNvbnN0IEMzJGpzY29tcCQxOTcgPSBzZWxmLkMzOwpDMyRqc2NvbXAkMTk3LlBsdWdpbnMuVGV4dC5FeHBzID0gewogICAgVGV4dCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdGV4dAogICAgfSwKICAgIFBsYWluVGV4dCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZW5hYmxlQkJjb2RlID8gQzMkanNjb21wJDE5Ny5CQlN0cmluZy5TdHJpcEFueVRhZ3ModGhpcy5fdGV4dCkgOiB0aGlzLl90ZXh0CiAgICB9LAogICAgRmFjZU5hbWUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2ZhY2VOYW1lCiAgICB9LAogICAgRmFjZVNpemUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3B0U2l6ZQogICAgfSwKICAgIFRleHRXaWR0aCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fR2V0VGV4dFdpZHRoKCkKICAgIH0sCiAgICBUZXh0SGVpZ2h0KCkgewogICAgICAgIHJldHVybiB0aGlzLl9HZXRUZXh0SGVpZ2h0KCkKICAgIH0sCiAgICBMaW5lSGVpZ2h0KCkgewogICAgICAgIHJldHVybiB0aGlzLl9saW5lSGVpZ2h0T2Zmc2V0CiAgICB9Cn07CiJ1c2Ugc3RyaWN0IjsKY29uc3QgQzMkanNjb21wJDE5OCA9IHNlbGYuQzM7CkMzJGpzY29tcCQxOTguUGx1Z2lucy5UZXh0Qm94ID0gY2xhc3MgZXh0ZW5kcyBDMyRqc2NvbXAkMTk4LlNES0RPTVBsdWdpbkJhc2UgewogICAgY29uc3RydWN0b3IoYSkgewogICAgICAgIHN1cGVyKGEsICJ0ZXh0LWlucHV0Iik7CiAgICAgICAgdGhpcy5BZGRFbGVtZW50TWVzc2FnZUhhbmRsZXIoImNsaWNrIiwgKGIsIGQpID0+IGIuX09uQ2xpY2soZCkpOwogICAgICAgIHRoaXMuQWRkRWxlbWVudE1lc3NhZ2VIYW5kbGVyKCJkYmxjbGljayIsIChiLCBkKSA9PiBiLl9PbkRvdWJsZUNsaWNrKGQpKTsKICAgICAgICB0aGlzLkFkZEVsZW1lbnRNZXNzYWdlSGFuZGxlcigiY2hhbmdlIiwgKGIsIGQpID0+IGIuX09uQ2hhbmdlKGQpKQogICAgfQogICAgUmVsZWFzZSgpIHsKICAgICAgICBzdXBlci5SZWxlYXNlKCkKICAgIH0KfTsKY29uc3QgQzMkanNjb21wJDE5OSA9IHNlbGYuQzM7CkMzJGpzY29tcCQxOTkuUGx1Z2lucy5UZXh0Qm94LlR5cGUgPSBjbGFzcyBleHRlbmRzIEMzJGpzY29tcCQxOTkuU0RLVHlwZUJhc2UgewogICAgY29uc3RydWN0b3IoYSkgewogICAgICAgIHN1cGVyKGEpCiAgICB9CiAgICBSZWxlYXNlKCkgewogICAgICAgIHN1cGVyLlJlbGVhc2UoKQogICAgfQogICAgT25DcmVhdGUoKSB7fQp9Owpjb25zdCBDMyRqc2NvbXAkMjAwID0gc2VsZi5DMywKICAgIEMzWCRqc2NvbXAkMjEgPSBzZWxmLkMzWCwKICAgIGVsZW1UeXBlcyA9ICJ0ZXh0IHBhc3N3b3JkIGVtYWlsIG51bWJlciB0ZWwgdXJsIHRleHRhcmVhIHNlYXJjaCIuc3BsaXQoIiAiKTsKQzMkanNjb21wJDIwMC5QbHVnaW5zLlRleHRCb3guSW5zdGFuY2UgPSBjbGFzcyBleHRlbmRzIEMzJGpzY29tcCQyMDAuU0RLRE9NSW5zdGFuY2VCYXNlIHsKICAgIGNvbnN0cnVjdG9yKGEsIGIpIHsKICAgICAgICBzdXBlcihhLCAidGV4dC1pbnB1dCIpOwogICAgICAgIHRoaXMuX3RpdGxlID0gdGhpcy5fcGxhY2Vob2xkZXIgPSB0aGlzLl90ZXh0ID0gIiI7CiAgICAgICAgdGhpcy5faXNFbmFibGVkID0gITA7CiAgICAgICAgdGhpcy5fc3BlbGxDaGVjayA9IHRoaXMuX2lzUmVhZE9ubHkgPSAhMTsKICAgICAgICB0aGlzLl90eXBlID0gInRleHQiOwogICAgICAgIHRoaXMuX2F1dG9Gb250U2l6ZSA9ICEwOwogICAgICAgIHRoaXMuX21heExlbmd0aCA9IC0xOwogICAgICAgIHRoaXMuX2NsYXNzTmFtZSA9IHRoaXMuX2lkID0gIiI7CiAgICAgICAgYiAmJiAodGhpcy5fdGV4dCA9IGJbMF0sIHRoaXMuX3BsYWNlaG9sZGVyID0gYlsxXSwgdGhpcy5fdGl0bGUgPSBiWzJdLCB0aGlzLkdldFdvcmxkSW5mbygpLlNldFZpc2libGUoYlszXSksIHRoaXMuX2lzRW5hYmxlZCA9IGJbNF0sIHRoaXMuX2lzUmVhZE9ubHkgPSBiWzVdLCB0aGlzLl9zcGVsbENoZWNrID0gYls2XSwgdGhpcy5fdHlwZSA9IGVsZW1UeXBlc1tiWzddXSwKICAgICAgICAgICAgdGhpcy5fYXV0b0ZvbnRTaXplID0gYls4XSwgdGhpcy5faWQgPSBiWzldLCB0aGlzLl9jbGFzc05hbWUgPSBiWzEwXSk7CiAgICAgICAgdGhpcy5DcmVhdGVFbGVtZW50KHsKICAgICAgICAgICAgdHlwZTogdGhpcy5fdHlwZSwKICAgICAgICAgICAgaWQ6IHRoaXMuX2lkLAogICAgICAgICAgICBjbGFzc05hbWU6IHRoaXMuX2NsYXNzTmFtZQogICAgICAgIH0pCiAgICB9CiAgICBSZWxlYXNlKCkgewogICAgICAgIHN1cGVyLlJlbGVhc2UoKQogICAgfQogICAgR2V0RWxlbWVudFN0YXRlKCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHRleHQ6IHRoaXMuX3RleHQsCiAgICAgICAgICAgIHBsYWNlaG9sZGVyOiB0aGlzLl9wbGFjZWhvbGRlciwKICAgICAgICAgICAgdGl0bGU6IHRoaXMuX3RpdGxlLAogICAgICAgICAgICBpc0VuYWJsZWQ6IHRoaXMuX2lzRW5hYmxlZCwKICAgICAgICAgICAgaXNSZWFkT25seTogdGhpcy5faXNSZWFkT25seSwKICAgICAgICAgICAgc3BlbGxDaGVjazogdGhpcy5fc3BlbGxDaGVjaywKICAgICAgICAgICAgbWF4TGVuZ3RoOiB0aGlzLl9tYXhMZW5ndGgKICAgICAgICB9CiAgICB9CiAgICBhc3luYyBfT25DbGljayhhKSB7CiAgICAgICAgdGhpcy5EaXNwYXRjaFNjcmlwdEV2ZW50KCJjbGljayIsICEwKTsKICAgICAgICBhd2FpdCB0aGlzLlRyaWdnZXJBc3luYyhDMyRqc2NvbXAkMjAwLlBsdWdpbnMuVGV4dEJveC5DbmRzLk9uQ2xpY2tlZCkKICAgIH0KICAgIGFzeW5jIF9PbkRvdWJsZUNsaWNrKGEpIHsKICAgICAgICB0aGlzLkRpc3BhdGNoU2NyaXB0RXZlbnQoImRibGNsaWNrIiwgITApOwogICAgICAgIGF3YWl0IHRoaXMuVHJpZ2dlckFzeW5jKEMzJGpzY29tcCQyMDAuUGx1Z2lucy5UZXh0Qm94LkNuZHMuT25Eb3VibGVDbGlja2VkKQogICAgfQogICAgYXN5bmMgX09uQ2hhbmdlKGEpIHsKICAgICAgICB0aGlzLl90ZXh0ID0gYS50ZXh0OwogICAgICAgIHRoaXMuRGlzcGF0Y2hTY3JpcHRFdmVudCgiY2hhbmdlIiwgITApOwogICAgICAgIGF3YWl0IHRoaXMuVHJpZ2dlckFzeW5jKEMzJGpzY29tcCQyMDAuUGx1Z2lucy5UZXh0Qm94LkNuZHMuT25UZXh0Q2hhbmdlZCkKICAgIH0KICAgIF9TZXRUZXh0KGEpIHsKICAgICAgICB0aGlzLl90ZXh0ICE9PSBhICYmICh0aGlzLl90ZXh0ID0gYSwgdGhpcy5VcGRhdGVFbGVtZW50U3RhdGUoKSkKICAgIH0KICAgIF9HZXRUZXh0KCkgewogICAgICAgIHJldHVybiB0aGlzLl90ZXh0CiAgICB9CiAgICBfU2V0UGxhY2Vob2xkZXIoYSkgewogICAgICAgIHRoaXMuX3BsYWNlaG9sZGVyICE9PSBhICYmICh0aGlzLl9wbGFjZWhvbGRlciA9IGEsIHRoaXMuVXBkYXRlRWxlbWVudFN0YXRlKCkpCiAgICB9CiAgICBfR2V0UGxhY2Vob2xkZXIoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3BsYWNlaG9sZGVyCiAgICB9CiAgICBfU2V0VG9vbHRpcChhKSB7CiAgICAgICAgdGhpcy5fdGl0bGUgIT09IGEgJiYgKHRoaXMuX3RpdGxlID0KICAgICAgICAgICAgYSwgdGhpcy5VcGRhdGVFbGVtZW50U3RhdGUoKSkKICAgIH0KICAgIF9HZXRUb29sdGlwKCkgewogICAgICAgIHJldHVybiB0aGlzLl90aXRsZQogICAgfQogICAgX1NldEVuYWJsZWQoYSkgewogICAgICAgIGEgPSAhIWE7CiAgICAgICAgdGhpcy5faXNFbmFibGVkICE9PSBhICYmICh0aGlzLl9pc0VuYWJsZWQgPSBhLCB0aGlzLlVwZGF0ZUVsZW1lbnRTdGF0ZSgpKQogICAgfQogICAgX0lzRW5hYmxlZCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5faXNFbmFibGVkCiAgICB9CiAgICBfU2V0UmVhZE9ubHkoYSkgewogICAgICAgIGEgPSAhIWE7CiAgICAgICAgdGhpcy5faXNSZWFkT25seSAhPT0gYSAmJiAodGhpcy5faXNSZWFkT25seSA9IGEsIHRoaXMuVXBkYXRlRWxlbWVudFN0YXRlKCkpCiAgICB9CiAgICBfSXNSZWFkT25seSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5faXNSZWFkT25seQogICAgfQogICAgX1NldE1heExlbmd0aChhKSB7CiAgICAgICAgYSA9IE1hdGgubWF4KCthLCAtMSk7CiAgICAgICAgdGhpcy5fbWF4TGVuZ3RoICE9PSBhICYmICh0aGlzLl9tYXhMZW5ndGggPSBhLCB0aGlzLlVwZGF0ZUVsZW1lbnRTdGF0ZSgpKQogICAgfQogICAgX0dldE1heExlbmd0aCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fbWF4TGVuZ3RoCiAgICB9CiAgICBfU2Nyb2xsVG9Cb3R0b20oKSB7CiAgICAgICAgUHJvbWlzZS5yZXNvbHZlKCkudGhlbigoKSA9PgogICAgICAgICAgICB0aGlzLlBvc3RUb0RPTUVsZW1lbnQoInNjcm9sbC10by1ib3R0b20iKSkKICAgIH0KICAgIERyYXcoYSkge30KICAgIFNhdmVUb0pzb24oKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgdDogdGhpcy5fdGV4dCwKICAgICAgICAgICAgcDogdGhpcy5fcGxhY2Vob2xkZXIsCiAgICAgICAgICAgIHRpOiB0aGlzLl90aXRsZSwKICAgICAgICAgICAgZTogdGhpcy5faXNFbmFibGVkLAogICAgICAgICAgICByOiB0aGlzLl9pc1JlYWRPbmx5LAogICAgICAgICAgICBzcDogdGhpcy5fc3BlbGxDaGVjaywKICAgICAgICAgICAgbWw6IHRoaXMuX21heExlbmd0aCwKICAgICAgICAgICAgdHlwZTogdGhpcy5fdHlwZSwKICAgICAgICAgICAgaWQ6IHRoaXMuX2lkCiAgICAgICAgfQogICAgfQogICAgTG9hZEZyb21Kc29uKGEpIHsKICAgICAgICB0aGlzLl90ZXh0ID0gYS50OwogICAgICAgIHRoaXMuX3BsYWNlaG9sZGVyID0gYS5wOwogICAgICAgIHRoaXMuX3RpdGxlID0gYS50aTsKICAgICAgICB0aGlzLl9pc0VuYWJsZWQgPSBhLmU7CiAgICAgICAgdGhpcy5faXNSZWFkT25seSA9IGEucjsKICAgICAgICB0aGlzLl9zcGVsbENoZWNrID0gYS5zcDsKICAgICAgICB0aGlzLl9tYXhMZW5ndGggPSBhLmhhc093blByb3BlcnR5KCJtbCIpID8gYS5tbCA6IC0xOwogICAgICAgIHRoaXMuX3R5cGUgPSBhLnR5cGU7CiAgICAgICAgdGhpcy5faWQgPSBhLmlkOwogICAgICAgIHRoaXMuVXBkYXRlRWxlbWVudFN0YXRlKCkKICAgIH0KICAgIEdldFByb3BlcnR5VmFsdWVCeUluZGV4KGEpIHsKICAgICAgICBzd2l0Y2ggKGEpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RleHQ7CiAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9wbGFjZWhvbGRlcjsKICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RpdGxlOwogICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5faXNFbmFibGVkOwogICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5faXNSZWFkT25seTsKICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NwZWxsQ2hlY2s7CiAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9hdXRvRm9udFNpemUKICAgICAgICB9CiAgICB9CiAgICBTZXRQcm9wZXJ0eVZhbHVlQnlJbmRleChhLCBiKSB7CiAgICAgICAgc3dpdGNoIChhKSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGlmICh0aGlzLl90ZXh0ID09PSBiKSBicmVhazsKICAgICAgICAgICAgICAgIHRoaXMuX3RleHQgPSBiOwogICAgICAgICAgICAgICAgdGhpcy5VcGRhdGVFbGVtZW50U3RhdGUoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fcGxhY2Vob2xkZXIgPT09IGIpIGJyZWFrOwogICAgICAgICAgICAgICAgdGhpcy5fcGxhY2Vob2xkZXIgPSBiOwogICAgICAgICAgICAgICAgdGhpcy5VcGRhdGVFbGVtZW50U3RhdGUoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fdGl0bGUgPT09IGIpIGJyZWFrOwogICAgICAgICAgICAgICAgdGhpcy5fdGl0bGUgPSBiOwogICAgICAgICAgICAgICAgdGhpcy5VcGRhdGVFbGVtZW50U3RhdGUoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICBpZiAodGhpcy5faXNFbmFibGVkID09PSAhIWIpIGJyZWFrOwogICAgICAgICAgICAgICAgdGhpcy5faXNFbmFibGVkID0gISFiOwogICAgICAgICAgICAgICAgdGhpcy5VcGRhdGVFbGVtZW50U3RhdGUoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICBpZiAodGhpcy5faXNSZWFkT25seSA9PT0gISFiKSBicmVhazsKICAgICAgICAgICAgICAgIHRoaXMuX2lzUmVhZE9ubHkgPSAhIWI7CiAgICAgICAgICAgICAgICB0aGlzLlVwZGF0ZUVsZW1lbnRTdGF0ZSgpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9zcGVsbENoZWNrID09PSAhIWIpIGJyZWFrOwogICAgICAgICAgICAgICAgdGhpcy5fc3BlbGxDaGVjayA9ICEhYjsKICAgICAgICAgICAgICAgIHRoaXMuVXBkYXRlRWxlbWVudFN0YXRlKCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICAgICAgdGhpcy5fYXV0b0ZvbnRTaXplID0gISFiCiAgICAgICAgfQogICAgfQogICAgR2V0RGVidWdnZXJQcm9wZXJ0aWVzKCkgewogICAgICAgIGNvbnN0IGEgPSBDMyRqc2NvbXAkMjAwLlBsdWdpbnMuVGV4dEJveC5BY3RzOwogICAgICAgIHJldHVybiBbewogICAgICAgICAgICB0aXRsZTogInBsdWdpbnMudGV4dGJveC5uYW1lIiwKICAgICAgICAgICAgcHJvcGVydGllczogW3sKICAgICAgICAgICAgICAgIG5hbWU6ICJwbHVnaW5zLnRleHRib3gucHJvcGVydGllcy50ZXh0Lm5hbWUiLAogICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuX3RleHQsCiAgICAgICAgICAgICAgICBvbmVkaXQ6IGIgPT4gdGhpcy5DYWxsQWN0aW9uKGEuU2V0VGV4dCwgYikKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgbmFtZTogInBsdWdpbnMudGV4dGJveC5wcm9wZXJ0aWVzLmVuYWJsZWQubmFtZSIsCiAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5faXNFbmFibGVkLAogICAgICAgICAgICAgICAgb25lZGl0OiBiID0+IHRoaXMuQ2FsbEFjdGlvbihhLlNldEVuYWJsZWQsIGIpCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgIG5hbWU6ICJwbHVnaW5zLnRleHRib3gucHJvcGVydGllcy5yZWFkLW9ubHkubmFtZSIsCiAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5faXNSZWFkT25seSwKICAgICAgICAgICAgICAgIG9uZWRpdDogYiA9PiB0aGlzLkNhbGxBY3Rpb24oYS5TZXRSZWFkT25seSwgYikKICAgICAgICAgICAgfV0KICAgICAgICB9XQogICAgfQogICAgR2V0U2NyaXB0SW50ZXJmYWNlQ2xhc3MoKSB7CiAgICAgICAgcmV0dXJuIHNlbGYuSVRleHRJbnB1dEluc3RhbmNlCiAgICB9Cn07CmNvbnN0IG1hcCRqc2NvbXAkMjIgPSBuZXcgV2Vha01hcDsKc2VsZi5JVGV4dElucHV0SW5zdGFuY2UgPSBjbGFzcyBleHRlbmRzIHNlbGYuSURPTUluc3RhbmNlIHsKICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgIHN1cGVyKCk7CiAgICAgICAgbWFwJGpzY29tcCQyMi5zZXQodGhpcywgc2VsZi5JSW5zdGFuY2UuX0dldEluaXRJbnN0KCkuR2V0U2RrSW5zdGFuY2UoKSkKICAgIH0KICAgIHNldCB0ZXh0KGEpIHsKICAgICAgICBDM1gkanNjb21wJDIxLlJlcXVpcmVTdHJpbmcoYSk7CiAgICAgICAgbWFwJGpzY29tcCQyMi5nZXQodGhpcykuX1NldFRleHQoYSkKICAgIH0KICAgIGdldCB0ZXh0KCkgewogICAgICAgIHJldHVybiBtYXAkanNjb21wJDIyLmdldCh0aGlzKS5fR2V0VGV4dCgpCiAgICB9CiAgICBzZXQgcGxhY2Vob2xkZXIoYSkgewogICAgICAgIEMzWCRqc2NvbXAkMjEuUmVxdWlyZVN0cmluZyhhKTsKICAgICAgICBtYXAkanNjb21wJDIyLmdldCh0aGlzKS5fU2V0UGxhY2Vob2xkZXIoYSkKICAgIH0KICAgIGdldCBwbGFjZWhvbGRlcigpIHsKICAgICAgICByZXR1cm4gbWFwJGpzY29tcCQyMi5nZXQodGhpcykuX0dldFBsYWNlaG9sZGVyKCkKICAgIH0KICAgIHNldCB0b29sdGlwKGEpIHsKICAgICAgICBDM1gkanNjb21wJDIxLlJlcXVpcmVTdHJpbmcoYSk7CiAgICAgICAgbWFwJGpzY29tcCQyMi5nZXQodGhpcykuX1NldFRvb2x0aXAoYSkKICAgIH0KICAgIGdldCB0b29sdGlwKCkgewogICAgICAgIHJldHVybiBtYXAkanNjb21wJDIyLmdldCh0aGlzKS5fR2V0VG9vbHRpcCgpCiAgICB9CiAgICBzZXQgaXNFbmFibGVkKGEpIHsKICAgICAgICBtYXAkanNjb21wJDIyLmdldCh0aGlzKS5fU2V0RW5hYmxlZChhKQogICAgfQogICAgZ2V0IGlzRW5hYmxlZCgpIHsKICAgICAgICByZXR1cm4gbWFwJGpzY29tcCQyMi5nZXQodGhpcykuX0lzRW5hYmxlZCgpCiAgICB9CiAgICBzZXQgaXNSZWFkT25seShhKSB7CiAgICAgICAgbWFwJGpzY29tcCQyMi5nZXQodGhpcykuX1NldFJlYWRPbmx5KGEpCiAgICB9CiAgICBnZXQgaXNSZWFkT25seSgpIHsKICAgICAgICByZXR1cm4gbWFwJGpzY29tcCQyMi5nZXQodGhpcykuX0lzUmVhZE9ubHkoKQogICAgfQogICAgc2V0IG1heExlbmd0aChhKSB7CiAgICAgICAgQzNYJGpzY29tcCQyMS5SZXF1aXJlRmluaXRlTnVtYmVyKGEpOwogICAgICAgIG1hcCRqc2NvbXAkMjIuZ2V0KHRoaXMpLl9TZXRNYXhMZW5ndGgoYSkKICAgIH0KICAgIGdldCBtYXhMZW5ndGgoKSB7CiAgICAgICAgcmV0dXJuIG1hcCRqc2NvbXAkMjIuZ2V0KHRoaXMpLl9HZXRNYXhMZW5ndGgoKQogICAgfQogICAgc2Nyb2xsVG9Cb3R0b20oKSB7CiAgICAgICAgbWFwJGpzY29tcCQyMi5nZXQodGhpcykuX1Njcm9sbFRvQm90dG9tKCkKICAgIH0KfTsKY29uc3QgQzMkanNjb21wJDIwMSA9IHNlbGYuQzM7CkMzJGpzY29tcCQyMDEuUGx1Z2lucy5UZXh0Qm94LkNuZHMgPSB7CiAgICBDb21wYXJlVGV4dChhLCBiKSB7CiAgICAgICAgcmV0dXJuIDAgPT09IGIgPyBDMyRqc2NvbXAkMjAxLmVxdWFsc05vQ2FzZSh0aGlzLl90ZXh0LCBhKSA6IHRoaXMuX3RleHQgPT09IGEKICAgIH0sCiAgICBPblRleHRDaGFuZ2VkKCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIE9uQ2xpY2tlZCgpIHsKICAgICAgICByZXR1cm4gITAKICAgIH0sCiAgICBPbkRvdWJsZUNsaWNrZWQoKSB7CiAgICAgICAgcmV0dXJuICEwCiAgICB9Cn07CnNlbGYuQzMuUGx1Z2lucy5UZXh0Qm94LkFjdHMgPSB7CiAgICBTZXRUZXh0KGEpIHsKICAgICAgICB0aGlzLl9TZXRUZXh0KGEudG9TdHJpbmcoKSkKICAgIH0sCiAgICBBcHBlbmRUZXh0KGEpIHsKICAgICAgICAiIiAhPT0gYSAmJiB0aGlzLl9TZXRUZXh0KHRoaXMuX0dldFRleHQoKSArIGEpCiAgICB9LAogICAgU2V0UGxhY2Vob2xkZXIoYSkgewogICAgICAgIHRoaXMuX1NldFBsYWNlaG9sZGVyKGEpCiAgICB9LAogICAgU2V0VG9vbHRpcChhKSB7CiAgICAgICAgdGhpcy5fU2V0VG9vbHRpcChhKQogICAgfSwKICAgIFNldFJlYWRPbmx5KGEpIHsKICAgICAgICB0aGlzLl9TZXRSZWFkT25seSgwID09PSBhKQogICAgfSwKICAgIFNjcm9sbFRvQm90dG9tKCkgewogICAgICAgIHRoaXMuX1Njcm9sbFRvQm90dG9tKCkKICAgIH0sCiAgICBTZXRNYXhMZW5ndGgoYSkgewogICAgICAgIHRoaXMuX1NldE1heExlbmd0aChhKQogICAgfQp9OwpzZWxmLkMzLlBsdWdpbnMuVGV4dEJveC5FeHBzID0gewogICAgVGV4dCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fR2V0VGV4dCgpCiAgICB9LAogICAgTWF4TGVuZ3RoKCkgewogICAgICAgIHJldHVybiB0aGlzLl9HZXRNYXhMZW5ndGgoKQogICAgfQp9OwoidXNlIHN0cmljdCI7CmNvbnN0IEMzJGpzY29tcCQyMDQgPSBzZWxmLkMzOwpDMyRqc2NvbXAkMjA0LlBsdWdpbnMuQXJyID0gY2xhc3MgZXh0ZW5kcyBDMyRqc2NvbXAkMjA0LlNES1BsdWdpbkJhc2UgewogICAgY29uc3RydWN0b3IoYSkgewogICAgICAgIHN1cGVyKGEpCiAgICB9CiAgICBSZWxlYXNlKCkgewogICAgICAgIHN1cGVyLlJlbGVhc2UoKQogICAgfQp9Owpjb25zdCBDMyRqc2NvbXAkMjA1ID0gc2VsZi5DMzsKQzMkanNjb21wJDIwNS5QbHVnaW5zLkFyci5UeXBlID0gY2xhc3MgZXh0ZW5kcyBDMyRqc2NvbXAkMjA1LlNES1R5cGVCYXNlIHsKICAgIGNvbnN0cnVjdG9yKGEpIHsKICAgICAgICBzdXBlcihhKQogICAgfQogICAgUmVsZWFzZSgpIHsKICAgICAgICBzdXBlci5SZWxlYXNlKCkKICAgIH0KICAgIE9uQ3JlYXRlKCkge30KfTsKY29uc3QgQzMkanNjb21wJDIwNiA9IHNlbGYuQzMsCiAgICBDM1gkanNjb21wJDIyID0gc2VsZi5DM1gsCiAgICBJSW5zdGFuY2UkanNjb21wJDMgPSBzZWxmLklJbnN0YW5jZTsKCmZ1bmN0aW9uIFJlc2l6ZUFycmF5KGEsIGIsIGQpIHsKICAgIGlmIChiIDwgYS5sZW5ndGgpIEMzJGpzY29tcCQyMDYudHJ1bmNhdGVBcnJheShhLCBiKTsKICAgIGVsc2UgaWYgKGIgPiBhLmxlbmd0aCkKICAgICAgICBpZiAoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGQpCiAgICAgICAgICAgIGZvciAodmFyIGMgPSBhLmxlbmd0aDsgYyA8IGI7ICsrYykgYS5wdXNoKGQoKSk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBmb3IgKGMgPSBhLmxlbmd0aDsgYyA8IGI7ICsrYykgYS5wdXNoKGQpCn0KQzMkanNjb21wJDIwNi5QbHVnaW5zLkFyci5JbnN0YW5jZSA9IGNsYXNzIGV4dGVuZHMgQzMkanNjb21wJDIwNi5TREtJbnN0YW5jZUJhc2UgewogICAgY29uc3RydWN0b3IoYSwgYikgewogICAgICAgIHN1cGVyKGEpOwogICAgICAgIHRoaXMuX2N4ID0gMTA7CiAgICAgICAgdGhpcy5fY3ogPSB0aGlzLl9jeSA9IDE7CiAgICAgICAgdGhpcy5fYXJyID0gbnVsbDsKICAgICAgICB0aGlzLl9mb3JYID0gW107CiAgICAgICAgdGhpcy5fZm9yWSA9IFtdOwogICAgICAgIHRoaXMuX2ZvclogPSBbXTsKICAgICAgICB0aGlzLl9mb3JEZXB0aCA9IC0xOwogICAgICAgIGIgJiYgKHRoaXMuX2N4ID0gYlswXSwgdGhpcy5fY3kgPSBiWzFdLCB0aGlzLl9jeiA9IGJbMl0pOwogICAgICAgIHRoaXMuX2FyciA9IEMzJGpzY29tcCQyMDYuTWFrZUZpbGxlZEFycmF5KHRoaXMuX2N4LCAoKSA9PiBDMyRqc2NvbXAkMjA2Lk1ha2VGaWxsZWRBcnJheSh0aGlzLl9jeSwgKCkgPT4gQzMkanNjb21wJDIwNi5NYWtlRmlsbGVkQXJyYXkodGhpcy5fY3osIDApKSkKICAgIH0KICAgIFJlbGVhc2UoKSB7CiAgICAgICAgdGhpcy5fYXJyID0gbnVsbDsKICAgICAgICBzdXBlci5SZWxlYXNlKCkKICAgIH0KICAgIEF0KGEsIGIsIGQpIHsKICAgICAgICBhID0gTWF0aC5mbG9vcihhKTsKICAgICAgICBiID0gTWF0aC5mbG9vcihiKTsKICAgICAgICBkID0gTWF0aC5mbG9vcihkKTsKICAgICAgICByZXR1cm4gMCA8PQogICAgICAgICAgICBhICYmIGEgPCB0aGlzLl9jeCAmJiAwIDw9IGIgJiYgYiA8IHRoaXMuX2N5ICYmIDAgPD0gZCAmJiBkIDwgdGhpcy5fY3ogPyB0aGlzLl9hcnJbYV1bYl1bZF0gOiAwCiAgICB9CiAgICBTZXQoYSwgYiwgZCwgYykgewogICAgICAgIGEgPSBNYXRoLmZsb29yKGEpOwogICAgICAgIGIgPSBNYXRoLmZsb29yKGIpOwogICAgICAgIGQgPSBNYXRoLmZsb29yKGQpOwogICAgICAgIDAgPD0gYSAmJiBhIDwgdGhpcy5fY3ggJiYgMCA8PSBiICYmIGIgPCB0aGlzLl9jeSAmJiAwIDw9IGQgJiYgZCA8IHRoaXMuX2N6ICYmICh0aGlzLl9hcnJbYV1bYl1bZF0gPSBjKQogICAgfQogICAgU2V0U2l6ZShhLCBiLCBkKSB7CiAgICAgICAgYSA9IE1hdGguZmxvb3IoYSk7CiAgICAgICAgYiA9IE1hdGguZmxvb3IoYik7CiAgICAgICAgZCA9IE1hdGguZmxvb3IoZCk7CiAgICAgICAgMCA+IGEgJiYgKGEgPSAwKTsKICAgICAgICAwID4gYiAmJiAoYiA9IDApOwogICAgICAgIDAgPiBkICYmIChkID0gMCk7CiAgICAgICAgaWYgKHRoaXMuX2N4ICE9PSBhIHx8IHRoaXMuX2N5ICE9PSBiIHx8IHRoaXMuX2N6ICE9PSBkKSB7CiAgICAgICAgICAgIHRoaXMuX2N4ID0gYTsKICAgICAgICAgICAgdGhpcy5fY3kgPSBiOwogICAgICAgICAgICB0aGlzLl9jeiA9IGQ7CiAgICAgICAgICAgIHZhciBjID0gdGhpcy5fYXJyOwogICAgICAgICAgICBSZXNpemVBcnJheShjLCBhLCAoKSA9PiBDMyRqc2NvbXAkMjA2Lk1ha2VGaWxsZWRBcnJheShiLCAoKSA9PiBDMyRqc2NvbXAkMjA2Lk1ha2VGaWxsZWRBcnJheShkLCAwKSkpOwogICAgICAgICAgICBmb3IgKGxldCBlID0KICAgICAgICAgICAgICAgICAgICAwOyBlIDwgYTsgKytlKSB7CiAgICAgICAgICAgICAgICBSZXNpemVBcnJheShjW2VdLCBiLCAoKSA9PiBDMyRqc2NvbXAkMjA2Lk1ha2VGaWxsZWRBcnJheShkLCAwKSk7CiAgICAgICAgICAgICAgICBmb3IgKGxldCBnID0gMDsgZyA8IGI7ICsrZykgUmVzaXplQXJyYXkoY1tlXVtnXSwgZCwgMCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIEdldFdpZHRoKCkgewogICAgICAgIHJldHVybiB0aGlzLl9jeAogICAgfQogICAgR2V0SGVpZ2h0KCkgewogICAgICAgIHJldHVybiB0aGlzLl9jeQogICAgfQogICAgR2V0RGVwdGgoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2N6CiAgICB9CiAgICBHZXREZWJ1Z2dlclByb3BlcnRpZXMoKSB7CiAgICAgICAgY29uc3QgYSA9IFt7CiAgICAgICAgICAgICAgICB0aXRsZTogInBsdWdpbnMuYXJyLmRlYnVnZ2VyLmFycmF5LXByb3BlcnRpZXMudGl0bGUiLAogICAgICAgICAgICAgICAgcHJvcGVydGllczogW3sKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogInBsdWdpbnMuYXJyLnByb3BlcnRpZXMud2lkdGgubmFtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLl9jeCwKICAgICAgICAgICAgICAgICAgICAgICAgb25lZGl0OiBkID0+IHRoaXMuU2V0U2l6ZShkLCB0aGlzLl9jeSwgdGhpcy5fY3opCiAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAicGx1Z2lucy5hcnIucHJvcGVydGllcy5oZWlnaHQubmFtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLl9jeSwKICAgICAgICAgICAgICAgICAgICAgICAgb25lZGl0OiBkID0+IHRoaXMuU2V0U2l6ZSh0aGlzLl9jeCwgZCwgdGhpcy5fY3opCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJwbHVnaW5zLmFyci5wcm9wZXJ0aWVzLmRlcHRoLm5hbWUiLAogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5fY3osCiAgICAgICAgICAgICAgICAgICAgICAgIG9uZWRpdDogZCA9PiB0aGlzLlNldFNpemUodGhpcy5fY3gsIHRoaXMuX2N5LCBkKQogICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogInBsdWdpbnMuYXJyLnByb3BlcnRpZXMuZWxlbWVudHMubmFtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLl9jeCAqIHRoaXMuX2N5ICogdGhpcy5fY3oKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgIH1dLAogICAgICAgICAgICBiID0gW107CiAgICAgICAgaWYgKDEgPT09IHRoaXMuX2N5ICYmIDEgPT09IHRoaXMuX2N6KQogICAgICAgICAgICBmb3IgKGxldCBkID0gMDsgZCA8IHRoaXMuX2N4OyArK2QpIGIucHVzaCh7CiAgICAgICAgICAgICAgICBuYW1lOiAiJCIgKyBkLAogICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuX2FycltkXVswXVswXSwKICAgICAgICAgICAgICAgIG9uZWRpdDogYyA9PiB0aGlzLl9hcnJbZF1bMF1bMF0gPSBjCiAgICAgICAgICAgIH0pOwogICAgICAgIGVsc2UKICAgICAgICAgICAgZm9yIChsZXQgZCA9IDA7IGQgPCB0aGlzLl9jeDsgKytkKSBiLnB1c2goewogICAgICAgICAgICAgICAgbmFtZTogIiQiICsgZCwKICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLl9hcnJbZF0udG9TdHJpbmcoKQogICAgICAgICAgICB9KTsKICAgICAgICBiLmxlbmd0aCAmJiBhLnB1c2goewogICAgICAgICAgICB0aXRsZTogInBsdWdpbnMuYXJyLmRlYnVnZ2VyLmFycmF5LWRhdGEudGl0bGUiLAogICAgICAgICAgICBwcm9wZXJ0aWVzOiBiCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIGEKICAgIH0KICAgIEdldEFzSnNvblN0cmluZygpIHsKICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoewogICAgICAgICAgICBjMmFycmF5OiAhMCwKICAgICAgICAgICAgc2l6ZTogW3RoaXMuX2N4LCB0aGlzLl9jeSwgdGhpcy5fY3pdLAogICAgICAgICAgICBkYXRhOiB0aGlzLl9hcnIKICAgICAgICB9KQogICAgfQogICAgU2F2ZVRvSnNvbigpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBzaXplOiBbdGhpcy5fY3gsIHRoaXMuX2N5LCB0aGlzLl9jel0sCiAgICAgICAgICAgIGRhdGE6IHRoaXMuX2FycgogICAgICAgIH0KICAgIH0KICAgIExvYWRGcm9tSnNvbihhKSB7CiAgICAgICAgY29uc3QgYiA9IGEuc2l6ZTsKICAgICAgICB0aGlzLl9jeCA9IGJbMF07CiAgICAgICAgdGhpcy5fY3kgPSBiWzFdOwogICAgICAgIHRoaXMuX2N6ID0gYlsyXTsKICAgICAgICB0aGlzLl9hcnIgPSBhLmRhdGEKICAgIH0KICAgIF9HZXRGb3JYKCkgewogICAgICAgIHJldHVybiAwIDw9IHRoaXMuX2ZvckRlcHRoICYmIHRoaXMuX2ZvckRlcHRoIDwgdGhpcy5fZm9yWC5sZW5ndGggPyB0aGlzLl9mb3JYW3RoaXMuX2ZvckRlcHRoXSA6IDAKICAgIH0KICAgIF9HZXRGb3JZKCkgewogICAgICAgIHJldHVybiAwIDw9IHRoaXMuX2ZvckRlcHRoICYmIHRoaXMuX2ZvckRlcHRoIDwgdGhpcy5fZm9yWS5sZW5ndGggPyB0aGlzLl9mb3JZW3RoaXMuX2ZvckRlcHRoXSA6IDAKICAgIH0KICAgIF9HZXRGb3JaKCkgewogICAgICAgIHJldHVybiAwIDw9IHRoaXMuX2ZvckRlcHRoICYmIHRoaXMuX2ZvckRlcHRoIDwgdGhpcy5fZm9yWi5sZW5ndGggPyB0aGlzLl9mb3JaW3RoaXMuX2ZvckRlcHRoXSA6CiAgICAgICAgICAgIDAKICAgIH0KICAgIEdldFNjcmlwdEludGVyZmFjZUNsYXNzKCkgewogICAgICAgIHJldHVybiBzZWxmLklBcnJheUluc3RhbmNlCiAgICB9Cn07CmNvbnN0IG1hcCRqc2NvbXAkMjMgPSBuZXcgV2Vha01hcDsKc2VsZi5JQXJyYXlJbnN0YW5jZSA9IGNsYXNzIGV4dGVuZHMgSUluc3RhbmNlJGpzY29tcCQzIHsKICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgIHN1cGVyKCk7CiAgICAgICAgbWFwJGpzY29tcCQyMy5zZXQodGhpcywgSUluc3RhbmNlJGpzY29tcCQzLl9HZXRJbml0SW5zdCgpLkdldFNka0luc3RhbmNlKCkpCiAgICB9CiAgICBnZXQgd2lkdGgoKSB7CiAgICAgICAgcmV0dXJuIG1hcCRqc2NvbXAkMjMuZ2V0KHRoaXMpLkdldFdpZHRoKCkKICAgIH0KICAgIGdldCBoZWlnaHQoKSB7CiAgICAgICAgcmV0dXJuIG1hcCRqc2NvbXAkMjMuZ2V0KHRoaXMpLkdldEhlaWdodCgpCiAgICB9CiAgICBnZXQgZGVwdGgoKSB7CiAgICAgICAgcmV0dXJuIG1hcCRqc2NvbXAkMjMuZ2V0KHRoaXMpLkdldERlcHRoKCkKICAgIH0KICAgIHNldFNpemUoYSwgYiA9IDEsIGQgPSAxKSB7CiAgICAgICAgQzNYJGpzY29tcCQyMi5SZXF1aXJlRmluaXRlTnVtYmVyKGEpOwogICAgICAgIEMzWCRqc2NvbXAkMjIuUmVxdWlyZUZpbml0ZU51bWJlcihiKTsKICAgICAgICBDM1gkanNjb21wJDIyLlJlcXVpcmVGaW5pdGVOdW1iZXIoZCk7CiAgICAgICAgbWFwJGpzY29tcCQyMy5nZXQodGhpcykuU2V0U2l6ZShhLCBiLCBkKQogICAgfQogICAgZ2V0QXQoYSwgYiA9IDAsIGQgPSAwKSB7CiAgICAgICAgQzNYJGpzY29tcCQyMi5SZXF1aXJlRmluaXRlTnVtYmVyKGEpOwogICAgICAgIEMzWCRqc2NvbXAkMjIuUmVxdWlyZUZpbml0ZU51bWJlcihiKTsKICAgICAgICBDM1gkanNjb21wJDIyLlJlcXVpcmVGaW5pdGVOdW1iZXIoZCk7CiAgICAgICAgcmV0dXJuIG1hcCRqc2NvbXAkMjMuZ2V0KHRoaXMpLkF0KGEsIGIsIGQpCiAgICB9CiAgICBzZXRBdChhLCBiLCBkID0gMCwgYyA9IDApIHsKICAgICAgICBDM1gkanNjb21wJDIyLlJlcXVpcmVGaW5pdGVOdW1iZXIoYik7CiAgICAgICAgQzNYJGpzY29tcCQyMi5SZXF1aXJlRmluaXRlTnVtYmVyKGQpOwogICAgICAgIEMzWCRqc2NvbXAkMjIuUmVxdWlyZUZpbml0ZU51bWJlcihjKTsKICAgICAgICBpZiAoIm51bWJlciIgIT09IHR5cGVvZiBhICYmICJzdHJpbmciICE9PSB0eXBlb2YgYSkgdGhyb3cgbmV3IFR5cGVFcnJvcigiaW52YWxpZCB0eXBlIik7CiAgICAgICAgbWFwJGpzY29tcCQyMy5nZXQodGhpcykuU2V0KGIsIGQsIGMsIGEpCiAgICB9Cn07CmNvbnN0IEMzJGpzY29tcCQyMDcgPSBzZWxmLkMzOwoKZnVuY3Rpb24gRG9Gb3JFYWNoVHJpZ2dlcihhLCBiLCBkLCBjLCBlKSB7CiAgICBhLlB1c2hDb3B5U29sKGQpOwogICAgYi5SZXRyaWdnZXIoYywgZSk7CiAgICBhLlBvcFNvbChkKQp9CkMzJGpzY29tcCQyMDcuUGx1Z2lucy5BcnIuQ25kcyA9IHsKICAgIENvbXBhcmVYKGEsIGIsIGQpIHsKICAgICAgICByZXR1cm4gQzMkanNjb21wJDIwNy5jb21wYXJlKHRoaXMuQXQoYSwgMCwgMCksIGIsIGQpCiAgICB9LAogICAgQ29tcGFyZVhZKGEsIGIsIGQsIGMpIHsKICAgICAgICByZXR1cm4gQzMkanNjb21wJDIwNy5jb21wYXJlKHRoaXMuQXQoYSwgYiwgMCksIGQsIGMpCiAgICB9LAogICAgQ29tcGFyZVhZWihhLCBiLCBkLCBjLCBlKSB7CiAgICAgICAgcmV0dXJuIEMzJGpzY29tcCQyMDcuY29tcGFyZSh0aGlzLkF0KGEsIGIsIGQpLCBjLCBlKQogICAgfSwKICAgIEFyckZvckVhY2goYSkgewogICAgICAgIGNvbnN0IGIgPSB0aGlzLl9ydW50aW1lLAogICAgICAgICAgICBkID0gYi5HZXRFdmVudFNoZWV0TWFuYWdlcigpLAogICAgICAgICAgICBjID0gYi5HZXRDdXJyZW50RXZlbnQoKSwKICAgICAgICAgICAgZSA9IGMuR2V0U29sTW9kaWZpZXJzKCksCiAgICAgICAgICAgIGcgPSBiLkdldEV2ZW50U3RhY2soKSwKICAgICAgICAgICAgayA9IGcuR2V0Q3VycmVudFN0YWNrRnJhbWUoKSwKICAgICAgICAgICAgbSA9IGcuUHVzaChjKSwKICAgICAgICAgICAgbiA9ICsrdGhpcy5fZm9yRGVwdGgsCiAgICAgICAgICAgIHEgPSB0aGlzLl9mb3JYOwogICAgICAgIHZhciB1ID0gdGhpcy5fZm9yWSwKICAgICAgICAgICAgdyA9IHRoaXMuX2Zvclo7CiAgICAgICAgY29uc3QgeiA9IHRoaXMuX2N4LAogICAgICAgICAgICBDID0gdGhpcy5fY3k7CiAgICAgICAgdmFyIEQgPQogICAgICAgICAgICB0aGlzLl9jejsKICAgICAgICBuID09PSB0aGlzLl9mb3JYLmxlbmd0aCA/IChxLnB1c2goMCksIHUucHVzaCgwKSwgdy5wdXNoKDApKSA6IChxW25dID0gMCwgdVtuXSA9IDAsIHdbbl0gPSAwKTsKICAgICAgICBiLlNldERlYnVnZ2luZ0VuYWJsZWQoITEpOwogICAgICAgIGlmICgwID09PSBhKQogICAgICAgICAgICBmb3IgKGEgPSAwOyBhIDwgejsgKythKQogICAgICAgICAgICAgICAgZm9yIChsZXQgRiA9IDA7IEYgPCBDOyArK0YpCiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgRSA9IDA7IEUgPCBEOyArK0UpIHFbbl0gPSBhLCB1W25dID0gRiwgd1tuXSA9IEUsIERvRm9yRWFjaFRyaWdnZXIoZCwgYywgZSwgaywgbSk7CiAgICAgICAgZWxzZSBpZiAoMSA9PT0gYSkKICAgICAgICAgICAgZm9yICh3ID0gMDsgdyA8IHo7ICsrdykKICAgICAgICAgICAgICAgIGZvciAoRCA9IDA7IEQgPCBDOyArK0QpIHFbbl0gPSB3LCB1W25dID0gRCwgRG9Gb3JFYWNoVHJpZ2dlcihkLCBjLCBlLCBrLCBtKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIGZvciAodSA9IDA7IHUgPCB6OyArK3UpIHFbbl0gPSB1LCBEb0ZvckVhY2hUcmlnZ2VyKGQsIGMsIGUsIGssIG0pOwogICAgICAgIGIuU2V0RGVidWdnaW5nRW5hYmxlZCghMCk7CiAgICAgICAgdGhpcy5fZm9yRGVwdGgtLTsKICAgICAgICBnLlBvcCgpOwogICAgICAgIHJldHVybiAhMQogICAgfSwKICAgIENvbXBhcmVDdXJyZW50KGEsIGIpIHsKICAgICAgICByZXR1cm4gQzMkanNjb21wJDIwNy5jb21wYXJlKHRoaXMuQXQodGhpcy5fR2V0Rm9yWCgpLAogICAgICAgICAgICB0aGlzLl9HZXRGb3JZKCksIHRoaXMuX0dldEZvclooKSksIGEsIGIpCiAgICB9LAogICAgQ29udGFpbnMoYSkgewogICAgICAgIGNvbnN0IGIgPSB0aGlzLl9jeCwKICAgICAgICAgICAgZCA9IHRoaXMuX2N5LAogICAgICAgICAgICBjID0gdGhpcy5fY3osCiAgICAgICAgICAgIGUgPSB0aGlzLl9hcnI7CiAgICAgICAgZm9yIChsZXQgZyA9IDA7IGcgPCBiOyArK2cpCiAgICAgICAgICAgIGZvciAobGV0IGsgPSAwOyBrIDwgZDsgKytrKQogICAgICAgICAgICAgICAgZm9yIChsZXQgbSA9IDA7IG0gPCBjOyArK20pCiAgICAgICAgICAgICAgICAgICAgaWYgKGVbZ11ba11bbV0gPT09IGEpIHJldHVybiAhMDsKICAgICAgICByZXR1cm4gITEKICAgIH0sCiAgICBJc0VtcHR5KCkgewogICAgICAgIHJldHVybiAwID09PSB0aGlzLl9jeCB8fCAwID09PSB0aGlzLl9jeSB8fCAwID09PSB0aGlzLl9jegogICAgfSwKICAgIENvbXBhcmVTaXplKGEsIGIsIGQpIHsKICAgICAgICBsZXQgYyA9IDA7CiAgICAgICAgc3dpdGNoIChhKSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGMgPSB0aGlzLl9jeDsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICBjID0gdGhpcy5fY3k7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgYyA9IHRoaXMuX2N6CiAgICAgICAgfQogICAgICAgIHJldHVybiBDMyRqc2NvbXAkMjA3LmNvbXBhcmUoYywgYiwgZCkKICAgIH0KfTsKY29uc3QgQzMkanNjb21wJDIwOCA9IHNlbGYuQzM7CgpmdW5jdGlvbiBDb21wYXJlVmFsdWVzKGEsIGIpIHsKICAgIGlmICgibnVtYmVyIiA9PT0gdHlwZW9mIGEgJiYgIm51bWJlciIgPT09IHR5cGVvZiBiKSByZXR1cm4gYSAtIGI7CiAgICBhID0gYS50b1N0cmluZygpOwogICAgYiA9IGIudG9TdHJpbmcoKTsKICAgIHJldHVybiBhIDwgYiA/IC0xIDogYSA+IGIgPyAxIDogMAp9CkMzJGpzY29tcCQyMDguUGx1Z2lucy5BcnIuQWN0cyA9IHsKICAgIENsZWFyKGEpIHsKICAgICAgICBjb25zdCBiID0gdGhpcy5fY3gsCiAgICAgICAgICAgIGQgPSB0aGlzLl9jeSwKICAgICAgICAgICAgYyA9IHRoaXMuX2N6LAogICAgICAgICAgICBlID0gdGhpcy5fYXJyOwogICAgICAgIGZvciAobGV0IGcgPSAwOyBnIDwgYjsgKytnKQogICAgICAgICAgICBmb3IgKGxldCBrID0gMDsgayA8IGQ7ICsraykKICAgICAgICAgICAgICAgIGZvciAobGV0IG0gPSAwOyBtIDwgYzsgKyttKSBlW2ddW2tdW21dID0gYQogICAgfSwKICAgIFNldFNpemUoYSwgYiwgZCkgewogICAgICAgIHRoaXMuU2V0U2l6ZShhLCBiLCBkKQogICAgfSwKICAgIFNldFgoYSwgYikgewogICAgICAgIHRoaXMuU2V0KGEsIDAsIDAsIGIpCiAgICB9LAogICAgU2V0WFkoYSwgYiwgZCkgewogICAgICAgIHRoaXMuU2V0KGEsIGIsIDAsIGQpCiAgICB9LAogICAgU2V0WFlaKGEsIGIsIGQsIGMpIHsKICAgICAgICB0aGlzLlNldChhLCBiLCBkLCBjKQogICAgfSwKICAgIFB1c2goYSwgYiwgZCkgewogICAgICAgIHZhciBjID0gdGhpcy5fY3gsCiAgICAgICAgICAgIGUgPSB0aGlzLl9jeTsKICAgICAgICBjb25zdCBnID0gdGhpcy5fY3osCiAgICAgICAgICAgIGsgPSB0aGlzLl9hcnI7CiAgICAgICAgaWYgKDAgPT09IGQpIGMgPSBDMyRqc2NvbXAkMjA4Lk1ha2VGaWxsZWRBcnJheShlLCAoKSA9PiBDMyRqc2NvbXAkMjA4Lk1ha2VGaWxsZWRBcnJheShnLCBiKSksIDAgPT09IGEgPyBrLnB1c2goYykgOiBrLnVuc2hpZnQoYyksIHRoaXMuX2N4Kys7CiAgICAgICAgZWxzZSBpZiAoMSA9PT0gZCkgewogICAgICAgICAgICBmb3IgKGUgPQogICAgICAgICAgICAgICAgMDsgZSA8IGM7ICsrZSkgZCA9IEMzJGpzY29tcCQyMDguTWFrZUZpbGxlZEFycmF5KGcsIGIpLCAwID09PSBhID8ga1tlXS5wdXNoKGQpIDoga1tlXS51bnNoaWZ0KGQpOwogICAgICAgICAgICB0aGlzLl9jeSsrCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZm9yIChkID0gMDsgZCA8IGM7ICsrZCkKICAgICAgICAgICAgICAgIGZvciAobGV0IG0gPSAwOyBtIDwgZTsgKyttKSAwID09PSBhID8ga1tkXVttXS5wdXNoKGIpIDoga1tkXVttXS51bnNoaWZ0KGIpOwogICAgICAgICAgICB0aGlzLl9jeisrCiAgICAgICAgfQogICAgfSwKICAgIFBvcChhLCBiKSB7CiAgICAgICAgY29uc3QgZCA9IHRoaXMuX2N4OwogICAgICAgIHZhciBjID0gdGhpcy5fY3ksCiAgICAgICAgICAgIGUgPSB0aGlzLl9jejsKICAgICAgICBjb25zdCBnID0gdGhpcy5fYXJyOwogICAgICAgIGlmICgwID09PSBiKSAwICE9PSBkICYmICgwID09PSBhID8gZy5wb3AoKSA6IGcuc2hpZnQoKSwgdGhpcy5fY3gtLSk7CiAgICAgICAgZWxzZSBpZiAoMSA9PT0gYikgewogICAgICAgICAgICBpZiAoMCAhPT0gYykgewogICAgICAgICAgICAgICAgZm9yIChjID0gMDsgYyA8IGQ7ICsrYykgMCA9PT0gYSA/IGdbY10ucG9wKCkgOiBnW2NdLnNoaWZ0KCk7CiAgICAgICAgICAgICAgICB0aGlzLl9jeS0tCiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKDAgIT09IGUpIHsKICAgICAgICAgICAgZm9yIChiID0gMDsgYiA8IGQ7ICsrYikKICAgICAgICAgICAgICAgIGZvciAoZSA9IDA7IGUgPCBjOyArK2UpIDAgPT09IGEgPyBnW2JdW2VdLnBvcCgpIDogZ1tiXVtlXS5zaGlmdCgpOwogICAgICAgICAgICB0aGlzLl9jei0tCiAgICAgICAgfQogICAgfSwKICAgIFJldmVyc2UoYSkgewogICAgICAgIGNvbnN0IGIgPQogICAgICAgICAgICB0aGlzLl9jeDsKICAgICAgICB2YXIgZCA9IHRoaXMuX2N5LAogICAgICAgICAgICBjID0gdGhpcy5fY3o7CiAgICAgICAgY29uc3QgZSA9IHRoaXMuX2FycjsKICAgICAgICBpZiAoMCAhPT0gYiAmJiAwICE9PSBkICYmIDAgIT09IGMpCiAgICAgICAgICAgIGlmICgwID09PSBhKSBlLnJldmVyc2UoKTsKICAgICAgICAgICAgZWxzZSBpZiAoMSA9PT0gYSkKICAgICAgICAgICAgZm9yIChkID0gMDsgZCA8IGI7ICsrZCkgZVtkXS5yZXZlcnNlKCk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBmb3IgKGEgPSAwOyBhIDwgYjsgKythKQogICAgICAgICAgICAgICAgZm9yIChjID0gMDsgYyA8IGQ7ICsrYykgZVthXVtjXS5yZXZlcnNlKCkKICAgIH0sCiAgICBTb3J0KGEpIHsKICAgICAgICBjb25zdCBiID0gdGhpcy5fY3g7CiAgICAgICAgdmFyIGQgPSB0aGlzLl9jeSwKICAgICAgICAgICAgYyA9IHRoaXMuX2N6OwogICAgICAgIGNvbnN0IGUgPSB0aGlzLl9hcnI7CiAgICAgICAgaWYgKDAgIT09IGIgJiYgMCAhPT0gZCAmJiAwICE9PSBjKQogICAgICAgICAgICBpZiAoMCA9PT0gYSkgZS5zb3J0KChnLCBrKSA9PiBDb21wYXJlVmFsdWVzKGdbMF1bMF0sIGtbMF1bMF0pKTsKICAgICAgICAgICAgZWxzZSBpZiAoMSA9PT0gYSkKICAgICAgICAgICAgZm9yIChkID0gMDsgZCA8IGI7ICsrZCkgZVtkXS5zb3J0KChnLCBrKSA9PiBDb21wYXJlVmFsdWVzKGdbMF0sIGtbMF0pKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIGZvciAoYSA9IDA7IGEgPCBiOyArK2EpCiAgICAgICAgICAgICAgICBmb3IgKGMgPSAwOyBjIDwgZDsgKytjKSBlW2FdW2NdLnNvcnQoQ29tcGFyZVZhbHVlcykKICAgIH0sCiAgICBEZWxldGUoYSwgYikgewogICAgICAgIGEgPSBNYXRoLmZsb29yKGEpOwogICAgICAgIGlmICghKDAgPiBhKSkgewogICAgICAgICAgICB2YXIgZCA9IHRoaXMuX2N4LAogICAgICAgICAgICAgICAgYyA9IHRoaXMuX2N5LAogICAgICAgICAgICAgICAgZSA9IHRoaXMuX2N6LAogICAgICAgICAgICAgICAgZyA9IHRoaXMuX2FycjsKICAgICAgICAgICAgaWYgKDAgPT09IGIpIGEgPj0gZCB8fCAoZy5zcGxpY2UoYSwgMSksIHRoaXMuX2N4LS0pOwogICAgICAgICAgICBlbHNlIGlmICgxID09PSBiKSB7CiAgICAgICAgICAgICAgICBpZiAoIShhID49IGMpKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yIChjID0gMDsgYyA8IGQ7ICsrYykgZ1tjXS5zcGxpY2UoYSwgMSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY3ktLQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKCEoYSA+PSBlKSkgewogICAgICAgICAgICAgICAgZm9yIChiID0gMDsgYiA8IGQ7ICsrYikKICAgICAgICAgICAgICAgICAgICBmb3IgKGUgPSAwOyBlIDwgYzsgKytlKSBnW2JdW2VdLnNwbGljZShhLCAxKTsKICAgICAgICAgICAgICAgIHRoaXMuX2N6LS0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0sCiAgICBJbnNlcnQoYSwgYiwgZCkgewogICAgICAgIGIgPSBNYXRoLmZsb29yKGIpOwogICAgICAgIGlmICghKDAgPiBiKSkgewogICAgICAgICAgICB2YXIgYyA9IHRoaXMuX2N4LAogICAgICAgICAgICAgICAgZSA9IHRoaXMuX2N5LAogICAgICAgICAgICAgICAgZyA9IHRoaXMuX2N6LAogICAgICAgICAgICAgICAgayA9IHRoaXMuX2FycjsKICAgICAgICAgICAgaWYgKDAgPT09IGQpIGIgPiBjIHx8IChrLnNwbGljZShiLCAwLCBDMyRqc2NvbXAkMjA4Lk1ha2VGaWxsZWRBcnJheShlLCAoKSA9PiBDMyRqc2NvbXAkMjA4Lk1ha2VGaWxsZWRBcnJheShnLCBhKSkpLCB0aGlzLl9jeCsrKTsKICAgICAgICAgICAgZWxzZSBpZiAoMSA9PT0gZCkgewogICAgICAgICAgICAgICAgaWYgKCEoYiA+IGUpKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yIChlID0gMDsgZSA8IGM7ICsrZSkga1tlXS5zcGxpY2UoYiwKICAgICAgICAgICAgICAgICAgICAgICAgMCwgQzMkanNjb21wJDIwOC5NYWtlRmlsbGVkQXJyYXkoZywgYSkpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2N5KysKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmICghKGIgPiBnKSkgewogICAgICAgICAgICAgICAgZm9yIChkID0gMDsgZCA8IGM7ICsrZCkKICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBtID0gMDsgbSA8IGU7ICsrbSkga1tkXVttXS5zcGxpY2UoYiwgMCwgYSk7CiAgICAgICAgICAgICAgICB0aGlzLl9jeisrCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9LAogICAgSlNPTkxvYWQoYSkgewogICAgICAgIGxldCBiID0gbnVsbDsKICAgICAgICB0cnkgewogICAgICAgICAgICBiID0gSlNPTi5wYXJzZShhKQogICAgICAgIH0gY2F0Y2ggKGQpIHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcigiW0NvbnN0cnVjdF0gRmFpbGVkIHRvIHBhcnNlIEpTT046ICIsIGQpOwogICAgICAgICAgICByZXR1cm4KICAgICAgICB9CiAgICAgICAgYi5jMmFycmF5ICYmIChhID0gYi5zaXplLCB0aGlzLl9jeCA9IGFbMF0sIHRoaXMuX2N5ID0gYVsxXSwgdGhpcy5fY3ogPSBhWzJdLCB0aGlzLl9hcnIgPSBiLmRhdGEpCiAgICB9LAogICAgSlNPTkRvd25sb2FkKGEpIHsKICAgICAgICBjb25zdCBiID0gVVJMLmNyZWF0ZU9iamVjdFVSTChuZXcgQmxvYihbdGhpcy5HZXRBc0pzb25TdHJpbmcoKV0sIHsKICAgICAgICAgICAgdHlwZTogImFwcGxpY2F0aW9uL2pzb24iCiAgICAgICAgfSkpOwogICAgICAgIHRoaXMuX3J1bnRpbWUuSW52b2tlRG93bmxvYWQoYiwgYSkKICAgIH0KfTsKc2VsZi5DMy5QbHVnaW5zLkFyci5FeHBzID0gewogICAgQXQoYSwgYiwgZCkgewogICAgICAgIHJldHVybiB0aGlzLkF0KGEsIGIgfHwgMCwgZCB8fCAwKQogICAgfSwKICAgIFdpZHRoKCkgewogICAgICAgIHJldHVybiB0aGlzLl9jeAogICAgfSwKICAgIEhlaWdodCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fY3kKICAgIH0sCiAgICBEZXB0aCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fY3oKICAgIH0sCiAgICBDdXJYKCkgewogICAgICAgIHJldHVybiB0aGlzLl9HZXRGb3JYKCkKICAgIH0sCiAgICBDdXJZKCkgewogICAgICAgIHJldHVybiB0aGlzLl9HZXRGb3JZKCkKICAgIH0sCiAgICBDdXJaKCkgewogICAgICAgIHJldHVybiB0aGlzLl9HZXRGb3JaKCkKICAgIH0sCiAgICBDdXJWYWx1ZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5BdCh0aGlzLl9HZXRGb3JYKCksIHRoaXMuX0dldEZvclkoKSwgdGhpcy5fR2V0Rm9yWigpKQogICAgfSwKICAgIEZyb250KCkgewogICAgICAgIHJldHVybiB0aGlzLkF0KDAsIDAsIDApCiAgICB9LAogICAgQmFjaygpIHsKICAgICAgICByZXR1cm4gdGhpcy5BdCh0aGlzLl9jeCAtIDEsIDAsIDApCiAgICB9LAogICAgSW5kZXhPZihhKSB7CiAgICAgICAgY29uc3QgYiA9IHRoaXMuX2FycjsKICAgICAgICBmb3IgKGxldCBkID0gMCwgYyA9IHRoaXMuX2N4OyBkIDwgYzsgKytkKQogICAgICAgICAgICBpZiAoYltkXVswXVswXSA9PT0gYSkgcmV0dXJuIGQ7CiAgICAgICAgcmV0dXJuIC0xCiAgICB9LAogICAgTGFzdEluZGV4T2YoYSkgewogICAgICAgIGNvbnN0IGIgPSB0aGlzLl9hcnI7CiAgICAgICAgZm9yIChsZXQgZCA9IHRoaXMuX2N4IC0gMTsgMCA8PSBkOyAtLWQpCiAgICAgICAgICAgIGlmIChiW2RdWzBdWzBdID09PSBhKSByZXR1cm4gZDsKICAgICAgICByZXR1cm4gLTEKICAgIH0sCiAgICBBc0pTT04oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuR2V0QXNKc29uU3RyaW5nKCkKICAgIH0KfTsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkMjEwID0gc2VsZi5DMywKICAgIGFjdGlvblByb21pc2VzID0gW107CkMzJGpzY29tcCQyMTAuUGx1Z2lucy5BdWRpbyA9IGNsYXNzIGV4dGVuZHMgQzMkanNjb21wJDIxMC5TREtQbHVnaW5CYXNlIHsKICAgIGNvbnN0cnVjdG9yKGEpIHsKICAgICAgICBzdXBlcihhKQogICAgfQogICAgX0FkZEFjdGlvblByb21pc2UoYSkgewogICAgICAgIGFjdGlvblByb21pc2VzLnB1c2goYSkKICAgIH0KICAgIHN0YXRpYyBhc3luYyBXYWl0Rm9yQWxsQWN0aW9uUHJvbWlzZXMoKSB7CiAgICAgICAgYXdhaXQgUHJvbWlzZS5hbGwoYWN0aW9uUHJvbWlzZXMpOwogICAgICAgIEMzJGpzY29tcCQyMTAuY2xlYXJBcnJheShhY3Rpb25Qcm9taXNlcykKICAgIH0KICAgIFJlbGVhc2UoKSB7CiAgICAgICAgc3VwZXIuUmVsZWFzZSgpCiAgICB9Cn07CmNvbnN0IEMzJGpzY29tcCQyMTEgPSBzZWxmLkMzOwpDMyRqc2NvbXAkMjExLlBsdWdpbnMuQXVkaW8uVHlwZSA9IGNsYXNzIGV4dGVuZHMgQzMkanNjb21wJDIxMS5TREtUeXBlQmFzZSB7CiAgICBjb25zdHJ1Y3RvcihhKSB7CiAgICAgICAgc3VwZXIoYSkKICAgIH0KICAgIFJlbGVhc2UoKSB7CiAgICAgICAgc3VwZXIuUmVsZWFzZSgpCiAgICB9CiAgICBPbkNyZWF0ZSgpIHt9CiAgICBHZXRTY3JpcHRJbnRlcmZhY2VDbGFzcygpIHsKICAgICAgICByZXR1cm4gc2VsZi5JQXVkaW9PYmplY3RUeXBlCiAgICB9Cn07CgpmdW5jdGlvbiBHZXRBdWRpb0RPTUludGVyZmFjZSgpIHsKICAgIGlmIChzZWxmLkMzQXVkaW9fRE9NSW50ZXJmYWNlKSByZXR1cm4gc2VsZi5DM0F1ZGlvX0RPTUludGVyZmFjZTsKICAgIHRocm93IEVycm9yKCJhdWRpbyBzY3JpcHRpbmcgQVBJIGNhbm5vdCBiZSB1c2VkIGhlcmUgLSBtYWtlIHN1cmUgdGhlIHByb2plY3QgaXMgdXNpbmcgRE9NIG1vZGUsIG5vdCB3b3JrZXIgbW9kZSIpOwp9CnNlbGYuSUF1ZGlvT2JqZWN0VHlwZSA9IGNsYXNzIGV4dGVuZHMgc2VsZi5JT2JqZWN0Q2xhc3MgewogICAgY29uc3RydWN0b3IoYSkgewogICAgICAgIHN1cGVyKGEpCiAgICB9CiAgICBnZXQgYXVkaW9Db250ZXh0KCkgewogICAgICAgIHJldHVybiBHZXRBdWRpb0RPTUludGVyZmFjZSgpLkdldEF1ZGlvQ29udGV4dCgpCiAgICB9CiAgICBnZXQgZGVzdGluYXRpb25Ob2RlKCkgewogICAgICAgIHJldHVybiBHZXRBdWRpb0RPTUludGVyZmFjZSgpLkdldERlc3RpbmF0aW9uTm9kZSgpCiAgICB9Cn07CmNvbnN0IEMzJGpzY29tcCQyMTIgPSBzZWxmLkMzLAogICAgTEFURU5DWV9ISU5UUyA9IFsiaW50ZXJhY3RpdmUiLCAiYmFsYW5jZWQiLCAicGxheWJhY2siXTsKQzMkanNjb21wJDIxMi5QbHVnaW5zLkF1ZGlvLkluc3RhbmNlID0gY2xhc3MgZXh0ZW5kcyBDMyRqc2NvbXAkMjEyLlNES0luc3RhbmNlQmFzZSB7CiAgICBjb25zdHJ1Y3RvcihhLCBiKSB7CiAgICAgICAgc3VwZXIoYSwgImF1ZGlvIik7CiAgICAgICAgdGhpcy5fbmV4dFBsYXlUaW1lID0gMDsKICAgICAgICB0aGlzLl90cmlnZ2VyVGFnID0gIiI7CiAgICAgICAgdGhpcy5fc2F2ZUxvYWRNb2RlID0gdGhpcy5fdGltZVNjYWxlTW9kZSA9IDA7CiAgICAgICAgdGhpcy5fcGxheUluQmFja2dyb3VuZCA9ICExOwogICAgICAgIHRoaXMuX2Rpc3RhbmNlTW9kZWwgPSB0aGlzLl9wYW5uaW5nTW9kZWwgPSAxOwogICAgICAgIHRoaXMuX2xpc3RlbmVyWCA9IHRoaXMuX3J1bnRpbWUuR2V0Vmlld3BvcnRXaWR0aCgpIC8gMjsKICAgICAgICB0aGlzLl9saXN0ZW5lclkgPSB0aGlzLl9ydW50aW1lLkdldFZpZXdwb3J0SGVpZ2h0KCkgLyAyOwogICAgICAgIHRoaXMuX2xpc3RlbmVyWiA9IC02MDA7CiAgICAgICAgdGhpcy5fcmVmZXJlbmNlRGlzdGFuY2UgPSA2MDA7CiAgICAgICAgdGhpcy5fbWF4RGlzdGFuY2UgPSAxRTQ7CiAgICAgICAgdGhpcy5fcm9sbG9mZkZhY3RvciA9IDE7CiAgICAgICAgdGhpcy5fbGlzdGVuZXJJbnN0ID0gbnVsbDsKICAgICAgICB0aGlzLl9sb2FkTGlzdGVuZXJVaWQgPSAtMTsKICAgICAgICB0aGlzLl9tYXN0ZXJWb2x1bWUgPSAxOwogICAgICAgIHRoaXMuX2lzU2lsZW50ID0gITE7CiAgICAgICAgdGhpcy5fc2FtcGxlUmF0ZSA9IDA7CiAgICAgICAgdGhpcy5fYXVkaW9Db250ZXh0U3RhdGUgPSAic3VzcGVuZGVkIjsKICAgICAgICB0aGlzLl9vdXRwdXRMYXRlbmN5ID0gMDsKICAgICAgICB0aGlzLl9lZmZlY3RDb3VudCA9IG5ldyBNYXA7CiAgICAgICAgdGhpcy5fcHJlbG9hZENvdW50ID0gdGhpcy5fcHJlbG9hZFRvdGFsID0gMDsKICAgICAgICB0aGlzLl9idWZmZXJNZXRhZGF0YSA9IG5ldyBNYXA7CiAgICAgICAgdGhpcy5fcmVtb3RlVXJscyA9IG5ldyBNYXA7CiAgICAgICAgYSA9ICJpbnRlcmFjdGl2ZSI7CiAgICAgICAgYiAmJiAodGhpcy5fdGltZVNjYWxlTW9kZSA9IGJbMF0sIHRoaXMuX3NhdmVMb2FkTW9kZSA9IGJbMV0sIHRoaXMuX3BsYXlJbkJhY2tncm91bmQgPSBiWzJdLCBhID0gTEFURU5DWV9ISU5UU1tiWzNdXSwgdGhpcy5fcGFubmluZ01vZGVsID0gYls0XSwgdGhpcy5fZGlzdGFuY2VNb2RlbCA9IGJbNV0sIHRoaXMuX2xpc3RlbmVyWiA9IC1iWzZdLCB0aGlzLl9yZWZlcmVuY2VEaXN0YW5jZSA9IGJbN10sIHRoaXMuX21heERpc3RhbmNlID0gYls4XSwgdGhpcy5fcm9sbG9mZkZhY3RvciA9CiAgICAgICAgICAgIGJbOV0pOwogICAgICAgIHRoaXMuX2xhc3RBSVN0YXRlID0gW107CiAgICAgICAgdGhpcy5fbGFzdEZ4U3RhdGUgPSBbXTsKICAgICAgICB0aGlzLl9sYXN0QW5hbHlzZXJzRGF0YSA9IFtdOwogICAgICAgIHRoaXMuQWRkRE9NTWVzc2FnZUhhbmRsZXJzKFsKICAgICAgICAgICAgWyJzdGF0ZSIsIGQgPT4gdGhpcy5fT25VcGRhdGVTdGF0ZShkKV0sCiAgICAgICAgICAgIFsiYXVkaW9jb250ZXh0LXN0YXRlIiwgZCA9PiB0aGlzLl9PbkF1ZGlvQ29udGV4dFN0YXRlQ2hhbmdlZChkKV0sCiAgICAgICAgICAgIFsiZnhzdGF0ZSIsIGQgPT4gdGhpcy5fT25VcGRhdGVGeFN0YXRlKGQpXSwKICAgICAgICAgICAgWyJ0cmlnZ2VyIiwgZCA9PiB0aGlzLl9PblRyaWdnZXIoZCldLAogICAgICAgICAgICBbImJ1ZmZlci1tZXRhZGF0YSIsIGQgPT4gdGhpcy5fT25CdWZmZXJNZXRhZGF0YShkKV0KICAgICAgICBdKTsKICAgICAgICBiID0gdGhpcy5HZXRSdW50aW1lKCkuRGlzcGF0Y2hlcigpOwogICAgICAgIHRoaXMuX2Rpc3Bvc2FibGVzID0gbmV3IEMzJGpzY29tcCQyMTIuQ29tcG9zaXRlRGlzcG9zYWJsZShDMyRqc2NvbXAkMjEyLkRpc3Bvc2FibGUuRnJvbShiLCAiaW5zdGFuY2VkZXN0cm95IiwgZCA9PiB0aGlzLl9Pbkluc3RhbmNlRGVzdHJveWVkKGQuaW5zdGFuY2UpKSwKICAgICAgICAgICAgQzMkanNjb21wJDIxMi5EaXNwb3NhYmxlLkZyb20oYiwgImFmdGVybG9hZCIsICgpID0+IHRoaXMuX09uQWZ0ZXJMb2FkKCkpLCBDMyRqc2NvbXAkMjEyLkRpc3Bvc2FibGUuRnJvbShiLCAic3VzcGVuZCIsICgpID0+IHRoaXMuX09uU3VzcGVuZCgpKSwgQzMkanNjb21wJDIxMi5EaXNwb3NhYmxlLkZyb20oYiwgInJlc3VtZSIsICgpID0+IHRoaXMuX09uUmVzdW1lKCkpKTsKICAgICAgICB0aGlzLl9ydW50aW1lLkFkZExvYWRQcm9taXNlKHRoaXMuUG9zdFRvRE9NQXN5bmMoImNyZWF0ZS1hdWRpby1jb250ZXh0IiwgewogICAgICAgICAgICBwcmVsb2FkTGlzdDogdGhpcy5fcnVudGltZS5HZXRBc3NldE1hbmFnZXIoKS5HZXRBdWRpb1RvUHJlbG9hZCgpLm1hcChkID0+ICh7CiAgICAgICAgICAgICAgICBvcmlnaW5hbFVybDogZC5vcmlnaW5hbFVybCwKICAgICAgICAgICAgICAgIHVybDogZC51cmwsCiAgICAgICAgICAgICAgICB0eXBlOiBkLnR5cGUsCiAgICAgICAgICAgICAgICBmaWxlU2l6ZTogZC5maWxlU2l6ZQogICAgICAgICAgICB9KSksCiAgICAgICAgICAgIGlzaU9TQ29yZG92YTogdGhpcy5fcnVudGltZS5Jc2lPU0NvcmRvdmEoKSwKICAgICAgICAgICAgaXNTYWZhcmk6ICJTYWZhcmkiID09PSBDMyRqc2NvbXAkMjEyLlBsYXRmb3JtLkJyb3dzZXIsCiAgICAgICAgICAgIHRpbWVTY2FsZU1vZGU6IHRoaXMuX3RpbWVTY2FsZU1vZGUsCiAgICAgICAgICAgIGxhdGVuY3lIaW50OiBhLAogICAgICAgICAgICBwYW5uaW5nTW9kZWw6IHRoaXMuX3Bhbm5pbmdNb2RlbCwKICAgICAgICAgICAgZGlzdGFuY2VNb2RlbDogdGhpcy5fZGlzdGFuY2VNb2RlbCwKICAgICAgICAgICAgcmVmRGlzdGFuY2U6IHRoaXMuX3JlZmVyZW5jZURpc3RhbmNlLAogICAgICAgICAgICBtYXhEaXN0YW5jZTogdGhpcy5fbWF4RGlzdGFuY2UsCiAgICAgICAgICAgIHJvbGxvZmZGYWN0b3I6IHRoaXMuX3JvbGxvZmZGYWN0b3IsCiAgICAgICAgICAgIGxpc3RlbmVyUG9zOiBbdGhpcy5fbGlzdGVuZXJYLCB0aGlzLl9saXN0ZW5lclksIHRoaXMuX2xpc3RlbmVyWl0KICAgICAgICB9KS50aGVuKGQgPT4gewogICAgICAgICAgICB0aGlzLl9zYW1wbGVSYXRlID0gZC5zYW1wbGVSYXRlOwogICAgICAgICAgICB0aGlzLl9hdWRpb0NvbnRleHRTdGF0ZSA9IGQuYXVkaW9Db250ZXh0U3RhdGU7CiAgICAgICAgICAgIHRoaXMuX291dHB1dExhdGVuY3kgPSBkLm91dHB1dExhdGVuY3kKICAgICAgICB9KSk7CiAgICAgICAgdGhpcy5fU3RhcnRUaWNraW5nKCkKICAgIH0KICAgIFJlbGVhc2UoKSB7CiAgICAgICAgdGhpcy5fbGlzdGVuZXJJbnN0ID0gbnVsbDsKICAgICAgICBzdXBlci5SZWxlYXNlKCkKICAgIH0KICAgIF9BZGRBY3Rpb25Qcm9taXNlKGEpIHsKICAgICAgICB0aGlzLkdldFBsdWdpbigpLl9BZGRBY3Rpb25Qcm9taXNlKGEpCiAgICB9CiAgICBfT25JbnN0YW5jZURlc3Ryb3llZChhKSB7CiAgICAgICAgdGhpcy5fbGlzdGVuZXJJbnN0ID09PQogICAgICAgICAgICBhICYmICh0aGlzLl9saXN0ZW5lckluc3QgPSBudWxsKQogICAgfQogICAgRGJUb0xpbmVhck5vQ2FwKGEpIHsKICAgICAgICByZXR1cm4gTWF0aC5wb3coMTAsIGEgLyAyMCkKICAgIH0KICAgIERiVG9MaW5lYXIoYSkgewogICAgICAgIGEgPSB0aGlzLkRiVG9MaW5lYXJOb0NhcChhKTsKICAgICAgICByZXR1cm4gaXNGaW5pdGUoYSkgPyBNYXRoLm1heChNYXRoLm1pbihhLCAxKSwgMCkgOiAwCiAgICB9CiAgICBMaW5lYXJUb0RiTm9DYXAoYSkgewogICAgICAgIHJldHVybiBNYXRoLmxvZyhhKSAvIE1hdGgubG9nKDEwKSAqIDIwCiAgICB9CiAgICBMaW5lYXJUb0RiKGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5MaW5lYXJUb0RiTm9DYXAoTWF0aC5tYXgoTWF0aC5taW4oYSwgMSksIDApKQogICAgfQogICAgX09uU3VzcGVuZCgpIHsKICAgICAgICB0aGlzLl9wbGF5SW5CYWNrZ3JvdW5kIHx8IHRoaXMuUG9zdFRvRE9NKCJzZXQtc3VzcGVuZGVkIiwgewogICAgICAgICAgICBpc1N1c3BlbmRlZDogITAKICAgICAgICB9KQogICAgfQogICAgX09uUmVzdW1lKCkgewogICAgICAgIHRoaXMuX3BsYXlJbkJhY2tncm91bmQgfHwgdGhpcy5Qb3N0VG9ET00oInNldC1zdXNwZW5kZWQiLCB7CiAgICAgICAgICAgIGlzU3VzcGVuZGVkOiAhMQogICAgICAgIH0pCiAgICB9CiAgICBfT25VcGRhdGVTdGF0ZShhKSB7CiAgICAgICAgY29uc3QgYiA9IGEudGlja0NvdW50OwogICAgICAgIHRoaXMuX291dHB1dExhdGVuY3kgPQogICAgICAgICAgICBhLm91dHB1dExhdGVuY3k7CiAgICAgICAgY29uc3QgZCA9IHRoaXMuX2xhc3RBSVN0YXRlLmZpbHRlcihjID0+IGMuaGFzT3duUHJvcGVydHkoInBsYWNlaG9sZGVyIikgJiYgKGMucGxhY2Vob2xkZXIgPiBiIHx8IC0xID09PSBjLnBsYWNlaG9sZGVyKSk7CiAgICAgICAgdGhpcy5fbGFzdEFJU3RhdGUgPSBhLmF1ZGlvSW5zdGFuY2VzOwogICAgICAgIHRoaXMuX2xhc3RBbmFseXNlcnNEYXRhID0gYS5hbmFseXNlcnM7CiAgICAgICAgMCA8IGQubGVuZ3RoICYmIEMzJGpzY29tcCQyMTIuYXBwZW5kQXJyYXkodGhpcy5fbGFzdEFJU3RhdGUsIGQpCiAgICB9CiAgICBfT25CdWZmZXJNZXRhZGF0YShhKSB7CiAgICAgICAgdGhpcy5fYnVmZmVyTWV0YWRhdGEuc2V0KGEub3JpZ2luYWxVcmwsIHsKICAgICAgICAgICAgZHVyYXRpb246IGEuZHVyYXRpb24KICAgICAgICB9KQogICAgfQogICAgX09uQXVkaW9Db250ZXh0U3RhdGVDaGFuZ2VkKGEpIHsKICAgICAgICB0aGlzLl9hdWRpb0NvbnRleHRTdGF0ZSA9IGEuYXVkaW9Db250ZXh0U3RhdGUKICAgIH0KICAgIEdldEF1ZGlvQ29udGV4dFN0YXRlKCkgewogICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lLklzRXhwb3J0VG9WaWRlbygpID8gInJ1bm5pbmciIDogdGhpcy5fYXVkaW9Db250ZXh0U3RhdGUKICAgIH0KICAgIF9PblVwZGF0ZUZ4U3RhdGUoYSkgewogICAgICAgIHRoaXMuX2xhc3RGeFN0YXRlID0KICAgICAgICAgICAgYS5meHN0YXRlCiAgICB9CiAgICBfR2V0Rmlyc3RBdWRpb1N0YXRlQnlUYWcoYSkgewogICAgICAgIGZvciAoY29uc3QgYiBvZiB0aGlzLl9sYXN0QUlTdGF0ZSkKICAgICAgICAgICAgaWYgKEMzJGpzY29tcCQyMTIuZXF1YWxzTm9DYXNlKGIudGFnLCBhKSkgcmV0dXJuIGI7CiAgICAgICAgcmV0dXJuIG51bGwKICAgIH0KICAgIF9Jc1RhZ1BsYXlpbmcoYSkgewogICAgICAgIHJldHVybiB0aGlzLl9sYXN0QUlTdGF0ZS5zb21lKGIgPT4gQzMkanNjb21wJDIxMi5lcXVhbHNOb0Nhc2UoYSwgYi50YWcpICYmIGIuaXNQbGF5aW5nKQogICAgfQogICAgX01heWJlTWFya0FzUGxheWluZyhhLCBiLCBkLCBjLCBlKSB7CiAgICAgICAgaWYgKHRoaXMuX0lzVGFnUGxheWluZyhiKSkgcmV0dXJuIG51bGw7CiAgICAgICAgY29uc3QgZyA9IHRoaXMuX2J1ZmZlck1ldGFkYXRhLmdldChhKTsKICAgICAgICBhID0gewogICAgICAgICAgICB0YWc6IGIsCiAgICAgICAgICAgIGR1cmF0aW9uOiBnID8gZy5kdXJhdGlvbiA6IDAsCiAgICAgICAgICAgIHZvbHVtZTogZSwKICAgICAgICAgICAgaXNQbGF5aW5nOiAhMCwKICAgICAgICAgICAgcGxheWJhY2tUaW1lOiAwLAogICAgICAgICAgICBwbGF5YmFja1JhdGU6IDEsCiAgICAgICAgICAgIHVpZDogLTEsCiAgICAgICAgICAgIGJ1ZmZlck9yaWdpbmFsVXJsOiBhLAogICAgICAgICAgICBidWZmZXJVcmw6ICIiLAogICAgICAgICAgICBidWZmZXJUeXBlOiAiIiwKICAgICAgICAgICAgaXNNdXNpYzogZCwKICAgICAgICAgICAgaXNMb29waW5nOiBjLAogICAgICAgICAgICBpc011dGVkOiAhMSwKICAgICAgICAgICAgcmVzdW1lUG9zaXRpb246IDAsCiAgICAgICAgICAgIHBhbjogbnVsbCwKICAgICAgICAgICAgcGxhY2Vob2xkZXI6IC0xCiAgICAgICAgfTsKICAgICAgICB0aGlzLl9sYXN0QUlTdGF0ZS5wdXNoKGEpOwogICAgICAgIHJldHVybiBhCiAgICB9CiAgICBhc3luYyBfT25UcmlnZ2VyKGEpIHsKICAgICAgICBjb25zdCBiID0gYS50eXBlOwogICAgICAgIHRoaXMuX3RyaWdnZXJUYWcgPSBhLnRhZzsKICAgICAgICBhID0gYS5haWlkOwogICAgICAgIGlmICgiZW5kZWQiID09PSBiKSB7CiAgICAgICAgICAgIGZvciAoY29uc3QgZCBvZiB0aGlzLl9sYXN0QUlTdGF0ZSkKICAgICAgICAgICAgICAgIGlmIChkLmFpaWQgPT09IGEpIHsKICAgICAgICAgICAgICAgICAgICBkLmlzUGxheWluZyA9ICExOwogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIGF3YWl0IHRoaXMuVHJpZ2dlckFzeW5jKEMzJGpzY29tcCQyMTIuUGx1Z2lucy5BdWRpby5DbmRzLk9uRW5kZWQpCiAgICAgICAgfSBlbHNlICJmYWRlLWVuZGVkIiA9PT0gYiAmJiBhd2FpdCB0aGlzLlRyaWdnZXJBc3luYyhDMyRqc2NvbXAkMjEyLlBsdWdpbnMuQXVkaW8uQ25kcy5PbkZhZGVFbmRlZCkKICAgIH0KICAgIFRpY2soKSB7CiAgICAgICAgY29uc3QgYSA9IHsKICAgICAgICAgICAgdGltZVNjYWxlOiB0aGlzLl9ydW50aW1lLkdldFRpbWVTY2FsZSgpLAogICAgICAgICAgICBnYW1lVGltZTogdGhpcy5fcnVudGltZS5HZXRHYW1lVGltZVJhdygpLAogICAgICAgICAgICBpbnN0UGFuczogdGhpcy5HZXRJbnN0YW5jZVBhbnMoKSwKICAgICAgICAgICAgdGlja0NvdW50OiB0aGlzLl9ydW50aW1lLkdldFRpY2tDb3VudE5vU2F2ZSgpCiAgICAgICAgfTsKICAgICAgICBpZiAodGhpcy5fbGlzdGVuZXJJbnN0KSB7CiAgICAgICAgICAgIGNvbnN0IGIgPSB0aGlzLl9saXN0ZW5lckluc3QuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgIHRoaXMuX2xpc3RlbmVyWCA9IGIuR2V0WCgpOwogICAgICAgICAgICB0aGlzLl9saXN0ZW5lclkgPSBiLkdldFkoKTsKICAgICAgICAgICAgYS5saXN0ZW5lclBvcyA9IFt0aGlzLl9saXN0ZW5lclgsIHRoaXMuX2xpc3RlbmVyWSwgdGhpcy5fbGlzdGVuZXJaXQogICAgICAgIH0KICAgICAgICB0aGlzLlBvc3RUb0RPTSgidGljayIsIGEpCiAgICB9CiAgICByb3RhdGVQdEFyb3VuZChhLCBiLCBkLCBjLCBlKSB7CiAgICAgICAgaWYgKDAgPT09IGQpIHJldHVybiBbYSwgYl07CiAgICAgICAgY29uc3QgZyA9IE1hdGguc2luKGQpOwogICAgICAgIGQgPSBNYXRoLmNvcyhkKTsKICAgICAgICBhIC09IGM7CiAgICAgICAgYiAtPSBlOwogICAgICAgIGNvbnN0IGsgPSBhICogZzsKICAgICAgICBhID0gYSAqIGQgLSBiICogZzsKICAgICAgICByZXR1cm4gW2EgKyBjLCBiICogZCArIGsgKyBlXQogICAgfQogICAgR2V0SW5zdGFuY2VQYW5zKCkgewogICAgICAgIHJldHVybiB0aGlzLl9sYXN0QUlTdGF0ZS5maWx0ZXIoYSA9PiAtMSAhPT0gYS51aWQpLm1hcChhID0+IHRoaXMuX3J1bnRpbWUuR2V0SW5zdGFuY2VCeVVJRChhLnVpZCkpLmZpbHRlcihhID0+CiAgICAgICAgICAgIGEpLm1hcChhID0+IHsKICAgICAgICAgICAgY29uc3QgYiA9IGEuR2V0V29ybGRJbmZvKCksCiAgICAgICAgICAgICAgICBkID0gYi5HZXRMYXllcigpLkdldEFuZ2xlKCksCiAgICAgICAgICAgICAgICBbYywgZV0gPSB0aGlzLnJvdGF0ZVB0QXJvdW5kKGIuR2V0WCgpLCBiLkdldFkoKSwgLWQsIHRoaXMuX2xpc3RlbmVyWCwgdGhpcy5fbGlzdGVuZXJZKTsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIHVpZDogYS5HZXRVSUQoKSwKICAgICAgICAgICAgICAgIHg6IGMsCiAgICAgICAgICAgICAgICB5OiBlLAogICAgICAgICAgICAgICAgYW5nbGU6IGIuR2V0QW5nbGUoKSAtIGQKICAgICAgICAgICAgfQogICAgICAgIH0pCiAgICB9CiAgICBHZXRBbmFseXNlckRhdGEoYSwgYikgewogICAgICAgIGZvciAoY29uc3QgZCBvZiB0aGlzLl9sYXN0QW5hbHlzZXJzRGF0YSkKICAgICAgICAgICAgaWYgKGQuaW5kZXggPT09IGIgJiYgQzMkanNjb21wJDIxMi5lcXVhbHNOb0Nhc2UoZC50YWcsIGEpKSByZXR1cm4gZDsKICAgICAgICByZXR1cm4gbnVsbAogICAgfQogICAgX0luY3JlbWVudEVmZmVjdENvdW50KGEpIHsKICAgICAgICB0aGlzLl9lZmZlY3RDb3VudC5zZXQoYSwgKHRoaXMuX2VmZmVjdENvdW50LmdldChhKSB8fCAwKSArIDEpCiAgICB9CiAgICBfU2hvdWxkU2F2ZShhKSB7CiAgICAgICAgcmV0dXJuIGEuaGFzT3duUHJvcGVydHkoInBsYWNlaG9sZGVyIikgfHwgMyA9PT0gdGhpcy5fc2F2ZUxvYWRNb2RlID8gITEgOiBhLmlzTXVzaWMgJiYKICAgICAgICAgICAgMSA9PT0gdGhpcy5fc2F2ZUxvYWRNb2RlID8gITEgOiBhLmlzTXVzaWMgfHwgMiAhPT0gdGhpcy5fc2F2ZUxvYWRNb2RlID8gITAgOiAhMQogICAgfQogICAgU2F2ZVRvSnNvbigpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBpc1NpbGVudDogdGhpcy5faXNTaWxlbnQsCiAgICAgICAgICAgIG1hc3RlclZvbHVtZTogdGhpcy5fbWFzdGVyVm9sdW1lLAogICAgICAgICAgICBsaXN0ZW5lclo6IHRoaXMuX2xpc3RlbmVyWiwKICAgICAgICAgICAgbGlzdGVuZXJVaWQ6IHRoaXMuX2xpc3RlbmVySW5zdCA/IHRoaXMuX2xpc3RlbmVySW5zdC5HZXRVSUQoKSA6IC0xLAogICAgICAgICAgICByZW1vdGVVcmxzOiBbLi4udGhpcy5fcmVtb3RlVXJscy5lbnRyaWVzKCldLAogICAgICAgICAgICBwbGF5aW5nOiB0aGlzLl9sYXN0QUlTdGF0ZS5maWx0ZXIoYSA9PiB0aGlzLl9TaG91bGRTYXZlKGEpKSwKICAgICAgICAgICAgZWZmZWN0czogdGhpcy5fbGFzdEZ4U3RhdGUsCiAgICAgICAgICAgIGFuYWx5c2VyczogdGhpcy5fbGFzdEFuYWx5c2Vyc0RhdGEKICAgICAgICB9CiAgICB9CiAgICBMb2FkRnJvbUpzb24oYSkgewogICAgICAgIHRoaXMuX2lzU2lsZW50ID0gYS5pc1NpbGVudDsKICAgICAgICB0aGlzLl9tYXN0ZXJWb2x1bWUgPSBhLm1hc3RlclZvbHVtZTsKICAgICAgICB0aGlzLl9saXN0ZW5lclogPSBhLmxpc3RlbmVyWjsKICAgICAgICB0aGlzLl9saXN0ZW5lckluc3QgPQogICAgICAgICAgICBudWxsOwogICAgICAgIHRoaXMuX2xvYWRMaXN0ZW5lclVpZCA9IGEubGlzdGVuZXJVaWQ7CiAgICAgICAgdGhpcy5fcmVtb3RlVXJscy5jbGVhcigpOwogICAgICAgIGlmIChhLnJlbW90ZVVybHMpCiAgICAgICAgICAgIGZvciAoY29uc3QgW2IsIGRdIG9mIGEucmVtb3RlVXJscykgdGhpcy5fcmVtb3RlVXJscy5zZXQoYiwgZCk7CiAgICAgICAgdGhpcy5fbGFzdEFJU3RhdGUgPSBhLnBsYXlpbmc7CiAgICAgICAgdGhpcy5fbGFzdEZ4U3RhdGUgPSBhLmVmZmVjdHM7CiAgICAgICAgdGhpcy5fbGFzdEFuYWx5c2Vyc0RhdGEgPSBhLmFuYWx5c2VycwogICAgfQogICAgX09uQWZ0ZXJMb2FkKCkgewogICAgICAgIGlmICgtMSAhPT0gdGhpcy5fbG9hZExpc3RlbmVyVWlkICYmICh0aGlzLl9saXN0ZW5lckluc3QgPSB0aGlzLl9ydW50aW1lLkdldEluc3RhbmNlQnlVSUQodGhpcy5fbG9hZExpc3RlbmVyVWlkKSwgdGhpcy5fbG9hZExpc3RlbmVyVWlkID0gLTEsIHRoaXMuX2xpc3RlbmVySW5zdCkpIHsKICAgICAgICAgICAgdmFyIGEgPSB0aGlzLl9saXN0ZW5lckluc3QuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgIHRoaXMuX2xpc3RlbmVyWCA9IGEuR2V0WCgpOwogICAgICAgICAgICB0aGlzLl9saXN0ZW5lclkgPSBhLkdldFkoKQogICAgICAgIH0KICAgICAgICBmb3IgKHZhciBiIG9mIHRoaXMuX2xhc3RBSVN0YXRlKShhID0KICAgICAgICAgICAgdGhpcy5fcnVudGltZS5HZXRBc3NldE1hbmFnZXIoKS5HZXRQcm9qZWN0QXVkaW9GaWxlVXJsKGIuYnVmZmVyT3JpZ2luYWxVcmwpKSA/IChiLmJ1ZmZlclVybCA9IGEudXJsLCBiLmJ1ZmZlclR5cGUgPSBhLnR5cGUpIDogYi5idWZmZXJVcmwgPSBudWxsOwogICAgICAgIGZvciAoY29uc3QgZCBvZiBPYmplY3QudmFsdWVzKHRoaXMuX2xhc3RGeFN0YXRlKSkKICAgICAgICAgICAgZm9yIChjb25zdCBjIG9mIGQpIGMuaGFzT3duUHJvcGVydHkoImJ1ZmZlck9yaWdpbmFsVXJsIikgJiYgKGIgPSB0aGlzLl9ydW50aW1lLkdldEFzc2V0TWFuYWdlcigpLkdldFByb2plY3RBdWRpb0ZpbGVVcmwoYy5idWZmZXJPcmlnaW5hbFVybCkpICYmIChjLmJ1ZmZlclVybCA9IGIudXJsLCBjLmJ1ZmZlclR5cGUgPSBiLnR5cGUpOwogICAgICAgIHRoaXMuUG9zdFRvRE9NKCJsb2FkLXN0YXRlIiwgewogICAgICAgICAgICBzYXZlTG9hZE1vZGU6IHRoaXMuX3NhdmVMb2FkTW9kZSwKICAgICAgICAgICAgdGltZVNjYWxlOiB0aGlzLl9ydW50aW1lLkdldFRpbWVTY2FsZSgpLAogICAgICAgICAgICBnYW1lVGltZTogdGhpcy5fcnVudGltZS5HZXRHYW1lVGltZVJhdygpLAogICAgICAgICAgICBsaXN0ZW5lclBvczogW3RoaXMuX2xpc3RlbmVyWCwKICAgICAgICAgICAgICAgIHRoaXMuX2xpc3RlbmVyWSwgdGhpcy5fbGlzdGVuZXJaCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIGlzU2lsZW50OiB0aGlzLl9pc1NpbGVudCwKICAgICAgICAgICAgbWFzdGVyVm9sdW1lOiB0aGlzLl9tYXN0ZXJWb2x1bWUsCiAgICAgICAgICAgIHBsYXlpbmc6IHRoaXMuX2xhc3RBSVN0YXRlLmZpbHRlcihkID0+IG51bGwgIT09IGQuYnVmZmVyVXJsKSwKICAgICAgICAgICAgZWZmZWN0czogdGhpcy5fbGFzdEZ4U3RhdGUKICAgICAgICB9KQogICAgfQogICAgR2V0RGVidWdnZXJQcm9wZXJ0aWVzKCkgewogICAgICAgIGNvbnN0IGEgPSBbXTsKICAgICAgICBmb3IgKGNvbnN0IFtiLCBkXSBvZiBPYmplY3QuZW50cmllcyh0aGlzLl9sYXN0RnhTdGF0ZSkpIGEucHVzaCh7CiAgICAgICAgICAgIG5hbWU6ICIkIiArIGIsCiAgICAgICAgICAgIHZhbHVlOiBkLm1hcChjID0+IGMudHlwZSkuam9pbigiLCAiKQogICAgICAgIH0pOwogICAgICAgIHJldHVybiBbewogICAgICAgICAgICB0aXRsZTogInBsdWdpbnMuYXVkaW8uZGVidWdnZXIudGFnLWVmZmVjdHMiLAogICAgICAgICAgICBwcm9wZXJ0aWVzOiBhCiAgICAgICAgfSwgewogICAgICAgICAgICB0aXRsZTogInBsdWdpbnMuYXVkaW8uZGVidWdnZXIuY3VycmVudGx5LXBsYXlpbmciLAogICAgICAgICAgICBwcm9wZXJ0aWVzOiBbewogICAgICAgICAgICAgICAgICAgIG5hbWU6ICJwbHVnaW5zLmF1ZGlvLmRlYnVnZ2VyLmN1cnJlbnRseS1wbGF5aW5nLWNvdW50IiwKICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5fbGFzdEFJU3RhdGUubGVuZ3RoCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgLi4udGhpcy5fbGFzdEFJU3RhdGUubWFwKChiLCBkKSA9PiAoewogICAgICAgICAgICAgICAgICAgIG5hbWU6ICIkIyIgKyBkLAogICAgICAgICAgICAgICAgICAgIHZhbHVlOiBgJHtiLmJ1ZmZlck9yaWdpbmFsVXJsfSAoIiR7Yi50YWd9IikgJHtNYXRoLnJvdW5kKDEwKmIucGxheWJhY2tUaW1lKS8xMH0gLyAke01hdGgucm91bmQoMTAqYi5kdXJhdGlvbikvMTB9YAogICAgICAgICAgICAgICAgfSkpCiAgICAgICAgICAgIF0KICAgICAgICB9XQogICAgfQp9Owpjb25zdCBDMyRqc2NvbXAkMjEzID0gc2VsZi5DMzsKQzMkanNjb21wJDIxMy5QbHVnaW5zLkF1ZGlvLkNuZHMgPSB7CiAgICBPbkVuZGVkKGEpIHsKICAgICAgICByZXR1cm4gQzMkanNjb21wJDIxMy5lcXVhbHNOb0Nhc2UodGhpcy5fdHJpZ2dlclRhZywgYSkKICAgIH0sCiAgICBPbkZhZGVFbmRlZChhKSB7CiAgICAgICAgcmV0dXJuIEMzJGpzY29tcCQyMTMuZXF1YWxzTm9DYXNlKHRoaXMuX3RyaWdnZXJUYWcsIGEpCiAgICB9LAogICAgUHJlbG9hZHNDb21wbGV0ZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcHJlbG9hZENvdW50ID09PSB0aGlzLl9wcmVsb2FkVG90YWwKICAgIH0sCiAgICBBZHZhbmNlZEF1ZGlvU3VwcG9ydGVkKCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIElzU2lsZW50KCkgewogICAgICAgIHJldHVybiB0aGlzLl9pc1NpbGVudAogICAgfSwKICAgIElzQW55UGxheWluZygpIHsKICAgICAgICBmb3IgKGNvbnN0IGEgb2YgdGhpcy5fbGFzdEFJU3RhdGUpCiAgICAgICAgICAgIGlmIChhLmlzUGxheWluZykgcmV0dXJuICEwOwogICAgICAgIHJldHVybiAhMQogICAgfSwKICAgIElzVGFnUGxheWluZyhhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX0lzVGFnUGxheWluZyhhKQogICAgfQp9Owpjb25zdCBDMyRqc2NvbXAkMjE0ID0gc2VsZi5DMywKICAgIEZJTFRFUl9UWVBFUyA9ICJsb3dwYXNzIGhpZ2hwYXNzIGJhbmRwYXNzIGxvd3NoZWxmIGhpZ2hzaGVsZiBwZWFraW5nIG5vdGNoIGFsbHBhc3MiLnNwbGl0KCIgIik7CkMzJGpzY29tcCQyMTQuUGx1Z2lucy5BdWRpby5BY3RzID0gewogICAgUGxheShhLCBiLCBkLCBjLCBlLCBnKSB7CiAgICAgICAgYSA9IEMzJGpzY29tcCQyMTQuUGx1Z2lucy5BdWRpby5BY3RzLl9Eb1BsYXkuY2FsbCh0aGlzLCBhLCBiLCBkLCBjLCBlLCBnKTsKICAgICAgICB0aGlzLl9BZGRBY3Rpb25Qcm9taXNlKGEpOwogICAgICAgIHJldHVybiBhCiAgICB9LAogICAgYXN5bmMgX0RvUGxheShhLCBiLCBkLCBjLCBlLCBnKSB7CiAgICAgICAgaWYgKCF0aGlzLl9pc1NpbGVudCkgewogICAgICAgICAgICB2YXIgayA9IGFbMV0sCiAgICAgICAgICAgICAgICBtID0gdGhpcy5fcnVudGltZS5HZXRBc3NldE1hbmFnZXIoKS5HZXRQcm9qZWN0QXVkaW9GaWxlVXJsKGFbMF0pOwogICAgICAgICAgICBpZiAobSkgewogICAgICAgICAgICAgICAgZyA9IGcgPyBnIDogMDsKICAgICAgICAgICAgICAgIHZhciBuID0gdGhpcy5fbmV4dFBsYXlUaW1lOwogICAgICAgICAgICAgICAgdGhpcy5fbmV4dFBsYXlUaW1lID0gMDsKICAgICAgICAgICAgICAgIHZhciBxID0gdGhpcy5fTWF5YmVNYXJrQXNQbGF5aW5nKGFbMF0sIGUudG9Mb3dlckNhc2UoKSwgaywgMCAhPT0gYiwgdGhpcy5EYlRvTGluZWFyKGQpKTsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5Qb3N0VG9ET01Bc3luYygicGxheSIsIHsKICAgICAgICAgICAgICAgICAgICAgICAgb3JpZ2luYWxVcmw6IGFbMF0sCiAgICAgICAgICAgICAgICAgICAgICAgIHVybDogbS51cmwsCiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IG0udHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgaXNNdXNpYzogaywKICAgICAgICAgICAgICAgICAgICAgICAgdGFnOiBlLnRvTG93ZXJDYXNlKCksCiAgICAgICAgICAgICAgICAgICAgICAgIGlzTG9vcGluZzogMCAhPT0gYiwKICAgICAgICAgICAgICAgICAgICAgICAgdm9sOiB0aGlzLkRiVG9MaW5lYXIoZCksCiAgICAgICAgICAgICAgICAgICAgICAgIHN0ZXJlb1BhbjogQzMkanNjb21wJDIxNC5jbGFtcChjIC8gMTAwLCAtMSwgMSksCiAgICAgICAgICAgICAgICAgICAgICAgIHBvczogZywKICAgICAgICAgICAgICAgICAgICAgICAgb2ZmOiBuLAogICAgICAgICAgICAgICAgICAgICAgICB0cnVlQ2xvY2s6ICEhc2VsZi5DM19HZXRBdWRpb0NvbnRleHRDdXJyZW50VGltZQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgICAgIHEgJiYgKHEucGxhY2Vob2xkZXIgPSB0aGlzLl9ydW50aW1lLkdldFRpY2tDb3VudE5vU2F2ZSgpKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSwKICAgIGFzeW5jIFBsYXlBdFBvc2l0aW9uKGEsIGIsIGQsIGMsIGUsIGcsIGssIG0sIG4sIHEpIHsKICAgICAgICBpZiAoIXRoaXMuX2lzU2lsZW50KSB7CiAgICAgICAgICAgIHZhciB1ID0gYVsxXSwKICAgICAgICAgICAgICAgIHcgPSB0aGlzLl9ydW50aW1lLkdldEFzc2V0TWFuYWdlcigpLkdldFByb2plY3RBdWRpb0ZpbGVVcmwoYVswXSk7CiAgICAgICAgICAgIGlmICh3KSB7CiAgICAgICAgICAgICAgICB2YXIgeiA9IHRoaXMuX25leHRQbGF5VGltZTsKICAgICAgICAgICAgICAgIHRoaXMuX25leHRQbGF5VGltZSA9IDA7CiAgICAgICAgICAgICAgICB2YXIgQyA9IHRoaXMuX01heWJlTWFya0FzUGxheWluZyhhWzBdLCBxLnRvTG93ZXJDYXNlKCksIHUsIDAgIT09IGIsIHRoaXMuRGJUb0xpbmVhcihkKSk7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuUG9zdFRvRE9NQXN5bmMoInBsYXkiLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9yaWdpbmFsVXJsOiBhWzBdLAogICAgICAgICAgICAgICAgICAgICAgICB1cmw6IHcudXJsLAogICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiB3LnR5cGUsCiAgICAgICAgICAgICAgICAgICAgICAgIGlzTXVzaWM6IHUsCiAgICAgICAgICAgICAgICAgICAgICAgIHRhZzogcS50b0xvd2VyQ2FzZSgpLAogICAgICAgICAgICAgICAgICAgICAgICBpc0xvb3Bpbmc6IDAgIT09IGIsCiAgICAgICAgICAgICAgICAgICAgICAgIHZvbDogdGhpcy5EYlRvTGluZWFyKGQpLAogICAgICAgICAgICAgICAgICAgICAgICBwb3M6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIG9mZjogeiwKICAgICAgICAgICAgICAgICAgICAgICAgdHJ1ZUNsb2NrOiAhIXNlbGYuQzNfR2V0QXVkaW9Db250ZXh0Q3VycmVudFRpbWUsCiAgICAgICAgICAgICAgICAgICAgICAgIHBhbm5pbmc6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHg6IGMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB5OiBlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5nbGU6IEMzJGpzY29tcCQyMTQudG9SYWRpYW5zKGcpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5uZXJBbmdsZTogQzMkanNjb21wJDIxNC50b1JhZGlhbnMoayksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdXRlckFuZ2xlOiBDMyRqc2NvbXAkMjE0LnRvUmFkaWFucyhtKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG91dGVyR2FpbjogdGhpcy5EYlRvTGluZWFyKG4pCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICAgICBDICYmIChDLnBsYWNlaG9sZGVyID0gdGhpcy5fcnVudGltZS5HZXRUaWNrQ291bnROb1NhdmUoKSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0sCiAgICBhc3luYyBQbGF5QXRPYmplY3QoYSwgYiwgZCwgYywgZSwgZywgaywgbSkgewogICAgICAgIGlmICghdGhpcy5faXNTaWxlbnQgJiYgYyAmJiAoYyA9IGMuR2V0Rmlyc3RQaWNrZWQoKSkgJiYgYy5HZXRXb3JsZEluZm8oKSkgewogICAgICAgICAgICB2YXIgbiA9IGMuR2V0V29ybGRJbmZvKCksCiAgICAgICAgICAgICAgICBxID0gbi5HZXRMYXllcigpLkdldEFuZ2xlKCksCiAgICAgICAgICAgICAgICBbdSwgd10gPSB0aGlzLnJvdGF0ZVB0QXJvdW5kKG4uR2V0WCgpLCBuLkdldFkoKSwgLXEsIHRoaXMuX2xpc3RlbmVyWCwgdGhpcy5fbGlzdGVuZXJZKSwKICAgICAgICAgICAgICAgIHogPSBhWzFdLAogICAgICAgICAgICAgICAgQyA9IHRoaXMuX3J1bnRpbWUuR2V0QXNzZXRNYW5hZ2VyKCkuR2V0UHJvamVjdEF1ZGlvRmlsZVVybChhWzBdKTsKICAgICAgICAgICAgaWYgKEMpIHsKICAgICAgICAgICAgICAgIHZhciBEID0gdGhpcy5fbmV4dFBsYXlUaW1lOwogICAgICAgICAgICAgICAgdGhpcy5fbmV4dFBsYXlUaW1lID0gMDsKICAgICAgICAgICAgICAgIHZhciBGID0gdGhpcy5fTWF5YmVNYXJrQXNQbGF5aW5nKGFbMF0sIG0udG9Mb3dlckNhc2UoKSwgeiwgMCAhPT0gYiwgdGhpcy5EYlRvTGluZWFyKGQpKTsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5Qb3N0VG9ET01Bc3luYygicGxheSIsIHsKICAgICAgICAgICAgICAgICAgICAgICAgb3JpZ2luYWxVcmw6IGFbMF0sCiAgICAgICAgICAgICAgICAgICAgICAgIHVybDogQy51cmwsCiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IEMudHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgaXNNdXNpYzogeiwKICAgICAgICAgICAgICAgICAgICAgICAgdGFnOiBtLnRvTG93ZXJDYXNlKCksCiAgICAgICAgICAgICAgICAgICAgICAgIGlzTG9vcGluZzogMCAhPT0gYiwKICAgICAgICAgICAgICAgICAgICAgICAgdm9sOiB0aGlzLkRiVG9MaW5lYXIoZCksCiAgICAgICAgICAgICAgICAgICAgICAgIHBvczogMCwKICAgICAgICAgICAgICAgICAgICAgICAgb2ZmOiBELAogICAgICAgICAgICAgICAgICAgICAgICB0cnVlQ2xvY2s6ICEhc2VsZi5DM19HZXRBdWRpb0NvbnRleHRDdXJyZW50VGltZSwKICAgICAgICAgICAgICAgICAgICAgICAgcGFubmluZzogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgeDogdSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHk6IHcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbmdsZTogbi5HZXRBbmdsZSgpIC0gcSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlubmVyQW5nbGU6IEMzJGpzY29tcCQyMTQudG9SYWRpYW5zKGUpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3V0ZXJBbmdsZTogQzMkanNjb21wJDIxNC50b1JhZGlhbnMoZyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdXRlckdhaW46IHRoaXMuRGJUb0xpbmVhcihrKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpZDogYy5HZXRVSUQoKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICAgICAgRiAmJiAoRi5wbGFjZWhvbGRlciA9IHRoaXMuX3J1bnRpbWUuR2V0VGlja0NvdW50Tm9TYXZlKCkpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9LAogICAgYXN5bmMgUGxheUJ5TmFtZShhLCBiLCBkLCBjLCBlLCBnKSB7CiAgICAgICAgaWYgKCF0aGlzLl9pc1NpbGVudCkgewogICAgICAgICAgICBhID0gMSA9PT0gYTsKICAgICAgICAgICAgdmFyIGsgPSB0aGlzLl9ydW50aW1lLkdldEFzc2V0TWFuYWdlcigpLkdldFByb2plY3RBdWRpb0ZpbGVVcmwoYikgfHwgdGhpcy5fcmVtb3RlVXJscy5nZXQoYi50b0xvd2VyQ2FzZSgpKTsKICAgICAgICAgICAgaWYgKGspIHsKICAgICAgICAgICAgICAgIHZhciBtID0gdGhpcy5fbmV4dFBsYXlUaW1lOwogICAgICAgICAgICAgICAgdGhpcy5fbmV4dFBsYXlUaW1lID0gMDsKICAgICAgICAgICAgICAgIHZhciBuID0gdGhpcy5fTWF5YmVNYXJrQXNQbGF5aW5nKGIsIGcudG9Mb3dlckNhc2UoKSwgYSwgMCAhPT0gZCwgdGhpcy5EYlRvTGluZWFyKGMpKTsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5Qb3N0VG9ET01Bc3luYygicGxheSIsIHsKICAgICAgICAgICAgICAgICAgICAgICAgb3JpZ2luYWxVcmw6IGIsCiAgICAgICAgICAgICAgICAgICAgICAgIHVybDogay51cmwsCiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IGsudHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgaXNNdXNpYzogYSwKICAgICAgICAgICAgICAgICAgICAgICAgdGFnOiBnLnRvTG93ZXJDYXNlKCksCiAgICAgICAgICAgICAgICAgICAgICAgIGlzTG9vcGluZzogMCAhPT0gZCwKICAgICAgICAgICAgICAgICAgICAgICAgdm9sOiB0aGlzLkRiVG9MaW5lYXIoYyksCiAgICAgICAgICAgICAgICAgICAgICAgIHN0ZXJlb1BhbjogQzMkanNjb21wJDIxNC5jbGFtcChlIC8gMTAwLCAtMSwgMSksCiAgICAgICAgICAgICAgICAgICAgICAgIHBvczogMCwKICAgICAgICAgICAgICAgICAgICAgICAgb2ZmOiBtLAogICAgICAgICAgICAgICAgICAgICAgICB0cnVlQ2xvY2s6ICEhc2VsZi5DM19HZXRBdWRpb0NvbnRleHRDdXJyZW50VGltZQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgICAgIG4gJiYgKG4ucGxhY2Vob2xkZXIgPSB0aGlzLl9ydW50aW1lLkdldFRpY2tDb3VudE5vU2F2ZSgpKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSwKICAgIGFzeW5jIFBsYXlBdFBvc2l0aW9uQnlOYW1lKGEsIGIsIGQsIGMsIGUsIGcsIGssIG0sIG4sIHEsIHUpIHsKICAgICAgICBpZiAoIXRoaXMuX2lzU2lsZW50KSB7CiAgICAgICAgICAgIGEgPSAxID09PSBhOwogICAgICAgICAgICB2YXIgdyA9IHRoaXMuX3J1bnRpbWUuR2V0QXNzZXRNYW5hZ2VyKCkuR2V0UHJvamVjdEF1ZGlvRmlsZVVybChiKSB8fCB0aGlzLl9yZW1vdGVVcmxzLmdldChiLnRvTG93ZXJDYXNlKCkpOwogICAgICAgICAgICBpZiAodykgewogICAgICAgICAgICAgICAgdmFyIHogPQogICAgICAgICAgICAgICAgICAgIHRoaXMuX25leHRQbGF5VGltZTsKICAgICAgICAgICAgICAgIHRoaXMuX25leHRQbGF5VGltZSA9IDA7CiAgICAgICAgICAgICAgICB2YXIgQyA9IHRoaXMuX01heWJlTWFya0FzUGxheWluZyhiLCB1LnRvTG93ZXJDYXNlKCksIGEsIDAgIT09IGQsIHRoaXMuRGJUb0xpbmVhcihjKSk7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuUG9zdFRvRE9NQXN5bmMoInBsYXkiLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9yaWdpbmFsVXJsOiBiLAogICAgICAgICAgICAgICAgICAgICAgICB1cmw6IHcudXJsLAogICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiB3LnR5cGUsCiAgICAgICAgICAgICAgICAgICAgICAgIGlzTXVzaWM6IGEsCiAgICAgICAgICAgICAgICAgICAgICAgIHRhZzogdS50b0xvd2VyQ2FzZSgpLAogICAgICAgICAgICAgICAgICAgICAgICBpc0xvb3Bpbmc6IDAgIT09IGQsCiAgICAgICAgICAgICAgICAgICAgICAgIHZvbDogdGhpcy5EYlRvTGluZWFyKGMpLAogICAgICAgICAgICAgICAgICAgICAgICBwb3M6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIG9mZjogeiwKICAgICAgICAgICAgICAgICAgICAgICAgdHJ1ZUNsb2NrOiAhIXNlbGYuQzNfR2V0QXVkaW9Db250ZXh0Q3VycmVudFRpbWUsCiAgICAgICAgICAgICAgICAgICAgICAgIHBhbm5pbmc6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHg6IGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB5OiBnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5nbGU6IEMzJGpzY29tcCQyMTQudG9SYWRpYW5zKGspLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5uZXJBbmdsZTogQzMkanNjb21wJDIxNC50b1JhZGlhbnMobSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdXRlckFuZ2xlOiBDMyRqc2NvbXAkMjE0LnRvUmFkaWFucyhuKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG91dGVyR2FpbjogdGhpcy5EYlRvTGluZWFyKHEpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICAgICBDICYmIChDLnBsYWNlaG9sZGVyID0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcnVudGltZS5HZXRUaWNrQ291bnROb1NhdmUoKSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0sCiAgICBhc3luYyBQbGF5QXRPYmplY3RCeU5hbWUoYSwgYiwgZCwgYywgZSwgZywgaywgbSwgbikgewogICAgICAgIGlmICghdGhpcy5faXNTaWxlbnQgJiYgIXRoaXMuX2lzU2lsZW50ICYmIGUgJiYgKGUgPSBlLkdldEZpcnN0UGlja2VkKCkpICYmIGUuR2V0V29ybGRJbmZvKCkpIHsKICAgICAgICAgICAgdmFyIHEgPSBlLkdldFdvcmxkSW5mbygpLAogICAgICAgICAgICAgICAgdSA9IHEuR2V0TGF5ZXIoKS5HZXRBbmdsZSgpLAogICAgICAgICAgICAgICAgW3csIHpdID0gdGhpcy5yb3RhdGVQdEFyb3VuZChxLkdldFgoKSwgcS5HZXRZKCksIC11LCB0aGlzLl9saXN0ZW5lclgsIHRoaXMuX2xpc3RlbmVyWSk7CiAgICAgICAgICAgIGEgPSAxID09PSBhOwogICAgICAgICAgICB2YXIgQyA9IHRoaXMuX3J1bnRpbWUuR2V0QXNzZXRNYW5hZ2VyKCkuR2V0UHJvamVjdEF1ZGlvRmlsZVVybChiKSB8fCB0aGlzLl9yZW1vdGVVcmxzLmdldChiLnRvTG93ZXJDYXNlKCkpOwogICAgICAgICAgICBpZiAoQykgewogICAgICAgICAgICAgICAgdmFyIEQgPSB0aGlzLl9uZXh0UGxheVRpbWU7CiAgICAgICAgICAgICAgICB0aGlzLl9uZXh0UGxheVRpbWUgPSAwOwogICAgICAgICAgICAgICAgdmFyIEYgPSB0aGlzLl9NYXliZU1hcmtBc1BsYXlpbmcoYiwgbi50b0xvd2VyQ2FzZSgpLAogICAgICAgICAgICAgICAgICAgIGEsIDAgIT09IGQsIHRoaXMuRGJUb0xpbmVhcihjKSk7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuUG9zdFRvRE9NQXN5bmMoInBsYXkiLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9yaWdpbmFsVXJsOiBiLAogICAgICAgICAgICAgICAgICAgICAgICB1cmw6IEMudXJsLAogICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBDLnR5cGUsCiAgICAgICAgICAgICAgICAgICAgICAgIGlzTXVzaWM6IGEsCiAgICAgICAgICAgICAgICAgICAgICAgIHRhZzogbi50b0xvd2VyQ2FzZSgpLAogICAgICAgICAgICAgICAgICAgICAgICBpc0xvb3Bpbmc6IDAgIT09IGQsCiAgICAgICAgICAgICAgICAgICAgICAgIHZvbDogdGhpcy5EYlRvTGluZWFyKGMpLAogICAgICAgICAgICAgICAgICAgICAgICBwb3M6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIG9mZjogRCwKICAgICAgICAgICAgICAgICAgICAgICAgdHJ1ZUNsb2NrOiAhIXNlbGYuQzNfR2V0QXVkaW9Db250ZXh0Q3VycmVudFRpbWUsCiAgICAgICAgICAgICAgICAgICAgICAgIHBhbm5pbmc6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHg6IHcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB5OiB6LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5nbGU6IHEuR2V0QW5nbGUoKSAtIHUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbm5lckFuZ2xlOiBDMyRqc2NvbXAkMjE0LnRvUmFkaWFucyhnKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG91dGVyQW5nbGU6IEMzJGpzY29tcCQyMTQudG9SYWRpYW5zKGspLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3V0ZXJHYWluOiB0aGlzLkRiVG9MaW5lYXIobSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aWQ6IGUuR2V0VUlEKCkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgICAgIEYgJiYgKEYucGxhY2Vob2xkZXIgPSB0aGlzLl9ydW50aW1lLkdldFRpY2tDb3VudE5vU2F2ZSgpKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSwKICAgIFNldExvb3BpbmcoYSwgYikgewogICAgICAgIHRoaXMuUG9zdFRvRE9NKCJzZXQtbG9vcGluZyIsIHsKICAgICAgICAgICAgdGFnOiBhLnRvTG93ZXJDYXNlKCksCiAgICAgICAgICAgIGlzTG9vcGluZzogMCA9PT0gYgogICAgICAgIH0pCiAgICB9LAogICAgU2V0TXV0ZWQoYSwgYikgewogICAgICAgIHRoaXMuUG9zdFRvRE9NKCJzZXQtbXV0ZWQiLCB7CiAgICAgICAgICAgIHRhZzogYS50b0xvd2VyQ2FzZSgpLAogICAgICAgICAgICBpc011dGVkOiAwID09PSBiCiAgICAgICAgfSkKICAgIH0sCiAgICBTZXRWb2x1bWUoYSwgYikgewogICAgICAgIHRoaXMuUG9zdFRvRE9NKCJzZXQtdm9sdW1lIiwgewogICAgICAgICAgICB0YWc6IGEudG9Mb3dlckNhc2UoKSwKICAgICAgICAgICAgdm9sOiB0aGlzLkRiVG9MaW5lYXIoYikKICAgICAgICB9KQogICAgfSwKICAgIEZhZGVWb2x1bWUoYSwgYiwgZCwgYykgewogICAgICAgIHRoaXMuUG9zdFRvRE9NKCJmYWRlLXZvbHVtZSIsIHsKICAgICAgICAgICAgdGFnOiBhLnRvTG93ZXJDYXNlKCksCiAgICAgICAgICAgIHZvbDogdGhpcy5EYlRvTGluZWFyKGIpLAogICAgICAgICAgICBkdXJhdGlvbjogZCwKICAgICAgICAgICAgc3RvcE9uRW5kOiAwID09PSBjCiAgICAgICAgfSkKICAgIH0sCiAgICBTZXRTdGVyZW9QYW4oYSwgYikgewogICAgICAgIHRoaXMuUG9zdFRvRE9NKCJzZXQtc3RlcmVvLXBhbiIsIHsKICAgICAgICAgICAgdGFnOiBhLnRvTG93ZXJDYXNlKCksCiAgICAgICAgICAgIHA6IEMzJGpzY29tcCQyMTQuY2xhbXAoYiAvIDEwMCwgLTEsIDEpCiAgICAgICAgfSkKICAgIH0sCiAgICBhc3luYyBQcmVsb2FkKGEpIHsKICAgICAgICBjb25zdCBiID0gYVsxXSwKICAgICAgICAgICAgZCA9IHRoaXMuX3J1bnRpbWUuR2V0QXNzZXRNYW5hZ2VyKCkuR2V0UHJvamVjdEF1ZGlvRmlsZVVybChhWzBdKTsKICAgICAgICBkICYmICh0aGlzLl9wcmVsb2FkVG90YWwrKywgYXdhaXQgdGhpcy5Qb3N0VG9ET01Bc3luYygicHJlbG9hZCIsIHsKICAgICAgICAgICAgb3JpZ2luYWxVcmw6IGFbMF0sCiAgICAgICAgICAgIHVybDogZC51cmwsCiAgICAgICAgICAgIHR5cGU6IGQudHlwZSwKICAgICAgICAgICAgaXNNdXNpYzogYgogICAgICAgIH0pLCB0aGlzLl9wcmVsb2FkQ291bnQrKykKICAgIH0sCiAgICBhc3luYyBQcmVsb2FkQnlOYW1lKGEsIGIpIHsKICAgICAgICBhID0gMSA9PT0gYTsKICAgICAgICBjb25zdCBkID0gdGhpcy5fcnVudGltZS5HZXRBc3NldE1hbmFnZXIoKS5HZXRQcm9qZWN0QXVkaW9GaWxlVXJsKGIpIHx8IHRoaXMuX3JlbW90ZVVybHMuZ2V0KGIudG9Mb3dlckNhc2UoKSk7CiAgICAgICAgZCAmJiAodGhpcy5fcHJlbG9hZFRvdGFsKyssIGF3YWl0IHRoaXMuUG9zdFRvRE9NQXN5bmMoInByZWxvYWQiLCB7CiAgICAgICAgICAgIG9yaWdpbmFsVXJsOiBiLAogICAgICAgICAgICB1cmw6IGQudXJsLAogICAgICAgICAgICB0eXBlOiBkLnR5cGUsCiAgICAgICAgICAgIGlzTXVzaWM6IGEKICAgICAgICB9KSwgdGhpcy5fcHJlbG9hZENvdW50KyspCiAgICB9LAogICAgU2V0UGxheWJhY2tSYXRlKGEsIGIpIHsKICAgICAgICB0aGlzLlBvc3RUb0RPTSgic2V0LXBsYXliYWNrLXJhdGUiLCB7CiAgICAgICAgICAgIHRhZzogYS50b0xvd2VyQ2FzZSgpLAogICAgICAgICAgICByYXRlOiBNYXRoLm1heChiLCAwKQogICAgICAgIH0pCiAgICB9LAogICAgU3RvcChhKSB7CiAgICAgICAgdGhpcy5Qb3N0VG9ET00oInN0b3AiLCB7CiAgICAgICAgICAgIHRhZzogYS50b0xvd2VyQ2FzZSgpCiAgICAgICAgfSkKICAgIH0sCiAgICBTdG9wQWxsKCkgewogICAgICAgIHRoaXMuUG9zdFRvRE9NKCJzdG9wLWFsbCIpCiAgICB9LAogICAgU2V0UGF1c2VkKGEsIGIpIHsKICAgICAgICB0aGlzLlBvc3RUb0RPTSgic2V0LXBhdXNlZCIsIHsKICAgICAgICAgICAgdGFnOiBhLnRvTG93ZXJDYXNlKCksCiAgICAgICAgICAgIHBhdXNlZDogMCA9PT0gYgogICAgICAgIH0pCiAgICB9LAogICAgU2VlayhhLCBiKSB7CiAgICAgICAgdGhpcy5Qb3N0VG9ET00oInNlZWsiLCB7CiAgICAgICAgICAgIHRhZzogYS50b0xvd2VyQ2FzZSgpLAogICAgICAgICAgICBwb3M6IGIKICAgICAgICB9KQogICAgfSwKICAgIFNldFNpbGVudChhKSB7CiAgICAgICAgMiA9PT0gYSAmJiAoYSA9IHRoaXMuX2lzU2lsZW50ID8gMSA6IDApOwogICAgICAgIGEgPSAwID09PSBhOwogICAgICAgIHRoaXMuX2lzU2lsZW50ICE9PSBhICYmICh0aGlzLl9pc1NpbGVudCA9IGEsIHRoaXMuUG9zdFRvRE9NKCJzZXQtc2lsZW50IiwgewogICAgICAgICAgICBpc1NpbGVudDogYQogICAgICAgIH0pKQogICAgfSwKICAgIFNldE1hc3RlclZvbHVtZShhKSB7CiAgICAgICAgYSA9IHRoaXMuRGJUb0xpbmVhcihhKTsKICAgICAgICB0aGlzLl9tYXN0ZXJWb2x1bWUgIT09IGEgJiYgKHRoaXMuX21hc3RlclZvbHVtZSA9IGEsIHRoaXMuUG9zdFRvRE9NKCJzZXQtbWFzdGVyLXZvbHVtZSIsIHsKICAgICAgICAgICAgdm9sOiBhCiAgICAgICAgfSkpCiAgICB9LAogICAgQWRkRmlsdGVyRWZmZWN0KGEsCiAgICAgICAgYiwgZCwgYywgZSwgZywgaykgewogICAgICAgIGEgPSBhLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgYiA9IEZJTFRFUl9UWVBFU1tiXTsKICAgICAgICB0aGlzLl9JbmNyZW1lbnRFZmZlY3RDb3VudChhKTsKICAgICAgICB0aGlzLlBvc3RUb0RPTSgiYWRkLWVmZmVjdCIsIHsKICAgICAgICAgICAgdHlwZTogImZpbHRlciIsCiAgICAgICAgICAgIHRhZzogYSwKICAgICAgICAgICAgcGFyYW1zOiBbYiwgZCwgYywgZSwgZywgQzMkanNjb21wJDIxNC5jbGFtcChrIC8gMTAwLCAwLCAxKV0KICAgICAgICB9KQogICAgfSwKICAgIEFkZERlbGF5RWZmZWN0KGEsIGIsIGQsIGMpIHsKICAgICAgICBhID0gYS50b0xvd2VyQ2FzZSgpOwogICAgICAgIHRoaXMuX0luY3JlbWVudEVmZmVjdENvdW50KGEpOwogICAgICAgIHRoaXMuUG9zdFRvRE9NKCJhZGQtZWZmZWN0IiwgewogICAgICAgICAgICB0eXBlOiAiZGVsYXkiLAogICAgICAgICAgICB0YWc6IGEsCiAgICAgICAgICAgIHBhcmFtczogW2IsIHRoaXMuRGJUb0xpbmVhcihkKSwgQzMkanNjb21wJDIxNC5jbGFtcChjIC8gMTAwLCAwLCAxKV0KICAgICAgICB9KQogICAgfSwKICAgIEFkZEZsYW5nZXJFZmZlY3QoYSwgYiwgZCwgYywgZSwgZykgewogICAgICAgIGEgPSBhLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgdGhpcy5fSW5jcmVtZW50RWZmZWN0Q291bnQoYSk7CiAgICAgICAgdGhpcy5Qb3N0VG9ET00oImFkZC1lZmZlY3QiLCB7CiAgICAgICAgICAgIHR5cGU6ICJmbGFuZ2VyIiwKICAgICAgICAgICAgdGFnOiBhLAogICAgICAgICAgICBwYXJhbXM6IFtiIC8KICAgICAgICAgICAgICAgIDFFMywgZCAvIDFFMywgYywgZSAvIDEwMCwgQzMkanNjb21wJDIxNC5jbGFtcChnIC8gMTAwLCAwLCAxKQogICAgICAgICAgICBdCiAgICAgICAgfSkKICAgIH0sCiAgICBBZGRQaGFzZXJFZmZlY3QoYSwgYiwgZCwgYywgZSwgZywgaykgewogICAgICAgIGEgPSBhLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgdGhpcy5fSW5jcmVtZW50RWZmZWN0Q291bnQoYSk7CiAgICAgICAgdGhpcy5Qb3N0VG9ET00oImFkZC1lZmZlY3QiLCB7CiAgICAgICAgICAgIHR5cGU6ICJwaGFzZXIiLAogICAgICAgICAgICB0YWc6IGEsCiAgICAgICAgICAgIHBhcmFtczogW2IsIGQsIGMsIGUsIGcsIEMzJGpzY29tcCQyMTQuY2xhbXAoayAvIDEwMCwgMCwgMSldCiAgICAgICAgfSkKICAgIH0sCiAgICBBZGRDb252b2x1dGlvbkVmZmVjdChhLCBiLCBkLCBjKSB7CiAgICAgICAgYSA9IGEudG9Mb3dlckNhc2UoKTsKICAgICAgICBjb25zdCBlID0gdGhpcy5fcnVudGltZS5HZXRBc3NldE1hbmFnZXIoKS5HZXRQcm9qZWN0QXVkaW9GaWxlVXJsKGJbMF0pOwogICAgICAgIGUgJiYgKHRoaXMuX0luY3JlbWVudEVmZmVjdENvdW50KGEpLCB0aGlzLlBvc3RUb0RPTSgiYWRkLWVmZmVjdCIsIHsKICAgICAgICAgICAgdHlwZTogImNvbnZvbHV0aW9uIiwKICAgICAgICAgICAgdGFnOiBhLAogICAgICAgICAgICBidWZmZXJPcmlnaW5hbFVybDogYlswXSwKICAgICAgICAgICAgYnVmZmVyVXJsOiBlLnVybCwKICAgICAgICAgICAgYnVmZmVyVHlwZTogZS50eXBlLAogICAgICAgICAgICBwYXJhbXM6IFswID09PQogICAgICAgICAgICAgICAgZCwgQzMkanNjb21wJDIxNC5jbGFtcChjIC8gMTAwLCAwLCAxKQogICAgICAgICAgICBdCiAgICAgICAgfSkpCiAgICB9LAogICAgQWRkR2FpbkVmZmVjdChhLCBiKSB7CiAgICAgICAgYSA9IGEudG9Mb3dlckNhc2UoKTsKICAgICAgICB0aGlzLl9JbmNyZW1lbnRFZmZlY3RDb3VudChhKTsKICAgICAgICB0aGlzLlBvc3RUb0RPTSgiYWRkLWVmZmVjdCIsIHsKICAgICAgICAgICAgdHlwZTogImdhaW4iLAogICAgICAgICAgICB0YWc6IGEsCiAgICAgICAgICAgIHBhcmFtczogW3RoaXMuRGJUb0xpbmVhcihiKV0KICAgICAgICB9KQogICAgfSwKICAgIEFkZFN0ZXJlb1BhbkVmZmVjdChhLCBiKSB7CiAgICAgICAgYSA9IGEudG9Mb3dlckNhc2UoKTsKICAgICAgICB0aGlzLl9JbmNyZW1lbnRFZmZlY3RDb3VudChhKTsKICAgICAgICB0aGlzLlBvc3RUb0RPTSgiYWRkLWVmZmVjdCIsIHsKICAgICAgICAgICAgdHlwZTogInN0ZXJlb3BhbiIsCiAgICAgICAgICAgIHRhZzogYSwKICAgICAgICAgICAgcGFyYW1zOiBbQzMkanNjb21wJDIxNC5jbGFtcChiIC8gMTAwLCAtMSwgMSldCiAgICAgICAgfSkKICAgIH0sCiAgICBBZGRNdXRlRWZmZWN0KGEpIHsKICAgICAgICBhID0gYS50b0xvd2VyQ2FzZSgpOwogICAgICAgIHRoaXMuX0luY3JlbWVudEVmZmVjdENvdW50KGEpOwogICAgICAgIHRoaXMuUG9zdFRvRE9NKCJhZGQtZWZmZWN0IiwgewogICAgICAgICAgICB0eXBlOiAiZ2FpbiIsCiAgICAgICAgICAgIHRhZzogYSwKICAgICAgICAgICAgcGFyYW1zOiBbMF0KICAgICAgICB9KQogICAgfSwKICAgIEFkZFRyZW1vbG9FZmZlY3QoYSwgYiwgZCkgewogICAgICAgIGEgPQogICAgICAgICAgICBhLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgdGhpcy5fSW5jcmVtZW50RWZmZWN0Q291bnQoYSk7CiAgICAgICAgdGhpcy5Qb3N0VG9ET00oImFkZC1lZmZlY3QiLCB7CiAgICAgICAgICAgIHR5cGU6ICJ0cmVtb2xvIiwKICAgICAgICAgICAgdGFnOiBhLAogICAgICAgICAgICBwYXJhbXM6IFtiLCBDMyRqc2NvbXAkMjE0LmNsYW1wKGQgLyAxMDAsIDAsIDEpXQogICAgICAgIH0pCiAgICB9LAogICAgQWRkUmluZ01vZEVmZmVjdChhLCBiLCBkKSB7CiAgICAgICAgYSA9IGEudG9Mb3dlckNhc2UoKTsKICAgICAgICB0aGlzLl9JbmNyZW1lbnRFZmZlY3RDb3VudChhKTsKICAgICAgICB0aGlzLlBvc3RUb0RPTSgiYWRkLWVmZmVjdCIsIHsKICAgICAgICAgICAgdHlwZTogInJpbmdtb2QiLAogICAgICAgICAgICB0YWc6IGEsCiAgICAgICAgICAgIHBhcmFtczogW2IsIEMzJGpzY29tcCQyMTQuY2xhbXAoZCAvIDEwMCwgMCwgMSldCiAgICAgICAgfSkKICAgIH0sCiAgICBBZGREaXN0b3J0aW9uRWZmZWN0KGEsIGIsIGQsIGMsIGUsIGcpIHsKICAgICAgICBhID0gYS50b0xvd2VyQ2FzZSgpOwogICAgICAgIHRoaXMuX0luY3JlbWVudEVmZmVjdENvdW50KGEpOwogICAgICAgIHRoaXMuUG9zdFRvRE9NKCJhZGQtZWZmZWN0IiwgewogICAgICAgICAgICB0eXBlOiAiZGlzdG9ydGlvbiIsCiAgICAgICAgICAgIHRhZzogYSwKICAgICAgICAgICAgcGFyYW1zOiBbdGhpcy5EYlRvTGluZWFyTm9DYXAoYiksIHRoaXMuRGJUb0xpbmVhck5vQ2FwKGQpLCBjLCB0aGlzLkRiVG9MaW5lYXJOb0NhcChlKSwKICAgICAgICAgICAgICAgIEMzJGpzY29tcCQyMTQuY2xhbXAoZyAvIDEwMCwgMCwgMSkKICAgICAgICAgICAgXQogICAgICAgIH0pCiAgICB9LAogICAgQWRkQ29tcHJlc3NvckVmZmVjdChhLCBiLCBkLCBjLCBlLCBnKSB7CiAgICAgICAgYSA9IGEudG9Mb3dlckNhc2UoKTsKICAgICAgICB0aGlzLl9JbmNyZW1lbnRFZmZlY3RDb3VudChhKTsKICAgICAgICB0aGlzLlBvc3RUb0RPTSgiYWRkLWVmZmVjdCIsIHsKICAgICAgICAgICAgdHlwZTogImNvbXByZXNzb3IiLAogICAgICAgICAgICB0YWc6IGEsCiAgICAgICAgICAgIHBhcmFtczogW2IsIGQsIGMsIGUgLyAxRTMsIGcgLyAxRTNdCiAgICAgICAgfSkKICAgIH0sCiAgICBBZGRBbmFseXNlckVmZmVjdChhLCBiLCBkKSB7CiAgICAgICAgYSA9IGEudG9Mb3dlckNhc2UoKTsKICAgICAgICB0aGlzLl9JbmNyZW1lbnRFZmZlY3RDb3VudChhKTsKICAgICAgICB0aGlzLlBvc3RUb0RPTSgiYWRkLWVmZmVjdCIsIHsKICAgICAgICAgICAgdHlwZTogImFuYWx5c2VyIiwKICAgICAgICAgICAgdGFnOiBhLAogICAgICAgICAgICBwYXJhbXM6IFtiLCBkXQogICAgICAgIH0pCiAgICB9LAogICAgUmVtb3ZlRWZmZWN0cyhhKSB7CiAgICAgICAgYSA9IGEudG9Mb3dlckNhc2UoKTsKICAgICAgICB0aGlzLl9lZmZlY3RDb3VudC5zZXQoYSwgMCk7CiAgICAgICAgdGhpcy5Qb3N0VG9ET00oInJlbW92ZS1lZmZlY3RzIiwgewogICAgICAgICAgICB0YWc6IGEKICAgICAgICB9KTsKICAgICAgICB0aGlzLl9sYXN0RnhTdGF0ZSA9IHt9CiAgICB9LAogICAgU2V0RWZmZWN0UGFyYW1ldGVyKGEsIGIsIGQsIGMsIGUsIGcpIHsKICAgICAgICB0aGlzLlBvc3RUb0RPTSgic2V0LWVmZmVjdC1wYXJhbSIsIHsKICAgICAgICAgICAgdGFnOiBhLnRvTG93ZXJDYXNlKCksCiAgICAgICAgICAgIGluZGV4OiBNYXRoLmZsb29yKGIpLAogICAgICAgICAgICBwYXJhbTogZCwKICAgICAgICAgICAgdmFsdWU6IGMsCiAgICAgICAgICAgIHJhbXA6IGUsCiAgICAgICAgICAgIHRpbWU6IGcKICAgICAgICB9KQogICAgfSwKICAgIFNldExpc3RlbmVyT2JqZWN0KGEpIHsKICAgICAgICBhICYmIChhID0gYS5HZXRGaXJzdFBpY2tlZCgpKSAmJiBhLkdldFdvcmxkSW5mbygpICYmICh0aGlzLl9saXN0ZW5lckluc3QgPSBhKQogICAgfSwKICAgIFNldExpc3RlbmVyWihhKSB7CiAgICAgICAgdGhpcy5fbGlzdGVuZXJaID0gYQogICAgfSwKICAgIFNjaGVkdWxlTmV4dFBsYXkoYSkgewogICAgICAgIHRoaXMuX25leHRQbGF5VGltZSA9IE1hdGgubWF4KGEsIDApCiAgICB9LAogICAgVW5sb2FkQXVkaW8oYSkgewogICAgICAgIGNvbnN0IGIgPSBhWzFdOwogICAgICAgIChhID0gdGhpcy5fcnVudGltZS5HZXRBc3NldE1hbmFnZXIoKS5HZXRQcm9qZWN0QXVkaW9GaWxlVXJsKGFbMF0pKSAmJiB0aGlzLlBvc3RUb0RPTSgidW5sb2FkIiwgewogICAgICAgICAgICB1cmw6IGEudXJsLAogICAgICAgICAgICB0eXBlOiBhLnR5cGUsCiAgICAgICAgICAgIGlzTXVzaWM6IGIKICAgICAgICB9KQogICAgfSwKICAgIFVubG9hZEF1ZGlvQnlOYW1lKGEsIGIpIHsKICAgICAgICBhID0gMSA9PT0gYTsKICAgICAgICAoYiA9IHRoaXMuX3J1bnRpbWUuR2V0QXNzZXRNYW5hZ2VyKCkuR2V0UHJvamVjdEF1ZGlvRmlsZVVybChiKSB8fCB0aGlzLl9yZW1vdGVVcmxzLmdldChiLnRvTG93ZXJDYXNlKCkpKSAmJgogICAgICAgIHRoaXMuUG9zdFRvRE9NKCJ1bmxvYWQiLCB7CiAgICAgICAgICAgIHVybDogYi51cmwsCiAgICAgICAgICAgIHR5cGU6IGIudHlwZSwKICAgICAgICAgICAgaXNNdXNpYzogYQogICAgICAgIH0pCiAgICB9LAogICAgVW5sb2FkQWxsKCkgewogICAgICAgIHRoaXMuUG9zdFRvRE9NKCJ1bmxvYWQtYWxsIikKICAgIH0sCiAgICBBZGRSZW1vdGVVUkwoYSwgYiwgZCkgewogICAgICAgIHRoaXMuX3JlbW90ZVVybHMuc2V0KGQudG9Mb3dlckNhc2UoKSwgewogICAgICAgICAgICB1cmw6IGEsCiAgICAgICAgICAgIHR5cGU6IGIKICAgICAgICB9KQogICAgfQp9OwpzZWxmLkMzLlBsdWdpbnMuQXVkaW8uRXhwcyA9IHsKICAgIER1cmF0aW9uKGEpIHsKICAgICAgICByZXR1cm4gKGEgPSB0aGlzLl9HZXRGaXJzdEF1ZGlvU3RhdGVCeVRhZyhhKSkgPyBhLmR1cmF0aW9uIDogMAogICAgfSwKICAgIFBsYXliYWNrVGltZShhKSB7CiAgICAgICAgcmV0dXJuIChhID0gdGhpcy5fR2V0Rmlyc3RBdWRpb1N0YXRlQnlUYWcoYSkpID8gYS5wbGF5YmFja1RpbWUgOiAwCiAgICB9LAogICAgUGxheWJhY2tSYXRlKGEpIHsKICAgICAgICByZXR1cm4gKGEgPSB0aGlzLl9HZXRGaXJzdEF1ZGlvU3RhdGVCeVRhZyhhKSkgPyBhLnBsYXliYWNrUmF0ZSA6IDAKICAgIH0sCiAgICBWb2x1bWUoYSkgewogICAgICAgIHJldHVybiAoYSA9IHRoaXMuX0dldEZpcnN0QXVkaW9TdGF0ZUJ5VGFnKGEpKSA/IHRoaXMuTGluZWFyVG9EYihhLnZvbHVtZSkgOiAwCiAgICB9LAogICAgTWFzdGVyVm9sdW1lKCkgewogICAgICAgIHJldHVybiB0aGlzLkxpbmVhclRvRGIodGhpcy5fbWFzdGVyVm9sdW1lKQogICAgfSwKICAgIEVmZmVjdENvdW50KGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZWZmZWN0Q291bnQuZ2V0KGEudG9Mb3dlckNhc2UoKSkgfHwgMAogICAgfSwKICAgIEFuYWx5c2VyRnJlcUJpbkNvdW50KGEsIGIpIHsKICAgICAgICByZXR1cm4gKGEgPSB0aGlzLkdldEFuYWx5c2VyRGF0YShhLAogICAgICAgICAgICBNYXRoLmZsb29yKGIpKSkgPyBhLmJpbkNvdW50IDogMAogICAgfSwKICAgIEFuYWx5c2VyRnJlcUJpbkF0KGEsIGIsIGQpIHsKICAgICAgICBhID0gdGhpcy5HZXRBbmFseXNlckRhdGEoYSwgTWF0aC5mbG9vcihiKSk7CiAgICAgICAgaWYgKCFhKSByZXR1cm4gMDsKICAgICAgICBkID0gTWF0aC5mbG9vcihkKTsKICAgICAgICByZXR1cm4gMCA+IGQgfHwgZCA+PSBhLmJpbkNvdW50ID8gMCA6IGEuZnJlcUJpbnNbZF0KICAgIH0sCiAgICBBbmFseXNlclBlYWtMZXZlbChhLCBiKSB7CiAgICAgICAgcmV0dXJuIChhID0gdGhpcy5HZXRBbmFseXNlckRhdGEoYSwgTWF0aC5mbG9vcihiKSkpID8gYS5wZWFrIDogMAogICAgfSwKICAgIEFuYWx5c2VyUk1TTGV2ZWwoYSwgYikgewogICAgICAgIHJldHVybiAoYSA9IHRoaXMuR2V0QW5hbHlzZXJEYXRhKGEsIE1hdGguZmxvb3IoYikpKSA/IGEucm1zIDogMAogICAgfSwKICAgIFNhbXBsZVJhdGUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3NhbXBsZVJhdGUKICAgIH0sCiAgICBDdXJyZW50VGltZSgpIHsKICAgICAgICByZXR1cm4gc2VsZi5DM19HZXRBdWRpb0NvbnRleHRDdXJyZW50VGltZSA/IHNlbGYuQzNfR2V0QXVkaW9Db250ZXh0Q3VycmVudFRpbWUoKSA6IHBlcmZvcm1hbmNlLm5vdygpIC8gMUUzCiAgICB9LAogICAgT3V0cHV0TGF0ZW5jeSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fb3V0cHV0TGF0ZW5jeQogICAgfQp9OwoidXNlIHN0cmljdCI7CmNvbnN0IEMzJGpzY29tcCQyMTYgPSBzZWxmLkMzOwpDMyRqc2NvbXAkMjE2LlBsdWdpbnMuQnJvd3NlciA9IGNsYXNzIGV4dGVuZHMgQzMkanNjb21wJDIxNi5TREtQbHVnaW5CYXNlIHsKICAgIGNvbnN0cnVjdG9yKGEpIHsKICAgICAgICBzdXBlcihhKQogICAgfQogICAgUmVsZWFzZSgpIHsKICAgICAgICBzdXBlci5SZWxlYXNlKCkKICAgIH0KfTsKY29uc3QgQzMkanNjb21wJDIxNyA9IHNlbGYuQzM7CkMzJGpzY29tcCQyMTcuUGx1Z2lucy5Ccm93c2VyLlR5cGUgPSBjbGFzcyBleHRlbmRzIEMzJGpzY29tcCQyMTcuU0RLVHlwZUJhc2UgewogICAgY29uc3RydWN0b3IoYSkgewogICAgICAgIHN1cGVyKGEpCiAgICB9CiAgICBSZWxlYXNlKCkgewogICAgICAgIHN1cGVyLlJlbGVhc2UoKQogICAgfQogICAgT25DcmVhdGUoKSB7fQp9Owpjb25zdCBDMyRqc2NvbXAkMjE4ID0gc2VsZi5DMzsKQzMkanNjb21wJDIxOC5QbHVnaW5zLkJyb3dzZXIuSW5zdGFuY2UgPSBjbGFzcyBleHRlbmRzIEMzJGpzY29tcCQyMTguU0RLSW5zdGFuY2VCYXNlIHsKICAgIGNvbnN0cnVjdG9yKGEsIGIpIHsKICAgICAgICBzdXBlcihhLCAiYnJvd3NlciIpOwogICAgICAgIHRoaXMuX2luaXRMb2NhdGlvblN0ciA9ICIiOwogICAgICAgIHRoaXMuX2lzT25saW5lID0gITE7CiAgICAgICAgdGhpcy5fZG9jVGl0bGUgPSB0aGlzLl9yZWZlcnJlciA9ICIiOwogICAgICAgIHRoaXMuX2lzQ29va2llRW5hYmxlZCA9ICExOwogICAgICAgIHRoaXMuX3dpbmRvd091dGVySGVpZ2h0ID0gdGhpcy5fd2luZG93T3V0ZXJXaWR0aCA9IHRoaXMuX3NjcmVlbkhlaWdodCA9IHRoaXMuX3NjcmVlbldpZHRoID0gMDsKICAgICAgICB0aGlzLl9pc0NvbnN0cnVjdEFyY2FkZSA9ICExOwogICAgICAgIHRoaXMuX2Nzc1N0eWxlTWFwID0gbmV3IE1hcDsKICAgICAgICB0aGlzLkFkZERPTU1lc3NhZ2VIYW5kbGVycyhbCiAgICAgICAgICAgIFsib25saW5lLXN0YXRlIiwgZCA9PiB0aGlzLl9Pbk9ubGluZVN0YXRlQ2hhbmdlZChkKV0sCiAgICAgICAgICAgIFsiYmFja2J1dHRvbiIsICgpID0+IHRoaXMuX09uQmFja0J1dHRvbigpXSwKICAgICAgICAgICAgWyJzdy1tZXNzYWdlIiwgZCA9PiB0aGlzLl9PblNXTWVzc2FnZShkKV0sCiAgICAgICAgICAgIFsiaGFzaGNoYW5nZSIsIGQgPT4gdGhpcy5fT25IYXNoQ2hhbmdlKGQpXQogICAgICAgIF0pOwogICAgICAgIGEgPSB0aGlzLkdldFJ1bnRpbWUoKS5EaXNwYXRjaGVyKCk7CiAgICAgICAgdGhpcy5fZGlzcG9zYWJsZXMgPSBuZXcgQzMkanNjb21wJDIxOC5Db21wb3NpdGVEaXNwb3NhYmxlKEMzJGpzY29tcCQyMTguRGlzcG9zYWJsZS5Gcm9tKGEsICJhZnRlcmZpcnN0bGF5b3V0c3RhcnQiLCAoKSA9PiB0aGlzLl9PbkFmdGVyRmlyc3RMYXlvdXRTdGFydCgpKSwgQzMkanNjb21wJDIxOC5EaXNwb3NhYmxlLkZyb20oYSwgIndpbmRvdy1yZXNpemUiLCAoKSA9PiB0aGlzLl9PbldpbmRvd1Jlc2l6ZSgpKSwgQzMkanNjb21wJDIxOC5EaXNwb3NhYmxlLkZyb20oYSwgInN1c3BlbmQiLCAoKSA9PiB0aGlzLl9PblN1c3BlbmQoKSksIEMzJGpzY29tcCQyMTguRGlzcG9zYWJsZS5Gcm9tKGEsICJyZXN1bWUiLCAoKSA9PiB0aGlzLl9PblJlc3VtZSgpKSk7CiAgICAgICAgdGhpcy5fcnVudGltZS5BZGRMb2FkUHJvbWlzZSh0aGlzLlBvc3RUb0RPTUFzeW5jKCJnZXQtaW5pdGlhbC1zdGF0ZSIsIHsKICAgICAgICAgICAgZXhwb3J0VHlwZTogdGhpcy5fcnVudGltZS5HZXRFeHBvcnRUeXBlKCkKICAgICAgICB9KS50aGVuKGQgPT4gewogICAgICAgICAgICB0aGlzLl9pbml0TG9jYXRpb25TdHIgPSBkLmxvY2F0aW9uOwogICAgICAgICAgICB0aGlzLl9pc09ubGluZSA9IGQuaXNPbmxpbmU7CiAgICAgICAgICAgIHRoaXMuX3JlZmVycmVyID0gZC5yZWZlcnJlcjsKICAgICAgICAgICAgdGhpcy5fZG9jVGl0bGUgPSBkLnRpdGxlOwogICAgICAgICAgICB0aGlzLl9pc0Nvb2tpZUVuYWJsZWQgPSBkLmlzQ29va2llRW5hYmxlZDsKICAgICAgICAgICAgdGhpcy5fc2NyZWVuV2lkdGggPSBkLnNjcmVlbldpZHRoOwogICAgICAgICAgICB0aGlzLl9zY3JlZW5IZWlnaHQgPSBkLnNjcmVlbkhlaWdodDsKICAgICAgICAgICAgdGhpcy5fd2luZG93T3V0ZXJXaWR0aCA9IGQud2luZG93T3V0ZXJXaWR0aDsKICAgICAgICAgICAgdGhpcy5fd2luZG93T3V0ZXJIZWlnaHQgPSBkLndpbmRvd091dGVySGVpZ2h0OwogICAgICAgICAgICB0aGlzLl9pc0NvbnN0cnVjdEFyY2FkZSA9IGQuaXNDb25zdHJ1Y3RBcmNhZGUKICAgICAgICB9KSkKICAgIH0KICAgIFJlbGVhc2UoKSB7CiAgICAgICAgc3VwZXIuUmVsZWFzZSgpCiAgICB9CiAgICBfT25BZnRlckZpcnN0TGF5b3V0U3RhcnQoKSB7CiAgICAgICAgdGhpcy5Qb3N0VG9ET00oInJlYWR5LWZvci1zdy1tZXNzYWdlcyIpCiAgICB9CiAgICBhc3luYyBfT25PbmxpbmVTdGF0ZUNoYW5nZWQoYSkgewogICAgICAgIGEgPSAhIWEuaXNPbmxpbmU7CiAgICAgICAgdGhpcy5faXNPbmxpbmUgIT09CiAgICAgICAgICAgIGEgJiYgKCh0aGlzLl9pc09ubGluZSA9IGEpID8gYXdhaXQgdGhpcy5UcmlnZ2VyQXN5bmMoQzMkanNjb21wJDIxOC5QbHVnaW5zLkJyb3dzZXIuQ25kcy5Pbk9ubGluZSkgOiBhd2FpdCB0aGlzLlRyaWdnZXJBc3luYyhDMyRqc2NvbXAkMjE4LlBsdWdpbnMuQnJvd3Nlci5DbmRzLk9uT2ZmbGluZSkpCiAgICB9CiAgICBhc3luYyBfT25XaW5kb3dSZXNpemUoKSB7CiAgICAgICAgYXdhaXQgdGhpcy5UcmlnZ2VyQXN5bmMoQzMkanNjb21wJDIxOC5QbHVnaW5zLkJyb3dzZXIuQ25kcy5PblJlc2l6ZSkKICAgIH0KICAgIF9PblN1c3BlbmQoKSB7CiAgICAgICAgdGhpcy5UcmlnZ2VyKEMzJGpzY29tcCQyMTguUGx1Z2lucy5Ccm93c2VyLkNuZHMuT25QYWdlSGlkZGVuKQogICAgfQogICAgX09uUmVzdW1lKCkgewogICAgICAgIHRoaXMuVHJpZ2dlcihDMyRqc2NvbXAkMjE4LlBsdWdpbnMuQnJvd3Nlci5DbmRzLk9uUGFnZVZpc2libGUpCiAgICB9CiAgICBhc3luYyBfT25CYWNrQnV0dG9uKCkgewogICAgICAgIGF3YWl0IHRoaXMuVHJpZ2dlckFzeW5jKEMzJGpzY29tcCQyMTguUGx1Z2lucy5Ccm93c2VyLkNuZHMuT25CYWNrQnV0dG9uKQogICAgfQogICAgX09uU1dNZXNzYWdlKGEpIHsKICAgICAgICBhID0KICAgICAgICAgICAgYS50eXBlOwogICAgICAgICJkb3dubG9hZGluZy11cGRhdGUiID09PSBhID8gdGhpcy5UcmlnZ2VyKEMzJGpzY29tcCQyMTguUGx1Z2lucy5Ccm93c2VyLkNuZHMuT25VcGRhdGVGb3VuZCkgOiAidXBkYXRlLXJlYWR5IiA9PT0gYSB8fCAidXBkYXRlLXBlbmRpbmciID09PSBhID8gdGhpcy5UcmlnZ2VyKEMzJGpzY29tcCQyMTguUGx1Z2lucy5Ccm93c2VyLkNuZHMuT25VcGRhdGVSZWFkeSkgOiAib2ZmbGluZS1yZWFkeSIgPT09IGEgJiYgdGhpcy5UcmlnZ2VyKEMzJGpzY29tcCQyMTguUGx1Z2lucy5Ccm93c2VyLkNuZHMuT25PZmZsaW5lUmVhZHkpCiAgICB9CiAgICBfT25IYXNoQ2hhbmdlKGEpIHsKICAgICAgICB0aGlzLl9pbml0TG9jYXRpb25TdHIgPSBhLmxvY2F0aW9uOwogICAgICAgIHRoaXMuVHJpZ2dlcihDMyRqc2NvbXAkMjE4LlBsdWdpbnMuQnJvd3Nlci5DbmRzLk9uSGFzaENoYW5nZSkKICAgIH0KICAgIEdldERlYnVnZ2VyUHJvcGVydGllcygpIHsKICAgICAgICByZXR1cm4gW3sKICAgICAgICAgICAgdGl0bGU6ICJwbHVnaW5zLmJyb3dzZXIubmFtZSIsCiAgICAgICAgICAgIHByb3BlcnRpZXM6IFt7CiAgICAgICAgICAgICAgICBuYW1lOiAicGx1Z2lucy5icm93c2VyLmRlYnVnZ2VyLnVzZXItYWdlbnQiLAogICAgICAgICAgICAgICAgdmFsdWU6IG5hdmlnYXRvci51c2VyQWdlbnQKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgbmFtZTogInBsdWdpbnMuYnJvd3Nlci5kZWJ1Z2dlci5pcy1vbmxpbmUiLAogICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuX2lzT25saW5lCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgIG5hbWU6ICJwbHVnaW5zLmJyb3dzZXIuZGVidWdnZXIuaXMtZnVsbHNjcmVlbiIsCiAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5fcnVudGltZS5HZXRDYW52YXNNYW5hZ2VyKCkuSXNEb2N1bWVudEZ1bGxzY3JlZW4oKQogICAgICAgICAgICB9XQogICAgICAgIH1dCiAgICB9Cn07CnNlbGYuQzMuUGx1Z2lucy5Ccm93c2VyLkNuZHMgPSB7CiAgICBJc09ubGluZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5faXNPbmxpbmUKICAgIH0sCiAgICBPbk9ubGluZSgpIHsKICAgICAgICByZXR1cm4gITAKICAgIH0sCiAgICBPbk9mZmxpbmUoKSB7CiAgICAgICAgcmV0dXJuICEwCiAgICB9LAogICAgT25SZXNpemUoKSB7CiAgICAgICAgcmV0dXJuICEwCiAgICB9LAogICAgQ29va2llc0VuYWJsZWQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2lzQ29va2llRW5hYmxlZAogICAgfSwKICAgIElzRnVsbHNjcmVlbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcnVudGltZS5HZXRDYW52YXNNYW5hZ2VyKCkuSXNEb2N1bWVudEZ1bGxzY3JlZW4oKQogICAgfSwKICAgIE9uQmFja0J1dHRvbigpIHsKICAgICAgICByZXR1cm4gITAKICAgIH0sCiAgICBJc1BvcnRyYWl0TGFuZHNjYXBlKGEpIHsKICAgICAgICBjb25zdCBiID0gdGhpcy5fcnVudGltZS5HZXRDYW52YXNNYW5hZ2VyKCkuR2V0TGFzdFdpZHRoKCksCiAgICAgICAgICAgIGQgPSB0aGlzLl9ydW50aW1lLkdldENhbnZhc01hbmFnZXIoKS5HZXRMYXN0SGVpZ2h0KCk7CiAgICAgICAgcmV0dXJuIChiIDw9IGQgPyAwIDogMSkgPT09IGEKICAgIH0sCiAgICBPblVwZGF0ZUZvdW5kKCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIE9uVXBkYXRlUmVhZHkoKSB7CiAgICAgICAgcmV0dXJuICEwCiAgICB9LAogICAgT25PZmZsaW5lUmVhZHkoKSB7CiAgICAgICAgcmV0dXJuICEwCiAgICB9LAogICAgT25IYXNoQ2hhbmdlKCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIFBhZ2VWaXNpYmxlKCkgewogICAgICAgIHJldHVybiAhdGhpcy5fcnVudGltZS5Jc1N1c3BlbmRlZCgpCiAgICB9LAogICAgT25QYWdlSGlkZGVuKCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIE9uUGFnZVZpc2libGUoKSB7CiAgICAgICAgcmV0dXJuICEwCiAgICB9LAogICAgSGFzSmF2YSgpIHsKICAgICAgICByZXR1cm4gITEKICAgIH0sCiAgICBJc0Rvd25sb2FkaW5nVXBkYXRlKCkgewogICAgICAgIHJldHVybiAhMQogICAgfSwKICAgIE9uTWVudUJ1dHRvbigpIHsKICAgICAgICByZXR1cm4gITEKICAgIH0sCiAgICBPblNlYXJjaEJ1dHRvbigpIHsKICAgICAgICByZXR1cm4gITEKICAgIH0sCiAgICBJc01ldGVyZWQoKSB7CiAgICAgICAgcmV0dXJuICExCiAgICB9LAogICAgSXNDaGFyZ2luZygpIHsKICAgICAgICByZXR1cm4gITAKICAgIH0sCiAgICBTdXBwb3J0c0Z1bGxzY3JlZW4oKSB7CiAgICAgICAgcmV0dXJuICEwCiAgICB9Cn07CmNvbnN0IEMzJGpzY29tcCQyMjAgPSBzZWxmLkMzLAogICAgT1JJRU5UQVRJT05TID0gInBvcnRyYWl0IGxhbmRzY2FwZSBwb3J0cmFpdC1wcmltYXJ5IHBvcnRyYWl0LXNlY29uZGFyeSBsYW5kc2NhcGUtcHJpbWFyeSBsYW5kc2NhcGUtc2Vjb25kYXJ5Ii5zcGxpdCgiICIpOwpDMyRqc2NvbXAkMjIwLlBsdWdpbnMuQnJvd3Nlci5BY3RzID0gewogICAgQWxlcnQoYSkgewogICAgICAgIHRoaXMuUG9zdFRvRE9NKCJhbGVydCIsIHsKICAgICAgICAgICAgbWVzc2FnZTogYS50b1N0cmluZygpCiAgICAgICAgfSkKICAgIH0sCiAgICBDbG9zZSgpIHsKICAgICAgICB0aGlzLl9pc0NvbnN0cnVjdEFyY2FkZSB8fCAodGhpcy5fcnVudGltZS5Jc0RlYnVnKCkgPyBzZWxmLkMzRGVidWdnZXIuQ2xvc2VXaW5kb3coKSA6IHRoaXMuUG9zdFRvRE9NKCJjbG9zZSIpKQogICAgfSwKICAgIEZvY3VzKCkgewogICAgICAgIHRoaXMuUG9zdFRvRE9NKCJzZXQtZm9jdXMiLCB7CiAgICAgICAgICAgIGlzRm9jdXM6ICEwCiAgICAgICAgfSkKICAgIH0sCiAgICBCbHVyKCkgewogICAgICAgIHRoaXMuUG9zdFRvRE9NKCJzZXQtZm9jdXMiLCB7CiAgICAgICAgICAgIGlzRm9jdXM6ICExCiAgICAgICAgfSkKICAgIH0sCiAgICBHb0JhY2soKSB7CiAgICAgICAgdGhpcy5faXNDb25zdHJ1Y3RBcmNhZGUgfHwgdGhpcy5Qb3N0VG9ET00oIm5hdmlnYXRlIiwgewogICAgICAgICAgICB0eXBlOiAiYmFjayIKICAgICAgICB9KQogICAgfSwKICAgIEdvRm9yd2FyZCgpIHsKICAgICAgICB0aGlzLl9pc0NvbnN0cnVjdEFyY2FkZSB8fCB0aGlzLlBvc3RUb0RPTSgibmF2aWdhdGUiLCB7CiAgICAgICAgICAgIHR5cGU6ICJmb3J3YXJkIgogICAgICAgIH0pCiAgICB9LAogICAgR29Ib21lKCkge30sCiAgICBSZWxvYWQoKSB7CiAgICAgICAgdGhpcy5faXNDb25zdHJ1Y3RBcmNhZGUgfHwKICAgICAgICAgICAgKHRoaXMuX3J1bnRpbWUuSXNEZWJ1ZygpID8gdGhpcy5fcnVudGltZS5Qb3N0VG9EZWJ1Z2dlcih7CiAgICAgICAgICAgICAgICB0eXBlOiAicmVsb2FkIgogICAgICAgICAgICB9KSA6IHRoaXMuUG9zdFRvRE9NKCJuYXZpZ2F0ZSIsIHsKICAgICAgICAgICAgICAgIHR5cGU6ICJyZWxvYWQiCiAgICAgICAgICAgIH0pKQogICAgfSwKICAgIEdvVG9VUkwoYSwgYikgewogICAgICAgIHRoaXMuX1Bvc3RUb0RPTU1heWJlU3luYygibmF2aWdhdGUiLCB7CiAgICAgICAgICAgIHR5cGU6ICJ1cmwiLAogICAgICAgICAgICB1cmw6IGEsCiAgICAgICAgICAgIHRhcmdldDogYiwKICAgICAgICAgICAgZXhwb3J0VHlwZTogdGhpcy5fcnVudGltZS5HZXRFeHBvcnRUeXBlKCkKICAgICAgICB9KQogICAgfSwKICAgIEdvVG9VUkxXaW5kb3coYSwgYikgewogICAgICAgIHRoaXMuX1Bvc3RUb0RPTU1heWJlU3luYygibmF2aWdhdGUiLCB7CiAgICAgICAgICAgIHR5cGU6ICJuZXctd2luZG93IiwKICAgICAgICAgICAgdXJsOiBhLAogICAgICAgICAgICB0YWc6IGIsCiAgICAgICAgICAgIGV4cG9ydFR5cGU6IHRoaXMuX3J1bnRpbWUuR2V0RXhwb3J0VHlwZSgpCiAgICAgICAgfSkKICAgIH0sCiAgICBSZXF1ZXN0RnVsbFNjcmVlbihhLCBiKSB7CiAgICAgICAgMiA8PSBhICYmIChhICs9IDEpOwogICAgICAgIDYgPT09IGEgJiYgKGEgPSAyKTsKICAgICAgICAxID09PSBhICYmIChhID0gMCk7CiAgICAgICAgYSA9IEMzJGpzY29tcCQyMjAuQ2FudmFzTWFuYWdlci5fRnVsbHNjcmVlbk1vZGVOdW1iZXJUb1N0cmluZyhhKTsKICAgICAgICB0aGlzLl9ydW50aW1lLkdldENhbnZhc01hbmFnZXIoKS5TZXREb2N1bWVudEZ1bGxzY3JlZW5Nb2RlKGEpOwogICAgICAgIHRoaXMuX1Bvc3RUb0RPTU1heWJlU3luYygicmVxdWVzdC1mdWxsc2NyZWVuIiwgewogICAgICAgICAgICBuYXZVSTogYgogICAgICAgIH0pCiAgICB9LAogICAgQ2FuY2VsRnVsbFNjcmVlbigpIHsKICAgICAgICB0aGlzLl9Qb3N0VG9ET01NYXliZVN5bmMoImV4aXQtZnVsbHNjcmVlbiIpCiAgICB9LAogICAgVmlicmF0ZShhKSB7CiAgICAgICAgYSA9IGEuc3BsaXQoIiwiKTsKICAgICAgICBmb3IgKGxldCBiID0gMCwgZCA9IGEubGVuZ3RoOyBiIDwgZDsgKytiKSBhW2JdID0gcGFyc2VJbnQoYVtiXSwgMTApOwogICAgICAgIHRoaXMuX1Bvc3RUb0RPTU1heWJlU3luYygidmlicmF0ZSIsIHsKICAgICAgICAgICAgcGF0dGVybjogYQogICAgICAgIH0pCiAgICB9LAogICAgYXN5bmMgSW52b2tlRG93bmxvYWQoYSwgYikgewogICAgICAgIGEgJiYgYiAmJiAoYSA9IGF3YWl0IHRoaXMuX3J1bnRpbWUuR2V0QXNzZXRNYW5hZ2VyKCkuR2V0UHJvamVjdEZpbGVVcmwoYSksIHRoaXMuX3J1bnRpbWUuSW52b2tlRG93bmxvYWQoYSwgYikpCiAgICB9LAogICAgSW52b2tlRG93bmxvYWRTdHJpbmcoYSwgYiwgZCkgewogICAgICAgIGQgJiYgKGEgPSBgZGF0YToke2J9LCR7ZW5jb2RlVVJJQ29tcG9uZW50KGEpfWAsIHRoaXMuX3J1bnRpbWUuSW52b2tlRG93bmxvYWQoYSwgZCkpCiAgICB9LAogICAgQ29uc29sZUxvZyhhLAogICAgICAgIGIpIHsKICAgICAgICBiID0gYi50b1N0cmluZygpOwogICAgICAgIDAgPT09IGEgPyBjb25zb2xlLmxvZyhiKSA6IDEgPT09IGEgPyBjb25zb2xlLndhcm4oYikgOiAyID09PSBhICYmIGNvbnNvbGUuZXJyb3IoYikKICAgIH0sCiAgICBDb25zb2xlR3JvdXAoYSkgewogICAgICAgIGNvbnNvbGUuZ3JvdXAoYSkKICAgIH0sCiAgICBDb25zb2xlR3JvdXBFbmQoKSB7CiAgICAgICAgY29uc29sZS5ncm91cEVuZCgpCiAgICB9LAogICAgRXhlY0pzKGEpIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBldmFsKGEpCiAgICAgICAgfSBjYXRjaCAoYikgewogICAgICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBleGVjdXRpbmcgSmF2YVNjcmlwdDogIiwgYikKICAgICAgICB9CiAgICB9LAogICAgTG9ja09yaWVudGF0aW9uKGEpIHsKICAgICAgICBhID0gTWF0aC5mbG9vcihhKTsKICAgICAgICAwID4gYSB8fCBhID49IE9SSUVOVEFUSU9OUy5sZW5ndGggfHwgdGhpcy5fUG9zdFRvRE9NTWF5YmVTeW5jKCJsb2NrLW9yaWVudGF0aW9uIiwgewogICAgICAgICAgICBvcmllbnRhdGlvbjogT1JJRU5UQVRJT05TW2FdCiAgICAgICAgfSkKICAgIH0sCiAgICBVbmxvY2tPcmllbnRhdGlvbigpIHsKICAgICAgICB0aGlzLl9Qb3N0VG9ET01NYXliZVN5bmMoInVubG9jay1vcmllbnRhdGlvbiIpCiAgICB9LAogICAgTG9hZFN0eWxlU2hlZXQoYSkgewogICAgICAgIHRoaXMuX3J1bnRpbWUuR2V0QXNzZXRNYW5hZ2VyKCkuTG9hZFN0eWxlU2hlZXQoYSkKICAgIH0sCiAgICBhc3luYyBTZXREb2N1bWVudENTU1N0eWxlKGEsIGIsIGQsIGMpIHsKICAgICAgICBhd2FpdCB0aGlzLlBvc3RUb0RPTUFzeW5jKCJzZXQtZG9jdW1lbnQtY3NzLXN0eWxlIiwgewogICAgICAgICAgICBwcm9wOiBDMyRqc2NvbXAkMjIwLkNTU1RvQ2FtZWxDYXNlKGEpLAogICAgICAgICAgICB2YWx1ZTogYiwKICAgICAgICAgICAgc2VsZWN0b3I6IGQsCiAgICAgICAgICAgICJpcy1hbGwiOiAwICE9PSBjCiAgICAgICAgfSkKICAgIH0sCiAgICBhc3luYyBHZXREb2N1bWVudENTU1N0eWxlKGEsIGIsIGQpIHsKICAgICAgICBhID0gYXdhaXQgdGhpcy5Qb3N0VG9ET01Bc3luYygiZ2V0LWRvY3VtZW50LWNzcy1zdHlsZSIsIHsKICAgICAgICAgICAgcHJvcDogYSwKICAgICAgICAgICAgc2VsZWN0b3I6IGIKICAgICAgICB9KTsKICAgICAgICBhLmlzT2sgJiYgdGhpcy5fY3NzU3R5bGVNYXAuc2V0KGQudG9Mb3dlckNhc2UoKSwgYS5yZXN1bHQudHJpbSgpKQogICAgfSwKICAgIFNldEhhc2goYSkgewogICAgICAgIHRoaXMuUG9zdFRvRE9NKCJzZXQtaGFzaCIsIHsKICAgICAgICAgICAgaGFzaDogYQogICAgICAgIH0pCiAgICB9Cn07CnNlbGYuQzMuUGx1Z2lucy5Ccm93c2VyLkV4cHMgPSB7CiAgICBVUkwoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUuSXNJbldvcmtlcigpID8gdGhpcy5faW5pdExvY2F0aW9uU3RyIDogbG9jYXRpb24udG9TdHJpbmcoKQogICAgfSwKICAgIFByb3RvY29sKCkgewogICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lLklzSW5Xb3JrZXIoKSA/IChuZXcgVVJMKHRoaXMuX2luaXRMb2NhdGlvblN0cikpLnByb3RvY29sIDogbG9jYXRpb24ucHJvdG9jb2wKICAgIH0sCiAgICBEb21haW4oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUuSXNJbldvcmtlcigpID8gKG5ldyBVUkwodGhpcy5faW5pdExvY2F0aW9uU3RyKSkuaG9zdG5hbWUgOiBsb2NhdGlvbi5ob3N0bmFtZQogICAgfSwKICAgIFBvcnQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUuSXNJbldvcmtlcigpID8gKG5ldyBVUkwodGhpcy5faW5pdExvY2F0aW9uU3RyKSkucG9ydCA6IGxvY2F0aW9uLnBvcnQKICAgIH0sCiAgICBQYXRoTmFtZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcnVudGltZS5Jc0luV29ya2VyKCkgPyAobmV3IFVSTCh0aGlzLl9pbml0TG9jYXRpb25TdHIpKS5wYXRobmFtZSA6CiAgICAgICAgICAgIGxvY2F0aW9uLnBhdGhuYW1lCiAgICB9LAogICAgSGFzaCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcnVudGltZS5Jc0luV29ya2VyKCkgPyAobmV3IFVSTCh0aGlzLl9pbml0TG9jYXRpb25TdHIpKS5oYXNoIDogbG9jYXRpb24uaGFzaAogICAgfSwKICAgIFF1ZXJ5U3RyaW5nKCkgewogICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lLklzSW5Xb3JrZXIoKSA/IChuZXcgVVJMKHRoaXMuX2luaXRMb2NhdGlvblN0cikpLnNlYXJjaCA6IGxvY2F0aW9uLnNlYXJjaAogICAgfSwKICAgIFF1ZXJ5UGFyYW0oYSkgewogICAgICAgIGNvbnN0IGIgPSB0aGlzLl9ydW50aW1lLklzSW5Xb3JrZXIoKSA/IChuZXcgVVJMKHRoaXMuX2luaXRMb2NhdGlvblN0cikpLnNlYXJjaCA6IGxvY2F0aW9uLnNlYXJjaDsKICAgICAgICByZXR1cm4gKGEgPSBSZWdFeHAoIls/Jl0iICsgYSArICI9KFteJl0qKSIpLmV4ZWMoYikpID8gZGVjb2RlVVJJQ29tcG9uZW50KGFbMV0ucmVwbGFjZSgvXCsvZywgIiAiKSkgOiAiIgogICAgfSwKICAgIFJlZmVycmVyKCkgewogICAgICAgIHJldHVybiB0aGlzLl9yZWZlcnJlcgogICAgfSwKICAgIFRpdGxlKCkgewogICAgICAgIHJldHVybiB0aGlzLl9kb2NUaXRsZQogICAgfSwKICAgIExhbmd1YWdlKCkgewogICAgICAgIHJldHVybiBuYXZpZ2F0b3IubGFuZ3VhZ2UKICAgIH0sCiAgICBQbGF0Zm9ybSgpIHsKICAgICAgICByZXR1cm4gbmF2aWdhdG9yLnBsYXRmb3JtCiAgICB9LAogICAgVXNlckFnZW50KCkgewogICAgICAgIHJldHVybiBuYXZpZ2F0b3IudXNlckFnZW50CiAgICB9LAogICAgRXhlY0pTKGEpIHsKICAgICAgICBsZXQgYiA9IDA7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYiA9IGV2YWwoYSkKICAgICAgICB9IGNhdGNoIChkKSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIGV4ZWN1dGluZyBKYXZhU2NyaXB0OiAiLCBkKQogICAgICAgIH0KICAgICAgICByZXR1cm4gIm51bWJlciIgPT09IHR5cGVvZiBiIHx8ICJzdHJpbmciID09PSB0eXBlb2YgYiA/IGIgOiAiYm9vbGVhbiIgPT09IHR5cGVvZiBiID8gYiA/IDEgOiAwIDogMAogICAgfSwKICAgIENTU1N0eWxlVmFsdWUoYSkgewogICAgICAgIHJldHVybiB0aGlzLl9jc3NTdHlsZU1hcC5nZXQoYSkgfHwgIiIKICAgIH0sCiAgICBOYW1lKCkgewogICAgICAgIHJldHVybiBuYXZpZ2F0b3IuYXBwTmFtZQogICAgfSwKICAgIFZlcnNpb24oKSB7CiAgICAgICAgcmV0dXJuIG5hdmlnYXRvci5hcHBWZXJzaW9uCiAgICB9LAogICAgUHJvZHVjdCgpIHsKICAgICAgICByZXR1cm4gbmF2aWdhdG9yLnByb2R1Y3QKICAgIH0sCiAgICBWZW5kb3IoKSB7CiAgICAgICAgcmV0dXJuIG5hdmlnYXRvci52ZW5kb3IKICAgIH0sCiAgICBCYXR0ZXJ5TGV2ZWwoKSB7CiAgICAgICAgcmV0dXJuIDEKICAgIH0sCiAgICBCYXR0ZXJ5VGltZUxlZnQoKSB7CiAgICAgICAgcmV0dXJuIEluZmluaXR5CiAgICB9LAogICAgQmFuZHdpZHRoKCkgewogICAgICAgIGNvbnN0IGEgPSBuYXZpZ2F0b3IuY29ubmVjdGlvbjsKICAgICAgICByZXR1cm4gYSA/IGEuZG93bmxpbmsgfHwgYS5kb3dubGlua01heCB8fCBhLmJhbmR3aWR0aCB8fCBJbmZpbml0eSA6IEluZmluaXR5CiAgICB9LAogICAgQ29ubmVjdGlvblR5cGUoKSB7CiAgICAgICAgY29uc3QgYSA9IG5hdmlnYXRvci5jb25uZWN0aW9uOwogICAgICAgIHJldHVybiBhID8gYS50eXBlIHx8ICJ1bmtub3duIiA6ICJ1bmtub3duIgogICAgfSwKICAgIERldmljZVBpeGVsUmF0aW8oKSB7CiAgICAgICAgcmV0dXJuIHNlbGYuZGV2aWNlUGl4ZWxSYXRpbwogICAgfSwKICAgIFNjcmVlbldpZHRoKCkgewogICAgICAgIHJldHVybiB0aGlzLl9zY3JlZW5XaWR0aAogICAgfSwKICAgIFNjcmVlbkhlaWdodCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fc2NyZWVuSGVpZ2h0CiAgICB9LAogICAgV2luZG93SW5uZXJXaWR0aCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcnVudGltZS5HZXRDYW52YXNNYW5hZ2VyKCkuR2V0TGFzdFdpZHRoKCkKICAgIH0sCiAgICBXaW5kb3dJbm5lckhlaWdodCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcnVudGltZS5HZXRDYW52YXNNYW5hZ2VyKCkuR2V0TGFzdEhlaWdodCgpCiAgICB9LAogICAgV2luZG93T3V0ZXJXaWR0aCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fd2luZG93T3V0ZXJXaWR0aAogICAgfSwKICAgIFdpbmRvd091dGVySGVpZ2h0KCkgewogICAgICAgIHJldHVybiB0aGlzLl93aW5kb3dPdXRlcldpZHRoCiAgICB9Cn07CiJ1c2Ugc3RyaWN0IjsKQzMuUGx1Z2lucy5FcG9uZXNoX0dhbWVTY29yZSA9IGNsYXNzIGV4dGVuZHMgQzMuU0RLUGx1Z2luQmFzZSB7CiAgICBjb25zdHJ1Y3RvcihhKSB7CiAgICAgICAgc3VwZXIoYSwgIkVwb25lc2hfR2FtZVNjb3JlIikKICAgIH0KICAgIFJlbGVhc2UoKSB7CiAgICAgICAgc3VwZXIuUmVsZWFzZSgpCiAgICB9Cn07CiJ1c2Ugc3RyaWN0IjsKQzMuUGx1Z2lucy5FcG9uZXNoX0dhbWVTY29yZS5UeXBlID0gY2xhc3MgZXh0ZW5kcyBDMy5TREtUeXBlQmFzZSB7CiAgICBjb25zdHJ1Y3RvcihhKSB7CiAgICAgICAgc3VwZXIoYSkKICAgIH0KICAgIFJlbGVhc2UoKSB7CiAgICAgICAgc3VwZXIuUmVsZWFzZSgpCiAgICB9CiAgICBPbkNyZWF0ZSgpIHt9Cn07CiJ1c2Ugc3RyaWN0IjsKQzMuUGx1Z2lucy5FcG9uZXNoX0dhbWVTY29yZS5JbnN0YW5jZSA9IGNsYXNzIGV4dGVuZHMgQzMuU0RLSW5zdGFuY2VCYXNlIHsKICAgIGNvbnN0cnVjdG9yKGEsIGIpIHsKICAgICAgICBpZiAoc3VwZXIoYSksIHRoaXMubWFwcGVycyA9IHsKICAgICAgICAgICAgICAgIGxhbmd1YWdlOiAiZW4gcnUgZnIgaXQgZGUgZXMgemggcHQga28gamEgdHIgYXIgaGkgaWQiLnNwbGl0KCIgIiksCiAgICAgICAgICAgICAgICBhdmF0YXJHZW5lcmF0b3I6ICJkaWNlYmVhcl9yZXRybyBkaWNlYmVhcl9pZGVudGljb24gZGljZWJlYXJfaHVtYW4gZGljZWJlYXJfbWljYWggZGljZWJlYXJfYm90dHRzIGljb3RhciByb2JvaGFzaF9yb2JvdHMgcm9ib2hhc2hfY2F0cyIuc3BsaXQoIiAiKSwKICAgICAgICAgICAgICAgIG9yZGVyOiBbImRlZmF1bHQiLCAiREVTQyIsICJBU0MiXSwKICAgICAgICAgICAgICAgIHdpdGhNZTogWyJub25lIiwgImZpcnN0IiwgImxhc3QiXSwKICAgICAgICAgICAgICAgIHBsYXRmb3JtOiAiWUFOREVYIFZLIE5PTkUgT0sgR0FNRV9NT05FVElaRSBDUkFaWV9HQU1FUyBHQU1FX0RJU1RSSUJVVElPTiBTTUFSVE1BUktFVCBHQU1FUElYIFBPS0kgVktfUExBWSIuc3BsaXQoIiAiKSwKICAgICAgICAgICAgICAgIGRvY3VtZW50VHlwZXM6IFsiUExBWUVSX1BSSVZBQ1lfUE9MSUNZIl0sCiAgICAgICAgICAgICAgICBkb2N1bWVudEZvcm1hdDogWyJIVE1MIiwgIlRYVCIsICJSQVciXSwKICAgICAgICAgICAgICAgIHZhcmlhYmxlc1R5cGVzOiAic3RhdHMgZGF0YSBmbGFnIGltYWdlIGZpbGUgZG9jX2h0bWwiLnNwbGl0KCIgIiksCiAgICAgICAgICAgICAgICBjb21wYXJlOiBbKGQsIGMpID0+IGQgPT09IGMsIChkLCBjKSA9PiBkICE9PSBjLCAoZCwgYykgPT4gZCA8IGMsIChkLCBjKSA9PiBkIDw9IGMsIChkLCBjKSA9PiBjIDwgZCwgKGQsIGMpID0+IGMgPD0gZF0KICAgICAgICAgICAgfSwgdGhpcy5ldG9zID0gZnVuY3Rpb24oZCkgewogICAgICAgICAgICAgICAgcmV0dXJuICJzdHJpbmciID09IHR5cGVvZiBkID8gZCA6ICJtZXNzYWdlIiBpbiBkID8gZC5tZXNzYWdlIDogU3RyaW5nKGQpCiAgICAgICAgICAgIH0sIHRoaXMuY29uZGl0aW9ucyA9IEMzLlBsdWdpbnMuRXBvbmVzaF9HYW1lU2NvcmUuQ25kcywgdGhpcy5hY3Rpb25zID0gQzMuUGx1Z2lucy5FcG9uZXNoX0dhbWVTY29yZS5BY3RzLCB0aGlzLmhhbmRsZVJlc3VsdCA9IChkLCBjKSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLmlzTGFzdEFjdGlvblN1Y2Nlc3MgPSAhIWQ7CiAgICAgICAgICAgICAgICBjICYmICh0aGlzLmxhc3RFcnJvciA9IHRoaXMuZXRvcyhjKSwgY29uc29sZS53YXJuKGMpKQogICAgICAgICAgICB9LAogICAgICAgICAgICB0aGlzLmF3YWl0ZXJzID0gewogICAgICAgICAgICAgICAgcGxheWVyOiB7fSwKICAgICAgICAgICAgICAgIGdwOiB7fQogICAgICAgICAgICB9LCB0aGlzLmF3YWl0ZXJzLmdwLnJlYWR5ID0gbmV3IFByb21pc2UoKGQsIGMpID0+IHsKICAgICAgICAgICAgICAgIHRoaXMuYXdhaXRlcnMuZ3AuZG9uZSA9IGQ7CiAgICAgICAgICAgICAgICB0aGlzLmF3YWl0ZXJzLmdwLmFib3J0ID0gYwogICAgICAgICAgICB9KSwgdGhpcy5hd2FpdGVycy5wbGF5ZXIucmVhZHkgPSBuZXcgUHJvbWlzZSgoZCwgYykgPT4gewogICAgICAgICAgICAgICAgdGhpcy5hd2FpdGVycy5wbGF5ZXIuZG9uZSA9IGQ7CiAgICAgICAgICAgICAgICB0aGlzLmF3YWl0ZXJzLnBsYXllci5hYm9ydCA9IGMKICAgICAgICAgICAgfSksIHRoaXMubGVhZGVyYm9hcmQgPSBbXSwgdGhpcy5sZWFkZXJib2FyZEluZm8gPSB7fSwgdGhpcy5sZWFkZXJib2FyZFJlY29yZHMgPSB7fSwgdGhpcy5jdXJyZW50TGVhZGVyYm9hcmRJbmRleCA9IDAsIHRoaXMuY3VycmVudExlYWRlcmJvYXJkUGxheWVyID0ge30sIHRoaXMubGFzdExlYWRlcmJvYXJkVGFnID0gIiIsIHRoaXMubGFzdExlYWRlcmJvYXJkVmFyaWFudCA9ICIiLCB0aGlzLmxhc3RMZWFkZXJib2FyZFBsYXllclJhdGluZ1RhZyA9ICIiLCB0aGlzLmxlYWRlcmJvYXJkUGxheWVyUG9zaXRpb24gPSAwLCB0aGlzLmN1cnJlbnRQbGF5ZXJGaWVsZEtleSA9CiAgICAgICAgICAgICIiLCB0aGlzLmN1cnJlbnRQbGF5ZXJGaWVsZFR5cGUgPSAiIiwgdGhpcy5jdXJyZW50UGxheWVyRmllbGROYW1lID0gIiIsIHRoaXMuY3VycmVudFBsYXllckZpZWxkVmFsdWUgPSAiIiwgdGhpcy5jdXJyZW50UGxheWVyRmllbGRWYXJpYW50VmFsdWUgPSAiIiwgdGhpcy5jdXJyZW50UGxheWVyRmllbGRWYXJpYW50TmFtZSA9ICIiLCB0aGlzLmN1cnJlbnRQbGF5ZXJGaWVsZFZhcmlhbnRJbmRleCA9IDAsIHRoaXMuYWNoaWV2ZW1lbnRzID0gW10sIHRoaXMuYWNoaWV2ZW1lbnRzR3JvdXBzID0gW10sIHRoaXMucGxheWVyQWNoaWV2ZW1lbnRzID0gW10sIHRoaXMuY3VycmVudEFjaGlldmVtZW50SW5kZXggPSAwLCB0aGlzLmN1cnJlbnRBY2hpZXZlbWVudCA9IHt9LCB0aGlzLmN1cnJlbnRBY2hpZXZlbWVudHNHcm91cEluZGV4ID0gMCwgdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnRzR3JvdXBJZCA9IDAsIHRoaXMuY3VycmVudEFjaGlldmVtZW50c0dyb3VwVGFnID0gIiIsIHRoaXMuY3VycmVudEFjaGlldmVtZW50c0dyb3VwTmFtZSA9ICIiLCB0aGlzLmN1cnJlbnRBY2hpZXZlbWVudHNHcm91cERlc2NyaXB0aW9uID0KICAgICAgICAgICAgIiIsIHRoaXMuY3VycmVudFBsYXllckFjaGlldmVtZW50SW5kZXggPSAwLCB0aGlzLmN1cnJlbnRQbGF5ZXJBY2hpZXZlbWVudElkID0gMCwgdGhpcy5jdXJyZW50UGxheWVyQWNoaWV2ZW1lbnRVbmxvY2tEYXRlID0gIiIsIHRoaXMuaXNVbmxvY2tBY2hpZXZlbWVudFN1Y2Nlc3MgPSAhMSwgdGhpcy51bmxvY2tBY2hpZXZlbWVudEVycm9yID0gIiIsIHRoaXMuaXNTZXRQcm9ncmVzc0FjaGlldmVtZW50U3VjY2VzcyA9ICExLCB0aGlzLnNldFByb2dyZXNzQWNoaWV2ZW1lbnRFcnJvciA9ICIiLCB0aGlzLnByb2R1Y3RzID0gW10sIHRoaXMucGxheWVyUHVyY2hhc2VzID0gW10sIHRoaXMuY3VycmVudFByb2R1Y3RJbmRleCA9IDAsIHRoaXMuY3VycmVudFByb2R1Y3QgPSB7CiAgICAgICAgICAgICAgICBpZDogMCwKICAgICAgICAgICAgICAgIHRhZzogIiIsCiAgICAgICAgICAgICAgICBuYW1lOiAiIiwKICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAiIiwKICAgICAgICAgICAgICAgIGljb246ICIiLAogICAgICAgICAgICAgICAgaWNvblNtYWxsOiAiIiwKICAgICAgICAgICAgICAgIHByaWNlOiAwLAogICAgICAgICAgICAgICAgY3VycmVuY3k6ICIiLAogICAgICAgICAgICAgICAgY3VycmVuY3lTeW1ib2w6ICIiCiAgICAgICAgICAgIH0sIHRoaXMuY3VycmVudFByb2R1Y3RQdXJjaGFzZXMgPSAwLCB0aGlzLmN1cnJlbnRQdXJjaGFzZUluZGV4ID0gMCwKICAgICAgICAgICAgdGhpcy5jdXJyZW50UHVyY2hhc2UgPSB7CiAgICAgICAgICAgICAgICBpZDogMCwKICAgICAgICAgICAgICAgIHRhZzogIiIsCiAgICAgICAgICAgICAgICBjcmVhdGVkQXQ6ICIiLAogICAgICAgICAgICAgICAgZXhwaXJlZEF0OiAiIiwKICAgICAgICAgICAgICAgIHN1YnNjcmliZWQ6ICExCiAgICAgICAgICAgIH0sIHRoaXMuaXNTdWJzY3JpYmVQcm9kdWN0U3VjY2VzcyA9ICExLCB0aGlzLmlzVW5zdWJzY3JpYmVQcm9kdWN0U3VjY2VzcyA9ICExLCB0aGlzLmlzUHVyY2hhc2VQcm9kdWN0U3VjY2VzcyA9ICExLCB0aGlzLnB1cmNoYXNlUHJvZHVjdEVycm9yID0gIiIsIHRoaXMucHVyY2hhc2VkUHJvZHVjdElkID0gMCwgdGhpcy5wdXJjaGFzZWRQcm9kdWN0VGFnID0gIiIsIHRoaXMuaXNDb25zdW1lUHJvZHVjdFN1Y2Nlc3MgPSAhMSwgdGhpcy5jb25zdW1lUHJvZHVjdEVycm9yID0gIiIsIHRoaXMuY29uc3VtZWRQcm9kdWN0SWQgPSAwLCB0aGlzLmNvbnN1bWVkUHJvZHVjdFRhZyA9ICIiLCB0aGlzLmlzTGFzdEFkU3VjY2VzcyA9ICExLCB0aGlzLmlzTGFzdFNoYXJlU3VjY2VzcyA9ICExLCB0aGlzLmlzTGFzdENvbW11bml0eUpvaW5TdWNjZXNzID0gITEsIHRoaXMuaXNMYXN0QWRkU2hvcnRjdXRTdWNjZXNzID0gITEsIHRoaXMuaXNSZWFkeSA9ICExLCB0aGlzLmlzUGxheWVyUmVhZHkgPSAhMSwgdGhpcy5nYW1lc0NvbGxlY3Rpb24gPSB7CiAgICAgICAgICAgICAgICBpZDogMCwKICAgICAgICAgICAgICAgIHRhZzogIiIsCiAgICAgICAgICAgICAgICBuYW1lOiAiIiwKICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAiIiwKICAgICAgICAgICAgICAgIGdhbWVzOiBbXQogICAgICAgICAgICB9LCB0aGlzLmN1cnJlbnRHYW1lSW5kZXggPSAwLCB0aGlzLmN1cnJlbnRHYW1lSWQgPSAwLCB0aGlzLmN1cnJlbnRHYW1lTmFtZSA9ICIiLCB0aGlzLmN1cnJlbnRHYW1lRGVzY3JpcHRpb24gPSAiIiwgdGhpcy5jdXJyZW50R2FtZUljb24gPSAiIiwgdGhpcy5jdXJyZW50R2FtZVVybCA9ICIiLCB0aGlzLmdhbWVzQ29sbGVjdGlvbkZldGNoRXJyb3IgPSAiIiwgdGhpcy5sYXN0R2FtZXNDb2xsZWN0aW9uSWRPclRhZyA9ICIiLCB0aGlzLmRvY3VtZW50ID0gewogICAgICAgICAgICAgICAgdHlwZTogIiIsCiAgICAgICAgICAgICAgICBjb250ZW50OiAiIgogICAgICAgICAgICB9LCB0aGlzLmxhc3REb2N1bWVudFR5cGUgPSAiIiwgdGhpcy5kb2N1bWVudEZldGNoRXJyb3IgPSAiIiwgdGhpcy5sYXN0RXJyb3IgPSAiIiwgdGhpcy5pc0xhc3RBY3Rpb25TdWNjZXNzID0gITEsIHRoaXMuaW1hZ2VzID0gW10sIHRoaXMuY2FuTG9hZE1vcmVJbWFnZXMgPSAhMSwgdGhpcy5jdXJyZW50SW1hZ2VJbmRleCA9CiAgICAgICAgICAgIDAsIHRoaXMuY3VycmVudEltYWdlVGFnSW5kZXggPSAwLCB0aGlzLmN1cnJlbnRJbWFnZVRhZyA9ICIiLCB0aGlzLmxhc3RJbWFnZVRlbXBVcmwgPSAiIiwgdGhpcy5jdXJyZW50SW1hZ2UgPSB7CiAgICAgICAgICAgICAgICBpZDogIiIsCiAgICAgICAgICAgICAgICBwbGF5ZXJJZDogMCwKICAgICAgICAgICAgICAgIHdpZHRoOiAwLAogICAgICAgICAgICAgICAgaGVpZ2h0OiAwLAogICAgICAgICAgICAgICAgc3JjOiAiIiwKICAgICAgICAgICAgICAgIHRhZ3M6IFtdCiAgICAgICAgICAgIH0sIHRoaXMuZmlsZXMgPSBbXSwgdGhpcy5sYXN0RmlsZUNvbnRlbnQgPSAiIiwgdGhpcy5jYW5Mb2FkTW9yZUZpbGVzID0gITEsIHRoaXMuY3VycmVudEZpbGVJbmRleCA9IDAsIHRoaXMuY3VycmVudEZpbGVUYWdJbmRleCA9IDAsIHRoaXMuY3VycmVudEZpbGVUYWcgPSAiIiwgdGhpcy5sYXN0RmlsZVRlbXBVcmwgPSAiIiwgdGhpcy5jdXJyZW50RmlsZSA9IHsKICAgICAgICAgICAgICAgIGlkOiAiIiwKICAgICAgICAgICAgICAgIHBsYXllcklkOiAwLAogICAgICAgICAgICAgICAgbmFtZTogIiIsCiAgICAgICAgICAgICAgICBzaXplOiAwLAogICAgICAgICAgICAgICAgc3JjOiAiIiwKICAgICAgICAgICAgICAgIHRhZ3M6IFtdCiAgICAgICAgICAgIH0sIHRoaXMuY3VycmVudFZhcmlhYmxlSW5kZXggPSAwLCB0aGlzLmN1cnJlbnRWYXJpYWJsZSA9IHsKICAgICAgICAgICAgICAgIGtleTogIiIsCiAgICAgICAgICAgICAgICB0eXBlOiAiIiwKICAgICAgICAgICAgICAgIHZhbHVlOiAiIgogICAgICAgICAgICB9LCB0aGlzLmN1cnJlbnRQbGF5ZXJzSW5kZXggPSAwLCB0aGlzLmxhc3RQbGF5ZXJzVGFnID0gIiIsIHRoaXMuY3VycmVudFBsYXllcnNQbGF5ZXIgPSB7CiAgICAgICAgICAgICAgICBzdGF0ZToge30sCiAgICAgICAgICAgICAgICBhY2hpZXZlbWVudHM6IFtdLAogICAgICAgICAgICAgICAgcHVyY2hhc2VzOiBbXQogICAgICAgICAgICB9LCB0aGlzLnByb2plY3RJZCA9IE51bWJlcihiWzBdIHx8IDApLCB0aGlzLnB1YmxpY1Rva2VuID0gYlsxXSwgdGhpcy5zaG93UHJlbG9hZGVyT25TdGFydCA9IGJbMl0sIHRoaXMuc2hvdWxkV2FpdFBsYXllck9uTG9hZCA9IGJbM10sIHRoaXMuaXNFbmFibGVkID0gYls0XSwgdGhpcy5fcnVudGltZS5BZGRMb2FkUHJvbWlzZSh0aGlzLmF3YWl0ZXJzLmdwLnJlYWR5KSwgdGhpcy5zaG91bGRXYWl0UGxheWVyT25Mb2FkICYmIHRoaXMuX3J1bnRpbWUuQWRkTG9hZFByb21pc2UodGhpcy5hd2FpdGVycy5wbGF5ZXIucmVhZHkpLCAhdGhpcy5pc0VuYWJsZWQpIHJldHVybiB0aGlzLm9uRXJyb3IoKSwgdGhpcy5hd2FpdGVycy5ncC5kb25lKCksIHZvaWQgdGhpcy5hd2FpdGVycy5wbGF5ZXIuZG9uZSgpOwogICAgICAgIHRoaXMuX3J1bnRpbWUuRGlzcGF0Y2hlcigpLmFkZEV2ZW50TGlzdGVuZXIoImFmdGVyZmlyc3RsYXlvdXRzdGFydCIsICgpID0+IHsKICAgICAgICAgICAgY29uc3QgZCA9IHRoaXMuX3J1bnRpbWUuR2V0SVJ1bnRpbWUoKTsKICAgICAgICAgICAgZCAmJiAoZC5HYW1lU2NvcmUgPSB0aGlzLmdwLCBkLkdhbWVQdXNoID0gdGhpcy5ncCk7CiAgICAgICAgICAgIHRoaXMuaXNSZWFkeSAmJiB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uUmVhZHkpOwogICAgICAgICAgICB0aGlzLmlzUGxheWVyUmVhZHkgJiYgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PblBsYXllclJlYWR5KTsKICAgICAgICAgICAgdGhpcy5ncC5nYW1lU3RhcnQoKQogICAgICAgIH0pOwogICAgICAgIHRoaXMubG9hZExpYigpCiAgICB9CiAgICBvbkVycm9yKCkgewogICAgICAgIHZhciBhID0gKCkgPT4gUHJvbWlzZS5yZXNvbHZlKHt9KTsKICAgICAgICB0aGlzLmF3YWl0ZXJzLmdwLmRvbmUoKTsKICAgICAgICB0aGlzLmF3YWl0ZXJzLnBsYXllci5kb25lKCk7CiAgICAgICAgdGhpcy5ncCA9IHsKICAgICAgICAgICAgb24oKSB7fSwKICAgICAgICAgICAgY2hhbmdlTGFuZ3VhZ2U6IGEsCiAgICAgICAgICAgIGNoYW5nZUF2YXRhckdlbmVyYXRvcjogYSwKICAgICAgICAgICAgbG9hZE92ZXJsYXk6IGEsCiAgICAgICAgICAgIHBhdXNlOiBhLAogICAgICAgICAgICByZXN1bWU6IGEsCiAgICAgICAgICAgIGdhbWVTdGFydDogYSwKICAgICAgICAgICAgZ2FtZXBsYXlTdGFydDogYSwKICAgICAgICAgICAgZ2FtZXBsYXlTdG9wOiBhLAogICAgICAgICAgICBpc0RldjogITEsCiAgICAgICAgICAgIGlzUGF1c2VkOiAhMSwKICAgICAgICAgICAgaXNHYW1lcGxheTogITEsCiAgICAgICAgICAgIGxhbmd1YWdlOiAiZW4iLAogICAgICAgICAgICBhdmF0YXJHZW5lcmF0b3I6ICJkaWNlYmVhcl9yZXRybyIsCiAgICAgICAgICAgIGFwcDogewogICAgICAgICAgICAgICAgb24oKSB7fSwKICAgICAgICAgICAgICAgIHRpdGxlOiAiIiwKICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAiIiwKICAgICAgICAgICAgICAgIGltYWdlOiAiIiwKICAgICAgICAgICAgICAgIHVybDogIiIsCiAgICAgICAgICAgICAgICBjYW5BZGRTaG9ydGN1dDogITEsCiAgICAgICAgICAgICAgICBhZGRTaG9ydGN1dDogYQogICAgICAgICAgICB9LAogICAgICAgICAgICBhbmFseXRpY3M6IHsKICAgICAgICAgICAgICAgIG9uKCkge30sCiAgICAgICAgICAgICAgICBoaXQoKSB7fSwKICAgICAgICAgICAgICAgIGdvYWwoKSB7fQogICAgICAgICAgICB9LAogICAgICAgICAgICBwbGF0Zm9ybTogewogICAgICAgICAgICAgICAgb24oKSB7fSwKICAgICAgICAgICAgICAgIGhhc0ludGVncmF0ZWRBdXRoOiAhMSwKICAgICAgICAgICAgICAgIHR5cGU6ICJOT05FIgogICAgICAgICAgICB9LAogICAgICAgICAgICBzb2NpYWxzOiB7CiAgICAgICAgICAgICAgICBpc1N1cHBvcnRzTmF0aXZlU2hhcmU6ICExLAogICAgICAgICAgICAgICAgaXNTdXBwb3J0c05hdGl2ZVBvc3RzOiAhMSwKICAgICAgICAgICAgICAgIGlzU3VwcG9ydHNOYXRpdmVJbnZpdGU6ICExLAogICAgICAgICAgICAgICAgc2hhcmU6IGEsCiAgICAgICAgICAgICAgICBwb3N0OiBhLAogICAgICAgICAgICAgICAgaW52aXRlOiBhCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGxlYWRlcmJvYXJkOiB7CiAgICAgICAgICAgICAgICBvbigpIHt9LAogICAgICAgICAgICAgICAgb3BlbjogYSwKICAgICAgICAgICAgICAgIGZldGNoOiBhLAogICAgICAgICAgICAgICAgZmV0Y2hTY29wZWQ6IGEsCiAgICAgICAgICAgICAgICBmZXRjaFBsYXllclJhdGluZzogYSwKICAgICAgICAgICAgICAgIGZldGNoUGxheWVyUmF0aW5nU2NvcGVkOiBhCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGFjaGlldmVtZW50czogewogICAgICAgICAgICAgICAgb24oKSB7fSwKICAgICAgICAgICAgICAgIGhhcygpIHt9LAogICAgICAgICAgICAgICAgb3BlbjogYSwKICAgICAgICAgICAgICAgIGZldGNoOiBhLAogICAgICAgICAgICAgICAgdW5sb2NrOiBhLAogICAgICAgICAgICAgICAgc2V0UHJvZ3Jlc3M6IGEKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZ2FtZXNDb2xsZWN0aW9uczogewogICAgICAgICAgICAgICAgb24oKSB7fSwKICAgICAgICAgICAgICAgIG9wZW46IGEsCiAgICAgICAgICAgICAgICBmZXRjaDogYQogICAgICAgICAgICB9LAogICAgICAgICAgICBkb2N1bWVudHM6IHsKICAgICAgICAgICAgICAgIG9uKCkge30sCiAgICAgICAgICAgICAgICBvcGVuOiBhLAogICAgICAgICAgICAgICAgZmV0Y2g6IGEKICAgICAgICAgICAgfSwKICAgICAgICAgICAgdmFyaWFibGVzOiB7CiAgICAgICAgICAgICAgICBsaXN0OiBbXSwKICAgICAgICAgICAgICAgIG9uKCkge30sCiAgICAgICAgICAgICAgICBmZXRjaDogYSwKICAgICAgICAgICAgICAgIGdldDogYSwKICAgICAgICAgICAgICAgIGhhczogYSwKICAgICAgICAgICAgICAgIHR5cGU6IGEKICAgICAgICAgICAgfSwKICAgICAgICAgICAgaW1hZ2VzOiB7CiAgICAgICAgICAgICAgICBjYW5VcGxvYWQ6ICExLAogICAgICAgICAgICAgICAgbGlzdDogW10sCiAgICAgICAgICAgICAgICBvbigpIHt9LAogICAgICAgICAgICAgICAgdXBsb2FkOiBhLAogICAgICAgICAgICAgICAgdXBsb2FkVXJsOiBhLAogICAgICAgICAgICAgICAgZmV0Y2g6IGEsCiAgICAgICAgICAgICAgICBmZXRjaE1vcmU6IGEsCiAgICAgICAgICAgICAgICBjaG9vc2VGaWxlOiBhLAogICAgICAgICAgICAgICAgcmVzaXplOiBhCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGZpbGVzOiB7CiAgICAgICAgICAgICAgICBjYW5VcGxvYWQ6ICExLAogICAgICAgICAgICAgICAgbGlzdDogW10sCiAgICAgICAgICAgICAgICBvbigpIHt9LAogICAgICAgICAgICAgICAgdXBsb2FkOiBhLAogICAgICAgICAgICAgICAgdXBsb2FkVXJsOiBhLAogICAgICAgICAgICAgICAgdXBsb2FkQ29udGVudDogYSwKICAgICAgICAgICAgICAgIGxvYWRDb250ZW50OiBhLAogICAgICAgICAgICAgICAgZmV0Y2g6IGEsCiAgICAgICAgICAgICAgICBmZXRjaE1vcmU6IGEsCiAgICAgICAgICAgICAgICBjaG9vc2VGaWxlOiBhCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHBheW1lbnRzOiB7CiAgICAgICAgICAgICAgICBpc0F2YWlsYWJsZTogITEsCiAgICAgICAgICAgICAgICBwdXJjaGFzZXM6IFtdLAogICAgICAgICAgICAgICAgb24oKSB7fSwKICAgICAgICAgICAgICAgIGhhcygpIHt9LAogICAgICAgICAgICAgICAgZmV0Y2hQcm9kdWN0czogYSwKICAgICAgICAgICAgICAgIHB1cmNoYXNlOiBhLAogICAgICAgICAgICAgICAgY29uc3VtZTogYQogICAgICAgICAgICB9LAogICAgICAgICAgICBmdWxsc2NyZWVuOiB7CiAgICAgICAgICAgICAgICBpc0VuYWJsZWQ6ICExLAogICAgICAgICAgICAgICAgb24oKSB7fSwKICAgICAgICAgICAgICAgIG9wZW4oKSB7fSwKICAgICAgICAgICAgICAgIGNsb3NlKCkge30sCiAgICAgICAgICAgICAgICB0b2dnbGUoKSB7fQogICAgICAgICAgICB9LAogICAgICAgICAgICBhZHM6IHsKICAgICAgICAgICAgICAgIGlzRnVsbHNjcmVlbkF2YWlsYWJsZTogITEsCiAgICAgICAgICAgICAgICBpc1Jld2FyZGVkQXZhaWxhYmxlOiAhMSwKICAgICAgICAgICAgICAgIGlzUHJlbG9hZGVyQXZhaWxhYmxlOiAhMSwKICAgICAgICAgICAgICAgIGlzU3RpY2t5QXZhaWxhYmxlOiAhMSwKICAgICAgICAgICAgICAgIGlzQWRibG9ja0VuYWJsZWQ6ICExLAogICAgICAgICAgICAgICAgb24oKSB7fSwKICAgICAgICAgICAgICAgIHNob3dGdWxsc2NyZWVuOiBhLAogICAgICAgICAgICAgICAgc2hvd1Jld2FyZGVkVmlkZW86IGEsCiAgICAgICAgICAgICAgICBzaG93UHJlbG9hZGVyOiBhLAogICAgICAgICAgICAgICAgc2hvd1N0aWNreTogYSwKICAgICAgICAgICAgICAgIGNsb3NlU3RpY2t5OiBhLAogICAgICAgICAgICAgICAgcmVmcmVzaFN0aWNreTogYQogICAgICAgICAgICB9LAogICAgICAgICAgICBwbGF5ZXI6IHsKICAgICAgICAgICAgICAgIGlzU3R1YjogITAsCiAgICAgICAgICAgICAgICBpc0xvZ2dlZEluOiAhMSwKICAgICAgICAgICAgICAgIGlkOiAwLAogICAgICAgICAgICAgICAgbmFtZTogIiIsCiAgICAgICAgICAgICAgICBhdmF0YXI6ICIiLAogICAgICAgICAgICAgICAgb24oKSB7fSwKICAgICAgICAgICAgICAgIHN5bmM6IGEsCiAgICAgICAgICAgICAgICBsb2FkOiBhLAogICAgICAgICAgICAgICAgbG9naW46IGEsCiAgICAgICAgICAgICAgICBmZXRjaEZpZWxkczogYSwKICAgICAgICAgICAgICAgIGdldEZpZWxkOiBhLAogICAgICAgICAgICAgICAgZ2V0RmllbGROYW1lOiBhLAogICAgICAgICAgICAgICAgZ2V0RmllbGRWYXJpYW50TmFtZTogYSwKICAgICAgICAgICAgICAgIGFkZDogYSwKICAgICAgICAgICAgICAgIGhhczogYSwKICAgICAgICAgICAgICAgIGdldDogYSwKICAgICAgICAgICAgICAgIHNldDogYSwKICAgICAgICAgICAgICAgIHRvZ2dsZTogYSwKICAgICAgICAgICAgICAgIHJlc2V0OiBhLAogICAgICAgICAgICAgICAgcmVtb3ZlOiBhLAogICAgICAgICAgICAgICAgZmllbGRzOiBbXQogICAgICAgICAgICB9LAogICAgICAgICAgICBwbGF5ZXJzOiB7CiAgICAgICAgICAgICAgICBvbigpIHt9LAogICAgICAgICAgICAgICAgZmV0Y2g6IGEKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgdGhpcy5pc1JlYWR5ID0gITA7CiAgICAgICAgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PblJlYWR5KTsKICAgICAgICB0aGlzLmlzUGxheWVyUmVhZHkgPSAhMDsKICAgICAgICB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uUGxheWVyUmVhZHkpCiAgICB9CiAgICBsb2FkTGliKCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHdpbmRvdy5vbkdQSW5pdCA9CiAgICAgICAgICAgICAgICBkID0+IGQucmVhZHkudGhlbigoKSA9PiB0aGlzLmluaXQoZCkpLmNhdGNoKCgpID0+IHRoaXMub25FcnJvcigpKTsKICAgICAgICAgICAgdmFyIGEgPSBkb2N1bWVudDsKICAgICAgICAgICAgdmFyIGIgPSBhLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJzY3JpcHQiKVswXTsKICAgICAgICAgICAgKGEgPSBhLmNyZWF0ZUVsZW1lbnQoInNjcmlwdCIpKS5zcmMgPSBgJHsiaHR0cHM6Ly9ncy5lcG9uZXNoLmNvbS9zZGsifS9nYW1lcHVzaC5qcz9wcm9qZWN0SWQ9JHt0aGlzLnByb2plY3RJZH0mcHVibGljVG9rZW49JHt0aGlzLnB1YmxpY1Rva2VufSZjYWxsYmFjaz1vbkdQSW5pdGA7CiAgICAgICAgICAgIGEuYXN5bmMgPSAhMDsKICAgICAgICAgICAgYS5vbmVycm9yID0gKCkgPT4gdGhpcy5vbkVycm9yKCk7CiAgICAgICAgICAgIGIucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoYSwgYikKICAgICAgICB9IGNhdGNoIChkKSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZCksIHRoaXMub25FcnJvcigpCiAgICAgICAgfQogICAgfQogICAgaW5pdChhKSB7CiAgICAgICAgdGhpcy5ncCA9IGE7CiAgICAgICAgKGEgPSB0aGlzLl9ydW50aW1lLkdldElSdW50aW1lKCkpICYmIChhLkdhbWVTY29yZSA9IHRoaXMuZ3AsIGEuR2FtZVB1c2ggPSB0aGlzLmdwKTsKICAgICAgICB0aGlzLmdwLnBsYXllci5vbigicmVhZHkiLAogICAgICAgICAgICAoKSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLmlzUGxheWVyUmVhZHkgPSAhMDsKICAgICAgICAgICAgICAgIHRoaXMuYXdhaXRlcnMucGxheWVyLmRvbmUoKTsKICAgICAgICAgICAgICAgIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25QbGF5ZXJSZWFkeSkKICAgICAgICAgICAgfSk7CiAgICAgICAgdGhpcy5ncC5wbGF5ZXIub24oImNoYW5nZSIsICgpID0+IHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25QbGF5ZXJDaGFuZ2UpKTsKICAgICAgICB0aGlzLmdwLnBsYXllci5vbigic3luYyIsIGIgPT4gewogICAgICAgICAgICB0aGlzLmhhbmRsZVJlc3VsdChiKTsKICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKGIgPyB0aGlzLmNvbmRpdGlvbnMuT25QbGF5ZXJTeW5jQ29tcGxldGUgOiB0aGlzLmNvbmRpdGlvbnMuT25QbGF5ZXJTeW5jRXJyb3IpCiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5ncC5wbGF5ZXIub24oImxvYWQiLCBiID0+IHsKICAgICAgICAgICAgdGhpcy5oYW5kbGVSZXN1bHQoYik7CiAgICAgICAgICAgIHRoaXMuVHJpZ2dlcihiID8gdGhpcy5jb25kaXRpb25zLk9uUGxheWVyTG9hZENvbXBsZXRlIDogdGhpcy5jb25kaXRpb25zLk9uUGxheWVyTG9hZEVycm9yKQogICAgICAgIH0pOwogICAgICAgIHRoaXMuZ3AucGxheWVyLm9uKCJsb2dpbiIsIGIgPT4gewogICAgICAgICAgICB0aGlzLmhhbmRsZVJlc3VsdChiKTsKICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKGIgPyB0aGlzLmNvbmRpdGlvbnMuT25QbGF5ZXJMb2dpbkNvbXBsZXRlIDogdGhpcy5jb25kaXRpb25zLk9uUGxheWVyTG9naW5FcnJvcikKICAgICAgICB9KTsKICAgICAgICB0aGlzLmdwLnBsYXllci5vbigiZmV0Y2hGaWVsZHMiLCBiID0+IHsKICAgICAgICAgICAgdGhpcy5oYW5kbGVSZXN1bHQoYik7CiAgICAgICAgICAgIHRoaXMuVHJpZ2dlcihiID8gdGhpcy5jb25kaXRpb25zLk9uUGxheWVyRmV0Y2hGaWVsZHNDb21wbGV0ZSA6IHRoaXMuY29uZGl0aW9ucy5PblBsYXllckZldGNoRmllbGRzRXJyb3IpCiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5ncC5sZWFkZXJib2FyZC5vbigib3BlbiIsICgpID0+IHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25MZWFkZXJib2FyZE9wZW4pKTsKICAgICAgICB0aGlzLmdwLmFjaGlldmVtZW50cy5vbigib3BlbiIsICgpID0+IHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25BY2hpZXZlbWVudHNPcGVuKSk7CiAgICAgICAgdGhpcy5ncC5hY2hpZXZlbWVudHMub24oImNsb3NlIiwgKCkgPT4gdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkFjaGlldmVtZW50c0Nsb3NlKSk7CiAgICAgICAgdGhpcy5ncC5nYW1lc0NvbGxlY3Rpb25zLm9uKCJvcGVuIiwgKCkgPT4gdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkdhbWVzQ29sbGVjdGlvbnNPcGVuKSk7CiAgICAgICAgdGhpcy5ncC5nYW1lc0NvbGxlY3Rpb25zLm9uKCJjbG9zZSIsICgpID0+IHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25HYW1lc0NvbGxlY3Rpb25zQ2xvc2UpKTsKICAgICAgICB0aGlzLmdwLmRvY3VtZW50cy5vbigib3BlbiIsICgpID0+IHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25Eb2N1bWVudHNPcGVuKSk7CiAgICAgICAgdGhpcy5ncC5kb2N1bWVudHMub24oImNsb3NlIiwgKCkgPT4gdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkRvY3VtZW50c0Nsb3NlKSk7CiAgICAgICAgdGhpcy5ncC5mdWxsc2NyZWVuLm9uKCJvcGVuIiwgKCkgPT4gdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkZ1bGxzY3JlZW5PcGVuKSk7CiAgICAgICAgdGhpcy5ncC5mdWxsc2NyZWVuLm9uKCJjbG9zZSIsICgpID0+IHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25GdWxsc2NyZWVuQ2xvc2UpKTsKICAgICAgICB0aGlzLmdwLmZ1bGxzY3JlZW4ub24oImNoYW5nZSIsICgpID0+IHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25GdWxsc2NyZWVuQ2hhbmdlKSk7CiAgICAgICAgdGhpcy5ncC5hZHMub24oInN0YXJ0IiwgKCkgPT4gdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkFkc1N0YXJ0KSk7CiAgICAgICAgdGhpcy5ncC5hZHMub24oImNsb3NlIiwgYiA9PiB7CiAgICAgICAgICAgIHRoaXMuaGFuZGxlUmVzdWx0KGIpOwogICAgICAgICAgICB0aGlzLmlzTGFzdEFkU3VjY2VzcyA9IGI7CiAgICAgICAgICAgIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25BZHNDbG9zZSkKICAgICAgICB9KTsKICAgICAgICB0aGlzLmdwLmFkcy5vbigiZnVsbHNjcmVlbjpzdGFydCIsICgpID0+IHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25BZHNGdWxsc2NyZWVuU3RhcnQpKTsKICAgICAgICB0aGlzLmdwLmFkcy5vbigiZnVsbHNjcmVlbjpjbG9zZSIsICgpID0+IHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25BZHNGdWxsc2NyZWVuQ2xvc2UpKTsKICAgICAgICB0aGlzLmdwLmFkcy5vbigicHJlbG9hZGVyOnN0YXJ0IiwgKCkgPT4gdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkFkc1ByZWxvYWRlclN0YXJ0KSk7CiAgICAgICAgdGhpcy5ncC5hZHMub24oInByZWxvYWRlcjpjbG9zZSIsICgpID0+IHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25BZHNQcmVsb2FkZXJDbG9zZSkpOwogICAgICAgIHRoaXMuZ3AuYWRzLm9uKCJyZXdhcmRlZDpzdGFydCIsICgpID0+IHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25BZHNSZXdhcmRlZFN0YXJ0KSk7CiAgICAgICAgdGhpcy5ncC5hZHMub24oInJld2FyZGVkOmNsb3NlIiwgKCkgPT4gdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkFkc1Jld2FyZGVkQ2xvc2UpKTsKICAgICAgICB0aGlzLmdwLmFkcy5vbigicmV3YXJkZWQ6cmV3YXJkIiwgKCkgPT4gdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkFkc1Jld2FyZGVkUmV3YXJkKSk7CiAgICAgICAgdGhpcy5ncC5hZHMub24oInN0aWNreTpzdGFydCIsICgpID0+IHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25BZHNTdGlja3lTdGFydCkpOwogICAgICAgIHRoaXMuZ3AuYWRzLm9uKCJzdGlja3k6Y2xvc2UiLCAoKSA9PiB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uQWRzU3RpY2t5Q2xvc2UpKTsKICAgICAgICB0aGlzLmdwLmFkcy5vbigic3RpY2t5OnJlZnJlc2giLCAoKSA9PiB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uQWRzU3RpY2t5UmVmcmVzaCkpOwogICAgICAgIHRoaXMuZ3AuYWRzLm9uKCJzdGlja3k6cmVuZGVyIiwgKCkgPT4gdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkFkc1N0aWNreVJlbmRlcikpOwogICAgICAgIHRoaXMuZ3Auc29jaWFscy5vbigic2hhcmUiLCBiID0+IHsKICAgICAgICAgICAgdGhpcy5oYW5kbGVSZXN1bHQoYik7CiAgICAgICAgICAgIHRoaXMuaXNMYXN0U2hhcmVTdWNjZXNzID0gYjsKICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PblNvY2lhbHNTaGFyZSkKICAgICAgICB9KTsKICAgICAgICB0aGlzLmdwLnNvY2lhbHMub24oInBvc3QiLCBiID0+IHsKICAgICAgICAgICAgdGhpcy5oYW5kbGVSZXN1bHQoYik7CiAgICAgICAgICAgIHRoaXMuaXNMYXN0U2hhcmVTdWNjZXNzID0gYjsKICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PblNvY2lhbHNQb3N0KQogICAgICAgIH0pOwogICAgICAgIHRoaXMuZ3Auc29jaWFscy5vbigiaW52aXRlIiwgYiA9PiB7CiAgICAgICAgICAgIHRoaXMuaGFuZGxlUmVzdWx0KGIpOwogICAgICAgICAgICB0aGlzLmlzTGFzdFNoYXJlU3VjY2VzcyA9IGI7CiAgICAgICAgICAgIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25Tb2NpYWxzSW52aXRlKQogICAgICAgIH0pOwogICAgICAgIHRoaXMuZ3Auc29jaWFscy5vbigiam9pbkNvbW11bml0eSIsIGIgPT4gewogICAgICAgICAgICB0aGlzLmhhbmRsZVJlc3VsdChiKTsKICAgICAgICAgICAgdGhpcy5pc0xhc3RDb21tdW5pdHlKb2luU3VjY2VzcyA9IGI7CiAgICAgICAgICAgIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25Tb2NpYWxzSm9pbkNvbW11bml0eSkKICAgICAgICB9KTsKICAgICAgICB0aGlzLmdwLmFwcC5vbigiYWRkU2hvcnRjdXQiLCBiID0+IHsKICAgICAgICAgICAgdGhpcy5oYW5kbGVSZXN1bHQoYik7CiAgICAgICAgICAgIHRoaXMuaXNMYXN0QWRkU2hvcnRjdXRTdWNjZXNzID0gYjsKICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkFwcEFkZFNob3J0Y3V0KQogICAgICAgIH0pOwogICAgICAgIHRoaXMuZ3Aub24oImNoYW5nZTpsYW5ndWFnZSIsICgpID0+IHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25DaGFuZ2VMYW5ndWFnZSkpOwogICAgICAgIHRoaXMuZ3Aub24oImNoYW5nZTphdmF0YXJHZW5lcmF0b3IiLCAoKSA9PiB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uQ2hhbmdlQXZhdGFyR2VuZXJhdG9yKSk7CiAgICAgICAgdGhpcy5ncC5vbigib3ZlcmxheTpyZWFkeSIsICgpID0+IHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25PdmVybGF5UmVhZHkpKTsKICAgICAgICB0aGlzLmdwLm9uKCJwYXVzZSIsICgpID0+IHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25QYXVzZSkpOwogICAgICAgIHRoaXMuZ3Aub24oInJlc3VtZSIsICgpID0+IHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25SZXN1bWUpKTsKICAgICAgICB0aGlzLmdwLm9uKCJnYW1lcGxheVN0YXJ0IiwgKCkgPT4gdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkdhbWVwbGF5U3RhcnQpKTsKICAgICAgICB0aGlzLmdwLm9uKCJnYW1lcGxheVN0b3AiLCAoKSA9PiB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uR2FtZXBsYXlTdG9wKSk7CiAgICAgICAgdGhpcy5ncC5jaGFubmVscy5vbigiZXZlbnQiLCBiID0+IHsKICAgICAgICAgICAgdGhpcy5jdXJFdmVudCA9IGIKICAgICAgICB9KTsKICAgICAgICB0aGlzLmdwLmNoYW5uZWxzLm9uKCJldmVudDpjb25uZWN0IiwgKCkgPT4gewogICAgICAgICAgICB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uRXZlbnQpOwogICAgICAgICAgICB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uRXZlbnRDb25uZWN0KQogICAgICAgIH0pOwogICAgICAgIHRoaXMuaXNSZWFkeSA9ICEwOwogICAgICAgIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25SZWFkeSk7CiAgICAgICAgdGhpcy5hd2FpdGVycy5ncC5kb25lKCk7CiAgICAgICAgdGhpcy5zaG93UHJlbG9hZGVyT25TdGFydCAmJiB0aGlzLmdwLmFkcy5zaG93UHJlbG9hZGVyKCkKICAgIH0KICAgIFJlbGVhc2UoKSB7CiAgICAgICAgc3VwZXIuUmVsZWFzZSgpCiAgICB9CiAgICBTYXZlVG9Kc29uKCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGxlYWRlcmJvYXJkOiB0aGlzLmxlYWRlcmJvYXJkLAogICAgICAgICAgICBsZWFkZXJib2FyZEluZm86IHRoaXMubGVhZGVyYm9hcmRJbmZvLAogICAgICAgICAgICBsZWFkZXJib2FyZFJlY29yZHM6IHRoaXMubGVhZGVyYm9hcmRSZWNvcmRzLAogICAgICAgICAgICBjdXJyZW50TGVhZGVyYm9hcmRJbmRleDogdGhpcy5jdXJyZW50TGVhZGVyYm9hcmRJbmRleCwKICAgICAgICAgICAgY3VycmVudExlYWRlcmJvYXJkUGxheWVyOiB0aGlzLmN1cnJlbnRMZWFkZXJib2FyZFBsYXllciwKICAgICAgICAgICAgbGFzdExlYWRlcmJvYXJkVGFnOiB0aGlzLmxhc3RMZWFkZXJib2FyZFRhZywKICAgICAgICAgICAgbGFzdExlYWRlcmJvYXJkVmFyaWFudDogdGhpcy5sYXN0TGVhZGVyYm9hcmRWYXJpYW50LAogICAgICAgICAgICBsYXN0TGVhZGVyYm9hcmRQbGF5ZXJSYXRpbmdUYWc6IHRoaXMubGFzdExlYWRlcmJvYXJkUGxheWVyUmF0aW5nVGFnLAogICAgICAgICAgICBsZWFkZXJib2FyZFBsYXllclBvc2l0aW9uOiB0aGlzLmxlYWRlcmJvYXJkUGxheWVyUG9zaXRpb24sCiAgICAgICAgICAgIGN1cnJlbnRQbGF5ZXJGaWVsZEtleTogdGhpcy5jdXJyZW50UGxheWVyRmllbGRLZXksCiAgICAgICAgICAgIGN1cnJlbnRQbGF5ZXJGaWVsZFR5cGU6IHRoaXMuY3VycmVudFBsYXllckZpZWxkVHlwZSwKICAgICAgICAgICAgY3VycmVudFBsYXllckZpZWxkTmFtZTogdGhpcy5jdXJyZW50UGxheWVyRmllbGROYW1lLAogICAgICAgICAgICBjdXJyZW50UGxheWVyRmllbGRWYWx1ZTogdGhpcy5jdXJyZW50UGxheWVyRmllbGRWYWx1ZSwKICAgICAgICAgICAgY3VycmVudFBsYXllckZpZWxkVmFyaWFudFZhbHVlOiB0aGlzLmN1cnJlbnRQbGF5ZXJGaWVsZFZhcmlhbnRWYWx1ZSwKICAgICAgICAgICAgY3VycmVudFBsYXllckZpZWxkVmFyaWFudE5hbWU6IHRoaXMuY3VycmVudFBsYXllckZpZWxkVmFyaWFudE5hbWUsCiAgICAgICAgICAgIGN1cnJlbnRQbGF5ZXJGaWVsZFZhcmlhbnRJbmRleDogdGhpcy5jdXJyZW50UGxheWVyRmllbGRWYXJpYW50SW5kZXgsCiAgICAgICAgICAgIGlzTGFzdEFkU3VjY2VzczogdGhpcy5pc0xhc3RBZFN1Y2Nlc3MsCiAgICAgICAgICAgIGlzTGFzdFNoYXJlU3VjY2VzczogdGhpcy5pc0xhc3RTaGFyZVN1Y2Nlc3MsCiAgICAgICAgICAgIGlzTGFzdENvbW11bml0eUpvaW5TdWNjZXNzOiB0aGlzLmlzTGFzdENvbW11bml0eUpvaW5TdWNjZXNzLAogICAgICAgICAgICBpc0xhc3RBZGRTaG9ydGN1dFN1Y2Nlc3M6IHRoaXMuaXNMYXN0QWRkU2hvcnRjdXRTdWNjZXNzLAogICAgICAgICAgICBpc1JlYWR5OiB0aGlzLmlzUmVhZHksCiAgICAgICAgICAgIGlzUGxheWVyUmVhZHk6IHRoaXMuaXNQbGF5ZXJSZWFkeSwKICAgICAgICAgICAgYWNoaWV2ZW1lbnRzOiB0aGlzLmFjaGlldmVtZW50cywKICAgICAgICAgICAgYWNoaWV2ZW1lbnRzR3JvdXBzOiB0aGlzLmFjaGlldmVtZW50c0dyb3VwcywKICAgICAgICAgICAgcGxheWVyQWNoaWV2ZW1lbnRzOiB0aGlzLnBsYXllckFjaGlldmVtZW50cywKICAgICAgICAgICAgY3VycmVudEFjaGlldmVtZW50SW5kZXg6IHRoaXMuY3VycmVudEFjaGlldmVtZW50SW5kZXgsCiAgICAgICAgICAgIGN1cnJlbnRBY2hpZXZlbWVudDogdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnQsCiAgICAgICAgICAgIGN1cnJlbnRBY2hpZXZlbWVudHNHcm91cEluZGV4OiB0aGlzLmN1cnJlbnRBY2hpZXZlbWVudHNHcm91cEluZGV4LAogICAgICAgICAgICBjdXJyZW50QWNoaWV2ZW1lbnRzR3JvdXBJZDogdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnRzR3JvdXBJZCwKICAgICAgICAgICAgY3VycmVudEFjaGlldmVtZW50c0dyb3VwVGFnOiB0aGlzLmN1cnJlbnRBY2hpZXZlbWVudHNHcm91cFRhZywKICAgICAgICAgICAgY3VycmVudEFjaGlldmVtZW50c0dyb3VwTmFtZTogdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnRzR3JvdXBOYW1lLAogICAgICAgICAgICBjdXJyZW50QWNoaWV2ZW1lbnRzR3JvdXBEZXNjcmlwdGlvbjogdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnRzR3JvdXBEZXNjcmlwdGlvbiwKICAgICAgICAgICAgY3VycmVudFBsYXllckFjaGlldmVtZW50SW5kZXg6IHRoaXMuY3VycmVudFBsYXllckFjaGlldmVtZW50SW5kZXgsCiAgICAgICAgICAgIGN1cnJlbnRQbGF5ZXJBY2hpZXZlbWVudElkOiB0aGlzLmN1cnJlbnRQbGF5ZXJBY2hpZXZlbWVudElkLAogICAgICAgICAgICBjdXJyZW50UGxheWVyQWNoaWV2ZW1lbnRVbmxvY2tEYXRlOiB0aGlzLmN1cnJlbnRQbGF5ZXJBY2hpZXZlbWVudFVubG9ja0RhdGUsCiAgICAgICAgICAgIGlzVW5sb2NrQWNoaWV2ZW1lbnRTdWNjZXNzOiB0aGlzLmlzVW5sb2NrQWNoaWV2ZW1lbnRTdWNjZXNzLAogICAgICAgICAgICB1bmxvY2tBY2hpZXZlbWVudEVycm9yOiB0aGlzLnVubG9ja0FjaGlldmVtZW50RXJyb3IsCiAgICAgICAgICAgIHByb2R1Y3RzOiB0aGlzLnByb2R1Y3RzLAogICAgICAgICAgICBwbGF5ZXJQdXJjaGFzZXM6IHRoaXMucGxheWVyUHVyY2hhc2VzLAogICAgICAgICAgICBjdXJyZW50UHJvZHVjdEluZGV4OiB0aGlzLmN1cnJlbnRQcm9kdWN0SW5kZXgsCiAgICAgICAgICAgIGN1cnJlbnRQcm9kdWN0OiB0aGlzLmN1cnJlbnRQcm9kdWN0LAogICAgICAgICAgICBjdXJyZW50UHJvZHVjdFB1cmNoYXNlczogdGhpcy5jdXJyZW50UHJvZHVjdFB1cmNoYXNlcywKICAgICAgICAgICAgY3VycmVudFB1cmNoYXNlSW5kZXg6IHRoaXMuY3VycmVudFB1cmNoYXNlSW5kZXgsCiAgICAgICAgICAgIGN1cnJlbnRQdXJjaGFzZTogdGhpcy5jdXJyZW50UHVyY2hhc2UsCiAgICAgICAgICAgIGxhc3RQbGF5ZXJzVGFnOiB0aGlzLmxhc3RQbGF5ZXJzVGFnLAogICAgICAgICAgICBjdXJyZW50UGxheWVyc0luZGV4OiB0aGlzLmN1cnJlbnRQbGF5ZXJzSW5kZXgsCiAgICAgICAgICAgIGN1cnJlbnRQbGF5ZXJzUGxheWVyOiB0aGlzLmN1cnJlbnRQbGF5ZXJzUGxheWVyLAogICAgICAgICAgICBpc1N1YnNjcmliZVByb2R1Y3RTdWNjZXNzOiB0aGlzLmlzU3Vic2NyaWJlUHJvZHVjdFN1Y2Nlc3MsCiAgICAgICAgICAgIGlzVW5zdWJzY3JpYmVQcm9kdWN0U3VjY2VzczogdGhpcy5pc1Vuc3Vic2NyaWJlUHJvZHVjdFN1Y2Nlc3MsCiAgICAgICAgICAgIGlzUHVyY2hhc2VQcm9kdWN0U3VjY2VzczogdGhpcy5pc1B1cmNoYXNlUHJvZHVjdFN1Y2Nlc3MsCiAgICAgICAgICAgIHB1cmNoYXNlUHJvZHVjdEVycm9yOiB0aGlzLnB1cmNoYXNlUHJvZHVjdEVycm9yLAogICAgICAgICAgICBwdXJjaGFzZWRQcm9kdWN0SWQ6IHRoaXMucHVyY2hhc2VkUHJvZHVjdElkLAogICAgICAgICAgICBwdXJjaGFzZWRQcm9kdWN0VGFnOiB0aGlzLnB1cmNoYXNlZFByb2R1Y3RUYWcsCiAgICAgICAgICAgIGlzQ29uc3VtZVByb2R1Y3RTdWNjZXNzOiB0aGlzLmlzQ29uc3VtZVByb2R1Y3RTdWNjZXNzLAogICAgICAgICAgICBjb25zdW1lUHJvZHVjdEVycm9yOiB0aGlzLmNvbnN1bWVQcm9kdWN0RXJyb3IsCiAgICAgICAgICAgIGNvbnN1bWVkUHJvZHVjdElkOiB0aGlzLmNvbnN1bWVkUHJvZHVjdElkLAogICAgICAgICAgICBjb25zdW1lZFByb2R1Y3RUYWc6IHRoaXMuY29uc3VtZWRQcm9kdWN0VGFnLAogICAgICAgICAgICBnYW1lc0NvbGxlY3Rpb246IHRoaXMuZ2FtZXNDb2xsZWN0aW9uLAogICAgICAgICAgICBjdXJyZW50R2FtZUluZGV4OiB0aGlzLmN1cnJlbnRHYW1lSW5kZXgsCiAgICAgICAgICAgIGN1cnJlbnRHYW1lSWQ6IHRoaXMuY3VycmVudEdhbWVJZCwKICAgICAgICAgICAgY3VycmVudEdhbWVOYW1lOiB0aGlzLmN1cnJlbnRHYW1lTmFtZSwKICAgICAgICAgICAgY3VycmVudEdhbWVEZXNjcmlwdGlvbjogdGhpcy5jdXJyZW50R2FtZURlc2NyaXB0aW9uLAogICAgICAgICAgICBjdXJyZW50R2FtZUljb246IHRoaXMuY3VycmVudEdhbWVJY29uLAogICAgICAgICAgICBjdXJyZW50R2FtZVVybDogdGhpcy5jdXJyZW50R2FtZVVybCwKICAgICAgICAgICAgZ2FtZXNDb2xsZWN0aW9uRmV0Y2hFcnJvcjogdGhpcy5nYW1lc0NvbGxlY3Rpb25GZXRjaEVycm9yLAogICAgICAgICAgICBsYXN0R2FtZXNDb2xsZWN0aW9uSWRPclRhZzogdGhpcy5sYXN0R2FtZXNDb2xsZWN0aW9uSWRPclRhZywKICAgICAgICAgICAgZG9jdW1lbnQ6IHRoaXMuZG9jdW1lbnQsCiAgICAgICAgICAgIGxhc3REb2N1bWVudFR5cGU6IHRoaXMubGFzdERvY3VtZW50VHlwZSwKICAgICAgICAgICAgZG9jdW1lbnRGZXRjaEVycm9yOiB0aGlzLmRvY3VtZW50RmV0Y2hFcnJvciwKICAgICAgICAgICAgbGFzdEVycm9yOiB0aGlzLmxhc3RFcnJvciwKICAgICAgICAgICAgaXNMYXN0QWN0aW9uU3VjY2VzczogdGhpcy5pc0xhc3RBY3Rpb25TdWNjZXNzLAogICAgICAgICAgICBpbWFnZXM6IHRoaXMuaW1hZ2VzLAogICAgICAgICAgICBjYW5Mb2FkTW9yZUltYWdlczogdGhpcy5jYW5Mb2FkTW9yZUltYWdlcywKICAgICAgICAgICAgY3VycmVudEltYWdlOiB0aGlzLmN1cnJlbnRJbWFnZSwKICAgICAgICAgICAgbGFzdEltYWdlVGVtcFVybDogdGhpcy5sYXN0SW1hZ2VUZW1wVXJsLAogICAgICAgICAgICBjdXJyZW50SW1hZ2VJbmRleDogdGhpcy5jdXJyZW50SW1hZ2VJbmRleCwKICAgICAgICAgICAgY3VycmVudEltYWdlVGFnSW5kZXg6IHRoaXMuY3VycmVudEltYWdlVGFnSW5kZXgsCiAgICAgICAgICAgIGN1cnJlbnRJbWFnZVRhZzogdGhpcy5jdXJyZW50SW1hZ2VUYWcsCiAgICAgICAgICAgIGZpbGVzOiB0aGlzLmZpbGVzLAogICAgICAgICAgICBsYXN0RmlsZUNvbnRlbnQ6IHRoaXMubGFzdEZpbGVDb250ZW50LAogICAgICAgICAgICBjYW5Mb2FkTW9yZUZpbGVzOiB0aGlzLmNhbkxvYWRNb3JlRmlsZXMsCiAgICAgICAgICAgIGN1cnJlbnRGaWxlOiB0aGlzLmN1cnJlbnRGaWxlLAogICAgICAgICAgICBsYXN0RmlsZVRlbXBVcmw6IHRoaXMubGFzdEZpbGVUZW1wVXJsLAogICAgICAgICAgICBjdXJyZW50RmlsZUluZGV4OiB0aGlzLmN1cnJlbnRGaWxlSW5kZXgsCiAgICAgICAgICAgIGN1cnJlbnRGaWxlVGFnSW5kZXg6IHRoaXMuY3VycmVudEZpbGVUYWdJbmRleCwKICAgICAgICAgICAgY3VycmVudEZpbGVUYWc6IHRoaXMuY3VycmVudEZpbGVUYWcsCiAgICAgICAgICAgIGN1cnJlbnRWYXJpYWJsZUluZGV4OiB0aGlzLmN1cnJlbnRWYXJpYWJsZUluZGV4LAogICAgICAgICAgICBjdXJyZW50VmFyaWFibGU6IHRoaXMuY3VycmVudFZhcmlhYmxlCiAgICAgICAgfQogICAgfQogICAgTG9hZEZyb21Kc29uKGEpIHsKICAgICAgICB0aGlzLmxlYWRlcmJvYXJkID0KICAgICAgICAgICAgYS5sZWFkZXJib2FyZDsKICAgICAgICB0aGlzLmxlYWRlcmJvYXJkSW5mbyA9IGEubGVhZGVyYm9hcmRJbmZvIHx8IHt9OwogICAgICAgIHRoaXMubGVhZGVyYm9hcmRSZWNvcmRzID0gYS5sZWFkZXJib2FyZFJlY29yZHMgfHwge307CiAgICAgICAgdGhpcy5jdXJyZW50TGVhZGVyYm9hcmRJbmRleCA9IGEuY3VycmVudExlYWRlcmJvYXJkSW5kZXg7CiAgICAgICAgdGhpcy5jdXJyZW50TGVhZGVyYm9hcmRQbGF5ZXIgPSBhLmN1cnJlbnRMZWFkZXJib2FyZFBsYXllcjsKICAgICAgICB0aGlzLmxhc3RMZWFkZXJib2FyZFRhZyA9IGEubGFzdExlYWRlcmJvYXJkVGFnOwogICAgICAgIHRoaXMubGFzdExlYWRlcmJvYXJkVmFyaWFudCA9IGEubGFzdExlYWRlcmJvYXJkVmFyaWFudDsKICAgICAgICB0aGlzLmxhc3RMZWFkZXJib2FyZFBsYXllclJhdGluZ1RhZyA9IGEubGFzdExlYWRlcmJvYXJkUGxheWVyUmF0aW5nVGFnOwogICAgICAgIHRoaXMubGVhZGVyYm9hcmRQbGF5ZXJQb3NpdGlvbiA9IGEubGVhZGVyYm9hcmRQbGF5ZXJQb3NpdGlvbiB8fCAwOwogICAgICAgIHRoaXMuY3VycmVudFBsYXllckZpZWxkS2V5ID0gYS5jdXJyZW50UGxheWVyRmllbGRLZXk7CiAgICAgICAgdGhpcy5jdXJyZW50UGxheWVyRmllbGRUeXBlID0KICAgICAgICAgICAgYS5jdXJyZW50UGxheWVyRmllbGRUeXBlOwogICAgICAgIHRoaXMuY3VycmVudFBsYXllckZpZWxkTmFtZSA9IGEuY3VycmVudFBsYXllckZpZWxkTmFtZTsKICAgICAgICB0aGlzLmN1cnJlbnRQbGF5ZXJGaWVsZFZhbHVlID0gYS5jdXJyZW50UGxheWVyRmllbGRWYWx1ZTsKICAgICAgICB0aGlzLmN1cnJlbnRQbGF5ZXJGaWVsZFZhcmlhbnRWYWx1ZSA9IGEuY3VycmVudFBsYXllckZpZWxkVmFyaWFudFZhbHVlOwogICAgICAgIHRoaXMuY3VycmVudFBsYXllckZpZWxkVmFyaWFudE5hbWUgPSBhLmN1cnJlbnRQbGF5ZXJGaWVsZFZhcmlhbnROYW1lOwogICAgICAgIHRoaXMuY3VycmVudFBsYXllckZpZWxkVmFyaWFudEluZGV4ID0gYS5jdXJyZW50UGxheWVyRmllbGRWYXJpYW50SW5kZXg7CiAgICAgICAgdGhpcy5pc0xhc3RBZFN1Y2Nlc3MgPSBhLmlzTGFzdEFkU3VjY2VzczsKICAgICAgICB0aGlzLmlzTGFzdFNoYXJlU3VjY2VzcyA9IGEuaXNMYXN0U2hhcmVTdWNjZXNzOwogICAgICAgIHRoaXMuaXNMYXN0Q29tbXVuaXR5Sm9pblN1Y2Nlc3MgPSBhLmlzTGFzdENvbW11bml0eUpvaW5TdWNjZXNzOwogICAgICAgIHRoaXMuaXNMYXN0QWRkU2hvcnRjdXRTdWNjZXNzID0KICAgICAgICAgICAgYS5pc0xhc3RBZGRTaG9ydGN1dFN1Y2Nlc3M7CiAgICAgICAgdGhpcy5pc1JlYWR5ID0gYS5pc1JlYWR5OwogICAgICAgIHRoaXMuaXNQbGF5ZXJSZWFkeSA9IGEuaXNQbGF5ZXJSZWFkeTsKICAgICAgICB0aGlzLmFjaGlldmVtZW50cyA9IGEuYWNoaWV2ZW1lbnRzIHx8IFtdOwogICAgICAgIHRoaXMuYWNoaWV2ZW1lbnRzR3JvdXBzID0gYS5hY2hpZXZlbWVudHNHcm91cHMgfHwgW107CiAgICAgICAgdGhpcy5wbGF5ZXJBY2hpZXZlbWVudHMgPSBhLnBsYXllckFjaGlldmVtZW50cyB8fCBbXTsKICAgICAgICB0aGlzLmN1cnJlbnRBY2hpZXZlbWVudEluZGV4ID0gYS5jdXJyZW50QWNoaWV2ZW1lbnRJbmRleCB8fCAwOwogICAgICAgIHRoaXMuY3VycmVudEFjaGlldmVtZW50ID0gYS5jdXJyZW50QWNoaWV2ZW1lbnQgfHwge307CiAgICAgICAgdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnRzR3JvdXBJbmRleCA9IGEuY3VycmVudEFjaGlldmVtZW50c0dyb3VwSW5kZXggfHwgMDsKICAgICAgICB0aGlzLmN1cnJlbnRBY2hpZXZlbWVudHNHcm91cElkID0gYS5jdXJyZW50QWNoaWV2ZW1lbnRzR3JvdXBJZCB8fCAwOwogICAgICAgIHRoaXMuY3VycmVudEFjaGlldmVtZW50c0dyb3VwVGFnID0gYS5jdXJyZW50QWNoaWV2ZW1lbnRzR3JvdXBUYWcgfHwKICAgICAgICAgICAgIiI7CiAgICAgICAgdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnRzR3JvdXBOYW1lID0gYS5jdXJyZW50QWNoaWV2ZW1lbnRzR3JvdXBOYW1lIHx8ICIiOwogICAgICAgIHRoaXMuY3VycmVudEFjaGlldmVtZW50c0dyb3VwRGVzY3JpcHRpb24gPSBhLmN1cnJlbnRBY2hpZXZlbWVudHNHcm91cERlc2NyaXB0aW9uIHx8ICIiOwogICAgICAgIHRoaXMuY3VycmVudFBsYXllckFjaGlldmVtZW50SW5kZXggPSBhLmN1cnJlbnRQbGF5ZXJBY2hpZXZlbWVudEluZGV4IHx8IDA7CiAgICAgICAgdGhpcy5jdXJyZW50UGxheWVyQWNoaWV2ZW1lbnRJZCA9IGEuY3VycmVudFBsYXllckFjaGlldmVtZW50SWQgfHwgMDsKICAgICAgICB0aGlzLmN1cnJlbnRQbGF5ZXJBY2hpZXZlbWVudFVubG9ja0RhdGUgPSBhLmN1cnJlbnRQbGF5ZXJBY2hpZXZlbWVudFVubG9ja0RhdGUgfHwgIiI7CiAgICAgICAgdGhpcy5pc1VubG9ja0FjaGlldmVtZW50U3VjY2VzcyA9IGEuaXNVbmxvY2tBY2hpZXZlbWVudFN1Y2Nlc3MgfHwgITE7CiAgICAgICAgdGhpcy51bmxvY2tBY2hpZXZlbWVudEVycm9yID0gYS51bmxvY2tBY2hpZXZlbWVudEVycm9yIHx8ICIiOwogICAgICAgIHRoaXMucHJvZHVjdHMgPQogICAgICAgICAgICBhLnByb2R1Y3RzIHx8IFtdOwogICAgICAgIHRoaXMucGxheWVyUHVyY2hhc2VzID0gYS5wbGF5ZXJQdXJjaGFzZXMgfHwgW107CiAgICAgICAgdGhpcy5jdXJyZW50UHJvZHVjdEluZGV4ID0gYS5jdXJyZW50UHJvZHVjdEluZGV4IHx8IDA7CiAgICAgICAgdGhpcy5jdXJyZW50UHJvZHVjdCA9IGEuY3VycmVudFByb2R1Y3QgfHwgewogICAgICAgICAgICBpZDogYS5jdXJyZW50UHJvZHVjdC5pZCB8fCAwLAogICAgICAgICAgICB0YWc6IGEuY3VycmVudFByb2R1Y3QudGFnIHx8ICIiLAogICAgICAgICAgICBuYW1lOiBhLmN1cnJlbnRQcm9kdWN0Lm5hbWUgfHwgIiIsCiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBhLmN1cnJlbnRQcm9kdWN0LmRlc2NyaXB0aW9uIHx8ICIiLAogICAgICAgICAgICBpY29uOiBhLmN1cnJlbnRQcm9kdWN0Lmljb24gfHwgIiIsCiAgICAgICAgICAgIGljb25TbWFsbDogYS5jdXJyZW50UHJvZHVjdC5pY29uU21hbGwgfHwgIiIsCiAgICAgICAgICAgIHByaWNlOiBhLmN1cnJlbnRQcm9kdWN0LnByaWNlIHx8IDAsCiAgICAgICAgICAgIGN1cnJlbmN5OiBhLmN1cnJlbnRQcm9kdWN0LmN1cnJlbmN5IHx8ICIiLAogICAgICAgICAgICBjdXJyZW5jeVN5bWJvbDogYS5jdXJyZW50UHJvZHVjdC5jdXJyZW5jeVN5bWJvbCB8fCAiIgogICAgICAgIH07CiAgICAgICAgdGhpcy5jdXJyZW50UHJvZHVjdFB1cmNoYXNlcyA9CiAgICAgICAgICAgIGEuY3VycmVudFByb2R1Y3RQdXJjaGFzZXMgfHwgMDsKICAgICAgICB0aGlzLmN1cnJlbnRQdXJjaGFzZUluZGV4ID0gYS5jdXJyZW50UHVyY2hhc2VJbmRleCB8fCAwOwogICAgICAgIHRoaXMuY3VycmVudFB1cmNoYXNlID0gYS5jdXJyZW50UHVyY2hhc2UgfHwgewogICAgICAgICAgICBpZDogMCwKICAgICAgICAgICAgdGFnOiAiIiwKICAgICAgICAgICAgY3JlYXRlZEF0OiAiIgogICAgICAgIH07CiAgICAgICAgdGhpcy5sYXN0UGxheWVyc1RhZyA9IGEubGFzdFBsYXllcnNUYWc7CiAgICAgICAgdGhpcy5jdXJyZW50UGxheWVyc0luZGV4ID0gYS5jdXJyZW5QbGF5ZXJzSW5kZXggfHwgMDsKICAgICAgICB0aGlzLmN1cnJlbnRQbGF5ZXJzUGxheWVyID0gYS5jdXJyZW50UGxheWVyc1BsYXllciB8fCB7CiAgICAgICAgICAgIHN0YXRlOiB7fSwKICAgICAgICAgICAgYWNoaWV2ZW1lbnRzOiBbXSwKICAgICAgICAgICAgcHVyY2hhc2VzOiBbXQogICAgICAgIH07CiAgICAgICAgdGhpcy5pc1N1YnNjcmliZVByb2R1Y3RTdWNjZXNzID0gYS5pc1N1YnNjcmliZVByb2R1Y3RTdWNjZXNzIHx8ICExOwogICAgICAgIHRoaXMuaXNVbnN1YnNjcmliZVByb2R1Y3RTdWNjZXNzID0gYS5pc1Vuc3Vic2NyaWJlUHJvZHVjdFN1Y2Nlc3MgfHwgITE7CiAgICAgICAgdGhpcy5pc1B1cmNoYXNlUHJvZHVjdFN1Y2Nlc3MgPSBhLmlzUHVyY2hhc2VQcm9kdWN0U3VjY2VzcyB8fAogICAgICAgICAgICAhMTsKICAgICAgICB0aGlzLnB1cmNoYXNlUHJvZHVjdEVycm9yID0gYS5wdXJjaGFzZVByb2R1Y3RFcnJvciB8fCAiIjsKICAgICAgICB0aGlzLnB1cmNoYXNlZFByb2R1Y3RJZCA9IGEucHVyY2hhc2VkUHJvZHVjdElkIHx8IDA7CiAgICAgICAgdGhpcy5wdXJjaGFzZWRQcm9kdWN0VGFnID0gYS5wdXJjaGFzZWRQcm9kdWN0VGFnIHx8ICIiOwogICAgICAgIHRoaXMuaXNDb25zdW1lUHJvZHVjdFN1Y2Nlc3MgPSBhLmlzQ29uc3VtZVByb2R1Y3RTdWNjZXNzIHx8ICExOwogICAgICAgIHRoaXMuY29uc3VtZVByb2R1Y3RFcnJvciA9IGEuY29uc3VtZVByb2R1Y3RFcnJvciB8fCAiIjsKICAgICAgICB0aGlzLmNvbnN1bWVkUHJvZHVjdElkID0gYS5jb25zdW1lZFByb2R1Y3RJZCB8fCAwOwogICAgICAgIHRoaXMuY29uc3VtZWRQcm9kdWN0VGFnID0gYS5jb25zdW1lZFByb2R1Y3RUYWcgfHwgIiI7CiAgICAgICAgdGhpcy5nYW1lc0NvbGxlY3Rpb24gPSBhLmdhbWVzQ29sbGVjdGlvbiB8fCB7CiAgICAgICAgICAgIGlkOiAwLAogICAgICAgICAgICB0YWc6ICIiLAogICAgICAgICAgICBuYW1lOiAiIiwKICAgICAgICAgICAgZGVzY3JpcHRpb246ICIiLAogICAgICAgICAgICBnYW1lczogW10KICAgICAgICB9OwogICAgICAgIHRoaXMuY3VycmVudEdhbWVJbmRleCA9IGEuY3VycmVudEdhbWVJbmRleCB8fCAwOwogICAgICAgIHRoaXMuY3VycmVudEdhbWVJZCA9CiAgICAgICAgICAgIGEuY3VycmVudEdhbWVJZCB8fCAwOwogICAgICAgIHRoaXMuY3VycmVudEdhbWVOYW1lID0gYS5jdXJyZW50R2FtZU5hbWUgfHwgIiI7CiAgICAgICAgdGhpcy5jdXJyZW50R2FtZURlc2NyaXB0aW9uID0gYS5jdXJyZW50R2FtZURlc2NyaXB0aW9uIHx8ICIiOwogICAgICAgIHRoaXMuY3VycmVudEdhbWVJY29uID0gYS5jdXJyZW50R2FtZUljb24gfHwgIiI7CiAgICAgICAgdGhpcy5jdXJyZW50R2FtZVVybCA9IGEuY3VycmVudEdhbWVVcmwgfHwgIiI7CiAgICAgICAgdGhpcy5nYW1lc0NvbGxlY3Rpb25GZXRjaEVycm9yID0gYS5nYW1lc0NvbGxlY3Rpb25GZXRjaEVycm9yIHx8ICIiOwogICAgICAgIHRoaXMubGFzdEdhbWVzQ29sbGVjdGlvbklkT3JUYWcgPSBhLmxhc3RHYW1lc0NvbGxlY3Rpb25JZE9yVGFnIHx8ICIiOwogICAgICAgIHRoaXMuZG9jdW1lbnQgPSBhLmRvY3VtZW50IHx8IHsKICAgICAgICAgICAgdHlwZTogIiIsCiAgICAgICAgICAgIGNvbnRlbnQ6ICIiCiAgICAgICAgfTsKICAgICAgICB0aGlzLmxhc3REb2N1bWVudFR5cGUgPSBhLmxhc3REb2N1bWVudFR5cGUgfHwgIiI7CiAgICAgICAgdGhpcy5kb2N1bWVudEZldGNoRXJyb3IgPSBhLmRvY3VtZW50RmV0Y2hFcnJvciB8fCAiIjsKICAgICAgICB0aGlzLmxhc3RFcnJvciA9IGEubGFzdEVycm9yIHx8ICIiOwogICAgICAgIHRoaXMuaXNMYXN0QWN0aW9uU3VjY2VzcyA9IGEuaXNMYXN0QWN0aW9uU3VjY2VzcyB8fCAhMTsKICAgICAgICB0aGlzLmltYWdlcyA9IGEuaW1hZ2VzIHx8IFtdOwogICAgICAgIHRoaXMuY2FuTG9hZE1vcmVJbWFnZXMgPSBhLmNhbkxvYWRNb3JlSW1hZ2VzIHx8ICExOwogICAgICAgIHRoaXMuY3VycmVudEltYWdlSW5kZXggPSBhLmN1cnJlbnRJbWFnZUluZGV4IHx8IDA7CiAgICAgICAgdGhpcy5jdXJyZW50SW1hZ2VUYWdJbmRleCA9IGEuY3VycmVudEltYWdlVGFnSW5kZXggfHwgMDsKICAgICAgICB0aGlzLmN1cnJlbnRJbWFnZVRhZyA9IGEuY3VycmVudEltYWdlVGFnIHx8ICIiOwogICAgICAgIHRoaXMuY3VycmVudEltYWdlID0gYS5jdXJyZW50SW1hZ2UgfHwgewogICAgICAgICAgICBpZDogIiIsCiAgICAgICAgICAgIHBsYXllcklkOiAwLAogICAgICAgICAgICB3aWR0aDogMCwKICAgICAgICAgICAgaGVpZ2h0OiAwLAogICAgICAgICAgICBzcmM6ICIiLAogICAgICAgICAgICB0YWdzOiBbXQogICAgICAgIH07CiAgICAgICAgdGhpcy5maWxlcyA9IGEuZmlsZXMgfHwgW107CiAgICAgICAgdGhpcy5sYXN0RmlsZUNvbnRlbnQgPSBhLmxhc3RGaWxlQ29udGVudCB8fCAiIjsKICAgICAgICB0aGlzLmNhbkxvYWRNb3JlRmlsZXMgPSBhLmNhbkxvYWRNb3JlRmlsZXMgfHwgITE7CiAgICAgICAgdGhpcy5jdXJyZW50RmlsZUluZGV4ID0gYS5jdXJyZW50RmlsZUluZGV4IHx8CiAgICAgICAgICAgIDA7CiAgICAgICAgdGhpcy5jdXJyZW50RmlsZVRhZ0luZGV4ID0gYS5jdXJyZW50RmlsZVRhZ0luZGV4IHx8IDA7CiAgICAgICAgdGhpcy5jdXJyZW50RmlsZVRhZyA9IGEuY3VycmVudEZpbGVUYWcgfHwgIiI7CiAgICAgICAgdGhpcy5jdXJyZW50RmlsZSA9IGEuY3VycmVudEZpbGUgfHwgewogICAgICAgICAgICBpZDogIiIsCiAgICAgICAgICAgIHBsYXllcklkOiAwLAogICAgICAgICAgICBuYW1lOiAiIiwKICAgICAgICAgICAgc2l6ZTogMCwKICAgICAgICAgICAgc3JjOiAiIiwKICAgICAgICAgICAgdGFnczogW10KICAgICAgICB9OwogICAgICAgIHRoaXMuY3VycmVudFZhcmlhYmxlSW5kZXggPSBhLmN1cnJlbnRWYXJpYWJsZUluZGV4IHx8IDA7CiAgICAgICAgdGhpcy5jdXJyZW50VmFyaWFibGUgPSBhLmN1cnJlbnRWYXJpYWJsZSB8fCB7CiAgICAgICAgICAgIGtleTogIiIsCiAgICAgICAgICAgIHR5cGU6ICIiLAogICAgICAgICAgICB2YWx1ZTogIiIKICAgICAgICB9CiAgICB9CiAgICBHZXREZWJ1Z2dlclByb3BlcnRpZXMoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuaXNQbGF5ZXJSZWFkeSA/IFt7CiAgICAgICAgICAgIHRpdGxlOiAiR1MgLSBCYXNlIiwKICAgICAgICAgICAgcHJvcGVydGllczogW3sKICAgICAgICAgICAgICAgICAgICBuYW1lOiAiTGFuZ3VhZ2UiLAogICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLmdwLmxhbmd1YWdlCiAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgbmFtZTogIkF2YXRhciBHZW5lcmF0b3IiLAogICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLmdwLmF2YXRhckdlbmVyYXRvcgogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgIG5hbWU6ICJQbGF0Zm9ybSIsCiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuZ3AucGxhdGZvcm0udHlwZQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBuYW1lOiAiTGFzdCBFcnJvciIsCiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMubGFzdEVycm9yCiAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgbmFtZTogIklzIExhc3QgQWN0aW9uIFN1Y2Nlc3MiLAogICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLmlzTGFzdEFjdGlvblN1Y2Nlc3MKICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICBuYW1lOiAiSXMgTW9iaWxlIiwKICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5ncC5pc01vYmlsZQogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgIG5hbWU6ICJJcyBEZXYiLAogICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLmdwLmlzRGV2CiAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgbmFtZTogIklzIFBhdXNlZCIsCiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuZ3AuaXNQYXVzZWQKICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICBuYW1lOiAiSXMgR2FtZXBsYXkiLAogICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLmdwLmlzR2FtZXBsYXkKICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICBuYW1lOiAiSXMgQWxsb3dlZCBPcmlnaW4iLAogICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLmdwLmlzQWxsb3dlZE9yaWdpbgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBdCiAgICAgICAgfSwgewogICAgICAgICAgICB0aXRsZTogIkdTIC0gQWRzIiwKICAgICAgICAgICAgcHJvcGVydGllczogW3sKICAgICAgICAgICAgICAgIG5hbWU6ICJMYXN0IEFkIFN1Y2Nlc3MiLAogICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuaXNMYXN0QWRTdWNjZXNzCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgIG5hbWU6ICJBZGJsb2NrIEVuYWJsZWQiLAogICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuZ3AuYWRzLmlzQWRibG9ja0VuYWJsZWQKICAgICAgICAgICAgfV0KICAgICAgICB9LCB7CiAgICAgICAgICAgIHRpdGxlOiAiR1MgLSBMZWFkZXJib2FyZHMiLAogICAgICAgICAgICBwcm9wZXJ0aWVzOiBbewogICAgICAgICAgICAgICAgbmFtZTogIlBsYXllciBQb3NpdGlvbiIsCiAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5sZWFkZXJib2FyZFBsYXllclBvc2l0aW9uCiAgICAgICAgICAgIH1dCiAgICAgICAgfSwgewogICAgICAgICAgICB0aXRsZTogIkdTIC0gUGxheWVyIiwKICAgICAgICAgICAgcHJvcGVydGllczogW3sKICAgICAgICAgICAgICAgIG5hbWU6ICJJRCIsCiAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5ncC5wbGF5ZXIuaWQKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgbmFtZTogIkxvZ2dlZCBJbiBCeSBQbGF0Zm9ybSIsCiAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5ncC5wbGF5ZXIuaXNMb2dnZWRJbkJ5UGxhdGZvcm0KICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgbmFtZTogIklzIFN0dWIiLAogICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuZ3AucGxheWVyLmlzU3R1YgogICAgICAgICAgICB9LCAuLi50aGlzLmdwLnBsYXllci5maWVsZHMubWFwKGEgPT4gKHsKICAgICAgICAgICAgICAgIG5hbWU6IHRoaXMuZ3AucGxheWVyLmdldEZpZWxkTmFtZShhLmtleSksCiAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5ncC5wbGF5ZXIuZ2V0KGEua2V5KSwKICAgICAgICAgICAgICAgIG9uZWRpdDogYiA9PiB0aGlzLkNhbGxBY3Rpb24odGhpcy5hY3Rpb25zLlBsYXllclNldCwgYS5rZXksIGIpCiAgICAgICAgICAgIH0pKV0KICAgICAgICB9LCB7CiAgICAgICAgICAgIHRpdGxlOiAiR1MgLSBBY2hpZXZlbWVudHMgLSBDdXJyZW50IiwKICAgICAgICAgICAgcHJvcGVydGllczogW3sKICAgICAgICAgICAgICAgICAgICBuYW1lOiAiSW5kZXgiLAogICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLmN1cnJlbnRBY2hpZXZlbWVudEluZGV4CiAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgbmFtZTogIklEIiwKICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnQuaWQKICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICBuYW1lOiAiVGFnIiwKICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnQudGFnCiAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgbmFtZTogIk5hbWUiLAogICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLmN1cnJlbnRBY2hpZXZlbWVudC5uYW1lCiAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgbmFtZTogIkRlc2NyaXB0aW9uIiwKICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnQuZGVzY3JpcHRpb24KICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICBuYW1lOiAiUmFyZSIsCiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuY3VycmVudEFjaGlldmVtZW50LnJhcmUKICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICBuYW1lOiAiVW5sb2NrZWQiLAogICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLmN1cnJlbnRBY2hpZXZlbWVudC51bmxvY2tlZAogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgIG5hbWU6ICJJY29uIiwKICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnQuaWNvbgogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgIG5hbWU6ICJJY29uIFNtYWxsIiwKICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnQuaWNvblNtYWxsCiAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgbmFtZTogIkxvY2tlZCBJY29uIiwKICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnQubG9ja2VkSWNvbgogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgIG5hbWU6ICJMb2NrZWQgSWNvbiBTbWFsbCIsCiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuY3VycmVudEFjaGlldmVtZW50LmxvY2tlZEljb25TbWFsbAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBuYW1lOiAiUHJvZ3Jlc3MiLAogICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLmN1cnJlbnRBY2hpZXZlbWVudC5wcm9ncmVzcwogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgIG5hbWU6ICJNYXggUHJvZ3Jlc3MiLAogICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLmN1cnJlbnRBY2hpZXZlbWVudC5tYXhQcm9ncmVzcwogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgIG5hbWU6ICJQcm9ncmVzcyBTdGVwIiwKICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnQucHJvZ3Jlc3NTdGVwCiAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgbmFtZTogIkxvY2tlZCBWaXNpYmxlIiwKICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnQubG9ja2VkVmlzaWJsZQogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgIG5hbWU6ICJMb2NrZWQgRGVzY3JpcHRpb24gVmlzaWJsZSIsCiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuY3VycmVudEFjaGlldmVtZW50LmxvY2tlZERlc2NyaXB0aW9uVmlzaWJsZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBdCiAgICAgICAgfSwgewogICAgICAgICAgICB0aXRsZTogIkdTIC0gQWNoaWV2ZW1lbnRzIEdyb3VwcyBMb29wIiwKICAgICAgICAgICAgcHJvcGVydGllczogW3sKICAgICAgICAgICAgICAgIG5hbWU6ICJDdXJyZW50IEFjaGlldmVtZW50cyBHcm91cCBJbmRleCIsCiAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnRzR3JvdXBJbmRleAogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICBuYW1lOiAiQ3VycmVudCBBY2hpZXZlbWVudHMgR3JvdXAgSUQiLAogICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuY3VycmVudEFjaGlldmVtZW50c0dyb3VwSWQKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgbmFtZTogIkN1cnJlbnQgQWNoaWV2ZW1lbnRzIEdyb3VwIFRhZyIsCiAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnRzR3JvdXBUYWcKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgbmFtZTogIkN1cnJlbnQgQWNoaWV2ZW1lbnRzIEdyb3VwIE5hbWUiLAogICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuY3VycmVudEFjaGlldmVtZW50c0dyb3VwTmFtZQogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICBuYW1lOiAiQ3VycmVudCBBY2hpZXZlbWVudHMgR3JvdXAgRGVzY3JpcHRpb24iLAogICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuY3VycmVudEFjaGlldmVtZW50c0dyb3VwRGVzY3JpcHRpb24KICAgICAgICAgICAgfV0KICAgICAgICB9LCB7CiAgICAgICAgICAgIHRpdGxlOiAiR1MgLSBQbGF5ZXIgQWNoaWV2ZW1lbnRzIExvb3AiLAogICAgICAgICAgICBwcm9wZXJ0aWVzOiBbewogICAgICAgICAgICAgICAgICAgIG5hbWU6ICJDdXJyZW50IFBsYXllciBBY2hpZXZlbWVudCBJbmRleCIsCiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuY3VycmVudFBsYXllckFjaGlldmVtZW50SW5kZXgKICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICBuYW1lOiAiQ3VycmVudCBQbGF5ZXIgQWNoaWV2ZW1lbnQgSUQiLAogICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLmN1cnJlbnRQbGF5ZXJBY2hpZXZlbWVudElkCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIG5hbWU6ICJDdXJyZW50IFBsYXllciBBY2hpZXZlbWVudCBVbmxvY2sgRGF0ZSIsCiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuY3VycmVudFBsYXllckFjaGlldmVtZW50VW5sb2NrRGF0ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBdCiAgICAgICAgfSwgewogICAgICAgICAgICB0aXRsZTogIkdTIC0gUHJvZHVjdHMgTG9vcCIsCiAgICAgICAgICAgIHByb3BlcnRpZXM6IFt7CiAgICAgICAgICAgICAgICAgICAgbmFtZTogIkN1cnJlbnQgUHJvZHVjdCBJbmRleCIsCiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuY3VycmVudFByb2R1Y3RJbmRleAogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgIG5hbWU6ICJDdXJyZW50IFByb2R1Y3QgSUQiLAogICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLmN1cnJlbnRQcm9kdWN0LmlkCiAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgbmFtZTogIkN1cnJlbnQgUHJvZHVjdCBUYWciLAogICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLmN1cnJlbnRQcm9kdWN0LnRhZwogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgIG5hbWU6ICJDdXJyZW50IFByb2R1Y3QgTmFtZSIsCiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuY3VycmVudFByb2R1Y3QubmFtZQogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgIG5hbWU6ICJDdXJyZW50IFByb2R1Y3QgRGVzY3JpcHRpb24iLAogICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLmN1cnJlbnRQcm9kdWN0LmRlc2NyaXB0aW9uCiAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgbmFtZTogIkN1cnJlbnQgUHJvZHVjdCBJY29uIiwKICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5jdXJyZW50UHJvZHVjdC5pY29uCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIG5hbWU6ICJDdXJyZW50IFByb2R1Y3QgSWNvbiBTbWFsbCIsCiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuY3VycmVudFByb2R1Y3QuaWNvblNtYWxsCiAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgbmFtZTogIkN1cnJlbnQgUHJvZHVjdCBJY29uIiwKICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5jdXJyZW50UHJvZHVjdC5pY29uCiAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgbmFtZTogIkN1cnJlbnQgUHJvZHVjdCBQcmljZSIsCiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuY3VycmVudFByb2R1Y3QucHJpY2UKICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICBuYW1lOiAiQ3VycmVudCBQcm9kdWN0IEN1cnJlbmN5IiwKICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5jdXJyZW50UHJvZHVjdC5jdXJyZW5jeQogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgIG5hbWU6ICJDdXJyZW50IFByb2R1Y3QgQ3VycmVuY3lTeW1ib2wiLAogICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLmN1cnJlbnRQcm9kdWN0LmN1cnJlbmN5U3ltYm9sCiAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgbmFtZTogIkN1cnJlbnQgUHJvZHVjdCBQdXJjaGFzZXMiLAogICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLmN1cnJlbnRQcm9kdWN0UHVyY2hhc2VzCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIF0KICAgICAgICB9LCB7CiAgICAgICAgICAgIHRpdGxlOiAiR1MgLSBQdXJjaGFzZWQgUHJvZHVjdCIsCiAgICAgICAgICAgIHByb3BlcnRpZXM6IFt7CiAgICAgICAgICAgICAgICAgICAgbmFtZTogIklzIHB1cmNoYXNlIHN1Y2Nlc3NmdWwiLAogICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLmlzUHVyY2hhc2VQcm9kdWN0U3VjY2VzcwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBuYW1lOiAiUHVyY2hhc2UgZXJyb3IiLAogICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLnB1cmNoYXNlUHJvZHVjdEVycm9yCiAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgbmFtZTogIlB1cmNoYXNlZCBQcm9kdWN0IElEIiwKICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5wdXJjaGFzZWRQcm9kdWN0SWQKICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICBuYW1lOiAiUHVyY2hhc2VkIFByb2R1Y3QgVGFnIiwKICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5wdXJjaGFzZWRQcm9kdWN0VGFnCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIF0KICAgICAgICB9LCB7CiAgICAgICAgICAgIHRpdGxlOiAiR1MgLSBDb25zdW1lZCBQcm9kdWN0IiwKICAgICAgICAgICAgcHJvcGVydGllczogW3sKICAgICAgICAgICAgICAgIG5hbWU6ICJJcyBjb25zdW1lIHN1Y2Nlc3NmdWwiLAogICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuaXNDb25zdW1lUHJvZHVjdFN1Y2Nlc3MKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgbmFtZTogIkNvbnN1bWUgZXJyb3IiLAogICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuY29uc3VtZVByb2R1Y3RFcnJvcgogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICBuYW1lOiAiQ29uc3VtZWQgUHJvZHVjdCBJRCIsCiAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5jb25zdW1lZFByb2R1Y3RJZAogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICBuYW1lOiAiQ29uc3VtZWQgUHJvZHVjdCBUYWciLAogICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuY29uc3VtZWRQcm9kdWN0VGFnCiAgICAgICAgICAgIH1dCiAgICAgICAgfSwgewogICAgICAgICAgICB0aXRsZTogIkdTIC0gTGFzdCBHYW1lcyBDb2xsZWN0aW9uIiwKICAgICAgICAgICAgcHJvcGVydGllczogW3sKICAgICAgICAgICAgICAgIG5hbWU6ICJDb2xsZWN0aW9uIElEIiwKICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLmdhbWVzQ29sbGVjdGlvbi5pZAogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICBuYW1lOiAiQ29sbGVjdGlvbiBUYWciLAogICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuZ2FtZXNDb2xsZWN0aW9uLnRhZwogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICBuYW1lOiAiQ29sbGVjdGlvbiBOYW1lIiwKICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLmdhbWVzQ29sbGVjdGlvbi5uYW1lCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgIG5hbWU6ICJDb2xsZWN0aW9uIERlc2NyaXB0aW9uIiwKICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLmdhbWVzQ29sbGVjdGlvbi5kZXNjcmlwdGlvbgogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICBuYW1lOiAiRmV0Y2ggRXJyb3IiLAogICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuZ2FtZXNDb2xsZWN0aW9uRmV0Y2hFcnJvcgogICAgICAgICAgICB9XQogICAgICAgIH0sIHsKICAgICAgICAgICAgdGl0bGU6ICJHUyAtIEdhbWVzIGluIENvbGxlY3Rpb24iLAogICAgICAgICAgICBwcm9wZXJ0aWVzOiBbewogICAgICAgICAgICAgICAgbmFtZTogIkN1cnJlbnQgR2FtZSBJbmRleCIsCiAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5jdXJyZW50R2FtZUluZGV4CiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgIG5hbWU6ICJDdXJyZW50IEdhbWUgSUQiLAogICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuY3VycmVudEdhbWVJZAogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICBuYW1lOiAiQ3VycmVudCBHYW1lIE5hbWUiLAogICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuY3VycmVudEdhbWVOYW1lCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgIG5hbWU6ICJDdXJyZW50IEdhbWUgRGVzY3JpcHRpb24iLAogICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuY3VycmVudEdhbWVEZXNjcmlwdGlvbgogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICBuYW1lOiAiQ3VycmVudCBHYW1lIEljb24iLAogICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuY3VycmVudEdhbWVJY29uCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgIG5hbWU6ICJDdXJyZW50IEdhbWUgVXJsIiwKICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLmN1cnJlbnRHYW1lVXJsCiAgICAgICAgICAgIH1dCiAgICAgICAgfSwgewogICAgICAgICAgICB0aXRsZTogIkdTIC0gRG9jdW1lbnRzIiwKICAgICAgICAgICAgcHJvcGVydGllczogW3sKICAgICAgICAgICAgICAgIG5hbWU6ICJEb2N1bWVudCBUeXBlIiwKICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLmRvY3VtZW50LnR5cGUKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgbmFtZTogIkRvY3VtZW50IENvbnRlbnQiLAogICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuZG9jdW1lbnQuY29udGVudAogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICBuYW1lOiAiRmV0Y2ggRXJyb3IiLAogICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuZG9jdW1lbnRGZXRjaEVycm9yCiAgICAgICAgICAgIH1dCiAgICAgICAgfV0gOiBbXQogICAgfQp9OwoidXNlIHN0cmljdCI7CgpmdW5jdGlvbiBlYWNoKGEsIGIsIGQpIHsKICAgIGNvbnN0IGMgPSBhLkdldEV2ZW50U2hlZXRNYW5hZ2VyKCksCiAgICAgICAgZSA9IGEuR2V0Q3VycmVudEV2ZW50KCksCiAgICAgICAgZyA9IGUuR2V0U29sTW9kaWZpZXJzKCk7CiAgICBhID0gYS5HZXRFdmVudFN0YWNrKCk7CiAgICBjb25zdCBrID0gYS5HZXRDdXJyZW50U3RhY2tGcmFtZSgpLAogICAgICAgIG0gPSBhLlB1c2goZSk7CiAgICBiLmZvckVhY2goKG4sIHEpID0+IHsKICAgICAgICBkKG4sIHEpOwogICAgICAgIGMuUHVzaENvcHlTb2woZyk7CiAgICAgICAgZS5SZXRyaWdnZXIoaywgbSk7CiAgICAgICAgYy5Qb3BTb2woZykKICAgIH0pOwogICAgYS5Qb3AoKQp9CkMzLlBsdWdpbnMuRXBvbmVzaF9HYW1lU2NvcmUuQ25kcyA9IHsKICAgIE9uUGxheWVyQ2hhbmdlKCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIE9uUGxheWVyU3luY0NvbXBsZXRlKCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIE9uUGxheWVyU3luY0Vycm9yKCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIE9uUGxheWVyTG9hZENvbXBsZXRlKCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIE9uUGxheWVyTG9hZEVycm9yKCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIE9uUGxheWVyTG9naW5Db21wbGV0ZSgpIHsKICAgICAgICByZXR1cm4gITAKICAgIH0sCiAgICBPblBsYXllckxvZ2luRXJyb3IoKSB7CiAgICAgICAgcmV0dXJuICEwCiAgICB9LAogICAgT25QbGF5ZXJGZXRjaEZpZWxkc0NvbXBsZXRlKCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIE9uUGxheWVyRmV0Y2hGaWVsZHNFcnJvcigpIHsKICAgICAgICByZXR1cm4gITAKICAgIH0sCiAgICBPblBsYXllclJlYWR5KCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIElzUGxheWVyUmVhZHkoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuaXNQbGF5ZXJSZWFkeQogICAgfSwKICAgIElzUGxheWVyU3R1YigpIHsKICAgICAgICByZXR1cm4gdGhpcy5ncC5wbGF5ZXIuaXNTdHViCiAgICB9LAogICAgSXNQbGF5ZXJMb2dnZWRJbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5ncC5wbGF5ZXIuaXNMb2dnZWRJbgogICAgfSwKICAgIFBsYXllckhhc0tleShhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZ3AucGxheWVyLmhhcyhhKQogICAgfSwKICAgIFBsYXllckZpZWxkSXNFbnVtKGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5ncC5wbGF5ZXIuZ2V0RmllbGQoYSkudmFyaWFudHMubGVuZ3RoCiAgICB9LAogICAgUGxheWVyQ29tcGFyZVNjb3JlKGEsIGIpIHsKICAgICAgICByZXR1cm4gdGhpcy5tYXBwZXJzLmNvbXBhcmVbYV0odGhpcy5ncC5wbGF5ZXIuc2NvcmUsIGIpCiAgICB9LAogICAgUGxheWVyQ29tcGFyZShhLCBiLCBkKSB7CiAgICAgICAgcmV0dXJuIHRoaXMubWFwcGVycy5jb21wYXJlW2JdKHRoaXMuZ3AucGxheWVyLmdldChhKSwgZCkKICAgIH0sCiAgICBQbGF5ZXJFYWNoRmllbGQoKSB7CiAgICAgICAgcmV0dXJuIGVhY2godGhpcy5fcnVudGltZSwgdGhpcy5ncC5wbGF5ZXIuZmllbGRzLCBhID0+IHsKICAgICAgICAgICAgdGhpcy5jdXJyZW50UGxheWVyRmllbGRLZXkgPSBhLmtleTsKICAgICAgICAgICAgdGhpcy5jdXJyZW50UGxheWVyRmllbGRUeXBlID0gYS50eXBlOwogICAgICAgICAgICB0aGlzLmN1cnJlbnRQbGF5ZXJGaWVsZE5hbWUgPSBhLm5hbWU7CiAgICAgICAgICAgIHRoaXMuY3VycmVudFBsYXllckZpZWxkVmFsdWUgPSB0aGlzLmdwLnBsYXllci5nZXQoYS5rZXkpCiAgICAgICAgfSksICExCiAgICB9LAogICAgUGxheWVyRWFjaEZpZWxkVmFyaWFudChhKSB7CiAgICAgICAgcmV0dXJuIGVhY2godGhpcy5fcnVudGltZSwKICAgICAgICAgICAgdGhpcy5ncC5wbGF5ZXIuZ2V0RmllbGQoYSkudmFyaWFudHMsIChiLCBkKSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRQbGF5ZXJGaWVsZFZhcmlhbnRWYWx1ZSA9IGIudmFsdWU7CiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRQbGF5ZXJGaWVsZFZhcmlhbnROYW1lID0gYi5uYW1lOwogICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50UGxheWVyRmllbGRWYXJpYW50SW5kZXggPSBkCiAgICAgICAgICAgIH0pLCAhMQogICAgfSwKICAgIE9uTGVhZGVyYm9hcmRPcGVuKCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIE9uTGVhZGVyYm9hcmRGZXRjaChhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMubGFzdExlYWRlcmJvYXJkVGFnID09PSBhCiAgICB9LAogICAgT25MZWFkZXJib2FyZEFueUZldGNoKCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIE9uTGVhZGVyYm9hcmRGZXRjaEVycm9yKGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5sYXN0TGVhZGVyYm9hcmRUYWcgPT09IGEKICAgIH0sCiAgICBPbkxlYWRlcmJvYXJkQW55RmV0Y2hFcnJvcigpIHsKICAgICAgICByZXR1cm4gITAKICAgIH0sCiAgICBPbkxlYWRlcmJvYXJkRmV0Y2hQbGF5ZXIoYSkgewogICAgICAgIHJldHVybiB0aGlzLmxhc3RMZWFkZXJib2FyZFBsYXllclJhdGluZ1RhZyA9PT0gYQogICAgfSwKICAgIE9uTGVhZGVyYm9hcmRBbnlGZXRjaFBsYXllcigpIHsKICAgICAgICByZXR1cm4gITAKICAgIH0sCiAgICBPbkxlYWRlcmJvYXJkRmV0Y2hQbGF5ZXJFcnJvcihhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMubGFzdExlYWRlcmJvYXJkUGxheWVyUmF0aW5nVGFnID09PSBhCiAgICB9LAogICAgT25MZWFkZXJib2FyZEFueUZldGNoUGxheWVyRXJyb3IoKSB7CiAgICAgICAgcmV0dXJuICEwCiAgICB9LAogICAgT25MZWFkZXJib2FyZFB1Ymxpc2hSZWNvcmQoKSB7CiAgICAgICAgcmV0dXJuICEwCiAgICB9LAogICAgT25MZWFkZXJib2FyZFB1Ymxpc2hSZWNvcmRFcnJvcigpIHsKICAgICAgICByZXR1cm4gITAKICAgIH0sCiAgICBMZWFkZXJib2FyZEVhY2hQbGF5ZXIoKSB7CiAgICAgICAgcmV0dXJuIGVhY2godGhpcy5fcnVudGltZSwgdGhpcy5sZWFkZXJib2FyZCwgKGEsIGIpID0+IHsKICAgICAgICAgICAgdGhpcy5jdXJyZW50TGVhZGVyYm9hcmRJbmRleCA9IGI7CiAgICAgICAgICAgIHRoaXMuY3VycmVudExlYWRlcmJvYXJkUGxheWVyID0gYQogICAgICAgIH0pLCAhMQogICAgfSwKICAgIE9uQWNoaWV2ZW1lbnRzT3BlbigpIHsKICAgICAgICByZXR1cm4gITAKICAgIH0sCiAgICBPbkFjaGlldmVtZW50c0Nsb3NlKCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIE9uQWNoaWV2ZW1lbnRzRmV0Y2goKSB7CiAgICAgICAgcmV0dXJuICEwCiAgICB9LAogICAgT25BY2hpZXZlbWVudHNGZXRjaEVycm9yKCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIE9uQWNoaWV2ZW1lbnRzVW5sb2NrKGEpIHsKICAgICAgICB2YXIgYiA9CiAgICAgICAgICAgIHBhcnNlSW50KGEsIDEwKSB8fCAwOwogICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRBY2hpZXZlbWVudC50YWcgPT09IGEgfHwgdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnQuaWQgPT09IGIKICAgIH0sCiAgICBPbkFjaGlldmVtZW50c0FueVVubG9jaygpIHsKICAgICAgICByZXR1cm4gITAKICAgIH0sCiAgICBPbkFjaGlldmVtZW50c0FueVVubG9ja0Vycm9yKCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIE9uQWNoaWV2ZW1lbnRzU2V0UHJvZ3Jlc3MoYSkgewogICAgICAgIHZhciBiID0gcGFyc2VJbnQoYSwgMTApIHx8IDA7CiAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudEFjaGlldmVtZW50LnRhZyA9PT0gYSB8fCB0aGlzLmN1cnJlbnRBY2hpZXZlbWVudC5pZCA9PT0gYgogICAgfSwKICAgIE9uQWNoaWV2ZW1lbnRzQW55U2V0UHJvZ3Jlc3MoKSB7CiAgICAgICAgcmV0dXJuICEwCiAgICB9LAogICAgT25BY2hpZXZlbWVudHNBbnlTZXRQcm9ncmVzc0Vycm9yKCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIEFjaGlldmVtZW50c0VhY2hBY2hpZXZlbWVudCgpIHsKICAgICAgICByZXR1cm4gZWFjaCh0aGlzLl9ydW50aW1lLCB0aGlzLmFjaGlldmVtZW50cywgKGEsIGIpID0+IHsKICAgICAgICAgICAgdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnRJbmRleCA9IGI7CiAgICAgICAgICAgIHRoaXMuY3VycmVudEFjaGlldmVtZW50ID0KICAgICAgICAgICAgICAgIGE7CiAgICAgICAgICAgIChiID0gdGhpcy5wbGF5ZXJBY2hpZXZlbWVudHMuZmluZChkID0+IGQuYWNoaWV2ZW1lbnRJZCA9PT0gYS5pZCkpICYmICh0aGlzLmN1cnJlbnRBY2hpZXZlbWVudC51bmxvY2tlZCA9IGIudW5sb2NrZWQsIHRoaXMuY3VycmVudEFjaGlldmVtZW50LnByb2dyZXNzID0gYi5wcm9ncmVzcykKICAgICAgICB9KSwgITEKICAgIH0sCiAgICBBY2hpZXZlbWVudHNFYWNoQWNoaWV2ZW1lbnRJbkdyb3VwKGEpIHsKICAgICAgICBjb25zdCBiID0gcGFyc2VJbnQoYSwgMTApIHx8IDA7CiAgICAgICAgdmFyIGQgPSB0aGlzLmFjaGlldmVtZW50c0dyb3Vwcy5maW5kKGMgPT4gYy50YWcgPT09IGEgfHwgYy5pZCA9PT0gYik7CiAgICAgICAgZCA9IGQgPyBkLmFjaGlldmVtZW50cy5yZWR1Y2UoKGMsIGUpID0+IHsKICAgICAgICAgICAgdmFyIGcgPSB0aGlzLmFjaGlldmVtZW50cy5maW5kKGsgPT4gay5pZCA9PT0gZSk7CiAgICAgICAgICAgIHJldHVybiBnICYmIGMucHVzaChnKSwgYwogICAgICAgIH0sIFtdKSA6IFtdOwogICAgICAgIHJldHVybiBlYWNoKHRoaXMuX3J1bnRpbWUsIGQsIChjLCBlKSA9PiB7CiAgICAgICAgICAgIHRoaXMuY3VycmVudEFjaGlldmVtZW50SW5kZXggPSBlOwogICAgICAgICAgICB0aGlzLmN1cnJlbnRBY2hpZXZlbWVudCA9IGM7CiAgICAgICAgICAgIChlID0gdGhpcy5wbGF5ZXJBY2hpZXZlbWVudHMuZmluZChnID0+CiAgICAgICAgICAgICAgICBnLmFjaGlldmVtZW50SWQgPT09IGMuaWQpKSAmJiAodGhpcy5jdXJyZW50QWNoaWV2ZW1lbnQudW5sb2NrZWQgPSBlLnVubG9ja2VkLCB0aGlzLmN1cnJlbnRBY2hpZXZlbWVudC5wcm9ncmVzcyA9IGUucHJvZ3Jlc3MpCiAgICAgICAgfSksICExCiAgICB9LAogICAgQWNoaWV2ZW1lbnRzRWFjaEFjaGlldmVtZW50c0dyb3VwKCkgewogICAgICAgIHJldHVybiBlYWNoKHRoaXMuX3J1bnRpbWUsIHRoaXMuYWNoaWV2ZW1lbnRzR3JvdXBzLCAoYSwgYikgPT4gewogICAgICAgICAgICB0aGlzLmN1cnJlbnRBY2hpZXZlbWVudHNHcm91cEluZGV4ID0gYjsKICAgICAgICAgICAgdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnRzR3JvdXBJZCA9IGEuaWQ7CiAgICAgICAgICAgIHRoaXMuY3VycmVudEFjaGlldmVtZW50c0dyb3VwVGFnID0gYS50YWc7CiAgICAgICAgICAgIHRoaXMuY3VycmVudEFjaGlldmVtZW50c0dyb3VwTmFtZSA9IGEubmFtZTsKICAgICAgICAgICAgdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnRzR3JvdXBEZXNjcmlwdGlvbiA9IGEuZGVzY3JpcHRpb24KICAgICAgICB9KSwgITEKICAgIH0sCiAgICBBY2hpZXZlbWVudHNFYWNoUGxheWVyQWNoaWV2ZW1lbnRzKCkgewogICAgICAgIHJldHVybiBlYWNoKHRoaXMuX3J1bnRpbWUsIHRoaXMuZ3AuYWNoaWV2ZW1lbnRzLnVubG9ja2VkTGlzdCwKICAgICAgICAgICAgKGEsIGIpID0+IHsKICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFBsYXllckFjaGlldmVtZW50SW5kZXggPSBiOwogICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50UGxheWVyQWNoaWV2ZW1lbnRJZCA9IGEuaWQ7CiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRQbGF5ZXJBY2hpZXZlbWVudFVubG9ja0RhdGUgPSBhLmNyZWF0ZWRBdAogICAgICAgICAgICB9KSwgITEKICAgIH0sCiAgICBJc0FjaGlldmVtZW50c0N1ckFjaGlldmVtZW50VW5sb2NrZWQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudEFjaGlldmVtZW50LnVubG9ja2VkCiAgICB9LAogICAgSXNBY2hpZXZlbWVudHNDdXJBY2hpZXZlbWVudExvY2tlZFZpc2libGUoKSB7CiAgICAgICAgcmV0dXJuICEhdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnQuaXNMb2NrZWRWaXNpYmxlCiAgICB9LAogICAgSXNBY2hpZXZlbWVudHNDdXJBY2hpZXZlbWVudExvY2tlZERlc2NyaXB0aW9uVmlzaWJsZSgpIHsKICAgICAgICByZXR1cm4gISF0aGlzLmN1cnJlbnRBY2hpZXZlbWVudC5pc0xvY2tlZERlc2NyaXB0aW9uVmlzaWJsZQogICAgfSwKICAgIElzQWNoaWV2ZW1lbnRzVW5sb2NrU3VjY2Vzc2Z1bCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5pc1VubG9ja0FjaGlldmVtZW50U3VjY2VzcwogICAgfSwKICAgIEFjaGlldmVtZW50c0lzVW5sb2NrZWQoYSkgewogICAgICAgIHJldHVybiB0aGlzLmdwLmFjaGlldmVtZW50cy5oYXMoYSkKICAgIH0sCiAgICBPblBheW1lbnRzRmV0Y2hQcm9kdWN0cygpIHsKICAgICAgICByZXR1cm4gITAKICAgIH0sCiAgICBPblBheW1lbnRzRmV0Y2hQcm9kdWN0c0Vycm9yKCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIE9uRXZlbnRDb25uZWN0KCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIE9uUGF5bWVudHNQdXJjaGFzZShhKSB7CiAgICAgICAgdmFyIGIgPSBwYXJzZUludChhLCAxMCkgfHwgMDsKICAgICAgICByZXR1cm4gdGhpcy5wdXJjaGFzZWRQcm9kdWN0VGFnID09PSBhIHx8IHRoaXMucHVyY2hhc2VkUHJvZHVjdElkID09PSBiCiAgICB9LAogICAgT25QYXltZW50c1B1cmNoYXNlRXJyb3IoYSkgewogICAgICAgIHZhciBiID0gcGFyc2VJbnQoYSwgMTApIHx8IDA7CiAgICAgICAgcmV0dXJuIHRoaXMucHVyY2hhc2VkUHJvZHVjdFRhZyA9PT0gYSB8fCB0aGlzLnB1cmNoYXNlZFByb2R1Y3RJZCA9PT0gYgogICAgfSwKICAgIE9uUGF5bWVudHNBbnlQdXJjaGFzZSgpIHsKICAgICAgICByZXR1cm4gITAKICAgIH0sCiAgICBPblBheW1lbnRzQW55UHVyY2hhc2VFcnJvcigpIHsKICAgICAgICByZXR1cm4gITAKICAgIH0sCiAgICBPblBheW1lbnRzQ29uc3VtZShhKSB7CiAgICAgICAgdmFyIGIgPSBwYXJzZUludChhLAogICAgICAgICAgICAxMCkgfHwgMDsKICAgICAgICByZXR1cm4gdGhpcy5jb25zdW1lZFByb2R1Y3RUYWcgPT09IGEgfHwgdGhpcy5jb25zdW1lZFByb2R1Y3RJZCA9PT0gYgogICAgfSwKICAgIE9uUGF5bWVudHNDb25zdW1lRXJyb3IoYSkgewogICAgICAgIHZhciBiID0gcGFyc2VJbnQoYSwgMTApIHx8IDA7CiAgICAgICAgcmV0dXJuIHRoaXMuY29uc3VtZWRQcm9kdWN0VGFnID09PSBhIHx8IHRoaXMuY29uc3VtZWRQcm9kdWN0SWQgPT09IGIKICAgIH0sCiAgICBPblBheW1lbnRzQW55Q29uc3VtZSgpIHsKICAgICAgICByZXR1cm4gITAKICAgIH0sCiAgICBPblBheW1lbnRzQW55Q29uc3VtZUVycm9yKCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIE9uUGF5bWVudHNTdWJzY3JpYmUoYSkgewogICAgICAgIHZhciBiID0gcGFyc2VJbnQoYSwgMTApIHx8IDA7CiAgICAgICAgcmV0dXJuIHRoaXMucHVyY2hhc2VkUHJvZHVjdFRhZyA9PT0gYSB8fCB0aGlzLnB1cmNoYXNlZFByb2R1Y3RJZCA9PT0gYgogICAgfSwKICAgIE9uUGF5bWVudHNTdWJzY3JpYmVFcnJvcihhKSB7CiAgICAgICAgdmFyIGIgPSBwYXJzZUludChhLCAxMCkgfHwgMDsKICAgICAgICByZXR1cm4gdGhpcy5wdXJjaGFzZWRQcm9kdWN0VGFnID09PSBhIHx8IHRoaXMucHVyY2hhc2VkUHJvZHVjdElkID09PSBiCiAgICB9LAogICAgT25QYXltZW50c0FueVN1YnNjcmliZSgpIHsKICAgICAgICByZXR1cm4gITAKICAgIH0sCiAgICBPblBheW1lbnRzQW55U3Vic2NyaWJlRXJyb3IoKSB7CiAgICAgICAgcmV0dXJuICEwCiAgICB9LAogICAgT25QYXltZW50c1Vuc3Vic2NyaWJlKGEpIHsKICAgICAgICB2YXIgYiA9IHBhcnNlSW50KGEsIDEwKSB8fCAwOwogICAgICAgIHJldHVybiB0aGlzLnB1cmNoYXNlZFByb2R1Y3RUYWcgPT09IGEgfHwgdGhpcy5wdXJjaGFzZWRQcm9kdWN0SWQgPT09IGIKICAgIH0sCiAgICBPblBheW1lbnRzVW5zdWJzY3JpYmVFcnJvcihhKSB7CiAgICAgICAgdmFyIGIgPSBwYXJzZUludChhLCAxMCkgfHwgMDsKICAgICAgICByZXR1cm4gdGhpcy5wdXJjaGFzZWRQcm9kdWN0VGFnID09PSBhIHx8IHRoaXMucHVyY2hhc2VkUHJvZHVjdElkID09PSBiCiAgICB9LAogICAgT25QYXltZW50c0FueVVuc3Vic2NyaWJlKCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIE9uUGF5bWVudHNBbnlVbnN1YnNjcmliZUVycm9yKCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIFBheW1lbnRzRWFjaFByb2R1Y3QoKSB7CiAgICAgICAgcmV0dXJuIGVhY2godGhpcy5fcnVudGltZSwgdGhpcy5wcm9kdWN0cywgKGEsIGIpID0+IHsKICAgICAgICAgICAgdGhpcy5jdXJyZW50UHJvZHVjdEluZGV4ID0gYjsKICAgICAgICAgICAgdGhpcy5jdXJyZW50UHJvZHVjdCA9IGE7CiAgICAgICAgICAgIHRoaXMuY3VycmVudFByb2R1Y3RQdXJjaGFzZXMgPQogICAgICAgICAgICAgICAgdGhpcy5wbGF5ZXJQdXJjaGFzZXMuZmlsdGVyKGQgPT4gZC5wcm9kdWN0SWQgPT09IGEuaWQpLmxlbmd0aAogICAgICAgIH0pLCAhMQogICAgfSwKICAgIFBheW1lbnRzRWFjaFB1cmNoYXNlKCkgewogICAgICAgIHJldHVybiBlYWNoKHRoaXMuX3J1bnRpbWUsIHRoaXMuZ3AucGF5bWVudHMucHVyY2hhc2VzLCAoYSwgYikgPT4gewogICAgICAgICAgICB0aGlzLmN1cnJlbnRQdXJjaGFzZUluZGV4ID0gYjsKICAgICAgICAgICAgdGhpcy5jdXJyZW50UHVyY2hhc2UgPSBhCiAgICAgICAgfSksICExCiAgICB9LAogICAgSXNQYXltZW50c0N1clByb2R1Y3RQdXJjaGFzZWQoKSB7CiAgICAgICAgcmV0dXJuIDAgPCB0aGlzLmN1cnJlbnRQcm9kdWN0UHVyY2hhc2VzCiAgICB9LAogICAgSXNQYXltZW50c1B1cmNoYXNlU3VjY2Vzc2Z1bCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5pc1B1cmNoYXNlUHJvZHVjdFN1Y2Nlc3MKICAgIH0sCiAgICBJc1BheW1lbnRzQ29uc3VtZVN1Y2Nlc3NmdWwoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuaXNDb25zdW1lUHJvZHVjdFN1Y2Nlc3MKICAgIH0sCiAgICBJc1BheW1lbnRzU3Vic2NyaWJlU3VjY2Vzc2Z1bCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5pc1N1YnNjcmliZVByb2R1Y3RTdWNjZXNzCiAgICB9LAogICAgSXNQYXltZW50c1Vuc3Vic2NyaWJlU3VjY2Vzc2Z1bCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5pc1Vuc3Vic2NyaWJlUHJvZHVjdFN1Y2Nlc3MKICAgIH0sCiAgICBQYXltZW50c0lzUHVyY2hhc2VkKGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5ncC5wYXltZW50cy5oYXMoYSkKICAgIH0sCiAgICBQYXltZW50c0lzU3Vic2NyaWJlZChhKSB7CiAgICAgICAgcmV0dXJuIChhID0gdGhpcy5ncC5wYXltZW50cy5nZXRQdXJjaGFzZShhKSkgJiYgYS5zdWJzY3JpYmVkIHx8ICExCiAgICB9LAogICAgSXNQYXltZW50c0F2YWlsYWJsZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5ncC5wYXltZW50cy5pc0F2YWlsYWJsZQogICAgfSwKICAgIElzU3Vic2NyaXB0aW9uc0F2YWlsYWJsZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5ncC5wYXltZW50cy5pc1N1YnNjcmlwdGlvbnNBdmFpbGFibGUKICAgIH0sCiAgICBPbkltYWdlc0ZldGNoKCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIE9uSW1hZ2VzRmV0Y2hFcnJvcigpIHsKICAgICAgICByZXR1cm4gITAKICAgIH0sCiAgICBPbkltYWdlc0ZldGNoTW9yZSgpIHsKICAgICAgICByZXR1cm4gITAKICAgIH0sCiAgICBPbkltYWdlc0ZldGNoTW9yZUVycm9yKCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIE9uSW1hZ2VzVXBsb2FkKCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIE9uSW1hZ2VzVXBsb2FkRXJyb3IoKSB7CiAgICAgICAgcmV0dXJuICEwCiAgICB9LAogICAgT25JbWFnZXNDaG9vc2UoKSB7CiAgICAgICAgcmV0dXJuICEwCiAgICB9LAogICAgT25JbWFnZXNDaG9vc2VFcnJvcigpIHsKICAgICAgICByZXR1cm4gITAKICAgIH0sCiAgICBJbWFnZXNFYWNoSW1hZ2UoKSB7CiAgICAgICAgcmV0dXJuIGVhY2godGhpcy5fcnVudGltZSwgdGhpcy5pbWFnZXMsIChhLCBiKSA9PiB7CiAgICAgICAgICAgIHRoaXMuY3VycmVudEltYWdlSW5kZXggPSBiOwogICAgICAgICAgICB0aGlzLmN1cnJlbnRJbWFnZSA9IGEKICAgICAgICB9KSwgITEKICAgIH0sCiAgICBJbWFnZXNFYWNoVGFnKGEpIHsKICAgICAgICB2YXIgYiA9IHRoaXMuaW1hZ2VzLmZpbmQoZCA9PiBkLmlkID09PSBhKTsKICAgICAgICBiID0gYiA/IGIudGFncyA6IFtdOwogICAgICAgIHJldHVybiBlYWNoKHRoaXMuX3J1bnRpbWUsIGIgfHwgW10sIChkLCBjKSA9PiB7CiAgICAgICAgICAgIHRoaXMuY3VycmVudEltYWdlVGFnSW5kZXggPSBjOwogICAgICAgICAgICB0aGlzLmN1cnJlbnRJbWFnZVRhZyA9IGQKICAgICAgICB9KSwgITEKICAgIH0sCiAgICBJbWFnZXNDYW5Mb2FkTW9yZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5jYW5Mb2FkTW9yZUltYWdlcwogICAgfSwKICAgIEltYWdlc0NhblVwbG9hZCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5ncC5pbWFnZXMuY2FuVXBsb2FkCiAgICB9LAogICAgT25GaWxlc0ZldGNoKCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIE9uRmlsZXNGZXRjaEVycm9yKCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIE9uRmlsZXNGZXRjaE1vcmUoKSB7CiAgICAgICAgcmV0dXJuICEwCiAgICB9LAogICAgT25GaWxlc0ZldGNoTW9yZUVycm9yKCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIE9uRmlsZXNVcGxvYWQoKSB7CiAgICAgICAgcmV0dXJuICEwCiAgICB9LAogICAgT25GaWxlc1VwbG9hZEVycm9yKCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIE9uRmlsZXNMb2FkQ29udGVudCgpIHsKICAgICAgICByZXR1cm4gITAKICAgIH0sCiAgICBPbkZpbGVzTG9hZENvbnRlbnRFcnJvcigpIHsKICAgICAgICByZXR1cm4gITAKICAgIH0sCiAgICBPbkZpbGVzQ2hvb3NlKCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIE9uRmlsZXNDaG9vc2VFcnJvcigpIHsKICAgICAgICByZXR1cm4gITAKICAgIH0sCiAgICBGaWxlc0VhY2hGaWxlKCkgewogICAgICAgIHJldHVybiBlYWNoKHRoaXMuX3J1bnRpbWUsIHRoaXMuZmlsZXMsIChhLCBiKSA9PiB7CiAgICAgICAgICAgIHRoaXMuY3VycmVudEZpbGVJbmRleCA9IGI7CiAgICAgICAgICAgIHRoaXMuY3VycmVudEZpbGUgPSBhCiAgICAgICAgfSksICExCiAgICB9LAogICAgRmlsZXNFYWNoVGFnKGEpIHsKICAgICAgICB2YXIgYiA9IHRoaXMuZmlsZXMuZmluZChkID0+IGQuaWQgPT09IGEpOwogICAgICAgIGIgPSBiID8gYi50YWdzIDogW107CiAgICAgICAgcmV0dXJuIGVhY2godGhpcy5fcnVudGltZSwgYiB8fCBbXSwgKGQsIGMpID0+IHsKICAgICAgICAgICAgdGhpcy5jdXJyZW50RmlsZVRhZ0luZGV4ID0gYzsKICAgICAgICAgICAgdGhpcy5jdXJyZW50RmlsZVRhZyA9IGQKICAgICAgICB9KSwgITEKICAgIH0sCiAgICBGaWxlc0NhbkxvYWRNb3JlKCkgewogICAgICAgIHJldHVybiB0aGlzLmNhbkxvYWRNb3JlRmlsZXMKICAgIH0sCiAgICBGaWxlc0NhblVwbG9hZCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5ncC5maWxlcy5jYW5VcGxvYWQKICAgIH0sCiAgICBPblZhcmlhYmxlc0ZldGNoKCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIE9uVmFyaWFibGVzRmV0Y2hFcnJvcigpIHsKICAgICAgICByZXR1cm4gITAKICAgIH0sCiAgICBWYXJpYWJsZXNFYWNoVmFyaWFibGUoKSB7CiAgICAgICAgcmV0dXJuIGVhY2godGhpcy5fcnVudGltZSwgdGhpcy5ncC52YXJpYWJsZXMubGlzdCwgKGEsIGIpID0+IHsKICAgICAgICAgICAgdGhpcy5jdXJyZW50VmFyaWFibGVJbmRleCA9IGI7CiAgICAgICAgICAgIHRoaXMuY3VycmVudFZhcmlhYmxlID0gYQogICAgICAgIH0pLCAhMQogICAgfSwKICAgIFZhcmlhYmxlc0NvbXBhcmUoYSwgYiwgZCkgewogICAgICAgIHJldHVybiB0aGlzLm1hcHBlcnMuY29tcGFyZVtiXSh0aGlzLmdwLnZhcmlhYmxlcy5nZXQoYSksIGQpCiAgICB9LAogICAgVmFyaWFibGVzQ29tcGFyZVR5cGUoYSwgYikgewogICAgICAgIHJldHVybiB0aGlzLmdwLnZhcmlhYmxlcy50eXBlKGEpID09PSB0aGlzLm1hcHBlcnMudmFyaWFibGVzVHlwZXNbYl0KICAgIH0sCiAgICBWYXJpYWJsZXNIYXMoYSkgewogICAgICAgIHJldHVybiB0aGlzLmdwLnZhcmlhYmxlcy5oYXMoYSkKICAgIH0sCiAgICBPbkZ1bGxzY3JlZW5PcGVuKCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIE9uRnVsbHNjcmVlbkNsb3NlKCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIE9uRnVsbHNjcmVlbkNoYW5nZSgpIHsKICAgICAgICByZXR1cm4gITAKICAgIH0sCiAgICBJc0Z1bGxzY3JlZW5Nb2RlKCkgewogICAgICAgIHJldHVybiB0aGlzLmdwLmZ1bGxzY3JlZW4uaXNFbmFibGVkCiAgICB9LAogICAgT25BZHNTdGFydCgpIHsKICAgICAgICByZXR1cm4gITAKICAgIH0sCiAgICBPbkFkc0Nsb3NlKCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIE9uQWRzRnVsbHNjcmVlblN0YXJ0KCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIE9uQWRzRnVsbHNjcmVlbkNsb3NlKCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIE9uQWRzUHJlbG9hZGVyU3RhcnQoKSB7CiAgICAgICAgcmV0dXJuICEwCiAgICB9LAogICAgT25BZHNQcmVsb2FkZXJDbG9zZSgpIHsKICAgICAgICByZXR1cm4gITAKICAgIH0sCiAgICBPbkFkc1Jld2FyZGVkU3RhcnQoKSB7CiAgICAgICAgcmV0dXJuICEwCiAgICB9LAogICAgT25BZHNSZXdhcmRlZENsb3NlKCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIE9uQWRzUmV3YXJkZWRSZXdhcmQoKSB7CiAgICAgICAgcmV0dXJuICEwCiAgICB9LAogICAgT25BZHNTdGlja3lTdGFydCgpIHsKICAgICAgICByZXR1cm4gITAKICAgIH0sCiAgICBPbkFkc1N0aWNreUNsb3NlKCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIE9uQWRzU3RpY2t5UmVmcmVzaCgpIHsKICAgICAgICByZXR1cm4gITAKICAgIH0sCiAgICBPbkFkc1N0aWNreVJlbmRlcigpIHsKICAgICAgICByZXR1cm4gITAKICAgIH0sCiAgICBJc0Fkc0Z1bGxzY3JlZW5BdmFpbGFibGUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZ3AuYWRzLmlzRnVsbHNjcmVlbkF2YWlsYWJsZQogICAgfSwKICAgIElzQWRzUmV3YXJkZWRBdmFpbGFibGUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZ3AuYWRzLmlzUmV3YXJkZWRBdmFpbGFibGUKICAgIH0sCiAgICBJc0Fkc1ByZWxvYWRlckF2YWlsYWJsZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5ncC5hZHMuaXNQcmVsb2FkZXJBdmFpbGFibGUKICAgIH0sCiAgICBJc0Fkc1N0aWNreUF2YWlsYWJsZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5ncC5hZHMuaXNTdGlja3lBdmFpbGFibGUKICAgIH0sCiAgICBJc0Fkc0Z1bGxzY3JlZW5QbGF5aW5nKCkgewogICAgICAgIHJldHVybiB0aGlzLmdwLmFkcy5pc0Z1bGxzY3JlZW5QbGF5aW5nCiAgICB9LAogICAgSXNBZHNSZXdhcmRlZFBsYXlpbmcoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZ3AuYWRzLmlzUmV3YXJkZWRQbGF5aW5nCiAgICB9LAogICAgSXNBZHNQcmVsb2FkZXJQbGF5aW5nKCkgewogICAgICAgIHJldHVybiB0aGlzLmdwLmFkcy5pc1ByZWxvYWRlclBsYXlpbmcKICAgIH0sCiAgICBJc0Fkc1N0aWNreVBsYXlpbmcoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZ3AuYWRzLmlzU3RpY2t5UGxheWluZwogICAgfSwKICAgIElzQWRzQWRibG9ja0VuYWJsZWQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZ3AuYWRzLmlzQWRibG9ja0VuYWJsZWQKICAgIH0sCiAgICBJc0Fkc0xhc3RBZFN1Y2Nlc3MoKSB7CiAgICAgICAgcmV0dXJuICEhdGhpcy5pc0xhc3RBZFN1Y2Nlc3MKICAgIH0sCiAgICBPbkNoYW5nZUxhbmd1YWdlKCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIE9uQ2hhbmdlQXZhdGFyR2VuZXJhdG9yKCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIE9uT3ZlcmxheVJlYWR5KCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIElzRGV2KCkgewogICAgICAgIHJldHVybiB0aGlzLmdwLmlzRGV2CiAgICB9LAogICAgSXNNb2JpbGUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZ3AuaXNNb2JpbGUKICAgIH0sCiAgICBJc0FsbG93ZWRPcmlnaW4oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZ3AuaXNBbGxvd2VkT3JpZ2luCiAgICB9LAogICAgTGFuZ3VhZ2UoYSkgewogICAgICAgIHJldHVybiB0aGlzLmdwLmxhbmd1YWdlID09PSB0aGlzLm1hcHBlcnMubGFuZ3VhZ2VbYV0KICAgIH0sCiAgICBPblBhdXNlKCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIE9uUmVzdW1lKCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIElzUGF1c2VkKCkgewogICAgICAgIHJldHVybiB0aGlzLmdwLmlzUGF1c2VkCiAgICB9LAogICAgT25HYW1lcGxheVN0YXJ0KCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIE9uR2FtZXBsYXlTdG9wKCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIElzR2FtZXBsYXkoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZ3AuaXNHYW1lcGxheQogICAgfSwKICAgIEhhc1BsYXRmb3JtSW50ZWdyYXRlZEF1dGgoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZ3AucGxhdGZvcm0uaGFzSW50ZWdyYXRlZEF1dGgKICAgIH0sCiAgICBQbGF0Zm9ybVR5cGUoYSkgewogICAgICAgIHJldHVybiB0aGlzLmdwLnBsYXRmb3JtLnR5cGUgPT09IHRoaXMubWFwcGVycy5wbGF0Zm9ybVthXQogICAgfSwKICAgIElzRXh0ZXJuYWxMaW5rc0FsbG93ZWRPblBsYXRmb3JtKCkgewogICAgICAgIHJldHVybiB0aGlzLmdwLnBsYXRmb3JtLmlzRXh0ZXJuYWxMaW5rc0FsbG93ZWQKICAgIH0sCiAgICBPblNvY2lhbHNTaGFyZSgpIHsKICAgICAgICByZXR1cm4gITAKICAgIH0sCiAgICBPblNvY2lhbHNQb3N0KCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIE9uU29jaWFsc0ludml0ZSgpIHsKICAgICAgICByZXR1cm4gITAKICAgIH0sCiAgICBPblNvY2lhbHNKb2luQ29tbXVuaXR5KCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIElzU29jaWFsc0xhc3RTaGFyZVN1Y2Nlc3MoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuaXNMYXN0U2hhcmVTdWNjZXNzCiAgICB9LAogICAgSXNTb2NpYWxzTGFzdENvbW11bml0eUpvaW5TdWNjZXNzKCkgewogICAgICAgIHJldHVybiB0aGlzLmlzTGFzdENvbW11bml0eUpvaW5TdWNjZXNzCiAgICB9LAogICAgSXNTb2NpYWxzU3VwcG9ydHNTaGFyZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5ncC5zb2NpYWxzLmlzU3VwcG9ydHNTaGFyZQogICAgfSwKICAgIElzU29jaWFsc1N1cHBvcnRzTmF0aXZlU2hhcmUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZ3Auc29jaWFscy5pc1N1cHBvcnRzTmF0aXZlU2hhcmUKICAgIH0sCiAgICBJc1NvY2lhbHNTdXBwb3J0c05hdGl2ZVBvc3RzKCkgewogICAgICAgIHJldHVybiB0aGlzLmdwLnNvY2lhbHMuaXNTdXBwb3J0c05hdGl2ZVBvc3RzCiAgICB9LAogICAgSXNTb2NpYWxzU3VwcG9ydHNOYXRpdmVJbnZpdGUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZ3Auc29jaWFscy5pc1N1cHBvcnRzTmF0aXZlSW52aXRlCiAgICB9LAogICAgSXNTb2NpYWxzU3VwcG9ydHNOYXRpdmVDb21tdW5pdHlKb2luKCkgewogICAgICAgIHJldHVybiB0aGlzLmdwLnNvY2lhbHMuaXNTdXBwb3J0c05hdGl2ZUNvbW11bml0eUpvaW4KICAgIH0sCiAgICBTb2NpYWxzQ2FuSm9pbkNvbW11bml0eSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5ncC5zb2NpYWxzLmNhbkpvaW5Db21tdW5pdHkKICAgIH0sCiAgICBPbkFwcEFkZFNob3J0Y3V0KCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIElzQXBwTGFzdEFkZFNob3J0Y3V0U3VjY2VzcygpIHsKICAgICAgICByZXR1cm4gdGhpcy5pc0xhc3RBZGRTaG9ydGN1dFN1Y2Nlc3MKICAgIH0sCiAgICBBcHBDYW5BZGRTaG9ydGN1dCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5ncC5hcHAuY2FuQWRkU2hvcnRjdXQKICAgIH0sCiAgICBPbkdhbWVzQ29sbGVjdGlvbnNPcGVuKCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIE9uR2FtZXNDb2xsZWN0aW9uc0Nsb3NlKCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIE9uR2FtZXNDb2xsZWN0aW9uc0ZldGNoQW55KCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIE9uR2FtZXNDb2xsZWN0aW9uc0ZldGNoQW55RXJyb3IoKSB7CiAgICAgICAgcmV0dXJuICEwCiAgICB9LAogICAgT25HYW1lc0NvbGxlY3Rpb25zRmV0Y2goYSkgewogICAgICAgIHJldHVybiB0aGlzLmxhc3RHYW1lc0NvbGxlY3Rpb25JZE9yVGFnID09PSBhCiAgICB9LAogICAgT25HYW1lc0NvbGxlY3Rpb25zRmV0Y2hFcnJvcihhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMubGFzdEdhbWVzQ29sbGVjdGlvbklkT3JUYWcgPT09IGEKICAgIH0sCiAgICBHYW1lc0NvbGxlY3Rpb25zRWFjaEdhbWUoKSB7CiAgICAgICAgcmV0dXJuIGVhY2godGhpcy5fcnVudGltZSwgdGhpcy5nYW1lc0NvbGxlY3Rpb24uZ2FtZXMsIChhLCBiKSA9PiB7CiAgICAgICAgICAgIHRoaXMuY3VycmVudEdhbWVJbmRleCA9IGI7CiAgICAgICAgICAgIHRoaXMuY3VycmVudEdhbWVJZCA9IGEuaWQ7CiAgICAgICAgICAgIHRoaXMuY3VycmVudEdhbWVOYW1lID0gYS5uYW1lOwogICAgICAgICAgICB0aGlzLmN1cnJlbnRHYW1lRGVzY3JpcHRpb24gPSBhLmRlc2NyaXB0aW9uOwogICAgICAgICAgICB0aGlzLmN1cnJlbnRHYW1lSWNvbiA9IGEuaWNvbjsKICAgICAgICAgICAgdGhpcy5jdXJyZW50R2FtZVVybCA9CiAgICAgICAgICAgICAgICBhLnVybAogICAgICAgIH0pLCAhMQogICAgfSwKICAgIElzR2FtZXNDb2xsZWN0aW9uc0F2YWlsYWJsZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5ncC5nYW1lc0NvbGxlY3Rpb25zLmlzQXZhaWxhYmxlCiAgICB9LAogICAgT25Eb2N1bWVudHNPcGVuKCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIE9uRG9jdW1lbnRzQ2xvc2UoKSB7CiAgICAgICAgcmV0dXJuICEwCiAgICB9LAogICAgT25Eb2N1bWVudHNGZXRjaEFueSgpIHsKICAgICAgICByZXR1cm4gITAKICAgIH0sCiAgICBPbkRvY3VtZW50c0ZldGNoQW55RXJyb3IoKSB7CiAgICAgICAgcmV0dXJuICEwCiAgICB9LAogICAgT25Eb2N1bWVudHNGZXRjaChhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMubGFzdERvY3VtZW50VHlwZSA9PT0gdGhpcy5tYXBwZXJzLmRvY3VtZW50VHlwZXNbYV0KICAgIH0sCiAgICBPbkRvY3VtZW50c0ZldGNoRXJyb3IoYSkgewogICAgICAgIHJldHVybiB0aGlzLmxhc3REb2N1bWVudFR5cGUgPT09IHRoaXMubWFwcGVycy5kb2N1bWVudFR5cGVzW2FdCiAgICB9LAogICAgT25QbGF5ZXJzRmV0Y2goYSkgewogICAgICAgIHJldHVybiB0aGlzLmxhc3RQbGF5ZXJzVGFnID09PSBhCiAgICB9LAogICAgT25QbGF5ZXJzQW55RmV0Y2goKSB7CiAgICAgICAgcmV0dXJuICEwCiAgICB9LAogICAgT25QbGF5ZXJzRmV0Y2hFcnJvcihhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMubGFzdFBsYXllcnNUYWcgPT09CiAgICAgICAgICAgIGEKICAgIH0sCiAgICBPblBsYXllcnNBbnlGZXRjaEVycm9yKCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIFBsYXllcnNFYWNoUGxheWVyKCkgewogICAgICAgIHJldHVybiBlYWNoKHRoaXMuX3J1bnRpbWUsIHRoaXMucGxheWVyc0xpc3QsIChhLCBiKSA9PiB7CiAgICAgICAgICAgIHRoaXMuY3VycmVudFBsYXllcnNJbmRleCA9IGI7CiAgICAgICAgICAgIHRoaXMuY3VycmVudFBsYXllcnNQbGF5ZXIgPSBhCiAgICAgICAgfSksICExCiAgICB9LAogICAgUGxheWVyc0VhY2hQbGF5ZXJBY2hpZXZlbWVudCgpIHsKICAgICAgICByZXR1cm4gZWFjaCh0aGlzLl9ydW50aW1lLCB0aGlzLmN1cnJlbnRQbGF5ZXJzUGxheWVyLmFjaGlldmVtZW50cywgKGEsIGIpID0+IHsKICAgICAgICAgICAgdGhpcy5jdXJyZW50UGxheWVyQWNoaWV2ZW1lbnRJbmRleCA9IGI7CiAgICAgICAgICAgIHRoaXMuY3VycmVudFBsYXllckFjaGlldmVtZW50SWQgPSBhLmlkOwogICAgICAgICAgICB0aGlzLmN1cnJlbnRQbGF5ZXJBY2hpZXZlbWVudFVubG9ja0RhdGUgPSBhLmNyZWF0ZWRBdAogICAgICAgIH0pLCAhMQogICAgfSwKICAgIFBsYXllcnNFYWNoUGxheWVyUHVyY2hhc2UoKSB7CiAgICAgICAgcmV0dXJuIGVhY2godGhpcy5fcnVudGltZSwgdGhpcy5jdXJyZW50UGxheWVyc1BsYXllci5wdXJjaGFzZXMsIChhLCBiKSA9PiB7CiAgICAgICAgICAgIHRoaXMuY3VycmVudFB1cmNoYXNlSW5kZXggPSBiOwogICAgICAgICAgICB0aGlzLmN1cnJlbnRQdXJjaGFzZSA9IGEKICAgICAgICB9KSwgITEKICAgIH0sCiAgICBJc0xhc3RBY3Rpb25TdWNjZXNzKCkgewogICAgICAgIHJldHVybiB0aGlzLmlzTGFzdEFjdGlvblN1Y2Nlc3MKICAgIH0sCiAgICBPbkxvYWRKc29uRXJyb3IoKSB7CiAgICAgICAgcmV0dXJuICEwCiAgICB9Cn07CiJ1c2Ugc3RyaWN0IjsKCmZ1bmN0aW9uIHN0b2FycihhID0gIiIsIGIgPSBTdHJpbmcpIHsKICAgIHJldHVybiBTdHJpbmcoYSkuc3BsaXQoIiwiKS5tYXAoZCA9PiBiKGQudHJpbSgpKSkuZmlsdGVyKGQgPT4gZCkKfQpDMy5QbHVnaW5zLkVwb25lc2hfR2FtZVNjb3JlLkFjdHMgPSB7CiAgICBQbGF5ZXJTZXROYW1lKGEpIHsKICAgICAgICB0aGlzLmdwLnBsYXllci5uYW1lID0gYQogICAgfSwKICAgIFBsYXllclNldEF2YXRhcihhKSB7CiAgICAgICAgdGhpcy5ncC5wbGF5ZXIuYXZhdGFyID0gYQogICAgfSwKICAgIFBsYXllclNldFNjb3JlKGEpIHsKICAgICAgICB0aGlzLmdwLnBsYXllci5zY29yZSA9IGEKICAgIH0sCiAgICBQbGF5ZXJBZGRTY29yZShhKSB7CiAgICAgICAgdGhpcy5ncC5wbGF5ZXIuc2NvcmUgKz0gYQogICAgfSwKICAgIFBsYXllclNldChhLCBiKSB7CiAgICAgICAgdGhpcy5ncC5wbGF5ZXIuc2V0KGEsIGIpCiAgICB9LAogICAgUGxheWVyU2V0RmxhZyhhLCBiKSB7CiAgICAgICAgdGhpcy5ncC5wbGF5ZXIuc2V0KGEsICFiKQogICAgfSwKICAgIFBsYXllckFkZChhLCBiKSB7CiAgICAgICAgdGhpcy5ncC5wbGF5ZXIuYWRkKGEsIGIpCiAgICB9LAogICAgUGxheWVyVG9nZ2xlKGEpIHsKICAgICAgICB0aGlzLmdwLnBsYXllci50b2dnbGUoYSkKICAgIH0sCiAgICBQbGF5ZXJSZXNldCgpIHsKICAgICAgICB0aGlzLmdwLnBsYXllci5yZXNldCgpCiAgICB9LAogICAgUGxheWVyUmVtb3ZlKCkgewogICAgICAgIHRoaXMuZ3AucGxheWVyLnJlbW92ZSgpCiAgICB9LAogICAgUGxheWVyU3luYyhhID0gITEpIHsKICAgICAgICByZXR1cm4gdGhpcy5ncC5wbGF5ZXIuc3luYyh7CiAgICAgICAgICAgIG92ZXJyaWRlOiBhCiAgICAgICAgfSkKICAgIH0sCiAgICBQbGF5ZXJMb2FkKCkgewogICAgICAgIHJldHVybiB0aGlzLmdwLnBsYXllci5sb2FkKCkKICAgIH0sCiAgICBQbGF5ZXJMb2dpbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5ncC5wbGF5ZXIubG9naW4oKQogICAgfSwKICAgIFBsYXllckZldGNoRmllbGRzKCkgewogICAgICAgIHJldHVybiB0aGlzLmdwLnBsYXllci5mZXRjaEZpZWxkcygpCiAgICB9LAogICAgUGxheWVyV2FpdEZvclJlYWR5KCkgewogICAgICAgIHJldHVybiB0aGlzLmF3YWl0ZXJzLnBsYXllci5yZWFkeQogICAgfSwKICAgIExlYWRlcmJvYXJkT3BlbihhLCBiLCBkLCBjLCBlLCBnKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZ3AubGVhZGVyYm9hcmQub3Blbih7CiAgICAgICAgICAgIGlkOiB0aGlzLmdwLnBsYXllci5pZCwKICAgICAgICAgICAgb3JkZXJCeTogc3RvYXJyKGEpLAogICAgICAgICAgICBvcmRlcjogMCA9PT0gYiA/ICJERVNDIiA6ICJBU0MiLAogICAgICAgICAgICBsaW1pdDogZCwKICAgICAgICAgICAgd2l0aE1lOiB0aGlzLm1hcHBlcnMud2l0aE1lW2NdLAogICAgICAgICAgICBpbmNsdWRlRmllbGRzOiBzdG9hcnIoZSksCiAgICAgICAgICAgIGRpc3BsYXlGaWVsZHM6IHN0b2FycihnKQogICAgICAgIH0pLmNhdGNoKGsgPT4gewogICAgICAgICAgICB0aGlzLmhhbmRsZVJlc3VsdCghMSwgaykKICAgICAgICB9KQogICAgfSwKICAgIExlYWRlcmJvYXJkRmV0Y2goYSwgYiwgZCwgYywgZSwgZykgewogICAgICAgIHJldHVybiB0aGlzLmdwLmxlYWRlcmJvYXJkLmZldGNoKHsKICAgICAgICAgICAgaWQ6IHRoaXMuZ3AucGxheWVyLmlkLAogICAgICAgICAgICBvcmRlckJ5OiBzdG9hcnIoYiksCiAgICAgICAgICAgIG9yZGVyOiAwID09PSBkID8gIkRFU0MiIDogIkFTQyIsCiAgICAgICAgICAgIGxpbWl0OiBjLAogICAgICAgICAgICB3aXRoTWU6IHRoaXMubWFwcGVycy53aXRoTWVbZV0sCiAgICAgICAgICAgIGluY2x1ZGVGaWVsZHM6IHN0b2FycihnKQogICAgICAgIH0pLnRoZW4oayA9PiB7CiAgICAgICAgICAgIHRoaXMubGFzdExlYWRlcmJvYXJkVGFnID0gYTsKICAgICAgICAgICAgdGhpcy5sYXN0TGVhZGVyYm9hcmRWYXJpYW50ID0gImRlZmF1bHQiOwogICAgICAgICAgICB0aGlzLmxlYWRlcmJvYXJkSW5mbyA9IGsubGVhZGVyYm9hcmQ7CiAgICAgICAgICAgIHRoaXMubGVhZGVyYm9hcmQgPSBrLnBsYXllcnM7CiAgICAgICAgICAgIHRoaXMuaGFuZGxlUmVzdWx0KCEwKTsKICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkxlYWRlcmJvYXJkRmV0Y2gpOwogICAgICAgICAgICB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uTGVhZGVyYm9hcmRBbnlGZXRjaCkKICAgICAgICB9KS5jYXRjaChrID0+IHsKICAgICAgICAgICAgdGhpcy5oYW5kbGVSZXN1bHQoITEsIGspOwogICAgICAgICAgICB0aGlzLmxhc3RMZWFkZXJib2FyZFRhZyA9IGE7CiAgICAgICAgICAgIHRoaXMubGFzdExlYWRlcmJvYXJkVmFyaWFudCA9ICJkZWZhdWx0IjsKICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkxlYWRlcmJvYXJkRmV0Y2hFcnJvcik7CiAgICAgICAgICAgIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25MZWFkZXJib2FyZEFueUZldGNoRXJyb3IpCiAgICAgICAgfSkKICAgIH0sCiAgICBMZWFkZXJib2FyZEZldGNoUGxheWVyUmF0aW5nKGEsIGIsIGQpIHsKICAgICAgICByZXR1cm4gdGhpcy5ncC5sZWFkZXJib2FyZC5mZXRjaFBsYXllclJhdGluZyh7CiAgICAgICAgICAgIGlkOiB0aGlzLmdwLnBsYXllci5pZCwKICAgICAgICAgICAgb3JkZXJCeTogc3RvYXJyKGIpLAogICAgICAgICAgICBvcmRlcjogMCA9PT0gZCA/ICJERVNDIiA6ICJBU0MiCiAgICAgICAgfSkudGhlbihjID0+IHsKICAgICAgICAgICAgdGhpcy5sYXN0TGVhZGVyYm9hcmRUYWcgPSBhOwogICAgICAgICAgICB0aGlzLmxhc3RMZWFkZXJib2FyZFZhcmlhbnQgPSAiZGVmYXVsdCI7CiAgICAgICAgICAgIHRoaXMubGFzdExlYWRlcmJvYXJkUGxheWVyUmF0aW5nVGFnID0gYTsKICAgICAgICAgICAgdGhpcy5jdXJyZW50TGVhZGVyYm9hcmRQbGF5ZXIgPSBPYmplY3QuYXNzaWduKHRoaXMuZ3AucGxheWVyLnRvSlNPTigpLCBjLnBsYXllcik7CiAgICAgICAgICAgIHRoaXMubGVhZGVyYm9hcmRQbGF5ZXJQb3NpdGlvbiA9IGMucGxheWVyLnBvc2l0aW9uOwogICAgICAgICAgICB0aGlzLmhhbmRsZVJlc3VsdCghMCk7CiAgICAgICAgICAgIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25MZWFkZXJib2FyZEZldGNoUGxheWVyKTsKICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkxlYWRlcmJvYXJkQW55RmV0Y2hQbGF5ZXIpCiAgICAgICAgfSkuY2F0Y2goYyA9PiB7CiAgICAgICAgICAgIHRoaXMuaGFuZGxlUmVzdWx0KCExLCBjKTsKICAgICAgICAgICAgdGhpcy5sYXN0TGVhZGVyYm9hcmRUYWcgPSBhOwogICAgICAgICAgICB0aGlzLmxhc3RMZWFkZXJib2FyZFZhcmlhbnQgPSAiZGVmYXVsdCI7CiAgICAgICAgICAgIHRoaXMubGFzdExlYWRlcmJvYXJkUGxheWVyUmF0aW5nVGFnID0gYTsKICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkxlYWRlcmJvYXJkRmV0Y2hQbGF5ZXJFcnJvcik7CiAgICAgICAgICAgIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25MZWFkZXJib2FyZEFueUZldGNoUGxheWVyRXJyb3IpCiAgICAgICAgfSkKICAgIH0sCiAgICBMZWFkZXJib2FyZE9wZW5TY29wZWQoYSwgYiwgZCwgYywgZSwgZywgaykgewogICAgICAgIGEgPSB7CiAgICAgICAgICAgIGlkOiBwYXJzZUludChhLCAxMCkgfHwgMCwKICAgICAgICAgICAgdGFnOiBhLAogICAgICAgICAgICB2YXJpYW50OiBiLAogICAgICAgICAgICBsaW1pdDogYywKICAgICAgICAgICAgb3JkZXI6IHRoaXMubWFwcGVycy5vcmRlcltkXSwKICAgICAgICAgICAgd2l0aE1lOiB0aGlzLm1hcHBlcnMud2l0aE1lW2VdLAogICAgICAgICAgICBpbmNsdWRlRmllbGRzOiBzdG9hcnIoZyksCiAgICAgICAgICAgIGRpc3BsYXlGaWVsZHM6IHN0b2FycihrKQogICAgICAgIH07CiAgICAgICAgcmV0dXJuIHRoaXMuZ3AubGVhZGVyYm9hcmQub3BlblNjb3BlZChhKS5jYXRjaChjb25zb2xlLndhcm4pCiAgICB9LAogICAgTGVhZGVyYm9hcmRGZXRjaFNjb3BlZChhLCBiLCBkLCBjLCBlLCBnKSB7CiAgICAgICAgYyA9IHsKICAgICAgICAgICAgaWQ6IHBhcnNlSW50KGEsIDEwKSB8fCAwLAogICAgICAgICAgICB0YWc6IGEsCiAgICAgICAgICAgIHZhcmlhbnQ6IGIsCiAgICAgICAgICAgIGxpbWl0OiBjLAogICAgICAgICAgICBvcmRlcjogdGhpcy5tYXBwZXJzLm9yZGVyW2RdLAogICAgICAgICAgICB3aXRoTWU6IHRoaXMubWFwcGVycy53aXRoTWVbZV0sCiAgICAgICAgICAgIGluY2x1ZGVGaWVsZHM6IHN0b2FycihnKQogICAgICAgIH07CiAgICAgICAgcmV0dXJuIHRoaXMuZ3AubGVhZGVyYm9hcmQuZmV0Y2hTY29wZWQoYykudGhlbihrID0+IHsKICAgICAgICAgICAgdGhpcy5sYXN0TGVhZGVyYm9hcmRUYWcgPSBhOwogICAgICAgICAgICB0aGlzLmxhc3RMZWFkZXJib2FyZFZhcmlhbnQgPSBiOwogICAgICAgICAgICB0aGlzLmxlYWRlcmJvYXJkSW5mbyA9IGsubGVhZGVyYm9hcmQ7CiAgICAgICAgICAgIHRoaXMubGVhZGVyYm9hcmQgPSBrLnBsYXllcnM7CiAgICAgICAgICAgIHRoaXMuaGFuZGxlUmVzdWx0KCEwKTsKICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkxlYWRlcmJvYXJkRmV0Y2gpOwogICAgICAgICAgICB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uTGVhZGVyYm9hcmRBbnlGZXRjaCkKICAgICAgICB9KS5jYXRjaChrID0+IHsKICAgICAgICAgICAgdGhpcy5oYW5kbGVSZXN1bHQoITEsIGspOwogICAgICAgICAgICB0aGlzLmxhc3RMZWFkZXJib2FyZFRhZyA9IGE7CiAgICAgICAgICAgIHRoaXMubGFzdExlYWRlcmJvYXJkVmFyaWFudCA9IGI7CiAgICAgICAgICAgIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25MZWFkZXJib2FyZEZldGNoRXJyb3IpOwogICAgICAgICAgICB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uTGVhZGVyYm9hcmRBbnlGZXRjaEVycm9yKQogICAgICAgIH0pCiAgICB9LAogICAgTGVhZGVyYm9hcmRGZXRjaFBsYXllclJhdGluZ1Njb3BlZChhLCBiLCBkKSB7CiAgICAgICAgZCA9IHsKICAgICAgICAgICAgaWQ6IHBhcnNlSW50KGEsIDEwKSB8fCAwLAogICAgICAgICAgICB0YWc6IGEsCiAgICAgICAgICAgIHZhcmlhbnQ6IGIsCiAgICAgICAgICAgIG9yZGVyOiB0aGlzLm1hcHBlcnMub3JkZXJbZF0KICAgICAgICB9OwogICAgICAgIHJldHVybiB0aGlzLmdwLmxlYWRlcmJvYXJkLmZldGNoUGxheWVyUmF0aW5nU2NvcGVkKGQpLnRoZW4oYyA9PiB7CiAgICAgICAgICAgIHRoaXMubGFzdExlYWRlcmJvYXJkVGFnID0gdGhpcy5sYXN0TGVhZGVyYm9hcmRQbGF5ZXJSYXRpbmdUYWcgPSBhOwogICAgICAgICAgICB0aGlzLmxhc3RMZWFkZXJib2FyZFZhcmlhbnQgPSBiOwogICAgICAgICAgICB0aGlzLmN1cnJlbnRMZWFkZXJib2FyZFBsYXllciA9IE9iamVjdC5hc3NpZ24odGhpcy5ncC5wbGF5ZXIudG9KU09OKCksCiAgICAgICAgICAgICAgICBjLnBsYXllcik7CiAgICAgICAgICAgIHRoaXMubGVhZGVyYm9hcmRQbGF5ZXJQb3NpdGlvbiA9IGMucGxheWVyLnBvc2l0aW9uOwogICAgICAgICAgICB0aGlzLmhhbmRsZVJlc3VsdCghMCk7CiAgICAgICAgICAgIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25MZWFkZXJib2FyZEZldGNoUGxheWVyKTsKICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkxlYWRlcmJvYXJkQW55RmV0Y2hQbGF5ZXIpCiAgICAgICAgfSkuY2F0Y2goYyA9PiB7CiAgICAgICAgICAgIHRoaXMuaGFuZGxlUmVzdWx0KCExLCBjKTsKICAgICAgICAgICAgdGhpcy5sYXN0TGVhZGVyYm9hcmRUYWcgPSB0aGlzLmxhc3RMZWFkZXJib2FyZFBsYXllclJhdGluZ1RhZyA9IGE7CiAgICAgICAgICAgIHRoaXMubGFzdExlYWRlcmJvYXJkVmFyaWFudCA9IGI7CiAgICAgICAgICAgIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25MZWFkZXJib2FyZEZldGNoUGxheWVyRXJyb3IpOwogICAgICAgICAgICB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uTGVhZGVyYm9hcmRBbnlGZXRjaFBsYXllckVycm9yKQogICAgICAgIH0pCiAgICB9LAogICAgTGVhZGVyYm9hcmRQdWJsaXNoUmVjb3JkKGEsIGIsIGQpIHsKICAgICAgICB2YXIgYyA9IHRoaXMubGVhZGVyYm9hcmRSZWNvcmRzW2FdOwogICAgICAgIGMgPSBjID8gY1tiXSA6IG51bGw7CiAgICAgICAgdmFyIGUgPSBwYXJzZUludChhLCAxMCkgfHwgMDsKICAgICAgICByZXR1cm4gdGhpcy5ncC5sZWFkZXJib2FyZC5wdWJsaXNoUmVjb3JkKHsKICAgICAgICAgICAgaWQ6IGUsCiAgICAgICAgICAgIHRhZzogYSwKICAgICAgICAgICAgdmFyaWFudDogYiwKICAgICAgICAgICAgb3ZlcnJpZGU6IGQsCiAgICAgICAgICAgIHJlY29yZDogYwogICAgICAgIH0pLnRoZW4oZyA9PiB7CiAgICAgICAgICAgIHRoaXMubGFzdExlYWRlcmJvYXJkVGFnID0gYTsKICAgICAgICAgICAgdGhpcy5sYXN0TGVhZGVyYm9hcmRWYXJpYW50ID0gYjsKICAgICAgICAgICAgdGhpcy5sYXN0TGVhZGVyYm9hcmRQbGF5ZXJSYXRpbmdUYWcgPSBhOwogICAgICAgICAgICB0aGlzLmxlYWRlcmJvYXJkUGxheWVyUG9zaXRpb24gPSBnLnBsYXllci5wb3NpdGlvbjsKICAgICAgICAgICAgdGhpcy5jdXJyZW50TGVhZGVyYm9hcmRQbGF5ZXIgPSBPYmplY3QuYXNzaWduKHRoaXMuZ3AucGxheWVyLnRvSlNPTigpLCBnLnBsYXllcik7CiAgICAgICAgICAgIHRoaXMuaGFuZGxlUmVzdWx0KCEwKTsKICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkxlYWRlcmJvYXJkUHVibGlzaFJlY29yZCkKICAgICAgICB9KS5jYXRjaChnID0+IHsKICAgICAgICAgICAgdGhpcy5oYW5kbGVSZXN1bHQoITEsIGcpOwogICAgICAgICAgICB0aGlzLmxhc3RMZWFkZXJib2FyZFRhZyA9IGE7CiAgICAgICAgICAgIHRoaXMubGFzdExlYWRlcmJvYXJkVmFyaWFudCA9CiAgICAgICAgICAgICAgICBiOwogICAgICAgICAgICB0aGlzLmxhc3RMZWFkZXJib2FyZFBsYXllclJhdGluZ1RhZyA9IGE7CiAgICAgICAgICAgIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25MZWFkZXJib2FyZFB1Ymxpc2hSZWNvcmRFcnJvcikKICAgICAgICB9KQogICAgfSwKICAgIExlYWRlcmJvYXJkU2V0UmVjb3JkKGEsIGIsIGQsIGMpIHsKICAgICAgICB0aGlzLmxlYWRlcmJvYXJkUmVjb3Jkc1thXSB8fCAodGhpcy5sZWFkZXJib2FyZFJlY29yZHNbYV0gPSB7fSk7CiAgICAgICAgdGhpcy5sZWFkZXJib2FyZFJlY29yZHNbYV1bYl0gfHwgKHRoaXMubGVhZGVyYm9hcmRSZWNvcmRzW2FdW2JdID0ge30pOwogICAgICAgIHRoaXMubGVhZGVyYm9hcmRSZWNvcmRzW2FdW2JdW2RdID0gYwogICAgfSwKICAgIEFjaGlldmVtZW50c09wZW4oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZ3AuYWNoaWV2ZW1lbnRzLm9wZW4oKS5jYXRjaChjb25zb2xlLndhcm4pCiAgICB9LAogICAgQWNoaWV2ZW1lbnRzRmV0Y2goKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZ3AuYWNoaWV2ZW1lbnRzLmZldGNoKCkudGhlbihhID0+IHsKICAgICAgICAgICAgdGhpcy5hY2hpZXZlbWVudHMgPSBhLmFjaGlldmVtZW50czsKICAgICAgICAgICAgdGhpcy5hY2hpZXZlbWVudHNHcm91cHMgPSBhLmFjaGlldmVtZW50c0dyb3VwczsKICAgICAgICAgICAgdGhpcy5wbGF5ZXJBY2hpZXZlbWVudHMgPSBhLnBsYXllckFjaGlldmVtZW50czsKICAgICAgICAgICAgdGhpcy5oYW5kbGVSZXN1bHQoITApOwogICAgICAgICAgICB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uQWNoaWV2ZW1lbnRzRmV0Y2gpCiAgICAgICAgfSkuY2F0Y2goYSA9PiB7CiAgICAgICAgICAgIHRoaXMuaGFuZGxlUmVzdWx0KCExLCBhKTsKICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkFjaGlldmVtZW50c0ZldGNoRXJyb3IpCiAgICAgICAgfSkKICAgIH0sCiAgICBBY2hpZXZlbWVudHNVbmxvY2soYSkgewogICAgICAgIHZhciBiID0gcGFyc2VJbnQoYSwgMTApIHx8IDA7CiAgICAgICAgcmV0dXJuIHRoaXMuZ3AuYWNoaWV2ZW1lbnRzLnVubG9jaygwIDwgYiA/IHsKICAgICAgICAgICAgaWQ6IGIKICAgICAgICB9IDogewogICAgICAgICAgICB0YWc6IGEKICAgICAgICB9KS50aGVuKGQgPT4gewogICAgICAgICAgICB0aGlzLmlzVW5sb2NrQWNoaWV2ZW1lbnRTdWNjZXNzID0gZC5zdWNjZXNzOwogICAgICAgICAgICB0aGlzLnVubG9ja0FjaGlldmVtZW50RXJyb3IgPSBkLmVycm9yIHx8ICIiOwogICAgICAgICAgICB0aGlzLmhhbmRsZVJlc3VsdChkLnN1Y2Nlc3MsIGQuZXJyb3IpOwogICAgICAgICAgICB2YXIgYyA9IGQuYWNoaWV2ZW1lbnQgfHwge307CiAgICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnRBY2hpZXZlbWVudEluZGV4ID0gMCwgdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnQgPQogICAgICAgICAgICAgICAgYywgZC5zdWNjZXNzKSByZXR1cm4gdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkFjaGlldmVtZW50c1VubG9jayksIHZvaWQgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkFjaGlldmVtZW50c0FueVVubG9jayk7CiAgICAgICAgICAgIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25BY2hpZXZlbWVudHNBbnlVbmxvY2tFcnJvcikKICAgICAgICB9KS5jYXRjaChkID0+IHsKICAgICAgICAgICAgdGhpcy5pc1VubG9ja0FjaGlldmVtZW50U3VjY2VzcyA9ICExOwogICAgICAgICAgICB0aGlzLnVubG9ja0FjaGlldmVtZW50RXJyb3IgPSB0aGlzLmV0b3MoZCk7CiAgICAgICAgICAgIHRoaXMuaGFuZGxlUmVzdWx0KCExLCBkKTsKICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkFjaGlldmVtZW50c0FueVVubG9ja0Vycm9yKQogICAgICAgIH0pCiAgICB9LAogICAgQWNoaWV2ZW1lbnRzU2V0UHJvZ3Jlc3MoYSwgYikgewogICAgICAgIGIgPSBOdW1iZXIoYik7CiAgICAgICAgdmFyIGQgPSBwYXJzZUludChhLCAxMCkgfHwgMDsKICAgICAgICByZXR1cm4gdGhpcy5ncC5hY2hpZXZlbWVudHMuc2V0UHJvZ3Jlc3MoMCA8IGQgPyB7CiAgICAgICAgICAgIGlkOiBkLAogICAgICAgICAgICBwcm9ncmVzczogYgogICAgICAgIH0gOiB7CiAgICAgICAgICAgIHRhZzogYSwKICAgICAgICAgICAgcHJvZ3Jlc3M6IGIKICAgICAgICB9KS50aGVuKGMgPT4gewogICAgICAgICAgICB0aGlzLmhhbmRsZVJlc3VsdChjLnN1Y2Nlc3MsIGMuZXJyb3IpOwogICAgICAgICAgICB2YXIgZSA9IGMuYWNoaWV2ZW1lbnQgfHwge307CiAgICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnRBY2hpZXZlbWVudEluZGV4ID0gMCwgdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnQgPSBlLCBjLnN1Y2Nlc3MpIHJldHVybiB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uQWNoaWV2ZW1lbnRzU2V0UHJvZ3Jlc3MpLCB2b2lkIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25BY2hpZXZlbWVudHNBbnlTZXRQcm9ncmVzcyk7CiAgICAgICAgICAgIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25BY2hpZXZlbWVudHNBbnlTZXRQcm9ncmVzc0Vycm9yKQogICAgICAgIH0pLmNhdGNoKGMgPT4gewogICAgICAgICAgICB0aGlzLmhhbmRsZVJlc3VsdCghMSwgYyk7CiAgICAgICAgICAgIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25BY2hpZXZlbWVudHNBbnlTZXRQcm9ncmVzc0Vycm9yKQogICAgICAgIH0pCiAgICB9LAogICAgUGF5bWVudHNGZXRjaFByb2R1Y3RzKCkgewogICAgICAgIHJldHVybiB0aGlzLmdwLnBheW1lbnRzLmZldGNoUHJvZHVjdHMoKS50aGVuKGEgPT4gewogICAgICAgICAgICB0aGlzLnByb2R1Y3RzID0KICAgICAgICAgICAgICAgIGEucHJvZHVjdHM7CiAgICAgICAgICAgIHRoaXMucGxheWVyUHVyY2hhc2VzID0gYS5wbGF5ZXJQdXJjaGFzZXM7CiAgICAgICAgICAgIHRoaXMuaGFuZGxlUmVzdWx0KCEwKTsKICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PblBheW1lbnRzRmV0Y2hQcm9kdWN0cykKICAgICAgICB9KS5jYXRjaChhID0+IHsKICAgICAgICAgICAgdGhpcy5oYW5kbGVSZXN1bHQoITEsIGEpOwogICAgICAgICAgICB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uUGF5bWVudHNGZXRjaFByb2R1Y3RzRXJyb3IpCiAgICAgICAgfSkKICAgIH0sCiAgICBQYXltZW50c1B1cmNoYXNlKGEpIHsKICAgICAgICB2YXIgYiA9IHBhcnNlSW50KGEsIDEwKSB8fCAwOwogICAgICAgIHJldHVybiB0aGlzLmdwLnBheW1lbnRzLnB1cmNoYXNlKDAgPCBiID8gewogICAgICAgICAgICBpZDogYgogICAgICAgIH0gOiB7CiAgICAgICAgICAgIHRhZzogYQogICAgICAgIH0pLnRoZW4oZCA9PiB7CiAgICAgICAgICAgIHRoaXMuaXNQdXJjaGFzZVByb2R1Y3RTdWNjZXNzID0gZC5zdWNjZXNzOwogICAgICAgICAgICB0aGlzLnB1cmNoYXNlUHJvZHVjdEVycm9yID0gZC5lcnJvciB8fCAiIjsKICAgICAgICAgICAgdGhpcy5oYW5kbGVSZXN1bHQoZC5zdWNjZXNzLCBkLmVycm9yKTsKICAgICAgICAgICAgdmFyIGMgPSBkLnByb2R1Y3QgfHwge307CiAgICAgICAgICAgIGlmICh0aGlzLnB1cmNoYXNlZFByb2R1Y3RJZCA9IGMuaWQgfHwgMCwgdGhpcy5wdXJjaGFzZWRQcm9kdWN0VGFnID0KICAgICAgICAgICAgICAgIGMudGFnIHx8ICIiLCBkLnN1Y2Nlc3MpIHJldHVybiB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uUGF5bWVudHNQdXJjaGFzZSksIHZvaWQgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PblBheW1lbnRzQW55UHVyY2hhc2UpOwogICAgICAgICAgICB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uUGF5bWVudHNQdXJjaGFzZUVycm9yKTsKICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PblBheW1lbnRzQW55UHVyY2hhc2VFcnJvcikKICAgICAgICB9KS5jYXRjaChkID0+IHsKICAgICAgICAgICAgdGhpcy5pc1B1cmNoYXNlUHJvZHVjdFN1Y2Nlc3MgPSAhMTsKICAgICAgICAgICAgdGhpcy5wdXJjaGFzZVByb2R1Y3RFcnJvciA9IHRoaXMuZXRvcyhkKTsKICAgICAgICAgICAgdGhpcy5oYW5kbGVSZXN1bHQoITEsIGQpOwogICAgICAgICAgICB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uUGF5bWVudHNQdXJjaGFzZUVycm9yKTsKICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PblBheW1lbnRzQW55UHVyY2hhc2VFcnJvcikKICAgICAgICB9KQogICAgfSwKICAgIFBheW1lbnRzQ29uc3VtZShhKSB7CiAgICAgICAgdmFyIGIgPSBwYXJzZUludChhLAogICAgICAgICAgICAxMCkgfHwgMDsKICAgICAgICByZXR1cm4gdGhpcy5ncC5wYXltZW50cy5jb25zdW1lKDAgPCBiID8gewogICAgICAgICAgICBpZDogYgogICAgICAgIH0gOiB7CiAgICAgICAgICAgIHRhZzogYQogICAgICAgIH0pLnRoZW4oZCA9PiB7CiAgICAgICAgICAgIHRoaXMuaXNDb25zdW1lUHJvZHVjdFN1Y2Nlc3MgPSBkLnN1Y2Nlc3M7CiAgICAgICAgICAgIHRoaXMuY29uc3VtZVByb2R1Y3RFcnJvciA9IGQuZXJyb3IgfHwgIiI7CiAgICAgICAgICAgIHRoaXMuaGFuZGxlUmVzdWx0KGQuc3VjY2VzcywgZC5lcnJvcik7CiAgICAgICAgICAgIHZhciBjID0gZC5wcm9kdWN0IHx8IHt9OwogICAgICAgICAgICBpZiAodGhpcy5jb25zdW1lZFByb2R1Y3RJZCA9IGMuaWQgfHwgMCwgdGhpcy5jb25zdW1lZFByb2R1Y3RUYWcgPSBjLnRhZyB8fCAiIiwgZC5zdWNjZXNzKSByZXR1cm4gdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PblBheW1lbnRzQ29uc3VtZSksIHZvaWQgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PblBheW1lbnRzQW55Q29uc3VtZSk7CiAgICAgICAgICAgIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25QYXltZW50c0NvbnN1bWVFcnJvcik7CiAgICAgICAgICAgIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25QYXltZW50c0FueUNvbnN1bWVFcnJvcikKICAgICAgICB9KS5jYXRjaChkID0+IHsKICAgICAgICAgICAgdGhpcy5pc0NvbnN1bWVQcm9kdWN0U3VjY2VzcyA9ICExOwogICAgICAgICAgICB0aGlzLmNvbnN1bWVQcm9kdWN0RXJyb3IgPSB0aGlzLmV0b3MoZCk7CiAgICAgICAgICAgIHRoaXMuaGFuZGxlUmVzdWx0KCExLCBkKTsKICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PblBheW1lbnRzQ29uc3VtZUVycm9yKTsKICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PblBheW1lbnRzQW55Q29uc3VtZUVycm9yKQogICAgICAgIH0pCiAgICB9LAogICAgUGF5bWVudHNTdWJzY3JpYmUoYSkgewogICAgICAgIHZhciBiID0gcGFyc2VJbnQoYSwgMTApIHx8IDA7CiAgICAgICAgcmV0dXJuIHRoaXMuZ3AucGF5bWVudHMuc3Vic2NyaWJlKDAgPCBiID8gewogICAgICAgICAgICBpZDogYgogICAgICAgIH0gOiB7CiAgICAgICAgICAgIHRhZzogYQogICAgICAgIH0pLnRoZW4oZCA9PiB7CiAgICAgICAgICAgIHRoaXMuaXNTdWJzY3JpYmVQcm9kdWN0U3VjY2VzcyA9IGQuc3VjY2VzczsKICAgICAgICAgICAgdGhpcy5oYW5kbGVSZXN1bHQoZC5zdWNjZXNzLCBkLmVycm9yKTsKICAgICAgICAgICAgdmFyIGMgPSBkLnByb2R1Y3QgfHwge307CiAgICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnRQdXJjaGFzZSA9IGQucHVyY2hhc2UgfHwge30sIHRoaXMuY3VycmVudFByb2R1Y3QgPSBjLCB0aGlzLmN1cnJlbnRQcm9kdWN0UHVyY2hhc2VzID0KICAgICAgICAgICAgICAgIDEsIHRoaXMucHVyY2hhc2VkUHJvZHVjdElkID0gYy5pZCB8fCAwLCB0aGlzLnB1cmNoYXNlZFByb2R1Y3RUYWcgPSBjLnRhZyB8fCAiIiwgZC5zdWNjZXNzKSByZXR1cm4gdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PblBheW1lbnRzU3Vic2NyaWJlKSwgdm9pZCB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uUGF5bWVudHNBbnlTdWJzY3JpYmUpOwogICAgICAgICAgICB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uUGF5bWVudHNTdWJzY3JpYmVFcnJvcik7CiAgICAgICAgICAgIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25QYXltZW50c0FueVN1YnNjcmliZUVycm9yKQogICAgICAgIH0pLmNhdGNoKGQgPT4gewogICAgICAgICAgICB0aGlzLmlzU3Vic2NyaWJlUHJvZHVjdFN1Y2Nlc3MgPSAhMTsKICAgICAgICAgICAgdGhpcy5oYW5kbGVSZXN1bHQoITEsIGQpOwogICAgICAgICAgICB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uUGF5bWVudHNTdWJzY3JpYmVFcnJvcik7CiAgICAgICAgICAgIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25QYXltZW50c0FueVN1YnNjcmliZUVycm9yKQogICAgICAgIH0pCiAgICB9LAogICAgUGF5bWVudHNVbnN1YnNjcmliZShhKSB7CiAgICAgICAgdmFyIGIgPQogICAgICAgICAgICBwYXJzZUludChhLCAxMCkgfHwgMDsKICAgICAgICByZXR1cm4gdGhpcy5ncC5wYXltZW50cy51bnN1YnNjcmliZSgwIDwgYiA/IHsKICAgICAgICAgICAgaWQ6IGIKICAgICAgICB9IDogewogICAgICAgICAgICB0YWc6IGEKICAgICAgICB9KS50aGVuKGQgPT4gewogICAgICAgICAgICB0aGlzLmlzVW5zdWJzY3JpYmVQcm9kdWN0U3VjY2VzcyA9IGQuc3VjY2VzczsKICAgICAgICAgICAgdGhpcy5oYW5kbGVSZXN1bHQoZC5zdWNjZXNzLCBkLmVycm9yKTsKICAgICAgICAgICAgdmFyIGMgPSBkLnByb2R1Y3QgfHwge307CiAgICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnRQdXJjaGFzZSA9IGQucHVyY2hhc2UgfHwge30sIHRoaXMuY3VycmVudFByb2R1Y3QgPSBjLCB0aGlzLmN1cnJlbnRQcm9kdWN0UHVyY2hhc2VzID0gMSwgdGhpcy5wdXJjaGFzZWRQcm9kdWN0SWQgPSBjLmlkIHx8IDAsIHRoaXMucHVyY2hhc2VkUHJvZHVjdFRhZyA9IGMudGFnIHx8ICIiLCBkLnN1Y2Nlc3MpIHJldHVybiB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uUGF5bWVudHNVbnN1YnNjcmliZSksIHZvaWQgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PblBheW1lbnRzQW55VW5zdWJzY3JpYmUpOwogICAgICAgICAgICB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uUGF5bWVudHNVbnN1YnNjcmliZUVycm9yKTsKICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PblBheW1lbnRzQW55VW5zdWJzY3JpYmVFcnJvcikKICAgICAgICB9KS5jYXRjaChkID0+IHsKICAgICAgICAgICAgdGhpcy5pc1Vuc3Vic2NyaWJlUHJvZHVjdFN1Y2Nlc3MgPSAhMTsKICAgICAgICAgICAgdGhpcy5oYW5kbGVSZXN1bHQoITEsIGQpOwogICAgICAgICAgICB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uUGF5bWVudHNVbnN1YnNjcmliZUVycm9yKTsKICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PblBheW1lbnRzQW55U3Vic2NyaWJlRXJyb3IpCiAgICAgICAgfSkKICAgIH0sCiAgICBJbWFnZXNGZXRjaChhLCBiLCBkLCBjKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZ3AuaW1hZ2VzLmZldGNoKHsKICAgICAgICAgICAgcGxheWVySWQ6IGIsCiAgICAgICAgICAgIGxpbWl0OiBkLAogICAgICAgICAgICBvZmZzZXQ6IGMsCiAgICAgICAgICAgIHRhZ3M6IHN0b2FycihhKQogICAgICAgIH0pLnRoZW4oZSA9PiB7CiAgICAgICAgICAgIHRoaXMuaW1hZ2VzID0gZS5pdGVtczsKICAgICAgICAgICAgdGhpcy5jYW5Mb2FkTW9yZUltYWdlcyA9IGUuY2FuTG9hZE1vcmU7CiAgICAgICAgICAgIHRoaXMuaGFuZGxlUmVzdWx0KCEwKTsKICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkltYWdlc0ZldGNoKQogICAgICAgIH0pLmNhdGNoKGUgPT4gewogICAgICAgICAgICB0aGlzLmhhbmRsZVJlc3VsdCghMSwKICAgICAgICAgICAgICAgIGUpOwogICAgICAgICAgICB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uSW1hZ2VzRmV0Y2hFcnJvcikKICAgICAgICB9KQogICAgfSwKICAgIEltYWdlc0ZldGNoTW9yZShhLCBiLCBkKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZ3AuaW1hZ2VzLmZldGNoTW9yZSh7CiAgICAgICAgICAgIHBsYXllcklkOiBiLAogICAgICAgICAgICBsaW1pdDogZCwKICAgICAgICAgICAgdGFnczogc3RvYXJyKGEpCiAgICAgICAgfSkudGhlbihjID0+IHsKICAgICAgICAgICAgdGhpcy5pbWFnZXMgPSBjLml0ZW1zOwogICAgICAgICAgICB0aGlzLmNhbkxvYWRNb3JlSW1hZ2VzID0gYy5jYW5Mb2FkTW9yZTsKICAgICAgICAgICAgdGhpcy5oYW5kbGVSZXN1bHQoITApOwogICAgICAgICAgICB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uSW1hZ2VzRmV0Y2hNb3JlKQogICAgICAgIH0pLmNhdGNoKGMgPT4gewogICAgICAgICAgICB0aGlzLmhhbmRsZVJlc3VsdCghMSwgYyk7CiAgICAgICAgICAgIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25JbWFnZXNGZXRjaE1vcmVFcnJvcikKICAgICAgICB9KQogICAgfSwKICAgIEltYWdlc1VwbG9hZChhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZ3AuaW1hZ2VzLnVwbG9hZCh7CiAgICAgICAgICAgIHRhZ3M6IHN0b2FycihhKQogICAgICAgIH0pLnRoZW4oYiA9PiB7CiAgICAgICAgICAgIHRoaXMuY3VycmVudEltYWdlID0gYiB8fCB7fTsKICAgICAgICAgICAgdGhpcy5oYW5kbGVSZXN1bHQoITApOwogICAgICAgICAgICB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uSW1hZ2VzVXBsb2FkKQogICAgICAgIH0pLmNhdGNoKGIgPT4gewogICAgICAgICAgICB0aGlzLmhhbmRsZVJlc3VsdCghMSwgYik7CiAgICAgICAgICAgIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25JbWFnZXNVcGxvYWRFcnJvcikKICAgICAgICB9KQogICAgfSwKICAgIEltYWdlc1VwbG9hZFVybChhLCBiKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZ3AuaW1hZ2VzLnVwbG9hZFVybCh7CiAgICAgICAgICAgIHVybDogYSwKICAgICAgICAgICAgdGFnczogc3RvYXJyKGIpCiAgICAgICAgfSkudGhlbihkID0+IHsKICAgICAgICAgICAgdGhpcy5jdXJyZW50SW1hZ2UgPSBkIHx8IHt9OwogICAgICAgICAgICB0aGlzLmhhbmRsZVJlc3VsdCghMCk7CiAgICAgICAgICAgIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25JbWFnZXNVcGxvYWQpCiAgICAgICAgfSkuY2F0Y2goZCA9PiB7CiAgICAgICAgICAgIHRoaXMuaGFuZGxlUmVzdWx0KCExLCBkKTsKICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkltYWdlc1VwbG9hZEVycm9yKQogICAgICAgIH0pCiAgICB9LAogICAgSW1hZ2VzQ2hvb3NlRmlsZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5ncC5pbWFnZXMuY2hvb3NlRmlsZSgpLnRoZW4oYSA9PiB7CiAgICAgICAgICAgIHRoaXMubGFzdEltYWdlVGVtcFVybCA9IGEudGVtcFVybDsKICAgICAgICAgICAgdGhpcy5oYW5kbGVSZXN1bHQoITApOwogICAgICAgICAgICB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uSW1hZ2VzQ2hvb3NlKQogICAgICAgIH0pLmNhdGNoKGEgPT4gewogICAgICAgICAgICB0aGlzLmhhbmRsZVJlc3VsdCghMSwgYSk7CiAgICAgICAgICAgIHRoaXMubGFzdEltYWdlVGVtcFVybCA9ICIiOwogICAgICAgICAgICB0aGlzLmlzTGFzdEFjdGlvblN1Y2Nlc3MgPSAhMTsKICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkltYWdlc0Nob29zZUVycm9yKQogICAgICAgIH0pCiAgICB9LAogICAgRmlsZXNGZXRjaChhLCBiLCBkLCBjKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZ3AuZmlsZXMuZmV0Y2goewogICAgICAgICAgICBwbGF5ZXJJZDogYiwKICAgICAgICAgICAgbGltaXQ6IGQsCiAgICAgICAgICAgIG9mZnNldDogYywKICAgICAgICAgICAgdGFnczogc3RvYXJyKGEpCiAgICAgICAgfSkudGhlbihlID0+IHsKICAgICAgICAgICAgdGhpcy5maWxlcyA9IGUuaXRlbXM7CiAgICAgICAgICAgIHRoaXMuY2FuTG9hZE1vcmVGaWxlcyA9IGUuY2FuTG9hZE1vcmU7CiAgICAgICAgICAgIHRoaXMuaGFuZGxlUmVzdWx0KCEwKTsKICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkZpbGVzRmV0Y2gpCiAgICAgICAgfSkuY2F0Y2goZSA9PiB7CiAgICAgICAgICAgIHRoaXMuaGFuZGxlUmVzdWx0KCExLCBlKTsKICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkZpbGVzRmV0Y2hFcnJvcikKICAgICAgICB9KQogICAgfSwKICAgIEZpbGVzRmV0Y2hNb3JlKGEsIGIsIGQpIHsKICAgICAgICByZXR1cm4gdGhpcy5ncC5maWxlcy5mZXRjaE1vcmUoewogICAgICAgICAgICBwbGF5ZXJJZDogYiwKICAgICAgICAgICAgbGltaXQ6IGQsCiAgICAgICAgICAgIHRhZ3M6IHN0b2FycihhKQogICAgICAgIH0pLnRoZW4oYyA9PiB7CiAgICAgICAgICAgIHRoaXMuZmlsZXMgPSBjLml0ZW1zOwogICAgICAgICAgICB0aGlzLmNhbkxvYWRNb3JlRmlsZXMgPSBjLmNhbkxvYWRNb3JlOwogICAgICAgICAgICB0aGlzLmhhbmRsZVJlc3VsdCghMCk7CiAgICAgICAgICAgIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25GaWxlc0ZldGNoTW9yZSkKICAgICAgICB9KS5jYXRjaChjID0+IHsKICAgICAgICAgICAgdGhpcy5oYW5kbGVSZXN1bHQoITEsIGMpOwogICAgICAgICAgICB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uRmlsZXNGZXRjaE1vcmVFcnJvcikKICAgICAgICB9KQogICAgfSwKICAgIEZpbGVzVXBsb2FkKGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5ncC5maWxlcy51cGxvYWQoewogICAgICAgICAgICB0YWdzOiBzdG9hcnIoYSkKICAgICAgICB9KS50aGVuKGIgPT4gewogICAgICAgICAgICB0aGlzLmN1cnJlbnRGaWxlID0gYiB8fCB7fTsKICAgICAgICAgICAgdGhpcy5oYW5kbGVSZXN1bHQoITApOwogICAgICAgICAgICB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uRmlsZXNVcGxvYWQpCiAgICAgICAgfSkuY2F0Y2goYiA9PiB7CiAgICAgICAgICAgIHRoaXMuaGFuZGxlUmVzdWx0KCExLCBiKTsKICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkZpbGVzVXBsb2FkRXJyb3IpCiAgICAgICAgfSkKICAgIH0sCiAgICBGaWxlc1VwbG9hZFVybChhLAogICAgICAgIGIsIGQpIHsKICAgICAgICByZXR1cm4gdGhpcy5ncC5maWxlcy51cGxvYWRVcmwoewogICAgICAgICAgICB1cmw6IGEsCiAgICAgICAgICAgIGZpbGVuYW1lOiBiLAogICAgICAgICAgICB0YWdzOiBzdG9hcnIoZCkKICAgICAgICB9KS50aGVuKGMgPT4gewogICAgICAgICAgICB0aGlzLmN1cnJlbnRGaWxlID0gYyB8fCB7fTsKICAgICAgICAgICAgdGhpcy5oYW5kbGVSZXN1bHQoITApOwogICAgICAgICAgICB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uRmlsZXNVcGxvYWQpCiAgICAgICAgfSkuY2F0Y2goYyA9PiB7CiAgICAgICAgICAgIHRoaXMuaGFuZGxlUmVzdWx0KCExLCBjKTsKICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkZpbGVzVXBsb2FkRXJyb3IpCiAgICAgICAgfSkKICAgIH0sCiAgICBGaWxlc1VwbG9hZENvbnRlbnQoYSwgYiwgZCkgewogICAgICAgIHJldHVybiB0aGlzLmdwLmZpbGVzLnVwbG9hZENvbnRlbnQoewogICAgICAgICAgICBjb250ZW50OiBhLAogICAgICAgICAgICBmaWxlbmFtZTogYiwKICAgICAgICAgICAgdGFnczogc3RvYXJyKGQpCiAgICAgICAgfSkudGhlbihjID0+IHsKICAgICAgICAgICAgdGhpcy5jdXJyZW50RmlsZSA9IGMgfHwge307CiAgICAgICAgICAgIHRoaXMuaGFuZGxlUmVzdWx0KCEwKTsKICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkZpbGVzVXBsb2FkKQogICAgICAgIH0pLmNhdGNoKGMgPT4gewogICAgICAgICAgICB0aGlzLmhhbmRsZVJlc3VsdCghMSwgYyk7CiAgICAgICAgICAgIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25GaWxlc1VwbG9hZEVycm9yKQogICAgICAgIH0pCiAgICB9LAogICAgRmlsZXNMb2FkQ29udGVudChhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZ3AuZmlsZXMubG9hZENvbnRlbnQoYSkudGhlbihiID0+IHsKICAgICAgICAgICAgdGhpcy5sYXN0RmlsZUNvbnRlbnQgPSBiOwogICAgICAgICAgICB0aGlzLmhhbmRsZVJlc3VsdCghMCk7CiAgICAgICAgICAgIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25GaWxlc0xvYWRDb250ZW50KQogICAgICAgIH0pLmNhdGNoKGIgPT4gewogICAgICAgICAgICB0aGlzLmxhc3RGaWxlQ29udGVudCA9ICIiOwogICAgICAgICAgICB0aGlzLmhhbmRsZVJlc3VsdCghMSwgYik7CiAgICAgICAgICAgIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25GaWxlc0xvYWRDb250ZW50RXJyb3IpCiAgICAgICAgfSkKICAgIH0sCiAgICBGaWxlc0Nob29zZUZpbGUoYSkgewogICAgICAgIHJldHVybiB0aGlzLmdwLmZpbGVzLmNob29zZUZpbGUoYSkudGhlbihiID0+IHsKICAgICAgICAgICAgdGhpcy5sYXN0RmlsZVRlbXBVcmwgPSBiLnRlbXBVcmw7CiAgICAgICAgICAgIHRoaXMuaGFuZGxlUmVzdWx0KCEwKTsKICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkZpbGVzQ2hvb3NlKQogICAgICAgIH0pLmNhdGNoKGIgPT4gewogICAgICAgICAgICB0aGlzLmhhbmRsZVJlc3VsdCghMSwgYik7CiAgICAgICAgICAgIHRoaXMubGFzdEZpbGVUZW1wVXJsID0gIiI7CiAgICAgICAgICAgIHRoaXMuaXNMYXN0QWN0aW9uU3VjY2VzcyA9ICExOwogICAgICAgICAgICB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uRmlsZXNDaG9vc2VFcnJvcikKICAgICAgICB9KQogICAgfSwKICAgIFZhcmlhYmxlc0ZldGNoKCkgewogICAgICAgIHJldHVybiB0aGlzLmdwLnZhcmlhYmxlcy5mZXRjaCgpLnRoZW4oKCkgPT4gewogICAgICAgICAgICB0aGlzLmhhbmRsZVJlc3VsdCghMCk7CiAgICAgICAgICAgIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25WYXJpYWJsZXNGZXRjaCkKICAgICAgICB9KS5jYXRjaChhID0+IHsKICAgICAgICAgICAgdGhpcy5oYW5kbGVSZXN1bHQoITEsIGEpOwogICAgICAgICAgICB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uVmFyaWFibGVzRmV0Y2hFcnJvcikKICAgICAgICB9KQogICAgfSwKICAgIEZ1bGxzY3JlZW5PcGVuKCkgewogICAgICAgIHJldHVybiB0aGlzLmdwLmZ1bGxzY3JlZW4ub3BlbigpCiAgICB9LAogICAgRnVsbHNjcmVlbkNsb3NlKCkgewogICAgICAgIHJldHVybiB0aGlzLmdwLmZ1bGxzY3JlZW4uY2xvc2UoKQogICAgfSwKICAgIEZ1bGxzY3JlZW5Ub2dnbGUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZ3AuZnVsbHNjcmVlbi50b2dnbGUoKQogICAgfSwKICAgIEFkc1Nob3dGdWxsc2NyZWVuKCkgewogICAgICAgIHJldHVybiB0aGlzLmdwLmFkcy5zaG93RnVsbHNjcmVlbigpCiAgICB9LAogICAgQWRzU2hvd1Jld2FyZGVkKCkgewogICAgICAgIHJldHVybiB0aGlzLmdwLmFkcy5zaG93UmV3YXJkZWRWaWRlbygpCiAgICB9LAogICAgQWRzU2hvd1ByZWxvYWRlcigpIHsKICAgICAgICByZXR1cm4gdGhpcy5ncC5hZHMuc2hvd1ByZWxvYWRlcigpCiAgICB9LAogICAgQWRzU2hvd1N0aWNreSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5ncC5hZHMuc2hvd1N0aWNreSgpCiAgICB9LAogICAgQWRzQ2xvc2VTdGlja3koKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZ3AuYWRzLmNsb3NlU3RpY2t5KCkKICAgIH0sCiAgICBBZHNSZWZyZXNoU3RpY2t5KCkgewogICAgICAgIHJldHVybiB0aGlzLmdwLmFkcy5yZWZyZXNoU3RpY2t5KCkKICAgIH0sCiAgICBBbmFseXRpY3NIaXQoYSkgewogICAgICAgIHJldHVybiB0aGlzLmdwLmFuYWx5dGljcy5oaXQoYSkKICAgIH0sCiAgICBBbmFseXRpY3NHb2FsKGEsIGIpIHsKICAgICAgICByZXR1cm4gdGhpcy5ncC5hbmFseXRpY3MuZ29hbChhLCBiKQogICAgfSwKICAgIFNvY2lhbHNTaGFyZShhLCBiLCBkKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZ3Auc29jaWFscy5zaGFyZSh7CiAgICAgICAgICAgIHRleHQ6IGEsCiAgICAgICAgICAgIHVybDogYiwKICAgICAgICAgICAgaW1hZ2U6IGQKICAgICAgICB9KQogICAgfSwKICAgIFNvY2lhbHNQb3N0KGEsIGIsIGQpIHsKICAgICAgICByZXR1cm4gdGhpcy5ncC5zb2NpYWxzLnBvc3QoewogICAgICAgICAgICB0ZXh0OiBhLAogICAgICAgICAgICB1cmw6IGIsCiAgICAgICAgICAgIGltYWdlOiBkCiAgICAgICAgfSkKICAgIH0sCiAgICBTb2NpYWxzSW52aXRlKGEsIGIsIGQpIHsKICAgICAgICByZXR1cm4gdGhpcy5ncC5zb2NpYWxzLmludml0ZSh7CiAgICAgICAgICAgIHRleHQ6IGEsCiAgICAgICAgICAgIHVybDogYiwKICAgICAgICAgICAgaW1hZ2U6IGQKICAgICAgICB9KQogICAgfSwKICAgIFNvY2lhbHNKb2luQ29tbXVuaXR5KCkgewogICAgICAgIHJldHVybiB0aGlzLmdwLnNvY2lhbHMuam9pbkNvbW11bml0eSgpCiAgICB9LAogICAgR2FtZXNDb2xsZWN0aW9uc09wZW4oYSkgewogICAgICAgIHZhciBiID0gcGFyc2VJbnQoYSwgMTApIHx8IDA7CiAgICAgICAgcmV0dXJuIHRoaXMuZ3AuZ2FtZXNDb2xsZWN0aW9ucy5vcGVuKDAgPCBiID8gewogICAgICAgICAgICBpZDogYgogICAgICAgIH0gOiB7CiAgICAgICAgICAgIHRhZzogYSB8fCAiQU5ZIgogICAgICAgIH0pCiAgICB9LAogICAgR2FtZXNDb2xsZWN0aW9uc0ZldGNoKGEpIHsKICAgICAgICB2YXIgYiA9IHBhcnNlSW50KGEsIDEwKSB8fCAwOwogICAgICAgIHJldHVybiB0aGlzLmdwLmdhbWVzQ29sbGVjdGlvbnMuZmV0Y2goMCA8IGIgPyB7CiAgICAgICAgICAgIGlkOiBiCiAgICAgICAgfSA6IHsKICAgICAgICAgICAgdGFnOiBhCiAgICAgICAgfSkudGhlbihkID0+IHsKICAgICAgICAgICAgdGhpcy5sYXN0R2FtZXNDb2xsZWN0aW9uSWRPclRhZyA9IGE7CiAgICAgICAgICAgIHRoaXMuZ2FtZXNDb2xsZWN0aW9uID0gZDsKICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkdhbWVzQ29sbGVjdGlvbnNGZXRjaCk7CiAgICAgICAgICAgIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25HYW1lc0NvbGxlY3Rpb25zRmV0Y2hBbnkpCiAgICAgICAgfSkuY2F0Y2goZCA9PiB7CiAgICAgICAgICAgIHRoaXMuaGFuZGxlUmVzdWx0KCExLAogICAgICAgICAgICAgICAgZCk7CiAgICAgICAgICAgIHRoaXMubGFzdEdhbWVzQ29sbGVjdGlvbklkT3JUYWcgPSBhOwogICAgICAgICAgICB0aGlzLmdhbWVzQ29sbGVjdGlvbkZldGNoRXJyb3IgPSBkICYmIGQubWVzc2FnZSB8fCAiIjsKICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkdhbWVzQ29sbGVjdGlvbnNGZXRjaEVycm9yKTsKICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkdhbWVzQ29sbGVjdGlvbnNGZXRjaEFueUVycm9yKQogICAgICAgIH0pCiAgICB9LAogICAgRG9jdW1lbnRzT3BlbihhKSB7CiAgICAgICAgYSA9IHRoaXMubWFwcGVycy5kb2N1bWVudFR5cGVzW2FdOwogICAgICAgIHJldHVybiB0aGlzLmdwLmRvY3VtZW50cy5vcGVuKHsKICAgICAgICAgICAgdHlwZTogYQogICAgICAgIH0pCiAgICB9LAogICAgRG9jdW1lbnRzRmV0Y2goYSwgYikgewogICAgICAgIGNvbnN0IGQgPSB0aGlzLm1hcHBlcnMuZG9jdW1lbnRUeXBlc1thXTsKICAgICAgICBhID0gdGhpcy5tYXBwZXJzLmRvY3VtZW50Rm9ybWF0W2JdOwogICAgICAgIHJldHVybiB0aGlzLmdwLmRvY3VtZW50cy5mZXRjaCh7CiAgICAgICAgICAgIHR5cGU6IGQsCiAgICAgICAgICAgIGZvcm1hdDogYQogICAgICAgIH0pLnRoZW4oYyA9PiB7CiAgICAgICAgICAgIHRoaXMubGFzdERvY3VtZW50VHlwZSA9IGQ7CiAgICAgICAgICAgIHRoaXMuZG9jdW1lbnQgPSBjOwogICAgICAgICAgICB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uRG9jdW1lbnRzRmV0Y2gpOwogICAgICAgICAgICB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uRG9jdW1lbnRzRmV0Y2hBbnkpCiAgICAgICAgfSkuY2F0Y2goYyA9PiB7CiAgICAgICAgICAgIHRoaXMuaGFuZGxlUmVzdWx0KCExLCBjKTsKICAgICAgICAgICAgdGhpcy5kb2N1bWVudEZldGNoRXJyb3IgPSB0aGlzLmV0b3MoYyk7CiAgICAgICAgICAgIHRoaXMubGFzdERvY3VtZW50VHlwZSA9IGQ7CiAgICAgICAgICAgIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25Eb2N1bWVudHNGZXRjaEVycm9yKTsKICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkRvY3VtZW50c0ZldGNoQW55RXJyb3IpCiAgICAgICAgfSkKICAgIH0sCiAgICBQbGF5ZXJzRmV0Y2goYSwgYikgewogICAgICAgIHJldHVybiB0aGlzLmdwLnBsYXllcnMuZmV0Y2goewogICAgICAgICAgICBpZHM6IHN0b2FycihiLCBOdW1iZXIpCiAgICAgICAgfSkudGhlbihkID0+IHsKICAgICAgICAgICAgdGhpcy5sYXN0UGxheWVyc1RhZyA9IGE7CiAgICAgICAgICAgIHRoaXMucGxheWVyc0xpc3QgPSBkLnBsYXllcnM7CiAgICAgICAgICAgIHRoaXMuaGFuZGxlUmVzdWx0KCEwKTsKICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PblBsYXllcnNGZXRjaCk7CiAgICAgICAgICAgIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25QbGF5ZXJzQW55RmV0Y2gpCiAgICAgICAgfSkuY2F0Y2goZCA9PiB7CiAgICAgICAgICAgIHRoaXMubGFzdFBsYXllcnNUYWcgPSBhOwogICAgICAgICAgICB0aGlzLmhhbmRsZVJlc3VsdCghMSwgZCk7CiAgICAgICAgICAgIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25QbGF5ZXJzRmV0Y2hFcnJvcik7CiAgICAgICAgICAgIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25QbGF5ZXJzQW55RmV0Y2hFcnJvcikKICAgICAgICB9KQogICAgfSwKICAgIFBsYXllcnNGZXRjaE9uZShhLCBiKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZ3AucGxheWVycy5mZXRjaCh7CiAgICAgICAgICAgIGlkczogW051bWJlcihiKV0KICAgICAgICB9KS50aGVuKGQgPT4gewogICAgICAgICAgICB0aGlzLmxhc3RQbGF5ZXJzVGFnID0gYTsKICAgICAgICAgICAgZC5wbGF5ZXJzWzBdID8gKHRoaXMucGxheWVyc0xpc3QgPSBkLnBsYXllcnMsIHRoaXMuY3VycmVudFBsYXllcnNJbmRleCA9IDAsIHRoaXMuY3VycmVudFBsYXllcnNQbGF5ZXIgPSBkLnBsYXllcnNbMF0sIHRoaXMuaGFuZGxlUmVzdWx0KCEwKSwgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PblBsYXllcnNGZXRjaCksIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25QbGF5ZXJzQW55RmV0Y2gpKSA6ICh0aGlzLmhhbmRsZVJlc3VsdCghMSwgRXJyb3IoInBsYXllcl9ub3RfZm91bmQiKSksCiAgICAgICAgICAgICAgICB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uUGxheWVyc0ZldGNoRXJyb3IpLCB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uUGxheWVyc0FueUZldGNoRXJyb3IpKQogICAgICAgIH0pLmNhdGNoKGQgPT4gewogICAgICAgICAgICB0aGlzLmxhc3RQbGF5ZXJzVGFnID0gYTsKICAgICAgICAgICAgdGhpcy5oYW5kbGVSZXN1bHQoITEsIGQpOwogICAgICAgICAgICB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uUGxheWVyc0ZldGNoRXJyb3IpOwogICAgICAgICAgICB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uUGxheWVyc0FueUZldGNoRXJyb3IpCiAgICAgICAgfSkKICAgIH0sCiAgICBBcHBBZGRTaG9ydGN1dCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5ncC5hcHAuYWRkU2hvcnRjdXQoKQogICAgfSwKICAgIENoYW5nZUxhbmd1YWdlKGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5ncC5jaGFuZ2VMYW5ndWFnZSh0aGlzLm1hcHBlcnMubGFuZ3VhZ2VbYV0pCiAgICB9LAogICAgQ2hhbmdlTGFuZ3VhZ2VCeUNvZGUoYSA9ICIiKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZ3AuY2hhbmdlTGFuZ3VhZ2UoYS50b0xvd2VyQ2FzZSgpKQogICAgfSwKICAgIENoYW5nZUF2YXRhckdlbmVyYXRvcihhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZ3AuY2hhbmdlQXZhdGFyR2VuZXJhdG9yKHRoaXMubWFwcGVycy5hdmF0YXJHZW5lcmF0b3JbYV0pCiAgICB9LAogICAgU2V0QmFja2dyb3VuZChhLCBiLCBkKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZ3Auc2V0QmFja2dyb3VuZCh7CiAgICAgICAgICAgIHVybDogYSwKICAgICAgICAgICAgYmx1cjogYiwKICAgICAgICAgICAgZmFkZTogZAogICAgICAgIH0pCiAgICB9LAogICAgTG9hZE92ZXJsYXkoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZ3AubG9hZE92ZXJsYXkoKQogICAgfSwKICAgIFBhdXNlKCkgewogICAgICAgIHJldHVybiB0aGlzLmdwLnBhdXNlKCkKICAgIH0sCiAgICBSZXN1bWUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZ3AucmVzdW1lKCkKICAgIH0sCiAgICBHYW1lcGxheVN0YXJ0KCkgewogICAgICAgIHJldHVybiB0aGlzLmdwLmdhbWVwbGF5U3RhcnQoKQogICAgfSwKICAgIEdhbWVwbGF5U3RvcCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5ncC5nYW1lcGxheVN0b3AoKQogICAgfSwKICAgIExvYWRGcm9tSlNPTihhKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgdmFyIGIgPSBKU09OLnBhcnNlKGEpOwogICAgICAgICAgICBpZiAoISgiaXNSZWFkeSIgaW4gYikpIHRocm93IEVycm9yKCJEYXRhIHdhcyBjb3JydXB0ZWQiKTsKICAgICAgICAgICAgdGhpcy5Mb2FkRnJvbUpzb24oYikKICAgICAgICB9IGNhdGNoIChkKSB7CiAgICAgICAgICAgIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25Mb2FkSnNvbkVycm9yKQogICAgICAgIH0KICAgIH0KfTsKInVzZSBzdHJpY3QiOwpDMy5QbHVnaW5zLkVwb25lc2hfR2FtZVNjb3JlLkV4cHMgPSB7CiAgICBQbGF5ZXJJRCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5ncC5wbGF5ZXIuaWQKICAgIH0sCiAgICBQbGF5ZXJTY29yZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5ncC5wbGF5ZXIuc2NvcmUKICAgIH0sCiAgICBQbGF5ZXJOYW1lKCkgewogICAgICAgIHJldHVybiB0aGlzLmdwLnBsYXllci5uYW1lCiAgICB9LAogICAgUGxheWVyQXZhdGFyKCkgewogICAgICAgIHJldHVybiB0aGlzLmdwLnBsYXllci5hdmF0YXIKICAgIH0sCiAgICBQbGF5ZXJHZXQoYSkgewogICAgICAgIHJldHVybiB0aGlzLmdwLnBsYXllci5nZXQoYSkKICAgIH0sCiAgICBQbGF5ZXJIYXMoYSkgewogICAgICAgIHJldHVybiB0aGlzLmdwLnBsYXllci5pcyhhKQogICAgfSwKICAgIFBsYXllckZpZWxkTmFtZShhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZ3AucGxheWVyLmdldEZpZWxkTmFtZShhKQogICAgfSwKICAgIFBsYXllckZpZWxkVmFyaWFudE5hbWUoYSwgYikgewogICAgICAgIHJldHVybiB0aGlzLmdwLnBsYXllci5nZXRGaWVsZFZhcmlhbnROYW1lKGEsIGIpCiAgICB9LAogICAgUGxheWVyR2V0RmllbGRWYXJpYW50QXQoYSwgYikgewogICAgICAgIHJldHVybiAoYSA9IHRoaXMuZ3AucGxheWVyLmdldEZpZWxkKGEpLnZhcmlhbnRzW2JdKSA/IGEudmFsdWUgOgogICAgICAgICAgICAiIgogICAgfSwKICAgIFBsYXllckdldEZpZWxkVmFyaWFudEluZGV4KGEsIGIpIHsKICAgICAgICByZXR1cm4gdGhpcy5ncC5wbGF5ZXIuZ2V0RmllbGQoYSkudmFyaWFudHMuZmluZEluZGV4KGQgPT4gZC52YWx1ZSA9PT0gYikKICAgIH0sCiAgICBQbGF5ZXJDdXJGaWVsZEtleSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50UGxheWVyRmllbGRLZXkgfHwgIiIKICAgIH0sCiAgICBQbGF5ZXJDdXJGaWVsZFR5cGUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudFBsYXllckZpZWxkVHlwZSB8fCAiIgogICAgfSwKICAgIFBsYXllckN1ckZpZWxkTmFtZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50UGxheWVyRmllbGROYW1lIHx8ICIiCiAgICB9LAogICAgUGxheWVyQ3VyRmllbGRWYWx1ZSgpIHsKICAgICAgICByZXR1cm4gInN0cmluZyIgPT0gdHlwZW9mIHRoaXMuY3VycmVudFBsYXllckZpZWxkVmFsdWUgPyB0aGlzLmN1cnJlbnRQbGF5ZXJGaWVsZFZhbHVlIDogTnVtYmVyKHRoaXMuY3VycmVudFBsYXllckZpZWxkVmFsdWUgfHwgMCkKICAgIH0sCiAgICBQbGF5ZXJDdXJGaWVsZFZhcmlhbnRWYWx1ZSgpIHsKICAgICAgICByZXR1cm4gInN0cmluZyIgPT0gdHlwZW9mIHRoaXMuY3VycmVudFBsYXllckZpZWxkVmFyaWFudFZhbHVlID8KICAgICAgICAgICAgdGhpcy5jdXJyZW50UGxheWVyRmllbGRWYXJpYW50VmFsdWUgOiBOdW1iZXIodGhpcy5jdXJyZW50UGxheWVyRmllbGRWYXJpYW50VmFsdWUgfHwgMCkKICAgIH0sCiAgICBQbGF5ZXJDdXJGaWVsZFZhcmlhbnROYW1lKCkgewogICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRQbGF5ZXJGaWVsZFZhcmlhbnROYW1lIHx8ICIiCiAgICB9LAogICAgUGxheWVyQ3VyRmllbGRWYXJpYW50SW5kZXgoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudFBsYXllckZpZWxkVmFyaWFudEluZGV4IHx8IDAKICAgIH0sCiAgICBMZWFkZXJib2FyZEN1clBsYXllck5hbWUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudExlYWRlcmJvYXJkUGxheWVyLm5hbWUgfHwgIiIKICAgIH0sCiAgICBMZWFkZXJib2FyZEN1clBsYXllckF2YXRhcigpIHsKICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50TGVhZGVyYm9hcmRQbGF5ZXIuYXZhdGFyIHx8ICIiCiAgICB9LAogICAgTGVhZGVyYm9hcmRDdXJQbGF5ZXJJRCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50TGVhZGVyYm9hcmRQbGF5ZXIuaWQgfHwgMAogICAgfSwKICAgIExlYWRlcmJvYXJkQ3VyUGxheWVyU2NvcmUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudExlYWRlcmJvYXJkUGxheWVyLnNjb3JlIHx8CiAgICAgICAgICAgIDAKICAgIH0sCiAgICBMZWFkZXJib2FyZEN1clBsYXllclBvc2l0aW9uKCkgewogICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRMZWFkZXJib2FyZFBsYXllci5wb3NpdGlvbiB8fCAwCiAgICB9LAogICAgTGVhZGVyYm9hcmRDdXJQbGF5ZXJJbmRleCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50TGVhZGVyYm9hcmRJbmRleCB8fCAwCiAgICB9LAogICAgTGVhZGVyYm9hcmRDdXJQbGF5ZXJGaWVsZChhKSB7CiAgICAgICAgcmV0dXJuIGEgaW4gdGhpcy5jdXJyZW50TGVhZGVyYm9hcmRQbGF5ZXIgPyB0aGlzLmN1cnJlbnRMZWFkZXJib2FyZFBsYXllclthXSA6IDAKICAgIH0sCiAgICBMZWFkZXJib2FyZFBsYXllckZpZWxkQXQoYSwgYikgewogICAgICAgIHJldHVybiAoYSA9IHRoaXMubGVhZGVyYm9hcmRbYV0pICYmIGIgaW4gYSA/IGFbYl0gOiAwCiAgICB9LAogICAgTGVhZGVyYm9hcmRQbGF5ZXJQb3NpdGlvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5sZWFkZXJib2FyZFBsYXllclBvc2l0aW9uIHx8IDAKICAgIH0sCiAgICBMYXN0TGVhZGVyYm9hcmRUYWcoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMubGFzdExlYWRlcmJvYXJkVGFnCiAgICB9LAogICAgTGFzdExlYWRlcmJvYXJkVmFyaWFudCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5sYXN0TGVhZGVyYm9hcmRWYXJpYW50CiAgICB9LAogICAgSXNGdWxsc2NyZWVuTW9kZSgpIHsKICAgICAgICByZXR1cm4gTnVtYmVyKHRoaXMuZ3AuZnVsbHNjcmVlbi5pc0VuYWJsZWQpCiAgICB9LAogICAgTGFuZ3VhZ2UoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZ3AubGFuZ3VhZ2UKICAgIH0sCiAgICBBdmF0YXJHZW5lcmF0b3IoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZ3AuYXZhdGFyR2VuZXJhdG9yCiAgICB9LAogICAgU2VydmVyVGltZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5ncC5zZXJ2ZXJUaW1lCiAgICB9LAogICAgSXNQYXVzZWQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZ3AuaXNQYXVzZWQKICAgIH0sCiAgICBJc0dhbWVwbGF5KCkgewogICAgICAgIHJldHVybiB0aGlzLmdwLmlzR2FtZXBsYXkKICAgIH0sCiAgICBQbGF0Zm9ybVR5cGUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZ3AucGxhdGZvcm0udHlwZQogICAgfSwKICAgIEFwcFRpdGxlKCkgewogICAgICAgIHJldHVybiB0aGlzLmdwLmFwcC50aXRsZQogICAgfSwKICAgIEFwcERlc2NyaXB0aW9uKCkgewogICAgICAgIHJldHVybiB0aGlzLmdwLmFwcC5kZXNjcmlwdGlvbgogICAgfSwKICAgIEFwcEltYWdlKCkgewogICAgICAgIHJldHVybiB0aGlzLmdwLmFwcC5pbWFnZQogICAgfSwKICAgIEFwcFVybCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5ncC5hcHAudXJsCiAgICB9LAogICAgQWNoaWV2ZW1lbnRzVG90YWxBY2hpZXZlbWVudHMoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuYWNoaWV2ZW1lbnRzLmxlbmd0aAogICAgfSwKICAgIEFjaGlldmVtZW50c1RvdGFsQWNoaWV2ZW1lbnRzR3JvdXBzKCkgewogICAgICAgIHJldHVybiB0aGlzLmFjaGlldmVtZW50c0dyb3Vwcy5sZW5ndGgKICAgIH0sCiAgICBBY2hpZXZlbWVudHNUb3RhbFBsYXllckFjaGlldmVtZW50cygpIHsKICAgICAgICByZXR1cm4gdGhpcy5wbGF5ZXJBY2hpZXZlbWVudHMubGVuZ3RoCiAgICB9LAogICAgQWNoaWV2ZW1lbnRzQ3VyQWNoaWV2ZW1lbnRJbmRleCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnRJbmRleAogICAgfSwKICAgIEFjaGlldmVtZW50c0N1ckFjaGlldmVtZW50SUQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudEFjaGlldmVtZW50LmlkCiAgICB9LAogICAgQWNoaWV2ZW1lbnRzQ3VyQWNoaWV2ZW1lbnRUYWcoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudEFjaGlldmVtZW50LnRhZwogICAgfSwKICAgIEFjaGlldmVtZW50c0N1ckFjaGlldmVtZW50TmFtZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnQubmFtZQogICAgfSwKICAgIEFjaGlldmVtZW50c0N1ckFjaGlldmVtZW50RGVzY3JpcHRpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudEFjaGlldmVtZW50LmRlc2NyaXB0aW9uCiAgICB9LAogICAgQWNoaWV2ZW1lbnRzQ3VyQWNoaWV2ZW1lbnRJY29uKCkgewogICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRBY2hpZXZlbWVudC5pY29uCiAgICB9LAogICAgQWNoaWV2ZW1lbnRzQ3VyQWNoaWV2ZW1lbnRJY29uU21hbGwoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudEFjaGlldmVtZW50Lmljb25TbWFsbAogICAgfSwKICAgIEFjaGlldmVtZW50c0N1ckFjaGlldmVtZW50UmFyZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnQucmFyZQogICAgfSwKICAgIEFjaGlldmVtZW50c0N1ckFjaGlldmVtZW50VW5sb2NrZWQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudEFjaGlldmVtZW50LnVubG9ja2VkCiAgICB9LAogICAgQWNoaWV2ZW1lbnRzQ3VyQWNoaWV2ZW1lbnRMb2NrZWRJY29uKCkgewogICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRBY2hpZXZlbWVudC5sb2NrZWRJY29uCiAgICB9LAogICAgQWNoaWV2ZW1lbnRzQ3VyQWNoaWV2ZW1lbnRMb2NrZWRJY29uU21hbGwoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudEFjaGlldmVtZW50LmxvY2tlZEljb25TbWFsbAogICAgfSwKICAgIEFjaGlldmVtZW50c0N1ckFjaGlldmVtZW50UHJvZ3Jlc3MoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudEFjaGlldmVtZW50LnByb2dyZXNzCiAgICB9LAogICAgQWNoaWV2ZW1lbnRzQ3VyQWNoaWV2ZW1lbnRNYXhQcm9ncmVzcygpIHsKICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnQubWF4UHJvZ3Jlc3MKICAgIH0sCiAgICBBY2hpZXZlbWVudHNDdXJBY2hpZXZlbWVudFByb2dyZXNzU3RlcCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnQucHJvZ3Jlc3NTdGVwCiAgICB9LAogICAgQWNoaWV2ZW1lbnRzQ3VyQWNoaWV2ZW1lbnRzR3JvdXBJbmRleCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnRzR3JvdXBJbmRleAogICAgfSwKICAgIEFjaGlldmVtZW50c0N1ckFjaGlldmVtZW50c0dyb3VwSUQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudEFjaGlldmVtZW50c0dyb3VwSUQKICAgIH0sCiAgICBBY2hpZXZlbWVudHNDdXJBY2hpZXZlbWVudHNHcm91cFRhZygpIHsKICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnRzR3JvdXBUYWcKICAgIH0sCiAgICBBY2hpZXZlbWVudHNDdXJBY2hpZXZlbWVudHNHcm91cE5hbWUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudEFjaGlldmVtZW50c0dyb3VwTmFtZQogICAgfSwKICAgIEFjaGlldmVtZW50c0N1ckFjaGlldmVtZW50c0dyb3VwRGVzY3JpcHRpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudEFjaGlldmVtZW50c0dyb3VwRGVzY3JpcHRpb24KICAgIH0sCiAgICBBY2hpZXZlbWVudHNDdXJQbGF5ZXJBY2hpZXZlbWVudEluZGV4KCkgewogICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRQbGF5ZXJBY2hpZXZlbWVudEluZGV4CiAgICB9LAogICAgQWNoaWV2ZW1lbnRzQ3VyUGxheWVyQWNoaWV2ZW1lbnRJRCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50UGxheWVyQWNoaWV2ZW1lbnRJZAogICAgfSwKICAgIEFjaGlldmVtZW50c0N1clBsYXllckFjaGlldmVtZW50VW5sb2NrRGF0ZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50UGxheWVyQWNoaWV2ZW1lbnRVbmxvY2tEYXRlCiAgICB9LAogICAgQWNoaWV2ZW1lbnRzVW5sb2NrZWRBY2hpZXZlbWVudFN1Y2Nlc3MoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuaXNVbmxvY2tBY2hpZXZlbWVudFN1Y2Nlc3MKICAgIH0sCiAgICBBY2hpZXZlbWVudHNVbmxvY2tlZEFjaGlldmVtZW50RXJyb3IoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMudW5sb2NrQWNoaWV2ZW1lbnRFcnJvcgogICAgfSwKICAgIEFjaGlldmVtZW50c1VubG9ja2VkQWNoaWV2ZW1lbnRJRCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnQuaWQKICAgIH0sCiAgICBBY2hpZXZlbWVudHNVbmxvY2tlZEFjaGlldmVtZW50VGFnKCkgewogICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRBY2hpZXZlbWVudC50YWcKICAgIH0sCiAgICBBY2hpZXZlbWVudHNVbmxvY2tlZEFjaGlldmVtZW50TmFtZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnQubmFtZQogICAgfSwKICAgIEFjaGlldmVtZW50c1VubG9ja2VkQWNoaWV2ZW1lbnREZXNjcmlwdGlvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnQuZGVzY3JpcHRpb24KICAgIH0sCiAgICBBY2hpZXZlbWVudHNVbmxvY2tlZEFjaGlldmVtZW50SWNvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnQuaWNvbgogICAgfSwKICAgIEFjaGlldmVtZW50c1VubG9ja2VkQWNoaWV2ZW1lbnRJY29uU21hbGwoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudEFjaGlldmVtZW50Lmljb25TbWFsbAogICAgfSwKICAgIEFjaGlldmVtZW50c1VubG9ja2VkQWNoaWV2ZW1lbnRSYXJlKCkgewogICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRBY2hpZXZlbWVudC5yYXJlCiAgICB9LAogICAgQWNoaWV2ZW1lbnRzR2V0UHJvZ3Jlc3MoYSkgewogICAgICAgIHJldHVybiB0aGlzLmdwLmFjaGlldmVtZW50cy5nZXRQcm9ncmVzcyhhKQogICAgfSwKICAgIFNvY2lhbHNDb21tdW5pdHlMaW5rKCkgewogICAgICAgIHJldHVybiB0aGlzLmdwLnNvY2lhbHMuY29tbXVuaXR5TGluawogICAgfSwKICAgIFBheW1lbnRzQ3VyUHJvZHVjdEluZGV4KCkgewogICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRQcm9kdWN0SW5kZXgKICAgIH0sCiAgICBQYXltZW50c0N1clByb2R1Y3RJRCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50UHJvZHVjdC5pZAogICAgfSwKICAgIFBheW1lbnRzQ3VyUHJvZHVjdFRhZygpIHsKICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50UHJvZHVjdC50YWcKICAgIH0sCiAgICBQYXltZW50c0N1clByb2R1Y3ROYW1lKCkgewogICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRQcm9kdWN0Lm5hbWUKICAgIH0sCiAgICBQYXltZW50c0N1clByb2R1Y3REZXNjcmlwdGlvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50UHJvZHVjdC5kZXNjcmlwdGlvbgogICAgfSwKICAgIFBheW1lbnRzQ3VyUHJvZHVjdEljb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudFByb2R1Y3QuaWNvbgogICAgfSwKICAgIFBheW1lbnRzQ3VyUHJvZHVjdEljb25TbWFsbCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50UHJvZHVjdC5pY29uU21hbGwKICAgIH0sCiAgICBQYXltZW50c0N1clByb2R1Y3RQcmljZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50UHJvZHVjdC5wcmljZQogICAgfSwKICAgIFBheW1lbnRzQ3VyUHJvZHVjdEN1cnJlbmN5KCkgewogICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRQcm9kdWN0LmN1cnJlbmN5CiAgICB9LAogICAgUGF5bWVudHNDdXJQcm9kdWN0Q3VycmVuY3lTeW1ib2woKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudFByb2R1Y3QuY3VycmVuY3lTeW1ib2wKICAgIH0sCiAgICBQYXltZW50c0N1clByb2R1Y3RQdXJjaGFzZXMoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudFByb2R1Y3RQdXJjaGFzZXMKICAgIH0sCiAgICBQYXltZW50c0N1clB1cmNoYXNlSW5kZXgoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudFB1cmNoYXNlSW5kZXgKICAgIH0sCiAgICBQYXltZW50c0N1clB1cmNoYXNlSUQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudFB1cmNoYXNlLmlkIHx8IDAKICAgIH0sCiAgICBQYXltZW50c0N1clB1cmNoYXNlVGFnKCkgewogICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRQdXJjaGFzZS50YWcgfHwgIiIKICAgIH0sCiAgICBQYXltZW50c0N1clB1cmNoYXNlRGF0ZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50UHVyY2hhc2UuY3JlYXRlZEF0IHx8ICIiCiAgICB9LAogICAgUGF5bWVudHNDdXJQdXJjaGFzZUV4cGlyYXRpb25EYXRlKCkgewogICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRQdXJjaGFzZS5leHBpcmVkQXQgfHwgIiIKICAgIH0sCiAgICBQYXltZW50c0N1clB1cmNoYXNlU3Vic2NyaWJlZCgpIHsKICAgICAgICByZXR1cm4gTnVtYmVyKHRoaXMuY3VycmVudFB1cmNoYXNlLnN1YnNjcmliZWQgfHwKICAgICAgICAgICAgITEpIHx8IDAKICAgIH0sCiAgICBQYXltZW50c1B1cmNoYXNlZFByb2R1Y3RTdWNjZXNzKCkgewogICAgICAgIHJldHVybiB0aGlzLmlzUHVyY2hhc2VQcm9kdWN0U3VjY2VzcwogICAgfSwKICAgIFBheW1lbnRzUHVyY2hhc2VkUHJvZHVjdEVycm9yKCkgewogICAgICAgIHJldHVybiB0aGlzLnB1cmNoYXNlUHJvZHVjdEVycm9yCiAgICB9LAogICAgUGF5bWVudHNQdXJjaGFzZWRQcm9kdWN0SUQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMucHVyY2hhc2VkUHJvZHVjdElECiAgICB9LAogICAgUGF5bWVudHNQdXJjaGFzZWRQcm9kdWN0VGFnKCkgewogICAgICAgIHJldHVybiB0aGlzLnB1cmNoYXNlZFByb2R1Y3RUYWcKICAgIH0sCiAgICBQYXltZW50c0NvbnN1bWVkUHJvZHVjdFN1Y2Nlc3MoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuaXNDb25zdW1lUHJvZHVjdFN1Y2Nlc3MKICAgIH0sCiAgICBQYXltZW50c0NvbnN1bWVkUHJvZHVjdEVycm9yKCkgewogICAgICAgIHJldHVybiB0aGlzLmNvbnN1bWVQcm9kdWN0RXJyb3IKICAgIH0sCiAgICBQYXltZW50c0NvbnN1bWVkUHJvZHVjdElEKCkgewogICAgICAgIHJldHVybiB0aGlzLmNvbnN1bWVkUHJvZHVjdElECiAgICB9LAogICAgUGF5bWVudHNDb25zdW1lZFByb2R1Y3RUYWcoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY29uc3VtZWRQcm9kdWN0VGFnCiAgICB9LAogICAgUGF5bWVudHNQdXJjaGFzZURhdGUoYSkgewogICAgICAgIHJldHVybiAoYSA9IHRoaXMuZ3AucGF5bWVudHMuZ2V0UHVyY2hhc2UoYSkpICYmIGEuY3JlYXRlZEF0IHx8ICIiCiAgICB9LAogICAgUGF5bWVudHNFeHBpcmF0aW9uRGF0ZShhKSB7CiAgICAgICAgcmV0dXJuIChhID0gdGhpcy5ncC5wYXltZW50cy5nZXRQdXJjaGFzZShhKSkgJiYgYS5leHBpcmVkQXQgfHwgIiIKICAgIH0sCiAgICBJbWFnZXNDdXJJbWFnZUluZGV4KCkgewogICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRJbWFnZUluZGV4CiAgICB9LAogICAgSW1hZ2VzQ3VySW1hZ2VJRCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50SW1hZ2UuaWQgfHwgIiIKICAgIH0sCiAgICBJbWFnZXNDdXJJbWFnZVNyYygpIHsKICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50SW1hZ2Uuc3JjIHx8ICIiCiAgICB9LAogICAgSW1hZ2VzQ3VySW1hZ2VXaWR0aCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50SW1hZ2Uud2lkdGggfHwgMAogICAgfSwKICAgIEltYWdlc0N1ckltYWdlSGVpZ2h0KCkgewogICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRJbWFnZS5oZWlnaHQgfHwgMAogICAgfSwKICAgIEltYWdlc0N1ckltYWdlUGxheWVySUQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudEltYWdlLnBsYXllcklkIHx8CiAgICAgICAgICAgIDAKICAgIH0sCiAgICBJbWFnZXNDdXJJbWFnZVRhZ0luZGV4KCkgewogICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRJbWFnZVRhZ0luZGV4CiAgICB9LAogICAgSW1hZ2VzQ3VySW1hZ2VUYWcoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudEltYWdlVGFnIHx8ICIiCiAgICB9LAogICAgSW1hZ2VzVGVtcEZpbGVVcmwoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMubGFzdEltYWdlVGVtcFVybCB8fCAiIgogICAgfSwKICAgIEltYWdlc1Jlc2l6ZShhLCBiLCBkLCBjKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZ3AuaW1hZ2VzLnJlc2l6ZShhLCBiLCBkLCBjKQogICAgfSwKICAgIEZpbGVzQ3VyRmlsZUluZGV4KCkgewogICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRGaWxlSW5kZXgKICAgIH0sCiAgICBGaWxlc0N1ckZpbGVJRCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50RmlsZS5pZCB8fCAiIgogICAgfSwKICAgIEZpbGVzQ3VyRmlsZVNyYygpIHsKICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50RmlsZS5zcmMgfHwgIiIKICAgIH0sCiAgICBGaWxlc0N1ckZpbGVOYW1lKCkgewogICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRGaWxlLm5hbWUgfHwgIiIKICAgIH0sCiAgICBGaWxlc0N1ckZpbGVTaXplKCkgewogICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRGaWxlLnNpemUgfHwgMAogICAgfSwKICAgIEZpbGVzQ3VyRmlsZVBsYXllcklEKCkgewogICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRGaWxlLnBsYXllcklkIHx8CiAgICAgICAgICAgIDAKICAgIH0sCiAgICBGaWxlc0N1ckZpbGVUYWdJbmRleCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50RmlsZVRhZ0luZGV4CiAgICB9LAogICAgRmlsZXNDdXJGaWxlVGFnKCkgewogICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRGaWxlVGFnIHx8ICIiCiAgICB9LAogICAgRmlsZXNUZW1wRmlsZVVybCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5sYXN0RmlsZVRlbXBVcmwgfHwgIiIKICAgIH0sCiAgICBGaWxlc0xhc3RGaWxlQ29udGVudCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5sYXN0RmlsZUNvbnRlbnQgfHwgIiIKICAgIH0sCiAgICBHYW1lc0NvbGxlY3Rpb25zQ29sbGVjdGlvbklEKCkgewogICAgICAgIHJldHVybiB0aGlzLmdhbWVzQ29sbGVjdGlvbi5pZAogICAgfSwKICAgIEdhbWVzQ29sbGVjdGlvbnNDb2xsZWN0aW9uVGFnKCkgewogICAgICAgIHJldHVybiB0aGlzLmdhbWVzQ29sbGVjdGlvbi50YWcKICAgIH0sCiAgICBHYW1lc0NvbGxlY3Rpb25zQ29sbGVjdGlvbk5hbWUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZ2FtZXNDb2xsZWN0aW9uLm5hbWUKICAgIH0sCiAgICBHYW1lc0NvbGxlY3Rpb25zQ29sbGVjdGlvbkRlc2NyaXB0aW9uKCkgewogICAgICAgIHJldHVybiB0aGlzLmdhbWVzQ29sbGVjdGlvbi5kZXNjcmlwdGlvbgogICAgfSwKICAgIEdhbWVzQ29sbGVjdGlvbnNDdXJHYW1lSW5kZXgoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudEdhbWVJbmRleAogICAgfSwKICAgIEdhbWVzQ29sbGVjdGlvbnNDdXJHYW1lSUQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudEdhbWVJZAogICAgfSwKICAgIEdhbWVzQ29sbGVjdGlvbnNDdXJHYW1lVGFnKCkgewogICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRHYW1lVGFnCiAgICB9LAogICAgR2FtZXNDb2xsZWN0aW9uc0N1ckdhbWVOYW1lKCkgewogICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRHYW1lTmFtZQogICAgfSwKICAgIEdhbWVzQ29sbGVjdGlvbnNDdXJHYW1lRGVzY3JpcHRpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudEdhbWVEZXNjcmlwdGlvbgogICAgfSwKICAgIEdhbWVzQ29sbGVjdGlvbnNDdXJHYW1lSWNvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50R2FtZUljb24KICAgIH0sCiAgICBHYW1lc0NvbGxlY3Rpb25zQ3VyR2FtZVVybCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50R2FtZVVybAogICAgfSwKICAgIEdhbWVzQ29sbGVjdGlvbnNGZXRjaEVycm9yKCkgewogICAgICAgIHJldHVybiB0aGlzLmdhbWVzQ29sbGVjdGlvbkZldGNoRXJyb3IKICAgIH0sCiAgICBEb2N1bWVudHNEb2N1bWVudFR5cGUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZG9jdW1lbnQudHlwZQogICAgfSwKICAgIERvY3VtZW50c0RvY3VtZW50Q29udGVudCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5kb2N1bWVudC5jb250ZW50CiAgICB9LAogICAgRG9jdW1lbnRzRmV0Y2hFcnJvcigpIHsKICAgICAgICByZXR1cm4gdGhpcy5kb2N1bWVudEZldGNoRXJyb3IKICAgIH0sCiAgICBWYXJpYWJsZXNHZXQoYSkgewogICAgICAgIHJldHVybiB0aGlzLmdwLnZhcmlhYmxlcy5nZXQoYSkKICAgIH0sCiAgICBWYXJpYWJsZXNIYXMoYSkgewogICAgICAgIHJldHVybiBOdW1iZXIodGhpcy5ncC52YXJpYWJsZXMuaGFzKGEpKQogICAgfSwKICAgIFZhcmlhYmxlc1R5cGUoYSkgewogICAgICAgIHJldHVybiB0aGlzLmdwLnZhcmlhYmxlcy50eXBlKGEpCiAgICB9LAogICAgVmFyaWFibGVzQ3VySW5kZXgoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudFZhcmlhYmxlSW5kZXggfHwgMAogICAgfSwKICAgIFZhcmlhYmxlc0N1cktleSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50VmFyaWFibGUua2V5IHx8ICIiCiAgICB9LAogICAgVmFyaWFibGVzQ3VyVHlwZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50VmFyaWFibGUudHlwZSB8fCAiIgogICAgfSwKICAgIFZhcmlhYmxlc0N1clZhbHVlKCkgewogICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRWYXJpYWJsZS52YWx1ZSB8fCAiIgogICAgfSwKICAgIFBsYXllcnNDdXJQbGF5ZXJOYW1lKCkgewogICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRQbGF5ZXJzUGxheWVyLnN0YXRlLm5hbWUgfHwKICAgICAgICAgICAgIiIKICAgIH0sCiAgICBQbGF5ZXJzQ3VyUGxheWVyQXZhdGFyKCkgewogICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRQbGF5ZXJzUGxheWVyLnN0YXRlLmF2YXRhciB8fCAiIgogICAgfSwKICAgIFBsYXllcnNDdXJQbGF5ZXJJRCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50UGxheWVyc1BsYXllci5zdGF0ZS5pZCB8fCAwCiAgICB9LAogICAgUGxheWVyc0N1clBsYXllclNjb3JlKCkgewogICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRQbGF5ZXJzUGxheWVyLnN0YXRlLnNjb3JlIHx8IDAKICAgIH0sCiAgICBQbGF5ZXJzQ3VyUGxheWVySW5kZXgoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudFBsYXllcnNJbmRleCB8fCAwCiAgICB9LAogICAgUGxheWVyc0N1clBsYXllckZpZWxkKGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50UGxheWVyc1BsYXllciAmJiBhIGluIHRoaXMuY3VycmVudFBsYXllcnNQbGF5ZXIuc3RhdGUgPyB0aGlzLmN1cnJlbnRQbGF5ZXJzUGxheWVyLnN0YXRlW2FdIDogMAogICAgfSwKICAgIFBsYXllcnNQbGF5ZXJGaWVsZEF0KGEsIGIpIHsKICAgICAgICByZXR1cm4gKGEgPSB0aGlzLnBsYXllcnNMaXN0W2FdKSAmJiBiIGluIGEuc3RhdGUgPyBhLnN0YXRlW2JdIDogMAogICAgfSwKICAgIExhc3RQbGF5ZXJzVGFnKCkgewogICAgICAgIHJldHVybiB0aGlzLmxhc3RQbGF5ZXJzVGFnCiAgICB9LAogICAgTGFzdEVycm9yKCkgewogICAgICAgIHJldHVybiB0aGlzLmxhc3RFcnJvcgogICAgfSwKICAgIElzTGFzdEFjdGlvblN1Y2Nlc3MoKSB7CiAgICAgICAgcmV0dXJuIE51bWJlcih0aGlzLmlzTGFzdEFjdGlvblN1Y2Nlc3MpCiAgICB9LAogICAgQXNKU09OKCkgewogICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeSh0aGlzLlNhdmVUb0pzb24oKSkKICAgIH0KfTsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkMjIyID0gc2VsZi5DMzsKQzMkanNjb21wJDIyMi5QbHVnaW5zLktleWJvYXJkID0gY2xhc3MgZXh0ZW5kcyBDMyRqc2NvbXAkMjIyLlNES1BsdWdpbkJhc2UgewogICAgY29uc3RydWN0b3IoYSkgewogICAgICAgIHN1cGVyKGEpCiAgICB9CiAgICBSZWxlYXNlKCkgewogICAgICAgIHN1cGVyLlJlbGVhc2UoKQogICAgfQp9Owpjb25zdCBDMyRqc2NvbXAkMjIzID0gc2VsZi5DMzsKQzMkanNjb21wJDIyMy5QbHVnaW5zLktleWJvYXJkLlR5cGUgPSBjbGFzcyBleHRlbmRzIEMzJGpzY29tcCQyMjMuU0RLVHlwZUJhc2UgewogICAgY29uc3RydWN0b3IoYSkgewogICAgICAgIHN1cGVyKGEpCiAgICB9CiAgICBSZWxlYXNlKCkgewogICAgICAgIHN1cGVyLlJlbGVhc2UoKQogICAgfQogICAgT25DcmVhdGUoKSB7fQogICAgR2V0U2NyaXB0SW50ZXJmYWNlQ2xhc3MoKSB7CiAgICAgICAgcmV0dXJuIHNlbGYuSUtleWJvYXJkT2JqZWN0VHlwZQogICAgfQp9OwpsZXQga2V5Ym9hcmRPYmplY3RUeXBlID0gbnVsbDsKCmZ1bmN0aW9uIEdldEtleWJvYXJkU2RrSW5zdGFuY2UoKSB7CiAgICByZXR1cm4ga2V5Ym9hcmRPYmplY3RUeXBlLkdldFNpbmdsZUdsb2JhbEluc3RhbmNlKCkuR2V0U2RrSW5zdGFuY2UoKQp9CnNlbGYuSUtleWJvYXJkT2JqZWN0VHlwZSA9IGNsYXNzIGV4dGVuZHMgc2VsZi5JT2JqZWN0Q2xhc3MgewogICAgY29uc3RydWN0b3IoYSkgewogICAgICAgIHN1cGVyKGEpOwogICAgICAgIGtleWJvYXJkT2JqZWN0VHlwZSA9IGE7CiAgICAgICAgYS5HZXRSdW50aW1lKCkuX0dldENvbW1vblNjcmlwdEludGVyZmFjZXMoKS5rZXlib2FyZCA9IHRoaXMKICAgIH0KICAgIGlzS2V5RG93bihhKSB7CiAgICAgICAgY29uc3QgYiA9IEdldEtleWJvYXJkU2RrSW5zdGFuY2UoKTsKICAgICAgICBpZiAoInN0cmluZyIgPT09IHR5cGVvZiBhKSByZXR1cm4gYi5Jc0tleURvd24oYSk7CiAgICAgICAgaWYgKCJudW1iZXIiID09PSB0eXBlb2YgYSkgcmV0dXJuIGIuSXNLZXlDb2RlRG93bihhKTsKICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJleHBlY3RlZCBzdHJpbmcgb3IgbnVtYmVyIik7CiAgICB9Cn07CmNvbnN0IEMzJGpzY29tcCQyMjQgPSBzZWxmLkMzOwpDMyRqc2NvbXAkMjI0LlBsdWdpbnMuS2V5Ym9hcmQuSW5zdGFuY2UgPSBjbGFzcyBleHRlbmRzIEMzJGpzY29tcCQyMjQuU0RLSW5zdGFuY2VCYXNlIHsKICAgIGNvbnN0cnVjdG9yKGEsIGIpIHsKICAgICAgICBzdXBlcihhKTsKICAgICAgICB0aGlzLl9rZXlzRG93bkJ5U3RyaW5nID0gbmV3IFNldDsKICAgICAgICB0aGlzLl9rZXlzRG93bkJ5V2hpY2ggPSBuZXcgU2V0OwogICAgICAgIHRoaXMuX3RyaWdnZXJXaGljaCA9IDA7CiAgICAgICAgdGhpcy5fdHJpZ2dlclR5cGVkS2V5ID0gdGhpcy5fdHJpZ2dlclN0cmluZyA9ICIiOwogICAgICAgIGEgPSB0aGlzLkdldFJ1bnRpbWUoKS5EaXNwYXRjaGVyKCk7CiAgICAgICAgdGhpcy5fZGlzcG9zYWJsZXMgPSBuZXcgQzMkanNjb21wJDIyNC5Db21wb3NpdGVEaXNwb3NhYmxlKEMzJGpzY29tcCQyMjQuRGlzcG9zYWJsZS5Gcm9tKGEsICJrZXlkb3duIiwgZCA9PiB0aGlzLl9PbktleURvd24oZC5kYXRhKSksIEMzJGpzY29tcCQyMjQuRGlzcG9zYWJsZS5Gcm9tKGEsICJrZXl1cCIsIGQgPT4gdGhpcy5fT25LZXlVcChkLmRhdGEpKSwgQzMkanNjb21wJDIyNC5EaXNwb3NhYmxlLkZyb20oYSwgIndpbmRvdy1ibHVyIiwKICAgICAgICAgICAgKCkgPT4gdGhpcy5fT25XaW5kb3dPcktleWJvYXJkQmx1cigpKSwgQzMkanNjb21wJDIyNC5EaXNwb3NhYmxlLkZyb20oYSwgImtleWJvYXJkLWJsdXIiLCAoKSA9PiB0aGlzLl9PbldpbmRvd09yS2V5Ym9hcmRCbHVyKCkpKQogICAgfQogICAgUmVsZWFzZSgpIHsKICAgICAgICBzdXBlci5SZWxlYXNlKCkKICAgIH0KICAgIF9PbktleURvd24oYSkgewogICAgICAgIGNvbnN0IGIgPSBhLndoaWNoLAogICAgICAgICAgICBkID0gYS5jb2RlIHx8IGIudG9TdHJpbmcoKTsKICAgICAgICBhID0gYS5rZXk7CiAgICAgICAgdGhpcy5fa2V5c0Rvd25CeVN0cmluZy5oYXMoZCkgfHwgKHRoaXMuX2tleXNEb3duQnlTdHJpbmcuYWRkKGQpLCB0aGlzLl9rZXlzRG93bkJ5V2hpY2guYWRkKGIpLCB0aGlzLl90cmlnZ2VyU3RyaW5nID0gZCwgdGhpcy5fdHJpZ2dlcldoaWNoID0gYiwgdGhpcy5fdHJpZ2dlclR5cGVkS2V5ID0gYSwgdGhpcy5UcmlnZ2VyKEMzJGpzY29tcCQyMjQuUGx1Z2lucy5LZXlib2FyZC5DbmRzLk9uQW55S2V5KSwgdGhpcy5UcmlnZ2VyKEMzJGpzY29tcCQyMjQuUGx1Z2lucy5LZXlib2FyZC5DbmRzLk9uS2V5KSwgdGhpcy5UcmlnZ2VyKEMzJGpzY29tcCQyMjQuUGx1Z2lucy5LZXlib2FyZC5DbmRzLk9uTGVmdFJpZ2h0S2V5UHJlc3NlZCksCiAgICAgICAgICAgIHRoaXMuVHJpZ2dlcihDMyRqc2NvbXAkMjI0LlBsdWdpbnMuS2V5Ym9hcmQuQ25kcy5PbktleUNvZGUpKQogICAgfQogICAgX09uS2V5VXAoYSkgewogICAgICAgIGNvbnN0IGIgPSBhLndoaWNoLAogICAgICAgICAgICBkID0gYS5jb2RlIHx8IGIudG9TdHJpbmcoKTsKICAgICAgICBhID0gYS5rZXk7CiAgICAgICAgdGhpcy5fa2V5c0Rvd25CeVN0cmluZy5kZWxldGUoZCk7CiAgICAgICAgdGhpcy5fa2V5c0Rvd25CeVdoaWNoLmRlbGV0ZShiKTsKICAgICAgICB0aGlzLl90cmlnZ2VyU3RyaW5nID0gZDsKICAgICAgICB0aGlzLl90cmlnZ2VyV2hpY2ggPSBiOwogICAgICAgIHRoaXMuX3RyaWdnZXJUeXBlZEtleSA9IGE7CiAgICAgICAgdGhpcy5UcmlnZ2VyKEMzJGpzY29tcCQyMjQuUGx1Z2lucy5LZXlib2FyZC5DbmRzLk9uQW55S2V5UmVsZWFzZWQpOwogICAgICAgIHRoaXMuVHJpZ2dlcihDMyRqc2NvbXAkMjI0LlBsdWdpbnMuS2V5Ym9hcmQuQ25kcy5PbktleVJlbGVhc2VkKTsKICAgICAgICB0aGlzLlRyaWdnZXIoQzMkanNjb21wJDIyNC5QbHVnaW5zLktleWJvYXJkLkNuZHMuT25MZWZ0UmlnaHRLZXlSZWxlYXNlZCk7CiAgICAgICAgdGhpcy5UcmlnZ2VyKEMzJGpzY29tcCQyMjQuUGx1Z2lucy5LZXlib2FyZC5DbmRzLk9uS2V5Q29kZVJlbGVhc2VkKQogICAgfQogICAgX09uV2luZG93T3JLZXlib2FyZEJsdXIoKSB7CiAgICAgICAgZm9yIChjb25zdCBhIG9mIHRoaXMuX2tleXNEb3duQnlXaGljaCkgdGhpcy5fa2V5c0Rvd25CeVdoaWNoLmRlbGV0ZShhKSwKICAgICAgICAgICAgdGhpcy5fdHJpZ2dlcldoaWNoID0gYSwgdGhpcy5UcmlnZ2VyKEMzJGpzY29tcCQyMjQuUGx1Z2lucy5LZXlib2FyZC5DbmRzLk9uQW55S2V5UmVsZWFzZWQpLCB0aGlzLlRyaWdnZXIoQzMkanNjb21wJDIyNC5QbHVnaW5zLktleWJvYXJkLkNuZHMuT25LZXlSZWxlYXNlZCksIHRoaXMuVHJpZ2dlcihDMyRqc2NvbXAkMjI0LlBsdWdpbnMuS2V5Ym9hcmQuQ25kcy5PbktleUNvZGVSZWxlYXNlZCk7CiAgICAgICAgdGhpcy5fa2V5c0Rvd25CeVN0cmluZy5jbGVhcigpCiAgICB9CiAgICBJc0tleURvd24oYSkgewogICAgICAgIHJldHVybiB0aGlzLl9rZXlzRG93bkJ5U3RyaW5nLmhhcyhhKQogICAgfQogICAgSXNLZXlDb2RlRG93bihhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2tleXNEb3duQnlXaGljaC5oYXMoYSkKICAgIH0KICAgIFNhdmVUb0pzb24oKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgdGs6IHRoaXMuX3RyaWdnZXJXaGljaCwKICAgICAgICAgICAgdGtrOiB0aGlzLl90cmlnZ2VyVHlwZWRLZXkKICAgICAgICB9CiAgICB9CiAgICBMb2FkRnJvbUpzb24oYSkgewogICAgICAgIHRoaXMuX3RyaWdnZXJXaGljaCA9IGEudGs7CiAgICAgICAgYS5oYXNPd25Qcm9wZXJ0eSgidGtrIikgJiYgKHRoaXMuX3RyaWdnZXJUeXBlZEtleSA9CiAgICAgICAgICAgIGEudGtrKQogICAgfQogICAgR2V0RGVidWdnZXJQcm9wZXJ0aWVzKCkgewogICAgICAgIHJldHVybiBbewogICAgICAgICAgICB0aXRsZTogInBsdWdpbnMua2V5Ym9hcmQubmFtZSIsCiAgICAgICAgICAgIHByb3BlcnRpZXM6IFt7CiAgICAgICAgICAgICAgICBuYW1lOiAicGx1Z2lucy5rZXlib2FyZC5kZWJ1Z2dlci5sYXN0LWtleS1jb2RlIiwKICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLl90cmlnZ2VyV2hpY2gKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgbmFtZTogInBsdWdpbnMua2V5Ym9hcmQuZGVidWdnZXIubGFzdC1rZXktc3RyaW5nIiwKICAgICAgICAgICAgICAgIHZhbHVlOiBDMyRqc2NvbXAkMjI0LlBsdWdpbnMuS2V5Ym9hcmQuRXhwcy5TdHJpbmdGcm9tS2V5Q29kZSh0aGlzLl90cmlnZ2VyV2hpY2gpCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgIG5hbWU6ICJwbHVnaW5zLmtleWJvYXJkLmRlYnVnZ2VyLmxhc3QtdHlwZWQta2V5IiwKICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLl90cmlnZ2VyVHlwZWRLZXkKICAgICAgICAgICAgfV0KICAgICAgICB9XQogICAgfQp9Owpjb25zdCBMRUZUUklHSFRfS0VZX1NUUklOR1MgPSAiU2hpZnRMZWZ0IFNoaWZ0UmlnaHQgQ29udHJvbExlZnQgQ29udHJvbFJpZ2h0IEFsdExlZnQgQWx0UmlnaHQgTWV0YUxlZnQgTWV0YVJpZ2h0Ii5zcGxpdCgiICIpOwpzZWxmLkMzLlBsdWdpbnMuS2V5Ym9hcmQuQ25kcyA9IHsKICAgIElzS2V5RG93bihhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2tleXNEb3duQnlXaGljaC5oYXMoYSkKICAgIH0sCiAgICBPbktleShhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3RyaWdnZXJXaGljaCA9PT0gYQogICAgfSwKICAgIE9uQW55S2V5KCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIE9uQW55S2V5UmVsZWFzZWQoKSB7CiAgICAgICAgcmV0dXJuICEwCiAgICB9LAogICAgT25LZXlSZWxlYXNlZChhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3RyaWdnZXJXaGljaCA9PT0gYQogICAgfSwKICAgIElzS2V5Q29kZURvd24oYSkgewogICAgICAgIGEgPSBNYXRoLmZsb29yKGEpOwogICAgICAgIHJldHVybiB0aGlzLl9rZXlzRG93bkJ5V2hpY2guaGFzKGEpCiAgICB9LAogICAgT25LZXlDb2RlKGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdHJpZ2dlcldoaWNoID09PSBhCiAgICB9LAogICAgT25LZXlDb2RlUmVsZWFzZWQoYSkgewogICAgICAgIHJldHVybiB0aGlzLl90cmlnZ2VyV2hpY2ggPT09IGEKICAgIH0sCiAgICBPbkxlZnRSaWdodEtleVByZXNzZWQoYSkgewogICAgICAgIHJldHVybiB0aGlzLl90cmlnZ2VyU3RyaW5nID09PSBMRUZUUklHSFRfS0VZX1NUUklOR1NbYV0KICAgIH0sCiAgICBPbkxlZnRSaWdodEtleVJlbGVhc2VkKGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdHJpZ2dlclN0cmluZyA9PT0KICAgICAgICAgICAgTEVGVFJJR0hUX0tFWV9TVFJJTkdTW2FdCiAgICB9LAogICAgSXNMZWZ0UmlnaHRLZXlEb3duKGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5fa2V5c0Rvd25CeVN0cmluZy5oYXMoTEVGVFJJR0hUX0tFWV9TVFJJTkdTW2FdKQogICAgfQp9OwpzZWxmLkMzLlBsdWdpbnMuS2V5Ym9hcmQuQWN0cyA9IHt9OwoKZnVuY3Rpb24gU3RyaW5nRnJvbUNoYXJDb2RlKGEpIHsKICAgIGEgPSBNYXRoLmZsb29yKGEpOwogICAgc3dpdGNoIChhKSB7CiAgICAgICAgY2FzZSA4OgogICAgICAgICAgICByZXR1cm4gImJhY2tzcGFjZSI7CiAgICAgICAgY2FzZSA5OgogICAgICAgICAgICByZXR1cm4gInRhYiI7CiAgICAgICAgY2FzZSAxMzoKICAgICAgICAgICAgcmV0dXJuICJlbnRlciI7CiAgICAgICAgY2FzZSAxNjoKICAgICAgICAgICAgcmV0dXJuICJzaGlmdCI7CiAgICAgICAgY2FzZSAxNzoKICAgICAgICAgICAgcmV0dXJuICJjb250cm9sIjsKICAgICAgICBjYXNlIDE4OgogICAgICAgICAgICByZXR1cm4gImFsdCI7CiAgICAgICAgY2FzZSAxOToKICAgICAgICAgICAgcmV0dXJuICJwYXVzZSI7CiAgICAgICAgY2FzZSAyMDoKICAgICAgICAgICAgcmV0dXJuICJjYXBzbG9jayI7CiAgICAgICAgY2FzZSAyNzoKICAgICAgICAgICAgcmV0dXJuICJlc2MiOwogICAgICAgIGNhc2UgMzM6CiAgICAgICAgICAgIHJldHVybiAicGFnZXVwIjsKICAgICAgICBjYXNlIDM0OgogICAgICAgICAgICByZXR1cm4gInBhZ2Vkb3duIjsKICAgICAgICBjYXNlIDM1OgogICAgICAgICAgICByZXR1cm4gImVuZCI7CiAgICAgICAgY2FzZSAzNjoKICAgICAgICAgICAgcmV0dXJuICJob21lIjsKICAgICAgICBjYXNlIDM3OgogICAgICAgICAgICByZXR1cm4gIlx1MjE5MCI7CiAgICAgICAgY2FzZSAzODoKICAgICAgICAgICAgcmV0dXJuICJcdTIxOTEiOwogICAgICAgIGNhc2UgMzk6CiAgICAgICAgICAgIHJldHVybiAiXHUyMTkyIjsKICAgICAgICBjYXNlIDQwOgogICAgICAgICAgICByZXR1cm4gIlx1MjE5MyI7CiAgICAgICAgY2FzZSA0NToKICAgICAgICAgICAgcmV0dXJuICJpbnNlcnQiOwogICAgICAgIGNhc2UgNDY6CiAgICAgICAgICAgIHJldHVybiAiZGVsIjsKICAgICAgICBjYXNlIDkxOgogICAgICAgICAgICByZXR1cm4gImxlZnQgd2luZG93IGtleSI7CiAgICAgICAgY2FzZSA5MjoKICAgICAgICAgICAgcmV0dXJuICJyaWdodCB3aW5kb3cga2V5IjsKICAgICAgICBjYXNlIDkzOgogICAgICAgICAgICByZXR1cm4gInNlbGVjdCI7CiAgICAgICAgY2FzZSA5NjoKICAgICAgICAgICAgcmV0dXJuICJudW1wYWQgMCI7CiAgICAgICAgY2FzZSA5NzoKICAgICAgICAgICAgcmV0dXJuICJudW1wYWQgMSI7CiAgICAgICAgY2FzZSA5ODoKICAgICAgICAgICAgcmV0dXJuICJudW1wYWQgMiI7CiAgICAgICAgY2FzZSA5OToKICAgICAgICAgICAgcmV0dXJuICJudW1wYWQgMyI7CiAgICAgICAgY2FzZSAxMDA6CiAgICAgICAgICAgIHJldHVybiAibnVtcGFkIDQiOwogICAgICAgIGNhc2UgMTAxOgogICAgICAgICAgICByZXR1cm4gIm51bXBhZCA1IjsKICAgICAgICBjYXNlIDEwMjoKICAgICAgICAgICAgcmV0dXJuICJudW1wYWQgNiI7CiAgICAgICAgY2FzZSAxMDM6CiAgICAgICAgICAgIHJldHVybiAibnVtcGFkIDciOwogICAgICAgIGNhc2UgMTA0OgogICAgICAgICAgICByZXR1cm4gIm51bXBhZCA4IjsKICAgICAgICBjYXNlIDEwNToKICAgICAgICAgICAgcmV0dXJuICJudW1wYWQgOSI7CiAgICAgICAgY2FzZSAxMDY6CiAgICAgICAgICAgIHJldHVybiAibnVtcGFkICoiOwogICAgICAgIGNhc2UgMTA3OgogICAgICAgICAgICByZXR1cm4gIm51bXBhZCArIjsKICAgICAgICBjYXNlIDEwOToKICAgICAgICAgICAgcmV0dXJuICJudW1wYWQgLSI7CiAgICAgICAgY2FzZSAxMTA6CiAgICAgICAgICAgIHJldHVybiAibnVtcGFkIC4iOwogICAgICAgIGNhc2UgMTExOgogICAgICAgICAgICByZXR1cm4gIm51bXBhZCAvIjsKICAgICAgICBjYXNlIDExMjoKICAgICAgICAgICAgcmV0dXJuICJGMSI7CiAgICAgICAgY2FzZSAxMTM6CiAgICAgICAgICAgIHJldHVybiAiRjIiOwogICAgICAgIGNhc2UgMTE0OgogICAgICAgICAgICByZXR1cm4gIkYzIjsKICAgICAgICBjYXNlIDExNToKICAgICAgICAgICAgcmV0dXJuICJGNCI7CiAgICAgICAgY2FzZSAxMTY6CiAgICAgICAgICAgIHJldHVybiAiRjUiOwogICAgICAgIGNhc2UgMTE3OgogICAgICAgICAgICByZXR1cm4gIkY2IjsKICAgICAgICBjYXNlIDExODoKICAgICAgICAgICAgcmV0dXJuICJGNyI7CiAgICAgICAgY2FzZSAxMTk6CiAgICAgICAgICAgIHJldHVybiAiRjgiOwogICAgICAgIGNhc2UgMTIwOgogICAgICAgICAgICByZXR1cm4gIkY5IjsKICAgICAgICBjYXNlIDEyMToKICAgICAgICAgICAgcmV0dXJuICJGMTAiOwogICAgICAgIGNhc2UgMTIyOgogICAgICAgICAgICByZXR1cm4gIkYxMSI7CiAgICAgICAgY2FzZSAxMjM6CiAgICAgICAgICAgIHJldHVybiAiRjEyIjsKICAgICAgICBjYXNlIDE0NDoKICAgICAgICAgICAgcmV0dXJuICJudW1sb2NrIjsKICAgICAgICBjYXNlIDE0NToKICAgICAgICAgICAgcmV0dXJuICJzY3JvbGwgbG9jayI7CiAgICAgICAgY2FzZSAxODY6CiAgICAgICAgICAgIHJldHVybiAiOyI7CiAgICAgICAgY2FzZSAxODc6CiAgICAgICAgICAgIHJldHVybiAiPSI7CiAgICAgICAgY2FzZSAxODg6CiAgICAgICAgICAgIHJldHVybiAiLCI7CiAgICAgICAgY2FzZSAxODk6CiAgICAgICAgICAgIHJldHVybiAiLSI7CiAgICAgICAgY2FzZSAxOTA6CiAgICAgICAgICAgIHJldHVybiAiLiI7CiAgICAgICAgY2FzZSAxOTE6CiAgICAgICAgICAgIHJldHVybiAiLyI7CiAgICAgICAgY2FzZSAxOTI6CiAgICAgICAgICAgIHJldHVybiAiJyI7CiAgICAgICAgY2FzZSAyMTk6CiAgICAgICAgICAgIHJldHVybiAiWyI7CiAgICAgICAgY2FzZSAyMjA6CiAgICAgICAgICAgIHJldHVybiAiXFwiOwogICAgICAgIGNhc2UgMjIxOgogICAgICAgICAgICByZXR1cm4gIl0iOwogICAgICAgIGNhc2UgMjIyOgogICAgICAgICAgICByZXR1cm4gIiMiOwogICAgICAgIGNhc2UgMjIzOgogICAgICAgICAgICByZXR1cm4gImAiOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKGEpCiAgICB9Cn0Kc2VsZi5DMy5QbHVnaW5zLktleWJvYXJkLkV4cHMgPSB7CiAgICBMYXN0S2V5Q29kZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdHJpZ2dlcldoaWNoCiAgICB9LAogICAgU3RyaW5nRnJvbUtleUNvZGUoYSkgewogICAgICAgIHJldHVybiBTdHJpbmdGcm9tQ2hhckNvZGUoYSkKICAgIH0sCiAgICBUeXBlZEtleSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdHJpZ2dlclR5cGVkS2V5CiAgICB9Cn07CiJ1c2Ugc3RyaWN0IjsKY29uc3QgQzMkanNjb21wJDIyOCA9IHNlbGYuQzM7CkMzJGpzY29tcCQyMjguUGx1Z2lucy5Mb2NhbFN0b3JhZ2UgPSBjbGFzcyBleHRlbmRzIEMzJGpzY29tcCQyMjguU0RLUGx1Z2luQmFzZSB7CiAgICBjb25zdHJ1Y3RvcihhKSB7CiAgICAgICAgc3VwZXIoYSkKICAgIH0KICAgIFJlbGVhc2UoKSB7CiAgICAgICAgc3VwZXIuUmVsZWFzZSgpCiAgICB9Cn07CmNvbnN0IEMzJGpzY29tcCQyMjkgPSBzZWxmLkMzOwpDMyRqc2NvbXAkMjI5LlBsdWdpbnMuTG9jYWxTdG9yYWdlLlR5cGUgPSBjbGFzcyBleHRlbmRzIEMzJGpzY29tcCQyMjkuU0RLVHlwZUJhc2UgewogICAgY29uc3RydWN0b3IoYSkgewogICAgICAgIHN1cGVyKGEpCiAgICB9CiAgICBSZWxlYXNlKCkgewogICAgICAgIHN1cGVyLlJlbGVhc2UoKQogICAgfQogICAgT25DcmVhdGUoKSB7fQp9Owpjb25zdCBDMyRqc2NvbXAkMjMwID0gc2VsZi5DMzsKQzMkanNjb21wJDIzMC5QbHVnaW5zLkxvY2FsU3RvcmFnZS5JbnN0YW5jZSA9IGNsYXNzIGV4dGVuZHMgQzMkanNjb21wJDIzMC5TREtJbnN0YW5jZUJhc2UgewogICAgY29uc3RydWN0b3IoYSwgYikgewogICAgICAgIHN1cGVyKGEpOwogICAgICAgIHRoaXMuX2xhc3RWYWx1ZSA9IHRoaXMuX2N1cnJlbnRLZXkgPSAiIjsKICAgICAgICB0aGlzLl9rZXlOYW1lc0xpc3QgPSBbXTsKICAgICAgICB0aGlzLl9lcnJvck1lc3NhZ2UgPSAiIjsKICAgICAgICB0aGlzLl9wZW5kaW5nU2V0cyA9IHRoaXMuX3BlbmRpbmdHZXRzID0gMDsKICAgICAgICB0aGlzLl9zdG9yYWdlID0gdGhpcy5fcnVudGltZS5fR2V0UHJvamVjdFN0b3JhZ2UoKTsKICAgICAgICB0aGlzLl9kZWJ1Z0NhY2hlID0gbmV3IE1hcDsKICAgICAgICB0aGlzLl9pc0xvYWRpbmdEZWJ1Z0NhY2hlID0gITEKICAgIH0KICAgIFJlbGVhc2UoKSB7CiAgICAgICAgc3VwZXIuUmVsZWFzZSgpCiAgICB9CiAgICBhc3luYyBfVHJpZ2dlclN0b3JhZ2VFcnJvcihhKSB7CiAgICAgICAgdGhpcy5fZXJyb3JNZXNzYWdlID0gdGhpcy5fR2V0RXJyb3JTdHJpbmcoYSk7CiAgICAgICAgYXdhaXQgdGhpcy5UcmlnZ2VyQXN5bmMoQzMkanNjb21wJDIzMC5QbHVnaW5zLkxvY2FsU3RvcmFnZS5DbmRzLk9uRXJyb3IpCiAgICB9CiAgICBfR2V0RXJyb3JTdHJpbmcoYSkgewogICAgICAgIHJldHVybiBhID8gInN0cmluZyIgPT09CiAgICAgICAgICAgIHR5cGVvZiBhID8gYSA6ICJzdHJpbmciID09PSB0eXBlb2YgYS5tZXNzYWdlID8gYS5tZXNzYWdlIDogInN0cmluZyIgPT09IHR5cGVvZiBhLm5hbWUgPyBhLm5hbWUgOiAic3RyaW5nIiA9PT0gdHlwZW9mIGEuZGF0YSA/IGEuZGF0YSA6ICJ1bmtub3duIGVycm9yIiA6ICJ1bmtub3duIGVycm9yIgogICAgfQogICAgR2V0RGVidWdnZXJQcm9wZXJ0aWVzKCkgewogICAgICAgIHRoaXMuX2lzTG9hZGluZ0RlYnVnQ2FjaGUgfHwgdGhpcy5fRGVidWdDYWNoZVN0b3JhZ2UoKTsKICAgICAgICByZXR1cm4gW3sKICAgICAgICAgICAgdGl0bGU6ICJwbHVnaW5zLmxvY2Fsc3RvcmFnZS5uYW1lIiwKICAgICAgICAgICAgcHJvcGVydGllczogWy4uLnRoaXMuX2RlYnVnQ2FjaGUuZW50cmllcygpXS5tYXAoYSA9PiAoewogICAgICAgICAgICAgICAgbmFtZTogIiQiICsgYVswXSwKICAgICAgICAgICAgICAgIHZhbHVlOiBhWzFdLAogICAgICAgICAgICAgICAgb25lZGl0OiBiID0+IHRoaXMuX3N0b3JhZ2Uuc2V0SXRlbShhWzBdLCBiKQogICAgICAgICAgICB9KSkKICAgICAgICB9XQogICAgfQogICAgYXN5bmMgX0RlYnVnQ2FjaGVTdG9yYWdlKCkgewogICAgICAgIHRoaXMuX2lzTG9hZGluZ0RlYnVnQ2FjaGUgPSAhMDsKICAgICAgICB0cnkgewogICAgICAgICAgICBjb25zdCBhID0gYXdhaXQgdGhpcy5fc3RvcmFnZS5rZXlzKCk7CiAgICAgICAgICAgIGEuc29ydCgoZCwgYykgPT4gewogICAgICAgICAgICAgICAgZCA9IGQudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgICAgIGMgPSBjLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gZCA8IGMgPyAtMSA6IGMgPCBkID8gMSA6IDAKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGNvbnN0IGIgPSBhd2FpdCBQcm9taXNlLmFsbChhLm1hcChkID0+IHRoaXMuX3N0b3JhZ2UuZ2V0SXRlbShkKSkpOwogICAgICAgICAgICB0aGlzLl9kZWJ1Z0NhY2hlLmNsZWFyKCk7CiAgICAgICAgICAgIGZvciAobGV0IGQgPSAwLCBjID0gYS5sZW5ndGg7IGQgPCBjOyArK2QpIHRoaXMuX2RlYnVnQ2FjaGUuc2V0KGFbZF0sIGJbZF0pCiAgICAgICAgfSBjYXRjaCAoYSkgewogICAgICAgICAgICBjb25zb2xlLndhcm4oIltDMyBkZWJ1Z2dlcl0gRXJyb3IgZGlzcGxheWluZyBsb2NhbCBzdG9yYWdlOiAiLCBhKQogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHRoaXMuX2lzTG9hZGluZ0RlYnVnQ2FjaGUgPSAhMQogICAgICAgIH0KICAgIH0KfTsKY29uc3QgQzMkanNjb21wJDIzMSA9IHNlbGYuQzM7CkMzJGpzY29tcCQyMzEuUGx1Z2lucy5Mb2NhbFN0b3JhZ2UuQ25kcyA9IHsKICAgIE9uSXRlbVNldChhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2N1cnJlbnRLZXkgPT09IGEKICAgIH0sCiAgICBPbkFueUl0ZW1TZXQoKSB7CiAgICAgICAgcmV0dXJuICEwCiAgICB9LAogICAgT25JdGVtR2V0KGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5fY3VycmVudEtleSA9PT0gYQogICAgfSwKICAgIE9uQW55SXRlbUdldCgpIHsKICAgICAgICByZXR1cm4gITAKICAgIH0sCiAgICBPbkl0ZW1SZW1vdmVkKGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5fY3VycmVudEtleSA9PT0gYQogICAgfSwKICAgIE9uQW55SXRlbVJlbW92ZWQoKSB7CiAgICAgICAgcmV0dXJuICEwCiAgICB9LAogICAgT25DbGVhcmVkKCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIE9uQWxsS2V5TmFtZXNMb2FkZWQoKSB7CiAgICAgICAgcmV0dXJuICEwCiAgICB9LAogICAgT25FcnJvcigpIHsKICAgICAgICByZXR1cm4gITAKICAgIH0sCiAgICBPbkl0ZW1FeGlzdHMoYSkgewogICAgICAgIHJldHVybiB0aGlzLl9jdXJyZW50S2V5ID09PSBhCiAgICB9LAogICAgT25JdGVtTWlzc2luZyhhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2N1cnJlbnRLZXkgPT09IGEKICAgIH0sCiAgICBDb21wYXJlS2V5KGEsIGIpIHsKICAgICAgICByZXR1cm4gQzMkanNjb21wJDIzMS5jb21wYXJlKHRoaXMuX2N1cnJlbnRLZXksIGEsIGIpCiAgICB9LAogICAgQ29tcGFyZVZhbHVlKGEsIGIpIHsKICAgICAgICByZXR1cm4gQzMkanNjb21wJDIzMS5jb21wYXJlKHRoaXMuX2xhc3RWYWx1ZSwKICAgICAgICAgICAgYSwgYikKICAgIH0sCiAgICBJc1Byb2Nlc3NpbmdTZXRzKCkgewogICAgICAgIHJldHVybiAwIDwgdGhpcy5fcGVuZGluZ1NldHMKICAgIH0sCiAgICBJc1Byb2Nlc3NpbmdHZXRzKCkgewogICAgICAgIHJldHVybiAwIDwgdGhpcy5fcGVuZGluZ0dldHMKICAgIH0sCiAgICBPbkFsbFNldHNDb21wbGV0ZSgpIHsKICAgICAgICByZXR1cm4gITAKICAgIH0sCiAgICBPbkFsbEdldHNDb21wbGV0ZSgpIHsKICAgICAgICByZXR1cm4gITAKICAgIH0KfTsKY29uc3QgQzMkanNjb21wJDIzMiA9IHNlbGYuQzM7CgpmdW5jdGlvbiBJc0V4cHJlc3Npb25UeXBlKGEpIHsKICAgIHJldHVybiAic3RyaW5nIiA9PT0gdHlwZW9mIGEgfHwgIm51bWJlciIgPT09IHR5cGVvZiBhCn0KQzMkanNjb21wJDIzMi5QbHVnaW5zLkxvY2FsU3RvcmFnZS5BY3RzID0gewogICAgYXN5bmMgU2V0SXRlbShhLCBiKSB7CiAgICAgICAgdGhpcy5fcGVuZGluZ1NldHMrKzsKICAgICAgICB0cnkgewogICAgICAgICAgICBjb25zdCBkID0gYXdhaXQgdGhpcy5fc3RvcmFnZS5zZXRJdGVtKGEsIGIpOwogICAgICAgICAgICBhd2FpdCB0aGlzLlNjaGVkdWxlVHJpZ2dlcnMoYXN5bmMgKCkgPT4gewogICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudEtleSA9IGE7CiAgICAgICAgICAgICAgICB0aGlzLl9sYXN0VmFsdWUgPSBkOwogICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5UcmlnZ2VyQXN5bmMoQzMkanNjb21wJDIzMi5QbHVnaW5zLkxvY2FsU3RvcmFnZS5DbmRzLk9uQW55SXRlbVNldCk7CiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLlRyaWdnZXJBc3luYyhDMyRqc2NvbXAkMjMyLlBsdWdpbnMuTG9jYWxTdG9yYWdlLkNuZHMuT25JdGVtU2V0KQogICAgICAgICAgICB9KQogICAgICAgIH0gY2F0Y2ggKGQpIHsKICAgICAgICAgICAgYXdhaXQgdGhpcy5fVHJpZ2dlclN0b3JhZ2VFcnJvcihkKQogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHRoaXMuX3BlbmRpbmdTZXRzLS0sIDAgPT09IHRoaXMuX3BlbmRpbmdTZXRzICYmIGF3YWl0IHRoaXMuVHJpZ2dlckFzeW5jKEMzJGpzY29tcCQyMzIuUGx1Z2lucy5Mb2NhbFN0b3JhZ2UuQ25kcy5PbkFsbFNldHNDb21wbGV0ZSkKICAgICAgICB9CiAgICB9LAogICAgYXN5bmMgU2V0QmluYXJ5SXRlbShhLCBiKSB7CiAgICAgICAgaWYgKGIgJiYgKGIgPSBiLkdldEZpcnN0UGlja2VkKHRoaXMuX2luc3QpKSAmJiAoYiA9IGIuR2V0U2RrSW5zdGFuY2UoKSkpIHsKICAgICAgICAgICAgYiA9IGIuR2V0QXJyYXlCdWZmZXJSZWFkT25seSgpOwogICAgICAgICAgICB0aGlzLl9wZW5kaW5nU2V0cysrOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5fc3RvcmFnZS5zZXRJdGVtKGEsIGIpLCBhd2FpdCB0aGlzLlNjaGVkdWxlVHJpZ2dlcnMoYXN5bmMgKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRLZXkgPSBhOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2xhc3RWYWx1ZSA9ICIiOwogICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuVHJpZ2dlckFzeW5jKEMzJGpzY29tcCQyMzIuUGx1Z2lucy5Mb2NhbFN0b3JhZ2UuQ25kcy5PbkFueUl0ZW1TZXQpOwogICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuVHJpZ2dlckFzeW5jKEMzJGpzY29tcCQyMzIuUGx1Z2lucy5Mb2NhbFN0b3JhZ2UuQ25kcy5Pbkl0ZW1TZXQpCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9IGNhdGNoIChkKSB7CiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLl9UcmlnZ2VyU3RvcmFnZUVycm9yKGQpCiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICB0aGlzLl9wZW5kaW5nU2V0cy0tLCAwID09PSB0aGlzLl9wZW5kaW5nU2V0cyAmJgogICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuVHJpZ2dlckFzeW5jKEMzJGpzY29tcCQyMzIuUGx1Z2lucy5Mb2NhbFN0b3JhZ2UuQ25kcy5PbkFsbFNldHNDb21wbGV0ZSkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0sCiAgICBhc3luYyBHZXRJdGVtKGEpIHsKICAgICAgICB0aGlzLl9wZW5kaW5nR2V0cysrOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGNvbnN0IGIgPSBhd2FpdCB0aGlzLl9zdG9yYWdlLmdldEl0ZW0oYSk7CiAgICAgICAgICAgIGF3YWl0IHRoaXMuU2NoZWR1bGVUcmlnZ2Vycyhhc3luYyAoKSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50S2V5ID0gYTsKICAgICAgICAgICAgICAgIHRoaXMuX2xhc3RWYWx1ZSA9IElzRXhwcmVzc2lvblR5cGUoYikgPyBiIDogIiI7CiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLlRyaWdnZXJBc3luYyhDMyRqc2NvbXAkMjMyLlBsdWdpbnMuTG9jYWxTdG9yYWdlLkNuZHMuT25BbnlJdGVtR2V0KTsKICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuVHJpZ2dlckFzeW5jKEMzJGpzY29tcCQyMzIuUGx1Z2lucy5Mb2NhbFN0b3JhZ2UuQ25kcy5Pbkl0ZW1HZXQpCiAgICAgICAgICAgIH0pCiAgICAgICAgfSBjYXRjaCAoYikgewogICAgICAgICAgICBhd2FpdCB0aGlzLl9UcmlnZ2VyU3RvcmFnZUVycm9yKGIpCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdGhpcy5fcGVuZGluZ0dldHMtLSwgMCA9PT0gdGhpcy5fcGVuZGluZ0dldHMgJiYKICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuVHJpZ2dlckFzeW5jKEMzJGpzY29tcCQyMzIuUGx1Z2lucy5Mb2NhbFN0b3JhZ2UuQ25kcy5PbkFsbEdldHNDb21wbGV0ZSkKICAgICAgICB9CiAgICB9LAogICAgYXN5bmMgR2V0QmluYXJ5SXRlbShhLCBiKSB7CiAgICAgICAgaWYgKGIgJiYgKGIgPSBiLkdldEZpcnN0UGlja2VkKHRoaXMuX2luc3QpKSkgewogICAgICAgICAgICB2YXIgZCA9IGIuR2V0U2RrSW5zdGFuY2UoKTsKICAgICAgICAgICAgdGhpcy5fcGVuZGluZ0dldHMrKzsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGxldCBjID0gYXdhaXQgdGhpcy5fc3RvcmFnZS5nZXRJdGVtKGEpOwogICAgICAgICAgICAgICAgYyA9IGMgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlciA/IGMgOiBuZXcgQXJyYXlCdWZmZXIoMCk7CiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLlNjaGVkdWxlVHJpZ2dlcnMoYXN5bmMgKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHRoaXMuX2xhc3RWYWx1ZSA9ICIiOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRLZXkgPSBhOwogICAgICAgICAgICAgICAgICAgIGQuU2V0QXJyYXlCdWZmZXJUcmFuc2ZlcihjKTsKICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLlRyaWdnZXJBc3luYyhDMyRqc2NvbXAkMjMyLlBsdWdpbnMuTG9jYWxTdG9yYWdlLkNuZHMuT25BbnlJdGVtR2V0KTsKICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLlRyaWdnZXJBc3luYyhDMyRqc2NvbXAkMjMyLlBsdWdpbnMuTG9jYWxTdG9yYWdlLkNuZHMuT25JdGVtR2V0KQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSBjYXRjaCAoYykgewogICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5fVHJpZ2dlclN0b3JhZ2VFcnJvcihjKQogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgdGhpcy5fcGVuZGluZ0dldHMtLSwKICAgICAgICAgICAgICAgICAgICAwID09PSB0aGlzLl9wZW5kaW5nR2V0cyAmJiBhd2FpdCB0aGlzLlRyaWdnZXJBc3luYyhDMyRqc2NvbXAkMjMyLlBsdWdpbnMuTG9jYWxTdG9yYWdlLkNuZHMuT25BbGxHZXRzQ29tcGxldGUpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9LAogICAgYXN5bmMgQ2hlY2tJdGVtRXhpc3RzKGEpIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBjb25zdCBiID0gYXdhaXQgdGhpcy5fc3RvcmFnZS5nZXRJdGVtKGEpOwogICAgICAgICAgICBhd2FpdCB0aGlzLlNjaGVkdWxlVHJpZ2dlcnMoYXN5bmMgKCkgPT4gewogICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudEtleSA9IGE7CiAgICAgICAgICAgICAgICAidW5kZWZpbmVkIiA9PT0gdHlwZW9mIGIgfHwgbnVsbCA9PT0gYiA/ICh0aGlzLl9sYXN0VmFsdWUgPSAiIiwgYXdhaXQgdGhpcy5UcmlnZ2VyQXN5bmMoQzMkanNjb21wJDIzMi5QbHVnaW5zLkxvY2FsU3RvcmFnZS5DbmRzLk9uSXRlbU1pc3NpbmcpKSA6ICh0aGlzLl9sYXN0VmFsdWUgPSBJc0V4cHJlc3Npb25UeXBlKGIpID8gYiA6ICIiLCBhd2FpdCB0aGlzLlRyaWdnZXJBc3luYyhDMyRqc2NvbXAkMjMyLlBsdWdpbnMuTG9jYWxTdG9yYWdlLkNuZHMuT25JdGVtRXhpc3RzKSkKICAgICAgICAgICAgfSkKICAgICAgICB9IGNhdGNoIChiKSB7CiAgICAgICAgICAgIGF3YWl0IHRoaXMuX1RyaWdnZXJTdG9yYWdlRXJyb3IoYikKICAgICAgICB9CiAgICB9LAogICAgYXN5bmMgUmVtb3ZlSXRlbShhKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXdhaXQgdGhpcy5fc3RvcmFnZS5yZW1vdmVJdGVtKGEpLCBhd2FpdCB0aGlzLlNjaGVkdWxlVHJpZ2dlcnMoYXN5bmMgKCkgPT4gewogICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudEtleSA9IGE7CiAgICAgICAgICAgICAgICB0aGlzLl9sYXN0VmFsdWUgPSAiIjsKICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuVHJpZ2dlckFzeW5jKEMzJGpzY29tcCQyMzIuUGx1Z2lucy5Mb2NhbFN0b3JhZ2UuQ25kcy5PbkFueUl0ZW1SZW1vdmVkKTsKICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuVHJpZ2dlckFzeW5jKEMzJGpzY29tcCQyMzIuUGx1Z2lucy5Mb2NhbFN0b3JhZ2UuQ25kcy5Pbkl0ZW1SZW1vdmVkKQogICAgICAgICAgICB9KQogICAgICAgIH0gY2F0Y2ggKGIpIHsKICAgICAgICAgICAgYXdhaXQgdGhpcy5fVHJpZ2dlclN0b3JhZ2VFcnJvcihiKQogICAgICAgIH0KICAgIH0sCiAgICBhc3luYyBDbGVhclN0b3JhZ2UoKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYXdhaXQgdGhpcy5fc3RvcmFnZS5jbGVhcigpLCBhd2FpdCB0aGlzLlNjaGVkdWxlVHJpZ2dlcnMoYXN5bmMgKCkgPT4gewogICAgICAgICAgICAgICAgdGhpcy5fbGFzdFZhbHVlID0gdGhpcy5fY3VycmVudEtleSA9ICIiOwogICAgICAgICAgICAgICAgQzMkanNjb21wJDIzMi5jbGVhckFycmF5KHRoaXMuX2tleU5hbWVzTGlzdCk7CiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLlRyaWdnZXJBc3luYyhDMyRqc2NvbXAkMjMyLlBsdWdpbnMuTG9jYWxTdG9yYWdlLkNuZHMuT25DbGVhcmVkKQogICAgICAgICAgICB9KQogICAgICAgIH0gY2F0Y2ggKGEpIHsKICAgICAgICAgICAgYXdhaXQgdGhpcy5fVHJpZ2dlclN0b3JhZ2VFcnJvcihhKQogICAgICAgIH0KICAgIH0sCiAgICBhc3luYyBHZXRBbGxLZXlOYW1lcygpIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBjb25zdCBhID0gYXdhaXQgdGhpcy5fc3RvcmFnZS5rZXlzKCk7CiAgICAgICAgICAgIGF3YWl0IHRoaXMuU2NoZWR1bGVUcmlnZ2Vycyhhc3luYyAoKSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLl9rZXlOYW1lc0xpc3QgPSBhOwogICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5UcmlnZ2VyQXN5bmMoQzMkanNjb21wJDIzMi5QbHVnaW5zLkxvY2FsU3RvcmFnZS5DbmRzLk9uQWxsS2V5TmFtZXNMb2FkZWQpCiAgICAgICAgICAgIH0pCiAgICAgICAgfSBjYXRjaCAoYSkgewogICAgICAgICAgICBhd2FpdCB0aGlzLl9UcmlnZ2VyU3RvcmFnZUVycm9yKGEpCiAgICAgICAgfQogICAgfQp9OwpzZWxmLkMzLlBsdWdpbnMuTG9jYWxTdG9yYWdlLkV4cHMgPSB7CiAgICBJdGVtVmFsdWUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2xhc3RWYWx1ZQogICAgfSwKICAgIEtleSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fY3VycmVudEtleQogICAgfSwKICAgIEtleUNvdW50KCkgewogICAgICAgIHJldHVybiB0aGlzLl9rZXlOYW1lc0xpc3QubGVuZ3RoCiAgICB9LAogICAgS2V5QXQoYSkgewogICAgICAgIGEgPSBNYXRoLmZsb29yKGEpOwogICAgICAgIHJldHVybiAwID4gYSB8fCBhID49IHRoaXMuX2tleU5hbWVzTGlzdC5sZW5ndGggPyAiIiA6IHRoaXMuX2tleU5hbWVzTGlzdFthXQogICAgfSwKICAgIEVycm9yTWVzc2FnZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZXJyb3JNZXNzYWdlCiAgICB9Cn07CiJ1c2Ugc3RyaWN0IjsKY29uc3QgQzMkanNjb21wJDIzNCA9IHNlbGYuQzM7CkMzJGpzY29tcCQyMzQuUGx1Z2lucy5QbGF0Zm9ybUluZm8gPSBjbGFzcyBleHRlbmRzIEMzJGpzY29tcCQyMzQuU0RLUGx1Z2luQmFzZSB7CiAgICBjb25zdHJ1Y3RvcihhKSB7CiAgICAgICAgc3VwZXIoYSkKICAgIH0KICAgIFJlbGVhc2UoKSB7CiAgICAgICAgc3VwZXIuUmVsZWFzZSgpCiAgICB9Cn07CmNvbnN0IEMzJGpzY29tcCQyMzUgPSBzZWxmLkMzOwpDMyRqc2NvbXAkMjM1LlBsdWdpbnMuUGxhdGZvcm1JbmZvLlR5cGUgPSBjbGFzcyBleHRlbmRzIEMzJGpzY29tcCQyMzUuU0RLVHlwZUJhc2UgewogICAgY29uc3RydWN0b3IoYSkgewogICAgICAgIHN1cGVyKGEpCiAgICB9CiAgICBSZWxlYXNlKCkgewogICAgICAgIHN1cGVyLlJlbGVhc2UoKQogICAgfQogICAgT25DcmVhdGUoKSB7fQp9Owpjb25zdCBDMyRqc2NvbXAkMjM2ID0gc2VsZi5DMzsKQzMkanNjb21wJDIzNi5QbHVnaW5zLlBsYXRmb3JtSW5mby5JbnN0YW5jZSA9IGNsYXNzIGV4dGVuZHMgQzMkanNjb21wJDIzNi5TREtJbnN0YW5jZUJhc2UgewogICAgY29uc3RydWN0b3IoYSwgYikgewogICAgICAgIHN1cGVyKGEsICJwbGF0Zm9ybS1pbmZvIik7CiAgICAgICAgdGhpcy5fd2luZG93T3V0ZXJIZWlnaHQgPSB0aGlzLl93aW5kb3dPdXRlcldpZHRoID0gdGhpcy5fc2NyZWVuSGVpZ2h0ID0gdGhpcy5fc2NyZWVuV2lkdGggPSAwOwogICAgICAgIHRoaXMuX3NhZmVBcmVhSW5zZXQgPSBbMCwgMCwgMCwgMF07CiAgICAgICAgdGhpcy5faXNXYWtlTG9ja0FjdGl2ZSA9IHRoaXMuX3N1cHBvcnRzV2FrZUxvY2sgPSAhMTsKICAgICAgICB0aGlzLkFkZERPTU1lc3NhZ2VIYW5kbGVycyhbCiAgICAgICAgICAgIFsid2luZG93LXJlc2l6ZSIsIGQgPT4gdGhpcy5fT25XaW5kb3dSZXNpemUoZCldLAogICAgICAgICAgICBbIndha2UtbG9jay1hY3F1aXJlZCIsIGQgPT4gdGhpcy5fT25XYWtlTG9ja0FjcXVpcmVkKGQpXSwKICAgICAgICAgICAgWyJ3YWtlLWxvY2stZXJyb3IiLCBkID0+IHRoaXMuX09uV2FrZUxvY2tFcnJvcihkKV0sCiAgICAgICAgICAgIFsid2FrZS1sb2NrLXJlbGVhc2VkIiwgZCA9PiB0aGlzLl9Pbldha2VMb2NrUmVsZWFzZWQoZCldCiAgICAgICAgXSk7CiAgICAgICAgbmF2aWdhdG9yLmNvbm5lY3Rpb24gJiYgbmF2aWdhdG9yLmNvbm5lY3Rpb24uYWRkRXZlbnRMaXN0ZW5lcigiY2hhbmdlIiwgKCkgPT4gdGhpcy5fT25OZXR3b3JrQ2hhbmdlKCkpOwogICAgICAgIHRoaXMuX3J1bnRpbWUuQWRkTG9hZFByb21pc2UodGhpcy5Qb3N0VG9ET01Bc3luYygiZ2V0LWluaXRpYWwtc3RhdGUiKS50aGVuKGQgPT4gewogICAgICAgICAgICB0aGlzLl9zY3JlZW5XaWR0aCA9IGQuc2NyZWVuV2lkdGg7CiAgICAgICAgICAgIHRoaXMuX3NjcmVlbkhlaWdodCA9IGQuc2NyZWVuSGVpZ2h0OwogICAgICAgICAgICB0aGlzLl93aW5kb3dPdXRlcldpZHRoID0gZC53aW5kb3dPdXRlcldpZHRoOwogICAgICAgICAgICB0aGlzLl93aW5kb3dPdXRlckhlaWdodCA9IGQud2luZG93T3V0ZXJIZWlnaHQ7CiAgICAgICAgICAgIHRoaXMuX3NhZmVBcmVhSW5zZXQgPSBkLnNhZmVBcmVhSW5zZXQ7CiAgICAgICAgICAgIHRoaXMuX3N1cHBvcnRzV2FrZUxvY2sgPSBkLnN1cHBvcnRzV2FrZUxvY2sKICAgICAgICB9KSkKICAgIH0KICAgIFJlbGVhc2UoKSB7CiAgICAgICAgc3VwZXIuUmVsZWFzZSgpCiAgICB9CiAgICBfT25XaW5kb3dSZXNpemUoYSkgewogICAgICAgIHRoaXMuX3dpbmRvd091dGVyV2lkdGggPSBhLndpbmRvd091dGVyV2lkdGg7CiAgICAgICAgdGhpcy5fd2luZG93T3V0ZXJIZWlnaHQgPQogICAgICAgICAgICBhLndpbmRvd091dGVySGVpZ2h0OwogICAgICAgIHRoaXMuX3NhZmVBcmVhSW5zZXQgPSBhLnNhZmVBcmVhSW5zZXQKICAgIH0KICAgIGFzeW5jIF9Pbk5ldHdvcmtDaGFuZ2UoKSB7CiAgICAgICAgYXdhaXQgdGhpcy5UcmlnZ2VyQXN5bmMoQzMkanNjb21wJDIzNi5QbHVnaW5zLlBsYXRmb3JtSW5mby5DbmRzLk9uTmV0d29ya0NoYW5nZSkKICAgIH0KICAgIGFzeW5jIF9Pbldha2VMb2NrQWNxdWlyZWQoKSB7CiAgICAgICAgdGhpcy5faXNXYWtlTG9ja0FjdGl2ZSA9ICEwOwogICAgICAgIGF3YWl0IHRoaXMuVHJpZ2dlckFzeW5jKEMzJGpzY29tcCQyMzYuUGx1Z2lucy5QbGF0Zm9ybUluZm8uQ25kcy5Pbldha2VMb2NrQWNxdWlyZWQpCiAgICB9CiAgICBhc3luYyBfT25XYWtlTG9ja0Vycm9yKCkgewogICAgICAgIHRoaXMuX2lzV2FrZUxvY2tBY3RpdmUgPSAhMTsKICAgICAgICBhd2FpdCB0aGlzLlRyaWdnZXJBc3luYyhDMyRqc2NvbXAkMjM2LlBsdWdpbnMuUGxhdGZvcm1JbmZvLkNuZHMuT25XYWtlTG9ja0Vycm9yKQogICAgfQogICAgYXN5bmMgX09uV2FrZUxvY2tSZWxlYXNlZCgpIHsKICAgICAgICB0aGlzLl9pc1dha2VMb2NrQWN0aXZlID0gITE7CiAgICAgICAgYXdhaXQgdGhpcy5UcmlnZ2VyQXN5bmMoQzMkanNjb21wJDIzNi5QbHVnaW5zLlBsYXRmb3JtSW5mby5DbmRzLk9uV2FrZUxvY2tSZWxlYXNlZCkKICAgIH0KfTsKY29uc3QgQzMkanNjb21wJDIzNyA9IHNlbGYuQzM7CkMzJGpzY29tcCQyMzcuUGx1Z2lucy5QbGF0Zm9ybUluZm8uQ25kcyA9IHsKICAgIElzT25Nb2JpbGUoKSB7CiAgICAgICAgcmV0dXJuIEMzJGpzY29tcCQyMzcuUGxhdGZvcm0uSXNNb2JpbGUKICAgIH0sCiAgICBJc09uV2luZG93cygpIHsKICAgICAgICByZXR1cm4gIldpbmRvd3MiID09PSBDMyRqc2NvbXAkMjM3LlBsYXRmb3JtLk9TCiAgICB9LAogICAgSXNPbk1hY09TKCkgewogICAgICAgIHJldHVybiAibWFjT1MiID09PSBDMyRqc2NvbXAkMjM3LlBsYXRmb3JtLk9TCiAgICB9LAogICAgSXNPbkxpbnV4KCkgewogICAgICAgIHJldHVybiAiTGludXgiID09PSBDMyRqc2NvbXAkMjM3LlBsYXRmb3JtLk9TCiAgICB9LAogICAgSXNPbkNocm9tZU9TKCkgewogICAgICAgIHJldHVybiAiQ2hyb21lIE9TIiA9PT0gQzMkanNjb21wJDIzNy5QbGF0Zm9ybS5PUwogICAgfSwKICAgIElzT25BbmRyb2lkKCkgewogICAgICAgIHJldHVybiAiQW5kcm9pZCIgPT09IEMzJGpzY29tcCQyMzcuUGxhdGZvcm0uT1MKICAgIH0sCiAgICBJc09uaU9TKCkgewogICAgICAgIHJldHVybiAiaU9TIiA9PT0gQzMkanNjb21wJDIzNy5QbGF0Zm9ybS5PUwogICAgfSwKICAgIElzV2ViRXhwb3J0KCkgewogICAgICAgIGNvbnN0IGEgPSB0aGlzLl9ydW50aW1lLkdldEV4cG9ydFR5cGUoKTsKICAgICAgICByZXR1cm4gImh0bWw1IiA9PT0KICAgICAgICAgICAgYSB8fCAic2NpcnJhLWFyY2FkZSIgPT09IGEgfHwgInByZXZpZXciID09PSBhIHx8ICJpbnN0YW50LWdhbWVzIiA9PT0gYQogICAgfSwKICAgIElzQ29yZG92YUV4cG9ydCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcnVudGltZS5Jc0NvcmRvdmEoKQogICAgfSwKICAgIElzTldqc0V4cG9ydCgpIHsKICAgICAgICByZXR1cm4gIm53anMiID09PSB0aGlzLl9ydW50aW1lLkdldEV4cG9ydFR5cGUoKQogICAgfSwKICAgIElzV2luZG93c1VXUEV4cG9ydCgpIHsKICAgICAgICByZXR1cm4gIndpbmRvd3MtdXdwIiA9PT0gdGhpcy5fcnVudGltZS5HZXRFeHBvcnRUeXBlKCkKICAgIH0sCiAgICBJc1dpbmRvd3NXZWJWaWV3MkV4cG9ydCgpIHsKICAgICAgICByZXR1cm4gIndpbmRvd3Mtd2VidmlldzIiID09PSB0aGlzLl9ydW50aW1lLkdldEV4cG9ydFR5cGUoKQogICAgfSwKICAgIElzTWFjT1NXS1dlYlZpZXcyRXhwb3J0KCkgewogICAgICAgIHJldHVybiAibWFjb3Mtd2t3ZWJ2aWV3IiA9PT0gdGhpcy5fcnVudGltZS5HZXRFeHBvcnRUeXBlKCkKICAgIH0sCiAgICBPbk5ldHdvcmtDaGFuZ2UoKSB7CiAgICAgICAgcmV0dXJuICEwCiAgICB9LAogICAgT25XYWtlTG9ja0FjcXVpcmVkKCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIE9uV2FrZUxvY2tFcnJvcigpIHsKICAgICAgICByZXR1cm4gITAKICAgIH0sCiAgICBPbldha2VMb2NrUmVsZWFzZWQoKSB7CiAgICAgICAgcmV0dXJuICEwCiAgICB9LAogICAgSXNXYWtlTG9ja0FjdGl2ZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5faXNXYWtlTG9ja0FjdGl2ZQogICAgfSwKICAgIElzV2FrZUxvY2tTdXBwb3J0ZWQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3N1cHBvcnRzV2FrZUxvY2sKICAgIH0KfTsKc2VsZi5DMy5QbHVnaW5zLlBsYXRmb3JtSW5mby5BY3RzID0gewogICAgUmVxdWVzdFdha2VMb2NrKCkgewogICAgICAgIHRoaXMuX3N1cHBvcnRzV2FrZUxvY2sgJiYgdGhpcy5fUG9zdFRvRE9NTWF5YmVTeW5jKCJyZXF1ZXN0LXdha2UtbG9jayIpCiAgICB9LAogICAgUmVsZWFzZVdha2VMb2NrKCkgewogICAgICAgIHRoaXMuX3N1cHBvcnRzV2FrZUxvY2sgJiYgKHRoaXMuX2lzV2FrZUxvY2tBY3RpdmUgPSAhMSwgdGhpcy5Qb3N0VG9ET00oInJlbGVhc2Utd2FrZS1sb2NrIikpCiAgICB9Cn07CnNlbGYuQzMuUGx1Z2lucy5QbGF0Zm9ybUluZm8uRXhwcyA9IHsKICAgIFJlbmRlcmVyKCkgewogICAgICAgIGxldCBhOwogICAgICAgIGEgPSB0aGlzLl9ydW50aW1lLkdldFdlYkdQVVJlbmRlcmVyKCkgPyAid2ViZ3B1IiA6ICJ3ZWJnbCIgKyB0aGlzLl9ydW50aW1lLkdldFdlYkdMUmVuZGVyZXIoKS5HZXRXZWJHTFZlcnNpb25OdW1iZXIoKTsKICAgICAgICB0aGlzLl9ydW50aW1lLkdldFJlbmRlcmVyKCkuSGFzTWFqb3JQZXJmb3JtYW5jZUNhdmVhdCgpICYmIChhICs9ICItc29mdHdhcmUiKTsKICAgICAgICByZXR1cm4gYQogICAgfSwKICAgIFJlbmRlcmVyRGV0YWlsKCkgewogICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lLkdldFdlYkdMUmVuZGVyZXIoKS5HZXRVbm1hc2tlZFJlbmRlcmVyKCkKICAgIH0sCiAgICBEZXZpY2VQaXhlbFJhdGlvKCkgewogICAgICAgIHJldHVybiBzZWxmLmRldmljZVBpeGVsUmF0aW8KICAgIH0sCiAgICBTY3JlZW5XaWR0aCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fc2NyZWVuV2lkdGgKICAgIH0sCiAgICBTY3JlZW5IZWlnaHQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3NjcmVlbkhlaWdodAogICAgfSwKICAgIFdpbmRvd0lubmVyV2lkdGgoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUuR2V0Q2FudmFzTWFuYWdlcigpLkdldExhc3RXaWR0aCgpCiAgICB9LAogICAgV2luZG93SW5uZXJIZWlnaHQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUuR2V0Q2FudmFzTWFuYWdlcigpLkdldExhc3RIZWlnaHQoKQogICAgfSwKICAgIFdpbmRvd091dGVyV2lkdGgoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3dpbmRvd091dGVyV2lkdGgKICAgIH0sCiAgICBXaW5kb3dPdXRlckhlaWdodCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fd2luZG93T3V0ZXJIZWlnaHQKICAgIH0sCiAgICBDYW52YXNDc3NXaWR0aCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcnVudGltZS5HZXRDYW52YXNNYW5hZ2VyKCkuR2V0Q3NzV2lkdGgoKQogICAgfSwKICAgIENhbnZhc0Nzc0hlaWdodCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcnVudGltZS5HZXRDYW52YXNNYW5hZ2VyKCkuR2V0Q3NzSGVpZ2h0KCkKICAgIH0sCiAgICBDYW52YXNEZXZpY2VXaWR0aCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcnVudGltZS5HZXRDYW52YXNNYW5hZ2VyKCkuR2V0RGV2aWNlV2lkdGgoKQogICAgfSwKICAgIENhbnZhc0RldmljZUhlaWdodCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcnVudGltZS5HZXRDYW52YXNNYW5hZ2VyKCkuR2V0RGV2aWNlSGVpZ2h0KCkKICAgIH0sCiAgICBEb3dubGluaygpIHsKICAgICAgICByZXR1cm4gbmF2aWdhdG9yLmNvbm5lY3Rpb24gPwogICAgICAgICAgICBuYXZpZ2F0b3IuY29ubmVjdGlvbi5kb3dubGluayB8fCAwIDogMAogICAgfSwKICAgIERvd25saW5rTWF4KCkgewogICAgICAgIHJldHVybiBuYXZpZ2F0b3IuY29ubmVjdGlvbiA/IG5hdmlnYXRvci5jb25uZWN0aW9uLmRvd25saW5rTWF4IHx8IDAgOiAwCiAgICB9LAogICAgQ29ubmVjdGlvblR5cGUoKSB7CiAgICAgICAgcmV0dXJuIG5hdmlnYXRvci5jb25uZWN0aW9uID8gbmF2aWdhdG9yLmNvbm5lY3Rpb24udHlwZSB8fCAidW5rbm93biIgOiAidW5rbm93biIKICAgIH0sCiAgICBDb25uZWN0aW9uRWZmZWN0aXZlVHlwZSgpIHsKICAgICAgICByZXR1cm4gbmF2aWdhdG9yLmNvbm5lY3Rpb24gPyBuYXZpZ2F0b3IuY29ubmVjdGlvbi5lZmZlY3RpdmVUeXBlIHx8ICJ1bmtub3duIiA6ICJ1bmtub3duIgogICAgfSwKICAgIENvbm5lY3Rpb25SVFQoKSB7CiAgICAgICAgcmV0dXJuIG5hdmlnYXRvci5jb25uZWN0aW9uID8gbmF2aWdhdG9yLmNvbm5lY3Rpb24ucnR0IHx8IDAgOiAwCiAgICB9LAogICAgSGFyZHdhcmVDb25jdXJyZW5jeSgpIHsKICAgICAgICByZXR1cm4gbmF2aWdhdG9yLmhhcmR3YXJlQ29uY3VycmVuY3kgfHwgMAogICAgfSwKICAgIERldmljZU1lbW9yeSgpIHsKICAgICAgICByZXR1cm4gbmF2aWdhdG9yLmRldmljZU1lbW9yeSB8fAogICAgICAgICAgICAwCiAgICB9LAogICAgU2FmZUFyZWFJbnNldFRvcCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fc2FmZUFyZWFJbnNldFswXQogICAgfSwKICAgIFNhZmVBcmVhSW5zZXRSaWdodCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fc2FmZUFyZWFJbnNldFsxXQogICAgfSwKICAgIFNhZmVBcmVhSW5zZXRCb3R0b20oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3NhZmVBcmVhSW5zZXRbMl0KICAgIH0sCiAgICBTYWZlQXJlYUluc2V0TGVmdCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fc2FmZUFyZWFJbnNldFszXQogICAgfQp9OwoidXNlIHN0cmljdCI7CmNvbnN0IEMzJGpzY29tcCQyNDAgPSBzZWxmLkMzOwpDMyRqc2NvbXAkMjQwLlBsdWdpbnMuVG91Y2ggPSBjbGFzcyBleHRlbmRzIEMzJGpzY29tcCQyNDAuU0RLUGx1Z2luQmFzZSB7CiAgICBjb25zdHJ1Y3RvcihhKSB7CiAgICAgICAgc3VwZXIoYSkKICAgIH0KICAgIFJlbGVhc2UoKSB7CiAgICAgICAgc3VwZXIuUmVsZWFzZSgpCiAgICB9Cn07CmNvbnN0IEMzJGpzY29tcCQyNDEgPSBzZWxmLkMzLAogICAgQzNYJGpzY29tcCQyNSA9IHNlbGYuQzNYOwpDMyRqc2NvbXAkMjQxLlBsdWdpbnMuVG91Y2guVHlwZSA9IGNsYXNzIGV4dGVuZHMgQzMkanNjb21wJDI0MS5TREtUeXBlQmFzZSB7CiAgICBjb25zdHJ1Y3RvcihhKSB7CiAgICAgICAgc3VwZXIoYSkKICAgIH0KICAgIFJlbGVhc2UoKSB7CiAgICAgICAgc3VwZXIuUmVsZWFzZSgpCiAgICB9CiAgICBPbkNyZWF0ZSgpIHt9CiAgICBHZXRTY3JpcHRJbnRlcmZhY2VDbGFzcygpIHsKICAgICAgICByZXR1cm4gc2VsZi5JVG91Y2hPYmplY3RUeXBlCiAgICB9Cn07CmxldCB0b3VjaE9iamVjdFR5cGUgPSBudWxsOwoKZnVuY3Rpb24gR2V0VG91Y2hTZGtJbnN0YW5jZSgpIHsKICAgIHJldHVybiB0b3VjaE9iamVjdFR5cGUuR2V0U2luZ2xlR2xvYmFsSW5zdGFuY2UoKS5HZXRTZGtJbnN0YW5jZSgpCn0Kc2VsZi5JVG91Y2hPYmplY3RUeXBlID0gY2xhc3MgZXh0ZW5kcyBzZWxmLklPYmplY3RDbGFzcyB7CiAgICBjb25zdHJ1Y3RvcihhKSB7CiAgICAgICAgc3VwZXIoYSk7CiAgICAgICAgdG91Y2hPYmplY3RUeXBlID0gYTsKICAgICAgICBhLkdldFJ1bnRpbWUoKS5fR2V0Q29tbW9uU2NyaXB0SW50ZXJmYWNlcygpLnRvdWNoID0gdGhpcwogICAgfQogICAgcmVxdWVzdFBlcm1pc3Npb24oYSkgewogICAgICAgIEMzWCRqc2NvbXAkMjUuUmVxdWlyZVN0cmluZyhhKTsKICAgICAgICBjb25zdCBiID0gR2V0VG91Y2hTZGtJbnN0YW5jZSgpOwogICAgICAgIGlmICgib3JpZW50YXRpb24iID09PSBhKSByZXR1cm4gYi5fUmVxdWVzdFBlcm1pc3Npb24oMCk7CiAgICAgICAgaWYgKCJtb3Rpb24iID09PSBhKSByZXR1cm4gYi5fUmVxdWVzdFBlcm1pc3Npb24oMSk7CiAgICAgICAgdGhyb3cgRXJyb3IoImludmFsaWQgdHlwZSIpOwogICAgfQp9Owpjb25zdCBDMyRqc2NvbXAkMjQyID0gc2VsZi5DMzsKQzMkanNjb21wJDI0Mi5QbHVnaW5zLlRvdWNoLkluc3RhbmNlID0gY2xhc3MgZXh0ZW5kcyBDMyRqc2NvbXAkMjQyLlNES0luc3RhbmNlQmFzZSB7CiAgICBjb25zdHJ1Y3RvcihhLCBiKSB7CiAgICAgICAgc3VwZXIoYSwgInRvdWNoIik7CiAgICAgICAgdGhpcy5fdG91Y2hlcyA9IG5ldyBNYXA7CiAgICAgICAgdGhpcy5faXNNb3VzZURvd24gPSB0aGlzLl91c2VNb3VzZUlucHV0ID0gITE7CiAgICAgICAgdGhpcy5fZ2V0VG91Y2hJbmRleCA9IHRoaXMuX2N1clRvdWNoWSA9IHRoaXMuX2N1clRvdWNoWCA9IHRoaXMuX3RyaWdnZXJQZXJtaXNzaW9uID0gdGhpcy5fdHJpZ2dlcklkID0gdGhpcy5fdHJpZ2dlckluZGV4ID0gdGhpcy5fYWNjV2l0aEdaID0gdGhpcy5fYWNjV2l0aEdZID0gdGhpcy5fYWNjV2l0aEdYID0gdGhpcy5fYWNjWiA9IHRoaXMuX2FjY1kgPSB0aGlzLl9hY2NYID0gdGhpcy5fb3JpZW50R2FtbWEgPSB0aGlzLl9vcmllbnRCZXRhID0gdGhpcy5fb3JpZW50QWxwaGEgPSB0aGlzLl9vcmllbnRDb21wYXNzSGVhZGluZyA9IDA7CiAgICAgICAgdGhpcy5fcGVybWlzc2lvblByb21pc2VzID0gW107CiAgICAgICAgYiAmJiAodGhpcy5fdXNlTW91c2VJbnB1dCA9CiAgICAgICAgICAgIGJbMF0pOwogICAgICAgIHRoaXMuQWRkRE9NTWVzc2FnZUhhbmRsZXIoInBlcm1pc3Npb24tcmVzdWx0IiwgZCA9PiB0aGlzLl9PblBlcm1pc3Npb25SZXN1bHQoZCkpOwogICAgICAgIGEgPSB0aGlzLkdldFJ1bnRpbWUoKS5EaXNwYXRjaGVyKCk7CiAgICAgICAgdGhpcy5fZGlzcG9zYWJsZXMgPSBuZXcgQzMkanNjb21wJDI0Mi5Db21wb3NpdGVEaXNwb3NhYmxlKEMzJGpzY29tcCQyNDIuRGlzcG9zYWJsZS5Gcm9tKGEsICJwb2ludGVyZG93biIsIGQgPT4gdGhpcy5fT25Qb2ludGVyRG93bihkLmRhdGEpKSwgQzMkanNjb21wJDI0Mi5EaXNwb3NhYmxlLkZyb20oYSwgInBvaW50ZXJtb3ZlIiwgZCA9PiB0aGlzLl9PblBvaW50ZXJNb3ZlKGQuZGF0YSkpLCBDMyRqc2NvbXAkMjQyLkRpc3Bvc2FibGUuRnJvbShhLCAicG9pbnRlcnVwIiwgZCA9PiB0aGlzLl9PblBvaW50ZXJVcChkLmRhdGEsICExKSksIEMzJGpzY29tcCQyNDIuRGlzcG9zYWJsZS5Gcm9tKGEsICJwb2ludGVyY2FuY2VsIiwgZCA9PiB0aGlzLl9PblBvaW50ZXJVcChkLmRhdGEsICEwKSksIEMzJGpzY29tcCQyNDIuRGlzcG9zYWJsZS5Gcm9tKGEsCiAgICAgICAgICAgICJkZXZpY2VvcmllbnRhdGlvbiIsIGQgPT4gdGhpcy5fT25EZXZpY2VPcmllbnRhdGlvbihkLmRhdGEpKSwgQzMkanNjb21wJDI0Mi5EaXNwb3NhYmxlLkZyb20oYSwgImRldmljZW9yaWVudGF0aW9uYWJzb2x1dGUiLCBkID0+IHRoaXMuX09uRGV2aWNlT3JpZW50YXRpb25BYnNvbHV0ZShkLmRhdGEpKSwgQzMkanNjb21wJDI0Mi5EaXNwb3NhYmxlLkZyb20oYSwgImRldmljZW1vdGlvbiIsIGQgPT4gdGhpcy5fT25EZXZpY2VNb3Rpb24oZC5kYXRhKSksIEMzJGpzY29tcCQyNDIuRGlzcG9zYWJsZS5Gcm9tKGEsICJ0aWNrMiIsIGQgPT4gdGhpcy5fT25UaWNrMigpKSkKICAgIH0KICAgIFJlbGVhc2UoKSB7CiAgICAgICAgdGhpcy5fdG91Y2hlcy5jbGVhcigpOwogICAgICAgIHN1cGVyLlJlbGVhc2UoKQogICAgfQogICAgX09uUG9pbnRlckRvd24oYSkgewogICAgICAgIGlmICgibW91c2UiID09PSBhLnBvaW50ZXJUeXBlKQogICAgICAgICAgICBpZiAodGhpcy5fdXNlTW91c2VJbnB1dCkgdGhpcy5faXNNb3VzZURvd24gPSAhMDsKICAgICAgICAgICAgZWxzZSByZXR1cm47CiAgICAgICAgY29uc3QgYiA9IGEucG9pbnRlcklkOwogICAgICAgIGlmICghdGhpcy5fdG91Y2hlcy5oYXMoYikpIHsKICAgICAgICAgICAgdmFyIGQgPQogICAgICAgICAgICAgICAgYS5wYWdlWCAtIHRoaXMuX3J1bnRpbWUuR2V0Q2FudmFzQ2xpZW50WCgpOwogICAgICAgICAgICBhID0gYS5wYWdlWSAtIHRoaXMuX3J1bnRpbWUuR2V0Q2FudmFzQ2xpZW50WSgpOwogICAgICAgICAgICB2YXIgYyA9IHBlcmZvcm1hbmNlLm5vdygpLAogICAgICAgICAgICAgICAgZSA9IHRoaXMuX3RvdWNoZXMuc2l6ZTsKICAgICAgICAgICAgdGhpcy5fdHJpZ2dlckluZGV4ID0gZTsKICAgICAgICAgICAgdGhpcy5fdHJpZ2dlcklkID0gYjsKICAgICAgICAgICAgdmFyIGcgPSBDMyRqc2NvbXAkMjQyLk5ldyhDMyRqc2NvbXAkMjQyLlBsdWdpbnMuVG91Y2guVG91Y2hJbmZvKTsKICAgICAgICAgICAgZy5Jbml0KGMsIGQsIGEsIGIsIGUpOwogICAgICAgICAgICB0aGlzLl90b3VjaGVzLnNldChiLCBnKTsKICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKEMzJGpzY29tcCQyNDIuUGx1Z2lucy5Ub3VjaC5DbmRzLk9uTnRoVG91Y2hTdGFydCk7CiAgICAgICAgICAgIHRoaXMuVHJpZ2dlcihDMyRqc2NvbXAkMjQyLlBsdWdpbnMuVG91Y2guQ25kcy5PblRvdWNoU3RhcnQpOwogICAgICAgICAgICB0aGlzLl9jdXJUb3VjaFggPSBkOwogICAgICAgICAgICB0aGlzLl9jdXJUb3VjaFkgPSBhOwogICAgICAgICAgICB0aGlzLlRyaWdnZXIoQzMkanNjb21wJDI0Mi5QbHVnaW5zLlRvdWNoLkNuZHMuT25Ub3VjaE9iamVjdCkKICAgICAgICB9CiAgICB9CiAgICBfT25Qb2ludGVyTW92ZShhKSB7CiAgICAgICAgaWYgKCJtb3VzZSIgIT09CiAgICAgICAgICAgIGEucG9pbnRlclR5cGUgfHwgdGhpcy5faXNNb3VzZURvd24pIHsKICAgICAgICAgICAgdmFyIGIgPSB0aGlzLl90b3VjaGVzLmdldChhLnBvaW50ZXJJZCk7CiAgICAgICAgICAgIGlmIChiKSB7CiAgICAgICAgICAgICAgICB2YXIgZCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICAgICAgICAgICAgaWYgKCEoMiA+IGQgLSBiLkdldFRpbWUoKSkpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IGEucGFnZVggLSB0aGlzLl9ydW50aW1lLkdldENhbnZhc0NsaWVudFgoKSwKICAgICAgICAgICAgICAgICAgICAgICAgZSA9IGEucGFnZVkgLSB0aGlzLl9ydW50aW1lLkdldENhbnZhc0NsaWVudFkoKTsKICAgICAgICAgICAgICAgICAgICBiLlVwZGF0ZShkLCBjLCBlLCBhLndpZHRoLCBhLmhlaWdodCwgYS5wcmVzc3VyZSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIF9PblBvaW50ZXJVcChhLCBiKSB7CiAgICAgICAgaWYgKCJtb3VzZSIgPT09IGEucG9pbnRlclR5cGUpCiAgICAgICAgICAgIGlmICh0aGlzLl9pc01vdXNlRG93bikgdGhpcy5faXNNb3VzZURvd24gPSAhMTsKICAgICAgICAgICAgZWxzZSByZXR1cm47CiAgICAgICAgY29uc3QgZCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICAgIGEgPSBhLnBvaW50ZXJJZDsKICAgICAgICBjb25zdCBjID0gdGhpcy5fdG91Y2hlcy5nZXQoYSk7CiAgICAgICAgYyAmJiAodGhpcy5fdHJpZ2dlckluZGV4ID0gYy5HZXRTdGFydEluZGV4KCksIHRoaXMuX3RyaWdnZXJJZCA9IGMuR2V0SWQoKSwgdGhpcy5UcmlnZ2VyKEMzJGpzY29tcCQyNDIuUGx1Z2lucy5Ub3VjaC5DbmRzLk9uTnRoVG91Y2hFbmQpLAogICAgICAgICAgICB0aGlzLlRyaWdnZXIoQzMkanNjb21wJDI0Mi5QbHVnaW5zLlRvdWNoLkNuZHMuT25Ub3VjaEVuZCksIGIgfHwgKGIgPSBjLlNob3VsZFRyaWdnZXJUYXAoZCksICJzaW5nbGUtdGFwIiA9PT0gYiA/ICh0aGlzLlRyaWdnZXIoQzMkanNjb21wJDI0Mi5QbHVnaW5zLlRvdWNoLkNuZHMuT25UYXBHZXN0dXJlKSwgdGhpcy5fY3VyVG91Y2hYID0gYy5HZXRYKCksIHRoaXMuX2N1clRvdWNoWSA9IGMuR2V0WSgpLCB0aGlzLlRyaWdnZXIoQzMkanNjb21wJDI0Mi5QbHVnaW5zLlRvdWNoLkNuZHMuT25UYXBHZXN0dXJlT2JqZWN0KSkgOiAiZG91YmxlLXRhcCIgPT09IGIgJiYgKHRoaXMuVHJpZ2dlcihDMyRqc2NvbXAkMjQyLlBsdWdpbnMuVG91Y2guQ25kcy5PbkRvdWJsZVRhcEdlc3R1cmUpLCB0aGlzLl9jdXJUb3VjaFggPSBjLkdldFgoKSwgdGhpcy5fY3VyVG91Y2hZID0gYy5HZXRZKCksIHRoaXMuVHJpZ2dlcihDMyRqc2NvbXAkMjQyLlBsdWdpbnMuVG91Y2guQ25kcy5PbkRvdWJsZVRhcEdlc3R1cmVPYmplY3QpKSksIGMuUmVsZWFzZSgpLAogICAgICAgICAgICB0aGlzLl90b3VjaGVzLmRlbGV0ZShhKSkKICAgIH0KICAgIF9SZXF1ZXN0UGVybWlzc2lvbihhKSB7CiAgICAgICAgdGhpcy5fUG9zdFRvRE9NTWF5YmVTeW5jKCJyZXF1ZXN0LXBlcm1pc3Npb24iLCB7CiAgICAgICAgICAgIHR5cGU6IGEKICAgICAgICB9KTsKICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKGIsIGQpID0+IHsKICAgICAgICAgICAgdGhpcy5fcGVybWlzc2lvblByb21pc2VzLnB1c2goewogICAgICAgICAgICAgICAgdHlwZTogYSwKICAgICAgICAgICAgICAgIHJlc29sdmU6IGIsCiAgICAgICAgICAgICAgICByZWplY3Q6IGQKICAgICAgICAgICAgfSkKICAgICAgICB9KQogICAgfQogICAgX09uUGVybWlzc2lvblJlc3VsdChhKSB7CiAgICAgICAgY29uc3QgYiA9IGEucmVzdWx0LAogICAgICAgICAgICBkID0gYS50eXBlOwogICAgICAgIHRoaXMuX3RyaWdnZXJQZXJtaXNzaW9uID0gZDsKICAgICAgICBhID0gdGhpcy5fcGVybWlzc2lvblByb21pc2VzLmZpbHRlcihjID0+IGMudHlwZSA9PT0gZCk7CiAgICAgICAgZm9yIChjb25zdCBjIG9mIGEpIGMucmVzb2x2ZShiID8gImdyYW50ZWQiIDogImRlbmllZCIpOwogICAgICAgIHRoaXMuX3Blcm1pc3Npb25Qcm9taXNlcyA9IHRoaXMuX3Blcm1pc3Npb25Qcm9taXNlcy5maWx0ZXIoYyA9PiBjLnR5cGUgIT09IGQpOwogICAgICAgIGIgPyAodGhpcy5UcmlnZ2VyKEMzJGpzY29tcCQyNDIuUGx1Z2lucy5Ub3VjaC5DbmRzLk9uUGVybWlzc2lvbkdyYW50ZWQpLAogICAgICAgICAgICAwID09PSBkID8gdGhpcy5fcnVudGltZS5SZXF1ZXN0RGV2aWNlT3JpZW50YXRpb25FdmVudCgpIDogdGhpcy5fcnVudGltZS5SZXF1ZXN0RGV2aWNlTW90aW9uRXZlbnQoKSkgOiB0aGlzLlRyaWdnZXIoQzMkanNjb21wJDI0Mi5QbHVnaW5zLlRvdWNoLkNuZHMuT25QZXJtaXNzaW9uRGVuaWVkKQogICAgfQogICAgX09uRGV2aWNlT3JpZW50YXRpb24oYSkgewogICAgICAgICJudW1iZXIiID09PSB0eXBlb2YgYS53ZWJraXRDb21wYXNzSGVhZGluZyA/IHRoaXMuX29yaWVudENvbXBhc3NIZWFkaW5nID0gYS53ZWJraXRDb21wYXNzSGVhZGluZyA6IGEuYWJzb2x1dGUgJiYgKHRoaXMuX29yaWVudENvbXBhc3NIZWFkaW5nID0gYS5hbHBoYSk7CiAgICAgICAgdGhpcy5fb3JpZW50QWxwaGEgPSBhLmFscGhhOwogICAgICAgIHRoaXMuX29yaWVudEJldGEgPSBhLmJldGE7CiAgICAgICAgdGhpcy5fb3JpZW50R2FtbWEgPSBhLmdhbW1hCiAgICB9CiAgICBfT25EZXZpY2VPcmllbnRhdGlvbkFic29sdXRlKGEpIHsKICAgICAgICB0aGlzLl9vcmllbnRDb21wYXNzSGVhZGluZyA9IGEuYWxwaGEKICAgIH0KICAgIF9PbkRldmljZU1vdGlvbihhKSB7CiAgICAgICAgY29uc3QgYiA9IGEuYWNjZWxlcmF0aW9uOwogICAgICAgIGIgJiYgKHRoaXMuX2FjY1ggPSBiLngsIHRoaXMuX2FjY1kgPSBiLnksIHRoaXMuX2FjY1ogPSBiLnopOwogICAgICAgIGlmIChhID0gYS5hY2NlbGVyYXRpb25JbmNsdWRpbmdHcmF2aXR5KSB0aGlzLl9hY2NXaXRoR1ggPSBhLngsIHRoaXMuX2FjY1dpdGhHWSA9IGEueSwgdGhpcy5fYWNjV2l0aEdaID0gYS56CiAgICB9CiAgICBfT25UaWNrMigpIHsKICAgICAgICBjb25zdCBhID0gcGVyZm9ybWFuY2Uubm93KCk7CiAgICAgICAgbGV0IGIgPSAwOwogICAgICAgIGZvciAoY29uc3QgZCBvZiB0aGlzLl90b3VjaGVzLnZhbHVlcygpKSBkLkdldFRpbWUoKSA8PSBhIC0gNTAgJiYgZC5fU2V0TGFzdFRpbWUoYSksIGQuU2hvdWxkVHJpZ2dlckhvbGQoYSkgJiYgKHRoaXMuX3RyaWdnZXJJbmRleCA9IGQuR2V0U3RhcnRJbmRleCgpLCB0aGlzLl90cmlnZ2VySWQgPSBkLkdldElkKCksIHRoaXMuX2dldFRvdWNoSW5kZXggPSBiLCB0aGlzLlRyaWdnZXIoQzMkanNjb21wJDI0Mi5QbHVnaW5zLlRvdWNoLkNuZHMuT25Ib2xkR2VzdHVyZSksIHRoaXMuX2N1clRvdWNoWCA9IGQuR2V0WCgpLCB0aGlzLl9jdXJUb3VjaFkgPSBkLkdldFkoKSwgdGhpcy5UcmlnZ2VyKEMzJGpzY29tcCQyNDIuUGx1Z2lucy5Ub3VjaC5DbmRzLk9uSG9sZEdlc3R1cmVPYmplY3QpLAogICAgICAgICAgICB0aGlzLl9nZXRUb3VjaEluZGV4ID0gMCksICsrYgogICAgfQogICAgX0dldFRvdWNoQnlJbmRleChhKSB7CiAgICAgICAgYSA9IE1hdGguZmxvb3IoYSk7CiAgICAgICAgZm9yIChjb25zdCBiIG9mIHRoaXMuX3RvdWNoZXMudmFsdWVzKCkpIHsKICAgICAgICAgICAgaWYgKDAgPT09IGEpIHJldHVybiBiOwogICAgICAgICAgICAtLWEKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG51bGwKICAgIH0KICAgIF9Jc0NsaWVudFBvc09uQ2FudmFzKGEsIGIpIHsKICAgICAgICByZXR1cm4gMCA8PSBhICYmIDAgPD0gYiAmJiBhIDwgdGhpcy5fcnVudGltZS5HZXRDYW52YXNDc3NXaWR0aCgpICYmIGIgPCB0aGlzLl9ydW50aW1lLkdldENhbnZhc0Nzc0hlaWdodCgpCiAgICB9CiAgICBHZXREZWJ1Z2dlclByb3BlcnRpZXMoKSB7CiAgICAgICAgcmV0dXJuIFt7CiAgICAgICAgICAgIHRpdGxlOiAicGx1Z2lucy50b3VjaC5kZWJ1Z2dlci50b3VjaGVzIiwKICAgICAgICAgICAgcHJvcGVydGllczogWy4uLnRoaXMuX3RvdWNoZXMudmFsdWVzKCldLm1hcChhID0+ICh7CiAgICAgICAgICAgICAgICBuYW1lOiAiJCIgKyBhLkdldElkKCksCiAgICAgICAgICAgICAgICB2YWx1ZTogYS5HZXRYKCkgKyAiLCAiICsgYS5HZXRZKCkKICAgICAgICAgICAgfSkpCiAgICAgICAgfV0KICAgIH0KfTsKY29uc3QgQzMkanNjb21wJDI0MyA9IHNlbGYuQzMsCiAgICB0ZW1wQXJyID0gW107CkMzJGpzY29tcCQyNDMuUGx1Z2lucy5Ub3VjaC5DbmRzID0gewogICAgT25Ub3VjaFN0YXJ0KCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIE9uVG91Y2hFbmQoKSB7CiAgICAgICAgcmV0dXJuICEwCiAgICB9LAogICAgSXNJblRvdWNoKCkgewogICAgICAgIHJldHVybiAwIDwgdGhpcy5fdG91Y2hlcy5zaXplCiAgICB9LAogICAgT25Ub3VjaE9iamVjdChhKSB7CiAgICAgICAgcmV0dXJuIGEgJiYgdGhpcy5fSXNDbGllbnRQb3NPbkNhbnZhcyh0aGlzLl9jdXJUb3VjaFgsIHRoaXMuX2N1clRvdWNoWSkgPyB0aGlzLl9ydW50aW1lLkdldENvbGxpc2lvbkVuZ2luZSgpLlRlc3RBbmRTZWxlY3RDYW52YXNQb2ludE92ZXJsYXAoYSwgdGhpcy5fY3VyVG91Y2hYLCB0aGlzLl9jdXJUb3VjaFksICExKSA6ICExCiAgICB9LAogICAgSXNUb3VjaGluZ09iamVjdChhKSB7CiAgICAgICAgaWYgKCFhKSByZXR1cm4gITE7CiAgICAgICAgY29uc3QgYiA9IG5ldyBNYXAsCiAgICAgICAgICAgIGQgPSBhLkdldEN1cnJlbnRTb2woKTsKICAgICAgICB2YXIgYyA9IGQuR2V0SW5zdGFuY2VzKCk7CiAgICAgICAgZm9yIChjb25zdCBlIG9mIGMpIHsKICAgICAgICAgICAgY29uc3QgZyA9IGUuR2V0V29ybGRJbmZvKCksCiAgICAgICAgICAgICAgICBrID0gZy5HZXRMYXllcigpOwogICAgICAgICAgICBjID0gazsKICAgICAgICAgICAgbGV0IG0gPSBiLmdldChjKTsKICAgICAgICAgICAgInVuZGVmaW5lZCIgPT09CiAgICAgICAgICAgIHR5cGVvZiBtICYmIChtID0gYy5Jc1NlbGZBbmRQYXJlbnRzSW50ZXJhY3RpdmUoKSwgYi5zZXQoYywgbSkpOwogICAgICAgICAgICBpZiAobSAmJiBnLklzSW5WaWV3cG9ydDIoKSkKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgbiBvZiB0aGlzLl90b3VjaGVzLnZhbHVlcygpKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9Jc0NsaWVudFBvc09uQ2FudmFzKG4uR2V0WCgpLCBuLkdldFkoKSkpIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IFtxLCB1XSA9IGsuQ2FudmFzQ3NzVG9MYXllcihuLkdldFgoKSwgbi5HZXRZKCksIGcuR2V0VG90YWxaRWxldmF0aW9uKCkpOwogICAgICAgICAgICAgICAgICAgIGlmIChnLkNvbnRhaW5zUG9pbnQocSwgdSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGVtcEFyci5wdXNoKGUpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgYi5jbGVhcigpOwogICAgICAgIHJldHVybiB0ZW1wQXJyLmxlbmd0aCA/IChkLlNldEFycmF5UGlja2VkKHRlbXBBcnIpLCBhLkFwcGx5U29sVG9Db250YWluZXIoKSwgQzMkanNjb21wJDI0My5jbGVhckFycmF5KHRlbXBBcnIpLCAhMCkgOiAhMQogICAgfSwKICAgIENvbXBhcmVUb3VjaFNwZWVkKGEsIGIsIGQpIHsKICAgICAgICByZXR1cm4gKGEgPSB0aGlzLl9HZXRUb3VjaEJ5SW5kZXgoYSkpID8gQzMkanNjb21wJDI0My5jb21wYXJlKGEuR2V0U3BlZWQoKSwKICAgICAgICAgICAgYiwgZCkgOiAhMQogICAgfSwKICAgIE9yaWVudGF0aW9uU3VwcG9ydGVkKCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIE1vdGlvblN1cHBvcnRlZCgpIHsKICAgICAgICByZXR1cm4gITAKICAgIH0sCiAgICBDb21wYXJlT3JpZW50YXRpb24oYSwgYiwgZCkgewogICAgICAgIHRoaXMuX3J1bnRpbWUuUmVxdWVzdERldmljZU9yaWVudGF0aW9uRXZlbnQoKTsKICAgICAgICByZXR1cm4gQzMkanNjb21wJDI0My5jb21wYXJlKDAgPT09IGEgPyB0aGlzLl9vcmllbnRBbHBoYSA6IDEgPT09IGEgPyB0aGlzLl9vcmllbnRCZXRhIDogdGhpcy5fb3JpZW50R2FtbWEsIGIsIGQpCiAgICB9LAogICAgQ29tcGFyZUFjY2VsZXJhdGlvbihhLCBiLCBkKSB7CiAgICAgICAgdGhpcy5fcnVudGltZS5SZXF1ZXN0RGV2aWNlTW90aW9uRXZlbnQoKTsKICAgICAgICByZXR1cm4gQzMkanNjb21wJDI0My5jb21wYXJlKDAgPT09IGEgPyB0aGlzLl9hY2NXaXRoR1ggOiAxID09PSBhID8gdGhpcy5fYWNjV2l0aEdZIDogMiA9PT0gYSA/IHRoaXMuX2FjY1dpdGhHWiA6IDMgPT09IGEgPyB0aGlzLl9hY2NYIDogNCA9PT0gYSA/IHRoaXMuX2FjY1kgOiB0aGlzLl9hY2NaLCBiLCBkKQogICAgfSwKICAgIE9uTnRoVG91Y2hTdGFydChhKSB7CiAgICAgICAgYSA9IE1hdGguZmxvb3IoYSk7CiAgICAgICAgcmV0dXJuIGEgPT09CiAgICAgICAgICAgIHRoaXMuX3RyaWdnZXJJbmRleAogICAgfSwKICAgIE9uTnRoVG91Y2hFbmQoYSkgewogICAgICAgIGEgPSBNYXRoLmZsb29yKGEpOwogICAgICAgIHJldHVybiBhID09PSB0aGlzLl90cmlnZ2VySW5kZXgKICAgIH0sCiAgICBIYXNOdGhUb3VjaChhKSB7CiAgICAgICAgYSA9IE1hdGguZmxvb3IoYSk7CiAgICAgICAgcmV0dXJuIHRoaXMuX3RvdWNoZXMuc2l6ZSA+PSBhICsgMQogICAgfSwKICAgIE9uSG9sZEdlc3R1cmUoKSB7CiAgICAgICAgcmV0dXJuICEwCiAgICB9LAogICAgT25UYXBHZXN0dXJlKCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIE9uRG91YmxlVGFwR2VzdHVyZSgpIHsKICAgICAgICByZXR1cm4gITAKICAgIH0sCiAgICBPbkhvbGRHZXN0dXJlT2JqZWN0KGEpIHsKICAgICAgICByZXR1cm4gYSAmJiB0aGlzLl9Jc0NsaWVudFBvc09uQ2FudmFzKHRoaXMuX2N1clRvdWNoWCwgdGhpcy5fY3VyVG91Y2hZKSA/IHRoaXMuX3J1bnRpbWUuR2V0Q29sbGlzaW9uRW5naW5lKCkuVGVzdEFuZFNlbGVjdENhbnZhc1BvaW50T3ZlcmxhcChhLCB0aGlzLl9jdXJUb3VjaFgsIHRoaXMuX2N1clRvdWNoWSwgITEpIDogITEKICAgIH0sCiAgICBPblRhcEdlc3R1cmVPYmplY3QoYSkgewogICAgICAgIHJldHVybiBhICYmIHRoaXMuX0lzQ2xpZW50UG9zT25DYW52YXModGhpcy5fY3VyVG91Y2hYLAogICAgICAgICAgICB0aGlzLl9jdXJUb3VjaFkpID8gdGhpcy5fcnVudGltZS5HZXRDb2xsaXNpb25FbmdpbmUoKS5UZXN0QW5kU2VsZWN0Q2FudmFzUG9pbnRPdmVybGFwKGEsIHRoaXMuX2N1clRvdWNoWCwgdGhpcy5fY3VyVG91Y2hZLCAhMSkgOiAhMQogICAgfSwKICAgIE9uRG91YmxlVGFwR2VzdHVyZU9iamVjdChhKSB7CiAgICAgICAgcmV0dXJuIGEgJiYgdGhpcy5fSXNDbGllbnRQb3NPbkNhbnZhcyh0aGlzLl9jdXJUb3VjaFgsIHRoaXMuX2N1clRvdWNoWSkgPyB0aGlzLl9ydW50aW1lLkdldENvbGxpc2lvbkVuZ2luZSgpLlRlc3RBbmRTZWxlY3RDYW52YXNQb2ludE92ZXJsYXAoYSwgdGhpcy5fY3VyVG91Y2hYLCB0aGlzLl9jdXJUb3VjaFksICExKSA6ICExCiAgICB9LAogICAgT25QZXJtaXNzaW9uR3JhbnRlZChhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3RyaWdnZXJQZXJtaXNzaW9uID09PSBhCiAgICB9LAogICAgT25QZXJtaXNzaW9uRGVuaWVkKGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdHJpZ2dlclBlcm1pc3Npb24gPT09IGEKICAgIH0KfTsKc2VsZi5DMy5QbHVnaW5zLlRvdWNoLkFjdHMgPSB7CiAgICBSZXF1ZXN0UGVybWlzc2lvbihhKSB7CiAgICAgICAgdGhpcy5fUmVxdWVzdFBlcm1pc3Npb24oYSkKICAgIH0KfTsKY29uc3QgQzMkanNjb21wJDI0NSA9IHNlbGYuQzM7CkMzJGpzY29tcCQyNDUuUGx1Z2lucy5Ub3VjaC5FeHBzID0gewogICAgVG91Y2hDb3VudCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdG91Y2hlcy5zaXplCiAgICB9LAogICAgWChhKSB7CiAgICAgICAgY29uc3QgYiA9IHRoaXMuX0dldFRvdWNoQnlJbmRleCh0aGlzLl9nZXRUb3VjaEluZGV4KTsKICAgICAgICByZXR1cm4gYiA/IGIuR2V0UG9zaXRpb25Gb3JMYXllcih0aGlzLl9ydW50aW1lLkdldEN1cnJlbnRMYXlvdXQoKSwgYSwgITApIDogMAogICAgfSwKICAgIFkoYSkgewogICAgICAgIGNvbnN0IGIgPSB0aGlzLl9HZXRUb3VjaEJ5SW5kZXgodGhpcy5fZ2V0VG91Y2hJbmRleCk7CiAgICAgICAgcmV0dXJuIGIgPyBiLkdldFBvc2l0aW9uRm9yTGF5ZXIodGhpcy5fcnVudGltZS5HZXRDdXJyZW50TGF5b3V0KCksIGEsICExKSA6IDAKICAgIH0sCiAgICBYQXQoYSwgYikgewogICAgICAgIHJldHVybiAoYSA9IHRoaXMuX0dldFRvdWNoQnlJbmRleChhKSkgPyBhLkdldFBvc2l0aW9uRm9yTGF5ZXIodGhpcy5fcnVudGltZS5HZXRDdXJyZW50TGF5b3V0KCksIGIsICEwKSA6IDAKICAgIH0sCiAgICBZQXQoYSwgYikgewogICAgICAgIHJldHVybiAoYSA9IHRoaXMuX0dldFRvdWNoQnlJbmRleChhKSkgPyBhLkdldFBvc2l0aW9uRm9yTGF5ZXIodGhpcy5fcnVudGltZS5HZXRDdXJyZW50TGF5b3V0KCksCiAgICAgICAgICAgIGIsICExKSA6IDAKICAgIH0sCiAgICBYRm9ySUQoYSwgYikgewogICAgICAgIHJldHVybiAoYSA9IHRoaXMuX3RvdWNoZXMuZ2V0KGEpKSA/IGEuR2V0UG9zaXRpb25Gb3JMYXllcih0aGlzLl9ydW50aW1lLkdldEN1cnJlbnRMYXlvdXQoKSwgYiwgITApIDogMAogICAgfSwKICAgIFlGb3JJRChhLCBiKSB7CiAgICAgICAgcmV0dXJuIChhID0gdGhpcy5fdG91Y2hlcy5nZXQoYSkpID8gYS5HZXRQb3NpdGlvbkZvckxheWVyKHRoaXMuX3J1bnRpbWUuR2V0Q3VycmVudExheW91dCgpLCBiLCAhMSkgOiAwCiAgICB9LAogICAgQWJzb2x1dGVYKCkgewogICAgICAgIGNvbnN0IGEgPSB0aGlzLl9HZXRUb3VjaEJ5SW5kZXgoMCk7CiAgICAgICAgcmV0dXJuIGEgPyBhLkdldFgoKSA6IDAKICAgIH0sCiAgICBBYnNvbHV0ZVkoKSB7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuX0dldFRvdWNoQnlJbmRleCgwKTsKICAgICAgICByZXR1cm4gYSA/IGEuR2V0WSgpIDogMAogICAgfSwKICAgIEFic29sdXRlWEF0KGEpIHsKICAgICAgICByZXR1cm4gKGEgPSB0aGlzLl9HZXRUb3VjaEJ5SW5kZXgoYSkpID8gYS5HZXRYKCkgOiAwCiAgICB9LAogICAgQWJzb2x1dGVZQXQoYSkgewogICAgICAgIHJldHVybiAoYSA9IHRoaXMuX0dldFRvdWNoQnlJbmRleChhKSkgPyBhLkdldFkoKSA6IDAKICAgIH0sCiAgICBBYnNvbHV0ZVhGb3JJRChhKSB7CiAgICAgICAgcmV0dXJuIChhID0KICAgICAgICAgICAgdGhpcy5fdG91Y2hlcy5nZXQoYSkpID8gYS5HZXRYKCkgOiAwCiAgICB9LAogICAgQWJzb2x1dGVZRm9ySUQoYSkgewogICAgICAgIHJldHVybiAoYSA9IHRoaXMuX3RvdWNoZXMuZ2V0KGEpKSA/IGEuR2V0WSgpIDogMAogICAgfSwKICAgIFNwZWVkQXQoYSkgewogICAgICAgIHJldHVybiAoYSA9IHRoaXMuX0dldFRvdWNoQnlJbmRleChhKSkgPyBhLkdldFNwZWVkKCkgOiAwCiAgICB9LAogICAgU3BlZWRGb3JJRChhKSB7CiAgICAgICAgcmV0dXJuIChhID0gdGhpcy5fdG91Y2hlcy5nZXQoYSkpID8gYS5HZXRTcGVlZCgpIDogMAogICAgfSwKICAgIEFuZ2xlQXQoYSkgewogICAgICAgIHJldHVybiAoYSA9IHRoaXMuX0dldFRvdWNoQnlJbmRleChhKSkgPyBDMyRqc2NvbXAkMjQ1LnRvRGVncmVlcyhhLkdldEFuZ2xlKCkpIDogMAogICAgfSwKICAgIEFuZ2xlRm9ySUQoYSkgewogICAgICAgIHJldHVybiAoYSA9IHRoaXMuX3RvdWNoZXMuZ2V0KGEpKSA/IEMzJGpzY29tcCQyNDUudG9EZWdyZWVzKGEuR2V0QW5nbGUoKSkgOiAwCiAgICB9LAogICAgQ29tcGFzc0hlYWRpbmcoKSB7CiAgICAgICAgdGhpcy5fcnVudGltZS5SZXF1ZXN0RGV2aWNlT3JpZW50YXRpb25FdmVudCgpOwogICAgICAgIHJldHVybiB0aGlzLl9vcmllbnRDb21wYXNzSGVhZGluZwogICAgfSwKICAgIEFscGhhKCkgewogICAgICAgIHRoaXMuX3J1bnRpbWUuUmVxdWVzdERldmljZU9yaWVudGF0aW9uRXZlbnQoKTsKICAgICAgICByZXR1cm4gdGhpcy5fb3JpZW50QWxwaGEKICAgIH0sCiAgICBCZXRhKCkgewogICAgICAgIHRoaXMuX3J1bnRpbWUuUmVxdWVzdERldmljZU9yaWVudGF0aW9uRXZlbnQoKTsKICAgICAgICByZXR1cm4gdGhpcy5fb3JpZW50QmV0YQogICAgfSwKICAgIEdhbW1hKCkgewogICAgICAgIHRoaXMuX3J1bnRpbWUuUmVxdWVzdERldmljZU9yaWVudGF0aW9uRXZlbnQoKTsKICAgICAgICByZXR1cm4gdGhpcy5fb3JpZW50R2FtbWEKICAgIH0sCiAgICBBY2NlbGVyYXRpb25YV2l0aEcoKSB7CiAgICAgICAgdGhpcy5fcnVudGltZS5SZXF1ZXN0RGV2aWNlTW90aW9uRXZlbnQoKTsKICAgICAgICByZXR1cm4gdGhpcy5fYWNjV2l0aEdYCiAgICB9LAogICAgQWNjZWxlcmF0aW9uWVdpdGhHKCkgewogICAgICAgIHRoaXMuX3J1bnRpbWUuUmVxdWVzdERldmljZU1vdGlvbkV2ZW50KCk7CiAgICAgICAgcmV0dXJuIHRoaXMuX2FjY1dpdGhHWQogICAgfSwKICAgIEFjY2VsZXJhdGlvblpXaXRoRygpIHsKICAgICAgICB0aGlzLl9ydW50aW1lLlJlcXVlc3REZXZpY2VNb3Rpb25FdmVudCgpOwogICAgICAgIHJldHVybiB0aGlzLl9hY2NXaXRoR1oKICAgIH0sCiAgICBBY2NlbGVyYXRpb25YKCkgewogICAgICAgIHRoaXMuX3J1bnRpbWUuUmVxdWVzdERldmljZU1vdGlvbkV2ZW50KCk7CiAgICAgICAgcmV0dXJuIHRoaXMuX2FjY1gKICAgIH0sCiAgICBBY2NlbGVyYXRpb25ZKCkgewogICAgICAgIHRoaXMuX3J1bnRpbWUuUmVxdWVzdERldmljZU1vdGlvbkV2ZW50KCk7CiAgICAgICAgcmV0dXJuIHRoaXMuX2FjY1kKICAgIH0sCiAgICBBY2NlbGVyYXRpb25aKCkgewogICAgICAgIHRoaXMuX3J1bnRpbWUuUmVxdWVzdERldmljZU1vdGlvbkV2ZW50KCk7CiAgICAgICAgcmV0dXJuIHRoaXMuX2FjY1oKICAgIH0sCiAgICBUb3VjaEluZGV4KCkgewogICAgICAgIHJldHVybiB0aGlzLl90cmlnZ2VySW5kZXgKICAgIH0sCiAgICBUb3VjaElEKCkgewogICAgICAgIHJldHVybiB0aGlzLl90cmlnZ2VySWQKICAgIH0sCiAgICBXaWR0aEZvcklEKGEpIHsKICAgICAgICByZXR1cm4gKGEgPSB0aGlzLl90b3VjaGVzLmdldChhKSkgPyBhLkdldFdpZHRoKCkgOiAwCiAgICB9LAogICAgSGVpZ2h0Rm9ySUQoYSkgewogICAgICAgIHJldHVybiAoYSA9IHRoaXMuX3RvdWNoZXMuZ2V0KGEpKSA/IGEuR2V0SGVpZ2h0KCkgOiAwCiAgICB9LAogICAgUHJlc3N1cmVGb3JJRChhKSB7CiAgICAgICAgcmV0dXJuIChhID0gdGhpcy5fdG91Y2hlcy5nZXQoYSkpID8gYS5HZXRQcmVzc3VyZSgpIDogMAogICAgfQp9OwoidXNlIHN0cmljdCI7CmNvbnN0IEMzJGpzY29tcCQyNDYgPSBzZWxmLkMzOwpsZXQgbGFzdFRhcFggPSAtMUUzLAogICAgbGFzdFRhcFkgPSAtMUUzLAogICAgbGFzdFRhcFRpbWUgPSAtMUU0OwpDMyRqc2NvbXAkMjQ2LlBsdWdpbnMuVG91Y2guVG91Y2hJbmZvID0gY2xhc3MgZXh0ZW5kcyBDMyRqc2NvbXAkMjQ2LkRlZmVuZGVkQmFzZSB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgICBzdXBlcigpOwogICAgICAgIHRoaXMuX3ByZXNzdXJlID0gdGhpcy5faGVpZ2h0ID0gdGhpcy5fd2lkdGggPSB0aGlzLl9sYXN0WSA9IHRoaXMuX2xhc3RYID0gdGhpcy5feSA9IHRoaXMuX3ggPSB0aGlzLl9zdGFydFkgPSB0aGlzLl9zdGFydFggPSB0aGlzLl9sYXN0VGltZSA9IHRoaXMuX3RpbWUgPSB0aGlzLl9zdGFydFRpbWUgPSB0aGlzLl9zdGFydEluZGV4ID0gdGhpcy5fcG9pbnRlcklkID0gMDsKICAgICAgICB0aGlzLl9pc1Rvb0ZhckZvckhvbGQgPSB0aGlzLl9oYXNUcmlnZ2VyZWRIb2xkID0gITEKICAgIH0KICAgIFJlbGVhc2UoKSB7fQogICAgSW5pdChhLCBiLCBkLCBjLCBlKSB7CiAgICAgICAgdGhpcy5fcG9pbnRlcklkID0gYzsKICAgICAgICB0aGlzLl9zdGFydEluZGV4ID0gZTsKICAgICAgICB0aGlzLl9zdGFydFRpbWUgPSB0aGlzLl9sYXN0VGltZSA9IHRoaXMuX3RpbWUgPSBhOwogICAgICAgIHRoaXMuX3N0YXJ0WCA9IGI7CiAgICAgICAgdGhpcy5fc3RhcnRZID0gZDsKICAgICAgICB0aGlzLl94ID0gYjsKICAgICAgICB0aGlzLl95ID0gZDsKICAgICAgICB0aGlzLl9sYXN0WCA9CiAgICAgICAgICAgIGI7CiAgICAgICAgdGhpcy5fbGFzdFkgPSBkCiAgICB9CiAgICBVcGRhdGUoYSwgYiwgZCwgYywgZSwgZykgewogICAgICAgIHRoaXMuX2xhc3RUaW1lID0gdGhpcy5fdGltZTsKICAgICAgICB0aGlzLl90aW1lID0gYTsKICAgICAgICB0aGlzLl9sYXN0WCA9IHRoaXMuX3g7CiAgICAgICAgdGhpcy5fbGFzdFkgPSB0aGlzLl95OwogICAgICAgIHRoaXMuX3ggPSBiOwogICAgICAgIHRoaXMuX3kgPSBkOwogICAgICAgIHRoaXMuX3dpZHRoID0gYzsKICAgICAgICB0aGlzLl9oZWlnaHQgPSBlOwogICAgICAgIHRoaXMuX3ByZXNzdXJlID0gZzsKICAgICAgICAhdGhpcy5faXNUb29GYXJGb3JIb2xkICYmIDE1IDw9IEMzJGpzY29tcCQyNDYuZGlzdGFuY2VUbyh0aGlzLl9zdGFydFgsIHRoaXMuX3N0YXJ0WSwgdGhpcy5feCwgdGhpcy5feSkgJiYgKHRoaXMuX2lzVG9vRmFyRm9ySG9sZCA9ICEwKQogICAgfQogICAgR2V0SWQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3BvaW50ZXJJZAogICAgfQogICAgR2V0U3RhcnRJbmRleCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fc3RhcnRJbmRleAogICAgfQogICAgR2V0VGltZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdGltZQogICAgfQogICAgX1NldExhc3RUaW1lKGEpIHsKICAgICAgICB0aGlzLl9sYXN0VGltZSA9IGEKICAgIH0KICAgIEdldFgoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3gKICAgIH0KICAgIEdldFkoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3kKICAgIH0KICAgIEdldFNwZWVkKCkgewogICAgICAgIGNvbnN0IGEgPSBDMyRqc2NvbXAkMjQ2LmRpc3RhbmNlVG8odGhpcy5feCwKICAgICAgICAgICAgICAgIHRoaXMuX3ksIHRoaXMuX2xhc3RYLCB0aGlzLl9sYXN0WSksCiAgICAgICAgICAgIGIgPSAodGhpcy5fdGltZSAtIHRoaXMuX2xhc3RUaW1lKSAvIDFFMzsKICAgICAgICByZXR1cm4gMCA8IGIgPyBhIC8gYiA6IDAKICAgIH0KICAgIEdldEFuZ2xlKCkgewogICAgICAgIHJldHVybiBDMyRqc2NvbXAkMjQ2LmFuZ2xlVG8odGhpcy5fbGFzdFgsIHRoaXMuX2xhc3RZLCB0aGlzLl94LCB0aGlzLl95KQogICAgfQogICAgR2V0V2lkdGgoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3dpZHRoCiAgICB9CiAgICBHZXRIZWlnaHQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2hlaWdodAogICAgfQogICAgR2V0UHJlc3N1cmUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3ByZXNzdXJlCiAgICB9CiAgICBTaG91bGRUcmlnZ2VySG9sZChhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2hhc1RyaWdnZXJlZEhvbGQgPyAhMSA6IDUwMCA8PSBhIC0gdGhpcy5fc3RhcnRUaW1lICYmICF0aGlzLl9pc1Rvb0ZhckZvckhvbGQgJiYgMTUgPiBDMyRqc2NvbXAkMjQ2LmRpc3RhbmNlVG8odGhpcy5fc3RhcnRYLCB0aGlzLl9zdGFydFksIHRoaXMuX3gsIHRoaXMuX3kpID8gdGhpcy5faGFzVHJpZ2dlcmVkSG9sZCA9ICEwIDogITEKICAgIH0KICAgIFNob3VsZFRyaWdnZXJUYXAoYSkgewogICAgICAgIGlmICh0aGlzLl9oYXNUcmlnZ2VyZWRIb2xkKSByZXR1cm4gIiI7CiAgICAgICAgaWYgKDMzMyA+PSBhIC0gdGhpcy5fc3RhcnRUaW1lICYmICF0aGlzLl9pc1Rvb0ZhckZvckhvbGQgJiYgMTUgPiBDMyRqc2NvbXAkMjQ2LmRpc3RhbmNlVG8odGhpcy5fc3RhcnRYLCB0aGlzLl9zdGFydFksIHRoaXMuX3gsIHRoaXMuX3kpKSB7CiAgICAgICAgICAgIGlmICg2NjYgPj0gYSAtIGxhc3RUYXBUaW1lICYmIDI1ID4gQzMkanNjb21wJDI0Ni5kaXN0YW5jZVRvKGxhc3RUYXBYLCBsYXN0VGFwWSwgdGhpcy5feCwgdGhpcy5feSkpIHJldHVybiBsYXN0VGFwWSA9IGxhc3RUYXBYID0gLTFFMywgbGFzdFRhcFRpbWUgPSAtMUU0LCAiZG91YmxlLXRhcCI7CiAgICAgICAgICAgIGxhc3RUYXBYID0gdGhpcy5feDsKICAgICAgICAgICAgbGFzdFRhcFkgPSB0aGlzLl95OwogICAgICAgICAgICBsYXN0VGFwVGltZSA9IGE7CiAgICAgICAgICAgIHJldHVybiAic2luZ2xlLXRhcCIKICAgICAgICB9CiAgICAgICAgcmV0dXJuICIiCiAgICB9CiAgICBHZXRQb3NpdGlvbkZvckxheWVyKGEsIGIsIGQpIHsKICAgICAgICByZXR1cm4gInVuZGVmaW5lZCIgPT09IHR5cGVvZiBiID8gYS5HZXRMYXllckJ5SW5kZXgoMCkuQ2FudmFzQ3NzVG9MYXllcl9EZWZhdWx0VHJhbnNmb3JtKHRoaXMuX3gsIHRoaXMuX3kpW2QgPyAwIDogMV0gOiAoYSA9IGEuR2V0TGF5ZXIoYikpID8gYS5DYW52YXNDc3NUb0xheWVyKHRoaXMuX3gsCiAgICAgICAgICAgIHRoaXMuX3kpW2QgPyAwIDogMV0gOiAwCiAgICB9Cn07CiJ1c2Ugc3RyaWN0IjsKQzMuUGx1Z2lucy5HYW1lQW5hbHl0aWNzID0gY2xhc3MgZXh0ZW5kcyBDMy5TREtQbHVnaW5CYXNlIHsKICAgIGNvbnN0cnVjdG9yKGEpIHsKICAgICAgICBzdXBlcihhKQogICAgfQogICAgUmVsZWFzZSgpIHsKICAgICAgICBzdXBlci5SZWxlYXNlKCkKICAgIH0KfTsKInVzZSBzdHJpY3QiOwpDMy5QbHVnaW5zLkdhbWVBbmFseXRpY3MuVHlwZSA9IGNsYXNzIGV4dGVuZHMgQzMuU0RLVHlwZUJhc2UgewogICAgY29uc3RydWN0b3IoYSkgewogICAgICAgIHN1cGVyKGEpCiAgICB9CiAgICBSZWxlYXNlKCkgewogICAgICAgIHN1cGVyLlJlbGVhc2UoKQogICAgfQogICAgT25DcmVhdGUoKSB7fQp9OwoidXNlIHN0cmljdCI7CkMzLlBsdWdpbnMuR2FtZUFuYWx5dGljcy5JbnN0YW5jZSA9IGNsYXNzIGV4dGVuZHMgQzMuU0RLSW5zdGFuY2VCYXNlIHsKICAgIGNvbnN0cnVjdG9yKGEsIGIpIHsKICAgICAgICBzdXBlcihhKTsKICAgICAgICB0aGlzLl9jdXN0b21Vc2VySWQgPSB0aGlzLl9idWlsZCA9ICIiOwogICAgICAgIHRoaXMuX2F1dG9EZXRlY3RBcHBWZXJzaW9uID0gdGhpcy5fZW5hYmxlVmVyYm9zZUxvZyA9IHRoaXMuX2VuYWJsZUluZm9Mb2cgPSB0aGlzLl9lbmFibGVNYW51YWxTZXNzaW9uSGFuZGxpbmcgPSAhMTsKICAgICAgICB0aGlzLl9zZWNyZXRLZXlJT1MgPSB0aGlzLl9nYW1lS2V5SU9TID0gdGhpcy5fc2VjcmV0S2V5QW5kcm9pZCA9IHRoaXMuX2dhbWVLZXlBbmRyb2lkID0gdGhpcy5fc2VjcmV0S2V5QnJvd3NlciA9IHRoaXMuX2dhbWVLZXlCcm93c2VyID0gIiI7CiAgICAgICAgdGhpcy5fY3VzdG9tRGltZW5zaW9uczAxID0gW107CiAgICAgICAgdGhpcy5fY3VzdG9tRGltZW5zaW9uczAyID0gW107CiAgICAgICAgdGhpcy5fY3VzdG9tRGltZW5zaW9uczAzID0gW107CiAgICAgICAgdGhpcy5fcmVzb3VyY2VDdXJyZW5jaWVzID0gW107CiAgICAgICAgdGhpcy5fcmVzb3VyY2VJdGVtVHlwZXMgPSBbXTsKICAgICAgICBiICYmCiAgICAgICAgICAgICh0aGlzLl9idWlsZCA9IGJbMF0sIHRoaXMuX2N1c3RvbVVzZXJJZCA9IGJbMV0sIHRoaXMuX2VuYWJsZU1hbnVhbFNlc3Npb25IYW5kbGluZyA9IGJbMl0sIHRoaXMuX2VuYWJsZUluZm9Mb2cgPSBiWzNdLCB0aGlzLl9lbmFibGVWZXJib3NlTG9nID0gYls0XSwgdGhpcy5fYXV0b0RldGVjdEFwcFZlcnNpb24gPSBiWzVdLCB0aGlzLl9nYW1lS2V5QnJvd3NlciA9IGJbNl0sIHRoaXMuX3NlY3JldEtleUJyb3dzZXIgPSBiWzddLCB0aGlzLl9nYW1lS2V5QW5kcm9pZCA9IGJbOF0sIHRoaXMuX3NlY3JldEtleUFuZHJvaWQgPSBiWzldLCB0aGlzLl9nYW1lS2V5SU9TID0gYlsxMF0sIHRoaXMuX3NlY3JldEtleUlPUyA9IGJbMTFdKQogICAgfQogICAgUmVsZWFzZSgpIHsKICAgICAgICBzdXBlci5SZWxlYXNlKCkKICAgIH0KICAgIFNhdmVUb0pzb24oKSB7CiAgICAgICAgcmV0dXJuIHt9CiAgICB9CiAgICBMb2FkRnJvbUpzb24oYSkge30KfTsKInVzZSBzdHJpY3QiOwpDMy5QbHVnaW5zLkdhbWVBbmFseXRpY3MuQ25kcyA9IHsKICAgIGlzUmVtb3RlQ29uZmlnc1JlYWR5KGEpIHsKICAgICAgICBpZiAoInVuZGVmaW5lZCIgIT09IHR5cGVvZiBnbG9iYWxUaGlzLkdhbWVBbmFseXRpY3MgJiYgImZ1bmN0aW9uIiA9PSB0eXBlb2YgZ2xvYmFsVGhpcy5HYW1lQW5hbHl0aWNzLmlzUmVtb3RlQ29uZmlnc1JlYWR5KSByZXR1cm4gZ2xvYmFsVGhpcy5HYW1lQW5hbHl0aWNzLmlzUmVtb3RlQ29uZmlnc1JlYWR5KGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgYSAmJiBnbG9iYWxUaGlzLmMyX2NhbGxGdW5jdGlvbiAmJiBnbG9iYWxUaGlzLmMyX2NhbGxGdW5jdGlvbihhLCBbYiA/IDEgOiAwXSkKICAgICAgICB9KSwgITE7CiAgICAgICAgaWYgKCJ1bmRlZmluZWQiICE9PSB0eXBlb2YgZ2xvYmFsVGhpcy5nYW1lYW5hbHl0aWNzICYmICJ1bmRlZmluZWQiICE9IHR5cGVvZiBnbG9iYWxUaGlzLmdhbWVhbmFseXRpY3MuR2FtZUFuYWx5dGljcykgcmV0dXJuIGdsb2JhbFRoaXMuZ2FtZWFuYWx5dGljcy5HYW1lQW5hbHl0aWNzLmlzUmVtb3RlQ29uZmlnc1JlYWR5KCk7CiAgICAgICAgY29uc29sZS5sb2coImlzUmVtb3RlQ29uZmlnc1JlYWR5OiBHYW1lQW5hbHl0aWNzIG9iamVjdCBub3QgZm91bmQiKTsKICAgICAgICByZXR1cm4gITEKICAgIH0KfTsKInVzZSBzdHJpY3QiOwpDMy5QbHVnaW5zLkdhbWVBbmFseXRpY3MuQWN0cyA9IHsKICAgIGFkZEF2YWlsYWJsZUN1c3RvbURpbWVuc2lvbjAxKGEpIHsKICAgICAgICB0aGlzLl9jdXN0b21EaW1lbnNpb25zMDEucHVzaChhKQogICAgfSwKICAgIGFkZEF2YWlsYWJsZUN1c3RvbURpbWVuc2lvbjAyKGEpIHsKICAgICAgICB0aGlzLl9jdXN0b21EaW1lbnNpb25zMDIucHVzaChhKQogICAgfSwKICAgIGFkZEF2YWlsYWJsZUN1c3RvbURpbWVuc2lvbjAzKGEpIHsKICAgICAgICB0aGlzLl9jdXN0b21EaW1lbnNpb25zMDMucHVzaChhKQogICAgfSwKICAgIGFkZEF2YWlsYWJsZVJlc291cmNlQ3VycmVuY3koYSkgewogICAgICAgIHRoaXMuX3Jlc291cmNlQ3VycmVuY2llcy5wdXNoKGEpCiAgICB9LAogICAgYWRkQXZhaWxhYmxlUmVzb3VyY2VJdGVtVHlwZShhKSB7CiAgICAgICAgdGhpcy5fcmVzb3VyY2VJdGVtVHlwZXMucHVzaChhKQogICAgfSwKICAgIGluaXRpYWxpemUoKSB7CiAgICAgICAgaWYgKCJ1bmRlZmluZWQiICE9PSB0eXBlb2YgZ2xvYmFsVGhpcy5HYW1lQW5hbHl0aWNzICYmICJmdW5jdGlvbiIgPT0gdHlwZW9mIGdsb2JhbFRoaXMuR2FtZUFuYWx5dGljcy5pbml0aWFsaXplKSB7CiAgICAgICAgICAgIHZhciBhID0gZ2xvYmFsVGhpcy5HYW1lQW5hbHl0aWNzOwogICAgICAgICAgICB0aGlzLl9lbmFibGVJbmZvTG9nICYmIGEuc2V0RW5hYmxlZEluZm9Mb2coITApOwogICAgICAgICAgICB0aGlzLl9lbmFibGVWZXJib3NlTG9nICYmIGEuc2V0RW5hYmxlZFZlcmJvc2VMb2coITApOwogICAgICAgICAgICB0aGlzLl9lbmFibGVNYW51YWxTZXNzaW9uSGFuZGxpbmcgJiYgYS5zZXRFbmFibGVkTWFudWFsU2Vzc2lvbkhhbmRsaW5nKCEwKTsKICAgICAgICAgICAgMCA8IHRoaXMuX2N1c3RvbURpbWVuc2lvbnMwMS5sZW5ndGggJiYgYS5jb25maWd1cmVBdmFpbGFibGVDdXN0b21EaW1lbnNpb25zMDEodGhpcy5fY3VzdG9tRGltZW5zaW9uczAxKTsKICAgICAgICAgICAgMCA8IHRoaXMuX2N1c3RvbURpbWVuc2lvbnMwMi5sZW5ndGggJiYgYS5jb25maWd1cmVBdmFpbGFibGVDdXN0b21EaW1lbnNpb25zMDIodGhpcy5fY3VzdG9tRGltZW5zaW9uczAyKTsKICAgICAgICAgICAgMCA8IHRoaXMuX2N1c3RvbURpbWVuc2lvbnMwMy5sZW5ndGggJiYgYS5jb25maWd1cmVBdmFpbGFibGVDdXN0b21EaW1lbnNpb25zMDModGhpcy5fY3VzdG9tRGltZW5zaW9uczAzKTsKICAgICAgICAgICAgMCA8IHRoaXMuX3Jlc291cmNlQ3VycmVuY2llcy5sZW5ndGggJiYKICAgICAgICAgICAgICAgIGEuY29uZmlndXJlQXZhaWxhYmxlUmVzb3VyY2VDdXJyZW5jaWVzKHRoaXMuX3Jlc291cmNlQ3VycmVuY2llcyk7CiAgICAgICAgICAgIDAgPCB0aGlzLl9yZXNvdXJjZUl0ZW1UeXBlcy5sZW5ndGggJiYgYS5jb25maWd1cmVBdmFpbGFibGVSZXNvdXJjZUl0ZW1UeXBlcyh0aGlzLl9yZXNvdXJjZUl0ZW1UeXBlcyk7CiAgICAgICAgICAgIGEuY29uZmlndXJlQnVpbGQodGhpcy5fYnVpbGQpOwogICAgICAgICAgICB0aGlzLl9hdXRvRGV0ZWN0QXBwVmVyc2lvbiAmJiBhLmNvbmZpZ3VyZUF1dG9EZXRlY3RBcHBWZXJzaW9uKCEwKTsKICAgICAgICAgICAgYS5pbml0aWFsaXplKHsKICAgICAgICAgICAgICAgIGdhbWVLZXk6ICJBbmRyb2lkIiA9PT0gZ2xvYmFsVGhpcy5kZXZpY2UucGxhdGZvcm0gPyB0aGlzLl9nYW1lS2V5QW5kcm9pZCA6IHRoaXMuX2dhbWVLZXlJT1MsCiAgICAgICAgICAgICAgICBzZWNyZXRLZXk6ICJBbmRyb2lkIiA9PT0gZ2xvYmFsVGhpcy5kZXZpY2UucGxhdGZvcm0gPyB0aGlzLl9zZWNyZXRLZXlBbmRyb2lkIDogdGhpcy5fc2VjcmV0S2V5SU9TLAogICAgICAgICAgICAgICAgc2RrVmVyc2lvbjogImNvbnN0cnVjdCAzLjAuMTMiCiAgICAgICAgICAgIH0pCiAgICAgICAgfSBlbHNlICJ1bmRlZmluZWQiICE9PSB0eXBlb2YgZ2xvYmFsVGhpcy5nYW1lYW5hbHl0aWNzICYmCiAgICAgICAgICAgICJ1bmRlZmluZWQiICE9IHR5cGVvZiBnbG9iYWxUaGlzLmdhbWVhbmFseXRpY3MuR2FtZUFuYWx5dGljcyA/IChhID0gZ2xvYmFsVGhpcy5nYW1lYW5hbHl0aWNzLkdhbWVBbmFseXRpY3MsIHRoaXMuX2VuYWJsZUluZm9Mb2cgJiYgYS5zZXRFbmFibGVkSW5mb0xvZyghMCksIHRoaXMuX2VuYWJsZVZlcmJvc2VMb2cgJiYgYS5zZXRFbmFibGVkVmVyYm9zZUxvZyghMCksIHRoaXMuX2VuYWJsZU1hbnVhbFNlc3Npb25IYW5kbGluZyAmJiBhLnNldEVuYWJsZWRNYW51YWxTZXNzaW9uSGFuZGxpbmcoITApLCAwIDwgdGhpcy5fY3VzdG9tRGltZW5zaW9uczAxLmxlbmd0aCAmJiBhLmNvbmZpZ3VyZUF2YWlsYWJsZUN1c3RvbURpbWVuc2lvbnMwMSh0aGlzLl9jdXN0b21EaW1lbnNpb25zMDEpLCAwIDwgdGhpcy5fY3VzdG9tRGltZW5zaW9uczAyLmxlbmd0aCAmJiBhLmNvbmZpZ3VyZUF2YWlsYWJsZUN1c3RvbURpbWVuc2lvbnMwMih0aGlzLl9jdXN0b21EaW1lbnNpb25zMDIpLCAwIDwgdGhpcy5fY3VzdG9tRGltZW5zaW9uczAzLmxlbmd0aCAmJgogICAgICAgICAgICAgICAgYS5jb25maWd1cmVBdmFpbGFibGVDdXN0b21EaW1lbnNpb25zMDModGhpcy5fY3VzdG9tRGltZW5zaW9uczAzKSwgMCA8IHRoaXMuX3Jlc291cmNlQ3VycmVuY2llcy5sZW5ndGggJiYgYS5jb25maWd1cmVBdmFpbGFibGVSZXNvdXJjZUN1cnJlbmNpZXModGhpcy5fcmVzb3VyY2VDdXJyZW5jaWVzKSwgMCA8IHRoaXMuX3Jlc291cmNlSXRlbVR5cGVzLmxlbmd0aCAmJiBhLmNvbmZpZ3VyZUF2YWlsYWJsZVJlc291cmNlSXRlbVR5cGVzKHRoaXMuX3Jlc291cmNlSXRlbVR5cGVzKSwgYS5jb25maWd1cmVCdWlsZCh0aGlzLl9idWlsZCksIGEuY29uZmlndXJlU2RrR2FtZUVuZ2luZVZlcnNpb24oImNvbnN0cnVjdCAzLjAuMTMiKSwgYS5pbml0aWFsaXplKHRoaXMuX2dhbWVLZXlCcm93c2VyLCB0aGlzLl9zZWNyZXRLZXlCcm93c2VyKSkgOiBjb25zb2xlLmxvZygiaW5pdGlhbGl6ZTogR2FtZUFuYWx5dGljcyBvYmplY3Qgbm90IGZvdW5kIikKICAgIH0sCiAgICBhZGRCdXNpbmVzc0V2ZW50KGEsIGIsIGQsIGMsIGUpIHsKICAgICAgICAidW5kZWZpbmVkIiAhPT0KICAgICAgICB0eXBlb2YgZ2xvYmFsVGhpcy5HYW1lQW5hbHl0aWNzICYmICJmdW5jdGlvbiIgPT0gdHlwZW9mIGdsb2JhbFRoaXMuR2FtZUFuYWx5dGljcy5hZGRCdXNpbmVzc0V2ZW50ID8gZ2xvYmFsVGhpcy5HYW1lQW5hbHl0aWNzLmFkZEJ1c2luZXNzRXZlbnQoewogICAgICAgICAgICBjdXJyZW5jeTogYSwKICAgICAgICAgICAgYW1vdW50OiBiLAogICAgICAgICAgICBpdGVtVHlwZTogZCwKICAgICAgICAgICAgaXRlbUlkOiBjLAogICAgICAgICAgICBjYXJ0VHlwZTogZQogICAgICAgIH0pIDogInVuZGVmaW5lZCIgIT09IHR5cGVvZiBnbG9iYWxUaGlzLmdhbWVhbmFseXRpY3MgJiYgInVuZGVmaW5lZCIgIT0gdHlwZW9mIGdsb2JhbFRoaXMuZ2FtZWFuYWx5dGljcy5HYW1lQW5hbHl0aWNzID8gZ2xvYmFsVGhpcy5nYW1lYW5hbHl0aWNzLkdhbWVBbmFseXRpY3MuYWRkQnVzaW5lc3NFdmVudChhLCBiLCBkLCBjLCBlKSA6IGNvbnNvbGUubG9nKCJhZGRCdXNpbmVzc0V2ZW50OiBHYW1lQW5hbHl0aWNzIG9iamVjdCBub3QgZm91bmQiKQogICAgfSwKICAgIGFkZFJlc291cmNlRXZlbnQoYSwgYiwgZCwgYywgZSkgewogICAgICAgICJ1bmRlZmluZWQiICE9PSB0eXBlb2YgZ2xvYmFsVGhpcy5HYW1lQW5hbHl0aWNzICYmCiAgICAgICAgICAgICJmdW5jdGlvbiIgPT0gdHlwZW9mIGdsb2JhbFRoaXMuR2FtZUFuYWx5dGljcy5hZGRSZXNvdXJjZUV2ZW50ID8gZ2xvYmFsVGhpcy5HYW1lQW5hbHl0aWNzLmFkZFJlc291cmNlRXZlbnQoewogICAgICAgICAgICAgICAgZmxvd1R5cGU6IGEsCiAgICAgICAgICAgICAgICBjdXJyZW5jeTogYiwKICAgICAgICAgICAgICAgIGFtb3VudDogZCwKICAgICAgICAgICAgICAgIGl0ZW1UeXBlOiBjLAogICAgICAgICAgICAgICAgaXRlbUlkOiBlCiAgICAgICAgICAgIH0pIDogInVuZGVmaW5lZCIgIT09IHR5cGVvZiBnbG9iYWxUaGlzLmdhbWVhbmFseXRpY3MgJiYgInVuZGVmaW5lZCIgIT0gdHlwZW9mIGdsb2JhbFRoaXMuZ2FtZWFuYWx5dGljcy5HYW1lQW5hbHl0aWNzID8gZ2xvYmFsVGhpcy5nYW1lYW5hbHl0aWNzLkdhbWVBbmFseXRpY3MuYWRkUmVzb3VyY2VFdmVudChhLCBiLCBkLCBjLCBlKSA6IGNvbnNvbGUubG9nKCJhZGRSZXNvdXJjZUV2ZW50OiBHYW1lQW5hbHl0aWNzIG9iamVjdCBub3QgZm91bmQiKQogICAgfSwKICAgIGFkZFByb2dyZXNzaW9uRXZlbnQoYSwgYiwgZCwgYykgewogICAgICAgICJ1bmRlZmluZWQiICE9PSB0eXBlb2YgZ2xvYmFsVGhpcy5HYW1lQW5hbHl0aWNzICYmICJmdW5jdGlvbiIgPT0gdHlwZW9mIGdsb2JhbFRoaXMuR2FtZUFuYWx5dGljcy5hZGRQcm9ncmVzc2lvbkV2ZW50ID8KICAgICAgICAgICAgZ2xvYmFsVGhpcy5HYW1lQW5hbHl0aWNzLmFkZFByb2dyZXNzaW9uRXZlbnQoewogICAgICAgICAgICAgICAgcHJvZ3Jlc3Npb25TdGF0dXM6IGEsCiAgICAgICAgICAgICAgICBwcm9ncmVzc2lvbjAxOiBiLAogICAgICAgICAgICAgICAgcHJvZ3Jlc3Npb24wMjogZCwKICAgICAgICAgICAgICAgIHByb2dyZXNzaW9uMDM6IGMKICAgICAgICAgICAgfSkgOiAidW5kZWZpbmVkIiAhPT0gdHlwZW9mIGdsb2JhbFRoaXMuZ2FtZWFuYWx5dGljcyAmJiAidW5kZWZpbmVkIiAhPSB0eXBlb2YgZ2xvYmFsVGhpcy5nYW1lYW5hbHl0aWNzLkdhbWVBbmFseXRpY3MgPyBnbG9iYWxUaGlzLmdhbWVhbmFseXRpY3MuR2FtZUFuYWx5dGljcy5hZGRQcm9ncmVzc2lvbkV2ZW50KGEsIGIsIGQsIGMpIDogY29uc29sZS5sb2coImFkZFByb2dyZXNzaW9uRXZlbnQ6IEdhbWVBbmFseXRpY3Mgb2JqZWN0IG5vdCBmb3VuZCIpCiAgICB9LAogICAgYWRkUHJvZ3Jlc3Npb25FdmVudFdpdGhTY29yZShhLCBiLCBkLCBjLCBlKSB7CiAgICAgICAgInVuZGVmaW5lZCIgIT09IHR5cGVvZiBnbG9iYWxUaGlzLkdhbWVBbmFseXRpY3MgJiYgImZ1bmN0aW9uIiA9PSB0eXBlb2YgZ2xvYmFsVGhpcy5HYW1lQW5hbHl0aWNzLmFkZFByb2dyZXNzaW9uRXZlbnQgPwogICAgICAgICAgICBnbG9iYWxUaGlzLkdhbWVBbmFseXRpY3MuYWRkUHJvZ3Jlc3Npb25FdmVudCh7CiAgICAgICAgICAgICAgICBwcm9ncmVzc2lvblN0YXR1czogYSwKICAgICAgICAgICAgICAgIHByb2dyZXNzaW9uMDE6IGIsCiAgICAgICAgICAgICAgICBwcm9ncmVzc2lvbjAyOiBkLAogICAgICAgICAgICAgICAgcHJvZ3Jlc3Npb24wMzogYywKICAgICAgICAgICAgICAgIHNjb3JlOiBlCiAgICAgICAgICAgIH0pIDogInVuZGVmaW5lZCIgIT09IHR5cGVvZiBnbG9iYWxUaGlzLmdhbWVhbmFseXRpY3MgJiYgInVuZGVmaW5lZCIgIT0gdHlwZW9mIGdsb2JhbFRoaXMuZ2FtZWFuYWx5dGljcy5HYW1lQW5hbHl0aWNzID8gZ2xvYmFsVGhpcy5nYW1lYW5hbHl0aWNzLkdhbWVBbmFseXRpY3MuYWRkUHJvZ3Jlc3Npb25FdmVudChhLCBiLCBkLCBjLCBlKSA6IGNvbnNvbGUubG9nKCJhZGRQcm9ncmVzc2lvbkV2ZW50V2l0aFNjb3JlOiBHYW1lQW5hbHl0aWNzIG9iamVjdCBub3QgZm91bmQiKQogICAgfSwKICAgIGFkZERlc2lnbkV2ZW50KGEpIHsKICAgICAgICAidW5kZWZpbmVkIiAhPT0gdHlwZW9mIGdsb2JhbFRoaXMuR2FtZUFuYWx5dGljcyAmJiAiZnVuY3Rpb24iID09IHR5cGVvZiBnbG9iYWxUaGlzLkdhbWVBbmFseXRpY3MuYWRkRGVzaWduRXZlbnQgPwogICAgICAgICAgICBnbG9iYWxUaGlzLkdhbWVBbmFseXRpY3MuYWRkRGVzaWduRXZlbnQoewogICAgICAgICAgICAgICAgZXZlbnRJZDogYQogICAgICAgICAgICB9KSA6ICJ1bmRlZmluZWQiICE9PSB0eXBlb2YgZ2xvYmFsVGhpcy5nYW1lYW5hbHl0aWNzICYmICJ1bmRlZmluZWQiICE9IHR5cGVvZiBnbG9iYWxUaGlzLmdhbWVhbmFseXRpY3MuR2FtZUFuYWx5dGljcyA/IGdsb2JhbFRoaXMuZ2FtZWFuYWx5dGljcy5HYW1lQW5hbHl0aWNzLmFkZERlc2lnbkV2ZW50KGEpIDogY29uc29sZS5sb2coImFkZERlc2lnbkV2ZW50OiBHYW1lQW5hbHl0aWNzIG9iamVjdCBub3QgZm91bmQiKQogICAgfSwKICAgIGFkZERlc2lnbkV2ZW50V2l0aFZhbHVlKGEsIGIpIHsKICAgICAgICAidW5kZWZpbmVkIiAhPT0gdHlwZW9mIGdsb2JhbFRoaXMuR2FtZUFuYWx5dGljcyAmJiAiZnVuY3Rpb24iID09IHR5cGVvZiBnbG9iYWxUaGlzLkdhbWVBbmFseXRpY3MuYWRkRGVzaWduRXZlbnQgPyBnbG9iYWxUaGlzLkdhbWVBbmFseXRpY3MuYWRkRGVzaWduRXZlbnQoewogICAgICAgICAgICAgICAgZXZlbnRJZDogYSwKICAgICAgICAgICAgICAgIHZhbHVlOiBiCiAgICAgICAgICAgIH0pIDogInVuZGVmaW5lZCIgIT09IHR5cGVvZiBnbG9iYWxUaGlzLmdhbWVhbmFseXRpY3MgJiYKICAgICAgICAgICAgInVuZGVmaW5lZCIgIT0gdHlwZW9mIGdsb2JhbFRoaXMuZ2FtZWFuYWx5dGljcy5HYW1lQW5hbHl0aWNzID8gZ2xvYmFsVGhpcy5nYW1lYW5hbHl0aWNzLkdhbWVBbmFseXRpY3MuYWRkRGVzaWduRXZlbnQoYSwgYikgOiBjb25zb2xlLmxvZygiYWRkRGVzaWduRXZlbnRXaXRoVmFsdWU6IEdhbWVBbmFseXRpY3Mgb2JqZWN0IG5vdCBmb3VuZCIpCiAgICB9LAogICAgYWRkRXJyb3JFdmVudChhLCBiKSB7CiAgICAgICAgInVuZGVmaW5lZCIgIT09IHR5cGVvZiBnbG9iYWxUaGlzLkdhbWVBbmFseXRpY3MgJiYgImZ1bmN0aW9uIiA9PSB0eXBlb2YgZ2xvYmFsVGhpcy5HYW1lQW5hbHl0aWNzLmFkZEVycm9yRXZlbnQgPyBnbG9iYWxUaGlzLkdhbWVBbmFseXRpY3MuYWRkRXJyb3JFdmVudCh7CiAgICAgICAgICAgIHNldmVyaXR5OiBhLAogICAgICAgICAgICBtZXNzYWdlOiBiCiAgICAgICAgfSkgOiAidW5kZWZpbmVkIiAhPT0gdHlwZW9mIGdsb2JhbFRoaXMuZ2FtZWFuYWx5dGljcyAmJiAidW5kZWZpbmVkIiAhPSB0eXBlb2YgZ2xvYmFsVGhpcy5nYW1lYW5hbHl0aWNzLkdhbWVBbmFseXRpY3MgPyBnbG9iYWxUaGlzLmdhbWVhbmFseXRpY3MuR2FtZUFuYWx5dGljcy5hZGRFcnJvckV2ZW50KGEsCiAgICAgICAgICAgIGIpIDogY29uc29sZS5sb2coImFkZEVycm9yRXZlbnQ6IEdhbWVBbmFseXRpY3Mgb2JqZWN0IG5vdCBmb3VuZCIpCiAgICB9LAogICAgc2V0RW5hYmxlZEV2ZW50U3VibWlzc2lvbihhKSB7CiAgICAgICAgInVuZGVmaW5lZCIgIT09IHR5cGVvZiBnbG9iYWxUaGlzLkdhbWVBbmFseXRpY3MgJiYgImZ1bmN0aW9uIiA9PSB0eXBlb2YgZ2xvYmFsVGhpcy5HYW1lQW5hbHl0aWNzLnNldEVuYWJsZWRFdmVudFN1Ym1pc3Npb24gPyBnbG9iYWxUaGlzLkdhbWVBbmFseXRpY3Muc2V0RW5hYmxlZEV2ZW50U3VibWlzc2lvbihhID8gITAgOiAhMSkgOiAidW5kZWZpbmVkIiAhPT0gdHlwZW9mIGdsb2JhbFRoaXMuZ2FtZWFuYWx5dGljcyAmJiAidW5kZWZpbmVkIiAhPSB0eXBlb2YgZ2xvYmFsVGhpcy5nYW1lYW5hbHl0aWNzLkdhbWVBbmFseXRpY3MgPyBnbG9iYWxUaGlzLmdhbWVhbmFseXRpY3MuR2FtZUFuYWx5dGljcy5zZXRFbmFibGVkRXZlbnRTdWJtaXNzaW9uKGEgPyAhMCA6ICExKSA6IGNvbnNvbGUubG9nKCJzZXRFbmFibGVkRXZlbnRTdWJtaXNzaW9uOiBHYW1lQW5hbHl0aWNzIG9iamVjdCBub3QgZm91bmQiKQogICAgfSwKICAgIHNldEVuYWJsZWRNYW51YWxTZXNzaW9uSGFuZGxpbmcoYSkgewogICAgICAgICJ1bmRlZmluZWQiICE9PSB0eXBlb2YgZ2xvYmFsVGhpcy5HYW1lQW5hbHl0aWNzICYmICJmdW5jdGlvbiIgPT0gdHlwZW9mIGdsb2JhbFRoaXMuR2FtZUFuYWx5dGljcy5zZXRFbmFibGVkTWFudWFsU2Vzc2lvbkhhbmRsaW5nID8gZ2xvYmFsVGhpcy5HYW1lQW5hbHl0aWNzLnNldEVuYWJsZWRNYW51YWxTZXNzaW9uSGFuZGxpbmcoYSA/ICEwIDogITEpIDogInVuZGVmaW5lZCIgIT09IHR5cGVvZiBnbG9iYWxUaGlzLmdhbWVhbmFseXRpY3MgJiYgInVuZGVmaW5lZCIgIT0gdHlwZW9mIGdsb2JhbFRoaXMuZ2FtZWFuYWx5dGljcy5HYW1lQW5hbHl0aWNzID8gZ2xvYmFsVGhpcy5nYW1lYW5hbHl0aWNzLkdhbWVBbmFseXRpY3Muc2V0RW5hYmxlZE1hbnVhbFNlc3Npb25IYW5kbGluZyhhID8gITAgOiAhMSkgOiBjb25zb2xlLmxvZygic2V0RW5hYmxlZE1hbnVhbFNlc3Npb25IYW5kbGluZzogR2FtZUFuYWx5dGljcyBvYmplY3Qgbm90IGZvdW5kIikKICAgIH0sCiAgICBzZXRDdXN0b21EaW1lbnNpb24wMShhKSB7CiAgICAgICAgInVuZGVmaW5lZCIgIT09CiAgICAgICAgdHlwZW9mIGdsb2JhbFRoaXMuR2FtZUFuYWx5dGljcyAmJiAiZnVuY3Rpb24iID09IHR5cGVvZiBnbG9iYWxUaGlzLkdhbWVBbmFseXRpY3Muc2V0Q3VzdG9tRGltZW5zaW9uMDEgPyBnbG9iYWxUaGlzLkdhbWVBbmFseXRpY3Muc2V0Q3VzdG9tRGltZW5zaW9uMDEoYSkgOiAidW5kZWZpbmVkIiAhPT0gdHlwZW9mIGdsb2JhbFRoaXMuZ2FtZWFuYWx5dGljcyAmJiAidW5kZWZpbmVkIiAhPSB0eXBlb2YgZ2xvYmFsVGhpcy5nYW1lYW5hbHl0aWNzLkdhbWVBbmFseXRpY3MgPyBnbG9iYWxUaGlzLmdhbWVhbmFseXRpY3MuR2FtZUFuYWx5dGljcy5zZXRDdXN0b21EaW1lbnNpb24wMShhKSA6IGNvbnNvbGUubG9nKCJzZXRDdXN0b21EaW1lbnNpb24wMTogR2FtZUFuYWx5dGljcyBvYmplY3Qgbm90IGZvdW5kIikKICAgIH0sCiAgICBzZXRDdXN0b21EaW1lbnNpb24wMihhKSB7CiAgICAgICAgInVuZGVmaW5lZCIgIT09IHR5cGVvZiBnbG9iYWxUaGlzLkdhbWVBbmFseXRpY3MgJiYgImZ1bmN0aW9uIiA9PSB0eXBlb2YgZ2xvYmFsVGhpcy5HYW1lQW5hbHl0aWNzLnNldEN1c3RvbURpbWVuc2lvbjAyID8KICAgICAgICAgICAgZ2xvYmFsVGhpcy5HYW1lQW5hbHl0aWNzLnNldEN1c3RvbURpbWVuc2lvbjAyKGEpIDogInVuZGVmaW5lZCIgIT09IHR5cGVvZiBnbG9iYWxUaGlzLmdhbWVhbmFseXRpY3MgJiYgInVuZGVmaW5lZCIgIT0gdHlwZW9mIGdsb2JhbFRoaXMuZ2FtZWFuYWx5dGljcy5HYW1lQW5hbHl0aWNzID8gZ2xvYmFsVGhpcy5nYW1lYW5hbHl0aWNzLkdhbWVBbmFseXRpY3Muc2V0Q3VzdG9tRGltZW5zaW9uMDIoYSkgOiBjb25zb2xlLmxvZygic2V0Q3VzdG9tRGltZW5zaW9uMDI6IEdhbWVBbmFseXRpY3Mgb2JqZWN0IG5vdCBmb3VuZCIpCiAgICB9LAogICAgc2V0Q3VzdG9tRGltZW5zaW9uMDMoYSkgewogICAgICAgICJ1bmRlZmluZWQiICE9PSB0eXBlb2YgZ2xvYmFsVGhpcy5HYW1lQW5hbHl0aWNzICYmICJmdW5jdGlvbiIgPT0gdHlwZW9mIGdsb2JhbFRoaXMuR2FtZUFuYWx5dGljcy5zZXRDdXN0b21EaW1lbnNpb24wMyA/IGdsb2JhbFRoaXMuR2FtZUFuYWx5dGljcy5zZXRDdXN0b21EaW1lbnNpb24wMyhhKSA6ICJ1bmRlZmluZWQiICE9PSB0eXBlb2YgZ2xvYmFsVGhpcy5nYW1lYW5hbHl0aWNzICYmCiAgICAgICAgICAgICJ1bmRlZmluZWQiICE9IHR5cGVvZiBnbG9iYWxUaGlzLmdhbWVhbmFseXRpY3MuR2FtZUFuYWx5dGljcyA/IGdsb2JhbFRoaXMuZ2FtZWFuYWx5dGljcy5HYW1lQW5hbHl0aWNzLnNldEN1c3RvbURpbWVuc2lvbjAzKGEpIDogY29uc29sZS5sb2coInNldEN1c3RvbURpbWVuc2lvbjAzOiBHYW1lQW5hbHl0aWNzIG9iamVjdCBub3QgZm91bmQiKQogICAgfSwKICAgIHN0YXJ0U2Vzc2lvbigpIHsKICAgICAgICAidW5kZWZpbmVkIiAhPT0gdHlwZW9mIGdsb2JhbFRoaXMuR2FtZUFuYWx5dGljcyAmJiAiZnVuY3Rpb24iID09IHR5cGVvZiBnbG9iYWxUaGlzLkdhbWVBbmFseXRpY3Muc3RhcnRTZXNzaW9uID8gZ2xvYmFsVGhpcy5HYW1lQW5hbHl0aWNzLnN0YXJ0U2Vzc2lvbigpIDogInVuZGVmaW5lZCIgIT09IHR5cGVvZiBnbG9iYWxUaGlzLmdhbWVhbmFseXRpY3MgJiYgInVuZGVmaW5lZCIgIT0gdHlwZW9mIGdsb2JhbFRoaXMuZ2FtZWFuYWx5dGljcy5HYW1lQW5hbHl0aWNzID8gZ2xvYmFsVGhpcy5nYW1lYW5hbHl0aWNzLkdhbWVBbmFseXRpY3Muc3RhcnRTZXNzaW9uKCkgOgogICAgICAgICAgICBjb25zb2xlLmxvZygic3RhcnRTZXNzaW9uOiBHYW1lQW5hbHl0aWNzIG9iamVjdCBub3QgZm91bmQiKQogICAgfSwKICAgIGVuZFNlc3Npb24oKSB7CiAgICAgICAgInVuZGVmaW5lZCIgIT09IHR5cGVvZiBnbG9iYWxUaGlzLkdhbWVBbmFseXRpY3MgJiYgImZ1bmN0aW9uIiA9PSB0eXBlb2YgZ2xvYmFsVGhpcy5HYW1lQW5hbHl0aWNzLmVuZFNlc3Npb24gPyBnbG9iYWxUaGlzLkdhbWVBbmFseXRpY3MuZW5kU2Vzc2lvbigpIDogInVuZGVmaW5lZCIgIT09IHR5cGVvZiBnbG9iYWxUaGlzLmdhbWVhbmFseXRpY3MgJiYgInVuZGVmaW5lZCIgIT0gdHlwZW9mIGdsb2JhbFRoaXMuZ2FtZWFuYWx5dGljcy5HYW1lQW5hbHl0aWNzID8gZ2xvYmFsVGhpcy5nYW1lYW5hbHl0aWNzLkdhbWVBbmFseXRpY3MuZW5kU2Vzc2lvbigpIDogY29uc29sZS5sb2coImVuZFNlc3Npb246IEdhbWVBbmFseXRpY3Mgb2JqZWN0IG5vdCBmb3VuZCIpCiAgICB9LAogICAgY29uZmlndXJlQnVpbGQoYSkgewogICAgICAgIHRoaXMuX2J1aWxkID0gYQogICAgfQp9OwoidXNlIHN0cmljdCI7CkMzLlBsdWdpbnMuR2FtZUFuYWx5dGljcy5FeHBzID0gewogICAgZ2V0UmVtb3RlQ29uZmlnc1ZhbHVlQXNTdHJpbmcoYSwgYiwgZCkgewogICAgICAgIGlmICgidW5kZWZpbmVkIiAhPT0gdHlwZW9mIGdsb2JhbFRoaXMuR2FtZUFuYWx5dGljcyAmJiAiZnVuY3Rpb24iID09IHR5cGVvZiBnbG9iYWxUaGlzLkdhbWVBbmFseXRpY3MuZ2V0UmVtb3RlQ29uZmlnc1ZhbHVlQXNTdHJpbmcpIHJldHVybiBnbG9iYWxUaGlzLkdhbWVBbmFseXRpY3MuZ2V0UmVtb3RlQ29uZmlnc1ZhbHVlQXNTdHJpbmcoewogICAgICAgICAgICBrZXk6IGEsCiAgICAgICAgICAgIGRlZmF1bHRWYWx1ZTogYgogICAgICAgIH0sIGZ1bmN0aW9uKGMpIHsKICAgICAgICAgICAgZCAmJiBnbG9iYWxUaGlzLmMyX2NhbGxGdW5jdGlvbiAmJiBnbG9iYWxUaGlzLmMyX2NhbGxGdW5jdGlvbihkLCBbY10pCiAgICAgICAgfSksICIiOwogICAgICAgIGlmICgidW5kZWZpbmVkIiAhPT0gdHlwZW9mIGdsb2JhbFRoaXMuZ2FtZWFuYWx5dGljcyAmJiAidW5kZWZpbmVkIiAhPSB0eXBlb2YgZ2xvYmFsVGhpcy5nYW1lYW5hbHl0aWNzLkdhbWVBbmFseXRpY3MpIHJldHVybiBnbG9iYWxUaGlzLmdhbWVhbmFseXRpY3MuR2FtZUFuYWx5dGljcy5nZXRSZW1vdGVDb25maWdzVmFsdWVBc1N0cmluZyhhLAogICAgICAgICAgICBiKTsKICAgICAgICBjb25zb2xlLmxvZygiZ2V0UmVtb3RlQ29uZmlnc1ZhbHVlQXNTdHJpbmc6IEdhbWVBbmFseXRpY3Mgb2JqZWN0IG5vdCBmb3VuZCIpOwogICAgICAgIHJldHVybiAiIgogICAgfSwKICAgIGdldFJlbW90ZUNvbmZpZ3NDb250ZW50QXNTdHJpbmcoYSkgewogICAgICAgIGlmICgidW5kZWZpbmVkIiAhPT0gdHlwZW9mIGdsb2JhbFRoaXMuR2FtZUFuYWx5dGljcyAmJiAiZnVuY3Rpb24iID09IHR5cGVvZiBnbG9iYWxUaGlzLkdhbWVBbmFseXRpY3MuZ2V0UmVtb3RlQ29uZmlnc0NvbnRlbnRBc1N0cmluZykgcmV0dXJuIGdsb2JhbFRoaXMuR2FtZUFuYWx5dGljcy5nZXRSZW1vdGVDb25maWdzQ29udGVudEFzU3RyaW5nKGZ1bmN0aW9uKGIpIHsKICAgICAgICAgICAgYSAmJiBnbG9iYWxUaGlzLmMyX2NhbGxGdW5jdGlvbiAmJiBnbG9iYWxUaGlzLmMyX2NhbGxGdW5jdGlvbihhLCBbYl0pCiAgICAgICAgfSksICIiOwogICAgICAgIGlmICgidW5kZWZpbmVkIiAhPT0gdHlwZW9mIGdsb2JhbFRoaXMuZ2FtZWFuYWx5dGljcyAmJiAidW5kZWZpbmVkIiAhPSB0eXBlb2YgZ2xvYmFsVGhpcy5nYW1lYW5hbHl0aWNzLkdhbWVBbmFseXRpY3MpIHJldHVybiBnbG9iYWxUaGlzLmdhbWVhbmFseXRpY3MuR2FtZUFuYWx5dGljcy5nZXRSZW1vdGVDb25maWdzQ29udGVudEFzU3RyaW5nKCk7CiAgICAgICAgY29uc29sZS5sb2coImVuZFNlc3Npb246IEdhbWVBbmFseXRpY3Mgb2JqZWN0IG5vdCBmb3VuZCIpOwogICAgICAgIHJldHVybiAiIgogICAgfQp9OwoidXNlIHN0cmljdCI7CmNvbnN0IEMzJGpzY29tcCQyNDcgPSBzZWxmLkMzOwpDMyRqc2NvbXAkMjQ3LlBsdWdpbnMuQUpBWCA9IGNsYXNzIGV4dGVuZHMgQzMkanNjb21wJDI0Ny5TREtQbHVnaW5CYXNlIHsKICAgIGNvbnN0cnVjdG9yKGEpIHsKICAgICAgICBzdXBlcihhKQogICAgfQogICAgUmVsZWFzZSgpIHsKICAgICAgICBzdXBlci5SZWxlYXNlKCkKICAgIH0KfTsKY29uc3QgQzMkanNjb21wJDI0OCA9IHNlbGYuQzM7CkMzJGpzY29tcCQyNDguUGx1Z2lucy5BSkFYLlR5cGUgPSBjbGFzcyBleHRlbmRzIEMzJGpzY29tcCQyNDguU0RLVHlwZUJhc2UgewogICAgY29uc3RydWN0b3IoYSkgewogICAgICAgIHN1cGVyKGEpCiAgICB9CiAgICBSZWxlYXNlKCkgewogICAgICAgIHN1cGVyLlJlbGVhc2UoKQogICAgfQogICAgT25DcmVhdGUoKSB7fQp9Owpjb25zdCBDMyRqc2NvbXAkMjQ5ID0gc2VsZi5DMzsKQzMkanNjb21wJDI0OS5QbHVnaW5zLkFKQVguSW5zdGFuY2UgPSBjbGFzcyBleHRlbmRzIEMzJGpzY29tcCQyNDkuU0RLSW5zdGFuY2VCYXNlIHsKICAgIGNvbnN0cnVjdG9yKGEsIGIpIHsKICAgICAgICBzdXBlcihhKTsKICAgICAgICB0aGlzLl9jdXJUYWcgPSB0aGlzLl9sYXN0RGF0YSA9ICIiOwogICAgICAgIHRoaXMuX3Byb2dyZXNzID0gMDsKICAgICAgICB0aGlzLl90aW1lb3V0ID0gLTE7CiAgICAgICAgdGhpcy5fbmV4dFJlcXVlc3RIZWFkZXJzID0gbmV3IE1hcDsKICAgICAgICB0aGlzLl9uZXh0UmVwb25zZUJpbmFyeURhdGEgPSBudWxsOwogICAgICAgIHRoaXMuX25leHRSZXF1ZXN0T3ZlcnJpZGVNaW1lVHlwZSA9ICIiOwogICAgICAgIHRoaXMuX253anNBcHBGb2xkZXIgPSB0aGlzLl9ud2pzUGF0aCA9IHRoaXMuX253anNGcyA9IG51bGw7CiAgICAgICAgaWYgKHRoaXMuX2lzTldqcyA9ICJud2pzIiA9PT0gdGhpcy5fcnVudGltZS5HZXRFeHBvcnRUeXBlKCkpIHRoaXMuX253anNGcyA9IHJlcXVpcmUoImZzIiksIHRoaXMuX253anNQYXRoID0gcmVxdWlyZSgicGF0aCIpLCB0aGlzLl9ud2pzQXBwRm9sZGVyID0gdGhpcy5fbndqc1BhdGguZGlybmFtZSgoc2VsZi5wcm9jZXNzIHx8IG53LnByb2Nlc3MpLmV4ZWNQYXRoKSArCiAgICAgICAgICAgICJcXCIKICAgIH0KICAgIFJlbGVhc2UoKSB7CiAgICAgICAgc3VwZXIuUmVsZWFzZSgpCiAgICB9CiAgICBhc3luYyBfVHJpZ2dlckVycm9yKGEsIGIsIGQpIHsKICAgICAgICBjb25zb2xlLmVycm9yKGBbQ29uc3RydWN0XSBBSkFYIHJlcXVlc3QgdG8gJyR7Yn0nICh0YWcgJyR7YX0nKSBmYWlsZWQ6IGAsIGQpOwogICAgICAgIHRoaXMuX2N1clRhZyA9IGE7CiAgICAgICAgYXdhaXQgdGhpcy5UcmlnZ2VyQXN5bmMoQzMkanNjb21wJDI0OS5QbHVnaW5zLkFKQVguQ25kcy5PbkFueUVycm9yKTsKICAgICAgICB0aGlzLl9jdXJUYWcgPSBhOwogICAgICAgIGF3YWl0IHRoaXMuVHJpZ2dlckFzeW5jKEMzJGpzY29tcCQyNDkuUGx1Z2lucy5BSkFYLkNuZHMuT25FcnJvcikKICAgIH0KICAgIGFzeW5jIF9UcmlnZ2VyQ29tcGxldGUoYSkgewogICAgICAgIHRoaXMuX2N1clRhZyA9IGE7CiAgICAgICAgYXdhaXQgdGhpcy5UcmlnZ2VyQXN5bmMoQzMkanNjb21wJDI0OS5QbHVnaW5zLkFKQVguQ25kcy5PbkFueUNvbXBsZXRlKTsKICAgICAgICB0aGlzLl9jdXJUYWcgPSBhOwogICAgICAgIGF3YWl0IHRoaXMuVHJpZ2dlckFzeW5jKEMzJGpzY29tcCQyNDkuUGx1Z2lucy5BSkFYLkNuZHMuT25Db21wbGV0ZSkKICAgIH0KICAgIGFzeW5jIF9PblByb2dyZXNzKGEsCiAgICAgICAgYikgewogICAgICAgIGIubGVuZ3RoQ29tcHV0YWJsZSAmJiAodGhpcy5fcHJvZ3Jlc3MgPSBiLmxvYWRlZCAvIGIudG90YWwsIHRoaXMuX2N1clRhZyA9IGEsIGF3YWl0IHRoaXMuVHJpZ2dlckFzeW5jKEMzJGpzY29tcCQyNDkuUGx1Z2lucy5BSkFYLkNuZHMuT25Qcm9ncmVzcykpCiAgICB9CiAgICBfT25FcnJvcihhLCBiLCBkKSB7CiAgICAgICAgaWYgKHRoaXMuX2lzTldqcykgewogICAgICAgICAgICB2YXIgYyA9IHRoaXMuX253anNGcywKICAgICAgICAgICAgICAgIGUgPSB0aGlzLl9ud2pzQXBwRm9sZGVyICsgYjsKICAgICAgICAgICAgYy5leGlzdHNTeW5jKGUpID8gYy5yZWFkRmlsZShlLCB7CiAgICAgICAgICAgICAgICBlbmNvZGluZzogInV0ZjgiCiAgICAgICAgICAgIH0sIChnLCBrKSA9PiB7CiAgICAgICAgICAgICAgICBnID8gdGhpcy5fVHJpZ2dlckVycm9yKGEsIGIsIGcpIDogKHRoaXMuX2xhc3REYXRhID0gay5yZXBsYWNlKC9cclxuL2csICJcbiIpLCB0aGlzLl9UcmlnZ2VyQ29tcGxldGUoYSkpCiAgICAgICAgICAgIH0pIDogdGhpcy5fVHJpZ2dlckVycm9yKGEsIGIsIGQpCiAgICAgICAgfSBlbHNlIHRoaXMuX1RyaWdnZXJFcnJvcihhLCBiLCBkKQogICAgfQogICAgYXN5bmMgX0RvQ29yZG92YVJlcXVlc3QoYSwgYikgewogICAgICAgIGNvbnN0IGQgPSB0aGlzLl9ydW50aW1lLkdldEFzc2V0TWFuYWdlcigpLAogICAgICAgICAgICBjID0gdGhpcy5fbmV4dFJlcG9uc2VCaW5hcnlEYXRhOwogICAgICAgIHRoaXMuX25leHRSZXBvbnNlQmluYXJ5RGF0YSA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKGMpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGUgPSBhd2FpdCBkLkNvcmRvdmFGZXRjaExvY2FsRmlsZUFzQXJyYXlCdWZmZXIoYik7CiAgICAgICAgICAgICAgICBjLlNldEFycmF5QnVmZmVyVHJhbnNmZXIoZSk7CiAgICAgICAgICAgICAgICB0aGlzLl9sYXN0RGF0YSA9ICIiCiAgICAgICAgICAgIH0gZWxzZSB0aGlzLl9sYXN0RGF0YSA9IChhd2FpdCBkLkNvcmRvdmFGZXRjaExvY2FsRmlsZUFzVGV4dChiKSkucmVwbGFjZSgvXHJcbi9nLCAiXG4iKTsKICAgICAgICAgICAgdGhpcy5fVHJpZ2dlckNvbXBsZXRlKGEpCiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICB0aGlzLl9UcmlnZ2VyRXJyb3IoYSwgYiwgZSkKICAgICAgICB9CiAgICB9CiAgICBfRG9SZXF1ZXN0KGEsIGIsIGQsIGMpIHsKICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZSA9PiB7CiAgICAgICAgICAgIGNvbnN0IGcgPSBtID0+IHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9PbkVycm9yKGEsIGIsIG0pOwogICAgICAgICAgICAgICAgICAgIGUoKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGsgPSB0aGlzLl9uZXh0UmVwb25zZUJpbmFyeURhdGE7CiAgICAgICAgICAgIHRoaXMuX25leHRSZXBvbnNlQmluYXJ5RGF0YSA9IG51bGw7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBjb25zdCBtID0gbmV3IFhNTEh0dHBSZXF1ZXN0OwogICAgICAgICAgICAgICAgbS5vbnJlYWR5c3RhdGVjaGFuZ2UgPSAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKDQgPT09IG0ucmVhZHlTdGF0ZSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9sYXN0RGF0YSA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrID8gIiIgOiAobS5yZXNwb25zZVRleHQgfHwgIiIpLnJlcGxhY2UoL1xyXG4vZywgIlxuIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICg0MDAgPD0gbS5zdGF0dXMpIHRoaXMuX1RyaWdnZXJFcnJvcihhLCBiLCBtLnN0YXR1cyArIG0uc3RhdHVzVGV4dCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbiA9IHRoaXMuX2xhc3REYXRhLmxlbmd0aCB8fCBrICYmIG0ucmVzcG9uc2UgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlcjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2lzTldqcyAmJiAhbiB8fCAhdGhpcy5faXNOV2pzICYmIDAgPT09IG0uc3RhdHVzICYmICFuIHx8IChrICYmIGsuU2V0QXJyYXlCdWZmZXJUcmFuc2ZlcihtLnJlc3BvbnNlKSwgdGhpcy5fVHJpZ2dlckNvbXBsZXRlKGEpKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGUoKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBtLm9uZXJyb3IgPSBnOwogICAgICAgICAgICAgICAgbS5vbnRpbWVvdXQgPSBnOwogICAgICAgICAgICAgICAgbS5vbmFib3J0ID0gZzsKICAgICAgICAgICAgICAgIG0ub25wcm9ncmVzcyA9IG4gPT4gdGhpcy5fT25Qcm9ncmVzcyhhLCBuKTsKICAgICAgICAgICAgICAgIG0ub3BlbihkLCBiKTsKICAgICAgICAgICAgICAgIDAgPD0gdGhpcy5fdGltZW91dCAmJiAidW5kZWZpbmVkIiAhPT0gdHlwZW9mIG0udGltZW91dCAmJiAobS50aW1lb3V0ID0gdGhpcy5fdGltZW91dCk7CiAgICAgICAgICAgICAgICBtLnJlc3BvbnNlVHlwZSA9IGsgPyAiYXJyYXlidWZmZXIiIDoKICAgICAgICAgICAgICAgICAgICAidGV4dCI7CiAgICAgICAgICAgICAgICBjICYmICF0aGlzLl9uZXh0UmVxdWVzdEhlYWRlcnMuaGFzKCJDb250ZW50LVR5cGUiKSAmJiAoInN0cmluZyIgIT09IHR5cGVvZiBjID8gbS5zZXRSZXF1ZXN0SGVhZGVyKCJDb250ZW50LVR5cGUiLCAiYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtIikgOiBtLnNldFJlcXVlc3RIZWFkZXIoIkNvbnRlbnQtVHlwZSIsICJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiKSk7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IFtuLCBxXSBvZiB0aGlzLl9uZXh0UmVxdWVzdEhlYWRlcnMpIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgbS5zZXRSZXF1ZXN0SGVhZGVyKG4sIHEpCiAgICAgICAgICAgICAgICB9IGNhdGNoICh1KSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihgW0NvbnN0cnVjdF0gQUpBWDogRmFpbGVkIHRvIHNldCBoZWFkZXIgJyR7bn06ICR7cX0nOiBgLCB1KQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5fbmV4dFJlcXVlc3RIZWFkZXJzLmNsZWFyKCk7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fbmV4dFJlcXVlc3RPdmVycmlkZU1pbWVUeXBlKSB7CiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgbS5vdmVycmlkZU1pbWVUeXBlKHRoaXMuX25leHRSZXF1ZXN0T3ZlcnJpZGVNaW1lVHlwZSkKICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChuKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIltDb25zdHJ1Y3RdIEFKQVg6IGZhaWxlZCB0byBvdmVycmlkZSBNSU1FIHR5cGU6ICIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9uZXh0UmVxdWVzdE92ZXJyaWRlTWltZVR5cGUgPSAiIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYyA/IG0uc2VuZChjKSA6IG0uc2VuZCgpCiAgICAgICAgICAgIH0gY2F0Y2ggKG0pIHsKICAgICAgICAgICAgICAgIGcobSkKICAgICAgICAgICAgfQogICAgICAgIH0pCiAgICB9CiAgICBHZXREZWJ1Z2dlclByb3BlcnRpZXMoKSB7CiAgICAgICAgcmV0dXJuIFt7CiAgICAgICAgICAgIHRpdGxlOiAicGx1Z2lucy5hamF4LmRlYnVnZ2VyLnRpdGxlIiwKICAgICAgICAgICAgcHJvcGVydGllczogW3sKICAgICAgICAgICAgICAgIG5hbWU6ICJwbHVnaW5zLmFqYXguZGVidWdnZXIubGFzdC1kYXRhIiwKICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLl9sYXN0RGF0YQogICAgICAgICAgICB9XQogICAgICAgIH1dCiAgICB9CiAgICBTYXZlVG9Kc29uKCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGxhc3REYXRhOiB0aGlzLl9sYXN0RGF0YQogICAgICAgIH0KICAgIH0KICAgIExvYWRGcm9tSnNvbihhKSB7CiAgICAgICAgdGhpcy5fbGFzdERhdGEgPSBhLmxhc3REYXRhOwogICAgICAgIHRoaXMuX2N1clRhZyA9ICIiOwogICAgICAgIHRoaXMuX3Byb2dyZXNzID0gMAogICAgfQp9Owpjb25zdCBDMyRqc2NvbXAkMjUwID0gc2VsZi5DMzsKQzMkanNjb21wJDI1MC5QbHVnaW5zLkFKQVguQ25kcyA9IHsKICAgIE9uQ29tcGxldGUoYSkgewogICAgICAgIHJldHVybiBDMyRqc2NvbXAkMjUwLmVxdWFsc05vQ2FzZSh0aGlzLl9jdXJUYWcsIGEpCiAgICB9LAogICAgT25BbnlDb21wbGV0ZSgpIHsKICAgICAgICByZXR1cm4gITAKICAgIH0sCiAgICBPbkVycm9yKGEpIHsKICAgICAgICByZXR1cm4gQzMkanNjb21wJDI1MC5lcXVhbHNOb0Nhc2UodGhpcy5fY3VyVGFnLCBhKQogICAgfSwKICAgIE9uQW55RXJyb3IoKSB7CiAgICAgICAgcmV0dXJuICEwCiAgICB9LAogICAgT25Qcm9ncmVzcyhhKSB7CiAgICAgICAgcmV0dXJuIEMzJGpzY29tcCQyNTAuZXF1YWxzTm9DYXNlKHRoaXMuX2N1clRhZywgYSkKICAgIH0KfTsKY29uc3QgQzMkanNjb21wJDI1MSA9IHNlbGYuQzM7CkMzJGpzY29tcCQyNTEuUGx1Z2lucy5BSkFYLkFjdHMgPSB7CiAgICBhc3luYyBSZXF1ZXN0KGEsIGIpIHsKICAgICAgICB0aGlzLl9ydW50aW1lLklzQ29yZG92YSgpICYmIEMzJGpzY29tcCQyNTEuSXNSZWxhdGl2ZVVSTChiKSAmJiB0aGlzLl9ydW50aW1lLkdldEFzc2V0TWFuYWdlcigpLklzRmlsZVByb3RvY29sKCkgPyBhd2FpdCB0aGlzLl9Eb0NvcmRvdmFSZXF1ZXN0KGEsIGIpIDogdGhpcy5fcnVudGltZS5Jc1ByZXZpZXcoKSAmJiBDMyRqc2NvbXAkMjUxLklzUmVsYXRpdmVVUkwoYikgPyAoYiA9IHRoaXMuX3J1bnRpbWUuR2V0QXNzZXRNYW5hZ2VyKCkuR2V0TG9jYWxVcmxBc0Jsb2JVcmwoYiksIGF3YWl0IHRoaXMuX0RvUmVxdWVzdChhLCBiLCAiR0VUIiwgbnVsbCkpIDogYXdhaXQgdGhpcy5fRG9SZXF1ZXN0KGEsIGIsICJHRVQiLCBudWxsKQogICAgfSwKICAgIGFzeW5jIFJlcXVlc3RGaWxlKGEsIGIpIHsKICAgICAgICB0aGlzLl9ydW50aW1lLklzQ29yZG92YSgpICYmIHRoaXMuX3J1bnRpbWUuR2V0QXNzZXRNYW5hZ2VyKCkuSXNGaWxlUHJvdG9jb2woKSA/IGF3YWl0IHRoaXMuX0RvQ29yZG92YVJlcXVlc3QoYSwKICAgICAgICAgICAgYikgOiBhd2FpdCB0aGlzLl9Eb1JlcXVlc3QoYSwgdGhpcy5fcnVudGltZS5HZXRBc3NldE1hbmFnZXIoKS5HZXRMb2NhbFVybEFzQmxvYlVybChiKSwgIkdFVCIsIG51bGwpCiAgICB9LAogICAgYXN5bmMgUG9zdChhLCBiLCBkLCBjKSB7CiAgICAgICAgYXdhaXQgdGhpcy5fRG9SZXF1ZXN0KGEsIGIsIGMsIGQpCiAgICB9LAogICAgYXN5bmMgUG9zdEJpbmFyeShhLCBiLCBkLCBjKSB7CiAgICAgICAgZCAmJiAoZCA9IGQuR2V0Rmlyc3RQaWNrZWQodGhpcy5faW5zdCkpICYmIChkID0gZC5HZXRTZGtJbnN0YW5jZSgpLkdldEFycmF5QnVmZmVyUmVhZE9ubHkoKSwgYXdhaXQgdGhpcy5fRG9SZXF1ZXN0KGEsIGIsIGMsIGQpKQogICAgfSwKICAgIFNldFRpbWVvdXQoYSkgewogICAgICAgIHRoaXMuX3RpbWVvdXQgPSAxRTMgKiBhCiAgICB9LAogICAgU2V0SGVhZGVyKGEsIGIpIHsKICAgICAgICB0aGlzLl9uZXh0UmVxdWVzdEhlYWRlcnMuc2V0KGEsIGIpCiAgICB9LAogICAgU2V0UmVzcG9uc2VCaW5hcnkoYSkgewogICAgICAgIGEgJiYgKGEgPSBhLkdldEZpcnN0UGlja2VkKHRoaXMuX2luc3QpKSAmJiAodGhpcy5fbmV4dFJlcG9uc2VCaW5hcnlEYXRhID0gYS5HZXRTZGtJbnN0YW5jZSgpKQogICAgfSwKICAgIE92ZXJyaWRlTUlNRVR5cGUoYSkgewogICAgICAgIHRoaXMuX25leHRSZXF1ZXN0T3ZlcnJpZGVNaW1lVHlwZSA9CiAgICAgICAgICAgIGEKICAgIH0KfTsKc2VsZi5DMy5QbHVnaW5zLkFKQVguRXhwcyA9IHsKICAgIExhc3REYXRhKCkgewogICAgICAgIHJldHVybiB0aGlzLl9sYXN0RGF0YQogICAgfSwKICAgIFByb2dyZXNzKCkgewogICAgICAgIHJldHVybiB0aGlzLl9wcm9ncmVzcwogICAgfSwKICAgIFRhZygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fY3VyVGFnCiAgICB9Cn07CiJ1c2Ugc3RyaWN0IjsKY29uc3QgQzMkanNjb21wJDI1MyA9IHNlbGYuQzM7CkMzJGpzY29tcCQyNTMuUGx1Z2lucy5EaWN0aW9uYXJ5ID0gY2xhc3MgZXh0ZW5kcyBDMyRqc2NvbXAkMjUzLlNES1BsdWdpbkJhc2UgewogICAgY29uc3RydWN0b3IoYSkgewogICAgICAgIHN1cGVyKGEpCiAgICB9CiAgICBSZWxlYXNlKCkgewogICAgICAgIHN1cGVyLlJlbGVhc2UoKQogICAgfQp9Owpjb25zdCBDMyRqc2NvbXAkMjU0ID0gc2VsZi5DMzsKQzMkanNjb21wJDI1NC5QbHVnaW5zLkRpY3Rpb25hcnkuVHlwZSA9IGNsYXNzIGV4dGVuZHMgQzMkanNjb21wJDI1NC5TREtUeXBlQmFzZSB7CiAgICBjb25zdHJ1Y3RvcihhKSB7CiAgICAgICAgc3VwZXIoYSkKICAgIH0KICAgIFJlbGVhc2UoKSB7CiAgICAgICAgc3VwZXIuUmVsZWFzZSgpCiAgICB9CiAgICBPbkNyZWF0ZSgpIHt9Cn07CmNvbnN0IEMzJGpzY29tcCQyNTUgPSBzZWxmLkMzLAogICAgSUluc3RhbmNlJGpzY29tcCQ0ID0gc2VsZi5JSW5zdGFuY2U7CkMzJGpzY29tcCQyNTUuUGx1Z2lucy5EaWN0aW9uYXJ5Lkluc3RhbmNlID0gY2xhc3MgZXh0ZW5kcyBDMyRqc2NvbXAkMjU1LlNES0luc3RhbmNlQmFzZSB7CiAgICBjb25zdHJ1Y3RvcihhLCBiKSB7CiAgICAgICAgc3VwZXIoYSk7CiAgICAgICAgdGhpcy5fZGF0YSA9IG5ldyBNYXA7CiAgICAgICAgdGhpcy5fY3VyS2V5ID0gIiIKICAgIH0KICAgIFJlbGVhc2UoKSB7CiAgICAgICAgdGhpcy5fZGF0YS5jbGVhcigpOwogICAgICAgIHN1cGVyLlJlbGVhc2UoKQogICAgfQogICAgR2V0QXNKc29uU3RyaW5nKCkgewogICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeSh7CiAgICAgICAgICAgIGMyZGljdGlvbmFyeTogITAsCiAgICAgICAgICAgIGRhdGE6IEMzJGpzY29tcCQyNTUuTWFwVG9PYmplY3QodGhpcy5fZGF0YSkKICAgICAgICB9KQogICAgfQogICAgR2V0RGF0YU1hcCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZGF0YQogICAgfQogICAgU2F2ZVRvSnNvbigpIHsKICAgICAgICByZXR1cm4gQzMkanNjb21wJDI1NS5NYXBUb09iamVjdCh0aGlzLl9kYXRhKQogICAgfQogICAgTG9hZEZyb21Kc29uKGEpIHsKICAgICAgICBDMyRqc2NvbXAkMjU1Lk9iamVjdFRvTWFwKGEsIHRoaXMuX2RhdGEpCiAgICB9CiAgICBHZXREZWJ1Z2dlclByb3BlcnRpZXMoKSB7CiAgICAgICAgcmV0dXJuIFt7CiAgICAgICAgICAgIHRpdGxlOiAicGx1Z2lucy5kaWN0aW9uYXJ5Lm5hbWUiLAogICAgICAgICAgICBwcm9wZXJ0aWVzOiBbewogICAgICAgICAgICAgICAgbmFtZTogInBsdWdpbnMuZGljdGlvbmFyeS5kZWJ1Z2dlci5rZXktY291bnQiLAogICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuX2RhdGEuc2l6ZQogICAgICAgICAgICB9LCAuLi5bLi4udGhpcy5fZGF0YV0ubWFwKGEgPT4gKHsKICAgICAgICAgICAgICAgIG5hbWU6ICIkIiArIGFbMF0sCiAgICAgICAgICAgICAgICB2YWx1ZTogYVsxXSwKICAgICAgICAgICAgICAgIG9uZWRpdDogYiA9PiB0aGlzLl9kYXRhLnNldChhWzBdLCBiKQogICAgICAgICAgICB9KSldCiAgICAgICAgfV0KICAgIH0KICAgIEdldFNjcmlwdEludGVyZmFjZUNsYXNzKCkgewogICAgICAgIHJldHVybiBzZWxmLklEaWN0aW9uYXJ5SW5zdGFuY2UKICAgIH0KfTsKY29uc3QgbWFwJGpzY29tcCQyNCA9IG5ldyBXZWFrTWFwOwpzZWxmLklEaWN0aW9uYXJ5SW5zdGFuY2UgPSBjbGFzcyBleHRlbmRzIElJbnN0YW5jZSRqc2NvbXAkNCB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgICBzdXBlcigpOwogICAgICAgIG1hcCRqc2NvbXAkMjQuc2V0KHRoaXMsIElJbnN0YW5jZSRqc2NvbXAkNC5fR2V0SW5pdEluc3QoKS5HZXRTZGtJbnN0YW5jZSgpKQogICAgfQogICAgZ2V0RGF0YU1hcCgpIHsKICAgICAgICByZXR1cm4gbWFwJGpzY29tcCQyNC5nZXQodGhpcykuR2V0RGF0YU1hcCgpCiAgICB9Cn07CmNvbnN0IEMzJGpzY29tcCQyNTYgPSBzZWxmLkMzOwpDMyRqc2NvbXAkMjU2LlBsdWdpbnMuRGljdGlvbmFyeS5DbmRzID0gewogICAgQ29tcGFyZVZhbHVlKGEsIGIsIGQpIHsKICAgICAgICBhID0gdGhpcy5fZGF0YS5nZXQoYSk7CiAgICAgICAgcmV0dXJuICJ1bmRlZmluZWQiID09PSB0eXBlb2YgYSA/ICExIDogQzMkanNjb21wJDI1Ni5jb21wYXJlKGEsIGIsIGQpCiAgICB9LAogICAgRm9yRWFjaEtleSgpIHsKICAgICAgICBjb25zdCBhID0gdGhpcy5fcnVudGltZSwKICAgICAgICAgICAgYiA9IGEuR2V0RXZlbnRTaGVldE1hbmFnZXIoKSwKICAgICAgICAgICAgZCA9IGEuR2V0Q3VycmVudEV2ZW50KCksCiAgICAgICAgICAgIGMgPSBkLkdldFNvbE1vZGlmaWVycygpLAogICAgICAgICAgICBlID0gYS5HZXRFdmVudFN0YWNrKCksCiAgICAgICAgICAgIGcgPSBlLkdldEN1cnJlbnRTdGFja0ZyYW1lKCksCiAgICAgICAgICAgIGsgPSBlLlB1c2goZCk7CiAgICAgICAgYS5TZXREZWJ1Z2dpbmdFbmFibGVkKCExKTsKICAgICAgICBmb3IgKGNvbnN0IG0gb2YgdGhpcy5fZGF0YS5rZXlzKCkpIHRoaXMuX2N1cktleSA9IG0sIGIuUHVzaENvcHlTb2woYyksIGQuUmV0cmlnZ2VyKGcsIGspLCBiLlBvcFNvbChjKTsKICAgICAgICBhLlNldERlYnVnZ2luZ0VuYWJsZWQoITApOwogICAgICAgIHRoaXMuX2N1cktleSA9ICIiOwogICAgICAgIGUuUG9wKCk7CiAgICAgICAgcmV0dXJuICExCiAgICB9LAogICAgQ29tcGFyZUN1cnJlbnRWYWx1ZShhLAogICAgICAgIGIpIHsKICAgICAgICBjb25zdCBkID0gdGhpcy5fZGF0YS5nZXQodGhpcy5fY3VyS2V5KTsKICAgICAgICByZXR1cm4gInVuZGVmaW5lZCIgPT09IHR5cGVvZiBkID8gITEgOiBDMyRqc2NvbXAkMjU2LmNvbXBhcmUoZCwgYSwgYikKICAgIH0sCiAgICBIYXNLZXkoYSkgewogICAgICAgIHJldHVybiB0aGlzLl9kYXRhLmhhcyhhKQogICAgfSwKICAgIElzRW1wdHkoKSB7CiAgICAgICAgcmV0dXJuIDAgPT09IHRoaXMuX2RhdGEuc2l6ZQogICAgfQp9Owpjb25zdCBDMyRqc2NvbXAkMjU3ID0gc2VsZi5DMzsKQzMkanNjb21wJDI1Ny5QbHVnaW5zLkRpY3Rpb25hcnkuQWN0cyA9IHsKICAgIEFkZEtleShhLCBiKSB7CiAgICAgICAgdGhpcy5fZGF0YS5zZXQoYSwgYikKICAgIH0sCiAgICBTZXRLZXkoYSwgYikgewogICAgICAgIHRoaXMuX2RhdGEuaGFzKGEpICYmIHRoaXMuX2RhdGEuc2V0KGEsIGIpCiAgICB9LAogICAgRGVsZXRlS2V5KGEpIHsKICAgICAgICB0aGlzLl9kYXRhLmRlbGV0ZShhKQogICAgfSwKICAgIENsZWFyKCkgewogICAgICAgIHRoaXMuX2RhdGEuY2xlYXIoKQogICAgfSwKICAgIEpTT05Mb2FkKGEpIHsKICAgICAgICBsZXQgYiA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYiA9IEpTT04ucGFyc2UoYSkKICAgICAgICB9IGNhdGNoIChkKSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIltDb25zdHJ1Y3RdIEVycm9yIHBhcnNpbmcgSlNPTjogIiwgZCk7CiAgICAgICAgICAgIHJldHVybgogICAgICAgIH0KICAgICAgICBiLmMyZGljdGlvbmFyeSAmJiBDMyRqc2NvbXAkMjU3Lk9iamVjdFRvTWFwKGIuZGF0YSwgdGhpcy5fZGF0YSkKICAgIH0sCiAgICBKU09ORG93bmxvYWQoYSkgewogICAgICAgIGNvbnN0IGIgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKG5ldyBCbG9iKFt0aGlzLkdldEFzSnNvblN0cmluZygpXSwgewogICAgICAgICAgICB0eXBlOiAiYXBwbGljYXRpb24vanNvbiIKICAgICAgICB9KSk7CiAgICAgICAgdGhpcy5fcnVudGltZS5JbnZva2VEb3dubG9hZChiLCBhKQogICAgfQp9OwpzZWxmLkMzLlBsdWdpbnMuRGljdGlvbmFyeS5FeHBzID0gewogICAgR2V0KGEpIHsKICAgICAgICBhID0gdGhpcy5fZGF0YS5nZXQoYSk7CiAgICAgICAgcmV0dXJuICJ1bmRlZmluZWQiID09PSB0eXBlb2YgYSA/IDAgOiBhCiAgICB9LAogICAgR2V0RGVmYXVsdChhLCBiKSB7CiAgICAgICAgYSA9IHRoaXMuX2RhdGEuZ2V0KGEpOwogICAgICAgIHJldHVybiAidW5kZWZpbmVkIiA9PT0gdHlwZW9mIGEgPyBiIDogYQogICAgfSwKICAgIEtleUNvdW50KCkgewogICAgICAgIHJldHVybiB0aGlzLl9kYXRhLnNpemUKICAgIH0sCiAgICBDdXJyZW50S2V5KCkgewogICAgICAgIHJldHVybiB0aGlzLl9jdXJLZXkKICAgIH0sCiAgICBDdXJyZW50VmFsdWUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2RhdGEuZ2V0KHRoaXMuX2N1cktleSkgfHwgMAogICAgfSwKICAgIEFzSlNPTigpIHsKICAgICAgICByZXR1cm4gdGhpcy5HZXRBc0pzb25TdHJpbmcoKQogICAgfQp9OwoidXNlIHN0cmljdCI7CmNvbnN0IEMzJGpzY29tcCQyNTkgPSBzZWxmLkMzOwpDMyRqc2NvbXAkMjU5LlBsdWdpbnMuc2t5bWVuX1JlbW92ZVNlcnZpY2VXb3JrZXIgPSBjbGFzcyBleHRlbmRzIEMzJGpzY29tcCQyNTkuU0RLUGx1Z2luQmFzZSB7CiAgICBjb25zdHJ1Y3RvcihhKSB7CiAgICAgICAgc3VwZXIoYSkKICAgIH0KICAgIFJlbGVhc2UoKSB7CiAgICAgICAgc3VwZXIuUmVsZWFzZSgpCiAgICB9Cn07CiJ1c2Ugc3RyaWN0IjsKY29uc3QgQzMkanNjb21wJDI2MCA9IHNlbGYuQzM7CkMzJGpzY29tcCQyNjAuUGx1Z2lucy5za3ltZW5fUmVtb3ZlU2VydmljZVdvcmtlci5UeXBlID0gY2xhc3MgZXh0ZW5kcyBDMyRqc2NvbXAkMjYwLlNES1R5cGVCYXNlIHsKICAgIGNvbnN0cnVjdG9yKGEpIHsKICAgICAgICBzdXBlcihhKQogICAgfQogICAgUmVsZWFzZSgpIHsKICAgICAgICBzdXBlci5SZWxlYXNlKCkKICAgIH0KICAgIE9uQ3JlYXRlKCkge30KfTsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkMjYxID0gc2VsZi5DMzsKQzMkanNjb21wJDI2MS5QbHVnaW5zLnNreW1lbl9SZW1vdmVTZXJ2aWNlV29ya2VyLkluc3RhbmNlID0gY2xhc3MgZXh0ZW5kcyBDMyRqc2NvbXAkMjYxLlNES0luc3RhbmNlQmFzZSB7CiAgICBjb25zdHJ1Y3RvcihhLCBiKSB7CiAgICAgICAgc3VwZXIoYSkKICAgIH0KICAgIFJlbGVhc2UoKSB7CiAgICAgICAgc3VwZXIuUmVsZWFzZSgpCiAgICB9CiAgICBTYXZlVG9Kc29uKCkgewogICAgICAgIHJldHVybiB7fQogICAgfQogICAgTG9hZEZyb21Kc29uKGEpIHt9CiAgICBHZXREZWJ1Z2dlclByb3BlcnRpZXMoKSB7CiAgICAgICAgcmV0dXJuIFt7CiAgICAgICAgICAgIHRpdGxlOiAiUmVtb3ZlU2VydmljZVdvcmtlciIsCiAgICAgICAgICAgIHByb3BlcnRpZXM6IFtdCiAgICAgICAgfV0KICAgIH0KICAgIEdldFByb3BlcnR5VmFsdWVCeUluZGV4KGEpIHsKICAgICAgICByZXR1cm4gMAogICAgfQogICAgU2V0UHJvcGVydHlWYWx1ZUJ5SW5kZXgoYSwgYikge30KfTsKInVzZSBzdHJpY3QiOwpzZWxmLkMzLlBsdWdpbnMuc2t5bWVuX1JlbW92ZVNlcnZpY2VXb3JrZXIuQ25kcyA9IHt9OwoidXNlIHN0cmljdCI7CnNlbGYuQzMuUGx1Z2lucy5za3ltZW5fUmVtb3ZlU2VydmljZVdvcmtlci5BY3RzID0ge307CiJ1c2Ugc3RyaWN0IjsKc2VsZi5DMy5QbHVnaW5zLnNreW1lbl9SZW1vdmVTZXJ2aWNlV29ya2VyLkV4cHMgPSB7fTsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkMjYyID0gc2VsZi5DMzsKQzMkanNjb21wJDI2Mi5CZWhhdmlvcnMuVHdlZW4gPSBjbGFzcyBleHRlbmRzIEMzJGpzY29tcCQyNjIuU0RLQmVoYXZpb3JCYXNlIHsKICAgIGNvbnN0cnVjdG9yKGEpIHsKICAgICAgICBzdXBlcihhKQogICAgfQogICAgUmVsZWFzZSgpIHsKICAgICAgICBzdXBlci5SZWxlYXNlKCkKICAgIH0KfTsKY29uc3QgQzMkanNjb21wJDI2MyA9IHNlbGYuQzM7CkMzJGpzY29tcCQyNjMuQmVoYXZpb3JzLlR3ZWVuLlR5cGUgPSBjbGFzcyBleHRlbmRzIEMzJGpzY29tcCQyNjMuU0RLQmVoYXZpb3JUeXBlQmFzZSB7CiAgICBjb25zdHJ1Y3RvcihhKSB7CiAgICAgICAgc3VwZXIoYSkKICAgIH0KICAgIFJlbGVhc2UoKSB7CiAgICAgICAgc3VwZXIuUmVsZWFzZSgpCiAgICB9CiAgICBPbkNyZWF0ZSgpIHt9Cn07CmNvbnN0IEMzJGpzY29tcCQyNjQgPSBzZWxmLkMzLAogICAgTkFNRVNQQUNFID0gQzMkanNjb21wJDI2NC5CZWhhdmlvcnMuVHdlZW47Ck5BTUVTUEFDRS5JbnN0YW5jZSA9IGNsYXNzIGV4dGVuZHMgQzMkanNjb21wJDI2NC5TREtCZWhhdmlvckluc3RhbmNlQmFzZSB7CiAgICBjb25zdHJ1Y3RvcihhLCBiKSB7CiAgICAgICAgc3VwZXIoYSk7CiAgICAgICAgdGhpcy5fYWxsb3dNdWx0aXBsZSA9ICExOwogICAgICAgIHRoaXMuX2VuYWJsZWQgPSAhMDsKICAgICAgICBiICYmICh0aGlzLl9hbGxvd011bHRpcGxlID0gITEsIHRoaXMuX2VuYWJsZWQgPSAhIWJbMF0pOwogICAgICAgIHRoaXMuX2FjdGl2ZVR3ZWVucyA9IG5ldyBNYXA7CiAgICAgICAgdGhpcy5fZGlzYWJsZWRUd2VlbnMgPSBbXTsKICAgICAgICB0aGlzLl93YWl0aW5nRm9yUmVsZWFzZVR3ZWVucyA9IG5ldyBNYXA7CiAgICAgICAgdGhpcy5fd2FpdGluZ0ZvclJlbGVhc2VUd2VlbnNKc29uID0gdGhpcy5fZGlzYWJsZWRUd2VlbnNKc29uID0gdGhpcy5fYWN0aXZlVHdlZW5zSnNvbiA9IHRoaXMuX2ZpbmlzaGluZ1R3ZWVuID0gbnVsbDsKICAgICAgICB0aGlzLl9maW5pc2hpbmdUd2Vlbk5hbWUgPSAiIjsKICAgICAgICB0aGlzLl9lbmFibGVkICYmIHRoaXMuX1N0YXJ0VGlja2luZzIoKTsKICAgICAgICB0aGlzLl9hZnRlckxvYWQgPSBkID0+IHRoaXMuX09uQWZ0ZXJMb2FkKGQpOwogICAgICAgIHRoaXMuR2V0UnVudGltZSgpLkRpc3BhdGNoZXIoKS5hZGRFdmVudExpc3RlbmVyKCJhZnRlcmxvYWQiLAogICAgICAgICAgICB0aGlzLl9hZnRlckxvYWQpCiAgICB9CiAgICBSZWxlYXNlKCkgewogICAgICAgIHRoaXMuR2V0UnVudGltZSgpLkRpc3BhdGNoZXIoKS5yZW1vdmVFdmVudExpc3RlbmVyKCJhZnRlcmxvYWQiLCB0aGlzLl9hZnRlckxvYWQpOwogICAgICAgIHRoaXMuX2FmdGVyTG9hZCA9IG51bGw7CiAgICAgICAgdGhpcy5fZmluaXNoaW5nVHdlZW4gJiYgKHRoaXMuUmVsZWFzZUFuZENvbXBsZXRlVHdlZW4odGhpcy5fZmluaXNoaW5nVHdlZW4pLCB0aGlzLl9maW5pc2hpbmdUd2VlbiA9IG51bGwpOwogICAgICAgIHRoaXMuUmVsZWFzZUFuZENvbXBsZXRlVHdlZW5zKCk7CiAgICAgICAgdGhpcy5fdHdlZW5zID0gbnVsbDsKICAgICAgICB0aGlzLkNsZWFyRGlzYWJsZWRMaXN0KCk7CiAgICAgICAgdGhpcy5fZGlzYWJsZWRUd2VlbnMgPSBudWxsOwogICAgICAgIHRoaXMuX1JlbGVhc2VXYWl0aW5nVHdlZW5zKCk7CiAgICAgICAgdGhpcy5fd2FpdGluZ0ZvclJlbGVhc2VUd2VlbnMgPSBudWxsOwogICAgICAgIHN1cGVyLlJlbGVhc2UoKQogICAgfQogICAgU2V0RW5hYmxlZChhKSB7CiAgICAgICAgdGhpcy5fZW5hYmxlZCA9ICEhYTsKICAgICAgICBhID8gdGhpcy5fU3RhcnRUaWNraW5nMigpIDogdGhpcy5fU3RvcFRpY2tpbmcyKCk7CiAgICAgICAgZm9yIChjb25zdCBiIG9mIHRoaXMuQWxsVHdlZW5zKCkpIGEgPwogICAgICAgICAgICB0aGlzLklzSW5EaXNhYmxlZExpc3QoYikgJiYgYi5SZXN1bWUoKSA6ICgoYi5Jc1BsYXlpbmcoKSB8fCBiLklzU2NoZWR1bGVkKCkpICYmIHRoaXMuQWRkVG9EaXNhYmxlZExpc3QoYiksIGIuU3RvcCgpKTsKICAgICAgICBhICYmIHRoaXMuQ2xlYXJEaXNhYmxlZExpc3QoKQogICAgfQogICAgSXNFbmFibGVkKCkgewogICAgICAgIHJldHVybiB0aGlzLl9lbmFibGVkCiAgICB9CiAgICBBZGRUb0Rpc2FibGVkTGlzdChhKSB7CiAgICAgICAgdGhpcy5fZGlzYWJsZWRUd2VlbnMucHVzaChhKQogICAgfQogICAgSXNJbkRpc2FibGVkTGlzdChhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2Rpc2FibGVkVHdlZW5zLmluY2x1ZGVzKGEpCiAgICB9CiAgICBDbGVhckRpc2FibGVkTGlzdCgpIHsKICAgICAgICBDMyRqc2NvbXAkMjY0LmNsZWFyQXJyYXkodGhpcy5fZGlzYWJsZWRUd2VlbnMpCiAgICB9CiAgICBHZXRGaW5pc2hpbmdUd2VlbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZmluaXNoaW5nVHdlZW4KICAgIH0KICAgIElzSW5zdGFuY2VWYWxpZCgpIHsKICAgICAgICBjb25zdCBhID0gdGhpcy5HZXRPYmplY3RJbnN0YW5jZSgpOwogICAgICAgIHJldHVybiBhID8gIWEuSXNEZXN0cm95ZWQoKSA6ICExCiAgICB9CiAgICBHZXRUd2VlbihhLCBiLCBkID0gITEpIHsKICAgICAgICBpZiAoKGIgPSBiID8KICAgICAgICAgICAgICAgIHRoaXMuUHJvcGVydHlUd2VlbnMoYiwgZCkgOiB0aGlzLkFsbFR3ZWVucyhkKSkgJiYgYi5sZW5ndGgpCiAgICAgICAgICAgIGZvciAoY29uc3QgYyBvZiBiKQogICAgICAgICAgICAgICAgaWYgKGMuSGFzVGFncyhhKSkgcmV0dXJuIGMKICAgIH0KICAgIEdldFR3ZWVuSW5jbHVkaW5nV2FpdGluZ0ZvclJlbGVhc2UoYSwgYikgewogICAgICAgIHJldHVybiB0aGlzLkdldFR3ZWVuKGEsIGIsICEwKQogICAgfSogR2V0VHdlZW5zKGEsIGIsIGQgPSAhMSkgewogICAgICAgIGlmICgoYiA9IGIgPyB0aGlzLlByb3BlcnR5VHdlZW5zKGIsIGQpIDogdGhpcy5BbGxUd2VlbnMoZCkpICYmIGIubGVuZ3RoKQogICAgICAgICAgICBmb3IgKGNvbnN0IGMgb2YgYikgYy5IYXNUYWdzKGEpICYmICh5aWVsZCBjKQogICAgfSogR2V0VHdlZW5zSW5jbHVkaW5nV2FpdGluZ0ZvclJlbGVhc2UoYSwgYikgewogICAgICAgIHlpZWxkKiB0aGlzLkdldFR3ZWVucyhhLCBiLCAhMCkKICAgIH0KICAgIFByb3BlcnR5VHdlZW5zKGEsIGIpIHsKICAgICAgICBpZiAoYikgcmV0dXJuIGIgPSB0aGlzLl9hY3RpdmVUd2VlbnMuZ2V0KGEpLCBhID0gdGhpcy5fd2FpdGluZ0ZvclJlbGVhc2VUd2VlbnMuZ2V0KGEpLCBiIHx8IChiID0gW10pLCBhIHx8IChhID0gW10pLCBiLmNvbmNhdChhKS5maWx0ZXIoZCA9PgogICAgICAgICAgICBkKS5maWx0ZXIoZCA9PiAhZC5Jc1JlbGVhc2VkKCkpOwogICAgICAgIChhID0gdGhpcy5fYWN0aXZlVHdlZW5zLmdldChhKSkgfHwgKGEgPSBbXSk7CiAgICAgICAgcmV0dXJuIGEuZmlsdGVyKGQgPT4gZCkuZmlsdGVyKGQgPT4gIWQuSXNSZWxlYXNlZCgpKQogICAgfQogICAgQWxsVHdlZW5zKGEpIHsKICAgICAgICBpZiAoYSkgewogICAgICAgICAgICBhID0gWy4uLnRoaXMuX2FjdGl2ZVR3ZWVucy52YWx1ZXMoKV0uZmxhdCgpOwogICAgICAgICAgICBjb25zdCBiID0gWy4uLnRoaXMuX3dhaXRpbmdGb3JSZWxlYXNlVHdlZW5zLnZhbHVlcygpXS5mbGF0KCk7CiAgICAgICAgICAgIHJldHVybiBhLmNvbmNhdChiKS5maWx0ZXIoZCA9PiBkKS5maWx0ZXIoZCA9PiAhZC5Jc1JlbGVhc2VkKCkpCiAgICAgICAgfQogICAgICAgIHJldHVybiBbLi4udGhpcy5fYWN0aXZlVHdlZW5zLnZhbHVlcygpXS5mbGF0KCkuZmlsdGVyKGIgPT4gYikuZmlsdGVyKGIgPT4gIWIuSXNSZWxlYXNlZCgpKQogICAgfQogICAgQWxsVHdlZW5zSW5jbHVkaW5nV2FpdGluZ0ZvclJlbGVhc2UoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuQWxsVHdlZW5zKCEwKQogICAgfQogICAgU2F2ZVRvSnNvbigpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBzOiAhMSwKICAgICAgICAgICAgZTogISF0aGlzLl9lbmFibGVkLAogICAgICAgICAgICBhdDogdGhpcy5fU2F2ZUFjdGl2ZVR3ZWVuc1RvSnNvbigpLAogICAgICAgICAgICBkdDogdGhpcy5fU2F2ZURpc2FibGVkVHdlZW5zVG9Kc29uKCksCiAgICAgICAgICAgIHd0OiB0aGlzLl9TYXZlV2FpdGluZ0ZvclJlbGVhc2VUd2VlbnNUb0pzb24oKSwKICAgICAgICAgICAgZnQ6IHRoaXMuX1NhdmVGaW5pc2hpbmdUd2VlblRvSnNvbigpCiAgICAgICAgfQogICAgfQogICAgTG9hZEZyb21Kc29uKGEpIHsKICAgICAgICBhICYmICh0aGlzLl9hY3RpdmVUd2VlbnNKc29uID0gYS5hdCwgdGhpcy5fZGlzYWJsZWRUd2VlbnNKc29uID0gYS5kdCwgdGhpcy5fd2FpdGluZ0ZvclJlbGVhc2VUd2VlbnNKc29uID0gYS53dCwgdGhpcy5fZmluaXNoaW5nVHdlZW5OYW1lID0gYS5mdCwgdGhpcy5fYWxsb3dNdWx0aXBsZSA9ICExLCB0aGlzLl9lbmFibGVkID0gISFhLmUpCiAgICB9CiAgICBfT25BZnRlckxvYWQoYSkgewogICAgICAgIGEgPSB0aGlzLkdldFJ1bnRpbWUoKS5HZXRUaW1lbGluZU1hbmFnZXIoKTsKICAgICAgICB0aGlzLl9Qb3B1bGF0ZVR3ZWVuTWFwKHRoaXMuX2FjdGl2ZVR3ZWVuc0pzb24sIHRoaXMuX2FjdGl2ZVR3ZWVucywgYSk7CiAgICAgICAgaWYgKHRoaXMuX2Rpc2FibGVkVHdlZW5zSnNvbikgewogICAgICAgICAgICBDMyRqc2NvbXAkMjY0LmNsZWFyQXJyYXkodGhpcy5fZGlzYWJsZWRUd2VlbnMpOwogICAgICAgICAgICBmb3IgKGNvbnN0IGIgb2YgdGhpcy5fZGlzYWJsZWRUd2VlbnNKc29uKSB0aGlzLl9Qb3B1bGF0ZVR3ZWVuQXJyYXkodGhpcy5fZGlzYWJsZWRUd2VlbnMsIGIsIGEpCiAgICAgICAgfQogICAgICAgIHRoaXMuX1BvcHVsYXRlVHdlZW5NYXAodGhpcy5fd2FpdGluZ0ZvclJlbGVhc2VUd2VlbnNKc29uLCB0aGlzLl93YWl0aW5nRm9yUmVsZWFzZVR3ZWVucywgYSk7CiAgICAgICAgdGhpcy5fZmluaXNoaW5nVHdlZW4gPSB0aGlzLl9HZXRUd2Vlbih0aGlzLl9maW5pc2hpbmdUd2Vlbk5hbWUsIGEpOwogICAgICAgIHRoaXMuX2VuYWJsZWQgPyB0aGlzLl9TdGFydFRpY2tpbmcyKCkgOiB0aGlzLl9TdG9wVGlja2luZzIoKQogICAgfQogICAgX1BvcHVsYXRlVHdlZW5NYXAoYSwgYiwgZCkgewogICAgICAgIGlmIChhKQogICAgICAgICAgICBmb3IgKGNvbnN0IGUgaW4gYSkgewogICAgICAgICAgICAgICAgbGV0IGcgPSBiLmdldChlKTsKICAgICAgICAgICAgICAgIGcgPyBDMyRqc2NvbXAkMjY0LmNsZWFyQXJyYXkoZykgOiBnID0gW107CiAgICAgICAgICAgICAgICB2YXIgYyA9IGFbZV07CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGsgb2YgYykgdGhpcy5fUG9wdWxhdGVUd2VlbkFycmF5KGcsIGsubmFtZSwgZCkgPyB0aGlzLl9Mb2FkVHdlZW5Gcm9tSnNvbihrLm5hbWUsIGssIGQpIDoKICAgICAgICAgICAgICAgICAgICAoYyA9IEMzJGpzY29tcCQyNjQuVHdlZW5TdGF0ZS5CdWlsZCh7CiAgICAgICAgICAgICAgICAgICAgICAgIHJ1bnRpbWU6IHRoaXMuR2V0UnVudGltZSgpLAogICAgICAgICAgICAgICAgICAgICAgICBqc29uOiBrCiAgICAgICAgICAgICAgICAgICAgfSksIGMuQWRkQ29tcGxldGVkQ2FsbGJhY2sobSA9PiB0aGlzLl9GaW5pc2hUcmlnZ2VycyhtKSksIGQuQWRkU2NoZWR1bGVkVGltZWxpbmUoYyksIHRoaXMuX1BvcHVsYXRlVHdlZW5BcnJheShnLCBjLCBkKSk7CiAgICAgICAgICAgICAgICBiLnNldChlLCBnKQogICAgICAgICAgICB9CiAgICB9CiAgICBfR2V0VHdlZW4oYSwgYikgewogICAgICAgIHJldHVybiBiLkdldFNjaGVkdWxlZE9yUGxheWluZ1RpbWVsaW5lQnlOYW1lKGEpCiAgICB9CiAgICBfUG9wdWxhdGVUd2VlbkFycmF5KGEsIGIsIGQpIHsKICAgICAgICBpZiAoInN0cmluZyIgPT09IHR5cGVvZiBiKSB7CiAgICAgICAgICAgIGlmIChiID0gdGhpcy5fR2V0VHdlZW4oYiwgZCkpIHJldHVybiAhIWEucHVzaChiKQogICAgICAgIH0gZWxzZSByZXR1cm4gISFhLnB1c2goYik7CiAgICAgICAgcmV0dXJuICExCiAgICB9CiAgICBfTG9hZFR3ZWVuRnJvbUpzb24oYSwgYiwgZCkgewogICAgICAgICJzdHJpbmciID09PSB0eXBlb2YgYSA/IChhID0gdGhpcy5fR2V0VHdlZW4oYSwgZCkpICYmIGEuX0xvYWRGcm9tSnNvbihiKSA6IGEuX0xvYWRGcm9tSnNvbihiKQogICAgfQogICAgX1NhdmVBY3RpdmVUd2VlbnNUb0pzb24oKSB7CiAgICAgICAgY29uc3QgYSA9IHt9OwogICAgICAgIGZvciAoY29uc3QgW2IsIGRdIG9mIHRoaXMuX2FjdGl2ZVR3ZWVucykgYVtiXSA9IGQuZmlsdGVyKGMgPT4gIWMuSXNSZWxlYXNlZCgpKS5tYXAoYyA9PiBjLl9TYXZlVG9Kc29uKCkpOwogICAgICAgIHJldHVybiBhCiAgICB9CiAgICBfU2F2ZURpc2FibGVkVHdlZW5zVG9Kc29uKCkgewogICAgICAgIHJldHVybiB0aGlzLl9kaXNhYmxlZFR3ZWVucy5maWx0ZXIoYSA9PiAhYS5Jc1JlbGVhc2VkKCkpLm1hcChhID0+IGEuR2V0TmFtZSgpKQogICAgfQogICAgX1NhdmVXYWl0aW5nRm9yUmVsZWFzZVR3ZWVuc1RvSnNvbigpIHsKICAgICAgICBjb25zdCBhID0ge307CiAgICAgICAgZm9yIChjb25zdCBbYiwgZF0gb2YgdGhpcy5fd2FpdGluZ0ZvclJlbGVhc2VUd2VlbnMpIGFbYl0gPSBkLm1hcChjID0+IGMuX1NhdmVUb0pzb24oKSk7CiAgICAgICAgcmV0dXJuIGEKICAgIH0KICAgIF9TYXZlRmluaXNoaW5nVHdlZW5Ub0pzb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2ZpbmlzaGluZ1R3ZWVuID8gdGhpcy5fZmluaXNoaW5nVHdlZW4uR2V0TmFtZSgpIDogIiIKICAgIH0KICAgIFRpY2syKCkgewogICAgICAgIHRoaXMuX1JlbGVhc2VXYWl0aW5nVHdlZW5zKCkKICAgIH0KICAgIENyZWF0ZVR3ZWVuKGEpIHsKICAgICAgICB2YXIgYiA9IE5BTUVTUEFDRS5Db25maWcuR2V0UHJvcGVydHlUcmFja3NDb25maWcoYS5wcm9wZXJ0eSwKICAgICAgICAgICAgYS5zdGFydFZhbHVlLCBhLmVuZFZhbHVlLCBhLmVhc2UsIGEucmVzdWx0TW9kZSwgdGhpcy5HZXRPYmplY3RJbnN0YW5jZSgpKTsKICAgICAgICBjb25zdCBkID0gTkFNRVNQQUNFLk1hcHMuR2V0UHJvcGVydHlGcm9tSW5kZXgoYS5wcm9wZXJ0eSk7CiAgICAgICAgTkFNRVNQQUNFLk1hcHMuSXNWYWx1ZUlkKGQpIHx8IHRoaXMuUmVsZWFzZVR3ZWVucyhhLnByb3BlcnR5KTsKICAgICAgICBiID0gQzMkanNjb21wJDI2NC5Ud2VlblN0YXRlLkJ1aWxkKHsKICAgICAgICAgICAgcnVudGltZTogdGhpcy5HZXRSdW50aW1lKCksCiAgICAgICAgICAgIGlkOiBkLAogICAgICAgICAgICB0YWdzOiBhLnRhZ3MsCiAgICAgICAgICAgIHRpbWU6IGEudGltZSwKICAgICAgICAgICAgaW5zdGFuY2U6IHRoaXMuR2V0T2JqZWN0SW5zdGFuY2UoKSwKICAgICAgICAgICAgcmVsZWFzZU9uQ29tcGxldGU6ICEhYS5yZWxlYXNlT25Db21wbGV0ZSwKICAgICAgICAgICAgbG9vcDogISFhLmxvb3AsCiAgICAgICAgICAgIHBpbmdQb25nOiAhIWEucGluZ1BvbmcsCiAgICAgICAgICAgIGluaXRpYWxWYWx1ZU1vZGU6IGEuaW5pdGlhbFZhbHVlTW9kZSwKICAgICAgICAgICAgcHJvcGVydHlUcmFja3NDb25maWc6IGIKICAgICAgICB9KTsKICAgICAgICBiLkFkZENvbXBsZXRlZENhbGxiYWNrKGMgPT4gdGhpcy5fRmluaXNoVHJpZ2dlcnMoYykpOwogICAgICAgIHRoaXMuX0FkZFR3ZWVuKGIsCiAgICAgICAgICAgIGEucHJvcGVydHkpOwogICAgICAgIHJldHVybiBiCiAgICB9CiAgICBfTWF5YmVSZW1vdmVGcm9tQWN0aXZlVHdlZW5NYXAoYSkgewogICAgICAgIHZhciBiID0gYS5HZXRJZCgpOwogICAgICAgIHRoaXMuX2FjdGl2ZVR3ZWVucy5oYXMoYikgJiYgKGIgPSB0aGlzLl9hY3RpdmVUd2VlbnMuZ2V0KGIpKSAmJiAoYSA9IGIuaW5kZXhPZihhKSwgLTEgIT09IGEgJiYgYi5zcGxpY2UoYSwgMSkpCiAgICB9CiAgICBSZWxlYXNlVHdlZW4oYSwgYiA9ICExKSB7CiAgICAgICAgdGhpcy5fTWF5YmVSZW1vdmVGcm9tQWN0aXZlVHdlZW5NYXAoYSk7CiAgICAgICAgYS5Jc1JlbGVhc2VkKCkgfHwgdGhpcy5fSXNJbldhaXRpbmdMaXN0KGEpIHx8IChhLlN0b3AoYiksIHRoaXMuX0FkZFRvV2FpdGluZ0xpc3QoYSkpCiAgICB9CiAgICBSZWxlYXNlVHdlZW5zKGEsIGIgPSAhMSkgewogICAgICAgIGlmIChDMyRqc2NvbXAkMjY0LklzRmluaXRlTnVtYmVyKGEpKSB7CiAgICAgICAgICAgIHZhciBkID0gTkFNRVNQQUNFLk1hcHMuR2V0UHJvcGVydHlGcm9tSW5kZXgoYSk7CiAgICAgICAgICAgIGlmICh0aGlzLl9hY3RpdmVUd2VlbnMuaGFzKGQpKSB7CiAgICAgICAgICAgICAgICBkID0gdGhpcy5fYWN0aXZlVHdlZW5zLmdldChkKTsKICAgICAgICAgICAgICAgIHZhciBjID0gdGhpcy5HZXRGaW5pc2hpbmdUd2VlbigpOwogICAgICAgICAgICAgICAgZm9yICh2YXIgZSBvZiBkKSBlID09PQogICAgICAgICAgICAgICAgICAgIGMgfHwgZS5Jc1JlbGVhc2VkKCkgfHwgdGhpcy5fSXNJbldhaXRpbmdMaXN0KGUpIHx8IChlLlN0b3AoYiksIGUuUmVsZWFzZSgpKTsKICAgICAgICAgICAgICAgIEMzJGpzY29tcCQyNjQuY2xlYXJBcnJheShkKQogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZSA9IHRoaXMuR2V0RmluaXNoaW5nVHdlZW4oKTsKICAgICAgICAgICAgZm9yIChkIG9mIHRoaXMuQWxsVHdlZW5zKCkpIGQgPT09IGUgfHwgZC5Jc1JlbGVhc2VkKCkgfHwgdGhpcy5fSXNJbldhaXRpbmdMaXN0KGQpIHx8IChkLlN0b3AoYiksIGQuUmVsZWFzZSgpKTsKICAgICAgICAgICAgZm9yIChjIG9mIHRoaXMuX2FjdGl2ZVR3ZWVucy5rZXlzKCkpIEMzJGpzY29tcCQyNjQuY2xlYXJBcnJheSh0aGlzLl9hY3RpdmVUd2VlbnMuZ2V0KGMpKSwgdGhpcy5fYWN0aXZlVHdlZW5zLmRlbGV0ZShjKTsKICAgICAgICAgICAgdGhpcy5fYWN0aXZlVHdlZW5zLmNsZWFyKCkKICAgICAgICB9CiAgICB9CiAgICBSZWxlYXNlQW5kQ29tcGxldGVUd2VlbihhKSB7CiAgICAgICAgdGhpcy5SZWxlYXNlVHdlZW4oYSwgITApCiAgICB9CiAgICBSZWxlYXNlQW5kQ29tcGxldGVUd2VlbnMoKSB7CiAgICAgICAgdGhpcy5SZWxlYXNlVHdlZW5zKE5hTiwgITApCiAgICB9CiAgICBHZXRQcm9wZXJ0eVZhbHVlQnlJbmRleChhKSB7CiAgICAgICAgc3dpdGNoIChhKSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9lbmFibGVkCiAgICAgICAgfQogICAgfQogICAgU2V0UHJvcGVydHlWYWx1ZUJ5SW5kZXgoYSwKICAgICAgICBiKSB7CiAgICAgICAgc3dpdGNoIChhKSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIHRoaXMuX2VuYWJsZWQgPSAhIWIKICAgICAgICB9CiAgICB9CiAgICBfR2V0QmVoYXZpb3JUeXBlKGEpIHsKICAgICAgICBhID0gYS5HZXRJbnN0YW5jZSgpLkdldEJlaGF2aW9ySW5zdGFuY2VzKCk7CiAgICAgICAgZm9yIChjb25zdCBiIG9mIGEpCiAgICAgICAgICAgIGlmIChhID0gYi5HZXRCZWhhdmlvclR5cGUoKSwgYS5HZXRJbnN0YW5jZVNka0N0b3IoKSA9PT0gdGhpcy5jb25zdHJ1Y3RvcikgcmV0dXJuIGEKICAgIH0KICAgIFRyaWdnZXIoYSwgYiwgZCwgYykgewogICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lID8gc3VwZXIuVHJpZ2dlcihhKSA6IGIuVHJpZ2dlcihhLCBkLCBjKQogICAgfQogICAgX0ZpbmlzaFRyaWdnZXJzKGEpIHsKICAgICAgICB0aGlzLl9maW5pc2hpbmdUd2VlbiA9IGE7CiAgICAgICAgTkFNRVNQQUNFLkNuZHMuU2V0RmluaXNoaW5nVHdlZW4oYSk7CiAgICAgICAgbGV0IGIsIGQ7CiAgICAgICAgaWYgKHRoaXMuR2V0UnVudGltZSgpKSBiID0gdGhpcy5faW5zdCwgZCA9IHRoaXMuX3J1bnRpbWUsIHRoaXMuVHJpZ2dlcihOQU1FU1BBQ0UuQ25kcy5PblR3ZWVuc0ZpbmlzaGVkKSwgdGhpcy5UcmlnZ2VyKE5BTUVTUEFDRS5DbmRzLk9uQW55VHdlZW5zRmluaXNoZWQpLCB0aGlzLlJlbGVhc2VUd2VlbihhKTsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgYiA9IGEuR2V0SW5zdGFuY2UoKTsKICAgICAgICAgICAgaWYgKCFiIHx8IGIgJiYgYi5Jc0Rlc3Ryb3llZCgpKSByZXR1cm47CiAgICAgICAgICAgIGQgPSBiLkdldFJ1bnRpbWUoKTsKICAgICAgICAgICAgY29uc3QgYyA9IHRoaXMuX0dldEJlaGF2aW9yVHlwZShhKTsKICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKE5BTUVTUEFDRS5DbmRzLk9uVHdlZW5zRmluaXNoZWQsIGQsIGIsIGMpOwogICAgICAgICAgICB0aGlzLlRyaWdnZXIoTkFNRVNQQUNFLkNuZHMuT25BbnlUd2VlbnNGaW5pc2hlZCwgZCwgYiwgYyk7CiAgICAgICAgICAgIGEuU3RvcCgpCiAgICAgICAgfQogICAgICAgIHRoaXMuX2ZpbmlzaGluZ1R3ZWVuID0gbnVsbDsKICAgICAgICBOQU1FU1BBQ0UuQ25kcy5TZXRGaW5pc2hpbmdUd2VlbihudWxsKTsKICAgICAgICBhLkdldERlc3Ryb3lJbnN0YW5jZU9uQ29tcGxldGUoKSAmJiBkLkRlc3Ryb3lJbnN0YW5jZShiKQogICAgfQogICAgX0FkZFR3ZWVuKGEsIGIpIHsKICAgICAgICBiID0gTkFNRVNQQUNFLk1hcHMuR2V0UHJvcGVydHlGcm9tSW5kZXgoYik7CiAgICAgICAgdGhpcy5fYWN0aXZlVHdlZW5zLmhhcyhiKSB8fCB0aGlzLl9hY3RpdmVUd2VlbnMuc2V0KGIsIFtdKTsKICAgICAgICB0aGlzLl9hY3RpdmVUd2VlbnMuZ2V0KGIpLnB1c2goYSkKICAgIH0KICAgIF9BZGRUb1dhaXRpbmdMaXN0KGEpIHsKICAgICAgICBjb25zdCBiID0KICAgICAgICAgICAgYS5HZXRJZCgpOwogICAgICAgIHRoaXMuX3dhaXRpbmdGb3JSZWxlYXNlVHdlZW5zLmhhcyhiKSB8fCB0aGlzLl93YWl0aW5nRm9yUmVsZWFzZVR3ZWVucy5zZXQoYiwgW10pOwogICAgICAgIHRoaXMuX3dhaXRpbmdGb3JSZWxlYXNlVHdlZW5zLmdldChiKS5wdXNoKGEpCiAgICB9CiAgICBfSXNJbldhaXRpbmdMaXN0KGEpIHsKICAgICAgICBjb25zdCBiID0gYS5HZXRJZCgpOwogICAgICAgIHJldHVybiB0aGlzLl93YWl0aW5nRm9yUmVsZWFzZVR3ZWVucy5oYXMoYikgPyB0aGlzLl93YWl0aW5nRm9yUmVsZWFzZVR3ZWVucy5nZXQoYikuaW5jbHVkZXMoYSkgOiAhMQogICAgfQogICAgX1JlbGVhc2VXYWl0aW5nVHdlZW5zKCkgewogICAgICAgIGlmICh0aGlzLl93YWl0aW5nRm9yUmVsZWFzZVR3ZWVucy5zaXplKSB7CiAgICAgICAgICAgIGZvciAoY29uc3QgYSBvZiB0aGlzLl93YWl0aW5nRm9yUmVsZWFzZVR3ZWVucy52YWx1ZXMoKSkgewogICAgICAgICAgICAgICAgZm9yIChjb25zdCBiIG9mIGEpIGIuSXNSZWxlYXNlZCgpIHx8IGIuUmVsZWFzZSgpOwogICAgICAgICAgICAgICAgQzMkanNjb21wJDI2NC5jbGVhckFycmF5KGEpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5fd2FpdGluZ0ZvclJlbGVhc2VUd2VlbnMuY2xlYXIoKQogICAgICAgIH0KICAgIH0KICAgIEdldERlYnVnZ2VyUHJvcGVydGllcygpIHsKICAgICAgICByZXR1cm4gW3sKICAgICAgICAgICAgdGl0bGU6ICIkIiArCiAgICAgICAgICAgICAgICB0aGlzLkdldEJlaGF2aW9yVHlwZSgpLkdldE5hbWUoKSwKICAgICAgICAgICAgcHJvcGVydGllczogW3sKICAgICAgICAgICAgICAgIG5hbWU6ICJiZWhhdmlvcnMudHdlZW4ucHJvcGVydGllcy5lbmFibGVkLm5hbWUiLAogICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuSXNFbmFibGVkKCksCiAgICAgICAgICAgICAgICBvbmVkaXQ6IGEgPT4gdGhpcy5TZXRFbmFibGVkKGEpCiAgICAgICAgICAgIH1dCiAgICAgICAgfV0KICAgIH0KICAgIEdldFNjcmlwdEludGVyZmFjZUNsYXNzKCkgewogICAgICAgIHJldHVybiBzZWxmLklUd2VlbkJlaGF2aW9ySW5zdGFuY2UKICAgIH0KfTsKY29uc3QgQzMkanNjb21wJDI2NSA9IHNlbGYuQzM7CmxldCBmaW5pc2hpbmdUd2VlbiRqc2NvbXAkMiA9IG51bGw7CkMzJGpzY29tcCQyNjUuQmVoYXZpb3JzLlR3ZWVuLkNuZHMgPSB7CiAgICBTZXRGaW5pc2hpbmdUd2VlbihhKSB7CiAgICAgICAgZmluaXNoaW5nVHdlZW4kanNjb21wJDIgPSBhCiAgICB9LAogICAgT25Ud2VlbnNGaW5pc2hlZChhKSB7CiAgICAgICAgcmV0dXJuIGZpbmlzaGluZ1R3ZWVuJGpzY29tcCQyLkhhc1RhZ3MoYSkKICAgIH0sCiAgICBPbkFueVR3ZWVuc0ZpbmlzaGVkKCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIElzUGxheWluZyhhKSB7CiAgICAgICAgcmV0dXJuIChhID0gWy4uLnRoaXMuR2V0VHdlZW5zSW5jbHVkaW5nV2FpdGluZ0ZvclJlbGVhc2UoYSldLCBhLmxlbmd0aCkgPyBhLnNvbWUoQzMkanNjb21wJDI2NS5Ud2VlblN0YXRlLklzUGxheWluZykgOiAhMQogICAgfSwKICAgIElzQW55UGxheWluZygpIHsKICAgICAgICBjb25zdCBhID0gWy4uLnRoaXMuQWxsVHdlZW5zSW5jbHVkaW5nV2FpdGluZ0ZvclJlbGVhc2UoKV07CiAgICAgICAgcmV0dXJuIGEgJiYgYS5sZW5ndGggPyBhLnNvbWUoQzMkanNjb21wJDI2NS5Ud2VlblN0YXRlLklzUGxheWluZykgOiAhMQogICAgfSwKICAgIElzUGF1c2VkKGEpIHsKICAgICAgICByZXR1cm4gKGEgPSBbLi4udGhpcy5HZXRUd2VlbnNJbmNsdWRpbmdXYWl0aW5nRm9yUmVsZWFzZShhKV0sCiAgICAgICAgICAgIGEubGVuZ3RoKSA/IGEuc29tZShDMyRqc2NvbXAkMjY1LlR3ZWVuU3RhdGUuSXNQYXVzZWQpIDogITEKICAgIH0sCiAgICBJc0FueVBhdXNlZCgpIHsKICAgICAgICBjb25zdCBhID0gWy4uLnRoaXMuQWxsVHdlZW5zSW5jbHVkaW5nV2FpdGluZ0ZvclJlbGVhc2UoKV07CiAgICAgICAgcmV0dXJuIGEgJiYgYS5sZW5ndGggPyBhLnNvbWUoQzMkanNjb21wJDI2NS5Ud2VlblN0YXRlLklzUGF1c2VkKSA6ICExCiAgICB9Cn07CmNvbnN0IEMzJGpzY29tcCQyNjYgPSBzZWxmLkMzLAogICAgRWFzZSRqc2NvbXAkMyA9IHNlbGYuRWFzZSwKICAgIE5BTUVTUEFDRSRqc2NvbXAkMSA9IEMzJGpzY29tcCQyNjYuQmVoYXZpb3JzLlR3ZWVuOwpOQU1FU1BBQ0UkanNjb21wJDEuQWN0cyA9IHsKICAgIFNldEVuYWJsZWQoYSkgewogICAgICAgIHRoaXMuU2V0RW5hYmxlZCghIWEpCiAgICB9LAogICAgYXN5bmMgVHdlZW5PbmVQcm9wZXJ0eSguLi5hKSB7CiAgICAgICAgdGhpcy5Jc0VuYWJsZWQoKSAmJiB0aGlzLklzSW5zdGFuY2VWYWxpZCgpICYmIChhID0gdGhpcy5DcmVhdGVUd2VlbihOQU1FU1BBQ0UkanNjb21wJDEuVHdlZW5Bcmd1bWVudHMuT25lUHJvcGVydHkodGhpcywgLi4uYSkpLCBhLlBsYXkoKSAmJiBhd2FpdCBhLkdldFBsYXlQcm9taXNlKCkpCiAgICB9LAogICAgYXN5bmMgVHdlZW5Ud29Qcm9wZXJ0aWVzKC4uLmEpIHsKICAgICAgICB0aGlzLklzRW5hYmxlZCgpICYmIHRoaXMuSXNJbnN0YW5jZVZhbGlkKCkgJiYgKGEgPSB0aGlzLkNyZWF0ZVR3ZWVuKE5BTUVTUEFDRSRqc2NvbXAkMS5Ud2VlbkFyZ3VtZW50cy5Ud29Qcm9wZXJ0aWVzKHRoaXMsIC4uLmEpKSwgYS5QbGF5KCkgJiYgYXdhaXQgYS5HZXRQbGF5UHJvbWlzZSgpKQogICAgfSwKICAgIGFzeW5jIFR3ZWVuVmFsdWUoLi4uYSkgewogICAgICAgIHRoaXMuSXNFbmFibGVkKCkgJiYgdGhpcy5Jc0luc3RhbmNlVmFsaWQoKSAmJgogICAgICAgICAgICAoYSA9IHRoaXMuQ3JlYXRlVHdlZW4oTkFNRVNQQUNFJGpzY29tcCQxLlR3ZWVuQXJndW1lbnRzLlZhbHVlUHJvcGVydHkodGhpcywgLi4uYSkpLCBhLlBsYXkoKSAmJiBhd2FpdCBhLkdldFBsYXlQcm9taXNlKCkpCiAgICB9LAogICAgUGF1c2VUd2VlbnMoYSkgewogICAgICAgIGlmICh0aGlzLklzRW5hYmxlZCgpICYmIHRoaXMuSXNJbnN0YW5jZVZhbGlkKCkpCiAgICAgICAgICAgIGZvciAoY29uc3QgYiBvZiB0aGlzLkdldFR3ZWVucyhhKSkgYi5TdG9wKCkKICAgIH0sCiAgICBQYXVzZUFsbFR3ZWVucygpIHsKICAgICAgICBpZiAodGhpcy5Jc0VuYWJsZWQoKSAmJiB0aGlzLklzSW5zdGFuY2VWYWxpZCgpKQogICAgICAgICAgICBmb3IgKGNvbnN0IGEgb2YgdGhpcy5BbGxUd2VlbnMoKSkgYS5TdG9wKCkKICAgIH0sCiAgICBSZXN1bWVUd2VlbnMoYSkgewogICAgICAgIGlmICh0aGlzLklzRW5hYmxlZCgpICYmIHRoaXMuSXNJbnN0YW5jZVZhbGlkKCkpCiAgICAgICAgICAgIGZvciAoY29uc3QgYiBvZiB0aGlzLkdldFR3ZWVucyhhKSkgYi5SZXN1bWUoKQogICAgfSwKICAgIFJlc3VtZUFsbFR3ZWVucygpIHsKICAgICAgICBpZiAodGhpcy5Jc0VuYWJsZWQoKSAmJiB0aGlzLklzSW5zdGFuY2VWYWxpZCgpKQogICAgICAgICAgICBmb3IgKGNvbnN0IGEgb2YgdGhpcy5BbGxUd2VlbnMoKSkgYS5SZXN1bWUoKQogICAgfSwKICAgIFN0b3BUd2VlbnMoYSkgewogICAgICAgIGlmICh0aGlzLklzRW5hYmxlZCgpICYmIHRoaXMuSXNJbnN0YW5jZVZhbGlkKCkpCiAgICAgICAgICAgIGZvciAoY29uc3QgYiBvZiB0aGlzLkdldFR3ZWVucyhhKSkgdGhpcy5SZWxlYXNlVHdlZW4oYikKICAgIH0sCiAgICBTdG9wQWxsVHdlZW5zKCkgewogICAgICAgIGlmICh0aGlzLklzRW5hYmxlZCgpICYmIHRoaXMuSXNJbnN0YW5jZVZhbGlkKCkpCiAgICAgICAgICAgIGZvciAoY29uc3QgYSBvZiB0aGlzLkFsbFR3ZWVucygpKSB0aGlzLlJlbGVhc2VUd2VlbihhKQogICAgfSwKICAgIFNldE9uZVByb3BlcnR5VHdlZW5zRW5kVmFsdWUoYSwgYiwgZCkgewogICAgICAgIGlmICh0aGlzLklzRW5hYmxlZCgpICYmIHRoaXMuSXNJbnN0YW5jZVZhbGlkKCkpIHsKICAgICAgICAgICAgYiA9IEMzJGpzY29tcCQyNjYuQmVoYXZpb3JzLlR3ZWVuLk1hcHMuR2V0U2luZ2xlUHJvcGVydHlGcm9tSW5kZXgoYik7CiAgICAgICAgICAgIGZvciAoY29uc3QgYyBvZiB0aGlzLkdldFR3ZWVucyhhKSkgYy5CZWZvcmVTZXRFbmRWYWx1ZXMoW2JdKSwgYy5TZXRFbmRWYWx1ZShkLCBiKQogICAgICAgIH0KICAgIH0sCiAgICBTZXRUd29Qcm9wZXJ0aWVzVHdlZW5zRW5kVmFsdWUoYSwgYiwgZCwgYykgewogICAgICAgIGlmICh0aGlzLklzRW5hYmxlZCgpICYmCiAgICAgICAgICAgIHRoaXMuSXNJbnN0YW5jZVZhbGlkKCkpIHsKICAgICAgICAgICAgYiA9IEMzJGpzY29tcCQyNjYuQmVoYXZpb3JzLlR3ZWVuLk1hcHMuR2V0UmVhbFByb3BlcnRpZXMoYik7CiAgICAgICAgICAgIGZvciAoY29uc3QgZSBvZiB0aGlzLkdldFR3ZWVucyhhKSkgZS5CZWZvcmVTZXRFbmRWYWx1ZXMoYiksIGUuU2V0RW5kVmFsdWUoZCwgYlswXSksIGUuU2V0RW5kVmFsdWUoYywgYlsxXSkKICAgICAgICB9CiAgICB9LAogICAgU2V0VmFsdWVQcm9wZXJ0eVR3ZWVuc1N0YXJ0VmFsdWUoYSwgYikgewogICAgICAgIGlmICh0aGlzLklzRW5hYmxlZCgpICYmIHRoaXMuSXNJbnN0YW5jZVZhbGlkKCkpCiAgICAgICAgICAgIGZvciAoY29uc3QgZCBvZiB0aGlzLkdldFR3ZWVucyhhLCAidmFsdWUiKSkgZC5TZXRTdGFydFZhbHVlKGIsICJ2YWx1ZSIpCiAgICB9LAogICAgU2V0VmFsdWVQcm9wZXJ0eVR3ZWVuc0VuZFZhbHVlKGEsIGIpIHsKICAgICAgICBpZiAodGhpcy5Jc0VuYWJsZWQoKSAmJiB0aGlzLklzSW5zdGFuY2VWYWxpZCgpKQogICAgICAgICAgICBmb3IgKGNvbnN0IGQgb2YgdGhpcy5HZXRUd2VlbnMoYSwgInZhbHVlIikpIGQuQmVmb3JlU2V0RW5kVmFsdWVzKFsidmFsdWUiXSksIGQuU2V0RW5kVmFsdWUoYiwKICAgICAgICAgICAgICAgICJ2YWx1ZSIpCiAgICB9LAogICAgU2V0VHdlZW5zRWFzZShhLCBiKSB7CiAgICAgICAgaWYgKHRoaXMuSXNFbmFibGVkKCkgJiYgdGhpcy5Jc0luc3RhbmNlVmFsaWQoKSkgewogICAgICAgICAgICBiID0gRWFzZSRqc2NvbXAkMy5HZXRFYXNlRnJvbUluZGV4KGIpOwogICAgICAgICAgICBmb3IgKGNvbnN0IGQgb2YgdGhpcy5HZXRUd2VlbnMoYSkpIGQuU2V0RWFzZShiKQogICAgICAgIH0KICAgIH0sCiAgICBTZXRBbGxUd2VlbnNFYXNlKGEpIHsKICAgICAgICBpZiAodGhpcy5Jc0VuYWJsZWQoKSAmJiB0aGlzLklzSW5zdGFuY2VWYWxpZCgpKSB7CiAgICAgICAgICAgIGEgPSBFYXNlJGpzY29tcCQzLkdldEVhc2VGcm9tSW5kZXgoYSk7CiAgICAgICAgICAgIGZvciAoY29uc3QgYiBvZiB0aGlzLkFsbFR3ZWVucygpKSBiLlNldEVhc2UoYSkKICAgICAgICB9CiAgICB9LAogICAgU2V0VHdlZW5zVGltZShhLCBiKSB7CiAgICAgICAgaWYgKHRoaXMuSXNFbmFibGVkKCkgJiYgdGhpcy5Jc0luc3RhbmNlVmFsaWQoKSkKICAgICAgICAgICAgZm9yIChjb25zdCBkIG9mIHRoaXMuR2V0VHdlZW5zKGEpKSBkLlNldFRpbWUoYikKICAgIH0sCiAgICBTZXRBbGxUd2VlbnNUaW1lKGEpIHsKICAgICAgICBpZiAodGhpcy5Jc0VuYWJsZWQoKSAmJiB0aGlzLklzSW5zdGFuY2VWYWxpZCgpKQogICAgICAgICAgICBmb3IgKGNvbnN0IGIgb2YgdGhpcy5BbGxUd2VlbnMoKSkgYi5TZXRUaW1lKGEpCiAgICB9LAogICAgU2V0VHdlZW5zUGxheWJhY2tSYXRlKGEsIGIpIHsKICAgICAgICBpZiAodGhpcy5Jc0VuYWJsZWQoKSAmJiB0aGlzLklzSW5zdGFuY2VWYWxpZCgpKQogICAgICAgICAgICBmb3IgKGNvbnN0IGQgb2YgdGhpcy5HZXRUd2VlbnMoYSkpIGQuU2V0UGxheWJhY2tSYXRlKGIpCiAgICB9LAogICAgU2V0QWxsVHdlZW5zUGxheWJhY2tSYXRlKGEpIHsKICAgICAgICBpZiAodGhpcy5Jc0VuYWJsZWQoKSAmJiB0aGlzLklzSW5zdGFuY2VWYWxpZCgpKQogICAgICAgICAgICBmb3IgKGNvbnN0IGIgb2YgdGhpcy5BbGxUd2VlbnMoKSkgYi5TZXRQbGF5YmFja1JhdGUoYSkKICAgIH0sCiAgICBTZXRUd2VlbnNEZXN0cm95T25Db21wbGV0ZShhLCBiKSB7CiAgICAgICAgaWYgKHRoaXMuSXNFbmFibGVkKCkgJiYgdGhpcy5Jc0luc3RhbmNlVmFsaWQoKSkKICAgICAgICAgICAgZm9yIChjb25zdCBkIG9mIHRoaXMuR2V0VHdlZW5zKGEpKSBkLlNldERlc3Ryb3lJbnN0YW5jZU9uQ29tcGxldGUoISFiKQogICAgfSwKICAgIFNldEFsbFR3ZWVuc0Rlc3Ryb3lPbkNvbXBsZXRlKGEpIHsKICAgICAgICBpZiAodGhpcy5Jc0VuYWJsZWQoKSAmJiB0aGlzLklzSW5zdGFuY2VWYWxpZCgpKQogICAgICAgICAgICBmb3IgKGNvbnN0IGIgb2YgdGhpcy5BbGxUd2VlbnMoKSkgYi5TZXREZXN0cm95SW5zdGFuY2VPbkNvbXBsZXRlKCEhYSkKICAgIH0KfTsKc2VsZi5DMy5CZWhhdmlvcnMuVHdlZW4uRXhwcyA9IHsKICAgIFRpbWUoYSkgewogICAgICAgIHJldHVybiAoYSA9IHRoaXMuR2V0VHdlZW5JbmNsdWRpbmdXYWl0aW5nRm9yUmVsZWFzZShhKSkgPyBhLkdldFRpbWUoKSA6IDAKICAgIH0sCiAgICBQcm9ncmVzcyhhKSB7CiAgICAgICAgcmV0dXJuIChhID0gdGhpcy5HZXRUd2VlbkluY2x1ZGluZ1dhaXRpbmdGb3JSZWxlYXNlKGEpKSA/IGEuR2V0VGltZSgpIC8gYS5HZXRUb3RhbFRpbWUoKSA6IDAKICAgIH0sCiAgICBWYWx1ZShhKSB7CiAgICAgICAgcmV0dXJuIChhID0gdGhpcy5HZXRUd2VlbkluY2x1ZGluZ1dhaXRpbmdGb3JSZWxlYXNlKGEsICJ2YWx1ZSIpKSA/IGEuR2V0UHJvcGVydHlUcmFjaygidmFsdWUiKS5HZXRTb3VyY2VBZGFwdGVyVmFsdWUoKSA6IDAKICAgIH0sCiAgICBUYWdzKCkgewogICAgICAgIHJldHVybiB0aGlzLkdldEZpbmlzaGluZ1R3ZWVuKCkgPyB0aGlzLkdldEZpbmlzaGluZ1R3ZWVuKCkuR2V0U3RyaW5nVGFncygpIDogIiIKICAgIH0KfTsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkMjY4ID0gc2VsZi5DMywKICAgIEVhc2UkanNjb21wJDQgPSBzZWxmLkVhc2UsCiAgICBQQUlSX1BST1BFUlRJRVMgPSBbInBvc2l0aW9uIiwgInNpemUiLCAic2NhbGUiXSwKICAgIFNJTkdMRV9QUk9QRVJUSUVTID0gIm9mZnNldFggb2Zmc2V0WSBvZmZzZXRXaWR0aCBvZmZzZXRIZWlnaHQgb2Zmc2V0QW5nbGUgb2Zmc2V0T3BhY2l0eSBvZmZzZXRDb2xvciBvZmZzZXRaRWxldmF0aW9uIG9mZnNldFNjYWxlWCBvZmZzZXRTY2FsZVkiLnNwbGl0KCIgIiksCiAgICBWQUxVRV9QUk9QRVJUSUVTID0gWyJ2YWx1ZSJdLAogICAgUFJPUEVSVFlfSU5ERVhfVE9fTkFNRSA9IFtdLmNvbmNhdChQQUlSX1BST1BFUlRJRVMpLmNvbmNhdChTSU5HTEVfUFJPUEVSVElFUykuY29uY2F0KFZBTFVFX1BST1BFUlRJRVMpLAogICAgUFJPUEVSVFlfUEFJUl9UT19SRUFMX1BST1BFUlRJRVMgPSB7CiAgICAgICAgcG9zaXRpb246IFsib2Zmc2V0WCIsICJvZmZzZXRZIl0sCiAgICAgICAgc2l6ZTogWyJvZmZzZXRXaWR0aCIsICJvZmZzZXRIZWlnaHQiXSwKICAgICAgICBzY2FsZTogWyJvZmZzZXRTY2FsZVgiLCAib2Zmc2V0U2NhbGVZIl0KICAgIH0sCiAgICBBTExfUkVBTF9QUk9QRVJUSUVTID0gT2JqZWN0LmFzc2lnbih7fSwgUFJPUEVSVFlfSU5ERVhfVE9fTkFNRS5yZWR1Y2UoKGEsIGIpID0+IE9iamVjdC5hc3NpZ24oe30sIGEsIHsKICAgICAgICBbYl06IFtiXQogICAgfSksIHt9KSwgUFJPUEVSVFlfUEFJUl9UT19SRUFMX1BST1BFUlRJRVMpOwpDMyRqc2NvbXAkMjY4LkJlaGF2aW9ycy5Ud2Vlbi5NYXBzID0gY2xhc3MgewogICAgY29uc3RydWN0b3IoKSB7fQogICAgc3RhdGljIEdldEVhc2VzKCkgewogICAgICAgIHJldHVybiBbLi4uRWFzZSRqc2NvbXAkNC5HZXRSdW50aW1lRWFzZU5hbWVzKCldCiAgICB9CiAgICBzdGF0aWMgR2V0RWFzZUZyb21JbmRleChhKSB7CiAgICAgICAgcmV0dXJuIFsuLi5FYXNlJGpzY29tcCQ0LkdldFJ1bnRpbWVFYXNlTmFtZXMoKV1bYV0KICAgIH0KICAgIHN0YXRpYyBHZXRQcm9wZXJ0eUZyb21JbmRleChhKSB7CiAgICAgICAgcmV0dXJuIFBST1BFUlRZX0lOREVYX1RPX05BTUVbYV0KICAgIH0KICAgIHN0YXRpYyBHZXRQcm9wZXJ0eUluZGV4RnJvbU5hbWUoYSkgewogICAgICAgIHJldHVybiBQUk9QRVJUWV9JTkRFWF9UT19OQU1FLmluZGV4T2YoYSkKICAgIH0KICAgIHN0YXRpYyBHZXRQYWlyUHJvcGVydHlGcm9tSW5kZXgoYSkgewogICAgICAgIHJldHVybiBQQUlSX1BST1BFUlRJRVNbYV0KICAgIH0KICAgIHN0YXRpYyBHZXRTaW5nbGVQcm9wZXJ0eUZyb21JbmRleChhKSB7CiAgICAgICAgcmV0dXJuIFNJTkdMRV9QUk9QRVJUSUVTW2FdCiAgICB9CiAgICBzdGF0aWMgR2V0VmFsdWVQcm9wZXJ0eUZyb21JbmRleChhKSB7CiAgICAgICAgcmV0dXJuIFZBTFVFX1BST1BFUlRJRVNbYV0KICAgIH0KICAgIHN0YXRpYyBHZXRQYWlyUHJvcGVydGllcyhhKSB7CiAgICAgICAgcmV0dXJuIFBST1BFUlRZX1BBSVJfVE9fUkVBTF9QUk9QRVJUSUVTW2FdCiAgICB9CiAgICBzdGF0aWMgR2V0UmVhbFByb3BlcnRpZXMoYSkgewogICAgICAgIHJldHVybiBDMyRqc2NvbXAkMjY4LklzU3RyaW5nKGEpID8gQUxMX1JFQUxfUFJPUEVSVElFU1thXSA6CiAgICAgICAgICAgIEFMTF9SRUFMX1BST1BFUlRJRVNbUFJPUEVSVFlfSU5ERVhfVE9fTkFNRVthXV0KICAgIH0KICAgIHN0YXRpYyBJc1BhaXJJZChhKSB7CiAgICAgICAgcmV0dXJuICEhUFJPUEVSVFlfUEFJUl9UT19SRUFMX1BST1BFUlRJRVNbYV0KICAgIH0KICAgIHN0YXRpYyBJc0NvbG9ySWQoYSkgewogICAgICAgIHJldHVybiAib2Zmc2V0Q29sb3IiID09PSBhCiAgICB9CiAgICBzdGF0aWMgSXNBbmdsZUlkKGEpIHsKICAgICAgICByZXR1cm4gIm9mZnNldEFuZ2xlIiA9PT0gYQogICAgfQogICAgc3RhdGljIElzT3BhY2l0eUlkKGEpIHsKICAgICAgICByZXR1cm4gIm9mZnNldE9wYWNpdHkiID09PSBhCiAgICB9CiAgICBzdGF0aWMgSXNWYWx1ZUlkKGEpIHsKICAgICAgICByZXR1cm4gInZhbHVlIiA9PT0gYQogICAgfQp9OwoidXNlIHN0cmljdCI7CmNvbnN0IEMzJGpzY29tcCQyNjkgPSBzZWxmLkMzLAogICAgTkFNRVNQQUNFJGpzY29tcCQyID0gQzMkanNjb21wJDI2OS5CZWhhdmlvcnMuVHdlZW4sCiAgICBUV0VFTl9DT05GSUdVUkFUSU9OUyA9IG5ldyBNYXA7Ck5BTUVTUEFDRSRqc2NvbXAkMi5Db25maWcgPSBjbGFzcyB7CiAgICBjb25zdHJ1Y3RvcigpIHt9CiAgICBzdGF0aWMgR2V0UHJvcGVydHlUcmFja3NDb25maWcoYSwgYiwgZCwgYywgZSwgZykgewogICAgICAgIDAgPT09IFRXRUVOX0NPTkZJR1VSQVRJT05TLnNpemUgJiYgdGhpcy5fQ3JlYXRlQ29uZmlnT2JqZWN0cygpOwogICAgICAgIHZhciBrID0gTkFNRVNQQUNFJGpzY29tcCQyLlByb3BlcnR5VHlwZXMuUGljayhhKTsKICAgICAgICBrID0gVFdFRU5fQ09ORklHVVJBVElPTlMuZ2V0KGspOwogICAgICAgIEMzJGpzY29tcCQyNjkuSXNGaW5pdGVOdW1iZXIoYSkgJiYgKGEgPSBOQU1FU1BBQ0UkanNjb21wJDIuTWFwcy5HZXRQcm9wZXJ0eUZyb21JbmRleChhKSk7CiAgICAgICAgcmV0dXJuIHRoaXMuX0dldENvbmZpZyhrLCBhLCBiLCBkLCBjLCBlLCBnKQogICAgfQogICAgc3RhdGljIFRyYW5zZm9ybVZhbHVlKGEsIGIpIHsKICAgICAgICByZXR1cm4gQzMkanNjb21wJDI2OS5CZWhhdmlvcnMuVHdlZW4uR2V0UHJvcGVydHlUcmFja3NDb25maWcoYSkudmFsdWVHZXR0ZXIoYikKICAgIH0KICAgIHN0YXRpYyBfQ3JlYXRlQ29uZmlnT2JqZWN0cygpIHsKICAgICAgICBjb25zdCBhID0gTkFNRVNQQUNFJGpzY29tcCQyLlByb3BlcnR5VHlwZXMsCiAgICAgICAgICAgIGIgPSBOQU1FU1BBQ0UkanNjb21wJDIuVmFsdWVHZXR0ZXJzOwogICAgICAgIHRoaXMuX0FkZENvbmZpZ09iamVjdChhLlBBSVIsIHRoaXMuX0dldFBhaXJDb25maWcsIGIuX0dldFByb3BlcnR5VmFsdWUpOwogICAgICAgIHRoaXMuX0FkZENvbmZpZ09iamVjdChhLkNPTE9SLCB0aGlzLl9HZXRDb2xvckNvbmZpZywgYi5fR2V0Q29sb3JQcm9wZXJ0eVZhbHVlKTsKICAgICAgICB0aGlzLl9BZGRDb25maWdPYmplY3QoYS5BTkdMRSwgdGhpcy5fR2V0QW5nbGVDb25maWcsIGIuX0dldFByb3BlcnR5QW5nbGVWYWx1ZSk7CiAgICAgICAgdGhpcy5fQWRkQ29uZmlnT2JqZWN0KGEuVkFMVUUsIHRoaXMuX0dldFZhbHVlQ29uZmlnLCBiLl9HZXRQcm9wZXJ0eVZhbHVlKTsKICAgICAgICB0aGlzLl9BZGRDb25maWdPYmplY3QoYS5PVEhFUiwgdGhpcy5fR2V0Q29tbW9uQ29uZmlnLCBiLl9HZXRQcm9wZXJ0eVZhbHVlKQogICAgfQogICAgc3RhdGljIF9BZGRDb25maWdPYmplY3QoYSwgYiwgZCkgewogICAgICAgIFRXRUVOX0NPTkZJR1VSQVRJT05TLnNldChhLCB0aGlzLl9DcmVhdGVDb25maWdPYmplY3QoYSwgYiwgZCkpCiAgICB9CiAgICBzdGF0aWMgX0NyZWF0ZUNvbmZpZ09iamVjdChhLAogICAgICAgIGIsIGQpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBuYW1lOiBhLAogICAgICAgICAgICBjb25maWdGdW5jOiBiLAogICAgICAgICAgICB2YWx1ZUdldHRlcjogZAogICAgICAgIH0KICAgIH0KICAgIHN0YXRpYyBfR2V0Q29uZmlnKGEsIGIsIGQsIGMsIGUsIGcsIGspIHsKICAgICAgICByZXR1cm4gYS5jb25maWdGdW5jKGIsIGEudmFsdWVHZXR0ZXIoZCksIGEudmFsdWVHZXR0ZXIoYyksIGUsIGcsIGspCiAgICB9CiAgICBzdGF0aWMgX0dldFBhaXJDb25maWcoYSwgYiwgZCwgYywgZSwgZykgewogICAgICAgIHJldHVybiBOQU1FU1BBQ0UkanNjb21wJDIuTWFwcy5HZXRQYWlyUHJvcGVydGllcyhhKS5tYXAoKGssIG0pID0+ICh7CiAgICAgICAgICAgIHNvdXJjZUlkOiAid29ybGQtaW5zdGFuY2UiLAogICAgICAgICAgICBwcm9wZXJ0eTogaywKICAgICAgICAgICAgdHlwZTogImZsb2F0IiwKICAgICAgICAgICAgdmFsdWVUeXBlOiAibnVtZXJpYyIsCiAgICAgICAgICAgIHN0YXJ0VmFsdWU6IGJbbV0sCiAgICAgICAgICAgIGVuZFZhbHVlOiBkW21dLAogICAgICAgICAgICBlYXNlOiBOQU1FU1BBQ0UkanNjb21wJDIuTWFwcy5HZXRFYXNlRnJvbUluZGV4KGMpLAogICAgICAgICAgICByZXN1bHRNb2RlOiBlCiAgICAgICAgfSkpCiAgICB9CiAgICBzdGF0aWMgX0dldENvbG9yQ29uZmlnKGEsIGIsIGQsIGMsIGUsIGcpIHsKICAgICAgICByZXR1cm4gQzMkanNjb21wJDI2OS5QbHVnaW5zLlRleHQgJiYgZy5HZXRQbHVnaW4oKSBpbnN0YW5jZW9mCiAgICAgICAgQzMkanNjb21wJDI2OS5QbHVnaW5zLlRleHQgPyB7CiAgICAgICAgICAgIHNvdXJjZUlkOiAicGx1Z2luIiwKICAgICAgICAgICAgc291cmNlQXJnczogWzddLAogICAgICAgICAgICBwcm9wZXJ0eTogImNvbG9yIiwKICAgICAgICAgICAgdHlwZTogImNvbG9yIiwKICAgICAgICAgICAgdmFsdWVUeXBlOiAiY29sb3IiLAogICAgICAgICAgICBzdGFydFZhbHVlOiBiLAogICAgICAgICAgICBlbmRWYWx1ZTogZCwKICAgICAgICAgICAgZWFzZTogTkFNRVNQQUNFJGpzY29tcCQyLk1hcHMuR2V0RWFzZUZyb21JbmRleChjKSwKICAgICAgICAgICAgcmVzdWx0TW9kZTogZQogICAgICAgIH0gOiB7CiAgICAgICAgICAgIHNvdXJjZUlkOiAid29ybGQtaW5zdGFuY2UiLAogICAgICAgICAgICBwcm9wZXJ0eTogYSwKICAgICAgICAgICAgdHlwZTogImNvbG9yIiwKICAgICAgICAgICAgdmFsdWVUeXBlOiAiY29sb3IiLAogICAgICAgICAgICBzdGFydFZhbHVlOiBiLAogICAgICAgICAgICBlbmRWYWx1ZTogZCwKICAgICAgICAgICAgZWFzZTogTkFNRVNQQUNFJGpzY29tcCQyLk1hcHMuR2V0RWFzZUZyb21JbmRleChjKSwKICAgICAgICAgICAgcmVzdWx0TW9kZTogZQogICAgICAgIH0KICAgIH0KICAgIHN0YXRpYyBfR2V0QW5nbGVDb25maWcoYSwgYiwgZCwgYywgZSwgZykgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHNvdXJjZUlkOiAid29ybGQtaW5zdGFuY2UiLAogICAgICAgICAgICBwcm9wZXJ0eTogYSwKICAgICAgICAgICAgdHlwZTogImFuZ2xlIiwKICAgICAgICAgICAgdmFsdWVUeXBlOiAiYW5nbGUiLAogICAgICAgICAgICBzdGFydFZhbHVlOiBiLAogICAgICAgICAgICBlbmRWYWx1ZTogZCwKICAgICAgICAgICAgZWFzZTogTkFNRVNQQUNFJGpzY29tcCQyLk1hcHMuR2V0RWFzZUZyb21JbmRleChjKSwKICAgICAgICAgICAgcmVzdWx0TW9kZTogZQogICAgICAgIH0KICAgIH0KICAgIHN0YXRpYyBfR2V0Q29tbW9uQ29uZmlnKGEsIGIsIGQsIGMsIGUsIGcpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBzb3VyY2VJZDogIndvcmxkLWluc3RhbmNlIiwKICAgICAgICAgICAgcHJvcGVydHk6IGEsCiAgICAgICAgICAgIHR5cGU6ICJmbG9hdCIsCiAgICAgICAgICAgIHZhbHVlVHlwZTogIm51bWVyaWMiLAogICAgICAgICAgICBzdGFydFZhbHVlOiBiLAogICAgICAgICAgICBlbmRWYWx1ZTogZCwKICAgICAgICAgICAgZWFzZTogTkFNRVNQQUNFJGpzY29tcCQyLk1hcHMuR2V0RWFzZUZyb21JbmRleChjKSwKICAgICAgICAgICAgcmVzdWx0TW9kZTogZQogICAgICAgIH0KICAgIH0KICAgIHN0YXRpYyBfR2V0VmFsdWVDb25maWcoYSwgYiwgZCwgYywgZSwgZykgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHNvdXJjZUlkOiAidmFsdWUiLAogICAgICAgICAgICBwcm9wZXJ0eTogYSwKICAgICAgICAgICAgdHlwZTogImZsb2F0IiwKICAgICAgICAgICAgdmFsdWVUeXBlOiAibnVtZXJpYyIsCiAgICAgICAgICAgIHN0YXJ0VmFsdWU6IGIsCiAgICAgICAgICAgIGVuZFZhbHVlOiBkLAogICAgICAgICAgICBlYXNlOiBOQU1FU1BBQ0UkanNjb21wJDIuTWFwcy5HZXRFYXNlRnJvbUluZGV4KGMpLAogICAgICAgICAgICByZXN1bHRNb2RlOiBlCiAgICAgICAgfQogICAgfQp9OwoidXNlIHN0cmljdCI7CmNvbnN0IEMzJGpzY29tcCQyNzAgPSBzZWxmLkMzLAogICAgTkFNRVNQQUNFJGpzY29tcCQzID0gQzMkanNjb21wJDI3MC5CZWhhdmlvcnMuVHdlZW4sCiAgICBDT01NT05fVkFSSUFCTEVfQVJHUyA9IE9iamVjdC5hc3NpZ24oe30sIHsKICAgICAgICByZXN1bHRNb2RlOiAiYWJzb2x1dGUiCiAgICB9LCB7CiAgICAgICAgdGFnczogIiIsCiAgICAgICAgcHJvcGVydHk6ICIiLAogICAgICAgIHRpbWU6IDAsCiAgICAgICAgZWFzZTogMCwKICAgICAgICByZWxlYXNlT25Db21wbGV0ZTogMCwKICAgICAgICBsb29wOiAhMSwKICAgICAgICBwaW5nUG9uZzogITEKICAgIH0pLAogICAgT05FX1BST1BFUlRZX0FSR1MgPSBPYmplY3QuYXNzaWduKHt9LCBDT01NT05fVkFSSUFCTEVfQVJHUywgewogICAgICAgIGluaXRpYWxWYWx1ZU1vZGU6ICJjdXJyZW50LXN0YXRlIiwKICAgICAgICBzdGFydFZhbHVlOiAwLAogICAgICAgIGVuZFZhbHVlOiAwCiAgICB9KSwKICAgIFRXT19QUk9QRVJUSUVTX0FSR1MgPSBPYmplY3QuYXNzaWduKHt9LCBDT01NT05fVkFSSUFCTEVfQVJHUywgewogICAgICAgIGluaXRpYWxWYWx1ZU1vZGU6ICJjdXJyZW50LXN0YXRlIiwKICAgICAgICBzdGFydFZhbHVlOiBbMCwgMF0sCiAgICAgICAgZW5kVmFsdWU6IFswLCAwXQogICAgfSksCiAgICBDT0xPUl9QUk9QRVJUWV9BUkdTID0gT2JqZWN0LmFzc2lnbih7fSwgQ09NTU9OX1ZBUklBQkxFX0FSR1MsIHsKICAgICAgICBpbml0aWFsVmFsdWVNb2RlOiAiY3VycmVudC1zdGF0ZSIsCiAgICAgICAgc3RhcnRWYWx1ZTogWzAsIDAsIDBdLAogICAgICAgIGVuZFZhbHVlOiBbMCwgMCwgMF0KICAgIH0pLAogICAgVkFMVUVfUFJPUEVSVFlfQVJHUyA9IE9iamVjdC5hc3NpZ24oe30sIE9ORV9QUk9QRVJUWV9BUkdTLCB7CiAgICAgICAgaW5pdGlhbFZhbHVlTW9kZTogInN0YXJ0LXZhbHVlIgogICAgfSk7Ck5BTUVTUEFDRSRqc2NvbXAkMy5Ud2VlbkFyZ3VtZW50cyA9IGNsYXNzIHsKICAgIGNvbnN0cnVjdG9yKCkge30KICAgIHN0YXRpYyBfU2V0Q29tbW9uUHJvcGVydGllcyhhLCBiLCBkLCBjLCBlLCBnLCBrKSB7CiAgICAgICAgYS50YWdzID0gYjsKICAgICAgICBhLnRpbWUgPSBkOwogICAgICAgIGEuZWFzZSA9IGM7CiAgICAgICAgYS5yZWxlYXNlT25Db21wbGV0ZSA9IGU7CiAgICAgICAgYS5sb29wID0gZzsKICAgICAgICBhLnBpbmdQb25nID0gawogICAgfQogICAgc3RhdGljIE9uZVByb3BlcnR5KGEsIGIsIGQsIGMsIGUsIGcsIGssIG0sIG4pIHsKICAgICAgICBhID0gInN0cmluZyIgPT09IHR5cGVvZiBkID8gZCA6IE5BTUVTUEFDRSRqc2NvbXAkMy5NYXBzLkdldFNpbmdsZVByb3BlcnR5RnJvbUluZGV4KGQpOwogICAgICAgIGQgPSBOQU1FU1BBQ0UkanNjb21wJDMuTWFwcy5Jc0NvbG9ySWQoYSkgPyBDT0xPUl9QUk9QRVJUWV9BUkdTIDogT05FX1BST1BFUlRZX0FSR1M7CiAgICAgICAgdGhpcy5fU2V0Q29tbW9uUHJvcGVydGllcyhkLCBiLCBlLCBnLCBrLCBtLCBuKTsKICAgICAgICBOQU1FU1BBQ0UkanNjb21wJDMuTWFwcy5Jc0NvbG9ySWQoYSkgPyAoQ09MT1JfUFJPUEVSVFlfQVJHUy5lbmRWYWx1ZVswXSA9IEMzJGpzY29tcCQyNzAuR2V0UlZhbHVlKGMpLCBDT0xPUl9QUk9QRVJUWV9BUkdTLmVuZFZhbHVlWzFdID0KICAgICAgICAgICAgQzMkanNjb21wJDI3MC5HZXRHVmFsdWUoYyksIENPTE9SX1BST1BFUlRZX0FSR1MuZW5kVmFsdWVbMl0gPSBDMyRqc2NvbXAkMjcwLkdldEJWYWx1ZShjKSwgQ09MT1JfUFJPUEVSVFlfQVJHUy5wcm9wZXJ0eSA9IE5BTUVTUEFDRSRqc2NvbXAkMy5NYXBzLkdldFByb3BlcnR5SW5kZXhGcm9tTmFtZShhKSkgOiBOQU1FU1BBQ0UkanNjb21wJDMuTWFwcy5Jc09wYWNpdHlJZChhKSA/IE9ORV9QUk9QRVJUWV9BUkdTLmVuZFZhbHVlID0gYyAvIDEwMCA6IE9ORV9QUk9QRVJUWV9BUkdTLmVuZFZhbHVlID0gYzsKICAgICAgICBkLnByb3BlcnR5ID0gTkFNRVNQQUNFJGpzY29tcCQzLk1hcHMuR2V0UHJvcGVydHlJbmRleEZyb21OYW1lKGEpOwogICAgICAgIHJldHVybiBkCiAgICB9CiAgICBzdGF0aWMgVHdvUHJvcGVydGllcyhhLCBiLCBkLCBjLCBlLCBnLCBrLCBtLCBuLCBxKSB7CiAgICAgICAgdGhpcy5fU2V0Q29tbW9uUHJvcGVydGllcyhUV09fUFJPUEVSVElFU19BUkdTLCBiLCBnLCBrLCBtLCBuLCBxKTsKICAgICAgICBhID0gInN0cmluZyIgPT09IHR5cGVvZiBkID8gZCA6IE5BTUVTUEFDRSRqc2NvbXAkMy5NYXBzLkdldFBhaXJQcm9wZXJ0eUZyb21JbmRleChkKTsKICAgICAgICBUV09fUFJPUEVSVElFU19BUkdTLmVuZFZhbHVlWzBdID0gYzsKICAgICAgICBUV09fUFJPUEVSVElFU19BUkdTLmVuZFZhbHVlWzFdID0gZTsKICAgICAgICBUV09fUFJPUEVSVElFU19BUkdTLnByb3BlcnR5ID0gTkFNRVNQQUNFJGpzY29tcCQzLk1hcHMuR2V0UHJvcGVydHlJbmRleEZyb21OYW1lKGEpOwogICAgICAgIHJldHVybiBUV09fUFJPUEVSVElFU19BUkdTCiAgICB9CiAgICBzdGF0aWMgVmFsdWVQcm9wZXJ0eShhLCBiLCBkLCBjLCBlLCBnLCBrLCBtLCBuKSB7CiAgICAgICAgdGhpcy5fU2V0Q29tbW9uUHJvcGVydGllcyhWQUxVRV9QUk9QRVJUWV9BUkdTLCBiLCBlLCBnLCBrLCBtLCBuKTsKICAgICAgICBWQUxVRV9QUk9QRVJUWV9BUkdTLnN0YXJ0VmFsdWUgPSBkOwogICAgICAgIFZBTFVFX1BST1BFUlRZX0FSR1MuZW5kVmFsdWUgPSBjOwogICAgICAgIFZBTFVFX1BST1BFUlRZX0FSR1MucHJvcGVydHkgPSBOQU1FU1BBQ0UkanNjb21wJDMuTWFwcy5HZXRQcm9wZXJ0eUluZGV4RnJvbU5hbWUoInZhbHVlIik7CiAgICAgICAgcmV0dXJuIFZBTFVFX1BST1BFUlRZX0FSR1MKICAgIH0KfTsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkMjcxID0gc2VsZi5DMywKICAgIE5BTUVTUEFDRSRqc2NvbXAkNCA9IEMzJGpzY29tcCQyNzEuQmVoYXZpb3JzLlR3ZWVuLAogICAgVFlQRV9DSEVDS19PQkpFQ1RTID0gW107Ck5BTUVTUEFDRSRqc2NvbXAkNC5Qcm9wZXJ0eVR5cGVzID0gY2xhc3MgewogICAgY29uc3RydWN0b3IoKSB7fQogICAgc3RhdGljIFBpY2soYSkgewogICAgICAgIDAgPT09IFRZUEVfQ0hFQ0tfT0JKRUNUUy5sZW5ndGggJiYgKFRZUEVfQ0hFQ0tfT0JKRUNUUy5wdXNoKHsKICAgICAgICAgICAgY2hlY2tGdW5jOiBOQU1FU1BBQ0UkanNjb21wJDQuTWFwcy5Jc1BhaXJJZCwKICAgICAgICAgICAgcmVzdWx0OiB0aGlzLlBBSVIKICAgICAgICB9KSwgVFlQRV9DSEVDS19PQkpFQ1RTLnB1c2goewogICAgICAgICAgICBjaGVja0Z1bmM6IE5BTUVTUEFDRSRqc2NvbXAkNC5NYXBzLklzQ29sb3JJZCwKICAgICAgICAgICAgcmVzdWx0OiB0aGlzLkNPTE9SCiAgICAgICAgfSksIFRZUEVfQ0hFQ0tfT0JKRUNUUy5wdXNoKHsKICAgICAgICAgICAgY2hlY2tGdW5jOiBOQU1FU1BBQ0UkanNjb21wJDQuTWFwcy5Jc0FuZ2xlSWQsCiAgICAgICAgICAgIHJlc3VsdDogdGhpcy5BTkdMRQogICAgICAgIH0pLCBUWVBFX0NIRUNLX09CSkVDVFMucHVzaCh7CiAgICAgICAgICAgIGNoZWNrRnVuYzogTkFNRVNQQUNFJGpzY29tcCQ0Lk1hcHMuSXNWYWx1ZUlkLAogICAgICAgICAgICByZXN1bHQ6IHRoaXMuVkFMVUUKICAgICAgICB9KSwgVFlQRV9DSEVDS19PQkpFQ1RTLnB1c2goewogICAgICAgICAgICBjaGVja0Z1bmM6ICgpID0+ICEwLAogICAgICAgICAgICByZXN1bHQ6IHRoaXMuT1RIRVIKICAgICAgICB9KSk7CiAgICAgICAgQzMkanNjb21wJDI3MS5Jc0Zpbml0ZU51bWJlcihhKSAmJiAoYSA9IEMzJGpzY29tcCQyNzEuQmVoYXZpb3JzLlR3ZWVuLk1hcHMuR2V0UHJvcGVydHlGcm9tSW5kZXgoYSkpOwogICAgICAgIGZvciAoY29uc3QgYiBvZiBUWVBFX0NIRUNLX09CSkVDVFMpCiAgICAgICAgICAgIGlmIChiLmNoZWNrRnVuYyhhKSkgcmV0dXJuIGIucmVzdWx0CiAgICB9CiAgICBzdGF0aWMgZ2V0IFBBSVIoKSB7CiAgICAgICAgcmV0dXJuICJwYWlyIgogICAgfQogICAgc3RhdGljIGdldCBDT0xPUigpIHsKICAgICAgICByZXR1cm4gImNvbG9yIgogICAgfQogICAgc3RhdGljIGdldCBBTkdMRSgpIHsKICAgICAgICByZXR1cm4gImFuZ2xlIgogICAgfQogICAgc3RhdGljIGdldCBWQUxVRSgpIHsKICAgICAgICByZXR1cm4gInZhbHVlIgogICAgfQogICAgc3RhdGljIGdldCBPVEhFUigpIHsKICAgICAgICByZXR1cm4gIm90aGVyIgogICAgfQp9OwoidXNlIHN0cmljdCI7CmNvbnN0IEMzJGpzY29tcCQyNzIgPSBzZWxmLkMzOwpDMyRqc2NvbXAkMjcyLkJlaGF2aW9ycy5Ud2Vlbi5WYWx1ZUdldHRlcnMgPSBjbGFzcyB7CiAgICBjb25zdHJ1Y3RvcigpIHt9CiAgICBzdGF0aWMgX0dldFByb3BlcnR5QW5nbGVWYWx1ZShhKSB7CiAgICAgICAgYSA9IEMzJGpzY29tcCQyNzIudG9SYWRpYW5zKHBhcnNlRmxvYXQoYSkpOwogICAgICAgIHJldHVybiBDMyRqc2NvbXAkMjcyLmNsYW1wQW5nbGUoYSkKICAgIH0KICAgIHN0YXRpYyBfR2V0Q29sb3JQcm9wZXJ0eVZhbHVlKGEpIHsKICAgICAgICByZXR1cm4gYS5zbGljZSgwKQogICAgfQogICAgc3RhdGljIF9HZXRQcm9wZXJ0eVZhbHVlKGEpIHsKICAgICAgICByZXR1cm4gYQogICAgfQp9OwoidXNlIHN0cmljdCI7CmNvbnN0IEMzJGpzY29tcCQyNzMgPSBzZWxmLkMzLAogICAgQzNYJGpzY29tcCQyNyA9IHNlbGYuQzNYLAogICAgSUJlaGF2aW9ySW5zdGFuY2UkanNjb21wJDIgPSBzZWxmLklCZWhhdmlvckluc3RhbmNlLAogICAgRWFzZSRqc2NvbXAkNSA9IHNlbGYuRWFzZSwKICAgIE5BTUVTUEFDRSRqc2NvbXAkNiA9IEMzJGpzY29tcCQyNzMuQmVoYXZpb3JzLlR3ZWVuLAogICAgbWFwJGpzY29tcCQyNiA9IG5ldyBXZWFrTWFwLAogICAgVFdFRU5fUFJPUEVSVElFUyA9IG5ldyBNYXAoWwogICAgICAgIFsieCIsIHsKICAgICAgICAgICAgbmFtZTogIm9mZnNldFgiLAogICAgICAgICAgICB0eXBlOiAib25lIgogICAgICAgIH1dLAogICAgICAgIFsieSIsIHsKICAgICAgICAgICAgbmFtZTogIm9mZnNldFkiLAogICAgICAgICAgICB0eXBlOiAib25lIgogICAgICAgIH1dLAogICAgICAgIFsid2lkdGgiLCB7CiAgICAgICAgICAgIG5hbWU6ICJvZmZzZXRXaWR0aCIsCiAgICAgICAgICAgIHR5cGU6ICJvbmUiCiAgICAgICAgfV0sCiAgICAgICAgWyJoZWlnaHQiLCB7CiAgICAgICAgICAgIG5hbWU6ICJvZmZzZXRIZWlnaHQiLAogICAgICAgICAgICB0eXBlOiAib25lIgogICAgICAgIH1dLAogICAgICAgIFsiYW5nbGUiLCB7CiAgICAgICAgICAgIG5hbWU6ICJvZmZzZXRBbmdsZSIsCiAgICAgICAgICAgIHR5cGU6ICJvbmUiCiAgICAgICAgfV0sCiAgICAgICAgWyJvcGFjaXR5IiwgewogICAgICAgICAgICBuYW1lOiAib2Zmc2V0T3BhY2l0eSIsCiAgICAgICAgICAgIHR5cGU6ICJvbmUiCiAgICAgICAgfV0sCiAgICAgICAgWyJjb2xvciIsIHsKICAgICAgICAgICAgbmFtZTogIm9mZnNldENvbG9yIiwKICAgICAgICAgICAgdHlwZTogImNvbG9yIgogICAgICAgIH1dLAogICAgICAgIFsiei1lbGV2YXRpb24iLCB7CiAgICAgICAgICAgIG5hbWU6ICJvZmZzZXRaRWxldmF0aW9uIiwKICAgICAgICAgICAgdHlwZTogIm9uZSIKICAgICAgICB9XSwKICAgICAgICBbIngtc2NhbGUiLCB7CiAgICAgICAgICAgIG5hbWU6ICJvZmZzZXRTY2FsZVgiLAogICAgICAgICAgICB0eXBlOiAib25lIgogICAgICAgIH1dLAogICAgICAgIFsieS1zY2FsZSIsIHsKICAgICAgICAgICAgbmFtZTogIm9mZnNldFNjYWxlWSIsCiAgICAgICAgICAgIHR5cGU6ICJvbmUiCiAgICAgICAgfV0sCiAgICAgICAgWyJwb3NpdGlvbiIsIHsKICAgICAgICAgICAgbmFtZTogInBvc2l0aW9uIiwKICAgICAgICAgICAgdHlwZTogInR3byIKICAgICAgICB9XSwKICAgICAgICBbInNpemUiLCB7CiAgICAgICAgICAgIG5hbWU6ICJzaXplIiwKICAgICAgICAgICAgdHlwZTogInR3byIKICAgICAgICB9XSwKICAgICAgICBbInNjYWxlIiwgewogICAgICAgICAgICBuYW1lOiAic2NhbGUiLAogICAgICAgICAgICB0eXBlOiAidHdvIgogICAgICAgIH1dLAogICAgICAgIFsidmFsdWUiLCB7CiAgICAgICAgICAgIG5hbWU6ICJ2YWx1ZSIsCiAgICAgICAgICAgIHR5cGU6ICJ2YWx1ZSIKICAgICAgICB9XQogICAgXSk7CgpmdW5jdGlvbiBnZXRJbmRleEZvckVhc2UoYSkgewogICAgQzNYJGpzY29tcCQyNy5SZXF1aXJlU3RyaW5nKGEpOwogICAgdmFyIGIgPSBFYXNlJGpzY29tcCQ1LlRvSW50ZXJuYWwoYSk7CiAgICBiID0gYiA/IEVhc2UkanNjb21wJDUuR2V0SW5kZXhGb3JFYXNlKGIsIG51bGwpIDogRWFzZSRqc2NvbXAkNS5HZXRJbmRleEZvckVhc2UoYSwgbnVsbCk7CiAgICBpZiAoLTEgPT09IGIpIHRocm93IEVycm9yKGBpbnZhbGlkIGVhc2UgbmFtZSAnJHthfSdgKTsKICAgIHJldHVybiBiCn0KY29uc3QgVFdFRU5fT1BUUyA9IHsKICAgICAgICB0YWdzOiAiIiwKICAgICAgICBkZXN0cm95T25Db21wbGV0ZTogITEsCiAgICAgICAgbG9vcDogITEsCiAgICAgICAgcGluZ1Bvbmc6ICExLAogICAgICAgIHN0YXJ0VmFsdWU6IDAKICAgIH0sCiAgICBJX1RXRUVOX09QVFMgPSB7CiAgICAgICAgZWFzZVRvSW5kZXhGdW5jOiBnZXRJbmRleEZvckVhc2UKICAgIH07CnNlbGYuSVR3ZWVuQmVoYXZpb3JJbnN0YW5jZSA9IGNsYXNzIGV4dGVuZHMgSUJlaGF2aW9ySW5zdGFuY2UkanNjb21wJDIgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgICAgc3VwZXIoKTsKICAgICAgICBtYXAkanNjb21wJDI2LnNldCh0aGlzLCBJQmVoYXZpb3JJbnN0YW5jZSRqc2NvbXAkMi5fR2V0SW5pdEluc3QoKS5HZXRTZGtJbnN0YW5jZSgpKQogICAgfQogICAgc3RhcnRUd2VlbihhLCBiLCBkLCBjLCBlKSB7CiAgICAgICAgY29uc3QgZyA9IG1hcCRqc2NvbXAkMjYuZ2V0KHRoaXMpOwogICAgICAgIGlmICghZy5Jc0VuYWJsZWQoKSB8fCAhZy5Jc0luc3RhbmNlVmFsaWQoKSkgcmV0dXJuIG51bGw7CiAgICAgICAgY29uc3QgayA9IFRXRUVOX1BST1BFUlRJRVMuZ2V0KGEpOwogICAgICAgIGlmICghaykgdGhyb3cgRXJyb3IoImludmFsaWQgdHdlZW4gcHJvcGVydHkiKTsKICAgICAgICAib25lIiA9PT0gay50eXBlIHx8ICJ2YWx1ZSIgPT09IGsudHlwZSA/IEMzWCRqc2NvbXAkMjcuUmVxdWlyZU51bWJlcihiKSA6IChDM1gkanNjb21wJDI3LlJlcXVpcmVBcnJheShiKSwgInR3byIgPT09IGsudHlwZSA/IChDM1gkanNjb21wJDI3LlJlcXVpcmVOdW1iZXIoYlswXSksCiAgICAgICAgICAgIEMzWCRqc2NvbXAkMjcuUmVxdWlyZU51bWJlcihiWzFdKSkgOiAiY29sb3IiID09PSBrLnR5cGUgJiYgKEMzWCRqc2NvbXAkMjcuUmVxdWlyZU51bWJlcihiWzBdKSwgQzNYJGpzY29tcCQyNy5SZXF1aXJlTnVtYmVyKGJbMV0pLCBDM1gkanNjb21wJDI3LlJlcXVpcmVOdW1iZXIoYlsyXSkpKTsKICAgICAgICAiYW5nbGUiID09PSBhID8gYiA9IEMzJGpzY29tcCQyNzMudG9EZWdyZWVzKGIpIDogIm9wYWNpdHkiID09PSBhID8gYiAqPSAxMDAgOiAiY29sb3IiID09PSBhICYmIChiID0gQzMkanNjb21wJDI3My5QYWNrUkdCRXgoYlswXSwgYlsxXSwgYlsyXSkpOwogICAgICAgIGEgPSBnZXRJbmRleEZvckVhc2UoYyk7CiAgICAgICAgQzNYJGpzY29tcCQyNy5SZXF1aXJlRmluaXRlTnVtYmVyKGQpOwogICAgICAgIGUgPSBPYmplY3QuYXNzaWduKHt9LCBUV0VFTl9PUFRTLCBlKTsKICAgICAgICAidmFsdWUiID09PSBrLnR5cGUgJiYgQzNYJGpzY29tcCQyNy5SZXF1aXJlTnVtYmVyKGUuc3RhcnRWYWx1ZSk7CiAgICAgICAgbGV0IG07CiAgICAgICAgIm9uZSIgPT09IGsudHlwZSB8fCAiY29sb3IiID09PSBrLnR5cGUgPyBtID0gZy5DcmVhdGVUd2VlbihOQU1FU1BBQ0UkanNjb21wJDYuVHdlZW5Bcmd1bWVudHMuT25lUHJvcGVydHkoZywKICAgICAgICAgICAgZS50YWdzLCBrLm5hbWUsIGIsIGQsIGEsICEhZS5kZXN0cm95T25Db21wbGV0ZSwgISFlLmxvb3AsICEhZS5waW5nUG9uZykpIDogInR3byIgPT09IGsudHlwZSA/IG0gPSBnLkNyZWF0ZVR3ZWVuKE5BTUVTUEFDRSRqc2NvbXAkNi5Ud2VlbkFyZ3VtZW50cy5Ud29Qcm9wZXJ0aWVzKGcsIGUudGFncywgay5uYW1lLCBiWzBdLCBiWzFdLCBkLCBhLCAhIWUuZGVzdHJveU9uQ29tcGxldGUsICEhZS5sb29wLCAhIWUucGluZ1BvbmcpKSA6ICJ2YWx1ZSIgPT09IGsudHlwZSAmJiAobSA9IGcuQ3JlYXRlVHdlZW4oTkFNRVNQQUNFJGpzY29tcCQ2LlR3ZWVuQXJndW1lbnRzLlZhbHVlUHJvcGVydHkoZywgZS50YWdzLCBlLnN0YXJ0VmFsdWUsIGIsIGQsIGEsICEhZS5kZXN0cm95T25Db21wbGV0ZSwgISFlLmxvb3AsICEhZS5waW5nUG9uZykpKTsKICAgICAgICBpZiAoIW0uUGxheSgpKSB0aHJvdyBFcnJvcigiZmFpbGVkIHRvIHN0YXJ0IHR3ZWVuIik7CiAgICAgICAgcmV0dXJuIG0uR2V0SVR3ZWVuU3RhdGUoZywgSV9UV0VFTl9PUFRTKQogICAgfSogYWxsVHdlZW5zKCkgewogICAgICAgIGNvbnN0IGEgPSBtYXAkanNjb21wJDI2LmdldCh0aGlzKTsKICAgICAgICBmb3IgKGNvbnN0IGIgb2YgYS5BbGxUd2VlbnMoKSkgeWllbGQgYi5HZXRJVHdlZW5TdGF0ZShhLCBJX1RXRUVOX09QVFMpCiAgICB9KiB0d2VlbnNCeVRhZ3MoYSkgewogICAgICAgIEMzWCRqc2NvbXAkMjcuUmVxdWlyZVN0cmluZyhhKTsKICAgICAgICBjb25zdCBiID0gbWFwJGpzY29tcCQyNi5nZXQodGhpcyk7CiAgICAgICAgZm9yIChjb25zdCBkIG9mIGIuR2V0VHdlZW5zKGEpKSB5aWVsZCBkLkdldElUd2VlblN0YXRlKGIsIElfVFdFRU5fT1BUUykKICAgIH0KICAgIGdldCBpc0VuYWJsZWQoKSB7CiAgICAgICAgcmV0dXJuIG1hcCRqc2NvbXAkMjYuZ2V0KHRoaXMpLklzRW5hYmxlZCgpCiAgICB9CiAgICBzZXQgaXNFbmFibGVkKGEpIHsKICAgICAgICBtYXAkanNjb21wJDI2LmdldCh0aGlzKS5TZXRFbmFibGVkKGEpCiAgICB9Cn07CiJ1c2Ugc3RyaWN0IjsKY29uc3QgQzMkanNjb21wJDI3NCA9IHNlbGYuQzM7CkMzJGpzY29tcCQyNzQuQmVoYXZpb3JzLmRlc3Ryb3kgPSBjbGFzcyBleHRlbmRzIEMzJGpzY29tcCQyNzQuU0RLQmVoYXZpb3JCYXNlIHsKICAgIGNvbnN0cnVjdG9yKGEpIHsKICAgICAgICBzdXBlcihhKQogICAgfQogICAgUmVsZWFzZSgpIHsKICAgICAgICBzdXBlci5SZWxlYXNlKCkKICAgIH0KfTsKY29uc3QgQzMkanNjb21wJDI3NSA9IHNlbGYuQzM7CkMzJGpzY29tcCQyNzUuQmVoYXZpb3JzLmRlc3Ryb3kuVHlwZSA9IGNsYXNzIGV4dGVuZHMgQzMkanNjb21wJDI3NS5TREtCZWhhdmlvclR5cGVCYXNlIHsKICAgIGNvbnN0cnVjdG9yKGEpIHsKICAgICAgICBzdXBlcihhKQogICAgfQogICAgUmVsZWFzZSgpIHsKICAgICAgICBzdXBlci5SZWxlYXNlKCkKICAgIH0KICAgIE9uQ3JlYXRlKCkge30KfTsKY29uc3QgQzMkanNjb21wJDI3NiA9IHNlbGYuQzM7CkMzJGpzY29tcCQyNzYuQmVoYXZpb3JzLmRlc3Ryb3kuSW5zdGFuY2UgPSBjbGFzcyBleHRlbmRzIEMzJGpzY29tcCQyNzYuU0RLQmVoYXZpb3JJbnN0YW5jZUJhc2UgewogICAgY29uc3RydWN0b3IoYSwgYikgewogICAgICAgIHN1cGVyKGEpOwogICAgICAgIHRoaXMuX1N0YXJ0VGlja2luZygpCiAgICB9CiAgICBSZWxlYXNlKCkgewogICAgICAgIHN1cGVyLlJlbGVhc2UoKQogICAgfQogICAgVGljaygpIHsKICAgICAgICB2YXIgYSA9IHRoaXMuX2luc3QuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgY29uc3QgYiA9IGEuR2V0Qm91bmRpbmdCb3goKTsKICAgICAgICBhID0gYS5HZXRMYXlvdXQoKTsKICAgICAgICAoMCA+IGIuZ2V0UmlnaHQoKSB8fCAwID4gYi5nZXRCb3R0b20oKSB8fCBiLmdldExlZnQoKSA+IGEuR2V0V2lkdGgoKSB8fCBiLmdldFRvcCgpID4gYS5HZXRIZWlnaHQoKSkgJiYgdGhpcy5fcnVudGltZS5EZXN0cm95SW5zdGFuY2UodGhpcy5faW5zdCkKICAgIH0KfTsKc2VsZi5DMy5CZWhhdmlvcnMuZGVzdHJveS5DbmRzID0ge307CnNlbGYuQzMuQmVoYXZpb3JzLmRlc3Ryb3kuQWN0cyA9IHt9OwpzZWxmLkMzLkJlaGF2aW9ycy5kZXN0cm95LkV4cHMgPSB7fTsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkMjgwID0gc2VsZi5DMzsKQzMkanNjb21wJDI4MC5CZWhhdmlvcnMuQnVsbGV0ID0gY2xhc3MgZXh0ZW5kcyBDMyRqc2NvbXAkMjgwLlNES0JlaGF2aW9yQmFzZSB7CiAgICBjb25zdHJ1Y3RvcihhKSB7CiAgICAgICAgc3VwZXIoYSkKICAgIH0KICAgIFJlbGVhc2UoKSB7CiAgICAgICAgc3VwZXIuUmVsZWFzZSgpCiAgICB9Cn07CmNvbnN0IEMzJGpzY29tcCQyODEgPSBzZWxmLkMzOwpDMyRqc2NvbXAkMjgxLkJlaGF2aW9ycy5CdWxsZXQuVHlwZSA9IGNsYXNzIGV4dGVuZHMgQzMkanNjb21wJDI4MS5TREtCZWhhdmlvclR5cGVCYXNlIHsKICAgIGNvbnN0cnVjdG9yKGEpIHsKICAgICAgICBzdXBlcihhKQogICAgfQogICAgUmVsZWFzZSgpIHsKICAgICAgICBzdXBlci5SZWxlYXNlKCkKICAgIH0KICAgIE9uQ3JlYXRlKCkge30KfTsKY29uc3QgQzMkanNjb21wJDI4MiA9IHNlbGYuQzMsCiAgICBDM1gkanNjb21wJDI4ID0gc2VsZi5DM1gsCiAgICBJQmVoYXZpb3JJbnN0YW5jZSRqc2NvbXAkMyA9IHNlbGYuSUJlaGF2aW9ySW5zdGFuY2U7CkMzJGpzY29tcCQyODIuQmVoYXZpb3JzLkJ1bGxldC5JbnN0YW5jZSA9IGNsYXNzIGV4dGVuZHMgQzMkanNjb21wJDI4Mi5TREtCZWhhdmlvckluc3RhbmNlQmFzZSB7CiAgICBjb25zdHJ1Y3RvcihhLCBiKSB7CiAgICAgICAgc3VwZXIoYSk7CiAgICAgICAgYSA9IHRoaXMuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgdGhpcy5fZyA9IHRoaXMuX2FjYyA9IHRoaXMuX3NwZWVkID0gMDsKICAgICAgICB0aGlzLl9pc1N0ZXBwaW5nID0gdGhpcy5fc2V0QW5nbGUgPSB0aGlzLl9ib3VuY2VPZmZTb2xpZCA9ICExOwogICAgICAgIHRoaXMuX2lzRW5hYmxlZCA9ICEwOwogICAgICAgIHRoaXMuX2R5ID0gdGhpcy5fZHggPSAwOwogICAgICAgIHRoaXMuX2xhc3RYID0gYS5HZXRYKCk7CiAgICAgICAgdGhpcy5fbGFzdFkgPSBhLkdldFkoKTsKICAgICAgICB0aGlzLl9sYXN0S25vd25BbmdsZSA9IGEuR2V0QW5nbGUoKTsKICAgICAgICB0aGlzLl90cmF2ZWxsZWQgPSAwOwogICAgICAgIHRoaXMuX3N0ZXBTaXplID0gTWF0aC5taW4oTWF0aC5hYnMoYS5HZXRXaWR0aCgpKSwgTWF0aC5hYnMoYS5HZXRIZWlnaHQoKSkgLyAyKTsKICAgICAgICB0aGlzLl9zdG9wU3RlcHBpbmcgPSAhMTsKICAgICAgICBiICYmICh0aGlzLl9zcGVlZCA9IGJbMF0sIHRoaXMuX2FjYyA9IGJbMV0sIHRoaXMuX2cgPQogICAgICAgICAgICBiWzJdLCB0aGlzLl9ib3VuY2VPZmZTb2xpZCA9ICEhYlszXSwgdGhpcy5fc2V0QW5nbGUgPSAhIWJbNF0sIHRoaXMuX2lzU3RlcHBpbmcgPSAhIWJbNV0sIHRoaXMuX2lzRW5hYmxlZCA9ICEhYls2XSk7CiAgICAgICAgYiA9IGEuR2V0QW5nbGUoKTsKICAgICAgICB0aGlzLl9keCA9IE1hdGguY29zKGIpICogdGhpcy5fc3BlZWQ7CiAgICAgICAgdGhpcy5fZHkgPSBNYXRoLnNpbihiKSAqIHRoaXMuX3NwZWVkOwogICAgICAgIHRoaXMuX2lzRW5hYmxlZCAmJiAodGhpcy5fU3RhcnRUaWNraW5nKCksIHRoaXMuX2JvdW5jZU9mZlNvbGlkICYmIHRoaXMuX1N0YXJ0UG9zdFRpY2tpbmcoKSkKICAgIH0KICAgIFJlbGVhc2UoKSB7CiAgICAgICAgc3VwZXIuUmVsZWFzZSgpCiAgICB9CiAgICBTYXZlVG9Kc29uKCkgewogICAgICAgIGNvbnN0IGEgPSB7CiAgICAgICAgICAgIGR4OiB0aGlzLl9keCwKICAgICAgICAgICAgZHk6IHRoaXMuX2R5LAogICAgICAgICAgICBseDogdGhpcy5fbGFzdFgsCiAgICAgICAgICAgIGx5OiB0aGlzLl9sYXN0WSwKICAgICAgICAgICAgbGthOiB0aGlzLl9sYXN0S25vd25BbmdsZSwKICAgICAgICAgICAgdDogdGhpcy5fdHJhdmVsbGVkCiAgICAgICAgfTsKICAgICAgICAwICE9PSB0aGlzLl9hY2MgJiYgKGEuYWNjID0gdGhpcy5fYWNjKTsKICAgICAgICAwICE9PSB0aGlzLl9nICYmIChhLmcgPSB0aGlzLl9nKTsKICAgICAgICB0aGlzLl9pc1N0ZXBwaW5nICYmIChhLnN0ID0KICAgICAgICAgICAgdGhpcy5faXNTdGVwcGluZyk7CiAgICAgICAgdGhpcy5faXNFbmFibGVkIHx8IChhLmUgPSB0aGlzLl9pc0VuYWJsZWQpOwogICAgICAgIHRoaXMuX2JvdW5jZU9mZlNvbGlkICYmIChhLmJvcyA9IHRoaXMuX2JvdW5jZU9mZlNvbGlkKTsKICAgICAgICB0aGlzLl9zZXRBbmdsZSAmJiAoYS5zYSA9IHRoaXMuX3NldEFuZ2xlKTsKICAgICAgICByZXR1cm4gYQogICAgfQogICAgTG9hZEZyb21Kc29uKGEpIHsKICAgICAgICB0aGlzLl9keCA9IGEuZHg7CiAgICAgICAgdGhpcy5fZHkgPSBhLmR5OwogICAgICAgIHRoaXMuX2xhc3RYID0gYS5seDsKICAgICAgICB0aGlzLl9sYXN0WSA9IGEubHk7CiAgICAgICAgdGhpcy5fbGFzdEtub3duQW5nbGUgPSBhLmxrYTsKICAgICAgICB0aGlzLl90cmF2ZWxsZWQgPSBhLnQ7CiAgICAgICAgdGhpcy5fYWNjID0gYS5oYXNPd25Qcm9wZXJ0eSgiYWNjIikgPyBhLmFjYyA6IDA7CiAgICAgICAgdGhpcy5fZyA9IGEuaGFzT3duUHJvcGVydHkoImciKSA/IGEuZyA6IDA7CiAgICAgICAgdGhpcy5faXNTdGVwcGluZyA9IGEuaGFzT3duUHJvcGVydHkoInN0IikgPyBhLnN0IDogITE7CiAgICAgICAgdGhpcy5fYm91bmNlT2ZmU29saWQgPSBhLmhhc093blByb3BlcnR5KCJib3MiKSA/IGEuYm9zIDogITE7CiAgICAgICAgdGhpcy5fc2V0QW5nbGUgPSBhLmhhc093blByb3BlcnR5KCJzYSIpID8gYS5zYSA6CiAgICAgICAgICAgICExOwogICAgICAgIHRoaXMuX1NldEVuYWJsZWQoYS5oYXNPd25Qcm9wZXJ0eSgiZSIpID8gYS5lIDogITApCiAgICB9CiAgICBUaWNrKCkgewogICAgICAgIGlmICh0aGlzLl9pc0VuYWJsZWQpIHsKICAgICAgICAgICAgdmFyIGEgPSB0aGlzLl9ydW50aW1lLkdldER0KHRoaXMuX2luc3QpLAogICAgICAgICAgICAgICAgYiA9IHRoaXMuX2luc3QuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgIGlmIChiLkdldEFuZ2xlKCkgIT09IHRoaXMuX2xhc3RLbm93bkFuZ2xlKSB7CiAgICAgICAgICAgICAgICB2YXIgZCA9IGIuR2V0QW5nbGUoKTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9zZXRBbmdsZSkgewogICAgICAgICAgICAgICAgICAgIHZhciBjID0gQzMkanNjb21wJDI4Mi5kaXN0YW5jZVRvKDAsIDAsIHRoaXMuX2R4LCB0aGlzLl9keSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZHggPSBNYXRoLmNvcyhkKSAqIGM7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZHkgPSBNYXRoLnNpbihkKSAqIGMKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMuX2xhc3RLbm93bkFuZ2xlID0gZAogICAgICAgICAgICB9CiAgICAgICAgICAgIGQgPSBjID0gMDsKICAgICAgICAgICAgaWYgKDAgIT09IHRoaXMuX2FjYykgewogICAgICAgICAgICAgICAgbGV0IGUgPSBDMyRqc2NvbXAkMjgyLmRpc3RhbmNlVG8oMCwgMCwgdGhpcy5fZHgsIHRoaXMuX2R5KSwKICAgICAgICAgICAgICAgICAgICBnOwogICAgICAgICAgICAgICAgZyA9IDAgPT09IHRoaXMuX2R4ICYmIDAgPT09IHRoaXMuX2R5ID8gYi5HZXRBbmdsZSgpIDogQzMkanNjb21wJDI4Mi5hbmdsZVRvKDAsIDAsIHRoaXMuX2R4LAogICAgICAgICAgICAgICAgICAgIHRoaXMuX2R5KTsKICAgICAgICAgICAgICAgIGUgKz0gdGhpcy5fYWNjICogYTsKICAgICAgICAgICAgICAgIGMgPSBNYXRoLmNvcyhnKSAqIHRoaXMuX2FjYzsKICAgICAgICAgICAgICAgIGQgPSBNYXRoLnNpbihnKSAqIHRoaXMuX2FjYzsKICAgICAgICAgICAgICAgIDAgPiBlICYmIChkID0gYyA9IGUgPSAwKTsKICAgICAgICAgICAgICAgIHRoaXMuX2R4ID0gTWF0aC5jb3MoZykgKiBlOwogICAgICAgICAgICAgICAgdGhpcy5fZHkgPSBNYXRoLnNpbihnKSAqIGUKICAgICAgICAgICAgfQogICAgICAgICAgICAwICE9PSB0aGlzLl9nICYmICh0aGlzLl9keSArPSB0aGlzLl9nICogYSwgZCArPSB0aGlzLl9nKTsKICAgICAgICAgICAgdGhpcy5fbGFzdFggPSBiLkdldFgoKTsKICAgICAgICAgICAgdGhpcy5fbGFzdFkgPSBiLkdldFkoKTsKICAgICAgICAgICAgaWYgKDAgIT09IHRoaXMuX2R4IHx8IDAgIT09IHRoaXMuX2R5KSBjID0gdGhpcy5fZHggKiBhICsgLjUgKiBjICogYSAqIGEsIGEgPSB0aGlzLl9keSAqIGEgKyAuNSAqIGQgKiBhICogYSwgZCA9IEMzJGpzY29tcCQyODIuZGlzdGFuY2VUbygwLCAwLCBjLCBhKSwgdGhpcy5fTW92ZUJ5KGMsIGEsIGQpLCB0aGlzLl90cmF2ZWxsZWQgKz0gZCwgIXRoaXMuX3NldEFuZ2xlIHx8IDAgPT09IGMgJiYgMCA9PT0gYSB8fCAoYSA9IEMzJGpzY29tcCQyODIuYW5nbGVUbygwLCAwLCBjLCBhKSwgYi5TZXRBbmdsZShhKSwgdGhpcy5fbGFzdEtub3duQW5nbGUgPSBiLkdldEFuZ2xlKCkpLCBiLlNldEJib3hDaGFuZ2VkKCkKICAgICAgICB9CiAgICB9CiAgICBfTW92ZUJ5KGEsCiAgICAgICAgYiwgZCkgewogICAgICAgIGNvbnN0IGMgPSB0aGlzLkdldFdvcmxkSW5mbygpOwogICAgICAgIGlmICghdGhpcy5faXNTdGVwcGluZyB8fCBkIDw9IHRoaXMuX3N0ZXBTaXplKSBjLk9mZnNldFhZKGEsIGIpLCBjLlNldEJib3hDaGFuZ2VkKCksIHRoaXMuX2lzU3RlcHBpbmcgJiYgdGhpcy5UcmlnZ2VyKEMzJGpzY29tcCQyODIuQmVoYXZpb3JzLkJ1bGxldC5DbmRzLk9uU3RlcCk7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHRoaXMuX3N0b3BTdGVwcGluZyA9ICExOwogICAgICAgICAgICB2YXIgZSA9IGMuR2V0WCgpLAogICAgICAgICAgICAgICAgZyA9IGMuR2V0WSgpLAogICAgICAgICAgICAgICAgayA9IGUgKyBhLAogICAgICAgICAgICAgICAgbSA9IGcgKyBiOwogICAgICAgICAgICBiID0gQzMkanNjb21wJDI4Mi5hbmdsZVRvKDAsIDAsIGEsIGIpOwogICAgICAgICAgICBhID0gTWF0aC5jb3MoYikgKiB0aGlzLl9zdGVwU2l6ZTsKICAgICAgICAgICAgYiA9IE1hdGguc2luKGIpICogdGhpcy5fc3RlcFNpemU7CiAgICAgICAgICAgIGQgPSBNYXRoLmZsb29yKGQgLyB0aGlzLl9zdGVwU2l6ZSk7CiAgICAgICAgICAgIGZvciAobGV0IG4gPSAxOyBuIDw9IGQ7ICsrbikKICAgICAgICAgICAgICAgIGlmIChjLlNldFhZKGUgKyBhICogbiwgZyArIGIgKiBuKSwgYy5TZXRCYm94Q2hhbmdlZCgpLCB0aGlzLlRyaWdnZXIoQzMkanNjb21wJDI4Mi5CZWhhdmlvcnMuQnVsbGV0LkNuZHMuT25TdGVwKSwgdGhpcy5faW5zdC5Jc0Rlc3Ryb3llZCgpIHx8CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc3RvcFN0ZXBwaW5nKSByZXR1cm47CiAgICAgICAgICAgIGMuU2V0WFkoaywgbSk7CiAgICAgICAgICAgIGMuU2V0QmJveENoYW5nZWQoKTsKICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKEMzJGpzY29tcCQyODIuQmVoYXZpb3JzLkJ1bGxldC5DbmRzLk9uU3RlcCkKICAgICAgICB9CiAgICB9CiAgICBQb3N0VGljaygpIHsKICAgICAgICBpZiAodGhpcy5faXNFbmFibGVkICYmIHRoaXMuX2JvdW5jZU9mZlNvbGlkICYmICgwICE9PSB0aGlzLl9keCB8fCAwICE9PSB0aGlzLl9keSkpIHsKICAgICAgICAgICAgdmFyIGEgPSB0aGlzLl9ydW50aW1lLkdldER0KHRoaXMuX2luc3QpLAogICAgICAgICAgICAgICAgYiA9IHRoaXMuX2luc3QuR2V0V29ybGRJbmZvKCksCiAgICAgICAgICAgICAgICBkID0gdGhpcy5fcnVudGltZS5HZXRDb2xsaXNpb25FbmdpbmUoKSwKICAgICAgICAgICAgICAgIGMgPSBkLlRlc3RPdmVybGFwU29saWQodGhpcy5faW5zdCk7CiAgICAgICAgICAgIGlmIChjKSB7CiAgICAgICAgICAgICAgICBkLlJlZ2lzdGVyQ29sbGlzaW9uKHRoaXMuX2luc3QsIGMpOwogICAgICAgICAgICAgICAgYyA9IEMzJGpzY29tcCQyODIuZGlzdGFuY2VUbygwLCAwLCB0aGlzLl9keCwgdGhpcy5fZHkpOwogICAgICAgICAgICAgICAgY29uc3QgZSA9IGQuQ2FsY3VsYXRlQm91bmNlQW5nbGUodGhpcy5faW5zdCwgdGhpcy5fbGFzdFgsIHRoaXMuX2xhc3RZKTsKICAgICAgICAgICAgICAgIHRoaXMuX2R4ID0KICAgICAgICAgICAgICAgICAgICBNYXRoLmNvcyhlKSAqIGM7CiAgICAgICAgICAgICAgICB0aGlzLl9keSA9IE1hdGguc2luKGUpICogYzsKICAgICAgICAgICAgICAgIGIuT2Zmc2V0WFkodGhpcy5fZHggKiBhLCB0aGlzLl9keSAqIGEpOwogICAgICAgICAgICAgICAgYi5TZXRCYm94Q2hhbmdlZCgpOwogICAgICAgICAgICAgICAgdGhpcy5fc2V0QW5nbGUgJiYgKGIuU2V0QW5nbGUoZSksIHRoaXMuX2xhc3RLbm93bkFuZ2xlID0gYi5HZXRBbmdsZSgpLCBiLlNldEJib3hDaGFuZ2VkKCkpOwogICAgICAgICAgICAgICAgZC5QdXNoT3V0U29saWQodGhpcy5faW5zdCwgdGhpcy5fZHggLyBjLCB0aGlzLl9keSAvIGMsIE1hdGgubWF4KDIuNSAqIGMgKiBhLCAzMCkpIHx8IGQuUHVzaE91dFNvbGlkTmVhcmVzdCh0aGlzLl9pbnN0LCAxMDApCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBHZXRQcm9wZXJ0eVZhbHVlQnlJbmRleChhKSB7CiAgICAgICAgc3dpdGNoIChhKSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9HZXRTcGVlZCgpOwogICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fR2V0QWNjZWxlcmF0aW9uKCk7CiAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9HZXRHcmF2aXR5KCk7CiAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9zZXRBbmdsZTsKICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2lzU3RlcHBpbmc7CiAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9Jc0VuYWJsZWQoKQogICAgICAgIH0KICAgIH0KICAgIFNldFByb3BlcnR5VmFsdWVCeUluZGV4KGEsCiAgICAgICAgYikgewogICAgICAgIHN3aXRjaCAoYSkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICB0aGlzLl9TZXRTcGVlZChiKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICB0aGlzLl9hY2MgPSBiOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgIHRoaXMuX2cgPSBiOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgIHRoaXMuX3NldEFuZ2xlID0gISFiOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgIHRoaXMuX2lzU3RlcHBpbmcgPSAhIWI7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgICAgdGhpcy5fU2V0RW5hYmxlZCghIWIpCiAgICAgICAgfQogICAgfQogICAgX1NldFNwZWVkKGEpIHsKICAgICAgICBjb25zdCBiID0gQzMkanNjb21wJDI4Mi5hbmdsZVRvKDAsIDAsIHRoaXMuX2R4LCB0aGlzLl9keSk7CiAgICAgICAgdGhpcy5fZHggPSBNYXRoLmNvcyhiKSAqIGE7CiAgICAgICAgdGhpcy5fZHkgPSBNYXRoLnNpbihiKSAqIGEKICAgIH0KICAgIF9HZXRTcGVlZCgpIHsKICAgICAgICByZXR1cm4gQzMkanNjb21wJDI4Mi5yb3VuZDZkcChDMyRqc2NvbXAkMjgyLmRpc3RhbmNlVG8oMCwgMCwgdGhpcy5fZHgsIHRoaXMuX2R5KSkKICAgIH0KICAgIF9TZXRBY2NlbGVyYXRpb24oYSkgewogICAgICAgIHRoaXMuX2FjYyA9IGEKICAgIH0KICAgIF9HZXRBY2NlbGVyYXRpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2FjYwogICAgfQogICAgX1NldEdyYXZpdHkoYSkgewogICAgICAgIHRoaXMuX2cgPSBhCiAgICB9CiAgICBfR2V0R3Jhdml0eSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZwogICAgfQogICAgX1NldEFuZ2xlT2ZNb3Rpb24oYSkgewogICAgICAgIGNvbnN0IGIgPQogICAgICAgICAgICBDMyRqc2NvbXAkMjgyLmRpc3RhbmNlVG8oMCwgMCwgdGhpcy5fZHgsIHRoaXMuX2R5KTsKICAgICAgICB0aGlzLl9keCA9IE1hdGguY29zKGEpICogYjsKICAgICAgICB0aGlzLl9keSA9IE1hdGguc2luKGEpICogYgogICAgfQogICAgX0dldEFuZ2xlT2ZNb3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIEMzJGpzY29tcCQyODIuYW5nbGVUbygwLCAwLCB0aGlzLl9keCwgdGhpcy5fZHkpCiAgICB9CiAgICBfU2V0Qm91bmNlT2ZmU29saWRzKGEpIHsKICAgICAgICBhID0gISFhOwogICAgICAgIHRoaXMuX2JvdW5jZU9mZlNvbGlkICE9PSBhICYmICh0aGlzLl9ib3VuY2VPZmZTb2xpZCA9IGEsIHRoaXMuX2lzRW5hYmxlZCAmJiAodGhpcy5fYm91bmNlT2ZmU29saWQgPyB0aGlzLl9TdGFydFBvc3RUaWNraW5nKCkgOiB0aGlzLl9TdG9wUG9zdFRpY2tpbmcoKSkpCiAgICB9CiAgICBfSXNCb3VuY2VPZmZTb2xpZHMoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2JvdW5jZU9mZlNvbGlkCiAgICB9CiAgICBfU2V0RGlzdGFuY2VUcmF2ZWxsZWQoYSkgewogICAgICAgIHRoaXMuX3RyYXZlbGxlZCA9IGEKICAgIH0KICAgIF9HZXREaXN0YW5jZVRyYXZlbGxlZCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdHJhdmVsbGVkCiAgICB9CiAgICBfU2V0RW5hYmxlZChhKSB7CiAgICAgICAgKHRoaXMuX2lzRW5hYmxlZCA9ICEhYSkgPyAodGhpcy5fU3RhcnRUaWNraW5nKCksIHRoaXMuX2JvdW5jZU9mZlNvbGlkICYmIHRoaXMuX1N0YXJ0UG9zdFRpY2tpbmcoKSkgOiAodGhpcy5fU3RvcFRpY2tpbmcoKSwgdGhpcy5fU3RvcFBvc3RUaWNraW5nKCkpCiAgICB9CiAgICBfSXNFbmFibGVkKCkgewogICAgICAgIHJldHVybiB0aGlzLl9pc0VuYWJsZWQKICAgIH0KICAgIEdldERlYnVnZ2VyUHJvcGVydGllcygpIHsKICAgICAgICByZXR1cm4gW3sKICAgICAgICAgICAgdGl0bGU6ICIkIiArIHRoaXMuR2V0QmVoYXZpb3JUeXBlKCkuR2V0TmFtZSgpLAogICAgICAgICAgICBwcm9wZXJ0aWVzOiBbewogICAgICAgICAgICAgICAgICAgIG5hbWU6ICJiZWhhdmlvcnMuYnVsbGV0LmRlYnVnZ2VyLnZlY3Rvci14IiwKICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5fZHgsCiAgICAgICAgICAgICAgICAgICAgb25lZGl0OiBhID0+IHRoaXMuX2R4ID0gYQogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgIG5hbWU6ICJiZWhhdmlvcnMuYnVsbGV0LmRlYnVnZ2VyLnZlY3Rvci15IiwKICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5fZHksCiAgICAgICAgICAgICAgICAgICAgb25lZGl0OiBhID0+IHRoaXMuX2R5ID0gYQogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgIG5hbWU6ICJiZWhhdmlvcnMuYnVsbGV0LnByb3BlcnRpZXMuc3BlZWQubmFtZSIsCiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuX0dldFNwZWVkKCksCiAgICAgICAgICAgICAgICAgICAgb25lZGl0OiBhID0+IHRoaXMuX1NldFNwZWVkKGEpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIG5hbWU6ICJiZWhhdmlvcnMuYnVsbGV0LmRlYnVnZ2VyLmFuZ2xlLW9mLW1vdGlvbiIsCiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IEMzJGpzY29tcCQyODIudG9EZWdyZWVzKHRoaXMuX0dldEFuZ2xlT2ZNb3Rpb24oKSkKICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICBuYW1lOiAiYmVoYXZpb3JzLmJ1bGxldC5wcm9wZXJ0aWVzLmdyYXZpdHkubmFtZSIsCiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuX0dldEdyYXZpdHkoKSwKICAgICAgICAgICAgICAgICAgICBvbmVkaXQ6IGEgPT4gdGhpcy5fU2V0R3Jhdml0eShhKQogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgIG5hbWU6ICJiZWhhdmlvcnMuYnVsbGV0LnByb3BlcnRpZXMuYWNjZWxlcmF0aW9uLm5hbWUiLAogICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLl9HZXRBY2NlbGVyYXRpb24oKSwKICAgICAgICAgICAgICAgICAgICBvbmVkaXQ6IGEgPT4gdGhpcy5fU2V0QWNjZWxlcmF0aW9uKGEpCiAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgbmFtZTogImJlaGF2aW9ycy5idWxsZXQuZGVidWdnZXIuZGlzdGFuY2UtdHJhdmVsbGVkIiwKICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5fR2V0RGlzdGFuY2VUcmF2ZWxsZWQoKQogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgIG5hbWU6ICJiZWhhdmlvcnMuYnVsbGV0LnByb3BlcnRpZXMuZW5hYmxlZC5uYW1lIiwKICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5fSXNFbmFibGVkKCksCiAgICAgICAgICAgICAgICAgICAgb25lZGl0OiBhID0+CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX1NldEVuYWJsZWQoYSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgXQogICAgICAgIH1dCiAgICB9CiAgICBHZXRTY3JpcHRJbnRlcmZhY2VDbGFzcygpIHsKICAgICAgICByZXR1cm4gc2VsZi5JQnVsbGV0QmVoYXZpb3JJbnN0YW5jZQogICAgfQp9Owpjb25zdCBtYXAkanNjb21wJDI3ID0gbmV3IFdlYWtNYXA7CnNlbGYuSUJ1bGxldEJlaGF2aW9ySW5zdGFuY2UgPSBjbGFzcyBleHRlbmRzIElCZWhhdmlvckluc3RhbmNlJGpzY29tcCQzIHsKICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgIHN1cGVyKCk7CiAgICAgICAgbWFwJGpzY29tcCQyNy5zZXQodGhpcywgSUJlaGF2aW9ySW5zdGFuY2UkanNjb21wJDMuX0dldEluaXRJbnN0KCkuR2V0U2RrSW5zdGFuY2UoKSkKICAgIH0KICAgIGdldCBzcGVlZCgpIHsKICAgICAgICByZXR1cm4gbWFwJGpzY29tcCQyNy5nZXQodGhpcykuX0dldFNwZWVkKCkKICAgIH0KICAgIHNldCBzcGVlZChhKSB7CiAgICAgICAgQzNYJGpzY29tcCQyOC5SZXF1aXJlRmluaXRlTnVtYmVyKGEpOwogICAgICAgIG1hcCRqc2NvbXAkMjcuZ2V0KHRoaXMpLl9TZXRTcGVlZChhKQogICAgfQogICAgZ2V0IGFjY2VsZXJhdGlvbigpIHsKICAgICAgICByZXR1cm4gbWFwJGpzY29tcCQyNy5nZXQodGhpcykuX0dldEFjY2VsZXJhdGlvbigpCiAgICB9CiAgICBzZXQgYWNjZWxlcmF0aW9uKGEpIHsKICAgICAgICBDM1gkanNjb21wJDI4LlJlcXVpcmVGaW5pdGVOdW1iZXIoYSk7CiAgICAgICAgbWFwJGpzY29tcCQyNy5nZXQodGhpcykuX1NldEFjY2VsZXJhdGlvbihhKQogICAgfQogICAgZ2V0IGdyYXZpdHkoKSB7CiAgICAgICAgcmV0dXJuIG1hcCRqc2NvbXAkMjcuZ2V0KHRoaXMpLl9HZXRHcmF2aXR5KCkKICAgIH0KICAgIHNldCBncmF2aXR5KGEpIHsKICAgICAgICBDM1gkanNjb21wJDI4LlJlcXVpcmVGaW5pdGVOdW1iZXIoYSk7CiAgICAgICAgbWFwJGpzY29tcCQyNy5nZXQodGhpcykuX1NldEdyYXZpdHkoYSkKICAgIH0KICAgIGdldCBhbmdsZU9mTW90aW9uKCkgewogICAgICAgIHJldHVybiBtYXAkanNjb21wJDI3LmdldCh0aGlzKS5fR2V0QW5nbGVPZk1vdGlvbigpCiAgICB9CiAgICBzZXQgYW5nbGVPZk1vdGlvbihhKSB7CiAgICAgICAgQzNYJGpzY29tcCQyOC5SZXF1aXJlRmluaXRlTnVtYmVyKGEpOwogICAgICAgIG1hcCRqc2NvbXAkMjcuZ2V0KHRoaXMpLl9TZXRBbmdsZU9mTW90aW9uKGEpCiAgICB9CiAgICBnZXQgYm91bmNlT2ZmU29saWRzKCkgewogICAgICAgIHJldHVybiBtYXAkanNjb21wJDI3LmdldCh0aGlzKS5fSXNCb3VuY2VPZmZTb2xpZHMoKQogICAgfQogICAgc2V0IGJvdW5jZU9mZlNvbGlkcyhhKSB7CiAgICAgICAgbWFwJGpzY29tcCQyNy5nZXQodGhpcykuX1NldEJvdW5jZU9mZlNvbGlkcyghIWEpCiAgICB9CiAgICBnZXQgZGlzdGFuY2VUcmF2ZWxsZWQoKSB7CiAgICAgICAgcmV0dXJuIG1hcCRqc2NvbXAkMjcuZ2V0KHRoaXMpLl9HZXREaXN0YW5jZVRyYXZlbGxlZCgpCiAgICB9CiAgICBzZXQgZGlzdGFuY2VUcmF2ZWxsZWQoYSkgewogICAgICAgIEMzWCRqc2NvbXAkMjguUmVxdWlyZUZpbml0ZU51bWJlcihhKTsKICAgICAgICBtYXAkanNjb21wJDI3LmdldCh0aGlzKS5fU2V0RGlzdGFuY2VUcmF2ZWxsZWQoYSkKICAgIH0KICAgIGdldCBpc0VuYWJsZWQoKSB7CiAgICAgICAgcmV0dXJuIG1hcCRqc2NvbXAkMjcuZ2V0KHRoaXMpLl9Jc0VuYWJsZWQoKQogICAgfQogICAgc2V0IGlzRW5hYmxlZChhKSB7CiAgICAgICAgbWFwJGpzY29tcCQyNy5nZXQodGhpcykuX1NldEVuYWJsZWQoYSkKICAgIH0KfTsKY29uc3QgQzMkanNjb21wJDI4MyA9IHNlbGYuQzM7CkMzJGpzY29tcCQyODMuQmVoYXZpb3JzLkJ1bGxldC5DbmRzID0gewogICAgQ29tcGFyZVNwZWVkKGEsIGIpIHsKICAgICAgICByZXR1cm4gQzMkanNjb21wJDI4My5jb21wYXJlKE1hdGguaHlwb3QodGhpcy5fZHgsIHRoaXMuX2R5KSwgYSwgYikKICAgIH0sCiAgICBDb21wYXJlVHJhdmVsbGVkKGEsIGIpIHsKICAgICAgICByZXR1cm4gQzMkanNjb21wJDI4My5jb21wYXJlKHRoaXMuX0dldERpc3RhbmNlVHJhdmVsbGVkKCksIGEsIGIpCiAgICB9LAogICAgT25TdGVwKCkgewogICAgICAgIHJldHVybiAhMAogICAgfSwKICAgIElzRW5hYmxlZCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fSXNFbmFibGVkKCkKICAgIH0KfTsKY29uc3QgQzMkanNjb21wJDI4NCA9IHNlbGYuQzM7CkMzJGpzY29tcCQyODQuQmVoYXZpb3JzLkJ1bGxldC5BY3RzID0gewogICAgU2V0U3BlZWQoYSkgewogICAgICAgIHRoaXMuX1NldFNwZWVkKGEpCiAgICB9LAogICAgU2V0QWNjZWxlcmF0aW9uKGEpIHsKICAgICAgICB0aGlzLl9TZXRBY2NlbGVyYXRpb24oYSkKICAgIH0sCiAgICBTZXRHcmF2aXR5KGEpIHsKICAgICAgICB0aGlzLl9TZXRHcmF2aXR5KGEpCiAgICB9LAogICAgU2V0QW5nbGVPZk1vdGlvbihhKSB7CiAgICAgICAgdGhpcy5fU2V0QW5nbGVPZk1vdGlvbihDMyRqc2NvbXAkMjg0LnRvUmFkaWFucyhhKSkKICAgIH0sCiAgICBCb3VuY2UoYSkgewogICAgICAgIGlmIChhICYmIChhID0gYS5HZXRGaXJzdFBpY2tlZCh0aGlzLl9pbnN0KSkpIHsKICAgICAgICAgICAgdmFyIGIgPSB0aGlzLl9pbnN0LkdldFdvcmxkSW5mbygpLAogICAgICAgICAgICAgICAgZCA9IHRoaXMuX3J1bnRpbWUuR2V0Q29sbGlzaW9uRW5naW5lKCksCiAgICAgICAgICAgICAgICBjID0gdGhpcy5fcnVudGltZS5HZXREdCh0aGlzLl9pbnN0KSwKICAgICAgICAgICAgICAgIGUgPSBDMyRqc2NvbXAkMjg0LmRpc3RhbmNlVG8oMCwgMCwgdGhpcy5fZHgsIHRoaXMuX2R5KSwKICAgICAgICAgICAgICAgIGcgPSBkLkNhbGN1bGF0ZUJvdW5jZUFuZ2xlKHRoaXMuX2luc3QsIHRoaXMuX2xhc3RYLCB0aGlzLl9sYXN0WSwgYSk7CiAgICAgICAgICAgIHRoaXMuX2R4ID0gTWF0aC5jb3MoZykgKgogICAgICAgICAgICAgICAgZTsKICAgICAgICAgICAgdGhpcy5fZHkgPSBNYXRoLnNpbihnKSAqIGU7CiAgICAgICAgICAgIGIuT2Zmc2V0WFkodGhpcy5fZHggKiBjLCB0aGlzLl9keSAqIGMpOwogICAgICAgICAgICBiLlNldEJib3hDaGFuZ2VkKCk7CiAgICAgICAgICAgIHRoaXMuX3NldEFuZ2xlICYmIChiLlNldEFuZ2xlKGcpLCB0aGlzLl9sYXN0S25vd25BbmdsZSA9IGIuR2V0QW5nbGUoKSwgYi5TZXRCYm94Q2hhbmdlZCgpKTsKICAgICAgICAgICAgMCAhPT0gZSAmJiAodGhpcy5fYm91bmNlT2ZmU29saWQgPyBkLlB1c2hPdXRTb2xpZCh0aGlzLl9pbnN0LCB0aGlzLl9keCAvIGUsIHRoaXMuX2R5IC8gZSwgTWF0aC5tYXgoMi41ICogZSAqIGMsIDMwKSkgfHwgZC5QdXNoT3V0U29saWROZWFyZXN0KHRoaXMuX2luc3QsIDEwMCkgOiBkLlB1c2hPdXQodGhpcy5faW5zdCwgdGhpcy5fZHggLyBlLCB0aGlzLl9keSAvIGUsIE1hdGgubWF4KDIuNSAqIGUgKiBjLCAzMCksIGEpKQogICAgICAgIH0KICAgIH0sCiAgICBTZXRCb3VuY2VPZmZTb2xpZHMoYSkgewogICAgICAgIHRoaXMuX1NldEJvdW5jZU9mZlNvbGlkcyhhKQogICAgfSwKICAgIFNldERpc3RhbmNlVHJhdmVsbGVkKGEpIHsKICAgICAgICB0aGlzLl9TZXREaXN0YW5jZVRyYXZlbGxlZChhKQogICAgfSwKICAgIFNldEVuYWJsZWQoYSkgewogICAgICAgIHRoaXMuX1NldEVuYWJsZWQoYSkKICAgIH0sCiAgICBTdG9wU3RlcHBpbmcoKSB7CiAgICAgICAgdGhpcy5fc3RvcFN0ZXBwaW5nID0gITAKICAgIH0KfTsKY29uc3QgQzMkanNjb21wJDI4NSA9IHNlbGYuQzM7CkMzJGpzY29tcCQyODUuQmVoYXZpb3JzLkJ1bGxldC5FeHBzID0gewogICAgU3BlZWQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX0dldFNwZWVkKCkKICAgIH0sCiAgICBBY2NlbGVyYXRpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX0dldEFjY2VsZXJhdGlvbigpCiAgICB9LAogICAgQW5nbGVPZk1vdGlvbigpIHsKICAgICAgICByZXR1cm4gQzMkanNjb21wJDI4NS50b0RlZ3JlZXModGhpcy5fR2V0QW5nbGVPZk1vdGlvbigpKQogICAgfSwKICAgIERpc3RhbmNlVHJhdmVsbGVkKCkgewogICAgICAgIHJldHVybiB0aGlzLl9HZXREaXN0YW5jZVRyYXZlbGxlZCgpCiAgICB9LAogICAgR3Jhdml0eSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fR2V0R3Jhdml0eSgpCiAgICB9Cn07CiJ1c2Ugc3RyaWN0IjsKY29uc3QgQzMkanNjb21wJDI4NiA9IHNlbGYuQzM7CkMzJGpzY29tcCQyODYuQmVoYXZpb3JzLlJvdGF0ZSA9IGNsYXNzIGV4dGVuZHMgQzMkanNjb21wJDI4Ni5TREtCZWhhdmlvckJhc2UgewogICAgY29uc3RydWN0b3IoYSkgewogICAgICAgIHN1cGVyKGEpCiAgICB9CiAgICBSZWxlYXNlKCkgewogICAgICAgIHN1cGVyLlJlbGVhc2UoKQogICAgfQp9Owpjb25zdCBDMyRqc2NvbXAkMjg3ID0gc2VsZi5DMzsKQzMkanNjb21wJDI4Ny5CZWhhdmlvcnMuUm90YXRlLlR5cGUgPSBjbGFzcyBleHRlbmRzIEMzJGpzY29tcCQyODcuU0RLQmVoYXZpb3JUeXBlQmFzZSB7CiAgICBjb25zdHJ1Y3RvcihhKSB7CiAgICAgICAgc3VwZXIoYSkKICAgIH0KICAgIFJlbGVhc2UoKSB7CiAgICAgICAgc3VwZXIuUmVsZWFzZSgpCiAgICB9CiAgICBPbkNyZWF0ZSgpIHt9Cn07CmNvbnN0IEMzJGpzY29tcCQyODggPSBzZWxmLkMzLAogICAgQzNYJGpzY29tcCQyOSA9IHNlbGYuQzNYLAogICAgSUJlaGF2aW9ySW5zdGFuY2UkanNjb21wJDQgPSBzZWxmLklCZWhhdmlvckluc3RhbmNlOwpDMyRqc2NvbXAkMjg4LkJlaGF2aW9ycy5Sb3RhdGUuSW5zdGFuY2UgPSBjbGFzcyBleHRlbmRzIEMzJGpzY29tcCQyODguU0RLQmVoYXZpb3JJbnN0YW5jZUJhc2UgewogICAgY29uc3RydWN0b3IoYSwgYikgewogICAgICAgIHN1cGVyKGEpOwogICAgICAgIHRoaXMuX2FjY2VsZXJhdGlvbiA9IHRoaXMuX3NwZWVkID0gMDsKICAgICAgICB0aGlzLl9pc0VuYWJsZWQgPSAhMDsKICAgICAgICBiICYmICh0aGlzLl9zcGVlZCA9IEMzJGpzY29tcCQyODgudG9SYWRpYW5zKGJbMF0pLCB0aGlzLl9hY2NlbGVyYXRpb24gPSBDMyRqc2NvbXAkMjg4LnRvUmFkaWFucyhiWzFdKSwgdGhpcy5faXNFbmFibGVkID0gYlsyXSk7CiAgICAgICAgdGhpcy5faXNFbmFibGVkICYmIHRoaXMuX1N0YXJ0VGlja2luZygpCiAgICB9CiAgICBSZWxlYXNlKCkgewogICAgICAgIHN1cGVyLlJlbGVhc2UoKQogICAgfQogICAgX1NldFNwZWVkKGEpIHsKICAgICAgICB0aGlzLl9zcGVlZCA9IGEKICAgIH0KICAgIF9HZXRTcGVlZCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fc3BlZWQKICAgIH0KICAgIF9TZXRBY2NlbGVyYXRpb24oYSkgewogICAgICAgIHRoaXMuX2FjY2VsZXJhdGlvbiA9IGEKICAgIH0KICAgIF9HZXRBY2NlbGVyYXRpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2FjY2VsZXJhdGlvbgogICAgfQogICAgU2F2ZVRvSnNvbigpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBzOiB0aGlzLl9zcGVlZCwKICAgICAgICAgICAgYTogdGhpcy5fYWNjZWxlcmF0aW9uLAogICAgICAgICAgICBlOiB0aGlzLl9pc0VuYWJsZWQKICAgICAgICB9CiAgICB9CiAgICBMb2FkRnJvbUpzb24oYSkgewogICAgICAgIHRoaXMuX3NwZWVkID0gYS5zOwogICAgICAgIHRoaXMuX2FjY2VsZXJhdGlvbiA9IGEuYTsKICAgICAgICB0aGlzLl9TZXRFbmFibGVkKGEuZSkKICAgIH0KICAgIFRpY2soKSB7CiAgICAgICAgaWYgKHRoaXMuX2lzRW5hYmxlZCkgewogICAgICAgICAgICB2YXIgYSA9IHRoaXMuX3J1bnRpbWUuR2V0RHQodGhpcy5faW5zdCk7CiAgICAgICAgICAgIGlmICgwICE9PSBhICYmICgwICE9PSB0aGlzLl9hY2NlbGVyYXRpb24gJiYgKHRoaXMuX3NwZWVkICs9IHRoaXMuX2FjY2VsZXJhdGlvbiAqIGEpLCAwICE9PSB0aGlzLl9zcGVlZCkpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGIgPSB0aGlzLl9pbnN0LkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICAgICAgYi5TZXRBbmdsZShiLkdldEFuZ2xlKCkgKyB0aGlzLl9zcGVlZCAqIGEpOwogICAgICAgICAgICAgICAgYi5TZXRCYm94Q2hhbmdlZCgpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBHZXRQcm9wZXJ0eVZhbHVlQnlJbmRleChhKSB7CiAgICAgICAgc3dpdGNoIChhKSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIHJldHVybiBDMyRqc2NvbXAkMjg4LnRvRGVncmVlcyh0aGlzLl9HZXRTcGVlZCgpKTsKICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgcmV0dXJuIEMzJGpzY29tcCQyODgudG9EZWdyZWVzKHRoaXMuX0dldEFjY2VsZXJhdGlvbigpKTsKICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX0lzRW5hYmxlZCgpCiAgICAgICAgfQogICAgfQogICAgU2V0UHJvcGVydHlWYWx1ZUJ5SW5kZXgoYSwgYikgewogICAgICAgIHN3aXRjaCAoYSkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICB0aGlzLl9TZXRTcGVlZChDMyRqc2NvbXAkMjg4LnRvUmFkaWFucyhiKSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgdGhpcy5fU2V0QWNjZWxlcmF0aW9uKEMzJGpzY29tcCQyODgudG9SYWRpYW5zKGIpKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICB0aGlzLl9TZXRFbmFibGVkKGIpCiAgICAgICAgfQogICAgfQogICAgX1NldEVuYWJsZWQoYSkgewogICAgICAgICh0aGlzLl9pc0VuYWJsZWQgPSAhIWEpID8gdGhpcy5fU3RhcnRUaWNraW5nKCk6IHRoaXMuX1N0b3BUaWNraW5nKCkKICAgIH0KICAgIF9Jc0VuYWJsZWQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2lzRW5hYmxlZAogICAgfQogICAgR2V0RGVidWdnZXJQcm9wZXJ0aWVzKCkgewogICAgICAgIHJldHVybiBbewogICAgICAgICAgICB0aXRsZTogIiQiICsgdGhpcy5HZXRCZWhhdmlvclR5cGUoKS5HZXROYW1lKCksCiAgICAgICAgICAgIHByb3BlcnRpZXM6IFt7CiAgICAgICAgICAgICAgICBuYW1lOiAiYmVoYXZpb3JzLnJvdGF0ZS5wcm9wZXJ0aWVzLnNwZWVkLm5hbWUiLAogICAgICAgICAgICAgICAgdmFsdWU6IEMzJGpzY29tcCQyODgudG9EZWdyZWVzKHRoaXMuX0dldFNwZWVkKCkpLAogICAgICAgICAgICAgICAgb25lZGl0OiBhID0+IHRoaXMuX1NldFNwZWVkKEMzJGpzY29tcCQyODgudG9SYWRpYW5zKGEpKQogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICBuYW1lOiAiYmVoYXZpb3JzLnJvdGF0ZS5wcm9wZXJ0aWVzLmFjY2VsZXJhdGlvbi5uYW1lIiwKICAgICAgICAgICAgICAgIHZhbHVlOiBDMyRqc2NvbXAkMjg4LnRvRGVncmVlcyh0aGlzLl9HZXRBY2NlbGVyYXRpb24oKSksCiAgICAgICAgICAgICAgICBvbmVkaXQ6IGEgPT4gdGhpcy5fU2V0QWNjZWxlcmF0aW9uKEMzJGpzY29tcCQyODgudG9SYWRpYW5zKGEpKQogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICBuYW1lOiAiYmVoYXZpb3JzLnJvdGF0ZS5wcm9wZXJ0aWVzLmVuYWJsZWQubmFtZSIsCiAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5fSXNFbmFibGVkKCksCiAgICAgICAgICAgICAgICBvbmVkaXQ6IGEgPT4gdGhpcy5fU2V0RW5hYmxlZChhKQogICAgICAgICAgICB9XQogICAgICAgIH1dCiAgICB9CiAgICBHZXRTY3JpcHRJbnRlcmZhY2VDbGFzcygpIHsKICAgICAgICByZXR1cm4gc2VsZi5JUm90YXRlQmVoYXZpb3JJbnN0YW5jZQogICAgfQp9Owpjb25zdCBtYXAkanNjb21wJDI4ID0gbmV3IFdlYWtNYXA7CnNlbGYuSVJvdGF0ZUJlaGF2aW9ySW5zdGFuY2UgPSBjbGFzcyBleHRlbmRzIElCZWhhdmlvckluc3RhbmNlJGpzY29tcCQ0IHsKICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgIHN1cGVyKCk7CiAgICAgICAgbWFwJGpzY29tcCQyOC5zZXQodGhpcywgSUJlaGF2aW9ySW5zdGFuY2UkanNjb21wJDQuX0dldEluaXRJbnN0KCkuR2V0U2RrSW5zdGFuY2UoKSkKICAgIH0KICAgIHNldCBzcGVlZChhKSB7CiAgICAgICAgQzNYJGpzY29tcCQyOS5SZXF1aXJlRmluaXRlTnVtYmVyKGEpOwogICAgICAgIG1hcCRqc2NvbXAkMjguZ2V0KHRoaXMpLl9TZXRTcGVlZChhKQogICAgfQogICAgZ2V0IHNwZWVkKCkgewogICAgICAgIHJldHVybiBtYXAkanNjb21wJDI4LmdldCh0aGlzKS5fR2V0U3BlZWQoKQogICAgfQogICAgc2V0IGFjY2VsZXJhdGlvbihhKSB7CiAgICAgICAgQzNYJGpzY29tcCQyOS5SZXF1aXJlRmluaXRlTnVtYmVyKGEpOwogICAgICAgIG1hcCRqc2NvbXAkMjguZ2V0KHRoaXMpLl9TZXRBY2NlbGVyYXRpb24oYSkKICAgIH0KICAgIGdldCBhY2NlbGVyYXRpb24oKSB7CiAgICAgICAgcmV0dXJuIG1hcCRqc2NvbXAkMjguZ2V0KHRoaXMpLl9HZXRBY2NlbGVyYXRpb24oKQogICAgfQogICAgZ2V0IGlzRW5hYmxlZCgpIHsKICAgICAgICByZXR1cm4gbWFwJGpzY29tcCQyOC5nZXQodGhpcykuX0lzRW5hYmxlZCgpCiAgICB9CiAgICBzZXQgaXNFbmFibGVkKGEpIHsKICAgICAgICBtYXAkanNjb21wJDI4LmdldCh0aGlzKS5fU2V0RW5hYmxlZChhKQogICAgfQp9OwpzZWxmLkMzLkJlaGF2aW9ycy5Sb3RhdGUuQ25kcyA9IHsKICAgIElzRW5hYmxlZCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fSXNFbmFibGVkKCkKICAgIH0KfTsKY29uc3QgQzMkanNjb21wJDI5MCA9IHNlbGYuQzM7CkMzJGpzY29tcCQyOTAuQmVoYXZpb3JzLlJvdGF0ZS5BY3RzID0gewogICAgU2V0U3BlZWQoYSkgewogICAgICAgIHRoaXMuX1NldFNwZWVkKEMzJGpzY29tcCQyOTAudG9SYWRpYW5zKGEpKQogICAgfSwKICAgIFNldEFjY2VsZXJhdGlvbihhKSB7CiAgICAgICAgdGhpcy5fU2V0QWNjZWxlcmF0aW9uKEMzJGpzY29tcCQyOTAudG9SYWRpYW5zKGEpKQogICAgfSwKICAgIFNldEVuYWJsZWQoYSkgewogICAgICAgIHRoaXMuX1NldEVuYWJsZWQoYSkKICAgIH0KfTsKY29uc3QgQzMkanNjb21wJDI5MSA9IHNlbGYuQzM7CkMzJGpzY29tcCQyOTEuQmVoYXZpb3JzLlJvdGF0ZS5FeHBzID0gewogICAgU3BlZWQoKSB7CiAgICAgICAgcmV0dXJuIEMzJGpzY29tcCQyOTEudG9EZWdyZWVzKHRoaXMuX0dldFNwZWVkKCkpCiAgICB9LAogICAgQWNjZWxlcmF0aW9uKCkgewogICAgICAgIHJldHVybiBDMyRqc2NvbXAkMjkxLnRvRGVncmVlcyh0aGlzLl9HZXRBY2NlbGVyYXRpb24oKSkKICAgIH0KfTsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkMjkyID0gc2VsZi5DMzsKQzMkanNjb21wJDI5Mi5CZWhhdmlvcnMuRmFkZSA9IGNsYXNzIGV4dGVuZHMgQzMkanNjb21wJDI5Mi5TREtCZWhhdmlvckJhc2UgewogICAgY29uc3RydWN0b3IoYSkgewogICAgICAgIHN1cGVyKGEpCiAgICB9CiAgICBSZWxlYXNlKCkgewogICAgICAgIHN1cGVyLlJlbGVhc2UoKQogICAgfQp9Owpjb25zdCBDMyRqc2NvbXAkMjkzID0gc2VsZi5DMzsKQzMkanNjb21wJDI5My5CZWhhdmlvcnMuRmFkZS5UeXBlID0gY2xhc3MgZXh0ZW5kcyBDMyRqc2NvbXAkMjkzLlNES0JlaGF2aW9yVHlwZUJhc2UgewogICAgY29uc3RydWN0b3IoYSkgewogICAgICAgIHN1cGVyKGEpCiAgICB9CiAgICBSZWxlYXNlKCkgewogICAgICAgIHN1cGVyLlJlbGVhc2UoKQogICAgfQogICAgT25DcmVhdGUoKSB7fQp9Owpjb25zdCBDMyRqc2NvbXAkMjk0ID0gc2VsZi5DMywKICAgIEMzWCRqc2NvbXAkMzAgPSBzZWxmLkMzWCwKICAgIElCZWhhdmlvckluc3RhbmNlJGpzY29tcCQ1ID0gc2VsZi5JQmVoYXZpb3JJbnN0YW5jZTsKQzMkanNjb21wJDI5NC5CZWhhdmlvcnMuRmFkZS5JbnN0YW5jZSA9IGNsYXNzIGV4dGVuZHMgQzMkanNjb21wJDI5NC5TREtCZWhhdmlvckluc3RhbmNlQmFzZSB7CiAgICBjb25zdHJ1Y3RvcihhLCBiKSB7CiAgICAgICAgc3VwZXIoYSk7CiAgICAgICAgdGhpcy5fZmFkZU91dFRpbWUgPSB0aGlzLl93YWl0VGltZSA9IHRoaXMuX2ZhZGVJblRpbWUgPSAwOwogICAgICAgIHRoaXMuX2FjdGl2ZUF0U3RhcnQgPSB0aGlzLl9kZXN0cm95ID0gITA7CiAgICAgICAgdGhpcy5fc2V0TWF4T3BhY2l0eSA9ICExOwogICAgICAgIHRoaXMuX3N0YWdlID0gMDsKICAgICAgICB0aGlzLl9zdGFnZVRpbWUgPSBDMyRqc2NvbXAkMjk0Lk5ldyhDMyRqc2NvbXAkMjk0LkthaGFuU3VtKTsKICAgICAgICB0aGlzLl9tYXhPcGFjaXR5ID0gdGhpcy5faW5zdC5HZXRXb3JsZEluZm8oKS5HZXRPcGFjaXR5KCkgfHwgMTsKICAgICAgICBiICYmICh0aGlzLl9mYWRlSW5UaW1lID0gYlswXSwgdGhpcy5fd2FpdFRpbWUgPSBiWzFdLCB0aGlzLl9mYWRlT3V0VGltZSA9IGJbMl0sIHRoaXMuX2Rlc3Ryb3kgPSAhIWJbM10sIHRoaXMuX3N0YWdlID0gKHRoaXMuX2FjdGl2ZUF0U3RhcnQgPSAhIWJbNF0pID8gMCA6IDMpOwogICAgICAgIHRoaXMuX2FjdGl2ZUF0U3RhcnQgJiYKICAgICAgICAgICAgKDAgPT09IHRoaXMuX2ZhZGVJblRpbWUgPyAodGhpcy5fc3RhZ2UgPSAxLCAwID09PSB0aGlzLl93YWl0VGltZSAmJiAodGhpcy5fc3RhZ2UgPSAyKSkgOiAodGhpcy5faW5zdC5HZXRXb3JsZEluZm8oKS5TZXRPcGFjaXR5KDApLCB0aGlzLl9ydW50aW1lLlVwZGF0ZVJlbmRlcigpKSk7CiAgICAgICAgdGhpcy5fU3RhcnRUaWNraW5nKCkKICAgIH0KICAgIFJlbGVhc2UoKSB7CiAgICAgICAgc3VwZXIuUmVsZWFzZSgpCiAgICB9CiAgICBTYXZlVG9Kc29uKCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGZpdDogdGhpcy5fZmFkZUluVGltZSwKICAgICAgICAgICAgd3Q6IHRoaXMuX3dhaXRUaW1lLAogICAgICAgICAgICBmb3Q6IHRoaXMuX2ZhZGVPdXRUaW1lLAogICAgICAgICAgICBkOiB0aGlzLl9kZXN0cm95LAogICAgICAgICAgICBzOiB0aGlzLl9zdGFnZSwKICAgICAgICAgICAgc3Q6IHRoaXMuX3N0YWdlVGltZS5HZXQoKSwKICAgICAgICAgICAgbW86IHRoaXMuX21heE9wYWNpdHkKICAgICAgICB9CiAgICB9CiAgICBMb2FkRnJvbUpzb24oYSkgewogICAgICAgIHRoaXMuX2ZhZGVJblRpbWUgPSBhLmZpdDsKICAgICAgICB0aGlzLl93YWl0VGltZSA9IGEud3Q7CiAgICAgICAgdGhpcy5fZmFkZU91dFRpbWUgPSBhLmZvdDsKICAgICAgICB0aGlzLl9kZXN0cm95ID0gYS5kOwogICAgICAgIHRoaXMuX3N0YWdlID0gYS5zOwogICAgICAgIHRoaXMuX3N0YWdlVGltZS5TZXQoYS5zdCk7CiAgICAgICAgdGhpcy5fbWF4T3BhY2l0eSA9CiAgICAgICAgICAgIGEubW8KICAgIH0KICAgIFRpY2soKSB7CiAgICAgICAgdmFyIGEgPSB0aGlzLl9ydW50aW1lLkdldER0KHRoaXMuX2luc3QpOwogICAgICAgIHRoaXMuX3N0YWdlVGltZS5BZGQoYSk7CiAgICAgICAgYSA9IHRoaXMuX2luc3QuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgMCA9PT0gdGhpcy5fc3RhZ2UgJiYgKGEuU2V0T3BhY2l0eSh0aGlzLl9zdGFnZVRpbWUuR2V0KCkgLyB0aGlzLl9mYWRlSW5UaW1lICogdGhpcy5fbWF4T3BhY2l0eSksIHRoaXMuX3J1bnRpbWUuVXBkYXRlUmVuZGVyKCksIGEuR2V0T3BhY2l0eSgpID49IHRoaXMuX21heE9wYWNpdHkgJiYgKGEuU2V0T3BhY2l0eSh0aGlzLl9tYXhPcGFjaXR5KSwgdGhpcy5fc3RhZ2UgPSAxLCB0aGlzLl9zdGFnZVRpbWUuUmVzZXQoKSwgdGhpcy5EaXNwYXRjaFNjcmlwdEV2ZW50KCJmYWRlaW5lbmQiKSwgdGhpcy5UcmlnZ2VyKEMzJGpzY29tcCQyOTQuQmVoYXZpb3JzLkZhZGUuQ25kcy5PbkZhZGVJbkVuZCkpKTsKICAgICAgICAxID09PSB0aGlzLl9zdGFnZSAmJiB0aGlzLl9zdGFnZVRpbWUuR2V0KCkgPj0gdGhpcy5fd2FpdFRpbWUgJiYgKHRoaXMuX3N0YWdlID0gMiwgdGhpcy5fc3RhZ2VUaW1lLlJlc2V0KCksCiAgICAgICAgICAgIHRoaXMuRGlzcGF0Y2hTY3JpcHRFdmVudCgid2FpdGVuZCIpLCB0aGlzLlRyaWdnZXIoQzMkanNjb21wJDI5NC5CZWhhdmlvcnMuRmFkZS5DbmRzLk9uV2FpdEVuZCkpOwogICAgICAgIDIgPT09IHRoaXMuX3N0YWdlICYmIDAgIT09IHRoaXMuX2ZhZGVPdXRUaW1lICYmIChhLlNldE9wYWNpdHkodGhpcy5fbWF4T3BhY2l0eSAtIHRoaXMuX3N0YWdlVGltZS5HZXQoKSAvIHRoaXMuX2ZhZGVPdXRUaW1lICogdGhpcy5fbWF4T3BhY2l0eSksIHRoaXMuX3J1bnRpbWUuVXBkYXRlUmVuZGVyKCksIDAgPj0gYS5HZXRPcGFjaXR5KCkgJiYgKHRoaXMuX3N0YWdlID0gMywgdGhpcy5fc3RhZ2VUaW1lLlJlc2V0KCksIHRoaXMuRGlzcGF0Y2hTY3JpcHRFdmVudCgiZmFkZW91dGVuZCIpLCB0aGlzLlRyaWdnZXIoQzMkanNjb21wJDI5NC5CZWhhdmlvcnMuRmFkZS5DbmRzLk9uRmFkZU91dEVuZCksIHRoaXMuX2Rlc3Ryb3kgJiYgdGhpcy5fcnVudGltZS5EZXN0cm95SW5zdGFuY2UodGhpcy5faW5zdCkpKQogICAgfQogICAgX1N0YXJ0RmFkZSgpIHsKICAgICAgICB0aGlzLl9hY3RpdmVBdFN0YXJ0IHx8CiAgICAgICAgICAgIHRoaXMuX3NldE1heE9wYWNpdHkgfHwgKHRoaXMuX21heE9wYWNpdHkgPSB0aGlzLl9pbnN0LkdldFdvcmxkSW5mbygpLkdldE9wYWNpdHkoKSB8fCAxLCB0aGlzLl9zZXRNYXhPcGFjaXR5ID0gITApOwogICAgICAgIDMgPT09IHRoaXMuX3N0YWdlICYmIHRoaXMuU3RhcnQoKQogICAgfQogICAgX1Jlc3RhcnRGYWRlKCkgewogICAgICAgIHRoaXMuU3RhcnQoKQogICAgfQogICAgU3RhcnQoKSB7CiAgICAgICAgdGhpcy5fc3RhZ2UgPSAwOwogICAgICAgIHRoaXMuX3N0YWdlVGltZS5SZXNldCgpOwogICAgICAgIDAgPT09IHRoaXMuX2ZhZGVJblRpbWUgPyAodGhpcy5fc3RhZ2UgPSAxLCAwID09PSB0aGlzLl93YWl0VGltZSAmJiAodGhpcy5fc3RhZ2UgPSAyKSkgOiAodGhpcy5faW5zdC5HZXRXb3JsZEluZm8oKS5TZXRPcGFjaXR5KDApLCB0aGlzLl9ydW50aW1lLlVwZGF0ZVJlbmRlcigpKQogICAgfQogICAgX1NldEZhZGVJblRpbWUoYSkgewogICAgICAgIHRoaXMuX2ZhZGVJblRpbWUgPSBNYXRoLm1heChhLCAwKQogICAgfQogICAgX0dldEZhZGVJblRpbWUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2ZhZGVJblRpbWUKICAgIH0KICAgIF9TZXRXYWl0VGltZShhKSB7CiAgICAgICAgdGhpcy5fd2FpdFRpbWUgPSBNYXRoLm1heChhLCAwKQogICAgfQogICAgX0dldFdhaXRUaW1lKCkgewogICAgICAgIHJldHVybiB0aGlzLl93YWl0VGltZQogICAgfQogICAgX1NldEZhZGVPdXRUaW1lKGEpIHsKICAgICAgICB0aGlzLl9mYWRlT3V0VGltZSA9CiAgICAgICAgICAgIE1hdGgubWF4KGEsIDApCiAgICB9CiAgICBfR2V0RmFkZU91dFRpbWUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2ZhZGVPdXRUaW1lCiAgICB9CiAgICBHZXRQcm9wZXJ0eVZhbHVlQnlJbmRleChhKSB7CiAgICAgICAgc3dpdGNoIChhKSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9HZXRGYWRlSW5UaW1lKCk7CiAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9HZXRXYWl0VGltZSgpOwogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fR2V0RmFkZU91dFRpbWUoKTsKICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2Rlc3Ryb3kKICAgICAgICB9CiAgICB9CiAgICBTZXRQcm9wZXJ0eVZhbHVlQnlJbmRleChhLCBiKSB7CiAgICAgICAgc3dpdGNoIChhKSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIHRoaXMuX1NldEZhZGVJblRpbWUoYik7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgdGhpcy5fU2V0V2FpdFRpbWUoYik7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgdGhpcy5fU2V0RmFkZU91dFRpbWUoYik7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgdGhpcy5fZGVzdHJveSA9ICEhYgogICAgICAgIH0KICAgIH0KICAgIEdldERlYnVnZ2VyUHJvcGVydGllcygpIHsKICAgICAgICByZXR1cm4gW3sKICAgICAgICAgICAgdGl0bGU6ICIkIiArIHRoaXMuR2V0QmVoYXZpb3JUeXBlKCkuR2V0TmFtZSgpLAogICAgICAgICAgICBwcm9wZXJ0aWVzOiBbewogICAgICAgICAgICAgICAgbmFtZTogImJlaGF2aW9ycy5mYWRlLnByb3BlcnRpZXMuZmFkZS1pbi10aW1lLm5hbWUiLAogICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuX0dldEZhZGVJblRpbWUoKSwKICAgICAgICAgICAgICAgIG9uZWRpdDogYSA9PiB0aGlzLl9TZXRGYWRlSW5UaW1lKGEpCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgIG5hbWU6ICJiZWhhdmlvcnMuZmFkZS5wcm9wZXJ0aWVzLndhaXQtdGltZS5uYW1lIiwKICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLl9HZXRXYWl0VGltZSgpLAogICAgICAgICAgICAgICAgb25lZGl0OiBhID0+IHRoaXMuX1NldFdhaXRUaW1lKGEpCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgIG5hbWU6ICJiZWhhdmlvcnMuZmFkZS5wcm9wZXJ0aWVzLmZhZGUtb3V0LXRpbWUubmFtZSIsCiAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5fR2V0RmFkZU91dFRpbWUoKSwKICAgICAgICAgICAgICAgIG9uZWRpdDogYSA9PiB0aGlzLl9TZXRGYWRlT3V0VGltZShhKQogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICBuYW1lOiAiYmVoYXZpb3JzLmZhZGUuZGVidWdnZXIuc3RhZ2UiLAogICAgICAgICAgICAgICAgdmFsdWU6IFsiYmVoYXZpb3JzLmZhZGUuZGVidWdnZXIuIiArIFsiZmFkZS1pbiIsICJ3YWl0IiwgImZhZGUtb3V0IiwgImRvbmUiXVt0aGlzLl9zdGFnZV1dCiAgICAgICAgICAgIH1dCiAgICAgICAgfV0KICAgIH0KICAgIEdldFNjcmlwdEludGVyZmFjZUNsYXNzKCkgewogICAgICAgIHJldHVybiBzZWxmLklGYWRlQmVoYXZpb3JJbnN0YW5jZQogICAgfQp9Owpjb25zdCBtYXAkanNjb21wJDI5ID0gbmV3IFdlYWtNYXA7CnNlbGYuSUZhZGVCZWhhdmlvckluc3RhbmNlID0gY2xhc3MgZXh0ZW5kcyBJQmVoYXZpb3JJbnN0YW5jZSRqc2NvbXAkNSB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgICBzdXBlcigpOwogICAgICAgIG1hcCRqc2NvbXAkMjkuc2V0KHRoaXMsIElCZWhhdmlvckluc3RhbmNlJGpzY29tcCQ1Ll9HZXRJbml0SW5zdCgpLkdldFNka0luc3RhbmNlKCkpCiAgICB9CiAgICBzdGFydEZhZGUoKSB7CiAgICAgICAgbWFwJGpzY29tcCQyOS5nZXQodGhpcykuX1N0YXJ0RmFkZSgpCiAgICB9CiAgICByZXN0YXJ0RmFkZSgpIHsKICAgICAgICBtYXAkanNjb21wJDI5LmdldCh0aGlzKS5fUmVzdGFydEZhZGUoKQogICAgfQogICAgc2V0IGZhZGVJblRpbWUoYSkgewogICAgICAgIEMzWCRqc2NvbXAkMzAuUmVxdWlyZUZpbml0ZU51bWJlcihhKTsKICAgICAgICBtYXAkanNjb21wJDI5LmdldCh0aGlzKS5fU2V0RmFkZUluVGltZShhKQogICAgfQogICAgZ2V0IGZhZGVJblRpbWUoKSB7CiAgICAgICAgcmV0dXJuIG1hcCRqc2NvbXAkMjkuZ2V0KHRoaXMpLl9HZXRGYWRlSW5UaW1lKCkKICAgIH0KICAgIHNldCB3YWl0VGltZShhKSB7CiAgICAgICAgQzNYJGpzY29tcCQzMC5SZXF1aXJlRmluaXRlTnVtYmVyKGEpOwogICAgICAgIG1hcCRqc2NvbXAkMjkuZ2V0KHRoaXMpLl9TZXRXYWl0VGltZShhKQogICAgfQogICAgZ2V0IHdhaXRUaW1lKCkgewogICAgICAgIHJldHVybiBtYXAkanNjb21wJDI5LmdldCh0aGlzKS5fR2V0V2FpdFRpbWUoKQogICAgfQogICAgc2V0IGZhZGVPdXRUaW1lKGEpIHsKICAgICAgICBDM1gkanNjb21wJDMwLlJlcXVpcmVGaW5pdGVOdW1iZXIoYSk7CiAgICAgICAgbWFwJGpzY29tcCQyOS5nZXQodGhpcykuX1NldEZhZGVPdXRUaW1lKGEpCiAgICB9CiAgICBnZXQgZmFkZU91dFRpbWUoKSB7CiAgICAgICAgcmV0dXJuIG1hcCRqc2NvbXAkMjkuZ2V0KHRoaXMpLl9HZXRGYWRlT3V0VGltZSgpCiAgICB9Cn07CnNlbGYuQzMuQmVoYXZpb3JzLkZhZGUuQ25kcyA9IHsKICAgIE9uRmFkZU91dEVuZCgpIHsKICAgICAgICByZXR1cm4gITAKICAgIH0sCiAgICBPbkZhZGVJbkVuZCgpIHsKICAgICAgICByZXR1cm4gITAKICAgIH0sCiAgICBPbldhaXRFbmQoKSB7CiAgICAgICAgcmV0dXJuICEwCiAgICB9Cn07CnNlbGYuQzMuQmVoYXZpb3JzLkZhZGUuQWN0cyA9IHsKICAgIFN0YXJ0RmFkZSgpIHsKICAgICAgICB0aGlzLl9TdGFydEZhZGUoKQogICAgfSwKICAgIFJlc3RhcnRGYWRlKCkgewogICAgICAgIHRoaXMuX1Jlc3RhcnRGYWRlKCkKICAgIH0sCiAgICBTZXRGYWRlSW5UaW1lKGEpIHsKICAgICAgICB0aGlzLl9TZXRGYWRlSW5UaW1lKGEpCiAgICB9LAogICAgU2V0V2FpdFRpbWUoYSkgewogICAgICAgIHRoaXMuX1NldFdhaXRUaW1lKGEpCiAgICB9LAogICAgU2V0RmFkZU91dFRpbWUoYSkgewogICAgICAgIHRoaXMuX1NldEZhZGVPdXRUaW1lKGEpCiAgICB9Cn07CnNlbGYuQzMuQmVoYXZpb3JzLkZhZGUuRXhwcyA9IHsKICAgIEZhZGVJblRpbWUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX0dldEZhZGVJblRpbWUoKQogICAgfSwKICAgIFdhaXRUaW1lKCkgewogICAgICAgIHJldHVybiB0aGlzLl9HZXRXYWl0VGltZSgpCiAgICB9LAogICAgRmFkZU91dFRpbWUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX0dldEZhZGVPdXRUaW1lKCkKICAgIH0KfTsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkMjk4ID0gc2VsZi5DMzsKQzMkanNjb21wJDI5OC5CZWhhdmlvcnMuUGluID0gY2xhc3MgZXh0ZW5kcyBDMyRqc2NvbXAkMjk4LlNES0JlaGF2aW9yQmFzZSB7CiAgICBjb25zdHJ1Y3RvcihhKSB7CiAgICAgICAgc3VwZXIoYSkKICAgIH0KICAgIFJlbGVhc2UoKSB7CiAgICAgICAgc3VwZXIuUmVsZWFzZSgpCiAgICB9Cn07CmNvbnN0IEMzJGpzY29tcCQyOTkgPSBzZWxmLkMzOwpDMyRqc2NvbXAkMjk5LkJlaGF2aW9ycy5QaW4uVHlwZSA9IGNsYXNzIGV4dGVuZHMgQzMkanNjb21wJDI5OS5TREtCZWhhdmlvclR5cGVCYXNlIHsKICAgIGNvbnN0cnVjdG9yKGEpIHsKICAgICAgICBzdXBlcihhKQogICAgfQogICAgUmVsZWFzZSgpIHsKICAgICAgICBzdXBlci5SZWxlYXNlKCkKICAgIH0KICAgIE9uQ3JlYXRlKCkge30KfTsKY29uc3QgQzMkanNjb21wJDMwMCA9IHNlbGYuQzM7CkMzJGpzY29tcCQzMDAuQmVoYXZpb3JzLlBpbi5JbnN0YW5jZSA9IGNsYXNzIGV4dGVuZHMgQzMkanNjb21wJDMwMC5TREtCZWhhdmlvckluc3RhbmNlQmFzZSB7CiAgICBjb25zdHJ1Y3RvcihhLCBiKSB7CiAgICAgICAgc3VwZXIoYSk7CiAgICAgICAgdGhpcy5fcGluSW5zdCA9IG51bGw7CiAgICAgICAgdGhpcy5fcGluVWlkID0gLTE7CiAgICAgICAgdGhpcy5fbW9kZSA9ICIiOwogICAgICAgIHRoaXMuX3Byb3BTZXQgPSBuZXcgU2V0OwogICAgICAgIHRoaXMuX2xhc3RLbm93bkFuZ2xlID0gdGhpcy5fZHogPSB0aGlzLl9kQW5nbGUgPSB0aGlzLl9kSGVpZ2h0ID0gdGhpcy5fZFdpZHRoID0gdGhpcy5fZHkgPSB0aGlzLl9keCA9IHRoaXMuX3BpbkltYWdlUG9pbnQgPSB0aGlzLl9waW5BbmdsZSA9IHRoaXMuX3BpbkRpc3QgPSAwOwogICAgICAgIHRoaXMuX2Rlc3Ryb3kgPSAhMTsKICAgICAgICBiICYmICh0aGlzLl9kZXN0cm95ID0gYlswXSk7CiAgICAgICAgYSA9IHRoaXMuX3J1bnRpbWUuRGlzcGF0Y2hlcigpOwogICAgICAgIHRoaXMuX2Rpc3Bvc2FibGVzID0gbmV3IEMzJGpzY29tcCQzMDAuQ29tcG9zaXRlRGlzcG9zYWJsZShDMyRqc2NvbXAkMzAwLkRpc3Bvc2FibGUuRnJvbShhLCAiaW5zdGFuY2VkZXN0cm95IiwKICAgICAgICAgICAgZCA9PiB0aGlzLl9Pbkluc3RhbmNlRGVzdHJveWVkKGQuaW5zdGFuY2UpKSwgQzMkanNjb21wJDMwMC5EaXNwb3NhYmxlLkZyb20oYSwgImFmdGVybG9hZCIsIGQgPT4gdGhpcy5fT25BZnRlckxvYWQoKSkpCiAgICB9CiAgICBSZWxlYXNlKCkgewogICAgICAgIHRoaXMuX3Bpbkluc3QgPSBudWxsOwogICAgICAgIHN1cGVyLlJlbGVhc2UoKQogICAgfQogICAgX1NldFBpbkluc3QoYSkgewogICAgICAgIGEgPyAodGhpcy5fcGluSW5zdCA9IGEsIHRoaXMuX1N0YXJ0VGlja2luZzIoKSkgOiAodGhpcy5fcGluSW5zdCA9IG51bGwsIHRoaXMuX1N0b3BUaWNraW5nMigpKQogICAgfQogICAgX1BpbihhLCBiLCBkKSB7CiAgICAgICAgaWYgKGEgJiYgKGEgPSBhLkdldEZpcnN0UGlja2VkKHRoaXMuX2luc3QpKSkKICAgICAgICAgICAgaWYgKHRoaXMuX21vZGUgPSBiLCB0aGlzLl9TZXRQaW5JbnN0KGEpLCBiID0gdGhpcy5faW5zdC5HZXRXb3JsZEluZm8oKSwgYSA9IGEuR2V0V29ybGRJbmZvKCksICJwcm9wZXJ0aWVzIiA9PT0gdGhpcy5fbW9kZSkgewogICAgICAgICAgICAgICAgY29uc3QgYyA9IHRoaXMuX3Byb3BTZXQ7CiAgICAgICAgICAgICAgICBjLmNsZWFyKCk7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGUgb2YgZCkgYy5hZGQoZSk7CiAgICAgICAgICAgICAgICB0aGlzLl9keCA9IGIuR2V0WCgpIC0gYS5HZXRYKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9keSA9IGIuR2V0WSgpIC0gYS5HZXRZKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9kQW5nbGUgPSBiLkdldEFuZ2xlKCkgLSBhLkdldEFuZ2xlKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9sYXN0S25vd25BbmdsZSA9IGIuR2V0QW5nbGUoKTsKICAgICAgICAgICAgICAgIHRoaXMuX2R6ID0gYi5HZXRaRWxldmF0aW9uKCkgLSBhLkdldFpFbGV2YXRpb24oKTsKICAgICAgICAgICAgICAgIGMuaGFzKCJ4IikgJiYgYy5oYXMoInkiKSAmJiAodGhpcy5fcGluQW5nbGUgPSBDMyRqc2NvbXAkMzAwLmFuZ2xlVG8oYS5HZXRYKCksIGEuR2V0WSgpLCBiLkdldFgoKSwgYi5HZXRZKCkpIC0gYS5HZXRBbmdsZSgpLCB0aGlzLl9waW5EaXN0ID0gQzMkanNjb21wJDMwMC5kaXN0YW5jZVRvKGEuR2V0WCgpLCBhLkdldFkoKSwgYi5HZXRYKCksIGIuR2V0WSgpKSk7CiAgICAgICAgICAgICAgICBjLmhhcygid2lkdGgtYWJzIikgPyB0aGlzLl9kV2lkdGggPSBiLkdldFdpZHRoKCkgLSBhLkdldFdpZHRoKCkgOiBjLmhhcygid2lkdGgtc2NhbGUiKSAmJiAodGhpcy5fZFdpZHRoID0gYi5HZXRXaWR0aCgpIC8gYS5HZXRXaWR0aCgpKTsKICAgICAgICAgICAgICAgIGMuaGFzKCJoZWlnaHQtYWJzIikgPyB0aGlzLl9kSGVpZ2h0ID0gYi5HZXRIZWlnaHQoKSAtCiAgICAgICAgICAgICAgICAgICAgYS5HZXRIZWlnaHQoKSA6IGMuaGFzKCJoZWlnaHQtc2NhbGUiKSAmJiAodGhpcy5fZEhlaWdodCA9IGIuR2V0SGVpZ2h0KCkgLyBhLkdldEhlaWdodCgpKQogICAgICAgICAgICB9IGVsc2UgdGhpcy5fcGluRGlzdCA9IEMzJGpzY29tcCQzMDAuZGlzdGFuY2VUbyhhLkdldFgoKSwgYS5HZXRZKCksIGIuR2V0WCgpLCBiLkdldFkoKSkKICAgIH0KICAgIFNhdmVUb0pzb24oKSB7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuX3Byb3BTZXQsCiAgICAgICAgICAgIGIgPSB0aGlzLl9tb2RlLAogICAgICAgICAgICBkID0gewogICAgICAgICAgICAgICAgdWlkOiB0aGlzLl9waW5JbnN0ID8gdGhpcy5fcGluSW5zdC5HZXRVSUQoKSA6IC0xLAogICAgICAgICAgICAgICAgbTogYiwKICAgICAgICAgICAgICAgIGQ6IHRoaXMuX2Rlc3Ryb3kKICAgICAgICAgICAgfTsKICAgICAgICBpZiAoInJvcGUiID09PSBiIHx8ICJiYXIiID09PSBiKSBkLnBkID0gdGhpcy5fcGluRGlzdDsKICAgICAgICBlbHNlIGlmICgicHJvcGVydGllcyIgPT09IGIpIHsKICAgICAgICAgICAgZC5wcyA9IFsuLi50aGlzLl9wcm9wU2V0XTsKICAgICAgICAgICAgYS5oYXMoImltYWdlcG9pbnQiKSA/IGQuaXAgPSB0aGlzLl9waW5JbWFnZVBvaW50IDogYS5oYXMoIngiKSAmJiBhLmhhcygieSIpID8gKGQucGEgPSB0aGlzLl9waW5BbmdsZSwgZC5wZCA9IHRoaXMuX3BpbkRpc3QpIDogKGEuaGFzKCJ4IikgJiYgKGQuZHggPSB0aGlzLl9keCksCiAgICAgICAgICAgICAgICBhLmhhcygieSIpICYmIChkLmR5ID0gdGhpcy5fZHkpKTsKICAgICAgICAgICAgYS5oYXMoImFuZ2xlIikgJiYgKGQuZGEgPSB0aGlzLl9kQW5nbGUsIGQubGthID0gdGhpcy5fbGFzdEtub3duQW5nbGUpOwogICAgICAgICAgICBpZiAoYS5oYXMoIndpZHRoLWFicyIpIHx8IGEuaGFzKCJ3aWR0aC1zY2FsZSIpKSBkLmR3ID0gdGhpcy5fZFdpZHRoOwogICAgICAgICAgICBpZiAoYS5oYXMoImhlaWdodC1hYnMiKSB8fCBhLmhhcygiaGVpZ2h0LXNjYWxlIikpIGQuZGggPSB0aGlzLl9kSGVpZ2h0OwogICAgICAgICAgICBhLmhhcygieiIpICYmIChkLmR6ID0gdGhpcy5fZHopCiAgICAgICAgfQogICAgICAgIHJldHVybiBkCiAgICB9CiAgICBMb2FkRnJvbUpzb24oYSkgewogICAgICAgIGNvbnN0IGIgPSBhLm0sCiAgICAgICAgICAgIGQgPSB0aGlzLl9wcm9wU2V0OwogICAgICAgIGQuY2xlYXIoKTsKICAgICAgICB0aGlzLl9waW5VaWQgPSBhLnVpZDsKICAgICAgICBpZiAoIm51bWJlciIgPT09IHR5cGVvZiBiKSB0aGlzLl9Mb2FkRnJvbUpzb25fTGVnYWN5KGEpOwogICAgICAgIGVsc2UgaWYgKHRoaXMuX21vZGUgPSBiLCBhLmhhc093blByb3BlcnR5KCJkIikgJiYgKHRoaXMuX2Rlc3Ryb3kgPSAhIWEuZCksICJyb3BlIiA9PT0gYiB8fCAiYmFyIiA9PT0gYikgdGhpcy5fcGluRGlzdCA9IGEucGQ7CiAgICAgICAgZWxzZSBpZiAoInByb3BlcnRpZXMiID09PQogICAgICAgICAgICBiKSB7CiAgICAgICAgICAgIGZvciAoY29uc3QgYyBvZiBhLnBzKSBkLmFkZChjKTsKICAgICAgICAgICAgZC5oYXMoImltYWdlcG9pbnQiKSA/IHRoaXMuX3BpbkltYWdlUG9pbnQgPSBhLmlwIDogZC5oYXMoIngiKSAmJiBkLmhhcygieSIpID8gKHRoaXMuX3BpbkFuZ2xlID0gYS5wYSwgdGhpcy5fcGluRGlzdCA9IGEucGQpIDogKGQuaGFzKCJ4IikgJiYgKHRoaXMuX2R4ID0gYS5keCksIGQuaGFzKCJ5IikgJiYgKHRoaXMuX2R5ID0gYS5keSkpOwogICAgICAgICAgICBkLmhhcygiYW5nbGUiKSAmJiAodGhpcy5fZEFuZ2xlID0gYS5kYSwgdGhpcy5fbGFzdEtub3duQW5nbGUgPSBhLmxrYSB8fCAwKTsKICAgICAgICAgICAgaWYgKGQuaGFzKCJ3aWR0aC1hYnMiKSB8fCBkLmhhcygid2lkdGgtc2NhbGUiKSkgdGhpcy5fZFdpZHRoID0gYS5kdzsKICAgICAgICAgICAgaWYgKGQuaGFzKCJoZWlnaHQtYWJzIikgfHwgZC5oYXMoImhlaWdodC1zY2FsZSIpKSB0aGlzLl9kSGVpZ2h0ID0gYS5kaDsKICAgICAgICAgICAgZC5oYXMoInoiKSAmJiAodGhpcy5fZHogPSBhLmR6KQogICAgICAgIH0KICAgIH0KICAgIF9Mb2FkRnJvbUpzb25fTGVnYWN5KGEpIHsKICAgICAgICBjb25zdCBiID0gdGhpcy5fcHJvcFNldCwKICAgICAgICAgICAgZCA9IGEubXNhLAogICAgICAgICAgICBjID0gYS50c2EsCiAgICAgICAgICAgIGUgPSBhLnBhLAogICAgICAgICAgICBnID0gYS5wZDsKICAgICAgICBzd2l0Y2ggKGEubSkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICB0aGlzLl9tb2RlID0KICAgICAgICAgICAgICAgICAgICAicHJvcGVydGllcyI7CiAgICAgICAgICAgICAgICBiLmFkZCgieCIpLmFkZCgieSIpLmFkZCgiYW5nbGUiKTsKICAgICAgICAgICAgICAgIHRoaXMuX3BpbkFuZ2xlID0gZTsKICAgICAgICAgICAgICAgIHRoaXMuX3BpbkRpc3QgPSBnOwogICAgICAgICAgICAgICAgdGhpcy5fZEFuZ2xlID0gZCAtIGM7CiAgICAgICAgICAgICAgICB0aGlzLl9sYXN0S25vd25BbmdsZSA9IGEubGthOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgIHRoaXMuX21vZGUgPSAicHJvcGVydGllcyI7CiAgICAgICAgICAgICAgICBiLmFkZCgieCIpLmFkZCgieSIpOwogICAgICAgICAgICAgICAgdGhpcy5fcGluQW5nbGUgPSBlOwogICAgICAgICAgICAgICAgdGhpcy5fcGluRGlzdCA9IGc7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgdGhpcy5fbW9kZSA9ICJwcm9wZXJ0aWVzIjsKICAgICAgICAgICAgICAgIGIuYWRkKCJhbmdsZSIpOwogICAgICAgICAgICAgICAgdGhpcy5fZEFuZ2xlID0gZCAtIGM7CiAgICAgICAgICAgICAgICB0aGlzLl9sYXN0S25vd25BbmdsZSA9IGEubGthOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgIHRoaXMuX21vZGUgPSAicm9wZSI7CiAgICAgICAgICAgICAgICB0aGlzLl9waW5EaXN0ID0gYS5wZDsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICB0aGlzLl9tb2RlID0gImJhciIsIHRoaXMuX3BpbkRpc3QgPSBhLnBkCiAgICAgICAgfQogICAgfQogICAgX09uQWZ0ZXJMb2FkKCkgewogICAgICAgIC0xID09PSB0aGlzLl9waW5VaWQgPyB0aGlzLl9TZXRQaW5JbnN0KG51bGwpIDogKHRoaXMuX1NldFBpbkluc3QodGhpcy5fcnVudGltZS5HZXRJbnN0YW5jZUJ5VUlEKHRoaXMuX3BpblVpZCkpLAogICAgICAgICAgICB0aGlzLl9waW5VaWQgPSAtMSkKICAgIH0KICAgIF9Pbkluc3RhbmNlRGVzdHJveWVkKGEpIHsKICAgICAgICB0aGlzLl9waW5JbnN0ID09PSBhICYmICh0aGlzLl9TZXRQaW5JbnN0KG51bGwpLCB0aGlzLl9kZXN0cm95ICYmIHRoaXMuX3J1bnRpbWUuRGVzdHJveUluc3RhbmNlKHRoaXMuX2luc3QpKQogICAgfQogICAgVGljazIoKSB7CiAgICAgICAgdmFyIGEgPSB0aGlzLl9waW5JbnN0OwogICAgICAgIGlmIChhKSB7CiAgICAgICAgICAgIHZhciBiID0gYS5HZXRXb3JsZEluZm8oKSwKICAgICAgICAgICAgICAgIGQgPSB0aGlzLl9pbnN0LkdldFdvcmxkSW5mbygpLAogICAgICAgICAgICAgICAgYyA9IHRoaXMuX21vZGUsCiAgICAgICAgICAgICAgICBlID0gITE7CiAgICAgICAgICAgIGlmICgicm9wZSIgPT09IGMgfHwgImJhciIgPT09IGMpIHsKICAgICAgICAgICAgICAgIGlmIChhID0gQzMkanNjb21wJDMwMC5kaXN0YW5jZVRvKGQuR2V0WCgpLCBkLkdldFkoKSwgYi5HZXRYKCksIGIuR2V0WSgpKSwgYSA+IHRoaXMuX3BpbkRpc3QgfHwgImJhciIgPT09IGMgJiYgYSA8IHRoaXMuX3BpbkRpc3QpIGUgPSBDMyRqc2NvbXAkMzAwLmFuZ2xlVG8oYi5HZXRYKCksIGIuR2V0WSgpLCBkLkdldFgoKSwgZC5HZXRZKCkpLCBkLlNldFhZKGIuR2V0WCgpICsgTWF0aC5jb3MoZSkgKiB0aGlzLl9waW5EaXN0LCBiLkdldFkoKSArIE1hdGguc2luKGUpICoKICAgICAgICAgICAgICAgICAgICB0aGlzLl9waW5EaXN0KSwgZSA9ICEwCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjID0gdGhpcy5fcHJvcFNldDsKICAgICAgICAgICAgICAgIGlmIChjLmhhcygiaW1hZ2Vwb2ludCIpKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgW2csIGtdID0gYS5HZXRJbWFnZVBvaW50KHRoaXMuX3BpbkltYWdlUG9pbnQpOwogICAgICAgICAgICAgICAgICAgIGQuRXF1YWxzWFkoZywgaykgfHwgKGQuU2V0WFkoZywgayksIGUgPSAhMCkKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYy5oYXMoIngiKSAmJiBjLmhhcygieSIpKSB7CiAgICAgICAgICAgICAgICAgICAgYSA9IGIuR2V0WCgpICsgTWF0aC5jb3MoYi5HZXRBbmdsZSgpICsgdGhpcy5fcGluQW5nbGUpICogdGhpcy5fcGluRGlzdDsKICAgICAgICAgICAgICAgICAgICBjb25zdCBnID0gYi5HZXRZKCkgKyBNYXRoLnNpbihiLkdldEFuZ2xlKCkgKyB0aGlzLl9waW5BbmdsZSkgKiB0aGlzLl9waW5EaXN0OwogICAgICAgICAgICAgICAgICAgIGQuRXF1YWxzWFkoYSwgZykgfHwgKGQuU2V0WFkoYSwgZyksIGUgPSAhMCkKICAgICAgICAgICAgICAgIH0gZWxzZSBhID0gYi5HZXRYKCkgKyB0aGlzLl9keCwgYy5oYXMoIngiKSAmJiBhICE9PSBkLkdldFgoKSAmJiAoZC5TZXRYKGEpLCBlID0gITApLCBhID0gYi5HZXRZKCkgKyB0aGlzLl9keSwgYy5oYXMoInkiKSAmJiBhICE9PSBkLkdldFkoKSAmJiAoZC5TZXRZKGEpLCBlID0gITApOwogICAgICAgICAgICAgICAgYy5oYXMoImFuZ2xlIikgJiYgKHRoaXMuX2xhc3RLbm93bkFuZ2xlICE9PQogICAgICAgICAgICAgICAgICAgIGQuR2V0QW5nbGUoKSAmJiAodGhpcy5fZEFuZ2xlID0gQzMkanNjb21wJDMwMC5jbGFtcEFuZ2xlKHRoaXMuX2RBbmdsZSArIChkLkdldEFuZ2xlKCkgLSB0aGlzLl9sYXN0S25vd25BbmdsZSkpKSwgYSA9IEMzJGpzY29tcCQzMDAuY2xhbXBBbmdsZShiLkdldEFuZ2xlKCkgKyB0aGlzLl9kQW5nbGUpLCBhICE9PSBkLkdldEFuZ2xlKCkgJiYgKGQuU2V0QW5nbGUoYSksIGUgPSAhMCksIHRoaXMuX2xhc3RLbm93bkFuZ2xlID0gZC5HZXRBbmdsZSgpKTsKICAgICAgICAgICAgICAgIGMuaGFzKCJ3aWR0aC1hYnMiKSAmJiAoYSA9IGIuR2V0V2lkdGgoKSArIHRoaXMuX2RXaWR0aCwgYSAhPT0gZC5HZXRXaWR0aCgpICYmIChkLlNldFdpZHRoKGEpLCBlID0gITApKTsKICAgICAgICAgICAgICAgIGMuaGFzKCJ3aWR0aC1zY2FsZSIpICYmIChhID0gYi5HZXRXaWR0aCgpICogdGhpcy5fZFdpZHRoLCBhICE9PSBkLkdldFdpZHRoKCkgJiYgKGQuU2V0V2lkdGgoYSksIGUgPSAhMCkpOwogICAgICAgICAgICAgICAgYy5oYXMoImhlaWdodC1hYnMiKSAmJiAoYSA9IGIuR2V0SGVpZ2h0KCkgKyB0aGlzLl9kSGVpZ2h0LCBhICE9PSBkLkdldEhlaWdodCgpICYmIChkLlNldEhlaWdodChhKSwgZSA9ICEwKSk7CiAgICAgICAgICAgICAgICBjLmhhcygiaGVpZ2h0LXNjYWxlIikgJiYgKGEgPSBiLkdldEhlaWdodCgpICogdGhpcy5fZEhlaWdodCwgYSAhPT0gZC5HZXRIZWlnaHQoKSAmJiAoZC5TZXRIZWlnaHQoYSksIGUgPSAhMCkpOwogICAgICAgICAgICAgICAgYy5oYXMoInoiKSAmJiAoYSA9IGIuR2V0WkVsZXZhdGlvbigpICsgdGhpcy5fZHosIGEgIT09IGQuR2V0WkVsZXZhdGlvbigpICYmIChkLlNldFpFbGV2YXRpb24oYSksIHRoaXMuX3J1bnRpbWUuVXBkYXRlUmVuZGVyKCkpKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGUgJiYgZC5TZXRCYm94Q2hhbmdlZCgpCiAgICAgICAgfQogICAgfQogICAgR2V0RGVidWdnZXJQcm9wZXJ0aWVzKCkgewogICAgICAgIHJldHVybiBbewogICAgICAgICAgICB0aXRsZTogIiQiICsgdGhpcy5HZXRCZWhhdmlvclR5cGUoKS5HZXROYW1lKCksCiAgICAgICAgICAgIHByb3BlcnRpZXM6IFt7CiAgICAgICAgICAgICAgICBuYW1lOiAiYmVoYXZpb3JzLnBpbi5kZWJ1Z2dlci5pcy1waW5uZWQiLAogICAgICAgICAgICAgICAgdmFsdWU6ICEhdGhpcy5fcGluSW5zdAogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICBuYW1lOiAiYmVoYXZpb3JzLnBpbi5kZWJ1Z2dlci5waW5uZWQtdWlkIiwKICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLl9waW5JbnN0ID8gdGhpcy5fcGluSW5zdC5HZXRVSUQoKSA6IDAKICAgICAgICAgICAgfV0KICAgICAgICB9XQogICAgfQp9OwpzZWxmLkMzLkJlaGF2aW9ycy5QaW4uQ25kcyA9IHsKICAgIElzUGlubmVkKCkgewogICAgICAgIHJldHVybiAhIXRoaXMuX3Bpbkluc3QKICAgIH0sCiAgICBXaWxsRGVzdHJveSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZGVzdHJveQogICAgfQp9OwpzZWxmLkMzLkJlaGF2aW9ycy5QaW4uQWN0cyA9IHsKICAgIFBpbkJ5RGlzdGFuY2UoYSwgYikgewogICAgICAgIHRoaXMuX1BpbihhLCAwID09PSBiID8gInJvcGUiIDogImJhciIpCiAgICB9LAogICAgUGluQnlQcm9wZXJ0aWVzKGEsIGIsIGQsIGMsIGUsIGcsIGspIHsKICAgICAgICBjb25zdCBtID0gW107CiAgICAgICAgYiAmJiBtLnB1c2goIngiKTsKICAgICAgICBkICYmIG0ucHVzaCgieSIpOwogICAgICAgIGMgJiYgbS5wdXNoKCJhbmdsZSIpOwogICAgICAgIGsgJiYgbS5wdXNoKCJ6Iik7CiAgICAgICAgMSA9PT0gZSA/IG0ucHVzaCgid2lkdGgtYWJzIikgOiAyID09PSBlICYmIG0ucHVzaCgid2lkdGgtc2NhbGUiKTsKICAgICAgICAxID09PSBnID8gbS5wdXNoKCJoZWlnaHQtYWJzIikgOiAyID09PSBnICYmIG0ucHVzaCgiaGVpZ2h0LXNjYWxlIik7CiAgICAgICAgMCAhPT0gbS5sZW5ndGggJiYgdGhpcy5fUGluKGEsICJwcm9wZXJ0aWVzIiwgbSkKICAgIH0sCiAgICBQaW5CeUltYWdlUG9pbnQoYSwgYiwgZCwgYywgZSwgZykgewogICAgICAgIGNvbnN0IGsgPSBbImltYWdlcG9pbnQiXTsKICAgICAgICBkICYmIGsucHVzaCgiYW5nbGUiKTsKICAgICAgICBnICYmIGsucHVzaCgieiIpOwogICAgICAgIDEgPT09IGMgPyBrLnB1c2goIndpZHRoLWFicyIpIDogMiA9PT0gYyAmJiBrLnB1c2goIndpZHRoLXNjYWxlIik7CiAgICAgICAgMSA9PT0gZSA/IGsucHVzaCgiaGVpZ2h0LWFicyIpIDoKICAgICAgICAgICAgMiA9PT0gZSAmJiBrLnB1c2goImhlaWdodC1zY2FsZSIpOwogICAgICAgIHRoaXMuX3BpbkltYWdlUG9pbnQgPSBiOwogICAgICAgIHRoaXMuX1BpbihhLCAicHJvcGVydGllcyIsIGspCiAgICB9LAogICAgU2V0UGluRGlzdGFuY2UoYSkgewogICAgICAgIGlmICgicm9wZSIgPT09IHRoaXMuX21vZGUgfHwgImJhciIgPT09IHRoaXMuX21vZGUpIHRoaXMuX3BpbkRpc3QgPSBNYXRoLm1heChhLCAwKQogICAgfSwKICAgIFNldERlc3Ryb3koYSkgewogICAgICAgIHRoaXMuX2Rlc3Ryb3kgPSBhCiAgICB9LAogICAgVW5waW4oKSB7CiAgICAgICAgdGhpcy5fU2V0UGluSW5zdChudWxsKTsKICAgICAgICB0aGlzLl9tb2RlID0gIiI7CiAgICAgICAgdGhpcy5fcHJvcFNldC5jbGVhcigpOwogICAgICAgIHRoaXMuX3BpbkltYWdlUG9pbnQgPSAiIgogICAgfSwKICAgIFBpbihhLCBiKSB7CiAgICAgICAgc3dpdGNoIChiKSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIHRoaXMuX1BpbihhLCAicHJvcGVydGllcyIsIFsieCIsICJ5IiwgImFuZ2xlIl0pOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgIHRoaXMuX1BpbihhLCAicHJvcGVydGllcyIsIFsieCIsICJ5Il0pOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgIHRoaXMuX1BpbihhLCAicHJvcGVydGllcyIsIFsiYW5nbGUiXSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgdGhpcy5fUGluKGEsICJyb3BlIik7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgdGhpcy5fUGluKGEsCiAgICAgICAgICAgICAgICAgICAgImJhciIpCiAgICAgICAgfQogICAgfQp9OwpzZWxmLkMzLkJlaGF2aW9ycy5QaW4uRXhwcyA9IHsKICAgIFBpbm5lZFVJRCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcGluSW5zdCA/IHRoaXMuX3Bpbkluc3QuR2V0VUlEKCkgOiAtMQogICAgfQp9OwoidXNlIHN0cmljdCI7CmNvbnN0IEMzJGpzY29tcCQzMDQgPSBzZWxmLkMzLAogICAgQzNYJGpzY29tcCQzMSA9IHNlbGYuQzNYOwpsZXQgdGVtcFZlYzJhID0gbnVsbCwKICAgIHRlbXBWZWMyYiA9IG51bGwsCiAgICB2ZWMyUmVjeWNsZUNhY2hlID0gW10sCiAgICBCb3gyRCA9IG51bGwsCiAgICBwaHlzaWNzQmVoYXZpb3IgPSBudWxsOwoKZnVuY3Rpb24gU2V0T2JqZWN0VHlwZUNvbGxpc2lvbnNFbmFibGVkKGEsIGIsIGQpIHsKICAgIHZhciBjID0gYS5HZXRTYXZlZERhdGFNYXAoKTsKICAgIGNvbnN0IGUgPSBiLkdldFNhdmVkRGF0YU1hcCgpOwogICAgZCA/ICgoYyA9IGMuZ2V0KCJQaHlzaWNzX0Rpc2FibGVkQ29sbGlzaW9ucyIpKSAmJiBjLmRlbGV0ZShiLkdldFNJRCgpKSwgKGIgPSBlLmdldCgiUGh5c2ljc19EaXNhYmxlZENvbGxpc2lvbnMiKSkgJiYgYi5kZWxldGUoYS5HZXRTSUQoKSkpIDogKGQgPSBjLmdldCgiUGh5c2ljc19EaXNhYmxlZENvbGxpc2lvbnMiKSwgZCB8fCAoZCA9IG5ldyBTZXQsIGMuc2V0KCJQaHlzaWNzX0Rpc2FibGVkQ29sbGlzaW9ucyIsIGQpKSwgYyA9IGUuZ2V0KCJQaHlzaWNzX0Rpc2FibGVkQ29sbGlzaW9ucyIpLCBjIHx8IChjID0gbmV3IFNldCwgZS5zZXQoIlBoeXNpY3NfRGlzYWJsZWRDb2xsaXNpb25zIiwgYykpLCBkLmFkZChiLkdldFNJRCgpKSwgYy5hZGQoYS5HZXRTSUQoKSkpCn0KQzMkanNjb21wJDMwNC5CZWhhdmlvcnMuUGh5c2ljcyA9IGNsYXNzIGV4dGVuZHMgQzMkanNjb21wJDMwNC5TREtCZWhhdmlvckJhc2UgewogICAgY29uc3RydWN0b3IoYSkgewogICAgICAgIGEuc2NyaXB0SW50ZXJmYWNlQ2xhc3MgPSBzZWxmLklQaHlzaWNzQmVoYXZpb3I7CiAgICAgICAgc3VwZXIoYSk7CiAgICAgICAgdGhpcy5fd29ybGQgPSBudWxsOwogICAgICAgIHRoaXMuX3dvcmxkRyA9IDEwOwogICAgICAgIHRoaXMuX3dvcmxkU2NhbGUgPSAuMDI7CiAgICAgICAgdGhpcy5fd29ybGRNYW5pZm9sZCA9IG51bGw7CiAgICAgICAgdGhpcy5fbGFzdFVwZGF0ZVRpY2sgPSAtMTsKICAgICAgICB0aGlzLl9zdGVwcGluZ01vZGUgPSAxOwogICAgICAgIHRoaXMuX3ZlbG9jaXR5SXRlcmF0aW9ucyA9IDg7CiAgICAgICAgdGhpcy5fcG9zaXRpb25JdGVyYXRpb25zID0gMzsKICAgICAgICB0aGlzLl9hbGxDb2xsaXNpb25zRW5hYmxlZCA9ICEwOwogICAgICAgIHRoaXMuX3J1bnRpbWUuQWRkTG9hZFByb21pc2UodGhpcy5fTG9hZEJveDJEV2FzbSgpKQogICAgfQogICAgYXN5bmMgX0xvYWRCb3gyRFdhc20oKSB7CiAgICAgICAgY29uc3QgYSA9IGF3YWl0IHRoaXMuX3J1bnRpbWUuR2V0QXNzZXRNYW5hZ2VyKCkuR2V0UHJvamVjdEZpbGVVcmwoImJveDJkLndhc20iKTsKICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZShiID0+IHsKICAgICAgICAgICAgc2VsZi5Cb3gyRFdhc21Nb2R1bGUoewogICAgICAgICAgICAgICAgd2FzbUJpbmFyeUZpbGU6IGEKICAgICAgICAgICAgfSkudGhlbihkID0+IHsKICAgICAgICAgICAgICAgIEJveDJEID0gZDsKICAgICAgICAgICAgICAgIHRoaXMuX0luaXRCb3gyRFdvcmxkKCk7CiAgICAgICAgICAgICAgICBiKCkKICAgICAgICAgICAgfSkKICAgICAgICB9KQogICAgfQogICAgX0luaXRCb3gyRFdvcmxkKCkgewogICAgICAgIGNvbnN0IGEgPSB0aGlzLl9ydW50aW1lLkdldENvbGxpc2lvbkVuZ2luZSgpOwogICAgICAgIHRlbXBWZWMyYSA9IEMzJGpzY29tcCQzMDQuQmVoYXZpb3JzLlBoeXNpY3MuR2V0VmVjMigwLCAwKTsKICAgICAgICB0ZW1wVmVjMmIgPSBDMyRqc2NvbXAkMzA0LkJlaGF2aW9ycy5QaHlzaWNzLkdldFZlYzIoMCwgMCk7CiAgICAgICAgdGhpcy5fd29ybGQgPSBuZXcgQm94MkQuYjJXb3JsZChDMyRqc2NvbXAkMzA0LkJlaGF2aW9ycy5QaHlzaWNzLkdldFRlbXBWZWMyQSgwLCB0aGlzLl93b3JsZEcpLCAhMCk7CiAgICAgICAgdmFyIGIgPSBuZXcgQm94MkQuSlNDb250YWN0TGlzdGVuZXI7CiAgICAgICAgYi5CZWdpbkNvbnRhY3QgPSBkID0+IHsKICAgICAgICAgICAgdmFyIGMgPSBCb3gyRC53cmFwUG9pbnRlcihkLCBCb3gyRC5iMkNvbnRhY3QpOwogICAgICAgICAgICBkID0gQzMkanNjb21wJDMwNC5CZWhhdmlvcnMuUGh5c2ljcy5JbnN0YW5jZS5Mb29rdXBCZWhJbnN0RnJvbUJvZHkoYy5HZXRGaXh0dXJlQSgpLkdldEJvZHkoKSk7CiAgICAgICAgICAgIGMgPSBDMyRqc2NvbXAkMzA0LkJlaGF2aW9ycy5QaHlzaWNzLkluc3RhbmNlLkxvb2t1cEJlaEluc3RGcm9tQm9keShjLkdldEZpeHR1cmVCKCkuR2V0Qm9keSgpKTsKICAgICAgICAgICAgYS5SZWdpc3RlckNvbGxpc2lvbihkLkdldE9iamVjdEluc3RhbmNlKCksIGMuR2V0T2JqZWN0SW5zdGFuY2UoKSkKICAgICAgICB9OwogICAgICAgIGIuRW5kQ29udGFjdCA9ICgpID0+IHt9OwogICAgICAgIGIuUHJlU29sdmUgPSAoKSA9PiB7fTsKICAgICAgICBiLlBvc3RTb2x2ZSA9ICgpID0+IHt9OwogICAgICAgIHRoaXMuX3dvcmxkLlNldENvbnRhY3RMaXN0ZW5lcihiKTsKICAgICAgICBiID0gbmV3IEJveDJELkpTQ29udGFjdEZpbHRlcjsKICAgICAgICBiLlNob3VsZENvbGxpZGUgPSAoZCwgYykgPT4gewogICAgICAgICAgICBpZiAodGhpcy5fYWxsQ29sbGlzaW9uc0VuYWJsZWQpIHJldHVybiAhMDsKICAgICAgICAgICAgZCA9IEJveDJELndyYXBQb2ludGVyKGQsIEJveDJELmIyRml4dHVyZSk7CiAgICAgICAgICAgIGMgPSBCb3gyRC53cmFwUG9pbnRlcihjLCBCb3gyRC5iMkZpeHR1cmUpOwogICAgICAgICAgICBkID0gQzMkanNjb21wJDMwNC5CZWhhdmlvcnMuUGh5c2ljcy5JbnN0YW5jZS5Mb29rdXBCZWhJbnN0RnJvbUJvZHkoZC5HZXRCb2R5KCkpOwogICAgICAgICAgICBjID0gQzMkanNjb21wJDMwNC5CZWhhdmlvcnMuUGh5c2ljcy5JbnN0YW5jZS5Mb29rdXBCZWhJbnN0RnJvbUJvZHkoYy5HZXRCb2R5KCkpOwogICAgICAgICAgICBkID0gZC5HZXRPYmplY3RJbnN0YW5jZSgpLkdldE9iamVjdENsYXNzKCk7CiAgICAgICAgICAgIGNvbnN0IGUgPSBjLkdldE9iamVjdEluc3RhbmNlKCkuR2V0T2JqZWN0Q2xhc3MoKTsKICAgICAgICAgICAgYyA9IGQuR2V0U0lEKCk7CiAgICAgICAgICAgIGNvbnN0IGcgPSBlLkdldFNJRCgpOwogICAgICAgICAgICByZXR1cm4gKGQgPSBkLkdldFNhdmVkRGF0YU1hcCgpLmdldCgiUGh5c2ljc19EaXNhYmxlZENvbGxpc2lvbnMiKSkgJiYgZC5oYXMoZykgPyAhMSA6IChkID0gZS5HZXRTYXZlZERhdGFNYXAoKS5nZXQoIlBoeXNpY3NfRGlzYWJsZWRDb2xsaXNpb25zIikpICYmIGQuaGFzKGMpID8gITEgOiAhMAogICAgICAgIH07CiAgICAgICAgdGhpcy5fd29ybGQuU2V0Q29udGFjdEZpbHRlcihiKTsKICAgICAgICB0aGlzLl93b3JsZE1hbmlmb2xkID0gbmV3IEJveDJELmIyV29ybGRNYW5pZm9sZAogICAgfQogICAgUmVsZWFzZSgpIHsKICAgICAgICBzdXBlci5SZWxlYXNlKCkKICAgIH0KICAgIEdldEJveDJEKCkgewogICAgICAgIHJldHVybiBCb3gyRAogICAgfQogICAgR2V0V29ybGQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3dvcmxkCiAgICB9CiAgICBHZXRXb3JsZFNjYWxlKCkgewogICAgICAgIHJldHVybiB0aGlzLl93b3JsZFNjYWxlCiAgICB9CiAgICBHZXRTdGVwcGluZ01vZGUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3N0ZXBwaW5nTW9kZQogICAgfQogICAgU2V0U3RlcHBpbmdNb2RlKGEpIHsKICAgICAgICB0aGlzLl9zdGVwcGluZ01vZGUgPQogICAgICAgICAgICBhCiAgICB9CiAgICBTZXRMYXN0VXBkYXRlVGljayhhKSB7CiAgICAgICAgdGhpcy5fbGFzdFVwZGF0ZVRpY2sgPSBhCiAgICB9CiAgICBHZXRMYXN0VXBkYXRlVGljaygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fbGFzdFVwZGF0ZVRpY2sKICAgIH0KICAgIFNldFZlbG9jaXR5SXRlcmF0aW9ucyhhKSB7CiAgICAgICAgdGhpcy5fdmVsb2NpdHlJdGVyYXRpb25zID0gTWF0aC5tYXgoYSwgMSkKICAgIH0KICAgIEdldFZlbG9jaXR5SXRlcmF0aW9ucygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fdmVsb2NpdHlJdGVyYXRpb25zCiAgICB9CiAgICBTZXRQb3NpdGlvbkl0ZXJhdGlvbnMoYSkgewogICAgICAgIHRoaXMuX3Bvc2l0aW9uSXRlcmF0aW9ucyA9IE1hdGgubWF4KGEsIDEpCiAgICB9CiAgICBHZXRQb3NpdGlvbkl0ZXJhdGlvbnMoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3Bvc2l0aW9uSXRlcmF0aW9ucwogICAgfQogICAgU2V0SXRlcmF0aW9ucyhhLCBiKSB7CiAgICAgICAgdGhpcy5TZXRWZWxvY2l0eUl0ZXJhdGlvbnMoYSk7CiAgICAgICAgdGhpcy5TZXRQb3NpdGlvbkl0ZXJhdGlvbnMoYikKICAgIH0KICAgIEdldEdyYXZpdHkoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3dvcmxkRwogICAgfQogICAgU2V0R3Jhdml0eShhKSB7CiAgICAgICAgYSAhPT0gdGhpcy5fd29ybGRHICYmICh0aGlzLl93b3JsZC5TZXRHcmF2aXR5KEMzJGpzY29tcCQzMDQuQmVoYXZpb3JzLlBoeXNpY3MuR2V0VGVtcFZlYzJBKDAsCiAgICAgICAgICAgIGEpKSwgdGhpcy5fd29ybGRHID0gYSwgdGhpcy5fV2FrZVVwQWxsUGh5c2ljc0JvZGllcygpKQogICAgfQogICAgX1dha2VVcEFsbFBoeXNpY3NCb2RpZXMoKSB7CiAgICAgICAgZm9yIChjb25zdCBiIG9mIHRoaXMuR2V0SW5zdGFuY2VzKCkpIHsKICAgICAgICAgICAgdmFyIGEgPSBDMyRqc2NvbXAkMzA0LkJlaGF2aW9ycy5QaHlzaWNzLkluc3RhbmNlLkxvb2t1cEJlaEluc3RGcm9tSW5zdChiKTsKICAgICAgICAgICAgYSAmJiAoYSA9IGEuR2V0Qm9keSgpKSAmJiBhLlNldEF3YWtlKCEwKQogICAgICAgIH0KICAgIH0KICAgIERpc2FibGVTaG91bGRDb2xsaWRlRmFzdFBhdGgoKSB7CiAgICAgICAgdGhpcy5fYWxsQ29sbGlzaW9uc0VuYWJsZWQgPSAhMQogICAgfQogICAgU2V0Q29sbGlzaW9uc0VuYWJsZWQoYSwgYiwgZCkgewogICAgICAgIGQgPSAhIWQ7CiAgICAgICAgaWYgKGEgJiYgYikgewogICAgICAgICAgICBpZiAoYi5Jc0ZhbWlseSgpKQogICAgICAgICAgICAgICAgZm9yIChjb25zdCBjIG9mIGIuR2V0RmFtaWx5TWVtYmVycygpKSBTZXRPYmplY3RUeXBlQ29sbGlzaW9uc0VuYWJsZWQoYSwgYywgZCk7CiAgICAgICAgICAgIGVsc2UgU2V0T2JqZWN0VHlwZUNvbGxpc2lvbnNFbmFibGVkKGEsIGIsIGQpOwogICAgICAgICAgICB0aGlzLkRpc2FibGVTaG91bGRDb2xsaWRlRmFzdFBhdGgoKQogICAgICAgIH0KICAgIH0KICAgIEdldFdvcmxkTWFuaWZvbGQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3dvcmxkTWFuaWZvbGQKICAgIH0KICAgIHN0YXRpYyBHZXRQaHlzaWNzQ29sbGlzaW9uS2V5KCkgewogICAgICAgIHJldHVybiAiUGh5c2ljc19EaXNhYmxlZENvbGxpc2lvbnMiCiAgICB9CiAgICBzdGF0aWMgR2V0VmVjMihhLAogICAgICAgIGIpIHsKICAgICAgICBpZiAodmVjMlJlY3ljbGVDYWNoZS5sZW5ndGgpIHsKICAgICAgICAgICAgY29uc3QgZCA9IHZlYzJSZWN5Y2xlQ2FjaGUucG9wKCk7CiAgICAgICAgICAgIGQuc2V0X3goYSk7CiAgICAgICAgICAgIGQuc2V0X3koYik7CiAgICAgICAgICAgIHJldHVybiBkCiAgICAgICAgfQogICAgICAgIHJldHVybiBuZXcgQm94MkQuYjJWZWMyKGEsIGIpCiAgICB9CiAgICBzdGF0aWMgRnJlZVZlYzIoYSkgewogICAgICAgIHZlYzJSZWN5Y2xlQ2FjaGUucHVzaChhKQogICAgfQogICAgc3RhdGljIEdldFRlbXBWZWMyQShhLCBiKSB7CiAgICAgICAgdGVtcFZlYzJhLnNldF94KGEpOwogICAgICAgIHRlbXBWZWMyYS5zZXRfeShiKTsKICAgICAgICByZXR1cm4gdGVtcFZlYzJhCiAgICB9CiAgICBzdGF0aWMgR2V0VGVtcFZlYzJCKGEsIGIpIHsKICAgICAgICB0ZW1wVmVjMmIuc2V0X3goYSk7CiAgICAgICAgdGVtcFZlYzJiLnNldF95KGIpOwogICAgICAgIHJldHVybiB0ZW1wVmVjMmIKICAgIH0KICAgIHN0YXRpYyBDcmVhdGVQb2x5Z29uU2hhcGUoYSkgewogICAgICAgIGNvbnN0IGIgPSBuZXcgQm94MkQuYjJQb2x5Z29uU2hhcGUsCiAgICAgICAgICAgIGQgPSBCb3gyRC5fbWFsbG9jKDggKiBhLmxlbmd0aCk7CiAgICAgICAgdmFyIGMgPSAwOwogICAgICAgIGZvciAobGV0IGUgPSAwOyBlIDwgYS5sZW5ndGg7ICsrZSkgQm94MkQuSEVBUEYzMltkICsgYyA+PiAyXSA9IGFbZV0uZ2V0X3goKSwgQm94MkQuSEVBUEYzMltkICsKICAgICAgICAgICAgKGMgKyA0KSA+PiAyXSA9IGFbZV0uZ2V0X3koKSwgYyArPSA4OwogICAgICAgIGMgPSBCb3gyRC53cmFwUG9pbnRlcihkLCBCb3gyRC5iMlZlYzIpOwogICAgICAgIGIuU2V0KGMsIGEubGVuZ3RoKTsKICAgICAgICBCb3gyRC5fZnJlZShkKTsKICAgICAgICByZXR1cm4gYgogICAgfQp9Owpjb25zdCBTVEVQUElOR19NT0RFUyA9IFsiZml4ZWQiLCAidmFyaWFibGUiXTsKc2VsZi5JUGh5c2ljc0JlaGF2aW9yID0gY2xhc3MgZXh0ZW5kcyBzZWxmLklCZWhhdmlvciB7CiAgICBjb25zdHJ1Y3RvcihhKSB7CiAgICAgICAgc3VwZXIoYSk7CiAgICAgICAgcGh5c2ljc0JlaGF2aW9yID0gYQogICAgfQogICAgc2V0IHdvcmxkR3Jhdml0eShhKSB7CiAgICAgICAgQzNYJGpzY29tcCQzMS5SZXF1aXJlRmluaXRlTnVtYmVyKGEpOwogICAgICAgIHBoeXNpY3NCZWhhdmlvci5TZXRHcmF2aXR5KGEpCiAgICB9CiAgICBnZXQgd29ybGRHcmF2aXR5KCkgewogICAgICAgIHJldHVybiBwaHlzaWNzQmVoYXZpb3IuR2V0R3Jhdml0eSgpCiAgICB9CiAgICBzZXQgc3RlcHBpbmdNb2RlKGEpIHsKICAgICAgICBhID0gU1RFUFBJTkdfTU9ERVMuaW5kZXhPZihhKTsKICAgICAgICBpZiAoMCA+IGEpIHRocm93IEVycm9yKCJpbnZhbGlkIHN0ZXBwaW5nIG1vZGUiKTsKICAgICAgICBwaHlzaWNzQmVoYXZpb3IuU2V0U3RlcHBpbmdNb2RlKFNURVBQSU5HX01PREVTW2FdKQogICAgfQogICAgZ2V0IHN0ZXBwaW5nTW9kZSgpIHsKICAgICAgICByZXR1cm4gU1RFUFBJTkdfTU9ERVNbcGh5c2ljc0JlaGF2aW9yLkdldFN0ZXBwaW5nTW9kZSgpXQogICAgfQogICAgc2V0IHZlbG9jaXR5SXRlcmF0aW9ucyhhKSB7CiAgICAgICAgQzNYJGpzY29tcCQzMS5SZXF1aXJlRmluaXRlTnVtYmVyKGEpOwogICAgICAgIHBoeXNpY3NCZWhhdmlvci5TZXRWZWxvY2l0eUl0ZXJhdGlvbnMoYSkKICAgIH0KICAgIGdldCB2ZWxvY2l0eUl0ZXJhdGlvbnMoKSB7CiAgICAgICAgcmV0dXJuIHBoeXNpY3NCZWhhdmlvci5HZXRWZWxvY2l0eUl0ZXJhdGlvbnMoKQogICAgfQogICAgc2V0IHBvc2l0aW9uSXRlcmF0aW9ucyhhKSB7CiAgICAgICAgQzNYJGpzY29tcCQzMS5SZXF1aXJlRmluaXRlTnVtYmVyKGEpOwogICAgICAgIHBoeXNpY3NCZWhhdmlvci5TZXRQb3NpdGlvbkl0ZXJhdGlvbnMoYSkKICAgIH0KICAgIGdldCBwb3NpdGlvbkl0ZXJhdGlvbnMoKSB7CiAgICAgICAgcmV0dXJuIHBoeXNpY3NCZWhhdmlvci5HZXRQb3NpdGlvbkl0ZXJhdGlvbnMoKQogICAgfQogICAgc2V0Q29sbGlzaW9uc0VuYWJsZWQoYSwgYiwgZCkgewogICAgICAgIGNvbnN0IGMgPSBwaHlzaWNzQmVoYXZpb3IuR2V0UnVudGltZSgpOwogICAgICAgIGEgPSBjLl9VbndyYXBJT2JqZWN0Q2xhc3MoYSk7CiAgICAgICAgYiA9IGMuX1Vud3JhcElPYmplY3RDbGFzcyhiKTsKICAgICAgICBwaHlzaWNzQmVoYXZpb3IuU2V0Q29sbGlzaW9uc0VuYWJsZWQoYSwgYiwgISFkKQogICAgfQp9Owpjb25zdCBDMyRqc2NvbXAkMzA1ID0gc2VsZi5DMzsKQzMkanNjb21wJDMwNS5CZWhhdmlvcnMuUGh5c2ljcy5UeXBlID0gY2xhc3MgZXh0ZW5kcyBDMyRqc2NvbXAkMzA1LlNES0JlaGF2aW9yVHlwZUJhc2UgewogICAgY29uc3RydWN0b3IoYSkgewogICAgICAgIHN1cGVyKGEpCiAgICB9CiAgICBSZWxlYXNlKCkgewogICAgICAgIHN1cGVyLlJlbGVhc2UoKQogICAgfQogICAgT25DcmVhdGUoKSB7fQp9Owpjb25zdCBDMyRqc2NvbXAkMzA2ID0gc2VsZi5DMywKICAgIEMzWCRqc2NvbXAkMzIgPSBzZWxmLkMzWCwKICAgIElCZWhhdmlvckluc3RhbmNlJGpzY29tcCQ2ID0gc2VsZi5JQmVoYXZpb3JJbnN0YW5jZSwKICAgIGJvZHkyYmVoID0gbmV3IFdlYWtNYXAsCiAgICBpbnN0MmJlaCA9IG5ldyBXZWFrTWFwLAogICAgdGlsZUNvbnZleFBvbHlDYWNoZSA9IG5ldyBXZWFrTWFwLAogICAgR2V0VGVtcFZlYzJBID0gQzMkanNjb21wJDMwNi5CZWhhdmlvcnMuUGh5c2ljcy5HZXRUZW1wVmVjMkEsCiAgICBHZXRUZW1wVmVjMkIgPSBDMyRqc2NvbXAkMzA2LkJlaGF2aW9ycy5QaHlzaWNzLkdldFRlbXBWZWMyQiwKICAgIHRlbXBSZWN0JGpzY29tcCQxMyA9IEMzJGpzY29tcCQzMDYuTmV3KEMzJGpzY29tcCQzMDYuUmVjdCksCiAgICB0ZW1wUXVhZCRqc2NvbXAkOCA9IEMzJGpzY29tcCQzMDYuTmV3KEMzJGpzY29tcCQzMDYuUXVhZCk7CkMzJGpzY29tcCQzMDYuQmVoYXZpb3JzLlBoeXNpY3MuSW5zdGFuY2UgPSBjbGFzcyBleHRlbmRzIEMzJGpzY29tcCQzMDYuU0RLQmVoYXZpb3JJbnN0YW5jZUJhc2UgewogICAgY29uc3RydWN0b3IoYSwgYikgewogICAgICAgIHN1cGVyKGEpOwogICAgICAgIGEgPSB0aGlzLkdldEJlaGF2aW9yKCk7CiAgICAgICAgY29uc3QgZCA9IHRoaXMuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgdGhpcy5fYm94MmQgPSBhLkdldEJveDJEKCk7CiAgICAgICAgdGhpcy5fd29ybGQgPSBhLkdldFdvcmxkKCk7CiAgICAgICAgdGhpcy5fd29ybGRTY2FsZSA9IGEuR2V0V29ybGRTY2FsZSgpOwogICAgICAgIHRoaXMuX2lzSW1tb3ZhYmxlID0gITE7CiAgICAgICAgdGhpcy5fY29sbGlzaW9uTWFzayA9IDA7CiAgICAgICAgdGhpcy5fcHJldmVudFJvdGF0aW9uID0gITE7CiAgICAgICAgdGhpcy5fZGVuc2l0eSA9IDE7CiAgICAgICAgdGhpcy5fZnJpY3Rpb24gPSAuNTsKICAgICAgICB0aGlzLl9yZXN0aXR1dGlvbiA9IC4yOwogICAgICAgIHRoaXMuX2xpbmVhckRhbXBpbmcgPSAwOwogICAgICAgIHRoaXMuX2FuZ3VsYXJEYW1waW5nID0gLjAxOwogICAgICAgIHRoaXMuX2lzQnVsbGV0ID0gITE7CiAgICAgICAgdGhpcy5faXNFbmFibGVkID0gITA7CiAgICAgICAgdGhpcy5fYm9keSA9IG51bGw7CiAgICAgICAgdGhpcy5fZml4dHVyZXMgPSBbXTsKICAgICAgICB0aGlzLl9teUpvaW50cyA9IFtdOwogICAgICAgIHRoaXMuX215Q3JlYXRlZEpvaW50cyA9IFtdOwogICAgICAgIHRoaXMuX2pvaW5pbmdNZSA9IG5ldyBTZXQ7CiAgICAgICAgdGhpcy5fbGFzdEtub3duWCA9IGQuR2V0WCgpOwogICAgICAgIHRoaXMuX2xhc3RLbm93blkgPSBkLkdldFkoKTsKICAgICAgICB0aGlzLl9sYXN0S25vd25BbmdsZSA9IGQuR2V0QW5nbGUoKTsKICAgICAgICB0aGlzLl9sYXN0SGVpZ2h0ID0gdGhpcy5fbGFzdFdpZHRoID0gMDsKICAgICAgICB0aGlzLl9sYXN0VGlja092ZXJyaWRlID0gITE7CiAgICAgICAgYiAmJiAodGhpcy5faXNJbW1vdmFibGUgPSAhIWJbMF0sIHRoaXMuX2NvbGxpc2lvbk1hc2sgPSBiWzFdLCB0aGlzLl9wcmV2ZW50Um90YXRpb24gPSAhIWJbMl0sIHRoaXMuX2RlbnNpdHkgPSBiWzNdLCB0aGlzLl9mcmljdGlvbiA9IGJbNF0sIHRoaXMuX3Jlc3RpdHV0aW9uID0gYls1XSwgdGhpcy5fbGluZWFyRGFtcGluZyA9IGJbNl0sIHRoaXMuX2FuZ3VsYXJEYW1waW5nID0gYls3XSwgdGhpcy5faXNCdWxsZXQgPSAhIWJbOF0sIHRoaXMuX2lzRW5hYmxlZCA9ICEhYls5XSk7CiAgICAgICAgYiA9IHRoaXMuX3J1bnRpbWUuRGlzcGF0Y2hlcigpOwogICAgICAgIHRoaXMuX2Rpc3Bvc2FibGVzID0gbmV3IEMzJGpzY29tcCQzMDYuQ29tcG9zaXRlRGlzcG9zYWJsZShDMyRqc2NvbXAkMzA2LkRpc3Bvc2FibGUuRnJvbShiLAogICAgICAgICAgICAiaW5zdGFuY2VkZXN0cm95IiwgYyA9PiB0aGlzLl9Pbkluc3RhbmNlRGVzdHJveWVkKGMuaW5zdGFuY2UpKSwgQzMkanNjb21wJDMwNi5EaXNwb3NhYmxlLkZyb20oYiwgImJlZm9yZWxvYWQiLCAoKSA9PiB0aGlzLl9PbkJlZm9yZUxvYWQoKSksIEMzJGpzY29tcCQzMDYuRGlzcG9zYWJsZS5Gcm9tKGIsICJhZnRlcmxvYWQiLCAoKSA9PiB0aGlzLl9PbkFmdGVyTG9hZCgpKSk7CiAgICAgICAgaW5zdDJiZWguc2V0KHRoaXMuX2luc3QsIHRoaXMpOwogICAgICAgIHRoaXMuX2lzRW5hYmxlZCAmJiB0aGlzLl9TdGFydFRpY2tpbmcoKQogICAgfQogICAgUG9zdENyZWF0ZSgpIHsKICAgICAgICB0aGlzLl9DcmVhdGVCb2R5KCkKICAgIH0KICAgIFJlbGVhc2UoKSB7CiAgICAgICAgdGhpcy5fRGVzdHJveU15Sm9pbnRzKCk7CiAgICAgICAgQzMkanNjb21wJDMwNi5jbGVhckFycmF5KHRoaXMuX215Q3JlYXRlZEpvaW50cyk7CiAgICAgICAgdGhpcy5fam9pbmluZ01lLmNsZWFyKCk7CiAgICAgICAgdGhpcy5fYm9keSAmJiAodGhpcy5fRGVzdHJveUZpeHR1cmVzKCksIHRoaXMuX3dvcmxkLkRlc3Ryb3lCb2R5KHRoaXMuX2JvZHkpLCB0aGlzLl9ib2R5ID0gbnVsbCk7CiAgICAgICAgc3VwZXIuUmVsZWFzZSgpCiAgICB9CiAgICBfQ3JlYXRlRml4dHVyZShhKSB7CiAgICAgICAgaWYgKHRoaXMuX2JvZHkpIHJldHVybiBhID0KICAgICAgICAgICAgdGhpcy5fYm9keS5DcmVhdGVGaXh0dXJlKGEpLCB0aGlzLl9maXh0dXJlcy5wdXNoKGEpLCBhCiAgICB9CiAgICBfRGVzdHJveUZpeHR1cmVzKCkgewogICAgICAgIGlmICh0aGlzLl9ib2R5KSB7CiAgICAgICAgICAgIGZvciAoY29uc3QgYSBvZiB0aGlzLl9maXh0dXJlcykgdGhpcy5fYm9keS5EZXN0cm95Rml4dHVyZShhKTsKICAgICAgICAgICAgQzMkanNjb21wJDMwNi5jbGVhckFycmF5KHRoaXMuX2ZpeHR1cmVzKQogICAgICAgIH0KICAgIH0KICAgIF9HZXRCb3VuZGluZ1F1YWRFeGNsdWRpbmdNZXNoKCkgewogICAgICAgIGNvbnN0IGEgPSB0aGlzLkdldFdvcmxkSW5mbygpOwogICAgICAgIHJldHVybiBhLkhhc01lc2goKSA/IChhLkNhbGN1bGF0ZUJib3godGVtcFJlY3QkanNjb21wJDEzLCB0ZW1wUXVhZCRqc2NvbXAkOCwgITEpLCB0ZW1wUXVhZCRqc2NvbXAkOCkgOiBhLkdldEJvdW5kaW5nUXVhZCgpCiAgICB9CiAgICBfRGVzdHJveShhKSB7CiAgICAgICAgdGhpcy5fYm94MmQuZGVzdHJveShhKQogICAgfQogICAgX0NyZWF0ZUJvZHkoKSB7CiAgICAgICAgaWYgKHRoaXMuX2lzRW5hYmxlZCkgewogICAgICAgICAgICB2YXIgYSA9IHRoaXMuX2JveDJkLmIyRml4dHVyZURlZiwKICAgICAgICAgICAgICAgIGIgPSB0aGlzLl9ib3gyZC5iMkJvZHlEZWYsCiAgICAgICAgICAgICAgICBkID0gdGhpcy5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgaWYgKCF0aGlzLl9ib2R5KSB7CiAgICAgICAgICAgICAgICBiID0gbmV3IGI7CiAgICAgICAgICAgICAgICBiLnNldF90eXBlKHRoaXMuX2lzSW1tb3ZhYmxlID8gMCA6IDIpOwogICAgICAgICAgICAgICAgdmFyIGMgPSB0aGlzLl9HZXRCb3VuZGluZ1F1YWRFeGNsdWRpbmdNZXNoKCk7CiAgICAgICAgICAgICAgICBiLnNldF9wb3NpdGlvbihHZXRUZW1wVmVjMkIoYy5taWRYKCkgKiB0aGlzLl93b3JsZFNjYWxlLCBjLm1pZFkoKSAqIHRoaXMuX3dvcmxkU2NhbGUpKTsKICAgICAgICAgICAgICAgIGIuc2V0X2FuZ2xlKGQuR2V0QW5nbGUoKSk7CiAgICAgICAgICAgICAgICBiLnNldF9maXhlZFJvdGF0aW9uKHRoaXMuX3ByZXZlbnRSb3RhdGlvbik7CiAgICAgICAgICAgICAgICBiLnNldF9saW5lYXJEYW1waW5nKHRoaXMuX2xpbmVhckRhbXBpbmcpOwogICAgICAgICAgICAgICAgYi5zZXRfYW5ndWxhckRhbXBpbmcodGhpcy5fYW5ndWxhckRhbXBpbmcpOwogICAgICAgICAgICAgICAgYi5zZXRfYnVsbGV0KHRoaXMuX2lzQnVsbGV0KTsKICAgICAgICAgICAgICAgIHRoaXMuX2JvZHkgPSB0aGlzLl93b3JsZC5DcmVhdGVCb2R5KGIpOwogICAgICAgICAgICAgICAgdGhpcy5fRGVzdHJveShiKTsKICAgICAgICAgICAgICAgIGJvZHkyYmVoLnNldCh0aGlzLl9ib2R5LCB0aGlzKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuX0Rlc3Ryb3lGaXh0dXJlcygpOwogICAgICAgICAgICBhID0gbmV3IGE7CiAgICAgICAgICAgIGEuc2V0X2RlbnNpdHkodGhpcy5fZGVuc2l0eSk7CiAgICAgICAgICAgIGEuc2V0X2ZyaWN0aW9uKHRoaXMuX2ZyaWN0aW9uKTsKICAgICAgICAgICAgYS5zZXRfcmVzdGl0dXRpb24odGhpcy5fcmVzdGl0dXRpb24pOwogICAgICAgICAgICBjID0gZC5IYXNPd25Db2xsaXNpb25Qb2x5KCk7CiAgICAgICAgICAgIGIgPSB0aGlzLl9jb2xsaXNpb25NYXNrOwogICAgICAgICAgICBjIHx8IHRoaXMuX2luc3QuSGFzVGlsZW1hcCgpIHx8IDAgIT09IGIgfHwgKGIgPSAxKTsKICAgICAgICAgICAgYyA9IE1hdGgubWF4KE1hdGguYWJzKGQuR2V0V2lkdGgoKSksIDEpOwogICAgICAgICAgICB2YXIgZSA9IE1hdGgubWF4KE1hdGguYWJzKGQuR2V0SGVpZ2h0KCkpLCAxKTsKICAgICAgICAgICAgMCA9PT0gYiA/IHRoaXMuX2luc3QuSGFzVGlsZW1hcCgpID8gdGhpcy5fQ3JlYXRlVGlsZW1hcEZpeHR1cmVzKGEpIDogdGhpcy5fQ3JlYXRlUG9seWdvbkZpeHR1cmUoYSwgYywgZSkgOiAxID09PSBiID8gdGhpcy5fQ3JlYXRlQm91bmRpbmdCb3hGaXh0dXJlKGEsIGMsIGUpIDogdGhpcy5fQ3JlYXRlQ2lyY2xlRml4dHVyZShhLCBjLCBlKTsKICAgICAgICAgICAgdGhpcy5fbGFzdFdpZHRoID0gZC5HZXRXaWR0aCgpOwogICAgICAgICAgICB0aGlzLl9sYXN0SGVpZ2h0ID0gZC5HZXRIZWlnaHQoKTsKICAgICAgICAgICAgZC5TZXRQaHlzaWNzQm9keUNoYW5nZWQoITEpOwogICAgICAgICAgICB0aGlzLl9EZXN0cm95KGEpCiAgICAgICAgfQogICAgfQogICAgX0NyZWF0ZUJvdW5kaW5nQm94Rml4dHVyZShhLAogICAgICAgIGIsIGQpIHsKICAgICAgICBjb25zdCBjID0gbmV3IHRoaXMuX2JveDJkLmIyUG9seWdvblNoYXBlOwogICAgICAgIGMuU2V0QXNCb3goYiAqIHRoaXMuX3dvcmxkU2NhbGUgKiAuNSwgZCAqIHRoaXMuX3dvcmxkU2NhbGUgKiAuNSk7CiAgICAgICAgYS5zZXRfc2hhcGUoYyk7CiAgICAgICAgdGhpcy5fQ3JlYXRlRml4dHVyZShhKTsKICAgICAgICB0aGlzLl9EZXN0cm95KGMpCiAgICB9CiAgICBfQ3JlYXRlQ2lyY2xlRml4dHVyZShhLCBiLCBkKSB7CiAgICAgICAgY29uc3QgYyA9IG5ldyB0aGlzLl9ib3gyZC5iMkNpcmNsZVNoYXBlOwogICAgICAgIGMuc2V0X21fcmFkaXVzKE1hdGgubWluKGIsIGQpICogdGhpcy5fd29ybGRTY2FsZSAqIC41KTsKICAgICAgICBhLnNldF9zaGFwZShjKTsKICAgICAgICB0aGlzLl9DcmVhdGVGaXh0dXJlKGEpOwogICAgICAgIHRoaXMuX0Rlc3Ryb3koYykKICAgIH0KICAgIF9DcmVhdGVQb2x5Z29uRml4dHVyZShhLCBiLCBkKSB7CiAgICAgICAgdmFyIGMgPSB0aGlzLkdldFdvcmxkSW5mbygpLAogICAgICAgICAgICBlID0gMCA+IGMuR2V0V2lkdGgoKTsKICAgICAgICBjb25zdCBnID0gMCA+IGMuR2V0SGVpZ2h0KCksCiAgICAgICAgICAgIGsgPSB0aGlzLl93b3JsZFNjYWxlOwogICAgICAgIHZhciBtID0gYy5HZXRBbmdsZSgpOwogICAgICAgIDAgIT09IG0gJiYgKGMuU2V0QW5nbGUoMCksIGMuU2V0QmJveENoYW5nZWQoKSk7CiAgICAgICAgdmFyIG4gPSB0aGlzLl9HZXRCb3VuZGluZ1F1YWRFeGNsdWRpbmdNZXNoKCk7CiAgICAgICAgY29uc3QgcSA9IG4ubWlkWCgpIC0gYy5HZXRYKCk7CiAgICAgICAgbiA9IG4ubWlkWSgpIC0gYy5HZXRZKCk7CiAgICAgICAgMCAhPT0gbSAmJiAoYy5TZXRBbmdsZShtKSwgYy5TZXRCYm94Q2hhbmdlZCgpKTsKICAgICAgICBtID0gYy5HZXRDdXN0b21UcmFuc2Zvcm1lZENvbGxpc2lvblBvbHkoZSA/IC1iIDogYiwgZyA/IC1kIDogZCwgMCkucG9pbnRzQXJyKCk7CiAgICAgICAgY29uc3QgdSA9IG0ubGVuZ3RoIC8gMjsKICAgICAgICBjID0gW107CiAgICAgICAgZm9yIChsZXQgdyA9IDA7IHcgPCB1OyArK3cpIGMucHVzaChDMyRqc2NvbXAkMzA2LkJlaGF2aW9ycy5QaHlzaWNzLkdldFZlYzIobVsyICogd10gLSBxLCBtWzIgKiB3ICsgMV0gLSBuKSk7CiAgICAgICAgZSAhPT0gZyAmJiBjLnJldmVyc2UoKTsKICAgICAgICBlID0gQzMkanNjb21wJDMwNi5CZWhhdmlvcnMuUGh5c2ljcy5TZXBhcmF0b3IuU2VwYXJhdGUoYywgYiAqIGQpOwogICAgICAgIGZvciAoY29uc3QgdyBvZiBjKSBDMyRqc2NvbXAkMzA2LkJlaGF2aW9ycy5QaHlzaWNzLkZyZWVWZWMyKHcpOwogICAgICAgIGlmIChlLmxlbmd0aCkKICAgICAgICAgICAgZm9yIChjb25zdCB3IG9mIGUpIHsKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgeiBvZiB3KSB6LnNldF94KHouZ2V0X3goKSAqCiAgICAgICAgICAgICAgICAgICAgayksIHouc2V0X3koei5nZXRfeSgpICogayk7CiAgICAgICAgICAgICAgICBiID0gQzMkanNjb21wJDMwNi5CZWhhdmlvcnMuUGh5c2ljcy5DcmVhdGVQb2x5Z29uU2hhcGUodyk7CiAgICAgICAgICAgICAgICBhLnNldF9zaGFwZShiKTsKICAgICAgICAgICAgICAgIHRoaXMuX0NyZWF0ZUZpeHR1cmUoYSk7CiAgICAgICAgICAgICAgICB0aGlzLl9EZXN0cm95KGIpOwogICAgICAgICAgICAgICAgZm9yIChjb25zdCB6IG9mIHcpIEMzJGpzY29tcCQzMDYuQmVoYXZpb3JzLlBoeXNpY3MuRnJlZVZlYzIoeikKICAgICAgICAgICAgfSBlbHNlIHRoaXMuX0NyZWF0ZUJvdW5kaW5nQm94Rml4dHVyZShhLCBiLCBkKQogICAgfQogICAgX0NyZWF0ZVRpbGVtYXBGaXh0dXJlcyhhKSB7CiAgICAgICAgdmFyIGIgPSB0aGlzLkdldFdvcmxkSW5mbygpLAogICAgICAgICAgICBkID0gdGhpcy5fR2V0Qm91bmRpbmdRdWFkRXhjbHVkaW5nTWVzaCgpOwogICAgICAgIGNvbnN0IGMgPSBkLm1pZFgoKSAtIGIuR2V0WCgpOwogICAgICAgIGIgPSBkLm1pZFkoKSAtIGIuR2V0WSgpOwogICAgICAgIGQgPSB0aGlzLl93b3JsZFNjYWxlOwogICAgICAgIGNvbnN0IGUgPSBDMyRqc2NvbXAkMzA2LkJlaGF2aW9ycy5QaHlzaWNzLkdldFZlYzIsCiAgICAgICAgICAgIGcgPSBDMyRqc2NvbXAkMzA2LkJlaGF2aW9ycy5QaHlzaWNzLkZyZWVWZWMyLAogICAgICAgICAgICBrID0gW107CiAgICAgICAgdGhpcy5faW5zdC5HZXRTZGtJbnN0YW5jZSgpLkdldEFsbENvbGxpc2lvblJlY3RzKGspOwogICAgICAgIGNvbnN0IG0gPSBbXTsKICAgICAgICBmb3IgKGxldCB6ID0gMCwgQyA9IGsubGVuZ3RoOyB6IDwgQzsgKyt6KSB7CiAgICAgICAgICAgIHZhciBuID0ga1t6XSwKICAgICAgICAgICAgICAgIHEgPSBuLkdldFJlY3QoKSwKICAgICAgICAgICAgICAgIHUgPSBuLkdldFBvbHkoKTsKICAgICAgICAgICAgaWYgKHUpIHsKICAgICAgICAgICAgICAgIHZhciB3ID0gdGlsZUNvbnZleFBvbHlDYWNoZS5nZXQodSk7CiAgICAgICAgICAgICAgICBpZiAoIXcpIHsKICAgICAgICAgICAgICAgICAgICB3ID0gdS5wb2ludHNBcnIoKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBEID0gdS5wb2ludENvdW50KCk7CiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgRiA9IDA7IEYgPCBEOyArK0YpIG0ucHVzaChlKHdbMiAqIEZdLCB3WzIgKiBGICsgMV0pKTsKICAgICAgICAgICAgICAgICAgICBuID0gbi5HZXRUaWxlSWQoKSAmIDM3NTgwOTYzODQ7CiAgICAgICAgICAgICAgICAgICAgKC0yMTQ3NDgzNjQ4ID09PSBuIHx8IDEwNzM3NDE4MjQgPT09IG4gfHwgNTM2ODcwOTEyID09PSBuIHx8IG4gJiAtMjE0NzQ4MzY0OCAmJiBuICYgMTA3Mzc0MTgyNCAmJiBuICYgNTM2ODcwOTEyKSAmJiBtLnJldmVyc2UoKTsKICAgICAgICAgICAgICAgICAgICB3ID0gQzMkanNjb21wJDMwNi5CZWhhdmlvcnMuUGh5c2ljcy5TZXBhcmF0b3IuU2VwYXJhdGUobSwgcS53aWR0aCgpICogcS5oZWlnaHQoKSk7CiAgICAgICAgICAgICAgICAgICAgdGlsZUNvbnZleFBvbHlDYWNoZS5zZXQodSwgdyk7CiAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBGIG9mIG0pIGcoRik7CiAgICAgICAgICAgICAgICAgICAgQzMkanNjb21wJDMwNi5jbGVhckFycmF5KG0pCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBmb3IgKGxldCBEID0KICAgICAgICAgICAgICAgICAgICAgICAgMCwgRiA9IHcubGVuZ3RoOyBEIDwgRjsgKytEKSB7CiAgICAgICAgICAgICAgICAgICAgdSA9IHdbRF07CiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgRSA9IDAsIEogPSB1Lmxlbmd0aDsgRSA8IEo7ICsrRSkgbS5wdXNoKGUoKHEuZ2V0TGVmdCgpICsgdVtFXS5nZXRfeCgpIC0gYykgKiBkLCAocS5nZXRUb3AoKSArIHVbRV0uZ2V0X3koKSAtIGIpICogZCkpOwogICAgICAgICAgICAgICAgICAgIHUgPSBDMyRqc2NvbXAkMzA2LkJlaGF2aW9ycy5QaHlzaWNzLkNyZWF0ZVBvbHlnb25TaGFwZShtKTsKICAgICAgICAgICAgICAgICAgICBhLnNldF9zaGFwZSh1KTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9DcmVhdGVGaXh0dXJlKGEpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX0Rlc3Ryb3kodSk7CiAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBFIG9mIG0pIGcoRSk7CiAgICAgICAgICAgICAgICAgICAgQzMkanNjb21wJDMwNi5jbGVhckFycmF5KG0pCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBtLnB1c2goZSgocS5nZXRMZWZ0KCkgLSBjKSAqIGQsIChxLmdldFRvcCgpIC0gYikgKiBkKSksIG0ucHVzaChlKChxLmdldFJpZ2h0KCkgLSBjKSAqIGQsIChxLmdldFRvcCgpIC0gYikgKiBkKSksIG0ucHVzaChlKChxLmdldFJpZ2h0KCkgLSBjKSAqIGQsIChxLmdldEJvdHRvbSgpIC0gYikgKiBkKSksIG0ucHVzaChlKChxLmdldExlZnQoKSAtIGMpICogZCwgKHEuZ2V0Qm90dG9tKCkgLSBiKSAqIGQpKSwgcSA9IEMzJGpzY29tcCQzMDYuQmVoYXZpb3JzLlBoeXNpY3MuQ3JlYXRlUG9seWdvblNoYXBlKG0pLAogICAgICAgICAgICAgICAgYS5zZXRfc2hhcGUocSksIHRoaXMuX0NyZWF0ZUZpeHR1cmUoYSksIHRoaXMuX0Rlc3Ryb3kocSk7CiAgICAgICAgICAgIGZvciAoY29uc3QgRCBvZiBtKSBnKEQpOwogICAgICAgICAgICBDMyRqc2NvbXAkMzA2LmNsZWFyQXJyYXkobSkKICAgICAgICB9CiAgICB9CiAgICBfRGVzdHJveUJvZHkoKSB7CiAgICAgICAgdGhpcy5fYm9keSAmJiAodGhpcy5fRGVzdHJveU15Sm9pbnRzKCksIGJvZHkyYmVoLmRlbGV0ZSh0aGlzLl9ib2R5KSwgdGhpcy5fRGVzdHJveUZpeHR1cmVzKCksIHRoaXMuX3dvcmxkLkRlc3Ryb3lCb2R5KHRoaXMuX2JvZHkpLCB0aGlzLl9ib2R5ID0gbnVsbCkKICAgIH0KICAgIF9EZXN0cm95TXlKb2ludHMoKSB7CiAgICAgICAgZm9yIChjb25zdCBhIG9mIHRoaXMuX215Sm9pbnRzKSB0aGlzLl93b3JsZC5EZXN0cm95Sm9pbnQoYSk7CiAgICAgICAgQzMkanNjb21wJDMwNi5jbGVhckFycmF5KHRoaXMuX215Sm9pbnRzKQogICAgfQogICAgX1JlY3JlYXRlTXlKb2ludHMoKSB7CiAgICAgICAgZm9yIChjb25zdCBhIG9mIHRoaXMuX215Q3JlYXRlZEpvaW50cykgc3dpdGNoIChhLnR5cGUpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgdGhpcy5fRG9DcmVhdGVEaXN0YW5jZUpvaW50KC4uLmEucGFyYW1zKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICB0aGlzLl9Eb0NyZWF0ZVJldm9sdXRlSm9pbnQoLi4uYS5wYXJhbXMpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgIHRoaXMuX0RvQ3JlYXRlTGltaXRlZFJldm9sdXRlSm9pbnQoLi4uYS5wYXJhbXMpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgIHRoaXMuX0RvQ3JlYXRlUHJpc21hdGljSm9pbnQoLi4uYS5wYXJhbXMpCiAgICAgICAgfQogICAgfQogICAgX0dldEluc3RJbWFnZVBvaW50KGEpIHsKICAgICAgICB2YXIgYiA9IHRoaXMuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgcmV0dXJuIC0xID09PSBhID8gW2IuR2V0WCgpLCBiLkdldFkoKV0gOiAwID09PSBhICYmIHRoaXMuX2JvZHkgPyAoYSA9IHRoaXMuX2JvZHkuR2V0UG9zaXRpb24oKSwgYiA9IHRoaXMuX2JvZHkuR2V0TG9jYWxDZW50ZXIoKSwgWyhhLmdldF94KCkgKyBiLmdldF94KCkpIC8gdGhpcy5fd29ybGRTY2FsZSwgKGEuZ2V0X3koKSArIGIuZ2V0X3koKSkgLyB0aGlzLl93b3JsZFNjYWxlXSkgOiB0aGlzLl9pbnN0LkdldEltYWdlUG9pbnQoYSkKICAgIH0KICAgIF9DcmVhdGVEaXN0YW5jZUpvaW50KGEsIGIsIGQsIGMsIGUpIHsKICAgICAgICB0aGlzLl9pc0VuYWJsZWQgJiYgYiAmJiBiICE9PSB0aGlzLl9pbnN0ICYmCiAgICAgICAgICAgIEMzJGpzY29tcCQzMDYuQmVoYXZpb3JzLlBoeXNpY3MuSW5zdGFuY2UuTG9va3VwQmVoSW5zdEZyb21JbnN0KGIpICYmICh0aGlzLl9teUNyZWF0ZWRKb2ludHMucHVzaCh7CiAgICAgICAgICAgICAgICB0eXBlOiAwLAogICAgICAgICAgICAgICAgcGFyYW1zOiBbYSwgYi5HZXRVSUQoKSwgZCwgYywgZV0KICAgICAgICAgICAgfSksIHRoaXMuX0RvQ3JlYXRlRGlzdGFuY2VKb2ludChhLCBiLkdldFVJRCgpLCBkLCBjLCBlKSkKICAgIH0KICAgIF9Eb0NyZWF0ZURpc3RhbmNlSm9pbnQoYSwgYiwgZCwgYywgZSkgewogICAgICAgIGlmICh0aGlzLl9pc0VuYWJsZWQpIHsKICAgICAgICAgICAgdmFyIGcgPSB0aGlzLl9ydW50aW1lLkdldEluc3RhbmNlQnlVSUQoYik7CiAgICAgICAgICAgIGlmIChnICYmIGcgIT09IHRoaXMuX2luc3QgJiYgaW5zdDJiZWguaGFzKGcpKSB7CiAgICAgICAgICAgICAgICBiID0gQzMkanNjb21wJDMwNi5CZWhhdmlvcnMuUGh5c2ljcy5JbnN0YW5jZS5Mb29rdXBCZWhJbnN0RnJvbUluc3QoZyk7CiAgICAgICAgICAgICAgICBiLl9qb2luaW5nTWUuYWRkKHRoaXMuX2luc3QpOwogICAgICAgICAgICAgICAgdGhpcy5fVXBkYXRlQm9keVRvTWF0Y2hJbnN0YW5jZSghMSk7CiAgICAgICAgICAgICAgICBiLl9VcGRhdGVCb2R5VG9NYXRjaEluc3RhbmNlKCExKTsKICAgICAgICAgICAgICAgIHZhciBbaywgbV0gPSB0aGlzLl9HZXRJbnN0SW1hZ2VQb2ludChhKSwgW24sIHFdID0gZy5HZXRJbWFnZVBvaW50KGQpOwogICAgICAgICAgICAgICAgYSA9IGsgLSBuOwogICAgICAgICAgICAgICAgZCA9IG0gLSBxOwogICAgICAgICAgICAgICAgZyA9IHRoaXMuX3dvcmxkU2NhbGU7CiAgICAgICAgICAgICAgICB2YXIgdSA9IG5ldyB0aGlzLl9ib3gyZC5iMkRpc3RhbmNlSm9pbnREZWY7CiAgICAgICAgICAgICAgICB1LkluaXRpYWxpemUodGhpcy5fYm9keSwgYi5HZXRCb2R5KCksIEdldFRlbXBWZWMyQShrICogZywgbSAqIGcpLCBHZXRUZW1wVmVjMkIobiAqIGcsIHEgKiBnKSk7CiAgICAgICAgICAgICAgICB1LnNldF9sZW5ndGgoTWF0aC5oeXBvdChhLCBkKSAqIGcpOwogICAgICAgICAgICAgICAgdS5zZXRfZGFtcGluZ1JhdGlvKGMpOwogICAgICAgICAgICAgICAgdS5zZXRfZnJlcXVlbmN5SHooZSk7CiAgICAgICAgICAgICAgICB0aGlzLl9teUpvaW50cy5wdXNoKHRoaXMuX3dvcmxkLkNyZWF0ZUpvaW50KHUpKTsKICAgICAgICAgICAgICAgIHRoaXMuX0Rlc3Ryb3kodSkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIF9DcmVhdGVSZXZvbHV0ZUpvaW50KGEsIGIpIHsKICAgICAgICB0aGlzLl9pc0VuYWJsZWQgJiYgYiAmJiBiICE9PSB0aGlzLl9pbnN0ICYmIEMzJGpzY29tcCQzMDYuQmVoYXZpb3JzLlBoeXNpY3MuSW5zdGFuY2UuTG9va3VwQmVoSW5zdEZyb21JbnN0KGIpICYmICh0aGlzLl9teUNyZWF0ZWRKb2ludHMucHVzaCh7CiAgICAgICAgICAgICAgICB0eXBlOiAxLAogICAgICAgICAgICAgICAgcGFyYW1zOiBbYSwgYi5HZXRVSUQoKV0KICAgICAgICAgICAgfSksCiAgICAgICAgICAgIHRoaXMuX0RvQ3JlYXRlUmV2b2x1dGVKb2ludChhLCBiLkdldFVJRCgpKSkKICAgIH0KICAgIF9Eb0NyZWF0ZVJldm9sdXRlSm9pbnQoYSwgYikgewogICAgICAgIGlmICh0aGlzLl9pc0VuYWJsZWQgJiYgKGIgPSB0aGlzLl9ydW50aW1lLkdldEluc3RhbmNlQnlVSUQoYikpICYmIGIgIT09IHRoaXMuX2luc3QgJiYgaW5zdDJiZWguaGFzKGIpKSB7CiAgICAgICAgICAgIGIgPSBDMyRqc2NvbXAkMzA2LkJlaGF2aW9ycy5QaHlzaWNzLkluc3RhbmNlLkxvb2t1cEJlaEluc3RGcm9tSW5zdChiKTsKICAgICAgICAgICAgYi5fam9pbmluZ01lLmFkZCh0aGlzLl9pbnN0KTsKICAgICAgICAgICAgdGhpcy5fVXBkYXRlQm9keVRvTWF0Y2hJbnN0YW5jZSghMSk7CiAgICAgICAgICAgIGIuX1VwZGF0ZUJvZHlUb01hdGNoSW5zdGFuY2UoITEpOwogICAgICAgICAgICB2YXIgW2QsIGNdID0gdGhpcy5fR2V0SW5zdEltYWdlUG9pbnQoYSk7CiAgICAgICAgICAgIGEgPSB0aGlzLl93b3JsZFNjYWxlOwogICAgICAgICAgICB2YXIgZSA9IG5ldyB0aGlzLl9ib3gyZC5iMlJldm9sdXRlSm9pbnREZWY7CiAgICAgICAgICAgIGUuSW5pdGlhbGl6ZSh0aGlzLl9ib2R5LCBiLkdldEJvZHkoKSwgR2V0VGVtcFZlYzJBKGQgKiBhLCBjICogYSkpOwogICAgICAgICAgICB0aGlzLl9teUpvaW50cy5wdXNoKHRoaXMuX3dvcmxkLkNyZWF0ZUpvaW50KGUpKTsKICAgICAgICAgICAgdGhpcy5fRGVzdHJveShlKQogICAgICAgIH0KICAgIH0KICAgIF9DcmVhdGVMaW1pdGVkUmV2b2x1dGVKb2ludChhLCBiLCBkLCBjKSB7CiAgICAgICAgdGhpcy5faXNFbmFibGVkICYmIGIgJiYgYiAhPT0gdGhpcy5faW5zdCAmJiBDMyRqc2NvbXAkMzA2LkJlaGF2aW9ycy5QaHlzaWNzLkluc3RhbmNlLkxvb2t1cEJlaEluc3RGcm9tSW5zdChiKSAmJiAoZCA9IEMzJGpzY29tcCQzMDYudG9EZWdyZWVzKGQpLCBjID0gQzMkanNjb21wJDMwNi50b0RlZ3JlZXMoYyksIHRoaXMuX215Q3JlYXRlZEpvaW50cy5wdXNoKHsKICAgICAgICAgICAgdHlwZTogMiwKICAgICAgICAgICAgcGFyYW1zOiBbYSwgYi5HZXRVSUQoKSwgZCwgY10KICAgICAgICB9KSwgdGhpcy5fRG9DcmVhdGVMaW1pdGVkUmV2b2x1dGVKb2ludChhLCBiLkdldFVJRCgpLCBkLCBjKSkKICAgIH0KICAgIF9Eb0NyZWF0ZUxpbWl0ZWRSZXZvbHV0ZUpvaW50KGEsIGIsIGQsIGMpIHsKICAgICAgICBpZiAodGhpcy5faXNFbmFibGVkICYmIChiID0gdGhpcy5fcnVudGltZS5HZXRJbnN0YW5jZUJ5VUlEKGIpKSAmJiBiICE9PSB0aGlzLl9pbnN0ICYmIGluc3QyYmVoLmhhcyhiKSkgewogICAgICAgICAgICBiID0gQzMkanNjb21wJDMwNi5CZWhhdmlvcnMuUGh5c2ljcy5JbnN0YW5jZS5Mb29rdXBCZWhJbnN0RnJvbUluc3QoYik7CiAgICAgICAgICAgIGIuX2pvaW5pbmdNZS5hZGQodGhpcy5faW5zdCk7CiAgICAgICAgICAgIHRoaXMuX1VwZGF0ZUJvZHlUb01hdGNoSW5zdGFuY2UoITEpOwogICAgICAgICAgICBiLl9VcGRhdGVCb2R5VG9NYXRjaEluc3RhbmNlKCExKTsKICAgICAgICAgICAgdmFyIFtlLCBnXSA9IHRoaXMuX0dldEluc3RJbWFnZVBvaW50KGEpOwogICAgICAgICAgICBhID0gdGhpcy5fd29ybGRTY2FsZTsKICAgICAgICAgICAgdmFyIGsgPSBuZXcgdGhpcy5fYm94MmQuYjJSZXZvbHV0ZUpvaW50RGVmOwogICAgICAgICAgICBrLkluaXRpYWxpemUodGhpcy5fYm9keSwgYi5HZXRCb2R5KCksIEdldFRlbXBWZWMyQShlICogYSwgZyAqIGEpKTsKICAgICAgICAgICAgay5zZXRfZW5hYmxlTGltaXQoITApOwogICAgICAgICAgICBrLnNldF9sb3dlckFuZ2xlKEMzJGpzY29tcCQzMDYudG9SYWRpYW5zKGQpKTsKICAgICAgICAgICAgay5zZXRfdXBwZXJBbmdsZShDMyRqc2NvbXAkMzA2LnRvUmFkaWFucyhjKSk7CiAgICAgICAgICAgIHRoaXMuX215Sm9pbnRzLnB1c2godGhpcy5fd29ybGQuQ3JlYXRlSm9pbnQoaykpOwogICAgICAgICAgICB0aGlzLl9EZXN0cm95KGspCiAgICAgICAgfQogICAgfQogICAgX0NyZWF0ZVByaXNtYXRpY0pvaW50KGEsIGIsIGQsIGMsIGUsIGcsIGssIG0sIG4pIHsKICAgICAgICB0aGlzLl9pc0VuYWJsZWQgJiYgYiAmJiBiICE9PSB0aGlzLl9pbnN0ICYmCiAgICAgICAgICAgIEMzJGpzY29tcCQzMDYuQmVoYXZpb3JzLlBoeXNpY3MuSW5zdGFuY2UuTG9va3VwQmVoSW5zdEZyb21JbnN0KGIpICYmIChkID0gQzMkanNjb21wJDMwNi50b0RlZ3JlZXMoZCksIG0gPSBDMyRqc2NvbXAkMzA2LnRvRGVncmVlcyhtKSwgdGhpcy5fbXlDcmVhdGVkSm9pbnRzLnB1c2goewogICAgICAgICAgICAgICAgdHlwZTogMywKICAgICAgICAgICAgICAgIHBhcmFtczogW2EsIGIuR2V0VUlEKCksIGQsIGMsIGUsIGcsIGssIG0sIG5dCiAgICAgICAgICAgIH0pLCB0aGlzLl9Eb0NyZWF0ZVByaXNtYXRpY0pvaW50KGEsIGIuR2V0VUlEKCksIGQsIGMsIGUsIGcsIGssIG0sIG4pKQogICAgfQogICAgX0RvQ3JlYXRlUHJpc21hdGljSm9pbnQoYSwgYiwgZCwgYywgZSwgZywgaywgbSwgbikgewogICAgICAgIGlmICh0aGlzLl9pc0VuYWJsZWQgJiYgKGIgPSB0aGlzLl9ydW50aW1lLkdldEluc3RhbmNlQnlVSUQoYikpICYmIGIgIT09IHRoaXMuX2luc3QgJiYgaW5zdDJiZWguaGFzKGIpKSB7CiAgICAgICAgICAgIGIgPSBDMyRqc2NvbXAkMzA2LkJlaGF2aW9ycy5QaHlzaWNzLkluc3RhbmNlLkxvb2t1cEJlaEluc3RGcm9tSW5zdChiKTsKICAgICAgICAgICAgYi5fam9pbmluZ01lLmFkZCh0aGlzLl9pbnN0KTsKICAgICAgICAgICAgdGhpcy5fVXBkYXRlQm9keVRvTWF0Y2hJbnN0YW5jZSghMSk7CiAgICAgICAgICAgIGIuX1VwZGF0ZUJvZHlUb01hdGNoSW5zdGFuY2UoITEpOwogICAgICAgICAgICB2YXIgW3EsIHVdID0gdGhpcy5fR2V0SW5zdEltYWdlUG9pbnQoYSk7CiAgICAgICAgICAgIGQgPSBDMyRqc2NvbXAkMzA2LnRvUmFkaWFucyhkKTsKICAgICAgICAgICAgYSA9IE1hdGguY29zKGQpOwogICAgICAgICAgICBkID0gTWF0aC5zaW4oZCk7CiAgICAgICAgICAgIHZhciB3ID0gdGhpcy5fd29ybGRTY2FsZSwKICAgICAgICAgICAgICAgIHogPSBuZXcgdGhpcy5fYm94MmQuYjJQcmlzbWF0aWNKb2ludERlZjsKICAgICAgICAgICAgei5Jbml0aWFsaXplKHRoaXMuX2JvZHksIGIuR2V0Qm9keSgpLCBHZXRUZW1wVmVjMkEocSAqIHcsIHUgKiB3KSwgR2V0VGVtcFZlYzJCKGEsIGQpKTsKICAgICAgICAgICAgei5zZXRfZW5hYmxlTGltaXQoISFjKTsKICAgICAgICAgICAgei5zZXRfbG93ZXJUcmFuc2xhdGlvbihlICogdyk7CiAgICAgICAgICAgIHouc2V0X3VwcGVyVHJhbnNsYXRpb24oZyAqIHcpOwogICAgICAgICAgICB6LnNldF9lbmFibGVNb3RvcighIWspOwogICAgICAgICAgICB6LnNldF9tb3RvclNwZWVkKEMzJGpzY29tcCQzMDYudG9SYWRpYW5zKG0pKTsKICAgICAgICAgICAgei5zZXRfbWF4TW90b3JGb3JjZShuKTsKICAgICAgICAgICAgdGhpcy5fbXlKb2ludHMucHVzaCh0aGlzLl93b3JsZC5DcmVhdGVKb2ludCh6KSk7CiAgICAgICAgICAgIHRoaXMuX0Rlc3Ryb3koeikKICAgICAgICB9CiAgICB9CiAgICBfUmVtb3ZlSm9pbnRzKCkgewogICAgICAgIHRoaXMuX2lzRW5hYmxlZCAmJgogICAgICAgICAgICAodGhpcy5fRGVzdHJveU15Sm9pbnRzKCksIEMzJGpzY29tcCQzMDYuY2xlYXJBcnJheSh0aGlzLl9teUNyZWF0ZWRKb2ludHMpLCB0aGlzLl9qb2luaW5nTWUuY2xlYXIoKSkKICAgIH0KICAgIF9Pbkluc3RhbmNlRGVzdHJveWVkKGEpIHsKICAgICAgICBjb25zdCBiID0gYS5HZXRVSUQoKTsKICAgICAgICBsZXQgZCA9IDA7CiAgICAgICAgZm9yIChsZXQgYyA9IDAsIGUgPSB0aGlzLl9teUNyZWF0ZWRKb2ludHMubGVuZ3RoOyBjIDwgZTsgKytjKSB0aGlzLl9teUNyZWF0ZWRKb2ludHNbZF0gPSB0aGlzLl9teUNyZWF0ZWRKb2ludHNbY10sIGQgPCB0aGlzLl9teUpvaW50cy5sZW5ndGggJiYgKHRoaXMuX215Sm9pbnRzW2RdID0gdGhpcy5fbXlKb2ludHNbY10pLCB0aGlzLl9teUNyZWF0ZWRKb2ludHNbY10ucGFyYW1zWzFdID09PSBiID8gYyA8IHRoaXMuX215Sm9pbnRzLmxlbmd0aCAmJiB0aGlzLl93b3JsZC5EZXN0cm95Sm9pbnQodGhpcy5fbXlKb2ludHNbY10pIDogKytkOwogICAgICAgIEMzJGpzY29tcCQzMDYudHJ1bmNhdGVBcnJheSh0aGlzLl9teUNyZWF0ZWRKb2ludHMsIGQpOwogICAgICAgIGQgPCB0aGlzLl9teUpvaW50cy5sZW5ndGggJiYKICAgICAgICAgICAgQzMkanNjb21wJDMwNi50cnVuY2F0ZUFycmF5KHRoaXMuX215Sm9pbnRzLCBkKTsKICAgICAgICB0aGlzLl9qb2luaW5nTWUuZGVsZXRlKGEpCiAgICB9CiAgICBHZXRCb2R5KCkgewogICAgICAgIHJldHVybiB0aGlzLl9ib2R5CiAgICB9CiAgICBzdGF0aWMgTG9va3VwQmVoSW5zdEZyb21Cb2R5KGEpIHsKICAgICAgICByZXR1cm4gYm9keTJiZWguZ2V0KGEpIHx8IG51bGwKICAgIH0KICAgIHN0YXRpYyBMb29rdXBCZWhJbnN0RnJvbUluc3QoYSkgewogICAgICAgIHJldHVybiBpbnN0MmJlaC5nZXQoYSkgfHwgbnVsbAogICAgfQogICAgU2F2ZVRvSnNvbigpIHsKICAgICAgICBjb25zdCBhID0gewogICAgICAgICAgICBlOiB0aGlzLl9pc0VuYWJsZWQsCiAgICAgICAgICAgIHByOiB0aGlzLl9wcmV2ZW50Um90YXRpb24sCiAgICAgICAgICAgIGQ6IHRoaXMuX2RlbnNpdHksCiAgICAgICAgICAgIGZyOiB0aGlzLl9mcmljdGlvbiwKICAgICAgICAgICAgcmU6IHRoaXMuX3Jlc3RpdHV0aW9uLAogICAgICAgICAgICBsZDogdGhpcy5fbGluZWFyRGFtcGluZywKICAgICAgICAgICAgYWQ6IHRoaXMuX2FuZ3VsYXJEYW1waW5nLAogICAgICAgICAgICBiOiB0aGlzLl9pc0J1bGxldCwKICAgICAgICAgICAgbWNqOiB0aGlzLl9teUNyZWF0ZWRKb2ludHMKICAgICAgICB9OwogICAgICAgIGlmICh0aGlzLl9pc0VuYWJsZWQpIHsKICAgICAgICAgICAgY29uc3QgYiA9IHRoaXMuX2JvZHkuR2V0TGluZWFyVmVsb2NpdHkoKTsKICAgICAgICAgICAgYS52eCA9IGIuZ2V0X3goKTsKICAgICAgICAgICAgYS52eSA9IGIuZ2V0X3koKTsKICAgICAgICAgICAgYS5vbSA9IHRoaXMuX2JvZHkuR2V0QW5ndWxhclZlbG9jaXR5KCkKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGEKICAgIH0KICAgIF9PbkJlZm9yZUxvYWQoKSB7CiAgICAgICAgdGhpcy5fRGVzdHJveU15Sm9pbnRzKCk7CiAgICAgICAgQzMkanNjb21wJDMwNi5jbGVhckFycmF5KHRoaXMuX215Q3JlYXRlZEpvaW50cyk7CiAgICAgICAgdGhpcy5fam9pbmluZ01lLmNsZWFyKCkKICAgIH0KICAgIExvYWRGcm9tSnNvbihhKSB7CiAgICAgICAgdGhpcy5fRGVzdHJveUJvZHkoKTsKICAgICAgICB0aGlzLl9pc0VuYWJsZWQgPSBhLmU7CiAgICAgICAgdGhpcy5fcHJldmVudFJvdGF0aW9uID0gYS5wcjsKICAgICAgICB0aGlzLl9kZW5zaXR5ID0gYS5kOwogICAgICAgIHRoaXMuX2ZyaWN0aW9uID0gYS5mcjsKICAgICAgICB0aGlzLl9yZXN0aXR1dGlvbiA9IGEucmU7CiAgICAgICAgdGhpcy5fbGluZWFyRGFtcGluZyA9IGEubGQ7CiAgICAgICAgdGhpcy5fYW5ndWxhckRhbXBpbmcgPSBhLmFkOwogICAgICAgIHRoaXMuX2lzQnVsbGV0ID0gYS5iOwogICAgICAgIHRoaXMuX215Q3JlYXRlZEpvaW50cyA9IGEubWNqOwogICAgICAgIGNvbnN0IGIgPSB0aGlzLkdldFdvcmxkSW5mbygpOwogICAgICAgIHRoaXMuX2xhc3RLbm93blggPSBiLkdldFgoKTsKICAgICAgICB0aGlzLl9sYXN0S25vd25ZID0gYi5HZXRZKCk7CiAgICAgICAgdGhpcy5fbGFzdEtub3duQW5nbGUgPQogICAgICAgICAgICBiLkdldEFuZ2xlKCk7CiAgICAgICAgdGhpcy5fbGFzdFdpZHRoID0gYi5HZXRXaWR0aCgpOwogICAgICAgIHRoaXMuX2xhc3RIZWlnaHQgPSBiLkdldEhlaWdodCgpOwogICAgICAgIHRoaXMuX2lzRW5hYmxlZCAmJiAodGhpcy5fQ3JlYXRlQm9keSgpLCB0aGlzLl9ib2R5LlNldExpbmVhclZlbG9jaXR5KEdldFRlbXBWZWMyQShhLnZ4LCBhLnZ5KSksIHRoaXMuX2JvZHkuU2V0QW5ndWxhclZlbG9jaXR5KGEub20pLCAwID09PSBhLnZ4ICYmIDAgPT09IGEudnkgJiYgMCA9PT0gYS5vbSB8fCB0aGlzLl9ib2R5LlNldEF3YWtlKCEwKSwgdGhpcy5fbXlDcmVhdGVkSm9pbnRzID0gYS5tY2opOwogICAgICAgIHRoaXMuX2lzRW5hYmxlZCA/IHRoaXMuX1N0YXJ0VGlja2luZygpIDogdGhpcy5fU3RvcFRpY2tpbmcoKQogICAgfQogICAgX09uQWZ0ZXJMb2FkKCkgewogICAgICAgIHRoaXMuX2lzRW5hYmxlZCAmJiB0aGlzLl9SZWNyZWF0ZU15Sm9pbnRzKCkKICAgIH0KICAgIFRpY2soKSB7CiAgICAgICAgaWYgKHRoaXMuX2lzRW5hYmxlZCkgewogICAgICAgICAgICB2YXIgYSA9IHRoaXMuX3J1bnRpbWUsCiAgICAgICAgICAgICAgICBiID0gdGhpcy5HZXRCZWhhdmlvcigpOwogICAgICAgICAgICBpZiAoMCA9PT0gYi5HZXRTdGVwcGluZ01vZGUoKSkgdmFyIGQgPSBhLkdldFRpbWVTY2FsZSgpIC8KICAgICAgICAgICAgICAgIDYwOwogICAgICAgICAgICBlbHNlIGQgPSBhLkdldER0KHRoaXMuX2luc3QpLCBkID4gMSAvIDMwICYmIChkID0gMSAvIDMwKTsKICAgICAgICAgICAgdmFyIGMgPSBhLkdldFRpY2tDb3VudE5vU2F2ZSgpOwogICAgICAgICAgICBpZiAoYyA+IGIuR2V0TGFzdFVwZGF0ZVRpY2soKSAmJiAwIDwgYS5HZXRUaW1lU2NhbGUoKSkgewogICAgICAgICAgICAgICAgYSA9IHRoaXMuX3J1bnRpbWUuSXNEZWJ1ZygpOwogICAgICAgICAgICAgICAgbGV0IGUgPSAwOwogICAgICAgICAgICAgICAgYSAmJiAoZSA9IHBlcmZvcm1hbmNlLm5vdygpKTsKICAgICAgICAgICAgICAgIDAgIT09IGQgJiYgdGhpcy5fd29ybGQuU3RlcChkLCBiLkdldFZlbG9jaXR5SXRlcmF0aW9ucygpLCBiLkdldFBvc2l0aW9uSXRlcmF0aW9ucygpKTsKICAgICAgICAgICAgICAgIHRoaXMuX3dvcmxkLkNsZWFyRm9yY2VzKCk7CiAgICAgICAgICAgICAgICBhICYmIHNlbGYuQzNEZWJ1Z2dlci5BZGRQaHlzaWNzVGltZShwZXJmb3JtYW5jZS5ub3coKSAtIGUpOwogICAgICAgICAgICAgICAgYi5TZXRMYXN0VXBkYXRlVGljayhjKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuX1VwZGF0ZUJvZHlUb01hdGNoSW5zdGFuY2UoITApCiAgICAgICAgfQogICAgfQogICAgX1VwZGF0ZUJvZHlUb01hdGNoSW5zdGFuY2UoYSkgewogICAgICAgIGNvbnN0IGIgPSB0aGlzLl9pbnN0LkdldFdvcmxkSW5mbygpOwogICAgICAgIHZhciBkID0gdGhpcy5fd29ybGRTY2FsZTsKICAgICAgICAoYi5HZXRXaWR0aCgpICE9PQogICAgICAgICAgICB0aGlzLl9sYXN0V2lkdGggfHwgYi5HZXRIZWlnaHQoKSAhPT0gdGhpcy5fbGFzdEhlaWdodCB8fCBiLklzUGh5c2ljc0JvZHlDaGFuZ2VkKCkpICYmIHRoaXMuX0NyZWF0ZUJvZHkoKTsKICAgICAgICB2YXIgYyA9IHRoaXMuX2JvZHksCiAgICAgICAgICAgIGUgPSBiLkdldFgoKSAhPT0gdGhpcy5fbGFzdEtub3duWCB8fCBiLkdldFkoKSAhPT0gdGhpcy5fbGFzdEtub3duWSwKICAgICAgICAgICAgZyA9IGIuR2V0QW5nbGUoKSAhPT0gdGhpcy5fbGFzdEtub3duQW5nbGU7CiAgICAgICAgaWYgKGUpIHsKICAgICAgICAgICAgdmFyIGsgPSB0aGlzLl9HZXRCb3VuZGluZ1F1YWRFeGNsdWRpbmdNZXNoKCk7CiAgICAgICAgICAgIGNvbnN0IG0gPSBrLm1pZFgoKTsKICAgICAgICAgICAgayA9IGsubWlkWSgpOwogICAgICAgICAgICBjb25zdCBuID0gbSAtIHRoaXMuX2xhc3RLbm93blgsCiAgICAgICAgICAgICAgICBxID0gayAtIHRoaXMuX2xhc3RLbm93blk7CiAgICAgICAgICAgIGcgPyBjLlNldFRyYW5zZm9ybShHZXRUZW1wVmVjMkEobSAqIGQsIGsgKiBkKSwgYi5HZXRBbmdsZSgpKSA6IGMuU2V0VHJhbnNmb3JtKEdldFRlbXBWZWMyQShtICogZCwgayAqIGQpLCBjLkdldEFuZ2xlKCkpOwogICAgICAgICAgICBhICYmIChjLlNldExpbmVhclZlbG9jaXR5KEdldFRlbXBWZWMyQShuLCBxKSksIHRoaXMuX2xhc3RUaWNrT3ZlcnJpZGUgPSAhMCk7CiAgICAgICAgICAgIGMuU2V0QXdha2UoITApCiAgICAgICAgfSBlbHNlIGEgJiYgdGhpcy5fbGFzdFRpY2tPdmVycmlkZSAmJiAoYSA9IHRoaXMuX0dldEJvdW5kaW5nUXVhZEV4Y2x1ZGluZ01lc2goKSwgdGhpcy5fbGFzdFRpY2tPdmVycmlkZSA9ICExLCBjLlNldExpbmVhclZlbG9jaXR5KEdldFRlbXBWZWMyQSgwLCAwKSksIGMuU2V0VHJhbnNmb3JtKEdldFRlbXBWZWMyQShhLm1pZFgoKSAqIGQsIGEubWlkWSgpICogZCksIGMuR2V0QW5nbGUoKSkpOwogICAgICAgICFlICYmIGcgJiYgKGMuU2V0VHJhbnNmb3JtKGMuR2V0UG9zaXRpb24oKSwgYi5HZXRBbmdsZSgpKSwgYy5TZXRBd2FrZSghMCkpOwogICAgICAgIGcgPSBjLkdldFBvc2l0aW9uKCk7CiAgICAgICAgZSA9IGcuZ2V0X3goKSAvIGQ7CiAgICAgICAgZCA9IGcuZ2V0X3koKSAvIGQ7CiAgICAgICAgYyA9IGMuR2V0QW5nbGUoKTsKICAgICAgICBpZiAoZSAhPT0gYi5HZXRYKCkgfHwgZCAhPT0gYi5HZXRZKCkgfHwgYyAhPT0gYi5HZXRBbmdsZSgpKQogICAgICAgICAgICBpZiAoYi5TZXRYWShlLCBkKSwgYi5TZXRBbmdsZShjKSwgYi5TZXRCYm94Q2hhbmdlZCgpLCBkID0gdGhpcy5fR2V0Qm91bmRpbmdRdWFkRXhjbHVkaW5nTWVzaCgpLCBjID0gZC5taWRYKCkgLSBiLkdldFgoKSwKICAgICAgICAgICAgICAgIGQgPSBkLm1pZFkoKSAtIGIuR2V0WSgpLCAwICE9PSBjIHx8IDAgIT09IGQpIGIuT2Zmc2V0WFkoLWMsIC1kKSwgYi5TZXRCYm94Q2hhbmdlZCgpOwogICAgICAgIHRoaXMuX2xhc3RLbm93blggPSBiLkdldFgoKTsKICAgICAgICB0aGlzLl9sYXN0S25vd25ZID0gYi5HZXRZKCk7CiAgICAgICAgdGhpcy5fbGFzdEtub3duQW5nbGUgPSBiLkdldEFuZ2xlKCkKICAgIH0KICAgIEdldFByb3BlcnR5VmFsdWVCeUluZGV4KGEpIHsKICAgICAgICBzd2l0Y2ggKGEpIHsKICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX0lzUHJldmVudFJvdGF0ZSgpOwogICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fR2V0RGVuc2l0eSgpOwogICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fR2V0RnJpY3Rpb24oKTsKICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX0dldEVsYXN0aWNpdHkoKTsKICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX0dldExpbmVhckRhbXBpbmcoKTsKICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX0dldEFuZ3VsYXJEYW1waW5nKCk7CiAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9Jc0J1bGxldCgpOwogICAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fSXNFbmFibGVkKCkKICAgICAgICB9CiAgICB9CiAgICBTZXRQcm9wZXJ0eVZhbHVlQnlJbmRleChhLAogICAgICAgIGIpIHsKICAgICAgICBzd2l0Y2ggKGEpIHsKICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgdGhpcy5fU2V0UHJldmVudFJvdGF0ZShiKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICB0aGlzLl9TZXREZW5zaXR5KGIpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgIHRoaXMuX1NldEZyaWN0aW9uKGIpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgIHRoaXMuX1NldEVsYXN0aWNpdHkoYik7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgICAgdGhpcy5fU2V0TGluZWFyRGFtcGluZyhiKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgICB0aGlzLl9TZXRBbmd1bGFyRGFtcGluZyhiKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDg6CiAgICAgICAgICAgICAgICB0aGlzLl9TZXRCdWxsZXQoYik7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgICAgdGhpcy5fU2V0RW5hYmxlZChiKQogICAgICAgIH0KICAgIH0KICAgIF9TZXRFbmFibGVkKGEpIHsKICAgICAgICBhID0gISFhOwogICAgICAgIHRoaXMuX2lzRW5hYmxlZCAmJiAhYSA/ICh0aGlzLl9EZXN0cm95Qm9keSgpLCB0aGlzLl9pc0VuYWJsZWQgPSAhMSwgdGhpcy5fU3RvcFRpY2tpbmcoKSkgOiAhdGhpcy5faXNFbmFibGVkICYmIGEgJiYgKHRoaXMuX2lzRW5hYmxlZCA9ICEwLCB0aGlzLl9DcmVhdGVCb2R5KCksIHRoaXMuX1N0YXJ0VGlja2luZygpKQogICAgfQogICAgX0lzRW5hYmxlZCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5faXNFbmFibGVkCiAgICB9CiAgICBHZXREZWJ1Z2dlclByb3BlcnRpZXMoKSB7CiAgICAgICAgY29uc3QgYSA9IFt7CiAgICAgICAgICAgIG5hbWU6ICJiZWhhdmlvcnMucGh5c2ljcy5wcm9wZXJ0aWVzLmVuYWJsZWQubmFtZSIsCiAgICAgICAgICAgIHZhbHVlOiB0aGlzLl9Jc0VuYWJsZWQoKSwKICAgICAgICAgICAgb25lZGl0OiBiID0+IHRoaXMuX1NldEVuYWJsZWQoYikKICAgICAgICB9LCB7CiAgICAgICAgICAgIG5hbWU6ICJiZWhhdmlvcnMucGh5c2ljcy5wcm9wZXJ0aWVzLmltbW92YWJsZS5uYW1lIiwKICAgICAgICAgICAgdmFsdWU6IHRoaXMuX0lzSW1tb3ZhYmxlKCksCiAgICAgICAgICAgIG9uZWRpdDogYiA9PiB0aGlzLl9TZXRJbW1vdmFibGUoYikKICAgICAgICB9LCB7CiAgICAgICAgICAgIG5hbWU6ICJiZWhhdmlvcnMucGh5c2ljcy5wcm9wZXJ0aWVzLmRlbnNpdHkubmFtZSIsCiAgICAgICAgICAgIHZhbHVlOiB0aGlzLl9HZXREZW5zaXR5KCksCiAgICAgICAgICAgIG9uZWRpdDogYiA9PiB0aGlzLl9TZXREZW5zaXR5KGIpCiAgICAgICAgfSwgewogICAgICAgICAgICBuYW1lOiAiYmVoYXZpb3JzLnBoeXNpY3MucHJvcGVydGllcy5mcmljdGlvbi5uYW1lIiwKICAgICAgICAgICAgdmFsdWU6IHRoaXMuX0dldEZyaWN0aW9uKCksCiAgICAgICAgICAgIG9uZWRpdDogYiA9PiB0aGlzLl9TZXRGcmljdGlvbihiKQogICAgICAgIH0sIHsKICAgICAgICAgICAgbmFtZTogImJlaGF2aW9ycy5waHlzaWNzLnByb3BlcnRpZXMuZWxhc3RpY2l0eS5uYW1lIiwKICAgICAgICAgICAgdmFsdWU6IHRoaXMuX0dldEVsYXN0aWNpdHkoKSwKICAgICAgICAgICAgb25lZGl0OiBiID0+IHRoaXMuX1NldEVsYXN0aWNpdHkoYikKICAgICAgICB9LCB7CiAgICAgICAgICAgIG5hbWU6ICJiZWhhdmlvcnMucGh5c2ljcy5wcm9wZXJ0aWVzLmxpbmVhci1kYW1waW5nLm5hbWUiLAogICAgICAgICAgICB2YWx1ZTogdGhpcy5fR2V0TGluZWFyRGFtcGluZygpLAogICAgICAgICAgICBvbmVkaXQ6IGIgPT4gdGhpcy5fU2V0TGluZWFyRGFtcGluZyhiKQogICAgICAgIH0sIHsKICAgICAgICAgICAgbmFtZTogImJlaGF2aW9ycy5waHlzaWNzLnByb3BlcnRpZXMuYW5ndWxhci1kYW1waW5nLm5hbWUiLAogICAgICAgICAgICB2YWx1ZTogdGhpcy5fR2V0QW5ndWxhckRhbXBpbmcoKSwKICAgICAgICAgICAgb25lZGl0OiBiID0+IHRoaXMuX1NldEFuZ3VsYXJEYW1waW5nKGIpCiAgICAgICAgfV07CiAgICAgICAgdGhpcy5faXNFbmFibGVkICYmIChhLnB1c2goewogICAgICAgICAgICAgICAgbmFtZTogImJlaGF2aW9ycy5waHlzaWNzLmRlYnVnZ2VyLmlzLXNsZWVwaW5nIiwKICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLl9Jc1NsZWVwaW5nKCkKICAgICAgICAgICAgfSksIGEucHVzaCh7CiAgICAgICAgICAgICAgICBuYW1lOiAiYmVoYXZpb3JzLnBoeXNpY3MuZGVidWdnZXIudmVsb2NpdHkteCIsCiAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5fR2V0VmVsb2NpdHlYKCksCiAgICAgICAgICAgICAgICBvbmVkaXQ6IGIgPT4gdGhpcy5fU2V0VmVsb2NpdHkoYiwgdGhpcy5fR2V0VmVsb2NpdHlZKCkpCiAgICAgICAgICAgIH0pLAogICAgICAgICAgICBhLnB1c2goewogICAgICAgICAgICAgICAgbmFtZTogImJlaGF2aW9ycy5waHlzaWNzLmRlYnVnZ2VyLnZlbG9jaXR5LXkiLAogICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuX0dldFZlbG9jaXR5WSgpLAogICAgICAgICAgICAgICAgb25lZGl0OiBiID0+IHRoaXMuX1NldFZlbG9jaXR5KHRoaXMuX0dldFZlbG9jaXR5WCgpLCBiKQogICAgICAgICAgICB9KSwgYS5wdXNoKHsKICAgICAgICAgICAgICAgIG5hbWU6ICJiZWhhdmlvcnMucGh5c2ljcy5kZWJ1Z2dlci5hbmd1bGFyLXZlbG9jaXR5IiwKICAgICAgICAgICAgICAgIHZhbHVlOiBDMyRqc2NvbXAkMzA2LnRvRGVncmVlcyh0aGlzLl9HZXRBbmd1bGFyVmVsb2NpdHkoKSksCiAgICAgICAgICAgICAgICBvbmVkaXQ6IGIgPT4gdGhpcy5fU2V0QW5ndWxhclZlbG9jaXR5KEMzJGpzY29tcCQzMDYudG9SYWRpYW5zKGIpKQogICAgICAgICAgICB9KSwgYS5wdXNoKHsKICAgICAgICAgICAgICAgIG5hbWU6ICJiZWhhdmlvcnMucGh5c2ljcy5kZWJ1Z2dlci5tYXNzIiwKICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLl9HZXRNYXNzKCkKICAgICAgICAgICAgfSkpOwogICAgICAgIHJldHVybiBbewogICAgICAgICAgICB0aXRsZTogIiQiICsgdGhpcy5HZXRCZWhhdmlvclR5cGUoKS5HZXROYW1lKCksCiAgICAgICAgICAgIHByb3BlcnRpZXM6IGEKICAgICAgICB9XQogICAgfQogICAgX0FwcGx5Rm9yY2UoYSwgYiwgZCkgewogICAgICAgIGNvbnN0IFtjLCBlXSA9IHRoaXMuX0dldEluc3RJbWFnZVBvaW50KGQpOwogICAgICAgIHRoaXMuX0RvQXBwbHlGb3JjZShhLCBiLCBjLCBlKQogICAgfQogICAgX0FwcGx5Rm9yY2VUb3dhcmQoYSwgYiwgZCwgYykgewogICAgICAgIGNvbnN0IFtlLCBnXSA9IHRoaXMuX0dldEluc3RJbWFnZVBvaW50KGMpOwogICAgICAgIGIgPSBDMyRqc2NvbXAkMzA2LmFuZ2xlVG8oZSwgZywgYiwgZCk7CiAgICAgICAgdGhpcy5fRG9BcHBseUZvcmNlKE1hdGguY29zKGIpICogYSwgTWF0aC5zaW4oYikgKiBhLCBlLCBnKQogICAgfQogICAgX0FwcGx5Rm9yY2VBdEFuZ2xlKGEsIGIsIGQpIHsKICAgICAgICBjb25zdCBbYywgZV0gPSB0aGlzLl9HZXRJbnN0SW1hZ2VQb2ludChkKTsKICAgICAgICB0aGlzLl9Eb0FwcGx5Rm9yY2UoTWF0aC5jb3MoYikgKiBhLCBNYXRoLnNpbihiKSAqIGEsIGMsIGUpCiAgICB9CiAgICBfRG9BcHBseUZvcmNlKGEsIGIsIGQsIGMpIHsKICAgICAgICBpZiAodGhpcy5faXNFbmFibGVkKSB7CiAgICAgICAgICAgIHZhciBlID0gdGhpcy5fd29ybGRTY2FsZTsKICAgICAgICAgICAgdGhpcy5fYm9keS5BcHBseUZvcmNlKEdldFRlbXBWZWMyQShhLCBiKSwgR2V0VGVtcFZlYzJCKGQgKiBlLCBjICogZSksICEwKQogICAgICAgIH0KICAgIH0KICAgIF9BcHBseUltcHVsc2UoYSwgYiwgZCkgewogICAgICAgIGNvbnN0IFtjLCBlXSA9IHRoaXMuX0dldEluc3RJbWFnZVBvaW50KGQpOwogICAgICAgIHRoaXMuX0RvQXBwbHlJbXB1bHNlKGEsCiAgICAgICAgICAgIGIsIGMsIGUpCiAgICB9CiAgICBfQXBwbHlJbXB1bHNlVG93YXJkKGEsIGIsIGQsIGMpIHsKICAgICAgICBjb25zdCBbZSwgZ10gPSB0aGlzLl9HZXRJbnN0SW1hZ2VQb2ludChjKTsKICAgICAgICBiID0gQzMkanNjb21wJDMwNi5hbmdsZVRvKGUsIGcsIGIsIGQpOwogICAgICAgIHRoaXMuX0RvQXBwbHlJbXB1bHNlKE1hdGguY29zKGIpICogYSwgTWF0aC5zaW4oYikgKiBhLCBlLCBnKQogICAgfQogICAgX0FwcGx5SW1wdWxzZUF0QW5nbGUoYSwgYiwgZCkgewogICAgICAgIGNvbnN0IFtjLCBlXSA9IHRoaXMuX0dldEluc3RJbWFnZVBvaW50KGQpOwogICAgICAgIHRoaXMuX0RvQXBwbHlJbXB1bHNlKE1hdGguY29zKGIpICogYSwgTWF0aC5zaW4oYikgKiBhLCBjLCBlKQogICAgfQogICAgX0RvQXBwbHlJbXB1bHNlKGEsIGIsIGQsIGMpIHsKICAgICAgICBpZiAodGhpcy5faXNFbmFibGVkKSB7CiAgICAgICAgICAgIHZhciBlID0gdGhpcy5fd29ybGRTY2FsZTsKICAgICAgICAgICAgdGhpcy5fYm9keS5BcHBseUxpbmVhckltcHVsc2UoR2V0VGVtcFZlYzJBKGEsIGIpLCBHZXRUZW1wVmVjMkIoZCAqIGUsIGMgKiBlKSwgITApOwogICAgICAgICAgICBhID0gdGhpcy5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgdGhpcy5fbGFzdEtub3duWCA9IGEuR2V0WCgpOwogICAgICAgICAgICB0aGlzLl9sYXN0S25vd25ZID0gYS5HZXRZKCk7CiAgICAgICAgICAgIHRoaXMuX2xhc3RUaWNrT3ZlcnJpZGUgPSAhMQogICAgICAgIH0KICAgIH0KICAgIF9BcHBseVRvcnF1ZShhKSB7CiAgICAgICAgdGhpcy5faXNFbmFibGVkICYmIHRoaXMuX2JvZHkuQXBwbHlUb3JxdWUoYSwgITApCiAgICB9CiAgICBfQXBwbHlUb3JxdWVUb0FuZ2xlKGEsIGIpIHsKICAgICAgICBiID0gQzMkanNjb21wJDMwNi5hbmdsZUNsb2Nrd2lzZSh0aGlzLkdldFdvcmxkSW5mbygpLkdldEFuZ2xlKCksIGIpID8gLTEgOiAxOwogICAgICAgIHRoaXMuX0FwcGx5VG9ycXVlKGEgKiBiKQogICAgfQogICAgX0FwcGx5VG9ycXVlVG9Qb3NpdGlvbihhLCBiLCBkKSB7CiAgICAgICAgdmFyIGMgPSB0aGlzLkdldFdvcmxkSW5mbygpOwogICAgICAgIGIgPSBDMyRqc2NvbXAkMzA2LmFuZ2xlVG8oYy5HZXRYKCksIGMuR2V0WSgpLCBiLCBkKTsKICAgICAgICBjID0gQzMkanNjb21wJDMwNi5hbmdsZUNsb2Nrd2lzZShjLkdldEFuZ2xlKCksIGIpID8gLTEgOiAxOwogICAgICAgIHRoaXMuX0FwcGx5VG9ycXVlKGEgKiBjKQogICAgfQogICAgX1NldEFuZ3VsYXJWZWxvY2l0eShhKSB7CiAgICAgICAgdGhpcy5faXNFbmFibGVkICYmICh0aGlzLl9ib2R5LlNldEFuZ3VsYXJWZWxvY2l0eShhKSwgdGhpcy5fYm9keS5TZXRBd2FrZSghMCkpCiAgICB9CiAgICBfR2V0QW5ndWxhclZlbG9jaXR5KCkgewogICAgICAgIHJldHVybiB0aGlzLl9pc0VuYWJsZWQgPwogICAgICAgICAgICB0aGlzLl9ib2R5LkdldEFuZ3VsYXJWZWxvY2l0eSgpIDogMAogICAgfQogICAgX1NldFZlbG9jaXR5KGEsIGIpIHsKICAgICAgICBpZiAodGhpcy5faXNFbmFibGVkKSB7CiAgICAgICAgICAgIHZhciBkID0gdGhpcy5fd29ybGRTY2FsZTsKICAgICAgICAgICAgdGhpcy5fYm9keS5TZXRMaW5lYXJWZWxvY2l0eShHZXRUZW1wVmVjMkEoYSAqIGQsIGIgKiBkKSk7CiAgICAgICAgICAgIHRoaXMuX2JvZHkuU2V0QXdha2UoITApOwogICAgICAgICAgICBhID0gdGhpcy5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgdGhpcy5fbGFzdEtub3duWCA9IGEuR2V0WCgpOwogICAgICAgICAgICB0aGlzLl9sYXN0S25vd25ZID0gYS5HZXRZKCk7CiAgICAgICAgICAgIHRoaXMuX2xhc3RUaWNrT3ZlcnJpZGUgPSAhMQogICAgICAgIH0KICAgIH0KICAgIF9HZXRWZWxvY2l0eSgpIHsKICAgICAgICBpZiAoIXRoaXMuX2lzRW5hYmxlZCkgcmV0dXJuIFswLCAwXTsKICAgICAgICBjb25zdCBhID0gdGhpcy5fd29ybGRTY2FsZSwKICAgICAgICAgICAgYiA9IHRoaXMuX2JvZHkuR2V0TGluZWFyVmVsb2NpdHkoKTsKICAgICAgICByZXR1cm4gW2IuZ2V0X3goKSAvIGEsIGIuZ2V0X3koKSAvIGFdCiAgICB9CiAgICBfR2V0VmVsb2NpdHlYKCkgewogICAgICAgIHJldHVybiB0aGlzLl9pc0VuYWJsZWQgPyB0aGlzLl9ib2R5LkdldExpbmVhclZlbG9jaXR5KCkuZ2V0X3goKSAvIHRoaXMuX3dvcmxkU2NhbGUgOgogICAgICAgICAgICAwCiAgICB9CiAgICBfR2V0VmVsb2NpdHlZKCkgewogICAgICAgIHJldHVybiB0aGlzLl9pc0VuYWJsZWQgPyB0aGlzLl9ib2R5LkdldExpbmVhclZlbG9jaXR5KCkuZ2V0X3koKSAvIHRoaXMuX3dvcmxkU2NhbGUgOiAwCiAgICB9CiAgICBfU2V0RGVuc2l0eShhKSB7CiAgICAgICAgaWYgKHRoaXMuX2lzRW5hYmxlZCAmJiB0aGlzLl9kZW5zaXR5ICE9PSBhKSB7CiAgICAgICAgICAgIHRoaXMuX2RlbnNpdHkgPSBhOwogICAgICAgICAgICBmb3IgKGNvbnN0IGIgb2YgdGhpcy5fZml4dHVyZXMpIGIuU2V0RGVuc2l0eShhKTsKICAgICAgICAgICAgdGhpcy5fYm9keS5SZXNldE1hc3NEYXRhKCkKICAgICAgICB9CiAgICB9CiAgICBfR2V0RGVuc2l0eSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5faXNFbmFibGVkID8gdGhpcy5fZGVuc2l0eSA6IDAKICAgIH0KICAgIF9TZXRGcmljdGlvbihhKSB7CiAgICAgICAgaWYgKHRoaXMuX2lzRW5hYmxlZCAmJiB0aGlzLl9mcmljdGlvbiAhPT0gYSkgewogICAgICAgICAgICB0aGlzLl9mcmljdGlvbiA9IGE7CiAgICAgICAgICAgIGZvciAodmFyIGIgb2YgdGhpcy5fZml4dHVyZXMpIGIuU2V0RnJpY3Rpb24oYSk7CiAgICAgICAgICAgIGZvciAoYSA9IHRoaXMuX2JvZHkuR2V0Q29udGFjdExpc3QoKTsgdGhpcy5fYm94MmQuZ2V0UG9pbnRlcihhKTsgYSA9IGEuZ2V0X25leHQoKSkoYiA9IGEuZ2V0X2NvbnRhY3QoKSkgJiYKICAgICAgICAgICAgICAgIGIuUmVzZXRGcmljdGlvbigpCiAgICAgICAgfQogICAgfQogICAgX0dldEZyaWN0aW9uKCkgewogICAgICAgIHJldHVybiB0aGlzLl9pc0VuYWJsZWQgPyB0aGlzLl9mcmljdGlvbiA6IDAKICAgIH0KICAgIF9TZXRFbGFzdGljaXR5KGEpIHsKICAgICAgICBpZiAodGhpcy5faXNFbmFibGVkICYmIHRoaXMuX3Jlc3RpdHV0aW9uICE9PSBhKSB7CiAgICAgICAgICAgIHRoaXMuX3Jlc3RpdHV0aW9uID0gYTsKICAgICAgICAgICAgZm9yIChjb25zdCBiIG9mIHRoaXMuX2ZpeHR1cmVzKSBiLlNldFJlc3RpdHV0aW9uKGEpCiAgICAgICAgfQogICAgfQogICAgX0dldEVsYXN0aWNpdHkoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2lzRW5hYmxlZCA/IHRoaXMuX3Jlc3RpdHV0aW9uIDogMAogICAgfQogICAgX1NldExpbmVhckRhbXBpbmcoYSkgewogICAgICAgIHRoaXMuX2lzRW5hYmxlZCAmJiB0aGlzLl9saW5lYXJEYW1waW5nICE9PSBhICYmICh0aGlzLl9saW5lYXJEYW1waW5nID0gYSwgdGhpcy5fYm9keS5TZXRMaW5lYXJEYW1waW5nKGEpKQogICAgfQogICAgX0dldExpbmVhckRhbXBpbmcoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2lzRW5hYmxlZCA/IHRoaXMuX2xpbmVhckRhbXBpbmcgOiAwCiAgICB9CiAgICBfU2V0QW5ndWxhckRhbXBpbmcoYSkgewogICAgICAgIHRoaXMuX2lzRW5hYmxlZCAmJiB0aGlzLl9hbmd1bGFyRGFtcGluZyAhPT0KICAgICAgICAgICAgYSAmJiAodGhpcy5fYW5ndWxhckRhbXBpbmcgPSBhLCB0aGlzLl9ib2R5LlNldEFuZ3VsYXJEYW1waW5nKGEpKQogICAgfQogICAgX0dldEFuZ3VsYXJEYW1waW5nKCkgewogICAgICAgIHJldHVybiB0aGlzLl9pc0VuYWJsZWQgPyB0aGlzLl9hbmd1bGFyRGFtcGluZyA6IDAKICAgIH0KICAgIF9TZXRJbW1vdmFibGUoYSkgewogICAgICAgIHRoaXMuX2lzRW5hYmxlZCAmJiAoYSA9ICEhYSwgdGhpcy5faXNJbW1vdmFibGUgIT09IGEgJiYgKHRoaXMuX2lzSW1tb3ZhYmxlID0gYSwgdGhpcy5fYm9keS5TZXRUeXBlKHRoaXMuX2lzSW1tb3ZhYmxlID8gMCA6IDIpLCB0aGlzLl9ib2R5LlNldEF3YWtlKCEwKSkpCiAgICB9CiAgICBfSXNJbW1vdmFibGUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2lzSW1tb3ZhYmxlCiAgICB9CiAgICBfU2V0UHJldmVudFJvdGF0ZShhKSB7CiAgICAgICAgdGhpcy5faXNFbmFibGVkICYmIChhID0gISFhLCB0aGlzLl9wcmV2ZW50Um90YXRpb24gIT09IGEgJiYgKHRoaXMuX3ByZXZlbnRSb3RhdGlvbiA9IGEsIHRoaXMuX2JvZHkuU2V0Rml4ZWRSb3RhdGlvbih0aGlzLl9wcmV2ZW50Um90YXRpb24pLCB0aGlzLl9ib2R5LlNldEFuZ3VsYXJWZWxvY2l0eSgwKSwKICAgICAgICAgICAgdGhpcy5fYm9keS5TZXRBd2FrZSghMCkpKQogICAgfQogICAgX0lzUHJldmVudFJvdGF0ZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcHJldmVudFJvdGF0aW9uCiAgICB9CiAgICBfU2V0QnVsbGV0KGEpIHsKICAgICAgICB0aGlzLl9pc0VuYWJsZWQgJiYgKGEgPSAhIWEsIHRoaXMuX2lzQnVsbGV0ICE9PSBhICYmICh0aGlzLl9pc0J1bGxldCA9IGEsIHRoaXMuX2JvZHkuU2V0QnVsbGV0KHRoaXMuX2lzQnVsbGV0KSwgdGhpcy5fYm9keS5TZXRBd2FrZSghMCkpKQogICAgfQogICAgX0lzQnVsbGV0KCkgewogICAgICAgIHJldHVybiB0aGlzLl9pc0J1bGxldAogICAgfQogICAgX0dldE1hc3MoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2lzRW5hYmxlZCA/IHRoaXMuX2JvZHkuR2V0TWFzcygpIC8gdGhpcy5fd29ybGRTY2FsZSA6IDAKICAgIH0KICAgIF9HZXRDZW50ZXJPZk1hc3NYKCkgewogICAgICAgIHJldHVybiB0aGlzLl9pc0VuYWJsZWQgPyAodGhpcy5fYm9keS5HZXRQb3NpdGlvbigpLmdldF94KCkgKyB0aGlzLl9ib2R5LkdldExvY2FsQ2VudGVyKCkuZ2V0X3goKSkgLyB0aGlzLl93b3JsZFNjYWxlIDogMAogICAgfQogICAgX0dldENlbnRlck9mTWFzc1koKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2lzRW5hYmxlZCA/ICh0aGlzLl9ib2R5LkdldFBvc2l0aW9uKCkuZ2V0X3koKSArCiAgICAgICAgICAgIHRoaXMuX2JvZHkuR2V0TG9jYWxDZW50ZXIoKS5nZXRfeSgpKSAvIHRoaXMuX3dvcmxkU2NhbGUgOiAwCiAgICB9CiAgICBfR2V0Q2VudGVyT2ZNYXNzKCkgewogICAgICAgIGlmICghdGhpcy5faXNFbmFibGVkKSByZXR1cm4gWzAsIDBdOwogICAgICAgIGNvbnN0IGEgPSB0aGlzLl9ib2R5LkdldFBvc2l0aW9uKCksCiAgICAgICAgICAgIGIgPSB0aGlzLl9ib2R5LkdldExvY2FsQ2VudGVyKCksCiAgICAgICAgICAgIGQgPSB0aGlzLl93b3JsZFNjYWxlOwogICAgICAgIHJldHVybiBbKGEuZ2V0X3goKSArIGIuZ2V0X3goKSkgLyBkLCAoYS5nZXRfeSgpICsgYi5nZXRfeSgpKSAvIGRdCiAgICB9CiAgICBfSXNTbGVlcGluZygpIHsKICAgICAgICByZXR1cm4gdGhpcy5faXNFbmFibGVkID8gIXRoaXMuX2JvZHkuSXNBd2FrZSgpIDogITEKICAgIH0KICAgIF9HZXRDb250YWN0Q291bnQoKSB7CiAgICAgICAgaWYgKCF0aGlzLl9pc0VuYWJsZWQpIHJldHVybiAwOwogICAgICAgIGxldCBhID0gMDsKICAgICAgICBmb3IgKGxldCBkID0gdGhpcy5fYm9keS5HZXRDb250YWN0TGlzdCgpOyB0aGlzLl9ib3gyZC5nZXRQb2ludGVyKGQpOyBkID0gZC5nZXRfbmV4dCgpKSB7CiAgICAgICAgICAgIHZhciBiID0gZC5nZXRfY29udGFjdCgpOwogICAgICAgICAgICBiICYmIChiID0gYi5HZXRNYW5pZm9sZCgpLmdldF9wb2ludENvdW50KCksCiAgICAgICAgICAgICAgICBhICs9IGIpCiAgICAgICAgfQogICAgICAgIHJldHVybiBhCiAgICB9CiAgICBfR2V0Q29udGFjdFBvc2l0aW9uQXQoYSkgewogICAgICAgIGEgPSBNYXRoLmZsb29yKGEpOwogICAgICAgIGlmICghdGhpcy5faXNFbmFibGVkKSByZXR1cm4gWzAsIDBdOwogICAgICAgIHZhciBiID0gMDsKICAgICAgICBmb3IgKGxldCBjID0gdGhpcy5fYm9keS5HZXRDb250YWN0TGlzdCgpOyB0aGlzLl9ib3gyZC5nZXRQb2ludGVyKGMpOyBjID0gYy5nZXRfbmV4dCgpKSB7CiAgICAgICAgICAgIHZhciBkID0gYy5nZXRfY29udGFjdCgpOwogICAgICAgICAgICBpZiAoIWQpIGNvbnRpbnVlOwogICAgICAgICAgICBjb25zdCBlID0gZC5HZXRNYW5pZm9sZCgpLmdldF9wb2ludENvdW50KCk7CiAgICAgICAgICAgIGlmIChhID49IGIgJiYgYSA8IGIgKyBlKSByZXR1cm4gYSAtPSBiLCBiID0gdGhpcy5HZXRCZWhhdmlvcigpLkdldFdvcmxkTWFuaWZvbGQoKSwgZC5HZXRXb3JsZE1hbmlmb2xkKGIpLCBkID0gYi5nZXRfcG9pbnRzKGEpLCBbZC5nZXRfeCgpIC8gdGhpcy5fd29ybGRTY2FsZSwgZC5nZXRfeSgpIC8gdGhpcy5fd29ybGRTY2FsZV07CiAgICAgICAgICAgIGIgKz0gZQogICAgICAgIH0KICAgICAgICByZXR1cm4gWzAsIDBdCiAgICB9CiAgICBHZXRTY3JpcHRJbnRlcmZhY2VDbGFzcygpIHsKICAgICAgICByZXR1cm4gc2VsZi5JUGh5c2ljc0JlaGF2aW9ySW5zdGFuY2UKICAgIH0KfTsKY29uc3QgbWFwJGpzY29tcCQzMCA9IG5ldyBXZWFrTWFwOwoKZnVuY3Rpb24gVW53cmFwSVdvcmxkSW5zdGFuY2UoYSwgYikgewogICAgcmV0dXJuIG1hcCRqc2NvbXAkMzAuZ2V0KGEpLkdldFJ1bnRpbWUoKS5fVW53cmFwSVdvcmxkSW5zdGFuY2UoYikKfQpzZWxmLklQaHlzaWNzQmVoYXZpb3JJbnN0YW5jZSA9IGNsYXNzIGV4dGVuZHMgSUJlaGF2aW9ySW5zdGFuY2UkanNjb21wJDYgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgICAgc3VwZXIoKTsKICAgICAgICBtYXAkanNjb21wJDMwLnNldCh0aGlzLCBJQmVoYXZpb3JJbnN0YW5jZSRqc2NvbXAkNi5fR2V0SW5pdEluc3QoKS5HZXRTZGtJbnN0YW5jZSgpKQogICAgfQogICAgZ2V0IGlzRW5hYmxlZCgpIHsKICAgICAgICByZXR1cm4gbWFwJGpzY29tcCQzMC5nZXQodGhpcykuX0lzRW5hYmxlZCgpCiAgICB9CiAgICBzZXQgaXNFbmFibGVkKGEpIHsKICAgICAgICBtYXAkanNjb21wJDMwLmdldCh0aGlzKS5fU2V0RW5hYmxlZChhKQogICAgfQogICAgYXBwbHlGb3JjZShhLCBiLCBkID0gMCkgewogICAgICAgIEMzWCRqc2NvbXAkMzIuUmVxdWlyZUZpbml0ZU51bWJlcihhKTsKICAgICAgICBDM1gkanNjb21wJDMyLlJlcXVpcmVGaW5pdGVOdW1iZXIoYik7CiAgICAgICAgbWFwJGpzY29tcCQzMC5nZXQodGhpcykuX0FwcGx5Rm9yY2UoYSwgYiwgZCkKICAgIH0KICAgIGFwcGx5Rm9yY2VUb3dhcmRQb3NpdGlvbihhLCBiLCBkLCBjID0gMCkgewogICAgICAgIEMzWCRqc2NvbXAkMzIuUmVxdWlyZUZpbml0ZU51bWJlcihhKTsKICAgICAgICBDM1gkanNjb21wJDMyLlJlcXVpcmVGaW5pdGVOdW1iZXIoYik7CiAgICAgICAgQzNYJGpzY29tcCQzMi5SZXF1aXJlRmluaXRlTnVtYmVyKGQpOwogICAgICAgIG1hcCRqc2NvbXAkMzAuZ2V0KHRoaXMpLl9BcHBseUZvcmNlVG93YXJkKGEsIGIsIGQsIGMpCiAgICB9CiAgICBhcHBseUZvcmNlQXRBbmdsZShhLCBiLCBkID0gMCkgewogICAgICAgIEMzWCRqc2NvbXAkMzIuUmVxdWlyZUZpbml0ZU51bWJlcihhKTsKICAgICAgICBDM1gkanNjb21wJDMyLlJlcXVpcmVGaW5pdGVOdW1iZXIoYik7CiAgICAgICAgbWFwJGpzY29tcCQzMC5nZXQodGhpcykuX0FwcGx5Rm9yY2VBdEFuZ2xlKGEsIGIsIGQpCiAgICB9CiAgICBhcHBseUltcHVsc2UoYSwgYiwgZCA9IDApIHsKICAgICAgICBDM1gkanNjb21wJDMyLlJlcXVpcmVGaW5pdGVOdW1iZXIoYSk7CiAgICAgICAgQzNYJGpzY29tcCQzMi5SZXF1aXJlRmluaXRlTnVtYmVyKGIpOwogICAgICAgIG1hcCRqc2NvbXAkMzAuZ2V0KHRoaXMpLl9BcHBseUltcHVsc2UoYSwgYiwgZCkKICAgIH0KICAgIGFwcGx5SW1wdWxzZVRvd2FyZFBvc2l0aW9uKGEsIGIsIGQsIGMgPSAwKSB7CiAgICAgICAgQzNYJGpzY29tcCQzMi5SZXF1aXJlRmluaXRlTnVtYmVyKGEpOwogICAgICAgIEMzWCRqc2NvbXAkMzIuUmVxdWlyZUZpbml0ZU51bWJlcihiKTsKICAgICAgICBDM1gkanNjb21wJDMyLlJlcXVpcmVGaW5pdGVOdW1iZXIoZCk7CiAgICAgICAgbWFwJGpzY29tcCQzMC5nZXQodGhpcykuX0FwcGx5SW1wdWxzZVRvd2FyZChhLCBiLCBkLCBjKQogICAgfQogICAgYXBwbHlJbXB1bHNlQXRBbmdsZShhLCBiLCBkID0gMCkgewogICAgICAgIEMzWCRqc2NvbXAkMzIuUmVxdWlyZUZpbml0ZU51bWJlcihhKTsKICAgICAgICBDM1gkanNjb21wJDMyLlJlcXVpcmVGaW5pdGVOdW1iZXIoYik7CiAgICAgICAgbWFwJGpzY29tcCQzMC5nZXQodGhpcykuX0FwcGx5SW1wdWxzZUF0QW5nbGUoYSwgYiwgZCkKICAgIH0KICAgIGFwcGx5VG9ycXVlKGEpIHsKICAgICAgICBDM1gkanNjb21wJDMyLlJlcXVpcmVGaW5pdGVOdW1iZXIoYSk7CiAgICAgICAgbWFwJGpzY29tcCQzMC5nZXQodGhpcykuX0FwcGx5VG9ycXVlKGEpCiAgICB9CiAgICBhcHBseVRvcnF1ZVRvQW5nbGUoYSwgYikgewogICAgICAgIEMzWCRqc2NvbXAkMzIuUmVxdWlyZUZpbml0ZU51bWJlcihhKTsKICAgICAgICBDM1gkanNjb21wJDMyLlJlcXVpcmVGaW5pdGVOdW1iZXIoYik7CiAgICAgICAgbWFwJGpzY29tcCQzMC5nZXQodGhpcykuX0FwcGx5VG9ycXVlVG9BbmdsZShhLCBiKQogICAgfQogICAgYXBwbHlUb3JxdWVUb1Bvc2l0aW9uKGEsCiAgICAgICAgYiwgZCkgewogICAgICAgIEMzWCRqc2NvbXAkMzIuUmVxdWlyZUZpbml0ZU51bWJlcihhKTsKICAgICAgICBDM1gkanNjb21wJDMyLlJlcXVpcmVGaW5pdGVOdW1iZXIoYik7CiAgICAgICAgQzNYJGpzY29tcCQzMi5SZXF1aXJlRmluaXRlTnVtYmVyKGQpOwogICAgICAgIG1hcCRqc2NvbXAkMzAuZ2V0KHRoaXMpLl9BcHBseVRvcnF1ZVRvUG9zaXRpb24oYSwgYiwgZCkKICAgIH0KICAgIHNldCBhbmd1bGFyVmVsb2NpdHkoYSkgewogICAgICAgIEMzWCRqc2NvbXAkMzIuUmVxdWlyZUZpbml0ZU51bWJlcihhKTsKICAgICAgICBtYXAkanNjb21wJDMwLmdldCh0aGlzKS5fU2V0QW5ndWxhclZlbG9jaXR5KGEpCiAgICB9CiAgICBnZXQgYW5ndWxhclZlbG9jaXR5KCkgewogICAgICAgIHJldHVybiBtYXAkanNjb21wJDMwLmdldCh0aGlzKS5fR2V0QW5ndWxhclZlbG9jaXR5KCkKICAgIH0KICAgIHNldFZlbG9jaXR5KGEsIGIpIHsKICAgICAgICBDM1gkanNjb21wJDMyLlJlcXVpcmVGaW5pdGVOdW1iZXIoYSk7CiAgICAgICAgQzNYJGpzY29tcCQzMi5SZXF1aXJlRmluaXRlTnVtYmVyKGIpOwogICAgICAgIG1hcCRqc2NvbXAkMzAuZ2V0KHRoaXMpLl9TZXRWZWxvY2l0eShhLCBiKQogICAgfQogICAgZ2V0VmVsb2NpdHlYKCkgewogICAgICAgIHJldHVybiBtYXAkanNjb21wJDMwLmdldCh0aGlzKS5fR2V0VmVsb2NpdHlYKCkKICAgIH0KICAgIGdldFZlbG9jaXR5WSgpIHsKICAgICAgICByZXR1cm4gbWFwJGpzY29tcCQzMC5nZXQodGhpcykuX0dldFZlbG9jaXR5WSgpCiAgICB9CiAgICBnZXRWZWxvY2l0eSgpIHsKICAgICAgICByZXR1cm4gbWFwJGpzY29tcCQzMC5nZXQodGhpcykuX0dldFZlbG9jaXR5KCkKICAgIH0KICAgIHNldCBkZW5zaXR5KGEpIHsKICAgICAgICBDM1gkanNjb21wJDMyLlJlcXVpcmVGaW5pdGVOdW1iZXIoYSk7CiAgICAgICAgbWFwJGpzY29tcCQzMC5nZXQodGhpcykuX1NldERlbnNpdHkoYSkKICAgIH0KICAgIGdldCBkZW5zaXR5KCkgewogICAgICAgIHJldHVybiBtYXAkanNjb21wJDMwLmdldCh0aGlzKS5fR2V0RGVuc2l0eSgpCiAgICB9CiAgICBzZXQgZnJpY3Rpb24oYSkgewogICAgICAgIEMzWCRqc2NvbXAkMzIuUmVxdWlyZUZpbml0ZU51bWJlcihhKTsKICAgICAgICBtYXAkanNjb21wJDMwLmdldCh0aGlzKS5fU2V0RnJpY3Rpb24oYSkKICAgIH0KICAgIGdldCBmcmljdGlvbigpIHsKICAgICAgICByZXR1cm4gbWFwJGpzY29tcCQzMC5nZXQodGhpcykuX0dldEZyaWN0aW9uKCkKICAgIH0KICAgIHNldCBlbGFzdGljaXR5KGEpIHsKICAgICAgICBDM1gkanNjb21wJDMyLlJlcXVpcmVGaW5pdGVOdW1iZXIoYSk7CiAgICAgICAgbWFwJGpzY29tcCQzMC5nZXQodGhpcykuX1NldEVsYXN0aWNpdHkoYSkKICAgIH0KICAgIGdldCBlbGFzdGljaXR5KCkgewogICAgICAgIHJldHVybiBtYXAkanNjb21wJDMwLmdldCh0aGlzKS5fR2V0RWxhc3RpY2l0eSgpCiAgICB9CiAgICBzZXQgbGluZWFyRGFtcGluZyhhKSB7CiAgICAgICAgQzNYJGpzY29tcCQzMi5SZXF1aXJlRmluaXRlTnVtYmVyKGEpOwogICAgICAgIG1hcCRqc2NvbXAkMzAuZ2V0KHRoaXMpLl9TZXRMaW5lYXJEYW1waW5nKGEpCiAgICB9CiAgICBnZXQgbGluZWFyRGFtcGluZygpIHsKICAgICAgICByZXR1cm4gbWFwJGpzY29tcCQzMC5nZXQodGhpcykuX0dldExpbmVhckRhbXBpbmcoKQogICAgfQogICAgc2V0IGFuZ3VsYXJEYW1waW5nKGEpIHsKICAgICAgICBDM1gkanNjb21wJDMyLlJlcXVpcmVGaW5pdGVOdW1iZXIoYSk7CiAgICAgICAgbWFwJGpzY29tcCQzMC5nZXQodGhpcykuX1NldEFuZ3VsYXJEYW1waW5nKGEpCiAgICB9CiAgICBnZXQgYW5ndWxhckRhbXBpbmcoKSB7CiAgICAgICAgcmV0dXJuIG1hcCRqc2NvbXAkMzAuZ2V0KHRoaXMpLl9HZXRBbmd1bGFyRGFtcGluZygpCiAgICB9CiAgICBzZXQgaXNJbW1vdmFibGUoYSkgewogICAgICAgIG1hcCRqc2NvbXAkMzAuZ2V0KHRoaXMpLl9TZXRJbW1vdmFibGUoYSkKICAgIH0KICAgIGdldCBpc0ltbW92YWJsZSgpIHsKICAgICAgICByZXR1cm4gbWFwJGpzY29tcCQzMC5nZXQodGhpcykuX0lzSW1tb3ZhYmxlKCkKICAgIH0KICAgIHNldCBpc1ByZXZlbnRSb3RhdGlvbihhKSB7CiAgICAgICAgbWFwJGpzY29tcCQzMC5nZXQodGhpcykuX1NldFByZXZlbnRSb3RhdGUoYSkKICAgIH0KICAgIGdldCBpc1ByZXZlbnRSb3RhdGlvbigpIHsKICAgICAgICByZXR1cm4gbWFwJGpzY29tcCQzMC5nZXQodGhpcykuX0lzUHJldmVudFJvdGF0ZSgpCiAgICB9CiAgICBzZXQgaXNCdWxsZXQoYSkgewogICAgICAgIG1hcCRqc2NvbXAkMzAuZ2V0KHRoaXMpLl9TZXRCdWxsZXQoYSkKICAgIH0KICAgIGdldCBpc0J1bGxldCgpIHsKICAgICAgICByZXR1cm4gbWFwJGpzY29tcCQzMC5nZXQodGhpcykuX0lzQnVsbGV0KCkKICAgIH0KICAgIGdldCBtYXNzKCkgewogICAgICAgIHJldHVybiBtYXAkanNjb21wJDMwLmdldCh0aGlzKS5fR2V0TWFzcygpCiAgICB9CiAgICBnZXRDZW50ZXJPZk1hc3NYKCkgewogICAgICAgIHJldHVybiBtYXAkanNjb21wJDMwLmdldCh0aGlzKS5fR2V0Q2VudGVyT2ZNYXNzWCgpCiAgICB9CiAgICBnZXRDZW50ZXJPZk1hc3NZKCkgewogICAgICAgIHJldHVybiBtYXAkanNjb21wJDMwLmdldCh0aGlzKS5fR2V0Q2VudGVyT2ZNYXNzWSgpCiAgICB9CiAgICBnZXRDZW50ZXJPZk1hc3MoKSB7CiAgICAgICAgcmV0dXJuIG1hcCRqc2NvbXAkMzAuZ2V0KHRoaXMpLl9HZXRDZW50ZXJPZk1hc3MoKQogICAgfQogICAgZ2V0Q29udGFjdENvdW50KCkgewogICAgICAgIHJldHVybiBtYXAkanNjb21wJDMwLmdldCh0aGlzKS5fR2V0Q29udGFjdENvdW50KCkKICAgIH0KICAgIGdldENvbnRhY3RYKGEpIHsKICAgICAgICBDM1gkanNjb21wJDMyLlJlcXVpcmVGaW5pdGVOdW1iZXIoYSk7CiAgICAgICAgcmV0dXJuIG1hcCRqc2NvbXAkMzAuZ2V0KHRoaXMpLl9HZXRDb250YWN0UG9zaXRpb25BdChhKVswXQogICAgfQogICAgZ2V0Q29udGFjdFkoYSkgewogICAgICAgIEMzWCRqc2NvbXAkMzIuUmVxdWlyZUZpbml0ZU51bWJlcihhKTsKICAgICAgICByZXR1cm4gbWFwJGpzY29tcCQzMC5nZXQodGhpcykuX0dldENvbnRhY3RQb3NpdGlvbkF0KGEpWzFdCiAgICB9CiAgICBnZXRDb250YWN0KGEpIHsKICAgICAgICBDM1gkanNjb21wJDMyLlJlcXVpcmVGaW5pdGVOdW1iZXIoYSk7CiAgICAgICAgcmV0dXJuIG1hcCRqc2NvbXAkMzAuZ2V0KHRoaXMpLl9HZXRDb250YWN0UG9zaXRpb25BdChhKQogICAgfQogICAgZ2V0IGlzU2xlZXBpbmcoKSB7CiAgICAgICAgcmV0dXJuIG1hcCRqc2NvbXAkMzAuZ2V0KHRoaXMpLl9Jc1NsZWVwaW5nKCkKICAgIH0KICAgIGNyZWF0ZURpc3RhbmNlSm9pbnQoYSwgYiwgZCwgYywgZSkgewogICAgICAgIEMzWCRqc2NvbXAkMzIuUmVxdWlyZUZpbml0ZU51bWJlcihjKTsKICAgICAgICBDM1gkanNjb21wJDMyLlJlcXVpcmVGaW5pdGVOdW1iZXIoZSk7CiAgICAgICAgYiA9IFVud3JhcElXb3JsZEluc3RhbmNlKHRoaXMsIGIpOwogICAgICAgIG1hcCRqc2NvbXAkMzAuZ2V0KHRoaXMpLl9DcmVhdGVEaXN0YW5jZUpvaW50KGEsCiAgICAgICAgICAgIGIsIGQsIGMsIGUpCiAgICB9CiAgICBjcmVhdGVSZXZvbHV0ZUpvaW50KGEsIGIpIHsKICAgICAgICBiID0gVW53cmFwSVdvcmxkSW5zdGFuY2UodGhpcywgYik7CiAgICAgICAgbWFwJGpzY29tcCQzMC5nZXQodGhpcykuX0NyZWF0ZVJldm9sdXRlSm9pbnQoYSwgYikKICAgIH0KICAgIGNyZWF0ZUxpbWl0ZWRSZXZvbHV0ZUpvaW50KGEsIGIsIGQsIGMpIHsKICAgICAgICBDM1gkanNjb21wJDMyLlJlcXVpcmVGaW5pdGVOdW1iZXIoZCk7CiAgICAgICAgQzNYJGpzY29tcCQzMi5SZXF1aXJlRmluaXRlTnVtYmVyKGMpOwogICAgICAgIGIgPSBVbndyYXBJV29ybGRJbnN0YW5jZSh0aGlzLCBiKTsKICAgICAgICBtYXAkanNjb21wJDMwLmdldCh0aGlzKS5fQ3JlYXRlTGltaXRlZFJldm9sdXRlSm9pbnQoYSwgYiwgZCwgYykKICAgIH0KICAgIGNyZWF0ZVByaXNtYXRpY0pvaW50KGEsIGIsIGQsIGMsIGUsIGcsIGssIG0sIG4pIHsKICAgICAgICBiID0gVW53cmFwSVdvcmxkSW5zdGFuY2UodGhpcywgYik7CiAgICAgICAgbWFwJGpzY29tcCQzMC5nZXQodGhpcykuX0NyZWF0ZVByaXNtYXRpY0pvaW50KGEsIGIsIGQsIGMsIGUsIGcsIGssIG0sIG4pCiAgICB9CiAgICByZW1vdmVBbGxKb2ludHMoKSB7CiAgICAgICAgbWFwJGpzY29tcCQzMC5nZXQodGhpcykuX1JlbW92ZUpvaW50cygpCiAgICB9Cn07CmNvbnN0IEMzJGpzY29tcCQzMDcgPSBzZWxmLkMzOwpDMyRqc2NvbXAkMzA3LkJlaGF2aW9ycy5QaHlzaWNzLkNuZHMgPSB7CiAgICBJc1NsZWVwaW5nKCkgewogICAgICAgIHJldHVybiB0aGlzLl9Jc1NsZWVwaW5nKCkKICAgIH0sCiAgICBDb21wYXJlVmVsb2NpdHkoYSwgYiwgZCkgewogICAgICAgIGlmICghdGhpcy5faXNFbmFibGVkKSByZXR1cm4gITE7CiAgICAgICAgaWYgKDAgPT09IGEpIGEgPSB0aGlzLl9HZXRWZWxvY2l0eVgoKTsKICAgICAgICBlbHNlIGlmICgxID09PSBhKSBhID0gdGhpcy5fR2V0VmVsb2NpdHlZKCk7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGNvbnN0IFtjLCBlXSA9IHRoaXMuX0dldFZlbG9jaXR5KCk7CiAgICAgICAgICAgIGEgPSBNYXRoLmh5cG90KGMsIGUpCiAgICAgICAgfQogICAgICAgIHJldHVybiBDMyRqc2NvbXAkMzA3LmNvbXBhcmUoYSwgYiwgZCkKICAgIH0sCiAgICBDb21wYXJlQW5ndWxhclZlbG9jaXR5KGEsIGIpIHsKICAgICAgICBpZiAoIXRoaXMuX2lzRW5hYmxlZCkgcmV0dXJuICExOwogICAgICAgIGNvbnN0IGQgPSBDMyRqc2NvbXAkMzA3LnRvRGVncmVlcyh0aGlzLl9HZXRBbmd1bGFyVmVsb2NpdHkoKSk7CiAgICAgICAgcmV0dXJuIEMzJGpzY29tcCQzMDcuY29tcGFyZShkLCBhLCBiKQogICAgfSwKICAgIENvbXBhcmVNYXNzKGEsIGIpIHsKICAgICAgICBpZiAoIXRoaXMuX2lzRW5hYmxlZCkgcmV0dXJuICExOwogICAgICAgIGNvbnN0IGQgPSB0aGlzLl9HZXRNYXNzKCk7CiAgICAgICAgcmV0dXJuIEMzJGpzY29tcCQzMDcuY29tcGFyZShkLCBhLCBiKQogICAgfSwKICAgIElzRW5hYmxlZCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fSXNFbmFibGVkKCkKICAgIH0KfTsKY29uc3QgQzMkanNjb21wJDMwOCA9IHNlbGYuQzM7CkMzJGpzY29tcCQzMDguQmVoYXZpb3JzLlBoeXNpY3MuQWN0cyA9IHsKICAgIEFwcGx5Rm9yY2UoYSwgYiwgZCkgewogICAgICAgIHRoaXMuX0FwcGx5Rm9yY2UoYSwgYiwgZCkKICAgIH0sCiAgICBBcHBseUZvcmNlVG93YXJkKGEsIGIsIGQsIGMpIHsKICAgICAgICB0aGlzLl9BcHBseUZvcmNlVG93YXJkKGEsIGIsIGQsIGMpCiAgICB9LAogICAgQXBwbHlGb3JjZUF0QW5nbGUoYSwgYiwgZCkgewogICAgICAgIHRoaXMuX0FwcGx5Rm9yY2VBdEFuZ2xlKGEsIEMzJGpzY29tcCQzMDgudG9SYWRpYW5zKGIpLCBkKQogICAgfSwKICAgIEFwcGx5SW1wdWxzZShhLCBiLCBkKSB7CiAgICAgICAgdGhpcy5fQXBwbHlJbXB1bHNlKGEsIGIsIGQpCiAgICB9LAogICAgQXBwbHlJbXB1bHNlVG93YXJkKGEsIGIsIGQsIGMpIHsKICAgICAgICB0aGlzLl9BcHBseUltcHVsc2VUb3dhcmQoYSwgYiwgZCwgYykKICAgIH0sCiAgICBBcHBseUltcHVsc2VBdEFuZ2xlKGEsIGIsIGQpIHsKICAgICAgICB0aGlzLl9BcHBseUltcHVsc2VBdEFuZ2xlKGEsIEMzJGpzY29tcCQzMDgudG9SYWRpYW5zKGIpLCBkKQogICAgfSwKICAgIEFwcGx5VG9ycXVlKGEpIHsKICAgICAgICB0aGlzLl9BcHBseVRvcnF1ZShDMyRqc2NvbXAkMzA4LnRvUmFkaWFucyhhKSkKICAgIH0sCiAgICBBcHBseVRvcnF1ZVRvQW5nbGUoYSwKICAgICAgICBiKSB7CiAgICAgICAgdGhpcy5fQXBwbHlUb3JxdWVUb0FuZ2xlKEMzJGpzY29tcCQzMDgudG9SYWRpYW5zKGEpLCBDMyRqc2NvbXAkMzA4LnRvUmFkaWFucyhiKSkKICAgIH0sCiAgICBBcHBseVRvcnF1ZVRvUG9zaXRpb24oYSwgYiwgZCkgewogICAgICAgIHRoaXMuX0FwcGx5VG9ycXVlVG9Qb3NpdGlvbihDMyRqc2NvbXAkMzA4LnRvUmFkaWFucyhhKSwgYiwgZCkKICAgIH0sCiAgICBTZXRBbmd1bGFyVmVsb2NpdHkoYSkgewogICAgICAgIHRoaXMuX1NldEFuZ3VsYXJWZWxvY2l0eShDMyRqc2NvbXAkMzA4LnRvUmFkaWFucyhhKSkKICAgIH0sCiAgICBDcmVhdGVEaXN0YW5jZUpvaW50KGEsIGIsIGQsIGMsIGUpIHsKICAgICAgICBiICYmIChiID0gYi5HZXRGaXJzdFBpY2tlZCh0aGlzLl9pbnN0KSwgdGhpcy5fQ3JlYXRlRGlzdGFuY2VKb2ludChhLCBiLCBkLCBjLCBlKSkKICAgIH0sCiAgICBDcmVhdGVSZXZvbHV0ZUpvaW50KGEsIGIpIHsKICAgICAgICBiICYmIChiID0gYi5HZXRGaXJzdFBpY2tlZCh0aGlzLl9pbnN0KSwgdGhpcy5fQ3JlYXRlUmV2b2x1dGVKb2ludChhLCBiKSkKICAgIH0sCiAgICBDcmVhdGVMaW1pdGVkUmV2b2x1dGVKb2ludChhLCBiLCBkLCBjKSB7CiAgICAgICAgYiAmJiAoYiA9IGIuR2V0Rmlyc3RQaWNrZWQodGhpcy5faW5zdCksCiAgICAgICAgICAgIHRoaXMuX0NyZWF0ZUxpbWl0ZWRSZXZvbHV0ZUpvaW50KGEsIGIsIEMzJGpzY29tcCQzMDgudG9SYWRpYW5zKGQpLCBDMyRqc2NvbXAkMzA4LnRvUmFkaWFucyhjKSkpCiAgICB9LAogICAgQ3JlYXRlUHJpc21hdGljSm9pbnQoYSwgYiwgZCwgYywgZSwgZywgaywgbSwgbikgewogICAgICAgIGIgJiYgKGIgPSBiLkdldEZpcnN0UGlja2VkKHRoaXMuX2luc3QpLCB0aGlzLl9DcmVhdGVQcmlzbWF0aWNKb2ludChhLCBiLCBDMyRqc2NvbXAkMzA4LnRvUmFkaWFucyhkKSwgYywgZSwgZywgaywgQzMkanNjb21wJDMwOC50b1JhZGlhbnMobSksIG4pKQogICAgfSwKICAgIFJlbW92ZUpvaW50cygpIHsKICAgICAgICB0aGlzLl9SZW1vdmVKb2ludHMoKQogICAgfSwKICAgIFNldFdvcmxkR3Jhdml0eShhKSB7CiAgICAgICAgdGhpcy5HZXRCZWhhdmlvcigpLlNldEdyYXZpdHkoYSkKICAgIH0sCiAgICBTZXRTdGVwcGluZ01vZGUoYSkgewogICAgICAgIHRoaXMuR2V0QmVoYXZpb3IoKS5TZXRTdGVwcGluZ01vZGUoYSkKICAgIH0sCiAgICBTZXRJdGVyYXRpb25zKGEsIGIpIHsKICAgICAgICB0aGlzLkdldEJlaGF2aW9yKCkuU2V0SXRlcmF0aW9ucyhhLCBiKQogICAgfSwKICAgIFNldFZlbG9jaXR5KGEsIGIpIHsKICAgICAgICB0aGlzLl9TZXRWZWxvY2l0eShhLAogICAgICAgICAgICBiKQogICAgfSwKICAgIFNldERlbnNpdHkoYSkgewogICAgICAgIHRoaXMuX1NldERlbnNpdHkoYSkKICAgIH0sCiAgICBTZXRGcmljdGlvbihhKSB7CiAgICAgICAgdGhpcy5fU2V0RnJpY3Rpb24oYSkKICAgIH0sCiAgICBTZXRFbGFzdGljaXR5KGEpIHsKICAgICAgICB0aGlzLl9TZXRFbGFzdGljaXR5KGEpCiAgICB9LAogICAgU2V0TGluZWFyRGFtcGluZyhhKSB7CiAgICAgICAgdGhpcy5fU2V0TGluZWFyRGFtcGluZyhhKQogICAgfSwKICAgIFNldEFuZ3VsYXJEYW1waW5nKGEpIHsKICAgICAgICB0aGlzLl9TZXRBbmd1bGFyRGFtcGluZyhhKQogICAgfSwKICAgIFNldEltbW92YWJsZShhKSB7CiAgICAgICAgdGhpcy5fU2V0SW1tb3ZhYmxlKGEpCiAgICB9LAogICAgRW5hYmxlQ29sbGlzaW9ucyhhLCBiKSB7CiAgICAgICAgdGhpcy5HZXRCZWhhdmlvcigpLlNldENvbGxpc2lvbnNFbmFibGVkKHRoaXMuR2V0T2JqZWN0Q2xhc3MoKSwgYSwgMCAhPT0gYikKICAgIH0sCiAgICBTZXRQcmV2ZW50Um90YXRlKGEpIHsKICAgICAgICB0aGlzLl9TZXRQcmV2ZW50Um90YXRlKDAgIT09IGEpCiAgICB9LAogICAgU2V0QnVsbGV0KGEpIHsKICAgICAgICB0aGlzLl9TZXRCdWxsZXQoMCAhPT0gYSkKICAgIH0sCiAgICBTZXRFbmFibGVkKGEpIHsKICAgICAgICB0aGlzLl9TZXRFbmFibGVkKDAgIT09IGEpCiAgICB9Cn07CmNvbnN0IEMzJGpzY29tcCQzMDkgPSBzZWxmLkMzOwpDMyRqc2NvbXAkMzA5LkJlaGF2aW9ycy5QaHlzaWNzLkV4cHMgPSB7CiAgICBWZWxvY2l0eVgoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX0dldFZlbG9jaXR5WCgpCiAgICB9LAogICAgVmVsb2NpdHlZKCkgewogICAgICAgIHJldHVybiB0aGlzLl9HZXRWZWxvY2l0eVkoKQogICAgfSwKICAgIEFuZ3VsYXJWZWxvY2l0eSgpIHsKICAgICAgICByZXR1cm4gQzMkanNjb21wJDMwOS50b0RlZ3JlZXModGhpcy5fR2V0QW5ndWxhclZlbG9jaXR5KCkpCiAgICB9LAogICAgTWFzcygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fR2V0TWFzcygpCiAgICB9LAogICAgQ2VudGVyT2ZNYXNzWCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fR2V0Q2VudGVyT2ZNYXNzWCgpCiAgICB9LAogICAgQ2VudGVyT2ZNYXNzWSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fR2V0Q2VudGVyT2ZNYXNzWSgpCiAgICB9LAogICAgRGVuc2l0eSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fR2V0RGVuc2l0eSgpCiAgICB9LAogICAgRnJpY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX0dldEZyaWN0aW9uKCkKICAgIH0sCiAgICBFbGFzdGljaXR5KCkgewogICAgICAgIHJldHVybiB0aGlzLl9HZXRFbGFzdGljaXR5KCkKICAgIH0sCiAgICBMaW5lYXJEYW1waW5nKCkgewogICAgICAgIHJldHVybiB0aGlzLl9HZXRMaW5lYXJEYW1waW5nKCkKICAgIH0sCiAgICBBbmd1bGFyRGFtcGluZygpIHsKICAgICAgICByZXR1cm4gdGhpcy5fR2V0QW5ndWxhckRhbXBpbmcoKQogICAgfSwKICAgIENvbnRhY3RDb3VudCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fR2V0Q29udGFjdENvdW50KCkKICAgIH0sCiAgICBDb250YWN0WEF0KGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5fR2V0Q29udGFjdFBvc2l0aW9uQXQoYSlbMF0KICAgIH0sCiAgICBDb250YWN0WUF0KGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5fR2V0Q29udGFjdFBvc2l0aW9uQXQoYSlbMV0KICAgIH0KfTsKInVzZSBzdHJpY3QiOwpjb25zdCBDMyRqc2NvbXAkMzEwID0gc2VsZi5DMywKICAgIGIyU2VwYXJhdG9yID0ge307CkMzJGpzY29tcCQzMTAuQmVoYXZpb3JzLlBoeXNpY3MuU2VwYXJhdG9yID0gYjJTZXBhcmF0b3I7CmNvbnN0IEdldFZlYzIkanNjb21wJDEgPSBDMyRqc2NvbXAkMzEwLkJlaGF2aW9ycy5QaHlzaWNzLkdldFZlYzIsCiAgICBGcmVlVmVjMiRqc2NvbXAkMSA9IEMzJGpzY29tcCQzMTAuQmVoYXZpb3JzLlBoeXNpY3MuRnJlZVZlYzI7CgpmdW5jdGlvbiBDbG9uZVZlYzIoYSkgewogICAgcmV0dXJuIEdldFZlYzIkanNjb21wJDEoYS5nZXRfeCgpLCBhLmdldF95KCkpCn0KYjJTZXBhcmF0b3IuZGV0ID0gZnVuY3Rpb24oYSwgYiwgZCwgYywgZSwgZykgewogICAgcmV0dXJuIGEgKiBjICsgZCAqIGcgKyBlICogYiAtIGIgKiBkIC0gYyAqIGUgLSBnICogYQp9OwpiMlNlcGFyYXRvci5oaXRSYXkgPSBmdW5jdGlvbihhLCBiLCBkLCBjLCBlLCBnLCBrLCBtKSB7CiAgICB2YXIgbiA9IGQgLSBhLAogICAgICAgIHEgPSBjIC0gYiwKICAgICAgICB1ID0gayAtIGU7CiAgICBjb25zdCB3ID0gbSAtIGc7CiAgICB1ID0gKHUgKiAoZyAtIGIpIC0gdyAqIChlIC0gYSkpIC8gKHEgKiB1IC0gbiAqIHcpOwogICAgbiA9IGEgKyB1ICogbjsKICAgIHEgPSBiICsgdSAqIHE7CiAgICBhID0gYjJTZXBhcmF0b3IuaXNPblNlZ21lbnQoZCwgYywgYSwgYiwgbiwgcSk7CiAgICBlID0gYjJTZXBhcmF0b3IuaXNPblNlZ21lbnQobiwgcSwgZSwgZywgaywgbSk7CiAgICByZXR1cm4gYSAmJiBlID8gR2V0VmVjMiRqc2NvbXAkMShuLCBxKSA6IG51bGwKfTsKYjJTZXBhcmF0b3IuaXNPblNlZ21lbnQgPSBmdW5jdGlvbihhLCBiLCBkLCBjLCBlLCBnKSB7CiAgICByZXR1cm4gKGQgKyAuMSA+PSBhICYmIGEgPj0gZSAtIC4xIHx8IGQgLSAuMSA8PSBhICYmIGEgPD0gZSArIC4xKSAmJiAoYyArIC4xID49IGIgJiYgYiA+PSBnIC0gLjEgfHwgYyAtIC4xIDw9IGIgJiYgYiA8PSBnICsgLjEpICYmIGIyU2VwYXJhdG9yLmlzT25MaW5lKGEsIGIsIGQsIGMsIGUsIGcpCn07CmIyU2VwYXJhdG9yLmlzT25MaW5lID0gZnVuY3Rpb24oYSwgYiwgZCwgYywgZSwgZykgewogICAgcmV0dXJuIC4xIDwgTWF0aC5hYnMoZSAtIGQpID8gLjEgPiBNYXRoLmFicygoZyAtIGMpIC8gKGUgLSBkKSAqIChhIC0gZCkgKyBjIC0gYikgOiAuMSA+IE1hdGguYWJzKGEgLSBkKQp9OwpiMlNlcGFyYXRvci5wb2ludHNNYXRjaCA9IGZ1bmN0aW9uKGEsIGIsIGQsIGMpIHsKICAgIHJldHVybiAuMSA+IE1hdGguYWJzKGQgLSBhKSAmJiAuMSA+IE1hdGguYWJzKGMgLSBiKQp9OwpiMlNlcGFyYXRvci5TZXBhcmF0ZSA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgIGEgPSBiMlNlcGFyYXRvci5jYWxjU2hhcGVzKGEpOwogICAgbGV0IGQgPSBbXTsKICAgIGZvciAobGV0IGMgPSAwLCBlID0gYS5sZW5ndGg7IGMgPCBlOyArK2MpIHsKICAgICAgICBjb25zdCBnID0gYVtjXSwKICAgICAgICAgICAgayA9IFtdOwogICAgICAgIGxldCBtID0gMDsKICAgICAgICBmb3IgKGxldCBuID0gMCwgcSA9IGcubGVuZ3RoOyBuIDwgcTsgKytuKSB7CiAgICAgICAgICAgIGNvbnN0IHUgPSBnW25dLAogICAgICAgICAgICAgICAgdyA9IGdbKG4gKyAxKSAlIHFdOwogICAgICAgICAgICBtICs9IHUuZ2V0X3goKSAqIHcuZ2V0X3koKSAtIHUuZ2V0X3koKSAqIHcuZ2V0X3goKTsKICAgICAgICAgICAgay5wdXNoKEdldFZlYzIkanNjb21wJDEodS5nZXRfeCgpLCB1LmdldF95KCkpKQogICAgICAgIH0KICAgICAgICBtID0gTWF0aC5hYnMobSAvIDIpOwogICAgICAgIGlmIChtID49IC4wMDEgKiBiKSBkLnB1c2goayk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBmb3IgKGxldCBuID0gMCwgcSA9IGsubGVuZ3RoOyBuIDwgcTsgbisrKSBGcmVlVmVjMiRqc2NvbXAkMShrW25dKQogICAgfQogICAgcmV0dXJuIGQgPSBTcGxpdENvbnZleFBvbHlzT3ZlcjhQb2ludHMoZCkKfTsKYjJTZXBhcmF0b3IuY2FsY1NoYXBlcyA9IGZ1bmN0aW9uKGEpIHsKICAgIHZhciBiOwogICAgbGV0IGQ7CiAgICB2YXIgYzsKICAgIGxldCBlOwogICAgbGV0IGcsIGssIG0sIG47CiAgICBsZXQgcTsKICAgIHZhciB1ID0gMDsKICAgIGxldCB3ID0gMCwKICAgICAgICB6LCBDID0gW10sCiAgICAgICAgRCA9IFtdOwogICAgZm9yIChELnB1c2goYSk7IEQubGVuZ3RoOykgewogICAgICAgIGEgPSBEWzBdOwogICAgICAgIGQgPSBhLmxlbmd0aDsKICAgICAgICB6ID0gITA7CiAgICAgICAgZm9yIChiID0gMDsgYiA8IGQ7IGIrKykgewogICAgICAgICAgICBnID0gYjsKICAgICAgICAgICAgayA9IGIgPCBkIC0gMSA/IGIgKyAxIDogYiArIDEgLSBkOwogICAgICAgICAgICB2YXIgRiA9IGIgPCBkIC0gMiA/IGIgKyAyIDogYiArIDIgLSBkOwogICAgICAgICAgICBtID0gYVtnXTsKICAgICAgICAgICAgbiA9IGFba107CiAgICAgICAgICAgIEYgPSBhW0ZdOwogICAgICAgICAgICBGID0gYjJTZXBhcmF0b3IuZGV0KG0uZ2V0X3goKSwgbS5nZXRfeSgpLCBuLmdldF94KCksIG4uZ2V0X3koKSwgRi5nZXRfeCgpLCBGLmdldF95KCkpOwogICAgICAgICAgICBpZiAoMCA+IEYpIHsKICAgICAgICAgICAgICAgIHogPSAhMTsKICAgICAgICAgICAgICAgIHZhciBFID0gMUU5OwogICAgICAgICAgICAgICAgZm9yIChjID0gMDsgYyA8IGQ7IGMrKykKICAgICAgICAgICAgICAgICAgICBpZiAoYyAhPT0gZyAmJiBjICE9PSBrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGIgPSBjOwogICAgICAgICAgICAgICAgICAgICAgICBGID0gYyA8IGQgLSAxID8gYyArIDEgOiAwOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgSiA9IGFbYl07CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBLID0gYVtGXTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEogPSBiMlNlcGFyYXRvci5oaXRSYXkobS5nZXRfeCgpLCBtLmdldF95KCksIG4uZ2V0X3goKSwgbi5nZXRfeSgpLCBKLmdldF94KCksIEouZ2V0X3koKSwgSy5nZXRfeCgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEsuZ2V0X3koKSkpIEsgPSBuLmdldF94KCkgLSBKLmdldF94KCksIGUgPSBuLmdldF95KCkgLSBKLmdldF95KCksIEsgPSBLICogSyArIGUgKiBlLCBLIDwgRSA/ICh3ID0gYiwgdSA9IEYsIHEgPSBKLCBFID0gSykgOiBGcmVlVmVjMiRqc2NvbXAkMShKKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICgxRTkgPT09IEUpIHJldHVybiBbXTsKICAgICAgICAgICAgICAgIGMgPSBbXTsKICAgICAgICAgICAgICAgIEUgPSBbXTsKICAgICAgICAgICAgICAgIGIgPSB3OwogICAgICAgICAgICAgICAgRiA9IHU7CiAgICAgICAgICAgICAgICBKID0gYVtiXTsKICAgICAgICAgICAgICAgIEsgPSBhW0ZdOwogICAgICAgICAgICAgICAgdSA9ICExOwogICAgICAgICAgICAgICAgYjJTZXBhcmF0b3IucG9pbnRzTWF0Y2gocS5nZXRfeCgpLCBxLmdldF95KCksIEsuZ2V0X3goKSwgSy5nZXRfeSgpKSB8fCAoYy5wdXNoKHEpLCB1ID0gITApOwogICAgICAgICAgICAgICAgYjJTZXBhcmF0b3IucG9pbnRzTWF0Y2gocS5nZXRfeCgpLCBxLmdldF95KCksIEouZ2V0X3goKSwgSi5nZXRfeSgpKSB8fCAoRS5wdXNoKHEpLCB1ID0gITApOwogICAgICAgICAgICAgICAgdSB8fCBGcmVlVmVjMiRqc2NvbXAkMShxKTsKICAgICAgICAgICAgICAgIHcgPSAtMTsKICAgICAgICAgICAgICAgIGZvciAodSA9IGc7OykgewogICAgICAgICAgICAgICAgICAgIGlmICh1ICE9PSBGKSBjLnB1c2goYVt1XSk7CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgwID4gdyB8fCB3ID49IGQpIHJldHVybiBbXTsKICAgICAgICAgICAgICAgICAgICAgICAgYjJTZXBhcmF0b3IuaXNPblNlZ21lbnQoSy5nZXRfeCgpLCBLLmdldF95KCksIGFbd10uZ2V0X3goKSwgYVt3XS5nZXRfeSgpLCBtLmdldF94KCksIG0uZ2V0X3koKSkgfHwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMucHVzaChhW3VdKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdyA9IHU7CiAgICAgICAgICAgICAgICAgICAgMCA+IHUgLSAxID8gdSA9IGQgLSAxIDogdS0tCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjLnJldmVyc2UoKTsKICAgICAgICAgICAgICAgIHcgPSAtMTsKICAgICAgICAgICAgICAgIGZvciAodSA9IGs7OykgewogICAgICAgICAgICAgICAgICAgIGlmICh1ICE9PSBiKSBFLnB1c2goYVt1XSk7CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgwID4gdyB8fCB3ID49IGQpIHJldHVybiBbXTsKICAgICAgICAgICAgICAgICAgICAgICAgdSAhPT0gYiB8fCBiMlNlcGFyYXRvci5pc09uU2VnbWVudChKLmdldF94KCksIEouZ2V0X3koKSwgYVt3XS5nZXRfeCgpLCBhW3ddLmdldF95KCksIG4uZ2V0X3goKSwgbi5nZXRfeSgpKSB8fCBFLnB1c2goYVt1XSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHcgPSB1OwogICAgICAgICAgICAgICAgICAgIHUgKyAxID4gZCAtIDEgPyB1ID0gMCA6IHUrKwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgRC5wdXNoKGMsIEUpOwogICAgICAgICAgICAgICAgRC5zaGlmdCgpOwogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB6ICYmIEMucHVzaChELnNoaWZ0KCkpCiAgICB9CiAgICByZXR1cm4gQwp9OwoKZnVuY3Rpb24gU3BsaXRDb252ZXhQb2x5c092ZXI4UG9pbnRzKGEpIHsKICAgIGNvbnN0IGIgPSBbXTsKICAgIGZvciAoY29uc3QgZCBvZiBhKSA4ID49IGQubGVuZ3RoID8gYi5wdXNoKGQpIDogYi5wdXNoLmFwcGx5KGIsIFNwbGl0Q29udmV4UG9seShkKSk7CiAgICByZXR1cm4gYgp9CgpmdW5jdGlvbiBTcGxpdENvbnZleFBvbHkoYSkgewogICAgY29uc3QgYiA9IFtdOwogICAgYi5wdXNoKGEuc3BsaWNlKDAsIDgpKTsKICAgIGNvbnN0IGQgPSBiWzBdWzBdOwogICAgbGV0IGMgPSBiWzBdWzddOwogICAgZm9yICg7IGEubGVuZ3RoOykgewogICAgICAgIGNvbnN0IGUgPSBhLnNwbGljZSgwLCBNYXRoLm1pbihhLmxlbmd0aCwgNikpOwogICAgICAgIGxldCBnID0gZS5hdCgtMSk7CiAgICAgICAgZS5wdXNoKENsb25lVmVjMihkKSk7CiAgICAgICAgZS5wdXNoKENsb25lVmVjMihjKSk7CiAgICAgICAgYi5wdXNoKGUpOwogICAgICAgIGMgPSBnCiAgICB9CiAgICByZXR1cm4gYgp9CmNvbnN0IEMzJGpzY29tcCQzMTEgPSBzZWxmLkMzOwpzZWxmLkMzX0dldE9iamVjdFJlZlRhYmxlID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gW0MzJGpzY29tcCQzMTEuUGx1Z2lucy5TcHJpdGUsIEMzJGpzY29tcCQzMTEuQmVoYXZpb3JzLlR3ZWVuLCBDMyRqc2NvbXAkMzExLlBsdWdpbnMuUGFydGljbGVzLCBDMyRqc2NvbXAkMzExLkJlaGF2aW9ycy5kZXN0cm95LCBDMyRqc2NvbXAkMzExLkJlaGF2aW9ycy5CdWxsZXQsIEMzJGpzY29tcCQzMTEuUGx1Z2lucy5UZXh0LCBDMyRqc2NvbXAkMzExLlBsdWdpbnMuVGV4dEJveCwgQzMkanNjb21wJDMxMS5QbHVnaW5zLkFyciwgQzMkanNjb21wJDMxMS5CZWhhdmlvcnMuUm90YXRlLCBDMyRqc2NvbXAkMzExLkJlaGF2aW9ycy5GYWRlLCBDMyRqc2NvbXAkMzExLkJlaGF2aW9ycy5QaW4sIEMzJGpzY29tcCQzMTEuQmVoYXZpb3JzLlBoeXNpY3MsIEMzJGpzY29tcCQzMTEuUGx1Z2lucy5BdWRpbywgQzMkanNjb21wJDMxMS5QbHVnaW5zLkJyb3dzZXIsIEMzJGpzY29tcCQzMTEuUGx1Z2lucy5FcG9uZXNoX0dhbWVTY29yZSwgQzMkanNjb21wJDMxMS5QbHVnaW5zLktleWJvYXJkLAogICAgICAgIEMzJGpzY29tcCQzMTEuUGx1Z2lucy5Mb2NhbFN0b3JhZ2UsIEMzJGpzY29tcCQzMTEuUGx1Z2lucy5QbGF0Zm9ybUluZm8sIEMzJGpzY29tcCQzMTEuUGx1Z2lucy5Ub3VjaCwgQzMkanNjb21wJDMxMS5QbHVnaW5zLkdhbWVBbmFseXRpY3MsIEMzJGpzY29tcCQzMTEuUGx1Z2lucy5BSkFYLCBDMyRqc2NvbXAkMzExLlBsdWdpbnMuRGljdGlvbmFyeSwgQzMkanNjb21wJDMxMS5QbHVnaW5zLnNreW1lbl9SZW1vdmVTZXJ2aWNlV29ya2VyLCBDMyRqc2NvbXAkMzExLlBsdWdpbnMuRXBvbmVzaF9HYW1lU2NvcmUuQ25kcy5Jc0Fkc0Z1bGxzY3JlZW5QbGF5aW5nLCBDMyRqc2NvbXAkMzExLlBsdWdpbnMuQXVkaW8uQWN0cy5TZXRTaWxlbnQsIEMzJGpzY29tcCQzMTEuUGx1Z2lucy5FcG9uZXNoX0dhbWVTY29yZS5DbmRzLk9uQWRzRnVsbHNjcmVlbkNsb3NlLCBDMyRqc2NvbXAkMzExLlBsdWdpbnMuU3lzdGVtLkNuZHMuQ29tcGFyZVZhciwgQzMkanNjb21wJDMxMS5QbHVnaW5zLlN5c3RlbS5DbmRzLklzR3JvdXBBY3RpdmUsCiAgICAgICAgQzMkanNjb21wJDMxMS5QbHVnaW5zLlN5c3RlbS5DbmRzLlRyaWdnZXJPbmNlLCBDMyRqc2NvbXAkMzExLlBsdWdpbnMuU3ByaXRlLkFjdHMuU2V0QW5pbSwgQzMkanNjb21wJDMxMS5QbHVnaW5zLkF1ZGlvLkFjdHMuU3RvcEFsbCwgQzMkanNjb21wJDMxMS5QbHVnaW5zLkxvY2FsU3RvcmFnZS5BY3RzLlNldEl0ZW0sIEMzJGpzY29tcCQzMTEuUGx1Z2lucy5BdWRpby5BY3RzLlBsYXksIEMzJGpzY29tcCQzMTEuUGx1Z2lucy5TeXN0ZW0uQWN0cy5TZXRWYXIsIEMzJGpzY29tcCQzMTEuUGx1Z2lucy5TeXN0ZW0uRXhwcy5yYW5kb20sIEMzJGpzY29tcCQzMTEuUGx1Z2lucy5TcHJpdGUuQWN0cy5TZXRBbmltRnJhbWUsIEMzJGpzY29tcCQzMTEuUGx1Z2lucy5TcHJpdGUuQWN0cy5TZXRQb3NUb09iamVjdCwgQzMkanNjb21wJDMxMS5CZWhhdmlvcnMuUGluLkFjdHMuUGluQnlJbWFnZVBvaW50LCBDMyRqc2NvbXAkMzExLlBsdWdpbnMuU3lzdGVtLkNuZHMuQ29tcGFyZUJvb2xWYXIsIEMzJGpzY29tcCQzMTEuUGx1Z2lucy5TcHJpdGUuQWN0cy5TZXREZWZhdWx0Q29sb3IsCiAgICAgICAgQzMkanNjb21wJDMxMS5QbHVnaW5zLlN5c3RlbS5DbmRzLkVsc2UsIEMzJGpzY29tcCQzMTEuUGx1Z2lucy5TeXN0ZW0uRXhwcy5pbnQsIEMzJGpzY29tcCQzMTEuUGx1Z2lucy5EaWN0aW9uYXJ5LkV4cHMuR2V0LCBDMyRqc2NvbXAkMzExLlBsdWdpbnMuVGV4dC5BY3RzLlNldFRleHQsIEMzJGpzY29tcCQzMTEuUGx1Z2lucy5FcG9uZXNoX0dhbWVTY29yZS5FeHBzLlBsYXllck5hbWUsIEMzJGpzY29tcCQzMTEuUGx1Z2lucy5TeXN0ZW0uQ25kcy5PbkxheW91dFN0YXJ0LCBDMyRqc2NvbXAkMzExLlBsdWdpbnMuU3lzdGVtLkFjdHMuU2V0TGF5ZXJJbnRlcmFjdGl2ZSwgQzMkanNjb21wJDMxMS5QbHVnaW5zLlN5c3RlbS5BY3RzLlNldExheWVyVmlzaWJsZSwgQzMkanNjb21wJDMxMS5QbHVnaW5zLlNwcml0ZS5BY3RzLlNldFZpc2libGUsIEMzJGpzY29tcCQzMTEuUGx1Z2lucy5UZXh0LkFjdHMuU2V0Rm9udENvbG9yLCBDMyRqc2NvbXAkMzExLlBsdWdpbnMuU3lzdGVtLkV4cHMucmdiZXgyNTUsIEMzJGpzY29tcCQzMTEuUGx1Z2lucy5UZXh0LkFjdHMuU2V0VmlzaWJsZSwKICAgICAgICBDMyRqc2NvbXAkMzExLlBsdWdpbnMuU3ByaXRlLkFjdHMuU2V0U2l6ZSwgQzMkanNjb21wJDMxMS5QbHVnaW5zLlNwcml0ZS5BY3RzLlNldFBvcywgQzMkanNjb21wJDMxMS5CZWhhdmlvcnMuVHdlZW4uQWN0cy5Ud2VlblR3b1Byb3BlcnRpZXMsIEMzJGpzY29tcCQzMTEuUGx1Z2lucy5TeXN0ZW0uQWN0cy5XYWl0LCBDMyRqc2NvbXAkMzExLlBsdWdpbnMuVGV4dC5BY3RzLlNldEZvbnRTaXplLCBDMyRqc2NvbXAkMzExLlBsdWdpbnMuVGV4dC5BY3RzLlNldFBvcywgQzMkanNjb21wJDMxMS5CZWhhdmlvcnMuVHdlZW4uQWN0cy5Ud2VlblZhbHVlLCBDMyRqc2NvbXAkMzExLkJlaGF2aW9ycy5Ud2Vlbi5DbmRzLklzUGxheWluZywgQzMkanNjb21wJDMxMS5CZWhhdmlvcnMuVHdlZW4uRXhwcy5WYWx1ZSwgQzMkanNjb21wJDMxMS5QbHVnaW5zLlBhcnRpY2xlcy5BY3RzLlNldFBvcywgQzMkanNjb21wJDMxMS5QbHVnaW5zLlNwcml0ZS5FeHBzLlgsIEMzJGpzY29tcCQzMTEuUGx1Z2lucy5TcHJpdGUuRXhwcy5ZLAogICAgICAgIEMzJGpzY29tcCQzMTEuUGx1Z2lucy5TeXN0ZW0uQ25kcy5QaWNrQnlDb21wYXJpc29uLCBDMyRqc2NvbXAkMzExLlBsdWdpbnMuU3ByaXRlLkV4cHMuVUlELCBDMyRqc2NvbXAkMzExLlBsdWdpbnMuUGFydGljbGVzLkFjdHMuU2V0VmlzaWJsZSwgQzMkanNjb21wJDMxMS5QbHVnaW5zLlN5c3RlbS5DbmRzLkV2ZXJ5VGljaywgQzMkanNjb21wJDMxMS5QbHVnaW5zLlNwcml0ZS5FeHBzLkltYWdlUG9pbnRYLCBDMyRqc2NvbXAkMzExLlBsdWdpbnMuU3ByaXRlLkV4cHMuSW1hZ2VQb2ludFksIEMzJGpzY29tcCQzMTEuUGx1Z2lucy5TeXN0ZW0uQWN0cy5TZXRCb29sVmFyLCBDMyRqc2NvbXAkMzExLlBsdWdpbnMuVG91Y2guQ25kcy5PblRvdWNoT2JqZWN0LCBDMyRqc2NvbXAkMzExLkJlaGF2aW9ycy5Ud2Vlbi5BY3RzLlR3ZWVuT25lUHJvcGVydHksIEMzJGpzY29tcCQzMTEuUGx1Z2lucy5TcHJpdGUuRXhwcy5XaWR0aCwgQzMkanNjb21wJDMxMS5QbHVnaW5zLlNwcml0ZS5FeHBzLkhlaWdodCwgQzMkanNjb21wJDMxMS5CZWhhdmlvcnMuUGluLkFjdHMuUGluLAogICAgICAgIEMzJGpzY29tcCQzMTEuQmVoYXZpb3JzLlBoeXNpY3MuQWN0cy5FbmFibGVDb2xsaXNpb25zLCBDMyRqc2NvbXAkMzExLkJlaGF2aW9ycy5QaHlzaWNzLkFjdHMuU2V0V29ybGRHcmF2aXR5LCBDMyRqc2NvbXAkMzExLlBsdWdpbnMuU3lzdGVtLkFjdHMuQWRkVmFyLCBDMyRqc2NvbXAkMzExLlBsdWdpbnMuU3lzdGVtLkFjdHMuU2V0VGltZXNjYWxlLCBDMyRqc2NvbXAkMzExLlBsdWdpbnMuU3ByaXRlLkFjdHMuRGVzdHJveSwgQzMkanNjb21wJDMxMS5QbHVnaW5zLlN5c3RlbS5FeHBzLmNob29zZSwgQzMkanNjb21wJDMxMS5QbHVnaW5zLlN5c3RlbS5DbmRzLkNvbXBhcmUsIEMzJGpzY29tcCQzMTEuUGx1Z2lucy5TeXN0ZW0uQ25kcy5XaGlsZSwgQzMkanNjb21wJDMxMS5QbHVnaW5zLkFyci5FeHBzLldpZHRoLCBDMyRqc2NvbXAkMzExLlBsdWdpbnMuQXJyLkNuZHMuQ29udGFpbnMsIEMzJGpzY29tcCQzMTEuUGx1Z2lucy5BcnIuQWN0cy5TZXRYLCBDMyRqc2NvbXAkMzExLlBsdWdpbnMuR2FtZUFuYWx5dGljcy5BY3RzLmFkZFByb2dyZXNzaW9uRXZlbnQsCiAgICAgICAgQzMkanNjb21wJDMxMS5QbHVnaW5zLlN5c3RlbS5BY3RzLlNldEdyb3VwQWN0aXZlLCBDMyRqc2NvbXAkMzExLlBsdWdpbnMuQXJyLkV4cHMuQXQsIEMzJGpzY29tcCQzMTEuUGx1Z2lucy5TcHJpdGUuQWN0cy5TZXRYLCBDMyRqc2NvbXAkMzExLlBsdWdpbnMuU3lzdGVtLkNuZHMuUGlja0FsbCwgQzMkanNjb21wJDMxMS5QbHVnaW5zLlN5c3RlbS5DbmRzLlBpY2tCeUV2YWx1YXRlLCBDMyRqc2NvbXAkMzExLlBsdWdpbnMuU3ByaXRlLkV4cHMuTGF5ZXJOYW1lLCBDMyRqc2NvbXAkMzExLkJlaGF2aW9ycy5QaHlzaWNzLkFjdHMuU2V0RW5hYmxlZCwgQzMkanNjb21wJDMxMS5QbHVnaW5zLlNwcml0ZS5BY3RzLlNldENvbGxpc2lvbnMsIEMzJGpzY29tcCQzMTEuQmVoYXZpb3JzLlR3ZWVuLkFjdHMuU2V0RW5hYmxlZCwgQzMkanNjb21wJDMxMS5CZWhhdmlvcnMuVHdlZW4uQ25kcy5PblR3ZWVuc0ZpbmlzaGVkLCBDMyRqc2NvbXAkMzExLkJlaGF2aW9ycy5Ud2Vlbi5BY3RzLlN0b3BBbGxUd2VlbnMsIEMzJGpzY29tcCQzMTEuUGx1Z2lucy5TcHJpdGUuQ25kcy5PbkNvbGxpc2lvbiwKICAgICAgICBDMyRqc2NvbXAkMzExLkJlaGF2aW9ycy5QaHlzaWNzLkFjdHMuU2V0VmVsb2NpdHksIEMzJGpzY29tcCQzMTEuQmVoYXZpb3JzLlBoeXNpY3MuQWN0cy5BcHBseUZvcmNlQXRBbmdsZSwgQzMkanNjb21wJDMxMS5QbHVnaW5zLlNwcml0ZS5FeHBzLkFuZ2xlLCBDMyRqc2NvbXAkMzExLlBsdWdpbnMuQXVkaW8uQ25kcy5Jc1RhZ1BsYXlpbmcsIEMzJGpzY29tcCQzMTEuUGx1Z2lucy5TcHJpdGUuQ25kcy5PbkNyZWF0ZWQsIEMzJGpzY29tcCQzMTEuUGx1Z2lucy5TeXN0ZW0uQ25kcy5MYXllclZpc2libGUsIEMzJGpzY29tcCQzMTEuUGx1Z2lucy5TcHJpdGUuQ25kcy5Jc09uTGF5ZXIsIEMzJGpzY29tcCQzMTEuUGx1Z2lucy5TcHJpdGUuQWN0cy5TZXRUb3dhcmRQb3NpdGlvbiwgQzMkanNjb21wJDMxMS5QbHVnaW5zLlN5c3RlbS5DbmRzLkV2ZXJ5LCBDMyRqc2NvbXAkMzExLlBsdWdpbnMuU3lzdGVtLkFjdHMuQ3JlYXRlT2JqZWN0LCBDMyRqc2NvbXAkMzExLkJlaGF2aW9ycy5CdWxsZXQuQWN0cy5TZXRBbmdsZU9mTW90aW9uLAogICAgICAgIEMzJGpzY29tcCQzMTEuQmVoYXZpb3JzLkJ1bGxldC5BY3RzLlNldFNwZWVkLCBDMyRqc2NvbXAkMzExLlBsdWdpbnMuU3ByaXRlLkNuZHMuSXNCb29sSW5zdGFuY2VWYXJTZXQsIEMzJGpzY29tcCQzMTEuUGx1Z2lucy5TcHJpdGUuQWN0cy5TZXRCb29sSW5zdGFuY2VWYXIsIEMzJGpzY29tcCQzMTEuQmVoYXZpb3JzLlBoeXNpY3MuQWN0cy5SZW1vdmVKb2ludHMsIEMzJGpzY29tcCQzMTEuUGx1Z2lucy5TcHJpdGUuQWN0cy5TZXRBbmdsZSwgQzMkanNjb21wJDMxMS5CZWhhdmlvcnMuUGh5c2ljcy5BY3RzLkNyZWF0ZUxpbWl0ZWRSZXZvbHV0ZUpvaW50LCBDMyRqc2NvbXAkMzExLkJlaGF2aW9ycy5QaHlzaWNzLkFjdHMuQ3JlYXRlUmV2b2x1dGVKb2ludCwgQzMkanNjb21wJDMxMS5QbHVnaW5zLlNwcml0ZS5DbmRzLklzT3ZlcmxhcHBpbmcsIEMzJGpzY29tcCQzMTEuQmVoYXZpb3JzLlBoeXNpY3MuQWN0cy5BcHBseUltcHVsc2UsIEMzJGpzY29tcCQzMTEuUGx1Z2lucy5TcHJpdGUuQ25kcy5Db21wYXJlSW5zdGFuY2VWYXIsCiAgICAgICAgQzMkanNjb21wJDMxMS5CZWhhdmlvcnMuUGh5c2ljcy5FeHBzLlZlbG9jaXR5WSwgQzMkanNjb21wJDMxMS5CZWhhdmlvcnMuUGh5c2ljcy5FeHBzLlZlbG9jaXR5WCwgQzMkanNjb21wJDMxMS5CZWhhdmlvcnMuUGh5c2ljcy5BY3RzLlNldEltbW92YWJsZSwgQzMkanNjb21wJDMxMS5QbHVnaW5zLlN5c3RlbS5BY3RzLkdvVG9MYXlvdXQsIEMzJGpzY29tcCQzMTEuUGx1Z2lucy5TeXN0ZW0uQWN0cy5XYWl0Rm9yUHJldmlvdXNBY3Rpb25zLCBDMyRqc2NvbXAkMzExLlBsdWdpbnMuR2FtZUFuYWx5dGljcy5BY3RzLmFkZERlc2lnbkV2ZW50LCBDMyRqc2NvbXAkMzExLlBsdWdpbnMuS2V5Ym9hcmQuQ25kcy5PbktleSwgQzMkanNjb21wJDMxMS5QbHVnaW5zLkVwb25lc2hfR2FtZVNjb3JlLkFjdHMuUGxheWVyU2V0U2NvcmUsIEMzJGpzY29tcCQzMTEuUGx1Z2lucy5FcG9uZXNoX0dhbWVTY29yZS5BY3RzLlBsYXllclN5bmMsIEMzJGpzY29tcCQzMTEuUGx1Z2lucy5UZXh0LkV4cHMuVGV4dCwgQzMkanNjb21wJDMxMS5QbHVnaW5zLlNwcml0ZS5DbmRzLklzVmlzaWJsZSwKICAgICAgICBDMyRqc2NvbXAkMzExLlBsdWdpbnMuRXBvbmVzaF9HYW1lU2NvcmUuRXhwcy5QbGF5ZXJTY29yZSwgQzMkanNjb21wJDMxMS5QbHVnaW5zLkVwb25lc2hfR2FtZVNjb3JlLkFjdHMuTGVhZGVyYm9hcmRPcGVuLCBDMyRqc2NvbXAkMzExLlBsdWdpbnMuU3ByaXRlLkNuZHMuT25BbmltRmluaXNoZWQsIEMzJGpzY29tcCQzMTEuUGx1Z2lucy5LZXlib2FyZC5DbmRzLklzS2V5RG93biwgQzMkanNjb21wJDMxMS5QbHVnaW5zLlNwcml0ZS5DbmRzLkNvbXBhcmVYLCBDMyRqc2NvbXAkMzExLlBsdWdpbnMuVG91Y2guQ25kcy5Jc1RvdWNoaW5nT2JqZWN0LCBDMyRqc2NvbXAkMzExLlBsdWdpbnMuU3ByaXRlLkNuZHMuQ29tcGFyZVksIEMzJGpzY29tcCQzMTEuUGx1Z2lucy5TeXN0ZW0uRXhwcy5kdCwgQzMkanNjb21wJDMxMS5CZWhhdmlvcnMuUm90YXRlLkFjdHMuU2V0U3BlZWQsIEMzJGpzY29tcCQzMTEuUGx1Z2lucy5TcHJpdGUuQWN0cy5TZXRXaWR0aCwgQzMkanNjb21wJDMxMS5QbHVnaW5zLlNwcml0ZS5DbmRzLkNvbXBhcmVXaWR0aCwKICAgICAgICBDMyRqc2NvbXAkMzExLlBsdWdpbnMuU3ByaXRlLkNuZHMuSXNPdmVybGFwcGluZ09mZnNldCwgQzMkanNjb21wJDMxMS5CZWhhdmlvcnMuUGh5c2ljcy5BY3RzLlNldEFuZ3VsYXJWZWxvY2l0eSwgQzMkanNjb21wJDMxMS5CZWhhdmlvcnMuUGh5c2ljcy5BY3RzLkFwcGx5Rm9yY2VUb3dhcmQsIEMzJGpzY29tcCQzMTEuUGx1Z2lucy5TcHJpdGUuQWN0cy5TcGF3biwgQzMkanNjb21wJDMxMS5QbHVnaW5zLkF1ZGlvLkFjdHMuU3RvcCwgQzMkanNjb21wJDMxMS5QbHVnaW5zLlNwcml0ZS5BY3RzLlNldFNjYWxlLCBDMyRqc2NvbXAkMzExLlBsdWdpbnMuVGV4dC5BY3RzLlNldEZvbnRGYWNlLCBDMyRqc2NvbXAkMzExLlBsdWdpbnMuRXBvbmVzaF9HYW1lU2NvcmUuQWN0cy5QbGF5ZXJTZXROYW1lLCBDMyRqc2NvbXAkMzExLlBsdWdpbnMuRXBvbmVzaF9HYW1lU2NvcmUuRXhwcy5QbGF5ZXJJRCwgQzMkanNjb21wJDMxMS5QbHVnaW5zLkVwb25lc2hfR2FtZVNjb3JlLkFjdHMuUGxheWVyU2V0QXZhdGFyLAogICAgICAgIEMzJGpzY29tcCQzMTEuUGx1Z2lucy5Ub3VjaC5DbmRzLk9uVGFwR2VzdHVyZU9iamVjdCwgQzMkanNjb21wJDMxMS5QbHVnaW5zLlN5c3RlbS5DbmRzLkZvciwgQzMkanNjb21wJDMxMS5QbHVnaW5zLlN5c3RlbS5FeHBzLmxvb3BpbmRleCwgQzMkanNjb21wJDMxMS5QbHVnaW5zLkFyci5DbmRzLkNvbXBhcmVYLCBDMyRqc2NvbXAkMzExLlBsdWdpbnMuU3lzdGVtLkV4cHMudXBwZXJjYXNlLCBDMyRqc2NvbXAkMzExLlBsdWdpbnMuVGV4dC5BY3RzLkRlc3Ryb3ksIEMzJGpzY29tcCQzMTEuUGx1Z2lucy5UZXh0LkNuZHMuQ29tcGFyZVRleHQsIEMzJGpzY29tcCQzMTEuUGx1Z2lucy5UZXh0Qm94LkFjdHMuU2V0VGV4dCwgQzMkanNjb21wJDMxMS5QbHVnaW5zLlRleHRCb3guQWN0cy5TZXRNYXhMZW5ndGgsIEMzJGpzY29tcCQzMTEuUGx1Z2lucy5UZXh0Qm94LkNuZHMuT25UZXh0Q2hhbmdlZCwgQzMkanNjb21wJDMxMS5QbHVnaW5zLlN5c3RlbS5FeHBzLnJlZ2V4cmVwbGFjZSwgQzMkanNjb21wJDMxMS5QbHVnaW5zLlRleHRCb3guRXhwcy5UZXh0LAogICAgICAgIEMzJGpzY29tcCQzMTEuUGx1Z2lucy5Mb2NhbFN0b3JhZ2UuQWN0cy5DaGVja0l0ZW1FeGlzdHMsIEMzJGpzY29tcCQzMTEuUGx1Z2lucy5Mb2NhbFN0b3JhZ2UuQ25kcy5Pbkl0ZW1FeGlzdHMsIEMzJGpzY29tcCQzMTEuUGx1Z2lucy5Mb2NhbFN0b3JhZ2UuQWN0cy5HZXRJdGVtLCBDMyRqc2NvbXAkMzExLlBsdWdpbnMuTG9jYWxTdG9yYWdlLkNuZHMuT25JdGVtR2V0LCBDMyRqc2NvbXAkMzExLlBsdWdpbnMuTG9jYWxTdG9yYWdlLkV4cHMuSXRlbVZhbHVlLCBDMyRqc2NvbXAkMzExLlBsdWdpbnMuU3lzdGVtLkFjdHMuU2V0RnVuY3Rpb25SZXR1cm5WYWx1ZSwgQzMkanNjb21wJDMxMS5QbHVnaW5zLlNwcml0ZS5DbmRzLklzQW5pbVBsYXlpbmcsIEMzJGpzY29tcCQzMTEuUGx1Z2lucy5TcHJpdGUuQWN0cy5TZXRaRWxldmF0aW9uLCBDMyRqc2NvbXAkMzExLlBsdWdpbnMuVGV4dC5BY3RzLlNldFpFbGV2YXRpb24sIEMzJGpzY29tcCQzMTEuUGx1Z2lucy5TcHJpdGUuQWN0cy5TZXRJbnN0YW5jZVZhciwKICAgICAgICBDMyRqc2NvbXAkMzExLlBsdWdpbnMuVGV4dC5DbmRzLklzT25MYXllciwgQzMkanNjb21wJDMxMS5QbHVnaW5zLlRleHQuQWN0cy5TZXRJbnN0YW5jZVZhciwgQzMkanNjb21wJDMxMS5QbHVnaW5zLlNwcml0ZS5BY3RzLlJvdGF0ZUNsb2Nrd2lzZSwgQzMkanNjb21wJDMxMS5QbHVnaW5zLlRleHQuQ25kcy5PbkNyZWF0ZWQsIEMzJGpzY29tcCQzMTEuUGx1Z2lucy5Ccm93c2VyLkFjdHMuQ29uc29sZUxvZywgQzMkanNjb21wJDMxMS5QbHVnaW5zLlBsYXRmb3JtSW5mby5DbmRzLklzT25Nb2JpbGUsIEMzJGpzY29tcCQzMTEuUGx1Z2lucy5Ccm93c2VyLkV4cHMuRXhlY0pTLCBDMyRqc2NvbXAkMzExLlBsdWdpbnMuR2FtZUFuYWx5dGljcy5BY3RzLmluaXRpYWxpemUsIEMzJGpzY29tcCQzMTEuUGx1Z2lucy5QbGF0Zm9ybUluZm8uQ25kcy5Jc09uQW5kcm9pZCwgQzMkanNjb21wJDMxMS5QbHVnaW5zLkJyb3dzZXIuQWN0cy5Mb2FkU3R5bGVTaGVldCwgQzMkanNjb21wJDMxMS5QbHVnaW5zLkFKQVguQ25kcy5PbkNvbXBsZXRlLAogICAgICAgIEMzJGpzY29tcCQzMTEuUGx1Z2lucy5EaWN0aW9uYXJ5LkFjdHMuSlNPTkxvYWQsIEMzJGpzY29tcCQzMTEuUGx1Z2lucy5BSkFYLkV4cHMuTGFzdERhdGEsIEMzJGpzY29tcCQzMTEuUGx1Z2lucy5FcG9uZXNoX0dhbWVTY29yZS5FeHBzLkxhbmd1YWdlLCBDMyRqc2NvbXAkMzExLlBsdWdpbnMuQUpBWC5BY3RzLlJlcXVlc3RGaWxlLCBDMyRqc2NvbXAkMzExLlBsdWdpbnMuU3lzdGVtLkNuZHMuRm9yRWFjaCwgQzMkanNjb21wJDMxMS5QbHVnaW5zLkVwb25lc2hfR2FtZVNjb3JlLkNuZHMuSXNBZHNBZGJsb2NrRW5hYmxlZCwgQzMkanNjb21wJDMxMS5QbHVnaW5zLkVwb25lc2hfR2FtZVNjb3JlLkFjdHMuQWRzU2hvd1Jld2FyZGVkLCBDMyRqc2NvbXAkMzExLlBsdWdpbnMuRXBvbmVzaF9HYW1lU2NvcmUuQ25kcy5Jc0Fkc0xhc3RBZFN1Y2Nlc3MsIEMzJGpzY29tcCQzMTEuUGx1Z2lucy5FcG9uZXNoX0dhbWVTY29yZS5BY3RzLkFkc1Nob3dGdWxsc2NyZWVuLCBDMyRqc2NvbXAkMzExLlBsdWdpbnMuRXBvbmVzaF9HYW1lU2NvcmUuQWN0cy5HYW1lcGxheVN0YXJ0LAogICAgICAgIEMzJGpzY29tcCQzMTEuUGx1Z2lucy5FcG9uZXNoX0dhbWVTY29yZS5BY3RzLkdhbWVwbGF5U3RvcAogICAgXQp9OwpzZWxmLkMzX0pzUHJvcE5hbWVUYWJsZSA9IFt7CiAgICAgICAgZm9yY2U6IDAKICAgIH0sIHsKICAgICAgICBkaXJYOiAwCiAgICB9LCB7CiAgICAgICAgZGlyWTogMAogICAgfSwgewogICAgICAgIFR3ZWVuOiAwCiAgICB9LCB7CiAgICAgICAgUG9ydGFsMTogMAogICAgfSwgewogICAgICAgIFBvcnRhbDI6IDAKICAgIH0sIHsKICAgICAgICBQb3J0YWxQYXJ0aWNsZTogMAogICAgfSwgewogICAgICAgIEd1blBsYXllcjogMAogICAgfSwgewogICAgICAgIERlc3Ryb3lPdXRzaWRlTGF5b3V0OiAwCiAgICB9LCB7CiAgICAgICAgQnVsbGV0OiAwCiAgICB9LCB7CiAgICAgICAgQnVsZXQ6IDAKICAgIH0sIHsKICAgICAgICBHdW5FbmVteTogMAogICAgfSwgewogICAgICAgIEd1blN0YW5kOiAwCiAgICB9LCB7CiAgICAgICAgTW92aW5nRmxvb3I6IDAKICAgIH0sIHsKICAgICAgICBNb3ZpbmdIYWxmU3BoZXJlOiAwCiAgICB9LCB7CiAgICAgICAgTW92aW5nQmFyaWVyOiAwCiAgICB9LCB7CiAgICAgICAgUm90YXRpbmdUcmlhbmdsZTogMAogICAgfSwgewogICAgICAgIE1hcDExR3JvdW5kOiAwCiAgICB9LCB7CiAgICAgICAgUm90YXRpbmdDb3JuZXI6IDAKICAgIH0sIHsKICAgICAgICBDdXJ2ZWRDb3JuZXI6IDAKICAgIH0sIHsKICAgICAgICBSb3RhdGluZ1BsYXRmb3JtOiAwCiAgICB9LCB7CiAgICAgICAgQ3VydmVkQ2lyY2xlUXVhcnQ6IDAKICAgIH0sIHsKICAgICAgICBDdXJ2ZWRQbGF0Zm9ybTogMAogICAgfSwgewogICAgICAgIEdyb3VuZDogMAogICAgfSwgewogICAgICAgIFBsYXRmb3JtQmFjazE6IDAKICAgIH0sIHsKICAgICAgICBNYXAxSGFsZjogMAogICAgfSwgewogICAgICAgIFBsYXRmb3JtQmFjazFNb3Zpbmc6IDAKICAgIH0sIHsKICAgICAgICBNYXAxMzogMAogICAgfSwgewogICAgICAgIFBsYXRmb3JtU21hbGw6IDAKICAgIH0sIHsKICAgICAgICBQbGF0Zm9ybUJhY2syOiAwCiAgICB9LCB7CiAgICAgICAgUGxhdGZvcm1MYXJnZU1vdmluZzogMAogICAgfSwKICAgIHsKICAgICAgICBNYXAxOU1vdmluZ1BpbGxvdzogMAogICAgfSwgewogICAgICAgIE1hcDE0cG9wa2E6IDAKICAgIH0sIHsKICAgICAgICBGaXhlZFRvcEhhbGY6IDAKICAgIH0sIHsKICAgICAgICBNYXAxMkhhbGY6IDAKICAgIH0sIHsKICAgICAgICBNYXBfYm9uZTogMAogICAgfSwgewogICAgICAgIE1hcF9yaWJiZWQ6IDAKICAgIH0sIHsKICAgICAgICBNb3ZpbmdBbmdsZTogMAogICAgfSwgewogICAgICAgIGNsZWFuVmVsb2NpdHk6IDAKICAgIH0sIHsKICAgICAgICBTcHJpbmc6IDAKICAgIH0sIHsKICAgICAgICBVRk86IDAKICAgIH0sIHsKICAgICAgICBVRk9NYXNrOiAwCiAgICB9LCB7CiAgICAgICAgTWFwMjRwb3BrYTogMAogICAgfSwgewogICAgICAgIFBsYXRmb3JtQmFjazJNb3Zpbmc6IDAKICAgIH0sIHsKICAgICAgICBNYXBDbG91ZDogMAogICAgfSwgewogICAgICAgIEVkaXRQcm9maWxlQ2xvc2VCdG46IDAKICAgIH0sIHsKICAgICAgICBFZGl0UHJvZmlsZU9rQnRuOiAwCiAgICB9LCB7CiAgICAgICAgRWRpdFByb2ZpbGVPa1RleHQ6IDAKICAgIH0sIHsKICAgICAgICBJbnB1dE5pY2s6IDAKICAgIH0sIHsKICAgICAgICBsYW5ndWFnZUtleU5hbWU6IDAKICAgIH0sIHsKICAgICAgICBDb2xvclRleHQ6IDAKICAgIH0sIHsKICAgICAgICBIZWFkVGV4dDogMAogICAgfSwgewogICAgICAgIEV5ZXNUZXh0OiAwCiAgICB9LCB7CiAgICAgICAgTW91dGhUZXh0OiAwCiAgICB9LCB7CiAgICAgICAgYmdfdGV4dF9lZGl0X2F2YXZ0YXI6IDAKICAgIH0sIHsKICAgICAgICBCVE4xUGxheWVyOiAwCiAgICB9LCB7CiAgICAgICAgQnRuRWRpdFByb2ZpbGU6IDAKICAgIH0sIHsKICAgICAgICBDb2luVGV4dDogMAogICAgfSwgewogICAgICAgIGJ0bl9zZXR0aW5nOiAwCiAgICB9LCB7CiAgICAgICAgSHBUZXh0OiAwCiAgICB9LCB7CiAgICAgICAgRGFtYWdlVGV4dDogMAogICAgfSwgewogICAgICAgIEtleXNBcnI6IDAKICAgIH0sIHsKICAgICAgICBLZXlUZXh0OiAwCiAgICB9LAogICAgewogICAgICAgIEtleUljb246IDAKICAgIH0sIHsKICAgICAgICBHYXJhZ2VUZXh0OiAwCiAgICB9LCB7CiAgICAgICAgc3RhbmQ6IDAKICAgIH0sIHsKICAgICAgICBSb3RhdGU6IDAKICAgIH0sIHsKICAgICAgICBsaWdodDogMAogICAgfSwgewogICAgICAgIGdlYXI6IDAKICAgIH0sIHsKICAgICAgICBnZWFyU21hbGw6IDAKICAgIH0sIHsKICAgICAgICBob21lQmdDb2luOiAwCiAgICB9LCB7CiAgICAgICAgQ3VwSWNvbjogMAogICAgfSwgewogICAgICAgIEhwSWNvbjogMAogICAgfSwgewogICAgICAgIERhbWFnZUljb246IDAKICAgIH0sIHsKICAgICAgICBhY3RpdmU6IDAKICAgIH0sIHsKICAgICAgICBIb21lQnRuOiAwCiAgICB9LCB7CiAgICAgICAgSG9tZVJld2FyZEtleTogMAogICAgfSwgewogICAgICAgIEhvbWVSZXdhcmRLZXlJY29uOiAwCiAgICB9LCB7CiAgICAgICAgSG9tZVJld2FyZEtleUFkYmxvY2s6IDAKICAgIH0sIHsKICAgICAgICBIb21lUmV3YXJkSWNvbjogMAogICAgfSwgewogICAgICAgIEhvbWVSZXdhcmRJbmFjdGl2ZTogMAogICAgfSwgewogICAgICAgIEhvbWVCdG4yOiAwCiAgICB9LCB7CiAgICAgICAgQXZhdGFyQmc6IDAKICAgIH0sIHsKICAgICAgICBQb3B1cFNtYWxsOiAwCiAgICB9LCB7CiAgICAgICAgVHJhbnNwYXJlbnRCZzogMAogICAgfSwgewogICAgICAgIENvaW46IDAKICAgIH0sIHsKICAgICAgICBBdmF0YXJCZ0VuZW15OiAwCiAgICB9LCB7CiAgICAgICAgUmV3YXJkSWNvbjogMAogICAgfSwgewogICAgICAgIFJhdGluZ0ljb246IDAKICAgIH0sIHsKICAgICAgICBTaWRlc1Nwcml0ZTogMAogICAgfSwgewogICAgICAgIEVuZW15U3RhcnM6IDAKICAgIH0sIHsKICAgICAgICBFbmVteU5hbWU6IDAKICAgIH0sIHsKICAgICAgICBQbGF5ZXJOYW1lOiAwCiAgICB9LCB7CiAgICAgICAgUGxheWVyU3RhcnM6IDAKICAgIH0sIHsKICAgICAgICBGYWRlOiAwCiAgICB9LCB7CiAgICAgICAgQmx1ZVdpblRleHQ6IDAKICAgIH0sIHsKICAgICAgICBGaWdodFRleHQ6IDAKICAgIH0sIHsKICAgICAgICBSZWRXaW5UZXh0OiAwCiAgICB9LAogICAgewogICAgICAgIGhvbWVCdG5HcmF5OiAwCiAgICB9LCB7CiAgICAgICAgQnRuTGVhZGVyOiAwCiAgICB9LCB7CiAgICAgICAgQmFsYW5jZUJ0bjogMAogICAgfSwgewogICAgICAgIEJhbGFuY2VSZXN1bHRUZXh0OiAwCiAgICB9LCB7CiAgICAgICAgQmFsYW5jZUdvbGRUZXh0OiAwCiAgICB9LCB7CiAgICAgICAgQmFsYW5jZVJhdGluZ1RleHQ6IDAKICAgIH0sIHsKICAgICAgICBCYWxhbmNlT2tCdG5UZXh0OiAwCiAgICB9LCB7CiAgICAgICAgQmFsYW5jZTJQbGF5ZXJzUmVzdWx0VGV4dDogMAogICAgfSwgewogICAgICAgIEJhbGFuY2UyUGxheWVyc0J0bjogMAogICAgfSwgewogICAgICAgIEJhbGFuY2VLZXk6IDAKICAgIH0sIHsKICAgICAgICBCYWxhbmNlS2V5VGV4dDogMAogICAgfSwgewogICAgICAgIEJhbGFuY2VSZXdhcmRCdG46IDAKICAgIH0sIHsKICAgICAgICBCYWxhbmNlUmV3YXJkQnRuVGV4dDogMAogICAgfSwgewogICAgICAgIEJhbGFuY2VSZXdhcmRCdG5JbmFjdGl2ZTogMAogICAgfSwgewogICAgICAgIEJhbGFuY2VLZXlCb251czogMAogICAgfSwgewogICAgICAgIEJhbGFuY2VHb2xkVGV4dEJvbnVzOiAwCiAgICB9LCB7CiAgICAgICAgQmFsYW5jZUtleVRleHRCb251czogMAogICAgfSwgewogICAgICAgIEJhbGFuY2VSaWJib246IDAKICAgIH0sIHsKICAgICAgICBCYWxhbmNlU3RhcnM6IDAKICAgIH0sIHsKICAgICAgICBCYWxhbmNlQm90dG9tU21hbGw6IDAKICAgIH0sIHsKICAgICAgICBCYWxhbmNlQm90dG9tQmlnOiAwCiAgICB9LCB7CiAgICAgICAgQmFsYW5jZUNvaW5Cb251czogMAogICAgfSwgewogICAgICAgIEJhbGFuY2VBZGJsb2NrOiAwCiAgICB9LCB7CiAgICAgICAgQmFsYW5jZUtleURvdWJsZTogMAogICAgfSwKICAgIHsKICAgICAgICBCYWxhbmNlQ29pbkRvdWJsZTogMAogICAgfSwgewogICAgICAgIFNldHRpbmdzQ2xvc2VCdG46IDAKICAgIH0sIHsKICAgICAgICBTb3VuZEJUTjogMAogICAgfSwgewogICAgICAgIGJ0bl9zZXR0aW5nczogMAogICAgfSwgewogICAgICAgIGluZm9CdG46IDAKICAgIH0sIHsKICAgICAgICBDcmVkaXRzQ2xvc2VCdG46IDAKICAgIH0sIHsKICAgICAgICBTZXR0aW5nc1RleHQ6IDAKICAgIH0sIHsKICAgICAgICBNdXNpY1RleHQ6IDAKICAgIH0sIHsKICAgICAgICBDcmVkaXRzVGV4dDogMAogICAgfSwgewogICAgICAgIENyZWRpdHNJbmZvVGV4dDogMAogICAgfSwgewogICAgICAgIFBpbjogMAogICAgfSwgewogICAgICAgIFdoZWVsU2hvcDogMAogICAgfSwgewogICAgICAgIE5leHRXaGVlbDE6IDAKICAgIH0sIHsKICAgICAgICBwcmljZTogMAogICAgfSwgewogICAgICAgIHNraW5JZDogMAogICAgfSwgewogICAgICAgIGl0ZW1MZWFndWU6IDAKICAgIH0sIHsKICAgICAgICBXaGVlbEJ1dDogMAogICAgfSwgewogICAgICAgIE91dGVyTGluZVdoZWVsOiAwCiAgICB9LCB7CiAgICAgICAgcG9ydGluZzogMAogICAgfSwgewogICAgICAgIGpldHBhY2s6IDAKICAgIH0sIHsKICAgICAgICBidWJsZTogMAogICAgfSwgewogICAgICAgIHNpemVVcDogMAogICAgfSwgewogICAgICAgIFdoZWVsTG9jazogMAogICAgfSwgewogICAgICAgIFdoZWVsc0FycjogMAogICAgfSwgewogICAgICAgIFdoZWVsUHJpY2VUZXh0OiAwCiAgICB9LCB7CiAgICAgICAgV2hlZWxMZWFndWVUZXh0OiAwCiAgICB9LCB7CiAgICAgICAgTmV4dFdoZWVsMjogMAogICAgfSwgewogICAgICAgIEJhY2tXaGVlbDE6IDAKICAgIH0sIHsKICAgICAgICBCYWNrV2hlZWwyOiAwCiAgICB9LCB7CiAgICAgICAgV2hlZWxNYXNrOiAwCiAgICB9LCB7CiAgICAgICAgV2hlZWxUaWNrOiAwCiAgICB9LCB7CiAgICAgICAgV2hlZWxEZXNjVGV4dDogMAogICAgfSwgewogICAgICAgIFdoZWVsQnV5QnRuOiAwCiAgICB9LCB7CiAgICAgICAgV2hlZWxCdXlCdG5UZXh0OiAwCiAgICB9LAogICAgewogICAgICAgIFdoZWVsS2V5OiAwCiAgICB9LCB7CiAgICAgICAgU2hvcFdoZWVsc0tleVJld2FyZEljb246IDAKICAgIH0sIHsKICAgICAgICBTaG9wV2hlZWxzS2V5SW5hY3RpdmU6IDAKICAgIH0sIHsKICAgICAgICBrZXlUeXBlOiAwCiAgICB9LCB7CiAgICAgICAgU2hvcFdoZWVsc0tleUJ0bjogMAogICAgfSwgewogICAgICAgIFNob3BXaGVlbHNLZXlUZXh0OiAwCiAgICB9LCB7CiAgICAgICAgU2hvcFdoZWVsc0tleUljb246IDAKICAgIH0sIHsKICAgICAgICBTaG9wV2hlZWxzS2V5QWRibG9jazogMAogICAgfSwgewogICAgICAgIFdoZWVsc0RhbWFnZUJvdHRvbTogMAogICAgfSwgewogICAgICAgIFdoZWVsc0luZGljYXRvcjogMAogICAgfSwgewogICAgICAgIFdoZWVsc0luZGljYXRvclRleHQ6IDAKICAgIH0sIHsKICAgICAgICBDYXJzQXJyOiAwCiAgICB9LCB7CiAgICAgICAgQmFja0NhcjE6IDAKICAgIH0sIHsKICAgICAgICBCYWNrQ2FyMjogMAogICAgfSwgewogICAgICAgIE5leHRDYXIxOiAwCiAgICB9LCB7CiAgICAgICAgTmV4dENhcjI6IDAKICAgIH0sIHsKICAgICAgICBPdXRlckxpbmVDYXI6IDAKICAgIH0sIHsKICAgICAgICBDYXJCdXQ6IDAKICAgIH0sIHsKICAgICAgICBDYXJCdXlCdG46IDAKICAgIH0sIHsKICAgICAgICBDYXJCdXlCdG5UZXh0OiAwCiAgICB9LCB7CiAgICAgICAgQ2FyRGVzY1RleHQ6IDAKICAgIH0sIHsKICAgICAgICBDYXJMZWFndWVUZXh0OiAwCiAgICB9LCB7CiAgICAgICAgQ2FyTG9jazogMAogICAgfSwgewogICAgICAgIENhck1hc2s6IDAKICAgIH0sIHsKICAgICAgICBDYXJQcmljZVRleHQ6IDAKICAgIH0sIHsKICAgICAgICBDYXJTaG9wOiAwCiAgICB9LCB7CiAgICAgICAgQ2FyVGljazogMAogICAgfSwgewogICAgICAgIEtleXNQcmljZUFycjogMAogICAgfSwgewogICAgICAgIENhcktleTogMAogICAgfSwgewogICAgICAgIFNob3BCYWNrOiAwCiAgICB9LCB7CiAgICAgICAgQ2FySHBCb3R0b206IDAKICAgIH0sCiAgICB7CiAgICAgICAgU2hvcENhcnNLZXlUZXh0OiAwCiAgICB9LCB7CiAgICAgICAgU2hvcENhcnNLZXlSZXdhcmRJY29uOiAwCiAgICB9LCB7CiAgICAgICAgU2hvcENhcnNLZXlJbmFjdGl2ZTogMAogICAgfSwgewogICAgICAgIFNob3BDYXJzS2V5SWNvbjogMAogICAgfSwgewogICAgICAgIFNob3BDYXJzS2V5QnRuOiAwCiAgICB9LCB7CiAgICAgICAgU2hvcENhcnNLZXlBZGJsb2NrOiAwCiAgICB9LCB7CiAgICAgICAgQ2Fyc0luZGljYXRvcjogMAogICAgfSwgewogICAgICAgIENhcnNJbmRpY2F0b3JUZXh0OiAwCiAgICB9LCB7CiAgICAgICAgTGVhZ3VlQXJyOiAwCiAgICB9LCB7CiAgICAgICAgTGVhZ3VlQmFyOiAwCiAgICB9LCB7CiAgICAgICAgTGVhZ3VlQmFyQmFjazogMAogICAgfSwgewogICAgICAgIExlYWd1ZVJld2FyZEFycjogMAogICAgfSwgewogICAgICAgIExlYWd1ZUJvdHRvbTogMAogICAgfSwgewogICAgICAgIExlYWd1ZVByb2dyZXNzVGV4dDogMAogICAgfSwgewogICAgICAgIExlYWd1ZU5hbWVUZXh0OiAwCiAgICB9LCB7CiAgICAgICAgTGVhZ3VlQm90dG9tSG9tZTogMAogICAgfSwgewogICAgICAgIE5ld0xlYWd1ZUJvdHRvbTogMAogICAgfSwgewogICAgICAgIE5ld0xlYWd1ZU5hbWVUZXh0OiAwCiAgICB9LCB7CiAgICAgICAgTmV3TGVhZ3VlT2tCdG46IDAKICAgIH0sIHsKICAgICAgICBOZXdMZWFndWVMYWJlbFRleHQ6IDAKICAgIH0sIHsKICAgICAgICBGdWxsTGVhZ3VlOiAwCiAgICB9LCB7CiAgICAgICAgTGVhZ3VlVGV4dDogMAogICAgfSwgewogICAgICAgIExlYWd1ZU51bVRleHQ6IDAKICAgIH0sIHsKICAgICAgICBOZXdMZWFndWVSaWJib246IDAKICAgIH0sIHsKICAgICAgICBVcGdyYWRlQ2FyQ29pbjogMAogICAgfSwgewogICAgICAgIFVwZ3JhZGVDYXJCdG46IDAKICAgIH0sCiAgICB7CiAgICAgICAgVXBncmFkZUNhclRleHQ6IDAKICAgIH0sIHsKICAgICAgICBVcGdyYWRlQ2FyUHJpY2VUZXh0OiAwCiAgICB9LCB7CiAgICAgICAgTmV3VXBncmFkZXM6IDAKICAgIH0sIHsKICAgICAgICBVcGdyYWRlV2hlZWxCdG46IDAKICAgIH0sIHsKICAgICAgICBVcGdyYWRlV2hlZWxDb2luOiAwCiAgICB9LCB7CiAgICAgICAgVXBncmFkZVdoZWVsUHJpY2VUZXh0OiAwCiAgICB9LCB7CiAgICAgICAgVXBncmFkZVdoZWVsVGV4dDogMAogICAgfSwgewogICAgICAgIFVwZ3JhZGVHb2xkSW5hY3RpdmU6IDAKICAgIH0sIHsKICAgICAgICBVcGdyYWRlV2hlZWxzSW5hY3RpdmU6IDAKICAgIH0sIHsKICAgICAgICBVcGdyYWRlR29sZDogMAogICAgfSwgewogICAgICAgIFVwZ3JhZGVDYXJJbmFjdGl2ZTogMAogICAgfSwgewogICAgICAgIFVwZ3JhZGVHb2xkVGV4dDogMAogICAgfSwgewogICAgICAgIFVwZ3JhZGVHb2xkQ29pbjogMAogICAgfSwgewogICAgICAgIFVwZ3JhZGVHb2xkUmV3YXJkSWNvbjogMAogICAgfSwgewogICAgICAgIFVwZ3JhZGVzVGV4dDogMAogICAgfSwgewogICAgICAgIEJ1eUNhclRleHQ6IDAKICAgIH0sIHsKICAgICAgICBCdXlXaGVlbHNUZXh0OiAwCiAgICB9LCB7CiAgICAgICAgVXBncmFkZUNhckljb246IDAKICAgIH0sIHsKICAgICAgICBVcGdyYWRlV2hlZWxJY29uOiAwCiAgICB9LCB7CiAgICAgICAgVXBncmFkZUNhckx2bFRleHQ6IDAKICAgIH0sIHsKICAgICAgICBVcGdyYWRlV2hlZWxMdmxUZXh0OiAwCiAgICB9LCB7CiAgICAgICAgVXBncmFkZUFkYmxvY2s6IDAKICAgIH0sIHsKICAgICAgICBsdmxCZzogMAogICAgfSwgewogICAgICAgIENsb3NlR2FyYWdlOiAwCiAgICB9LCB7CiAgICAgICAgQnRuR2FyYWdlOiAwCiAgICB9LCB7CiAgICAgICAgQnRuU2hvcENhcnM6IDAKICAgIH0sCiAgICB7CiAgICAgICAgQnRuU2hvcFdoZWVsczogMAogICAgfSwgewogICAgICAgIEJ0blVwZ3JhZGVzOiAwCiAgICB9LCB7CiAgICAgICAgR2FyYWdlSW5kaWNhdG9yOiAwCiAgICB9LCB7CiAgICAgICAgVXBncmFkZXNJbmRpY2F0b3I6IDAKICAgIH0sIHsKICAgICAgICBTaG9wQ2FySW5kaWNhdG9yOiAwCiAgICB9LCB7CiAgICAgICAgU2hvcFdoZWVsc0luZGljYXRvcjogMAogICAgfSwgewogICAgICAgIFVwZ3JhZGVzSWNvbjogMAogICAgfSwgewogICAgICAgIFNob3BDYXJJY29uOiAwCiAgICB9LCB7CiAgICAgICAgU2hvcFdoZWVsc0ljb246IDAKICAgIH0sIHsKICAgICAgICBHYXJhZ2VJbmRpY2F0b3JUZXh0OiAwCiAgICB9LCB7CiAgICAgICAgU2hvcENhckluZGljYXRvclRleHQ6IDAKICAgIH0sIHsKICAgICAgICBTaG9wV2hlZWxzSW5kaWNhdG9yVGV4dDogMAogICAgfSwgewogICAgICAgIFVwZ3JhZGVzSW5kaWNhdG9yVGV4dDogMAogICAgfSwgewogICAgICAgIFZlcnN1c0JhY2s6IDAKICAgIH0sIHsKICAgICAgICBMb2FkaW5nQ2lyY2xlOiAwCiAgICB9LCB7CiAgICAgICAgU2VhcmNoVGV4dDogMAogICAgfSwgewogICAgICAgIEVuZW15RmlnaHRlclNob3A6IDAKICAgIH0sIHsKICAgICAgICBQbGF5ZXJXaGVlbDFWZXJzdXM6IDAKICAgIH0sIHsKICAgICAgICBQbGF5ZXJXaGVlbDJWZXJzdXM6IDAKICAgIH0sIHsKICAgICAgICBFbmVteVdoZWVsMVZlcnN1czogMAogICAgfSwgewogICAgICAgIEVuZW15V2hlZWwyVmVyc3VzOiAwCiAgICB9LCB7CiAgICAgICAgUGxheWVySHBUZXh0OiAwCiAgICB9LCB7CiAgICAgICAgUGxheWVyRGFtYWdlVGV4dDogMAogICAgfSwgewogICAgICAgIEVuZW15RGFtYWdlVGV4dDogMAogICAgfSwgewogICAgICAgIEVuZW15SHBUZXh0OiAwCiAgICB9LAogICAgewogICAgICAgIEhwSWNvbkVuZW15OiAwCiAgICB9LCB7CiAgICAgICAgRGFtYWdlSWNvbkVuZW15OiAwCiAgICB9LCB7CiAgICAgICAgVmVyc3VzVGV4dDogMAogICAgfSwgewogICAgICAgIEVuZW15SGVhbHRoQmFyOiAwCiAgICB9LCB7CiAgICAgICAgRW5lbXlIZWFsdGhCYXJCYWNrOiAwCiAgICB9LCB7CiAgICAgICAgUGxheWVySGVhbHRoQmFyOiAwCiAgICB9LCB7CiAgICAgICAgUGxheWVySGVhbHRoQmFyQmFjazogMAogICAgfSwgewogICAgICAgIFRvdWNoTGVmdDogMAogICAgfSwgewogICAgICAgIFRvdWNoTGVmdFBsYXllcjE6IDAKICAgIH0sIHsKICAgICAgICBUb3VjaExlZnRQbGF5ZXIyOiAwCiAgICB9LCB7CiAgICAgICAgVG91Y2hSaWdodDogMAogICAgfSwgewogICAgICAgIFRvdWNoUmlnaHRQbGF5ZXIxOiAwCiAgICB9LCB7CiAgICAgICAgVG91Y2hSaWdodFBsYXllcjI6IDAKICAgIH0sIHsKICAgICAgICBNb2JpbGVCdXQ6IDAKICAgIH0sIHsKICAgICAgICBNb2JpbGVCdXQyUGxheWVyczogMAogICAgfSwgewogICAgICAgICIxUGxheWVyTWVudSI6IDAKICAgIH0sIHsKICAgICAgICAiMlBsYXllcnNNZW51IjogMAogICAgfSwgewogICAgICAgIFBsYXllckljb246IDAKICAgIH0sIHsKICAgICAgICBMYWJlbDogMAogICAgfSwgewogICAgICAgICIxUGxheWVyVGV4dCI6IDAKICAgIH0sIHsKICAgICAgICAiMlBsYXllcnNUZXh0IjogMAogICAgfSwgewogICAgICAgICIyUGxheWVyc1BsYXkiOiAwCiAgICB9LCB7CiAgICAgICAgUGxheWVyMUNhcjogMAogICAgfSwgewogICAgICAgIFBsYXllcjJDYXI6IDAKICAgIH0sIHsKICAgICAgICBQaHlzaWNzOiAwCiAgICB9LCB7CiAgICAgICAgUGxheWVyMUhlYWQ6IDAKICAgIH0sIHsKICAgICAgICBQbGF5ZXIyV2hlZWwxOiAwCiAgICB9LCB7CiAgICAgICAgUGxheWVyMldoZWVsMjogMAogICAgfSwgewogICAgICAgIFBsYXllcjJIZWFkOiAwCiAgICB9LAogICAgewogICAgICAgIFBsYXllcjFXaGVlbDE6IDAKICAgIH0sIHsKICAgICAgICBQbGF5ZXIxV2hlZWwyOiAwCiAgICB9LCB7CiAgICAgICAgUGxheWVyMUZhY2U6IDAKICAgIH0sIHsKICAgICAgICBQbGF5ZXIyRmFjZTogMAogICAgfSwgewogICAgICAgIFBsYXllcjFGYWNlTmV4dDogMAogICAgfSwgewogICAgICAgIFBsYXllcjFGYWNlQmFjazogMAogICAgfSwgewogICAgICAgIFBsYXllcjJGYWNlQmFjazogMAogICAgfSwgewogICAgICAgIFBsYXllcjJGYWNlTmV4dDogMAogICAgfSwgewogICAgICAgIEJ1eVNraW46IDAKICAgIH0sIHsKICAgICAgICBTdGFySWNvbjogMAogICAgfSwgewogICAgICAgIE5ld1NraW5UeHQ6IDAKICAgIH0sIHsKICAgICAgICBOZXdTa2luUHJpY2VUeHQ6IDAKICAgIH0sIHsKICAgICAgICBTdGFyc1R4dDogMAogICAgfSwgewogICAgICAgIE5ld1NraW5TcHJpdGU6IDAKICAgIH0sIHsKICAgICAgICBOZXdTa2luT2tCdG46IDAKICAgIH0sIHsKICAgICAgICBGcmVlU3RhckJ0bjogMAogICAgfSwgewogICAgICAgIEZyZWVTdGFySWNvbjogMAogICAgfSwgewogICAgICAgIEZyZWVTdGFySW5hY3RpdmU6IDAKICAgIH0sIHsKICAgICAgICBGcmVlU3RhclJld2FyZGljb246IDAKICAgIH0sIHsKICAgICAgICBGcmVlU3RhckFkYmxvY2s6IDAKICAgIH0sIHsKICAgICAgICBGcmVlU2tpblR4dDogMAogICAgfSwgewogICAgICAgIFNraW5CZzogMAogICAgfSwgewogICAgICAgIFNraW5JY29uOiAwCiAgICB9LCB7CiAgICAgICAgUmliYm9uMlBsYXllcnM6IDAKICAgIH0sIHsKICAgICAgICBCYWxhbmNlMlBsYXllcnNUeHQ6IDAKICAgIH0sIHsKICAgICAgICBCYWxhbmNlMlBsYXllcnNSZXdhcmRCdG46IDAKICAgIH0sIHsKICAgICAgICBCYWxhbmNlUmV3YXJkMlBsYXllcnNJbmFjdGl2ZTogMAogICAgfSwgewogICAgICAgIEJhbGFuY2VSZXdhcmQyUGxheWVyc1R4dDogMAogICAgfSwKICAgIHsKICAgICAgICBCYWxhbmNlMlBsYXllcnNBZGJsb2NrOiAwCiAgICB9LCB7CiAgICAgICAgaGFuZDJQbGF5ZXJzOiAwCiAgICB9LCB7CiAgICAgICAgQnV5U2tpbkluZGljYXRvcjogMAogICAgfSwgewogICAgICAgIEJ1eVNraW5JbmRpY2F0b3JUZXh0OiAwCiAgICB9LCB7CiAgICAgICAgU3RhckJ1eVNraW5JY29uOiAwCiAgICB9LCB7CiAgICAgICAgVHV0b3JQbGF5ZXIxOiAwCiAgICB9LCB7CiAgICAgICAgVHV0b3JQbGF5ZXIyOiAwCiAgICB9LCB7CiAgICAgICAgR2FtZVR1dG9yVGV4dDJQbGF5ZXJzOiAwCiAgICB9LCB7CiAgICAgICAgUGxheWVyMUNhckJhY2s6IDAKICAgIH0sIHsKICAgICAgICBQbGF5ZXIxQ2FyTmV4dDogMAogICAgfSwgewogICAgICAgIFBsYXllcjJDYXJCYWNrOiAwCiAgICB9LCB7CiAgICAgICAgUGxheWVyMkNhck5leHQ6IDAKICAgIH0sIHsKICAgICAgICBOZXdDYXJTcHJpdGU6IDAKICAgIH0sIHsKICAgICAgICBOZXdDYXJPa0J0bjogMAogICAgfSwgewogICAgICAgIE5ld0NhckFkQnRuOiAwCiAgICB9LCB7CiAgICAgICAgTmV3Q2FyQWRJbmFjdGl2ZTogMAogICAgfSwgewogICAgICAgIE5ld0NhckFkUmV3YXJkaWNvbjogMAogICAgfSwgewogICAgICAgIE5ld0NhckFkYmxvY2s6IDAKICAgIH0sIHsKICAgICAgICBGcmVlQ2FyVHh0OiAwCiAgICB9LCB7CiAgICAgICAgQnV5Q2FyOiAwCiAgICB9LCB7CiAgICAgICAgRmxhbWVCdXlTa2luOiAwCiAgICB9LCB7CiAgICAgICAgRmxhbWVGcmVlU2tpbjogMAogICAgfSwgewogICAgICAgIENhckljb246IDAKICAgIH0sIHsKICAgICAgICBGbGFtZUJ1eUNhcjogMAogICAgfSwgewogICAgICAgIEZsYW1lRnJlZUNhcjogMAogICAgfSwgewogICAgICAgIFN0YXJCdXlDYXJJY29uOiAwCiAgICB9LCB7CiAgICAgICAgTmV3Q2FyUHJpY2VUeHQ6IDAKICAgIH0sCiAgICB7CiAgICAgICAgQnV5Q2FySW5kaWNhdG9yOiAwCiAgICB9LCB7CiAgICAgICAgQnV5Q2FySW5kaWNhdG9yVGV4dDogMAogICAgfSwgewogICAgICAgIEJ1eUNhckluYWN0aXZlOiAwCiAgICB9LCB7CiAgICAgICAgQnV5U2tpbkluYWN0aXZlOiAwCiAgICB9LCB7CiAgICAgICAgTmV3Q2FyVHh0OiAwCiAgICB9LCB7CiAgICAgICAgQ2Fyc1RleHQ6IDAKICAgIH0sIHsKICAgICAgICBIZWFkMlBsYXllcnNUZXh0OiAwCiAgICB9LCB7CiAgICAgICAgU2NvcmVQbGF5ZXIyOiAwCiAgICB9LCB7CiAgICAgICAgU2NvcmVQbGF5ZXIxOiAwCiAgICB9LCB7CiAgICAgICAgU2NvcmVQbGF5ZXIyVHh0OiAwCiAgICB9LCB7CiAgICAgICAgU2NvcmVQbGF5ZXIxVHh0OiAwCiAgICB9LCB7CiAgICAgICAgTmV3Q2FyV2hlZWwxOiAwCiAgICB9LCB7CiAgICAgICAgTmV3Q2FyV2hlZWwyOiAwCiAgICB9LCB7CiAgICAgICAgR2lmdEJ0bjogMAogICAgfSwgewogICAgICAgIEdpZnRUZXh0OiAwCiAgICB9LCB7CiAgICAgICAgRnJlZUdpZnRCdG46IDAKICAgIH0sIHsKICAgICAgICBSZXdhcmRHaWZ0S2V5SWNvbjogMAogICAgfSwgewogICAgICAgIFJld2FyZEdpZnRLZXlUZXh0OiAwCiAgICB9LCB7CiAgICAgICAgUmV3YXJkR2lmdEJ0bjogMAogICAgfSwgewogICAgICAgIFJld2FyZEdpZnRCdG5JbmFjdGl2ZTogMAogICAgfSwgewogICAgICAgIFJld2FyZEdpZnRBZGJsb2NrOiAwCiAgICB9LCB7CiAgICAgICAgUmV3YXJkR2lmdEdvbGRJY29uOiAwCiAgICB9LCB7CiAgICAgICAgUmV3YXJkR2lmdEdvbGRUZXh0OiAwCiAgICB9LCB7CiAgICAgICAgUmV3YXJkSWNvbjI6IDAKICAgIH0sIHsKICAgICAgICBGcmVlR2lmdEdvbGRJY29uOiAwCiAgICB9LCB7CiAgICAgICAgRnJlZUdpZnRHb2xkVGV4dDogMAogICAgfSwgewogICAgICAgIEdpZnRDb3VudGVyVGV4dDogMAogICAgfSwKICAgIHsKICAgICAgICBHaWZ0SW5kaWNhdG9yOiAwCiAgICB9LCB7CiAgICAgICAgR2lmdEluZGljYXRvclRleHQ6IDAKICAgIH0sIHsKICAgICAgICBHaWZ0SWNvbjogMAogICAgfSwgewogICAgICAgIEJhdHRsZUljb246IDAKICAgIH0sIHsKICAgICAgICBBdWRpbzogMAogICAgfSwgewogICAgICAgIEJyb3dzZXI6IDAKICAgIH0sIHsKICAgICAgICBHYW1lUHVzaDogMAogICAgfSwgewogICAgICAgIEtleWJvYXJkOiAwCiAgICB9LCB7CiAgICAgICAgTG9jYWxTdG9yYWdlOiAwCiAgICB9LCB7CiAgICAgICAgUGxhdGZvcm1JbmZvOiAwCiAgICB9LCB7CiAgICAgICAgVG91Y2g6IDAKICAgIH0sIHsKICAgICAgICBHYW1lQW5hbHl0aWNzOiAwCiAgICB9LCB7CiAgICAgICAgQUpBWDogMAogICAgfSwgewogICAgICAgIERpY3Rpb25hcnk6IDAKICAgIH0sIHsKICAgICAgICByZW1vdmVTZXJ2aWNlV29ya2VyOiAwCiAgICB9LCB7CiAgICAgICAgRGljdGlvbmFyeU5pY2s6IDAKICAgIH0sIHsKICAgICAgICBQbGF5ZXJGYWNlOiAwCiAgICB9LCB7CiAgICAgICAgUGxheWVyRXllOiAwCiAgICB9LCB7CiAgICAgICAgUGxheWVyTW91dGg6IDAKICAgIH0sIHsKICAgICAgICBDb2xvckJhY2s6IDAKICAgIH0sIHsKICAgICAgICBDb2xvck5leHQ6IDAKICAgIH0sIHsKICAgICAgICBGYWNlQmFjazogMAogICAgfSwgewogICAgICAgIEZhY2VOZXh0OiAwCiAgICB9LCB7CiAgICAgICAgRXllQmFjazogMAogICAgfSwgewogICAgICAgIEV5ZU5leHQ6IDAKICAgIH0sIHsKICAgICAgICBNb3V0aE5leHQ6IDAKICAgIH0sIHsKICAgICAgICBNb3V0aEJhY2s6IDAKICAgIH0sIHsKICAgICAgICBFbmVteUV5ZTogMAogICAgfSwgewogICAgICAgIEVuZW15RmFjZTogMAogICAgfSwgewogICAgICAgIEVuZW15TW91dGg6IDAKICAgIH0sIHsKICAgICAgICBQbGF5ZXJGYWNlR2FtZTogMAogICAgfSwgewogICAgICAgIFBsYXllckV5ZUdhbWU6IDAKICAgIH0sIHsKICAgICAgICBQbGF5ZXJNb3V0aEdhbWU6IDAKICAgIH0sIHsKICAgICAgICBFbmVteUZhY2VHYW1lOiAwCiAgICB9LAogICAgewogICAgICAgIEVuZW15RXllR2FtZTogMAogICAgfSwgewogICAgICAgIEVuZW15TW91dGhHYW1lOiAwCiAgICB9LCB7CiAgICAgICAgaGFuZDogMAogICAgfSwgewogICAgICAgIEdhbWVUdXRvclRleHQ6IDAKICAgIH0sIHsKICAgICAgICBLZXlUdXRvcjogMAogICAgfSwgewogICAgICAgIFBDVGV4dDI6IDAKICAgIH0sIHsKICAgICAgICBQQ1RleHQzOiAwCiAgICB9LCB7CiAgICAgICAgUmlwcGxlRWZmZWN0TGVmdDogMAogICAgfSwgewogICAgICAgIFJpcHBsZUVmZmVjdEhlYWQ6IDAKICAgIH0sIHsKICAgICAgICBSaXBwbGVFZmZlY3RSaWdodDogMAogICAgfSwgewogICAgICAgIFNob3BUdXRvclRleHQ6IDAKICAgIH0sIHsKICAgICAgICBBS2V5VHh0OiAwCiAgICB9LCB7CiAgICAgICAgREtleVR4dDogMAogICAgfSwgewogICAgICAgIExlZnRLZXlUeHQ6IDAKICAgIH0sIHsKICAgICAgICBSaWdodEtleVR4dDogMAogICAgfSwgewogICAgICAgIFBsYXllck1hcms6IDAKICAgIH0sIHsKICAgICAgICBQYXJ0aWNsZXNBbWJpZW5jZTogMAogICAgfSwgewogICAgICAgIExldmVsU2VsZWN0QmFja2dyb3VuZDogMAogICAgfSwgewogICAgICAgIFdhdmVNb2RlQmFja2dyb3VuZDogMAogICAgfSwgewogICAgICAgIExpbWl0V2FsbHM6IDAKICAgIH0sIHsKICAgICAgICBEYW1hZ2VTb3VuZDogMAogICAgfSwgewogICAgICAgIGlzUG9ydGluZzogMAogICAgfSwgewogICAgICAgIFBsYXllckZpZ2h0ZXI6IDAKICAgIH0sIHsKICAgICAgICBFbmVteUZpZ2h0ZXI6IDAKICAgIH0sIHsKICAgICAgICBFbmVteVdoZWVsMTogMAogICAgfSwgewogICAgICAgIEVuZW15V2hlZWwyOiAwCiAgICB9LCB7CiAgICAgICAgUGxheWVyRmlnaHRlclNob3A6IDAKICAgIH0sIHsKICAgICAgICBsZXZlbHM6IDAKICAgIH0sIHsKICAgICAgICBMZWZ0U3RhcnQ6IDAKICAgIH0sIHsKICAgICAgICBSaWdodFN0YXJ0OiAwCiAgICB9LCB7CiAgICAgICAgUGxheWVySGVhZDogMAogICAgfSwKICAgIHsKICAgICAgICBFbmVteUhlYWQ6IDAKICAgIH0sIHsKICAgICAgICBCb21iRWZmZWN0SGVhZFdoaXRlOiAwCiAgICB9LCB7CiAgICAgICAgV2hlZWwxUGFydGljbGVzOiAwCiAgICB9LCB7CiAgICAgICAgV2hlZWwyUGFydGljbGVzOiAwCiAgICB9LCB7CiAgICAgICAgV2hlZWwzUGFydGljbGVzOiAwCiAgICB9LCB7CiAgICAgICAgV2hlZWw0UGFydGljbGVzOiAwCiAgICB9LCB7CiAgICAgICAgTGVmdFdlYXBvbnM6IDAKICAgIH0sIHsKICAgICAgICBXYWxsTGVmdDogMAogICAgfSwgewogICAgICAgIFdhbGxSaWdodDogMAogICAgfSwgewogICAgICAgIFJpZ2h0V2VhcG9uczogMAogICAgfSwgewogICAgICAgIFRpbWVyVHdlZW46IDAKICAgIH0sIHsKICAgICAgICBzdGFuZFNhd0xlZnQ6IDAKICAgIH0sIHsKICAgICAgICBzdGFuZFNhd1JpZ2h0OiAwCiAgICB9LCB7CiAgICAgICAgUGxheWVyV2hlZWwxOiAwCiAgICB9LCB7CiAgICAgICAgUGxheWVyV2hlZWwyOiAwCiAgICB9LCB7CiAgICAgICAgRW5lbXlGYW1pbHk6IDAKICAgIH0sIHsKICAgICAgICBQbGF5ZXJGYW1pbHk6IDAKICAgIH0sIHsKICAgICAgICBQaHlzaWNzT2JqZWN0czogMAogICAgfSwgewogICAgICAgIFR3ZWVuT2JqZWN0czogMAogICAgfSwgewogICAgICAgIEJ1dHRvbnM6IDAKICAgIH0sIHsKICAgICAgICBsYW5nRmFtOiAwCiAgICB9LCB7CiAgICAgICAgVGV4dEZhbTogMAogICAgfSwgewogICAgICAgIENvaW5zOiAwCiAgICB9LCB7CiAgICAgICAgV2luQ29pbnM6IDAKICAgIH0sIHsKICAgICAgICBHYW1lc3RhcnQ6IDAKICAgIH0sIHsKICAgICAgICBGaWdodGVyUmVzZXJ2ZTogMAogICAgfSwgewogICAgICAgIFdoZWVsc1Jlc2VydmU6IDAKICAgIH0sIHsKICAgICAgICBEYW1hZ2VSZXNlcnZlOiAwCiAgICB9LCB7CiAgICAgICAgSHBSZXNlcnZlOiAwCiAgICB9LCB7CiAgICAgICAgUGxheWVyTGVmdDogMAogICAgfSwgewogICAgICAgIFBsYXllclBvc2l0aW9uOiAwCiAgICB9LAogICAgewogICAgICAgIFBsYXllcjJMaWZlOiAwCiAgICB9LCB7CiAgICAgICAgUGxheWVyMkxpZmVNYXg6IDAKICAgIH0sIHsKICAgICAgICBQbGF5ZXIySW52aW5jaWJsZTogMAogICAgfSwgewogICAgICAgIFBsYXllcjFJbnZpbmNpYmxlOiAwCiAgICB9LCB7CiAgICAgICAgUGxheWVyMUxpZmU6IDAKICAgIH0sIHsKICAgICAgICBQbGF5ZXIxTGlmZU1heDogMAogICAgfSwgewogICAgICAgIFBsYXllckRhbWFnZTogMAogICAgfSwgewogICAgICAgIEVuZW15RGFtYWdlOiAwCiAgICB9LCB7CiAgICAgICAgRW5lbXlXaGVlbHM6IDAKICAgIH0sIHsKICAgICAgICBFbmVteVBvc2l0aW9uOiAwCiAgICB9LCB7CiAgICAgICAgRW5lbXlDb2xvcjogMAogICAgfSwgewogICAgICAgIEVuZW15SHBMZXZlbDogMAogICAgfSwgewogICAgICAgIEVuZW15RGFtYWdlTGV2ZWw6IDAKICAgIH0sIHsKICAgICAgICBFbmVteUlEOiAwCiAgICB9LCB7CiAgICAgICAgIjJQbGF5ZXJzIjogMAogICAgfSwgewogICAgICAgIG1hcE5hbWU6IDAKICAgIH0sIHsKICAgICAgICBtYXBOdW06IDAKICAgIH0sIHsKICAgICAgICBDb250YWluZXJzOiAwCiAgICB9LCB7CiAgICAgICAgUm91bmRfTnVtYmVyOiAwCiAgICB9LCB7CiAgICAgICAgTGVmdF9TY29yZTogMAogICAgfSwgewogICAgICAgIFJpZ2h0X1Njb3JlOiAwCiAgICB9LCB7CiAgICAgICAgd2hlZWxTcGVlZDogMAogICAgfSwgewogICAgICAgIGJhc2VEYW1hZ2U6IDAKICAgIH0sIHsKICAgICAgICBiYXNlSFA6IDAKICAgIH0sIHsKICAgICAgICBzdGVwSFA6IDAKICAgIH0sIHsKICAgICAgICBzdGVwRmlnaHRlcjogMAogICAgfSwgewogICAgICAgIHN0ZXBXaGVlbHM6IDAKICAgIH0sIHsKICAgICAgICBGaXJzdFJvdW5kOiAwCiAgICB9LCB7CiAgICAgICAgc3RlcERhbWFnZTogMAogICAgfSwgewogICAgICAgIFBsYXllcjFXaW5zOiAwCiAgICB9LCB7CiAgICAgICAgUGxheWVyMldpbnM6IDAKICAgIH0sIHsKICAgICAgICBDb29wQ2FyMTogMAogICAgfSwKICAgIHsKICAgICAgICBDb29wQ2FyMjogMAogICAgfSwgewogICAgICAgIGFpX3R5cGU6IDAKICAgIH0sIHsKICAgICAgICBBSV92YXI6IDAKICAgIH0sIHsKICAgICAgICBBSV9jb3VudGVyOiAwCiAgICB9LCB7CiAgICAgICAgVGltZVRvU3RhcnQ6IDAKICAgIH0sIHsKICAgICAgICByYW5kb21Qcm9iOiAwCiAgICB9LCB7CiAgICAgICAgcmFuZG9tUHJvYjI6IDAKICAgIH0sIHsKICAgICAgICByYW5kb21Qcm9iMzogMAogICAgfSwgewogICAgICAgIGxvY0VuZW15TmFtZTogMAogICAgfSwgewogICAgICAgIHlPZmZzZXQ6IDAKICAgIH0sIHsKICAgICAgICBpOiAwCiAgICB9LCB7CiAgICAgICAgcmFuZG9tVmFsdWU6IDAKICAgIH0sIHsKICAgICAgICByYW5kb21TaWRlOiAwCiAgICB9LCB7CiAgICAgICAgZGlmZlg6IDAKICAgIH0sIHsKICAgICAgICBkaWZmWTogMAogICAgfSwgewogICAgICAgIGxvYWROZXh0TWFwOiAwCiAgICB9LCB7CiAgICAgICAgR3VuRm9yY2U6IDAKICAgIH0sIHsKICAgICAgICB0aW1lMTogMAogICAgfSwgewogICAgICAgIHRpbWUyOiAwCiAgICB9LCB7CiAgICAgICAgY29lZjogMAogICAgfSwgewogICAgICAgIHhPZmZzZXQ6IDAKICAgIH0sIHsKICAgICAgICBjb2xsaXNpb25PZmZzZXQ6IDAKICAgIH0sIHsKICAgICAgICBhbmd1bGFyU3BlZWQ6IDAKICAgIH0sIHsKICAgICAgICBQbGF5ZXJXaGVlbDFDb2xsaXNpb246IDAKICAgIH0sIHsKICAgICAgICBQbGF5ZXJXaGVlbDJDb2xsaXNpb246IDAKICAgIH0sIHsKICAgICAgICBQbGF5ZXJGaWdodGVyQ29sbGlzaW9uOiAwCiAgICB9LCB7CiAgICAgICAgRW5lbXlXaGVlbDFDb2xsaXNpb246IDAKICAgIH0sIHsKICAgICAgICBFbmVteVdoZWVsMkNvbGxpc2lvbjogMAogICAgfSwgewogICAgICAgIEVuZW15RmlnaHRlckNvbGxpc2lvbjogMAogICAgfSwgewogICAgICAgIGNyYXNoT2ZmOiAwCiAgICB9LCB7CiAgICAgICAgU291bmQ6IDAKICAgIH0sIHsKICAgICAgICBsYW5ndWFnZVR5cGU6IDAKICAgIH0sCiAgICB7CiAgICAgICAgc2NvcmU6IDAKICAgIH0sIHsKICAgICAgICBGaWdodHNOdW06IDAKICAgIH0sIHsKICAgICAgICBUdXRvcmlhbDogMAogICAgfSwgewogICAgICAgIEZpZ2h0ZXI6IDAKICAgIH0sIHsKICAgICAgICBMZWFndWU6IDAKICAgIH0sIHsKICAgICAgICBIcExldmVsOiAwCiAgICB9LCB7CiAgICAgICAgRGFtYWdlTGV2ZWw6IDAKICAgIH0sIHsKICAgICAgICBGaWdodGVyU2hvcDogMAogICAgfSwgewogICAgICAgIFdoZWVsczogMAogICAgfSwgewogICAgICAgIFdoZWVsc1Nob3A6IDAKICAgIH0sIHsKICAgICAgICBGaWdodENvdW50ZXI6IDAKICAgIH0sIHsKICAgICAgICBGaWdodENvdW50ZXIyUGxheWVyczogMAogICAgfSwgewogICAgICAgIEF2YXRhckNvbG9yOiAwCiAgICB9LCB7CiAgICAgICAgQXZhdGFyQ29sb3JOYW1lOiAwCiAgICB9LCB7CiAgICAgICAgQXZhdGFyRmFjZU5hbWU6IDAKICAgIH0sIHsKICAgICAgICBBdmF0YXJFeWVOYW1lOiAwCiAgICB9LCB7CiAgICAgICAgQXZhdGFyTW91dGhOYW1lOiAwCiAgICB9LCB7CiAgICAgICAgQXZhdGFyRmFjZTogMAogICAgfSwgewogICAgICAgIEF2YXRhckV5ZTogMAogICAgfSwgewogICAgICAgIEF2YXRhck1vdXRoOiAwCiAgICB9LCB7CiAgICAgICAgV2F0Y2hlZEFkR29sZDogMAogICAgfSwgewogICAgICAgIFdhdGNoZWRBZEtleVdoZWVsOiAwCiAgICB9LCB7CiAgICAgICAgV2F0Y2hlZEFkS2V5Q2FyOiAwCiAgICB9LCB7CiAgICAgICAgV2F0Y2hlZEFkS2V5TWVudTogMAogICAgfSwgewogICAgICAgIFdhdGNoZWRBZFN0YXI6IDAKICAgIH0sIHsKICAgICAgICBXYXRjaGVkQWRDYXI6IDAKICAgIH0sIHsKICAgICAgICBJc01vYmlsZTogMAogICAgfSwgewogICAgICAgIHJhbmRvbUF2YXRhcklEOiAwCiAgICB9LCB7CiAgICAgICAgT3BlbmVkU2tpbnM6IDAKICAgIH0sIHsKICAgICAgICBPcGVuZWRDYXJzOiAwCiAgICB9LCB7CiAgICAgICAgVHV0b3JpYWwyUGxheWVyczogMAogICAgfSwKICAgIHsKICAgICAgICBTdGFyczogMAogICAgfSwgewogICAgICAgIFJldHVyblR5cGU6IDAKICAgIH0sIHsKICAgICAgICBHaWZ0Q291bnRlcjogMAogICAgfSwgewogICAgICAgIGR4MjogMAogICAgfSwgewogICAgICAgIGR5MjogMAogICAgfSwgewogICAgICAgIGxheWVyTmFtZTogMAogICAgfSwgewogICAgICAgIGRYVGhpY2s6IDAKICAgIH0sIHsKICAgICAgICBkWVRoaWNrOiAwCiAgICB9LCB7CiAgICAgICAgZFlQcmljZTogMAogICAgfSwgewogICAgICAgIGR4OiAwCiAgICB9LCB7CiAgICAgICAgZFhDb2luOiAwCiAgICB9LCB7CiAgICAgICAgZFhMZWFndWU6IDAKICAgIH0sIHsKICAgICAgICBkWUxlYWd1ZTogMAogICAgfSwgewogICAgICAgIGRYUHJpY2U6IDAKICAgIH0sIHsKICAgICAgICBzdGFydFg6IDAKICAgIH0sIHsKICAgICAgICBzdGFydFk6IDAKICAgIH0sIHsKICAgICAgICBpbmRleDogMAogICAgfSwgewogICAgICAgIGluZGV4bG9vcDogMAogICAgfSwgewogICAgICAgIGR5OiAwCiAgICB9LCB7CiAgICAgICAgZGF0YUxvYWQ6IDAKICAgIH0sIHsKICAgICAgICBhamF4TG9hZDogMAogICAgfSwgewogICAgICAgIG5pY2tMb2FkOiAwCiAgICB9LCB7CiAgICAgICAgajogMAogICAgfSwgewogICAgICAgIFBPS0lfTEFTVF9BRF9UQUc6IDAKICAgIH0sIHsKICAgICAgICBQT0tJX0hBU19BRF9CTE9DS0VSOiAwCiAgICB9LCB7CiAgICAgICAgUEtfR0FNRVBMQVlfU1RPUFBFRDogMAogICAgfSwgewogICAgICAgIHRhZzogMAogICAgfQpdOwpjb25zdCBDMyRqc2NvbXAkMzEyID0gc2VsZi5DMzsKCmZ1bmN0aW9uIHVuYXJ5bWludXMoYSkgewogICAgcmV0dXJuICJudW1iZXIiID09PSB0eXBlb2YgYSA/IC1hIDogYQp9CgpmdW5jdGlvbiBib3RoTnVtYmVycyhhLCBiKSB7CiAgICByZXR1cm4gIm51bWJlciIgPT09IHR5cGVvZiBhICYmICJudW1iZXIiID09PSB0eXBlb2YgYgp9CgpmdW5jdGlvbiBhZGQkanNjb21wJDQoYSwgYikgewogICAgcmV0dXJuIGJvdGhOdW1iZXJzKGEsIGIpID8gYSArIGIgOiBhCn0KCmZ1bmN0aW9uIHN1YnRyYWN0JGpzY29tcCQxKGEsIGIpIHsKICAgIHJldHVybiBib3RoTnVtYmVycyhhLCBiKSA/IGEgLSBiIDogYQp9CgpmdW5jdGlvbiBtdWx0aXBseSRqc2NvbXAkMShhLCBiKSB7CiAgICByZXR1cm4gYm90aE51bWJlcnMoYSwgYikgPyBhICogYiA6IGEKfQoKZnVuY3Rpb24gZGl2aWRlJGpzY29tcCQxKGEsIGIpIHsKICAgIHJldHVybiBib3RoTnVtYmVycyhhLCBiKSA/IGEgLyBiIDogYQp9CgpmdW5jdGlvbiBhbmQoYSwgYikgewogICAgcmV0dXJuICJzdHJpbmciID09PSB0eXBlb2YgYSB8fCAic3RyaW5nIiA9PT0gdHlwZW9mIGIgPyAoIm51bWJlciIgPT09IHR5cGVvZiBhID8gKE1hdGgucm91bmQoMUUxMCAqIGEpIC8gMUUxMCkudG9TdHJpbmcoKSA6IGEpICsgKCJudW1iZXIiID09PSB0eXBlb2YgYiA/IChNYXRoLnJvdW5kKDFFMTAgKiBiKSAvIDFFMTApLnRvU3RyaW5nKCkgOiBiKSA6IGEgJiYgYiA/IDEgOiAwCn0Kc2VsZi5DM19FeHByZXNzaW9uRnVuY3MgPSBbKCkgPT4gMCwgKCkgPT4gIk11c2ljIiwgKCkgPT4gMSwgKCkgPT4gIm11dGUiLCAoKSA9PiAiU09VTkQiLCBhID0+IHsKICAgICAgICBjb25zdCBiID0gYS5fR2V0Tm9kZSgwKS5HZXRWYXIoKTsKICAgICAgICByZXR1cm4gKCkgPT4gYi5HZXRWYWx1ZSgpCiAgICB9LCAoKSA9PiAtMTAsICgpID0+ICIiLCAoKSA9PiAidW5tdXRlIiwgKCkgPT4gIkF2YXRhcnNMb2FkaW5nIiwgYSA9PiB7CiAgICAgICAgY29uc3QgYiA9IGEuX0dldE5vZGUoMCkuR2V0Qm91bmRNZXRob2QoKTsKICAgICAgICByZXR1cm4gKCkgPT4gTWF0aC5mbG9vcihiKDAsIDYpKQogICAgfSwgYSA9PiB7CiAgICAgICAgY29uc3QgYiA9IGEuX0dldE5vZGUoMCkuR2V0Qm91bmRNZXRob2QoKTsKICAgICAgICByZXR1cm4gKCkgPT4gTWF0aC5mbG9vcihiKDAsIDE5KSkKICAgIH0sIGEgPT4gewogICAgICAgIGNvbnN0IGIgPSBhLl9HZXROb2RlKDApLkdldEJvdW5kTWV0aG9kKCk7CiAgICAgICAgcmV0dXJuICgpID0+IE1hdGguZmxvb3IoYigwLCAxNCkpCiAgICB9LCBhID0+IHsKICAgICAgICBjb25zdCBiID0gYS5fR2V0Tm9kZSgwKS5HZXRCb3VuZE1ldGhvZCgpOwogICAgICAgIHJldHVybiAoKSA9PiBNYXRoLmZsb29yKGIoMCwgOSkpCiAgICB9LCAoKSA9PiAiRXllcyIsICgpID0+ICJNb3V0aCIsICgpID0+CiAgICAtMTE1NzcwNzM2NjMsICgpID0+IC0zMjk5NDUxMDEzNTI5NSwgKCkgPT4gMiwgKCkgPT4gLTB4NWU0MGQ0MGIxYmZmLCAoKSA9PiAzLCAoKSA9PiAtMHg2ZDQxMzEwNDE3ZmYsICgpID0+IDQsICgpID0+IC0weDdjNDJjZTA0MjdmZiwgKCkgPT4gNSwgKCkgPT4gLTB4OGU4MDkwMGFhYmZmLCAoKSA9PiA2LCAoKSA9PiAtMzMwODk3MTI1Mzc1OSwgKCkgPT4gNywgKCkgPT4gLTczOTUyOTI4MjMzNDcxLCAoKSA9PiA4LCAoKSA9PiAtOTI2NDEyNTM4OTQxNDMsICgpID0+IDksICgpID0+IC05MjI3OTc0NjU1LCAoKSA9PiAxMCwgKCkgPT4gLTYyNjc3MDc5MjExMDA3LCAoKSA9PiAxMSwgKCkgPT4gLTB4NzU0MWQ1MDc1N2ZmLCAoKSA9PiAxMiwgKCkgPT4gLTB4YzBjMzJiMDMzM2ZmLCAoKSA9PiAxMywgKCkgPT4gLTB4ZDhjMDZjMDYwN2ZmLCAoKSA9PiAxNCwgKCkgPT4gLTB4ZTVjMGU0MDM1M2ZmLCAoKSA9PiAxNSwgKCkgPT4gLTB4ZjRjMTQ1MDFlM2ZmLCAoKSA9PiAxNiwgKCkgPT4gLTB4ZmJjMjMyMDAwM2ZmLCAoKSA9PiAxNywgKCkgPT4gLTB4ZmRjMzYzMDM1M2ZmLCAoKSA9PiAxOCwgKCkgPT4gLTI4MTQ4NzAyMjc1Mjc2NywgYSA9PiB7CiAgICAgICAgY29uc3QgYiA9IGEuX0dldE5vZGUoMCkuR2V0Qm91bmRNZXRob2QoKTsKICAgICAgICByZXR1cm4gKCkgPT4gYigxKQogICAgfSwgKCkgPT4gLjc1LCBhID0+IHsKICAgICAgICBjb25zdCBiID0gYS5fR2V0Tm9kZSgwKS5HZXRWYXIoKTsKICAgICAgICByZXR1cm4gKCkgPT4gIlBsYXllciAjIiArIGIuR2V0VmFsdWUoKS50b1N0cmluZygpCiAgICB9LAogICAgYSA9PiB7CiAgICAgICAgY29uc3QgYiA9IGEuX0dldE5vZGUoMCkuR2V0Qm91bmRNZXRob2QoKSwKICAgICAgICAgICAgZCA9IGEuX0dldE5vZGUoMSkuR2V0Qm91bmRNZXRob2QoKTsKICAgICAgICByZXR1cm4gKCkgPT4gYihkKDAsIDk5OSkpCiAgICB9LAogICAgYSA9PiB7CiAgICAgICAgY29uc3QgYiA9IGEuX0dldE5vZGUoMCksCiAgICAgICAgICAgIGQgPSBhLl9HZXROb2RlKDEpLkdldFZhcigpOwogICAgICAgIHJldHVybiAoKSA9PiBiLkV4cE9iamVjdChkLkdldFZhbHVlKCkudG9TdHJpbmcoKSkKICAgIH0sCiAgICBhID0+IHsKICAgICAgICBjb25zdCBiID0gYS5fR2V0Tm9kZSgwKS5HZXRCb3VuZE1ldGhvZCgpOwogICAgICAgIHJldHVybiAoKSA9PiBiKCkKICAgIH0sICgpID0+ICJUdXRvciBCb3R0IiwgYSA9PiB7CiAgICAgICAgY29uc3QgYiA9IGEuX0dldE5vZGUoMCkuR2V0Qm91bmRNZXRob2QoKSwKICAgICAgICAgICAgZCA9IGEuX0dldE5vZGUoMSkuR2V0Qm91bmRNZXRob2QoKTsKICAgICAgICByZXR1cm4gKCkgPT4gYihkKDlFNywgMTNFNykpCiAgICB9LCAoKSA9PiAiVG91Y2hMYXllcjJQbGF5ZXJzIiwKICAgICgpID0+ICJUb3VjaExheWVyIiwgKCkgPT4gIlZFUlNVUyIsICgpID0+ICJWZXJzdXMiLCBhID0+IHsKICAgICAgICBjb25zdCBiID0gYS5fR2V0Tm9kZSgwKS5HZXRCb3VuZE1ldGhvZCgpOwogICAgICAgIHJldHVybiAoKSA9PiBiKDI1NSwgMjU1LCAyNTUpCiAgICB9LAogICAgYSA9PiB7CiAgICAgICAgY29uc3QgYiA9IGEuX0dldE5vZGUoMCkuR2V0VmFyKCksCiAgICAgICAgICAgIGQgPSBhLl9HZXROb2RlKDEpLkdldFZhcigpLAogICAgICAgICAgICBjID0gYS5fR2V0Tm9kZSgyKS5HZXRWYXIoKSwKICAgICAgICAgICAgZSA9IGEuX0dldE5vZGUoMykuR2V0VmFyKCksCiAgICAgICAgICAgIGcgPSBhLl9HZXROb2RlKDQpLkdldFZhcigpOwogICAgICAgIHJldHVybiAoKSA9PiAoYi5HZXRWYWx1ZSgpICsgZC5HZXRWYWx1ZSgpICogYy5HZXRWYWx1ZSgpICsgZS5HZXRWYWx1ZSgpICogZy5HZXRWYWx1ZSgpKS50b1N0cmluZygpCiAgICB9LCAoKSA9PiA2NDAsICgpID0+IDM2MCwgKCkgPT4gLjgsICgpID0+IC4xLCAoKSA9PiAxLjksICgpID0+ICJWZXJzdXNTaXplIiwgKCkgPT4gMTIwLCBhID0+IHsKICAgICAgICBjb25zdCBiID0gYS5fR2V0Tm9kZSgwKS5HZXRCb3VuZE1ldGhvZCgpOwogICAgICAgIHJldHVybiAoKSA9PiBiKDE3LCAxODEsIDI1NSkKICAgIH0sCiAgICBhID0+IHsKICAgICAgICBjb25zdCBiID0gYS5fR2V0Tm9kZSgwKS5HZXRCb3VuZE1ldGhvZCgpOwogICAgICAgIHJldHVybiAoKSA9PiBiKDI1NCwgNzIsIDcyKQogICAgfSwKICAgIGEgPT4gewogICAgICAgIGNvbnN0IGIgPSBhLl9HZXROb2RlKDApOwogICAgICAgIHJldHVybiAoKSA9PiBiLkV4cEJlaGF2aW9yKCJWZXJzdXNTaXplIikKICAgIH0sICgpID0+ICJUdXRvciIsIGEgPT4gewogICAgICAgIGNvbnN0IGIgPSBhLl9HZXROb2RlKDApOwogICAgICAgIHJldHVybiAoKSA9PiBiLkV4cE9iamVjdCgiR2FtZVR1dG9yVGV4dDEiKQogICAgfSwKICAgIGEgPT4gewogICAgICAgIGNvbnN0IGIgPSBhLl9HZXROb2RlKDApOwogICAgICAgIHJldHVybiAoKSA9PiBiLkV4cE9iamVjdCgpCiAgICB9LCAoKSA9PiAxMjIsICgpID0+IDEyNCwgYSA9PiB7CiAgICAgICAgY29uc3QgYiA9IGEuX0dldE5vZGUoMCk7CiAgICAgICAgcmV0dXJuICgpID0+IGIuRXhwT2JqZWN0KCJHYW1lVHV0b3JUZXh0MiIpCiAgICB9LCAoKSA9PiAiVHV0b3JpYWwiLCBhID0+IHsKICAgICAgICBjb25zdCBiID0gYS5fR2V0Tm9kZSgwKSwKICAgICAgICAgICAgZCA9IGEuX0dldE5vZGUoMSkuR2V0VmFyKCk7CiAgICAgICAgcmV0dXJuICgpID0+IGIuRXhwT2JqZWN0KCkgLSBkLkdldFZhbHVlKCkgLSAxMAogICAgfSwKICAgIGEgPT4gewogICAgICAgIGNvbnN0IGIgPSBhLl9HZXROb2RlKDApOwogICAgICAgIHJldHVybiAoKSA9PiBiLkV4cE9iamVjdCgxKQogICAgfSwgKCkgPT4gIlBva2lHYW1lIiwgKCkgPT4gIkJVVFRPTlMgR0FNRSIsICgpID0+ICJTY2FsZUJ1dCIsCiAgICBhID0+IHsKICAgICAgICBjb25zdCBiID0gYS5fR2V0Tm9kZSgwKSwKICAgICAgICAgICAgZCA9IGEuX0dldE5vZGUoMSk7CiAgICAgICAgcmV0dXJuICgpID0+IGIuRXhwT2JqZWN0KCkgLSBkLkV4cE9iamVjdCgpIC8gOAogICAgfSwgKCkgPT4gIkxvYWRpbmdNYXAiLCBhID0+IHsKICAgICAgICBjb25zdCBiID0gYS5fR2V0Tm9kZSgwKS5HZXRWYXIoKSwKICAgICAgICAgICAgZCA9IGEuX0dldE5vZGUoMSkuR2V0VmFyKCksCiAgICAgICAgICAgIGMgPSBhLl9HZXROb2RlKDIpLkdldFZhcigpLAogICAgICAgICAgICBlID0gYS5fR2V0Tm9kZSgzKS5HZXRWYXIoKSwKICAgICAgICAgICAgZyA9IGEuX0dldE5vZGUoNCkuR2V0VmFyKCk7CiAgICAgICAgcmV0dXJuICgpID0+IGIuR2V0VmFsdWUoKSArIGQuR2V0VmFsdWUoKSAqIGMuR2V0VmFsdWUoKSArIGUuR2V0VmFsdWUoKSAqIGcuR2V0VmFsdWUoKQogICAgfSwKICAgIGEgPT4gewogICAgICAgIGNvbnN0IGIgPSBhLl9HZXROb2RlKDApLkdldEJvdW5kTWV0aG9kKCksCiAgICAgICAgICAgIGQgPSBhLl9HZXROb2RlKDEpLkdldFZhcigpLAogICAgICAgICAgICBjID0gYS5fR2V0Tm9kZSgyKS5HZXRWYXIoKTsKICAgICAgICByZXR1cm4gKCkgPT4gTWF0aC5mbG9vcihiKDUgKiBkLkdldFZhbHVlKCkgLSA3LCA1ICogYy5HZXRWYWx1ZSgpICsgMSkpCiAgICB9LAogICAgYSA9PiB7CiAgICAgICAgY29uc3QgYiA9IGEuX0dldE5vZGUoMCkuR2V0Qm91bmRNZXRob2QoKSwKICAgICAgICAgICAgZCA9IGEuX0dldE5vZGUoMSkuR2V0VmFyKCksCiAgICAgICAgICAgIGMgPSBhLl9HZXROb2RlKDIpLkdldFZhcigpLAogICAgICAgICAgICBlID0gYS5fR2V0Tm9kZSgzKS5HZXRWYXIoKTsKICAgICAgICByZXR1cm4gKCkgPT4gYihkLkdldFZhbHVlKCkgLSAyLCBjLkdldFZhbHVlKCksIGUuR2V0VmFsdWUoKSArIDEpCiAgICB9LAogICAgYSA9PiB7CiAgICAgICAgY29uc3QgYiA9IGEuX0dldE5vZGUoMCkuR2V0Qm91bmRNZXRob2QoKSwKICAgICAgICAgICAgZCA9IGEuX0dldE5vZGUoMSkuR2V0VmFyKCksCiAgICAgICAgICAgIGMgPSBhLl9HZXROb2RlKDIpLkdldFZhcigpOwogICAgICAgIHJldHVybiAoKSA9PiBiKGQuR2V0VmFsdWUoKSAtIDEsIGMuR2V0VmFsdWUoKSkKICAgIH0sCiAgICBhID0+IHsKICAgICAgICBjb25zdCBiID0gYS5fR2V0Tm9kZSgwKS5HZXRWYXIoKTsKICAgICAgICByZXR1cm4gKCkgPT4gKGIuR2V0VmFsdWUoKSArIDEpICUgMwogICAgfSwgKCkgPT4gNzQsICgpID0+IDUwLCBhID0+IHsKICAgICAgICBjb25zdCBiID0gYS5fR2V0Tm9kZSgwKS5HZXRWYXIoKTsKICAgICAgICByZXR1cm4gKCkgPT4gYi5HZXRWYWx1ZSgpLnRvU3RyaW5nKCkKICAgIH0sCiAgICBhID0+IHsKICAgICAgICBjb25zdCBiID0gYS5fR2V0Tm9kZSgwKS5HZXRCb3VuZE1ldGhvZCgpOwogICAgICAgIHJldHVybiAoKSA9PiBiKDEsIDIsIDMsIDYsIDExLCAxMiwgMTMsIDE2LCAxNywgMjYsIDI4LCAyOSwKICAgICAgICAgICAgMzAsIDM0LCA0MCwgNDEsIDQzLCA0NCwgNDYsIDQ4KQogICAgfSwKICAgIGEgPT4gewogICAgICAgIGNvbnN0IGIgPSBhLl9HZXROb2RlKDApLkdldEJvdW5kTWV0aG9kKCk7CiAgICAgICAgcmV0dXJuICgpID0+IGIoNDcsIDI5LCAyOCwgMjcsIDI0LCAyMSwgMTUsIDI2LCAxOSwgMTcsIDE2LCA3LCA2LCA1LCA0LCAzLCAyLCAwKQogICAgfSwKICAgIGEgPT4gewogICAgICAgIGNvbnN0IGIgPSBhLl9HZXROb2RlKDApLkdldEJvdW5kTWV0aG9kKCk7CiAgICAgICAgcmV0dXJuICgpID0+IGIoNDcsIDI5LCAyOCwgMjcsIDI0LCAyMSwgMTUsIDI2LCAxOSwgMTcsIDE2LCA3LCA2LCA1LCA0LCAzLCAyLCAwLCAyNSwgMTEsIDgpCiAgICB9LAogICAgYSA9PiB7CiAgICAgICAgY29uc3QgYiA9IGEuX0dldE5vZGUoMCkuR2V0Qm91bmRNZXRob2QoKTsKICAgICAgICByZXR1cm4gKCkgPT4gYig0NywgMjksIDI4LCAyNywgMjQsIDIxLCAxNSwgMjYsIDE5LCAxNywgMTYsIDcsIDYsIDUsIDQsIDMsIDIsIDAsIDI1LCAxMSwgOCwgMzAsIDIwLCAxNCwgMTMsIDEyLCAxMCwgOSwgMSkKICAgIH0sCiAgICBhID0+IHsKICAgICAgICBjb25zdCBiID0gYS5fR2V0Tm9kZSgwKS5HZXRCb3VuZE1ldGhvZCgpOwogICAgICAgIHJldHVybiAoKSA9PiBiKDAsIDEsIDIsIDMsIDQsIDUsIDYsIDcsIDgsIDksIDEwLCAxMSwgMTIsIDEzLCAxNCwgMTUsIDE2LCAxNywgMTksIDIwLCAyMSwgMjQsIDI1LCAyNiwgMjcsIDI4LCAyOSwKICAgICAgICAgICAgMzAsIDMyLCAzMywgMzQsIDM1LCAzNiwgMzcsIDM4LCA0MCwgNDEsIDQyLCA0MywgNDQsIDQ1LCA0NiwgNDcpCiAgICB9LCAoKSA9PiA0NywgKCkgPT4gMjgsICgpID0+IDQ4LCAoKSA9PiAiRmlnaHQyUGxheWVycyIsICgpID0+ICJQbGF5ZXIgMiIsICgpID0+ICJQbGF5ZXIgMSIsICgpID0+IDEwMCwgYSA9PiB7CiAgICAgICAgY29uc3QgYiA9IGEuX0dldE5vZGUoMCkuR2V0VmFyKCk7CiAgICAgICAgcmV0dXJuICgpID0+IGIuR2V0VmFsdWUoKSArIDYKICAgIH0sCiAgICBhID0+IHsKICAgICAgICBjb25zdCBiID0gYS5fR2V0Tm9kZSgwKS5HZXRCb3VuZE1ldGhvZCgpOwogICAgICAgIHJldHVybiAoKSA9PiBiKDAsIDEpCiAgICB9LCAoKSA9PiAiMCIsICgpID0+ICJGaWdodCIsICgpID0+ICJBSSIsIGEgPT4gewogICAgICAgIGNvbnN0IGIgPSBhLl9HZXROb2RlKDApLkdldEJvdW5kTWV0aG9kKCk7CiAgICAgICAgcmV0dXJuICgpID0+IGIoLjUsIDEuMikKICAgIH0sICgpID0+ICJUWVBFVFVUT1IiLCAoKSA9PiAiVFlQRTYiLCBhID0+IHsKICAgICAgICBjb25zdCBiID0gYS5fR2V0Tm9kZSgwKS5HZXRCb3VuZE1ldGhvZCgpOwogICAgICAgIHJldHVybiAoKSA9PiBiKDAsIDEsIDIsIDMsIDQsIDUsIDYsIDcpCiAgICB9LAogICAgYSA9PiB7CiAgICAgICAgY29uc3QgYiA9IGEuX0dldE5vZGUoMCkuR2V0VmFyKCk7CiAgICAgICAgcmV0dXJuICgpID0+ICJUWVBFIiArIGIuR2V0VmFsdWUoKS50b1N0cmluZygpCiAgICB9LAogICAgYSA9PiB7CiAgICAgICAgY29uc3QgYiA9IGEuX0dldE5vZGUoMCksCiAgICAgICAgICAgIGQgPSBhLl9HZXROb2RlKDEpLkdldFZhcigpOwogICAgICAgIHJldHVybiAoKSA9PiBiLkV4cE9iamVjdChkLkdldFZhbHVlKCkgLSAxKQogICAgfSwKICAgIGEgPT4gewogICAgICAgIGNvbnN0IGIgPSBhLl9HZXROb2RlKDApLkdldFZhcigpOwogICAgICAgIHJldHVybiAoKSA9PiAibWFwIiArIGIuR2V0VmFsdWUoKS50b1N0cmluZygpCiAgICB9LCAoKSA9PiAtNDEwLCAoKSA9PiAxNjkwLCAoKSA9PiAiVHV0b3JpYWwyUGxheWVycyIsIGEgPT4gewogICAgICAgIGNvbnN0IGIgPSBhLl9HZXROb2RlKDApLAogICAgICAgICAgICBkID0gYS5fR2V0Tm9kZSgxKS5HZXRWYXIoKTsKICAgICAgICByZXR1cm4gKCkgPT4gYi5FeHBPYmplY3QoKSA9PT0gZC5HZXRWYWx1ZSgpID8gMSA6IDAKICAgIH0sCiAgICBhID0+IHsKICAgICAgICBjb25zdCBiID0gYS5fR2V0Tm9kZSgwKSwKICAgICAgICAgICAgZCA9IGEuX0dldE5vZGUoMSk7CiAgICAgICAgcmV0dXJuICgpID0+IGIuRXhwT2JqZWN0KCkgLSBkLkV4cE9iamVjdCgpCiAgICB9LAogICAgYSA9PiB7CiAgICAgICAgY29uc3QgYiA9IGEuX0dldE5vZGUoMCksCiAgICAgICAgICAgIGQgPSBhLl9HZXROb2RlKDEpLkdldFZhcigpOwogICAgICAgIHJldHVybiAoKSA9PiBiLkV4cE9iamVjdCgpICsgZC5HZXRWYWx1ZSgpCiAgICB9LCAoKSA9PiA0MCwgKCkgPT4gNDYsICgpID0+ICJHdW5zIiwgKCkgPT4KICAgIDMyLCAoKSA9PiAzOCwgKCkgPT4gIlBvcnRhbHMiLCAoKSA9PiAyNSwgKCkgPT4gIlVGTyIsICgpID0+IDMwLCAoKSA9PiAyMCwgKCkgPT4gIkp1bXBlcnMiLCAoKSA9PiAuMiwgKCkgPT4gIlRpbWVyVHdlZW4iLCAoKSA9PiAyNiwgKCkgPT4gMjEsICgpID0+ICJTYXciLCAoKSA9PiAiTWFwcyIsICgpID0+ICJjYXJDb2xsaXNpb24iLCAoKSA9PiAibWFwNDAiLCBhID0+IHsKICAgICAgICBjb25zdCBiID0gYS5fR2V0Tm9kZSgwKS5HZXRCb3VuZE1ldGhvZCgpLAogICAgICAgICAgICBkID0gYS5fR2V0Tm9kZSgxKS5HZXRWYXIoKSwKICAgICAgICAgICAgYyA9IGEuX0dldE5vZGUoMikuR2V0VmFyKCk7CiAgICAgICAgcmV0dXJuICgpID0+IGIoZC5HZXRWYWx1ZSgpLCBjLkdldFZhbHVlKCkpCiAgICB9LCAoKSA9PiA0NTAsICgpID0+ICJtYXA0MSIsICgpID0+ICJtYXA0MiIsICgpID0+ICJtYXA0MyIsICgpID0+ICJtYXA0NCIsICgpID0+ICJtYXA0NSIsICgpID0+ICJtYXA0NiIsICgpID0+ICJCYWNrZ3JvdW5kcyIsICgpID0+ICJtYXAwIiwgKCkgPT4gIm1hcDEiLCAoKSA9PiAibWFwMiIsICgpID0+ICJtYXAzIiwgKCkgPT4gIm1hcDQiLCAoKSA9PiAibWFwNSIsICgpID0+ICJtYXA2IiwgKCkgPT4gIm1hcDciLCAoKSA9PiAibWFwOCIsICgpID0+ICJtYXA5IiwgKCkgPT4KICAgICJtYXAxMCIsICgpID0+ICJtYXAxMSIsICgpID0+ICJtYXAxMiIsICgpID0+ICJtYXAxMyIsICgpID0+ICJtYXAxNCIsICgpID0+ICJtYXAxNSIsICgpID0+ICJtYXAxNiIsICgpID0+ICJtYXAxNyIsICgpID0+ICJtYXAxOSIsICgpID0+ICJtYXAyMCIsICgpID0+ICJtYXAyMSIsICgpID0+ICJtYXAyNCIsICgpID0+ICJtYXAyNSIsICgpID0+ICJtYXAyNiIsICgpID0+ICJtYXAyNyIsICgpID0+ICJtYXAyOCIsICgpID0+ICJtYXAyOSIsICgpID0+ICJtYXAzMCIsICgpID0+ICJtYXAzMiIsICgpID0+ICJtYXAzMyIsICgpID0+ICJtYXAzNCIsICgpID0+ICJtYXAzNSIsICgpID0+ICJtYXAzNiIsICgpID0+ICJtYXAzNyIsICgpID0+ICJtYXAzOCIsICgpID0+ICJtYXA0NyIsICgpID0+ICJtYXA0OCIsIGEgPT4gewogICAgICAgIGNvbnN0IGIgPSBhLl9HZXROb2RlKDApOwogICAgICAgIHJldHVybiAoKSA9PiBiLkV4cE9iamVjdCgyKQogICAgfSwKICAgIGEgPT4gewogICAgICAgIGNvbnN0IGIgPSBhLl9HZXROb2RlKDApOwogICAgICAgIHJldHVybiAoKSA9PiBiLkV4cE9iamVjdCgiSGVhZCIpCiAgICB9LCAoKSA9PiAiQm9tYiIsICgpID0+ICJIZWFkIiwgYSA9PiB7CiAgICAgICAgY29uc3QgYiA9IGEuX0dldE5vZGUoMCksCiAgICAgICAgICAgIGQgPSBhLl9HZXROb2RlKDEpOwogICAgICAgIHJldHVybiAoKSA9PgogICAgICAgICAgICBiLkV4cEluc3RWYXIoKSAqIGQuRXhwSW5zdFZhcigpCiAgICB9LCAoKSA9PiAuMjUsICgpID0+IC0xLCBhID0+IHsKICAgICAgICBjb25zdCBiID0gYS5fR2V0Tm9kZSgwKTsKICAgICAgICByZXR1cm4gKCkgPT4gYi5FeHBCZWhhdmlvcigpCiAgICB9LCAoKSA9PiAiU2NhbGVKdW1wZXIiLCBhID0+IHsKICAgICAgICBjb25zdCBiID0gYS5fR2V0Tm9kZSgwKSwKICAgICAgICAgICAgZCA9IGEuX0dldE5vZGUoMSksCiAgICAgICAgICAgIGMgPSBhLl9HZXROb2RlKDIpOwogICAgICAgIHJldHVybiAoKSA9PiBiLkV4cEluc3RWYXIoKSAqIGQuRXhwSW5zdFZhcigpICsgYy5FeHBCZWhhdmlvcigpCiAgICB9LCAoKSA9PiAzNDAsICgpID0+IDIuNzUsICgpID0+IDE4MCwgYSA9PiB7CiAgICAgICAgY29uc3QgYiA9IGEuX0dldE5vZGUoMCk7CiAgICAgICAgcmV0dXJuICgpID0+IDk5NyA9PT0gYi5FeHBPYmplY3QoKSA/IDEgOiAwCiAgICB9LAogICAgYSA9PiB7CiAgICAgICAgY29uc3QgYiA9IGEuX0dldE5vZGUoMCk7CiAgICAgICAgcmV0dXJuICgpID0+IC05OTcgPT09IGIuRXhwT2JqZWN0KCkgPyAxIDogMAogICAgfSwgKCkgPT4gMTE4MCwgKCkgPT4gNzcwLCAoKSA9PiA3NjUsICgpID0+IDQuNSwgKCkgPT4gOTAwLCAoKSA9PiA5NTAsICgpID0+IDg4MCwgYSA9PiB7CiAgICAgICAgY29uc3QgYiA9IGEuX0dldE5vZGUoMCk7CiAgICAgICAgcmV0dXJuICgpID0+IDExMTUgPT09IGIuRXhwT2JqZWN0KCkgPyAxIDogMAogICAgfSwgKCkgPT4KICAgIDFFMywgYSA9PiB7CiAgICAgICAgY29uc3QgYiA9IGEuX0dldE5vZGUoMCk7CiAgICAgICAgcmV0dXJuICgpID0+IC0xMTE1ID09PSBiLkV4cE9iamVjdCgpID8gMSA6IDAKICAgIH0sICgpID0+IDIwMCwgKCkgPT4gIkdBTUUgU1RBUlRJTkcgVkFSSUFCTEVTIiwgKCkgPT4gIlRVVE9SSUFMIiwgYSA9PiB7CiAgICAgICAgY29uc3QgYiA9IGEuX0dldE5vZGUoMCkuR2V0VmFyKCk7CiAgICAgICAgcmV0dXJuICgpID0+IGFuZCgiRmlnaHRlciIsIGIuR2V0VmFsdWUoKSkKICAgIH0sICgpID0+ICJCQUxBTkNFIDJQTEFZRVJTIiwgKCkgPT4gIlNUQVJTIiwgKCkgPT4gIlRVVE9SSUFMMlBMQVlFUlMiLCAoKSA9PiAiQmFsYW5jZTJQbGF5ZXJzIiwgKCkgPT4gLjA1LCAoKSA9PiAiQmFsYW5jZTJQbGF5ZXJzUmV3YXJkIiwgKCkgPT4gIjJQbGF5ZXJzIiwgKCkgPT4gIkJBTEFOQ0UgVUkiLCBhID0+IHsKICAgICAgICBjb25zdCBiID0gYS5fR2V0Tm9kZSgwKS5HZXRWYXIoKSwKICAgICAgICAgICAgZCA9IGEuX0dldE5vZGUoMSkuR2V0VmFyKCk7CiAgICAgICAgcmV0dXJuICgpID0+IGIuR2V0VmFsdWUoKSAqIGQuR2V0VmFsdWUoKQogICAgfSwgKCkgPT4gIkZJR0hURVJDT0lOUyIsIGEgPT4gewogICAgICAgIGNvbnN0IGIgPSBhLl9HZXROb2RlKDApLkdldFZhcigpOwogICAgICAgIHJldHVybiAoKSA9PgogICAgICAgICAgICBNYXRoLmZsb29yKGIuR2V0VmFsdWUoKSAvIDMpCiAgICB9LAogICAgYSA9PiB7CiAgICAgICAgY29uc3QgYiA9IGEuX0dldE5vZGUoMCksCiAgICAgICAgICAgIGQgPSBhLl9HZXROb2RlKDEpLkdldFZhcigpLAogICAgICAgICAgICBjID0gYS5fR2V0Tm9kZSgyKS5HZXRWYXIoKTsKICAgICAgICByZXR1cm4gKCkgPT4gYWRkJGpzY29tcCQ0KGIuRXhwT2JqZWN0KE1hdGguZmxvb3IoZC5HZXRWYWx1ZSgpIC8gMykpLCBjLkdldFZhbHVlKCkgLSAxKQogICAgfSwKICAgIGEgPT4gewogICAgICAgIGNvbnN0IGIgPSBhLl9HZXROb2RlKDApLkdldFZhcigpOwogICAgICAgIHJldHVybiAoKSA9PiBiLkdldFZhbHVlKCkgJSAxMAogICAgfSwKICAgIGEgPT4gewogICAgICAgIGNvbnN0IGIgPSBhLl9HZXROb2RlKDApOwogICAgICAgIHJldHVybiAoKSA9PiBiLkV4cE9iamVjdCgiQmFsYW5jZVJlc3VsdFRleHRXaW4iKQogICAgfSwgKCkgPT4gIkJhbGFuY2UiLCBhID0+IHsKICAgICAgICBjb25zdCBiID0gYS5fR2V0Tm9kZSgwKS5HZXRWYXIoKTsKICAgICAgICByZXR1cm4gKCkgPT4gMTAwICsgMjUgKiBiLkdldFZhbHVlKCkKICAgIH0sCiAgICBhID0+IHsKICAgICAgICBjb25zdCBiID0gYS5fR2V0Tm9kZSgwKSwKICAgICAgICAgICAgZCA9IGEuX0dldE5vZGUoMSkuR2V0VmFyKCk7CiAgICAgICAgcmV0dXJuICgpID0+IGFkZCRqc2NvbXAkNChiLkV4cE9iamVjdChNYXRoLmZsb29yKGQuR2V0VmFsdWUoKSAvCiAgICAgICAgICAgIDMpKSwgMSkKICAgIH0sICgpID0+ICJCYWxhbmNlUmV3YXJkIiwgYSA9PiB7CiAgICAgICAgY29uc3QgYiA9IGEuX0dldE5vZGUoMCk7CiAgICAgICAgcmV0dXJuICgpID0+IGIuRXhwT2JqZWN0KCJCYWxhbmNlUmVzdWx0VGV4dExvc2UiKQogICAgfSwgKCkgPT4gIkJvbnVzIiwgKCkgPT4gIkRvdWJsZVJld2FyZCIsICgpID0+ICJzY29yZSIsICgpID0+ICJHSUZUQ09VTlRFUiIsIGEgPT4gewogICAgICAgIGNvbnN0IGIgPSBhLl9HZXROb2RlKDApLkdldFZhcigpOwogICAgICAgIHJldHVybiAoKSA9PiAiKyIgKyAoMTAwICsgMjUgKiBiLkdldFZhbHVlKCkpLnRvU3RyaW5nKCkKICAgIH0sICgpID0+ICJHQU1FIEVGRkVDVFMiLCAoKSA9PiAiYW5pbTEiLCAoKSA9PiAiVFlQRTAiLCAoKSA9PiAxNjAsIGEgPT4gewogICAgICAgIGNvbnN0IGIgPSBhLl9HZXROb2RlKDApLkdldEJvdW5kTWV0aG9kKCk7CiAgICAgICAgcmV0dXJuICgpID0+IGIoLjQsIC44KQogICAgfSwKICAgIGEgPT4gewogICAgICAgIGNvbnN0IGIgPSBhLl9HZXROb2RlKDApOwogICAgICAgIHJldHVybiAoKSA9PiBiLkV4cE9iamVjdCgpIC0gMjAKICAgIH0sCiAgICBhID0+IHsKICAgICAgICBjb25zdCBiID0gYS5fR2V0Tm9kZSgwKTsKICAgICAgICByZXR1cm4gKCkgPT4gYi5FeHBPYmplY3QoKSArIDIwCiAgICB9LCAoKSA9PiAiVFlQRTEiLCBhID0+IHsKICAgICAgICBjb25zdCBiID0gYS5fR2V0Tm9kZSgwKS5HZXRCb3VuZE1ldGhvZCgpOwogICAgICAgIHJldHVybiAoKSA9PiBiKC4zLCAuOCkKICAgIH0sICgpID0+ICJUWVBFMiIsIGEgPT4gewogICAgICAgIGNvbnN0IGIgPSBhLl9HZXROb2RlKDApLkdldEJvdW5kTWV0aG9kKCk7CiAgICAgICAgcmV0dXJuICgpID0+IGIoLjUsIDEpCiAgICB9LCAoKSA9PiAiVFlQRTMiLCBhID0+IHsKICAgICAgICBjb25zdCBiID0gYS5fR2V0Tm9kZSgwKS5HZXRCb3VuZE1ldGhvZCgpOwogICAgICAgIHJldHVybiAoKSA9PiBiKDEuNSwgMykKICAgIH0sCiAgICBhID0+IHsKICAgICAgICBjb25zdCBiID0gYS5fR2V0Tm9kZSgwKS5HZXRCb3VuZE1ldGhvZCgpOwogICAgICAgIHJldHVybiAoKSA9PiBiKDAsIDEsIDIpCiAgICB9LCAoKSA9PiAiVFlQRTQiLCBhID0+IHsKICAgICAgICBjb25zdCBiID0gYS5fR2V0Tm9kZSgwKS5HZXRCb3VuZE1ldGhvZCgpOwogICAgICAgIHJldHVybiAoKSA9PiBiKDQsIDYpCiAgICB9LCAoKSA9PiAiVFlQRTUiLCBhID0+IHsKICAgICAgICBjb25zdCBiID0gYS5fR2V0Tm9kZSgwKS5HZXRCb3VuZE1ldGhvZCgpOwogICAgICAgIHJldHVybiAoKSA9PiBiKDEsIDIpCiAgICB9LAogICAgYSA9PiB7CiAgICAgICAgY29uc3QgYiA9IGEuX0dldE5vZGUoMCkuR2V0Qm91bmRNZXRob2QoKTsKICAgICAgICByZXR1cm4gKCkgPT4gYigwLCAxLCAyLCAzLCA0KQogICAgfSwgKCkgPT4gIlRZUEU3IiwgKCkgPT4gLjQ1LCAoKSA9PiAiU0FXUyIsIGEgPT4gewogICAgICAgIGNvbnN0IGIgPSBhLl9HZXROb2RlKDApLAogICAgICAgICAgICBkID0gYS5fR2V0Tm9kZSgxKS5HZXRCb3VuZE1ldGhvZCgpOwogICAgICAgIHJldHVybiAoKSA9PiBiLkV4cE9iamVjdCgpICsgMTIwICogZCgpCiAgICB9LCAoKSA9PiAxMDgwLCBhID0+IHsKICAgICAgICBjb25zdCBiID0gYS5fR2V0Tm9kZSgwKSwKICAgICAgICAgICAgZCA9IGEuX0dldE5vZGUoMSkuR2V0Qm91bmRNZXRob2QoKTsKICAgICAgICByZXR1cm4gKCkgPT4gYi5FeHBPYmplY3QoKSAtIDEyMCAqIGQoKQogICAgfSwgKCkgPT4gLTIsICgpID0+IC41LCAoKSA9PiAiSFAgQkFSUyIsIGEgPT4gewogICAgICAgIGNvbnN0IGIgPSBhLl9HZXROb2RlKDApLkdldFZhcigpLAogICAgICAgICAgICBkID0gYS5fR2V0Tm9kZSgxKS5HZXRWYXIoKTsKICAgICAgICByZXR1cm4gKCkgPT4gYi5HZXRWYWx1ZSgpIC8gZC5HZXRWYWx1ZSgpICogMTA0CiAgICB9LAogICAgYSA9PiB7CiAgICAgICAgY29uc3QgYiA9IGEuX0dldE5vZGUoMCksCiAgICAgICAgICAgIGQgPSBhLl9HZXROb2RlKDEpLkdldFZhcigpOwogICAgICAgIHJldHVybiAoKSA9PiBiLkV4cE9iamVjdCgpIC0gZC5HZXRWYWx1ZSgpCiAgICB9LAogICAgYSA9PiB7CiAgICAgICAgY29uc3QgYiA9IGEuX0dldE5vZGUoMCk7CiAgICAgICAgcmV0dXJuICgpID0+IGIuRXhwT2JqZWN0KCkgKyAxMAogICAgfSwgKCkgPT4gNy41LCAoKSA9PiAiV0hFRUxTIEFORCBNT1ZFTUVOVCBDT0RFIiwgYSA9PiB7CiAgICAgICAgY29uc3QgYiA9IGEuX0dldE5vZGUoMCkuR2V0VmFyKCk7CiAgICAgICAgcmV0dXJuICgpID0+IC1iLkdldFZhbHVlKCkKICAgIH0sCiAgICBhID0+IHsKICAgICAgICBjb25zdCBiID0gYS5fR2V0Tm9kZSgwKS5HZXRWYXIoKTsKICAgICAgICByZXR1cm4gKCkgPT4gYi5HZXRWYWx1ZSgpIC8gMgogICAgfSwKICAgIGEgPT4gewogICAgICAgIGNvbnN0IGIgPSBhLl9HZXROb2RlKDApLkdldFZhcigpOwogICAgICAgIHJldHVybiAoKSA9PiAtYi5HZXRWYWx1ZSgpIC8gMgogICAgfSwKICAgIGEgPT4gewogICAgICAgIGNvbnN0IGIgPSBhLl9HZXROb2RlKDApLkdldFZhcigpOwogICAgICAgIHJldHVybiAoKSA9PiBiLkdldFZhbHVlKCkgLyAxLjUKICAgIH0sCiAgICBhID0+IHsKICAgICAgICBjb25zdCBiID0gYS5fR2V0Tm9kZSgwKS5HZXRWYXIoKTsKICAgICAgICByZXR1cm4gKCkgPT4gYi5HZXRWYWx1ZSgpIC8gMS43NQogICAgfSwgKCkgPT4gOTAsIGEgPT4gewogICAgICAgIGNvbnN0IGIgPSBhLl9HZXROb2RlKDApLkdldFZhcigpOwogICAgICAgIHJldHVybiAoKSA9PiA1ICogYi5HZXRWYWx1ZSgpCiAgICB9LAogICAgYSA9PiB7CiAgICAgICAgY29uc3QgYiA9IGEuX0dldE5vZGUoMCk7CiAgICAgICAgcmV0dXJuICgpID0+IGIuRXhwT2JqZWN0KCkgKyA5MAogICAgfSwgKCkgPT4gIkdBTUVQTEFZIENPREUiLCBhID0+IHsKICAgICAgICBjb25zdCBiID0gYS5fR2V0Tm9kZSgwKSwKICAgICAgICAgICAgZCA9IGEuX0dldE5vZGUoMSksCiAgICAgICAgICAgIGMgPSBhLl9HZXROb2RlKDIpLAogICAgICAgICAgICBlID0gYS5fR2V0Tm9kZSgzKTsKICAgICAgICByZXR1cm4gKCkgPT4KICAgICAgICAgICAgQzMkanNjb21wJDMxMi5kaXN0YW5jZVRvKGIuRXhwT2JqZWN0KCksIGQuRXhwT2JqZWN0KCksIGMuRXhwT2JqZWN0KDEpLCBlLkV4cE9iamVjdCgxKSkKICAgIH0sCiAgICBhID0+IHsKICAgICAgICBjb25zdCBiID0gYS5fR2V0Tm9kZSgwKSwKICAgICAgICAgICAgZCA9IGEuX0dldE5vZGUoMSksCiAgICAgICAgICAgIGMgPSBhLl9HZXROb2RlKDIpLAogICAgICAgICAgICBlID0gYS5fR2V0Tm9kZSgzKTsKICAgICAgICByZXR1cm4gKCkgPT4gQzMkanNjb21wJDMxMi5kaXN0YW5jZVRvKGIuRXhwT2JqZWN0KCksIGQuRXhwT2JqZWN0KCksIGMuRXhwT2JqZWN0KDIpLCBlLkV4cE9iamVjdCgyKSkKICAgIH0sCiAgICBhID0+IHsKICAgICAgICBjb25zdCBiID0gYS5fR2V0Tm9kZSgwKSwKICAgICAgICAgICAgZCA9IGEuX0dldE5vZGUoMSksCiAgICAgICAgICAgIGMgPSBhLl9HZXROb2RlKDIpLAogICAgICAgICAgICBlID0gYS5fR2V0Tm9kZSgzKTsKICAgICAgICByZXR1cm4gKCkgPT4gQzMkanNjb21wJDMxMi5kaXN0YW5jZVRvKGIuRXhwT2JqZWN0KCksIGQuRXhwT2JqZWN0KCksIGMuRXhwT2JqZWN0KDMpLCBlLkV4cE9iamVjdCgzKSkKICAgIH0sICgpID0+IDc1LCAoKSA9PiAiRmxvb3IiLCBhID0+IHsKICAgICAgICBjb25zdCBiID0gYS5fR2V0Tm9kZSgwKTsKICAgICAgICByZXR1cm4gKCkgPT4gYi5FeHBPYmplY3QoIlJlZFdpblRleHQiKQogICAgfSwKICAgICgpID0+ICJQTEFZRVIyV0lOUyIsIGEgPT4gewogICAgICAgIGNvbnN0IGIgPSBhLl9HZXROb2RlKDApLAogICAgICAgICAgICBkID0gYS5fR2V0Tm9kZSgxKS5HZXRWYXIoKTsKICAgICAgICByZXR1cm4gKCkgPT4gYWRkJGpzY29tcCQ0KGIuRXhwT2JqZWN0KGQuR2V0VmFsdWUoKSksIDYwKQogICAgfSwgKCkgPT4gIjEiLCAoKSA9PiAiKzE4IiwgKCkgPT4gIlNDT1JFIiwgYSA9PiB7CiAgICAgICAgY29uc3QgYiA9IGEuX0dldE5vZGUoMCkuR2V0VmFyKCk7CiAgICAgICAgcmV0dXJuICgpID0+IDIwICogYi5HZXRWYWx1ZSgpCiAgICB9LAogICAgYSA9PiB7CiAgICAgICAgY29uc3QgYiA9IGEuX0dldE5vZGUoMCkuR2V0VmFyKCk7CiAgICAgICAgcmV0dXJuICgpID0+ICIrIiArIGIuR2V0VmFsdWUoKS50b1N0cmluZygpCiAgICB9LAogICAgYSA9PiB7CiAgICAgICAgY29uc3QgYiA9IGEuX0dldE5vZGUoMCk7CiAgICAgICAgcmV0dXJuICgpID0+IGIuRXhwT2JqZWN0KCJCbHVlV2luVGV4dCIpCiAgICB9LCAoKSA9PiAiUExBWUVSMVdJTlMiLCAoKSA9PiAuMywgKCkgPT4gLTUsICgpID0+ICJVSSIsIGEgPT4gewogICAgICAgIGNvbnN0IGIgPSBhLl9HZXROb2RlKDApOwogICAgICAgIHJldHVybiAoKSA9PiBhbmQoIltvdXRsaW5lPXdoaXRlXSIsIGIuRXhwT2JqZWN0KCJCbHVlV2luVGV4dCIpKSArICJbL291dGxpbmVdIgogICAgfSwgKCkgPT4gInpoIiwKICAgICgpID0+ICJrbyIsICgpID0+ICJqYSIsICgpID0+ICJ0ciIsICgpID0+ICJBcmlhbCIsIGEgPT4gewogICAgICAgIGNvbnN0IGIgPSBhLl9HZXROb2RlKDApOwogICAgICAgIHJldHVybiAoKSA9PiBhbmQoIltvdXRsaW5lPXdoaXRlXSIsIGIuRXhwT2JqZWN0KCJSZWRXaW5UZXh0IikpICsgIlsvb3V0bGluZV0iCiAgICB9LCAoKSA9PiAiTEVBR1VFIiwgKCkgPT4gIlJFVFVSTiIsICgpID0+ICJNYWluTWVudSIsICgpID0+ICJIb21lQnV0dG9ucyIsICgpID0+ICJUb3BVSTFQbGF5ZXIiLCAoKSA9PiAiSG9tZSIsICgpID0+ICIyUGxheWVyc0J1dHRvbnMiLCAoKSA9PiAiR0FNRVBVU0ggU1lOQyIsIGEgPT4gewogICAgICAgIGNvbnN0IGIgPSBhLl9HZXROb2RlKDApLkdldEJvdW5kTWV0aG9kKCk7CiAgICAgICAgcmV0dXJuICgpID0+ICJQbGF5ZXIgIyIgKyBiKCkudG9TdHJpbmcoKQogICAgfSwgKCkgPT4gIkFWQVRBUl9DT0xPUiIsICgpID0+ICJBVkFUQVJfRkFDRSIsICgpID0+ICJBVkFUQVJfRVlFIiwgKCkgPT4gIkFWQVRBUl9NT1VUSCIsICgpID0+IC4xNSwgYSA9PiB7CiAgICAgICAgY29uc3QgYiA9IGEuX0dldE5vZGUoMCkuR2V0VmFyKCksCiAgICAgICAgICAgIGQgPSBhLl9HZXROb2RlKDEpLkdldFZhcigpLAogICAgICAgICAgICBjID0gYS5fR2V0Tm9kZSgyKS5HZXRWYXIoKSwKICAgICAgICAgICAgZSA9IGEuX0dldE5vZGUoMykuR2V0VmFyKCk7CiAgICAgICAgcmV0dXJuICgpID0+ICJodHRwczovL2FwaS5kaWNlYmVhci5jb20vNS54L2JvdHR0cy9wbmc/c2l6ZT05MCZiYXNlQ29sb3I9IiArIGIuR2V0VmFsdWUoKSArICImZXllcz0iICsgZC5HZXRWYWx1ZSgpICsgIiZmYWNlPSIgKyBjLkdldFZhbHVlKCkgKyAiJm1vdXRoPSIgKyBlLkdldFZhbHVlKCkgKyAiJnNpZGVzUHJvYmFiaWxpdHk9MCZ0ZXh0dXJlUHJvYmFiaWxpdHk9MCZ0b3BQcm9iYWJpbGl0eT0wIgogICAgfSwgKCkgPT4gIk1BSU4gTUVOVSIsIGEgPT4gewogICAgICAgIGNvbnN0IGIgPSBhLl9HZXROb2RlKDApLAogICAgICAgICAgICBkID0gYS5fR2V0Tm9kZSgxKS5HZXRWYXIoKTsKICAgICAgICByZXR1cm4gKCkgPT4gYi5FeHBPYmplY3QoZC5HZXRWYWx1ZSgpKQogICAgfSwgKCkgPT4gIk5ld0xlYWd1ZSIsIGEgPT4gewogICAgICAgIGNvbnN0IGIgPSBhLl9HZXROb2RlKDApLkdldFZhcigpOwogICAgICAgIHJldHVybiAoKSA9PiAiR2V0TGVhZ3VlIiArIGIuR2V0VmFsdWUoKS50b1N0cmluZygpCiAgICB9LAogICAgYSA9PiB7CiAgICAgICAgY29uc3QgYiA9IGEuX0dldE5vZGUoMCkuR2V0VmFyKCk7CiAgICAgICAgcmV0dXJuICgpID0+IGIuR2V0VmFsdWUoKSAlIDMKICAgIH0sCiAgICBhID0+IHsKICAgICAgICBjb25zdCBiID0gYS5fR2V0Tm9kZSgwKS5HZXRWYXIoKTsKICAgICAgICByZXR1cm4gKCkgPT4gMyAqIE1hdGguZmxvb3IoYi5HZXRWYWx1ZSgpIC8gMykKICAgIH0sCiAgICBhID0+IHsKICAgICAgICBjb25zdCBiID0gYS5fR2V0Tm9kZSgwKS5HZXRWYXIoKTsKICAgICAgICByZXR1cm4gKCkgPT4gMyAqIChNYXRoLmZsb29yKGIuR2V0VmFsdWUoKSAvIDMpICsgMSkgLSAxCiAgICB9LCAoKSA9PiAiUE9LSSBTSE9QIiwgKCkgPT4gIlRVVE9SSUFMIFNIT1AiLCAoKSA9PiAuNCwgKCkgPT4gMS4yLCAoKSA9PiAuOSwgYSA9PiB7CiAgICAgICAgY29uc3QgYiA9IGEuX0dldE5vZGUoMCk7CiAgICAgICAgcmV0dXJuICgpID0+IGIuRXhwSW5zdFZhcigpCiAgICB9LCAoKSA9PiAxLjI1LCAoKSA9PiAiMiIsICgpID0+ICIzIiwgYSA9PiB7CiAgICAgICAgY29uc3QgYiA9IGEuX0dldE5vZGUoMCk7CiAgICAgICAgcmV0dXJuICgpID0+IGIuRXhwT2JqZWN0KCJTaG9wVHV0b3JUZXh0MyIpCiAgICB9LAogICAgYSA9PiB7CiAgICAgICAgY29uc3QgYiA9IGEuX0dldE5vZGUoMCk7CiAgICAgICAgcmV0dXJuICgpID0+IGIuRXhwT2JqZWN0KCJTaG9wVHV0b3JUZXh0MSIpCiAgICB9LAogICAgYSA9PiB7CiAgICAgICAgY29uc3QgYiA9IGEuX0dldE5vZGUoMCk7CiAgICAgICAgcmV0dXJuICgpID0+IGIuRXhwT2JqZWN0KCJTaG9wVHV0b3JUZXh0MiIpCiAgICB9LCAoKSA9PiAiQVZBVEFSIEdFTkVSQVRPUiIsCiAgICAoKSA9PiAicm91bmQwMSIsICgpID0+ICJyb3VuZDAyIiwgKCkgPT4gInNxdWFyZTAxIiwgKCkgPT4gInNxdWFyZTAyIiwgKCkgPT4gInNxdWFyZTAzIiwgKCkgPT4gInNxdWFyZTA0IiwgKCkgPT4gImJ1bGdpbmciLCAoKSA9PiAiZGl6enkiLCAoKSA9PiAiZXZhIiwgKCkgPT4gImZyYW1lMSIsICgpID0+ICJmcmFtZTIiLCAoKSA9PiAiZ2xvdyIsICgpID0+ICJoYXBweSIsICgpID0+ICJoZWFydHMiLCAoKSA9PiAicm9ib2NvcCIsICgpID0+ICJyb3VuZCIsICgpID0+ICJyb3VuZEZyYW1lMDEiLCAoKSA9PiAicm91bmRGcmFtZTAyIiwgKCkgPT4gInNlbnNvciIsICgpID0+ICJzaGFkZTAxIiwgKCkgPT4gImJpdGUiLCAoKSA9PiAiZGlhZ3JhbSIsICgpID0+ICJncmlsbDAxIiwgKCkgPT4gImdyaWxsMDIiLCAoKSA9PiAiZ3JpbGwwMyIsICgpID0+ICJzbWlsZTAxIiwgKCkgPT4gInNtaWxlMDIiLCAoKSA9PiAiMDBhY2MxIiwgKCkgPT4gIjFlODhlNSIsICgpID0+ICI1ZTM1YjEiLCAoKSA9PiAiNmQ0YzQxIiwgKCkgPT4gIjdjYjM0MiIsICgpID0+ICI4ZTI0YWEiLCAoKSA9PiAiMDM5YmU1IiwgKCkgPT4gIjQzYTA0NyIsICgpID0+ICI1NDZlN2EiLCAoKSA9PiAiMDA4OTdiIiwKICAgICgpID0+ICIzOTQ5YWIiLCAoKSA9PiAiNzU3NTc1IiwgKCkgPT4gImMwY2EzMyIsICgpID0+ICJkODFiNjAiLCAoKSA9PiAiZTUzOTM1IiwgKCkgPT4gImY0NTExZSIsICgpID0+ICJmYjhjMDAiLCAoKSA9PiAiZmRkODM1IiwgKCkgPT4gImZmYjMwMCIsICgpID0+ICIyUExBWUVSUyIsICgpID0+IDM4MCwgYSA9PiB7CiAgICAgICAgY29uc3QgYiA9IGEuX0dldE5vZGUoMCkuR2V0Qm91bmRNZXRob2QoKSwKICAgICAgICAgICAgZCA9IGEuX0dldE5vZGUoMSk7CiAgICAgICAgcmV0dXJuICgpID0+IGIoZC5FeHBPYmplY3QoKSkKICAgIH0sICgpID0+IDIyLCAoKSA9PiAiUExBWUVSIENIT09TRSIsIGEgPT4gewogICAgICAgIGNvbnN0IGIgPSBhLl9HZXROb2RlKDApLkdldFZhcigpOwogICAgICAgIHJldHVybiAoKSA9PiBiLkdldFZhbHVlKCkgLSAxCiAgICB9LCAoKSA9PiAiRklHSFRDT1VOVEVSMlBMQVlFUlMiLCAoKSA9PiAiRnJlZVNraW5CdG4iLCAoKSA9PiAiTmV3U2tpbiIsICgpID0+ICJGcmVlQ2FyQnRuIiwgKCkgPT4gIk5ld0NhciIsICgpID0+IC0zLCAoKSA9PiAiT1BFTkVEU0tJTlMiLCBhID0+IHsKICAgICAgICBjb25zdCBiID0gYS5fR2V0Tm9kZSgwKS5HZXRWYXIoKTsKICAgICAgICByZXR1cm4gKCkgPT4gIk9wZW5Ta2luIiArIGIuR2V0VmFsdWUoKS50b1N0cmluZygpCiAgICB9LAogICAgKCkgPT4gIkZyZWVTdGFyIiwgKCkgPT4gIlN0YXJzIiwgKCkgPT4gIk5FVyBDQVIiLCAoKSA9PiAiT1BFTkVEQ0FSUyIsIGEgPT4gewogICAgICAgIGNvbnN0IGIgPSBhLl9HZXROb2RlKDApLkdldFZhcigpOwogICAgICAgIHJldHVybiAoKSA9PiAiT3BlbkNhciIgKyBiLkdldFZhbHVlKCkudG9TdHJpbmcoKQogICAgfSwgKCkgPT4gIkZyZWVDYXIiLCAoKSA9PiAiQ2FycyIsICgpID0+ICJFRElUIFBST0ZJTEUiLCAoKSA9PiAiQ2hvb3NlIGEgZ2FtZSBtb2RlIiwgKCkgPT4gIkVkaXRHYW1lUHJvZmlsZSIsIGEgPT4gewogICAgICAgIGNvbnN0IGIgPSBhLl9HZXROb2RlKDApLkdldEJvdW5kTWV0aG9kKCksCiAgICAgICAgICAgIGQgPSBhLl9HZXROb2RlKDEpOwogICAgICAgIHJldHVybiAoKSA9PiBiKGQuRXhwT2JqZWN0KCksICJcXFciLCAiZyIsICIiKQogICAgfSwgKCkgPT4gIkxFQUdVRSBNQU5BR0VSIiwgYSA9PiB7CiAgICAgICAgY29uc3QgYiA9IGEuX0dldE5vZGUoMCkuR2V0VmFyKCksCiAgICAgICAgICAgIGQgPSBhLl9HZXROb2RlKDEpLAogICAgICAgICAgICBjID0gYS5fR2V0Tm9kZSgyKS5HZXRWYXIoKTsKICAgICAgICByZXR1cm4gKCkgPT4gYi5HZXRWYWx1ZSgpLnRvU3RyaW5nKCkgKyAiLyIgKyBkLkV4cE9iamVjdChjLkdldFZhbHVlKCkpLnRvU3RyaW5nKCkKICAgIH0sCiAgICBhID0+IHsKICAgICAgICBjb25zdCBiID0gYS5fR2V0Tm9kZSgwKS5HZXRWYXIoKSwKICAgICAgICAgICAgZCA9IGEuX0dldE5vZGUoMSksCiAgICAgICAgICAgIGMgPSBhLl9HZXROb2RlKDIpLkdldFZhcigpOwogICAgICAgIHJldHVybiAoKSA9PiBtdWx0aXBseSRqc2NvbXAkMShkaXZpZGUkanNjb21wJDEoYi5HZXRWYWx1ZSgpLCBkLkV4cE9iamVjdChjLkdldFZhbHVlKCkpKSwgMjA0KQogICAgfSwKICAgIGEgPT4gewogICAgICAgIGNvbnN0IGIgPSBhLl9HZXROb2RlKDApLkdldFZhcigpLAogICAgICAgICAgICBkID0gYS5fR2V0Tm9kZSgxKSwKICAgICAgICAgICAgYyA9IGEuX0dldE5vZGUoMikuR2V0VmFyKCksCiAgICAgICAgICAgIGUgPSBhLl9HZXROb2RlKDMpLAogICAgICAgICAgICBnID0gYS5fR2V0Tm9kZSg0KS5HZXRWYXIoKSwKICAgICAgICAgICAgayA9IGEuX0dldE5vZGUoNSksCiAgICAgICAgICAgIG0gPSBhLl9HZXROb2RlKDYpLkdldFZhcigpOwogICAgICAgIHJldHVybiAoKSA9PiBtdWx0aXBseSRqc2NvbXAkMShkaXZpZGUkanNjb21wJDEoc3VidHJhY3QkanNjb21wJDEoYi5HZXRWYWx1ZSgpLCBkLkV4cE9iamVjdChjLkdldFZhbHVlKCkgLSAxKSksIHN1YnRyYWN0JGpzY29tcCQxKGUuRXhwT2JqZWN0KGcuR2V0VmFsdWUoKSksIGsuRXhwT2JqZWN0KG0uR2V0VmFsdWUoKSAtIDEpKSksCiAgICAgICAgICAgIDIwNCkKICAgIH0sICgpID0+IDIwNCwgYSA9PiB7CiAgICAgICAgY29uc3QgYiA9IGEuX0dldE5vZGUoMCkuR2V0Qm91bmRNZXRob2QoKTsKICAgICAgICByZXR1cm4gKCkgPT4gYig5NCwgNDAsIDMzKQogICAgfSwKICAgIGEgPT4gewogICAgICAgIGNvbnN0IGIgPSBhLl9HZXROb2RlKDApLkdldEJvdW5kTWV0aG9kKCk7CiAgICAgICAgcmV0dXJuICgpID0+IGIoNzcsIDc3LCA3NykKICAgIH0sCiAgICBhID0+IHsKICAgICAgICBjb25zdCBiID0gYS5fR2V0Tm9kZSgwKS5HZXRCb3VuZE1ldGhvZCgpOwogICAgICAgIHJldHVybiAoKSA9PiBiKDE2NSwgODUsIDI3KQogICAgfSwKICAgIGEgPT4gewogICAgICAgIGNvbnN0IGIgPSBhLl9HZXROb2RlKDApLkdldEJvdW5kTWV0aG9kKCk7CiAgICAgICAgcmV0dXJuICgpID0+IGIoMzksIDkxLCA4NykKICAgIH0sCiAgICBhID0+IHsKICAgICAgICBjb25zdCBiID0gYS5fR2V0Tm9kZSgwKS5HZXRCb3VuZE1ldGhvZCgpOwogICAgICAgIHJldHVybiAoKSA9PiBiKDc2LCA1MiwgMTA3KQogICAgfSwKICAgIGEgPT4gewogICAgICAgIGNvbnN0IGIgPSBhLl9HZXROb2RlKDApOwogICAgICAgIHJldHVybiAoKSA9PiBiLkV4cE9iamVjdCgiTGVhZ3VlTmFtZTEiKQogICAgfSwKICAgIGEgPT4gewogICAgICAgIGNvbnN0IGIgPSBhLl9HZXROb2RlKDApOwogICAgICAgIHJldHVybiAoKSA9PiBiLkV4cE9iamVjdCgiTGVhZ3VlTmFtZTIiKQogICAgfSwKICAgIGEgPT4gewogICAgICAgIGNvbnN0IGIgPSBhLl9HZXROb2RlKDApOwogICAgICAgIHJldHVybiAoKSA9PgogICAgICAgICAgICBiLkV4cE9iamVjdCgiTGVhZ3VlTmFtZTMiKQogICAgfSwKICAgIGEgPT4gewogICAgICAgIGNvbnN0IGIgPSBhLl9HZXROb2RlKDApOwogICAgICAgIHJldHVybiAoKSA9PiBiLkV4cE9iamVjdCgiTGVhZ3VlTmFtZTQiKQogICAgfSwKICAgIGEgPT4gewogICAgICAgIGNvbnN0IGIgPSBhLl9HZXROb2RlKDApOwogICAgICAgIHJldHVybiAoKSA9PiBiLkV4cE9iamVjdCgiTGVhZ3VlTmFtZTUiKQogICAgfSwgKCkgPT4gIkkiLCAoKSA9PiAiSUkiLCAoKSA9PiAiSUlJIiwgKCkgPT4gIlNFVFRJTkdTIiwgKCkgPT4gIlNldHRpbmdzIiwgKCkgPT4gIkNyZWRpdHMiLCBhID0+IHsKICAgICAgICBjb25zdCBiID0gYS5fR2V0Tm9kZSgwKSwKICAgICAgICAgICAgZCA9IGEuX0dldE5vZGUoMSk7CiAgICAgICAgcmV0dXJuICgpID0+IGIuRXhwT2JqZWN0KCkgLSBkLkV4cE9iamVjdCgpIC8gMTAKICAgIH0sICgpID0+ICJGSUdIVCBCVVRUT05TIiwgKCkgPT4gIkZJR0hUQ09VTlRFUiIsICgpID0+ICJCVVkgV0hFRUxTIiwgYSA9PiB7CiAgICAgICAgY29uc3QgYiA9IGEuX0dldE5vZGUoMCksCiAgICAgICAgICAgIGQgPSBhLl9HZXROb2RlKDEpOwogICAgICAgIHJldHVybiAoKSA9PiBiLkV4cE9iamVjdChkLkV4cEluc3RWYXIoKSkKICAgIH0sCiAgICBhID0+IHsKICAgICAgICBjb25zdCBiID0gYS5fR2V0Tm9kZSgwKTsKICAgICAgICByZXR1cm4gKCkgPT4gYi5FeHBPYmplY3QoKSArIDc1CiAgICB9LAogICAgYSA9PiB7CiAgICAgICAgY29uc3QgYiA9IGEuX0dldE5vZGUoMCk7CiAgICAgICAgcmV0dXJuICgpID0+IGIuRXhwT2JqZWN0KCkgLSA3NQogICAgfSwgKCkgPT4gIlNob3BXaGVlbHNCb3R0b20iLCBhID0+IHsKICAgICAgICBjb25zdCBiID0gYS5fR2V0Tm9kZSgwKSwKICAgICAgICAgICAgZCA9IGEuX0dldE5vZGUoMSksCiAgICAgICAgICAgIGMgPSBhLl9HZXROb2RlKDIpLAogICAgICAgICAgICBlID0gYS5fR2V0Tm9kZSgzKTsKICAgICAgICByZXR1cm4gKCkgPT4gYi5FeHBPYmplY3QoZC5FeHBJbnN0VmFyKCkpLnRvU3RyaW5nKCkgKyAiLyIgKyBjLkV4cE9iamVjdChlLkV4cEluc3RWYXIoKSkudG9TdHJpbmcoKQogICAgfSwgKCkgPT4gIlNob3BXaGVlbHMiLCAoKSA9PiAiU2hvcFdoZWVsczEiLCAoKSA9PiAiU2hvcFdoZWVsczIiLCBhID0+IHsKICAgICAgICBjb25zdCBiID0gYS5fR2V0Tm9kZSgwKSwKICAgICAgICAgICAgZCA9IGEuX0dldE5vZGUoMSksCiAgICAgICAgICAgIGMgPSBhLl9HZXROb2RlKDIpLAogICAgICAgICAgICBlID0gYS5fR2V0Tm9kZSgzKTsKICAgICAgICByZXR1cm4gKCkgPT4gc3VidHJhY3QkanNjb21wJDEoYi5FeHBPYmplY3QoZC5FeHBJbnN0VmFyKCkpLCBjLkV4cE9iamVjdChlLkV4cEluc3RWYXIoKSkpCiAgICB9LCAoKSA9PiAiV0hFRUxTRUxFQ1RFRCIsIGEgPT4gewogICAgICAgIGNvbnN0IGIgPSBhLl9HZXROb2RlKDApOwogICAgICAgIHJldHVybiAoKSA9PiAiQnV5V2hlZWxzIiArIGIuRXhwSW5zdFZhcigpLnRvU3RyaW5nKCkKICAgIH0sCiAgICBhID0+IHsKICAgICAgICBjb25zdCBiID0gYS5fR2V0Tm9kZSgwKSwKICAgICAgICAgICAgZCA9IGEuX0dldE5vZGUoMSk7CiAgICAgICAgcmV0dXJuICgpID0+IGFuZChhbmQoYi5FeHBPYmplY3QoIkRhbWFnZVRleHQiKSwgIjogIiksICg1MCArIDE1ICogZC5FeHBJbnN0VmFyKCkpLnRvU3RyaW5nKCkpCiAgICB9LAogICAgYSA9PiB7CiAgICAgICAgY29uc3QgYiA9IGEuX0dldE5vZGUoMCk7CiAgICAgICAgcmV0dXJuICgpID0+IE1hdGguZmxvb3IoYi5FeHBJbnN0VmFyKCkgLyAzKQogICAgfSwKICAgIGEgPT4gewogICAgICAgIGNvbnN0IGIgPSBhLl9HZXROb2RlKDApLkdldFZhcigpLAogICAgICAgICAgICBkID0gYS5fR2V0Tm9kZSgxKS5HZXRWYXIoKSwKICAgICAgICAgICAgYyA9IGEuX0dldE5vZGUoMikuR2V0VmFyKCk7CiAgICAgICAgcmV0dXJuICgpID0+IGIuR2V0VmFsdWUoKSArIGQuR2V0VmFsdWUoKSAqIGMuR2V0VmFsdWUoKQogICAgfSwKICAgIGEgPT4gewogICAgICAgIGNvbnN0IGIgPSBhLl9HZXROb2RlKDApLkdldFZhcigpLAogICAgICAgICAgICBkID0gYS5fR2V0Tm9kZSgxKS5HZXRWYXIoKSwKICAgICAgICAgICAgYyA9IGEuX0dldE5vZGUoMikuR2V0VmFyKCksCiAgICAgICAgICAgIGUgPSBhLl9HZXROb2RlKDMpLkdldFZhcigpOwogICAgICAgIHJldHVybiAoKSA9PiBiLkdldFZhbHVlKCkgKwogICAgICAgICAgICBkLkdldFZhbHVlKCkgKiBjLkdldFZhbHVlKCkgKyBlLkdldFZhbHVlKCkKICAgIH0sCiAgICBhID0+IHsKICAgICAgICBjb25zdCBiID0gYS5fR2V0Tm9kZSgwKS5HZXRWYXIoKSwKICAgICAgICAgICAgZCA9IGEuX0dldE5vZGUoMSkuR2V0VmFyKCk7CiAgICAgICAgcmV0dXJuICgpID0+IGIuR2V0VmFsdWUoKSArIGQuR2V0VmFsdWUoKQogICAgfSwKICAgIGEgPT4gewogICAgICAgIGNvbnN0IGIgPSBhLl9HZXROb2RlKDApLkdldFZhcigpLAogICAgICAgICAgICBkID0gYS5fR2V0Tm9kZSgxKS5HZXRWYXIoKSwKICAgICAgICAgICAgYyA9IGEuX0dldE5vZGUoMikuR2V0VmFyKCksCiAgICAgICAgICAgIGUgPSBhLl9HZXROb2RlKDMpLkdldFZhcigpOwogICAgICAgIHJldHVybiAoKSA9PiBiLkdldFZhbHVlKCkgKyBkLkdldFZhbHVlKCkgKiBjLkdldFZhbHVlKCkgLSBlLkdldFZhbHVlKCkKICAgIH0sCiAgICBhID0+IHsKICAgICAgICBjb25zdCBiID0gYS5fR2V0Tm9kZSgwKS5HZXRWYXIoKSwKICAgICAgICAgICAgZCA9IGEuX0dldE5vZGUoMSkuR2V0VmFyKCk7CiAgICAgICAgcmV0dXJuICgpID0+IGIuR2V0VmFsdWUoKSAtIGQuR2V0VmFsdWUoKQogICAgfSwgKCkgPT4gLjExLCBhID0+IHsKICAgICAgICBjb25zdCBiID0gYS5fR2V0Tm9kZSgwKS5HZXRCb3VuZE1ldGhvZCgpOwogICAgICAgIHJldHVybiAoKSA9PiBiKCkgJSA2CiAgICB9LAogICAgYSA9PiB7CiAgICAgICAgY29uc3QgYiA9IGEuX0dldE5vZGUoMCkuR2V0Qm91bmRNZXRob2QoKTsKICAgICAgICByZXR1cm4gKCkgPT4gYigpICUgMTIKICAgIH0sICgpID0+ICJGcmVlS2V5V2hlZWwiLCAoKSA9PiAiS2V5V2hlZWwiLCBhID0+IHsKICAgICAgICBjb25zdCBiID0gYS5fR2V0Tm9kZSgwKSwKICAgICAgICAgICAgZCA9IGEuX0dldE5vZGUoMSk7CiAgICAgICAgcmV0dXJuICgpID0+IGFkZCRqc2NvbXAkNChiLkV4cE9iamVjdChkLkV4cEluc3RWYXIoKSksIDEpCiAgICB9LCAoKSA9PiAiU2hvcENhckJvdHRvbSIsICgpID0+ICJCVVkgQ0FSUyIsICgpID0+ICJGcmVlS2V5Q2FyIiwgKCkgPT4gIktleUNhciIsICgpID0+ICJTaG9wQ2FyIiwgKCkgPT4gIlNob3BDYXIxIiwgKCkgPT4gIlNob3BDYXIyIiwgKCkgPT4gIkZJR0hURVJTRUxFQ1RFRCIsIGEgPT4gewogICAgICAgIGNvbnN0IGIgPSBhLl9HZXROb2RlKDApOwogICAgICAgIHJldHVybiAoKSA9PiAiQnV5Q2FyIiArIGIuRXhwSW5zdFZhcigpLnRvU3RyaW5nKCkKICAgIH0sCiAgICBhID0+IHsKICAgICAgICBjb25zdCBiID0gYS5fR2V0Tm9kZSgwKSwKICAgICAgICAgICAgZCA9IGEuX0dldE5vZGUoMSk7CiAgICAgICAgcmV0dXJuICgpID0+IGFuZChhbmQoYi5FeHBPYmplY3QoIkhlYWx0aFRleHQiKSwgIjogIiksICgxMDAgKyAyMCAqIGQuRXhwSW5zdFZhcigpKS50b1N0cmluZygpKQogICAgfSwgKCkgPT4gIlVQR1JBREVTIiwgKCkgPT4gIlVwZ3JhZGVzIiwKICAgIGEgPT4gewogICAgICAgIGNvbnN0IGIgPSBhLl9HZXROb2RlKDApLAogICAgICAgICAgICBkID0gYS5fR2V0Tm9kZSgxKS5HZXRWYXIoKTsKICAgICAgICByZXR1cm4gKCkgPT4gYi5FeHBPYmplY3QoZC5HZXRWYWx1ZSgpKS50b1N0cmluZygpCiAgICB9LAogICAgYSA9PiB7CiAgICAgICAgY29uc3QgYiA9IGEuX0dldE5vZGUoMCkuR2V0VmFyKCk7CiAgICAgICAgcmV0dXJuICgpID0+ICJMVkwgIiArIChiLkdldFZhbHVlKCkgKyAxKS50b1N0cmluZygpCiAgICB9LAogICAgYSA9PiB7CiAgICAgICAgY29uc3QgYiA9IGEuX0dldE5vZGUoMCkuR2V0VmFyKCk7CiAgICAgICAgcmV0dXJuICgpID0+ICIrIiArICgxMDAgKyA1MCAqIGIuR2V0VmFsdWUoKSkudG9TdHJpbmcoKQogICAgfSwKICAgIGEgPT4gewogICAgICAgIGNvbnN0IGIgPSBhLl9HZXROb2RlKDApLkdldFZhcigpOwogICAgICAgIHJldHVybiAoKSA9PiAxMDAgKyA1MCAqIGIuR2V0VmFsdWUoKQogICAgfSwgKCkgPT4gIkZyZWVHb2xkIiwgKCkgPT4gIkdvbGQiLCBhID0+IHsKICAgICAgICBjb25zdCBiID0gYS5fR2V0Tm9kZSgwKSwKICAgICAgICAgICAgZCA9IGEuX0dldE5vZGUoMSkuR2V0VmFyKCk7CiAgICAgICAgcmV0dXJuICgpID0+IHVuYXJ5bWludXMoYi5FeHBPYmplY3QoZC5HZXRWYWx1ZSgpKSkKICAgIH0sICgpID0+ICJEQU1BR0VMRVZFTCIsIGEgPT4gewogICAgICAgIGNvbnN0IGIgPSBhLl9HZXROb2RlKDApLkdldFZhcigpOwogICAgICAgIHJldHVybiAoKSA9PiAiVXBncmFkZURhbWFnZUx2bCIgKyBiLkdldFZhbHVlKCkudG9TdHJpbmcoKQogICAgfSwgKCkgPT4gInNjYWxlRG1nIiwgYSA9PiB7CiAgICAgICAgY29uc3QgYiA9IGEuX0dldE5vZGUoMCk7CiAgICAgICAgcmV0dXJuICgpID0+IGIuRXhwQmVoYXZpb3IoInNjYWxlRG1nIikKICAgIH0sICgpID0+ICJIUExFVkVMIiwgYSA9PiB7CiAgICAgICAgY29uc3QgYiA9IGEuX0dldE5vZGUoMCkuR2V0VmFyKCk7CiAgICAgICAgcmV0dXJuICgpID0+ICJVcGdyYWRlSHBMdmwiICsgYi5HZXRWYWx1ZSgpLnRvU3RyaW5nKCkKICAgIH0sICgpID0+ICJzY2FsZUhwIiwgYSA9PiB7CiAgICAgICAgY29uc3QgYiA9IGEuX0dldE5vZGUoMCk7CiAgICAgICAgcmV0dXJuICgpID0+IGIuRXhwQmVoYXZpb3IoInNjYWxlSHAiKQogICAgfSwgKCkgPT4gIk1BWCIsICgpID0+ICJTSE9QIENPREUiLCAoKSA9PiAzNjcuNSwgKCkgPT4gIkZyZWVLZXlNZW51IiwgKCkgPT4gIktleU1lbnUiLCBhID0+IHsKICAgICAgICBjb25zdCBiID0gYS5fR2V0Tm9kZSgwKSwKICAgICAgICAgICAgZCA9IGEuX0dldE5vZGUoMSkuR2V0VmFyKCk7CiAgICAgICAgcmV0dXJuICgpID0+IGIuRXhwT2JqZWN0KE1hdGguZmxvb3IoZC5HZXRWYWx1ZSgpIC8gMykpCiAgICB9LCAoKSA9PiAtMzYsICgpID0+ICJHSUZUIiwgKCkgPT4gIkdpZnQiLAogICAgYSA9PiB7CiAgICAgICAgY29uc3QgYiA9IGEuX0dldE5vZGUoMCksCiAgICAgICAgICAgIGQgPSBhLl9HZXROb2RlKDEpLkdldFZhcigpOwogICAgICAgIHJldHVybiAoKSA9PiAiKyIgKyBhZGQkanNjb21wJDQoYi5FeHBPYmplY3QoZC5HZXRWYWx1ZSgpKSwgNjApLnRvU3RyaW5nKCkKICAgIH0sCiAgICBhID0+IHsKICAgICAgICBjb25zdCBiID0gYS5fR2V0Tm9kZSgwKSwKICAgICAgICAgICAgZCA9IGEuX0dldE5vZGUoMSkuR2V0VmFyKCk7CiAgICAgICAgcmV0dXJuICgpID0+ICIrIiArIG11bHRpcGx5JGpzY29tcCQxKDIsIGFkZCRqc2NvbXAkNChiLkV4cE9iamVjdChkLkdldFZhbHVlKCkpLCA2MCkpLnRvU3RyaW5nKCkKICAgIH0sCiAgICBhID0+IHsKICAgICAgICBjb25zdCBiID0gYS5fR2V0Tm9kZSgwKS5HZXRWYXIoKTsKICAgICAgICByZXR1cm4gKCkgPT4gYi5HZXRWYWx1ZSgpLnRvU3RyaW5nKCkgKyAiLzUiCiAgICB9LCAoKSA9PiAiNS81IiwgYSA9PiB7CiAgICAgICAgY29uc3QgYiA9IGEuX0dldE5vZGUoMCksCiAgICAgICAgICAgIGQgPSBhLl9HZXROb2RlKDEpLkdldFZhcigpOwogICAgICAgIHJldHVybiAoKSA9PiBtdWx0aXBseSRqc2NvbXAkMSgyLCBhZGQkanNjb21wJDQoYi5FeHBPYmplY3QoZC5HZXRWYWx1ZSgpKSwgNjApKQogICAgfSwgKCkgPT4gIlJld2FyZEdpZnQiLCAoKSA9PiAiR0FSQUdFIiwKICAgIGEgPT4gewogICAgICAgIGNvbnN0IGIgPSBhLl9HZXROb2RlKDApLAogICAgICAgICAgICBkID0gYS5fR2V0Tm9kZSgxKS5HZXRCb3VuZE1ldGhvZCgpOwogICAgICAgIHJldHVybiAoKSA9PiBiLkV4cE9iamVjdChkKCkpCiAgICB9LAogICAgYSA9PiB7CiAgICAgICAgY29uc3QgYiA9IGEuX0dldE5vZGUoMCksCiAgICAgICAgICAgIGQgPSBhLl9HZXROb2RlKDEpLkdldEJvdW5kTWV0aG9kKCk7CiAgICAgICAgcmV0dXJuICgpID0+IGIuRXhwT2JqZWN0KE1hdGguZmxvb3IoZCgpIC8gMykpCiAgICB9LCAoKSA9PiAiR2FyYWdlIiwgKCkgPT4gIlJld2FyZEtleSIsICgpID0+ICJMT0NBTCBURVhUIiwgKCkgPT4gIlRJVFRMRSBTQ1JFRU4iLCAoKSA9PiAiREFUQSBMT0FESU5HOiBTVEFSVCIsIGEgPT4gewogICAgICAgIGNvbnN0IGIgPSBhLl9HZXROb2RlKDApLkdldEJvdW5kTWV0aG9kKCk7CiAgICAgICAgcmV0dXJuICgpID0+IGIoIm5hdmlnYXRvci5tYXhUb3VjaFBvaW50cyIpCiAgICB9LCAoKSA9PiAiREFUQSBMT0FESU5HOiBGSU5JU0giLCAoKSA9PiAiR0FNRSBBTkFMWVRJQ1MiLCAoKSA9PiAiTE9BRElORyBHQU1FIiwgKCkgPT4gIkxPQyIsICgpID0+ICJpbnB1dGJveE1vYmlsZS5jc3MiLCAoKSA9PiAiaW5wdXRib3guY3NzIiwgKCkgPT4gIkxPQURJTkcgS0VZUyBBUlJBWSIsCiAgICAoKSA9PiAiS0VZU19BUlJfMCIsICgpID0+ICJLRVlTX0FSUl8xIiwgKCkgPT4gIktFWVNfQVJSXzIiLCAoKSA9PiAiS0VZU19BUlJfMyIsICgpID0+ICJLRVlTX0FSUl80IiwgYSA9PiB7CiAgICAgICAgY29uc3QgYiA9IGEuX0dldE5vZGUoMCkuR2V0Qm91bmRNZXRob2QoKTsKICAgICAgICByZXR1cm4gKCkgPT4gIktFWVNfQVJSXyIgKyBiKCkudG9TdHJpbmcoKQogICAgfSwgKCkgPT4gIkxPQURJTkcgQ0FSUyBBUlJBWSIsICgpID0+ICJDQVJTX0FSUl8wIiwgKCkgPT4gIkNBUlNfQVJSXzEiLCAoKSA9PiAiQ0FSU19BUlJfMiIsICgpID0+ICJDQVJTX0FSUl8zIiwgKCkgPT4gIkNBUlNfQVJSXzQiLCAoKSA9PiAiQ0FSU19BUlJfNSIsICgpID0+ICJDQVJTX0FSUl82IiwgKCkgPT4gIkNBUlNfQVJSXzciLCAoKSA9PiAiQ0FSU19BUlJfOCIsICgpID0+ICJDQVJTX0FSUl85IiwgKCkgPT4gIkNBUlNfQVJSXzEwIiwgKCkgPT4gIkNBUlNfQVJSXzExIiwgKCkgPT4gIkNBUlNfQVJSXzEyIiwgKCkgPT4gIkNBUlNfQVJSXzEzIiwgKCkgPT4gIkNBUlNfQVJSXzE0IiwgYSA9PiB7CiAgICAgICAgY29uc3QgYiA9IGEuX0dldE5vZGUoMCkuR2V0Qm91bmRNZXRob2QoKTsKICAgICAgICByZXR1cm4gKCkgPT4KICAgICAgICAgICAgIkNBUlNfQVJSXyIgKyBiKCkudG9TdHJpbmcoKQogICAgfSwgKCkgPT4gIkxPQURJTkcgV0hFRUxTIEFSUkFZIiwgKCkgPT4gIldIRUVMU19BUlJfMCIsICgpID0+ICJXSEVFTFNfQVJSXzEiLCAoKSA9PiAiV0hFRUxTX0FSUl8yIiwgKCkgPT4gIldIRUVMU19BUlJfMyIsICgpID0+ICJXSEVFTFNfQVJSXzQiLCAoKSA9PiAiV0hFRUxTX0FSUl81IiwgKCkgPT4gIldIRUVMU19BUlJfNiIsICgpID0+ICJXSEVFTFNfQVJSXzciLCAoKSA9PiAiV0hFRUxTX0FSUl84IiwgKCkgPT4gIldIRUVMU19BUlJfOSIsICgpID0+ICJXSEVFTFNfQVJSXzEwIiwgKCkgPT4gIldIRUVMU19BUlJfMTEiLCAoKSA9PiAiV0hFRUxTX0FSUl8xMiIsICgpID0+ICJXSEVFTFNfQVJSXzEzIiwgKCkgPT4gIldIRUVMU19BUlJfMTQiLCBhID0+IHsKICAgICAgICBjb25zdCBiID0gYS5fR2V0Tm9kZSgwKS5HZXRCb3VuZE1ldGhvZCgpOwogICAgICAgIHJldHVybiAoKSA9PiAiV0hFRUxTX0FSUl8iICsgYigpLnRvU3RyaW5nKCkKICAgIH0sICgpID0+ICJDUkVBVEUgTEVBR1VFUyBBUlJBWVMiLCAoKSA9PiA2MCwgKCkgPT4gMjMwLCAoKSA9PiA1MDAsICgpID0+IDY2MCwgKCkgPT4gODcwLCAoKSA9PiAxMTUwLAogICAgKCkgPT4gMTQ0MCwgKCkgPT4gMTc1MCwgKCkgPT4gMjA4MCwgKCkgPT4gMjQzMCwgKCkgPT4gMjgwMCwgKCkgPT4gNDUsICgpID0+IDEyNSwgKCkgPT4gMTUwLCAoKSA9PiAxNzUsICgpID0+IDIyNSwgKCkgPT4gMjUwLCAoKSA9PiAyNzUsICgpID0+IDMwMCwgKCkgPT4gMzI1LCAoKSA9PiAzNTAsICgpID0+ICJDUkVBVEUgTkVXIFVQR1JBREVTIEFSUkFZIiwgKCkgPT4gODAsICgpID0+IDExMCwgKCkgPT4gMTQwLCAoKSA9PiAxNzAsICgpID0+IDIxMCwgKCkgPT4gMjIwLCAoKSA9PiAxOSwgKCkgPT4gMjQwLCAoKSA9PiAyNjAsICgpID0+IDI3MCwgKCkgPT4gMjgwLCAoKSA9PiAyMywgKCkgPT4gMjkwLCAoKSA9PiAyNCwgKCkgPT4gMzIwLCAoKSA9PiAzMzAsICgpID0+IDI3LCAoKSA9PiAyOSwgKCkgPT4gMzEsICgpID0+IDM5MCwgKCkgPT4gNDAwLCAoKSA9PiAzMywgKCkgPT4gNDEwLCAoKSA9PiAzNCwgKCkgPT4gNDIwLCAoKSA9PiAzNSwgKCkgPT4gNDQwLCAoKSA9PiAzNiwgKCkgPT4gMzcsICgpID0+IDQ2MCwgKCkgPT4gNDcwLCAoKSA9PiAzOSwgKCkgPT4gNDgwLCAoKSA9PiA0MSwgKCkgPT4gNTEwLCAoKSA9PiA0MiwgKCkgPT4gNTIwLCAoKSA9PiA0MywgKCkgPT4gNTMwLCAoKSA9PiA0NCwgKCkgPT4gNTQwLCAoKSA9PiA1NjAsICgpID0+IDU3MCwgKCkgPT4gNTgwLCAoKSA9PiA1OTAsICgpID0+CiAgICA0OSwgKCkgPT4gNjAwLCAoKSA9PiA2MjAsICgpID0+IDUxLCAoKSA9PiA2MzAsICgpID0+IDUyLCAoKSA9PiA1MywgKCkgPT4gNjUwLCAoKSA9PiA1NCwgKCkgPT4gNTUsICgpID0+IDY4MCwgKCkgPT4gNTYsICgpID0+IDY5MCwgKCkgPT4gNTcsICgpID0+IDcwMCwgKCkgPT4gNTgsICgpID0+IDcxMCwgKCkgPT4gNTksICgpID0+IDcyMCwgKCkgPT4gNzQwLCAoKSA9PiA2MSwgKCkgPT4gNzUwLCAoKSA9PiA2MiwgKCkgPT4gNzYwLCAoKSA9PiA2MywgKCkgPT4gNjQsICgpID0+IDc4MCwgKCkgPT4gNjUsICgpID0+IDgwMCwgKCkgPT4gNjYsICgpID0+IDgxMCwgKCkgPT4gNjcsICgpID0+IDgyMCwgKCkgPT4gNjgsICgpID0+IDgzMCwgKCkgPT4gNjksICgpID0+IDg0MCwgKCkgPT4gNzAsICgpID0+IDg2MCwgKCkgPT4gNzEsICgpID0+IDcyLCAoKSA9PiA3MywgKCkgPT4gODkwLCAoKSA9PiAiQ1JFQVRFIE5FVyBLRVlTIEFSUkFZIiwgKCkgPT4gIkxPQ0FMSVpBVElPTiIsICgpID0+ICJsYW5ndWFnZSIsICgpID0+ICJlbiIsICgpID0+ICJydSIsICgpID0+ICJmciIsICgpID0+ICJpdCIsICgpID0+ICJkZSIsICgpID0+ICJlcyIsICgpID0+ICJwdCIsIGEgPT4gewogICAgICAgIGNvbnN0IGIgPSBhLl9HZXROb2RlKDApLAogICAgICAgICAgICBkID0gYS5fR2V0Tm9kZSgxKTsKICAgICAgICByZXR1cm4gKCkgPT4gYi5FeHBPYmplY3QoZC5FeHBJbnN0VmFyX0ZhbWlseSgpKQogICAgfSwKICAgICgpID0+ICJOSUNLIEJBU0UiLCAoKSA9PiAiTmlja0Jhc2UiLCAoKSA9PiAiUE9LSSBTREsgQ09OU1RSVUNUIEZVTkNUSU9OUyIKXTsKdmFyIG1vZHVsZSRzdHIkYzNydW50aW1lID0ge307CnZhciBtb2R1bGUkc3RyJF9fYzNyb290X18gPSB7fTs=