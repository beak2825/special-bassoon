data:application/octet-stream;base64,Ly8gR2VuZXJhdGVkIGJ5IENvbnN0cnVjdCwgdGhlIGdhbWUgYW5kIGFwcCBjcmVhdG9yIDo6IGh0dHBzOi8vd3d3LmNvbnN0cnVjdC5uZXQKLy8gLi4vM3JkcGFydHkvZ2xtYXRyaXguanMKewogICAgLyoKICAgICBAZmlsZW92ZXJ2aWV3IGdsLW1hdHJpeCAtIEhpZ2ggcGVyZm9ybWFuY2UgbWF0cml4IGFuZCB2ZWN0b3Igb3BlcmF0aW9ucwogICAgQGF1dGhvciBCcmFuZG9uIEpvbmVzCiAgICBAYXV0aG9yIENvbGluIE1hY0tlbnppZSBJVgogICAgQHZlcnNpb24gMy40LjEKCiAgICBDb3B5cmlnaHQgKGMpIDIwMTUtMjAyMSwgQnJhbmRvbiBKb25lcywgQ29saW4gTWFjS2VuemllIElWLgoKICAgIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkKICAgIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0byBkZWFsCiAgICBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzCiAgICB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsCiAgICBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMKICAgIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6CgogICAgVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4KICAgIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLgoKICAgIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SCiAgICBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwKICAgIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRQogICAgQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUgogICAgTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwKICAgIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4KICAgIFRIRSBTT0ZUV0FSRS4KCiAgICAqLwogICAgJ3VzZSBzdHJpY3QnOwogICAgKGZ1bmN0aW9uKGdsb2JhbCwgZmFjdG9yeSkgewogICAgICAgIHR5cGVvZiBleHBvcnRzID09PSAib2JqZWN0IiAmJiB0eXBlb2YgbW9kdWxlICE9PSAidW5kZWZpbmVkIiA/IGZhY3RvcnkoZXhwb3J0cykgOiB0eXBlb2YgZGVmaW5lID09PSAiZnVuY3Rpb24iICYmIGRlZmluZS5hbWQgPyBkZWZpbmUoWyJleHBvcnRzIl0sIGZhY3RvcnkpIDogKGdsb2JhbCA9IHR5cGVvZiBnbG9iYWxUaGlzICE9PSAidW5kZWZpbmVkIiA/IGdsb2JhbFRoaXMgOiBnbG9iYWwgfHwgc2VsZiwgZmFjdG9yeShnbG9iYWwuZ2xNYXRyaXggPSB7fSkpCiAgICB9KSh0aGlzLCBmdW5jdGlvbihleHBvcnRzKSB7CiAgICAgICAgdmFyIEVQU0lMT04gPSAxRS02OwogICAgICAgIHZhciBBUlJBWV9UWVBFID0gdHlwZW9mIEZsb2F0MzJBcnJheSAhPT0gInVuZGVmaW5lZCIgPyBGbG9hdDMyQXJyYXkgOiBBcnJheTsKICAgICAgICB2YXIgUkFORE9NID0gTWF0aC5yYW5kb207CiAgICAgICAgdmFyIEFOR0xFX09SREVSID0gInp5eCI7CgogICAgICAgIGZ1bmN0aW9uIHNldE1hdHJpeEFycmF5VHlwZSh0eXBlKSB7CiAgICAgICAgICAgIEFSUkFZX1RZUEUgPSB0eXBlCiAgICAgICAgfQogICAgICAgIHZhciBkZWdyZWUgPSBNYXRoLlBJIC8gMTgwOwoKICAgICAgICBmdW5jdGlvbiB0b1JhZGlhbihhKSB7CiAgICAgICAgICAgIHJldHVybiBhICoKICAgICAgICAgICAgICAgIGRlZ3JlZQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZXF1YWxzJDkoYSwgYikgewogICAgICAgICAgICByZXR1cm4gTWF0aC5hYnMoYSAtIGIpIDw9IEVQU0lMT04gKiBNYXRoLm1heCgxLCBNYXRoLmFicyhhKSwgTWF0aC5hYnMoYikpCiAgICAgICAgfQogICAgICAgIGlmICghTWF0aC5oeXBvdCkgTWF0aC5oeXBvdCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgeSA9IDAsCiAgICAgICAgICAgICAgICBpID0gYXJndW1lbnRzLmxlbmd0aDsKICAgICAgICAgICAgd2hpbGUgKGktLSkgeSArPSBhcmd1bWVudHNbaV0gKiBhcmd1bWVudHNbaV07CiAgICAgICAgICAgIHJldHVybiBNYXRoLnNxcnQoeSkKICAgICAgICB9OwogICAgICAgIHZhciBjb21tb24gPSBPYmplY3QuZnJlZXplKHsKICAgICAgICAgICAgX19wcm90b19fOiBudWxsLAogICAgICAgICAgICBFUFNJTE9OOiBFUFNJTE9OLAogICAgICAgICAgICBnZXQgQVJSQVlfVFlQRSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBBUlJBWV9UWVBFCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFJBTkRPTTogUkFORE9NLAogICAgICAgICAgICBBTkdMRV9PUkRFUjogQU5HTEVfT1JERVIsCiAgICAgICAgICAgIHNldE1hdHJpeEFycmF5VHlwZTogc2V0TWF0cml4QXJyYXlUeXBlLAogICAgICAgICAgICB0b1JhZGlhbjogdG9SYWRpYW4sCiAgICAgICAgICAgIGVxdWFsczogZXF1YWxzJDkKICAgICAgICB9KTsKCiAgICAgICAgZnVuY3Rpb24gY3JlYXRlJDgoKSB7CiAgICAgICAgICAgIHZhciBvdXQgPSBuZXcgQVJSQVlfVFlQRSg0KTsKICAgICAgICAgICAgaWYgKEFSUkFZX1RZUEUgIT0gRmxvYXQzMkFycmF5KSB7CiAgICAgICAgICAgICAgICBvdXRbMV0gPQogICAgICAgICAgICAgICAgICAgIDA7CiAgICAgICAgICAgICAgICBvdXRbMl0gPSAwCiAgICAgICAgICAgIH0KICAgICAgICAgICAgb3V0WzBdID0gMTsKICAgICAgICAgICAgb3V0WzNdID0gMTsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gY2xvbmUkOChhKSB7CiAgICAgICAgICAgIHZhciBvdXQgPSBuZXcgQVJSQVlfVFlQRSg0KTsKICAgICAgICAgICAgb3V0WzBdID0gYVswXTsKICAgICAgICAgICAgb3V0WzFdID0gYVsxXTsKICAgICAgICAgICAgb3V0WzJdID0gYVsyXTsKICAgICAgICAgICAgb3V0WzNdID0gYVszXTsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gY29weSQ4KG91dCwgYSkgewogICAgICAgICAgICBvdXRbMF0gPSBhWzBdOwogICAgICAgICAgICBvdXRbMV0gPSBhWzFdOwogICAgICAgICAgICBvdXRbMl0gPSBhWzJdOwogICAgICAgICAgICBvdXRbM10gPSBhWzNdOwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBpZGVudGl0eSQ1KG91dCkgewogICAgICAgICAgICBvdXRbMF0gPSAxOwogICAgICAgICAgICBvdXRbMV0gPSAwOwogICAgICAgICAgICBvdXRbMl0gPSAwOwogICAgICAgICAgICBvdXRbM10gPSAxOwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBmcm9tVmFsdWVzJDgobTAwLCBtMDEsIG0xMCwgbTExKSB7CiAgICAgICAgICAgIHZhciBvdXQgPSBuZXcgQVJSQVlfVFlQRSg0KTsKICAgICAgICAgICAgb3V0WzBdID0gbTAwOwogICAgICAgICAgICBvdXRbMV0gPSBtMDE7CiAgICAgICAgICAgIG91dFsyXSA9IG0xMDsKICAgICAgICAgICAgb3V0WzNdID0gbTExOwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBzZXQkOChvdXQsIG0wMCwgbTAxLCBtMTAsIG0xMSkgewogICAgICAgICAgICBvdXRbMF0gPSBtMDA7CiAgICAgICAgICAgIG91dFsxXSA9IG0wMTsKICAgICAgICAgICAgb3V0WzJdID0gbTEwOwogICAgICAgICAgICBvdXRbM10gPSBtMTE7CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHRyYW5zcG9zZSQyKG91dCwgYSkgewogICAgICAgICAgICBpZiAob3V0ID09PSBhKSB7CiAgICAgICAgICAgICAgICB2YXIgYTEgPSBhWzFdOwogICAgICAgICAgICAgICAgb3V0WzFdID0gYVsyXTsKICAgICAgICAgICAgICAgIG91dFsyXSA9IGExCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBvdXRbMF0gPSBhWzBdOwogICAgICAgICAgICAgICAgb3V0WzFdID0gYVsyXTsKICAgICAgICAgICAgICAgIG91dFsyXSA9IGFbMV07CiAgICAgICAgICAgICAgICBvdXRbM10gPSBhWzNdCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gaW52ZXJ0JDUob3V0LCBhKSB7CiAgICAgICAgICAgIHZhciBhMCA9IGFbMF0sCiAgICAgICAgICAgICAgICBhMSA9IGFbMV0sCiAgICAgICAgICAgICAgICBhMiA9IGFbMl0sCiAgICAgICAgICAgICAgICBhMyA9IGFbM107CiAgICAgICAgICAgIHZhciBkZXQgPSBhMCAqIGEzIC0gYTIgKiBhMTsKICAgICAgICAgICAgaWYgKCFkZXQpIHJldHVybiBudWxsOwogICAgICAgICAgICBkZXQgPSAxIC8gZGV0OwogICAgICAgICAgICBvdXRbMF0gPSBhMyAqIGRldDsKICAgICAgICAgICAgb3V0WzFdID0gLWExICogZGV0OwogICAgICAgICAgICBvdXRbMl0gPSAtYTIgKiBkZXQ7CiAgICAgICAgICAgIG91dFszXSA9IGEwICogZGV0OwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBhZGpvaW50JDIob3V0LCBhKSB7CiAgICAgICAgICAgIHZhciBhMCA9IGFbMF07CiAgICAgICAgICAgIG91dFswXSA9IGFbM107CiAgICAgICAgICAgIG91dFsxXSA9IC1hWzFdOwogICAgICAgICAgICBvdXRbMl0gPSAtYVsyXTsKICAgICAgICAgICAgb3V0WzNdID0gYTA7CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGRldGVybWluYW50JDMoYSkgewogICAgICAgICAgICByZXR1cm4gYVswXSAqIGFbM10gLSBhWzJdICogYVsxXQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gbXVsdGlwbHkkOChvdXQsIGEsIGIpIHsKICAgICAgICAgICAgdmFyIGEwID0KICAgICAgICAgICAgICAgIGFbMF0sCiAgICAgICAgICAgICAgICBhMSA9IGFbMV0sCiAgICAgICAgICAgICAgICBhMiA9IGFbMl0sCiAgICAgICAgICAgICAgICBhMyA9IGFbM107CiAgICAgICAgICAgIHZhciBiMCA9IGJbMF0sCiAgICAgICAgICAgICAgICBiMSA9IGJbMV0sCiAgICAgICAgICAgICAgICBiMiA9IGJbMl0sCiAgICAgICAgICAgICAgICBiMyA9IGJbM107CiAgICAgICAgICAgIG91dFswXSA9IGEwICogYjAgKyBhMiAqIGIxOwogICAgICAgICAgICBvdXRbMV0gPSBhMSAqIGIwICsgYTMgKiBiMTsKICAgICAgICAgICAgb3V0WzJdID0gYTAgKiBiMiArIGEyICogYjM7CiAgICAgICAgICAgIG91dFszXSA9IGExICogYjIgKyBhMyAqIGIzOwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiByb3RhdGUkNChvdXQsIGEsIHJhZCkgewogICAgICAgICAgICB2YXIgYTAgPSBhWzBdLAogICAgICAgICAgICAgICAgYTEgPSBhWzFdLAogICAgICAgICAgICAgICAgYTIgPSBhWzJdLAogICAgICAgICAgICAgICAgYTMgPSBhWzNdOwogICAgICAgICAgICB2YXIgcyA9IE1hdGguc2luKHJhZCk7CiAgICAgICAgICAgIHZhciBjID0gTWF0aC5jb3MocmFkKTsKICAgICAgICAgICAgb3V0WzBdID0gYTAgKiBjICsgYTIgKiBzOwogICAgICAgICAgICBvdXRbMV0gPSBhMSAqIGMgKyBhMyAqIHM7CiAgICAgICAgICAgIG91dFsyXSA9IGEwICogLXMgKyBhMiAqIGM7CiAgICAgICAgICAgIG91dFszXSA9IGExICogLXMgKyBhMyAqIGM7CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHNjYWxlJDgob3V0LCBhLCB2KSB7CiAgICAgICAgICAgIHZhciBhMCA9IGFbMF0sCiAgICAgICAgICAgICAgICBhMSA9IGFbMV0sCiAgICAgICAgICAgICAgICBhMiA9IGFbMl0sCiAgICAgICAgICAgICAgICBhMyA9IGFbM107CiAgICAgICAgICAgIHZhciB2MCA9IHZbMF0sCiAgICAgICAgICAgICAgICB2MSA9IHZbMV07CiAgICAgICAgICAgIG91dFswXSA9IGEwICogdjA7CiAgICAgICAgICAgIG91dFsxXSA9IGExICogdjA7CiAgICAgICAgICAgIG91dFsyXSA9IGEyICogdjE7CiAgICAgICAgICAgIG91dFszXSA9IGEzICogdjE7CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGZyb21Sb3RhdGlvbiQ0KG91dCwKICAgICAgICAgICAgcmFkKSB7CiAgICAgICAgICAgIHZhciBzID0gTWF0aC5zaW4ocmFkKTsKICAgICAgICAgICAgdmFyIGMgPSBNYXRoLmNvcyhyYWQpOwogICAgICAgICAgICBvdXRbMF0gPSBjOwogICAgICAgICAgICBvdXRbMV0gPSBzOwogICAgICAgICAgICBvdXRbMl0gPSAtczsKICAgICAgICAgICAgb3V0WzNdID0gYzsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZnJvbVNjYWxpbmckMyhvdXQsIHYpIHsKICAgICAgICAgICAgb3V0WzBdID0gdlswXTsKICAgICAgICAgICAgb3V0WzFdID0gMDsKICAgICAgICAgICAgb3V0WzJdID0gMDsKICAgICAgICAgICAgb3V0WzNdID0gdlsxXTsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gc3RyJDgoYSkgewogICAgICAgICAgICByZXR1cm4gIm1hdDIoIiArIGFbMF0gKyAiLCAiICsgYVsxXSArICIsICIgKyBhWzJdICsgIiwgIiArIGFbM10gKyAiKSIKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGZyb2IkMyhhKSB7CiAgICAgICAgICAgIHJldHVybiBNYXRoLmh5cG90KGFbMF0sIGFbMV0sIGFbMl0sIGFbM10pCiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBMRFUoTCwgRCwgVSwgYSkgewogICAgICAgICAgICBMWzJdID0gYVsyXSAvIGFbMF07CiAgICAgICAgICAgIFVbMF0gPSBhWzBdOwogICAgICAgICAgICBVWzFdID0gYVsxXTsKICAgICAgICAgICAgVVszXSA9IGFbM10gLSBMWzJdICogVVsxXTsKICAgICAgICAgICAgcmV0dXJuIFtMLCBELCBVXQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gYWRkJDgob3V0LCBhLCBiKSB7CiAgICAgICAgICAgIG91dFswXSA9IGFbMF0gKyBiWzBdOwogICAgICAgICAgICBvdXRbMV0gPSBhWzFdICsgYlsxXTsKICAgICAgICAgICAgb3V0WzJdID0gYVsyXSArIGJbMl07CiAgICAgICAgICAgIG91dFszXSA9IGFbM10gKyBiWzNdOwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBzdWJ0cmFjdCQ2KG91dCwKICAgICAgICAgICAgYSwgYikgewogICAgICAgICAgICBvdXRbMF0gPSBhWzBdIC0gYlswXTsKICAgICAgICAgICAgb3V0WzFdID0gYVsxXSAtIGJbMV07CiAgICAgICAgICAgIG91dFsyXSA9IGFbMl0gLSBiWzJdOwogICAgICAgICAgICBvdXRbM10gPSBhWzNdIC0gYlszXTsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZXhhY3RFcXVhbHMkOChhLCBiKSB7CiAgICAgICAgICAgIHJldHVybiBhWzBdID09PSBiWzBdICYmIGFbMV0gPT09IGJbMV0gJiYgYVsyXSA9PT0gYlsyXSAmJiBhWzNdID09PSBiWzNdCiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBlcXVhbHMkOChhLCBiKSB7CiAgICAgICAgICAgIHZhciBhMCA9IGFbMF0sCiAgICAgICAgICAgICAgICBhMSA9IGFbMV0sCiAgICAgICAgICAgICAgICBhMiA9IGFbMl0sCiAgICAgICAgICAgICAgICBhMyA9IGFbM107CiAgICAgICAgICAgIHZhciBiMCA9IGJbMF0sCiAgICAgICAgICAgICAgICBiMSA9IGJbMV0sCiAgICAgICAgICAgICAgICBiMiA9IGJbMl0sCiAgICAgICAgICAgICAgICBiMyA9IGJbM107CiAgICAgICAgICAgIHJldHVybiBNYXRoLmFicyhhMCAtIGIwKSA8PSBFUFNJTE9OICogTWF0aC5tYXgoMSwgTWF0aC5hYnMoYTApLCBNYXRoLmFicyhiMCkpICYmIE1hdGguYWJzKGExIC0gYjEpIDw9IEVQU0lMT04gKiBNYXRoLm1heCgxLCBNYXRoLmFicyhhMSksIE1hdGguYWJzKGIxKSkgJiYgTWF0aC5hYnMoYTIgLSBiMikgPD0gRVBTSUxPTiAqIE1hdGgubWF4KDEsIE1hdGguYWJzKGEyKSwgTWF0aC5hYnMoYjIpKSAmJiBNYXRoLmFicyhhMyAtIGIzKSA8PSBFUFNJTE9OICogTWF0aC5tYXgoMSwgTWF0aC5hYnMoYTMpLAogICAgICAgICAgICAgICAgTWF0aC5hYnMoYjMpKQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gbXVsdGlwbHlTY2FsYXIkMyhvdXQsIGEsIGIpIHsKICAgICAgICAgICAgb3V0WzBdID0gYVswXSAqIGI7CiAgICAgICAgICAgIG91dFsxXSA9IGFbMV0gKiBiOwogICAgICAgICAgICBvdXRbMl0gPSBhWzJdICogYjsKICAgICAgICAgICAgb3V0WzNdID0gYVszXSAqIGI7CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIG11bHRpcGx5U2NhbGFyQW5kQWRkJDMob3V0LCBhLCBiLCBzY2FsZSkgewogICAgICAgICAgICBvdXRbMF0gPSBhWzBdICsgYlswXSAqIHNjYWxlOwogICAgICAgICAgICBvdXRbMV0gPSBhWzFdICsgYlsxXSAqIHNjYWxlOwogICAgICAgICAgICBvdXRbMl0gPSBhWzJdICsgYlsyXSAqIHNjYWxlOwogICAgICAgICAgICBvdXRbM10gPSBhWzNdICsgYlszXSAqIHNjYWxlOwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQogICAgICAgIHZhciBtdWwkOCA9IG11bHRpcGx5JDg7CiAgICAgICAgdmFyIHN1YiQ2ID0gc3VidHJhY3QkNjsKICAgICAgICB2YXIgbWF0MiA9IE9iamVjdC5mcmVlemUoewogICAgICAgICAgICBfX3Byb3RvX186IG51bGwsCiAgICAgICAgICAgIGNyZWF0ZTogY3JlYXRlJDgsCiAgICAgICAgICAgIGNsb25lOiBjbG9uZSQ4LAogICAgICAgICAgICBjb3B5OiBjb3B5JDgsCiAgICAgICAgICAgIGlkZW50aXR5OiBpZGVudGl0eSQ1LAogICAgICAgICAgICBmcm9tVmFsdWVzOiBmcm9tVmFsdWVzJDgsCiAgICAgICAgICAgIHNldDogc2V0JDgsCiAgICAgICAgICAgIHRyYW5zcG9zZTogdHJhbnNwb3NlJDIsCiAgICAgICAgICAgIGludmVydDogaW52ZXJ0JDUsCiAgICAgICAgICAgIGFkam9pbnQ6IGFkam9pbnQkMiwKICAgICAgICAgICAgZGV0ZXJtaW5hbnQ6IGRldGVybWluYW50JDMsCiAgICAgICAgICAgIG11bHRpcGx5OiBtdWx0aXBseSQ4LAogICAgICAgICAgICByb3RhdGU6IHJvdGF0ZSQ0LAogICAgICAgICAgICBzY2FsZTogc2NhbGUkOCwKICAgICAgICAgICAgZnJvbVJvdGF0aW9uOiBmcm9tUm90YXRpb24kNCwKICAgICAgICAgICAgZnJvbVNjYWxpbmc6IGZyb21TY2FsaW5nJDMsCiAgICAgICAgICAgIHN0cjogc3RyJDgsCiAgICAgICAgICAgIGZyb2I6IGZyb2IkMywKICAgICAgICAgICAgTERVOiBMRFUsCiAgICAgICAgICAgIGFkZDogYWRkJDgsCiAgICAgICAgICAgIHN1YnRyYWN0OiBzdWJ0cmFjdCQ2LAogICAgICAgICAgICBleGFjdEVxdWFsczogZXhhY3RFcXVhbHMkOCwKICAgICAgICAgICAgZXF1YWxzOiBlcXVhbHMkOCwKICAgICAgICAgICAgbXVsdGlwbHlTY2FsYXI6IG11bHRpcGx5U2NhbGFyJDMsCiAgICAgICAgICAgIG11bHRpcGx5U2NhbGFyQW5kQWRkOiBtdWx0aXBseVNjYWxhckFuZEFkZCQzLAogICAgICAgICAgICBtdWw6IG11bCQ4LAogICAgICAgICAgICBzdWI6IHN1YiQ2CiAgICAgICAgfSk7CgogICAgICAgIGZ1bmN0aW9uIGNyZWF0ZSQ3KCkgewogICAgICAgICAgICB2YXIgb3V0ID0gbmV3IEFSUkFZX1RZUEUoNik7CiAgICAgICAgICAgIGlmIChBUlJBWV9UWVBFICE9IEZsb2F0MzJBcnJheSkgewogICAgICAgICAgICAgICAgb3V0WzFdID0gMDsKICAgICAgICAgICAgICAgIG91dFsyXSA9IDA7CiAgICAgICAgICAgICAgICBvdXRbNF0gPSAwOwogICAgICAgICAgICAgICAgb3V0WzVdID0gMAogICAgICAgICAgICB9CiAgICAgICAgICAgIG91dFswXSA9IDE7CiAgICAgICAgICAgIG91dFszXSA9IDE7CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGNsb25lJDcoYSkgewogICAgICAgICAgICB2YXIgb3V0ID0gbmV3IEFSUkFZX1RZUEUoNik7CiAgICAgICAgICAgIG91dFswXSA9IGFbMF07CiAgICAgICAgICAgIG91dFsxXSA9IGFbMV07CiAgICAgICAgICAgIG91dFsyXSA9IGFbMl07CiAgICAgICAgICAgIG91dFszXSA9IGFbM107CiAgICAgICAgICAgIG91dFs0XSA9IGFbNF07CiAgICAgICAgICAgIG91dFs1XSA9IGFbNV07CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGNvcHkkNyhvdXQsIGEpIHsKICAgICAgICAgICAgb3V0WzBdID0gYVswXTsKICAgICAgICAgICAgb3V0WzFdID0gYVsxXTsKICAgICAgICAgICAgb3V0WzJdID0gYVsyXTsKICAgICAgICAgICAgb3V0WzNdID0gYVszXTsKICAgICAgICAgICAgb3V0WzRdID0gYVs0XTsKICAgICAgICAgICAgb3V0WzVdID0gYVs1XTsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gaWRlbnRpdHkkNChvdXQpIHsKICAgICAgICAgICAgb3V0WzBdID0gMTsKICAgICAgICAgICAgb3V0WzFdID0gMDsKICAgICAgICAgICAgb3V0WzJdID0gMDsKICAgICAgICAgICAgb3V0WzNdID0gMTsKICAgICAgICAgICAgb3V0WzRdID0gMDsKICAgICAgICAgICAgb3V0WzVdID0gMDsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZnJvbVZhbHVlcyQ3KGEsIGIsIGMsIGQsIHR4LCB0eSkgewogICAgICAgICAgICB2YXIgb3V0ID0gbmV3IEFSUkFZX1RZUEUoNik7CiAgICAgICAgICAgIG91dFswXSA9IGE7CiAgICAgICAgICAgIG91dFsxXSA9IGI7CiAgICAgICAgICAgIG91dFsyXSA9IGM7CiAgICAgICAgICAgIG91dFszXSA9IGQ7CiAgICAgICAgICAgIG91dFs0XSA9IHR4OwogICAgICAgICAgICBvdXRbNV0gPSB0eTsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gc2V0JDcob3V0LCBhLCBiLCBjLCBkLCB0eCwgdHkpIHsKICAgICAgICAgICAgb3V0WzBdID0gYTsKICAgICAgICAgICAgb3V0WzFdID0gYjsKICAgICAgICAgICAgb3V0WzJdID0gYzsKICAgICAgICAgICAgb3V0WzNdID0gZDsKICAgICAgICAgICAgb3V0WzRdID0gdHg7CiAgICAgICAgICAgIG91dFs1XSA9IHR5OwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBpbnZlcnQkNChvdXQsCiAgICAgICAgICAgIGEpIHsKICAgICAgICAgICAgdmFyIGFhID0gYVswXSwKICAgICAgICAgICAgICAgIGFiID0gYVsxXSwKICAgICAgICAgICAgICAgIGFjID0gYVsyXSwKICAgICAgICAgICAgICAgIGFkID0gYVszXTsKICAgICAgICAgICAgdmFyIGF0eCA9IGFbNF0sCiAgICAgICAgICAgICAgICBhdHkgPSBhWzVdOwogICAgICAgICAgICB2YXIgZGV0ID0gYWEgKiBhZCAtIGFiICogYWM7CiAgICAgICAgICAgIGlmICghZGV0KSByZXR1cm4gbnVsbDsKICAgICAgICAgICAgZGV0ID0gMSAvIGRldDsKICAgICAgICAgICAgb3V0WzBdID0gYWQgKiBkZXQ7CiAgICAgICAgICAgIG91dFsxXSA9IC1hYiAqIGRldDsKICAgICAgICAgICAgb3V0WzJdID0gLWFjICogZGV0OwogICAgICAgICAgICBvdXRbM10gPSBhYSAqIGRldDsKICAgICAgICAgICAgb3V0WzRdID0gKGFjICogYXR5IC0gYWQgKiBhdHgpICogZGV0OwogICAgICAgICAgICBvdXRbNV0gPSAoYWIgKiBhdHggLSBhYSAqIGF0eSkgKiBkZXQ7CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGRldGVybWluYW50JDIoYSkgewogICAgICAgICAgICByZXR1cm4gYVswXSAqIGFbM10gLSBhWzFdICogYVsyXQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gbXVsdGlwbHkkNyhvdXQsIGEsIGIpIHsKICAgICAgICAgICAgdmFyIGEwID0gYVswXSwKICAgICAgICAgICAgICAgIGExID0gYVsxXSwKICAgICAgICAgICAgICAgIGEyID0gYVsyXSwKICAgICAgICAgICAgICAgIGEzID0gYVszXSwKICAgICAgICAgICAgICAgIGE0ID0gYVs0XSwKICAgICAgICAgICAgICAgIGE1ID0gYVs1XTsKICAgICAgICAgICAgdmFyIGIwID0gYlswXSwKICAgICAgICAgICAgICAgIGIxID0gYlsxXSwKICAgICAgICAgICAgICAgIGIyID0gYlsyXSwKICAgICAgICAgICAgICAgIGIzID0gYlszXSwKICAgICAgICAgICAgICAgIGI0ID0gYls0XSwKICAgICAgICAgICAgICAgIGI1ID0gYls1XTsKICAgICAgICAgICAgb3V0WzBdID0gYTAgKiBiMCArIGEyICogYjE7CiAgICAgICAgICAgIG91dFsxXSA9IGExICogYjAgKyBhMyAqIGIxOwogICAgICAgICAgICBvdXRbMl0gPSBhMCAqIGIyICsgYTIgKiBiMzsKICAgICAgICAgICAgb3V0WzNdID0gYTEgKiBiMiArIGEzICogYjM7CiAgICAgICAgICAgIG91dFs0XSA9CiAgICAgICAgICAgICAgICBhMCAqIGI0ICsgYTIgKiBiNSArIGE0OwogICAgICAgICAgICBvdXRbNV0gPSBhMSAqIGI0ICsgYTMgKiBiNSArIGE1OwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiByb3RhdGUkMyhvdXQsIGEsIHJhZCkgewogICAgICAgICAgICB2YXIgYTAgPSBhWzBdLAogICAgICAgICAgICAgICAgYTEgPSBhWzFdLAogICAgICAgICAgICAgICAgYTIgPSBhWzJdLAogICAgICAgICAgICAgICAgYTMgPSBhWzNdLAogICAgICAgICAgICAgICAgYTQgPSBhWzRdLAogICAgICAgICAgICAgICAgYTUgPSBhWzVdOwogICAgICAgICAgICB2YXIgcyA9IE1hdGguc2luKHJhZCk7CiAgICAgICAgICAgIHZhciBjID0gTWF0aC5jb3MocmFkKTsKICAgICAgICAgICAgb3V0WzBdID0gYTAgKiBjICsgYTIgKiBzOwogICAgICAgICAgICBvdXRbMV0gPSBhMSAqIGMgKyBhMyAqIHM7CiAgICAgICAgICAgIG91dFsyXSA9IGEwICogLXMgKyBhMiAqIGM7CiAgICAgICAgICAgIG91dFszXSA9IGExICogLXMgKyBhMyAqIGM7CiAgICAgICAgICAgIG91dFs0XSA9IGE0OwogICAgICAgICAgICBvdXRbNV0gPSBhNTsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gc2NhbGUkNyhvdXQsIGEsIHYpIHsKICAgICAgICAgICAgdmFyIGEwID0gYVswXSwKICAgICAgICAgICAgICAgIGExID0gYVsxXSwKICAgICAgICAgICAgICAgIGEyID0gYVsyXSwKICAgICAgICAgICAgICAgIGEzID0gYVszXSwKICAgICAgICAgICAgICAgIGE0ID0gYVs0XSwKICAgICAgICAgICAgICAgIGE1ID0gYVs1XTsKICAgICAgICAgICAgdmFyIHYwID0gdlswXSwKICAgICAgICAgICAgICAgIHYxID0gdlsxXTsKICAgICAgICAgICAgb3V0WzBdID0gYTAgKiB2MDsKICAgICAgICAgICAgb3V0WzFdID0gYTEgKiB2MDsKICAgICAgICAgICAgb3V0WzJdID0gYTIgKiB2MTsKICAgICAgICAgICAgb3V0WzNdID0gYTMgKiB2MTsKICAgICAgICAgICAgb3V0WzRdID0gYTQ7CiAgICAgICAgICAgIG91dFs1XSA9IGE1OwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiB0cmFuc2xhdGUkMyhvdXQsIGEsIHYpIHsKICAgICAgICAgICAgdmFyIGEwID0gYVswXSwKICAgICAgICAgICAgICAgIGExID0gYVsxXSwKICAgICAgICAgICAgICAgIGEyID0gYVsyXSwKICAgICAgICAgICAgICAgIGEzID0gYVszXSwKICAgICAgICAgICAgICAgIGE0ID0gYVs0XSwKICAgICAgICAgICAgICAgIGE1ID0gYVs1XTsKICAgICAgICAgICAgdmFyIHYwID0gdlswXSwKICAgICAgICAgICAgICAgIHYxID0gdlsxXTsKICAgICAgICAgICAgb3V0WzBdID0gYTA7CiAgICAgICAgICAgIG91dFsxXSA9IGExOwogICAgICAgICAgICBvdXRbMl0gPSBhMjsKICAgICAgICAgICAgb3V0WzNdID0gYTM7CiAgICAgICAgICAgIG91dFs0XSA9IGEwICogdjAgKyBhMiAqIHYxICsgYTQ7CiAgICAgICAgICAgIG91dFs1XSA9IGExICogdjAgKyBhMyAqIHYxICsgYTU7CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGZyb21Sb3RhdGlvbiQzKG91dCwgcmFkKSB7CiAgICAgICAgICAgIHZhciBzID0gTWF0aC5zaW4ocmFkKSwKICAgICAgICAgICAgICAgIGMgPSBNYXRoLmNvcyhyYWQpOwogICAgICAgICAgICBvdXRbMF0gPSBjOwogICAgICAgICAgICBvdXRbMV0gPSBzOwogICAgICAgICAgICBvdXRbMl0gPSAtczsKICAgICAgICAgICAgb3V0WzNdID0gYzsKICAgICAgICAgICAgb3V0WzRdID0gMDsKICAgICAgICAgICAgb3V0WzVdID0gMDsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZnJvbVNjYWxpbmckMihvdXQsIHYpIHsKICAgICAgICAgICAgb3V0WzBdID0gdlswXTsKICAgICAgICAgICAgb3V0WzFdID0gMDsKICAgICAgICAgICAgb3V0WzJdID0gMDsKICAgICAgICAgICAgb3V0WzNdID0gdlsxXTsKICAgICAgICAgICAgb3V0WzRdID0gMDsKICAgICAgICAgICAgb3V0WzVdID0gMDsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZnJvbVRyYW5zbGF0aW9uJDMob3V0LCB2KSB7CiAgICAgICAgICAgIG91dFswXSA9IDE7CiAgICAgICAgICAgIG91dFsxXSA9IDA7CiAgICAgICAgICAgIG91dFsyXSA9IDA7CiAgICAgICAgICAgIG91dFszXSA9IDE7CiAgICAgICAgICAgIG91dFs0XSA9IHZbMF07CiAgICAgICAgICAgIG91dFs1XSA9IHZbMV07CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHN0ciQ3KGEpIHsKICAgICAgICAgICAgcmV0dXJuICJtYXQyZCgiICsKICAgICAgICAgICAgICAgIGFbMF0gKyAiLCAiICsgYVsxXSArICIsICIgKyBhWzJdICsgIiwgIiArIGFbM10gKyAiLCAiICsgYVs0XSArICIsICIgKyBhWzVdICsgIikiCiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBmcm9iJDIoYSkgewogICAgICAgICAgICByZXR1cm4gTWF0aC5oeXBvdChhWzBdLCBhWzFdLCBhWzJdLCBhWzNdLCBhWzRdLCBhWzVdLCAxKQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gYWRkJDcob3V0LCBhLCBiKSB7CiAgICAgICAgICAgIG91dFswXSA9IGFbMF0gKyBiWzBdOwogICAgICAgICAgICBvdXRbMV0gPSBhWzFdICsgYlsxXTsKICAgICAgICAgICAgb3V0WzJdID0gYVsyXSArIGJbMl07CiAgICAgICAgICAgIG91dFszXSA9IGFbM10gKyBiWzNdOwogICAgICAgICAgICBvdXRbNF0gPSBhWzRdICsgYls0XTsKICAgICAgICAgICAgb3V0WzVdID0gYVs1XSArIGJbNV07CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHN1YnRyYWN0JDUob3V0LCBhLCBiKSB7CiAgICAgICAgICAgIG91dFswXSA9IGFbMF0gLSBiWzBdOwogICAgICAgICAgICBvdXRbMV0gPSBhWzFdIC0gYlsxXTsKICAgICAgICAgICAgb3V0WzJdID0gYVsyXSAtIGJbMl07CiAgICAgICAgICAgIG91dFszXSA9IGFbM10gLSBiWzNdOwogICAgICAgICAgICBvdXRbNF0gPSBhWzRdIC0gYls0XTsKICAgICAgICAgICAgb3V0WzVdID0gYVs1XSAtIGJbNV07CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIG11bHRpcGx5U2NhbGFyJDIob3V0LCBhLCBiKSB7CiAgICAgICAgICAgIG91dFswXSA9IGFbMF0gKiBiOwogICAgICAgICAgICBvdXRbMV0gPSBhWzFdICogYjsKICAgICAgICAgICAgb3V0WzJdID0gYVsyXSAqIGI7CiAgICAgICAgICAgIG91dFszXSA9IGFbM10gKiBiOwogICAgICAgICAgICBvdXRbNF0gPQogICAgICAgICAgICAgICAgYVs0XSAqIGI7CiAgICAgICAgICAgIG91dFs1XSA9IGFbNV0gKiBiOwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBtdWx0aXBseVNjYWxhckFuZEFkZCQyKG91dCwgYSwgYiwgc2NhbGUpIHsKICAgICAgICAgICAgb3V0WzBdID0gYVswXSArIGJbMF0gKiBzY2FsZTsKICAgICAgICAgICAgb3V0WzFdID0gYVsxXSArIGJbMV0gKiBzY2FsZTsKICAgICAgICAgICAgb3V0WzJdID0gYVsyXSArIGJbMl0gKiBzY2FsZTsKICAgICAgICAgICAgb3V0WzNdID0gYVszXSArIGJbM10gKiBzY2FsZTsKICAgICAgICAgICAgb3V0WzRdID0gYVs0XSArIGJbNF0gKiBzY2FsZTsKICAgICAgICAgICAgb3V0WzVdID0gYVs1XSArIGJbNV0gKiBzY2FsZTsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZXhhY3RFcXVhbHMkNyhhLCBiKSB7CiAgICAgICAgICAgIHJldHVybiBhWzBdID09PSBiWzBdICYmIGFbMV0gPT09IGJbMV0gJiYgYVsyXSA9PT0gYlsyXSAmJiBhWzNdID09PSBiWzNdICYmIGFbNF0gPT09IGJbNF0gJiYgYVs1XSA9PT0gYls1XQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZXF1YWxzJDcoYSwgYikgewogICAgICAgICAgICB2YXIgYTAgPSBhWzBdLAogICAgICAgICAgICAgICAgYTEgPSBhWzFdLAogICAgICAgICAgICAgICAgYTIgPSBhWzJdLAogICAgICAgICAgICAgICAgYTMgPSBhWzNdLAogICAgICAgICAgICAgICAgYTQgPSBhWzRdLAogICAgICAgICAgICAgICAgYTUgPSBhWzVdOwogICAgICAgICAgICB2YXIgYjAgPSBiWzBdLAogICAgICAgICAgICAgICAgYjEgPSBiWzFdLAogICAgICAgICAgICAgICAgYjIgPSBiWzJdLAogICAgICAgICAgICAgICAgYjMgPSBiWzNdLAogICAgICAgICAgICAgICAgYjQgPSBiWzRdLAogICAgICAgICAgICAgICAgYjUgPSBiWzVdOwogICAgICAgICAgICByZXR1cm4gTWF0aC5hYnMoYTAgLSBiMCkgPD0gRVBTSUxPTiAqIE1hdGgubWF4KDEsCiAgICAgICAgICAgICAgICBNYXRoLmFicyhhMCksIE1hdGguYWJzKGIwKSkgJiYgTWF0aC5hYnMoYTEgLSBiMSkgPD0gRVBTSUxPTiAqIE1hdGgubWF4KDEsIE1hdGguYWJzKGExKSwgTWF0aC5hYnMoYjEpKSAmJiBNYXRoLmFicyhhMiAtIGIyKSA8PSBFUFNJTE9OICogTWF0aC5tYXgoMSwgTWF0aC5hYnMoYTIpLCBNYXRoLmFicyhiMikpICYmIE1hdGguYWJzKGEzIC0gYjMpIDw9IEVQU0lMT04gKiBNYXRoLm1heCgxLCBNYXRoLmFicyhhMyksIE1hdGguYWJzKGIzKSkgJiYgTWF0aC5hYnMoYTQgLSBiNCkgPD0gRVBTSUxPTiAqIE1hdGgubWF4KDEsIE1hdGguYWJzKGE0KSwgTWF0aC5hYnMoYjQpKSAmJiBNYXRoLmFicyhhNSAtIGI1KSA8PSBFUFNJTE9OICogTWF0aC5tYXgoMSwgTWF0aC5hYnMoYTUpLCBNYXRoLmFicyhiNSkpCiAgICAgICAgfQogICAgICAgIHZhciBtdWwkNyA9IG11bHRpcGx5JDc7CiAgICAgICAgdmFyIHN1YiQ1ID0gc3VidHJhY3QkNTsKICAgICAgICB2YXIgbWF0MmQgPSBPYmplY3QuZnJlZXplKHsKICAgICAgICAgICAgX19wcm90b19fOiBudWxsLAogICAgICAgICAgICBjcmVhdGU6IGNyZWF0ZSQ3LAogICAgICAgICAgICBjbG9uZTogY2xvbmUkNywKICAgICAgICAgICAgY29weTogY29weSQ3LAogICAgICAgICAgICBpZGVudGl0eTogaWRlbnRpdHkkNCwKICAgICAgICAgICAgZnJvbVZhbHVlczogZnJvbVZhbHVlcyQ3LAogICAgICAgICAgICBzZXQ6IHNldCQ3LAogICAgICAgICAgICBpbnZlcnQ6IGludmVydCQ0LAogICAgICAgICAgICBkZXRlcm1pbmFudDogZGV0ZXJtaW5hbnQkMiwKICAgICAgICAgICAgbXVsdGlwbHk6IG11bHRpcGx5JDcsCiAgICAgICAgICAgIHJvdGF0ZTogcm90YXRlJDMsCiAgICAgICAgICAgIHNjYWxlOiBzY2FsZSQ3LAogICAgICAgICAgICB0cmFuc2xhdGU6IHRyYW5zbGF0ZSQzLAogICAgICAgICAgICBmcm9tUm90YXRpb246IGZyb21Sb3RhdGlvbiQzLAogICAgICAgICAgICBmcm9tU2NhbGluZzogZnJvbVNjYWxpbmckMiwKICAgICAgICAgICAgZnJvbVRyYW5zbGF0aW9uOiBmcm9tVHJhbnNsYXRpb24kMywKICAgICAgICAgICAgc3RyOiBzdHIkNywKICAgICAgICAgICAgZnJvYjogZnJvYiQyLAogICAgICAgICAgICBhZGQ6IGFkZCQ3LAogICAgICAgICAgICBzdWJ0cmFjdDogc3VidHJhY3QkNSwKICAgICAgICAgICAgbXVsdGlwbHlTY2FsYXI6IG11bHRpcGx5U2NhbGFyJDIsCiAgICAgICAgICAgIG11bHRpcGx5U2NhbGFyQW5kQWRkOiBtdWx0aXBseVNjYWxhckFuZEFkZCQyLAogICAgICAgICAgICBleGFjdEVxdWFsczogZXhhY3RFcXVhbHMkNywKICAgICAgICAgICAgZXF1YWxzOiBlcXVhbHMkNywKICAgICAgICAgICAgbXVsOiBtdWwkNywKICAgICAgICAgICAgc3ViOiBzdWIkNQogICAgICAgIH0pOwoKICAgICAgICBmdW5jdGlvbiBjcmVhdGUkNigpIHsKICAgICAgICAgICAgdmFyIG91dCA9IG5ldyBBUlJBWV9UWVBFKDkpOwogICAgICAgICAgICBpZiAoQVJSQVlfVFlQRSAhPSBGbG9hdDMyQXJyYXkpIHsKICAgICAgICAgICAgICAgIG91dFsxXSA9IDA7CiAgICAgICAgICAgICAgICBvdXRbMl0gPSAwOwogICAgICAgICAgICAgICAgb3V0WzNdID0KICAgICAgICAgICAgICAgICAgICAwOwogICAgICAgICAgICAgICAgb3V0WzVdID0gMDsKICAgICAgICAgICAgICAgIG91dFs2XSA9IDA7CiAgICAgICAgICAgICAgICBvdXRbN10gPSAwCiAgICAgICAgICAgIH0KICAgICAgICAgICAgb3V0WzBdID0gMTsKICAgICAgICAgICAgb3V0WzRdID0gMTsKICAgICAgICAgICAgb3V0WzhdID0gMTsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZnJvbU1hdDQkMShvdXQsIGEpIHsKICAgICAgICAgICAgb3V0WzBdID0gYVswXTsKICAgICAgICAgICAgb3V0WzFdID0gYVsxXTsKICAgICAgICAgICAgb3V0WzJdID0gYVsyXTsKICAgICAgICAgICAgb3V0WzNdID0gYVs0XTsKICAgICAgICAgICAgb3V0WzRdID0gYVs1XTsKICAgICAgICAgICAgb3V0WzVdID0gYVs2XTsKICAgICAgICAgICAgb3V0WzZdID0gYVs4XTsKICAgICAgICAgICAgb3V0WzddID0gYVs5XTsKICAgICAgICAgICAgb3V0WzhdID0gYVsxMF07CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGNsb25lJDYoYSkgewogICAgICAgICAgICB2YXIgb3V0ID0gbmV3IEFSUkFZX1RZUEUoOSk7CiAgICAgICAgICAgIG91dFswXSA9IGFbMF07CiAgICAgICAgICAgIG91dFsxXSA9IGFbMV07CiAgICAgICAgICAgIG91dFsyXSA9IGFbMl07CiAgICAgICAgICAgIG91dFszXSA9IGFbM107CiAgICAgICAgICAgIG91dFs0XSA9IGFbNF07CiAgICAgICAgICAgIG91dFs1XSA9IGFbNV07CiAgICAgICAgICAgIG91dFs2XSA9IGFbNl07CiAgICAgICAgICAgIG91dFs3XSA9IGFbN107CiAgICAgICAgICAgIG91dFs4XSA9IGFbOF07CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGNvcHkkNihvdXQsIGEpIHsKICAgICAgICAgICAgb3V0WzBdID0gYVswXTsKICAgICAgICAgICAgb3V0WzFdID0gYVsxXTsKICAgICAgICAgICAgb3V0WzJdID0gYVsyXTsKICAgICAgICAgICAgb3V0WzNdID0gYVszXTsKICAgICAgICAgICAgb3V0WzRdID0gYVs0XTsKICAgICAgICAgICAgb3V0WzVdID0gYVs1XTsKICAgICAgICAgICAgb3V0WzZdID0gYVs2XTsKICAgICAgICAgICAgb3V0WzddID0gYVs3XTsKICAgICAgICAgICAgb3V0WzhdID0KICAgICAgICAgICAgICAgIGFbOF07CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGZyb21WYWx1ZXMkNihtMDAsIG0wMSwgbTAyLCBtMTAsIG0xMSwgbTEyLCBtMjAsIG0yMSwgbTIyKSB7CiAgICAgICAgICAgIHZhciBvdXQgPSBuZXcgQVJSQVlfVFlQRSg5KTsKICAgICAgICAgICAgb3V0WzBdID0gbTAwOwogICAgICAgICAgICBvdXRbMV0gPSBtMDE7CiAgICAgICAgICAgIG91dFsyXSA9IG0wMjsKICAgICAgICAgICAgb3V0WzNdID0gbTEwOwogICAgICAgICAgICBvdXRbNF0gPSBtMTE7CiAgICAgICAgICAgIG91dFs1XSA9IG0xMjsKICAgICAgICAgICAgb3V0WzZdID0gbTIwOwogICAgICAgICAgICBvdXRbN10gPSBtMjE7CiAgICAgICAgICAgIG91dFs4XSA9IG0yMjsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gc2V0JDYob3V0LCBtMDAsIG0wMSwgbTAyLCBtMTAsIG0xMSwgbTEyLCBtMjAsIG0yMSwgbTIyKSB7CiAgICAgICAgICAgIG91dFswXSA9IG0wMDsKICAgICAgICAgICAgb3V0WzFdID0gbTAxOwogICAgICAgICAgICBvdXRbMl0gPSBtMDI7CiAgICAgICAgICAgIG91dFszXSA9IG0xMDsKICAgICAgICAgICAgb3V0WzRdID0gbTExOwogICAgICAgICAgICBvdXRbNV0gPSBtMTI7CiAgICAgICAgICAgIG91dFs2XSA9IG0yMDsKICAgICAgICAgICAgb3V0WzddID0gbTIxOwogICAgICAgICAgICBvdXRbOF0gPSBtMjI7CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGlkZW50aXR5JDMob3V0KSB7CiAgICAgICAgICAgIG91dFswXSA9IDE7CiAgICAgICAgICAgIG91dFsxXSA9IDA7CiAgICAgICAgICAgIG91dFsyXSA9IDA7CiAgICAgICAgICAgIG91dFszXSA9IDA7CiAgICAgICAgICAgIG91dFs0XSA9IDE7CiAgICAgICAgICAgIG91dFs1XSA9IDA7CiAgICAgICAgICAgIG91dFs2XSA9IDA7CiAgICAgICAgICAgIG91dFs3XSA9IDA7CiAgICAgICAgICAgIG91dFs4XSA9IDE7CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHRyYW5zcG9zZSQxKG91dCwKICAgICAgICAgICAgYSkgewogICAgICAgICAgICBpZiAob3V0ID09PSBhKSB7CiAgICAgICAgICAgICAgICB2YXIgYTAxID0gYVsxXSwKICAgICAgICAgICAgICAgICAgICBhMDIgPSBhWzJdLAogICAgICAgICAgICAgICAgICAgIGExMiA9IGFbNV07CiAgICAgICAgICAgICAgICBvdXRbMV0gPSBhWzNdOwogICAgICAgICAgICAgICAgb3V0WzJdID0gYVs2XTsKICAgICAgICAgICAgICAgIG91dFszXSA9IGEwMTsKICAgICAgICAgICAgICAgIG91dFs1XSA9IGFbN107CiAgICAgICAgICAgICAgICBvdXRbNl0gPSBhMDI7CiAgICAgICAgICAgICAgICBvdXRbN10gPSBhMTIKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG91dFswXSA9IGFbMF07CiAgICAgICAgICAgICAgICBvdXRbMV0gPSBhWzNdOwogICAgICAgICAgICAgICAgb3V0WzJdID0gYVs2XTsKICAgICAgICAgICAgICAgIG91dFszXSA9IGFbMV07CiAgICAgICAgICAgICAgICBvdXRbNF0gPSBhWzRdOwogICAgICAgICAgICAgICAgb3V0WzVdID0gYVs3XTsKICAgICAgICAgICAgICAgIG91dFs2XSA9IGFbMl07CiAgICAgICAgICAgICAgICBvdXRbN10gPSBhWzVdOwogICAgICAgICAgICAgICAgb3V0WzhdID0gYVs4XQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGludmVydCQzKG91dCwgYSkgewogICAgICAgICAgICB2YXIgYTAwID0gYVswXSwKICAgICAgICAgICAgICAgIGEwMSA9IGFbMV0sCiAgICAgICAgICAgICAgICBhMDIgPSBhWzJdOwogICAgICAgICAgICB2YXIgYTEwID0gYVszXSwKICAgICAgICAgICAgICAgIGExMSA9IGFbNF0sCiAgICAgICAgICAgICAgICBhMTIgPSBhWzVdOwogICAgICAgICAgICB2YXIgYTIwID0gYVs2XSwKICAgICAgICAgICAgICAgIGEyMSA9IGFbN10sCiAgICAgICAgICAgICAgICBhMjIgPSBhWzhdOwogICAgICAgICAgICB2YXIgYjAxID0gYTIyICogYTExIC0gYTEyICogYTIxOwogICAgICAgICAgICB2YXIgYjExID0gLWEyMiAqIGExMCArIGExMiAqIGEyMDsKICAgICAgICAgICAgdmFyIGIyMSA9IGEyMSAqIGExMCAtIGExMSAqIGEyMDsKICAgICAgICAgICAgdmFyIGRldCA9IGEwMCAqIGIwMSArIGEwMSAqIGIxMSArIGEwMiAqIGIyMTsKICAgICAgICAgICAgaWYgKCFkZXQpIHJldHVybiBudWxsOwogICAgICAgICAgICBkZXQgPSAxIC8gZGV0OwogICAgICAgICAgICBvdXRbMF0gPSBiMDEgKgogICAgICAgICAgICAgICAgZGV0OwogICAgICAgICAgICBvdXRbMV0gPSAoLWEyMiAqIGEwMSArIGEwMiAqIGEyMSkgKiBkZXQ7CiAgICAgICAgICAgIG91dFsyXSA9IChhMTIgKiBhMDEgLSBhMDIgKiBhMTEpICogZGV0OwogICAgICAgICAgICBvdXRbM10gPSBiMTEgKiBkZXQ7CiAgICAgICAgICAgIG91dFs0XSA9IChhMjIgKiBhMDAgLSBhMDIgKiBhMjApICogZGV0OwogICAgICAgICAgICBvdXRbNV0gPSAoLWExMiAqIGEwMCArIGEwMiAqIGExMCkgKiBkZXQ7CiAgICAgICAgICAgIG91dFs2XSA9IGIyMSAqIGRldDsKICAgICAgICAgICAgb3V0WzddID0gKC1hMjEgKiBhMDAgKyBhMDEgKiBhMjApICogZGV0OwogICAgICAgICAgICBvdXRbOF0gPSAoYTExICogYTAwIC0gYTAxICogYTEwKSAqIGRldDsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gYWRqb2ludCQxKG91dCwgYSkgewogICAgICAgICAgICB2YXIgYTAwID0gYVswXSwKICAgICAgICAgICAgICAgIGEwMSA9IGFbMV0sCiAgICAgICAgICAgICAgICBhMDIgPSBhWzJdOwogICAgICAgICAgICB2YXIgYTEwID0gYVszXSwKICAgICAgICAgICAgICAgIGExMSA9IGFbNF0sCiAgICAgICAgICAgICAgICBhMTIgPSBhWzVdOwogICAgICAgICAgICB2YXIgYTIwID0gYVs2XSwKICAgICAgICAgICAgICAgIGEyMSA9IGFbN10sCiAgICAgICAgICAgICAgICBhMjIgPSBhWzhdOwogICAgICAgICAgICBvdXRbMF0gPSBhMTEgKiBhMjIgLSBhMTIgKiBhMjE7CiAgICAgICAgICAgIG91dFsxXSA9IGEwMiAqIGEyMSAtIGEwMSAqIGEyMjsKICAgICAgICAgICAgb3V0WzJdID0gYTAxICogYTEyIC0gYTAyICogYTExOwogICAgICAgICAgICBvdXRbM10gPSBhMTIgKiBhMjAgLSBhMTAgKiBhMjI7CiAgICAgICAgICAgIG91dFs0XSA9IGEwMCAqIGEyMiAtIGEwMiAqIGEyMDsKICAgICAgICAgICAgb3V0WzVdID0gYTAyICogYTEwIC0gYTAwICogYTEyOwogICAgICAgICAgICBvdXRbNl0gPSBhMTAgKiBhMjEgLSBhMTEgKiBhMjA7CiAgICAgICAgICAgIG91dFs3XSA9IGEwMSAqIGEyMCAtIGEwMCAqIGEyMTsKICAgICAgICAgICAgb3V0WzhdID0gYTAwICogYTExIC0gYTAxICogYTEwOwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBkZXRlcm1pbmFudCQxKGEpIHsKICAgICAgICAgICAgdmFyIGEwMCA9IGFbMF0sCiAgICAgICAgICAgICAgICBhMDEgPSBhWzFdLAogICAgICAgICAgICAgICAgYTAyID0gYVsyXTsKICAgICAgICAgICAgdmFyIGExMCA9IGFbM10sCiAgICAgICAgICAgICAgICBhMTEgPSBhWzRdLAogICAgICAgICAgICAgICAgYTEyID0gYVs1XTsKICAgICAgICAgICAgdmFyIGEyMCA9IGFbNl0sCiAgICAgICAgICAgICAgICBhMjEgPSBhWzddLAogICAgICAgICAgICAgICAgYTIyID0gYVs4XTsKICAgICAgICAgICAgcmV0dXJuIGEwMCAqIChhMjIgKiBhMTEgLSBhMTIgKiBhMjEpICsgYTAxICogKC1hMjIgKiBhMTAgKyBhMTIgKiBhMjApICsgYTAyICogKGEyMSAqIGExMCAtIGExMSAqIGEyMCkKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIG11bHRpcGx5JDYob3V0LCBhLCBiKSB7CiAgICAgICAgICAgIHZhciBhMDAgPSBhWzBdLAogICAgICAgICAgICAgICAgYTAxID0gYVsxXSwKICAgICAgICAgICAgICAgIGEwMiA9IGFbMl07CiAgICAgICAgICAgIHZhciBhMTAgPSBhWzNdLAogICAgICAgICAgICAgICAgYTExID0gYVs0XSwKICAgICAgICAgICAgICAgIGExMiA9IGFbNV07CiAgICAgICAgICAgIHZhciBhMjAgPSBhWzZdLAogICAgICAgICAgICAgICAgYTIxID0gYVs3XSwKICAgICAgICAgICAgICAgIGEyMiA9IGFbOF07CiAgICAgICAgICAgIHZhciBiMDAgPSBiWzBdLAogICAgICAgICAgICAgICAgYjAxID0gYlsxXSwKICAgICAgICAgICAgICAgIGIwMiA9IGJbMl07CiAgICAgICAgICAgIHZhciBiMTAgPSBiWzNdLAogICAgICAgICAgICAgICAgYjExID0gYls0XSwKICAgICAgICAgICAgICAgIGIxMiA9IGJbNV07CiAgICAgICAgICAgIHZhciBiMjAgPSBiWzZdLAogICAgICAgICAgICAgICAgYjIxID0gYls3XSwKICAgICAgICAgICAgICAgIGIyMiA9IGJbOF07CiAgICAgICAgICAgIG91dFswXSA9IGIwMCAqIGEwMCArIGIwMSAqIGExMCArIGIwMiAqIGEyMDsKICAgICAgICAgICAgb3V0WzFdID0KICAgICAgICAgICAgICAgIGIwMCAqIGEwMSArIGIwMSAqIGExMSArIGIwMiAqIGEyMTsKICAgICAgICAgICAgb3V0WzJdID0gYjAwICogYTAyICsgYjAxICogYTEyICsgYjAyICogYTIyOwogICAgICAgICAgICBvdXRbM10gPSBiMTAgKiBhMDAgKyBiMTEgKiBhMTAgKyBiMTIgKiBhMjA7CiAgICAgICAgICAgIG91dFs0XSA9IGIxMCAqIGEwMSArIGIxMSAqIGExMSArIGIxMiAqIGEyMTsKICAgICAgICAgICAgb3V0WzVdID0gYjEwICogYTAyICsgYjExICogYTEyICsgYjEyICogYTIyOwogICAgICAgICAgICBvdXRbNl0gPSBiMjAgKiBhMDAgKyBiMjEgKiBhMTAgKyBiMjIgKiBhMjA7CiAgICAgICAgICAgIG91dFs3XSA9IGIyMCAqIGEwMSArIGIyMSAqIGExMSArIGIyMiAqIGEyMTsKICAgICAgICAgICAgb3V0WzhdID0gYjIwICogYTAyICsgYjIxICogYTEyICsgYjIyICogYTIyOwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiB0cmFuc2xhdGUkMihvdXQsIGEsIHYpIHsKICAgICAgICAgICAgdmFyIGEwMCA9IGFbMF0sCiAgICAgICAgICAgICAgICBhMDEgPSBhWzFdLAogICAgICAgICAgICAgICAgYTAyID0gYVsyXSwKICAgICAgICAgICAgICAgIGExMCA9IGFbM10sCiAgICAgICAgICAgICAgICBhMTEgPSBhWzRdLAogICAgICAgICAgICAgICAgYTEyID0gYVs1XSwKICAgICAgICAgICAgICAgIGEyMCA9IGFbNl0sCiAgICAgICAgICAgICAgICBhMjEgPSBhWzddLAogICAgICAgICAgICAgICAgYTIyID0gYVs4XSwKICAgICAgICAgICAgICAgIHggPSB2WzBdLAogICAgICAgICAgICAgICAgeSA9IHZbMV07CiAgICAgICAgICAgIG91dFswXSA9IGEwMDsKICAgICAgICAgICAgb3V0WzFdID0gYTAxOwogICAgICAgICAgICBvdXRbMl0gPSBhMDI7CiAgICAgICAgICAgIG91dFszXSA9IGExMDsKICAgICAgICAgICAgb3V0WzRdID0gYTExOwogICAgICAgICAgICBvdXRbNV0gPSBhMTI7CiAgICAgICAgICAgIG91dFs2XSA9IHggKiBhMDAgKyB5ICogYTEwICsgYTIwOwogICAgICAgICAgICBvdXRbN10gPSB4ICogYTAxICsgeSAqIGExMSArIGEyMTsKICAgICAgICAgICAgb3V0WzhdID0geCAqCiAgICAgICAgICAgICAgICBhMDIgKyB5ICogYTEyICsgYTIyOwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiByb3RhdGUkMihvdXQsIGEsIHJhZCkgewogICAgICAgICAgICB2YXIgYTAwID0gYVswXSwKICAgICAgICAgICAgICAgIGEwMSA9IGFbMV0sCiAgICAgICAgICAgICAgICBhMDIgPSBhWzJdLAogICAgICAgICAgICAgICAgYTEwID0gYVszXSwKICAgICAgICAgICAgICAgIGExMSA9IGFbNF0sCiAgICAgICAgICAgICAgICBhMTIgPSBhWzVdLAogICAgICAgICAgICAgICAgYTIwID0gYVs2XSwKICAgICAgICAgICAgICAgIGEyMSA9IGFbN10sCiAgICAgICAgICAgICAgICBhMjIgPSBhWzhdLAogICAgICAgICAgICAgICAgcyA9IE1hdGguc2luKHJhZCksCiAgICAgICAgICAgICAgICBjID0gTWF0aC5jb3MocmFkKTsKICAgICAgICAgICAgb3V0WzBdID0gYyAqIGEwMCArIHMgKiBhMTA7CiAgICAgICAgICAgIG91dFsxXSA9IGMgKiBhMDEgKyBzICogYTExOwogICAgICAgICAgICBvdXRbMl0gPSBjICogYTAyICsgcyAqIGExMjsKICAgICAgICAgICAgb3V0WzNdID0gYyAqIGExMCAtIHMgKiBhMDA7CiAgICAgICAgICAgIG91dFs0XSA9IGMgKiBhMTEgLSBzICogYTAxOwogICAgICAgICAgICBvdXRbNV0gPSBjICogYTEyIC0gcyAqIGEwMjsKICAgICAgICAgICAgb3V0WzZdID0gYTIwOwogICAgICAgICAgICBvdXRbN10gPSBhMjE7CiAgICAgICAgICAgIG91dFs4XSA9IGEyMjsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gc2NhbGUkNihvdXQsIGEsIHYpIHsKICAgICAgICAgICAgdmFyIHggPSB2WzBdLAogICAgICAgICAgICAgICAgeSA9IHZbMV07CiAgICAgICAgICAgIG91dFswXSA9IHggKiBhWzBdOwogICAgICAgICAgICBvdXRbMV0gPSB4ICogYVsxXTsKICAgICAgICAgICAgb3V0WzJdID0geCAqIGFbMl07CiAgICAgICAgICAgIG91dFszXSA9IHkgKiBhWzNdOwogICAgICAgICAgICBvdXRbNF0gPSB5ICogYVs0XTsKICAgICAgICAgICAgb3V0WzVdID0geSAqIGFbNV07CiAgICAgICAgICAgIG91dFs2XSA9IGFbNl07CiAgICAgICAgICAgIG91dFs3XSA9IGFbN107CiAgICAgICAgICAgIG91dFs4XSA9IGFbOF07CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGZyb21UcmFuc2xhdGlvbiQyKG91dCwgdikgewogICAgICAgICAgICBvdXRbMF0gPSAxOwogICAgICAgICAgICBvdXRbMV0gPSAwOwogICAgICAgICAgICBvdXRbMl0gPSAwOwogICAgICAgICAgICBvdXRbM10gPSAwOwogICAgICAgICAgICBvdXRbNF0gPSAxOwogICAgICAgICAgICBvdXRbNV0gPSAwOwogICAgICAgICAgICBvdXRbNl0gPSB2WzBdOwogICAgICAgICAgICBvdXRbN10gPSB2WzFdOwogICAgICAgICAgICBvdXRbOF0gPSAxOwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBmcm9tUm90YXRpb24kMihvdXQsIHJhZCkgewogICAgICAgICAgICB2YXIgcyA9IE1hdGguc2luKHJhZCksCiAgICAgICAgICAgICAgICBjID0gTWF0aC5jb3MocmFkKTsKICAgICAgICAgICAgb3V0WzBdID0gYzsKICAgICAgICAgICAgb3V0WzFdID0gczsKICAgICAgICAgICAgb3V0WzJdID0gMDsKICAgICAgICAgICAgb3V0WzNdID0gLXM7CiAgICAgICAgICAgIG91dFs0XSA9IGM7CiAgICAgICAgICAgIG91dFs1XSA9IDA7CiAgICAgICAgICAgIG91dFs2XSA9IDA7CiAgICAgICAgICAgIG91dFs3XSA9IDA7CiAgICAgICAgICAgIG91dFs4XSA9IDE7CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGZyb21TY2FsaW5nJDEob3V0LCB2KSB7CiAgICAgICAgICAgIG91dFswXSA9IHZbMF07CiAgICAgICAgICAgIG91dFsxXSA9IDA7CiAgICAgICAgICAgIG91dFsyXSA9IDA7CiAgICAgICAgICAgIG91dFszXSA9IDA7CiAgICAgICAgICAgIG91dFs0XSA9IHZbMV07CiAgICAgICAgICAgIG91dFs1XSA9IDA7CiAgICAgICAgICAgIG91dFs2XSA9IDA7CiAgICAgICAgICAgIG91dFs3XSA9IDA7CiAgICAgICAgICAgIG91dFs4XSA9IDE7CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGZyb21NYXQyZChvdXQsIGEpIHsKICAgICAgICAgICAgb3V0WzBdID0gYVswXTsKICAgICAgICAgICAgb3V0WzFdID0gYVsxXTsKICAgICAgICAgICAgb3V0WzJdID0gMDsKICAgICAgICAgICAgb3V0WzNdID0gYVsyXTsKICAgICAgICAgICAgb3V0WzRdID0gYVszXTsKICAgICAgICAgICAgb3V0WzVdID0gMDsKICAgICAgICAgICAgb3V0WzZdID0gYVs0XTsKICAgICAgICAgICAgb3V0WzddID0gYVs1XTsKICAgICAgICAgICAgb3V0WzhdID0gMTsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZnJvbVF1YXQkMShvdXQsIHEpIHsKICAgICAgICAgICAgdmFyIHggPSBxWzBdLAogICAgICAgICAgICAgICAgeSA9IHFbMV0sCiAgICAgICAgICAgICAgICB6ID0gcVsyXSwKICAgICAgICAgICAgICAgIHcgPSBxWzNdOwogICAgICAgICAgICB2YXIgeDIgPSB4ICsgeDsKICAgICAgICAgICAgdmFyIHkyID0geSArIHk7CiAgICAgICAgICAgIHZhciB6MiA9IHogKyB6OwogICAgICAgICAgICB2YXIgeHggPSB4ICogeDI7CiAgICAgICAgICAgIHZhciB5eCA9IHkgKiB4MjsKICAgICAgICAgICAgdmFyIHl5ID0geSAqIHkyOwogICAgICAgICAgICB2YXIgenggPSB6ICogeDI7CiAgICAgICAgICAgIHZhciB6eSA9IHogKiB5MjsKICAgICAgICAgICAgdmFyIHp6ID0geiAqIHoyOwogICAgICAgICAgICB2YXIgd3ggPSB3ICogeDI7CiAgICAgICAgICAgIHZhciB3eSA9IHcgKiB5MjsKICAgICAgICAgICAgdmFyIHd6ID0gdyAqIHoyOwogICAgICAgICAgICBvdXRbMF0gPSAxIC0geXkgLSB6ejsKICAgICAgICAgICAgb3V0WzNdID0geXggLSB3ejsKICAgICAgICAgICAgb3V0WzZdID0genggKyB3eTsKICAgICAgICAgICAgb3V0WzFdID0geXggKyB3ejsKICAgICAgICAgICAgb3V0WzRdID0gMSAtIHh4IC0geno7CiAgICAgICAgICAgIG91dFs3XSA9IHp5IC0gd3g7CiAgICAgICAgICAgIG91dFsyXSA9IHp4IC0gd3k7CiAgICAgICAgICAgIG91dFs1XSA9IHp5ICsgd3g7CiAgICAgICAgICAgIG91dFs4XSA9IDEgLSB4eCAtIHl5OwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBub3JtYWxGcm9tTWF0NChvdXQsIGEpIHsKICAgICAgICAgICAgdmFyIGEwMCA9IGFbMF0sCiAgICAgICAgICAgICAgICBhMDEgPSBhWzFdLAogICAgICAgICAgICAgICAgYTAyID0gYVsyXSwKICAgICAgICAgICAgICAgIGEwMyA9IGFbM107CiAgICAgICAgICAgIHZhciBhMTAgPSBhWzRdLAogICAgICAgICAgICAgICAgYTExID0gYVs1XSwKICAgICAgICAgICAgICAgIGExMiA9IGFbNl0sCiAgICAgICAgICAgICAgICBhMTMgPSBhWzddOwogICAgICAgICAgICB2YXIgYTIwID0KICAgICAgICAgICAgICAgIGFbOF0sCiAgICAgICAgICAgICAgICBhMjEgPSBhWzldLAogICAgICAgICAgICAgICAgYTIyID0gYVsxMF0sCiAgICAgICAgICAgICAgICBhMjMgPSBhWzExXTsKICAgICAgICAgICAgdmFyIGEzMCA9IGFbMTJdLAogICAgICAgICAgICAgICAgYTMxID0gYVsxM10sCiAgICAgICAgICAgICAgICBhMzIgPSBhWzE0XSwKICAgICAgICAgICAgICAgIGEzMyA9IGFbMTVdOwogICAgICAgICAgICB2YXIgYjAwID0gYTAwICogYTExIC0gYTAxICogYTEwOwogICAgICAgICAgICB2YXIgYjAxID0gYTAwICogYTEyIC0gYTAyICogYTEwOwogICAgICAgICAgICB2YXIgYjAyID0gYTAwICogYTEzIC0gYTAzICogYTEwOwogICAgICAgICAgICB2YXIgYjAzID0gYTAxICogYTEyIC0gYTAyICogYTExOwogICAgICAgICAgICB2YXIgYjA0ID0gYTAxICogYTEzIC0gYTAzICogYTExOwogICAgICAgICAgICB2YXIgYjA1ID0gYTAyICogYTEzIC0gYTAzICogYTEyOwogICAgICAgICAgICB2YXIgYjA2ID0gYTIwICogYTMxIC0gYTIxICogYTMwOwogICAgICAgICAgICB2YXIgYjA3ID0gYTIwICogYTMyIC0gYTIyICogYTMwOwogICAgICAgICAgICB2YXIgYjA4ID0gYTIwICogYTMzIC0gYTIzICogYTMwOwogICAgICAgICAgICB2YXIgYjA5ID0gYTIxICogYTMyIC0gYTIyICogYTMxOwogICAgICAgICAgICB2YXIgYjEwID0gYTIxICogYTMzIC0gYTIzICogYTMxOwogICAgICAgICAgICB2YXIgYjExID0gYTIyICogYTMzIC0gYTIzICogYTMyOwogICAgICAgICAgICB2YXIgZGV0ID0gYjAwICogYjExIC0gYjAxICogYjEwICsgYjAyICogYjA5ICsgYjAzICogYjA4IC0gYjA0ICogYjA3ICsgYjA1ICogYjA2OwogICAgICAgICAgICBpZiAoIWRldCkgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIGRldCA9IDEgLyBkZXQ7CiAgICAgICAgICAgIG91dFswXSA9IChhMTEgKiBiMTEgLSBhMTIgKiBiMTAgKyBhMTMgKiBiMDkpICogZGV0OwogICAgICAgICAgICBvdXRbMV0gPSAoYTEyICoKICAgICAgICAgICAgICAgIGIwOCAtIGExMCAqIGIxMSAtIGExMyAqIGIwNykgKiBkZXQ7CiAgICAgICAgICAgIG91dFsyXSA9IChhMTAgKiBiMTAgLSBhMTEgKiBiMDggKyBhMTMgKiBiMDYpICogZGV0OwogICAgICAgICAgICBvdXRbM10gPSAoYTAyICogYjEwIC0gYTAxICogYjExIC0gYTAzICogYjA5KSAqIGRldDsKICAgICAgICAgICAgb3V0WzRdID0gKGEwMCAqIGIxMSAtIGEwMiAqIGIwOCArIGEwMyAqIGIwNykgKiBkZXQ7CiAgICAgICAgICAgIG91dFs1XSA9IChhMDEgKiBiMDggLSBhMDAgKiBiMTAgLSBhMDMgKiBiMDYpICogZGV0OwogICAgICAgICAgICBvdXRbNl0gPSAoYTMxICogYjA1IC0gYTMyICogYjA0ICsgYTMzICogYjAzKSAqIGRldDsKICAgICAgICAgICAgb3V0WzddID0gKGEzMiAqIGIwMiAtIGEzMCAqIGIwNSAtIGEzMyAqIGIwMSkgKiBkZXQ7CiAgICAgICAgICAgIG91dFs4XSA9IChhMzAgKiBiMDQgLSBhMzEgKiBiMDIgKyBhMzMgKiBiMDApICogZGV0OwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBwcm9qZWN0aW9uKG91dCwgd2lkdGgsIGhlaWdodCkgewogICAgICAgICAgICBvdXRbMF0gPSAyIC8gd2lkdGg7CiAgICAgICAgICAgIG91dFsxXSA9IDA7CiAgICAgICAgICAgIG91dFsyXSA9IDA7CiAgICAgICAgICAgIG91dFszXSA9IDA7CiAgICAgICAgICAgIG91dFs0XSA9IC0yIC8gaGVpZ2h0OwogICAgICAgICAgICBvdXRbNV0gPSAwOwogICAgICAgICAgICBvdXRbNl0gPSAtMTsKICAgICAgICAgICAgb3V0WzddID0gMTsKICAgICAgICAgICAgb3V0WzhdID0gMTsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gc3RyJDYoYSkgewogICAgICAgICAgICByZXR1cm4gIm1hdDMoIiArIGFbMF0gKyAiLCAiICsgYVsxXSArICIsICIgKyBhWzJdICsgIiwgIiArCiAgICAgICAgICAgICAgICBhWzNdICsgIiwgIiArIGFbNF0gKyAiLCAiICsgYVs1XSArICIsICIgKyBhWzZdICsgIiwgIiArIGFbN10gKyAiLCAiICsgYVs4XSArICIpIgogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZnJvYiQxKGEpIHsKICAgICAgICAgICAgcmV0dXJuIE1hdGguaHlwb3QoYVswXSwgYVsxXSwgYVsyXSwgYVszXSwgYVs0XSwgYVs1XSwgYVs2XSwgYVs3XSwgYVs4XSkKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGFkZCQ2KG91dCwgYSwgYikgewogICAgICAgICAgICBvdXRbMF0gPSBhWzBdICsgYlswXTsKICAgICAgICAgICAgb3V0WzFdID0gYVsxXSArIGJbMV07CiAgICAgICAgICAgIG91dFsyXSA9IGFbMl0gKyBiWzJdOwogICAgICAgICAgICBvdXRbM10gPSBhWzNdICsgYlszXTsKICAgICAgICAgICAgb3V0WzRdID0gYVs0XSArIGJbNF07CiAgICAgICAgICAgIG91dFs1XSA9IGFbNV0gKyBiWzVdOwogICAgICAgICAgICBvdXRbNl0gPSBhWzZdICsgYls2XTsKICAgICAgICAgICAgb3V0WzddID0gYVs3XSArIGJbN107CiAgICAgICAgICAgIG91dFs4XSA9IGFbOF0gKyBiWzhdOwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBzdWJ0cmFjdCQ0KG91dCwgYSwgYikgewogICAgICAgICAgICBvdXRbMF0gPSBhWzBdIC0gYlswXTsKICAgICAgICAgICAgb3V0WzFdID0gYVsxXSAtIGJbMV07CiAgICAgICAgICAgIG91dFsyXSA9IGFbMl0gLSBiWzJdOwogICAgICAgICAgICBvdXRbM10gPSBhWzNdIC0gYlszXTsKICAgICAgICAgICAgb3V0WzRdID0gYVs0XSAtIGJbNF07CiAgICAgICAgICAgIG91dFs1XSA9IGFbNV0gLSBiWzVdOwogICAgICAgICAgICBvdXRbNl0gPSBhWzZdIC0gYls2XTsKICAgICAgICAgICAgb3V0WzddID0gYVs3XSAtIGJbN107CiAgICAgICAgICAgIG91dFs4XSA9CiAgICAgICAgICAgICAgICBhWzhdIC0gYls4XTsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gbXVsdGlwbHlTY2FsYXIkMShvdXQsIGEsIGIpIHsKICAgICAgICAgICAgb3V0WzBdID0gYVswXSAqIGI7CiAgICAgICAgICAgIG91dFsxXSA9IGFbMV0gKiBiOwogICAgICAgICAgICBvdXRbMl0gPSBhWzJdICogYjsKICAgICAgICAgICAgb3V0WzNdID0gYVszXSAqIGI7CiAgICAgICAgICAgIG91dFs0XSA9IGFbNF0gKiBiOwogICAgICAgICAgICBvdXRbNV0gPSBhWzVdICogYjsKICAgICAgICAgICAgb3V0WzZdID0gYVs2XSAqIGI7CiAgICAgICAgICAgIG91dFs3XSA9IGFbN10gKiBiOwogICAgICAgICAgICBvdXRbOF0gPSBhWzhdICogYjsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gbXVsdGlwbHlTY2FsYXJBbmRBZGQkMShvdXQsIGEsIGIsIHNjYWxlKSB7CiAgICAgICAgICAgIG91dFswXSA9IGFbMF0gKyBiWzBdICogc2NhbGU7CiAgICAgICAgICAgIG91dFsxXSA9IGFbMV0gKyBiWzFdICogc2NhbGU7CiAgICAgICAgICAgIG91dFsyXSA9IGFbMl0gKyBiWzJdICogc2NhbGU7CiAgICAgICAgICAgIG91dFszXSA9IGFbM10gKyBiWzNdICogc2NhbGU7CiAgICAgICAgICAgIG91dFs0XSA9IGFbNF0gKyBiWzRdICogc2NhbGU7CiAgICAgICAgICAgIG91dFs1XSA9IGFbNV0gKyBiWzVdICogc2NhbGU7CiAgICAgICAgICAgIG91dFs2XSA9IGFbNl0gKyBiWzZdICogc2NhbGU7CiAgICAgICAgICAgIG91dFs3XSA9IGFbN10gKyBiWzddICogc2NhbGU7CiAgICAgICAgICAgIG91dFs4XSA9IGFbOF0gKyBiWzhdICogc2NhbGU7CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGV4YWN0RXF1YWxzJDYoYSwgYikgewogICAgICAgICAgICByZXR1cm4gYVswXSA9PT0gYlswXSAmJgogICAgICAgICAgICAgICAgYVsxXSA9PT0gYlsxXSAmJiBhWzJdID09PSBiWzJdICYmIGFbM10gPT09IGJbM10gJiYgYVs0XSA9PT0gYls0XSAmJiBhWzVdID09PSBiWzVdICYmIGFbNl0gPT09IGJbNl0gJiYgYVs3XSA9PT0gYls3XSAmJiBhWzhdID09PSBiWzhdCiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBlcXVhbHMkNihhLCBiKSB7CiAgICAgICAgICAgIHZhciBhMCA9IGFbMF0sCiAgICAgICAgICAgICAgICBhMSA9IGFbMV0sCiAgICAgICAgICAgICAgICBhMiA9IGFbMl0sCiAgICAgICAgICAgICAgICBhMyA9IGFbM10sCiAgICAgICAgICAgICAgICBhNCA9IGFbNF0sCiAgICAgICAgICAgICAgICBhNSA9IGFbNV0sCiAgICAgICAgICAgICAgICBhNiA9IGFbNl0sCiAgICAgICAgICAgICAgICBhNyA9IGFbN10sCiAgICAgICAgICAgICAgICBhOCA9IGFbOF07CiAgICAgICAgICAgIHZhciBiMCA9IGJbMF0sCiAgICAgICAgICAgICAgICBiMSA9IGJbMV0sCiAgICAgICAgICAgICAgICBiMiA9IGJbMl0sCiAgICAgICAgICAgICAgICBiMyA9IGJbM10sCiAgICAgICAgICAgICAgICBiNCA9IGJbNF0sCiAgICAgICAgICAgICAgICBiNSA9IGJbNV0sCiAgICAgICAgICAgICAgICBiNiA9IGJbNl0sCiAgICAgICAgICAgICAgICBiNyA9IGJbN10sCiAgICAgICAgICAgICAgICBiOCA9IGJbOF07CiAgICAgICAgICAgIHJldHVybiBNYXRoLmFicyhhMCAtIGIwKSA8PSBFUFNJTE9OICogTWF0aC5tYXgoMSwgTWF0aC5hYnMoYTApLCBNYXRoLmFicyhiMCkpICYmIE1hdGguYWJzKGExIC0gYjEpIDw9IEVQU0lMT04gKiBNYXRoLm1heCgxLCBNYXRoLmFicyhhMSksIE1hdGguYWJzKGIxKSkgJiYgTWF0aC5hYnMoYTIgLSBiMikgPD0gRVBTSUxPTiAqIE1hdGgubWF4KDEsIE1hdGguYWJzKGEyKSwgTWF0aC5hYnMoYjIpKSAmJiBNYXRoLmFicyhhMyAtIGIzKSA8PSBFUFNJTE9OICoKICAgICAgICAgICAgICAgIE1hdGgubWF4KDEsIE1hdGguYWJzKGEzKSwgTWF0aC5hYnMoYjMpKSAmJiBNYXRoLmFicyhhNCAtIGI0KSA8PSBFUFNJTE9OICogTWF0aC5tYXgoMSwgTWF0aC5hYnMoYTQpLCBNYXRoLmFicyhiNCkpICYmIE1hdGguYWJzKGE1IC0gYjUpIDw9IEVQU0lMT04gKiBNYXRoLm1heCgxLCBNYXRoLmFicyhhNSksIE1hdGguYWJzKGI1KSkgJiYgTWF0aC5hYnMoYTYgLSBiNikgPD0gRVBTSUxPTiAqIE1hdGgubWF4KDEsIE1hdGguYWJzKGE2KSwgTWF0aC5hYnMoYjYpKSAmJiBNYXRoLmFicyhhNyAtIGI3KSA8PSBFUFNJTE9OICogTWF0aC5tYXgoMSwgTWF0aC5hYnMoYTcpLCBNYXRoLmFicyhiNykpICYmIE1hdGguYWJzKGE4IC0gYjgpIDw9IEVQU0lMT04gKiBNYXRoLm1heCgxLCBNYXRoLmFicyhhOCksIE1hdGguYWJzKGI4KSkKICAgICAgICB9CiAgICAgICAgdmFyIG11bCQ2ID0gbXVsdGlwbHkkNjsKICAgICAgICB2YXIgc3ViJDQgPSBzdWJ0cmFjdCQ0OwogICAgICAgIHZhciBtYXQzID0gT2JqZWN0LmZyZWV6ZSh7CiAgICAgICAgICAgIF9fcHJvdG9fXzogbnVsbCwKICAgICAgICAgICAgY3JlYXRlOiBjcmVhdGUkNiwKICAgICAgICAgICAgZnJvbU1hdDQ6IGZyb21NYXQ0JDEsCiAgICAgICAgICAgIGNsb25lOiBjbG9uZSQ2LAogICAgICAgICAgICBjb3B5OiBjb3B5JDYsCiAgICAgICAgICAgIGZyb21WYWx1ZXM6IGZyb21WYWx1ZXMkNiwKICAgICAgICAgICAgc2V0OiBzZXQkNiwKICAgICAgICAgICAgaWRlbnRpdHk6IGlkZW50aXR5JDMsCiAgICAgICAgICAgIHRyYW5zcG9zZTogdHJhbnNwb3NlJDEsCiAgICAgICAgICAgIGludmVydDogaW52ZXJ0JDMsCiAgICAgICAgICAgIGFkam9pbnQ6IGFkam9pbnQkMSwKICAgICAgICAgICAgZGV0ZXJtaW5hbnQ6IGRldGVybWluYW50JDEsCiAgICAgICAgICAgIG11bHRpcGx5OiBtdWx0aXBseSQ2LAogICAgICAgICAgICB0cmFuc2xhdGU6IHRyYW5zbGF0ZSQyLAogICAgICAgICAgICByb3RhdGU6IHJvdGF0ZSQyLAogICAgICAgICAgICBzY2FsZTogc2NhbGUkNiwKICAgICAgICAgICAgZnJvbVRyYW5zbGF0aW9uOiBmcm9tVHJhbnNsYXRpb24kMiwKICAgICAgICAgICAgZnJvbVJvdGF0aW9uOiBmcm9tUm90YXRpb24kMiwKICAgICAgICAgICAgZnJvbVNjYWxpbmc6IGZyb21TY2FsaW5nJDEsCiAgICAgICAgICAgIGZyb21NYXQyZDogZnJvbU1hdDJkLAogICAgICAgICAgICBmcm9tUXVhdDogZnJvbVF1YXQkMSwKICAgICAgICAgICAgbm9ybWFsRnJvbU1hdDQ6IG5vcm1hbEZyb21NYXQ0LAogICAgICAgICAgICBwcm9qZWN0aW9uOiBwcm9qZWN0aW9uLAogICAgICAgICAgICBzdHI6IHN0ciQ2LAogICAgICAgICAgICBmcm9iOiBmcm9iJDEsCiAgICAgICAgICAgIGFkZDogYWRkJDYsCiAgICAgICAgICAgIHN1YnRyYWN0OiBzdWJ0cmFjdCQ0LAogICAgICAgICAgICBtdWx0aXBseVNjYWxhcjogbXVsdGlwbHlTY2FsYXIkMSwKICAgICAgICAgICAgbXVsdGlwbHlTY2FsYXJBbmRBZGQ6IG11bHRpcGx5U2NhbGFyQW5kQWRkJDEsCiAgICAgICAgICAgIGV4YWN0RXF1YWxzOiBleGFjdEVxdWFscyQ2LAogICAgICAgICAgICBlcXVhbHM6IGVxdWFscyQ2LAogICAgICAgICAgICBtdWw6IG11bCQ2LAogICAgICAgICAgICBzdWI6IHN1YiQ0CiAgICAgICAgfSk7CgogICAgICAgIGZ1bmN0aW9uIGNyZWF0ZSQ1KCkgewogICAgICAgICAgICB2YXIgb3V0ID0gbmV3IEFSUkFZX1RZUEUoMTYpOwogICAgICAgICAgICBpZiAoQVJSQVlfVFlQRSAhPSBGbG9hdDMyQXJyYXkpIHsKICAgICAgICAgICAgICAgIG91dFsxXSA9IDA7CiAgICAgICAgICAgICAgICBvdXRbMl0gPSAwOwogICAgICAgICAgICAgICAgb3V0WzNdID0gMDsKICAgICAgICAgICAgICAgIG91dFs0XSA9IDA7CiAgICAgICAgICAgICAgICBvdXRbNl0gPSAwOwogICAgICAgICAgICAgICAgb3V0WzddID0gMDsKICAgICAgICAgICAgICAgIG91dFs4XSA9IDA7CiAgICAgICAgICAgICAgICBvdXRbOV0gPSAwOwogICAgICAgICAgICAgICAgb3V0WzExXSA9IDA7CiAgICAgICAgICAgICAgICBvdXRbMTJdID0gMDsKICAgICAgICAgICAgICAgIG91dFsxM10gPSAwOwogICAgICAgICAgICAgICAgb3V0WzE0XSA9IDAKICAgICAgICAgICAgfQogICAgICAgICAgICBvdXRbMF0gPSAxOwogICAgICAgICAgICBvdXRbNV0gPSAxOwogICAgICAgICAgICBvdXRbMTBdID0gMTsKICAgICAgICAgICAgb3V0WzE1XSA9IDE7CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGNsb25lJDUoYSkgewogICAgICAgICAgICB2YXIgb3V0ID0gbmV3IEFSUkFZX1RZUEUoMTYpOwogICAgICAgICAgICBvdXRbMF0gPSBhWzBdOwogICAgICAgICAgICBvdXRbMV0gPSBhWzFdOwogICAgICAgICAgICBvdXRbMl0gPSBhWzJdOwogICAgICAgICAgICBvdXRbM10gPSBhWzNdOwogICAgICAgICAgICBvdXRbNF0gPSBhWzRdOwogICAgICAgICAgICBvdXRbNV0gPSBhWzVdOwogICAgICAgICAgICBvdXRbNl0gPSBhWzZdOwogICAgICAgICAgICBvdXRbN10gPSBhWzddOwogICAgICAgICAgICBvdXRbOF0gPSBhWzhdOwogICAgICAgICAgICBvdXRbOV0gPSBhWzldOwogICAgICAgICAgICBvdXRbMTBdID0gYVsxMF07CiAgICAgICAgICAgIG91dFsxMV0gPSBhWzExXTsKICAgICAgICAgICAgb3V0WzEyXSA9CiAgICAgICAgICAgICAgICBhWzEyXTsKICAgICAgICAgICAgb3V0WzEzXSA9IGFbMTNdOwogICAgICAgICAgICBvdXRbMTRdID0gYVsxNF07CiAgICAgICAgICAgIG91dFsxNV0gPSBhWzE1XTsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gY29weSQ1KG91dCwgYSkgewogICAgICAgICAgICBvdXRbMF0gPSBhWzBdOwogICAgICAgICAgICBvdXRbMV0gPSBhWzFdOwogICAgICAgICAgICBvdXRbMl0gPSBhWzJdOwogICAgICAgICAgICBvdXRbM10gPSBhWzNdOwogICAgICAgICAgICBvdXRbNF0gPSBhWzRdOwogICAgICAgICAgICBvdXRbNV0gPSBhWzVdOwogICAgICAgICAgICBvdXRbNl0gPSBhWzZdOwogICAgICAgICAgICBvdXRbN10gPSBhWzddOwogICAgICAgICAgICBvdXRbOF0gPSBhWzhdOwogICAgICAgICAgICBvdXRbOV0gPSBhWzldOwogICAgICAgICAgICBvdXRbMTBdID0gYVsxMF07CiAgICAgICAgICAgIG91dFsxMV0gPSBhWzExXTsKICAgICAgICAgICAgb3V0WzEyXSA9IGFbMTJdOwogICAgICAgICAgICBvdXRbMTNdID0gYVsxM107CiAgICAgICAgICAgIG91dFsxNF0gPSBhWzE0XTsKICAgICAgICAgICAgb3V0WzE1XSA9IGFbMTVdOwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBmcm9tVmFsdWVzJDUobTAwLCBtMDEsIG0wMiwgbTAzLCBtMTAsIG0xMSwgbTEyLCBtMTMsIG0yMCwgbTIxLCBtMjIsIG0yMywgbTMwLCBtMzEsIG0zMiwgbTMzKSB7CiAgICAgICAgICAgIHZhciBvdXQgPSBuZXcgQVJSQVlfVFlQRSgxNik7CiAgICAgICAgICAgIG91dFswXSA9IG0wMDsKICAgICAgICAgICAgb3V0WzFdID0gbTAxOwogICAgICAgICAgICBvdXRbMl0gPSBtMDI7CiAgICAgICAgICAgIG91dFszXSA9IG0wMzsKICAgICAgICAgICAgb3V0WzRdID0gbTEwOwogICAgICAgICAgICBvdXRbNV0gPSBtMTE7CiAgICAgICAgICAgIG91dFs2XSA9IG0xMjsKICAgICAgICAgICAgb3V0WzddID0gbTEzOwogICAgICAgICAgICBvdXRbOF0gPQogICAgICAgICAgICAgICAgbTIwOwogICAgICAgICAgICBvdXRbOV0gPSBtMjE7CiAgICAgICAgICAgIG91dFsxMF0gPSBtMjI7CiAgICAgICAgICAgIG91dFsxMV0gPSBtMjM7CiAgICAgICAgICAgIG91dFsxMl0gPSBtMzA7CiAgICAgICAgICAgIG91dFsxM10gPSBtMzE7CiAgICAgICAgICAgIG91dFsxNF0gPSBtMzI7CiAgICAgICAgICAgIG91dFsxNV0gPSBtMzM7CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHNldCQ1KG91dCwgbTAwLCBtMDEsIG0wMiwgbTAzLCBtMTAsIG0xMSwgbTEyLCBtMTMsIG0yMCwgbTIxLCBtMjIsIG0yMywgbTMwLCBtMzEsIG0zMiwgbTMzKSB7CiAgICAgICAgICAgIG91dFswXSA9IG0wMDsKICAgICAgICAgICAgb3V0WzFdID0gbTAxOwogICAgICAgICAgICBvdXRbMl0gPSBtMDI7CiAgICAgICAgICAgIG91dFszXSA9IG0wMzsKICAgICAgICAgICAgb3V0WzRdID0gbTEwOwogICAgICAgICAgICBvdXRbNV0gPSBtMTE7CiAgICAgICAgICAgIG91dFs2XSA9IG0xMjsKICAgICAgICAgICAgb3V0WzddID0gbTEzOwogICAgICAgICAgICBvdXRbOF0gPSBtMjA7CiAgICAgICAgICAgIG91dFs5XSA9IG0yMTsKICAgICAgICAgICAgb3V0WzEwXSA9IG0yMjsKICAgICAgICAgICAgb3V0WzExXSA9IG0yMzsKICAgICAgICAgICAgb3V0WzEyXSA9IG0zMDsKICAgICAgICAgICAgb3V0WzEzXSA9IG0zMTsKICAgICAgICAgICAgb3V0WzE0XSA9IG0zMjsKICAgICAgICAgICAgb3V0WzE1XSA9IG0zMzsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gaWRlbnRpdHkkMihvdXQpIHsKICAgICAgICAgICAgb3V0WzBdID0gMTsKICAgICAgICAgICAgb3V0WzFdID0gMDsKICAgICAgICAgICAgb3V0WzJdID0gMDsKICAgICAgICAgICAgb3V0WzNdID0gMDsKICAgICAgICAgICAgb3V0WzRdID0gMDsKICAgICAgICAgICAgb3V0WzVdID0gMTsKICAgICAgICAgICAgb3V0WzZdID0gMDsKICAgICAgICAgICAgb3V0WzddID0gMDsKICAgICAgICAgICAgb3V0WzhdID0gMDsKICAgICAgICAgICAgb3V0WzldID0gMDsKICAgICAgICAgICAgb3V0WzEwXSA9IDE7CiAgICAgICAgICAgIG91dFsxMV0gPQogICAgICAgICAgICAgICAgMDsKICAgICAgICAgICAgb3V0WzEyXSA9IDA7CiAgICAgICAgICAgIG91dFsxM10gPSAwOwogICAgICAgICAgICBvdXRbMTRdID0gMDsKICAgICAgICAgICAgb3V0WzE1XSA9IDE7CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHRyYW5zcG9zZShvdXQsIGEpIHsKICAgICAgICAgICAgaWYgKG91dCA9PT0gYSkgewogICAgICAgICAgICAgICAgdmFyIGEwMSA9IGFbMV0sCiAgICAgICAgICAgICAgICAgICAgYTAyID0gYVsyXSwKICAgICAgICAgICAgICAgICAgICBhMDMgPSBhWzNdOwogICAgICAgICAgICAgICAgdmFyIGExMiA9IGFbNl0sCiAgICAgICAgICAgICAgICAgICAgYTEzID0gYVs3XTsKICAgICAgICAgICAgICAgIHZhciBhMjMgPSBhWzExXTsKICAgICAgICAgICAgICAgIG91dFsxXSA9IGFbNF07CiAgICAgICAgICAgICAgICBvdXRbMl0gPSBhWzhdOwogICAgICAgICAgICAgICAgb3V0WzNdID0gYVsxMl07CiAgICAgICAgICAgICAgICBvdXRbNF0gPSBhMDE7CiAgICAgICAgICAgICAgICBvdXRbNl0gPSBhWzldOwogICAgICAgICAgICAgICAgb3V0WzddID0gYVsxM107CiAgICAgICAgICAgICAgICBvdXRbOF0gPSBhMDI7CiAgICAgICAgICAgICAgICBvdXRbOV0gPSBhMTI7CiAgICAgICAgICAgICAgICBvdXRbMTFdID0gYVsxNF07CiAgICAgICAgICAgICAgICBvdXRbMTJdID0gYTAzOwogICAgICAgICAgICAgICAgb3V0WzEzXSA9IGExMzsKICAgICAgICAgICAgICAgIG91dFsxNF0gPSBhMjMKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG91dFswXSA9IGFbMF07CiAgICAgICAgICAgICAgICBvdXRbMV0gPSBhWzRdOwogICAgICAgICAgICAgICAgb3V0WzJdID0gYVs4XTsKICAgICAgICAgICAgICAgIG91dFszXSA9IGFbMTJdOwogICAgICAgICAgICAgICAgb3V0WzRdID0gYVsxXTsKICAgICAgICAgICAgICAgIG91dFs1XSA9IGFbNV07CiAgICAgICAgICAgICAgICBvdXRbNl0gPSBhWzldOwogICAgICAgICAgICAgICAgb3V0WzddID0gYVsxM107CiAgICAgICAgICAgICAgICBvdXRbOF0gPSBhWzJdOwogICAgICAgICAgICAgICAgb3V0WzldID0gYVs2XTsKICAgICAgICAgICAgICAgIG91dFsxMF0gPSBhWzEwXTsKICAgICAgICAgICAgICAgIG91dFsxMV0gPSBhWzE0XTsKICAgICAgICAgICAgICAgIG91dFsxMl0gPSBhWzNdOwogICAgICAgICAgICAgICAgb3V0WzEzXSA9IGFbN107CiAgICAgICAgICAgICAgICBvdXRbMTRdID0gYVsxMV07CiAgICAgICAgICAgICAgICBvdXRbMTVdID0KICAgICAgICAgICAgICAgICAgICBhWzE1XQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGludmVydCQyKG91dCwgYSkgewogICAgICAgICAgICB2YXIgYTAwID0gYVswXSwKICAgICAgICAgICAgICAgIGEwMSA9IGFbMV0sCiAgICAgICAgICAgICAgICBhMDIgPSBhWzJdLAogICAgICAgICAgICAgICAgYTAzID0gYVszXTsKICAgICAgICAgICAgdmFyIGExMCA9IGFbNF0sCiAgICAgICAgICAgICAgICBhMTEgPSBhWzVdLAogICAgICAgICAgICAgICAgYTEyID0gYVs2XSwKICAgICAgICAgICAgICAgIGExMyA9IGFbN107CiAgICAgICAgICAgIHZhciBhMjAgPSBhWzhdLAogICAgICAgICAgICAgICAgYTIxID0gYVs5XSwKICAgICAgICAgICAgICAgIGEyMiA9IGFbMTBdLAogICAgICAgICAgICAgICAgYTIzID0gYVsxMV07CiAgICAgICAgICAgIHZhciBhMzAgPSBhWzEyXSwKICAgICAgICAgICAgICAgIGEzMSA9IGFbMTNdLAogICAgICAgICAgICAgICAgYTMyID0gYVsxNF0sCiAgICAgICAgICAgICAgICBhMzMgPSBhWzE1XTsKICAgICAgICAgICAgdmFyIGIwMCA9IGEwMCAqIGExMSAtIGEwMSAqIGExMDsKICAgICAgICAgICAgdmFyIGIwMSA9IGEwMCAqIGExMiAtIGEwMiAqIGExMDsKICAgICAgICAgICAgdmFyIGIwMiA9IGEwMCAqIGExMyAtIGEwMyAqIGExMDsKICAgICAgICAgICAgdmFyIGIwMyA9IGEwMSAqIGExMiAtIGEwMiAqIGExMTsKICAgICAgICAgICAgdmFyIGIwNCA9IGEwMSAqIGExMyAtIGEwMyAqIGExMTsKICAgICAgICAgICAgdmFyIGIwNSA9IGEwMiAqIGExMyAtIGEwMyAqIGExMjsKICAgICAgICAgICAgdmFyIGIwNiA9IGEyMCAqIGEzMSAtIGEyMSAqIGEzMDsKICAgICAgICAgICAgdmFyIGIwNyA9IGEyMCAqIGEzMiAtIGEyMiAqIGEzMDsKICAgICAgICAgICAgdmFyIGIwOCA9IGEyMCAqIGEzMyAtIGEyMyAqIGEzMDsKICAgICAgICAgICAgdmFyIGIwOSA9IGEyMSAqIGEzMiAtIGEyMiAqIGEzMTsKICAgICAgICAgICAgdmFyIGIxMCA9IGEyMSAqIGEzMyAtIGEyMyAqIGEzMTsKICAgICAgICAgICAgdmFyIGIxMSA9IGEyMiAqIGEzMyAtIGEyMyAqIGEzMjsKICAgICAgICAgICAgdmFyIGRldCA9CiAgICAgICAgICAgICAgICBiMDAgKiBiMTEgLSBiMDEgKiBiMTAgKyBiMDIgKiBiMDkgKyBiMDMgKiBiMDggLSBiMDQgKiBiMDcgKyBiMDUgKiBiMDY7CiAgICAgICAgICAgIGlmICghZGV0KSByZXR1cm4gbnVsbDsKICAgICAgICAgICAgZGV0ID0gMSAvIGRldDsKICAgICAgICAgICAgb3V0WzBdID0gKGExMSAqIGIxMSAtIGExMiAqIGIxMCArIGExMyAqIGIwOSkgKiBkZXQ7CiAgICAgICAgICAgIG91dFsxXSA9IChhMDIgKiBiMTAgLSBhMDEgKiBiMTEgLSBhMDMgKiBiMDkpICogZGV0OwogICAgICAgICAgICBvdXRbMl0gPSAoYTMxICogYjA1IC0gYTMyICogYjA0ICsgYTMzICogYjAzKSAqIGRldDsKICAgICAgICAgICAgb3V0WzNdID0gKGEyMiAqIGIwNCAtIGEyMSAqIGIwNSAtIGEyMyAqIGIwMykgKiBkZXQ7CiAgICAgICAgICAgIG91dFs0XSA9IChhMTIgKiBiMDggLSBhMTAgKiBiMTEgLSBhMTMgKiBiMDcpICogZGV0OwogICAgICAgICAgICBvdXRbNV0gPSAoYTAwICogYjExIC0gYTAyICogYjA4ICsgYTAzICogYjA3KSAqIGRldDsKICAgICAgICAgICAgb3V0WzZdID0gKGEzMiAqIGIwMiAtIGEzMCAqIGIwNSAtIGEzMyAqIGIwMSkgKiBkZXQ7CiAgICAgICAgICAgIG91dFs3XSA9IChhMjAgKiBiMDUgLSBhMjIgKiBiMDIgKyBhMjMgKiBiMDEpICogZGV0OwogICAgICAgICAgICBvdXRbOF0gPSAoYTEwICogYjEwIC0gYTExICogYjA4ICsgYTEzICogYjA2KSAqIGRldDsKICAgICAgICAgICAgb3V0WzldID0gKGEwMSAqIGIwOCAtIGEwMCAqIGIxMCAtIGEwMyAqIGIwNikgKiBkZXQ7CiAgICAgICAgICAgIG91dFsxMF0gPSAoYTMwICogYjA0IC0gYTMxICogYjAyICsgYTMzICogYjAwKSAqIGRldDsKICAgICAgICAgICAgb3V0WzExXSA9IChhMjEgKiBiMDIgLQogICAgICAgICAgICAgICAgYTIwICogYjA0IC0gYTIzICogYjAwKSAqIGRldDsKICAgICAgICAgICAgb3V0WzEyXSA9IChhMTEgKiBiMDcgLSBhMTAgKiBiMDkgLSBhMTIgKiBiMDYpICogZGV0OwogICAgICAgICAgICBvdXRbMTNdID0gKGEwMCAqIGIwOSAtIGEwMSAqIGIwNyArIGEwMiAqIGIwNikgKiBkZXQ7CiAgICAgICAgICAgIG91dFsxNF0gPSAoYTMxICogYjAxIC0gYTMwICogYjAzIC0gYTMyICogYjAwKSAqIGRldDsKICAgICAgICAgICAgb3V0WzE1XSA9IChhMjAgKiBiMDMgLSBhMjEgKiBiMDEgKyBhMjIgKiBiMDApICogZGV0OwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBhZGpvaW50KG91dCwgYSkgewogICAgICAgICAgICB2YXIgYTAwID0gYVswXSwKICAgICAgICAgICAgICAgIGEwMSA9IGFbMV0sCiAgICAgICAgICAgICAgICBhMDIgPSBhWzJdLAogICAgICAgICAgICAgICAgYTAzID0gYVszXTsKICAgICAgICAgICAgdmFyIGExMCA9IGFbNF0sCiAgICAgICAgICAgICAgICBhMTEgPSBhWzVdLAogICAgICAgICAgICAgICAgYTEyID0gYVs2XSwKICAgICAgICAgICAgICAgIGExMyA9IGFbN107CiAgICAgICAgICAgIHZhciBhMjAgPSBhWzhdLAogICAgICAgICAgICAgICAgYTIxID0gYVs5XSwKICAgICAgICAgICAgICAgIGEyMiA9IGFbMTBdLAogICAgICAgICAgICAgICAgYTIzID0gYVsxMV07CiAgICAgICAgICAgIHZhciBhMzAgPSBhWzEyXSwKICAgICAgICAgICAgICAgIGEzMSA9IGFbMTNdLAogICAgICAgICAgICAgICAgYTMyID0gYVsxNF0sCiAgICAgICAgICAgICAgICBhMzMgPSBhWzE1XTsKICAgICAgICAgICAgdmFyIGIwMCA9IGEwMCAqIGExMSAtIGEwMSAqIGExMDsKICAgICAgICAgICAgdmFyIGIwMSA9IGEwMCAqIGExMiAtIGEwMiAqIGExMDsKICAgICAgICAgICAgdmFyIGIwMiA9IGEwMCAqIGExMyAtIGEwMyAqIGExMDsKICAgICAgICAgICAgdmFyIGIwMyA9IGEwMSAqIGExMiAtIGEwMiAqIGExMTsKICAgICAgICAgICAgdmFyIGIwNCA9IGEwMSAqIGExMyAtIGEwMyAqIGExMTsKICAgICAgICAgICAgdmFyIGIwNSA9CiAgICAgICAgICAgICAgICBhMDIgKiBhMTMgLSBhMDMgKiBhMTI7CiAgICAgICAgICAgIHZhciBiMDYgPSBhMjAgKiBhMzEgLSBhMjEgKiBhMzA7CiAgICAgICAgICAgIHZhciBiMDcgPSBhMjAgKiBhMzIgLSBhMjIgKiBhMzA7CiAgICAgICAgICAgIHZhciBiMDggPSBhMjAgKiBhMzMgLSBhMjMgKiBhMzA7CiAgICAgICAgICAgIHZhciBiMDkgPSBhMjEgKiBhMzIgLSBhMjIgKiBhMzE7CiAgICAgICAgICAgIHZhciBiMTAgPSBhMjEgKiBhMzMgLSBhMjMgKiBhMzE7CiAgICAgICAgICAgIHZhciBiMTEgPSBhMjIgKiBhMzMgLSBhMjMgKiBhMzI7CiAgICAgICAgICAgIG91dFswXSA9IGExMSAqIGIxMSAtIGExMiAqIGIxMCArIGExMyAqIGIwOTsKICAgICAgICAgICAgb3V0WzFdID0gYTAyICogYjEwIC0gYTAxICogYjExIC0gYTAzICogYjA5OwogICAgICAgICAgICBvdXRbMl0gPSBhMzEgKiBiMDUgLSBhMzIgKiBiMDQgKyBhMzMgKiBiMDM7CiAgICAgICAgICAgIG91dFszXSA9IGEyMiAqIGIwNCAtIGEyMSAqIGIwNSAtIGEyMyAqIGIwMzsKICAgICAgICAgICAgb3V0WzRdID0gYTEyICogYjA4IC0gYTEwICogYjExIC0gYTEzICogYjA3OwogICAgICAgICAgICBvdXRbNV0gPSBhMDAgKiBiMTEgLSBhMDIgKiBiMDggKyBhMDMgKiBiMDc7CiAgICAgICAgICAgIG91dFs2XSA9IGEzMiAqIGIwMiAtIGEzMCAqIGIwNSAtIGEzMyAqIGIwMTsKICAgICAgICAgICAgb3V0WzddID0gYTIwICogYjA1IC0gYTIyICogYjAyICsgYTIzICogYjAxOwogICAgICAgICAgICBvdXRbOF0gPSBhMTAgKiBiMTAgLSBhMTEgKiBiMDggKyBhMTMgKiBiMDY7CiAgICAgICAgICAgIG91dFs5XSA9IGEwMSAqIGIwOCAtIGEwMCAqIGIxMCAtIGEwMyAqIGIwNjsKICAgICAgICAgICAgb3V0WzEwXSA9IGEzMCAqIGIwNCAtIGEzMSAqIGIwMiArIGEzMyAqIGIwMDsKICAgICAgICAgICAgb3V0WzExXSA9IGEyMSAqIGIwMiAtIGEyMCAqIGIwNCAtIGEyMyAqIGIwMDsKICAgICAgICAgICAgb3V0WzEyXSA9IGExMSAqIGIwNyAtIGExMCAqIGIwOSAtIGExMiAqIGIwNjsKICAgICAgICAgICAgb3V0WzEzXSA9IGEwMCAqIGIwOSAtIGEwMSAqIGIwNyArIGEwMiAqIGIwNjsKICAgICAgICAgICAgb3V0WzE0XSA9IGEzMSAqIGIwMSAtIGEzMCAqIGIwMyAtIGEzMiAqIGIwMDsKICAgICAgICAgICAgb3V0WzE1XSA9IGEyMCAqIGIwMyAtIGEyMSAqIGIwMSArIGEyMiAqIGIwMDsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZGV0ZXJtaW5hbnQoYSkgewogICAgICAgICAgICB2YXIgYTAwID0gYVswXSwKICAgICAgICAgICAgICAgIGEwMSA9IGFbMV0sCiAgICAgICAgICAgICAgICBhMDIgPSBhWzJdLAogICAgICAgICAgICAgICAgYTAzID0gYVszXTsKICAgICAgICAgICAgdmFyIGExMCA9IGFbNF0sCiAgICAgICAgICAgICAgICBhMTEgPSBhWzVdLAogICAgICAgICAgICAgICAgYTEyID0gYVs2XSwKICAgICAgICAgICAgICAgIGExMyA9IGFbN107CiAgICAgICAgICAgIHZhciBhMjAgPSBhWzhdLAogICAgICAgICAgICAgICAgYTIxID0gYVs5XSwKICAgICAgICAgICAgICAgIGEyMiA9IGFbMTBdLAogICAgICAgICAgICAgICAgYTIzID0gYVsxMV07CiAgICAgICAgICAgIHZhciBhMzAgPSBhWzEyXSwKICAgICAgICAgICAgICAgIGEzMSA9IGFbMTNdLAogICAgICAgICAgICAgICAgYTMyID0gYVsxNF0sCiAgICAgICAgICAgICAgICBhMzMgPSBhWzE1XTsKICAgICAgICAgICAgdmFyIGIwID0gYTAwICogYTExIC0gYTAxICogYTEwOwogICAgICAgICAgICB2YXIgYjEgPSBhMDAgKiBhMTIgLSBhMDIgKiBhMTA7CiAgICAgICAgICAgIHZhciBiMiA9IGEwMSAqIGExMiAtIGEwMiAqIGExMTsKICAgICAgICAgICAgdmFyIGIzID0gYTIwICogYTMxIC0gYTIxICogYTMwOwogICAgICAgICAgICB2YXIgYjQgPSBhMjAgKiBhMzIgLSBhMjIgKiBhMzA7CiAgICAgICAgICAgIHZhciBiNSA9IGEyMSAqIGEzMiAtIGEyMiAqIGEzMTsKICAgICAgICAgICAgdmFyIGI2ID0KICAgICAgICAgICAgICAgIGEwMCAqIGI1IC0gYTAxICogYjQgKyBhMDIgKiBiMzsKICAgICAgICAgICAgdmFyIGI3ID0gYTEwICogYjUgLSBhMTEgKiBiNCArIGExMiAqIGIzOwogICAgICAgICAgICB2YXIgYjggPSBhMjAgKiBiMiAtIGEyMSAqIGIxICsgYTIyICogYjA7CiAgICAgICAgICAgIHZhciBiOSA9IGEzMCAqIGIyIC0gYTMxICogYjEgKyBhMzIgKiBiMDsKICAgICAgICAgICAgcmV0dXJuIGExMyAqIGI2IC0gYTAzICogYjcgKyBhMzMgKiBiOCAtIGEyMyAqIGI5CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBtdWx0aXBseSQ1KG91dCwgYSwgYikgewogICAgICAgICAgICB2YXIgYTAwID0gYVswXSwKICAgICAgICAgICAgICAgIGEwMSA9IGFbMV0sCiAgICAgICAgICAgICAgICBhMDIgPSBhWzJdLAogICAgICAgICAgICAgICAgYTAzID0gYVszXTsKICAgICAgICAgICAgdmFyIGExMCA9IGFbNF0sCiAgICAgICAgICAgICAgICBhMTEgPSBhWzVdLAogICAgICAgICAgICAgICAgYTEyID0gYVs2XSwKICAgICAgICAgICAgICAgIGExMyA9IGFbN107CiAgICAgICAgICAgIHZhciBhMjAgPSBhWzhdLAogICAgICAgICAgICAgICAgYTIxID0gYVs5XSwKICAgICAgICAgICAgICAgIGEyMiA9IGFbMTBdLAogICAgICAgICAgICAgICAgYTIzID0gYVsxMV07CiAgICAgICAgICAgIHZhciBhMzAgPSBhWzEyXSwKICAgICAgICAgICAgICAgIGEzMSA9IGFbMTNdLAogICAgICAgICAgICAgICAgYTMyID0gYVsxNF0sCiAgICAgICAgICAgICAgICBhMzMgPSBhWzE1XTsKICAgICAgICAgICAgdmFyIGIwID0gYlswXSwKICAgICAgICAgICAgICAgIGIxID0gYlsxXSwKICAgICAgICAgICAgICAgIGIyID0gYlsyXSwKICAgICAgICAgICAgICAgIGIzID0gYlszXTsKICAgICAgICAgICAgb3V0WzBdID0gYjAgKiBhMDAgKyBiMSAqIGExMCArIGIyICogYTIwICsgYjMgKiBhMzA7CiAgICAgICAgICAgIG91dFsxXSA9IGIwICogYTAxICsgYjEgKiBhMTEgKyBiMiAqIGEyMSArIGIzICogYTMxOwogICAgICAgICAgICBvdXRbMl0gPSBiMCAqIGEwMiArIGIxICogYTEyICsgYjIgKiBhMjIgKyBiMyAqIGEzMjsKICAgICAgICAgICAgb3V0WzNdID0gYjAgKiBhMDMgKyBiMSAqIGExMyArIGIyICogYTIzICsKICAgICAgICAgICAgICAgIGIzICogYTMzOwogICAgICAgICAgICBiMCA9IGJbNF07CiAgICAgICAgICAgIGIxID0gYls1XTsKICAgICAgICAgICAgYjIgPSBiWzZdOwogICAgICAgICAgICBiMyA9IGJbN107CiAgICAgICAgICAgIG91dFs0XSA9IGIwICogYTAwICsgYjEgKiBhMTAgKyBiMiAqIGEyMCArIGIzICogYTMwOwogICAgICAgICAgICBvdXRbNV0gPSBiMCAqIGEwMSArIGIxICogYTExICsgYjIgKiBhMjEgKyBiMyAqIGEzMTsKICAgICAgICAgICAgb3V0WzZdID0gYjAgKiBhMDIgKyBiMSAqIGExMiArIGIyICogYTIyICsgYjMgKiBhMzI7CiAgICAgICAgICAgIG91dFs3XSA9IGIwICogYTAzICsgYjEgKiBhMTMgKyBiMiAqIGEyMyArIGIzICogYTMzOwogICAgICAgICAgICBiMCA9IGJbOF07CiAgICAgICAgICAgIGIxID0gYls5XTsKICAgICAgICAgICAgYjIgPSBiWzEwXTsKICAgICAgICAgICAgYjMgPSBiWzExXTsKICAgICAgICAgICAgb3V0WzhdID0gYjAgKiBhMDAgKyBiMSAqIGExMCArIGIyICogYTIwICsgYjMgKiBhMzA7CiAgICAgICAgICAgIG91dFs5XSA9IGIwICogYTAxICsgYjEgKiBhMTEgKyBiMiAqIGEyMSArIGIzICogYTMxOwogICAgICAgICAgICBvdXRbMTBdID0gYjAgKiBhMDIgKyBiMSAqIGExMiArIGIyICogYTIyICsgYjMgKiBhMzI7CiAgICAgICAgICAgIG91dFsxMV0gPSBiMCAqIGEwMyArIGIxICogYTEzICsgYjIgKiBhMjMgKyBiMyAqIGEzMzsKICAgICAgICAgICAgYjAgPSBiWzEyXTsKICAgICAgICAgICAgYjEgPSBiWzEzXTsKICAgICAgICAgICAgYjIgPSBiWzE0XTsKICAgICAgICAgICAgYjMgPSBiWzE1XTsKICAgICAgICAgICAgb3V0WzEyXSA9IGIwICogYTAwICsgYjEgKiBhMTAgKyBiMiAqIGEyMCArIGIzICogYTMwOwogICAgICAgICAgICBvdXRbMTNdID0gYjAgKiBhMDEgKyBiMSAqIGExMSArIGIyICogYTIxICsgYjMgKiBhMzE7CiAgICAgICAgICAgIG91dFsxNF0gPSBiMCAqIGEwMiArIGIxICogYTEyICsgYjIgKiBhMjIgKyBiMyAqIGEzMjsKICAgICAgICAgICAgb3V0WzE1XSA9CiAgICAgICAgICAgICAgICBiMCAqIGEwMyArIGIxICogYTEzICsgYjIgKiBhMjMgKyBiMyAqIGEzMzsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gdHJhbnNsYXRlJDEob3V0LCBhLCB2KSB7CiAgICAgICAgICAgIHZhciB4ID0gdlswXSwKICAgICAgICAgICAgICAgIHkgPSB2WzFdLAogICAgICAgICAgICAgICAgeiA9IHZbMl07CiAgICAgICAgICAgIHZhciBhMDAsIGEwMSwgYTAyLCBhMDM7CiAgICAgICAgICAgIHZhciBhMTAsIGExMSwgYTEyLCBhMTM7CiAgICAgICAgICAgIHZhciBhMjAsIGEyMSwgYTIyLCBhMjM7CiAgICAgICAgICAgIGlmIChhID09PSBvdXQpIHsKICAgICAgICAgICAgICAgIG91dFsxMl0gPSBhWzBdICogeCArIGFbNF0gKiB5ICsgYVs4XSAqIHogKyBhWzEyXTsKICAgICAgICAgICAgICAgIG91dFsxM10gPSBhWzFdICogeCArIGFbNV0gKiB5ICsgYVs5XSAqIHogKyBhWzEzXTsKICAgICAgICAgICAgICAgIG91dFsxNF0gPSBhWzJdICogeCArIGFbNl0gKiB5ICsgYVsxMF0gKiB6ICsgYVsxNF07CiAgICAgICAgICAgICAgICBvdXRbMTVdID0gYVszXSAqIHggKyBhWzddICogeSArIGFbMTFdICogeiArIGFbMTVdCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBhMDAgPSBhWzBdOwogICAgICAgICAgICAgICAgYTAxID0gYVsxXTsKICAgICAgICAgICAgICAgIGEwMiA9IGFbMl07CiAgICAgICAgICAgICAgICBhMDMgPSBhWzNdOwogICAgICAgICAgICAgICAgYTEwID0gYVs0XTsKICAgICAgICAgICAgICAgIGExMSA9IGFbNV07CiAgICAgICAgICAgICAgICBhMTIgPSBhWzZdOwogICAgICAgICAgICAgICAgYTEzID0gYVs3XTsKICAgICAgICAgICAgICAgIGEyMCA9IGFbOF07CiAgICAgICAgICAgICAgICBhMjEgPSBhWzldOwogICAgICAgICAgICAgICAgYTIyID0gYVsxMF07CiAgICAgICAgICAgICAgICBhMjMgPSBhWzExXTsKICAgICAgICAgICAgICAgIG91dFswXSA9IGEwMDsKICAgICAgICAgICAgICAgIG91dFsxXSA9IGEwMTsKICAgICAgICAgICAgICAgIG91dFsyXSA9IGEwMjsKICAgICAgICAgICAgICAgIG91dFszXSA9IGEwMzsKICAgICAgICAgICAgICAgIG91dFs0XSA9IGExMDsKICAgICAgICAgICAgICAgIG91dFs1XSA9IGExMTsKICAgICAgICAgICAgICAgIG91dFs2XSA9IGExMjsKICAgICAgICAgICAgICAgIG91dFs3XSA9CiAgICAgICAgICAgICAgICAgICAgYTEzOwogICAgICAgICAgICAgICAgb3V0WzhdID0gYTIwOwogICAgICAgICAgICAgICAgb3V0WzldID0gYTIxOwogICAgICAgICAgICAgICAgb3V0WzEwXSA9IGEyMjsKICAgICAgICAgICAgICAgIG91dFsxMV0gPSBhMjM7CiAgICAgICAgICAgICAgICBvdXRbMTJdID0gYTAwICogeCArIGExMCAqIHkgKyBhMjAgKiB6ICsgYVsxMl07CiAgICAgICAgICAgICAgICBvdXRbMTNdID0gYTAxICogeCArIGExMSAqIHkgKyBhMjEgKiB6ICsgYVsxM107CiAgICAgICAgICAgICAgICBvdXRbMTRdID0gYTAyICogeCArIGExMiAqIHkgKyBhMjIgKiB6ICsgYVsxNF07CiAgICAgICAgICAgICAgICBvdXRbMTVdID0gYTAzICogeCArIGExMyAqIHkgKyBhMjMgKiB6ICsgYVsxNV0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBzY2FsZSQ1KG91dCwgYSwgdikgewogICAgICAgICAgICB2YXIgeCA9IHZbMF0sCiAgICAgICAgICAgICAgICB5ID0gdlsxXSwKICAgICAgICAgICAgICAgIHogPSB2WzJdOwogICAgICAgICAgICBvdXRbMF0gPSBhWzBdICogeDsKICAgICAgICAgICAgb3V0WzFdID0gYVsxXSAqIHg7CiAgICAgICAgICAgIG91dFsyXSA9IGFbMl0gKiB4OwogICAgICAgICAgICBvdXRbM10gPSBhWzNdICogeDsKICAgICAgICAgICAgb3V0WzRdID0gYVs0XSAqIHk7CiAgICAgICAgICAgIG91dFs1XSA9IGFbNV0gKiB5OwogICAgICAgICAgICBvdXRbNl0gPSBhWzZdICogeTsKICAgICAgICAgICAgb3V0WzddID0gYVs3XSAqIHk7CiAgICAgICAgICAgIG91dFs4XSA9IGFbOF0gKiB6OwogICAgICAgICAgICBvdXRbOV0gPSBhWzldICogejsKICAgICAgICAgICAgb3V0WzEwXSA9IGFbMTBdICogejsKICAgICAgICAgICAgb3V0WzExXSA9IGFbMTFdICogejsKICAgICAgICAgICAgb3V0WzEyXSA9IGFbMTJdOwogICAgICAgICAgICBvdXRbMTNdID0gYVsxM107CiAgICAgICAgICAgIG91dFsxNF0gPSBhWzE0XTsKICAgICAgICAgICAgb3V0WzE1XSA9IGFbMTVdOwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiByb3RhdGUkMShvdXQsCiAgICAgICAgICAgIGEsIHJhZCwgYXhpcykgewogICAgICAgICAgICB2YXIgeCA9IGF4aXNbMF0sCiAgICAgICAgICAgICAgICB5ID0gYXhpc1sxXSwKICAgICAgICAgICAgICAgIHogPSBheGlzWzJdOwogICAgICAgICAgICB2YXIgbGVuID0gTWF0aC5oeXBvdCh4LCB5LCB6KTsKICAgICAgICAgICAgdmFyIHMsIGMsIHQ7CiAgICAgICAgICAgIHZhciBhMDAsIGEwMSwgYTAyLCBhMDM7CiAgICAgICAgICAgIHZhciBhMTAsIGExMSwgYTEyLCBhMTM7CiAgICAgICAgICAgIHZhciBhMjAsIGEyMSwgYTIyLCBhMjM7CiAgICAgICAgICAgIHZhciBiMDAsIGIwMSwgYjAyOwogICAgICAgICAgICB2YXIgYjEwLCBiMTEsIGIxMjsKICAgICAgICAgICAgdmFyIGIyMCwgYjIxLCBiMjI7CiAgICAgICAgICAgIGlmIChsZW4gPCBFUFNJTE9OKSByZXR1cm4gbnVsbDsKICAgICAgICAgICAgbGVuID0gMSAvIGxlbjsKICAgICAgICAgICAgeCAqPSBsZW47CiAgICAgICAgICAgIHkgKj0gbGVuOwogICAgICAgICAgICB6ICo9IGxlbjsKICAgICAgICAgICAgcyA9IE1hdGguc2luKHJhZCk7CiAgICAgICAgICAgIGMgPSBNYXRoLmNvcyhyYWQpOwogICAgICAgICAgICB0ID0gMSAtIGM7CiAgICAgICAgICAgIGEwMCA9IGFbMF07CiAgICAgICAgICAgIGEwMSA9IGFbMV07CiAgICAgICAgICAgIGEwMiA9IGFbMl07CiAgICAgICAgICAgIGEwMyA9IGFbM107CiAgICAgICAgICAgIGExMCA9IGFbNF07CiAgICAgICAgICAgIGExMSA9IGFbNV07CiAgICAgICAgICAgIGExMiA9IGFbNl07CiAgICAgICAgICAgIGExMyA9IGFbN107CiAgICAgICAgICAgIGEyMCA9IGFbOF07CiAgICAgICAgICAgIGEyMSA9IGFbOV07CiAgICAgICAgICAgIGEyMiA9IGFbMTBdOwogICAgICAgICAgICBhMjMgPSBhWzExXTsKICAgICAgICAgICAgYjAwID0geCAqIHggKiB0ICsgYzsKICAgICAgICAgICAgYjAxID0geSAqIHggKiB0ICsgeiAqIHM7CiAgICAgICAgICAgIGIwMiA9IHogKiB4ICogdCAtIHkgKiBzOwogICAgICAgICAgICBiMTAgPSB4ICogeSAqIHQgLSB6ICogczsKICAgICAgICAgICAgYjExID0geSAqIHkgKiB0ICsgYzsKICAgICAgICAgICAgYjEyID0geiAqIHkgKiB0ICsgeCAqIHM7CiAgICAgICAgICAgIGIyMCA9IHggKiB6ICogdCArIHkgKiBzOwogICAgICAgICAgICBiMjEgPSB5ICogeiAqIHQgLSB4ICoKICAgICAgICAgICAgICAgIHM7CiAgICAgICAgICAgIGIyMiA9IHogKiB6ICogdCArIGM7CiAgICAgICAgICAgIG91dFswXSA9IGEwMCAqIGIwMCArIGExMCAqIGIwMSArIGEyMCAqIGIwMjsKICAgICAgICAgICAgb3V0WzFdID0gYTAxICogYjAwICsgYTExICogYjAxICsgYTIxICogYjAyOwogICAgICAgICAgICBvdXRbMl0gPSBhMDIgKiBiMDAgKyBhMTIgKiBiMDEgKyBhMjIgKiBiMDI7CiAgICAgICAgICAgIG91dFszXSA9IGEwMyAqIGIwMCArIGExMyAqIGIwMSArIGEyMyAqIGIwMjsKICAgICAgICAgICAgb3V0WzRdID0gYTAwICogYjEwICsgYTEwICogYjExICsgYTIwICogYjEyOwogICAgICAgICAgICBvdXRbNV0gPSBhMDEgKiBiMTAgKyBhMTEgKiBiMTEgKyBhMjEgKiBiMTI7CiAgICAgICAgICAgIG91dFs2XSA9IGEwMiAqIGIxMCArIGExMiAqIGIxMSArIGEyMiAqIGIxMjsKICAgICAgICAgICAgb3V0WzddID0gYTAzICogYjEwICsgYTEzICogYjExICsgYTIzICogYjEyOwogICAgICAgICAgICBvdXRbOF0gPSBhMDAgKiBiMjAgKyBhMTAgKiBiMjEgKyBhMjAgKiBiMjI7CiAgICAgICAgICAgIG91dFs5XSA9IGEwMSAqIGIyMCArIGExMSAqIGIyMSArIGEyMSAqIGIyMjsKICAgICAgICAgICAgb3V0WzEwXSA9IGEwMiAqIGIyMCArIGExMiAqIGIyMSArIGEyMiAqIGIyMjsKICAgICAgICAgICAgb3V0WzExXSA9IGEwMyAqIGIyMCArIGExMyAqIGIyMSArIGEyMyAqIGIyMjsKICAgICAgICAgICAgaWYgKGEgIT09IG91dCkgewogICAgICAgICAgICAgICAgb3V0WzEyXSA9IGFbMTJdOwogICAgICAgICAgICAgICAgb3V0WzEzXSA9IGFbMTNdOwogICAgICAgICAgICAgICAgb3V0WzE0XSA9IGFbMTRdOwogICAgICAgICAgICAgICAgb3V0WzE1XSA9IGFbMTVdCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gcm90YXRlWCQzKG91dCwgYSwgcmFkKSB7CiAgICAgICAgICAgIHZhciBzID0KICAgICAgICAgICAgICAgIE1hdGguc2luKHJhZCk7CiAgICAgICAgICAgIHZhciBjID0gTWF0aC5jb3MocmFkKTsKICAgICAgICAgICAgdmFyIGExMCA9IGFbNF07CiAgICAgICAgICAgIHZhciBhMTEgPSBhWzVdOwogICAgICAgICAgICB2YXIgYTEyID0gYVs2XTsKICAgICAgICAgICAgdmFyIGExMyA9IGFbN107CiAgICAgICAgICAgIHZhciBhMjAgPSBhWzhdOwogICAgICAgICAgICB2YXIgYTIxID0gYVs5XTsKICAgICAgICAgICAgdmFyIGEyMiA9IGFbMTBdOwogICAgICAgICAgICB2YXIgYTIzID0gYVsxMV07CiAgICAgICAgICAgIGlmIChhICE9PSBvdXQpIHsKICAgICAgICAgICAgICAgIG91dFswXSA9IGFbMF07CiAgICAgICAgICAgICAgICBvdXRbMV0gPSBhWzFdOwogICAgICAgICAgICAgICAgb3V0WzJdID0gYVsyXTsKICAgICAgICAgICAgICAgIG91dFszXSA9IGFbM107CiAgICAgICAgICAgICAgICBvdXRbMTJdID0gYVsxMl07CiAgICAgICAgICAgICAgICBvdXRbMTNdID0gYVsxM107CiAgICAgICAgICAgICAgICBvdXRbMTRdID0gYVsxNF07CiAgICAgICAgICAgICAgICBvdXRbMTVdID0gYVsxNV0KICAgICAgICAgICAgfQogICAgICAgICAgICBvdXRbNF0gPSBhMTAgKiBjICsgYTIwICogczsKICAgICAgICAgICAgb3V0WzVdID0gYTExICogYyArIGEyMSAqIHM7CiAgICAgICAgICAgIG91dFs2XSA9IGExMiAqIGMgKyBhMjIgKiBzOwogICAgICAgICAgICBvdXRbN10gPSBhMTMgKiBjICsgYTIzICogczsKICAgICAgICAgICAgb3V0WzhdID0gYTIwICogYyAtIGExMCAqIHM7CiAgICAgICAgICAgIG91dFs5XSA9IGEyMSAqIGMgLSBhMTEgKiBzOwogICAgICAgICAgICBvdXRbMTBdID0gYTIyICogYyAtIGExMiAqIHM7CiAgICAgICAgICAgIG91dFsxMV0gPSBhMjMgKiBjIC0gYTEzICogczsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gcm90YXRlWSQzKG91dCwgYSwgcmFkKSB7CiAgICAgICAgICAgIHZhciBzID0gTWF0aC5zaW4ocmFkKTsKICAgICAgICAgICAgdmFyIGMgPSBNYXRoLmNvcyhyYWQpOwogICAgICAgICAgICB2YXIgYTAwID0gYVswXTsKICAgICAgICAgICAgdmFyIGEwMSA9IGFbMV07CiAgICAgICAgICAgIHZhciBhMDIgPSBhWzJdOwogICAgICAgICAgICB2YXIgYTAzID0gYVszXTsKICAgICAgICAgICAgdmFyIGEyMCA9IGFbOF07CiAgICAgICAgICAgIHZhciBhMjEgPSBhWzldOwogICAgICAgICAgICB2YXIgYTIyID0gYVsxMF07CiAgICAgICAgICAgIHZhciBhMjMgPSBhWzExXTsKICAgICAgICAgICAgaWYgKGEgIT09IG91dCkgewogICAgICAgICAgICAgICAgb3V0WzRdID0gYVs0XTsKICAgICAgICAgICAgICAgIG91dFs1XSA9IGFbNV07CiAgICAgICAgICAgICAgICBvdXRbNl0gPSBhWzZdOwogICAgICAgICAgICAgICAgb3V0WzddID0gYVs3XTsKICAgICAgICAgICAgICAgIG91dFsxMl0gPSBhWzEyXTsKICAgICAgICAgICAgICAgIG91dFsxM10gPSBhWzEzXTsKICAgICAgICAgICAgICAgIG91dFsxNF0gPSBhWzE0XTsKICAgICAgICAgICAgICAgIG91dFsxNV0gPSBhWzE1XQogICAgICAgICAgICB9CiAgICAgICAgICAgIG91dFswXSA9IGEwMCAqIGMgLSBhMjAgKiBzOwogICAgICAgICAgICBvdXRbMV0gPSBhMDEgKiBjIC0gYTIxICogczsKICAgICAgICAgICAgb3V0WzJdID0gYTAyICogYyAtIGEyMiAqIHM7CiAgICAgICAgICAgIG91dFszXSA9IGEwMyAqIGMgLSBhMjMgKiBzOwogICAgICAgICAgICBvdXRbOF0gPSBhMDAgKiBzICsgYTIwICogYzsKICAgICAgICAgICAgb3V0WzldID0gYTAxICogcyArIGEyMSAqIGM7CiAgICAgICAgICAgIG91dFsxMF0gPSBhMDIgKiBzICsgYTIyICogYzsKICAgICAgICAgICAgb3V0WzExXSA9IGEwMyAqIHMgKyBhMjMgKiBjOwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiByb3RhdGVaJDMob3V0LCBhLCByYWQpIHsKICAgICAgICAgICAgdmFyIHMgPSBNYXRoLnNpbihyYWQpOwogICAgICAgICAgICB2YXIgYyA9IE1hdGguY29zKHJhZCk7CiAgICAgICAgICAgIHZhciBhMDAgPSBhWzBdOwogICAgICAgICAgICB2YXIgYTAxID0gYVsxXTsKICAgICAgICAgICAgdmFyIGEwMiA9IGFbMl07CiAgICAgICAgICAgIHZhciBhMDMgPSBhWzNdOwogICAgICAgICAgICB2YXIgYTEwID0KICAgICAgICAgICAgICAgIGFbNF07CiAgICAgICAgICAgIHZhciBhMTEgPSBhWzVdOwogICAgICAgICAgICB2YXIgYTEyID0gYVs2XTsKICAgICAgICAgICAgdmFyIGExMyA9IGFbN107CiAgICAgICAgICAgIGlmIChhICE9PSBvdXQpIHsKICAgICAgICAgICAgICAgIG91dFs4XSA9IGFbOF07CiAgICAgICAgICAgICAgICBvdXRbOV0gPSBhWzldOwogICAgICAgICAgICAgICAgb3V0WzEwXSA9IGFbMTBdOwogICAgICAgICAgICAgICAgb3V0WzExXSA9IGFbMTFdOwogICAgICAgICAgICAgICAgb3V0WzEyXSA9IGFbMTJdOwogICAgICAgICAgICAgICAgb3V0WzEzXSA9IGFbMTNdOwogICAgICAgICAgICAgICAgb3V0WzE0XSA9IGFbMTRdOwogICAgICAgICAgICAgICAgb3V0WzE1XSA9IGFbMTVdCiAgICAgICAgICAgIH0KICAgICAgICAgICAgb3V0WzBdID0gYTAwICogYyArIGExMCAqIHM7CiAgICAgICAgICAgIG91dFsxXSA9IGEwMSAqIGMgKyBhMTEgKiBzOwogICAgICAgICAgICBvdXRbMl0gPSBhMDIgKiBjICsgYTEyICogczsKICAgICAgICAgICAgb3V0WzNdID0gYTAzICogYyArIGExMyAqIHM7CiAgICAgICAgICAgIG91dFs0XSA9IGExMCAqIGMgLSBhMDAgKiBzOwogICAgICAgICAgICBvdXRbNV0gPSBhMTEgKiBjIC0gYTAxICogczsKICAgICAgICAgICAgb3V0WzZdID0gYTEyICogYyAtIGEwMiAqIHM7CiAgICAgICAgICAgIG91dFs3XSA9IGExMyAqIGMgLSBhMDMgKiBzOwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBmcm9tVHJhbnNsYXRpb24kMShvdXQsIHYpIHsKICAgICAgICAgICAgb3V0WzBdID0gMTsKICAgICAgICAgICAgb3V0WzFdID0gMDsKICAgICAgICAgICAgb3V0WzJdID0gMDsKICAgICAgICAgICAgb3V0WzNdID0gMDsKICAgICAgICAgICAgb3V0WzRdID0gMDsKICAgICAgICAgICAgb3V0WzVdID0gMTsKICAgICAgICAgICAgb3V0WzZdID0gMDsKICAgICAgICAgICAgb3V0WzddID0gMDsKICAgICAgICAgICAgb3V0WzhdID0gMDsKICAgICAgICAgICAgb3V0WzldID0gMDsKICAgICAgICAgICAgb3V0WzEwXSA9IDE7CiAgICAgICAgICAgIG91dFsxMV0gPSAwOwogICAgICAgICAgICBvdXRbMTJdID0gdlswXTsKICAgICAgICAgICAgb3V0WzEzXSA9IHZbMV07CiAgICAgICAgICAgIG91dFsxNF0gPQogICAgICAgICAgICAgICAgdlsyXTsKICAgICAgICAgICAgb3V0WzE1XSA9IDE7CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGZyb21TY2FsaW5nKG91dCwgdikgewogICAgICAgICAgICBvdXRbMF0gPSB2WzBdOwogICAgICAgICAgICBvdXRbMV0gPSAwOwogICAgICAgICAgICBvdXRbMl0gPSAwOwogICAgICAgICAgICBvdXRbM10gPSAwOwogICAgICAgICAgICBvdXRbNF0gPSAwOwogICAgICAgICAgICBvdXRbNV0gPSB2WzFdOwogICAgICAgICAgICBvdXRbNl0gPSAwOwogICAgICAgICAgICBvdXRbN10gPSAwOwogICAgICAgICAgICBvdXRbOF0gPSAwOwogICAgICAgICAgICBvdXRbOV0gPSAwOwogICAgICAgICAgICBvdXRbMTBdID0gdlsyXTsKICAgICAgICAgICAgb3V0WzExXSA9IDA7CiAgICAgICAgICAgIG91dFsxMl0gPSAwOwogICAgICAgICAgICBvdXRbMTNdID0gMDsKICAgICAgICAgICAgb3V0WzE0XSA9IDA7CiAgICAgICAgICAgIG91dFsxNV0gPSAxOwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBmcm9tUm90YXRpb24kMShvdXQsIHJhZCwgYXhpcykgewogICAgICAgICAgICB2YXIgeCA9IGF4aXNbMF0sCiAgICAgICAgICAgICAgICB5ID0gYXhpc1sxXSwKICAgICAgICAgICAgICAgIHogPSBheGlzWzJdOwogICAgICAgICAgICB2YXIgbGVuID0gTWF0aC5oeXBvdCh4LCB5LCB6KTsKICAgICAgICAgICAgdmFyIHMsIGMsIHQ7CiAgICAgICAgICAgIGlmIChsZW4gPCBFUFNJTE9OKSByZXR1cm4gbnVsbDsKICAgICAgICAgICAgbGVuID0gMSAvIGxlbjsKICAgICAgICAgICAgeCAqPSBsZW47CiAgICAgICAgICAgIHkgKj0gbGVuOwogICAgICAgICAgICB6ICo9IGxlbjsKICAgICAgICAgICAgcyA9IE1hdGguc2luKHJhZCk7CiAgICAgICAgICAgIGMgPSBNYXRoLmNvcyhyYWQpOwogICAgICAgICAgICB0ID0gMSAtIGM7CiAgICAgICAgICAgIG91dFswXSA9IHggKiB4ICogdCArIGM7CiAgICAgICAgICAgIG91dFsxXSA9IHkgKiB4ICogdCArIHogKiBzOwogICAgICAgICAgICBvdXRbMl0gPSB6ICogeCAqIHQgLSB5ICogczsKICAgICAgICAgICAgb3V0WzNdID0gMDsKICAgICAgICAgICAgb3V0WzRdID0geCAqIHkgKiB0IC0geiAqCiAgICAgICAgICAgICAgICBzOwogICAgICAgICAgICBvdXRbNV0gPSB5ICogeSAqIHQgKyBjOwogICAgICAgICAgICBvdXRbNl0gPSB6ICogeSAqIHQgKyB4ICogczsKICAgICAgICAgICAgb3V0WzddID0gMDsKICAgICAgICAgICAgb3V0WzhdID0geCAqIHogKiB0ICsgeSAqIHM7CiAgICAgICAgICAgIG91dFs5XSA9IHkgKiB6ICogdCAtIHggKiBzOwogICAgICAgICAgICBvdXRbMTBdID0geiAqIHogKiB0ICsgYzsKICAgICAgICAgICAgb3V0WzExXSA9IDA7CiAgICAgICAgICAgIG91dFsxMl0gPSAwOwogICAgICAgICAgICBvdXRbMTNdID0gMDsKICAgICAgICAgICAgb3V0WzE0XSA9IDA7CiAgICAgICAgICAgIG91dFsxNV0gPSAxOwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBmcm9tWFJvdGF0aW9uKG91dCwgcmFkKSB7CiAgICAgICAgICAgIHZhciBzID0gTWF0aC5zaW4ocmFkKTsKICAgICAgICAgICAgdmFyIGMgPSBNYXRoLmNvcyhyYWQpOwogICAgICAgICAgICBvdXRbMF0gPSAxOwogICAgICAgICAgICBvdXRbMV0gPSAwOwogICAgICAgICAgICBvdXRbMl0gPSAwOwogICAgICAgICAgICBvdXRbM10gPSAwOwogICAgICAgICAgICBvdXRbNF0gPSAwOwogICAgICAgICAgICBvdXRbNV0gPSBjOwogICAgICAgICAgICBvdXRbNl0gPSBzOwogICAgICAgICAgICBvdXRbN10gPSAwOwogICAgICAgICAgICBvdXRbOF0gPSAwOwogICAgICAgICAgICBvdXRbOV0gPSAtczsKICAgICAgICAgICAgb3V0WzEwXSA9IGM7CiAgICAgICAgICAgIG91dFsxMV0gPSAwOwogICAgICAgICAgICBvdXRbMTJdID0gMDsKICAgICAgICAgICAgb3V0WzEzXSA9IDA7CiAgICAgICAgICAgIG91dFsxNF0gPSAwOwogICAgICAgICAgICBvdXRbMTVdID0gMTsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZnJvbVlSb3RhdGlvbihvdXQsIHJhZCkgewogICAgICAgICAgICB2YXIgcyA9IE1hdGguc2luKHJhZCk7CiAgICAgICAgICAgIHZhciBjID0gTWF0aC5jb3MocmFkKTsKICAgICAgICAgICAgb3V0WzBdID0gYzsKICAgICAgICAgICAgb3V0WzFdID0gMDsKICAgICAgICAgICAgb3V0WzJdID0gLXM7CiAgICAgICAgICAgIG91dFszXSA9IDA7CiAgICAgICAgICAgIG91dFs0XSA9CiAgICAgICAgICAgICAgICAwOwogICAgICAgICAgICBvdXRbNV0gPSAxOwogICAgICAgICAgICBvdXRbNl0gPSAwOwogICAgICAgICAgICBvdXRbN10gPSAwOwogICAgICAgICAgICBvdXRbOF0gPSBzOwogICAgICAgICAgICBvdXRbOV0gPSAwOwogICAgICAgICAgICBvdXRbMTBdID0gYzsKICAgICAgICAgICAgb3V0WzExXSA9IDA7CiAgICAgICAgICAgIG91dFsxMl0gPSAwOwogICAgICAgICAgICBvdXRbMTNdID0gMDsKICAgICAgICAgICAgb3V0WzE0XSA9IDA7CiAgICAgICAgICAgIG91dFsxNV0gPSAxOwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBmcm9tWlJvdGF0aW9uKG91dCwgcmFkKSB7CiAgICAgICAgICAgIHZhciBzID0gTWF0aC5zaW4ocmFkKTsKICAgICAgICAgICAgdmFyIGMgPSBNYXRoLmNvcyhyYWQpOwogICAgICAgICAgICBvdXRbMF0gPSBjOwogICAgICAgICAgICBvdXRbMV0gPSBzOwogICAgICAgICAgICBvdXRbMl0gPSAwOwogICAgICAgICAgICBvdXRbM10gPSAwOwogICAgICAgICAgICBvdXRbNF0gPSAtczsKICAgICAgICAgICAgb3V0WzVdID0gYzsKICAgICAgICAgICAgb3V0WzZdID0gMDsKICAgICAgICAgICAgb3V0WzddID0gMDsKICAgICAgICAgICAgb3V0WzhdID0gMDsKICAgICAgICAgICAgb3V0WzldID0gMDsKICAgICAgICAgICAgb3V0WzEwXSA9IDE7CiAgICAgICAgICAgIG91dFsxMV0gPSAwOwogICAgICAgICAgICBvdXRbMTJdID0gMDsKICAgICAgICAgICAgb3V0WzEzXSA9IDA7CiAgICAgICAgICAgIG91dFsxNF0gPSAwOwogICAgICAgICAgICBvdXRbMTVdID0gMTsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZnJvbVJvdGF0aW9uVHJhbnNsYXRpb24kMShvdXQsIHEsIHYpIHsKICAgICAgICAgICAgdmFyIHggPSBxWzBdLAogICAgICAgICAgICAgICAgeSA9IHFbMV0sCiAgICAgICAgICAgICAgICB6ID0gcVsyXSwKICAgICAgICAgICAgICAgIHcgPSBxWzNdOwogICAgICAgICAgICB2YXIgeDIgPSB4ICsgeDsKICAgICAgICAgICAgdmFyIHkyID0geSArIHk7CiAgICAgICAgICAgIHZhciB6MiA9IHogKyB6OwogICAgICAgICAgICB2YXIgeHggPSB4ICogeDI7CiAgICAgICAgICAgIHZhciB4eSA9IHggKiB5MjsKICAgICAgICAgICAgdmFyIHh6ID0geCAqIHoyOwogICAgICAgICAgICB2YXIgeXkgPQogICAgICAgICAgICAgICAgeSAqIHkyOwogICAgICAgICAgICB2YXIgeXogPSB5ICogejI7CiAgICAgICAgICAgIHZhciB6eiA9IHogKiB6MjsKICAgICAgICAgICAgdmFyIHd4ID0gdyAqIHgyOwogICAgICAgICAgICB2YXIgd3kgPSB3ICogeTI7CiAgICAgICAgICAgIHZhciB3eiA9IHcgKiB6MjsKICAgICAgICAgICAgb3V0WzBdID0gMSAtICh5eSArIHp6KTsKICAgICAgICAgICAgb3V0WzFdID0geHkgKyB3ejsKICAgICAgICAgICAgb3V0WzJdID0geHogLSB3eTsKICAgICAgICAgICAgb3V0WzNdID0gMDsKICAgICAgICAgICAgb3V0WzRdID0geHkgLSB3ejsKICAgICAgICAgICAgb3V0WzVdID0gMSAtICh4eCArIHp6KTsKICAgICAgICAgICAgb3V0WzZdID0geXogKyB3eDsKICAgICAgICAgICAgb3V0WzddID0gMDsKICAgICAgICAgICAgb3V0WzhdID0geHogKyB3eTsKICAgICAgICAgICAgb3V0WzldID0geXogLSB3eDsKICAgICAgICAgICAgb3V0WzEwXSA9IDEgLSAoeHggKyB5eSk7CiAgICAgICAgICAgIG91dFsxMV0gPSAwOwogICAgICAgICAgICBvdXRbMTJdID0gdlswXTsKICAgICAgICAgICAgb3V0WzEzXSA9IHZbMV07CiAgICAgICAgICAgIG91dFsxNF0gPSB2WzJdOwogICAgICAgICAgICBvdXRbMTVdID0gMTsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZnJvbVF1YXQyKG91dCwgYSkgewogICAgICAgICAgICB2YXIgdHJhbnNsYXRpb24gPSBuZXcgQVJSQVlfVFlQRSgzKTsKICAgICAgICAgICAgdmFyIGJ4ID0gLWFbMF0sCiAgICAgICAgICAgICAgICBieSA9IC1hWzFdLAogICAgICAgICAgICAgICAgYnogPSAtYVsyXSwKICAgICAgICAgICAgICAgIGJ3ID0gYVszXSwKICAgICAgICAgICAgICAgIGF4ID0gYVs0XSwKICAgICAgICAgICAgICAgIGF5ID0gYVs1XSwKICAgICAgICAgICAgICAgIGF6ID0gYVs2XSwKICAgICAgICAgICAgICAgIGF3ID0gYVs3XTsKICAgICAgICAgICAgdmFyIG1hZ25pdHVkZSA9IGJ4ICogYnggKyBieSAqIGJ5ICsgYnogKiBieiArIGJ3ICogYnc7CiAgICAgICAgICAgIGlmIChtYWduaXR1ZGUgPiAwKSB7CiAgICAgICAgICAgICAgICB0cmFuc2xhdGlvblswXSA9IChheCAqIGJ3ICsgYXcgKiBieCArIGF5ICogYnogLQogICAgICAgICAgICAgICAgICAgIGF6ICogYnkpICogMiAvIG1hZ25pdHVkZTsKICAgICAgICAgICAgICAgIHRyYW5zbGF0aW9uWzFdID0gKGF5ICogYncgKyBhdyAqIGJ5ICsgYXogKiBieCAtIGF4ICogYnopICogMiAvIG1hZ25pdHVkZTsKICAgICAgICAgICAgICAgIHRyYW5zbGF0aW9uWzJdID0gKGF6ICogYncgKyBhdyAqIGJ6ICsgYXggKiBieSAtIGF5ICogYngpICogMiAvIG1hZ25pdHVkZQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdHJhbnNsYXRpb25bMF0gPSAoYXggKiBidyArIGF3ICogYnggKyBheSAqIGJ6IC0gYXogKiBieSkgKiAyOwogICAgICAgICAgICAgICAgdHJhbnNsYXRpb25bMV0gPSAoYXkgKiBidyArIGF3ICogYnkgKyBheiAqIGJ4IC0gYXggKiBieikgKiAyOwogICAgICAgICAgICAgICAgdHJhbnNsYXRpb25bMl0gPSAoYXogKiBidyArIGF3ICogYnogKyBheCAqIGJ5IC0gYXkgKiBieCkgKiAyCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnJvbVJvdGF0aW9uVHJhbnNsYXRpb24kMShvdXQsIGEsIHRyYW5zbGF0aW9uKTsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZ2V0VHJhbnNsYXRpb24kMShvdXQsIG1hdCkgewogICAgICAgICAgICBvdXRbMF0gPSBtYXRbMTJdOwogICAgICAgICAgICBvdXRbMV0gPSBtYXRbMTNdOwogICAgICAgICAgICBvdXRbMl0gPSBtYXRbMTRdOwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBnZXRTY2FsaW5nKG91dCwgbWF0KSB7CiAgICAgICAgICAgIHZhciBtMTEgPSBtYXRbMF07CiAgICAgICAgICAgIHZhciBtMTIgPSBtYXRbMV07CiAgICAgICAgICAgIHZhciBtMTMgPSBtYXRbMl07CiAgICAgICAgICAgIHZhciBtMjEgPSBtYXRbNF07CiAgICAgICAgICAgIHZhciBtMjIgPQogICAgICAgICAgICAgICAgbWF0WzVdOwogICAgICAgICAgICB2YXIgbTIzID0gbWF0WzZdOwogICAgICAgICAgICB2YXIgbTMxID0gbWF0WzhdOwogICAgICAgICAgICB2YXIgbTMyID0gbWF0WzldOwogICAgICAgICAgICB2YXIgbTMzID0gbWF0WzEwXTsKICAgICAgICAgICAgb3V0WzBdID0gTWF0aC5oeXBvdChtMTEsIG0xMiwgbTEzKTsKICAgICAgICAgICAgb3V0WzFdID0gTWF0aC5oeXBvdChtMjEsIG0yMiwgbTIzKTsKICAgICAgICAgICAgb3V0WzJdID0gTWF0aC5oeXBvdChtMzEsIG0zMiwgbTMzKTsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZ2V0Um90YXRpb24ob3V0LCBtYXQpIHsKICAgICAgICAgICAgdmFyIHNjYWxpbmcgPSBuZXcgQVJSQVlfVFlQRSgzKTsKICAgICAgICAgICAgZ2V0U2NhbGluZyhzY2FsaW5nLCBtYXQpOwogICAgICAgICAgICB2YXIgaXMxID0gMSAvIHNjYWxpbmdbMF07CiAgICAgICAgICAgIHZhciBpczIgPSAxIC8gc2NhbGluZ1sxXTsKICAgICAgICAgICAgdmFyIGlzMyA9IDEgLyBzY2FsaW5nWzJdOwogICAgICAgICAgICB2YXIgc20xMSA9IG1hdFswXSAqIGlzMTsKICAgICAgICAgICAgdmFyIHNtMTIgPSBtYXRbMV0gKiBpczI7CiAgICAgICAgICAgIHZhciBzbTEzID0gbWF0WzJdICogaXMzOwogICAgICAgICAgICB2YXIgc20yMSA9IG1hdFs0XSAqIGlzMTsKICAgICAgICAgICAgdmFyIHNtMjIgPSBtYXRbNV0gKiBpczI7CiAgICAgICAgICAgIHZhciBzbTIzID0gbWF0WzZdICogaXMzOwogICAgICAgICAgICB2YXIgc20zMSA9IG1hdFs4XSAqIGlzMTsKICAgICAgICAgICAgdmFyIHNtMzIgPSBtYXRbOV0gKiBpczI7CiAgICAgICAgICAgIHZhciBzbTMzID0gbWF0WzEwXSAqIGlzMzsKICAgICAgICAgICAgdmFyIHRyYWNlID0KICAgICAgICAgICAgICAgIHNtMTEgKyBzbTIyICsgc20zMzsKICAgICAgICAgICAgdmFyIFMgPSAwOwogICAgICAgICAgICBpZiAodHJhY2UgPiAwKSB7CiAgICAgICAgICAgICAgICBTID0gTWF0aC5zcXJ0KHRyYWNlICsgMSkgKiAyOwogICAgICAgICAgICAgICAgb3V0WzNdID0gLjI1ICogUzsKICAgICAgICAgICAgICAgIG91dFswXSA9IChzbTIzIC0gc20zMikgLyBTOwogICAgICAgICAgICAgICAgb3V0WzFdID0gKHNtMzEgLSBzbTEzKSAvIFM7CiAgICAgICAgICAgICAgICBvdXRbMl0gPSAoc20xMiAtIHNtMjEpIC8gUwogICAgICAgICAgICB9IGVsc2UgaWYgKHNtMTEgPiBzbTIyICYmIHNtMTEgPiBzbTMzKSB7CiAgICAgICAgICAgICAgICBTID0gTWF0aC5zcXJ0KDEgKyBzbTExIC0gc20yMiAtIHNtMzMpICogMjsKICAgICAgICAgICAgICAgIG91dFszXSA9IChzbTIzIC0gc20zMikgLyBTOwogICAgICAgICAgICAgICAgb3V0WzBdID0gLjI1ICogUzsKICAgICAgICAgICAgICAgIG91dFsxXSA9IChzbTEyICsgc20yMSkgLyBTOwogICAgICAgICAgICAgICAgb3V0WzJdID0gKHNtMzEgKyBzbTEzKSAvIFMKICAgICAgICAgICAgfSBlbHNlIGlmIChzbTIyID4gc20zMykgewogICAgICAgICAgICAgICAgUyA9IE1hdGguc3FydCgxICsgc20yMiAtIHNtMTEgLSBzbTMzKSAqIDI7CiAgICAgICAgICAgICAgICBvdXRbM10gPSAoc20zMSAtIHNtMTMpIC8gUzsKICAgICAgICAgICAgICAgIG91dFswXSA9IChzbTEyICsgc20yMSkgLyBTOwogICAgICAgICAgICAgICAgb3V0WzFdID0gLjI1ICogUzsKICAgICAgICAgICAgICAgIG91dFsyXSA9IChzbTIzICsgc20zMikgLyBTCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBTID0gTWF0aC5zcXJ0KDEgKyBzbTMzIC0gc20xMSAtIHNtMjIpICogMjsKICAgICAgICAgICAgICAgIG91dFszXSA9IChzbTEyIC0gc20yMSkgLyBTOwogICAgICAgICAgICAgICAgb3V0WzBdID0gKHNtMzEgKyBzbTEzKSAvIFM7CiAgICAgICAgICAgICAgICBvdXRbMV0gPSAoc20yMyArIHNtMzIpIC8gUzsKICAgICAgICAgICAgICAgIG91dFsyXSA9CiAgICAgICAgICAgICAgICAgICAgLjI1ICogUwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGRlY29tcG9zZShvdXRfciwgb3V0X3QsIG91dF9zLCBtYXQpIHsKICAgICAgICAgICAgb3V0X3RbMF0gPSBtYXRbMTJdOwogICAgICAgICAgICBvdXRfdFsxXSA9IG1hdFsxM107CiAgICAgICAgICAgIG91dF90WzJdID0gbWF0WzE0XTsKICAgICAgICAgICAgdmFyIG0xMSA9IG1hdFswXTsKICAgICAgICAgICAgdmFyIG0xMiA9IG1hdFsxXTsKICAgICAgICAgICAgdmFyIG0xMyA9IG1hdFsyXTsKICAgICAgICAgICAgdmFyIG0yMSA9IG1hdFs0XTsKICAgICAgICAgICAgdmFyIG0yMiA9IG1hdFs1XTsKICAgICAgICAgICAgdmFyIG0yMyA9IG1hdFs2XTsKICAgICAgICAgICAgdmFyIG0zMSA9IG1hdFs4XTsKICAgICAgICAgICAgdmFyIG0zMiA9IG1hdFs5XTsKICAgICAgICAgICAgdmFyIG0zMyA9IG1hdFsxMF07CiAgICAgICAgICAgIG91dF9zWzBdID0gTWF0aC5oeXBvdChtMTEsIG0xMiwgbTEzKTsKICAgICAgICAgICAgb3V0X3NbMV0gPSBNYXRoLmh5cG90KG0yMSwgbTIyLCBtMjMpOwogICAgICAgICAgICBvdXRfc1syXSA9IE1hdGguaHlwb3QobTMxLCBtMzIsIG0zMyk7CiAgICAgICAgICAgIHZhciBpczEgPSAxIC8gb3V0X3NbMF07CiAgICAgICAgICAgIHZhciBpczIgPSAxIC8gb3V0X3NbMV07CiAgICAgICAgICAgIHZhciBpczMgPSAxIC8gb3V0X3NbMl07CiAgICAgICAgICAgIHZhciBzbTExID0gbTExICogaXMxOwogICAgICAgICAgICB2YXIgc20xMiA9IG0xMiAqIGlzMjsKICAgICAgICAgICAgdmFyIHNtMTMgPSBtMTMgKiBpczM7CiAgICAgICAgICAgIHZhciBzbTIxID0gbTIxICogaXMxOwogICAgICAgICAgICB2YXIgc20yMiA9IG0yMiAqIGlzMjsKICAgICAgICAgICAgdmFyIHNtMjMgPSBtMjMgKiBpczM7CiAgICAgICAgICAgIHZhciBzbTMxID0gbTMxICogaXMxOwogICAgICAgICAgICB2YXIgc20zMiA9IG0zMiAqIGlzMjsKICAgICAgICAgICAgdmFyIHNtMzMgPSBtMzMgKiBpczM7CiAgICAgICAgICAgIHZhciB0cmFjZSA9IHNtMTEgKyBzbTIyICsgc20zMzsKICAgICAgICAgICAgdmFyIFMgPSAwOwogICAgICAgICAgICBpZiAodHJhY2UgPiAwKSB7CiAgICAgICAgICAgICAgICBTID0gTWF0aC5zcXJ0KHRyYWNlICsgMSkgKiAyOwogICAgICAgICAgICAgICAgb3V0X3JbM10gPSAuMjUgKiBTOwogICAgICAgICAgICAgICAgb3V0X3JbMF0gPSAoc20yMyAtIHNtMzIpIC8gUzsKICAgICAgICAgICAgICAgIG91dF9yWzFdID0gKHNtMzEgLSBzbTEzKSAvIFM7CiAgICAgICAgICAgICAgICBvdXRfclsyXSA9IChzbTEyIC0gc20yMSkgLyBTCiAgICAgICAgICAgIH0gZWxzZSBpZiAoc20xMSA+IHNtMjIgJiYgc20xMSA+IHNtMzMpIHsKICAgICAgICAgICAgICAgIFMgPSBNYXRoLnNxcnQoMSArIHNtMTEgLSBzbTIyIC0gc20zMykgKiAyOwogICAgICAgICAgICAgICAgb3V0X3JbM10gPSAoc20yMyAtIHNtMzIpIC8gUzsKICAgICAgICAgICAgICAgIG91dF9yWzBdID0gLjI1ICogUzsKICAgICAgICAgICAgICAgIG91dF9yWzFdID0gKHNtMTIgKyBzbTIxKSAvIFM7CiAgICAgICAgICAgICAgICBvdXRfclsyXSA9IChzbTMxICsgc20xMykgLyBTCiAgICAgICAgICAgIH0gZWxzZSBpZiAoc20yMiA+IHNtMzMpIHsKICAgICAgICAgICAgICAgIFMgPSBNYXRoLnNxcnQoMSArIHNtMjIgLSBzbTExIC0gc20zMykgKiAyOwogICAgICAgICAgICAgICAgb3V0X3JbM10gPSAoc20zMSAtIHNtMTMpIC8gUzsKICAgICAgICAgICAgICAgIG91dF9yWzBdID0gKHNtMTIgKyBzbTIxKSAvIFM7CiAgICAgICAgICAgICAgICBvdXRfclsxXSA9IC4yNSAqIFM7CiAgICAgICAgICAgICAgICBvdXRfclsyXSA9IChzbTIzICsgc20zMikgLyBTCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBTID0gTWF0aC5zcXJ0KDEgKwogICAgICAgICAgICAgICAgICAgIHNtMzMgLSBzbTExIC0gc20yMikgKiAyOwogICAgICAgICAgICAgICAgb3V0X3JbM10gPSAoc20xMiAtIHNtMjEpIC8gUzsKICAgICAgICAgICAgICAgIG91dF9yWzBdID0gKHNtMzEgKyBzbTEzKSAvIFM7CiAgICAgICAgICAgICAgICBvdXRfclsxXSA9IChzbTIzICsgc20zMikgLyBTOwogICAgICAgICAgICAgICAgb3V0X3JbMl0gPSAuMjUgKiBTCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG91dF9yCiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBmcm9tUm90YXRpb25UcmFuc2xhdGlvblNjYWxlKG91dCwgcSwgdiwgcykgewogICAgICAgICAgICB2YXIgeCA9IHFbMF0sCiAgICAgICAgICAgICAgICB5ID0gcVsxXSwKICAgICAgICAgICAgICAgIHogPSBxWzJdLAogICAgICAgICAgICAgICAgdyA9IHFbM107CiAgICAgICAgICAgIHZhciB4MiA9IHggKyB4OwogICAgICAgICAgICB2YXIgeTIgPSB5ICsgeTsKICAgICAgICAgICAgdmFyIHoyID0geiArIHo7CiAgICAgICAgICAgIHZhciB4eCA9IHggKiB4MjsKICAgICAgICAgICAgdmFyIHh5ID0geCAqIHkyOwogICAgICAgICAgICB2YXIgeHogPSB4ICogejI7CiAgICAgICAgICAgIHZhciB5eSA9IHkgKiB5MjsKICAgICAgICAgICAgdmFyIHl6ID0geSAqIHoyOwogICAgICAgICAgICB2YXIgenogPSB6ICogejI7CiAgICAgICAgICAgIHZhciB3eCA9IHcgKiB4MjsKICAgICAgICAgICAgdmFyIHd5ID0gdyAqIHkyOwogICAgICAgICAgICB2YXIgd3ogPSB3ICogejI7CiAgICAgICAgICAgIHZhciBzeCA9IHNbMF07CiAgICAgICAgICAgIHZhciBzeSA9IHNbMV07CiAgICAgICAgICAgIHZhciBzeiA9IHNbMl07CiAgICAgICAgICAgIG91dFswXSA9ICgxIC0gKHl5ICsgenopKSAqIHN4OwogICAgICAgICAgICBvdXRbMV0gPSAoeHkgKyB3eikgKiBzeDsKICAgICAgICAgICAgb3V0WzJdID0gKHh6IC0gd3kpICogc3g7CiAgICAgICAgICAgIG91dFszXSA9IDA7CiAgICAgICAgICAgIG91dFs0XSA9ICh4eSAtIHd6KSAqIHN5OwogICAgICAgICAgICBvdXRbNV0gPSAoMSAtICh4eCArIHp6KSkgKiBzeTsKICAgICAgICAgICAgb3V0WzZdID0gKHl6ICsgd3gpICogc3k7CiAgICAgICAgICAgIG91dFs3XSA9CiAgICAgICAgICAgICAgICAwOwogICAgICAgICAgICBvdXRbOF0gPSAoeHogKyB3eSkgKiBzejsKICAgICAgICAgICAgb3V0WzldID0gKHl6IC0gd3gpICogc3o7CiAgICAgICAgICAgIG91dFsxMF0gPSAoMSAtICh4eCArIHl5KSkgKiBzejsKICAgICAgICAgICAgb3V0WzExXSA9IDA7CiAgICAgICAgICAgIG91dFsxMl0gPSB2WzBdOwogICAgICAgICAgICBvdXRbMTNdID0gdlsxXTsKICAgICAgICAgICAgb3V0WzE0XSA9IHZbMl07CiAgICAgICAgICAgIG91dFsxNV0gPSAxOwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBmcm9tUm90YXRpb25UcmFuc2xhdGlvblNjYWxlT3JpZ2luKG91dCwgcSwgdiwgcywgbykgewogICAgICAgICAgICB2YXIgeCA9IHFbMF0sCiAgICAgICAgICAgICAgICB5ID0gcVsxXSwKICAgICAgICAgICAgICAgIHogPSBxWzJdLAogICAgICAgICAgICAgICAgdyA9IHFbM107CiAgICAgICAgICAgIHZhciB4MiA9IHggKyB4OwogICAgICAgICAgICB2YXIgeTIgPSB5ICsgeTsKICAgICAgICAgICAgdmFyIHoyID0geiArIHo7CiAgICAgICAgICAgIHZhciB4eCA9IHggKiB4MjsKICAgICAgICAgICAgdmFyIHh5ID0geCAqIHkyOwogICAgICAgICAgICB2YXIgeHogPSB4ICogejI7CiAgICAgICAgICAgIHZhciB5eSA9IHkgKiB5MjsKICAgICAgICAgICAgdmFyIHl6ID0geSAqIHoyOwogICAgICAgICAgICB2YXIgenogPSB6ICogejI7CiAgICAgICAgICAgIHZhciB3eCA9IHcgKiB4MjsKICAgICAgICAgICAgdmFyIHd5ID0gdyAqIHkyOwogICAgICAgICAgICB2YXIgd3ogPSB3ICogejI7CiAgICAgICAgICAgIHZhciBzeCA9IHNbMF07CiAgICAgICAgICAgIHZhciBzeSA9IHNbMV07CiAgICAgICAgICAgIHZhciBzeiA9IHNbMl07CiAgICAgICAgICAgIHZhciBveCA9IG9bMF07CiAgICAgICAgICAgIHZhciBveSA9IG9bMV07CiAgICAgICAgICAgIHZhciBveiA9IG9bMl07CiAgICAgICAgICAgIHZhciBvdXQwID0gKDEgLSAoeXkgKyB6eikpICogc3g7CiAgICAgICAgICAgIHZhciBvdXQxID0gKHh5ICsgd3opICogc3g7CiAgICAgICAgICAgIHZhciBvdXQyID0gKHh6IC0gd3kpICogc3g7CiAgICAgICAgICAgIHZhciBvdXQ0ID0KICAgICAgICAgICAgICAgICh4eSAtIHd6KSAqIHN5OwogICAgICAgICAgICB2YXIgb3V0NSA9ICgxIC0gKHh4ICsgenopKSAqIHN5OwogICAgICAgICAgICB2YXIgb3V0NiA9ICh5eiArIHd4KSAqIHN5OwogICAgICAgICAgICB2YXIgb3V0OCA9ICh4eiArIHd5KSAqIHN6OwogICAgICAgICAgICB2YXIgb3V0OSA9ICh5eiAtIHd4KSAqIHN6OwogICAgICAgICAgICB2YXIgb3V0MTAgPSAoMSAtICh4eCArIHl5KSkgKiBzejsKICAgICAgICAgICAgb3V0WzBdID0gb3V0MDsKICAgICAgICAgICAgb3V0WzFdID0gb3V0MTsKICAgICAgICAgICAgb3V0WzJdID0gb3V0MjsKICAgICAgICAgICAgb3V0WzNdID0gMDsKICAgICAgICAgICAgb3V0WzRdID0gb3V0NDsKICAgICAgICAgICAgb3V0WzVdID0gb3V0NTsKICAgICAgICAgICAgb3V0WzZdID0gb3V0NjsKICAgICAgICAgICAgb3V0WzddID0gMDsKICAgICAgICAgICAgb3V0WzhdID0gb3V0ODsKICAgICAgICAgICAgb3V0WzldID0gb3V0OTsKICAgICAgICAgICAgb3V0WzEwXSA9IG91dDEwOwogICAgICAgICAgICBvdXRbMTFdID0gMDsKICAgICAgICAgICAgb3V0WzEyXSA9IHZbMF0gKyBveCAtIChvdXQwICogb3ggKyBvdXQ0ICogb3kgKyBvdXQ4ICogb3opOwogICAgICAgICAgICBvdXRbMTNdID0gdlsxXSArIG95IC0gKG91dDEgKiBveCArIG91dDUgKiBveSArIG91dDkgKiBveik7CiAgICAgICAgICAgIG91dFsxNF0gPSB2WzJdICsgb3ogLSAob3V0MiAqIG94ICsgb3V0NiAqIG95ICsgb3V0MTAgKiBveik7CiAgICAgICAgICAgIG91dFsxNV0gPSAxOwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBmcm9tUXVhdChvdXQsIHEpIHsKICAgICAgICAgICAgdmFyIHggPSBxWzBdLAogICAgICAgICAgICAgICAgeSA9IHFbMV0sCiAgICAgICAgICAgICAgICB6ID0gcVsyXSwKICAgICAgICAgICAgICAgIHcgPSBxWzNdOwogICAgICAgICAgICB2YXIgeDIgPSB4ICsgeDsKICAgICAgICAgICAgdmFyIHkyID0geSArIHk7CiAgICAgICAgICAgIHZhciB6MiA9IHogKyB6OwogICAgICAgICAgICB2YXIgeHggPQogICAgICAgICAgICAgICAgeCAqIHgyOwogICAgICAgICAgICB2YXIgeXggPSB5ICogeDI7CiAgICAgICAgICAgIHZhciB5eSA9IHkgKiB5MjsKICAgICAgICAgICAgdmFyIHp4ID0geiAqIHgyOwogICAgICAgICAgICB2YXIgenkgPSB6ICogeTI7CiAgICAgICAgICAgIHZhciB6eiA9IHogKiB6MjsKICAgICAgICAgICAgdmFyIHd4ID0gdyAqIHgyOwogICAgICAgICAgICB2YXIgd3kgPSB3ICogeTI7CiAgICAgICAgICAgIHZhciB3eiA9IHcgKiB6MjsKICAgICAgICAgICAgb3V0WzBdID0gMSAtIHl5IC0geno7CiAgICAgICAgICAgIG91dFsxXSA9IHl4ICsgd3o7CiAgICAgICAgICAgIG91dFsyXSA9IHp4IC0gd3k7CiAgICAgICAgICAgIG91dFszXSA9IDA7CiAgICAgICAgICAgIG91dFs0XSA9IHl4IC0gd3o7CiAgICAgICAgICAgIG91dFs1XSA9IDEgLSB4eCAtIHp6OwogICAgICAgICAgICBvdXRbNl0gPSB6eSArIHd4OwogICAgICAgICAgICBvdXRbN10gPSAwOwogICAgICAgICAgICBvdXRbOF0gPSB6eCArIHd5OwogICAgICAgICAgICBvdXRbOV0gPSB6eSAtIHd4OwogICAgICAgICAgICBvdXRbMTBdID0gMSAtIHh4IC0geXk7CiAgICAgICAgICAgIG91dFsxMV0gPSAwOwogICAgICAgICAgICBvdXRbMTJdID0gMDsKICAgICAgICAgICAgb3V0WzEzXSA9IDA7CiAgICAgICAgICAgIG91dFsxNF0gPSAwOwogICAgICAgICAgICBvdXRbMTVdID0gMTsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZnJ1c3R1bShvdXQsIGxlZnQsIHJpZ2h0LCBib3R0b20sIHRvcCwgbmVhciwgZmFyKSB7CiAgICAgICAgICAgIHZhciBybCA9IDEgLyAocmlnaHQgLSBsZWZ0KTsKICAgICAgICAgICAgdmFyIHRiID0gMSAvICh0b3AgLSBib3R0b20pOwogICAgICAgICAgICB2YXIgbmYgPSAxIC8gKG5lYXIgLSBmYXIpOwogICAgICAgICAgICBvdXRbMF0gPSBuZWFyICogMiAqIHJsOwogICAgICAgICAgICBvdXRbMV0gPSAwOwogICAgICAgICAgICBvdXRbMl0gPSAwOwogICAgICAgICAgICBvdXRbM10gPSAwOwogICAgICAgICAgICBvdXRbNF0gPSAwOwogICAgICAgICAgICBvdXRbNV0gPSBuZWFyICogMiAqIHRiOwogICAgICAgICAgICBvdXRbNl0gPSAwOwogICAgICAgICAgICBvdXRbN10gPQogICAgICAgICAgICAgICAgMDsKICAgICAgICAgICAgb3V0WzhdID0gKHJpZ2h0ICsgbGVmdCkgKiBybDsKICAgICAgICAgICAgb3V0WzldID0gKHRvcCArIGJvdHRvbSkgKiB0YjsKICAgICAgICAgICAgb3V0WzEwXSA9IChmYXIgKyBuZWFyKSAqIG5mOwogICAgICAgICAgICBvdXRbMTFdID0gLTE7CiAgICAgICAgICAgIG91dFsxMl0gPSAwOwogICAgICAgICAgICBvdXRbMTNdID0gMDsKICAgICAgICAgICAgb3V0WzE0XSA9IGZhciAqIG5lYXIgKiAyICogbmY7CiAgICAgICAgICAgIG91dFsxNV0gPSAwOwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBwZXJzcGVjdGl2ZU5PKG91dCwgZm92eSwgYXNwZWN0LCBuZWFyLCBmYXIpIHsKICAgICAgICAgICAgdmFyIGYgPSAxIC8gTWF0aC50YW4oZm92eSAvIDIpOwogICAgICAgICAgICBvdXRbMF0gPSBmIC8gYXNwZWN0OwogICAgICAgICAgICBvdXRbMV0gPSAwOwogICAgICAgICAgICBvdXRbMl0gPSAwOwogICAgICAgICAgICBvdXRbM10gPSAwOwogICAgICAgICAgICBvdXRbNF0gPSAwOwogICAgICAgICAgICBvdXRbNV0gPSBmOwogICAgICAgICAgICBvdXRbNl0gPSAwOwogICAgICAgICAgICBvdXRbN10gPSAwOwogICAgICAgICAgICBvdXRbOF0gPSAwOwogICAgICAgICAgICBvdXRbOV0gPSAwOwogICAgICAgICAgICBvdXRbMTFdID0gLTE7CiAgICAgICAgICAgIG91dFsxMl0gPSAwOwogICAgICAgICAgICBvdXRbMTNdID0gMDsKICAgICAgICAgICAgb3V0WzE1XSA9IDA7CiAgICAgICAgICAgIGlmIChmYXIgIT0gbnVsbCAmJiBmYXIgIT09IEluZmluaXR5KSB7CiAgICAgICAgICAgICAgICB2YXIgbmYgPSAxIC8gKG5lYXIgLSBmYXIpOwogICAgICAgICAgICAgICAgb3V0WzEwXSA9IChmYXIgKyBuZWFyKSAqIG5mOwogICAgICAgICAgICAgICAgb3V0WzE0XSA9IDIgKiBmYXIgKiBuZWFyICogbmYKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG91dFsxMF0gPSAtMTsKICAgICAgICAgICAgICAgIG91dFsxNF0gPSAtMiAqIG5lYXIKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQogICAgICAgIHZhciBwZXJzcGVjdGl2ZSA9CiAgICAgICAgICAgIHBlcnNwZWN0aXZlTk87CgogICAgICAgIGZ1bmN0aW9uIHBlcnNwZWN0aXZlWk8ob3V0LCBmb3Z5LCBhc3BlY3QsIG5lYXIsIGZhcikgewogICAgICAgICAgICB2YXIgZiA9IDEgLyBNYXRoLnRhbihmb3Z5IC8gMik7CiAgICAgICAgICAgIG91dFswXSA9IGYgLyBhc3BlY3Q7CiAgICAgICAgICAgIG91dFsxXSA9IDA7CiAgICAgICAgICAgIG91dFsyXSA9IDA7CiAgICAgICAgICAgIG91dFszXSA9IDA7CiAgICAgICAgICAgIG91dFs0XSA9IDA7CiAgICAgICAgICAgIG91dFs1XSA9IGY7CiAgICAgICAgICAgIG91dFs2XSA9IDA7CiAgICAgICAgICAgIG91dFs3XSA9IDA7CiAgICAgICAgICAgIG91dFs4XSA9IDA7CiAgICAgICAgICAgIG91dFs5XSA9IDA7CiAgICAgICAgICAgIG91dFsxMV0gPSAtMTsKICAgICAgICAgICAgb3V0WzEyXSA9IDA7CiAgICAgICAgICAgIG91dFsxM10gPSAwOwogICAgICAgICAgICBvdXRbMTVdID0gMDsKICAgICAgICAgICAgaWYgKGZhciAhPSBudWxsICYmIGZhciAhPT0gSW5maW5pdHkpIHsKICAgICAgICAgICAgICAgIHZhciBuZiA9IDEgLyAobmVhciAtIGZhcik7CiAgICAgICAgICAgICAgICBvdXRbMTBdID0gZmFyICogbmY7CiAgICAgICAgICAgICAgICBvdXRbMTRdID0gZmFyICogbmVhciAqIG5mCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBvdXRbMTBdID0gLTE7CiAgICAgICAgICAgICAgICBvdXRbMTRdID0gLW5lYXIKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBwZXJzcGVjdGl2ZUZyb21GaWVsZE9mVmlldyhvdXQsIGZvdiwgbmVhciwgZmFyKSB7CiAgICAgICAgICAgIHZhciB1cFRhbiA9IE1hdGgudGFuKGZvdi51cERlZ3JlZXMgKiBNYXRoLlBJIC8gMTgwKTsKICAgICAgICAgICAgdmFyIGRvd25UYW4gPSBNYXRoLnRhbihmb3YuZG93bkRlZ3JlZXMgKiBNYXRoLlBJIC8gMTgwKTsKICAgICAgICAgICAgdmFyIGxlZnRUYW4gPSBNYXRoLnRhbihmb3YubGVmdERlZ3JlZXMgKiBNYXRoLlBJIC8gMTgwKTsKICAgICAgICAgICAgdmFyIHJpZ2h0VGFuID0gTWF0aC50YW4oZm92LnJpZ2h0RGVncmVlcyAqIE1hdGguUEkgLyAxODApOwogICAgICAgICAgICB2YXIgeFNjYWxlID0gMiAvIChsZWZ0VGFuICsgcmlnaHRUYW4pOwogICAgICAgICAgICB2YXIgeVNjYWxlID0gMiAvICh1cFRhbiArIGRvd25UYW4pOwogICAgICAgICAgICBvdXRbMF0gPSB4U2NhbGU7CiAgICAgICAgICAgIG91dFsxXSA9IDA7CiAgICAgICAgICAgIG91dFsyXSA9IDA7CiAgICAgICAgICAgIG91dFszXSA9IDA7CiAgICAgICAgICAgIG91dFs0XSA9IDA7CiAgICAgICAgICAgIG91dFs1XSA9IHlTY2FsZTsKICAgICAgICAgICAgb3V0WzZdID0gMDsKICAgICAgICAgICAgb3V0WzddID0gMDsKICAgICAgICAgICAgb3V0WzhdID0gLSgobGVmdFRhbiAtIHJpZ2h0VGFuKSAqIHhTY2FsZSAqIC41KTsKICAgICAgICAgICAgb3V0WzldID0gKHVwVGFuIC0gZG93blRhbikgKiB5U2NhbGUgKiAuNTsKICAgICAgICAgICAgb3V0WzEwXSA9IGZhciAvIChuZWFyIC0gZmFyKTsKICAgICAgICAgICAgb3V0WzExXSA9IC0xOwogICAgICAgICAgICBvdXRbMTJdID0gMDsKICAgICAgICAgICAgb3V0WzEzXSA9IDA7CiAgICAgICAgICAgIG91dFsxNF0gPSBmYXIgKiBuZWFyIC8gKG5lYXIgLSBmYXIpOwogICAgICAgICAgICBvdXRbMTVdID0gMDsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gb3J0aG9OTyhvdXQsIGxlZnQsIHJpZ2h0LCBib3R0b20sIHRvcCwgbmVhciwgZmFyKSB7CiAgICAgICAgICAgIHZhciBsciA9IDEgLyAobGVmdCAtIHJpZ2h0KTsKICAgICAgICAgICAgdmFyIGJ0ID0KICAgICAgICAgICAgICAgIDEgLyAoYm90dG9tIC0gdG9wKTsKICAgICAgICAgICAgdmFyIG5mID0gMSAvIChuZWFyIC0gZmFyKTsKICAgICAgICAgICAgb3V0WzBdID0gLTIgKiBscjsKICAgICAgICAgICAgb3V0WzFdID0gMDsKICAgICAgICAgICAgb3V0WzJdID0gMDsKICAgICAgICAgICAgb3V0WzNdID0gMDsKICAgICAgICAgICAgb3V0WzRdID0gMDsKICAgICAgICAgICAgb3V0WzVdID0gLTIgKiBidDsKICAgICAgICAgICAgb3V0WzZdID0gMDsKICAgICAgICAgICAgb3V0WzddID0gMDsKICAgICAgICAgICAgb3V0WzhdID0gMDsKICAgICAgICAgICAgb3V0WzldID0gMDsKICAgICAgICAgICAgb3V0WzEwXSA9IDIgKiBuZjsKICAgICAgICAgICAgb3V0WzExXSA9IDA7CiAgICAgICAgICAgIG91dFsxMl0gPSAobGVmdCArIHJpZ2h0KSAqIGxyOwogICAgICAgICAgICBvdXRbMTNdID0gKHRvcCArIGJvdHRvbSkgKiBidDsKICAgICAgICAgICAgb3V0WzE0XSA9IChmYXIgKyBuZWFyKSAqIG5mOwogICAgICAgICAgICBvdXRbMTVdID0gMTsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KICAgICAgICB2YXIgb3J0aG8gPSBvcnRob05POwoKICAgICAgICBmdW5jdGlvbiBvcnRob1pPKG91dCwgbGVmdCwgcmlnaHQsIGJvdHRvbSwgdG9wLCBuZWFyLCBmYXIpIHsKICAgICAgICAgICAgdmFyIGxyID0gMSAvIChsZWZ0IC0gcmlnaHQpOwogICAgICAgICAgICB2YXIgYnQgPSAxIC8gKGJvdHRvbSAtIHRvcCk7CiAgICAgICAgICAgIHZhciBuZiA9IDEgLyAobmVhciAtIGZhcik7CiAgICAgICAgICAgIG91dFswXSA9IC0yICogbHI7CiAgICAgICAgICAgIG91dFsxXSA9IDA7CiAgICAgICAgICAgIG91dFsyXSA9IDA7CiAgICAgICAgICAgIG91dFszXSA9IDA7CiAgICAgICAgICAgIG91dFs0XSA9IDA7CiAgICAgICAgICAgIG91dFs1XSA9IC0yICogYnQ7CiAgICAgICAgICAgIG91dFs2XSA9IDA7CiAgICAgICAgICAgIG91dFs3XSA9IDA7CiAgICAgICAgICAgIG91dFs4XSA9IDA7CiAgICAgICAgICAgIG91dFs5XSA9IDA7CiAgICAgICAgICAgIG91dFsxMF0gPSBuZjsKICAgICAgICAgICAgb3V0WzExXSA9IDA7CiAgICAgICAgICAgIG91dFsxMl0gPSAobGVmdCArIHJpZ2h0KSAqIGxyOwogICAgICAgICAgICBvdXRbMTNdID0gKHRvcCArIGJvdHRvbSkgKiBidDsKICAgICAgICAgICAgb3V0WzE0XSA9IG5lYXIgKiBuZjsKICAgICAgICAgICAgb3V0WzE1XSA9IDE7CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGxvb2tBdChvdXQsIGV5ZSwgY2VudGVyLCB1cCkgewogICAgICAgICAgICB2YXIgeDAsIHgxLCB4MiwgeTAsIHkxLCB5MiwgejAsIHoxLCB6MiwgbGVuOwogICAgICAgICAgICB2YXIgZXlleCA9IGV5ZVswXTsKICAgICAgICAgICAgdmFyIGV5ZXkgPSBleWVbMV07CiAgICAgICAgICAgIHZhciBleWV6ID0gZXllWzJdOwogICAgICAgICAgICB2YXIgdXB4ID0gdXBbMF07CiAgICAgICAgICAgIHZhciB1cHkgPSB1cFsxXTsKICAgICAgICAgICAgdmFyIHVweiA9IHVwWzJdOwogICAgICAgICAgICB2YXIgY2VudGVyeCA9IGNlbnRlclswXTsKICAgICAgICAgICAgdmFyIGNlbnRlcnkgPSBjZW50ZXJbMV07CiAgICAgICAgICAgIHZhciBjZW50ZXJ6ID0gY2VudGVyWzJdOwogICAgICAgICAgICBpZiAoTWF0aC5hYnMoZXlleCAtIGNlbnRlcngpIDwgRVBTSUxPTiAmJiBNYXRoLmFicyhleWV5IC0gY2VudGVyeSkgPCBFUFNJTE9OICYmIE1hdGguYWJzKGV5ZXogLSBjZW50ZXJ6KSA8IEVQU0lMT04pIHJldHVybiBpZGVudGl0eSQyKG91dCk7CiAgICAgICAgICAgIHowID0gZXlleCAtIGNlbnRlcng7CiAgICAgICAgICAgIHoxID0gZXlleSAtIGNlbnRlcnk7CiAgICAgICAgICAgIHoyID0gZXlleiAtIGNlbnRlcno7CiAgICAgICAgICAgIGxlbiA9IDEgLyBNYXRoLmh5cG90KHowLCB6MSwKICAgICAgICAgICAgICAgIHoyKTsKICAgICAgICAgICAgejAgKj0gbGVuOwogICAgICAgICAgICB6MSAqPSBsZW47CiAgICAgICAgICAgIHoyICo9IGxlbjsKICAgICAgICAgICAgeDAgPSB1cHkgKiB6MiAtIHVweiAqIHoxOwogICAgICAgICAgICB4MSA9IHVweiAqIHowIC0gdXB4ICogejI7CiAgICAgICAgICAgIHgyID0gdXB4ICogejEgLSB1cHkgKiB6MDsKICAgICAgICAgICAgbGVuID0gTWF0aC5oeXBvdCh4MCwgeDEsIHgyKTsKICAgICAgICAgICAgaWYgKCFsZW4pIHsKICAgICAgICAgICAgICAgIHgwID0gMDsKICAgICAgICAgICAgICAgIHgxID0gMDsKICAgICAgICAgICAgICAgIHgyID0gMAogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgbGVuID0gMSAvIGxlbjsKICAgICAgICAgICAgICAgIHgwICo9IGxlbjsKICAgICAgICAgICAgICAgIHgxICo9IGxlbjsKICAgICAgICAgICAgICAgIHgyICo9IGxlbgogICAgICAgICAgICB9CiAgICAgICAgICAgIHkwID0gejEgKiB4MiAtIHoyICogeDE7CiAgICAgICAgICAgIHkxID0gejIgKiB4MCAtIHowICogeDI7CiAgICAgICAgICAgIHkyID0gejAgKiB4MSAtIHoxICogeDA7CiAgICAgICAgICAgIGxlbiA9IE1hdGguaHlwb3QoeTAsIHkxLCB5Mik7CiAgICAgICAgICAgIGlmICghbGVuKSB7CiAgICAgICAgICAgICAgICB5MCA9IDA7CiAgICAgICAgICAgICAgICB5MSA9IDA7CiAgICAgICAgICAgICAgICB5MiA9IDAKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGxlbiA9IDEgLyBsZW47CiAgICAgICAgICAgICAgICB5MCAqPSBsZW47CiAgICAgICAgICAgICAgICB5MSAqPSBsZW47CiAgICAgICAgICAgICAgICB5MiAqPSBsZW4KICAgICAgICAgICAgfQogICAgICAgICAgICBvdXRbMF0gPSB4MDsKICAgICAgICAgICAgb3V0WzFdID0geTA7CiAgICAgICAgICAgIG91dFsyXSA9IHowOwogICAgICAgICAgICBvdXRbM10gPSAwOwogICAgICAgICAgICBvdXRbNF0gPSB4MTsKICAgICAgICAgICAgb3V0WzVdID0geTE7CiAgICAgICAgICAgIG91dFs2XSA9IHoxOwogICAgICAgICAgICBvdXRbN10gPSAwOwogICAgICAgICAgICBvdXRbOF0gPSB4MjsKICAgICAgICAgICAgb3V0WzldID0geTI7CiAgICAgICAgICAgIG91dFsxMF0gPSB6MjsKICAgICAgICAgICAgb3V0WzExXSA9IDA7CiAgICAgICAgICAgIG91dFsxMl0gPSAtKHgwICogZXlleCArIHgxICogZXlleSArIHgyICogZXlleik7CiAgICAgICAgICAgIG91dFsxM10gPSAtKHkwICogZXlleCArIHkxICogZXlleSArIHkyICogZXlleik7CiAgICAgICAgICAgIG91dFsxNF0gPSAtKHowICoKICAgICAgICAgICAgICAgIGV5ZXggKyB6MSAqIGV5ZXkgKyB6MiAqIGV5ZXopOwogICAgICAgICAgICBvdXRbMTVdID0gMTsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gdGFyZ2V0VG8ob3V0LCBleWUsIHRhcmdldCwgdXApIHsKICAgICAgICAgICAgdmFyIGV5ZXggPSBleWVbMF0sCiAgICAgICAgICAgICAgICBleWV5ID0gZXllWzFdLAogICAgICAgICAgICAgICAgZXlleiA9IGV5ZVsyXSwKICAgICAgICAgICAgICAgIHVweCA9IHVwWzBdLAogICAgICAgICAgICAgICAgdXB5ID0gdXBbMV0sCiAgICAgICAgICAgICAgICB1cHogPSB1cFsyXTsKICAgICAgICAgICAgdmFyIHowID0gZXlleCAtIHRhcmdldFswXSwKICAgICAgICAgICAgICAgIHoxID0gZXlleSAtIHRhcmdldFsxXSwKICAgICAgICAgICAgICAgIHoyID0gZXlleiAtIHRhcmdldFsyXTsKICAgICAgICAgICAgdmFyIGxlbiA9IHowICogejAgKyB6MSAqIHoxICsgejIgKiB6MjsKICAgICAgICAgICAgaWYgKGxlbiA+IDApIHsKICAgICAgICAgICAgICAgIGxlbiA9IDEgLyBNYXRoLnNxcnQobGVuKTsKICAgICAgICAgICAgICAgIHowICo9IGxlbjsKICAgICAgICAgICAgICAgIHoxICo9IGxlbjsKICAgICAgICAgICAgICAgIHoyICo9IGxlbgogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciB4MCA9IHVweSAqIHoyIC0gdXB6ICogejEsCiAgICAgICAgICAgICAgICB4MSA9IHVweiAqIHowIC0gdXB4ICogejIsCiAgICAgICAgICAgICAgICB4MiA9IHVweCAqIHoxIC0gdXB5ICogejA7CiAgICAgICAgICAgIGxlbiA9IHgwICogeDAgKyB4MSAqIHgxICsgeDIgKiB4MjsKICAgICAgICAgICAgaWYgKGxlbiA+IDApIHsKICAgICAgICAgICAgICAgIGxlbiA9IDEgLyBNYXRoLnNxcnQobGVuKTsKICAgICAgICAgICAgICAgIHgwICo9IGxlbjsKICAgICAgICAgICAgICAgIHgxICo9IGxlbjsKICAgICAgICAgICAgICAgIHgyICo9IGxlbgogICAgICAgICAgICB9CiAgICAgICAgICAgIG91dFswXSA9IHgwOwogICAgICAgICAgICBvdXRbMV0gPSB4MTsKICAgICAgICAgICAgb3V0WzJdID0geDI7CiAgICAgICAgICAgIG91dFszXSA9IDA7CiAgICAgICAgICAgIG91dFs0XSA9IHoxICogeDIgLSB6MiAqIHgxOwogICAgICAgICAgICBvdXRbNV0gPSB6MiAqIHgwIC0gejAgKiB4MjsKICAgICAgICAgICAgb3V0WzZdID0KICAgICAgICAgICAgICAgIHowICogeDEgLSB6MSAqIHgwOwogICAgICAgICAgICBvdXRbN10gPSAwOwogICAgICAgICAgICBvdXRbOF0gPSB6MDsKICAgICAgICAgICAgb3V0WzldID0gejE7CiAgICAgICAgICAgIG91dFsxMF0gPSB6MjsKICAgICAgICAgICAgb3V0WzExXSA9IDA7CiAgICAgICAgICAgIG91dFsxMl0gPSBleWV4OwogICAgICAgICAgICBvdXRbMTNdID0gZXlleTsKICAgICAgICAgICAgb3V0WzE0XSA9IGV5ZXo7CiAgICAgICAgICAgIG91dFsxNV0gPSAxOwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBzdHIkNShhKSB7CiAgICAgICAgICAgIHJldHVybiAibWF0NCgiICsgYVswXSArICIsICIgKyBhWzFdICsgIiwgIiArIGFbMl0gKyAiLCAiICsgYVszXSArICIsICIgKyBhWzRdICsgIiwgIiArIGFbNV0gKyAiLCAiICsgYVs2XSArICIsICIgKyBhWzddICsgIiwgIiArIGFbOF0gKyAiLCAiICsgYVs5XSArICIsICIgKyBhWzEwXSArICIsICIgKyBhWzExXSArICIsICIgKyBhWzEyXSArICIsICIgKyBhWzEzXSArICIsICIgKyBhWzE0XSArICIsICIgKyBhWzE1XSArICIpIgogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZnJvYihhKSB7CiAgICAgICAgICAgIHJldHVybiBNYXRoLmh5cG90KGFbMF0sIGFbMV0sIGFbMl0sIGFbM10sIGFbNF0sIGFbNV0sIGFbNl0sIGFbN10sIGFbOF0sIGFbOV0sIGFbMTBdLCBhWzExXSwgYVsxMl0sIGFbMTNdLCBhWzE0XSwgYVsxNV0pCiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBhZGQkNShvdXQsIGEsIGIpIHsKICAgICAgICAgICAgb3V0WzBdID0gYVswXSArIGJbMF07CiAgICAgICAgICAgIG91dFsxXSA9IGFbMV0gKyBiWzFdOwogICAgICAgICAgICBvdXRbMl0gPQogICAgICAgICAgICAgICAgYVsyXSArIGJbMl07CiAgICAgICAgICAgIG91dFszXSA9IGFbM10gKyBiWzNdOwogICAgICAgICAgICBvdXRbNF0gPSBhWzRdICsgYls0XTsKICAgICAgICAgICAgb3V0WzVdID0gYVs1XSArIGJbNV07CiAgICAgICAgICAgIG91dFs2XSA9IGFbNl0gKyBiWzZdOwogICAgICAgICAgICBvdXRbN10gPSBhWzddICsgYls3XTsKICAgICAgICAgICAgb3V0WzhdID0gYVs4XSArIGJbOF07CiAgICAgICAgICAgIG91dFs5XSA9IGFbOV0gKyBiWzldOwogICAgICAgICAgICBvdXRbMTBdID0gYVsxMF0gKyBiWzEwXTsKICAgICAgICAgICAgb3V0WzExXSA9IGFbMTFdICsgYlsxMV07CiAgICAgICAgICAgIG91dFsxMl0gPSBhWzEyXSArIGJbMTJdOwogICAgICAgICAgICBvdXRbMTNdID0gYVsxM10gKyBiWzEzXTsKICAgICAgICAgICAgb3V0WzE0XSA9IGFbMTRdICsgYlsxNF07CiAgICAgICAgICAgIG91dFsxNV0gPSBhWzE1XSArIGJbMTVdOwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBzdWJ0cmFjdCQzKG91dCwgYSwgYikgewogICAgICAgICAgICBvdXRbMF0gPSBhWzBdIC0gYlswXTsKICAgICAgICAgICAgb3V0WzFdID0gYVsxXSAtIGJbMV07CiAgICAgICAgICAgIG91dFsyXSA9IGFbMl0gLSBiWzJdOwogICAgICAgICAgICBvdXRbM10gPSBhWzNdIC0gYlszXTsKICAgICAgICAgICAgb3V0WzRdID0gYVs0XSAtIGJbNF07CiAgICAgICAgICAgIG91dFs1XSA9IGFbNV0gLSBiWzVdOwogICAgICAgICAgICBvdXRbNl0gPSBhWzZdIC0gYls2XTsKICAgICAgICAgICAgb3V0WzddID0gYVs3XSAtIGJbN107CiAgICAgICAgICAgIG91dFs4XSA9IGFbOF0gLSBiWzhdOwogICAgICAgICAgICBvdXRbOV0gPSBhWzldIC0gYls5XTsKICAgICAgICAgICAgb3V0WzEwXSA9IGFbMTBdIC0gYlsxMF07CiAgICAgICAgICAgIG91dFsxMV0gPSBhWzExXSAtIGJbMTFdOwogICAgICAgICAgICBvdXRbMTJdID0KICAgICAgICAgICAgICAgIGFbMTJdIC0gYlsxMl07CiAgICAgICAgICAgIG91dFsxM10gPSBhWzEzXSAtIGJbMTNdOwogICAgICAgICAgICBvdXRbMTRdID0gYVsxNF0gLSBiWzE0XTsKICAgICAgICAgICAgb3V0WzE1XSA9IGFbMTVdIC0gYlsxNV07CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIG11bHRpcGx5U2NhbGFyKG91dCwgYSwgYikgewogICAgICAgICAgICBvdXRbMF0gPSBhWzBdICogYjsKICAgICAgICAgICAgb3V0WzFdID0gYVsxXSAqIGI7CiAgICAgICAgICAgIG91dFsyXSA9IGFbMl0gKiBiOwogICAgICAgICAgICBvdXRbM10gPSBhWzNdICogYjsKICAgICAgICAgICAgb3V0WzRdID0gYVs0XSAqIGI7CiAgICAgICAgICAgIG91dFs1XSA9IGFbNV0gKiBiOwogICAgICAgICAgICBvdXRbNl0gPSBhWzZdICogYjsKICAgICAgICAgICAgb3V0WzddID0gYVs3XSAqIGI7CiAgICAgICAgICAgIG91dFs4XSA9IGFbOF0gKiBiOwogICAgICAgICAgICBvdXRbOV0gPSBhWzldICogYjsKICAgICAgICAgICAgb3V0WzEwXSA9IGFbMTBdICogYjsKICAgICAgICAgICAgb3V0WzExXSA9IGFbMTFdICogYjsKICAgICAgICAgICAgb3V0WzEyXSA9IGFbMTJdICogYjsKICAgICAgICAgICAgb3V0WzEzXSA9IGFbMTNdICogYjsKICAgICAgICAgICAgb3V0WzE0XSA9IGFbMTRdICogYjsKICAgICAgICAgICAgb3V0WzE1XSA9IGFbMTVdICogYjsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gbXVsdGlwbHlTY2FsYXJBbmRBZGQob3V0LCBhLCBiLCBzY2FsZSkgewogICAgICAgICAgICBvdXRbMF0gPSBhWzBdICsgYlswXSAqIHNjYWxlOwogICAgICAgICAgICBvdXRbMV0gPSBhWzFdICsgYlsxXSAqIHNjYWxlOwogICAgICAgICAgICBvdXRbMl0gPSBhWzJdICsgYlsyXSAqIHNjYWxlOwogICAgICAgICAgICBvdXRbM10gPSBhWzNdICsgYlszXSAqIHNjYWxlOwogICAgICAgICAgICBvdXRbNF0gPQogICAgICAgICAgICAgICAgYVs0XSArIGJbNF0gKiBzY2FsZTsKICAgICAgICAgICAgb3V0WzVdID0gYVs1XSArIGJbNV0gKiBzY2FsZTsKICAgICAgICAgICAgb3V0WzZdID0gYVs2XSArIGJbNl0gKiBzY2FsZTsKICAgICAgICAgICAgb3V0WzddID0gYVs3XSArIGJbN10gKiBzY2FsZTsKICAgICAgICAgICAgb3V0WzhdID0gYVs4XSArIGJbOF0gKiBzY2FsZTsKICAgICAgICAgICAgb3V0WzldID0gYVs5XSArIGJbOV0gKiBzY2FsZTsKICAgICAgICAgICAgb3V0WzEwXSA9IGFbMTBdICsgYlsxMF0gKiBzY2FsZTsKICAgICAgICAgICAgb3V0WzExXSA9IGFbMTFdICsgYlsxMV0gKiBzY2FsZTsKICAgICAgICAgICAgb3V0WzEyXSA9IGFbMTJdICsgYlsxMl0gKiBzY2FsZTsKICAgICAgICAgICAgb3V0WzEzXSA9IGFbMTNdICsgYlsxM10gKiBzY2FsZTsKICAgICAgICAgICAgb3V0WzE0XSA9IGFbMTRdICsgYlsxNF0gKiBzY2FsZTsKICAgICAgICAgICAgb3V0WzE1XSA9IGFbMTVdICsgYlsxNV0gKiBzY2FsZTsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZXhhY3RFcXVhbHMkNShhLCBiKSB7CiAgICAgICAgICAgIHJldHVybiBhWzBdID09PSBiWzBdICYmIGFbMV0gPT09IGJbMV0gJiYgYVsyXSA9PT0gYlsyXSAmJiBhWzNdID09PSBiWzNdICYmIGFbNF0gPT09IGJbNF0gJiYgYVs1XSA9PT0gYls1XSAmJiBhWzZdID09PSBiWzZdICYmIGFbN10gPT09IGJbN10gJiYgYVs4XSA9PT0gYls4XSAmJiBhWzldID09PSBiWzldICYmIGFbMTBdID09PSBiWzEwXSAmJiBhWzExXSA9PT0gYlsxMV0gJiYgYVsxMl0gPT09CiAgICAgICAgICAgICAgICBiWzEyXSAmJiBhWzEzXSA9PT0gYlsxM10gJiYgYVsxNF0gPT09IGJbMTRdICYmIGFbMTVdID09PSBiWzE1XQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZXF1YWxzJDUoYSwgYikgewogICAgICAgICAgICB2YXIgYTAgPSBhWzBdLAogICAgICAgICAgICAgICAgYTEgPSBhWzFdLAogICAgICAgICAgICAgICAgYTIgPSBhWzJdLAogICAgICAgICAgICAgICAgYTMgPSBhWzNdOwogICAgICAgICAgICB2YXIgYTQgPSBhWzRdLAogICAgICAgICAgICAgICAgYTUgPSBhWzVdLAogICAgICAgICAgICAgICAgYTYgPSBhWzZdLAogICAgICAgICAgICAgICAgYTcgPSBhWzddOwogICAgICAgICAgICB2YXIgYTggPSBhWzhdLAogICAgICAgICAgICAgICAgYTkgPSBhWzldLAogICAgICAgICAgICAgICAgYTEwID0gYVsxMF0sCiAgICAgICAgICAgICAgICBhMTEgPSBhWzExXTsKICAgICAgICAgICAgdmFyIGExMiA9IGFbMTJdLAogICAgICAgICAgICAgICAgYTEzID0gYVsxM10sCiAgICAgICAgICAgICAgICBhMTQgPSBhWzE0XSwKICAgICAgICAgICAgICAgIGExNSA9IGFbMTVdOwogICAgICAgICAgICB2YXIgYjAgPSBiWzBdLAogICAgICAgICAgICAgICAgYjEgPSBiWzFdLAogICAgICAgICAgICAgICAgYjIgPSBiWzJdLAogICAgICAgICAgICAgICAgYjMgPSBiWzNdOwogICAgICAgICAgICB2YXIgYjQgPSBiWzRdLAogICAgICAgICAgICAgICAgYjUgPSBiWzVdLAogICAgICAgICAgICAgICAgYjYgPSBiWzZdLAogICAgICAgICAgICAgICAgYjcgPSBiWzddOwogICAgICAgICAgICB2YXIgYjggPSBiWzhdLAogICAgICAgICAgICAgICAgYjkgPSBiWzldLAogICAgICAgICAgICAgICAgYjEwID0gYlsxMF0sCiAgICAgICAgICAgICAgICBiMTEgPSBiWzExXTsKICAgICAgICAgICAgdmFyIGIxMiA9IGJbMTJdLAogICAgICAgICAgICAgICAgYjEzID0gYlsxM10sCiAgICAgICAgICAgICAgICBiMTQgPSBiWzE0XSwKICAgICAgICAgICAgICAgIGIxNSA9IGJbMTVdOwogICAgICAgICAgICByZXR1cm4gTWF0aC5hYnMoYTAgLSBiMCkgPD0gRVBTSUxPTiAqIE1hdGgubWF4KDEsIE1hdGguYWJzKGEwKSwgTWF0aC5hYnMoYjApKSAmJiBNYXRoLmFicyhhMSAtIGIxKSA8PSBFUFNJTE9OICogTWF0aC5tYXgoMSwgTWF0aC5hYnMoYTEpLAogICAgICAgICAgICAgICAgTWF0aC5hYnMoYjEpKSAmJiBNYXRoLmFicyhhMiAtIGIyKSA8PSBFUFNJTE9OICogTWF0aC5tYXgoMSwgTWF0aC5hYnMoYTIpLCBNYXRoLmFicyhiMikpICYmIE1hdGguYWJzKGEzIC0gYjMpIDw9IEVQU0lMT04gKiBNYXRoLm1heCgxLCBNYXRoLmFicyhhMyksIE1hdGguYWJzKGIzKSkgJiYgTWF0aC5hYnMoYTQgLSBiNCkgPD0gRVBTSUxPTiAqIE1hdGgubWF4KDEsIE1hdGguYWJzKGE0KSwgTWF0aC5hYnMoYjQpKSAmJiBNYXRoLmFicyhhNSAtIGI1KSA8PSBFUFNJTE9OICogTWF0aC5tYXgoMSwgTWF0aC5hYnMoYTUpLCBNYXRoLmFicyhiNSkpICYmIE1hdGguYWJzKGE2IC0gYjYpIDw9IEVQU0lMT04gKiBNYXRoLm1heCgxLCBNYXRoLmFicyhhNiksIE1hdGguYWJzKGI2KSkgJiYgTWF0aC5hYnMoYTcgLSBiNykgPD0gRVBTSUxPTiAqIE1hdGgubWF4KDEsIE1hdGguYWJzKGE3KSwgTWF0aC5hYnMoYjcpKSAmJiBNYXRoLmFicyhhOCAtIGI4KSA8PSBFUFNJTE9OICogTWF0aC5tYXgoMSwgTWF0aC5hYnMoYTgpLCBNYXRoLmFicyhiOCkpICYmIE1hdGguYWJzKGE5IC0gYjkpIDw9IEVQU0lMT04gKiBNYXRoLm1heCgxLCBNYXRoLmFicyhhOSksCiAgICAgICAgICAgICAgICBNYXRoLmFicyhiOSkpICYmIE1hdGguYWJzKGExMCAtIGIxMCkgPD0gRVBTSUxPTiAqIE1hdGgubWF4KDEsIE1hdGguYWJzKGExMCksIE1hdGguYWJzKGIxMCkpICYmIE1hdGguYWJzKGExMSAtIGIxMSkgPD0gRVBTSUxPTiAqIE1hdGgubWF4KDEsIE1hdGguYWJzKGExMSksIE1hdGguYWJzKGIxMSkpICYmIE1hdGguYWJzKGExMiAtIGIxMikgPD0gRVBTSUxPTiAqIE1hdGgubWF4KDEsIE1hdGguYWJzKGExMiksIE1hdGguYWJzKGIxMikpICYmIE1hdGguYWJzKGExMyAtIGIxMykgPD0gRVBTSUxPTiAqIE1hdGgubWF4KDEsIE1hdGguYWJzKGExMyksIE1hdGguYWJzKGIxMykpICYmIE1hdGguYWJzKGExNCAtIGIxNCkgPD0gRVBTSUxPTiAqIE1hdGgubWF4KDEsIE1hdGguYWJzKGExNCksIE1hdGguYWJzKGIxNCkpICYmIE1hdGguYWJzKGExNSAtIGIxNSkgPD0gRVBTSUxPTiAqIE1hdGgubWF4KDEsIE1hdGguYWJzKGExNSksIE1hdGguYWJzKGIxNSkpCiAgICAgICAgfQogICAgICAgIHZhciBtdWwkNSA9IG11bHRpcGx5JDU7CiAgICAgICAgdmFyIHN1YiQzID0gc3VidHJhY3QkMzsKICAgICAgICB2YXIgbWF0NCA9IE9iamVjdC5mcmVlemUoewogICAgICAgICAgICBfX3Byb3RvX186IG51bGwsCiAgICAgICAgICAgIGNyZWF0ZTogY3JlYXRlJDUsCiAgICAgICAgICAgIGNsb25lOiBjbG9uZSQ1LAogICAgICAgICAgICBjb3B5OiBjb3B5JDUsCiAgICAgICAgICAgIGZyb21WYWx1ZXM6IGZyb21WYWx1ZXMkNSwKICAgICAgICAgICAgc2V0OiBzZXQkNSwKICAgICAgICAgICAgaWRlbnRpdHk6IGlkZW50aXR5JDIsCiAgICAgICAgICAgIHRyYW5zcG9zZTogdHJhbnNwb3NlLAogICAgICAgICAgICBpbnZlcnQ6IGludmVydCQyLAogICAgICAgICAgICBhZGpvaW50OiBhZGpvaW50LAogICAgICAgICAgICBkZXRlcm1pbmFudDogZGV0ZXJtaW5hbnQsCiAgICAgICAgICAgIG11bHRpcGx5OiBtdWx0aXBseSQ1LAogICAgICAgICAgICB0cmFuc2xhdGU6IHRyYW5zbGF0ZSQxLAogICAgICAgICAgICBzY2FsZTogc2NhbGUkNSwKICAgICAgICAgICAgcm90YXRlOiByb3RhdGUkMSwKICAgICAgICAgICAgcm90YXRlWDogcm90YXRlWCQzLAogICAgICAgICAgICByb3RhdGVZOiByb3RhdGVZJDMsCiAgICAgICAgICAgIHJvdGF0ZVo6IHJvdGF0ZVokMywKICAgICAgICAgICAgZnJvbVRyYW5zbGF0aW9uOiBmcm9tVHJhbnNsYXRpb24kMSwKICAgICAgICAgICAgZnJvbVNjYWxpbmc6IGZyb21TY2FsaW5nLAogICAgICAgICAgICBmcm9tUm90YXRpb246IGZyb21Sb3RhdGlvbiQxLAogICAgICAgICAgICBmcm9tWFJvdGF0aW9uOiBmcm9tWFJvdGF0aW9uLAogICAgICAgICAgICBmcm9tWVJvdGF0aW9uOiBmcm9tWVJvdGF0aW9uLAogICAgICAgICAgICBmcm9tWlJvdGF0aW9uOiBmcm9tWlJvdGF0aW9uLAogICAgICAgICAgICBmcm9tUm90YXRpb25UcmFuc2xhdGlvbjogZnJvbVJvdGF0aW9uVHJhbnNsYXRpb24kMSwKICAgICAgICAgICAgZnJvbVF1YXQyOiBmcm9tUXVhdDIsCiAgICAgICAgICAgIGdldFRyYW5zbGF0aW9uOiBnZXRUcmFuc2xhdGlvbiQxLAogICAgICAgICAgICBnZXRTY2FsaW5nOiBnZXRTY2FsaW5nLAogICAgICAgICAgICBnZXRSb3RhdGlvbjogZ2V0Um90YXRpb24sCiAgICAgICAgICAgIGRlY29tcG9zZTogZGVjb21wb3NlLAogICAgICAgICAgICBmcm9tUm90YXRpb25UcmFuc2xhdGlvblNjYWxlOiBmcm9tUm90YXRpb25UcmFuc2xhdGlvblNjYWxlLAogICAgICAgICAgICBmcm9tUm90YXRpb25UcmFuc2xhdGlvblNjYWxlT3JpZ2luOiBmcm9tUm90YXRpb25UcmFuc2xhdGlvblNjYWxlT3JpZ2luLAogICAgICAgICAgICBmcm9tUXVhdDogZnJvbVF1YXQsCiAgICAgICAgICAgIGZydXN0dW06IGZydXN0dW0sCiAgICAgICAgICAgIHBlcnNwZWN0aXZlTk86IHBlcnNwZWN0aXZlTk8sCiAgICAgICAgICAgIHBlcnNwZWN0aXZlOiBwZXJzcGVjdGl2ZSwKICAgICAgICAgICAgcGVyc3BlY3RpdmVaTzogcGVyc3BlY3RpdmVaTywKICAgICAgICAgICAgcGVyc3BlY3RpdmVGcm9tRmllbGRPZlZpZXc6IHBlcnNwZWN0aXZlRnJvbUZpZWxkT2ZWaWV3LAogICAgICAgICAgICBvcnRob05POiBvcnRob05PLAogICAgICAgICAgICBvcnRobzogb3J0aG8sCiAgICAgICAgICAgIG9ydGhvWk86IG9ydGhvWk8sCiAgICAgICAgICAgIGxvb2tBdDogbG9va0F0LAogICAgICAgICAgICB0YXJnZXRUbzogdGFyZ2V0VG8sCiAgICAgICAgICAgIHN0cjogc3RyJDUsCiAgICAgICAgICAgIGZyb2I6IGZyb2IsCiAgICAgICAgICAgIGFkZDogYWRkJDUsCiAgICAgICAgICAgIHN1YnRyYWN0OiBzdWJ0cmFjdCQzLAogICAgICAgICAgICBtdWx0aXBseVNjYWxhcjogbXVsdGlwbHlTY2FsYXIsCiAgICAgICAgICAgIG11bHRpcGx5U2NhbGFyQW5kQWRkOiBtdWx0aXBseVNjYWxhckFuZEFkZCwKICAgICAgICAgICAgZXhhY3RFcXVhbHM6IGV4YWN0RXF1YWxzJDUsCiAgICAgICAgICAgIGVxdWFsczogZXF1YWxzJDUsCiAgICAgICAgICAgIG11bDogbXVsJDUsCiAgICAgICAgICAgIHN1Yjogc3ViJDMKICAgICAgICB9KTsKCiAgICAgICAgZnVuY3Rpb24gY3JlYXRlJDQoKSB7CiAgICAgICAgICAgIHZhciBvdXQgPSBuZXcgQVJSQVlfVFlQRSgzKTsKICAgICAgICAgICAgaWYgKEFSUkFZX1RZUEUgIT0gRmxvYXQzMkFycmF5KSB7CiAgICAgICAgICAgICAgICBvdXRbMF0gPSAwOwogICAgICAgICAgICAgICAgb3V0WzFdID0gMDsKICAgICAgICAgICAgICAgIG91dFsyXSA9IDAKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBjbG9uZSQ0KGEpIHsKICAgICAgICAgICAgdmFyIG91dCA9IG5ldyBBUlJBWV9UWVBFKDMpOwogICAgICAgICAgICBvdXRbMF0gPSBhWzBdOwogICAgICAgICAgICBvdXRbMV0gPSBhWzFdOwogICAgICAgICAgICBvdXRbMl0gPSBhWzJdOwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBsZW5ndGgkNChhKSB7CiAgICAgICAgICAgIHZhciB4ID0gYVswXTsKICAgICAgICAgICAgdmFyIHkgPSBhWzFdOwogICAgICAgICAgICB2YXIgeiA9IGFbMl07CiAgICAgICAgICAgIHJldHVybiBNYXRoLmh5cG90KHgsIHksIHopCiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBmcm9tVmFsdWVzJDQoeCwgeSwgeikgewogICAgICAgICAgICB2YXIgb3V0ID0gbmV3IEFSUkFZX1RZUEUoMyk7CiAgICAgICAgICAgIG91dFswXSA9IHg7CiAgICAgICAgICAgIG91dFsxXSA9IHk7CiAgICAgICAgICAgIG91dFsyXSA9IHo7CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGNvcHkkNChvdXQsIGEpIHsKICAgICAgICAgICAgb3V0WzBdID0gYVswXTsKICAgICAgICAgICAgb3V0WzFdID0gYVsxXTsKICAgICAgICAgICAgb3V0WzJdID0gYVsyXTsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gc2V0JDQob3V0LCB4LCB5LCB6KSB7CiAgICAgICAgICAgIG91dFswXSA9IHg7CiAgICAgICAgICAgIG91dFsxXSA9IHk7CiAgICAgICAgICAgIG91dFsyXSA9IHo7CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGFkZCQ0KG91dCwgYSwgYikgewogICAgICAgICAgICBvdXRbMF0gPSBhWzBdICsgYlswXTsKICAgICAgICAgICAgb3V0WzFdID0gYVsxXSArIGJbMV07CiAgICAgICAgICAgIG91dFsyXSA9IGFbMl0gKyBiWzJdOwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBzdWJ0cmFjdCQyKG91dCwgYSwgYikgewogICAgICAgICAgICBvdXRbMF0gPSBhWzBdIC0gYlswXTsKICAgICAgICAgICAgb3V0WzFdID0gYVsxXSAtIGJbMV07CiAgICAgICAgICAgIG91dFsyXSA9IGFbMl0gLSBiWzJdOwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBtdWx0aXBseSQ0KG91dCwgYSwgYikgewogICAgICAgICAgICBvdXRbMF0gPSBhWzBdICogYlswXTsKICAgICAgICAgICAgb3V0WzFdID0gYVsxXSAqIGJbMV07CiAgICAgICAgICAgIG91dFsyXSA9IGFbMl0gKiBiWzJdOwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBkaXZpZGUkMihvdXQsIGEsIGIpIHsKICAgICAgICAgICAgb3V0WzBdID0gYVswXSAvIGJbMF07CiAgICAgICAgICAgIG91dFsxXSA9IGFbMV0gLyBiWzFdOwogICAgICAgICAgICBvdXRbMl0gPSBhWzJdIC8gYlsyXTsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gY2VpbCQyKG91dCwgYSkgewogICAgICAgICAgICBvdXRbMF0gPSBNYXRoLmNlaWwoYVswXSk7CiAgICAgICAgICAgIG91dFsxXSA9IE1hdGguY2VpbChhWzFdKTsKICAgICAgICAgICAgb3V0WzJdID0gTWF0aC5jZWlsKGFbMl0pOwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBmbG9vciQyKG91dCwgYSkgewogICAgICAgICAgICBvdXRbMF0gPSBNYXRoLmZsb29yKGFbMF0pOwogICAgICAgICAgICBvdXRbMV0gPSBNYXRoLmZsb29yKGFbMV0pOwogICAgICAgICAgICBvdXRbMl0gPSBNYXRoLmZsb29yKGFbMl0pOwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBtaW4kMihvdXQsIGEsIGIpIHsKICAgICAgICAgICAgb3V0WzBdID0gTWF0aC5taW4oYVswXSwgYlswXSk7CiAgICAgICAgICAgIG91dFsxXSA9IE1hdGgubWluKGFbMV0sIGJbMV0pOwogICAgICAgICAgICBvdXRbMl0gPSBNYXRoLm1pbihhWzJdLCBiWzJdKTsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gbWF4JDIob3V0LCBhLCBiKSB7CiAgICAgICAgICAgIG91dFswXSA9IE1hdGgubWF4KGFbMF0sIGJbMF0pOwogICAgICAgICAgICBvdXRbMV0gPSBNYXRoLm1heChhWzFdLCBiWzFdKTsKICAgICAgICAgICAgb3V0WzJdID0gTWF0aC5tYXgoYVsyXSwgYlsyXSk7CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHJvdW5kJDIob3V0LCBhKSB7CiAgICAgICAgICAgIG91dFswXSA9CiAgICAgICAgICAgICAgICBNYXRoLnJvdW5kKGFbMF0pOwogICAgICAgICAgICBvdXRbMV0gPSBNYXRoLnJvdW5kKGFbMV0pOwogICAgICAgICAgICBvdXRbMl0gPSBNYXRoLnJvdW5kKGFbMl0pOwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBzY2FsZSQ0KG91dCwgYSwgYikgewogICAgICAgICAgICBvdXRbMF0gPSBhWzBdICogYjsKICAgICAgICAgICAgb3V0WzFdID0gYVsxXSAqIGI7CiAgICAgICAgICAgIG91dFsyXSA9IGFbMl0gKiBiOwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBzY2FsZUFuZEFkZCQyKG91dCwgYSwgYiwgc2NhbGUpIHsKICAgICAgICAgICAgb3V0WzBdID0gYVswXSArIGJbMF0gKiBzY2FsZTsKICAgICAgICAgICAgb3V0WzFdID0gYVsxXSArIGJbMV0gKiBzY2FsZTsKICAgICAgICAgICAgb3V0WzJdID0gYVsyXSArIGJbMl0gKiBzY2FsZTsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZGlzdGFuY2UkMihhLCBiKSB7CiAgICAgICAgICAgIHZhciB4ID0gYlswXSAtIGFbMF07CiAgICAgICAgICAgIHZhciB5ID0gYlsxXSAtIGFbMV07CiAgICAgICAgICAgIHZhciB6ID0gYlsyXSAtIGFbMl07CiAgICAgICAgICAgIHJldHVybiBNYXRoLmh5cG90KHgsIHksIHopCiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBzcXVhcmVkRGlzdGFuY2UkMihhLCBiKSB7CiAgICAgICAgICAgIHZhciB4ID0gYlswXSAtIGFbMF07CiAgICAgICAgICAgIHZhciB5ID0gYlsxXSAtIGFbMV07CiAgICAgICAgICAgIHZhciB6ID0gYlsyXSAtIGFbMl07CiAgICAgICAgICAgIHJldHVybiB4ICogeCArIHkgKiB5ICsgeiAqIHoKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHNxdWFyZWRMZW5ndGgkNChhKSB7CiAgICAgICAgICAgIHZhciB4ID0KICAgICAgICAgICAgICAgIGFbMF07CiAgICAgICAgICAgIHZhciB5ID0gYVsxXTsKICAgICAgICAgICAgdmFyIHogPSBhWzJdOwogICAgICAgICAgICByZXR1cm4geCAqIHggKyB5ICogeSArIHogKiB6CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBuZWdhdGUkMihvdXQsIGEpIHsKICAgICAgICAgICAgb3V0WzBdID0gLWFbMF07CiAgICAgICAgICAgIG91dFsxXSA9IC1hWzFdOwogICAgICAgICAgICBvdXRbMl0gPSAtYVsyXTsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gaW52ZXJzZSQyKG91dCwgYSkgewogICAgICAgICAgICBvdXRbMF0gPSAxIC8gYVswXTsKICAgICAgICAgICAgb3V0WzFdID0gMSAvIGFbMV07CiAgICAgICAgICAgIG91dFsyXSA9IDEgLyBhWzJdOwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBub3JtYWxpemUkNChvdXQsIGEpIHsKICAgICAgICAgICAgdmFyIHggPSBhWzBdOwogICAgICAgICAgICB2YXIgeSA9IGFbMV07CiAgICAgICAgICAgIHZhciB6ID0gYVsyXTsKICAgICAgICAgICAgdmFyIGxlbiA9IHggKiB4ICsgeSAqIHkgKyB6ICogejsKICAgICAgICAgICAgaWYgKGxlbiA+IDApIGxlbiA9IDEgLyBNYXRoLnNxcnQobGVuKTsKICAgICAgICAgICAgb3V0WzBdID0gYVswXSAqIGxlbjsKICAgICAgICAgICAgb3V0WzFdID0gYVsxXSAqIGxlbjsKICAgICAgICAgICAgb3V0WzJdID0gYVsyXSAqIGxlbjsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZG90JDQoYSwgYikgewogICAgICAgICAgICByZXR1cm4gYVswXSAqIGJbMF0gKyBhWzFdICogYlsxXSArIGFbMl0gKiBiWzJdCiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBjcm9zcyQyKG91dCwgYSwgYikgewogICAgICAgICAgICB2YXIgYXggPSBhWzBdLAogICAgICAgICAgICAgICAgYXkgPSBhWzFdLAogICAgICAgICAgICAgICAgYXogPSBhWzJdOwogICAgICAgICAgICB2YXIgYnggPSBiWzBdLAogICAgICAgICAgICAgICAgYnkgPSBiWzFdLAogICAgICAgICAgICAgICAgYnogPSBiWzJdOwogICAgICAgICAgICBvdXRbMF0gPSBheSAqIGJ6IC0gYXogKiBieTsKICAgICAgICAgICAgb3V0WzFdID0gYXogKiBieCAtIGF4ICogYno7CiAgICAgICAgICAgIG91dFsyXSA9IGF4ICogYnkgLSBheSAqIGJ4OwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBsZXJwJDQob3V0LCBhLCBiLCB0KSB7CiAgICAgICAgICAgIHZhciBheCA9IGFbMF07CiAgICAgICAgICAgIHZhciBheSA9IGFbMV07CiAgICAgICAgICAgIHZhciBheiA9IGFbMl07CiAgICAgICAgICAgIG91dFswXSA9IGF4ICsgdCAqIChiWzBdIC0gYXgpOwogICAgICAgICAgICBvdXRbMV0gPSBheSArIHQgKiAoYlsxXSAtIGF5KTsKICAgICAgICAgICAgb3V0WzJdID0gYXogKyB0ICogKGJbMl0gLSBheik7CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHNsZXJwJDEob3V0LCBhLCBiLCB0KSB7CiAgICAgICAgICAgIHZhciBhbmdsZSA9IE1hdGguYWNvcyhNYXRoLm1pbihNYXRoLm1heChkb3QkNChhLCBiKSwgLTEpLCAxKSk7CiAgICAgICAgICAgIHZhciBzaW5Ub3RhbCA9IE1hdGguc2luKGFuZ2xlKTsKICAgICAgICAgICAgdmFyIHJhdGlvQSA9IE1hdGguc2luKCgxIC0gdCkgKiBhbmdsZSkgLyBzaW5Ub3RhbDsKICAgICAgICAgICAgdmFyIHJhdGlvQiA9IE1hdGguc2luKHQgKiBhbmdsZSkgLyBzaW5Ub3RhbDsKICAgICAgICAgICAgb3V0WzBdID0gcmF0aW9BICogYVswXSArIHJhdGlvQiAqIGJbMF07CiAgICAgICAgICAgIG91dFsxXSA9IHJhdGlvQSAqIGFbMV0gKyByYXRpb0IgKiBiWzFdOwogICAgICAgICAgICBvdXRbMl0gPSByYXRpb0EgKiBhWzJdICsgcmF0aW9CICogYlsyXTsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gaGVybWl0ZShvdXQsIGEsIGIsIGMsIGQsIHQpIHsKICAgICAgICAgICAgdmFyIGZhY3RvclRpbWVzMiA9IHQgKiB0OwogICAgICAgICAgICB2YXIgZmFjdG9yMSA9IGZhY3RvclRpbWVzMiAqICgyICogdCAtIDMpICsgMTsKICAgICAgICAgICAgdmFyIGZhY3RvcjIgPSBmYWN0b3JUaW1lczIgKiAodCAtIDIpICsgdDsKICAgICAgICAgICAgdmFyIGZhY3RvcjMgPSBmYWN0b3JUaW1lczIgKiAodCAtIDEpOwogICAgICAgICAgICB2YXIgZmFjdG9yNCA9IGZhY3RvclRpbWVzMiAqICgzIC0gMiAqIHQpOwogICAgICAgICAgICBvdXRbMF0gPSBhWzBdICogZmFjdG9yMSArIGJbMF0gKiBmYWN0b3IyICsgY1swXSAqIGZhY3RvcjMgKyBkWzBdICogZmFjdG9yNDsKICAgICAgICAgICAgb3V0WzFdID0gYVsxXSAqIGZhY3RvcjEgKyBiWzFdICogZmFjdG9yMiArIGNbMV0gKiBmYWN0b3IzICsgZFsxXSAqIGZhY3RvcjQ7CiAgICAgICAgICAgIG91dFsyXSA9IGFbMl0gKiBmYWN0b3IxICsgYlsyXSAqIGZhY3RvcjIgKyBjWzJdICogZmFjdG9yMyArIGRbMl0gKiBmYWN0b3I0OwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBiZXppZXIob3V0LCBhLCBiLCBjLCBkLCB0KSB7CiAgICAgICAgICAgIHZhciBpbnZlcnNlRmFjdG9yID0gMSAtIHQ7CiAgICAgICAgICAgIHZhciBpbnZlcnNlRmFjdG9yVGltZXNUd28gPSBpbnZlcnNlRmFjdG9yICogaW52ZXJzZUZhY3RvcjsKICAgICAgICAgICAgdmFyIGZhY3RvclRpbWVzMiA9CiAgICAgICAgICAgICAgICB0ICogdDsKICAgICAgICAgICAgdmFyIGZhY3RvcjEgPSBpbnZlcnNlRmFjdG9yVGltZXNUd28gKiBpbnZlcnNlRmFjdG9yOwogICAgICAgICAgICB2YXIgZmFjdG9yMiA9IDMgKiB0ICogaW52ZXJzZUZhY3RvclRpbWVzVHdvOwogICAgICAgICAgICB2YXIgZmFjdG9yMyA9IDMgKiBmYWN0b3JUaW1lczIgKiBpbnZlcnNlRmFjdG9yOwogICAgICAgICAgICB2YXIgZmFjdG9yNCA9IGZhY3RvclRpbWVzMiAqIHQ7CiAgICAgICAgICAgIG91dFswXSA9IGFbMF0gKiBmYWN0b3IxICsgYlswXSAqIGZhY3RvcjIgKyBjWzBdICogZmFjdG9yMyArIGRbMF0gKiBmYWN0b3I0OwogICAgICAgICAgICBvdXRbMV0gPSBhWzFdICogZmFjdG9yMSArIGJbMV0gKiBmYWN0b3IyICsgY1sxXSAqIGZhY3RvcjMgKyBkWzFdICogZmFjdG9yNDsKICAgICAgICAgICAgb3V0WzJdID0gYVsyXSAqIGZhY3RvcjEgKyBiWzJdICogZmFjdG9yMiArIGNbMl0gKiBmYWN0b3IzICsgZFsyXSAqIGZhY3RvcjQ7CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHJhbmRvbSQzKG91dCwgc2NhbGUpIHsKICAgICAgICAgICAgc2NhbGUgPSBzY2FsZSB8fCAxOwogICAgICAgICAgICB2YXIgciA9IFJBTkRPTSgpICogMiAqIE1hdGguUEk7CiAgICAgICAgICAgIHZhciB6ID0gUkFORE9NKCkgKiAyIC0gMTsKICAgICAgICAgICAgdmFyIHpTY2FsZSA9IE1hdGguc3FydCgxIC0geiAqIHopICogc2NhbGU7CiAgICAgICAgICAgIG91dFswXSA9IE1hdGguY29zKHIpICogelNjYWxlOwogICAgICAgICAgICBvdXRbMV0gPQogICAgICAgICAgICAgICAgTWF0aC5zaW4ocikgKiB6U2NhbGU7CiAgICAgICAgICAgIG91dFsyXSA9IHogKiBzY2FsZTsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gdHJhbnNmb3JtTWF0NCQyKG91dCwgYSwgbSkgewogICAgICAgICAgICB2YXIgeCA9IGFbMF0sCiAgICAgICAgICAgICAgICB5ID0gYVsxXSwKICAgICAgICAgICAgICAgIHogPSBhWzJdOwogICAgICAgICAgICB2YXIgdyA9IG1bM10gKiB4ICsgbVs3XSAqIHkgKyBtWzExXSAqIHogKyBtWzE1XTsKICAgICAgICAgICAgdyA9IHcgfHwgMTsKICAgICAgICAgICAgb3V0WzBdID0gKG1bMF0gKiB4ICsgbVs0XSAqIHkgKyBtWzhdICogeiArIG1bMTJdKSAvIHc7CiAgICAgICAgICAgIG91dFsxXSA9IChtWzFdICogeCArIG1bNV0gKiB5ICsgbVs5XSAqIHogKyBtWzEzXSkgLyB3OwogICAgICAgICAgICBvdXRbMl0gPSAobVsyXSAqIHggKyBtWzZdICogeSArIG1bMTBdICogeiArIG1bMTRdKSAvIHc7CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHRyYW5zZm9ybU1hdDMkMShvdXQsIGEsIG0pIHsKICAgICAgICAgICAgdmFyIHggPSBhWzBdLAogICAgICAgICAgICAgICAgeSA9IGFbMV0sCiAgICAgICAgICAgICAgICB6ID0gYVsyXTsKICAgICAgICAgICAgb3V0WzBdID0geCAqIG1bMF0gKyB5ICogbVszXSArIHogKiBtWzZdOwogICAgICAgICAgICBvdXRbMV0gPSB4ICogbVsxXSArIHkgKiBtWzRdICsgeiAqIG1bN107CiAgICAgICAgICAgIG91dFsyXSA9IHggKiBtWzJdICsgeSAqIG1bNV0gKyB6ICogbVs4XTsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gdHJhbnNmb3JtUXVhdCQxKG91dCwgYSwgcSkgewogICAgICAgICAgICB2YXIgcXggPSBxWzBdLAogICAgICAgICAgICAgICAgcXkgPSBxWzFdLAogICAgICAgICAgICAgICAgcXogPSBxWzJdLAogICAgICAgICAgICAgICAgcXcgPSBxWzNdOwogICAgICAgICAgICB2YXIgeCA9CiAgICAgICAgICAgICAgICBhWzBdLAogICAgICAgICAgICAgICAgeSA9IGFbMV0sCiAgICAgICAgICAgICAgICB6ID0gYVsyXTsKICAgICAgICAgICAgdmFyIHV2eCA9IHF5ICogeiAtIHF6ICogeSwKICAgICAgICAgICAgICAgIHV2eSA9IHF6ICogeCAtIHF4ICogeiwKICAgICAgICAgICAgICAgIHV2eiA9IHF4ICogeSAtIHF5ICogeDsKICAgICAgICAgICAgdmFyIHV1dnggPSBxeSAqIHV2eiAtIHF6ICogdXZ5LAogICAgICAgICAgICAgICAgdXV2eSA9IHF6ICogdXZ4IC0gcXggKiB1dnosCiAgICAgICAgICAgICAgICB1dXZ6ID0gcXggKiB1dnkgLSBxeSAqIHV2eDsKICAgICAgICAgICAgdmFyIHcyID0gcXcgKiAyOwogICAgICAgICAgICB1dnggKj0gdzI7CiAgICAgICAgICAgIHV2eSAqPSB3MjsKICAgICAgICAgICAgdXZ6ICo9IHcyOwogICAgICAgICAgICB1dXZ4ICo9IDI7CiAgICAgICAgICAgIHV1dnkgKj0gMjsKICAgICAgICAgICAgdXV2eiAqPSAyOwogICAgICAgICAgICBvdXRbMF0gPSB4ICsgdXZ4ICsgdXV2eDsKICAgICAgICAgICAgb3V0WzFdID0geSArIHV2eSArIHV1dnk7CiAgICAgICAgICAgIG91dFsyXSA9IHogKyB1dnogKyB1dXZ6OwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiByb3RhdGVYJDIob3V0LCBhLCBiLCByYWQpIHsKICAgICAgICAgICAgdmFyIHAgPSBbXSwKICAgICAgICAgICAgICAgIHIgPSBbXTsKICAgICAgICAgICAgcFswXSA9IGFbMF0gLSBiWzBdOwogICAgICAgICAgICBwWzFdID0gYVsxXSAtIGJbMV07CiAgICAgICAgICAgIHBbMl0gPSBhWzJdIC0gYlsyXTsKICAgICAgICAgICAgclswXSA9IHBbMF07CiAgICAgICAgICAgIHJbMV0gPSBwWzFdICogTWF0aC5jb3MocmFkKSAtIHBbMl0gKiBNYXRoLnNpbihyYWQpOwogICAgICAgICAgICByWzJdID0gcFsxXSAqIE1hdGguc2luKHJhZCkgKyBwWzJdICogTWF0aC5jb3MocmFkKTsKICAgICAgICAgICAgb3V0WzBdID0gclswXSArIGJbMF07CiAgICAgICAgICAgIG91dFsxXSA9IHJbMV0gKyBiWzFdOwogICAgICAgICAgICBvdXRbMl0gPSByWzJdICsgYlsyXTsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gcm90YXRlWSQyKG91dCwKICAgICAgICAgICAgYSwgYiwgcmFkKSB7CiAgICAgICAgICAgIHZhciBwID0gW10sCiAgICAgICAgICAgICAgICByID0gW107CiAgICAgICAgICAgIHBbMF0gPSBhWzBdIC0gYlswXTsKICAgICAgICAgICAgcFsxXSA9IGFbMV0gLSBiWzFdOwogICAgICAgICAgICBwWzJdID0gYVsyXSAtIGJbMl07CiAgICAgICAgICAgIHJbMF0gPSBwWzJdICogTWF0aC5zaW4ocmFkKSArIHBbMF0gKiBNYXRoLmNvcyhyYWQpOwogICAgICAgICAgICByWzFdID0gcFsxXTsKICAgICAgICAgICAgclsyXSA9IHBbMl0gKiBNYXRoLmNvcyhyYWQpIC0gcFswXSAqIE1hdGguc2luKHJhZCk7CiAgICAgICAgICAgIG91dFswXSA9IHJbMF0gKyBiWzBdOwogICAgICAgICAgICBvdXRbMV0gPSByWzFdICsgYlsxXTsKICAgICAgICAgICAgb3V0WzJdID0gclsyXSArIGJbMl07CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHJvdGF0ZVokMihvdXQsIGEsIGIsIHJhZCkgewogICAgICAgICAgICB2YXIgcCA9IFtdLAogICAgICAgICAgICAgICAgciA9IFtdOwogICAgICAgICAgICBwWzBdID0gYVswXSAtIGJbMF07CiAgICAgICAgICAgIHBbMV0gPSBhWzFdIC0gYlsxXTsKICAgICAgICAgICAgcFsyXSA9IGFbMl0gLSBiWzJdOwogICAgICAgICAgICByWzBdID0gcFswXSAqIE1hdGguY29zKHJhZCkgLSBwWzFdICogTWF0aC5zaW4ocmFkKTsKICAgICAgICAgICAgclsxXSA9IHBbMF0gKiBNYXRoLnNpbihyYWQpICsgcFsxXSAqIE1hdGguY29zKHJhZCk7CiAgICAgICAgICAgIHJbMl0gPSBwWzJdOwogICAgICAgICAgICBvdXRbMF0gPSByWzBdICsgYlswXTsKICAgICAgICAgICAgb3V0WzFdID0gclsxXSArIGJbMV07CiAgICAgICAgICAgIG91dFsyXSA9IHJbMl0gKyBiWzJdOwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBhbmdsZSQxKGEsIGIpIHsKICAgICAgICAgICAgdmFyIGF4ID0KICAgICAgICAgICAgICAgIGFbMF0sCiAgICAgICAgICAgICAgICBheSA9IGFbMV0sCiAgICAgICAgICAgICAgICBheiA9IGFbMl0sCiAgICAgICAgICAgICAgICBieCA9IGJbMF0sCiAgICAgICAgICAgICAgICBieSA9IGJbMV0sCiAgICAgICAgICAgICAgICBieiA9IGJbMl0sCiAgICAgICAgICAgICAgICBtYWcgPSBNYXRoLnNxcnQoKGF4ICogYXggKyBheSAqIGF5ICsgYXogKiBheikgKiAoYnggKiBieCArIGJ5ICogYnkgKyBieiAqIGJ6KSksCiAgICAgICAgICAgICAgICBjb3NpbmUgPSBtYWcgJiYgZG90JDQoYSwgYikgLyBtYWc7CiAgICAgICAgICAgIHJldHVybiBNYXRoLmFjb3MoTWF0aC5taW4oTWF0aC5tYXgoY29zaW5lLCAtMSksIDEpKQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gemVybyQyKG91dCkgewogICAgICAgICAgICBvdXRbMF0gPSAwOwogICAgICAgICAgICBvdXRbMV0gPSAwOwogICAgICAgICAgICBvdXRbMl0gPSAwOwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBzdHIkNChhKSB7CiAgICAgICAgICAgIHJldHVybiAidmVjMygiICsgYVswXSArICIsICIgKyBhWzFdICsgIiwgIiArIGFbMl0gKyAiKSIKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGV4YWN0RXF1YWxzJDQoYSwgYikgewogICAgICAgICAgICByZXR1cm4gYVswXSA9PT0gYlswXSAmJiBhWzFdID09PSBiWzFdICYmIGFbMl0gPT09IGJbMl0KICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGVxdWFscyQ0KGEsIGIpIHsKICAgICAgICAgICAgdmFyIGEwID0gYVswXSwKICAgICAgICAgICAgICAgIGExID0gYVsxXSwKICAgICAgICAgICAgICAgIGEyID0gYVsyXTsKICAgICAgICAgICAgdmFyIGIwID0gYlswXSwKICAgICAgICAgICAgICAgIGIxID0gYlsxXSwKICAgICAgICAgICAgICAgIGIyID0gYlsyXTsKICAgICAgICAgICAgcmV0dXJuIE1hdGguYWJzKGEwIC0gYjApIDw9IEVQU0lMT04gKiBNYXRoLm1heCgxLCBNYXRoLmFicyhhMCksCiAgICAgICAgICAgICAgICBNYXRoLmFicyhiMCkpICYmIE1hdGguYWJzKGExIC0gYjEpIDw9IEVQU0lMT04gKiBNYXRoLm1heCgxLCBNYXRoLmFicyhhMSksIE1hdGguYWJzKGIxKSkgJiYgTWF0aC5hYnMoYTIgLSBiMikgPD0gRVBTSUxPTiAqIE1hdGgubWF4KDEsIE1hdGguYWJzKGEyKSwgTWF0aC5hYnMoYjIpKQogICAgICAgIH0KICAgICAgICB2YXIgc3ViJDIgPSBzdWJ0cmFjdCQyOwogICAgICAgIHZhciBtdWwkNCA9IG11bHRpcGx5JDQ7CiAgICAgICAgdmFyIGRpdiQyID0gZGl2aWRlJDI7CiAgICAgICAgdmFyIGRpc3QkMiA9IGRpc3RhbmNlJDI7CiAgICAgICAgdmFyIHNxckRpc3QkMiA9IHNxdWFyZWREaXN0YW5jZSQyOwogICAgICAgIHZhciBsZW4kNCA9IGxlbmd0aCQ0OwogICAgICAgIHZhciBzcXJMZW4kNCA9IHNxdWFyZWRMZW5ndGgkNDsKICAgICAgICB2YXIgZm9yRWFjaCQyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciB2ZWMgPSBjcmVhdGUkNCgpOwogICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oYSwgc3RyaWRlLCBvZmZzZXQsIGNvdW50LCBmbiwgYXJnKSB7CiAgICAgICAgICAgICAgICB2YXIgaSwgbDsKICAgICAgICAgICAgICAgIGlmICghc3RyaWRlKSBzdHJpZGUgPSAzOwogICAgICAgICAgICAgICAgaWYgKCFvZmZzZXQpIG9mZnNldCA9IDA7CiAgICAgICAgICAgICAgICBpZiAoY291bnQpIGwgPSBNYXRoLm1pbihjb3VudCAqIHN0cmlkZSArIG9mZnNldCwgYS5sZW5ndGgpOwogICAgICAgICAgICAgICAgZWxzZSBsID0gYS5sZW5ndGg7CiAgICAgICAgICAgICAgICBmb3IgKGkgPSBvZmZzZXQ7IGkgPCBsOyBpICs9IHN0cmlkZSkgewogICAgICAgICAgICAgICAgICAgIHZlY1swXSA9IGFbaV07CiAgICAgICAgICAgICAgICAgICAgdmVjWzFdID0gYVtpICsgMV07CiAgICAgICAgICAgICAgICAgICAgdmVjWzJdID0gYVtpICsgMl07CiAgICAgICAgICAgICAgICAgICAgZm4odmVjLCB2ZWMsIGFyZyk7CiAgICAgICAgICAgICAgICAgICAgYVtpXSA9IHZlY1swXTsKICAgICAgICAgICAgICAgICAgICBhW2kgKyAxXSA9IHZlY1sxXTsKICAgICAgICAgICAgICAgICAgICBhW2kgKyAyXSA9IHZlY1syXQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIGEKICAgICAgICAgICAgfQogICAgICAgIH0oKTsKICAgICAgICB2YXIgdmVjMyA9IE9iamVjdC5mcmVlemUoewogICAgICAgICAgICBfX3Byb3RvX186IG51bGwsCiAgICAgICAgICAgIGNyZWF0ZTogY3JlYXRlJDQsCiAgICAgICAgICAgIGNsb25lOiBjbG9uZSQ0LAogICAgICAgICAgICBsZW5ndGg6IGxlbmd0aCQ0LAogICAgICAgICAgICBmcm9tVmFsdWVzOiBmcm9tVmFsdWVzJDQsCiAgICAgICAgICAgIGNvcHk6IGNvcHkkNCwKICAgICAgICAgICAgc2V0OiBzZXQkNCwKICAgICAgICAgICAgYWRkOiBhZGQkNCwKICAgICAgICAgICAgc3VidHJhY3Q6IHN1YnRyYWN0JDIsCiAgICAgICAgICAgIG11bHRpcGx5OiBtdWx0aXBseSQ0LAogICAgICAgICAgICBkaXZpZGU6IGRpdmlkZSQyLAogICAgICAgICAgICBjZWlsOiBjZWlsJDIsCiAgICAgICAgICAgIGZsb29yOiBmbG9vciQyLAogICAgICAgICAgICBtaW46IG1pbiQyLAogICAgICAgICAgICBtYXg6IG1heCQyLAogICAgICAgICAgICByb3VuZDogcm91bmQkMiwKICAgICAgICAgICAgc2NhbGU6IHNjYWxlJDQsCiAgICAgICAgICAgIHNjYWxlQW5kQWRkOiBzY2FsZUFuZEFkZCQyLAogICAgICAgICAgICBkaXN0YW5jZTogZGlzdGFuY2UkMiwKICAgICAgICAgICAgc3F1YXJlZERpc3RhbmNlOiBzcXVhcmVkRGlzdGFuY2UkMiwKICAgICAgICAgICAgc3F1YXJlZExlbmd0aDogc3F1YXJlZExlbmd0aCQ0LAogICAgICAgICAgICBuZWdhdGU6IG5lZ2F0ZSQyLAogICAgICAgICAgICBpbnZlcnNlOiBpbnZlcnNlJDIsCiAgICAgICAgICAgIG5vcm1hbGl6ZTogbm9ybWFsaXplJDQsCiAgICAgICAgICAgIGRvdDogZG90JDQsCiAgICAgICAgICAgIGNyb3NzOiBjcm9zcyQyLAogICAgICAgICAgICBsZXJwOiBsZXJwJDQsCiAgICAgICAgICAgIHNsZXJwOiBzbGVycCQxLAogICAgICAgICAgICBoZXJtaXRlOiBoZXJtaXRlLAogICAgICAgICAgICBiZXppZXI6IGJlemllciwKICAgICAgICAgICAgcmFuZG9tOiByYW5kb20kMywKICAgICAgICAgICAgdHJhbnNmb3JtTWF0NDogdHJhbnNmb3JtTWF0NCQyLAogICAgICAgICAgICB0cmFuc2Zvcm1NYXQzOiB0cmFuc2Zvcm1NYXQzJDEsCiAgICAgICAgICAgIHRyYW5zZm9ybVF1YXQ6IHRyYW5zZm9ybVF1YXQkMSwKICAgICAgICAgICAgcm90YXRlWDogcm90YXRlWCQyLAogICAgICAgICAgICByb3RhdGVZOiByb3RhdGVZJDIsCiAgICAgICAgICAgIHJvdGF0ZVo6IHJvdGF0ZVokMiwKICAgICAgICAgICAgYW5nbGU6IGFuZ2xlJDEsCiAgICAgICAgICAgIHplcm86IHplcm8kMiwKICAgICAgICAgICAgc3RyOiBzdHIkNCwKICAgICAgICAgICAgZXhhY3RFcXVhbHM6IGV4YWN0RXF1YWxzJDQsCiAgICAgICAgICAgIGVxdWFsczogZXF1YWxzJDQsCiAgICAgICAgICAgIHN1Yjogc3ViJDIsCiAgICAgICAgICAgIG11bDogbXVsJDQsCiAgICAgICAgICAgIGRpdjogZGl2JDIsCiAgICAgICAgICAgIGRpc3Q6IGRpc3QkMiwKICAgICAgICAgICAgc3FyRGlzdDogc3FyRGlzdCQyLAogICAgICAgICAgICBsZW46IGxlbiQ0LAogICAgICAgICAgICBzcXJMZW46IHNxckxlbiQ0LAogICAgICAgICAgICBmb3JFYWNoOiBmb3JFYWNoJDIKICAgICAgICB9KTsKCiAgICAgICAgZnVuY3Rpb24gY3JlYXRlJDMoKSB7CiAgICAgICAgICAgIHZhciBvdXQgPQogICAgICAgICAgICAgICAgbmV3IEFSUkFZX1RZUEUoNCk7CiAgICAgICAgICAgIGlmIChBUlJBWV9UWVBFICE9IEZsb2F0MzJBcnJheSkgewogICAgICAgICAgICAgICAgb3V0WzBdID0gMDsKICAgICAgICAgICAgICAgIG91dFsxXSA9IDA7CiAgICAgICAgICAgICAgICBvdXRbMl0gPSAwOwogICAgICAgICAgICAgICAgb3V0WzNdID0gMAogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGNsb25lJDMoYSkgewogICAgICAgICAgICB2YXIgb3V0ID0gbmV3IEFSUkFZX1RZUEUoNCk7CiAgICAgICAgICAgIG91dFswXSA9IGFbMF07CiAgICAgICAgICAgIG91dFsxXSA9IGFbMV07CiAgICAgICAgICAgIG91dFsyXSA9IGFbMl07CiAgICAgICAgICAgIG91dFszXSA9IGFbM107CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGZyb21WYWx1ZXMkMyh4LCB5LCB6LCB3KSB7CiAgICAgICAgICAgIHZhciBvdXQgPSBuZXcgQVJSQVlfVFlQRSg0KTsKICAgICAgICAgICAgb3V0WzBdID0geDsKICAgICAgICAgICAgb3V0WzFdID0geTsKICAgICAgICAgICAgb3V0WzJdID0gejsKICAgICAgICAgICAgb3V0WzNdID0gdzsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gY29weSQzKG91dCwgYSkgewogICAgICAgICAgICBvdXRbMF0gPSBhWzBdOwogICAgICAgICAgICBvdXRbMV0gPSBhWzFdOwogICAgICAgICAgICBvdXRbMl0gPSBhWzJdOwogICAgICAgICAgICBvdXRbM10gPSBhWzNdOwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBzZXQkMyhvdXQsIHgsIHksIHosIHcpIHsKICAgICAgICAgICAgb3V0WzBdID0geDsKICAgICAgICAgICAgb3V0WzFdID0geTsKICAgICAgICAgICAgb3V0WzJdID0gejsKICAgICAgICAgICAgb3V0WzNdID0gdzsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gYWRkJDMob3V0LCBhLCBiKSB7CiAgICAgICAgICAgIG91dFswXSA9IGFbMF0gKyBiWzBdOwogICAgICAgICAgICBvdXRbMV0gPSBhWzFdICsgYlsxXTsKICAgICAgICAgICAgb3V0WzJdID0gYVsyXSArIGJbMl07CiAgICAgICAgICAgIG91dFszXSA9IGFbM10gKyBiWzNdOwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBzdWJ0cmFjdCQxKG91dCwgYSwgYikgewogICAgICAgICAgICBvdXRbMF0gPSBhWzBdIC0gYlswXTsKICAgICAgICAgICAgb3V0WzFdID0gYVsxXSAtIGJbMV07CiAgICAgICAgICAgIG91dFsyXSA9IGFbMl0gLSBiWzJdOwogICAgICAgICAgICBvdXRbM10gPSBhWzNdIC0gYlszXTsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gbXVsdGlwbHkkMyhvdXQsIGEsIGIpIHsKICAgICAgICAgICAgb3V0WzBdID0gYVswXSAqIGJbMF07CiAgICAgICAgICAgIG91dFsxXSA9IGFbMV0gKiBiWzFdOwogICAgICAgICAgICBvdXRbMl0gPSBhWzJdICogYlsyXTsKICAgICAgICAgICAgb3V0WzNdID0gYVszXSAqIGJbM107CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGRpdmlkZSQxKG91dCwgYSwgYikgewogICAgICAgICAgICBvdXRbMF0gPSBhWzBdIC8gYlswXTsKICAgICAgICAgICAgb3V0WzFdID0gYVsxXSAvIGJbMV07CiAgICAgICAgICAgIG91dFsyXSA9IGFbMl0gLyBiWzJdOwogICAgICAgICAgICBvdXRbM10gPSBhWzNdIC8gYlszXTsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gY2VpbCQxKG91dCwgYSkgewogICAgICAgICAgICBvdXRbMF0gPSBNYXRoLmNlaWwoYVswXSk7CiAgICAgICAgICAgIG91dFsxXSA9IE1hdGguY2VpbChhWzFdKTsKICAgICAgICAgICAgb3V0WzJdID0gTWF0aC5jZWlsKGFbMl0pOwogICAgICAgICAgICBvdXRbM10gPSBNYXRoLmNlaWwoYVszXSk7CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGZsb29yJDEob3V0LCBhKSB7CiAgICAgICAgICAgIG91dFswXSA9IE1hdGguZmxvb3IoYVswXSk7CiAgICAgICAgICAgIG91dFsxXSA9IE1hdGguZmxvb3IoYVsxXSk7CiAgICAgICAgICAgIG91dFsyXSA9IE1hdGguZmxvb3IoYVsyXSk7CiAgICAgICAgICAgIG91dFszXSA9IE1hdGguZmxvb3IoYVszXSk7CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIG1pbiQxKG91dCwgYSwgYikgewogICAgICAgICAgICBvdXRbMF0gPSBNYXRoLm1pbihhWzBdLCBiWzBdKTsKICAgICAgICAgICAgb3V0WzFdID0gTWF0aC5taW4oYVsxXSwgYlsxXSk7CiAgICAgICAgICAgIG91dFsyXSA9IE1hdGgubWluKGFbMl0sIGJbMl0pOwogICAgICAgICAgICBvdXRbM10gPSBNYXRoLm1pbihhWzNdLCBiWzNdKTsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gbWF4JDEob3V0LCBhLCBiKSB7CiAgICAgICAgICAgIG91dFswXSA9IE1hdGgubWF4KGFbMF0sIGJbMF0pOwogICAgICAgICAgICBvdXRbMV0gPSBNYXRoLm1heChhWzFdLCBiWzFdKTsKICAgICAgICAgICAgb3V0WzJdID0gTWF0aC5tYXgoYVsyXSwgYlsyXSk7CiAgICAgICAgICAgIG91dFszXSA9IE1hdGgubWF4KGFbM10sIGJbM10pOwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiByb3VuZCQxKG91dCwgYSkgewogICAgICAgICAgICBvdXRbMF0gPSBNYXRoLnJvdW5kKGFbMF0pOwogICAgICAgICAgICBvdXRbMV0gPSBNYXRoLnJvdW5kKGFbMV0pOwogICAgICAgICAgICBvdXRbMl0gPSBNYXRoLnJvdW5kKGFbMl0pOwogICAgICAgICAgICBvdXRbM10gPSBNYXRoLnJvdW5kKGFbM10pOwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBzY2FsZSQzKG91dCwgYSwgYikgewogICAgICAgICAgICBvdXRbMF0gPSBhWzBdICogYjsKICAgICAgICAgICAgb3V0WzFdID0gYVsxXSAqIGI7CiAgICAgICAgICAgIG91dFsyXSA9IGFbMl0gKiBiOwogICAgICAgICAgICBvdXRbM10gPSBhWzNdICogYjsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gc2NhbGVBbmRBZGQkMShvdXQsIGEsIGIsIHNjYWxlKSB7CiAgICAgICAgICAgIG91dFswXSA9IGFbMF0gKyBiWzBdICogc2NhbGU7CiAgICAgICAgICAgIG91dFsxXSA9IGFbMV0gKyBiWzFdICogc2NhbGU7CiAgICAgICAgICAgIG91dFsyXSA9IGFbMl0gKyBiWzJdICogc2NhbGU7CiAgICAgICAgICAgIG91dFszXSA9IGFbM10gKyBiWzNdICogc2NhbGU7CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGRpc3RhbmNlJDEoYSwgYikgewogICAgICAgICAgICB2YXIgeCA9IGJbMF0gLSBhWzBdOwogICAgICAgICAgICB2YXIgeSA9IGJbMV0gLSBhWzFdOwogICAgICAgICAgICB2YXIgeiA9IGJbMl0gLSBhWzJdOwogICAgICAgICAgICB2YXIgdyA9IGJbM10gLSBhWzNdOwogICAgICAgICAgICByZXR1cm4gTWF0aC5oeXBvdCh4LCB5LCB6LCB3KQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gc3F1YXJlZERpc3RhbmNlJDEoYSwgYikgewogICAgICAgICAgICB2YXIgeCA9IGJbMF0gLSBhWzBdOwogICAgICAgICAgICB2YXIgeSA9IGJbMV0gLSBhWzFdOwogICAgICAgICAgICB2YXIgeiA9IGJbMl0gLSBhWzJdOwogICAgICAgICAgICB2YXIgdyA9IGJbM10gLSBhWzNdOwogICAgICAgICAgICByZXR1cm4geCAqIHggKyB5ICogeSArIHogKiB6ICsgdyAqCiAgICAgICAgICAgICAgICB3CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBsZW5ndGgkMyhhKSB7CiAgICAgICAgICAgIHZhciB4ID0gYVswXTsKICAgICAgICAgICAgdmFyIHkgPSBhWzFdOwogICAgICAgICAgICB2YXIgeiA9IGFbMl07CiAgICAgICAgICAgIHZhciB3ID0gYVszXTsKICAgICAgICAgICAgcmV0dXJuIE1hdGguaHlwb3QoeCwgeSwgeiwgdykKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHNxdWFyZWRMZW5ndGgkMyhhKSB7CiAgICAgICAgICAgIHZhciB4ID0gYVswXTsKICAgICAgICAgICAgdmFyIHkgPSBhWzFdOwogICAgICAgICAgICB2YXIgeiA9IGFbMl07CiAgICAgICAgICAgIHZhciB3ID0gYVszXTsKICAgICAgICAgICAgcmV0dXJuIHggKiB4ICsgeSAqIHkgKyB6ICogeiArIHcgKiB3CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBuZWdhdGUkMShvdXQsIGEpIHsKICAgICAgICAgICAgb3V0WzBdID0gLWFbMF07CiAgICAgICAgICAgIG91dFsxXSA9IC1hWzFdOwogICAgICAgICAgICBvdXRbMl0gPSAtYVsyXTsKICAgICAgICAgICAgb3V0WzNdID0gLWFbM107CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGludmVyc2UkMShvdXQsIGEpIHsKICAgICAgICAgICAgb3V0WzBdID0gMSAvIGFbMF07CiAgICAgICAgICAgIG91dFsxXSA9IDEgLyBhWzFdOwogICAgICAgICAgICBvdXRbMl0gPSAxIC8gYVsyXTsKICAgICAgICAgICAgb3V0WzNdID0gMSAvIGFbM107CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIG5vcm1hbGl6ZSQzKG91dCwgYSkgewogICAgICAgICAgICB2YXIgeCA9IGFbMF07CiAgICAgICAgICAgIHZhciB5ID0gYVsxXTsKICAgICAgICAgICAgdmFyIHogPSBhWzJdOwogICAgICAgICAgICB2YXIgdyA9IGFbM107CiAgICAgICAgICAgIHZhciBsZW4gPSB4ICogeCArIHkgKiB5ICsgeiAqIHogKyB3ICogdzsKICAgICAgICAgICAgaWYgKGxlbiA+IDApIGxlbiA9IDEgLyBNYXRoLnNxcnQobGVuKTsKICAgICAgICAgICAgb3V0WzBdID0KICAgICAgICAgICAgICAgIHggKiBsZW47CiAgICAgICAgICAgIG91dFsxXSA9IHkgKiBsZW47CiAgICAgICAgICAgIG91dFsyXSA9IHogKiBsZW47CiAgICAgICAgICAgIG91dFszXSA9IHcgKiBsZW47CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGRvdCQzKGEsIGIpIHsKICAgICAgICAgICAgcmV0dXJuIGFbMF0gKiBiWzBdICsgYVsxXSAqIGJbMV0gKyBhWzJdICogYlsyXSArIGFbM10gKiBiWzNdCiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBjcm9zcyQxKG91dCwgdSwgdiwgdykgewogICAgICAgICAgICB2YXIgQSA9IHZbMF0gKiB3WzFdIC0gdlsxXSAqIHdbMF0sCiAgICAgICAgICAgICAgICBCID0gdlswXSAqIHdbMl0gLSB2WzJdICogd1swXSwKICAgICAgICAgICAgICAgIEMgPSB2WzBdICogd1szXSAtIHZbM10gKiB3WzBdLAogICAgICAgICAgICAgICAgRCA9IHZbMV0gKiB3WzJdIC0gdlsyXSAqIHdbMV0sCiAgICAgICAgICAgICAgICBFID0gdlsxXSAqIHdbM10gLSB2WzNdICogd1sxXSwKICAgICAgICAgICAgICAgIEYgPSB2WzJdICogd1szXSAtIHZbM10gKiB3WzJdOwogICAgICAgICAgICB2YXIgRyA9IHVbMF07CiAgICAgICAgICAgIHZhciBIID0gdVsxXTsKICAgICAgICAgICAgdmFyIEkgPSB1WzJdOwogICAgICAgICAgICB2YXIgSiA9IHVbM107CiAgICAgICAgICAgIG91dFswXSA9IEggKiBGIC0gSSAqIEUgKyBKICogRDsKICAgICAgICAgICAgb3V0WzFdID0gLShHICogRikgKyBJICogQyAtIEogKiBCOwogICAgICAgICAgICBvdXRbMl0gPSBHICogRSAtIEggKiBDICsgSiAqIEE7CiAgICAgICAgICAgIG91dFszXSA9IC0oRyAqIEQpICsgSCAqIEIgLSBJICogQTsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gbGVycCQzKG91dCwgYSwgYiwgdCkgewogICAgICAgICAgICB2YXIgYXggPSBhWzBdOwogICAgICAgICAgICB2YXIgYXkgPSBhWzFdOwogICAgICAgICAgICB2YXIgYXogPSBhWzJdOwogICAgICAgICAgICB2YXIgYXcgPSBhWzNdOwogICAgICAgICAgICBvdXRbMF0gPQogICAgICAgICAgICAgICAgYXggKyB0ICogKGJbMF0gLSBheCk7CiAgICAgICAgICAgIG91dFsxXSA9IGF5ICsgdCAqIChiWzFdIC0gYXkpOwogICAgICAgICAgICBvdXRbMl0gPSBheiArIHQgKiAoYlsyXSAtIGF6KTsKICAgICAgICAgICAgb3V0WzNdID0gYXcgKyB0ICogKGJbM10gLSBhdyk7CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHJhbmRvbSQyKG91dCwgc2NhbGUpIHsKICAgICAgICAgICAgc2NhbGUgPSBzY2FsZSB8fCAxOwogICAgICAgICAgICB2YXIgdjEsIHYyLCB2MywgdjQ7CiAgICAgICAgICAgIHZhciBzMSwgczI7CiAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgIHYxID0gUkFORE9NKCkgKiAyIC0gMTsKICAgICAgICAgICAgICAgIHYyID0gUkFORE9NKCkgKiAyIC0gMTsKICAgICAgICAgICAgICAgIHMxID0gdjEgKiB2MSArIHYyICogdjIKICAgICAgICAgICAgfSB3aGlsZSAoczEgPj0gMSk7CiAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgIHYzID0gUkFORE9NKCkgKiAyIC0gMTsKICAgICAgICAgICAgICAgIHY0ID0gUkFORE9NKCkgKiAyIC0gMTsKICAgICAgICAgICAgICAgIHMyID0gdjMgKiB2MyArIHY0ICogdjQKICAgICAgICAgICAgfSB3aGlsZSAoczIgPj0gMSk7CiAgICAgICAgICAgIHZhciBkID0gTWF0aC5zcXJ0KCgxIC0gczEpIC8gczIpOwogICAgICAgICAgICBvdXRbMF0gPSBzY2FsZSAqIHYxOwogICAgICAgICAgICBvdXRbMV0gPSBzY2FsZSAqIHYyOwogICAgICAgICAgICBvdXRbMl0gPSBzY2FsZSAqIHYzICogZDsKICAgICAgICAgICAgb3V0WzNdID0gc2NhbGUgKiB2NCAqIGQ7CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHRyYW5zZm9ybU1hdDQkMShvdXQsIGEsIG0pIHsKICAgICAgICAgICAgdmFyIHggPSBhWzBdLAogICAgICAgICAgICAgICAgeSA9IGFbMV0sCiAgICAgICAgICAgICAgICB6ID0gYVsyXSwKICAgICAgICAgICAgICAgIHcgPSBhWzNdOwogICAgICAgICAgICBvdXRbMF0gPSBtWzBdICogeCArIG1bNF0gKiB5ICsgbVs4XSAqIHogKyBtWzEyXSAqIHc7CiAgICAgICAgICAgIG91dFsxXSA9CiAgICAgICAgICAgICAgICBtWzFdICogeCArIG1bNV0gKiB5ICsgbVs5XSAqIHogKyBtWzEzXSAqIHc7CiAgICAgICAgICAgIG91dFsyXSA9IG1bMl0gKiB4ICsgbVs2XSAqIHkgKyBtWzEwXSAqIHogKyBtWzE0XSAqIHc7CiAgICAgICAgICAgIG91dFszXSA9IG1bM10gKiB4ICsgbVs3XSAqIHkgKyBtWzExXSAqIHogKyBtWzE1XSAqIHc7CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHRyYW5zZm9ybVF1YXQob3V0LCBhLCBxKSB7CiAgICAgICAgICAgIHZhciB4ID0gYVswXSwKICAgICAgICAgICAgICAgIHkgPSBhWzFdLAogICAgICAgICAgICAgICAgeiA9IGFbMl07CiAgICAgICAgICAgIHZhciBxeCA9IHFbMF0sCiAgICAgICAgICAgICAgICBxeSA9IHFbMV0sCiAgICAgICAgICAgICAgICBxeiA9IHFbMl0sCiAgICAgICAgICAgICAgICBxdyA9IHFbM107CiAgICAgICAgICAgIHZhciBpeCA9IHF3ICogeCArIHF5ICogeiAtIHF6ICogeTsKICAgICAgICAgICAgdmFyIGl5ID0gcXcgKiB5ICsgcXogKiB4IC0gcXggKiB6OwogICAgICAgICAgICB2YXIgaXogPSBxdyAqIHogKyBxeCAqIHkgLSBxeSAqIHg7CiAgICAgICAgICAgIHZhciBpdyA9IC1xeCAqIHggLSBxeSAqIHkgLSBxeiAqIHo7CiAgICAgICAgICAgIG91dFswXSA9IGl4ICogcXcgKyBpdyAqIC1xeCArIGl5ICogLXF6IC0gaXogKiAtcXk7CiAgICAgICAgICAgIG91dFsxXSA9IGl5ICogcXcgKyBpdyAqIC1xeSArIGl6ICogLXF4IC0gaXggKiAtcXo7CiAgICAgICAgICAgIG91dFsyXSA9IGl6ICogcXcgKyBpdyAqIC1xeiArIGl4ICogLXF5IC0gaXkgKiAtcXg7CiAgICAgICAgICAgIG91dFszXSA9IGFbM107CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHplcm8kMShvdXQpIHsKICAgICAgICAgICAgb3V0WzBdID0gMDsKICAgICAgICAgICAgb3V0WzFdID0gMDsKICAgICAgICAgICAgb3V0WzJdID0gMDsKICAgICAgICAgICAgb3V0WzNdID0gMDsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gc3RyJDMoYSkgewogICAgICAgICAgICByZXR1cm4gInZlYzQoIiArCiAgICAgICAgICAgICAgICBhWzBdICsgIiwgIiArIGFbMV0gKyAiLCAiICsgYVsyXSArICIsICIgKyBhWzNdICsgIikiCiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBleGFjdEVxdWFscyQzKGEsIGIpIHsKICAgICAgICAgICAgcmV0dXJuIGFbMF0gPT09IGJbMF0gJiYgYVsxXSA9PT0gYlsxXSAmJiBhWzJdID09PSBiWzJdICYmIGFbM10gPT09IGJbM10KICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGVxdWFscyQzKGEsIGIpIHsKICAgICAgICAgICAgdmFyIGEwID0gYVswXSwKICAgICAgICAgICAgICAgIGExID0gYVsxXSwKICAgICAgICAgICAgICAgIGEyID0gYVsyXSwKICAgICAgICAgICAgICAgIGEzID0gYVszXTsKICAgICAgICAgICAgdmFyIGIwID0gYlswXSwKICAgICAgICAgICAgICAgIGIxID0gYlsxXSwKICAgICAgICAgICAgICAgIGIyID0gYlsyXSwKICAgICAgICAgICAgICAgIGIzID0gYlszXTsKICAgICAgICAgICAgcmV0dXJuIE1hdGguYWJzKGEwIC0gYjApIDw9IEVQU0lMT04gKiBNYXRoLm1heCgxLCBNYXRoLmFicyhhMCksIE1hdGguYWJzKGIwKSkgJiYgTWF0aC5hYnMoYTEgLSBiMSkgPD0gRVBTSUxPTiAqIE1hdGgubWF4KDEsIE1hdGguYWJzKGExKSwgTWF0aC5hYnMoYjEpKSAmJiBNYXRoLmFicyhhMiAtIGIyKSA8PSBFUFNJTE9OICogTWF0aC5tYXgoMSwgTWF0aC5hYnMoYTIpLCBNYXRoLmFicyhiMikpICYmIE1hdGguYWJzKGEzIC0gYjMpIDw9IEVQU0lMT04gKiBNYXRoLm1heCgxLCBNYXRoLmFicyhhMyksIE1hdGguYWJzKGIzKSkKICAgICAgICB9CiAgICAgICAgdmFyIHN1YiQxID0gc3VidHJhY3QkMTsKICAgICAgICB2YXIgbXVsJDMgPSBtdWx0aXBseSQzOwogICAgICAgIHZhciBkaXYkMSA9IGRpdmlkZSQxOwogICAgICAgIHZhciBkaXN0JDEgPSBkaXN0YW5jZSQxOwogICAgICAgIHZhciBzcXJEaXN0JDEgPSBzcXVhcmVkRGlzdGFuY2UkMTsKICAgICAgICB2YXIgbGVuJDMgPSBsZW5ndGgkMzsKICAgICAgICB2YXIgc3FyTGVuJDMgPSBzcXVhcmVkTGVuZ3RoJDM7CiAgICAgICAgdmFyIGZvckVhY2gkMSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgdmVjID0gY3JlYXRlJDMoKTsKICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGEsIHN0cmlkZSwgb2Zmc2V0LCBjb3VudCwgZm4sIGFyZykgewogICAgICAgICAgICAgICAgdmFyIGksIGw7CiAgICAgICAgICAgICAgICBpZiAoIXN0cmlkZSkgc3RyaWRlID0gNDsKICAgICAgICAgICAgICAgIGlmICghb2Zmc2V0KSBvZmZzZXQgPSAwOwogICAgICAgICAgICAgICAgaWYgKGNvdW50KSBsID0gTWF0aC5taW4oY291bnQgKiBzdHJpZGUgKyBvZmZzZXQsIGEubGVuZ3RoKTsKICAgICAgICAgICAgICAgIGVsc2UgbCA9IGEubGVuZ3RoOwogICAgICAgICAgICAgICAgZm9yIChpID0gb2Zmc2V0OyBpIDwgbDsgaSArPSBzdHJpZGUpIHsKICAgICAgICAgICAgICAgICAgICB2ZWNbMF0gPSBhW2ldOwogICAgICAgICAgICAgICAgICAgIHZlY1sxXSA9IGFbaSArIDFdOwogICAgICAgICAgICAgICAgICAgIHZlY1syXSA9IGFbaSArIDJdOwogICAgICAgICAgICAgICAgICAgIHZlY1szXSA9IGFbaSArIDNdOwogICAgICAgICAgICAgICAgICAgIGZuKHZlYywgdmVjLCBhcmcpOwogICAgICAgICAgICAgICAgICAgIGFbaV0gPSB2ZWNbMF07CiAgICAgICAgICAgICAgICAgICAgYVtpICsgMV0gPSB2ZWNbMV07CiAgICAgICAgICAgICAgICAgICAgYVtpICsgMl0gPSB2ZWNbMl07CiAgICAgICAgICAgICAgICAgICAgYVtpICsgM10gPSB2ZWNbM10KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBhCiAgICAgICAgICAgIH0KICAgICAgICB9KCk7CiAgICAgICAgdmFyIHZlYzQgPSBPYmplY3QuZnJlZXplKHsKICAgICAgICAgICAgX19wcm90b19fOiBudWxsLAogICAgICAgICAgICBjcmVhdGU6IGNyZWF0ZSQzLAogICAgICAgICAgICBjbG9uZTogY2xvbmUkMywKICAgICAgICAgICAgZnJvbVZhbHVlczogZnJvbVZhbHVlcyQzLAogICAgICAgICAgICBjb3B5OiBjb3B5JDMsCiAgICAgICAgICAgIHNldDogc2V0JDMsCiAgICAgICAgICAgIGFkZDogYWRkJDMsCiAgICAgICAgICAgIHN1YnRyYWN0OiBzdWJ0cmFjdCQxLAogICAgICAgICAgICBtdWx0aXBseTogbXVsdGlwbHkkMywKICAgICAgICAgICAgZGl2aWRlOiBkaXZpZGUkMSwKICAgICAgICAgICAgY2VpbDogY2VpbCQxLAogICAgICAgICAgICBmbG9vcjogZmxvb3IkMSwKICAgICAgICAgICAgbWluOiBtaW4kMSwKICAgICAgICAgICAgbWF4OiBtYXgkMSwKICAgICAgICAgICAgcm91bmQ6IHJvdW5kJDEsCiAgICAgICAgICAgIHNjYWxlOiBzY2FsZSQzLAogICAgICAgICAgICBzY2FsZUFuZEFkZDogc2NhbGVBbmRBZGQkMSwKICAgICAgICAgICAgZGlzdGFuY2U6IGRpc3RhbmNlJDEsCiAgICAgICAgICAgIHNxdWFyZWREaXN0YW5jZTogc3F1YXJlZERpc3RhbmNlJDEsCiAgICAgICAgICAgIGxlbmd0aDogbGVuZ3RoJDMsCiAgICAgICAgICAgIHNxdWFyZWRMZW5ndGg6IHNxdWFyZWRMZW5ndGgkMywKICAgICAgICAgICAgbmVnYXRlOiBuZWdhdGUkMSwKICAgICAgICAgICAgaW52ZXJzZTogaW52ZXJzZSQxLAogICAgICAgICAgICBub3JtYWxpemU6IG5vcm1hbGl6ZSQzLAogICAgICAgICAgICBkb3Q6IGRvdCQzLAogICAgICAgICAgICBjcm9zczogY3Jvc3MkMSwKICAgICAgICAgICAgbGVycDogbGVycCQzLAogICAgICAgICAgICByYW5kb206IHJhbmRvbSQyLAogICAgICAgICAgICB0cmFuc2Zvcm1NYXQ0OiB0cmFuc2Zvcm1NYXQ0JDEsCiAgICAgICAgICAgIHRyYW5zZm9ybVF1YXQ6IHRyYW5zZm9ybVF1YXQsCiAgICAgICAgICAgIHplcm86IHplcm8kMSwKICAgICAgICAgICAgc3RyOiBzdHIkMywKICAgICAgICAgICAgZXhhY3RFcXVhbHM6IGV4YWN0RXF1YWxzJDMsCiAgICAgICAgICAgIGVxdWFsczogZXF1YWxzJDMsCiAgICAgICAgICAgIHN1Yjogc3ViJDEsCiAgICAgICAgICAgIG11bDogbXVsJDMsCiAgICAgICAgICAgIGRpdjogZGl2JDEsCiAgICAgICAgICAgIGRpc3Q6IGRpc3QkMSwKICAgICAgICAgICAgc3FyRGlzdDogc3FyRGlzdCQxLAogICAgICAgICAgICBsZW46IGxlbiQzLAogICAgICAgICAgICBzcXJMZW46IHNxckxlbiQzLAogICAgICAgICAgICBmb3JFYWNoOiBmb3JFYWNoJDEKICAgICAgICB9KTsKCiAgICAgICAgZnVuY3Rpb24gY3JlYXRlJDIoKSB7CiAgICAgICAgICAgIHZhciBvdXQgPSBuZXcgQVJSQVlfVFlQRSg0KTsKICAgICAgICAgICAgaWYgKEFSUkFZX1RZUEUgIT0gRmxvYXQzMkFycmF5KSB7CiAgICAgICAgICAgICAgICBvdXRbMF0gPSAwOwogICAgICAgICAgICAgICAgb3V0WzFdID0gMDsKICAgICAgICAgICAgICAgIG91dFsyXSA9IDAKICAgICAgICAgICAgfQogICAgICAgICAgICBvdXRbM10gPSAxOwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBpZGVudGl0eSQxKG91dCkgewogICAgICAgICAgICBvdXRbMF0gPSAwOwogICAgICAgICAgICBvdXRbMV0gPSAwOwogICAgICAgICAgICBvdXRbMl0gPSAwOwogICAgICAgICAgICBvdXRbM10gPSAxOwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBzZXRBeGlzQW5nbGUob3V0LCBheGlzLCByYWQpIHsKICAgICAgICAgICAgcmFkID0gcmFkICogLjU7CiAgICAgICAgICAgIHZhciBzID0gTWF0aC5zaW4ocmFkKTsKICAgICAgICAgICAgb3V0WzBdID0gcyAqIGF4aXNbMF07CiAgICAgICAgICAgIG91dFsxXSA9IHMgKiBheGlzWzFdOwogICAgICAgICAgICBvdXRbMl0gPSBzICoKICAgICAgICAgICAgICAgIGF4aXNbMl07CiAgICAgICAgICAgIG91dFszXSA9IE1hdGguY29zKHJhZCk7CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGdldEF4aXNBbmdsZShvdXRfYXhpcywgcSkgewogICAgICAgICAgICB2YXIgcmFkID0gTWF0aC5hY29zKHFbM10pICogMjsKICAgICAgICAgICAgdmFyIHMgPSBNYXRoLnNpbihyYWQgLyAyKTsKICAgICAgICAgICAgaWYgKHMgPiBFUFNJTE9OKSB7CiAgICAgICAgICAgICAgICBvdXRfYXhpc1swXSA9IHFbMF0gLyBzOwogICAgICAgICAgICAgICAgb3V0X2F4aXNbMV0gPSBxWzFdIC8gczsKICAgICAgICAgICAgICAgIG91dF9heGlzWzJdID0gcVsyXSAvIHMKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG91dF9heGlzWzBdID0gMTsKICAgICAgICAgICAgICAgIG91dF9heGlzWzFdID0gMDsKICAgICAgICAgICAgICAgIG91dF9heGlzWzJdID0gMAogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiByYWQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGdldEFuZ2xlKGEsIGIpIHsKICAgICAgICAgICAgdmFyIGRvdHByb2R1Y3QgPSBkb3QkMihhLCBiKTsKICAgICAgICAgICAgcmV0dXJuIE1hdGguYWNvcygyICogZG90cHJvZHVjdCAqIGRvdHByb2R1Y3QgLSAxKQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gbXVsdGlwbHkkMihvdXQsIGEsIGIpIHsKICAgICAgICAgICAgdmFyIGF4ID0gYVswXSwKICAgICAgICAgICAgICAgIGF5ID0gYVsxXSwKICAgICAgICAgICAgICAgIGF6ID0gYVsyXSwKICAgICAgICAgICAgICAgIGF3ID0gYVszXTsKICAgICAgICAgICAgdmFyIGJ4ID0gYlswXSwKICAgICAgICAgICAgICAgIGJ5ID0gYlsxXSwKICAgICAgICAgICAgICAgIGJ6ID0gYlsyXSwKICAgICAgICAgICAgICAgIGJ3ID0gYlszXTsKICAgICAgICAgICAgb3V0WzBdID0gYXggKiBidyArIGF3ICogYnggKyBheSAqIGJ6IC0gYXogKiBieTsKICAgICAgICAgICAgb3V0WzFdID0gYXkgKiBidyArIGF3ICogYnkgKyBheiAqIGJ4IC0KICAgICAgICAgICAgICAgIGF4ICogYno7CiAgICAgICAgICAgIG91dFsyXSA9IGF6ICogYncgKyBhdyAqIGJ6ICsgYXggKiBieSAtIGF5ICogYng7CiAgICAgICAgICAgIG91dFszXSA9IGF3ICogYncgLSBheCAqIGJ4IC0gYXkgKiBieSAtIGF6ICogYno7CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHJvdGF0ZVgkMShvdXQsIGEsIHJhZCkgewogICAgICAgICAgICByYWQgKj0gLjU7CiAgICAgICAgICAgIHZhciBheCA9IGFbMF0sCiAgICAgICAgICAgICAgICBheSA9IGFbMV0sCiAgICAgICAgICAgICAgICBheiA9IGFbMl0sCiAgICAgICAgICAgICAgICBhdyA9IGFbM107CiAgICAgICAgICAgIHZhciBieCA9IE1hdGguc2luKHJhZCksCiAgICAgICAgICAgICAgICBidyA9IE1hdGguY29zKHJhZCk7CiAgICAgICAgICAgIG91dFswXSA9IGF4ICogYncgKyBhdyAqIGJ4OwogICAgICAgICAgICBvdXRbMV0gPSBheSAqIGJ3ICsgYXogKiBieDsKICAgICAgICAgICAgb3V0WzJdID0gYXogKiBidyAtIGF5ICogYng7CiAgICAgICAgICAgIG91dFszXSA9IGF3ICogYncgLSBheCAqIGJ4OwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiByb3RhdGVZJDEob3V0LCBhLCByYWQpIHsKICAgICAgICAgICAgcmFkICo9IC41OwogICAgICAgICAgICB2YXIgYXggPSBhWzBdLAogICAgICAgICAgICAgICAgYXkgPSBhWzFdLAogICAgICAgICAgICAgICAgYXogPSBhWzJdLAogICAgICAgICAgICAgICAgYXcgPSBhWzNdOwogICAgICAgICAgICB2YXIgYnkgPSBNYXRoLnNpbihyYWQpLAogICAgICAgICAgICAgICAgYncgPSBNYXRoLmNvcyhyYWQpOwogICAgICAgICAgICBvdXRbMF0gPSBheCAqIGJ3IC0gYXogKiBieTsKICAgICAgICAgICAgb3V0WzFdID0gYXkgKiBidyArIGF3ICogYnk7CiAgICAgICAgICAgIG91dFsyXSA9IGF6ICogYncgKyBheCAqIGJ5OwogICAgICAgICAgICBvdXRbM10gPSBhdyAqIGJ3IC0gYXkgKiBieTsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gcm90YXRlWiQxKG91dCwgYSwKICAgICAgICAgICAgcmFkKSB7CiAgICAgICAgICAgIHJhZCAqPSAuNTsKICAgICAgICAgICAgdmFyIGF4ID0gYVswXSwKICAgICAgICAgICAgICAgIGF5ID0gYVsxXSwKICAgICAgICAgICAgICAgIGF6ID0gYVsyXSwKICAgICAgICAgICAgICAgIGF3ID0gYVszXTsKICAgICAgICAgICAgdmFyIGJ6ID0gTWF0aC5zaW4ocmFkKSwKICAgICAgICAgICAgICAgIGJ3ID0gTWF0aC5jb3MocmFkKTsKICAgICAgICAgICAgb3V0WzBdID0gYXggKiBidyArIGF5ICogYno7CiAgICAgICAgICAgIG91dFsxXSA9IGF5ICogYncgLSBheCAqIGJ6OwogICAgICAgICAgICBvdXRbMl0gPSBheiAqIGJ3ICsgYXcgKiBiejsKICAgICAgICAgICAgb3V0WzNdID0gYXcgKiBidyAtIGF6ICogYno7CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZVcob3V0LCBhKSB7CiAgICAgICAgICAgIHZhciB4ID0gYVswXSwKICAgICAgICAgICAgICAgIHkgPSBhWzFdLAogICAgICAgICAgICAgICAgeiA9IGFbMl07CiAgICAgICAgICAgIG91dFswXSA9IHg7CiAgICAgICAgICAgIG91dFsxXSA9IHk7CiAgICAgICAgICAgIG91dFsyXSA9IHo7CiAgICAgICAgICAgIG91dFszXSA9IE1hdGguc3FydChNYXRoLmFicygxIC0geCAqIHggLSB5ICogeSAtIHogKiB6KSk7CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGV4cChvdXQsIGEpIHsKICAgICAgICAgICAgdmFyIHggPSBhWzBdLAogICAgICAgICAgICAgICAgeSA9IGFbMV0sCiAgICAgICAgICAgICAgICB6ID0gYVsyXSwKICAgICAgICAgICAgICAgIHcgPSBhWzNdOwogICAgICAgICAgICB2YXIgciA9IE1hdGguc3FydCh4ICogeCArIHkgKiB5ICsgeiAqIHopOwogICAgICAgICAgICB2YXIgZXQgPSBNYXRoLmV4cCh3KTsKICAgICAgICAgICAgdmFyIHMgPSByID4gMCA/IGV0ICogTWF0aC5zaW4ocikgLyByIDogMDsKICAgICAgICAgICAgb3V0WzBdID0geCAqIHM7CiAgICAgICAgICAgIG91dFsxXSA9IHkgKiBzOwogICAgICAgICAgICBvdXRbMl0gPSB6ICogczsKICAgICAgICAgICAgb3V0WzNdID0gZXQgKiBNYXRoLmNvcyhyKTsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gbG4ob3V0LCBhKSB7CiAgICAgICAgICAgIHZhciB4ID0gYVswXSwKICAgICAgICAgICAgICAgIHkgPSBhWzFdLAogICAgICAgICAgICAgICAgeiA9IGFbMl0sCiAgICAgICAgICAgICAgICB3ID0gYVszXTsKICAgICAgICAgICAgdmFyIHIgPSBNYXRoLnNxcnQoeCAqIHggKyB5ICogeSArIHogKiB6KTsKICAgICAgICAgICAgdmFyIHQgPSByID4gMCA/IE1hdGguYXRhbjIociwgdykgLyByIDogMDsKICAgICAgICAgICAgb3V0WzBdID0geCAqIHQ7CiAgICAgICAgICAgIG91dFsxXSA9IHkgKiB0OwogICAgICAgICAgICBvdXRbMl0gPSB6ICogdDsKICAgICAgICAgICAgb3V0WzNdID0gLjUgKiBNYXRoLmxvZyh4ICogeCArIHkgKiB5ICsgeiAqIHogKyB3ICogdyk7CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHBvdyhvdXQsIGEsIGIpIHsKICAgICAgICAgICAgbG4ob3V0LCBhKTsKICAgICAgICAgICAgc2NhbGUkMihvdXQsIG91dCwgYik7CiAgICAgICAgICAgIGV4cChvdXQsIG91dCk7CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHNsZXJwKG91dCwgYSwgYiwgdCkgewogICAgICAgICAgICB2YXIgYXggPSBhWzBdLAogICAgICAgICAgICAgICAgYXkgPSBhWzFdLAogICAgICAgICAgICAgICAgYXogPSBhWzJdLAogICAgICAgICAgICAgICAgYXcgPSBhWzNdOwogICAgICAgICAgICB2YXIgYnggPSBiWzBdLAogICAgICAgICAgICAgICAgYnkgPSBiWzFdLAogICAgICAgICAgICAgICAgYnogPSBiWzJdLAogICAgICAgICAgICAgICAgYncgPSBiWzNdOwogICAgICAgICAgICB2YXIgb21lZ2EsIGNvc29tLCBzaW5vbSwgc2NhbGUwLCBzY2FsZTE7CiAgICAgICAgICAgIGNvc29tID0gYXggKiBieCArIGF5ICogYnkgKyBheiAqIGJ6ICsgYXcgKiBidzsKICAgICAgICAgICAgaWYgKGNvc29tIDwgMCkgewogICAgICAgICAgICAgICAgY29zb20gPSAtY29zb207CiAgICAgICAgICAgICAgICBieCA9IC1ieDsKICAgICAgICAgICAgICAgIGJ5ID0gLWJ5OwogICAgICAgICAgICAgICAgYnogPSAtYno7CiAgICAgICAgICAgICAgICBidyA9IC1idwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgxIC0gY29zb20gPiBFUFNJTE9OKSB7CiAgICAgICAgICAgICAgICBvbWVnYSA9CiAgICAgICAgICAgICAgICAgICAgTWF0aC5hY29zKGNvc29tKTsKICAgICAgICAgICAgICAgIHNpbm9tID0gTWF0aC5zaW4ob21lZ2EpOwogICAgICAgICAgICAgICAgc2NhbGUwID0gTWF0aC5zaW4oKDEgLSB0KSAqIG9tZWdhKSAvIHNpbm9tOwogICAgICAgICAgICAgICAgc2NhbGUxID0gTWF0aC5zaW4odCAqIG9tZWdhKSAvIHNpbm9tCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBzY2FsZTAgPSAxIC0gdDsKICAgICAgICAgICAgICAgIHNjYWxlMSA9IHQKICAgICAgICAgICAgfQogICAgICAgICAgICBvdXRbMF0gPSBzY2FsZTAgKiBheCArIHNjYWxlMSAqIGJ4OwogICAgICAgICAgICBvdXRbMV0gPSBzY2FsZTAgKiBheSArIHNjYWxlMSAqIGJ5OwogICAgICAgICAgICBvdXRbMl0gPSBzY2FsZTAgKiBheiArIHNjYWxlMSAqIGJ6OwogICAgICAgICAgICBvdXRbM10gPSBzY2FsZTAgKiBhdyArIHNjYWxlMSAqIGJ3OwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiByYW5kb20kMShvdXQpIHsKICAgICAgICAgICAgdmFyIHUxID0gUkFORE9NKCk7CiAgICAgICAgICAgIHZhciB1MiA9IFJBTkRPTSgpOwogICAgICAgICAgICB2YXIgdTMgPSBSQU5ET00oKTsKICAgICAgICAgICAgdmFyIHNxcnQxTWludXNVMSA9IE1hdGguc3FydCgxIC0gdTEpOwogICAgICAgICAgICB2YXIgc3FydFUxID0gTWF0aC5zcXJ0KHUxKTsKICAgICAgICAgICAgb3V0WzBdID0gc3FydDFNaW51c1UxICogTWF0aC5zaW4oMiAqIE1hdGguUEkgKiB1Mik7CiAgICAgICAgICAgIG91dFsxXSA9IHNxcnQxTWludXNVMSAqIE1hdGguY29zKDIgKiBNYXRoLlBJICogdTIpOwogICAgICAgICAgICBvdXRbMl0gPSBzcXJ0VTEgKiBNYXRoLnNpbigyICogTWF0aC5QSSAqIHUzKTsKICAgICAgICAgICAgb3V0WzNdID0gc3FydFUxICogTWF0aC5jb3MoMiAqIE1hdGguUEkgKiB1Myk7CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGludmVydCQxKG91dCwgYSkgewogICAgICAgICAgICB2YXIgYTAgPSBhWzBdLAogICAgICAgICAgICAgICAgYTEgPSBhWzFdLAogICAgICAgICAgICAgICAgYTIgPSBhWzJdLAogICAgICAgICAgICAgICAgYTMgPSBhWzNdOwogICAgICAgICAgICB2YXIgZG90ID0gYTAgKiBhMCArIGExICogYTEgKyBhMiAqIGEyICsgYTMgKiBhMzsKICAgICAgICAgICAgdmFyIGludkRvdCA9IGRvdCA/IDEgLyBkb3QgOiAwOwogICAgICAgICAgICBvdXRbMF0gPSAtYTAgKiBpbnZEb3Q7CiAgICAgICAgICAgIG91dFsxXSA9IC1hMSAqIGludkRvdDsKICAgICAgICAgICAgb3V0WzJdID0gLWEyICogaW52RG90OwogICAgICAgICAgICBvdXRbM10gPSBhMyAqIGludkRvdDsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gY29uanVnYXRlJDEob3V0LCBhKSB7CiAgICAgICAgICAgIG91dFswXSA9IC1hWzBdOwogICAgICAgICAgICBvdXRbMV0gPSAtYVsxXTsKICAgICAgICAgICAgb3V0WzJdID0gLWFbMl07CiAgICAgICAgICAgIG91dFszXSA9IGFbM107CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGZyb21NYXQzKG91dCwgbSkgewogICAgICAgICAgICB2YXIgZlRyYWNlID0gbVswXSArIG1bNF0gKyBtWzhdOwogICAgICAgICAgICB2YXIgZlJvb3Q7CiAgICAgICAgICAgIGlmIChmVHJhY2UgPiAwKSB7CiAgICAgICAgICAgICAgICBmUm9vdCA9IE1hdGguc3FydChmVHJhY2UgKyAxKTsKICAgICAgICAgICAgICAgIG91dFszXSA9IC41ICogZlJvb3Q7CiAgICAgICAgICAgICAgICBmUm9vdCA9IC41IC8gZlJvb3Q7CiAgICAgICAgICAgICAgICBvdXRbMF0gPSAobVs1XSAtIG1bN10pICogZlJvb3Q7CiAgICAgICAgICAgICAgICBvdXRbMV0gPSAobVs2XSAtCiAgICAgICAgICAgICAgICAgICAgbVsyXSkgKiBmUm9vdDsKICAgICAgICAgICAgICAgIG91dFsyXSA9IChtWzFdIC0gbVszXSkgKiBmUm9vdAogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdmFyIGkgPSAwOwogICAgICAgICAgICAgICAgaWYgKG1bNF0gPiBtWzBdKSBpID0gMTsKICAgICAgICAgICAgICAgIGlmIChtWzhdID4gbVtpICogMyArIGldKSBpID0gMjsKICAgICAgICAgICAgICAgIHZhciBqID0gKGkgKyAxKSAlIDM7CiAgICAgICAgICAgICAgICB2YXIgayA9IChpICsgMikgJSAzOwogICAgICAgICAgICAgICAgZlJvb3QgPSBNYXRoLnNxcnQobVtpICogMyArIGldIC0gbVtqICogMyArIGpdIC0gbVtrICogMyArIGtdICsgMSk7CiAgICAgICAgICAgICAgICBvdXRbaV0gPSAuNSAqIGZSb290OwogICAgICAgICAgICAgICAgZlJvb3QgPSAuNSAvIGZSb290OwogICAgICAgICAgICAgICAgb3V0WzNdID0gKG1baiAqIDMgKyBrXSAtIG1bayAqIDMgKyBqXSkgKiBmUm9vdDsKICAgICAgICAgICAgICAgIG91dFtqXSA9IChtW2ogKiAzICsgaV0gKyBtW2kgKiAzICsgal0pICogZlJvb3Q7CiAgICAgICAgICAgICAgICBvdXRba10gPSAobVtrICogMyArIGldICsgbVtpICogMyArIGtdKSAqIGZSb290CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZnJvbUV1bGVyKG91dCwgeCwgeSwgeikgewogICAgICAgICAgICB2YXIgb3JkZXIgPSBhcmd1bWVudHMubGVuZ3RoID4gNCAmJiBhcmd1bWVudHNbNF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1s0XSA6IEFOR0xFX09SREVSOwogICAgICAgICAgICB2YXIgaGFsZlRvUmFkID0gTWF0aC5QSSAvIDM2MDsKICAgICAgICAgICAgeCAqPSBoYWxmVG9SYWQ7CiAgICAgICAgICAgIHogKj0gaGFsZlRvUmFkOwogICAgICAgICAgICB5ICo9IGhhbGZUb1JhZDsKICAgICAgICAgICAgdmFyIHN4ID0gTWF0aC5zaW4oeCk7CiAgICAgICAgICAgIHZhciBjeCA9CiAgICAgICAgICAgICAgICBNYXRoLmNvcyh4KTsKICAgICAgICAgICAgdmFyIHN5ID0gTWF0aC5zaW4oeSk7CiAgICAgICAgICAgIHZhciBjeSA9IE1hdGguY29zKHkpOwogICAgICAgICAgICB2YXIgc3ogPSBNYXRoLnNpbih6KTsKICAgICAgICAgICAgdmFyIGN6ID0gTWF0aC5jb3Moeik7CiAgICAgICAgICAgIHN3aXRjaCAob3JkZXIpIHsKICAgICAgICAgICAgICAgIGNhc2UgInh5eiI6CiAgICAgICAgICAgICAgICAgICAgb3V0WzBdID0gc3ggKiBjeSAqIGN6ICsgY3ggKiBzeSAqIHN6OwogICAgICAgICAgICAgICAgICAgIG91dFsxXSA9IGN4ICogc3kgKiBjeiAtIHN4ICogY3kgKiBzejsKICAgICAgICAgICAgICAgICAgICBvdXRbMl0gPSBjeCAqIGN5ICogc3ogKyBzeCAqIHN5ICogY3o7CiAgICAgICAgICAgICAgICAgICAgb3V0WzNdID0gY3ggKiBjeSAqIGN6IC0gc3ggKiBzeSAqIHN6OwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAieHp5IjoKICAgICAgICAgICAgICAgICAgICBvdXRbMF0gPSBzeCAqIGN5ICogY3ogLSBjeCAqIHN5ICogc3o7CiAgICAgICAgICAgICAgICAgICAgb3V0WzFdID0gY3ggKiBzeSAqIGN6IC0gc3ggKiBjeSAqIHN6OwogICAgICAgICAgICAgICAgICAgIG91dFsyXSA9IGN4ICogY3kgKiBzeiArIHN4ICogc3kgKiBjejsKICAgICAgICAgICAgICAgICAgICBvdXRbM10gPSBjeCAqIGN5ICogY3ogKyBzeCAqIHN5ICogc3o7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICJ5eHoiOgogICAgICAgICAgICAgICAgICAgIG91dFswXSA9IHN4ICogY3kgKiBjeiArIGN4ICogc3kgKiBzejsKICAgICAgICAgICAgICAgICAgICBvdXRbMV0gPSBjeCAqIHN5ICogY3ogLSBzeCAqIGN5ICogc3o7CiAgICAgICAgICAgICAgICAgICAgb3V0WzJdID0gY3ggKiBjeSAqIHN6IC0gc3ggKiBzeSAqIGN6OwogICAgICAgICAgICAgICAgICAgIG91dFszXSA9IGN4ICogY3kgKiBjeiArIHN4ICogc3kgKiBzejsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgInl6eCI6CiAgICAgICAgICAgICAgICAgICAgb3V0WzBdID0gc3ggKiBjeSAqIGN6ICsgY3ggKiBzeSAqIHN6OwogICAgICAgICAgICAgICAgICAgIG91dFsxXSA9IGN4ICogc3kgKgogICAgICAgICAgICAgICAgICAgICAgICBjeiArIHN4ICogY3kgKiBzejsKICAgICAgICAgICAgICAgICAgICBvdXRbMl0gPSBjeCAqIGN5ICogc3ogLSBzeCAqIHN5ICogY3o7CiAgICAgICAgICAgICAgICAgICAgb3V0WzNdID0gY3ggKiBjeSAqIGN6IC0gc3ggKiBzeSAqIHN6OwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAienh5IjoKICAgICAgICAgICAgICAgICAgICBvdXRbMF0gPSBzeCAqIGN5ICogY3ogLSBjeCAqIHN5ICogc3o7CiAgICAgICAgICAgICAgICAgICAgb3V0WzFdID0gY3ggKiBzeSAqIGN6ICsgc3ggKiBjeSAqIHN6OwogICAgICAgICAgICAgICAgICAgIG91dFsyXSA9IGN4ICogY3kgKiBzeiArIHN4ICogc3kgKiBjejsKICAgICAgICAgICAgICAgICAgICBvdXRbM10gPSBjeCAqIGN5ICogY3ogLSBzeCAqIHN5ICogc3o7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICJ6eXgiOgogICAgICAgICAgICAgICAgICAgIG91dFswXSA9IHN4ICogY3kgKiBjeiAtIGN4ICogc3kgKiBzejsKICAgICAgICAgICAgICAgICAgICBvdXRbMV0gPSBjeCAqIHN5ICogY3ogKyBzeCAqIGN5ICogc3o7CiAgICAgICAgICAgICAgICAgICAgb3V0WzJdID0gY3ggKiBjeSAqIHN6IC0gc3ggKiBzeSAqIGN6OwogICAgICAgICAgICAgICAgICAgIG91dFszXSA9IGN4ICogY3kgKiBjeiArIHN4ICogc3kgKiBzejsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJVbmtub3duIGFuZ2xlIG9yZGVyICIgKyBvcmRlcik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gc3RyJDIoYSkgewogICAgICAgICAgICByZXR1cm4gInF1YXQoIiArIGFbMF0gKyAiLCAiICsgYVsxXSArICIsICIgKyBhWzJdICsgIiwgIiArIGFbM10gKyAiKSIKICAgICAgICB9CiAgICAgICAgdmFyIGNsb25lJDIgPSBjbG9uZSQzOwogICAgICAgIHZhciBmcm9tVmFsdWVzJDIgPSBmcm9tVmFsdWVzJDM7CiAgICAgICAgdmFyIGNvcHkkMiA9IGNvcHkkMzsKICAgICAgICB2YXIgc2V0JDIgPSBzZXQkMzsKICAgICAgICB2YXIgYWRkJDIgPSBhZGQkMzsKICAgICAgICB2YXIgbXVsJDIgPSBtdWx0aXBseSQyOwogICAgICAgIHZhciBzY2FsZSQyID0gc2NhbGUkMzsKICAgICAgICB2YXIgZG90JDIgPSBkb3QkMzsKICAgICAgICB2YXIgbGVycCQyID0gbGVycCQzOwogICAgICAgIHZhciBsZW5ndGgkMiA9IGxlbmd0aCQzOwogICAgICAgIHZhciBsZW4kMiA9IGxlbmd0aCQyOwogICAgICAgIHZhciBzcXVhcmVkTGVuZ3RoJDIgPSBzcXVhcmVkTGVuZ3RoJDM7CiAgICAgICAgdmFyIHNxckxlbiQyID0gc3F1YXJlZExlbmd0aCQyOwogICAgICAgIHZhciBub3JtYWxpemUkMiA9IG5vcm1hbGl6ZSQzOwogICAgICAgIHZhciBleGFjdEVxdWFscyQyID0gZXhhY3RFcXVhbHMkMzsKCiAgICAgICAgZnVuY3Rpb24gZXF1YWxzJDIoYSwgYikgewogICAgICAgICAgICByZXR1cm4gTWF0aC5hYnMoZG90JDMoYSwgYikpID49IDEgLSBFUFNJTE9OCiAgICAgICAgfQogICAgICAgIHZhciByb3RhdGlvblRvID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciB0bXB2ZWMzID0gY3JlYXRlJDQoKTsKICAgICAgICAgICAgdmFyIHhVbml0VmVjMyA9IGZyb21WYWx1ZXMkNCgxLCAwLCAwKTsKICAgICAgICAgICAgdmFyIHlVbml0VmVjMyA9IGZyb21WYWx1ZXMkNCgwLCAxLCAwKTsKICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKG91dCwgYSwgYikgewogICAgICAgICAgICAgICAgdmFyIGRvdCA9IGRvdCQ0KGEsIGIpOwogICAgICAgICAgICAgICAgaWYgKGRvdCA8CiAgICAgICAgICAgICAgICAgICAgLS45OTk5OTkpIHsKICAgICAgICAgICAgICAgICAgICBjcm9zcyQyKHRtcHZlYzMsIHhVbml0VmVjMywgYSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGxlbiQ0KHRtcHZlYzMpIDwgMUUtNikgY3Jvc3MkMih0bXB2ZWMzLCB5VW5pdFZlYzMsIGEpOwogICAgICAgICAgICAgICAgICAgIG5vcm1hbGl6ZSQ0KHRtcHZlYzMsIHRtcHZlYzMpOwogICAgICAgICAgICAgICAgICAgIHNldEF4aXNBbmdsZShvdXQsIHRtcHZlYzMsIE1hdGguUEkpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZG90ID4gLjk5OTk5OSkgewogICAgICAgICAgICAgICAgICAgIG91dFswXSA9IDA7CiAgICAgICAgICAgICAgICAgICAgb3V0WzFdID0gMDsKICAgICAgICAgICAgICAgICAgICBvdXRbMl0gPSAwOwogICAgICAgICAgICAgICAgICAgIG91dFszXSA9IDE7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBjcm9zcyQyKHRtcHZlYzMsIGEsIGIpOwogICAgICAgICAgICAgICAgICAgIG91dFswXSA9IHRtcHZlYzNbMF07CiAgICAgICAgICAgICAgICAgICAgb3V0WzFdID0gdG1wdmVjM1sxXTsKICAgICAgICAgICAgICAgICAgICBvdXRbMl0gPSB0bXB2ZWMzWzJdOwogICAgICAgICAgICAgICAgICAgIG91dFszXSA9IDEgKyBkb3Q7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5vcm1hbGl6ZSQyKG91dCwgb3V0KQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSgpOwogICAgICAgIHZhciBzcWxlcnAgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIHRlbXAxID0gY3JlYXRlJDIoKTsKICAgICAgICAgICAgdmFyIHRlbXAyID0gY3JlYXRlJDIoKTsKICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKG91dCwgYSwgYiwgYywgZCwgdCkgewogICAgICAgICAgICAgICAgc2xlcnAodGVtcDEsIGEsIGQsIHQpOwogICAgICAgICAgICAgICAgc2xlcnAodGVtcDIsIGIsIGMsIHQpOwogICAgICAgICAgICAgICAgc2xlcnAob3V0LAogICAgICAgICAgICAgICAgICAgIHRlbXAxLCB0ZW1wMiwgMiAqIHQgKiAoMSAtIHQpKTsKICAgICAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICAgICAgfQogICAgICAgIH0oKTsKICAgICAgICB2YXIgc2V0QXhlcyA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgbWF0ciA9IGNyZWF0ZSQ2KCk7CiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbihvdXQsIHZpZXcsIHJpZ2h0LCB1cCkgewogICAgICAgICAgICAgICAgbWF0clswXSA9IHJpZ2h0WzBdOwogICAgICAgICAgICAgICAgbWF0clszXSA9IHJpZ2h0WzFdOwogICAgICAgICAgICAgICAgbWF0cls2XSA9IHJpZ2h0WzJdOwogICAgICAgICAgICAgICAgbWF0clsxXSA9IHVwWzBdOwogICAgICAgICAgICAgICAgbWF0cls0XSA9IHVwWzFdOwogICAgICAgICAgICAgICAgbWF0cls3XSA9IHVwWzJdOwogICAgICAgICAgICAgICAgbWF0clsyXSA9IC12aWV3WzBdOwogICAgICAgICAgICAgICAgbWF0cls1XSA9IC12aWV3WzFdOwogICAgICAgICAgICAgICAgbWF0cls4XSA9IC12aWV3WzJdOwogICAgICAgICAgICAgICAgcmV0dXJuIG5vcm1hbGl6ZSQyKG91dCwgZnJvbU1hdDMob3V0LCBtYXRyKSkKICAgICAgICAgICAgfQogICAgICAgIH0oKTsKICAgICAgICB2YXIgcXVhdCA9IE9iamVjdC5mcmVlemUoewogICAgICAgICAgICBfX3Byb3RvX186IG51bGwsCiAgICAgICAgICAgIGNyZWF0ZTogY3JlYXRlJDIsCiAgICAgICAgICAgIGlkZW50aXR5OiBpZGVudGl0eSQxLAogICAgICAgICAgICBzZXRBeGlzQW5nbGU6IHNldEF4aXNBbmdsZSwKICAgICAgICAgICAgZ2V0QXhpc0FuZ2xlOiBnZXRBeGlzQW5nbGUsCiAgICAgICAgICAgIGdldEFuZ2xlOiBnZXRBbmdsZSwKICAgICAgICAgICAgbXVsdGlwbHk6IG11bHRpcGx5JDIsCiAgICAgICAgICAgIHJvdGF0ZVg6IHJvdGF0ZVgkMSwKICAgICAgICAgICAgcm90YXRlWTogcm90YXRlWSQxLAogICAgICAgICAgICByb3RhdGVaOiByb3RhdGVaJDEsCiAgICAgICAgICAgIGNhbGN1bGF0ZVc6IGNhbGN1bGF0ZVcsCiAgICAgICAgICAgIGV4cDogZXhwLAogICAgICAgICAgICBsbjogbG4sCiAgICAgICAgICAgIHBvdzogcG93LAogICAgICAgICAgICBzbGVycDogc2xlcnAsCiAgICAgICAgICAgIHJhbmRvbTogcmFuZG9tJDEsCiAgICAgICAgICAgIGludmVydDogaW52ZXJ0JDEsCiAgICAgICAgICAgIGNvbmp1Z2F0ZTogY29uanVnYXRlJDEsCiAgICAgICAgICAgIGZyb21NYXQzOiBmcm9tTWF0MywKICAgICAgICAgICAgZnJvbUV1bGVyOiBmcm9tRXVsZXIsCiAgICAgICAgICAgIHN0cjogc3RyJDIsCiAgICAgICAgICAgIGNsb25lOiBjbG9uZSQyLAogICAgICAgICAgICBmcm9tVmFsdWVzOiBmcm9tVmFsdWVzJDIsCiAgICAgICAgICAgIGNvcHk6IGNvcHkkMiwKICAgICAgICAgICAgc2V0OiBzZXQkMiwKICAgICAgICAgICAgYWRkOiBhZGQkMiwKICAgICAgICAgICAgbXVsOiBtdWwkMiwKICAgICAgICAgICAgc2NhbGU6IHNjYWxlJDIsCiAgICAgICAgICAgIGRvdDogZG90JDIsCiAgICAgICAgICAgIGxlcnA6IGxlcnAkMiwKICAgICAgICAgICAgbGVuZ3RoOiBsZW5ndGgkMiwKICAgICAgICAgICAgbGVuOiBsZW4kMiwKICAgICAgICAgICAgc3F1YXJlZExlbmd0aDogc3F1YXJlZExlbmd0aCQyLAogICAgICAgICAgICBzcXJMZW46IHNxckxlbiQyLAogICAgICAgICAgICBub3JtYWxpemU6IG5vcm1hbGl6ZSQyLAogICAgICAgICAgICBleGFjdEVxdWFsczogZXhhY3RFcXVhbHMkMiwKICAgICAgICAgICAgZXF1YWxzOiBlcXVhbHMkMiwKICAgICAgICAgICAgcm90YXRpb25Ubzogcm90YXRpb25UbywKICAgICAgICAgICAgc3FsZXJwOiBzcWxlcnAsCiAgICAgICAgICAgIHNldEF4ZXM6IHNldEF4ZXMKICAgICAgICB9KTsKCiAgICAgICAgZnVuY3Rpb24gY3JlYXRlJDEoKSB7CiAgICAgICAgICAgIHZhciBkcSA9CiAgICAgICAgICAgICAgICBuZXcgQVJSQVlfVFlQRSg4KTsKICAgICAgICAgICAgaWYgKEFSUkFZX1RZUEUgIT0gRmxvYXQzMkFycmF5KSB7CiAgICAgICAgICAgICAgICBkcVswXSA9IDA7CiAgICAgICAgICAgICAgICBkcVsxXSA9IDA7CiAgICAgICAgICAgICAgICBkcVsyXSA9IDA7CiAgICAgICAgICAgICAgICBkcVs0XSA9IDA7CiAgICAgICAgICAgICAgICBkcVs1XSA9IDA7CiAgICAgICAgICAgICAgICBkcVs2XSA9IDA7CiAgICAgICAgICAgICAgICBkcVs3XSA9IDAKICAgICAgICAgICAgfQogICAgICAgICAgICBkcVszXSA9IDE7CiAgICAgICAgICAgIHJldHVybiBkcQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gY2xvbmUkMShhKSB7CiAgICAgICAgICAgIHZhciBkcSA9IG5ldyBBUlJBWV9UWVBFKDgpOwogICAgICAgICAgICBkcVswXSA9IGFbMF07CiAgICAgICAgICAgIGRxWzFdID0gYVsxXTsKICAgICAgICAgICAgZHFbMl0gPSBhWzJdOwogICAgICAgICAgICBkcVszXSA9IGFbM107CiAgICAgICAgICAgIGRxWzRdID0gYVs0XTsKICAgICAgICAgICAgZHFbNV0gPSBhWzVdOwogICAgICAgICAgICBkcVs2XSA9IGFbNl07CiAgICAgICAgICAgIGRxWzddID0gYVs3XTsKICAgICAgICAgICAgcmV0dXJuIGRxCiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBmcm9tVmFsdWVzJDEoeDEsIHkxLCB6MSwgdzEsIHgyLCB5MiwgejIsIHcyKSB7CiAgICAgICAgICAgIHZhciBkcSA9IG5ldyBBUlJBWV9UWVBFKDgpOwogICAgICAgICAgICBkcVswXSA9IHgxOwogICAgICAgICAgICBkcVsxXSA9IHkxOwogICAgICAgICAgICBkcVsyXSA9IHoxOwogICAgICAgICAgICBkcVszXSA9IHcxOwogICAgICAgICAgICBkcVs0XSA9IHgyOwogICAgICAgICAgICBkcVs1XSA9IHkyOwogICAgICAgICAgICBkcVs2XSA9IHoyOwogICAgICAgICAgICBkcVs3XSA9IHcyOwogICAgICAgICAgICByZXR1cm4gZHEKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGZyb21Sb3RhdGlvblRyYW5zbGF0aW9uVmFsdWVzKHgxLCB5MSwgejEsIHcxLCB4MiwgeTIsIHoyKSB7CiAgICAgICAgICAgIHZhciBkcSA9IG5ldyBBUlJBWV9UWVBFKDgpOwogICAgICAgICAgICBkcVswXSA9IHgxOwogICAgICAgICAgICBkcVsxXSA9IHkxOwogICAgICAgICAgICBkcVsyXSA9IHoxOwogICAgICAgICAgICBkcVszXSA9IHcxOwogICAgICAgICAgICB2YXIgYXggPSB4MiAqIC41LAogICAgICAgICAgICAgICAgYXkgPSB5MiAqIC41LAogICAgICAgICAgICAgICAgYXogPSB6MiAqIC41OwogICAgICAgICAgICBkcVs0XSA9IGF4ICogdzEgKyBheSAqIHoxIC0gYXogKiB5MTsKICAgICAgICAgICAgZHFbNV0gPSBheSAqIHcxICsgYXogKiB4MSAtIGF4ICogejE7CiAgICAgICAgICAgIGRxWzZdID0gYXogKiB3MSArIGF4ICogeTEgLSBheSAqIHgxOwogICAgICAgICAgICBkcVs3XSA9IC1heCAqIHgxIC0gYXkgKiB5MSAtIGF6ICogejE7CiAgICAgICAgICAgIHJldHVybiBkcQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZnJvbVJvdGF0aW9uVHJhbnNsYXRpb24ob3V0LCBxLCB0KSB7CiAgICAgICAgICAgIHZhciBheCA9IHRbMF0gKiAuNSwKICAgICAgICAgICAgICAgIGF5ID0gdFsxXSAqIC41LAogICAgICAgICAgICAgICAgYXogPSB0WzJdICogLjUsCiAgICAgICAgICAgICAgICBieCA9IHFbMF0sCiAgICAgICAgICAgICAgICBieSA9IHFbMV0sCiAgICAgICAgICAgICAgICBieiA9IHFbMl0sCiAgICAgICAgICAgICAgICBidyA9IHFbM107CiAgICAgICAgICAgIG91dFswXSA9IGJ4OwogICAgICAgICAgICBvdXRbMV0gPSBieTsKICAgICAgICAgICAgb3V0WzJdID0gYno7CiAgICAgICAgICAgIG91dFszXSA9IGJ3OwogICAgICAgICAgICBvdXRbNF0gPSBheCAqIGJ3ICsgYXkgKiBieiAtIGF6ICogYnk7CiAgICAgICAgICAgIG91dFs1XSA9IGF5ICogYncgKyBheiAqIGJ4IC0gYXggKiBiejsKICAgICAgICAgICAgb3V0WzZdID0gYXogKiBidyArIGF4ICogYnkgLSBheSAqIGJ4OwogICAgICAgICAgICBvdXRbN10gPSAtYXggKiBieCAtIGF5ICogYnkgLSBheiAqIGJ6OwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBmcm9tVHJhbnNsYXRpb24ob3V0LCB0KSB7CiAgICAgICAgICAgIG91dFswXSA9IDA7CiAgICAgICAgICAgIG91dFsxXSA9IDA7CiAgICAgICAgICAgIG91dFsyXSA9IDA7CiAgICAgICAgICAgIG91dFszXSA9CiAgICAgICAgICAgICAgICAxOwogICAgICAgICAgICBvdXRbNF0gPSB0WzBdICogLjU7CiAgICAgICAgICAgIG91dFs1XSA9IHRbMV0gKiAuNTsKICAgICAgICAgICAgb3V0WzZdID0gdFsyXSAqIC41OwogICAgICAgICAgICBvdXRbN10gPSAwOwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBmcm9tUm90YXRpb24ob3V0LCBxKSB7CiAgICAgICAgICAgIG91dFswXSA9IHFbMF07CiAgICAgICAgICAgIG91dFsxXSA9IHFbMV07CiAgICAgICAgICAgIG91dFsyXSA9IHFbMl07CiAgICAgICAgICAgIG91dFszXSA9IHFbM107CiAgICAgICAgICAgIG91dFs0XSA9IDA7CiAgICAgICAgICAgIG91dFs1XSA9IDA7CiAgICAgICAgICAgIG91dFs2XSA9IDA7CiAgICAgICAgICAgIG91dFs3XSA9IDA7CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGZyb21NYXQ0KG91dCwgYSkgewogICAgICAgICAgICB2YXIgb3V0ZXIgPSBjcmVhdGUkMigpOwogICAgICAgICAgICBnZXRSb3RhdGlvbihvdXRlciwgYSk7CiAgICAgICAgICAgIHZhciB0ID0gbmV3IEFSUkFZX1RZUEUoMyk7CiAgICAgICAgICAgIGdldFRyYW5zbGF0aW9uJDEodCwgYSk7CiAgICAgICAgICAgIGZyb21Sb3RhdGlvblRyYW5zbGF0aW9uKG91dCwgb3V0ZXIsIHQpOwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBjb3B5JDEob3V0LCBhKSB7CiAgICAgICAgICAgIG91dFswXSA9IGFbMF07CiAgICAgICAgICAgIG91dFsxXSA9IGFbMV07CiAgICAgICAgICAgIG91dFsyXSA9IGFbMl07CiAgICAgICAgICAgIG91dFszXSA9IGFbM107CiAgICAgICAgICAgIG91dFs0XSA9IGFbNF07CiAgICAgICAgICAgIG91dFs1XSA9IGFbNV07CiAgICAgICAgICAgIG91dFs2XSA9IGFbNl07CiAgICAgICAgICAgIG91dFs3XSA9IGFbN107CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGlkZW50aXR5KG91dCkgewogICAgICAgICAgICBvdXRbMF0gPQogICAgICAgICAgICAgICAgMDsKICAgICAgICAgICAgb3V0WzFdID0gMDsKICAgICAgICAgICAgb3V0WzJdID0gMDsKICAgICAgICAgICAgb3V0WzNdID0gMTsKICAgICAgICAgICAgb3V0WzRdID0gMDsKICAgICAgICAgICAgb3V0WzVdID0gMDsKICAgICAgICAgICAgb3V0WzZdID0gMDsKICAgICAgICAgICAgb3V0WzddID0gMDsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gc2V0JDEob3V0LCB4MSwgeTEsIHoxLCB3MSwgeDIsIHkyLCB6MiwgdzIpIHsKICAgICAgICAgICAgb3V0WzBdID0geDE7CiAgICAgICAgICAgIG91dFsxXSA9IHkxOwogICAgICAgICAgICBvdXRbMl0gPSB6MTsKICAgICAgICAgICAgb3V0WzNdID0gdzE7CiAgICAgICAgICAgIG91dFs0XSA9IHgyOwogICAgICAgICAgICBvdXRbNV0gPSB5MjsKICAgICAgICAgICAgb3V0WzZdID0gejI7CiAgICAgICAgICAgIG91dFs3XSA9IHcyOwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQogICAgICAgIHZhciBnZXRSZWFsID0gY29weSQyOwoKICAgICAgICBmdW5jdGlvbiBnZXREdWFsKG91dCwgYSkgewogICAgICAgICAgICBvdXRbMF0gPSBhWzRdOwogICAgICAgICAgICBvdXRbMV0gPSBhWzVdOwogICAgICAgICAgICBvdXRbMl0gPSBhWzZdOwogICAgICAgICAgICBvdXRbM10gPSBhWzddOwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQogICAgICAgIHZhciBzZXRSZWFsID0gY29weSQyOwoKICAgICAgICBmdW5jdGlvbiBzZXREdWFsKG91dCwgcSkgewogICAgICAgICAgICBvdXRbNF0gPSBxWzBdOwogICAgICAgICAgICBvdXRbNV0gPSBxWzFdOwogICAgICAgICAgICBvdXRbNl0gPSBxWzJdOwogICAgICAgICAgICBvdXRbN10gPSBxWzNdOwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBnZXRUcmFuc2xhdGlvbihvdXQsIGEpIHsKICAgICAgICAgICAgdmFyIGF4ID0gYVs0XSwKICAgICAgICAgICAgICAgIGF5ID0gYVs1XSwKICAgICAgICAgICAgICAgIGF6ID0gYVs2XSwKICAgICAgICAgICAgICAgIGF3ID0gYVs3XSwKICAgICAgICAgICAgICAgIGJ4ID0gLWFbMF0sCiAgICAgICAgICAgICAgICBieSA9IC1hWzFdLAogICAgICAgICAgICAgICAgYnogPSAtYVsyXSwKICAgICAgICAgICAgICAgIGJ3ID0gYVszXTsKICAgICAgICAgICAgb3V0WzBdID0gKGF4ICogYncgKyBhdyAqIGJ4ICsgYXkgKiBieiAtIGF6ICogYnkpICogMjsKICAgICAgICAgICAgb3V0WzFdID0gKGF5ICogYncgKyBhdyAqIGJ5ICsgYXogKiBieCAtIGF4ICogYnopICogMjsKICAgICAgICAgICAgb3V0WzJdID0gKGF6ICogYncgKyBhdyAqIGJ6ICsgYXggKiBieSAtIGF5ICogYngpICogMjsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gdHJhbnNsYXRlKG91dCwgYSwgdikgewogICAgICAgICAgICB2YXIgYXgxID0gYVswXSwKICAgICAgICAgICAgICAgIGF5MSA9IGFbMV0sCiAgICAgICAgICAgICAgICBhejEgPSBhWzJdLAogICAgICAgICAgICAgICAgYXcxID0gYVszXSwKICAgICAgICAgICAgICAgIGJ4MSA9IHZbMF0gKiAuNSwKICAgICAgICAgICAgICAgIGJ5MSA9IHZbMV0gKiAuNSwKICAgICAgICAgICAgICAgIGJ6MSA9IHZbMl0gKiAuNSwKICAgICAgICAgICAgICAgIGF4MiA9IGFbNF0sCiAgICAgICAgICAgICAgICBheTIgPSBhWzVdLAogICAgICAgICAgICAgICAgYXoyID0gYVs2XSwKICAgICAgICAgICAgICAgIGF3MiA9IGFbN107CiAgICAgICAgICAgIG91dFswXSA9IGF4MTsKICAgICAgICAgICAgb3V0WzFdID0gYXkxOwogICAgICAgICAgICBvdXRbMl0gPSBhejE7CiAgICAgICAgICAgIG91dFszXSA9IGF3MTsKICAgICAgICAgICAgb3V0WzRdID0gYXcxICogYngxICsgYXkxICogYnoxIC0gYXoxICogYnkxICsgYXgyOwogICAgICAgICAgICBvdXRbNV0gPSBhdzEgKiBieTEgKyBhejEgKiBieDEgLSBheDEgKiBiejEgKyBheTI7CiAgICAgICAgICAgIG91dFs2XSA9IGF3MSAqIGJ6MSArIGF4MSAqIGJ5MSAtIGF5MSAqIGJ4MSArIGF6MjsKICAgICAgICAgICAgb3V0WzddID0gLWF4MSAqIGJ4MSAtIGF5MSAqIGJ5MSAtIGF6MSAqIGJ6MSArIGF3MjsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gcm90YXRlWChvdXQsIGEsIHJhZCkgewogICAgICAgICAgICB2YXIgYnggPSAtYVswXSwKICAgICAgICAgICAgICAgIGJ5ID0gLWFbMV0sCiAgICAgICAgICAgICAgICBieiA9IC1hWzJdLAogICAgICAgICAgICAgICAgYncgPSBhWzNdLAogICAgICAgICAgICAgICAgYXggPSBhWzRdLAogICAgICAgICAgICAgICAgYXkgPSBhWzVdLAogICAgICAgICAgICAgICAgYXogPSBhWzZdLAogICAgICAgICAgICAgICAgYXcgPSBhWzddLAogICAgICAgICAgICAgICAgYXgxID0gYXggKiBidyArIGF3ICogYnggKyBheSAqIGJ6IC0gYXogKiBieSwKICAgICAgICAgICAgICAgIGF5MSA9IGF5ICogYncgKyBhdyAqIGJ5ICsgYXogKiBieCAtIGF4ICogYnosCiAgICAgICAgICAgICAgICBhejEgPSBheiAqIGJ3ICsgYXcgKiBieiArIGF4ICogYnkgLSBheSAqIGJ4LAogICAgICAgICAgICAgICAgYXcxID0gYXcgKiBidyAtIGF4ICogYnggLSBheSAqIGJ5IC0gYXogKiBiejsKICAgICAgICAgICAgcm90YXRlWCQxKG91dCwgYSwgcmFkKTsKICAgICAgICAgICAgYnggPSBvdXRbMF07CiAgICAgICAgICAgIGJ5ID0gb3V0WzFdOwogICAgICAgICAgICBieiA9IG91dFsyXTsKICAgICAgICAgICAgYncgPSBvdXRbM107CiAgICAgICAgICAgIG91dFs0XSA9IGF4MSAqIGJ3ICsgYXcxICogYnggKyBheTEgKiBieiAtIGF6MSAqIGJ5OwogICAgICAgICAgICBvdXRbNV0gPSBheTEgKiBidyArIGF3MSAqIGJ5ICsgYXoxICogYnggLSBheDEgKiBiejsKICAgICAgICAgICAgb3V0WzZdID0gYXoxICogYncgKyBhdzEgKiBieiArIGF4MSAqIGJ5IC0gYXkxICogYng7CiAgICAgICAgICAgIG91dFs3XSA9IGF3MSAqIGJ3IC0gYXgxICogYnggLSBheTEgKiBieSAtIGF6MSAqIGJ6OwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiByb3RhdGVZKG91dCwgYSwgcmFkKSB7CiAgICAgICAgICAgIHZhciBieCA9IC1hWzBdLAogICAgICAgICAgICAgICAgYnkgPSAtYVsxXSwKICAgICAgICAgICAgICAgIGJ6ID0gLWFbMl0sCiAgICAgICAgICAgICAgICBidyA9IGFbM10sCiAgICAgICAgICAgICAgICBheCA9IGFbNF0sCiAgICAgICAgICAgICAgICBheSA9IGFbNV0sCiAgICAgICAgICAgICAgICBheiA9IGFbNl0sCiAgICAgICAgICAgICAgICBhdyA9IGFbN10sCiAgICAgICAgICAgICAgICBheDEgPSBheCAqIGJ3ICsgYXcgKiBieCArCiAgICAgICAgICAgICAgICBheSAqIGJ6IC0gYXogKiBieSwKICAgICAgICAgICAgICAgIGF5MSA9IGF5ICogYncgKyBhdyAqIGJ5ICsgYXogKiBieCAtIGF4ICogYnosCiAgICAgICAgICAgICAgICBhejEgPSBheiAqIGJ3ICsgYXcgKiBieiArIGF4ICogYnkgLSBheSAqIGJ4LAogICAgICAgICAgICAgICAgYXcxID0gYXcgKiBidyAtIGF4ICogYnggLSBheSAqIGJ5IC0gYXogKiBiejsKICAgICAgICAgICAgcm90YXRlWSQxKG91dCwgYSwgcmFkKTsKICAgICAgICAgICAgYnggPSBvdXRbMF07CiAgICAgICAgICAgIGJ5ID0gb3V0WzFdOwogICAgICAgICAgICBieiA9IG91dFsyXTsKICAgICAgICAgICAgYncgPSBvdXRbM107CiAgICAgICAgICAgIG91dFs0XSA9IGF4MSAqIGJ3ICsgYXcxICogYnggKyBheTEgKiBieiAtIGF6MSAqIGJ5OwogICAgICAgICAgICBvdXRbNV0gPSBheTEgKiBidyArIGF3MSAqIGJ5ICsgYXoxICogYnggLSBheDEgKiBiejsKICAgICAgICAgICAgb3V0WzZdID0gYXoxICogYncgKyBhdzEgKiBieiArIGF4MSAqIGJ5IC0gYXkxICogYng7CiAgICAgICAgICAgIG91dFs3XSA9IGF3MSAqIGJ3IC0gYXgxICogYnggLSBheTEgKiBieSAtIGF6MSAqIGJ6OwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiByb3RhdGVaKG91dCwgYSwgcmFkKSB7CiAgICAgICAgICAgIHZhciBieCA9IC1hWzBdLAogICAgICAgICAgICAgICAgYnkgPSAtYVsxXSwKICAgICAgICAgICAgICAgIGJ6ID0gLWFbMl0sCiAgICAgICAgICAgICAgICBidyA9IGFbM10sCiAgICAgICAgICAgICAgICBheCA9IGFbNF0sCiAgICAgICAgICAgICAgICBheSA9IGFbNV0sCiAgICAgICAgICAgICAgICBheiA9IGFbNl0sCiAgICAgICAgICAgICAgICBhdyA9IGFbN10sCiAgICAgICAgICAgICAgICBheDEgPSBheCAqIGJ3ICsgYXcgKiBieCArIGF5ICogYnogLSBheiAqIGJ5LAogICAgICAgICAgICAgICAgYXkxID0gYXkgKiBidyArIGF3ICogYnkgKyBheiAqIGJ4IC0gYXggKiBieiwKICAgICAgICAgICAgICAgIGF6MSA9IGF6ICogYncgKyBhdyAqIGJ6ICsgYXggKiBieSAtIGF5ICogYngsCiAgICAgICAgICAgICAgICBhdzEgPSBhdyAqIGJ3IC0KICAgICAgICAgICAgICAgIGF4ICogYnggLSBheSAqIGJ5IC0gYXogKiBiejsKICAgICAgICAgICAgcm90YXRlWiQxKG91dCwgYSwgcmFkKTsKICAgICAgICAgICAgYnggPSBvdXRbMF07CiAgICAgICAgICAgIGJ5ID0gb3V0WzFdOwogICAgICAgICAgICBieiA9IG91dFsyXTsKICAgICAgICAgICAgYncgPSBvdXRbM107CiAgICAgICAgICAgIG91dFs0XSA9IGF4MSAqIGJ3ICsgYXcxICogYnggKyBheTEgKiBieiAtIGF6MSAqIGJ5OwogICAgICAgICAgICBvdXRbNV0gPSBheTEgKiBidyArIGF3MSAqIGJ5ICsgYXoxICogYnggLSBheDEgKiBiejsKICAgICAgICAgICAgb3V0WzZdID0gYXoxICogYncgKyBhdzEgKiBieiArIGF4MSAqIGJ5IC0gYXkxICogYng7CiAgICAgICAgICAgIG91dFs3XSA9IGF3MSAqIGJ3IC0gYXgxICogYnggLSBheTEgKiBieSAtIGF6MSAqIGJ6OwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiByb3RhdGVCeVF1YXRBcHBlbmQob3V0LCBhLCBxKSB7CiAgICAgICAgICAgIHZhciBxeCA9IHFbMF0sCiAgICAgICAgICAgICAgICBxeSA9IHFbMV0sCiAgICAgICAgICAgICAgICBxeiA9IHFbMl0sCiAgICAgICAgICAgICAgICBxdyA9IHFbM10sCiAgICAgICAgICAgICAgICBheCA9IGFbMF0sCiAgICAgICAgICAgICAgICBheSA9IGFbMV0sCiAgICAgICAgICAgICAgICBheiA9IGFbMl0sCiAgICAgICAgICAgICAgICBhdyA9IGFbM107CiAgICAgICAgICAgIG91dFswXSA9IGF4ICogcXcgKyBhdyAqIHF4ICsgYXkgKiBxeiAtIGF6ICogcXk7CiAgICAgICAgICAgIG91dFsxXSA9IGF5ICogcXcgKyBhdyAqIHF5ICsgYXogKiBxeCAtIGF4ICogcXo7CiAgICAgICAgICAgIG91dFsyXSA9IGF6ICogcXcgKyBhdyAqIHF6ICsgYXggKiBxeSAtIGF5ICogcXg7CiAgICAgICAgICAgIG91dFszXSA9IGF3ICogcXcgLSBheCAqIHF4IC0gYXkgKiBxeSAtIGF6ICogcXo7CiAgICAgICAgICAgIGF4ID0gYVs0XTsKICAgICAgICAgICAgYXkgPSBhWzVdOwogICAgICAgICAgICBheiA9IGFbNl07CiAgICAgICAgICAgIGF3ID0gYVs3XTsKICAgICAgICAgICAgb3V0WzRdID0gYXggKgogICAgICAgICAgICAgICAgcXcgKyBhdyAqIHF4ICsgYXkgKiBxeiAtIGF6ICogcXk7CiAgICAgICAgICAgIG91dFs1XSA9IGF5ICogcXcgKyBhdyAqIHF5ICsgYXogKiBxeCAtIGF4ICogcXo7CiAgICAgICAgICAgIG91dFs2XSA9IGF6ICogcXcgKyBhdyAqIHF6ICsgYXggKiBxeSAtIGF5ICogcXg7CiAgICAgICAgICAgIG91dFs3XSA9IGF3ICogcXcgLSBheCAqIHF4IC0gYXkgKiBxeSAtIGF6ICogcXo7CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHJvdGF0ZUJ5UXVhdFByZXBlbmQob3V0LCBxLCBhKSB7CiAgICAgICAgICAgIHZhciBxeCA9IHFbMF0sCiAgICAgICAgICAgICAgICBxeSA9IHFbMV0sCiAgICAgICAgICAgICAgICBxeiA9IHFbMl0sCiAgICAgICAgICAgICAgICBxdyA9IHFbM10sCiAgICAgICAgICAgICAgICBieCA9IGFbMF0sCiAgICAgICAgICAgICAgICBieSA9IGFbMV0sCiAgICAgICAgICAgICAgICBieiA9IGFbMl0sCiAgICAgICAgICAgICAgICBidyA9IGFbM107CiAgICAgICAgICAgIG91dFswXSA9IHF4ICogYncgKyBxdyAqIGJ4ICsgcXkgKiBieiAtIHF6ICogYnk7CiAgICAgICAgICAgIG91dFsxXSA9IHF5ICogYncgKyBxdyAqIGJ5ICsgcXogKiBieCAtIHF4ICogYno7CiAgICAgICAgICAgIG91dFsyXSA9IHF6ICogYncgKyBxdyAqIGJ6ICsgcXggKiBieSAtIHF5ICogYng7CiAgICAgICAgICAgIG91dFszXSA9IHF3ICogYncgLSBxeCAqIGJ4IC0gcXkgKiBieSAtIHF6ICogYno7CiAgICAgICAgICAgIGJ4ID0gYVs0XTsKICAgICAgICAgICAgYnkgPSBhWzVdOwogICAgICAgICAgICBieiA9IGFbNl07CiAgICAgICAgICAgIGJ3ID0gYVs3XTsKICAgICAgICAgICAgb3V0WzRdID0gcXggKiBidyArIHF3ICogYnggKyBxeSAqIGJ6IC0gcXogKiBieTsKICAgICAgICAgICAgb3V0WzVdID0gcXkgKiBidyArIHF3ICogYnkgKyBxeiAqIGJ4IC0gcXggKiBiejsKICAgICAgICAgICAgb3V0WzZdID0gcXogKiBidyArIHF3ICogYnogKyBxeCAqIGJ5IC0gcXkgKiBieDsKICAgICAgICAgICAgb3V0WzddID0gcXcgKiBidyAtIHF4ICogYnggLSBxeSAqCiAgICAgICAgICAgICAgICBieSAtIHF6ICogYno7CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHJvdGF0ZUFyb3VuZEF4aXMob3V0LCBhLCBheGlzLCByYWQpIHsKICAgICAgICAgICAgaWYgKE1hdGguYWJzKHJhZCkgPCBFUFNJTE9OKSByZXR1cm4gY29weSQxKG91dCwgYSk7CiAgICAgICAgICAgIHZhciBheGlzTGVuZ3RoID0gTWF0aC5oeXBvdChheGlzWzBdLCBheGlzWzFdLCBheGlzWzJdKTsKICAgICAgICAgICAgcmFkID0gcmFkICogLjU7CiAgICAgICAgICAgIHZhciBzID0gTWF0aC5zaW4ocmFkKTsKICAgICAgICAgICAgdmFyIGJ4ID0gcyAqIGF4aXNbMF0gLyBheGlzTGVuZ3RoOwogICAgICAgICAgICB2YXIgYnkgPSBzICogYXhpc1sxXSAvIGF4aXNMZW5ndGg7CiAgICAgICAgICAgIHZhciBieiA9IHMgKiBheGlzWzJdIC8gYXhpc0xlbmd0aDsKICAgICAgICAgICAgdmFyIGJ3ID0gTWF0aC5jb3MocmFkKTsKICAgICAgICAgICAgdmFyIGF4MSA9IGFbMF0sCiAgICAgICAgICAgICAgICBheTEgPSBhWzFdLAogICAgICAgICAgICAgICAgYXoxID0gYVsyXSwKICAgICAgICAgICAgICAgIGF3MSA9IGFbM107CiAgICAgICAgICAgIG91dFswXSA9IGF4MSAqIGJ3ICsgYXcxICogYnggKyBheTEgKiBieiAtIGF6MSAqIGJ5OwogICAgICAgICAgICBvdXRbMV0gPSBheTEgKiBidyArIGF3MSAqIGJ5ICsgYXoxICogYnggLSBheDEgKiBiejsKICAgICAgICAgICAgb3V0WzJdID0gYXoxICogYncgKyBhdzEgKiBieiArIGF4MSAqIGJ5IC0gYXkxICogYng7CiAgICAgICAgICAgIG91dFszXSA9IGF3MSAqIGJ3IC0gYXgxICogYnggLSBheTEgKiBieSAtIGF6MSAqIGJ6OwogICAgICAgICAgICB2YXIgYXggPSBhWzRdLAogICAgICAgICAgICAgICAgYXkgPSBhWzVdLAogICAgICAgICAgICAgICAgYXogPSBhWzZdLAogICAgICAgICAgICAgICAgYXcgPSBhWzddOwogICAgICAgICAgICBvdXRbNF0gPSBheCAqIGJ3ICsgYXcgKiBieCArIGF5ICogYnogLSBheiAqIGJ5OwogICAgICAgICAgICBvdXRbNV0gPSBheSAqIGJ3ICsgYXcgKiBieSArIGF6ICogYnggLSBheCAqIGJ6OwogICAgICAgICAgICBvdXRbNl0gPSBheiAqIGJ3ICsgYXcgKiBieiArIGF4ICogYnkgLSBheSAqIGJ4OwogICAgICAgICAgICBvdXRbN10gPSBhdyAqIGJ3IC0gYXggKiBieCAtIGF5ICogYnkgLSBheiAqIGJ6OwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBhZGQkMShvdXQsIGEsIGIpIHsKICAgICAgICAgICAgb3V0WzBdID0gYVswXSArIGJbMF07CiAgICAgICAgICAgIG91dFsxXSA9IGFbMV0gKyBiWzFdOwogICAgICAgICAgICBvdXRbMl0gPSBhWzJdICsgYlsyXTsKICAgICAgICAgICAgb3V0WzNdID0gYVszXSArIGJbM107CiAgICAgICAgICAgIG91dFs0XSA9IGFbNF0gKyBiWzRdOwogICAgICAgICAgICBvdXRbNV0gPSBhWzVdICsgYls1XTsKICAgICAgICAgICAgb3V0WzZdID0gYVs2XSArIGJbNl07CiAgICAgICAgICAgIG91dFs3XSA9IGFbN10gKyBiWzddOwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBtdWx0aXBseSQxKG91dCwgYSwgYikgewogICAgICAgICAgICB2YXIgYXgwID0gYVswXSwKICAgICAgICAgICAgICAgIGF5MCA9IGFbMV0sCiAgICAgICAgICAgICAgICBhejAgPSBhWzJdLAogICAgICAgICAgICAgICAgYXcwID0gYVszXSwKICAgICAgICAgICAgICAgIGJ4MSA9IGJbNF0sCiAgICAgICAgICAgICAgICBieTEgPSBiWzVdLAogICAgICAgICAgICAgICAgYnoxID0gYls2XSwKICAgICAgICAgICAgICAgIGJ3MSA9IGJbN10sCiAgICAgICAgICAgICAgICBheDEgPSBhWzRdLAogICAgICAgICAgICAgICAgYXkxID0gYVs1XSwKICAgICAgICAgICAgICAgIGF6MSA9IGFbNl0sCiAgICAgICAgICAgICAgICBhdzEgPSBhWzddLAogICAgICAgICAgICAgICAgYngwID0gYlswXSwKICAgICAgICAgICAgICAgIGJ5MCA9IGJbMV0sCiAgICAgICAgICAgICAgICBiejAgPSBiWzJdLAogICAgICAgICAgICAgICAgYncwID0gYlszXTsKICAgICAgICAgICAgb3V0WzBdID0gYXgwICoKICAgICAgICAgICAgICAgIGJ3MCArIGF3MCAqIGJ4MCArIGF5MCAqIGJ6MCAtIGF6MCAqIGJ5MDsKICAgICAgICAgICAgb3V0WzFdID0gYXkwICogYncwICsgYXcwICogYnkwICsgYXowICogYngwIC0gYXgwICogYnowOwogICAgICAgICAgICBvdXRbMl0gPSBhejAgKiBidzAgKyBhdzAgKiBiejAgKyBheDAgKiBieTAgLSBheTAgKiBieDA7CiAgICAgICAgICAgIG91dFszXSA9IGF3MCAqIGJ3MCAtIGF4MCAqIGJ4MCAtIGF5MCAqIGJ5MCAtIGF6MCAqIGJ6MDsKICAgICAgICAgICAgb3V0WzRdID0gYXgwICogYncxICsgYXcwICogYngxICsgYXkwICogYnoxIC0gYXowICogYnkxICsgYXgxICogYncwICsgYXcxICogYngwICsgYXkxICogYnowIC0gYXoxICogYnkwOwogICAgICAgICAgICBvdXRbNV0gPSBheTAgKiBidzEgKyBhdzAgKiBieTEgKyBhejAgKiBieDEgLSBheDAgKiBiejEgKyBheTEgKiBidzAgKyBhdzEgKiBieTAgKyBhejEgKiBieDAgLSBheDEgKiBiejA7CiAgICAgICAgICAgIG91dFs2XSA9IGF6MCAqIGJ3MSArIGF3MCAqIGJ6MSArIGF4MCAqIGJ5MSAtIGF5MCAqIGJ4MSArIGF6MSAqIGJ3MCArIGF3MSAqIGJ6MCArIGF4MSAqIGJ5MCAtIGF5MSAqIGJ4MDsKICAgICAgICAgICAgb3V0WzddID0gYXcwICogYncxIC0gYXgwICogYngxIC0gYXkwICogYnkxIC0gYXowICogYnoxICsgYXcxICogYncwIC0gYXgxICogYngwIC0gYXkxICogYnkwIC0gYXoxICogYnowOwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQogICAgICAgIHZhciBtdWwkMSA9IG11bHRpcGx5JDE7CgogICAgICAgIGZ1bmN0aW9uIHNjYWxlJDEob3V0LCBhLCBiKSB7CiAgICAgICAgICAgIG91dFswXSA9IGFbMF0gKiBiOwogICAgICAgICAgICBvdXRbMV0gPSBhWzFdICogYjsKICAgICAgICAgICAgb3V0WzJdID0gYVsyXSAqIGI7CiAgICAgICAgICAgIG91dFszXSA9IGFbM10gKiBiOwogICAgICAgICAgICBvdXRbNF0gPSBhWzRdICogYjsKICAgICAgICAgICAgb3V0WzVdID0gYVs1XSAqIGI7CiAgICAgICAgICAgIG91dFs2XSA9IGFbNl0gKiBiOwogICAgICAgICAgICBvdXRbN10gPSBhWzddICogYjsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KICAgICAgICB2YXIgZG90JDEgPSBkb3QkMjsKCiAgICAgICAgZnVuY3Rpb24gbGVycCQxKG91dCwgYSwgYiwgdCkgewogICAgICAgICAgICB2YXIgbXQgPSAxIC0gdDsKICAgICAgICAgICAgaWYgKGRvdCQxKGEsIGIpIDwgMCkgdCA9IC10OwogICAgICAgICAgICBvdXRbMF0gPSBhWzBdICogbXQgKyBiWzBdICogdDsKICAgICAgICAgICAgb3V0WzFdID0gYVsxXSAqIG10ICsgYlsxXSAqIHQ7CiAgICAgICAgICAgIG91dFsyXSA9IGFbMl0gKiBtdCArIGJbMl0gKiB0OwogICAgICAgICAgICBvdXRbM10gPSBhWzNdICogbXQgKyBiWzNdICogdDsKICAgICAgICAgICAgb3V0WzRdID0gYVs0XSAqIG10ICsgYls0XSAqIHQ7CiAgICAgICAgICAgIG91dFs1XSA9IGFbNV0gKiBtdCArIGJbNV0gKiB0OwogICAgICAgICAgICBvdXRbNl0gPSBhWzZdICogbXQgKyBiWzZdICogdDsKICAgICAgICAgICAgb3V0WzddID0gYVs3XSAqIG10ICsgYls3XSAqIHQ7CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGludmVydChvdXQsIGEpIHsKICAgICAgICAgICAgdmFyIHNxbGVuID0gc3F1YXJlZExlbmd0aCQxKGEpOwogICAgICAgICAgICBvdXRbMF0gPSAtYVswXSAvIHNxbGVuOwogICAgICAgICAgICBvdXRbMV0gPSAtYVsxXSAvIHNxbGVuOwogICAgICAgICAgICBvdXRbMl0gPSAtYVsyXSAvIHNxbGVuOwogICAgICAgICAgICBvdXRbM10gPSBhWzNdIC8gc3FsZW47CiAgICAgICAgICAgIG91dFs0XSA9IC1hWzRdIC8gc3FsZW47CiAgICAgICAgICAgIG91dFs1XSA9IC1hWzVdIC8gc3FsZW47CiAgICAgICAgICAgIG91dFs2XSA9IC1hWzZdIC8gc3FsZW47CiAgICAgICAgICAgIG91dFs3XSA9IGFbN10gLyBzcWxlbjsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gY29uanVnYXRlKG91dCwgYSkgewogICAgICAgICAgICBvdXRbMF0gPSAtYVswXTsKICAgICAgICAgICAgb3V0WzFdID0gLWFbMV07CiAgICAgICAgICAgIG91dFsyXSA9IC1hWzJdOwogICAgICAgICAgICBvdXRbM10gPSBhWzNdOwogICAgICAgICAgICBvdXRbNF0gPSAtYVs0XTsKICAgICAgICAgICAgb3V0WzVdID0gLWFbNV07CiAgICAgICAgICAgIG91dFs2XSA9IC1hWzZdOwogICAgICAgICAgICBvdXRbN10gPSBhWzddOwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQogICAgICAgIHZhciBsZW5ndGgkMSA9IGxlbmd0aCQyOwogICAgICAgIHZhciBsZW4kMSA9IGxlbmd0aCQxOwogICAgICAgIHZhciBzcXVhcmVkTGVuZ3RoJDEgPSBzcXVhcmVkTGVuZ3RoJDI7CiAgICAgICAgdmFyIHNxckxlbiQxID0gc3F1YXJlZExlbmd0aCQxOwoKICAgICAgICBmdW5jdGlvbiBub3JtYWxpemUkMShvdXQsIGEpIHsKICAgICAgICAgICAgdmFyIG1hZ25pdHVkZSA9IHNxdWFyZWRMZW5ndGgkMShhKTsKICAgICAgICAgICAgaWYgKG1hZ25pdHVkZSA+IDApIHsKICAgICAgICAgICAgICAgIG1hZ25pdHVkZSA9IE1hdGguc3FydChtYWduaXR1ZGUpOwogICAgICAgICAgICAgICAgdmFyIGEwID0gYVswXSAvIG1hZ25pdHVkZTsKICAgICAgICAgICAgICAgIHZhciBhMSA9IGFbMV0gLyBtYWduaXR1ZGU7CiAgICAgICAgICAgICAgICB2YXIgYTIgPSBhWzJdIC8gbWFnbml0dWRlOwogICAgICAgICAgICAgICAgdmFyIGEzID0KICAgICAgICAgICAgICAgICAgICBhWzNdIC8gbWFnbml0dWRlOwogICAgICAgICAgICAgICAgdmFyIGIwID0gYVs0XTsKICAgICAgICAgICAgICAgIHZhciBiMSA9IGFbNV07CiAgICAgICAgICAgICAgICB2YXIgYjIgPSBhWzZdOwogICAgICAgICAgICAgICAgdmFyIGIzID0gYVs3XTsKICAgICAgICAgICAgICAgIHZhciBhX2RvdF9iID0gYTAgKiBiMCArIGExICogYjEgKyBhMiAqIGIyICsgYTMgKiBiMzsKICAgICAgICAgICAgICAgIG91dFswXSA9IGEwOwogICAgICAgICAgICAgICAgb3V0WzFdID0gYTE7CiAgICAgICAgICAgICAgICBvdXRbMl0gPSBhMjsKICAgICAgICAgICAgICAgIG91dFszXSA9IGEzOwogICAgICAgICAgICAgICAgb3V0WzRdID0gKGIwIC0gYTAgKiBhX2RvdF9iKSAvIG1hZ25pdHVkZTsKICAgICAgICAgICAgICAgIG91dFs1XSA9IChiMSAtIGExICogYV9kb3RfYikgLyBtYWduaXR1ZGU7CiAgICAgICAgICAgICAgICBvdXRbNl0gPSAoYjIgLSBhMiAqIGFfZG90X2IpIC8gbWFnbml0dWRlOwogICAgICAgICAgICAgICAgb3V0WzddID0gKGIzIC0gYTMgKiBhX2RvdF9iKSAvIG1hZ25pdHVkZQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHN0ciQxKGEpIHsKICAgICAgICAgICAgcmV0dXJuICJxdWF0MigiICsgYVswXSArICIsICIgKyBhWzFdICsgIiwgIiArIGFbMl0gKyAiLCAiICsgYVszXSArICIsICIgKyBhWzRdICsgIiwgIiArIGFbNV0gKyAiLCAiICsgYVs2XSArICIsICIgKyBhWzddICsgIikiCiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBleGFjdEVxdWFscyQxKGEsIGIpIHsKICAgICAgICAgICAgcmV0dXJuIGFbMF0gPT09IGJbMF0gJiYgYVsxXSA9PT0gYlsxXSAmJiBhWzJdID09PSBiWzJdICYmIGFbM10gPT09IGJbM10gJiYgYVs0XSA9PT0gYls0XSAmJiBhWzVdID09PQogICAgICAgICAgICAgICAgYls1XSAmJiBhWzZdID09PSBiWzZdICYmIGFbN10gPT09IGJbN10KICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGVxdWFscyQxKGEsIGIpIHsKICAgICAgICAgICAgdmFyIGEwID0gYVswXSwKICAgICAgICAgICAgICAgIGExID0gYVsxXSwKICAgICAgICAgICAgICAgIGEyID0gYVsyXSwKICAgICAgICAgICAgICAgIGEzID0gYVszXSwKICAgICAgICAgICAgICAgIGE0ID0gYVs0XSwKICAgICAgICAgICAgICAgIGE1ID0gYVs1XSwKICAgICAgICAgICAgICAgIGE2ID0gYVs2XSwKICAgICAgICAgICAgICAgIGE3ID0gYVs3XTsKICAgICAgICAgICAgdmFyIGIwID0gYlswXSwKICAgICAgICAgICAgICAgIGIxID0gYlsxXSwKICAgICAgICAgICAgICAgIGIyID0gYlsyXSwKICAgICAgICAgICAgICAgIGIzID0gYlszXSwKICAgICAgICAgICAgICAgIGI0ID0gYls0XSwKICAgICAgICAgICAgICAgIGI1ID0gYls1XSwKICAgICAgICAgICAgICAgIGI2ID0gYls2XSwKICAgICAgICAgICAgICAgIGI3ID0gYls3XTsKICAgICAgICAgICAgcmV0dXJuIE1hdGguYWJzKGEwIC0gYjApIDw9IEVQU0lMT04gKiBNYXRoLm1heCgxLCBNYXRoLmFicyhhMCksIE1hdGguYWJzKGIwKSkgJiYgTWF0aC5hYnMoYTEgLSBiMSkgPD0gRVBTSUxPTiAqIE1hdGgubWF4KDEsIE1hdGguYWJzKGExKSwgTWF0aC5hYnMoYjEpKSAmJiBNYXRoLmFicyhhMiAtIGIyKSA8PSBFUFNJTE9OICogTWF0aC5tYXgoMSwgTWF0aC5hYnMoYTIpLCBNYXRoLmFicyhiMikpICYmIE1hdGguYWJzKGEzIC0gYjMpIDw9IEVQU0lMT04gKiBNYXRoLm1heCgxLCBNYXRoLmFicyhhMyksIE1hdGguYWJzKGIzKSkgJiYgTWF0aC5hYnMoYTQgLSBiNCkgPD0gRVBTSUxPTiAqIE1hdGgubWF4KDEsIE1hdGguYWJzKGE0KSwKICAgICAgICAgICAgICAgIE1hdGguYWJzKGI0KSkgJiYgTWF0aC5hYnMoYTUgLSBiNSkgPD0gRVBTSUxPTiAqIE1hdGgubWF4KDEsIE1hdGguYWJzKGE1KSwgTWF0aC5hYnMoYjUpKSAmJiBNYXRoLmFicyhhNiAtIGI2KSA8PSBFUFNJTE9OICogTWF0aC5tYXgoMSwgTWF0aC5hYnMoYTYpLCBNYXRoLmFicyhiNikpICYmIE1hdGguYWJzKGE3IC0gYjcpIDw9IEVQU0lMT04gKiBNYXRoLm1heCgxLCBNYXRoLmFicyhhNyksIE1hdGguYWJzKGI3KSkKICAgICAgICB9CiAgICAgICAgdmFyIHF1YXQyID0gT2JqZWN0LmZyZWV6ZSh7CiAgICAgICAgICAgIF9fcHJvdG9fXzogbnVsbCwKICAgICAgICAgICAgY3JlYXRlOiBjcmVhdGUkMSwKICAgICAgICAgICAgY2xvbmU6IGNsb25lJDEsCiAgICAgICAgICAgIGZyb21WYWx1ZXM6IGZyb21WYWx1ZXMkMSwKICAgICAgICAgICAgZnJvbVJvdGF0aW9uVHJhbnNsYXRpb25WYWx1ZXM6IGZyb21Sb3RhdGlvblRyYW5zbGF0aW9uVmFsdWVzLAogICAgICAgICAgICBmcm9tUm90YXRpb25UcmFuc2xhdGlvbjogZnJvbVJvdGF0aW9uVHJhbnNsYXRpb24sCiAgICAgICAgICAgIGZyb21UcmFuc2xhdGlvbjogZnJvbVRyYW5zbGF0aW9uLAogICAgICAgICAgICBmcm9tUm90YXRpb246IGZyb21Sb3RhdGlvbiwKICAgICAgICAgICAgZnJvbU1hdDQ6IGZyb21NYXQ0LAogICAgICAgICAgICBjb3B5OiBjb3B5JDEsCiAgICAgICAgICAgIGlkZW50aXR5OiBpZGVudGl0eSwKICAgICAgICAgICAgc2V0OiBzZXQkMSwKICAgICAgICAgICAgZ2V0UmVhbDogZ2V0UmVhbCwKICAgICAgICAgICAgZ2V0RHVhbDogZ2V0RHVhbCwKICAgICAgICAgICAgc2V0UmVhbDogc2V0UmVhbCwKICAgICAgICAgICAgc2V0RHVhbDogc2V0RHVhbCwKICAgICAgICAgICAgZ2V0VHJhbnNsYXRpb246IGdldFRyYW5zbGF0aW9uLAogICAgICAgICAgICB0cmFuc2xhdGU6IHRyYW5zbGF0ZSwKICAgICAgICAgICAgcm90YXRlWDogcm90YXRlWCwKICAgICAgICAgICAgcm90YXRlWTogcm90YXRlWSwKICAgICAgICAgICAgcm90YXRlWjogcm90YXRlWiwKICAgICAgICAgICAgcm90YXRlQnlRdWF0QXBwZW5kOiByb3RhdGVCeVF1YXRBcHBlbmQsCiAgICAgICAgICAgIHJvdGF0ZUJ5UXVhdFByZXBlbmQ6IHJvdGF0ZUJ5UXVhdFByZXBlbmQsCiAgICAgICAgICAgIHJvdGF0ZUFyb3VuZEF4aXM6IHJvdGF0ZUFyb3VuZEF4aXMsCiAgICAgICAgICAgIGFkZDogYWRkJDEsCiAgICAgICAgICAgIG11bHRpcGx5OiBtdWx0aXBseSQxLAogICAgICAgICAgICBtdWw6IG11bCQxLAogICAgICAgICAgICBzY2FsZTogc2NhbGUkMSwKICAgICAgICAgICAgZG90OiBkb3QkMSwKICAgICAgICAgICAgbGVycDogbGVycCQxLAogICAgICAgICAgICBpbnZlcnQ6IGludmVydCwKICAgICAgICAgICAgY29uanVnYXRlOiBjb25qdWdhdGUsCiAgICAgICAgICAgIGxlbmd0aDogbGVuZ3RoJDEsCiAgICAgICAgICAgIGxlbjogbGVuJDEsCiAgICAgICAgICAgIHNxdWFyZWRMZW5ndGg6IHNxdWFyZWRMZW5ndGgkMSwKICAgICAgICAgICAgc3FyTGVuOiBzcXJMZW4kMSwKICAgICAgICAgICAgbm9ybWFsaXplOiBub3JtYWxpemUkMSwKICAgICAgICAgICAgc3RyOiBzdHIkMSwKICAgICAgICAgICAgZXhhY3RFcXVhbHM6IGV4YWN0RXF1YWxzJDEsCiAgICAgICAgICAgIGVxdWFsczogZXF1YWxzJDEKICAgICAgICB9KTsKCiAgICAgICAgZnVuY3Rpb24gY3JlYXRlKCkgewogICAgICAgICAgICB2YXIgb3V0ID0gbmV3IEFSUkFZX1RZUEUoMik7CiAgICAgICAgICAgIGlmIChBUlJBWV9UWVBFICE9IEZsb2F0MzJBcnJheSkgewogICAgICAgICAgICAgICAgb3V0WzBdID0gMDsKICAgICAgICAgICAgICAgIG91dFsxXSA9IDAKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBjbG9uZShhKSB7CiAgICAgICAgICAgIHZhciBvdXQgPSBuZXcgQVJSQVlfVFlQRSgyKTsKICAgICAgICAgICAgb3V0WzBdID0gYVswXTsKICAgICAgICAgICAgb3V0WzFdID0gYVsxXTsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZnJvbVZhbHVlcyh4LCB5KSB7CiAgICAgICAgICAgIHZhciBvdXQgPSBuZXcgQVJSQVlfVFlQRSgyKTsKICAgICAgICAgICAgb3V0WzBdID0geDsKICAgICAgICAgICAgb3V0WzFdID0geTsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gY29weShvdXQsIGEpIHsKICAgICAgICAgICAgb3V0WzBdID0gYVswXTsKICAgICAgICAgICAgb3V0WzFdID0gYVsxXTsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gc2V0KG91dCwgeCwgeSkgewogICAgICAgICAgICBvdXRbMF0gPSB4OwogICAgICAgICAgICBvdXRbMV0gPSB5OwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBhZGQob3V0LCBhLCBiKSB7CiAgICAgICAgICAgIG91dFswXSA9IGFbMF0gKyBiWzBdOwogICAgICAgICAgICBvdXRbMV0gPSBhWzFdICsgYlsxXTsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gc3VidHJhY3Qob3V0LCBhLCBiKSB7CiAgICAgICAgICAgIG91dFswXSA9IGFbMF0gLSBiWzBdOwogICAgICAgICAgICBvdXRbMV0gPQogICAgICAgICAgICAgICAgYVsxXSAtIGJbMV07CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIG11bHRpcGx5KG91dCwgYSwgYikgewogICAgICAgICAgICBvdXRbMF0gPSBhWzBdICogYlswXTsKICAgICAgICAgICAgb3V0WzFdID0gYVsxXSAqIGJbMV07CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGRpdmlkZShvdXQsIGEsIGIpIHsKICAgICAgICAgICAgb3V0WzBdID0gYVswXSAvIGJbMF07CiAgICAgICAgICAgIG91dFsxXSA9IGFbMV0gLyBiWzFdOwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBjZWlsKG91dCwgYSkgewogICAgICAgICAgICBvdXRbMF0gPSBNYXRoLmNlaWwoYVswXSk7CiAgICAgICAgICAgIG91dFsxXSA9IE1hdGguY2VpbChhWzFdKTsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZmxvb3Iob3V0LCBhKSB7CiAgICAgICAgICAgIG91dFswXSA9IE1hdGguZmxvb3IoYVswXSk7CiAgICAgICAgICAgIG91dFsxXSA9IE1hdGguZmxvb3IoYVsxXSk7CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIG1pbihvdXQsIGEsIGIpIHsKICAgICAgICAgICAgb3V0WzBdID0gTWF0aC5taW4oYVswXSwgYlswXSk7CiAgICAgICAgICAgIG91dFsxXSA9IE1hdGgubWluKGFbMV0sIGJbMV0pOwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBtYXgob3V0LCBhLCBiKSB7CiAgICAgICAgICAgIG91dFswXSA9IE1hdGgubWF4KGFbMF0sIGJbMF0pOwogICAgICAgICAgICBvdXRbMV0gPSBNYXRoLm1heChhWzFdLCBiWzFdKTsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gcm91bmQob3V0LAogICAgICAgICAgICBhKSB7CiAgICAgICAgICAgIG91dFswXSA9IE1hdGgucm91bmQoYVswXSk7CiAgICAgICAgICAgIG91dFsxXSA9IE1hdGgucm91bmQoYVsxXSk7CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHNjYWxlKG91dCwgYSwgYikgewogICAgICAgICAgICBvdXRbMF0gPSBhWzBdICogYjsKICAgICAgICAgICAgb3V0WzFdID0gYVsxXSAqIGI7CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHNjYWxlQW5kQWRkKG91dCwgYSwgYiwgc2NhbGUpIHsKICAgICAgICAgICAgb3V0WzBdID0gYVswXSArIGJbMF0gKiBzY2FsZTsKICAgICAgICAgICAgb3V0WzFdID0gYVsxXSArIGJbMV0gKiBzY2FsZTsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZGlzdGFuY2UoYSwgYikgewogICAgICAgICAgICB2YXIgeCA9IGJbMF0gLSBhWzBdLAogICAgICAgICAgICAgICAgeSA9IGJbMV0gLSBhWzFdOwogICAgICAgICAgICByZXR1cm4gTWF0aC5oeXBvdCh4LCB5KQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gc3F1YXJlZERpc3RhbmNlKGEsIGIpIHsKICAgICAgICAgICAgdmFyIHggPSBiWzBdIC0gYVswXSwKICAgICAgICAgICAgICAgIHkgPSBiWzFdIC0gYVsxXTsKICAgICAgICAgICAgcmV0dXJuIHggKiB4ICsgeSAqIHkKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGxlbmd0aChhKSB7CiAgICAgICAgICAgIHZhciB4ID0gYVswXSwKICAgICAgICAgICAgICAgIHkgPSBhWzFdOwogICAgICAgICAgICByZXR1cm4gTWF0aC5oeXBvdCh4LCB5KQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gc3F1YXJlZExlbmd0aChhKSB7CiAgICAgICAgICAgIHZhciB4ID0gYVswXSwKICAgICAgICAgICAgICAgIHkgPSBhWzFdOwogICAgICAgICAgICByZXR1cm4geCAqIHggKyB5ICogeQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gbmVnYXRlKG91dCwKICAgICAgICAgICAgYSkgewogICAgICAgICAgICBvdXRbMF0gPSAtYVswXTsKICAgICAgICAgICAgb3V0WzFdID0gLWFbMV07CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGludmVyc2Uob3V0LCBhKSB7CiAgICAgICAgICAgIG91dFswXSA9IDEgLyBhWzBdOwogICAgICAgICAgICBvdXRbMV0gPSAxIC8gYVsxXTsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gbm9ybWFsaXplKG91dCwgYSkgewogICAgICAgICAgICB2YXIgeCA9IGFbMF0sCiAgICAgICAgICAgICAgICB5ID0gYVsxXTsKICAgICAgICAgICAgdmFyIGxlbiA9IHggKiB4ICsgeSAqIHk7CiAgICAgICAgICAgIGlmIChsZW4gPiAwKSBsZW4gPSAxIC8gTWF0aC5zcXJ0KGxlbik7CiAgICAgICAgICAgIG91dFswXSA9IGFbMF0gKiBsZW47CiAgICAgICAgICAgIG91dFsxXSA9IGFbMV0gKiBsZW47CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGRvdChhLCBiKSB7CiAgICAgICAgICAgIHJldHVybiBhWzBdICogYlswXSArIGFbMV0gKiBiWzFdCiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBjcm9zcyhvdXQsIGEsIGIpIHsKICAgICAgICAgICAgdmFyIHogPSBhWzBdICogYlsxXSAtIGFbMV0gKiBiWzBdOwogICAgICAgICAgICBvdXRbMF0gPSBvdXRbMV0gPSAwOwogICAgICAgICAgICBvdXRbMl0gPSB6OwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBsZXJwKG91dCwgYSwgYiwgdCkgewogICAgICAgICAgICB2YXIgYXggPSBhWzBdLAogICAgICAgICAgICAgICAgYXkgPSBhWzFdOwogICAgICAgICAgICBvdXRbMF0gPSBheCArIHQgKiAoYlswXSAtIGF4KTsKICAgICAgICAgICAgb3V0WzFdID0gYXkgKyB0ICogKGJbMV0gLSBheSk7CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHJhbmRvbShvdXQsIHNjYWxlKSB7CiAgICAgICAgICAgIHNjYWxlID0gc2NhbGUgfHwKICAgICAgICAgICAgICAgIDE7CiAgICAgICAgICAgIHZhciByID0gUkFORE9NKCkgKiAyICogTWF0aC5QSTsKICAgICAgICAgICAgb3V0WzBdID0gTWF0aC5jb3MocikgKiBzY2FsZTsKICAgICAgICAgICAgb3V0WzFdID0gTWF0aC5zaW4ocikgKiBzY2FsZTsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gdHJhbnNmb3JtTWF0MihvdXQsIGEsIG0pIHsKICAgICAgICAgICAgdmFyIHggPSBhWzBdLAogICAgICAgICAgICAgICAgeSA9IGFbMV07CiAgICAgICAgICAgIG91dFswXSA9IG1bMF0gKiB4ICsgbVsyXSAqIHk7CiAgICAgICAgICAgIG91dFsxXSA9IG1bMV0gKiB4ICsgbVszXSAqIHk7CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHRyYW5zZm9ybU1hdDJkKG91dCwgYSwgbSkgewogICAgICAgICAgICB2YXIgeCA9IGFbMF0sCiAgICAgICAgICAgICAgICB5ID0gYVsxXTsKICAgICAgICAgICAgb3V0WzBdID0gbVswXSAqIHggKyBtWzJdICogeSArIG1bNF07CiAgICAgICAgICAgIG91dFsxXSA9IG1bMV0gKiB4ICsgbVszXSAqIHkgKyBtWzVdOwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiB0cmFuc2Zvcm1NYXQzKG91dCwgYSwgbSkgewogICAgICAgICAgICB2YXIgeCA9IGFbMF0sCiAgICAgICAgICAgICAgICB5ID0gYVsxXTsKICAgICAgICAgICAgb3V0WzBdID0gbVswXSAqIHggKyBtWzNdICogeSArIG1bNl07CiAgICAgICAgICAgIG91dFsxXSA9IG1bMV0gKiB4ICsgbVs0XSAqIHkgKyBtWzddOwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiB0cmFuc2Zvcm1NYXQ0KG91dCwgYSwgbSkgewogICAgICAgICAgICB2YXIgeCA9IGFbMF07CiAgICAgICAgICAgIHZhciB5ID0gYVsxXTsKICAgICAgICAgICAgb3V0WzBdID0gbVswXSAqIHggKyBtWzRdICogeSArIG1bMTJdOwogICAgICAgICAgICBvdXRbMV0gPQogICAgICAgICAgICAgICAgbVsxXSAqIHggKyBtWzVdICogeSArIG1bMTNdOwogICAgICAgICAgICByZXR1cm4gb3V0CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiByb3RhdGUob3V0LCBhLCBiLCByYWQpIHsKICAgICAgICAgICAgdmFyIHAwID0gYVswXSAtIGJbMF0sCiAgICAgICAgICAgICAgICBwMSA9IGFbMV0gLSBiWzFdLAogICAgICAgICAgICAgICAgc2luQyA9IE1hdGguc2luKHJhZCksCiAgICAgICAgICAgICAgICBjb3NDID0gTWF0aC5jb3MocmFkKTsKICAgICAgICAgICAgb3V0WzBdID0gcDAgKiBjb3NDIC0gcDEgKiBzaW5DICsgYlswXTsKICAgICAgICAgICAgb3V0WzFdID0gcDAgKiBzaW5DICsgcDEgKiBjb3NDICsgYlsxXTsKICAgICAgICAgICAgcmV0dXJuIG91dAogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gYW5nbGUoYSwgYikgewogICAgICAgICAgICB2YXIgeDEgPSBhWzBdLAogICAgICAgICAgICAgICAgeTEgPSBhWzFdLAogICAgICAgICAgICAgICAgeDIgPSBiWzBdLAogICAgICAgICAgICAgICAgeTIgPSBiWzFdLAogICAgICAgICAgICAgICAgbWFnID0gTWF0aC5zcXJ0KCh4MSAqIHgxICsgeTEgKiB5MSkgKiAoeDIgKiB4MiArIHkyICogeTIpKSwKICAgICAgICAgICAgICAgIGNvc2luZSA9IG1hZyAmJiAoeDEgKiB4MiArIHkxICogeTIpIC8gbWFnOwogICAgICAgICAgICByZXR1cm4gTWF0aC5hY29zKE1hdGgubWluKE1hdGgubWF4KGNvc2luZSwgLTEpLCAxKSkKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHplcm8ob3V0KSB7CiAgICAgICAgICAgIG91dFswXSA9IDA7CiAgICAgICAgICAgIG91dFsxXSA9IDA7CiAgICAgICAgICAgIHJldHVybiBvdXQKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHN0cihhKSB7CiAgICAgICAgICAgIHJldHVybiAidmVjMigiICsgYVswXSArICIsICIgKyBhWzFdICsgIikiCiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBleGFjdEVxdWFscyhhLCBiKSB7CiAgICAgICAgICAgIHJldHVybiBhWzBdID09PQogICAgICAgICAgICAgICAgYlswXSAmJiBhWzFdID09PSBiWzFdCiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBlcXVhbHMoYSwgYikgewogICAgICAgICAgICB2YXIgYTAgPSBhWzBdLAogICAgICAgICAgICAgICAgYTEgPSBhWzFdOwogICAgICAgICAgICB2YXIgYjAgPSBiWzBdLAogICAgICAgICAgICAgICAgYjEgPSBiWzFdOwogICAgICAgICAgICByZXR1cm4gTWF0aC5hYnMoYTAgLSBiMCkgPD0gRVBTSUxPTiAqIE1hdGgubWF4KDEsIE1hdGguYWJzKGEwKSwgTWF0aC5hYnMoYjApKSAmJiBNYXRoLmFicyhhMSAtIGIxKSA8PSBFUFNJTE9OICogTWF0aC5tYXgoMSwgTWF0aC5hYnMoYTEpLCBNYXRoLmFicyhiMSkpCiAgICAgICAgfQogICAgICAgIHZhciBsZW4gPSBsZW5ndGg7CiAgICAgICAgdmFyIHN1YiA9IHN1YnRyYWN0OwogICAgICAgIHZhciBtdWwgPSBtdWx0aXBseTsKICAgICAgICB2YXIgZGl2ID0gZGl2aWRlOwogICAgICAgIHZhciBkaXN0ID0gZGlzdGFuY2U7CiAgICAgICAgdmFyIHNxckRpc3QgPSBzcXVhcmVkRGlzdGFuY2U7CiAgICAgICAgdmFyIHNxckxlbiA9IHNxdWFyZWRMZW5ndGg7CiAgICAgICAgdmFyIGZvckVhY2ggPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIHZlYyA9IGNyZWF0ZSgpOwogICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oYSwgc3RyaWRlLCBvZmZzZXQsIGNvdW50LCBmbiwgYXJnKSB7CiAgICAgICAgICAgICAgICB2YXIgaSwgbDsKICAgICAgICAgICAgICAgIGlmICghc3RyaWRlKSBzdHJpZGUgPSAyOwogICAgICAgICAgICAgICAgaWYgKCFvZmZzZXQpIG9mZnNldCA9IDA7CiAgICAgICAgICAgICAgICBpZiAoY291bnQpIGwgPSBNYXRoLm1pbihjb3VudCAqCiAgICAgICAgICAgICAgICAgICAgc3RyaWRlICsgb2Zmc2V0LCBhLmxlbmd0aCk7CiAgICAgICAgICAgICAgICBlbHNlIGwgPSBhLmxlbmd0aDsKICAgICAgICAgICAgICAgIGZvciAoaSA9IG9mZnNldDsgaSA8IGw7IGkgKz0gc3RyaWRlKSB7CiAgICAgICAgICAgICAgICAgICAgdmVjWzBdID0gYVtpXTsKICAgICAgICAgICAgICAgICAgICB2ZWNbMV0gPSBhW2kgKyAxXTsKICAgICAgICAgICAgICAgICAgICBmbih2ZWMsIHZlYywgYXJnKTsKICAgICAgICAgICAgICAgICAgICBhW2ldID0gdmVjWzBdOwogICAgICAgICAgICAgICAgICAgIGFbaSArIDFdID0gdmVjWzFdCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gYQogICAgICAgICAgICB9CiAgICAgICAgfSgpOwogICAgICAgIHZhciB2ZWMyID0gT2JqZWN0LmZyZWV6ZSh7CiAgICAgICAgICAgIF9fcHJvdG9fXzogbnVsbCwKICAgICAgICAgICAgY3JlYXRlOiBjcmVhdGUsCiAgICAgICAgICAgIGNsb25lOiBjbG9uZSwKICAgICAgICAgICAgZnJvbVZhbHVlczogZnJvbVZhbHVlcywKICAgICAgICAgICAgY29weTogY29weSwKICAgICAgICAgICAgc2V0OiBzZXQsCiAgICAgICAgICAgIGFkZDogYWRkLAogICAgICAgICAgICBzdWJ0cmFjdDogc3VidHJhY3QsCiAgICAgICAgICAgIG11bHRpcGx5OiBtdWx0aXBseSwKICAgICAgICAgICAgZGl2aWRlOiBkaXZpZGUsCiAgICAgICAgICAgIGNlaWw6IGNlaWwsCiAgICAgICAgICAgIGZsb29yOiBmbG9vciwKICAgICAgICAgICAgbWluOiBtaW4sCiAgICAgICAgICAgIG1heDogbWF4LAogICAgICAgICAgICByb3VuZDogcm91bmQsCiAgICAgICAgICAgIHNjYWxlOiBzY2FsZSwKICAgICAgICAgICAgc2NhbGVBbmRBZGQ6IHNjYWxlQW5kQWRkLAogICAgICAgICAgICBkaXN0YW5jZTogZGlzdGFuY2UsCiAgICAgICAgICAgIHNxdWFyZWREaXN0YW5jZTogc3F1YXJlZERpc3RhbmNlLAogICAgICAgICAgICBsZW5ndGg6IGxlbmd0aCwKICAgICAgICAgICAgc3F1YXJlZExlbmd0aDogc3F1YXJlZExlbmd0aCwKICAgICAgICAgICAgbmVnYXRlOiBuZWdhdGUsCiAgICAgICAgICAgIGludmVyc2U6IGludmVyc2UsCiAgICAgICAgICAgIG5vcm1hbGl6ZTogbm9ybWFsaXplLAogICAgICAgICAgICBkb3Q6IGRvdCwKICAgICAgICAgICAgY3Jvc3M6IGNyb3NzLAogICAgICAgICAgICBsZXJwOiBsZXJwLAogICAgICAgICAgICByYW5kb206IHJhbmRvbSwKICAgICAgICAgICAgdHJhbnNmb3JtTWF0MjogdHJhbnNmb3JtTWF0MiwKICAgICAgICAgICAgdHJhbnNmb3JtTWF0MmQ6IHRyYW5zZm9ybU1hdDJkLAogICAgICAgICAgICB0cmFuc2Zvcm1NYXQzOiB0cmFuc2Zvcm1NYXQzLAogICAgICAgICAgICB0cmFuc2Zvcm1NYXQ0OiB0cmFuc2Zvcm1NYXQ0LAogICAgICAgICAgICByb3RhdGU6IHJvdGF0ZSwKICAgICAgICAgICAgYW5nbGU6IGFuZ2xlLAogICAgICAgICAgICB6ZXJvOiB6ZXJvLAogICAgICAgICAgICBzdHI6IHN0ciwKICAgICAgICAgICAgZXhhY3RFcXVhbHM6IGV4YWN0RXF1YWxzLAogICAgICAgICAgICBlcXVhbHM6IGVxdWFscywKICAgICAgICAgICAgbGVuOiBsZW4sCiAgICAgICAgICAgIHN1Yjogc3ViLAogICAgICAgICAgICBtdWw6IG11bCwKICAgICAgICAgICAgZGl2OiBkaXYsCiAgICAgICAgICAgIGRpc3Q6IGRpc3QsCiAgICAgICAgICAgIHNxckRpc3Q6IHNxckRpc3QsCiAgICAgICAgICAgIHNxckxlbjogc3FyTGVuLAogICAgICAgICAgICBmb3JFYWNoOiBmb3JFYWNoCiAgICAgICAgfSk7CiAgICAgICAgZXhwb3J0cy5nbE1hdHJpeCA9IGNvbW1vbjsKICAgICAgICBleHBvcnRzLm1hdDIgPSBtYXQyOwogICAgICAgIGV4cG9ydHMubWF0MmQgPSBtYXQyZDsKICAgICAgICBleHBvcnRzLm1hdDMgPSBtYXQzOwogICAgICAgIGV4cG9ydHMubWF0NCA9IG1hdDQ7CiAgICAgICAgZXhwb3J0cy5xdWF0ID0gcXVhdDsKICAgICAgICBleHBvcnRzLnF1YXQyID0gcXVhdDI7CiAgICAgICAgZXhwb3J0cy52ZWMyID0gdmVjMjsKICAgICAgICBleHBvcnRzLnZlYzMgPSB2ZWMzOwogICAgICAgIGV4cG9ydHMudmVjNCA9IHZlYzQ7CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogICAgICAgICAgICB2YWx1ZTogdHJ1ZQogICAgICAgIH0pCiAgICB9KTsKCn0KCi8vIC4uLzNyZHBhcnR5L2dyYXBoZW1lLXNwbGl0dGVyLmpzCnsKICAgIGZ1bmN0aW9uIEdyYXBoZW1lU3BsaXR0ZXIoKSB7CiAgICAgICAgZnVuY3Rpb24gaChhLCBjKSB7CiAgICAgICAgICAgIHZvaWQgMCA9PT0gYyAmJiAoYyA9IDApOwogICAgICAgICAgICB2YXIgYiA9IGEuY2hhckNvZGVBdChjKTsKICAgICAgICAgICAgaWYgKDU1Mjk2IDw9IGIgJiYgNTYzMTkgPj0gYiAmJiBjIDwgYS5sZW5ndGggLSAxKSB7CiAgICAgICAgICAgICAgICB2YXIgZCA9IGI7CiAgICAgICAgICAgICAgICBhID0gYS5jaGFyQ29kZUF0KGMgKyAxKTsKICAgICAgICAgICAgICAgIHJldHVybiA1NjMyMCA8PSBhICYmIDU3MzQzID49IGEgPyAxMDI0ICogKGQgLSA1NTI5NikgKyAoYSAtIDU2MzIwKSArIDY1NTM2IDogZAogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiA1NjMyMCA8PSBiICYmIDU3MzQzID49IGIgJiYgMSA8PSBjID8gKGQgPSBhLmNoYXJDb2RlQXQoYyAtIDEpLCBhID0gYiwgNTUyOTYgPD0gZCAmJiA1NjMxOSA+PSBkID8gMTAyNCAqIChkIC0gNTUyOTYpICsgKGEgLSA1NjMyMCkgKyA2NTUzNiA6IGEpIDogYgogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gbChhLCBjLCBiKSB7CiAgICAgICAgICAgIHZhciBkID0gW2FdLmNvbmNhdChjKS5jb25jYXQoW2JdKSwKICAgICAgICAgICAgICAgIGUgPSBkW2QubGVuZ3RoIC0gMl0sCiAgICAgICAgICAgICAgICBnID0gZC5sYXN0SW5kZXhPZigxNCk7CiAgICAgICAgICAgIGlmICgxIDwgZyAmJiBkLnNsaWNlKDEsIGcpLmV2ZXJ5KGZ1bmN0aW9uKGYpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gMyA9PSBmCiAgICAgICAgICAgICAgICB9KSAmJiAtMSA9PSBbMywgMTMsIDE3XS5pbmRleE9mKGEpKSByZXR1cm4gMjsKICAgICAgICAgICAgYSA9IGQubGFzdEluZGV4T2YoNCk7CiAgICAgICAgICAgIGlmICgwIDwgYSAmJiBkLnNsaWNlKDEsIGEpLmV2ZXJ5KGZ1bmN0aW9uKGYpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gNCA9PSBmCiAgICAgICAgICAgICAgICB9KSAmJiAtMSA9PSBbMTIsIDRdLmluZGV4T2YoZSkpIHJldHVybiAxID09IGQuZmlsdGVyKGZ1bmN0aW9uKGYpIHsKICAgICAgICAgICAgICAgIHJldHVybiA0ID09IGYKICAgICAgICAgICAgfSkubGVuZ3RoICUgMiA/IDMgOiA0OwogICAgICAgICAgICBpZiAoMCA9PSBlICYmIDEgPT0gYikgcmV0dXJuIDA7CiAgICAgICAgICAgIGlmICgyID09IGUgfHwgMCA9PSBlIHx8IDEgPT0gZSkgcmV0dXJuIDE0ID09IGIgJiYgYy5ldmVyeShmdW5jdGlvbihmKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gMyA9PSBmCiAgICAgICAgICAgIH0pID8gMiA6IDE7CiAgICAgICAgICAgIGlmICgyID09IGIgfHwgMCA9PSBiIHx8IDEgPT0gYikgcmV0dXJuIDE7CiAgICAgICAgICAgIGlmICg2ICE9IGUgfHwgNiAhPSBiICYmIDcgIT0gYiAmJiA5ICE9IGIgJiYgMTAgIT0gYikKICAgICAgICAgICAgICAgIGlmICg5ICE9IGUgJiYgNyAhPSBlIHx8IDcgIT0gYiAmJiA4ICE9IGIpCiAgICAgICAgICAgICAgICAgICAgaWYgKDEwICE9IGUgJiYgOCAhPSBlIHx8IDggIT0gYikgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoMyA9PSBiIHx8IDE1ID09IGIgfHwgNSA9PSBiIHx8IDEyID09IGUpIHJldHVybiAwCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHJldHVybiAwOwogICAgICAgICAgICBlbHNlIHJldHVybiAwOwogICAgICAgICAgICBlbHNlIHJldHVybiAwOwogICAgICAgICAgICBhID0gLTEgIT0gZC5pbmRleE9mKDMpID8gZC5sYXN0SW5kZXhPZigzKSAtIDEgOiBkLmxlbmd0aCAtIDI7CiAgICAgICAgICAgIHJldHVybiAtMSAhPSBbMTMsIDE3XS5pbmRleE9mKGRbYV0pICYmIGQuc2xpY2UoYSArCiAgICAgICAgICAgICAgICAxLCAtMSkuZXZlcnkoZnVuY3Rpb24oZikgewogICAgICAgICAgICAgICAgcmV0dXJuIDMgPT0gZgogICAgICAgICAgICB9KSAmJiAxNCA9PSBiIHx8IDE1ID09IGUgJiYgLTEgIT0gWzE2LCAxN10uaW5kZXhPZihiKSA/IDAgOiAtMSAhPSBjLmluZGV4T2YoNCkgPyAyIDogNCA9PSBlICYmIDQgPT0gYiA/IDAgOiAxCiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBrKGEpIHsKICAgICAgICAgICAgcmV0dXJuIDE1MzYgPD0gYSAmJiAxNTQxID49IGEgfHwgMTc1NyA9PSBhIHx8IDE4MDcgPT0gYSB8fCAyMjc0ID09IGEgfHwgMzQwNiA9PSBhIHx8IDY5ODIxID09IGEgfHwgNzAwODIgPD0gYSAmJiA3MDA4MyA+PSBhIHx8IDcyMjUwID09IGEgfHwgNzIzMjYgPD0gYSAmJiA3MjMyOSA+PSBhIHx8IDczMDMwID09IGEgPyAxMiA6IDEzID09IGEgPyAwIDogMTAgPT0gYSA/IDEgOiAwIDw9IGEgJiYgOSA+PSBhIHx8IDExIDw9IGEgJiYgMTIgPj0gYSB8fCAxNCA8PSBhICYmIDMxID49IGEgfHwgMTI3IDw9IGEgJiYgMTU5ID49IGEgfHwgMTczID09IGEgfHwgMTU2NCA9PSBhIHx8IDYxNTggPT0gYSB8fCA4MjAzID09IGEgfHwgODIwNiA8PSBhICYmIDgyMDcgPj0gYSB8fCA4MjMyID09IGEgfHwgODIzMyA9PSBhIHx8IDgyMzQgPD0gYSAmJiA4MjM4ID49IGEgfHwgODI4OCA8PSBhICYmIDgyOTIgPj0gYSB8fCA4MjkzID09IGEgfHwgODI5NCA8PSBhICYmIDgzMDMgPj0gYSB8fCA1NTI5NiA8PSBhICYmIDU3MzQzID49IGEgfHwgNjUyNzkgPT0gYSB8fCA2NTUyMCA8PQogICAgICAgICAgICAgICAgYSAmJiA2NTUyOCA+PSBhIHx8IDY1NTI5IDw9IGEgJiYgNjU1MzEgPj0gYSB8fCAxMTM4MjQgPD0gYSAmJiAxMTM4MjcgPj0gYSB8fCAxMTkxNTUgPD0gYSAmJiAxMTkxNjIgPj0gYSB8fCA5MTc1MDQgPT0gYSB8fCA5MTc1MDUgPT0gYSB8fCA5MTc1MDYgPD0gYSAmJiA5MTc1MzUgPj0gYSB8fCA5MTc2MzIgPD0gYSAmJiA5MTc3NTkgPj0gYSB8fCA5MThFMyA8PSBhICYmIDkyMTU5OSA+PSBhID8gMiA6IDc2OCA8PSBhICYmIDg3OSA+PSBhIHx8IDExNTUgPD0gYSAmJiAxMTU5ID49IGEgfHwgMTE2MCA8PSBhICYmIDExNjEgPj0gYSB8fCAxNDI1IDw9IGEgJiYgMTQ2OSA+PSBhIHx8IDE0NzEgPT0gYSB8fCAxNDczIDw9IGEgJiYgMTQ3NCA+PSBhIHx8IDE0NzYgPD0gYSAmJiAxNDc3ID49IGEgfHwgMTQ3OSA9PSBhIHx8IDE1NTIgPD0gYSAmJiAxNTYyID49IGEgfHwgMTYxMSA8PSBhICYmIDE2MzEgPj0gYSB8fCAxNjQ4ID09IGEgfHwgMTc1MCA8PSBhICYmIDE3NTYgPj0gYSB8fCAxNzU5IDw9IGEgJiYgMTc2NCA+PSBhIHx8IDE3NjcgPD0gYSAmJiAxNzY4ID49IGEgfHwgMTc3MCA8PSBhICYmIDE3NzMgPj0gYSB8fCAxODA5ID09IGEgfHwgMTg0MCA8PSBhICYmIDE4NjYgPj0gYSB8fCAxOTU4IDw9IGEgJiYgMTk2OCA+PSBhIHx8IDIwMjcgPD0gYSAmJiAyMDM1ID49IGEgfHwgMjA3MCA8PSBhICYmIDIwNzMgPj0gYSB8fCAyMDc1IDw9IGEgJiYgMjA4MyA+PQogICAgICAgICAgICAgICAgYSB8fCAyMDg1IDw9IGEgJiYgMjA4NyA+PSBhIHx8IDIwODkgPD0gYSAmJiAyMDkzID49IGEgfHwgMjEzNyA8PSBhICYmIDIxMzkgPj0gYSB8fCAyMjYwIDw9IGEgJiYgMjI3MyA+PSBhIHx8IDIyNzUgPD0gYSAmJiAyMzA2ID49IGEgfHwgMjM2MiA9PSBhIHx8IDIzNjQgPT0gYSB8fCAyMzY5IDw9IGEgJiYgMjM3NiA+PSBhIHx8IDIzODEgPT0gYSB8fCAyMzg1IDw9IGEgJiYgMjM5MSA+PSBhIHx8IDI0MDIgPD0gYSAmJiAyNDAzID49IGEgfHwgMjQzMyA9PSBhIHx8IDI0OTIgPT0gYSB8fCAyNDk0ID09IGEgfHwgMjQ5NyA8PSBhICYmIDI1MDAgPj0gYSB8fCAyNTA5ID09IGEgfHwgMjUxOSA9PSBhIHx8IDI1MzAgPD0gYSAmJiAyNTMxID49IGEgfHwgMjU2MSA8PSBhICYmIDI1NjIgPj0gYSB8fCAyNjIwID09IGEgfHwgMjYyNSA8PSBhICYmIDI2MjYgPj0gYSB8fCAyNjMxIDw9IGEgJiYgMjYzMiA+PSBhIHx8IDI2MzUgPD0gYSAmJiAyNjM3ID49IGEgfHwgMjY0MSA9PSBhIHx8IDI2NzIgPD0gYSAmJiAyNjczID49IGEgfHwgMjY3NyA9PSBhIHx8IDI2ODkgPD0gYSAmJiAyNjkwID49IGEgfHwgMjc0OCA9PSBhIHx8IDI3NTMgPD0gYSAmJiAyNzU3ID49IGEgfHwgMjc1OSA8PSBhICYmIDI3NjAgPj0gYSB8fCAyNzY1ID09IGEgfHwgMjc4NiA8PSBhICYmIDI3ODcgPj0gYSB8fCAyODEwIDw9IGEgJiYgMjgxNSA+PSBhIHx8IDI4MTcgPT0gYSB8fCAyODc2ID09IGEgfHwgMjg3OCA9PQogICAgICAgICAgICAgICAgYSB8fCAyODc5ID09IGEgfHwgMjg4MSA8PSBhICYmIDI4ODQgPj0gYSB8fCAyODkzID09IGEgfHwgMjkwMiA9PSBhIHx8IDI5MDMgPT0gYSB8fCAyOTE0IDw9IGEgJiYgMjkxNSA+PSBhIHx8IDI5NDYgPT0gYSB8fCAzMDA2ID09IGEgfHwgMzAwOCA9PSBhIHx8IDMwMjEgPT0gYSB8fCAzMDMxID09IGEgfHwgMzA3MiA9PSBhIHx8IDMxMzQgPD0gYSAmJiAzMTM2ID49IGEgfHwgMzE0MiA8PSBhICYmIDMxNDQgPj0gYSB8fCAzMTQ2IDw9IGEgJiYgMzE0OSA+PSBhIHx8IDMxNTcgPD0gYSAmJiAzMTU4ID49IGEgfHwgMzE3MCA8PSBhICYmIDMxNzEgPj0gYSB8fCAzMjAxID09IGEgfHwgMzI2MCA9PSBhIHx8IDMyNjMgPT0gYSB8fCAzMjY2ID09IGEgfHwgMzI3MCA9PSBhIHx8IDMyNzYgPD0gYSAmJiAzMjc3ID49IGEgfHwgMzI4NSA8PSBhICYmIDMyODYgPj0gYSB8fCAzMjk4IDw9IGEgJiYgMzI5OSA+PSBhIHx8IDMzMjggPD0gYSAmJiAzMzI5ID49IGEgfHwgMzM4NyA8PSBhICYmIDMzODggPj0gYSB8fCAzMzkwID09IGEgfHwgMzM5MyA8PSBhICYmIDMzOTYgPj0gYSB8fCAzNDA1ID09IGEgfHwgMzQxNSA9PSBhIHx8IDM0MjYgPD0gYSAmJiAzNDI3ID49IGEgfHwgMzUzMCA9PSBhIHx8IDM1MzUgPT0gYSB8fCAzNTM4IDw9IGEgJiYgMzU0MCA+PSBhIHx8IDM1NDIgPT0gYSB8fCAzNTUxID09IGEgfHwgMzYzMyA9PSBhIHx8IDM2MzYgPD0gYSAmJiAzNjQyID49IGEgfHwgMzY1NSA8PQogICAgICAgICAgICAgICAgYSAmJiAzNjYyID49IGEgfHwgMzc2MSA9PSBhIHx8IDM3NjQgPD0gYSAmJiAzNzY5ID49IGEgfHwgMzc3MSA8PSBhICYmIDM3NzIgPj0gYSB8fCAzNzg0IDw9IGEgJiYgMzc4OSA+PSBhIHx8IDM4NjQgPD0gYSAmJiAzODY1ID49IGEgfHwgMzg5MyA9PSBhIHx8IDM4OTUgPT0gYSB8fCAzODk3ID09IGEgfHwgMzk1MyA8PSBhICYmIDM5NjYgPj0gYSB8fCAzOTY4IDw9IGEgJiYgMzk3MiA+PSBhIHx8IDM5NzQgPD0gYSAmJiAzOTc1ID49IGEgfHwgMzk4MSA8PSBhICYmIDM5OTEgPj0gYSB8fCAzOTkzIDw9IGEgJiYgNDAyOCA+PSBhIHx8IDQwMzggPT0gYSB8fCA0MTQxIDw9IGEgJiYgNDE0NCA+PSBhIHx8IDQxNDYgPD0gYSAmJiA0MTUxID49IGEgfHwgNDE1MyA8PSBhICYmIDQxNTQgPj0gYSB8fCA0MTU3IDw9IGEgJiYgNDE1OCA+PSBhIHx8IDQxODQgPD0gYSAmJiA0MTg1ID49IGEgfHwgNDE5MCA8PSBhICYmIDQxOTIgPj0gYSB8fCA0MjA5IDw9IGEgJiYgNDIxMiA+PSBhIHx8IDQyMjYgPT0gYSB8fCA0MjI5IDw9IGEgJiYgNDIzMCA+PSBhIHx8IDQyMzcgPT0gYSB8fCA0MjUzID09IGEgfHwgNDk1NyA8PSBhICYmIDQ5NTkgPj0gYSB8fCA1OTA2IDw9IGEgJiYgNTkwOCA+PSBhIHx8IDU5MzggPD0gYSAmJiA1OTQwID49IGEgfHwgNTk3MCA8PSBhICYmIDU5NzEgPj0gYSB8fCA2MDAyIDw9IGEgJiYgNjAwMyA+PSBhIHx8IDYwNjggPD0gYSAmJiA2MDY5ID49IGEgfHwgNjA3MSA8PQogICAgICAgICAgICAgICAgYSAmJiA2MDc3ID49IGEgfHwgNjA4NiA9PSBhIHx8IDYwODkgPD0gYSAmJiA2MDk5ID49IGEgfHwgNjEwOSA9PSBhIHx8IDYxNTUgPD0gYSAmJiA2MTU3ID49IGEgfHwgNjI3NyA8PSBhICYmIDYyNzggPj0gYSB8fCA2MzEzID09IGEgfHwgNjQzMiA8PSBhICYmIDY0MzQgPj0gYSB8fCA2NDM5IDw9IGEgJiYgNjQ0MCA+PSBhIHx8IDY0NTAgPT0gYSB8fCA2NDU3IDw9IGEgJiYgNjQ1OSA+PSBhIHx8IDY2NzkgPD0gYSAmJiA2NjgwID49IGEgfHwgNjY4MyA9PSBhIHx8IDY3NDIgPT0gYSB8fCA2NzQ0IDw9IGEgJiYgNjc1MCA+PSBhIHx8IDY3NTIgPT0gYSB8fCA2NzU0ID09IGEgfHwgNjc1NyA8PSBhICYmIDY3NjQgPj0gYSB8fCA2NzcxIDw9IGEgJiYgNjc4MCA+PSBhIHx8IDY3ODMgPT0gYSB8fCA2ODMyIDw9IGEgJiYgNjg0NSA+PSBhIHx8IDY4NDYgPT0gYSB8fCA2OTEyIDw9IGEgJiYgNjkxNSA+PSBhIHx8IDY5NjQgPT0gYSB8fCA2OTY2IDw9IGEgJiYgNjk3MCA+PSBhIHx8IDY5NzIgPT0gYSB8fCA2OTc4ID09IGEgfHwgNzAxOSA8PSBhICYmIDcwMjcgPj0gYSB8fCA3MDQwIDw9IGEgJiYgNzA0MSA+PSBhIHx8IDcwNzQgPD0gYSAmJiA3MDc3ID49IGEgfHwgNzA4MCA8PSBhICYmIDcwODEgPj0gYSB8fCA3MDgzIDw9IGEgJiYgNzA4NSA+PSBhIHx8IDcxNDIgPT0gYSB8fCA3MTQ0IDw9IGEgJiYgNzE0NSA+PSBhIHx8IDcxNDkgPT0gYSB8fCA3MTUxIDw9IGEgJiYgNzE1MyA+PQogICAgICAgICAgICAgICAgYSB8fCA3MjEyIDw9IGEgJiYgNzIxOSA+PSBhIHx8IDcyMjIgPD0gYSAmJiA3MjIzID49IGEgfHwgNzM3NiA8PSBhICYmIDczNzggPj0gYSB8fCA3MzgwIDw9IGEgJiYgNzM5MiA+PSBhIHx8IDczOTQgPD0gYSAmJiA3NDAwID49IGEgfHwgNzQwNSA9PSBhIHx8IDc0MTIgPT0gYSB8fCA3NDE2IDw9IGEgJiYgNzQxNyA+PSBhIHx8IDc2MTYgPD0gYSAmJiA3NjczID49IGEgfHwgNzY3NSA8PSBhICYmIDc2NzkgPj0gYSB8fCA4MjA0ID09IGEgfHwgODQwMCA8PSBhICYmIDg0MTIgPj0gYSB8fCA4NDEzIDw9IGEgJiYgODQxNiA+PSBhIHx8IDg0MTcgPT0gYSB8fCA4NDE4IDw9IGEgJiYgODQyMCA+PSBhIHx8IDg0MjEgPD0gYSAmJiA4NDMyID49IGEgfHwgMTE1MDMgPD0gYSAmJiAxMTUwNSA+PSBhIHx8IDExNjQ3ID09IGEgfHwgMTE3NDQgPD0gYSAmJiAxMTc3NSA+PSBhIHx8IDEyMzMwIDw9IGEgJiYgMTIzMzMgPj0gYSB8fCAxMjMzNCA8PSBhICYmIDEyMzM1ID49IGEgfHwgMTI0NDEgPD0gYSAmJiAxMjQ0MiA+PSBhIHx8IDQyNjA3ID09IGEgfHwgNDI2MDggPD0gYSAmJiA0MjYxMCA+PSBhIHx8IDQyNjEyIDw9IGEgJiYgNDI2MjEgPj0gYSB8fCA0MjY1NCA8PSBhICYmIDQyNjU1ID49IGEgfHwgNDI3MzYgPD0gYSAmJiA0MjczNyA+PSBhIHx8IDQzMDEwID09IGEgfHwgNDMwMTQgPT0gYSB8fCA0MzAxOSA9PSBhIHx8IDQzMDQ1IDw9IGEgJiYgNDMwNDYgPj0KICAgICAgICAgICAgICAgIGEgfHwgNDMyMDQgPD0gYSAmJiA0MzIwNSA+PSBhIHx8IDQzMjMyIDw9IGEgJiYgNDMyNDkgPj0gYSB8fCA0MzMwMiA8PSBhICYmIDQzMzA5ID49IGEgfHwgNDMzMzUgPD0gYSAmJiA0MzM0NSA+PSBhIHx8IDQzMzkyIDw9IGEgJiYgNDMzOTQgPj0gYSB8fCA0MzQ0MyA9PSBhIHx8IDQzNDQ2IDw9IGEgJiYgNDM0NDkgPj0gYSB8fCA0MzQ1MiA9PSBhIHx8IDQzNDkzID09IGEgfHwgNDM1NjEgPD0gYSAmJiA0MzU2NiA+PSBhIHx8IDQzNTY5IDw9IGEgJiYgNDM1NzAgPj0gYSB8fCA0MzU3MyA8PSBhICYmIDQzNTc0ID49IGEgfHwgNDM1ODcgPT0gYSB8fCA0MzU5NiA9PSBhIHx8IDQzNjQ0ID09IGEgfHwgNDM2OTYgPT0gYSB8fCA0MzY5OCA8PSBhICYmIDQzNzAwID49IGEgfHwgNDM3MDMgPD0gYSAmJiA0MzcwNCA+PSBhIHx8IDQzNzEwIDw9IGEgJiYgNDM3MTEgPj0gYSB8fCA0MzcxMyA9PSBhIHx8IDQzNzU2IDw9IGEgJiYgNDM3NTcgPj0gYSB8fCA0Mzc2NiA9PSBhIHx8IDQ0MDA1ID09IGEgfHwgNDQwMDggPT0gYSB8fCA0NDAxMyA9PSBhIHx8IDY0Mjg2ID09IGEgfHwgNjUwMjQgPD0gYSAmJiA2NTAzOSA+PSBhIHx8IDY1MDU2IDw9IGEgJiYgNjUwNzEgPj0gYSB8fCA2NTQzOCA8PSBhICYmIDY1NDM5ID49IGEgfHwgNjYwNDUgPT0gYSB8fCA2NjI3MiA9PSBhIHx8IDY2NDIyIDw9IGEgJiYgNjY0MjYgPj0gYSB8fCA2ODA5NyA8PSBhICYmCiAgICAgICAgICAgICAgICA2ODA5OSA+PSBhIHx8IDY4MTAxIDw9IGEgJiYgNjgxMDIgPj0gYSB8fCA2ODEwOCA8PSBhICYmIDY4MTExID49IGEgfHwgNjgxNTIgPD0gYSAmJiA2ODE1NCA+PSBhIHx8IDY4MTU5ID09IGEgfHwgNjgzMjUgPD0gYSAmJiA2ODMyNiA+PSBhIHx8IDY5NjMzID09IGEgfHwgNjk2ODggPD0gYSAmJiA2OTcwMiA+PSBhIHx8IDY5NzU5IDw9IGEgJiYgNjk3NjEgPj0gYSB8fCA2OTgxMSA8PSBhICYmIDY5ODE0ID49IGEgfHwgNjk4MTcgPD0gYSAmJiA2OTgxOCA+PSBhIHx8IDY5ODg4IDw9IGEgJiYgNjk4OTAgPj0gYSB8fCA2OTkyNyA8PSBhICYmIDY5OTMxID49IGEgfHwgNjk5MzMgPD0gYSAmJiA2OTk0MCA+PSBhIHx8IDcwMDAzID09IGEgfHwgNzAwMTYgPD0gYSAmJiA3MDAxNyA+PSBhIHx8IDcwMDcwIDw9IGEgJiYgNzAwNzggPj0gYSB8fCA3MDA5MCA8PSBhICYmIDcwMDkyID49IGEgfHwgNzAxOTEgPD0gYSAmJiA3MDE5MyA+PSBhIHx8IDcwMTk2ID09IGEgfHwgNzAxOTggPD0gYSAmJiA3MDE5OSA+PSBhIHx8IDcwMjA2ID09IGEgfHwgNzAzNjcgPT0gYSB8fCA3MDM3MSA8PSBhICYmIDcwMzc4ID49IGEgfHwgNzA0MDAgPD0gYSAmJiA3MDQwMSA+PSBhIHx8IDcwNDYwID09IGEgfHwgNzA0NjIgPT0gYSB8fCA3MDQ2NCA9PSBhIHx8IDcwNDg3ID09IGEgfHwgNzA1MDIgPD0gYSAmJiA3MDUwOCA+PSBhIHx8IDcwNTEyIDw9IGEgJiYgNzA1MTYgPj0KICAgICAgICAgICAgICAgIGEgfHwgNzA3MTIgPD0gYSAmJiA3MDcxOSA+PSBhIHx8IDcwNzIyIDw9IGEgJiYgNzA3MjQgPj0gYSB8fCA3MDcyNiA9PSBhIHx8IDcwODMyID09IGEgfHwgNzA4MzUgPD0gYSAmJiA3MDg0MCA+PSBhIHx8IDcwODQyID09IGEgfHwgNzA4NDUgPT0gYSB8fCA3MDg0NyA8PSBhICYmIDcwODQ4ID49IGEgfHwgNzA4NTAgPD0gYSAmJiA3MDg1MSA+PSBhIHx8IDcxMDg3ID09IGEgfHwgNzEwOTAgPD0gYSAmJiA3MTA5MyA+PSBhIHx8IDcxMTAwIDw9IGEgJiYgNzExMDEgPj0gYSB8fCA3MTEwMyA8PSBhICYmIDcxMTA0ID49IGEgfHwgNzExMzIgPD0gYSAmJiA3MTEzMyA+PSBhIHx8IDcxMjE5IDw9IGEgJiYgNzEyMjYgPj0gYSB8fCA3MTIyOSA9PSBhIHx8IDcxMjMxIDw9IGEgJiYgNzEyMzIgPj0gYSB8fCA3MTMzOSA9PSBhIHx8IDcxMzQxID09IGEgfHwgNzEzNDQgPD0gYSAmJiA3MTM0OSA+PSBhIHx8IDcxMzUxID09IGEgfHwgNzE0NTMgPD0gYSAmJiA3MTQ1NSA+PSBhIHx8IDcxNDU4IDw9IGEgJiYgNzE0NjEgPj0gYSB8fCA3MTQ2MyA8PSBhICYmIDcxNDY3ID49IGEgfHwgNzIxOTMgPD0gYSAmJiA3MjE5OCA+PSBhIHx8IDcyMjAxIDw9IGEgJiYgNzIyMDIgPj0gYSB8fCA3MjI0MyA8PSBhICYmIDcyMjQ4ID49IGEgfHwgNzIyNTEgPD0gYSAmJiA3MjI1NCA+PSBhIHx8IDcyMjYzID09IGEgfHwgNzIyNzMgPD0gYSAmJiA3MjI3OCA+PSBhIHx8CiAgICAgICAgICAgICAgICA3MjI4MSA8PSBhICYmIDcyMjgzID49IGEgfHwgNzIzMzAgPD0gYSAmJiA3MjM0MiA+PSBhIHx8IDcyMzQ0IDw9IGEgJiYgNzIzNDUgPj0gYSB8fCA3Mjc1MiA8PSBhICYmIDcyNzU4ID49IGEgfHwgNzI3NjAgPD0gYSAmJiA3Mjc2NSA+PSBhIHx8IDcyNzY3ID09IGEgfHwgNzI4NTAgPD0gYSAmJiA3Mjg3MSA+PSBhIHx8IDcyODc0IDw9IGEgJiYgNzI4ODAgPj0gYSB8fCA3Mjg4MiA8PSBhICYmIDcyODgzID49IGEgfHwgNzI4ODUgPD0gYSAmJiA3Mjg4NiA+PSBhIHx8IDczMDA5IDw9IGEgJiYgNzMwMTQgPj0gYSB8fCA3MzAxOCA9PSBhIHx8IDczMDIwIDw9IGEgJiYgNzMwMjEgPj0gYSB8fCA3MzAyMyA8PSBhICYmIDczMDI5ID49IGEgfHwgNzMwMzEgPT0gYSB8fCA5MjkxMiA8PSBhICYmIDkyOTE2ID49IGEgfHwgOTI5NzYgPD0gYSAmJiA5Mjk4MiA+PSBhIHx8IDk0MDk1IDw9IGEgJiYgOTQwOTggPj0gYSB8fCAxMTM4MjEgPD0gYSAmJiAxMTM4MjIgPj0gYSB8fCAxMTkxNDEgPT0gYSB8fCAxMTkxNDMgPD0gYSAmJiAxMTkxNDUgPj0gYSB8fCAxMTkxNTAgPD0gYSAmJiAxMTkxNTQgPj0gYSB8fCAxMTkxNjMgPD0gYSAmJiAxMTkxNzAgPj0gYSB8fCAxMTkxNzMgPD0gYSAmJiAxMTkxNzkgPj0gYSB8fCAxMTkyMTAgPD0gYSAmJiAxMTkyMTMgPj0gYSB8fCAxMTkzNjIgPD0gYSAmJiAxMTkzNjQgPj0gYSB8fCAxMjEzNDQgPD0KICAgICAgICAgICAgICAgIGEgJiYgMTIxMzk4ID49IGEgfHwgMTIxNDAzIDw9IGEgJiYgMTIxNDUyID49IGEgfHwgMTIxNDYxID09IGEgfHwgMTIxNDc2ID09IGEgfHwgMTIxNDk5IDw9IGEgJiYgMTIxNTAzID49IGEgfHwgMTIxNTA1IDw9IGEgJiYgMTIxNTE5ID49IGEgfHwgMTIyODgwIDw9IGEgJiYgMTIyODg2ID49IGEgfHwgMTIyODg4IDw9IGEgJiYgMTIyOTA0ID49IGEgfHwgMTIyOTA3IDw9IGEgJiYgMTIyOTEzID49IGEgfHwgMTIyOTE1IDw9IGEgJiYgMTIyOTE2ID49IGEgfHwgMTIyOTE4IDw9IGEgJiYgMTIyOTIyID49IGEgfHwgMTI1MTM2IDw9IGEgJiYgMTI1MTQyID49IGEgfHwgMTI1MjUyIDw9IGEgJiYgMTI1MjU4ID49IGEgfHwgOTE3NTM2IDw9IGEgJiYgOTE3NjMxID49IGEgfHwgOTE3NzYwIDw9IGEgJiYgOTE3OTk5ID49IGEgPyAzIDogMTI3NDYyIDw9IGEgJiYgMTI3NDg3ID49IGEgPyA0IDogMjMwNyA9PSBhIHx8IDIzNjMgPT0gYSB8fCAyMzY2IDw9IGEgJiYgMjM2OCA+PSBhIHx8IDIzNzcgPD0gYSAmJiAyMzgwID49IGEgfHwgMjM4MiA8PSBhICYmIDIzODMgPj0gYSB8fCAyNDM0IDw9IGEgJiYgMjQzNSA+PSBhIHx8IDI0OTUgPD0gYSAmJiAyNDk2ID49IGEgfHwgMjUwMyA8PSBhICYmIDI1MDQgPj0gYSB8fCAyNTA3IDw9IGEgJiYgMjUwOCA+PSBhIHx8IDI1NjMgPT0gYSB8fCAyNjIyIDw9IGEgJiYgMjYyNCA+PSBhIHx8IDI2OTEgPT0KICAgICAgICAgICAgICAgIGEgfHwgMjc1MCA8PSBhICYmIDI3NTIgPj0gYSB8fCAyNzYxID09IGEgfHwgMjc2MyA8PSBhICYmIDI3NjQgPj0gYSB8fCAyODE4IDw9IGEgJiYgMjgxOSA+PSBhIHx8IDI4ODAgPT0gYSB8fCAyODg3IDw9IGEgJiYgMjg4OCA+PSBhIHx8IDI4OTEgPD0gYSAmJiAyODkyID49IGEgfHwgMzAwNyA9PSBhIHx8IDMwMDkgPD0gYSAmJiAzMDEwID49IGEgfHwgMzAxNCA8PSBhICYmIDMwMTYgPj0gYSB8fCAzMDE4IDw9IGEgJiYgMzAyMCA+PSBhIHx8IDMwNzMgPD0gYSAmJiAzMDc1ID49IGEgfHwgMzEzNyA8PSBhICYmIDMxNDAgPj0gYSB8fCAzMjAyIDw9IGEgJiYgMzIwMyA+PSBhIHx8IDMyNjIgPT0gYSB8fCAzMjY0IDw9IGEgJiYgMzI2NSA+PSBhIHx8IDMyNjcgPD0gYSAmJiAzMjY4ID49IGEgfHwgMzI3MSA8PSBhICYmIDMyNzIgPj0gYSB8fCAzMjc0IDw9IGEgJiYgMzI3NSA+PSBhIHx8IDMzMzAgPD0gYSAmJiAzMzMxID49IGEgfHwgMzM5MSA8PSBhICYmIDMzOTIgPj0gYSB8fCAzMzk4IDw9IGEgJiYgMzQwMCA+PSBhIHx8IDM0MDIgPD0gYSAmJiAzNDA0ID49IGEgfHwgMzQ1OCA8PSBhICYmIDM0NTkgPj0gYSB8fCAzNTM2IDw9IGEgJiYgMzUzNyA+PSBhIHx8IDM1NDQgPD0gYSAmJiAzNTUwID49IGEgfHwgMzU3MCA8PSBhICYmIDM1NzEgPj0gYSB8fCAzNjM1ID09IGEgfHwgMzc2MyA9PSBhIHx8IDM5MDIgPD0gYSAmJiAzOTAzID49IGEgfHwgMzk2NyA9PSBhIHx8IDQxNDUgPT0KICAgICAgICAgICAgICAgIGEgfHwgNDE1NSA8PSBhICYmIDQxNTYgPj0gYSB8fCA0MTgyIDw9IGEgJiYgNDE4MyA+PSBhIHx8IDQyMjggPT0gYSB8fCA2MDcwID09IGEgfHwgNjA3OCA8PSBhICYmIDYwODUgPj0gYSB8fCA2MDg3IDw9IGEgJiYgNjA4OCA+PSBhIHx8IDY0MzUgPD0gYSAmJiA2NDM4ID49IGEgfHwgNjQ0MSA8PSBhICYmIDY0NDMgPj0gYSB8fCA2NDQ4IDw9IGEgJiYgNjQ0OSA+PSBhIHx8IDY0NTEgPD0gYSAmJiA2NDU2ID49IGEgfHwgNjY4MSA8PSBhICYmIDY2ODIgPj0gYSB8fCA2NzQxID09IGEgfHwgNjc0MyA9PSBhIHx8IDY3NjUgPD0gYSAmJiA2NzcwID49IGEgfHwgNjkxNiA9PSBhIHx8IDY5NjUgPT0gYSB8fCA2OTcxID09IGEgfHwgNjk3MyA8PSBhICYmIDY5NzcgPj0gYSB8fCA2OTc5IDw9IGEgJiYgNjk4MCA+PSBhIHx8IDcwNDIgPT0gYSB8fCA3MDczID09IGEgfHwgNzA3OCA8PSBhICYmIDcwNzkgPj0gYSB8fCA3MDgyID09IGEgfHwgNzE0MyA9PSBhIHx8IDcxNDYgPD0gYSAmJiA3MTQ4ID49IGEgfHwgNzE1MCA9PSBhIHx8IDcxNTQgPD0gYSAmJiA3MTU1ID49IGEgfHwgNzIwNCA8PSBhICYmIDcyMTEgPj0gYSB8fCA3MjIwIDw9IGEgJiYgNzIyMSA+PSBhIHx8IDczOTMgPT0gYSB8fCA3NDEwIDw9IGEgJiYgNzQxMSA+PSBhIHx8IDc0MTUgPT0gYSB8fCA0MzA0MyA8PSBhICYmIDQzMDQ0ID49IGEgfHwgNDMwNDcgPT0gYSB8fCA0MzEzNiA8PSBhICYmIDQzMTM3ID49IGEgfHwKICAgICAgICAgICAgICAgIDQzMTg4IDw9IGEgJiYgNDMyMDMgPj0gYSB8fCA0MzM0NiA8PSBhICYmIDQzMzQ3ID49IGEgfHwgNDMzOTUgPT0gYSB8fCA0MzQ0NCA8PSBhICYmIDQzNDQ1ID49IGEgfHwgNDM0NTAgPD0gYSAmJiA0MzQ1MSA+PSBhIHx8IDQzNDUzIDw9IGEgJiYgNDM0NTYgPj0gYSB8fCA0MzU2NyA8PSBhICYmIDQzNTY4ID49IGEgfHwgNDM1NzEgPD0gYSAmJiA0MzU3MiA+PSBhIHx8IDQzNTk3ID09IGEgfHwgNDM3NTUgPT0gYSB8fCA0Mzc1OCA8PSBhICYmIDQzNzU5ID49IGEgfHwgNDM3NjUgPT0gYSB8fCA0NDAwMyA8PSBhICYmIDQ0MDA0ID49IGEgfHwgNDQwMDYgPD0gYSAmJiA0NDAwNyA+PSBhIHx8IDQ0MDA5IDw9IGEgJiYgNDQwMTAgPj0gYSB8fCA0NDAxMiA9PSBhIHx8IDY5NjMyID09IGEgfHwgNjk2MzQgPT0gYSB8fCA2OTc2MiA9PSBhIHx8IDY5ODA4IDw9IGEgJiYgNjk4MTAgPj0gYSB8fCA2OTgxNSA8PSBhICYmIDY5ODE2ID49IGEgfHwgNjk5MzIgPT0gYSB8fCA3MDAxOCA9PSBhIHx8IDcwMDY3IDw9IGEgJiYgNzAwNjkgPj0gYSB8fCA3MDA3OSA8PSBhICYmIDcwMDgwID49IGEgfHwgNzAxODggPD0gYSAmJiA3MDE5MCA+PSBhIHx8IDcwMTk0IDw9IGEgJiYgNzAxOTUgPj0gYSB8fCA3MDE5NyA9PSBhIHx8IDcwMzY4IDw9IGEgJiYgNzAzNzAgPj0gYSB8fCA3MDQwMiA8PSBhICYmIDcwNDAzID49IGEgfHwgNzA0NjMgPT0gYSB8fCA3MDQ2NSA8PQogICAgICAgICAgICAgICAgYSAmJiA3MDQ2OCA+PSBhIHx8IDcwNDcxIDw9IGEgJiYgNzA0NzIgPj0gYSB8fCA3MDQ3NSA8PSBhICYmIDcwNDc3ID49IGEgfHwgNzA0OTggPD0gYSAmJiA3MDQ5OSA+PSBhIHx8IDcwNzA5IDw9IGEgJiYgNzA3MTEgPj0gYSB8fCA3MDcyMCA8PSBhICYmIDcwNzIxID49IGEgfHwgNzA3MjUgPT0gYSB8fCA3MDgzMyA8PSBhICYmIDcwODM0ID49IGEgfHwgNzA4NDEgPT0gYSB8fCA3MDg0MyA8PSBhICYmIDcwODQ0ID49IGEgfHwgNzA4NDYgPT0gYSB8fCA3MDg0OSA9PSBhIHx8IDcxMDg4IDw9IGEgJiYgNzEwODkgPj0gYSB8fCA3MTA5NiA8PSBhICYmIDcxMDk5ID49IGEgfHwgNzExMDIgPT0gYSB8fCA3MTIxNiA8PSBhICYmIDcxMjE4ID49IGEgfHwgNzEyMjcgPD0gYSAmJiA3MTIyOCA+PSBhIHx8IDcxMjMwID09IGEgfHwgNzEzNDAgPT0gYSB8fCA3MTM0MiA8PSBhICYmIDcxMzQzID49IGEgfHwgNzEzNTAgPT0gYSB8fCA3MTQ1NiA8PSBhICYmIDcxNDU3ID49IGEgfHwgNzE0NjIgPT0gYSB8fCA3MjE5OSA8PSBhICYmIDcyMjAwID49IGEgfHwgNzIyNDkgPT0gYSB8fCA3MjI3OSA8PSBhICYmIDcyMjgwID49IGEgfHwgNzIzNDMgPT0gYSB8fCA3Mjc1MSA9PSBhIHx8IDcyNzY2ID09IGEgfHwgNzI4NzMgPT0gYSB8fCA3Mjg4MSA9PSBhIHx8IDcyODg0ID09IGEgfHwgOTQwMzMgPD0gYSAmJiA5NDA3OCA+PSBhIHx8IDExOTE0MiA9PQogICAgICAgICAgICAgICAgYSB8fCAxMTkxNDkgPT0gYSA/IDUgOiA0MzUyIDw9IGEgJiYgNDQ0NyA+PSBhIHx8IDQzMzYwIDw9IGEgJiYgNDMzODggPj0gYSA/IDYgOiA0NDQ4IDw9IGEgJiYgNDUxOSA+PSBhIHx8IDU1MjE2IDw9IGEgJiYgNTUyMzggPj0gYSA/IDcgOiA0NTIwIDw9IGEgJiYgNDYwNyA+PSBhIHx8IDU1MjQzIDw9IGEgJiYgNTUyOTEgPj0gYSA/IDggOiA0NDAzMiA9PSBhIHx8IDQ0MDYwID09IGEgfHwgNDQwODggPT0gYSB8fCA0NDExNiA9PSBhIHx8IDQ0MTQ0ID09IGEgfHwgNDQxNzIgPT0gYSB8fCA0NDIwMCA9PSBhIHx8IDQ0MjI4ID09IGEgfHwgNDQyNTYgPT0gYSB8fCA0NDI4NCA9PSBhIHx8IDQ0MzEyID09IGEgfHwgNDQzNDAgPT0gYSB8fCA0NDM2OCA9PSBhIHx8IDQ0Mzk2ID09IGEgfHwgNDQ0MjQgPT0gYSB8fCA0NDQ1MiA9PSBhIHx8IDQ0NDgwID09IGEgfHwgNDQ1MDggPT0gYSB8fCA0NDUzNiA9PSBhIHx8IDQ0NTY0ID09IGEgfHwgNDQ1OTIgPT0gYSB8fCA0NDYyMCA9PSBhIHx8IDQ0NjQ4ID09IGEgfHwgNDQ2NzYgPT0gYSB8fCA0NDcwNCA9PSBhIHx8IDQ0NzMyID09IGEgfHwgNDQ3NjAgPT0gYSB8fCA0NDc4OCA9PSBhIHx8IDQ0ODE2ID09IGEgfHwgNDQ4NDQgPT0gYSB8fCA0NDg3MiA9PSBhIHx8IDQ0OTAwID09IGEgfHwgNDQ5MjggPT0gYSB8fCA0NDk1NiA9PSBhIHx8IDQ0OTg0ID09IGEgfHwgNDUwMTIgPT0gYSB8fCA0NTA0MCA9PSBhIHx8CiAgICAgICAgICAgICAgICA0NTA2OCA9PSBhIHx8IDQ1MDk2ID09IGEgfHwgNDUxMjQgPT0gYSB8fCA0NTE1MiA9PSBhIHx8IDQ1MTgwID09IGEgfHwgNDUyMDggPT0gYSB8fCA0NTIzNiA9PSBhIHx8IDQ1MjY0ID09IGEgfHwgNDUyOTIgPT0gYSB8fCA0NTMyMCA9PSBhIHx8IDQ1MzQ4ID09IGEgfHwgNDUzNzYgPT0gYSB8fCA0NTQwNCA9PSBhIHx8IDQ1NDMyID09IGEgfHwgNDU0NjAgPT0gYSB8fCA0NTQ4OCA9PSBhIHx8IDQ1NTE2ID09IGEgfHwgNDU1NDQgPT0gYSB8fCA0NTU3MiA9PSBhIHx8IDQ1NjAwID09IGEgfHwgNDU2MjggPT0gYSB8fCA0NTY1NiA9PSBhIHx8IDQ1Njg0ID09IGEgfHwgNDU3MTIgPT0gYSB8fCA0NTc0MCA9PSBhIHx8IDQ1NzY4ID09IGEgfHwgNDU3OTYgPT0gYSB8fCA0NTgyNCA9PSBhIHx8IDQ1ODUyID09IGEgfHwgNDU4ODAgPT0gYSB8fCA0NTkwOCA9PSBhIHx8IDQ1OTM2ID09IGEgfHwgNDU5NjQgPT0gYSB8fCA0NTk5MiA9PSBhIHx8IDQ2MDIwID09IGEgfHwgNDYwNDggPT0gYSB8fCA0NjA3NiA9PSBhIHx8IDQ2MTA0ID09IGEgfHwgNDYxMzIgPT0gYSB8fCA0NjE2MCA9PSBhIHx8IDQ2MTg4ID09IGEgfHwgNDYyMTYgPT0gYSB8fCA0NjI0NCA9PSBhIHx8IDQ2MjcyID09IGEgfHwgNDYzMDAgPT0gYSB8fCA0NjMyOCA9PSBhIHx8IDQ2MzU2ID09IGEgfHwgNDYzODQgPT0gYSB8fCA0NjQxMiA9PSBhIHx8IDQ2NDQwID09IGEgfHwgNDY0NjggPT0KICAgICAgICAgICAgICAgIGEgfHwgNDY0OTYgPT0gYSB8fCA0NjUyNCA9PSBhIHx8IDQ2NTUyID09IGEgfHwgNDY1ODAgPT0gYSB8fCA0NjYwOCA9PSBhIHx8IDQ2NjM2ID09IGEgfHwgNDY2NjQgPT0gYSB8fCA0NjY5MiA9PSBhIHx8IDQ2NzIwID09IGEgfHwgNDY3NDggPT0gYSB8fCA0Njc3NiA9PSBhIHx8IDQ2ODA0ID09IGEgfHwgNDY4MzIgPT0gYSB8fCA0Njg2MCA9PSBhIHx8IDQ2ODg4ID09IGEgfHwgNDY5MTYgPT0gYSB8fCA0Njk0NCA9PSBhIHx8IDQ2OTcyID09IGEgfHwgNDdFMyA9PSBhIHx8IDQ3MDI4ID09IGEgfHwgNDcwNTYgPT0gYSB8fCA0NzA4NCA9PSBhIHx8IDQ3MTEyID09IGEgfHwgNDcxNDAgPT0gYSB8fCA0NzE2OCA9PSBhIHx8IDQ3MTk2ID09IGEgfHwgNDcyMjQgPT0gYSB8fCA0NzI1MiA9PSBhIHx8IDQ3MjgwID09IGEgfHwgNDczMDggPT0gYSB8fCA0NzMzNiA9PSBhIHx8IDQ3MzY0ID09IGEgfHwgNDczOTIgPT0gYSB8fCA0NzQyMCA9PSBhIHx8IDQ3NDQ4ID09IGEgfHwgNDc0NzYgPT0gYSB8fCA0NzUwNCA9PSBhIHx8IDQ3NTMyID09IGEgfHwgNDc1NjAgPT0gYSB8fCA0NzU4OCA9PSBhIHx8IDQ3NjE2ID09IGEgfHwgNDc2NDQgPT0gYSB8fCA0NzY3MiA9PSBhIHx8IDQ3NzAwID09IGEgfHwgNDc3MjggPT0gYSB8fCA0Nzc1NiA9PSBhIHx8IDQ3Nzg0ID09IGEgfHwgNDc4MTIgPT0gYSB8fCA0Nzg0MCA9PSBhIHx8IDQ3ODY4ID09IGEgfHwKICAgICAgICAgICAgICAgIDQ3ODk2ID09IGEgfHwgNDc5MjQgPT0gYSB8fCA0Nzk1MiA9PSBhIHx8IDQ3OTgwID09IGEgfHwgNDgwMDggPT0gYSB8fCA0ODAzNiA9PSBhIHx8IDQ4MDY0ID09IGEgfHwgNDgwOTIgPT0gYSB8fCA0ODEyMCA9PSBhIHx8IDQ4MTQ4ID09IGEgfHwgNDgxNzYgPT0gYSB8fCA0ODIwNCA9PSBhIHx8IDQ4MjMyID09IGEgfHwgNDgyNjAgPT0gYSB8fCA0ODI4OCA9PSBhIHx8IDQ4MzE2ID09IGEgfHwgNDgzNDQgPT0gYSB8fCA0ODM3MiA9PSBhIHx8IDQ4NDAwID09IGEgfHwgNDg0MjggPT0gYSB8fCA0ODQ1NiA9PSBhIHx8IDQ4NDg0ID09IGEgfHwgNDg1MTIgPT0gYSB8fCA0ODU0MCA9PSBhIHx8IDQ4NTY4ID09IGEgfHwgNDg1OTYgPT0gYSB8fCA0ODYyNCA9PSBhIHx8IDQ4NjUyID09IGEgfHwgNDg2ODAgPT0gYSB8fCA0ODcwOCA9PSBhIHx8IDQ4NzM2ID09IGEgfHwgNDg3NjQgPT0gYSB8fCA0ODc5MiA9PSBhIHx8IDQ4ODIwID09IGEgfHwgNDg4NDggPT0gYSB8fCA0ODg3NiA9PSBhIHx8IDQ4OTA0ID09IGEgfHwgNDg5MzIgPT0gYSB8fCA0ODk2MCA9PSBhIHx8IDQ4OTg4ID09IGEgfHwgNDkwMTYgPT0gYSB8fCA0OTA0NCA9PSBhIHx8IDQ5MDcyID09IGEgfHwgNDkxMDAgPT0gYSB8fCA0OTEyOCA9PSBhIHx8IDQ5MTU2ID09IGEgfHwgNDkxODQgPT0gYSB8fCA0OTIxMiA9PSBhIHx8IDQ5MjQwID09IGEgfHwgNDkyNjggPT0gYSB8fCA0OTI5NiA9PQogICAgICAgICAgICAgICAgYSB8fCA0OTMyNCA9PSBhIHx8IDQ5MzUyID09IGEgfHwgNDkzODAgPT0gYSB8fCA0OTQwOCA9PSBhIHx8IDQ5NDM2ID09IGEgfHwgNDk0NjQgPT0gYSB8fCA0OTQ5MiA9PSBhIHx8IDQ5NTIwID09IGEgfHwgNDk1NDggPT0gYSB8fCA0OTU3NiA9PSBhIHx8IDQ5NjA0ID09IGEgfHwgNDk2MzIgPT0gYSB8fCA0OTY2MCA9PSBhIHx8IDQ5Njg4ID09IGEgfHwgNDk3MTYgPT0gYSB8fCA0OTc0NCA9PSBhIHx8IDQ5NzcyID09IGEgfHwgNDk4MDAgPT0gYSB8fCA0OTgyOCA9PSBhIHx8IDQ5ODU2ID09IGEgfHwgNDk4ODQgPT0gYSB8fCA0OTkxMiA9PSBhIHx8IDQ5OTQwID09IGEgfHwgNDk5NjggPT0gYSB8fCA0OTk5NiA9PSBhIHx8IDUwMDI0ID09IGEgfHwgNTAwNTIgPT0gYSB8fCA1MDA4MCA9PSBhIHx8IDUwMTA4ID09IGEgfHwgNTAxMzYgPT0gYSB8fCA1MDE2NCA9PSBhIHx8IDUwMTkyID09IGEgfHwgNTAyMjAgPT0gYSB8fCA1MDI0OCA9PSBhIHx8IDUwMjc2ID09IGEgfHwgNTAzMDQgPT0gYSB8fCA1MDMzMiA9PSBhIHx8IDUwMzYwID09IGEgfHwgNTAzODggPT0gYSB8fCA1MDQxNiA9PSBhIHx8IDUwNDQ0ID09IGEgfHwgNTA0NzIgPT0gYSB8fCA1MDUwMCA9PSBhIHx8IDUwNTI4ID09IGEgfHwgNTA1NTYgPT0gYSB8fCA1MDU4NCA9PSBhIHx8IDUwNjEyID09IGEgfHwgNTA2NDAgPT0gYSB8fCA1MDY2OCA9PSBhIHx8IDUwNjk2ID09IGEgfHwKICAgICAgICAgICAgICAgIDUwNzI0ID09IGEgfHwgNTA3NTIgPT0gYSB8fCA1MDc4MCA9PSBhIHx8IDUwODA4ID09IGEgfHwgNTA4MzYgPT0gYSB8fCA1MDg2NCA9PSBhIHx8IDUwODkyID09IGEgfHwgNTA5MjAgPT0gYSB8fCA1MDk0OCA9PSBhIHx8IDUwOTc2ID09IGEgfHwgNTEwMDQgPT0gYSB8fCA1MTAzMiA9PSBhIHx8IDUxMDYwID09IGEgfHwgNTEwODggPT0gYSB8fCA1MTExNiA9PSBhIHx8IDUxMTQ0ID09IGEgfHwgNTExNzIgPT0gYSB8fCA1MTIwMCA9PSBhIHx8IDUxMjI4ID09IGEgfHwgNTEyNTYgPT0gYSB8fCA1MTI4NCA9PSBhIHx8IDUxMzEyID09IGEgfHwgNTEzNDAgPT0gYSB8fCA1MTM2OCA9PSBhIHx8IDUxMzk2ID09IGEgfHwgNTE0MjQgPT0gYSB8fCA1MTQ1MiA9PSBhIHx8IDUxNDgwID09IGEgfHwgNTE1MDggPT0gYSB8fCA1MTUzNiA9PSBhIHx8IDUxNTY0ID09IGEgfHwgNTE1OTIgPT0gYSB8fCA1MTYyMCA9PSBhIHx8IDUxNjQ4ID09IGEgfHwgNTE2NzYgPT0gYSB8fCA1MTcwNCA9PSBhIHx8IDUxNzMyID09IGEgfHwgNTE3NjAgPT0gYSB8fCA1MTc4OCA9PSBhIHx8IDUxODE2ID09IGEgfHwgNTE4NDQgPT0gYSB8fCA1MTg3MiA9PSBhIHx8IDUxOTAwID09IGEgfHwgNTE5MjggPT0gYSB8fCA1MTk1NiA9PSBhIHx8IDUxOTg0ID09IGEgfHwgNTIwMTIgPT0gYSB8fCA1MjA0MCA9PSBhIHx8IDUyMDY4ID09IGEgfHwgNTIwOTYgPT0gYSB8fCA1MjEyNCA9PQogICAgICAgICAgICAgICAgYSB8fCA1MjE1MiA9PSBhIHx8IDUyMTgwID09IGEgfHwgNTIyMDggPT0gYSB8fCA1MjIzNiA9PSBhIHx8IDUyMjY0ID09IGEgfHwgNTIyOTIgPT0gYSB8fCA1MjMyMCA9PSBhIHx8IDUyMzQ4ID09IGEgfHwgNTIzNzYgPT0gYSB8fCA1MjQwNCA9PSBhIHx8IDUyNDMyID09IGEgfHwgNTI0NjAgPT0gYSB8fCA1MjQ4OCA9PSBhIHx8IDUyNTE2ID09IGEgfHwgNTI1NDQgPT0gYSB8fCA1MjU3MiA9PSBhIHx8IDUyNjAwID09IGEgfHwgNTI2MjggPT0gYSB8fCA1MjY1NiA9PSBhIHx8IDUyNjg0ID09IGEgfHwgNTI3MTIgPT0gYSB8fCA1Mjc0MCA9PSBhIHx8IDUyNzY4ID09IGEgfHwgNTI3OTYgPT0gYSB8fCA1MjgyNCA9PSBhIHx8IDUyODUyID09IGEgfHwgNTI4ODAgPT0gYSB8fCA1MjkwOCA9PSBhIHx8IDUyOTM2ID09IGEgfHwgNTI5NjQgPT0gYSB8fCA1Mjk5MiA9PSBhIHx8IDUzMDIwID09IGEgfHwgNTMwNDggPT0gYSB8fCA1MzA3NiA9PSBhIHx8IDUzMTA0ID09IGEgfHwgNTMxMzIgPT0gYSB8fCA1MzE2MCA9PSBhIHx8IDUzMTg4ID09IGEgfHwgNTMyMTYgPT0gYSB8fCA1MzI0NCA9PSBhIHx8IDUzMjcyID09IGEgfHwgNTMzMDAgPT0gYSB8fCA1MzMyOCA9PSBhIHx8IDUzMzU2ID09IGEgfHwgNTMzODQgPT0gYSB8fCA1MzQxMiA9PSBhIHx8IDUzNDQwID09IGEgfHwgNTM0NjggPT0gYSB8fCA1MzQ5NiA9PSBhIHx8IDUzNTI0ID09IGEgfHwKICAgICAgICAgICAgICAgIDUzNTUyID09IGEgfHwgNTM1ODAgPT0gYSB8fCA1MzYwOCA9PSBhIHx8IDUzNjM2ID09IGEgfHwgNTM2NjQgPT0gYSB8fCA1MzY5MiA9PSBhIHx8IDUzNzIwID09IGEgfHwgNTM3NDggPT0gYSB8fCA1Mzc3NiA9PSBhIHx8IDUzODA0ID09IGEgfHwgNTM4MzIgPT0gYSB8fCA1Mzg2MCA9PSBhIHx8IDUzODg4ID09IGEgfHwgNTM5MTYgPT0gYSB8fCA1Mzk0NCA9PSBhIHx8IDUzOTcyID09IGEgfHwgNTRFMyA9PSBhIHx8IDU0MDI4ID09IGEgfHwgNTQwNTYgPT0gYSB8fCA1NDA4NCA9PSBhIHx8IDU0MTEyID09IGEgfHwgNTQxNDAgPT0gYSB8fCA1NDE2OCA9PSBhIHx8IDU0MTk2ID09IGEgfHwgNTQyMjQgPT0gYSB8fCA1NDI1MiA9PSBhIHx8IDU0MjgwID09IGEgfHwgNTQzMDggPT0gYSB8fCA1NDMzNiA9PSBhIHx8IDU0MzY0ID09IGEgfHwgNTQzOTIgPT0gYSB8fCA1NDQyMCA9PSBhIHx8IDU0NDQ4ID09IGEgfHwgNTQ0NzYgPT0gYSB8fCA1NDUwNCA9PSBhIHx8IDU0NTMyID09IGEgfHwgNTQ1NjAgPT0gYSB8fCA1NDU4OCA9PSBhIHx8IDU0NjE2ID09IGEgfHwgNTQ2NDQgPT0gYSB8fCA1NDY3MiA9PSBhIHx8IDU0NzAwID09IGEgfHwgNTQ3MjggPT0gYSB8fCA1NDc1NiA9PSBhIHx8IDU0Nzg0ID09IGEgfHwgNTQ4MTIgPT0gYSB8fCA1NDg0MCA9PSBhIHx8IDU0ODY4ID09IGEgfHwgNTQ4OTYgPT0gYSB8fCA1NDkyNCA9PSBhIHx8IDU0OTUyID09CiAgICAgICAgICAgICAgICBhIHx8IDU0OTgwID09IGEgfHwgNTUwMDggPT0gYSB8fCA1NTAzNiA9PSBhIHx8IDU1MDY0ID09IGEgfHwgNTUwOTIgPT0gYSB8fCA1NTEyMCA9PSBhIHx8IDU1MTQ4ID09IGEgfHwgNTUxNzYgPT0gYSA/IDkgOiA0NDAzMyA8PSBhICYmIDQ0MDU5ID49IGEgfHwgNDQwNjEgPD0gYSAmJiA0NDA4NyA+PSBhIHx8IDQ0MDg5IDw9IGEgJiYgNDQxMTUgPj0gYSB8fCA0NDExNyA8PSBhICYmIDQ0MTQzID49IGEgfHwgNDQxNDUgPD0gYSAmJiA0NDE3MSA+PSBhIHx8IDQ0MTczIDw9IGEgJiYgNDQxOTkgPj0gYSB8fCA0NDIwMSA8PSBhICYmIDQ0MjI3ID49IGEgfHwgNDQyMjkgPD0gYSAmJiA0NDI1NSA+PSBhIHx8IDQ0MjU3IDw9IGEgJiYgNDQyODMgPj0gYSB8fCA0NDI4NSA8PSBhICYmIDQ0MzExID49IGEgfHwgNDQzMTMgPD0gYSAmJiA0NDMzOSA+PSBhIHx8IDQ0MzQxIDw9IGEgJiYgNDQzNjcgPj0gYSB8fCA0NDM2OSA8PSBhICYmIDQ0Mzk1ID49IGEgfHwgNDQzOTcgPD0gYSAmJiA0NDQyMyA+PSBhIHx8IDQ0NDI1IDw9IGEgJiYgNDQ0NTEgPj0gYSB8fCA0NDQ1MyA8PSBhICYmIDQ0NDc5ID49IGEgfHwgNDQ0ODEgPD0gYSAmJiA0NDUwNyA+PSBhIHx8IDQ0NTA5IDw9IGEgJiYgNDQ1MzUgPj0gYSB8fCA0NDUzNyA8PSBhICYmIDQ0NTYzID49IGEgfHwgNDQ1NjUgPD0gYSAmJiA0NDU5MSA+PSBhIHx8IDQ0NTkzIDw9IGEgJiYgNDQ2MTkgPj0KICAgICAgICAgICAgICAgIGEgfHwgNDQ2MjEgPD0gYSAmJiA0NDY0NyA+PSBhIHx8IDQ0NjQ5IDw9IGEgJiYgNDQ2NzUgPj0gYSB8fCA0NDY3NyA8PSBhICYmIDQ0NzAzID49IGEgfHwgNDQ3MDUgPD0gYSAmJiA0NDczMSA+PSBhIHx8IDQ0NzMzIDw9IGEgJiYgNDQ3NTkgPj0gYSB8fCA0NDc2MSA8PSBhICYmIDQ0Nzg3ID49IGEgfHwgNDQ3ODkgPD0gYSAmJiA0NDgxNSA+PSBhIHx8IDQ0ODE3IDw9IGEgJiYgNDQ4NDMgPj0gYSB8fCA0NDg0NSA8PSBhICYmIDQ0ODcxID49IGEgfHwgNDQ4NzMgPD0gYSAmJiA0NDg5OSA+PSBhIHx8IDQ0OTAxIDw9IGEgJiYgNDQ5MjcgPj0gYSB8fCA0NDkyOSA8PSBhICYmIDQ0OTU1ID49IGEgfHwgNDQ5NTcgPD0gYSAmJiA0NDk4MyA+PSBhIHx8IDQ0OTg1IDw9IGEgJiYgNDUwMTEgPj0gYSB8fCA0NTAxMyA8PSBhICYmIDQ1MDM5ID49IGEgfHwgNDUwNDEgPD0gYSAmJiA0NTA2NyA+PSBhIHx8IDQ1MDY5IDw9IGEgJiYgNDUwOTUgPj0gYSB8fCA0NTA5NyA8PSBhICYmIDQ1MTIzID49IGEgfHwgNDUxMjUgPD0gYSAmJiA0NTE1MSA+PSBhIHx8IDQ1MTUzIDw9IGEgJiYgNDUxNzkgPj0gYSB8fCA0NTE4MSA8PSBhICYmIDQ1MjA3ID49IGEgfHwgNDUyMDkgPD0gYSAmJiA0NTIzNSA+PSBhIHx8IDQ1MjM3IDw9IGEgJiYgNDUyNjMgPj0gYSB8fCA0NTI2NSA8PSBhICYmIDQ1MjkxID49IGEgfHwgNDUyOTMgPD0gYSAmJiA0NTMxOSA+PSBhIHx8CiAgICAgICAgICAgICAgICA0NTMyMSA8PSBhICYmIDQ1MzQ3ID49IGEgfHwgNDUzNDkgPD0gYSAmJiA0NTM3NSA+PSBhIHx8IDQ1Mzc3IDw9IGEgJiYgNDU0MDMgPj0gYSB8fCA0NTQwNSA8PSBhICYmIDQ1NDMxID49IGEgfHwgNDU0MzMgPD0gYSAmJiA0NTQ1OSA+PSBhIHx8IDQ1NDYxIDw9IGEgJiYgNDU0ODcgPj0gYSB8fCA0NTQ4OSA8PSBhICYmIDQ1NTE1ID49IGEgfHwgNDU1MTcgPD0gYSAmJiA0NTU0MyA+PSBhIHx8IDQ1NTQ1IDw9IGEgJiYgNDU1NzEgPj0gYSB8fCA0NTU3MyA8PSBhICYmIDQ1NTk5ID49IGEgfHwgNDU2MDEgPD0gYSAmJiA0NTYyNyA+PSBhIHx8IDQ1NjI5IDw9IGEgJiYgNDU2NTUgPj0gYSB8fCA0NTY1NyA8PSBhICYmIDQ1NjgzID49IGEgfHwgNDU2ODUgPD0gYSAmJiA0NTcxMSA+PSBhIHx8IDQ1NzEzIDw9IGEgJiYgNDU3MzkgPj0gYSB8fCA0NTc0MSA8PSBhICYmIDQ1NzY3ID49IGEgfHwgNDU3NjkgPD0gYSAmJiA0NTc5NSA+PSBhIHx8IDQ1Nzk3IDw9IGEgJiYgNDU4MjMgPj0gYSB8fCA0NTgyNSA8PSBhICYmIDQ1ODUxID49IGEgfHwgNDU4NTMgPD0gYSAmJiA0NTg3OSA+PSBhIHx8IDQ1ODgxIDw9IGEgJiYgNDU5MDcgPj0gYSB8fCA0NTkwOSA8PSBhICYmIDQ1OTM1ID49IGEgfHwgNDU5MzcgPD0gYSAmJiA0NTk2MyA+PSBhIHx8IDQ1OTY1IDw9IGEgJiYgNDU5OTEgPj0gYSB8fCA0NTk5MyA8PSBhICYmIDQ2MDE5ID49IGEgfHwgNDYwMjEgPD0KICAgICAgICAgICAgICAgIGEgJiYgNDYwNDcgPj0gYSB8fCA0NjA0OSA8PSBhICYmIDQ2MDc1ID49IGEgfHwgNDYwNzcgPD0gYSAmJiA0NjEwMyA+PSBhIHx8IDQ2MTA1IDw9IGEgJiYgNDYxMzEgPj0gYSB8fCA0NjEzMyA8PSBhICYmIDQ2MTU5ID49IGEgfHwgNDYxNjEgPD0gYSAmJiA0NjE4NyA+PSBhIHx8IDQ2MTg5IDw9IGEgJiYgNDYyMTUgPj0gYSB8fCA0NjIxNyA8PSBhICYmIDQ2MjQzID49IGEgfHwgNDYyNDUgPD0gYSAmJiA0NjI3MSA+PSBhIHx8IDQ2MjczIDw9IGEgJiYgNDYyOTkgPj0gYSB8fCA0NjMwMSA8PSBhICYmIDQ2MzI3ID49IGEgfHwgNDYzMjkgPD0gYSAmJiA0NjM1NSA+PSBhIHx8IDQ2MzU3IDw9IGEgJiYgNDYzODMgPj0gYSB8fCA0NjM4NSA8PSBhICYmIDQ2NDExID49IGEgfHwgNDY0MTMgPD0gYSAmJiA0NjQzOSA+PSBhIHx8IDQ2NDQxIDw9IGEgJiYgNDY0NjcgPj0gYSB8fCA0NjQ2OSA8PSBhICYmIDQ2NDk1ID49IGEgfHwgNDY0OTcgPD0gYSAmJiA0NjUyMyA+PSBhIHx8IDQ2NTI1IDw9IGEgJiYgNDY1NTEgPj0gYSB8fCA0NjU1MyA8PSBhICYmIDQ2NTc5ID49IGEgfHwgNDY1ODEgPD0gYSAmJiA0NjYwNyA+PSBhIHx8IDQ2NjA5IDw9IGEgJiYgNDY2MzUgPj0gYSB8fCA0NjYzNyA8PSBhICYmIDQ2NjYzID49IGEgfHwgNDY2NjUgPD0gYSAmJiA0NjY5MSA+PSBhIHx8IDQ2NjkzIDw9IGEgJiYgNDY3MTkgPj0gYSB8fCA0NjcyMSA8PSBhICYmCiAgICAgICAgICAgICAgICA0Njc0NyA+PSBhIHx8IDQ2NzQ5IDw9IGEgJiYgNDY3NzUgPj0gYSB8fCA0Njc3NyA8PSBhICYmIDQ2ODAzID49IGEgfHwgNDY4MDUgPD0gYSAmJiA0NjgzMSA+PSBhIHx8IDQ2ODMzIDw9IGEgJiYgNDY4NTkgPj0gYSB8fCA0Njg2MSA8PSBhICYmIDQ2ODg3ID49IGEgfHwgNDY4ODkgPD0gYSAmJiA0NjkxNSA+PSBhIHx8IDQ2OTE3IDw9IGEgJiYgNDY5NDMgPj0gYSB8fCA0Njk0NSA8PSBhICYmIDQ2OTcxID49IGEgfHwgNDY5NzMgPD0gYSAmJiA0Njk5OSA+PSBhIHx8IDQ3MDAxIDw9IGEgJiYgNDcwMjcgPj0gYSB8fCA0NzAyOSA8PSBhICYmIDQ3MDU1ID49IGEgfHwgNDcwNTcgPD0gYSAmJiA0NzA4MyA+PSBhIHx8IDQ3MDg1IDw9IGEgJiYgNDcxMTEgPj0gYSB8fCA0NzExMyA8PSBhICYmIDQ3MTM5ID49IGEgfHwgNDcxNDEgPD0gYSAmJiA0NzE2NyA+PSBhIHx8IDQ3MTY5IDw9IGEgJiYgNDcxOTUgPj0gYSB8fCA0NzE5NyA8PSBhICYmIDQ3MjIzID49IGEgfHwgNDcyMjUgPD0gYSAmJiA0NzI1MSA+PSBhIHx8IDQ3MjUzIDw9IGEgJiYgNDcyNzkgPj0gYSB8fCA0NzI4MSA8PSBhICYmIDQ3MzA3ID49IGEgfHwgNDczMDkgPD0gYSAmJiA0NzMzNSA+PSBhIHx8IDQ3MzM3IDw9IGEgJiYgNDczNjMgPj0gYSB8fCA0NzM2NSA8PSBhICYmIDQ3MzkxID49IGEgfHwgNDczOTMgPD0gYSAmJiA0NzQxOSA+PSBhIHx8IDQ3NDIxIDw9IGEgJiYgNDc0NDcgPj0KICAgICAgICAgICAgICAgIGEgfHwgNDc0NDkgPD0gYSAmJiA0NzQ3NSA+PSBhIHx8IDQ3NDc3IDw9IGEgJiYgNDc1MDMgPj0gYSB8fCA0NzUwNSA8PSBhICYmIDQ3NTMxID49IGEgfHwgNDc1MzMgPD0gYSAmJiA0NzU1OSA+PSBhIHx8IDQ3NTYxIDw9IGEgJiYgNDc1ODcgPj0gYSB8fCA0NzU4OSA8PSBhICYmIDQ3NjE1ID49IGEgfHwgNDc2MTcgPD0gYSAmJiA0NzY0MyA+PSBhIHx8IDQ3NjQ1IDw9IGEgJiYgNDc2NzEgPj0gYSB8fCA0NzY3MyA8PSBhICYmIDQ3Njk5ID49IGEgfHwgNDc3MDEgPD0gYSAmJiA0NzcyNyA+PSBhIHx8IDQ3NzI5IDw9IGEgJiYgNDc3NTUgPj0gYSB8fCA0Nzc1NyA8PSBhICYmIDQ3NzgzID49IGEgfHwgNDc3ODUgPD0gYSAmJiA0NzgxMSA+PSBhIHx8IDQ3ODEzIDw9IGEgJiYgNDc4MzkgPj0gYSB8fCA0Nzg0MSA8PSBhICYmIDQ3ODY3ID49IGEgfHwgNDc4NjkgPD0gYSAmJiA0Nzg5NSA+PSBhIHx8IDQ3ODk3IDw9IGEgJiYgNDc5MjMgPj0gYSB8fCA0NzkyNSA8PSBhICYmIDQ3OTUxID49IGEgfHwgNDc5NTMgPD0gYSAmJiA0Nzk3OSA+PSBhIHx8IDQ3OTgxIDw9IGEgJiYgNDgwMDcgPj0gYSB8fCA0ODAwOSA8PSBhICYmIDQ4MDM1ID49IGEgfHwgNDgwMzcgPD0gYSAmJiA0ODA2MyA+PSBhIHx8IDQ4MDY1IDw9IGEgJiYgNDgwOTEgPj0gYSB8fCA0ODA5MyA8PSBhICYmIDQ4MTE5ID49IGEgfHwgNDgxMjEgPD0gYSAmJiA0ODE0NyA+PSBhIHx8CiAgICAgICAgICAgICAgICA0ODE0OSA8PSBhICYmIDQ4MTc1ID49IGEgfHwgNDgxNzcgPD0gYSAmJiA0ODIwMyA+PSBhIHx8IDQ4MjA1IDw9IGEgJiYgNDgyMzEgPj0gYSB8fCA0ODIzMyA8PSBhICYmIDQ4MjU5ID49IGEgfHwgNDgyNjEgPD0gYSAmJiA0ODI4NyA+PSBhIHx8IDQ4Mjg5IDw9IGEgJiYgNDgzMTUgPj0gYSB8fCA0ODMxNyA8PSBhICYmIDQ4MzQzID49IGEgfHwgNDgzNDUgPD0gYSAmJiA0ODM3MSA+PSBhIHx8IDQ4MzczIDw9IGEgJiYgNDgzOTkgPj0gYSB8fCA0ODQwMSA8PSBhICYmIDQ4NDI3ID49IGEgfHwgNDg0MjkgPD0gYSAmJiA0ODQ1NSA+PSBhIHx8IDQ4NDU3IDw9IGEgJiYgNDg0ODMgPj0gYSB8fCA0ODQ4NSA8PSBhICYmIDQ4NTExID49IGEgfHwgNDg1MTMgPD0gYSAmJiA0ODUzOSA+PSBhIHx8IDQ4NTQxIDw9IGEgJiYgNDg1NjcgPj0gYSB8fCA0ODU2OSA8PSBhICYmIDQ4NTk1ID49IGEgfHwgNDg1OTcgPD0gYSAmJiA0ODYyMyA+PSBhIHx8IDQ4NjI1IDw9IGEgJiYgNDg2NTEgPj0gYSB8fCA0ODY1MyA8PSBhICYmIDQ4Njc5ID49IGEgfHwgNDg2ODEgPD0gYSAmJiA0ODcwNyA+PSBhIHx8IDQ4NzA5IDw9IGEgJiYgNDg3MzUgPj0gYSB8fCA0ODczNyA8PSBhICYmIDQ4NzYzID49IGEgfHwgNDg3NjUgPD0gYSAmJiA0ODc5MSA+PSBhIHx8IDQ4NzkzIDw9IGEgJiYgNDg4MTkgPj0gYSB8fCA0ODgyMSA8PSBhICYmIDQ4ODQ3ID49IGEgfHwgNDg4NDkgPD0KICAgICAgICAgICAgICAgIGEgJiYgNDg4NzUgPj0gYSB8fCA0ODg3NyA8PSBhICYmIDQ4OTAzID49IGEgfHwgNDg5MDUgPD0gYSAmJiA0ODkzMSA+PSBhIHx8IDQ4OTMzIDw9IGEgJiYgNDg5NTkgPj0gYSB8fCA0ODk2MSA8PSBhICYmIDQ4OTg3ID49IGEgfHwgNDg5ODkgPD0gYSAmJiA0OTAxNSA+PSBhIHx8IDQ5MDE3IDw9IGEgJiYgNDkwNDMgPj0gYSB8fCA0OTA0NSA8PSBhICYmIDQ5MDcxID49IGEgfHwgNDkwNzMgPD0gYSAmJiA0OTA5OSA+PSBhIHx8IDQ5MTAxIDw9IGEgJiYgNDkxMjcgPj0gYSB8fCA0OTEyOSA8PSBhICYmIDQ5MTU1ID49IGEgfHwgNDkxNTcgPD0gYSAmJiA0OTE4MyA+PSBhIHx8IDQ5MTg1IDw9IGEgJiYgNDkyMTEgPj0gYSB8fCA0OTIxMyA8PSBhICYmIDQ5MjM5ID49IGEgfHwgNDkyNDEgPD0gYSAmJiA0OTI2NyA+PSBhIHx8IDQ5MjY5IDw9IGEgJiYgNDkyOTUgPj0gYSB8fCA0OTI5NyA8PSBhICYmIDQ5MzIzID49IGEgfHwgNDkzMjUgPD0gYSAmJiA0OTM1MSA+PSBhIHx8IDQ5MzUzIDw9IGEgJiYgNDkzNzkgPj0gYSB8fCA0OTM4MSA8PSBhICYmIDQ5NDA3ID49IGEgfHwgNDk0MDkgPD0gYSAmJiA0OTQzNSA+PSBhIHx8IDQ5NDM3IDw9IGEgJiYgNDk0NjMgPj0gYSB8fCA0OTQ2NSA8PSBhICYmIDQ5NDkxID49IGEgfHwgNDk0OTMgPD0gYSAmJiA0OTUxOSA+PSBhIHx8IDQ5NTIxIDw9IGEgJiYgNDk1NDcgPj0gYSB8fCA0OTU0OSA8PSBhICYmCiAgICAgICAgICAgICAgICA0OTU3NSA+PSBhIHx8IDQ5NTc3IDw9IGEgJiYgNDk2MDMgPj0gYSB8fCA0OTYwNSA8PSBhICYmIDQ5NjMxID49IGEgfHwgNDk2MzMgPD0gYSAmJiA0OTY1OSA+PSBhIHx8IDQ5NjYxIDw9IGEgJiYgNDk2ODcgPj0gYSB8fCA0OTY4OSA8PSBhICYmIDQ5NzE1ID49IGEgfHwgNDk3MTcgPD0gYSAmJiA0OTc0MyA+PSBhIHx8IDQ5NzQ1IDw9IGEgJiYgNDk3NzEgPj0gYSB8fCA0OTc3MyA8PSBhICYmIDQ5Nzk5ID49IGEgfHwgNDk4MDEgPD0gYSAmJiA0OTgyNyA+PSBhIHx8IDQ5ODI5IDw9IGEgJiYgNDk4NTUgPj0gYSB8fCA0OTg1NyA8PSBhICYmIDQ5ODgzID49IGEgfHwgNDk4ODUgPD0gYSAmJiA0OTkxMSA+PSBhIHx8IDQ5OTEzIDw9IGEgJiYgNDk5MzkgPj0gYSB8fCA0OTk0MSA8PSBhICYmIDQ5OTY3ID49IGEgfHwgNDk5NjkgPD0gYSAmJiA0OTk5NSA+PSBhIHx8IDQ5OTk3IDw9IGEgJiYgNTAwMjMgPj0gYSB8fCA1MDAyNSA8PSBhICYmIDUwMDUxID49IGEgfHwgNTAwNTMgPD0gYSAmJiA1MDA3OSA+PSBhIHx8IDUwMDgxIDw9IGEgJiYgNTAxMDcgPj0gYSB8fCA1MDEwOSA8PSBhICYmIDUwMTM1ID49IGEgfHwgNTAxMzcgPD0gYSAmJiA1MDE2MyA+PSBhIHx8IDUwMTY1IDw9IGEgJiYgNTAxOTEgPj0gYSB8fCA1MDE5MyA8PSBhICYmIDUwMjE5ID49IGEgfHwgNTAyMjEgPD0gYSAmJiA1MDI0NyA+PSBhIHx8IDUwMjQ5IDw9IGEgJiYgNTAyNzUgPj0KICAgICAgICAgICAgICAgIGEgfHwgNTAyNzcgPD0gYSAmJiA1MDMwMyA+PSBhIHx8IDUwMzA1IDw9IGEgJiYgNTAzMzEgPj0gYSB8fCA1MDMzMyA8PSBhICYmIDUwMzU5ID49IGEgfHwgNTAzNjEgPD0gYSAmJiA1MDM4NyA+PSBhIHx8IDUwMzg5IDw9IGEgJiYgNTA0MTUgPj0gYSB8fCA1MDQxNyA8PSBhICYmIDUwNDQzID49IGEgfHwgNTA0NDUgPD0gYSAmJiA1MDQ3MSA+PSBhIHx8IDUwNDczIDw9IGEgJiYgNTA0OTkgPj0gYSB8fCA1MDUwMSA8PSBhICYmIDUwNTI3ID49IGEgfHwgNTA1MjkgPD0gYSAmJiA1MDU1NSA+PSBhIHx8IDUwNTU3IDw9IGEgJiYgNTA1ODMgPj0gYSB8fCA1MDU4NSA8PSBhICYmIDUwNjExID49IGEgfHwgNTA2MTMgPD0gYSAmJiA1MDYzOSA+PSBhIHx8IDUwNjQxIDw9IGEgJiYgNTA2NjcgPj0gYSB8fCA1MDY2OSA8PSBhICYmIDUwNjk1ID49IGEgfHwgNTA2OTcgPD0gYSAmJiA1MDcyMyA+PSBhIHx8IDUwNzI1IDw9IGEgJiYgNTA3NTEgPj0gYSB8fCA1MDc1MyA8PSBhICYmIDUwNzc5ID49IGEgfHwgNTA3ODEgPD0gYSAmJiA1MDgwNyA+PSBhIHx8IDUwODA5IDw9IGEgJiYgNTA4MzUgPj0gYSB8fCA1MDgzNyA8PSBhICYmIDUwODYzID49IGEgfHwgNTA4NjUgPD0gYSAmJiA1MDg5MSA+PSBhIHx8IDUwODkzIDw9IGEgJiYgNTA5MTkgPj0gYSB8fCA1MDkyMSA8PSBhICYmIDUwOTQ3ID49IGEgfHwgNTA5NDkgPD0gYSAmJiA1MDk3NSA+PSBhIHx8CiAgICAgICAgICAgICAgICA1MDk3NyA8PSBhICYmIDUxMDAzID49IGEgfHwgNTEwMDUgPD0gYSAmJiA1MTAzMSA+PSBhIHx8IDUxMDMzIDw9IGEgJiYgNTEwNTkgPj0gYSB8fCA1MTA2MSA8PSBhICYmIDUxMDg3ID49IGEgfHwgNTEwODkgPD0gYSAmJiA1MTExNSA+PSBhIHx8IDUxMTE3IDw9IGEgJiYgNTExNDMgPj0gYSB8fCA1MTE0NSA8PSBhICYmIDUxMTcxID49IGEgfHwgNTExNzMgPD0gYSAmJiA1MTE5OSA+PSBhIHx8IDUxMjAxIDw9IGEgJiYgNTEyMjcgPj0gYSB8fCA1MTIyOSA8PSBhICYmIDUxMjU1ID49IGEgfHwgNTEyNTcgPD0gYSAmJiA1MTI4MyA+PSBhIHx8IDUxMjg1IDw9IGEgJiYgNTEzMTEgPj0gYSB8fCA1MTMxMyA8PSBhICYmIDUxMzM5ID49IGEgfHwgNTEzNDEgPD0gYSAmJiA1MTM2NyA+PSBhIHx8IDUxMzY5IDw9IGEgJiYgNTEzOTUgPj0gYSB8fCA1MTM5NyA8PSBhICYmIDUxNDIzID49IGEgfHwgNTE0MjUgPD0gYSAmJiA1MTQ1MSA+PSBhIHx8IDUxNDUzIDw9IGEgJiYgNTE0NzkgPj0gYSB8fCA1MTQ4MSA8PSBhICYmIDUxNTA3ID49IGEgfHwgNTE1MDkgPD0gYSAmJiA1MTUzNSA+PSBhIHx8IDUxNTM3IDw9IGEgJiYgNTE1NjMgPj0gYSB8fCA1MTU2NSA8PSBhICYmIDUxNTkxID49IGEgfHwgNTE1OTMgPD0gYSAmJiA1MTYxOSA+PSBhIHx8IDUxNjIxIDw9IGEgJiYgNTE2NDcgPj0gYSB8fCA1MTY0OSA8PSBhICYmIDUxNjc1ID49IGEgfHwgNTE2NzcgPD0KICAgICAgICAgICAgICAgIGEgJiYgNTE3MDMgPj0gYSB8fCA1MTcwNSA8PSBhICYmIDUxNzMxID49IGEgfHwgNTE3MzMgPD0gYSAmJiA1MTc1OSA+PSBhIHx8IDUxNzYxIDw9IGEgJiYgNTE3ODcgPj0gYSB8fCA1MTc4OSA8PSBhICYmIDUxODE1ID49IGEgfHwgNTE4MTcgPD0gYSAmJiA1MTg0MyA+PSBhIHx8IDUxODQ1IDw9IGEgJiYgNTE4NzEgPj0gYSB8fCA1MTg3MyA8PSBhICYmIDUxODk5ID49IGEgfHwgNTE5MDEgPD0gYSAmJiA1MTkyNyA+PSBhIHx8IDUxOTI5IDw9IGEgJiYgNTE5NTUgPj0gYSB8fCA1MTk1NyA8PSBhICYmIDUxOTgzID49IGEgfHwgNTE5ODUgPD0gYSAmJiA1MjAxMSA+PSBhIHx8IDUyMDEzIDw9IGEgJiYgNTIwMzkgPj0gYSB8fCA1MjA0MSA8PSBhICYmIDUyMDY3ID49IGEgfHwgNTIwNjkgPD0gYSAmJiA1MjA5NSA+PSBhIHx8IDUyMDk3IDw9IGEgJiYgNTIxMjMgPj0gYSB8fCA1MjEyNSA8PSBhICYmIDUyMTUxID49IGEgfHwgNTIxNTMgPD0gYSAmJiA1MjE3OSA+PSBhIHx8IDUyMTgxIDw9IGEgJiYgNTIyMDcgPj0gYSB8fCA1MjIwOSA8PSBhICYmIDUyMjM1ID49IGEgfHwgNTIyMzcgPD0gYSAmJiA1MjI2MyA+PSBhIHx8IDUyMjY1IDw9IGEgJiYgNTIyOTEgPj0gYSB8fCA1MjI5MyA8PSBhICYmIDUyMzE5ID49IGEgfHwgNTIzMjEgPD0gYSAmJiA1MjM0NyA+PSBhIHx8IDUyMzQ5IDw9IGEgJiYgNTIzNzUgPj0gYSB8fCA1MjM3NyA8PSBhICYmCiAgICAgICAgICAgICAgICA1MjQwMyA+PSBhIHx8IDUyNDA1IDw9IGEgJiYgNTI0MzEgPj0gYSB8fCA1MjQzMyA8PSBhICYmIDUyNDU5ID49IGEgfHwgNTI0NjEgPD0gYSAmJiA1MjQ4NyA+PSBhIHx8IDUyNDg5IDw9IGEgJiYgNTI1MTUgPj0gYSB8fCA1MjUxNyA8PSBhICYmIDUyNTQzID49IGEgfHwgNTI1NDUgPD0gYSAmJiA1MjU3MSA+PSBhIHx8IDUyNTczIDw9IGEgJiYgNTI1OTkgPj0gYSB8fCA1MjYwMSA8PSBhICYmIDUyNjI3ID49IGEgfHwgNTI2MjkgPD0gYSAmJiA1MjY1NSA+PSBhIHx8IDUyNjU3IDw9IGEgJiYgNTI2ODMgPj0gYSB8fCA1MjY4NSA8PSBhICYmIDUyNzExID49IGEgfHwgNTI3MTMgPD0gYSAmJiA1MjczOSA+PSBhIHx8IDUyNzQxIDw9IGEgJiYgNTI3NjcgPj0gYSB8fCA1Mjc2OSA8PSBhICYmIDUyNzk1ID49IGEgfHwgNTI3OTcgPD0gYSAmJiA1MjgyMyA+PSBhIHx8IDUyODI1IDw9IGEgJiYgNTI4NTEgPj0gYSB8fCA1Mjg1MyA8PSBhICYmIDUyODc5ID49IGEgfHwgNTI4ODEgPD0gYSAmJiA1MjkwNyA+PSBhIHx8IDUyOTA5IDw9IGEgJiYgNTI5MzUgPj0gYSB8fCA1MjkzNyA8PSBhICYmIDUyOTYzID49IGEgfHwgNTI5NjUgPD0gYSAmJiA1Mjk5MSA+PSBhIHx8IDUyOTkzIDw9IGEgJiYgNTMwMTkgPj0gYSB8fCA1MzAyMSA8PSBhICYmIDUzMDQ3ID49IGEgfHwgNTMwNDkgPD0gYSAmJiA1MzA3NSA+PSBhIHx8IDUzMDc3IDw9IGEgJiYgNTMxMDMgPj0KICAgICAgICAgICAgICAgIGEgfHwgNTMxMDUgPD0gYSAmJiA1MzEzMSA+PSBhIHx8IDUzMTMzIDw9IGEgJiYgNTMxNTkgPj0gYSB8fCA1MzE2MSA8PSBhICYmIDUzMTg3ID49IGEgfHwgNTMxODkgPD0gYSAmJiA1MzIxNSA+PSBhIHx8IDUzMjE3IDw9IGEgJiYgNTMyNDMgPj0gYSB8fCA1MzI0NSA8PSBhICYmIDUzMjcxID49IGEgfHwgNTMyNzMgPD0gYSAmJiA1MzI5OSA+PSBhIHx8IDUzMzAxIDw9IGEgJiYgNTMzMjcgPj0gYSB8fCA1MzMyOSA8PSBhICYmIDUzMzU1ID49IGEgfHwgNTMzNTcgPD0gYSAmJiA1MzM4MyA+PSBhIHx8IDUzMzg1IDw9IGEgJiYgNTM0MTEgPj0gYSB8fCA1MzQxMyA8PSBhICYmIDUzNDM5ID49IGEgfHwgNTM0NDEgPD0gYSAmJiA1MzQ2NyA+PSBhIHx8IDUzNDY5IDw9IGEgJiYgNTM0OTUgPj0gYSB8fCA1MzQ5NyA8PSBhICYmIDUzNTIzID49IGEgfHwgNTM1MjUgPD0gYSAmJiA1MzU1MSA+PSBhIHx8IDUzNTUzIDw9IGEgJiYgNTM1NzkgPj0gYSB8fCA1MzU4MSA8PSBhICYmIDUzNjA3ID49IGEgfHwgNTM2MDkgPD0gYSAmJiA1MzYzNSA+PSBhIHx8IDUzNjM3IDw9IGEgJiYgNTM2NjMgPj0gYSB8fCA1MzY2NSA8PSBhICYmIDUzNjkxID49IGEgfHwgNTM2OTMgPD0gYSAmJiA1MzcxOSA+PSBhIHx8IDUzNzIxIDw9IGEgJiYgNTM3NDcgPj0gYSB8fCA1Mzc0OSA8PSBhICYmIDUzNzc1ID49IGEgfHwgNTM3NzcgPD0gYSAmJiA1MzgwMyA+PSBhIHx8CiAgICAgICAgICAgICAgICA1MzgwNSA8PSBhICYmIDUzODMxID49IGEgfHwgNTM4MzMgPD0gYSAmJiA1Mzg1OSA+PSBhIHx8IDUzODYxIDw9IGEgJiYgNTM4ODcgPj0gYSB8fCA1Mzg4OSA8PSBhICYmIDUzOTE1ID49IGEgfHwgNTM5MTcgPD0gYSAmJiA1Mzk0MyA+PSBhIHx8IDUzOTQ1IDw9IGEgJiYgNTM5NzEgPj0gYSB8fCA1Mzk3MyA8PSBhICYmIDUzOTk5ID49IGEgfHwgNTQwMDEgPD0gYSAmJiA1NDAyNyA+PSBhIHx8IDU0MDI5IDw9IGEgJiYgNTQwNTUgPj0gYSB8fCA1NDA1NyA8PSBhICYmIDU0MDgzID49IGEgfHwgNTQwODUgPD0gYSAmJiA1NDExMSA+PSBhIHx8IDU0MTEzIDw9IGEgJiYgNTQxMzkgPj0gYSB8fCA1NDE0MSA8PSBhICYmIDU0MTY3ID49IGEgfHwgNTQxNjkgPD0gYSAmJiA1NDE5NSA+PSBhIHx8IDU0MTk3IDw9IGEgJiYgNTQyMjMgPj0gYSB8fCA1NDIyNSA8PSBhICYmIDU0MjUxID49IGEgfHwgNTQyNTMgPD0gYSAmJiA1NDI3OSA+PSBhIHx8IDU0MjgxIDw9IGEgJiYgNTQzMDcgPj0gYSB8fCA1NDMwOSA8PSBhICYmIDU0MzM1ID49IGEgfHwgNTQzMzcgPD0gYSAmJiA1NDM2MyA+PSBhIHx8IDU0MzY1IDw9IGEgJiYgNTQzOTEgPj0gYSB8fCA1NDM5MyA8PSBhICYmIDU0NDE5ID49IGEgfHwgNTQ0MjEgPD0gYSAmJiA1NDQ0NyA+PSBhIHx8IDU0NDQ5IDw9IGEgJiYgNTQ0NzUgPj0gYSB8fCA1NDQ3NyA8PSBhICYmIDU0NTAzID49IGEgfHwgNTQ1MDUgPD0KICAgICAgICAgICAgICAgIGEgJiYgNTQ1MzEgPj0gYSB8fCA1NDUzMyA8PSBhICYmIDU0NTU5ID49IGEgfHwgNTQ1NjEgPD0gYSAmJiA1NDU4NyA+PSBhIHx8IDU0NTg5IDw9IGEgJiYgNTQ2MTUgPj0gYSB8fCA1NDYxNyA8PSBhICYmIDU0NjQzID49IGEgfHwgNTQ2NDUgPD0gYSAmJiA1NDY3MSA+PSBhIHx8IDU0NjczIDw9IGEgJiYgNTQ2OTkgPj0gYSB8fCA1NDcwMSA8PSBhICYmIDU0NzI3ID49IGEgfHwgNTQ3MjkgPD0gYSAmJiA1NDc1NSA+PSBhIHx8IDU0NzU3IDw9IGEgJiYgNTQ3ODMgPj0gYSB8fCA1NDc4NSA8PSBhICYmIDU0ODExID49IGEgfHwgNTQ4MTMgPD0gYSAmJiA1NDgzOSA+PSBhIHx8IDU0ODQxIDw9IGEgJiYgNTQ4NjcgPj0gYSB8fCA1NDg2OSA8PSBhICYmIDU0ODk1ID49IGEgfHwgNTQ4OTcgPD0gYSAmJiA1NDkyMyA+PSBhIHx8IDU0OTI1IDw9IGEgJiYgNTQ5NTEgPj0gYSB8fCA1NDk1MyA8PSBhICYmIDU0OTc5ID49IGEgfHwgNTQ5ODEgPD0gYSAmJiA1NTAwNyA+PSBhIHx8IDU1MDA5IDw9IGEgJiYgNTUwMzUgPj0gYSB8fCA1NTAzNyA8PSBhICYmIDU1MDYzID49IGEgfHwgNTUwNjUgPD0gYSAmJiA1NTA5MSA+PSBhIHx8IDU1MDkzIDw9IGEgJiYgNTUxMTkgPj0gYSB8fCA1NTEyMSA8PSBhICYmIDU1MTQ3ID49IGEgfHwgNTUxNDkgPD0gYSAmJiA1NTE3NSA+PSBhIHx8IDU1MTc3IDw9IGEgJiYgNTUyMDMgPj0gYSA/IDEwIDogOTc1NyA9PQogICAgICAgICAgICAgICAgYSB8fCA5OTc3ID09IGEgfHwgOTk5NCA8PSBhICYmIDk5OTcgPj0gYSB8fCAxMjc4NzcgPT0gYSB8fCAxMjc5MzggPD0gYSAmJiAxMjc5NDAgPj0gYSB8fCAxMjc5NDMgPT0gYSB8fCAxMjc5NDYgPD0gYSAmJiAxMjc5NDggPj0gYSB8fCAxMjgwNjYgPD0gYSAmJiAxMjgwNjcgPj0gYSB8fCAxMjgwNzAgPD0gYSAmJiAxMjgwODAgPj0gYSB8fCAxMjgxMTAgPT0gYSB8fCAxMjgxMTIgPD0gYSAmJiAxMjgxMjAgPj0gYSB8fCAxMjgxMjQgPT0gYSB8fCAxMjgxMjkgPD0gYSAmJiAxMjgxMzEgPj0gYSB8fCAxMjgxMzMgPD0gYSAmJiAxMjgxMzUgPj0gYSB8fCAxMjgxNzAgPT0gYSB8fCAxMjgzNzIgPD0gYSAmJiAxMjgzNzMgPj0gYSB8fCAxMjgzNzggPT0gYSB8fCAxMjg0MDAgPT0gYSB8fCAxMjg0MDUgPD0gYSAmJiAxMjg0MDYgPj0gYSB8fCAxMjg1ODEgPD0gYSAmJiAxMjg1ODMgPj0gYSB8fCAxMjg1ODcgPD0gYSAmJiAxMjg1OTEgPj0gYSB8fCAxMjg2NzUgPT0gYSB8fCAxMjg2OTIgPD0gYSAmJiAxMjg2OTQgPj0gYSB8fCAxMjg3MDQgPT0gYSB8fCAxMjg3MTYgPT0gYSB8fCAxMjkzMDQgPD0gYSAmJiAxMjkzMDggPj0gYSB8fCAxMjkzMTAgPD0gYSAmJiAxMjkzMTEgPj0gYSB8fCAxMjkzMTggPT0gYSB8fCAxMjkzMjggPD0gYSAmJiAxMjkzMzcgPj0gYSB8fCAxMjkzNDEgPD0gYSAmJiAxMjkzNDIgPj0gYSB8fAogICAgICAgICAgICAgICAgMTI5NDg5IDw9IGEgJiYgMTI5NTAxID49IGEgPyAxMyA6IDEyNzk5NSA8PSBhICYmIDEyNzk5OSA+PSBhID8gMTQgOiA4MjA1ID09IGEgPyAxNSA6IDk3OTIgPT0gYSB8fCA5Nzk0ID09IGEgfHwgOTg3NyA8PSBhICYmIDk4NzggPj0gYSB8fCA5OTkyID09IGEgfHwgMTAwODQgPT0gYSB8fCAxMjc3NTIgPT0gYSB8fCAxMjc4MDYgPT0gYSB8fCAxMjc4NTkgPT0gYSB8fCAxMjc4OTEgPT0gYSB8fCAxMjc5MDggPT0gYSB8fCAxMjc5MTIgPT0gYSB8fCAxMjc5NzkgPT0gYSB8fCAxMjc5ODEgPT0gYSB8fCAxMjgxMzkgPT0gYSB8fCAxMjgxODcgPD0gYSAmJiAxMjgxODggPj0gYSB8fCAxMjgyOTUgPT0gYSB8fCAxMjgzMDAgPT0gYSB8fCAxMjg0ODggPT0gYSB8fCAxMjg2NDAgPT0gYSB8fCAxMjg2NTggPT0gYSA/IDE2IDogMTI4MTAyIDw9IGEgJiYgMTI4MTA1ID49IGEgPyAxNyA6IDExCiAgICAgICAgfQogICAgICAgIHRoaXMubmV4dEJyZWFrID0gZnVuY3Rpb24oYSwgYykgewogICAgICAgICAgICB2b2lkIDAgPT09IGMgJiYgKGMgPSAwKTsKICAgICAgICAgICAgaWYgKDAgPiBjKSByZXR1cm4gMDsKICAgICAgICAgICAgaWYgKGMgPj0gYS5sZW5ndGggLSAxKSByZXR1cm4gYS5sZW5ndGg7CiAgICAgICAgICAgIHZhciBiID0gayhoKGEsIGMpKSwKICAgICAgICAgICAgICAgIGQgPSBbXTsKICAgICAgICAgICAgZm9yIChjICs9IDE7IGMgPCBhLmxlbmd0aDsgYysrKSB7CiAgICAgICAgICAgICAgICB2YXIgZSA9IGEsCiAgICAgICAgICAgICAgICAgICAgZyA9IGMgLSAxOwogICAgICAgICAgICAgICAgaWYgKCEoNTUyOTYgPD0gZS5jaGFyQ29kZUF0KGcpICYmCiAgICAgICAgICAgICAgICAgICAgICAgIDU2MzE5ID49IGUuY2hhckNvZGVBdChnKSAmJiA1NjMyMCA8PSBlLmNoYXJDb2RlQXQoZyArIDEpICYmIDU3MzQzID49IGUuY2hhckNvZGVBdChnICsgMSkpKSB7CiAgICAgICAgICAgICAgICAgICAgZSA9IGsoaChhLCBjKSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGwoYiwgZCwgZSkpIHJldHVybiBjOwogICAgICAgICAgICAgICAgICAgIGQucHVzaChlKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBhLmxlbmd0aAogICAgICAgIH07CiAgICAgICAgdGhpcy5zcGxpdEdyYXBoZW1lcyA9IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgZm9yICh2YXIgYyA9IFtdLCBiID0gMCwgZDsKICAgICAgICAgICAgICAgIChkID0gdGhpcy5uZXh0QnJlYWsoYSwgYikpIDwgYS5sZW5ndGg7KSBjLnB1c2goYS5zbGljZShiLCBkKSksIGIgPSBkOwogICAgICAgICAgICBiIDwgYS5sZW5ndGggJiYgYy5wdXNoKGEuc2xpY2UoYikpOwogICAgICAgICAgICByZXR1cm4gYwogICAgICAgIH07CiAgICAgICAgdGhpcy5pdGVyYXRlR3JhcGhlbWVzID0gZnVuY3Rpb24oYSkgewogICAgICAgICAgICB2YXIgYyA9IDAsCiAgICAgICAgICAgICAgICBiID0gewogICAgICAgICAgICAgICAgICAgIG5leHQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZDsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChkID0gdGhpcy5uZXh0QnJlYWsoYSwgYykpIDwgYS5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlID0gYS5zbGljZShjLCBkKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMgPSBkOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb25lOiAhMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjIDwgYS5sZW5ndGggPyAoZSA9IGEuc2xpY2UoYyksIGMgPSBhLmxlbmd0aCwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb25lOiAhMQogICAgICAgICAgICAgICAgICAgICAgICB9KSA6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB2b2lkIDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb25lOiAhMAogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAidW5kZWZpbmVkIiAhPT0gdHlwZW9mIFN5bWJvbCAmJiBTeW1ib2wuaXRlcmF0b3IgJiYgKGJbU3ltYm9sLml0ZXJhdG9yXSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGIKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiBiCiAgICAgICAgfTsKICAgICAgICB0aGlzLmNvdW50R3JhcGhlbWVzID0gZnVuY3Rpb24oYSkgewogICAgICAgICAgICBmb3IgKHZhciBjID0gMCwgYiA9IDAsIGQ7CiAgICAgICAgICAgICAgICAoZCA9IHRoaXMubmV4dEJyZWFrKGEsIGIpKSA8IGEubGVuZ3RoOykgYiA9IGQsIGMrKzsKICAgICAgICAgICAgYiA8IGEubGVuZ3RoICYmIGMrKzsKICAgICAgICAgICAgcmV0dXJuIGMKICAgICAgICB9OwogICAgICAgIHJldHVybiB0aGlzCiAgICB9CiAgICBzZWxmLkdyYXBoZW1lU3BsaXR0ZXIgPSBHcmFwaGVtZVNwbGl0dGVyOwoKfQoKLy8gM3JkcGFydHkvcG9seS1kZWNvbXAuanMKewogICAgJ3VzZSBzdHJpY3QnOwoKICAgIGZ1bmN0aW9uIGxpbmVJbnQobDEsIGwyLCBwcmVjaXNpb24pIHsKICAgICAgICBwcmVjaXNpb24gPSBwcmVjaXNpb24gfHwgMDsKICAgICAgICB2YXIgaSA9IFswLCAwXTsKICAgICAgICB2YXIgYTEsIGIxLCBjMSwgYTIsIGIyLCBjMiwgZGV0OwogICAgICAgIGExID0gbDFbMV1bMV0gLSBsMVswXVsxXTsKICAgICAgICBiMSA9IGwxWzBdWzBdIC0gbDFbMV1bMF07CiAgICAgICAgYzEgPSBhMSAqIGwxWzBdWzBdICsgYjEgKiBsMVswXVsxXTsKICAgICAgICBhMiA9IGwyWzFdWzFdIC0gbDJbMF1bMV07CiAgICAgICAgYjIgPSBsMlswXVswXSAtIGwyWzFdWzBdOwogICAgICAgIGMyID0gYTIgKiBsMlswXVswXSArIGIyICogbDJbMF1bMV07CiAgICAgICAgZGV0ID0gYTEgKiBiMiAtIGEyICogYjE7CiAgICAgICAgaWYgKCFzY2FsYXJfZXEoZGV0LCAwLCBwcmVjaXNpb24pKSB7CiAgICAgICAgICAgIGlbMF0gPSAoYjIgKiBjMSAtIGIxICogYzIpIC8gZGV0OwogICAgICAgICAgICBpWzFdID0gKGExICogYzIgLSBhMiAqIGMxKSAvIGRldAogICAgICAgIH0KICAgICAgICByZXR1cm4gaQogICAgfQoKICAgIGZ1bmN0aW9uIGxpbmVTZWdtZW50c0ludGVyc2VjdChwMSwgcDIsIHExLCBxMikgewogICAgICAgIHZhciBkeCA9IHAyWzBdIC0gcDFbMF07CiAgICAgICAgdmFyIGR5ID0gcDJbMV0gLSBwMVsxXTsKICAgICAgICB2YXIgZGEgPSBxMlswXSAtIHExWzBdOwogICAgICAgIHZhciBkYiA9IHEyWzFdIC0gcTFbMV07CiAgICAgICAgaWYgKGRhICogZHkgLSBkYiAqIGR4ID09PSAwKSByZXR1cm4gZmFsc2U7CiAgICAgICAgdmFyIHMgPSAoZHggKiAocTFbMV0gLSBwMVsxXSkgKyBkeSAqIChwMVswXSAtIHExWzBdKSkgLyAoZGEgKiBkeSAtIGRiICogZHgpOwogICAgICAgIHZhciB0ID0gKGRhICogKHAxWzFdIC0gcTFbMV0pICsgZGIgKiAocTFbMF0gLSBwMVswXSkpIC8gKGRiICogZHggLSBkYSAqIGR5KTsKICAgICAgICByZXR1cm4gcyA+PSAwICYmIHMgPD0gMSAmJiB0ID49IDAgJiYgdCA8PSAxCiAgICB9CgogICAgZnVuY3Rpb24gdHJpYW5nbGVBcmVhKGEsIGIsIGMpIHsKICAgICAgICByZXR1cm4gKGJbMF0gLSBhWzBdKSAqIChjWzFdIC0gYVsxXSkgLSAoY1swXSAtIGFbMF0pICogKGJbMV0gLSBhWzFdKQogICAgfQoKICAgIGZ1bmN0aW9uIGlzTGVmdChhLCBiLCBjKSB7CiAgICAgICAgcmV0dXJuIHRyaWFuZ2xlQXJlYShhLCBiLCBjKSA+IDAKICAgIH0KCiAgICBmdW5jdGlvbiBpc0xlZnRPbihhLCBiLCBjKSB7CiAgICAgICAgcmV0dXJuIHRyaWFuZ2xlQXJlYShhLCBiLCBjKSA+PSAwCiAgICB9CgogICAgZnVuY3Rpb24gaXNSaWdodChhLCBiLCBjKSB7CiAgICAgICAgcmV0dXJuIHRyaWFuZ2xlQXJlYShhLCBiLCBjKSA8IDAKICAgIH0KCiAgICBmdW5jdGlvbiBpc1JpZ2h0T24oYSwgYiwgYykgewogICAgICAgIHJldHVybiB0cmlhbmdsZUFyZWEoYSwgYiwgYykgPD0gMAogICAgfQogICAgdmFyIHRtcFBvaW50MSA9IFtdLAogICAgICAgIHRtcFBvaW50MiA9IFtdOwoKICAgIGZ1bmN0aW9uIGNvbGxpbmVhcihhLCBiLCBjLCB0aHJlc2hvbGRBbmdsZSkgewogICAgICAgIGlmICghdGhyZXNob2xkQW5nbGUpIHJldHVybiB0cmlhbmdsZUFyZWEoYSwgYiwgYykgPT09IDA7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHZhciBhYiA9IHRtcFBvaW50MSwKICAgICAgICAgICAgICAgIGJjID0gdG1wUG9pbnQyOwogICAgICAgICAgICBhYlswXSA9IGJbMF0gLSBhWzBdOwogICAgICAgICAgICBhYlsxXSA9IGJbMV0gLSBhWzFdOwogICAgICAgICAgICBiY1swXSA9IGNbMF0gLSBiWzBdOwogICAgICAgICAgICBiY1sxXSA9IGNbMV0gLSBiWzFdOwogICAgICAgICAgICB2YXIgZG90ID0gYWJbMF0gKiBiY1swXSArIGFiWzFdICogYmNbMV0sCiAgICAgICAgICAgICAgICBtYWdBID0gTWF0aC5zcXJ0KGFiWzBdICogYWJbMF0gKyBhYlsxXSAqIGFiWzFdKSwKICAgICAgICAgICAgICAgIG1hZ0IgPSBNYXRoLnNxcnQoYmNbMF0gKiBiY1swXSArIGJjWzFdICogYmNbMV0pLAogICAgICAgICAgICAgICAgYW5nbGUgPSBNYXRoLmFjb3MoZG90IC8gKG1hZ0EgKiBtYWdCKSk7CiAgICAgICAgICAgIHJldHVybiBhbmdsZSA8IHRocmVzaG9sZEFuZ2xlCiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHNxZGlzdChhLCBiKSB7CiAgICAgICAgdmFyIGR4ID0gYlswXSAtIGFbMF07CiAgICAgICAgdmFyIGR5ID0gYlsxXSAtIGFbMV07CiAgICAgICAgcmV0dXJuIGR4ICogZHggKyBkeSAqIGR5CiAgICB9CgogICAgZnVuY3Rpb24gcG9seWdvbkF0KHBvbHlnb24sIGkpIHsKICAgICAgICB2YXIgcyA9IHBvbHlnb24ubGVuZ3RoOwogICAgICAgIHJldHVybiBwb2x5Z29uW2kgPCAwID8gaSAlIHMgKyBzIDogaSAlIHNdCiAgICB9CgogICAgZnVuY3Rpb24gcG9seWdvbkNsZWFyKHBvbHlnb24pIHsKICAgICAgICBwb2x5Z29uLmxlbmd0aCA9IDAKICAgIH0KCiAgICBmdW5jdGlvbiBwb2x5Z29uQXBwZW5kKHBvbHlnb24sIHBvbHksIGZyb20sIHRvKSB7CiAgICAgICAgZm9yICh2YXIgaSA9IGZyb207IGkgPCB0bzsgaSsrKSBwb2x5Z29uLnB1c2gocG9seVtpXSkKICAgIH0KCiAgICBmdW5jdGlvbiBwb2x5Z29uTWFrZUNDVyhwb2x5Z29uKSB7CiAgICAgICAgdmFyIGJyID0gMCwKICAgICAgICAgICAgdiA9IHBvbHlnb247CiAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCBwb2x5Z29uLmxlbmd0aDsgKytpKQogICAgICAgICAgICBpZiAodltpXVsxXSA8IHZbYnJdWzFdIHx8IHZbaV1bMV0gPT09IHZbYnJdWzFdICYmIHZbaV1bMF0gPiB2W2JyXVswXSkgYnIgPSBpOwogICAgICAgIGlmICghaXNMZWZ0KHBvbHlnb25BdChwb2x5Z29uLCBiciAtIDEpLCBwb2x5Z29uQXQocG9seWdvbiwgYnIpLCBwb2x5Z29uQXQocG9seWdvbiwgYnIgKyAxKSkpIHsKICAgICAgICAgICAgcG9seWdvblJldmVyc2UocG9seWdvbik7CiAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgfSBlbHNlIHJldHVybiBmYWxzZQogICAgfQoKICAgIGZ1bmN0aW9uIHBvbHlnb25SZXZlcnNlKHBvbHlnb24pIHsKICAgICAgICB2YXIgdG1wID0gW107CiAgICAgICAgdmFyIE4gPSBwb2x5Z29uLmxlbmd0aDsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSAhPT0gTjsgaSsrKSB0bXAucHVzaChwb2x5Z29uLnBvcCgpKTsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSAhPT0gTjsgaSsrKSBwb2x5Z29uW2ldID0gdG1wW2ldCiAgICB9CgogICAgZnVuY3Rpb24gcG9seWdvbklzUmVmbGV4KHBvbHlnb24sIGkpIHsKICAgICAgICByZXR1cm4gaXNSaWdodChwb2x5Z29uQXQocG9seWdvbiwgaSAtIDEpLCBwb2x5Z29uQXQocG9seWdvbiwgaSksIHBvbHlnb25BdChwb2x5Z29uLCBpICsgMSkpCiAgICB9CiAgICB2YXIgdG1wTGluZTEgPSBbXSwKICAgICAgICB0bXBMaW5lMiA9IFtdOwoKICAgIGZ1bmN0aW9uIHBvbHlnb25DYW5TZWUocG9seWdvbiwgYSwgYikgewogICAgICAgIHZhciBwLCBkaXN0LCBsMSA9IHRtcExpbmUxLAogICAgICAgICAgICBsMiA9IHRtcExpbmUyOwogICAgICAgIGlmIChpc0xlZnRPbihwb2x5Z29uQXQocG9seWdvbiwgYSArIDEpLCBwb2x5Z29uQXQocG9seWdvbiwgYSksIHBvbHlnb25BdChwb2x5Z29uLCBiKSkgJiYgaXNSaWdodE9uKHBvbHlnb25BdChwb2x5Z29uLCBhIC0gMSksIHBvbHlnb25BdChwb2x5Z29uLCBhKSwgcG9seWdvbkF0KHBvbHlnb24sIGIpKSkgcmV0dXJuIGZhbHNlOwogICAgICAgIGRpc3QgPSBzcWRpc3QocG9seWdvbkF0KHBvbHlnb24sIGEpLCBwb2x5Z29uQXQocG9seWdvbiwgYikpOwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpICE9PSBwb2x5Z29uLmxlbmd0aDsgKytpKSB7CiAgICAgICAgICAgIGlmICgoaSArIDEpICUgcG9seWdvbi5sZW5ndGggPT09IGEgfHwgaSA9PT0gYSkgY29udGludWU7CiAgICAgICAgICAgIGlmIChpc0xlZnRPbihwb2x5Z29uQXQocG9seWdvbiwgYSksIHBvbHlnb25BdChwb2x5Z29uLCBiKSwgcG9seWdvbkF0KHBvbHlnb24sIGkgKyAxKSkgJiYgaXNSaWdodE9uKHBvbHlnb25BdChwb2x5Z29uLCBhKSwgcG9seWdvbkF0KHBvbHlnb24sCiAgICAgICAgICAgICAgICAgICAgYiksIHBvbHlnb25BdChwb2x5Z29uLCBpKSkpIHsKICAgICAgICAgICAgICAgIGwxWzBdID0gcG9seWdvbkF0KHBvbHlnb24sIGEpOwogICAgICAgICAgICAgICAgbDFbMV0gPSBwb2x5Z29uQXQocG9seWdvbiwgYik7CiAgICAgICAgICAgICAgICBsMlswXSA9IHBvbHlnb25BdChwb2x5Z29uLCBpKTsKICAgICAgICAgICAgICAgIGwyWzFdID0gcG9seWdvbkF0KHBvbHlnb24sIGkgKyAxKTsKICAgICAgICAgICAgICAgIHAgPSBsaW5lSW50KGwxLCBsMik7CiAgICAgICAgICAgICAgICBpZiAoc3FkaXN0KHBvbHlnb25BdChwb2x5Z29uLCBhKSwgcCkgPCBkaXN0KSByZXR1cm4gZmFsc2UKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZQogICAgfQoKICAgIGZ1bmN0aW9uIHBvbHlnb25DYW5TZWUyKHBvbHlnb24sIGEsIGIpIHsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSAhPT0gcG9seWdvbi5sZW5ndGg7ICsraSkgewogICAgICAgICAgICBpZiAoaSA9PT0gYSB8fCBpID09PSBiIHx8IChpICsgMSkgJSBwb2x5Z29uLmxlbmd0aCA9PT0gYSB8fCAoaSArIDEpICUgcG9seWdvbi5sZW5ndGggPT09IGIpIGNvbnRpbnVlOwogICAgICAgICAgICBpZiAobGluZVNlZ21lbnRzSW50ZXJzZWN0KHBvbHlnb25BdChwb2x5Z29uLCBhKSwgcG9seWdvbkF0KHBvbHlnb24sIGIpLCBwb2x5Z29uQXQocG9seWdvbiwgaSksIHBvbHlnb25BdChwb2x5Z29uLCBpICsgMSkpKSByZXR1cm4gZmFsc2UKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWUKICAgIH0KCiAgICBmdW5jdGlvbiBwb2x5Z29uQ29weShwb2x5Z29uLCBpLCBqLCB0YXJnZXRQb2x5KSB7CiAgICAgICAgdmFyIHAgPSB0YXJnZXRQb2x5IHx8IFtdOwogICAgICAgIHBvbHlnb25DbGVhcihwKTsKICAgICAgICBpZiAoaSA8IGopCiAgICAgICAgICAgIGZvciAodmFyIGsgPSBpOyBrIDw9IGo7IGsrKykgcC5wdXNoKHBvbHlnb25ba10pOwogICAgICAgIGVsc2UgewogICAgICAgICAgICBmb3IgKHZhciBrID0gMDsgayA8PSBqOyBrKyspIHAucHVzaChwb2x5Z29uW2tdKTsKICAgICAgICAgICAgZm9yICh2YXIgayA9IGk7IGsgPCBwb2x5Z29uLmxlbmd0aDsgaysrKSBwLnB1c2gocG9seWdvbltrXSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHAKICAgIH0KCiAgICBmdW5jdGlvbiBwb2x5Z29uR2V0Q3V0RWRnZXMocG9seWdvbikgewogICAgICAgIHZhciBtaW4gPSBbXSwKICAgICAgICAgICAgdG1wMSA9IFtdLAogICAgICAgICAgICB0bXAyID0gW10sCiAgICAgICAgICAgIHRtcFBvbHkgPSBbXTsKICAgICAgICB2YXIgbkRpYWdzID0gTnVtYmVyLk1BWF9WQUxVRTsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHBvbHlnb24ubGVuZ3RoOyArK2kpCiAgICAgICAgICAgIGlmIChwb2x5Z29uSXNSZWZsZXgocG9seWdvbiwgaSkpCiAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHBvbHlnb24ubGVuZ3RoOyArK2opCiAgICAgICAgICAgICAgICAgICAgaWYgKHBvbHlnb25DYW5TZWUocG9seWdvbiwgaSwgaikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdG1wMSA9IHBvbHlnb25HZXRDdXRFZGdlcyhwb2x5Z29uQ29weShwb2x5Z29uLCBpLCBqLCB0bXBQb2x5KSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRtcDIgPSBwb2x5Z29uR2V0Q3V0RWRnZXMocG9seWdvbkNvcHkocG9seWdvbiwgaiwgaSwgdG1wUG9seSkpOwogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBrID0gMDsgayA8IHRtcDIubGVuZ3RoOyBrKyspIHRtcDEucHVzaCh0bXAyW2tdKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRtcDEubGVuZ3RoIDwgbkRpYWdzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtaW4gPSB0bXAxOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbkRpYWdzID0gdG1wMS5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtaW4ucHVzaChbcG9seWdvbkF0KHBvbHlnb24sIGkpLCBwb2x5Z29uQXQocG9seWdvbiwgaildKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgIHJldHVybiBtaW4KICAgIH0KCiAgICBmdW5jdGlvbiBwb2x5Z29uRGVjb21wKHBvbHlnb24pIHsKICAgICAgICB2YXIgZWRnZXMgPSBwb2x5Z29uR2V0Q3V0RWRnZXMocG9seWdvbik7CiAgICAgICAgaWYgKGVkZ2VzLmxlbmd0aCA+IDApIHJldHVybiBwb2x5Z29uU2xpY2UocG9seWdvbiwgZWRnZXMpOwogICAgICAgIGVsc2UgcmV0dXJuIFtwb2x5Z29uXQogICAgfQoKICAgIGZ1bmN0aW9uIHBvbHlnb25TbGljZShwb2x5Z29uLCBjdXRFZGdlcykgewogICAgICAgIGlmIChjdXRFZGdlcy5sZW5ndGggPT09IDApIHJldHVybiBbcG9seWdvbl07CiAgICAgICAgaWYgKGN1dEVkZ2VzIGluc3RhbmNlb2YgQXJyYXkgJiYgY3V0RWRnZXMubGVuZ3RoICYmIGN1dEVkZ2VzWzBdIGluc3RhbmNlb2YgQXJyYXkgJiYgY3V0RWRnZXNbMF0ubGVuZ3RoID09PSAyICYmIGN1dEVkZ2VzWzBdWzBdIGluc3RhbmNlb2YgQXJyYXkpIHsKICAgICAgICAgICAgdmFyIHBvbHlzID0gW3BvbHlnb25dOwogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGN1dEVkZ2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICB2YXIgY3V0RWRnZSA9IGN1dEVkZ2VzW2ldOwogICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBwb2x5cy5sZW5ndGg7IGorKykgewogICAgICAgICAgICAgICAgICAgIHZhciBwb2x5ID0gcG9seXNbal07CiAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IHBvbHlnb25TbGljZShwb2x5LCBjdXRFZGdlKTsKICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHBvbHlzLnNwbGljZShqLCAxKTsKICAgICAgICAgICAgICAgICAgICAgICAgcG9seXMucHVzaChyZXN1bHRbMF0sIHJlc3VsdFsxXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBwb2x5cwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZhciBjdXRFZGdlID0gY3V0RWRnZXM7CiAgICAgICAgICAgIHZhciBpID0gcG9seWdvbi5pbmRleE9mKGN1dEVkZ2VbMF0pOwogICAgICAgICAgICB2YXIgaiA9IHBvbHlnb24uaW5kZXhPZihjdXRFZGdlWzFdKTsKICAgICAgICAgICAgaWYgKGkgIT09IC0xICYmIGogIT09IC0xKSByZXR1cm4gW3BvbHlnb25Db3B5KHBvbHlnb24sIGksIGopLCBwb2x5Z29uQ29weShwb2x5Z29uLCBqLCBpKV07CiAgICAgICAgICAgIGVsc2UgcmV0dXJuIGZhbHNlCiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHBvbHlnb25Jc1NpbXBsZShwb2x5Z29uKSB7CiAgICAgICAgdmFyIHBhdGggPSBwb2x5Z29uLAogICAgICAgICAgICBpOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBwYXRoLmxlbmd0aCAtIDE7IGkrKykKICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBpIC0gMTsgaisrKQogICAgICAgICAgICAgICAgaWYgKGxpbmVTZWdtZW50c0ludGVyc2VjdChwYXRoW2ldLCBwYXRoW2kgKyAxXSwgcGF0aFtqXSwgcGF0aFtqICsgMV0pKSByZXR1cm4gZmFsc2U7CiAgICAgICAgZm9yIChpID0gMTsgaSA8IHBhdGgubGVuZ3RoIC0gMjsgaSsrKQogICAgICAgICAgICBpZiAobGluZVNlZ21lbnRzSW50ZXJzZWN0KHBhdGhbMF0sIHBhdGhbcGF0aC5sZW5ndGggLSAxXSwgcGF0aFtpXSwgcGF0aFtpICsgMV0pKSByZXR1cm4gZmFsc2U7CiAgICAgICAgcmV0dXJuIHRydWUKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRJbnRlcnNlY3Rpb25Qb2ludChwMSwgcDIsIHExLCBxMiwgZGVsdGEpIHsKICAgICAgICBkZWx0YSA9IGRlbHRhIHx8IDA7CiAgICAgICAgdmFyIGExID0gcDJbMV0gLSBwMVsxXTsKICAgICAgICB2YXIgYjEgPSBwMVswXSAtIHAyWzBdOwogICAgICAgIHZhciBjMSA9IGExICogcDFbMF0gKyBiMSAqIHAxWzFdOwogICAgICAgIHZhciBhMiA9IHEyWzFdIC0gcTFbMV07CiAgICAgICAgdmFyIGIyID0gcTFbMF0gLSBxMlswXTsKICAgICAgICB2YXIgYzIgPSBhMiAqIHExWzBdICsgYjIgKiBxMVsxXTsKICAgICAgICB2YXIgZGV0ID0gYTEgKiBiMiAtIGEyICogYjE7CiAgICAgICAgaWYgKCFzY2FsYXJfZXEoZGV0LCAwLCBkZWx0YSkpIHJldHVybiBbKGIyICogYzEgLSBiMSAqIGMyKSAvIGRldCwgKGExICogYzIgLSBhMiAqIGMxKSAvIGRldF07CiAgICAgICAgZWxzZSByZXR1cm4gWzAsIDBdCiAgICB9CgogICAgZnVuY3Rpb24gcG9seWdvblF1aWNrRGVjb21wKHBvbHlnb24sIHJlc3VsdCwgcmVmbGV4VmVydGljZXMsIHN0ZWluZXJQb2ludHMsIGRlbHRhLCBtYXhsZXZlbCwgbGV2ZWwpIHsKICAgICAgICBtYXhsZXZlbCA9IG1heGxldmVsIHx8IDEwMDsKICAgICAgICBsZXZlbCA9IGxldmVsIHx8IDA7CiAgICAgICAgZGVsdGEgPSBkZWx0YSB8fCAyNTsKICAgICAgICByZXN1bHQgPSB0eXBlb2YgcmVzdWx0ICE9PSAidW5kZWZpbmVkIiA/IHJlc3VsdCA6IFtdOwogICAgICAgIHJlZmxleFZlcnRpY2VzID0gcmVmbGV4VmVydGljZXMgfHwgW107CiAgICAgICAgc3RlaW5lclBvaW50cyA9IHN0ZWluZXJQb2ludHMgfHwgW107CiAgICAgICAgdmFyIHVwcGVySW50ID0gWzAsIDBdLAogICAgICAgICAgICBsb3dlckludCA9IFswLCAwXSwKICAgICAgICAgICAgcCA9IFswLCAwXTsKICAgICAgICB2YXIgdXBwZXJEaXN0ID0gMCwKICAgICAgICAgICAgbG93ZXJEaXN0ID0gMCwKICAgICAgICAgICAgZCA9IDAsCiAgICAgICAgICAgIGNsb3Nlc3REaXN0ID0gMDsKICAgICAgICB2YXIgdXBwZXJJbmRleCA9IDAsCiAgICAgICAgICAgIGxvd2VySW5kZXggPSAwLAogICAgICAgICAgICBjbG9zZXN0SW5kZXggPSAwOwogICAgICAgIHZhciBsb3dlclBvbHkgPSBbXSwKICAgICAgICAgICAgdXBwZXJQb2x5ID0gW107CiAgICAgICAgdmFyIHBvbHkgPSBwb2x5Z29uLAogICAgICAgICAgICB2ID0gcG9seWdvbjsKICAgICAgICBpZiAodi5sZW5ndGggPCAzKSByZXR1cm4gcmVzdWx0OwogICAgICAgIGxldmVsKys7CiAgICAgICAgaWYgKGxldmVsID4gbWF4bGV2ZWwpIHsKICAgICAgICAgICAgY29uc29sZS53YXJuKCJxdWlja0RlY29tcDogbWF4IGxldmVsICgiICsKICAgICAgICAgICAgICAgIG1heGxldmVsICsgIikgcmVhY2hlZC4iKTsKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdAogICAgICAgIH0KICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHBvbHlnb24ubGVuZ3RoOyArK2kpCiAgICAgICAgICAgIGlmIChwb2x5Z29uSXNSZWZsZXgocG9seSwgaSkpIHsKICAgICAgICAgICAgICAgIHJlZmxleFZlcnRpY2VzLnB1c2gocG9seVtpXSk7CiAgICAgICAgICAgICAgICB1cHBlckRpc3QgPSBsb3dlckRpc3QgPSBOdW1iZXIuTUFYX1ZBTFVFOwogICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBwb2x5Z29uLmxlbmd0aDsgKytqKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTGVmdChwb2x5Z29uQXQocG9seSwgaSAtIDEpLCBwb2x5Z29uQXQocG9seSwgaSksIHBvbHlnb25BdChwb2x5LCBqKSkgJiYgaXNSaWdodE9uKHBvbHlnb25BdChwb2x5LCBpIC0gMSksIHBvbHlnb25BdChwb2x5LCBpKSwgcG9seWdvbkF0KHBvbHksIGogLSAxKSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcCA9IGdldEludGVyc2VjdGlvblBvaW50KHBvbHlnb25BdChwb2x5LCBpIC0gMSksIHBvbHlnb25BdChwb2x5LCBpKSwgcG9seWdvbkF0KHBvbHksIGopLCBwb2x5Z29uQXQocG9seSwgaiAtIDEpKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzUmlnaHQocG9seWdvbkF0KHBvbHksIGkgKyAxKSwgcG9seWdvbkF0KHBvbHksIGkpLCBwKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZCA9IHNxZGlzdChwb2x5W2ldLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGQgPCBsb3dlckRpc3QpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb3dlckRpc3QgPSBkOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvd2VySW50ID0gcDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb3dlckluZGV4ID0gagogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChpc0xlZnQocG9seWdvbkF0KHBvbHksIGkgKyAxKSwgcG9seWdvbkF0KHBvbHksIGkpLCBwb2x5Z29uQXQocG9seSwgaiArIDEpKSAmJiBpc1JpZ2h0T24ocG9seWdvbkF0KHBvbHksIGkgKyAxKSwgcG9seWdvbkF0KHBvbHksIGkpLCBwb2x5Z29uQXQocG9seSwgaikpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHAgPSBnZXRJbnRlcnNlY3Rpb25Qb2ludChwb2x5Z29uQXQocG9seSwgaSArIDEpLCBwb2x5Z29uQXQocG9seSwgaSksIHBvbHlnb25BdChwb2x5LCBqKSwgcG9seWdvbkF0KHBvbHksIGogKyAxKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc0xlZnQocG9seWdvbkF0KHBvbHksIGkgLSAxKSwgcG9seWdvbkF0KHBvbHksIGkpLCBwKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZCA9IHNxZGlzdChwb2x5W2ldLCBwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkIDwgdXBwZXJEaXN0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXBwZXJEaXN0ID0gZDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cHBlckludCA9IHA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXBwZXJJbmRleCA9IGoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChsb3dlckluZGV4ID09PSAodXBwZXJJbmRleCArIDEpICUgcG9seWdvbi5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICBwWzBdID0gKGxvd2VySW50WzBdICsgdXBwZXJJbnRbMF0pIC8gMjsKICAgICAgICAgICAgICAgICAgICBwWzFdID0gKGxvd2VySW50WzFdICsgdXBwZXJJbnRbMV0pIC8gMjsKICAgICAgICAgICAgICAgICAgICBzdGVpbmVyUG9pbnRzLnB1c2gocCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGkgPCB1cHBlckluZGV4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHBvbHlnb25BcHBlbmQobG93ZXJQb2x5LCBwb2x5LCBpLCB1cHBlckluZGV4ICsgMSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvd2VyUG9seS5wdXNoKHApOwogICAgICAgICAgICAgICAgICAgICAgICB1cHBlclBvbHkucHVzaChwKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxvd2VySW5kZXggIT09IDApIHBvbHlnb25BcHBlbmQodXBwZXJQb2x5LCBwb2x5LCBsb3dlckluZGV4LCBwb2x5Lmxlbmd0aCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHBvbHlnb25BcHBlbmQodXBwZXJQb2x5LCBwb2x5LCAwLCBpICsgMSkKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaSAhPT0gMCkgcG9seWdvbkFwcGVuZChsb3dlclBvbHksIHBvbHksIGksIHBvbHkubGVuZ3RoKTsKICAgICAgICAgICAgICAgICAgICAgICAgcG9seWdvbkFwcGVuZChsb3dlclBvbHksIHBvbHksIDAsIHVwcGVySW5kZXggKyAxKTsKICAgICAgICAgICAgICAgICAgICAgICAgbG93ZXJQb2x5LnB1c2gocCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHVwcGVyUG9seS5wdXNoKHApOwogICAgICAgICAgICAgICAgICAgICAgICBwb2x5Z29uQXBwZW5kKHVwcGVyUG9seSwgcG9seSwgbG93ZXJJbmRleCwgaSArIDEpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBpZiAobG93ZXJJbmRleCA+IHVwcGVySW5kZXgpIHVwcGVySW5kZXggKz0gcG9seWdvbi5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgY2xvc2VzdERpc3QgPSBOdW1iZXIuTUFYX1ZBTFVFOwogICAgICAgICAgICAgICAgICAgIGlmICh1cHBlckluZGV4IDwgbG93ZXJJbmRleCkgcmV0dXJuIHJlc3VsdDsKICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gbG93ZXJJbmRleDsgaiA8PSB1cHBlckluZGV4OyArK2opCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc0xlZnRPbihwb2x5Z29uQXQocG9seSwgaSAtIDEpLCBwb2x5Z29uQXQocG9seSwgaSksIHBvbHlnb25BdChwb2x5LCBqKSkgJiYgaXNSaWdodE9uKHBvbHlnb25BdChwb2x5LCBpICsgMSksIHBvbHlnb25BdChwb2x5LCBpKSwgcG9seWdvbkF0KHBvbHksIGopKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZCA9IHNxZGlzdChwb2x5Z29uQXQocG9seSwgaSksIHBvbHlnb25BdChwb2x5LCBqKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZCA8IGNsb3Nlc3REaXN0ICYmIHBvbHlnb25DYW5TZWUyKHBvbHksIGksIGopKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xvc2VzdERpc3QgPSBkOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsb3Nlc3RJbmRleCA9IGogJSBwb2x5Z29uLmxlbmd0aAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKGkgPCBjbG9zZXN0SW5kZXgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcG9seWdvbkFwcGVuZChsb3dlclBvbHksIHBvbHksIGksIGNsb3Nlc3RJbmRleCArIDEpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2xvc2VzdEluZGV4ICE9PSAwKSBwb2x5Z29uQXBwZW5kKHVwcGVyUG9seSwgcG9seSwgY2xvc2VzdEluZGV4LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5sZW5ndGgpOwogICAgICAgICAgICAgICAgICAgICAgICBwb2x5Z29uQXBwZW5kKHVwcGVyUG9seSwgcG9seSwgMCwgaSArIDEpCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGkgIT09IDApIHBvbHlnb25BcHBlbmQobG93ZXJQb2x5LCBwb2x5LCBpLCB2Lmxlbmd0aCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHBvbHlnb25BcHBlbmQobG93ZXJQb2x5LCBwb2x5LCAwLCBjbG9zZXN0SW5kZXggKyAxKTsKICAgICAgICAgICAgICAgICAgICAgICAgcG9seWdvbkFwcGVuZCh1cHBlclBvbHksIHBvbHksIGNsb3Nlc3RJbmRleCwgaSArIDEpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGxvd2VyUG9seS5sZW5ndGggPCB1cHBlclBvbHkubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgcG9seWdvblF1aWNrRGVjb21wKGxvd2VyUG9seSwgcmVzdWx0LCByZWZsZXhWZXJ0aWNlcywgc3RlaW5lclBvaW50cywgZGVsdGEsIG1heGxldmVsLCBsZXZlbCk7CiAgICAgICAgICAgICAgICAgICAgcG9seWdvblF1aWNrRGVjb21wKHVwcGVyUG9seSwgcmVzdWx0LCByZWZsZXhWZXJ0aWNlcywgc3RlaW5lclBvaW50cywgZGVsdGEsIG1heGxldmVsLCBsZXZlbCkKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcG9seWdvblF1aWNrRGVjb21wKHVwcGVyUG9seSwgcmVzdWx0LCByZWZsZXhWZXJ0aWNlcywgc3RlaW5lclBvaW50cywgZGVsdGEsIG1heGxldmVsLCBsZXZlbCk7CiAgICAgICAgICAgICAgICAgICAgcG9seWdvblF1aWNrRGVjb21wKGxvd2VyUG9seSwKICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LCByZWZsZXhWZXJ0aWNlcywgc3RlaW5lclBvaW50cywgZGVsdGEsIG1heGxldmVsLCBsZXZlbCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQKICAgICAgICAgICAgfQogICAgICAgIHJlc3VsdC5wdXNoKHBvbHlnb24pOwogICAgICAgIHJldHVybiByZXN1bHQKICAgIH0KCiAgICBmdW5jdGlvbiBwb2x5Z29uUmVtb3ZlQ29sbGluZWFyUG9pbnRzKHBvbHlnb24sIHByZWNpc2lvbikgewogICAgICAgIHZhciBudW0gPSAwOwogICAgICAgIGZvciAodmFyIGkgPSBwb2x5Z29uLmxlbmd0aCAtIDE7IHBvbHlnb24ubGVuZ3RoID4gMyAmJiBpID49IDA7IC0taSkKICAgICAgICAgICAgaWYgKGNvbGxpbmVhcihwb2x5Z29uQXQocG9seWdvbiwgaSAtIDEpLCBwb2x5Z29uQXQocG9seWdvbiwgaSksIHBvbHlnb25BdChwb2x5Z29uLCBpICsgMSksIHByZWNpc2lvbikpIHsKICAgICAgICAgICAgICAgIHBvbHlnb24uc3BsaWNlKGkgJSBwb2x5Z29uLmxlbmd0aCwgMSk7CiAgICAgICAgICAgICAgICBudW0rKwogICAgICAgICAgICB9CiAgICAgICAgcmV0dXJuIG51bQogICAgfQoKICAgIGZ1bmN0aW9uIHBvbHlnb25SZW1vdmVEdXBsaWNhdGVQb2ludHMocG9seWdvbiwgcHJlY2lzaW9uKSB7CiAgICAgICAgZm9yICh2YXIgaSA9IHBvbHlnb24ubGVuZ3RoIC0gMTsgaSA+PSAxOyAtLWkpIHsKICAgICAgICAgICAgdmFyIHBpID0gcG9seWdvbltpXTsKICAgICAgICAgICAgZm9yICh2YXIgaiA9IGkgLSAxOyBqID49IDA7IC0taikKICAgICAgICAgICAgICAgIGlmIChwb2ludHNfZXEocGksIHBvbHlnb25bal0sIHByZWNpc2lvbikpIHsKICAgICAgICAgICAgICAgICAgICBwb2x5Z29uLnNwbGljZShpLCAxKTsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBzY2FsYXJfZXEoYSwgYiwgcHJlY2lzaW9uKSB7CiAgICAgICAgcHJlY2lzaW9uID0gcHJlY2lzaW9uIHx8IDA7CiAgICAgICAgcmV0dXJuIE1hdGguYWJzKGEgLSBiKSA8PSBwcmVjaXNpb24KICAgIH0KCiAgICBmdW5jdGlvbiBwb2ludHNfZXEoYSwgYiwgcHJlY2lzaW9uKSB7CiAgICAgICAgcmV0dXJuIHNjYWxhcl9lcShhWzBdLCBiWzBdLCBwcmVjaXNpb24pICYmIHNjYWxhcl9lcShhWzFdLCBiWzFdLCBwcmVjaXNpb24pCiAgICB9CiAgICBzZWxmLnBvbHlEZWNvbXAgPSB7CiAgICAgICAgZGVjb21wOiBwb2x5Z29uRGVjb21wLAogICAgICAgIHF1aWNrRGVjb21wOiBwb2x5Z29uUXVpY2tEZWNvbXAsCiAgICAgICAgaXNTaW1wbGU6IHBvbHlnb25Jc1NpbXBsZSwKICAgICAgICByZW1vdmVDb2xsaW5lYXJQb2ludHM6IHBvbHlnb25SZW1vdmVDb2xsaW5lYXJQb2ludHMsCiAgICAgICAgcmVtb3ZlRHVwbGljYXRlUG9pbnRzOiBwb2x5Z29uUmVtb3ZlRHVwbGljYXRlUG9pbnRzLAogICAgICAgIG1ha2VDQ1c6IHBvbHlnb25NYWtlQ0NXCiAgICB9OwoKfQoKLy8gbGliL2MzLmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGxldCBpc1JlYWR5ID0gZmFsc2U7CiAgICBsZXQgaGFzQXBwU3RhcnRlZCA9IGZhbHNlOwogICAgbGV0IGJ1aWxkTW9kZSA9ICJkZXYiOwogICAgY29uc3QgQzMgPSBzZWxmLkMzID0gY2xhc3MgQzMgewogICAgICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgICAgICB0aHJvdyBUeXBlRXJyb3IoInN0YXRpYyBjbGFzcyBjYW4ndCBiZSBpbnN0YW50aWF0ZWQiKTsKICAgICAgICB9CiAgICAgICAgc3RhdGljIFNldFJlYWR5KCkgewogICAgICAgICAgICBpc1JlYWR5ID0gdHJ1ZQogICAgICAgIH0KICAgICAgICBzdGF0aWMgSXNSZWFkeSgpIHsKICAgICAgICAgICAgcmV0dXJuIGlzUmVhZHkKICAgICAgICB9CiAgICAgICAgc3RhdGljIFNldEFwcFN0YXJ0ZWQoKSB7CiAgICAgICAgICAgIGhhc0FwcFN0YXJ0ZWQgPSB0cnVlCiAgICAgICAgfQogICAgICAgIHN0YXRpYyBIYXNBcHBTdGFydGVkKCkgewogICAgICAgICAgICByZXR1cm4gaGFzQXBwU3RhcnRlZAogICAgICAgIH0KICAgICAgICBzdGF0aWMgU2V0QnVpbGRNb2RlKG0pIHsKICAgICAgICAgICAgYnVpbGRNb2RlID0gbQogICAgICAgIH0KICAgICAgICBzdGF0aWMgR2V0QnVpbGRNb2RlKCkgewogICAgICAgICAgICByZXR1cm4gYnVpbGRNb2RlCiAgICAgICAgfQogICAgICAgIHN0YXRpYyBJc1JlbGVhc2VCdWlsZCgpIHsKICAgICAgICAgICAgcmV0dXJuIGJ1aWxkTW9kZSA9PT0gImZpbmFsIgogICAgICAgIH0KICAgIH07CiAgICBDMy5pc0RlYnVnID0gZmFsc2U7CiAgICBDMy5pc0RlYnVnRGVmZW5kID0gZmFsc2U7CiAgICBDMy5oYXJkd2FyZUNvbmN1cnJlbmN5ID0gbmF2aWdhdG9yLmhhcmR3YXJlQ29uY3VycmVuY3kgfHwgMjsKICAgIHNlbGYuQzNYID0ge307Cgp9CgovLyAuLi9saWIvcXVlcnlQYXJzZXIuanMKewogICAgJ3VzZSBzdHJpY3QnOwogICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgQzMuUXVlcnlQYXJzZXIgPSBjbGFzcyBRdWVyeVBhcnNlciB7CiAgICAgICAgY29uc3RydWN0b3IocXVlcnlTdHJpbmcpIHsKICAgICAgICAgICAgdGhpcy5fcXVlcnlTdHJpbmcgPSBxdWVyeVN0cmluZzsKICAgICAgICAgICAgdGhpcy5fcGFyYW1ldGVycyA9IG5ldyBNYXA7CiAgICAgICAgICAgIHRoaXMuX1BhcnNlKCkKICAgICAgICB9CiAgICAgICAgX1BhcnNlKCkgewogICAgICAgICAgICBsZXQgc3RyID0gdGhpcy5fcXVlcnlTdHJpbmc7CiAgICAgICAgICAgIGlmIChzdHIuc3RhcnRzV2l0aCgiPyIpIHx8IHN0ci5zdGFydHNXaXRoKCIjIikpIHN0ciA9IHN0ci5zdWJzdHIoMSk7CiAgICAgICAgICAgIGNvbnN0IGFyciA9IHN0ci5zcGxpdCgiJiIpOwogICAgICAgICAgICBmb3IgKGNvbnN0IHAgb2YgYXJyKSB0aGlzLl9QYXJzZVBhcmFtZXRlcihwKQogICAgICAgIH0KICAgICAgICBfUGFyc2VQYXJhbWV0ZXIocCkgewogICAgICAgICAgICBpZiAoIXApIHJldHVybjsKICAgICAgICAgICAgaWYgKCFwLmluY2x1ZGVzKCI9IikpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3BhcmFtZXRlcnMuc2V0KHAsIG51bGwpOwogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgaSA9IHAuaW5kZXhPZigiPSIpOwogICAgICAgICAgICBjb25zdCBwYXJhbWV0ZXJOYW1lID0gZGVjb2RlVVJJQ29tcG9uZW50KHAuc3Vic3RyaW5nKDAsIGkpKTsKICAgICAgICAgICAgY29uc3QgcGFyYW1ldGVyVmFsdWUgPSBkZWNvZGVVUklDb21wb25lbnQocC5zdWJzdHJpbmcoaSArCiAgICAgICAgICAgICAgICAxKSk7CiAgICAgICAgICAgIHRoaXMuX3BhcmFtZXRlcnMuc2V0KHBhcmFtZXRlck5hbWUsIHBhcmFtZXRlclZhbHVlKQogICAgICAgIH0KICAgICAgICBMb2dBbGwoKSB7CiAgICAgICAgICAgIGZvciAoY29uc3QgZSBvZiB0aGlzLl9wYXJhbWV0ZXJzKSBjb25zb2xlLmxvZygiW1F1ZXJ5UGFyc2VyXSBQYXJhbWV0ZXIgJyIgKyBlWzBdICsgIicgPSAiICsgKGVbMV0gPT09IG51bGwgPyAibnVsbCIgOiAiJyIgKyBlWzFdICsgIiciKSkKICAgICAgICB9CiAgICAgICAgSGFzKG5hbWUpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3BhcmFtZXRlcnMuaGFzKG5hbWUpCiAgICAgICAgfQogICAgICAgIEdldChuYW1lKSB7CiAgICAgICAgICAgIGNvbnN0IHJldCA9IHRoaXMuX3BhcmFtZXRlcnMuZ2V0KG5hbWUpOwogICAgICAgICAgICBpZiAodHlwZW9mIHJldCA9PT0gInVuZGVmaW5lZCIpIHJldHVybiBudWxsOwogICAgICAgICAgICBlbHNlIHJldHVybiByZXQKICAgICAgICB9CiAgICAgICAgQ2xlYXJIYXNoKCkgewogICAgICAgICAgICBoaXN0b3J5LnJlcGxhY2VTdGF0ZSgiIiwgZG9jdW1lbnQudGl0bGUsIGxvY2F0aW9uLnBhdGhuYW1lICsgbG9jYXRpb24uc2VhcmNoKQogICAgICAgIH0KICAgICAgICBSZXBhcnNlKHN0cikgewogICAgICAgICAgICB0aGlzLl9xdWVyeVN0cmluZyA9IHN0cjsKICAgICAgICAgICAgdGhpcy5fcGFyYW1ldGVycy5jbGVhcigpOwogICAgICAgICAgICB0aGlzLl9QYXJzZSgpCiAgICAgICAgfQogICAgfTsKICAgIEMzLlF1ZXJ5U3RyaW5nID0gbmV3IEMzLlF1ZXJ5UGFyc2VyKGxvY2F0aW9uLnNlYXJjaCk7CiAgICBDMy5Mb2NhdGlvbkhhc2hTdHJpbmcgPSBuZXcgQzMuUXVlcnlQYXJzZXIobG9jYXRpb24uaGFzaCk7CiAgICBpZiAoQzMuUXVlcnlTdHJpbmcuSGFzKCJwZXJmIikpIEMzLmlzUGVyZm9ybWFuY2VQcm9maWxpbmcgPSB0cnVlOwogICAgaWYgKEMzLlF1ZXJ5U3RyaW5nLkdldCgibW9kZSIpICE9PSAiZGV2IikgQzMuU2V0QnVpbGRNb2RlKCJmaW5hbCIpOwoKfQoKLy8gLi4vbGliL2RldGVjdC9kZXRlY3QuanMKewogICAgJ3VzZSBzdHJpY3QnOwogICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgY29uc3QgVU5LTk9XTiA9ICIodW5rbm93bikiOwogICAgQzMuUGxhdGZvcm0gPSB7CiAgICAgICAgT1M6IFVOS05PV04sCiAgICAgICAgT1NWZXJzaW9uOiBVTktOT1dOLAogICAgICAgIEJyb3dzZXI6IFVOS05PV04sCiAgICAgICAgQnJvd3NlclZlcnNpb246IFVOS05PV04sCiAgICAgICAgQnJvd3NlclZlcnNpb25OdW1iZXI6IE5hTiwKICAgICAgICBCcm93c2VyRW5naW5lOiBVTktOT1dOLAogICAgICAgIENvbnRleHQ6ICJicm93c2VyIiwKICAgICAgICBJc0Rlc2t0b3A6IHRydWUsCiAgICAgICAgSXNNb2JpbGU6IGZhbHNlLAogICAgICAgIElzQXBwbGVPUzogZmFsc2UsCiAgICAgICAgSXNJcGFkT1M6IGZhbHNlLAogICAgICAgIEdldERldGFpbGVkSW5mbzogYXN5bmMgKCkgPT4ge30KICAgIH07CiAgICBjb25zdCB3aW5kb3dzTlRWZXJNYXAgPSBuZXcgTWFwKFsKICAgICAgICBbNSwgIjIwMDAiXSwKICAgICAgICBbNS4xLCAiWFAiXSwKICAgICAgICBbNS4yLCAiWFAiXSwKICAgICAgICBbNiwgIlZpc3RhIl0sCiAgICAgICAgWzYuMSwgIjciXSwKICAgICAgICBbNi4yLCAiOCJdLAogICAgICAgIFs2LjMsICI4LjEiXSwKICAgICAgICBbMTAsICIxMCJdCiAgICBdKTsKCiAgICBmdW5jdGlvbiBHZXRXaW5kb3dzTlRWZXJzaW9uTmFtZShudFZlcikgewogICAgICAgIGNvbnN0IG51bSA9IHBhcnNlRmxvYXQobnRWZXIpOwogICAgICAgIGNvbnN0IHJldCA9IHdpbmRvd3NOVFZlck1hcC5nZXQobnVtKTsKICAgICAgICBpZiAocmV0KSByZXR1cm4gcmV0OwogICAgICAgIGlmIChudW0gPj0gMTMpIHJldHVybiAiMTEiOwogICAgICAgIHJldHVybiAiTlQgIiArIG50VmVyCiAgICB9CiAgICBjb25zdCB1YVN0ciA9IG5hdmlnYXRvci51c2VyQWdlbnQ7CiAgICBjb25zdCB1YURhdGEgPSBuYXZpZ2F0b3JbInVzZXJBZ2VudERhdGEiXTsKICAgIGlmICh1YURhdGEgJiYgdWFEYXRhWyJicmFuZHMiXS5sZW5ndGggPiAwKSB7CiAgICAgICAgQzMuUGxhdGZvcm0uT1MgPSB1YURhdGFbInBsYXRmb3JtIl07CiAgICAgICAgQzMuUGxhdGZvcm0uSXNNb2JpbGUgPSB1YURhdGFbIm1vYmlsZSJdOwogICAgICAgIEMzLlBsYXRmb3JtLklzRGVza3RvcCA9ICFDMy5QbGF0Zm9ybS5Jc01vYmlsZTsKICAgICAgICBjb25zdCBSRUNPR05JWkVEX0JST1dTRVJTID0gbmV3IE1hcChbCiAgICAgICAgICAgIFsiR29vZ2xlIENocm9tZSIsICJDaHJvbWUiXSwKICAgICAgICAgICAgWyJNaWNyb3NvZnQgRWRnZSIsICJFZGdlIl0sCiAgICAgICAgICAgIFsiT3BlcmEiLCAiT3BlcmEiXSwKICAgICAgICAgICAgWyJPcGVyYSBHWCIsICJPcGVyYSBHWCJdLAogICAgICAgICAgICBbIk1vemlsbGEgRmlyZWZveCIsICJGaXJlZm94Il0sCiAgICAgICAgICAgIFsiQXBwbGUgU2FmYXJpIiwgIlNhZmFyaSJdLAogICAgICAgICAgICBbIk5XLmpzIiwgIk5XLmpzIl0KICAgICAgICBdKTsKICAgICAgICBjb25zdCBSRUNPR05JWkVEX0VOR0lORVMgPSBuZXcgTWFwKFsKICAgICAgICAgICAgWyJDaHJvbWl1bSIsICJDaHJvbWl1bSJdLAogICAgICAgICAgICBbIkdlY2tvIiwgIkdlY2tvIl0sCiAgICAgICAgICAgIFsiV2ViS2l0IiwgIldlYktpdCJdCiAgICAgICAgXSk7CgogICAgICAgIGZ1bmN0aW9uIFJlYWRCcmFuZExpc3QoYnJhbmRzKSB7CiAgICAgICAgICAgIGxldCBicm93c2VyID0KICAgICAgICAgICAgICAgICIiOwogICAgICAgICAgICBsZXQgYnJvd3Nlcl92ZXJzaW9uID0gIiI7CiAgICAgICAgICAgIGxldCBlbmdpbmUgPSAiIjsKICAgICAgICAgICAgbGV0IGVuZ2luZV92ZXJzaW9uID0gIiI7CiAgICAgICAgICAgIGZvciAoY29uc3QgbyBvZiBicmFuZHMpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHJlY29nbml6ZWRCcm93c2VyID0gUkVDT0dOSVpFRF9CUk9XU0VSUy5nZXQob1siYnJhbmQiXSk7CiAgICAgICAgICAgICAgICBpZiAoIWJyb3dzZXIgJiYgcmVjb2duaXplZEJyb3dzZXIpIHsKICAgICAgICAgICAgICAgICAgICBicm93c2VyID0gcmVjb2duaXplZEJyb3dzZXI7CiAgICAgICAgICAgICAgICAgICAgYnJvd3Nlcl92ZXJzaW9uID0gb1sidmVyc2lvbiJdCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjb25zdCByZWNvZ25pemVkRW5naW5lID0gUkVDT0dOSVpFRF9FTkdJTkVTLmdldChvWyJicmFuZCJdKTsKICAgICAgICAgICAgICAgIGlmICghZW5naW5lICYmIHJlY29nbml6ZWRFbmdpbmUpIHsKICAgICAgICAgICAgICAgICAgICBlbmdpbmUgPSByZWNvZ25pemVkRW5naW5lOwogICAgICAgICAgICAgICAgICAgIGVuZ2luZV92ZXJzaW9uID0gb1sidmVyc2lvbiJdCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCFicm93c2VyICYmIGVuZ2luZSA9PT0gIkNocm9taXVtIikgewogICAgICAgICAgICAgICAgQzMuUGxhdGZvcm0uQnJvd3NlciA9ICJDaHJvbWl1bSI7CiAgICAgICAgICAgICAgICBDMy5QbGF0Zm9ybS5Ccm93c2VyVmVyc2lvbiA9IGVuZ2luZV92ZXJzaW9uCiAgICAgICAgICAgIH0KICAgICAgICAgICAgQzMuUGxhdGZvcm0uQnJvd3NlciA9IGJyb3dzZXIgfHwKICAgICAgICAgICAgICAgIFVOS05PV047CiAgICAgICAgICAgIEMzLlBsYXRmb3JtLkJyb3dzZXJWZXJzaW9uID0gYnJvd3Nlcl92ZXJzaW9uIHx8IFVOS05PV047CiAgICAgICAgICAgIEMzLlBsYXRmb3JtLkJyb3dzZXJFbmdpbmUgPSBlbmdpbmUgfHwgVU5LTk9XTgogICAgICAgIH0KICAgICAgICBSZWFkQnJhbmRMaXN0KHVhRGF0YVsiYnJhbmRzIl0pOwogICAgICAgIGxldCBkaWRHZXREZXRhaWxlZEluZm8gPSBmYWxzZTsKICAgICAgICBDMy5QbGF0Zm9ybS5HZXREZXRhaWxlZEluZm8gPSBhc3luYyAoKSA9PiB7CiAgICAgICAgICAgIGlmIChkaWRHZXREZXRhaWxlZEluZm8pIHJldHVybjsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGNvbnN0IGRldGFpbHMgPSBhd2FpdCBuYXZpZ2F0b3JbInVzZXJBZ2VudERhdGEiXVsiZ2V0SGlnaEVudHJvcHlWYWx1ZXMiXShbInBsYXRmb3JtVmVyc2lvbiIsICJmdWxsVmVyc2lvbkxpc3QiXSk7CiAgICAgICAgICAgICAgICBSZWFkQnJhbmRMaXN0KGRldGFpbHNbImZ1bGxWZXJzaW9uTGlzdCJdKTsKICAgICAgICAgICAgICAgIGlmIChDMy5QbGF0Zm9ybS5PUyA9PT0gIldpbmRvd3MiKSBDMy5QbGF0Zm9ybS5PU1ZlcnNpb24gPSBHZXRXaW5kb3dzTlRWZXJzaW9uTmFtZShkZXRhaWxzWyJwbGF0Zm9ybVZlcnNpb24iXSk7CiAgICAgICAgICAgICAgICBlbHNlIEMzLlBsYXRmb3JtLk9TVmVyc2lvbiA9CiAgICAgICAgICAgICAgICAgICAgZGV0YWlsc1sicGxhdGZvcm1WZXJzaW9uIl07CiAgICAgICAgICAgICAgICBkaWRHZXREZXRhaWxlZEluZm8gPSB0cnVlCiAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCJGYWlsZWQgdG8gZ2V0IGRldGFpbGVkIHVzZXIgYWdlbnQgaW5mb3JtYXRpb246ICIsIGVycikKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgICAgZnVuY3Rpb24gUnVuVGVzdChyZWdleF9vcl9hcnIsIGhhbmRsZXIpIHsKICAgICAgICAgICAgY29uc3QgYXJyID0gQXJyYXkuaXNBcnJheShyZWdleF9vcl9hcnIpID8gcmVnZXhfb3JfYXJyIDogW3JlZ2V4X29yX2Fycl07CiAgICAgICAgICAgIGZvciAoY29uc3QgcmVnZXggb2YgYXJyKSB7CiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSByZWdleC5leGVjKHVhU3RyKTsKICAgICAgICAgICAgICAgIGlmIChyZXN1bHQpIHsKICAgICAgICAgICAgICAgICAgICBoYW5kbGVyKHJlc3VsdCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBSdW5UZXN0KC93aW5kb3dzXHMrbnRccysoW1xkXC5dKykvaSwgcmVzdWx0ID0+IHsKICAgICAgICAgICAgQzMuUGxhdGZvcm0uT1MgPSAiV2luZG93cyI7CiAgICAgICAgICAgIGNvbnN0IG50VmVyID0gcmVzdWx0WzFdOwogICAgICAgICAgICBDMy5QbGF0Zm9ybS5PU1ZlcnNpb24gPSBHZXRXaW5kb3dzTlRWZXJzaW9uTmFtZShudFZlcikKICAgICAgICB9KTsKICAgICAgICBSdW5UZXN0KC9tYWNccytvc1xzK3hccysoW1xkXC5fXSspL2ksCiAgICAgICAgICAgIHJlc3VsdCA9PiB7CiAgICAgICAgICAgICAgICBDMy5QbGF0Zm9ybS5PUyA9ICJtYWNPUyI7CiAgICAgICAgICAgICAgICBDMy5QbGF0Zm9ybS5PU1ZlcnNpb24gPSByZXN1bHRbMV0ucmVwbGFjZSgvXy9nLCAiLiIpCiAgICAgICAgICAgIH0pOwogICAgICAgIFJ1blRlc3QoL0NyT1MvLCAoKSA9PiB7CiAgICAgICAgICAgIEMzLlBsYXRmb3JtLk9TID0gIkNocm9tZSBPUyIKICAgICAgICB9KTsKICAgICAgICBSdW5UZXN0KC9saW51eHxvcGVuYnNkfGZyZWVic2R8bmV0YnNkL2ksICgpID0+IHsKICAgICAgICAgICAgQzMuUGxhdGZvcm0uT1MgPSAiTGludXgiCiAgICAgICAgfSk7CiAgICAgICAgUnVuVGVzdCgvYW5kcm9pZC9pLCAoKSA9PiB7CiAgICAgICAgICAgIEMzLlBsYXRmb3JtLk9TID0gIkFuZHJvaWQiCiAgICAgICAgfSk7CiAgICAgICAgUnVuVGVzdCgvYW5kcm9pZFxzKyhbXGRcLl0rKS9pLCByZXN1bHQgPT4gewogICAgICAgICAgICBDMy5QbGF0Zm9ybS5PUyA9ICJBbmRyb2lkIjsKICAgICAgICAgICAgQzMuUGxhdGZvcm0uT1NWZXJzaW9uID0gcmVzdWx0WzFdCiAgICAgICAgfSk7CiAgICAgICAgaWYgKEMzLlBsYXRmb3JtLk9TID09PSBVTktOT1dOKSB7CiAgICAgICAgICAgIFJ1blRlc3QoLyhpcGhvbmV8aXBvZHxpcGFkKS9pLCByZXN1bHQgPT4gewogICAgICAgICAgICAgICAgQzMuUGxhdGZvcm0uT1MgPSAiaU9TIgogICAgICAgICAgICB9KTsKICAgICAgICAgICAgUnVuVGVzdChbL2lwaG9uZVxzK29zXHMrKFtcZFwuX10rKS9pLCAvaXBhZFteKV0qb3NccysoW1xkXC5fXSspL2ldLAogICAgICAgICAgICAgICAgcmVzdWx0ID0+IHsKICAgICAgICAgICAgICAgICAgICBDMy5QbGF0Zm9ybS5PUyA9ICJpT1MiOwogICAgICAgICAgICAgICAgICAgIEMzLlBsYXRmb3JtLk9TVmVyc2lvbiA9IHJlc3VsdFsxXS5yZXBsYWNlKC9fL2csICIuIikKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgfQogICAgICAgIGNvbnN0IGhhc0Nocm9tZSA9IC9jaHJvbWVcLy9pLnRlc3QodWFTdHIpOwogICAgICAgIGNvbnN0IGhhc0Nocm9taXVtID0gL2Nocm9taXVtXC8vaS50ZXN0KHVhU3RyKTsKICAgICAgICBjb25zdCBoYXNFZGdlID0gL2VkZ1wvL2kudGVzdCh1YVN0cik7CiAgICAgICAgY29uc3QgaGFzT3BlcmEgPSAvT1BSXC8vLnRlc3QodWFTdHIpOwogICAgICAgIGNvbnN0IGhhc05XanMgPSAvbndqcy9pLnRlc3QodWFTdHIpOwogICAgICAgIGNvbnN0IGhhc1NhZmFyaSA9IC9zYWZhcmlcLy9pLnRlc3QodWFTdHIpOwogICAgICAgIGNvbnN0IGhhc1dlYktpdCA9IC93ZWJraXQvaS50ZXN0KHVhU3RyKTsKICAgICAgICBpZiAoIWhhc0VkZ2UgJiYgIWhhc09wZXJhKSBSdW5UZXN0KC9jaHJvbWVcLyhbXGRcLl0rKS9pLCByZXN1bHQgPT4gewogICAgICAgICAgICBDMy5QbGF0Zm9ybS5Ccm93c2VyID0gIkNocm9tZSI7CiAgICAgICAgICAgIEMzLlBsYXRmb3JtLkJyb3dzZXJWZXJzaW9uID0gcmVzdWx0WzFdOwogICAgICAgICAgICBDMy5QbGF0Zm9ybS5Ccm93c2VyRW5naW5lID0KICAgICAgICAgICAgICAgICJDaHJvbWl1bSIKICAgICAgICB9KTsKICAgICAgICBSdW5UZXN0KC9lZGdcLyhbXGRcLl0rKS9pLCByZXN1bHQgPT4gewogICAgICAgICAgICBDMy5QbGF0Zm9ybS5Ccm93c2VyID0gIkVkZ2UiOwogICAgICAgICAgICBDMy5QbGF0Zm9ybS5Ccm93c2VyVmVyc2lvbiA9IHJlc3VsdFsxXTsKICAgICAgICAgICAgQzMuUGxhdGZvcm0uQnJvd3NlckVuZ2luZSA9ICJDaHJvbWl1bSIKICAgICAgICB9KTsKICAgICAgICBSdW5UZXN0KC9PUFJcLyhbXGRcLl0rKS8sIHJlc3VsdCA9PiB7CiAgICAgICAgICAgIEMzLlBsYXRmb3JtLkJyb3dzZXIgPSAiT3BlcmEiOwogICAgICAgICAgICBDMy5QbGF0Zm9ybS5Ccm93c2VyVmVyc2lvbiA9IHJlc3VsdFsxXTsKICAgICAgICAgICAgQzMuUGxhdGZvcm0uQnJvd3NlckVuZ2luZSA9ICJDaHJvbWl1bSIKICAgICAgICB9KTsKICAgICAgICBSdW5UZXN0KC9jaHJvbWl1bVwvKFtcZFwuXSspL2ksIHJlc3VsdCA9PiB7CiAgICAgICAgICAgIEMzLlBsYXRmb3JtLkJyb3dzZXIgPSAiQ2hyb21pdW0iOwogICAgICAgICAgICBDMy5QbGF0Zm9ybS5Ccm93c2VyVmVyc2lvbiA9IHJlc3VsdFsxXTsKICAgICAgICAgICAgQzMuUGxhdGZvcm0uQnJvd3NlckVuZ2luZSA9ICJDaHJvbWl1bSIKICAgICAgICB9KTsKICAgICAgICBSdW5UZXN0KC9ud2pzXC9bMC05Ll0rL2ksIHJlc3VsdCA9PiB7CiAgICAgICAgICAgIEMzLlBsYXRmb3JtLkJyb3dzZXIgPSAiTlcuanMiOwogICAgICAgICAgICBDMy5QbGF0Zm9ybS5Ccm93c2VyVmVyc2lvbiA9CiAgICAgICAgICAgICAgICByZXN1bHRbMV07CiAgICAgICAgICAgIEMzLlBsYXRmb3JtLkJyb3dzZXJFbmdpbmUgPSAiQ2hyb21pdW0iOwogICAgICAgICAgICBDMy5QbGF0Zm9ybS5Db250ZXh0ID0gIm53anMiCiAgICAgICAgfSk7CiAgICAgICAgUnVuVGVzdCgvZmlyZWZveFwvKFtcZFwuXSspL2ksIHJlc3VsdCA9PiB7CiAgICAgICAgICAgIEMzLlBsYXRmb3JtLkJyb3dzZXIgPSAiRmlyZWZveCI7CiAgICAgICAgICAgIEMzLlBsYXRmb3JtLkJyb3dzZXJWZXJzaW9uID0gcmVzdWx0WzFdOwogICAgICAgICAgICBDMy5QbGF0Zm9ybS5Ccm93c2VyRW5naW5lID0gIkdlY2tvIgogICAgICAgIH0pOwogICAgICAgIGlmIChoYXNTYWZhcmkgJiYgIWhhc0Nocm9tZSAmJiAhaGFzQ2hyb21pdW0gJiYgIWhhc0VkZ2UgJiYgIWhhc09wZXJhICYmICFoYXNOV2pzKSB7CiAgICAgICAgICAgIEMzLlBsYXRmb3JtLkJyb3dzZXIgPSAiU2FmYXJpIjsKICAgICAgICAgICAgQzMuUGxhdGZvcm0uQnJvd3NlckVuZ2luZSA9ICJXZWJLaXQiOwogICAgICAgICAgICBSdW5UZXN0KC92ZXJzaW9uXC8oW1xkXC5dKykvaSwgcmVzdWx0ID0+IHsKICAgICAgICAgICAgICAgIEMzLlBsYXRmb3JtLkJyb3dzZXJWZXJzaW9uID0gcmVzdWx0WzFdCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBSdW5UZXN0KC9jcmlvc1wvKFtcZFwuXSspL2ksIHJlc3VsdCA9PiB7CiAgICAgICAgICAgICAgICBDMy5QbGF0Zm9ybS5Ccm93c2VyID0gIkNocm9tZSBmb3IgaU9TIjsKICAgICAgICAgICAgICAgIEMzLlBsYXRmb3JtLkJyb3dzZXJWZXJzaW9uID0gcmVzdWx0WzFdCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBSdW5UZXN0KC9meGlvc1wvKFtcZFwuXSspL2ksIHJlc3VsdCA9PiB7CiAgICAgICAgICAgICAgICBDMy5QbGF0Zm9ybS5Ccm93c2VyID0gIkZpcmVmb3ggZm9yIGlPUyI7CiAgICAgICAgICAgICAgICBDMy5QbGF0Zm9ybS5Ccm93c2VyVmVyc2lvbiA9IHJlc3VsdFsxXQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgUnVuVGVzdCgvZWRnaW9zXC8oW1xkXC5dKykvaSwgcmVzdWx0ID0+IHsKICAgICAgICAgICAgICAgIEMzLlBsYXRmb3JtLkJyb3dzZXIgPSAiRWRnZSBmb3IgaU9TIjsKICAgICAgICAgICAgICAgIEMzLlBsYXRmb3JtLkJyb3dzZXJWZXJzaW9uID0gcmVzdWx0WzFdCiAgICAgICAgICAgIH0pCiAgICAgICAgfQogICAgICAgIGlmIChDMy5QbGF0Zm9ybS5Ccm93c2VyRW5naW5lID09PSBVTktOT1dOICYmIGhhc1dlYktpdCkgQzMuUGxhdGZvcm0uQnJvd3NlckVuZ2luZSA9ICJXZWJLaXQiOwogICAgICAgIGlmIChDMy5QbGF0Zm9ybS5PUyA9PT0gIkFuZHJvaWQiICYmIEMzLlBsYXRmb3JtLkJyb3dzZXIgPT09ICJTYWZhcmkiKSBDMy5QbGF0Zm9ybS5Ccm93c2VyID0gIlN0b2NrIjsKICAgICAgICBjb25zdCBkZXNrdG9wT1NzID0gbmV3IFNldChbIldpbmRvd3MiLCAibWFjT1MiLCAiTGludXgiLCAiQ2hyb21lIE9TIl0pOwogICAgICAgIGNvbnN0IGlzRGVza3RvcCA9IGRlc2t0b3BPU3MuaGFzKEMzLlBsYXRmb3JtLk9TKSB8fCBDMy5QbGF0Zm9ybS5Db250ZXh0ID09PSAibndqcyI7CiAgICAgICAgQzMuUGxhdGZvcm0uSXNEZXNrdG9wID0gaXNEZXNrdG9wOwogICAgICAgIEMzLlBsYXRmb3JtLklzTW9iaWxlID0gIWlzRGVza3RvcAogICAgfQogICAgaWYgKEMzLlBsYXRmb3JtLkJyb3dzZXIgPT09ICJDaHJvbWUiICYmIEMzLlBsYXRmb3JtLkNvbnRleHQgPT09ICJicm93c2VyIiAmJiAvd3ZcKS8udGVzdCh1YVN0cikpIEMzLlBsYXRmb3JtLkNvbnRleHQgPSAid2VidmlldyI7CiAgICBpZiAoQzMuUGxhdGZvcm0uQ29udGV4dCAhPT0gIm53anMiICYmIHR5cGVvZiB3aW5kb3cgIT09ICJ1bmRlZmluZWQiICYmICh3aW5kb3cubWF0Y2hNZWRpYSAmJiB3aW5kb3cubWF0Y2hNZWRpYSgiKGRpc3BsYXktbW9kZTogc3RhbmRhbG9uZSkiKS5tYXRjaGVzIHx8IG5hdmlnYXRvclsic3RhbmRhbG9uZSJdKSkgQzMuUGxhdGZvcm0uQ29udGV4dCA9ICJ3ZWJhcHAiOwogICAgQzMuUGxhdGZvcm0uQnJvd3NlclZlcnNpb25OdW1iZXIgPSBwYXJzZUZsb2F0KEMzLlBsYXRmb3JtLkJyb3dzZXJWZXJzaW9uKTsKICAgIGNvbnN0IGxvb2tzTGlrZUlQYWRPUyA9IEMzLlBsYXRmb3JtLk9TID09PSAibWFjT1MiICYmIG5hdmlnYXRvclsibWF4VG91Y2hQb2ludHMiXSAmJiBuYXZpZ2F0b3JbIm1heFRvdWNoUG9pbnRzIl0gPiAyOwogICAgaWYgKGxvb2tzTGlrZUlQYWRPUykgewogICAgICAgIEMzLlBsYXRmb3JtLk9TID0gImlPUyI7CiAgICAgICAgQzMuUGxhdGZvcm0uT1NWZXJzaW9uID0gQzMuUGxhdGZvcm0uQnJvd3NlclZlcnNpb247CiAgICAgICAgQzMuUGxhdGZvcm0uSXNEZXNrdG9wID0gZmFsc2U7CiAgICAgICAgQzMuUGxhdGZvcm0uSXNNb2JpbGUgPSB0cnVlOwogICAgICAgIEMzLlBsYXRmb3JtLklzSXBhZE9TID0gdHJ1ZQogICAgfQogICAgQzMuUGxhdGZvcm0uSXNBcHBsZU9TID0gQzMuUGxhdGZvcm0uT1MgPT09ICJtYWNPUyIgfHwgQzMuUGxhdGZvcm0uT1MgPT09ICJpT1MiOwoKfQoKLy8gLi4vbGliL3N0b3JhZ2Uva3ZTdG9yYWdlLmpzCnsKICAgICd1c2Ugc3RyaWN0JzsgewogICAgICAgIGNvbnN0IFZFUlNJT04gPSAyOwogICAgICAgIGNvbnN0IFNUT1JFX05BTUUgPSAia2V5dmFsdWVwYWlycyI7CiAgICAgICAgY29uc3QgREFUQUJBU0VfUFJPTUlTRV9NQVAgPSBuZXcgTWFwOwogICAgICAgIGNvbnN0IFNVUFBPUlRTX0dFVEFMTCA9IHR5cGVvZiBJREJPYmplY3RTdG9yZSAhPT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mIElEQk9iamVjdFN0b3JlLnByb3RvdHlwZS5nZXRBbGwgPT09ICJmdW5jdGlvbiI7CiAgICAgICAgY29uc3QgU1VQUE9SVFNfR0VUQUxMS0VZUyA9IHR5cGVvZiBJREJPYmplY3RTdG9yZSAhPT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mIElEQk9iamVjdFN0b3JlLnByb3RvdHlwZS5nZXRBbGxLZXlzID09PSAiZnVuY3Rpb24iOwoKICAgICAgICBmdW5jdGlvbiBhc3luY2lmeVJlcXVlc3QocmVxdWVzdCkgewogICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlcywgcmVqKSA9PiB7CiAgICAgICAgICAgICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9ICgpID0+IHJlcyhyZXF1ZXN0LnJlc3VsdCk7CiAgICAgICAgICAgICAgICByZXF1ZXN0Lm9uZXJyb3IgPSAoKSA9PiByZWoocmVxdWVzdC5lcnJvcikKICAgICAgICAgICAgfSkKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGFzeW5jaWZ5VHJhbnNhY3Rpb24odHgpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXMsCiAgICAgICAgICAgICAgICByZWopID0+IHsKICAgICAgICAgICAgICAgIHR4Lm9uY29tcGxldGUgPSAoKSA9PiByZXMoKTsKICAgICAgICAgICAgICAgIHR4Lm9uZXJyb3IgPSAoKSA9PiByZWoodHguZXJyb3IpOwogICAgICAgICAgICAgICAgdHgub25hYm9ydCA9ICgpID0+IHJlaih0eC5lcnJvcikKICAgICAgICAgICAgfSkKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIG9wZW5SZWFkT25seVRyYW5zYWN0aW9uKG5hbWUsIG1ldGhvZCkgewogICAgICAgICAgICByZXR1cm4gb3BlblRyYW5zYWN0aW9uKG5hbWUsIG1ldGhvZCkKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIG9wZW5Xcml0ZVRyYW5zYWN0aW9uKG5hbWUsIG1ldGhvZCkgewogICAgICAgICAgICByZXR1cm4gb3BlblRyYW5zYWN0aW9uKG5hbWUsIG1ldGhvZCwgdHJ1ZSkKICAgICAgICB9CiAgICAgICAgYXN5bmMgZnVuY3Rpb24gb3BlblRyYW5zYWN0aW9uKG5hbWUsIG1ldGhvZCwgd3JpdGUgPSBmYWxzZSwgYWxsb3dSZXRyeSA9IHRydWUpIHsKICAgICAgICAgICAgY29uc3QgZGIgPSBhd2FpdCBsYXp5T3BlbkRhdGFiYXNlKG5hbWUpOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgY29uc3QgdHggPSBkYi50cmFuc2FjdGlvbihbU1RPUkVfTkFNRV0sIHdyaXRlID8gInJlYWR3cml0ZSIgOiAicmVhZG9ubHkiKTsKICAgICAgICAgICAgICAgIHJldHVybiBtZXRob2QodHgpCiAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgaWYgKGFsbG93UmV0cnkgJiYgZXJyWyJuYW1lIl0gPT09ICJJbnZhbGlkU3RhdGVFcnJvciIpIHsKICAgICAgICAgICAgICAgICAgICBEQVRBQkFTRV9QUk9NSVNFX01BUC5kZWxldGUobmFtZSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9wZW5UcmFuc2FjdGlvbihuYW1lLCBtZXRob2QsIHdyaXRlLCBmYWxzZSkKICAgICAgICAgICAgICAgIH0gZWxzZSB0aHJvdyBlcnI7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGxhenlPcGVuRGF0YWJhc2UobmFtZSkgewogICAgICAgICAgICBSZXF1aXJlU3RyaW5nKG5hbWUpOwogICAgICAgICAgICBsZXQgZGJQcm9taXNlID0gREFUQUJBU0VfUFJPTUlTRV9NQVAuZ2V0KG5hbWUpOwogICAgICAgICAgICBpZiAoIShkYlByb21pc2UgaW5zdGFuY2VvZiBQcm9taXNlKSkgewogICAgICAgICAgICAgICAgZGJQcm9taXNlID0gb3BlbkRhdGFiYXNlKG5hbWUpOwogICAgICAgICAgICAgICAgREFUQUJBU0VfUFJPTUlTRV9NQVAuc2V0KG5hbWUsIGRiUHJvbWlzZSk7CiAgICAgICAgICAgICAgICBkYlByb21pc2UuY2F0Y2goZXJyID0+IERBVEFCQVNFX1BST01JU0VfTUFQLmRlbGV0ZShuYW1lKSkKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZGJQcm9taXNlCiAgICAgICAgfQogICAgICAgIGFzeW5jIGZ1bmN0aW9uIG9wZW5EYXRhYmFzZShuYW1lKSB7CiAgICAgICAgICAgIFJlcXVpcmVTdHJpbmcobmFtZSk7CiAgICAgICAgICAgIGNvbnN0IG9wZW5SZXF1ZXN0ID0gaW5kZXhlZERCLm9wZW4obmFtZSwgVkVSU0lPTik7CiAgICAgICAgICAgIG9wZW5SZXF1ZXN0LmFkZEV2ZW50TGlzdGVuZXIoInVwZ3JhZGVuZWVkZWQiLCBlID0+IHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGIgPQogICAgICAgICAgICAgICAgICAgICAgICBlLnRhcmdldC5yZXN1bHQ7CiAgICAgICAgICAgICAgICAgICAgZGIuY3JlYXRlT2JqZWN0U3RvcmUoU1RPUkVfTkFNRSkKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEZhaWxlZCB0byBjcmVhdGUgb2JqZWN0c3RvcmUgZm9yIGRhdGFiYXNlICR7bmFtZX1gLCBlcnIpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXR1cm4gYXN5bmNpZnlSZXF1ZXN0KG9wZW5SZXF1ZXN0KQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gUmVxdWlyZVN0cmluZyh4KSB7CiAgICAgICAgICAgIGlmICh0eXBlb2YgeCAhPT0gInN0cmluZyIpIHRocm93IG5ldyBUeXBlRXJyb3IoImV4cGVjdGVkIHN0cmluZyIpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZ2V0RW50cmllc0Zyb21DdXJzb3IodHgsIHR5cGUpIHsKICAgICAgICAgICAgY29uc3QgcmVxdWVzdCA9IHR4Lm9iamVjdFN0b3JlKFNUT1JFX05BTUUpLm9wZW5DdXJzb3IoKTsKICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4gewogICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0cyA9IFtdOwogICAgICAgICAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBldmVudCA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgY3Vyc29yID0gZXZlbnQudGFyZ2V0LnJlc3VsdDsKICAgICAgICAgICAgICAgICAgICBpZiAoY3Vyc29yKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAodHlwZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiZW50cmllcyI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0cy5wdXNoKFtjdXJzb3Iua2V5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJzb3IudmFsdWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImtleXMiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdHMucHVzaChjdXJzb3Iua2V5KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInZhbHVlcyI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0cy5wdXNoKGN1cnNvci52YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBjdXJzb3IuY29udGludWUoKQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSByZXNvbHZlKHJlc3VsdHMpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgfQogICAgICAgIGNsYXNzIEtWU3RvcmFnZUNvbnRhaW5lciB7CiAgICAgICAgICAgIGNvbnN0cnVjdG9yKG5hbWUpIHsKICAgICAgICAgICAgICAgIFJlcXVpcmVTdHJpbmcobmFtZSk7CiAgICAgICAgICAgICAgICB0aGlzLm5hbWUgPSBuYW1lCiAgICAgICAgICAgIH0KICAgICAgICAgICAgYXN5bmMgcmVhZHkoKSB7CiAgICAgICAgICAgICAgICBhd2FpdCBsYXp5T3BlbkRhdGFiYXNlKHRoaXMubmFtZSkKICAgICAgICAgICAgfQogICAgICAgICAgICBzZXQoa2V5LCB2YWx1ZSkgewogICAgICAgICAgICAgICAgUmVxdWlyZVN0cmluZyhrZXkpOwogICAgICAgICAgICAgICAgcmV0dXJuIG9wZW5Xcml0ZVRyYW5zYWN0aW9uKHRoaXMubmFtZSwgYXN5bmMgdHggPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlcXVlc3QgPSB0eC5vYmplY3RTdG9yZShTVE9SRV9OQU1FKS5wdXQodmFsdWUsIGtleSk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVxdWVzdFByb21pc2UgPSBhc3luY2lmeVJlcXVlc3QocmVxdWVzdCk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdHhQcm9taXNlID0gYXN5bmNpZnlUcmFuc2FjdGlvbih0eCk7CiAgICAgICAgICAgICAgICAgICAgYXdhaXQgUHJvbWlzZS5hbGwoW3R4UHJvbWlzZSwgcmVxdWVzdFByb21pc2VdKQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfQogICAgICAgICAgICBnZXQoa2V5KSB7CiAgICAgICAgICAgICAgICBSZXF1aXJlU3RyaW5nKGtleSk7CiAgICAgICAgICAgICAgICByZXR1cm4gb3BlblJlYWRPbmx5VHJhbnNhY3Rpb24odGhpcy5uYW1lLCBhc3luYyB0eCA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVxdWVzdCA9IHR4Lm9iamVjdFN0b3JlKFNUT1JFX05BTUUpLmdldChrZXkpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlcXVlc3RQcm9taXNlID0gYXN5bmNpZnlSZXF1ZXN0KHJlcXVlc3QpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHR4UHJvbWlzZSA9IGFzeW5jaWZ5VHJhbnNhY3Rpb24odHgpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IFtfLCB2YWx1ZV0gPSBhd2FpdCBQcm9taXNlLmFsbChbdHhQcm9taXNlLCByZXF1ZXN0UHJvbWlzZV0pOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfQogICAgICAgICAgICBkZWxldGUoa2V5KSB7CiAgICAgICAgICAgICAgICBSZXF1aXJlU3RyaW5nKGtleSk7CiAgICAgICAgICAgICAgICByZXR1cm4gb3BlbldyaXRlVHJhbnNhY3Rpb24odGhpcy5uYW1lLCBhc3luYyB0eCA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVxdWVzdCA9IHR4Lm9iamVjdFN0b3JlKFNUT1JFX05BTUUpLmRlbGV0ZShrZXkpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlcXVlc3RQcm9taXNlID0gYXN5bmNpZnlSZXF1ZXN0KHJlcXVlc3QpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHR4UHJvbWlzZSA9IGFzeW5jaWZ5VHJhbnNhY3Rpb24odHgpOwogICAgICAgICAgICAgICAgICAgIGF3YWl0IFByb21pc2UuYWxsKFt0eFByb21pc2UsIHJlcXVlc3RQcm9taXNlXSkKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2xlYXIoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gb3BlbldyaXRlVHJhbnNhY3Rpb24odGhpcy5uYW1lLCBhc3luYyB0eCA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVxdWVzdCA9IHR4Lm9iamVjdFN0b3JlKFNUT1JFX05BTUUpLmNsZWFyKCk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVxdWVzdFByb21pc2UgPSBhc3luY2lmeVJlcXVlc3QocmVxdWVzdCk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdHhQcm9taXNlID0gYXN5bmNpZnlUcmFuc2FjdGlvbih0eCk7CiAgICAgICAgICAgICAgICAgICAgYXdhaXQgUHJvbWlzZS5hbGwoW3R4UHJvbWlzZSwgcmVxdWVzdFByb21pc2VdKQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfQogICAgICAgICAgICBrZXlzKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIG9wZW5SZWFkT25seVRyYW5zYWN0aW9uKHRoaXMubmFtZSwgYXN5bmMgdHggPT4gewogICAgICAgICAgICAgICAgICAgIGxldCByZXF1ZXN0UHJvbWlzZTsKICAgICAgICAgICAgICAgICAgICBpZiAoU1VQUE9SVFNfR0VUQUxMS0VZUykgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByZXF1ZXN0ID0gdHgub2JqZWN0U3RvcmUoU1RPUkVfTkFNRSkuZ2V0QWxsS2V5cygpOwogICAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0UHJvbWlzZSA9IGFzeW5jaWZ5UmVxdWVzdChyZXF1ZXN0KQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSByZXF1ZXN0UHJvbWlzZSA9CiAgICAgICAgICAgICAgICAgICAgICAgIGdldEVudHJpZXNGcm9tQ3Vyc29yKHR4LCAia2V5cyIpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHR4UHJvbWlzZSA9IGFzeW5jaWZ5VHJhbnNhY3Rpb24odHgpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IFtfLCB2YWx1ZV0gPSBhd2FpdCBQcm9taXNlLmFsbChbdHhQcm9taXNlLCByZXF1ZXN0UHJvbWlzZV0pOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfQogICAgICAgICAgICB2YWx1ZXMoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gb3BlblJlYWRPbmx5VHJhbnNhY3Rpb24odGhpcy5uYW1lLCBhc3luYyB0eCA9PiB7CiAgICAgICAgICAgICAgICAgICAgbGV0IHJlcXVlc3RQcm9taXNlOwogICAgICAgICAgICAgICAgICAgIGlmIChTVVBQT1JUU19HRVRBTEwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVxdWVzdCA9IHR4Lm9iamVjdFN0b3JlKFNUT1JFX05BTUUpLmdldEFsbCgpOwogICAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0UHJvbWlzZSA9IGFzeW5jaWZ5UmVxdWVzdChyZXF1ZXN0KQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSByZXF1ZXN0UHJvbWlzZSA9IGdldEVudHJpZXNGcm9tQ3Vyc29yKHR4LCAidmFsdWVzIik7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdHhQcm9taXNlID0gYXN5bmNpZnlUcmFuc2FjdGlvbih0eCk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgW18sIHZhbHVlXSA9IGF3YWl0IFByb21pc2UuYWxsKFt0eFByb21pc2UsIHJlcXVlc3RQcm9taXNlXSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVudHJpZXMoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gb3BlblJlYWRPbmx5VHJhbnNhY3Rpb24odGhpcy5uYW1lLAogICAgICAgICAgICAgICAgICAgIGFzeW5jIHR4ID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVxdWVzdFByb21pc2UgPSBnZXRFbnRyaWVzRnJvbUN1cnNvcih0eCwgImVudHJpZXMiKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdHhQcm9taXNlID0gYXN5bmNpZnlUcmFuc2FjdGlvbih0eCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IFtfLCB2YWx1ZV0gPSBhd2FpdCBQcm9taXNlLmFsbChbdHhQcm9taXNlLCByZXF1ZXN0UHJvbWlzZV0pOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWUKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHNlbGYuS1ZTdG9yYWdlQ29udGFpbmVyID0gS1ZTdG9yYWdlQ29udGFpbmVyCiAgICB9OwoKfQoKLy8gLi4vbGliL3N0b3JhZ2UvbG9jYWxGb3JhZ2VBZGFwdG9yLmpzCnsKICAgICd1c2Ugc3RyaWN0JzsgewogICAgICAgIGNvbnN0IEtWU3RvcmFnZUNvbnRhaW5lciA9IHNlbGYuS1ZTdG9yYWdlQ29udGFpbmVyOwogICAgICAgIGNvbnN0IENSSVRJQ0FMX0VSUk9SUyA9IFsvbm8gYXZhaWxhYmxlIHN0b3JhZ2UgbWV0aG9kIGZvdW5kL2ksIC9hbiBhdHRlbXB0IHdhcyBtYWRlIHRvIGJyZWFrIHRocm91Z2ggdGhlIHNlY3VyaXR5IHBvbGljeSBvZiB0aGUgdXNlciBhZ2VudC9pLCAvdGhlIHVzZXIgZGVuaWVkIHBlcm1pc3Npb24gdG8gYWNjZXNzIHRoZSBkYXRhYmFzZS9pLCAvYSBtdXRhdGlvbiBvcGVyYXRpb24gd2FzIGF0dGVtcHRlZCBvbiBhIGRhdGFiYXNlIHRoYXQgZGlkIG5vdCBhbGxvdyBtdXRhdGlvbnMvaSwgL2lkYmZhY3RvcnlcLm9wZW5cKFwpIGNhbGxlZCBpbiBhbiBpbnZhbGlkIHNlY3VyaXR5IGNvbnRleHQvaV07CiAgICAgICAgY29uc3QgbWVtb3J5U3RvcmFnZSA9IG5ldyBXZWFrTWFwOwogICAgICAgIGxldCBpc0luTWVtb3J5ID0gZmFsc2U7CiAgICAgICAgaWYgKHR5cGVvZiBpbmRleGVkREIgPT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICAgIGlzSW5NZW1vcnkgPSB0cnVlOwogICAgICAgICAgICBjb25zb2xlLndhcm4oIlVuYWJsZSB0byB1c2UgbG9jYWwgc3RvcmFnZSBiZWNhdXNlIGluZGV4ZWREQiBpcyBub3QgZGVmaW5lZCIpCiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBOT1RfSU1QTEVNRU5URUQobmFtZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYCIke25hbWV9IiBpcyBub3QgaW1wbGVtZW50ZWRgKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIERJU0FMTE9XX0NBTExCQUNLKGZuKSB7CiAgICAgICAgICAgIGlmICh0eXBlb2YgZm4gPT09ICJmdW5jdGlvbiIpIHRocm93IG5ldyBFcnJvcihgbG9jYWxmb3JhZ2UgY2FsbGJhY2sgQVBJIGlzIG5vdCBpbXBsZW1lbnRlZDsgcGxlYXNlIHVzZSB0aGUgcHJvbWlzZSBBUEkgaW5zdGVhZGApOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gU3RydWN0dXJlZENsb25lKHZhbHVlKSB7CiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICJvYmplY3QiKSByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCB7CiAgICAgICAgICAgICAgICAgICAgcG9ydDEsCiAgICAgICAgICAgICAgICAgICAgcG9ydDIKICAgICAgICAgICAgICAgIH0gPSBuZXcgTWVzc2FnZUNoYW5uZWw7CiAgICAgICAgICAgICAgICBwb3J0Mi5vbm1lc3NhZ2UgPSBldiA9PiByZXNvbHZlKGV2LmRhdGEpOwogICAgICAgICAgICAgICAgcG9ydDEucG9zdE1lc3NhZ2UodmFsdWUpCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBlbHNlIHJldHVybiBQcm9taXNlLnJlc29sdmUodmFsdWUpCiAgICAgICAgfQogICAgICAgIGNsYXNzIEZvcmFnZUFkYXB0b3IgewogICAgICAgICAgICBjb25zdHJ1Y3RvcihpbnN0KSB7CiAgICAgICAgICAgICAgICB0aGlzLl9pbnN0ID0gaW5zdDsKICAgICAgICAgICAgICAgIG1lbW9yeVN0b3JhZ2Uuc2V0KHRoaXMsIG5ldyBNYXApCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX01heWJlU3dpdGNoVG9NZW1vcnlGYWxsYmFjayhlcnIpIHsKICAgICAgICAgICAgICAgIGlmIChpc0luTWVtb3J5KSByZXR1cm47CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHJlZ2V4IG9mIENSSVRJQ0FMX0VSUk9SUykKICAgICAgICAgICAgICAgICAgICBpZiAoZXJyICYmIHJlZ2V4LnRlc3QoZXJyLm1lc3NhZ2UpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIlVuYWJsZSB0byB1c2UgbG9jYWwgc3RvcmFnZSwgcmV2ZXJ0aW5nIHRvIGluLW1lbW9yeSBzdG9yZTogIiwgZXJyLCBlcnIubWVzc2FnZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlzSW5NZW1vcnkgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBhc3luYyBfZ2V0SXRlbUZhbGxiYWNrKG5hbWUpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gbWVtb3J5U3RvcmFnZS5nZXQodGhpcykuZ2V0KG5hbWUpOwogICAgICAgICAgICAgICAgY29uc3QgcmV0ID0gYXdhaXQgU3RydWN0dXJlZENsb25lKHZhbHVlKTsKICAgICAgICAgICAgICAgIHJldHVybiB0eXBlb2YgcmV0ID09PSAidW5kZWZpbmVkIiA/CiAgICAgICAgICAgICAgICAgICAgbnVsbCA6IHJldAogICAgICAgICAgICB9CiAgICAgICAgICAgIGFzeW5jIF9zZXRJdGVtRmFsbGJhY2sobmFtZSwgdmFsdWUpIHsKICAgICAgICAgICAgICAgIHZhbHVlID0gYXdhaXQgU3RydWN0dXJlZENsb25lKHZhbHVlKTsKICAgICAgICAgICAgICAgIG1lbW9yeVN0b3JhZ2UuZ2V0KHRoaXMpLnNldChuYW1lLCB2YWx1ZSkKICAgICAgICAgICAgfQogICAgICAgICAgICBfcmVtb3ZlSXRlbUZhbGxiYWNrKG5hbWUpIHsKICAgICAgICAgICAgICAgIG1lbW9yeVN0b3JhZ2UuZ2V0KHRoaXMpLmRlbGV0ZShuYW1lKQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9jbGVhckZhbGxiYWNrKCkgewogICAgICAgICAgICAgICAgbWVtb3J5U3RvcmFnZS5nZXQodGhpcykuY2xlYXIoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9rZXlzRmFsbGJhY2soKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gQXJyYXkuZnJvbShtZW1vcnlTdG9yYWdlLmdldCh0aGlzKS5rZXlzKCkpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgSXNVc2luZ0ZhbGxiYWNrKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGlzSW5NZW1vcnkKICAgICAgICAgICAgfQogICAgICAgICAgICBhc3luYyBnZXRJdGVtKGtleSwgc3VjY2Vzc0NhbGxiYWNrKSB7CiAgICAgICAgICAgICAgICBESVNBTExPV19DQUxMQkFDSyhzdWNjZXNzQ2FsbGJhY2spOwogICAgICAgICAgICAgICAgaWYgKGlzSW5NZW1vcnkpIHJldHVybiBhd2FpdCB0aGlzLl9nZXRJdGVtRmFsbGJhY2soa2V5KTsKICAgICAgICAgICAgICAgIGxldCByZXN1bHQ7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IGF3YWl0IHRoaXMuX2luc3QuZ2V0KGtleSkKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX01heWJlU3dpdGNoVG9NZW1vcnlGYWxsYmFjayhlcnIpOwogICAgICAgICAgICAgICAgICAgIGlmIChpc0luTWVtb3J5KSByZXR1cm4gYXdhaXQgdGhpcy5fZ2V0SXRlbUZhbGxiYWNrKGtleSk7CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEVycm9yIHJlYWRpbmcgJyR7a2V5fScgZnJvbSBzdG9yYWdlLCByZXR1cm5pbmcgbnVsbDogYCwgZXJyKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGwKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gdHlwZW9mIHJlc3VsdCA9PT0gInVuZGVmaW5lZCIgPyBudWxsIDogcmVzdWx0CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYXN5bmMgc2V0SXRlbShrZXksIHZhbHVlLCBzdWNjZXNzQ2FsbGJhY2spIHsKICAgICAgICAgICAgICAgIERJU0FMTE9XX0NBTExCQUNLKHN1Y2Nlc3NDYWxsYmFjayk7CiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAidW5kZWZpbmVkIikgdmFsdWUgPSBudWxsOwogICAgICAgICAgICAgICAgaWYgKGlzSW5NZW1vcnkpIHsKICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLl9zZXRJdGVtRmFsbGJhY2soa2V5LCB2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuX2luc3Quc2V0KGtleSwgdmFsdWUpCiAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9NYXliZVN3aXRjaFRvTWVtb3J5RmFsbGJhY2soZXJyKTsKICAgICAgICAgICAgICAgICAgICBpZiAoaXNJbk1lbW9yeSkgYXdhaXQgdGhpcy5fc2V0SXRlbUZhbGxiYWNrKGtleSwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUpOwogICAgICAgICAgICAgICAgICAgIGVsc2UgdGhyb3cgZXJyOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGFzeW5jIHJlbW92ZUl0ZW0oa2V5LCBzdWNjZXNzQ2FsbGJhY2spIHsKICAgICAgICAgICAgICAgIERJU0FMTE9XX0NBTExCQUNLKHN1Y2Nlc3NDYWxsYmFjayk7CiAgICAgICAgICAgICAgICBpZiAoaXNJbk1lbW9yeSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlbW92ZUl0ZW1GYWxsYmFjayhrZXkpOwogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLl9pbnN0LmRlbGV0ZShrZXkpCiAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9NYXliZVN3aXRjaFRvTWVtb3J5RmFsbGJhY2soZXJyKTsKICAgICAgICAgICAgICAgICAgICBpZiAoaXNJbk1lbW9yeSkgdGhpcy5fcmVtb3ZlSXRlbUZhbGxiYWNrKGtleSk7CiAgICAgICAgICAgICAgICAgICAgZWxzZSBjb25zb2xlLmVycm9yKGBFcnJvciByZW1vdmluZyAnJHtrZXl9JyBmcm9tIHN0b3JhZ2U6IGAsIGVycikKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBhc3luYyBjbGVhcihzdWNjZXNzQ2FsbGJhY2spIHsKICAgICAgICAgICAgICAgIERJU0FMTE9XX0NBTExCQUNLKHN1Y2Nlc3NDYWxsYmFjayk7CiAgICAgICAgICAgICAgICBpZiAoaXNJbk1lbW9yeSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX2NsZWFyRmFsbGJhY2soKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5faW5zdC5jbGVhcigpCiAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9NYXliZVN3aXRjaFRvTWVtb3J5RmFsbGJhY2soZXJyKTsKICAgICAgICAgICAgICAgICAgICBpZiAoaXNJbk1lbW9yeSkgdGhpcy5fY2xlYXJGYWxsYmFjaygpOwogICAgICAgICAgICAgICAgICAgIGVsc2UgY29uc29sZS5lcnJvcihgRXJyb3IgY2xlYXJpbmcgc3RvcmFnZTogYCwgZXJyKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGFzeW5jIGtleXMoc3VjY2Vzc0NhbGxiYWNrKSB7CiAgICAgICAgICAgICAgICBESVNBTExPV19DQUxMQkFDSyhzdWNjZXNzQ2FsbGJhY2spOwogICAgICAgICAgICAgICAgaWYgKGlzSW5NZW1vcnkpIHJldHVybiB0aGlzLl9rZXlzRmFsbGJhY2soKTsKICAgICAgICAgICAgICAgIGxldCByZXN1bHQgPSBbXTsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gYXdhaXQgdGhpcy5faW5zdC5rZXlzKCkKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX01heWJlU3dpdGNoVG9NZW1vcnlGYWxsYmFjayhlcnIpOwogICAgICAgICAgICAgICAgICAgIGlmIChpc0luTWVtb3J5KSByZXR1cm4gdGhpcy5fa2V5c0ZhbGxiYWNrKCk7CiAgICAgICAgICAgICAgICAgICAgZWxzZSBjb25zb2xlLmVycm9yKGBFcnJvciBnZXR0aW5nIHN0b3JhZ2Uga2V5czogYCwgZXJyKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdAogICAgICAgICAgICB9CiAgICAgICAgICAgIHJlYWR5KHN1Y2Nlc3NDYWxsYmFjaykgewogICAgICAgICAgICAgICAgRElTQUxMT1dfQ0FMTEJBQ0soc3VjY2Vzc0NhbGxiYWNrKTsKICAgICAgICAgICAgICAgIGlmIChpc0luTWVtb3J5KSByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHRydWUpOwogICAgICAgICAgICAgICAgZWxzZSByZXR1cm4gdGhpcy5faW5zdC5yZWFkeSgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY3JlYXRlSW5zdGFuY2Uob3B0aW9ucykgewogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBvcHRpb25zICE9PSAib2JqZWN0IikgdGhyb3cgbmV3IFR5cGVFcnJvcigiaW52YWxpZCBvcHRpb25zIG9iamVjdCIpOwogICAgICAgICAgICAgICAgY29uc3QgbmFtZSA9IG9wdGlvbnNbIm5hbWUiXTsKICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgbmFtZSAhPT0gInN0cmluZyIpIHRocm93IG5ldyBUeXBlRXJyb3IoImludmFsaWQgc3RvcmUgbmFtZSIpOwogICAgICAgICAgICAgICAgY29uc3QgaW5zdCA9IG5ldyBLVlN0b3JhZ2VDb250YWluZXIobmFtZSk7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEZvcmFnZUFkYXB0b3IoaW5zdCkKICAgICAgICAgICAgfQogICAgICAgICAgICBsZW5ndGgoc3VjY2Vzc0NhbGxiYWNrKSB7CiAgICAgICAgICAgICAgICBOT1RfSU1QTEVNRU5URUQoImxvY2FsZm9yYWdlLmxlbmd0aCgpIikKICAgICAgICAgICAgfQogICAgICAgICAgICBrZXkoaW5kZXgsIHN1Y2Nlc3NDYWxsYmFjaykgewogICAgICAgICAgICAgICAgTk9UX0lNUExFTUVOVEVEKCJsb2NhbGZvcmFnZS5rZXkoKSIpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaXRlcmF0ZShpdGVyYXRvckNhbGxiYWNrLCBzdWNjZXNzQ2FsbGJhY2spIHsKICAgICAgICAgICAgICAgIE5PVF9JTVBMRU1FTlRFRCgibG9jYWxmb3JhZ2UuaXRlcmF0ZSgpIikKICAgICAgICAgICAgfQogICAgICAgICAgICBzZXREcml2ZXIoZHJpdmVyTmFtZSkgewogICAgICAgICAgICAgICAgTk9UX0lNUExFTUVOVEVEKCJsb2NhbGZvcmFnZS5zZXREcml2ZXIoKSIpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uZmlnKG9wdGlvbnMpIHsKICAgICAgICAgICAgICAgIE5PVF9JTVBMRU1FTlRFRCgibG9jYWxmb3JhZ2UuY29uZmlnKCkiKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGRlZmluZURyaXZlcihjdXN0b21Ecml2ZXIpIHsKICAgICAgICAgICAgICAgIE5PVF9JTVBMRU1FTlRFRCgibG9jYWxmb3JhZ2UuZGVmaW5lRHJpdmVyKCkiKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGRyaXZlcigpIHsKICAgICAgICAgICAgICAgIE5PVF9JTVBMRU1FTlRFRCgibG9jYWxmb3JhZ2UuZHJpdmVyKCkiKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHN1cHBvcnRzKGRyaXZlck5hbWUpIHsKICAgICAgICAgICAgICAgIE5PVF9JTVBMRU1FTlRFRCgibG9jYWxmb3JhZ2Uuc3VwcG9ydHMoKSIpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZHJvcEluc3RhbmNlKCkgewogICAgICAgICAgICAgICAgTk9UX0lNUExFTUVOVEVEKCJsb2NhbGZvcmFnZS5kcm9wSW5zdGFuY2UoKSIpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZGlzYWJsZU1lbW9yeU1vZGUoKSB7CiAgICAgICAgICAgICAgICBpc0luTWVtb3J5ID0KICAgICAgICAgICAgICAgICAgICBmYWxzZQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHNlbGZbImxvY2FsZm9yYWdlIl0gPSBuZXcgRm9yYWdlQWRhcHRvcihuZXcgS1ZTdG9yYWdlQ29udGFpbmVyKCJsb2NhbGZvcmFnZSIpKQogICAgfTsKCn0KCi8vIC4uL2xpYi9taXNjL3N1cHBvcnRzLmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIEMzLlN1cHBvcnRzID0ge307CiAgICBDMy5TdXBwb3J0cy5XZWJBbmltYXRpb25zID0gKCgpID0+IHsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoQzMuUGxhdGZvcm0uQnJvd3NlciA9PT0gIlNhZmFyaSIpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgaWYgKHR5cGVvZiBkb2N1bWVudCA9PT0gInVuZGVmaW5lZCIpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgY29uc3QgZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICAgICAgICBpZiAodHlwZW9mIGUuYW5pbWF0ZSA9PT0gInVuZGVmaW5lZCIpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgY29uc3QgcGxheWVyID0gZS5hbmltYXRlKFt7CiAgICAgICAgICAgICAgICBvcGFjaXR5OiAiMCIKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgb3BhY2l0eTogIjEiCiAgICAgICAgICAgIH1dLCAxRTMpOwogICAgICAgICAgICByZXR1cm4gdHlwZW9mIHBsYXllci5yZXZlcnNlICE9PSAidW5kZWZpbmVkIgogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgfQogICAgfSkoKTsKICAgIEMzLlN1cHBvcnRzLkRpYWxvZ0VsZW1lbnQgPSB0eXBlb2YgSFRNTERpYWxvZ0VsZW1lbnQgIT09ICJ1bmRlZmluZWQiOwogICAgQzMuU3VwcG9ydHMuUmVxdWVzdElkbGVDYWxsYmFjayA9ICEhc2VsZi5yZXF1ZXN0SWRsZUNhbGxiYWNrOwogICAgQzMuU3VwcG9ydHMuSW1hZ2VCaXRtYXAgPSAhIXNlbGYuY3JlYXRlSW1hZ2VCaXRtYXA7CiAgICBDMy5TdXBwb3J0cy5JbWFnZUJpdG1hcE9wdGlvbnMgPSBmYWxzZTsKICAgIEMzLlN1cHBvcnRzLkltYWdlQml0bWFwT3B0aW9uc1Jlc2l6ZSA9IGZhbHNlOwogICAgaWYgKEMzLlN1cHBvcnRzLkltYWdlQml0bWFwKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgc2VsZi5jcmVhdGVJbWFnZUJpdG1hcChuZXcgSW1hZ2VEYXRhKDMyLCAzMiksIHsKICAgICAgICAgICAgICAgICJwcmVtdWx0aXBseUFscGhhIjogIm5vbmUiCiAgICAgICAgICAgIH0pLnRoZW4oKCkgPT4gewogICAgICAgICAgICAgICAgQzMuU3VwcG9ydHMuSW1hZ2VCaXRtYXBPcHRpb25zID0gdHJ1ZQogICAgICAgICAgICB9KS5jYXRjaCgoKSA9PiB7CiAgICAgICAgICAgICAgICBDMy5TdXBwb3J0cy5JbWFnZUJpdG1hcE9wdGlvbnMgPSBmYWxzZQogICAgICAgICAgICB9KQogICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICBDMy5TdXBwb3J0cy5JbWFnZUJpdG1hcE9wdGlvbnMgPSBmYWxzZQogICAgICAgIH0KICAgICAgICB0cnkgewogICAgICAgICAgICBzZWxmLmNyZWF0ZUltYWdlQml0bWFwKG5ldyBJbWFnZURhdGEoMzIsIDMyKSwgewogICAgICAgICAgICAgICAgInJlc2l6ZVdpZHRoIjogMTAsCiAgICAgICAgICAgICAgICAicmVzaXplSGVpZ2h0IjogMTAKICAgICAgICAgICAgfSkudGhlbihpbWFnZUJpdG1hcCA9PiB7CiAgICAgICAgICAgICAgICBDMy5TdXBwb3J0cy5JbWFnZUJpdG1hcE9wdGlvbnNSZXNpemUgPSBpbWFnZUJpdG1hcC53aWR0aCA9PT0gMTAgJiYgaW1hZ2VCaXRtYXAuaGVpZ2h0ID09PSAxMAogICAgICAgICAgICB9KS5jYXRjaCgoKSA9PiB7CiAgICAgICAgICAgICAgICBDMy5TdXBwb3J0cy5JbWFnZUJpdG1hcE9wdGlvbnNSZXNpemUgPSBmYWxzZQogICAgICAgICAgICB9KQogICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICBDMy5TdXBwb3J0cy5JbWFnZUJpdG1hcE9wdGlvbnNSZXNpemUgPQogICAgICAgICAgICAgICAgZmFsc2UKICAgICAgICB9CiAgICB9CiAgICBDMy5TdXBwb3J0cy5DbGlwYm9hcmRSZWFkVGV4dCA9ICEhKG5hdmlnYXRvclsiY2xpcGJvYXJkIl0gJiYgbmF2aWdhdG9yWyJjbGlwYm9hcmQiXVsicmVhZFRleHQiXSAmJiBDMy5QbGF0Zm9ybS5Ccm93c2VyICE9PSAiRmlyZWZveCIpOwogICAgQzMuU3VwcG9ydHMuUGVybWlzc2lvbnNRdWVyeSA9ICEhKG5hdmlnYXRvclsicGVybWlzc2lvbnMiXSAmJiBuYXZpZ2F0b3JbInBlcm1pc3Npb25zIl1bInF1ZXJ5Il0pOwogICAgQzMuU3VwcG9ydHMuQ2xpcGJvYXJkUGVybWlzc2lvbnNRdWVyeSA9IGZhbHNlOwogICAgaWYgKEMzLlN1cHBvcnRzLlBlcm1pc3Npb25zUXVlcnkpIHsKICAgICAgICBjb25zdCBwZXJtaXNzaW9uID0gewogICAgICAgICAgICAibmFtZSI6ICJjbGlwYm9hcmQtcmVhZCIKICAgICAgICB9OwogICAgICAgIG5hdmlnYXRvclsicGVybWlzc2lvbnMiXVsicXVlcnkiXShwZXJtaXNzaW9uKS50aGVuKCgpID0+IHsKICAgICAgICAgICAgQzMuU3VwcG9ydHMuQ2xpcGJvYXJkUGVybWlzc2lvbnNRdWVyeSA9IHRydWUKICAgICAgICB9KS5jYXRjaCgoKSA9PiB7CiAgICAgICAgICAgIEMzLlN1cHBvcnRzLkNsaXBib2FyZFBlcm1pc3Npb25zUXVlcnkgPSBmYWxzZQogICAgICAgIH0pCiAgICB9CiAgICBDMy5TdXBwb3J0cy5Bc3luY0NsaXBib2FyZEFwaSA9ICEhKG5hdmlnYXRvclsicGVybWlzc2lvbnMiXSAmJiBuYXZpZ2F0b3JbImNsaXBib2FyZCJdICYmIHNlbGZbIkNsaXBib2FyZEl0ZW0iXSk7CiAgICBDMy5TdXBwb3J0cy5Qcm94aWVzID0gdHlwZW9mIFByb3h5ICE9PSAidW5kZWZpbmVkIjsKICAgIEMzLlN1cHBvcnRzLkRvd25sb2FkQXR0cmlidXRlID0gKCgpID0+IHsKICAgICAgICBpZiAodHlwZW9mIGRvY3VtZW50ID09PSAidW5kZWZpbmVkIikgcmV0dXJuIGZhbHNlOwogICAgICAgIGNvbnN0IGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJhIik7CiAgICAgICAgcmV0dXJuIHR5cGVvZiBhLmRvd25sb2FkICE9PSAidW5kZWZpbmVkIgogICAgfSkoKTsKICAgIEMzLlN1cHBvcnRzLkZldGNoID0gdHlwZW9mIGZldGNoID09PSAiZnVuY3Rpb24iOwogICAgQzMuU3VwcG9ydHMuUGVyc2lzdGVudFN0b3JhZ2UgPSAhIShzZWxmLmlzU2VjdXJlQ29udGV4dCAmJiBDMy5QbGF0Zm9ybS5Ccm93c2VyICE9PSAiT3BlcmEiICYmIChuYXZpZ2F0b3JbInN0b3JhZ2UiXSAmJiBuYXZpZ2F0b3JbInN0b3JhZ2UiXVsicGVyc2lzdCJdKSk7CiAgICBDMy5TdXBwb3J0cy5TdG9yYWdlUXVvdGFFc3RpbWF0ZSA9ICEhKHNlbGYuaXNTZWN1cmVDb250ZXh0ICYmIChuYXZpZ2F0b3JbInN0b3JhZ2UiXSAmJiBuYXZpZ2F0b3JbInN0b3JhZ2UiXVsiZXN0aW1hdGUiXSkpOwogICAgQzMuU3VwcG9ydHMuRnVsbHNjcmVlbiA9ICgoKSA9PiB7CiAgICAgICAgaWYgKHR5cGVvZiBkb2N1bWVudCA9PT0gInVuZGVmaW5lZCIpIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAoQzMuUGxhdGZvcm0uT1MgPT09ICJpT1MiKSByZXR1cm4gZmFsc2U7CiAgICAgICAgY29uc3QgZWxlbSA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDsKICAgICAgICByZXR1cm4gISEoZWxlbS5yZXF1ZXN0RnVsbHNjcmVlbiB8fCBlbGVtLm1zUmVxdWVzdEZ1bGxzY3JlZW4gfHwgZWxlbS5tb3pSZXF1ZXN0RnVsbFNjcmVlbiB8fCBlbGVtLndlYmtpdFJlcXVlc3RGdWxsc2NyZWVuKQogICAgfSkoKTsKICAgIEMzLlN1cHBvcnRzLkltYWdlRGVjb2RlciA9IHR5cGVvZiBzZWxmWyJJbWFnZURlY29kZXIiXSAhPT0gInVuZGVmaW5lZCI7CiAgICBDMy5TdXBwb3J0cy5XZWJDb2RlY3MgPSAhIXNlbGZbIlZpZGVvRW5jb2RlciJdOwogICAgQzMuU3VwcG9ydHMuTmF0aXZlRmlsZVN5c3RlbUFQSSA9ICEhc2VsZlsic2hvd09wZW5GaWxlUGlja2VyIl07CiAgICBDMy5TdXBwb3J0cy5RdWVyeUxvY2FsRm9udHMgPSAhIXNlbGZbInF1ZXJ5TG9jYWxGb250cyJdOwogICAgQzMuU3VwcG9ydHMuVXNlckFjdGl2YXRpb24gPSAhIW5hdmlnYXRvclsidXNlckFjdGl2YXRpb24iXTsKICAgIEMzLlN1cHBvcnRzLkNhbnZhc1RvQmxvYldlYlAgPSBmYWxzZTsKICAgIChhc3luYyAoKSA9PiB7CiAgICAgICAgbGV0IGNhbnZhczsKICAgICAgICBpZiAodHlwZW9mIGRvY3VtZW50ID09PSAidW5kZWZpbmVkIikgY2FudmFzID0gbmV3IE9mZnNjcmVlbkNhbnZhcygzMiwgMzIpOwogICAgICAgIGVsc2UgewogICAgICAgICAgICBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJjYW52YXMiKTsKICAgICAgICAgICAgY2FudmFzLndpZHRoID0gMzI7CiAgICAgICAgICAgIGNhbnZhcy5oZWlnaHQgPSAzMgogICAgICAgIH0KICAgICAgICBjb25zdCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgiMmQiKTsKICAgICAgICBjdHguZmlsbFN0eWxlID0gImJsdWUiOwogICAgICAgIGN0eC5maWxsUmVjdCgwLCAwLCAzMiwgMzIpOwogICAgICAgIGxldCBibG9iID0gbnVsbDsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoY2FudmFzLnRvQmxvYikgYmxvYiA9IGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gY2FudmFzLnRvQmxvYihyZXNvbHZlLCAiaW1hZ2Uvd2VicCIsIDEpKTsKICAgICAgICAgICAgZWxzZSBpZiAoY2FudmFzWyJjb252ZXJ0VG9CbG9iIl0pIGJsb2IgPSBhd2FpdCBjYW52YXNbImNvbnZlcnRUb0Jsb2IiXSh7CiAgICAgICAgICAgICAgICAidHlwZSI6ICJpbWFnZS93ZWJwIiwKICAgICAgICAgICAgICAgICJxdWFsaXR5IjogMQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgQzMuU3VwcG9ydHMuQ2FudmFzVG9CbG9iV2ViUCA9IGJsb2IgJiYgYmxvYi50eXBlID09PQogICAgICAgICAgICAgICAgImltYWdlL3dlYnAiCiAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgIEMzLlN1cHBvcnRzLkNhbnZhc1RvQmxvYldlYlAgPSBmYWxzZQogICAgICAgIH0KICAgIH0pKCk7Cgp9CgovLyAuLi9saWIvbWlzYy9wb2x5ZmlsbHMuanMKewogICAgJ3VzZSBzdHJpY3QnOwogICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgaWYgKCFTdHJpbmcucHJvdG90eXBlLnRyaW1TdGFydCkgewogICAgICAgIGNvbnN0IHN0YXJ0V2hpdGVzcGFjZSA9IC9eW1x4MDlceDBBXHgwQlx4MENceDBEXHgyMFx4QTBcdTE2ODBcdTE4MEVcdTIwMDBcdTIwMDFcdTIwMDJcdTIwMDNcdTIwMDRcdTIwMDVcdTIwMDZcdTIwMDdcdTIwMDhcdTIwMDlcdTIwMEFcdTIwMkZcdTIwNUZcdTMwMDBcdTIwMjhcdTIwMjlcdUZFRkZdKi87CiAgICAgICAgU3RyaW5nLnByb3RvdHlwZS50cmltU3RhcnQgPSBmdW5jdGlvbiB0cmltU3RhcnQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnJlcGxhY2Uoc3RhcnRXaGl0ZXNwYWNlLCAiIikKICAgICAgICB9CiAgICB9CiAgICBpZiAoIVN0cmluZy5wcm90b3R5cGUudHJpbUVuZCkgewogICAgICAgIGNvbnN0IGVuZFdoaXRlc3BhY2UgPSAvW1x4MDlceDBBXHgwQlx4MENceDBEXHgyMFx4QTBcdTE2ODBcdTE4MEVcdTIwMDBcdTIwMDFcdTIwMDJcdTIwMDNcdTIwMDRcdTIwMDVcdTIwMDZcdTIwMDdcdTIwMDhcdTIwMDlcdTIwMEFcdTIwMkZcdTIwNUZcdTMwMDBcdTIwMjhcdTIwMjlcdUZFRkZdKiQvOwogICAgICAgIFN0cmluZy5wcm90b3R5cGUudHJpbUVuZCA9IGZ1bmN0aW9uIHRyaW1FbmQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnJlcGxhY2UoZW5kV2hpdGVzcGFjZSwgIiIpCiAgICAgICAgfQogICAgfQogICAgaWYgKCFTdHJpbmcucHJvdG90eXBlLnJlcGxhY2VBbGwpIFN0cmluZy5wcm90b3R5cGUucmVwbGFjZUFsbCA9IGZ1bmN0aW9uIHJlcGxhY2VBbGwoZmluZCwgcmVwbGFjZSkgewogICAgICAgIHJldHVybiB0aGlzLnJlcGxhY2UobmV3IFJlZ0V4cChDMy5Fc2NhcGVSZWdleChmaW5kKSwgImciKSwgcmVwbGFjZSkKICAgIH07CiAgICBpZiAoIUFycmF5LnByb3RvdHlwZS52YWx1ZXMpIEFycmF5LnByb3RvdHlwZS52YWx1ZXMgPSBmdW5jdGlvbiooKSB7CiAgICAgICAgZm9yIChjb25zdCBpIG9mIHRoaXMpIHlpZWxkIGkKICAgIH07CiAgICBpZiAoIUFycmF5LnByb3RvdHlwZS5mbGF0KSB7CiAgICAgICAgZnVuY3Rpb24gYXJyYXlGbGF0KGFyciwgZGVwdGgpIHsKICAgICAgICAgICAgcmV0dXJuIGFyci5yZWR1Y2UoKGFjYywgdmFsKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoZGVwdGggPiAwICYmIEFycmF5LmlzQXJyYXkodmFsKSkgewogICAgICAgICAgICAgICAgICAgIEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KGFjYywgYXJyYXlGbGF0KHZhbCwgZGVwdGggLSAxKSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFjYwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBhY2MucHVzaCh2YWwpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBhY2MKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgW10pCiAgICAgICAgfQogICAgICAgIEFycmF5LnByb3RvdHlwZS5mbGF0ID0gZnVuY3Rpb24oZGVwdGggPSAxKSB7CiAgICAgICAgICAgIHJldHVybiBhcnJheUZsYXQodGhpcywgZGVwdGgpCiAgICAgICAgfQogICAgfQogICAgaWYgKCFBcnJheS5wcm90b3R5cGUuYXQpIEFycmF5LnByb3RvdHlwZS5hdCA9IGZ1bmN0aW9uIGF0KG4pIHsKICAgICAgICBuID0gTWF0aC50cnVuYyhuKSB8fCAwOwogICAgICAgIGlmIChuIDwgMCkgbiArPSB0aGlzLmxlbmd0aDsKICAgICAgICBpZiAobiA8IDAgfHwgbiA+PSB0aGlzLmxlbmd0aCkgcmV0dXJuIHVuZGVmaW5lZDsKICAgICAgICByZXR1cm4gdGhpc1tuXQogICAgfTsKICAgIGlmICghU3RyaW5nLnByb3RvdHlwZS5hdCkgU3RyaW5nLnByb3RvdHlwZS5hdCA9IGZ1bmN0aW9uIGF0KG4pIHsKICAgICAgICBuID0gTWF0aC50cnVuYyhuKSB8fCAwOwogICAgICAgIGlmIChuIDwgMCkgbiArPSB0aGlzLmxlbmd0aDsKICAgICAgICBpZiAobiA8IDAgfHwgbiA+PSB0aGlzLmxlbmd0aCkgcmV0dXJuIHVuZGVmaW5lZDsKICAgICAgICByZXR1cm4gdGhpc1tuXQogICAgfTsKICAgIGlmICghUmVnRXhwLmVzY2FwZSkgUmVnRXhwLmVzY2FwZSA9IGZ1bmN0aW9uKHMpIHsKICAgICAgICByZXR1cm4gU3RyaW5nKHMpLnJlcGxhY2UoL1tcXF4kKis/LigpfFtcXXt9XS9nLCAiXFwkJiIpCiAgICB9OwogICAgaWYgKG5hdmlnYXRvclsic3RvcmFnZSJdICYmICFuYXZpZ2F0b3JbInN0b3JhZ2UiXVsiZXN0aW1hdGUiXSAmJiBuYXZpZ2F0b3JbIndlYmtpdFRlbXBvcmFyeVN0b3JhZ2UiXSAmJiBuYXZpZ2F0b3JbIndlYmtpdFRlbXBvcmFyeVN0b3JhZ2UiXVsicXVlcnlVc2FnZUFuZFF1b3RhIl0pIG5hdmlnYXRvclsic3RvcmFnZSJdWyJlc3RpbWF0ZSJdID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKICAgICAgICAgICAgcmV0dXJuIG5hdmlnYXRvclsid2Via2l0VGVtcG9yYXJ5U3RvcmFnZSJdWyJxdWVyeVVzYWdlQW5kUXVvdGEiXSgodXNhZ2UsIHF1b3RhKSA9PiByZXNvbHZlKHsKICAgICAgICAgICAgICAgICJ1c2FnZSI6IHVzYWdlLAogICAgICAgICAgICAgICAgInF1b3RhIjogcXVvdGEKICAgICAgICAgICAgfSksIHJlamVjdCkKICAgICAgICB9KQogICAgfTsKICAgIGlmICh0eXBlb2Ygc2VsZi5pc1NlY3VyZUNvbnRleHQgPT09ICJ1bmRlZmluZWQiKSBzZWxmLmlzU2VjdXJlQ29udGV4dCA9IGxvY2F0aW9uLnByb3RvY29sID09PSAiaHR0cHM6IjsKICAgIGlmICh0eXBlb2Ygc2VsZlsiZ2xvYmFsVGhpcyJdID09PSAidW5kZWZpbmVkIikgc2VsZlsiZ2xvYmFsVGhpcyJdID0gc2VsZjsKCn0KCi8vIGxpYi9taXNjL2Fzc2VydC5qcwp7CiAgICAndXNlIHN0cmljdCc7CiAgICBjb25zdCBDMyA9IHNlbGYuQzM7CgogICAgZnVuY3Rpb24gYXNzZXJ0RmFpbChtc2dfKSB7CiAgICAgICAgbGV0IHN0YWNrID0gQzMuR2V0Q2FsbFN0YWNrKCk7CiAgICAgICAgbGV0IG1zZyA9ICJBc3NlcnRpb24gZmFpbHVyZTogIiArIG1zZ18gKyAiXG5cblN0YWNrIHRyYWNlOlxuIiArIHN0YWNrOwogICAgICAgIGNvbnNvbGUuZXJyb3IobXNnKQogICAgfQogICAgc2VsZi5hc3NlcnQgPSBmdW5jdGlvbiBhc3NlcnQoY25kXywgbXNnXykgewogICAgICAgIGlmICghY25kXykgYXNzZXJ0RmFpbChtc2dfKQogICAgfTsKCn0KCi8vIC4uL2xpYi9taXNjL3R5cGVDaGVja3MuanMKewogICAgJ3VzZSBzdHJpY3QnOwogICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgY29uc3QgQzNYID0gc2VsZi5DM1g7CiAgICBDMy5Jc051bWJlciA9IGZ1bmN0aW9uIElzTnVtYmVyKHgpIHsKICAgICAgICByZXR1cm4gdHlwZW9mIHggPT09ICJudW1iZXIiCiAgICB9OwogICAgQzMuSXNGaW5pdGVOdW1iZXIgPSBmdW5jdGlvbiBJc0Zpbml0ZU51bWJlcih4KSB7CiAgICAgICAgcmV0dXJuIEMzLklzTnVtYmVyKHgpICYmIGlzRmluaXRlKHgpCiAgICB9OwogICAgQzMuUmVxdWlyZU51bWJlciA9IGZ1bmN0aW9uIFJlcXVpcmVOdW1iZXIoeCkgewogICAgICAgIGlmICghQzMuSXNOdW1iZXIoeCkpIHRocm93IG5ldyBUeXBlRXJyb3IoImV4cGVjdGVkIG51bWJlciIpOwogICAgfTsKICAgIEMzLlJlcXVpcmVPcHRpb25hbE51bWJlciA9IGZ1bmN0aW9uIFJlcXVpcmVPcHRpb25hbE51bWJlcih4KSB7CiAgICAgICAgaWYgKEMzLklzTnVsbE9yVW5kZWZpbmVkKHgpKSByZXR1cm4KICAgIH07CiAgICBDMy5SZXF1aXJlTnVtYmVySW5SYW5nZSA9IGZ1bmN0aW9uIFJlcXVpcmVOdW1iZXJJblJhbmdlKHgsIGxvdywgaGlnaCkgewogICAgICAgIGlmICghQzMuSXNOdW1iZXIoeCkgfHwgaXNOYU4oeCkgfHwgbG93ID4geCB8fCBoaWdoIDwgeCkgdGhyb3cgbmV3IFJhbmdlRXJyb3IoIm51bWJlciBvdXRzaWRlIG9mIHJhbmdlIik7CiAgICB9OwogICAgQzMuUmVxdWlyZUFsbE51bWJlciA9IGZ1bmN0aW9uIFJlcXVpcmVBbGxOdW1iZXIoLi4uYXJncykgewogICAgICAgIGZvciAobGV0IGEgb2YgYXJncyk7CiAgICB9OwogICAgQzMuUmVxdWlyZUZpbml0ZU51bWJlciA9IGZ1bmN0aW9uIFJlcXVpcmVGaW5pdGVOdW1iZXIoeCkgewogICAgICAgIGlmICghQzMuSXNGaW5pdGVOdW1iZXIoeCkpIHRocm93IG5ldyBUeXBlRXJyb3IoImV4cGVjdGVkIGZpbml0ZSBudW1iZXIiKTsKICAgIH07CiAgICBDMy5SZXF1aXJlT3B0aW9uYWxGaW5pdGVOdW1iZXIgPSBmdW5jdGlvbiBSZXF1aXJlT3B0aW9uYWxGaW5pdGVOdW1iZXIoeCkgewogICAgICAgIGlmIChDMy5Jc051bGxPclVuZGVmaW5lZCh4KSkgcmV0dXJuCiAgICB9OwogICAgQzMuUmVxdWlyZUFsbEZpbml0ZU51bWJlciA9IGZ1bmN0aW9uIFJlcXVpcmVBbGxGaW5pdGVOdW1iZXIoLi4uYXJncykgewogICAgICAgIGZvciAobGV0IGEgb2YgYXJncyk7CiAgICB9OwogICAgQzMuSXNTdHJpbmcgPSBmdW5jdGlvbiBJc1N0cmluZyh4KSB7CiAgICAgICAgcmV0dXJuIHR5cGVvZiB4ID09PSAic3RyaW5nIgogICAgfTsKICAgIEMzLlJlcXVpcmVTdHJpbmcgPSBmdW5jdGlvbiBSZXF1aXJlU3RyaW5nKHgpIHsKICAgICAgICBpZiAoIUMzLklzU3RyaW5nKHgpKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJleHBlY3RlZCBzdHJpbmciKTsKICAgIH07CiAgICBDMy5SZXF1aXJlT3B0aW9uYWxTdHJpbmcgPSBmdW5jdGlvbiBSZXF1aXJlT3B0aW9uYWxTdHJpbmcoeCkgewogICAgICAgIGlmIChDMy5Jc051bGxPclVuZGVmaW5lZCh4KSkgcmV0dXJuCiAgICB9OwogICAgQzMuUmVxdWlyZUFsbFN0cmluZyA9IGZ1bmN0aW9uIFJlcXVpcmVBbGxTdHJpbmcoLi4uYXJncykgewogICAgICAgIGZvciAobGV0IGEgb2YgYXJncyk7CiAgICB9OwogICAgQzMuSXNTaW1wbGVPYmplY3QgPSBmdW5jdGlvbiBJc1NpbXBsZU9iamVjdCh4KSB7CiAgICAgICAgaWYgKHR5cGVvZiB4ICE9PSAib2JqZWN0IiB8fCB4ID09PSBudWxsKSByZXR1cm4gZmFsc2U7CiAgICAgICAgbGV0IHByb3RvID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKHgpOwogICAgICAgIHJldHVybiBwcm90byA/IHByb3RvLmNvbnN0cnVjdG9yID09PSBPYmplY3QgOiBwcm90byA9PT0gbnVsbAogICAgfTsKICAgIEMzLlJlcXVpcmVTaW1wbGVPYmplY3QgPSBmdW5jdGlvbiBSZXF1aXJlU2ltcGxlT2JqZWN0KHgpIHsKICAgICAgICBpZiAoIUMzLklzU2ltcGxlT2JqZWN0KHgpKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJleHBlY3RlZCBzaW1wbGUgb2JqZWN0Iik7CiAgICB9OwogICAgQzMuUmVxdWlyZU9wdGlvbmFsU2ltcGxlT2JqZWN0ID0gZnVuY3Rpb24gUmVxdWlyZVNpbXBsZU9iamVjdCh4KSB7CiAgICAgICAgaWYgKEMzLklzTnVsbE9yVW5kZWZpbmVkKHgpKSByZXR1cm47CiAgICAgICAgaWYgKCFDMy5Jc1NpbXBsZU9iamVjdCh4KSkgdGhyb3cgbmV3IFR5cGVFcnJvcigiZXhwZWN0ZWQgc2ltcGxlIG9iamVjdCIpOwogICAgfTsKICAgIEMzLklzT2JqZWN0ID0gZnVuY3Rpb24gSXNPYmplY3QoeCkgewogICAgICAgIHJldHVybiB0eXBlb2YgeCA9PT0gIm9iamVjdCIgJiYgeCAhPT0gbnVsbCAmJiAhQXJyYXkuaXNBcnJheSh4KQogICAgfTsKICAgIEMzLlJlcXVpcmVPYmplY3QgPSBmdW5jdGlvbiBSZXF1aXJlT2JqZWN0KHgpIHsKICAgICAgICBpZiAoIUMzLklzT2JqZWN0KHgpKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJleHBlY3RlZCBvYmplY3QiKTsKICAgIH07CiAgICBDMy5SZXF1aXJlT3B0aW9uYWxPYmplY3QgPSBmdW5jdGlvbiBSZXF1aXJlT3B0aW9uYWxPYmplY3QoeCkgewogICAgICAgIGlmIChDMy5Jc051bGxPclVuZGVmaW5lZCh4KSkgcmV0dXJuCiAgICB9OwogICAgQzMuUmVxdWlyZUFsbE9iamVjdCA9IGZ1bmN0aW9uIFJlcXVpcmVBbGxPYmplY3QoLi4uYXJncykgewogICAgICAgIGZvciAobGV0IGEgb2YgYXJncyk7CiAgICB9OwogICAgQzMuSXNGaWxlTGlrZSA9IGZ1bmN0aW9uIElzRmlsZUxpa2UoeCkgewogICAgICAgIHJldHVybiBDMy5XZWFrSXNJbnN0YW5jZU9mKHgsIEJsb2IpICYmIHR5cGVvZiB4WyJuYW1lIl0gPT09ICJzdHJpbmciCiAgICB9OwogICAgQzMuUmVxdWlyZUZpbGVMaWtlID0gZnVuY3Rpb24gUmVxdWlyZUZpbGVMaWtlKHgpIHsKICAgICAgICBpZiAoIUMzLklzRmlsZUxpa2UoeCkpIHRocm93IG5ldyBUeXBlRXJyb3IoImV4cGVjdGVkIGZpbGUiKTsKICAgIH07CiAgICBDMy5SZXF1aXJlT3B0aW9uYWxGaWxlTGlrZSA9IGZ1bmN0aW9uIFJlcXVpcmVPcHRpb25hbEZpbGVMaWtlKHgpIHsKICAgICAgICBpZiAoQzMuSXNOdWxsT3JVbmRlZmluZWQoeCkpIHJldHVybgogICAgfTsKICAgIEMzLklzQXJyYXkgPSBmdW5jdGlvbiBJc0FycmF5KHgpIHsKICAgICAgICByZXR1cm4gQXJyYXkuaXNBcnJheSh4KQogICAgfTsKICAgIEMzLlJlcXVpcmVBcnJheSA9IGZ1bmN0aW9uIFJlcXVpcmVBcnJheSh4KSB7CiAgICAgICAgaWYgKCFDMy5Jc0FycmF5KHgpKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJleHBlY3RlZCBhcnJheSIpOwogICAgfTsKICAgIEMzLlJlcXVpcmVPcHRpb25hbEFycmF5ID0gZnVuY3Rpb24gUmVxdWlyZU9wdGlvbmFsQXJyYXkoeCkgewogICAgICAgIGlmIChDMy5Jc051bGxPclVuZGVmaW5lZCh4KSkgcmV0dXJuCiAgICB9OwogICAgQzMuUmVxdWlyZUFsbEFycmF5ID0gZnVuY3Rpb24gUmVxdWlyZUFsbEFycmF5KC4uLmFyZ3MpIHsKICAgICAgICBmb3IgKGxldCBhIG9mIGFyZ3MpOwogICAgfTsKICAgIEMzLklzMkRBcnJheSA9IGZ1bmN0aW9uKHgpIHsKICAgICAgICBpZiAoIUMzLklzQXJyYXkoeCkpIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAoIXgubGVuZ3RoKSByZXR1cm4gdHJ1ZTsKICAgICAgICBpZiAoIUMzLklzQXJyYXkoeFswXSkpIHJldHVybiBmYWxzZTsKICAgICAgICByZXR1cm4gdHJ1ZQogICAgfTsKICAgIEMzLlJlcXVpcmUyREFycmF5ID0gZnVuY3Rpb24gUmVxdWlyZTJEQXJyYXkoeCkgewogICAgICAgIGlmICghQzMuSXMyREFycmF5KHgpKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJleHBlY3RlZCAyZCBhcnJheSIpOwogICAgICAgIGZvciAobGV0IGFyciBvZiB4KQogICAgICAgICAgICBpZiAoIUMzLklzQXJyYXkoYXJyKSkgdGhyb3cgbmV3IFR5cGVFcnJvcigiZXhwZWN0ZWQgMmQgYXJyYXkiKTsKICAgIH07CiAgICBDMy5SZXF1aXJlT3B0aW9uYWwyREFycmF5ID0gZnVuY3Rpb24gUmVxdWlyZTJEQXJyYXkoeCkgewogICAgICAgIGlmIChDMy5Jc051bGxPclVuZGVmaW5lZCh4KSkgcmV0dXJuCiAgICB9OwogICAgQzMuSXNGdW5jdGlvbiA9IGZ1bmN0aW9uIElzRnVuY3Rpb24oeCkgewogICAgICAgIHJldHVybiB0eXBlb2YgeCA9PT0gImZ1bmN0aW9uIgogICAgfTsKICAgIEMzLlJlcXVpcmVGdW5jdGlvbiA9IGZ1bmN0aW9uIFJlcXVpcmVGdW5jdGlvbih4LCBmKSB7CiAgICAgICAgaWYgKCFDMy5Jc0Z1bmN0aW9uKHgpKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJleHBlY3RlZCBmdW5jdGlvbiIpOwogICAgICAgIGlmICghQzMuSXNOdWxsT3JVbmRlZmluZWQoZikpCiAgICAgICAgICAgIGlmICh4ICE9PSBmKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJleHBlY3RlZCBzYW1lIGZ1bmN0aW9uIHJlZmVyZW5jZSIpOwogICAgfTsKICAgIEMzLlJlcXVpcmVPcHRpb25hbEZ1bmN0aW9uID0gZnVuY3Rpb24gUmVxdWlyZU9wdGlvbmFsRnVuY3Rpb24oeCkgewogICAgICAgIGlmIChDMy5Jc051bGxPclVuZGVmaW5lZCh4KSkgcmV0dXJuCiAgICB9OwogICAgQzMuUmVxdWlyZUFsbEZ1bmN0aW9uID0gZnVuY3Rpb24gUmVxdWlyZUFsbEZ1bmN0aW9uKC4uLmFyZ3MpIHsKICAgICAgICBmb3IgKGxldCBhIG9mIGFyZ3MpOwogICAgfTsKICAgIEMzLlJlcXVpcmVBbnlGdW5jdGlvbiA9IGZ1bmN0aW9uIFJlcXVpcmVBbGxGdW5jdGlvbih4LCAuLi5hcmdzKSB7CiAgICAgICAgaWYgKCFDMy5Jc0Z1bmN0aW9uKHgpKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJleHBlY3RlZCBmdW5jdGlvbiIpOwogICAgICAgIGlmICghYXJncy5sZW5ndGgpIHRocm93IG5ldyBFcnJvcigibWlzc2luZyBjb21wYXJpc29uIGZ1bmN0aW9ucyIpOwogICAgICAgIGZvciAobGV0IGEgb2YgYXJncykKICAgICAgICAgICAgaWYgKCFDMy5Jc051bGxPclVuZGVmaW5lZChhKSkKICAgICAgICAgICAgICAgIGlmICh4ID09PSBhKSByZXR1cm47CiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiZXhwZWN0ZWQgc2FtZSBmdW5jdGlvbiByZWZlcmVuY2UiKTsKICAgIH07CiAgICBDMy5SZXF1aXJlT3B0aW9uYWxBbGxGdW5jdGlvbiA9IGZ1bmN0aW9uIFJlcXVpcmVBbGxGdW5jdGlvbiguLi5hcmdzKSB7CiAgICAgICAgaWYgKEMzLklzTnVsbE9yVW5kZWZpbmVkKGFyZ3MpKSByZXR1cm47CiAgICAgICAgZm9yIChsZXQgYSBvZiBhcmdzKTsKICAgIH07CiAgICBDMy5Jc0luc3RhbmNlT2YgPSBmdW5jdGlvbiBJc0luc3RhbmNlT2YoeCwgdCkgewogICAgICAgIHJldHVybiB4IGluc3RhbmNlb2YgdAogICAgfTsKICAgIEMzLklzSW5zdGFuY2VPZkFueSA9IGZ1bmN0aW9uIElzSW5zdGFuY2VPZkFueSh4LCAuLi5hcmdzKSB7CiAgICAgICAgZm9yIChsZXQgdCBvZiBhcmdzKQogICAgICAgICAgICBpZiAoQzMuSXNJbnN0YW5jZU9mKHgsIHQpKSByZXR1cm4gdHJ1ZTsKICAgICAgICByZXR1cm4gZmFsc2UKICAgIH07CiAgICBDMy5SZXF1aXJlSW5zdGFuY2VPZiA9IGZ1bmN0aW9uIFJlcXVpcmVJbnN0YW5jZU9mKHgsIHQpIHsKICAgICAgICBpZiAoIUMzLklzSW5zdGFuY2VPZih4LCB0KSkgdGhyb3cgbmV3IFR5cGVFcnJvcigidW5leHBlY3RlZCB0eXBlIik7CiAgICB9OwogICAgQzMuUmVxdWlyZU9wdGlvbmFsSW5zdGFuY2VPZiA9IGZ1bmN0aW9uIFJlcXVpcmVPcHRpb25hbEluc3RhbmNlT2YoeCwgdCkgewogICAgICAgIGlmIChDMy5Jc051bGxPclVuZGVmaW5lZCh4KSkgcmV0dXJuCiAgICB9OwogICAgQzMuUmVxdWlyZUFsbEluc3RhbmNlT2YgPSBmdW5jdGlvbiBSZXF1aXJlQWxsSW5zdGFuY2VPZih0LCAuLi5hcmdzKSB7CiAgICAgICAgZm9yIChsZXQgYSBvZiBhcmdzKTsKICAgIH07CiAgICBDMy5SZXF1aXJlQW55SW5zdGFuY2VPZiA9IGZ1bmN0aW9uIFJlcXVpcmVBbnlJbnN0YW5jZU9mKHgsIC4uLmFyZ3MpIHsKICAgICAgICBpZiAoIUMzLklzSW5zdGFuY2VPZkFueSh4LCAuLi5hcmdzKSkgdGhyb3cgbmV3IFR5cGVFcnJvcigidW5leHBlY3RlZCB0eXBlIik7CiAgICB9OwogICAgQzMuUmVxdWlyZUFueU9wdGlvbmFsSW5zdGFuY2VPZiA9IGZ1bmN0aW9uIFJlcXVpcmVBbnlPcHRpb25hbEluc3RhbmNlT2YoeCwgLi4uYXJncykgewogICAgICAgIGlmIChDMy5Jc051bGxPclVuZGVmaW5lZCh4KSkgcmV0dXJuOwogICAgICAgIGlmICghQzMuSXNJbnN0YW5jZU9mQW55KHgsIC4uLmFyZ3MpKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJ1bmV4cGVjdGVkIHR5cGUiKTsKICAgIH07CiAgICBDMy5Jc0FycmF5T2YgPSBmdW5jdGlvbiBJc0FycmF5T2YoeCwgdCkgewogICAgICAgIGZvciAobGV0IGkgb2YgeCkKICAgICAgICAgICAgaWYgKCFDMy5Jc0luc3RhbmNlT2YoaSwgdCkpIHJldHVybiBmYWxzZTsKICAgICAgICByZXR1cm4gdHJ1ZQogICAgfTsKICAgIEMzLklzQXJyYXlPZkZpbml0ZU51bWJlcnMgPSBmdW5jdGlvbiBJc0FycmF5T2ZGaW5pdGVOdW1iZXJzKHgpIHsKICAgICAgICBmb3IgKGxldCBpIG9mIHgpCiAgICAgICAgICAgIGlmICghQzMuSXNGaW5pdGVOdW1iZXIoaSkpIHJldHVybiBmYWxzZTsKICAgICAgICByZXR1cm4gdHJ1ZQogICAgfTsKICAgIEMzLlJlcXVpcmVBcnJheU9mID0gZnVuY3Rpb24gUmVxdWlyZUFycmF5T2YoeCwgdCkgewogICAgICAgIGZvciAobGV0IGkgb2YgeCk7CiAgICB9OwogICAgQzMuUmVxdWlyZU9wdGlvbmFsQXJyYXlPZiA9IGZ1bmN0aW9uIFJlcXVpcmVPcHRpb25hbEFycmF5T2YoeCwgdCkgewogICAgICAgIGlmIChDMy5Jc051bGxPclVuZGVmaW5lZCh4KSkgcmV0dXJuOwogICAgICAgIGZvciAobGV0IGkgb2YgeCk7CiAgICB9OwogICAgQzMuUmVxdWlyZUFycmF5T2ZBbnkgPSBmdW5jdGlvbiBSZXF1aXJlQXJyYXlPZih4LCAuLi5hcmdzKSB7CiAgICAgICAgZm9yIChsZXQgaSBvZiB4KTsKICAgIH07CiAgICBDMy5SZXF1aXJlT3B0aW9uYWxBcnJheU9mQW55ID0gZnVuY3Rpb24gUmVxdWlyZU9wdGlvbmFsQXJyYXlPZkFueSh4LCAuLi5hcmdzKSB7CiAgICAgICAgaWYgKEMzLklzTnVsbE9yVW5kZWZpbmVkKHgpKSByZXR1cm47CiAgICAgICAgZm9yIChsZXQgaSBvZiB4KTsKICAgIH07CiAgICBDMy5Jc0RPTU5vZGUgPSBmdW5jdGlvbiBJc0RPTU5vZGUoZCwgbikgewogICAgICAgIGlmIChDMy5Jc051bGxPclVuZGVmaW5lZChkKSB8fCAhQzMuSXNTdHJpbmcoZC5ub2RlTmFtZSkpIHJldHVybiBmYWxzZTsKICAgICAgICByZXR1cm4gIW4gfHwgQzMuZXF1YWxzTm9DYXNlKGQubm9kZU5hbWUsIG4pCiAgICB9OwogICAgQzMuUmVxdWlyZURPTU5vZGUgPSBmdW5jdGlvbiBSZXF1aXJlRE9NTm9kZShkLCBuKSB7CiAgICAgICAgaWYgKEMzLklzTnVsbE9yVW5kZWZpbmVkKGQpIHx8ICFDMy5Jc1N0cmluZyhkLm5vZGVOYW1lKSkgdGhyb3cgbmV3IFR5cGVFcnJvcigiZXhwZWN0ZWQgRE9NIG5vZGUiKTsKICAgICAgICBpZiAobiAmJiAhQzMuZXF1YWxzTm9DYXNlKGQubm9kZU5hbWUsIG4pKSB0aHJvdyBuZXcgVHlwZUVycm9yKGBleHBlY3RlZCBET00gJyR7bn0nIG5vZGVgKTsKICAgIH07CiAgICBDMy5SZXF1aXJlT3B0aW9uYWxET01Ob2RlID0gZnVuY3Rpb24gUmVxdWlyZU9wdGlvbmFsRE9NTm9kZShkLCBuKSB7CiAgICAgICAgaWYgKEMzLklzTnVsbE9yVW5kZWZpbmVkKGQpKSByZXR1cm4KICAgIH07CiAgICBDMy5Jc0hUTUxFbGVtZW50ID0gZnVuY3Rpb24gSXNIVE1MRWxlbWVudChlLCB0KSB7CiAgICAgICAgaWYgKEMzLklzTnVsbE9yVW5kZWZpbmVkKGUpIHx8ICFDMy5Jc1N0cmluZyhlLnRhZ05hbWUpKSByZXR1cm4gZmFsc2U7CiAgICAgICAgcmV0dXJuICF0IHx8IEMzLmVxdWFsc05vQ2FzZShlLnRhZ05hbWUsIHQpCiAgICB9OwogICAgQzMuUmVxdWlyZUhUTUxFbGVtZW50ID0gZnVuY3Rpb24gUmVxdWlyZUhUTUxFbGVtZW50KGUsIHQpIHsKICAgICAgICBpZiAoQzMuSXNOdWxsT3JVbmRlZmluZWQoZSkgfHwgIUMzLklzU3RyaW5nKGUudGFnTmFtZSkpIHRocm93IG5ldyBUeXBlRXJyb3IoImV4cGVjdGVkIEhUTUwgZWxlbWVudCIpOwogICAgICAgIGlmICh0ICYmICFDMy5lcXVhbHNOb0Nhc2UoZS50YWdOYW1lLCB0KSkgdGhyb3cgbmV3IFR5cGVFcnJvcihgZXhwZWN0ZWQgSFRNTCAnJHt0fScgZWxlbWVudGApOwogICAgfTsKICAgIEMzLlJlcXVpcmVPcHRpb25hbEhUTUxFbGVtZW50ID0gZnVuY3Rpb24gUmVxdWlyZU9wdGlvbmFsSFRNTEVsZW1lbnQoZSwgdCkgewogICAgICAgIGlmIChDMy5Jc051bGxPclVuZGVmaW5lZChlKSkgcmV0dXJuCiAgICB9OwogICAgQzMuSXNEcmF3YWJsZSA9IGZ1bmN0aW9uIElzRHJhd2FibGUoZCkgewogICAgICAgIHJldHVybiBDMy5Jc0hUTUxFbGVtZW50KGQsICJpbWciKSB8fCBDMy5Jc0hUTUxFbGVtZW50KGQsICJjYW52YXMiKSB8fCBDMy5Jc0hUTUxFbGVtZW50KGQsICJ2aWRlbyIpIHx8IHR5cGVvZiBPZmZzY3JlZW5DYW52YXMgIT09ICJ1bmRlZmluZWQiICYmIGQgaW5zdGFuY2VvZiBPZmZzY3JlZW5DYW52YXMgfHwgdHlwZW9mIEltYWdlQml0bWFwICE9PSAidW5kZWZpbmVkIiAmJiBkIGluc3RhbmNlb2YgSW1hZ2VCaXRtYXAKICAgIH07CiAgICBDMy5SZXF1aXJlRHJhd2FibGUgPSBmdW5jdGlvbiBSZXF1aXJlRHJhd2FibGUoZCkgewogICAgICAgIGlmICghQzMuSXNEcmF3YWJsZShkKSkgdGhyb3cgbmV3IFR5cGVFcnJvcigiZXhwZWN0ZWQgZHJhd2FibGUiKTsKICAgIH07CiAgICBDMy5SZXF1aXJlT3B0aW9uYWxEcmF3YWJsZSA9IGZ1bmN0aW9uIFJlcXVpcmVPcHRpb25hbERyYXdhYmxlKGQpIHsKICAgICAgICBpZiAoQzMuSXNOdWxsT3JVbmRlZmluZWQoZCkpIHJldHVybgogICAgfTsKICAgIEMzLklzRHJhd2FibGVPckltYWdlRGF0YSA9IGZ1bmN0aW9uIElzRHJhd2FibGVPckltYWdlRGF0YSh4KSB7CiAgICAgICAgaWYgKHggaW5zdGFuY2VvZiBJbWFnZURhdGEpIHJldHVybiB0cnVlOwogICAgICAgIHJldHVybiBDMy5Jc0RyYXdhYmxlKHgpCiAgICB9OwogICAgQzMuUmVxdWlyZURyYXdhYmxlT3JJbWFnZURhdGEgPSBmdW5jdGlvbiBSZXF1aXJlRHJhd2FibGVPckltYWdlRGF0YShkKSB7CiAgICAgICAgaWYgKCFDMy5Jc0RyYXdhYmxlT3JJbWFnZURhdGEoZCkpIHRocm93IG5ldyBUeXBlRXJyb3IoImV4cGVjdGVkIGRyYXdhYmxlIG9yIGltYWdlIGRhdGEiKTsKICAgIH07CiAgICBDMy5SZXF1aXJlT3B0aW9uYWxEcmF3YWJsZU9ySW1hZ2VEYXRhID0gZnVuY3Rpb24gUmVxdWlyZU9wdGlvbmFsRHJhd2FibGVPckltYWdlRGF0YShkKSB7CiAgICAgICAgaWYgKEMzLklzTnVsbE9yVW5kZWZpbmVkKGQpKSByZXR1cm47CiAgICAgICAgaWYgKCFDMy5Jc0RyYXdhYmxlT3JJbWFnZURhdGEoZCkpIHRocm93IG5ldyBUeXBlRXJyb3IoImV4cGVjdGVkIGRyYXdhYmxlIG9yIGltYWdlIGRhdGEiKTsKICAgIH07CiAgICBDMy5Jc1N0cmluZ0xpa2UgPSBmdW5jdGlvbiBJc1N0cmluZ0xpa2UoeCkgewogICAgICAgIHJldHVybiB0eXBlb2YgeCA9PT0gInN0cmluZyIgfHwgQzMuSHRtbFN0cmluZyAmJiB4IGluc3RhbmNlb2YgQzMuSHRtbFN0cmluZyB8fCB4IGluc3RhbmNlb2YgQzMuQkJTdHJpbmcKICAgIH07CiAgICBDMy5SZXF1aXJlU3RyaW5nTGlrZSA9IGZ1bmN0aW9uIFJlcXVpcmVTdHJpbmdMaWtlKHgpIHsKICAgICAgICBpZiAoIUMzLklzU3RyaW5nTGlrZSh4KSkgdGhyb3cgbmV3IFR5cGVFcnJvcigiZXhwZWN0ZWQgc3RyaW5nLWxpa2UiKTsKICAgIH07CiAgICBDMy5SZXF1aXJlT3B0aW9uYWxTdHJpbmdMaWtlID0gZnVuY3Rpb24gUmVxdWlyZU9wdGlvbmFsU3RyaW5nTGlrZSh4KSB7CiAgICAgICAgaWYgKEMzLklzTnVsbE9yVW5kZWZpbmVkKHgpKSByZXR1cm4KICAgIH07CiAgICBDMy5SZXF1aXJlQWxsU3RyaW5nTGlrZSA9IGZ1bmN0aW9uIFJlcXVpcmVBbGxTdHJpbmdMaWtlKC4uLmFyZ3MpIHsKICAgICAgICBmb3IgKGxldCBhIG9mIGFyZ3MpOwogICAgfTsKICAgIEMzLlJlcXVpcmVPdmVycmlkZSA9IGZ1bmN0aW9uIFJlcXVpcmVPdmVycmlkZSgpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIm11c3QgYmUgb3ZlcnJpZGRlbiIpOwogICAgfTsKICAgIEMzLk5vdFlldEltcGxlbWVudGVkID0gZnVuY3Rpb24gTm90WWV0SW1wbGVtZW50ZWQoKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJub3QgeWV0IGltcGxlbWVudGVkIik7CiAgICB9OwogICAgQzMuSXNEZWZpbmVkID0gZnVuY3Rpb24gaXNEZWZpbmVkKG9iaiwgLi4uZm9sbG93KSB7CiAgICAgICAgbGV0IGN1cnJlbnRPYmplY3QgPSBvYmo7CiAgICAgICAgaWYgKHR5cGVvZiBjdXJyZW50T2JqZWN0ID09PSAidW5kZWZpbmVkIikgcmV0dXJuIGZhbHNlOwogICAgICAgIGZvciAobGV0IGtleSBvZiBmb2xsb3cpIHsKICAgICAgICAgICAgaWYgKHR5cGVvZiBjdXJyZW50T2JqZWN0W2tleV0gPT09ICJ1bmRlZmluZWQiKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGN1cnJlbnRPYmplY3QgPSBjdXJyZW50T2JqZWN0W2tleV0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWUKICAgIH07CiAgICBDMy5Jc051bGxPclVuZGVmaW5lZCA9IGZ1bmN0aW9uKHgpIHsKICAgICAgICByZXR1cm4gdHlwZW9mIHggPT09ICJ1bmRlZmluZWQiIHx8IHggPT09IG51bGwKICAgIH07CiAgICBDMy5BcmVBcnJheUVsZW1lbnRzT2ZTYW1lVHlwZSA9IGZ1bmN0aW9uKGFycikgewogICAgICAgIGxldCB0eXBlID0gYXJyWzBdLmNvbnN0cnVjdG9yOwogICAgICAgIGZvciAobGV0IHggb2YgYXJyKQogICAgICAgICAgICBpZiAoeC5jb25zdHJ1Y3RvciAhPT0gdHlwZSkgcmV0dXJuIGZhbHNlOwogICAgICAgIHJldHVybiB0eXBlCiAgICB9OwogICAgQzMuQXJlQXJyYXlFbGVtZW50c09mVHlwZSA9IGZ1bmN0aW9uKGFyciwgdCkgewogICAgICAgIGZvciAobGV0IHggb2YgYXJyKQogICAgICAgICAgICBpZiAoISh4IGluc3RhbmNlb2YgdCkpIHJldHVybiBmYWxzZTsKICAgICAgICByZXR1cm4gdHJ1ZQogICAgfTsKICAgIGNvbnN0IFR5cGVkQXJyYXkgPSBPYmplY3QuZ2V0UHJvdG90eXBlT2YoVWludDhBcnJheSk7CiAgICBDMy5Jc1R5cGVkQXJyYXkgPSBmdW5jdGlvbih2aWV3KSB7CiAgICAgICAgcmV0dXJuIEMzLklzSW5zdGFuY2VPZih2aWV3LCBUeXBlZEFycmF5KQogICAgfTsKICAgIEMzLlJlcXVpcmVUeXBlZEFycmF5ID0gZnVuY3Rpb24odmlldykge307CiAgICBDMy5XZWFrUmVxdWlyZVR5cGVkQXJyYXkgPSBmdW5jdGlvbiBXZWFrUmVxdWlyZVR5cGVkQXJyYXkoaW5zdCkgewogICAgICAgIEMzLldlYWtSZXF1aXJlSW5zdGFuY2VPZihpbnN0LCBUeXBlZEFycmF5KQogICAgfTsKICAgIEMzLldlYWtSZXF1aXJlQW55SW5zdGFuY2VPZiA9IGZ1bmN0aW9uIFdlYWtSZXF1aXJlQW55SW5zdGFuY2VPZihpbnN0LCAuLi5jdG9ycykgewogICAgICAgIGlmICghQzMuV2Vha0lzQW55SW5zdGFuY2VPZihpbnN0LCAuLi5jdG9ycykpIHRocm93IG5ldyBUeXBlRXJyb3IoInVuZXhwZWN0ZWQgdHlwZSIpOwogICAgfTsKICAgIEMzLldlYWtJc0FueUluc3RhbmNlT2YgPSBmdW5jdGlvbiBXZWFrSXNBbnlJbnN0YW5jZU9mKGluc3QsIC4uLmN0b3JzKSB7CiAgICAgICAgZm9yIChjb25zdCBjdG9yIG9mIGN0b3JzKQogICAgICAgICAgICBpZiAoQzMuV2Vha0lzSW5zdGFuY2VPZihpbnN0LCBjdG9yKSkgcmV0dXJuIHRydWU7CiAgICAgICAgcmV0dXJuIGZhbHNlCiAgICB9OwogICAgQzMuV2Vha1JlcXVpcmVJbnN0YW5jZU9mID0gZnVuY3Rpb24gV2Vha1JlcXVpcmVJbnN0YW5jZU9mKGluc3QsIGN0b3IpIHsKICAgICAgICBpZiAoIUMzLldlYWtJc0luc3RhbmNlT2YoaW5zdCwgY3RvcikpIHRocm93IG5ldyBUeXBlRXJyb3IoInVuZXhwZWN0ZWQgdHlwZSIpOwogICAgfTsKICAgIEMzLldlYWtJc0luc3RhbmNlT2YgPSBmdW5jdGlvbiBXZWFrSXNJbnN0YW5jZU9mKGluc3QsIGN0b3IpIHsKICAgICAgICB3aGlsZSAoaW5zdCA9IE9iamVjdC5nZXRQcm90b3R5cGVPZihpbnN0KSkKICAgICAgICAgICAgaWYgKGluc3QuY29uc3RydWN0b3IubmFtZSA9PT0gY3Rvci5uYW1lKSByZXR1cm4gdHJ1ZTsKICAgICAgICByZXR1cm4gZmFsc2UKICAgIH07CiAgICBDM1guUmVxdWlyZU51bWJlciA9IEMzLlJlcXVpcmVOdW1iZXI7CiAgICBDM1guUmVxdWlyZU9wdGlvbmFsTnVtYmVyID0gQzMuUmVxdWlyZU9wdGlvbmFsTnVtYmVyOwogICAgQzNYLlJlcXVpcmVGaW5pdGVOdW1iZXIgPSBDMy5SZXF1aXJlRmluaXRlTnVtYmVyOwogICAgQzNYLlJlcXVpcmVPcHRpb25hbEZpbml0ZU51bWJlciA9IEMzLlJlcXVpcmVPcHRpb25hbEZpbml0ZU51bWJlcjsKICAgIEMzWC5SZXF1aXJlU3RyaW5nID0gQzMuUmVxdWlyZVN0cmluZzsKICAgIEMzWC5SZXF1aXJlT3B0aW9uYWxTdHJpbmcgPSBDMy5SZXF1aXJlT3B0aW9uYWxTdHJpbmc7CiAgICBDM1guUmVxdWlyZU9iamVjdCA9IEMzLlJlcXVpcmVPYmplY3Q7CiAgICBDM1guUmVxdWlyZU9wdGlvbmFsT2JqZWN0ID0gQzMuUmVxdWlyZU9wdGlvbmFsT2JqZWN0OwogICAgQzNYLlJlcXVpcmVBcnJheSA9IEMzLlJlcXVpcmVBcnJheTsKICAgIEMzWC5SZXF1aXJlT3B0aW9uYWxBcnJheSA9IEMzLlJlcXVpcmVPcHRpb25hbEFycmF5OwogICAgQzNYLlJlcXVpcmVGdW5jdGlvbiA9IEMzLlJlcXVpcmVGdW5jdGlvbjsKICAgIEMzWC5SZXF1aXJlT3B0aW9uYWxGdW5jdGlvbiA9IEMzLlJlcXVpcmVPcHRpb25hbEZ1bmN0aW9uOwogICAgQzNYLlJlcXVpcmVJbnN0YW5jZU9mID0gQzMuUmVxdWlyZUluc3RhbmNlT2Y7CiAgICBDM1guUmVxdWlyZU9wdGlvbmFsSW5zdGFuY2VPZiA9IEMzLlJlcXVpcmVPcHRpb25hbEluc3RhbmNlT2Y7CiAgICBDM1guSXNOdWxsT3JVbmRlZmluZWQgPSBDMy5Jc051bGxPclVuZGVmaW5lZDsKCn0KCi8vIC4uL2xpYi9taXNjL2pzdXRpbC5qcwp7CiAgICAndXNlIHN0cmljdCc7CiAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICBjb25zdCBsb2dSYWZJZHMgPSBuZXcgTWFwOwogICAgQzMuQ29sb3JMb2cgPSBmdW5jdGlvbihtZXNzYWdlLCBjb2xvcikgewogICAgICAgIGNvbnNvbGUubG9nKGAlYyR7bWVzc2FnZX1gLCBgZm9udC13ZWlnaHQ6IGJvbGQ7IGNvbG9yOiR7Y29sb3J9YCkKICAgIH07CiAgICBDMy5SYWZMb2cgPSBmdW5jdGlvbiBSYUZMb2cobmFtZSwgLi4uYXJncykgewogICAgICAgIGlmICghbG9nUmFmSWRzLmhhcyhuYW1lKSkgbG9nUmFmSWRzLnNldChuYW1lLCAtMSk7CiAgICAgICAgaWYgKGxvZ1JhZklkcy5nZXQobmFtZSkgPT09IC0xKSBsb2dSYWZJZHMuc2V0KG5hbWUsIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGAlYyR7bmFtZX1gLCAiZm9udC13ZWlnaHQ6IGJvbGQiLCAuLi5hcmdzKTsKICAgICAgICAgICAgbG9nUmFmSWRzLnNldChuYW1lLCAtMSkKICAgICAgICB9KSkKICAgIH07CiAgICBsZXQgbWVhc3VyZXM7CiAgICBDMy5TdGFydE1lYXN1cmUgPSBmdW5jdGlvbiBTdGFydE1lYXN1cmUobmFtZSkgewogICAgICAgIHBlcmZvcm1hbmNlLm1hcmsobmFtZSk7CiAgICAgICAgaWYgKCFtZWFzdXJlcykgbWVhc3VyZXMgPSBuZXcgTWFwOwogICAgICAgIGlmICghbWVhc3VyZXMuaGFzKG5hbWUpKSBtZWFzdXJlcy5zZXQobmFtZSwgewogICAgICAgICAgICBjdXJyZW50OiAwLAogICAgICAgICAgICB0b3RhbDogMCwKICAgICAgICAgICAgYXZlcmFnZTogMCwKICAgICAgICAgICAgY2FsbHM6IDEsCiAgICAgICAgICAgIHRvU3RyaW5nOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBgJHtuYW1lfSA6OiBjdXJyZW50ID0+ICR7dGhpcy5jdXJyZW50LnRvUHJlY2lzaW9uKDMpfSA6OiBhdmVyYWdlID0+ICR7dGhpcy5hdmVyYWdlLnRvUHJlY2lzaW9uKDMpfSA6OiBjYWxscyA9PiAke3RoaXMuY2FsbHN9YAogICAgICAgICAgICB9CiAgICAgICAgfSkKICAgIH07CiAgICBDMy5FbmRNZWFzdXJlID0gZnVuY3Rpb24gRW5kTWVhc3VyZShuYW1lKSB7CiAgICAgICAgcGVyZm9ybWFuY2UubWVhc3VyZShgbWVhc3VyZS0ke25hbWV9YCwgbmFtZSk7CiAgICAgICAgY29uc3QgZW50cnkgPSBwZXJmb3JtYW5jZS5nZXRFbnRyaWVzQnlOYW1lKGBtZWFzdXJlLSR7bmFtZX1gKVswXTsKICAgICAgICBjb25zdCBtID0gbWVhc3VyZXMuZ2V0KG5hbWUpOwogICAgICAgIG0uY3VycmVudCA9IGVudHJ5LmR1cmF0aW9uOwogICAgICAgIG0udG90YWwgKz0gbS5jdXJyZW50OwogICAgICAgIG0uYXZlcmFnZSA9IG0udG90YWwgLyBtLmNhbGxzOwogICAgICAgIGNvbnNvbGUubG9nKG0udG9TdHJpbmcoKSk7CiAgICAgICAgbS5jYWxscysrOwogICAgICAgIHBlcmZvcm1hbmNlLmNsZWFyTWFya3MobmFtZSk7CiAgICAgICAgcGVyZm9ybWFuY2UuY2xlYXJNZWFzdXJlcyhgbWVhc3VyZS0ke25hbWV9YCkKICAgIH07CiAgICBDMy5HZXRDYWxsU3RhY2sgPSBmdW5jdGlvbiBHZXRDYWxsU3RhY2soKSB7CiAgICAgICAgcmV0dXJuIChuZXcgRXJyb3IpLnN0YWNrCiAgICB9OwogICAgQzMuRGVidWdnZXIgPSBmdW5jdGlvbiBEZWJ1Z2dlcigpIHsKICAgICAgICBkZWJ1Z2dlcgogICAgfTsKICAgIEMzLmNhc3QgPSBmdW5jdGlvbiBjYXN0KG8sIFQpIHsKICAgICAgICBpZiAobyAmJiBvIGluc3RhbmNlb2YgVCkgcmV0dXJuIG87CiAgICAgICAgZWxzZSByZXR1cm4gbnVsbAogICAgfTsKICAgIEMzLmdldE5hbWUgPSBmdW5jdGlvbiBnZXROYW1lKG8pIHsKICAgICAgICBpZiAodHlwZW9mIG8gPT09ICJ1bmRlZmluZWQiKSByZXR1cm4gInVuZGVmaW5lZCI7CiAgICAgICAgaWYgKG8gPT09IG51bGwpIHJldHVybiAibnVsbCI7CiAgICAgICAgaWYgKHR5cGVvZiBvID09PSAiYm9vbGVhbiIpIHJldHVybiAiPGJvb2xlYW4+IjsKICAgICAgICBpZiAoQzMuSXNOdW1iZXIobykpIHJldHVybiAiPG51bWJlcj4iOwogICAgICAgIGlmIChDMy5Jc1N0cmluZyhvKSkgcmV0dXJuICI8c3RyaW5nPiI7CiAgICAgICAgaWYgKEMzLklzQXJyYXkobykpIHJldHVybiAiPGFycmF5PiI7CiAgICAgICAgaWYgKHR5cGVvZiBvID09PSAic3ltYm9sIikgcmV0dXJuICI8IiArIG8udG9TdHJpbmcoKSArICI+IjsKICAgICAgICBpZiAoQzMuSXNGdW5jdGlvbihvKSkgewogICAgICAgICAgICBpZiAoby5uYW1lICYmIG8ubmFtZSAhPT0gIkZ1bmN0aW9uIikgcmV0dXJuIG8ubmFtZTsKICAgICAgICAgICAgcmV0dXJuICI8YW5vbnltb3VzIGZ1bmN0aW9uPiIKICAgICAgICB9CiAgICAgICAgaWYgKHR5cGVvZiBvID09PSAib2JqZWN0IikgewogICAgICAgICAgICBpZiAoby5jb25zdHJ1Y3RvciAmJiBvLmNvbnN0cnVjdG9yLm5hbWUgJiYgby5jb25zdHJ1Y3Rvci5uYW1lICE9PSAiT2JqZWN0IikgcmV0dXJuIG8uY29uc3RydWN0b3IubmFtZTsKICAgICAgICAgICAgcmV0dXJuICI8YW5vbnltb3VzIG9iamVjdD4iCiAgICAgICAgfQogICAgICAgIHJldHVybiAiPHVua25vd24+IgogICAgfTsKICAgIEMzLmdldFR5cGUgPSBmdW5jdGlvbiBnZXRUeXBlKG8pIHsKICAgICAgICBpZiAobyA9PT0gbnVsbCkgcmV0dXJuICJudWxsIjsKICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShvKSkgcmV0dXJuICJhcnJheSI7CiAgICAgICAgcmV0dXJuIHR5cGVvZiBvCiAgICB9OwogICAgQzMucmFuZ2UgPSBmdW5jdGlvbiogcmFuZ2UoYSwgYikgewogICAgICAgIGlmICghaXNGaW5pdGUoTWF0aC5hYnMoYSAtIGIpKSkgdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIHBhcmFtZXRlcnMiKTsKICAgICAgICBpZiAoYSA+IGIpCiAgICAgICAgICAgIGZvciAobGV0IGkgPSBhIC0gMTsgaSA+PSBiOyBpLS0pIHlpZWxkIGk7CiAgICAgICAgZWxzZQogICAgICAgICAgICBmb3IgKGxldCBpID0gYTsgaSA8IGI7IGkrKykgeWllbGQgaQogICAgfTsKCiAgICBmdW5jdGlvbiBpc1ZhbGlkVHlwZUNoYW5nZShmcm9tLCB0bykgewogICAgICAgIGxldCBmcm9tVHlwZSA9IEMzLmdldFR5cGUoZnJvbSk7CiAgICAgICAgbGV0IHRvVHlwZSA9IEMzLmdldFR5cGUodG8pOwogICAgICAgIGlmIChmcm9tVHlwZSA9PT0gIm51bGwiIHx8IHRvVHlwZSA9PT0gIm51bGwiKSByZXR1cm4gdHJ1ZTsKICAgICAgICBpZiAoZnJvbVR5cGUgPT09ICJ1bmRlZmluZWQiIHx8IHRvVHlwZSA9PT0gInVuZGVmaW5lZCIpIHJldHVybiBmYWxzZTsKICAgICAgICByZXR1cm4gZnJvbVR5cGUgPT09IHRvVHlwZQogICAgfQogICAgbGV0IGN0b3JPYmplY3RUb1Byb3h5ID0gbmV3IE1hcDsKICAgIGxldCBjdG9yUHJveHlUb09iamVjdCA9IG5ldyBNYXA7CiAgICBsZXQgcHJveHlUb09iamVjdCA9IG5ldyBXZWFrTWFwOwogICAgbGV0IHJlbGVhc2VkT2JqZWN0cyA9IG5ldyBXZWFrTWFwOwogICAgQzMuRGVmZW5kSGFuZGxlciA9IHt9OwogICAgY29uc3QgVkFMSURfR0VUX01JU1NJTkdfS0VZUyA9IG5ldyBTZXQoWyJ0aGVuIiwgInNwbGljZSJdKTsKCiAgICBmdW5jdGlvbiBsb2dEZWZlbmRlZE9iamVjdFdhcm5pbmcobXNnKSB7CiAgICAgICAgY29uc29sZS53YXJuKCJbRGVmZW5jZV0gIiArIG1zZyArICIgQCIsIEMzLkdldENhbGxTdGFjaygpKQogICAgfQogICAgQzMuRGVmZW5kSGFuZGxlci5nZXQgPSBmdW5jdGlvbiBkZWZlbmRlZF9nZXQodGFyZ2V0LCBrZXkpIHsKICAgICAgICBpZiAoIShrZXkgaW4gdGFyZ2V0KSAmJiB0eXBlb2Yga2V5ICE9PSAic3ltYm9sIiAmJiAhVkFMSURfR0VUX01JU1NJTkdfS0VZUy5oYXMoa2V5KSkgbG9nRGVmZW5kZWRPYmplY3RXYXJuaW5nKGBBY2Nlc3NlZCBtaXNzaW5nIHByb3BlcnR5ICcke2tleX0nIGZyb20gZGVmZW5kZWQgb2JqZWN0ICcke0MzLmdldE5hbWUodGFyZ2V0KX0nLCByZXR1cm5pbmcgdW5kZWZpbmVkYCk7CiAgICAgICAgaWYgKHJlbGVhc2VkT2JqZWN0cy5oYXModGFyZ2V0KSAmJiB0eXBlb2Yga2V5ICE9PSAic3ltYm9sIiAmJiAhVkFMSURfR0VUX01JU1NJTkdfS0VZUy5oYXMoa2V5KSkgbG9nRGVmZW5kZWRPYmplY3RXYXJuaW5nKGBBY2Nlc3NlZCBwcm9wZXJ0eSAnJHtrZXl9JyBvbiBhIHJlbGVhc2VkIG9iamVjdCAnJHtDMy5nZXROYW1lKHRhcmdldCl9J1xuT2JqZWN0IHdhcyBvcmlnaW5hbGx5IHJlbGVhc2VkIGF0OiAke3JlbGVhc2VkT2JqZWN0cy5nZXQodGFyZ2V0KX0pXG5DYWxsIHN0YWNrIGF0IGFjY2VzczogYCk7CiAgICAgICAgcmV0dXJuIHRhcmdldFtrZXldCiAgICB9OwogICAgQzMuRGVmZW5kSGFuZGxlci5zZXQgPSBmdW5jdGlvbiBkZWZlbmRlZF9zZXQodGFyZ2V0LCBrZXksIHZhbHVlKSB7CiAgICAgICAgaWYgKCEoa2V5IGluIHRhcmdldCkgJiYgIWN0b3JPYmplY3RUb1Byb3h5Lmhhcyh0YXJnZXQpKSBsb2dEZWZlbmRlZE9iamVjdFdhcm5pbmcoYFNldCBub24tZXhpc3RlbnQgcHJvcGVydHkgJyR7a2V5fScgdG8gJyR7dmFsdWV9JyBvbiBkZWZlbmRlZCBvYmplY3QgJyR7QzMuZ2V0TmFtZSh0YXJnZXQpfSdgKTsKICAgICAgICBpZiAoIWlzVmFsaWRUeXBlQ2hhbmdlKHRhcmdldFtrZXldLCB2YWx1ZSkgJiYgIWN0b3JPYmplY3RUb1Byb3h5Lmhhcyh0YXJnZXQpKSBsb2dEZWZlbmRlZE9iamVjdFdhcm5pbmcoYFNldCAnJHtDMy5nZXRUeXBlKHRhcmdldFtrZXldKX0nIHByb3BlcnR5ICcke2tleX0nIHRvIHR5cGUgJyR7QzMuZ2V0VHlwZSh2YWx1ZSl9JyBvbiBkZWZlbmRlZCBvYmplY3QgJyR7QzMuZ2V0TmFtZSh0YXJnZXQpfSdgKTsKICAgICAgICBpZiAocmVsZWFzZWRPYmplY3RzLmhhcyh0YXJnZXQpKSBsb2dEZWZlbmRlZE9iamVjdFdhcm5pbmcoYFNldCBwcm9wZXJ0eSAnJHtrZXl9JyBvbiBhIHJlbGVhc2VkIG9iamVjdCAnJHtDMy5nZXROYW1lKHRhcmdldCl9J1xuT2JqZWN0IHdhcyBvcmlnaW5hbGx5IHJlbGVhc2VkIGF0OiAke3JlbGVhc2VkT2JqZWN0cy5nZXQodGFyZ2V0KX0pXG5DYWxsIHN0YWNrIGF0IGFjY2VzczogYCk7CiAgICAgICAgdGFyZ2V0W2tleV0gPSB2YWx1ZTsKICAgICAgICByZXR1cm4gdHJ1ZQogICAgfTsKICAgIEMzLkRlZmVuZEhhbmRsZXIuZGVsZXRlUHJvcGVydHkgPSBmdW5jdGlvbiBkZWZlbmRlZF9kZWxldGVQcm9wZXJ0eSh0YXJnZXQsIGtleSkgewogICAgICAgIHRocm93IG5ldyBSZWZlcmVuY2VFcnJvcihgQ2Fubm90IGRlbGV0ZSBwcm9wZXJ0eSAnJHtrZXl9JyBmcm9tIGRlZmVuZGVkIG9iamVjdCAnJHtDMy5nZXROYW1lKHRhcmdldCl9J2ApOwogICAgfTsKICAgIEMzLkRlZmVuZEhhbmRsZXIuZGVmaW5lUHJvcGVydHkgPSBmdW5jdGlvbiBkZWZlbmRlZF9kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgZGVzYykgewogICAgICAgIHRocm93IG5ldyBSZWZlcmVuY2VFcnJvcihgQ2Fubm90IGRlZmluZSBwcm9wZXJ0eSAnJHtrZXl9JyBvbiBkZWZlbmRlZCBvYmplY3QgJyR7QzMuZ2V0TmFtZSh0YXJnZXQpfSdgKTsKICAgIH07CiAgICBDMy5EZWZlbmRIYW5kbGVyLmVudW1lcmF0ZSA9IGZ1bmN0aW9uIGRlZmVuZGVkX2VudW1lcmF0ZSh0YXJnZXQpIHsKICAgICAgICB0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoYENhbm5vdCBlbnVtZXJhdGUgZGVmZW5kZWQgb2JqZWN0ICcke0MzLmdldE5hbWUodGFyZ2V0KX0nYCk7CiAgICB9OwogICAgbGV0IGNoZWNrUmFmSWQgPSAtMTsKCiAgICBmdW5jdGlvbiBDaGVja0RlZmVuZGVkT2JqZWN0c1VzZWRDb3JyZWN0bHkoKSB7CiAgICAgICAgY2hlY2tSYWZJZCA9IC0xOwogICAgICAgIGlmIChjdG9yT2JqZWN0VG9Qcm94eS5zaXplID4gMCB8fCBjdG9yUHJveHlUb09iamVjdC5zaXplID4gMCkgewogICAgICAgICAgICBsZXQgdW5pcXVlTmFtZXMgPSBuZXcgU2V0KFsuLi5jdG9yT2JqZWN0VG9Qcm94eS5rZXlzKCldLm1hcChvID0+IEMzLmdldE5hbWUobykpKTsKICAgICAgICAgICAgbGV0IGxlZnRvdmVyTmFtZXMgPSBbLi4udW5pcXVlTmFtZXNdLmpvaW4oIiwiKTsKICAgICAgICAgICAgY29uc29sZS53YXJuKGBBbiBvYmplY3QgZGVyaXZlZCBmcm9tIERlZmVuZGVkQmFzZSB3YXMgbm90IHByb3RlY3RlZCB3aXRoIGRlYnVnRGVmZW5kKCkuIFRoaXMgd2lsbCBkaXNhYmxlIHNvbWUgY2hlY2tzLiBTZWUgdGhlIGNvZGluZyBndWlkZWxpbmVzISBQb3NzaWJsZSBhZmZlY3RlZCBjbGFzcyBuYW1lczogJHtsZWZ0b3Zlck5hbWVzfWApOwogICAgICAgICAgICBjdG9yT2JqZWN0VG9Qcm94eS5jbGVhcigpOwogICAgICAgICAgICBjdG9yUHJveHlUb09iamVjdC5jbGVhcigpCiAgICAgICAgfQogICAgfQogICAgQzMuRGVmZW5kZWRCYXNlID0gY2xhc3MgRGVmZW5kZWRCYXNlIHsKICAgICAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgICAgICAgaWYgKCFDMy5pc0RlYnVnRGVmZW5kIHx8ICFDMy5TdXBwb3J0cy5Qcm94aWVzKSByZXR1cm47CiAgICAgICAgICAgIGxldCBuZXdUYXJnZXQgPSBuZXcudGFyZ2V0OwogICAgICAgICAgICBsZXQgcmVhbE9iamVjdCA9IE9iamVjdC5jcmVhdGUobmV3VGFyZ2V0LnByb3RvdHlwZSk7CiAgICAgICAgICAgIGxldCBwcm94eSA9IG5ldyBQcm94eShyZWFsT2JqZWN0LCBDMy5EZWZlbmRIYW5kbGVyKTsKICAgICAgICAgICAgY3Rvck9iamVjdFRvUHJveHkuc2V0KHJlYWxPYmplY3QsIHByb3h5KTsKICAgICAgICAgICAgY3RvclByb3h5VG9PYmplY3Quc2V0KHByb3h5LCByZWFsT2JqZWN0KTsKICAgICAgICAgICAgcHJveHlUb09iamVjdC5zZXQocHJveHksIHJlYWxPYmplY3QpOwogICAgICAgICAgICBpZiAoY2hlY2tSYWZJZCA9PT0gLTEpIGNoZWNrUmFmSWQgPSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoQ2hlY2tEZWZlbmRlZE9iamVjdHNVc2VkQ29ycmVjdGx5KTsKICAgICAgICAgICAgcmV0dXJuIHByb3h5CiAgICAgICAgfQogICAgfTsKICAgIEMzLmRlYnVnRGVmZW5kID0gZnVuY3Rpb24gZGVidWdEZWZlbmQobykgewogICAgICAgIGlmIChDMy5pc0RlYnVnRGVmZW5kICYmIEMzLlN1cHBvcnRzLlByb3hpZXMgJiYgbyBpbnN0YW5jZW9mIEMzLkRlZmVuZGVkQmFzZSkgewogICAgICAgICAgICBpZiAoIWN0b3JQcm94eVRvT2JqZWN0LmhhcyhvKSkgcmV0dXJuIG87CiAgICAgICAgICAgIGxldCByZWFsT2JqZWN0ID0gY3RvclByb3h5VG9PYmplY3QuZ2V0KG8pOwogICAgICAgICAgICBjdG9yUHJveHlUb09iamVjdC5kZWxldGUobyk7CiAgICAgICAgICAgIGN0b3JPYmplY3RUb1Byb3h5LmRlbGV0ZShyZWFsT2JqZWN0KTsKICAgICAgICAgICAgcmV0dXJuIG8KICAgICAgICB9IGVsc2UgaWYgKEMzLmlzRGVidWcpIHJldHVybiBPYmplY3Quc2VhbChvKTsKICAgICAgICBlbHNlIHJldHVybiBvCiAgICB9OwogICAgQzMuTmV3ID0gZnVuY3Rpb24gTmV3KFR5cGUsIC4uLmFyZ3MpIHsKICAgICAgICBsZXQgbzsKICAgICAgICB0cnkgewogICAgICAgICAgICBvID0gbmV3IFR5cGUoLi4uYXJncykKICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIGN0b3JQcm94eVRvT2JqZWN0LmNsZWFyKCk7CiAgICAgICAgICAgIGN0b3JPYmplY3RUb1Byb3h5LmNsZWFyKCk7CiAgICAgICAgICAgIHRocm93IGU7CiAgICAgICAgfQogICAgICAgIGlmIChDMy5pc0RlYnVnRGVmZW5kKSBWZXJpZnlPYmplY3RQcm9wZXJ0aWVzQ29uc2lzdGVudChUeXBlLCBvKTsKICAgICAgICByZXR1cm4gQzMuZGVidWdEZWZlbmQobykKICAgIH07CiAgICBDMy5SZWxlYXNlID0gZnVuY3Rpb24gUmVsZWFzZShvKSB7CiAgICAgICAgbGV0IHJlYWxPYmplY3QgPSBwcm94eVRvT2JqZWN0LmdldChvKTsKICAgICAgICBpZiAocmVhbE9iamVjdCkgcmVsZWFzZWRPYmplY3RzLnNldChyZWFsT2JqZWN0LCBDMy5HZXRDYWxsU3RhY2soKSkKICAgIH07CiAgICBDMy5XYXNSZWxlYXNlZCA9IGZ1bmN0aW9uKG8pIHsKICAgICAgICBsZXQgcmVhbE9iamVjdCA9IHByb3h5VG9PYmplY3QuZ2V0KG8pOwogICAgICAgIGlmICghcmVhbE9iamVjdCkgcmV0dXJuIGZhbHNlOwogICAgICAgIHJldHVybiAhIXJlbGVhc2VkT2JqZWN0cy5nZXQocmVhbE9iamVjdCkKICAgIH07CiAgICBsZXQgdHlwZVByb3BlcnRpZXMgPSBuZXcgTWFwOwoKICAgIGZ1bmN0aW9uIGdldE9iamVjdFByb3BlcnR5U2V0KG8pIHsKICAgICAgICBsZXQgcmV0ID0gbmV3IFNldDsKICAgICAgICBmb3IgKGxldCBrIGluIG8pIHJldC5hZGQoayk7CiAgICAgICAgcmV0dXJuIHJldAogICAgfQoKICAgIGZ1bmN0aW9uIFZlcmlmeU9iamVjdFByb3BlcnRpZXNDb25zaXN0ZW50KFR5cGUsIG8pIHsKICAgICAgICBsZXQgcHJvcGVydGllcyA9IGdldE9iamVjdFByb3BlcnR5U2V0KG8pOwogICAgICAgIGxldCBleGlzdGluZ1Byb3BlcnRpZXMgPSB0eXBlUHJvcGVydGllcy5nZXQoVHlwZSk7CiAgICAgICAgaWYgKGV4aXN0aW5nUHJvcGVydGllcykgewogICAgICAgICAgICBsZXQgaW5jb25zaXN0ZW50UHJvcGVydGllcyA9IFtdOwogICAgICAgICAgICBmb3IgKGxldCBrIG9mIGV4aXN0aW5nUHJvcGVydGllcy52YWx1ZXMoKSkKICAgICAgICAgICAgICAgIGlmIChwcm9wZXJ0aWVzLmhhcyhrKSkgcHJvcGVydGllcy5kZWxldGUoayk7CiAgICAgICAgICAgICAgICBlbHNlIGluY29uc2lzdGVudFByb3BlcnRpZXMucHVzaChrKTsKICAgICAgICAgICAgQzMuYXBwZW5kQXJyYXkoaW5jb25zaXN0ZW50UHJvcGVydGllcywgWy4uLnByb3BlcnRpZXNdKTsKICAgICAgICAgICAgaWYgKGluY29uc2lzdGVudFByb3BlcnRpZXMubGVuZ3RoKSBjb25zb2xlLndhcm4oYFtEZWZlbmNlXSAnJHtDMy5nZXROYW1lKFR5cGUpfScgY29uc3RydWN0b3IgY3JlYXRlcyBpbmNvbnNpc3RlbnQgcHJvcGVydGllczogJHtpbmNvbnNpc3RlbnRQcm9wZXJ0aWVzLmpvaW4oIiwgIil9YCkKICAgICAgICB9IGVsc2UgdHlwZVByb3BlcnRpZXMuc2V0KFR5cGUsIHByb3BlcnRpZXMpCiAgICB9CiAgICBDMy5QZXJmTWFyayA9IGNsYXNzIFBlcmZNYXJrIHsKICAgICAgICBjb25zdHJ1Y3RvcihuYW1lKSB7CiAgICAgICAgICAgIHRoaXMuX25hbWUgPSAiIjsKICAgICAgICAgICAgaWYgKG5hbWUpIHRoaXMuc3RhcnQobmFtZSkKICAgICAgICB9CiAgICAgICAgc3RhcnQobmFtZSkgewogICAgICAgICAgICBpZiAoIUMzLmlzUGVyZm9ybWFuY2VQcm9maWxpbmcpIHJldHVybjsKICAgICAgICAgICAgdGhpcy5fbmFtZSA9IG5hbWU7CiAgICAgICAgICAgIHBlcmZvcm1hbmNlLm1hcmsodGhpcy5fbmFtZSArICItU3RhcnQiKQogICAgICAgIH0KICAgICAgICBlbmQoKSB7CiAgICAgICAgICAgIGlmICghQzMuaXNQZXJmb3JtYW5jZVByb2ZpbGluZykgcmV0dXJuOwogICAgICAgICAgICBwZXJmb3JtYW5jZS5tYXJrKHRoaXMuX25hbWUgKyAiLUVuZCIpOwogICAgICAgICAgICBwZXJmb3JtYW5jZS5tZWFzdXJlKHRoaXMuX25hbWUsIHRoaXMuX25hbWUgKyAiLVN0YXJ0IiwgdGhpcy5fbmFtZSArICItRW5kIikKICAgICAgICB9CiAgICAgICAgbmV4dChuYW1lKSB7CiAgICAgICAgICAgIGlmICghQzMuaXNQZXJmb3JtYW5jZVByb2ZpbGluZykgcmV0dXJuOwogICAgICAgICAgICB0aGlzLmVuZCgpOwogICAgICAgICAgICB0aGlzLl9uYW1lID0gbmFtZTsKICAgICAgICAgICAgcGVyZm9ybWFuY2UubWFyayh0aGlzLl9uYW1lICsgIi1TdGFydCIpCiAgICAgICAgfQogICAgfTsKCn0KCi8vIC4uL2xpYi9taXNjL21hdGh1dGlsLmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIGNvbnN0IFRXT19QSSA9IE1hdGguUEkgKiAyOwogICAgY29uc3QgRF9UT19SID0gTWF0aC5QSSAvIDE4MDsKICAgIGNvbnN0IFJfVE9fRCA9IDE4MCAvIE1hdGguUEk7CiAgICBDMy53cmFwID0gZnVuY3Rpb24gd3JhcCh4LCBtaW4sIG1heCkgewogICAgICAgIHggPSBNYXRoLmZsb29yKHgpOwogICAgICAgIG1pbiA9IE1hdGguZmxvb3IobWluKTsKICAgICAgICBtYXggPSBNYXRoLmZsb29yKG1heCk7CiAgICAgICAgY29uc3QgZGlmZiA9IG1heCAtIG1pbjsKICAgICAgICBpZiAoZGlmZiA9PT0gMCkgcmV0dXJuIG1heDsKICAgICAgICBpZiAoeCA8IG1pbikgewogICAgICAgICAgICBjb25zdCByID0gbWF4IC0gKG1pbiAtIHgpICUgZGlmZjsKICAgICAgICAgICAgcmV0dXJuIHIgPT09IG1heCA/IDAgOiByCiAgICAgICAgfSBlbHNlIHJldHVybiBtaW4gKyAoeCAtIG1pbikgJSBkaWZmCiAgICB9OwogICAgQzMubWFwVG9SYW5nZSA9IGZ1bmN0aW9uIG1hcFRvUmFuZ2UoeCwgaW5NaW4sIGluTWF4LCBvdXRNaW4sIG91dE1heCkgewogICAgICAgIHJldHVybiAoeCAtIGluTWluKSAqIChvdXRNYXggLSBvdXRNaW4pIC8gKGluTWF4IC0gaW5NaW4pICsgb3V0TWluCiAgICB9OwogICAgQzMubm9ybWFsaXplID0gZnVuY3Rpb24gbm9ybWFsaXplKHZhbHVlLCBtaW5pbXVtLCBtYXhpbXVtKSB7CiAgICAgICAgcmV0dXJuICh2YWx1ZSAtIG1pbmltdW0pIC8gKG1heGltdW0gLSBtaW5pbXVtKQogICAgfTsKICAgIEMzLmNsYW1wID0gZnVuY3Rpb24gY2xhbXAoeCwgYSwgYikgewogICAgICAgIGlmICh4IDwgYSkgcmV0dXJuIGE7CiAgICAgICAgZWxzZSBpZiAoeCA+IGIpIHJldHVybiBiOwogICAgICAgIGVsc2UgcmV0dXJuIHgKICAgIH07CiAgICBDMy5jbGFtcEFuZ2xlID0gZnVuY3Rpb24gY2xhbXBBbmdsZShhKSB7CiAgICAgICAgYSAlPSBUV09fUEk7CiAgICAgICAgaWYgKGEgPCAwKSBhICs9IFRXT19QSTsKICAgICAgICByZXR1cm4gYQogICAgfTsKICAgIEMzLnRvUmFkaWFucyA9IGZ1bmN0aW9uIHRvUmFkaWFucyh4KSB7CiAgICAgICAgcmV0dXJuIHggKiBEX1RPX1IKICAgIH07CiAgICBDMy50b0RlZ3JlZXMgPSBmdW5jdGlvbiB0b0RlZ3JlZXMoeCkgewogICAgICAgIHJldHVybiB4ICogUl9UT19ECiAgICB9OwogICAgQzMuZGlzdGFuY2VUbyA9IGZ1bmN0aW9uIGRpc3RhbmNlVG8oeDEsIHkxLCB4MiwgeTIpIHsKICAgICAgICByZXR1cm4gTWF0aC5oeXBvdCh4MiAtIHgxLCB5MiAtIHkxKQogICAgfTsKICAgIEMzLmRpc3RhbmNlU3F1YXJlZCA9IGZ1bmN0aW9uIGRpc3RhbmNlU3F1YXJlZCh4MSwgeTEsIHgyLCB5MikgewogICAgICAgIGNvbnN0IGR4ID0geDIgLSB4MTsKICAgICAgICBjb25zdCBkeSA9IHkyIC0geTE7CiAgICAgICAgcmV0dXJuIGR4ICogZHggKyBkeSAqIGR5CiAgICB9OwogICAgQzMuYW5nbGVUbyA9IGZ1bmN0aW9uIGFuZ2xlVG8oeDEsIHkxLCB4MiwgeTIpIHsKICAgICAgICByZXR1cm4gTWF0aC5hdGFuMih5MiAtIHkxLCB4MiAtIHgxKQogICAgfTsKICAgIEMzLmFuZ2xlRGlmZiA9IGZ1bmN0aW9uIGFuZ2xlRGlmZihhMSwgYTIpIHsKICAgICAgICBpZiAoYTEgPT09IGEyKSByZXR1cm4gMDsKICAgICAgICBsZXQgczEgPSBNYXRoLnNpbihhMSk7CiAgICAgICAgbGV0IGMxID0gTWF0aC5jb3MoYTEpOwogICAgICAgIGxldCBzMiA9IE1hdGguc2luKGEyKTsKICAgICAgICBsZXQgYzIgPSBNYXRoLmNvcyhhMik7CiAgICAgICAgbGV0IG4gPSBzMSAqIHMyICsgYzEgKiBjMjsKICAgICAgICBpZiAobiA+PSAxKSByZXR1cm4gMDsKICAgICAgICBpZiAobiA8PSAtMSkgcmV0dXJuIE1hdGguUEk7CiAgICAgICAgcmV0dXJuIE1hdGguYWNvcyhuKQogICAgfTsKICAgIEMzLmFuZ2xlUm90YXRlID0gZnVuY3Rpb24gYW5nbGVSb3RhdGUoc3RhcnQsIGVuZCwgc3RlcCkgewogICAgICAgIGxldCBzcyA9IE1hdGguc2luKHN0YXJ0KTsKICAgICAgICBsZXQgY3MgPSBNYXRoLmNvcyhzdGFydCk7CiAgICAgICAgbGV0IHNlID0gTWF0aC5zaW4oZW5kKTsKICAgICAgICBsZXQgY2UgPSBNYXRoLmNvcyhlbmQpOwogICAgICAgIGlmIChNYXRoLmFjb3Moc3MgKiBzZSArIGNzICogY2UpID4gc3RlcCkKICAgICAgICAgICAgaWYgKGNzICogc2UgLSBzcyAqIGNlID4gMCkgcmV0dXJuIEMzLmNsYW1wQW5nbGUoc3RhcnQgKyBzdGVwKTsKICAgICAgICAgICAgZWxzZSByZXR1cm4gQzMuY2xhbXBBbmdsZShzdGFydCAtIHN0ZXApOwogICAgICAgIGVsc2UgcmV0dXJuIEMzLmNsYW1wQW5nbGUoZW5kKQogICAgfTsKICAgIEMzLmFuZ2xlQ2xvY2t3aXNlID0gZnVuY3Rpb24gYW5nbGVDbG9ja3dpc2UoYTEsIGEyKSB7CiAgICAgICAgbGV0IHMxID0gTWF0aC5zaW4oYTEpOwogICAgICAgIGxldCBjMSA9IE1hdGguY29zKGExKTsKICAgICAgICBsZXQgczIgPSBNYXRoLnNpbihhMik7CiAgICAgICAgbGV0IGMyID0gTWF0aC5jb3MoYTIpOwogICAgICAgIHJldHVybiBjMSAqIHMyIC0gczEgKiBjMiA8PSAwCiAgICB9OwogICAgQzMuYW5nbGVMZXJwID0gZnVuY3Rpb24gYW5nbGVMZXJwKGEsIGIsIHgsIHIgPSAwKSB7CiAgICAgICAgbGV0IGRpZmYgPSBDMy5hbmdsZURpZmYoYSwgYik7CiAgICAgICAgY29uc3QgcmV2cyA9IFRXT19QSSAqIHI7CiAgICAgICAgaWYgKEMzLmFuZ2xlQ2xvY2t3aXNlKGIsIGEpKSByZXR1cm4gQzMuY2xhbXBBbmdsZShhICsgKGRpZmYgKyByZXZzKSAqIHgpOwogICAgICAgIGVsc2UgcmV0dXJuIEMzLmNsYW1wQW5nbGUoYSAtIChkaWZmICsgcmV2cykgKiB4KQogICAgfTsKICAgIEMzLmFuZ2xlTGVycENsb2Nrd2lzZSA9IGZ1bmN0aW9uIGFuZ2xlTGVycENsb2Nrd2lzZShhLCBiLCB4LCByID0gMCkgewogICAgICAgIGNvbnN0IGRpZmYgPSBDMy5hbmdsZURpZmYoYSwgYik7CiAgICAgICAgY29uc3QgcmV2cyA9IFRXT19QSSAqIHI7CiAgICAgICAgaWYgKEMzLmFuZ2xlQ2xvY2t3aXNlKGIsIGEpKSByZXR1cm4gQzMuY2xhbXBBbmdsZShhICsgKGRpZmYgKyByZXZzKSAqIHgpOwogICAgICAgIHJldHVybiBDMy5jbGFtcEFuZ2xlKGEgKyAoVFdPX1BJIC0gZGlmZiArIHJldnMpICogeCkKICAgIH07CiAgICBDMy5hbmdsZUxlcnBBbnRpQ2xvY2t3aXNlID0gZnVuY3Rpb24gYW5nbGVMZXJwQW50aUNsb2Nrd2lzZShhLCBiLCB4LCByID0gMCkgewogICAgICAgIGNvbnN0IGRpZmYgPSBDMy5hbmdsZURpZmYoYSwgYik7CiAgICAgICAgY29uc3QgcmV2cyA9IFRXT19QSSAqIHI7CiAgICAgICAgaWYgKEMzLmFuZ2xlQ2xvY2t3aXNlKGIsIGEpKSByZXR1cm4gQzMuY2xhbXBBbmdsZShhIC0gKC1UV09fUEkgKyBkaWZmIC0gcmV2cykgKiB4KTsKICAgICAgICByZXR1cm4gQzMuY2xhbXBBbmdsZShhIC0gKGRpZmYgKyByZXZzKSAqIHgpCiAgICB9OwogICAgQzMuYW5nbGVSZWZsZWN0ID0gZnVuY3Rpb24gYW5nbGVSZWZsZWN0KGEsIGIpIHsKICAgICAgICBjb25zdCBkaWZmID0gQzMuYW5nbGVEaWZmKGEsIGIpOwogICAgICAgIGlmIChDMy5hbmdsZUNsb2Nrd2lzZShhLCBiKSkgcmV0dXJuIEMzLmNsYW1wQW5nbGUoYiAtIGRpZmYpOwogICAgICAgIGVsc2UgcmV0dXJuIEMzLmNsYW1wQW5nbGUoYiArIGRpZmYpCiAgICB9OwogICAgQzMubGVycCA9IGZ1bmN0aW9uIGxlcnAoYSwgYiwgeCkgewogICAgICAgIHJldHVybiBhICsgeCAqIChiIC0gYSkKICAgIH07CiAgICBDMy51bmxlcnAgPSBmdW5jdGlvbiB1bmxlcnAoYSwgYiwgeCkgewogICAgICAgIGlmIChhID09PSBiKSByZXR1cm4gMDsKICAgICAgICByZXR1cm4gKHggLSBhKSAvIChiIC0gYSkKICAgIH07CiAgICBDMy5yZWxlcnAgPSBmdW5jdGlvbiByZWxlcnAoYSwgYiwgeCwgYywgZCkgewogICAgICAgIHJldHVybiBDMy5sZXJwKGMsIGQsIEMzLnVubGVycChhLCBiLCB4KSkKICAgIH07CiAgICBDMy5xYXJwID0gZnVuY3Rpb24gcWFycChhLCBiLCBjLCB4KSB7CiAgICAgICAgcmV0dXJuIEMzLmxlcnAoQzMubGVycChhLCBiLCB4KSwgQzMubGVycChiLCBjLCB4KSwgeCkKICAgIH07CiAgICBDMy5jdWJpYyA9IGZ1bmN0aW9uIGN1YmljKGEsIGIsIGMsIGQsIHgpIHsKICAgICAgICByZXR1cm4gQzMubGVycChDMy5xYXJwKGEsIGIsIGMsIHgpLCBDMy5xYXJwKGIsIGMsIGQsIHgpLCB4KQogICAgfTsKICAgIEMzLmNvc3AgPSBmdW5jdGlvbiBjb3NwKGEsIGIsIHgpIHsKICAgICAgICByZXR1cm4gKGEgKyBiICsgKGEgLSBiKSAqIE1hdGguY29zKHggKiBNYXRoLlBJKSkgLyAyCiAgICB9OwogICAgQzMuaXNQT1QgPSBmdW5jdGlvbiBpc1BPVCh4KSB7CiAgICAgICAgcmV0dXJuIHggPiAwICYmICh4IC0gMSAmIHgpID09PSAwCiAgICB9OwogICAgQzMubmV4dEhpZ2hlc3RQb3dlck9mVHdvID0gZnVuY3Rpb24gbmV4dEhpZ2hlc3RQb3dlck9mVHdvKHgpIHsKICAgICAgICAtLXg7CiAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCAzMjsgaSA8PD0gMSkgeCA9IHggfCB4ID4+IGk7CiAgICAgICAgcmV0dXJuIHggKyAxCiAgICB9OwogICAgQzMucm91bmRUb05lYXJlc3RGcmFjdGlvbiA9IGZ1bmN0aW9uIHJvdW5kVG9OZWFyZXN0RnJhY3Rpb24oeCwgbikgewogICAgICAgIHJldHVybiBNYXRoLnJvdW5kKHggKiBuKSAvIG4KICAgIH07CiAgICBDMy5mbG9vclRvTmVhcmVzdEZyYWN0aW9uID0gZnVuY3Rpb24gZmxvb3JUb05lYXJlc3RGcmFjdGlvbih4LCBuKSB7CiAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IoeCAqIG4pIC8gbgogICAgfTsKICAgIEMzLnJvdW5kVG9EcCA9IGZ1bmN0aW9uIHJvdW5kVG9EcCh4LCBkcCkgewogICAgICAgIGRwID0gTWF0aC5tYXgoTWF0aC5mbG9vcihkcCksIDApOwogICAgICAgIGNvbnN0IG0gPSBNYXRoLnBvdygxMCwgZHApOwogICAgICAgIHJldHVybiBNYXRoLnJvdW5kKHggKiBtKSAvIG0KICAgIH07CiAgICBDMy50b0ZpeGVkID0gZnVuY3Rpb24gdG9GaXhlZChuLCBkcCkgewogICAgICAgIGxldCByZXQgPSBuLnRvRml4ZWQoZHApOwogICAgICAgIGxldCBsYXN0ID0gcmV0Lmxlbmd0aCAtIDE7CiAgICAgICAgZm9yICg7IGxhc3QgPj0gMCAmJiByZXQuY2hhckF0KGxhc3QpID09PSAiMCI7IC0tbGFzdCk7CiAgICAgICAgaWYgKGxhc3QgPj0gMCAmJiByZXQuY2hhckF0KGxhc3QpID09PSAiLiIpIC0tbGFzdDsKICAgICAgICBpZiAobGFzdCA8IDApIHJldHVybiByZXQ7CiAgICAgICAgcmV0dXJuIHJldC5zdWJzdHIoMCwgbGFzdCArIDEpCiAgICB9OwogICAgQzMuUGFja1JHQiA9IGZ1bmN0aW9uIFBhY2tSR0IocmVkLCBncmVlbiwgYmx1ZSkgewogICAgICAgIHJldHVybiBDMy5jbGFtcChyZWQsIDAsIDI1NSkgfCBDMy5jbGFtcChncmVlbiwgMCwgMjU1KSA8PCA4IHwgQzMuY2xhbXAoYmx1ZSwgMCwgMjU1KSA8PCAxNgogICAgfTsKICAgIGNvbnN0IEFMUEhBRVhfU0hJRlQgPSAxMDI0OwogICAgY29uc3QgQUxQSEFFWF9NQVggPSAxMDIzOwogICAgY29uc3QgUkdCRVhfU0hJRlQgPSAxNjM4NDsKICAgIGNvbnN0IFJHQkVYX01BWCA9IDgxOTE7CiAgICBjb25zdCBSR0JFWF9NSU4gPSAtODE5MjsKICAgIEMzLlBhY2tSR0JBRXggPSBmdW5jdGlvbiBQYWNrUkdCQUV4KHJlZCwgZ3JlZW4sIGJsdWUsIGFscGhhKSB7CiAgICAgICAgcmVkID0gQzMuY2xhbXAoTWF0aC5mbG9vcihyZWQgKiAxMDI0KSwgUkdCRVhfTUlOLCBSR0JFWF9NQVgpOwogICAgICAgIGdyZWVuID0gQzMuY2xhbXAoTWF0aC5mbG9vcihncmVlbiAqIDEwMjQpLCBSR0JFWF9NSU4sIFJHQkVYX01BWCk7CiAgICAgICAgYmx1ZSA9IEMzLmNsYW1wKE1hdGguZmxvb3IoYmx1ZSAqIDEwMjQpLCBSR0JFWF9NSU4sIFJHQkVYX01BWCk7CiAgICAgICAgYWxwaGEgPSBDMy5jbGFtcChNYXRoLmZsb29yKGFscGhhICogQUxQSEFFWF9NQVgpLCAwLCBBTFBIQUVYX01BWCk7CiAgICAgICAgaWYgKHJlZCA8IDApIHJlZCArPSBSR0JFWF9TSElGVDsKICAgICAgICBpZiAoZ3JlZW4gPCAwKSBncmVlbiArPSBSR0JFWF9TSElGVDsKICAgICAgICBpZiAoYmx1ZSA8IDApIGJsdWUgKz0gUkdCRVhfU0hJRlQ7CiAgICAgICAgcmV0dXJuIC0ocmVkICogUkdCRVhfU0hJRlQgKiBSR0JFWF9TSElGVCAqIEFMUEhBRVhfU0hJRlQgKyBncmVlbiAqIFJHQkVYX1NISUZUICogQUxQSEFFWF9TSElGVCArIGJsdWUgKiBBTFBIQUVYX1NISUZUICsgYWxwaGEpCiAgICB9OwogICAgQzMuUGFja1JHQkV4ID0gZnVuY3Rpb24gUGFja1JHQkV4KHJlZCwgZ3JlZW4sIGJsdWUpIHsKICAgICAgICByZXR1cm4gQzMuUGFja1JHQkFFeChyZWQsIGdyZWVuLCBibHVlLCAxKQogICAgfTsKCiAgICBmdW5jdGlvbiBpc05lZ2F0aXZlWmVybyh4KSB7CiAgICAgICAgcmV0dXJuIHggPT09IDAgJiYgMSAvIHggPCAwCiAgICB9CiAgICBDMy5HZXRSVmFsdWUgPSBmdW5jdGlvbiBHZXRSVmFsdWUocmdiKSB7CiAgICAgICAgaWYgKHJnYiA+PSAwKSByZXR1cm4gKHJnYiAmIDI1NSkgLyAyNTU7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGxldCB2ID0gTWF0aC5mbG9vcigtcmdiIC8gKFJHQkVYX1NISUZUICogUkdCRVhfU0hJRlQgKiBBTFBIQUVYX1NISUZUKSk7CiAgICAgICAgICAgIGlmICh2ID4gUkdCRVhfTUFYKSB2IC09IFJHQkVYX1NISUZUOwogICAgICAgICAgICByZXR1cm4gdiAvIDEwMjQKICAgICAgICB9CiAgICB9OwogICAgQzMuR2V0R1ZhbHVlID0gZnVuY3Rpb24gR2V0R1ZhbHVlKHJnYikgewogICAgICAgIGlmIChyZ2IgPj0gMCkgcmV0dXJuICgocmdiICYgNjUyODApID4+IDgpIC8gMjU1OwogICAgICAgIGVsc2UgewogICAgICAgICAgICBsZXQgdiA9IE1hdGguZmxvb3IoLXJnYiAlIChSR0JFWF9TSElGVCAqIFJHQkVYX1NISUZUICogQUxQSEFFWF9TSElGVCkgLyAoUkdCRVhfU0hJRlQgKiBBTFBIQUVYX1NISUZUKSk7CiAgICAgICAgICAgIGlmICh2ID4gUkdCRVhfTUFYKSB2IC09IFJHQkVYX1NISUZUOwogICAgICAgICAgICByZXR1cm4gdiAvIDEwMjQKICAgICAgICB9CiAgICB9OwogICAgQzMuR2V0QlZhbHVlID0gZnVuY3Rpb24gR2V0QlZhbHVlKHJnYikgewogICAgICAgIGlmIChyZ2IgPj0gMCkgcmV0dXJuICgocmdiICYgMTY3MTE2ODApID4+IDE2KSAvIDI1NTsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgbGV0IHYgPSBNYXRoLmZsb29yKC1yZ2IgJSAoUkdCRVhfU0hJRlQgKiBBTFBIQUVYX1NISUZUKSAvIEFMUEhBRVhfU0hJRlQpOwogICAgICAgICAgICBpZiAodiA+IFJHQkVYX01BWCkgdiAtPSBSR0JFWF9TSElGVDsKICAgICAgICAgICAgcmV0dXJuIHYgLyAxMDI0CiAgICAgICAgfQogICAgfTsKICAgIEMzLkdldEFWYWx1ZSA9IGZ1bmN0aW9uIEdldEFWYWx1ZShyZ2IpIHsKICAgICAgICBpZiAoaXNOZWdhdGl2ZVplcm8ocmdiKSkgcmV0dXJuIDA7CiAgICAgICAgZWxzZSBpZiAocmdiID49IDApIHJldHVybiAxOwogICAgICAgIGVsc2UgewogICAgICAgICAgICBjb25zdCB2ID0gTWF0aC5mbG9vcigtcmdiICUgQUxQSEFFWF9TSElGVCk7CiAgICAgICAgICAgIHJldHVybiB2IC8gQUxQSEFFWF9NQVgKICAgICAgICB9CiAgICB9OwogICAgQzMuZ3JlYXRlc3RDb21tb25EaXZpc29yID0gZnVuY3Rpb24gZ3JlYXRlc3RDb21tb25EaXZpc29yKGEsIGIpIHsKICAgICAgICBhID0gTWF0aC5mbG9vcihhKTsKICAgICAgICBiID0gTWF0aC5mbG9vcihiKTsKICAgICAgICB3aGlsZSAoYiAhPT0gMCkgewogICAgICAgICAgICBsZXQgdCA9IGI7CiAgICAgICAgICAgIGIgPSBhICUgYjsKICAgICAgICAgICAgYSA9IHQKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGEKICAgIH07CiAgICBjb25zdCBDT01NT05fQVNQRUNUX1JBVElPUyA9IFsKICAgICAgICBbMywgMl0sCiAgICAgICAgWzQsIDNdLAogICAgICAgIFs1LCA0XSwKICAgICAgICBbNSwgM10sCiAgICAgICAgWzYsIDVdLAogICAgICAgIFsxNCwgOV0sCiAgICAgICAgWzE2LCA5XSwKICAgICAgICBbMTYsIDEwXSwKICAgICAgICBbMjEsIDldCiAgICBdOwogICAgQzMuZ2V0QXNwZWN0UmF0aW8gPSBmdW5jdGlvbiBnZXRBc3BlY3RSYXRpbyh3LCBoKSB7CiAgICAgICAgdyA9IE1hdGguZmxvb3Iodyk7CiAgICAgICAgaCA9IE1hdGguZmxvb3IoaCk7CiAgICAgICAgaWYgKHcgPT09IGgpIHJldHVybiBbMSwgMV07CiAgICAgICAgZm9yIChsZXQgYXNwZWN0IG9mIENPTU1PTl9BU1BFQ1RfUkFUSU9TKSB7CiAgICAgICAgICAgIGxldCBhcHByb3hIID0gdyAvIGFzcGVjdFswXSAqIGFzcGVjdFsxXTsKICAgICAgICAgICAgaWYgKE1hdGguYWJzKGggLSBhcHByb3hIKSA8IDEpIHJldHVybiBhc3BlY3Quc2xpY2UoMCk7CiAgICAgICAgICAgIGFwcHJveEggPSB3IC8gYXNwZWN0WzFdICogYXNwZWN0WzBdOwogICAgICAgICAgICBpZiAoTWF0aC5hYnMoaCAtIGFwcHJveEgpIDwgMSkgcmV0dXJuIFthc3BlY3RbMV0sIGFzcGVjdFswXV0KICAgICAgICB9CiAgICAgICAgbGV0IGdjZCA9IEMzLmdyZWF0ZXN0Q29tbW9uRGl2aXNvcih3LCBoKTsKICAgICAgICByZXR1cm4gW3cgLyBnY2QsIGggLyBnY2RdCiAgICB9OwogICAgQzMuc2VnbWVudHNJbnRlcnNlY3QgPSBmdW5jdGlvbiBzZWdtZW50c0ludGVyc2VjdChhMXgsIGExeSwgYTJ4LCBhMnksIGIxeCwgYjF5LCBiMngsIGIyeSkgewogICAgICAgIGNvbnN0IG1pbl9heCA9IE1hdGgubWluKGExeCwgYTJ4KTsKICAgICAgICBjb25zdCBtYXhfYXggPSBNYXRoLm1heChhMXgsIGEyeCk7CiAgICAgICAgY29uc3QgbWluX2J4ID0gTWF0aC5taW4oYjF4LCBiMngpOwogICAgICAgIGNvbnN0IG1heF9ieCA9IE1hdGgubWF4KGIxeCwgYjJ4KTsKICAgICAgICBpZiAobWF4X2F4IDwgbWluX2J4IHx8IG1pbl9heCA+IG1heF9ieCkgcmV0dXJuIGZhbHNlOwogICAgICAgIGNvbnN0IG1pbl9heSA9IE1hdGgubWluKGExeSwgYTJ5KTsKICAgICAgICBjb25zdCBtYXhfYXkgPSBNYXRoLm1heChhMXksIGEyeSk7CiAgICAgICAgY29uc3QgbWluX2J5ID0gTWF0aC5taW4oYjF5LCBiMnkpOwogICAgICAgIGNvbnN0IG1heF9ieSA9IE1hdGgubWF4KGIxeSwgYjJ5KTsKICAgICAgICBpZiAobWF4X2F5IDwgbWluX2J5IHx8IG1pbl9heSA+IG1heF9ieSkgcmV0dXJuIGZhbHNlOwogICAgICAgIGNvbnN0IGRweCA9IGIxeCAtIGExeCArIGIyeCAtIGEyeDsKICAgICAgICBjb25zdCBkcHkgPSBiMXkgLSBhMXkgKyBiMnkgLSBhMnk7CiAgICAgICAgY29uc3QgcWF4ID0gYTJ4IC0gYTF4OwogICAgICAgIGNvbnN0IHFheSA9IGEyeSAtCiAgICAgICAgICAgIGExeTsKICAgICAgICBjb25zdCBxYnggPSBiMnggLSBiMXg7CiAgICAgICAgY29uc3QgcWJ5ID0gYjJ5IC0gYjF5OwogICAgICAgIGNvbnN0IGQgPSBNYXRoLmFicyhxYXkgKiBxYnggLSBxYnkgKiBxYXgpOwogICAgICAgIGNvbnN0IGxhID0gcWJ4ICogZHB5IC0gcWJ5ICogZHB4OwogICAgICAgIGlmIChNYXRoLmFicyhsYSkgPiBkKSByZXR1cm4gZmFsc2U7CiAgICAgICAgY29uc3QgbGIgPSBxYXggKiBkcHkgLSBxYXkgKiBkcHg7CiAgICAgICAgcmV0dXJuIE1hdGguYWJzKGxiKSA8PSBkCiAgICB9OwogICAgQzMuc2VnbWVudHNJbnRlcnNlY3RQcmVDYWxjID0gZnVuY3Rpb24gc2VnbWVudHNJbnRlcnNlY3RQcmVDYWxjKGExeCwgYTF5LCBhMngsIGEyeSwgbWluX2F4LCBtYXhfYXgsIG1pbl9heSwgbWF4X2F5LCBiMXgsIGIxeSwgYjJ4LCBiMnkpIHsKICAgICAgICBjb25zdCBtaW5fYnggPSBNYXRoLm1pbihiMXgsIGIyeCk7CiAgICAgICAgY29uc3QgbWF4X2J4ID0gTWF0aC5tYXgoYjF4LCBiMngpOwogICAgICAgIGlmIChtYXhfYXggPCBtaW5fYnggfHwgbWluX2F4ID4gbWF4X2J4KSByZXR1cm4gZmFsc2U7CiAgICAgICAgY29uc3QgbWluX2J5ID0gTWF0aC5taW4oYjF5LCBiMnkpOwogICAgICAgIGNvbnN0IG1heF9ieSA9IE1hdGgubWF4KGIxeSwgYjJ5KTsKICAgICAgICBpZiAobWF4X2F5IDwgbWluX2J5IHx8IG1pbl9heSA+IG1heF9ieSkgcmV0dXJuIGZhbHNlOwogICAgICAgIGNvbnN0IGRweCA9IGIxeCAtIGExeCArIGIyeCAtIGEyeDsKICAgICAgICBjb25zdCBkcHkgPSBiMXkgLSBhMXkgKyBiMnkgLSBhMnk7CiAgICAgICAgY29uc3QgcWF4ID0gYTJ4IC0gYTF4OwogICAgICAgIGNvbnN0IHFheSA9IGEyeSAtIGExeTsKICAgICAgICBjb25zdCBxYnggPSBiMnggLSBiMXg7CiAgICAgICAgY29uc3QgcWJ5ID0gYjJ5IC0gYjF5OwogICAgICAgIGNvbnN0IGQgPSBNYXRoLmFicyhxYXkgKiBxYnggLSBxYnkgKiBxYXgpOwogICAgICAgIGNvbnN0IGxhID0KICAgICAgICAgICAgcWJ4ICogZHB5IC0gcWJ5ICogZHB4OwogICAgICAgIGlmIChNYXRoLmFicyhsYSkgPiBkKSByZXR1cm4gZmFsc2U7CiAgICAgICAgY29uc3QgbGIgPSBxYXggKiBkcHkgLSBxYXkgKiBkcHg7CiAgICAgICAgcmV0dXJuIE1hdGguYWJzKGxiKSA8PSBkCiAgICB9OwogICAgQzMuc2VnbWVudEludGVyc2VjdHNRdWFkID0gZnVuY3Rpb24gc2VnbWVudEludGVyc2VjdHNRdWFkKHgxLCB5MSwgeDIsIHkyLCBxKSB7CiAgICAgICAgY29uc3QgbWluX3ggPSBNYXRoLm1pbih4MSwgeDIpOwogICAgICAgIGNvbnN0IG1heF94ID0gTWF0aC5tYXgoeDEsIHgyKTsKICAgICAgICBjb25zdCBtaW5feSA9IE1hdGgubWluKHkxLCB5Mik7CiAgICAgICAgY29uc3QgbWF4X3kgPSBNYXRoLm1heCh5MSwgeTIpOwogICAgICAgIGNvbnN0IHRseCA9IHEuZ2V0VGx4KCksCiAgICAgICAgICAgIHRseSA9IHEuZ2V0VGx5KCksCiAgICAgICAgICAgIHRyeCA9IHEuZ2V0VHJ4KCksCiAgICAgICAgICAgIHRyeV8gPSBxLmdldFRyeSgpLAogICAgICAgICAgICBicnggPSBxLmdldEJyeCgpLAogICAgICAgICAgICBicnkgPSBxLmdldEJyeSgpLAogICAgICAgICAgICBibHggPSBxLmdldEJseCgpLAogICAgICAgICAgICBibHkgPSBxLmdldEJseSgpOwogICAgICAgIHJldHVybiBDMy5zZWdtZW50c0ludGVyc2VjdFByZUNhbGMoeDEsIHkxLCB4MiwgeTIsIG1pbl94LCBtYXhfeCwgbWluX3ksIG1heF95LCB0bHgsIHRseSwgdHJ4LCB0cnlfKSB8fCBDMy5zZWdtZW50c0ludGVyc2VjdFByZUNhbGMoeDEsIHkxLCB4MiwgeTIsIG1pbl94LCBtYXhfeCwgbWluX3ksIG1heF95LCB0cngsIHRyeV8sIGJyeCwgYnJ5KSB8fCBDMy5zZWdtZW50c0ludGVyc2VjdFByZUNhbGMoeDEsCiAgICAgICAgICAgIHkxLCB4MiwgeTIsIG1pbl94LCBtYXhfeCwgbWluX3ksIG1heF95LCBicngsIGJyeSwgYmx4LCBibHkpIHx8IEMzLnNlZ21lbnRzSW50ZXJzZWN0UHJlQ2FsYyh4MSwgeTEsIHgyLCB5MiwgbWluX3gsIG1heF94LCBtaW5feSwgbWF4X3ksIGJseCwgYmx5LCB0bHgsIHRseSkKICAgIH07CiAgICBDMy5zZWdtZW50SW50ZXJzZWN0c0FueU4gPSBmdW5jdGlvbiBzZWdtZW50SW50ZXJzZWN0c0FueU4oeDEsIHkxLCB4MiwgeTIsIHBvaW50cykgewogICAgICAgIGNvbnN0IG1pbl94ID0gTWF0aC5taW4oeDEsIHgyKTsKICAgICAgICBjb25zdCBtYXhfeCA9IE1hdGgubWF4KHgxLCB4Mik7CiAgICAgICAgY29uc3QgbWluX3kgPSBNYXRoLm1pbih5MSwgeTIpOwogICAgICAgIGNvbnN0IG1heF95ID0gTWF0aC5tYXgoeTEsIHkyKTsKICAgICAgICBsZXQgaSA9IDA7CiAgICAgICAgZm9yIChsZXQgbGFzdCA9IHBvaW50cy5sZW5ndGggLSA0OyBpIDw9IGxhc3Q7IGkgKz0gMikKICAgICAgICAgICAgaWYgKEMzLnNlZ21lbnRzSW50ZXJzZWN0UHJlQ2FsYyh4MSwgeTEsIHgyLCB5MiwgbWluX3gsIG1heF94LCBtaW5feSwgbWF4X3ksIHBvaW50c1tpXSwgcG9pbnRzW2kgKyAxXSwgcG9pbnRzW2kgKyAyXSwgcG9pbnRzW2kgKyAzXSkpIHJldHVybiB0cnVlOwogICAgICAgIHJldHVybiBDMy5zZWdtZW50c0ludGVyc2VjdFByZUNhbGMoeDEsIHkxLCB4MiwgeTIsIG1pbl94LCBtYXhfeCwgbWluX3ksIG1heF95LCBwb2ludHNbaV0sIHBvaW50c1tpICsgMV0sIHBvaW50c1swXSwgcG9pbnRzWzFdKQogICAgfTsKICAgIGNvbnN0IE5PX0hJVCA9IDI7CiAgICBjb25zdCBQQURESU5HID0gMUUtNjsKICAgIEMzLnJheUludGVyc2VjdCA9IGZ1bmN0aW9uIHJheUludGVyc2VjdChyeDEsIHJ5MSwgcngyLCByeTIsIHN4MSwgc3kxLCBzeDIsIHN5MikgewogICAgICAgIGNvbnN0IHJkeCA9IHJ4MiAtIHJ4MTsKICAgICAgICBjb25zdCByZHkgPSByeTIgLSByeTE7CiAgICAgICAgY29uc3Qgc2R4ID0gc3gyIC0gc3gxOwogICAgICAgIGNvbnN0IHNkeSA9IHN5MiAtIHN5MTsKICAgICAgICBjb25zdCBkZXQgPSByZHggKiBzZHkgLSByZHkgKiBzZHg7CiAgICAgICAgaWYgKGRldCA9PT0gMCkgcmV0dXJuIE5PX0hJVDsKICAgICAgICBjb25zdCBnYW1tYSA9ICgocnkxIC0gcnkyKSAqIChzeDIgLSByeDEpICsgcmR4ICogKHN5MiAtIHJ5MSkpIC8gZGV0OwogICAgICAgIGlmICgwIDwgZ2FtbWEgJiYgZ2FtbWEgPCAxICsgUEFERElORykgcmV0dXJuIChzZHkgKiAoc3gyIC0gcngxKSArIChzeDEgLSBzeDIpICogKHN5MiAtIHJ5MSkpIC8gZGV0OwogICAgICAgIHJldHVybiBOT19ISVQKICAgIH07CiAgICBDMy5yYXlJbnRlcnNlY3RFeHRlbmRlZCA9IGZ1bmN0aW9uIHJheUludGVyc2VjdChyeDEsIHJ5MSwgcngyLCByeTIsIHN4MSwgc3kxLCBzeDIsIHN5MiwgZikgewogICAgICAgIGNvbnN0IGR4ID0gKHN4MiAtIHN4MSkgKiBmOwogICAgICAgIGNvbnN0IGR5ID0gKHN5MiAtIHN5MSkgKiBmOwogICAgICAgIHJldHVybiBDMy5yYXlJbnRlcnNlY3QocngxLCByeTEsIHJ4MiwgcnkyLCBzeDEgLSBkeCwgc3kxIC0gZHksIHN4MiArIGR4LCBzeTIgKyBkeSkKICAgIH07CiAgICBDMy5pc1BvaW50SW5UcmlhbmdsZUluY2x1c2l2ZSA9IGZ1bmN0aW9uIGlzUG9pbnRJblRyaWFuZ2xlSW5jbHVzaXZlKHB4LCBweSwgdHgxLCB0eTEsIHR4MiwgdHkyLCB0eDMsIHR5MykgewogICAgICAgIGNvbnN0IHYweCA9IHR4MiAtIHR4MTsKICAgICAgICBjb25zdCB2MHkgPSB0eTIgLSB0eTE7CiAgICAgICAgY29uc3QgdjF4ID0gdHgzIC0gdHgxOwogICAgICAgIGNvbnN0IHYxeSA9IHR5MyAtIHR5MTsKICAgICAgICBjb25zdCB2MnggPSBweCAtIHR4MTsKICAgICAgICBjb25zdCB2MnkgPSBweSAtIHR5MTsKICAgICAgICBjb25zdCBkb3QwMCA9IHYweCAqIHYweCArIHYweSAqIHYweTsKICAgICAgICBjb25zdCBkb3QwMSA9IHYweCAqIHYxeCArIHYweSAqIHYxeTsKICAgICAgICBjb25zdCBkb3QwMiA9IHYweCAqIHYyeCArIHYweSAqIHYyeTsKICAgICAgICBjb25zdCBkb3QxMSA9IHYxeCAqIHYxeCArIHYxeSAqIHYxeTsKICAgICAgICBjb25zdCBkb3QxMiA9IHYxeCAqIHYyeCArIHYxeSAqIHYyeTsKICAgICAgICBjb25zdCBpbnZEZW5vbSA9IDEgLyAoZG90MDAgKiBkb3QxMSAtIGRvdDAxICogZG90MDEpOwogICAgICAgIGNvbnN0IHUgPSAoZG90MTEgKiBkb3QwMiAtIGRvdDAxICogZG90MTIpICogaW52RGVub207CiAgICAgICAgY29uc3QgdiA9IChkb3QwMCAqIGRvdDEyIC0gZG90MDEgKiBkb3QwMikgKiBpbnZEZW5vbTsKICAgICAgICByZXR1cm4gdSA+PSAwICYmIHYgPj0gMCAmJiB1ICsgdiA8PSAxCiAgICB9OwogICAgQzMudHJpYW5nbGVDYXJ0ZXNpYW5Ub0JhcnljZW50cmljID0gZnVuY3Rpb24gdHJpYW5nbGVDYXJ0ZXNpYW5Ub0JhcnljZW50cmljKHB4LCBweSwgdHgxLCB0eTEsIHR4MiwgdHkyLCB0eDMsIHR5MykgewogICAgICAgIGNvbnN0IHYweCA9IHR4MiAtIHR4MTsKICAgICAgICBjb25zdCB2MHkgPSB0eTIgLSB0eTE7CiAgICAgICAgY29uc3QgdjF4ID0gdHgzIC0gdHgxOwogICAgICAgIGNvbnN0IHYxeSA9IHR5MyAtIHR5MTsKICAgICAgICBjb25zdCB2MnggPSBweCAtIHR4MTsKICAgICAgICBjb25zdCB2MnkgPSBweSAtIHR5MTsKICAgICAgICBjb25zdCBkb3QwMCA9IHYweCAqIHYweCArIHYweSAqIHYweTsKICAgICAgICBjb25zdCBkb3QwMSA9IHYweCAqIHYxeCArIHYweSAqIHYxeTsKICAgICAgICBjb25zdCBkb3QxMSA9IHYxeCAqIHYxeCArIHYxeSAqIHYxeTsKICAgICAgICBjb25zdCBkb3QyMCA9IHYyeCAqIHYweCArIHYyeSAqIHYweTsKICAgICAgICBjb25zdCBkb3QyMSA9IHYyeCAqIHYxeCArIHYyeSAqIHYxeTsKICAgICAgICBjb25zdCBkZW5vbSA9IGRvdDAwICogZG90MTEgLSBkb3QwMSAqIGRvdDAxOwogICAgICAgIGNvbnN0IHYgPSAoZG90MTEgKiBkb3QyMCAtIGRvdDAxICogZG90MjEpIC8gZGVub207CiAgICAgICAgY29uc3QgdyA9IChkb3QwMCAqIGRvdDIxIC0gZG90MDEgKiBkb3QyMCkgLyBkZW5vbTsKICAgICAgICBjb25zdCB1ID0gMSAtIHYgLSB3OwogICAgICAgIHJldHVybiBbdSwgdiwgd10KICAgIH07CiAgICBDMy50cmlhbmdsZUJhcnljZW50cmljVG9DYXJ0ZXNpYW4zZCA9IGZ1bmN0aW9uIHRyaWFuZ2xlQmFyeWNlbnRyaWNUb0NhcnRlc2lhbjNkKHUsIHYsIHcsIHR4MSwgdHkxLCB0ejEsIHR4MiwgdHkyLCB0ejIsIHR4MywgdHkzLCB0ejMpIHsKICAgICAgICByZXR1cm4gW3UgKiB0eDEgKyB2ICogdHgyICsgdyAqIHR4MywgdSAqIHR5MSArIHYgKiB0eTIgKyB3ICogdHkzLCB1ICogdHoxICsgdiAqIHR6MiArIHcgKiB0ejNdCiAgICB9OwoKfQoKLy8gLi4vbGliL21pc2MvbWlzY3V0aWwuanMKewogICAgJ3VzZSBzdHJpY3QnOwogICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgbGV0IG1haW5Eb2N1bWVudCA9IG51bGw7CiAgICBsZXQgYmFzZUhyZWYgPSAiIjsKICAgIGlmICh0eXBlb2YgZG9jdW1lbnQgIT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgbWFpbkRvY3VtZW50ID0gZG9jdW1lbnQ7CiAgICAgICAgY29uc3QgYmFzZUVsZW0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJiYXNlIik7CiAgICAgICAgYmFzZUhyZWYgPSBiYXNlRWxlbSAmJiBiYXNlRWxlbS5oYXNBdHRyaWJ1dGUoImhyZWYiKSA/IGJhc2VFbGVtLmdldEF0dHJpYnV0ZSgiaHJlZiIpIDogIiI7CiAgICAgICAgaWYgKGJhc2VIcmVmKSB7CiAgICAgICAgICAgIGlmIChiYXNlSHJlZi5zdGFydHNXaXRoKCIvIikpIGJhc2VIcmVmID0gYmFzZUhyZWYuc3Vic3RyKDEpOwogICAgICAgICAgICBpZiAoIWJhc2VIcmVmLmVuZHNXaXRoKCIvIikpIGJhc2VIcmVmICs9ICIvIgogICAgICAgIH0KICAgIH0KICAgIEMzLkdldEJhc2VIcmVmID0gZnVuY3Rpb24gR2V0QmFzZUhyZWYoKSB7CiAgICAgICAgcmV0dXJuIGJhc2VIcmVmCiAgICB9OwogICAgQzMuR2V0QmFzZVVSTCA9IGZ1bmN0aW9uIEdldEJhc2VVUkwoKSB7CiAgICAgICAgaWYgKCFtYWluRG9jdW1lbnQpIHJldHVybiAiIjsKICAgICAgICBjb25zdCBsb2MgPSBtYWluRG9jdW1lbnQubG9jYXRpb247CiAgICAgICAgcmV0dXJuIEMzLkdldFBhdGhGcm9tVVJMKGxvYy5vcmlnaW4gKyBsb2MucGF0aG5hbWUpICsgYmFzZUhyZWYKICAgIH07CiAgICBDMy5HZXRQYXRoRnJvbVVSTCA9IGZ1bmN0aW9uIEdldFBhdGhGcm9tVVJMKHVybCkgewogICAgICAgIGlmICghdXJsLmxlbmd0aCkgcmV0dXJuIHVybDsKICAgICAgICBpZiAodXJsLmVuZHNXaXRoKCIvIikgfHwgdXJsLmVuZHNXaXRoKCJcXCIpKSByZXR1cm4gdXJsOwogICAgICAgIGNvbnN0IGxhc3RTbGFzaCA9IE1hdGgubWF4KHVybC5sYXN0SW5kZXhPZigiLyIpLCB1cmwubGFzdEluZGV4T2YoIlxcIikpOwogICAgICAgIGlmIChsYXN0U2xhc2ggPT09IC0xKSByZXR1cm4gIiI7CiAgICAgICAgcmV0dXJuIHVybC5zdWJzdHIoMCwgbGFzdFNsYXNoICsgMSkKICAgIH07CiAgICBDMy5HZXRGaWxlbmFtZUZyb21VUkwgPSBmdW5jdGlvbiBHZXRGaWxlbmFtZUZyb21VUkwodXJsKSB7CiAgICAgICAgaWYgKCF1cmwubGVuZ3RoKSByZXR1cm4gdXJsOwogICAgICAgIGlmICh1cmwuZW5kc1dpdGgoIi8iKSB8fCB1cmwuZW5kc1dpdGgoIlxcIikpIHJldHVybiAiIjsKICAgICAgICBjb25zdCBsYXN0U2xhc2ggPSBNYXRoLm1heCh1cmwubGFzdEluZGV4T2YoIi8iKSwgdXJsLmxhc3RJbmRleE9mKCJcXCIpKTsKICAgICAgICBpZiAobGFzdFNsYXNoID09PSAtMSkgcmV0dXJuIHVybDsKICAgICAgICByZXR1cm4gdXJsLnN1YnN0cihsYXN0U2xhc2ggKyAxKQogICAgfTsKICAgIEMzLkdldEZpbGVFeHRlbnNpb24gPSBmdW5jdGlvbiBHZXRGaWxlRXh0ZW5zaW9uKGZpbGVuYW1lKSB7CiAgICAgICAgbGV0IGkgPSBmaWxlbmFtZS5sYXN0SW5kZXhPZigiLiIpOwogICAgICAgIGlmIChpIDwgMSkgcmV0dXJuICIiOwogICAgICAgIGVsc2UgcmV0dXJuIGZpbGVuYW1lLnN1YnN0cihpKQogICAgfTsKICAgIEMzLlNldEZpbGVFeHRlbnNpb24gPSBmdW5jdGlvbiBTZXRGaWxlRXh0ZW5zaW9uKGZpbGVuYW1lLCBuZXdFeHQpIHsKICAgICAgICBjb25zdCBpID0gZmlsZW5hbWUubGFzdEluZGV4T2YoIi4iKTsKICAgICAgICBpZiAoaSA9PT0gLTEpIHJldHVybiBmaWxlbmFtZSArICIuIiArIG5ld0V4dDsKICAgICAgICBlbHNlIHJldHVybiBmaWxlbmFtZS5zdWJzdHIoMCwgaSArIDEpICsgbmV3RXh0CiAgICB9OwogICAgQzMuR2V0RmlsZU5hbWVQYXJ0ID0gZnVuY3Rpb24gR2V0RmlsZU5hbWVQYXJ0KGZpbGVuYW1lKSB7CiAgICAgICAgbGV0IGkgPSBmaWxlbmFtZS5sYXN0SW5kZXhPZigiLiIpOwogICAgICAgIGlmIChpIDwgMSkgcmV0dXJuIGZpbGVuYW1lOwogICAgICAgIGVsc2UgcmV0dXJuIGZpbGVuYW1lLnN1YnN0cigwLCBpKQogICAgfTsKICAgIEMzLk5vcm1hbGl6ZUZpbGVTZXBhcmF0b3IgPSBmdW5jdGlvbiBOb3JtYWxpemVGaWxlU2VwYXJhdG9yKHBhdGgpIHsKICAgICAgICByZXR1cm4gcGF0aC5yZXBsYWNlKC9cXC9nLCAiLyIpCiAgICB9OwogICAgQzMuSXNGaWxlRXh0ZW5zaW9uID0gZnVuY3Rpb24gSXNGaWxlRXh0ZW5zaW9uKGZpbGVuYW1lLCBleHRlbnNpb24pIHsKICAgICAgICBjb25zdCBleHQgPSBmaWxlbmFtZSA/IEMzLkdldEZpbGVFeHRlbnNpb24oZmlsZW5hbWUpLnNsaWNlKDEpIDogIiI7CiAgICAgICAgcmV0dXJuIGV4dGVuc2lvbiA9PT0gZXh0CiAgICB9OwogICAgQzMuRmlsZU5hbWVFcXVhbHMgPSBmdW5jdGlvbiBGaWxlTmFtZUVxdWFscyhmaWxlX29yX2ZpbGVuYW1lLCBvdGhlcl9maWxlX29yX2ZpbGVuYW1lKSB7CiAgICAgICAgbGV0IGZpcnN0TmFtZTsKICAgICAgICBsZXQgc2Vjb25kTmFtZTsKICAgICAgICBpZiAoQzMuSXNGaWxlTGlrZShmaWxlX29yX2ZpbGVuYW1lKSkgZmlyc3ROYW1lID0gQzMuR2V0RmlsZU5hbWVQYXJ0KGZpbGVfb3JfZmlsZW5hbWVbIm5hbWUiXSk7CiAgICAgICAgaWYgKEMzLklzU3RyaW5nKGZpbGVfb3JfZmlsZW5hbWUpKSBmaXJzdE5hbWUgPSBDMy5HZXRGaWxlTmFtZVBhcnQoZmlsZV9vcl9maWxlbmFtZSk7CiAgICAgICAgaWYgKEMzLklzRmlsZUxpa2Uob3RoZXJfZmlsZV9vcl9maWxlbmFtZSkpIHNlY29uZE5hbWUgPSBDMy5HZXRGaWxlTmFtZVBhcnQob3RoZXJfZmlsZV9vcl9maWxlbmFtZVsibmFtZSJdKTsKICAgICAgICBpZiAoQzMuSXNTdHJpbmcob3RoZXJfZmlsZV9vcl9maWxlbmFtZSkpIHNlY29uZE5hbWUgPSBDMy5HZXRGaWxlTmFtZVBhcnQob3RoZXJfZmlsZV9vcl9maWxlbmFtZSk7CiAgICAgICAgcmV0dXJuIGZpcnN0TmFtZSA9PT0gc2Vjb25kTmFtZQogICAgfTsKICAgIEMzLlBhcnNlRmlsZVBhdGggPSBmdW5jdGlvbiBQYXJzZUZpbGVQYXRoKHBhdGgpIHsKICAgICAgICBwYXRoID0gQzMuTm9ybWFsaXplRmlsZVNlcGFyYXRvcihwYXRoKTsKICAgICAgICBsZXQgcm9vdCA9IC9eXHc6XC8vLmV4ZWMocGF0aCk7CiAgICAgICAgaWYgKHJvb3QpIHsKICAgICAgICAgICAgcm9vdCA9IHJvb3RbMF07CiAgICAgICAgICAgIHBhdGggPSBwYXRoLnNsaWNlKDMpOwogICAgICAgICAgICBpZiAocGF0aFswXSAhPT0gIi8iKSBwYXRoID0gIi8iICsgcGF0aAogICAgICAgIH0gZWxzZSByb290ID0gIiI7CiAgICAgICAgcGF0aCA9IHBhdGgucmVwbGFjZSgvXC97Mix9L2csICIvIik7CiAgICAgICAgaWYgKHBhdGgubGVuZ3RoID4gMSAmJiBwYXRoLnNsaWNlKC0xKSA9PT0gIi8iKSBwYXRoID0gcGF0aC5zbGljZSgwLCAtMSk7CiAgICAgICAgY29uc3Qgc3RhcnQgPSBwYXRoLmxhc3RJbmRleE9mKCIvIikgKyAxOwogICAgICAgIGxldCBkaXIgPSAiIiwKICAgICAgICAgICAgYmFzZSA9IHBhdGgsCiAgICAgICAgICAgIG5hbWUsIGV4dCA9ICIiOwogICAgICAgIGlmIChzdGFydCA+IDApIHsKICAgICAgICAgICAgZGlyID0gcGF0aC5zbGljZSgwLCBzdGFydCk7CiAgICAgICAgICAgIGJhc2UgPSBwYXRoLnNsaWNlKHN0YXJ0KQogICAgICAgIH0KICAgICAgICBuYW1lID0gYmFzZTsKICAgICAgICBjb25zdCBlbmQgPSBiYXNlLmxhc3RJbmRleE9mKCIuIik7CiAgICAgICAgaWYgKGVuZCA+IDApIHsKICAgICAgICAgICAgZXh0ID0gYmFzZS5zbGljZShlbmQpOwogICAgICAgICAgICBuYW1lID0gYmFzZS5zbGljZSgwLCAtZXh0Lmxlbmd0aCkKICAgICAgICB9CiAgICAgICAgY29uc3QgZnVsbCA9IHJvb3QgKyBkaXIgKyBiYXNlOwogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGRpciwKICAgICAgICAgICAgYmFzZSwKICAgICAgICAgICAgbmFtZSwKICAgICAgICAgICAgcm9vdCwKICAgICAgICAgICAgZXh0LAogICAgICAgICAgICBmdWxsCiAgICAgICAgfQogICAgfTsKICAgIEMzLldhaXQgPSBmdW5jdGlvbiBXYWl0KGRlbGF5LCBhcmd1bWVudCkgewogICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICAgICAgICAgIHNlbGYuc2V0VGltZW91dChyZXNvbHZlLCBkZWxheSwgYXJndW1lbnQpCiAgICAgICAgfSkKICAgIH07CiAgICBDMy5zd2FsbG93RXhjZXB0aW9uID0gZnVuY3Rpb24gc3dhbGxvd0V4Y2VwdGlvbihmKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZigpCiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICBpZiAoQzMuaXNEZWJ1ZykgY29uc29sZS53YXJuKCJTd2FsbG93ZWQgZXhjZXB0aW9uOiAiLCBlKQogICAgICAgIH0KICAgIH07CiAgICBDMy5ub29wID0gZnVuY3Rpb24gbm9vcCgpIHt9OwogICAgQzMuZXF1YWxzTm9DYXNlID0gZnVuY3Rpb24gZXF1YWxzTm9DYXNlKGEsIGIpIHsKICAgICAgICBpZiAodHlwZW9mIGEgIT09ICJzdHJpbmciIHx8IHR5cGVvZiBiICE9PSAic3RyaW5nIikgcmV0dXJuIGZhbHNlOwogICAgICAgIHJldHVybiBhID09PSBiIHx8IGEubm9ybWFsaXplKCkudG9Mb3dlckNhc2UoKSA9PT0gYi5ub3JtYWxpemUoKS50b0xvd2VyQ2FzZSgpCiAgICB9OwogICAgQzMuZXF1YWxzQ2FzZSA9IGZ1bmN0aW9uIGVxdWFsc0Nhc2UoYSwgYikgewogICAgICAgIGlmICh0eXBlb2YgYSAhPT0gInN0cmluZyIgfHwgdHlwZW9mIGIgIT09ICJzdHJpbmciKSByZXR1cm4gZmFsc2U7CiAgICAgICAgaWYgKGEgPT09IGIpIHJldHVybiB0cnVlOwogICAgICAgIHJldHVybiBhLm5vcm1hbGl6ZSgpID09PSBiLm5vcm1hbGl6ZSgpCiAgICB9OwogICAgQzMudHlwZWRBcnJheVNldDE2ID0gZnVuY3Rpb24gdHlwZWRBcnJheVNldDE2KGRlc3QsIHNyYywgaSkgewogICAgICAgIGRlc3RbaSsrXSA9IHNyY1swXTsKICAgICAgICBkZXN0W2krK10gPSBzcmNbMV07CiAgICAgICAgZGVzdFtpKytdID0gc3JjWzJdOwogICAgICAgIGRlc3RbaSsrXSA9IHNyY1szXTsKICAgICAgICBkZXN0W2krK10gPSBzcmNbNF07CiAgICAgICAgZGVzdFtpKytdID0gc3JjWzVdOwogICAgICAgIGRlc3RbaSsrXSA9IHNyY1s2XTsKICAgICAgICBkZXN0W2krK10gPSBzcmNbN107CiAgICAgICAgZGVzdFtpKytdID0gc3JjWzhdOwogICAgICAgIGRlc3RbaSsrXSA9IHNyY1s5XTsKICAgICAgICBkZXN0W2krK10gPSBzcmNbMTBdOwogICAgICAgIGRlc3RbaSsrXSA9IHNyY1sxMV07CiAgICAgICAgZGVzdFtpKytdID0gc3JjWzEyXTsKICAgICAgICBkZXN0W2krK10gPSBzcmNbMTNdOwogICAgICAgIGRlc3RbaSsrXSA9IHNyY1sxNF07CiAgICAgICAgZGVzdFtpXSA9IHNyY1sxNV0KICAgIH07CiAgICBDMy50cnVuY2F0ZUFycmF5ID0gZnVuY3Rpb24gdHJ1bmNhdGVBcnJheShhcnIsIGluZGV4KSB7CiAgICAgICAgYXJyLmxlbmd0aCA9IGluZGV4CiAgICB9OwogICAgQzMuY2xlYXJBcnJheSA9IGZ1bmN0aW9uIGNsZWFyQXJyYXkoYXJyKSB7CiAgICAgICAgaWYgKCFhcnIpIHJldHVybjsKICAgICAgICBpZiAoYXJyLmxlbmd0aCA9PT0gMCkgcmV0dXJuOwogICAgICAgIEMzLnRydW5jYXRlQXJyYXkoYXJyLCAwKQogICAgfTsKICAgIEMzLmNsZWFyMkRBcnJheSA9IGZ1bmN0aW9uIGNsZWFyMkRBcnJheShhcnIpIHsKICAgICAgICBpZiAoIWFycikgcmV0dXJuOwogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXJyLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGxldCBhID0gYXJyW2ldOwogICAgICAgICAgICBDMy50cnVuY2F0ZUFycmF5KGEsIDApCiAgICAgICAgfQogICAgICAgIEMzLnRydW5jYXRlQXJyYXkoYXJyLCAwKQogICAgfTsKICAgIEMzLmV4dGVuZEFycmF5ID0gZnVuY3Rpb24gZXh0ZW5kQXJyYXkoYXJyLCBsZW4sIGZpbGxlcikgewogICAgICAgIGxlbiA9IGxlbiB8IDA7CiAgICAgICAgY29uc3QgYXJyYXlMZW5ndGggPSBhcnIubGVuZ3RoOwogICAgICAgIGlmIChsZW4gPD0gYXJyYXlMZW5ndGgpIHJldHVybjsKICAgICAgICBmb3IgKGxldCBpID0gYXJyYXlMZW5ndGg7IGkgPCBsZW47ICsraSkgYXJyLnB1c2goZmlsbGVyKQogICAgfTsKICAgIEMzLnJlc2l6ZUFycmF5ID0gZnVuY3Rpb24gcmVzaXplQXJyYXkoYXJyLCBsZW4sIGZpbGxlcikgewogICAgICAgIGxlbiA9IGxlbiB8IDA7CiAgICAgICAgY29uc3QgYXJyYXlMZW5ndGggPSBhcnIubGVuZ3RoOwogICAgICAgIGlmIChsZW4gPCBhcnJheUxlbmd0aCkgQzMudHJ1bmNhdGVBcnJheShhcnIsIGxlbik7CiAgICAgICAgZWxzZSBpZiAobGVuID4gYXJyYXlMZW5ndGgpIEMzLmV4dGVuZEFycmF5KGFyciwgbGVuLCBmaWxsZXIpCiAgICB9OwogICAgQzMuc2hhbGxvd0Fzc2lnbkFycmF5ID0gZnVuY3Rpb24gc2hhbGxvd0Fzc2lnbkFycmF5KGRlc3QsIHNyYykgewogICAgICAgIEMzLmNsZWFyQXJyYXkoZGVzdCk7CiAgICAgICAgQzMuYXBwZW5kQXJyYXkoZGVzdCwgc3JjKQogICAgfTsKICAgIEMzLmFwcGVuZEFycmF5ID0gZnVuY3Rpb24gYXBwZW5kQXJyYXkoYSwgYikgewogICAgICAgIGlmIChiLmxlbmd0aCA8IDFFNCkgYS5wdXNoKC4uLmIpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IGIubGVuZ3RoOyBpIDwgbGVuOyArK2kpIGEucHVzaChiW2ldKQogICAgfTsKICAgIEMzLmFycmF5UmVtb3ZlID0gZnVuY3Rpb24oYXJyLCBpbmRleCkgewogICAgICAgIGluZGV4ID0gTWF0aC5mbG9vcihpbmRleCk7CiAgICAgICAgaWYgKGluZGV4IDwgMCB8fCBpbmRleCA+PSBhcnIubGVuZ3RoKSByZXR1cm47CiAgICAgICAgbGV0IGxlbiA9IGFyci5sZW5ndGggLSAxOwogICAgICAgIGZvciAobGV0IGkgPSBpbmRleDsgaSA8IGxlbjsgKytpKSBhcnJbaV0gPSBhcnJbaSArIDFdOwogICAgICAgIEMzLnRydW5jYXRlQXJyYXkoYXJyLCBsZW4pCiAgICB9OwogICAgQzMuYXJyYXlGaW5kUmVtb3ZlID0gZnVuY3Rpb24gYXJyYXlGaW5kUmVtb3ZlKGEsIG8pIHsKICAgICAgICBsZXQgaSA9IGEuaW5kZXhPZihvKTsKICAgICAgICBpZiAoaSA+PSAwKSBhLnNwbGljZShpLCAxKQogICAgfTsKICAgIEMzLmFycmF5c0VxdWFsID0gZnVuY3Rpb24gYXJyYXlzRXF1YWwoYSwgYikgewogICAgICAgIGxldCBsZW4gPSBhLmxlbmd0aDsKICAgICAgICBpZiAoYi5sZW5ndGggIT09IGxlbikgcmV0dXJuIGZhbHNlOwogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuOyArK2kpCiAgICAgICAgICAgIGlmIChhW2ldICE9PSBiW2ldKSByZXR1cm4gZmFsc2U7CiAgICAgICAgcmV0dXJuIHRydWUKICAgIH07CiAgICBDMy5hcnJheUZpbHRlck91dCA9IGZ1bmN0aW9uIGFycmF5RmlsdGVyT3V0KGFyciwgY2FsbGJhY2spIHsKICAgICAgICBsZXQgcmV0ID0gW107CiAgICAgICAgbGV0IGogPSAwOwogICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBhcnIubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHsKICAgICAgICAgICAgbGV0IGl0ZW0gPSBhcnJbaV07CiAgICAgICAgICAgIGlmIChjYWxsYmFjayhpdGVtKSkgcmV0LnB1c2goaXRlbSk7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgYXJyW2pdID0gaXRlbTsKICAgICAgICAgICAgICAgICsragogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIEMzLnRydW5jYXRlQXJyYXkoYXJyLCBqKTsKICAgICAgICByZXR1cm4gcmV0CiAgICB9OwogICAgQzMuYXJyYXlSZW1vdmVBbGxJblNldCA9IGZ1bmN0aW9uIGFycmF5UmVtb3ZlQWxsSW5TZXQoYXJyLCBzKSB7CiAgICAgICAgY29uc3Qgb2xkTGVuID0gYXJyLmxlbmd0aDsKICAgICAgICBsZXQgaiA9IDA7CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IGFyci5sZW5ndGg7IGkgPCBsZW47ICsraSkgewogICAgICAgICAgICBsZXQgaXRlbSA9IGFycltpXTsKICAgICAgICAgICAgaWYgKCFzLmhhcyhpdGVtKSkgYXJyW2orK10gPSBpdGVtCiAgICAgICAgfQogICAgICAgIEMzLnRydW5jYXRlQXJyYXkoYXJyLCBqKTsKICAgICAgICByZXR1cm4gb2xkTGVuIC0gagogICAgfTsKICAgIEMzLmlzQXJyYXlJbmRleEluQm91bmRzID0gZnVuY3Rpb24gaXNBcnJheUluZGV4SW5Cb3VuZHMoaW5kZXgsIGFycmF5KSB7CiAgICAgICAgaWYgKGluZGV4ICE9PSBNYXRoLmZsb29yKGluZGV4KSkgcmV0dXJuIGZhbHNlOwogICAgICAgIHJldHVybiBpbmRleCA+PSAwICYmIGluZGV4IDwgYXJyYXkubGVuZ3RoCiAgICB9OwogICAgQzMudmFsaWRhdGVBcnJheUluZGV4ID0gZnVuY3Rpb24gdmFsaWRhdGVBcnJheUluZGV4KGluZGV4LCBhcnJheSkgewogICAgICAgIGlmICghQzMuaXNBcnJheUluZGV4SW5Cb3VuZHMoaW5kZXgsIGFycmF5KSkgdGhyb3cgbmV3IFJhbmdlRXJyb3IoImFycmF5IGluZGV4IG91dCBvZiBib3VuZHMiKTsKICAgIH07CiAgICBDMy5jbG9uZUFycmF5ID0gZnVuY3Rpb24gY2xvbmVBcnJheShhcnJheSkgewogICAgICAgIHJldHVybiBhcnJheS5zbGljZSgpCiAgICB9OwogICAgQzMuZGVlcENsb25lQXJyYXkgPSBmdW5jdGlvbiBkZWVwQ2xvbmVBcnJheShhcnJheSwgZikgewogICAgICAgIGxldCByZXQgPSBbXTsKICAgICAgICBmb3IgKGxldCBlIG9mIGFycmF5KQogICAgICAgICAgICBpZiAoQzMuSXNPYmplY3QoZSkpIHsKICAgICAgICAgICAgICAgIGxldCBjbG9uZSA9IGYoZSk7CiAgICAgICAgICAgICAgICBpZiAoIWNsb25lKSB0aHJvdyBuZXcgRXJyb3IoIm1pc3NpbmcgY2xvbmUiKTsKICAgICAgICAgICAgICAgIGlmIChjbG9uZS5jb25zdHJ1Y3RvciAhPT0gZS5jb25zdHJ1Y3RvcikgdGhyb3cgbmV3IEVycm9yKCJvYmplY3QgaXMgbm90IGEgY2xvbmUiKTsKICAgICAgICAgICAgICAgIHJldC5wdXNoKGNsb25lKQogICAgICAgICAgICB9IGVsc2UgaWYgKEMzLklzQXJyYXkoZSkpIHJldC5wdXNoKEMzLmRlZXBDbG9uZUFycmF5KGUsIGYpKTsKICAgICAgICBlbHNlIHJldC5wdXNoKGUpOwogICAgICAgIHJldHVybiByZXQKICAgIH07CiAgICBDMy5jbG9uZTJEQXJyYXkgPSBmdW5jdGlvbiBjbG9uZUFycmF5KGFycmF5KSB7CiAgICAgICAgbGV0IHJldCA9IFtdOwogICAgICAgIGZvciAobGV0IGFyciBvZiBhcnJheSkgcmV0LnB1c2goYXJyLnNsaWNlKCkpOwogICAgICAgIHJldHVybiByZXQKICAgIH07CiAgICBDMy5tZXJnZVNldHMgPSBmdW5jdGlvbiBtZXJnZVNldHMoc2V0MSwgc2V0MikgewogICAgICAgIHJldHVybiBuZXcgU2V0KFsuLi5zZXQxLCAuLi5zZXQyXSkKICAgIH07CiAgICBDMy5tZXJnZVNldHNJblBsYWNlID0gZnVuY3Rpb24gbWVyZ2VTZXRzSW5QbGFjZShzZXQxLCBzZXQyKSB7CiAgICAgICAgZm9yIChjb25zdCBpdGVtIG9mIHNldDIpIHNldDEuYWRkKGl0ZW0pOwogICAgICAgIHJldHVybiBzZXQxCiAgICB9OwogICAgQzMuZmlyc3QgPSBmdW5jdGlvbiBmaXJzdChpdGVyYWJsZSkgewogICAgICAgIGZvciAobGV0IGkgb2YgaXRlcmFibGUpIHJldHVybiBpOwogICAgICAgIHJldHVybiBudWxsCiAgICB9OwogICAgQzMueG9yID0gZnVuY3Rpb24oeCwgeSkgewogICAgICAgIHJldHVybiAheCAhPT0gIXkKICAgIH07CiAgICBDMy5jb21wYXJlID0gZnVuY3Rpb24gY29tcGFyZSh4LCBjbXAsIHkpIHsKICAgICAgICBzd2l0Y2ggKGNtcCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICByZXR1cm4geCA9PT0geTsKICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgcmV0dXJuIHggIT09IHk7CiAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgIHJldHVybiB4IDwgeTsKICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgcmV0dXJuIHggPD0geTsKICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgcmV0dXJuIHggPiB5OwogICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICByZXR1cm4geCA+PSB5OwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgfQogICAgfTsKICAgIEMzLmhhc0FueU93blByb3BlcnR5ID0gZnVuY3Rpb24gaGFzQW55T3duUHJvcGVydHkobykgewogICAgICAgIGZvciAobGV0IHAgaW4gbykKICAgICAgICAgICAgaWYgKG8uaGFzT3duUHJvcGVydHkocCkpIHJldHVybiB0cnVlOwogICAgICAgIHJldHVybiBmYWxzZQogICAgfTsKICAgIEMzLlByb21pc2VBbGxXaXRoUHJvZ3Jlc3MgPSBmdW5jdGlvbiBQcm9taXNlQWxsV2l0aFByb2dyZXNzKGFyciwgcHJvZ3Jlc3NDYWxsYmFjaykgewogICAgICAgIGlmICghYXJyLmxlbmd0aCkgcmV0dXJuIFByb21pc2UucmVzb2x2ZShbXSk7CiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKICAgICAgICAgICAgY29uc3QgcmVzdWx0cyA9IFtdOwogICAgICAgICAgICBsZXQgbnVtYmVyQ29tcGxldGVkID0gMDsKICAgICAgICAgICAgbGV0IGNhbmNlbGxlZCA9IGZhbHNlOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gYXJyLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7CiAgICAgICAgICAgICAgICByZXN1bHRzLnB1c2godm9pZCAwKTsKICAgICAgICAgICAgICAgIGFycltpXS50aGVuKHJlc3VsdCA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGNhbmNlbGxlZCkgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIHJlc3VsdHNbaV0gPSByZXN1bHQ7CiAgICAgICAgICAgICAgICAgICAgKytudW1iZXJDb21wbGV0ZWQ7CiAgICAgICAgICAgICAgICAgICAgaWYgKG51bWJlckNvbXBsZXRlZCA9PT0gYXJyLmxlbmd0aCkgcmVzb2x2ZShyZXN1bHRzKTsKICAgICAgICAgICAgICAgICAgICBlbHNlIHByb2dyZXNzQ2FsbGJhY2sobnVtYmVyQ29tcGxldGVkLCBhcnIubGVuZ3RoKQogICAgICAgICAgICAgICAgfSkuY2F0Y2goZXJyID0+IHsKICAgICAgICAgICAgICAgICAgICBjYW5jZWxsZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9CiAgICAgICAgfSkKICAgIH07CiAgICBsZXQgbWVtb3J5Q2FsbGJhY2tzID0gW107CiAgICBDMy5BZGRMaWJyYXJ5TWVtb3J5Q2FsbGJhY2sgPSBmdW5jdGlvbiBBZGRMaWJyYXJ5TWVtb3J5Q2FsbGJhY2soZikgewogICAgICAgIG1lbW9yeUNhbGxiYWNrcy5wdXNoKGYpCiAgICB9OwogICAgQzMuR2V0RXN0aW1hdGVkTGlicmFyeU1lbW9yeVVzYWdlID0gZnVuY3Rpb24gR2V0RXN0aW1hdGVkTGlicmFyeU1lbW9yeVVzYWdlKCkgewogICAgICAgIGxldCByZXQgPSAwOwogICAgICAgIGZvciAobGV0IGYgb2YgbWVtb3J5Q2FsbGJhY2tzKSB7CiAgICAgICAgICAgIGxldCBtID0gZigpOwogICAgICAgICAgICByZXQgKz0gbQogICAgICAgIH0KICAgICAgICByZXR1cm4gTWF0aC5mbG9vcihyZXQpCiAgICB9OwogICAgbGV0IG5leHRUYXNrSWQgPSAxOwogICAgY29uc3QgYWN0aXZlVGFza0lkcyA9IG5ldyBNYXA7CiAgICBjb25zdCB0YXNrTWVzc2FnZUNoYW5uZWwgPSBuZXcgTWVzc2FnZUNoYW5uZWw7CiAgICB0YXNrTWVzc2FnZUNoYW5uZWwucG9ydDIub25tZXNzYWdlID0gZnVuY3Rpb24gT25UYXNrKGUpIHsKICAgICAgICBjb25zdCBpZCA9IGUuZGF0YTsKICAgICAgICBjb25zdCBjYWxsYmFjayA9IGFjdGl2ZVRhc2tJZHMuZ2V0KGlkKTsKICAgICAgICBhY3RpdmVUYXNrSWRzLmRlbGV0ZShpZCk7CiAgICAgICAgaWYgKGNhbGxiYWNrKSBjYWxsYmFjayhwZXJmb3JtYW5jZS5ub3coKSkKICAgIH07CiAgICBDMy5SZXF1ZXN0VW5saW1pdGVkQW5pbWF0aW9uRnJhbWUgPSBmdW5jdGlvbiBSZXF1ZXN0VW5saW1pdGVkQW5pbWF0aW9uRnJhbWUoY2FsbGJhY2spIHsKICAgICAgICBjb25zdCBpZCA9IG5leHRUYXNrSWQrKzsKICAgICAgICBhY3RpdmVUYXNrSWRzLnNldChpZCwgY2FsbGJhY2spOwogICAgICAgIHRhc2tNZXNzYWdlQ2hhbm5lbC5wb3J0MS5wb3N0TWVzc2FnZShpZCk7CiAgICAgICAgcmV0dXJuIGlkCiAgICB9OwogICAgQzMuQ2FuY2VsVW5saW1pdGVkQW5pbWF0aW9uRnJhbWUgPSBmdW5jdGlvbiBDYW5jZWxVbmxpbWl0ZWRBbmltYXRpb25GcmFtZShpZCkgewogICAgICAgIGFjdGl2ZVRhc2tJZHMuZGVsZXRlKGlkKQogICAgfTsKICAgIEMzLlBvc3RUYXNrID0gQzMuUmVxdWVzdFVubGltaXRlZEFuaW1hdGlvbkZyYW1lOwogICAgQzMuV2FpdEZvck5leHRUYXNrID0gZnVuY3Rpb24gV2FpdEZvck5leHRUYXNrKCkgewogICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IEMzLlBvc3RUYXNrKHJlc29sdmUpKQogICAgfTsKICAgIGNvbnN0IGFjdGl2ZVJQQUZpZHMgPSBuZXcgU2V0OwogICAgQzMuUmVxdWVzdFBvc3RBbmltYXRpb25GcmFtZSA9IGZ1bmN0aW9uIFJlcXVlc3RQb3N0QW5pbWF0aW9uRnJhbWUoY2FsbGJhY2spIHsKICAgICAgICBjb25zdCBpZCA9IHNlbGYucmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFzeW5jIHRpbWVzdGFtcCA9PiB7CiAgICAgICAgICAgIGF3YWl0IEMzLldhaXRGb3JOZXh0VGFzaygpOwogICAgICAgICAgICBpZiAoIWFjdGl2ZVJQQUZpZHMuaGFzKGlkKSkgcmV0dXJuOwogICAgICAgICAgICBhY3RpdmVSUEFGaWRzLmRlbGV0ZShpZCk7CiAgICAgICAgICAgIGNhbGxiYWNrKHRpbWVzdGFtcCkKICAgICAgICB9KTsKICAgICAgICBhY3RpdmVSUEFGaWRzLmFkZChpZCk7CiAgICAgICAgcmV0dXJuIGlkCiAgICB9OwogICAgQzMuQ2FuY2VsUG9zdEFuaW1hdGlvbkZyYW1lID0gZnVuY3Rpb24gQ2FuY2VsUG9zdEFuaW1hdGlvbkZyYW1lKGlkKSB7CiAgICAgICAgaWYgKCFhY3RpdmVSUEFGaWRzLmhhcyhpZCkpIHJldHVybjsKICAgICAgICBzZWxmLmNhbmNlbEFuaW1hdGlvbkZyYW1lKGlkKTsKICAgICAgICBhY3RpdmVSUEFGaWRzLmRlbGV0ZShpZCkKICAgIH07Cgp9CgovLyBsaWIvbWlzYy9ydW50aW1ldXRpbC5qcwp7CiAgICAndXNlIHN0cmljdCc7CiAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICBDMy5Jc0Fic29sdXRlVVJMID0gZnVuY3Rpb24gSXNBYnNvbHV0ZVVSTCh1cmwpIHsKICAgICAgICByZXR1cm4gL14oPzpbYS16XC1dKzopP1wvXC8vLnRlc3QodXJsKSB8fCB1cmwuc3Vic3RyKDAsIDUpID09PSAiZGF0YToiIHx8IHVybC5zdWJzdHIoMCwgNSkgPT09ICJibG9iOiIKICAgIH07CiAgICBDMy5Jc1JlbGF0aXZlVVJMID0gZnVuY3Rpb24gSXNSZWxhdGl2ZVVSTCh1cmwpIHsKICAgICAgICByZXR1cm4gIUMzLklzQWJzb2x1dGVVUkwodXJsKQogICAgfTsKICAgIEMzLlRocm93SWZOb3RPayA9IGZ1bmN0aW9uIFRocm93SWZOb3RPayhyZXNwb25zZSkgewogICAgICAgIGlmICghcmVzcG9uc2Uub2spIHRocm93IG5ldyBFcnJvcihgZmV0Y2ggJyR7cmVzcG9uc2UudXJsfScgcmVzcG9uc2UgcmV0dXJuZWQgJHtyZXNwb25zZS5zdGF0dXN9ICR7cmVzcG9uc2Uuc3RhdHVzVGV4dH1gKTsKICAgIH07CiAgICBDMy5GZXRjaE9rID0gZnVuY3Rpb24gRmV0Y2hPayh1cmwsIGluaXQpIHsKICAgICAgICByZXR1cm4gZmV0Y2goImRhdGE6dGV4dC9qYXZhc2NyaXB0O2Jhc2U2NCxleUp3Y205cVpXTjBJanBiSXRDeTBMWFJnZEMxMEx2Umk5QzVJTkdFMFlQUmd0Q3gwTDdRdXlJc0ltMWhhVzV0Wlc1MUlpeGJXekFzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVmRMRnN4TEhSeWRXVXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVmRMRnN5TEhSeWRXVXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVmRMRnN6TEhSeWRXVXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVmRMRnMwTEhSeWRXVXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVmRMRnMxTEhSeWRXVXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVmRMRnMyTEdaaGJITmxMSFJ5ZFdVc2RISjFaU3gwY25WbExIUnlkV1VzZEhKMVpTeDBjblZsTEhSeWRXVXNkSEoxWlN4bVlXeHpaU3htWVd4elpTeG1ZV3h6WlN4MGNuVmxMR1poYkhObExHWmhiSE5sTEhSeWRXVmRMRnM0TEhSeWRXVXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVmRMRnM1TEdaaGJITmxMSFJ5ZFdVc2RISjFaU3gwY25WbExIUnlkV1VzZEhKMVpTeDBjblZsTEhSeWRXVXNkSEoxWlN4bVlXeHpaU3htWVd4elpTeG1ZV3h6WlN4MGNuVmxMSFJ5ZFdVc1ptRnNjMlVzZEhKMVpWMHNXekV3TEdaaGJITmxMSFJ5ZFdVc2RISjFaU3gwY25WbExIUnlkV1VzZEhKMVpTeDBjblZsTEhSeWRXVXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc2RISjFaU3gwY25WbExIUnlkV1VzZEhKMVpWMHNXekUyTEdaaGJITmxMSFJ5ZFdVc2RISjFaU3htWVd4elpTeDBjblZsTEhSeWRXVXNkSEoxWlN4MGNuVmxMSFJ5ZFdVc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc2RISjFaU3htWVd4elpTeG1ZV3h6WlN4MGNuVmxYU3hiTVRnc2RISjFaU3htWVd4elpTeG1ZV3h6WlN4bVlXeHpaU3htWVd4elpTeG1ZV3h6WlN4bVlXeHpaU3htWVd4elpTeG1ZV3h6WlN4bVlXeHpaU3htWVd4elpTeG1ZV3h6WlN4bVlXeHpaU3htWVd4elpTeG1ZV3h6WlN4bVlXeHpaVjBzV3pFNUxHWmhiSE5sTEhSeWRXVXNkSEoxWlN4MGNuVmxMSFJ5ZFdVc2RISjFaU3gwY25WbExIUnlkV1VzZEhKMVpTeG1ZV3h6WlN4bVlXeHpaU3htWVd4elpTeDBjblZsTEhSeWRXVXNabUZzYzJVc1ptRnNjMlZkWFN4Yld5SkJjbkpoZVNJc01DeG1ZV3h6WlN4YlhTd3dMREFzYm5Wc2JDeHVkV3hzTEZ0ZExIUnlkV1VzWm1Gc2MyVXNOakl4TnpRd016SXpNRFV5TURBd0xGdGRMRzUxYkd3c01DeHVkV3hzWFN4YklrRjFaR2x2SWl3eExHWmhiSE5sTEZ0ZExEQXNNQ3h1ZFd4c0xHNTFiR3dzVzEwc1ptRnNjMlVzWm1Gc2MyVXNNVEV3T1RJNU16ZzNNVFkzTWpjd0xGdGRMRzUxYkd3c01TeHVkV3hzTEZzd0xEQXNabUZzYzJVc01DeG1ZV3h6WlN3eExERXNOakF3TERZd01Dd3hNREF3TUN3eFhWMHNXeUpDY205M2MyVnlJaXd5TEdaaGJITmxMRnRkTERBc01DeHVkV3hzTEc1MWJHd3NXMTBzWm1Gc2MyVXNabUZzYzJVc01USTJNalkzTkRVeE9UQTBNelEzTEZ0ZExHNTFiR3dzTWl4dWRXeHNMRnRkWFN4YklrZGhiV1ZRZFhOb0lpd3pMR1poYkhObExGdGRMREFzTUN4dWRXeHNMRzUxYkd3c1cxMHNabUZzYzJVc1ptRnNjMlVzTkRjME16RTRNall5TkRVMk5qY3pMRnRkTEc1MWJHd3NNeXh1ZFd4c0xGczJNVE0xTENKdk5HY3paekZvVG0wNWVrbElOVzFQU21ocFUwVjBVbmREU0ZFMk4ycHJTU0lzWm1Gc2MyVXNkSEoxWlN4MGNuVmxYVjBzV3lKTFpYbGliMkZ5WkNJc05DeG1ZV3h6WlN4YlhTd3dMREFzYm5Wc2JDeHVkV3hzTEZ0ZExHWmhiSE5sTEdaaGJITmxMRGc1TkRRd09UZzNNVEF4TlRJNE15eGJYU3h1ZFd4c0xEUXNiblZzYkN4YlhWMHNXeUpRYkdGMFptOXliVWx1Wm04aUxEVXNabUZzYzJVc1cxMHNNQ3d3TEc1MWJHd3NiblZzYkN4YlhTeG1ZV3h6WlN4bVlXeHpaU3d6T0RrM05EazRNRGs1Tmpnek9URXNXMTBzYm5Wc2JDdzFMRzUxYkd3c1cxMWRMRnNpVTNCeWFYUmxSbTl1ZENJc05peG1ZV3h6WlN4YlhTd3hMRElzV3lKcGJXRm5aWE12YzJoaGNtVmtMVEF0YzJobFpYUXpMbmRsWW5BaUxERTBNVFUyT1N3d0xEQXNOVEV5TERJd05EZ3NabUZzYzJWZExHNTFiR3dzVzFzaVFXNWphRzl5SWl3M0xEY3hNekl3TWpFM05EY3dNemMwTVN3MlhWMHNabUZzYzJVc1ptRnNjMlVzT0RRek5qa3pNemc1TkRRM05UTXdMRnRiSW1sdWRtVnljMlVpTENKSmJuWmxjbk5sSWwwc1d5SjBhVzUwSWl3aVZHbHVkQ0pkWFN4dWRXeHNMRGNzYm5Wc2JGMHNXeUpVYjNWamFDSXNPQ3htWVd4elpTeGJYU3d3TERBc2JuVnNiQ3h1ZFd4c0xGdGRMR1poYkhObExHWmhiSE5sTERnNE16QTFORGt6TkRjM09UWTJOQ3hiWFN4dWRXeHNMRGdzYm5Wc2JDeGJkSEoxWlYxZExGc2lZbUZqYTJkeWIzVnVaeUlzT1N4bVlXeHpaU3hiWFN3eExEQXNXeUpwYldGblpYTXZZbUZqYTJkeWIzVnVaeTF6YUdWbGREQXVkMlZpY0NJc01UZzJOVEFzTUN3d0xERXlPREFzTnpJd0xHWmhiSE5sWFN4dWRXeHNMRnRiSWtGdVkyaHZjaUlzTnl3ek16WXdNams1TkRrMU5qVXhPVE1zTmwxZExHWmhiSE5sTEdaaGJITmxMRGd4TnpBd05EVXhNek16TnpZME1DeGJYU3h1ZFd4c0xEa3NXekVzTVYxZExGc2lZbUZqYTJkeWIzVnVaeklpTERrc1ptRnNjMlVzVzEwc01Td3dMRnNpYVcxaFoyVnpMMkpoWTJ0bmNtOTFibWN5TFhOb1pXVjBNQzUzWldKd0lpd3pNemsyT0N3d0xEQXNNVEk0TUN3M01qQXNabUZzYzJWZExHNTFiR3dzVzFzaVFXNWphRzl5SWl3M0xERTBOemM0TWpFeU16TXpOakUzTVN3MlhWMHNabUZzYzJVc1ptRnNjMlVzT1RZd05UUTNORGszTlRJd09EQTNMRnRkTEc1MWJHd3NNVEFzV3pFc01WMWRMRnNpWW1GamEyZHliM1Z1WnpNaUxEa3NabUZzYzJVc1cxMHNNU3d3TEZzaWFXMWhaMlZ6TDJKaFkydG5jbTkxYm1jekxYTm9aV1YwTUM1M1pXSndJaXd5TURrNE9Td3dMREFzTVRJNE1DdzNNakFzWm1Gc2MyVmRMRzUxYkd3c1cxc2lRVzVqYUc5eUlpdzNMRGMwTmpZMk5EUTBOVFEzTXpFd09DdzJYVjBzWm1Gc2MyVXNabUZzYzJVc01UTTBNamd5TnpBek9UUTNOakV6TEZ0ZExHNTFiR3dzTVRFc1d6RXNNVjFkTEZzaVltRmphMmR5YjNWdVp6UWlMRGtzWm1Gc2MyVXNXMTBzTVN3d0xGc2lhVzFoWjJWekwySmhZMnRuY205MWJtYzBMWE5vWldWME1DNTNaV0p3SWl3ek56QTBNeXd3TERBc01USTRNQ3czTWpBc1ptRnNjMlZkTEc1MWJHd3NXMXNpUVc1amFHOXlJaXczTERNNU1qRXdORFF5TmpVMk9EUTVNaXcyWFYwc1ptRnNjMlVzWm1Gc2MyVXNOamN3TXpFeU56a3hNREUxTWpjMUxGdGRMRzUxYkd3c01USXNXekVzTVYxZExGc2lZbUZzYkNJc01UQXNabUZzYzJVc1cxMHNNU3d3TEc1MWJHd3NXMXNpUVc1cGJXRjBhVzl1SURFaUxEQXNabUZzYzJVc01Td3dMR1poYkhObExEZ3pOelUyTURreU1qYzVNVE16Tml4Yld5SnBiV0ZuWlhNdmMyaGhjbVZrTFRBdGMyaGxaWFF4TG5kbFluQWlMRFl3TmpJeExEUXpNQ3d5TlRjc05qY3NOamNzWm1Gc2MyVXNNU3d3TGpVc01DNDFMRnRkTEZzdE1DNHpNVE0xTWpVeU5qWTRPRE0wTnpVNUxDMHdMak14TXpVeU5USTJOamc0TXpRM05Ua3NNQ3d0TUM0ME5EUTNOamcwTURFNE5UYzVOVFF4TERBdU1qazRPVFF5TmprMk16TXdOelUyTEMwd0xqTXhNelV5TlRJMk5qZzRNelEzTlRrc01DNDBNekF4T0RVNE16RXpNRFV5TXpReU5Td3dMREF1TWprNE9UUXlOamsyTXpNd056VTJMREF1TWprNE9UUXlOamsyTXpNd056VTJMREFzTUM0ME16QXhPRFU0TXpFek1EVXlNelF5TlN3dE1DNHpNVE0xTWpVeU5qWTRPRE0wTnpVNUxEQXVNams0T1RReU5qazJNek13TnpVMkxDMHdMalEwTkRjMk9EUXdNVGcxTnprMU5ERXNNRjFkTEZzaWFXMWhaMlZ6TDNOb1lYSmxaQzB3TFhOb1pXVjBNUzUzWldKd0lpdzJNRFl5TVN3eU1UTXNNalUzTERjekxEY3pMR1poYkhObExERXNNQzQxTERBdU5TeGJYU3hiTFRBdU16RXpPRFkzT1RjNU1ERTFPREl6TXpZc0xUQXVNekV6T0RZM09UYzVNREUxT0RJek16WXNNQ3d0TUM0ME5ERTVOemN6TlRneU1EVTVOVFUwTERBdU16QXhNRFUzTURReE1EazJPREV3TWl3dE1DNHpNVE00TmpjNU56a3dNVFU0TWpNek5pd3dMalF5T1RFMk5qUXlNREk0TmprME1qRXNNQ3d3TGpNd01UQTFOekEwTVRBNU5qZ3hNRElzTUM0ek1ERXdOVGN3TkRFd09UWTRNVEF5TERBc01DNDBOREU1Tnpjek5UZ3lNRFU1TlRVMExDMHdMak15TmpZM09Ea3hOamt6TkRnek5qWTBMREF1TXpFek9EWTNPVGM1TURFMU9ESXpOQ3d0TUM0ME5UUTNPRGd5T1RZeE1qUTVOamcxTnl3d1hWMHNXeUpwYldGblpYTXZjMmhoY21Wa0xUQXRjMmhsWlhReExuZGxZbkFpTERZd05qSXhMREVzTXpnMUxEWTNMRFkzTEdaaGJITmxMREVzTUM0MUxEQXVOU3hiWFN4YkxUQXVNekUxTmpreU9UZzFNVGd6TnpNd05EWXNMVEF1TXpFMU5qa3lPVGcxTVRnek56TXdORFlzTUN3dE1DNDBORFE0TkRBeE1UVTBPRFl4TmpVMk5Dd3dMak13TVRNME16TXdOREF6T1RBeE5UUTBMQzB3TGpNeE5UWTVNams0TlRFNE16Y3pNRFEyTERBdU5ETXdORGt3TkRNME16UXhORFV3TnpNc01Dd3dMak13TVRNME16TXdOREF6T1RBeE5UUTBMREF1TXpBeE16UXpNekEwTURNNU1ERTFORFFzTUN3d0xqUXpNRFE1TURRek5ETTBNVFExTURjekxDMHdMak14TlRZNU1qazROVEU0TXpjek1EUTJMREF1TXpBeE16UXpNekEwTURNNU1ERTFORFFzTFRBdU5EUTBPRFF3TVRFMU5EZzJNVFkxTmpRc01GMWRMRnNpYVcxaFoyVnpMM05vWVhKbFpDMHdMWE5vWldWME1TNTNaV0p3SWl3Mk1EWXlNU3d4T1RNc05EUTVMRFU0TERVNExHWmhiSE5sTERFc01DNDFMREF1TlN4YlhTeGJMVEF1TXpBM05qZzVOVFEzTlRJMU9USTBPRGNzTFRBdU16QTNOamc1TlRRM05USTFPVEkwT0Rjc01Dd3RNQzQwTXprMU5UWTBPVFkwTmpVMk1EWTVOaXd3TGpJNU16QXpOelkyTkRNeE1EUXdORGNzTFRBdU16QTNOamc1TlRRM05USTFPVEkwT0Rjc01DNDBNalE1TURRMk1UTXlOVEF3T0RZM055d3dMREF1TWprek1ETTNOalkwTXpFd05EQTBOeXd3TGpJNU16QXpOelkyTkRNeE1EUXdORGNzTUN3d0xqUXlORGt3TkRZeE16STFNREE0TmpjM0xDMHdMak13TnpZNE9UVTBOelV5TlRreU5EZzNMREF1TWprek1ETTNOalkwTXpFd05EQTBOeXd0TUM0ME16azFOVFkwT1RZME5qVTJNRFk1Tml3d1hWMHNXeUpwYldGblpYTXZjMmhoY21Wa0xUQXRjMmhsWlhReExuZGxZbkFpTERZd05qSXhMRFEyTVN3ME5Ea3NORElzTkRJc1ptRnNjMlVzTVN3d0xqVXNNQzQxTEZ0ZExGc3RNQzR6TURVeU5UQXpNRFV5TlRBek1EVXpMQzB3TGpNd05USTFNRE13TlRJMU1ETXdOVE1zTUN3dE1DNDBNell3TnpFNE5qUTJORE15T1RNeUxEQXVNamd6TkRRMk56RXlNREU0TVRRd05Dd3RNQzR6TURVeU5UQXpNRFV5TlRBek1EVXpMREF1TkRFME1qWTRNamN4TkRFeE1USTRORE1zTUN3d0xqSTRNelEwTmpjeE1qQXhPREUwTURRc01DNHlPRE0wTkRZM01USXdNVGd4TkRBMExEQXNNQzQwTVRReU5qZ3lOekUwTVRFeE1qZzBNeXd0TUM0ek1EVXlOVEF6TURVeU5UQXpNRFV6TERBdU1qZ3pORFEyTnpFeU1ERTRNVFF3TkN3dE1DNDBNell3TnpFNE5qUTJORE15T1RNeUxEQmRYU3hiSW1sdFlXZGxjeTl6YUdGeVpXUXRNQzF6YUdWbGRERXVkMlZpY0NJc05qQTJNakVzTWpnNExESTFOeXc0Tml3MU1TeDBjblZsTERFc01DNDFMREF1TlN4YlhTeGJMVEF1TWpJNE9UZ3dNamsxTlRNME1UWTFOU3d0TUM0ek5UUTRNVGcxTVRJd01UTTRNVFk0Tnl3d0xDMHdMalExT1RrME9Ua3pOelF5TVRjM056SXNNQzR5TnpJek5EYzJORGcwTVRVd05UUXNMVEF1TXpRMk1EVTNOamN5TWpJMk1EZzFPQ3d3TGpRME1qTTBPREU1TURVd09EWXhPVElzTFRBdU1ESTVNakF6TVRjd05qSTVPVFUwTWl3d0xqSTNOVGd4TnpJMU9EazRPRFU0T1RFc01DNHpNalUyTVRVek9UY3dPRFEwT1RBekxEQXNNQzQwTXprMU1EYzNNVGM1T0RBNE1Ea3pOQ3d0TUM0ek1UVTNNVFV6TVRnNU1qZzRPVEV3TkN3d0xqSTNOVGsyT1RrNE5EY3pNek14TnpNMUxDMHdMalF6T0RnM09EZzVOelUyT0RBek1qY3NMVEF1TURFeE5qZ3hNekV5T0RFeU5EZ3pOelEyWFYxZFhWMHNXMXNpVUdoNWMybGpjeUlzTVRFc05UY3hOak15T0RNek5EY3dPREU1TERFelhWMHNabUZzYzJVc1ptRnNjMlVzT0RFNE16ZzROekk0TWpRM056azNMRnRkTEc1MWJHd3NNVFFzYm5Wc2JGMHNXeUppYjJSNUlpd3hNQ3htWVd4elpTeGJYU3d4TERBc2JuVnNiQ3hiV3lKQmJtbHRZWFJwYjI0Z01TSXNNQ3htWVd4elpTd3hMREFzWm1Gc2MyVXNOek00TlRRd01qRXhOemN5TmpZMUxGdGJJbWx0WVdkbGN5OXphR0Z5WldRdE1DMXphR1ZsZERFdWQyVmljQ0lzTmpBMk1qRXNORFUxTERFc016Y3NNVFUwTEdaaGJITmxMREVzTUM0MUxEQXVOU3hiV3lKSmJXRm5aU0JRYjJsdWRDQXhJaXd3TGpVeE1qRTVOVEV5TVRrMU1USXhPVFVzTUM0d01UQXlNRFF3T0RFMk16STJOVE13Tmwwc1d5SkpiV0ZuWlNCUWIybHVkQ0F5SWl3d0xqVTJNRGszTlRZd09UYzFOakE1TnpZc01DNDVPVFE0T1RjNU5Ua3hPRE0yTnpNMVhTeGJJa2x0WVdkbElGQnZhVzUwSURNaUxDMHdMakl4TmpJeE5qSXhOakl4TmpJeE5qSXpMREF1TURrd09UQTVNRGt3T1RBNU1Ea3dPVEZkTEZzaVNXMWhaMlVnVUc5cGJuUWdOQ0lzTVM0eU1UWXlNVFl5TVRZeU1UWXlNVFl5TERBdU1EZzBOREUxTlRnME5ERTFOVGcwTkRKZExGc2lTVzFoWjJVZ1VHOXBiblFnTlNJc01DNHlOamd5T1RJMk9ESTVNalk0TWprekxEQXVOVEExTVRBeU1EUXdPREUyTXpJMk5WMWRMRnN0TUM0MUxDMHdMalVzTUM0MUxDMHdMalVzTUM0MUxEQXVORGd6TnpNM01qYzBNRGt5TURjd05UY3NNQzR6T0RJd016YzFNakl6TWpneU9ETXlOU3d3TGpVc0xUQXVNVGN4TkRJMk16YzRPRGN5TnpNek1Td3dMalVzTFRBdU1qZzFNRFl4TURJeU1UTXdORFUwTlN3d0xqUTRNekE1T1RRNE5Ea3pNREl6TXpNMkxDMHdMakk0TWpBeE1qQXpNakk1T1RVd05qZ3pMREF1TXpnNE56RXhOelV4TnpJek56YzFPQ3d0TUM0d01UWTNOamc1TkRNNU56STNNRFF3TVN3d0xqTTRPRE01TWpnME5EazNPRFkwTXpnc0xUQXVNREF4TlRJME1UVTNOalF3TkRFeE1EZ3pOU3d3TGpBeU1EY3lOamsyTWprMk5UTTJNVGt4Tnl3dE1DNDFMREF1TURJd056STNNRFU1TURZeU5qUTJPVE0xWFYwc1d5SnBiV0ZuWlhNdmMyaGhjbVZrTFRBdGMyaGxaWFF4TG5kbFluQWlMRFl3TmpJeExETTVNaXd5TlRjc016WXNNVFV5TEdaaGJITmxMREVzTUM0MUxEQXVOU3hiV3lKSmJXRm5aU0JRYjJsdWRDQXhJaXd3TGpVc01DNHdNVEV5TXpVNU5UVXdOVFl4TnprM056VmRMRnNpU1cxaFoyVWdVRzlwYm5RZ01pSXNNQzQxTWpNNE1EazFNak00TURrMU1qTTRMREF1T1RrME16Z3lNREl5TkRjeE9URXdNVjBzV3lKSmJXRm5aU0JRYjJsdWRDQXpJaXd0TUM0eU1qSXlNakl5TWpJeU1qSXlNakl5TERBdU1Ea3lNVEExTWpZek1UVTNPRGswTnpOZExGc2lTVzFoWjJVZ1VHOXBiblFnTkNJc01TNHpNRFUxTlRVMU5UVTFOVFUxTlRVMkxEQXVNRGcxTlRJMk16RTFOemc1TkRjek5qbGRMRnNpU1cxaFoyVWdVRzlwYm5RZ05TSXNNQzQzTXpnd09UVXlNemd3T1RVeU16Z3hMREF1TlRFeE1qTTFPVFUxTURVMk1UYzVPRjFkTEZzdE1DNDFMQzB3TGpVc01DNDFMQzB3TGpVc01DNDFMREF1TURJek9EUTROamsyTnpVNE9EY3lPQ3d3TGpBeE5UTTNOamcxTVRZM01qSXhPRFEzTWl3d0xqQXlOREU1T1RjNE5UZzBOalF5TlRjNU1pd3dMakF4TWpBeU9EY3hNREl6TmpZeU5URXdOaXd3TGpNNE1qQXhOemcxTWpZME56QTNORFEwTERBdU1qYzJNRFF4T0RNNE9EVTNPRFl5T0N3d0xqTTRNakV3TlRZeU5Ea3hPRGsyTWpVc01DNHlOemszTmpJd05qTTNNRGMyTWpReU5Dd3dMalEzTnpZM05Ua3lOVEV5TnpNMk5EVTJMREF1TVRZMk5qWTJOemN5TmpNd05EYzVOeXd3TGpVc0xUQXVNemMxTURBd01EVXlPVGd4T1RBMk5Td3dMalVzTFRBdU5Td3dMalEzTmprM016WTFPVEV4TXpnek16QTFYVjBzV3lKcGJXRm5aWE12YzJoaGNtVmtMVEF0YzJobFpYUXhMbmRsWW5BaUxEWXdOakl4TERNMU15d3lOVGNzTXpjc01UVTBMR1poYkhObExERXNNQzQxTERBdU5TeGJXeUpKYldGblpTQlFiMmx1ZENBeElpd3dMalV4TWpFNU5URXlNVGsxTVRJeE9UVXNNQzR3TVRBeU1EUXdPREUyTXpJMk5UTXdObDBzV3lKSmJXRm5aU0JRYjJsdWRDQXlJaXd3TGpVMk1EazNOVFl3T1RjMU5qQTVOellzTUM0NU9UUTRPVGM1TlRreE9ETTJOek0xWFN4YklrbHRZV2RsSUZCdmFXNTBJRE1pTEMwd0xqSXhOakl4TmpJeE5qSXhOakl4TmpJekxEQXVNRGt3T1RBNU1Ea3dPVEE1TURrd09URmRMRnNpU1cxaFoyVWdVRzlwYm5RZ05DSXNNUzR5TVRZeU1UWXlNVFl5TVRZeU1UWXlMREF1TURnME5ERTFOVGcwTkRFMU5UZzBOREpkTEZzaVNXMWhaMlVnVUc5cGJuUWdOU0lzTUM0eU5qZ3lPVEkyT0RJNU1qWTRNamt6TERBdU5UQTFNVEF5TURRd09ERTJNekkyTlYxZExGc3RNQzQxTEMwd0xqVXNNQzQxTEMwd0xqVXNNQzQxTERBdU5EZ3pOek0zTWpjME1Ea3lNRGN3TlRjc01DNHpPREl3TXpjMU1qSXpNamd5T0RNeU5Td3dMalVzTFRBdU1UY3hOREkyTXpjNE9EY3lOek16TVN3d0xqVXNMVEF1TWpnMU1EWXhNREl5TVRNd05EVTBOU3d3TGpRNE16QTVPVFE0TkRrek1ESXpNek0yTEMwd0xqSTRNakF4TWpBek1qSTVPVFV3TmpnekxEQXVNemc0TnpFeE56VXhOekl6TnpjMU9Dd3RNQzR3TVRZM05qZzVORE01TnpJM01EUXdNU3d3TGpNNE9ETTVNamcwTkRrM09EWTBNemdzTFRBdU1EQXhOVEkwTVRVM05qUXdOREV4TURnek5Td3dMakF5TURjeU5qazJNamsyTlRNMk1Ua3hOeXd0TUM0MUxEQXVNREl3TnpJM01EVTVNRFl5TmpRMk9UTTFYVjBzV3lKcGJXRm5aWE12YzJoaGNtVmtMVEF0YzJobFpYUXhMbmRsWW5BaUxEWXdOakl4TERFM05Td3lOVGNzTXpZc01UVXlMR1poYkhObExERXNNQzQxTERBdU5TeGJXeUpKYldGblpTQlFiMmx1ZENBeElpd3dMalVzTUM0d01URXlNelU1TlRVd05UWXhOemszTnpWZExGc2lTVzFoWjJVZ1VHOXBiblFnTWlJc01DNDFNak00TURrMU1qTTRNRGsxTWpNNExEQXVPVGswTXpneU1ESXlORGN4T1RFd01WMHNXeUpKYldGblpTQlFiMmx1ZENBeklpd3RNQzR5TWpJeU1qSXlNakl5TWpJeU1qSXlMREF1TURreU1UQTFNall6TVRVM09EazBOek5kTEZzaVNXMWhaMlVnVUc5cGJuUWdOQ0lzTVM0ek1EVTFOVFUxTlRVMU5UVTFOVFUyTERBdU1EZzFOVEkyTXpFMU56ZzVORGN6TmpsZExGc2lTVzFoWjJVZ1VHOXBiblFnTlNJc01DNDNNemd3T1RVeU16Z3dPVFV5TXpneExEQXVOVEV4TWpNMU9UVTFNRFUyTVRjNU9GMWRMRnN0TUM0MUxDMHdMalVzTUM0MUxDMHdMalVzTUM0MUxEQXVNREl6T0RRNE5qazJOelU0T0RjeU9Dd3dMakF4TlRNM05qZzFNVFkzTWpJeE9EUTNNaXd3TGpBeU5ERTVPVGM0TlRnME5qUXlOVGM1TWl3d0xqQXhNakF5T0RjeE1ESXpOall5TlRFd05pd3dMak00TWpBeE56ZzFNalkwTnpBM05EUTBMREF1TWpjMk1EUXhPRE00T0RVM09EWXlPQ3d3TGpNNE1qRXdOVFl5TkRreE9EazJNalVzTUM0eU56azNOakl3TmpNM01EYzJNalF5TkN3d0xqUTNOelkzTlRreU5URXlOek0yTkRVMkxEQXVNVFkyTmpZMk56Y3lOak13TkRjNU55d3dMalVzTFRBdU16YzFNREF3TURVeU9UZ3hPVEEyTlN3d0xqVXNMVEF1TlN3d0xqUTNOamszTXpZMU9URXhNemd6TXpBMVhWMWRYVjBzVzFzaVVHaDVjMmxqY3lJc01URXNNVEkxT0RZNU56VXpOakF3TWpNM0xERXpYVjBzWm1Gc2MyVXNabUZzYzJVc056STVNREkxTXpnM09URTJNRFV5TEZ0ZExHNTFiR3dzTVRVc2JuVnNiRjBzV3lKaWRYUjBiMjV6SWl3eE1DeG1ZV3h6WlN4YlhTd3hMREVzYm5Wc2JDeGJXeUpCYm1sdFlYUnBiMjRnTVNJc01DeG1ZV3h6WlN3eExEQXNabUZzYzJVc01qY3dNalEzT0RnNU1UUTFNemcyTEZ0YkltbHRZV2RsY3k5emFHRnlaV1F0TUMxemFHVmxkREF1ZDJWaWNDSXNNakU1T1RrekxEY3hNeXd4TlRNM0xERTFOeXd4TlRjc1ptRnNjMlVzTVN3d0xqVXNNQzQxTEZ0ZExGc3RNQzR6TkRjeE16TTNOVGM1TmpFM09ETTFMQzB3TGpNME56RXpNemMxTnprMk1UYzRNelVzTUN3dE1DNDBPVE0yTXpBMU56TXlORGcwTURjMk5Dd3dMak0wTURjMk5ETXpNVEl4TURFNU1URXNMVEF1TXpRM01UTXpOelUzT1RZeE56Z3pOU3d3TGpRNE56STJNVEUwTmpRNU5qZ3hOVE1zTUN3d0xqTTBNRGMyTkRNek1USXhNREU1TVRFc01DNHpOREEzTmpRek16RXlNVEF4T1RFeExEQXNNQzQwT0RjeU5qRXhORFkwT1RZNE1UVXpMQzB3TGpNME56RXpNemMxTnprMk1UYzRNelVzTUM0ek5EQTNOalF6TXpFeU1UQXhPVEV4TEMwd0xqUTVNell6TURVM016STBPRFF3TnpZMExEQmRYU3hiSW1sdFlXZGxjeTl6YUdGeVpXUXRNQzF6YUdWbGREQXVkMlZpY0NJc01qRTVPVGt6TERNME9Td3hOVE0zTERFMU55d3hOVGNzWm1Gc2MyVXNNU3d3TGpVc01DNDFMRnRkTEZzdE1DNHpORGN4TXpNM05UYzVOakUzT0RNMUxDMHdMak0wTnpFek16YzFOemsyTVRjNE16VXNNQ3d0TUM0ME9UTTJNekExTnpNeU5EZzBNRGMyTkN3d0xqTTBNRGMyTkRNek1USXhNREU1TVRFc0xUQXVNelEzTVRNek56VTNPVFl4Tnpnek5Td3dMalE0TnpJMk1URTBOalE1TmpneE5UTXNNQ3d3TGpNME1EYzJORE16TVRJeE1ERTVNVEVzTUM0ek5EQTNOalF6TXpFeU1UQXhPVEV4TERBc01DNDBPRGN5TmpFeE5EWTBPVFk0TVRVekxDMHdMak0wTnpFek16YzFOemsyTVRjNE16VXNNQzR6TkRBM05qUXpNekV5TVRBeE9URXhMQzB3TGpRNU16WXpNRFUzTXpJME9EUXdOelkwTERCZFhTeGJJbWx0WVdkbGN5OXphR0Z5WldRdE1DMXphR1ZsZERBdWQyVmljQ0lzTWpFNU9Ua3pMRGd5Tml3eE56a3pMREUxTml3eE5UWXNabUZzYzJVc01Td3dMalVzTUM0MUxGdGRMRnN0TUM0ek5USTFOalF4TURJMU5qUXhNREkxTXl3dE1DNHpOVEkxTmpReE1ESTFOalF4TURJMU15d3dMQzB3TGpRNU16VTRPVGMwTXpVNE9UYzBNellzTUM0ek5EWXhOVE00TkRZeE5UTTRORFl4TlN3dE1DNHpOVEkxTmpReE1ESTFOalF4TURJMU15d3dMalE0TnpFM09UUTROekUzT1RRNE56SXNNQ3d3TGpNME5qRTFNemcwTmpFMU16ZzBOakUxTERBdU16UTJNVFV6T0RRMk1UVXpPRFEyTVRVc01Dd3dMalE0TnpFM09UUTROekUzT1RRNE56SXNMVEF1TXpVeU5UWTBNVEF5TlRZME1UQXlOVE1zTUM0ek5EWXhOVE00TkRZeE5UTTRORFl4TlN3dE1DNDBPVE0xT0RrM05ETTFPRGszTkRNMkxEQmRYU3hiSW1sdFlXZGxjeTl6YUdGeVpXUXRNQzF6YUdWbGREQXVkMlZpY0NJc01qRTVPVGt6TERVd09Dd3hOemt6TERFMU55d3hOVGNzWm1Gc2MyVXNNU3d3TGpVc01DNDFMRnRkTEZzdE1DNHpORGN4TXpNM05UYzVOakUzT0RNMUxDMHdMak0wTnpFek16YzFOemsyTVRjNE16VXNNQ3d0TUM0ME9UTTJNekExTnpNeU5EZzBNRGMyTkN3d0xqTTBNRGMyTkRNek1USXhNREU1TVRFc0xUQXVNelEzTVRNek56VTNPVFl4Tnpnek5Td3dMalE0TnpJMk1URTBOalE1TmpneE5UTXNNQ3d3TGpNME1EYzJORE16TVRJeE1ERTVNVEVzTUM0ek5EQTNOalF6TXpFeU1UQXhPVEV4TERBc01DNDBPRGN5TmpFeE5EWTBPVFk0TVRVekxDMHdMak0wTnpFek16YzFOemsyTVRjNE16VXNNQzR6TkRBM05qUXpNekV5TVRBeE9URXhMQzB3TGpRNU16WXpNRFUzTXpJME9EUXdOelkwTERCZFhTeGJJbWx0WVdkbGN5OXphR0Z5WldRdE1DMXphR1ZsZERBdWQyVmljQ0lzTWpFNU9Ua3pMRFkyTnl3eE56a3pMREUxTnl3eE5UY3NabUZzYzJVc01Td3dMalVzTUM0MUxGdGRMRnN0TUM0ek5UTTFNRE14T0RRM01UTXpOelU0TXl3dE1DNHpOVE0xTURNeE9EUTNNVE16TnpVNE15d3dMQzB3TGpRNU16WXpNRFUzTXpJME9EUXdOelkwTERBdU16UTNNVE16TnpVM09UWXhOemd6TlN3dE1DNHpOVE0xTURNeE9EUTNNVE16TnpVNE15d3dMalE0TnpJMk1URTBOalE1TmpneE5UTXNNQ3d3TGpNME56RXpNemMxTnprMk1UYzRNelVzTUM0ek5EY3hNek0zTlRjNU5qRTNPRE0xTERBc01DNDBPRGN5TmpFeE5EWTBPVFk0TVRVekxDMHdMak0xTXpVd016RTRORGN4TXpNM05UZ3pMREF1TXpRM01UTXpOelUzT1RZeE56Z3pOU3d0TUM0ME9UTTJNekExTnpNeU5EZzBNRGMyTkN3d1hWMHNXeUpwYldGblpYTXZjMmhoY21Wa0xUQXRjMmhsWlhRd0xuZGxZbkFpTERJeE9UazVNeXd4TERFM09UTXNNVFUyTERFMU5peG1ZV3h6WlN3eExEQXVOU3d3TGpVc1cxMHNXeTB3TGpNMU1qVTJOREV3TWpVMk5ERXdNalV6TEMwd0xqTTFNalUyTkRFd01qVTJOREV3TWpVekxEQXNMVEF1TkRrek5UZzVOelF6TlRnNU56UXpOaXd3TGpNME5qRTFNemcwTmpFMU16ZzBOakUxTEMwd0xqTTFNalUyTkRFd01qVTJOREV3TWpVekxEQXVORGczTVRjNU5EZzNNVGM1TkRnM01pd3dMREF1TXpRMk1UVXpPRFEyTVRVek9EUTJNVFVzTUM0ek5EWXhOVE00TkRZeE5UTTRORFl4TlN3d0xEQXVORGczTVRjNU5EZzNNVGM1TkRnM01pd3RNQzR6TlRJMU5qUXhNREkxTmpReE1ESTFNeXd3TGpNME5qRTFNemcwTmpFMU16ZzBOakUxTEMwd0xqUTVNelU0T1RjME16VTRPVGMwTXpZc01GMWRMRnNpYVcxaFoyVnpMM05vWVhKbFpDMHdMWE5vWldWME1DNTNaV0p3SWl3eU1UazVPVE1zTVRVNUxERTNPVE1zTVRVMkxERTFOaXhtWVd4elpTd3hMREF1TlN3d0xqVXNXMTBzV3kwd0xqTTFNalUyTkRFd01qVTJOREV3TWpVekxDMHdMak0xTWpVMk5ERXdNalUyTkRFd01qVXpMREFzTFRBdU5Ea3pOVGc1TnpRek5UZzVOelF6Tml3d0xqTTBOakUxTXpnME5qRTFNemcwTmpFMUxDMHdMak0xTWpVMk5ERXdNalUyTkRFd01qVXpMREF1TkRnM01UYzVORGczTVRjNU5EZzNNaXd3TERBdU16UTJNVFV6T0RRMk1UVXpPRFEyTVRVc01DNHpORFl4TlRNNE5EWXhOVE00TkRZeE5Td3dMREF1TkRnM01UYzVORGczTVRjNU5EZzNNaXd0TUM0ek5USTFOalF4TURJMU5qUXhNREkxTXl3d0xqTTBOakUxTXpnME5qRTFNemcwTmpFMUxDMHdMalE1TXpVNE9UYzBNelU0T1RjME16WXNNRjFkWFYxZExGdGJJa0Z1WTJodmNpSXNOeXcwTlRFeE5UZzRPVFE1T1RRME5EQXNObDFkTEdaaGJITmxMR1poYkhObExEazROVEE0T0RNMU1ERTBNekl3TUN4Yld5Sm9ZWEprYkdsbmFIUWlMQ0pJWVhKa1RHbG5hSFFpWFYwc2JuVnNiQ3d4Tml4dWRXeHNYU3hiSW1OaGJTSXNNVEFzWm1Gc2MyVXNXMTBzTWl3d0xHNTFiR3dzVzFzaVFXNXBiV0YwYVc5dUlERWlMRFVzWm1Gc2MyVXNNU3d3TEdaaGJITmxMREl3TWpJek5ERTNOVGcxTURZM01TeGJXeUpwYldGblpYTXZjMmhoY21Wa0xUQXRjMmhsWlhRd0xuZGxZbkFpTERJeE9UazVNeXcxTVRNc056WTVMREkxTUN3eU5UQXNabUZzYzJVc01Td3dMalVzTUM0MUxGdGRMRnRkWFYxZFhTeGJXeUpUWTNKdmJHeFVieUlzTVRJc05qSXlOemt5TVRRMk1Ea3pOVEkwTERFM1hTeGJJbFJwYldWeUlpd3hNeXd4TmpNM09EZzNNRFkxTmprME56VXNNVGhkWFN4bVlXeHpaU3htWVd4elpTdzRNRFF5TVRnNE5qVXlORGN5T0RJc1cxMHNiblZzYkN3eE9TeHVkV3hzWFN4YkltTnNiM1ZrSWl3eE1DeG1ZV3h6WlN4Yld6YzVOVGsxTURZeE9ETTFOak0yTnl3eExDSmhibWRzWlc5bWJXOTBhVzl1SWl3eU1GMWRMREVzTUN4dWRXeHNMRnRiSWtGdWFXMWhkR2x2YmlBeElpd3dMR1poYkhObExERXNNQ3htWVd4elpTd3hPVGd6TURZMk16azVOREV4TlRjc1cxc2lhVzFoWjJWekwyTnNiM1ZrTFhOb1pXVjBNUzUzWldKd0lpdzNNamd4TERFc01TdzFNQ3cwTWl4MGNuVmxMREVzTVM0d01pd3dMalV5TXpnd09UVXlNemd3T1RVeU16Z3NXMTBzV3kwd0xqZzJMQzB3TGpNek16TXpNek16TXpNek16TXpNek0zTEMwd0xqVXlMQzB3TGpRMU1qTTRNRGsxTWpNNE1EazFNalEwTEMwd0xqSTBMQzB3TGpJNE5UY3hOREk0TlRjeE5ESTROVGMxTEMwd0xqQTVPVGs1T1RrNU9UazVPVGs1T1RrNExDMHdMakF5TXpnd09UVXlNemd3T1RVeU16Z3pOaXd0TUM0eE9EQXdNREF3TURBd01EQXdNREF3TlN3d0xqSTROVGN4TkRJNE5UY3hOREk0TlRjc0xUQXVOVElzTUM0ME1EUTNOakU1TURRM05qRTVNRFEzTnl3dE1DNDROaXd3TGpJMk1Ua3dORGMyTVRrd05EYzJNVGcyTEMwd0xqazJMQzB3TGpBeU16Z3dPVFV5TXpnd09UVXlNemd6TmwxZExGc2lhVzFoWjJWekwyTnNiM1ZrTFhOb1pXVjBNUzUzWldKd0lpdzNNamd4TERZMUxERXNOVEFzTkRJc2RISjFaU3d4TERFc01DNDFNak00TURrMU1qTTRNRGsxTWpNNExGdGRMRnN0TUM0d05qQXdNREF3TURBd01EQXdNREF3TlN3dE1DNHdNak00TURrMU1qTTRNRGsxTWpNNE16WXNMVEF1TVRZd01EQXdNREF3TURBd01EQXdNRE1zTUM0eU5qRTVNRFEzTmpFNU1EUTNOakU0Tml3dE1DNDFMREF1TkRBME56WXhPVEEwTnpZeE9UQTBOemNzTFRBdU9EUXNNQzR5T0RVM01UUXlPRFUzTVRReU9EVTNMQzB3TGpreUxDMHdMakF5TXpnd09UVXlNemd3T1RVeU16Z3pOaXd0TUM0M09Dd3RNQzR5T0RVM01UUXlPRFUzTVRReU9EVTNOU3d0TUM0MUxDMHdMalExTWpNNE1EazFNak00TURrMU1qUTBMQzB3TGpFMk1EQXdNREF3TURBd01EQXdNREF6TEMwd0xqTXpNek16TXpNek16TXpNek16TXpNM1hWMHNXeUpwYldGblpYTXZZMnh2ZFdRdGMyaGxaWFF3TG5kbFluQWlMREV5TmpZME55d3lNekVzTWpVM0xERTNNeXd4TURBc2RISjFaU3d4TERFc01DNDFMRnRkTEZzdE1DNDRNRE0wTmpneU1EZ3dPVEkwT0RVMUxDMHdMakUxT1RrNU9UazVPVGs1T1RrNU9UazRMQzB3TGpVc0xUQXVORElzTFRBdU1UWXhPRFE1TnpFd09UZ3lOalU1TEMwd0xqSXlPVGs1T1RrNU9UazVPVGs1T1RrNExDMHdMakEwTmpJME1qYzNORFUyTmpRM016azJOU3d3TEMwd0xqRXdPVGd5TmpVNE9UVTVOVE0zTlRjeUxEQXVNekV3TURBd01EQXdNREF3TURBd01EVXNMVEF1TlN3d0xqTTFMQzB3TGpreE9UQTNOVEUwTkRVd09EWTNNRFlzTUM0ek5Td3RNQzQ1TWpRNE5UVTBPVEV6TWprME56azRMREJkWFN4YkltbHRZV2RsY3k5amJHOTFaQzF6YUdWbGREQXVkMlZpY0NJc01USTJOalEzTERNek15d3lOVGNzTVRjekxERXdNQ3gwY25WbExERXNNUzR3TURVM09EQXpORFk0TWpBNE1Ea3pMREF1TkRjc1cxMHNXeTB3TGpBNE1Ea3lORGcxTlRRNU1UTXlPVFUxTERBdU1ETXdNREF3TURBd01EQXdNREF3TURJM0xDMHdMakE0Tmpjd05USXdNak14TWpFek9EYzBMREF1TXpnc0xUQXVOVEExTnpnd016UTJPREl3T0RBNU15d3dMak00TEMwd0xqZzVOVGsxTXpjMU56SXlOVFF6TXpZc01DNHpOREF3TURBd01EQXdNREF3TURBeExDMHdMamsxT1RVek56VTNNakkxTkRNek5UTXNNQzR3TXpBd01EQXdNREF3TURBd01EQXdNamNzTFRBdU9EUXpPVE13TmpNMU9ETTRNVFV3TXl3dE1DNHhPVGs1T1RrNU9UazVPVGs1T1RrNU5pd3RNQzQxTURVM09EQXpORFk0TWpBNE1Ea3pMQzB3TGpNNE9UazVPVGs1T1RrNU9UazVPVGsyTEMwd0xqSXdNak14TWpFek9EY3lPRE15TXpjMkxDMHdMakV5T1RrNU9UazVPVGs1T1RrNU9UazFYVjBzV3lKcGJXRm5aWE12WTJ4dmRXUXRjMmhsWlhRd0xuZGxZbkFpTERFeU5qWTBOeXd4TERFc01qRXhMREV4TXl4MGNuVmxMREVzTVM0d01EUTNNemt6TXpZME9USTRPVEVzTUM0MU1EUTBNalEzTnpnM05qRXdOaklzVzEwc1d5MHdMamcxTXpBNE1EVTJPRGN5TURNM09URXNMVEF1TWpJeE1qTTRPVE00TURVek1EazNNellzTFRBdU5UQTBOek01TXpNMk5Ea3lPRGt3T1N3dE1DNDBNVFU1TWpreU1ETTFNems0TWpNc0xUQXVNVEl6TWpJeU56UTRPREUxTVRZMU9ESXNMVEF1TWpreU1ETTFNems0TWpNd01EZzROU3d0TUM0d05EY3pPVE16TmpRNU1qZzVNRGs0T1N3dE1DNHdNRFEwTWpRM056ZzNOakV3TmpFNU5UUXNMVEF1TVRReU1UZ3dNRGswTnpnMk56STVOemNzTUM0eU16ZzVNemd3TlRNd09UY3pORFV4Tnl3dE1DNDFNRFEzTXprek16WTBPVEk0T1RBNUxEQXVNell5T0RNeE9EVTROREEzTURjNU5qVXNMVEF1T1RFNU5ETXhNamM1TmpJd09EVXpMREF1TXpJM05ETXpOakk0TXpFNE5UZzBMQzB3TGprMk5qZ3lORFkwTkRVME9UYzJNeXd0TUM0d01EUTBNalEzTnpnM05qRXdOakU1TlRSZFhTeGJJbWx0WVdkbGN5OWpiRzkxWkMxemFHVmxkREF1ZDJWaWNDSXNNVEkyTmpRM0xERXlPU3d4TERJeE1Td3hNVE1zZEhKMVpTd3hMREV1TURBME56TTVNek0yTkRreU9Ea3hMREF1TkRZd01UYzJPVGt4TVRVd05EUXlORGNzVzEwc1d5MHdMakEwTWpZMU5EQXlPRFF6TmpBeE9EZzBMREF1TURNNU9ESXpNREE0T0RRNU5UVTNOVE1zTFRBdU1Ea3dNRFEzTXprek16WTBPVEk0T0RRc01DNHpOekUyT0RFME1UVTVNamt5TURNMUxDMHdMalV3TkRjek9UTXpOalE1TWpnNU1Ea3NNQzQwTURjd056azJORFl3TVRjMk9Ua3hOQ3d0TUM0NE5qY3lPVGcxTnpneE9Ua3dOVEl4TERBdU1qZ3pNVGcxT0RRd056QTNPVFkwTmpVc0xUQXVPVFl5TURnMU16QTRNRFUyT0RjeUxEQXVNRE01T0RJek1EQTRPRFE1TlRVM05UTXNMVEF1T0RnMk1qVTFPVEkwTVRjd05qRTJMQzB3TGpJME56YzROell4TURZeE9UUTJPVEF5TEMwd0xqVXdORGN6T1RNek5qUTVNamc1TURrc0xUQXVNemN4TmpneE5ERTFPVEk1TWpBek5UWXNMVEF1TVRVMk16azRNVEEwTWpZMU5EQXlPQ3d0TUM0eE56WTVPVEV4TlRBME5ESTBOemM0TjExZExGc2lhVzFoWjJWekwyTnNiM1ZrTFhOb1pXVjBNQzUzWldKd0lpd3hNalkyTkRjc05EUTVMREkxTnl3NE55dzFOeXgwY25WbExERXNNUzR3TVRFME9UUXlOVEk0TnpNMU5qTXpMREF1TlRBNE56Y3hPVEk1T0RJME5UWXhOQ3hiWFN4YkxUQXVPRGsyTlRVeE56STBNVE0zT1RNeE1pd3RNQzR6TXpNek16TXpNek16TXpNek16TXpOeXd0TUM0MU1URTBPVFF5TlRJNE56TTFOak16TEMwd0xqTTROVGsyTkRreE1qSTRNRGN3TVRnc0xUQXVNalF4TXpjNU16RXdNelEwT0RJM056UXNMVEF1TVRjMU5ETTROVGsyTkRreE1qSTRNVElzTFRBdU1Ea3hPVFUwTURJeU9UZzROVEExT0RZc0xUQXVNREE0TnpjeE9USTVPREkwTlRZeE5ETXNMVEF1TVRBek5EUTRNamMxT0RZeU1EWTVNRFlzTUM0ek5UQTROemN4T1RJNU9ESTBOVFl4TEMwd0xqVXhNVFE1TkRJMU1qZzNNelUyTXpNc01DNHlNVEExTWpZek1UVTNPRGswTnpNMk55d3RNQzQ0TlRBMU56UTNNVEkyTkRNMk56Z3lMREF1TWpJNE1EY3dNVGMxTkRNNE5UazJORElzTFRBdU9UWTFOVEUzTWpReE16YzVNekV3TlN3dE1DNHdNRGczTnpFNU1qazRNalExTmpFME0xMWRMRnNpYVcxaFoyVnpMMk5zYjNWa0xYTm9aV1YwTUM1M1pXSndJaXd4TWpZMk5EY3NORFE1TERNNE5TdzROeXcxTnl4MGNuVmxMREVzTVM0d01URTBPVFF5TlRJNE56TTFOak16TERBdU5EY3pOamcwTWpFd05USTJNekUxTnpZc1cxMHNXeTB3TGpBMU56UTNNVEkyTkRNMk56Z3hOakV6TERBdU1ESTJNekUxTnpnNU5EY3pOamcwTWpNM0xDMHdMakUzTWpReE16YzVNekV3TXpRME9EUXNNQzR5TmpNeE5UYzRPVFEzTXpZNE5ESXhMQzB3TGpVeE1UUTVOREkxTWpnM016VTJNek1zTUM0eU5EVTJNVFF3TXpVd09EYzNNVGt6TkN3dE1DNDVNVGsxTkRBeU1qazRPRFV3TlRjMkxEQXVNemcxT1RZME9URXlNamd3TnpBeE9Dd3RNQzQ1TXpFd016UTBPREkzTlRnMk1qQTRMREF1TURJMk16RTFOemc1TkRjek5qZzBNak0zTEMwd0xqYzRNVFl3T1RFNU5UUXdNakk1T0Rrc0xUQXVNVFF3TXpVd09EYzNNVGt5T1RneU5EVXNMVEF1TlRFeE5EazBNalV5T0Rjek5UWXpNeXd0TUM0ek5UQTROemN4T1RJNU9ESTBOVFl4TEMwd0xqRXlOalF6TmpjNE1UWXdPVEU1TlRRM0xDMHdMakk1T0RJME5UWXhOREF6TlRBNE56ZGRYVjFkTEZzaVFXNXBiV0YwYVc5dUlESWlMREFzWm1Gc2MyVXNNU3d3TEdaaGJITmxMREU0T1RVM05EUTJNRFUwTkRjMU55eGJXeUpwYldGblpYTXZZMnh2ZFdRdGMyaGxaWFF4TG5kbFluQWlMRGN5T0RFc01TdzJOU3cwT0N3ME1DeDBjblZsTERFc01Td3dMalVzVzEwc1d5MHdMamczTlN3dE1DNHpOU3d0TUM0MUxDMHdMalEzTlN3dE1DNHhPRGMxTEMwd0xqTXNMVEF1TURZeU5Td3dMQzB3TGpFMk5qWTJOalkyTmpZMk5qWTJOall6TERBdU16QXdNREF3TURBd01EQXdNREF3TURRc0xUQXVOU3d3TGpReU5UQXdNREF3TURBd01EQXdNREEwTEMwd0xqZ3pNek16TXpNek16TXpNek16TXpRc01DNHlOelVzTFRBdU9UVTRNek16TXpNek16TXpNek16TkN3d1hWMHNXeUpwYldGblpYTXZZMnh2ZFdRdGMyaGxaWFF4TG5kbFluQWlMRGN5T0RFc05qVXNOalVzTkRnc05EQXNkSEoxWlN3eExERXNNQzQwTnpVc1cxMHNXeTB3TGpBME1UWTJOalkyTmpZMk5qWTJOall6TERBdU1ESTFNREF3TURBd01EQXdNREF3TURJeUxDMHdMakUyTmpZMk5qWTJOalkyTmpZMk5qWXpMREF1TXpBd01EQXdNREF3TURBd01EQXdNRFFzTFRBdU5Td3dMalExTURBd01EQXdNREF3TURBd01EQTNMQzB3TGpnek16TXpNek16TXpNek16TXpNelFzTUM0ek1qVXdNREF3TURBd01EQXdNREF3Tnl3dE1DNDVNemMxTERBdU1ESTFNREF3TURBd01EQXdNREF3TURJeUxDMHdMamd4TWpVc0xUQXVNamMwT1RrNU9UazVPVGs1T1RrNU9UY3NMVEF1TlN3dE1DNDBORGs1T1RrNU9UazVPVGs1T1RrNU5pd3RNQzR4TWpVc0xUQXVNekkwT1RrNU9UazVPVGs1T1RrNU9UWmRYU3hiSW1sdFlXZGxjeTlqYkc5MVpDMXphR1ZsZERBdWQyVmljQ0lzTVRJMk5qUTNMREVzTWpFMExERTNNU3c1T0N4MGNuVmxMREVzTVN3d0xqVXpNRFl4TWpJME5EZzVOemsxT1RJc1cxMHNXeTB3TGpneE1qZzJOVFE1TnpBM05qQXlNelFzTFRBdU1qQTBNRGd4TmpNeU5qVXpNRFl4TWpnc0xUQXVOU3d0TUM0ME5qa3pPRGMzTlRVeE1ESXdOREE0TkN3dE1DNHhOVGM0T1RRM016WTROREl4TURVekxDMHdMakkyTlRNd05qRXlNalEwT0RrM09UWXNMVEF1TURRd09UTTFOamN5TlRFME5qRTVPVE0yTEMwd0xqQXpNRFl4TWpJME5EZzVOemsxT1RJeE9Dd3RNQzR4TVRFeE1URXhNVEV4TVRFeE1URXhOaXd3TGpJM05UVXhNREl3TkRBNE1UWXpNallzTFRBdU5Td3dMak14TmpNeU5qVXpNRFl4TWpJME5Ea3NMVEF1T1RJek9UYzJOakE0TVRnM01UTTBOaXd3TGpNeU5qVXpNRFl4TWpJME5EZzVOemtzTFRBdU9UUXhOVEl3TkRZM09ETTJNalUzTXl3dE1DNHdNekEyTVRJeU5EUTRPVGM1TlRreU1UaGRYU3hiSW1sdFlXZGxjeTlqYkc5MVpDMXphR1ZsZERBdWQyVmljQ0lzTVRJMk5qUTNMREV5T1N3eU1UUXNNVGN4TERrNExIUnlkV1VzTVN3eExqQXdOVGcwTnprMU16SXhOak0zTkRJc01DNDFNakEwTURneE5qTXlOalV6TURZeExGdGRMRnN0TUM0d05qUXpNamMwT0RVek9EQXhNVFk1TEMwd0xqQXlNRFF3T0RFMk16STJOVE13TmpFME5Td3RNQzR3T0RFNE56RXpORFV3TWpreU16azJOU3d3TGpNek5qY3pORFk1TXpnM056VTFNRGsxTEMwd0xqVXdOVGcwTnprMU16SXhOak0zTkRJc01DNHpNalkxTXpBMk1USXlORFE0T1Rnc0xUQXVPRGswTnpNMk9EUXlNVEExTWpZekxEQXVNamcxTnpFME1qZzFOekUwTWpnMU55d3RNQzQ1TmpRNU1USXlPREEzTURFM05UUXpMQzB3TGpBeU1EUXdPREUyTXpJMk5UTXdOakUwTlN3dE1DNDRORGM1TlRNeU1UWXpOelF5TmpnNUxDMHdMakkxTlRFd01qQTBNRGd4TmpNeU5qVTBMQzB3TGpVd05UZzBOemsxTXpJeE5qTTNORElzTFRBdU5EVTVNVGd6Tmpjek5EWTVNemczTnpjc0xUQXVNVGt5T1RneU5EVTJNVFF3TXpVd09Dd3RNQzR4T1RNNE56YzFOVEV3TWpBME1EZ3lYVjBzV3lKcGJXRm5aWE12WTJ4dmRXUXRjMmhsWlhRd0xuZGxZbkFpTERFeU5qWTBOeXd5TlRjc01Td3lNRGtzTVRFeExIUnlkV1VzTVN3eExqQXdORGM0TkRZNE9EazVOVEl4TlRJc01DNDFNekUxTXpFMU16RTFNekUxTXpFMUxGdGRMRnN0TUM0NE5UWTBOVGt6TXpBeE5ETTFOREEyTEMwd0xqSTFNakkxTWpJMU1qSTFNakkxTWpNc0xUQXVOVEEwTnpnME5qZzRPVGsxTWpFMU1pd3RNQzQwTlRBME5UQTBOVEEwTlRBME5UQTBOaXd0TUM0eE1UazJNVGN5TWpRNE9EQXpPREkzTXl3dE1DNHpNalF6TWpRek1qUXpNalF6TWpRek5Dd3RNQzR3TkRNd05qSXlNREE1TlRZNU16YzJPU3d0TUM0d016RTFNekUxTXpFMU16RTFNekUxTkN3dE1DNHhNemczTlRVNU9EQTROakV5TkRNNU55d3dMakl4TmpJeE5qSXhOakl4TmpJeE5qSXpMQzB3TGpVd05EYzRORFk0T0RrNU5USXhOVElzTUM0ek5ESXpOREl6TkRJek5ESXpOREl6TEMwd0xqa3lNelEwTkRrM05qQTNOalUxTlN3d0xqTXdOak13TmpNd05qTXdOak13TmpNc0xUQXVPVGN4TWpreE9EWTJNREk0TnpBNE1Td3RNQzR3TXpFMU16RTFNekUxTXpFMU16RTFORjFkTEZzaWFXMWhaMlZ6TDJOc2IzVmtMWE5vWldWME1DNTNaV0p3SWl3eE1qWTJORGNzTXpnMUxERXNNakE1TERFeE1TeDBjblZsTERFc01Td3dMalV3TkRVd05EVXdORFV3TkRVd05EVXNXMTBzV3kwd0xqQXpNelE1TWpneU1qazJOalV3TnpFekxDMHdMakF3TkRVd05EVXdORFV3TkRVd05EUTFPRFVzTFRBdU1EZ3hNek01TnpFeU9URTROall3TWpjc01DNHpNek16TXpNek16TXpNek16TXpNek55d3RNQzQxTERBdU16WTVNelk1TXpZNU16WTVNelk1TXpjc0xUQXVPRFkyTURJNE56QTRNVE16T1RjeE15d3dMakkwTXpJME16STBNekkwTXpJME16TXNMVEF1T1RZeE56SXlORGc0TURNNE1qYzNOU3d0TUM0d01EUTFNRFExTURRMU1EUTFNRFEwTlRnMUxDMHdMamc0TlRFMk56UTJOREV4TkRnek1qVXNMVEF1TWprM01qazNNamszTWprM01qazNNallzTFRBdU5Td3RNQzQwTWpNME1qTTBNak0wTWpNME1qTTBMQzB3TGpFME9ETXlOVE0xT0RnMU1UWTNORFkwTEMwd0xqSXlOVEl5TlRJeU5USXlOVEl5TlRKZFhTeGJJbWx0WVdkbGN5OWpiRzkxWkMxemFHVmxkREF1ZDJWaWNDSXNNVEkyTmpRM0xEWTFMRE00Tnl3NE5TdzFOU3gwY25WbExERXNNU3d3TGpVME5UUTFORFUwTlRRMU5EVTBOVFFzVzEwc1d5MHdMamc1TkRFeE56WTBOekExT0RneU16WXNMVEF1TXpneE9ERTRNVGd4T0RFNE1UZ3hPQ3d0TUM0MUxDMHdMalF6TmpNMk16WXpOak0yTXpZek5qTTBMQzB3TGpJeU16VXlPVFF4TVRjMk5EY3dOVGczTEMwd0xqSXhPREU0TVRneE9ERTRNVGd4T0RFMExDMHdMakEzTURVNE9ESXpOVEk1TkRFeE56WXlMQzB3TGpBME5UUTFORFUwTlRRMU5EVTBOVFF4TkN3dE1DNHdPREl6TlRJNU5ERXhOelkwTnpBMk15d3dMak15TnpJM01qY3lOekkzTWpjeU56STNMQzB3TGpVc01DNHhPREU0TVRneE9ERTRNVGd4T0RFNE9Dd3RNQzQ0TkRjd05UZzRNak0xTWprME1URTRMREF1TWpBd01EQXdNREF3TURBd01EQXdNRGNzTFRBdU9UWTBOekExT0RneU16VXlPVFF4TWl3dE1DNHdORFUwTlRRMU5EVTBOVFExTkRVME1UUmRYU3hiSW1sdFlXZGxjeTlqYkc5MVpDMXphR1ZsZERBdWQyVmljQ0lzTVRJMk5qUTNMREV5T1N3ek9EY3NPRFVzTlRVc2RISjFaU3d4TERFc01DNDBPVEE1TURrd09UQTVNRGt3T1RBNUxGdGRMRnN0TUM0d016VXlPVFF4TVRjMk5EY3dOVGc0TVN3d0xqQXdPVEE1TURrd09UQTVNRGt3T1RBNU5Dd3RNQzR4TlRJNU5ERXhOelkwTnpBMU9EZ3lOU3d3TGpJMU5EVTBOVFExTkRVME5UUTFORFlzTFRBdU5Td3dMakl6TmpNMk16WXpOak0yTXpZek5qUXNMVEF1T1RFM05qUTNNRFU0T0RJek5USTVOQ3d3TGpNNE1UZ3hPREU0TVRneE9ERTRNVGdzTFRBdU9USTVOREV4TnpZME56QTFPRGd5TkN3d0xqQXdPVEE1TURrd09UQTVNRGt3T1RBNU5Dd3RNQzQzTnpZME56QTFPRGd5TXpVeU9UUXhMQzB3TGpFMk16WXpOak0yTXpZek5qTTJNelkwTEMwd0xqVXNMVEF1TXpneE9ERTRNVGd4T0RFNE1UZ3hPRE1zTFRBdU1UQTFPRGd5TXpVeU9UUXhNVGMyTkRNc0xUQXVNekkzTWpjeU56STNNamN5TnpJM01qZGRYVjFkWFN4Yld5SkNkV3hzWlhRaUxERTBMRFUzTXpJek5qRXpNemd3T1RrNU55d3lNVjFkTEdaaGJITmxMR1poYkhObExESTVNekEzTmpBMk1qRXhPVFV6Tnl4YlhTeHVkV3hzTERJeUxHNTFiR3hkTEZzaVoyRnNiQ0lzTVRBc1ptRnNjMlVzVzEwc01Dd3dMRzUxYkd3c1cxc2lRVzVwYldGMGFXOXVJREVpTERVc1ptRnNjMlVzTVN3d0xHWmhiSE5sTERJeU5ESXdOelEyTnpBMU56STNNaXhiV3lKcGJXRm5aWE12YzJoaGNtVmtMVEF0YzJobFpYUXdMbmRsWW5BaUxESXhPVGs1TXl3eExEYzJPU3d5TlRBc01qVXdMR1poYkhObExERXNNQzQxTERBc1cxMHNXMTFkWFYxZExGdGRMR1poYkhObExHWmhiSE5sTERVNU16QTBOREl6TXpBeU5qTTNOU3hiWFN4dWRXeHNMREl6TEc1MWJHeGRMRnNpWjJ4aGMzTWlMRGtzWm1Gc2MyVXNXMTBzTVN3d0xGc2lhVzFoWjJWekwyZHNZWE56TFhOb1pXVjBNQzUzWldKd0lpdzVNVGtzTUN3d0xERTFNQ3d4TlRBc1ptRnNjMlZkTEc1MWJHd3NXMXNpVUdoNWMybGpjeUlzTVRFc01qTTNNRFl5T0RZMU5UYzVOVEk1TERFelhWMHNabUZzYzJVc1ptRnNjMlVzTVRJME9EazBOakEyTmpJeU16Y3hMRnRkTEc1MWJHd3NNalFzV3pFc01WMWRMRnNpWjJ4aGMzTXlJaXc1TEdaaGJITmxMRnRkTERBc01DeGJJbWx0WVdkbGN5OW5iR0Z6Y3pJdGMyaGxaWFF3TG5kbFluQWlMRGt4T1N3d0xEQXNNVFV3TERFMU1DeG1ZV3h6WlYwc2JuVnNiQ3hiWFN4bVlXeHpaU3htWVd4elpTdzFOVEkwTVRFek9UYzFOVE0xTVRBc1cxMHNiblZzYkN3eU5TeGJNU3d4WFYwc1d5Sm5iR0Z6Y3pNaUxEa3NabUZzYzJVc1cxMHNNQ3d3TEZzaWFXMWhaMlZ6TDJkc1lYTnpNeTF6YUdWbGREQXVkMlZpY0NJc05UYzROeXd3TERBc016QXdMREUxTUN4bVlXeHpaVjBzYm5Wc2JDeGJYU3htWVd4elpTeG1ZV3h6WlN3NE9EYzJOemc1TXpjek9ERTJNakVzVzEwc2JuVnNiQ3d5Tml4Yk1Td3lYVjBzV3lKbmJHRnpjelFpTERrc1ptRnNjMlVzVzEwc01Dd3dMRnNpYVcxaFoyVnpMMmRzWVhOek5DMXphR1ZsZERBdWQyVmljQ0lzT1RJd0xEQXNNQ3d4TlRBc01UVXdMR1poYkhObFhTeHVkV3hzTEZ0ZExHWmhiSE5sTEdaaGJITmxMRFE1T0RFNU1ESXhNakV5T0RReU55eGJYU3h1ZFd4c0xESTNMRnN4TERGZFhTeGJJbWhsWVdRaUxERXdMR1poYkhObExGdGJNVEV3TmpJME1UVXpOVFEwTXpneUxERXNJbkJzWVhsbGNpSXNNamhkWFN3eExEQXNiblZzYkN4Yld5SkJibWx0WVhScGIyNGdNU0lzTUN4bVlXeHpaU3d4TERBc1ptRnNjMlVzTXpjeU1EWXpNekEwTVRVM09EVTNMRnRiSW1sdFlXZGxjeTlvWldGa0xYTm9aV1YwTUM1M1pXSndJaXc0TXpjd0xERXNNU3d6T0N3ME55eG1ZV3h6WlN3eExEQXVOalUzT0RrME56TTJPRFF5TVRBMU15d3dMamszT0RjeU16UXdOREkxTlRNeE9URXNXMTBzV3kwd0xqWXpNVFUzT0RrME56TTJPRFF5TVRFc0xUQXVPVFUzTkRRMk9EQTROVEV3TmpNNE1pd3RNQzR4TlRjNE9UUTNNelk0TkRJeE1EVXpMQzB3TGprM09EY3lNelF3TkRJMU5UTXhPVEVzTUM0eU9EazBOek0yT0RReU1UQTFNall5TEMwd0xqazFOelEwTmpnd09EVXhNRFl6T0RJc01DNHlPRGswTnpNMk9EUXlNVEExTWpZeUxDMHdMalEzT0RjeU16UXdOREkxTlRNeE9URXNNQzR5T0RrME56TTJPRFF5TVRBMU1qWXlMQzB3TGpBeU1USTNOalU1TlRjME5EWTRNRGMzTEMwd0xqRTFOemc1TkRjek5qZzBNakV3TlRNc0xUQXVNREl4TWpjMk5UazFOelEwTmpnd056Y3NMVEF1TXpZNE5ESXhNRFV5TmpNeE5UYzVMQzB3TGpJek5EQTBNalUxTXpFNU1UUTRPVE0zTEMwd0xqWXpNVFUzT0RrME56TTJPRFF5TVRFc0xUQXVORGM0TnpJek5EQTBNalUxTXpFNU1WMWRMRnNpYVcxaFoyVnpMMmhsWVdRdGMyaGxaWFF3TG5kbFluQWlMRGd6TnpBc05ERXNNU3d6T0N3ME55eG1ZV3h6WlN3eExEQXVOalUzT0RrME56TTJPRFF5TVRBMU15d3dMamszT0RjeU16UXdOREkxTlRNeE9URXNXMTBzV3kwd0xqWXpNVFUzT0RrME56TTJPRFF5TVRFc0xUQXVPVFUzTkRRMk9EQTROVEV3TmpNNE1pd3RNQzR4TlRjNE9UUTNNelk0TkRJeE1EVXpMQzB3TGprM09EY3lNelF3TkRJMU5UTXhPVEVzTUM0eU9EazBOek0yT0RReU1UQTFNall5TEMwd0xqazFOelEwTmpnd09EVXhNRFl6T0RJc01DNHlPRGswTnpNMk9EUXlNVEExTWpZeUxDMHdMalEzT0RjeU16UXdOREkxTlRNeE9URXNNQzR5T0RrME56TTJPRFF5TVRBMU1qWXlMQzB3TGpBeU1USTNOalU1TlRjME5EWTRNRGMzTEMwd0xqRTFOemc1TkRjek5qZzBNakV3TlRNc0xUQXVNREl4TWpjMk5UazFOelEwTmpnd056Y3NMVEF1TXpZNE5ESXhNRFV5TmpNeE5UYzVMQzB3TGpJek5EQTBNalUxTXpFNU1UUTRPVE0zTEMwd0xqWXpNVFUzT0RrME56TTJPRFF5TVRFc0xUQXVORGM0TnpJek5EQTBNalUxTXpFNU1WMWRMRnNpYVcxaFoyVnpMMmhsWVdRdGMyaGxaWFF3TG5kbFluQWlMRGd6TnpBc09ERXNNU3d6T0N3ME55eG1ZV3h6WlN3eExEQXVOalUzT0RrME56TTJPRFF5TVRBMU15d3dMamszT0RjeU16UXdOREkxTlRNeE9URXNXMTBzV3kwd0xqWXpNVFUzT0RrME56TTJPRFF5TVRFc0xUQXVPVFUzTkRRMk9EQTROVEV3TmpNNE1pd3RNQzR4TlRjNE9UUTNNelk0TkRJeE1EVXpMQzB3TGprM09EY3lNelF3TkRJMU5UTXhPVEVzTUM0eU9EazBOek0yT0RReU1UQTFNall5TEMwd0xqazFOelEwTmpnd09EVXhNRFl6T0RJc01DNHlPRGswTnpNMk9EUXlNVEExTWpZeUxDMHdMalEzT0RjeU16UXdOREkxTlRNeE9URXNNQzR5T0RrME56TTJPRFF5TVRBMU1qWXlMQzB3TGpBeU1USTNOalU1TlRjME5EWTRNRGMzTEMwd0xqRTFOemc1TkRjek5qZzBNakV3TlRNc0xUQXVNREl4TWpjMk5UazFOelEwTmpnd056Y3NMVEF1TXpZNE5ESXhNRFV5TmpNeE5UYzVMQzB3TGpJek5EQTBNalUxTXpFNU1UUTRPVE0zTEMwd0xqWXpNVFUzT0RrME56TTJPRFF5TVRFc0xUQXVORGM0TnpJek5EQTBNalUxTXpFNU1WMWRMRnNpYVcxaFoyVnpMMmhsWVdRdGMyaGxaWFF3TG5kbFluQWlMRGd6TnpBc01USXhMREVzTXpnc05EY3NabUZzYzJVc01Td3dMalkxTnpnNU5EY3pOamcwTWpFd05UTXNNQzQ1TnpnM01qTTBNRFF5TlRVek1Ua3hMRnRkTEZzdE1DNDJNekUxTnpnNU5EY3pOamcwTWpFeExDMHdMamsxTnpRME5qZ3dPRFV4TURZek9ESXNMVEF1TVRVM09EazBOek0yT0RReU1UQTFNeXd0TUM0NU56ZzNNak0wTURReU5UVXpNVGt4TERBdU1qZzVORGN6TmpnME1qRXdOVEkyTWl3dE1DNDVOVGMwTkRZNE1EZzFNVEEyTXpneUxEQXVNamc1TkRjek5qZzBNakV3TlRJMk1pd3RNQzQwTnpnM01qTTBNRFF5TlRVek1Ua3hMREF1TWpnNU5EY3pOamcwTWpFd05USTJNaXd0TUM0d01qRXlOelkxT1RVM05EUTJPREEzTnl3dE1DNHhOVGM0T1RRM016WTROREl4TURVekxDMHdMakF5TVRJM05qVTVOVGMwTkRZNE1EYzNMQzB3TGpNMk9EUXlNVEExTWpZek1UVTNPU3d0TUM0eU16UXdOREkxTlRNeE9URTBPRGt6Tnl3dE1DNDJNekUxTnpnNU5EY3pOamcwTWpFeExDMHdMalEzT0RjeU16UXdOREkxTlRNeE9URmRYU3hiSW1sdFlXZGxjeTlvWldGa0xYTm9aV1YwTUM1M1pXSndJaXc0TXpjd0xERTJNU3d4TERNNExEUTNMR1poYkhObExERXNNQzQyTlRjNE9UUTNNelk0TkRJeE1EVXpMREF1T1RjNE56SXpOREEwTWpVMU16RTVNU3hiWFN4YkxUQXVOak14TlRjNE9UUTNNelk0TkRJeE1Td3RNQzQ1TlRjME5EWTRNRGcxTVRBMk16Z3lMQzB3TGpFMU56ZzVORGN6TmpnME1qRXdOVE1zTFRBdU9UYzROekl6TkRBME1qVTFNekU1TVN3d0xqSTRPVFEzTXpZNE5ESXhNRFV5TmpJc0xUQXVPVFUzTkRRMk9EQTROVEV3TmpNNE1pd3dMakk0T1RRM016WTROREl4TURVeU5qSXNMVEF1TkRjNE56SXpOREEwTWpVMU16RTVNU3d3TGpJNE9UUTNNelk0TkRJeE1EVXlOaklzTFRBdU1ESXhNamMyTlRrMU56UTBOamd3Tnpjc0xUQXVNVFUzT0RrME56TTJPRFF5TVRBMU15d3RNQzR3TWpFeU56WTFPVFUzTkRRMk9EQTNOeXd0TUM0ek5qZzBNakV3TlRJMk16RTFOemtzTFRBdU1qTTBNRFF5TlRVek1Ua3hORGc1TXpjc0xUQXVOak14TlRjNE9UUTNNelk0TkRJeE1Td3RNQzQwTnpnM01qTTBNRFF5TlRVek1Ua3hYVjBzV3lKcGJXRm5aWE12YUdWaFpDMXphR1ZsZERBdWQyVmljQ0lzT0RNM01Dd3lNREVzTVN3ek9DdzBOeXhtWVd4elpTd3hMREF1TmpVM09EazBOek0yT0RReU1UQTFNeXd3TGprM09EY3lNelF3TkRJMU5UTXhPVEVzVzEwc1d5MHdMall6TVRVM09EazBOek0yT0RReU1URXNMVEF1T1RVM05EUTJPREE0TlRFd05qTTRNaXd0TUM0eE5UYzRPVFEzTXpZNE5ESXhNRFV6TEMwd0xqazNPRGN5TXpRd05ESTFOVE14T1RFc01DNHlPRGswTnpNMk9EUXlNVEExTWpZeUxDMHdMamsxTnpRME5qZ3dPRFV4TURZek9ESXNNQzR5T0RrME56TTJPRFF5TVRBMU1qWXlMQzB3TGpRM09EY3lNelF3TkRJMU5UTXhPVEVzTUM0eU9EazBOek0yT0RReU1UQTFNall5TEMwd0xqQXlNVEkzTmpVNU5UYzBORFk0TURjM0xDMHdMakUxTnpnNU5EY3pOamcwTWpFd05UTXNMVEF1TURJeE1qYzJOVGsxTnpRME5qZ3dOemNzTFRBdU16WTROREl4TURVeU5qTXhOVGM1TEMwd0xqSXpOREEwTWpVMU16RTVNVFE0T1RNM0xDMHdMall6TVRVM09EazBOek0yT0RReU1URXNMVEF1TkRjNE56SXpOREEwTWpVMU16RTVNVjFkTEZzaWFXMWhaMlZ6TDJobFlXUXRjMmhsWlhRd0xuZGxZbkFpTERnek56QXNNU3cxTUN3ek9DdzBOeXhtWVd4elpTd3hMREF1TmpVM09EazBOek0yT0RReU1UQTFNeXd3TGprM09EY3lNelF3TkRJMU5UTXhPVEVzVzEwc1d5MHdMall6TVRVM09EazBOek0yT0RReU1URXNMVEF1T1RVM05EUTJPREE0TlRFd05qTTRNaXd0TUM0eE5UYzRPVFEzTXpZNE5ESXhNRFV6TEMwd0xqazNPRGN5TXpRd05ESTFOVE14T1RFc01DNHlPRGswTnpNMk9EUXlNVEExTWpZeUxDMHdMamsxTnpRME5qZ3dPRFV4TURZek9ESXNNQzR5T0RrME56TTJPRFF5TVRBMU1qWXlMQzB3TGpRM09EY3lNelF3TkRJMU5UTXhPVEVzTUM0eU9EazBOek0yT0RReU1UQTFNall5TEMwd0xqQXlNVEkzTmpVNU5UYzBORFk0TURjM0xDMHdMakUxTnpnNU5EY3pOamcwTWpFd05UTXNMVEF1TURJeE1qYzJOVGsxTnpRME5qZ3dOemNzTFRBdU16WTROREl4TURVeU5qTXhOVGM1TEMwd0xqSXpOREEwTWpVMU16RTVNVFE0T1RNM0xDMHdMall6TVRVM09EazBOek0yT0RReU1URXNMVEF1TkRjNE56SXpOREEwTWpVMU16RTVNVjFkTEZzaWFXMWhaMlZ6TDJobFlXUXRjMmhsWlhRd0xuZGxZbkFpTERnek56QXNOREVzTlRBc016Z3NORGNzWm1Gc2MyVXNNU3d3TGpNME1qRXdOVEkyTXpFMU56ZzVORGMxTERBdU9UYzROekl6TkRBME1qVTFNekU1TVN4YlhTeGJMVEF1TXpFMU56ZzVORGN6TmpnME1qRXdOU3d0TUM0NU5UYzBORFk0TURnMU1UQTJNemd5TERBdU1UVTNPRGswTnpNMk9EUXlNVEExTWpVc0xUQXVPVGM0TnpJek5EQTBNalUxTXpFNU1Td3dMall3TlRJMk16RTFOemc1TkRjek5qY3NMVEF1T1RVM05EUTJPREE0TlRFd05qTTRNaXd3TGpZd05USTJNekUxTnpnNU5EY3pOamNzTFRBdU5EYzROekl6TkRBME1qVTFNekU1TVN3d0xqTTBNakV3TlRJMk16RTFOemc1TkRjMUxDMHdMakl6TkRBME1qVTFNekU1TVRRNE9UTTNMREF1TVRVM09EazBOek0yT0RReU1UQTFNalVzTFRBdU1ESXhNamMyTlRrMU56UTBOamd3Tnpjc0xUQXVNekUxTnpnNU5EY3pOamcwTWpFd05Td3RNQzR3TWpFeU56WTFPVFUzTkRRMk9EQTNOeXd0TUM0ek1UVTNPRGswTnpNMk9EUXlNVEExTEMwd0xqUTNPRGN5TXpRd05ESTFOVE14T1RGZFhTeGJJbWx0WVdkbGN5OW9aV0ZrTFhOb1pXVjBNQzUzWldKd0lpdzRNemN3TERneExEVXdMRE00TERRM0xHWmhiSE5sTERFc01DNHpOREl4TURVeU5qTXhOVGM0T1RRM05Td3dMamszT0RjeU16UXdOREkxTlRNeE9URXNXMTBzV3kwd0xqTXhOVGM0T1RRM016WTROREl4TURVc0xUQXVPVFUzTkRRMk9EQTROVEV3TmpNNE1pd3dMakUxTnpnNU5EY3pOamcwTWpFd05USTFMQzB3TGprM09EY3lNelF3TkRJMU5UTXhPVEVzTUM0Mk1EVXlOak14TlRjNE9UUTNNelkzTEMwd0xqazFOelEwTmpnd09EVXhNRFl6T0RJc01DNDJNRFV5TmpNeE5UYzRPVFEzTXpZM0xDMHdMalEzT0RjeU16UXdOREkxTlRNeE9URXNNQzR6TkRJeE1EVXlOak14TlRjNE9UUTNOU3d0TUM0eU16UXdOREkxTlRNeE9URTBPRGt6Tnl3d0xqRTFOemc1TkRjek5qZzBNakV3TlRJMUxDMHdMakF5TVRJM05qVTVOVGMwTkRZNE1EYzNMQzB3TGpNeE5UYzRPVFEzTXpZNE5ESXhNRFVzTFRBdU1ESXhNamMyTlRrMU56UTBOamd3Tnpjc0xUQXVNekUxTnpnNU5EY3pOamcwTWpFd05Td3RNQzQwTnpnM01qTTBNRFF5TlRVek1Ua3hYVjBzV3lKcGJXRm5aWE12YUdWaFpDMXphR1ZsZERBdWQyVmljQ0lzT0RNM01Dd3hNakVzTlRBc016Z3NORGNzWm1Gc2MyVXNNU3d3TGpNME1qRXdOVEkyTXpFMU56ZzVORGMxTERBdU9UYzROekl6TkRBME1qVTFNekU1TVN4YlhTeGJMVEF1TXpFMU56ZzVORGN6TmpnME1qRXdOU3d0TUM0NU5UYzBORFk0TURnMU1UQTJNemd5TERBdU1UVTNPRGswTnpNMk9EUXlNVEExTWpVc0xUQXVPVGM0TnpJek5EQTBNalUxTXpFNU1Td3dMall3TlRJMk16RTFOemc1TkRjek5qY3NMVEF1T1RVM05EUTJPREE0TlRFd05qTTRNaXd3TGpZd05USTJNekUxTnpnNU5EY3pOamNzTFRBdU5EYzROekl6TkRBME1qVTFNekU1TVN3d0xqTTBNakV3TlRJMk16RTFOemc1TkRjMUxDMHdMakl6TkRBME1qVTFNekU1TVRRNE9UTTNMREF1TVRVM09EazBOek0yT0RReU1UQTFNalVzTFRBdU1ESXhNamMyTlRrMU56UTBOamd3Tnpjc0xUQXVNekUxTnpnNU5EY3pOamcwTWpFd05Td3RNQzR3TWpFeU56WTFPVFUzTkRRMk9EQTNOeXd0TUM0ek1UVTNPRGswTnpNMk9EUXlNVEExTEMwd0xqUTNPRGN5TXpRd05ESTFOVE14T1RGZFhTeGJJbWx0WVdkbGN5OW9aV0ZrTFhOb1pXVjBNQzUzWldKd0lpdzRNemN3TERFMk1TdzJOU3d6T0N3ME55eG1ZV3h6WlN3eExEQXVNelF5TVRBMU1qWXpNVFUzT0RrME56VXNNQzQ1TnpnM01qTTBNRFF5TlRVek1Ua3hMRnRkTEZzdE1DNHpNVFUzT0RrME56TTJPRFF5TVRBMUxDMHdMamsxTnpRME5qZ3dPRFV4TURZek9ESXNNQzR4TlRjNE9UUTNNelk0TkRJeE1EVXlOU3d0TUM0NU56ZzNNak0wTURReU5UVXpNVGt4TERBdU5qQTFNall6TVRVM09EazBOek0yTnl3dE1DNDVOVGMwTkRZNE1EZzFNVEEyTXpneUxEQXVOakExTWpZek1UVTNPRGswTnpNMk55d3RNQzQwTnpnM01qTTBNRFF5TlRVek1Ua3hMREF1TXpReU1UQTFNall6TVRVM09EazBOelVzTFRBdU1qTTBNRFF5TlRVek1Ua3hORGc1TXpjc01DNHhOVGM0T1RRM016WTROREl4TURVeU5Td3RNQzR3TWpFeU56WTFPVFUzTkRRMk9EQTNOeXd0TUM0ek1UVTNPRGswTnpNMk9EUXlNVEExTEMwd0xqQXlNVEkzTmpVNU5UYzBORFk0TURjM0xDMHdMak14TlRjNE9UUTNNelk0TkRJeE1EVXNMVEF1TkRjNE56SXpOREEwTWpVMU16RTVNVjFkTEZzaWFXMWhaMlZ6TDJobFlXUXRjMmhsWlhRd0xuZGxZbkFpTERnek56QXNNakF4TERZMUxETTRMRFEzTEdaaGJITmxMREVzTUM0ek5ESXhNRFV5TmpNeE5UYzRPVFEzTlN3d0xqazNPRGN5TXpRd05ESTFOVE14T1RFc1cxMHNXeTB3TGpNeE5UYzRPVFEzTXpZNE5ESXhNRFVzTFRBdU9UVTNORFEyT0RBNE5URXdOak00TWl3d0xqRTFOemc1TkRjek5qZzBNakV3TlRJMUxDMHdMamszT0RjeU16UXdOREkxTlRNeE9URXNNQzQyTURVeU5qTXhOVGM0T1RRM016WTNMQzB3TGprMU56UTBOamd3T0RVeE1EWXpPRElzTUM0Mk1EVXlOak14TlRjNE9UUTNNelkzTEMwd0xqUTNPRGN5TXpRd05ESTFOVE14T1RFc01DNHpOREl4TURVeU5qTXhOVGM0T1RRM05Td3RNQzR5TXpRd05ESTFOVE14T1RFME9Ea3pOeXd3TGpFMU56ZzVORGN6TmpnME1qRXdOVEkxTEMwd0xqQXlNVEkzTmpVNU5UYzBORFk0TURjM0xDMHdMak14TlRjNE9UUTNNelk0TkRJeE1EVXNMVEF1TURJeE1qYzJOVGsxTnpRME5qZ3dOemNzTFRBdU16RTFOemc1TkRjek5qZzBNakV3TlN3dE1DNDBOemczTWpNME1EUXlOVFV6TVRreFhWMHNXeUpwYldGblpYTXZhR1ZoWkMxemFHVmxkREF1ZDJWaWNDSXNPRE0zTUN3eExEazVMRE00TERRM0xHWmhiSE5sTERFc01DNHpOREl4TURVeU5qTXhOVGM0T1RRM05Td3dMamszT0RjeU16UXdOREkxTlRNeE9URXNXMTBzV3kwd0xqTXhOVGM0T1RRM016WTROREl4TURVc0xUQXVPVFUzTkRRMk9EQTROVEV3TmpNNE1pd3dMakUxTnpnNU5EY3pOamcwTWpFd05USTFMQzB3TGprM09EY3lNelF3TkRJMU5UTXhPVEVzTUM0Mk1EVXlOak14TlRjNE9UUTNNelkzTEMwd0xqazFOelEwTmpnd09EVXhNRFl6T0RJc01DNDJNRFV5TmpNeE5UYzRPVFEzTXpZM0xDMHdMalEzT0RjeU16UXdOREkxTlRNeE9URXNNQzR6TkRJeE1EVXlOak14TlRjNE9UUTNOU3d0TUM0eU16UXdOREkxTlRNeE9URTBPRGt6Tnl3d0xqRTFOemc1TkRjek5qZzBNakV3TlRJMUxDMHdMakF5TVRJM05qVTVOVGMwTkRZNE1EYzNMQzB3TGpNeE5UYzRPVFEzTXpZNE5ESXhNRFVzTFRBdU1ESXhNamMyTlRrMU56UTBOamd3Tnpjc0xUQXVNekUxTnpnNU5EY3pOamcwTWpFd05Td3RNQzQwTnpnM01qTTBNRFF5TlRVek1Ua3hYVjBzV3lKcGJXRm5aWE12YUdWaFpDMXphR1ZsZERBdWQyVmljQ0lzT0RNM01DdzBNU3c1T1N3ek9DdzBOeXhtWVd4elpTd3hMREF1TXpZNE5ESXhNRFV5TmpNeE5UYzRPU3d3TGprM09EY3lNelF3TkRJMU5UTXhPVEVzVzEwc1d5MHdMak0wTWpFd05USTJNekUxTnpnNU5EY3NMVEF1T1RVM05EUTJPREE0TlRFd05qTTRNaXd3TGpFek1UVTNPRGswTnpNMk9EUXlNVEEzTEMwd0xqazNPRGN5TXpRd05ESTFOVE14T1RFc01DNDFOemc1TkRjek5qZzBNakV3TlRJM0xDMHdMamsxTnpRME5qZ3dPRFV4TURZek9ESXNNQzQxTnpnNU5EY3pOamcwTWpFd05USTNMQzB3TGpRM09EY3lNelF3TkRJMU5UTXhPVEVzTUM0ek1UVTNPRGswTnpNMk9EUXlNVEExTml3dE1DNHlNelF3TkRJMU5UTXhPVEUwT0Rrek55d3dMakV6TVRVM09EazBOek0yT0RReU1UQTNMQzB3TGpBeU1USTNOalU1TlRjME5EWTRNRGMzTEMwd0xqTTBNakV3TlRJMk16RTFOemc1TkRjc0xUQXVNREl4TWpjMk5UazFOelEwTmpnd056Y3NMVEF1TXpReU1UQTFNall6TVRVM09EazBOeXd0TUM0ME56ZzNNak0wTURReU5UVXpNVGt4WFYwc1d5SnBiV0ZuWlhNdmFHVmhaQzF6YUdWbGREQXVkMlZpY0NJc09ETTNNQ3c0TVN3NU9Td3pPQ3cwTnl4bVlXeHpaU3d4TERBdU5qVTNPRGswTnpNMk9EUXlNVEExTXl3d0xqazNPRGN5TXpRd05ESTFOVE14T1RFc1cxMHNXeTB3TGpZek1UVTNPRGswTnpNMk9EUXlNVEVzTFRBdU9UVTNORFEyT0RBNE5URXdOak00TWl3dE1DNHhOVGM0T1RRM016WTROREl4TURVekxDMHdMamszT0RjeU16UXdOREkxTlRNeE9URXNNQzR5T0RrME56TTJPRFF5TVRBMU1qWXlMQzB3TGprMU56UTBOamd3T0RVeE1EWXpPRElzTUM0eU9EazBOek0yT0RReU1UQTFNall5TEMwd0xqUTNPRGN5TXpRd05ESTFOVE14T1RFc01DNHlPRGswTnpNMk9EUXlNVEExTWpZeUxDMHdMakF5TVRJM05qVTVOVGMwTkRZNE1EYzNMQzB3TGpFMU56ZzVORGN6TmpnME1qRXdOVE1zTFRBdU1ESXhNamMyTlRrMU56UTBOamd3Tnpjc0xUQXVNelk0TkRJeE1EVXlOak14TlRjNUxDMHdMakl6TkRBME1qVTFNekU1TVRRNE9UTTNMQzB3TGpZek1UVTNPRGswTnpNMk9EUXlNVEVzTFRBdU5EYzROekl6TkRBME1qVTFNekU1TVYxZExGc2lhVzFoWjJWekwyaGxZV1F0YzJobFpYUXdMbmRsWW5BaUxEZ3pOekFzTVRJeExEazVMRE00TERRM0xHWmhiSE5sTERFc01DNDJOVGM0T1RRM016WTROREl4TURVekxEQXVPVGM0TnpJek5EQTBNalUxTXpFNU1TeGJYU3hiTFRBdU5qTXhOVGM0T1RRM016WTROREl4TVN3dE1DNDVOVGMwTkRZNE1EZzFNVEEyTXpneUxDMHdMakUxTnpnNU5EY3pOamcwTWpFd05UTXNMVEF1T1RjNE56SXpOREEwTWpVMU16RTVNU3d3TGpJNE9UUTNNelk0TkRJeE1EVXlOaklzTFRBdU9UVTNORFEyT0RBNE5URXdOak00TWl3d0xqSTRPVFEzTXpZNE5ESXhNRFV5TmpJc0xUQXVORGM0TnpJek5EQTBNalUxTXpFNU1Td3dMakk0T1RRM016WTROREl4TURVeU5qSXNMVEF1TURJeE1qYzJOVGsxTnpRME5qZ3dOemNzTFRBdU1UVTNPRGswTnpNMk9EUXlNVEExTXl3dE1DNHdNakV5TnpZMU9UVTNORFEyT0RBM055d3RNQzR6TmpnME1qRXdOVEkyTXpFMU56a3NMVEF1TWpNME1EUXlOVFV6TVRreE5EZzVNemNzTFRBdU5qTXhOVGM0T1RRM016WTROREl4TVN3dE1DNDBOemczTWpNME1EUXlOVFV6TVRreFhWMHNXeUpwYldGblpYTXZhR1ZoWkMxemFHVmxkREF1ZDJWaWNDSXNPRE0zTUN3eE5qRXNNVEk1TERNNExEUTNMR1poYkhObExERXNNQzQyTlRjNE9UUTNNelk0TkRJeE1EVXpMREF1T1RjNE56SXpOREEwTWpVMU16RTVNU3hiWFN4YkxUQXVOak14TlRjNE9UUTNNelk0TkRJeE1Td3RNQzQ1TlRjME5EWTRNRGcxTVRBMk16Z3lMQzB3TGpFMU56ZzVORGN6TmpnME1qRXdOVE1zTFRBdU9UYzROekl6TkRBME1qVTFNekU1TVN3d0xqSTRPVFEzTXpZNE5ESXhNRFV5TmpJc0xUQXVPVFUzTkRRMk9EQTROVEV3TmpNNE1pd3dMakk0T1RRM016WTROREl4TURVeU5qSXNMVEF1TkRjNE56SXpOREEwTWpVMU16RTVNU3d3TGpJNE9UUTNNelk0TkRJeE1EVXlOaklzTFRBdU1ESXhNamMyTlRrMU56UTBOamd3Tnpjc0xUQXVNVFUzT0RrME56TTJPRFF5TVRBMU15d3RNQzR3TWpFeU56WTFPVFUzTkRRMk9EQTNOeXd0TUM0ek5qZzBNakV3TlRJMk16RTFOemtzTFRBdU1qTTBNRFF5TlRVek1Ua3hORGc1TXpjc0xUQXVOak14TlRjNE9UUTNNelk0TkRJeE1Td3RNQzQwTnpnM01qTTBNRFF5TlRVek1Ua3hYVjBzV3lKcGJXRm5aWE12YUdWaFpDMXphR1ZsZERBdWQyVmljQ0lzT0RNM01Dd3lNREVzTVRJNUxETTRMRFEzTEdaaGJITmxMREVzTUM0Mk5UYzRPVFEzTXpZNE5ESXhNRFV6TERBdU9UYzROekl6TkRBME1qVTFNekU1TVN4YlhTeGJMVEF1TmpNeE5UYzRPVFEzTXpZNE5ESXhNU3d0TUM0NU5UYzBORFk0TURnMU1UQTJNemd5TEMwd0xqRTFOemc1TkRjek5qZzBNakV3TlRNc0xUQXVPVGM0TnpJek5EQTBNalUxTXpFNU1Td3dMakk0T1RRM016WTROREl4TURVeU5qSXNMVEF1T1RVM05EUTJPREE0TlRFd05qTTRNaXd3TGpJNE9UUTNNelk0TkRJeE1EVXlOaklzTFRBdU5EYzROekl6TkRBME1qVTFNekU1TVN3d0xqSTRPVFEzTXpZNE5ESXhNRFV5TmpJc0xUQXVNREl4TWpjMk5UazFOelEwTmpnd056Y3NMVEF1TVRVM09EazBOek0yT0RReU1UQTFNeXd0TUM0d01qRXlOelkxT1RVM05EUTJPREEzTnl3dE1DNHpOamcwTWpFd05USTJNekUxTnprc0xUQXVNak0wTURReU5UVXpNVGt4TkRnNU16Y3NMVEF1TmpNeE5UYzRPVFEzTXpZNE5ESXhNU3d0TUM0ME56ZzNNak0wTURReU5UVXpNVGt4WFYwc1d5SnBiV0ZuWlhNdmFHVmhaQzF6YUdWbGREQXVkMlZpY0NJc09ETTNNQ3d4TERFME9Dd3pPQ3cwTnl4bVlXeHpaU3d4TERBdU5qVTNPRGswTnpNMk9EUXlNVEExTXl3d0xqazNPRGN5TXpRd05ESTFOVE14T1RFc1cxMHNXeTB3TGpZek1UVTNPRGswTnpNMk9EUXlNVEVzTFRBdU9UVTNORFEyT0RBNE5URXdOak00TWl3dE1DNHhOVGM0T1RRM016WTROREl4TURVekxDMHdMamszT0RjeU16UXdOREkxTlRNeE9URXNNQzR5T0RrME56TTJPRFF5TVRBMU1qWXlMQzB3TGprMU56UTBOamd3T0RVeE1EWXpPRElzTUM0eU9EazBOek0yT0RReU1UQTFNall5TEMwd0xqUTNPRGN5TXpRd05ESTFOVE14T1RFc01DNHlPRGswTnpNMk9EUXlNVEExTWpZeUxDMHdMakF5TVRJM05qVTVOVGMwTkRZNE1EYzNMQzB3TGpFMU56ZzVORGN6TmpnME1qRXdOVE1zTFRBdU1ESXhNamMyTlRrMU56UTBOamd3Tnpjc0xUQXVNelk0TkRJeE1EVXlOak14TlRjNUxDMHdMakl6TkRBME1qVTFNekU1TVRRNE9UTTNMQzB3TGpZek1UVTNPRGswTnpNMk9EUXlNVEVzTFRBdU5EYzROekl6TkRBME1qVTFNekU1TVYxZExGc2lhVzFoWjJWekwyaGxZV1F0YzJobFpYUXdMbmRsWW5BaUxEZ3pOekFzTkRFc01UUTRMRE00TERRM0xHWmhiSE5sTERFc01DNDJOVGM0T1RRM016WTROREl4TURVekxEQXVPVGM0TnpJek5EQTBNalUxTXpFNU1TeGJYU3hiTFRBdU5qTXhOVGM0T1RRM016WTROREl4TVN3dE1DNDVOVGMwTkRZNE1EZzFNVEEyTXpneUxDMHdMakUxTnpnNU5EY3pOamcwTWpFd05UTXNMVEF1T1RjNE56SXpOREEwTWpVMU16RTVNU3d3TGpJNE9UUTNNelk0TkRJeE1EVXlOaklzTFRBdU9UVTNORFEyT0RBNE5URXdOak00TWl3d0xqSTRPVFEzTXpZNE5ESXhNRFV5TmpJc0xUQXVORGM0TnpJek5EQTBNalUxTXpFNU1Td3dMakk0T1RRM016WTROREl4TURVeU5qSXNMVEF1TURJeE1qYzJOVGsxTnpRME5qZ3dOemNzTFRBdU1UVTNPRGswTnpNMk9EUXlNVEExTXl3dE1DNHdNakV5TnpZMU9UVTNORFEyT0RBM055d3RNQzR6TmpnME1qRXdOVEkyTXpFMU56a3NMVEF1TWpNME1EUXlOVFV6TVRreE5EZzVNemNzTFRBdU5qTXhOVGM0T1RRM016WTROREl4TVN3dE1DNDBOemczTWpNME1EUXlOVFV6TVRreFhWMHNXeUpwYldGblpYTXZhR1ZoWkMxemFHVmxkREF1ZDJWaWNDSXNPRE0zTUN3NE1Td3hORGdzTXpnc05EY3NabUZzYzJVc01Td3dMalkxTnpnNU5EY3pOamcwTWpFd05UTXNNQzQ1TnpnM01qTTBNRFF5TlRVek1Ua3hMRnRkTEZzdE1DNDJNekUxTnpnNU5EY3pOamcwTWpFeExDMHdMamsxTnpRME5qZ3dPRFV4TURZek9ESXNMVEF1TVRVM09EazBOek0yT0RReU1UQTFNeXd0TUM0NU56ZzNNak0wTURReU5UVXpNVGt4TERBdU1qZzVORGN6TmpnME1qRXdOVEkyTWl3dE1DNDVOVGMwTkRZNE1EZzFNVEEyTXpneUxEQXVNamc1TkRjek5qZzBNakV3TlRJMk1pd3RNQzQwTnpnM01qTTBNRFF5TlRVek1Ua3hMREF1TWpnNU5EY3pOamcwTWpFd05USTJNaXd0TUM0d01qRXlOelkxT1RVM05EUTJPREEzTnl3dE1DNHhOVGM0T1RRM016WTROREl4TURVekxDMHdMakF5TVRJM05qVTVOVGMwTkRZNE1EYzNMQzB3TGpNMk9EUXlNVEExTWpZek1UVTNPU3d0TUM0eU16UXdOREkxTlRNeE9URTBPRGt6Tnl3dE1DNDJNekUxTnpnNU5EY3pOamcwTWpFeExDMHdMalEzT0RjeU16UXdOREkxTlRNeE9URmRYU3hiSW1sdFlXZGxjeTlvWldGa0xYTm9aV1YwTUM1M1pXSndJaXc0TXpjd0xERXlNU3d4TkRnc016Z3NORGNzWm1Gc2MyVXNNU3d3TGpZMU56ZzVORGN6TmpnME1qRXdOVE1zTUM0NU56ZzNNak0wTURReU5UVXpNVGt4TEZ0ZExGc3RNQzQyTXpFMU56ZzVORGN6TmpnME1qRXhMQzB3TGprMU56UTBOamd3T0RVeE1EWXpPRElzTFRBdU1UVTNPRGswTnpNMk9EUXlNVEExTXl3dE1DNDVOemczTWpNME1EUXlOVFV6TVRreExEQXVNamc1TkRjek5qZzBNakV3TlRJMk1pd3RNQzQ1TlRjME5EWTRNRGcxTVRBMk16Z3lMREF1TWpnNU5EY3pOamcwTWpFd05USTJNaXd0TUM0ME56ZzNNak0wTURReU5UVXpNVGt4TERBdU1ESTJNekUxTnpnNU5EY3pOamcwTVRnc0xUQXVNak0wTURReU5UVXpNVGt4TkRnNU16Y3NMVEF1TVRVM09EazBOek0yT0RReU1UQTFNeXd0TUM0d01qRXlOelkxT1RVM05EUTJPREEzTnl3dE1DNDJNekUxTnpnNU5EY3pOamcwTWpFeExDMHdMakF5TVRJM05qVTVOVGMwTkRZNE1EYzNMQzB3TGpZek1UVTNPRGswTnpNMk9EUXlNVEVzTFRBdU5EYzROekl6TkRBME1qVTFNekU1TVYxZExGc2lhVzFoWjJWekwyaGxZV1F0YzJobFpYUXdMbmRsWW5BaUxEZ3pOekFzTVRZeExERTVNeXd6T0N3ME55eG1ZV3h6WlN3eExEQXVNelF5TVRBMU1qWXpNVFUzT0RrME56VXNNQzQ1TnpnM01qTTBNRFF5TlRVek1Ua3hMRnRkTEZzdE1DNHpNVFUzT0RrME56TTJPRFF5TVRBMUxDMHdMamsxTnpRME5qZ3dPRFV4TURZek9ESXNNQzR4TlRjNE9UUTNNelk0TkRJeE1EVXlOU3d0TUM0NU56ZzNNak0wTURReU5UVXpNVGt4TERBdU5qQTFNall6TVRVM09EazBOek0yTnl3dE1DNDVOVGMwTkRZNE1EZzFNVEEyTXpneUxEQXVOakExTWpZek1UVTNPRGswTnpNMk55d3RNQzQwTnpnM01qTTBNRFF5TlRVek1Ua3hMREF1TXpReU1UQTFNall6TVRVM09EazBOelVzTFRBdU1qTTBNRFF5TlRVek1Ua3hORGc1TXpjc01DNHhOVGM0T1RRM016WTROREl4TURVeU5Td3RNQzR3TWpFeU56WTFPVFUzTkRRMk9EQTNOeXd0TUM0ek1UVTNPRGswTnpNMk9EUXlNVEExTEMwd0xqQXlNVEkzTmpVNU5UYzBORFk0TURjM0xDMHdMak14TlRjNE9UUTNNelk0TkRJeE1EVXNMVEF1TkRjNE56SXpOREEwTWpVMU16RTVNVjFkTEZzaWFXMWhaMlZ6TDJobFlXUXRjMmhsWlhRd0xuZGxZbkFpTERnek56QXNNakF4TERFNU15d3pPQ3cwTnl4bVlXeHpaU3d4TERBdU16UXlNVEExTWpZek1UVTNPRGswTnpVc01DNDVOemczTWpNME1EUXlOVFV6TVRreExGdGRMRnN0TUM0ek1UVTNPRGswTnpNMk9EUXlNVEExTEMwd0xqazFOelEwTmpnd09EVXhNRFl6T0RJc01DNHhOVGM0T1RRM016WTROREl4TURVeU5Td3RNQzQ1TnpnM01qTTBNRFF5TlRVek1Ua3hMREF1TmpBMU1qWXpNVFUzT0RrME56TTJOeXd0TUM0NU5UYzBORFk0TURnMU1UQTJNemd5TERBdU5qQTFNall6TVRVM09EazBOek0yTnl3dE1DNDBOemczTWpNME1EUXlOVFV6TVRreExEQXVNelF5TVRBMU1qWXpNVFUzT0RrME56VXNMVEF1TWpNME1EUXlOVFV6TVRreE5EZzVNemNzTUM0eE5UYzRPVFEzTXpZNE5ESXhNRFV5TlN3dE1DNHdNakV5TnpZMU9UVTNORFEyT0RBM055d3RNQzR6TVRVM09EazBOek0yT0RReU1UQTFMQzB3TGpBeU1USTNOalU1TlRjME5EWTRNRGMzTEMwd0xqTXhOVGM0T1RRM016WTROREl4TURVc0xUQXVORGM0TnpJek5EQTBNalUxTXpFNU1WMWRMRnNpYVcxaFoyVnpMMmhsWVdRdGMyaGxaWFF3TG5kbFluQWlMRGd6TnpBc01Td3hPVGNzTXpnc05EY3NabUZzYzJVc01Td3dMak0wTWpFd05USTJNekUxTnpnNU5EYzFMREF1T1RjNE56SXpOREEwTWpVMU16RTVNU3hiWFN4YkxUQXVNekUxTnpnNU5EY3pOamcwTWpFd05Td3RNQzQ1TlRjME5EWTRNRGcxTVRBMk16Z3lMREF1TVRVM09EazBOek0yT0RReU1UQTFNalVzTFRBdU9UYzROekl6TkRBME1qVTFNekU1TVN3d0xqWXdOVEkyTXpFMU56ZzVORGN6Tmpjc0xUQXVPVFUzTkRRMk9EQTROVEV3TmpNNE1pd3dMall3TlRJMk16RTFOemc1TkRjek5qY3NMVEF1TkRjNE56SXpOREEwTWpVMU16RTVNU3d3TGpNME1qRXdOVEkyTXpFMU56ZzVORGMxTEMwd0xqSXpOREEwTWpVMU16RTVNVFE0T1RNM0xEQXVNVFUzT0RrME56TTJPRFF5TVRBMU1qVXNMVEF1TURJeE1qYzJOVGsxTnpRME5qZ3dOemNzTFRBdU16RTFOemc1TkRjek5qZzBNakV3TlN3dE1DNHdNakV5TnpZMU9UVTNORFEyT0RBM055d3RNQzR6TVRVM09EazBOek0yT0RReU1UQTFMQzB3TGpRM09EY3lNelF3TkRJMU5UTXhPVEZkWFN4YkltbHRZV2RsY3k5b1pXRmtMWE5vWldWME1DNTNaV0p3SWl3NE16Y3dMRFF4TERFNU55d3pPQ3cwTnl4bVlXeHpaU3d4TERBdU16UXlNVEExTWpZek1UVTNPRGswTnpVc01DNDVOemczTWpNME1EUXlOVFV6TVRreExGdGRMRnN0TUM0ek1UVTNPRGswTnpNMk9EUXlNVEExTEMwd0xqazFOelEwTmpnd09EVXhNRFl6T0RJc01DNHhOVGM0T1RRM016WTROREl4TURVeU5Td3RNQzQ1TnpnM01qTTBNRFF5TlRVek1Ua3hMREF1TmpBMU1qWXpNVFUzT0RrME56TTJOeXd0TUM0NU5UYzBORFk0TURnMU1UQTJNemd5TERBdU5qQTFNall6TVRVM09EazBOek0yTnl3dE1DNDBOemczTWpNME1EUXlOVFV6TVRreExEQXVNelF5TVRBMU1qWXpNVFUzT0RrME56VXNMVEF1TWpNME1EUXlOVFV6TVRreE5EZzVNemNzTUM0eE5UYzRPVFEzTXpZNE5ESXhNRFV5TlN3dE1DNHdNakV5TnpZMU9UVTNORFEyT0RBM055d3RNQzR6TVRVM09EazBOek0yT0RReU1UQTFMQzB3TGpBeU1USTNOalU1TlRjME5EWTRNRGMzTEMwd0xqTXhOVGM0T1RRM016WTROREl4TURVc0xUQXVORGM0TnpJek5EQTBNalUxTXpFNU1WMWRMRnNpYVcxaFoyVnpMMmhsWVdRdGMyaGxaWFF3TG5kbFluQWlMRGd6TnpBc09ERXNNVGszTERNNExEUTNMR1poYkhObExERXNNQzR6TkRJeE1EVXlOak14TlRjNE9UUTNOU3d3TGprM09EY3lNelF3TkRJMU5UTXhPVEVzVzEwc1d5MHdMak14TlRjNE9UUTNNelk0TkRJeE1EVXNMVEF1T1RVM05EUTJPREE0TlRFd05qTTRNaXd3TGpFMU56ZzVORGN6TmpnME1qRXdOVEkxTEMwd0xqazNPRGN5TXpRd05ESTFOVE14T1RFc01DNDJNRFV5TmpNeE5UYzRPVFEzTXpZM0xDMHdMamsxTnpRME5qZ3dPRFV4TURZek9ESXNNQzQyTURVeU5qTXhOVGM0T1RRM016WTNMQzB3TGpRM09EY3lNelF3TkRJMU5UTXhPVEVzTUM0ek5ESXhNRFV5TmpNeE5UYzRPVFEzTlN3dE1DNHlNelF3TkRJMU5UTXhPVEUwT0Rrek55d3dMakUxTnpnNU5EY3pOamcwTWpFd05USTFMQzB3TGpBeU1USTNOalU1TlRjME5EWTRNRGMzTEMwd0xqTXhOVGM0T1RRM016WTROREl4TURVc0xUQXVNREl4TWpjMk5UazFOelEwTmpnd056Y3NMVEF1TXpFMU56ZzVORGN6TmpnME1qRXdOU3d0TUM0ME56ZzNNak0wTURReU5UVXpNVGt4WFYwc1d5SnBiV0ZuWlhNdmFHVmhaQzF6YUdWbGREQXVkMlZpY0NJc09ETTNNQ3d4TWpFc01UazNMRE00TERRM0xHWmhiSE5sTERFc01DNHpOREl4TURVeU5qTXhOVGM0T1RRM05Td3dMamszT0RjeU16UXdOREkxTlRNeE9URXNXMTBzV3kwd0xqTXhOVGM0T1RRM016WTROREl4TURVc0xUQXVPVFUzTkRRMk9EQTROVEV3TmpNNE1pd3dMakUxTnpnNU5EY3pOamcwTWpFd05USTFMQzB3TGprM09EY3lNelF3TkRJMU5UTXhPVEVzTUM0Mk1EVXlOak14TlRjNE9UUTNNelkzTEMwd0xqazFOelEwTmpnd09EVXhNRFl6T0RJc01DNDJNRFV5TmpNeE5UYzRPVFEzTXpZM0xDMHdMalEzT0RjeU16UXdOREkxTlRNeE9URXNNQzR6TkRJeE1EVXlOak14TlRjNE9UUTNOU3d0TUM0eU16UXdOREkxTlRNeE9URTBPRGt6Tnl3d0xqRTFOemc1TkRjek5qZzBNakV3TlRJMUxDMHdMakF5TVRJM05qVTVOVGMwTkRZNE1EYzNMQzB3TGpNeE5UYzRPVFEzTXpZNE5ESXhNRFVzTFRBdU1ESXhNamMyTlRrMU56UTBOamd3Tnpjc0xUQXVNekUxTnpnNU5EY3pOamcwTWpFd05Td3RNQzQwTnpnM01qTTBNRFF5TlRVek1Ua3hYVjFkWFYwc1cxc2lVR2g1YzJsamN5SXNNVEVzTVRjMk5UVTBNekkzTVRBek1EWXpMREV6WFYwc1ptRnNjMlVzWm1Gc2MyVXNNelU1TXpjNU9UUXhPVFl6TmpJMExGdGRMRzUxYkd3c01qa3NiblZzYkYwc1d5SnRZV2x1Ym1GdFpTSXNNVEFzWm1Gc2MyVXNXMTBzTWl3d0xHNTFiR3dzVzFzaVFXNXBiV0YwYVc5dUlERWlMREFzWm1Gc2MyVXNNU3d3TEdaaGJITmxMRGMyT0RRNU16STJNelk1TVRNMU5TeGJXeUpwYldGblpYTXZjMmhoY21Wa0xUQXRjMmhsWlhRd0xuZGxZbkFpTERJeE9UazVNeXd4TERFc05Ea3hMREk0Tml4MGNuVmxMREVzTUM0ME56UTFOREUzTlRFMU1qYzBPVFE1TERBdU5qSTVNemN3TmpJNU16Y3dOakk1TkN4YlhTeGJMVEF1TXpnNU5UazJNak16TlRFMU1qRTFOaXd0TUM0eU56TXdNVEkyTURnek5qZzFNak14TlN3dE1DNHdOVE15TmpVeE56SXdOelkyT0RFNU1Td3RNQzQyTURNMU5EUTNOelUyTVRFd05ERXhMREF1TWpJMU1qSTVOVEU1T1RFNE1qRTFPVFFzTFRBdU1EVTNORFE0TVRVeE5EY3hNakk0TnpJMkxEQXVNak16T1RBeU1UZ3hNekEzTWpVeE9UTXNNQzR5TnpBMk9EZzROVFV4TXprd09UWTVMREF1TWpNek9UQXlNVGd4TXpBM01qVXhPVE1zTUM0ek56QTJNamt6TnpBMk1qa3pOekEyTEMwd0xqQTFNekkyTlRFM01qQTNOalk0TVRreExEQXVNemN3TmpJNU16Y3dOakk1TXpjd05pd3RNQzR6TVRZMk56SXhNVFUxTWpFd05qWXpNeXd3TGpNM01EWXlPVE0zTURZeU9UTTNNRFlzTFRBdU5EYzBOVFF4TnpVeE5USTNORGswT1N3d0xqSTNNRFk0T0RnMU5URXpPVEE1TmpsZFhTeGJJbWx0WVdkbGN5OXphR0Z5WldRdE1DMXphR1ZsZERBdWQyVmljQ0lzTWpFNU9Ua3pMREk0T1N3eExEUTVNU3d5T0RZc2RISjFaU3d4TERBdU5EWXdNamcxTVRNeU16Z3lPRGt5TURRc01DNHpOelF4TWpVNE56UXhNalU0TnpReExGdGRMRnN0TUM0ME16TXhOVE16TXpBeU1URXdOakUwTlN3dE1DNHpNelExT0RrMU1ESTFNelEwTmpBNExEQXVNRGc1TmpjeE5qY3hOall6T0RRMU5Ea3NMVEF1TWpnd01qSTJPVGt4TlRrMk1qWTNOU3d3TGpRM016QXdNVFF5TURVeU56UTNOemN6TEMwd0xqSTFOems0TnpjNE1qVTNOakE1TnpRMUxEQXVNemcwTWpRNE5EUTFNVEE0TWpnNU5pd3RNQzR3TnpJMk5qRXdOREEzTkRFek5EYzFOU3d3TGpNNE5ESTBPRFEwTlRFd09ESTRPVFlzTFRBdU1EazVPRFF5TWprMk1qRXdORFEwTVRZc01DNHdPRGsyTnpFMk56RTJOak00TkRVME9Td3dMakV3TmpnNE56ZzJOek0zTnpNM056a3pMQzB3TGpNMk5EZzNNemswTlRZek56ZzBOaXd3TGpFd01ETXhNRFU0TkRrM01UQTROVGMxTEMwd0xqTXlNemt3TmpNeE5EZzVNemt4Tmpjc0xUQXVNRGN5TmpZeE1EUXdOelF4TXpRM05UVmRYVjFkWFN4Yld5SlRhVzVsSWl3eE5Td3lNak0wTWpnME5EazVOVGt4TlRrc016QmRMRnNpVTJsdVpUSWlMREUxTERJME9EUTRPRGczTmpJeU9EWTNOQ3d6TVYxZExHWmhiSE5sTEdaaGJITmxMRFUxTVRjeU56WXlOVGt3TlRZMk1peGJYU3h1ZFd4c0xETXlMRzUxYkd4ZExGc2liV1Z1ZFdKaFkyc2lMRGtzWm1Gc2MyVXNXMTBzTVN3d0xGc2lhVzFoWjJWekwyMWxiblZpWVdOckxYTm9aV1YwTUM1M1pXSndJaXd4Tnprek9Dd3dMREFzTVRJNE1DdzNNakVzWm1Gc2MyVmRMRzUxYkd3c1cxc2lRVzVqYUc5eUlpdzNMRGMxTXpjME5qSTNNalU0TkRFd09DdzJYVjBzWm1Gc2MyVXNabUZzYzJVc05qQTVOakEyTkRFNE5qazVOVGN5TEZ0ZExHNTFiR3dzTXpNc1d6RXNNVjFkTEZzaWJXVnVkV0oxZEhSdmJpSXNNVEFzWm1Gc2MyVXNXMTBzTUN3eExHNTFiR3dzVzFzaVFXNXBiV0YwYVc5dUlERWlMREFzWm1Gc2MyVXNNU3d3TEdaaGJITmxMRFU0TnpZMk1qa3dOek16T0RJNE55eGJXeUpwYldGblpYTXZjMmhoY21Wa0xUQXRjMmhsWlhRd0xuZGxZbkFpTERJeE9UazVNeXcxTVRNc01USTRNU3d4TnpJc01UY3lMR1poYkhObExERXNNQzQxTERBdU5TeGJYU3hiTFRBdU5EUTFNemN5TXpZeE9EYzJOVGsyTXpVc0xUQXVORFExTXpjeU16WXhPRGMyTlRrMk16VXNNQ3d0TUM0ME9URXpORFl5T0RNeE1ESTFOamMxTml3d0xqUXpPVFl5TlRZeU1UY3lNek0wT1RrMkxDMHdMalEwTlRNM01qTTJNVGczTmpVNU5qTTFMREF1TkRnMU5UazVOVFF5T1RRNU16SXhNRFlzTUN3d0xqUXpPVFl5TlRZeU1UY3lNek0wT1RrMkxEQXVORE01TmpJMU5qSXhOekl6TXpRNU9UWXNNQ3d3TGpRNE5UVTVPVFUwTWprME9UTXlNVEEyTEMwd0xqUTBOVE0zTWpNMk1UZzNOalU1TmpNMUxEQXVORE01TmpJMU5qSXhOekl6TXpRNU9UWXNMVEF1TkRreE16UTJNamd6TVRBeU5UWTNOVFlzTUYxZExGc2lhVzFoWjJWekwzTm9ZWEpsWkMwd0xYTm9aV1YwTUM1M1pXSndJaXd5TVRrNU9UTXNOVEV6TERFMU16Y3NNVGN5TERFM01peG1ZV3h6WlN3eExEQXVOU3d3TGpVc1cxMHNXeTB3TGpRME5UTTNNak0yTVRnM05qVTVOak0xTEMwd0xqUTBOVE0zTWpNMk1UZzNOalU1TmpNMUxEQXNMVEF1TkRreE16UTJNamd6TVRBeU5UWTNOVFlzTUM0ME16azJNalUyTWpFM01qTXpORGs1Tml3dE1DNDBORFV6TnpJek5qRTROelkxT1RZek5Td3dMalE0TlRVNU9UVTBNamswT1RNeU1UQTJMREFzTUM0ME16azJNalUyTWpFM01qTXpORGs1Tml3d0xqUXpPVFl5TlRZeU1UY3lNek0wT1RrMkxEQXNNQzQwT0RVMU9UazFOREk1TkRrek1qRXdOaXd0TUM0ME5EVXpOekl6TmpFNE56WTFPVFl6TlN3d0xqUXpPVFl5TlRZeU1UY3lNek0wT1RrMkxDMHdMalE1TVRNME5qSTRNekV3TWpVMk56VTJMREJkWFN4YkltbHRZV2RsY3k5emFHRnlaV1F0TUMxemFHVmxkREF1ZDJWaWNDSXNNakU1T1RrekxERXNNVFV6Tnl3eE56SXNNVGN5TEdaaGJITmxMREVzTUM0MUxEQXVOU3hiWFN4YkxUQXVORFV3TlRneE16azFNelE0T0RNM01qTXNMVEF1TkRVd05UZ3hNemsxTXpRNE9ETTNNak1zTUN3dE1DNDBPVFF4T0RZd05EWTFNVEUyTWpjNUxEQXVORFEwTnpZM05EUXhPRFl3TkRZMU1UTXNMVEF1TkRVd05UZ3hNemsxTXpRNE9ETTNNak1zTUM0ME9URXlOemt3TmprM05qYzBOREU0TkN3d0xEQXVORFEwTnpZM05EUXhPRFl3TkRZMU1UTXNNQzQwTkRRM05qYzBOREU0TmpBME5qVXhNeXd3TERBdU5Ea3hNamM1TURZNU56WTNORFF4T0RRc0xUQXVORFV3TlRneE16azFNelE0T0RNM01qTXNNQzQwTkRRM05qYzBOREU0TmpBME5qVXhNeXd0TUM0ME9UUXhPRFl3TkRZMU1URTJNamM1TERCZFhTeGJJbWx0WVdkbGN5OXphR0Z5WldRdE1DMXphR1ZsZERBdWQyVmljQ0lzTWpFNU9Ua3pMREUzTlN3eE5UTTNMREUzTWl3eE56SXNabUZzYzJVc01Td3dMalVzTUM0MUxGdGRMRnN0TUM0ME5UTTBPRGd6TnpJd09UTXdNak16TEMwd0xqUTFNelE0T0RNM01qQTVNekF5TXpNc01DNHdNVGMwTkRFNE5qQTBOalV4TVRZek1Td3RNQzQwT1RReE9EWXdORFkxTVRFMk1qYzVMREF1TkRVNU16QXlNekkxTlRneE16azFOQ3d0TUM0ME16QXlNekkxTlRneE16azFNelE0Tnl3d0xqUTVOREU0TmpBME5qVXhNVFl5Tnprc01DNHdNREk1TURZNU56WTNORFF4T0RZd05URTNMREF1TkRVek5EZzRNemN5TURrek1ESXpNeXd3TGpReU5EUXhPRFl3TkRZMU1URTJNamMzTERBdU1ERTNORFF4T0RZd05EWTFNVEUyTXpFc01DNDBPVFF4T0RZd05EWTFNVEUyTWpjNUxDMHdMalEwTnpZM05EUXhPRFl3TkRZMU1USXNNQzQwTkRjMk56UTBNVGcyTURRMk5URXlMQzB3TGpRNU5ERTROakEwTmpVeE1UWXlOemtzTUM0d01ESTVNRFk1TnpZM05EUXhPRFl3TlRFM1hWMWRYVjBzVzEwc1ptRnNjMlVzWm1Gc2MyVXNORFE1TWpFeE1EQXdNelEyTXprekxGdGJJbWhoY21Sc2FXZG9kQ0lzSWtoaGNtUk1hV2RvZENKZFhTeHVkV3hzTERNMExHNTFiR3hkTEZzaWJXVnVkV2RzWVhOeklpdzVMR1poYkhObExGdGRMREVzTUN4YkltbHRZV2RsY3k5dFpXNTFaMnhoYzNNdGMyaGxaWFF3TG5kbFluQWlMRGt4T1N3d0xEQXNNVFV3TERFMU1DeG1ZV3h6WlYwc2JuVnNiQ3hiV3lKQmJtTm9iM0lpTERjc056YzRNVFEzTVRjM05ESXhNREV5TERaZFhTeG1ZV3h6WlN4bVlXeHpaU3c0T0RBek16WTJPREk1TnpNNE1ESXNXMTBzYm5Wc2JDd3pOU3hiTVN3eFhWMHNXeUpRWVhKMGFXTnNaWE1pTERFMkxHWmhiSE5sTEZ0ZExEQXNNQ3hiSW1sdFlXZGxjeTl6YUdGeVpXUXRNQzF6YUdWbGRESXVkMlZpY0NJc01URTBOQ3d4TERNekxERTRMREU0TEdaaGJITmxYU3h1ZFd4c0xGdGRMR1poYkhObExHWmhiSE5sTERjNU5UQTBNRGswTVRNek56Z3pOU3hiWFN4dWRXeHNMRE0yTEc1MWJHeGRMRnNpVUdGeWRHbGpiR1Z6TWlJc01UWXNabUZzYzJVc1cxczNNakF6TnpjeE16STFNalF4TVRJc01Td2ljMmxrWlNJc016ZGRMRnMzTVRBd09UZzJNalV4TlRNd05ESXNNU3dpZDJsdVpDSXNNemhkTEZzMk5UQTBNemt6TVRrek5EQTVOelVzTVN3aWMzUnlaVzVuZEdnaUxETTVYVjBzTUN3d0xGc2lhVzFoWjJWekwzTm9ZWEpsWkMwd0xYTm9aV1YwTWk1M1pXSndJaXd4TVRRMExERXNNU3d4T0N3eE9DeG1ZV3h6WlYwc2JuVnNiQ3hiWFN4bVlXeHpaU3htWVd4elpTdzNPVFEzT1RZMU1qQTROek0yTnpjc1cxMHNiblZzYkN3ME1DeHVkV3hzWFN4YkluQnNZVzVsZENJc01UQXNabUZzYzJVc1cxMHNNQ3d3TEc1MWJHd3NXMXNpUVc1cGJXRjBhVzl1SURFaUxEQXNabUZzYzJVc01Td3dMR1poYkhObExEVXpPRFF5T0Rnek1qYzNOekkwTml4Yld5SnBiV0ZuWlhNdmMyaGhjbVZrTFRBdGMyaGxaWFF4TG5kbFluQWlMRFl3TmpJeExETTFNeXd4TWprc01UQXdMREV3TUN4bVlXeHpaU3d4TERBdU5Td3dMalVzVzEwc1d6QXVNell3TkRZMU1URTJNamM1TURZNU56UXNMVEF1TXpZd05EWTFNVEUyTWpjNU1EWTVOelFzTUM0MUxEQXNNQzR6TmpBME5qVXhNVFl5Tnprd05qazNOQ3d3TGpNME9EZ3pOekl3T1RNd01qTXlOVFV6TERBc01DNDBPRGd6TnpJd09UTXdNak15TlRVNExDMHdMak0wT0Rnek56SXdPVE13TWpNeU5UVXpMREF1TXpRNE9ETTNNakE1TXpBeU16STFOVE1zTFRBdU5EZzRNemN5TURrek1ESXpNalUxT0N3d0xDMHdMak0wT0Rnek56SXdPVE13TWpNeU5UVXpMQzB3TGpNMk1EUTJOVEV4TmpJM09UQTJPVGMwTERBc0xUQXVOVjFkTEZzaWFXMWhaMlZ6TDNOb1lYSmxaQzB3TFhOb1pXVjBNQzUzWldKd0lpd3lNVGs1T1RNc09EY3lMREUxTXpjc01UTXdMREUxTkN4bVlXeHpaU3d4TERBdU5Td3dMalVzVzEwc1d6QXVNVGN3T1RVNU5EYzFNekEzTXpBeE16Z3NNQzR4TVRZMU16ZzBNVGcyTkRZeE5EY3hNU3d3TERBdU1qVTJNemcwTlRJeE1ESXhOVEl6TXl3d0xqTXpOVFU0TnpFeE9ERTVOVGd4TXprc0xUQXVNell4TWpZNU1EazNPREF6TURVMU5pd3dMalEzTkRnNE56UXpNVFF3T1RFM01EUTFMREFzTUM0ek1qSTVNak0wTlRNek5UZ3lNellzTUM0ek16YzVOakUwTVRRd056TTRNall5TERBc01DNDBOemM0TURjMU1UWTBORGt5TURJMkxDMHdMak00TmpJME1UYzNOelUwTmpFeU5UUXNNQzR6T0RRMU56WTNPREUxTXpJeU9EVXhOQ3d3TGpJeU1UWXhOREV6TkRZMU56WXhNamt6TERCZFhTeGJJbWx0WVdkbGN5OXphR0Z5WldRdE1DMXphR1ZsZERBdWQyVmljQ0lzTWpFNU9Ua3pMRE14Tnl3eE56a3pMREUxTkN3eE5UUXNabUZzYzJVc01Td3dMalVzTUM0MUxGdGRMRnN0TUM0ek5UQTJORGt6TlRBMk5Ea3pOVEEyTml3dE1DNHpOVEEyTkRrek5UQTJORGt6TlRBMk5pd3dMQzB3TGpRNU16VXdOalE1TXpVd05qUTVNelVzTUM0ek5EUXhOVFU0TkRReE5UVTRORFF4TEMwd0xqTTFNRFkwT1RNMU1EWTBPVE0xTURZMkxEQXVORGczTURFeU9UZzNNREV5T1RnM0xEQXNNQzR6TkRReE5UVTRORFF4TlRVNE5EUXhMREF1TXpRME1UVTFPRFEwTVRVMU9EUTBNU3d3TERBdU5EZzNNREV5T1RnM01ERXlPVGczTEMwd0xqTTFNRFkwT1RNMU1EWTBPVE0xTURZMkxEQXVNelEwTVRVMU9EUTBNVFUxT0RRME1Td3RNQzQwT1RNMU1EWTBPVE0xTURZME9UTTFMREJkWFYxZFhTeGJYU3htWVd4elpTeG1ZV3h6WlN3eU9EQTBOVFUzTnpnek16TXpNVElzVzEwc2JuVnNiQ3cwTVN4dWRXeHNYU3hiSW5Ob1lXUnZkeUlzT1N4bVlXeHpaU3hiWFN3eExEQXNXeUpwYldGblpYTXZjMmhoWkc5M0xYTm9aV1YwTUM1M1pXSndJaXd5TVRjc01Dd3dMRFV3TERVd0xHWmhiSE5sWFN4dWRXeHNMRnRiSWtGdVkyaHZjaUlzTnl3ek9UWTROakkzTnpJeU56QXlOVEFzTmwxZExHWmhiSE5sTEdaaGJITmxMREl5TlRjM01ERXlOek16TXpjNU9TeGJYU3h1ZFd4c0xEUXlMRnN4TERGZFhTeGJJbk53WVhkdVpYSWlMREV3TEdaaGJITmxMRnRkTERBc01DeHVkV3hzTEZ0YklrRnVhVzFoZEdsdmJpQXhJaXcxTEdaaGJITmxMREVzTUN4bVlXeHpaU3czT0Rjek16RTBPVGMyTlRBMk1EY3NXMXNpYVcxaFoyVnpMM05vWVhKbFpDMHdMWE5vWldWME1DNTNaV0p3SWl3eU1UazVPVE1zTWpVM0xEYzJPU3d5TlRBc01qVXdMR1poYkhObExERXNNQzQxTERBdU5TeGJYU3hiWFYxZFhWMHNXMTBzWm1Gc2MyVXNabUZzYzJVc05qUTFOVGszTlRnMk1qSXhOalkyTEZ0ZExHNTFiR3dzTkRNc2JuVnNiRjBzV3lKVGNISnBkR1VpTERFd0xHWmhiSE5sTEZ0Yk9EZzNORGN3T0RjeE1qY3lNakV5TERFc0luQnNZWGxsY2lJc01qaGRYU3d3TERBc2JuVnNiQ3hiV3lKaElpd3dMR1poYkhObExERXNNQ3htWVd4elpTd3lORFUwTVRZNE9EWXhNVGcxTlRBc1cxc2lhVzFoWjJWekwzTndjbWwwWlMxemFHVmxkREF1ZDJWaWNDSXNNalEyTWpnc01Td3hMREV6TlN3eE1qQXNkSEoxWlN3eExEQXVOVEU0TlRFNE5URTROVEU0TlRFNE5Td3dMalUxTEZ0ZExGc3RNQzQwT0RFME9ERTBPREUwT0RFME9ERTBOU3d0TUM0MU1EZ3pNek16TXpNek16TXpNek0wTEMwd0xqQXhPRFV4T0RVeE9EVXhPRFV4T0RRNUxDMHdMalUwTVRZMk5qWTJOalkyTmpZMk5qY3NNQzQwTWpJeU1qSXlNakl5TWpJeU1qSXpMQzB3TGpRNU1UWTJOalkyTmpZMk5qWTJOamNzTUM0ME5qWTJOalkyTmpZMk5qWTJOalkzTEMwd0xqQTFNREF3TURBd01EQXdNREF3TURBME5Dd3dMalF5T1RZeU9UWXlPVFl5T1RZeU9UY3NNQzR6T1RFMk5qWTJOalkyTmpZMk5qWTJMQzB3TGpBeE9EVXhPRFV4T0RVeE9EVXhPRFE1TERBdU5ETXpNek16TXpNek16TXpNek16TWpRc0xUQXVORFU1TWpVNU1qVTVNalU1TWpVNU1qWXNNQzR6TnpVc0xUQXVOVEV4TVRFeE1URXhNVEV4TVRFeE1Td3RNQzR3TlRBd01EQXdNREF3TURBd01EQXdORFJkWFN4YkltbHRZV2RsY3k5emNISnBkR1V0YzJobFpYUXdMbmRsWW5BaUxESTBOakk0TERFc01qVTNMREV6TVN3eE1UTXNkSEoxWlN3eExEQXVOU3d3TGpVek1EazNNelExTVRNeU56UXpNemNzVzEwc1d5MHdMalEyTVRnek1qQTJNVEEyT0Rjd01qTXNMVEF1TkRnMk56STFOall6TnpFMk9ERTBNaXd3TEMwd0xqVXlNakV5TXpnNU16Z3dOVE13T1Rnc01DNDBOVFF4T1RnME56TXlPREkwTkRJNExDMHdMalE0TmpjeU5UWTJNemN4TmpneE5ESXNNQzQwT0RRM016STRNalEwTWpjME9EQTVMREFzTUM0ME1qTTJOalF4TWpJeE16YzBNRFExTml3d0xqUTBNalEzTnpnM05qRXdOakU1TkRZc01Dd3dMalExTVRNeU56UXpNell5T0RNeE9EVXNMVEF1TkRNeE1qazNOekE1T1RJek5qWTBNU3d3TGpRME1qUTNOemczTmpFd05qRTVORFlzTFRBdU5EZzBOek15T0RJME5ESTNORGd3T1N3d1hWMHNXeUpwYldGblpYTXZjM0J5YVhSbExYTm9aV1YwTUM1M1pXSndJaXd5TkRZeU9Dd3hNamtzTVN3eE16VXNNVEl3TEhSeWRXVXNNU3d3TGpVeU5Ua3lOVGt5TlRreU5Ua3lOVGtzTUM0MU5ERTJOalkyTmpZMk5qWTJOalkyTEZ0ZExGc3RNQzQwT0RnNE9EZzRPRGc0T0RnNE9EZzVMQzB3TGpRNU9UazVPVGs1T1RrNU9UazVPVGswTEMwd0xqQXlOVGt5TlRreU5Ua3lOVGt5TlRrd09Dd3RNQzQxTXpNek16TXpNek16TXpNek16TXpMREF1TkRFME9ERTBPREUwT0RFME9ERTBPRFlzTFRBdU5EZ3pNek16TXpNek16TXpNek16TXl3d0xqUTFPVEkxT1RJMU9USTFPVEkxT1RJMkxDMHdMakEwTVRZMk5qWTJOalkyTmpZMk5qWXpMREF1TkRJeU1qSXlNakl5TWpJeU1qSXlNeXd3TGpRc0xUQXVNREkxT1RJMU9USTFPVEkxT1RJMU9UQTRMREF1TkRReE5qWTJOalkyTmpZMk5qWTJOalVzTFRBdU5EVTVNalU1TWpVNU1qVTVNalU1TWpZc01DNHpOelVzTFRBdU5URTROVEU0TlRFNE5URTROVEU0TlN3dE1DNHdOREUyTmpZMk5qWTJOalkyTmpZMk0xMWRMRnNpYVcxaFoyVnpMM053Y21sMFpTMXphR1ZsZERBdWQyVmljQ0lzTWpRMk1qZ3NNVEk1TERJMU55d3hNekVzTVRFekxIUnlkV1VzTVN3d0xqVXNNQzQxTWpZMU5EZzJOekkxTmpZek56RTNMRnRkTEZzdE1DNDBOakU0TXpJd05qRXdOamczTURJekxDMHdMalE0TWpNd01EZzRORGsxTlRjMU1qSTBMREFzTFRBdU5URTNOams1TVRFMU1EUTBNalEzT0N3d0xqUTFOREU1T0RRM016STRNalEwTWpnc0xUQXVORGd5TXpBd09EZzBPVFUxTnpVeU1qUXNNQzQwT0RRM016STRNalEwTWpjME9EQTVMREFzTUM0ME16RXlPVGMzTURrNU1qTTJOalF4TERBdU5EUTJPVEF5TmpVME9EWTNNalUyTlRVc01Dd3dMalExTlRjMU1qSXhNak00T1RNNE1EUTJMQzB3TGpRek1USTVOemN3T1RreU16WTJOREVzTUM0ME16Z3dOVE13T1Rjek5EVXhNekkyTlN3dE1DNDBPRFEzTXpJNE1qUTBNamMwT0RBNUxEQmRYU3hiSW1sdFlXZGxjeTl6Y0hKcGRHVXRjMmhsWlhRd0xuZGxZbkFpTERJME5qSTRMREkxTnl3eExERXpOU3d4TWpBc2RISjFaU3d4TERBdU5URTROVEU0TlRFNE5URTROVEU0TlN3d0xqVXlOU3hiWFN4YkxUQXVORGd4TkRneE5EZ3hORGd4TkRneE5EVXNMVEF1TkRnek16TXpNek16TXpNek16TXpNelFzTFRBdU1ERTROVEU0TlRFNE5URTROVEU0TkRrc0xUQXVOVEUyTmpZMk5qWTJOalkyTmpZMk55d3dMalF5TWpJeU1qSXlNakl5TWpJeU1qTXNMVEF1TkRZMk5qWTJOalkyTmpZMk5qWTJOeXd3TGpRMk5qWTJOalkyTmpZMk5qWTJOamNzTFRBdU1ESTFNREF3TURBd01EQXdNREF3TURJeUxEQXVOREk1TmpJNU5qSTVOakk1TmpJNU55d3dMalF4TmpZMk5qWTJOalkyTmpZMk5qWXpMQzB3TGpBeE9EVXhPRFV4T0RVeE9EVXhPRFE1TERBdU5EVTRNek16TXpNek16TXpNek16TWpZc0xUQXVORFU1TWpVNU1qVTVNalU1TWpVNU1qWXNNQzQwTEMwd0xqVXhNVEV4TVRFeE1URXhNVEV4TVRFc0xUQXVNREkxTURBd01EQXdNREF3TURBd01ESXlYVjBzV3lKcGJXRm5aWE12YzNCeWFYUmxMWE5vWldWME1DNTNaV0p3SWl3eU5EWXlPQ3d5TlRjc01qVTNMREV6TVN3eE1UTXNkSEoxWlN3eExEQXVOU3d3TGpVeU1qRXlNemc1TXpnd05UTXdPVGdzVzEwc1d5MHdMalEyTVRnek1qQTJNVEEyT0Rjd01qTXNMVEF1TkRjM09EYzJNVEEyTVRrME5qa3dNeXd3TEMwd0xqVXhNekkzTkRNek5qSTRNekU0TlRrc01DNDBOVFF4T1RnME56TXlPREkwTkRJNExDMHdMalEzTnpnM05qRXdOakU1TkRZNU1ETXNNQzQwT0RRM016STRNalEwTWpjME9EQTVMREFzTUM0ME16ZzVNekV5T1RjM01EazVNak0zTERBdU5EVXhNekkzTkRNek5qSTRNekU0TlN3d0xEQXVORFl3TVRjMk9Ua3hNVFV3TkRReU5Dd3RNQzQwTXpnNU16RXlPVGMzTURrNU1qTTNMREF1TkRReU5EYzNPRGMyTVRBMk1UazBOaXd0TUM0ME9EUTNNekk0TWpRME1qYzBPREE1TERCZFhTeGJJbWx0WVdkbGN5OXpjSEpwZEdVdGMyaGxaWFF3TG5kbFluQWlMREkwTmpJNExETTROU3d4TERFek5Td3hNakFzZEhKMVpTd3hMREF1TlRJMU9USTFPVEkxT1RJMU9USTFPU3d3TGpVeE5qWTJOalkyTmpZMk5qWTJOamNzVzEwc1d5MHdMalE0T0RnNE9EZzRPRGc0T0RnNE9Ea3NMVEF1TkRjMU1EQXdNREF3TURBd01EQXdNRE1zTFRBdU1ESTFPVEkxT1RJMU9USTFPVEkxT1RBNExDMHdMalV3T0RNek16TXpNek16TXpNek16UXNNQzQwTVRRNE1UUTRNVFE0TVRRNE1UUTROaXd0TUM0ME5UZ3pNek16TXpNek16TXpNek16Tnl3d0xqUTFPVEkxT1RJMU9USTFPVEkxT1RJMkxDMHdMakF4TmpZMk5qWTJOalkyTmpZMk5qY3lMREF1TkRJeU1qSXlNakl5TWpJeU1qSXlNeXd3TGpReU5EazVPVGs1T1RrNU9UazVPVGt6TEMwd0xqQXlOVGt5TlRreU5Ua3lOVGt5TlRrd09Dd3dMalEyTmpZMk5qWTJOalkyTmpZMk5qVTJMQzB3TGpRMk5qWTJOalkyTmpZMk5qWTJOamNzTUM0ME1EZ3pNek16TXpNek16TXpNek16TEMwd0xqVXhPRFV4T0RVeE9EVXhPRFV4T0RVc0xUQXVNREUyTmpZMk5qWTJOalkyTmpZMk56SmRYU3hiSW1sdFlXZGxjeTl6Y0hKcGRHVXRjMmhsWlhRd0xuZGxZbkFpTERJME5qSTRMRE00TlN3eU5UY3NNVE14TERFeE15eDBjblZsTERFc01DNDFMREF1TlRJeU1USXpPRGt6T0RBMU16QTVPQ3hiWFN4YkxUQXVORFl4T0RNeU1EWXhNRFk0TnpBeU15d3RNQzQwTnpjNE56WXhNRFl4T1RRMk9UQXpMREFzTFRBdU5URXpNamMwTXpNMk1qZ3pNVGcxT1N3d0xqUTFOREU1T0RRM016STRNalEwTWpnc0xUQXVORGMzT0RjMk1UQTJNVGswTmprd015d3dMalE0TkRjek1qZ3lORFF5TnpRNE1Ea3NNQ3d3TGpRek9Ea3pNVEk1Tnpjd09Ua3lNemNzTUM0ME5URXpNamMwTXpNMk1qZ3pNVGcxTERBc01DNDBOakF4TnpZNU9URXhOVEEwTkRJMExDMHdMalF6T0Rrek1USTVOemN3T1RreU16Y3NNQzQwTkRJME56YzROell4TURZeE9UUTJMQzB3TGpRNE5EY3pNamd5TkRReU56UTRNRGtzTUYxZFhWMWRMRnRkTEdaaGJITmxMR1poYkhObExEYzVNVFEzTmpjMU5EWTRNVGsxTWl4YlhTeHVkV3hzTERRMExHNTFiR3hkTEZzaVUzQnlhWFJsTVRBaUxERXdMR1poYkhObExGdGRMREVzTUN4dWRXeHNMRnRiSWtGdWFXMWhkR2x2YmlBeElpdzFMR1poYkhObExERXNNQ3htWVd4elpTd3lOVE0yT0RJeU1qRTFNVGd3TURnc1cxc2lhVzFoWjJWekwzTm9ZWEpsWkMwd0xYTm9aV1YwTUM1M1pXSndJaXd5TVRrNU9UTXNOVEV6TERFd01qVXNNalV3TERJMU1DeG1ZV3h6WlN3eExEQXVOU3d3TGpVc1cxMHNXMTFkWFYxZExGdGJJbEJvZVhOcFkzTWlMREV4TERZNU9UazVNVFk1TWpJNE5UQTROaXd4TTExZExHWmhiSE5sTEdaaGJITmxMRGcwTnpBNE5USTFNakUxTXprek5peGJYU3h1ZFd4c0xEUTFMRzUxYkd4ZExGc2lVM0J5YVhSbE15SXNNVEFzWm1Gc2MyVXNXMTBzTVN3d0xHNTFiR3dzVzFzaVFXNXBiV0YwYVc5dUlERWlMREFzWm1Gc2MyVXNNU3d3TEdaaGJITmxMRE0xTkRnd01UTTNNalE1TkRjd01DeGJXeUpwYldGblpYTXZjM0J5YVhSbE15MXphR1ZsZERBdWQyVmljQ0lzTVRFMU1qWXNNU3d4TERNekxEZ3lMR1poYkhObExERXNNQzQwT0RRNE5EZzBPRFE0TkRnME9EUTROaXd3TGpFNU5URXlNVGsxTVRJeE9UVXhNaklzVzEwc1d5MHdMakkyTnpjME16STNNVGc0TXprM05USXpMQzB3TGpFNE9UZ3dNamd3TnpNMU5qQTNOemNzTUM0eE1EQXdNVGt6Tnpjek9EUTBOVGsyTlN3dE1DNHhPRFkzT0RVeU5EUTROVFV4TURNM05Td3dMalV4TlRFMU1UVXhOVEUxTVRVeE5URXNNQzR3TnpVME16ZzJNRE15T1RReU5EYzBOU3d3TGpVeE5URTFNVFV4TlRFMU1UVXhOVEVzTUM0MU5UYzJNell4TWpVek9ETTBOREVzTFRBdU1ERTBOVE16T1RneU9Ea3lPVEkyTkN3d0xqVTFPREU1T0Rjd09UTXpORGczTmpRc0xUQXVNREUxTXpNd09UazBOVEk0TkRRMk5qWXlMREF1TVRreE16TTBOek15TWpjNE1EWTFNRElzTFRBdU1qYzNOakV4Tnprek16SXpNemMyT1RNc01DNHhPVEUyT1RJNE1EQTJPVFF6TURReU9GMWRMRnNpYVcxaFoyVnpMM053Y21sMFpUTXRjMmhsWlhRd0xuZGxZbkFpTERFeE5USTJMRE0yTERnMUxETXpMRGd3TEdaaGJITmxMREVzTUM0ME9EUTRORGcwT0RRNE5EZzBPRFE0Tml3d0xqRTROelVzVzEwc1d5MHdMakF3TXpjNE56a3pOalU0TmpNeU1qTXhOVGdzTFRBdU1UZzFPVE0zTlRBNE9UUXdOamsyTnpJc01DNHdOREl3TkRVMU5qUXpOakkwT1RZNE5EWXNMVEF1TVRnMk56RTROelUwTkRjd016UTRNellzTUM0d09EYzROemt3TmpVek1URXpNVFU1TlN3dE1DNHhPRGMxTERBdU5URTFNVFV4TlRFMU1UVXhOVEUxTVN3d0xqQTROelV3TURBME56WTRNemN4TlRnekxEQXVOVEUxTVRVeE5URTFNVFV4TlRFMU1Td3dMalUzTWpRNU9UazBNamMzT1RVME1EVXNMVEF1TURBNU1Ea3hNREF4TlRZNE5ERTROVGMzTERBdU5UY3lOVEF3TURNNE1UUTJPVGN5TXl3dE1DNHdNRFl3TmpBNU56VTVOekEyTkRNNU1qTXNNQzR4T1RjMU1EQXdNemd4TkRZNU56STJOVjFkTEZzaWFXMWhaMlZ6TDNOd2NtbDBaVE10YzJobFpYUXdMbmRsWW5BaUxERXhOVEkyTERNMkxERXNNek1zT0RJc1ptRnNjMlVzTVN3d0xqUTRORGcwT0RRNE5EZzBPRFE0TkRnMkxEQXVNVGd5T1RJMk9ESTVNalk0TWpreU5qZ3NXMTBzV3kwd0xqUTFORFUwTlRRMU5EVTBOVFExTkRZc01DNHdOek14TnpBM016RTNNRGN6TVRjd09Dd3RNQzR3TmpNMk16WTFORGcxT1RFek9ESTJPQ3d0TUM0eE9EQTBPRGMzT1RVMU56TTVNRGt4TERBdU1qYzROemczTnpnMk16RXdNelk1Tnl3dE1DNHhPREEwT0RjNE5ESXdPVFEyTURjME55d3dMakkzT0RjNE56YzROak14TURNMk9USTNMREF1TWpBME9EYzNPVGt5T1RVMU5qUTVOamdzTUM0d01USXhNakUwT0RrMU5UTTNOREEyTlN3d0xqSXdNREF3TURBeE9EWXdPREkzT1RJc01DNHdNVFV4TlRFMU1UVXhOVEUxTVRVd09ETXNNQzQxTmpBNU56VTNNREkzT1RjME9UUTBMQzB3TGpRMk5qWTJOamswTkRBNU9URTVOVEEzTERBdU5UWXdPVGMxTkRJek5qY3pNekEwWFYwc1d5SnBiV0ZuWlhNdmMzQnlhWFJsTXkxemFHVmxkREF1ZDJWaWNDSXNNVEUxTWpZc01UYzJMREV5T1N3ek1pdzRNQ3htWVd4elpTd3hMREF1TkRNM05Td3dMaklzVzEwc1d5MHdMalF6TnpVc01DNHdORGs1T1RrNU9UazVPVGs1T1RrNU9Td3RNQzR3TURZeU5EazVNRFEyTXpJMU5qZ3pOVGtzTFRBdU1pd3dMak0wT1RrNU9Ua3dORFl6TWpVMk9ETTJMQzB3TGpJc01DNHpOamczTlRBd09UVXpOamMwTXpFMk5Dd3dMakU0TWpVd01EQTNOakk1TXprME5EZzRMREF1TURjNE1USTBOell4TlRneE5ESXdPU3d3TGpFNE5UQXdNREF6T0RFME5qazNNalFzTUM0d056UTVPVGs0TURreU5qVXhNelkzTWl3d0xqVTFPVGs1T1RnME56UXhNakV3T1RVc0xUQXVORE0zTlN3d0xqVTJNalE1T1RrNU9UazVPVGs1T1RoZFhTeGJJbWx0WVdkbGN5OXpjSEpwZEdVekxYTm9aV1YwTUM1M1pXSndJaXd4TVRVeU5pdzNNU3d4TERNekxEZ3lMR1poYkhObExERXNNQzQyTURZd05qQTJNRFl3TmpBMk1EWXhMREF1T0RBME9EYzRNRFE0Tnpnd05EZzNPU3hiWFN4YkxUQXVOVGMxTnpVM05UYzFOelUzTlRjMU9Dd3RNQzQzT1RJMk9ESTVNalk0TWpreU5qZ3pMQzB3TGpFd05qQTJNRFl3TmpBMk1EWXdOakE0TEMwd0xqYzVNalk0TWpreU5qZ3lPVEkyT0RNc0xUQXVNRGM1TlRRMU5URXlNelF6T0RrNE5Td3RNQzR4T0RjME9UazVPRGd6TmprNE1qVXhPQ3d3TGpFNE1UZ3hPREU0TVRneE9ERTRNVFUxTEMwd0xqRTROVGszTlRZeU1UTTROakkzTWpJeUxEQXVNVGMwTWpReU16QTROalExTlRNMk55d3dMakU0TWpreU5qZzBNRGc1T0RRMk56RXNMVEF1TVRBMk1EWXdOakEyTURZd05qQTJNRGdzTUM0eE9ESTVNalk0TWpreU5qZ3lPVEkyTWl3dE1DNDFPVFEyT1RjeE5ETXdPVEl5T1RrNUxDMHdMakExTXpNMU16WTFPRFV6TmpVNE5USTFYVjBzV3lKcGJXRm5aWE12YzNCeWFYUmxNeTF6YUdWbGREQXVkMlZpY0NJc01URTFNallzTVRBMkxERXNNek1zT0RJc1ptRnNjMlVzTVN3d0xqUTFORFUwTlRRMU5EVTBOVFExTkRVekxEQXVPREEwT0RjNE1EUTROemd3TkRnM09TeGJYU3hiTUM0d01UVXhOVEV6T1RrMU5UUTJNamd6TlRNc0xUQXVPREEwT0RjNE1EUTROemd3TkRnM09Td3dMalUwTlRRMU5EVTBOVFExTkRVME5UUXNMVEF1T0RBME9EYzRNRFE0Tnpnd05EZzNPU3d3TGpVeU1qY3lOekUxTnpFek1ETTROaXd0TUM0d056TXhOekEzTkRreE5USTFOemc1TXl3d0xqQTBOVFExTkRVME5UUTFORFUwTlRRM0xEQXVNVGd5T1RJMk9ESTVNalk0TWpreU5qSXNMVEF1TWpZNE9UTTVNakl3TlRRME1EWXpOeXd3TGpFNE5EUTFNVEl3TnpnNE1qQXlNRFFzTFRBdU1qYzJOVEUxTXpneU56QTRPVEkxTVN3dE1DNHhPRGt3TWpRek9EUTBNamc0TVRVeUxEQXVNRE13TXpBeU9EVTJPVEEzTnpBd01EY3NMVEF1TVRrd05UUTROemd3TkRnM09EQTFNVjFkTEZzaWFXMWhaMlZ6TDNOd2NtbDBaVE10YzJobFpYUXdMbmRsWW5BaUxERXhOVEkyTERjeExEZzFMRE16TERnd0xHWmhiSE5sTERFc01DNDJNRFl3TmpBMk1EWXdOakEyTURZeExEQXVPREV5TlN4YlhTeGJMVEF1TmpBMk1EWXdOakEyTURZd05qQTJNU3d0TUM0NE1USTFMQzB3TGpFd05qQTJNRFl3TmpBMk1EWXdOakE0TEMwd0xqZ3hNalVzTFRBdU1EZzBPRFE0TlRjM016STFPVGswTXpnc0xUQXVNVGszTlRBd01ETTRNVFEyT1RjeU16Y3NNQzR4TnpVM05UYzJOamd5TXpVd09EVXhMQzB3TGpFNU5UQXdNREEzTmpJNU16azBOU3d3TGpFNE1UZ3hPREU0TVRneE9ERTRNVGc0TERBdU1UZzNOU3d0TUM0eE9UQTVNRGt4T0RNek9EWTJNREExTERBdU1UZzNOU3d0TUM0MU9UTTVNemsxTnpnNE9UUTBNVEk0TEMwd0xqQTNORGs1T1RrNU9UazVPVGs1T1RnMFhWMHNXeUpwYldGblpYTXZjM0J5YVhSbE15MXphR1ZsZERBdWQyVmljQ0lzTVRFMU1qWXNNakV3TERFeU9Td3pNaXc0TUN4bVlXeHpaU3d4TERBdU5ETTNOU3d3TGpneU5TeGJYU3hiTUM0d05ETTNORGs0TURreU5qVXhNelkzTWl3dE1DNHlNVEkwT1RrNU9UazVPVGs1T1RrNUxEQXVNRFl5TlN3dE1DNDRNalVzTUM0MU16RXlOU3d0TUM0NE1qVXNNQzQxTkRrNU9UazNNVE00T1RjM01EVXhMQzB3TGpBNE1qVXdNREEzTmpJNU16azBORGsyTERBdU1UTXhNalV3TXpneE5EWTVOekkyTlRZc01DNHhOelV3TURBd01EQXdNREF3TURBd05Dd3RNQzR5TlRZeU5EazVNRFEyTXpJMU5qZ3pOaXd3TGpFM05UQXdNREF3TURBd01EQXdNREEwTEMwd0xqSTJPRGMxTURFNU1EY3pORGcyTXpNc0xUQXVNakExTURBd01ERTVNRGN6TkRnMU5qUmRYU3hiSW1sdFlXZGxjeTl6Y0hKcGRHVXpMWE5vWldWME1DNTNaV0p3SWl3eE1UVXlOaXd4TkRFc01Td3pNeXc0TWl4bVlXeHpaU3d4TERBdU5EZzBPRFE0TkRnME9EUTRORGcwT0RZc01DNHhPVFV4TWpFNU5URXlNVGsxTVRJeUxGdGRMRnN0TUM0eU5qYzNORE15TnpFNE9ETTVOelV5TXl3dE1DNHhPRGs0TURJNE1EY3pOVFl3TnpjM0xEQXVNVEF3TURFNU16YzNNemcwTkRVNU5qVXNMVEF1TVRnMk56ZzFNalEwT0RVMU1UQXpOelVzTUM0MU1UVXhOVEUxTVRVeE5URTFNVFV4TERBdU1EYzFORE00TmpBek1qazBNalEzTkRVc01DNDFNVFV4TlRFMU1UVXhOVEUxTVRVeExEQXVOVFUzTmpNMk1USTFNemd6TkRReExDMHdMakF4TkRVek16azRNamc1TWpreU5qUXNNQzQxTlRneE9UZzNNRGt6TXpRNE56WTBMQzB3TGpBeE5UTXpNRGs1TkRVeU9EUTBOalkyTWl3d0xqRTVNVE16TkRjek1qSTNPREEyTlRBeUxDMHdMakkzTnpZeE1UYzVNek15TXpNM05qa3pMREF1TVRreE5qa3lPREF3TmprME16QTBNamhkWFN4YkltbHRZV2RsY3k5emNISnBkR1V6TFhOb1pXVjBNQzUzWldKd0lpd3hNVFV5Tml3eE1EWXNNVEk1TERNekxEZ3dMR1poYkhObExERXNNQzQwT0RRNE5EZzBPRFE0TkRnME9EUTROaXd3TGpFNE56VXNXMTBzV3kwd0xqQXdNemM0Tnprek5qVTROak15TWpNeE5UZ3NMVEF1TVRnMU9UTTNOVEE0T1RRd05qazJOeklzTUM0d05ESXdORFUxTmpRek5qSTBPVFk0TkRZc0xUQXVNVGcyTnpFNE56VTBORGN3TXpRNE16WXNNQzR3T0RjNE56a3dOalV6TVRFek1UVTVOU3d0TUM0eE9EYzFMREF1TlRFMU1UVXhOVEUxTVRVeE5URTFNU3d3TGpBNE56VXdNREEwTnpZNE16Y3hOVGd6TERBdU5URTFNVFV4TlRFMU1UVXhOVEUxTVN3d0xqVTNNalE1T1RrME1qYzNPVFUwTURVc0xUQXVNREE1TURreE1EQXhOVFk0TkRFNE5UYzNMREF1TlRjeU5UQXdNRE00TVRRMk9UY3lNeXd0TUM0d01EWXdOakE1TnpVNU56QTJORE01TWpNc01DNHhPVGMxTURBd016Z3hORFk1TnpJMk5WMWRMRnNpYVcxaFoyVnpMM053Y21sMFpUTXRjMmhsWlhRd0xuZGxZbkFpTERFeE5USTJMREUzTml3eExETXpMRGd5TEdaaGJITmxMREVzTUM0ME9EUTRORGcwT0RRNE5EZzBPRFE0Tml3d0xqRTRNamt5TmpneU9USTJPREk1TWpZNExGdGRMRnN0TUM0ME5UUTFORFUwTlRRMU5EVTBOVFEyTERBdU1EY3pNVGN3TnpNeE56QTNNekUzTURnc0xUQXVNRFl6TmpNMk5UUTROVGt4TXpneU5qZ3NMVEF1TVRnd05EZzNOemsxTlRjek9UQTVNU3d3TGpJM09EYzROemM0TmpNeE1ETTJPVGNzTFRBdU1UZ3dORGczT0RReU1EazBOakEzTkRjc01DNHlOemczT0RjM09EWXpNVEF6TmpreU55d3dMakl3TkRnM056azVNamsxTlRZME9UWTRMREF1TURFeU1USXhORGc1TlRVek56UXdOalVzTUM0eU1EQXdNREF3TVRnMk1EZ3lOemt5TERBdU1ERTFNVFV4TlRFMU1UVXhOVEUxTURnekxEQXVOVFl3T1RjMU56QXlOemszTkRrME5Dd3RNQzQwTmpZMk5qWTVORFF3T1RreE9UVXdOeXd3TGpVMk1EazNOVFF5TXpZM016TXdORjFkTEZzaWFXMWhaMlZ6TDNOd2NtbDBaVE10YzJobFpYUXdMbmRsWW5BaUxERXhOVEkyTERNMkxERTJOeXd6TWl3NE1DeG1ZV3h6WlN3eExEQXVORE0zTlN3d0xqSXNXMTBzV3kwd0xqUXpOelVzTUM0d05EazVPVGs1T1RrNU9UazVPVGs1T1N3dE1DNHdNRFl5TkRrNU1EUTJNekkxTmpnek5Ua3NMVEF1TWl3d0xqTTBPVGs1T1Rrd05EWXpNalUyT0RNMkxDMHdMaklzTUM0ek5qZzNOVEF3T1RVek5qYzBNekUyTkN3d0xqRTRNalV3TURBM05qSTVNemswTkRnNExEQXVNRGM0TVRJME56WXhOVGd4TkRJd09Td3dMakU0TlRBd01EQXpPREUwTmprM01qUXNNQzR3TnpRNU9UazRNRGt5TmpVeE16WTNNaXd3TGpVMU9UazVPVGcwTnpReE1qRXdPVFVzTFRBdU5ETTNOU3d3TGpVMk1qUTVPVGs1T1RrNU9UazVPVGhkWFN4YkltbHRZV2RsY3k5emNISnBkR1V6TFhOb1pXVjBNQzUzWldKd0lpd3hNVFV5Tml3eU1URXNNU3d6TXl3NE1peG1ZV3h6WlN3eExEQXVOakEyTURZd05qQTJNRFl3TmpBMk1Td3dMamd3TkRnM09EQTBPRGM0TURRNE56a3NXMTBzV3kwd0xqVTNOVGMxTnpVM05UYzFOelUzTlRnc0xUQXVOemt5TmpneU9USTJPREk1TWpZNE15d3RNQzR4TURZd05qQTJNRFl3TmpBMk1EWXdPQ3d0TUM0M09USTJPREk1TWpZNE1qa3lOamd6TEMwd0xqQTNPVFUwTlRVeE1qTTBNemc1T0RVc0xUQXVNVGczTkRrNU9UZzRNelk1T0RJMU1UZ3NNQzR4T0RFNE1UZ3hPREU0TVRneE9ERTFOU3d0TUM0eE9EVTVOelUyTWpFek9EWXlOekl5TWl3d0xqRTNOREkwTWpNd09EWTBOVFV6Tmpjc01DNHhPREk1TWpZNE5EQTRPVGcwTmpjeExDMHdMakV3TmpBMk1EWXdOakEyTURZd05qQTRMREF1TVRneU9USTJPREk1TWpZNE1qa3lOaklzTFRBdU5UazBOamszTVRRek1Ea3lNams1T1N3dE1DNHdOVE16TlRNMk5UZzFNelkxT0RVeU5WMWRMRnNpYVcxaFoyVnpMM053Y21sMFpUTXRjMmhsWlhRd0xuZGxZbkFpTERFeE5USTJMREVzTVRJNUxETXpMRGd5TEdaaGJITmxMREVzTUM0ME5UUTFORFUwTlRRMU5EVTBOVFExTXl3d0xqZ3dORGczT0RBME9EYzRNRFE0Tnprc1cxMHNXekF1TURFMU1UVXhNems1TlRVME5qSTRNelV6TEMwd0xqZ3dORGczT0RBME9EYzRNRFE0Tnprc01DNDFORFUwTlRRMU5EVTBOVFExTkRVMExDMHdMamd3TkRnM09EQTBPRGM0TURRNE56a3NNQzQxTWpJM01qY3hOVGN4TXpBek9EWXNMVEF1TURjek1UY3dOelE1TVRVeU5UYzRPVE1zTUM0d05EVTBOVFExTkRVME5UUTFORFUwTnl3d0xqRTRNamt5TmpneU9USTJPREk1TWpZeUxDMHdMakkyT0Rrek9USXlNRFUwTkRBMk16Y3NNQzR4T0RRME5URXlNRGM0T0RJd01qQTBMQzB3TGpJM05qVXhOVE00TWpjd09Ea3lOVEVzTFRBdU1UZzVNREkwTXpnME5ESTRPREUxTWl3d0xqQXpNRE13TWpnMU5qa3dOemN3TURBM0xDMHdMakU1TURVME9EYzRNRFE0Tnpnd05URmRYU3hiSW1sdFlXZGxjeTl6Y0hKcGRHVXpMWE5vWldWME1DNTNaV0p3SWl3eE1UVXlOaXd4TkRFc01USTVMRE16TERnd0xHWmhiSE5sTERFc01DNDJNRFl3TmpBMk1EWXdOakEyTURZeExEQXVPREV5TlN4YlhTeGJMVEF1TmpBMk1EWXdOakEyTURZd05qQTJNU3d0TUM0NE1USTFMQzB3TGpFd05qQTJNRFl3TmpBMk1EWXdOakE0TEMwd0xqZ3hNalVzTFRBdU1EZzBPRFE0TlRjM016STFPVGswTXpnc0xUQXVNVGszTlRBd01ETTRNVFEyT1RjeU16Y3NNQzR4TnpVM05UYzJOamd5TXpVd09EVXhMQzB3TGpFNU5UQXdNREEzTmpJNU16azBOU3d3TGpFNE1UZ3hPREU0TVRneE9ERTRNVGc0TERBdU1UZzNOU3d0TUM0eE9UQTVNRGt4T0RNek9EWTJNREExTERBdU1UZzNOU3d0TUM0MU9UTTVNemsxTnpnNE9UUTBNVEk0TEMwd0xqQTNORGs1T1RrNU9UazVPVGs1T1RnMFhWMHNXeUpwYldGblpYTXZjM0J5YVhSbE15MXphR1ZsZERBdWQyVmljQ0lzTVRFMU1qWXNOekFzTVRZM0xETXlMRGd3TEdaaGJITmxMREVzTUM0ME16YzFMREF1T0RJMUxGdGRMRnN3TGpBME16YzBPVGd3T1RJMk5URXpOamN5TEMwd0xqSXhNalE1T1RrNU9UazVPVGs1T1Rrc01DNHdOakkxTEMwd0xqZ3lOU3d3TGpVek1USTFMQzB3TGpneU5Td3dMalUwT1RrNU9UY3hNemc1Tnpjd05URXNMVEF1TURneU5UQXdNRGMyTWprek9UUTBPVFlzTUM0eE16RXlOVEF6T0RFME5qazNNalkxTml3d0xqRTNOVEF3TURBd01EQXdNREF3TURBMExDMHdMakkxTmpJME9Ua3dORFl6TWpVMk9ETTJMREF1TVRjMU1EQXdNREF3TURBd01EQXdNRFFzTFRBdU1qWTROelV3TVRrd056TTBPRFl6TXl3dE1DNHlNRFV3TURBd01Ua3dOek0wT0RVMk5GMWRYVjFkTEZ0YklsQm9lWE5wWTNNaUxERXhMRE0wTVRBMk56VXhOVGd4TkRJeE1pd3hNMTFkTEdaaGJITmxMR1poYkhObExEY3dOelV4TWpRek5qUTJPVEF3TVN4YlhTeHVkV3hzTERRMkxHNTFiR3hkTEZzaVUzQnlhWFJsTkNJc01UQXNabUZzYzJVc1cxMHNNU3d3TEc1MWJHd3NXMXNpUVc1cGJXRjBhVzl1SURFaUxEQXNabUZzYzJVc01Td3dMR1poYkhObExEazROekExT0RrMU16QTFOREF4TUN4Yld5SnBiV0ZuWlhNdmMyaGhjbVZrTFRBdGMyaGxaWFF4TG5kbFluQWlMRFl3TmpJeExERXpNeXd6T0RVc01qa3NPRE1zWm1Gc2MyVXNNU3d3TGpZMk5qWTJOalkyTmpZMk5qWTJOallzTUM0d01UZ3pORGcyTWpNNE5UTXlNVEV3TVN4Yld5SkpiV0ZuWlNCUWIybHVkQ0F4SWl3d0xqa3pPVE01TXprek9UTTVNemt6T1RRc01DNDVNRGd5TlRZNE9EQTNNek01TkRWZFhTeGJMVEF1TXpJMU56VTNOamt4TXpVME5EWXlOaXd0TUM0d01UZ3pORGcyTWpNNE5UTXlNVEV3TVN3d0xqTXpNek16TXpNek16TXpNek16TXpNM0xDMHdMakF4T0RNME9EWXlNemcxTXpJeE1UQXhMREF1TXpNek16TXpNek16TXpNek16TXpNemNzTUM0NU9ERTJOVEV6TnpZeE5EWTNPRGtzTFRBdU5EazJORFE0TlRjeE1ETXhOelF6T0N3d0xqazRNVFkxTVRNM05qRTBOamM0T1N3dE1DNDJOalkyTmpZMk5qWTJOalkyTmpZMkxEQXVPVE13TnpFME56UTNOVEF4TURjMU9Td3RNQzQyTmpZMk5qWTJOalkyTmpZMk5qWTJMREF1TnpjMU1Ua3pNekF4T1RBNU5UWXdNaXd0TUM0ek1UQTJNRFkwTURjek9UWTNNakV4TXl3d0xqYzNNelkzTmpNNU5qZzNORFEzTjExZExGc2lhVzFoWjJWekwzTm9ZWEpsWkMwd0xYTm9aV1YwTVM1M1pXSndJaXcyTURZeU1Td3pNakVzTXpnMUxESTVMRGd5TEdaaGJITmxMREVzTUM0ek1UQXpORFE0TWpjMU9EWXlNRFk1TERBdU1ERXlNVGsxTVRJeE9UVXhNakU1TlRFekxGdGJJa2x0WVdkbElGQnZhVzUwSURFaUxEQXVNRE0wTkRneU56VTROakl3TmpnNU5qVTFMREF1T1RBeU5ETTVNREkwTXprd01qUXpPVjFkTEZzdE1DNHpNVEF6TkRRNE1qYzFPRFl5TURZNUxDMHdMakF4TWpFNU5URXlNVGsxTVRJeE9UVXhNeXd3TGpNME9URXpPREV5T0RNME5qUXhNRFFzTFRBdU1ERXlNVGsxTVRJeE9UVXhNakU1TlRFekxEQXVNelEwT0RJM016ZzRPRGswT1RZNU1EWXNNQzQzT0RNMU16WTJOVFV4TkRZNU1ERXlMREF1TmpnNU5qVTFNVGN5TkRFek56a3pNU3d3TGpjNE5ESTVPRGN6TXprMk56RXdOamdzTUM0Mk9EazJOVFV4TnpJME1UTTNPVE14TERBdU9UTTRNall5TVRrMU1USXhPVFV4TlN3d0xqVXpPRGM1TXpBek56WTNOell6TXpFc01DNDVPRGM0TURRNE56Z3dORGczT0RBMUxDMHdMak14TURNME5EZ3lOelU0TmpJd05qa3NNQzQ1T0RjNE1EUTROemd3TkRnM09EQTFYVjBzV3lKcGJXRm5aWE12YzJoaGNtVmtMVEF0YzJobFpYUXhMbmRsWW5BaUxEWXdOakl4TERJNE9Td3pPRFVzTWprc09ETXNabUZzYzJVc01Td3dMalkyTmpZMk5qWTJOalkyTmpZMk5qWXNNQzR3TVRnek5EZzJNak00TlRNeU1URXdNU3hiV3lKSmJXRm5aU0JRYjJsdWRDQXhJaXd3TGprek9UTTVNemt6T1RNNU16a3pPVFFzTUM0NU1EZ3lOVFk0T0RBM016TTVORFZkWFN4YkxUQXVNekkxTnpVM05qa3hNelUwTkRZeU5pd3RNQzR3TVRnek5EZzJNak00TlRNeU1URXdNU3d3TGpNek16TXpNek16TXpNek16TXpNek0zTEMwd0xqQXhPRE0wT0RZeU16ZzFNekl4TVRBeExEQXVNek16TXpNek16TXpNek16TXpNek16Y3NNQzQ1T0RFMk5URXpOell4TkRZM09Ea3NMVEF1TkRrMk5EUTROVGN4TURNeE56UXpPQ3d3TGprNE1UWTFNVE0zTmpFME5qYzRPU3d0TUM0Mk5qWTJOalkyTmpZMk5qWTJOalkyTERBdU9UTXdOekUwTnpRM05UQXhNRGMxT1N3dE1DNDJOalkyTmpZMk5qWTJOalkyTmpZMkxEQXVOemMxTVRrek16QXhPVEE1TlRZd01pd3RNQzR6TVRBMk1EWTBNRGN6T1RZM01qRXhNeXd3TGpjM016WTNOak01TmpnM05EUTNOMTFkTEZzaWFXMWhaMlZ6TDNOb1lYSmxaQzB3TFhOb1pXVjBNUzUzWldKd0lpdzJNRFl5TVN3ME16QXNNemcxTERJNUxEZ3lMR1poYkhObExERXNNQzR6TVRBek5EUTRNamMxT0RZeU1EWTVMREF1TURFeU1UazFNVEl4T1RVeE1qRTVOVEV6TEZ0YklrbHRZV2RsSUZCdmFXNTBJREVpTERBdU1ETTBORGd5TnpVNE5qSXdOamc1TmpVMUxEQXVPVEF5TkRNNU1ESTBNemt3TWpRek9WMWRMRnN0TUM0ek1UQXpORFE0TWpjMU9EWXlNRFk1TEMwd0xqQXhNakU1TlRFeU1UazFNVEl4T1RVeE15d3dMak0wT1RFek9ERXlPRE0wTmpReE1EUXNMVEF1TURFeU1UazFNVEl4T1RVeE1qRTVOVEV6TERBdU16UTBPREkzTXpnNE9EazBPVFk1TURZc01DNDNPRE0xTXpZMk5UVXhORFk1TURFeUxEQXVOamc1TmpVMU1UY3lOREV6Tnprek1Td3dMamM0TkRJNU9EY3pNemsyTnpFd05qZ3NNQzQyT0RrMk5UVXhOekkwTVRNM09UTXhMREF1T1RNNE1qWXlNVGsxTVRJeE9UVXhOU3d3TGpVek9EYzVNekF6TnpZM056WXpNekVzTUM0NU9EYzRNRFE0Tnpnd05EZzNPREExTEMwd0xqTXhNRE0wTkRneU56VTROakl3Tmprc01DNDVPRGM0TURRNE56Z3dORGczT0RBMVhWMWRYVjBzVzFzaVVHaDVjMmxqY3lJc01URXNOek14TlRneE1UWTFOelUxTVRBd0xERXpYVjBzWm1Gc2MyVXNabUZzYzJVc05EQTJPRGMxTVRFek56RTFNakk0TEZ0ZExHNTFiR3dzTkRjc2JuVnNiRjBzV3lKVGNISnBkR1UxSWl3eE1DeG1ZV3h6WlN4YlhTd3hMREFzYm5Wc2JDeGJXeUpCYm1sdFlYUnBiMjRnTVNJc01DeG1ZV3h6WlN3eExEQXNabUZzYzJVc05UUXpOekEyTURZMk56STFNekE1TEZ0YkltbHRZV2RsY3k5emFHRnlaV1F0TUMxemFHVmxkREF1ZDJWaWNDSXNNakU1T1RrekxERXNNVEF5TlN3eE9EQXNNamd3TEdaaGJITmxMREVzTUM0ME9UTTFPRGszTkRNMU9EazNORE0yTERBdU9UZzRNVGc0T1RjMk16YzNPVFV5T0N4YlhTeGJNQzR4TXpBME9UY3dOak0wTlRjNU5UY3pMQzB3TGprNE5ESTFNVGsyT0RVd016a3pOeXd3TGpRNU1UY3lOelkzTWpReU5EUTBOellzTFRBdU9UZzBNalV4T1RZNE5UQXpPVE0zTERBdU5Ea3hOekkzTkRZeU1EUTFNRFk0TVN3dE1DNDVNek0wTmpBMU5UVXlNemcwTkRVeUxEQXVNVFl6TlRnMk9EazVOekE0TmpFMU5Td3RNQzQ1TXpRek1EY3dOemt4TVRVM09UTXlMQzB3TGpRd01UWTVOek16T0RNeE9EazVPRGsxTEMwd0xqVTVNVFEyTkRnNE9UUXhORFF5TURRc0xUQXVOREF4TmprM05UUTROams0TXpjNE15d3dMakF3TnpnM05EQXhOVGMwT0RBek1UUTRNaXd0TUM0ME9EY3hOemswT0RjeE56azBPRGN5TERBdU1EQTNPRGMwTURFMU56UTRNRE14TkRneUxDMHdMalE0TnpFM09UUTROekUzT1RRNE56SXNMVEF1TmpFMU1UWTNOVFUzT1Rnd01UWTNYVjBzV3lKcGJXRm5aWE12YzJoaGNtVmtMVEF0YzJobFpYUXdMbmRsWW5BaUxESXhPVGs1TXl3M05qa3NOVEV6TERFNE1Dd3pNVGtzWm1Gc2MyVXNNU3d3TGpRNU16VXdOalE1TXpVd05qUTVNelVzTVN4YlhTeGJNQzQxTURZME9UTTFNRFkwT1RNMU1EWTJMQzB3TGprME16VTNNelkxTlRjMU16TXdNREVzTUM0eE5qTTVOakE1TXprNE56YzVPVEkzTEMwd0xqazBNelUzTXpZM05qWTRNRE15TWpnc0xUQXVNems1TXpVd05qazRPRGt5TVRjeU15d3RNQzQyTURZMU9ETXdOREl5TURRMU5qWTRMQzB3TGpNNU9UTTFNRFkwT1RNMU1EWTBPVFFzTFRBdU1EQTBOekF5TVRFd05qUTVNamMyTXpreUxDMHdMalE0TURVeE9UUTRNRFV4T1RRNE1EVXNMVEF1TURBMk1qWTVOVGt5TkRjMk5EZzVNRFl4TEMwd0xqUTVNelV3TmpRNU16VXdOalE1TXpVc0xUQXVOakl6T0RJME5EZzNNamcxTlRVME15d3dMakUwTmpFd016azVOVEU0TmprME1Ua3NMVEVzTUM0MU1EWTBPVE0xTURZME9UTTFNRFkyTEMweFhWMHNXeUpwYldGblpYTXZjMmhoY21Wa0xUQXRjMmhsWlhRd0xuZGxZbkFpTERJeE9UazVNeXcxTnpjc01Td3hPREFzTXpnMExHWmhiSE5sTERFc01DNDBPVE0xTURZME9UTTFNRFkwT1RNMUxERXNXMTBzV3pBdU5UQTJORGt6TlRBMk5Ea3pOVEEyTml3dE1DNDVORFkyTVRRMU56TXpPVGt5TWpVNExEQXVNVGMxTXpJME56YzBOREEzTnpJeE1EUXNMVEF1T1RRMU16RXlORGt3TURZMU9Ea3lOU3d0TUM0ME1ESTFPVGMwTURJMU9UYzBNREkwTlN3dE1DNDJNREk0TmpRMU9EZ3pNREF6T0RZNUxDMHdMak00TXpFeE5qZzRNekV4TmpnNE15d3RNQzR3TURNNU1EWXhOREEzTWpRNE1UYzVPRFlzTFRBdU5EZ3dOVEU1TkRnd05URTVORGd3TlN3dE1DNHdNRFV5TURnek16TXpNek16TXpNek55d3RNQzQwT1RNMU1EWTBPVE0xTURZME9UTTFMQzB3TGpZeU1UQTVNemMxTERBdU1UTXpNVEUyTmpnME9UVXdOemt4TVRVc0xURXNNQzQxTURZME9UTTFNRFkwT1RNMU1EWTJMQzB4WFYwc1d5SnBiV0ZuWlhNdmMyaGhjbVZrTFRBdGMyaGxaWFF3TG5kbFluQWlMREl4T1RrNU15d3lOVGNzTVRBeU5Td3hPREFzTWpnd0xHWmhiSE5sTERFc01DNDBPVE0xTURZME9UTTFNRFkwT1RNMUxERXNXMTBzV3kwd0xqUTVNelV3TmpRNU16VXdOalE1TXpVc0xURXNMVEF1TVRJME56a3hORE14TURFNE56WTROaXd0TUM0NU9Ua3hORFkzTmpBNU16UXdOREl4TERBdU5EazFNekl3TXpJeU1UTTFPVFkwTml3dE1DNDJNekV6T1Rrek16QTBNalUxT0RjNExEQXVORGsxTXpJd016SXlNVE0xT1RZME5pd3RNQzR3TURZNE1qVTVNemcxTmpZMU5USTRPVEUyTERBdU5EQTROekk0TVRnMU9UZzNNek14TkRZc0xUQXVNREEyT0RJMU9UWTBOakExTkRReU1qY3NNQzQwTURnM01qZ3dNVFUwT1Rnd05qY3hMQzB3TGpZd01qTTRPVEF4T1RreE1EYzVNeklzTFRBdU1UWXhNVEEwTWpFMk1qUTNNekEyTURNc0xUQXVPVFF6TmpnMk1EQTJPREkxT1RNNE5Td3RNQzQwT1RNMU1EWTBPVE0xTURZME9UTTFMQzB3TGprME5qSTBOVGN6TXpjNE9ETTVOVGxkWFN4YkltbHRZV2RsY3k5emFHRnlaV1F0TUMxemFHVmxkREF1ZDJWaWNDSXNNakU1T1RrekxEYzJPU3d4TURJMUxERTRNQ3d6TVRrc1ptRnNjMlVzTVN3d0xqUTVNelV3TmpRNU16VXdOalE1TXpVc01TeGJYU3hiTFRBdU5Ea3pOVEEyTkRrek5UQTJORGt6TlN3dE1Td3RNQzR4TWpBeE1qazVNVGsyTnpFek9UTXhOQ3d0TVN3d0xqUTVNelV3TmpZNU1UWTNNalU0TlRJMkxDMHdMall5TXpneU5EUXlOelE1TkRBMk1Td3dMalE1TXpVd05qUTVNelV3TmpRNU16VXNMVEF1TURBMk1qWTVOVGt5TkRjMk5EZzVNRFl4TERBdU5EQXlOVGszTXpBek5URTBNelUyT1N3dE1DNHdNRGM0TXpjd016ZzBNamc0TURVM09EY3NNQzQwTVRJek16YzBOalF4TnpFMU56QTBMQzB3TGpZd05qVTRNekV3TVRrNU5qQTJNREVzTFRBdU1UWXlNek0zTnpZeE5ESXdOekE0TWpJc0xUQXVPVFF3TkRNNE9UQTNNelE0TWpVd01Td3RNQzQwT1RNMU1EWTBPVE0xTURZME9UTTFMQzB3TGprME1qYzRPVGs0TmpVNE9UUTROVFZkWFN4YkltbHRZV2RsY3k5emFHRnlaV1F0TUMxemFHVmxkREF1ZDJWaWNDSXNNakU1T1RrekxEYzJPU3d4TERFNE1Dd3pPRFFzWm1Gc2MyVXNNU3d3TGpRNU16VXdOalE1TXpVd05qUTVNelVzTVN4YlhTeGJMVEF1TkRrek5UQTJORGt6TlRBMk5Ea3pOU3d0TVN3dE1DNHhNams0TnpBd016QTNPRGN3T0RReUxDMHhMREF1TkRrMk56VXpNVFEzTmpjd01qQXhMQzB3TGpZeU1qTTVOVGd4TXpRMk5URXhPRFFzTUM0ME9UTTFNRFkwT1RNMU1EWTBPVE0xTEMwd0xqQXdOVEl3T0RNek16TXpNek16TXpNM0xEQXVOREExT0RRME1qVTBPVEkzTWpBeE5Dd3RNQzR3TURVeU1EZ3pORE15TmpjME5EQTNPVFlzTUM0ME1UZzRNekV4TVRreU9EazJORFU1TlN3dE1DNDJNVE15T0RFek9UUXdORFExTlRneExDMHdMakUxTlRnME5ETTFOREF4TURJME56WXNMVEF1T1RRME1ERXdOREl4TmpNek56SXdOQ3d0TUM0ME9UTTFNRFkwT1RNMU1EWTBPVE0xTEMwd0xqazBOVE14TWpRNE56VTRNak0yTlRkZFhWMWRYU3hiV3lKUWFIbHphV056SWl3eE1Td3pOak0wTnpBMU5Ea3dORFV3T0RZc01UTmRYU3htWVd4elpTeG1ZV3h6WlN3eE9UQTJNVE00TmpZMU9EWTBPRGNzVzEwc2JuVnNiQ3cwT0N4dWRXeHNYU3hiSWxOd2NtbDBaVFlpTERFd0xHWmhiSE5sTEZ0ZExEQXNNQ3h1ZFd4c0xGdGJJa0Z1YVcxaGRHbHZiaUF4SWl3d0xHWmhiSE5sTERFc01DeG1ZV3h6WlN3eE9EVXhNamN5TXpNMk9Ea3pOaklzVzFzaWFXMWhaMlZ6TDNOd2NtbDBaVFl0YzJobFpYUXdMbmRsWW5BaUxESXhNVGs1TVN3MU1UTXNNVFV6Tnl3ME1URXNNemMwTEhSeWRXVXNNU3d3TGpVM01UYzNOakUxTlRjeE56YzJNVFVzTUM0ME5UY3lNVGt5TlRFek16WTRPVGcwTEZ0ZExGc3RNQzQwT1RFNU5qQTJNalV4TVRnd05ETTNMQzB3TGpReU1UQTFOakF6TVRJeE16STFPRGsyTEMwd0xqQXhNVFE1TmpFNU1UazJNRFkyTkRrNE1Td3RNQzQwTlRRMU5EVTBOVFExTkRVME5UUTFNeXd3TGpReE16TTNOek14TlRBME5qSTNNeklzTFRBdU16WXdPRGMwTWpZNU9USXdOek0wTXl3d0xqUXlPREl5TXpnME5ESTRNakl6T0RVc01DNHlOall3TVRrd056WTROell6T1RnMExEQXVNekF5TVRrMU5EWXlOelExTXpreU1pd3dMalUwTURFd05qazFNVGczTVRZMU56Y3NMVEF1TURFeE5EazJNVGt4T1RZd05qWTBPVGd4TERBdU5UUXdNVEEyT1RVeE9EY3hOalUzTnl3dE1DNHpPRGczTWpBek16TTJPVFUzT1Rjd05pd3dMalUwTURFd05qazFNVGczTVRZMU56Y3NMVEF1TkRJNE5ESTRNVE00TURnNE9UWTRPRFVzTUM0eU5qWXdNVGt3TnpZNE56WXpPVGcwWFYwc1d5SnBiV0ZuWlhNdmMzQnlhWFJsTmkxemFHVmxkREF1ZDJWaWNDSXNNakV4T1RreExEVXhNeXd4TURJMUxEUTJPQ3d6TWprc2RISjFaU3d4TERBdU5UYzJPVEl6TURjMk9USXpNRGMyT1N3d0xqVXdOelU1T0RjNE5ERTVORFV5T0Rrc1cxMHNXeTB3TGpRMU5ESTBOekExTXpJd09EWTFNak1zTFRBdU1qazVOamt6TWpNNU9ERXdNekEzT0N3d0xqQTJOVE0wTkRFMk9UY3dNakF6TXpJM0xDMHdMak00TlRrMU1qWXlNVEUyTURNM05Td3dMalF5TXpBM05qa3lNekEzTmpreU16RXpMQzB3TGpJd01qWTFNVFF6TlRjNU1UUTRNaklzTUM0ME1qTXdOelk1TWpNd056WTVNak14TXl3d0xqTTJNelF5TlRjMU5ETXhPRE16TXpjc01DNDBNRFkxTmpneU5UWXpPRGsyTkRjNExEQXVORGt5TkRBeE1qRTFPREExTkRjeE1UUXNNQzR3TmpVek5EUXhOamszTURJd016TXlOeXd3TGpRNU1qUXdNVEl4TlRnd05UUTNNVEUwTEMwd0xqTXdOamt3TURJNE9EVXdNall6Tnl3d0xqUTVNalF3TVRJeE5UZ3dOVFEzTVRFMExDMHdMak15TWpReE1EUTNOREkyTVRFMk5EZzNMREF1TXpZek5ESTFOelUwTXpFNE16TXpOMTFkTEZzaWFXMWhaMlZ6TDNOd2NtbDBaVFl0YzJobFpYUXdMbmRsWW5BaUxESXhNVGs1TVN3eExERXNOVGN3TERNeU5TeDBjblZsTERFc01DNDFNams0TWpRMU5qRTBNRE0xTURnNExEQXVORFF6TURjMk9USXpNRGMyT1RJek1TeGJYU3hiTFRBdU5ETTFNamt5TXpBMk9EWTJNREU1TEMwd0xqRXdOalF5TXpNek5EazJORFUwTXpJMkxEQXVNVGN6TmpreE5qQXpOemt4TkRJMk1qTXNMVEF1TXpZMk56Z3lNVEl3T0RnMU16WTRORE1zTUM0ME56QXhOelUwTXpnMU9UWTBPVEV5TlN3dE1DNHlNelkyTURJM01qYzVNalE1TlRVNE5Td3dMalEzTURFM05UUXpPRFU1TmpRNU1USTFMREF1TlRVMk9USXpNRGMyT1RJek1EYzJPU3d3TGpRM01ERTNOVFF6T0RVNU5qUTVNVEkxTERBdU5UVTJPVEl6TURjMk9USXpNRGMyT1N3d0xqRTNNelk1TVRZd016YzVNVFF5TmpJekxEQXVOVFUyT1RJek1EYzJPVEl6TURjMk9Td3RNQzQxTWprNE1qUTFOakUwTURNMU1EZzRMREF1TlRVMk9USXpNRGMyT1RJek1EYzJPU3d0TUM0MU1qazRNalExTmpFME1ETTFNRGc0TERBdU5UVTJPVEl6TURjMk9USXpNRGMyT1YxZExGc2lhVzFoWjJWekwzTndjbWwwWlRZdGMyaGxaWFF3TG5kbFluQWlMREl4TVRrNU1TdzFNVE1zTVN3Mk1EZ3NNekF4TEhSeWRXVXNNU3d3TGpVek56Z3lPRGswTnpNMk9EUXlNU3d3TGpVME5EZzFNRFE1T0RNek9EZzNNRFFzVzEwc1d5MHdMalEyT1Rjek1UVTBNVFV3TURjNE1UY3NMVEF1TWpVeU16a3pPRFkxTWpVd09URTJNelFzTFRBdU1EZ3dNelV6TVRVd01URTNNelk0T0RJc0xUQXVORFU0TURFMU16VTBPVGN5TVRrek1UUXNNQzR5TnpBMU5qZ3hNVFl4T1RFeE16a3hMQzB3TGpFMk56Y3lOakU1TXpBeE1qYzBNelkyTERBdU5ESTVNakF6TnpVM01USTFNVEl5TVRVc01DNHhOekE1TkRRME9UVTVNems1TkRjME15d3dMakk0T1RjNU5qWTNPRGN5T0RVNU1UY3NNQzQwTlRVeE5EazFNREUyTmpFeE1qazFOU3d0TUM0d09EQXpOVE14TlRBeE1UY3pOamc0TWl3d0xqUTFOVEUwT1RVd01UWTJNVEV5T1RVMUxDMHdMalV6TnpneU9EazBOek0yT0RReU1Td3dMalExTlRFME9UVXdNVFkyTVRFeU9UVTFMQzB3TGpNNU1qZ3hOekk1TVRNMU1EazNNVGMyTERBdU1UY3dPVFEwTkRrMU9UTTVPVFEzTkROZFhTeGJJbWx0WVdkbGN5OXpjSEpwZEdVMkxYTm9aV1YwTUM1M1pXSndJaXd5TVRFNU9URXNNalUzTERFMU16Y3NNelUyTERFNU9DeDBjblZsTERFc01DNDFNRFUyTVRjNU56YzFNamd3T0RrNUxEQXVNamd5T0RJNE1qZ3lPREk0TWpneU9DeGJYU3hiTFRBdU16VTFOakkyTURrd01UTXhNREU0TlRRc0xUQXVNRE15TVRBd05qWTNOamt6T0RnNE1ETXNMVEF1TURBMU5qRTNPVGMzTlRJNE1EZzVPVEF4TEMwd0xqQXlNREV4TmpReE9EUXlNVFV3TXpFek5Td3dMalF5TXpNMk5qTXlORFU0TlRJME16STJMQzB3TGpFMk9Ua3hPVFV6TkRNeU5qTXhNemsyTERBdU16RTFOamN4TlRJd056QTNOREU0T1N3d0xqSTFNalV5TlRJMU1qVXlOVEkxTWpVMExEQXVNekV5TURneE5qa3pPVEV4TkRreE5UUXNNQzQwT0RNeU1qSXdOVEV3TVRnMk5qRXpMQzB3TGpBd05UWXhOemszTnpVeU9EQTRPVGt3TVN3d0xqTTVPVE16TWpNd05qRXhNVGsyTnpJc0xUQXVNamN6TURZd01EY3pPREkwTmpnMk5qY3NNQzR6T1RNek5EQXhPREUwTnpVM056UTJMQzB3TGpNeE1qVTBPREUyT0RVM09UZzRPRGtzTUM0eU5USTFNalV5TlRJMU1qVXlOVEkxTkYxZExGc2lhVzFoWjJWekwzTndjbWwwWlRZdGMyaGxaWFF3TG5kbFluQWlMREl4TVRrNU1Td3hMREV3TWpVc05UUTFMREl5TWl4MGNuVmxMREVzTUM0ME9UY3lORGMzTURZME1qSXdNVGcwTERBdU1qazNNamszTWprM01qazNNamszTXl4YlhTeGJMVEF1TXpZek16QXlOelV5TWprek5UYzRMREF1TURNeE5UTXhOVE14TlRNeE5UTXhOVFFzTUM0d01ESTNOVEl5T1RNMU56YzVPREUyTWpNNExDMHdMakkzTkRjM05EYzNORGMzTkRjM05EZ3NNQzR6T0RNME9EWXlNemcxTXpJeE1UQXhMQzB3TGpBd09UQXdPVEF3T1RBd09UQXdPVEF5T0N3d0xqTTVNRGd5TlRZNE9EQTNNek01TkRVc01DNHlNREkzTURJM01ESTNNREkzTURJM0xEQXVNemN3TmpReU1qQXhPRE0wT0RZeU16VXNNQzR6Tnpnek56Z3pOemd6Tnpnek56Z3pOQ3d3TGpBd01qYzFNakk1TXpVM056azRNVFl5TXpnc01DNDBPREU1T0RFNU9ERTVPREU1T0RJc0xUQXVNelV3TkRVNE56RTFOVGsyTXpNd015d3dMak16Tnpnek56Z3pOemd6Tnpnek56Z3NMVEF1TXpVNU5qTXpNREkzTlRJeU9UTTFPQ3d3TGpJd01qY3dNamN3TWpjd01qY3dNamRkWFN4YkltbHRZV2RsY3k5emNISnBkR1UyTFhOb1pXVjBNUzUzWldKd0lpdzNORFF5TERFNU15d3hMRFV5TERFeE1DeG1ZV3h6WlN3eExEQXVOVEU1TWpNd056WTVNak13TnpZNU15d3dMaklzVzEwc1d5MHdMalEyTVRVek9EUTJNVFV6T0RRMk1UVTJMQzB3TGpFeU56STNNamN5TnpJM01qY3lOek1zTUM0d01qZzRORFl4TlRNNE5EWXhOVE00TlRVc0xUQXVNVFl6TmpNMk16WXpOak0yTXpZek5qUXNNQzQwTURNNE5EWXhOVE00TkRZeE5UTTROU3d0TUM0d09ERTRNVGd4T0RFNE1UZ3hPREU0TXl3d0xqTTJOVE00TkRZeE5UTTRORFl4TlRNc01DNDBOekkzTWpjeU56STNNamN5TnpJM0xDMHdMakV6TkRZeE5UTTRORFl4TlRNNE5EWTBMREF1TnpZek5qTTJNell6TmpNMk16WXpOeXd3TGpBeU9EZzBOakUxTXpnME5qRTFNemcxTlN3d0xqYzFORFUwTlRRMU5EVTBOVFExTkRZc01DNHlOU3d3TGpjeU56STNNamN5TnpJM01qY3lOek1zTFRBdU1qRXhOVE00TkRZeE5UTTRORFl4TlRZc01DNDBOekkzTWpjeU56STNNamN5TnpJM1hWMHNXeUpwYldGblpYTXZjM0J5YVhSbE5pMXphR1ZsZERFdWQyVmljQ0lzTnpRME1pd3hMREVzT0Rnc01URXpMR1poYkhObExERXNNQzQxTERBdU1qQXpOVE01T0RJek1EQTRPRFE1TlRjc1cxMHNXeTB3TGpNME1Ea3dPVEE1TURrd09UQTVNRGswTEMwd0xqQTNNRGM1TmpRMk1ERTNOams1TVRFMUxEQXVNRE01TnpjeU56STNNamN5TnpJM01qa3NMVEF1TVRnMU9EUXdOekEzT1RZME5qQXhOemdzTUM0ek56VXNMVEF1TURRME1qUTNOemczTmpFd05qRTVORGdzTUM0d05UWTRNVGd4T0RFNE1UZ3hPREU0T0N3d0xqUTJNREUzTmprNU1URTFNRFEwTWpVc01DNHhNVE0yTXpZek5qTTJNell6TmpNMk5Td3dMamMxTWpJeE1qTTRPVE00TURVek1URXNNQzR3TXprM056STNNamN5TnpJM01qY3lPU3d3TGpjMk1UQTJNVGswTmprd01qWTFORGdzTFRBdU1EVTJPREU0TVRneE9ERTRNVGd4T0RJc01DNDNOakV3TmpFNU5EWTVNREkyTlRRNExDMHdMalF6TVRneE9ERTRNVGd4T0RFNE1UZ3NNQzQwTmpBeE56WTVPVEV4TlRBME5ESTFYVjBzV3lKcGJXRm5aWE12YzNCeWFYUmxOaTF6YUdWbGRERXVkMlZpY0NJc056UTBNaXc1TVN3eExEZ3pMREV4TVN4bVlXeHpaU3d4TERBdU5UQTJNREkwTURrMk16ZzFOVFF5TVN3d0xqSXlOVEl5TlRJeU5USXlOVEl5TlRJekxGdGRMRnN0TUM0ek16Y3pORGt6T1RjMU9UQXpOakUwTEMwd0xqQTVPVEE1T1RBNU9UQTVPVEE1T1RFeExEQXVNRE13TVRJd05EZ3hPVEkzTnpFd09EZzFMQzB3TGpJeE5qSXhOakl4TmpJeE5qSXhOakl6TERBdU16WXhORFExTnpnek1UTXlOVE13TWl3dE1DNHdPREV3T0RFd09ERXdPREV3T0RFd09Td3dMalEyT1RnM09UVXhPREEzTWpJNE9USXNNQzQwTkRFME5ERTBOREUwTkRFME5ERTBMREF1TURnME16TTNNelE1TXprM05Ua3dOREVzTUM0M05EYzNORGMzTkRjM05EYzNORGM0TERBdU1ETXdNVEl3TkRneE9USTNOekV3T0RnMUxEQXVOelEzTnpRM056UTNOelEzTnpRM09Dd3RNQzR3TXpZeE5EUTFOemd6TVRNeU5USTVOaXd3TGpjME56YzBOemMwTnpjME56YzBOemdzTFRBdU16UTVNemszTlRrd016WXhORFExTnpRc01DNDBOREUwTkRFME5ERTBOREUwTkRFMFhWMWRYVjBzVzEwc1ptRnNjMlVzWm1Gc2MyVXNNVFUxTXpjNU9UY3lNVEEyTXpZNUxGdGRMRzUxYkd3c05Ea3NiblZzYkYwc1d5SlRjSEpwZEdVNUlpd3hNQ3htWVd4elpTeGJYU3d5TERBc2JuVnNiQ3hiV3lKQmJtbHRZWFJwYjI0Z01TSXNOU3htWVd4elpTd3hMREFzWm1Gc2MyVXNNekl5TmpnNE1UazVPVEUwTURJNUxGdGJJbWx0WVdkbGN5OXphR0Z5WldRdE1DMXphR1ZsZERFdWQyVmljQ0lzTmpBMk1qRXNOekFzTkRRNUxEWXhMRFl4TEdaaGJITmxMREVzTUM0MUxEQXVOU3hiWFN4YkxUQXVNelV5TkRVNU1ERTJNemt6TkRReU5pd3RNQzR6TlRJME5Ua3dNVFl6T1RNME5ESTJMREFzTFRBdU5Td3dMak16TmpBMk5UVTNNemMzTURRNU1UZzBMQzB3TGpNMU1qUTFPVEF4TmpNNU16UTBNallzTUM0ME9ETTJNRFkxTlRjek56Y3dORGt4Tml3d0xEQXVNek0yTURZMU5UY3pOemN3TkRreE9EUXNNQzR6TXpZd05qVTFOek0zTnpBME9URTROQ3d3TERBdU5EZ3pOakEyTlRVM016YzNNRFE1TVRZc0xUQXVNelV5TkRVNU1ERTJNemt6TkRReU5pd3dMak16TmpBMk5UVTNNemMzTURRNU1UZzBMQzB3TGpVc01GMWRYVjFkTEZ0YklrUnlZV2RFY205d0lpd3hOeXcwTWpjd016TTNNVGMwTWpJME5UY3NOVEJkTEZzaVVHaDVjMmxqY3lJc01URXNOekl4TlRrNU16azFORFUzTXpnM0xERXpYVjBzWm1Gc2MyVXNabUZzYzJVc05UQTVNemMzT1RrNU1qSTJNakV6TEZ0ZExHNTFiR3dzTlRFc2JuVnNiRjBzV3lKWllXNWtaWGhUUkVzaUxERTRMR1poYkhObExGdGRMREFzTUN4dWRXeHNMRzUxYkd3c1cxMHNabUZzYzJVc1ptRnNjMlVzTVRFNE1qSTNPREV6T1RVeE5EZzRMRnRkTEc1MWJHd3NOVElzYm5Wc2JDeGJkSEoxWlN3eUxIUnlkV1VzTUN4bVlXeHpaVjFkTEZzaVUzQnlhWFJsTWlJc01UQXNabUZzYzJVc1cxMHNNQ3d3TEc1MWJHd3NXMXNpUVc1cGJXRjBhVzl1SURFaUxEQXNabUZzYzJVc01Td3dMR1poYkhObExEYzRPRGczT0RrME9UVTVOREUwTUN4Yld5SnBiV0ZuWlhNdmMyaGhjbVZrTFRBdGMyaGxaWFF4TG5kbFluQWlMRFl3TmpJeExERTNOU3d4TERFek1pdzROeXgwY25WbExERXNNQzQxTERBdU5TeGJYU3hiWFYxZFhWMHNXMTBzWm1Gc2MyVXNabUZzYzJVc016azVNREEwT0RRek16VTBOelkxTEZ0ZExHNTFiR3dzTlRNc2JuVnNiRjBzV3lKVGNISnBkR1UzSWl3eE1DeG1ZV3h6WlN4YlhTd3dMREFzYm5Wc2JDeGJXeUpCYm1sdFlYUnBiMjRnTVNJc01DeG1ZV3h6WlN3eExEQXNabUZzYzJVc016azVPVEl4T0RZek1EZ3pOak15TEZ0YkltbHRZV2RsY3k5emFHRnlaV1F0TUMxemFHVmxkREV1ZDJWaWNDSXNOakEyTWpFc01Td3hMREUzTml3NE5TeDBjblZsTERFc01DNDFMREF1TlN4YlhTeGJYVjBzV3lKcGJXRm5aWE12YzJoaGNtVmtMVEF0YzJobFpYUXhMbmRsWW5BaUxEWXdOakl4TERnNExERXNNVGMyTERnMUxIUnlkV1VzTVN3d0xqVXNNQzQxTEZ0ZExGdGRYVjFkWFN4YlhTeG1ZV3h6WlN4bVlXeHpaU3cxT0RjeE5EVXpNRGN6TVRnNE56UXNXMTBzYm5Wc2JDdzFOQ3h1ZFd4c1hTeGJJblJ2Y0NJc01UQXNabUZzYzJVc1cxMHNNU3d3TEc1MWJHd3NXMXNpUVc1cGJXRjBhVzl1SURFaUxEQXNabUZzYzJVc01Td3dMR1poYkhObExEZ3pNREUxTkRJMU56ZzNNemN3TlN4Yld5SnBiV0ZuWlhNdmMyaGhjbVZrTFRBdGMyaGxaWFF4TG5kbFluQWlMRFl3TmpJeExESTJOQ3d4TERFek1pdzROeXgwY25WbExERXNNQzQxTERBdU5TeGJYU3hiWFYxZFhWMHNXMXNpVTJsdVpTSXNNVFVzTlRVNU1qWXhNVE0wT0RFNE9EUXlMRE13WFYwc1ptRnNjMlVzWm1Gc2MyVXNORGt4TkRreU5Ea3lNelUzTlRJeExGdGRMRzUxYkd3c05UVXNiblZzYkYwc1d5Sm5iR0Z6Y3pVaUxEa3NabUZzYzJVc1cxc3hNemd4TmprME1EVTNOelUyTXpJc01pd2lkR0ZuSWl3MU5sMWRMREVzTUN4YkltbHRZV2RsY3k5bmJHRnpjelV0YzJobFpYUXdMbmRsWW5BaUxEa3hPU3d3TERBc01UVXdMREUxTUN4bVlXeHpaVjBzYm5Wc2JDeGJXeUpRYUhsemFXTnpJaXd4TVN3eE56azVNelV5T1RVMk1UWXdOVFlzTVROZFhTeG1ZV3h6WlN4bVlXeHpaU3czTURReU1EY3hOek16TnpneE5qWXNXMTBzYm5Wc2JDdzFOeXhiTVN3eFhWMHNXeUpFY21GM2FXNW5RMkZ1ZG1Geklpd3hPU3htWVd4elpTeGJXek0xTnprd09UTTRPVFkwTURZeE9Td3lMQ0owWVdjaUxEVTJYU3hiT1RZMU1qZzRNREkwTnpFMU5qQTJMREVzSW5Cc1lYbGxjaUlzTWpoZFhTd3dMREFzYm5Wc2JDeHVkV3hzTEZ0ZExHWmhiSE5sTEdaaGJITmxMRFkyTlRFNE5EWXhOakk0TlRnd09DeGJYU3h1ZFd4c0xEVTRMRzUxYkd4ZFhTeGJYU3hiV3lKbllXMWxJaXd4TWpnd0xEY3lNQ3gwY25WbExHWmhiSE5sTERBdU5Td3dMalVzSWtWV1JVNVVJR2RoYldVaUxEazRPVFV3TmpJeU1USXlOemt4TVN4Yld5SmlZV05yWjNKdmRXNWtJaXd3TERnMU16azRNVFl6TkRNek5EZzVOeXgwY25WbExGczVOQ3c1TkN3NU5GMHNabUZzYzJVc01Dd3dMREVzWm1Gc2MyVXNabUZzYzJVc01Dd3dMSFJ5ZFdVc1cxdGJMVGtzTFRFeExEQXNNVE13TWl3M05EUXNNQ3d3TEZzeExERXNNU3d4WFN3d0xEQXNNQ3d3TEZ0ZExHNTFiR3dzYm5Wc2JDeHVkV3hzTEZzaUlpd2lJbDFkTERFeExEZzNMRnRkTEZ0Yk1Dd3dMREVzTVN4MGNuVmxYVjBzVzNSeWRXVXNNQ3d4TERFc01Dd3dMREVzTVN3d0xHWmhiSE5sTERFc01Td3hMREF1TVN3d0xqRmRYU3hiV3kweUxDMHpMREFzTVRJNE9TdzNNVGNzTUN3d0xGc3hMREVzTVN3eFhTd3dMREFzTUN3d0xGdGRMRzUxYkd3c2JuVnNiQ3h1ZFd4c0xGc2lJaXdpSWwxZExERXdMRFk1TEZ0ZExGdGJNQ3d3TERFc01TeDBjblZsWFYwc1czUnlkV1VzTUN3eExERXNNQ3d3TERFc01Td3dMR1poYkhObExERXNNU3d4TERBdU1Td3dMakZkWFN4Yld5MDBMQzAwTERBc01USTVNUzQ1T0RRNE5qQTBNREF6TnpFeUxEY3lNQ3d3TERBc1d6RXNNU3d4TERGZExEQXNNQ3d3TERBc1cxMHNiblZzYkN4dWRXeHNMRzUxYkd3c1d5SWlMQ0lpWFYwc09TdzFNeXhiWFN4Yld6QXNNQ3d4TERFc2RISjFaVjFkTEZ0bVlXeHpaU3d3TERFc01Td3dMREFzTVN3eExEQXNabUZzYzJVc01Td3hMREVzTUM0eExEQXVNVjFkTEZ0YkxUSXNMVE1zTUN3eE1qZzVMRGN4Tnl3d0xEQXNXekVzTVN3eExERmRMREFzTUN3d0xEQXNXMTBzYm5Wc2JDeHVkV3hzTEc1MWJHd3NXeUlpTENJaVhWMHNPQ3d5TEZ0ZExGdGJNQ3d3TERFc01TeDBjblZsWFYwc1czUnlkV1VzTUN3eExERXNNQ3d3TERFc01Td3dMR1poYkhObExERXNNU3d4TERBdU1Td3dMakZkWFN4Yld6ZzVOeXd4TlRBc01Dd3hNREFzTVRBd0xEQXNNQ3hiTVN3eExERXNNVjBzTUM0MUxEQXVOU3d3TERBc1cxMHNiblZzYkN4dWRXeHNMRzUxYkd3c1d5SWlMQ0lpWFYwc01qa3NOVElzVzEwc1cxMHNXM1J5ZFdVc0lrRnVhVzFoZEdsdmJpQXhJaXd3TEhSeWRXVmRYU3hiV3pRM01Dd3hORFFzTUN3eU1URXNNVEV6TERBc01DeGJNU3d4TERFc01WMHNNUzR3TURRM016a3pNelkwT1RJNE9URXNNQzQxTURRME1qUTNOemczTmpFd05qSXNNQ3d3TEZ0ZExHNTFiR3dzYm5Wc2JDeHVkV3hzTEZzaUlpd2lJbDFkTERFMkxEUTFMRnN3WFN4Yld6RXdMREFzTUN4bVlXeHpaU3htWVd4elpTeG1ZV3h6WlN4MGNuVmxYVjBzVzNSeWRXVXNJa0Z1YVcxaGRHbHZiaUF4SWl3MExIUnlkV1ZkWFN4Yld6a3dOeXcyTml3d0xERTNNeXd4TURBc01Dd3dMRnN4TERFc01Td3hYU3d4TERBdU5Td3dMREFzVzEwc2JuVnNiQ3h1ZFd4c0xHNTFiR3dzV3lJaUxDSWlYVjBzTVRZc05EWXNXekJkTEZ0Yk1UQXNNQ3d3TEdaaGJITmxMR1poYkhObExHWmhiSE5sTEhSeWRXVmRYU3hiZEhKMVpTd2lRVzVwYldGMGFXOXVJREVpTERJc2RISjFaVjFkTEZ0Yk5qUTFMREU1Tnl3d0xEVXdMRFF5TERBc01DeGJNU3d4TERFc01WMHNNU3d3TGpVeU16Z3dPVFV5TXpnd09UVXlNemdzTUN3d0xGdGRMRzUxYkd3c2JuVnNiQ3h1ZFd4c0xGc2lJaXdpSWwxZExERTJMRFEzTEZzd1hTeGJXekV3TERBc01DeG1ZV3h6WlN4bVlXeHpaU3htWVd4elpTeDBjblZsWFYwc1czUnlkV1VzSWtGdWFXMWhkR2x2YmlBeElpd3hMSFJ5ZFdWZFhTeGJXekV4TXpnc01UVTNMREFzTVRjekxERXdNQ3d3TERBc1d6RXNNU3d4TERGZExERXVNREExTnpnd016UTJPREl3T0RBNU15d3dMalEzTERBc01DeGJYU3h1ZFd4c0xHNTFiR3dzYm5Wc2JDeGJJaUlzSWlKZFhTd3hOaXcxTlN4Yk1GMHNXMXN4TUN3d0xEQXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNkSEoxWlYxZExGdDBjblZsTENKQmJtbHRZWFJwYjI0Z01TSXNNeXgwY25WbFhWMHNXMXN0TkRVc09ESXNNQ3d4TnpNc01UQXdMREFzTUN4Yk1Td3hMREVzTVYwc01TNHdNRFUzT0RBek5EWTRNakE0TURrekxEQXVORGNzTUN3d0xGdGRMRzUxYkd3c2JuVnNiQ3h1ZFd4c0xGc2lJaXdpSWwxZExERTJMRFF3TEZzd1hTeGJXekV3TERBc01DeG1ZV3h6WlN4bVlXeHpaU3htWVd4elpTeDBjblZsWFYwc1czUnlkV1VzSWtGdWFXMWhkR2x2YmlBeElpd3pMSFJ5ZFdWZFhTeGJXekUyTVRjc09UUXNNQ3d5TVRFc01URXpMREFzTUN4Yk1Td3hMREVzTVYwc01TNHdNRFEzTXprek16WTBPVEk0T1RFc01DNDFNRFEwTWpRM056ZzNOakV3TmpJc01Dd3dMRnRkTEc1MWJHd3NiblZzYkN4dWRXeHNMRnNpSWl3aUlsMWRMREUyTERRMExGc3dYU3hiV3pFd0xEQXNNQ3htWVd4elpTeG1ZV3h6WlN4bVlXeHpaU3gwY25WbFhWMHNXM1J5ZFdVc0lrRnVhVzFoZEdsdmJpQXhJaXcwTEhSeWRXVmRYU3hiV3pFek56a3NNakV4TERBc05UQXNORElzTUN3d0xGc3hMREVzTVN3eFhTd3hMREF1TlRJek9EQTVOVEl6T0RBNU5USXpPQ3d3TERBc1cxMHNiblZzYkN4dWRXeHNMRzUxYkd3c1d5SWlMQ0lpWFYwc01UWXNOakFzV3pCZExGdGJNVEFzTUN3d0xHWmhiSE5sTEdaaGJITmxMR1poYkhObExIUnlkV1ZkWFN4YmRISjFaU3dpUVc1cGJXRjBhVzl1SURFaUxERXNkSEoxWlYxZExGdGJNVFk1T0N3eE5qVXNNQ3cxTUN3ME1pd3dMREFzV3pFc01Td3hMREZkTERFc01DNDFNak00TURrMU1qTTRNRGsxTWpNNExEQXNNQ3hiWFN4dWRXeHNMRzUxYkd3c2JuVnNiQ3hiSWlJc0lpSmRYU3d4Tml3Mk1TeGJNRjBzVzFzeE1Dd3dMREFzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzZEhKMVpWMWRMRnQwY25WbExDSkJibWx0WVhScGIyNGdNU0lzTVN4MGNuVmxYVjBzVzFzdE1URTRMREl3Tnl3d0xEVXdMRFF5TERBc01DeGJNU3d4TERFc01WMHNNU3d3TGpVeU16Z3dPVFV5TXpnd09UVXlNemdzTUN3d0xGdGRMRzUxYkd3c2JuVnNiQ3h1ZFd4c0xGc2lJaXdpSWwxZExERTJMRFl5TEZzd1hTeGJXekV3TERBc01DeG1ZV3h6WlN4bVlXeHpaU3htWVd4elpTeDBjblZsWFYwc1czUnlkV1VzSWtGdWFXMWhkR2x2YmlBeElpd3hMSFJ5ZFdWZFhTeGJXeTAwTURNc01UQTVMREFzTlRBc05ESXNNQ3d3TEZzeExERXNNU3d4WFN3eExEQXVOVEl6T0RBNU5USXpPREE1TlRJek9Dd3dMREFzVzEwc2JuVnNiQ3h1ZFd4c0xHNTFiR3dzV3lJaUxDSWlYVjBzTVRZc05qTXNXekJkTEZ0Yk1UQXNNQ3d3TEdaaGJITmxMR1poYkhObExHWmhiSE5sTEhSeWRXVmRYU3hiZEhKMVpTd2lRVzVwYldGMGFXOXVJREVpTERFc2RISjFaVjFkTEZ0YkxURXlNek1zTkRFc01Dd3lNVEVzTVRFekxEQXNNQ3hiTVN3eExERXNNVjBzTVM0d01EUTNNemt6TXpZME9USTRPVEVzTUM0MU1EUTBNalEzTnpnM05qRXdOaklzTUN3d0xGdGRMRzUxYkd3c2JuVnNiQ3h1ZFd4c0xGc2lJaXdpSWwxZExERTJMRGMxTEZzd1hTeGJXekV3TERBc01DeG1ZV3h6WlN4bVlXeHpaU3htWVd4elpTeDBjblZsWFYwc1czUnlkV1VzSWtGdWFXMWhkR2x2YmlBeElpdzBMSFJ5ZFdWZFhTeGJXeTB4TlRRMExERTJNeXd3TERVd0xEUXlMREFzTUN4Yk1Td3hMREVzTVYwc01Td3dMalV5TXpnd09UVXlNemd3T1RVeU16Z3NNQ3d3TEZ0ZExHNTFiR3dzYm5Wc2JDeHVkV3hzTEZzaUlpd2lJbDFkTERFMkxEYzJMRnN3WFN4Yld6RXdMREFzTUN4bVlXeHpaU3htWVd4elpTeG1ZV3h6WlN4MGNuVmxYVjBzVzNSeWRXVXNJa0Z1YVcxaGRHbHZiaUF4SWl3eExIUnlkV1ZkWFN4Yld5MHhOekkwTERNNExEQXNNVGN6TERFd01Dd3dMREFzV3pFc01Td3hMREZkTERFdU1EQTFOemd3TXpRMk9ESXdPREE1TXl3d0xqUTNMREFzTUN4YlhTeHVkV3hzTEc1MWJHd3NiblZzYkN4YklpSXNJaUpkWFN3eE5pdzNOeXhiTUYwc1cxc3hNQ3d3TERBc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc2RISjFaVjFkTEZ0MGNuVmxMQ0pCYm1sdFlYUnBiMjRnTVNJc015eDBjblZsWFYwc1cxczJOREF1TURBME16VTFNak0yTnpneExDMHlPU3d3TERFd01Dd3hNamMwTERBc01TNDFOekEzT1RZek1qWTNPVFE0T1RZMkxGc3hMREVzTVN3eFhTd3dMREF1TlN3d0xEQXNXMTBzYm5Wc2JDeHVkV3hzTEc1MWJHd3NXeUlpTENJaVhWMHNNamNzT0RBc1cxMHNXMTBzV3pNd0xERXdMREFzTFRFc2RISjFaU3d5TURBc01UQXNNVEF3TERBc01USTRNQ3d3TERBc05Td3dMREFzTUN3d0xEWXdNQ3d3TERBc05WMWRMRnRiTVRNek5pd3ROek1zTUN3eE1EQXNNVFV3Tnl3d0xESXVNelUyTVRrME5Ea3dNVGt5TXpRMUxGc3hMREVzTVN3eFhTd3dMREF1TlN3d0xEQXNXMTBzYm5Wc2JDeHVkV3hzTEc1MWJHd3NXeUlpTENJaVhWMHNNamdzT0RFc1d6RXNNQ3d3WFN4YlhTeGJNVFVzTVRBc01Dd3RNU3gwY25WbExETXdNQ3d4TlN3eE1EQXNNQ3d6TURBd0xEQXNNQ3cxTERBc01Dd3dMREFzTmpBd0xEQXNNQ3cxWFYwc1cxc3RNVEFzTFRVMUxEQXNNVEF3TERFeU5ESXNNQ3d3TGpjNE5UTTVPREUyTXpNNU56UTBPRE1zV3pFc01Td3hMREZkTERBc01DNDFMREFzTUN4YlhTeHVkV3hzTEc1MWJHd3NiblZzYkN4YklpSXNJaUpkWFN3eU9DdzRNaXhiTUN3d0xEQmRMRnRkTEZzeE5Td3hNQ3d3TEMweExIUnlkV1VzTXpBd0xERTFMREV3TUN3d0xETXdNREFzTUN3d0xEVXNNQ3d3TERBc01DdzJNREFzTUN3d0xEVmRYVjBzVzEwc01DeDBjblZsTEdaaGJITmxMRnRkWFN4YkltZGhiV1VpTERFc01UTTROell5T0RReU5qUXpOVEUyTEhSeWRXVXNXemswTERrMExEazBYU3gwY25WbExERXNNU3d4TEdaaGJITmxMR1poYkhObExERXNNQ3gwY25WbExGdGJXeTA0TXpFc05USTRMREFzTXpBd05DdzBPVGtzTUN3d0xGc3hMREVzTVN3eFhTd3dMREFzTUN3d0xGdGRMRzUxYkd3c2JuVnNiQ3h1ZFd4c0xGc2lJaXdpSWwxZExESXhMRGcxTEZ0ZExGdGRMRnQwY25WbExEQXNNU3d4TERBc01Dd3hMREVzTUN4bVlXeHpaU3d4TERFc01Td3dMakVzTUM0eFhWMHNXMXN0T0RNeExEVTFNeXd3TERNd01EUXNNVFV5TERBc01DeGJNU3d4TERFc01WMHNNQ3d3TERBc01DeGJYU3h1ZFd4c0xHNTFiR3dzYm5Wc2JDeGJJaUlzSWlKZFhTd3lNU3c0Tml4YlhTeGJYU3hiZEhKMVpTd3dMREVzTVN3d0xEQXNNU3d4TERBc1ptRnNjMlVzTVN3eExERXNNQzR4TERBdU1WMWRMRnRiTFRFd05EZ3NOVEk0TERBc016SXhOU3d4TlRJc01Dd3dMRnN4TERFc01Td3hYU3d3TERBc01Dd3dMRnRkTEc1MWJHd3NiblZzYkN4dWRXeHNMRnNpSWl3aUlsMWRMREl3TERjekxGdGRMRnRkTEZ0bVlXeHpaU3d3TERFc01pd3dMREFzTVN3eExEQXNabUZzYzJVc01Td3hMREVzTUM0eExEQXVNVjFkTEZ0YkxURXdNelFzTlRVekxEQXNNekl4TlN3eE1qWXNNQ3d3TEZzeExERXNNU3d4WFN3d0xEQXNNQ3d3TEZ0ZExHNTFiR3dzYm5Wc2JDeHVkV3hzTEZzaUlpd2lJbDFkTERJd0xEY3lMRnRkTEZ0ZExGdG1ZV3h6WlN3d0xERXNNaXd3TERBc01Td3hMREFzWm1Gc2MyVXNNU3d4TERFc01DNHhMREF1TVYxZExGdGJMVGsyTVN3Mk9EQXNNQ3d6TWpFMUxERTFNaXd3TERBc1d6RXNNU3d4TERGZExEQXNNQ3d3TERBc1cxMHNiblZzYkN4dWRXeHNMRzUxYkd3c1d5SWlMQ0lpWFYwc01qQXNOelFzVzEwc1cxMHNXMlpoYkhObExEQXNNU3d5TERBc01Dd3hMREVzTUN4bVlXeHpaU3d4TERFc01Td3dMakVzTUM0eFhWMHNXMXN0T0RjMExEZ3pNU3d3TERNeU1UVXNNVFV5TERBc01DeGJNU3d4TERFc01WMHNNQ3d3TERBc01DeGJYU3h1ZFd4c0xHNTFiR3dzYm5Wc2JDeGJJaUlzSWlKZFhTd3lNQ3czT0N4YlhTeGJYU3hiWm1Gc2MyVXNNQ3d4TERJc01Dd3dMREVzTVN3d0xHWmhiSE5sTERFc01Td3hMREF1TVN3d0xqRmRYU3hiV3kwM09EZ3NPVGd6TERBc016SXhOU3d4TlRJc01Dd3dMRnN4TERFc01Td3hYU3d3TERBc01Dd3dMRnRkTEc1MWJHd3NiblZzYkN4dWRXeHNMRnNpSWl3aUlsMWRMREl3TERjNUxGdGRMRnRkTEZ0bVlXeHpaU3d3TERFc01pd3dMREFzTVN3eExEQXNabUZzYzJVc01Td3hMREVzTUM0eExEQXVNVjFkTEZ0YkxUZ3pNU3cxTWpnc01Dd3pNREEwTERRNU9Td3dMREFzV3pFc01Td3hMREZkTERBc01Dd3dMREFzVzEwc2JuVnNiQ3h1ZFd4c0xHNTFiR3dzV3lJaUxDSWlYVjBzTVRrc056RXNXMTBzVzEwc1cyWmhiSE5sTERBc01Td3hMREFzTUN3eExERXNNQ3htWVd4elpTd3hMREVzTVN3d0xqRXNNQzR4WFYwc1cxc3RPRE14TERVMU15d3dMRE13TURRc01UVXlMREFzTUN4Yk1Td3hMREVzTVYwc01Dd3dMREFzTUN4YlhTeHVkV3hzTEc1MWJHd3NiblZzYkN4YklpSXNJaUpkWFN3eE9TdzNNQ3hiWFN4YlhTeGJabUZzYzJVc01Dd3hMREVzTUN3d0xERXNNU3d3TEdaaGJITmxMREVzTVN3eExEQXVNU3d3TGpGZFhTeGJXeTA0TXpFc05USTRMREFzTXpBd05DdzBPVGtzTUN3d0xGc3hMREVzTVN3eFhTd3dMREFzTUN3d0xGdGRMRzUxYkd3c2JuVnNiQ3h1ZFd4c0xGc2lJaXdpSWwxZExERTRMREUwTEZ0ZExGdGJkSEoxWlN3d0xHWmhiSE5sTERFc01DNDFMREF1TWl3d0xEQXVNREVzWm1Gc2MyVXNabUZzYzJWZFhTeGJkSEoxWlN3d0xERXNNU3d3TERBc01Td3hMREFzWm1Gc2MyVXNNU3d4TERFc01DNHhMREF1TVYxZExGdGJMVGd6TVN3MU5UTXNNQ3d6TURBMExERTFNaXd3TERBc1d6RXNNU3d4TERGZExEQXNNQ3d3TERBc1cxMHNiblZzYkN4dWRXeHNMRzUxYkd3c1d5SWlMQ0lpWFYwc01UZ3NNakVzVzEwc1cxdDBjblZsTERFc1ptRnNjMlVzTVN3d0xqVXNNQzR5TERBc01DNHdNU3htWVd4elpTeDBjblZsWFYwc1czUnlkV1VzTUN3eExERXNNQ3d3TERFc01Td3dMR1poYkhObExERXNNU3d4TERBdU1Td3dMakZkWFN4Yld6azNOU3d5Tnpjc01Dd3pPQ3cwTnl3d0xEQXNXekVzTVN3eExERmRMREF1TmpVM09EazBOek0yT0RReU1UQTFNeXd3TGprM09EY3lNelF3TkRJMU5UTXhPVEVzTUN3d0xGdGRMRzUxYkd3c2JuVnNiQ3h1ZFd4c0xGc2lJaXdpSWwxZExESXlMRE14TEZzMFhTeGJXMlpoYkhObExEQXNabUZzYzJVc01Td3dMalVzTUM0MUxEQXNNQzR3TVN4bVlXeHpaU3gwY25WbFhWMHNXM1J5ZFdVc0lrRnVhVzFoZEdsdmJpQXhJaXd3TEhSeWRXVmRYU3hiV3prNU55d3lPRGdzTUN3ek15dzRNaXd3TERBc1d6RXNNU3d4TERGZExEQXVORFUwTlRRMU5EVTBOVFExTkRVME5UTXNNQzQ0TURRNE56Z3dORGczT0RBME9EYzVMREFzTUN4YlhTeHVkV3hzTEc1MWJHd3NiblZzYkN4YklpSXNJaUpkWFN3ek5Dd3hPQ3hiWFN4YlcyWmhiSE5sTERBc1ptRnNjMlVzTUM0eUxEQXVOU3d3TGpJc01Dd3dMakVzWm1Gc2MyVXNkSEoxWlYxZExGdDBjblZsTENKQmJtbHRZWFJwYjI0Z01TSXNOU3gwY25WbFhWMHNXMXM0TXpVc01qYzNMREFzTXpNc09ESXNNQ3d3TEZzeExERXNNU3d4WFN3d0xqUTRORGcwT0RRNE5EZzBPRFE0TkRnMkxEQXVNVGd5T1RJMk9ESTVNalk0TWpreU5qZ3NNQ3d3TEZ0ZExHNTFiR3dzYm5Wc2JDeHVkV3hzTEZzaUlpd2lJbDFkTERNMExEZ3NXMTBzVzF0bVlXeHpaU3d3TEdaaGJITmxMREF1TWl3d0xqVXNNQzR5TERBc01DNHhMR1poYkhObExIUnlkV1ZkWFN4YmRISjFaU3dpUVc1cGJXRjBhVzl1SURFaUxESXNkSEoxWlYxZExGdGJPVFUwTERJNE9Dd3dMRE16TERneUxEQXNNQ3hiTVN3eExERXNNVjBzTUM0Mk1EWXdOakEyTURZd05qQTJNRFl4TERBdU9EQTBPRGM0TURRNE56Z3dORGczT1N3d0xEQXNXMTBzYm5Wc2JDeHVkV3hzTEc1MWJHd3NXeUlpTENJaVhWMHNNelFzTWprc1cxMHNXMXRtWVd4elpTd3dMR1poYkhObExEQXVNaXd3TGpVc01DNHlMREFzTUM0eExHWmhiSE5sTEhSeWRXVmRYU3hiZEhKMVpTd2lRVzVwYldGMGFXOXVJREVpTERRc2RISjFaVjFkTEZ0Yk9EZzBMREkzT0N3d0xETXpMRGd5TERBc01DeGJNU3d4TERFc01WMHNNQzQwT0RRNE5EZzBPRFE0TkRnME9EUTROaXd3TGpFNU5URXlNVGsxTVRJeE9UVXhNaklzTUN3d0xGdGRMRzUxYkd3c2JuVnNiQ3h1ZFd4c0xGc2lJaXdpSWwxZExETTBMRGtzVzEwc1cxdG1ZV3h6WlN3d0xHWmhiSE5sTERBdU1pd3dMalVzTUM0eUxEQXNNQzR4TEdaaGJITmxMSFJ5ZFdWZFhTeGJkSEoxWlN3aVFXNXBiV0YwYVc5dUlERWlMREFzZEhKMVpWMWRMRnRiT0RVeExETXlOeXd3TERJNUxEZ3pMREFzTUN4Yk1Td3hMREVzTVYwc01DNDJOalkyTmpZMk5qWTJOalkyTmpZMkxEQXVNREU0TXpRNE5qSXpPRFV6TWpFeE1ERXNNQ3d3TEZ0ZExHNTFiR3dzYm5Wc2JDeHVkV3hzTEZzaUlpd2lJbDFkTERNMUxERXdMRnRkTEZ0YlptRnNjMlVzTUN4bVlXeHpaU3d4TERBdU5Td3dMaklzTUN3d0xqQXhMR1poYkhObExIUnlkV1ZkWFN4YmRISjFaU3dpUVc1cGJXRjBhVzl1SURFaUxEQXNkSEoxWlYxZExGdGJPRFU1TERNek9Td3dMRE0zTERFMU5Dd3dMREFzV3pFc01Td3hMREZkTERBdU5Td3dMalVzTUN3d0xGdGRMRzUxYkd3c2JuVnNiQ3h1ZFd4c0xGc2lJaXdpSWwxZExERXpMRFlzVzEwc1cxdG1ZV3h6WlN3d0xHWmhiSE5sTERRc01DNDRMREF1TWl3d0xEQXVOU3htWVd4elpTeDBjblZsWFYwc1czUnlkV1VzSWtGdWFXMWhkR2x2YmlBeElpd3dMSFJ5ZFdWZFhTeGJXemcxTnl3eU5qWXNNQ3d6T0N3ME55d3dMREFzV3pFc01Td3hMREZkTERBdU5qVTNPRGswTnpNMk9EUXlNVEExTXl3d0xqazNPRGN5TXpRd05ESTFOVE14T1RFc01Dd3dMRnRkTEc1MWJHd3NiblZzYkN4dWRXeHNMRnNpSWl3aUlsMWRMREl5TERjc1d6TmRMRnRiWm1Gc2MyVXNNQ3htWVd4elpTd3hMREF1TlN3d0xqVXNNQ3d3TGpBeExHWmhiSE5sTEhSeWRXVmRYU3hiZEhKMVpTd2lRVzVwYldGMGFXOXVJREVpTERBc2RISjFaVjFkTEZ0Yk9UWTNMRE16T0N3d0xESTVMRGd6TERBc01DeGJNU3d4TERFc01WMHNNQzQyTmpZMk5qWTJOalkyTmpZMk5qWTJMREF1TURFNE16UTROakl6T0RVek1qRXhNREVzTUN3d0xGdGRMRzUxYkd3c2JuVnNiQ3h1ZFd4c0xGc2lJaXdpSWwxZExETTFMREk0TEZ0ZExGdGJabUZzYzJVc01DeG1ZV3h6WlN3eExEQXVOU3d3TGpJc01Dd3dMakF4TEdaaGJITmxMSFJ5ZFdWZFhTeGJkSEoxWlN3aVFXNXBiV0YwYVc5dUlERWlMREFzZEhKMVpWMWRMRnRiT1RjMUxETTBPU3d3TERNM0xERTFOQ3d3TERBc1d6RXNNU3d4TERGZExEQXVOU3d3TGpVc01Dd3dMRnRkTEc1MWJHd3NiblZzYkN4dWRXeHNMRnNpSWl3aUlsMWRMREV6TERNd0xGdGRMRnRiWm1Gc2MyVXNNQ3htWVd4elpTdzBMREF1T0N3d0xqSXNNQ3d3TGpVc1ptRnNjMlVzZEhKMVpWMWRMRnQwY25WbExDSkJibWx0WVhScGIyNGdNU0lzTUN4MGNuVmxYVjBzVzFzME5qY3NNamc0TERBc016SXNPREFzTUN3d0xGc3hMREVzTVN3eFhTd3dMalF6TnpVc01DNHlMREFzTUN4YlhTeHVkV3hzTEc1MWJHd3NiblZzYkN4YklpSXNJaUpkWFN3ek5Dd3lOeXhiWFN4YlcyWmhiSE5sTERBc1ptRnNjMlVzTUM0eUxEQXVOU3d3TGpJc01Dd3dMakVzWm1Gc2MyVXNkSEoxWlYxZExGdDBjblZsTENKQmJtbHRZWFJwYjI0Z01TSXNNeXgwY25WbFhWMHNXMXMxTVRnc01qZzNMREFzTXpNc09EQXNNQ3d3TEZzeExERXNNU3d4WFN3d0xqUTRORGcwT0RRNE5EZzBPRFE0TkRnMkxEQXVNVGczTlN3d0xEQXNXMTBzYm5Wc2JDeHVkV3hzTEc1MWJHd3NXeUlpTENJaVhWMHNNelFzTVRZc1cxMHNXMXRtWVd4elpTd3dMR1poYkhObExEQXVNaXd3TGpVc01DNHlMREFzTUM0eExHWmhiSE5sTEhSeWRXVmRYU3hiZEhKMVpTd2lRVzVwYldGMGFXOXVJREVpTERFc2RISjFaVjFkTEZ0Yk5UQXdMRE16Tml3d0xESTVMRGd5TERBc05pNHlOelEyTmpZMU16TXdNVEF6Tnpjc1d6RXNNU3d4TERGZExEQXVNekV3TXpRME9ESTNOVGcyTWpBMk9Td3dMakF4TWpFNU5URXlNVGsxTVRJeE9UVXhNeXd3TERBc1cxMHNiblZzYkN4dWRXeHNMRzUxYkd3c1d5SWlMQ0lpWFYwc016VXNNVGNzVzEwc1cxdG1ZV3h6WlN3d0xHWmhiSE5sTERFc01DNDFMREF1TWl3d0xEQXVNREVzZEhKMVpTeDBjblZsWFYwc1czUnlkV1VzSWtGdWFXMWhkR2x2YmlBeElpd3hMSFJ5ZFdWZFhTeGJXelE1TXl3ek5EZ3NNQ3d6Tml3eE5USXNNQ3d3TEZzeExERXNNU3d4WFN3d0xqVXNNQzQxTERBc01DeGJYU3h1ZFd4c0xHNTFiR3dzYm5Wc2JDeGJJaUlzSWlKZFhTd3hNeXd4T1N4YlhTeGJXMlpoYkhObExEQXNabUZzYzJVc05Dd3dMamdzTUM0eUxEQXNNQzQxTEdaaGJITmxMSFJ5ZFdWZFhTeGJkSEoxWlN3aVFXNXBiV0YwYVc5dUlERWlMREVzZEhKMVpWMWRMRnRiTkRrM0xESTNOU3d3TERNNExEUTNMREFzTUN4Yk1Td3hMREVzTVYwc01DNHpOREl4TURVeU5qTXhOVGM0T1RRM05Td3dMamszT0RjeU16UXdOREkxTlRNeE9URXNNQ3d3TEZ0ZExHNTFiR3dzYm5Wc2JDeHVkV3hzTEZzaUlpd2lJbDFkTERJeUxESXdMRnN5WFN4YlcyWmhiSE5sTERBc1ptRnNjMlVzTVN3d0xqVXNNQzQxTERBc01DNHdNU3htWVd4elpTeDBjblZsWFYwc1czUnlkV1VzSWtGdWFXMWhkR2x2YmlBeElpdzNMSFJ5ZFdWZFhTeGJXek13Tml3eU56RXNNQ3d6T0N3ME55d3dMREFzV3pFc01Td3hMREZkTERBdU16UXlNVEExTWpZek1UVTNPRGswTnpVc01DNDVOemczTWpNME1EUXlOVFV6TVRreExEQXNNQ3hiWFN4dWRXeHNMRzUxYkd3c2JuVnNiQ3hiSWlJc0lpSmRYU3d5TWl3eU5peGJNVjBzVzF0bVlXeHpaU3d3TEdaaGJITmxMREVzTUM0MUxEQXVOU3d3TERBdU1ERXNabUZzYzJVc2RISjFaVjFkTEZ0MGNuVmxMQ0pCYm1sdFlYUnBiMjRnTVNJc055eDBjblZsWFYwc1cxc3pNVE1zTXpNekxEQXNNamtzT0RJc01DdzJMakkzTkRZMk5qVXpNekF4TURNM055eGJNU3d4TERFc01WMHNNQzR6TVRBek5EUTRNamMxT0RZeU1EWTVMREF1TURFeU1UazFNVEl4T1RVeE1qRTVOVEV6TERBc01DeGJYU3h1ZFd4c0xHNTFiR3dzYm5Wc2JDeGJJaUlzSWlKZFhTd3pOU3d5TXl4YlhTeGJXMlpoYkhObExEQXNabUZzYzJVc01Td3dMalVzTUM0eUxEQXNNQzR3TVN4bVlXeHpaU3gwY25WbFhWMHNXM1J5ZFdVc0lrRnVhVzFoZEdsdmJpQXhJaXd4TEhSeWRXVmRYU3hiV3pNek1Dd3lPRFVzTUN3ek1pdzRNQ3d3TERBc1d6RXNNU3d4TERGZExEQXVORE0zTlN3d0xqZ3lOU3d3TERBc1cxMHNiblZzYkN4dWRXeHNMRzUxYkd3c1d5SWlMQ0lpWFYwc016UXNNeklzVzEwc1cxdG1ZV3h6WlN3d0xHWmhiSE5sTERBdU1pd3dMalVzTUM0eUxEQXNNQzR4TEdaaGJITmxMSFJ5ZFdWZFhTeGJkSEoxWlN3aVFXNXBiV0YwYVc5dUlERWlMRGNzZEhKMVpWMWRMRnRiTWpnMkxESTROQ3d3TERNekxEZ3dMREFzTUN4Yk1Td3hMREVzTVYwc01DNDJNRFl3TmpBMk1EWXdOakEyTURZeExEQXVPREV5TlN3d0xEQXNXMTBzYm5Wc2JDeHVkV3hzTEc1MWJHd3NXeUlpTENJaVhWMHNNelFzTWpJc1cxMHNXMXRtWVd4elpTd3dMR1poYkhObExEQXVNaXd3TGpVc01DNHlMREFzTUM0eExHWmhiSE5sTEhSeWRXVmRYU3hiZEhKMVpTd2lRVzVwYldGMGFXOXVJREVpTERZc2RISjFaVjFkTEZ0Yk16QTJMRE0wTkN3d0xETTJMREUxTWl3d0xEQXVNREF5T1RFd09EVTJNemcwTVRJd09URTVMRnN4TERFc01Td3hYU3d3TGpVc01DNDFMREFzTUN4YlhTeHVkV3hzTEc1MWJHd3NiblZzYkN4YklpSXNJaUpkWFN3eE15d3lOU3hiWFN4YlcyWmhiSE5sTERBc1ptRnNjMlVzTkN3d0xqZ3NNQzR5TERBc01DNDFMR1poYkhObExIUnlkV1ZkWFN4YmRISjFaU3dpUVc1cGJXRjBhVzl1SURFaUxERXNkSEoxWlYxZExGdGJOalF3TERNMk1Dd3dMRFkxTGpBM05qZzNOell4TkRBNU5UYzVMRFkxTGpBM05qZzNOell4TkRBNU5UYzVMREFzTUN4Yk1Td3hMREVzTVYwc01DNDFMREF1TlN3d0xEQXNXMTBzYm5Wc2JDeHVkV3hzTEc1MWJHd3NXeUlpTENJaVhWMHNNVFVzTXprc1cxMHNXMXQwY25WbFhTeGJYVjBzVzJaaGJITmxMQ0pCYm1sdFlYUnBiMjRnTVNJc01DeDBjblZsWFYwc1cxczBPRGNzTFRFeE1pd3dMRFl6TGpJek56WTBOekF4TlRBME9UVXNOak11TWpNM05qUTNNREUxTURRNU5Td3dMREFzV3pFc01Td3hMREZkTERBdU5Td3dMalVzTUN3d0xGdGRMRzUxYkd3c1d6RXlOeXh1ZFd4c0xEVXpYU3h1ZFd4c0xGc2lJaXdpSWwxZExETXhMRFF4TEZ0ZExGdGRMRnRtWVd4elpTd2lRVzVwYldGMGFXOXVJREVpTERBc2RISjFaVjFkTEZ0Yk56Y3lMQzB4TURrc01DdzJNeTR5TXpjMk5EY3dNVFV3TkRrMUxEWXpMakl6TnpZME56QXhOVEEwT1RVc01Dd3dMRnN4TERFc01Td3hYU3d3TGpVc01DNDFMREFzTUN4YlhTeHVkV3hzTEZzeE1qY3NiblZzYkN3MU5GMHNiblZzYkN4YklpSXNJaUpkWFN3ek1TdzBNaXhiWFN4YlhTeGJabUZzYzJVc0lrRnVhVzFoZEdsdmJpQXhJaXd3TEhSeWRXVmRYU3hiV3pZek5Td3ROek1zTUN3NE1TNDJOVEV4T0RFek9UQXpORFUwT1N3NE1TNDJOVEV4T0RFek9UQXpORFUwT1N3d0xEQXNXekVzTVN3eExERmRMREF1TlN3d0xqVXNNQ3d3TEZ0ZExHNTFiR3dzYm5Wc2JDeHVkV3hzTEZzaUlpd2lJbDFkTERFeUxERXlMRnRkTEZ0YlptRnNjMlVzTWl4bVlXeHpaU3d3TGpVc01DNDFMREF1TWl3d0xqTXNNQzR3TVN4bVlXeHpaU3gwY25WbFhWMHNXM1J5ZFdVc0lrRnVhVzFoZEdsdmJpQXhJaXd3TEhSeWRXVmRYU3hiV3pFeE5qUXNOVGcwTERBc01UZ3dMRE14T1N3d0xEQXNXekVzTVN3eExERmRMREF1TkRrek5UQTJORGt6TlRBMk5Ea3pOU3d4TERBc01DeGJYU3h1ZFd4c0xGc3hNamNzVzFzNU9EazFNRFl5TWpFeU1qYzVNVEVzTVN3ekxERXlOeXd3TERVM1hWMHNOVFpkTEc1MWJHd3NXeUlpTENJaVhWMHNNellzTVRNc1cxMHNXMXQwY25WbExEQXNabUZzYzJVc01Td3dMalVzTUM0eUxEQXNNQzR3TVN4bVlXeHpaU3gwY25WbFhWMHNXM1J5ZFdVc0lrRnVhVzFoZEdsdmJpQXhJaXcwTEhSeWRXVmRYU3hiV3pFeE1UWXVOVGMwTlRJeE1qZzRNVGc1TlN3eU56WXVPVFUyTERBc05EZ3NNalUwTERBc01DeGJNU3d4TERFc01DNDFYU3d3TGpVc01Dd3dMREFzVzEwc2JuVnNiQ3hiTVRJM0xHNTFiR3dzTlRkZExHNTFiR3dzV3lJaUxDSWlYVjBzTVRjc015eGJYU3hiWFN4YlptRnNjMlVzSWtGdWFXMWhkR2x2YmlBeElpd3dMSFJ5ZFdWZFhTeGJXekV5TUN3MU9UWXNNQ3d4T0RBc016RTVMREFzTUN4Yk1Td3hMREVzTVYwc01DNDBPVE0xTURZME9UTTFNRFkwT1RNMUxERXNNQ3d3TEZ0ZExHNTFiR3dzV3pFeU55eGJXems0T1RVd05qSXlNVEl5TnpreE1Td3hMREUxTERFeU55d3dMRFU1WFYwc05UaGRMRzUxYkd3c1d5SWlMQ0lpWFYwc016WXNOQ3hiWFN4YlczUnlkV1VzTUN4bVlXeHpaU3d4TERBdU5Td3dMaklzTUN3d0xqQXhMR1poYkhObExIUnlkV1ZkWFN4YmRISjFaU3dpUVc1cGJXRjBhVzl1SURFaUxERXNkSEoxWlYxZExGdGJNVFkxTGpnd09EWXhORFUwTVRjMU5qY3pMREk0T0N3d0xEVTBMREkxTkN3d0xEQXNXekVzTVN3eExEQXVOVjBzTUM0MUxEQXNNQ3d3TEZ0ZExHNTFiR3dzV3pFeU55eHVkV3hzTERVNVhTeHVkV3hzTEZzaUlpd2lJbDFkTERFM0xERTFMRnRkTEZ0ZExGdG1ZV3h6WlN3aVFXNXBiV0YwYVc5dUlERWlMREFzZEhKMVpWMWRMRnRiTFRFNU1pNHpORFUwTnpRNE56a3dOalV3T0N3dE16WTNMakkzTXpjNU16ZzNNemswTmpBekxEQXNOell4TERFMU1pd3dMREV1TURFME9UTTRPRE16T1RJNU1qSXlMRnN4TERFc01Td3hYU3d3TERBc01Dd3dMRnRkTEc1MWJHd3NiblZzYkN4dWRXeHNMRnNpSWl3aUlsMWRMRFF6TERrMExGc2lJbDBzVzF0MGNuVmxMREVzWm1Gc2MyVXNNU3d3TGpVc01DNHlMREFzTUM0d01TeG1ZV3h6WlN4MGNuVmxYVjBzVzJaaGJITmxMREFzTVN3eExEQXNNQ3d4TERFc01DeG1ZV3h6WlN3eExERXNNU3d3TGpFc01DNHhYVjBzVzFzeE5UZ3hMakF3TnpRMk5ESTJOVFV3Tmpnc0xUSTJNUzQzTWpVNU9UVXlNalV5TXpZMUxEQXNOekUwTERFMU1pd3dMREl1TVRJek1EWTFPVEE0TlRRMk1ETXdOQ3hiTVN3eExERXNNVjBzTUN3d0xEQXNNQ3hiWFN4dWRXeHNMRzUxYkd3c2JuVnNiQ3hiSWlJc0lpSmRYU3cwTXl3NU5TeGJJaUpkTEZ0YmRISjFaU3d4TEdaaGJITmxMREVzTUM0MUxEQXVNaXd3TERBdU1ERXNabUZzYzJVc2RISjFaVjFkTEZ0bVlXeHpaU3d3TERFc01Td3dMREFzTVN3eExEQXNabUZzYzJVc01Td3hMREVzTUM0eExEQXVNVjFkTEZ0Yk5qTXhMQzB5TkRrc01Dd3hOems1TERFMU1pd3dMREFzV3pFc01Td3hMREZkTERBdU5Td3hMREFzTUN4YlhTeHVkV3hzTEZzeE1qY3NXMXM1T0RrMU1EWXlNakV5TWpjNU1URXNNU3cwTVN3eE1qY3NNQ3cxTTEwc1d6azRPVFV3TmpJeU1USXlOemt4TVN3eExEUXlMREV5Tnl3d0xEVTBYVjBzTmpKZExHNTFiR3dzV3lJaUxDSWlYVjBzTkRNc09UWXNXeUpWVUNKZExGdGJkSEoxWlN3eExHWmhiSE5sTERFc01DNDFMREF1TWl3d0xEQXVNREVzWm1Gc2MyVXNkSEoxWlYxZExGdG1ZV3h6WlN3M0xERXNNU3d3TERBc01Td3hMREFzWm1Gc2MyVXNNU3d4TERFc01DNHhMREF1TVYxZExGdGJNVEUzTEMwNE5Dd3dMREV4TVN3NU5pd3dMREFzV3pFc01Td3hMREZkTERBdU5Td3dMalVzTUN3d0xGdGRMRzUxYkd3c2JuVnNiQ3h1ZFd4c0xGc2lJaXdpSWwxZExEUTBMRGszTEZzaUlpd3dYU3hiWFN4Yk1DeDBjblZsTERRc01GMWRYU3hiWFN3d0xIUnlkV1VzWm1Gc2MyVXNXMTFkTEZzaVIxVkpJaXd5TERZeE5EZ3hNekl3TmpNd05qZzNNU3gwY25WbExGczVOQ3c1TkN3NU5GMHNkSEoxWlN3d0xEQXNNU3htWVd4elpTeG1ZV3h6WlN3d0xEQXNkSEoxWlN4Ylcxc3hNak15TERVd0xEQXNPRFV1T0RBME16SXpNRE01TXpJM05ERXNPRFV1T0RBME16SXpNRE01TXpJM05ERXNNQ3d3TEZzeExERXNNU3d4WFN3d0xqVXNNQzQxTERBc01DeGJXM1J5ZFdWZFhTeHVkV3hzTEc1MWJHd3NiblZzYkN4YklpSXNJaUpkWFN3eE5DdzJOaXhiWFN4Yld6RXNNQ3d3TERBc2RISjFaVjFkTEZ0MGNuVmxMQ0pCYm1sdFlYUnBiMjRnTVNJc01DeDBjblZsWFYwc1cxczFOREl1TkRBNU1EZzFNell3TkRRd05pd3hNaXd3TERFd055NDFORFUwTlRRMU5EVTBOVE00TWl3eE1qQXVOak0yTXpVNE1EZzNOekV5T0RRc01Dd3dMRnN3TERBc01Td3hYU3d3TERBc01Dd3dMRnRiZEhKMVpTd3hYU3hiZEhKMVpTeGJNQ3d3TERGZFhWMHNiblZzYkN4dWRXeHNMRzUxYkd3c1d5SWlMQ0lpWFYwc05pdzFMRnRkTEZ0Yk1pd3dMREFzTUN4MGNuVmxYVjBzV3lJd0lpeDBjblZsTERZekxEYzBMQ0pCUWtORVJVWkhTRWxLUzB4TlRrOVFVVkpUVkZWV1YxaFpXbUZpWTJSbFptZG9hV3ByYkcxdWIzQnhjbk4wZFhaM2VIbDZNREV5TXpRMU5qYzRPUzRzT3pvL0lTMWZmaU5jSWljbUtDbGJYWHhnWEZ3dlFNS3dLejBxSk1LajRvS3NQRDdRa05DUjBKTFFrOUNVMEpYUWdkQ1cwSmZRbU5DWjBKclFtOUNjMEozUW50Q2YwS0RRb2RDaTBLUFFwTkNsMEtiUXA5Q28wS25RcXRDcjBLelFyZEN1MEsvUXNOQ3gwTExRczlDMDBMWFJrZEMyMExmUXVOQzUwTHJRdTlDODBMM1F2dEMvMFlEUmdkR0MwWVBSaE5HRjBZYlJoOUdJMFluUml0R0wwWXpSamRHTzBZOGlMQ0lpTERFc01Dd3dMREFzTUN3d0xIUnlkV1VzTUN4bVlXeHpaVjFkTEZ0Yk5qUXpMREV4TERBc09UVXNPVEFzTUN3d0xGc3dMREFzTVN3eFhTd3dMREFzTUN3d0xGdGJkSEoxWlN3eFhTeGJkSEoxWlN4Yk1Td3dMREJkWFYwc2JuVnNiQ3h1ZFd4c0xHNTFiR3dzV3lJaUxDSWlYVjBzTml3ek55eGJYU3hiV3pJc01Dd3dMREFzZEhKMVpWMWRMRnNpTUNJc2RISjFaU3cyTXl3M05Dd2lRVUpEUkVWR1IwaEpTa3RNVFU1UFVGRlNVMVJWVmxkWVdWcGhZbU5rWldabmFHbHFhMnh0Ym05d2NYSnpkSFYyZDNoNWVqQXhNak0wTlRZM09Ea3VMRHM2UHlFdFgzNGpYQ0luSmlncFcxMThZRnhjTDBEQ3NDczlLaVRDbytLQ3JEdyswSkRRa2RDUzBKUFFsTkNWMElIUWx0Q1gwSmpRbWRDYTBKdlFuTkNkMEo3UW45Q2cwS0hRb3RDajBLVFFwZENtMEtmUXFOQ3AwS3JRcTlDczBLM1FydEN2MExEUXNkQ3kwTFBRdE5DMTBaSFF0dEMzMExqUXVkQzYwTHZRdk5DOTBMN1F2OUdBMFlIUmd0R0QwWVRSaGRHRzBZZlJpTkdKMFlyUmk5R00wWTNSanRHUElpd2lJaXd4TERBc01Dd3dMREFzTUN4MGNuVmxMREFzWm1Gc2MyVmRYU3hiV3pZd05TNDVOVFExTXprNU1EVTRPVFV5TERFd0xEQXNOalF1TmpNMk16YzBOek16TmpZME1UZ3NPREV1TURrd09UQXpOVFF5TWpVNE1qY3NNQ3d3TEZzd0xEQXNNU3d4WFN3d0xEQXNNQ3d3TEZ0YmRISjFaU3d4WFN4YmRISjFaU3hiTVN3eExERmRYVjBzYm5Wc2JDeHVkV3hzTEc1MWJHd3NXeUlpTENJaVhWMHNOaXd6T0N4YlhTeGJXeklzTUN3d0xEQXNkSEoxWlYxZExGc2lPaUlzZEhKMVpTdzJNeXczTkN3aVFVSkRSRVZHUjBoSlNrdE1UVTVQVUZGU1UxUlZWbGRZV1ZwaFltTmtaV1puYUdscWEyeHRibTl3Y1hKemRIVjJkM2g1ZWpBeE1qTTBOVFkzT0RrdUxEczZQeUV0WDM0alhDSW5KaWdwVzExOFlGeGNMMERDc0NzOUtpVENvK0tDckR3KzBKRFFrZENTMEpQUWxOQ1YwSUhRbHRDWDBKalFtZENhMEp2UW5OQ2QwSjdRbjlDZzBLSFFvdENqMEtUUXBkQ20wS2ZRcU5DcDBLclFxOUNzMEszUXJ0Q3YwTERRc2RDeTBMUFF0TkMxMFpIUXR0QzMwTGpRdWRDNjBMdlF2TkM5MEw3UXY5R0EwWUhSZ3RHRDBZVFJoZEdHMFlmUmlOR0owWXJSaTlHTTBZM1JqdEdQSWl3aUlpd3hMREFzTUN3d0xEQXNNQ3gwY25WbExEQXNabUZzYzJWZFhTeGJXemsxTkN3Mk5EQXNNQ3d4TXpVc01USXdMREFzTUN4Yk1Td3hMREVzTVYwc01DNDFNVGcxTVRnMU1UZzFNVGcxTVRnMUxEQXVOVEkxTERBc01DeGJYU3h1ZFd4c0xHNTFiR3dzYm5Wc2JDeGJJaUlzSWlKZFhTd3pNaXd5TkN4Yk0xMHNXMTBzVzNSeWRXVXNJbUVpTERRc2RISjFaVjFkTEZ0Yk1URTBNU3cyTkRBc01Dd3hNelVzTVRJd0xEQXNNQ3hiTVN3eExERXNNVjBzTUM0MU1qVTVNalU1TWpVNU1qVTVNalU1TERBdU5URTJOalkyTmpZMk5qWTJOalkyTnl3d0xEQXNXMTBzYm5Wc2JDeHVkV3hzTEc1MWJHd3NXeUlpTENJaVhWMHNNeklzTXpNc1d6UmRMRnRkTEZ0MGNuVmxMQ0poSWl3MkxIUnlkV1ZkWFN4Yld6TXpOU3cyTkRJc01Dd3hNelVzTVRJd0xEQXNNQ3hiTVN3eExERXNNVjBzTUM0MU1qVTVNalU1TWpVNU1qVTVNalU1TERBdU5UUXhOalkyTmpZMk5qWTJOalkyTml3d0xEQXNXMTBzYm5Wc2JDeHVkV3hzTEc1MWJHd3NXeUlpTENJaVhWMHNNeklzTXpRc1d6SmRMRnRkTEZ0MGNuVmxMQ0poSWl3eUxIUnlkV1ZkWFN4Yld6RTBPU3cyTXpnc01Dd3hNelVzTVRJd0xEQXNNQ3hiTVN3eExERXNNVjBzTUM0MU1UZzFNVGcxTVRnMU1UZzFNVGcxTERBdU5UVXNNQ3d3TEZ0ZExHNTFiR3dzYm5Wc2JDeHVkV3hzTEZzaUlpd2lJbDFkTERNeUxETTFMRnN4WFN4YlhTeGJkSEoxWlN3aVlTSXNNQ3gwY25WbFhWMHNXMXMwT1N3MU1Dd3dMRGcxTGpJMU56YzVPRFk0T0RjMU9EUTJMRGcxTGpJMU56YzVPRFk0T0RjMU9EUTJMREFzTUN4Yk1Td3hMREVzTVYwc01DNDFMREF1TlN3d0xEQXNXMXQwY25WbFhWMHNiblZzYkN4dWRXeHNMRzUxYkd3c1d5SWlMQ0lpWFYwc01UUXNOamdzVzEwc1cxc3dMREFzTUN3d0xIUnlkV1ZkWFN4YmRISjFaU3dpUVc1cGJXRjBhVzl1SURFaUxESXNkSEoxWlYxZFhTeGJYU3d3TEhSeWRXVXNabUZzYzJVc1cxMWRMRnNpZDJsdUlpd3pMRE15TWpjd05UUXpNalEwTVRjM09TeDBjblZsTEZzNU5DdzVOQ3c1TkYwc2RISjFaU3d3TERBc01TeG1ZV3h6WlN4bVlXeHpaU3d3TERBc2RISjFaU3hiVzFzdE9Dd3RNVEFzTUN3eE16RXhMRGMwT1N3d0xEQXNXekVzTVN3eExEQXVOMTBzTUN3d0xEQXNNQ3hiWFN4dWRXeHNMRzUxYkd3c2JuVnNiQ3hiSWlJc0lpSmRYU3d6TUN3ME9TeGJYU3hiV3pBc01Dd3hMREVzZEhKMVpWMWRMRnQwY25WbExEQXNNU3d4TERBc01Dd3hMREVzTUN4bVlXeHpaU3d4TERFc01Td3dMakVzTUM0eFhWMHNXMXMyTXprdU5Td3lPVFVzTUN3MU5EVXNNakl5TERBc01DeGJNU3d4TERFc01WMHNNQzQwT1RjeU5EYzNNRFkwTWpJd01UZzBMREF1TWprM01qazNNamszTWprM01qazNNeXd3TERBc1cxMHNiblZzYkN4dWRXeHNMRzUxYkd3c1d5SWlMQ0lpWFYwc016Y3NORGdzVzEwc1cxMHNXM1J5ZFdVc0lrRnVhVzFoZEdsdmJpQXhJaXcxTEhSeWRXVmRYU3hiV3pVME9TdzFOeklzTUN3eE5UY3NNVFUzTERBc01DeGJNU3d4TERFc01WMHNNQzQxTERBdU5Td3dMREFzVzF0MGNuVmxYVjBzYm5Wc2JDeHVkV3hzTEc1MWJHd3NXeUlpTENJaVhWMHNNVFFzTlRBc1cxMHNXMXN5TERJc01Dd3dMR1poYkhObFhWMHNXM1J5ZFdVc0lrRnVhVzFoZEdsdmJpQXhJaXd4TEhSeWRXVmRYU3hiV3pjek1TdzFOeklzTUN3eE5UY3NNVFUzTERBc01DeGJNU3d4TERFc01WMHNNQzQxTERBdU5Td3dMREFzVzF0MGNuVmxYVjBzYm5Wc2JDeHVkV3hzTEc1MWJHd3NXeUlpTENJaVhWMHNNVFFzTlRFc1cxMHNXMXN5TERJc01Dd3dMR1poYkhObFhWMHNXM1J5ZFdVc0lrRnVhVzFoZEdsdmJpQXhJaXd3TEhSeWRXVmRYVjBzVzEwc01DeDBjblZsTEdaaGJITmxMRnRkWFYwc1cxdHVkV3hzTERBc05ETXNXMTBzVzEwc1d6RXdMREVzTVYxZFhTeGJYVjBzV3lKdFlXbHViV1Z1ZFNJc01USTRNQ3czTWpBc1ptRnNjMlVzWm1Gc2MyVXNNQzQxTERBdU5Td2lSVlpGVGxRZ2JXVnVkU0lzTXpJd05qUTNNelEzT0RVMU1qWTRMRnRiSW1KaFkydG5jbTkxYm1RaUxEQXNNekV3TXpVeE9UVXdPVGszTmpJMExIUnlkV1VzV3prMExEazBMRGswWFN4bVlXeHpaU3d3TERBc01TeG1ZV3h6WlN4bVlXeHpaU3d3TERBc2RISjFaU3hiVzFzd0xEQXNNQ3d4TWpnd0xEY3lNQ3d3TERBc1d6RXNNU3d4TERGZExEQXNNQ3d3TERBc1cxMHNiblZzYkN4dWRXeHNMRzUxYkd3c1d5SWlMQ0lpWFYwc01qUXNOVFFzVzEwc1cxc3dMREFzTVN3eExIUnlkV1ZkWFN4YmRISjFaU3d3TERFc01Td3dMREFzTVN3eExEQXNabUZzYzJVc01Td3hMREVzTUM0eExEQXVNVjFkTEZ0YkxUUXNOakk1TERBc01USTVNU3d4TURBc01Dd3dMRnN4TERFc01Td3hYU3d3TERBc01Dd3dMRnRkTEc1MWJHd3NiblZzYkN4dWRXeHNMRnNpSWl3aUlsMWRMREkyTERnNExGdGRMRnRiTUN3eExERXNNQ3gwY25WbFhWMHNXM1J5ZFdVc01Dd3hMREVzTUN3d0xERXNNU3d3TEdaaGJITmxMREVzTVN3eExEQXVNU3d3TGpGZFhWMHNXMTBzTUN4MGNuVmxMR1poYkhObExGdGRYU3hiSW0xbGJuVWlMREVzTnpBMU1EY3lOVFF4TURJM056QTVMSFJ5ZFdVc1d6azBMRGswTERrMFhTeDBjblZsTERBc01Dd3hMR1poYkhObExHWmhiSE5sTERBc01DeDBjblZsTEZ0Yld6WXpOU3d5TVRZc01DdzBPVEVzTWpnMkxEQXNNQ3hiTVN3eExERXNNVjBzTUM0ME56UTFOREUzTlRFMU1qYzBPVFE1TERBdU5qSTVNemN3TmpJNU16Y3dOakk1TkN3d0xEQXNXMTBzYm5Wc2JDeHVkV3hzTEc1MWJHd3NXeUlpTENJaVhWMHNNak1zTlRZc1cxMHNXMXMyTERBc05Td3dMREFzTUN3MUxEQXNkSEoxWlYwc1d6VXNNQ3cwTERBc01Dd3dMREl3TERBc2RISjFaVjFkTEZ0MGNuVmxMQ0pCYm1sdFlYUnBiMjRnTVNJc01DeDBjblZsWFYwc1cxczFNalVzTkRjeUxEQXNNVGN5TERFM01pd3dMREFzV3pFc01Td3hMREZkTERBdU5Td3dMalVzTUN3d0xGdGJkSEoxWlYxZExHNTFiR3dzYm5Wc2JDeHVkV3hzTEZzaUlpd2lJbDFkTERJMUxEVTRMRnRkTEZ0ZExGdDBjblZsTENKQmJtbHRZWFJwYjI0Z01TSXNNQ3gwY25WbFhWMHNXMXMzTlRVc05EY3lMREFzTVRjeUxERTNNaXd3TERBc1d6RXNNU3d4TERGZExEQXVOU3d3TGpVc01Dd3dMRnRiZEhKMVpWMWRMRzUxYkd3c2JuVnNiQ3h1ZFd4c0xGc2lJaXdpSWwxZExESTFMRFU1TEZ0ZExGdGRMRnQwY25WbExDSkJibWx0WVhScGIyNGdNU0lzTVN4MGNuVmxYVjBzVzFzeE1qTXpMRFUzTERBc09EVXVPREEwTXpJek1ETTVNekkzTkRFc09EVXVPREEwTXpJek1ETTVNekkzTkRFc01Dd3dMRnN4TERFc01Td3hYU3d3TGpVc01DNDFMREFzTUN4YlczUnlkV1ZkWFN4dWRXeHNMRnN4TWpjc1cxc3pNakEyTkRjek5EYzROVFV5Tmpnc01TdzVNeXd6TERBc01UQmRYU3cxWFN4dWRXeHNMRnNpSWl3aUlsMWRMREUwTERZM0xGdGRMRnRiTVN3d0xEQXNNQ3gwY25WbFhWMHNXM1J5ZFdVc0lrRnVhVzFoZEdsdmJpQXhJaXd6TEhSeWRXVmRYU3hiV3pVd0xEVTBMREFzT0RVdU1qVTNOems0TmpnNE56VTRORFlzT0RVdU1qVTNOems0TmpnNE56VTRORFlzTUN3d0xGc3hMREVzTVN3eFhTd3dMalVzTUM0MUxEQXNNQ3hiVzNSeWRXVmRYU3h1ZFd4c0xGc3hNamNzVzFzek1qQTJORGN6TkRjNE5UVXlOamdzTVN3NU1Td3hNamNzTUN3NVhWMHNObDBzYm5Wc2JDeGJJaUlzSWlKZFhTd3hOQ3c0TkN4YlhTeGJXekFzTUN3d0xEQXNkSEoxWlYxZExGdDBjblZsTENKQmJtbHRZWFJwYjI0Z01TSXNOaXgwY25WbFhWMHNXMXN4TkRJdU5EQTBNek13TlRneE5UVTJNU3d4TlRFdU5EYzBOemN4TXpJM05qTTBOaXd3TERFM05pdzROU3d3TERBc1d6RXNNU3d4TERGZExEQXVOU3d3TGpVc01Dd3dMRnRkTEc1MWJHd3NXekV5Tnl4dWRXeHNMRGRkTEc1MWJHd3NXeUlpTENJaVhWMHNOREVzT1RJc1cxMHNXMTBzVzNSeWRXVXNJa0Z1YVcxaGRHbHZiaUF4SWl3d0xHWmhiSE5sWFYwc1cxc3hNakF1TkRJMk1ETXpNemswTURBM05EVXNNVEUzTGpFNE5ERTVORFl5T1RFM01qZ3NNQ3d4TURjdU5UUTFORFUwTlRRMU5EVXpPRElzTVRJd0xqWXpOak0xT0RBNE56Y3hNamcwTERBc01DeGJNQ3d3TERFc01WMHNNQ3d3TERBc01DeGJXM1J5ZFdVc01WMHNXM1J5ZFdVc1d6QXNNQ3d4WFYxZExHNTFiR3dzV3pFeU55eHVkV3hzTERoZExHNTFiR3dzV3lJaUxDSWlYVjBzTml3NU1DeGJYU3hiV3pJc01Dd3dMREFzZEhKMVpWMWRMRnNpTUNJc2RISjFaU3cyTXl3M05Dd2lRVUpEUkVWR1IwaEpTa3RNVFU1UFVGRlNVMVJWVmxkWVdWcGhZbU5rWldabmFHbHFhMnh0Ym05d2NYSnpkSFYyZDNoNWVqQXhNak0wTlRZM09Ea3VMRHM2UHlFdFgzNGpYQ0luSmlncFcxMThZRnhjTDBEQ3NDczlLaVRDbytLQ3JEdyswSkRRa2RDUzBKUFFsTkNWMElIUWx0Q1gwSmpRbWRDYTBKdlFuTkNkMEo3UW45Q2cwS0hRb3RDajBLVFFwZENtMEtmUXFOQ3AwS3JRcTlDczBLM1FydEN2MExEUXNkQ3kwTFBRdE5DMTBaSFF0dEMzMExqUXVkQzYwTHZRdk5DOTBMN1F2OUdBMFlIUmd0R0QwWVRSaGRHRzBZZlJpTkdKMFlyUmk5R00wWTNSanRHUElpd2lJaXd4TERBc01Dd3dMREFzTUN4MGNuVmxMREFzWm1Gc2MyVmRYU3hiV3pVMExqazFNVE14TnpVeE1ETTNOalExTlN3eE5UQXVNRGszTXpZME9UYzVNalEzTVN3d0xEazJMalk1TXpVd05UVTRPRE0xTkRFekxEWXpMamN5T1RneE1EVXdNVFF4TlRJeUxEQXNNQ3hiTVN3eExERXNNVjBzTUM0MUxEQXVOU3d3TERBc1cxMHNiblZzYkN4Yk1USTNMRnRiTXpJd05qUTNNelEzT0RVMU1qWTRMREVzT1RBc01USTNMREFzT0Ywc1d6TXlNRFkwTnpNME56ZzFOVEkyT0N3eExEa3lMREV5Tnl3d0xEZGRYU3c1WFN4dWRXeHNMRnNpSWl3aUlsMWRMRFF3TERreExGdGRMRnRkTEZ0MGNuVmxMQ0pCYm1sdFlYUnBiMjRnTVNJc01DeG1ZV3h6WlYxZExGdGJNVEU1Tmk0eU56RTJORFUxTWpVeU1EWXlMREU0TUM0d09EUTBPVGsxTnpJM09USTVMREFzTVRNeUxEZzNMREFzTUN4Yk1Td3hMREVzTVYwc01DNDFMREF1TlN3d0xEQXNXMTBzYm5Wc2JDeGJNeXh1ZFd4c0xERXdYU3h1ZFd4c0xGc2lJaXdpSWwxZExEUXlMRGt6TEZ0ZExGdGJOaXd3TERFc01pdzFMRE1zTnl3M0xIUnlkV1ZkWFN4YmRISjFaU3dpUVc1cGJXRjBhVzl1SURFaUxEQXNkSEoxWlYxZFhTeGJYU3d3TEhSeWRXVXNabUZzYzJVc1cxMWRYU3hiWFN4YlhWMWRMRnRiSWtWV1JVNVVJR2RoYldVaUxGdGJNaXdpUlZaRlRsUWdkMmx1Wkc5M01TSXNabUZzYzJWZExGc3hMQ0pwYzNCc1lYbHBibWNpTERBc01DeG1ZV3h6WlN4bVlXeHpaU3cyTVRVd01qYzJOVEE0TlRreU1qQXNabUZzYzJVc05UbGRMRnN4TENKM2IzSnNaR2R5WVhacGRIa2lMREFzTWpBc1ptRnNjMlVzWm1Gc2MyVXNNVFV5TmpNMU5USTRNakkyT0RJeExHWmhiSE5sTERZd1hTeGJNeXhiZEhKMVpTd2lZM0psWVhSbGMyTmxibVVpWFN4bVlXeHpaU3h1ZFd4c0xERTNNekF5TkRJeU16UXpOREEwTlN3eExGdGJMVEVzTWpBc2JuVnNiQ3d3TEdaaGJITmxMR1poYkhObExHWmhiSE5sTERBc1ptRnNjMlVzVzFzeExGc3dYVjFkWFYwc1cxMHNXMXN3TERBc1ptRnNjMlVzYm5Wc2JDdzJNREkxTWpRMU56VXpNRFF4TWpBc01peGJXeTB4TERJeExHNTFiR3dzTUN4bVlXeHpaU3htWVd4elpTeG1ZV3h6WlN3NE1qazJOelEzTVRnME5EQTRPREVzYm5Wc2JGMWRMRnRiTFRFc01qSXNiblZzYkN3ek1URTVPRE13TWpBNU56STROakVzTUN4dWRXeHNMRnRiTlN4Yk1WMWRMRnN3TEZzeVhWMWRYU3hiTXpJc01qTXNiblZzYkN3M09EazFNemMwTWpFM05EY3pOakFzTUN4dWRXeHNMRnRiTXl3d1hTeGJNU3hiTTExZFhWMHNXekUwTERJekxHNTFiR3dzTWpFNE1EZzBNek15TWpjNE16RXlMREFzYm5Wc2JDeGJXek1zTUYwc1d6RXNXek5kWFYxZExGc3hNaXd5TkN4dWRXeHNMRE13TVRRNE1USTBPRE14TlRrNE1Td3dMRzUxYkd4ZExGc3pOaXd5TlN4dWRXeHNMREUzTnpFMU9ESTROelE0TmpBMk5Td3dMRzUxYkd4ZExGc3lOeXd5Tml4dWRXeHNMRE16T1RVM09UZ3lNRFEwTnpBME5Td3dMRzUxYkd3c1cxc3pMREJkWFYwc1d6STRMREkyTEc1MWJHd3NORGN3TlRFNE1qVTBOemczT0RRNUxEQXNiblZzYkN4Yld6TXNNRjFkWFN4Yk1qY3NNamNzYm5Wc2JDdzROakF6TWpBeU16ZzBPRGszTkRNc01DeHVkV3hzTEZ0Yk1DeGJOQ3hiTkN3eU9GMHNXelFzTWpsZFhWMWRYU3hiTWpjc016QXNiblZzYkN3NE9UQTRNakEzTlRVNE16WXlNekVzTUN4dWRXeHNMRnRiTUN4Yk5TeGJOQ3d5T0YxZFhWMWRYU3hiV3pBc01DeG1ZV3h6WlN4dWRXeHNMRFU0TXpVMk9EQXhOVFUzTXpnMk5pd3pMRnRiTWpnc016RXNiblZzYkN3d0xHWmhiSE5sTEdaaGJITmxMR1poYkhObExEazJNRFUzTkRFNU56TXdNakEzTkN4dWRXeHNMRnRiTVRBc01GMHNXemdzTUYwc1d6Y3NXekpkWFYxZFhTeGJXekk0TERJM0xHNTFiR3dzTnpneE1UWXpPRFl3TnpNek1EZ3lMREFzYm5Wc2JDeGJXekFzV3pVc1d6UXNNamxkWFYxZFhWMWRMRnN3TERBc1ptRnNjMlVzYm5Wc2JDd3pNelU0TXpnek9UTTFOVE0yTnpJc05DeGJXekk0TERNeExHNTFiR3dzTUN4bVlXeHpaU3htWVd4elpTeG1ZV3h6WlN3M05UUTJOekE1TmpVME1EWXhNRFVzYm5Wc2JDeGJXekV3TERCZExGczRMREJkTEZzM0xGczJYVjFkWFYwc1cxc3lPQ3d5Tnl4dWRXeHNMRGt5TlRreE1URTVNakF3TlRJME9Dd3dMRzUxYkd3c1cxc3dMRnMxTEZzMExESTRYVjFkWFYxZFhTeGJNQ3d3TEdaaGJITmxMRzUxYkd3c01UQTJOREl6T0RVME1UQXhNVGt3TERVc1cxc3RNU3d6TWl4dWRXeHNMREFzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzTXpVeE5EQXdNRFl3TURBNE1UTTRMRzUxYkd3c1cxc3hNU3d4TWpBeU5ERTFOemN6TkRrME5qSmRMRnM0TERCZExGczNMRnMyWFYxZFhWMHNXMTBzVzFzd0xEQXNabUZzYzJVc2JuVnNiQ3d5TXprNE5qVTROakExT0RVd05Ua3NOaXhiV3pNeUxETXpMRzUxYkd3c01DeG1ZV3h6WlN4bVlXeHpaU3gwY25WbExEUXhPVEkxT1RZeE1qZ3pOVEF5T0N4dWRXeHNMRnRiTUN4Yk4xMWRYVjFkTEZ0Yk16SXNNelFzYm5Wc2JDd3pORE0yTXprMk5qUXlPRGcwT0RJc01DeHVkV3hzTEZ0Yk15d3dYVjFkWFYwc1d6QXNNQ3htWVd4elpTeHVkV3hzTERZMk5qYzNPVFEyTlRBMU5UTTVPQ3czTEZ0Yk16SXNNek1zYm5Wc2JDd3dMR1poYkhObExHWmhiSE5sTEhSeWRXVXNNVGN4TVRNNU5EVXhPRGN6TVRFM0xHNTFiR3dzVzFzd0xGczRYVjFkWFYwc1cxc3pNaXd6TkN4dWRXeHNMRGd5TlRVek5qVTFNVFkxTWpjeU5Td3dMRzUxYkd3c1cxc3pMREJkWFYxZFhWMWRMRnN3TERBc1ptRnNjMlVzYm5Wc2JDd3pOVFkyTXprek5qZzFOalV6TXpFc09DeGJXeTB4TERNeUxHNTFiR3dzTUN4bVlXeHpaU3htWVd4elpTeG1ZV3h6WlN3Mk56TTVOakEzTWpFNU1UZzNOamdzYm5Wc2JDeGJXekV4TERFeU1ESTBNVFUzTnpNME9UUTJNbDBzV3pnc01GMHNXemNzV3pKZFhWMWRYU3hiWFN4Yld6QXNNQ3htWVd4elpTeHVkV3hzTERNMU56RTNOems1TXpBM09UZzNNeXc1TEZ0Yk16SXNNek1zYm5Wc2JDd3dMR1poYkhObExHWmhiSE5sTEhSeWRXVXNPRGM1TXpnMk16STVPVGN5T0RRd0xHNTFiR3dzVzFzd0xGczNYVjFkWFYwc1cxc3pNaXd6TkN4dWRXeHNMREUzTXpnMk16SXpNemN6TVRreE9Td3dMRzUxYkd3c1cxc3pMREZkWFYxZFhTeGJNQ3d3TEdaaGJITmxMRzUxYkd3c05qWXlOamN5T1RBNU5ETXdPVFl3TERFd0xGdGJNeklzTXpNc2JuVnNiQ3d3TEdaaGJITmxMR1poYkhObExIUnlkV1VzTXpZNE9USXdOemt3TlRjM01qRTJMRzUxYkd3c1cxc3dMRnM0WFYxZFhWMHNXMXN6TWl3ek5DeHVkV3hzTERFeE5Ua3lNRFF5TWpVeE1qUTVOaXd3TEc1MWJHd3NXMXN6TERGZFhWMWRYVjFkTEZzd0xEQXNabUZzYzJVc2JuVnNiQ3c0TURVM05qRXlOelExTWpNMU16VXNNVEVzVzFzdE1Td3pNaXh1ZFd4c0xEQXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNOak13TVRZMk5UZzFNRE0zT1RZMExHNTFiR3dzVzFzeE1Td3pOelUyTXpnMU5qY3dOemd4TURoZExGczRMREJkTEZzM0xGc3lYVjFkWFYwc1cxMHNXMXN3TERBc1ptRnNjMlVzYm5Wc2JDdzBNRFV4TlRNek5UTTJNVE0yT1RJc01USXNXMXN6Tml3ek15eHVkV3hzTERBc1ptRnNjMlVzWm1Gc2MyVXNkSEoxWlN3NU9UZzFPRGMyTlRFNU1Ea3dNelFzYm5Wc2JDeGJXekFzV3psZFhWMWRYU3hiV3pNMkxETTFMRzUxYkd3c09UazJNREkwTlRBNE1qZzFOams1TERBc2JuVnNiQ3hiV3pBc1d6SmRYVjFkWFYwc1d6QXNNQ3htWVd4elpTeHVkV3hzTERrNE56azNOekEyTkRVeE1ERTROQ3d4TXl4Yld6TTJMRE16TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4MGNuVmxMRGsxTWpFMU9UWTNPREV6T1RFek5DeHVkV3hzTEZ0Yk1DeGJNVEJkWFYxZFhTeGJXek0yTERNMUxHNTFiR3dzTkRnME1UZzNNak00TVRZd016VXlMREFzYm5Wc2JDeGJXekFzV3pFeFhWMWRYVjFkWFYwc1d6QXNNQ3htWVd4elpTeHVkV3hzTERrMk16RXlNamMwTnprMU1qQTBOU3d4TkN4Yld5MHhMRE15TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4bVlXeHpaU3cyTURFM016STFNemN6TnprM01USXNiblZzYkN4Yld6RXhMRE0zTlRZek9EVTJOekEzT0RFd09GMHNXemdzTUYwc1d6Y3NXelpkWFYxZFhTeGJXekUzTERNMkxHNTFiR3dzTVRJeU9EZzNNVEE0TWpFeE56QXpMREFzYm5Wc2JDeGJXekFzV3pFeVhWMWRYVjBzVzFzd0xEQXNabUZzYzJVc2JuVnNiQ3c0TVRnd01qSTFOekV4T1Rnd01UY3NNVFVzVzFzek5pd3pNeXh1ZFd4c0xEQXNabUZzYzJVc1ptRnNjMlVzZEhKMVpTdzJOek0yTWpjek5qTTRNelkwTVRNc2JuVnNiQ3hiV3pBc1d6bGRYVjFkWFN4Yld6TTJMRE0xTEc1MWJHd3NPRGMxTkRZeE9EZzNOekkxT0RnNUxEQXNiblZzYkN4Yld6QXNXelpkWFYxZFhWMHNXekFzTUN4bVlXeHpaU3h1ZFd4c0xEWXhPVE0yTnpJMU16TTBNRGN6TkN3eE5peGJXek0yTERNekxHNTFiR3dzTUN4bVlXeHpaU3htWVd4elpTeDBjblZsTERrNE1qUXpPVFUzT1RBNU9URXlNU3h1ZFd4c0xGdGJNQ3hiTVRCZFhWMWRYU3hiV3pNMkxETTFMRzUxYkd3c05qSTNOVEV4T0RZd05qWTJNemcxTERBc2JuVnNiQ3hiV3pBc1d6bGRYVjFkWFYxZFhTeGJNQ3d3TEdaaGJITmxMRzUxYkd3c01UTXhPVEV4TXpFeE56QTFNRFkxTERFM0xGdGJMVEVzTXpJc2JuVnNiQ3d3TEdaaGJITmxMR1poYkhObExHWmhiSE5sTERZek1EZzFNakkxTlRnNE5qRXlNU3h1ZFd4c0xGdGJNVEVzTXpjMU5qTTROVFkzTURjNE1UQTRYU3hiT0N3d1hTeGJOeXhiTVROZFhWMWRYU3hiV3pFM0xETTJMRzUxYkd3c016VXdOamN6TkRFMk56ZzROalk0TERBc2JuVnNiQ3hiV3pBc1d6RTBYVjFkWFYwc1cxc3dMREFzWm1Gc2MyVXNiblZzYkN3NE1UTXdOelEzTmpZME9EZzVOVEFzTVRnc1cxc3pOaXd6TXl4dWRXeHNMREFzWm1Gc2MyVXNabUZzYzJVc2RISjFaU3c1TURBek1EUXpNRGsyT1RNek56UXNiblZzYkN4Yld6QXNXemxkWFYxZFhTeGJXek0yTERNMUxHNTFiR3dzTWpJMk5qWXhNelE1T0RFeE5Ea3pMREFzYm5Wc2JDeGJXekFzV3pFelhWMWRYVjFkTEZzd0xEQXNabUZzYzJVc2JuVnNiQ3d6TVRRME1UY3dORFU1TXpVM09Ua3NNVGtzVzFzek5pd3pNeXh1ZFd4c0xEQXNabUZzYzJVc1ptRnNjMlVzZEhKMVpTd3lNRGcwTnpVNE16QTJOREU0TURRc2JuVnNiQ3hiV3pBc1d6RXdYVjFkWFYwc1cxc3pOaXd6TlN4dWRXeHNMRFU1TlRJMk1EZ3dOVEV6TURBM09Td3dMRzUxYkd3c1cxc3dMRnN4TlYxZFhWMWRYVjFkTEZzd0xEQXNabUZzYzJVc2JuVnNiQ3d4TXpBMU5UQTNOREk1TWpnNU5Ea3NNakFzVzFzMkxETTNMRzUxYkd3c01DeG1ZV3h6WlN4bVlXeHpaU3gwY25WbExEa3hNakF5TVRVME9ESTFOVGM1TkN4dWRXeHNMRnRiTUN4Yk1UVmRYVjFkWFN4Yld6WXNNemdzYm5Wc2JDdzBNelV5TmpRek1EQTRNakUwTWprc01DeHVkV3hzTEZ0Yk1DeGJNVFlzV3pRc01qaGRMRnMwTERJNVhWMWRMRnN3TEZzeE55eGJNU3cyTERNNUxHWmhiSE5sWFYxZFhWMWRYU3hiTUN3d0xHWmhiSE5sTEc1MWJHd3NORFl5TmpRNU5EWTNNalV3TURFMkxESXhMRnRiTml3ek55eHVkV3hzTERBc1ptRnNjMlVzWm1Gc2MyVXNkSEoxWlN3eE56VTFNVE0zTkRVNE1UTTRNelFzYm5Wc2JDeGJXekFzV3pFNFhWMWRYVjBzVzFzMkxETTRMRzUxYkd3c09ERTRORFk1TkRBeU1EQTRNRFkzTERBc2JuVnNiQ3hiV3pBc1d6RTVMRnMwTERJNFhTeGJOQ3d5T1YxZFhTeGJNQ3hiTVRjc1d6RXNOaXd6T1N4bVlXeHpaVjFkWFYxZFhWMHNXekFzTUN4bVlXeHpaU3h1ZFd4c0xETTRNamsyTXpNM09EYzJPRGM0Tnl3eU1peGJXellzTXpjc2JuVnNiQ3d3TEdaaGJITmxMR1poYkhObExIUnlkV1VzTlRjd09EWXhOVEF5T1RJNE5USXpMRzUxYkd3c1cxc3dMRnN5TUYxZFhWMWRMRnRiTml3ek9DeHVkV3hzTERZNE1qY3lPRFU0TlRFeU1USXlNQ3d3TEc1MWJHd3NXMXN3TEZzeU1TeGJOQ3d5T0Ywc1d6UXNNamxkWFYwc1d6QXNXekUzTEZzeExEWXNNemtzWm1Gc2MyVmRYVjFkWFYxZFhWMHNXekFzTUN4bVlXeHpaU3h1ZFd4c0xESTBORFEzTkRnMU16Z3hPRFF3TXl3eU55eGJXeTB4TERRd0xHNTFiR3dzTVN4bVlXeHpaU3htWVd4elpTeG1ZV3h6WlN3NU9UZzVNekk1T0RreE9ERTBNVGdzYm5Wc2JGMWRMRnRkWFN4Yk1Dd3dMR1poYkhObExHNTFiR3dzT0RFd01qTTVPVE14T0RRMk1UazJMREk0TEZ0Yk1qSXNOREVzYm5Wc2JDd3hMR1poYkhObExHWmhiSE5sTEdaaGJITmxMRFEzTkRneE5UYzFNek0zTWpZNE5DeHVkV3hzWFYwc1cxc3RNU3cwTWl4dWRXeHNMRFV3TkRjMk16WXpPRGsyTnpReU1pd3lOVFlzYm5Wc2JDeGJXelFzTkRSZExGczFMRnN5TWwxZExGc3dMRnN4Tnl4Yk1Td3lNaXcwTXl4bVlXeHpaVjFkWFN4Yk1DeGJNak1zV3pFc01qSXNORFFzWm1Gc2MyVmRYVjBzV3pFMkxHWmhiSE5sWFN4Yk1qQXNXekkwWFYxZFhTeGJMVEVzTkRVc2JuVnNiQ3d5TkRVNU16UXlOell6TWpjd016WXNNaXh1ZFd4c1hTeGJORFFzTkRZc2JuVnNiQ3cyTnpBeU9EZzBOakE1TkRRNU16a3NNU3h1ZFd4c0xGdGJOQ3d4TTEwc1d6TXNNVjFkWFN4Yk5EUXNORFlzYm5Wc2JDdzVOak01T0RreU1EQTROVEkxTURFc01TeHVkV3hzTEZ0Yk5Dd3pORjBzV3pNc01WMWRYU3hiTkRRc05EWXNiblZzYkN3eU56YzVOREU0T1RFNU1Ua3hOVFFzTVN4dWRXeHNMRnRiTkN3eU1sMHNXek1zTVYxZFhTeGJORFFzTkRjc2JuVnNiQ3d6TlRrMU5URTNNakl4TWpJME1ERXNNQ3h1ZFd4c0xGdGJOU3hiTWpWZFhWMWRMRnMwTkN3ME9DeHVkV3hzTERFeU5UZ3hOamd4T0RNME1UWXhOU3d3TEc1MWJHd3NXMXN4TUN3d1hTeGJOeXhiTWpZc1d6SXNNaklzWm1Gc2MyVXNNRjFkWFYxZExGczBOQ3cwT0N4dWRXeHNMRE0wTURZNU56UXhPRGM0TURFeU1Td3dMRzUxYkd3c1cxc3hNQ3d4WFN4Yk55eGJNamNzV3pJc01qSXNabUZzYzJVc01GMWRYVjFkTEZzdE1TdzBOU3h1ZFd4c0xETTVNRFk1TmpNek5qUTJOamt4T1N3eUxHNTFiR3hkWFN4Yld6QXNNQ3htWVd4elpTeHVkV3hzTERJeU5qa3lOVFUwTkRjMk56RXpOU3d5T1N4Yld6TXlMRFE1TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4bVlXeHpaU3cwTVRrM056TTNPVEkwTkRNM016a3NiblZzYkN4Yld6RXdMREJkTEZzNExEQmRMRnMzTEZzeU55eGJNaXcwTkN4bVlXeHpaU3d4WFYxZFhWMWRMRnRiTkRRc05UQXNiblZzYkN3ME16VTBPVEV6TkRVNU5URTROakVzTUN4dWRXeHNMRnRiTUN4Yk1qZ3NXekVzTXpJc05ETXNabUZzYzJWZFhWMHNXekFzV3pJNUxGc3hMRE15TERRMExHWmhiSE5sWFYxZFhWMHNXek15TERVeExHNTFiR3dzT1RReU5qazFNREUzTlRneE56VTFMREFzYm5Wc2JDeGJXelFzTkRSZExGc3hOaXgwY25WbFhTeGJNVFlzZEhKMVpWMHNXekUyTEhSeWRXVmRMRnN4Tml4MGNuVmxYU3hiTVRZc2RISjFaVjBzV3pFMkxHWmhiSE5sWFN4Yk1UWXNkSEoxWlYwc1d6RTJMSFJ5ZFdWZExGc3hOaXgwY25WbFhWMWRYVjFkWFN4Yk1Dd3dMR1poYkhObExHNTFiR3dzTmpReE1qVXpNekk1T1RJNE9ESXhMRE13TEZ0YkxURXNNeklzYm5Wc2JDd3dMR1poYkhObExHWmhiSE5sTEdaaGJITmxMRE14TXpnNE1ERTJNREUwTlRRd09TeHVkV3hzTEZ0Yk1URXNOREU0T1RBNU5Ea3pNVEExTnpZNVhTeGJPQ3d3WFN4Yk55eGJObDFkWFYxZExGdGRMRnRiTUN3d0xHWmhiSE5sTEc1MWJHd3NNelV5T1RJNE1UVXhOVFF6TWpnM0xETXhMRnRiTFRFc01qRXNiblZzYkN3d0xHWmhiSE5sTEdaaGJITmxMR1poYkhObExESTNOREV3T1RVNE1EVXpNemMxTUN4dWRXeHNYVjBzVzFzME5DdzFNaXh1ZFd4c0xEVXlPVE0wTVRZd01qYzBOelE0T0N3d0xHNTFiR3hkWFN4Yld6QXNNQ3htWVd4elpTeHVkV3hzTERjMU5EZzFPVGd3TlRNM09EQTVPU3d6TWl4Yld5MHhMRFV6TEc1MWJHd3NNQ3gwY25WbExHWmhiSE5sTEdaaGJITmxMRFV4TURBNE16UXlPRGMxTWpBNU55eHVkV3hzTEZ0Yk5Dd3lNbDFkWFYwc1cxc3RNU3cwTWl4dWRXeHNMREV4TVRnNE9ERTNOakkzT1RVd05Td3lOVFlzYm5Wc2JDeGJXelFzTkRSZExGczFMRnN5TWwxZExGc3dMRnN4Tnl4Yk1Td3lNaXcwTXl4bVlXeHpaVjFkWFN4Yk1DeGJNak1zV3pFc01qSXNORFFzWm1Gc2MyVmRYVjBzV3pFMkxHWmhiSE5sWFN4Yk1qQXNXekkwWFYxZFhTeGJMVEVzTkRVc2JuVnNiQ3cwTkRjeE16UTNNVFF5TWpZMU5qQXNNaXh1ZFd4c1hTeGJORFFzTkRZc2JuVnNiQ3cyTkRJd01qQTJNakF5TWpRNU1EQXNNU3h1ZFd4c0xGdGJOQ3d4TTEwc1d6TXNNVjFkWFN4Yk5EUXNORFlzYm5Wc2JDd3pNVE13TmpVNE9Ea3pOekl5T1RNc01TeHVkV3hzTEZ0Yk5Dd3pORjBzV3pNc01WMWRYU3hiTkRRc05EWXNiblZzYkN3eE16Z3lOall3TlRneU9UWTVOVFFzTVN4dWRXeHNMRnRiTkN3eU1sMHNXek1zTVYxZFhTeGJORFFzTkRjc2JuVnNiQ3cwTmpNeE1UUTFNek15TnpReU1qa3NNQ3h1ZFd4c0xGdGJOU3hiTWpWZFhWMWRMRnMwTkN3ME9DeHVkV3hzTERNeU56WTVOemMyTmpVeE5qUXdPU3d3TEc1MWJHd3NXMXN4TUN3d1hTeGJOeXhiTWpZc1d6SXNNaklzWm1Gc2MyVXNNRjFkWFYxZExGczBOQ3cwT0N4dWRXeHNMRFl4TmpZMU1qWXdOREUyTkRFek9Dd3dMRzUxYkd3c1cxc3hNQ3d4WFN4Yk55eGJNamNzV3pJc01qSXNabUZzYzJVc01GMWRYVjFkTEZzdE1TdzBOU3h1ZFd4c0xEZ3hNek0zTURjNE1qZ3pNelUyTXl3eUxHNTFiR3hkWFN4Yld6QXNNQ3htWVd4elpTeHVkV3hzTERJd05UY3pPVEF6TVRVM056Y3pNeXd6TXl4Yld6TXlMRFE1TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4bVlXeHpaU3cwT0RRM09UazJOamsyTWpVMk16Y3NiblZzYkN4Yld6RXdMREJkTEZzNExEQmRMRnMzTEZzeU55eGJNaXcwTkN4bVlXeHpaU3d4WFYxZFhWMWRMRnRiTkRRc05UQXNiblZzYkN3eE5ESTNOVFU1TkRZMU5qTTBNRFVzTUN4dWRXeHNMRnRiTUN4Yk1qZ3NXekVzTXpJc05ETXNabUZzYzJWZFhWMHNXekFzV3pJNUxGc3hMRE15TERRMExHWmhiSE5sWFYxZFhWMHNXek15TERVeExHNTFiR3dzT1RZMk16azVOakE1TmpZNU5UazFMREFzYm5Wc2JDeGJXelFzTkRSZExGc3hOaXgwY25WbFhTeGJNVFlzZEhKMVpWMHNXekUyTEhSeWRXVmRMRnN4Tml4MGNuVmxYU3hiTVRZc2RISjFaVjBzV3pFMkxHWmhiSE5sWFN4Yk1UWXNkSEoxWlYwc1d6RTJMSFJ5ZFdWZExGc3hOaXgwY25WbFhWMWRYVjFkWFYxZFhWMHNXekFzTUN4bVlXeHpaU3h1ZFd4c0xEazNOamc0TmpVek1USXpNelEzTUN3ek5DeGJXelEwTERVMExHNTFiR3dzTVN4bVlXeHpaU3htWVd4elpTeG1ZV3h6WlN3Mk1UWTFPRFEzT1RrM056RTROamdzYm5Wc2JGMWRMRnRkWFN4Yk1Dd3dMR1poYkhObExHNTFiR3dzTXpReE1qY3dNRFE0TURBek1EZzRMRE0xTEZ0Yk5ETXNOVFVzYm5Wc2JDd3dMR1poYkhObExHWmhiSE5sTEdaaGJITmxMRFUzTkRnM016WTBNelkyTlRJME9DeHVkV3hzTEZ0Yk1UQXNNRjBzV3pnc01GMHNXemNzV3pNd1hWMWRYVjBzVzFzME15dzFOaXh1ZFd4c0xETXdORFF5T1RZeE1ERXdNak0zTml3d0xHNTFiR3dzVzFzd0xGc3pNU3hiTkN3MU4xMWRYVjFkWFYxZFhTeGJNeXhiZEhKMVpTd2laMkZ0WlNKZExHWmhiSE5sTEc1MWJHd3NOREkxT1RJeU5UUTVPVFUzTURjeExETTJMRnRiTFRFc01qQXNiblZzYkN3d0xHWmhiSE5sTEdaaGJITmxMR1poYkhObExEQXNabUZzYzJVc1cxc3hMRnN5TWwxZFhWMWRMRnRkTEZ0Yk15eGJkSEoxWlN3aWQybDBhSEJqSUdKbGFHRjJhVzl5SWwwc1ptRnNjMlVzYm5Wc2JDdzVNakF3TXpJek9EZ3hOVEV5TXprc016Y3NXMXN0TVN3eU1DeHVkV3hzTERBc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc01DeG1ZV3h6WlN4Yld6RXNXek15WFYxZFhWMHNXMTBzVzFzeExDSm9hWFFpTERBc01DeG1ZV3h6WlN4bVlXeHpaU3d6TXpRNU56STJOVE0wT1RVMk16a3NabUZzYzJVc05qRmRMRnN4TENKb2FYUXlJaXd3TERBc1ptRnNjMlVzWm1Gc2MyVXNNVGsyTkRjM01EVTROelkwTXpnMkxHWmhiSE5sTERZeVhTeGJNQ3d3TEdaaGJITmxMRzUxYkd3c05URXpPRGN3TlRjM01qUTFNelF4TERNNExGdGJMVEVzTXpJc2JuVnNiQ3d3TEdaaGJITmxMR1poYkhObExHWmhiSE5sTERrMk5qRTFOemN3TWpJNU16YzVOQ3h1ZFd4c0xGdGJNVEVzTVRJd01qUXhOVGMzTXpRNU5EWXlYU3hiT0N3d1hTeGJOeXhiTmwxZFhWMHNXeTB4TERNeUxHNTFiR3dzTUN4bVlXeHpaU3htWVd4elpTeG1ZV3h6WlN3ek5qZzJPVEV4T1RReE5EazRPVFlzYm5Wc2JDeGJXekV4TERJNE1qYzBOekF3TVRFek1qTTNOMTBzV3pnc01GMHNXemNzV3paZFhWMWRYU3hiWFN4Yld6QXNNQ3htWVd4elpTeHVkV3hzTERjNU9UZzBPVGc0T0RFNE5EWTJOaXd6T1N4Yld5MHhMRFU0TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4bVlXeHpaU3czTXpFNU1qazROak0xTnpReU5qVXNiblZzYkN4Yld6QXNXelpkWFYxZFhTeGJXeTB4TERVNUxHNTFiR3dzTmpJeE9UTXpNekF3T0RVNE1qazBMREFzYm5Wc2JDeGJXekV4TERNNU16azNPVEExTXpjNE56azFNMTBzV3pjc1d6TXpMRnMwTERZd1hWMWRYVjBzV3kweExEVTVMRzUxYkd3c01UZ3lORFF4TnpneE1Ua3hNek0wTERBc2JuVnNiQ3hiV3pFeExEY3hOVFk0TXpRMU9UQTFOVEEwTlYwc1d6Y3NXek16TEZzMExEWXdYVjFkWFYxZFhTeGJNQ3d3TEdaaGJITmxMRzUxYkd3c09USXlORE13TmpZMU16TTFOalkxTERRd0xGdGJNVE1zTXpNc2JuVnNiQ3d3TEdaaGJITmxMR1poYkhObExIUnlkV1VzTmpZNU16TTBNREl3TWpNM01UQXpMRzUxYkd3c1cxc3dMRnN6TkYxZFhWMHNXeTB4TERZeExHNTFiR3dzTUN4bVlXeHpaU3htWVd4elpTeG1ZV3h6WlN3MU1qazROamM0TlRBeU9UUXpNRFVzYm5Wc2JDeGJXemNzV3pNMUxGc3hMREV6TERRekxHWmhiSE5sWFN4Yk1Td3hNeXcwTkN4bVlXeHpaVjBzV3pFc01USXNORE1zWm1Gc2MyVmRMRnN4TERFeUxEUTBMR1poYkhObFhWMWRMRnM0TEROZExGczNMRnN6TmwxZFhWMHNXeTB4TERVNExHNTFiR3dzTUN4bVlXeHpaU3htWVd4elpTeG1ZV3h6WlN3eU5qazNNamt5T0RneE5ETXhNVGtzYm5Wc2JDeGJXekFzV3pNM1hWMWRYU3hiTVRNc05qSXNiblZzYkN3d0xHWmhiSE5sTEdaaGJITmxMR1poYkhObExETTJNalk1TXpJNU5EWXpNVGt3Tml4dWRXeHNMRnRiT0N3MFhTeGJNQ3hiTXpnc1d6RXNNVGdzTmpNc1ptRnNjMlZkWFYxZFhWMHNXMXN0TVN3MU9TeHVkV3hzTERjd05UQTJORFV4TWpnNU1EZ3hPQ3d3TEc1MWJHd3NXMXN4TVN3ek16UTVOekkyTlRNME9UVTJNemxkTEZzM0xGczJYVjFkWFN4Yk1UTXNOalFzSWxCb2VYTnBZM01pTERJME1USXpOVEU1TWprNE5qVXpNU3d3TEc1MWJHd3NXMXN3TEZzek5sMWRMRnN3TEZzek9DeGJNU3d4TXl3Mk5TeG1ZV3h6WlYxZFhTeGJOeXhiTWwxZFhWMWRMRnRiTUN3d0xHWmhiSE5sTEc1MWJHd3NPREUxTnpjeU5UYzFOVEF6T0Rjd0xEUXhMRnRiTFRFc016SXNiblZzYkN3d0xHWmhiSE5sTEdaaGJITmxMR1poYkhObExEUTVOamd6TXpnNE1URTFOakUzT1N4dWRXeHNMRnRiTVRFc05EZzROVGsyTmpJeU56azBOak00WFN4Yk9Dd3dYU3hiTnl4Yk1sMWRYVjFkTEZ0Yk1TdzJOaXh1ZFd4c0xETTROekU1TmpVM01qRTFNVEEwT1N3d0xHNTFiR3dzVzFzeUxGc2lkSEpwWW5WdVpTSXNabUZzYzJWZFhTeGJNeXd3WFN4Yk1DeGJNbDFkTEZzd0xGc3lYVjBzV3pFc1d6STBYVjFkWFYxZExGc3dMREFzWm1Gc2MyVXNiblZzYkN3M01UazBNalEyTWprek56UTBNVFFzTkRJc1cxc3pOU3d6TXl4dWRXeHNMREFzWm1Gc2MyVXNabUZzYzJVc2RISjFaU3czTnpZME1UVTBOVFEzT0RneU16a3NiblZzYkN4Yld6QXNXek01WFYxZFhWMHNXMXN6TlN3Mk5Dd2lVR2g1YzJsamN5SXNNalEyTVRJeE1UazBPRGMzTURBMkxEQXNiblZzYkN4Yld6QXNXek01WFYwc1d6QXNXelF3TEZzeExETTFMRFkxTEdaaGJITmxYVjFkTEZzM0xGczJYVjFkWFYxZFhWMHNXekFzTUN4bVlXeHpaU3h1ZFd4c0xEUTBNelk0TmpBeU9USXhNVEV5TkN3ME15eGJXekV6TERNekxHNTFiR3dzTUN4bVlXeHpaU3htWVd4elpTeDBjblZsTERJeE9UUTVPVE01TWprMU1qZ3lOeXh1ZFd4c0xGdGJNQ3hiTkRGZFhWMWRMRnN0TVN3Mk1TeHVkV3hzTERBc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc01qVXdNVEV3T0RNNE5qZ3lPVGt5TEc1MWJHd3NXMXMzTEZzek5TeGJNU3d4TXl3ME15eG1ZV3h6WlYwc1d6RXNNVE1zTkRRc1ptRnNjMlZkTEZzeExERXlMRFF6TEdaaGJITmxYU3hiTVN3eE1pdzBOQ3htWVd4elpWMWRYU3hiT0N3elhTeGJOeXhiTXpaZFhWMWRMRnN0TVN3MU9DeHVkV3hzTERBc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc01qazFNRGN5TURBeU9EVTJOamt4TEc1MWJHd3NXMXN3TEZzek4xMWRYVjBzV3pFekxEWXlMRzUxYkd3c01DeG1ZV3h6WlN4bVlXeHpaU3htWVd4elpTdzVOelkyTWpVeU16QXdPRGMyT1RZc2JuVnNiQ3hiV3pnc05GMHNXekFzV3pNNExGc3hMREU0TERZekxHWmhiSE5sWFYxZFhWMWRMRnRiTFRFc05Ua3NiblZzYkN3ek5UUTFPVFEyTXpjNU9EazFNVGNzTUN4dWRXeHNMRnRiTVRFc01UazJORGMzTURVNE56WTBNemcyWFN4Yk55eGJObDFkWFYwc1d6RXpMRFkwTENKUWFIbHphV056SWl3Mk9UUXlOekV5TWpNMU56UTNNekVzTUN4dWRXeHNMRnRiTUN4Yk16WmRYU3hiTUN4Yk16Z3NXekVzTVRNc05qVXNabUZzYzJWZFhWMHNXemNzV3pKZFhWMWRYU3hiV3pBc01DeG1ZV3h6WlN4dWRXeHNMREUxTnpVMU5EZ3pNamswTnpNNU15dzBOQ3hiV3kweExETXlMRzUxYkd3c01DeG1ZV3h6WlN4bVlXeHpaU3htWVd4elpTdzROamN6TXpRNE1UZzRNVFkxTlRBc2JuVnNiQ3hiV3pFeExEUTRPRFU1TmpZeU1qYzVORFl6T0Ywc1d6Z3NNRjBzV3pjc1d6SmRYVjFkWFN4Yld6RXNOallzYm5Wc2JDdzBPVEk0TnpRM05EVTNNalV4TWpRc01DeHVkV3hzTEZ0Yk1peGJJblJ5YVdKMWJtVWlMR1poYkhObFhWMHNXek1zTUYwc1d6QXNXekpkWFN4Yk1DeGJNbDFkTEZzeExGc3lORjFkWFYxZFhTeGJNQ3d3TEdaaGJITmxMRzUxYkd3c01qVTNOemsyTlRBd05UTTFNelE0TERRMUxGdGJNelVzTXpNc2JuVnNiQ3d3TEdaaGJITmxMR1poYkhObExIUnlkV1VzTVRZek9UY3dPVFk1TmpJd09EazBMRzUxYkd3c1cxc3dMRnMwTWwxZFhWMWRMRnRiTXpVc05qUXNJbEJvZVhOcFkzTWlMRGM0TlRBeE1qYzBNVGsyTURNeU5Td3dMRzUxYkd3c1cxc3dMRnN6T1YxZExGc3dMRnMwTUN4Yk1Td3pOU3cyTlN4bVlXeHpaVjFkWFN4Yk55eGJObDFkWFYxZFhWMWRMRnN3TERBc1ptRnNjMlVzYm5Wc2JDdzVORFE0TVRRMk1qVXpNRFkyTmpVc05EWXNXMXN0TVN3MU9DeHVkV3hzTERBc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc016STBORFkxTXpFeE9EZzBNRE0zTEc1MWJHd3NXMXN3TEZzME15eGJNeXd6T1RNNU56a3dOVE0zT0RjNU5UTmRYVjFkWFN4YkxURXNNeklzYm5Wc2JDd3dMR1poYkhObExHWmhiSE5sTEdaaGJITmxMRFkzT1RReE1EUXdNRFV6TXpnek1DeHVkV3hzTEZ0Yk1URXNNek0wT1RjeU5qVXpORGsxTmpNNVhTeGJPQ3d3WFN4Yk55eGJNbDFkWFYxZExGdGRMRnRiTUN3d0xHWmhiSE5sTEc1MWJHd3NNelUxTVRRNE5EWTBNekV5TkRZMUxEUTNMRnRiTVRNc016TXNiblZzYkN3d0xHWmhiSE5sTEdaaGJITmxMSFJ5ZFdVc05qY3pPREl6TnpBNU1UTTNNVGs1TEc1MWJHd3NXMXN3TEZzek5GMWRYVjBzV3pFekxEWXlMRzUxYkd3c01DeG1ZV3h6WlN4bVlXeHpaU3htWVd4elpTd3pOakk0TlRrNE1qUTRNVEV5TXpZc2JuVnNiQ3hiV3pnc05GMHNXekFzV3pNNExGc3hMREU0TERZekxHWmhiSE5sWFYxZFhWMWRMRnRiTVRNc05qUXNJbEJvZVhOcFkzTWlMRFV6TVRNeU9EVTVNekF6TVRRd01pd3dMRzUxYkd3c1cxc3dMRnN6TmwxZExGc3dMRnN6T0N4Yk1Td3hNeXcyTlN4bVlXeHpaVjFkWFN4Yk55eGJNbDFkWFYxZExGdGJNQ3d3TEdaaGJITmxMRzUxYkd3c05qazBOakE1TmpjNE16WTRORGN5TERRNExGdGJMVEVzTXpJc2JuVnNiQ3d3TEdaaGJITmxMR1poYkhObExHWmhiSE5sTERNeU5USXhNak01TkRjMk5UVXdNeXh1ZFd4c0xGdGJNVEVzTkRnNE5UazJOakl5TnprME5qTTRYU3hiT0N3d1hTeGJOeXhiTWwxZFhWMWRMRnRiTVN3Mk5peHVkV3hzTERNMU5EVXlNVEkzTWpjeU56TXdOaXd3TEc1MWJHd3NXMXN5TEZzaWRISnBZblZ1WlNJc1ptRnNjMlZkWFN4Yk15d3dYU3hiTUN4Yk1sMWRMRnN3TEZzeVhWMHNXekVzV3pJMFhWMWRYVjFkWFYwc1d6QXNNQ3htWVd4elpTeHVkV3hzTERZME1UVXlOekU1T1RBd01qVTNOaXcwT1N4Yld6TTFMRE16TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4MGNuVmxMREkyTXpJMU16UTRNVFl5TWpjd05DeHVkV3hzTEZ0Yk1DeGJNemxkWFYxZFhTeGJXek0xTERZMExDSlFhSGx6YVdOeklpdzBOVEE0TkRReU5qTXpNVEUxTWpFc01DeHVkV3hzTEZ0Yk1DeGJNemxkWFN4Yk1DeGJOREFzV3pFc016VXNOalVzWm1Gc2MyVmRYVjBzV3pjc1d6WmRYVjFkWFYxZFhTeGJNQ3d3TEdaaGJITmxMRzUxYkd3c09EZ3lNVFkxTWpnM09URTNORFE1TERVd0xGdGJMVEVzTlRnc2JuVnNiQ3d3TEdaaGJITmxMR1poYkhObExHWmhiSE5sTERRek9UYzJOelF6TVRVeU5qZzJNaXh1ZFd4c0xGdGJNQ3hiTkRNc1d6TXNOekUxTmpnek5EVTVNRFUxTURRMVhWMWRYVjBzV3kweExETXlMRzUxYkd3c01DeG1ZV3h6WlN4bVlXeHpaU3htWVd4elpTdzBNelkzTnpNMU5qWXdOamczTkRJc2JuVnNiQ3hiV3pFeExERTVOalEzTnpBMU9EYzJORE00Tmwwc1d6Z3NNRjBzV3pjc1d6SmRYVjFkWFN4YlhTeGJXekFzTUN4bVlXeHpaU3h1ZFd4c0xEVTFOakkxT0Rnek56SXpPRFF4T0N3MU1TeGJXekV6TERNekxHNTFiR3dzTUN4bVlXeHpaU3htWVd4elpTeDBjblZsTERnNE9UVTRPREF6T1RNd01qUTBNeXh1ZFd4c0xGdGJNQ3hiTkRGZFhWMWRMRnN4TXl3Mk1peHVkV3hzTERBc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc09EUTNOVFl6TnpjMU1qVTNOelUxTEc1MWJHd3NXMXM0TERSZExGc3dMRnN6T0N4Yk1Td3hPQ3cyTXl4bVlXeHpaVjFkWFYxZFhTeGJXekV6TERZMExDSlFhSGx6YVdOeklpdzBOak0xT1RFNE1UVTFNalU0TmpVc01DeHVkV3hzTEZ0Yk1DeGJNelpkWFN4Yk1DeGJNemdzV3pFc01UTXNOalVzWm1Gc2MyVmRYVjBzV3pjc1d6SmRYVjFkWFN4Yld6QXNNQ3htWVd4elpTeHVkV3hzTERNMU1UQTBNVGt4TVRRek5qa3lNeXcxTWl4Yld5MHhMRE15TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4bVlXeHpaU3czTURNMU5UUTBNVGN6T1RJd01UVXNiblZzYkN4Yld6RXhMRFE0T0RVNU5qWXlNamM1TkRZek9GMHNXemdzTUYwc1d6Y3NXekpkWFYxZFhTeGJXekVzTmpZc2JuVnNiQ3cwT0RJMk1UQTRNak0xT0RnMk16WXNNQ3h1ZFd4c0xGdGJNaXhiSW5SeWFXSjFibVVpTEdaaGJITmxYVjBzV3pNc01GMHNXekFzV3pKZFhTeGJNQ3hiTWwxZExGc3hMRnN5TkYxZFhWMWRYVjFkTEZzd0xEQXNabUZzYzJVc2JuVnNiQ3d5TWpnNE9EWTVOems0TkRFME9UUXNOVE1zVzFzek5Td3pNeXh1ZFd4c0xEQXNabUZzYzJVc1ptRnNjMlVzZEhKMVpTdzVNVGc0TmpVMk5qYzJOVEV6TWprc2JuVnNiQ3hiV3pBc1d6UXlYVjFkWFYwc1cxc3pOU3cyTkN3aVVHaDVjMmxqY3lJc09EWXpNemN3TnpReU5Ea3lNell3TERBc2JuVnNiQ3hiV3pBc1d6TTVYVjBzV3pBc1d6UXdMRnN4TERNMUxEWTFMR1poYkhObFhWMWRMRnMzTEZzMlhWMWRYVjFkWFYxZFhWMWRMRnN6TEZ0MGNuVmxMQ0p3YUhsemFXTWlYU3htWVd4elpTeHVkV3hzTERFME9ETXhNVFEyTlRJd016SXpOQ3cxTkN4Yld5MHhMREl3TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4bVlXeHpaU3d3TEdaaGJITmxMRnRiTVN4Yk5EUmRYVjFkWFN4YlhTeGJXekFzTUN4bVlXeHpaU3h1ZFd4c0xEazJOalkzTkRneU9ETXhOemczTlN3MU5TeGJXekU0TERZM0xDSlFhSGx6YVdOeklpd3dMR1poYkhObExHWmhiSE5sTEdaaGJITmxMRFEyT1RrNE1qUTVPVEl4TVRJd01TeHVkV3hzWFN4Yk1UTXNOaklzYm5Wc2JDd3dMR1poYkhObExHWmhiSE5sTEdaaGJITmxMRFExTURjNE1ESXdNREEzTkRrNU55eHVkV3hzTEZ0Yk9DdzBYU3hiTUN4Yk16Z3NXekVzTVRnc05qTXNabUZzYzJWZFhWMWRYVjBzVzFzeE15dzJPQ3dpVUdoNWMybGpjeUlzT1RrNE5Ea3hORGN5TnprMU9UZ3lMREFzYm5Wc2JDeGJXekFzV3pKZFhTeGJNQ3hiTkRWZFhTeGJOeXhiTVROZFhWMWRYVjBzV3pBc01DeG1ZV3h6WlN4dWRXeHNMREkwTkRBNE1qQTRORGMxTnpJeU15dzFOaXhiV3pFNExEWTNMQ0pRYUhsemFXTnpJaXd3TEdaaGJITmxMR1poYkhObExHWmhiSE5sTERVM05UVTRPVFkxTkRZd05qUXdNeXh1ZFd4c1hTeGJNVE1zTmprc2JuVnNiQ3d3TEdaaGJITmxMR1poYkhObExHWmhiSE5sTERZM01URTBNRFE0TkRnNE5UZzNOaXh1ZFd4c0xGdGJNQ3hiTkRaZFhTeGJNQ3hiTVRSZFhWMWRMRnN4TXl3Mk1peHVkV3hzTERBc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc01qUXlOVGt4TmprMk5UVXlOemt6TEc1MWJHd3NXMXM0TERSZExGc3dMRnN6T0N4Yk1Td3hPQ3cyTXl4bVlXeHpaVjFkWFYxZFhTeGJXekV6TERjd0xDSlFhSGx6YVdOeklpdzJOekV6TVRjMU5qQTNNVE16TmpBc01DeHVkV3hzTEZ0Yk1DeGJORGNzV3pFc01UTXNOalVzWm1Gc2MyVmRYVjBzV3pBc1d6RTNMRnN4TERFekxEWTFMR1poYkhObFhWMWRMRnMzTEZzMlhWMWRYVjFkTEZzd0xEQXNabUZzYzJVc2JuVnNiQ3cxTmpFNE9EQXpNekF6TmpRek1UWXNOVGNzVzFzeE9DdzJOeXdpVUdoNWMybGpjeUlzTUN4bVlXeHpaU3htWVd4elpTeG1ZV3h6WlN3M01ESTNNelUyTlRjd09UUTBPREVzYm5Wc2JGMHNXekV6TERZNUxHNTFiR3dzTUN4bVlXeHpaU3htWVd4elpTeG1ZV3h6WlN3eU5qUXdPVGs0T1RZME16RTNNRGdzYm5Wc2JDeGJXekFzV3pRMlhWMHNXekFzV3pFeVhWMWRYU3hiTVRNc05qSXNiblZzYkN3d0xHWmhiSE5sTEdaaGJITmxMR1poYkhObExEY3lORFl3TlRJNU9ERTNPVGsxTUN4dWRXeHNMRnRiT0N3MFhTeGJNQ3hiTXpnc1d6RXNNVGdzTmpNc1ptRnNjMlZkWFYxZFhWMHNXMXN4TXl3M01Dd2lVR2g1YzJsamN5SXNNakl4TXpneE5qYzFOVE0wT0Rrd0xEQXNiblZzYkN4Yld6QXNXelE0TEZzeExERXpMRFkxTEdaaGJITmxYVjFkTEZzd0xGc3hOeXhiTVN3eE15dzJOU3htWVd4elpWMWRYU3hiTnl4Yk5sMWRYVjFkWFN4Yk1Dd3dMR1poYkhObExHNTFiR3dzTXpJM01EVTNNelV3TURZMk5qTXdMRFU0TEZ0Yk1UZ3NOamNzSWxCb2VYTnBZM01pTERBc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc056TTBPREE0TkRRNE9UTXhNamMwTEc1MWJHeGRMRnN4TXl3Mk9TeHVkV3hzTERBc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc056SXpNall5TWpVd05EazJNall6TEc1MWJHd3NXMXN3TEZzek9WMWRMRnN3TEZzME9WMWRYVjBzV3pFekxEWXlMRzUxYkd3c01DeG1ZV3h6WlN4bVlXeHpaU3htWVd4elpTd3pOak0wTWpFME5qSTNPRFl5TmpZc2JuVnNiQ3hiV3pnc05GMHNXekFzV3pNNExGc3hMREU0TERZekxHWmhiSE5sWFYxZFhWMWRMRnRiTVRNc056QXNJbEJvZVhOcFkzTWlMREkxTlRFeU5UTXdOekl3TnpjMk5Td3dMRzUxYkd3c1cxc3dMRnMxTUN4Yk1Td3hNeXcyTlN4bVlXeHpaVjFkWFN4Yk1DeGJOREFzV3pFc01UTXNOalVzWm1Gc2MyVmRYVjBzV3pjc1d6WmRYVjFkWFYwc1d6QXNNQ3htWVd4elpTeHVkV3hzTERRek56TTNOalF6TmpFM05EYzJNU3cxT1N4Yld6RTRMRFkzTENKUWFIbHphV056SWl3d0xHWmhiSE5sTEdaaGJITmxMR1poYkhObExEWXpOREEyT1RBek1qTTNNRFEyTXl4dWRXeHNYU3hiTVRNc05qa3NiblZzYkN3d0xHWmhiSE5sTEdaaGJITmxMR1poYkhObExERXlPREV4TlRRNE5UUXlOREF6Tnl4dWRXeHNMRnRiTUN4Yk5URmRYU3hiTUN4Yk5EbGRYVjFkTEZzeE15dzJNaXh1ZFd4c0xEQXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNOekUxTnpVd016UXpNekU0TVRReUxHNTFiR3dzVzFzNExEUmRMRnN3TEZzek9DeGJNU3d4T0N3Mk15eG1ZV3h6WlYxZFhWMWRYU3hiV3pFekxEY3dMQ0pRYUhsemFXTnpJaXd5TlRZM056WTROVGt5TkRZM09URXNNQ3h1ZFd4c0xGdGJNQ3hiTlRJc1d6RXNNVE1zTmpVc1ptRnNjMlZkWFYwc1d6QXNXelF3TEZzeExERXpMRFkxTEdaaGJITmxYVjFkTEZzM0xGczJYVjFkWFYxZExGc3dMREFzWm1Gc2MyVXNiblZzYkN3ME5EQXdORFV5TVRrNE1UQTFNakVzTmpBc1cxc3RNU3d6TWl4dWRXeHNMREFzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzTmpjME1UVTJNekEyTmpjMU9URXdMRzUxYkd3c1cxc3hNU3d5T0RJM05EY3dNREV4TXpJek56ZGRMRnM0TERCZExGczNMRnMyWFYxZFhWMHNXMTBzVzFzd0xEQXNabUZzYzJVc2JuVnNiQ3cyTXpZd01ESXdPREk0T0RJMk5qY3NOakVzVzFzdE1Td3pNaXh1ZFd4c0xEQXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNNakEyTmprMU5ERTVNelEwT0RVNExHNTFiR3dzVzFzeE1Td3lPRFF5TWpJek9URXdORGMzT0RKZExGczRMREJkTEZzM0xGc3lYVjFkWFYwc1cxMHNXMXN3TERBc1ptRnNjMlVzYm5Wc2JDdzVORGN3TURNNU9UTXhNRE0yTURBc05qSXNXMXMwTERjeExHNTFiR3dzTVN4bVlXeHpaU3htWVd4elpTeG1ZV3h6WlN3ek5URTNOakl3TlRrMU1ERTNPVE1zYm5Wc2JDeGJXemtzTmpWZFhWMHNXek15TERNekxHNTFiR3dzTUN4bVlXeHpaU3htWVd4elpTeDBjblZsTERNMU5qYzNNakV5TnpZd01EVTNPU3h1ZFd4c0xGdGJNQ3hiTlROZFhWMWRYU3hiWFN4Yld6QXNNQ3htWVd4elpTeHVkV3hzTERrd09UY3hNREV6TlRBeE9UUXlNQ3cyTXl4Yld6RXpMRE16TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4MGNuVmxMRFEwTmpjNU9Ea3hNRGsxTVRBNE5TeHVkV3hzTEZ0Yk1DeGJOVFJkWFYxZExGc3hNeXcyTWl4dWRXeHNMREFzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzTWpVeU16TTBOVFk1TVRBeU9EZ3lMRzUxYkd3c1cxczRMRFJkTEZzd0xGc3pPQ3hiTVN3eE9DdzJNeXhtWVd4elpWMWRYVjFkWFN4Yld6RXpMRFkwTENKUWFIbHphV056SWl3NU9ERXhNekF5TVRBME1qWTNPRE1zTUN4dWRXeHNMRnRiTUN4Yk16WmRYU3hiTUN4Yk16Z3NXekVzTVRNc05qVXNabUZzYzJWZFhWMHNXemNzV3pKZFhWMWRYU3hiV3pBc01DeG1ZV3h6WlN4dWRXeHNMREk1TURrMk9UQXpOemc0T1RZeU1DdzJOQ3hiV3kweExETXlMRzUxYkd3c01DeG1ZV3h6WlN4bVlXeHpaU3htWVd4elpTdzROamM0TlRNeU1Ea3lNRE13TlRRc2JuVnNiQ3hiV3pFeExEUTRPRFU1TmpZeU1qYzVORFl6T0Ywc1d6Z3NNRjBzV3pjc1d6SmRYVjFkWFN4Yld6RXNOallzYm5Wc2JDdzNNRGcwTlRReU1USXdPRE16TWpVc01DeHVkV3hzTEZ0Yk1peGJJblJ5YVdKMWJtVWlMR1poYkhObFhWMHNXek1zTUYwc1d6QXNXekpkWFN4Yk1DeGJNbDFkTEZzeExGc3lORjFkWFYxZFhWMWRMRnN3TERBc1ptRnNjMlVzYm5Wc2JDdzNOVGsyT1RVd056YzBNREl3TVRjc05qVXNXMXN6TlN3ek15eHVkV3hzTERBc1ptRnNjMlVzWm1Gc2MyVXNkSEoxWlN3ek5USTJNVGt5TnpFME5UUXlNREVzYm5Wc2JDeGJXekFzV3pVMVhWMWRYVjBzVzFzek5TdzJOQ3dpVUdoNWMybGpjeUlzTWpNNU1EWTNNVFl5TlRNeU1qRTBMREFzYm5Wc2JDeGJXekFzV3pNNVhWMHNXekFzV3pFM0xGc3hMRE0xTERZMUxHWmhiSE5sWFYxZExGczNMRnMyWFYxZFhWMWRMRnN3TERBc1ptRnNjMlVzYm5Wc2JDdzJOelkzTXprME16TTVNell4TVRnc05qWXNXMTBzVzFzek1pd3pOU3h1ZFd4c0xEZ3pOelV4TmpJMU5USTFNakEzTUN3d0xHNTFiR3dzVzFzd0xGczJYVjFkWFN4YkxURXNOeklzYm5Wc2JDd3lNalE0T1RjNU5Ea3hOamc0T0RRc01peHVkV3hzTEZ0Yk1DeGJOVFpkWFYxZExGc3pNaXd6TlN4dWRXeHNMRFExT0RFM05qTTBORGs1TmpNME5Dd3dMRzUxYkd3c1cxc3dMRnN5WFYxZFhWMWRYVjBzV3pBc01DeG1ZV3h6WlN4dWRXeHNMREl3TVRFM05qSTFOVFF6TkRjd09DdzJOeXhiV3pRc056RXNiblZzYkN3eExHWmhiSE5sTEdaaGJITmxMR1poYkhObExEZ3lOakF6TXpVM01Ua3lNVFE0TUN4dWRXeHNMRnRiT1N3Mk9GMWRYU3hiTXpJc016TXNiblZzYkN3d0xHWmhiSE5sTEdaaGJITmxMSFJ5ZFdVc056TXhNekF6TURreE1UQXhOakk1TEc1MWJHd3NXMXN3TEZzMU4xMWRYVjFkTEZ0ZExGdGJNQ3d3TEdaaGJITmxMRzUxYkd3c09UTXpOek0yTkRrMU1qWTNNelF3TERZNExGdGJNVE1zTXpNc2JuVnNiQ3d3TEdaaGJITmxMR1poYkhObExIUnlkV1VzTmpBd05qQTBNREl5TkRFeE5UQXhMRzUxYkd3c1cxc3dMRnMxT0YxZFhWMHNXekV6TERZeUxHNTFiR3dzTUN4bVlXeHpaU3htWVd4elpTeG1ZV3h6WlN3NU1UazNNams1TURjMU1UVTRNekFzYm5Wc2JDeGJXemdzTkYwc1d6QXNXek00TEZzeExERTRMRFl6TEdaaGJITmxYVjFkWFYxZExGdGJNVE1zTmpRc0lsQm9lWE5wWTNNaUxEazJNemt5TXpjd01qTTVNalF4TkN3d0xHNTFiR3dzVzFzd0xGc3pObDFkTEZzd0xGc3pPQ3hiTVN3eE15dzJOU3htWVd4elpWMWRYU3hiTnl4Yk1sMWRYVjFkTEZ0Yk1Dd3dMR1poYkhObExHNTFiR3dzTVRNNE56WTNOekF5TkRRek9UVXlMRFk1TEZ0YkxURXNNeklzYm5Wc2JDd3dMR1poYkhObExHWmhiSE5sTEdaaGJITmxMRE0yT0RZMU16TTJNalk1TVRFd01peHVkV3hzTEZ0Yk1URXNORGc0TlRrMk5qSXlOemswTmpNNFhTeGJPQ3d3WFN4Yk55eGJNbDFkWFYxZExGdGJNU3cyTml4dWRXeHNMREl3TURFeE5UVXlOVE15TVRBNU1Dd3dMRzUxYkd3c1cxc3lMRnNpZEhKcFluVnVaU0lzWm1Gc2MyVmRYU3hiTXl3d1hTeGJNQ3hiTWwxZExGc3dMRnN5WFYwc1d6RXNXekkwWFYxZFhWMWRYVjBzV3pBc01DeG1ZV3h6WlN4dWRXeHNMRFl5TWpFeE5UVXpOREV4TmpjME9TdzNNQ3hiV3pNMUxETXpMRzUxYkd3c01DeG1ZV3h6WlN4bVlXeHpaU3gwY25WbExETXdNVEV3TkRjMU16STBNems0TkN4dWRXeHNMRnRiTUN4Yk5UbGRYVjFkWFN4Yld6TTFMRFkwTENKUWFIbHphV056SWl3M01qWTJNVGd6TURZMk5UWTFOREFzTUN4dWRXeHNMRnRiTUN4Yk16bGRYU3hiTUN4Yk1UY3NXekVzTXpVc05qVXNabUZzYzJWZFhWMHNXemNzV3paZFhWMWRYVjBzV3pBc01DeG1ZV3h6WlN4dWRXeHNMRE16T0RFeE5UTTBNVGc1TnpBMU1TdzNNU3hiWFN4Yld6TXlMRE0xTEc1MWJHd3NOek0zTWpZek5qTTJPVFV5TWpjd0xEQXNiblZzYkN4Yld6QXNXekV4WFYxZFhTeGJMVEVzTnpJc2JuVnNiQ3cyT1RZME1UWTVNekl6T1RVMk1EZ3NNaXh1ZFd4c0xGdGJNQ3hiTlRaZFhWMWRMRnN6TWl3ek5TeHVkV3hzTERnMU9EZzROalUwTnpBMU9UTTVNaXd3TEc1MWJHd3NXMXN3TEZzeE0xMWRYVjFkWFYxZExGc3dMREFzWm1Gc2MyVXNiblZzYkN3NU9ERTJNak01TmpZeE9EWXpPREFzTnpJc1cxczBMRGN4TEc1MWJHd3NNU3htWVd4elpTeG1ZV3h6WlN4bVlXeHpaU3czTVRBNU1UZzROelV6TVRJME1qa3NiblZzYkN4Yld6a3NOelJkWFYwc1d5MHhMRE15TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4bVlXeHpaU3cxTmpjME5Ua3lOVFE0TkRRMk1qUXNiblZzYkN4Yld6RXhMREV5TURJME1UVTNOek0wT1RRMk1sMHNXemdzTUYwc1d6Y3NXekpkWFYxZExGc3pNaXd6TXl4dWRXeHNMREFzWm1Gc2MyVXNabUZzYzJVc2RISjFaU3c1TWpZNE5ESTFOekkxTVRVeU1UWXNiblZzYkN4Yld6QXNXemRkWFYxZFhTeGJYU3hiV3pBc01DeG1ZV3h6WlN4dWRXeHNMRE14TXpVMk5EVTJOREU0TWpZMU1pdzNNeXhiV3pFekxETXpMRzUxYkd3c01DeG1ZV3h6WlN4bVlXeHpaU3gwY25WbExEYzBOVEUwTmpVM05qY3lPRFUxTkN4dWRXeHNMRnRiTUN4Yk16UmRYVjFkTEZzeE15dzJNaXh1ZFd4c0xEQXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNPVEl3TURZM09UZzVNVGsxTURFNExHNTFiR3dzVzFzNExEUmRMRnN3TEZzek9DeGJNU3d4T0N3Mk15eG1ZV3h6WlYxZFhWMWRYU3hiV3pFekxEWTBMQ0pRYUhsemFXTnpJaXczT0RNeU16STFORE0wTXpBM09UQXNNQ3h1ZFd4c0xGdGJNQ3hiTXpaZFhTeGJNQ3hiTXpnc1d6RXNNVE1zTmpVc1ptRnNjMlZkWFYwc1d6Y3NXekpkWFYxZFhTeGJXekFzTUN4bVlXeHpaU3h1ZFd4c0xEWTFPRFU1TVRneE5EVXlPVE15TkN3M05DeGJXeTB4TERNeUxHNTFiR3dzTUN4bVlXeHpaU3htWVd4elpTeG1ZV3h6WlN3NU5UUTJOemN4TmpneE9EVTJPRElzYm5Wc2JDeGJXekV4TERRNE9EVTVOall5TWpjNU5EWXpPRjBzV3pnc01GMHNXemNzV3pKZFhWMWRYU3hiV3pFc05qWXNiblZzYkN3Mk5qRXpNamd4TVRnMU5EUTFNekFzTUN4dWRXeHNMRnRiTWl4YkluUnlhV0oxYm1VaUxHWmhiSE5sWFYwc1d6TXNNRjBzV3pBc1d6SmRYU3hiTUN4Yk1sMWRMRnN4TEZzeU5GMWRYVjFkWFYxZExGc3dMREFzWm1Gc2MyVXNiblZzYkN3ME1UQTRNemMzT1RVd09USXpNVFFzTnpVc1cxc3pOU3d6TXl4dWRXeHNMREFzWm1Gc2MyVXNabUZzYzJVc2RISjFaU3cwTURnMU1USTRNamcwTURZMU56SXNiblZzYkN4Yld6QXNXek01WFYxZFhWMHNXMXN6TlN3Mk5Dd2lVR2g1YzJsamN5SXNPVE16TnprM016SXdNRGMyTnpNNExEQXNiblZzYkN4Yld6QXNXek01WFYwc1d6QXNXelF3TEZzeExETTFMRFkxTEdaaGJITmxYVjFkTEZzM0xGczJYVjFkWFYxZExGc3dMREFzWm1Gc2MyVXNiblZzYkN3NE56QXpOVGcwTXpjek1ERTVNVFlzTnpZc1cxMHNXMXN6TWl3ek5TeHVkV3hzTERVeU5EZzFPVGN3TVRjMU5USXlNQ3d3TEc1MWJHd3NXMXN3TEZzeE5WMWRYVjBzV3kweExEY3lMRzUxYkd3c05Ua3lOakF4TVRnMU5UWTFOREl5TERJc2JuVnNiQ3hiV3pBc1d6VTJYVjFkWFN4Yk16SXNNelVzYm5Wc2JDdzNOemd3TkRrMU9UZ3dNekEwTXpRc01DeHVkV3hzTEZ0Yk1DeGJPVjFkWFYxZFhWMWRMRnN3TERBc1ptRnNjMlVzYm5Wc2JDd3lNell3T1RFeU1UazBOamc1TlRVc056Y3NXMXMwTERjeExHNTFiR3dzTVN4bVlXeHpaU3htWVd4elpTeG1ZV3h6WlN3NE1EQXhOakEyTnpZNU1URTNPRE1zYm5Wc2JDeGJXemtzTnpaZFhWMHNXeTB4TERNeUxHNTFiR3dzTUN4bVlXeHpaU3htWVd4elpTeG1ZV3h6WlN3NU56VXhORGMwTnpnNU9UUTRPRE1zYm5Wc2JDeGJXekV4TERFeU1ESTBNVFUzTnpNME9UUTJNbDBzV3pnc01GMHNXemNzV3pKZFhWMWRMRnN6TWl3ek15eHVkV3hzTERBc1ptRnNjMlVzWm1Gc2MyVXNkSEoxWlN3M01EUTJPVGt5TlRJMU1qazJPRGdzYm5Wc2JDeGJXekFzV3poZFhWMWRYU3hiWFN4Yld6QXNNQ3htWVd4elpTeHVkV3hzTERZM05EUTJPVFV5TWpnNE9UWTVOU3czT0N4Yld6RXpMRE16TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4MGNuVmxMREV3TlRjNU9UUTBNVFUwTWpjNU9TeHVkV3hzTEZ0Yk1DeGJOREZkWFYxZExGc3hNeXcyTWl4dWRXeHNMREFzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzT1RVNE56TXdOamsxTlRFd05qY3dMRzUxYkd3c1cxczRMRFJkTEZzd0xGc3pPQ3hiTVN3eE9DdzJNeXhtWVd4elpWMWRYVjFkWFN4Yld6RXpMRFkwTENKUWFIbHphV056SWl3ME1EUTNOemcxTWpZMk5UZzBOamdzTUN4dWRXeHNMRnRiTUN4Yk16WmRYU3hiTUN4Yk16Z3NXekVzTVRNc05qVXNabUZzYzJWZFhWMHNXemNzV3pKZFhWMWRYU3hiV3pBc01DeG1ZV3h6WlN4dWRXeHNMRGt4T0RVMk1qa3pOek0xTURJek1pdzNPU3hiV3kweExETXlMRzUxYkd3c01DeG1ZV3h6WlN4bVlXeHpaU3htWVd4elpTdzRNVFV4T1RNM05UZzNPRFUxTkRJc2JuVnNiQ3hiV3pFeExEUTRPRFU1TmpZeU1qYzVORFl6T0Ywc1d6Z3NNRjBzV3pjc1d6SmRYVjFkWFN4Yld6RXNOallzYm5Wc2JDdzVNamsyTmpVek1UZzJNamMzTXpNc01DeHVkV3hzTEZ0Yk1peGJJblJ5YVdKMWJtVWlMR1poYkhObFhWMHNXek1zTUYwc1d6QXNXekpkWFN4Yk1DeGJNbDFkTEZzeExGc3lORjFkWFYxZFhWMWRMRnN3TERBc1ptRnNjMlVzYm5Wc2JDd3hNRFF4TVRVMU1EYzJPVEF5TWpFc09EQXNXMXN6TlN3ek15eHVkV3hzTERBc1ptRnNjMlVzWm1Gc2MyVXNkSEoxWlN3eU5USXdOREU1TnpBek9ESTFNREFzYm5Wc2JDeGJXekFzV3pReVhWMWRYVjBzVzFzek5TdzJOQ3dpVUdoNWMybGpjeUlzTkRrNU5qWXpPVGd5TlRNNE9ERXhMREFzYm5Wc2JDeGJXekFzV3pNNVhWMHNXekFzV3pRd0xGc3hMRE0xTERZMUxHWmhiSE5sWFYxZExGczNMRnMyWFYxZFhWMWRMRnN3TERBc1ptRnNjMlVzYm5Wc2JDdzBOVE13TnpRek56UXlNVEUzTWprc09ERXNXMTBzVzFzek1pd3pOU3h1ZFd4c0xERXdPREV5TkRjeU9Ua3dNREkyT0N3d0xHNTFiR3dzVzFzd0xGczJNRjFkWFYwc1d5MHhMRGN5TEc1MWJHd3NOVFEzTWpJeU1UazVNelV3TXpjMUxESXNiblZzYkN4Yld6QXNXelUyWFYxZFhTeGJNeklzTXpVc2JuVnNiQ3cyT1RNek1qWTBPVGszT0RJeU9UY3NNQ3h1ZFd4c0xGdGJNQ3hiTXpSZFhWMWRYVjFkWFN4Yk1Dd3dMR1poYkhObExHNTFiR3dzT1RFeU9EQTNNRFV3TkRZNU5qYzBMRGd5TEZ0Yk5DdzNNU3h1ZFd4c0xERXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNNelV6T1RNMU1ETTNPRFk0TlRnMExHNTFiR3dzVzFzNUxEZ3lYVjFkTEZzdE1Td3pNaXh1ZFd4c0xEQXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNPRE0wTnpJME1qTXhPRFUxTlRRd0xHNTFiR3dzVzFzeE1TdzNOVGMxT0Rnd01qRXdOemd4TkROZExGczRMREJkTEZzM0xGc3lYVjFkWFYwc1cxc3RNU3czTXl4dWRXeHNMRGt4TmpRMk9UVTVNak0yTVRrNE9Td3dMRzUxYkd4ZExGc3RNU3cxT1N4dWRXeHNMRFV4TVRBeU5EZzBPRFE0TlRZM015d3dMRzUxYkd3c1cxc3hNU3cyTVRVd01qYzJOVEE0TlRreU1qQmRMRnMzTEZzeVhWMWRYVjFkWFYwc1d6QXNNQ3htWVd4elpTeHVkV3hzTERjMk1EYzJOamsyTWpBM01qWTJNeXc0TXl4Yld6Y3NOelFzYm5Wc2JDd3hMR1poYkhObExHWmhiSE5sTEdaaGJITmxMREl6T1RnMk1qUXlPVFk0TXpZeE1TeHVkV3hzTEZ0Yk5Dd3pNbDFkWFN4Yk16SXNNek1zYm5Wc2JDd3dMR1poYkhObExHWmhiSE5sTEhSeWRXVXNNVE15TWpnd016RXpPRGN5TmpZMExHNTFiR3dzVzFzd0xGczFNMTFkWFYxZExGdGRMRnRiTUN3d0xHWmhiSE5sTEc1MWJHd3NOREV4TXpReU1EYzBNekE1T1RJMkxEZzBMRnRiTVRNc016TXNiblZzYkN3d0xHWmhiSE5sTEdaaGJITmxMSFJ5ZFdVc056VTNNalk1TkRJeE9ERXpPRGMxTEc1MWJHd3NXMXN3TEZzMU5GMWRYVjBzV3pFekxEWXlMRzUxYkd3c01DeG1ZV3h6WlN4bVlXeHpaU3htWVd4elpTdzRORFkxTWpFNE1qVTBOREF4TlRFc2JuVnNiQ3hiV3pnc05GMHNXekFzV3pNNExGc3hMREU0TERZekxHWmhiSE5sWFYxZFhWMWRMRnRiTVRNc05qUXNJbEJvZVhOcFkzTWlMRGd6TkRRek16YzVNekE1T1RjeE5Dd3dMRzUxYkd3c1cxc3dMRnN6TmwxZExGc3dMRnN6T0N4Yk1Td3hNeXcyTlN4bVlXeHpaVjFkWFN4Yk55eGJNbDFkWFYxZExGdGJNQ3d3TEdaaGJITmxMRzUxYkd3c09EUXhOemsxTkRjd01qWTJOVGc0TERnMUxGdGJMVEVzTXpJc2JuVnNiQ3d3TEdaaGJITmxMR1poYkhObExHWmhiSE5sTERNMU5ETXhORGMwT1RRMU56SXpOeXh1ZFd4c0xGdGJNVEVzTkRnNE5UazJOakl5TnprME5qTTRYU3hiT0N3d1hTeGJOeXhiTWwxZFhWMWRMRnRiTVN3Mk5peHVkV3hzTERZNE1UWTFNekUwTVRNeU5UUTVNaXd3TEc1MWJHd3NXMXN5TEZzaWRISnBZblZ1WlNJc1ptRnNjMlZkWFN4Yk15d3dYU3hiTUN4Yk1sMWRMRnN3TEZzeVhWMHNXekVzV3pJMFhWMWRYVjFkWFYwc1d6QXNNQ3htWVd4elpTeHVkV3hzTERFMk9UY3pOREkxT0RVM05EYzNOaXc0Tml4Yld6TTFMRE16TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4MGNuVmxMRFl5TmpVeE56STVPRFl3T0RNNE1DeHVkV3hzTEZ0Yk1DeGJOVFZkWFYxZFhTeGJXek0xTERZMExDSlFhSGx6YVdOeklpd3pORFF3TVRneE1EQXhNRE0yTnpNc01DeHVkV3hzTEZ0Yk1DeGJNemxkWFN4Yk1DeGJNVGNzV3pFc016VXNOalVzWm1Gc2MyVmRYVjBzV3pjc1d6WmRYVjFkWFYwc1d6QXNNQ3htWVd4elpTeHVkV3hzTERNNU5ESXhNREE1TnpJMU16Y3pNU3c0Tnl4YlhTeGJXek15TERNMUxHNTFiR3dzTXpZNU5qSXhOemc1T1RjMU5qTTRMREFzYm5Wc2JDeGJXekFzV3paZFhWMWRMRnN0TVN3M01peHVkV3hzTERRNE1qWTNNek0wTlRneE1ESTJNaXd5TEc1MWJHd3NXMXN3TEZzMU5sMWRYVjBzV3pNeUxETTFMRzUxYkd3c016STFNelV6TlRRd056a3pNemc1TERBc2JuVnNiQ3hiV3pBc1d6SmRYVjFkWFYxZFhTeGJNQ3d3TEdaaGJITmxMRzUxYkd3c01UazJNemswTmpNeU1EQXpNelF4TERnNExGdGJNelVzTXpNc2JuVnNiQ3d3TEdaaGJITmxMR1poYkhObExIUnlkV1VzTXpBMU5qQXhOalUzTVRnek1qRTNMRzUxYkd3c1cxc3dMRnMxTlYxZFhWMHNXek0xTERjMUxHNTFiR3dzTUN4bVlXeHpaU3gwY25WbExHWmhiSE5sTERnMU5UYzBOamszTmpRNE9UTTFOeXh1ZFd4c0xGdGJNQ3hiTmpGZFhTeGJNQ3hiTWwxZFhWMWRMRnRiTXpVc056QXNJbEJvZVhOcFkzTWlMREk0TlRVd01UVXhOek0zTVRVME1Dd3dMRzUxYkd3c1cxc3dMRnMyTWwxZExGc3dMRnMwTUN4Yk1Td3pOU3cyTlN4bVlXeHpaVjFkWFN4Yk55eGJObDFkWFYxZFhTeGJNQ3d3TEdaaGJITmxMRzUxYkd3c09UWXhPVGcyTWpNME1UUTVNRGMzTERnNUxGdGJNelVzTXpNc2JuVnNiQ3d3TEdaaGJITmxMR1poYkhObExIUnlkV1VzTlRjeU9UY3hOek13TmpjNU1Ua3hMRzUxYkd3c1cxc3dMRnMxT1YxZFhWMHNXek0xTERjMUxHNTFiR3dzTUN4bVlXeHpaU3gwY25WbExHWmhiSE5sTERnNU5UVTNOakF5T0RjMU1UTTFNaXh1ZFd4c0xGdGJNQ3hiTmpGZFhTeGJNQ3hiTWwxZFhWMWRMRnRiTXpVc056QXNJbEJvZVhOcFkzTWlMRFUyTURNMk56UTBOakV4TVRreU15d3dMRzUxYkd3c1cxc3dMRnMyTWwxZExGc3dMRnMwTUN4Yk1Td3pOU3cyTlN4bVlXeHpaVjFkWFN4Yk55eGJObDFkWFYxZFhTeGJNQ3d3TEdaaGJITmxMRzUxYkd3c05qa3dPVGd5TXpjME1qSTJNekkxTERrd0xGdGJOeXczTkN4dWRXeHNMREVzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzTkRBeU16STJPVGsyTXpZek16QTVMRzUxYkd3c1cxczBMRE15WFYxZExGc3pNaXd6TXl4dWRXeHNMREFzWm1Gc2MyVXNabUZzYzJVc2RISjFaU3d4TXpZd01EVXdPRFEwTkRNMk1EVXNiblZzYkN4Yld6QXNXelUzWFYxZFhWMHNXMTBzVzFzd0xEQXNabUZzYzJVc2JuVnNiQ3czTmpreU56UTNNREF3TXprd05qWXNPVEVzVzFzeE15d3pNeXh1ZFd4c0xEQXNabUZzYzJVc1ptRnNjMlVzZEhKMVpTdzJNamcxTVRZMk1qSXpOalF3TVRrc2JuVnNiQ3hiV3pBc1d6VTRYVjFkWFN4Yk1UTXNOaklzYm5Wc2JDd3dMR1poYkhObExHWmhiSE5sTEdaaGJITmxMRE0yTkRZNU5Ea3lOemN4TURBeU1peHVkV3hzTEZ0Yk9DdzBYU3hiTUN4Yk16Z3NXekVzTVRnc05qTXNabUZzYzJWZFhWMWRYVjBzVzFzeE15dzJOQ3dpVUdoNWMybGpjeUlzTlRRM05qTTFNVEU0TURBME5UYzVMREFzYm5Wc2JDeGJXekFzV3pNMlhWMHNXekFzV3pNNExGc3hMREV6TERZMUxHWmhiSE5sWFYxZExGczNMRnN5WFYxZFhWMHNXMXN3TERBc1ptRnNjMlVzYm5Wc2JDdzFORFV4TmpReE1EYzNOelk0TURNc09USXNXMXN0TVN3ek1peHVkV3hzTERBc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc05qRTFOVEE1T1RRNE5URTNNVFl5TEc1MWJHd3NXMXN4TVN3ME9EZzFPVFkyTWpJM09UUTJNemhkTEZzNExEQmRMRnMzTEZzeVhWMWRYVjBzVzFzeExEWTJMRzUxYkd3c05qQXhNREV5TWpZek56VXdPVFF5TERBc2JuVnNiQ3hiV3pJc1d5SjBjbWxpZFc1bElpeG1ZV3h6WlYxZExGc3pMREJkTEZzd0xGc3lYVjBzV3pBc1d6SmRYU3hiTVN4Yk1qUmRYVjFkWFYxZFhTeGJNQ3d3TEdaaGJITmxMRzUxYkd3c01UQTVPVFUyT1RJM01EVTBOemswTERrekxGdGJNelVzTXpNc2JuVnNiQ3d3TEdaaGJITmxMR1poYkhObExIUnlkV1VzTmpJNU1qRXhORGszT0RreE1UUTFMRzUxYkd3c1cxc3dMRnMxT1YxZFhWMWRMRnRiTXpVc05qUXNJbEJvZVhOcFkzTWlMREUxTkRRMU5UQTROVE0yT1RJM01Dd3dMRzUxYkd3c1cxc3dMRnN6T1YxZExGc3dMRnN4Tnl4Yk1Td3pOU3cyTlN4bVlXeHpaVjFkWFN4Yk55eGJObDFkWFYxZFhTeGJNQ3d3TEdaaGJITmxMRzUxYkd3c01qTXdOalEyTmpFeU9UVTRPVFl4TERrMExGdGRMRnRiTXpJc016VXNiblZzYkN3ek9EQTNNRGswTlRreU56TXdOVEVzTUN4dWRXeHNMRnRiTUN4Yk1URmRYVjFkTEZzdE1TdzNNaXh1ZFd4c0xEYzVOVGN3TWpNMU1UVTFNRE15TkN3eUxHNTFiR3dzVzFzd0xGczFObDFkWFYwc1d6TXlMRE0xTEc1MWJHd3NNekU1T0RNeU56RTFOak15TlRrMUxEQXNiblZzYkN4Yld6QXNXekV6WFYxZFhWMWRYVjBzV3pBc01DeG1ZV3h6WlN4dWRXeHNMRFk1TkRneE9UZ3dNemc0TWpreU9DdzVOU3hiV3pNMUxETXpMRzUxYkd3c01DeG1ZV3h6WlN4bVlXeHpaU3gwY25WbExEazJNekl6TURRM01qTXhOekF6TXl4dWRXeHNMRnRiTUN4Yk16bGRYVjFkTEZzek5TdzNOU3h1ZFd4c0xEQXNabUZzYzJVc2RISjFaU3htWVd4elpTdzRPVE13TURRek5UYzBOelV4TkRJc2JuVnNiQ3hiV3pBc1d6WXhYVjBzV3pBc1d6SmRYVjFkWFN4Yld6TTFMRGN3TENKUWFIbHphV056SWl3ME1qSTVNVE0wTXpBek5qVXhPRElzTUN4dWRXeHNMRnRiTUN4Yk5qSmRYU3hiTUN4Yk1UY3NXekVzTXpVc05qVXNabUZzYzJWZFhWMHNXemNzV3paZFhWMWRYVjBzV3pBc01DeG1ZV3h6WlN4dWRXeHNMRFl6TmpNM01EUXdNRGM0TVRFMk1TdzVOaXhiV3pjc056UXNiblZzYkN3eExHWmhiSE5sTEdaaGJITmxMR1poYkhObExEazFNelExTVRZNE1UWTRNall5T0N4dWRXeHNMRnRiTkN3ek1sMWRYU3hiTXpJc016TXNiblZzYkN3d0xHWmhiSE5sTEdaaGJITmxMSFJ5ZFdVc09UVTBOREE1TlRJMk16WXpOREV6TEc1MWJHd3NXMXN3TEZzM1hWMWRYU3hiTFRFc016SXNiblZzYkN3d0xHWmhiSE5sTEdaaGJITmxMR1poYkhObExERTFPREE1T0RNNU56QTFPVE0wTnl4dWRXeHNMRnRiTVRFc01USXdNalF4TlRjM016UTVORFl5WFN4Yk9Dd3dYU3hiTnl4Yk1sMWRYVjFkTEZ0ZExGdGJNQ3d3TEdaaGJITmxMRzUxYkd3c05ERTBPVFkxTnpVNE1qTTJNVGN5TERrM0xGdGJNVE1zTXpNc2JuVnNiQ3d3TEdaaGJITmxMR1poYkhObExIUnlkV1VzT1RneU56WXlNRGt5TlRRek1UQTNMRzUxYkd3c1cxc3dMRnN6TkYxZFhWMHNXekV6TERZeUxHNTFiR3dzTUN4bVlXeHpaU3htWVd4elpTeG1ZV3h6WlN3ME1Ua3lNRGsxTmpreE9URXdOemtzYm5Wc2JDeGJXemdzTkYwc1d6QXNXek00TEZzeExERTRMRFl6TEdaaGJITmxYVjFkWFYxZExGdGJNVE1zTmpRc0lsQm9lWE5wWTNNaUxETTJOelk1T1RVeE16RXlNRFkwTUN3d0xHNTFiR3dzVzFzd0xGc3pObDFkTEZzd0xGc3pPQ3hiTVN3eE15dzJOU3htWVd4elpWMWRYU3hiTnl4Yk1sMWRYVjFkTEZ0Yk1Dd3dMR1poYkhObExHNTFiR3dzTnpZNU56QXpNek0yTVRrMk1qY3hMRGs0TEZ0YkxURXNNeklzYm5Wc2JDd3dMR1poYkhObExHWmhiSE5sTEdaaGJITmxMREkxTVRnek56Y3lNek13TVRRek5TeHVkV3hzTEZ0Yk1URXNORGc0TlRrMk5qSXlOemswTmpNNFhTeGJPQ3d3WFN4Yk55eGJNbDFkWFYxZExGdGJNU3cyTml4dWRXeHNMRFU0TVRJek5UZ3lPVEUwTXpVM015d3dMRzUxYkd3c1cxc3lMRnNpZEhKcFluVnVaU0lzWm1Gc2MyVmRYU3hiTXl3d1hTeGJNQ3hiTWwxZExGc3dMRnN5WFYwc1d6RXNXekkwWFYxZFhWMWRYVjBzV3pBc01DeG1ZV3h6WlN4dWRXeHNMRGM0T0RZM09ETXpNamszTkRFMk5TdzVPU3hiV3pNMUxETXpMRzUxYkd3c01DeG1ZV3h6WlN4bVlXeHpaU3gwY25WbExEVXlNekkxTkRRMU16UXpNakUxTnl4dWRXeHNMRnRiTUN4Yk16bGRYVjFkWFN4Yld6TTFMRFkwTENKUWFIbHphV056SWl3NU16QXlPRFl6TmpBd09EVTJPVFVzTUN4dWRXeHNMRnRiTUN4Yk16bGRYU3hiTUN4Yk5EQXNXekVzTXpVc05qVXNabUZzYzJWZFhWMHNXemNzV3paZFhWMWRYVjBzV3pBc01DeG1ZV3h6WlN4dWRXeHNMREUwTVRneE9ERTBPVE0xTmpJME9Dd3hNREFzVzEwc1cxc3pNaXd6TlN4dWRXeHNMRFV4TmpRM09EQXlOelkwT0RnMU1Dd3dMRzUxYkd3c1cxc3dMRnN4TlYxZFhWMHNXeTB4TERjeUxHNTFiR3dzTlRBd05qRTRNekU0TkRrd05EazNMRElzYm5Wc2JDeGJXekFzV3pVMlhWMWRYU3hiTXpJc016VXNiblZzYkN3eE1qZzNOVGs0T1RBMU56QTRPRFVzTUN4dWRXeHNMRnRiTUN4Yk9WMWRYVjFkWFYxZExGc3dMREFzWm1Gc2MyVXNiblZzYkN3eE5EZzJNREEwTWpJNU9USTRPRFVzTVRBeExGdGJNelVzTXpNc2JuVnNiQ3d3TEdaaGJITmxMR1poYkhObExIUnlkV1VzTlRFek1qSTFNVGcyT0RFeU1qQTNMRzUxYkd3c1cxc3dMRnMwTWwxZFhWMHNXek0xTERjMUxHNTFiR3dzTUN4bVlXeHpaU3gwY25WbExHWmhiSE5sTERRM05EVTBNems1TlRVNE5qTXpPU3h1ZFd4c0xGdGJNQ3hiTmpGZFhTeGJNQ3hiTWwxZFhWMWRMRnRiTXpVc056QXNJbEJvZVhOcFkzTWlMRE16TlRZNE16ZzRNVGcyTlRrd01Td3dMRzUxYkd3c1cxc3dMRnMyTWwxZExGc3dMRnN4Tnl4Yk1Td3pOU3cyTlN4bVlXeHpaVjFkWFN4Yk55eGJObDFkWFYxZFhTeGJNQ3d3TEdaaGJITmxMRzUxYkd3c01qWTFOekEyT1RRek5USXdOVFF4TERFd01peGJXemNzTnpRc2JuVnNiQ3d4TEdaaGJITmxMR1poYkhObExHWmhiSE5sTERReE1ESTVNRGcwTnpVd01qUXpNQ3h1ZFd4c0xGdGJOQ3d6TWwxZFhTeGJNeklzTXpNc2JuVnNiQ3d3TEdaaGJITmxMR1poYkhObExIUnlkV1VzT0RrNU9ERTNOamcwTlRjMU56WTVMRzUxYkd3c1cxc3dMRnM0WFYxZFhTeGJMVEVzTXpJc2JuVnNiQ3d3TEdaaGJITmxMR1poYkhObExHWmhiSE5sTERNNE9UUXpOalk1T1RnMk5UVTVOaXh1ZFd4c0xGdGJNVEVzTVRJd01qUXhOVGMzTXpRNU5EWXlYU3hiT0N3d1hTeGJOeXhiTWwxZFhWMWRMRnRkTEZ0Yk1Dd3dMR1poYkhObExHNTFiR3dzTkRBNE5URTVNRGt3TURrNU16RXdMREV3TXl4Yld6RXpMRE16TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4MGNuVmxMRGMyTURjMU1ERXdNelE0TkRnME1peHVkV3hzTEZ0Yk1DeGJOREZkWFYxZExGc3hNeXcyTWl4dWRXeHNMREFzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzTmpNeU56SXhNVFl3T0RreU9EVTFMRzUxYkd3c1cxczRMRFJkTEZzd0xGc3pPQ3hiTVN3eE9DdzJNeXhtWVd4elpWMWRYVjFkWFN4Yld6RXpMRFkwTENKUWFIbHphV056SWl3Mk16VTJORFUwTWpjeE5UVXdNak1zTUN4dWRXeHNMRnRiTUN4Yk16WmRYU3hiTUN4Yk16Z3NXekVzTVRNc05qVXNabUZzYzJWZFhWMHNXemNzV3pKZFhWMWRYU3hiV3pBc01DeG1ZV3h6WlN4dWRXeHNMRFl3TVRnME9Ua3lOelU1T1RRek9Td3hNRFFzVzFzdE1Td3pNaXh1ZFd4c0xEQXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNPVEExTWpnek1UazJNekkzTkRNNUxHNTFiR3dzVzFzeE1TdzBPRGcxT1RZMk1qSTNPVFEyTXpoZExGczRMREJkTEZzM0xGc3lYVjFkWFYwc1cxc3hMRFkyTEc1MWJHd3NNemMxTlRBeU56TXpNekkwT0RVekxEQXNiblZzYkN4Yld6SXNXeUowY21saWRXNWxJaXhtWVd4elpWMWRMRnN6TERCZExGc3dMRnN5WFYwc1d6QXNXekpkWFN4Yk1TeGJNalJkWFYxZFhWMWRYU3hiTUN3d0xHWmhiSE5sTEc1MWJHd3NNVGMzTVRVM01qSXlNVE0wTVRnekxERXdOU3hiV3pNMUxETXpMRzUxYkd3c01DeG1ZV3h6WlN4bVlXeHpaU3gwY25WbExERXpPRFV6TWpZNE1UUTBOemN4T0N4dWRXeHNMRnRiTUN4Yk5ESmRYVjFkWFN4Yld6TTFMRFkwTENKUWFIbHphV056SWl3MU5qRTBORGs1TURZMk9UWXlNelFzTUN4dWRXeHNMRnRiTUN4Yk16bGRYU3hiTUN4Yk5EQXNXekVzTXpVc05qVXNabUZzYzJWZFhWMHNXemNzV3paZFhWMWRYVjBzV3pBc01DeG1ZV3h6WlN4dWRXeHNMREk1TlRRNU5EazBPVEF4TlRjMk15d3hNRFlzVzEwc1cxc3pNaXd6TlN4dWRXeHNMRFUxTmpNd09EYzFNelE1T0RJMU5Dd3dMRzUxYkd3c1cxc3dMRnMyTUYxZFhWMHNXeTB4TERjeUxHNTFiR3dzTlRZM09EUTJOalV6T1RReE9Ua3pMRElzYm5Wc2JDeGJXekFzV3pVMlhWMWRYU3hiTXpJc016VXNiblZzYkN3ek1qYzBOalF6TVRBNU5EYzNNVFVzTUN4dWRXeHNMRnRiTUN4Yk16UmRYVjFkWFYxZFhWMWRMRnN3TERBc1ptRnNjMlVzYm5Wc2JDdzJOakV6TnpRNU9EUXdNamd3T0RFc01UQTNMRnRiTFRFc01qRXNiblZzYkN3d0xHWmhiSE5sTEdaaGJITmxMR1poYkhObExEUTFOamc0TlRnek9EVTJNalU0TVN4dWRXeHNYVjBzVzEwc1cxc3dMREFzWm1Gc2MyVXNiblZzYkN3Mk1qSTJOelV3TWpVek56Z3hORFFzTVRBNExGdGJNVE1zTXpNc2JuVnNiQ3d3TEdaaGJITmxMR1poYkhObExIUnlkV1VzT0RZMk9UWTBOVFExTVRJeU5UQTFMRzUxYkd3c1cxc3dMRnMxTkYxZFhWMWRMRnRkTEZ0Yk1Dd3dMR1poYkhObExHNTFiR3dzTkRVd09EWXlNVGMxT0RVME1UY3hMREV3T1N4Yld6TTBMRE16TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4MGNuVmxMRFl3T1RneE5UWTJOakEwTkRVNE55eHVkV3hzTEZ0Yk1DeGJOak5kWFYxZFhTeGJXekV6TERjMkxDSlFhSGx6YVdOeklpdzFOalUyTkRNeU1qZzVOVE16TkRVc01DeHVkV3hzTEZ0Yk55eGJNVEZkWFN4Yk5Dd3pORjBzV3pBc1d6SmRYU3hiTUN4Yk1sMWRYVjFkWFN4Yk1Dd3dMR1poYkhObExHNTFiR3dzTlRVMU56QTFPRGt6TURjMU9UTXpMREV4TUN4Yld6TTBMRE16TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4MGNuVmxMREl5TWpJNE5EYzROREF3T0RJNE55eHVkV3hzTEZ0Yk1DeGJOalJkWFYxZFhTeGJXekV6TERjMkxDSlFhSGx6YVdOeklpdzJNamsyTkRReE5qTTROVGN6T1RJc01DeHVkV3hzTEZ0Yk55eGJPVjFkTEZzMExETTBYU3hiTUN4Yk1sMWRMRnN3TEZzeVhWMWRYVjFkTEZzd0xEQXNabUZzYzJVc2JuVnNiQ3cwTmprME1qQXhOams0TkRrNU16SXNNVEV4TEZ0Yk1qSXNNek1zYm5Wc2JDd3dMR1poYkhObExHWmhiSE5sTEhSeWRXVXNOall6T1RNMk9UTTRNek01TVRFd0xHNTFiR3dzVzFzd0xGczJOVjFkWFYxZExGdGJNVE1zTnpZc0lsQm9lWE5wWTNNaUxETXlOekF5TVRrek5UTTFOakk0TVN3d0xHNTFiR3dzVzFzM0xGczJYVjBzV3pRc01qSmRMRnN3TEZzMk5sMWRMRnN3TEZzNVhWMWRYVjFkTEZzd0xEQXNabUZzYzJVc2JuVnNiQ3d5TmpneU1UQTBOelUwTURBeE1URXNNVEV5TEZ0Yk16VXNNek1zYm5Wc2JDd3dMR1poYkhObExHWmhiSE5sTEhSeWRXVXNNVEE0TnpnNE16TTVPVFUwTXpRMUxHNTFiR3dzVzFzd0xGczFOVjFkWFYxZExGdGJNVE1zTnpZc0lsQm9lWE5wWTNNaUxEazBORFk1T1RNeU5ERTFNRGMzT1N3d0xHNTFiR3dzVzFzM0xGc3hOVjFkTEZzMExETTFYU3hiTUN4Yk5qZGRYU3hiTUN4Yk5sMWRYVjFkWFYxZExGc3dMREFzWm1Gc2MyVXNiblZzYkN3NE56a3dNREl4T0RFNU56VXhPRFlzTVRFekxGdGJNVE1zTXpNc2JuVnNiQ3d3TEdaaGJITmxMR1poYkhObExIUnlkV1VzTWpjNU9EazBNelUwTkRrMk1EZzFMRzUxYkd3c1cxc3dMRnMxT0YxZFhWMWRMRnRkTEZ0Yk1Dd3dMR1poYkhObExHNTFiR3dzTXpJME16Z3dORGt4TmpRd016a3pMREV4TkN4Yld6TTBMRE16TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4MGNuVmxMRGM0TWpZd01qY3pPRE0wT1RJME1DeHVkV3hzTEZ0Yk1DeGJOamhkWFYxZFhTeGJXekV6TERjMkxDSlFhSGx6YVdOeklpdzFOemc0T0RVek1EYzBPVFE0TWprc01DeHVkV3hzTEZ0Yk55eGJNVEZkWFN4Yk5Dd3pORjBzV3pBc1d6WTVYVjBzV3pBc1d6TTVYVjFkWFYxZExGc3dMREFzWm1Gc2MyVXNiblZzYkN3Mk5URXlNalEyTkRRMk56QTRNVEVzTVRFMUxGdGJNelFzTXpNc2JuVnNiQ3d3TEdaaGJITmxMR1poYkhObExIUnlkV1VzTVRnd056azFNREEyTnpVME56RXdMRzUxYkd3c1cxc3dMRnMzTUYxZFhWMWRMRnRiTVRNc056WXNJbEJvZVhOcFkzTWlMRGczTURReE16WTVNalV6T0RBd05Td3dMRzUxYkd3c1cxczNMRnM1WFYwc1d6UXNNelJkTEZzd0xGczNNVjFkTEZzd0xGc3pPVjFkWFYxZFhTeGJNQ3d3TEdaaGJITmxMRzUxYkd3c01UZ3hNRFUwTlRReE1USXhOVGcyTERFeE5peGJXekl5TERNekxHNTFiR3dzTUN4bVlXeHpaU3htWVd4elpTeDBjblZsTERjeU5EVTVPRGt4TlRneU1qQXdNeXh1ZFd4c0xGdGJNQ3hiTmpGZFhWMWRYU3hiV3pFekxEYzJMQ0pRYUhsemFXTnpJaXcwTlRRMU56azVNRGd3TURJM01qTXNNQ3h1ZFd4c0xGdGJOeXhiTmwxZExGczBMREl5WFN4Yk1DeGJOalpkWFN4Yk1DeGJPVjFkWFYxZFhTeGJNQ3d3TEdaaGJITmxMRzUxYkd3c05EUTBNakkwTlRJM05UUXdOelF4TERFeE55eGJXek0xTERNekxHNTFiR3dzTUN4bVlXeHpaU3htWVd4elpTeDBjblZsTERnNU5EWTRNVFV6TmpReE56azFOaXh1ZFd4c0xGdGJNQ3hiTlRsZFhWMWRYU3hiV3pFekxEYzJMQ0pRYUhsemFXTnpJaXc0TlRrek9UUXhNalUwTkRFMU9UWXNNQ3h1ZFd4c0xGdGJOeXhiTVRWZFhTeGJOQ3d6TlYwc1d6QXNXelkzWFYwc1d6QXNXelpkWFYxZFhWMWRYU3hiTUN3d0xHWmhiSE5sTEc1MWJHd3NNalV5TmpJd05qTTNNekUwTkRNd0xERXhPQ3hiV3pFekxETXpMRzUxYkd3c01DeG1ZV3h6WlN4bVlXeHpaU3gwY25WbExEazJNakU0TnpZek1qSXhOak15Tml4dWRXeHNMRnRiTUN4Yk16UmRYVjFkWFN4YlhTeGJXekFzTUN4bVlXeHpaU3h1ZFd4c0xEWXpOell5TmpnMU1EUXdOREUzTWl3eE1Ua3NXMXN6TkN3ek15eHVkV3hzTERBc1ptRnNjMlVzWm1Gc2MyVXNkSEoxWlN3M01qRTFNVE00TkRVME5Ea3lPVGNzYm5Wc2JDeGJXekFzV3pjeVhWMWRYVjBzVzFzeE15dzNOaXdpVUdoNWMybGpjeUlzTmpJMk5qWTNNelV6TmpReU1qSXlMREFzYm5Wc2JDeGJXemNzV3pFeFhWMHNXelFzTXpSZExGc3dMRnMyT1YxZExGc3dMRnN6T1YxZFhWMWRYU3hiTUN3d0xHWmhiSE5sTEc1MWJHd3NPVGN5TXpBd016QTBNekF6TXpjMUxERXlNQ3hiV3pNMExETXpMRzUxYkd3c01DeG1ZV3h6WlN4bVlXeHpaU3gwY25WbExEazNNamswTlRBM09Ea3hPVFkzTWl4dWRXeHNMRnRiTUN4Yk56TmRYVjFkWFN4Yld6RXpMRGMyTENKUWFIbHphV056SWl3eE1UQXdNRGN6T1RVeE9EZzNOVGtzTUN4dWRXeHNMRnRiTnl4Yk9WMWRMRnMwTERNMFhTeGJNQ3hiTnpGZFhTeGJNQ3hiTXpsZFhWMWRYVjBzV3pBc01DeG1ZV3h6WlN4dWRXeHNMRE15TkRZMk56VXpNVFV3T0RZNE1Dd3hNakVzVzFzeU1pd3pNeXh1ZFd4c0xEQXNabUZzYzJVc1ptRnNjMlVzZEhKMVpTdzFORFEwTXpReU1ETTJNREV6TXpFc2JuVnNiQ3hiV3pBc1d6WXdYVjFkWFYwc1cxc3hNeXczTml3aVVHaDVjMmxqY3lJc05ESXdOVFUzTnpRd09EazBNalU0TERBc2JuVnNiQ3hiV3pjc1d6WmRYU3hiTkN3eU1sMHNXekFzV3pZMlhWMHNXekFzV3psZFhWMWRYVjBzV3pBc01DeG1ZV3h6WlN4dWRXeHNMRGM0TVRReE16YzBOVFUxTVRReE9Td3hNaklzVzFzek5Td3pNeXh1ZFd4c0xEQXNabUZzYzJVc1ptRnNjMlVzZEhKMVpTdzBNVEEwT1RRM01qTXdORGszT0RFc2JuVnNiQ3hiV3pBc1d6TTVYVjFkWFYwc1cxc3hNeXczTml3aVVHaDVjMmxqY3lJc05qSTVOVEl5TVRBMU9USTFNVGt3TERBc2JuVnNiQ3hiV3pjc1d6RTFYVjBzV3pRc016VmRMRnN3TEZzM05GMWRMRnN3TEZzM05WMWRYVjFkWFYxZExGc3dMREFzWm1Gc2MyVXNiblZzYkN3NU1UQXdOVFUyTVRneE56QXdNRFFzTVRJekxGdGJNVE1zTXpNc2JuVnNiQ3d3TEdaaGJITmxMR1poYkhObExIUnlkV1VzTXpjd056ZzJPREUwTXprMk1EUTJMRzUxYkd3c1cxc3dMRnMwTVYxZFhWMWRMRnRiTVRNc056Y3NJbEJvZVhOcFkzTWlMREl6T0RBeU1UVXlOREEyTVRjNE1pd3dMRzUxYkd3c1cxc3dMRnMyTVYxZFhWMWRMRnRiTUN3d0xHWmhiSE5sTEc1MWJHd3NOakEwTURnd05ETTNOVE0yT0RJeUxERXlOQ3hiV3pNMExETXpMRzUxYkd3c01DeG1ZV3h6WlN4bVlXeHpaU3gwY25WbExEY3pNekk0TURNek1UVTBNemMzTXl4dWRXeHNMRnRiTUN4Yk56WmRYVjFkWFN4Yld6RXpMRGMyTENKUWFIbHphV056SWl3ek5qWTROamd3TlRJM016RXlOemdzTUN4dWRXeHNMRnRiTnl4Yk1URmRYU3hiTkN3ek5GMHNXekFzV3pKZFhTeGJNQ3hiTWwxZFhWMWRYU3hiTUN3d0xHWmhiSE5sTEc1MWJHd3NNalV4TXprd01qWTFPRGMzTmpnMExERXlOU3hiV3pNMExETXpMRzUxYkd3c01DeG1ZV3h6WlN4bVlXeHpaU3gwY25WbExEYzNORE13TmpZek1qazFNemN5T1N4dWRXeHNMRnRiTUN4Yk56ZGRYVjFkWFN4Yld6RXpMRGMyTENKUWFIbHphV056SWl3MU5Ua3hNemN4T1RjNU5Ua3lOek1zTUN4dWRXeHNMRnRiTnl4Yk9WMWRMRnMwTERNMFhTeGJNQ3hiTWwxZExGc3dMRnN5WFYxZFhWMWRMRnN3TERBc1ptRnNjMlVzYm5Wc2JDdzJOVGN3TVRrMk9UZ3pNRFEwT0RRc01USTJMRnRiTWpJc016TXNiblZzYkN3d0xHWmhiSE5sTEdaaGJITmxMSFJ5ZFdVc05qRTRNek14TXpJd09UZzJOemc0TEc1MWJHd3NXMXN3TEZzM09GMWRYVjFkTEZ0Yk1UTXNOellzSWxCb2VYTnBZM01pTERVeE9UUTRORGN4T0RJMk1EYzJOU3d3TEc1MWJHd3NXMXMzTEZzMlhWMHNXelFzTWpKZExGc3dMRnMyTmwxZExGc3dMRnM1WFYxZFhWMWRMRnN3TERBc1ptRnNjMlVzYm5Wc2JDd3lNams1TVRFeU5UazVNalU1TURFc01USTNMRnRiTXpVc016TXNiblZzYkN3d0xHWmhiSE5sTEdaaGJITmxMSFJ5ZFdVc01UVXhPVEl4TkRBNE9ETXhORGsyTEc1MWJHd3NXMXN3TEZzME1sMWRYVjFkTEZ0Yk1UTXNOellzSWxCb2VYTnBZM01pTERFd056UTBNemcxTWpjNU1qSTBPQ3d3TEc1MWJHd3NXMXMzTEZzeE5WMWRMRnMwTERNMVhTeGJNQ3hiTnpSZFhTeGJNQ3hiTnpWZFhWMWRYVjFkWFYxZFhWMHNXekFzTUN4bVlXeHpaU3h1ZFd4c0xEYzBNamd6TmpRd01EVTNNVEEyTUN3eE1qZ3NXMXN4Tml3ME9TeHVkV3hzTERBc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc09EVXlOalUwTmpNM05USTBOell5TEc1MWJHd3NXMXN4TUN3d1hTeGJPQ3d3WFN4Yk55eGJNbDFkWFYwc1d6RTJMRGM0TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4bVlXeHpaU3czTmpjd01EY3lNakUzT1RBM016SXNiblZzYkN4Yld6Z3NOVjBzV3pBc1d6YzVMRnMwTERJNFhWMWRYVjFkTEZ0Yk1UWXNOemtzYm5Wc2JDd3lNakkwT0RFME9ESXpOREEwTnpNc01DeHVkV3hzTEZ0Yk1DeGJPREFzV3pRc01qbGRYVjFkWFYxZExGc3dMREFzWm1Gc2MyVXNiblZzYkN3NU9USXpOVEkwTWpReU5EWXpNVGtzTVRJNUxGdGJNVFlzTkRrc2JuVnNiQ3d3TEdaaGJITmxMR1poYkhObExHWmhiSE5sTERneU1EUTVORFU1T0Rrek5qTTBOaXh1ZFd4c0xGdGJNVEFzTUYwc1d6Z3NNRjBzV3pjc1d6Z3hYVjFkWFN4Yk1UWXNOemdzYm5Wc2JDd3dMR1poYkhObExHWmhiSE5sTEdaaGJITmxMRE0xTWpVeU5UVTBOalkyT1RJME5DeHVkV3hzTEZ0Yk9Dd3pYU3hiTUN4Yk9EQXNXelFzTWpsZFhWMWRYVjBzVzFzeE5pdzNPU3h1ZFd4c0xERTBOREUzTmprNU9UVTJPVEk0T1N3d0xHNTFiR3dzVzFzd0xGczNPU3hiTkN3eU9GMWRYVjFkWFYwc1d6QXNNQ3htWVd4elpTeHVkV3hzTERjNE9UWTRNalExTkRNeE5UY3lNeXd4TXpBc1cxc3lPQ3d6TVN4dWRXeHNMREFzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzT0RBek5ESTNOVEUwTVRNek5qWXpMRzUxYkd3c1cxc3hNQ3d4WFN4Yk9Dd3dYU3hiTnl4Yk1sMWRYVjFkTEZ0ZExGdGJNQ3d3TEdaaGJITmxMRzUxYkd3c09EazRPREkxT1RRNE5ETTVNekV4TERFek1TeGJXekk0TERNeExHNTFiR3dzTUN4bVlXeHpaU3htWVd4elpTeG1ZV3h6WlN3ek9ERTJNelUyT0RrNE5ERTJNak1zYm5Wc2JDeGJXekV3TERKZExGczRMREJkTEZzM0xGczRNbDFkWFYxZExGdGJNVElzTnpBc0lsQm9lWE5wWTNNaUxETTFOekF6TkRjek9EUXpPVFl3T1N3d0xHNTFiR3dzVzFzd0xGczJYVjBzV3pBc1d6SmRYU3hiTnl4Yk1sMWRYVjFkWFYxZExGc3dMREFzWm1Gc2MyVXNiblZzYkN3MU1EQXpPVGc0TmpJNU1EZzRPVE1zTVRNekxGdGJNamdzTXpFc2JuVnNiQ3d3TEdaaGJITmxMR1poYkhObExHWmhiSE5sTERFd09UazJOell4TkRJME9UQTROaXh1ZFd4c0xGdGJNVEFzTVYwc1d6Z3NNRjBzV3pjc1d6WmRYVjFkWFN4YlhTeGJXekFzTUN4bVlXeHpaU3h1ZFd4c0xETTVNVEExT1RFd016RTROVEF6T1N3eE16UXNXMXN5T0N3ek1TeHVkV3hzTERBc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc05EYzNNekU0TnpVNU9EVTROakEyTEc1MWJHd3NXMXN4TUN3eVhTeGJPQ3d3WFN4Yk55eGJPREpkWFYxZFhTeGJXekV5TERjd0xDSlFhSGx6YVdOeklpd3lNak16TWpJME9ERTVORFkyT1Rnc01DeHVkV3hzTEZ0Yk1DeGJObDFkTEZzd0xGczRNMTFkTEZzM0xGc3lYVjFkWFYxZFhWMHNXekFzTUN4bVlXeHpaU3h1ZFd4c0xEVTRNREF5TURRNE16Z3pNVFkyTkN3eE16WXNXMXN0TVN3ek1peHVkV3hzTERBc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc05qQXhNRFF4TkRjNU5UUXdOamN3TEc1MWJHd3NXMXN4TVN3ME1UZzVNRGswT1RNeE1EVTNOamxkTEZzNExEQmRMRnMzTEZzeVhWMWRYVjBzVzFzdE1Td3lNaXh1ZFd4c0xERTBOek0xT1RBME5ERTNPREl4Tnl3d0xHNTFiR3dzVzFzMUxGc3hYVjBzV3pBc1d6TTJYVjFkWFYwc1cxc3dMREFzWm1Gc2MyVXNiblZzYkN3ME5URTFNemN4TnpNME1UZzVNVElzTVRNM0xGdGJNVFFzTXpNc2JuVnNiQ3d3TEdaaGJITmxMR1poYkhObExIUnlkV1VzTnprMU1ERTVOVGN3TmpFM05UVTVMRzUxYkd3c1cxc3dMRnM0TWwxZFhWMWRMRnRiTVRRc016UXNiblZzYkN3eU5UWXdOREl3TURFek1UYzFPVGtzTUN4dWRXeHNMRnRiTXl3d1hWMWRYVjBzV3pBc01DeG1ZV3h6WlN4dWRXeHNMRGszT1RZME9URTJOVE0wTXpFM01Td3hNemdzVzFzeE5Dd3pNeXh1ZFd4c0xEQXNabUZzYzJVc1ptRnNjMlVzZEhKMVpTd3pPRE16TVRjM01EWXlNRFl6T0RJc2JuVnNiQ3hiV3pBc1d6ZzBYVjFkWFYwc1cxc3hOQ3d6TkN4dWRXeHNMRFF4T1RBM05EUXdNVEE0T1RNeU9Td3dMRzUxYkd3c1cxc3pMREJkWFYxZFhTeGJNQ3d3TEdaaGJITmxMRzUxYkd3c056VTFNVE14TURjd05ETXdOVGc0TERFek9TeGJXeTB4TERJeExHNTFiR3dzTUN4bVlXeHpaU3htWVd4elpTeG1ZV3h6WlN3NE56TTVOekEzTnpNMk16Z3hNemtzYm5Wc2JGMWRMRnRkTEZ0Yk1Dd3dMR1poYkhObExHNTFiR3dzTkRFd05ERXpNekF4TXpZM09Ea3hMREUwTUN4Yld5MHhMRE15TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4bVlXeHpaU3d6TXpnMk16RTNOakUxTURneE9UY3NiblZzYkN4Yld6RXhMRFE0T0RVNU5qWXlNamM1TkRZek9GMHNXemdzTUYwc1d6Y3NXekpkWFYxZFhTeGJXekVzTmpZc2JuVnNiQ3d4TURrek5URXlOekl4TWpRM016Z3NNQ3h1ZFd4c0xGdGJNaXhiSW5ScGJXVnlJaXhtWVd4elpWMWRMRnN6TERCZExGc3dMRnN5WFYwc1d6QXNXekpkWFN4Yk1TeGJNalJkWFYxZExGc3RNU3czTWl4dWRXeHNMRFk0TURnMU1UQXpNRGs1T1RNeE55d3lMRzUxYkd3c1cxc3dMRnMyWFYxZFhTeGJNU3cyTml4dWRXeHNMRGN6TURRME5qY3pOelk1TWpJM015d3dMRzUxYkd3c1cxc3lMRnNpZEdsdFpYSWlMR1poYkhObFhWMHNXek1zTUYwc1d6QXNXekpkWFN4Yk1DeGJNbDFkTEZzeExGc3lORjFkWFYwc1d5MHhMRGN5TEc1MWJHd3NNVGt6T1RjNE1qazRNekUxTXpreExESXNiblZzYkN4Yld6QXNXelpkWFYxZExGc3hMRFkyTEc1MWJHd3NOVGc1TmpJM09Ea3pOVFkzTWpjekxEQXNiblZzYkN4Yld6SXNXeUowYVcxbGNpSXNabUZzYzJWZFhTeGJNeXd3WFN4Yk1DeGJNbDFkTEZzd0xGc3lYVjBzV3pFc1d6STBYVjFkWFYxZFhWMHNXekFzTUN4bVlXeHpaU3h1ZFd4c0xEa3hNalU0TkRjNE16azJPRGN4TWl3eE5ERXNXMXN0TVN3eU1TeHVkV3hzTERBc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc016VXpNRFU0TlRJM09UazFOVFl5TEc1MWJHeGRYU3hiV3pNM0xETTFMRzUxYkd3c09UYzBNelE1TlRVMk16QTFNak0xTERBc2JuVnNiQ3hiV3pBc1d6Y3lYVjFkWFN4YkxURXNOeklzYm5Wc2JDd3lNRGt6TmprNU5UUXpORFUwTXpJc01peHVkV3hzTEZ0Yk1DeGJObDFkWFYwc1d6TTNMRE0xTEc1MWJHd3NOekU0T0RjeU56ZzVPVGcwTlRreExEQXNiblZzYkN4Yld6QXNXell3WFYxZFhTeGJMVEVzTnpJc2JuVnNiQ3cxTURZd05qVTVNemN5TmpFNU5UTXNNaXh1ZFd4c0xGdGJNQ3hiTmwxZFhWMHNXek0zTERNMUxHNTFiR3dzT0RnNU56VTRPVGMyTkRJek9UUXlMREFzYm5Wc2JDeGJXekFzV3pNMFhWMWRYU3hiTFRFc056SXNiblZzYkN3Mk5EZ3dOVFEzT0RjeE16ZzFNVEFzTWl4dWRXeHNMRnRiTUN4Yk5sMWRYVjFkTEZ0Yk1Dd3dMR1poYkhObExHNTFiR3dzTlRVek1UVTVOVEV5TmpJME56QTRMREUwTWl4Yld5MHhMRE15TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4bVlXeHpaU3d5TVRReE1UQTFNREF5TmpReU5EWXNiblZzYkN4Yld6RXhMRFExTVRNMk9EWTRNemswTmpZME9GMHNXemdzTUYwc1d6Y3NXekpkWFYxZFhTeGJXek0zTERNMUxHNTFiR3dzT0RrNE16WTVPVGcxT0RBME9EVXpMREFzYm5Wc2JDeGJXekFzV3psZFhWMWRYU3hiV3pBc01DeG1ZV3h6WlN4dWRXeHNMRFF4T0RreU56a3dOek16TXpZek1Td3hORE1zVzFzdE1Td3pNaXh1ZFd4c0xEQXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNNalV4TlRrNE5ERTFOREkxTnpNM0xHNTFiR3dzVzFzeE1TdzBPRGcxT1RZMk1qSTNPVFEyTXpoZExGczRMREJkTEZzM0xGc3lYVjFkWFYwc1cxc3hMRFkyTEc1MWJHd3NOek00TnpjNU1EQTVPVGcyTkRVd0xEQXNiblZzYkN4Yld6SXNXeUpuYnpNaUxHWmhiSE5sWFYwc1d6TXNNRjBzV3pBc1d6SmRYU3hiTUN4Yk1sMWRMRnN4TEZzeU5GMWRYVjFkWFYxZExGc3dMREFzWm1Gc2MyVXNiblZzYkN3MU9UZ3hOekkwTXpjNE16STFNemtzTVRRMExGdGJMVEVzTXpJc2JuVnNiQ3d3TEdaaGJITmxMR1poYkhObExHWmhiSE5sTERRMk5URTROVEV3T0Rrd09ESTROU3h1ZFd4c0xGdGJNVEVzTkRVeE16WTROamd6T1RRMk5qUTRYU3hiT0N3d1hTeGJOeXhiTmwxZFhWMWRMRnRiTXpjc016VXNiblZzYkN3ek5EUTJNRFV3TXpjM05ESTRNRE1zTUN4dWRXeHNMRnRiTUN4Yk1UVmRYVjFkWFN4Yld6QXNNQ3htWVd4elpTeHVkV3hzTERRek9UTXpOamt4TmpNMU1qSTNNeXd4TkRVc1cxc3RNU3d6TWl4dWRXeHNMREFzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzTnpFNU9EUTBOek0xTkRNMk56ZzVMRzUxYkd3c1cxc3hNU3cwT0RnMU9UWTJNakkzT1RRMk16aGRMRnM0TERCZExGczNMRnN5WFYxZFhWMHNXMXN4TERZMkxHNTFiR3dzT0RRM05qY3lNak13T0RFMU1qa3dMREFzYm5Wc2JDeGJXeklzV3lKbmJ6TWlMR1poYkhObFhWMHNXek1zTUYwc1d6QXNXekpkWFN4Yk1DeGJNbDFkTEZzeExGc3lORjFkWFYxZFhWMWRMRnN3TERBc1ptRnNjMlVzYm5Wc2JDd3hOVGsxTlRNME16azROems1T0Rnc01UUTJMRnRkTEZ0YkxURXNOeklzYm5Wc2JDdzRNREl3T1RZM01UWTNOakUwTXpJc01peHVkV3hzTEZ0Yk1DeGJObDFkWFYwc1d5MHhMRFU1TEc1MWJHd3NORGd4TURNd01EYzJPREUyTWpBd0xEQXNiblZzYkN4Yld6RXhMRFF4T0Rrd09UUTVNekV3TlRjMk9WMHNXemNzV3paZFhWMWRMRnN0TVN3MU9TeHVkV3hzTERVeU1qZ3dOREl5TWpVNE5ERXpOQ3d3TEc1MWJHd3NXMXN4TVN3eU9ESTNORGN3TURFeE16SXpOemRkTEZzM0xGczJYVjFkWFN4YkxURXNNaklzYm5Wc2JDdzRNalV5TURnek9EazJOREE0TXpJc01DeHVkV3hzTEZ0Yk5TeGJNVjFkTEZzd0xGc3lYVjFkWFYwc1cxc3dMREFzWm1Gc2MyVXNiblZzYkN3NE9EY3lOVEl3TlRNM01UVTROVElzTVRRM0xGdGJMVEVzTXpJc2JuVnNiQ3d3TEdaaGJITmxMR1poYkhObExHWmhiSE5sTERFeE56VXpNelk1TlRJeU1EQTRPQ3h1ZFd4c0xGdGJNVEVzTkRnNE5UazJOakl5TnprME5qTTRYU3hiT0N3d1hTeGJOeXhiTWwxZFhWMWRMRnRiTVN3Mk5peHVkV3hzTERRM05qazJPRGczTWpreU5EQTNNU3d3TEc1MWJHd3NXMXN5TEZzaWMzQnZjblJ6SUcxMWMybGpYekF5SWl4bVlXeHpaVjFkTEZzekxERmRMRnN3TEZzM01WMWRMRnN3TEZzeVhWMHNXekVzV3pnMVhWMWRYVjFkWFYxZFhWMWRMRnN3TERBc1ptRnNjMlVzYm5Wc2JDdzNNREE1TWpNNU9UZzJNVFExT1RJc01UUTRMRnRiTFRFc016SXNiblZzYkN3d0xHWmhiSE5sTEdaaGJITmxMR1poYkhObExEWTFNVE14TWpRNU1qUTFPVEExTlN4dWRXeHNMRnRiTVRFc01UY3lNalF4TWpRd056TXhNVFkyWFN4Yk9Dd3dYU3hiTnl4Yk1UVmRYVjFkWFN4YlhTeGJXekFzTUN4bVlXeHpaU3h1ZFd4c0xEUXpOVEEyTXpVNU5qYzNOamN6TWl3eE5Ea3NXMXN0TVN3ek1peHVkV3hzTERBc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc09UazRNRGd6TVRnNU16azVNelUxTEc1MWJHd3NXMXN4TVN3ME5URXpOamcyT0RNNU5EWTJORGhkTEZzNExEQmRMRnMzTEZzMlhWMWRYVjBzVzFzdE1TdzFPU3h1ZFd4c0xEUTBOVFl6TWpRME5URXdOVFV6TlN3d0xHNTFiR3dzVzFzeE1TdzROVE00TkRjMk9UUTJOREF5TWpOZExGczNMRnMyWFYxZFhTeGJMVEVzTnpJc2JuVnNiQ3d4TnpnNU5UWTBORFV4TkRZeU5ESXNNaXh1ZFd4c0xGdGJNQ3hiTXpkZFhWMWRMRnN0TVN3MU9TeHVkV3hzTERrNU1URXdPRGsyT1RFd09UQTFOaXd3TEc1MWJHd3NXMXN4TVN3eU9ESTNORGN3TURFeE16SXpOemRkTEZzM0xGc3lYVjFkWFN4YkxURXNNaklzYm5Wc2JDdzJOVFUyTlRFMU9ETTROVEk1T1RVc01DeHVkV3hzTEZ0Yk5TeGJNVjFkTEZzd0xGc3pObDFkWFYwc1d6TTNMRE0xTEc1MWJHd3NNVEEzT0RBMU16WTNNVFF4TVRFekxEQXNiblZzYkN4Yld6QXNXekV4WFYxZFhTeGJNVFFzTXpRc2JuVnNiQ3d5TnpVd09UQTJOemsxT1RreE5EUXNNQ3h1ZFd4c0xGdGJNeXd4WFYxZFhWMHNXekFzTUN4bVlXeHpaU3h1ZFd4c0xEWTBNelExTmprNU9ESTVNekkxTnl3eE5UQXNXMXN0TVN3ek1peHVkV3hzTERBc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc056SXdORGsxTWpJek56UTBOelV3TEc1MWJHd3NXMXN4TVN3ME5URXpOamcyT0RNNU5EWTJORGhkTEZzNExEQmRMRnMzTEZzeVhWMWRYVjBzVzFzdE1TdzFPU3h1ZFd4c0xEYzRPVE0wTnpVd01qSTNOVFExT1N3d0xHNTFiR3dzVzFzeE1TdzROVE00TkRjMk9UUTJOREF5TWpOZExGczNMRnMyWFYxZFhTeGJMVEVzTnpJc2JuVnNiQ3c0T0RrM05qUTBOelF6TmpnMU16VXNNaXh1ZFd4c0xGdGJNQ3hiTXpkZFhWMWRMRnN0TVN3MU9TeHVkV3hzTERNMk56STFPREk1TkRJek1EazNPQ3d3TEc1MWJHd3NXMXN4TVN3eU9ESTNORGN3TURFeE16SXpOemRkTEZzM0xGc3lYVjFkWFN4YkxURXNNaklzYm5Wc2JDd3lOakU1TnpVeU9EZzFNamcxTnprc01DeHVkV3hzTEZ0Yk5TeGJNVjFkTEZzd0xGc3pObDFkWFYwc1d6TTNMRE0xTEc1MWJHd3NOemN4TnpFeE1EVXhOekV5TnprekxEQXNiblZzYkN4Yld6QXNXelpkWFYxZExGc3hOQ3d6TkN4dWRXeHNMRFl6TWpFd05URTRNVGt4TWpNME1pd3dMRzUxYkd3c1cxc3pMREZkWFYxZFhWMWRMRnN3TERBc1ptRnNjMlVzYm5Wc2JDd3pORGs1TVRBNU16STBNek15Tmpjc01UVXhMRnRiTFRFc016SXNiblZzYkN3d0xHWmhiSE5sTEdaaGJITmxMR1poYkhObExEYzNPVEEzTnpjM016VTVORGs1TUN4dWRXeHNMRnRiTVRFc056WTRNekV5TWpFMk5qZzJNemd4WFN4Yk9Dd3dYU3hiTnl4Yk1UVmRYVjFkWFN4YlhTeGJXekFzTUN4bVlXeHpaU3h1ZFd4c0xEZzVOekU0TVRnd056RTROVFUwTXl3eE5USXNXMXN0TVN3ek1peHVkV3hzTERBc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc01qWXdOekV3TmpVMU16SXhNREk1TEc1MWJHd3NXMXN4TVN3ME5URXpOamcyT0RNNU5EWTJORGhkTEZzNExEQmRMRnMzTEZzMlhWMWRYVjBzVzFzdE1TdzFPU3h1ZFd4c0xEazVNVE14TkRZd05UTTROamt3TkN3d0xHNTFiR3dzVzFzeE1TdzROVE00TkRjMk9UUTJOREF5TWpOZExGczNMRnMyWFYxZFhTeGJMVEVzTnpJc2JuVnNiQ3d4TURJMU56Z3hNakF3TURBMk9Ua3NNaXh1ZFd4c0xGdGJNQ3hiTXpkZFhWMWRMRnN0TVN3MU9TeHVkV3hzTERVek1qWTNOVGM0T0RRNU5qRTNOQ3d3TEc1MWJHd3NXMXN4TVN3eU9ESTNORGN3TURFeE16SXpOemRkTEZzM0xGc3lYVjFkWFN4YkxURXNNaklzYm5Wc2JDdzFNek15T0RjeU5qVTJOelkyT0RFc01DeHVkV3hzTEZ0Yk5TeGJNVjFkTEZzd0xGc3pObDFkWFYwc1d6TTNMRE0xTEc1MWJHd3NNakE1T1RVMU16STFNamczTURNd0xEQXNiblZzYkN4Yld6QXNXekV6WFYxZFhTeGJNVFFzTXpRc2JuVnNiQ3d6TkRrNU1URXdOakk0TkRZME5qUXNNQ3h1ZFd4c0xGdGJNeXd4WFYxZFhWMHNXekFzTUN4bVlXeHpaU3h1ZFd4c0xEY3dORE14TVRFNE9UWTNOREF6Tnl3eE5UTXNXMXN0TVN3ek1peHVkV3hzTERBc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc016UTVNRGM0TlRJeU1EY3lNRFE1TEc1MWJHd3NXMXN4TVN3ME5URXpOamcyT0RNNU5EWTJORGhkTEZzNExEQmRMRnMzTEZzeVhWMWRYVjBzVzFzdE1TdzFPU3h1ZFd4c0xEVTJNak0zTnpBME9UY3dOekl3T1N3d0xHNTFiR3dzVzFzeE1TdzROVE00TkRjMk9UUTJOREF5TWpOZExGczNMRnMyWFYxZFhTeGJMVEVzTnpJc2JuVnNiQ3cyTWpZME16a3pNamcwTnpBMk5Ua3NNaXh1ZFd4c0xGdGJNQ3hiTXpkZFhWMWRMRnN0TVN3MU9TeHVkV3hzTERVMk5UYzJOemM1TkRNek5EWTVOQ3d3TEc1MWJHd3NXMXN4TVN3eU9ESTNORGN3TURFeE16SXpOemRkTEZzM0xGc3lYVjFkWFN4YkxURXNNaklzYm5Wc2JDdzRNakUwTXpVMk1Ua3hNVFF3T1RBc01DeHVkV3hzTEZ0Yk5TeGJNVjFkTEZzd0xGc3pObDFkWFYwc1d6TTNMRE0xTEc1MWJHd3NOall6T1RNNE1ERXhORGd6TkRFeExEQXNiblZzYkN4Yld6QXNXekpkWFYxZExGc3hOQ3d6TkN4dWRXeHNMRGd4TURReU1UZzFNVEV4TWpFNU1Td3dMRzUxYkd3c1cxc3pMREZkWFYxZFhWMWRMRnN3TERBc1ptRnNjMlVzYm5Wc2JDdzJOek16TURJd05USTNNek13TmpRc01UVTBMRnRiTnl3NE1DeHVkV3hzTERFc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc05ESTBOVEEwTWpVd05qRTRNemt5TEc1MWJHeGRMRnMzTERneExHNTFiR3dzTUN4bVlXeHpaU3htWVd4elpTeG1ZV3h6WlN3M05qUTBNek14T1RJNE9USXlPRGNzYm5Wc2JDeGJXelFzTVRSZFhWMWRMRnRkTEZ0Yk1Dd3dMR1poYkhObExHNTFiR3dzT1RRMk5URTBPREl3TWprd05ERXpMREUxTlN4Yld5MHhMRE15TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4bVlXeHpaU3czTVRneU5qSXdNREEyT0RnM05UTXNiblZzYkN4Yld6RXhMRGcxTXpnME56WTVORFkwTURJeU0xMHNXemdzTUYwc1d6Y3NXelpkWFYxZFhTeGJYU3hiV3pBc01DeG1ZV3h6WlN4dWRXeHNMREk0TnpBMk1qVXdPVFkyT0RrME55d3hOVFlzVzFzeE5DdzRNaXh1ZFd4c0xEQXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNNelUwTnpNM01qZ3lOall4T0RVMUxHNTFiR3dzVzFzNExEQmRMRnN3TEZzeVhWMWRYVjBzVzFzeE5Dd3lNeXh1ZFd4c0xEazBNalUxTnpFMk9EazRNRFkwTUN3d0xHNTFiR3dzVzFzekxERmRMRnN4TEZzelhWMWRYVjFkTEZzd0xEQXNabUZzYzJVc2JuVnNiQ3czTVRVd09UQTJNemsyT0RrME1UUXNNVFUzTEZ0Yk1UUXNPRElzYm5Wc2JDd3dMR1poYkhObExHWmhiSE5sTEdaaGJITmxMRFE0T0RreE16RXhNVGcwTURrd01TeHVkV3hzTEZ0Yk9Dd3dYU3hiTUN4Yk5sMWRYVjFkTEZ0Yk1UUXNNak1zYm5Wc2JDdzNORGt5TmpJek1EQXlOVFEwTWpFc01DeHVkV3hzTEZ0Yk15d3hYU3hiTVN4Yk0xMWRYVjFkWFYxZExGc3dMREFzWm1Gc2MyVXNiblZzYkN3NU16VXpNalV4TXpRMk16QTJNakFzTVRVNExGdGJMVEVzTXpJc2JuVnNiQ3d3TEdaaGJITmxMSFJ5ZFdVc1ptRnNjMlVzTlRVM016UTFNelEyTkRnNU5UTXpMRzUxYkd3c1cxc3hNU3c0TlRNNE5EYzJPVFEyTkRBeU1qTmRMRnM0TERCZExGczNMRnMyWFYxZFhTeGJMVEVzTXpJc2JuVnNiQ3d3TEdaaGJITmxMR1poYkhObExHWmhiSE5sTERJeU5UWTBPREk1TnpFd09UYzNPU3h1ZFd4c0xGdGJNVEVzTWpneU56UTNNREF4TVRNeU16YzNYU3hiT0N3d1hTeGJOeXhiTmwxZFhWMWRMRnRkTEZ0Yk1Dd3dMR1poYkhObExHNTFiR3dzT0Rrd01EUTVOelV5TmpVeE9ERTNMREUxT1N4Yld6RTBMRGd5TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4bVlXeHpaU3d5TkRVeU5ESXdPVGt6TlRVNU56Z3NiblZzYkN4Yld6Z3NNRjBzV3pBc1d6RXpYVjFkWFYwc1cxc3hOQ3d5TXl4dWRXeHNMRGMzTnpRMU9UZzJNalF5T1RRM015d3dMRzUxYkd3c1cxc3pMREZkTEZzeExGc3pYVjFkWFYxZExGc3dMREFzWm1Gc2MyVXNiblZzYkN3ME1qVTBOemcxTnpJMU1qQTNOeklzTVRZd0xGdGJNVFFzT0RJc2JuVnNiQ3d3TEdaaGJITmxMR1poYkhObExHWmhiSE5sTERVeU5qTTFOVFV6TWpZNE5UQTFPQ3h1ZFd4c0xGdGJPQ3d3WFN4Yk1DeGJNbDFkWFYxZExGdGJNVFFzTWpNc2JuVnNiQ3c1TXpjMk5qQTNOalUyTVRRM056UXNNQ3h1ZFd4c0xGdGJNeXd4WFN4Yk1TeGJNMTFkWFYxZFhWMWRYVjBzV3pBc01DeG1ZV3h6WlN4dWRXeHNMRGd4T0Rrd05qTTROamt4TmpJMU9Td3hOakVzVzFzM0xEZ3pMRzUxYkd3c01TeG1ZV3h6WlN4bVlXeHpaU3htWVd4elpTdzFNVEEwTURZME9EWTJORGN3TlRBc2JuVnNiRjBzV3pjc09ERXNiblZzYkN3d0xHWmhiSE5sTEdaaGJITmxMR1poYkhObExEZzJORFF6TXpNMU5UZzFNVE16TlN4dWRXeHNMRnRiTkN3eE5GMWRYVjBzVzEwc1cxc3dMREFzWm1Gc2MyVXNiblZzYkN3Mk1Ua3hOVFF5TVRFNU1qUTNPVGtzTVRZeUxGdGJMVEVzTXpJc2JuVnNiQ3d3TEdaaGJITmxMR1poYkhObExHWmhiSE5sTERRMU9ERTNOamMyTWpBek1UWXpOU3h1ZFd4c0xGdGJNVEVzT0RVek9EUTNOamswTmpRd01qSXpYU3hiT0N3d1hTeGJOeXhiTmwxZFhWMWRMRnRkTEZ0Yk1Dd3dMR1poYkhObExHNTFiR3dzT0RRNE9UWTJOVGt6TVRneU56ZzRMREUyTXl4Yld6RTBMRGd5TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4bVlXeHpaU3d6TlRnMk1EUTRNRGcwTURFNU9UY3NiblZzYkN4Yld6Z3NNRjBzV3pBc1d6WmRYVjFkWFN4Yld6TXNPRFFzYm5Wc2JDdzJOell4TXpRNE5qY3pNVGN6T1RFc01TeHVkV3hzWFN4YkxURXNOeklzYm5Wc2JDdzNNVGd6T1RnMk1UUTNNRGMwTmprc01peHVkV3hzTEZ0Yk1DeGJOVFpkWFYxZExGc3RNaXdpYm1WM1oyRnRaU0lzYm5Wc2JDdzRNakEzTVRjM01UQXlOVFV4TmpRc01DeHVkV3hzWFYxZExGc3dMREFzWm1Gc2MyVXNiblZzYkN3NU9UWXdNVGcwTlRNMU1UWTNOaklzTVRZMExGdGJNVFFzT0RJc2JuVnNiQ3d3TEdaaGJITmxMR1poYkhObExHWmhiSE5sTERRd09EUTVORFF3TlRreU1ESXdOeXh1ZFd4c0xGdGJPQ3d3WFN4Yk1DeGJNbDFkWFYxZExGdGJNeXc0TkN4dWRXeHNMRE0yT1RFNE16YzBPRFU1TURneU55d3hMRzUxYkd4ZExGc3RNU3czTWl4dWRXeHNMRFU0TWpRek1EazFNRFU0T0RnME5pd3lMRzUxYkd3c1cxc3dMRnMxTmwxZFhWMHNXeTB4TERnMUxHNTFiR3dzTVRjek9UWXpPVE0yT0Rrek5UQXhMREFzYm5Wc2JDeGJXellzSW0xaGFXNXRaVzUxSWwxZFhTeGJNU3c0Tml4dWRXeHNMREU0TnpFek9EWTFNamMwTlRrek5Dd3dMRzUxYkd3c1cxc3hMRnM0TlYxZFhWMHNXeTB5TENKdVpYZG5ZVzFsSWl4dWRXeHNMRGszTnpnM05URXpNak0yT0RNMU5pd3dMRzUxYkd4ZFhWMWRYU3hiTUN3d0xHWmhiSE5sTEc1MWJHd3NOVFUzTkRRM01UWTRPREEyTlRBeUxERTJOU3hiV3kweExETXlMRzUxYkd3c01DeG1ZV3h6WlN4MGNuVmxMR1poYkhObExEazNNekk0TURVNU9EVTJNVEk1TVN4dWRXeHNMRnRiTVRFc09EVXpPRFEzTmprME5qUXdNakl6WFN4Yk9Dd3dYU3hiTnl4Yk5sMWRYVjBzV3kweExETXlMRzUxYkd3c01DeG1ZV3h6WlN4bVlXeHpaU3htWVd4elpTdzNOamszT1RFeE5qRTBOekE1TURRc2JuVnNiQ3hiV3pFeExESTRNamMwTnpBd01URXpNak0zTjEwc1d6Z3NNRjBzV3pjc1d6WmRYVjFkWFN4YlhTeGJXekFzTUN4bVlXeHpaU3h1ZFd4c0xEWXhPRGsyTXpZeU1EZzFOREUxTlN3eE5qWXNXMXN4TkN3NE1peHVkV3hzTERBc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc016TTNOelUwT0RRNU1qTXhOVEl4TEc1MWJHd3NXMXM0TERCZExGc3dMRnN4TTExZFhWMWRMRnRiTFRFc05Ua3NiblZzYkN3MU1EY3hNelF6TXpFeU5UQTBNelFzTUN4dWRXeHNMRnRiTVRFc05qRTFNREkzTmpVd09EVTVNakl3WFN4Yk55eGJNbDFkWFYwc1d5MHhMRGN6TEc1MWJHd3NNVE15TVRFMU56QTVNall3TnpJekxEQXNiblZzYkYxZFhTeGJNQ3d3TEdaaGJITmxMRzUxYkd3c01UTTBNVFF3TnpnMk56YzVNREk1TERFMk55eGJXekUwTERneUxHNTFiR3dzTUN4bVlXeHpaU3htWVd4elpTeG1ZV3h6WlN3M05qazVNREkwTURJM05EQTJNVFVzYm5Wc2JDeGJXemdzTUYwc1d6QXNXekpkWFYxZFhTeGJXeTB4TERnMUxHNTFiR3dzTXprM016UTJOemsyT1RZeE1URTJMREFzYm5Wc2JDeGJXellzSW0xaGFXNXRaVzUxSWwxZFhTeGJMVElzSW01bGQyZGhiV1VpTEc1MWJHd3NNelEwTlRFNE1qa3hORGN3TXpJeUxEQXNiblZzYkYwc1d6RXNPRFlzYm5Wc2JDdzROakUyTURNeU56WXhNemd6TURFc01DeHVkV3hzTEZ0Yk1TeGJPRFZkWFYxZExGc3RNU3cxT1N4dWRXeHNMREV5TnpZMU1ESTVOalEyTWpjNE5Dd3dMRzUxYkd3c1cxc3hNU3d5T0RJM05EY3dNREV4TXpJek56ZGRMRnMzTEZzeVhWMWRYVjFkWFYxZFhTeGJNQ3d3TEdaaGJITmxMRzUxYkd3c01URTNOVGcyTlRReE1qRXlOalUxTERFMk9DeGJXemNzT0RNc2JuVnNiQ3d4TEdaaGJITmxMR1poYkhObExHWmhiSE5sTERFek5UVXlNell6TWpZME9EWTNOU3h1ZFd4c1hWMHNXMXN4TkN3eU15eHVkV3hzTERjeU16VTNNek16TnpVeU9ETTNPQ3d3TEc1MWJHd3NXMXN6TERCZExGc3hMRnN6WFYxZFhWMWRMRnN3TERBc1ptRnNjMlVzYm5Wc2JDd3hNRGszTnpjME56Y3pOak0xTURrc01UWTVMRnRiTFRFc016SXNiblZzYkN3d0xHWmhiSE5sTEdaaGJITmxMR1poYkhObExEVTVPRFEzTVRNeU9EY3pOVE0yT0N4dWRXeHNMRnRiTVRFc01qZ3lOelEzTURBeE1UTXlNemMzWFN4Yk9Dd3dYU3hiTnl4Yk5sMWRYVjFkTEZ0ZExGdGJNQ3d3TEdaaGJITmxMRzUxYkd3c05EQTNNREF4TnpBMU1EQXlORGd3TERFM01DeGJXeTB4TERJeExHNTFiR3dzTUN4bVlXeHpaU3htWVd4elpTeG1ZV3h6WlN3MU16VTVOVGsxT0RFMU9UQTVPVE1zYm5Wc2JGMWRMRnRiTFRFc05Ua3NiblZzYkN3eU1URTBOVEEwT0RNd01qTTBPVEFzTUN4dWRXeHNMRnRiTVRFc09EYzBPVEkxTnpFek9ERTBNRGMyWFN4Yk55eGJPRFlzV3pRc09EZGRYVjFkWFN4YkxURXNOVGtzYm5Wc2JDdzBOelF6T0RZMk56TXhNVGMyTVRVc01DeHVkV3hzTEZ0Yk1URXNNemMxTmpNNE5UWTNNRGM0TVRBNFhTeGJOeXhiT0Rjc1d6UXNPRGRkWFYxZFhTeGJMVEVzTlRrc2JuVnNiQ3cxTWpBd05EWTRORFkxTnpZMk9UY3NNQ3h1ZFd4c0xGdGJNVEVzTmpjM09ETXlOakE1TXpRek1UZ3hYU3hiTnl4Yk9EZ3NXelFzT0RkZFhWMWRYU3hiTFRFc05Ua3NiblZzYkN3Mk9ERTVNalUyT1RFME1EazROVE1zTUN4dWRXeHNMRnRiTVRFc056TTFOemM0TmpNek5EazBPRFl6WFN4Yk55eGJPRGtzV3pRc09EZGRYVjFkWFN4YkxURXNOVGtzYm5Wc2JDdzNORFEzTVRRM05EZzRNREV5TWpnc01DeHVkV3hzTEZ0Yk1URXNOVFl4TWpVd056UXdOakEyT1RrMVhTeGJOeXhiT1RBc1d6UXNPRGRkWFYxZFhTeGJMVEVzTlRrc2JuVnNiQ3cwTnpZME1UazBOakl6TVRnNU1qWXNNQ3h1ZFd4c0xGdGJNVEVzTkRRM01qazVNVE0yTkRZME1ERTRYU3hiTnl4Yk9URXNXelFzT0RkZFhWMWRYU3hiTFRFc05Ua3NiblZzYkN3eU1USXpOemczTXpZeU1UQTVNVElzTUN4dWRXeHNMRnRiTVRFc01qZzBPVEkzT1RRMk16SXpNRGsxWFN4Yk55eGJPRGtzV3pRc09EZGRYVjFkWFYwc1cxc3dMREFzWm1Gc2MyVXNiblZzYkN3eE1UTXdNRFV5TlRNd05Ua3dOVElzTVRjeExGdGJMVEVzTXpJc2JuVnNiQ3d3TEdaaGJITmxMR1poYkhObExHWmhiSE5sTERJd09EY3lNRGd6TnpreU9EQXlPU3h1ZFd4c0xGdGJNVEVzTnpNMU56YzROak16TkRrME9EWXpYU3hiT0N3d1hTeGJOeXhiTWwxZFhWMHNXek14TERNekxHNTFiR3dzTUN4bVlXeHpaU3htWVd4elpTeDBjblZsTERNMk16RXhOVEEyT1RneE56TTFNQ3h1ZFd4c0xGdGJNQ3hiT1RKZFhWMWRYU3hiV3pNeExEZzRMRzUxYkd3c01qY3lOakF3TVRnNU9UY3dORFk0TERJMU9TeHVkV3hzTEZ0Yk5Dd3hNbDBzV3pVc1d6SXlYVjBzV3pjc1d6SmRYU3hiTVRZc1ptRnNjMlZkWFYwc1d6RXlMRGc1TEc1MWJHd3NPRFkxT0RFeU5URTJOekUxTmpRM0xEQXNiblZzYkN4Yld6TXNNVjBzV3pRc016WmRYVjFkTEZ0Yk1Dd3dMR1poYkhObExHNTFiR3dzTVRZMk9URTBNVEExTnpFeU5qTTBMREUzTWl4Yld5MHhMRE15TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4bVlXeHpaU3d5TVRNd05EUXlNek0yTnpNME5EZ3NiblZzYkN4Yld6RXhMRFUyTVRJMU1EYzBNRFl3TmprNU5WMHNXemdzTUYwc1d6Y3NXekpkWFYxZFhTeGJXekV5TERNMUxHNTFiR3dzTmpZMU9ESTNOalE0TkRRMU5UZ3pMREFzYm5Wc2JDeGJXekFzV3pKZFhWMWRMRnN4TWl3NU1Dd2lVR2g1YzJsamN5SXNORFUxTURFNU9ERTFNamd6T0RJMUxEQXNiblZzYkN4Yld6QXNXek0zWFYxZFhTeGJNVElzT1RFc0lsQm9lWE5wWTNNaUxEVTRNRFl3TWpRek5ERTVNVEl3TWl3d0xHNTFiR3dzVzFzd0xGczVNMTFkWFYxZFhTeGJNQ3d3TEdaaGJITmxMRzUxYkd3c016QXhOekk0T1RNNE9URTVNamMxTERFM015eGJXeTB4TERNeUxHNTFiR3dzTUN4bVlXeHpaU3htWVd4elpTeG1ZV3h6WlN3NU56azNNamM1TXpNMk56WTJOek1zYm5Wc2JDeGJXekV4TERVMk1USTFNRGMwTURZd05qazVOVjBzV3pnc01GMHNXemNzV3paZFhWMWRYU3hiV3pFeUxETTFMRzUxYkd3c05qYzVOekV4TnpreU1qa3dOall3TERBc2JuVnNiQ3hiV3pBc1d6WmRYVjFkTEZzeE1pdzVNQ3dpVUdoNWMybGpjeUlzTkRZd09EWXlNVFUyTlRRek5UTXhMREFzYm5Wc2JDeGJXekFzV3prMFhWMWRYU3hiTVRJc09URXNJbEJvZVhOcFkzTWlMREl5TkRRMU1qUXlNalkwTXpjM05Td3dMRzUxYkd3c1cxc3dMRnM1TlYxZFhWMWRYU3hiTUN3d0xHWmhiSE5sTEc1MWJHd3NNams1TVRJNU16QTRNVEF4TlRneExERTNOQ3hiV3kweExETXlMRzUxYkd3c01DeG1ZV3h6WlN4bVlXeHpaU3htWVd4elpTdzJNREUzT0RRek5UZzJNakkzTnpBc2JuVnNiQ3hiV3pFeExEVTJNVEkxTURjME1EWXdOams1TlYwc1d6Z3NNRjBzV3pjc1d6RXpYVjFkWFYwc1cxc3hNaXd6TlN4dWRXeHNMRE0xTlRJME1EazJPVFV4T1RRM05pd3dMRzUxYkd3c1cxc3dMRnN4TTExZFhWMHNXekV5TERrd0xDSlFhSGx6YVdOeklpd3hNakUzTVRjM05qQXdPVGszTXpjc01DeHVkV3hzTEZ0Yk1DeGJPVFpkWFYxZExGc3hNaXc1TVN3aVVHaDVjMmxqY3lJc01qTTBORGswTkRBMk16QTRNamN4TERBc2JuVnNiQ3hiV3pBc1d6a3pYVjFkWFYxZExGc3dMREFzWm1Gc2MyVXNiblZzYkN3ek5ESTJPRFEzTlRNMU5qYzFOekVzTVRjMUxGdGJMVEVzTXpJc2JuVnNiQ3d3TEdaaGJITmxMR1poYkhObExHWmhiSE5sTERVeE5qRTFOekV6TWpNNU9UQTNOQ3h1ZFd4c0xGdGJNVEVzTlRZeE1qVXdOelF3TmpBMk9UazFYU3hiT0N3d1hTeGJOeXhiTVRGZFhWMWRYU3hiV3pFeUxETTFMRzUxYkd3c09ERTVNakU0T0RBMU9USTROems1TERBc2JuVnNiQ3hiV3pBc1d6RXhYVjFkWFN4Yk1USXNPVEFzSWxCb2VYTnBZM01pTERRM09UQTJNelEyT1RZd05USXdOeXd3TEc1MWJHd3NXMXN3TEZzek4xMWRYVjBzV3pFeUxEa3hMQ0pRYUhsemFXTnpJaXczTWpZeU1EVTVNRFV5T1RNME1qa3NNQ3h1ZFd4c0xGdGJNQ3hiT1RkZFhWMWRYVjBzV3pBc01DeG1ZV3h6WlN4dWRXeHNMRE0zTURVMU5EVTJORFk1TkRjeE55d3hOellzVzFzdE1Td3pNaXh1ZFd4c0xEQXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNNamsxT1RJek5qWXpPREkzTVRjNUxHNTFiR3dzVzFzeE1TdzFOakV5TlRBM05EQTJNRFk1T1RWZExGczRMREJkTEZzM0xGczVYVjFkWFYwc1cxc3hNaXd6TlN4dWRXeHNMRFkxT1RFeU9EWTJNVGd4TkRJMk5Td3dMRzUxYkd3c1cxc3dMRnM1WFYxZFhTeGJNVElzT1RBc0lsQm9lWE5wWTNNaUxERTJNVEExTWpJMU56RTJOek14T1N3d0xHNTFiR3dzVzFzd0xGc3pOMTFkWFYwc1d6RXlMRGt4TENKUWFIbHphV056SWl3ek9ETTVPREUyTWpVNU1UUXpOVFlzTUN4dWRXeHNMRnRiTUN4Yk9UUmRYVjFkWFYwc1d6QXNNQ3htWVd4elpTeHVkV3hzTERZd05EUTRPVGN5T0RVMk16RXhPU3d4Tnpjc1cxc3RNU3d6TWl4dWRXeHNMREFzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzTmpJeE56WTNPVGs0T0RnNE1USXdMRzUxYkd3c1cxc3hNU3cxTmpFeU5UQTNOREEyTURZNU9UVmRMRnM0TERCZExGczNMRnN4TlYxZFhWMWRMRnRiTVRJc016VXNiblZzYkN3M016Z3pNalk1TmpnME5Ua3pOakFzTUN4dWRXeHNMRnRiTUN4Yk1UVmRYVjFkTEZzeE1pdzVNQ3dpVUdoNWMybGpjeUlzTWpRNE5UYzVPREUzTWpnNE16TTRMREFzYm5Wc2JDeGJXekFzV3prNFhWMWRYU3hiTVRJc09URXNJbEJvZVhOcFkzTWlMREl6TlRNM05URTJOREV5T1RBME1Td3dMRzUxYkd3c1cxc3dMRnM1TTExZFhWMWRYVjFkTEZzd0xEQXNabUZzYzJVc2JuVnNiQ3d4TlRVM05UUTVNRFUzTmpjek1UVXNNVGM0TEZ0YkxURXNNeklzYm5Wc2JDd3dMR1poYkhObExHWmhiSE5sTEdaaGJITmxMRGMxTVRFNU16QXpNRFkwTmpZeU55eHVkV3hzTEZ0Yk1URXNOek0xTnpjNE5qTXpORGswT0RZelhTeGJPQ3d3WFN4Yk55eGJObDFkWFYwc1d6TXhMRE16TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4MGNuVmxMRE0yTXpjMk5UZzBOemMxT1RBNE1DeHVkV3hzTEZ0Yk1DeGJPVGxkWFYxZFhTeGJXek14TERnNExHNTFiR3dzTVRNM09ESTVORE0zTVRFMU5qTTNMREkxT1N4dWRXeHNMRnRiTkN3eE1sMHNXelVzV3pJeVhWMHNXemNzV3pKZFhTeGJNVFlzWm1Gc2MyVmRYVjBzV3pFeUxEZzVMRzUxYkd3c05URXdORFkyT0RJMk9ERXlOekV6TERBc2JuVnNiQ3hiV3pNc01WMHNXelFzTXpaZFhWMWRMRnRiTUN3d0xHWmhiSE5sTEc1MWJHd3NPRGc0TkRNek9ERTRPVEV5TXpNMUxERTNPU3hiV3kweExETXlMRzUxYkd3c01DeG1ZV3h6WlN4bVlXeHpaU3htWVd4elpTdzNORFU1TnpRek5ETXlNVFV4TURJc2JuVnNiQ3hiV3pFeExEVTJNVEkxTURjME1EWXdOams1TlYwc1d6Z3NNRjBzV3pjc1d6SmRYVjFkWFN4Yld6RXlMRE0xTEc1MWJHd3NNamd4TmpNeU5qWTFNakUzTWpJM0xEQXNiblZzYkN4Yld6QXNXekpkWFYxZExGc3hNaXc1TUN3aVVHaDVjMmxqY3lJc05EVTBNVGM0TkRBek1qUXpPRFUwTERBc2JuVnNiQ3hiV3pBc1d6TTNYVjFkWFN4Yk1USXNPVEVzSWxCb2VYTnBZM01pTERneU5Ua3dNRGN3TnpReU5ERTVPU3d3TEc1MWJHd3NXMXN3TEZzNU0xMWRYVjFkWFN4Yk1Dd3dMR1poYkhObExHNTFiR3dzTWpRM01ETTJPVEF4TURNM09EYzNMREU0TUN4Yld5MHhMRE15TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4bVlXeHpaU3c0TmpjeU9ERXpNVFUwTnprek5EY3NiblZzYkN4Yld6RXhMRFUyTVRJMU1EYzBNRFl3TmprNU5WMHNXemdzTUYwc1d6Y3NXelpkWFYxZFhTeGJXekV5TERNMUxHNTFiR3dzT0RjMU5UWXdORGN5T0RVeU9USXpMREFzYm5Wc2JDeGJXekFzV3paZFhWMWRMRnN4TWl3NU1Dd2lVR2g1YzJsamN5SXNPVEl4TURJM05ESTVNams1TWpNMkxEQXNiblZzYkN4Yld6QXNXemswWFYxZFhTeGJNVElzT1RFc0lsQm9lWE5wWTNNaUxEVTFOVGswTVRReE5EYzBOalU0TWl3d0xHNTFiR3dzVzFzd0xGczVOVjFkWFYxZFhTeGJNQ3d3TEdaaGJITmxMRzUxYkd3c09EYzFNelk0TkRJME56UTFOalkyTERFNE1TeGJXeTB4TERNeUxHNTFiR3dzTUN4bVlXeHpaU3htWVd4elpTeG1ZV3h6WlN3M056WTRNVE13TVRZeU5EWXpNVFFzYm5Wc2JDeGJXekV4TERVMk1USTFNRGMwTURZd05qazVOVjBzV3pnc01GMHNXemNzV3pFelhWMWRYVjBzVzFzeE1pd3pOU3h1ZFd4c0xEazFOREEwTXpJeE1qSTRNVEkwTnl3d0xHNTFiR3dzVzFzd0xGc3hNMTFkWFYwc1d6RXlMRGt3TENKUWFIbHphV056SWl3NU16TTBNakV6TkRnMk1EVTJPVEFzTUN4dWRXeHNMRnRiTUN4Yk9UWmRYVjFkTEZzeE1pdzVNU3dpVUdoNWMybGpjeUlzTVRBMk1qYzRNek0zTXpJM056RTFMREFzYm5Wc2JDeGJXekFzV3prelhWMWRYVjFkTEZzd0xEQXNabUZzYzJVc2JuVnNiQ3cxTlRVM05qWXpNVGc0TWprNE56a3NNVGd5TEZ0YkxURXNNeklzYm5Wc2JDd3dMR1poYkhObExHWmhiSE5sTEdaaGJITmxMRFUxTnpNMk16SXlNak00TmpBNU1peHVkV3hzTEZ0Yk1URXNOVFl4TWpVd056UXdOakEyT1RrMVhTeGJPQ3d3WFN4Yk55eGJNVEZkWFYxZFhTeGJXekV5TERNMUxHNTFiR3dzT0RRek56QTVPVEE0TVRFME9UZ3dMREFzYm5Wc2JDeGJXekFzV3pFeFhWMWRYU3hiTVRJc09UQXNJbEJvZVhOcFkzTWlMRGsxTXpreU9UWTVOakUyTVRjeE5Td3dMRzUxYkd3c1cxc3dMRnN6TjExZFhWMHNXekV5TERreExDSlFhSGx6YVdOeklpdzNOVE01TURVek16Y3dPRFU1TURBc01DeHVkV3hzTEZ0Yk1DeGJPVGRkWFYxZFhWMHNXekFzTUN4bVlXeHpaU3h1ZFd4c0xEUTRPVFEyTmpVd05qQTBORGcyTWl3eE9ETXNXMXN0TVN3ek1peHVkV3hzTERBc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc01qYzFNelk0TkRRd05qSXhNalUzTEc1MWJHd3NXMXN4TVN3MU5qRXlOVEEzTkRBMk1EWTVPVFZkTEZzNExEQmRMRnMzTEZzNVhWMWRYVjBzVzFzeE1pd3pOU3h1ZFd4c0xEWXlORFV5TlRNek1UVXhOalkxT1N3d0xHNTFiR3dzVzFzd0xGczVYVjFkWFN4Yk1USXNPVEFzSWxCb2VYTnBZM01pTERJMU56RXpOalExTkRneE1ERTJPU3d3TEc1MWJHd3NXMXN3TEZzek4xMWRYVjBzV3pFeUxEa3hMQ0pRYUhsemFXTnpJaXd6T0RJeE5UYzFOalV3TnpRNU9EVXNNQ3h1ZFd4c0xGdGJNQ3hiT1RSZFhWMWRYVjBzV3pBc01DeG1ZV3h6WlN4dWRXeHNMREUzT1RReE9EUTNOalkzTURnM05Td3hPRFFzVzFzdE1Td3pNaXh1ZFd4c0xEQXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNOREF3T1RBME5ERTROekk0TmpjeExHNTFiR3dzVzFzeE1TdzFOakV5TlRBM05EQTJNRFk1T1RWZExGczRMREJkTEZzM0xGc3hOVjFkWFYxZExGdGJNVElzTXpVc2JuVnNiQ3cxTVRZeE5qQXhPRFE0T1RnMU1UZ3NNQ3h1ZFd4c0xGdGJNQ3hiTVRWZFhWMWRMRnN4TWl3NU1Dd2lVR2g1YzJsamN5SXNOekl6TlRBek16VTFNVFEyT1RjeUxEQXNiblZzYkN4Yld6QXNXems0WFYxZFhTeGJNVElzT1RFc0lsQm9lWE5wWTNNaUxEWTFPRFl6TURVMU1qY3hPREF3TWl3d0xHNTFiR3dzVzFzd0xGczVNMTFkWFYxZFhWMWRMRnN3TERBc1ptRnNjMlVzYm5Wc2JDd3pORE01TlRVMk5EWTJORFF6Tnpjc01UZzFMRnRiTFRFc016SXNiblZzYkN3d0xHWmhiSE5sTEdaaGJITmxMR1poYkhObExEUTNPVFkzT0RnMk5UY3lNVEV6TkN4dWRXeHNMRnRiTVRFc05qYzNPRE15TmpBNU16UXpNVGd4WFN4Yk9Dd3dYU3hiTnl4Yk1sMWRYVjFkTEZ0Yk1qa3NNelFzYm5Wc2JDd3lORGsxTnpnNU5EVXpOemczTURVc01DeHVkV3hzTEZ0Yk15d3hYVjFkTEZzeU9Td3pOU3h1ZFd4c0xEYzBPVE0zTkRNeU5UVXdOekl6T0N3d0xHNTFiR3dzVzFzd0xGc3lYVjFkWFN4Yk9DdzVNaXh1ZFd4c0xEZ3lORFkxTURBM05UYzNNRGt4T0N3d0xHNTFiR3dzVzFzekxERmRYVjBzV3prc09USXNiblZzYkN3NE9UWXpNamM0TWpVd01EUTBNRFFzTUN4dWRXeHNMRnRiTXl3d1hWMWRMRnN4TUN3NU1peHVkV3hzTERrMU5EYzBPVE15TmpRNU9EUXhOU3d3TEc1MWJHd3NXMXN6TERCZFhWMHNXekV4TERreUxHNTFiR3dzT1Rrd056VTVOVGMxTWpZNE5qSXpMREFzYm5Wc2JDeGJXek1zTUYxZFhTeGJNVGdzT1RJc2JuVnNiQ3cwTWpBek16a3dOamN3T1Rnek1UWXNNQ3h1ZFd4c0xGdGJNeXd4WFYxZExGc3hPQ3c1TXl3aVVHaDVjMmxqY3lJc01qTXpNVE13TVRJME1ERXpPVGN6TERBc2JuVnNiQ3hiV3pBc1d6TTNYVjFkWFN4Yk1Ua3NPVElzYm5Wc2JDd3lNelExTVRnMk1EUXlOak15TnpVc01DeHVkV3hzTEZ0Yk15d3dYVjFkTEZzeU1DdzVNaXh1ZFd4c0xETTBNekUxTkRjME16STBOamN3TUN3d0xHNTFiR3dzVzFzekxEQmRYVjBzV3pJeExEa3lMRzUxYkd3c01UQTJOREkxT1RFNU9UZ3lOak16TERBc2JuVnNiQ3hiV3pNc01GMWRYU3hiTVRZc016UXNiblZzYkN3NE1EZ3dNVEU1T0RRd05Ea3lNalVzTUN4dWRXeHNMRnRiTXl3eFhWMWRMRnN4Tml3NU5DeHVkV3hzTERjNE5UTTBOVGMyTkRZM05UTTFPU3d3TEc1MWJHd3NXMXN4TEZzeE1EQmRYU3hiTXl3d1hWMWRMRnN4Tml3NU5Td2lRblZzYkdWMElpdzBNemcwTVRNek9UUTNOemcwTlRZc01DeHVkV3hzTEZ0Yk1DeGJNemxkWFYxZExGc3lOeXd5Tml4dWRXeHNMRFV5TkRjNE5EazROamd6TVRNNE1Td3dMRzUxYkd3c1cxc3pMREJkWFYwc1d6STRMREkyTEc1MWJHd3NOall5TURjNE9ESTJOak0yTXpVMUxEQXNiblZzYkN4Yld6TXNNRjFkWFN4YkxURXNOVGtzYm5Wc2JDd3hOelV4TlRnM05EY3dOamd4T0RRc01DeHVkV3hzTEZ0Yk1URXNNVFV5TmpNMU5USTRNakkyT0RJeFhTeGJOeXhiTmpGZFhWMWRMRnN4TXl3M055d2lVR2g1YzJsamN5SXNOVE15TWpBNE56ZzRPREk0TWpNeExEQXNiblZzYkN4Yld6QXNXelF6TEZzekxERTFNall6TlRVeU9ESXlOamd5TVYxZFhWMWRYVjBzV3pBc01DeG1ZV3h6WlN4dWRXeHNMREUyTkRjek56TTNPVEF3TURJMU5pd3hPRFlzVzFzdE1Td3pNaXh1ZFd4c0xEQXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNORFl6T1RBMU16Y3dOVGs1TnpJd0xHNTFiR3dzVzFzeE1TdzJOemM0TXpJMk1Ea3pORE14T0RGZExGczRMREJkTEZzM0xGczJYVjFkWFYwc1cxc3lPU3d6TkN4dWRXeHNMREV5TXpFMk1ESTBPVGN6TXpFMk9Dd3dMRzUxYkd3c1cxc3pMREZkWFYwc1d6STVMRE0xTEc1MWJHd3NNakUxTVRReE1EVXpNRFl6TVRjNUxEQXNiblZzYkN4Yld6QXNXelpkWFYxZExGczRMRGt5TEc1MWJHd3NOamMwTkRjMU5ETXpPREUzTmpFd0xEQXNiblZzYkN4Yld6TXNNRjFkWFN4Yk9TdzVNaXh1ZFd4c0xEa3lPRFE1T0RRNE9URTFNakkwT0N3d0xHNTFiR3dzVzFzekxERmRYVjBzV3pFd0xEa3lMRzUxYkd3c01qUXhPVGt6TXpZMU5UQTNPRGM0TERBc2JuVnNiQ3hiV3pNc01GMWRYU3hiTVRFc09USXNiblZzYkN3ek16SXpNVEkyT0RZNE9UTTBOak1zTUN4dWRXeHNMRnRiTXl3d1hWMWRMRnN4T0N3NU1peHVkV3hzTERnMU5USTFNamszTURreU1ESTFOQ3d3TEc1MWJHd3NXMXN6TERCZFhWMHNXekU0TERrekxDSlFhSGx6YVdOeklpdzFPVGN4T0Rnek5qQTBOamt4TnpNc01DeHVkV3hzTEZ0Yk1DeGJNemRkWFYxZExGc3hPU3c1TWl4dWRXeHNMREU0TXpRMk1EQXhNakExTVRNM015d3dMRzUxYkd3c1cxc3pMREZkWFYwc1d6SXdMRGt5TEc1MWJHd3NPRFkwTWpNMk5EWXdPVEl5TURVMkxEQXNiblZzYkN4Yld6TXNNRjFkWFN4Yk1qRXNPVElzYm5Wc2JDd3pNekExTlRnMU5ETXdOalV4TmpBc01DeHVkV3hzTEZ0Yk15d3dYVjFkTEZzeE5pd3pOQ3h1ZFd4c0xEZ3pPVFU1TURNME1UYzJORFk0Tnl3d0xHNTFiR3dzVzFzekxERmRYVjBzV3pFMkxEazBMRzUxYkd3c016a3lOamczT1RRMk9UY3lNakkyTERBc2JuVnNiQ3hiV3pFc1d6RXdNVjFkTEZzekxEQmRYVjBzV3pFMkxEazFMQ0pDZFd4c1pYUWlMRFk1TVRZek9EQXpOalEwTVRRek1pd3dMRzUxYkd3c1cxc3dMRnN6T1YxZFhWMHNXekkzTERJMkxHNTFiR3dzTlRjMU5EWTNPVE13TmpVMU9EWXpMREFzYm5Wc2JDeGJXek1zTUYxZFhTeGJNamdzTWpZc2JuVnNiQ3d5TnpnNE5qZ3pNekl3TWpnek9UQXNNQ3h1ZFd4c0xGdGJNeXd3WFYxZExGc3RNU3cxT1N4dWRXeHNMRGc0TURRNE1qYzJORFk1TVRRM05pd3dMRzUxYkd3c1cxc3hNU3d4TlRJMk16VTFNamd5TWpZNE1qRmRMRnMzTEZzMk1WMWRYVjBzV3pFekxEYzNMQ0pRYUhsemFXTnpJaXczT0RZM01UVXpPVEl5T0RnNU5qWXNNQ3h1ZFd4c0xGdGJNQ3hiTkRNc1d6TXNNVFV5TmpNMU5USTRNakkyT0RJeFhWMWRYVjFkWFN4Yk1Dd3dMR1poYkhObExHNTFiR3dzTXpVd01qQXdORFUzTURVMk9UZ3hMREU0Tnl4Yld5MHhMRE15TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4bVlXeHpaU3d5TURBME1UZzVPRGs0TkRFNU9URXNiblZzYkN4Yld6RXhMRFkzTnpnek1qWXdPVE0wTXpFNE1WMHNXemdzTUYwc1d6Y3NXekV6WFYxZFhWMHNXMXN5T1N3ek5DeHVkV3hzTERVM09ETXdNVFkzT1RJME5qRTVOaXd3TEc1MWJHd3NXMXN6TERCZFhWMHNXemdzT1RJc2JuVnNiQ3cxTVRjeU5EWXpNREl4T0RRMk5EVXNNQ3h1ZFd4c0xGdGJNeXd3WFYxZExGczVMRGt5TEc1MWJHd3NOelU1TURnek5qZzFNREUyTXpFekxEQXNiblZzYkN4Yld6TXNNRjFkWFN4Yk1UQXNPVElzYm5Wc2JDdzVNamcwTURJM05UZzFPVEkwTlRRc01DeHVkV3hzTEZ0Yk15d3hYVjFkTEZzeE1TdzVNaXh1ZFd4c0xEUXdNVGMyTmpFNU1Ua3dNekkwTnl3d0xHNTFiR3dzVzFzekxEQmRYVjBzV3pFNExEa3lMRzUxYkd3c09ETTBNVE13TmpVeE5qSXhNREU0TERBc2JuVnNiQ3hiV3pNc01GMWRYU3hiTVRnc09UTXNJbEJvZVhOcFkzTWlMRGMwTmpFME56ZzBOek0wT0RBMU1pd3dMRzUxYkd3c1cxc3dMRnN4TURKZFhWMWRMRnN4T1N3NU1peHVkV3hzTERjMk1UUXpOVGt6TnpReE1qRXpOaXd3TEc1MWJHd3NXMXN6TERCZFhWMHNXekl3TERreUxHNTFiR3dzTXpjeE1EVXpPVEkzTmpZek1qWTFMREFzYm5Wc2JDeGJXek1zTVYxZFhTeGJNakVzT1RJc2JuVnNiQ3d5TkRBeE1UTTJPVFV6TVRZM056WXNNQ3h1ZFd4c0xGdGJNeXd3WFYxZExGc3hOaXd6TkN4dWRXeHNMRFkzTXpjMU5qSXhNakk0T0RnMU55d3dMRzUxYkd3c1cxc3pMREJkWFYwc1d6STNMREkyTEc1MWJHd3NNVEk0TXpRMk5USTRNak0wT0RZMExEQXNiblZzYkN4Yld6TXNNVjFkWFN4Yk1qZ3NNallzYm5Wc2JDdzRNall5T0RnM01qWTFPRFl6TWpRc01DeHVkV3hzTEZ0Yk15d3dYVjFkTEZzdE1TdzFPU3h1ZFd4c0xEVXlNREF6TWpnMk9EVTVOVGN5T1N3d0xHNTFiR3dzVzFzeE1Td3hOVEkyTXpVMU1qZ3lNalk0TWpGZExGczNMRnMyTVYxZFhWMHNXekV6TERjM0xDSlFhSGx6YVdOeklpdzRPVGszTmpBMk56VTJNamd5TmpZc01DeHVkV3hzTEZ0Yk1DeGJORE1zV3pNc01UVXlOak0xTlRJNE1qSTJPREl4WFYxZFhWMWRYU3hiTUN3d0xHWmhiSE5sTEc1MWJHd3NOamsyT1RBeE1qYzROekEwTXpBekxERTRPQ3hiV3kweExETXlMRzUxYkd3c01DeG1ZV3h6WlN4bVlXeHpaU3htWVd4elpTdzVNakV4TkRrNU1UYzJORGt3Tnpjc2JuVnNiQ3hiV3pFeExEWTNOemd6TWpZd09UTTBNekU0TVYwc1d6Z3NNRjBzV3pjc1d6RXhYVjFkWFYwc1cxc3lPU3d6TkN4dWRXeHNMRGczTnpJMk5qTTNNalF6TURFeU5Dd3dMRzUxYkd3c1cxc3pMREZkWFYwc1d6STVMRE0xTEc1MWJHd3NOemN5TkRVMk16QTFNekUzT1RRd0xEQXNiblZzYkN4Yld6QXNXekpkWFYxZExGczRMRGt5TEc1MWJHd3NPVEk1T1RJeE1UazRNVEEwTlRRMUxEQXNiblZzYkN4Yld6TXNNVjFkWFN4Yk9TdzVNaXh1ZFd4c0xEWTFPVEU1TWpjeU1qYzRNemt3Tml3d0xHNTFiR3dzVzFzekxEQmRYVjBzV3pFd0xEa3lMRzUxYkd3c016YzVOVFkxT0RJek5EVXdNRFUxTERBc2JuVnNiQ3hiV3pNc01GMWRYU3hiTVRFc09USXNiblZzYkN3ME5ERTBOek0zT1RrM05qTTRNamNzTUN4dWRXeHNMRnRiTXl3d1hWMWRMRnN4T0N3NU1peHVkV3hzTERJeE1qWTJPRE01TVRjME16QTFNaXd3TEc1MWJHd3NXMXN6TERGZFhWMHNXekU0TERrekxDSlFhSGx6YVdOeklpd3lOVEF3TlRVeE5ETTBOalkzT0RNc01DeHVkV3hzTEZ0Yk1DeGJNemRkWFYxZExGc3hPU3c1TWl4dWRXeHNMRGd6TWpZNU5UTXdOVEUzT1RBM09Td3dMRzUxYkd3c1cxc3pMREJkWFYwc1d6SXdMRGt5TEc1MWJHd3NOalkwTXpNM09UVXlNemN4T0RReUxEQXNiblZzYkN4Yld6TXNNRjFkWFN4Yk1qRXNPVElzYm5Wc2JDd3hOVEU1T1RBMU5EQTRNREUwTlRNc01DeHVkV3hzTEZ0Yk15d3dYVjFkTEZzeE5pd3pOQ3h1ZFd4c0xEY3dPVEEyT1RVeE56YzNNalkyTVN3d0xHNTFiR3dzVzFzekxERmRYVjBzV3pJM0xESTJMRzUxYkd3c05EUXpOakV4T0RNeE56QTRNelEwTERBc2JuVnNiQ3hiV3pNc01GMWRYU3hiTWpnc01qWXNiblZzYkN3Mk9USTFPRGN5TVRZek1UTXpPVElzTUN4dWRXeHNMRnRiTXl3d1hWMWRMRnN5T0N3NU5peHVkV3hzTERFek16TTVOVEEzTVRNeU56UTNOQ3d3TEc1MWJHd3NXMXN4TUN3eFhTeGJOeXhiTnpSZFhWMWRMRnN5T0N3NU5peHVkV3hzTERJNU9ETXpPRE0xTXpreE1USTNPQ3d3TEc1MWJHd3NXMXN4TUN3eVhTeGJOeXhiT0RKZFhWMWRMRnN5T0N3NU5peHVkV3hzTERJME1qUXhNRGswT0RjME5URTNPU3d3TEc1MWJHd3NXMXN4TUN3eFhTeGJOeXhiTkRNc1d6TXNNamcwT1RJM09UUTJNekl6TURrMVhWMWRYVjBzV3kweExEVTVMRzUxYkd3c01qZzRNakU0T1RBM05UUTJPRGN5TERBc2JuVnNiQ3hiV3pFeExERTFNall6TlRVeU9ESXlOamd5TVYwc1d6Y3NXell4WFYxZFhTeGJNVE1zTnpjc0lsQm9lWE5wWTNNaUxETTNNRE15TXpjeE9UZzBNekV5TkN3d0xHNTFiR3dzVzFzd0xGczBNeXhiTXl3eE5USTJNelUxTWpneU1qWTRNakZkWFYxZFhWMHNXMXN3TERBc1ptRnNjMlVzYm5Wc2JDdzJOVFkzTWpVeU1UZ3dOak14TURVc01UZzVMRnRiTWpnc016RXNiblZzYkN3d0xHWmhiSE5sTEdaaGJITmxMR1poYkhObExEa3lNamM1TkRFMk1USXhOemcxTVN4dWRXeHNMRnRiTVRBc01WMHNXemdzTUYwc1d6Y3NXekpkWFYxZExGc3lPQ3d6TVN4dWRXeHNMREFzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzTkRrMU5qSTJOVEl6TlRZMU56STNMRzUxYkd3c1cxc3hNQ3d3WFN4Yk9Dd3dYU3hiTnl4Yk1sMWRYVjFkTEZ0Yk1qZ3NNallzYm5Wc2JDdzROalEzTlRjd01qazFORFF4TURZc01DeHVkV3hzTEZ0Yk15d3hYVjFkWFN4Yld6QXNNQ3htWVd4elpTeHVkV3hzTERVNU1EUTRPREk0TlRFNE5qVTNPQ3d4T1RBc1cxc3lPQ3d6TVN4dWRXeHNMREFzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzTmpnek1qZ3dNVFkxTnpReU1URTFMRzUxYkd3c1cxc3hNQ3d5WFN4Yk9Dd3dYU3hiTnl4Yk9ESmRYVjFkWFN4Yld6STRMRGszTEc1MWJHd3NOalE1TlRrMU1ERTNOekV6TkRRMExEQXNiblZzYkN4Yld6QXNXekV5WFYxZFhTeGJNVFlzT1RVc0lrSjFiR3hsZENJc09ERTFNelUxTmprM09UYzVPRFU0TERBc2JuVnNiQ3hiV3pBc1d6Z3lYVjFkWFN4Yk1UWXNPVGdzYm5Wc2JDd3hPREUyTlRVME9ETTBOVE0wTXpjc01DeHVkV3hzTEZ0Yk1UQXNNRjBzV3pjc1d6SmRYVjFkWFYwc1d6QXNNQ3htWVd4elpTeHVkV3hzTERJNE16QXhOek0yTnpjNU5UWTFPU3d4T1RFc1cxc3lPQ3d6TVN4dWRXeHNMREFzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzTnprek16VTFOak0zTnpJME16WXpMRzUxYkd3c1cxc3hNQ3d5WFN4Yk9Dd3dYU3hiTnl4Yk16WmRYVjFkWFN4Yld6STRMRGszTEc1MWJHd3NOakV3TnpRek1EQTJNVGczTURZd0xEQXNiblZzYkN4Yld6QXNXekV3TTExZFhWMHNXekUyTERrMUxDSkNkV3hzWlhRaUxETTFOelkzT0Rnek1EQTNOakU0Tml3d0xHNTFiR3dzVzFzd0xGc3pObDFkWFYwc1d6RTJMRGs0TEc1MWJHd3NOak0xTURJMU9EVXdNall5TURjMExEQXNiblZzYkN4Yld6RXdMREJkTEZzM0xGc3lYVjFkWFYxZFhWMHNXekFzTUN4bVlXeHpaU3h1ZFd4c0xETTROREEwTVRFeU5Ua3pNREF5T1N3eE9USXNXMXN5T0N3ek1TeHVkV3hzTERBc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc01UZ3lOemM0TWpFM05ESTJPRE0zTEc1MWJHd3NXMXN4TUN3eFhTeGJPQ3d3WFN4Yk55eGJObDFkWFYwc1d6STRMRE14TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4bVlXeHpaU3d5TlRrME1Ua3hNelUxTlRFME1UQXNiblZzYkN4Yld6RXdMREJkTEZzNExEQmRMRnMzTEZzMlhWMWRYVjBzVzFzeU9Dd3lOaXh1ZFd4c0xEUXlPRE15TkRNMk1qZ3lPVEl6T1N3d0xHNTFiR3dzVzFzekxERmRYVjFkTEZ0Yk1Dd3dMR1poYkhObExHNTFiR3dzT0RJM056VTJOVGc1TXpBMU1UWTBMREU1TXl4Yld6STRMRE14TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4bVlXeHpaU3d4TVRJM05qRTBPREkyT0RVMk1qZ3NiblZzYkN4Yld6RXdMREpkTEZzNExEQmRMRnMzTEZzNE1sMWRYVjFkTEZ0Yk1qZ3NPVGNzYm5Wc2JDd3lNamMxT1RFMk56UXhNakF3TURZc01DeHVkV3hzTEZ0Yk1DeGJNVEpkWFYxZExGc3hOaXc1TlN3aVFuVnNiR1YwSWl3NE9USXdOak14TWpJeE1qWTFNalFzTUN4dWRXeHNMRnRiTUN4Yk1UQTBYVjFkWFN4Yk1UWXNPVGdzYm5Wc2JDdzNNVGs1TURjM05UUXlNamczTXpRc01DeHVkV3hzTEZ0Yk1UQXNNRjBzV3pjc1d6Z3hYVjFkWFYxZExGc3dMREFzWm1Gc2MyVXNiblZzYkN3NU5EUXlOalkzTlRFek1EZzNOaklzTVRrMExGdGJNamdzTXpFc2JuVnNiQ3d3TEdaaGJITmxMR1poYkhObExHWmhiSE5sTERNMU1EUXpOVEE1TlRVek5qZ3pPQ3h1ZFd4c0xGdGJNVEFzTWwwc1d6Z3NNRjBzV3pjc1d6TTJYVjFkWFYwc1cxc3lPQ3c1Tnl4dWRXeHNMRFl5TXpBeU5EUXpORGt5TnpFME15d3dMRzUxYkd3c1cxc3dMRnN4TUROZFhWMWRMRnN4Tml3NU5Td2lRblZzYkdWMElpdzVOamd6T0RrMk1qRTFPVGM0TVRZc01DeHVkV3hzTEZ0Yk1DeGJNVEExWFYxZFhTeGJNVFlzT1Rnc2JuVnNiQ3d6TnpJeU5qQXhOemt4TURRek5URXNNQ3h1ZFd4c0xGdGJNVEFzTUYwc1d6Y3NXemd4WFYxZFhWMWRYVjFkWFN4Yk1Dd3dMR1poYkhObExHNTFiR3dzTlRVMU1EUXdNamMwTURnMk1qVXpMREU1TlN4Yld5MHhMRE15TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4bVlXeHpaU3d4T1RFME5ETTBNRFkxTkRFeU1qTXNiblZzYkN4Yld6RXhMRFkzTnpnek1qWXdPVE0wTXpFNE1WMHNXemdzTUYwc1d6Y3NXemxkWFYxZFhTeGJXekk1TERNMExHNTFiR3dzTXpZMU9EZ3pNRE16TlRNMU5EQTRMREFzYm5Wc2JDeGJXek1zTVYxZFhTeGJNamtzTXpVc2JuVnNiQ3c1TXpFek9ERTVNakl4TmpNMk1qSXNNQ3h1ZFd4c0xGdGJNQ3hiTVROZFhWMWRMRnM0TERreUxHNTFiR3dzTWpNNE1qRTBOelEwTnpjeE1USTNMREFzYm5Wc2JDeGJXek1zTUYxZFhTeGJPU3c1TWl4dWRXeHNMREV3TURnM09EVTBNVGsyTVRVMk55d3dMRzUxYkd3c1cxc3pMREJkWFYwc1d6RXdMRGt5TEc1MWJHd3NPVGszT1RjMk9ERXlPVE14T1RZeExEQXNiblZzYkN4Yld6TXNNRjFkWFN4Yk1URXNPVElzYm5Wc2JDdzJNVFF6TVRRd09UUXlPRFk0TlRVc01DeHVkV3hzTEZ0Yk15d3hYVjFkTEZzeE9DdzVNaXh1ZFd4c0xESXdNell3TWpNd01UUXlOamMyT0N3d0xHNTFiR3dzVzFzekxEQmRYVjBzV3pFNExEa3pMQ0pRYUhsemFXTnpJaXd4TVRBM01qRTBNVFUxTWprek9UVXNNQ3h1ZFd4c0xGdGJNQ3hiTXpkZFhWMWRMRnN4T1N3NU1peHVkV3hzTERreU9UY3dNVGswTnpjek1EZzBNeXd3TEc1MWJHd3NXMXN6TERCZFhWMHNXekl3TERreUxHNTFiR3dzTkRrM016UXdOVFUwT0RZeE5UYzJMREFzYm5Wc2JDeGJXek1zTUYxZFhTeGJNakVzT1RJc2JuVnNiQ3d4TlRVeE56RTJPVE15TXpNME56VXNNQ3h1ZFd4c0xGdGJNeXd4WFYxZExGc3hOaXd6TkN4dWRXeHNMRFl6TnpVeE1UY3dPRFV5TVRRME5Dd3dMRzUxYkd3c1cxc3pMREJkWFYwc1d6STNMREkyTEc1MWJHd3NOakE0TkRNeE9UZ3dPVGs1T1RZekxEQXNiblZzYkN4Yld6TXNNRjFkWFN4Yk1qZ3NNallzYm5Wc2JDdzFNemcyTURjNE5ESXlOakE1TlRrc01DeHVkV3hzTEZ0Yk15d3dYVjFkTEZzdE1TdzFPU3h1ZFd4c0xEY3dPRFl6TXpFeE5UWTRNRGMwTml3d0xHNTFiR3dzVzFzeE1Td3hOVEkyTXpVMU1qZ3lNalk0TWpGZExGczNMRnN6T1YxZFhWMHNXekV6TERjM0xDSlFhSGx6YVdOeklpdzNOamMxTkRZek56RXdNRFkyTURNc01DeHVkV3hzTEZ0Yk1DeGJORE1zV3pNc01UVXlOak0xTlRJNE1qSTJPREl4WFYxZFhWMWRYU3hiTUN3d0xHWmhiSE5sTEc1MWJHd3NPREExTXpVd09EUTVOems0TnpNNExERTVOaXhiV3kweExETXlMRzUxYkd3c01DeG1ZV3h6WlN4bVlXeHpaU3htWVd4elpTd3lOamc1T0RrNE1UTTFOak16TlRnc2JuVnNiQ3hiV3pFeExEZzNORGt5TlRjeE16Z3hOREEzTmwwc1d6Z3NNRjBzV3pjc1d6SmRYVjFkWFN4YlhTeGJXekFzTUN4bVlXeHpaU3h1ZFd4c0xEY3hPVFEzT0RZNU5UQTBNRFl3Tml3eE9UY3NXMXN4TXl3ek15eHVkV3hzTERBc1ptRnNjMlVzWm1Gc2MyVXNkSEoxWlN3eU1UZzJNRE15TmpBME5ERTROREVzYm5Wc2JDeGJXekFzV3pVMFhWMWRYVjBzVzFzeE15d3pOU3h1ZFd4c0xETTVOamszTnpJek5UWTJOakExT1N3d0xHNTFiR3dzVzFzd0xGc3hNVjFkWFYxZFhTeGJNQ3d3TEdaaGJITmxMRzUxYkd3c05qSTJNelEwTkRZeU9UWTBOekUyTERFNU9DeGJXek0wTERNekxHNTFiR3dzTUN4bVlXeHpaU3htWVd4elpTeDBjblZsTERnd09USXhNRGd5T0RZMk1EQTVPU3h1ZFd4c0xGdGJNQ3hiTmpOZFhWMWRYU3hiV3pNMExETTFMRzUxYkd3c05UQTJNek01TURJek1EZ3pOVFk0TERBc2JuVnNiQ3hiV3pBc1d6RXdObDFkWFYxZFhTeGJNQ3d3TEdaaGJITmxMRzUxYkd3c05UUTNNekUzTVRNM056STVOelUyTERFNU9TeGJXek0wTERNekxHNTFiR3dzTUN4bVlXeHpaU3htWVd4elpTeDBjblZsTERNMk5UQTFOVE0wTmpZNU5ESTBOaXh1ZFd4c0xGdGJNQ3hiTmpSZFhWMWRYU3hiV3pNMExETTFMRzUxYkd3c056STFNREl5TnpNMk9UVXpNVGs1TERBc2JuVnNiQ3hiV3pBc1d6WXlYVjFkWFYxZExGc3dMREFzWm1Gc2MyVXNiblZzYkN3ek16SXlNVEl6TURZMU5UWTNOVGtzTWpBd0xGdGJNelVzTXpNc2JuVnNiQ3d3TEdaaGJITmxMR1poYkhObExIUnlkV1VzTkRRNU56SXdNall6T0RrM09EUTRMRzUxYkd3c1cxc3dMRnMxTlYxZFhWMWRMRnRiTXpVc016VXNiblZzYkN3eE5UTXhNVFkyTWprd09EYzRNVFVzTUN4dWRXeHNMRnRiTUN4Yk1URmRYVjFkWFYwc1d6QXNNQ3htWVd4elpTeHVkV3hzTERNek5UQTJNVFUxTmpreE1qTXhOeXd5TURFc1cxc3lNaXd6TXl4dWRXeHNMREFzWm1Gc2MyVXNabUZzYzJVc2RISjFaU3czTlRJMU5UY3pOREkzTXpjNU16UXNiblZzYkN4Yld6QXNXelkxWFYxZFhWMHNXMTBzVzFzd0xEQXNabUZzYzJVc2JuVnNiQ3cyTWpFNE5ESXlOREl4TnpBNU1URXNNakF5TEZ0YkxURXNNeklzYm5Wc2JDd3dMR1poYkhObExHWmhiSE5sTEdaaGJITmxMRFEzT1Rjek1UVTFNRFl6TkRRME5peHVkV3hzTEZ0Yk1URXNORFEzTWprNU1UTTJORFkwTURFNFhTeGJPQ3d3WFN4Yk55eGJNbDFkWFYxZExGdGJNaklzTXpVc2JuVnNiQ3d5Tmpnd05EVTNPRFV4TlRNNE1qRXNNQ3h1ZFd4c0xGdGJNQ3hiTVRBM1hWMWRYVjFkTEZzd0xEQXNabUZzYzJVc2JuVnNiQ3c1TnpZek56UTFORGs0TkRZNU5EZ3NNakF6TEZ0YkxURXNNeklzYm5Wc2JDd3dMR1poYkhObExHWmhiSE5sTEdaaGJITmxMRFF5TURFek1ETXhPRFl6TlRBeE9DeHVkV3hzTEZ0Yk1URXNORFEzTWprNU1UTTJORFkwTURFNFhTeGJPQ3d3WFN4Yk55eGJObDFkWFYxZExGdGJNaklzTXpVc2JuVnNiQ3czTXpZM01qSTBNemt5TVRJMU5Ea3NNQ3h1ZFd4c0xGdGJNQ3hiTmpOZFhWMWRYVjBzV3pBc01DeG1ZV3h6WlN4dWRXeHNMRGc1TkRnMk16RTRNekl6TlRrMk9Td3lNRFFzVzFzdE1Td3pNaXh1ZFd4c0xEQXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNNVGN5TWpJM01UZzNPREEzTlRrMkxHNTFiR3dzVzFzeE1TdzBORGN5T1RreE16WTBOalF3TVRoZExGczRMREJkTEZzM0xGc3hNMTFkWFYxZExGdGJNaklzTXpVc2JuVnNiQ3c0TkRrd09ETTJNalEzTWpRd09Ua3NNQ3h1ZFd4c0xGdGJNQ3hiTlRWZFhWMWRYVjBzV3pBc01DeG1ZV3h6WlN4dWRXeHNMRGMyT1RReU9URTBOalU0TmprNE15d3lNRFVzVzFzdE1Td3pNaXh1ZFd4c0xEQXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNORFl5TVRJd01UZzVNVEE0TnpJekxHNTFiR3dzVzFzeE1TdzBORGN5T1RreE16WTBOalF3TVRoZExGczRMREJkTEZzM0xGc3hNVjFkWFYxZExGdGJNaklzTXpVc2JuVnNiQ3cwT1RZeU5ERTBNRE13TURBNE56SXNNQ3h1ZFd4c0xGdGJNQ3hiTjExZFhWMWRYU3hiTUN3d0xHWmhiSE5sTEc1MWJHd3NPVGN5TnpNME5UQTJNREkzTWpZMkxESXdOaXhiV3kweExETXlMRzUxYkd3c01DeG1ZV3h6WlN4bVlXeHpaU3htWVd4elpTdzVPVEUyTXpRNU5UTTJOVGd5TXprc2JuVnNiQ3hiV3pFeExEUTBOekk1T1RFek5qUTJOREF4T0Ywc1d6Z3NNRjBzV3pjc1d6bGRYVjFkWFN4Yld6SXlMRE0xTEc1MWJHd3NORGM1T0RRd05qWTFNek0yTXpBM0xEQXNiblZzYkN4Yld6QXNXelUwWFYxZFhWMWRMRnN3TERBc1ptRnNjMlVzYm5Wc2JDdzNPVGsyTXpRME9USTBOVEl5T0Rjc01qQTNMRnRiTFRFc016SXNiblZzYkN3d0xHWmhiSE5sTEdaaGJITmxMR1poYkhObExEZzNPREkxT1RNME1UZzNOVFU0TkN4dWRXeHNMRnRiTVRFc05EUTNNams1TVRNMk5EWTBNREU0WFN4Yk9Dd3dYU3hiTnl4Yk1UVmRYVjFkWFN4Yld6SXlMRE0xTEc1MWJHd3NNek15TnpNNE5UVTROams0T1RNMExEQXNiblZzYkN4Yld6QXNXelkxWFYxZFhWMWRMRnN3TERBc1ptRnNjMlVzYm5Wc2JDdzVNamMxTVRJek56SXhNalF4TURJc01qQTRMRnRiTFRFc016SXNiblZzYkN3d0xHWmhiSE5sTEdaaGJITmxMR1poYkhObExESXhPREUwT0RreE16YzVOekEwT0N4dWRXeHNMRnRiTVRFc05EUTNNams1TVRNMk5EWTBNREU0WFN4Yk9Dd3dYU3hiTnl4Yk16UmRYVjFkWFN4Yld6SXlMRE0xTEc1MWJHd3NPVEUxT0RJNE1Ua3lPVFl4TlRFMUxEQXNiblZzYkN4Yld6QXNXelk0WFYxZFhWMWRYVjBzV3pBc01DeG1ZV3h6WlN4dWRXeHNMRFkwTVRNd05UUXpNak01T1RNd05Td3lNRGtzVzFzeE15d3pNeXh1ZFd4c0xEQXNabUZzYzJVc1ptRnNjMlVzZEhKMVpTdzVPRGd4TlRZM05EWXhNVE0wTURJc2JuVnNiQ3hiV3pBc1d6VTRYVjFkWFYwc1cxc3hNeXd6TlN4dWRXeHNMRFUzT1RZNE9URTFORFF4TmprME1Dd3dMRzUxYkd3c1cxc3dMRnN4TVYxZFhWMWRYU3hiTUN3d0xHWmhiSE5sTEc1MWJHd3NORFEwTVRRd056Z3pPREF6TmpReExESXhNQ3hiV3pNMExETXpMRzUxYkd3c01DeG1ZV3h6WlN4bVlXeHpaU3gwY25WbExEZzFPVFF6T1RBek9ESTNPVEEzTWl4dWRXeHNMRnRiTUN4Yk5qaGRYVjFkWFN4Yld6TTBMRE0xTEc1MWJHd3NNVGcwTnpnM056azBORFEyTkRNM0xEQXNiblZzYkN4Yld6QXNXekV3T0YxZFhWMWRYU3hiTUN3d0xHWmhiSE5sTEc1MWJHd3NOemt5TlRNME56QTRNekEwTkRVeExESXhNU3hiV3pNMExETXpMRzUxYkd3c01DeG1ZV3h6WlN4bVlXeHpaU3gwY25WbExEVTNNamt5TURVeU9EazJOelV5TlN4dWRXeHNMRnRiTUN4Yk56QmRYVjFkWFN4Yld6TTBMRE0xTEc1MWJHd3NOREF5TXpVNE16a3lPVEV3TlRrd0xEQXNiblZzYkN4Yld6QXNXemN6WFYxZFhWMWRMRnN3TERBc1ptRnNjMlVzYm5Wc2JDdzNOakU1TWpJNE5ESTFPVGcxTVRjc01qRXlMRnRiTXpVc016TXNiblZzYkN3d0xHWmhiSE5sTEdaaGJITmxMSFJ5ZFdVc05UVTVOelV6TURRM09EVTNOREU0TEc1MWJHd3NXMXN3TEZzMU9WMWRYVjFkTEZ0Yk16VXNNelVzYm5Wc2JDdzROell6T1RBMU1USTBOamc0Tnpnc01DeHVkV3hzTEZ0Yk1DeGJNVEZkWFYxZFhWMHNXekFzTUN4bVlXeHpaU3h1ZFd4c0xEWXlORFV6TXpReE9UTTFNakl6Tml3eU1UTXNXMXN5TWl3ek15eHVkV3hzTERBc1ptRnNjMlVzWm1Gc2MyVXNkSEoxWlN3eE9UVTVOVGt5TlRReU9EVTJORE1zYm5Wc2JDeGJXekFzV3pZeFhWMWRYVjBzVzEwc1cxc3dMREFzWm1Gc2MyVXNiblZzYkN3NU9UQXpPVEl5T0RjME9EWXpNakFzTWpFMExGdGJMVEVzTXpJc2JuVnNiQ3d3TEdaaGJITmxMR1poYkhObExHWmhiSE5sTERNMk9UazRNekEwTVRneU9UWTVNU3h1ZFd4c0xGdGJNVEVzTkRRM01qazVNVE0yTkRZME1ERTRYU3hiT0N3d1hTeGJOeXhiTWwxZFhWMWRMRnRiTWpJc016VXNiblZzYkN3eE9EYzFNalV5T0RFd01UTTNPVGNzTUN4dWRXeHNMRnRiTUN4Yk1UQTNYVjFkWFYxZExGc3dMREFzWm1Gc2MyVXNiblZzYkN3eU5Ua3pNVGt6T1RJeE16Y3lPREFzTWpFMUxGdGJMVEVzTXpJc2JuVnNiQ3d3TEdaaGJITmxMR1poYkhObExHWmhiSE5sTERrNE5qWTBNREl4TWpreU5UWXlNU3h1ZFd4c0xGdGJNVEVzTkRRM01qazVNVE0yTkRZME1ERTRYU3hiT0N3d1hTeGJOeXhiTmwxZFhWMWRMRnRiTWpJc016VXNiblZzYkN3NU16RTBOamsyTXpneE16azBOemNzTUN4dWRXeHNMRnRiTUN4Yk5qTmRYVjFkWFYwc1d6QXNNQ3htWVd4elpTeHVkV3hzTERVek1qTXpORE00TkRVd05qRXhNU3d5TVRZc1cxc3RNU3d6TWl4dWRXeHNMREFzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzT1RZeU56WTJOVFF3TVRRd056QTBMRzUxYkd3c1cxc3hNU3cwTkRjeU9Ua3hNelkwTmpRd01UaGRMRnM0TERCZExGczNMRnN4TTExZFhWMWRMRnRiTWpJc016VXNiblZzYkN3ek16RTVNVGd5TVRJMU5UazVOelVzTUN4dWRXeHNMRnRiTUN4Yk5UVmRYVjFkWFYwc1d6QXNNQ3htWVd4elpTeHVkV3hzTERreE16Y3dNRGszTmpNNE5EYzBPU3d5TVRjc1cxc3RNU3d6TWl4dWRXeHNMREFzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzTVRBM05UTTVOekU0TnpNMU5qZ3dMRzUxYkd3c1cxc3hNU3cwTkRjeU9Ua3hNelkwTmpRd01UaGRMRnM0TERCZExGczNMRnN4TVYxZFhWMWRMRnRiTWpJc016VXNiblZzYkN3ek9EZzJPREF3T0RNeU9UVTNNakVzTUN4dWRXeHNMRnRiTUN4Yk4xMWRYVjFkWFN4Yk1Dd3dMR1poYkhObExHNTFiR3dzT1RVNU1UWTJOamd4TVRVeE5qTTNMREl4T0N4Yld5MHhMRE15TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4bVlXeHpaU3d6TkRVME9UazNPVGt5TWpBeE5qY3NiblZzYkN4Yld6RXhMRFEwTnpJNU9URXpOalEyTkRBeE9GMHNXemdzTUYwc1d6Y3NXemxkWFYxZFhTeGJXekl5TERNMUxHNTFiR3dzT0RBd01EZ3hPREl6TkRrd01UTTBMREFzYm5Wc2JDeGJXekFzV3pVMFhWMWRYVjFkTEZzd0xEQXNabUZzYzJVc2JuVnNiQ3cxTnpZMk5qUXlOelF5T1Rjd016QXNNakU1TEZ0YkxURXNNeklzYm5Wc2JDd3dMR1poYkhObExHWmhiSE5sTEdaaGJITmxMRFUzT1RFMU5EYzNOelU1TURjek1DeHVkV3hzTEZ0Yk1URXNORFEzTWprNU1UTTJORFkwTURFNFhTeGJPQ3d3WFN4Yk55eGJNVFZkWFYxZFhTeGJXekl5TERNMUxHNTFiR3dzTmpBd01qWTFNamsxTXpZeU1UTTFMREFzYm5Wc2JDeGJXekFzV3pZMVhWMWRYVjFkTEZzd0xEQXNabUZzYzJVc2JuVnNiQ3c1T1RneE5USTFPREl6TWpZMk1EUXNNakl3TEZ0YkxURXNNeklzYm5Wc2JDd3dMR1poYkhObExHWmhiSE5sTEdaaGJITmxMRGM0TXpBME5UUTBNRFExTlRnek5peHVkV3hzTEZ0Yk1URXNORFEzTWprNU1UTTJORFkwTURFNFhTeGJPQ3d3WFN4Yk55eGJNelJkWFYxZFhTeGJXekl5TERNMUxHNTFiR3dzT1RrMU16ZzNNakk1TURBME16QXhMREFzYm5Wc2JDeGJXekFzV3pZNFhWMWRYVjFkWFYwc1d6QXNNQ3htWVd4elpTeHVkV3hzTERnME1qWTJNRGd3Tmpnek9UYzNPQ3d5TWpFc1cxc3hNeXd6TXl4dWRXeHNMREFzWm1Gc2MyVXNabUZzYzJVc2RISjFaU3czTkRjek9UVTBOVEV6TWpBMU1ERXNiblZzYkN4Yld6QXNXek0wWFYxZFhWMHNXMXN4TXl3ek5TeHVkV3hzTERjek56Y3dOekUwTkRJMk1qazVOU3d3TEc1MWJHd3NXMXN3TEZzeE0xMWRYVjFkWFN4Yk1Dd3dMR1poYkhObExHNTFiR3dzT1RjME56ZzNNekV5TnprMU5qSTVMREl5TWl4Yld6TTBMRE16TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4MGNuVmxMRGt3TURrMk16STVOekV6T1Rrd01peHVkV3hzTEZ0Yk1DeGJOekpkWFYxZFhTeGJXek0wTERNMUxHNTFiR3dzTkRJNE5ERTROVE0wTkRVNE16UXlMREFzYm5Wc2JDeGJXekFzV3pNNVhWMWRYVjFkTEZzd0xEQXNabUZzYzJVc2JuVnNiQ3c1TnpRNE16TXlPRFExT1RZeU5EWXNNakl6TEZ0Yk16UXNNek1zYm5Wc2JDd3dMR1poYkhObExHWmhiSE5sTEhSeWRXVXNNVEkyTnpFeU9EQTJORGMwTlRjd0xHNTFiR3dzVzFzd0xGczNNMTFkWFYxZExGdGJNelFzTXpVc2JuVnNiQ3c0TWpRME9UTTBOVEE0TWpZek5EZ3NNQ3h1ZFd4c0xGdGJNQ3hiTnpKZFhWMWRYVjBzV3pBc01DeG1ZV3h6WlN4dWRXeHNMREV4TXpJeU56azVOREE0TnpVMk5Td3lNalFzVzFzek5Td3pNeXh1ZFd4c0xEQXNabUZzYzJVc1ptRnNjMlVzZEhKMVpTd3hNRGN4T1RNM01EUTJNakV5TmpRc2JuVnNiQ3hiV3pBc1d6TTVYVjFkWFYwc1cxc3pOU3d6TlN4dWRXeHNMRGMxTVRFMk9EUTFPVGMxTXpBNE1Dd3dMRzUxYkd3c1cxc3dMRnN4TTExZFhWMWRYU3hiTUN3d0xHWmhiSE5sTEc1MWJHd3NPVGN3TmpNMU5ESXlPRE01T1RZMUxESXlOU3hiV3pJeUxETXpMRzUxYkd3c01DeG1ZV3h6WlN4bVlXeHpaU3gwY25WbExEazBOelkxT1RReU1qUXlPRFExT0N4dWRXeHNMRnRiTUN4Yk5qQmRYVjFkWFN4YlhTeGJXekFzTUN4bVlXeHpaU3h1ZFd4c0xEazRPVEUzTURVek56VTVNams1T1N3eU1qWXNXMXN0TVN3ek1peHVkV3hzTERBc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc09UYzNNelE0T1RnME9ETTJPVEV5TEc1MWJHd3NXMXN4TVN3ME5EY3lPVGt4TXpZME5qUXdNVGhkTEZzNExEQmRMRnMzTEZzeVhWMWRYVjBzVzFzeU1pd3pOU3h1ZFd4c0xEWTVPRE0xTkRZMk1EWTBPREUyTlN3d0xHNTFiR3dzVzFzd0xGc3hNRFpkWFYxZFhWMHNXekFzTUN4bVlXeHpaU3h1ZFd4c0xEYzRPREl5TWpnM01UWTNPRGN4T1N3eU1qY3NXMXN0TVN3ek1peHVkV3hzTERBc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc01qVXdNamc1TURBeE16VTJNRGM1TEc1MWJHd3NXMXN4TVN3ME5EY3lPVGt4TXpZME5qUXdNVGhkTEZzNExEQmRMRnMzTEZzMlhWMWRYVjBzVzFzeU1pd3pOU3h1ZFd4c0xESXdOakl3TnpNMU5ERXhNRE16TkN3d0xHNTFiR3dzVzFzd0xGczJNbDFkWFYxZFhTeGJNQ3d3TEdaaGJITmxMRzUxYkd3c016a3lOalV4TVRNM01EZzFNemt4TERJeU9DeGJXeTB4TERNeUxHNTFiR3dzTUN4bVlXeHpaU3htWVd4elpTeG1ZV3h6WlN3NU16ZzBNVGc1TURNNU56azRNalVzYm5Wc2JDeGJXekV4TERRME56STVPVEV6TmpRMk5EQXhPRjBzV3pnc01GMHNXemNzV3pFelhWMWRYVjBzVzFzeU1pd3pOU3h1ZFd4c0xEVXpORGN3T0RrNE16azVOak14TWl3d0xHNTFiR3dzVzFzd0xGczNNRjFkWFYxZFhTeGJNQ3d3TEdaaGJITmxMRzUxYkd3c05ERTNNVEkyTmpjeU16WTVORGN6TERJeU9TeGJXeTB4TERNeUxHNTFiR3dzTUN4bVlXeHpaU3htWVd4elpTeG1ZV3h6WlN3ek9EazBOakkzTnpZd09EQXdNVE1zYm5Wc2JDeGJXekV4TERRME56STVPVEV6TmpRMk5EQXhPRjBzV3pnc01GMHNXemNzV3pFeFhWMWRYVjBzVzFzeU1pd3pOU3h1ZFd4c0xEZ3pNelUwTmpjME9Ua3pOVFF3T0N3d0xHNTFiR3dzVzFzd0xGczFPVjFkWFYxZFhTeGJNQ3d3TEdaaGJITmxMRzUxYkd3c09EazJPVFkzT0RNMk5UUXlOVFExTERJek1DeGJXeTB4TERNeUxHNTFiR3dzTUN4bVlXeHpaU3htWVd4elpTeG1ZV3h6WlN3eE1USXpORFV6TkRRME5qQTNORGtzYm5Wc2JDeGJXekV4TERRME56STVPVEV6TmpRMk5EQXhPRjBzV3pnc01GMHNXemNzV3psZFhWMWRYU3hiV3pJeUxETTFMRzUxYkd3c05USTROamd5T0RRMU56QTFPRGcxTERBc2JuVnNiQ3hiV3pBc1d6YzNYVjFkWFYxZExGc3dMREFzWm1Gc2MyVXNiblZzYkN3MU9UVTROakl4TURreE56a3lOVGtzTWpNeExGdGJMVEVzTXpJc2JuVnNiQ3d3TEdaaGJITmxMR1poYkhObExHWmhiSE5sTERFME9ERTFORGMyTkRRek1UQTFNU3h1ZFd4c0xGdGJNVEVzTkRRM01qazVNVE0yTkRZME1ERTRYU3hiT0N3d1hTeGJOeXhiTVRWZFhWMWRYU3hiV3pJeUxETTFMRzUxYkd3c05UTXdNakl5T1Rjd05qQTFORGM1TERBc2JuVnNiQ3hiV3pBc1d6VTRYVjFkWFYxZExGc3dMREFzWm1Gc2MyVXNiblZzYkN3ME56STJNVFUwTXpBeE1qSTVNek1zTWpNeUxGdGJMVEVzTXpJc2JuVnNiQ3d3TEdaaGJITmxMR1poYkhObExHWmhiSE5sTERVd016QTVORGMzT1RneE1UZzRNQ3h1ZFd4c0xGdGJNVEVzTkRRM01qazVNVE0yTkRZME1ERTRYU3hiT0N3d1hTeGJOeXhiTXpSZFhWMWRYU3hiV3pJeUxETTFMRzUxYkd3c01UWXhOREV4TnpBM01UYzJOVFEyTERBc2JuVnNiQ3hiV3pBc1d6WXhYVjFkWFYxZFhWMHNXekFzTUN4bVlXeHpaU3h1ZFd4c0xESXhOekUwTVRNNU1EVTROVEExTWl3eU16TXNXMXN4TXl3ek15eHVkV3hzTERBc1ptRnNjMlVzWm1Gc2MyVXNkSEoxWlN3eU16QTJPRE00TURrMk9UUXhPRFFzYm5Wc2JDeGJXekFzV3pReFhWMWRYVjBzVzFzeE15d3pOU3h1ZFd4c0xEY3lOVGt3TURBd01URTNORFV4TWl3d0xHNTFiR3dzVzFzd0xGc3hNMTFkWFYxZFhTeGJNQ3d3TEdaaGJITmxMRzUxYkd3c01qY3hNakU0T1RBNU1qSTVPVEUxTERJek5DeGJXek0wTERNekxHNTFiR3dzTUN4bVlXeHpaU3htWVd4elpTeDBjblZsTERVeU5Ea3pPRFE1T1RZNU9URXlPU3h1ZFd4c0xGdGJNQ3hiTnpaZFhWMWRYU3hiV3pNMExETTFMRzUxYkd3c016YzFOelUxTURRNE1ESXhOVEE1TERBc2JuVnNiQ3hiV3pBc1d6RXdPVjFkWFYxZFhTeGJNQ3d3TEdaaGJITmxMRzUxYkd3c01qVXlNRGcyTURrM09EUTBOREV4TERJek5TeGJXek0wTERNekxHNTFiR3dzTUN4bVlXeHpaU3htWVd4elpTeDBjblZsTERRMk5USTNNREUwTXpFeU9ERTJOQ3h1ZFd4c0xGdGJNQ3hiTnpkZFhWMWRYU3hiV3pNMExETTFMRzUxYkd3c09ESXlPVFkyTVRFMk9UWTJOekkyTERBc2JuVnNiQ3hiV3pBc1d6RXdYVjFkWFYxZExGc3dMREFzWm1Gc2MyVXNiblZzYkN3eE56UXpORFF4TmpZM05qWXlOemNzTWpNMkxGdGJNelVzTXpNc2JuVnNiQ3d3TEdaaGJITmxMR1poYkhObExIUnlkV1VzT1RJd01EUXpPREkzTlRrM09UazVMRzUxYkd3c1cxc3dMRnMwTWwxZFhWMWRMRnRiTXpVc016VXNiblZzYkN3M09EVTJORFU0TmpBMU1qY3pNalVzTUN4dWRXeHNMRnRiTUN4Yk1UTmRYVjFkWFYwc1d6QXNNQ3htWVd4elpTeHVkV3hzTERNME5UY3hOalkzTWpJeE1EazFNaXd5TXpjc1cxc3lNaXd6TXl4dWRXeHNMREFzWm1Gc2MyVXNabUZzYzJVc2RISjFaU3d4TXpZeE56STRNemsyT0RnME9UY3NiblZzYkN4Yld6QXNXemM0WFYxZFhWMHNXMTBzVzFzd0xEQXNabUZzYzJVc2JuVnNiQ3d5TmpnNU5UQTVOVEF5TURJNE1USXNNak00TEZ0YkxURXNNeklzYm5Wc2JDd3dMR1poYkhObExHWmhiSE5sTEdaaGJITmxMRE0yT1RBME5EQXhOamd6TVRrNU1TeHVkV3hzTEZ0Yk1URXNORFEzTWprNU1UTTJORFkwTURFNFhTeGJPQ3d3WFN4Yk55eGJNbDFkWFYxZExGdGJNaklzTXpVc2JuVnNiQ3c1TmpBMk5UazROVEF3TURrM09EWXNNQ3h1ZFd4c0xGdGJNQ3hiTVRBMlhWMWRYVjFkTEZzd0xEQXNabUZzYzJVc2JuVnNiQ3c0TURnMk5EQTNORGswTkRReU16VXNNak01TEZ0YkxURXNNeklzYm5Wc2JDd3dMR1poYkhObExHWmhiSE5sTEdaaGJITmxMRGd6T0RjNU16YzBPVGMzT1RNMk5peHVkV3hzTEZ0Yk1URXNORFEzTWprNU1UTTJORFkwTURFNFhTeGJPQ3d3WFN4Yk55eGJObDFkWFYxZExGdGJNaklzTXpVc2JuVnNiQ3cxT0RFek5qQTNPVFl4TVRZeU9URXNNQ3h1ZFd4c0xGdGJNQ3hiTmpKZFhWMWRYVjBzV3pBc01DeG1ZV3h6WlN4dWRXeHNMRFF5TlRnMk5EY3hPVFl5TVRJME1Td3lOREFzVzFzdE1Td3pNaXh1ZFd4c0xEQXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNPVFV3TmpFek1UQTVORFF5T0RjeUxHNTFiR3dzVzFzeE1TdzBORGN5T1RreE16WTBOalF3TVRoZExGczRMREJkTEZzM0xGc3hNMTFkWFYxZExGdGJNaklzTXpVc2JuVnNiQ3cxTnpJeU5URTJOemM0T0RFNE1qVXNNQ3h1ZFd4c0xGdGJNQ3hiTnpCZFhWMWRYVjBzV3pBc01DeG1ZV3h6WlN4dWRXeHNMRFl4TmpFd09EQTVOamcxTURrd05Dd3lOREVzVzFzdE1Td3pNaXh1ZFd4c0xEQXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNOemM0T1RFeU5UUXpOakEyTVRrMkxHNTFiR3dzVzFzeE1TdzBORGN5T1RreE16WTBOalF3TVRoZExGczRMREJkTEZzM0xGc3hNVjFkWFYxZExGdGJNaklzTXpVc2JuVnNiQ3d5TWpnMk56UTJPRFl4TkRJd016a3NNQ3h1ZFd4c0xGdGJNQ3hiTlRsZFhWMWRYVjBzV3pBc01DeG1ZV3h6WlN4dWRXeHNMRGN6TVRVNU5EZ3dPREV4TkRneE5pd3lORElzVzFzdE1Td3pNaXh1ZFd4c0xEQXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNPRFEwT0RjMk1ERXdOVGd5TlRFNUxHNTFiR3dzVzFzeE1TdzBORGN5T1RreE16WTBOalF3TVRoZExGczRMREJkTEZzM0xGczVYVjFkWFYwc1cxc3lNaXd6TlN4dWRXeHNMREV6T1RNME5EUTBNVGd3TmpNeE55d3dMRzUxYkd3c1cxc3dMRnMzTjExZFhWMWRYU3hiTUN3d0xHWmhiSE5sTEc1MWJHd3NOVGd5TVRVMU1ERTNOelE0T0RRMkxESTBNeXhiV3kweExETXlMRzUxYkd3c01DeG1ZV3h6WlN4bVlXeHpaU3htWVd4elpTdzNNakV5TmpFek9UazRNRE00TmpNc2JuVnNiQ3hiV3pFeExEUTBOekk1T1RFek5qUTJOREF4T0Ywc1d6Z3NNRjBzV3pjc1d6RTFYVjFkWFYwc1cxc3lNaXd6TlN4dWRXeHNMREV4TkRrM09UY3pPREUyTnpNek1Td3dMRzUxYkd3c1cxc3dMRnMxT0YxZFhWMWRYU3hiTUN3d0xHWmhiSE5sTEc1MWJHd3NORFl4TnpJeU9USTRPVE15TlRFM0xESTBOQ3hiV3kweExETXlMRzUxYkd3c01DeG1ZV3h6WlN4bVlXeHpaU3htWVd4elpTdzJOamd6Tmpnd05qQXpOak00TXpBc2JuVnNiQ3hiV3pFeExEUTBOekk1T1RFek5qUTJOREF4T0Ywc1d6Z3NNRjBzV3pjc1d6TTBYVjFkWFYwc1cxc3lNaXd6TlN4dWRXeHNMRFUzTWpnNU56TXdPRFV3TkRJMU1Dd3dMRzUxYkd3c1cxc3dMRnMyTVYxZFhWMWRYVjFkWFYwc1d6QXNNQ3htWVd4elpTeHVkV3hzTERRME5USTNOak0xTVRZNE1EZzVNaXd5TkRVc1cxc3RNU3d6TWl4dWRXeHNMREFzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzTmpJek5UYzBOVFV5TWpNNE16Y3hMRzUxYkd3c1cxc3hNU3c0TnpRNU1qVTNNVE00TVRRd056WmRMRnM0TERCZExGczNMRnMyWFYxZFhWMHNXMTBzVzFzd0xEQXNabUZzYzJVc2JuVnNiQ3c0TXpRMU9EYzJOemc1T0RjeU1qUXNNalEyTEZ0Yk1UTXNNek1zYm5Wc2JDd3dMR1poYkhObExHWmhiSE5sTEhSeWRXVXNOakEwTXpBMk1qTTFNVEExTnpRNExHNTFiR3dzVzFzd0xGczJOVjFkWFYxZExGdGJNVE1zTXpVc2JuVnNiQ3c0T0RjeU1EazFNalE1TURrMU1qWXNNQ3h1ZFd4c0xGdGJNQ3hiTmwxZFhWMWRYU3hiTUN3d0xHWmhiSE5sTEc1MWJHd3NPRFUwT0RVeE16RTJNemc1TnpNMkxESTBOeXhiV3pNMExETXpMRzUxYkd3c01DeG1ZV3h6WlN4bVlXeHpaU3gwY25WbExERTBOREUxTmpJek16VTNOVEE1TXl4dWRXeHNMRnRiTUN4Yk5qTmRYVjFkWFN4Yld6TTBMRE0xTEc1MWJHd3NNVEV5TWpNeU5USTRNVGt5TXpFMUxEQXNiblZzYkN4Yld6QXNXek0wWFYxZFhWMWRMRnN3TERBc1ptRnNjMlVzYm5Wc2JDd3pNRFE1TXpNME5URXdPRFF6Tnpjc01qUTRMRnRiTXpRc016TXNiblZzYkN3d0xHWmhiSE5sTEdaaGJITmxMSFJ5ZFdVc01qWTVNRFE0T1RreU9UVTRNakEyTEc1MWJHd3NXMXN3TEZzMk5GMWRYVjFkTEZ0Yk16UXNNelVzYm5Wc2JDdzFNVFl4TVRnek5UZzJNVEl3TlRrc01DeHVkV3hzTEZ0Yk1DeGJOakJkWFYxZFhWMHNXekFzTUN4bVlXeHpaU3h1ZFd4c0xEZzROekV6T0RFeE5qUTNOamsxTUN3eU5Ea3NXMXN6TlN3ek15eHVkV3hzTERBc1ptRnNjMlVzWm1Gc2MyVXNkSEoxWlN3eE16Z3dNREV5TlRrMk9EZzFOREVzYm5Wc2JDeGJXekFzV3pVMVhWMWRYVjBzVzFzek5Td3pOU3h1ZFd4c0xEVTNPVGt3TWpnNU1URXdNVGd5TVN3d0xHNTFiR3dzVzFzd0xGczJYVjFkWFYxZExGc3dMREFzWm1Gc2MyVXNiblZzYkN3ek5UUTJNamMyT1RNMk5qRXdNREVzTWpVd0xGdGJNaklzTXpNc2JuVnNiQ3d3TEdaaGJITmxMR1poYkhObExIUnlkV1VzT1RRME5EUXdOemsyTWpBeU9UUXdMRzUxYkd3c1cxc3dMRnMyTlYxZFhWMWRMRnRkTEZ0Yk1Dd3dMR1poYkhObExHNTFiR3dzT1RJMk56QTFNelV5TURZM05UWXhMREkxTVN4Yld5MHhMRE15TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4bVlXeHpaU3cyTnpnM09UZ3lPVFk1T0RrNE56SXNiblZzYkN4Yld6RXhMRFEwTnpJNU9URXpOalEyTkRBeE9GMHNXemdzTUYwc1d6Y3NXekpkWFYxZFhTeGJXekl5TERNMUxHNTFiR3dzTXpjME5qVXpPVFkzTURVd016QXdMREFzYm5Wc2JDeGJXekFzV3pZd1hWMWRYVjFkTEZzd0xEQXNabUZzYzJVc2JuVnNiQ3d4TnpZMU5qZzVPVEUxTWpreU56Z3NNalV5TEZ0YkxURXNNeklzYm5Wc2JDd3dMR1poYkhObExHWmhiSE5sTEdaaGJITmxMRE01TmpnNE9UTXhOREU0TmpNeE55eHVkV3hzTEZ0Yk1URXNORFEzTWprNU1UTTJORFkwTURFNFhTeGJPQ3d3WFN4Yk55eGJObDFkWFYxZExGdGJNaklzTXpVc2JuVnNiQ3cyTlRFeE16YzBOVFk0TVRVek5ETXNNQ3h1ZFd4c0xGdGJNQ3hiTnpKZFhWMWRYVjBzV3pBc01DeG1ZV3h6WlN4dWRXeHNMRGt3TmpRNU5UVTNPRFExTVRFNE9Td3lOVE1zVzFzdE1Td3pNaXh1ZFd4c0xEQXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNOVGMzTlRnd09USTVPVE0xTnpNM0xHNTFiR3dzVzFzeE1TdzBORGN5T1RreE16WTBOalF3TVRoZExGczRMREJkTEZzM0xGc3hNMTFkWFYxZExGdGJNaklzTXpVc2JuVnNiQ3cxTlRVNE1UZzVNek0zTVRVNU16QXNNQ3h1ZFd4c0xGdGJNQ3hiTnpOZFhWMWRYVjBzV3pBc01DeG1ZV3h6WlN4dWRXeHNMRE16T0RBM01qZzBPREUzTmpReU1Dd3lOVFFzVzFzdE1Td3pNaXh1ZFd4c0xEQXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNORFkxTlRReU1qZzBPRFk0TlRVMExHNTFiR3dzVzFzeE1TdzBORGN5T1RreE16WTBOalF3TVRoZExGczRMREJkTEZzM0xGc3hNVjFkWFYxZExGdGJNaklzTXpVc2JuVnNiQ3cxTXpBNE9UazROemMxTXpjNU5qY3NNQ3h1ZFd4c0xGdGJNQ3hiTXpsZFhWMWRYVjBzV3pBc01DeG1ZV3h6WlN4dWRXeHNMRGMzTkRZNE5qRTVNRGd5T0RZeE55d3lOVFVzVzFzdE1Td3pNaXh1ZFd4c0xEQXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNNalk1TWpjeE5qVXhNekV6TnpneUxHNTFiR3dzVzFzeE1TdzBORGN5T1RreE16WTBOalF3TVRoZExGczRMREJkTEZzM0xGczVYVjFkWFYwc1cxc3lNaXd6TlN4dWRXeHNMRGd5TVRBNU1UazBORFUxTVRJeU1pd3dMRzUxYkd3c1cxc3dMRnN4TURoZFhWMWRYVjBzV3pBc01DeG1ZV3h6WlN4dWRXeHNMRFUwTVRZeE5qSTRPVFV6T0RVME15d3lOVFlzVzFzdE1Td3pNaXh1ZFd4c0xEQXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNPVGN4T1RFeE5UQTNOREl5TVRNeUxHNTFiR3dzVzFzeE1TdzBORGN5T1RreE16WTBOalF3TVRoZExGczRMREJkTEZzM0xGc3hOVjFkWFYxZExGdGJNaklzTXpVc2JuVnNiQ3cyTWpRM09UTXlNVFkyTVRjeU5Ua3NNQ3h1ZFd4c0xGdGJNQ3hiTVRBNVhWMWRYVjFkTEZzd0xEQXNabUZzYzJVc2JuVnNiQ3cxTmpBMU9EZ3hORFl6TmpZNU5Ea3NNalUzTEZ0YkxURXNNeklzYm5Wc2JDd3dMR1poYkhObExHWmhiSE5sTEdaaGJITmxMRGd4TURJek16WTBPRFV3TWpJMk5TeHVkV3hzTEZ0Yk1URXNORFEzTWprNU1UTTJORFkwTURFNFhTeGJPQ3d3WFN4Yk55eGJNelJkWFYxZFhTeGJXekl5TERNMUxHNTFiR3dzTVRZeU5qSXhOak16TXpBeE5EazRMREFzYm5Wc2JDeGJXekFzV3pFd1hWMWRYVjFkWFYwc1d6QXNNQ3htWVd4elpTeHVkV3hzTERRNU1qTTRPREkwTlRNMU5ESXpNU3d5TlRnc1cxc3hNeXd6TXl4dWRXeHNMREFzWm1Gc2MyVXNabUZzYzJVc2RISjFaU3czTWpReE5EYzBOVEU1TmpreU9UWXNiblZzYkN4Yld6QXNXelU0WFYxZFhWMHNXMXN4TXl3ek5TeHVkV3hzTERRNE16QTVPVGsyT1Rjek1UazJPQ3d3TEc1MWJHd3NXMXN3TEZzMlhWMWRYVjFkTEZzd0xEQXNabUZzYzJVc2JuVnNiQ3cxTVRrNU1UVXdNelF5TURjME1UVXNNalU1TEZ0Yk16UXNNek1zYm5Wc2JDd3dMR1poYkhObExHWmhiSE5sTEhSeWRXVXNPVGsxTnpJM05USXhNRFEzTmpNNExHNTFiR3dzVzFzd0xGczJPRjFkWFYxZExGdGJNelFzTXpVc2JuVnNiQ3c1TWpjMU5ETXpNelE1T1RNeU5USXNNQ3h1ZFd4c0xGdGJNQ3hiTVRGZFhWMWRYVjBzV3pBc01DeG1ZV3h6WlN4dWRXeHNMRFU0TWpnd05USXpOamczTWpneU1Dd3lOakFzVzFzek5Dd3pNeXh1ZFd4c0xEQXNabUZzYzJVc1ptRnNjMlVzZEhKMVpTd3hNak14TlRNNE5qZ3pOek00T1RNc2JuVnNiQ3hiV3pBc1d6Y3dYVjFkWFYwc1cxc3pOQ3d6TlN4dWRXeHNMREU1T0RnNE5qY3lNVFE1T0RjNE1pd3dMRzUxYkd3c1cxc3dMRnMyWFYxZFhWMWRMRnN3TERBc1ptRnNjMlVzYm5Wc2JDd3lNREl3TXpBME1UTXhNVGN6T1RVc01qWXhMRnRiTXpVc016TXNiblZzYkN3d0xHWmhiSE5sTEdaaGJITmxMSFJ5ZFdVc01qZ3hPVFk1TkRBMk56VTNNek15TEc1MWJHd3NXMXN3TEZzMU9WMWRYVjFkTEZ0Yk16VXNNelVzYm5Wc2JDdzBPVGMxTkRnNE5UUTBOamN5TURNc01DeHVkV3hzTEZ0Yk1DeGJObDFkWFYxZFhTeGJNQ3d3TEdaaGJITmxMRzUxYkd3c01qazJNall6T1Rnek1EWXdOakk1TERJMk1peGJXekl5TERNekxHNTFiR3dzTUN4bVlXeHpaU3htWVd4elpTeDBjblZsTERnMk56UXlNalF4T0Rrek1Ea3lOeXh1ZFd4c0xGdGJNQ3hiTmpGZFhWMWRYU3hiWFN4Yld6QXNNQ3htWVd4elpTeHVkV3hzTERZek1EZ3dPVFU0TWpVNU9EUTROQ3d5TmpNc1cxc3RNU3d6TWl4dWRXeHNMREFzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzTnpJNU1EY3lNVEUyTWpBMU5UVXdMRzUxYkd3c1cxc3hNU3cwTkRjeU9Ua3hNelkwTmpRd01UaGRMRnM0TERCZExGczNMRnN5WFYxZFhWMHNXMXN5TWl3ek5TeHVkV3hzTERnMk5EVXdNRE0zTlRjNE5UazRNeXd3TEc1MWJHd3NXMXN3TEZzMk1GMWRYVjFkWFN4Yk1Dd3dMR1poYkhObExHNTFiR3dzTXpVNU5ERTFNemd6TlRreU9UWXpMREkyTkN4Yld5MHhMRE15TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4bVlXeHpaU3cyTWpjeU1UVXdOelUzTXpFeU9UY3NiblZzYkN4Yld6RXhMRFEwTnpJNU9URXpOalEyTkRBeE9GMHNXemdzTUYwc1d6Y3NXelpkWFYxZFhTeGJXekl5TERNMUxHNTFiR3dzT0RreE5qUXpNVE15T1RBME1qSTRMREFzYm5Wc2JDeGJXekFzV3pjeVhWMWRYVjFkTEZzd0xEQXNabUZzYzJVc2JuVnNiQ3c1TXpJNE5qRXhOVGd5TmpRMk5qTXNNalkxTEZ0YkxURXNNeklzYm5Wc2JDd3dMR1poYkhObExHWmhiSE5sTEdaaGJITmxMRGc0TnpreU9UWXpOakF6TXpVNU1peHVkV3hzTEZ0Yk1URXNORFEzTWprNU1UTTJORFkwTURFNFhTeGJPQ3d3WFN4Yk55eGJNVE5kWFYxZFhTeGJXekl5TERNMUxHNTFiR3dzT1Rjd016UTFNREV3TnprMU56WXpMREFzYm5Wc2JDeGJXekFzV3pjelhWMWRYVjFkTEZzd0xEQXNabUZzYzJVc2JuVnNiQ3c0TXpjNU5UQXhOemcxTnpVd016Z3NNalkyTEZ0YkxURXNNeklzYm5Wc2JDd3dMR1poYkhObExHWmhiSE5sTEdaaGJITmxMRGsxTkRFek1UY3pNalExTURZNU1TeHVkV3hzTEZ0Yk1URXNORFEzTWprNU1UTTJORFkwTURFNFhTeGJPQ3d3WFN4Yk55eGJNVEZkWFYxZFhTeGJXekl5TERNMUxHNTFiR3dzT1RneU56VTNOalUzTkRRME5EWXlMREFzYm5Wc2JDeGJXekFzV3pNNVhWMWRYVjFkTEZzd0xEQXNabUZzYzJVc2JuVnNiQ3d6TmpFNE1UVTFPVEV4TlRZME5UQXNNalkzTEZ0YkxURXNNeklzYm5Wc2JDd3dMR1poYkhObExHWmhiSE5sTEdaaGJITmxMRGt4T0RZeU16a3pNVGt6TlRJMU5peHVkV3hzTEZ0Yk1URXNORFEzTWprNU1UTTJORFkwTURFNFhTeGJPQ3d3WFN4Yk55eGJPVjFkWFYxZExGdGJNaklzTXpVc2JuVnNiQ3cwT1RFMU56QTJNVEV5TURnME1qSXNNQ3h1ZFd4c0xGdGJNQ3hiTVRBNFhWMWRYVjFkTEZzd0xEQXNabUZzYzJVc2JuVnNiQ3d6TURrM09USXdNemN5TkRVMU9EY3NNalk0TEZ0YkxURXNNeklzYm5Wc2JDd3dMR1poYkhObExHWmhiSE5sTEdaaGJITmxMREV6TURjeU9URXdOelU0TWpBeE1TeHVkV3hzTEZ0Yk1URXNORFEzTWprNU1UTTJORFkwTURFNFhTeGJPQ3d3WFN4Yk55eGJNVFZkWFYxZFhTeGJXekl5TERNMUxHNTFiR3dzTnpVMk1ERXpNVGd6TURJMU1EWTNMREFzYm5Wc2JDeGJXekFzV3pFd09WMWRYVjFkWFN4Yk1Dd3dMR1poYkhObExHNTFiR3dzTnpreU5qZzNPVEExT1RReU5qZzRMREkyT1N4Yld5MHhMRE15TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4bVlXeHpaU3d4T0RRNE5qUTVOakF6T1RnNE16Y3NiblZzYkN4Yld6RXhMRFEwTnpJNU9URXpOalEyTkRBeE9GMHNXemdzTUYwc1d6Y3NXek0wWFYxZFhWMHNXMXN5TWl3ek5TeHVkV3hzTERJNE5qTTRNakEyTmpjeE9EWTRNaXd3TEc1MWJHd3NXMXN3TEZzeE1GMWRYVjFkWFYxZExGc3dMREFzWm1Gc2MyVXNiblZzYkN3NU9EZzJNVGczTWpRMU9EVTFPREFzTWpjd0xGdGJNVE1zTXpNc2JuVnNiQ3d3TEdaaGJITmxMR1poYkhObExIUnlkV1VzTVRreU56VXlOVEEwTkRFek9UVTRMRzUxYkd3c1cxc3dMRnN6TkYxZFhWMWRMRnRiTVRNc016VXNiblZzYkN3eU56TTVPREkwTURneU1qTTBOVFVzTUN4dWRXeHNMRnRiTUN4Yk1sMWRYVjFkWFN4Yk1Dd3dMR1poYkhObExHNTFiR3dzT1RJNU9UZzBPVEUwTnpnNE1qUXpMREkzTVN4Yld6TTBMRE16TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4MGNuVmxMRGd5TmpJek16WTNNVEEwT1RnNU5TeHVkV3hzTEZ0Yk1DeGJOekpkWFYxZFhTeGJXek0wTERNMUxHNTFiR3dzTWpVMk9UWTRNemcxTXpJM09EUXpMREFzYm5Wc2JDeGJXekFzV3pFelhWMWRYVjFkTEZzd0xEQXNabUZzYzJVc2JuVnNiQ3d4TURRMU56YzFPVEkyTnpRd016WXNNamN5TEZ0Yk16UXNNek1zYm5Wc2JDd3dMR1poYkhObExHWmhiSE5sTEhSeWRXVXNOelk0TlRZek5Ua3lPRE14TURVeExHNTFiR3dzVzFzd0xGczNNMTFkWFYxZExGdGJNelFzTXpVc2JuVnNiQ3cyTnpNM05qa3hORGt3TWpBeE9UUXNNQ3h1ZFd4c0xGdGJNQ3hiTWwxZFhWMWRYU3hiTUN3d0xHWmhiSE5sTEc1MWJHd3NPRFF5T1RVeU1ERXhPVE16T0RVeExESTNNeXhiV3pNMUxETXpMRzUxYkd3c01DeG1ZV3h6WlN4bVlXeHpaU3gwY25WbExEa3dPVFl6TnpZNU16QTNPVGd5Tnl4dWRXeHNMRnRiTUN4Yk16bGRYVjFkWFN4Yld6TTFMRE0xTEc1MWJHd3NPVEF3TmpZd09EQTBNekUxTmpBM0xEQXNiblZzYkN4Yld6QXNXekpkWFYxZFhWMHNXekFzTUN4bVlXeHpaU3h1ZFd4c0xEa3pORFkwT0RNeE1ESXlOamt4T0N3eU56UXNXMXN5TWl3ek15eHVkV3hzTERBc1ptRnNjMlVzWm1Gc2MyVXNkSEoxWlN3eE16UTJOVE16TURBd056RTVOVGdzYm5Wc2JDeGJXekFzV3pZd1hWMWRYVjBzVzEwc1cxc3dMREFzWm1Gc2MyVXNiblZzYkN3eU9EWTJORFEyTnpNM01qWTVORFFzTWpjMUxGdGJMVEVzTXpJc2JuVnNiQ3d3TEdaaGJITmxMR1poYkhObExHWmhiSE5sTERVek5USTNOemd4TnpjME5qY3dOQ3h1ZFd4c0xGdGJNVEVzTkRRM01qazVNVE0yTkRZME1ERTRYU3hiT0N3d1hTeGJOeXhiTWwxZFhWMWRMRnRiTWpJc016VXNiblZzYkN3eU56WTNOVEk0TXpBMU5qVXhNekFzTUN4dWRXeHNMRnRiTUN4Yk1sMWRYVjFkWFN4Yk1Dd3dMR1poYkhObExHNTFiR3dzTVRRek5ERXdOamt4TVRZek16RXlMREkzTml4Yld5MHhMRE15TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4bVlXeHpaU3czTURFMU5qazRNemMyT0RjME1URXNiblZzYkN4Yld6RXhMRFEwTnpJNU9URXpOalEyTkRBeE9GMHNXemdzTUYwc1d6Y3NXelpkWFYxZFhTeGJXekl5TERNMUxHNTFiR3dzT0RNeE1qVXlNVGN4TVRVMk9EYzFMREFzYm5Wc2JDeGJXekFzV3paZFhWMWRYVjBzV3pBc01DeG1ZV3h6WlN4dWRXeHNMRGMzTXpnMk16QTNPVEU1TnprM05pd3lOemNzVzFzdE1Td3pNaXh1ZFd4c0xEQXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNPRGc0TkRZeE16TTBORE00TnpjeExHNTFiR3dzVzFzeE1TdzBORGN5T1RreE16WTBOalF3TVRoZExGczRMREJkTEZzM0xGc3hNMTFkWFYxZExGdGJNaklzTXpVc2JuVnNiQ3c0T1RJM09UQXlNalExTnpjNE5UZ3NNQ3h1ZFd4c0xGdGJNQ3hiTVROZFhWMWRYVjBzV3pBc01DeG1ZV3h6WlN4dWRXeHNMRGd5TURZeU1qZzBOREE1TlRVMU5Td3lOemdzVzFzdE1Td3pNaXh1ZFd4c0xEQXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNOak0xTVRrNE9EQXpOalEwTnpNd0xHNTFiR3dzVzFzeE1TdzBORGN5T1RreE16WTBOalF3TVRoZExGczRMREJkTEZzM0xGc3hNVjFkWFYxZExGdGJNaklzTXpVc2JuVnNiQ3c0TmprNU9EUXdNek00TnpBeE1EVXNNQ3h1ZFd4c0xGdGJNQ3hiTVRGZFhWMWRYVjBzV3pBc01DeG1ZV3h6WlN4dWRXeHNMRFF6TnpNNE5qYzVOak13TXpZM01Td3lOemtzVzFzdE1Td3pNaXh1ZFd4c0xEQXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNNek00TkRjd09URXlOVGM0TnprMkxHNTFiR3dzVzFzeE1TdzBORGN5T1RreE16WTBOalF3TVRoZExGczRMREJkTEZzM0xGczVYVjFkWFYwc1cxc3lNaXd6TlN4dWRXeHNMRGc0TURRME56azBOakl6T1RFM05Td3dMRzUxYkd3c1cxc3dMRnM1WFYxZFhWMWRMRnN3TERBc1ptRnNjMlVzYm5Wc2JDdzNOalF3TnpZM01EY3dOalUwTWpRc01qZ3dMRnRiTFRFc016SXNiblZzYkN3d0xHWmhiSE5sTEdaaGJITmxMR1poYkhObExEUXdORFkyTWpVME56Z3pPVGcyT1N4dWRXeHNMRnRiTVRFc05EUTNNams1TVRNMk5EWTBNREU0WFN4Yk9Dd3dYU3hiTnl4Yk1UVmRYVjFkWFN4Yld6SXlMRE0xTEc1MWJHd3NOamt6T1RNeE9EY3hORE14TURRMkxEQXNiblZzYkN4Yld6QXNXekUxWFYxZFhWMWRMRnN3TERBc1ptRnNjMlVzYm5Wc2JDd3lNVEE1TkRNNE9ESTVOemN4TkRFc01qZ3hMRnRiTFRFc016SXNiblZzYkN3d0xHWmhiSE5sTEdaaGJITmxMR1poYkhObExETXpPVFl6TkRrd016azRORFEwTVN4dWRXeHNMRnRiTVRFc05EUTNNams1TVRNMk5EWTBNREU0WFN4Yk9Dd3dYU3hiTnl4Yk16UmRYVjFkWFN4Yld6SXlMRE0xTEc1MWJHd3NPRGcyTkRVeE9UWTJNVEF3TkRRMExEQXNiblZzYkN4Yld6QXNXek0wWFYxZFhWMWRYVjBzV3pBc01DeG1ZV3h6WlN4dWRXeHNMRFkyTVRJek5UWXpNemcxT0RjM05pd3lPRElzVzFzeE15d3pNeXh1ZFd4c0xEQXNabUZzYzJVc1ptRnNjMlVzZEhKMVpTdzBNVFUxTURrME1UYzJOREl3TXpJc2JuVnNiQ3hiV3pBc1d6UXhYVjFkWFYwc1cxc3hNeXd6TlN4dWRXeHNMRGM1TnpBeU5qazFNall3TVRJek9Dd3dMRzUxYkd3c1cxc3dMRnN5WFYxZFhWMWRMRnN3TERBc1ptRnNjMlVzYm5Wc2JDd3pPVFkyTXpNME5UVXlOalV5TmpFc01qZ3pMRnRiTXpRc016TXNiblZzYkN3d0xHWmhiSE5sTEdaaGJITmxMSFJ5ZFdVc01UVTJPRFV5TlRBek5UZzJOVFkxTEc1MWJHd3NXMXN3TEZzM05sMWRYVjFkTEZ0Yk16UXNNelVzYm5Wc2JDdzJNelkzTlRBNE1qTTRNalU1TlRJc01DeHVkV3hzTEZ0Yk1DeGJPVjFkWFYxZFhTeGJNQ3d3TEdaaGJITmxMRzUxYkd3c016QTRPVGM1T1RRNU1UUTFNelEzTERJNE5DeGJXek0wTERNekxHNTFiR3dzTUN4bVlXeHpaU3htWVd4elpTeDBjblZsTERjMU16RXhNakkxTVRNNU1qWXdNaXh1ZFd4c0xGdGJNQ3hiTnpkZFhWMWRYU3hiV3pNMExETTFMRzUxYkd3c056TTNORFF5T1RFMU5EazFNalk1TERBc2JuVnNiQ3hiV3pBc1d6RTFYVjFkWFYxZExGc3dMREFzWm1Gc2MyVXNiblZzYkN3eU5qVTNOVEE0TURJeU5qUTFOemNzTWpnMUxGdGJNelVzTXpNc2JuVnNiQ3d3TEdaaGJITmxMR1poYkhObExIUnlkV1VzTkRBek16WTRPRE00TWpFd05UWXlMRzUxYkd3c1cxc3dMRnMwTWwxZFhWMWRMRnRiTXpVc016VXNiblZzYkN3Mk1qVXdOVGcxTlRZMU1qZ3dNRGtzTUN4dWRXeHNMRnRiTUN4Yk1sMWRYVjFkWFN4Yk1Dd3dMR1poYkhObExHNTFiR3dzTWpjek1qZ3hPRFkxTXpjeE16RXdMREk0Tml4Yld6SXlMRE16TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4MGNuVmxMRGN5T1RreE5qa3hPRGM1T1RNMk1TeHVkV3hzTEZ0Yk1DeGJOemhkWFYxZFhTeGJYU3hiV3pBc01DeG1ZV3h6WlN4dWRXeHNMRGcyTnpJNE5EZzROemd4TmprMk55d3lPRGNzVzFzdE1Td3pNaXh1ZFd4c0xEQXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNPRFl5TkRrM09UVXdNREUyTnpVM0xHNTFiR3dzVzFzeE1TdzBORGN5T1RreE16WTBOalF3TVRoZExGczRMREJkTEZzM0xGc3lYVjFkWFYwc1cxc3lNaXd6TlN4dWRXeHNMRFUzTmpNNE5qSTFNRFl6TkRjME15d3dMRzUxYkd3c1cxc3dMRnN5WFYxZFhWMWRMRnN3TERBc1ptRnNjMlVzYm5Wc2JDdzBPRE00TURjeU56QXdPRFl3TkRVc01qZzRMRnRiTFRFc016SXNiblZzYkN3d0xHWmhiSE5sTEdaaGJITmxMR1poYkhObExEWTBOakl3T1RjM016Y3lOalUzT0N4dWRXeHNMRnRiTVRFc05EUTNNams1TVRNMk5EWTBNREU0WFN4Yk9Dd3dYU3hiTnl4Yk5sMWRYVjFkTEZ0Yk1qSXNNelVzYm5Wc2JDdzVOVGN4TWpFMk1EZ3hOalV6TXpFc01DeHVkV3hzTEZ0Yk1DeGJObDFkWFYxZFhTeGJNQ3d3TEdaaGJITmxMRzUxYkd3c05EZzJNakF4TmpnMk5ETXpOekEwTERJNE9TeGJXeTB4TERNeUxHNTFiR3dzTUN4bVlXeHpaU3htWVd4elpTeG1ZV3h6WlN3ME5EQTBORGt4TlRjNE1EVTFNelVzYm5Wc2JDeGJXekV4TERRME56STVPVEV6TmpRMk5EQXhPRjBzV3pnc01GMHNXemNzV3pFelhWMWRYVjBzVzFzeU1pd3pOU3h1ZFd4c0xEUXhPRGt3TkRZek1qUXpNems1TUN3d0xHNTFiR3dzVzFzd0xGc3hNMTFkWFYxZFhTeGJNQ3d3TEdaaGJITmxMRzUxYkd3c09EWTROamszTmpFMU16SXpORFUyTERJNU1DeGJXeTB4TERNeUxHNTFiR3dzTUN4bVlXeHpaU3htWVd4elpTeG1ZV3h6WlN3NU1qUTBOVEF4TXpnME5UYzFNVGdzYm5Wc2JDeGJXekV4TERRME56STVPVEV6TmpRMk5EQXhPRjBzV3pnc01GMHNXemNzV3pFeFhWMWRYVjBzVzFzeU1pd3pOU3h1ZFd4c0xEZ3dORFF3TmpBNU56QXlNVFU0TVN3d0xHNTFiR3dzVzFzd0xGc3hNVjFkWFYxZFhTeGJNQ3d3TEdaaGJITmxMRzUxYkd3c05UWTBOelV3TnpNMk5EQXhNREUxTERJNU1TeGJXeTB4TERNeUxHNTFiR3dzTUN4bVlXeHpaU3htWVd4elpTeG1ZV3h6WlN3NU5UQTJNRE0yTVRrNE5EZ3lPVGNzYm5Wc2JDeGJXekV4TERRME56STVPVEV6TmpRMk5EQXhPRjBzV3pnc01GMHNXemNzV3psZFhWMWRYU3hiV3pJeUxETTFMRzUxYkd3c05UTXpORFkwTnpRME1USXlOalExTERBc2JuVnNiQ3hiV3pBc1d6bGRYVjFkWFYwc1d6QXNNQ3htWVd4elpTeHVkV3hzTERrME1EYzRNelkyTVRJME1Ea3pNU3d5T1RJc1cxc3RNU3d6TWl4dWRXeHNMREFzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzTnpFd05qVXhOek0xTlRVMU9EVTBMRzUxYkd3c1cxc3hNU3cwTkRjeU9Ua3hNelkwTmpRd01UaGRMRnM0TERCZExGczNMRnN4TlYxZFhWMWRMRnRiTWpJc016VXNiblZzYkN3MU16RXhNREl3TkRjMk9UYzNPVFVzTUN4dWRXeHNMRnRiTUN4Yk1UVmRYVjFkWFYwc1d6QXNNQ3htWVd4elpTeHVkV3hzTERrNE5qVTJNell5TmpNME16a3pOQ3d5T1RNc1cxc3RNU3d6TWl4dWRXeHNMREFzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzT1RjNE9UUTNPVGd5TURFMU5qWXlMRzUxYkd3c1cxc3hNU3cwTkRjeU9Ua3hNelkwTmpRd01UaGRMRnM0TERCZExGczNMRnN6TkYxZFhWMWRMRnRiTWpJc016VXNiblZzYkN3Mk16RXhOelExTVRRNE9EWTNPRGNzTUN4dWRXeHNMRnRiTUN4Yk16UmRYVjFkWFYxZFhWMWRMRnN3TERBc1ptRnNjMlVzYm5Wc2JDdzNNREUwTWpFME5UWXpOVGcyTkRJc01qazBMRnRiTFRFc016SXNiblZzYkN3d0xHWmhiSE5sTEdaaGJITmxMR1poYkhObExESXlPVFE0TURJMk5qazRNRFUyTWl4dWRXeHNMRnRiTVRFc09EYzBPVEkxTnpFek9ERTBNRGMyWFN4Yk9Dd3dYU3hiTnl4Yk1UTmRYVjFkWFN4YlhTeGJXekFzTUN4bVlXeHpaU3h1ZFd4c0xETTVNVEF6T0RNNU1UYzRNRGczTWl3eU9UVXNXMXN4TXl3ek15eHVkV3hzTERBc1ptRnNjMlVzWm1Gc2MyVXNkSEoxWlN3ME9UYzVNRFE0TXpFeE56azNNRFFzYm5Wc2JDeGJXekFzV3pNMFhWMWRYVjBzVzFzeE15d3pOU3h1ZFd4c0xETTVNREU1TURVNU9EYzFOVFl3TVN3d0xHNTFiR3dzVzFzd0xGc3lYVjFkWFYxZExGc3dMREFzWm1Gc2MyVXNiblZzYkN3Mk5qSXpOVGMwTXpZd05qUTFNemNzTWprMkxGdGJNelFzTXpNc2JuVnNiQ3d3TEdaaGJITmxMR1poYkhObExIUnlkV1VzTkRReU1EQTBORFU1T0Rjd09EZ3pMRzUxYkd3c1cxc3dMRnMzTWwxZFhWMWRMRnRiTXpRc016VXNiblZzYkN3MU16QTVPRE0wTWpVek16UXdNRFFzTUN4dWRXeHNMRnRiTUN4Yk1UTmRYVjFkWFYwc1d6QXNNQ3htWVd4elpTeHVkV3hzTERjME5ESXdNVEU1TlRBNU56Y3hNeXd5T1Rjc1cxc3pOQ3d6TXl4dWRXeHNMREFzWm1Gc2MyVXNabUZzYzJVc2RISjFaU3d5T0RJMU56STVOalU1TWpVMk9EY3NiblZzYkN4Yld6QXNXemN6WFYxZFhWMHNXMXN6TkN3ek5TeHVkV3hzTERFek9EWXlNak0yTkRjek1EUTVPU3d3TEc1MWJHd3NXMXN3TEZzeVhWMWRYVjFkTEZzd0xEQXNabUZzYzJVc2JuVnNiQ3d4T1RVd01EYzVPVFUxTURNME5EQXNNams0TEZ0Yk16VXNNek1zYm5Wc2JDd3dMR1poYkhObExHWmhiSE5sTEhSeWRXVXNNVFUwTlRrM01UTXhOREUyTkRjeUxHNTFiR3dzVzFzd0xGc3pPVjFkWFYxZExGdGJNelVzTXpVc2JuVnNiQ3c0TVRBd01UZzVOVE13TmpZMk5EUXNNQ3h1ZFd4c0xGdGJNQ3hiTWwxZFhWMWRYU3hiTUN3d0xHWmhiSE5sTEc1MWJHd3NNVEF4T1RJek56VTJOamt6TURjMkxESTVPU3hiV3pJeUxETXpMRzUxYkd3c01DeG1ZV3h6WlN4bVlXeHpaU3gwY25WbExEVTVORFV6TmpFMU5USXpOemMyTXl4dWRXeHNMRnRiTUN4Yk5qQmRYVjFkWFN4YlhTeGJXekFzTUN4bVlXeHpaU3h1ZFd4c0xEUXhNalU0TXpjek9Ua3dNREk0TXl3ek1EQXNXMXN0TVN3ek1peHVkV3hzTERBc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc05qUXlOVGsxTnprME1UWTJOemMyTEc1MWJHd3NXMXN4TVN3ME5EY3lPVGt4TXpZME5qUXdNVGhkTEZzNExEQmRMRnMzTEZzeVhWMWRYVjBzVzFzeU1pd3pOU3h1ZFd4c0xEZzFOak0xTXpFM09URXdNREkwTUN3d0xHNTFiR3dzVzFzd0xGc3lYVjFkWFYxZExGc3dMREFzWm1Gc2MyVXNiblZzYkN3ME9UQTFPRGcwTXpVMk56RTBNalFzTXpBeExGdGJMVEVzTXpJc2JuVnNiQ3d3TEdaaGJITmxMR1poYkhObExHWmhiSE5sTERVNU5EWXdPRFUyTWpZME1Ea3pOU3h1ZFd4c0xGdGJNVEVzTkRRM01qazVNVE0yTkRZME1ERTRYU3hiT0N3d1hTeGJOeXhiTmwxZFhWMWRMRnRiTWpJc016VXNiblZzYkN3eU5qQXdOakF6TkRJNE1qTXpORFFzTUN4dWRXeHNMRnRiTUN4Yk5sMWRYVjFkWFN4Yk1Dd3dMR1poYkhObExHNTFiR3dzTnpjNU5UVTNORFUyTmpFeU5qRXhMRE13TWl4Yld5MHhMRE15TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4bVlXeHpaU3cxTkRFMU56YzBOVFl3TWpFNU1qTXNiblZzYkN4Yld6RXhMRFEwTnpJNU9URXpOalEyTkRBeE9GMHNXemdzTUYwc1d6Y3NXekV6WFYxZFhWMHNXMXN5TWl3ek5TeHVkV3hzTERjMU5qRTJOelV4TlRFMk1EQTRNU3d3TEc1MWJHd3NXMXN3TEZzeE0xMWRYVjFkWFN4Yk1Dd3dMR1poYkhObExHNTFiR3dzTXpNMk16UTBNelF5TVRrek1qVXlMRE13TXl4Yld5MHhMRE15TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4bVlXeHpaU3cxTWpRMk1qWTVOamN5TlRBM09EUXNiblZzYkN4Yld6RXhMRFEwTnpJNU9URXpOalEyTkRBeE9GMHNXemdzTUYwc1d6Y3NXekV4WFYxZFhWMHNXMXN5TWl3ek5TeHVkV3hzTERnNU56a3pNall6TkRrMk5UWTFNaXd3TEc1MWJHd3NXMXN3TEZzeE1WMWRYVjFkWFN4Yk1Dd3dMR1poYkhObExHNTFiR3dzT0RFME1UYzNPREF3T1RFeE1EVTNMRE13TkN4Yld5MHhMRE15TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4bVlXeHpaU3cxTnprNU1EUTRPVFU1TVRVNU56TXNiblZzYkN4Yld6RXhMRFEwTnpJNU9URXpOalEyTkRBeE9GMHNXemdzTUYwc1d6Y3NXemxkWFYxZFhTeGJXekl5TERNMUxHNTFiR3dzTmpNeU5qVXhOak15TWpreU9ERTJMREFzYm5Wc2JDeGJXekFzV3psZFhWMWRYVjBzV3pBc01DeG1ZV3h6WlN4dWRXeHNMRGs0TkRNMk1qQTJOelEwTURJMk9Dd3pNRFVzVzFzdE1Td3pNaXh1ZFd4c0xEQXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNOVE0wTURBME1UUTNPVGd6TlRJd0xHNTFiR3dzVzFzeE1TdzBORGN5T1RreE16WTBOalF3TVRoZExGczRMREJkTEZzM0xGc3hOVjFkWFYxZExGdGJNaklzTXpVc2JuVnNiQ3cxTkRFeU16QTJORGs1T1RrME16Y3NNQ3h1ZFd4c0xGdGJNQ3hiTVRWZFhWMWRYVjBzV3pBc01DeG1ZV3h6WlN4dWRXeHNMRGczT1RFeU9EYzVPRGszTXprM01Td3pNRFlzVzFzdE1Td3pNaXh1ZFd4c0xEQXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNNVFE1T0RJMU9ERXpOVGsxTlRFekxHNTFiR3dzVzFzeE1TdzBORGN5T1RreE16WTBOalF3TVRoZExGczRMREJkTEZzM0xGc3pORjFkWFYxZExGdGJNaklzTXpVc2JuVnNiQ3c1TVRRM05ESTRNak14TVRRek1qQXNNQ3h1ZFd4c0xGdGJNQ3hiTXpSZFhWMWRYVjFkWFN4Yk1Dd3dMR1poYkhObExHNTFiR3dzTnpJek5qUXlOREF5TkRZME5EY3lMRE13Tnl4Yld6RXpMRE16TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4MGNuVmxMREl5TURBek5qYzFOakU0T0RBek9DeHVkV3hzTEZ0Yk1DeGJOREZkWFYxZFhTeGJXekV6TERNMUxHNTFiR3dzT0RVMk16SXdNREl6TXpZeE5UTTVMREFzYm5Wc2JDeGJXekFzV3pKZFhWMWRYVjBzV3pBc01DeG1ZV3h6WlN4dWRXeHNMREk1TXpVeE1UYzFNRE01TVRjd09Td3pNRGdzVzFzek5Dd3pNeXh1ZFd4c0xEQXNabUZzYzJVc1ptRnNjMlVzZEhKMVpTdzNOalU1T1RZeE5EZzRPVE01T0RZc2JuVnNiQ3hiV3pBc1d6YzJYVjFkWFYwc1cxc3pOQ3d6TlN4dWRXeHNMRGM0TnpnNE1UWTFNemsxTkRreE9Td3dMRzUxYkd3c1cxc3dMRnM1WFYxZFhWMWRMRnN3TERBc1ptRnNjMlVzYm5Wc2JDd3pPRFEyTWpVMk1ETTVOVGczTVRnc016QTVMRnRiTXpRc016TXNiblZzYkN3d0xHWmhiSE5sTEdaaGJITmxMSFJ5ZFdVc056ZzFOalUyTnpZMk1qUXhORE00TEc1MWJHd3NXMXN3TEZzM04xMWRYVjFkTEZ0Yk16UXNNelVzYm5Wc2JDdzROVGcwTVRBME9URTBOekU0TkRRc01DeHVkV3hzTEZ0Yk1DeGJNVFZkWFYxZFhWMHNXekFzTUN4bVlXeHpaU3h1ZFd4c0xESXhNakk1TWprek9UUTNPREV5T0N3ek1UQXNXMXN6TlN3ek15eHVkV3hzTERBc1ptRnNjMlVzWm1Gc2MyVXNkSEoxWlN3eE56RTVOamd6TlRRME5UUXpOemdzYm5Wc2JDeGJXekFzV3pReVhWMWRYVjBzVzFzek5Td3pOU3h1ZFd4c0xEYzROVFF3TXpBNU1UWTNNRFF6Tnl3d0xHNTFiR3dzVzFzd0xGc3lYVjFkWFYxZExGc3dMREFzWm1Gc2MyVXNiblZzYkN3ek5qZzRNRFF6TkRrMU5ESTBPVEFzTXpFeExGdGJNaklzTXpNc2JuVnNiQ3d3TEdaaGJITmxMR1poYkhObExIUnlkV1VzTVRFeE56WXdNRFkyTVRjMk9UazFMRzUxYkd3c1cxc3dMRnMzT0YxZFhWMWRMRnRkTEZ0Yk1Dd3dMR1poYkhObExHNTFiR3dzTlRBM016UTNNREUzTWpRME5ERTBMRE14TWl4Yld5MHhMRE15TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4bVlXeHpaU3czTlRNek1EWTBORFUwTXpJMk16Z3NiblZzYkN4Yld6RXhMRFEwTnpJNU9URXpOalEyTkRBeE9GMHNXemdzTUYwc1d6Y3NXekpkWFYxZFhTeGJXekl5TERNMUxHNTFiR3dzT1RrME16VTRPVFV3TXpFM09UazFMREFzYm5Wc2JDeGJXekFzV3pKZFhWMWRYVjBzV3pBc01DeG1ZV3h6WlN4dWRXeHNMREU1TWpRNE5UVXdNek00TURNd05Dd3pNVE1zVzFzdE1Td3pNaXh1ZFd4c0xEQXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNPVEl3TkRBME9UTTROelEwTXpjNUxHNTFiR3dzVzFzeE1TdzBORGN5T1RreE16WTBOalF3TVRoZExGczRMREJkTEZzM0xGczJYVjFkWFYwc1cxc3lNaXd6TlN4dWRXeHNMRGMxTkRrd01qRTVPRGt4T0Rjd015d3dMRzUxYkd3c1cxc3dMRnMyWFYxZFhWMWRMRnN3TERBc1ptRnNjMlVzYm5Wc2JDdzROVGs1T1RnME1qQXpOemt3TkRFc016RTBMRnRiTFRFc016SXNiblZzYkN3d0xHWmhiSE5sTEdaaGJITmxMR1poYkhObExETTJOakkzTURJd01qRXhOamd6TVN4dWRXeHNMRnRiTVRFc05EUTNNams1TVRNMk5EWTBNREU0WFN4Yk9Dd3dYU3hiTnl4Yk1UTmRYVjFkWFN4Yld6SXlMRE0xTEc1MWJHd3NOVGd5TURjd05UUXpOVGszTkRJeExEQXNiblZzYkN4Yld6QXNXekV6WFYxZFhWMWRMRnN3TERBc1ptRnNjMlVzYm5Wc2JDdzJOVEU1TWpJek5EUTJNRGsxTmpBc016RTFMRnRiTFRFc016SXNiblZzYkN3d0xHWmhiSE5sTEdaaGJITmxMR1poYkhObExEWTFNalF6TXpneE16VTBPRFF4TlN4dWRXeHNMRnRiTVRFc05EUTNNams1TVRNMk5EWTBNREU0WFN4Yk9Dd3dYU3hiTnl4Yk1URmRYVjFkWFN4Yld6SXlMRE0xTEc1MWJHd3NNVFEzTWpJNE9USXhNelkyT1RZNExEQXNiblZzYkN4Yld6QXNXekV4WFYxZFhWMWRMRnN3TERBc1ptRnNjMlVzYm5Wc2JDdzJOVFE0T1RFMk9UTTBPVEkyTVRRc016RTJMRnRiTFRFc016SXNiblZzYkN3d0xHWmhiSE5sTEdaaGJITmxMR1poYkhObExESXhPVEE1TkRRNE5EVXlPRGN6Tml4dWRXeHNMRnRiTVRFc05EUTNNams1TVRNMk5EWTBNREU0WFN4Yk9Dd3dYU3hiTnl4Yk9WMWRYVjFkTEZ0Yk1qSXNNelVzYm5Wc2JDdzVORFF4T1RFd05qYzRPVFUzT0RBc01DeHVkV3hzTEZ0Yk1DeGJPVjFkWFYxZFhTeGJNQ3d3TEdaaGJITmxMRzUxYkd3c05UTXhOVFl6TXpnM01UazBNekV5TERNeE55eGJXeTB4TERNeUxHNTFiR3dzTUN4bVlXeHpaU3htWVd4elpTeG1ZV3h6WlN3NU16TTVORFV6TlRReU5qVTVNemNzYm5Wc2JDeGJXekV4TERRME56STVPVEV6TmpRMk5EQXhPRjBzV3pnc01GMHNXemNzV3pFMVhWMWRYVjBzVzFzeU1pd3pOU3h1ZFd4c0xETTJNVE0yTWpZNU1qUXpPREU1TUN3d0xHNTFiR3dzVzFzd0xGc3hOVjFkWFYxZFhTeGJNQ3d3TEdaaGJITmxMRzUxYkd3c01UVTFOemd4T0RRMk1UWXhPVE16TERNeE9DeGJXeTB4TERNeUxHNTFiR3dzTUN4bVlXeHpaU3htWVd4elpTeG1ZV3h6WlN3eE5EUTNNRGt6TlRBeE1qUXhOak1zYm5Wc2JDeGJXekV4TERRME56STVPVEV6TmpRMk5EQXhPRjBzV3pnc01GMHNXemNzV3pNMFhWMWRYVjBzVzFzeU1pd3pOU3h1ZFd4c0xERTBOVFUyT1RFME1EVTJPVFEwTXl3d0xHNTFiR3dzVzFzd0xGc3pORjFkWFYxZFhWMWRMRnN3TERBc1ptRnNjMlVzYm5Wc2JDdzFPREUyT1RjMU1UQTROalV5TlRRc016RTVMRnRiTVRNc016TXNiblZzYkN3d0xHWmhiSE5sTEdaaGJITmxMSFJ5ZFdVc01UazRORE15TmpNME1UUTRNVEl6TEc1MWJHd3NXMXN3TEZzMU5GMWRYVjFkTEZ0Yk1UTXNNelVzYm5Wc2JDd3pNek0xTXpjNE1EZzROekU0TkRnc01DeHVkV3hzTEZ0Yk1DeGJNVEZkWFYxZFhWMHNXekFzTUN4bVlXeHpaU3h1ZFd4c0xEY3dPVEF4T1RFek1qUXhORFk1TWl3ek1qQXNXMXN6TkN3ek15eHVkV3hzTERBc1ptRnNjMlVzWm1Gc2MyVXNkSEoxWlN3ME5UWTNOREUzT1RVMk5URXpNVE1zYm5Wc2JDeGJXekFzV3pZelhWMWRYVjBzVzFzek5Dd3pOU3h1ZFd4c0xEVXhNRE01TURjME9UUTJOamM0Tnl3d0xHNTFiR3dzVzFzd0xGc3hNRFpkWFYxZFhWMHNXekFzTUN4bVlXeHpaU3h1ZFd4c0xEVTFNRFE1TlRBNE5ERXlNVFU0Tnl3ek1qRXNXMXN6TkN3ek15eHVkV3hzTERBc1ptRnNjMlVzWm1Gc2MyVXNkSEoxWlN3eE56TTROalV3TVRVMk5UZ3dNamNzYm5Wc2JDeGJXekFzV3pZMFhWMWRYVjBzVzFzek5Dd3pOU3h1ZFd4c0xEY3pOVEkzT1RZNE9ERTFPVGcxTXl3d0xHNTFiR3dzVzFzd0xGczJNbDFkWFYxZFhTeGJNQ3d3TEdaaGJITmxMRzUxYkd3c01qRXdORFl3TURreE1UZzFPRFV6TERNeU1peGJXek0xTERNekxHNTFiR3dzTUN4bVlXeHpaU3htWVd4elpTeDBjblZsTERVNU1USTJNVGsxTVRjMU5UQTVOeXh1ZFd4c0xGdGJNQ3hiTlRWZFhWMWRYU3hiV3pNMUxETTFMRzUxYkd3c05qWXdNVGs0TXprMU9UazBOREUzTERBc2JuVnNiQ3hiV3pBc1d6RXhYVjFkWFYxZExGc3dMREFzWm1Gc2MyVXNiblZzYkN3NE9EQXpOemswTURjek5Ua3hORFVzTXpJekxGdGJNaklzTXpNc2JuVnNiQ3d3TEdaaGJITmxMR1poYkhObExIUnlkV1VzTkRFM016VXdOelk1T0RrMk5EY3dMRzUxYkd3c1cxc3dMRnMyTlYxZFhWMWRMRnRkTEZ0Yk1Dd3dMR1poYkhObExHNTFiR3dzT1RNeE16VTFNVGd5TmpBeU9USTVMRE15TkN4Yld5MHhMRE15TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4bVlXeHpaU3d4TURrek9EYzBOVGN5TkRJd01qSXNiblZzYkN4Yld6RXhMRFEwTnpJNU9URXpOalEyTkRBeE9GMHNXemdzTUYwc1d6Y3NXekpkWFYxZFhTeGJXekl5TERNMUxHNTFiR3dzTXpJNE5EZzJOemM1T1RnM01qazFMREFzYm5Wc2JDeGJXekFzV3pFd04xMWRYVjFkWFN4Yk1Dd3dMR1poYkhObExHNTFiR3dzTkRFMU16RTROelk0T1RFNU9UazNMRE15TlN4Yld5MHhMRE15TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4bVlXeHpaU3cwT0RrMU5qazJORE15TVRVd05ERXNiblZzYkN4Yld6RXhMRFEwTnpJNU9URXpOalEyTkRBeE9GMHNXemdzTUYwc1d6Y3NXelpkWFYxZFhTeGJXekl5TERNMUxHNTFiR3dzTWprNE1EQXdORGM0TkRjeU16UXdMREFzYm5Wc2JDeGJXekFzV3pZelhWMWRYVjFkTEZzd0xEQXNabUZzYzJVc2JuVnNiQ3cyTnpNeE5qTTVNVEV5TVRrMU5UTXNNekkyTEZ0YkxURXNNeklzYm5Wc2JDd3dMR1poYkhObExHWmhiSE5sTEdaaGJITmxMREkyTVRjNU1qYzBOamN5TVRBeE5TeHVkV3hzTEZ0Yk1URXNORFEzTWprNU1UTTJORFkwTURFNFhTeGJPQ3d3WFN4Yk55eGJNVE5kWFYxZFhTeGJXekl5TERNMUxHNTFiR3dzTlRVek1EazFOakk1TnpJNU56TTVMREFzYm5Wc2JDeGJXekFzV3pVMVhWMWRYVjFkTEZzd0xEQXNabUZzYzJVc2JuVnNiQ3czTlRBd05UWXlNRGd5TVRVMU9UVXNNekkzTEZ0YkxURXNNeklzYm5Wc2JDd3dMR1poYkhObExHWmhiSE5sTEdaaGJITmxMREUwTlRZek1UY3hNekkyTkRrME1DeHVkV3hzTEZ0Yk1URXNORFEzTWprNU1UTTJORFkwTURFNFhTeGJPQ3d3WFN4Yk55eGJNVEZkWFYxZFhTeGJXekl5TERNMUxHNTFiR3dzT1RneE56STJOemM0TkRjMU1UazNMREFzYm5Wc2JDeGJXekFzV3pkZFhWMWRYVjBzV3pBc01DeG1ZV3h6WlN4dWRXeHNMRGN5TVRZeU56WXlOREV6TWpjNU9Td3pNamdzVzFzdE1Td3pNaXh1ZFd4c0xEQXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNNamcwTVRjM05UY3dNVE16TURNMExHNTFiR3dzVzFzeE1TdzBORGN5T1RreE16WTBOalF3TVRoZExGczRMREJkTEZzM0xGczVYVjFkWFYwc1cxc3lNaXd6TlN4dWRXeHNMREU0TXpFME1UQTBORFV6TlRJek5pd3dMRzUxYkd3c1cxc3dMRnMxTkYxZFhWMWRYU3hiTUN3d0xHWmhiSE5sTEc1MWJHd3NPVGM0T1RZMk1UZzVOall5TkRrekxETXlPU3hiV3kweExETXlMRzUxYkd3c01DeG1ZV3h6WlN4bVlXeHpaU3htWVd4elpTd3hOVGM1TkRNd09ESXlNelkxTnpZc2JuVnNiQ3hiV3pFeExEUTBOekk1T1RFek5qUTJOREF4T0Ywc1d6Z3NNRjBzV3pjc1d6RTFYVjFkWFYwc1cxc3lNaXd6TlN4dWRXeHNMRFE1TnpNNE1ETTFORFkxT0RZNE1pd3dMRzUxYkd3c1cxc3dMRnMyTlYxZFhWMWRYU3hiTUN3d0xHWmhiSE5sTEc1MWJHd3NNek01TXpFd01EWXpNVFV5TVRJekxETXpNQ3hiV3kweExETXlMRzUxYkd3c01DeG1ZV3h6WlN4bVlXeHpaU3htWVd4elpTd3hNVFUzT0RNMk5UZzFNREF4T0RBc2JuVnNiQ3hiV3pFeExEUTBOekk1T1RFek5qUTJOREF4T0Ywc1d6Z3NNRjBzV3pjc1d6TTBYVjFkWFYwc1cxc3lNaXd6TlN4dWRXeHNMRFV3TVRBeU5UUTJOalF4TXpRME5Td3dMRzUxYkd3c1cxc3dMRnMyT0YxZFhWMWRYVjFkTEZzd0xEQXNabUZzYzJVc2JuVnNiQ3czTURZME5UTTVOek14TnpJeU56SXNNek14TEZ0Yk1UTXNNek1zYm5Wc2JDd3dMR1poYkhObExHWmhiSE5sTEhSeWRXVXNNakV6T1RJNE1UYzNOekk0T1RVeUxHNTFiR3dzVzFzd0xGczFPRjFkWFYxZExGdGJNVE1zTXpVc2JuVnNiQ3c0T1RNM01qTTNPRGcwTXpnMk5USXNNQ3h1ZFd4c0xGdGJNQ3hiTVRGZFhWMWRYVjBzV3pBc01DeG1ZV3h6WlN4dWRXeHNMREl3TkRBNU5qUTFNems1T0RZeE5pd3pNeklzVzFzek5Dd3pNeXh1ZFd4c0xEQXNabUZzYzJVc1ptRnNjMlVzZEhKMVpTdzRPRGczT1RBMU1UQXpNamcxTnpJc2JuVnNiQ3hiV3pBc1d6WTRYVjFkWFYwc1cxc3pOQ3d6TlN4dWRXeHNMRE15TkRnMk56RXlNREkzTlRrMk55d3dMRzUxYkd3c1cxc3dMRnN4TURoZFhWMWRYVjBzV3pBc01DeG1ZV3h6WlN4dWRXeHNMRFF3TURNek1ETXhORFUxTlRnME1pd3pNek1zVzFzek5Dd3pNeXh1ZFd4c0xEQXNabUZzYzJVc1ptRnNjMlVzZEhKMVpTd3lNVGN5T1RNNU9EazNOall6T1RBc2JuVnNiQ3hiV3pBc1d6Y3dYVjFkWFYwc1cxc3pOQ3d6TlN4dWRXeHNMRFF4TmpBNU1UYzNNelUzT0RnME55d3dMRzUxYkd3c1cxc3dMRnMzTTExZFhWMWRYU3hiTUN3d0xHWmhiSE5sTEc1MWJHd3NNalE1T0RZME5qSTNNREl3TVRrNExETXpOQ3hiV3pNMUxETXpMRzUxYkd3c01DeG1ZV3h6WlN4bVlXeHpaU3gwY25WbExEazRPREEzTmpZMU1qY3pNelEwT1N4dWRXeHNMRnRiTUN4Yk5UbGRYVjFkWFN4Yld6TTFMRE0xTEc1MWJHd3NPVGN5TXpRMk5UYzNOVFEyTWpjeExEQXNiblZzYkN4Yld6QXNXekV4WFYxZFhWMWRMRnN3TERBc1ptRnNjMlVzYm5Wc2JDdzRNRGczTURZM05UVTNNRFE0TWprc016TTFMRnRiTWpJc016TXNiblZzYkN3d0xHWmhiSE5sTEdaaGJITmxMSFJ5ZFdVc09UTTFPVGN3T0RZeU1qSTFPVEUyTEc1MWJHd3NXMXN3TEZzMk1WMWRYVjFkTEZ0ZExGdGJNQ3d3TEdaaGJITmxMRzUxYkd3c01UQTVPREkzTmpFd05qVTBNakUzTERNek5peGJXeTB4TERNeUxHNTFiR3dzTUN4bVlXeHpaU3htWVd4elpTeG1ZV3h6WlN3Mk16VTROalV5TmpJNU5qTXdNelVzYm5Wc2JDeGJXekV4TERRME56STVPVEV6TmpRMk5EQXhPRjBzV3pnc01GMHNXemNzV3pKZFhWMWRYU3hiV3pJeUxETTFMRzUxYkd3c09ERTJNREF6T1RRNU5UQTFNVEEzTERBc2JuVnNiQ3hiV3pBc1d6RXdOMTFkWFYxZFhTeGJNQ3d3TEdaaGJITmxMRzUxYkd3c05ESTVOamczTnpReE1Ea3hNemd6TERNek55eGJXeTB4TERNeUxHNTFiR3dzTUN4bVlXeHpaU3htWVd4elpTeG1ZV3h6WlN3ME1EQXlOalU1TlRrMU16Z3hORElzYm5Wc2JDeGJXekV4TERRME56STVPVEV6TmpRMk5EQXhPRjBzV3pnc01GMHNXemNzV3paZFhWMWRYU3hiV3pJeUxETTFMRzUxYkd3c016a3pOak13TlRrd05qUTBNelU1TERBc2JuVnNiQ3hiV3pBc1d6WXpYVjFkWFYxZExGc3dMREFzWm1Gc2MyVXNiblZzYkN3MU5qQTVOVEl6TURVNU9UYzJNREVzTXpNNExGdGJMVEVzTXpJc2JuVnNiQ3d3TEdaaGJITmxMR1poYkhObExHWmhiSE5sTERrMU1UZ3lNVEk0TURNNE9UVTNOeXh1ZFd4c0xGdGJNVEVzTkRRM01qazVNVE0yTkRZME1ERTRYU3hiT0N3d1hTeGJOeXhiTVROZFhWMWRYU3hiV3pJeUxETTFMRzUxYkd3c01qWXdOVEV5TWprNU5qRXdNelkxTERBc2JuVnNiQ3hiV3pBc1d6VTFYVjFkWFYxZExGc3dMREFzWm1Gc2MyVXNiblZzYkN3ek56TTFOakE1TnpBd056azRNelFzTXpNNUxGdGJMVEVzTXpJc2JuVnNiQ3d3TEdaaGJITmxMR1poYkhObExHWmhiSE5sTERrek1qWTFOekUwTkRjME5UazFNeXh1ZFd4c0xGdGJNVEVzTkRRM01qazVNVE0yTkRZME1ERTRYU3hiT0N3d1hTeGJOeXhiTVRGZFhWMWRYU3hiV3pJeUxETTFMRzUxYkd3c09UVXlNRGMwTkRJMk5EYzJOakkwTERBc2JuVnNiQ3hiV3pBc1d6ZGRYVjFkWFYwc1d6QXNNQ3htWVd4elpTeHVkV3hzTERjM01qZzRNelUxT1RjMU9UYzVNeXd6TkRBc1cxc3RNU3d6TWl4dWRXeHNMREFzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzTnpjeU5URTJORFl4TnpFMU5qazFMRzUxYkd3c1cxc3hNU3cwTkRjeU9Ua3hNelkwTmpRd01UaGRMRnM0TERCZExGczNMRnM1WFYxZFhWMHNXMXN5TWl3ek5TeHVkV3hzTERVd01UWTRORGcyTWpBME56SXlNQ3d3TEc1MWJHd3NXMXN3TEZzMU5GMWRYVjFkWFN4Yk1Dd3dMR1poYkhObExHNTFiR3dzTkRnMU1qZ3pNalkwTVRBeE1UQXdMRE0wTVN4Yld5MHhMRE15TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4bVlXeHpaU3cyTkRjM01qQTVNVFl5TlRRME5qY3NiblZzYkN4Yld6RXhMRFEwTnpJNU9URXpOalEyTkRBeE9GMHNXemdzTUYwc1d6Y3NXekUxWFYxZFhWMHNXMXN5TWl3ek5TeHVkV3hzTERJeE5qazFOamsyTWpJNU16UXhOU3d3TEc1MWJHd3NXMXN3TEZzMk5WMWRYVjFkWFN4Yk1Dd3dMR1poYkhObExHNTFiR3dzTlRFME1EUXhPREE0TVRFNU16WTFMRE0wTWl4Yld5MHhMRE15TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4bVlXeHpaU3czTXpJd05ESTFNakl6TlRVNE1USXNiblZzYkN4Yld6RXhMRFEwTnpJNU9URXpOalEyTkRBeE9GMHNXemdzTUYwc1d6Y3NXek0wWFYxZFhWMHNXMXN5TWl3ek5TeHVkV3hzTERjeU9ETTBOekF4T1Rnd016VTJOeXd3TEc1MWJHd3NXMXN3TEZzMk9GMWRYVjFkWFYxZFhWMHNXekFzTUN4bVlXeHpaU3h1ZFd4c0xETXhNREk1T1RnNU9UWXhNemMwTUN3ek5ETXNXMXN0TVN3ek1peHVkV3hzTERBc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc05UVXdOVFl4TWpZek9EQTFOemcxTEc1MWJHd3NXMXN4TVN3NE56UTVNalUzTVRNNE1UUXdOelpkTEZzNExEQmRMRnMzTEZzeE1WMWRYVjFkTEZ0ZExGdGJNQ3d3TEdaaGJITmxMRzUxYkd3c09EWTJNek0yTkRjNU56STRPVGs1TERNME5DeGJXekV6TERNekxHNTFiR3dzTUN4bVlXeHpaU3htWVd4elpTeDBjblZsTERRNU9Ua3lPRGN6TlRJNU9EUTJNaXh1ZFd4c0xGdGJNQ3hiTXpSZFhWMWRYU3hiV3pFekxETTFMRzUxYkd3c01UTXhPRGc0TXpRek16QXhNelF6TERBc2JuVnNiQ3hiV3pBc1d6RXpYVjFkWFYxZExGc3dMREFzWm1Gc2MyVXNiblZzYkN3NE5UazVNek0wTkRFNE5qQTJOelVzTXpRMUxGdGJNelFzTXpNc2JuVnNiQ3d3TEdaaGJITmxMR1poYkhObExIUnlkV1VzTWpFM01Ea3lNamt3TURVeU16UXlMRzUxYkd3c1cxc3dMRnMzTWwxZFhWMWRMRnRiTXpRc016VXNiblZzYkN3ek5UVXhNVEV5TnpNeU5UZzJNelVzTUN4dWRXeHNMRnRiTUN4Yk16bGRYVjFkWFYwc1d6QXNNQ3htWVd4elpTeHVkV3hzTERFNE16WXdOVEV3TlRBMU1qZzVNQ3d6TkRZc1cxc3pOQ3d6TXl4dWRXeHNMREFzWm1Gc2MyVXNabUZzYzJVc2RISjFaU3c0TVRBeU16UTBOREExT0RrMU9EWXNiblZzYkN4Yld6QXNXemN6WFYxZFhWMHNXMXN6TkN3ek5TeHVkV3hzTERJNU1EZ3dNakE1TlRVMk5UYzFNQ3d3TEc1MWJHd3NXMXN3TEZzM01sMWRYVjFkWFN4Yk1Dd3dMR1poYkhObExHNTFiR3dzTnpnME5ESXdPVGt4TVRjd09UZ3hMRE0wTnl4Yld6TTFMRE16TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4MGNuVmxMRGt3TnpJMU9UZzFPVFU0TkRBNE5peHVkV3hzTEZ0Yk1DeGJNemxkWFYxZFhTeGJXek0xTERNMUxHNTFiR3dzTVRnME5UVTJOVEl5TkRNME1ESXlMREFzYm5Wc2JDeGJXekFzV3pFelhWMWRYVjFkTEZzd0xEQXNabUZzYzJVc2JuVnNiQ3cwTURFeU1UZzJNakV4T0Rrek9UTXNNelE0TEZ0Yk1qSXNNek1zYm5Wc2JDd3dMR1poYkhObExHWmhiSE5sTEhSeWRXVXNOekkwT1RNNU1UQXdNRGsyTlRZMExHNTFiR3dzVzFzd0xGczJNRjFkWFYxZExGdGRMRnRiTUN3d0xHWmhiSE5sTEc1MWJHd3NNell6TmpZNU16TTROalE1T0RVd0xETTBPU3hiV3kweExETXlMRzUxYkd3c01DeG1ZV3h6WlN4bVlXeHpaU3htWVd4elpTdzNNRFU0TkRVNU56WTFNRGs0TWprc2JuVnNiQ3hiV3pFeExEUTBOekk1T1RFek5qUTJOREF4T0Ywc1d6Z3NNRjBzV3pjc1d6SmRYVjFkWFN4Yld6SXlMRE0xTEc1MWJHd3NORGd3TkRNM056YzNNVGsyTnpVMkxEQXNiblZzYkN4Yld6QXNXekV3TmwxZFhWMWRYU3hiTUN3d0xHWmhiSE5sTEc1MWJHd3NNVGN3TWpJNU5qVTVNams0TmpVNExETTFNQ3hiV3kweExETXlMRzUxYkd3c01DeG1ZV3h6WlN4bVlXeHpaU3htWVd4elpTd3pOekkzTkRJNE9ETTFOVGMyTkRRc2JuVnNiQ3hiV3pFeExEUTBOekk1T1RFek5qUTJOREF4T0Ywc1d6Z3NNRjBzV3pjc1d6WmRYVjFkWFN4Yld6SXlMRE0xTEc1MWJHd3NNelUxTWprd05qUTJNak00T0RrMExEQXNiblZzYkN4Yld6QXNXell5WFYxZFhWMWRMRnN3TERBc1ptRnNjMlVzYm5Wc2JDd3pNelF6TVRRek56VTBNalV5TURVc016VXhMRnRiTFRFc016SXNiblZzYkN3d0xHWmhiSE5sTEdaaGJITmxMR1poYkhObExETXdOVGN4T0RNNU9EZzNOek01T0N4dWRXeHNMRnRiTVRFc05EUTNNams1TVRNMk5EWTBNREU0WFN4Yk9Dd3dYU3hiTnl4Yk1UTmRYVjFkWFN4Yld6SXlMRE0xTEc1MWJHd3NNVEk1TkRVd05qQTNNamswTWpVeExEQXNiblZzYkN4Yld6QXNXemN3WFYxZFhWMWRMRnN3TERBc1ptRnNjMlVzYm5Wc2JDd3pOVFUzT0RneU5qWTRNalEwT0RZc016VXlMRnRiTFRFc016SXNiblZzYkN3d0xHWmhiSE5sTEdaaGJITmxMR1poYkhObExEUXpOemt3T0RneE16ZzNOalE0Tml4dWRXeHNMRnRiTVRFc05EUTNNams1TVRNMk5EWTBNREU0WFN4Yk9Dd3dYU3hiTnl4Yk1URmRYVjFkWFN4Yld6SXlMRE0xTEc1MWJHd3NNamt3TVRZNU1qazNOekk1TmpZNUxEQXNiblZzYkN4Yld6QXNXelU1WFYxZFhWMWRMRnN3TERBc1ptRnNjMlVzYm5Wc2JDdzBPVFl4T0RRMU5UUXpNVFkwTlRBc016VXpMRnRiTFRFc016SXNiblZzYkN3d0xHWmhiSE5sTEdaaGJITmxMR1poYkhObExEWTNPRFUyTVRNME9UUXlNVGc0T1N4dWRXeHNMRnRiTVRFc05EUTNNams1TVRNMk5EWTBNREU0WFN4Yk9Dd3dYU3hiTnl4Yk9WMWRYVjFkTEZ0Yk1qSXNNelVzYm5Wc2JDd3pOall3TXpnMU56YzBNalEwTkRjc01DeHVkV3hzTEZ0Yk1DeGJOemRkWFYxZFhWMHNXekFzTUN4bVlXeHpaU3h1ZFd4c0xEZzBOVFl4TnpreU56TTROalEzTXl3ek5UUXNXMXN0TVN3ek1peHVkV3hzTERBc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc01Ua3dNelE0TURJM09ERXpPRGM0TEc1MWJHd3NXMXN4TVN3ME5EY3lPVGt4TXpZME5qUXdNVGhkTEZzNExEQmRMRnMzTEZzeE5WMWRYVjFkTEZ0Yk1qSXNNelVzYm5Wc2JDd3pOVFEyTlRReU5qVTFPVGsyTURnc01DeHVkV3hzTEZ0Yk1DeGJOVGhkWFYxZFhWMHNXekFzTUN4bVlXeHpaU3h1ZFd4c0xEa3dOVGM1TURnM05EazBNVGc1TXl3ek5UVXNXMXN0TVN3ek1peHVkV3hzTERBc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc05qRTRNak0wT0RrMk5UWXdOamszTEc1MWJHd3NXMXN4TVN3ME5EY3lPVGt4TXpZME5qUXdNVGhkTEZzNExEQmRMRnMzTEZzek5GMWRYVjFkTEZ0Yk1qSXNNelVzYm5Wc2JDdzJOelV4T1RneE1ETTRNVGd5TnpJc01DeHVkV3hzTEZ0Yk1DeGJOakZkWFYxZFhWMWRYU3hiTUN3d0xHWmhiSE5sTEc1MWJHd3NNemMxTVRFMU1qUXhNVFl5TnpFekxETTFOaXhiV3pFekxETXpMRzUxYkd3c01DeG1ZV3h6WlN4bVlXeHpaU3gwY25WbExETTFOREV4TURRNU9EZ3dNakkyTml4dWRXeHNMRnRiTUN4Yk5ERmRYVjFkWFN4Yld6RXpMRE0xTEc1MWJHd3NPRFF5TURVMk1Ea3hNekk1TnpFeUxEQXNiblZzYkN4Yld6QXNXekV6WFYxZFhWMWRMRnN3TERBc1ptRnNjMlVzYm5Wc2JDdzBOelV6TXpFeE5EUTNOVGczTVRrc016VTNMRnRiTXpRc016TXNiblZzYkN3d0xHWmhiSE5sTEdaaGJITmxMSFJ5ZFdVc01qSTJOREExTXprek16Y3lOVEE0TEc1MWJHd3NXMXN3TEZzM05sMWRYVjFkTEZ0Yk16UXNNelVzYm5Wc2JDd3lOalEzTURReE16VTRNekUwTnpZc01DeHVkV3hzTEZ0Yk1DeGJNVEE1WFYxZFhWMWRMRnN3TERBc1ptRnNjMlVzYm5Wc2JDdzNOVE16T1RneE16WTBOVGcxTmprc016VTRMRnRiTXpRc016TXNiblZzYkN3d0xHWmhiSE5sTEdaaGJITmxMSFJ5ZFdVc09UTXlNelUxTURRMk5UVXhOalV3TEc1MWJHd3NXMXN3TEZzM04xMWRYVjFkTEZ0Yk16UXNNelVzYm5Wc2JDdzFNVEkxTVRNd05qazNNemd5TURRc01DeHVkV3hzTEZ0Yk1DeGJNVEJkWFYxZFhWMHNXekFzTUN4bVlXeHpaU3h1ZFd4c0xESXlNekF6T1RZMU1qVTNOVGN4T0N3ek5Ua3NXMXN6TlN3ek15eHVkV3hzTERBc1ptRnNjMlVzWm1Gc2MyVXNkSEoxWlN3M01qTXdOalF5TnpJMU5EQXlOaklzYm5Wc2JDeGJXekFzV3pReVhWMWRYVjBzVzFzek5Td3pOU3h1ZFd4c0xEUTVOalEzTlRJNU1UZzJNVGd4Tml3d0xHNTFiR3dzVzFzd0xGc3hNMTFkWFYxZFhTeGJNQ3d3TEdaaGJITmxMRzUxYkd3c05qa3hORFEyT1RVeE1qTTNORFE1TERNMk1DeGJXekl5TERNekxHNTFiR3dzTUN4bVlXeHpaU3htWVd4elpTeDBjblZsTERrd05EVXpORFkwTlRrME1EYzJPQ3h1ZFd4c0xGdGJNQ3hiTnpoZFhWMWRYU3hiWFN4Yld6QXNNQ3htWVd4elpTeHVkV3hzTERNeU5qZzNOak16TlRJME1USXhPU3d6TmpFc1cxc3RNU3d6TWl4dWRXeHNMREFzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzTnpNNE1UUTJOVEExTlRReE5qWTNMRzUxYkd3c1cxc3hNU3cwTkRjeU9Ua3hNelkwTmpRd01UaGRMRnM0TERCZExGczNMRnN5WFYxZFhWMHNXMXN5TWl3ek5TeHVkV3hzTERRNU16STRPVEUyTURNME5EQTBNaXd3TEc1MWJHd3NXMXN3TEZzeE1EWmRYVjFkWFYwc1d6QXNNQ3htWVd4elpTeHVkV3hzTERFMU5qRXpPVEEwT0RJeU5UUXlNQ3d6TmpJc1cxc3RNU3d6TWl4dWRXeHNMREFzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzT0RJM01UZzVPVEUxTVRBeU5qZ3lMRzUxYkd3c1cxc3hNU3cwTkRjeU9Ua3hNelkwTmpRd01UaGRMRnM0TERCZExGczNMRnMyWFYxZFhWMHNXMXN5TWl3ek5TeHVkV3hzTERJeE1EVXlOemcyTnpVM056VTJOU3d3TEc1MWJHd3NXMXN3TEZzMk1sMWRYVjFkWFN4Yk1Dd3dMR1poYkhObExHNTFiR3dzTlRjNU5qYzROems1Tmpnek16VTBMRE0yTXl4Yld5MHhMRE15TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4bVlXeHpaU3czTVRnNE1EUTNOems1TXpRek9UY3NiblZzYkN4Yld6RXhMRFEwTnpJNU9URXpOalEyTkRBeE9GMHNXemdzTUYwc1d6Y3NXekV6WFYxZFhWMHNXMXN5TWl3ek5TeHVkV3hzTERJeU1qWTFOak16T1RreU16ZzROeXd3TEc1MWJHd3NXMXN3TEZzM01GMWRYVjFkWFN4Yk1Dd3dMR1poYkhObExHNTFiR3dzTlRJME5qTTROVFk1TnpNeE5UQXlMRE0yTkN4Yld5MHhMRE15TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4bVlXeHpaU3c0TnpReU56WTFOamMwT1RFek9UY3NiblZzYkN4Yld6RXhMRFEwTnpJNU9URXpOalEyTkRBeE9GMHNXemdzTUYwc1d6Y3NXekV4WFYxZFhWMHNXMXN5TWl3ek5TeHVkV3hzTERNMk9ETTJNREExTkRFMU5qTTJNeXd3TEc1MWJHd3NXMXN3TEZzMU9WMWRYVjFkWFN4Yk1Dd3dMR1poYkhObExHNTFiR3dzT0RVNE1EYzVNakUyTlRRNU9USTRMRE0yTlN4Yld5MHhMRE15TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4bVlXeHpaU3d5TWpjd05qYzFPRFkyTVRrME5qRXNiblZzYkN4Yld6RXhMRFEwTnpJNU9URXpOalEyTkRBeE9GMHNXemdzTUYwc1d6Y3NXemxkWFYxZFhTeGJXekl5TERNMUxHNTFiR3dzTkRFMk1ETXhOVGs1T0RjM05UTTNMREFzYm5Wc2JDeGJXekFzV3pjM1hWMWRYVjFkTEZzd0xEQXNabUZzYzJVc2JuVnNiQ3cwTnpBNE5EUTRNakUwT0RrMU9EVXNNelkyTEZ0YkxURXNNeklzYm5Wc2JDd3dMR1poYkhObExHWmhiSE5sTEdaaGJITmxMRFUxTVRVd01EVTNPREkyTVRnNE55eHVkV3hzTEZ0Yk1URXNORFEzTWprNU1UTTJORFkwTURFNFhTeGJPQ3d3WFN4Yk55eGJNVFZkWFYxZFhTeGJXekl5TERNMUxHNTFiR3dzTnpVNU1URTFNakkyTVRVMU5UTTFMREFzYm5Wc2JDeGJXekFzV3pVNFhWMWRYVjFkTEZzd0xEQXNabUZzYzJVc2JuVnNiQ3c1TlRZeU5ESTRNRFl3TURNNU1EY3NNelkzTEZ0YkxURXNNeklzYm5Wc2JDd3dMR1poYkhObExHWmhiSE5sTEdaaGJITmxMREUwT1RrNU5EVTJORGszTURNMU5TeHVkV3hzTEZ0Yk1URXNORFEzTWprNU1UTTJORFkwTURFNFhTeGJPQ3d3WFN4Yk55eGJNelJkWFYxZFhTeGJXekl5TERNMUxHNTFiR3dzTWpjek1EQTNNREk1T1RZNE5qUTBMREFzYm5Wc2JDeGJXekFzV3pZeFhWMWRYVjFkWFYwc1d6QXNNQ3htWVd4elpTeHVkV3hzTERFek1ESXlORFEzT1RJeU1qZ3lOQ3d6Tmpnc1cxc3hNeXd6TXl4dWRXeHNMREFzWm1Gc2MyVXNabUZzYzJVc2RISjFaU3czTWpBek9UazRPRGd6T0RBeU9EWXNiblZzYkN4Yld6QXNXelkxWFYxZFhWMHNXMXN4TXl3ek5TeHVkV3hzTERFNE5EUTROemd6T1Rjd05ESTFNU3d3TEc1MWJHd3NXMXN3TEZzMlhWMWRYVjFkTEZzd0xEQXNabUZzYzJVc2JuVnNiQ3c0T1RjeU9EY3pNVFl4TVRrME56WXNNelk1TEZ0Yk16UXNNek1zYm5Wc2JDd3dMR1poYkhObExHWmhiSE5sTEhSeWRXVXNNVEEwTmpVek5qQXlNemc0TlRreUxHNTFiR3dzVzFzd0xGczJNMTFkWFYxZExGdGJNelFzTXpVc2JuVnNiQ3c1T1RNME9EWXpOalU1TlRBMU5qQXNNQ3h1ZFd4c0xGdGJNQ3hiTXpSZFhWMWRYVjBzV3pBc01DeG1ZV3h6WlN4dWRXeHNMREl4TXpBMU9Ea3hORE0wTkRjd09Dd3pOekFzVzFzek5Dd3pNeXh1ZFd4c0xEQXNabUZzYzJVc1ptRnNjMlVzZEhKMVpTdzBORFEyTmpRMU1ESXlNRGc0T0Rjc2JuVnNiQ3hiV3pBc1d6WTBYVjFkWFYwc1cxc3pOQ3d6TlN4dWRXeHNMRGcxTlRNNU5qVXdPREF3TmpFeU1Td3dMRzUxYkd3c1cxc3dMRnMyTUYxZFhWMWRYU3hiTUN3d0xHWmhiSE5sTEc1MWJHd3NOVFV4TVRBNE16QXhPVEF5TVRrMUxETTNNU3hiV3pNMUxETXpMRzUxYkd3c01DeG1ZV3h6WlN4bVlXeHpaU3gwY25WbExETTFNRFUxTnpVMU9UUTRNek0yTml4dWRXeHNMRnRiTUN4Yk5UVmRYVjFkWFN4Yld6TTFMRE0xTEc1MWJHd3NOamM0TnpRNU9UTTRNVEUxTmpFd0xEQXNiblZzYkN4Yld6QXNXelpkWFYxZFhWMHNXekFzTUN4bVlXeHpaU3h1ZFd4c0xEUTVPVE0wT0RnMk1UUTFNek16T1N3ek56SXNXMXN5TWl3ek15eHVkV3hzTERBc1ptRnNjMlVzWm1Gc2MyVXNkSEoxWlN3eE5EVTRNVEEyTVRVeE9UQTBNVGNzYm5Wc2JDeGJXekFzV3pZMVhWMWRYVjBzVzEwc1cxc3dMREFzWm1Gc2MyVXNiblZzYkN3Mk9UTXhOamt6TVRRMk9UTTNOamdzTXpjekxGdGJMVEVzTXpJc2JuVnNiQ3d3TEdaaGJITmxMR1poYkhObExHWmhiSE5sTERFek9ERTVNall4TkRVeU5qTTJOeXh1ZFd4c0xGdGJNVEVzTkRRM01qazVNVE0yTkRZME1ERTRYU3hiT0N3d1hTeGJOeXhiTWwxZFhWMWRMRnRiTWpJc016VXNiblZzYkN3ek1Ea3dOamc0TWpZeE9URXhOREVzTUN4dWRXeHNMRnRiTUN4Yk5qQmRYVjFkWFYwc1d6QXNNQ3htWVd4elpTeHVkV3hzTERNNU16WXdNVGd4T1RBM01qazBOaXd6TnpRc1cxc3RNU3d6TWl4dWRXeHNMREFzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzT1RreU5UZzNNRGcxT0RVNE5USTNMRzUxYkd3c1cxc3hNU3cwTkRjeU9Ua3hNelkwTmpRd01UaGRMRnM0TERCZExGczNMRnMyWFYxZFhWMHNXMXN5TWl3ek5TeHVkV3hzTERrM01EZ3dNRFkzTURZME5qRTROeXd3TEc1MWJHd3NXMXN3TEZzM01sMWRYVjFkWFN4Yk1Dd3dMR1poYkhObExHNTFiR3dzT0Rnek5EWXlOamN3TXpBMU16WTRMRE0zTlN4Yld5MHhMRE15TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4bVlXeHpaU3d5TmpBeE1UazFOalUzT1RjNU56Y3NiblZzYkN4Yld6RXhMRFEwTnpJNU9URXpOalEyTkRBeE9GMHNXemdzTUYwc1d6Y3NXekV6WFYxZFhWMHNXMXN5TWl3ek5TeHVkV3hzTERnd09EUXlOamc0TkRZek5UQTFOU3d3TEc1MWJHd3NXMXN3TEZzM00xMWRYVjFkWFN4Yk1Dd3dMR1poYkhObExHNTFiR3dzTWpZMk9EUTFOREE1TWpneE5qa3dMRE0zTml4Yld5MHhMRE15TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4bVlXeHpaU3cwTlRBNE16UXlOamd3T0RJMU5ESXNiblZzYkN4Yld6RXhMRFEwTnpJNU9URXpOalEyTkRBeE9GMHNXemdzTUYwc1d6Y3NXekV4WFYxZFhWMHNXMXN5TWl3ek5TeHVkV3hzTERRNU5EUTRPVFE0TURVeU5UUTVNQ3d3TEc1MWJHd3NXMXN3TEZzek9WMWRYVjFkWFN4Yk1Dd3dMR1poYkhObExHNTFiR3dzTVRneE1qVTFNalkyT1RreU9ERXlMRE0zTnl4Yld5MHhMRE15TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4bVlXeHpaU3c0TlRNM01UVTNOamczTmpreE56VXNiblZzYkN4Yld6RXhMRFEwTnpJNU9URXpOalEyTkRBeE9GMHNXemdzTUYwc1d6Y3NXemxkWFYxZFhTeGJXekl5TERNMUxHNTFiR3dzTVRZNU5URTNOamc0TnpFeU16RXdMREFzYm5Wc2JDeGJXekFzV3pFd09GMWRYVjFkWFN4Yk1Dd3dMR1poYkhObExHNTFiR3dzTXpjek5qTTRNVGM1TkRrNE5EQTFMRE0zT0N4Yld5MHhMRE15TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4bVlXeHpaU3cyTlRnd05qZ3pOVGcyTXpRME1Ua3NiblZzYkN4Yld6RXhMRFEwTnpJNU9URXpOalEyTkRBeE9GMHNXemdzTUYwc1d6Y3NXekUxWFYxZFhWMHNXMXN5TWl3ek5TeHVkV3hzTERrM016VXhOVEkzTURjeU16ZzNOaXd3TEc1MWJHd3NXMXN3TEZzeE1EbGRYVjFkWFYwc1d6QXNNQ3htWVd4elpTeHVkV3hzTERVeU5UWTBNak14TXpVek9ERXdPU3d6Tnprc1cxc3RNU3d6TWl4dWRXeHNMREFzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzTmpBME1qVXhNVFEzTmpBeU56azFMRzUxYkd3c1cxc3hNU3cwTkRjeU9Ua3hNelkwTmpRd01UaGRMRnM0TERCZExGczNMRnN6TkYxZFhWMWRMRnRiTWpJc016VXNiblZzYkN3eE16WTVNemcxTlRJek9UY3lNamNzTUN4dWRXeHNMRnRiTUN4Yk1UQmRYVjFkWFYxZFhTeGJNQ3d3TEdaaGJITmxMRzUxYkd3c05UazBNemsyTXpZeE1EazJNekUzTERNNE1DeGJXekV6TERNekxHNTFiR3dzTUN4bVlXeHpaU3htWVd4elpTeDBjblZsTERjMU56TTVORE14TkRrNE5qUXpOU3h1ZFd4c0xGdGJNQ3hiTlRoZFhWMWRYU3hiV3pFekxETTFMRzUxYkd3c01qY3dNemcyT0RBd09UUTBOVFUzTERBc2JuVnNiQ3hiV3pBc1d6WmRYVjFkWFYwc1d6QXNNQ3htWVd4elpTeHVkV3hzTERRME5qSXhOREUwTlRnd016QXhNU3d6T0RFc1cxc3pOQ3d6TXl4dWRXeHNMREFzWm1Gc2MyVXNabUZzYzJVc2RISjFaU3c0TVRnM09UTTBNemMyTWpZMU9EWXNiblZzYkN4Yld6QXNXelk0WFYxZFhWMHNXMXN6TkN3ek5TeHVkV3hzTERjd016VTRPVE13TVRNek1qZzRNQ3d3TEc1MWJHd3NXMXN3TEZzeE1WMWRYVjFkWFN4Yk1Dd3dMR1poYkhObExHNTFiR3dzTWpRNE1ETTVPVGMwTmpNeE16QTJMRE00TWl4Yld6TTBMRE16TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4MGNuVmxMRFF3TURBNE9Ua3dPREkxT1RNME1DeHVkV3hzTEZ0Yk1DeGJOekJkWFYxZFhTeGJXek0wTERNMUxHNTFiR3dzTXpjd01UQTJOakEzTWpnMU5qVXpMREFzYm5Wc2JDeGJXekFzV3paZFhWMWRYVjBzV3pBc01DeG1ZV3h6WlN4dWRXeHNMRGM1T1Rjd09EazFOekl6TXprMU1pd3pPRE1zVzFzek5Td3pNeXh1ZFd4c0xEQXNabUZzYzJVc1ptRnNjMlVzZEhKMVpTd3hNekF5TWpnNE1qUXlNakU0TkRVc2JuVnNiQ3hiV3pBc1d6VTVYVjFkWFYwc1cxc3pOU3d6TlN4dWRXeHNMRFEwTWpNMU1UVTVOamczTWpjMk5Td3dMRzUxYkd3c1cxc3dMRnMyWFYxZFhWMWRMRnN3TERBc1ptRnNjMlVzYm5Wc2JDdzFNakF5TWpNMU9ESTVNREF6T1RFc016ZzBMRnRiTWpJc016TXNiblZzYkN3d0xHWmhiSE5sTEdaaGJITmxMSFJ5ZFdVc05qQXpOVFEwTnprMk9ETXhORGN3TEc1MWJHd3NXMXN3TEZzMk1WMWRYVjFkTEZ0ZExGdGJNQ3d3TEdaaGJITmxMRzUxYkd3c05URTVNREkwT1RRMk56QTNNek13TERNNE5TeGJXeTB4TERNeUxHNTFiR3dzTUN4bVlXeHpaU3htWVd4elpTeG1ZV3h6WlN3Mk5EQXdOek16TkRnNU1qQTVPRFlzYm5Wc2JDeGJXekV4TERRME56STVPVEV6TmpRMk5EQXhPRjBzV3pnc01GMHNXemNzV3pKZFhWMWRYU3hiV3pJeUxETTFMRzUxYkd3c01USTJOall6T0RjeE56WTRNVEl5TERBc2JuVnNiQ3hiV3pBc1d6WXdYVjFkWFYxZExGc3dMREFzWm1Gc2MyVXNiblZzYkN3NE16RTFOekUyTkRRME5qZ3pNakFzTXpnMkxGdGJMVEVzTXpJc2JuVnNiQ3d3TEdaaGJITmxMR1poYkhObExHWmhiSE5sTERrNU5UZzBOall6TWpFNE5Ea3lNQ3h1ZFd4c0xGdGJNVEVzTkRRM01qazVNVE0yTkRZME1ERTRYU3hiT0N3d1hTeGJOeXhiTmwxZFhWMWRMRnRiTWpJc016VXNiblZzYkN3Mk1EWTROamsxTWpFME56YzFNakVzTUN4dWRXeHNMRnRiTUN4Yk56SmRYVjFkWFYwc1d6QXNNQ3htWVd4elpTeHVkV3hzTERRM01qZzJNRFU0TVRJNE1qazVOQ3d6T0Rjc1cxc3RNU3d6TWl4dWRXeHNMREFzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzTmpFMk5EazVNVEEzTnpReU5qTXhMRzUxYkd3c1cxc3hNU3cwTkRjeU9Ua3hNelkwTmpRd01UaGRMRnM0TERCZExGczNMRnN4TTExZFhWMWRMRnRiTWpJc016VXNiblZzYkN3NU16TXpNekl3TXprM016TTROek1zTUN4dWRXeHNMRnRiTUN4Yk56TmRYVjFkWFYwc1d6QXNNQ3htWVd4elpTeHVkV3hzTERFeU16UXlNalU0T1RnMU1ETXlNU3d6T0Rnc1cxc3RNU3d6TWl4dWRXeHNMREFzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzTnpjeU5UZ3pPVFl6TmpjeU1EazFMRzUxYkd3c1cxc3hNU3cwTkRjeU9Ua3hNelkwTmpRd01UaGRMRnM0TERCZExGczNMRnN4TVYxZFhWMWRMRnRiTWpJc016VXNiblZzYkN3Mk9ETXdPVEF4T0RrNE5qSXhNVElzTUN4dWRXeHNMRnRiTUN4Yk16bGRYVjFkWFYwc1d6QXNNQ3htWVd4elpTeHVkV3hzTERZd01Ea3lNekkzTXpFNE5qUTVPU3d6T0Rrc1cxc3RNU3d6TWl4dWRXeHNMREFzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzT1RnME9UVTFNVEUzTmpJME5EWTFMRzUxYkd3c1cxc3hNU3cwTkRjeU9Ua3hNelkwTmpRd01UaGRMRnM0TERCZExGczNMRnM1WFYxZFhWMHNXMXN5TWl3ek5TeHVkV3hzTERJd01UWTJORFV5TnpNek9UY3dOeXd3TEc1MWJHd3NXMXN3TEZzeE1EaGRYVjFkWFYwc1d6QXNNQ3htWVd4elpTeHVkV3hzTERNM05qVXlOVFF3TURFME9EZzRPQ3d6T1RBc1cxc3RNU3d6TWl4dWRXeHNMREFzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzTlRjeE56a3lPRGN4T0Rjd01ETTVMRzUxYkd3c1cxc3hNU3cwTkRjeU9Ua3hNelkwTmpRd01UaGRMRnM0TERCZExGczNMRnN4TlYxZFhWMWRMRnRiTWpJc016VXNiblZzYkN3Mk5UZ3pNVGt4TmpBNE9ETXdPVE1zTUN4dWRXeHNMRnRiTUN4Yk1UQTVYVjFkWFYxZExGc3dMREFzWm1Gc2MyVXNiblZzYkN3eE9EWTBPVE14TURrek5EUTVOallzTXpreExGdGJMVEVzTXpJc2JuVnNiQ3d3TEdaaGJITmxMR1poYkhObExHWmhiSE5sTERrMU56UTFOekV3T1RrME56VTFNaXh1ZFd4c0xGdGJNVEVzTkRRM01qazVNVE0yTkRZME1ERTRYU3hiT0N3d1hTeGJOeXhiTXpSZFhWMWRYU3hiV3pJeUxETTFMRzUxYkd3c09ERXdNREF4TnpRMU9EVXdPRGsyTERBc2JuVnNiQ3hiV3pBc1d6RXdYVjFkWFYxZFhWMWRYVjFkTEZzd0xEQXNabUZzYzJVc2JuVnNiQ3d4TWpNME1EVTROalEwTmpFeU1Ea3NNemt5TEZ0Yk5pd3pOeXh1ZFd4c0xEQXNabUZzYzJVc1ptRnNjMlVzZEhKMVpTdzNPRFUxTnpVME1EWXdOamN6T1RBc2JuVnNiQ3hiV3pBc1d6RTFYVjFkWFYwc1cxczJMRGs1TEc1MWJHd3NOemc0TURZME9EazFOemcyTnpVd0xEQXNiblZzYkN4Yld6Y3NXelF6TEZzekxERTNNakkwTVRJME1EY3pNVEUyTmwxZFhWMWRYVjBzV3pBc01DeG1ZV3h6WlN4dWRXeHNMRGN3TlRBeU9EazVNelF4T0RZMk9Dd3pPVE1zVzFzMkxETTNMRzUxYkd3c01DeG1ZV3h6WlN4bVlXeHpaU3gwY25WbExEZ3lNRGMzTWprMk9Ua3pOalkxTml4dWRXeHNMRnRiTUN4Yk1qQmRYVjFkWFN4Yld6WXNPVGtzYm5Wc2JDdzFOamt4TWpVME1EUXpNREEwTlRrc01DeHVkV3hzTEZ0Yk55eGJORE1zV3pNc056WTRNekV5TWpFMk5qZzJNemd4WFYxZFhWMWRYU3hiTUN3d0xHWmhiSE5sTEc1MWJHd3NNVEExTWpJeE16RXhPREV6TXpZMExETTVOQ3hiV3pFMUxERXdNQ3dpVkdsdFpYSWlMREFzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzT1RZeE1UZzVNakl5TkRZd01USXpMRzUxYkd3c1cxc3hMRnN4TVRCZFhWMWRYU3hiWFN4Yld6QXNNQ3htWVd4elpTeHVkV3hzTERZek56VXhNREV5TVRBNE16a3dNQ3d6T1RVc1cxc3RNU3d6TWl4dWRXeHNMREFzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzTXpZNE56azRNRGczT0RFM09EY3dMRzUxYkd3c1cxc3hNU3cwTmpZME5EVXhOVEU1T1RjeE1URmRMRnM0TERCZExGczNMRnN5WFYxZFhWMHNXMXN6TERnMExHNTFiR3dzTXpJMU9ETXdOVFF4T1RRM05ERTRMREVzYm5Wc2JGMWRYVjFkTEZzd0xEQXNabUZzYzJVc2JuVnNiQ3c1T1RjM05qUTNORFV6TWpjM056RXNNemsyTEZ0Yk1USXNNVEF4TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4MGNuVmxMRE13TnpJMk5qa3hOalk0TmpFNE1peHVkV3hzTEZ0Yk5Dd3hOMTFkWFN4YkxURXNNeklzYm5Wc2JDd3dMR1poYkhObExHWmhiSE5sTEdaaGJITmxMRFF4TXpjME16VTFNekF4TkRBek55eHVkV3hzTEZ0Yk1URXNNVEV6TlRVME9EVXdNakl5T0RVNFhTeGJPQ3d3WFN4Yk55eGJNbDFkWFYxZExGdGJNVFVzTVRBeUxDSlVhVzFsY2lJc05EY3pORFk1TXpBeE9EZzNNVFk1TERBc2JuVnNiQ3hiV3pFc1d6RXhNRjFkWFYwc1d6RTFMREV3TXl3aVZHbHRaWElpTERVeU9UZzFOVFExTVRReU9UWXdNeXd3TEc1MWJHd3NXMXN3TEZzMlhWMHNXek1zTUYwc1d6RXNXekV4TUYxZFhWMHNXeTB4TERFd05DeHVkV3hzTERNMU1UQXhOalkwTmpRME56WTRNaXd3TEc1MWJHd3NXMXMwTERFeVhWMWRMRnN0TVN3MU9TeHVkV3hzTERjMk5ESXhPVEEyTURZd016WTRNeXd3TEc1MWJHd3NXMXN4TVN3M05UYzFPRGd3TWpFd056Z3hORE5kTEZzM0xGczJYVjFkWFN4Yk1UY3NNVEExTEc1MWJHd3NOamcwTnpBeE9EZzFNakkwTURjM0xEQXNiblZzYkN4Yld6TXNNRjFkWFN4YkxURXNNVEEyTEc1MWJHd3NOREkwTnpZeE1EVXpOVFU0TlRZNUxEQXNiblZzYkN4Yld6QXNXek0zWFYxZFhTeGJMVEVzTVRBM0xHNTFiR3dzTVRRMU5qa3dOVEkxTXpJM05qWTVMREFzYm5Wc2JDeGJXelFzTVRWZExGc3dMRnMyWFYxZFhWMHNXMXN3TERBc1ptRnNjMlVzYm5Wc2JDd3lNek14TlRjMk5EUXhNekUyTWpRc016azNMRnRiTFRFc016SXNiblZzYkN3d0xHWmhiSE5sTEdaaGJITmxMR1poYkhObExERXlPREl3T1RRME1ERTFNekF6TlN4dWRXeHNMRnRiTVRFc05EZzROVGsyTmpJeU56azBOak00WFN4Yk9Dd3dYU3hiTnl4Yk1sMWRYVjFkTEZ0Yk1TdzJOaXh1ZFd4c0xEUTBNalkwTnprNU5URXlPVFEyT1N3d0xHNTFiR3dzVzFzeUxGc2labUZ1Y3lJc1ptRnNjMlZkWFN4Yk15d3dYU3hiTUN4Yk1sMWRMRnN3TEZzeVhWMHNXekVzV3pJMFhWMWRYVjFkTEZzd0xEQXNabUZzYzJVc2JuVnNiQ3cyTnpjNE1qZ3hOemMyT0RnNE1qY3NNems0TEZ0Yk1UY3NNek1zYm5Wc2JDd3dMR1poYkhObExHWmhiSE5sTEhSeWRXVXNORGsxT1RnNE16STRNRFl4TnpBNUxHNTFiR3dzVzFzd0xGczJNbDFkWFYxZExGdGJMVEVzTVRBNExHNTFiR3dzTlRRMU9UTXhPVGMxTVRnek9UQTRMREFzYm5Wc2JDeGJXekV4TERjMk9ETXhNakl4TmpZNE5qTTRNVjBzV3pjc1d6WmRYVjFkTEZzdE1TdzFPU3h1ZFd4c0xEVTBNVFl4TkRFek1EUTJOVEV6TWl3d0xHNTFiR3dzVzFzeE1TdzNNelUzTnpnMk16TTBPVFE0TmpOZExGczNMRnN5WFYxZFhWMHNXMXN3TERBc1ptRnNjMlVzYm5Wc2JDdzNNRE16TURjNU1UQTVNelE1TWpZc016azVMRnRiTFRFc016SXNiblZzYkN3d0xHWmhiSE5sTEdaaGJITmxMR1poYkhObExEWTRNRFF5TlRNeU1qSTROakl6TUN4dWRXeHNMRnRiTVRFc056WTRNekV5TWpFMk5qZzJNemd4WFN4Yk9Dd3hYU3hiTnl4Yk1UVmRYVjFkWFN4Yld5MHhMRFU1TEc1MWJHd3NOVE0yTmpBd056VTNNak14T1RFMUxEQXNiblZzYkN4Yld6RXhMREV4TXpVMU5EZzFNREl5TWpnMU9GMHNXemNzV3paZFhWMWRYVjFkWFN4Yk1Dd3dMR1poYkhObExHNTFiR3dzT0RRNU1EWXdNamM1T1RRNE5qYzFMRFF3TUN4Yld6RTNMRE16TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4MGNuVmxMRFl3TVRZek5ESXpOemszTmpJek5TeHVkV3hzTEZ0Yk1DeGJNVEZkWFYxZFhTeGJXeTB4TERFd09DeHVkV3hzTERJeU5qVTRNVGN4T1RFeE16QTFNeXd3TEc1MWJHd3NXMXN4TVN3eE56SXlOREV5TkRBM016RXhOalpkTEZzM0xGczJYVjFkWFN4YkxURXNOVGtzYm5Wc2JDd3hNamt4TkRRMk1UYzNPRFUwTkRrc01DeHVkV3hzTEZ0Yk1URXNOek0xTnpjNE5qTXpORGswT0RZelhTeGJOeXhiTmwxZFhWMWRMRnRiTUN3d0xHWmhiSE5sTEc1MWJHd3NOVGMwTnpNek1UWXpNakF4TURjM0xEUXdNU3hiV3kweExETXlMRzUxYkd3c01DeG1ZV3h6WlN4bVlXeHpaU3htWVd4elpTdzFNRFF4TURBNE5UQTBPVEV6TmpRc2JuVnNiQ3hiV3pFeExERTNNakkwTVRJME1EY3pNVEUyTmwwc1d6Z3NNVjBzV3pjc1d6RTFYVjFkWFYwc1cxc3RNU3cxT1N4dWRXeHNMREU0TWpNNU56ZzJNelE0TWpNeU15d3dMRzUxYkd3c1cxc3hNU3d4TVRNMU5UUTROVEF5TWpJNE5UaGRMRnMzTEZzMlhWMWRYVjFkWFYxZFhTeGJNQ3d3TEdaaGJITmxMRzUxYkd3c09URTJOVE00TXpnNU5qRXpPVEF5TERRd01peGJXeTB4TERNeUxHNTFiR3dzTUN4bVlXeHpaU3htWVd4elpTeG1ZV3h6WlN3Mk5EWTNPREUxT0RVNE1qQTRNRElzYm5Wc2JDeGJXekV4TERFeE16VTFORGcxTURJeU1qZzFPRjBzV3pnc01GMHNXemNzV3paZFhWMWRMRnN0TVN3ek1peHVkV3hzTERBc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc01qWTRNREV6T0RJMU1ETTFPVEUzTEc1MWJHd3NXMXN4TVN3NE5UTTRORGMyT1RRMk5EQXlNak5kTEZzNExEQmRMRnMzTEZzeVhWMWRYVjBzVzEwc1cxc3dMREFzWm1Gc2MyVXNiblZzYkN3MU56VTNNakF3TmpJek1qa3pPVFFzTkRBekxGdGJMVEVzTWpFc2JuVnNiQ3d3TEdaaGJITmxMR1poYkhObExHWmhiSE5sTERFd05UWTNNemd6TWprM01UWXhPQ3h1ZFd4c1hWMHNXMXN0TVN3M01peHVkV3hzTERZd05EazJNRGMwTURNNU1qY3hPU3d5TEc1MWJHd3NXMXN3TEZzMlhWMWRYU3hiTFRFc05Ua3NiblZzYkN3eE5UazVOalUwT1RFMk5ETXdPVFlzTUN4dWRXeHNMRnRiTVRFc056VTNOVGc0TURJeE1EYzRNVFF6WFN4Yk55eGJNbDFkWFYwc1d6RTNMREV3TlN4dWRXeHNMRE14TWpNek16UTJNREUwTmpBeU55d3dMRzUxYkd3c1cxc3pMREZkWFYwc1d5MHhMREV3Tml4dWRXeHNMRGMyT1RFNE1ERTFOak0zTnpjME1Td3dMRzUxYkd3c1cxc3dMRnMyWFYxZFhTeGJMVEVzTVRBNUxHNTFiR3dzTnpJeE9EUXpPVFV5T1RVek1ETXdMREFzYm5Wc2JDeGJXekFzV3paZFhWMWRMRnN0TVN3MU9TeHVkV3hzTERneU5EYzFPVGMwTlRNM01UTTVNeXd3TEc1MWJHd3NXMXN4TVN3eE1UTTFOVFE0TlRBeU1qSTROVGhkTEZzM0xGc3lYVjFkWFN4YkxURXNOVGtzYm5Wc2JDd3lNakV6TVRNek5EY3dOek14TWpZc01DeHVkV3hzTEZ0Yk1URXNOakUxTURJM05qVXdPRFU1TWpJd1hTeGJOeXhiTWwxZFhWMHNXeTB4TERjekxHNTFiR3dzT0RNM016RTBOelUxTkRrMU1qVTNMREFzYm5Wc2JGMWRYVjFkTEZzd0xEQXNabUZzYzJVc2JuVnNiQ3cyTlRneU56VXhNREV3T0RnM05UQXNOREEwTEZ0YkxURXNNVEV3TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4bVlXeHpaU3cxTmpNNU5UY3pNRFk0TkRnM09Ea3NiblZzYkYwc1d5MHhMRE15TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4bVlXeHpaU3d4TURRMk1ETXhNakE0TVRrNU5UVXNiblZzYkN4Yld6RXhMRGMxTnpVNE9EQXlNVEEzT0RFME0xMHNXemdzTUYwc1d6Y3NXelpkWFYxZFhTeGJXekUxTERFeE1TeHVkV3hzTERFM09EWTVOREE0TmpjNU5EWXlOU3d3TEc1MWJHd3NXMXN3TEZzeE1URXNXekVzTVRVc05ETXNabUZzYzJWZExGc3hMREV5TERRekxHWmhiSE5sWFYxZExGc3dMRnN4TVRFc1d6RXNNVFVzTkRRc1ptRnNjMlZkTEZzeExERXlMRFEwTEdaaGJITmxYVjFkWFYwc1d5MHhMREV3T1N4dWRXeHNMRGMxTlRFd016TTVPVGcyT0RZNE1Dd3dMRzUxYkd3c1cxc3dMRnN4TVRJc1d6UXNNVEV5WFYxZFhWMWRYVjFkTEZzd0xEQXNkSEoxWlN4dWRXeHNMRE01T0RNd09EazBPRFkxTWpJMU9DdzBNRFVzVzFzeE1pdzNPQ3h1ZFd4c0xEQXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNOVEUyTXpJMk16a3pNVEk1TnpVNExHNTFiR3dzVzFzNExESmRMRnN3TEZzeVhWMWRYU3hiTVRJc056Z3NiblZzYkN3d0xHWmhiSE5sTEdaaGJITmxMR1poYkhObExERXhPVEUxT0RRMk9USTBNelEwTXl4dWRXeHNMRnRiT0N3MFhTeGJNQ3hiTXpFc1d6UXNNamhkWFYxZFhWMHNXMTBzVzFzd0xEQXNabUZzYzJVc2JuVnNiQ3cwT0RFME1qSTVORGszTlRBd05qY3NOREEyTEZ0YkxURXNNakVzYm5Wc2JDd3dMR1poYkhObExHWmhiSE5sTEdaaGJITmxMRFk0TlRJeE9EUTFOalF3T0RVM01DeHVkV3hzWFYwc1cxc3RNU3czTWl4dWRXeHNMRGs1TkRBd01qa3pPVGcwT1Rjd01pd3lMRzUxYkd3c1cxc3dMRnMyWFYxZFhTeGJMVEVzTlRrc2JuVnNiQ3c1TmpNNE16WTBPRGt5T1RrNE9UVXNNQ3h1ZFd4c0xGdGJNVEVzTmpFMU1ESTNOalV3T0RVNU1qSXdYU3hiTnl4Yk1sMWRYVjBzV3kweExEY3pMRzUxYkd3c05qUTFPRFExTmpnMk1EUXhNRGs1TERBc2JuVnNiRjFkWFYxZExGc3dMREFzWm1Gc2MyVXNiblZzYkN3Mk9EVXdPVGd5TXpVNE9UZ3pOekVzTkRBM0xGdGJMVEVzTXpJc2JuVnNiQ3d3TEdaaGJITmxMR1poYkhObExHWmhiSE5sTERRek1UZzBNREUzTURjeE1EZ3hNQ3h1ZFd4c0xGdGJNVEVzTVRFek5UVTBPRFV3TWpJeU9EVTRYU3hiT0N3d1hTeGJOeXhiTWwxZFhWMHNXeTB4TERNeUxHNTFiR3dzTUN4bVlXeHpaU3htWVd4elpTeG1ZV3h6WlN3MU5Ua3dNRE0yTlRJME5UVTVNRElzYm5Wc2JDeGJXekV4TERnMU16ZzBOelk1TkRZME1ESXlNMTBzV3pnc01GMHNXemNzV3pKZFhWMWRYU3hiWFN4Yld6QXNNQ3gwY25WbExHNTFiR3dzTWpBeU5qVTFOakl5TkRJNE1EYzRMRFF3T0N4Yld6RXpMRGM0TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4bVlXeHpaU3cyTURVeU5Ua3pNakkyT0RRek16UXNiblZzYkN4Yld6Z3NNbDBzV3pBc1d6RXdORjFkWFYwc1d6RXpMRGM0TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4bVlXeHpaU3cxTVRrNU1UZzVNamMyTkRNMU1EQXNiblZzYkN4Yld6Z3NORjBzV3pBc1d6RXhNeXhiTkN3eU9GMWRYVjFkWFN4YlhTeGJXekFzTUN4bVlXeHpaU3h1ZFd4c0xEWTBOelEyTURFM09ERXdOekEwT1N3ME1Ea3NXMXN4TXl3eE1UTXNiblZzYkN3d0xHWmhiSE5sTEhSeWRXVXNabUZzYzJVc056RXlNamt5TnpjeU1UVXpNamc1TEc1MWJHeGRYU3hiV3pFekxESTBMRzUxYkd3c05EWTRPREV5TWpBM016RTBNelEyTERBc2JuVnNiRjFkWFYxZExGc3dMREFzZEhKMVpTeHVkV3hzTERJeU1qSXlPRE01TXpnNU1ERTJNU3cwTVRBc1cxc3lNaXczT0N4dWRXeHNMREFzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzTWpNd05USXhPVEl5T0RNeU56VTBMRzUxYkd3c1cxczRMREpkTEZzd0xGc3hNRFJkWFYxZExGc3lNaXczT0N4dWRXeHNMREFzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzTVRjMU1EY3lNRFkyTXprMk5qZ3dMRzUxYkd3c1cxczRMRFJkTEZzd0xGc3hNVE1zV3pRc01qaGRYVjFkWFYwc1cxMHNXMXN3TERBc1ptRnNjMlVzYm5Wc2JDdzBNakE1TlRRME56WTRNelkyT1Rnc05ERXhMRnRiTVRNc01URXpMRzUxYkd3c01DeG1ZV3h6WlN4MGNuVmxMR1poYkhObExESXhNVFk0TkRFek1qZ3lPRFU0TkN4dWRXeHNYVjBzVzFzeU1pd3lOQ3h1ZFd4c0xESTVNREkyT0RReE5EUTRNRGd4T1N3d0xHNTFiR3hkWFYxZFhTeGJNQ3d3TEhSeWRXVXNiblZzYkN3NE1UVTVOREl6TWpZMU5qWTNOamNzTkRFeUxGdGJNelVzTnpnc2JuVnNiQ3d3TEdaaGJITmxMR1poYkhObExHWmhiSE5sTERFeU16TXhOVGd4Tmpnek1EUTVNaXh1ZFd4c0xGdGJPQ3d5WFN4Yk1DeGJNVEEwWFYxZFhTeGJNelVzTnpnc2JuVnNiQ3d3TEdaaGJITmxMR1poYkhObExHWmhiSE5sTERVM01UVXdOREE0TlRrNE5EY3lNU3h1ZFd4c0xGdGJPQ3cwWFN4Yk1DeGJNVEV6TEZzMExESTRYVjFkWFYxZExGdGRMRnRiTUN3d0xHWmhiSE5sTEc1MWJHd3NORFV5T0RJME9USXhPRGd5TlRZMkxEUXhNeXhiV3pFekxERXhNeXh1ZFd4c0xEQXNabUZzYzJVc2RISjFaU3htWVd4elpTdzJNamt5TURFME5qSTBORFExTWpjc2JuVnNiRjFkTEZ0Yk16VXNNalFzYm5Wc2JDdzJOVEkyTkRFMk5UZ3lNams0T1RFc01DeHVkV3hzWFYxZFhWMHNXekFzTUN4MGNuVmxMRzUxYkd3c016ZzVNVFV5TVRVNE5EUXlOekkyTERReE5DeGJXek0wTERjNExHNTFiR3dzTUN4bVlXeHpaU3htWVd4elpTeG1ZV3h6WlN3M05UTXpPVFUwTURFek9EQXhORFFzYm5Wc2JDeGJXemdzTWwwc1d6QXNXekV3TkYxZFhWMHNXek0wTERjNExHNTFiR3dzTUN4bVlXeHpaU3htWVd4elpTeG1ZV3h6WlN3ME5UZ3dNRGd5TVRFek1qWTFNellzYm5Wc2JDeGJXemdzTkYwc1d6QXNXekV4TXl4Yk5Dd3lPRjFkWFYxZFhTeGJYU3hiV3pBc01DeG1ZV3h6WlN4dWRXeHNMRGc1TnpFNU16a3hOall6TWpjd09TdzBNVFVzVzFzeE15d3hNVE1zYm5Wc2JDd3dMR1poYkhObExIUnlkV1VzWm1Gc2MyVXNPREk1TnpjMk5UazJOelkxTVRNMExHNTFiR3hkWFN4Yld6TTBMREkwTEc1MWJHd3NNelUzT1RNek5qVXlPREl3TURRMUxEQXNiblZzYkYxZFhWMWRYVjBzV3pBc01DeDBjblZsTEc1MWJHd3NNVEl4TnpjNU1qQTJPREl3TVRnMUxEUXhOaXhiV3pNMUxERXdNU3h1ZFd4c0xEQXNabUZzYzJVc1ptRnNjMlVzZEhKMVpTdzNOREU1TmpBeU56UXdOREl6TVRFc2JuVnNiQ3hiV3pRc01USmRYVjBzV3pFeUxERXdNU3h1ZFd4c0xEQXNabUZzYzJVc1ptRnNjMlVzZEhKMVpTdzJOalkyT0RBek5qRXdNall3Tnpjc2JuVnNiQ3hiV3pRc01qSmRYVjBzV3pFeUxERXdNU3h1ZFd4c0xEQXNabUZzYzJVc1ptRnNjMlVzZEhKMVpTdzBOek14TnpNME1ETXlNamN3TVRFc2JuVnNiQ3hiV3pRc01UTmRYVjFkTEZ0ZExGdGJNQ3d3TEdaaGJITmxMRzUxYkd3c01UVTFNVEk1TVRBME1UUTFOak13TERReE55eGJXekV5TERFeE5Dd2lVR2g1YzJsamN5SXNNQ3htWVd4elpTeG1ZV3h6WlN4bVlXeHpaU3cwTlRNd01qVTVOamc1T1RReE1qTXNiblZzYkN4Yld6TXNNRjBzV3pnc05GMHNXekFzV3pjMVhWMWRYU3hiTFRFc016SXNiblZzYkN3d0xHWmhiSE5sTEdaaGJITmxMR1poYkhObExESXhNVEF5TWpZek5qQTROREl3Tnl4dWRXeHNMRnRiTVRFc05qRTFNREkzTmpVd09EVTVNakl3WFN4Yk9Dd3dYU3hiTnl4Yk1sMWRYVjFkTEZ0YkxURXNOVGtzYm5Wc2JDdzJNamszTlRNNU1ERTBNVGsyT1RZc01DeHVkV3hzTEZ0Yk1URXNOakUxTURJM05qVXdPRFU1TWpJd1hTeGJOeXhiTmwxZFhWMWRMRnRiTUN3d0xHWmhiSE5sTEc1MWJHd3NOakl4TVRNMk16RXlOekEzTmpRd0xEUXhPQ3hiV3kweExETXlMRzUxYkd3c01DeG1ZV3h6WlN4bVlXeHpaU3htWVd4elpTdzVNVE0xTVRJeU5UVTFORGd5Tmpnc2JuVnNiQ3hiV3pFeExEUTRPRFU1TmpZeU1qYzVORFl6T0Ywc1d6Z3NNRjBzV3pjc1d6SmRYVjFkWFN4Yld6RXNOallzYm5Wc2JDdzNOVGcyTkRVeU5qa3pNakU1TkRnc01DeHVkV3hzTEZ0Yk1peGJJbUpzYjNkZk1ERWlMR1poYkhObFhWMHNXek1zTUYwc1d6QXNXekpkWFN4Yk1DeGJNbDFkTEZzeExGc3lORjFkWFYxZFhTeGJNQ3d3TEdaaGJITmxMRzUxYkd3c05ESXlOemt3T1RnME9Ua3dORFE0TERReE9TeGJYU3hiV3kweExEY3lMRzUxYkd3c09ESTJPRE15TnpJNU9UY3pPVGcwTERJc2JuVnNiQ3hiV3pBc1d6VTJYVjFkWFN4YkxURXNOVGtzYm5Wc2JDd3lPREExTWpNMU5EazBNVGd4Tmpjc01DeHVkV3hzTEZ0Yk1URXNOakUxTURJM05qVXdPRFU1TWpJd1hTeGJOeXhiTWwxZFhWMWRYVjFkWFYwc1d6QXNNQ3gwY25WbExHNTFiR3dzT0RVd05qVXhORGt6TXpNME5qUXpMRFF5TUN4Yld6TTFMREV3TVN4dWRXeHNMREFzWm1Gc2MyVXNabUZzYzJVc2RISjFaU3cxTXpVNU1qTXlOelF3TnpVeU5Ea3NiblZzYkN4Yld6UXNNVEpkWFYwc1d6RXlMREV3TVN4dWRXeHNMREFzWm1Gc2MyVXNabUZzYzJVc2RISjFaU3d5T0RNd056WXpNemczTmpJeU9USXNiblZzYkN4Yld6UXNNakpkWFYwc1d6RXlMREV3TVN4dWRXeHNMREFzWm1Gc2MyVXNabUZzYzJVc2RISjFaU3d5TURBeE9ESXdOVGsxTXpJM05qZ3NiblZzYkN4Yld6UXNNVE5kWFYxZExGdGRMRnRiTUN3d0xHWmhiSE5sTEc1MWJHd3NNalUxTkRnMk9Ea3lNVFEyT1RReUxEUXlNU3hiV3pFeUxERXhOQ3dpVUdoNWMybGpjeUlzTUN4bVlXeHpaU3htWVd4elpTeG1ZV3h6WlN3Mk9EZ3pOREUxTlRReE16TXpORGdzYm5Wc2JDeGJXek1zTUYwc1d6Z3NNbDBzV3pBc1d6WTNYVjFkWFN4YkxURXNNeklzYm5Wc2JDd3dMR1poYkhObExHWmhiSE5sTEdaaGJITmxMRE01TVRNek1qWTBPREl6TlRFM09DeHVkV3hzTEZ0Yk1URXNOakUxTURJM05qVXdPRFU1TWpJd1hTeGJPQ3d3WFN4Yk55eGJNbDFkWFYxZExGdGJMVEVzTlRrc2JuVnNiQ3c1T0RrME1qWTROREEwTVRNMU1qY3NNQ3h1ZFd4c0xGdGJNVEVzTmpFMU1ESTNOalV3T0RVNU1qSXdYU3hiTnl4Yk5sMWRYVjFkTEZ0Yk1Dd3dMR1poYkhObExHNTFiR3dzTkRVeE5ERTROalEzTlRRMk9Ua3pMRFF5TWl4Yld5MHhMRE15TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4bVlXeHpaU3cxTkRFMU5UYzRNemMwTWprMU5qRXNiblZzYkN4Yld6RXhMRFE0T0RVNU5qWXlNamM1TkRZek9GMHNXemdzTUYwc1d6Y3NXekpkWFYxZFhTeGJXekVzTmpZc2JuVnNiQ3cyTmpJek9UWXpNVEUyTWpJd05qWXNNQ3h1ZFd4c0xGdGJNaXhiSW1Kc2IzZGZNREVpTEdaaGJITmxYVjBzV3pNc01GMHNXekFzV3pKZFhTeGJNQ3hiTWwxZExGc3hMRnN5TkYxZFhWMWRYU3hiTUN3d0xHWmhiSE5sTEc1MWJHd3NOams1TmpJM056RTVNRFl5T0RBMkxEUXlNeXhiWFN4Yld5MHhMRGN5TEc1MWJHd3NNalF6TVRJeU16YzFPRGswTURRekxESXNiblZzYkN4Yld6QXNXelUyWFYxZFhTeGJMVEVzTlRrc2JuVnNiQ3d6TnpFME1UTTROak15TWpZek16UXNNQ3h1ZFd4c0xGdGJNVEVzTmpFMU1ESTNOalV3T0RVNU1qSXdYU3hiTnl4Yk1sMWRYVjFkWFYxZFhWMWRYU3hiTUN3d0xHWmhiSE5sTEc1MWJHd3NNVFU0TURrek56WTFOalkyTWpFMkxEUXlOQ3hiV3kweExERXhOU3h1ZFd4c0xEQXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNNalkwTVRjM056azJPVGMwTlRFekxHNTFiR3dzVzFzMUxGc3hYVjFkWFYwc1cxMHNXMXN3TERBc1ptRnNjMlVzYm5Wc2JDd3lNalE0TnpBd01ETTBNek0xTWpNc05ESTFMRnRiTFRFc016SXNiblZzYkN3d0xHWmhiSE5sTEdaaGJITmxMR1poYkhObExEUTFPREl5TnpVd05qQXdOemM1TlN4dWRXeHNMRnRiTVRFc09EVXpPRFEzTmprME5qUXdNakl6WFN4Yk9Dd3dYU3hiTnl4Yk5sMWRYVjBzV3kweExETXlMRzUxYkd3c01DeG1ZV3h6WlN4bVlXeHpaU3htWVd4elpTdzVPVEUyT0RJMk56UTNNalF5TURNc2JuVnNiQ3hiV3pFeExERXlNREkwTVRVM056TTBPVFEyTWwwc1d6Z3NNRjBzV3pjc1d6WmRYVjFkTEZzdE1Td3pNaXh1ZFd4c0xEQXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNORGt4TURBME5qZ3hPVGM0TlRZNUxHNTFiR3dzVzFzeE1Td3hOekl5TkRFeU5EQTNNekV4TmpaZExGczRMREJkTEZzM0xGc3hOVjFkWFYxZExGdGRMRnRiTUN3d0xHWmhiSE5sTEc1MWJHd3NOREU0TnprME5UZ3pNVGc0TlRVNExEUXlOaXhiV3kweExESXhMRzUxYkd3c01DeG1ZV3h6WlN4bVlXeHpaU3htWVd4elpTd3hOemd3TXpJM016RXlNRGczTWpFc2JuVnNiRjFkTEZ0YkxURXNNVEE0TEc1MWJHd3NNekV6T1RFd05qY3pPRGcyTkRNd0xEQXNiblZzYkN4Yld6RXhMRGN6TVRrMk16UXhNekF3TmpJeU1WMHNXemNzV3paZFhWMWRMRnN6TERFeE5peHVkV3hzTERrNU1ERTJNalUwTlRReU1qazNPQ3d3TEc1MWJHd3NXMXN3TEZzME15eGJNeXczTXpFNU5qTTBNVE13TURZeU1qRmRYVjFkWFN4Yk15d3hNVGNzYm5Wc2JDdzNPRE13T1RjeU5Ua3dORGs0T0Rjc01TeHVkV3hzTEZ0Yk1UWXNabUZzYzJWZFhWMWRYVjFkWFYwc1d6UXNXeUp1WlhkbllXMWxJaXd3TEZ0ZExIUnlkV1VzWm1Gc2MyVXNabUZzYzJWZExHWmhiSE5sTEc1MWJHd3NOek00TWpjNE9EWTRNekl3TXprd0xEUXlOeXhiWFN4Yld6RXNNVEU0TEc1MWJHd3NPRGN3TWpnNE1UQTNPVFl5Tmpnd0xEQXNiblZzYkYwc1d5MHhMRFU1TEc1MWJHd3NPRE00T0RVNE56TXpPVGN3TnpJMkxEQXNiblZzYkN4Yld6RXhMRGcxTXpnME56WTVORFkwTURJeU0xMHNXemNzV3pKZFhWMWRMRnN0TVN3MU9TeHVkV3hzTERJNE9UZ3hNek15TXpBM01ESTVNeXd3TEc1MWJHd3NXMXN4TVN3eE56SXlOREV5TkRBM016RXhOalpkTEZzM0xGc3lYVjFkWFN4YkxURXNOVGtzYm5Wc2JDdzBOVEkwTVRrNE5qUXdPRGt5T1RRc01DeHVkV3hzTEZ0Yk1URXNOelk0TXpFeU1qRTJOamcyTXpneFhTeGJOeXhiTWwxZFhWMHNXeTB4TERVNUxHNTFiR3dzTlRNM01UTTRNamt4TURFd01qQXlMREFzYm5Wc2JDeGJXekV4TERReE9Ea3dPVFE1TXpFd05UYzJPVjBzV3pjc1d6SmRYVjFkTEZzdE1Td3hNRFlzYm5Wc2JDdzJOekV5TXpBMU9EUTFPVGcxT1RNc01DeHVkV3hzTEZ0Yk1DeGJObDFkWFYwc1d5MHhMREV3T1N4dWRXeHNMRE0xT0RnMU1qZ3lNREV3TURjME15d3dMRzUxYkd3c1cxc3dMRnMyWFYxZFhTeGJMVEVzTlRrc2JuVnNiQ3c0TVRJMk9EYzFNalk1TURFek9ETXNNQ3h1ZFd4c0xGdGJNVEVzTnpVM05UZzRNREl4TURjNE1UUXpYU3hiTnl4Yk1sMWRYVjBzV3kweExEVTVMRzUxYkd3c05ERXhOakV5TkRrNU9UTTNOVEl3TERBc2JuVnNiQ3hiV3pFeExERXhNelUxTkRnMU1ESXlNamcxT0Ywc1d6Y3NXekpkWFYxZExGc3RNU3cxT1N4dWRXeHNMRFkxT0RJeU56WTNNREk1T0RVNE9Dd3dMRzUxYkd3c1cxc3hNU3cyTVRVd01qYzJOVEE0TlRreU1qQmRMRnMzTEZzeVhWMWRYU3hiTFRFc056TXNiblZzYkN3ME1qYzROakl4TnpJeE16RXpOVGdzTUN4dWRXeHNYVjFkWFYwc1d5SkZWa1ZPVkNCdFpXNTFJaXhiV3pJc0lrVldSVTVVSUhkcGJtUnZkekVpTEdaaGJITmxYU3hiTVN3aVoyRnRaU0lzTUN3d0xHWmhiSE5sTEdaaGJITmxMREk0TWpjME56QXdNVEV6TWpNM055eG1ZV3h6WlN3Mk0xMHNXekVzSW0xaGFXNXRaVzUxSWl3d0xEQXNabUZzYzJVc1ptRnNjMlVzTVRJME5UQTNOVFV6T0RBMk56WXdMR1poYkhObExEWTBYU3hiTVN3aWMyTnZjbVZpYkhWbElpd3dMREFzWm1Gc2MyVXNabUZzYzJVc01UY3lNalF4TWpRd056TXhNVFkyTEdaaGJITmxMRFkxWFN4Yk1Td2ljMk52Y21WeVpXUWlMREFzTUN4bVlXeHpaU3htWVd4elpTdzNOamd6TVRJeU1UWTJPRFl6T0RFc1ptRnNjMlVzTmpaZExGc3hMQ0p5WVc1a2IyMWlZV3hzSWl3d0xEQXNabUZzYzJVc1ptRnNjMlVzTnpNMU56YzROak16TkRrME9EWXpMR1poYkhObExEWTNYU3hiTVN3aWNtRnVaRzl0WTJWMFkyRWlMREFzTUN4bVlXeHpaU3htWVd4elpTd3pOelUyTXpnMU5qY3dOemd4TURnc1ptRnNjMlVzTmpoZExGc3hMQ0p5WVc1a2IyMXVjR01pTERBc01DeG1ZV3h6WlN4bVlXeHpaU3c0TnpRNU1qVTNNVE00TVRRd056WXNabUZzYzJVc05qbGRMRnN4TENKeVlXNWtiMjFpWVdOclozSnZkVzVrSWl3d0xEQXNabUZzYzJVc1ptRnNjMlVzTmpjM09ETXlOakE1TXpRek1UZ3hMR1poYkhObExEY3dYU3hiTVN3aWMyTnliMnhzSWl3d0xEQXNabUZzYzJVc1ptRnNjMlVzTnpVM05UZzRNREl4TURjNE1UUXpMR1poYkhObExEY3hYU3hiTVN3aWMzUmhjblF4SWl3d0xEQXNabUZzYzJVc1ptRnNjMlVzTkRFNE9UQTVORGt6TVRBMU56WTVMR1poYkhObExEY3lYU3hiTVN3aWQybHVJaXd3TERBc1ptRnNjMlVzWm1Gc2MyVXNPRFV6T0RRM05qazBOalF3TWpJekxHWmhiSE5sTERjelhTeGJNU3dpWjJGc0lpd3dMREFzWm1Gc2MyVXNabUZzYzJVc01URXpOVFUwT0RVd01qSXlPRFU0TEdaaGJITmxMRGMwWFN4Yk1Td2ljbUZ1Wkc5dFltRnNiSFpwY3lJc01Dd3dMR1poYkhObExHWmhiSE5sTERVMk1USTFNRGMwTURZd05qazVOU3htWVd4elpTdzNOVjBzV3pFc0luTmxkSFJ2ZFdOb0lpd3dMREFzWm1Gc2MyVXNabUZzYzJVc05UZ3pOVE0zTnpZNU5UUTVNVGN5TEdaaGJITmxMRGMyWFN4Yk1Td2lkMmwwYUhCaklpd3dMREFzWm1Gc2MyVXNabUZzYzJVc01USXdNalF4TlRjM016UTVORFl5TEdaaGJITmxMRGMzWFN4Yk1Td2lZbVZvWVhacGIzSWlMREFzTUN4bVlXeHpaU3htWVd4elpTd3pPVE01Tnprd05UTTNPRGM1TlRNc1ptRnNjMlVzTnpoZExGc3hMQ0ppWldoaGRtbHZjaklpTERBc01DeG1ZV3h6WlN4bVlXeHpaU3czTVRVMk9ETTBOVGt3TlRVd05EVXNabUZzYzJVc056bGRMRnN4TENKemIzVnVaRzFoYVc0aUxEQXNNQ3htWVd4elpTeG1ZV3h6WlN3ME9EZzFPVFkyTWpJM09UUTJNemdzWm1Gc2MyVXNPREJkTEZzeExDSnlZVzVrYjIxb1pXRmtJaXd3TERBc1ptRnNjMlVzWm1Gc2MyVXNORFEzTWprNU1UTTJORFkwTURFNExHWmhiSE5sTERneFhTeGJNU3dpY21GdVpHOXRkMmx1WkNJc01Dd3dMR1poYkhObExHWmhiSE5sTERJNE5Ea3lOemswTmpNeU16QTVOU3htWVd4elpTdzRNbDBzV3pFc0ltWnBjbk4wZEdsdFpTSXNNQ3d3TEdaaGJITmxMR1poYkhObExEZzJPRFExTmpZNE5UYzNNemd3TXl4bVlXeHpaU3c0TTEwc1d6RXNJbXhoYm1kMVlXZGxNaUlzTUN3d0xHWmhiSE5sTEdaaGJITmxMRFExTVRNMk9EWTRNemswTmpZME9DeG1ZV3h6WlN3NE5GMHNXekVzSWtGRVV5SXNNQ3d0TVN4bVlXeHpaU3htWVd4elpTdzBOalkwTkRVeE5URTVPVGN4TVRFc1ptRnNjMlVzT0RWZExGc3hMQ0p0YjJKcGJHVWlMREFzTUN4bVlXeHpaU3htWVd4elpTd3lPRFF5TWpJek9URXdORGMzT0RJc1ptRnNjMlVzT0RaZExGc3dMREFzWm1Gc2MyVXNiblZzYkN3eE56WTBNems1TlRJMU5UQXlNekVzTVN4Yld5MHhMRE15TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4bVlXeHpaU3cwTXpjMk1qRTNNalU1T0RZd01ERXNiblZzYkN4Yld6RXhMRGcyT0RRMU5qWTROVGMzTXpnd00xMHNXemdzTUYwc1d6Y3NXekpkWFYxZFhTeGJYU3hiV3pBc01DeG1ZV3h6WlN4dWRXeHNMRGt4TkRVMU5qUTJNRFl6TURJeU15d3lMRnRiTFRFc05qRXNiblZzYkN3d0xHWmhiSE5sTEdaaGJITmxMR1poYkhObExEVTBOVFV6TWpRMU9EZ3lOakU0T0N4dWRXeHNMRnRiTnl4Yk1URTBMRnMwTERFeE9WMHNXekVzTWl3eE1qQXNkSEoxWlYwc1d6UXNNVEU1WFN4Yk1Td3lMREV5TUN4MGNuVmxYU3hiTkN3eE1UbGRMRnN4TERJc01USXdMSFJ5ZFdWZExGczBMREV4T1Ywc1d6RXNNaXd4TWpBc2RISjFaVjFkWFN4Yk9Dd3dYU3hiTnl4Yk5sMWRYVjFkTEZ0YkxURXNOVGtzYm5Wc2JDd3pPVFV4TlRBeE5UUTVNamMzTlRNc01DeHVkV3hzTEZ0Yk1URXNORFV4TXpZNE5qZ3pPVFEyTmpRNFhTeGJOeXhiTmwxZFhWMWRYU3hiTUN3d0xHWmhiSE5sTEc1MWJHd3NOVFF6TURjMk9EVXpNRFV6TlRBM0xETXNXMXN0TVN3Mk1TeHVkV3hzTERBc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc056VTFNak01TXpFek9EUXpNekV6TEc1MWJHd3NXMXMzTEZzeE1UVXNXelFzTVRFNVhTeGJNU3d5TERFeU1DeDBjblZsWFN4Yk5Dd3hNVGxkTEZzeExESXNNVEl3TEhSeWRXVmRMRnMwTERFeE9WMHNXekVzTWl3eE1qQXNkSEoxWlYwc1d6UXNNVEU1WFN4Yk1Td3lMREV5TUN4MGNuVmxYVjFkTEZzNExEQmRMRnMzTEZzMlhWMWRYVjBzVzFzdE1TdzFPU3h1ZFd4c0xESTJOalkyTnpneU1qZ3dOVGs0T1N3d0xHNTFiR3dzVzFzeE1TdzBOVEV6TmpnMk9ETTVORFkyTkRoZExGczNMRnN5WFYxZFhWMWRMRnN3TERBc1ptRnNjMlVzYm5Wc2JDd3lPVGN3TURRM05qSXlNemd4TVRJc05DeGJXelVzTVRJeExHNTFiR3dzTUN4bVlXeHpaU3htWVd4elpTeG1ZV3h6WlN3Mk16UTJORFF4TkRVNU9EUTJPRFFzYm5Wc2JGMWRMRnRiTFRFc05Ua3NiblZzYkN3ek9EYzNOVGs1T0RVek5Ua3pORGdzTUN4dWRXeHNMRnRiTVRFc01qZzBNakl5TXpreE1EUTNOemd5WFN4Yk55eGJObDFkWFYxZFhTeGJNQ3d3TEdaaGJITmxMRzUxYkd3c05UYzBPVFU1TlRjMU5UYzNNakUzTERVc1cxMHNXMXN0TWl3aWMyVnNaV04wYkdGdVozVmhaMlVpTEc1MWJHd3NOemsyT0RNMk5qTTNNVFl6TURjNUxEQXNiblZzYkYwc1d6TXNPRFFzYm5Wc2JDdzJNalU0TkRRNU5qWTVOVFUwTVRJc01TeHVkV3hzWFN4YkxURXNOVGtzYm5Wc2JDdzJPRFUwTURBME9Ea3hNalExTURBc01DeHVkV3hzTEZ0Yk1URXNPRFk0TkRVMk5qZzFOemN6T0RBelhTeGJOeXhiTmwxZFhWMWRYVjFkTEZzeExDSnpZMjl5WlNJc01Dd3dMR1poYkhObExHWmhiSE5sTERjek1UazJNelF4TXpBd05qSXlNU3htWVd4elpTdzROMTBzV3pFc0lteHZZV1FpTERBc01DeG1ZV3h6WlN4bVlXeHpaU3cwT0RNM05Ua3pORGsxTlRNd05qQXNabUZzYzJVc09EaGRMRnN3TERBc1ptRnNjMlVzYm5Wc2JDdzFPVGMzT0RJM01UYzFORFE1T1RBc05peGJXeTB4TERRd0xHNTFiR3dzTVN4bVlXeHpaU3htWVd4elpTeG1ZV3h6WlN3eU5EVXpOekU0TkRJMk5qUTBNRGNzYm5Wc2JGMWRMRnRiTWpVc01qTXNiblZzYkN3M05qYzNOemM1TnpNeE5EVXpORFVzTUN4dWRXeHNMRnRiTXl3d1hTeGJNU3hiTTExZFhWMHNXekUwTERJekxHNTFiR3dzTWpreU5qazBPVFU0TnpJM01qa3dMREFzYm5Wc2JDeGJXek1zTUYwc1d6RXNXek5kWFYxZExGc3RNaXdpYzJWc1pXTjBiR0Z1WjNWaFoyVWlMRzUxYkd3c01qVTBNVEE1TWpRME9UQXlOVFF5TERBc2JuVnNiRjFkTEZ0Yk1Dd3dMR1poYkhObExHNTFiR3dzTXpJMk1UZ3pNRGc0TVRJNU5UYzJMRGNzVzFzdE1Td3pNaXh1ZFd4c0xEQXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNOVFEzTnprM09EazBORE0zTXpRekxHNTFiR3dzVzFzeE1TdzBOalkwTkRVeE5URTVPVGN4TVRGZExGczRMREJkTEZzM0xGczNORjFkWFYxZExGdGJMVEVzTlRrc2JuVnNiQ3cxTnpZNE5qWXpNakV5TmpJM01UUXNNQ3h1ZFd4c0xGdGJNVEVzTkRZMk5EUTFNVFV4T1RrM01URXhYU3hiTnl4Yk1URTJMRnN4TERNc01USXlMR1poYkhObFhWMWRYVjFkWFN4Yk1Dd3dMR1poYkhObExHNTFiR3dzTlRRMU5qZzJNVFU0TnpZeU56WXhMRGdzVzFzdE1Td3pNaXh1ZFd4c0xEQXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNNamt6TURZMU5qSTNPVGN3TnpNekxHNTFiR3dzVzFzeE1TdzBPRGcxT1RZMk1qSTNPVFEyTXpoZExGczRMREJkTEZzM0xGc3lYVjFkWFYwc1cxc3hMRFkyTEc1MWJHd3NNVEk0TnpRd056Z3hOemczTmpFNExEQXNiblZzYkN4Yld6SXNXeUp6Y0c5eWRITWdLR1p2Y2lCemFXMTFiR0YwYjNKektTSXNabUZzYzJWZFhTeGJNeXd4WFN4Yk1DeGJNVEUzWFYwc1d6QXNXekpkWFN4Yk1TeGJNVEU0WFYxZFhWMWRMRnN3TERBc1ptRnNjMlVzYm5Wc2JDdzBOelkyTnpJeE56YzRNVEF4TXpZc09TeGJXeTB4TERNeUxHNTFiR3dzTUN4bVlXeHpaU3htWVd4elpTeG1ZV3h6WlN3ME1qWXpOVFExTWpFd05ESXpNeklzYm5Wc2JDeGJXekV4TERRNE16YzFPVE0wT1RVMU16QTJNRjBzV3pnc01GMHNXemNzV3pKZFhWMWRYU3hiV3kweExEVTVMRzUxYkd3c09ETXhNVGd4Tmpjek9UZ3hNVEUzTERBc2JuVnNiQ3hiV3pFeExEY3pNVGsyTXpReE16QXdOakl5TVYwc1d6Y3NXekV4T1N4Yk1Td3pMREV5TXl4bVlXeHpaVjFkWFYxZExGczJMRGs1TEc1MWJHd3NNakkwTXpRNE16WXlOVFkxTURJNUxEQXNiblZzYkN4Yld6Y3NXelF6TEZzekxEY3pNVGsyTXpReE16QXdOakl5TVYxZFhWMWRMRnN0TVN3MU9TeHVkV3hzTERJek56RXpOalUzTXpVeU16VTBOQ3d3TEc1MWJHd3NXMXN4TVN3ME9ETTNOVGt6TkRrMU5UTXdOakJkTEZzM0xGczJYVjFkWFYxZExGc3dMREFzWm1Gc2MyVXNiblZzYkN3eE5UTTVNall6TlRrMk9USXlOemtzTVRBc1cxMHNXMXMyTERrNUxHNTFiR3dzTXpNM056WTBPVE0wTWpjM09UVTRMREFzYm5Wc2JDeGJXemNzV3pRekxGc3pMRGN6TVRrMk16UXhNekF3TmpJeU1WMWRYVjFkWFYxZFhTeGJNQ3d3TEdaaGJITmxMRzUxYkd3c09UTTRPREEzTkRFMk5UVTFOakl4TERFeExGdGJOeXc0TUN4dWRXeHNMREVzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzTnpRNE16Y3lNakF5T0RNeU9UVTVMRzUxYkd4ZFhTeGJYU3hiV3pBc01DeG1ZV3h6WlN4dWRXeHNMRFl6TWpZNU5UYzBORGszT0RRMU9Td3hNaXhiV3pjc09ERXNiblZzYkN3d0xHWmhiSE5sTEdaaGJITmxMR1poYkhObExEVTRNRGcyTXpBd016azVPREE0TkN4dWRXeHNMRnRiTkN3eE5GMWRYVjBzVzEwc1cxc3dMREFzWm1Gc2MyVXNiblZzYkN3NE9UTTVPVFE1T1RVd09Ea3dOallzTVRNc1cxc3hOQ3c0TWl4dWRXeHNMREFzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzTVRreE5UQXlOemc0TnpVME56ZzFMRzUxYkd3c1cxczRMREJkTEZzd0xGc3hNVjFkWFYxZExGdGJNVFFzTWpNc2JuVnNiQ3d4TkRBd05UUXpOems1TWpJNU56Y3NNQ3h1ZFd4c0xGdGJNeXd4WFN4Yk1TeGJNMTFkWFYxZFhTeGJNQ3d3TEdaaGJITmxMRzUxYkd3c016UTJPRFV4TkRJeE1qTXlOekl5TERFMExGdGJNVFFzT0RJc2JuVnNiQ3d3TEdaaGJITmxMR1poYkhObExHWmhiSE5sTERjM056RTBNVEl5T0RReU1qQTFOaXh1ZFd4c0xGdGJPQ3d3WFN4Yk1DeGJPVjFkWFYxZExGdGJNVFFzTWpNc2JuVnNiQ3d5TkRBek1Ea3pNalkxTWpneU5UUXNNQ3h1ZFd4c0xGdGJNeXd4WFN4Yk1TeGJNMTFkWFYxZFhTeGJNQ3d3TEdaaGJITmxMRzUxYkd3c01UYzFOekEyTVRJd09EQTFORE13TERFMUxGdGJNVFFzT0RJc2JuVnNiQ3d3TEdaaGJITmxMR1poYkhObExHWmhiSE5sTERZNE1EQXhNelU0TVRBeE1EWXlNQ3h1ZFd4c0xGdGJPQ3d3WFN4Yk1DeGJNVFZkWFYxZFhTeGJXekUwTERJekxHNTFiR3dzT1RrMk16WTRNakUyTmpVME1qUTBMREFzYm5Wc2JDeGJXek1zTVYwc1d6RXNXek5kWFYxZFhWMHNXekFzTUN4bVlXeHpaU3h1ZFd4c0xEVTVPREU1T1RJMU9UWTNOek13TVN3eE5peGJXekUwTERneUxHNTFiR3dzTUN4bVlXeHpaU3htWVd4elpTeG1ZV3h6WlN3M05EUXhNREkzTkRRME5UZzVPVFVzYm5Wc2JDeGJXemdzTUYwc1d6QXNXek0wWFYxZFhWMHNXMXN4TkN3eU15eHVkV3hzTERjNE16RTVOVFV3TmpJMU1EQXpOaXd3TEc1MWJHd3NXMXN6TERGZExGc3hMRnN6WFYxZFhWMWRYVjBzV3pBc01DeG1ZV3h6WlN4dWRXeHNMRE15T0RZek9UWXpORFF5TVRZMU5Td3hOeXhiV3pjc09ERXNiblZzYkN3d0xHWmhiSE5sTEdaaGJITmxMR1poYkhObExETTBORFV5TXpjNE5ERTRPVGt5T1N4dWRXeHNMRnRiTkN3eU5WMWRYVjBzVzEwc1cxc3dMREFzWm1Gc2MyVXNiblZzYkN3NE5qRXdOall3TXpRek9EazBNRGNzTVRnc1cxc3lOU3d6TXl4dWRXeHNMREFzWm1Gc2MyVXNabUZzYzJVc2RISjFaU3cyT0RVNE5ERXhNREEyT0RReE9UWXNiblZzYkN4Yld6QXNXekV5TUYxZFhWMWRMRnRiTWpVc01qTXNiblZzYkN3NE5EUTBOVFUwTkRNNU1EYzBORElzTUN4dWRXeHNMRnRiTXl3eFhTeGJNU3hiTTExZFhWMWRYU3hiTUN3d0xHWmhiSE5sTEc1MWJHd3NOalEzTXpjd01UazBNek16T1RJd0xERTVMRnRiTWpVc016TXNiblZzYkN3d0xHWmhiSE5sTEdaaGJITmxMSFJ5ZFdVc05UVTVOamt5TXpJNU56YzRNVGN5TEc1MWJHd3NXMXN3TEZzeE1qRmRYVjFkWFN4Yld6STFMREl6TEc1MWJHd3NOVGMwTXpZNU5EZzJOVGsxTWpBekxEQXNiblZzYkN4Yld6TXNNVjBzV3pFc1d6TmRYVjFkWFYxZFhWMWRMRnN3TERBc1ptRnNjMlVzYm5Wc2JDdzVOams1TXpBM05UQTRPVFF6TlRrc01qQXNXMXMzTERnekxHNTFiR3dzTVN4bVlXeHpaU3htWVd4elpTeG1ZV3h6WlN3ek16SXlPRFF4TnpreE56azVNamtzYm5Wc2JGMWRMRnRkTEZ0Yk1Dd3dMR1poYkhObExHNTFiR3dzTnpReU56VXlORGMwTVRRNE5UWTJMREl4TEZ0Yk55dzRNU3h1ZFd4c0xEQXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNOVFF4TnpNek1EVXlOekF3TmpreUxHNTFiR3dzVzFzMExERTBYVjFkWFN4YlhTeGJXekFzTUN4bVlXeHpaU3h1ZFd4c0xEWXlNRE0yTnpFNE1qTTVOems0T1N3eU1peGJXekUwTERneUxHNTFiR3dzTUN4bVlXeHpaU3htWVd4elpTeG1ZV3h6WlN3M05qazVOak16T1Rnek1USTFNamdzYm5Wc2JDeGJXemdzTUYwc1d6QXNXekV4WFYxZFhWMHNXMXN4TERFeU5DeHVkV3hzTERNNE56Z3hNak00TXpFeU5URXdNQ3d3TEc1MWJHd3NXMXN6TERCZFhWMHNXekVzT0RZc2JuVnNiQ3c1TkRFek9USTVNemc0TmpNNU1EQXNNQ3h1ZFd4c0xGdGJNU3hiTVRFNFhWMWRYU3hiTFRFc056SXNiblZzYkN3M05qSXlOalE1TkRBNU1UUTBOalVzTWl4dWRXeHNMRnRiTUN4Yk5UWmRYVjFkTEZzdE1TdzFPU3h1ZFd4c0xEUXlOak0zT1RVME5ETXdOamd6Tml3d0xHNTFiR3dzVzFzeE1TdzBPRGcxT1RZMk1qSTNPVFEyTXpoZExGczNMRnMyWFYxZFhWMWRMRnN3TERBc1ptRnNjMlVzYm5Wc2JDdzNPREkwTVRBNE56YzROVGt4TlRrc01qTXNXMXN4TkN3NE1peHVkV3hzTERBc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc09UVTBPRGM1TmpjNE1EQTRNVGd3TEc1MWJHd3NXMXM0TERCZExGc3dMRnM1WFYxZFhWMHNXMXN4TERFeU5DeHVkV3hzTERZMU1UY3lNVE0xTXpRNE9ETXhOQ3d3TEc1MWJHd3NXMXN6TERGZFhWMHNXekVzTmpZc2JuVnNiQ3d4TXpRek16Y3lPRFkyTURneU1qa3NNQ3h1ZFd4c0xGdGJNaXhiSW5Od2IzSjBjeUFvWm05eUlITnBiWFZzWVhSdmNuTXBJaXhtWVd4elpWMWRMRnN6TERGZExGc3dMRnN4TVRkZFhTeGJNQ3hiTWwxZExGc3hMRnN4TVRoZFhWMWRMRnN0TVN3M01peHVkV3hzTERJek9EVXlNelEyTmpFeU1UazJNaXd5TEc1MWJHd3NXMXN3TEZzMU5sMWRYVjBzV3kweExEVTVMRzUxYkd3c016VXdOVFkyTkRJMk16WTFORGswTERBc2JuVnNiQ3hiV3pFeExEUTRPRFU1TmpZeU1qYzVORFl6T0Ywc1d6Y3NXekpkWFYxZFhWMHNXekFzTUN4bVlXeHpaU3h1ZFd4c0xEZzVORFU1TnpJd056azVNRE0wTlN3eU5DeGJXekUwTERneUxHNTFiR3dzTUN4bVlXeHpaU3htWVd4elpTeG1ZV3h6WlN3MU1UTXlPREl4TXpVek9UQTFPREVzYm5Wc2JDeGJXemdzTUYwc1d6QXNXekUxWFYxZFhWMHNXMXN0TVN3M01peHVkV3hzTERFeU9UVTBNakV3TXprMk9URXlOaXd5TEc1MWJHd3NXMXN3TEZzMU5sMWRYVjBzV3kweExEVTVMRzUxYkd3c09Ea3hNVE0yTURNMU1qSTRNREUwTERBc2JuVnNiQ3hiV3pFeExEUTFNVE0yT0RZNE16azBOalkwT0Ywc1d6Y3NXekpkWFYxZExGc3RNaXdpYzJWc1pXTjBiR0Z1WjNWaFoyVWlMRzUxYkd3c05qUTVOakV4TkRNeU1EQTJORE0yTERBc2JuVnNiRjFkWFN4Yk1Dd3dMR1poYkhObExHNTFiR3dzTmpJd05qTTROekkxTWpnd016WXhMREkxTEZ0Yk1UUXNPRElzYm5Wc2JDd3dMR1poYkhObExHWmhiSE5sTEdaaGJITmxMRE00TXpBNU16VTFNamN6TkRrNE1peHVkV3hzTEZ0Yk9Dd3dYU3hiTUN4Yk16UmRYVjFkWFN4Yld5MHhMRGN5TEc1MWJHd3NOVFU1TXprd05UQXpNRGM0TmprM0xESXNiblZzYkN4Yld6QXNXelUyWFYxZFhTeGJMVEVzTlRrc2JuVnNiQ3d5T0Rjek16RXdNREl5TURrek9EWXNNQ3h1ZFd4c0xGdGJNVEVzTkRVeE16WTROamd6T1RRMk5qUTRYU3hiTnl4Yk5sMWRYVjBzV3kweUxDSnpaV3hsWTNSc1lXNW5kV0ZuWlNJc2JuVnNiQ3c1T1RZMU1qSTJOek00TURjME1EUXNNQ3h1ZFd4c1hWMWRYVjBzV3pBc01DeG1ZV3h6WlN4dWRXeHNMRGt5TVRZM016SXlOVFV5TXpNeU5Td3lOaXhiV3pjc09ERXNiblZzYkN3d0xHWmhiSE5sTEdaaGJITmxMR1poYkhObExESXlOakF5TURReU1ESXpOREU0TlN4dWRXeHNMRnRiTkN3eU5WMWRYVjBzVzEwc1cxc3dMREFzWm1Gc2MyVXNiblZzYkN3eE1qVTROekUwTlRZNE5qazBNRGtzTWpjc1cxc3lOU3d6TXl4dWRXeHNMREFzWm1Gc2MyVXNabUZzYzJVc2RISjFaU3c0TURnME56WXhPVEkwTURjeE1ESXNiblZzYkN4Yld6QXNXekV5TUYxZFhWMWRMRnRiTWpVc01qTXNiblZzYkN3MU56Y3lOVGcxTURNeU16Y3lPRGtzTUN4dWRXeHNMRnRiTXl3d1hTeGJNU3hiTTExZFhWMHNXeTB4TERjeUxHNTFiR3dzTkRjMk5UTXpNek13TVRZM05ETXdMRElzYm5Wc2JDeGJXekFzV3pVMlhWMWRYU3hiTVN3NE5peHVkV3hzTERVMk56QTVNamswTkRRM05UQTBPQ3d3TEc1MWJHd3NXMXN4TEZzeE1UaGRYVjFkTEZzdE1TdzFPU3h1ZFd4c0xEWXdNell3TXpFNU5qSTROalV3TXl3d0xHNTFiR3dzVzFzeE1Td3hNakF5TkRFMU56Y3pORGswTmpKZExGczNMRnN5WFYxZFhTeGJMVEVzT0RVc2JuVnNiQ3c0TmpRM05qZzBOVFUzTURVeU9ERXNNQ3h1ZFd4c0xGdGJOaXdpWjJGdFpTSmRYVjFkWFN4Yk1Dd3dMR1poYkhObExHNTFiR3dzTnpBM05EazRNakF4TWpBNE5ETTRMREk0TEZ0Yk1qVXNNek1zYm5Wc2JDd3dMR1poYkhObExHWmhiSE5sTEhSeWRXVXNPVFk0TlRBM01EY3dNVFU0TXpNekxHNTFiR3dzVzFzd0xGc3hNakZkWFYxZFhTeGJXekkxTERJekxHNTFiR3dzTnpZek5qUXpOak16TURVd016VTJMREFzYm5Wc2JDeGJXek1zTUYwc1d6RXNXek5kWFYxZExGc3RNU3czTWl4dWRXeHNMRFV3TlRrd05UVTVOak0wTVRVME5Td3lMRzUxYkd3c1cxc3dMRnMxTmwxZFhWMHNXekVzT0RZc2JuVnNiQ3d5T1RNek1UTTRNakEzTXpnNU1USXNNQ3h1ZFd4c0xGdGJNU3hiTVRFNFhWMWRYU3hiTFRFc05Ua3NiblZzYkN3ek56azFNREV5T0RjNE5qY3lPVGNzTUN4dWRXeHNMRnRiTVRFc01USXdNalF4TlRjM016UTVORFl5WFN4Yk55eGJObDFkWFYwc1d5MHhMRGcxTEc1MWJHd3NOVEF3TWpZME16WTJPRGt5TlRJeExEQXNiblZzYkN4Yld6WXNJbWRoYldVaVhWMWRYVjFkWFN4Yk1Dd3dMR1poYkhObExHNTFiR3dzTlRVek1EVXlOVFEyT1Rnd01EZzJMREk1TEZ0Yk55dzRNU3h1ZFd4c0xEQXNabUZzYzJVc1ptRnNjMlVzWm1Gc2MyVXNOalV5T0RnM01EZzJOVGt6T0RnNUxHNTFiR3dzVzFzMExEUXlYVjFkWFN4Yld6TXNNVEkxTEc1MWJHd3NNVEEzT0RVd05EVTFOalE0T1RNMUxEQXNiblZzYkN4Yld6RXNXekV5TWwxZExGc3pMREJkTEZzM0xGc3pObDFkTEZzekxEQmRMRnN4TEZzeU5GMWRMRnN4TEZzeU5GMWRYVjFkWFYxZExGc3dMREFzWm1Gc2MyVXNiblZzYkN3ME5qUXdNak0zT0RBM01UWXdPREVzTXpBc1cxczNMRGd6TEc1MWJHd3NNU3htWVd4elpTeG1ZV3h6WlN4bVlXeHpaU3d5TnpVNU5EQXpNRGt5T1RBMU5qTXNiblZzYkYxZExGdGJNVFFzTWpNc2JuVnNiQ3d4TVRBeU16Y3pOakExTWpjeU5UY3NNQ3h1ZFd4c0xGdGJNeXd3WFN4Yk1TeGJNMTFkWFYwc1d6STFMREl6TEc1MWJHd3NOalF6TWpZMk5EQXpOalU1TkRNMExEQXNiblZzYkN4Yld6TXNNRjBzV3pFc1d6TmRYVjFkWFYwc1d6QXNNQ3htWVd4elpTeHVkV3hzTERJNU5qZ3dOVFF6TWprd09Ea3lNQ3d6TVN4Yld5MHhMRE15TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4bVlXeHpaU3c0TXpVMU1EVXpPRFV6T0RZMU5qSXNiblZzYkN4Yld6RXhMRFE0T0RVNU5qWXlNamM1TkRZek9GMHNXemdzTUYwc1d6Y3NXelpkWFYxZExGc3hOQ3c0TWl4dWRXeHNMREFzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzT1RFNU5EQXdOVEk1TVRJMk9UUTFMRzUxYkd3c1cxczRMREJkTEZzd0xGc3hNVjFkWFYxZExGdGJNVFFzTXpVc2JuVnNiQ3d4TWpFMk5UTXdOakEwTnpBNU9EWXNNQ3h1ZFd4c0xGdGJNQ3hiT1YxZFhWMWRYU3hiTUN3d0xHWmhiSE5sTEc1MWJHd3NOekF4TXpRek9EYzJPRFV5TlRneUxETXlMRnRiTFRFc016SXNiblZzYkN3d0xHWmhiSE5sTEdaaGJITmxMR1poYkhObExERXdOelF5TkRZeU5qVTVPRFF3Tml4dWRXeHNMRnRiTVRFc05EZzROVGsyTmpJeU56azBOak00WFN4Yk9Dd3dYU3hiTnl4Yk1sMWRYVjBzV3pFMExEZ3lMRzUxYkd3c01DeG1ZV3h6WlN4bVlXeHpaU3htWVd4elpTdzNNREkzTkRBMU1qVXlNakV6TWpVc2JuVnNiQ3hiV3pnc01GMHNXekFzV3psZFhWMWRYU3hiV3pFMExETTFMRzUxYkd3c09UQTNNak14T0RZNU9UYzBOelkzTERBc2JuVnNiQ3hiV3pBc1d6RXhYVjFkWFYxZExGczBMRnNpYzJWc1pXTjBiR0Z1WjNWaFoyVWlMREFzVzEwc2RISjFaU3htWVd4elpTeG1ZV3h6WlYwc1ptRnNjMlVzYm5Wc2JDdzROek13TlRjNE9UZ3pNVEF4TkRZc016TXNXMTBzVzEwc1cxc3dMREFzWm1Gc2MyVXNiblZzYkN3ME9EWTBOakU0TVRjeU1ESXlNemtzTXpRc1cxc3RNU3d6TWl4dWRXeHNMREFzWm1Gc2MyVXNabUZzYzJVc1ptRnNjMlVzTmpnMU9EY3hOalUyTURFMk1qUXdMRzUxYkd3c1cxc3hNU3cwTlRFek5qZzJPRE01TkRZMk5EaGRMRnM0TERCZExGczNMRnN5WFYxZFhWMHNXMXN5TXl3ek5TeHVkV3hzTERjMk16QXhNREUwTlRJME9EUXdNaXd3TEc1MWJHd3NXMXN3TEZzeVhWMWRYVjBzVzFzd0xEQXNabUZzYzJVc2JuVnNiQ3cyTWpnM05UVTRNamMxTWpVM056TXNNelVzVzFzeE5Dd3pNeXh1ZFd4c0xEQXNabUZzYzJVc1ptRnNjMlVzZEhKMVpTdzBOak0zTnpBMU5UWXpOakE0TWpRc2JuVnNiQ3hiV3pBc1d6RXlNMTFkWFYxZExGdGJNVFFzTXpVc2JuVnNiQ3c0T1RFNE9UZzROVGsxTnpneE9UZ3NNQ3h1ZFd4c0xGdGJNQ3hiTXpSZFhWMWRYVjBzV3pBc01DeG1ZV3h6WlN4dWRXeHNMRFl4TnprMk5UZzJNemMxTVRjd05Dd3pOaXhiV3pJMUxETXpMRzUxYkd3c01DeG1ZV3h6WlN4bVlXeHpaU3gwY25WbExEWTFOemMwTkRRMk56VTRNRGM1TUN4dWRXeHNMRnRiTUN4Yk1USXdYVjFkWFYwc1cxc3lOU3d6TlN4dWRXeHNMREkyT0RVMU5ESTRNVFEzTXpJek5Dd3dMRzUxYkd3c1cxc3dMRnN5WFYxZFhWMWRMRnN3TERBc1ptRnNjMlVzYm5Wc2JDd3pOamN4TURnMk5UZ3hNamN6TnpNc016Y3NXMXN5TlN3ek15eHVkV3hzTERBc1ptRnNjMlVzWm1Gc2MyVXNkSEoxWlN3ME9EWTNORFEyTXpZME1UUTFNVFFzYm5Wc2JDeGJXekFzV3pFeU1WMWRYVjFkTEZ0Yk1qVXNNelVzYm5Wc2JDdzNNelEzTXpZeE5UQXdOak13TURBc01DeHVkV3hzTEZ0Yk1DeGJObDFkWFYxZFhWMWRMRnN3TERBc1ptRnNjMlVzYm5Wc2JDdzNNekl3T1RZM056RXpPVE16TXpZc016Z3NXMXN0TVN3ek1peHVkV3hzTERBc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc05UY3dOemcyTlRNek16WTBOek0wTEc1MWJHd3NXMXN4TVN3ME5URXpOamcyT0RNNU5EWTJORGhkTEZzNExEQmRMRnMzTEZzMlhWMWRYVjBzVzFzeU15d3pOU3h1ZFd4c0xEUTFOelUzTmpVeE9EWXhNVGMxT1N3d0xHNTFiR3dzVzFzd0xGczJYVjFkWFYwc1cxc3dMREFzWm1Gc2MyVXNiblZzYkN3NU9EUXdNamsxTXpnM09UZ3lPRElzTXprc1cxc3hOQ3d6TXl4dWRXeHNMREFzWm1Gc2MyVXNabUZzYzJVc2RISjFaU3d6TmpBMk1UTTVNVFE0T0Rjek16WXNiblZzYkN4Yld6QXNXekV5TTExZFhWMWRMRnRiTVRRc016VXNiblZzYkN3ek16WXlPVEF3TmpBek1ESTNORE1zTUN4dWRXeHNMRnRiTUN4Yk1UVmRYVjFkWFYwc1d6QXNNQ3htWVd4elpTeHVkV3hzTERneE9ESTBNak0yT1RZek56VXlPU3cwTUN4Yld6STFMRE16TEc1MWJHd3NNQ3htWVd4elpTeG1ZV3h6WlN4MGNuVmxMRFV6TlRZd05ESTFOVFV3TVRjek5TeHVkV3hzTEZ0Yk1DeGJNVEl3WFYxZFhWMHNXMXN5TlN3ek5TeHVkV3hzTERRME5USTJNRGt3TURRMk16azBOU3d3TEc1MWJHd3NXMXN3TEZzeE0xMWRYVjFkWFN4Yk1Dd3dMR1poYkhObExHNTFiR3dzTXpneE9ETTFOelUzTlRnMU1EWTJMRFF4TEZ0Yk1qVXNNek1zYm5Wc2JDd3dMR1poYkhObExHWmhiSE5sTEhSeWRXVXNOVFV5TlRZMU1EUXlOVEUxTXpVMExHNTFiR3dzVzFzd0xGc3hNakZkWFYxZFhTeGJXekkxTERNMUxHNTFiR3dzT1RZNU16Y3lOalUyTXpFMU5ETTJMREFzYm5Wc2JDeGJXekFzV3pFeFhWMWRYVjFkWFYxZFhWMWRMRnNpUlZaRlRsUWdkMmx1Wkc5M01TSXNXMXN4TENKemRHRnlkQ0lzTUN3d0xHWmhiSE5sTEdaaGJITmxMREUzT1RZeU9ERXdPVEkxT1RrM01DeG1ZV3h6WlN3NE9WMHNXekFzTUN4bVlXeHpaU3h1ZFd4c0xERTJOVEl5TlRVeU5qYzFNREV5TlN3eExGdGJOaXd4TWpZc2JuVnNiQ3d4TEdaaGJITmxMR1poYkhObExHWmhiSE5sTERZeU56QTFOREV3TkRZMU5UVTNOQ3h1ZFd4c1hWMHNXMXN3TERFeU55eHVkV3hzTERVMU5qWTFOVGt4TXpFNE5qUXhNQ3d3TEc1MWJHd3NXMXN4TEZzeE1qUmRYVjFkTEZzMkxERXlPQ3h1ZFd4c0xEZ3dOVFl3TXpNeU5Ea3lPREF6TXl3d0xHNTFiR3dzVzFzeExGc3hNalZkWFN4Yk1DeGJOekJkWFYxZFhTeGJXekFzTUN4bVlXeHpaU3h1ZFd4c0xESXhNalF3TURVMU1EUTRPVEkyT0N3eUxGdGJMVEVzTVRJNUxHNTFiR3dzTUN4MGNuVmxMR1poYkhObExHWmhiSE5sTERJNE5qUXpOVEEyTkRreU56SXhNeXh1ZFd4c0xGdGJNU3hiTWpSZFhTeGJNQ3hiTWwxZExGc3dMRnN4Tnl4Yk1Td3dMREV6TUN4bVlXeHpaVjFkWFYxZFhTeGJXellzTVRJNExHNTFiR3dzTmpBeE5URXlOamMxTURrd056QTRMREFzYm5Wc2JDeGJXekVzV3pFeU5peGJNU3d3TERFek1TeG1ZV3h6WlYwc1d6UXNNVE15WFYxZExGc3dMRnN4TWpjc1d6RXNNQ3d4TXpFc1ptRnNjMlZkTEZzMExERXpNbDFkWFYxZFhWMWRYU3hiTUN3d0xHWmhiSE5sTEc1MWJHd3NPRFUzTlRnNU16a3pPVEUzT0RJMkxETXNXMXN6TERFek15eHVkV3hzTERFc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc016RTVPVGcyTlRZME9Ea3dPVFkwTEc1MWJHeGRYU3hiV3pFc01USTBMRzUxYkd3c05qYzNNREExT0RNeE5qTTJNVFkxTERBc2JuVnNiQ3hiV3pNc01GMWRYU3hiTFRFc01UQTJMRzUxYkd3c01qUTRNekF5TkRJNE9EYzVOelU0TERBc2JuVnNiQ3hiV3pBc1d6SmRYVjFkWFYwc1d6QXNNQ3htWVd4elpTeHVkV3hzTERJME9EVTRNREV6TkRNNU16VTFOQ3cwTEZ0Yk15d3hNelFzYm5Wc2JDd3hMR1poYkhObExHWmhiSE5sTEdaaGJITmxMRGswTkRrek1Ua3lOamcxTXpJNU55eHVkV3hzWFYwc1cxc3hMREV5TkN4dWRXeHNMRFEwTlRNd056a3dPVFUzTURjd01Td3dMRzUxYkd3c1cxc3pMREZkWFYwc1d5MHhMREV3Tml4dWRXeHNMRGd3T0RjNE5qWXhOakF6TURreE9Td3dMRzUxYkd3c1cxc3dMRnMyWFYxZFhWMWRMRnN3TERBc1ptRnNjMlVzYm5Wc2JDdzRNalV6TlRNek16a3dNRFExTmpnc05TeGJXeklzTVRNMUxHNTFiR3dzTVN4bVlXeHpaU3htWVd4elpTeG1ZV3h6WlN3ek5EZzFNamd4T1RNd01UQXhOakFzYm5Wc2JGMHNXeklzTVRNMkxHNTFiR3dzTUN4bVlXeHpaU3htWVd4elpTeG1ZV3h6WlN3MU5qSXpNRGsyTlRRNU1EUTNNRFVzYm5Wc2JGMHNXeTB4TERNeUxHNTFiR3dzTUN4bVlXeHpaU3htWVd4elpTeG1ZV3h6WlN3eU9UY3pNRFl3TVRRd05URTRORGNzYm5Wc2JDeGJXekV4TERFM09UWXlPREV3T1RJMU9UazNNRjBzV3pnc01GMHNXemNzV3pKZFhWMWRYU3hiV3kweExEY3lMRzUxYkd3c01UazRPRFF5TURreE5qUTNPRE01TERJc2JuVnNiQ3hiV3pBc1d6VTJYVjFkWFN4Yk1pd3hNemNzYm5Wc2JDdzNOelkyTkRVeE9EWXdNelUwTWpFc01DeHVkV3hzWFN4YkxURXNOVGtzYm5Wc2JDdzFNVEV3TmpJek56UTVOemd6TXpjc01DeHVkV3hzTEZ0Yk1URXNNVGM1TmpJNE1UQTVNalU1T1Rjd1hTeGJOeXhiTmwxZFhWMWRYU3hiTUN3d0xHWmhiSE5sTEc1MWJHd3NNakU0TWpBeU1ERXhORFV3TURrMExEWXNXMXN5TERFek5TeHVkV3hzTERFc1ptRnNjMlVzWm1Gc2MyVXNabUZzYzJVc05ESTJOak15TVRreE5qWXdNekl5TEc1MWJHeGRMRnN5TERFek5peHVkV3hzTERBc1ptRnNjMlVzZEhKMVpTeG1ZV3h6WlN3ek9EYzVORFEyTmpVNU9UQTRNVGtzYm5Wc2JGMHNXeTB4TERNeUxHNTFiR3dzTUN4bVlXeHpaU3htWVd4elpTeG1ZV3h6WlN3Mk5ERXdNamd5TlRFME56TTNNVFlzYm5Wc2JDeGJXekV4TERFM09UWXlPREV3T1RJMU9UazNNRjBzV3pnc01GMHNXemNzV3pKZFhWMWRYU3hiV3kweExEY3lMRzUxYkd3c05EY3hNRGN5TkRneE5UZ3hORFE0TERJc2JuVnNiQ3hiV3pBc1d6VTJYVjFkWFN4Yk1pd3hNemdzYm5Wc2JDdzRNVE00TlRVeU1UWTJOemMwTVRnc01DeHVkV3hzTEZ0Yk15d3lYU3hiTXl3d1hWMWRMRnN0TVN3MU9TeHVkV3hzTERjME1qWXlOVFV3TWpVMU5UVTJNQ3d3TEc1MWJHd3NXMXN4TVN3eE56azJNamd4TURreU5UazVOekJkTEZzM0xGczJYVjFkWFYxZFhWMWRMRnRiSW1Kc2IzZGZNREVpTEZ0YkltRjFaR2x2TDNkbFltMDdJR052WkdWamN6MXZjSFZ6SWl3aUxuZGxZbTBpTERRek56SmRYU3htWVd4elpWMHNXeUpuYnpNaUxGdGJJbUYxWkdsdkwzZGxZbTA3SUdOdlpHVmpjejF2Y0hWeklpd2lMbmRsWW0waUxEY3dOREZkWFN4bVlXeHpaVjBzV3lKbVlXNXpJaXhiV3lKaGRXUnBieTkzWldKdE95QmpiMlJsWTNNOWIzQjFjeUlzSWk1M1pXSnRJaXd5TURVM00xMWRMR1poYkhObFhTeGJJblJ5YVdKMWJtVWlMRnRiSW1GMVpHbHZMM2RsWW0wN0lHTnZaR1ZqY3oxdmNIVnpJaXdpTG5kbFltMGlMRFl3TWpCZFhTeG1ZV3h6WlYwc1d5SnpjRzl5ZEhNZ2JYVnphV05mTURJaUxGdGJJbUYxWkdsdkwzZGxZbTA3SUdOdlpHVmpjejF2Y0hWeklpd2lMbmRsWW0waUxESXpNVFV4TmpaZFhTeG1ZV3h6WlYwc1d5SnpjRzl5ZEhNZ0tHWnZjaUJ6YVcxMWJHRjBiM0p6S1NJc1cxc2lZWFZrYVc4dmQyVmliVHNnWTI5a1pXTnpQVzl3ZFhNaUxDSXVkMlZpYlNJc01qTTBNVGN6TUYxZExHWmhiSE5sWFN4YkluTndiM0owY3lCdGRYTnBZMTh3TVNJc1cxc2lZWFZrYVc4dmQyVmliVHNnWTI5a1pXTnpQVzl3ZFhNaUxDSXVkMlZpYlNJc01qTXhOVEUyTmwxZExHWmhiSE5sWFN4YkluUnBiV1Z5SWl4Yld5SmhkV1JwYnk5M1pXSnRPeUJqYjJSbFkzTTliM0IxY3lJc0lpNTNaV0p0SWl3ek5USTVYVjBzWm1Gc2MyVmRYU3dpYldWa2FXRXZJaXhtWVd4elpTd3hNamd3TERjeU1Dd3pMR1poYkhObExDSjBjbWxzYVc1bFlYSWlMSFJ5ZFdVc0lqRXVNQzR3TGpNaUxHWmhiSE5sTEdaaGJITmxMREFzTWl3NU9DeG1ZV3h6WlN4MGNuVmxMREVzZEhKMVpTd3dMamM0TlRNNU9ERTJNek01TnpRME9ETXNXMTBzSW1samIyNXpMeUlzVzEwc0ltNXZjbTFoYkdsNlpXUWlMQ0kzYlhOMmVUZG1NM2x0TmlJc0ltWnZiblJ6THlJc1cxMHNJbWhwWjJndGNHVnlabTl5YldGdVkyVWlMRnRkTENKemRHRnVaR0Z5WkNJc0luWnplVzVqSWl3aUlpd2liRzloWkdsdVp5MXNiMmR2TG5CdVp5SXNabUZzYzJVc05DeG1ZV3h6WlN4dWRXeHNMRnRkTENKbWJHRjBJaXd4TERFd01EQXdMR1poYkhObFhYMD0iLCBpbml0KS50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICAgICAgQzMuVGhyb3dJZk5vdE9rKHJlc3BvbnNlKTsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlCiAgICAgICAgfSkKICAgIH07CiAgICBDMy5GZXRjaFRleHQgPSBmdW5jdGlvbiBGZXRjaFRleHQodXJsKSB7CiAgICAgICAgcmV0dXJuIEMzLkZldGNoT2sodXJsKS50aGVuKHJlc3BvbnNlID0+IHJlc3BvbnNlLnRleHQoKSkKICAgIH07CiAgICBDMy5GZXRjaEpzb24gPSBmdW5jdGlvbiBGZXRjaEpzb24odXJsKSB7CiAgICAgICAgcmV0dXJuIEMzLkZldGNoT2sodXJsKS50aGVuKHJlc3BvbnNlID0+IHJlc3BvbnNlLmpzb24oKSkKICAgIH07CiAgICBDMy5GZXRjaEJsb2IgPSBmdW5jdGlvbiBGZXRjaEJsb2IodXJsKSB7CiAgICAgICAgcmV0dXJuIEMzLkZldGNoT2sodXJsKS50aGVuKHJlc3BvbnNlID0+IHJlc3BvbnNlLmJsb2IoKSkKICAgIH07CiAgICBDMy5GZXRjaEFycmF5QnVmZmVyID0gZnVuY3Rpb24gRmV0Y2hBcnJheUJ1ZmZlcih1cmwpIHsKICAgICAgICByZXR1cm4gQzMuRmV0Y2hPayh1cmwpLnRoZW4ocmVzcG9uc2UgPT4gcmVzcG9uc2UuYXJyYXlCdWZmZXIoKSkKICAgIH07CiAgICBDMy5GZXRjaEltYWdlID0gZnVuY3Rpb24gRmV0Y2hJbWFnZSh1cmwpIHsKICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewogICAgICAgICAgICBjb25zdCBpbWcgPSBuZXcgSW1hZ2U7CiAgICAgICAgICAgIGltZy5vbmxvYWQgPSAoKSA9PiByZXNvbHZlKGltZyk7CiAgICAgICAgICAgIGltZy5vbmVycm9yID0gZXJyID0+IHJlamVjdChlcnIpOwogICAgICAgICAgICBpbWcuc3JjID0gdXJsCiAgICAgICAgfSkKICAgIH07CiAgICBDMy5CbG9iVG9BcnJheUJ1ZmZlciA9IGZ1bmN0aW9uIEJsb2JUb0FycmF5QnVmZmVyKGJsb2IpIHsKICAgICAgICBpZiAodHlwZW9mIGJsb2JbImFycmF5QnVmZmVyIl0gPT09ICJmdW5jdGlvbiIpIHJldHVybiBibG9iWyJhcnJheUJ1ZmZlciJdKCk7CiAgICAgICAgZWxzZSByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewogICAgICAgICAgICBjb25zdCBmaWxlUmVhZGVyID0gbmV3IEZpbGVSZWFkZXI7CiAgICAgICAgICAgIGZpbGVSZWFkZXIub25sb2FkID0gKCkgPT4gcmVzb2x2ZShmaWxlUmVhZGVyLnJlc3VsdCk7CiAgICAgICAgICAgIGZpbGVSZWFkZXIub25lcnJvciA9ICgpID0+IHJlamVjdChmaWxlUmVhZGVyLmVycm9yKTsKICAgICAgICAgICAgZmlsZVJlYWRlci5yZWFkQXNBcnJheUJ1ZmZlcihibG9iKQogICAgICAgIH0pCiAgICB9OwogICAgQzMuQmxvYlRvU3RyaW5nID0gZnVuY3Rpb24gQmxvYlRvU3RyaW5nKGJsb2IpIHsKICAgICAgICBpZiAodHlwZW9mIGJsb2JbInRleHQiXSA9PT0gImZ1bmN0aW9uIikgcmV0dXJuIGJsb2JbInRleHQiXSgpOwogICAgICAgIGVsc2UgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKICAgICAgICAgICAgY29uc3QgZmlsZVJlYWRlciA9IG5ldyBGaWxlUmVhZGVyOwogICAgICAgICAgICBmaWxlUmVhZGVyLm9ubG9hZCA9ICgpID0+IHJlc29sdmUoZmlsZVJlYWRlci5yZXN1bHQpOwogICAgICAgICAgICBmaWxlUmVhZGVyLm9uZXJyb3IgPSAoKSA9PiByZWplY3QoZmlsZVJlYWRlci5lcnJvcik7CiAgICAgICAgICAgIGZpbGVSZWFkZXIucmVhZEFzVGV4dChibG9iKQogICAgICAgIH0pCiAgICB9OwogICAgQzMuQmxvYlRvSnNvbiA9IGZ1bmN0aW9uIEJsb2JUb0pzb24oYmxvYikgewogICAgICAgIHJldHVybiBDMy5CbG9iVG9TdHJpbmcoYmxvYikudGhlbih0ZXh0ID0+IEpTT04ucGFyc2UodGV4dCkpCiAgICB9OwogICAgQzMuQmxvYlRvSW1hZ2UgPSBhc3luYyBmdW5jdGlvbiBCbG9iVG9JbWFnZShibG9iLCBkZWNvZGVJbWFnZSkgewogICAgICAgIGxldCBibG9iVXJsID0gVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBjb25zdCBpbWcgPSBhd2FpdCBDMy5GZXRjaEltYWdlKGJsb2JVcmwpOwogICAgICAgICAgICBVUkwucmV2b2tlT2JqZWN0VVJMKGJsb2JVcmwpOwogICAgICAgICAgICBibG9iVXJsID0gIiI7CiAgICAgICAgICAgIGlmIChkZWNvZGVJbWFnZSAmJiB0eXBlb2YgaW1nWyJkZWNvZGUiXSA9PT0gImZ1bmN0aW9uIikgYXdhaXQgaW1nWyJkZWNvZGUiXSgpOwogICAgICAgICAgICByZXR1cm4gaW1nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKGJsb2JVcmwpIFVSTC5yZXZva2VPYmplY3RVUkwoYmxvYlVybCkKICAgICAgICB9CiAgICB9OwogICAgQzMuQ3JlYXRlQ2FudmFzID0gZnVuY3Rpb24gQ3JlYXRlQ2FudmFzKHdpZHRoLCBoZWlnaHQpIHsKICAgICAgICBpZiAodHlwZW9mIGRvY3VtZW50ICE9PSAidW5kZWZpbmVkIiAmJiB0eXBlb2YgZG9jdW1lbnQuY3JlYXRlRWxlbWVudCA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICBjb25zdCBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJjYW52YXMiKTsKICAgICAgICAgICAgY2FudmFzLndpZHRoID0gd2lkdGg7CiAgICAgICAgICAgIGNhbnZhcy5oZWlnaHQgPSBoZWlnaHQ7CiAgICAgICAgICAgIHJldHVybiBjYW52YXMKICAgICAgICB9IGVsc2UgcmV0dXJuIG5ldyBPZmZzY3JlZW5DYW52YXMod2lkdGgsIGhlaWdodCkKICAgIH07CiAgICBDMy5DYW52YXNUb0Jsb2IgPSBmdW5jdGlvbiBDYW52YXNUb0Jsb2IoY2FudmFzLCB0eXBlLCBxdWFsaXR5KSB7CiAgICAgICAgaWYgKHR5cGVvZiBxdWFsaXR5ICE9PSAibnVtYmVyIikgcXVhbGl0eSA9IDE7CiAgICAgICAgdHlwZSA9IHR5cGUgfHwgImltYWdlL3BuZyI7CiAgICAgICAgcXVhbGl0eSA9IEMzLmNsYW1wKHF1YWxpdHksIDAsIDEpOwogICAgICAgIGlmIChjYW52YXMudG9CbG9iKSByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiBjYW52YXMudG9CbG9iKHJlc29sdmUsIHR5cGUsIHF1YWxpdHkpKTsKICAgICAgICBlbHNlIGlmIChjYW52YXNbImNvbnZlcnRUb0Jsb2IiXSkgcmV0dXJuIGNhbnZhc1siY29udmVydFRvQmxvYiJdKHsKICAgICAgICAgICAgInR5cGUiOiB0eXBlLAogICAgICAgICAgICAicXVhbGl0eSI6IHF1YWxpdHkKICAgICAgICB9KTsKICAgICAgICBlbHNlIHRocm93IG5ldyBFcnJvcigiY291bGQgbm90IGNvbnZlcnQgY2FudmFzIHRvIGJsb2IiKTsKICAgIH07CiAgICBDMy5EcmF3YWJsZVRvQmxvYiA9IGZ1bmN0aW9uIERyYXdhYmxlVG9CbG9iKGRyYXdhYmxlLCB0eXBlLCBxdWFsaXR5KSB7CiAgICAgICAgY29uc3QgY2FudmFzID0gQzMuQ3JlYXRlQ2FudmFzKGRyYXdhYmxlLndpZHRoLCBkcmF3YWJsZS5oZWlnaHQpOwogICAgICAgIGNvbnN0IGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCIyZCIpOwogICAgICAgIGN0eC5kcmF3SW1hZ2UoZHJhd2FibGUsIDAsIDApOwogICAgICAgIHJldHVybiBDMy5DYW52YXNUb0Jsb2IoY2FudmFzLCB0eXBlLCBxdWFsaXR5KQogICAgfTsKICAgIEMzLkltYWdlRGF0YVRvQmxvYiA9IGZ1bmN0aW9uIEltYWdlRGF0YVRvQmxvYihpbWFnZURhdGEsIHR5cGUsIHF1YWxpdHkpIHsKICAgICAgICBpZiAoQzMuU3VwcG9ydHMuSW1hZ2VCaXRtYXBPcHRpb25zKSByZXR1cm4gY3JlYXRlSW1hZ2VCaXRtYXAoaW1hZ2VEYXRhLCB7CiAgICAgICAgICAgICJwcmVtdWx0aXBseUFscGhhIjogIm5vbmUiCiAgICAgICAgfSkudGhlbihpbWFnZUJpdG1hcCA9PiBDMy5EcmF3YWJsZVRvQmxvYihpbWFnZUJpdG1hcCwgdHlwZSwgcXVhbGl0eSkpOwogICAgICAgIGVsc2UgaWYgKEMzLlN1cHBvcnRzLkltYWdlQml0bWFwKSByZXR1cm4gY3JlYXRlSW1hZ2VCaXRtYXAoaW1hZ2VEYXRhKS50aGVuKGltYWdlQml0bWFwID0+IEMzLkRyYXdhYmxlVG9CbG9iKGltYWdlQml0bWFwLCB0eXBlLCBxdWFsaXR5KSk7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGNvbnN0IGNhbnZhcyA9IEMzLkNyZWF0ZUNhbnZhcyhpbWFnZURhdGEud2lkdGgsIGltYWdlRGF0YS5oZWlnaHQpOwogICAgICAgICAgICBjb25zdCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgiMmQiKTsKICAgICAgICAgICAgY3R4LnB1dEltYWdlRGF0YShpbWFnZURhdGEsIDAsIDApOwogICAgICAgICAgICByZXR1cm4gQzMuQ2FudmFzVG9CbG9iKGNhbnZhcywKICAgICAgICAgICAgICAgIHR5cGUsIHF1YWxpdHkpCiAgICAgICAgfQogICAgfTsKICAgIEMzLkNvcHlTZXQgPSBmdW5jdGlvbiBDb3B5U2V0KGRlc3QsIHNyYykgewogICAgICAgIGRlc3QuY2xlYXIoKTsKICAgICAgICBmb3IgKGNvbnN0IHggb2Ygc3JjKSBkZXN0LmFkZCh4KQogICAgfTsKICAgIEMzLk1hcFRvT2JqZWN0ID0gZnVuY3Rpb24gTWFwVG9PYmplY3QobWFwKSB7CiAgICAgICAgY29uc3QgcmV0ID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgICBmb3IgKGNvbnN0IFtrLCB2XSBvZiBtYXAuZW50cmllcygpKSByZXRba10gPSB2OwogICAgICAgIHJldHVybiByZXQKICAgIH07CiAgICBDMy5PYmplY3RUb01hcCA9IGZ1bmN0aW9uIE9iamVjdFRvTWFwKG8sIG1hcCkgewogICAgICAgIG1hcC5jbGVhcigpOwogICAgICAgIGZvciAoY29uc3QgW2ssIHZdIG9mIE9iamVjdC5lbnRyaWVzKG8pKSBtYXAuc2V0KGssIHYpCiAgICB9OwogICAgQzMuVG9TdXBlckpTT04gPSBmdW5jdGlvbiBUb1N1cGVySlNPTih2KSB7CiAgICAgICAgaWYgKHR5cGVvZiB2ID09PSAib2JqZWN0IiAmJiB2ICE9PSBudWxsKQogICAgICAgICAgICBpZiAodiBpbnN0YW5jZW9mIFNldCkgcmV0dXJuIHsKICAgICAgICAgICAgICAgICJfYzN0eXBlXyI6ICJzZXQiLAogICAgICAgICAgICAgICAgImRhdGEiOiBbLi4udl0ubWFwKG8gPT4gVG9TdXBlckpTT04obykpCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGVsc2UgaWYgKHYgaW5zdGFuY2VvZiBNYXApIHJldHVybiB7CiAgICAgICAgICAgICJfYzN0eXBlXyI6ICJtYXAiLAogICAgICAgICAgICAiZGF0YSI6IFsuLi52XS5tYXAocGFpciA9PiBbcGFpclswXSwgVG9TdXBlckpTT04ocGFpclsxXSldKQogICAgICAgIH07CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGNvbnN0IHJldCA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgICAgICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKHYpKSByZXRba2V5XSA9IFRvU3VwZXJKU09OKHZhbHVlKTsKICAgICAgICAgICAgcmV0dXJuIHJldAogICAgICAgIH0KICAgICAgICByZXR1cm4gdgogICAgfTsKICAgIEMzLkZyb21TdXBlckpTT04gPSBmdW5jdGlvbiBGcm9tU3VwZXJKU09OKHYpIHsKICAgICAgICBpZiAodHlwZW9mIHYgPT09ICJvYmplY3QiICYgdiAhPT0gbnVsbCkKICAgICAgICAgICAgaWYgKHZbIl9jM3R5cGVfIl0gPT09ICJzZXQiKSByZXR1cm4gbmV3IFNldCh2WyJkYXRhIl0ubWFwKG8gPT4gRnJvbVN1cGVySlNPTihvKSkpOwogICAgICAgICAgICBlbHNlIGlmICh2WyJfYzN0eXBlXyJdID09PSAibWFwIikgcmV0dXJuIG5ldyBNYXAodlsiZGF0YSJdLm1hcChwYWlyID0+IFtwYWlyWzBdLCBGcm9tU3VwZXJKU09OKHBhaXJbMV0pXSkpOwogICAgICAgIGVsc2UgewogICAgICAgICAgICBjb25zdCByZXQgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICAgICAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyh2KSkgcmV0W2tleV0gPSBGcm9tU3VwZXJKU09OKHZhbHVlKTsKICAgICAgICAgICAgcmV0dXJuIHJldAogICAgICAgIH0KICAgICAgICByZXR1cm4gdgogICAgfTsKICAgIEMzLkNTU1RvQ2FtZWxDYXNlID0gZnVuY3Rpb24oc3RyKSB7CiAgICAgICAgaWYgKHN0ci5zdGFydHNXaXRoKCItLSIpKSByZXR1cm4gc3RyOwogICAgICAgIGxldCByZXQgPSAiIjsKICAgICAgICBsZXQgaXNBZnRlckh5cGhlbiA9IGZhbHNlOwogICAgICAgIGZvciAoY29uc3QgY2ggb2Ygc3RyKQogICAgICAgICAgICBpZiAoY2ggPT09ICItIikgaXNBZnRlckh5cGhlbiA9IHRydWU7CiAgICAgICAgICAgIGVsc2UgaWYgKGlzQWZ0ZXJIeXBoZW4pIHsKICAgICAgICAgICAgcmV0ICs9IGNoLnRvVXBwZXJDYXNlKCk7CiAgICAgICAgICAgIGlzQWZ0ZXJIeXBoZW4gPSBmYWxzZQogICAgICAgIH0gZWxzZSByZXQgKz0gY2g7CiAgICAgICAgcmV0dXJuIHJldAogICAgfTsKICAgIEMzLklzSXRlcmF0b3IgPSBmdW5jdGlvbihvKSB7CiAgICAgICAgcmV0dXJuIHR5cGVvZiBvID09PSAib2JqZWN0IiAmJiB0eXBlb2Ygby5uZXh0ID09PSAiZnVuY3Rpb24iCiAgICB9OwogICAgQzMuTWFrZUZpbGxlZEFycmF5ID0gZnVuY3Rpb24gTWFrZUZpbGxlZEFycmF5KGxlbiwgZGF0YSkgewogICAgICAgIGNvbnN0IHJldCA9IFtdOwogICAgICAgIGlmICh0eXBlb2YgZGF0YSA9PT0gImZ1bmN0aW9uIikKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW47ICsraSkgcmV0LnB1c2goZGF0YSgpKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuOyArK2kpIHJldC5wdXNoKGRhdGEpOwogICAgICAgIHJldHVybiByZXQKICAgIH07Cgp9CgovLyAuLi9saWIvbWlzYy9jb2xvci5qcwp7CiAgICAndXNlIHN0cmljdCc7CiAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICBjb25zdCBIU0xfVEVTVCA9IC8oWzAtOS5dKyksKFswLTkuXSspJT8sKFswLTkuXSspJT8vaTsKICAgIGNvbnN0IEhTTEFfVEVTVCA9IC8oWzAtOS5dKyksKFswLTkuXSspJT8sKFswLTkuXSspJT8sKFswLTkuXSkvaTsKCiAgICBmdW5jdGlvbiBwYWRUd29EaWdpdHMoc3RyKSB7CiAgICAgICAgaWYgKHN0ci5sZW5ndGggPT09IDApIHJldHVybiAiMDAiOwogICAgICAgIGVsc2UgaWYgKHN0ci5sZW5ndGggPT09IDEpIHJldHVybiAiMCIgKyBzdHI7CiAgICAgICAgZWxzZSByZXR1cm4gc3RyCiAgICB9CgogICAgZnVuY3Rpb24gaHVlVG9SR0IocCwgcSwgdCkgewogICAgICAgIGlmICh0IDwgMCkgdCArPSAxOwogICAgICAgIGlmICh0ID4gMSkgdCAtPSAxOwogICAgICAgIGlmICh0IDwgMSAvIDYpIHJldHVybiBwICsgKHEgLSBwKSAqIDYgKiB0OwogICAgICAgIGlmICh0IDwgMSAvIDIpIHJldHVybiBxOwogICAgICAgIGlmICh0IDwgMiAvIDMpIHJldHVybiBwICsgKHEgLSBwKSAqICgyIC8gMyAtIHQpICogNjsKICAgICAgICByZXR1cm4gcAogICAgfQogICAgQzMuQ29sb3IgPSBjbGFzcyBDb2xvciB7CiAgICAgICAgY29uc3RydWN0b3IociwgZywgYiwgYSkgewogICAgICAgICAgICB0aGlzLl9yID0gTmFOOwogICAgICAgICAgICB0aGlzLl9nID0gTmFOOwogICAgICAgICAgICB0aGlzLl9iID0gTmFOOwogICAgICAgICAgICB0aGlzLl9hID0gTmFOOwogICAgICAgICAgICB0aGlzLl9yID0gMDsKICAgICAgICAgICAgdGhpcy5fZyA9IDA7CiAgICAgICAgICAgIHRoaXMuX2IgPSAwOwogICAgICAgICAgICB0aGlzLl9hID0gMDsKICAgICAgICAgICAgaWYgKHIgaW5zdGFuY2VvZiBDMy5Db2xvcikgdGhpcy5zZXQocik7CiAgICAgICAgICAgIGVsc2UgdGhpcy5zZXRSZ2JhKHIgfHwgMCwgZyB8fCAwLCBiIHx8IDAsIGEgfHwgMCkKICAgICAgICB9CiAgICAgICAgc2V0UmdiKHIsIGcsIGIpIHsKICAgICAgICAgICAgdGhpcy5fciA9ICtyOwogICAgICAgICAgICB0aGlzLl9nID0gK2c7CiAgICAgICAgICAgIHRoaXMuX2IgPSArYjsKICAgICAgICAgICAgdGhpcy5jbGFtcCgpOwogICAgICAgICAgICByZXR1cm4gdGhpcwogICAgICAgIH0KICAgICAgICBzZXRSZ2JhKHIsIGcsIGIsIGEpIHsKICAgICAgICAgICAgdGhpcy5fciA9ICtyOwogICAgICAgICAgICB0aGlzLl9nID0gK2c7CiAgICAgICAgICAgIHRoaXMuX2IgPSArYjsKICAgICAgICAgICAgdGhpcy5fYSA9ICthOwogICAgICAgICAgICB0aGlzLmNsYW1wKCk7CiAgICAgICAgICAgIHJldHVybiB0aGlzCiAgICAgICAgfQogICAgICAgIHNldChjKSB7CiAgICAgICAgICAgIHRoaXMuX3IgPSBjLl9yOwogICAgICAgICAgICB0aGlzLl9nID0gYy5fZzsKICAgICAgICAgICAgdGhpcy5fYiA9IGMuX2I7CiAgICAgICAgICAgIHRoaXMuX2EgPSBjLl9hOwogICAgICAgICAgICByZXR1cm4gdGhpcwogICAgICAgIH0KICAgICAgICBjb3B5KGMpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2V0KGMpCiAgICAgICAgfQogICAgICAgIGFkZChjKSB7CiAgICAgICAgICAgIHRoaXMuX3IgKz0gYy5fcjsKICAgICAgICAgICAgdGhpcy5fZyArPSBjLl9nOwogICAgICAgICAgICB0aGlzLl9iICs9CiAgICAgICAgICAgICAgICBjLl9iOwogICAgICAgICAgICB0aGlzLl9hICs9IGMuX2E7CiAgICAgICAgICAgIHRoaXMuY2xhbXAoKQogICAgICAgIH0KICAgICAgICBhZGRSZ2IociwgZywgYiwgYSA9IDApIHsKICAgICAgICAgICAgdGhpcy5fciArPSArcjsKICAgICAgICAgICAgdGhpcy5fZyArPSArZzsKICAgICAgICAgICAgdGhpcy5fYiArPSArYjsKICAgICAgICAgICAgdGhpcy5fYSArPSArYTsKICAgICAgICAgICAgdGhpcy5jbGFtcCgpCiAgICAgICAgfQogICAgICAgIGRpZmYoYykgewogICAgICAgICAgICB0aGlzLnNldFIoTWF0aC5tYXgodGhpcy5fciwgYy5fcikgLSBNYXRoLm1pbih0aGlzLl9yLCBjLl9yKSk7CiAgICAgICAgICAgIHRoaXMuc2V0RyhNYXRoLm1heCh0aGlzLl9nLCBjLl9nKSAtIE1hdGgubWluKHRoaXMuX2csIGMuX2cpKTsKICAgICAgICAgICAgdGhpcy5zZXRCKE1hdGgubWF4KHRoaXMuX2IsIGMuX2IpIC0gTWF0aC5taW4odGhpcy5fYiwgYy5fYikpOwogICAgICAgICAgICB0aGlzLnNldEEoTWF0aC5tYXgodGhpcy5fYSwgYy5fYSkgLSBNYXRoLm1pbih0aGlzLl9hLCBjLl9hKSk7CiAgICAgICAgICAgIHRoaXMuY2xhbXAoKQogICAgICAgIH0KICAgICAgICBjb3B5UmdiKGMpIHsKICAgICAgICAgICAgdGhpcy5fciA9IGMuX3I7CiAgICAgICAgICAgIHRoaXMuX2cgPSBjLl9nOwogICAgICAgICAgICB0aGlzLl9iID0gYy5fYgogICAgICAgIH0KICAgICAgICBzZXRSKHIpIHsKICAgICAgICAgICAgdGhpcy5fciA9IEMzLmNsYW1wKCtyLCAwLCAxKQogICAgICAgIH0KICAgICAgICBnZXRSKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fcgogICAgICAgIH0KICAgICAgICBzZXRHKGcpIHsKICAgICAgICAgICAgdGhpcy5fZyA9IEMzLmNsYW1wKCtnLCAwLCAxKQogICAgICAgIH0KICAgICAgICBnZXRHKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZwogICAgICAgIH0KICAgICAgICBzZXRCKGIpIHsKICAgICAgICAgICAgdGhpcy5fYiA9CiAgICAgICAgICAgICAgICBDMy5jbGFtcCgrYiwgMCwgMSkKICAgICAgICB9CiAgICAgICAgZ2V0QigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2IKICAgICAgICB9CiAgICAgICAgc2V0QShhKSB7CiAgICAgICAgICAgIHRoaXMuX2EgPSBDMy5jbGFtcCgrYSwgMCwgMSkKICAgICAgICB9CiAgICAgICAgZ2V0QSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2EKICAgICAgICB9CiAgICAgICAgY2xvbmUoKSB7CiAgICAgICAgICAgIHJldHVybiBDMy5OZXcoQzMuQ29sb3IsIHRoaXMuX3IsIHRoaXMuX2csIHRoaXMuX2IsIHRoaXMuX2EpCiAgICAgICAgfQogICAgICAgIHRvQXJyYXkoKSB7CiAgICAgICAgICAgIHJldHVybiBbdGhpcy5fciwgdGhpcy5fZywgdGhpcy5fYiwgdGhpcy5fYV0KICAgICAgICB9CiAgICAgICAgdG9UeXBlZEFycmF5KCkgewogICAgICAgICAgICByZXR1cm4gbmV3IEZsb2F0NjRBcnJheSh0aGlzLnRvQXJyYXkoKSkKICAgICAgICB9CiAgICAgICAgd3JpdGVUb1R5cGVkQXJyYXkodGEsIGkpIHsKICAgICAgICAgICAgdGFbaSsrXSA9IHRoaXMuX3I7CiAgICAgICAgICAgIHRhW2krK10gPSB0aGlzLl9nOwogICAgICAgICAgICB0YVtpKytdID0gdGhpcy5fYjsKICAgICAgICAgICAgdGFbaV0gPSB0aGlzLl9hCiAgICAgICAgfQogICAgICAgIHdyaXRlUkdCVG9UeXBlZEFycmF5KHRhLCBpKSB7CiAgICAgICAgICAgIHRhW2krK10gPSB0aGlzLl9yOwogICAgICAgICAgICB0YVtpKytdID0gdGhpcy5fZzsKICAgICAgICAgICAgdGFbaV0gPSB0aGlzLl9iCiAgICAgICAgfQogICAgICAgIGVxdWFscyhjKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9yID09PSBjLl9yICYmIHRoaXMuX2cgPT09IGMuX2cgJiYgdGhpcy5fYiA9PT0gYy5fYiAmJiB0aGlzLl9hID09PSBjLl9hCiAgICAgICAgfQogICAgICAgIGVxdWFsc0lnbm9yaW5nQWxwaGEoYykgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fciA9PT0KICAgICAgICAgICAgICAgIGMuX3IgJiYgdGhpcy5fZyA9PT0gYy5fZyAmJiB0aGlzLl9iID09PSBjLl9iCiAgICAgICAgfQogICAgICAgIGVxdWFsc1JnYihyLCBnLCBiKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9yID09PSByICYmIHRoaXMuX2cgPT09IGcgJiYgdGhpcy5fYiA9PT0gYgogICAgICAgIH0KICAgICAgICBlcXVhbHNSZ2JhKHIsIGcsIGIsIGEpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3IgPT09IHIgJiYgdGhpcy5fZyA9PT0gZyAmJiB0aGlzLl9iID09PSBiICYmIHRoaXMuX2EgPT09IGEKICAgICAgICB9CiAgICAgICAgZXF1YWxzRjMyQXJyYXkoYXJyLCBvZmZzZXQpIHsKICAgICAgICAgICAgcmV0dXJuIGFycltvZmZzZXRdID09PSBNYXRoLmZyb3VuZCh0aGlzLl9yKSAmJiBhcnJbb2Zmc2V0ICsgMV0gPT09IE1hdGguZnJvdW5kKHRoaXMuX2cpICYmIGFycltvZmZzZXQgKyAyXSA9PT0gTWF0aC5mcm91bmQodGhpcy5fYikgJiYgYXJyW29mZnNldCArIDNdID09PSBNYXRoLmZyb3VuZCh0aGlzLl9hKQogICAgICAgIH0KICAgICAgICBlcXVhbHNSR0JGMzJBcnJheShhcnIsIG9mZnNldCkgewogICAgICAgICAgICByZXR1cm4gYXJyW29mZnNldF0gPT09IE1hdGguZnJvdW5kKHRoaXMuX3IpICYmIGFycltvZmZzZXQgKyAxXSA9PT0gTWF0aC5mcm91bmQodGhpcy5fZykgJiYgYXJyW29mZnNldCArIDJdID09PSBNYXRoLmZyb3VuZCh0aGlzLl9iKQogICAgICAgIH0KICAgICAgICBtdWx0aXBseShjKSB7CiAgICAgICAgICAgIHRoaXMuX3IgKj0KICAgICAgICAgICAgICAgIGMuX3I7CiAgICAgICAgICAgIHRoaXMuX2cgKj0gYy5fZzsKICAgICAgICAgICAgdGhpcy5fYiAqPSBjLl9iOwogICAgICAgICAgICB0aGlzLl9hICo9IGMuX2EKICAgICAgICB9CiAgICAgICAgbXVsdGlwbHlBbHBoYShhKSB7CiAgICAgICAgICAgIHRoaXMuX3IgKj0gYTsKICAgICAgICAgICAgdGhpcy5fZyAqPSBhOwogICAgICAgICAgICB0aGlzLl9iICo9IGE7CiAgICAgICAgICAgIHRoaXMuX2EgKj0gYQogICAgICAgIH0KICAgICAgICBwcmVtdWx0aXBseSgpIHsKICAgICAgICAgICAgdGhpcy5fciAqPSB0aGlzLl9hOwogICAgICAgICAgICB0aGlzLl9nICo9IHRoaXMuX2E7CiAgICAgICAgICAgIHRoaXMuX2IgKj0gdGhpcy5fYTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgICB9CiAgICAgICAgdW5wcmVtdWx0aXBseSgpIHsKICAgICAgICAgICAgdGhpcy5fciAvPSB0aGlzLl9hOwogICAgICAgICAgICB0aGlzLl9nIC89IHRoaXMuX2E7CiAgICAgICAgICAgIHRoaXMuX2IgLz0gdGhpcy5fYTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgICB9CiAgICAgICAgY2xhbXAoKSB7CiAgICAgICAgICAgIHRoaXMuX3IgPSBDMy5jbGFtcCh0aGlzLl9yLCAwLCAxKTsKICAgICAgICAgICAgdGhpcy5fZyA9IEMzLmNsYW1wKHRoaXMuX2csIDAsIDEpOwogICAgICAgICAgICB0aGlzLl9iID0gQzMuY2xhbXAodGhpcy5fYiwgMCwgMSk7CiAgICAgICAgICAgIHRoaXMuX2EgPSBDMy5jbGFtcCh0aGlzLl9hLCAwLCAxKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgICB9CiAgICAgICAgc2V0RnJvbVJnYlZhbHVlKHJnYikgewogICAgICAgICAgICB0aGlzLl9yID0gQzMuR2V0UlZhbHVlKHJnYik7CiAgICAgICAgICAgIHRoaXMuX2cgPSBDMy5HZXRHVmFsdWUocmdiKTsKICAgICAgICAgICAgdGhpcy5fYiA9IEMzLkdldEJWYWx1ZShyZ2IpOwogICAgICAgICAgICB0aGlzLl9hID0gQzMuR2V0QVZhbHVlKHJnYikKICAgICAgICB9CiAgICAgICAgZ2V0Q3NzUmdiKF9yLCBfZywgX2IpIHsKICAgICAgICAgICAgY29uc3QgciA9IEMzLklzRmluaXRlTnVtYmVyKF9yKSA/IF9yIDogdGhpcy5nZXRSKCk7CiAgICAgICAgICAgIGNvbnN0IGcgPSBDMy5Jc0Zpbml0ZU51bWJlcihfZykgPyBfZyA6IHRoaXMuZ2V0RygpOwogICAgICAgICAgICBjb25zdCBiID0gQzMuSXNGaW5pdGVOdW1iZXIoX2IpID8gX2IgOiB0aGlzLmdldEIoKTsKICAgICAgICAgICAgcmV0dXJuIGByZ2IoJHtyKjEwMH0lLCAke2cqMTAwfSUsICR7YioxMDB9JSlgCiAgICAgICAgfQogICAgICAgIGdldENzc1JnYmEoX3IsIF9nLCBfYiwgX2EpIHsKICAgICAgICAgICAgY29uc3QgciA9IEMzLklzRmluaXRlTnVtYmVyKF9yKSA/IF9yIDogdGhpcy5nZXRSKCk7CiAgICAgICAgICAgIGNvbnN0IGcgPSBDMy5Jc0Zpbml0ZU51bWJlcihfZykgPyBfZyA6IHRoaXMuZ2V0RygpOwogICAgICAgICAgICBjb25zdCBiID0gQzMuSXNGaW5pdGVOdW1iZXIoX2IpID8gX2IgOiB0aGlzLmdldEIoKTsKICAgICAgICAgICAgY29uc3QgYSA9IEMzLklzRmluaXRlTnVtYmVyKF9hKSA/IF9hIDogdGhpcy5nZXRBKCk7CiAgICAgICAgICAgIHJldHVybiBgcmdiYSgke3IqMTAwfSUsICR7ZyoxMDB9JSwgJHtiKjEwMH0lLCAke2F9KWAKICAgICAgICB9CiAgICAgICAgdG9IZXhTdHJpbmcoKSB7CiAgICAgICAgICAgIGNvbnN0IHJoID0KICAgICAgICAgICAgICAgIE1hdGgucm91bmQodGhpcy5nZXRSKCkgKiAyNTUpOwogICAgICAgICAgICBjb25zdCBnaCA9IE1hdGgucm91bmQodGhpcy5nZXRHKCkgKiAyNTUpOwogICAgICAgICAgICBjb25zdCBiaCA9IE1hdGgucm91bmQodGhpcy5nZXRCKCkgKiAyNTUpOwogICAgICAgICAgICByZXR1cm4gIiMiICsgcGFkVHdvRGlnaXRzKHJoLnRvU3RyaW5nKDE2KSkgKyBwYWRUd29EaWdpdHMoZ2gudG9TdHJpbmcoMTYpKSArIHBhZFR3b0RpZ2l0cyhiaC50b1N0cmluZygxNikpCiAgICAgICAgfQogICAgICAgIHBhcnNlSGV4U3RyaW5nKHN0cikgewogICAgICAgICAgICBpZiAodHlwZW9mIHN0ciAhPT0gInN0cmluZyIpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgc3RyID0gc3RyLnRyaW0oKTsKICAgICAgICAgICAgaWYgKHN0ci5jaGFyQXQoMCkgPT09ICIjIikgc3RyID0gc3RyLnN1YnN0cigxKTsKICAgICAgICAgICAgbGV0IHJ2OwogICAgICAgICAgICBsZXQgZ3Y7CiAgICAgICAgICAgIGxldCBidjsKICAgICAgICAgICAgaWYgKHN0ci5sZW5ndGggPT09IDMpIHsKICAgICAgICAgICAgICAgIHJ2ID0gcGFyc2VJbnQoc3RyWzBdLCAxNikgLyAxNTsKICAgICAgICAgICAgICAgIGd2ID0gcGFyc2VJbnQoc3RyWzFdLCAxNikgLyAxNTsKICAgICAgICAgICAgICAgIGJ2ID0gcGFyc2VJbnQoc3RyWzJdLCAxNikgLyAxNQogICAgICAgICAgICB9IGVsc2UgaWYgKHN0ci5sZW5ndGggPT09IDYpIHsKICAgICAgICAgICAgICAgIHJ2ID0gcGFyc2VJbnQoc3RyLnN1YnN0cigwLCAyKSwgMTYpIC8gMjU1OwogICAgICAgICAgICAgICAgZ3YgPSBwYXJzZUludChzdHIuc3Vic3RyKDIsCiAgICAgICAgICAgICAgICAgICAgMiksIDE2KSAvIDI1NTsKICAgICAgICAgICAgICAgIGJ2ID0gcGFyc2VJbnQoc3RyLnN1YnN0cig0LCAyKSwgMTYpIC8gMjU1CiAgICAgICAgICAgIH0gZWxzZSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGlmIChpc0Zpbml0ZShydikpIHRoaXMuc2V0Uihydik7CiAgICAgICAgICAgIGlmIChpc0Zpbml0ZShndikpIHRoaXMuc2V0Ryhndik7CiAgICAgICAgICAgIGlmIChpc0Zpbml0ZShidikpIHRoaXMuc2V0Qihidik7CiAgICAgICAgICAgIHRoaXMuc2V0QSgxKTsKICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICB9CiAgICAgICAgdG9Db21tYVNlcGFyYXRlZFJnYigpIHsKICAgICAgICAgICAgY29uc3QgcnYgPSBNYXRoLnJvdW5kKHRoaXMuZ2V0UigpICogMjU1KTsKICAgICAgICAgICAgY29uc3QgZ3YgPSBNYXRoLnJvdW5kKHRoaXMuZ2V0RygpICogMjU1KTsKICAgICAgICAgICAgY29uc3QgYnYgPSBNYXRoLnJvdW5kKHRoaXMuZ2V0QigpICogMjU1KTsKICAgICAgICAgICAgcmV0dXJuIGAke3J2fSwgJHtndn0sICR7YnZ9YAogICAgICAgIH0KICAgICAgICB0b1JnYkFycmF5KCkgewogICAgICAgICAgICBjb25zdCBydiA9IE1hdGgucm91bmQodGhpcy5nZXRSKCkgKiAyNTUpOwogICAgICAgICAgICBjb25zdCBndiA9IE1hdGgucm91bmQodGhpcy5nZXRHKCkgKiAyNTUpOwogICAgICAgICAgICBjb25zdCBidiA9IE1hdGgucm91bmQodGhpcy5nZXRCKCkgKiAyNTUpOwogICAgICAgICAgICByZXR1cm4gW3J2LCBndiwgYnZdCiAgICAgICAgfQogICAgICAgIHBhcnNlQ29tbWFTZXBhcmF0ZWRSZ2Ioc3RyKSB7CiAgICAgICAgICAgIGlmICh0eXBlb2Ygc3RyICE9PQogICAgICAgICAgICAgICAgInN0cmluZyIpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgc3RyID0gc3RyLnJlcGxhY2UoL15yZ2JcKHxcKXwlLywgIiIpOwogICAgICAgICAgICBjb25zdCBhcnIgPSBzdHIuc3BsaXQoIiwiKTsKICAgICAgICAgICAgaWYgKGFyci5sZW5ndGggPCAzKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGNvbnN0IHJ2ID0gcGFyc2VJbnQoYXJyWzBdLnRyaW0oKSwgMTApIC8gMjU1OwogICAgICAgICAgICBjb25zdCBndiA9IHBhcnNlSW50KGFyclsxXS50cmltKCksIDEwKSAvIDI1NTsKICAgICAgICAgICAgY29uc3QgYnYgPSBwYXJzZUludChhcnJbMl0udHJpbSgpLCAxMCkgLyAyNTU7CiAgICAgICAgICAgIGlmIChpc0Zpbml0ZShydikpIHRoaXMuc2V0Uihydik7CiAgICAgICAgICAgIGlmIChpc0Zpbml0ZShndikpIHRoaXMuc2V0Ryhndik7CiAgICAgICAgICAgIGlmIChpc0Zpbml0ZShidikpIHRoaXMuc2V0Qihidik7CiAgICAgICAgICAgIHRoaXMuc2V0QSgxKTsKICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICB9CiAgICAgICAgcGFyc2VDb21tYVNlcGFyYXRlZFBlcmNlbnRhZ2VSZ2Ioc3RyKSB7CiAgICAgICAgICAgIGlmICh0eXBlb2Ygc3RyICE9PSAic3RyaW5nIikgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBzdHIgPSBzdHIucmVwbGFjZSgvXnJnYlwofFwpfCUvLCAiIik7CiAgICAgICAgICAgIGNvbnN0IGFyciA9IHN0ci5zcGxpdCgiLCIpOwogICAgICAgICAgICBpZiAoYXJyLmxlbmd0aCA8IDMpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgY29uc3QgcnYgPSBwYXJzZUludChhcnJbMF0udHJpbSgpLCAxMCkgLyAxMDA7CiAgICAgICAgICAgIGNvbnN0IGd2ID0gcGFyc2VJbnQoYXJyWzFdLnRyaW0oKSwgMTApIC8gMTAwOwogICAgICAgICAgICBjb25zdCBidiA9IHBhcnNlSW50KGFyclsyXS50cmltKCksIDEwKSAvIDEwMDsKICAgICAgICAgICAgaWYgKGlzRmluaXRlKHJ2KSkgdGhpcy5zZXRSKHJ2KTsKICAgICAgICAgICAgaWYgKGlzRmluaXRlKGd2KSkgdGhpcy5zZXRHKGd2KTsKICAgICAgICAgICAgaWYgKGlzRmluaXRlKGJ2KSkgdGhpcy5zZXRCKGJ2KTsKICAgICAgICAgICAgdGhpcy5zZXRBKDEpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgIH0KICAgICAgICBwYXJzZUNvbW1hU2VwYXJhdGVkUmdiYShzdHIpIHsKICAgICAgICAgICAgaWYgKHR5cGVvZiBzdHIgIT09ICJzdHJpbmciKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIHN0ciA9IHN0ci5yZXBsYWNlKC9ecmdiYVwofFwpfCUvLCAiIik7CiAgICAgICAgICAgIGNvbnN0IGFyciA9IHN0ci5zcGxpdCgiLCIpOwogICAgICAgICAgICBpZiAoYXJyLmxlbmd0aCA8IDQpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgY29uc3QgcnYgPSBwYXJzZUludChhcnJbMF0udHJpbSgpLCAxMCkgLyAyNTU7CiAgICAgICAgICAgIGNvbnN0IGd2ID0gcGFyc2VJbnQoYXJyWzFdLnRyaW0oKSwgMTApIC8gMjU1OwogICAgICAgICAgICBjb25zdCBidiA9IHBhcnNlSW50KGFyclsyXS50cmltKCksCiAgICAgICAgICAgICAgICAxMCkgLyAyNTU7CiAgICAgICAgICAgIGNvbnN0IGF2ID0gcGFyc2VGbG9hdChhcnJbM10udHJpbSgpKTsKICAgICAgICAgICAgaWYgKGlzRmluaXRlKHJ2KSkgdGhpcy5zZXRSKHJ2KTsKICAgICAgICAgICAgaWYgKGlzRmluaXRlKGd2KSkgdGhpcy5zZXRHKGd2KTsKICAgICAgICAgICAgaWYgKGlzRmluaXRlKGJ2KSkgdGhpcy5zZXRCKGJ2KTsKICAgICAgICAgICAgaWYgKGlzRmluaXRlKGF2KSkgdGhpcy5zZXRBKGF2KTsKICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICB9CiAgICAgICAgcGFyc2VDb21tYVNlcGFyYXRlZFBlcmNlbnRhZ2VSZ2JhKHN0cikgewogICAgICAgICAgICBpZiAodHlwZW9mIHN0ciAhPT0gInN0cmluZyIpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgc3RyID0gc3RyLnJlcGxhY2UoL15yZ2JhXCh8XCl8JS8sICIiKTsKICAgICAgICAgICAgY29uc3QgYXJyID0gc3RyLnNwbGl0KCIsIik7CiAgICAgICAgICAgIGlmIChhcnIubGVuZ3RoIDwgNCkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBjb25zdCBydiA9IHBhcnNlSW50KGFyclswXS50cmltKCksIDEwKSAvIDEwMDsKICAgICAgICAgICAgY29uc3QgZ3YgPSBwYXJzZUludChhcnJbMV0udHJpbSgpLCAxMCkgLyAxMDA7CiAgICAgICAgICAgIGNvbnN0IGJ2ID0gcGFyc2VJbnQoYXJyWzJdLnRyaW0oKSwgMTApIC8gMTAwOwogICAgICAgICAgICBjb25zdCBhdiA9IHBhcnNlRmxvYXQoYXJyWzNdLnRyaW0oKSk7CiAgICAgICAgICAgIGlmIChpc0Zpbml0ZShydikpIHRoaXMuc2V0Uihydik7CiAgICAgICAgICAgIGlmIChpc0Zpbml0ZShndikpIHRoaXMuc2V0Ryhndik7CiAgICAgICAgICAgIGlmIChpc0Zpbml0ZShidikpIHRoaXMuc2V0Qihidik7CiAgICAgICAgICAgIGlmIChpc0Zpbml0ZShhdikpIHRoaXMuc2V0QShhdik7CiAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgfQogICAgICAgIHBhcnNlU3RyaW5nKHN0cikgewogICAgICAgICAgICBpZiAodHlwZW9mIHN0ciAhPT0gInN0cmluZyIpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgc3RyID0gc3RyLnJlcGxhY2UoL1xzKy8sICIiKTsKICAgICAgICAgICAgaWYgKHN0ci5pbmNsdWRlcygiLCIpKQogICAgICAgICAgICAgICAgaWYgKHN0ci5zdGFydHNXaXRoKCJyZ2IoIikpCiAgICAgICAgICAgICAgICAgICAgaWYgKHN0ci5pbmNsdWRlcygiJSIpKSByZXR1cm4gdGhpcy5wYXJzZUNvbW1hU2VwYXJhdGVkUGVyY2VudGFnZVJnYihzdHIpOwogICAgICAgICAgICAgICAgICAgIGVsc2UgcmV0dXJuIHRoaXMucGFyc2VDb21tYVNlcGFyYXRlZFJnYihzdHIpOwogICAgICAgICAgICBlbHNlIGlmIChzdHIuc3RhcnRzV2l0aCgicmdiYSgiKSkKICAgICAgICAgICAgICAgIGlmIChzdHIuaW5jbHVkZXMoIiUiKSkgcmV0dXJuIHRoaXMucGFyc2VDb21tYVNlcGFyYXRlZFBlcmNlbnRhZ2VSZ2JhKHN0cik7CiAgICAgICAgICAgICAgICBlbHNlIHJldHVybiB0aGlzLnBhcnNlQ29tbWFTZXBhcmF0ZWRSZ2JhKHN0cik7CiAgICAgICAgICAgIGVsc2UgaWYgKHN0ci5zdGFydHNXaXRoKCJoc2woIikgfHwKICAgICAgICAgICAgICAgIHN0ci5zdGFydHNXaXRoKCJoc2xhKCIpKSByZXR1cm4gdGhpcy5wYXJzZUhTTFN0cmluZyhzdHIpOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbnN0IGNvbXBvbmVudHMgPSBzdHIuc3BsaXQoIiwiKTsKICAgICAgICAgICAgICAgIGlmIChzdHIuaW5jbHVkZXMoIiUiKSkgewogICAgICAgICAgICAgICAgICAgIGlmIChjb21wb25lbnRzLmxlbmd0aCA9PT0gMykgcmV0dXJuIHRoaXMucGFyc2VDb21tYVNlcGFyYXRlZFBlcmNlbnRhZ2VSZ2Ioc3RyKTsKICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChjb21wb25lbnRzLmxlbmd0aCA9PT0gNCkgcmV0dXJuIHRoaXMucGFyc2VDb21tYVNlcGFyYXRlZFBlcmNlbnRhZ2VSZ2JhKHN0cik7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGlmIChjb21wb25lbnRzLmxlbmd0aCA9PT0gMykgcmV0dXJuIHRoaXMucGFyc2VDb21tYVNlcGFyYXRlZFJnYihzdHIpOwogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGNvbXBvbmVudHMubGVuZ3RoID09PSA0KSByZXR1cm4gdGhpcy5wYXJzZUNvbW1hU2VwYXJhdGVkUmdiYShzdHIpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgcmV0dXJuIHRoaXMucGFyc2VIZXhTdHJpbmcoc3RyKQogICAgICAgIH0KICAgICAgICB0b0pTT04oKSB7CiAgICAgICAgICAgIHJldHVybiBbdGhpcy5fciwgdGhpcy5fZywKICAgICAgICAgICAgICAgIHRoaXMuX2IsIHRoaXMuX2EKICAgICAgICAgICAgXQogICAgICAgIH0KICAgICAgICBzZXRGcm9tSFNMQShoLCBzLCBsLCBhKSB7CiAgICAgICAgICAgIGxldCByOwogICAgICAgICAgICBsZXQgZzsKICAgICAgICAgICAgbGV0IGI7CiAgICAgICAgICAgIGggJT0gMzYwOwogICAgICAgICAgICBzID0gQzMuY2xhbXAocywgMCwgMTAwKTsKICAgICAgICAgICAgbCA9IEMzLmNsYW1wKGwsIDAsIDEwMCk7CiAgICAgICAgICAgIGEgPSBDMy5jbGFtcChhLCAwLCAxKTsKICAgICAgICAgICAgaCAvPSAzNjA7CiAgICAgICAgICAgIHMgLz0gMTAwOwogICAgICAgICAgICBsIC89IDEwMDsKICAgICAgICAgICAgaWYgKHMgPT09IDApIHIgPSBnID0gYiA9IGw7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgY29uc3QgcSA9IGwgPCAuNSA/IGwgKiAoMSArIHMpIDogbCArIHMgLSBsICogczsKICAgICAgICAgICAgICAgIGNvbnN0IHAgPSAyICogbCAtIHE7CiAgICAgICAgICAgICAgICByID0gaHVlVG9SR0IocCwgcSwgaCArIDEgLyAzKTsKICAgICAgICAgICAgICAgIGcgPSBodWVUb1JHQihwLCBxLCBoKTsKICAgICAgICAgICAgICAgIGIgPSBodWVUb1JHQihwLCBxLCBoIC0gMSAvIDMpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5zZXRSKHIpOwogICAgICAgICAgICB0aGlzLnNldEcoZyk7CiAgICAgICAgICAgIHRoaXMuc2V0QihiKTsKICAgICAgICAgICAgdGhpcy5zZXRBKGEpOwogICAgICAgICAgICByZXR1cm4gdGhpcwogICAgICAgIH0KICAgICAgICBwYXJzZUhTTFN0cmluZyhzdHIpIHsKICAgICAgICAgICAgY29uc3QgY2xlYW5TdHJpbmcgPSBzdHIucmVwbGFjZSgvIHxoc2x8aHNsYXxcKHxcKXw7L2dpLCAiIik7CiAgICAgICAgICAgIGNvbnN0IGhzbCA9IEhTTF9URVNULmV4ZWMoY2xlYW5TdHJpbmcpOwogICAgICAgICAgICBjb25zdCBoc2xhID0gSFNMQV9URVNULmV4ZWMoY2xlYW5TdHJpbmcpOwogICAgICAgICAgICBpZiAoaHNsICYmIGhzbC5sZW5ndGggPT09CiAgICAgICAgICAgICAgICA0KSB7CiAgICAgICAgICAgICAgICB0aGlzLnNldEZyb21IU0xBKCtoc2xbMV0sICtoc2xbMl0sICtoc2xbM10sIDEpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICAgICAgfSBlbHNlIGlmIChoc2xhICYmIGhzbGEubGVuZ3RoID09PSA1KSB7CiAgICAgICAgICAgICAgICB0aGlzLnNldEZyb21IU0xBKCtoc2xbMV0sICtoc2xbMl0sICtoc2xbM10sICtoc2xbNF0pOwogICAgICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICB9CiAgICAgICAgdG9IU0xBU3RyaW5nKCkgewogICAgICAgICAgICBjb25zdCByID0gdGhpcy5fcjsKICAgICAgICAgICAgY29uc3QgZyA9IHRoaXMuX2c7CiAgICAgICAgICAgIGNvbnN0IGIgPSB0aGlzLl9iOwogICAgICAgICAgICBjb25zdCBhID0gdGhpcy5fYTsKICAgICAgICAgICAgY29uc3QgaCA9IEMzLkNvbG9yLkdldEh1ZShyLCBnLCBiKTsKICAgICAgICAgICAgY29uc3QgcyA9IEMzLkNvbG9yLkdldFNhdHVyYXRpb24ociwgZywgYik7CiAgICAgICAgICAgIGNvbnN0IGwgPSBDMy5Db2xvci5HZXRMdW1pbm9zaXR5KHIsIGcsIGIpOwogICAgICAgICAgICByZXR1cm4gYGhzbGEoJHtofSwgJHtzfSUsICR7bH0lLCAke2F9KWAKICAgICAgICB9CiAgICAgICAgdG9IU0xBQXJyYXkoKSB7CiAgICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLl9yOwogICAgICAgICAgICBjb25zdCBnID0gdGhpcy5fZzsKICAgICAgICAgICAgY29uc3QgYiA9IHRoaXMuX2I7CiAgICAgICAgICAgIHJldHVybiBbQzMuQ29sb3IuR2V0SHVlKHIsIGcsIGIpLCBDMy5Db2xvci5HZXRTYXR1cmF0aW9uKHIsCiAgICAgICAgICAgICAgICBnLCBiKSwgQzMuQ29sb3IuR2V0THVtaW5vc2l0eShyLCBnLCBiKSwgdGhpcy5fYV0KICAgICAgICB9CiAgICAgICAgc2V0RnJvbUpTT04oYXJyKSB7CiAgICAgICAgICAgIGlmICghQXJyYXkuaXNBcnJheShhcnIpKSByZXR1cm47CiAgICAgICAgICAgIGlmIChhcnIubGVuZ3RoIDwgMykgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl9yID0gYXJyWzBdOwogICAgICAgICAgICB0aGlzLl9nID0gYXJyWzFdOwogICAgICAgICAgICB0aGlzLl9iID0gYXJyWzJdOwogICAgICAgICAgICBpZiAoYXJyLmxlbmd0aCA+PSA0KSB0aGlzLl9hID0gYXJyWzNdOwogICAgICAgICAgICBlbHNlIHRoaXMuX2EgPSAxCiAgICAgICAgfQogICAgICAgIHNldCByKHIpIHsKICAgICAgICAgICAgdGhpcy5zZXRSKHIpCiAgICAgICAgfQogICAgICAgIGdldCByKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRSKCkKICAgICAgICB9CiAgICAgICAgc2V0IGcoZykgewogICAgICAgICAgICB0aGlzLnNldEcoZykKICAgICAgICB9CiAgICAgICAgZ2V0IGcoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldEcoKQogICAgICAgIH0KICAgICAgICBzZXQgYihiKSB7CiAgICAgICAgICAgIHRoaXMuc2V0QihiKQogICAgICAgIH0KICAgICAgICBnZXQgYigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0QigpCiAgICAgICAgfQogICAgICAgIHNldCBhKGEpIHsKICAgICAgICAgICAgdGhpcy5zZXRBKGEpCiAgICAgICAgfQogICAgICAgIGdldCBhKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRBKCkKICAgICAgICB9CiAgICAgICAgc2V0QXRJbmRleChpLCB2KSB7CiAgICAgICAgICAgIHN3aXRjaCAoaSkgewogICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0Uih2KTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEcodik7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRCKHYpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0QSh2KTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoImludmFsaWQgY29sb3IgaW5kZXgiKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBnZXRBdEluZGV4KGkpIHsKICAgICAgICAgICAgc3dpdGNoIChpKSB7CiAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0UigpOwogICAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldEcoKTsKICAgICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRCKCk7CiAgICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0QSgpOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcigiaW52YWxpZCBjb2xvciBpbmRleCIpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHN0YXRpYyBFcXVhbHMoY29sb3Jfb3JfanNvbl8xLCBjb2xvcl9vcl9qc29uXzIpIHsKICAgICAgICAgICAgbGV0IGMxOwogICAgICAgICAgICBsZXQgYzI7CiAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGNvbG9yX29yX2pzb25fMSkpIHsKICAgICAgICAgICAgICAgIGMxID0gbmV3IEMzLkNvbG9yOwogICAgICAgICAgICAgICAgYzEuc2V0RnJvbUpTT04oY29sb3Jfb3JfanNvbl8xKQogICAgICAgICAgICB9IGVsc2UgaWYgKGNvbG9yX29yX2pzb25fMSBpbnN0YW5jZW9mIEMzLkNvbG9yKSBjMSA9IGNvbG9yX29yX2pzb25fMTsKICAgICAgICAgICAgZWxzZSB0aHJvdyBuZXcgRXJyb3IoInVuZXhwZWN0ZWQgdHlwZSIpOwogICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShjb2xvcl9vcl9qc29uXzIpKSB7CiAgICAgICAgICAgICAgICBjMiA9IG5ldyBDMy5Db2xvcjsKICAgICAgICAgICAgICAgIGMyLnNldEZyb21KU09OKGNvbG9yX29yX2pzb25fMikKICAgICAgICAgICAgfSBlbHNlIGlmIChjb2xvcl9vcl9qc29uXzIgaW5zdGFuY2VvZiBDMy5Db2xvcikgYzIgPSBjb2xvcl9vcl9qc29uXzI7CiAgICAgICAgICAgIGVsc2UgdGhyb3cgbmV3IEVycm9yKCJ1bmV4cGVjdGVkIHR5cGUiKTsKICAgICAgICAgICAgcmV0dXJuIGMxLmVxdWFscyhjMikKICAgICAgICB9CiAgICAgICAgc3RhdGljIERpZmZDaGFubmVsKGNoYW5uZWwxLCBjaGFubmVsMikgewogICAgICAgICAgICByZXR1cm4gQzMuY2xhbXAoTWF0aC5tYXgoY2hhbm5lbDEsIGNoYW5uZWwyKSAtIE1hdGgubWluKGNoYW5uZWwxLCBjaGFubmVsMiksIDAsIDEpCiAgICAgICAgfQogICAgICAgIHN0YXRpYyBEaWZmKGMxLCBjMikgewogICAgICAgICAgICBjb25zdCByZXQgPSBuZXcgQzMuQ29sb3I7CiAgICAgICAgICAgIHJldC5zZXRSKE1hdGgubWF4KGMxLl9yLCBjMi5fcikgLSBNYXRoLm1pbihjMS5fciwgYzIuX3IpKTsKICAgICAgICAgICAgcmV0LnNldEcoTWF0aC5tYXgoYzEuX2csIGMyLl9nKSAtIE1hdGgubWluKGMxLl9nLCBjMi5fZykpOwogICAgICAgICAgICByZXQuc2V0QihNYXRoLm1heChjMS5fYiwgYzIuX2IpIC0KICAgICAgICAgICAgICAgIE1hdGgubWluKGMxLl9iLCBjMi5fYikpOwogICAgICAgICAgICByZXQuc2V0QShNYXRoLm1heChjMS5fYSwgYzIuX2EpIC0gTWF0aC5taW4oYzEuX2EsIGMyLl9hKSk7CiAgICAgICAgICAgIHJldHVybiByZXQKICAgICAgICB9CiAgICAgICAgc3RhdGljIERpZmZOb0FscGhhKGMxLCBjMikgewogICAgICAgICAgICBjb25zdCByZXQgPSBuZXcgQzMuQ29sb3IoMCwgMCwgMCwgMSk7CiAgICAgICAgICAgIHJldC5zZXRSKE1hdGgubWF4KGMxLl9yLCBjMi5fcikgLSBNYXRoLm1pbihjMS5fciwgYzIuX3IpKTsKICAgICAgICAgICAgcmV0LnNldEcoTWF0aC5tYXgoYzEuX2csIGMyLl9nKSAtIE1hdGgubWluKGMxLl9nLCBjMi5fZykpOwogICAgICAgICAgICByZXQuc2V0QihNYXRoLm1heChjMS5fYiwgYzIuX2IpIC0gTWF0aC5taW4oYzEuX2IsIGMyLl9iKSk7CiAgICAgICAgICAgIHJldHVybiByZXQKICAgICAgICB9CiAgICAgICAgc3RhdGljIEdldEh1ZShyLCBnLCBiKSB7CiAgICAgICAgICAgIGNvbnN0IG1heCA9IE1hdGgubWF4KHIsIGcsIGIpOwogICAgICAgICAgICBjb25zdCBtaW4gPSBNYXRoLm1pbihyLCBnLCBiKTsKICAgICAgICAgICAgaWYgKG1heCA9PT0gbWluKSByZXR1cm4gMDsKICAgICAgICAgICAgbGV0IGggPSAwOwogICAgICAgICAgICBzd2l0Y2ggKG1heCkgewogICAgICAgICAgICAgICAgY2FzZSByOgogICAgICAgICAgICAgICAgICAgIGggPSAoZyAtIGIpIC8gKG1heCAtIG1pbikgKyAoZyA8IGIgPyA2IDogMCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIGc6CiAgICAgICAgICAgICAgICAgICAgaCA9IChiIC0gcikgLyAobWF4IC0gbWluKSArIDI7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIGI6CiAgICAgICAgICAgICAgICAgICAgaCA9IChyIC0gZykgLyAobWF4IC0gbWluKSArIDQ7CiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gTWF0aC5yb3VuZChoIC8gNiAqIDM2MCkKICAgICAgICB9CiAgICAgICAgc3RhdGljIEdldFNhdHVyYXRpb24ociwgZywgYikgewogICAgICAgICAgICBjb25zdCBtYXggPSBNYXRoLm1heChyLCBnLCBiKTsKICAgICAgICAgICAgY29uc3QgbWluID0gTWF0aC5taW4ociwgZywgYik7CiAgICAgICAgICAgIGlmIChtYXggPT09IG1pbikgcmV0dXJuIDA7CiAgICAgICAgICAgIGNvbnN0IGwgPSAobWF4ICsgbWluKSAvIDI7CiAgICAgICAgICAgIGNvbnN0IGQgPSBtYXggLSBtaW47CiAgICAgICAgICAgIGNvbnN0IHMgPSBsID4gLjUgPyBkIC8gKDIgLSBtYXggLSBtaW4pIDogZCAvIChtYXggKyBtaW4pOwogICAgICAgICAgICByZXR1cm4gTWF0aC5yb3VuZChzICogMTAwKQogICAgICAgIH0KICAgICAgICBzdGF0aWMgR2V0THVtaW5vc2l0eShyLCBnLCBiKSB7CiAgICAgICAgICAgIGNvbnN0IG1heCA9IE1hdGgubWF4KHIsIGcsIGIpOwogICAgICAgICAgICBjb25zdCBtaW4gPSBNYXRoLm1pbihyLCBnLCBiKTsKICAgICAgICAgICAgY29uc3QgbCA9IChtYXggKyBtaW4pIC8gMjsKICAgICAgICAgICAgaWYgKCFtYXgpIHJldHVybiAwOwogICAgICAgICAgICByZXR1cm4gTWF0aC5yb3VuZChsICogMTAwKQogICAgICAgIH0KICAgIH07CiAgICBDMy5Db2xvci5XaGl0ZSA9IE9iamVjdC5mcmVlemUoQzMuTmV3KEMzLkNvbG9yLCAxLCAxLCAxLCAxKSk7CiAgICBDMy5Db2xvci5CbGFjayA9IE9iamVjdC5mcmVlemUoQzMuTmV3KEMzLkNvbG9yLCAwLCAwLCAwLCAxKSk7CiAgICBDMy5Db2xvci5UcmFuc3BhcmVudEJsYWNrID0gT2JqZWN0LmZyZWV6ZShDMy5OZXcoQzMuQ29sb3IsIDAsIDAsIDAsIDApKTsKCn0KCi8vIC4uL2xpYi9taXNjL3ZlY3RvcjIuanMKewogICAgJ3VzZSBzdHJpY3QnOwogICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgQzMuVmVjdG9yMiA9IGNsYXNzIFZlY3RvcjIgewogICAgICAgIGNvbnN0cnVjdG9yKHgsIHkpIHsKICAgICAgICAgICAgdGhpcy5feCA9IDA7CiAgICAgICAgICAgIHRoaXMuX3kgPSAwOwogICAgICAgICAgICBpZiAoeCBpbnN0YW5jZW9mIEMzLlZlY3RvcjIpIHRoaXMuY29weSh4KTsKICAgICAgICAgICAgZWxzZSB0aGlzLnNldCh4IHx8IDAsIHkgfHwgMCkKICAgICAgICB9CiAgICAgICAgc2V0KHgsIHkpIHsKICAgICAgICAgICAgdGhpcy5feCA9ICt4OwogICAgICAgICAgICB0aGlzLl95ID0gK3kKICAgICAgICB9CiAgICAgICAgY29weSh2KSB7CiAgICAgICAgICAgIHRoaXMuX3ggPSB2Ll94OwogICAgICAgICAgICB0aGlzLl95ID0gdi5feQogICAgICAgIH0KICAgICAgICBlcXVhbHModikgewogICAgICAgICAgICByZXR1cm4gdGhpcy5feCA9PT0gdi5feCAmJiB0aGlzLl95ID09PSB2Ll95CiAgICAgICAgfQogICAgICAgIGVxdWFsc1ZhbHVlcyh4LCB5KSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl94ID09PSB4ICYmIHRoaXMuX3kgPT09IHkKICAgICAgICB9CiAgICAgICAgZXF1YWxzRjMyQXJyYXkoYXJyLCBvZmZzZXQpIHsKICAgICAgICAgICAgcmV0dXJuIGFycltvZmZzZXRdID09PSBNYXRoLmZyb3VuZCh0aGlzLl94KSAmJiBhcnJbb2Zmc2V0ICsgMV0gPT09IE1hdGguZnJvdW5kKHRoaXMuX3kpCiAgICAgICAgfQogICAgICAgIHNldFgoeCkgewogICAgICAgICAgICB0aGlzLl94ID0gK3gKICAgICAgICB9CiAgICAgICAgZ2V0WCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3gKICAgICAgICB9CiAgICAgICAgc2V0WSh5KSB7CiAgICAgICAgICAgIHRoaXMuX3kgPSAreQogICAgICAgIH0KICAgICAgICBnZXRZKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5feQogICAgICAgIH0KICAgICAgICB0b0FycmF5KCkgewogICAgICAgICAgICByZXR1cm4gW3RoaXMuX3gsIHRoaXMuX3ldCiAgICAgICAgfQogICAgICAgIHRvVHlwZWRBcnJheSgpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBGbG9hdDY0QXJyYXkodGhpcy50b0FycmF5KCkpCiAgICAgICAgfQogICAgICAgIHdyaXRlVG9UeXBlZEFycmF5KHRhLAogICAgICAgICAgICBpKSB7CiAgICAgICAgICAgIHRhW2krK10gPSB0aGlzLl94OwogICAgICAgICAgICB0YVtpXSA9IHRoaXMuX3kKICAgICAgICB9CiAgICAgICAgb2Zmc2V0KHgsIHkpIHsKICAgICAgICAgICAgdGhpcy5feCArPSAreDsKICAgICAgICAgICAgdGhpcy5feSArPSAreQogICAgICAgIH0KICAgICAgICBzY2FsZSh4LCB5KSB7CiAgICAgICAgICAgIHRoaXMuX3ggKj0geDsKICAgICAgICAgICAgdGhpcy5feSAqPSB5CiAgICAgICAgfQogICAgICAgIGRpdmlkZSh4LCB5KSB7CiAgICAgICAgICAgIHRoaXMuX3ggLz0geDsKICAgICAgICAgICAgdGhpcy5feSAvPSB5CiAgICAgICAgfQogICAgICAgIHJvdW5kKCkgewogICAgICAgICAgICB0aGlzLl94ID0gTWF0aC5yb3VuZCh0aGlzLl94KTsKICAgICAgICAgICAgdGhpcy5feSA9IE1hdGgucm91bmQodGhpcy5feSkKICAgICAgICB9CiAgICAgICAgZmxvb3IoKSB7CiAgICAgICAgICAgIHRoaXMuX3ggPSBNYXRoLmZsb29yKHRoaXMuX3gpOwogICAgICAgICAgICB0aGlzLl95ID0gTWF0aC5mbG9vcih0aGlzLl95KQogICAgICAgIH0KICAgICAgICBjZWlsKCkgewogICAgICAgICAgICB0aGlzLl94ID0gTWF0aC5jZWlsKHRoaXMuX3gpOwogICAgICAgICAgICB0aGlzLl95ID0gTWF0aC5jZWlsKHRoaXMuX3kpCiAgICAgICAgfQogICAgICAgIGFuZ2xlKCkgewogICAgICAgICAgICByZXR1cm4gQzMuYW5nbGVUbygwLCAwLCB0aGlzLl94LCB0aGlzLl95KQogICAgICAgIH0KICAgICAgICBsZW5ndGhTcXVhcmVkKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5feCAqIHRoaXMuX3ggKyB0aGlzLl95ICogdGhpcy5feQogICAgICAgIH0KICAgICAgICBsZW5ndGgoKSB7CiAgICAgICAgICAgIHJldHVybiBNYXRoLmh5cG90KHRoaXMuX3gsIHRoaXMuX3kpCiAgICAgICAgfQogICAgICAgIHJvdGF0ZVByZWNhbGMoc2luX2EsIGNvc19hKSB7CiAgICAgICAgICAgIGNvbnN0IHRlbXAgPQogICAgICAgICAgICAgICAgdGhpcy5feCAqIGNvc19hIC0gdGhpcy5feSAqIHNpbl9hOwogICAgICAgICAgICB0aGlzLl95ID0gdGhpcy5feSAqIGNvc19hICsgdGhpcy5feCAqIHNpbl9hOwogICAgICAgICAgICB0aGlzLl94ID0gdGVtcAogICAgICAgIH0KICAgICAgICByb3RhdGUoYSkgewogICAgICAgICAgICBpZiAoYSA9PT0gMCkgcmV0dXJuOwogICAgICAgICAgICB0aGlzLnJvdGF0ZVByZWNhbGMoTWF0aC5zaW4oYSksIE1hdGguY29zKGEpKQogICAgICAgIH0KICAgICAgICByb3RhdGVBYm91dChhLCB4LCB5KSB7CiAgICAgICAgICAgIGlmIChhID09PSAwIHx8IHggPT09IHRoaXMuX3ggJiYgeSA9PT0gdGhpcy5feSkgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl94IC09IHg7CiAgICAgICAgICAgIHRoaXMuX3kgLT0geTsKICAgICAgICAgICAgdGhpcy5yb3RhdGVQcmVjYWxjKE1hdGguc2luKGEpLCBNYXRoLmNvcyhhKSk7CiAgICAgICAgICAgIHRoaXMuX3ggKz0gK3g7CiAgICAgICAgICAgIHRoaXMuX3kgKz0gK3kKICAgICAgICB9CiAgICAgICAgbW92ZShhLCBkaXN0KSB7CiAgICAgICAgICAgIGlmIChkaXN0ID09PSAwKSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuX3ggKz0gTWF0aC5jb3MoYSkgKiBkaXN0OwogICAgICAgICAgICB0aGlzLl95ICs9IE1hdGguc2luKGEpICogZGlzdAogICAgICAgIH0KICAgICAgICBub3JtYWxpemUoKSB7CiAgICAgICAgICAgIGNvbnN0IG0gPSB0aGlzLmxlbmd0aCgpOwogICAgICAgICAgICBpZiAobSAhPT0gMCAmJiBtICE9PSAxKSB7CiAgICAgICAgICAgICAgICB0aGlzLl94IC89IG07CiAgICAgICAgICAgICAgICB0aGlzLl95IC89IG0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjbGFtcChsb3dlciwgdXBwZXIpIHsKICAgICAgICAgICAgdGhpcy5feCA9IEMzLmNsYW1wKHRoaXMuX3gsIGxvd2VyLAogICAgICAgICAgICAgICAgdXBwZXIpOwogICAgICAgICAgICB0aGlzLl95ID0gQzMuY2xhbXAodGhpcy5feSwgbG93ZXIsIHVwcGVyKQogICAgICAgIH0KICAgIH07Cgp9CgovLyAuLi9saWIvbWlzYy9yZWN0LmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIEMzLlJlY3QgPSBjbGFzcyBSZWN0IHsKICAgICAgICBjb25zdHJ1Y3RvcihsZWZ0LCB0b3AsIHJpZ2h0LCBib3R0b20pIHsKICAgICAgICAgICAgdGhpcy5fbGVmdCA9IE5hTjsKICAgICAgICAgICAgdGhpcy5fdG9wID0gTmFOOwogICAgICAgICAgICB0aGlzLl9yaWdodCA9IE5hTjsKICAgICAgICAgICAgdGhpcy5fYm90dG9tID0gTmFOOwogICAgICAgICAgICB0aGlzLl9sZWZ0ID0gMDsKICAgICAgICAgICAgdGhpcy5fdG9wID0gMDsKICAgICAgICAgICAgdGhpcy5fcmlnaHQgPSAwOwogICAgICAgICAgICB0aGlzLl9ib3R0b20gPSAwOwogICAgICAgICAgICBpZiAobGVmdCBpbnN0YW5jZW9mIEMzLlJlY3QpIHRoaXMuY29weShsZWZ0KTsKICAgICAgICAgICAgZWxzZSB0aGlzLnNldChsZWZ0IHx8IDAsIHRvcCB8fCAwLCByaWdodCB8fCAwLCBib3R0b20gfHwgMCkKICAgICAgICB9CiAgICAgICAgc2V0KGxlZnQsIHRvcCwgcmlnaHQsIGJvdHRvbSkgewogICAgICAgICAgICB0aGlzLl9sZWZ0ID0gK2xlZnQ7CiAgICAgICAgICAgIHRoaXMuX3RvcCA9ICt0b3A7CiAgICAgICAgICAgIHRoaXMuX3JpZ2h0ID0gK3JpZ2h0OwogICAgICAgICAgICB0aGlzLl9ib3R0b20gPSArYm90dG9tCiAgICAgICAgfQogICAgICAgIHNldFdIKGxlZnQsIHRvcCwgd2lkdGgsIGhlaWdodCkgewogICAgICAgICAgICBsZWZ0ID0gK2xlZnQ7CiAgICAgICAgICAgIHRvcCA9ICt0b3A7CiAgICAgICAgICAgIHRoaXMuX2xlZnQgPSBsZWZ0OwogICAgICAgICAgICB0aGlzLl90b3AgPSB0b3A7CiAgICAgICAgICAgIHRoaXMuX3JpZ2h0ID0gbGVmdCArICt3aWR0aDsKICAgICAgICAgICAgdGhpcy5fYm90dG9tID0gdG9wICsgK2hlaWdodAogICAgICAgIH0KICAgICAgICBjb3B5KHJlY3QpIHsKICAgICAgICAgICAgdGhpcy5fbGVmdCA9ICtyZWN0Ll9sZWZ0OwogICAgICAgICAgICB0aGlzLl90b3AgPSArcmVjdC5fdG9wOwogICAgICAgICAgICB0aGlzLl9yaWdodCA9ICtyZWN0Ll9yaWdodDsKICAgICAgICAgICAgdGhpcy5fYm90dG9tID0gK3JlY3QuX2JvdHRvbQogICAgICAgIH0KICAgICAgICBjbG9uZSgpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBDMy5SZWN0KHRoaXMuX2xlZnQsIHRoaXMuX3RvcCwgdGhpcy5fcmlnaHQsIHRoaXMuX2JvdHRvbSkKICAgICAgICB9CiAgICAgICAgc3RhdGljIE1lcmdlKGZpcnN0LCBzZWNvbmQpIHsKICAgICAgICAgICAgY29uc3QgcmV0ID0gbmV3IEMzLlJlY3Q7CiAgICAgICAgICAgIHJldC5zZXRMZWZ0KE1hdGgubWluKGZpcnN0Ll9sZWZ0LCBzZWNvbmQuX2xlZnQpKTsKICAgICAgICAgICAgcmV0LnNldFRvcChNYXRoLm1pbihmaXJzdC5fdG9wLCBzZWNvbmQuX3RvcCkpOwogICAgICAgICAgICByZXQuc2V0UmlnaHQoTWF0aC5tYXgoZmlyc3QuX3JpZ2h0LCBzZWNvbmQuX3JpZ2h0KSk7CiAgICAgICAgICAgIHJldC5zZXRCb3R0b20oTWF0aC5tYXgoZmlyc3QuX2JvdHRvbSwgc2Vjb25kLl9ib3R0b20pKTsKICAgICAgICAgICAgcmV0dXJuIHJldAogICAgICAgIH0KICAgICAgICBzdGF0aWMgRnJvbU9iamVjdChvKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgQzMuUmVjdChvLmxlZnQsIG8udG9wLCBvLnJpZ2h0LCBvLmJvdHRvbSkKICAgICAgICB9CiAgICAgICAgZXF1YWxzKHJlY3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2xlZnQgPT09CiAgICAgICAgICAgICAgICByZWN0Ll9sZWZ0ICYmIHRoaXMuX3RvcCA9PT0gcmVjdC5fdG9wICYmIHRoaXMuX3JpZ2h0ID09PSByZWN0Ll9yaWdodCAmJiB0aGlzLl9ib3R0b20gPT09IHJlY3QuX2JvdHRvbQogICAgICAgIH0KICAgICAgICBlcXVhbHNXSCh4LCB5LCB3LCBoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9sZWZ0ID09PSB4ICYmIHRoaXMuX3RvcCA9PT0geSAmJiB0aGlzLndpZHRoKCkgPT09IHcgJiYgdGhpcy5oZWlnaHQoKSA9PT0gaAogICAgICAgIH0KICAgICAgICBlcXVhbHNGMzJBcnJheShhcnIsIG9mZnNldCkgewogICAgICAgICAgICByZXR1cm4gYXJyW29mZnNldF0gPT09IE1hdGguZnJvdW5kKHRoaXMuX2xlZnQpICYmIGFycltvZmZzZXQgKyAxXSA9PT0gTWF0aC5mcm91bmQodGhpcy5fdG9wKSAmJiBhcnJbb2Zmc2V0ICsgMl0gPT09IE1hdGguZnJvdW5kKHRoaXMuX3JpZ2h0KSAmJiBhcnJbb2Zmc2V0ICsgM10gPT09IE1hdGguZnJvdW5kKHRoaXMuX2JvdHRvbSkKICAgICAgICB9CiAgICAgICAgc2V0TGVmdChsKSB7CiAgICAgICAgICAgIHRoaXMuX2xlZnQgPSArbAogICAgICAgIH0KICAgICAgICBnZXRMZWZ0KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fbGVmdAogICAgICAgIH0KICAgICAgICBzZXRUb3AodCkgewogICAgICAgICAgICB0aGlzLl90b3AgPSArdAogICAgICAgIH0KICAgICAgICBnZXRUb3AoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl90b3AKICAgICAgICB9CiAgICAgICAgc2V0UmlnaHQocikgewogICAgICAgICAgICB0aGlzLl9yaWdodCA9ICtyCiAgICAgICAgfQogICAgICAgIGdldFJpZ2h0KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fcmlnaHQKICAgICAgICB9CiAgICAgICAgc2V0Qm90dG9tKGIpIHsKICAgICAgICAgICAgdGhpcy5fYm90dG9tID0gK2IKICAgICAgICB9CiAgICAgICAgZ2V0Qm90dG9tKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fYm90dG9tCiAgICAgICAgfQogICAgICAgIHRvQXJyYXkoKSB7CiAgICAgICAgICAgIHJldHVybiBbdGhpcy5fbGVmdCwgdGhpcy5fdG9wLCB0aGlzLl9yaWdodCwgdGhpcy5fYm90dG9tXQogICAgICAgIH0KICAgICAgICB0b1R5cGVkQXJyYXkoKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgRmxvYXQ2NEFycmF5KHRoaXMudG9BcnJheSgpKQogICAgICAgIH0KICAgICAgICB0b0RPTVJlY3QoKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgRE9NUmVjdCh0aGlzLl9sZWZ0LCB0aGlzLl90b3AsIHRoaXMud2lkdGgoKSwgdGhpcy5oZWlnaHQoKSkKICAgICAgICB9CiAgICAgICAgd3JpdGVUb1R5cGVkQXJyYXkodGEsIGkpIHsKICAgICAgICAgICAgdGFbaSsrXSA9IHRoaXMuX2xlZnQ7CiAgICAgICAgICAgIHRhW2krK10gPSB0aGlzLl90b3A7CiAgICAgICAgICAgIHRhW2krK10gPSB0aGlzLl9yaWdodDsKICAgICAgICAgICAgdGFbaV0gPSB0aGlzLl9ib3R0b20KICAgICAgICB9CiAgICAgICAgd3JpdGVBc1F1YWRUb1R5cGVkQXJyYXkodGEsIGkpIHsKICAgICAgICAgICAgdGFbaSsrXSA9IHRoaXMuX2xlZnQ7CiAgICAgICAgICAgIHRhW2krK10gPSB0aGlzLl90b3A7CiAgICAgICAgICAgIHRhW2krK10gPSB0aGlzLl9yaWdodDsKICAgICAgICAgICAgdGFbaSsrXSA9IHRoaXMuX3RvcDsKICAgICAgICAgICAgdGFbaSsrXSA9CiAgICAgICAgICAgICAgICB0aGlzLl9yaWdodDsKICAgICAgICAgICAgdGFbaSsrXSA9IHRoaXMuX2JvdHRvbTsKICAgICAgICAgICAgdGFbaSsrXSA9IHRoaXMuX2xlZnQ7CiAgICAgICAgICAgIHRhW2ldID0gdGhpcy5fYm90dG9tCiAgICAgICAgfQogICAgICAgIHdyaXRlQXNRdWFkVG9UeXBlZEFycmF5M0QodGEsIGksIHopIHsKICAgICAgICAgICAgdGFbaSsrXSA9IHRoaXMuX2xlZnQ7CiAgICAgICAgICAgIHRhW2krK10gPSB0aGlzLl90b3A7CiAgICAgICAgICAgIHRhW2krK10gPSB6OwogICAgICAgICAgICB0YVtpKytdID0gdGhpcy5fcmlnaHQ7CiAgICAgICAgICAgIHRhW2krK10gPSB0aGlzLl90b3A7CiAgICAgICAgICAgIHRhW2krK10gPSB6OwogICAgICAgICAgICB0YVtpKytdID0gdGhpcy5fcmlnaHQ7CiAgICAgICAgICAgIHRhW2krK10gPSB0aGlzLl9ib3R0b207CiAgICAgICAgICAgIHRhW2krK10gPSB6OwogICAgICAgICAgICB0YVtpKytdID0gdGhpcy5fbGVmdDsKICAgICAgICAgICAgdGFbaSsrXSA9IHRoaXMuX2JvdHRvbTsKICAgICAgICAgICAgdGFbaV0gPSB6CiAgICAgICAgfQogICAgICAgIHdpZHRoKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fcmlnaHQgLSB0aGlzLl9sZWZ0CiAgICAgICAgfQogICAgICAgIGhlaWdodCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2JvdHRvbSAtIHRoaXMuX3RvcAogICAgICAgIH0KICAgICAgICBtaWRYKCkgewogICAgICAgICAgICByZXR1cm4gKHRoaXMuX2xlZnQgKyB0aGlzLl9yaWdodCkgLyAyCiAgICAgICAgfQogICAgICAgIG1pZFkoKSB7CiAgICAgICAgICAgIHJldHVybiAodGhpcy5fdG9wICsgdGhpcy5fYm90dG9tKSAvIDIKICAgICAgICB9CiAgICAgICAgb2Zmc2V0KHgsIHkpIHsKICAgICAgICAgICAgeCA9ICt4OwogICAgICAgICAgICB5ID0gK3k7CiAgICAgICAgICAgIHRoaXMuX2xlZnQgKz0geDsKICAgICAgICAgICAgdGhpcy5fdG9wICs9CiAgICAgICAgICAgICAgICB5OwogICAgICAgICAgICB0aGlzLl9yaWdodCArPSB4OwogICAgICAgICAgICB0aGlzLl9ib3R0b20gKz0geQogICAgICAgIH0KICAgICAgICBvZmZzZXRMZWZ0KHgpIHsKICAgICAgICAgICAgdGhpcy5fbGVmdCArPSAreAogICAgICAgIH0KICAgICAgICBvZmZzZXRUb3AoeSkgewogICAgICAgICAgICB0aGlzLl90b3AgKz0gK3kKICAgICAgICB9CiAgICAgICAgb2Zmc2V0UmlnaHQoeCkgewogICAgICAgICAgICB0aGlzLl9yaWdodCArPSAreAogICAgICAgIH0KICAgICAgICBvZmZzZXRCb3R0b20oeSkgewogICAgICAgICAgICB0aGlzLl9ib3R0b20gKz0gK3kKICAgICAgICB9CiAgICAgICAgdG9TcXVhcmUoYXhpcykgewogICAgICAgICAgICBpZiAoYXhpcyAhPT0gIngiKSB0aHJvdyBuZXcgRXJyb3IoImludmFsaWQgYXhpcywgb25seSAneCcgc3VwcG9ydGVkIik7CiAgICAgICAgICAgIGlmICh0aGlzLl90b3AgPCB0aGlzLl9ib3R0b20pCiAgICAgICAgICAgICAgICBpZiAodGhpcy5fbGVmdCA8IHRoaXMuX3JpZ2h0KSB0aGlzLl9ib3R0b20gPSB0aGlzLl90b3AgKyB0aGlzLndpZHRoKCk7CiAgICAgICAgICAgICAgICBlbHNlIHRoaXMuX2JvdHRvbSA9IHRoaXMuX3RvcCAtIHRoaXMud2lkdGgoKTsKICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5fbGVmdCA8IHRoaXMuX3JpZ2h0KSB0aGlzLl9ib3R0b20gPSB0aGlzLl90b3AgLSB0aGlzLndpZHRoKCk7CiAgICAgICAgICAgIGVsc2UgdGhpcy5fYm90dG9tID0gdGhpcy5fdG9wICsgdGhpcy53aWR0aCgpCiAgICAgICAgfQogICAgICAgIGluZmxhdGUoeCwgeSkgewogICAgICAgICAgICB4ID0gK3g7CiAgICAgICAgICAgIHkgPSAreTsKICAgICAgICAgICAgdGhpcy5fbGVmdCAtPQogICAgICAgICAgICAgICAgeDsKICAgICAgICAgICAgdGhpcy5fdG9wIC09IHk7CiAgICAgICAgICAgIHRoaXMuX3JpZ2h0ICs9IHg7CiAgICAgICAgICAgIHRoaXMuX2JvdHRvbSArPSB5CiAgICAgICAgfQogICAgICAgIGRlZmxhdGUoeCwgeSkgewogICAgICAgICAgICB4ID0gK3g7CiAgICAgICAgICAgIHkgPSAreTsKICAgICAgICAgICAgdGhpcy5fbGVmdCArPSB4OwogICAgICAgICAgICB0aGlzLl90b3AgKz0geTsKICAgICAgICAgICAgdGhpcy5fcmlnaHQgLT0geDsKICAgICAgICAgICAgdGhpcy5fYm90dG9tIC09IHkKICAgICAgICB9CiAgICAgICAgbXVsdGlwbHkoeCwgeSkgewogICAgICAgICAgICB0aGlzLl9sZWZ0ICo9IHg7CiAgICAgICAgICAgIHRoaXMuX3RvcCAqPSB5OwogICAgICAgICAgICB0aGlzLl9yaWdodCAqPSB4OwogICAgICAgICAgICB0aGlzLl9ib3R0b20gKj0geQogICAgICAgIH0KICAgICAgICBkaXZpZGUoeCwgeSkgewogICAgICAgICAgICB0aGlzLl9sZWZ0IC89IHg7CiAgICAgICAgICAgIHRoaXMuX3RvcCAvPSB5OwogICAgICAgICAgICB0aGlzLl9yaWdodCAvPSB4OwogICAgICAgICAgICB0aGlzLl9ib3R0b20gLz0geQogICAgICAgIH0KICAgICAgICBtaXJyb3JBcm91bmQob3JpZ2luKSB7CiAgICAgICAgICAgIHRoaXMuX2xlZnQgPSArb3JpZ2luIC0gdGhpcy5fbGVmdDsKICAgICAgICAgICAgdGhpcy5fcmlnaHQgPSArb3JpZ2luIC0gdGhpcy5fcmlnaHQKICAgICAgICB9CiAgICAgICAgZmxpcEFyb3VuZChvcmlnaW4pIHsKICAgICAgICAgICAgdGhpcy5fdG9wID0gK29yaWdpbiAtIHRoaXMuX3RvcDsKICAgICAgICAgICAgdGhpcy5fYm90dG9tID0gK29yaWdpbiAtIHRoaXMuX2JvdHRvbQogICAgICAgIH0KICAgICAgICByb3RhdGU5MERlZ3JlZXNBcm91bmQobm9ybWFsaXplZFgsIG5vcm1hbGl6ZWRZKSB7CiAgICAgICAgICAgIGNvbnN0IHcgPSB0aGlzLndpZHRoKCk7CiAgICAgICAgICAgIGNvbnN0IGggPSB0aGlzLmhlaWdodCgpOwogICAgICAgICAgICBjb25zdCBjeCA9IHRoaXMuZ2V0TGVmdCgpICsgdyAqIG5vcm1hbGl6ZWRYOwogICAgICAgICAgICBjb25zdCBjeSA9IHRoaXMuZ2V0VG9wKCkgKyBoICogbm9ybWFsaXplZFk7CiAgICAgICAgICAgIHRoaXMuc2V0V0goY3ggLSBoICogbm9ybWFsaXplZFksIGN5IC0gdyAqIG5vcm1hbGl6ZWRYLCBoLCB3KQogICAgICAgIH0KICAgICAgICBzd2FwTGVmdFJpZ2h0KCkgewogICAgICAgICAgICBjb25zdCB0ZW1wID0gdGhpcy5fbGVmdDsKICAgICAgICAgICAgdGhpcy5fbGVmdCA9IHRoaXMuX3JpZ2h0OwogICAgICAgICAgICB0aGlzLl9yaWdodCA9IHRlbXAKICAgICAgICB9CiAgICAgICAgc3dhcFRvcEJvdHRvbSgpIHsKICAgICAgICAgICAgY29uc3QgdGVtcCA9IHRoaXMuX3RvcDsKICAgICAgICAgICAgdGhpcy5fdG9wID0gdGhpcy5fYm90dG9tOwogICAgICAgICAgICB0aGlzLl9ib3R0b20gPSB0ZW1wCiAgICAgICAgfQogICAgICAgIHNodW50WShoKSB7CiAgICAgICAgICAgIGNvbnN0IHRvcCA9IHRoaXMuX3RvcDsKICAgICAgICAgICAgdGhpcy5fdG9wID0gK2ggLSB0aGlzLl9ib3R0b207CiAgICAgICAgICAgIHRoaXMuX2JvdHRvbSA9ICtoIC0gdG9wCiAgICAgICAgfQogICAgICAgIHJvdW5kKCkgewogICAgICAgICAgICB0aGlzLl9sZWZ0ID0gTWF0aC5yb3VuZCh0aGlzLl9sZWZ0KTsKICAgICAgICAgICAgdGhpcy5fdG9wID0gTWF0aC5yb3VuZCh0aGlzLl90b3ApOwogICAgICAgICAgICB0aGlzLl9yaWdodCA9IE1hdGgucm91bmQodGhpcy5fcmlnaHQpOwogICAgICAgICAgICB0aGlzLl9ib3R0b20gPQogICAgICAgICAgICAgICAgTWF0aC5yb3VuZCh0aGlzLl9ib3R0b20pCiAgICAgICAgfQogICAgICAgIHJvdW5kSW5uZXIoKSB7CiAgICAgICAgICAgIHRoaXMuX2xlZnQgPSBNYXRoLmNlaWwodGhpcy5fbGVmdCk7CiAgICAgICAgICAgIHRoaXMuX3RvcCA9IE1hdGguY2VpbCh0aGlzLl90b3ApOwogICAgICAgICAgICB0aGlzLl9yaWdodCA9IE1hdGguZmxvb3IodGhpcy5fcmlnaHQpOwogICAgICAgICAgICB0aGlzLl9ib3R0b20gPSBNYXRoLmZsb29yKHRoaXMuX2JvdHRvbSkKICAgICAgICB9CiAgICAgICAgcm91bmRPdXRlcigpIHsKICAgICAgICAgICAgdGhpcy5fbGVmdCA9IE1hdGguZmxvb3IodGhpcy5fbGVmdCk7CiAgICAgICAgICAgIHRoaXMuX3RvcCA9IE1hdGguZmxvb3IodGhpcy5fdG9wKTsKICAgICAgICAgICAgdGhpcy5fcmlnaHQgPSBNYXRoLmNlaWwodGhpcy5fcmlnaHQpOwogICAgICAgICAgICB0aGlzLl9ib3R0b20gPSBNYXRoLmNlaWwodGhpcy5fYm90dG9tKQogICAgICAgIH0KICAgICAgICBmbG9vcigpIHsKICAgICAgICAgICAgdGhpcy5fbGVmdCA9IE1hdGguZmxvb3IodGhpcy5fbGVmdCk7CiAgICAgICAgICAgIHRoaXMuX3RvcCA9IE1hdGguZmxvb3IodGhpcy5fdG9wKTsKICAgICAgICAgICAgdGhpcy5fcmlnaHQgPSBNYXRoLmZsb29yKHRoaXMuX3JpZ2h0KTsKICAgICAgICAgICAgdGhpcy5fYm90dG9tID0gTWF0aC5mbG9vcih0aGlzLl9ib3R0b20pCiAgICAgICAgfQogICAgICAgIGNlaWwoKSB7CiAgICAgICAgICAgIHRoaXMuX2xlZnQgPSBNYXRoLmNlaWwodGhpcy5fbGVmdCk7CiAgICAgICAgICAgIHRoaXMuX3RvcCA9IE1hdGguY2VpbCh0aGlzLl90b3ApOwogICAgICAgICAgICB0aGlzLl9yaWdodCA9IE1hdGguY2VpbCh0aGlzLl9yaWdodCk7CiAgICAgICAgICAgIHRoaXMuX2JvdHRvbSA9IE1hdGguY2VpbCh0aGlzLl9ib3R0b20pCiAgICAgICAgfQogICAgICAgIGNsYW1wKGwsIHQsIHIsIGIpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX2xlZnQgPCBsKSB0aGlzLl9sZWZ0ID0gK2w7CiAgICAgICAgICAgIGlmICh0aGlzLl90b3AgPCB0KSB0aGlzLl90b3AgPSArdDsKICAgICAgICAgICAgaWYgKHRoaXMuX3JpZ2h0ID4gcikgdGhpcy5fcmlnaHQgPSArcjsKICAgICAgICAgICAgaWYgKHRoaXMuX2JvdHRvbSA+IGIpIHRoaXMuX2JvdHRvbSA9ICtiCiAgICAgICAgfQogICAgICAgIGNsYW1wRmxpcHBlZChsLCB0LCByLCBiKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9sZWZ0IDwgbCkgdGhpcy5fbGVmdCA9ICtsOwogICAgICAgICAgICBpZiAodGhpcy5fdG9wID4gdCkgdGhpcy5fdG9wID0gK3Q7CiAgICAgICAgICAgIGlmICh0aGlzLl9yaWdodCA+IHIpIHRoaXMuX3JpZ2h0ID0gK3I7CiAgICAgICAgICAgIGlmICh0aGlzLl9ib3R0b20gPCBiKSB0aGlzLl9ib3R0b20gPSArYgogICAgICAgIH0KICAgICAgICBub3JtYWxpemUoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9sZWZ0ID4gdGhpcy5fcmlnaHQpIHRoaXMuc3dhcExlZnRSaWdodCgpOwogICAgICAgICAgICBpZiAodGhpcy5fdG9wID4gdGhpcy5fYm90dG9tKSB0aGlzLnN3YXBUb3BCb3R0b20oKQogICAgICAgIH0KICAgICAgICBpbnRlcnNlY3RzUmVjdChyZWN0KSB7CiAgICAgICAgICAgIHJldHVybiAhKHJlY3QuX3JpZ2h0IDwKICAgICAgICAgICAgICAgIHRoaXMuX2xlZnQgfHwgcmVjdC5fYm90dG9tIDwgdGhpcy5fdG9wIHx8IHJlY3QuX2xlZnQgPiB0aGlzLl9yaWdodCB8fCByZWN0Ll90b3AgPiB0aGlzLl9ib3R0b20pCiAgICAgICAgfQogICAgICAgIGludGVyc2VjdHNSZWN0T2Zmc2V0KHJlY3QsIHgsIHkpIHsKICAgICAgICAgICAgcmV0dXJuICEocmVjdC5fcmlnaHQgKyB4IDwgdGhpcy5fbGVmdCB8fCByZWN0Ll9ib3R0b20gKyB5IDwgdGhpcy5fdG9wIHx8IHJlY3QuX2xlZnQgKyB4ID4gdGhpcy5fcmlnaHQgfHwgcmVjdC5fdG9wICsgeSA+IHRoaXMuX2JvdHRvbSkKICAgICAgICB9CiAgICAgICAgY29udGFpbnNQb2ludCh4LCB5KSB7CiAgICAgICAgICAgIHJldHVybiB4ID49IHRoaXMuX2xlZnQgJiYgeCA8PSB0aGlzLl9yaWdodCAmJiB5ID49IHRoaXMuX3RvcCAmJiB5IDw9IHRoaXMuX2JvdHRvbQogICAgICAgIH0KICAgICAgICBjb250YWluc1JlY3QocmVjdCkgewogICAgICAgICAgICByZXR1cm4gcmVjdC5fbGVmdCA+PSB0aGlzLl9sZWZ0ICYmIHJlY3QuX3RvcCA+PSB0aGlzLl90b3AgJiYgcmVjdC5fcmlnaHQgPD0gdGhpcy5fcmlnaHQgJiYgcmVjdC5fYm90dG9tIDw9IHRoaXMuX2JvdHRvbQogICAgICAgIH0KICAgICAgICBleHBhbmRUb0NvbnRhaW4ocmVjdCkgewogICAgICAgICAgICBpZiAocmVjdC5fbGVmdCA8IHRoaXMuX2xlZnQpIHRoaXMuX2xlZnQgPSArcmVjdC5fbGVmdDsKICAgICAgICAgICAgaWYgKHJlY3QuX3RvcCA8IHRoaXMuX3RvcCkgdGhpcy5fdG9wID0gK3JlY3QuX3RvcDsKICAgICAgICAgICAgaWYgKHJlY3QuX3JpZ2h0ID4gdGhpcy5fcmlnaHQpIHRoaXMuX3JpZ2h0ID0gK3JlY3QuX3JpZ2h0OwogICAgICAgICAgICBpZiAocmVjdC5fYm90dG9tID4gdGhpcy5fYm90dG9tKSB0aGlzLl9ib3R0b20gPSArcmVjdC5fYm90dG9tCiAgICAgICAgfQogICAgICAgIGxlcnBJbnRvKHJlY3QpIHsKICAgICAgICAgICAgdGhpcy5fbGVmdCA9IEMzLmxlcnAocmVjdC5fbGVmdCwgcmVjdC5fcmlnaHQsIHRoaXMuX2xlZnQpOwogICAgICAgICAgICB0aGlzLl90b3AgPSBDMy5sZXJwKHJlY3QuX3RvcCwgcmVjdC5fYm90dG9tLCB0aGlzLl90b3ApOwogICAgICAgICAgICB0aGlzLl9yaWdodCA9IEMzLmxlcnAocmVjdC5fbGVmdCwgcmVjdC5fcmlnaHQsIHRoaXMuX3JpZ2h0KTsKICAgICAgICAgICAgdGhpcy5fYm90dG9tID0gQzMubGVycChyZWN0Ll90b3AsIHJlY3QuX2JvdHRvbSwgdGhpcy5fYm90dG9tKQogICAgICAgIH0KICAgIH07Cgp9CgovLyAuLi9saWIvbWlzYy9xdWFkLmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIEMzLlF1YWQgPSBjbGFzcyBRdWFkIHsKICAgICAgICBjb25zdHJ1Y3Rvcih0bHgsIHRseSwgdHJ4LCB0cnlfLCBicngsIGJyeSwgYmx4LCBibHkpIHsKICAgICAgICAgICAgdGhpcy5fdGx4ID0gTmFOOwogICAgICAgICAgICB0aGlzLl90bHkgPSBOYU47CiAgICAgICAgICAgIHRoaXMuX3RyeCA9IE5hTjsKICAgICAgICAgICAgdGhpcy5fdHJ5ID0gTmFOOwogICAgICAgICAgICB0aGlzLl9icnggPSBOYU47CiAgICAgICAgICAgIHRoaXMuX2JyeSA9IE5hTjsKICAgICAgICAgICAgdGhpcy5fYmx4ID0gTmFOOwogICAgICAgICAgICB0aGlzLl9ibHkgPSBOYU47CiAgICAgICAgICAgIHRoaXMuX3RseCA9IDA7CiAgICAgICAgICAgIHRoaXMuX3RseSA9IDA7CiAgICAgICAgICAgIHRoaXMuX3RyeCA9IDA7CiAgICAgICAgICAgIHRoaXMuX3RyeSA9IDA7CiAgICAgICAgICAgIHRoaXMuX2JyeCA9IDA7CiAgICAgICAgICAgIHRoaXMuX2JyeSA9IDA7CiAgICAgICAgICAgIHRoaXMuX2JseCA9IDA7CiAgICAgICAgICAgIHRoaXMuX2JseSA9IDA7CiAgICAgICAgICAgIGlmICh0bHggaW5zdGFuY2VvZiBDMy5RdWFkKSB0aGlzLmNvcHkodGx4KTsKICAgICAgICAgICAgZWxzZSB0aGlzLnNldCh0bHggfHwgMCwgdGx5IHx8IDAsIHRyeCB8fCAwLCB0cnlfIHx8IDAsIGJyeCB8fCAwLCBicnkgfHwgMCwgYmx4IHx8IDAsIGJseSB8fCAwKQogICAgICAgIH0KICAgICAgICBzZXQodGx4LCB0bHksIHRyeCwgdHJ5XywgYnJ4LCBicnksIGJseCwgYmx5KSB7CiAgICAgICAgICAgIHRoaXMuX3RseCA9ICt0bHg7CiAgICAgICAgICAgIHRoaXMuX3RseSA9ICt0bHk7CiAgICAgICAgICAgIHRoaXMuX3RyeCA9ICt0cng7CiAgICAgICAgICAgIHRoaXMuX3RyeSA9ICt0cnlfOwogICAgICAgICAgICB0aGlzLl9icnggPSArYnJ4OwogICAgICAgICAgICB0aGlzLl9icnkgPSArYnJ5OwogICAgICAgICAgICB0aGlzLl9ibHggPSArYmx4OwogICAgICAgICAgICB0aGlzLl9ibHkgPSArYmx5CiAgICAgICAgfQogICAgICAgIHNldFJlY3QobGVmdCwgdG9wLCByaWdodCwgYm90dG9tKSB7CiAgICAgICAgICAgIHRoaXMuc2V0KGxlZnQsIHRvcCwgcmlnaHQsIHRvcCwgcmlnaHQsIGJvdHRvbSwgbGVmdCwgYm90dG9tKQogICAgICAgIH0KICAgICAgICBjb3B5KHEpIHsKICAgICAgICAgICAgdGhpcy5fdGx4ID0gcS5fdGx4OwogICAgICAgICAgICB0aGlzLl90bHkgPSBxLl90bHk7CiAgICAgICAgICAgIHRoaXMuX3RyeCA9IHEuX3RyeDsKICAgICAgICAgICAgdGhpcy5fdHJ5ID0gcS5fdHJ5OwogICAgICAgICAgICB0aGlzLl9icnggPSBxLl9icng7CiAgICAgICAgICAgIHRoaXMuX2JyeSA9IHEuX2JyeTsKICAgICAgICAgICAgdGhpcy5fYmx4ID0gcS5fYmx4OwogICAgICAgICAgICB0aGlzLl9ibHkgPSBxLl9ibHkKICAgICAgICB9CiAgICAgICAgZXF1YWxzKHEpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RseCA9PT0gcS5fdGx4ICYmIHRoaXMuX3RseSA9PT0gcS5fdGx5ICYmIHRoaXMuX3RyeCA9PT0gcS5fdHJ4ICYmIHRoaXMuX3RyeSA9PT0gcS5fdHJ5ICYmIHRoaXMuX2JyeCA9PT0gcS5fYnJ4ICYmIHRoaXMuX2JyeSA9PT0gcS5fYnJ5ICYmIHRoaXMuX2JseCA9PT0gcS5fYmx4ICYmIHRoaXMuX2JseSA9PT0gcS5fYmx5CiAgICAgICAgfQogICAgICAgIHNldFRseCh2KSB7CiAgICAgICAgICAgIHRoaXMuX3RseCA9ICt2CiAgICAgICAgfQogICAgICAgIGdldFRseCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RseAogICAgICAgIH0KICAgICAgICBzZXRUbHkodikgewogICAgICAgICAgICB0aGlzLl90bHkgPSArdgogICAgICAgIH0KICAgICAgICBnZXRUbHkoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl90bHkKICAgICAgICB9CiAgICAgICAgc2V0VHJ4KHYpIHsKICAgICAgICAgICAgdGhpcy5fdHJ4ID0gK3YKICAgICAgICB9CiAgICAgICAgZ2V0VHJ4KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fdHJ4CiAgICAgICAgfQogICAgICAgIHNldFRyeSh2KSB7CiAgICAgICAgICAgIHRoaXMuX3RyeSA9ICt2CiAgICAgICAgfQogICAgICAgIGdldFRyeSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RyeQogICAgICAgIH0KICAgICAgICBzZXRCcngodikgewogICAgICAgICAgICB0aGlzLl9icnggPSArdgogICAgICAgIH0KICAgICAgICBnZXRCcngoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9icngKICAgICAgICB9CiAgICAgICAgc2V0QnJ5KHYpIHsKICAgICAgICAgICAgdGhpcy5fYnJ5ID0gK3YKICAgICAgICB9CiAgICAgICAgZ2V0QnJ5KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fYnJ5CiAgICAgICAgfQogICAgICAgIHNldEJseCh2KSB7CiAgICAgICAgICAgIHRoaXMuX2JseCA9ICt2CiAgICAgICAgfQogICAgICAgIGdldEJseCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2JseAogICAgICAgIH0KICAgICAgICBzZXRCbHkodikgewogICAgICAgICAgICB0aGlzLl9ibHkgPSArdgogICAgICAgIH0KICAgICAgICBnZXRCbHkoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9ibHkKICAgICAgICB9CiAgICAgICAgdG9ET01RdWFkKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IERPTVF1YWQobmV3IERPTVBvaW50KHRoaXMuX3RseCwgdGhpcy5fdGx5KSwgbmV3IERPTVBvaW50KHRoaXMuX3RyeCwgdGhpcy5fdHJ5KSwgbmV3IERPTVBvaW50KHRoaXMuX2JyeCwgdGhpcy5fYnJ5KSwgbmV3IERPTVBvaW50KHRoaXMuX2JseCwgdGhpcy5fYmx5KSkKICAgICAgICB9CiAgICAgICAgdG9BcnJheSgpIHsKICAgICAgICAgICAgcmV0dXJuIFt0aGlzLl90bHgsCiAgICAgICAgICAgICAgICB0aGlzLl90bHksIHRoaXMuX3RyeCwgdGhpcy5fdHJ5LCB0aGlzLl9icngsIHRoaXMuX2JyeSwgdGhpcy5fYmx4LCB0aGlzLl9ibHkKICAgICAgICAgICAgXQogICAgICAgIH0KICAgICAgICB0b1R5cGVkQXJyYXkoKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgRmxvYXQ2NEFycmF5KHRoaXMudG9BcnJheSgpKQogICAgICAgIH0KICAgICAgICB3cml0ZVRvVHlwZWRBcnJheSh0YSwgaSkgewogICAgICAgICAgICB0YVtpKytdID0gdGhpcy5fdGx4OwogICAgICAgICAgICB0YVtpKytdID0gdGhpcy5fdGx5OwogICAgICAgICAgICB0YVtpKytdID0gdGhpcy5fdHJ4OwogICAgICAgICAgICB0YVtpKytdID0gdGhpcy5fdHJ5OwogICAgICAgICAgICB0YVtpKytdID0gdGhpcy5fYnJ4OwogICAgICAgICAgICB0YVtpKytdID0gdGhpcy5fYnJ5OwogICAgICAgICAgICB0YVtpKytdID0gdGhpcy5fYmx4OwogICAgICAgICAgICB0YVtpXSA9IHRoaXMuX2JseQogICAgICAgIH0KICAgICAgICB3cml0ZVRvVHlwZWRBcnJheTNEKHRhLCBpLCB6KSB7CiAgICAgICAgICAgIHRhW2krK10gPSB0aGlzLl90bHg7CiAgICAgICAgICAgIHRhW2krK10gPSB0aGlzLl90bHk7CiAgICAgICAgICAgIHRhW2krK10gPSB6OwogICAgICAgICAgICB0YVtpKytdID0gdGhpcy5fdHJ4OwogICAgICAgICAgICB0YVtpKytdID0gdGhpcy5fdHJ5OwogICAgICAgICAgICB0YVtpKytdID0gejsKICAgICAgICAgICAgdGFbaSsrXSA9IHRoaXMuX2JyeDsKICAgICAgICAgICAgdGFbaSsrXSA9IHRoaXMuX2JyeTsKICAgICAgICAgICAgdGFbaSsrXSA9IHo7CiAgICAgICAgICAgIHRhW2krK10gPSB0aGlzLl9ibHg7CiAgICAgICAgICAgIHRhW2krK10gPSB0aGlzLl9ibHk7CiAgICAgICAgICAgIHRhW2ldID0gegogICAgICAgIH0KICAgICAgICBvZmZzZXQoeCwKICAgICAgICAgICAgeSkgewogICAgICAgICAgICB4ID0gK3g7CiAgICAgICAgICAgIHkgPSAreTsKICAgICAgICAgICAgdGhpcy5fdGx4ICs9IHg7CiAgICAgICAgICAgIHRoaXMuX3RseSArPSB5OwogICAgICAgICAgICB0aGlzLl90cnggKz0geDsKICAgICAgICAgICAgdGhpcy5fdHJ5ICs9IHk7CiAgICAgICAgICAgIHRoaXMuX2JyeCArPSB4OwogICAgICAgICAgICB0aGlzLl9icnkgKz0geTsKICAgICAgICAgICAgdGhpcy5fYmx4ICs9IHg7CiAgICAgICAgICAgIHRoaXMuX2JseSArPSB5CiAgICAgICAgfQogICAgICAgIHJvdW5kKCkgewogICAgICAgICAgICB0aGlzLl90bHggPSBNYXRoLnJvdW5kKHRoaXMuX3RseCk7CiAgICAgICAgICAgIHRoaXMuX3RseSA9IE1hdGgucm91bmQodGhpcy5fdGx5KTsKICAgICAgICAgICAgdGhpcy5fdHJ4ID0gTWF0aC5yb3VuZCh0aGlzLl90cngpOwogICAgICAgICAgICB0aGlzLl90cnkgPSBNYXRoLnJvdW5kKHRoaXMuX3RyeSk7CiAgICAgICAgICAgIHRoaXMuX2JyeCA9IE1hdGgucm91bmQodGhpcy5fYnJ4KTsKICAgICAgICAgICAgdGhpcy5fYnJ5ID0gTWF0aC5yb3VuZCh0aGlzLl9icnkpOwogICAgICAgICAgICB0aGlzLl9ibHggPSBNYXRoLnJvdW5kKHRoaXMuX2JseCk7CiAgICAgICAgICAgIHRoaXMuX2JseSA9IE1hdGgucm91bmQodGhpcy5fYmx5KQogICAgICAgIH0KICAgICAgICBmbG9vcigpIHsKICAgICAgICAgICAgdGhpcy5fdGx4ID0gTWF0aC5mbG9vcih0aGlzLl90bHgpOwogICAgICAgICAgICB0aGlzLl90bHkgPSBNYXRoLmZsb29yKHRoaXMuX3RseSk7CiAgICAgICAgICAgIHRoaXMuX3RyeCA9IE1hdGguZmxvb3IodGhpcy5fdHJ4KTsKICAgICAgICAgICAgdGhpcy5fdHJ5ID0gTWF0aC5mbG9vcih0aGlzLl90cnkpOwogICAgICAgICAgICB0aGlzLl9icnggPSBNYXRoLmZsb29yKHRoaXMuX2JyeCk7CiAgICAgICAgICAgIHRoaXMuX2JyeSA9IE1hdGguZmxvb3IodGhpcy5fYnJ5KTsKICAgICAgICAgICAgdGhpcy5fYmx4ID0gTWF0aC5mbG9vcih0aGlzLl9ibHgpOwogICAgICAgICAgICB0aGlzLl9ibHkgPSBNYXRoLmZsb29yKHRoaXMuX2JseSkKICAgICAgICB9CiAgICAgICAgY2VpbCgpIHsKICAgICAgICAgICAgdGhpcy5fdGx4ID0gTWF0aC5jZWlsKHRoaXMuX3RseCk7CiAgICAgICAgICAgIHRoaXMuX3RseSA9IE1hdGguY2VpbCh0aGlzLl90bHkpOwogICAgICAgICAgICB0aGlzLl90cnggPSBNYXRoLmNlaWwodGhpcy5fdHJ4KTsKICAgICAgICAgICAgdGhpcy5fdHJ5ID0gTWF0aC5jZWlsKHRoaXMuX3RyeSk7CiAgICAgICAgICAgIHRoaXMuX2JyeCA9IE1hdGguY2VpbCh0aGlzLl9icngpOwogICAgICAgICAgICB0aGlzLl9icnkgPSBNYXRoLmNlaWwodGhpcy5fYnJ5KTsKICAgICAgICAgICAgdGhpcy5fYmx4ID0gTWF0aC5jZWlsKHRoaXMuX2JseCk7CiAgICAgICAgICAgIHRoaXMuX2JseSA9IE1hdGguY2VpbCh0aGlzLl9ibHkpCiAgICAgICAgfQogICAgICAgIHNldEZyb21SZWN0KHJlY3QpIHsKICAgICAgICAgICAgdGhpcy5fdGx4ID0gcmVjdC5fbGVmdDsKICAgICAgICAgICAgdGhpcy5fdGx5ID0gcmVjdC5fdG9wOwogICAgICAgICAgICB0aGlzLl90cnggPSByZWN0Ll9yaWdodDsKICAgICAgICAgICAgdGhpcy5fdHJ5ID0gcmVjdC5fdG9wOwogICAgICAgICAgICB0aGlzLl9icnggPSByZWN0Ll9yaWdodDsKICAgICAgICAgICAgdGhpcy5fYnJ5ID0gcmVjdC5fYm90dG9tOwogICAgICAgICAgICB0aGlzLl9ibHggPSByZWN0Ll9sZWZ0OwogICAgICAgICAgICB0aGlzLl9ibHkgPSByZWN0Ll9ib3R0b20KICAgICAgICB9CiAgICAgICAgc2V0RnJvbVJvdGF0ZWRSZWN0KHJlY3QsIGEpIHsKICAgICAgICAgICAgaWYgKGEgPT09IDApIHRoaXMuc2V0RnJvbVJlY3QocmVjdCk7CiAgICAgICAgICAgIGVsc2UgdGhpcy5zZXRGcm9tUm90YXRlZFJlY3RQcmVjYWxjKHJlY3QsIE1hdGguc2luKGEpLCBNYXRoLmNvcyhhKSkKICAgICAgICB9CiAgICAgICAgc2V0RnJvbVJvdGF0ZWRSZWN0UHJlY2FsYyhyZWN0LCBzaW5fYSwgY29zX2EpIHsKICAgICAgICAgICAgY29uc3QgbGVmdF9zaW5fYSA9IHJlY3QuX2xlZnQgKiBzaW5fYTsKICAgICAgICAgICAgY29uc3QgdG9wX3Npbl9hID0gcmVjdC5fdG9wICogc2luX2E7CiAgICAgICAgICAgIGNvbnN0IHJpZ2h0X3Npbl9hID0gcmVjdC5fcmlnaHQgKiBzaW5fYTsKICAgICAgICAgICAgY29uc3QgYm90dG9tX3Npbl9hID0gcmVjdC5fYm90dG9tICogc2luX2E7CiAgICAgICAgICAgIGNvbnN0IGxlZnRfY29zX2EgPSByZWN0Ll9sZWZ0ICogY29zX2E7CiAgICAgICAgICAgIGNvbnN0IHRvcF9jb3NfYSA9IHJlY3QuX3RvcCAqIGNvc19hOwogICAgICAgICAgICBjb25zdCByaWdodF9jb3NfYSA9IHJlY3QuX3JpZ2h0ICogY29zX2E7CiAgICAgICAgICAgIGNvbnN0IGJvdHRvbV9jb3NfYSA9IHJlY3QuX2JvdHRvbSAqCiAgICAgICAgICAgICAgICBjb3NfYTsKICAgICAgICAgICAgdGhpcy5fdGx4ID0gbGVmdF9jb3NfYSAtIHRvcF9zaW5fYTsKICAgICAgICAgICAgdGhpcy5fdGx5ID0gdG9wX2Nvc19hICsgbGVmdF9zaW5fYTsKICAgICAgICAgICAgdGhpcy5fdHJ4ID0gcmlnaHRfY29zX2EgLSB0b3Bfc2luX2E7CiAgICAgICAgICAgIHRoaXMuX3RyeSA9IHRvcF9jb3NfYSArIHJpZ2h0X3Npbl9hOwogICAgICAgICAgICB0aGlzLl9icnggPSByaWdodF9jb3NfYSAtIGJvdHRvbV9zaW5fYTsKICAgICAgICAgICAgdGhpcy5fYnJ5ID0gYm90dG9tX2Nvc19hICsgcmlnaHRfc2luX2E7CiAgICAgICAgICAgIHRoaXMuX2JseCA9IGxlZnRfY29zX2EgLSBib3R0b21fc2luX2E7CiAgICAgICAgICAgIHRoaXMuX2JseSA9IGJvdHRvbV9jb3NfYSArIGxlZnRfc2luX2EKICAgICAgICB9CiAgICAgICAgZ2V0Qm91bmRpbmdCb3gocmVjdCkgewogICAgICAgICAgICByZWN0LnNldChNYXRoLm1pbih0aGlzLl90bHgsIHRoaXMuX3RyeCwgdGhpcy5fYnJ4LCB0aGlzLl9ibHgpLCBNYXRoLm1pbih0aGlzLl90bHksIHRoaXMuX3RyeSwgdGhpcy5fYnJ5LCB0aGlzLl9ibHkpLCBNYXRoLm1heCh0aGlzLl90bHgsIHRoaXMuX3RyeCwgdGhpcy5fYnJ4LCB0aGlzLl9ibHgpLCBNYXRoLm1heCh0aGlzLl90bHksIHRoaXMuX3RyeSwgdGhpcy5fYnJ5LCB0aGlzLl9ibHkpKQogICAgICAgIH0KICAgICAgICBjb250YWluc1BvaW50KHgsCiAgICAgICAgICAgIHkpIHsKICAgICAgICAgICAgbGV0IHYweCA9IHRoaXMuX3RyeCAtIHRoaXMuX3RseDsKICAgICAgICAgICAgbGV0IHYweSA9IHRoaXMuX3RyeSAtIHRoaXMuX3RseTsKICAgICAgICAgICAgY29uc3QgdjF4ID0gdGhpcy5fYnJ4IC0gdGhpcy5fdGx4OwogICAgICAgICAgICBjb25zdCB2MXkgPSB0aGlzLl9icnkgLSB0aGlzLl90bHk7CiAgICAgICAgICAgIGNvbnN0IHYyeCA9IHggLSB0aGlzLl90bHg7CiAgICAgICAgICAgIGNvbnN0IHYyeSA9IHkgLSB0aGlzLl90bHk7CiAgICAgICAgICAgIGxldCBkb3QwMCA9IHYweCAqIHYweCArIHYweSAqIHYweTsKICAgICAgICAgICAgbGV0IGRvdDAxID0gdjB4ICogdjF4ICsgdjB5ICogdjF5OwogICAgICAgICAgICBsZXQgZG90MDIgPSB2MHggKiB2MnggKyB2MHkgKiB2Mnk7CiAgICAgICAgICAgIGNvbnN0IGRvdDExID0gdjF4ICogdjF4ICsgdjF5ICogdjF5OwogICAgICAgICAgICBjb25zdCBkb3QxMiA9IHYxeCAqIHYyeCArIHYxeSAqIHYyeTsKICAgICAgICAgICAgbGV0IGludkRlbm9tID0gMSAvIChkb3QwMCAqIGRvdDExIC0gZG90MDEgKiBkb3QwMSk7CiAgICAgICAgICAgIGxldCB1ID0gKGRvdDExICogZG90MDIgLSBkb3QwMSAqIGRvdDEyKSAqIGludkRlbm9tOwogICAgICAgICAgICBsZXQgdiA9IChkb3QwMCAqIGRvdDEyIC0gZG90MDEgKiBkb3QwMikgKiBpbnZEZW5vbTsKICAgICAgICAgICAgaWYgKHUgPj0gMCAmJiB2ID4gMCAmJiB1ICsgdiA8IDEpIHJldHVybiB0cnVlOwogICAgICAgICAgICB2MHggPSB0aGlzLl9ibHggLSB0aGlzLl90bHg7CiAgICAgICAgICAgIHYweSA9IHRoaXMuX2JseSAtIHRoaXMuX3RseTsKICAgICAgICAgICAgZG90MDAgPQogICAgICAgICAgICAgICAgdjB4ICogdjB4ICsgdjB5ICogdjB5OwogICAgICAgICAgICBkb3QwMSA9IHYweCAqIHYxeCArIHYweSAqIHYxeTsKICAgICAgICAgICAgZG90MDIgPSB2MHggKiB2MnggKyB2MHkgKiB2Mnk7CiAgICAgICAgICAgIGludkRlbm9tID0gMSAvIChkb3QwMCAqIGRvdDExIC0gZG90MDEgKiBkb3QwMSk7CiAgICAgICAgICAgIHUgPSAoZG90MTEgKiBkb3QwMiAtIGRvdDAxICogZG90MTIpICogaW52RGVub207CiAgICAgICAgICAgIHYgPSAoZG90MDAgKiBkb3QxMiAtIGRvdDAxICogZG90MDIpICogaW52RGVub207CiAgICAgICAgICAgIHJldHVybiB1ID49IDAgJiYgdiA+IDAgJiYgdSArIHYgPCAxCiAgICAgICAgfQogICAgICAgIG1pZFgoKSB7CiAgICAgICAgICAgIHJldHVybiAodGhpcy5fdGx4ICsgdGhpcy5fdHJ4ICsgdGhpcy5fYnJ4ICsgdGhpcy5fYmx4KSAvIDQKICAgICAgICB9CiAgICAgICAgbWlkWSgpIHsKICAgICAgICAgICAgcmV0dXJuICh0aGlzLl90bHkgKyB0aGlzLl90cnkgKyB0aGlzLl9icnkgKyB0aGlzLl9ibHkpIC8gNAogICAgICAgIH0KICAgICAgICBpbnRlcnNlY3RzU2VnbWVudCh4MSwgeTEsIHgyLCB5MikgewogICAgICAgICAgICBpZiAodGhpcy5jb250YWluc1BvaW50KHgxLCB5MSkgfHwgdGhpcy5jb250YWluc1BvaW50KHgyLCB5MikpIHJldHVybiB0cnVlOwogICAgICAgICAgICByZXR1cm4gQzMuc2VnbWVudEludGVyc2VjdHNRdWFkKHgxLCB5MSwgeDIsIHkyLCB0aGlzKQogICAgICAgIH0KICAgICAgICBpbnRlcnNlY3RzUXVhZChyaHMpIHsKICAgICAgICAgICAgbGV0IG1pZFggPSByaHMubWlkWCgpOwogICAgICAgICAgICBsZXQgbWlkWSA9CiAgICAgICAgICAgICAgICByaHMubWlkWSgpOwogICAgICAgICAgICBpZiAodGhpcy5jb250YWluc1BvaW50KG1pZFgsIG1pZFkpKSByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgbWlkWCA9IHRoaXMubWlkWCgpOwogICAgICAgICAgICBtaWRZID0gdGhpcy5taWRZKCk7CiAgICAgICAgICAgIGlmIChyaHMuY29udGFpbnNQb2ludChtaWRYLCBtaWRZKSkgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIGNvbnN0IHRseCA9IHRoaXMuX3RseCwKICAgICAgICAgICAgICAgIHRseSA9IHRoaXMuX3RseSwKICAgICAgICAgICAgICAgIHRyeCA9IHRoaXMuX3RyeCwKICAgICAgICAgICAgICAgIHRyeV8gPSB0aGlzLl90cnksCiAgICAgICAgICAgICAgICBicnggPSB0aGlzLl9icngsCiAgICAgICAgICAgICAgICBicnkgPSB0aGlzLl9icnksCiAgICAgICAgICAgICAgICBibHggPSB0aGlzLl9ibHgsCiAgICAgICAgICAgICAgICBibHkgPSB0aGlzLl9ibHk7CiAgICAgICAgICAgIHJldHVybiBDMy5zZWdtZW50SW50ZXJzZWN0c1F1YWQodGx4LCB0bHksIHRyeCwgdHJ5XywgcmhzKSB8fCBDMy5zZWdtZW50SW50ZXJzZWN0c1F1YWQodHJ4LCB0cnlfLCBicngsIGJyeSwgcmhzKSB8fCBDMy5zZWdtZW50SW50ZXJzZWN0c1F1YWQoYnJ4LCBicnksIGJseCwgYmx5LCByaHMpIHx8IEMzLnNlZ21lbnRJbnRlcnNlY3RzUXVhZChibHgsIGJseSwgdGx4LCB0bHksIHJocykKICAgICAgICB9CiAgICAgICAgcm90YXRlUG9pbnRzQW50aWNsb2Nrd2lzZSgpIHsKICAgICAgICAgICAgY29uc3QgdGx4ID0gdGhpcy5fdGx4OwogICAgICAgICAgICBjb25zdCB0bHkgPQogICAgICAgICAgICAgICAgdGhpcy5fdGx5OwogICAgICAgICAgICB0aGlzLl90bHggPSB0aGlzLl90cng7CiAgICAgICAgICAgIHRoaXMuX3RseSA9IHRoaXMuX3RyeTsKICAgICAgICAgICAgdGhpcy5fdHJ4ID0gdGhpcy5fYnJ4OwogICAgICAgICAgICB0aGlzLl90cnkgPSB0aGlzLl9icnk7CiAgICAgICAgICAgIHRoaXMuX2JyeCA9IHRoaXMuX2JseDsKICAgICAgICAgICAgdGhpcy5fYnJ5ID0gdGhpcy5fYmx5OwogICAgICAgICAgICB0aGlzLl9ibHggPSB0bHg7CiAgICAgICAgICAgIHRoaXMuX2JseSA9IHRseQogICAgICAgIH0KICAgICAgICBtaXJyb3IoKSB7CiAgICAgICAgICAgIHRoaXMuX3N3YXAoMCwgMik7CiAgICAgICAgICAgIHRoaXMuX3N3YXAoMSwgMyk7CiAgICAgICAgICAgIHRoaXMuX3N3YXAoNiwgNCk7CiAgICAgICAgICAgIHRoaXMuX3N3YXAoNywgNSkKICAgICAgICB9CiAgICAgICAgZmxpcCgpIHsKICAgICAgICAgICAgdGhpcy5fc3dhcCgwLCA2KTsKICAgICAgICAgICAgdGhpcy5fc3dhcCgxLCA3KTsKICAgICAgICAgICAgdGhpcy5fc3dhcCgyLCA0KTsKICAgICAgICAgICAgdGhpcy5fc3dhcCgzLCA1KQogICAgICAgIH0KICAgICAgICBkaWFnKCkgewogICAgICAgICAgICB0aGlzLl9zd2FwKDIsIDYpOwogICAgICAgICAgICB0aGlzLl9zd2FwKDMsIDcpCiAgICAgICAgfQogICAgICAgIF9zd2FwKGksIGopIHsKICAgICAgICAgICAgY29uc3QgdG1wID0gdGhpcy5fZ2V0QXRJbmRleChpKTsKICAgICAgICAgICAgdGhpcy5fc2V0QXRJbmRleChpLCB0aGlzLl9nZXRBdEluZGV4KGopKTsKICAgICAgICAgICAgdGhpcy5fc2V0QXRJbmRleChqLCB0bXApCiAgICAgICAgfQogICAgICAgIF9nZXRBdEluZGV4KGkpIHsKICAgICAgICAgICAgc3dpdGNoIChpKSB7CiAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RseDsKICAgICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fdGx5OwogICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl90cng7CiAgICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RyeTsKICAgICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fYnJ4OwogICAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9icnk7CiAgICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2JseDsKICAgICAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fYmx5OwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcigiaW52YWxpZCBxdWFkIHBvaW50IGluZGV4Iik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgX3NldEF0SW5kZXgoaSwgdikgewogICAgICAgICAgICB2ID0gK3Y7CiAgICAgICAgICAgIHN3aXRjaCAoaSkgewogICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgIHRoaXMuX3RseCA9IHY7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGx5ID0gdjsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgICAgICB0aGlzLl90cnggPSB2OwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgICAgIHRoaXMuX3RyeSA9IHY7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYnJ4ID0gdjsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgICAgICB0aGlzLl9icnkgPSB2OwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgICAgICAgIHRoaXMuX2JseCA9IHY7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYmx5ID0gdjsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoImludmFsaWQgcXVhZCBwb2ludCBpbmRleCIpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKCn0KCi8vIGxpYi9taXNjL2NvbGxpc2lvblBvbHkuanMKewogICAgJ3VzZSBzdHJpY3QnOwogICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgY29uc3QgYXNzZXJ0ID0gc2VsZi5hc3NlcnQ7CiAgICBjb25zdCBERUZBVUxUX1BPTFlfUE9JTlRTID0gWzAsIDAsIDEsIDAsIDEsIDEsIDAsIDFdOwogICAgY29uc3QgdGVtcFF1YWQgPSBDMy5OZXcoQzMuUXVhZCk7CiAgICBDMy5Db2xsaXNpb25Qb2x5ID0gY2xhc3MgQ29sbGlzaW9uUG9seSBleHRlbmRzIEMzLkRlZmVuZGVkQmFzZSB7CiAgICAgICAgY29uc3RydWN0b3IocG9pbnRzQXJyLCBlbmFibGVkID0gdHJ1ZSkgewogICAgICAgICAgICBzdXBlcigpOwogICAgICAgICAgICBpZiAoIXBvaW50c0FycikgcG9pbnRzQXJyID0gREVGQVVMVF9QT0xZX1BPSU5UUzsKICAgICAgICAgICAgdGhpcy5fcHRzQXJyID0gRmxvYXQ2NEFycmF5LmZyb20ocG9pbnRzQXJyKTsKICAgICAgICAgICAgdGhpcy5fYmJveCA9IG5ldyBDMy5SZWN0OwogICAgICAgICAgICB0aGlzLl9pc0Jib3hDaGFuZ2VkID0gdHJ1ZTsKICAgICAgICAgICAgdGhpcy5fZW5hYmxlZCA9IGVuYWJsZWQKICAgICAgICB9CiAgICAgICAgUmVsZWFzZSgpIHt9CiAgICAgICAgcG9pbnRzQXJyKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fcHRzQXJyCiAgICAgICAgfQogICAgICAgIHBvaW50Q291bnQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9wdHNBcnIubGVuZ3RoIC8gMgogICAgICAgIH0KICAgICAgICBzZXRQb2ludHMocG9pbnRzQXJyKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9wdHNBcnIubGVuZ3RoID09PSBwb2ludHNBcnIubGVuZ3RoKSB0aGlzLl9wdHNBcnIuc2V0KHBvaW50c0Fycik7CiAgICAgICAgICAgIGVsc2UgdGhpcy5fcHRzQXJyID0gRmxvYXQ2NEFycmF5LmZyb20ocG9pbnRzQXJyKTsKICAgICAgICAgICAgdGhpcy5faXNCYm94Q2hhbmdlZCA9CiAgICAgICAgICAgICAgICB0cnVlCiAgICAgICAgfQogICAgICAgIHNldERlZmF1bHRQb2ludHMoKSB7CiAgICAgICAgICAgIHRoaXMuc2V0UG9pbnRzKERFRkFVTFRfUE9MWV9QT0lOVFMpCiAgICAgICAgfQogICAgICAgIGNvcHkocG9seSkgewogICAgICAgICAgICB0aGlzLnNldFBvaW50cyhwb2x5Ll9wdHNBcnIpCiAgICAgICAgfQogICAgICAgIHNldEJib3hDaGFuZ2VkKCkgewogICAgICAgICAgICB0aGlzLl9pc0Jib3hDaGFuZ2VkID0gdHJ1ZQogICAgICAgIH0KICAgICAgICBfdXBkYXRlQmJveCgpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLl9pc0Jib3hDaGFuZ2VkKSByZXR1cm47CiAgICAgICAgICAgIGNvbnN0IHB0c0FyciA9IHRoaXMuX3B0c0FycjsKICAgICAgICAgICAgbGV0IGxlZnQgPSBwdHNBcnJbMF07CiAgICAgICAgICAgIGxldCB0b3AgPSBwdHNBcnJbMV07CiAgICAgICAgICAgIGxldCByaWdodCA9IGxlZnQ7CiAgICAgICAgICAgIGxldCBib3R0b20gPSB0b3A7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBwdHNBcnIubGVuZ3RoOyBpIDwgbGVuOyBpICs9IDIpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHggPSBwdHNBcnJbaV07CiAgICAgICAgICAgICAgICBjb25zdCB5ID0gcHRzQXJyW2kgKyAxXTsKICAgICAgICAgICAgICAgIGlmICh4IDwgbGVmdCkgbGVmdCA9IHg7CiAgICAgICAgICAgICAgICBpZiAoeCA+IHJpZ2h0KSByaWdodCA9IHg7CiAgICAgICAgICAgICAgICBpZiAoeSA8IHRvcCkgdG9wID0geTsKICAgICAgICAgICAgICAgIGlmICh5ID4gYm90dG9tKSBib3R0b20gPSB5CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5fYmJveC5zZXQobGVmdCwgdG9wLCByaWdodCwgYm90dG9tKTsKICAgICAgICAgICAgdGhpcy5faXNCYm94Q2hhbmdlZCA9IGZhbHNlCiAgICAgICAgfQogICAgICAgIHNldEZyb21SZWN0KHJjLAogICAgICAgICAgICBvZmZYLCBvZmZZKSB7CiAgICAgICAgICAgIGxldCBwdHNBcnIgPSB0aGlzLl9wdHNBcnI7CiAgICAgICAgICAgIGlmIChwdHNBcnIubGVuZ3RoICE9PSA4KSB7CiAgICAgICAgICAgICAgICBwdHNBcnIgPSBuZXcgRmxvYXQ2NEFycmF5KDgpOwogICAgICAgICAgICAgICAgdGhpcy5fcHRzQXJyID0gcHRzQXJyCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcHRzQXJyWzBdID0gcmMuZ2V0TGVmdCgpIC0gb2ZmWDsKICAgICAgICAgICAgcHRzQXJyWzFdID0gcmMuZ2V0VG9wKCkgLSBvZmZZOwogICAgICAgICAgICBwdHNBcnJbMl0gPSByYy5nZXRSaWdodCgpIC0gb2ZmWDsKICAgICAgICAgICAgcHRzQXJyWzNdID0gcmMuZ2V0VG9wKCkgLSBvZmZZOwogICAgICAgICAgICBwdHNBcnJbNF0gPSByYy5nZXRSaWdodCgpIC0gb2ZmWDsKICAgICAgICAgICAgcHRzQXJyWzVdID0gcmMuZ2V0Qm90dG9tKCkgLSBvZmZZOwogICAgICAgICAgICBwdHNBcnJbNl0gPSByYy5nZXRMZWZ0KCkgLSBvZmZYOwogICAgICAgICAgICBwdHNBcnJbN10gPSByYy5nZXRCb3R0b20oKSAtIG9mZlk7CiAgICAgICAgICAgIHRoaXMuX2Jib3guY29weShyYyk7CiAgICAgICAgICAgIGlmIChvZmZYICE9PSAwIHx8IG9mZlkgIT09IDApIHRoaXMuX2Jib3gub2Zmc2V0KC1vZmZYLCAtb2ZmWSk7CiAgICAgICAgICAgIHRoaXMuX2lzQmJveENoYW5nZWQgPSBmYWxzZQogICAgICAgIH0KICAgICAgICBzZXRGcm9tUXVhZChxLCBvZmZYLCBvZmZZKSB7CiAgICAgICAgICAgIHRlbXBRdWFkLmNvcHkocSk7CiAgICAgICAgICAgIHRlbXBRdWFkLm9mZnNldChvZmZYLCBvZmZZKTsKICAgICAgICAgICAgdGhpcy5zZXRQb2ludHModGVtcFF1YWQudG9BcnJheSgpKTsKICAgICAgICAgICAgdGhpcy5faXNCYm94Q2hhbmdlZCA9IHRydWUKICAgICAgICB9CiAgICAgICAgdHJhbnNmb3JtKHcsIGgsIGEpIHsKICAgICAgICAgICAgbGV0IHNpbmEgPSAwOwogICAgICAgICAgICBsZXQgY29zYSA9IDE7CiAgICAgICAgICAgIGlmIChhICE9PSAwKSB7CiAgICAgICAgICAgICAgICBzaW5hID0gTWF0aC5zaW4oYSk7CiAgICAgICAgICAgICAgICBjb3NhID0gTWF0aC5jb3MoYSkKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLnRyYW5zZm9ybVByZWNhbGModywgaCwgc2luYSwgY29zYSkKICAgICAgICB9CiAgICAgICAgdHJhbnNmb3JtUHJlY2FsYyh3LCBoLCBzaW5hLCBjb3NhKSB7CiAgICAgICAgICAgIGNvbnN0IHB0c0FyciA9IHRoaXMuX3B0c0FycjsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IHB0c0Fyci5sZW5ndGg7IGkgPCBsZW47IGkgKz0gMikgewogICAgICAgICAgICAgICAgY29uc3QgaiA9IGkgKyAxOwogICAgICAgICAgICAgICAgY29uc3QgeCA9IHB0c0FycltpXSAqIHc7CiAgICAgICAgICAgICAgICBjb25zdCB5ID0gcHRzQXJyW2pdICogaDsKICAgICAgICAgICAgICAgIHB0c0FycltpXSA9IHggKiBjb3NhIC0geSAqIHNpbmE7CiAgICAgICAgICAgICAgICBwdHNBcnJbal0gPSB5ICogY29zYSArIHggKiBzaW5hCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5faXNCYm94Q2hhbmdlZCA9IHRydWUKICAgICAgICB9CiAgICAgICAgb2Zmc2V0KHgsIHkpIHsKICAgICAgICAgICAgY29uc3QgcHRzQXJyID0gdGhpcy5fcHRzQXJyOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gcHRzQXJyLmxlbmd0aDsgaSA8IGxlbjsgaSArPSAyKSB7CiAgICAgICAgICAgICAgICBwdHNBcnJbaV0gKz0geDsKICAgICAgICAgICAgICAgIHB0c0FycltpICsgMV0gKz0geQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNvbnRhaW5zUG9pbnQoYTJ4LCBhMnkpIHsKICAgICAgICAgICAgY29uc3QgcHRzQXJyID0KICAgICAgICAgICAgICAgIHRoaXMuX3B0c0FycjsKICAgICAgICAgICAgaWYgKGEyeCA9PT0gcHRzQXJyWzBdICYmIGEyeSA9PT0gcHRzQXJyWzFdKSByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgdGhpcy5fdXBkYXRlQmJveCgpOwogICAgICAgICAgICBjb25zdCBiYm94ID0gdGhpcy5fYmJveDsKICAgICAgICAgICAgY29uc3QgYTF4ID0gYmJveC5nZXRMZWZ0KCkgLSAxMTA7CiAgICAgICAgICAgIGNvbnN0IGExeSA9IGJib3guZ2V0VG9wKCkgLSAxMDE7CiAgICAgICAgICAgIGNvbnN0IGEzeCA9IGJib3guZ2V0UmlnaHQoKSArIDEzMTsKICAgICAgICAgICAgY29uc3QgYTN5ID0gYmJveC5nZXRCb3R0b20oKSArIDEyMDsKICAgICAgICAgICAgbGV0IG1pbkF4MTIgPSAwOwogICAgICAgICAgICBsZXQgbWluQXkxMiA9IDA7CiAgICAgICAgICAgIGxldCBtYXhBeDEyID0gMDsKICAgICAgICAgICAgbGV0IG1heEF5MTIgPSAwOwogICAgICAgICAgICBsZXQgbWluQXgzMiA9IDA7CiAgICAgICAgICAgIGxldCBtaW5BeTMyID0gMDsKICAgICAgICAgICAgbGV0IG1heEF4MzIgPSAwOwogICAgICAgICAgICBsZXQgbWF4QXkzMiA9IDA7CiAgICAgICAgICAgIGlmIChhMXggPCBhMngpIHsKICAgICAgICAgICAgICAgIG1pbkF4MTIgPSBhMXg7CiAgICAgICAgICAgICAgICBtYXhBeDEyID0gYTJ4CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBtaW5BeDEyID0gYTJ4OwogICAgICAgICAgICAgICAgbWF4QXgxMiA9IGExeAogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChhMXkgPCBhMnkpIHsKICAgICAgICAgICAgICAgIG1pbkF5MTIgPSBhMXk7CiAgICAgICAgICAgICAgICBtYXhBeTEyID0gYTJ5CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBtaW5BeTEyID0gYTJ5OwogICAgICAgICAgICAgICAgbWF4QXkxMiA9IGExeQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChhM3ggPCBhMngpIHsKICAgICAgICAgICAgICAgIG1pbkF4MzIgPSBhM3g7CiAgICAgICAgICAgICAgICBtYXhBeDMyID0gYTJ4CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBtaW5BeDMyID0KICAgICAgICAgICAgICAgICAgICBhMng7CiAgICAgICAgICAgICAgICBtYXhBeDMyID0gYTN4CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGEzeSA8IGEyeSkgewogICAgICAgICAgICAgICAgbWluQXkzMiA9IGEzeTsKICAgICAgICAgICAgICAgIG1heEF5MzIgPSBhMnkKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG1pbkF5MzIgPSBhMnk7CiAgICAgICAgICAgICAgICBtYXhBeTMyID0gYTN5CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGV0IGNvdW50MSA9IDA7CiAgICAgICAgICAgIGxldCBjb3VudDIgPSAwOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gcHRzQXJyLmxlbmd0aDsgaSA8IGxlbjsgaSArPSAyKSB7CiAgICAgICAgICAgICAgICBjb25zdCBqID0gKGkgKyAyKSAlIGxlbjsKICAgICAgICAgICAgICAgIGNvbnN0IGIxeCA9IHB0c0FycltpXTsKICAgICAgICAgICAgICAgIGNvbnN0IGIxeSA9IHB0c0FycltpICsgMV07CiAgICAgICAgICAgICAgICBjb25zdCBiMnggPSBwdHNBcnJbal07CiAgICAgICAgICAgICAgICBjb25zdCBiMnkgPSBwdHNBcnJbaiArIDFdOwogICAgICAgICAgICAgICAgaWYgKEMzLnNlZ21lbnRzSW50ZXJzZWN0UHJlQ2FsYyhhMXgsIGExeSwgYTJ4LCBhMnksIG1pbkF4MTIsIG1heEF4MTIsIG1pbkF5MTIsIG1heEF5MTIsIGIxeCwgYjF5LCBiMngsIGIyeSkpICsrY291bnQxOwogICAgICAgICAgICAgICAgaWYgKEMzLnNlZ21lbnRzSW50ZXJzZWN0UHJlQ2FsYyhhM3gsIGEzeSwgYTJ4LCBhMnksIG1pbkF4MzIsIG1heEF4MzIsIG1pbkF5MzIsIG1heEF5MzIsIGIxeCwgYjF5LCBiMngsIGIyeSkpICsrY291bnQyCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGNvdW50MSAlIDIgPT09IDEgfHwgY291bnQyICUgMiA9PT0gMQogICAgICAgIH0KICAgICAgICBpbnRlcnNlY3RzUG9seShwb2x5LAogICAgICAgICAgICBvZmZYLCBvZmZZKSB7CiAgICAgICAgICAgIGNvbnN0IHJQdHMgPSBwb2x5Ll9wdHNBcnI7CiAgICAgICAgICAgIGNvbnN0IGxQdHMgPSB0aGlzLl9wdHNBcnI7CiAgICAgICAgICAgIGlmICh0aGlzLmNvbnRhaW5zUG9pbnQoclB0c1swXSArIG9mZlgsIHJQdHNbMV0gKyBvZmZZKSkgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIGlmIChwb2x5LmNvbnRhaW5zUG9pbnQobFB0c1swXSAtIG9mZlgsIGxQdHNbMV0gLSBvZmZZKSkgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW5pID0gbFB0cy5sZW5ndGg7IGkgPCBsZW5pOyBpICs9IDIpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGogPSAoaSArIDIpICUgbGVuaTsKICAgICAgICAgICAgICAgIGNvbnN0IGExeCA9IGxQdHNbaV07CiAgICAgICAgICAgICAgICBjb25zdCBhMXkgPSBsUHRzW2kgKyAxXTsKICAgICAgICAgICAgICAgIGNvbnN0IGEyeCA9IGxQdHNbal07CiAgICAgICAgICAgICAgICBjb25zdCBhMnkgPSBsUHRzW2ogKyAxXTsKICAgICAgICAgICAgICAgIGxldCBtaW5BeCA9IDA7CiAgICAgICAgICAgICAgICBsZXQgbWluQXkgPSAwOwogICAgICAgICAgICAgICAgbGV0IG1heEF4ID0gMDsKICAgICAgICAgICAgICAgIGxldCBtYXhBeSA9IDA7CiAgICAgICAgICAgICAgICBpZiAoYTF4IDwgYTJ4KSB7CiAgICAgICAgICAgICAgICAgICAgbWluQXggPSBhMXg7CiAgICAgICAgICAgICAgICAgICAgbWF4QXggPSBhMngKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbWluQXggPSBhMng7CiAgICAgICAgICAgICAgICAgICAgbWF4QXggPSBhMXgKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChhMXkgPCBhMnkpIHsKICAgICAgICAgICAgICAgICAgICBtaW5BeSA9IGExeTsKICAgICAgICAgICAgICAgICAgICBtYXhBeSA9IGEyeQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBtaW5BeSA9IGEyeTsKICAgICAgICAgICAgICAgICAgICBtYXhBeSA9IGExeQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZm9yIChsZXQgayA9IDAsIGxlbmsgPSByUHRzLmxlbmd0aDsgayA8CiAgICAgICAgICAgICAgICAgICAgbGVuazsgayArPSAyKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgbCA9IChrICsgMikgJSBsZW5rOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGIxeCA9IHJQdHNba10gKyBvZmZYOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGIxeSA9IHJQdHNbayArIDFdICsgb2ZmWTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBiMnggPSByUHRzW2xdICsgb2ZmWDsKICAgICAgICAgICAgICAgICAgICBjb25zdCBiMnkgPSByUHRzW2wgKyAxXSArIG9mZlk7CiAgICAgICAgICAgICAgICAgICAgaWYgKEMzLnNlZ21lbnRzSW50ZXJzZWN0UHJlQ2FsYyhhMXgsIGExeSwgYTJ4LCBhMnksIG1pbkF4LCBtYXhBeCwgbWluQXksIG1heEF5LCBiMXgsIGIxeSwgYjJ4LCBiMnkpKSByZXR1cm4gdHJ1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZQogICAgICAgIH0KICAgICAgICBpbnRlcnNlY3RzU2VnbWVudChvZmZYLCBvZmZZLCBhMXgsIGExeSwgYTJ4LCBhMnkpIHsKICAgICAgICAgICAgaWYgKHRoaXMuY29udGFpbnNQb2ludChhMXggLSBvZmZYLCBhMXkgLSBvZmZZKSkgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIGlmICh0aGlzLmNvbnRhaW5zUG9pbnQoYTJ4IC0gb2ZmWCwgYTJ5IC0gb2ZmWSkpIHJldHVybiB0cnVlOwogICAgICAgICAgICBsZXQgbWluQXggPSAwOwogICAgICAgICAgICBsZXQgbWluQXkgPSAwOwogICAgICAgICAgICBsZXQgbWF4QXggPSAwOwogICAgICAgICAgICBsZXQgbWF4QXkgPSAwOwogICAgICAgICAgICBpZiAoYTF4IDwgYTJ4KSB7CiAgICAgICAgICAgICAgICBtaW5BeCA9IGExeDsKICAgICAgICAgICAgICAgIG1heEF4ID0gYTJ4CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBtaW5BeCA9IGEyeDsKICAgICAgICAgICAgICAgIG1heEF4ID0gYTF4CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGExeSA8CiAgICAgICAgICAgICAgICBhMnkpIHsKICAgICAgICAgICAgICAgIG1pbkF5ID0gYTF5OwogICAgICAgICAgICAgICAgbWF4QXkgPSBhMnkKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG1pbkF5ID0gYTJ5OwogICAgICAgICAgICAgICAgbWF4QXkgPSBhMXkKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBwdHNBcnIgPSB0aGlzLl9wdHNBcnI7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBwdHNBcnIubGVuZ3RoOyBpIDwgbGVuOyBpICs9IDIpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGogPSAoaSArIDIpICUgbGVuOwogICAgICAgICAgICAgICAgY29uc3QgYjF4ID0gcHRzQXJyW2ldICsgb2ZmWDsKICAgICAgICAgICAgICAgIGNvbnN0IGIxeSA9IHB0c0FycltpICsgMV0gKyBvZmZZOwogICAgICAgICAgICAgICAgY29uc3QgYjJ4ID0gcHRzQXJyW2pdICsgb2ZmWDsKICAgICAgICAgICAgICAgIGNvbnN0IGIyeSA9IHB0c0FycltqICsgMV0gKyBvZmZZOwogICAgICAgICAgICAgICAgaWYgKEMzLnNlZ21lbnRzSW50ZXJzZWN0UHJlQ2FsYyhhMXgsIGExeSwgYTJ4LCBhMnksIG1pbkF4LCBtYXhBeCwgbWluQXksIG1heEF5LCBiMXgsIGIxeSwgYjJ4LCBiMnkpKSByZXR1cm4gdHJ1ZQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZQogICAgICAgIH0KICAgICAgICBtaXJyb3IocHgpIHsKICAgICAgICAgICAgY29uc3QgcHRzQXJyID0gdGhpcy5fcHRzQXJyOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gcHRzQXJyLmxlbmd0aDsgaSA8IGxlbjsgaSArPSAyKSBwdHNBcnJbaV0gPSBweCAqIDIgLSBwdHNBcnJbaV07CiAgICAgICAgICAgIHRoaXMuX2lzQmJveENoYW5nZWQgPSB0cnVlCiAgICAgICAgfQogICAgICAgIGZsaXAocHkpIHsKICAgICAgICAgICAgY29uc3QgcHRzQXJyID0KICAgICAgICAgICAgICAgIHRoaXMuX3B0c0FycjsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IHB0c0Fyci5sZW5ndGg7IGkgPCBsZW47IGkgKz0gMikgewogICAgICAgICAgICAgICAgY29uc3QgaiA9IGkgKyAxOwogICAgICAgICAgICAgICAgcHRzQXJyW2pdID0gcHkgKiAyIC0gcHRzQXJyW2pdCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5faXNCYm94Q2hhbmdlZCA9IHRydWUKICAgICAgICB9CiAgICAgICAgZGlhZygpIHsKICAgICAgICAgICAgY29uc3QgcHRzQXJyID0gdGhpcy5fcHRzQXJyOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gcHRzQXJyLmxlbmd0aDsgaSA8IGxlbjsgaSArPSAyKSB7CiAgICAgICAgICAgICAgICBjb25zdCBqID0gaSArIDE7CiAgICAgICAgICAgICAgICBjb25zdCB0ZW1wID0gcHRzQXJyW2ldOwogICAgICAgICAgICAgICAgcHRzQXJyW2ldID0gcHRzQXJyW2pdOwogICAgICAgICAgICAgICAgcHRzQXJyW2pdID0gdGVtcAogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuX2lzQmJveENoYW5nZWQgPSB0cnVlCiAgICAgICAgfQogICAgICAgIEdldE1pZFgoKSB7CiAgICAgICAgICAgIGNvbnN0IHB0c0FyciA9IHRoaXMuX3B0c0FycjsKICAgICAgICAgICAgbGV0IHJldCA9IDA7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBwdHNBcnIubGVuZ3RoOyBpIDwgbGVuOyBpICs9IDIpIHJldCArPSBwdHNBcnJbaV07CiAgICAgICAgICAgIHJldHVybiByZXQgLyB0aGlzLnBvaW50Q291bnQoKQogICAgICAgIH0KICAgICAgICBHZXRNaWRZKCkgewogICAgICAgICAgICBjb25zdCBwdHNBcnIgPSB0aGlzLl9wdHNBcnI7CiAgICAgICAgICAgIGxldCByZXQgPSAwOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gcHRzQXJyLmxlbmd0aDsgaSA8IGxlbjsgaSArPQogICAgICAgICAgICAgICAgMikgcmV0ICs9IHB0c0FycltpICsgMV07CiAgICAgICAgICAgIHJldHVybiByZXQgLyB0aGlzLnBvaW50Q291bnQoKQogICAgICAgIH0KICAgICAgICBHZXRQb2ludHNBcnJheSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3B0c0FycgogICAgICAgIH0KICAgICAgICBHZXRQb2ludENvdW50KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5wb2ludENvdW50KCkKICAgICAgICB9CiAgICAgICAgSXNFbmFibGVkKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZW5hYmxlZAogICAgICAgIH0KICAgIH07Cgp9CgovLyBsaWIvbWlzYy9wYWlyTWFwLmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIEMzLlBhaXJNYXAgPSBjbGFzcyBQYWlyTWFwIGV4dGVuZHMgQzMuRGVmZW5kZWRCYXNlIHsKICAgICAgICBjb25zdHJ1Y3RvcihpdGVyYWJsZSkgewogICAgICAgICAgICBzdXBlcigpOwogICAgICAgICAgICB0aGlzLl9maXJzdE1hcCA9IG5ldyBNYXA7CiAgICAgICAgICAgIGlmIChpdGVyYWJsZSkKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgW3gsIHksIHZhbHVlXSBvZiBpdGVyYWJsZSkgdGhpcy5TZXQoeCwgeSwgdmFsdWUpCiAgICAgICAgfQogICAgICAgIFJlbGVhc2UoKSB7CiAgICAgICAgICAgIHRoaXMuQ2xlYXIoKTsKICAgICAgICAgICAgdGhpcy5fZmlyc3RNYXAgPSBudWxsCiAgICAgICAgfQogICAgICAgIENsZWFyKCkgewogICAgICAgICAgICBjb25zdCBmaXJzdE1hcCA9IHRoaXMuX2ZpcnN0TWFwOwogICAgICAgICAgICBmb3IgKGNvbnN0IHNlY29uZE1hcCBvZiBmaXJzdE1hcC52YWx1ZXMoKSkgc2Vjb25kTWFwLmNsZWFyKCk7CiAgICAgICAgICAgIGZpcnN0TWFwLmNsZWFyKCkKICAgICAgICB9CiAgICAgICAgU2V0KHgsIHksIHZhbHVlKSB7CiAgICAgICAgICAgIGNvbnN0IGZpcnN0TWFwID0gdGhpcy5fZmlyc3RNYXA7CiAgICAgICAgICAgIGxldCBzZWNvbmRNYXAgPSBmaXJzdE1hcC5nZXQoeCk7CiAgICAgICAgICAgIGlmICghc2Vjb25kTWFwKSB7CiAgICAgICAgICAgICAgICBzZWNvbmRNYXAgPSBuZXcgTWFwOwogICAgICAgICAgICAgICAgZmlyc3RNYXAuc2V0KHgsIHNlY29uZE1hcCkKICAgICAgICAgICAgfQogICAgICAgICAgICBzZWNvbmRNYXAuc2V0KHksIHZhbHVlKQogICAgICAgIH0KICAgICAgICBHZXQoeCwgeSkgewogICAgICAgICAgICBjb25zdCBzZWNvbmRNYXAgPQogICAgICAgICAgICAgICAgdGhpcy5fZmlyc3RNYXAuZ2V0KHgpOwogICAgICAgICAgICBpZiAoIXNlY29uZE1hcCkgcmV0dXJuIHNlY29uZE1hcDsKICAgICAgICAgICAgcmV0dXJuIHNlY29uZE1hcC5nZXQoeSkKICAgICAgICB9CiAgICAgICAgSGFzKHgsIHkpIHsKICAgICAgICAgICAgY29uc3Qgc2Vjb25kTWFwID0gdGhpcy5fZmlyc3RNYXAuZ2V0KHgpOwogICAgICAgICAgICBpZiAoIXNlY29uZE1hcCkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICByZXR1cm4gc2Vjb25kTWFwLmhhcyh5KQogICAgICAgIH0KICAgICAgICBEZWxldGUoeCwgeSkgewogICAgICAgICAgICBjb25zdCBmaXJzdE1hcCA9IHRoaXMuX2ZpcnN0TWFwOwogICAgICAgICAgICBjb25zdCBzZWNvbmRNYXAgPSBmaXJzdE1hcC5nZXQoeCk7CiAgICAgICAgICAgIGlmICghc2Vjb25kTWFwKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGNvbnN0IHJldCA9IHNlY29uZE1hcC5kZWxldGUoeSk7CiAgICAgICAgICAgIGlmIChyZXQgJiYgc2Vjb25kTWFwLnNpemUgPT09IDApIGZpcnN0TWFwLmRlbGV0ZSh4KTsKICAgICAgICAgICAgcmV0dXJuIHJldAogICAgICAgIH0KICAgICAgICBEZWxldGVFaXRoZXIoaykgewogICAgICAgICAgICBjb25zdCBmaXJzdE1hcCA9IHRoaXMuX2ZpcnN0TWFwOwogICAgICAgICAgICBjb25zdCBzZWNvbmRNYXAgPSBmaXJzdE1hcC5nZXQoayk7CiAgICAgICAgICAgIGlmIChzZWNvbmRNYXApIHsKICAgICAgICAgICAgICAgIHNlY29uZE1hcC5jbGVhcigpOwogICAgICAgICAgICAgICAgZmlyc3RNYXAuZGVsZXRlKGspCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yIChjb25zdCBbeCwKICAgICAgICAgICAgICAgICAgICBzZWNvbmRNYXAKICAgICAgICAgICAgICAgIF0gb2YgZmlyc3RNYXAuZW50cmllcygpKQogICAgICAgICAgICAgICAgaWYgKHNlY29uZE1hcC5kZWxldGUoaykgJiYgc2Vjb25kTWFwLnNpemUgPT09IDApIGZpcnN0TWFwLmRlbGV0ZSh4KQogICAgICAgIH0KICAgICAgICBHZXRTaXplKCkgewogICAgICAgICAgICBsZXQgcmV0ID0gMDsKICAgICAgICAgICAgZm9yIChjb25zdCBzZWNvbmRNYXAgb2YgdGhpcy5fZmlyc3RNYXAudmFsdWVzKCkpIHJldCArPSBzZWNvbmRNYXAuc2l6ZTsKICAgICAgICAgICAgcmV0dXJuIHJldAogICAgICAgIH0qIHZhbHVlcygpIHsKICAgICAgICAgICAgZm9yIChjb25zdCBzZWNvbmRNYXAgb2YgdGhpcy5fZmlyc3RNYXAudmFsdWVzKCkpIHlpZWxkKiBzZWNvbmRNYXAudmFsdWVzKCkKICAgICAgICB9KiBrZXlQYWlycygpIHsKICAgICAgICAgICAgZm9yIChjb25zdCBbeCwgc2Vjb25kTWFwXSBvZiB0aGlzLl9maXJzdE1hcC5lbnRyaWVzKCkpCiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHkgb2Ygc2Vjb25kTWFwLmtleXMoKSkgeWllbGQgW3gsIHldCiAgICAgICAgfSogZW50cmllcygpIHsKICAgICAgICAgICAgZm9yIChjb25zdCBbeCwgc2Vjb25kTWFwXSBvZiB0aGlzLl9maXJzdE1hcC5lbnRyaWVzKCkpCiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IFt5LCB2YWx1ZV0gb2Ygc2Vjb25kTWFwLmVudHJpZXMoKSkgeWllbGQgW3gsIHksIHZhbHVlXQogICAgICAgIH0KICAgIH07Cgp9CgovLyBsaWIvbWlzYy9hcnJheVNldC5qcwp7CiAgICAndXNlIHN0cmljdCc7CiAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICBDMy5BcnJheVNldCA9IGNsYXNzIEFycmF5U2V0IGV4dGVuZHMgQzMuRGVmZW5kZWRCYXNlIHsKICAgICAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgICAgICAgc3VwZXIoKTsKICAgICAgICAgICAgdGhpcy5fc2V0ID0gbmV3IFNldDsKICAgICAgICAgICAgdGhpcy5fYXJyID0gW107CiAgICAgICAgICAgIHRoaXMuX25lZWRUb1JlYnVpbGRBcnJheSA9IGZhbHNlCiAgICAgICAgfQogICAgICAgIFJlbGVhc2UoKSB7CiAgICAgICAgICAgIHRoaXMuQ2xlYXIoKQogICAgICAgIH0KICAgICAgICBDbGVhcigpIHsKICAgICAgICAgICAgdGhpcy5fc2V0LmNsZWFyKCk7CiAgICAgICAgICAgIEMzLmNsZWFyQXJyYXkodGhpcy5fYXJyKTsKICAgICAgICAgICAgdGhpcy5fbmVlZFRvUmVidWlsZEFycmF5ID0gZmFsc2UKICAgICAgICB9CiAgICAgICAgQWRkKHYpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX3NldC5oYXModikpIHJldHVybjsKICAgICAgICAgICAgdGhpcy5fc2V0LmFkZCh2KTsKICAgICAgICAgICAgaWYgKCF0aGlzLl9uZWVkVG9SZWJ1aWxkQXJyYXkpIHRoaXMuX2Fyci5wdXNoKHYpCiAgICAgICAgfQogICAgICAgIEhhcyh2KSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zZXQuaGFzKHYpCiAgICAgICAgfQogICAgICAgIERlbGV0ZSh2KSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9zZXQuZGVsZXRlKHYpKSB0aGlzLl9uZWVkVG9SZWJ1aWxkQXJyYXkgPSB0cnVlCiAgICAgICAgfQogICAgICAgIEdldFNpemUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zZXQuc2l6ZQogICAgICAgIH0KICAgICAgICBJc0VtcHR5KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fc2V0LnNpemUgPT09IDAKICAgICAgICB9CiAgICAgICAgR2V0QXJyYXkoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9uZWVkVG9SZWJ1aWxkQXJyYXkpIHsKICAgICAgICAgICAgICAgIHRoaXMuX1JlYnVpbGRBcnJheSgpOwogICAgICAgICAgICAgICAgdGhpcy5fbmVlZFRvUmVidWlsZEFycmF5ID0gZmFsc2UKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdGhpcy5fYXJyCiAgICAgICAgfQogICAgICAgIF9SZWJ1aWxkQXJyYXkoKSB7CiAgICAgICAgICAgIGNvbnN0IGFyciA9IHRoaXMuX2FycjsKICAgICAgICAgICAgQzMuY2xlYXJBcnJheShhcnIpOwogICAgICAgICAgICBmb3IgKGNvbnN0IHYgb2YgdGhpcy5fc2V0KSBhcnIucHVzaCh2KQogICAgICAgIH0KICAgIH07Cgp9CgovLyAuLi9saWIvbWlzYy9lYXNlLmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIGNvbnN0IEVBU0VfTUFQID0gbmV3IE1hcDsKICAgIGNvbnN0IFBSRURFRklORURfRUFTRV9NQVAgPSBuZXcgTWFwOwogICAgY29uc3QgQ1VTVE9NX0VBU0VfRURJVE9SX01BUCA9IG5ldyBNYXA7CiAgICBjb25zdCBDVVNUT01fRUFTRV9SVU5USU1FX01BUCA9IG5ldyBNYXA7CiAgICBjb25zdCBQUklWQVRFX0VBU0VfTUFQID0gbmV3IE1hcDsKICAgIGNvbnN0IEJVSUxUX0lOX1RSQU5TSVRJT05fTUFQID0gbmV3IE1hcDsKICAgIGNvbnN0IEFMSUFTX01BUCA9IG5ldyBNYXA7CiAgICBBTElBU19NQVAuc2V0KCJsaW5lYXIiLCAibm9lYXNlIik7CiAgICBBTElBU19NQVAuc2V0KCJkZWZhdWx0IiwgIm5vZWFzZSIpOwogICAgY29uc3QgRUFTRV9UUkFOU0xBVElPTl9LRVlTID0gWyJkZWZhdWx0IiwgIm5vZWFzZSIsICJlYXNlaW5xdWFkIiwgImVhc2VvdXRxdWFkIiwgImVhc2Vpbm91dHF1YWQiLCAiZWFzZWluY3ViaWMiLCAiZWFzZW91dGN1YmljIiwgImVhc2Vpbm91dGN1YmljIiwgImVhc2VpbnF1YXJ0IiwgImVhc2VvdXRxdWFydCIsICJlYXNlaW5vdXRxdWFydCIsICJlYXNlaW5xdWludCIsICJlYXNlb3V0cXVpbnQiLCAiZWFzZWlub3V0cXVpbnQiLCAiZWFzZWluc2luZSIsICJlYXNlb3V0c2luZSIsICJlYXNlaW5vdXRzaW5lIiwgImVhc2VpbmV4cG8iLCAiZWFzZW91dGV4cG8iLCAiZWFzZWlub3V0ZXhwbyIsICJlYXNlaW5jaXJjIiwgImVhc2VvdXRjaXJjIiwgImVhc2Vpbm91dGNpcmMiLCAiZWFzZWluZWxhc3RpYyIsICJlYXNlb3V0ZWxhc3RpYyIsICJlYXNlaW5vdXRlbGFzdGljIiwgImVhc2VpbmJhY2siLCAiZWFzZW91dGJhY2siLCAiZWFzZWlub3V0YmFjayIsICJlYXNlaW5ib3VuY2UiLCAiZWFzZW91dGJvdW5jZSIsICJlYXNlaW5vdXRib3VuY2UiXTsKICAgIGNvbnN0IFNIT1JUX0VBU0VfVFJBTlNMQVRJT05fS0VZUyA9IFsiZGVmYXVsdCIsICJub2Vhc2UiLCAicXVhZCIsICJjdWJpYyIsICJxdWFydCIsICJxdWludCIsICJzaW5lIiwgImV4cG8iLCAiY2lyYyIsICJlbGFzdGljIiwgImJhY2siLCAiYm91bmNlIl07CiAgICBjb25zdCBFQVNFX0FQSTJJTlRFUk5BTF9OQU1FUyA9IG5ldyBNYXAoWwogICAgICAgIFsibGluZWFyIiwgIm5vZWFzZSJdLAogICAgICAgIFsiaW4tc2luZSIsICJlYXNlaW5zaW5lIl0sCiAgICAgICAgWyJvdXQtc2luZSIsICJlYXNlb3V0c2luZSJdLAogICAgICAgIFsiaW4tb3V0LXNpbmUiLCAiZWFzZWlub3V0c2luZSJdLAogICAgICAgIFsiaW4tZWxhc3RpYyIsICJlYXNlaW5lbGFzdGljIl0sCiAgICAgICAgWyJvdXQtZWxhc3RpYyIsICJlYXNlb3V0ZWxhc3RpYyJdLAogICAgICAgIFsiaW4tb3V0LWVsYXN0aWMiLCAiZWFzZWlub3V0ZWxhc3RpYyJdLAogICAgICAgIFsiaW4tYmFjayIsICJlYXNlaW5iYWNrIl0sCiAgICAgICAgWyJvdXQtYmFjayIsICJlYXNlb3V0YmFjayJdLAogICAgICAgIFsiaW4tb3V0LWJhY2siLCAiZWFzZWlub3V0YmFjayJdLAogICAgICAgIFsiaW4tYm91bmNlIiwgImVhc2VpbmJvdW5jZSJdLAogICAgICAgIFsib3V0LWJvdW5jZSIsICJlYXNlb3V0Ym91bmNlIl0sCiAgICAgICAgWyJpbi1vdXQtYm91bmNlIiwgImVhc2Vpbm91dGJvdW5jZSJdLAogICAgICAgIFsiaW4tY3ViaWMiLCAiZWFzZWluY3ViaWMiXSwKICAgICAgICBbIm91dC1jdWJpYyIsICJlYXNlb3V0Y3ViaWMiXSwKICAgICAgICBbImluLW91dC1jdWJpYyIsICJlYXNlaW5vdXRjdWJpYyJdLAogICAgICAgIFsiaW4tcXVhZHJhdGljIiwgImVhc2VpbnF1YWQiXSwKICAgICAgICBbIm91dC1xdWFkcmF0aWMiLCAiZWFzZW91dHF1YWQiXSwKICAgICAgICBbImluLW91dC1xdWFkcmF0aWMiLCAiZWFzZWlub3V0cXVhZCJdLAogICAgICAgIFsiaW4tcXVhcnRpYyIsICJlYXNlaW5xdWFydCJdLAogICAgICAgIFsib3V0LXF1YXJ0aWMiLCAiZWFzZW91dHF1YXJ0Il0sCiAgICAgICAgWyJpbi1vdXQtcXVhcnRpYyIsICJlYXNlaW5vdXRxdWFydCJdLAogICAgICAgIFsiaW4tcXVpbnRpYyIsICJlYXNlaW5xdWludCJdLAogICAgICAgIFsib3V0LXF1aW50aWMiLCAiZWFzZW91dHF1aW50Il0sCiAgICAgICAgWyJpbi1vdXQtcXVpbnRpYyIsICJlYXNlaW5vdXRxdWludCJdLAogICAgICAgIFsiaW4tY2lyY3VsYXIiLCAiZWFzZWluY2lyYyJdLAogICAgICAgIFsib3V0LWNpcmN1bGFyIiwgImVhc2VvdXRjaXJjIl0sCiAgICAgICAgWyJpbi1vdXQtY2lyY3VsYXIiLCAiZWFzZWlub3V0Y2lyYyJdLAogICAgICAgIFsiaW4tZXhwb25lbnRpYWwiLCAiZWFzZWluZXhwbyJdLAogICAgICAgIFsib3V0LWV4cG9uZW50aWFsIiwgImVhc2VvdXRleHBvIl0sCiAgICAgICAgWyJpbi1vdXQtZXhwb25lbnRpYWwiLCAiZWFzZWlub3V0ZXhwbyJdCiAgICBdKTsKICAgIHNlbGYuRWFzZSA9IGNsYXNzIEVhc2UgewogICAgICAgIGNvbnN0cnVjdG9yKCkge30KICAgICAgICBzdGF0aWMgSW5oZXJpdEVhc2UoKSB7CiAgICAgICAgICAgIHJldHVybiAiZGVmYXVsdCIKICAgICAgICB9CiAgICAgICAgc3RhdGljIERlZmF1bHRFYXNlKCkgewogICAgICAgICAgICByZXR1cm4gIm5vZWFzZSIKICAgICAgICB9CiAgICAgICAgc3RhdGljIFRvSW50ZXJuYWwoZWFzZSkgewogICAgICAgICAgICByZXR1cm4gRUFTRV9BUEkySU5URVJOQUxfTkFNRVMuZ2V0KGVhc2UpCiAgICAgICAgfQogICAgICAgIHN0YXRpYyBHZXRFZGl0b3JFYXNlTmFtZXMocHJvamVjdCwgLi4uZmlsdGVyKSB7CiAgICAgICAgICAgIHRoaXMuX0NyZWF0ZUVhc2VNYXAoKTsKICAgICAgICAgICAgbGV0IGN1c3RvbUVhc2VNYXA7CiAgICAgICAgICAgIGlmIChwcm9qZWN0KSB7CiAgICAgICAgICAgICAgICBpZiAoIUNVU1RPTV9FQVNFX0VESVRPUl9NQVAuaGFzKHByb2plY3QpKSBDVVNUT01fRUFTRV9FRElUT1JfTUFQLnNldChwcm9qZWN0LCBuZXcgTWFwKTsKICAgICAgICAgICAgICAgIGN1c3RvbUVhc2VNYXAgPSBDVVNUT01fRUFTRV9FRElUT1JfTUFQLmdldChwcm9qZWN0KQogICAgICAgICAgICB9IGVsc2UgY3VzdG9tRWFzZU1hcCA9IENVU1RPTV9FQVNFX1JVTlRJTUVfTUFQOwogICAgICAgICAgICBjb25zdCBzb3J0ZWRDdXN0b21FYXNlcyA9IFsuLi5jdXN0b21FYXNlTWFwLmtleXMoKV07CiAgICAgICAgICAgIHNvcnRlZEN1c3RvbUVhc2VzLnNvcnQoKTsKICAgICAgICAgICAgcmV0dXJuIFsuLi5QUkVERUZJTkVEX0VBU0VfTUFQLmtleXMoKV0uY29uY2F0KHNvcnRlZEN1c3RvbUVhc2VzKS5maWx0ZXIoZWFzZSA9PiAhZmlsdGVyLmluY2x1ZGVzKGVhc2UpKQogICAgICAgIH0KICAgICAgICBzdGF0aWMgR2V0UnVudGltZUVhc2VOYW1lcygpIHsKICAgICAgICAgICAgdGhpcy5fQ3JlYXRlRWFzZU1hcCgpOwogICAgICAgICAgICBjb25zdCBzb3J0ZWRDdXN0b21FYXNlcyA9IFsuLi5DVVNUT01fRUFTRV9SVU5USU1FX01BUC5rZXlzKCldOwogICAgICAgICAgICBzb3J0ZWRDdXN0b21FYXNlcy5zb3J0KCk7CiAgICAgICAgICAgIHJldHVybiBbLi4uUFJFREVGSU5FRF9FQVNFX01BUC5rZXlzKCldLmNvbmNhdChzb3J0ZWRDdXN0b21FYXNlcykKICAgICAgICB9CiAgICAgICAgc3RhdGljIEdldEN1c3RvbVJ1bnRpbWVFYXNlTmFtZXMoKSB7CiAgICAgICAgICAgIHRoaXMuX0NyZWF0ZUVhc2VNYXAoKTsKICAgICAgICAgICAgY29uc3Qgc29ydGVkQ3VzdG9tRWFzZXMgPSBbLi4uQ1VTVE9NX0VBU0VfUlVOVElNRV9NQVAua2V5cygpXTsKICAgICAgICAgICAgc29ydGVkQ3VzdG9tRWFzZXMuc29ydCgpOwogICAgICAgICAgICByZXR1cm4gc29ydGVkQ3VzdG9tRWFzZXMKICAgICAgICB9CiAgICAgICAgc3RhdGljIElzUHJlZGVmaW5lZFRyYW5zbGF0ZWROYW1lKGVhc2VOYW1lKSB7CiAgICAgICAgICAgIGZvciAoY29uc3QgayBvZiBFQVNFX1RSQU5TTEFUSU9OX0tFWVMpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5zbGF0ZWROYW1lID0KICAgICAgICAgICAgICAgICAgICBzZWxmLmxhbmcoYHVpLmJhcnMudGltZWxpbmUuZWFzZXMuJHtrfWApOwogICAgICAgICAgICAgICAgaWYgKHRyYW5zbGF0ZWROYW1lID09PSBlYXNlTmFtZSkgcmV0dXJuIHRydWUKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IgKGNvbnN0IGsgb2YgU0hPUlRfRUFTRV9UUkFOU0xBVElPTl9LRVlTKSB7CiAgICAgICAgICAgICAgICBjb25zdCB0cmFuc2xhdGVkTmFtZSA9IHNlbGYubGFuZyhgdWkuYmFycy50aW1lbGluZS5zaG9ydC1lYXNlcy4ke2t9YCk7CiAgICAgICAgICAgICAgICBpZiAodHJhbnNsYXRlZE5hbWUgPT09IGVhc2VOYW1lKSByZXR1cm4gdHJ1ZQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHN0YXRpYyBJc05hbWVQcmVkZWZpbmVkKGVhc2VOYW1lKSB7CiAgICAgICAgICAgIHRoaXMuX0NyZWF0ZUVhc2VNYXAoKTsKICAgICAgICAgICAgcmV0dXJuIFsuLi5QUkVERUZJTkVEX0VBU0VfTUFQLmtleXMoKV0uaW5jbHVkZXMoZWFzZU5hbWUpCiAgICAgICAgfQogICAgICAgIHN0YXRpYyBfR2V0RWFzZShlYXNlTmFtZSkgewogICAgICAgICAgICBjb25zdCByZWFsRWFzZU5hbWUgPSBBTElBU19NQVAuZ2V0KGVhc2VOYW1lKTsKICAgICAgICAgICAgaWYgKHJlYWxFYXNlTmFtZSkgcmV0dXJuIEVBU0VfTUFQLmdldChyZWFsRWFzZU5hbWUpOwogICAgICAgICAgICBpZiAoRWFzZS5Jc05hbWVQcmVkZWZpbmVkKGVhc2VOYW1lKSkgcmV0dXJuIEVBU0VfTUFQLmdldChlYXNlTmFtZSk7CiAgICAgICAgICAgIGlmIChQUklWQVRFX0VBU0VfTUFQLmhhcyhlYXNlTmFtZSkpIHJldHVybiBQUklWQVRFX0VBU0VfTUFQLmdldChlYXNlTmFtZSkKICAgICAgICB9CiAgICAgICAgc3RhdGljIEdldEJ1aWx0SW5UcmFuc2l0aW9uKGJ1aWx0SW5UcmFuc2l0aW9uTmFtZSkgewogICAgICAgICAgICB0aGlzLl9DcmVhdGVFYXNlTWFwKCk7CiAgICAgICAgICAgIHJldHVybiBCVUlMVF9JTl9UUkFOU0lUSU9OX01BUC5nZXQoYnVpbHRJblRyYW5zaXRpb25OYW1lKQogICAgICAgIH0KICAgICAgICBzdGF0aWMgR2V0RWRpdG9yRWFzZShlYXNlTmFtZSwgcHJvamVjdCkgewogICAgICAgICAgICB0aGlzLl9DcmVhdGVFYXNlTWFwKCk7CiAgICAgICAgICAgIGNvbnN0IGVhc2UgPSBFYXNlLl9HZXRFYXNlKGVhc2VOYW1lKTsKICAgICAgICAgICAgaWYgKGVhc2UpIHJldHVybiBlYXNlOwogICAgICAgICAgICBpZiAoIXByb2plY3QpIHRocm93IG5ldyBFcnJvcigibWlzc2luZyBlYXNlIGZ1bmN0aW9uIik7CiAgICAgICAgICAgIHJldHVybiBDVVNUT01fRUFTRV9FRElUT1JfTUFQLmdldChwcm9qZWN0KS5nZXQoZWFzZU5hbWUpCiAgICAgICAgfQogICAgICAgIHN0YXRpYyBIYXNFZGl0b3JFYXNlKGVhc2VOYW1lLCBwcm9qZWN0KSB7CiAgICAgICAgICAgIHRoaXMuX0NyZWF0ZUVhc2VNYXAoKTsKICAgICAgICAgICAgY29uc3QgZWFzZSA9CiAgICAgICAgICAgICAgICBFYXNlLl9HZXRFYXNlKGVhc2VOYW1lKTsKICAgICAgICAgICAgaWYgKGVhc2UpIHJldHVybiB0cnVlOwogICAgICAgICAgICByZXR1cm4gISFDVVNUT01fRUFTRV9FRElUT1JfTUFQLmdldChwcm9qZWN0KS5nZXQoZWFzZU5hbWUpCiAgICAgICAgfQogICAgICAgIHN0YXRpYyBHZXRSdW50aW1lRWFzZShlYXNlTmFtZSkgewogICAgICAgICAgICB0aGlzLl9DcmVhdGVFYXNlTWFwKCk7CiAgICAgICAgICAgIGNvbnN0IGVhc2UgPSBFYXNlLl9HZXRFYXNlKGVhc2VOYW1lKTsKICAgICAgICAgICAgaWYgKGVhc2UpIHJldHVybiBlYXNlOwogICAgICAgICAgICByZXR1cm4gQ1VTVE9NX0VBU0VfUlVOVElNRV9NQVAuZ2V0KGVhc2VOYW1lKQogICAgICAgIH0KICAgICAgICBzdGF0aWMgR2V0RWFzZUZyb21JbmRleChpbmRleCkgewogICAgICAgICAgICB0aGlzLl9DcmVhdGVFYXNlTWFwKCk7CiAgICAgICAgICAgIGNvbnN0IG5hbWVzID0gdGhpcy5HZXRSdW50aW1lRWFzZU5hbWVzKCk7CiAgICAgICAgICAgIHJldHVybiBuYW1lc1tpbmRleF0KICAgICAgICB9CiAgICAgICAgc3RhdGljIEdldEluZGV4Rm9yRWFzZShuYW1lLCBwcm9qZWN0KSB7CiAgICAgICAgICAgIHRoaXMuX0NyZWF0ZUVhc2VNYXAoKTsKICAgICAgICAgICAgY29uc3QgbmFtZXMgPSB0aGlzLkdldEVkaXRvckVhc2VOYW1lcyhwcm9qZWN0KTsKICAgICAgICAgICAgcmV0dXJuIG5hbWVzLmluZGV4T2YobmFtZSkKICAgICAgICB9CiAgICAgICAgc3RhdGljIEdldEluZGV4Rm9yRWFzZUF0UnVudGltZShuYW1lKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLkdldEluZGV4Rm9yRWFzZShuYW1lKQogICAgICAgIH0KICAgICAgICBzdGF0aWMgX0NyZWF0ZUVhc2VNYXAoKSB7CiAgICAgICAgICAgIGlmIChFQVNFX01BUC5zaXplICE9PQogICAgICAgICAgICAgICAgMCkgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl9BZGRQcmVkaWZpbmVkRWFzZSgiZGVmYXVsdCIsICgpID0+IHt9KTsKICAgICAgICAgICAgdGhpcy5fQWRkUHJlZGlmaW5lZEVhc2UoIm5vZWFzZSIsIFt7CiAgICAgICAgICAgICAgICAieCI6IDAsCiAgICAgICAgICAgICAgICAieSI6IDAsCiAgICAgICAgICAgICAgICAic2F4IjogLjMzNiwKICAgICAgICAgICAgICAgICJzYXkiOiAwLAogICAgICAgICAgICAgICAgImVheCI6IDAsCiAgICAgICAgICAgICAgICAiZWF5IjogMCwKICAgICAgICAgICAgICAgICJzZSI6IHRydWUsCiAgICAgICAgICAgICAgICAiZWUiOiBmYWxzZQogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAieCI6IDEsCiAgICAgICAgICAgICAgICAieSI6IDEsCiAgICAgICAgICAgICAgICAic2F4IjogMCwKICAgICAgICAgICAgICAgICJzYXkiOiAwLAogICAgICAgICAgICAgICAgImVheCI6IC0uMzM2LAogICAgICAgICAgICAgICAgImVheSI6IDAsCiAgICAgICAgICAgICAgICAic2UiOiBmYWxzZSwKICAgICAgICAgICAgICAgICJlZSI6IHRydWUKICAgICAgICAgICAgfV0sIHRydWUpOwogICAgICAgICAgICB0aGlzLl9BZGRQcmVkaWZpbmVkRWFzZSgiZWFzZWluc2luZSIsIFt7CiAgICAgICAgICAgICAgICAieCI6IDAsCiAgICAgICAgICAgICAgICAieSI6IDAsCiAgICAgICAgICAgICAgICAic2F4IjogLjQ4NSwKICAgICAgICAgICAgICAgICJzYXkiOiAwLAogICAgICAgICAgICAgICAgImVheCI6IDAsCiAgICAgICAgICAgICAgICAiZWF5IjogMCwKICAgICAgICAgICAgICAgICJzZSI6IHRydWUsCiAgICAgICAgICAgICAgICAiZWUiOiBmYWxzZQogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAieCI6IDEsCiAgICAgICAgICAgICAgICAieSI6IDEsCiAgICAgICAgICAgICAgICAic2F4IjogMCwKICAgICAgICAgICAgICAgICJzYXkiOiAwLAogICAgICAgICAgICAgICAgImVheCI6IC0uMDM4LAogICAgICAgICAgICAgICAgImVheSI6IDAsCiAgICAgICAgICAgICAgICAic2UiOiBmYWxzZSwKICAgICAgICAgICAgICAgICJlZSI6IHRydWUKICAgICAgICAgICAgfV0pOwogICAgICAgICAgICB0aGlzLl9BZGRQcmVkaWZpbmVkRWFzZSgiZWFzZW91dHNpbmUiLCBbewogICAgICAgICAgICAgICAgIngiOiAwLAogICAgICAgICAgICAgICAgInkiOiAwLAogICAgICAgICAgICAgICAgInNheCI6IC4wMzgsCiAgICAgICAgICAgICAgICAic2F5IjogMCwKICAgICAgICAgICAgICAgICJlYXgiOiAwLAogICAgICAgICAgICAgICAgImVheSI6IDAsCiAgICAgICAgICAgICAgICAic2UiOiB0cnVlLAogICAgICAgICAgICAgICAgImVlIjogZmFsc2UKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgIngiOiAxLAogICAgICAgICAgICAgICAgInkiOiAxLAogICAgICAgICAgICAgICAgInNheCI6IDAsCiAgICAgICAgICAgICAgICAic2F5IjogMCwKICAgICAgICAgICAgICAgICJlYXgiOiAtLjQ4NSwKICAgICAgICAgICAgICAgICJlYXkiOiAwLAogICAgICAgICAgICAgICAgInNlIjogZmFsc2UsCiAgICAgICAgICAgICAgICAiZWUiOiB0cnVlCiAgICAgICAgICAgIH1dKTsKICAgICAgICAgICAgdGhpcy5fQWRkUHJlZGlmaW5lZEVhc2UoImVhc2Vpbm91dHNpbmUiLCBbewogICAgICAgICAgICAgICAgIngiOiAwLAogICAgICAgICAgICAgICAgInkiOiAwLAogICAgICAgICAgICAgICAgInNheCI6IC4zMzYsCiAgICAgICAgICAgICAgICAic2F5IjogMCwKICAgICAgICAgICAgICAgICJlYXgiOiAwLAogICAgICAgICAgICAgICAgImVheSI6IDAsCiAgICAgICAgICAgICAgICAic2UiOiB0cnVlLAogICAgICAgICAgICAgICAgImVlIjogZmFsc2UKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgIngiOiAxLAogICAgICAgICAgICAgICAgInkiOiAxLAogICAgICAgICAgICAgICAgInNheCI6IDAsCiAgICAgICAgICAgICAgICAic2F5IjogMCwKICAgICAgICAgICAgICAgICJlYXgiOiAtLjMzNiwKICAgICAgICAgICAgICAgICJlYXkiOiAwLAogICAgICAgICAgICAgICAgInNlIjogZmFsc2UsCiAgICAgICAgICAgICAgICAiZWUiOiB0cnVlCiAgICAgICAgICAgIH1dKTsKICAgICAgICAgICAgdGhpcy5fQWRkUHJlZGlmaW5lZEVhc2UoImVhc2VpbmVsYXN0aWMiLCBbewogICAgICAgICAgICAgICAgIngiOiAwLAogICAgICAgICAgICAgICAgInkiOiAwLAogICAgICAgICAgICAgICAgInNheCI6IC4wMTgsCiAgICAgICAgICAgICAgICAic2F5IjogMCwKICAgICAgICAgICAgICAgICJlYXgiOiAwLAogICAgICAgICAgICAgICAgImVheSI6IDAsCiAgICAgICAgICAgICAgICAic2UiOiB0cnVlLAogICAgICAgICAgICAgICAgImVlIjogZmFsc2UKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgIngiOiAuMTE2LAogICAgICAgICAgICAgICAgInkiOiAuMDAyLAogICAgICAgICAgICAgICAgInNheCI6IC4wMjUsCiAgICAgICAgICAgICAgICAic2F5IjogMCwKICAgICAgICAgICAgICAgICJlYXgiOiAtLjAyNSwKICAgICAgICAgICAgICAgICJlYXkiOiAwLAogICAgICAgICAgICAgICAgInNlIjogdHJ1ZSwKICAgICAgICAgICAgICAgICJlZSI6IHRydWUKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgIngiOiAuMjY2LAogICAgICAgICAgICAgICAgInkiOiAtLjAwNSwKICAgICAgICAgICAgICAgICJzYXgiOiAuMDI0LAogICAgICAgICAgICAgICAgInNheSI6IDAsCiAgICAgICAgICAgICAgICAiZWF4IjogLS4wMjEsCiAgICAgICAgICAgICAgICAiZWF5IjogMCwKICAgICAgICAgICAgICAgICJzZSI6IHRydWUsCiAgICAgICAgICAgICAgICAiZWUiOiB0cnVlCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICJ4IjogLjQxNiwKICAgICAgICAgICAgICAgICJ5IjogLjAxNiwKICAgICAgICAgICAgICAgICJzYXgiOiAuMDI0LAogICAgICAgICAgICAgICAgInNheSI6IDAsCiAgICAgICAgICAgICAgICAiZWF4IjogLS4wMjYsCiAgICAgICAgICAgICAgICAiZWF5IjogMCwKICAgICAgICAgICAgICAgICJzZSI6IHRydWUsCiAgICAgICAgICAgICAgICAiZWUiOiB0cnVlCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICJ4IjogLjU2NiwKICAgICAgICAgICAgICAgICJ5IjogLS4wNDUsCiAgICAgICAgICAgICAgICAic2F4IjogLjA2MSwKICAgICAgICAgICAgICAgICJzYXkiOiAwLAogICAgICAgICAgICAgICAgImVheCI6IC0uMDI1LAogICAgICAgICAgICAgICAgImVheSI6IDAsCiAgICAgICAgICAgICAgICAic2UiOiB0cnVlLAogICAgICAgICAgICAgICAgImVlIjogdHJ1ZQogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAieCI6IC43MTYsCiAgICAgICAgICAgICAgICAieSI6IC4xMzIsCiAgICAgICAgICAgICAgICAic2F4IjogLjA3MiwKICAgICAgICAgICAgICAgICJzYXkiOiAtLjAwNCwKICAgICAgICAgICAgICAgICJlYXgiOiAtLjA0NSwKICAgICAgICAgICAgICAgICJlYXkiOiAwLAogICAgICAgICAgICAgICAgInNlIjogdHJ1ZSwKICAgICAgICAgICAgICAgICJlZSI6IHRydWUKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgIngiOiAuODY2LAogICAgICAgICAgICAgICAgInkiOiAtLjM3MywKICAgICAgICAgICAgICAgICJzYXgiOiAuMDYsCiAgICAgICAgICAgICAgICAic2F5IjogMCwKICAgICAgICAgICAgICAgICJlYXgiOiAtLjA0OSwKICAgICAgICAgICAgICAgICJlYXkiOiAtLjAwMiwKICAgICAgICAgICAgICAgICJzZSI6IHRydWUsCiAgICAgICAgICAgICAgICAiZWUiOiB0cnVlCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICJ4IjogMSwKICAgICAgICAgICAgICAgICJ5IjogMSwKICAgICAgICAgICAgICAgICJzYXgiOiAwLAogICAgICAgICAgICAgICAgInNheSI6IDAsCiAgICAgICAgICAgICAgICAiZWF4IjogLS4wMzgsCiAgICAgICAgICAgICAgICAiZWF5IjogLS4yNjMsCiAgICAgICAgICAgICAgICAic2UiOiBmYWxzZSwKICAgICAgICAgICAgICAgICJlZSI6IHRydWUKICAgICAgICAgICAgfV0pOwogICAgICAgICAgICB0aGlzLl9BZGRQcmVkaWZpbmVkRWFzZSgiZWFzZW91dGVsYXN0aWMiLCBbewogICAgICAgICAgICAgICAgIngiOiAwLAogICAgICAgICAgICAgICAgInkiOiAwLAogICAgICAgICAgICAgICAgInNheCI6IC4wMzgsCiAgICAgICAgICAgICAgICAic2F5IjogLjI2MywKICAgICAgICAgICAgICAgICJlYXgiOiAwLAogICAgICAgICAgICAgICAgImVheSI6IDAsCiAgICAgICAgICAgICAgICAic2UiOiB0cnVlLAogICAgICAgICAgICAgICAgImVlIjogZmFsc2UKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgIngiOiAuMTM2LAogICAgICAgICAgICAgICAgInkiOiAxLjM3MywKICAgICAgICAgICAgICAgICJzYXgiOiAuMDQ5LAogICAgICAgICAgICAgICAgInNheSI6IC4wMDIsCiAgICAgICAgICAgICAgICAiZWF4IjogLS4wNiwKICAgICAgICAgICAgICAgICJlYXkiOiAwLAogICAgICAgICAgICAgICAgInNlIjogdHJ1ZSwKICAgICAgICAgICAgICAgICJlZSI6IHRydWUKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgIngiOiAuMjg2LAogICAgICAgICAgICAgICAgInkiOiAuODY4LAogICAgICAgICAgICAgICAgInNheCI6IC4wNDUsCiAgICAgICAgICAgICAgICAic2F5IjogMCwKICAgICAgICAgICAgICAgICJlYXgiOiAtLjA3MiwKICAgICAgICAgICAgICAgICJlYXkiOiAuMDA0LAogICAgICAgICAgICAgICAgInNlIjogdHJ1ZSwKICAgICAgICAgICAgICAgICJlZSI6IHRydWUKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgIngiOiAuNDM2LAogICAgICAgICAgICAgICAgInkiOiAxLjA0NSwKICAgICAgICAgICAgICAgICJzYXgiOiAuMDI1LAogICAgICAgICAgICAgICAgInNheSI6IDAsCiAgICAgICAgICAgICAgICAiZWF4IjogLS4wNjEsCiAgICAgICAgICAgICAgICAiZWF5IjogMCwKICAgICAgICAgICAgICAgICJzZSI6IHRydWUsCiAgICAgICAgICAgICAgICAiZWUiOiB0cnVlCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICJ4IjogLjU4NiwKICAgICAgICAgICAgICAgICJ5IjogLjk4NCwKICAgICAgICAgICAgICAgICJzYXgiOiAuMDI2LAogICAgICAgICAgICAgICAgInNheSI6IDAsCiAgICAgICAgICAgICAgICAiZWF4IjogLS4wMjQsCiAgICAgICAgICAgICAgICAiZWF5IjogMCwKICAgICAgICAgICAgICAgICJzZSI6IHRydWUsCiAgICAgICAgICAgICAgICAiZWUiOiB0cnVlCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICJ4IjogLjczNiwKICAgICAgICAgICAgICAgICJ5IjogMS4wMDUsCiAgICAgICAgICAgICAgICAic2F4IjogLjAyMSwKICAgICAgICAgICAgICAgICJzYXkiOiAwLAogICAgICAgICAgICAgICAgImVheCI6IC0uMDI0LAogICAgICAgICAgICAgICAgImVheSI6IDAsCiAgICAgICAgICAgICAgICAic2UiOiB0cnVlLAogICAgICAgICAgICAgICAgImVlIjogdHJ1ZQogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAieCI6IC44ODYsCiAgICAgICAgICAgICAgICAieSI6IC45OTgsCiAgICAgICAgICAgICAgICAic2F4IjogLjAyNSwKICAgICAgICAgICAgICAgICJzYXkiOiAwLAogICAgICAgICAgICAgICAgImVheCI6IC0uMDI1LAogICAgICAgICAgICAgICAgImVheSI6IDAsCiAgICAgICAgICAgICAgICAic2UiOiB0cnVlLAogICAgICAgICAgICAgICAgImVlIjogdHJ1ZQogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAieCI6IDEsCiAgICAgICAgICAgICAgICAieSI6IDEsCiAgICAgICAgICAgICAgICAic2F4IjogMCwKICAgICAgICAgICAgICAgICJzYXkiOiAwLAogICAgICAgICAgICAgICAgImVheCI6IC0uMDE4LAogICAgICAgICAgICAgICAgImVheSI6IDAsCiAgICAgICAgICAgICAgICAic2UiOiBmYWxzZSwKICAgICAgICAgICAgICAgICJlZSI6IHRydWUKICAgICAgICAgICAgfV0pOwogICAgICAgICAgICB0aGlzLl9BZGRQcmVkaWZpbmVkRWFzZSgiZWFzZWlub3V0ZWxhc3RpYyIsIFt7CiAgICAgICAgICAgICAgICAieCI6IDAsCiAgICAgICAgICAgICAgICAieSI6IDAsCiAgICAgICAgICAgICAgICAic2F4IjogLjAyNSwKICAgICAgICAgICAgICAgICJzYXkiOiAwLAogICAgICAgICAgICAgICAgImVheCI6IDAsCiAgICAgICAgICAgICAgICAiZWF5IjogMCwKICAgICAgICAgICAgICAgICJzZSI6IHRydWUsCiAgICAgICAgICAgICAgICAiZWUiOiBmYWxzZQogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAieCI6IC4wNjcsCiAgICAgICAgICAgICAgICAieSI6IC4wMDEsCiAgICAgICAgICAgICAgICAic2F4IjogLjAyNSwKICAgICAgICAgICAgICAgICJzYXkiOiAwLAogICAgICAgICAgICAgICAgImVheCI6IC0uMDI1LAogICAgICAgICAgICAgICAgImVheSI6IDAsCiAgICAgICAgICAgICAgICAic2UiOiB0cnVlLAogICAgICAgICAgICAgICAgImVlIjogdHJ1ZQogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAieCI6IC4xOCwKICAgICAgICAgICAgICAgICJ5IjogLS4wMDUsCiAgICAgICAgICAgICAgICAic2F4IjogLjAyNSwKICAgICAgICAgICAgICAgICJzYXkiOiAwLAogICAgICAgICAgICAgICAgImVheCI6IC0uMDI1LAogICAgICAgICAgICAgICAgImVheSI6IDAsCiAgICAgICAgICAgICAgICAic2UiOiB0cnVlLAogICAgICAgICAgICAgICAgImVlIjogdHJ1ZQogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAieCI6IC4yOTIsCiAgICAgICAgICAgICAgICAieSI6IC4wMjUsCiAgICAgICAgICAgICAgICAic2F4IjogLjA1MywKICAgICAgICAgICAgICAgICJzYXkiOiAwLAogICAgICAgICAgICAgICAgImVheCI6IC0uMDI1LAogICAgICAgICAgICAgICAgImVheSI6IDAsCiAgICAgICAgICAgICAgICAic2UiOiB0cnVlLAogICAgICAgICAgICAgICAgImVlIjogdHJ1ZQogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAieCI6IC40MDUsCiAgICAgICAgICAgICAgICAieSI6IC0uMTE4LAogICAgICAgICAgICAgICAgInNheCI6IC4wNjksCiAgICAgICAgICAgICAgICAic2F5IjogMCwKICAgICAgICAgICAgICAgICJlYXgiOiAtLjAyNywKICAgICAgICAgICAgICAgICJlYXkiOiAwLAogICAgICAgICAgICAgICAgInNlIjogdHJ1ZSwKICAgICAgICAgICAgICAgICJlZSI6IHRydWUKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgIngiOiAuNTk3LAogICAgICAgICAgICAgICAgInkiOiAxLjExOCwKICAgICAgICAgICAgICAgICJzYXgiOiAuMDI3LAogICAgICAgICAgICAgICAgInNheSI6IDAsCiAgICAgICAgICAgICAgICAiZWF4IjogLS4wNjksCiAgICAgICAgICAgICAgICAiZWF5IjogMCwKICAgICAgICAgICAgICAgICJzZSI6IHRydWUsCiAgICAgICAgICAgICAgICAiZWUiOiB0cnVlCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICJ4IjogLjcxLAogICAgICAgICAgICAgICAgInkiOiAuOTc1LAogICAgICAgICAgICAgICAgInNheCI6IC4wMjUsCiAgICAgICAgICAgICAgICAic2F5IjogMCwKICAgICAgICAgICAgICAgICJlYXgiOiAtLjA1MywKICAgICAgICAgICAgICAgICJlYXkiOiAwLAogICAgICAgICAgICAgICAgInNlIjogdHJ1ZSwKICAgICAgICAgICAgICAgICJlZSI6IHRydWUKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgIngiOiAuODIyLAogICAgICAgICAgICAgICAgInkiOiAxLjAwNSwKICAgICAgICAgICAgICAgICJzYXgiOiAuMDI1LAogICAgICAgICAgICAgICAgInNheSI6IDAsCiAgICAgICAgICAgICAgICAiZWF4IjogLS4wMjUsCiAgICAgICAgICAgICAgICAiZWF5IjogMCwKICAgICAgICAgICAgICAgICJzZSI6IHRydWUsCiAgICAgICAgICAgICAgICAiZWUiOiB0cnVlCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICJ4IjogLjkzNSwKICAgICAgICAgICAgICAgICJ5IjogLjk5OSwKICAgICAgICAgICAgICAgICJzYXgiOiAuMDI1LAogICAgICAgICAgICAgICAgInNheSI6IDAsCiAgICAgICAgICAgICAgICAiZWF4IjogLS4wMjUsCiAgICAgICAgICAgICAgICAiZWF5IjogMCwKICAgICAgICAgICAgICAgICJzZSI6IHRydWUsCiAgICAgICAgICAgICAgICAiZWUiOiB0cnVlCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICJ4IjogMSwKICAgICAgICAgICAgICAgICJ5IjogMSwKICAgICAgICAgICAgICAgICJzYXgiOiAwLAogICAgICAgICAgICAgICAgInNheSI6IDAsCiAgICAgICAgICAgICAgICAiZWF4IjogLS4wMjUsCiAgICAgICAgICAgICAgICAiZWF5IjogMCwKICAgICAgICAgICAgICAgICJzZSI6IGZhbHNlLAogICAgICAgICAgICAgICAgImVlIjogdHJ1ZQogICAgICAgICAgICB9XSk7CiAgICAgICAgICAgIHRoaXMuX0FkZFByZWRpZmluZWRFYXNlKCJlYXNlaW5iYWNrIiwgW3sKICAgICAgICAgICAgICAgICJ4IjogMCwKICAgICAgICAgICAgICAgICJ5IjogMCwKICAgICAgICAgICAgICAgICJzYXgiOiAuMzUsCiAgICAgICAgICAgICAgICAic2F5IjogMCwKICAgICAgICAgICAgICAgICJlYXgiOiAwLAogICAgICAgICAgICAgICAgImVheSI6IDAsCiAgICAgICAgICAgICAgICAic2UiOiB0cnVlLAogICAgICAgICAgICAgICAgImVlIjogZmFsc2UKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgIngiOiAxLAogICAgICAgICAgICAgICAgInkiOiAxLAogICAgICAgICAgICAgICAgInNheCI6IDAsCiAgICAgICAgICAgICAgICAic2F5IjogMCwKICAgICAgICAgICAgICAgICJlYXgiOiAtLjM0LAogICAgICAgICAgICAgICAgImVheSI6IC0xLjU3OSwKICAgICAgICAgICAgICAgICJzZSI6IGZhbHNlLAogICAgICAgICAgICAgICAgImVlIjogdHJ1ZQogICAgICAgICAgICB9XSk7CiAgICAgICAgICAgIHRoaXMuX0FkZFByZWRpZmluZWRFYXNlKCJlYXNlb3V0YmFjayIsIFt7CiAgICAgICAgICAgICAgICAieCI6IDAsCiAgICAgICAgICAgICAgICAieSI6IDAsCiAgICAgICAgICAgICAgICAic2F4IjogLjM0LAogICAgICAgICAgICAgICAgInNheSI6IDEuNTc5LAogICAgICAgICAgICAgICAgImVheCI6IDAsCiAgICAgICAgICAgICAgICAiZWF5IjogMCwKICAgICAgICAgICAgICAgICJzZSI6IHRydWUsCiAgICAgICAgICAgICAgICAiZWUiOiBmYWxzZQogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAieCI6IDEsCiAgICAgICAgICAgICAgICAieSI6IDEsCiAgICAgICAgICAgICAgICAic2F4IjogMCwKICAgICAgICAgICAgICAgICJzYXkiOiAwLAogICAgICAgICAgICAgICAgImVheCI6IC0uMzUsCiAgICAgICAgICAgICAgICAiZWF5IjogMCwKICAgICAgICAgICAgICAgICJzZSI6IGZhbHNlLAogICAgICAgICAgICAgICAgImVlIjogdHJ1ZQogICAgICAgICAgICB9XSk7CiAgICAgICAgICAgIHRoaXMuX0FkZFByZWRpZmluZWRFYXNlKCJlYXNlaW5vdXRiYWNrIiwgW3sKICAgICAgICAgICAgICAgICJ4IjogMCwKICAgICAgICAgICAgICAgICJ5IjogMCwKICAgICAgICAgICAgICAgICJzYXgiOiAuMDM1LAogICAgICAgICAgICAgICAgInNheSI6IDAsCiAgICAgICAgICAgICAgICAiZWF4IjogMCwKICAgICAgICAgICAgICAgICJlYXkiOiAwLAogICAgICAgICAgICAgICAgInNlIjogdHJ1ZSwKICAgICAgICAgICAgICAgICJlZSI6IGZhbHNlCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICJ4IjogLjI0MiwKICAgICAgICAgICAgICAgICJ5IjogLS4xLAogICAgICAgICAgICAgICAgInNheCI6IC4yNTgsCiAgICAgICAgICAgICAgICAic2F5IjogMCwKICAgICAgICAgICAgICAgICJlYXgiOiAtLjAyNSwKICAgICAgICAgICAgICAgICJlYXkiOiAwLAogICAgICAgICAgICAgICAgInNlIjogdHJ1ZSwKICAgICAgICAgICAgICAgICJlZSI6IHRydWUKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgIngiOiAuNzYsCiAgICAgICAgICAgICAgICAieSI6IDEuMSwKICAgICAgICAgICAgICAgICJzYXgiOiAuMDI1LAogICAgICAgICAgICAgICAgInNheSI6IDAsCiAgICAgICAgICAgICAgICAiZWF4IjogLS4yNiwKICAgICAgICAgICAgICAgICJlYXkiOiAwLAogICAgICAgICAgICAgICAgInNlIjogdHJ1ZSwKICAgICAgICAgICAgICAgICJlZSI6IHRydWUKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgIngiOiAxLAogICAgICAgICAgICAgICAgInkiOiAxLAogICAgICAgICAgICAgICAgInNheCI6IDAsCiAgICAgICAgICAgICAgICAic2F5IjogMCwKICAgICAgICAgICAgICAgICJlYXgiOiAtLjAzNSwKICAgICAgICAgICAgICAgICJlYXkiOiAwLAogICAgICAgICAgICAgICAgInNlIjogZmFsc2UsCiAgICAgICAgICAgICAgICAiZWUiOiB0cnVlCiAgICAgICAgICAgIH1dKTsKICAgICAgICAgICAgdGhpcy5fQWRkUHJlZGlmaW5lZEVhc2UoImVhc2VpbmJvdW5jZSIsIFt7CiAgICAgICAgICAgICAgICAieCI6IDAsCiAgICAgICAgICAgICAgICAieSI6IDAsCiAgICAgICAgICAgICAgICAic2F4IjogLjAzMywKICAgICAgICAgICAgICAgICJzYXkiOiAuMDI1LAogICAgICAgICAgICAgICAgImVheCI6IDAsCiAgICAgICAgICAgICAgICAiZWF5IjogMCwKICAgICAgICAgICAgICAgICJzZSI6IHRydWUsCiAgICAgICAgICAgICAgICAiZWUiOiBmYWxzZQogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAieCI6IC4wOTIsCiAgICAgICAgICAgICAgICAieSI6IDAsCiAgICAgICAgICAgICAgICAic2F4IjogLjAyNiwKICAgICAgICAgICAgICAgICJzYXkiOiAuMDc4LAogICAgICAgICAgICAgICAgImVheCI6IC0uMDMzLAogICAgICAgICAgICAgICAgImVheSI6IC4wMjUsCiAgICAgICAgICAgICAgICAic2UiOiB0cnVlLAogICAgICAgICAgICAgICAgImVlIjogdHJ1ZQogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAieCI6IC4yNzQsCiAgICAgICAgICAgICAgICAieSI6IDAsCiAgICAgICAgICAgICAgICAic2F4IjogLjA5NywKICAgICAgICAgICAgICAgICJzYXkiOiAuMzE5LAogICAgICAgICAgICAgICAgImVheCI6IC0uMDI2LAogICAgICAgICAgICAgICAgImVheSI6IC4wNzgsCiAgICAgICAgICAgICAgICAic2UiOiB0cnVlLAogICAgICAgICAgICAgICAgImVlIjogdHJ1ZQogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAieCI6IC42MzcsCiAgICAgICAgICAgICAgICAieSI6IDAsCiAgICAgICAgICAgICAgICAic2F4IjogLjEwNSwKICAgICAgICAgICAgICAgICJzYXkiOiAuNjI1LAogICAgICAgICAgICAgICAgImVheCI6IC0uMDk3LAogICAgICAgICAgICAgICAgImVheSI6IC4zMTksCiAgICAgICAgICAgICAgICAic2UiOiB0cnVlLAogICAgICAgICAgICAgICAgImVlIjogdHJ1ZQogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAieCI6IDEsCiAgICAgICAgICAgICAgICAieSI6IDEsCiAgICAgICAgICAgICAgICAic2F4IjogMCwKICAgICAgICAgICAgICAgICJzYXkiOiAwLAogICAgICAgICAgICAgICAgImVheCI6IC0uMTI1LAogICAgICAgICAgICAgICAgImVheSI6IC0uMDA0LAogICAgICAgICAgICAgICAgInNlIjogZmFsc2UsCiAgICAgICAgICAgICAgICAiZWUiOiB0cnVlCiAgICAgICAgICAgIH1dKTsKICAgICAgICAgICAgdGhpcy5fQWRkUHJlZGlmaW5lZEVhc2UoImVhc2VvdXRib3VuY2UiLCBbewogICAgICAgICAgICAgICAgIngiOiAwLAogICAgICAgICAgICAgICAgInkiOiAwLAogICAgICAgICAgICAgICAgInNheCI6IC4xMjUsCiAgICAgICAgICAgICAgICAic2F5IjogLjAwNCwKICAgICAgICAgICAgICAgICJlYXgiOiAwLAogICAgICAgICAgICAgICAgImVheSI6IDAsCiAgICAgICAgICAgICAgICAic2UiOiB0cnVlLAogICAgICAgICAgICAgICAgImVlIjogZmFsc2UKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgIngiOiAuMzY1LAogICAgICAgICAgICAgICAgInkiOiAxLAogICAgICAgICAgICAgICAgInNheCI6IC4wOTcsCiAgICAgICAgICAgICAgICAic2F5IjogLS4zMTksCiAgICAgICAgICAgICAgICAiZWF4IjogLS4xMDUsCiAgICAgICAgICAgICAgICAiZWF5IjogLS42MjUsCiAgICAgICAgICAgICAgICAic2UiOiB0cnVlLAogICAgICAgICAgICAgICAgImVlIjogdHJ1ZQogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAieCI6IC43MjgsCiAgICAgICAgICAgICAgICAieSI6IDEsCiAgICAgICAgICAgICAgICAic2F4IjogLjAyNiwKICAgICAgICAgICAgICAgICJzYXkiOiAtLjA3OCwKICAgICAgICAgICAgICAgICJlYXgiOiAtLjA5NywKICAgICAgICAgICAgICAgICJlYXkiOiAtLjMxOSwKICAgICAgICAgICAgICAgICJzZSI6IHRydWUsCiAgICAgICAgICAgICAgICAiZWUiOiB0cnVlCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICJ4IjogLjkxLAogICAgICAgICAgICAgICAgInkiOiAxLAogICAgICAgICAgICAgICAgInNheCI6IC4wMzMsCiAgICAgICAgICAgICAgICAic2F5IjogLS4wMjUsCiAgICAgICAgICAgICAgICAiZWF4IjogLS4wMjYsCiAgICAgICAgICAgICAgICAiZWF5IjogLS4wNzgsCiAgICAgICAgICAgICAgICAic2UiOiB0cnVlLAogICAgICAgICAgICAgICAgImVlIjogdHJ1ZQogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAieCI6IDEsCiAgICAgICAgICAgICAgICAieSI6IDEsCiAgICAgICAgICAgICAgICAic2F4IjogMCwKICAgICAgICAgICAgICAgICJzYXkiOiAwLAogICAgICAgICAgICAgICAgImVheCI6IC0uMDMzLAogICAgICAgICAgICAgICAgImVheSI6IC0uMDI1LAogICAgICAgICAgICAgICAgInNlIjogZmFsc2UsCiAgICAgICAgICAgICAgICAiZWUiOiB0cnVlCiAgICAgICAgICAgIH1dKTsKICAgICAgICAgICAgdGhpcy5fQWRkUHJlZGlmaW5lZEVhc2UoImVhc2Vpbm91dGJvdW5jZSIsIFt7CiAgICAgICAgICAgICAgICAieCI6IDAsCiAgICAgICAgICAgICAgICAieSI6IDAsCiAgICAgICAgICAgICAgICAic2F4IjogLjAxLAogICAgICAgICAgICAgICAgInNheSI6IC4wMDYsCiAgICAgICAgICAgICAgICAiZWF4IjogMCwKICAgICAgICAgICAgICAgICJlYXkiOiAwLAogICAgICAgICAgICAgICAgInNlIjogdHJ1ZSwKICAgICAgICAgICAgICAgICJlZSI6IGZhbHNlCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICJ4IjogLjA0NiwKICAgICAgICAgICAgICAgICJ5IjogMCwKICAgICAgICAgICAgICAgICJzYXgiOiAuMDIxLAogICAgICAgICAgICAgICAgInNheSI6IC4wMzgsCiAgICAgICAgICAgICAgICAiZWF4IjogLS4wMSwKICAgICAgICAgICAgICAgICJlYXkiOiAuMDA2LAogICAgICAgICAgICAgICAgInNlIjogdHJ1ZSwKICAgICAgICAgICAgICAgICJlZSI6IHRydWUKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgIngiOiAuMTM3LAogICAgICAgICAgICAgICAgInkiOiAwLAogICAgICAgICAgICAgICAgInNheCI6IC4wNTksCiAgICAgICAgICAgICAgICAic2F5IjogLjE1OCwKICAgICAgICAgICAgICAgICJlYXgiOiAtLjAyMSwKICAgICAgICAgICAgICAgICJlYXkiOiAuMDM4LAogICAgICAgICAgICAgICAgInNlIjogdHJ1ZSwKICAgICAgICAgICAgICAgICJlZSI6IHRydWUKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgIngiOiAuMzE5LAogICAgICAgICAgICAgICAgInkiOiAwLAogICAgICAgICAgICAgICAgInNheCI6IC4xMTcsCiAgICAgICAgICAgICAgICAic2F5IjogLjc0NCwKICAgICAgICAgICAgICAgICJlYXgiOiAtLjA1OSwKICAgICAgICAgICAgICAgICJlYXkiOiAuMTU4LAogICAgICAgICAgICAgICAgInNlIjogdHJ1ZSwKICAgICAgICAgICAgICAgICJlZSI6IHRydWUKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgIngiOiAuNjgzLAogICAgICAgICAgICAgICAgInkiOiAxLAogICAgICAgICAgICAgICAgInNheCI6IC4wNTksCiAgICAgICAgICAgICAgICAic2F5IjogLS4xNTgsCiAgICAgICAgICAgICAgICAiZWF4IjogLS4xMTcsCiAgICAgICAgICAgICAgICAiZWF5IjogLS43NDQsCiAgICAgICAgICAgICAgICAic2UiOiB0cnVlLAogICAgICAgICAgICAgICAgImVlIjogdHJ1ZQogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAieCI6IC44NjUsCiAgICAgICAgICAgICAgICAieSI6IDEsCiAgICAgICAgICAgICAgICAic2F4IjogLjAyMSwKICAgICAgICAgICAgICAgICJzYXkiOiAtLjAzOCwKICAgICAgICAgICAgICAgICJlYXgiOiAtLjA1OSwKICAgICAgICAgICAgICAgICJlYXkiOiAtLjE1OCwKICAgICAgICAgICAgICAgICJzZSI6IHRydWUsCiAgICAgICAgICAgICAgICAiZWUiOiB0cnVlCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICJ4IjogLjk1NiwKICAgICAgICAgICAgICAgICJ5IjogMSwKICAgICAgICAgICAgICAgICJzYXgiOiAuMDEsCiAgICAgICAgICAgICAgICAic2F5IjogLS4wMDYsCiAgICAgICAgICAgICAgICAiZWF4IjogLS4wMjEsCiAgICAgICAgICAgICAgICAiZWF5IjogLS4wMzgsCiAgICAgICAgICAgICAgICAic2UiOiB0cnVlLAogICAgICAgICAgICAgICAgImVlIjogdHJ1ZQogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAieCI6IDEsCiAgICAgICAgICAgICAgICAieSI6IDEsCiAgICAgICAgICAgICAgICAic2F4IjogMCwKICAgICAgICAgICAgICAgICJzYXkiOiAwLAogICAgICAgICAgICAgICAgImVheCI6IC0uMDEsCiAgICAgICAgICAgICAgICAiZWF5IjogLS4wMDYsCiAgICAgICAgICAgICAgICAic2UiOiBmYWxzZSwKICAgICAgICAgICAgICAgICJlZSI6IHRydWUKICAgICAgICAgICAgfV0pOwogICAgICAgICAgICB0aGlzLl9BZGRQcmVkaWZpbmVkRWFzZSgiZWFzZWluY3ViaWMiLCBbewogICAgICAgICAgICAgICAgIngiOiAwLAogICAgICAgICAgICAgICAgInkiOiAwLAogICAgICAgICAgICAgICAgInNheCI6IC43NSwKICAgICAgICAgICAgICAgICJzYXkiOiAwLAogICAgICAgICAgICAgICAgImVheCI6IDAsCiAgICAgICAgICAgICAgICAiZWF5IjogMCwKICAgICAgICAgICAgICAgICJzZSI6IHRydWUsCiAgICAgICAgICAgICAgICAiZWUiOiBmYWxzZQogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAieCI6IDEsCiAgICAgICAgICAgICAgICAieSI6IDEsCiAgICAgICAgICAgICAgICAic2F4IjogMCwKICAgICAgICAgICAgICAgICJzYXkiOiAwLAogICAgICAgICAgICAgICAgImVheCI6IC0uMTM4LAogICAgICAgICAgICAgICAgImVheSI6IC0uMzIxLAogICAgICAgICAgICAgICAgInNlIjogZmFsc2UsCiAgICAgICAgICAgICAgICAiZWUiOiB0cnVlCiAgICAgICAgICAgIH1dKTsKICAgICAgICAgICAgdGhpcy5fQWRkUHJlZGlmaW5lZEVhc2UoImVhc2VvdXRjdWJpYyIsIFt7CiAgICAgICAgICAgICAgICAieCI6IDAsCiAgICAgICAgICAgICAgICAieSI6IDAsCiAgICAgICAgICAgICAgICAic2F4IjogLjEzOCwKICAgICAgICAgICAgICAgICJzYXkiOiAuMzIxLAogICAgICAgICAgICAgICAgImVheCI6IDAsCiAgICAgICAgICAgICAgICAiZWF5IjogMCwKICAgICAgICAgICAgICAgICJzZSI6IHRydWUsCiAgICAgICAgICAgICAgICAiZWUiOiBmYWxzZQogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAieCI6IDEsCiAgICAgICAgICAgICAgICAieSI6IDEsCiAgICAgICAgICAgICAgICAic2F4IjogMCwKICAgICAgICAgICAgICAgICJzYXkiOiAwLAogICAgICAgICAgICAgICAgImVheCI6IC0uNzUsCiAgICAgICAgICAgICAgICAiZWF5IjogMCwKICAgICAgICAgICAgICAgICJzZSI6IGZhbHNlLAogICAgICAgICAgICAgICAgImVlIjogdHJ1ZQogICAgICAgICAgICB9XSk7CiAgICAgICAgICAgIHRoaXMuX0FkZFByZWRpZmluZWRFYXNlKCJlYXNlaW5vdXRjdWJpYyIsIFt7CiAgICAgICAgICAgICAgICAieCI6IDAsCiAgICAgICAgICAgICAgICAieSI6IDAsCiAgICAgICAgICAgICAgICAic2F4IjogLjI4NSwKICAgICAgICAgICAgICAgICJzYXkiOiAwLAogICAgICAgICAgICAgICAgImVheCI6IDAsCiAgICAgICAgICAgICAgICAiZWF5IjogMCwKICAgICAgICAgICAgICAgICJzZSI6IHRydWUsCiAgICAgICAgICAgICAgICAiZWUiOiBmYWxzZQogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAieCI6IC41LAogICAgICAgICAgICAgICAgInkiOiAuNSwKICAgICAgICAgICAgICAgICJzYXgiOiAuMDgxLAogICAgICAgICAgICAgICAgInNheSI6IC4yNzIsCiAgICAgICAgICAgICAgICAiZWF4IjogLS4wODEsCiAgICAgICAgICAgICAgICAiZWF5IjogLS4yNzIsCiAgICAgICAgICAgICAgICAic2UiOiB0cnVlLAogICAgICAgICAgICAgICAgImVlIjogdHJ1ZQogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAieCI6IDEsCiAgICAgICAgICAgICAgICAieSI6IDEsCiAgICAgICAgICAgICAgICAic2F4IjogMCwKICAgICAgICAgICAgICAgICJzYXkiOiAwLAogICAgICAgICAgICAgICAgImVheCI6IC0uMjg1LAogICAgICAgICAgICAgICAgImVheSI6IDAsCiAgICAgICAgICAgICAgICAic2UiOiBmYWxzZSwKICAgICAgICAgICAgICAgICJlZSI6IHRydWUKICAgICAgICAgICAgfV0pOwogICAgICAgICAgICB0aGlzLl9BZGRQcmVkaWZpbmVkRWFzZSgiZWFzZWlucXVhZCIsIFt7CiAgICAgICAgICAgICAgICAieCI6IDAsCiAgICAgICAgICAgICAgICAieSI6IDAsCiAgICAgICAgICAgICAgICAic2F4IjogLjQsCiAgICAgICAgICAgICAgICAic2F5IjogMCwKICAgICAgICAgICAgICAgICJlYXgiOiAwLAogICAgICAgICAgICAgICAgImVheSI6IDAsCiAgICAgICAgICAgICAgICAic2UiOiB0cnVlLAogICAgICAgICAgICAgICAgImVlIjogZmFsc2UKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgIngiOiAxLAogICAgICAgICAgICAgICAgInkiOiAxLAogICAgICAgICAgICAgICAgInNheCI6IDAsCiAgICAgICAgICAgICAgICAic2F5IjogMCwKICAgICAgICAgICAgICAgICJlYXgiOiAtLjE3OCwKICAgICAgICAgICAgICAgICJlYXkiOiAtLjM5MiwKICAgICAgICAgICAgICAgICJzZSI6IGZhbHNlLAogICAgICAgICAgICAgICAgImVlIjogdHJ1ZQogICAgICAgICAgICB9XSk7CiAgICAgICAgICAgIHRoaXMuX0FkZFByZWRpZmluZWRFYXNlKCJlYXNlb3V0cXVhZCIsIFt7CiAgICAgICAgICAgICAgICAieCI6IDAsCiAgICAgICAgICAgICAgICAieSI6IDAsCiAgICAgICAgICAgICAgICAic2F4IjogLjE3OCwKICAgICAgICAgICAgICAgICJzYXkiOiAuMzkyLAogICAgICAgICAgICAgICAgImVheCI6IDAsCiAgICAgICAgICAgICAgICAiZWF5IjogMCwKICAgICAgICAgICAgICAgICJzZSI6IHRydWUsCiAgICAgICAgICAgICAgICAiZWUiOiBmYWxzZQogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAieCI6IDEsCiAgICAgICAgICAgICAgICAieSI6IDEsCiAgICAgICAgICAgICAgICAic2F4IjogMCwKICAgICAgICAgICAgICAgICJzYXkiOiAwLAogICAgICAgICAgICAgICAgImVheCI6IC0uNCwKICAgICAgICAgICAgICAgICJlYXkiOiAwLAogICAgICAgICAgICAgICAgInNlIjogZmFsc2UsCiAgICAgICAgICAgICAgICAiZWUiOiB0cnVlCiAgICAgICAgICAgIH1dKTsKICAgICAgICAgICAgdGhpcy5fQWRkUHJlZGlmaW5lZEVhc2UoImVhc2Vpbm91dHF1YWQiLCBbewogICAgICAgICAgICAgICAgIngiOiAwLAogICAgICAgICAgICAgICAgInkiOiAwLAogICAgICAgICAgICAgICAgInNheCI6IC4yNSwKICAgICAgICAgICAgICAgICJzYXkiOiAwLAogICAgICAgICAgICAgICAgImVheCI6IDAsCiAgICAgICAgICAgICAgICAiZWF5IjogMCwKICAgICAgICAgICAgICAgICJzZSI6IHRydWUsCiAgICAgICAgICAgICAgICAiZWUiOiBmYWxzZQogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAieCI6IC41LAogICAgICAgICAgICAgICAgInkiOiAuNSwKICAgICAgICAgICAgICAgICJzYXgiOiAuMDMsCiAgICAgICAgICAgICAgICAic2F5IjogLjA2NSwKICAgICAgICAgICAgICAgICJlYXgiOiAtLjAzLAogICAgICAgICAgICAgICAgImVheSI6IC0uMDY1LAogICAgICAgICAgICAgICAgInNlIjogdHJ1ZSwKICAgICAgICAgICAgICAgICJlZSI6IHRydWUKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgIngiOiAxLAogICAgICAgICAgICAgICAgInkiOiAxLAogICAgICAgICAgICAgICAgInNheCI6IDAsCiAgICAgICAgICAgICAgICAic2F5IjogMCwKICAgICAgICAgICAgICAgICJlYXgiOiAtLjI1LAogICAgICAgICAgICAgICAgImVheSI6IDAsCiAgICAgICAgICAgICAgICAic2UiOiBmYWxzZSwKICAgICAgICAgICAgICAgICJlZSI6IHRydWUKICAgICAgICAgICAgfV0pOwogICAgICAgICAgICB0aGlzLl9BZGRQcmVkaWZpbmVkRWFzZSgiZWFzZWlucXVhcnQiLCBbewogICAgICAgICAgICAgICAgICAgICJ4IjogMCwKICAgICAgICAgICAgICAgICAgICAieSI6IDAsCiAgICAgICAgICAgICAgICAgICAgInNheCI6IC4yNjQsCiAgICAgICAgICAgICAgICAgICAgInNheSI6IC4wNzksCiAgICAgICAgICAgICAgICAgICAgImVheCI6IDAsCiAgICAgICAgICAgICAgICAgICAgImVheSI6IDAsCiAgICAgICAgICAgICAgICAgICAgInNlIjogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAiZWUiOiBmYWxzZQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAieCI6IDEsCiAgICAgICAgICAgICAgICAgICAgInkiOiAxLAogICAgICAgICAgICAgICAgICAgICJzYXgiOiAwLAogICAgICAgICAgICAgICAgICAgICJzYXkiOiAwLAogICAgICAgICAgICAgICAgICAgICJlYXgiOiAtLjMyOSwKICAgICAgICAgICAgICAgICAgICAiZWF5IjogLTEuMjg3LAogICAgICAgICAgICAgICAgICAgICJzZSI6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICJlZSI6IHRydWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgXSk7CiAgICAgICAgICAgIHRoaXMuX0FkZFByZWRpZmluZWRFYXNlKCJlYXNlb3V0cXVhcnQiLCBbewogICAgICAgICAgICAgICAgIngiOiAwLAogICAgICAgICAgICAgICAgInkiOiAwLAogICAgICAgICAgICAgICAgInNheCI6IC4zMjksCiAgICAgICAgICAgICAgICAic2F5IjogMS4yODcsCiAgICAgICAgICAgICAgICAiZWF4IjogMCwKICAgICAgICAgICAgICAgICJlYXkiOiAwLAogICAgICAgICAgICAgICAgInNlIjogdHJ1ZSwKICAgICAgICAgICAgICAgICJlZSI6IGZhbHNlCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICJ4IjogMSwKICAgICAgICAgICAgICAgICJ5IjogMSwKICAgICAgICAgICAgICAgICJzYXgiOiAwLAogICAgICAgICAgICAgICAgInNheSI6IDAsCiAgICAgICAgICAgICAgICAiZWF4IjogLS4yNjQsCiAgICAgICAgICAgICAgICAiZWF5IjogLS4wNzksCiAgICAgICAgICAgICAgICAic2UiOiBmYWxzZSwKICAgICAgICAgICAgICAgICJlZSI6IHRydWUKICAgICAgICAgICAgfV0pOwogICAgICAgICAgICB0aGlzLl9BZGRQcmVkaWZpbmVkRWFzZSgiZWFzZWlub3V0cXVhcnQiLCBbewogICAgICAgICAgICAgICAgIngiOiAwLAogICAgICAgICAgICAgICAgInkiOiAwLAogICAgICAgICAgICAgICAgInNheCI6IC43NjUsCiAgICAgICAgICAgICAgICAic2F5IjogLjAzLAogICAgICAgICAgICAgICAgImVheCI6IDAsCiAgICAgICAgICAgICAgICAiZWF5IjogMCwKICAgICAgICAgICAgICAgICJzZSI6IHRydWUsCiAgICAgICAgICAgICAgICAiZWUiOiBmYWxzZQogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAieCI6IDEsCiAgICAgICAgICAgICAgICAieSI6IDEsCiAgICAgICAgICAgICAgICAic2F4IjogMCwKICAgICAgICAgICAgICAgICJzYXkiOiAwLAogICAgICAgICAgICAgICAgImVheCI6IC0uNzY1LAogICAgICAgICAgICAgICAgImVheSI6IC0uMDMsCiAgICAgICAgICAgICAgICAic2UiOiBmYWxzZSwKICAgICAgICAgICAgICAgICJlZSI6IHRydWUKICAgICAgICAgICAgfV0pOwogICAgICAgICAgICB0aGlzLl9BZGRQcmVkaWZpbmVkRWFzZSgiZWFzZWlucXVpbnQiLCBbewogICAgICAgICAgICAgICAgIngiOiAwLAogICAgICAgICAgICAgICAgInkiOiAwLAogICAgICAgICAgICAgICAgInNheCI6IC42LAogICAgICAgICAgICAgICAgInNheSI6IDAsCiAgICAgICAgICAgICAgICAiZWF4IjogMCwKICAgICAgICAgICAgICAgICJlYXkiOiAwLAogICAgICAgICAgICAgICAgInNlIjogdHJ1ZSwKICAgICAgICAgICAgICAgICJlZSI6IGZhbHNlCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICJ4IjogMSwKICAgICAgICAgICAgICAgICJ5IjogMSwKICAgICAgICAgICAgICAgICJzYXgiOiAwLAogICAgICAgICAgICAgICAgInNheSI6IDAsCiAgICAgICAgICAgICAgICAiZWF4IjogLS4yLAogICAgICAgICAgICAgICAgImVheSI6IC0xLAogICAgICAgICAgICAgICAgInNlIjogZmFsc2UsCiAgICAgICAgICAgICAgICAiZWUiOiB0cnVlCiAgICAgICAgICAgIH1dKTsKICAgICAgICAgICAgdGhpcy5fQWRkUHJlZGlmaW5lZEVhc2UoImVhc2VvdXRxdWludCIsIFt7CiAgICAgICAgICAgICAgICAieCI6IDAsCiAgICAgICAgICAgICAgICAieSI6IDAsCiAgICAgICAgICAgICAgICAic2F4IjogLjIsCiAgICAgICAgICAgICAgICAic2F5IjogMSwKICAgICAgICAgICAgICAgICJlYXgiOiAwLAogICAgICAgICAgICAgICAgImVheSI6IDAsCiAgICAgICAgICAgICAgICAic2UiOiB0cnVlLAogICAgICAgICAgICAgICAgImVlIjogZmFsc2UKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgIngiOiAxLAogICAgICAgICAgICAgICAgInkiOiAxLAogICAgICAgICAgICAgICAgInNheCI6IDAsCiAgICAgICAgICAgICAgICAic2F5IjogMCwKICAgICAgICAgICAgICAgICJlYXgiOiAtLjYsCiAgICAgICAgICAgICAgICAiZWF5IjogMCwKICAgICAgICAgICAgICAgICJzZSI6IGZhbHNlLAogICAgICAgICAgICAgICAgImVlIjogdHJ1ZQogICAgICAgICAgICB9XSk7CiAgICAgICAgICAgIHRoaXMuX0FkZFByZWRpZmluZWRFYXNlKCJlYXNlaW5vdXRxdWludCIsIFt7CiAgICAgICAgICAgICAgICAiZWF4IjogMCwKICAgICAgICAgICAgICAgICJlYXkiOiAwLAogICAgICAgICAgICAgICAgImVlIjogZmFsc2UsCiAgICAgICAgICAgICAgICAic2F4IjogLjg0LAogICAgICAgICAgICAgICAgInNheSI6IDAsCiAgICAgICAgICAgICAgICAic2UiOiB0cnVlLAogICAgICAgICAgICAgICAgIngiOiAwLAogICAgICAgICAgICAgICAgInkiOiAwCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICJlYXgiOiAtLjg0LAogICAgICAgICAgICAgICAgImVheSI6IDAsCiAgICAgICAgICAgICAgICAiZWUiOiB0cnVlLAogICAgICAgICAgICAgICAgInNheCI6IDAsCiAgICAgICAgICAgICAgICAic2F5IjogMCwKICAgICAgICAgICAgICAgICJzZSI6IGZhbHNlLAogICAgICAgICAgICAgICAgIngiOiAxLAogICAgICAgICAgICAgICAgInkiOiAxCiAgICAgICAgICAgIH1dKTsKICAgICAgICAgICAgdGhpcy5fQWRkUHJlZGlmaW5lZEVhc2UoImVhc2VpbmNpcmMiLCBbewogICAgICAgICAgICAgICAgIngiOiAwLAogICAgICAgICAgICAgICAgInkiOiAwLAogICAgICAgICAgICAgICAgInNheCI6IC4yNSwKICAgICAgICAgICAgICAgICJzYXkiOiAwLAogICAgICAgICAgICAgICAgImVheCI6IDAsCiAgICAgICAgICAgICAgICAiZWF5IjogMCwKICAgICAgICAgICAgICAgICJzZSI6IHRydWUsCiAgICAgICAgICAgICAgICAiZWUiOiBmYWxzZQogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAieCI6IDEsCiAgICAgICAgICAgICAgICAieSI6IDEsCiAgICAgICAgICAgICAgICAic2F4IjogMCwKICAgICAgICAgICAgICAgICJzYXkiOiAwLAogICAgICAgICAgICAgICAgImVheCI6IC0uMDI0LAogICAgICAgICAgICAgICAgImVheSI6IC0uODA4LAogICAgICAgICAgICAgICAgInNlIjogZmFsc2UsCiAgICAgICAgICAgICAgICAiZWUiOiB0cnVlCiAgICAgICAgICAgIH1dKTsKICAgICAgICAgICAgdGhpcy5fQWRkUHJlZGlmaW5lZEVhc2UoImVhc2VvdXRjaXJjIiwgW3sKICAgICAgICAgICAgICAgICJ4IjogMCwKICAgICAgICAgICAgICAgICJ5IjogMCwKICAgICAgICAgICAgICAgICJzYXgiOiAuMDI0LAogICAgICAgICAgICAgICAgInNheSI6IC44MDgsCiAgICAgICAgICAgICAgICAiZWF4IjogMCwKICAgICAgICAgICAgICAgICJlYXkiOiAwLAogICAgICAgICAgICAgICAgInNlIjogdHJ1ZSwKICAgICAgICAgICAgICAgICJlZSI6IGZhbHNlCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICJ4IjogMSwKICAgICAgICAgICAgICAgICJ5IjogMSwKICAgICAgICAgICAgICAgICJzYXgiOiAwLAogICAgICAgICAgICAgICAgInNheSI6IDAsCiAgICAgICAgICAgICAgICAiZWF4IjogLS4yNSwKICAgICAgICAgICAgICAgICJlYXkiOiAwLAogICAgICAgICAgICAgICAgInNlIjogZmFsc2UsCiAgICAgICAgICAgICAgICAiZWUiOiB0cnVlCiAgICAgICAgICAgIH1dKTsKICAgICAgICAgICAgdGhpcy5fQWRkUHJlZGlmaW5lZEVhc2UoImVhc2Vpbm91dGNpcmMiLCBbewogICAgICAgICAgICAgICAgIngiOiAwLAogICAgICAgICAgICAgICAgInkiOiAwLAogICAgICAgICAgICAgICAgInNheCI6IC4xMjUsCiAgICAgICAgICAgICAgICAic2F5IjogMCwKICAgICAgICAgICAgICAgICJlYXgiOiAwLAogICAgICAgICAgICAgICAgImVheSI6IDAsCiAgICAgICAgICAgICAgICAic2UiOiB0cnVlLAogICAgICAgICAgICAgICAgImVlIjogZmFsc2UKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgIngiOiAuNSwKICAgICAgICAgICAgICAgICJ5IjogLjUsCiAgICAgICAgICAgICAgICAic2F4IjogLjAyLAogICAgICAgICAgICAgICAgInNheSI6IC40MjgsCiAgICAgICAgICAgICAgICAiZWF4IjogLS4wMiwKICAgICAgICAgICAgICAgICJlYXkiOiAtLjQyOCwKICAgICAgICAgICAgICAgICJzZSI6IHRydWUsCiAgICAgICAgICAgICAgICAiZWUiOiB0cnVlCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICJ4IjogMSwKICAgICAgICAgICAgICAgICJ5IjogMSwKICAgICAgICAgICAgICAgICJzYXgiOiAwLAogICAgICAgICAgICAgICAgInNheSI6IDAsCiAgICAgICAgICAgICAgICAiZWF4IjogLS4xMjUsCiAgICAgICAgICAgICAgICAiZWF5IjogMCwKICAgICAgICAgICAgICAgICJzZSI6IGZhbHNlLAogICAgICAgICAgICAgICAgImVlIjogdHJ1ZQogICAgICAgICAgICB9XSk7CiAgICAgICAgICAgIHRoaXMuX0FkZFByZWRpZmluZWRFYXNlKCJlYXNlaW5leHBvIiwgW3sKICAgICAgICAgICAgICAgICJ4IjogMCwKICAgICAgICAgICAgICAgICJ5IjogMCwKICAgICAgICAgICAgICAgICJzYXgiOiAuNjYsCiAgICAgICAgICAgICAgICAic2F5IjogMCwKICAgICAgICAgICAgICAgICJlYXgiOiAwLAogICAgICAgICAgICAgICAgImVheSI6IDAsCiAgICAgICAgICAgICAgICAic2UiOiB0cnVlLAogICAgICAgICAgICAgICAgImVlIjogZmFsc2UKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgIngiOiAxLAogICAgICAgICAgICAgICAgInkiOiAxLAogICAgICAgICAgICAgICAgInNheCI6IDAsCiAgICAgICAgICAgICAgICAic2F5IjogMCwKICAgICAgICAgICAgICAgICJlYXgiOiAtLjE0LAogICAgICAgICAgICAgICAgImVheSI6IC0xLAogICAgICAgICAgICAgICAgInNlIjogZmFsc2UsCiAgICAgICAgICAgICAgICAiZWUiOiB0cnVlCiAgICAgICAgICAgIH1dKTsKICAgICAgICAgICAgdGhpcy5fQWRkUHJlZGlmaW5lZEVhc2UoImVhc2VvdXRleHBvIiwgW3sKICAgICAgICAgICAgICAgICJ4IjogMCwKICAgICAgICAgICAgICAgICJ5IjogMCwKICAgICAgICAgICAgICAgICJzYXgiOiAuMTQsCiAgICAgICAgICAgICAgICAic2F5IjogMSwKICAgICAgICAgICAgICAgICJlYXgiOiAwLAogICAgICAgICAgICAgICAgImVheSI6IDAsCiAgICAgICAgICAgICAgICAic2UiOiB0cnVlLAogICAgICAgICAgICAgICAgImVlIjogZmFsc2UKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgIngiOiAxLAogICAgICAgICAgICAgICAgInkiOiAxLAogICAgICAgICAgICAgICAgInNheCI6IDAsCiAgICAgICAgICAgICAgICAic2F5IjogMCwKICAgICAgICAgICAgICAgICJlYXgiOiAtLjY2LAogICAgICAgICAgICAgICAgImVheSI6IDAsCiAgICAgICAgICAgICAgICAic2UiOiBmYWxzZSwKICAgICAgICAgICAgICAgICJlZSI6IHRydWUKICAgICAgICAgICAgfV0pOwogICAgICAgICAgICB0aGlzLl9BZGRQcmVkaWZpbmVkRWFzZSgiZWFzZWlub3V0ZXhwbyIsIFt7CiAgICAgICAgICAgICAgICAiZWF4IjogMCwKICAgICAgICAgICAgICAgICJlYXkiOiAwLAogICAgICAgICAgICAgICAgImVlIjogZmFsc2UsCiAgICAgICAgICAgICAgICAic2F4IjogLjM0NSwKICAgICAgICAgICAgICAgICJzYXkiOiAwLAogICAgICAgICAgICAgICAgInNlIjogdHJ1ZSwKICAgICAgICAgICAgICAgICJ4IjogMCwKICAgICAgICAgICAgICAgICJ5IjogMAogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAiZWF4IjogLS4wNiwKICAgICAgICAgICAgICAgICJlYXkiOiAtLjUsCiAgICAgICAgICAgICAgICAiZWUiOiB0cnVlLAogICAgICAgICAgICAgICAgInNheCI6IC4wNiwKICAgICAgICAgICAgICAgICJzYXkiOiAuNSwKICAgICAgICAgICAgICAgICJzZSI6IHRydWUsCiAgICAgICAgICAgICAgICAieCI6IC41LAogICAgICAgICAgICAgICAgInkiOiAuNQogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAiZWF4IjogLS4zMzUsCiAgICAgICAgICAgICAgICAiZWF5IjogMCwKICAgICAgICAgICAgICAgICJlZSI6IHRydWUsCiAgICAgICAgICAgICAgICAic2F4IjogMCwKICAgICAgICAgICAgICAgICJzYXkiOiAwLAogICAgICAgICAgICAgICAgInNlIjogZmFsc2UsCiAgICAgICAgICAgICAgICAieCI6IDEsCiAgICAgICAgICAgICAgICAieSI6IDEKICAgICAgICAgICAgfV0pOwogICAgICAgICAgICB0aGlzLl9BZGRQcml2YXRlQ3VzdG9tRWFzZSgiY3ViaWNiZXppZXIiLCB0aGlzLkVhc2VDdWJpY0Jlemllcik7CiAgICAgICAgICAgIHRoaXMuX0FkZFByaXZhdGVDdXN0b21FYXNlKCJzcGxpbmUiLCB0aGlzLkVhc2VTcGxpbmUpCiAgICAgICAgfQogICAgICAgIHN0YXRpYyBfQWRkUHJlZGlmaW5lZEVhc2UobmFtZSwgZGF0YUFycmF5X29yX2Z1bmN0aW9uLCBsaW5lYXIgPSBmYWxzZSkgewogICAgICAgICAgICBpZiAodHlwZW9mIGRhdGFBcnJheV9vcl9mdW5jdGlvbiA9PT0gImZ1bmN0aW9uIikgRWFzZS5fQWRkRWFzZShuYW1lLCBkYXRhQXJyYXlfb3JfZnVuY3Rpb24sICJwcmVkZWZpbmVkIik7CiAgICAgICAgICAgIGVsc2UgaWYgKEMzLklzQXJyYXkoZGF0YUFycmF5X29yX2Z1bmN0aW9uKSkKICAgICAgICAgICAgICAgIGlmIChzZWxmLkJ1aWx0SW5UcmFuc2l0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYnVpbHRJblRyYW5zaXRpb24gPQogICAgICAgICAgICAgICAgICAgICAgICBDMy5OZXcoc2VsZi5CdWlsdEluVHJhbnNpdGlvbiwgbmFtZSwgbGluZWFyKTsKICAgICAgICAgICAgICAgICAgICBidWlsdEluVHJhbnNpdGlvbi5TZXRGcm9tSnNvbihkYXRhQXJyYXlfb3JfZnVuY3Rpb24pOwogICAgICAgICAgICAgICAgICAgIEVhc2UuX0FkZEVhc2UobmFtZSwgKHQsIHN2LCBkdiwgdHQpID0+IGJ1aWx0SW5UcmFuc2l0aW9uLkludGVycG9sYXRlKHQsIHN2LCBkdiwgdHQpLCAicHJlZGVmaW5lZCIpOwogICAgICAgICAgICAgICAgICAgIEJVSUxUX0lOX1RSQU5TSVRJT05fTUFQLnNldChuYW1lLCBidWlsdEluVHJhbnNpdGlvbikKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYnVpbHRJblRyYW5zaXRpb24gPSBDMy5OZXcoQzMuVHJhbnNpdGlvbiwgW25hbWUsIGRhdGFBcnJheV9vcl9mdW5jdGlvbi5tYXAoZGF0YSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbZGF0YVsieCJdLCBkYXRhWyJ5Il0sIGRhdGFbInNheCJdLCBkYXRhWyJzYXkiXSwgZGF0YVsiZWF4Il0sIGRhdGFbImVheSJdLCBkYXRhWyJzZSJdLCBkYXRhWyJlZSJdXQogICAgICAgICAgICAgICAgICAgIH0pXSwgZmFsc2UpOwogICAgICAgICAgICAgICAgICAgIGJ1aWx0SW5UcmFuc2l0aW9uLk1ha2VMaW5lYXIobGluZWFyKTsKICAgICAgICAgICAgICAgICAgICBFYXNlLl9BZGRFYXNlKG5hbWUsICh0LCBzdiwgZHYsIHR0KSA9PgogICAgICAgICAgICAgICAgICAgICAgICBidWlsdEluVHJhbnNpdGlvbi5JbnRlcnBvbGF0ZSh0LCBzdiwgZHYsIHR0KSwgInByZWRlZmluZWQiKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHRocm93IG5ldyBFcnJvcigidW5leHBlY3RlZCBhcmd1bWVudHMiKTsKICAgICAgICB9CiAgICAgICAgc3RhdGljIF9BZGRQcml2YXRlQ3VzdG9tRWFzZShuYW1lLCBmdW5jKSB7CiAgICAgICAgICAgIEVhc2UuX0FkZEVhc2UobmFtZSwgZnVuYywgInByaXZhdGUiKQogICAgICAgIH0KICAgICAgICBzdGF0aWMgQWRkQ3VzdG9tRWFzZShuYW1lLCBmdW5jLCBwcm9qZWN0KSB7CiAgICAgICAgICAgIHRoaXMuX0NyZWF0ZUVhc2VNYXAoKTsKICAgICAgICAgICAgRWFzZS5fQWRkRWFzZShuYW1lLCBmdW5jLCAiY3VzdG9tIiwgcHJvamVjdCkKICAgICAgICB9CiAgICAgICAgc3RhdGljIFJlbW92ZUN1c3RvbUVhc2UobmFtZSwgcHJvamVjdCkgewogICAgICAgICAgICBpZiAodGhpcy5Jc05hbWVQcmVkZWZpbmVkKG5hbWUpKSByZXR1cm47CiAgICAgICAgICAgIGlmIChbLi4uUFJJVkFURV9FQVNFX01BUC5rZXlzKCldLmluY2x1ZGVzKG5hbWUpKSByZXR1cm47CiAgICAgICAgICAgIGNvbnN0IGN1c3RvbUVhc2VNYXAgPSBDVVNUT01fRUFTRV9FRElUT1JfTUFQLmdldChwcm9qZWN0KTsKICAgICAgICAgICAgaWYgKGN1c3RvbUVhc2VNYXApIGN1c3RvbUVhc2VNYXAuZGVsZXRlKG5hbWUpCiAgICAgICAgfQogICAgICAgIHN0YXRpYyBfQWRkRWFzZShuYW1lLAogICAgICAgICAgICBmdW5jLCBtb2RlLCBwcm9qZWN0KSB7CiAgICAgICAgICAgIHN3aXRjaCAobW9kZSkgewogICAgICAgICAgICAgICAgY2FzZSAicHJlZGVmaW5lZCI6CiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBFQVNFX01BUC5zZXQobmFtZSwgZnVuYyk7UFJFREVGSU5FRF9FQVNFX01BUC5zZXQobmFtZSwgZnVuYyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2FzZSAiY3VzdG9tIjoKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwcm9qZWN0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIUNVU1RPTV9FQVNFX0VESVRPUl9NQVAuaGFzKHByb2plY3QpKSBDVVNUT01fRUFTRV9FRElUT1JfTUFQLnNldChwcm9qZWN0LCBuZXcgTWFwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGN1c3RvbUVhc2VNYXAgPSBDVVNUT01fRUFTRV9FRElUT1JfTUFQLmdldChwcm9qZWN0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1c3RvbUVhc2VNYXAuc2V0KG5hbWUsIGZ1bmMpCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBDVVNUT01fRUFTRV9SVU5USU1FX01BUC5zZXQobmFtZSwgZnVuYyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2FzZSAicHJpdmF0ZSI6CiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBFQVNFX01BUC5zZXQobmFtZSwgZnVuYyk7UFJJVkFURV9FQVNFX01BUC5zZXQobmFtZSwgZnVuYyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoInVuZXhwZWN0ZWQgZWFzZSBtb2RlIik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgc3RhdGljIE5vRWFzZSh0LAogICAgICAgICAgICBiLCBjLCBkKSB7CiAgICAgICAgICAgIHJldHVybiBjICogdCAvIGQgKyBiCiAgICAgICAgfQogICAgICAgIHN0YXRpYyBFYXNlSW5RdWFkKHQsIGIsIGMsIGQpIHsKICAgICAgICAgICAgcmV0dXJuIGMgKiAodCAvPSBkKSAqIHQgKyBiCiAgICAgICAgfQogICAgICAgIHN0YXRpYyBFYXNlT3V0UXVhZCh0LCBiLCBjLCBkKSB7CiAgICAgICAgICAgIHJldHVybiAtYyAqICh0IC89IGQpICogKHQgLSAyKSArIGIKICAgICAgICB9CiAgICAgICAgc3RhdGljIEVhc2VJbk91dFF1YWQodCwgYiwgYywgZCkgewogICAgICAgICAgICBpZiAoKHQgLz0gZCAvIDIpIDwgMSkgcmV0dXJuIGMgLyAyICogdCAqIHQgKyBiOwogICAgICAgICAgICByZXR1cm4gLWMgLyAyICogKC0tdCAqICh0IC0gMikgLSAxKSArIGIKICAgICAgICB9CiAgICAgICAgc3RhdGljIEVhc2VJbkN1YmljKHQsIGIsIGMsIGQpIHsKICAgICAgICAgICAgcmV0dXJuIGMgKiAodCAvPSBkKSAqIHQgKiB0ICsgYgogICAgICAgIH0KICAgICAgICBzdGF0aWMgRWFzZU91dEN1YmljKHQsIGIsIGMsIGQpIHsKICAgICAgICAgICAgcmV0dXJuIGMgKiAoKHQgPSB0IC8gZCAtIDEpICogdCAqIHQgKyAxKSArIGIKICAgICAgICB9CiAgICAgICAgc3RhdGljIEVhc2VJbk91dEN1YmljKHQsIGIsIGMsIGQpIHsKICAgICAgICAgICAgaWYgKCh0IC89IGQgLyAyKSA8IDEpIHJldHVybiBjIC8gMiAqIHQgKiB0ICogdCArIGI7CiAgICAgICAgICAgIHJldHVybiBjIC8gMiAqICgodCAtPSAyKSAqIHQgKiB0ICsgMikgKyBiCiAgICAgICAgfQogICAgICAgIHN0YXRpYyBFYXNlSW5RdWFydCh0LCBiLCBjLCBkKSB7CiAgICAgICAgICAgIHJldHVybiBjICogKHQgLz0gZCkgKiB0ICogdCAqIHQgKyBiCiAgICAgICAgfQogICAgICAgIHN0YXRpYyBFYXNlT3V0UXVhcnQodCwgYiwgYywgZCkgewogICAgICAgICAgICByZXR1cm4gLWMgKiAoKHQgPQogICAgICAgICAgICAgICAgdCAvIGQgLSAxKSAqIHQgKiB0ICogdCAtIDEpICsgYgogICAgICAgIH0KICAgICAgICBzdGF0aWMgRWFzZUluT3V0UXVhcnQodCwgYiwgYywgZCkgewogICAgICAgICAgICBpZiAoKHQgLz0gZCAvIDIpIDwgMSkgcmV0dXJuIGMgLyAyICogdCAqIHQgKiB0ICogdCArIGI7CiAgICAgICAgICAgIHJldHVybiAtYyAvIDIgKiAoKHQgLT0gMikgKiB0ICogdCAqIHQgLSAyKSArIGIKICAgICAgICB9CiAgICAgICAgc3RhdGljIEVhc2VJblF1aW50KHQsIGIsIGMsIGQpIHsKICAgICAgICAgICAgcmV0dXJuIGMgKiAodCAvPSBkKSAqIHQgKiB0ICogdCAqIHQgKyBiCiAgICAgICAgfQogICAgICAgIHN0YXRpYyBFYXNlT3V0UXVpbnQodCwgYiwgYywgZCkgewogICAgICAgICAgICByZXR1cm4gYyAqICgodCA9IHQgLyBkIC0gMSkgKiB0ICogdCAqIHQgKiB0ICsgMSkgKyBiCiAgICAgICAgfQogICAgICAgIHN0YXRpYyBFYXNlSW5PdXRRdWludCh0LCBiLCBjLCBkKSB7CiAgICAgICAgICAgIGlmICgodCAvPSBkIC8gMikgPCAxKSByZXR1cm4gYyAvIDIgKiB0ICogdCAqIHQgKiB0ICogdCArIGI7CiAgICAgICAgICAgIHJldHVybiBjIC8gMiAqICgodCAtPSAyKSAqIHQgKiB0ICogdCAqIHQgKyAyKSArIGIKICAgICAgICB9CiAgICAgICAgc3RhdGljIEVhc2VJblNpbmUodCwgYiwgYywgZCkgewogICAgICAgICAgICByZXR1cm4gLWMgKiBNYXRoLmNvcyh0IC8gZCAqIChNYXRoLlBJIC8gMikpICsgYyArIGIKICAgICAgICB9CiAgICAgICAgc3RhdGljIEVhc2VPdXRTaW5lKHQsIGIsIGMsIGQpIHsKICAgICAgICAgICAgcmV0dXJuIGMgKiBNYXRoLnNpbih0IC8gZCAqIChNYXRoLlBJIC8gMikpICsgYgogICAgICAgIH0KICAgICAgICBzdGF0aWMgRWFzZUluT3V0U2luZSh0LCBiLCBjLCBkKSB7CiAgICAgICAgICAgIHJldHVybiAtYyAvIDIgKgogICAgICAgICAgICAgICAgKE1hdGguY29zKE1hdGguUEkgKiB0IC8gZCkgLSAxKSArIGIKICAgICAgICB9CiAgICAgICAgc3RhdGljIEVhc2VJbkV4cG8odCwgYiwgYywgZCkgewogICAgICAgICAgICByZXR1cm4gdCA9PT0gMCA/IGIgOiBjICogTWF0aC5wb3coMiwgMTAgKiAodCAvIGQgLSAxKSkgKyBiCiAgICAgICAgfQogICAgICAgIHN0YXRpYyBFYXNlT3V0RXhwbyh0LCBiLCBjLCBkKSB7CiAgICAgICAgICAgIHJldHVybiB0ID09PSBkID8gYiArIGMgOiBjICogKC1NYXRoLnBvdygyLCAtMTAgKiB0IC8gZCkgKyAxKSArIGIKICAgICAgICB9CiAgICAgICAgc3RhdGljIEVhc2VJbk91dEV4cG8odCwgYiwgYywgZCkgewogICAgICAgICAgICBpZiAodCA9PT0gMCkgcmV0dXJuIGI7CiAgICAgICAgICAgIGlmICh0ID09PSBkKSByZXR1cm4gYiArIGM7CiAgICAgICAgICAgIGlmICgodCAvPSBkIC8gMikgPCAxKSByZXR1cm4gYyAvIDIgKiBNYXRoLnBvdygyLCAxMCAqICh0IC0gMSkpICsgYjsKICAgICAgICAgICAgcmV0dXJuIGMgLyAyICogKC1NYXRoLnBvdygyLCAtMTAgKiAtLXQpICsgMikgKyBiCiAgICAgICAgfQogICAgICAgIHN0YXRpYyBFYXNlSW5DaXJjKHQsIGIsIGMsIGQpIHsKICAgICAgICAgICAgcmV0dXJuIC1jICogKE1hdGguc3FydCgxIC0gKHQgLz0gZCkgKiB0KSAtIDEpICsgYgogICAgICAgIH0KICAgICAgICBzdGF0aWMgRWFzZU91dENpcmModCwgYiwgYywgZCkgewogICAgICAgICAgICByZXR1cm4gYyAqIE1hdGguc3FydCgxIC0gKHQgPSB0IC8gZCAtIDEpICogdCkgKyBiCiAgICAgICAgfQogICAgICAgIHN0YXRpYyBFYXNlSW5PdXRDaXJjKHQsIGIsIGMsIGQpIHsKICAgICAgICAgICAgaWYgKCh0IC89IGQgLyAyKSA8IDEpIHJldHVybiAtYyAvCiAgICAgICAgICAgICAgICAyICogKE1hdGguc3FydCgxIC0gdCAqIHQpIC0gMSkgKyBiOwogICAgICAgICAgICByZXR1cm4gYyAvIDIgKiAoTWF0aC5zcXJ0KDEgLSAodCAtPSAyKSAqIHQpICsgMSkgKyBiCiAgICAgICAgfQogICAgICAgIHN0YXRpYyBFYXNlSW5FbGFzdGljKHQsIGIsIGMsIGQpIHsKICAgICAgICAgICAgbGV0IHMgPSAxLjcwMTU4OwogICAgICAgICAgICBsZXQgcCA9IDA7CiAgICAgICAgICAgIGxldCBhID0gYzsKICAgICAgICAgICAgaWYgKHQgPT09IDApIHJldHVybiBiOwogICAgICAgICAgICBpZiAoKHQgLz0gZCkgPT09IDEpIHJldHVybiBiICsgYzsKICAgICAgICAgICAgaWYgKCFwKSBwID0gZCAqIC4zOwogICAgICAgICAgICBpZiAoYSA8IE1hdGguYWJzKGMpKSB7CiAgICAgICAgICAgICAgICBhID0gYzsKICAgICAgICAgICAgICAgIHMgPSBwIC8gNAogICAgICAgICAgICB9IGVsc2UgcyA9IHAgLyAoMiAqIE1hdGguUEkpICogTWF0aC5hc2luKGMgLyBhKTsKICAgICAgICAgICAgcmV0dXJuIC0oYSAqIE1hdGgucG93KDIsIDEwICogKHQgLT0gMSkpICogTWF0aC5zaW4oKHQgKiBkIC0gcykgKiAoMiAqIE1hdGguUEkpIC8gcCkpICsgYgogICAgICAgIH0KICAgICAgICBzdGF0aWMgRWFzZU91dEVsYXN0aWModCwgYiwgYywgZCkgewogICAgICAgICAgICBsZXQgcyA9IDEuNzAxNTg7CiAgICAgICAgICAgIGxldCBwID0gMDsKICAgICAgICAgICAgbGV0IGEgPSBjOwogICAgICAgICAgICBpZiAodCA9PT0gMCkgcmV0dXJuIGI7CiAgICAgICAgICAgIGlmICgodCAvPSBkKSA9PT0gMSkgcmV0dXJuIGIgKyBjOwogICAgICAgICAgICBpZiAoIXApIHAgPSBkICogLjM7CiAgICAgICAgICAgIGlmIChhIDwgTWF0aC5hYnMoYykpIHsKICAgICAgICAgICAgICAgIGEgPSBjOwogICAgICAgICAgICAgICAgcyA9IHAgLyA0CiAgICAgICAgICAgIH0gZWxzZSBzID0gcCAvICgyICogTWF0aC5QSSkgKiBNYXRoLmFzaW4oYyAvIGEpOwogICAgICAgICAgICByZXR1cm4gYSAqCiAgICAgICAgICAgICAgICBNYXRoLnBvdygyLCAtMTAgKiB0KSAqIE1hdGguc2luKCh0ICogZCAtIHMpICogKDIgKiBNYXRoLlBJKSAvIHApICsgYyArIGIKICAgICAgICB9CiAgICAgICAgc3RhdGljIEVhc2VJbk91dEVsYXN0aWModCwgYiwgYywgZCkgewogICAgICAgICAgICBsZXQgcyA9IDEuNzAxNTg7CiAgICAgICAgICAgIGxldCBwID0gMDsKICAgICAgICAgICAgbGV0IGEgPSBjOwogICAgICAgICAgICBpZiAodCA9PT0gMCkgcmV0dXJuIGI7CiAgICAgICAgICAgIGlmICgodCAvPSBkIC8gMikgPT09IDIpIHJldHVybiBiICsgYzsKICAgICAgICAgICAgaWYgKCFwKSBwID0gZCAqICguMyAqIDEuNSk7CiAgICAgICAgICAgIGlmIChhIDwgTWF0aC5hYnMoYykpIHsKICAgICAgICAgICAgICAgIGEgPSBjOwogICAgICAgICAgICAgICAgcyA9IHAgLyA0CiAgICAgICAgICAgIH0gZWxzZSBzID0gcCAvICgyICogTWF0aC5QSSkgKiBNYXRoLmFzaW4oYyAvIGEpOwogICAgICAgICAgICBpZiAodCA8IDEpIHJldHVybiAtLjUgKiAoYSAqIE1hdGgucG93KDIsIDEwICogKHQgLT0gMSkpICogTWF0aC5zaW4oKHQgKiBkIC0gcykgKiAoMiAqIE1hdGguUEkpIC8gcCkpICsgYjsKICAgICAgICAgICAgcmV0dXJuIGEgKiBNYXRoLnBvdygyLCAtMTAgKiAodCAtPSAxKSkgKiBNYXRoLnNpbigodCAqIGQgLSBzKSAqICgyICogTWF0aC5QSSkgLyBwKSAqIC41ICsgYyArIGIKICAgICAgICB9CiAgICAgICAgc3RhdGljIEVhc2VJbkJhY2sodCwgYiwgYywgZCwgcykgewogICAgICAgICAgICBpZiAocyA9PT0gdW5kZWZpbmVkKSBzID0gMS43MDE1ODsKICAgICAgICAgICAgcmV0dXJuIGMgKiAodCAvPSBkKSAqIHQgKiAoKHMgKyAxKSAqIHQgLSBzKSArIGIKICAgICAgICB9CiAgICAgICAgc3RhdGljIEVhc2VPdXRCYWNrKHQsCiAgICAgICAgICAgIGIsIGMsIGQsIHMpIHsKICAgICAgICAgICAgaWYgKHMgPT09IHVuZGVmaW5lZCkgcyA9IDEuNzAxNTg7CiAgICAgICAgICAgIHJldHVybiBjICogKCh0ID0gdCAvIGQgLSAxKSAqIHQgKiAoKHMgKyAxKSAqIHQgKyBzKSArIDEpICsgYgogICAgICAgIH0KICAgICAgICBzdGF0aWMgRWFzZUluT3V0QmFjayh0LCBiLCBjLCBkLCBzKSB7CiAgICAgICAgICAgIGlmIChzID09PSB1bmRlZmluZWQpIHMgPSAxLjcwMTU4OwogICAgICAgICAgICBpZiAoKHQgLz0gZCAvIDIpIDwgMSkgcmV0dXJuIGMgLyAyICogKHQgKiB0ICogKCgocyAqPSAxLjUyNSkgKyAxKSAqIHQgLSBzKSkgKyBiOwogICAgICAgICAgICByZXR1cm4gYyAvIDIgKiAoKHQgLT0gMikgKiB0ICogKCgocyAqPSAxLjUyNSkgKyAxKSAqIHQgKyBzKSArIDIpICsgYgogICAgICAgIH0KICAgICAgICBzdGF0aWMgRWFzZUluQm91bmNlKHQsIGIsIGMsIGQpIHsKICAgICAgICAgICAgcmV0dXJuIGMgLSBFYXNlLkVhc2VPdXRCb3VuY2UoZCAtIHQsIDAsIGMsIGQpICsgYgogICAgICAgIH0KICAgICAgICBzdGF0aWMgRWFzZU91dEJvdW5jZSh0LCBiLCBjLCBkKSB7CiAgICAgICAgICAgIGlmICgodCAvPSBkKSA8IDEgLyAyLjc1KSByZXR1cm4gYyAqICg3LjU2MjUgKiB0ICogdCkgKyBiOwogICAgICAgICAgICBlbHNlIGlmICh0IDwgMiAvIDIuNzUpIHJldHVybiBjICogKDcuNTYyNSAqICh0IC09IDEuNSAvIDIuNzUpICogdCArIC43NSkgKyBiOwogICAgICAgICAgICBlbHNlIGlmICh0IDwgMi41IC8gMi43NSkgcmV0dXJuIGMgKiAoNy41NjI1ICogKHQgLT0gMi4yNSAvIDIuNzUpICogdCArIC45Mzc1KSArIGI7CiAgICAgICAgICAgIGVsc2UgcmV0dXJuIGMgKgogICAgICAgICAgICAgICAgKDcuNTYyNSAqICh0IC09IDIuNjI1IC8gMi43NSkgKiB0ICsgLjk4NDM3NSkgKyBiCiAgICAgICAgfQogICAgICAgIHN0YXRpYyBFYXNlSW5PdXRCb3VuY2UodCwgYiwgYywgZCkgewogICAgICAgICAgICBpZiAodCA8IGQgLyAyKSByZXR1cm4gRWFzZS5FYXNlSW5Cb3VuY2UodCAqIDIsIDAsIGMsIGQpICogLjUgKyBiOwogICAgICAgICAgICByZXR1cm4gRWFzZS5FYXNlT3V0Qm91bmNlKHQgKiAyIC0gZCwgMCwgYywgZCkgKiAuNSArIGMgKiAuNSArIGIKICAgICAgICB9CiAgICAgICAgc3RhdGljIEVhc2VDdWJpY0Jlemllcih0LCBwMCwgcDEsIHAyLCBwMykgewogICAgICAgICAgICBjb25zdCBfMCA9IHAwOwogICAgICAgICAgICBjb25zdCBfMSA9IDMgKiB0ICogKHAxIC0gcDApOwogICAgICAgICAgICBjb25zdCBfMiA9IDMgKiB0ICoqIDIgKiAocDAgKyBwMiAtIDIgKiBwMSk7CiAgICAgICAgICAgIGNvbnN0IF8zID0gdCAqKiAzICogKHAzIC0gcDAgKyAzICogcDEgLSAzICogcDIpOwogICAgICAgICAgICByZXR1cm4gXzAgKyBfMSArIF8yICsgXzMKICAgICAgICB9CiAgICAgICAgc3RhdGljIEVhc2VTcGxpbmUodCwgc3gsIHN5LCB4MSwgeTEsIHgyLCB5MiwgZXgsIGV5LCBzYW1wbGVzKSB7CiAgICAgICAgICAgIGlmICh4MSA9PT0geTEgJiYgeDIgPT09IHkyKSByZXR1cm4gdDsKICAgICAgICAgICAgY29uc3QgdHggPSBnZXRfdF9mb3JfeCh0LCBzeCwgeDEsIHgyLCBleCwgc2FtcGxlcyk7CiAgICAgICAgICAgIGNvbnN0IHZhID0gYShzeSwgeTEsIHkyLCBleSk7CiAgICAgICAgICAgIGNvbnN0IHZiID0gYihzeSwgeTEsIHkyLCBleSk7CiAgICAgICAgICAgIGNvbnN0IHZjID0KICAgICAgICAgICAgICAgIGMoc3ksIHkxLCB5MiwgZXkpOwogICAgICAgICAgICByZXR1cm4gY2FsY19iZXppZXIodHgsIHZhLCB2YiwgdmMpCiAgICAgICAgfQogICAgICAgIHN0YXRpYyBHZXRCZXppZXJTYW1wbGVzKHN0YXJ0eCwgYTF4LCBhMngsIGVuZHgpIHsKICAgICAgICAgICAgY29uc3QgcmV0ID0gW107CiAgICAgICAgICAgIGNvbnN0IHZhID0gYShzdGFydHgsIGExeCwgYTJ4LCBlbmR4KTsKICAgICAgICAgICAgY29uc3QgdmIgPSBiKHN0YXJ0eCwgYTF4LCBhMngsIGVuZHgpOwogICAgICAgICAgICBjb25zdCB2YyA9IGMoc3RhcnR4LCBhMXgsIGEyeCwgZW5keCk7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgU0FNUExFX0NPVU5UOyArK2kpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHNhbXBsZSA9IGNhbGNfYmV6aWVyKGkgKiBTQU1QTEVfU1RFUCwgdmEsIHZiLCB2Yyk7CiAgICAgICAgICAgICAgICByZXQucHVzaChzYW1wbGUpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHJldAogICAgICAgIH0KICAgIH07CiAgICBjb25zdCBTQU1QTEVfQ09VTlQgPSAxMTsKICAgIGNvbnN0IFNBTVBMRV9TVEVQID0gMSAvIChTQU1QTEVfQ09VTlQgLSAxKTsKICAgIGNvbnN0IE5FV1RPTl9SQVBIU09OX0lURVJBVElPTlMgPSA0OwogICAgY29uc3QgTkVXVE9OX1JBUEhTT05fTUlOX1NMT1BFID0gLjAxOwogICAgY29uc3QgU1VCRElWSVNJT05fUFJFQ0lTSU9OID0gMUUtNzsKICAgIGNvbnN0IFNVQkRJVklTSU9OX01BWF9JVEVSQVRJT05TID0gMTA7CiAgICBjb25zdCBhID0gKHAwLCBwMSwgcDIsIHAzKSA9PiB7CiAgICAgICAgcmV0dXJuIHAzIC0gMyAqIHAyICsgMyAqIHAxIC0gcDAKICAgIH07CiAgICBjb25zdCBiID0gKHAwLCBwMSwgcDIsIHAzKSA9PiB7CiAgICAgICAgcmV0dXJuIDMgKiBwMiAtIDYgKiBwMSArIDMgKiBwMAogICAgfTsKICAgIGNvbnN0IGMgPSAocDAsIHAxLCBwMiwgcDMpID0+IHsKICAgICAgICByZXR1cm4gMyAqIChwMSAtIHAwKQogICAgfTsKICAgIGNvbnN0IGNhbGNfYmV6aWVyID0gKGFULCBhLCBiLCBjKSA9PiB7CiAgICAgICAgcmV0dXJuICgoYSAqIGFUICsgYikgKiBhVCArIGMpICogYVQKICAgIH07CiAgICBjb25zdCBnZXRfc2xvcGUgPSAoYVQsIGEsIGIsIGMpID0+IHsKICAgICAgICByZXR1cm4gMyAqIGEgKiBhVCAqIGFUICsgMiAqIGIgKiBhVCArIGMKICAgIH07CiAgICBjb25zdCBnZXRfdF9mb3JfeCA9IChhWCwgcDAsIHAxLCBwMiwgcDMsIHNhbXBsZXMpID0+IHsKICAgICAgICBpZiAoYVggPT0gMSkgcmV0dXJuIDE7CiAgICAgICAgbGV0IGludGVydmFsU3RhcnQgPSAwOwogICAgICAgIGxldCBjdXJyZW50U2FtcGxlSW5kZXggPSAxOwogICAgICAgIGxldCBjdXJyZW50U2FtcGxlVmFsdWUgPSBzYW1wbGVzW2N1cnJlbnRTYW1wbGVJbmRleF07CiAgICAgICAgbGV0IGxhc3RTYW1wbGVJbmRleCA9IFNBTVBMRV9DT1VOVCAtIDE7CiAgICAgICAgbGV0IGxhc3RTYW1wbGVWYWx1ZSA9IHNhbXBsZXNbU0FNUExFX0NPVU5UIC0gMV07CiAgICAgICAgd2hpbGUgKGN1cnJlbnRTYW1wbGVJbmRleCAhPSBsYXN0U2FtcGxlSW5kZXggJiYgY3VycmVudFNhbXBsZVZhbHVlIDw9IGFYKSB7CiAgICAgICAgICAgIGN1cnJlbnRTYW1wbGVJbmRleCsrOwogICAgICAgICAgICBjdXJyZW50U2FtcGxlVmFsdWUgPSBzYW1wbGVzW2N1cnJlbnRTYW1wbGVJbmRleF07CiAgICAgICAgICAgIGludGVydmFsU3RhcnQgKz0gU0FNUExFX1NURVAKICAgICAgICB9CiAgICAgICAgY3VycmVudFNhbXBsZUluZGV4LS07CiAgICAgICAgY3VycmVudFNhbXBsZVZhbHVlID0gc2FtcGxlc1tjdXJyZW50U2FtcGxlSW5kZXhdOwogICAgICAgIGNvbnN0IGRpc3QgPSAoYVggLSBjdXJyZW50U2FtcGxlVmFsdWUpIC8KICAgICAgICAgICAgKHNhbXBsZXNbY3VycmVudFNhbXBsZUluZGV4ICsgMV0gLSBjdXJyZW50U2FtcGxlVmFsdWUpOwogICAgICAgIGxldCBndWVzcyA9IGludGVydmFsU3RhcnQgKyBkaXN0ICogU0FNUExFX1NURVA7CiAgICAgICAgY29uc3QgdmEgPSBhKHAwLCBwMSwgcDIsIHAzKTsKICAgICAgICBjb25zdCB2YiA9IGIocDAsIHAxLCBwMiwgcDMpOwogICAgICAgIGNvbnN0IHZjID0gYyhwMCwgcDEsIHAyLCBwMyk7CiAgICAgICAgY29uc3QgaW5pdFNsb3BlID0gZ2V0X3Nsb3BlKGd1ZXNzLCB2YSwgdmIsIHZjKTsKICAgICAgICBpZiAoaW5pdFNsb3BlID09PSAwKSByZXR1cm4gZ3Vlc3M7CiAgICAgICAgZWxzZSBpZiAoaW5pdFNsb3BlID49IE5FV1RPTl9SQVBIU09OX01JTl9TTE9QRSkgewogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IE5FV1RPTl9SQVBIU09OX0lURVJBVElPTlM7ICsraSkgewogICAgICAgICAgICAgICAgY29uc3QgeCA9IGNhbGNfYmV6aWVyKGd1ZXNzLCB2YSwgdmIsIHZjKSAtIGFYOwogICAgICAgICAgICAgICAgY29uc3Qgc2xvcGUgPSBnZXRfc2xvcGUoZ3Vlc3MsIHZhLCB2YiwgdmMpOwogICAgICAgICAgICAgICAgZ3Vlc3MgLT0geCAvIHNsb3BlCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGd1ZXNzCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbGV0IGFBID0gaW50ZXJ2YWxTdGFydDsKICAgICAgICAgICAgbGV0IGFCID0gaW50ZXJ2YWxTdGFydCArIFNBTVBMRV9TVEVQOwogICAgICAgICAgICBsZXQgaSA9IDA7CiAgICAgICAgICAgIGxldCBwcmVjaXNzaW9uTGltaXQ7CiAgICAgICAgICAgIGxldCBtYXhJdGVyYXRpb25zOwogICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgICBndWVzcyA9IGFBICsgKGFCIC0gYUEpIC8gMjsKICAgICAgICAgICAgICAgIGxldCB4ID0gY2FsY19iZXppZXIoZ3Vlc3MsIHZhLCB2YiwgdmMpIC0gYVg7CiAgICAgICAgICAgICAgICBpZiAoeCA+IDApIGFCID0gZ3Vlc3M7CiAgICAgICAgICAgICAgICBlbHNlIGFBID0gZ3Vlc3M7CiAgICAgICAgICAgICAgICBwcmVjaXNzaW9uTGltaXQgPSBNYXRoLmFicyh4KSA+IFNVQkRJVklTSU9OX1BSRUNJU0lPTjsKICAgICAgICAgICAgICAgIG1heEl0ZXJhdGlvbnMgPSArK2kgPCBTVUJESVZJU0lPTl9NQVhfSVRFUkFUSU9OUwogICAgICAgICAgICB9IHdoaWxlIChwcmVjaXNzaW9uTGltaXQgJiYgbWF4SXRlcmF0aW9ucyk7CiAgICAgICAgICAgIHJldHVybiBndWVzcwogICAgICAgIH0KICAgIH07Cgp9CgovLyAuLi9saWIvbWlzYy9wcm9iYWJpbGl0eS5qcwp7CiAgICAndXNlIHN0cmljdCc7CiAgICBjb25zdCBDMyA9IHNlbGYuQzM7CgogICAgZnVuY3Rpb24gUmVxdWlyZVN0cmluZ09yTnVtYmVyKHZhbHVlKSB7CiAgICAgICAgaWYgKCFDMy5Jc1N0cmluZyh2YWx1ZSkpOwogICAgfQogICAgQzMuUHJvYmFiaWxpdHlUYWJsZSA9IGNsYXNzIFByb2JhYmlsaXR5VGFibGUgewogICAgICAgIGNvbnN0cnVjdG9yKG5hbWUpIHsKICAgICAgICAgICAgdGhpcy5faXRlbXMgPSBbXTsKICAgICAgICAgICAgdGhpcy5fbmFtZSA9IG5hbWUgfHwgIiI7CiAgICAgICAgICAgIHRoaXMuX3RvdGFsV2VpZ2h0ID0gMAogICAgICAgIH0KICAgICAgICBSZWxlYXNlKCkgewogICAgICAgICAgICB0aGlzLkNsZWFyKCk7CiAgICAgICAgICAgIHRoaXMuX2l0ZW1zID0gbnVsbAogICAgICAgIH0KICAgICAgICBHZXROYW1lKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fbmFtZQogICAgICAgIH0KICAgICAgICBDbGVhcigpIHsKICAgICAgICAgICAgQzMuY2xlYXIyREFycmF5KHRoaXMuX2l0ZW1zKTsKICAgICAgICAgICAgdGhpcy5fdG90YWxXZWlnaHQgPSAwCiAgICAgICAgfQogICAgICAgIEdldFRvdGFsV2VpZ2h0KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fdG90YWxXZWlnaHQKICAgICAgICB9CiAgICAgICAgU2FtcGxlKHQgPSBNYXRoLnJhbmRvbSgpICogdGhpcy5HZXRUb3RhbFdlaWdodCgpKSB7CiAgICAgICAgICAgIGxldCBzdW1XZWlnaHQgPSAwOwogICAgICAgICAgICBmb3IgKGNvbnN0IFt3ZWlnaHQsIHZhbHVlXSBvZiB0aGlzLl9pdGVtcykgewogICAgICAgICAgICAgICAgc3VtV2VpZ2h0ICs9IHdlaWdodDsKICAgICAgICAgICAgICAgIGlmICh0IDwgc3VtV2VpZ2h0KSByZXR1cm4gdmFsdWUKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gMAogICAgICAgIH0KICAgICAgICBBZGRJdGVtKHdlaWdodCwgdmFsdWUpIHsKICAgICAgICAgICAgUmVxdWlyZVN0cmluZ09yTnVtYmVyKHZhbHVlKTsKICAgICAgICAgICAgdGhpcy5fdG90YWxXZWlnaHQgKz0KICAgICAgICAgICAgICAgIHdlaWdodDsKICAgICAgICAgICAgdGhpcy5faXRlbXMucHVzaChbd2VpZ2h0LCB2YWx1ZV0pCiAgICAgICAgfQogICAgICAgIFJlbW92ZUl0ZW0od2VpZ2h0LCB2YWx1ZSkgewogICAgICAgICAgICBSZXF1aXJlU3RyaW5nT3JOdW1iZXIodmFsdWUpOwogICAgICAgICAgICBjb25zdCBpZ25vcmVXZWlnaHQgPSB3ZWlnaHQgPT09IDA7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5faXRlbXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSB0aGlzLl9pdGVtc1tpXTsKICAgICAgICAgICAgICAgIGNvbnN0IGRvZXNXZWlnaHRNYXRjaCA9IGlnbm9yZVdlaWdodCB8fCBpdGVtWzBdID09PSB3ZWlnaHQ7CiAgICAgICAgICAgICAgICBjb25zdCBkb2VzVmFsdWVNYXRjaCA9IGl0ZW1bMV0gPT09IHZhbHVlOwogICAgICAgICAgICAgICAgaWYgKGRvZXNXZWlnaHRNYXRjaCAmJiBkb2VzVmFsdWVNYXRjaCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX2l0ZW1zLnNwbGljZShpLCAxKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl90b3RhbFdlaWdodCAtPSBpdGVtWzBdOwogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgYXNKU09OKCkgewogICAgICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkodGhpcy5faXRlbXMpCiAgICAgICAgfQogICAgICAgIHN0YXRpYyBmcm9tSlNPTihzdHIpIHsKICAgICAgICAgICAgY29uc3QgdGFibGUgPSBuZXcgQzMuUHJvYmFiaWxpdHlUYWJsZTsKICAgICAgICAgICAgY29uc3QgaXRlbXMgPSBKU09OLnBhcnNlKHN0cik7CiAgICAgICAgICAgIGZvciAoY29uc3QgaXRlbSBvZiBpdGVtcykgewogICAgICAgICAgICAgICAgY29uc3Qgd2VpZ2h0ID0gaXRlbVswXTsKICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gaXRlbVsxXTsKICAgICAgICAgICAgICAgIHRhYmxlLkFkZEl0ZW0od2VpZ2h0LCB2YWx1ZSkKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdGFibGUKICAgICAgICB9CiAgICB9OwoKfQoKLy8gbGliL21pc2Mvc2NyZWVuUmVhZGVyVGV4dC5qcwp7CiAgICAndXNlIHN0cmljdCc7CiAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICBsZXQgbmV4dElkID0gMDsKICAgIEMzLlNjcmVlblJlYWRlclRleHQgPSBjbGFzcyBTY3JlZW5SZWFkZXJUZXh0IHsKICAgICAgICBjb25zdHJ1Y3RvcihydW50aW1lLCB0ZXh0KSB7CiAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUgPSBydW50aW1lOwogICAgICAgICAgICB0aGlzLl90ZXh0ID0gdGV4dDsKICAgICAgICAgICAgdGhpcy5faWQgPSBuZXh0SWQrKzsKICAgICAgICAgICAgdGhpcy5fcnVudGltZS5Qb3N0Q29tcG9uZW50TWVzc2FnZVRvRE9NKCJydW50aW1lIiwgInNjcmVlbi1yZWFkZXItdGV4dCIsIHsKICAgICAgICAgICAgICAgICJ0eXBlIjogImNyZWF0ZSIsCiAgICAgICAgICAgICAgICAiaWQiOiB0aGlzLl9pZCwKICAgICAgICAgICAgICAgICJ0ZXh0IjogdGhpcy5fdGV4dAogICAgICAgICAgICB9KQogICAgICAgIH0KICAgICAgICBSZWxlYXNlKCkgewogICAgICAgICAgICB0aGlzLl9ydW50aW1lLlBvc3RDb21wb25lbnRNZXNzYWdlVG9ET00oInJ1bnRpbWUiLCAic2NyZWVuLXJlYWRlci10ZXh0IiwgewogICAgICAgICAgICAgICAgInR5cGUiOiAicmVsZWFzZSIsCiAgICAgICAgICAgICAgICAiaWQiOiB0aGlzLl9pZAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdGhpcy5fcnVudGltZSA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3RleHQgPSAiIjsKICAgICAgICAgICAgdGhpcy5faWQgPSAtMQogICAgICAgIH0KICAgICAgICBTZXRUZXh0KHRleHQpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX3RleHQgPT09IHRleHQpIHJldHVybjsKICAgICAgICAgICAgdGhpcy5fdGV4dCA9IHRleHQ7CiAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuUG9zdENvbXBvbmVudE1lc3NhZ2VUb0RPTSgicnVudGltZSIsCiAgICAgICAgICAgICAgICAic2NyZWVuLXJlYWRlci10ZXh0IiwgewogICAgICAgICAgICAgICAgICAgICJ0eXBlIjogInVwZGF0ZSIsCiAgICAgICAgICAgICAgICAgICAgImlkIjogdGhpcy5faWQsCiAgICAgICAgICAgICAgICAgICAgInRleHQiOiB0aGlzLl90ZXh0CiAgICAgICAgICAgICAgICB9KQogICAgICAgIH0KICAgIH07Cgp9CgovLyAuLi9saWIvZXZlbnRzL2V2ZW50LmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIEMzLkV2ZW50ID0gY2xhc3MgRXZlbnQgewogICAgICAgIGNvbnN0cnVjdG9yKHR5cGUsIGNhbmNlbGFibGUpIHsKICAgICAgICAgICAgdGhpcy50eXBlID0gdHlwZTsKICAgICAgICAgICAgdGhpcy5jYW5jZWxhYmxlID0gISFjYW5jZWxhYmxlOwogICAgICAgICAgICB0aGlzLmRlZmF1bHRQcmV2ZW50ZWQgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5wcm9wYWdhdGlvblN0b3BwZWQgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5pc0FzeW5jID0gZmFsc2UKICAgICAgICB9CiAgICAgICAgcHJldmVudERlZmF1bHQoKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5jYW5jZWxhYmxlKSB0aHJvdyBuZXcgRXJyb3IoYGV2ZW50ICcke3RoaXMudHlwZX0nIGlzIG5vdCBjYW5jZWxhYmxlYCk7CiAgICAgICAgICAgIHRoaXMuZGVmYXVsdFByZXZlbnRlZCA9IHRydWUKICAgICAgICB9CiAgICAgICAgc3RvcFByb3BhZ2F0aW9uKCkgewogICAgICAgICAgICBpZiAoIXRoaXMuY2FuY2VsYWJsZSkgdGhyb3cgbmV3IEVycm9yKGBldmVudCAnJHt0aGlzLnR5cGV9JyBjYW5ub3QgYmUgc3RvcHBlZGApOwogICAgICAgICAgICBpZiAodGhpcy5pc0FzeW5jKSB0aHJvdyBuZXcgRXJyb3IoYGNhbm5vdCBzdG9wIGFzeW5jIGV2ZW50ICcke3RoaXMudHlwZX0nIHByb3BhZ2F0aW9uYCk7CiAgICAgICAgICAgIHRoaXMucHJvcGFnYXRpb25TdG9wcGVkID0gdHJ1ZQogICAgICAgIH0KICAgIH07Cgp9CgovLyAuLi9saWIvZXZlbnRzL2hhbmRsZXIuanMKewogICAgJ3VzZSBzdHJpY3QnOwogICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgY29uc3QgYXNzZXJ0ID0gc2VsZi5hc3NlcnQ7CiAgICBDMy5FdmVudC5IYW5kbGVyID0gY2xhc3MgRXZlbnRIYW5kbGVyIGV4dGVuZHMgQzMuRGVmZW5kZWRCYXNlIHsKICAgICAgICBjb25zdHJ1Y3Rvcih0eXBlKSB7CiAgICAgICAgICAgIHN1cGVyKCk7CiAgICAgICAgICAgIHRoaXMuX3R5cGUgPSB0eXBlOwogICAgICAgICAgICB0aGlzLl9jYXB0dXJlTGlzdGVuZXJzID0gW107CiAgICAgICAgICAgIHRoaXMuX2NhcHR1cmVMaXN0ZW5lcnNTZXQgPSBuZXcgU2V0OwogICAgICAgICAgICB0aGlzLl9saXN0ZW5lcnMgPSBbXTsKICAgICAgICAgICAgdGhpcy5fbGlzdGVuZXJzU2V0ID0gbmV3IFNldDsKICAgICAgICAgICAgdGhpcy5fZmlyZURlcHRoID0gMDsKICAgICAgICAgICAgdGhpcy5fcXVldWVNb2RpZnlMaXN0ZW5lcnMgPSBbXQogICAgICAgIH0KICAgICAgICBSZWxlYXNlKCkgewogICAgICAgICAgICBpZiAodGhpcy5fZmlyZURlcHRoID4gMCkgcmV0dXJuOwogICAgICAgICAgICBDMy5jbGVhckFycmF5KHRoaXMuX2NhcHR1cmVMaXN0ZW5lcnMpOwogICAgICAgICAgICB0aGlzLl9jYXB0dXJlTGlzdGVuZXJzU2V0LmNsZWFyKCk7CiAgICAgICAgICAgIEMzLmNsZWFyQXJyYXkodGhpcy5fbGlzdGVuZXJzKTsKICAgICAgICAgICAgdGhpcy5fbGlzdGVuZXJzU2V0LmNsZWFyKCk7CiAgICAgICAgICAgIEMzLmNsZWFyQXJyYXkodGhpcy5fcXVldWVNb2RpZnlMaXN0ZW5lcnMpOwogICAgICAgICAgICBDMy5SZWxlYXNlKHRoaXMpCiAgICAgICAgfQogICAgICAgIF9BZGRMaXN0ZW5lcihmdW5jLAogICAgICAgICAgICBjYXB0dXJlKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9Jc0ZpcmluZygpKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9xdWV1ZU1vZGlmeUxpc3RlbmVycy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICBvcDogImFkZCIsCiAgICAgICAgICAgICAgICAgICAgZnVuYywKICAgICAgICAgICAgICAgICAgICBjYXB0dXJlCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChjYXB0dXJlKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fY2FwdHVyZUxpc3RlbmVyc1NldC5oYXMoZnVuYykpIHJldHVybjsKICAgICAgICAgICAgICAgIHRoaXMuX2NhcHR1cmVMaXN0ZW5lcnMucHVzaChmdW5jKTsKICAgICAgICAgICAgICAgIHRoaXMuX2NhcHR1cmVMaXN0ZW5lcnNTZXQuYWRkKGZ1bmMpCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fbGlzdGVuZXJzU2V0LmhhcyhmdW5jKSkgcmV0dXJuOwogICAgICAgICAgICAgICAgdGhpcy5fbGlzdGVuZXJzLnB1c2goZnVuYyk7CiAgICAgICAgICAgICAgICB0aGlzLl9saXN0ZW5lcnNTZXQuYWRkKGZ1bmMpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgX1JlbW92ZUxpc3RlbmVyKGZ1bmMsIGNhcHR1cmUpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX0lzRmlyaW5nKCkpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3F1ZXVlTW9kaWZ5TGlzdGVuZXJzLnB1c2goewogICAgICAgICAgICAgICAgICAgIG9wOiAicmVtb3ZlIiwKICAgICAgICAgICAgICAgICAgICBmdW5jLAogICAgICAgICAgICAgICAgICAgIGNhcHR1cmUKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGNhcHR1cmUpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9jYXB0dXJlTGlzdGVuZXJzU2V0LmhhcyhmdW5jKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX2NhcHR1cmVMaXN0ZW5lcnNTZXQuZGVsZXRlKGZ1bmMpOwogICAgICAgICAgICAgICAgICAgIEMzLmFycmF5RmluZFJlbW92ZSh0aGlzLl9jYXB0dXJlTGlzdGVuZXJzLCBmdW5jKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuX2xpc3RlbmVyc1NldC5oYXMoZnVuYykpIHsKICAgICAgICAgICAgICAgIHRoaXMuX2xpc3RlbmVyc1NldC5kZWxldGUoZnVuYyk7CiAgICAgICAgICAgICAgICBDMy5hcnJheUZpbmRSZW1vdmUodGhpcy5fbGlzdGVuZXJzLCBmdW5jKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIF9Jc0VtcHR5KCkgewogICAgICAgICAgICByZXR1cm4gIXRoaXMuX2NhcHR1cmVMaXN0ZW5lcnMubGVuZ3RoICYmICF0aGlzLl9saXN0ZW5lcnMubGVuZ3RoCiAgICAgICAgfQogICAgICAgIF9Jc0ZpcmluZygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2ZpcmVEZXB0aCA+IDAKICAgICAgICB9CiAgICAgICAgX1Byb2Nlc3NRdWV1ZWRMaXN0ZW5lcnMoKSB7CiAgICAgICAgICAgIGNvbnN0IHJlbW92ZUxpc3RlbmVyc1NldCA9IG5ldyBTZXQ7CiAgICAgICAgICAgIGNvbnN0IHJlbW92ZUNhcHR1cmVMaXN0ZW5lcnNTZXQgPSBuZXcgU2V0OwogICAgICAgICAgICBmb3IgKGNvbnN0IHEgb2YgdGhpcy5fcXVldWVNb2RpZnlMaXN0ZW5lcnMpCiAgICAgICAgICAgICAgICBpZiAocS5vcCA9PT0gImFkZCIpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9BZGRMaXN0ZW5lcihxLmZ1bmMsIHEuY2FwdHVyZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHEuY2FwdHVyZSkgcmVtb3ZlQ2FwdHVyZUxpc3RlbmVyc1NldC5kZWxldGUocS5mdW5jKTsKICAgICAgICAgICAgICAgICAgICBlbHNlIHJlbW92ZUxpc3RlbmVyc1NldC5kZWxldGUocS5mdW5jKQogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChxLm9wID09PSAicmVtb3ZlIikKICAgICAgICAgICAgICAgIGlmIChxLmNhcHR1cmUpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9jYXB0dXJlTGlzdGVuZXJzU2V0LmRlbGV0ZShxLmZ1bmMpOwogICAgICAgICAgICAgICAgICAgIHJlbW92ZUNhcHR1cmVMaXN0ZW5lcnNTZXQuYWRkKHEuZnVuYykKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbGlzdGVuZXJzU2V0LmRlbGV0ZShxLmZ1bmMpOwogICAgICAgICAgICAgICAgICAgIHJlbW92ZUxpc3RlbmVyc1NldC5hZGQocS5mdW5jKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHRocm93IG5ldyBFcnJvcigiaW52YWxpZCBvcCIpOwogICAgICAgICAgICBDMy5hcnJheVJlbW92ZUFsbEluU2V0KHRoaXMuX2xpc3RlbmVycywgcmVtb3ZlTGlzdGVuZXJzU2V0KTsKICAgICAgICAgICAgQzMuYXJyYXlSZW1vdmVBbGxJblNldCh0aGlzLl9jYXB0dXJlTGlzdGVuZXJzLCByZW1vdmVDYXB0dXJlTGlzdGVuZXJzU2V0KTsKICAgICAgICAgICAgQzMuY2xlYXJBcnJheSh0aGlzLl9xdWV1ZU1vZGlmeUxpc3RlbmVycykKICAgICAgICB9CiAgICAgICAgX0ZpcmVDYW5jZWxsYWJsZShldmVudCkgewogICAgICAgICAgICB0aGlzLl9JbmNyZWFzZUZpcmVEZXB0aCgpOwogICAgICAgICAgICBsZXQgaXNTdG9wcGVkID0gZmFsc2U7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSB0aGlzLl9jYXB0dXJlTGlzdGVuZXJzLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9jYXB0dXJlTGlzdGVuZXJzW2ldKGV2ZW50KTsKICAgICAgICAgICAgICAgIGlmIChldmVudC5wcm9wYWdhdGlvblN0b3BwZWQpIHsKICAgICAgICAgICAgICAgICAgICBpc1N0b3BwZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCFpc1N0b3BwZWQpCiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gdGhpcy5fbGlzdGVuZXJzLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbGlzdGVuZXJzW2ldKGV2ZW50KTsKICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQucHJvcGFnYXRpb25TdG9wcGVkKSBicmVhawogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLl9EZWNyZWFzZUZpcmVEZXB0aCgpOwogICAgICAgICAgICByZXR1cm4gIWV2ZW50LmRlZmF1bHRQcmV2ZW50ZWQKICAgICAgICB9CiAgICAgICAgX0ZpcmVOb25DYW5jZWxsYWJsZShldmVudCkgewogICAgICAgICAgICB0aGlzLl9JbmNyZWFzZUZpcmVEZXB0aCgpOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gdGhpcy5fY2FwdHVyZUxpc3RlbmVycy5sZW5ndGg7IGkgPCBsZW47ICsraSkgdGhpcy5fY2FwdHVyZUxpc3RlbmVyc1tpXShldmVudCk7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSB0aGlzLl9saXN0ZW5lcnMubGVuZ3RoOyBpIDwKICAgICAgICAgICAgICAgIGxlbjsgKytpKSB0aGlzLl9saXN0ZW5lcnNbaV0oZXZlbnQpOwogICAgICAgICAgICB0aGlzLl9EZWNyZWFzZUZpcmVEZXB0aCgpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgIH0KICAgICAgICBfSW5jcmVhc2VGaXJlRGVwdGgoKSB7CiAgICAgICAgICAgIHRoaXMuX2ZpcmVEZXB0aCsrCiAgICAgICAgfQogICAgICAgIF9EZWNyZWFzZUZpcmVEZXB0aCgpIHsKICAgICAgICAgICAgdGhpcy5fZmlyZURlcHRoLS07CiAgICAgICAgICAgIGlmICh0aGlzLl9maXJlRGVwdGggPT09IDAgJiYgdGhpcy5fcXVldWVNb2RpZnlMaXN0ZW5lcnMubGVuZ3RoID4gMCkgdGhpcy5fUHJvY2Vzc1F1ZXVlZExpc3RlbmVycygpCiAgICAgICAgfQogICAgICAgIFNldERlbGF5UmVtb3ZlRXZlbnRzRW5hYmxlZChlKSB7CiAgICAgICAgICAgIGlmIChlKSB0aGlzLl9JbmNyZWFzZUZpcmVEZXB0aCgpOwogICAgICAgICAgICBlbHNlIHRoaXMuX0RlY3JlYXNlRmlyZURlcHRoKCkKICAgICAgICB9CiAgICAgICAgX0ZpcmVBc3luYyhldmVudCkgewogICAgICAgICAgICBsZXQgY2FsbGJhY2tQcm9taXNlcyA9IFtdOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gdGhpcy5fY2FwdHVyZUxpc3RlbmVycy5sZW5ndGg7IGkgPCBsZW47ICsraSkgewogICAgICAgICAgICAgICAgbGV0IGZ1bmMgPSB0aGlzLl9jYXB0dXJlTGlzdGVuZXJzW2ldOwogICAgICAgICAgICAgICAgY2FsbGJhY2tQcm9taXNlcy5wdXNoKEMzLkFzeW5jaWZ5KCgpID0+CiAgICAgICAgICAgICAgICAgICAgZnVuYyhldmVudCkpKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSB0aGlzLl9saXN0ZW5lcnMubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHsKICAgICAgICAgICAgICAgIGxldCBmdW5jID0gdGhpcy5fbGlzdGVuZXJzW2ldOwogICAgICAgICAgICAgICAgY2FsbGJhY2tQcm9taXNlcy5wdXNoKEMzLkFzeW5jaWZ5KCgpID0+IGZ1bmMoZXZlbnQpKSkKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGwoY2FsbGJhY2tQcm9taXNlcykudGhlbigoKSA9PiAhZXZlbnQuZGVmYXVsdFByZXZlbnRlZCkKICAgICAgICB9CiAgICAgICAgX0ZpcmVBbmRXYWl0X0FzeW5jT3B0aW9uYWwoZXZlbnQpIHsKICAgICAgICAgICAgY29uc3QgcmVzdWx0cyA9IFtdOwogICAgICAgICAgICB0aGlzLl9JbmNyZWFzZUZpcmVEZXB0aCgpOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gdGhpcy5fY2FwdHVyZUxpc3RlbmVycy5sZW5ndGg7IGkgPCBsZW47ICsraSkgewogICAgICAgICAgICAgICAgY29uc3QgcmV0ID0gdGhpcy5fY2FwdHVyZUxpc3RlbmVyc1tpXShldmVudCk7CiAgICAgICAgICAgICAgICBpZiAocmV0IGluc3RhbmNlb2YgUHJvbWlzZSkgcmVzdWx0cy5wdXNoKHJldCkKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gdGhpcy5fbGlzdGVuZXJzLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7CiAgICAgICAgICAgICAgICBjb25zdCByZXQgPSB0aGlzLl9saXN0ZW5lcnNbaV0oZXZlbnQpOwogICAgICAgICAgICAgICAgaWYgKHJldCBpbnN0YW5jZW9mIFByb21pc2UpIHJlc3VsdHMucHVzaChyZXQpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5fRGVjcmVhc2VGaXJlRGVwdGgoKTsKICAgICAgICAgICAgaWYgKHJlc3VsdHMubGVuZ3RoKSByZXR1cm4gUHJvbWlzZS5hbGwocmVzdWx0cykudGhlbigoKSA9PiAhZXZlbnQuZGVmYXVsdFByZXZlbnRlZCk7CiAgICAgICAgICAgIGVsc2UgcmV0dXJuICFldmVudC5kZWZhdWx0UHJldmVudGVkCiAgICAgICAgfQogICAgICAgIGFzeW5jIF9GaXJlQW5kV2FpdEFzeW5jKGV2ZW50KSB7CiAgICAgICAgICAgIHJldHVybiBhd2FpdCB0aGlzLl9GaXJlQW5kV2FpdF9Bc3luY09wdGlvbmFsKGV2ZW50KQogICAgICAgIH0KICAgICAgICBhc3luYyBfRmlyZUFuZFdhaXRBc3luY1NlcXVlbnRpYWwoZXZlbnQpIHsKICAgICAgICAgICAgdGhpcy5fSW5jcmVhc2VGaXJlRGVwdGgoKTsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IHRoaXMuX2NhcHR1cmVMaXN0ZW5lcnMubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHJldCA9IHRoaXMuX2NhcHR1cmVMaXN0ZW5lcnNbaV0oZXZlbnQpOwogICAgICAgICAgICAgICAgaWYgKHJldCBpbnN0YW5jZW9mIFByb21pc2UpIGF3YWl0IHJldAogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSB0aGlzLl9saXN0ZW5lcnMubGVuZ3RoOyBpIDwKICAgICAgICAgICAgICAgIGxlbjsgKytpKSB7CiAgICAgICAgICAgICAgICBjb25zdCByZXQgPSB0aGlzLl9saXN0ZW5lcnNbaV0oZXZlbnQpOwogICAgICAgICAgICAgICAgaWYgKHJldCBpbnN0YW5jZW9mIFByb21pc2UpIGF3YWl0IHJldAogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuX0RlY3JlYXNlRmlyZURlcHRoKCk7CiAgICAgICAgICAgIHJldHVybiAhZXZlbnQuZGVmYXVsdFByZXZlbnRlZAogICAgICAgIH0qIF9GaXJlQXNHZW5lcmF0b3IoZXZlbnQpIHsKICAgICAgICAgICAgdGhpcy5fSW5jcmVhc2VGaXJlRGVwdGgoKTsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IHRoaXMuX2NhcHR1cmVMaXN0ZW5lcnMubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHJldCA9IHRoaXMuX2NhcHR1cmVMaXN0ZW5lcnNbaV0oZXZlbnQpOwogICAgICAgICAgICAgICAgaWYgKEMzLklzSXRlcmF0b3IocmV0KSkgeWllbGQqIHJldAogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSB0aGlzLl9saXN0ZW5lcnMubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHJldCA9IHRoaXMuX2xpc3RlbmVyc1tpXShldmVudCk7CiAgICAgICAgICAgICAgICBpZiAoQzMuSXNJdGVyYXRvcihyZXQpKSB5aWVsZCogcmV0CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5fRGVjcmVhc2VGaXJlRGVwdGgoKQogICAgICAgIH0KICAgIH07Cgp9CgovLyAuLi9saWIvZXZlbnRzL2Rpc3BhdGNoZXIuanMKewogICAgJ3VzZSBzdHJpY3QnOwogICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgQzMuRXZlbnQuRGlzcGF0Y2hlciA9IGNsYXNzIEV2ZW50RGlzcGF0Y2hlciBleHRlbmRzIEMzLkRlZmVuZGVkQmFzZSB7CiAgICAgICAgY29uc3RydWN0b3IoKSB7CiAgICAgICAgICAgIHN1cGVyKCk7CiAgICAgICAgICAgIHRoaXMuX2V2ZW50SGFuZGxlcnMgPSBuZXcgTWFwOwogICAgICAgICAgICB0aGlzLl9kaXNwYXRjaGVyV2FzUmVsZWFzZWQgPSBmYWxzZQogICAgICAgIH0KICAgICAgICBSZWxlYXNlKCkgewogICAgICAgICAgICBpZiAodGhpcy5fZGlzcGF0Y2hlcldhc1JlbGVhc2VkKSB0aHJvdyBuZXcgRXJyb3IoImFscmVhZHkgcmVsZWFzZWQiKTsKICAgICAgICAgICAgdGhpcy5DbGVhckV2ZW50cygpOwogICAgICAgICAgICB0aGlzLl9kaXNwYXRjaGVyV2FzUmVsZWFzZWQgPSB0cnVlOwogICAgICAgICAgICBDMy5SZWxlYXNlKHRoaXMpCiAgICAgICAgfQogICAgICAgIFdhc1JlbGVhc2VkKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZGlzcGF0Y2hlcldhc1JlbGVhc2VkCiAgICAgICAgfQogICAgICAgIENsZWFyRXZlbnRzKCkgewogICAgICAgICAgICBmb3IgKGxldCBoYW5kbGVyIG9mIHRoaXMuX2V2ZW50SGFuZGxlcnMudmFsdWVzKCkpIGhhbmRsZXIuUmVsZWFzZSgpOwogICAgICAgICAgICB0aGlzLl9ldmVudEhhbmRsZXJzLmNsZWFyKCkKICAgICAgICB9CiAgICAgICAgX0dldEhhbmRsZXJCeVR5cGUodHlwZSwgY3JlYXRlX2lmX21pc3NpbmcpIHsKICAgICAgICAgICAgbGV0IGhhbmRsZXIgPQogICAgICAgICAgICAgICAgdGhpcy5fZXZlbnRIYW5kbGVycy5nZXQodHlwZSk7CiAgICAgICAgICAgIGlmIChoYW5kbGVyKSByZXR1cm4gaGFuZGxlcjsKICAgICAgICAgICAgaWYgKGNyZWF0ZV9pZl9taXNzaW5nKSB7CiAgICAgICAgICAgICAgICBoYW5kbGVyID0gQzMuTmV3KEMzLkV2ZW50LkhhbmRsZXIsIHR5cGUpOwogICAgICAgICAgICAgICAgdGhpcy5fZXZlbnRIYW5kbGVycy5zZXQodHlwZSwgaGFuZGxlcik7CiAgICAgICAgICAgICAgICByZXR1cm4gaGFuZGxlcgogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBudWxsCiAgICAgICAgfQogICAgICAgIEhhc0FueUhhbmRsZXJGb3IodHlwZSkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZXZlbnRIYW5kbGVycy5oYXModHlwZSkKICAgICAgICB9CiAgICAgICAgYWRkRXZlbnRMaXN0ZW5lcih0eXBlLCBmdW5jLCBjYXB0dXJlKSB7CiAgICAgICAgICAgIGxldCBoYW5kbGVyID0gdGhpcy5fR2V0SGFuZGxlckJ5VHlwZSh0eXBlLCB0cnVlKTsKICAgICAgICAgICAgaGFuZGxlci5fQWRkTGlzdGVuZXIoZnVuYywgISFjYXB0dXJlKQogICAgICAgIH0KICAgICAgICByZW1vdmVFdmVudExpc3RlbmVyKHR5cGUsIGZ1bmMsIGNhcHR1cmUpIHsKICAgICAgICAgICAgbGV0IGhhbmRsZXIgPSB0aGlzLl9HZXRIYW5kbGVyQnlUeXBlKHR5cGUsIGZhbHNlKTsKICAgICAgICAgICAgaWYgKCFoYW5kbGVyKSByZXR1cm47CiAgICAgICAgICAgIGhhbmRsZXIuX1JlbW92ZUxpc3RlbmVyKGZ1bmMsICEhY2FwdHVyZSk7CiAgICAgICAgICAgIGlmIChoYW5kbGVyLl9Jc0VtcHR5KCkpIHRoaXMuX2V2ZW50SGFuZGxlcnMuZGVsZXRlKHR5cGUpCiAgICAgICAgfQogICAgICAgIGRpc3BhdGNoRXZlbnQoZXZlbnQpIHsKICAgICAgICAgICAgY29uc3QgaGFuZGxlciA9IHRoaXMuX0dldEhhbmRsZXJCeVR5cGUoZXZlbnQudHlwZSwgZmFsc2UpOwogICAgICAgICAgICBpZiAoIWhhbmRsZXIpIHJldHVybiB0cnVlOwogICAgICAgICAgICBpZiAoZXZlbnQuY2FuY2VsYWJsZSkgcmV0dXJuIGhhbmRsZXIuX0ZpcmVDYW5jZWxsYWJsZShldmVudCk7CiAgICAgICAgICAgIGVsc2UgcmV0dXJuIGhhbmRsZXIuX0ZpcmVOb25DYW5jZWxsYWJsZShldmVudCkKICAgICAgICB9CiAgICAgICAgZGlzcGF0Y2hFdmVudEFzeW5jKGV2ZW50KSB7CiAgICAgICAgICAgIGNvbnN0IGhhbmRsZXIgPSB0aGlzLl9HZXRIYW5kbGVyQnlUeXBlKGV2ZW50LnR5cGUsIGZhbHNlKTsKICAgICAgICAgICAgaWYgKCFoYW5kbGVyKSByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHRydWUpOwogICAgICAgICAgICBldmVudC5pc0FzeW5jID0gdHJ1ZTsKICAgICAgICAgICAgcmV0dXJuIGhhbmRsZXIuX0ZpcmVBc3luYyhldmVudCkKICAgICAgICB9CiAgICAgICAgYXN5bmMgZGlzcGF0Y2hFdmVudEFuZENsZWFyQXN5bmMoZXZlbnQpIHsKICAgICAgICAgICAgY29uc3QgaGFuZGxlciA9IHRoaXMuX0dldEhhbmRsZXJCeVR5cGUoZXZlbnQudHlwZSwKICAgICAgICAgICAgICAgIGZhbHNlKTsKICAgICAgICAgICAgaWYgKCFoYW5kbGVyKSByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgdGhpcy5fZXZlbnRIYW5kbGVycy5kZWxldGUoZXZlbnQudHlwZSk7CiAgICAgICAgICAgIGV2ZW50LmlzQXN5bmMgPSB0cnVlOwogICAgICAgICAgICBjb25zdCByZXQgPSBhd2FpdCBoYW5kbGVyLl9GaXJlQXN5bmMoZXZlbnQpOwogICAgICAgICAgICBoYW5kbGVyLlJlbGVhc2UoKTsKICAgICAgICAgICAgcmV0dXJuIHJldAogICAgICAgIH0KICAgICAgICBhc3luYyBkaXNwYXRjaEV2ZW50QW5kV2FpdEFzeW5jKGV2ZW50KSB7CiAgICAgICAgICAgIGNvbnN0IGhhbmRsZXIgPSB0aGlzLl9HZXRIYW5kbGVyQnlUeXBlKGV2ZW50LnR5cGUsIGZhbHNlKTsKICAgICAgICAgICAgaWYgKCFoYW5kbGVyKSByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgcmV0dXJuIGF3YWl0IGhhbmRsZXIuX0ZpcmVBbmRXYWl0QXN5bmMoZXZlbnQpCiAgICAgICAgfQogICAgICAgIGRpc3BhdGNoRXZlbnRBbmRXYWl0X0FzeW5jT3B0aW9uYWwoZXZlbnQpIHsKICAgICAgICAgICAgY29uc3QgaGFuZGxlciA9IHRoaXMuX0dldEhhbmRsZXJCeVR5cGUoZXZlbnQudHlwZSwgZmFsc2UpOwogICAgICAgICAgICBpZiAoIWhhbmRsZXIpIHJldHVybiB0cnVlOwogICAgICAgICAgICByZXR1cm4gaGFuZGxlci5fRmlyZUFuZFdhaXRfQXN5bmNPcHRpb25hbChldmVudCkKICAgICAgICB9CiAgICAgICAgYXN5bmMgZGlzcGF0Y2hFdmVudEFuZFdhaXRBc3luY1NlcXVlbnRpYWwoZXZlbnQpIHsKICAgICAgICAgICAgY29uc3QgaGFuZGxlciA9CiAgICAgICAgICAgICAgICB0aGlzLl9HZXRIYW5kbGVyQnlUeXBlKGV2ZW50LnR5cGUsIGZhbHNlKTsKICAgICAgICAgICAgaWYgKCFoYW5kbGVyKSByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgcmV0dXJuIGF3YWl0IGhhbmRsZXIuX0ZpcmVBbmRXYWl0QXN5bmNTZXF1ZW50aWFsKGV2ZW50KQogICAgICAgIH0KICAgICAgICBkaXNwYXRjaEdlbmVyYXRvckV2ZW50KGV2ZW50KSB7CiAgICAgICAgICAgIGNvbnN0IGhhbmRsZXIgPSB0aGlzLl9HZXRIYW5kbGVyQnlUeXBlKGV2ZW50LnR5cGUsIGZhbHNlKTsKICAgICAgICAgICAgaWYgKCFoYW5kbGVyKSByZXR1cm4gbnVsbDsKICAgICAgICAgICAgaWYgKGV2ZW50LmNhbmNlbGFibGUpIHRocm93IG5ldyBFcnJvcigibm90IHN1cHBvcnRlZCIpOwogICAgICAgICAgICBlbHNlIHJldHVybiBoYW5kbGVyLl9GaXJlQXNHZW5lcmF0b3IoZXZlbnQpCiAgICAgICAgfQogICAgICAgIFNldERlbGF5UmVtb3ZlRXZlbnRzRW5hYmxlZChlKSB7CiAgICAgICAgICAgIGZvciAoY29uc3QgaGFuZGxlciBvZiB0aGlzLl9ldmVudEhhbmRsZXJzLnZhbHVlcygpKSBoYW5kbGVyLlNldERlbGF5UmVtb3ZlRXZlbnRzRW5hYmxlZChlKQogICAgICAgIH0KICAgIH07Cgp9CgovLyAuLi9saWIvdXRpbC9hc3luY2lmeS5qcwp7CiAgICAndXNlIHN0cmljdCc7CiAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICBjb25zdCBTRVRUSU1FT1VUX1dPUktfRFVSQVRJT04gPSAxMjsKICAgIGNvbnN0IFNFVFRJTUVPVVRfSU5URVJWQUwgPSAxNjsKICAgIGNvbnN0IElETEVDQUxMQkFDS19USU1FT1VUID0gMzU7CiAgICBjb25zdCBTVVBQT1JUU19SSUMgPSB0eXBlb2YgcmVxdWVzdElkbGVDYWxsYmFjayAhPT0gInVuZGVmaW5lZCI7CiAgICBsZXQgd29ya1F1ZXVlID0gW107CiAgICBsZXQgY2FsbGJhY2tJZCA9IC0xOwogICAgbGV0IGhpZ2hUaHJvdWdocHV0TW9kZSA9IDA7CgogICAgZnVuY3Rpb24gU2V0TmV3Q2FsbGJhY2sodGltZXJUaW1lb3V0KSB7CiAgICAgICAgaWYgKFNVUFBPUlRTX1JJQyAmJiBoaWdoVGhyb3VnaHB1dE1vZGUgPT09IDApIGNhbGxiYWNrSWQgPSByZXF1ZXN0SWRsZUNhbGxiYWNrKERvQXN5bmNpZmllZFdvcmssIHsKICAgICAgICAgICAgdGltZW91dDogSURMRUNBTExCQUNLX1RJTUVPVVQKICAgICAgICB9KTsKICAgICAgICBlbHNlIGNhbGxiYWNrSWQgPSBzZXRUaW1lb3V0KERvQXN5bmNpZmllZFdvcmssIGhpZ2hUaHJvdWdocHV0TW9kZSA+IDAgPyAxIDogdGltZXJUaW1lb3V0KQogICAgfQoKICAgIGZ1bmN0aW9uIERvQXN5bmNpZmllZFdvcmsoZGVhZGxpbmUpIHsKICAgICAgICBjYWxsYmFja0lkID0gLTE7CiAgICAgICAgaWYgKCF3b3JrUXVldWUubGVuZ3RoKSByZXR1cm47CiAgICAgICAgbGV0IHN0YXJ0VGltZSA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICAgIGxldCBjdXJUaW1lID0gc3RhcnRUaW1lOwogICAgICAgIGxldCBqb2JDb3VudCA9IDA7CiAgICAgICAgbGV0IGVzdGltYXRlZE5leHRKb2JEdXJhdGlvbiA9IDA7CiAgICAgICAgZG8gewogICAgICAgICAgICBEb05leHRBc3luY2lmaWVkSm9iKHdvcmtRdWV1ZS5zaGlmdCgpKTsKICAgICAgICAgICAgY3VyVGltZSA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICAgICAgICArK2pvYkNvdW50OwogICAgICAgICAgICBlc3RpbWF0ZWROZXh0Sm9iRHVyYXRpb24gPSAoY3VyVGltZSAtIHN0YXJ0VGltZSkgLyBqb2JDb3VudCAqIDEuMQogICAgICAgIH0gd2hpbGUgKHdvcmtRdWV1ZS5sZW5ndGggJiYgKFNVUFBPUlRTX1JJQyAmJiBoaWdoVGhyb3VnaHB1dE1vZGUgPT09IDAgJiYgdHlwZW9mIGRlYWRsaW5lICE9PSAidW5kZWZpbmVkIiA/IGVzdGltYXRlZE5leHRKb2JEdXJhdGlvbiA8IGRlYWRsaW5lWyJ0aW1lUmVtYWluaW5nIl0oKSA6IGN1clRpbWUgLSBzdGFydFRpbWUgKyBlc3RpbWF0ZWROZXh0Sm9iRHVyYXRpb24gPAogICAgICAgICAgICAgICAgU0VUVElNRU9VVF9XT1JLX0RVUkFUSU9OKSk7CiAgICAgICAgaWYgKGNhbGxiYWNrSWQgPT09IC0xICYmIHdvcmtRdWV1ZS5sZW5ndGgpIHsKICAgICAgICAgICAgbGV0IHdvcmtEdXJhdGlvbiA9IGN1clRpbWUgLSBzdGFydFRpbWU7CiAgICAgICAgICAgIGxldCB0aW1lb3V0ID0gTWF0aC5tYXgoU0VUVElNRU9VVF9JTlRFUlZBTCAtIHdvcmtEdXJhdGlvbiwgNCk7CiAgICAgICAgICAgIFNldE5ld0NhbGxiYWNrKHRpbWVvdXQpCiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIERvTmV4dEFzeW5jaWZpZWRKb2IodykgewogICAgICAgIGxldCByZXQ7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0ID0gdy5mdW5jKCkKICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIHcucmVqZWN0KGUpOwogICAgICAgICAgICByZXR1cm4KICAgICAgICB9CiAgICAgICAgdy5yZXNvbHZlKHJldCkKICAgIH0KICAgIGxldCBhc3luY2lmeURpc2FibGVkID0gQzMuUXVlcnlTdHJpbmcuSGFzKCJkaXNhYmxlLWFzeW5jaWZ5Iik7CiAgICBpZiAoYXN5bmNpZnlEaXNhYmxlZCkgY29uc29sZS53YXJuKCJbQXN5bmNpZnldIEFzeW5jaWZ5IGhhcyBiZWVuIGRpc2FibGVkIGR1ZSB0byBkaXNhYmxlLWFzeW5jaWZ5IGluIHRoZSBxdWVyeSBzdHJpbmcuIFNvbWUgd29yayB3aWxsIG5vdyBiZSBkb25lIHN5bmNocm9ub3VzbHkuIik7CiAgICBDMy5Bc3luY2lmeSA9IGZ1bmN0aW9uIEFzeW5jaWZ5KGZ1bmMpIHsKICAgICAgICBsZXQgc3RhY2sgPSBudWxsOwogICAgICAgIGlmIChDMy5pc0RlYnVnKSBzdGFjayA9IEMzLkdldENhbGxTdGFjaygpOwogICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICAgICAgICAgIHdvcmtRdWV1ZS5wdXNoKHsKICAgICAgICAgICAgICAgIGZ1bmM6IGZ1bmMsCiAgICAgICAgICAgICAgICByZXNvbHZlOiByZXNvbHZlLAogICAgICAgICAgICAgICAgcmVqZWN0OiByZWplY3QsCiAgICAgICAgICAgICAgICBzdGFjazogc3RhY2sKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGlmIChhc3luY2lmeURpc2FibGVkKSB7CiAgICAgICAgICAgICAgICBEb05leHRBc3luY2lmaWVkSm9iKHdvcmtRdWV1ZS5wb3AoKSk7CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoY2FsbGJhY2tJZCA9PT0gLTEpIFNldE5ld0NhbGxiYWNrKFNFVFRJTUVPVVRfSU5URVJWQUwpCiAgICAgICAgfSkKICAgIH07CiAgICBDMy5Bc3luY2lmeS5TZXRIaWdoVGhyb3VnaHB1dE1vZGUgPSBmdW5jdGlvbiBTZXRIaWdoVGhyb3VnaHB1dE1vZGUobSkgewogICAgICAgIGlmIChtKSArK2hpZ2hUaHJvdWdocHV0TW9kZTsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgLS1oaWdoVGhyb3VnaHB1dE1vZGU7CiAgICAgICAgICAgIGlmIChoaWdoVGhyb3VnaHB1dE1vZGUgPCAwKSB0aHJvdyBuZXcgRXJyb3IoImFscmVhZHkgdHVybmVkIG9mZiBoaWdoIHRocm91Z2hwdXQgbW9kZSIpOwogICAgICAgIH0KICAgIH07Cgp9CgovLyAuLi9saWIvdXRpbC9pZGxlVGltZW91dC5qcwp7CiAgICAndXNlIHN0cmljdCc7CiAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICBjb25zdCBJRExFX0NIRUNLX01JTl9JTlRFUlZBTCA9IDFFMzsKICAgIGNvbnN0IElETEVfQ0hFQ0tfVElNRVJfT1ZFUlNIT09UID0gMTAwOwogICAgbGV0IGNhY2hlZE5vd1RpbWUgPSAtMTsKCiAgICBmdW5jdGlvbiBDbGVhclRpbWVDYWNoZSgpIHsKICAgICAgICBjYWNoZWROb3dUaW1lID0gLTEKICAgIH0KICAgIEMzLkZhc3RHZXREYXRlTm93ID0gZnVuY3Rpb24gRmFzdEdldERhdGVOb3coKSB7CiAgICAgICAgaWYgKGNhY2hlZE5vd1RpbWUgPT09IC0xKSB7CiAgICAgICAgICAgIGNhY2hlZE5vd1RpbWUgPSBEYXRlLm5vdygpOwogICAgICAgICAgICBzZWxmLnNldFRpbWVvdXQoQ2xlYXJUaW1lQ2FjaGUsIDE2KQogICAgICAgIH0KICAgICAgICByZXR1cm4gY2FjaGVkTm93VGltZQogICAgfTsKICAgIGxldCB0aW1lcklkID0gLTE7CiAgICBsZXQgbmV4dERlYWRsaW5lID0gLTE7CiAgICBsZXQgYWN0aXZlSWRsZVRpbWVvdXRzID0gbmV3IFNldDsKCiAgICBmdW5jdGlvbiBDaGVja0FjdGl2ZUlkbGVUaW1lb3V0cygpIHsKICAgICAgICB0aW1lcklkID0gLTE7CiAgICAgICAgbmV4dERlYWRsaW5lID0gLTE7CiAgICAgICAgbGV0IG5vd1RpbWUgPSBEYXRlLm5vdygpOwogICAgICAgIGZvciAobGV0IGkgb2YgYWN0aXZlSWRsZVRpbWVvdXRzKQogICAgICAgICAgICBpZiAoaS5fQ2hlY2tUaW1lb3V0KG5vd1RpbWUpKSB7CiAgICAgICAgICAgICAgICBsZXQgZGVhZGxpbmUgPSBpLl9HZXREZWFkbGluZSgpOwogICAgICAgICAgICAgICAgaWYgKG5leHREZWFkbGluZSA9PT0gLTEgfHwgZGVhZGxpbmUgPCBuZXh0RGVhZGxpbmUpIG5leHREZWFkbGluZSA9IGRlYWRsaW5lCiAgICAgICAgICAgIH0gZWxzZSBhY3RpdmVJZGxlVGltZW91dHMuZGVsZXRlKGkpOwogICAgICAgIGlmIChuZXh0RGVhZGxpbmUgIT09IC0xKSB7CiAgICAgICAgICAgIGxldCBkdXJhdGlvbiA9IE1hdGgubWF4KG5leHREZWFkbGluZSAtIG5vd1RpbWUgKyBJRExFX0NIRUNLX1RJTUVSX09WRVJTSE9PVCwgSURMRV9DSEVDS19NSU5fSU5URVJWQUwpOwogICAgICAgICAgICB0aW1lcklkID0gc2VsZi5zZXRUaW1lb3V0KENoZWNrQWN0aXZlSWRsZVRpbWVvdXRzLCBkdXJhdGlvbikKICAgICAgICB9CiAgICB9CiAgICBDMy5JZGxlVGltZW91dCA9IGNsYXNzIElkbGVUaW1lb3V0IHsKICAgICAgICBjb25zdHJ1Y3RvcihjYWxsYmFjaywgdGltZW91dEluU2Vjb25kcykgewogICAgICAgICAgICB0aGlzLl9jYWxsYmFjayA9IGNhbGxiYWNrOwogICAgICAgICAgICB0aGlzLl90aW1lb3V0ID0gdGltZW91dEluU2Vjb25kcyAqIDFFMzsKICAgICAgICAgICAgdGhpcy5fZGVhZGxpbmUgPSAwOwogICAgICAgICAgICB0aGlzLl9pc0FjdGl2ZSA9IGZhbHNlCiAgICAgICAgfQogICAgICAgIFJlc2V0KCkgewogICAgICAgICAgICBsZXQgbm93VGltZSA9IEMzLkZhc3RHZXREYXRlTm93KCk7CiAgICAgICAgICAgIHRoaXMuX2RlYWRsaW5lID0gbm93VGltZSArIHRoaXMuX3RpbWVvdXQ7CiAgICAgICAgICAgIGlmICghdGhpcy5faXNBY3RpdmUpIHsKICAgICAgICAgICAgICAgIGFjdGl2ZUlkbGVUaW1lb3V0cy5hZGQodGhpcyk7CiAgICAgICAgICAgICAgICB0aGlzLl9pc0FjdGl2ZSA9IHRydWUKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGltZXJJZCA9PT0gLTEpIHsKICAgICAgICAgICAgICAgIG5leHREZWFkbGluZSA9IHRoaXMuX2RlYWRsaW5lOwogICAgICAgICAgICAgICAgdGltZXJJZCA9IHNlbGYuc2V0VGltZW91dChDaGVja0FjdGl2ZUlkbGVUaW1lb3V0cywgdGhpcy5fdGltZW91dCArIElETEVfQ0hFQ0tfVElNRVJfT1ZFUlNIT09UKQogICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuX2RlYWRsaW5lIDwgbmV4dERlYWRsaW5lICYmIG5leHREZWFkbGluZSA+IG5vd1RpbWUgKwogICAgICAgICAgICAgICAgSURMRV9DSEVDS19NSU5fSU5URVJWQUwpIHsKICAgICAgICAgICAgICAgIHNlbGYuY2xlYXJUaW1lb3V0KHRpbWVySWQpOwogICAgICAgICAgICAgICAgbmV4dERlYWRsaW5lID0gdGhpcy5fZGVhZGxpbmU7CiAgICAgICAgICAgICAgICB0aW1lcklkID0gc2VsZi5zZXRUaW1lb3V0KENoZWNrQWN0aXZlSWRsZVRpbWVvdXRzLCB0aGlzLl90aW1lb3V0ICsgSURMRV9DSEVDS19USU1FUl9PVkVSU0hPT1QpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgX0NoZWNrVGltZW91dChub3dUaW1lKSB7CiAgICAgICAgICAgIGlmIChub3dUaW1lID49IHRoaXMuX2RlYWRsaW5lKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fY2FsbGJhY2soKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX2RlYWRsaW5lID0gbm93VGltZSArIHRoaXMuX3RpbWVvdXQ7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMuX2lzQWN0aXZlID0gZmFsc2U7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgIH0KICAgICAgICBfR2V0RGVhZGxpbmUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9kZWFkbGluZQogICAgICAgIH0KICAgICAgICBDYW5jZWwoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9pc0FjdGl2ZSkgewogICAgICAgICAgICAgICAgYWN0aXZlSWRsZVRpbWVvdXRzLmRlbGV0ZSh0aGlzKTsKICAgICAgICAgICAgICAgIHRoaXMuX2lzQWN0aXZlID0gZmFsc2U7CiAgICAgICAgICAgICAgICBpZiAoYWN0aXZlSWRsZVRpbWVvdXRzLnNpemUgPT09IDAgJiYgdGltZXJJZCAhPT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICBzZWxmLmNsZWFyVGltZW91dCh0aW1lcklkKTsKICAgICAgICAgICAgICAgICAgICB0aW1lcklkID0gLTE7CiAgICAgICAgICAgICAgICAgICAgbmV4dERlYWRsaW5lID0gLTEKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBSZWxlYXNlKCkgewogICAgICAgICAgICB0aGlzLkNhbmNlbCgpOwogICAgICAgICAgICB0aGlzLl9jYWxsYmFjayA9IG51bGwKICAgICAgICB9CiAgICB9OwoKfQoKLy8gLi4vbGliL3V0aWwvZGlzcG9zYWJsZS5qcwp7CiAgICAndXNlIHN0cmljdCc7CiAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICBDMy5EaXNwb3NhYmxlID0gY2xhc3MgRGlzcG9zYWJsZSB7CiAgICAgICAgY29uc3RydWN0b3IoZGlzcG9zZUFjdGlvbikgewogICAgICAgICAgICB0aGlzLl9kaXNwb3NlZCA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl9kaXNwb3NlQWN0aW9uID0gZGlzcG9zZUFjdGlvbgogICAgICAgIH0KICAgICAgICBEaXNwb3NlKCkgewogICAgICAgICAgICBpZiAodGhpcy5fZGlzcG9zZWQpIHJldHVybjsKICAgICAgICAgICAgdGhpcy5fZGlzcG9zZWQgPSB0cnVlOwogICAgICAgICAgICBpZiAodGhpcy5fZGlzcG9zZUFjdGlvbikgewogICAgICAgICAgICAgICAgdGhpcy5fZGlzcG9zZUFjdGlvbigpOwogICAgICAgICAgICAgICAgdGhpcy5fZGlzcG9zZUFjdGlvbiA9IG51bGwKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBJc0Rpc3Bvc2VkKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZGlzcG9zZWQKICAgICAgICB9CiAgICAgICAgUmVsZWFzZSgpIHsKICAgICAgICAgICAgdGhpcy5EaXNwb3NlKCkKICAgICAgICB9CiAgICAgICAgc3RhdGljIFJlbGVhc2UoaW5zdGFuY2UpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBEaXNwb3NhYmxlKCgpID0+IGluc3RhbmNlLlJlbGVhc2UoKSkKICAgICAgICB9CiAgICAgICAgc3RhdGljIEZyb20oZXZlbnREaXNwYXRjaGVyLCBldmVudE5hbWVzLCBldmVudEhhbmRsZXIsIG9wdHMsIHNjb3BlKSB7CiAgICAgICAgICAgIGlmICh0eXBlb2Ygb3B0cyA9PT0gInVuZGVmaW5lZCIgfHwgb3B0cyA9PT0gbnVsbCkgb3B0cyA9IGZhbHNlOwogICAgICAgICAgICBlbHNlIGlmICh0eXBlb2Ygb3B0cyAhPT0KICAgICAgICAgICAgICAgICJib29sZWFuIiAmJiB0eXBlb2Ygb3B0cyAhPT0gIm9iamVjdCIpIHRocm93IG5ldyBUeXBlRXJyb3IoImludmFsaWQgZXZlbnQgbGlzdGVuZXIgb3B0aW9ucyIpOwogICAgICAgICAgICBpZiAoc2NvcGUpIGV2ZW50SGFuZGxlciA9IGV2ZW50SGFuZGxlci5iaW5kKHNjb3BlKTsKICAgICAgICAgICAgaWYgKGV2ZW50TmFtZXMuaW5jbHVkZXMoIiAiKSkgewogICAgICAgICAgICAgICAgZXZlbnROYW1lcyA9IGV2ZW50TmFtZXMuc3BsaXQoIiAiKTsKICAgICAgICAgICAgICAgIGNvbnN0IGRpc3Bvc2FibGUgPSBuZXcgQzMuQ29tcG9zaXRlRGlzcG9zYWJsZTsKICAgICAgICAgICAgICAgIGZvciAobGV0IGV2ZW50TmFtZSBvZiBldmVudE5hbWVzKSB7CiAgICAgICAgICAgICAgICAgICAgZXZlbnREaXNwYXRjaGVyLmFkZEV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCBldmVudEhhbmRsZXIsIG9wdHMpOwogICAgICAgICAgICAgICAgICAgIGRpc3Bvc2FibGUuQWRkKEMzLk5ldyhDMy5EaXNwb3NhYmxlLCAoKSA9PiBldmVudERpc3BhdGNoZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIGV2ZW50SGFuZGxlciwgb3B0cykpKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIGRpc3Bvc2FibGUKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGV2ZW50RGlzcGF0Y2hlci5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZXMsCiAgICAgICAgICAgICAgICAgICAgZXZlbnRIYW5kbGVyLCBvcHRzKTsKICAgICAgICAgICAgICAgIHJldHVybiBDMy5OZXcoQzMuRGlzcG9zYWJsZSwgKCkgPT4gZXZlbnREaXNwYXRjaGVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnROYW1lcywgZXZlbnRIYW5kbGVyLCBvcHRzKSkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICBDMy5TdHViRGlzcG9zYWJsZSA9IGNsYXNzIFN0dWJEaXNwb3NhYmxlIGV4dGVuZHMgQzMuRGlzcG9zYWJsZSB7CiAgICAgICAgU2V0QWN0aW9uKGRpc3Bvc2VBY3Rpb24pIHsKICAgICAgICAgICAgdGhpcy5fZGlzcG9zZUFjdGlvbiA9IGRpc3Bvc2VBY3Rpb24KICAgICAgICB9CiAgICB9OwogICAgQzMuQ29tcG9zaXRlRGlzcG9zYWJsZSA9IGNsYXNzIENvbXBvc2l0ZURpc3Bvc2FibGUgZXh0ZW5kcyBDMy5EaXNwb3NhYmxlIHsKICAgICAgICBjb25zdHJ1Y3RvciguLi5kaXNwb3NhYmxlcykgewogICAgICAgICAgICBzdXBlcigpOwogICAgICAgICAgICB0aGlzLl9kaXNwb3NhYmxlcyA9IG5ldyBTZXQ7CiAgICAgICAgICAgIGZvciAobGV0IGRpc3Bvc2FibGUgb2YgZGlzcG9zYWJsZXMpIHRoaXMuQWRkKGRpc3Bvc2FibGUpCiAgICAgICAgfQogICAgICAgIEFkZCguLi5kaXNwb3NhYmxlcykgewogICAgICAgICAgICBpZiAodGhpcy5fZGlzcG9zZWQpIHRocm93IG5ldyBFcnJvcigiYWxyZWFkeSBkaXNwb3NlZCIpOwogICAgICAgICAgICBmb3IgKGxldCBkaXNwb3NhYmxlIG9mIGRpc3Bvc2FibGVzKSB0aGlzLl9kaXNwb3NhYmxlcy5hZGQoZGlzcG9zYWJsZSkKICAgICAgICB9CiAgICAgICAgUmVtb3ZlKGRpc3Bvc2FibGUpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX2Rpc3Bvc2VkKSB0aHJvdyBuZXcgRXJyb3IoImFscmVhZHkgZGlzcG9zZWQiKTsKICAgICAgICAgICAgdGhpcy5fZGlzcG9zYWJsZXMuZGVsZXRlKGRpc3Bvc2FibGUpCiAgICAgICAgfQogICAgICAgIFJlbW92ZUFsbCgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX2Rpc3Bvc2VkKSB0aHJvdyBuZXcgRXJyb3IoImFscmVhZHkgZGlzcG9zZWQiKTsKICAgICAgICAgICAgaWYgKCF0aGlzLl9kaXNwb3NhYmxlcykgcmV0dXJuOwogICAgICAgICAgICBmb3IgKGxldCBkaXNwb3NhYmxlIG9mIHRoaXMuX2Rpc3Bvc2FibGVzKSBkaXNwb3NhYmxlLkRpc3Bvc2UoKTsKICAgICAgICAgICAgdGhpcy5fZGlzcG9zYWJsZXMuY2xlYXIoKQogICAgICAgIH0KICAgICAgICBJc0Rpc3Bvc2VkKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZGlzcG9zZWQKICAgICAgICB9CiAgICAgICAgRGlzcG9zZSgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX2Rpc3Bvc2VkKSB0aHJvdyBuZXcgRXJyb3IoImFscmVhZHkgZGlzcG9zZWQiKTsKICAgICAgICAgICAgdGhpcy5fZGlzcG9zZWQgPSB0cnVlOwogICAgICAgICAgICBmb3IgKGxldCBkaXNwb3NhYmxlIG9mIHRoaXMuX2Rpc3Bvc2FibGVzKSBkaXNwb3NhYmxlLkRpc3Bvc2UoKTsKICAgICAgICAgICAgdGhpcy5fZGlzcG9zYWJsZXMuY2xlYXIoKTsKICAgICAgICAgICAgdGhpcy5fZGlzcG9zYWJsZXMgPSBudWxsCiAgICAgICAgfQogICAgICAgIFJlbGVhc2UoKSB7CiAgICAgICAgICAgIHRoaXMuRGlzcG9zZSgpCiAgICAgICAgfQogICAgfTsKCn0KCi8vIGxpYi91dGlsL2thaGFuU3VtLmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIEMzLkthaGFuU3VtID0gY2xhc3MgS2FoYW5TdW0gZXh0ZW5kcyBDMy5EZWZlbmRlZEJhc2UgewogICAgICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgICAgICBzdXBlcigpOwogICAgICAgICAgICB0aGlzLl9jID0gMDsKICAgICAgICAgICAgdGhpcy5feSA9IDA7CiAgICAgICAgICAgIHRoaXMuX3QgPSAwOwogICAgICAgICAgICB0aGlzLl9zdW0gPSAwCiAgICAgICAgfQogICAgICAgIEFkZCh2KSB7CiAgICAgICAgICAgIHYgPSArdjsKICAgICAgICAgICAgdGhpcy5feSA9IHYgLSB0aGlzLl9jOwogICAgICAgICAgICB0aGlzLl90ID0gdGhpcy5fc3VtICsgdGhpcy5feTsKICAgICAgICAgICAgdGhpcy5fYyA9IHRoaXMuX3QgLSB0aGlzLl9zdW0gLSB0aGlzLl95OwogICAgICAgICAgICB0aGlzLl9zdW0gPSB0aGlzLl90CiAgICAgICAgfQogICAgICAgIFN1YnRyYWN0KHYpIHsKICAgICAgICAgICAgdGhpcy5fc3VtIC09ICt2CiAgICAgICAgfQogICAgICAgIEdldCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3N1bQogICAgICAgIH0KICAgICAgICBSZXNldCgpIHsKICAgICAgICAgICAgdGhpcy5fYyA9IDA7CiAgICAgICAgICAgIHRoaXMuX3kgPSAwOwogICAgICAgICAgICB0aGlzLl90ID0gMDsKICAgICAgICAgICAgdGhpcy5fc3VtID0gMAogICAgICAgIH0KICAgICAgICBTZXQocykgewogICAgICAgICAgICB0aGlzLl9jID0gMDsKICAgICAgICAgICAgdGhpcy5feSA9IDA7CiAgICAgICAgICAgIHRoaXMuX3QgPSAwOwogICAgICAgICAgICB0aGlzLl9zdW0gPSArcwogICAgICAgIH0KICAgICAgICBDb3B5KGtzKSB7CiAgICAgICAgICAgIHRoaXMuX2MgPSBrcy5fYzsKICAgICAgICAgICAgdGhpcy5feSA9IGtzLl95OwogICAgICAgICAgICB0aGlzLl90ID0ga3MuX3Q7CiAgICAgICAgICAgIHRoaXMuX3N1bSA9IGtzLl9zdW0KICAgICAgICB9CiAgICAgICAgUmVsZWFzZSgpIHt9CiAgICB9OwoKfQoKLy8gbGliL3V0aWwvcmVkYmxhY2tzZXQuanMKewogICAgJ3VzZSBzdHJpY3QnOwogICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgY29uc3QganNfY29scyA9IHt9OwogICAgY29uc3QgUkVEID0gdHJ1ZTsKICAgIGNvbnN0IEJMQUNLID0gZmFsc2U7CiAgICBqc19jb2xzLlJCbm9kZSA9IGZ1bmN0aW9uKHRyZWUpIHsKICAgICAgICB0aGlzLnRyZWUgPSB0cmVlOwogICAgICAgIHRoaXMucmlnaHQgPSB0aGlzLnRyZWUuc2VudGluZWw7CiAgICAgICAgdGhpcy5sZWZ0ID0gdGhpcy50cmVlLnNlbnRpbmVsOwogICAgICAgIHRoaXMucGFyZW50ID0gbnVsbDsKICAgICAgICB0aGlzLmNvbG9yID0gZmFsc2U7CiAgICAgICAgdGhpcy5rZXkgPSBudWxsCiAgICB9OwogICAganNfY29scy5SZWRCbGFja1NldCA9IGZ1bmN0aW9uKGNvbXBhcmVfZnVuYykgewogICAgICAgIHRoaXMuc2l6ZSA9IDA7CiAgICAgICAgdGhpcy5zZW50aW5lbCA9IG5ldyBqc19jb2xzLlJCbm9kZSh0aGlzKTsKICAgICAgICB0aGlzLnNlbnRpbmVsLmNvbG9yID0gQkxBQ0s7CiAgICAgICAgdGhpcy5yb290ID0gdGhpcy5zZW50aW5lbDsKICAgICAgICB0aGlzLnJvb3QucGFyZW50ID0gdGhpcy5zZW50aW5lbDsKICAgICAgICB0aGlzLmNvbXBhcmUgPSBjb21wYXJlX2Z1bmMgfHwgdGhpcy5kZWZhdWx0X2NvbXBhcmUKICAgIH07CiAgICBqc19jb2xzLlJlZEJsYWNrU2V0LnByb3RvdHlwZS5kZWZhdWx0X2NvbXBhcmUgPSBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgaWYgKGEgPCBiKSByZXR1cm4gLTE7CiAgICAgICAgZWxzZSBpZiAoYiA8IGEpIHJldHVybiAxOwogICAgICAgIGVsc2UgcmV0dXJuIDAKICAgIH07CiAgICBqc19jb2xzLlJlZEJsYWNrU2V0LnByb3RvdHlwZS5jbG9uZSA9IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBydiA9IG5ldyBqc19jb2xzLlJlZEJsYWNrU2V0KHRoaXMuY29tcGFyZSk7CiAgICAgICAgcnYuaW5zZXJ0QWxsKHRoaXMpOwogICAgICAgIHJldHVybiBydgogICAgfTsKICAgIGpzX2NvbHMuUmVkQmxhY2tTZXQucHJvdG90eXBlLmNsZWFyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdGhpcy5zaXplID0gMDsKICAgICAgICB0aGlzLnNlbnRpbmVsID0gbmV3IGpzX2NvbHMuUkJub2RlKHRoaXMpOwogICAgICAgIHRoaXMuc2VudGluZWwuY29sb3IgPSBCTEFDSzsKICAgICAgICB0aGlzLnJvb3QgPSB0aGlzLnNlbnRpbmVsOwogICAgICAgIHRoaXMucm9vdC5wYXJlbnQgPSB0aGlzLnNlbnRpbmVsCiAgICB9OwogICAganNfY29scy5SZWRCbGFja1NldC5wcm90b3R5cGUubGVmdFJvdGF0ZSA9IGZ1bmN0aW9uKHgpIHsKICAgICAgICB2YXIgeSA9IHgucmlnaHQ7CiAgICAgICAgeC5yaWdodCA9IHkubGVmdDsKICAgICAgICBpZiAoeS5sZWZ0ICE9IHRoaXMuc2VudGluZWwpIHkubGVmdC5wYXJlbnQgPSB4OwogICAgICAgIHkucGFyZW50ID0geC5wYXJlbnQ7CiAgICAgICAgaWYgKHgucGFyZW50ID09IHRoaXMuc2VudGluZWwpIHRoaXMucm9vdCA9IHk7CiAgICAgICAgZWxzZSBpZiAoeCA9PSB4LnBhcmVudC5sZWZ0KSB4LnBhcmVudC5sZWZ0ID0geTsKICAgICAgICBlbHNlIHgucGFyZW50LnJpZ2h0ID0geTsKICAgICAgICB5LmxlZnQgPSB4OwogICAgICAgIHgucGFyZW50ID0geQogICAgfTsKICAgIGpzX2NvbHMuUmVkQmxhY2tTZXQucHJvdG90eXBlLnJpZ2h0Um90YXRlID0gZnVuY3Rpb24oeCkgewogICAgICAgIHZhciB5ID0geC5sZWZ0OwogICAgICAgIHgubGVmdCA9IHkucmlnaHQ7CiAgICAgICAgaWYgKHkucmlnaHQgIT0gdGhpcy5zZW50aW5lbCkgeS5yaWdodC5wYXJlbnQgPSB4OwogICAgICAgIHkucGFyZW50ID0geC5wYXJlbnQ7CiAgICAgICAgaWYgKHgucGFyZW50ID09IHRoaXMuc2VudGluZWwpIHRoaXMucm9vdCA9IHk7CiAgICAgICAgZWxzZSBpZiAoeCA9PSB4LnBhcmVudC5yaWdodCkgeC5wYXJlbnQucmlnaHQgPSB5OwogICAgICAgIGVsc2UgeC5wYXJlbnQubGVmdCA9IHk7CiAgICAgICAgeS5yaWdodCA9IHg7CiAgICAgICAgeC5wYXJlbnQgPSB5CiAgICB9OwogICAganNfY29scy5SZWRCbGFja1NldC5wcm90b3R5cGUuaW5zZXJ0ID0gZnVuY3Rpb24oa2V5KSB7CiAgICAgICAgaWYgKCF0aGlzLmNvbnRhaW5zKGtleSkpIHsKICAgICAgICAgICAgdmFyIHogPSBuZXcganNfY29scy5SQm5vZGUodGhpcyk7CiAgICAgICAgICAgIHoua2V5ID0ga2V5OwogICAgICAgICAgICB2YXIgeSA9IHRoaXMuc2VudGluZWw7CiAgICAgICAgICAgIHZhciB4ID0gdGhpcy5yb290OwogICAgICAgICAgICB3aGlsZSAoeCAhPSB0aGlzLnNlbnRpbmVsKSB7CiAgICAgICAgICAgICAgICB5ID0geDsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmNvbXBhcmUoei5rZXksIHgua2V5KSA8IDApIHggPSB4LmxlZnQ7CiAgICAgICAgICAgICAgICBlbHNlIHggPSB4LnJpZ2h0CiAgICAgICAgICAgIH0KICAgICAgICAgICAgei5wYXJlbnQgPSB5OwogICAgICAgICAgICBpZiAoeSA9PSB0aGlzLnNlbnRpbmVsKSB0aGlzLnJvb3QgPSB6OwogICAgICAgICAgICBlbHNlIGlmICh0aGlzLmNvbXBhcmUoei5rZXksIHkua2V5KSA8IDApIHkubGVmdCA9IHo7CiAgICAgICAgICAgIGVsc2UgeS5yaWdodCA9IHo7CiAgICAgICAgICAgIHoubGVmdCA9IHRoaXMuc2VudGluZWw7CiAgICAgICAgICAgIHoucmlnaHQgPSB0aGlzLnNlbnRpbmVsOwogICAgICAgICAgICB6LmNvbG9yID0gUkVEOwogICAgICAgICAgICB0aGlzLmluc2VydEZpeHVwKHopOwogICAgICAgICAgICB0aGlzLnNpemUrKwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZhciBub2RlID0gdGhpcy5nZXRfKGtleSk7CiAgICAgICAgICAgIG5vZGUua2V5ID0ga2V5CiAgICAgICAgfQogICAgfTsKICAgIGpzX2NvbHMuUmVkQmxhY2tTZXQucHJvdG90eXBlLmluc2VydEZpeHVwID0gZnVuY3Rpb24oeikgewogICAgICAgIHdoaWxlICh6ICE9IHRoaXMuc2VudGluZWwgJiYgeiAhPSB0aGlzLnJvb3QgJiYgei5wYXJlbnQuY29sb3IgPT0gUkVEKQogICAgICAgICAgICBpZiAoei5wYXJlbnQgPT0gei5wYXJlbnQucGFyZW50LmxlZnQpIHsKICAgICAgICAgICAgICAgIHZhciB5ID0gei5wYXJlbnQucGFyZW50LnJpZ2h0OwogICAgICAgICAgICAgICAgaWYgKHkuY29sb3IgPT0gUkVEKSB7CiAgICAgICAgICAgICAgICAgICAgei5wYXJlbnQuY29sb3IgPSBCTEFDSzsKICAgICAgICAgICAgICAgICAgICB5LmNvbG9yID0gQkxBQ0s7CiAgICAgICAgICAgICAgICAgICAgei5wYXJlbnQucGFyZW50LmNvbG9yID0gUkVEOwogICAgICAgICAgICAgICAgICAgIHogPSB6LnBhcmVudC5wYXJlbnQKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHogPT0gei5wYXJlbnQucmlnaHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgeiA9IHoucGFyZW50OwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxlZnRSb3RhdGUoeikKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgei5wYXJlbnQuY29sb3IgPSBCTEFDSzsKICAgICAgICAgICAgICAgICAgICB6LnBhcmVudC5wYXJlbnQuY29sb3IgPSBSRUQ7CiAgICAgICAgICAgICAgICAgICAgaWYgKHoucGFyZW50LnBhcmVudCAhPSB0aGlzLnNlbnRpbmVsKSB0aGlzLnJpZ2h0Um90YXRlKHoucGFyZW50LnBhcmVudCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHZhciB5ID0gei5wYXJlbnQucGFyZW50LmxlZnQ7CiAgICAgICAgICAgICAgICBpZiAoeS5jb2xvciA9PSBSRUQpIHsKICAgICAgICAgICAgICAgICAgICB6LnBhcmVudC5jb2xvciA9CiAgICAgICAgICAgICAgICAgICAgICAgIEJMQUNLOwogICAgICAgICAgICAgICAgICAgIHkuY29sb3IgPSBCTEFDSzsKICAgICAgICAgICAgICAgICAgICB6LnBhcmVudC5wYXJlbnQuY29sb3IgPSBSRUQ7CiAgICAgICAgICAgICAgICAgICAgeiA9IHoucGFyZW50LnBhcmVudAogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBpZiAoeiA9PSB6LnBhcmVudC5sZWZ0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHogPSB6LnBhcmVudDsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yaWdodFJvdGF0ZSh6KQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB6LnBhcmVudC5jb2xvciA9IEJMQUNLOwogICAgICAgICAgICAgICAgICAgIHoucGFyZW50LnBhcmVudC5jb2xvciA9IFJFRDsKICAgICAgICAgICAgICAgICAgICBpZiAoei5wYXJlbnQucGFyZW50ICE9IHRoaXMuc2VudGluZWwpIHRoaXMubGVmdFJvdGF0ZSh6LnBhcmVudC5wYXJlbnQpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB0aGlzLnJvb3QuY29sb3IgPSBCTEFDSwogICAgfTsKICAgIGpzX2NvbHMuUmVkQmxhY2tTZXQucHJvdG90eXBlLmRlbGV0ZV8gPSBmdW5jdGlvbih6KSB7CiAgICAgICAgdmFyIHk7CiAgICAgICAgdmFyIHg7CiAgICAgICAgaWYgKHoubGVmdCA9PSB0aGlzLnNlbnRpbmVsIHx8IHoucmlnaHQgPT0gdGhpcy5zZW50aW5lbCkgeSA9IHo7CiAgICAgICAgZWxzZSB5ID0gdGhpcy5zdWNjZXNzb3JfKHopOwogICAgICAgIGlmICh5LmxlZnQgIT0gdGhpcy5zZW50aW5lbCkgeCA9IHkubGVmdDsKICAgICAgICBlbHNlIHggPSB5LnJpZ2h0OwogICAgICAgIHgucGFyZW50ID0geS5wYXJlbnQ7CiAgICAgICAgaWYgKHkucGFyZW50ID09IHRoaXMuc2VudGluZWwpIHRoaXMucm9vdCA9IHg7CiAgICAgICAgZWxzZSBpZiAoeSA9PSB5LnBhcmVudC5sZWZ0KSB5LnBhcmVudC5sZWZ0ID0geDsKICAgICAgICBlbHNlIHkucGFyZW50LnJpZ2h0ID0geDsKICAgICAgICBpZiAoeSAhPSB6KSB6LmtleSA9IHkua2V5OwogICAgICAgIGlmICh5LmNvbG9yID09IEJMQUNLKSB0aGlzLmRlbGV0ZUZpeHVwKHgpOwogICAgICAgIHRoaXMuc2l6ZS0tCiAgICB9OwogICAganNfY29scy5SZWRCbGFja1NldC5wcm90b3R5cGUuZGVsZXRlRml4dXAgPSBmdW5jdGlvbih4KSB7CiAgICAgICAgd2hpbGUgKHggIT0gdGhpcy5yb290ICYmIHguY29sb3IgPT0gQkxBQ0spCiAgICAgICAgICAgIGlmICh4ID09IHgucGFyZW50LmxlZnQpIHsKICAgICAgICAgICAgICAgIHZhciB3ID0geC5wYXJlbnQucmlnaHQ7CiAgICAgICAgICAgICAgICBpZiAody5jb2xvciA9PSBSRUQpIHsKICAgICAgICAgICAgICAgICAgICB3LmNvbG9yID0gQkxBQ0s7CiAgICAgICAgICAgICAgICAgICAgeC5wYXJlbnQuY29sb3IgPSBSRUQ7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5sZWZ0Um90YXRlKHgucGFyZW50KTsKICAgICAgICAgICAgICAgICAgICB3ID0geC5wYXJlbnQucmlnaHQKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh3LmxlZnQuY29sb3IgPT0gQkxBQ0sgJiYgdy5yaWdodC5jb2xvciA9PSBCTEFDSykgewogICAgICAgICAgICAgICAgICAgIHcuY29sb3IgPSBSRUQ7CiAgICAgICAgICAgICAgICAgICAgeCA9IHgucGFyZW50CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGlmICh3LnJpZ2h0LmNvbG9yID09IEJMQUNLKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHcubGVmdC5jb2xvciA9IEJMQUNLOwogICAgICAgICAgICAgICAgICAgICAgICB3LmNvbG9yID0gUkVEOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJpZ2h0Um90YXRlKHcpOwogICAgICAgICAgICAgICAgICAgICAgICB3ID0geC5wYXJlbnQucmlnaHQKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdy5jb2xvciA9IHgucGFyZW50LmNvbG9yOwogICAgICAgICAgICAgICAgICAgIHgucGFyZW50LmNvbG9yID0gQkxBQ0s7CiAgICAgICAgICAgICAgICAgICAgdy5yaWdodC5jb2xvciA9IEJMQUNLOwogICAgICAgICAgICAgICAgICAgIHRoaXMubGVmdFJvdGF0ZSh4LnBhcmVudCk7CiAgICAgICAgICAgICAgICAgICAgeCA9IHRoaXMucm9vdAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdmFyIHcgPQogICAgICAgICAgICAgICAgICAgIHgucGFyZW50LmxlZnQ7CiAgICAgICAgICAgICAgICBpZiAody5jb2xvciA9PSBSRUQpIHsKICAgICAgICAgICAgICAgICAgICB3LmNvbG9yID0gQkxBQ0s7CiAgICAgICAgICAgICAgICAgICAgeC5wYXJlbnQuY29sb3IgPSBSRUQ7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5yaWdodFJvdGF0ZSh4LnBhcmVudCk7CiAgICAgICAgICAgICAgICAgICAgdyA9IHgucGFyZW50LmxlZnQKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh3LnJpZ2h0LmNvbG9yID09IEJMQUNLICYmIHcubGVmdC5jb2xvciA9PSBCTEFDSykgewogICAgICAgICAgICAgICAgICAgIHcuY29sb3IgPSBSRUQ7CiAgICAgICAgICAgICAgICAgICAgeCA9IHgucGFyZW50CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGlmICh3LmxlZnQuY29sb3IgPT0gQkxBQ0spIHsKICAgICAgICAgICAgICAgICAgICAgICAgdy5yaWdodC5jb2xvciA9IEJMQUNLOwogICAgICAgICAgICAgICAgICAgICAgICB3LmNvbG9yID0gUkVEOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxlZnRSb3RhdGUodyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHcgPSB4LnBhcmVudC5sZWZ0CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHcuY29sb3IgPSB4LnBhcmVudC5jb2xvcjsKICAgICAgICAgICAgICAgICAgICB4LnBhcmVudC5jb2xvciA9IEJMQUNLOwogICAgICAgICAgICAgICAgICAgIHcubGVmdC5jb2xvciA9IEJMQUNLOwogICAgICAgICAgICAgICAgICAgIHRoaXMucmlnaHRSb3RhdGUoeC5wYXJlbnQpOwogICAgICAgICAgICAgICAgICAgIHggPSB0aGlzLnJvb3QKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIHguY29sb3IgPSBCTEFDSwogICAgfTsKICAgIGpzX2NvbHMuUmVkQmxhY2tTZXQucHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uKGtleSkgewogICAgICAgIHZhciB4ID0gdGhpcy5nZXRfKGtleSk7CiAgICAgICAgaWYgKHggIT0gdGhpcy5zZW50aW5lbCkgewogICAgICAgICAgICB2YXIgcmV0dmFsID0geC5rZXk7CiAgICAgICAgICAgIHRoaXMuZGVsZXRlXyh4KTsKICAgICAgICAgICAgcmV0dXJuIHJldHZhbAogICAgICAgIH0gZWxzZSByZXR1cm4gbnVsbAogICAgfTsKICAgIGpzX2NvbHMuUmVkQmxhY2tTZXQucHJvdG90eXBlLnJlbW92ZVN3YXBwZWQgPSBmdW5jdGlvbih2YWx1ZSwga2V5KSB7CiAgICAgICAgdGhpcy5yZW1vdmUoa2V5KQogICAgfTsKICAgIGpzX2NvbHMuUmVkQmxhY2tTZXQucHJvdG90eXBlLm1pbiA9IGZ1bmN0aW9uKHgpIHsKICAgICAgICB3aGlsZSAoeC5sZWZ0ICE9IHRoaXMuc2VudGluZWwpIHggPSB4LmxlZnQ7CiAgICAgICAgcmV0dXJuIHgKICAgIH07CiAgICBqc19jb2xzLlJlZEJsYWNrU2V0LnByb3RvdHlwZS5tYXggPSBmdW5jdGlvbih4KSB7CiAgICAgICAgd2hpbGUgKHgucmlnaHQgIT0gdGhpcy5zZW50aW5lbCkgeCA9IHgucmlnaHQ7CiAgICAgICAgcmV0dXJuIHgKICAgIH07CiAgICBqc19jb2xzLlJlZEJsYWNrU2V0LnByb3RvdHlwZS5zdWNjZXNzb3JfID0gZnVuY3Rpb24oeCkgewogICAgICAgIGlmICh4LnJpZ2h0ICE9IHRoaXMuc2VudGluZWwpIHJldHVybiB0aGlzLm1pbih4LnJpZ2h0KTsKICAgICAgICB2YXIgeSA9IHgucGFyZW50OwogICAgICAgIHdoaWxlICh5ICE9IHRoaXMuc2VudGluZWwgJiYgeCA9PSB5LnJpZ2h0KSB7CiAgICAgICAgICAgIHggPSB5OwogICAgICAgICAgICB5ID0geS5wYXJlbnQKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHkKICAgIH07CiAgICBqc19jb2xzLlJlZEJsYWNrU2V0LnByb3RvdHlwZS5wcmVkZWNjZXNzb3JfID0gZnVuY3Rpb24oeCkgewogICAgICAgIGlmICh4LmxlZnQgIT0gdGhpcy5zZW50aW5lbCkgcmV0dXJuIHRoaXMubWF4KHgubGVmdCk7CiAgICAgICAgdmFyIHkgPSB4LnBhcmVudDsKICAgICAgICB3aGlsZSAoeSAhPSB0aGlzLnNlbnRpbmVsICYmIHggPT0geS5sZWZ0KSB7CiAgICAgICAgICAgIHggPSB5OwogICAgICAgICAgICB5ID0geS5wYXJlbnQKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHkKICAgIH07CiAgICBqc19jb2xzLlJlZEJsYWNrU2V0LnByb3RvdHlwZS5zdWNjZXNzb3IgPSBmdW5jdGlvbihrZXkpIHsKICAgICAgICBpZiAodGhpcy5zaXplID4gMCkgewogICAgICAgICAgICB2YXIgeCA9IHRoaXMuZ2V0XyhrZXkpOwogICAgICAgICAgICBpZiAoeCA9PSB0aGlzLnNlbnRpbmVsKSByZXR1cm4gbnVsbDsKICAgICAgICAgICAgaWYgKHgucmlnaHQgIT0gdGhpcy5zZW50aW5lbCkgcmV0dXJuIHRoaXMubWluKHgucmlnaHQpLmtleTsKICAgICAgICAgICAgdmFyIHkgPSB4LnBhcmVudDsKICAgICAgICAgICAgd2hpbGUgKHkgIT0gdGhpcy5zZW50aW5lbCAmJiB4ID09IHkucmlnaHQpIHsKICAgICAgICAgICAgICAgIHggPSB5OwogICAgICAgICAgICAgICAgeSA9IHkucGFyZW50CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHkgIT0gdGhpcy5zZW50aW5lbCkgcmV0dXJuIHkua2V5OwogICAgICAgICAgICBlbHNlIHJldHVybiBudWxsCiAgICAgICAgfSBlbHNlIHJldHVybiBudWxsCiAgICB9OwogICAganNfY29scy5SZWRCbGFja1NldC5wcm90b3R5cGUucHJlZGVjZXNzb3IgPSBmdW5jdGlvbihrZXkpIHsKICAgICAgICBpZiAodGhpcy5zaXplID4gMCkgewogICAgICAgICAgICB2YXIgeCA9IHRoaXMuZ2V0XyhrZXkpOwogICAgICAgICAgICBpZiAoeCA9PSB0aGlzLnNlbnRpbmVsKSByZXR1cm4gbnVsbDsKICAgICAgICAgICAgaWYgKHgubGVmdCAhPSB0aGlzLnNlbnRpbmVsKSByZXR1cm4gdGhpcy5tYXgoeC5sZWZ0KS5rZXk7CiAgICAgICAgICAgIHZhciB5ID0geC5wYXJlbnQ7CiAgICAgICAgICAgIHdoaWxlICh5ICE9IHRoaXMuc2VudGluZWwgJiYgeCA9PSB5LmxlZnQpIHsKICAgICAgICAgICAgICAgIHggPSB5OwogICAgICAgICAgICAgICAgeSA9IHkucGFyZW50CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHkgIT0gdGhpcy5zZW50aW5lbCkgcmV0dXJuIHkua2V5OwogICAgICAgICAgICBlbHNlIHJldHVybiBudWxsCiAgICAgICAgfSBlbHNlIHJldHVybiBudWxsCiAgICB9OwogICAganNfY29scy5SZWRCbGFja1NldC5wcm90b3R5cGUuZ2V0TWluID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMubWluKHRoaXMucm9vdCkua2V5CiAgICB9OwogICAganNfY29scy5SZWRCbGFja1NldC5wcm90b3R5cGUuZ2V0TWF4ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMubWF4KHRoaXMucm9vdCkua2V5CiAgICB9OwogICAganNfY29scy5SZWRCbGFja1NldC5wcm90b3R5cGUuZ2V0XyA9IGZ1bmN0aW9uKGtleSkgewogICAgICAgIHZhciB4ID0gdGhpcy5yb290OwogICAgICAgIHdoaWxlICh4ICE9IHRoaXMuc2VudGluZWwgJiYgdGhpcy5jb21wYXJlKHgua2V5LCBrZXkpICE9IDApCiAgICAgICAgICAgIGlmICh0aGlzLmNvbXBhcmUoa2V5LCB4LmtleSkgPCAwKSB4ID0geC5sZWZ0OwogICAgICAgICAgICBlbHNlIHggPSB4LnJpZ2h0OwogICAgICAgIHJldHVybiB4CiAgICB9OwogICAganNfY29scy5SZWRCbGFja1NldC5wcm90b3R5cGUuY29udGFpbnMgPSBmdW5jdGlvbihrZXkpIHsKICAgICAgICByZXR1cm4gdGhpcy5nZXRfKGtleSkua2V5ICE9IG51bGwKICAgIH07CiAgICBqc19jb2xzLlJlZEJsYWNrU2V0LnByb3RvdHlwZS5nZXRWYWx1ZXMgPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgcmV0ID0gW107CiAgICAgICAgdGhpcy5mb3JFYWNoKGZ1bmN0aW9uKHgpIHsKICAgICAgICAgICAgcmV0LnB1c2goeCkKICAgICAgICB9KTsKICAgICAgICByZXR1cm4gcmV0CiAgICB9OwogICAganNfY29scy5SZWRCbGFja1NldC5wcm90b3R5cGUuaW5zZXJ0QWxsID0gZnVuY3Rpb24oY29sKSB7CiAgICAgICAgaWYgKGpzX2NvbHMudHlwZU9mKGNvbCkgPT0gImFycmF5IikKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjb2wubGVuZ3RoOyBpKyspIHRoaXMuaW5zZXJ0KGNvbFtpXSk7CiAgICAgICAgZWxzZSBpZiAoanNfY29scy50eXBlT2YoY29sLmZvckVhY2gpID09ICJmdW5jdGlvbiIpIGNvbC5mb3JFYWNoKHRoaXMuaW5zZXJ0LCB0aGlzKTsKICAgICAgICBlbHNlIGlmIChqc19jb2xzLnR5cGVPZihjb2wuZ2V0VmFsdWVzKSA9PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICAgIHZhciBhcnIgPSBjb2wuZ2V0VmFsdWVzKCk7CiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJyLmxlbmd0aDsgaSsrKSB0aGlzLmluc2VydChhcnJbaV0pCiAgICAgICAgfSBlbHNlIGlmIChqc19jb2xzLnR5cGVPZihjb2wpID09ICJvYmplY3QiKQogICAgICAgICAgICBmb3IgKHZhciBrZXkgaW4gY29sKSB0aGlzLmluc2VydChjb2xba2V5XSkKICAgIH07CiAgICBqc19jb2xzLlJlZEJsYWNrU2V0LnByb3RvdHlwZS5yZW1vdmVBbGwgPSBmdW5jdGlvbihjb2wpIHsKICAgICAgICBpZiAoanNfY29scy50eXBlT2YoY29sKSA9PSAiYXJyYXkiKQogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNvbC5sZW5ndGg7IGkrKykgdGhpcy5yZW1vdmUoY29sW2ldKTsKICAgICAgICBlbHNlIGlmIChqc19jb2xzLnR5cGVPZihjb2wuZm9yRWFjaCkgPT0gImZ1bmN0aW9uIikgY29sLmZvckVhY2godGhpcy5yZW1vdmVTd2FwcGVkLCB0aGlzKTsKICAgICAgICBlbHNlIGlmIChqc19jb2xzLnR5cGVPZihjb2wuZ2V0VmFsdWVzKSA9PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICAgIHZhciBhcnIgPSBjb2wuZ2V0VmFsdWVzKCk7CiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJyLmxlbmd0aDsgaSsrKSB0aGlzLnJlbW92ZShhcnJbaV0pCiAgICAgICAgfSBlbHNlIGlmIChqc19jb2xzLnR5cGVPZihjb2wpID09ICJvYmplY3QiKQogICAgICAgICAgICBmb3IgKHZhciBrZXkgaW4gY29sKSB0aGlzLnJlbW92ZShjb2xba2V5XSkKICAgIH07CiAgICBqc19jb2xzLlJlZEJsYWNrU2V0LnByb3RvdHlwZS5jb250YWluc0FsbCA9IGZ1bmN0aW9uKGNvbCkgewogICAgICAgIGlmIChqc19jb2xzLnR5cGVPZihjb2wpID09ICJhcnJheSIpIHsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjb2wubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuY29udGFpbnMoY29sW2ldKSkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgIH0gZWxzZSBpZiAoanNfY29scy50eXBlT2YoY29sLmZvckVhY2gpID09ICJmdW5jdGlvbiIpIHJldHVybiBjb2wuZXZlcnkodGhpcy5jb250YWlucywgdGhpcyk7CiAgICAgICAgZWxzZSBpZiAoanNfY29scy50eXBlT2YoY29sLmdldFZhbHVlcykgPT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICB2YXIgYXJyID0gY29sLmdldFZhbHVlcygpOwogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFyci5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICAgIGlmICghdGhpcy5jb250YWlucyhhcnJbaV0pKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgfSBlbHNlIGlmIChqc19jb2xzLnR5cGVPZihjb2wpID09ICJvYmplY3QiKSB7CiAgICAgICAgICAgIGZvciAodmFyIGtleSBpbiBjb2wpCiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuY29udGFpbnMoY29sW2tleV0pKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgfQogICAgfTsKICAgIGpzX2NvbHMuUmVkQmxhY2tTZXQucHJvdG90eXBlLnJhbmdlID0gZnVuY3Rpb24oZnJvbSwgdG8pIHsKICAgICAgICB2YXIgcmV0QXJyYXkgPSBbXTsKICAgICAgICB0aGlzLnRyYXZlcnNlRnJvbVRvKGZ1bmN0aW9uKHgpIHsKICAgICAgICAgICAgcmV0QXJyYXkucHVzaCh4KQogICAgICAgIH0sIGZyb20sIHRvKTsKICAgICAgICByZXR1cm4gcmV0QXJyYXkKICAgIH07CiAgICBqc19jb2xzLlJlZEJsYWNrU2V0LnByb3RvdHlwZS50cmF2ZXJzZSA9IGZ1bmN0aW9uKGYsIG9wdF9vYmopIHsKICAgICAgICBpZiAodGhpcy5pc0VtcHR5KCkpIHJldHVybjsKICAgICAgICB2YXIgbm9kZSA9IHRoaXMubWluKHRoaXMucm9vdCk7CiAgICAgICAgd2hpbGUgKG5vZGUgIT0gdGhpcy5zZW50aW5lbCkgewogICAgICAgICAgICBpZiAoZi5jYWxsKG9wdF9vYmosIG5vZGUua2V5LCB0aGlzKSkgcmV0dXJuOwogICAgICAgICAgICBub2RlID0gdGhpcy5zdWNjZXNzb3JfKG5vZGUpCiAgICAgICAgfQogICAgfTsKICAgIGpzX2NvbHMuUmVkQmxhY2tTZXQucHJvdG90eXBlLnRyYXZlcnNlRnJvbSA9IGZ1bmN0aW9uKGYsIGZyb21LZXksIG9wdF9vYmopIHsKICAgICAgICBpZiAodGhpcy5pc0VtcHR5KCkpIHJldHVybjsKICAgICAgICB2YXIgbm9kZSA9IHRoaXMuZ2V0Xyhmcm9tS2V5KTsKICAgICAgICB3aGlsZSAobm9kZSAhPSB0aGlzLnNlbnRpbmVsKSB7CiAgICAgICAgICAgIGlmIChmLmNhbGwob3B0X29iaiwgbm9kZS5rZXksIHRoaXMpKSByZXR1cm47CiAgICAgICAgICAgIG5vZGUgPSB0aGlzLnN1Y2Nlc3Nvcl8obm9kZSkKICAgICAgICB9CiAgICB9OwogICAganNfY29scy5SZWRCbGFja1NldC5wcm90b3R5cGUudHJhdmVyc2VUbyA9IGZ1bmN0aW9uKGYsIHRvS2V5LCBvcHRfb2JqKSB7CiAgICAgICAgaWYgKHRoaXMuaXNFbXB0eSgpKSByZXR1cm47CiAgICAgICAgdmFyIG5vZGUgPSB0aGlzLm1pbih0aGlzLnJvb3QpOwogICAgICAgIHZhciB0b05vZGUgPSB0aGlzLmdldF8odG9LZXkpOwogICAgICAgIHdoaWxlIChub2RlICE9IHRvTm9kZSkgewogICAgICAgICAgICBpZiAoZi5jYWxsKG9wdF9vYmosIG5vZGUua2V5LCB0aGlzKSkgcmV0dXJuOwogICAgICAgICAgICBub2RlID0gdGhpcy5zdWNjZXNzb3JfKG5vZGUpCiAgICAgICAgfQogICAgfTsKICAgIGpzX2NvbHMuUmVkQmxhY2tTZXQucHJvdG90eXBlLnRyYXZlcnNlRnJvbVRvID0gZnVuY3Rpb24oZiwgZnJvbUtleSwgdG9LZXksIG9wdF9vYmopIHsKICAgICAgICBpZiAodGhpcy5pc0VtcHR5KCkpIHJldHVybjsKICAgICAgICB2YXIgbm9kZSA9IHRoaXMuZ2V0Xyhmcm9tS2V5KTsKICAgICAgICB2YXIgdG9Ob2RlID0gdGhpcy5nZXRfKHRvS2V5KTsKICAgICAgICB3aGlsZSAobm9kZSAhPSB0b05vZGUpIHsKICAgICAgICAgICAgaWYgKGYuY2FsbChvcHRfb2JqLCBub2RlLmtleSwgdGhpcykpIHJldHVybjsKICAgICAgICAgICAgbm9kZSA9IHRoaXMuc3VjY2Vzc29yXyhub2RlKQogICAgICAgIH0KICAgIH07CiAgICBqc19jb2xzLlJlZEJsYWNrU2V0LnByb3RvdHlwZS50cmF2ZXJzZUJhY2t3YXJkcyA9IGZ1bmN0aW9uKGYsIG9wdF9vYmopIHsKICAgICAgICBpZiAodGhpcy5pc0VtcHR5KCkpIHJldHVybjsKICAgICAgICB2YXIgbm9kZSA9IHRoaXMubWF4KHRoaXMucm9vdCk7CiAgICAgICAgd2hpbGUgKG5vZGUgIT0gdGhpcy5zZW50aW5lbCkgewogICAgICAgICAgICBpZiAoZi5jYWxsKG9wdF9vYmosIG5vZGUua2V5LCB0aGlzKSkgcmV0dXJuOwogICAgICAgICAgICBub2RlID0gdGhpcy5wcmVkZWNjZXNzb3JfKG5vZGUpCiAgICAgICAgfQogICAgfTsKICAgIGpzX2NvbHMuUmVkQmxhY2tTZXQucHJvdG90eXBlLmZvckVhY2ggPSBmdW5jdGlvbihmLCBvcHRfb2JqKSB7CiAgICAgICAgaWYgKHRoaXMuaXNFbXB0eSgpKSByZXR1cm47CiAgICAgICAgZm9yICh2YXIgbiA9IHRoaXMubWluKHRoaXMucm9vdCk7IG4gIT0gdGhpcy5zZW50aW5lbDsgbiA9IHRoaXMuc3VjY2Vzc29yXyhuKSkgZi5jYWxsKG9wdF9vYmosIG4ua2V5LCBuLmtleSwgdGhpcykKICAgIH07CiAgICBqc19jb2xzLlJlZEJsYWNrU2V0LnByb3RvdHlwZS5zb21lID0gZnVuY3Rpb24oZiwgb3B0X29iaikgewogICAgICAgIGlmICh0aGlzLmlzRW1wdHkoKSkgcmV0dXJuIGZhbHNlOwogICAgICAgIGZvciAodmFyIG4gPSB0aGlzLm1pbih0aGlzLnJvb3QpOyBuICE9IHRoaXMuc2VudGluZWw7IG4gPSB0aGlzLnN1Y2Nlc3Nvcl8obikpCiAgICAgICAgICAgIGlmIChmLmNhbGwob3B0X29iaiwgbi5rZXksIG4ua2V5LCB0aGlzKSkgcmV0dXJuIHRydWU7CiAgICAgICAgcmV0dXJuIGZhbHNlCiAgICB9OwogICAganNfY29scy5SZWRCbGFja1NldC5wcm90b3R5cGUuZXZlcnkgPSBmdW5jdGlvbihmLCBvcHRfb2JqKSB7CiAgICAgICAgaWYgKHRoaXMuaXNFbXB0eSgpKSByZXR1cm4gZmFsc2U7CiAgICAgICAgZm9yICh2YXIgbiA9IHRoaXMubWluKHRoaXMucm9vdCk7IG4gIT0gdGhpcy5zZW50aW5lbDsgbiA9IHRoaXMuc3VjY2Vzc29yXyhuKSkKICAgICAgICAgICAgaWYgKCFmLmNhbGwob3B0X29iaiwgbi5rZXksIG4ua2V5LCB0aGlzKSkgcmV0dXJuIGZhbHNlOwogICAgICAgIHJldHVybiB0cnVlCiAgICB9OwogICAganNfY29scy5SZWRCbGFja1NldC5wcm90b3R5cGUubWFwID0gZnVuY3Rpb24oZiwgb3B0X29iaikgewogICAgICAgIHZhciBydiA9IFtdOwogICAgICAgIGlmICh0aGlzLmlzRW1wdHkoKSkgcmV0dXJuIHJ2OwogICAgICAgIGZvciAodmFyIG4gPSB0aGlzLm1pbih0aGlzLnJvb3QpOyBuICE9IHRoaXMuc2VudGluZWw7IG4gPSB0aGlzLnN1Y2Nlc3Nvcl8obikpIHJ2LnB1c2goZi5jYWxsKG9wdF9vYmosIG4ua2V5LCBuLmtleSwgdGhpcykpOwogICAgICAgIHJldHVybiBydgogICAgfTsKICAgIGpzX2NvbHMuUmVkQmxhY2tTZXQucHJvdG90eXBlLmZpbHRlciA9IGZ1bmN0aW9uKGYsIG9wdF9vYmopIHsKICAgICAgICB2YXIgcnYgPSBbXTsKICAgICAgICBpZiAodGhpcy5pc0VtcHR5KCkpIHJldHVybiBydjsKICAgICAgICBmb3IgKHZhciBuID0gdGhpcy5taW4odGhpcy5yb290KTsgbiAhPSB0aGlzLnNlbnRpbmVsOyBuID0gdGhpcy5zdWNjZXNzb3JfKG4pKQogICAgICAgICAgICBpZiAoZi5jYWxsKG9wdF9vYmosIG4ua2V5LCBuLmtleSwgdGhpcykpIHJ2LnB1c2gobi5rZXkpOwogICAgICAgIHJldHVybiBydgogICAgfTsKICAgIGpzX2NvbHMuUmVkQmxhY2tTZXQucHJvdG90eXBlLmdldENvdW50ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuc2l6ZQogICAgfTsKICAgIGpzX2NvbHMuUmVkQmxhY2tTZXQucHJvdG90eXBlLmlzRW1wdHkgPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5zaXplID09IDAKICAgIH07CiAgICBqc19jb2xzLlJlZEJsYWNrU2V0LnByb3RvdHlwZS5pc1N1YnNldE9mID0gZnVuY3Rpb24oY29sKSB7CiAgICAgICAgdmFyIGNvbENvdW50ID0ganNfY29scy5nZXRDb3VudChjb2wpOwogICAgICAgIGlmICh0aGlzLmdldENvdW50KCkgPiBjb2xDb3VudCkgcmV0dXJuIGZhbHNlOwogICAgICAgIHZhciBpID0gMDsKICAgICAgICBpZiAodGhpcy5pc0VtcHR5KCkpIHJldHVybiB0cnVlOwogICAgICAgIGZvciAodmFyIG4gPSB0aGlzLm1pbih0aGlzLnJvb3QpOyBuICE9IHRoaXMuc2VudGluZWw7IG4gPSB0aGlzLnN1Y2Nlc3Nvcl8obikpCiAgICAgICAgICAgIGlmIChqc19jb2xzLmNvbnRhaW5zLmNhbGwoY29sLCBjb2wsIG4ua2V5KSkgaSsrOwogICAgICAgIHJldHVybiBpID09IHRoaXMuZ2V0Q291bnQoKQogICAgfTsKICAgIGpzX2NvbHMuUmVkQmxhY2tTZXQucHJvdG90eXBlLmludGVyc2VjdGlvbiA9IGZ1bmN0aW9uKGNvbCkgewogICAgICAgIHZhciByZXN1bHQgPSBuZXcganNfY29scy5SZWRCbGFja1NldCh0aGlzLmNvbXBhcmUpOwogICAgICAgIGlmICh0aGlzLmlzRW1wdHkoKSkgcmV0dXJuIHJlc3VsdDsKICAgICAgICBmb3IgKHZhciBuID0gdGhpcy5taW4odGhpcy5yb290KTsgbiAhPSB0aGlzLnNlbnRpbmVsOyBuID0gdGhpcy5zdWNjZXNzb3JfKG4pKQogICAgICAgICAgICBpZiAoY29sLmNvbnRhaW5zLmNhbGwoY29sLCBuLmtleSwgbi5rZXksIHRoaXMpKSByZXN1bHQuaW5zZXJ0KG4ua2V5KTsKICAgICAgICByZXR1cm4gcmVzdWx0CiAgICB9OwogICAgQzMuUmVkQmxhY2tTZXQgPSBjbGFzcyBSZWRCbGFja1NldCBleHRlbmRzIEMzLkRlZmVuZGVkQmFzZSB7CiAgICAgICAgY29uc3RydWN0b3Ioc29ydEZ1bmMpIHsKICAgICAgICAgICAgc3VwZXIoKTsKICAgICAgICAgICAgdGhpcy5fcmJTZXQgPSBuZXcganNfY29scy5SZWRCbGFja1NldChzb3J0RnVuYyk7CiAgICAgICAgICAgIHRoaXMuX2VuYWJsZVF1ZXVlID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX3F1ZXVlSW5zZXJ0ID0gbmV3IFNldDsKICAgICAgICAgICAgdGhpcy5fcXVldWVSZW1vdmUgPSBuZXcgU2V0CiAgICAgICAgfQogICAgICAgIEFkZChpdGVtKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9lbmFibGVRdWV1ZSkKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9yYlNldC5jb250YWlucyhpdGVtKSkgdGhpcy5fcXVldWVSZW1vdmUuZGVsZXRlKGl0ZW0pOwogICAgICAgICAgICAgICAgZWxzZSB0aGlzLl9xdWV1ZUluc2VydC5hZGQoaXRlbSk7CiAgICAgICAgICAgIGVsc2UgdGhpcy5fcmJTZXQuaW5zZXJ0KGl0ZW0pCiAgICAgICAgfQogICAgICAgIFJlbW92ZShpdGVtKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9lbmFibGVRdWV1ZSkKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9yYlNldC5jb250YWlucyhpdGVtKSkgdGhpcy5fcXVldWVSZW1vdmUuYWRkKGl0ZW0pOwogICAgICAgICAgICAgICAgZWxzZSB0aGlzLl9xdWV1ZUluc2VydC5kZWxldGUoaXRlbSk7CiAgICAgICAgICAgIGVsc2UgdGhpcy5fcmJTZXQucmVtb3ZlKGl0ZW0pCiAgICAgICAgfQogICAgICAgIEhhcyhpdGVtKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9lbmFibGVRdWV1ZSkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuX3F1ZXVlSW5zZXJ0LmhhcyhpdGVtKSkgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICByZXR1cm4gIXRoaXMuX3F1ZXVlUmVtb3ZlLmhhcyhpdGVtKSAmJiB0aGlzLl9yYlNldC5jb250YWlucyhpdGVtKQogICAgICAgICAgICB9IGVsc2UgcmV0dXJuIHRoaXMuX3JiU2V0LmNvbnRhaW5zKGl0ZW0pCiAgICAgICAgfQogICAgICAgIENsZWFyKCkgewogICAgICAgICAgICB0aGlzLl9yYlNldC5jbGVhcigpOwogICAgICAgICAgICB0aGlzLl9xdWV1ZUluc2VydC5jbGVhcigpOwogICAgICAgICAgICB0aGlzLl9xdWV1ZVJlbW92ZS5jbGVhcigpCiAgICAgICAgfQogICAgICAgIHRvQXJyYXkoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9lbmFibGVRdWV1ZSkgdGhyb3cgbmV3IEVycm9yKCJjYW5ub3QgYmUgdXNlZCBpbiBxdWV1ZWluZyBtb2RlIik7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9yYlNldC5nZXRWYWx1ZXMoKQogICAgICAgIH0KICAgICAgICBHZXRTaXplKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fcmJTZXQuZ2V0Q291bnQoKSArIHRoaXMuX3F1ZXVlSW5zZXJ0LnNpemUgLSB0aGlzLl9xdWV1ZVJlbW92ZS5zaXplCiAgICAgICAgfQogICAgICAgIElzRW1wdHkoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLkdldFNpemUoKSA9PT0gMAogICAgICAgIH0KICAgICAgICBGcm9udCgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuSXNFbXB0eSgpKSB0aHJvdyBuZXcgRXJyb3IoImVtcHR5IHNldCIpOwogICAgICAgICAgICBpZiAodGhpcy5fZW5hYmxlUXVldWUpIHRocm93IG5ldyBFcnJvcigiY2Fubm90IGJlIHVzZWQgaW4gcXVldWVpbmcgbW9kZSIpOwogICAgICAgICAgICBjb25zdCByYlNldCA9IHRoaXMuX3JiU2V0OwogICAgICAgICAgICBjb25zdCBuID0gcmJTZXQubWluKHJiU2V0LnJvb3QpOwogICAgICAgICAgICByZXR1cm4gbi5rZXkKICAgICAgICB9CiAgICAgICAgU2hpZnQoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLklzRW1wdHkoKSkgdGhyb3cgbmV3IEVycm9yKCJlbXB0eSBzZXQiKTsKICAgICAgICAgICAgaWYgKHRoaXMuX2VuYWJsZVF1ZXVlKSB0aHJvdyBuZXcgRXJyb3IoImNhbm5vdCBiZSB1c2VkIGluIHF1ZXVlaW5nIG1vZGUiKTsKICAgICAgICAgICAgY29uc3QgaXRlbSA9IHRoaXMuRnJvbnQoKTsKICAgICAgICAgICAgdGhpcy5SZW1vdmUoaXRlbSk7CiAgICAgICAgICAgIHJldHVybiBpdGVtCiAgICAgICAgfQogICAgICAgIFNldFF1ZXVlaW5nRW5hYmxlZChxKSB7CiAgICAgICAgICAgIHEgPSAhIXE7CiAgICAgICAgICAgIGlmICh0aGlzLl9lbmFibGVRdWV1ZSA9PT0gcSkgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl9lbmFibGVRdWV1ZSA9IHE7CiAgICAgICAgICAgIGlmICghcSkgewogICAgICAgICAgICAgICAgZm9yIChjb25zdCBpdGVtIG9mIHRoaXMuX3F1ZXVlUmVtb3ZlKSB0aGlzLl9yYlNldC5yZW1vdmUoaXRlbSk7CiAgICAgICAgICAgICAgICB0aGlzLl9xdWV1ZVJlbW92ZS5jbGVhcigpOwogICAgICAgICAgICAgICAgZm9yIChjb25zdCBpdGVtIG9mIHRoaXMuX3F1ZXVlSW5zZXJ0KSB0aGlzLl9yYlNldC5pbnNlcnQoaXRlbSk7CiAgICAgICAgICAgICAgICB0aGlzLl9xdWV1ZUluc2VydC5jbGVhcigpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgRm9yRWFjaChmdW5jKSB7CiAgICAgICAgICAgIHRoaXMuX3JiU2V0LmZvckVhY2goZnVuYykKICAgICAgICB9KiB2YWx1ZXMoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLklzRW1wdHkoKSkgcmV0dXJuOwogICAgICAgICAgICBjb25zdCByYlNldCA9IHRoaXMuX3JiU2V0OwogICAgICAgICAgICBmb3IgKGxldCBuID0gcmJTZXQubWluKHJiU2V0LnJvb3QpOyBuICE9IHJiU2V0LnNlbnRpbmVsOyBuID0gcmJTZXQuc3VjY2Vzc29yXyhuKSkgeWllbGQgbi5rZXkKICAgICAgICB9W1N5bWJvbC5pdGVyYXRvcl0oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnZhbHVlcygpCiAgICAgICAgfQogICAgfTsKCn0KCi8vIC4uL2xpYi91dGlsL3Byb21pc2VUaHJvdHRsZS5qcwp7CiAgICAndXNlIHN0cmljdCc7CiAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICBDMy5Qcm9taXNlVGhyb3R0bGUgPSBjbGFzcyBQcm9taXNlVGhyb3R0bGUgewogICAgICAgIGNvbnN0cnVjdG9yKG1heFBhcmFsbGVsID0gQzMuaGFyZHdhcmVDb25jdXJyZW5jeSkgewogICAgICAgICAgICB0aGlzLl9tYXhQYXJhbGxlbCA9IG1heFBhcmFsbGVsOwogICAgICAgICAgICB0aGlzLl9xdWV1ZSA9IFtdOwogICAgICAgICAgICB0aGlzLl9hY3RpdmVDb3VudCA9IDAKICAgICAgICB9CiAgICAgICAgQWRkKGZ1bmMpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKICAgICAgICAgICAgICAgIHRoaXMuX3F1ZXVlLnB1c2goewogICAgICAgICAgICAgICAgICAgIGZ1bmMsCiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSwKICAgICAgICAgICAgICAgICAgICByZWplY3QKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgdGhpcy5fTWF5YmVTdGFydE5leHQoKQogICAgICAgICAgICB9KQogICAgICAgIH0KICAgICAgICBfRmluZEluUXVldWUoZnVuYykgewogICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gdGhpcy5fcXVldWUubGVuZ3RoOyBpIDwgbGVuOyArK2kpCiAgICAgICAgICAgICAgICBpZiAodGhpcy5fcXVldWVbaV0uZnVuYyA9PT0gZnVuYykgcmV0dXJuIGk7CiAgICAgICAgICAgIHJldHVybiAtMQogICAgICAgIH0KICAgICAgICBSZW1vdmVBbmRSZXNvbHZlKGZ1bmMsIHZhbHVlKSB7CiAgICAgICAgICAgIGNvbnN0IGkgPSB0aGlzLl9GaW5kSW5RdWV1ZShmdW5jKTsKICAgICAgICAgICAgaWYgKGkgPT09IC0xKSB0aHJvdyBuZXcgRXJyb3IoImNhbm5vdCBmaW5kIHByb21pc2UgdG8gcmVzb2x2ZSIpOwogICAgICAgICAgICB0aGlzLl9xdWV1ZVtpXS5yZXNvbHZlKHZhbHVlKTsKICAgICAgICAgICAgdGhpcy5fcXVldWUuc3BsaWNlKGksIDEpCiAgICAgICAgfQogICAgICAgIFJlbW92ZUFuZFJlamVjdChmdW5jLCB2YWx1ZSkgewogICAgICAgICAgICBjb25zdCBpID0gdGhpcy5fRmluZEluUXVldWUoZnVuYyk7CiAgICAgICAgICAgIGlmIChpID09PSAtMSkgdGhyb3cgbmV3IEVycm9yKCJjYW5ub3QgZmluZCBwcm9taXNlIHRvIHJlamVjdCIpOwogICAgICAgICAgICB0aGlzLl9xdWV1ZVtpXS5yZWplY3QodmFsdWUpOwogICAgICAgICAgICB0aGlzLl9xdWV1ZS5zcGxpY2UoaSwgMSkKICAgICAgICB9CiAgICAgICAgYXN5bmMgX01heWJlU3RhcnROZXh0KCkgewogICAgICAgICAgICBpZiAoIXRoaXMuX3F1ZXVlLmxlbmd0aCkgcmV0dXJuOwogICAgICAgICAgICBpZiAodGhpcy5fYWN0aXZlQ291bnQgPj0gdGhpcy5fbWF4UGFyYWxsZWwpIHJldHVybjsKICAgICAgICAgICAgdGhpcy5fYWN0aXZlQ291bnQrKzsKICAgICAgICAgICAgY29uc3Qgam9iID0gdGhpcy5fcXVldWUuc2hpZnQoKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGpvYi5mdW5jKCk7CiAgICAgICAgICAgICAgICBqb2IucmVzb2x2ZShyZXN1bHQpCiAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgam9iLnJlamVjdChlcnIpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5fYWN0aXZlQ291bnQtLTsKICAgICAgICAgICAgdGhpcy5fTWF5YmVTdGFydE5leHQoKQogICAgICAgIH0KICAgICAgICBzdGF0aWMgYXN5bmMgQmF0Y2goY29uY3VycmVuY3ksCiAgICAgICAgICAgIG1ldGhvZHMpIHsKICAgICAgICAgICAgY29uc3QgcmVzdWx0cyA9IFtdOwogICAgICAgICAgICBsZXQgZmFpbGVkID0gZmFsc2U7CiAgICAgICAgICAgIGNvbnN0IGV4ZWN1dGUgPSBhc3luYyBfID0+IHsKICAgICAgICAgICAgICAgIGxldCBmbjsKICAgICAgICAgICAgICAgIHdoaWxlIChmbiA9IG1ldGhvZHMucG9wKCkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZmFpbGVkKSByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0cy5wdXNoKGF3YWl0IGZuKCkpCiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgICAgICAgICBmYWlsZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICAgICAgY29uc3QgcHJvbWlzZXMgPSBbXTsKICAgICAgICAgICAgd2hpbGUgKGNvbmN1cnJlbmN5LS0pIHByb21pc2VzLnB1c2goZXhlY3V0ZSgpKTsKICAgICAgICAgICAgYXdhaXQgUHJvbWlzZS5hbGwocHJvbWlzZXMpOwogICAgICAgICAgICByZXR1cm4gcmVzdWx0cwogICAgICAgIH0KICAgIH07Cgp9CgovLyAuLi9saWIvdXRpbC9yYXRlTGltaXRlci5qcwp7CiAgICAndXNlIHN0cmljdCc7CiAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICBDMy5SYXRlTGltaXRlciA9IGNsYXNzIFJhdGVMaW1pdGVyIHsKICAgICAgICBjb25zdHJ1Y3RvcihjYWxsYmFjaywgaW50ZXJ2YWwsIGludGVydmFsT25CYXR0ZXJ5KSB7CiAgICAgICAgICAgIHRoaXMuX2NhbGxiYWNrID0gY2FsbGJhY2s7CiAgICAgICAgICAgIHRoaXMuX2ludGVydmFsID0gaW50ZXJ2YWw7CiAgICAgICAgICAgIHRoaXMuX2ludGVydmFsT25CYXR0ZXJ5ID0gaW50ZXJ2YWxPbkJhdHRlcnkgfHwgaW50ZXJ2YWwgKiAyOwogICAgICAgICAgICB0aGlzLl90aW1lcklkID0gLTE7CiAgICAgICAgICAgIHRoaXMuX2xhc3RDYWxsVGltZSA9IC1JbmZpbml0eTsKICAgICAgICAgICAgdGhpcy5fdGltZXJDYWxsRnVuYyA9ICgpID0+IHRoaXMuX09uVGltZXIoKTsKICAgICAgICAgICAgdGhpcy5faWdub3JlUmVzZXQgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5fY2FuUnVuSW1tZWRpYXRlID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX2NhbGxiYWNrQXJndW1lbnRzID0gbnVsbAogICAgICAgIH0KICAgICAgICBTZXRDYW5SdW5JbW1lZGlhdGUoYykgewogICAgICAgICAgICB0aGlzLl9jYW5SdW5JbW1lZGlhdGUgPSAhIWMKICAgICAgICB9CiAgICAgICAgX0dldEludGVydmFsKCkgewogICAgICAgICAgICBpZiAodHlwZW9mIEMzLkJhdHRlcnkgIT09ICJ1bmRlZmluZWQiICYmIEMzLkJhdHRlcnkuSXNPbkJhdHRlcnlQb3dlcigpKSByZXR1cm4gdGhpcy5faW50ZXJ2YWxPbkJhdHRlcnk7CiAgICAgICAgICAgIGVsc2UgcmV0dXJuIHRoaXMuX2ludGVydmFsCiAgICAgICAgfQogICAgICAgIENhbGwoLi4uYXJncykgewogICAgICAgICAgICBpZiAodGhpcy5fdGltZXJJZCAhPT0KICAgICAgICAgICAgICAgIC0xKSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuX2NhbGxiYWNrQXJndW1lbnRzID0gYXJnczsKICAgICAgICAgICAgbGV0IG5vd1RpbWUgPSBDMy5GYXN0R2V0RGF0ZU5vdygpOwogICAgICAgICAgICBsZXQgdGltZVNpbmNlTGFzdENhbGwgPSBub3dUaW1lIC0gdGhpcy5fbGFzdENhbGxUaW1lOwogICAgICAgICAgICBsZXQgaW50ZXJ2YWwgPSB0aGlzLl9HZXRJbnRlcnZhbCgpOwogICAgICAgICAgICBpZiAodGltZVNpbmNlTGFzdENhbGwgPj0gaW50ZXJ2YWwgJiYgdGhpcy5fY2FuUnVuSW1tZWRpYXRlKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9sYXN0Q2FsbFRpbWUgPSBub3dUaW1lOwogICAgICAgICAgICAgICAgdGhpcy5fUnVuQ2FsbGJhY2soKQogICAgICAgICAgICB9IGVsc2UgdGhpcy5fdGltZXJJZCA9IHNlbGYuc2V0VGltZW91dCh0aGlzLl90aW1lckNhbGxGdW5jLCBNYXRoLm1heChpbnRlcnZhbCAtIHRpbWVTaW5jZUxhc3RDYWxsLCA0KSkKICAgICAgICB9CiAgICAgICAgX1J1bkNhbGxiYWNrKCkgewogICAgICAgICAgICB0aGlzLl9pZ25vcmVSZXNldCA9IHRydWU7CiAgICAgICAgICAgIGNvbnN0IGFyZ3MgPSB0aGlzLl9jYWxsYmFja0FyZ3VtZW50czsKICAgICAgICAgICAgdGhpcy5fY2FsbGJhY2tBcmd1bWVudHMgPSBudWxsOwogICAgICAgICAgICBpZiAoYXJncykgdGhpcy5fY2FsbGJhY2soLi4uYXJncyk7CiAgICAgICAgICAgIGVsc2UgdGhpcy5fY2FsbGJhY2soKTsKICAgICAgICAgICAgdGhpcy5faWdub3JlUmVzZXQgPSBmYWxzZQogICAgICAgIH0KICAgICAgICBSZXNldCgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX2lnbm9yZVJlc2V0KSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuX0NhbmNlbFRpbWVyKCk7CiAgICAgICAgICAgIHRoaXMuX2NhbGxiYWNrQXJndW1lbnRzID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fbGFzdENhbGxUaW1lID0gQzMuRmFzdEdldERhdGVOb3coKQogICAgICAgIH0KICAgICAgICBfT25UaW1lcigpIHsKICAgICAgICAgICAgdGhpcy5fdGltZXJJZCA9IC0xOwogICAgICAgICAgICB0aGlzLl9sYXN0Q2FsbFRpbWUgPSBDMy5GYXN0R2V0RGF0ZU5vdygpOwogICAgICAgICAgICB0aGlzLl9SdW5DYWxsYmFjaygpCiAgICAgICAgfQogICAgICAgIF9DYW5jZWxUaW1lcigpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX3RpbWVySWQgIT09IC0xKSB7CiAgICAgICAgICAgICAgICBzZWxmLmNsZWFyVGltZW91dCh0aGlzLl90aW1lcklkKTsKICAgICAgICAgICAgICAgIHRoaXMuX3RpbWVySWQgPSAtMQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIFJlbGVhc2UoKSB7CiAgICAgICAgICAgIHRoaXMuX0NhbmNlbFRpbWVyKCk7CiAgICAgICAgICAgIHRoaXMuX2NhbGxiYWNrID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fY2FsbGJhY2tBcmd1bWVudHMgPSBudWxsOwogICAgICAgICAgICB0aGlzLl90aW1lckNhbGxGdW5jID0gbnVsbAogICAgICAgIH0KICAgIH07Cgp9CgovLyAuLi9saWIvdXRpbC9zdmdSYXN0ZXIvc3ZnUmFzdGVyTWFuYWdlci5qcwp7CiAgICAndXNlIHN0cmljdCc7CiAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICBDMy5TVkdSYXN0ZXJNYW5hZ2VyID0gY2xhc3MgU1ZHUmFzdGVyTWFuYWdlciB7CiAgICAgICAgY29uc3RydWN0b3IoKSB7CiAgICAgICAgICAgIHRoaXMuX2ltYWdlcyA9IG5ldyBNYXA7CiAgICAgICAgICAgIHRoaXMuX2FsbG93TnBvdFN1cmZhY2VzID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX2dldEJhc2VTaXplQ2FsbGJhY2sgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9yYXN0ZXJBdFNpemVDYWxsYmFjayA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3JlbGVhc2VSZXN1bHRDYWxsYmFjayA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3JlZHJhd0NhbGxiYWNrID0gbnVsbAogICAgICAgIH0KICAgICAgICBTZXROcG90U3VyZmFjZUFsbG93ZWQoYSkgewogICAgICAgICAgICB0aGlzLl9hbGxvd05wb3RTdXJmYWNlcyA9ICEhYQogICAgICAgIH0KICAgICAgICBJc05wb3RTdXJmYWNlQWxsb3dlZCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2FsbG93TnBvdFN1cmZhY2VzCiAgICAgICAgfQogICAgICAgIFNldEdldEJhc2VTaXplQ2FsbGJhY2soZikgewogICAgICAgICAgICB0aGlzLl9nZXRCYXNlU2l6ZUNhbGxiYWNrID0gZgogICAgICAgIH0KICAgICAgICBHZXRCYXNlU2l6ZShkYXRhU291cmNlKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5fZ2V0QmFzZVNpemVDYWxsYmFjaykgdGhyb3cgbmV3IEVycm9yKCJubyBnZXQgYmFzZSBzaXplIGNhbGxiYWNrIHNldCIpOwogICAgICAgICAgICByZXR1cm4gdGhpcy5fZ2V0QmFzZVNpemVDYWxsYmFjayhkYXRhU291cmNlKQogICAgICAgIH0KICAgICAgICBTZXRSYXN0ZXJBdFNpemVDYWxsYmFjayhmKSB7CiAgICAgICAgICAgIHRoaXMuX3Jhc3RlckF0U2l6ZUNhbGxiYWNrID0KICAgICAgICAgICAgICAgIGYKICAgICAgICB9CiAgICAgICAgUmFzdGVyQXRTaXplKGRhdGFTb3VyY2UsIGNvbnRleHQsIHN1cmZhY2VXaWR0aCwgc3VyZmFjZUhlaWdodCwgaW1hZ2VXaWR0aCwgaW1hZ2VIZWlnaHQpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLl9yYXN0ZXJBdFNpemVDYWxsYmFjaykgdGhyb3cgbmV3IEVycm9yKCJubyByYXN0ZXIgYXQgc2l6ZSBjYWxsYmFjayBzZXQiKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3Jhc3RlckF0U2l6ZUNhbGxiYWNrKGRhdGFTb3VyY2UsIGNvbnRleHQsIHN1cmZhY2VXaWR0aCwgc3VyZmFjZUhlaWdodCwgaW1hZ2VXaWR0aCwgaW1hZ2VIZWlnaHQpCiAgICAgICAgfQogICAgICAgIFNldFJlbGVhc2VSZXN1bHRDYWxsYmFjayhmKSB7CiAgICAgICAgICAgIHRoaXMuX3JlbGVhc2VSZXN1bHRDYWxsYmFjayA9IGYKICAgICAgICB9CiAgICAgICAgUmVsZWFzZVJlc3VsdChyYXN0ZXJpemVkUmVzdWx0KSB7CiAgICAgICAgICAgIGlmICghdGhpcy5fcmVsZWFzZVJlc3VsdENhbGxiYWNrKSB0aHJvdyBuZXcgRXJyb3IoIm5vIHJlbGVhc2UgcmVzdWx0IGNhbGxiYWNrIHNldCIpOwogICAgICAgICAgICB0aGlzLl9yZWxlYXNlUmVzdWx0Q2FsbGJhY2socmFzdGVyaXplZFJlc3VsdCkKICAgICAgICB9CiAgICAgICAgU2V0UmVkcmF3Q2FsbGJhY2soZikgewogICAgICAgICAgICB0aGlzLl9yZWRyYXdDYWxsYmFjayA9CiAgICAgICAgICAgICAgICBmCiAgICAgICAgfQogICAgICAgIFJlZHJhdygpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLl9yZWRyYXdDYWxsYmFjaykgdGhyb3cgbmV3IEVycm9yKCJubyByZWRyYXcgY2FsbGJhY2sgc2V0Iik7CiAgICAgICAgICAgIHRoaXMuX3JlZHJhd0NhbGxiYWNrKCkKICAgICAgICB9CiAgICAgICAgQWRkSW1hZ2UoZGF0YVNvdXJjZSkgewogICAgICAgICAgICBsZXQgcmV0ID0gdGhpcy5faW1hZ2VzLmdldChkYXRhU291cmNlKTsKICAgICAgICAgICAgaWYgKCFyZXQpIHsKICAgICAgICAgICAgICAgIHJldCA9IEMzLk5ldyhDMy5TVkdSYXN0ZXJJbWFnZSwgdGhpcywgZGF0YVNvdXJjZSk7CiAgICAgICAgICAgICAgICB0aGlzLl9pbWFnZXMuc2V0KGRhdGFTb3VyY2UsIHJldCkKICAgICAgICAgICAgfQogICAgICAgICAgICByZXQuSW5jUmVmZXJlbmNlKCk7CiAgICAgICAgICAgIHJldHVybiByZXQKICAgICAgICB9CiAgICAgICAgX1JlbW92ZUltYWdlKHJpKSB7CiAgICAgICAgICAgIHRoaXMuX2ltYWdlcy5kZWxldGUocmkuR2V0RGF0YVNvdXJjZSgpKQogICAgICAgIH0KICAgICAgICBPblRleHR1cmVzQ2hhbmdlZCgpIHsKICAgICAgICAgICAgZm9yIChjb25zdCByaSBvZiB0aGlzLl9pbWFnZXMudmFsdWVzKCkpIHsKICAgICAgICAgICAgICAgIHJpLlJlbGVhc2VSYXN0ZXJpemVkUmVzdWx0KCk7CiAgICAgICAgICAgICAgICByaS5Gb3JjZVJhc3RlckFnYWluKCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07Cgp9CgovLyAuLi9saWIvdXRpbC9zdmdSYXN0ZXIvc3ZnUmFzdGVySW1hZ2UuanMKewogICAgJ3VzZSBzdHJpY3QnOwogICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgY29uc3QgTUFYX1NVUkZBQ0VfU0laRSA9IDQwOTY7CiAgICBDMy5TVkdSYXN0ZXJJbWFnZSA9IGNsYXNzIFNWR1Jhc3RlckltYWdlIHsKICAgICAgICBjb25zdHJ1Y3RvcihtYW5hZ2VyLCBkYXRhU291cmNlKSB7CiAgICAgICAgICAgIHRoaXMuX21hbmFnZXIgPSBtYW5hZ2VyOwogICAgICAgICAgICB0aGlzLl9kYXRhU291cmNlID0gZGF0YVNvdXJjZTsKICAgICAgICAgICAgdGhpcy5fcmVmQ291bnQgPSAwOwogICAgICAgICAgICB0aGlzLl9iYXNlV2lkdGggPSAwOwogICAgICAgICAgICB0aGlzLl9iYXNlSGVpZ2h0ID0gMDsKICAgICAgICAgICAgdGhpcy5fZ2V0QmFzZVNpemVQcm9taXNlID0gdGhpcy5fbWFuYWdlci5HZXRCYXNlU2l6ZShkYXRhU291cmNlKS50aGVuKGJhc2VTaXplID0+IHsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5fbWFuYWdlcikgcmV0dXJuOwogICAgICAgICAgICAgICAgdGhpcy5fYmFzZVdpZHRoID0gYmFzZVNpemVbMF07CiAgICAgICAgICAgICAgICB0aGlzLl9iYXNlSGVpZ2h0ID0gYmFzZVNpemVbMV07CiAgICAgICAgICAgICAgICB0aGlzLl9tYW5hZ2VyLlJlZHJhdygpCiAgICAgICAgICAgIH0pLmNhdGNoKGVyciA9PiB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCJbU1ZHXSBFcnJvciBsb2FkaW5nIFNWRzogIiwgZXJyKTsKICAgICAgICAgICAgICAgIHRoaXMuX2hhZEVycm9yID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9tYW5hZ2VyKSB0aGlzLl9tYW5hZ2VyLlJlZHJhdygpCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0aGlzLl9yYXN0ZXJTdXJmYWNlV2lkdGggPQogICAgICAgICAgICAgICAgMDsKICAgICAgICAgICAgdGhpcy5fcmFzdGVyU3VyZmFjZUhlaWdodCA9IDA7CiAgICAgICAgICAgIHRoaXMuX3Jhc3RlckltYWdlV2lkdGggPSAwOwogICAgICAgICAgICB0aGlzLl9yYXN0ZXJJbWFnZUhlaWdodCA9IDA7CiAgICAgICAgICAgIHRoaXMuX2lzUmFzdGVyaXppbmcgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5fcmFzdGVyaXplZFJlc3VsdCA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX2ZvcmNlUmFzdGVyID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX2hhZEVycm9yID0gZmFsc2UKICAgICAgICB9CiAgICAgICAgUmVsZWFzZSgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX3JlZkNvdW50IDw9IDApIHRocm93IG5ldyBFcnJvcigiYWxyZWFkeSByZWxlYXNlZCIpOwogICAgICAgICAgICB0aGlzLl9yZWZDb3VudC0tOwogICAgICAgICAgICBpZiAodGhpcy5fcmVmQ291bnQgPT09IDApIHRoaXMuX1JlbGVhc2UoKQogICAgICAgIH0KICAgICAgICBSZWxlYXNlUmFzdGVyaXplZFJlc3VsdCgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX3Jhc3Rlcml6ZWRSZXN1bHQpIHsKICAgICAgICAgICAgICAgIHRoaXMuX21hbmFnZXIuUmVsZWFzZVJlc3VsdCh0aGlzLl9yYXN0ZXJpemVkUmVzdWx0KTsKICAgICAgICAgICAgICAgIHRoaXMuX3Jhc3Rlcml6ZWRSZXN1bHQgPSBudWxsCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgX1JlbGVhc2UoKSB7CiAgICAgICAgICAgIHRoaXMuUmVsZWFzZVJhc3Rlcml6ZWRSZXN1bHQoKTsKICAgICAgICAgICAgdGhpcy5fbWFuYWdlci5fUmVtb3ZlSW1hZ2UodGhpcyk7CiAgICAgICAgICAgIHRoaXMuX21hbmFnZXIgPSBudWxsCiAgICAgICAgfQogICAgICAgIEdldERhdGFTb3VyY2UoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9kYXRhU291cmNlCiAgICAgICAgfQogICAgICAgIEluY1JlZmVyZW5jZSgpIHsKICAgICAgICAgICAgdGhpcy5fcmVmQ291bnQrKwogICAgICAgIH0KICAgICAgICBIYXNSZWZlcmVuY2VzKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fcmVmQ291bnQgPiAwCiAgICAgICAgfQogICAgICAgIEdldFJhc3Rlcml6ZWRSZXN1bHQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9yYXN0ZXJpemVkUmVzdWx0CiAgICAgICAgfQogICAgICAgIEZvcmNlUmFzdGVyQWdhaW4oKSB7CiAgICAgICAgICAgIHRoaXMuX2ZvcmNlUmFzdGVyID0gdHJ1ZQogICAgICAgIH0KICAgICAgICBhc3luYyBTdGFydFJhc3RlckZvclNpemUoY29udGV4dCwgd2lkdGgsIGhlaWdodCkgewogICAgICAgICAgICBpZiAod2lkdGggPT09IDAgfHwgaGVpZ2h0ID09PSAwIHx8IHRoaXMuX2hhZEVycm9yKSByZXR1cm47CiAgICAgICAgICAgIGlmICh0aGlzLl9pc1Jhc3Rlcml6aW5nKSByZXR1cm47CiAgICAgICAgICAgIGxldCByYXN0ZXJTdXJmYWNlV2lkdGggPSBDMy5uZXh0SGlnaGVzdFBvd2VyT2ZUd28oTWF0aC5jZWlsKHdpZHRoKSk7CiAgICAgICAgICAgIGxldCByYXN0ZXJTdXJmYWNlSGVpZ2h0ID0gQzMubmV4dEhpZ2hlc3RQb3dlck9mVHdvKE1hdGguY2VpbChoZWlnaHQpKTsKICAgICAgICAgICAgY29uc3QgbWF4RGltID0gTWF0aC5tYXgocmFzdGVyU3VyZmFjZVdpZHRoLAogICAgICAgICAgICAgICAgcmFzdGVyU3VyZmFjZUhlaWdodCk7CiAgICAgICAgICAgIGlmIChtYXhEaW0gPiBNQVhfU1VSRkFDRV9TSVpFKSB7CiAgICAgICAgICAgICAgICBjb25zdCBzY2FsZSA9IE1BWF9TVVJGQUNFX1NJWkUgLyBtYXhEaW07CiAgICAgICAgICAgICAgICB3aWR0aCAqPSBzY2FsZTsKICAgICAgICAgICAgICAgIGhlaWdodCAqPSBzY2FsZTsKICAgICAgICAgICAgICAgIHJhc3RlclN1cmZhY2VXaWR0aCA9IE1hdGgubWluKE1hdGguY2VpbChyYXN0ZXJTdXJmYWNlV2lkdGggKiBzY2FsZSksIE1BWF9TVVJGQUNFX1NJWkUpOwogICAgICAgICAgICAgICAgcmFzdGVyU3VyZmFjZUhlaWdodCA9IE1hdGgubWluKE1hdGguY2VpbChyYXN0ZXJTdXJmYWNlSGVpZ2h0ICogc2NhbGUpLCBNQVhfU1VSRkFDRV9TSVpFKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh3aWR0aCA8IHJhc3RlclN1cmZhY2VXaWR0aCAmJiBoZWlnaHQgPCByYXN0ZXJTdXJmYWNlSGVpZ2h0KSB7CiAgICAgICAgICAgICAgICBjb25zdCBpbWFnZUFzcGVjdFJhdGlvID0gd2lkdGggLyBoZWlnaHQ7CiAgICAgICAgICAgICAgICBjb25zdCBzdXJmYWNlQXNwZWN0UmF0aW8gPSByYXN0ZXJTdXJmYWNlV2lkdGggLyByYXN0ZXJTdXJmYWNlSGVpZ2h0OwogICAgICAgICAgICAgICAgaWYgKHN1cmZhY2VBc3BlY3RSYXRpbyA+IGltYWdlQXNwZWN0UmF0aW8pIHsKICAgICAgICAgICAgICAgICAgICB3aWR0aCA9IHJhc3RlclN1cmZhY2VIZWlnaHQgKgogICAgICAgICAgICAgICAgICAgICAgICBpbWFnZUFzcGVjdFJhdGlvOwogICAgICAgICAgICAgICAgICAgIGhlaWdodCA9IHJhc3RlclN1cmZhY2VIZWlnaHQKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgd2lkdGggPSByYXN0ZXJTdXJmYWNlV2lkdGg7CiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0ID0gcmFzdGVyU3VyZmFjZVdpZHRoIC8gaW1hZ2VBc3BlY3RSYXRpbwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLl9tYW5hZ2VyLklzTnBvdFN1cmZhY2VBbGxvd2VkKCkpIHsKICAgICAgICAgICAgICAgIHJhc3RlclN1cmZhY2VXaWR0aCA9IE1hdGguY2VpbCh3aWR0aCk7CiAgICAgICAgICAgICAgICByYXN0ZXJTdXJmYWNlSGVpZ2h0ID0gTWF0aC5jZWlsKGhlaWdodCkKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAocmFzdGVyU3VyZmFjZVdpZHRoIDw9IHRoaXMuX3Jhc3RlclN1cmZhY2VXaWR0aCAmJiByYXN0ZXJTdXJmYWNlSGVpZ2h0IDw9IHRoaXMuX3Jhc3RlclN1cmZhY2VIZWlnaHQgJiYgIXRoaXMuX2ZvcmNlUmFzdGVyKSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuX2lzUmFzdGVyaXppbmcgPSB0cnVlOwogICAgICAgICAgICB0aGlzLl9yYXN0ZXJTdXJmYWNlV2lkdGggPSByYXN0ZXJTdXJmYWNlV2lkdGg7CiAgICAgICAgICAgIHRoaXMuX3Jhc3RlclN1cmZhY2VIZWlnaHQgPSByYXN0ZXJTdXJmYWNlSGVpZ2h0OwogICAgICAgICAgICBjb25zdCBuZXdSYXN0ZXJpemVkUmVzdWx0ID0gYXdhaXQgdGhpcy5fbWFuYWdlci5SYXN0ZXJBdFNpemUodGhpcy5fZGF0YVNvdXJjZSwKICAgICAgICAgICAgICAgIGNvbnRleHQsIHRoaXMuX3Jhc3RlclN1cmZhY2VXaWR0aCwgdGhpcy5fcmFzdGVyU3VyZmFjZUhlaWdodCwgd2lkdGgsIGhlaWdodCk7CiAgICAgICAgICAgIGlmICghdGhpcy5fbWFuYWdlcikgcmV0dXJuOwogICAgICAgICAgICB0aGlzLlJlbGVhc2VSYXN0ZXJpemVkUmVzdWx0KCk7CiAgICAgICAgICAgIHRoaXMuX3Jhc3Rlcml6ZWRSZXN1bHQgPSBuZXdSYXN0ZXJpemVkUmVzdWx0OwogICAgICAgICAgICB0aGlzLl9yYXN0ZXJJbWFnZVdpZHRoID0gd2lkdGg7CiAgICAgICAgICAgIHRoaXMuX3Jhc3RlckltYWdlSGVpZ2h0ID0gaGVpZ2h0OwogICAgICAgICAgICB0aGlzLl9pc1Jhc3Rlcml6aW5nID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX2ZvcmNlUmFzdGVyID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX21hbmFnZXIuUmVkcmF3KCkKICAgICAgICB9CiAgICAgICAgV2hlbkJhc2VTaXplUmVhZHkoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9nZXRCYXNlU2l6ZVByb21pc2UKICAgICAgICB9CiAgICAgICAgR2V0QmFzZVdpZHRoKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fYmFzZVdpZHRoCiAgICAgICAgfQogICAgICAgIEdldEJhc2VIZWlnaHQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9iYXNlSGVpZ2h0CiAgICAgICAgfQogICAgICAgIEdldFJhc3RlcldpZHRoKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fcmFzdGVySW1hZ2VXaWR0aAogICAgICAgIH0KICAgICAgICBHZXRSYXN0ZXJIZWlnaHQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9yYXN0ZXJJbWFnZUhlaWdodAogICAgICAgIH0KICAgICAgICBIYWRFcnJvcigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2hhZEVycm9yCiAgICAgICAgfQogICAgfTsKCn0KCi8vIC4uL2xpYi9zdHIvc3RyLmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIEMzLlVURjhfQk9NID0gIlx1ZmVmZiI7CiAgICBjb25zdCBOVU1FUklDX0NIQVJTID0gbmV3IFNldChbLi4uIjAxMjM0NTY3ODkiXSk7CiAgICBDMy5Jc051bWVyaWNDaGFyID0gZnVuY3Rpb24gSXNOdW1lcmljQ2hhcihjKSB7CiAgICAgICAgcmV0dXJuIE5VTUVSSUNfQ0hBUlMuaGFzKGMpCiAgICB9OwogICAgY29uc3QgV0hJVEVTUEFDRV9DSEFSUyA9IG5ldyBTZXQoWy4uLiIgXHRcblxyXHUwMGEwXHUwMDg1XHUyMDAwXHUyMDAxXHUyMDAyXHUyMDAzXHUyMDA0XHUyMDA1XHUyMDA2XHUyMDA3XHUyMDA4XHUyMDA5XHUyMDBhXHUyMDBiXHUyMDI4XHUyMDI5XHUyMDJmXHUyMDVmXHUzMDAwIl0pOwogICAgQzMuSXNXaGl0ZXNwYWNlQ2hhciA9IGZ1bmN0aW9uIElzV2hpdGVzcGFjZUNoYXIoYykgewogICAgICAgIHJldHVybiBXSElURVNQQUNFX0NIQVJTLmhhcyhjKQogICAgfTsKICAgIEMzLkZpbHRlcldoaXRlc3BhY2UgPSBmdW5jdGlvbiBGaWx0ZXJXaGl0ZXNwYWNlKHN0cikgewogICAgICAgIHJldHVybiBbLi4uc3RyXS5maWx0ZXIoY2ggPT4gIUMzLklzV2hpdGVzcGFjZUNoYXIoY2gpKS5qb2luKCIiKQogICAgfTsKICAgIEMzLklzU3RyaW5nQWxsV2hpdGVzcGFjZSA9IGZ1bmN0aW9uIElzU3RyaW5nQWxsV2hpdGVzcGFjZShzdHIpIHsKICAgICAgICBmb3IgKGNvbnN0IGNoIG9mIHN0cikKICAgICAgICAgICAgaWYgKCFDMy5Jc1doaXRlc3BhY2VDaGFyKGNoKSkgcmV0dXJuIGZhbHNlOwogICAgICAgIHJldHVybiB0cnVlCiAgICB9OwogICAgQzMuSXNDaGFyQXJyYXlBbGxXaGl0ZXNwYWNlID0gZnVuY3Rpb24gSXNTdHJpbmdBbGxXaGl0ZXNwYWNlKGNoQXJyKSB7CiAgICAgICAgZm9yIChjb25zdCBjaCBvZiBjaEFycikKICAgICAgICAgICAgaWYgKCFDMy5Jc1doaXRlc3BhY2VDaGFyKGNoKSkgcmV0dXJuIGZhbHNlOwogICAgICAgIHJldHVybiB0cnVlCiAgICB9OwogICAgQzMuSXNVbnByaW50YWJsZUNoYXIgPSBmdW5jdGlvbiBJc1VucHJpbnRhYmxlQ2hhcihjKSB7CiAgICAgICAgcmV0dXJuIGMubGVuZ3RoID09PSAxICYmIGMuY2hhckNvZGVBdCgwKSA8IDMyCiAgICB9OwogICAgQzMuRmlsdGVyVW5wcmludGFibGVDaGFycyA9IGZ1bmN0aW9uIEZpbHRlclVucHJpbnRhYmxlQ2hhcnMoc3RyKSB7CiAgICAgICAgcmV0dXJuIFsuLi5zdHJdLmZpbHRlcihjaCA9PiAhQzMuSXNVbnByaW50YWJsZUNoYXIoY2gpKS5qb2luKCIiKQogICAgfTsKICAgIGNvbnN0IE5VTUVSSUNfU1RSSU5HX0NIQVJTID0gbmV3IFNldChbLi4uIjAxMjM0NTY3ODkuKy1lIl0pOwogICAgQzMuSXNTdHJpbmdOdW1iZXIgPSBmdW5jdGlvbiBJc1N0cmluZ051bWJlcihzdHIpIHsKICAgICAgICBzdHIgPSBzdHIudHJpbSgpOwogICAgICAgIGlmICghc3RyLmxlbmd0aCkgcmV0dXJuIGZhbHNlOwogICAgICAgIGxldCBmaXJzdENoYXIgPSBzdHIuY2hhckF0KDApOwogICAgICAgIGlmIChmaXJzdENoYXIgIT09ICItIiAmJiAhTlVNRVJJQ19DSEFSUy5oYXMoZmlyc3RDaGFyKSkgcmV0dXJuIGZhbHNlOwogICAgICAgIGZvciAobGV0IGNoIG9mIHN0cikKICAgICAgICAgICAgaWYgKCFOVU1FUklDX1NUUklOR19DSEFSUy5oYXMoY2gpKSByZXR1cm4gZmFsc2U7CiAgICAgICAgcmV0dXJuIHRydWUKICAgIH07CiAgICBDMy5SZW1vdmVUcmFpbGluZ0RpZ2l0cyA9IGZ1bmN0aW9uIFJlbW92ZVRyYWlsaW5nRGlnaXRzKHN0cikgewogICAgICAgIGxldCBpID0gc3RyLmxlbmd0aDsKICAgICAgICB3aGlsZSAoaSA+IDApIHsKICAgICAgICAgICAgbGV0IHByZXZfY2ggPSBzdHIuY2hhckF0KGkgLSAxKTsKICAgICAgICAgICAgaWYgKCFDMy5Jc051bWVyaWNDaGFyKHByZXZfY2gpKSBicmVhazsKICAgICAgICAgICAgLS1pCiAgICAgICAgfQogICAgICAgIHJldHVybiBzdHIuc3Vic3RyKDAsIGkpCiAgICB9OwogICAgQzMuSW5jcmVtZW50TnVtYmVyQXRFbmRPZiA9IGZ1bmN0aW9uIEluY3JlbWVudE51bWJlckF0RW5kT2Yoc3RyKSB7CiAgICAgICAgbGV0IGJhc2VTdHIgPSBDMy5SZW1vdmVUcmFpbGluZ0RpZ2l0cyhzdHIpOwogICAgICAgIGxldCBudW1iZXJTdHIgPSBzdHIuc3Vic3RyKGJhc2VTdHIubGVuZ3RoKTsKICAgICAgICBpZiAobnVtYmVyU3RyKSBudW1iZXJTdHIgPSAocGFyc2VJbnQobnVtYmVyU3RyLCAxMCkgKyAxKS50b1N0cmluZygpOwogICAgICAgIGVsc2UgbnVtYmVyU3RyID0gIjIiOwogICAgICAgIHJldHVybiBiYXNlU3RyICsgbnVtYmVyU3RyCiAgICB9OwogICAgY29uc3QgSFRNTF9FTlRJVFlfTUFQID0gbmV3IE1hcChbCiAgICAgICAgWyImIiwgIiZhbXA7Il0sCiAgICAgICAgWyI8IiwgIiZsdDsiXSwKICAgICAgICBbIj4iLCAiJmd0OyJdLAogICAgICAgIFsnIicsICImcXVvdDsiXSwKICAgICAgICBbIiciLCAiJiMzOTsiXQogICAgXSk7CgogICAgZnVuY3Rpb24gbG9va3VwSHRtbEVudGl0eShzKSB7CiAgICAgICAgcmV0dXJuIEhUTUxfRU5USVRZX01BUC5nZXQocykKICAgIH0KICAgIGNvbnN0IEhUTUxfRU5USVRZX1JFR0VYID0gL1smPD4iJ10vZzsKICAgIEMzLkVzY2FwZUhUTUwgPSBmdW5jdGlvbiBFc2NhcGVIVE1MKHN0cikgewogICAgICAgIHJldHVybiBzdHIucmVwbGFjZShIVE1MX0VOVElUWV9SRUdFWCwgbG9va3VwSHRtbEVudGl0eSkKICAgIH07CiAgICBDMy5Fc2NhcGVKUyA9IGZ1bmN0aW9uIEVzY2FwZUpTKHN0cikgewogICAgICAgIGxldCByZXQgPSBDMy5SZXBsYWNlQWxsKHN0ciwgIlxcIiwgIlxcXFwiKTsKICAgICAgICByZXQgPSBDMy5SZXBsYWNlQWxsKHJldCwgJyInLCAnXFwiJyk7CiAgICAgICAgcmV0ID0gQzMuUmVwbGFjZUFsbChyZXQsICJcdCIsICJcXHQiKTsKICAgICAgICByZXQgPSBDMy5SZXBsYWNlQWxsKHJldCwgIlxyIiwgIiIpOwogICAgICAgIHJldHVybiBDMy5SZXBsYWNlQWxsKHJldCwgIlxuIiwgIlxcbiIpCiAgICB9OwogICAgQzMuRXNjYXBlWE1MID0gZnVuY3Rpb24gRXNjYXBlWE1MKHN0cikgewogICAgICAgIGxldCByZXQgPSBDMy5SZXBsYWNlQWxsKHN0ciwgIiYiLCAiJmFtcDsiKTsKICAgICAgICByZXQgPSBDMy5SZXBsYWNlQWxsKHJldCwgIjwiLCAiJmx0OyIpOwogICAgICAgIHJldCA9IEMzLlJlcGxhY2VBbGwocmV0LCAiPiIsICImZ3Q7Iik7CiAgICAgICAgcmV0dXJuIEMzLlJlcGxhY2VBbGwocmV0LCAnIicsICImcXVvdDsiKQogICAgfTsKICAgIGNvbnN0IEVTQ0FQRV9SRUdFWCA9IC9bLVtcXXt9KCkqKz8uLFxcXiR8I1xzXS9nOwogICAgQzMuRXNjYXBlUmVnZXggPSBmdW5jdGlvbiBFc2NhcGVSZWdleChzdHIpIHsKICAgICAgICByZXR1cm4gc3RyLnJlcGxhY2UoRVNDQVBFX1JFR0VYLCAiXFwkJiIpCiAgICB9OwogICAgQzMuQ291bnRDaGFyc0luU3RyaW5nID0gZnVuY3Rpb24gQ291bnRDaGFyc0luU3RyaW5nKHN0ciwgY2gpIHsKICAgICAgICBsZXQgY291bnQgPSAwOwogICAgICAgIGZvciAoY29uc3QgYyBvZiBzdHIpCiAgICAgICAgICAgIGlmIChjID09PSBjaCkgKytjb3VudDsKICAgICAgICByZXR1cm4gY291bnQKICAgIH07CiAgICBDMy5GaW5kQWxsID0gZnVuY3Rpb24gRmluZEFsbChzdHIsIGZpbmQsIG1hdGNoQ2FzZSA9IGZhbHNlKSB7CiAgICAgICAgaWYgKCFmaW5kKSByZXR1cm4gW107CiAgICAgICAgaWYgKCFtYXRjaENhc2UpIHsKICAgICAgICAgICAgc3RyID0gc3RyLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgIGZpbmQgPSBmaW5kLnRvTG93ZXJDYXNlKCkKICAgICAgICB9CiAgICAgICAgY29uc3QgZmluZExlbiA9IGZpbmQubGVuZ3RoOwogICAgICAgIGxldCBzdGFydEluZGV4ID0gMDsKICAgICAgICBsZXQgaW5kZXggPSAwOwogICAgICAgIGxldCByZXQgPSBbXTsKICAgICAgICB3aGlsZSAoKGluZGV4ID0gc3RyLmluZGV4T2YoZmluZCwgc3RhcnRJbmRleCkpID4gLTEpIHsKICAgICAgICAgICAgcmV0LnB1c2goaW5kZXgpOwogICAgICAgICAgICBzdGFydEluZGV4ID0gaW5kZXggKyBmaW5kTGVuCiAgICAgICAgfQogICAgICAgIHJldHVybiByZXQKICAgIH07CiAgICBDMy5SZXBsYWNlQWxsID0gZnVuY3Rpb24gUmVwbGFjZUFsbChzdHIsIGZpbmQsIHJlcGxhY2UpIHsKICAgICAgICByZXR1cm4gc3RyLnJlcGxhY2VBbGwoZmluZCwgKCkgPT4gcmVwbGFjZSkKICAgIH07CiAgICBDMy5SZXBsYWNlQWxsQ2FzZUluc2Vuc2l0aXZlID0gZnVuY3Rpb24gUmVwbGFjZUFsbChzdHIsIGZpbmQsIHJlcGxhY2UpIHsKICAgICAgICByZXR1cm4gc3RyLnJlcGxhY2UobmV3IFJlZ0V4cChDMy5Fc2NhcGVSZWdleChmaW5kKSwgImdpIiksICgpID0+IHJlcGxhY2UpCiAgICB9OwogICAgQzMuU2V0RWxlbWVudENvbnRlbnQgPSBmdW5jdGlvbiBTZXRFbGVtZW50Q29udGVudChlbGVtLCBzdHJpbmdsaWtlKSB7CiAgICAgICAgaWYgKHR5cGVvZiBzdHJpbmdsaWtlID09PSAic3RyaW5nIikgZWxlbS50ZXh0Q29udGVudCA9IHN0cmluZ2xpa2U7CiAgICAgICAgZWxzZSBpZiAoc3RyaW5nbGlrZS5pc1BsYWluVGV4dCgpKSBlbGVtLnRleHRDb250ZW50ID0gc3RyaW5nbGlrZS50b1N0cmluZygpOwogICAgICAgIGVsc2UgewogICAgICAgICAgICBlbGVtLmlubmVySFRNTCA9IHN0cmluZ2xpa2UudG9IVE1MKCk7CiAgICAgICAgICAgIGlmIChzdHJpbmdsaWtlIGluc3RhbmNlb2YgQzMuQkJTdHJpbmcpIHN0cmluZ2xpa2UuYXR0YWNoTGlua0hhbmRsZXJzKGVsZW0pCiAgICAgICAgfQogICAgfTsKICAgIEMzLlN0cmluZ0xpa2VFcXVhbHMgPSBmdW5jdGlvbiBTdHJpbmdMaWtlRXF1YWxzKGEsIGIpIHsKICAgICAgICBpZiAoYSBpbnN0YW5jZW9mIEMzLkh0bWxTdHJpbmcgfHwgYSBpbnN0YW5jZW9mIEMzLkJCU3RyaW5nKSByZXR1cm4gYS5lcXVhbHMoYik7CiAgICAgICAgZWxzZSBpZiAoYiBpbnN0YW5jZW9mIEMzLkh0bWxTdHJpbmcgfHwgYiBpbnN0YW5jZW9mIEMzLkJCU3RyaW5nKSByZXR1cm4gYi5lcXVhbHMoYSk7CiAgICAgICAgZWxzZSByZXR1cm4gYSA9PT0gYgogICAgfTsKICAgIEMzLlN0cmluZ1N1YnN0aXR1dGUgPSBmdW5jdGlvbiBTdHJpbmdTdWJzdGl0dXRlKHN0ciwgLi4uYXJyKSB7CiAgICAgICAgbGV0IHJldCA9IHN0cjsKICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gYXJyLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7CiAgICAgICAgICAgIGNvbnN0IHN1YiA9IGB7JHtpfX1gOwogICAgICAgICAgICBpZiAoIXN0ci5pbmNsdWRlcyhzdWIpKSB0aHJvdyBuZXcgRXJyb3IoYG1pc3NpbmcgcGxhY2Vob2xkZXIgJyR7c3VifScgaW4gc3RyaW5nIHN1YnN0aXR1dGlvbmApOwogICAgICAgICAgICByZXQgPSByZXQucmVwbGFjZShzdWIsIGFycltpXS50b1N0cmluZygpKQogICAgICAgIH0KICAgICAgICByZXR1cm4gcmV0CiAgICB9OwogICAgQzMuU3RyaW5nU3Vic3RpdHV0ZUFsbG93TWlzc2luZyA9IGZ1bmN0aW9uIFN0cmluZ1N1YnN0aXR1dGVBbGxvd01pc3Npbmcoc3RyLCAuLi5hcnIpIHsKICAgICAgICBsZXQgcmV0ID0gc3RyOwogICAgICAgIGxldCBsb3dlc3RNaXNzaW5nSW5kZXggPSAtMTsKICAgICAgICBsZXQgaGlnaGVzdFVzZWRJbmRleCA9IC0xOwogICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBhcnIubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHsKICAgICAgICAgICAgY29uc3Qgc3ViID0gYHske2l9fWA7CiAgICAgICAgICAgIGlmIChzdHIuaW5jbHVkZXMoc3ViKSkgewogICAgICAgICAgICAgICAgaGlnaGVzdFVzZWRJbmRleCA9IGk7CiAgICAgICAgICAgICAgICByZXQgPSByZXQucmVwbGFjZShzdWIsIGFycltpXS50b1N0cmluZygpKQogICAgICAgICAgICB9IGVsc2UgaWYgKGxvd2VzdE1pc3NpbmdJbmRleCA9PT0gLTEpIGxvd2VzdE1pc3NpbmdJbmRleCA9IGkKICAgICAgICB9CiAgICAgICAgaWYgKGxvd2VzdE1pc3NpbmdJbmRleCA+PSAwICYmIGhpZ2hlc3RVc2VkSW5kZXggPj0gMCAmJiBsb3dlc3RNaXNzaW5nSW5kZXggPCBoaWdoZXN0VXNlZEluZGV4KSB0aHJvdyBuZXcgRXJyb3IoYG1pc3NpbmcgcGxhY2Vob2xkZXIgJyR7bG93ZXN0TWlzc2luZ0luZGV4fScgaW4gc3RyaW5nIHN1YnN0aXR1dGlvbmApOwogICAgICAgIHJldHVybiByZXQKICAgIH07CiAgICBDMy5TdHJpbmdTdWJzdGl0dXRlTWFwID0gZnVuY3Rpb24gU3RyaW5nU3Vic3RpdHV0ZU1hcChzdHIsIG8pIHsKICAgICAgICBsZXQgcmV0ID0gc3RyOwogICAgICAgIGZvciAobGV0IFtwbGFjZWhvbGRlciwgc3Vic3RpdHV0aW9uXSBvZiBPYmplY3QuZW50cmllcyhvKSkgcmV0ID0gcmV0LnJlcGxhY2VBbGwocGxhY2Vob2xkZXIsIHN1YnN0aXR1dGlvbi50b1N0cmluZygpKTsKICAgICAgICByZXR1cm4gcmV0CiAgICB9OwogICAgQzMuU29ydEFaID0gZnVuY3Rpb24gU29ydEFaKGEsIGIpIHsKICAgICAgICBpZiAoYSA+IGIpIHJldHVybiAxOwogICAgICAgIGVsc2UgaWYgKGEgPCBiKSByZXR1cm4gLTE7CiAgICAgICAgZWxzZSByZXR1cm4gMAogICAgfTsKICAgIEMzLlNvcnRBWkNhc2VJbnNlbnNpdGl2ZSA9IGZ1bmN0aW9uIFNvcnRBWkNhc2VJbnNlbnNpdGl2ZShhLCBiKSB7CiAgICAgICAgbGV0IGxvd2VyQSA9IGEudG9Mb3dlckNhc2UoKTsKICAgICAgICBsZXQgbG93ZXJCID0gYi50b0xvd2VyQ2FzZSgpOwogICAgICAgIGlmIChsb3dlckEgPiBsb3dlckIpIHJldHVybiAxOwogICAgICAgIGVsc2UgaWYgKGxvd2VyQSA8IGxvd2VyQikgcmV0dXJuIC0xOwogICAgICAgIGVsc2UgcmV0dXJuIDAKICAgIH07CiAgICBsZXQgaW50bFNlZ21lbnRlciA9IG51bGw7CiAgICBsZXQgZ3JhcGhlbWVTcGxpdHRlciA9IG51bGw7CiAgICBpZiAoc2VsZlsiSW50bCJdICYmIHNlbGZbIkludGwiXVsiU2VnbWVudGVyIl0pIGludGxTZWdtZW50ZXIgPSBuZXcgc2VsZlsiSW50bCJdWyJTZWdtZW50ZXIiXTsKICAgIGVsc2UgZ3JhcGhlbWVTcGxpdHRlciA9IG5ldyBzZWxmLkdyYXBoZW1lU3BsaXR0ZXI7CiAgICBDMy5TcGxpdEdyYXBoZW1lcyA9IGZ1bmN0aW9uIFNwbGl0R3JhcGhlbWVzKHN0cikgewogICAgICAgIGlmIChpbnRsU2VnbWVudGVyKSB7CiAgICAgICAgICAgIGNvbnN0IHJldCA9IFtdOwogICAgICAgICAgICBmb3IgKGNvbnN0IHMgb2YgaW50bFNlZ21lbnRlclsic2VnbWVudCJdKHN0cikpIHJldC5wdXNoKHNbInNlZ21lbnQiXSk7CiAgICAgICAgICAgIHJldHVybiByZXQKICAgICAgICB9IGVsc2UgcmV0dXJuIGdyYXBoZW1lU3BsaXR0ZXIuc3BsaXRHcmFwaGVtZXMoc3RyKQogICAgfTsKICAgIEMzLkl0ZXJhdGVHcmFwaGVtZXMgPSBmdW5jdGlvbiogSXRlcmF0ZUdyYXBoZW1lcyhzdHIpIHsKICAgICAgICBpZiAoaW50bFNlZ21lbnRlcikKICAgICAgICAgICAgZm9yIChjb25zdCBzIG9mIGludGxTZWdtZW50ZXJbInNlZ21lbnQiXShzdHIpKSB5aWVsZCBzWyJzZWdtZW50Il07CiAgICAgICAgZWxzZSB5aWVsZCogZ3JhcGhlbWVTcGxpdHRlci5pdGVyYXRlR3JhcGhlbWVzKHN0cikKICAgIH07CiAgICBDMy5Db3VudEdyYXBoZW1lcyA9IGZ1bmN0aW9uIENvdW50R3JhcGhlbWVzKHN0cikgewogICAgICAgIGlmIChpbnRsU2VnbWVudGVyKSB7CiAgICAgICAgICAgIGxldCByZXQgPSAwOwogICAgICAgICAgICBmb3IgKGNvbnN0IHMgb2YgaW50bFNlZ21lbnRlclsic2VnbWVudCJdKHN0cikpICsrcmV0OwogICAgICAgICAgICByZXR1cm4gcmV0CiAgICAgICAgfSBlbHNlIHJldHVybiBncmFwaGVtZVNwbGl0dGVyLmNvdW50R3JhcGhlbWVzKHN0cikKICAgIH07CiAgICBjb25zdCBLSUxPQllURSA9IDEwMjQ7CiAgICBjb25zdCBNRUdBQllURSA9IEtJTE9CWVRFICogMTAyNDsKICAgIGNvbnN0IEdJR0FCWVRFID0gTUVHQUJZVEUgKiAxMDI0OwogICAgY29uc3QgVEVSQUJZVEUgPSBHSUdBQllURSAqIDEwMjQ7CiAgICBDMy5Gb3JtYXREYXRhU2l6ZSA9IGZ1bmN0aW9uIEZvcm1hdERhdGFTaXplKHNpemVJbkJ5dGVzLCBhc1JhdGUpIHsKICAgICAgICBsZXQgcm9vdEtleSA9ICJjb21tb24uIiArIChhc1JhdGUgPyAiZGF0YVJhdGVzIiA6ICJkYXRhU2l6ZXMiKSArICIuIjsKICAgICAgICBjb25zdCBsYW5nU3ViID0gc2VsZi5sYW5nU3ViOwogICAgICAgIGlmIChzaXplSW5CeXRlcyA8IEtJTE9CWVRFKSByZXR1cm4gbGFuZ1N1Yihyb290S2V5ICsgImJ5dGVzIiwgc2l6ZUluQnl0ZXMpOwogICAgICAgIGVsc2UgaWYgKHNpemVJbkJ5dGVzIDwgTUVHQUJZVEUpIHsKICAgICAgICAgICAgbGV0IGtiID0gc2l6ZUluQnl0ZXMgLyBLSUxPQllURTsKICAgICAgICAgICAgaWYgKGtiIDwgMTApIGtiID0gTWF0aC5yb3VuZChrYiAqIDEwKSAvIDEwOwogICAgICAgICAgICBlbHNlIGtiID0gTWF0aC5yb3VuZChrYik7CiAgICAgICAgICAgIHJldHVybiBsYW5nU3ViKHJvb3RLZXkgKyAia2lsb2J5dGVzIiwga2IpCiAgICAgICAgfSBlbHNlIGlmIChzaXplSW5CeXRlcyA8IEdJR0FCWVRFKSB7CiAgICAgICAgICAgIGxldCBtYiA9IHNpemVJbkJ5dGVzIC8gTUVHQUJZVEU7CiAgICAgICAgICAgIGlmIChtYiA8IDEwKSBtYiA9IE1hdGgucm91bmQobWIgKiAxMCkgLyAxMDsKICAgICAgICAgICAgZWxzZSBtYiA9IE1hdGgucm91bmQobWIpOwogICAgICAgICAgICByZXR1cm4gbGFuZ1N1Yihyb290S2V5ICsKICAgICAgICAgICAgICAgICJtZWdhYnl0ZXMiLCBtYikKICAgICAgICB9IGVsc2UgaWYgKHNpemVJbkJ5dGVzIDwgVEVSQUJZVEUpIHsKICAgICAgICAgICAgbGV0IGdiID0gc2l6ZUluQnl0ZXMgLyBHSUdBQllURTsKICAgICAgICAgICAgaWYgKGdiIDwgMTApIGdiID0gTWF0aC5yb3VuZChnYiAqIDEwKSAvIDEwOwogICAgICAgICAgICBlbHNlIGdiID0gTWF0aC5yb3VuZChnYik7CiAgICAgICAgICAgIHJldHVybiBsYW5nU3ViKHJvb3RLZXkgKyAiZ2lnYWJ5dGVzIiwgZ2IpCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbGV0IHRiID0gc2l6ZUluQnl0ZXMgLyBURVJBQllURTsKICAgICAgICAgICAgaWYgKHRiIDwgMTApIHRiID0gTWF0aC5yb3VuZCh0YiAqIDEwKSAvIDEwOwogICAgICAgICAgICBlbHNlIHRiID0gTWF0aC5yb3VuZCh0Yik7CiAgICAgICAgICAgIHJldHVybiBsYW5nU3ViKHJvb3RLZXkgKyAidGVyYWJ5dGVzIiwgdGIpCiAgICAgICAgfQogICAgfTsKICAgIGNvbnN0IERFRkFVTFRfRk9STUFUVElNRV9PUFRTID0gewogICAgICAgIGFwcHJveGltYXRlOiBmYWxzZSwKICAgICAgICBkYXlzOiB0cnVlLAogICAgICAgIGhvdXJzOiB0cnVlLAogICAgICAgIG1pbnV0ZXM6IHRydWUsCiAgICAgICAgc2Vjb25kczogdHJ1ZQogICAgfTsKICAgIEMzLkZvcm1hdFRpbWUgPSBmdW5jdGlvbiBGb3JtYXRUaW1lKHNlY29uZHNUb3RhbCwgb3B0cykgewogICAgICAgIG9wdHMgPSBPYmplY3QuYXNzaWduKHt9LCBERUZBVUxUX0ZPUk1BVFRJTUVfT1BUUywgb3B0cyk7CiAgICAgICAgQzMuTGFuZy5QdXNoQ29udGV4dCgiY29tbW9uLnRpbWUiKTsKICAgICAgICBjb25zdCBwYXJ0cyA9IFtdOwogICAgICAgIGNvbnN0IGxhbmcgPSBzZWxmLmxhbmc7CiAgICAgICAgY29uc3QgbGFuZ1BsdXJhbFN1YiA9IHNlbGYubGFuZ1BsdXJhbFN1YjsKICAgICAgICBpZiAob3B0cy5kYXlzKSB7CiAgICAgICAgICAgIGNvbnN0IGRheXMgPSBNYXRoLmZsb29yKHNlY29uZHNUb3RhbCAvICgyNCAqIDM2MDApKTsKICAgICAgICAgICAgaWYgKGRheXMgPiAwKSB7CiAgICAgICAgICAgICAgICBzZWNvbmRzVG90YWwgLT0gZGF5cyAqIDI0ICogMzYwMDsKICAgICAgICAgICAgICAgIHBhcnRzLnB1c2gobGFuZ1BsdXJhbFN1YigiLmRheXMiLCBudWxsLCBkYXlzKSkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAob3B0cy5ob3VycykgewogICAgICAgICAgICBjb25zdCBob3VycyA9IE1hdGguZmxvb3Ioc2Vjb25kc1RvdGFsIC8gMzYwMCk7CiAgICAgICAgICAgIGlmIChob3VycyA+IDAgfHwgcGFydHMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICBzZWNvbmRzVG90YWwgLT0gaG91cnMgKiAzNjAwOwogICAgICAgICAgICAgICAgcGFydHMucHVzaChsYW5nUGx1cmFsU3ViKCIuaG91cnMiLAogICAgICAgICAgICAgICAgICAgIG51bGwsIGhvdXJzKSkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAob3B0cy5taW51dGVzKSB7CiAgICAgICAgICAgIGNvbnN0IG1pbnV0ZXMgPSBNYXRoLmZsb29yKHNlY29uZHNUb3RhbCAvIDYwKTsKICAgICAgICAgICAgaWYgKG1pbnV0ZXMgPiAwIHx8IHBhcnRzLmxlbmd0aCB8fCAhb3B0cy5zZWNvbmRzKSB7CiAgICAgICAgICAgICAgICBzZWNvbmRzVG90YWwgLT0gbWludXRlcyAqIDYwOwogICAgICAgICAgICAgICAgcGFydHMucHVzaChsYW5nUGx1cmFsU3ViKCIubWludXRlcyIsIG51bGwsIG1pbnV0ZXMpKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChvcHRzLnNlY29uZHMpIHsKICAgICAgICAgICAgY29uc3Qgc2Vjb25kcyA9IE1hdGguZmxvb3Ioc2Vjb25kc1RvdGFsICUgNjApOwogICAgICAgICAgICBwYXJ0cy5wdXNoKGxhbmdQbHVyYWxTdWIoIi5zZWNvbmRzIiwgbnVsbCwgc2Vjb25kcykpCiAgICAgICAgfQogICAgICAgIGNvbnN0IHJldCA9IChvcHRzLmFwcHJveGltYXRlID8gbGFuZygiLmFwcHJveC1wcmVmaXgiKSA6ICIiKSArIHBhcnRzLmpvaW4obGFuZygiLnNlcGFyYXRvciIpKTsKICAgICAgICBDMy5MYW5nLlBvcENvbnRleHQoKTsKICAgICAgICByZXR1cm4gcmV0CiAgICB9OwogICAgQzMuWmVyb1BhZCA9IGZ1bmN0aW9uKG4sIGQpIHsKICAgICAgICBsZXQgcyA9IG4gPCAwID8gIi0iIDogIiI7CiAgICAgICAgbiA9IE1hdGguYWJzKG4pOwogICAgICAgIGxldCBuU3RyID0gbi50b1N0cmluZygpOwogICAgICAgIGxldCB6ZXJvZXMgPSBkIC0gblN0ci5sZW5ndGg7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB6ZXJvZXM7ICsraSkgcyArPSAiMCI7CiAgICAgICAgcmV0dXJuIHMgKyBuU3RyCiAgICB9OwogICAgQzMuU3RyaW5nVG9UaXRsZUNhc2UgPSBmdW5jdGlvbiBTdHJpbmdUb1RpdGxlQ2FzZShzdHIpIHsKICAgICAgICByZXR1cm4gc3RyLnRvTG93ZXJDYXNlKCkucmVwbGFjZSgvXGJcdy9nLCB0ID0+IHQudG9VcHBlckNhc2UoKSkKICAgIH07CiAgICBDMy5Db21wYXJlVmVyc2lvblN0cmluZ3MgPSBmdW5jdGlvbiBDb21wYXJlVmVyc2lvblN0cmluZ3ModjEsIHYyKSB7CiAgICAgICAgbGV0IGExID0gdjEuc3BsaXQoIi4iKS5tYXAocyA9PiBzLnRyaW0oKSk7CiAgICAgICAgbGV0IGEyID0gdjIuc3BsaXQoIi4iKS5tYXAocyA9PiBzLnRyaW0oKSk7CiAgICAgICAgQzMucmVzaXplQXJyYXkoYTEsIDQsICIwIik7CiAgICAgICAgQzMucmVzaXplQXJyYXkoYTIsIDQsICIwIik7CiAgICAgICAgYTEgPSBhMS5tYXAocyA9PiBwYXJzZUludChzLCAxMCkpOwogICAgICAgIGEyID0gYTIubWFwKHMgPT4gcGFyc2VJbnQocywgMTApKTsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDQ7ICsraSkgewogICAgICAgICAgICBjb25zdCBkaWZmID0gYTFbaV0gLSBhMltpXTsKICAgICAgICAgICAgaWYgKGRpZmYgIT09IDApIHJldHVybiBkaWZmIDwgMCA/IC0xIDogMQogICAgICAgIH0KICAgICAgICByZXR1cm4gMAogICAgfTsKICAgIEMzLkNyZWF0ZUdVSUQgPSBmdW5jdGlvbiBDcmVhdGVHVUlEKCkgewogICAgICAgIHJldHVybiAieHh4eHh4eHgteHh4eC00eHh4LXl4eHgteHh4eHh4eHh4eHh4Ii5yZXBsYWNlKC9beHldL2csIGMgPT4gewogICAgICAgICAgICBjb25zdCByID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTYpOwogICAgICAgICAgICBjb25zdCB2ID0gYyA9PT0gIngiID8gciA6IHIgJiAzIHwgODsKICAgICAgICAgICAgcmV0dXJuIHYudG9TdHJpbmcoMTYpCiAgICAgICAgfSkKICAgIH07CiAgICBDMy5TdHJpbmdIYW1taW5nRGlzdGFuY2UgPSBmdW5jdGlvbiBTdHJpbmdIYW1taW5nRGlzdGFuY2UoYSwgYikgewogICAgICAgIGlmIChhLmxlbmd0aCAhPT0gYi5sZW5ndGgpIHRocm93IG5ldyBFcnJvcigic3RyaW5ncyBtdXN0IGJlIHNhbWUgbGVuZ3RoIik7CiAgICAgICAgbGV0IHJldCA9IDA7CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IGEubGVuZ3RoOyBpIDwgbGVuOyArK2kpCiAgICAgICAgICAgIGlmIChhLmNoYXJBdChpKSAhPT0gYi5jaGFyQXQoaSkpICsrcmV0OwogICAgICAgIHJldHVybiByZXQKICAgIH07CiAgICBDMy5TdHJpbmdMZXZlbnNodGVpbkRpc3RhbmNlID0gZnVuY3Rpb24gU3RyaW5nTGV2ZW5zaHRlaW5EaXN0YW5jZShhLCBiKSB7CiAgICAgICAgaWYgKGEubGVuZ3RoID09PSAwKSByZXR1cm4gYi5sZW5ndGg7CiAgICAgICAgaWYgKGIubGVuZ3RoID09PSAwKSByZXR1cm4gYS5sZW5ndGg7CiAgICAgICAgbGV0IHRtcCwgaSwgaiwgcHJldiwgdmFsLCByb3c7CiAgICAgICAgaWYgKGEubGVuZ3RoID4gYi5sZW5ndGgpIHsKICAgICAgICAgICAgdG1wID0gYTsKICAgICAgICAgICAgYSA9IGI7CiAgICAgICAgICAgIGIgPSB0bXAKICAgICAgICB9CiAgICAgICAgcm93ID0gQXJyYXkoYS5sZW5ndGggKyAxKTsKICAgICAgICBmb3IgKGkgPSAwOyBpIDw9IGEubGVuZ3RoOyBpKyspIHJvd1tpXSA9IGk7CiAgICAgICAgZm9yIChpID0gMTsgaSA8PSBiLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHByZXYgPSBpOwogICAgICAgICAgICBmb3IgKGogPSAxOyBqIDw9IGEubGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgICAgIGlmIChiW2kgLSAxXSA9PT0gYVtqIC0gMV0pIHZhbCA9IHJvd1tqIC0gMV07CiAgICAgICAgICAgICAgICBlbHNlIHZhbCA9IE1hdGgubWluKHJvd1tqIC0gMV0gKyAxLCBNYXRoLm1pbihwcmV2ICsgMSwgcm93W2pdICsgMSkpOwogICAgICAgICAgICAgICAgcm93W2ogLSAxXSA9IHByZXY7CiAgICAgICAgICAgICAgICBwcmV2ID0gdmFsCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcm93W2EubGVuZ3RoXSA9IHByZXYKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJvd1thLmxlbmd0aF0KICAgIH07Cgp9CgovLyAuLi9saWIvc3RyL2Jic3RyaW5nLmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIGNvbnN0IGFzc2VydCA9IHNlbGYuYXNzZXJ0OwogICAgY29uc3QgQkJfQ09ERV9NQVAgPSBuZXcgTWFwKFsKICAgICAgICBbImIiLCAic3Ryb25nIl0sCiAgICAgICAgWyJpIiwgImVtIl0sCiAgICAgICAgWyJzIiwgInMiXSwKICAgICAgICBbInUiLCAidSJdLAogICAgICAgIFsic3ViIiwgInN1YiJdLAogICAgICAgIFsic3VwIiwgInN1cCJdLAogICAgICAgIFsic21hbGwiLCAic21hbGwiXSwKICAgICAgICBbIm1hcmsiLCAibWFyayJdLAogICAgICAgIFsiY29kZSIsICJjb2RlIl0sCiAgICAgICAgWyJhMSIsICJhIl0sCiAgICAgICAgWyJhMiIsICJhIl0sCiAgICAgICAgWyJhMyIsICJhIl0sCiAgICAgICAgWyJhNCIsICJhIl0sCiAgICAgICAgWyJhNSIsICJhIl0sCiAgICAgICAgWyJhNiIsICJhIl0sCiAgICAgICAgWyJhNyIsICJhIl0sCiAgICAgICAgWyJhOCIsICJhIl0sCiAgICAgICAgWyJhOSIsICJhIl0sCiAgICAgICAgWyJ0aXAxIiwgImFiYnIiXSwKICAgICAgICBbInRpcDIiLCAiYWJiciJdLAogICAgICAgIFsidGlwMyIsICJhYmJyIl0sCiAgICAgICAgWyJ0aXA0IiwgImFiYnIiXSwKICAgICAgICBbInRpcDUiLCAiYWJiciJdLAogICAgICAgIFsidGlwNiIsICJhYmJyIl0sCiAgICAgICAgWyJ0aXA3IiwgImFiYnIiXSwKICAgICAgICBbInRpcDgiLCAiYWJiciJdLAogICAgICAgIFsidGlwOSIsICJhYmJyIl0sCiAgICAgICAgWyJiYWQiLCBbInNwYW4iLCAiYmJDb2RlQmFkIl1dLAogICAgICAgIFsiZ29vZCIsIFsic3BhbiIsICJiYkNvZGVHb29kIl1dLAogICAgICAgIFsiaW5mbyIsIFsic3BhbiIsICJiYkNvZGVJbmZvIl1dLAogICAgICAgIFsiaDEiLCBbInNwYW4iLCAiYmJDb2RlSDEiXV0sCiAgICAgICAgWyJoMiIsIFsic3BhbiIsICJiYkNvZGVIMiJdXSwKICAgICAgICBbImgzIiwgWyJzcGFuIiwgImJiQ29kZUgzIl1dLAogICAgICAgIFsiaDQiLCBbInNwYW4iLCAiYmJDb2RlSDQiXV0sCiAgICAgICAgWyJpdGVtIiwgWyJzcGFuIiwgImJiQ29kZUl0ZW0iXV0KICAgIF0pOwogICAgY29uc3QgQkJSRUdFWCA9IC9cWyhcLz8pKFthLXpBLVowLTldKylcXS9nOwogICAgY29uc3QgQ1VTVE9NX0JCUkVHRVggPSAvXFsoXC8/KShbXlxbXG5dKj8pXF0vZzsKICAgIGxldCBsaW5rQWN0aW9ucyA9IG51bGw7CiAgICBsZXQgdGlwTGlzdCA9IG51bGw7CiAgICBsZXQgY2xhc3NJbmRleCA9IDA7CgogICAgZnVuY3Rpb24gYmJUb0h0bWxSZXBsYWNlckZ1bmMobWF0Y2gsIGNsb3NlU2xhc2gsIHRhZ05hbWUpIHsKICAgICAgICBjb25zdCBlbnRyeSA9IEJCX0NPREVfTUFQLmdldCh0YWdOYW1lKTsKICAgICAgICBpZiAoZW50cnkpCiAgICAgICAgICAgIGlmICh0eXBlb2YgZW50cnkgPT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgICAgICBpZiAoZW50cnkgPT09ICJhIiAmJiBsaW5rQWN0aW9ucy5sZW5ndGggPT09IDAgfHwgZW50cnkgPT09ICJhYmJyIiAmJiB0aXBMaXN0Lmxlbmd0aCA9PT0gMCkgcmV0dXJuIG1hdGNoOwogICAgICAgICAgICAgICAgaWYgKGVudHJ5ID09PSAiYSIgJiYgIWNsb3NlU2xhc2gpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBpbmRleCA9IHBhcnNlSW50KHRhZ05hbWUuc3Vic3RyaW5nKDEpLCAxMCkgLSAxOwogICAgICAgICAgICAgICAgICAgIGlmIChpbmRleCA8IDAgfHwgaW5kZXggPj0gbGlua0FjdGlvbnMubGVuZ3RoKSB0aHJvdyBuZXcgRXJyb3IoImludmFsaWQgYmJjb2RlIGxpbmsgc3Vic3RpdHV0aW9uIik7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgbGlua0FjdGlvbiA9IGxpbmtBY3Rpb25zW2luZGV4XTsKICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGxpbmtBY3Rpb24gPT09ICJzdHJpbmciKSByZXR1cm4gYDxhIGhyZWY9IiR7bGlua0FjdGlvbnNbaW5kZXhdfSI+YDsKICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgbGlua0FjdGlvbiA9PT0KICAgICAgICAgICAgICAgICAgICAgICAgImZ1bmN0aW9uIikgcmV0dXJuIGA8YSBjbGFzcz0iYmJsaW5rJHtpbmRleH0iPmA7CiAgICAgICAgICAgICAgICAgICAgZWxzZSB0aHJvdyBuZXcgVHlwZUVycm9yKCJpbnZhbGlkIGJiY29kZSBsaW5rIGFjdGlvbiIpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlbnRyeSA9PT0gImFiYnIiICYmICFjbG9zZVNsYXNoKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSBwYXJzZUludCh0YWdOYW1lLnN1YnN0cmluZygzKSwgMTApIC0gMTsKICAgICAgICAgICAgICAgICAgICBpZiAoaW5kZXggPCAwIHx8IGluZGV4ID49IHRpcExpc3QubGVuZ3RoKSB0aHJvdyBuZXcgRXJyb3IoImludmFsaWQgYmJjb2RlIHRpcCBzdWJzdGl0dXRpb24iKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCB0aXAgPSB0aXBMaXN0W2luZGV4XTsKICAgICAgICAgICAgICAgICAgICBsZXQgdGlwU3RyID0gIiI7CiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB0aXAgPT09ICJzdHJpbmciKSB0aXBTdHIgPSB0aXA7CiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHRpcCA9PT0gImZ1bmN0aW9uIikgdGlwU3RyID0gdGlwKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB0aXBTdHIgIT09ICJzdHJpbmciKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJpbnZhbGlkIGJiY29kZSB0aXAiKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYDxhYmJyIHRpdGxlPSIke0MzLlJlcGxhY2VBbGwodGlwU3RyLAonIicsIiZxdW90OyIpfSI+YAogICAgICAgICAgICAgICAgfSBlbHNlIHJldHVybiAiPCIgKyBjbG9zZVNsYXNoICsgZW50cnkgKyAiPiIKICAgICAgICAgICAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KGVudHJ5KSkgewogICAgICAgICAgICBsZXQgdGFnID0gZW50cnlbMF07CiAgICAgICAgICAgIGxldCBjbGFzc05hbWUgPSBlbnRyeVsxXTsKICAgICAgICAgICAgaWYgKGNsb3NlU2xhc2gpIHJldHVybiAiPC8iICsgdGFnICsgIj4iOwogICAgICAgICAgICBlbHNlIHJldHVybiBgPCR7dGFnfSBjbGFzcz0iJHtjbGFzc05hbWV9Ij5gCiAgICAgICAgfSBlbHNlOwogICAgICAgIGVsc2UgaWYgKHRhZ05hbWUgPT09ICJjbGFzcyIpCiAgICAgICAgICAgIGlmIChjbG9zZVNsYXNoKSByZXR1cm4gIjwvc3Bhbj4iOwogICAgICAgICAgICBlbHNlIHJldHVybiBgPHNwYW4gY2xhc3M9ImJiY2xhc3Mke2NsYXNzSW5kZXgrK30iPmA7CiAgICAgICAgZWxzZSByZXR1cm4gbWF0Y2gKICAgIH0KICAgIGNvbnN0IExJTkVCUkVBS19SRUdFWCA9IC9cbi9nOwogICAgQzMuQkJTdHJpbmcgPSBjbGFzcyBCQlN0cmluZyB7CiAgICAgICAgY29uc3RydWN0b3Ioc3RyLCBvcHRzKSB7CiAgICAgICAgICAgIHRoaXMuX2Jic3RyID0gb3B0cyAmJiBvcHRzLm5vRXNjYXBlID8gc3RyIDogQzMuRXNjYXBlSFRNTChzdHIpOwogICAgICAgICAgICB0aGlzLl9odG1sc3RyID0gIiI7CiAgICAgICAgICAgIHRoaXMuX2NvbnZlcnRMaW5lQnJlYWtzID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX2xpbmtBY3Rpb25zID0gW107CiAgICAgICAgICAgIHRoaXMuX3RpcExpc3QgPSBbXTsKICAgICAgICAgICAgaWYgKG9wdHMpIHsKICAgICAgICAgICAgICAgIHRoaXMuX2NvbnZlcnRMaW5lQnJlYWtzID0gISFvcHRzLmNvbnZlcnRMaW5lQnJlYWtzOwogICAgICAgICAgICAgICAgaWYgKG9wdHMubGlua3MpIHsKICAgICAgICAgICAgICAgICAgICBpZiAob3B0cy5saW5rcy5sZW5ndGggPiA5KSB0aHJvdyBuZXcgRXJyb3IoInRvbyBtYW55IGxpbmtzIik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbGlua0FjdGlvbnMgPSBvcHRzLmxpbmtzCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAob3B0cy50aXBzKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKG9wdHMudGlwcy5sZW5ndGggPiA5KSB0aHJvdyBuZXcgRXJyb3IoInRvbyBtYW55IHRpcHMiKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl90aXBMaXN0ID0gb3B0cy50aXBzCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5faGFzQW55QkJ0YWdzID0gdGhpcy5fYmJzdHIuaW5jbHVkZXMoIlsiKTsKICAgICAgICAgICAgdGhpcy5fbmVlZHNMaW5lQnJlYWtDb252ZXJzaW9uID0KICAgICAgICAgICAgICAgIHRoaXMuX2NvbnZlcnRMaW5lQnJlYWtzICYmIHRoaXMuX2Jic3RyLmluY2x1ZGVzKCJcbiIpOwogICAgICAgICAgICB0aGlzLl9pc1BsYWluID0gIXRoaXMuX2hhc0FueUJCdGFncyAmJiAhdGhpcy5fbmVlZHNMaW5lQnJlYWtDb252ZXJzaW9uICYmICF0aGlzLl9iYnN0ci5pbmNsdWRlcygiJiIpOwogICAgICAgICAgICB0aGlzLl9oYXNQYXJzZWRGcmFnbWVudHMgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5fZnJhZ21lbnRzID0gW10KICAgICAgICB9CiAgICAgICAgdG9TdHJpbmcoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9iYnN0cgogICAgICAgIH0KICAgICAgICB2YWx1ZU9mKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fYmJzdHIKICAgICAgICB9CiAgICAgICAgaXNQbGFpblRleHQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pc1BsYWluCiAgICAgICAgfQogICAgICAgIHRvUGxhaW5UZXh0KCkgewogICAgICAgICAgICBpZiAodGhpcy5faGFzQW55QkJ0YWdzKSByZXR1cm4gdGhpcy5fYmJzdHIucmVwbGFjZShCQlJFR0VYLCAiIik7CiAgICAgICAgICAgIGVsc2UgcmV0dXJuIHRoaXMuX2Jic3RyCiAgICAgICAgfQogICAgICAgIHRvSFRNTCgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX2lzUGxhaW4pIHJldHVybiB0aGlzLl9iYnN0cjsKICAgICAgICAgICAgaWYgKCF0aGlzLl9odG1sc3RyICYmIHRoaXMuX2Jic3RyKSB7CiAgICAgICAgICAgICAgICBsZXQgc3RyID0gdGhpcy5fYmJzdHI7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5faGFzQW55QkJ0YWdzKSB7CiAgICAgICAgICAgICAgICAgICAgY2xhc3NJbmRleCA9CiAgICAgICAgICAgICAgICAgICAgICAgIDA7CiAgICAgICAgICAgICAgICAgICAgbGlua0FjdGlvbnMgPSB0aGlzLl9saW5rQWN0aW9uczsKICAgICAgICAgICAgICAgICAgICB0aXBMaXN0ID0gdGhpcy5fdGlwTGlzdDsKICAgICAgICAgICAgICAgICAgICBzdHIgPSBzdHIucmVwbGFjZShCQlJFR0VYLCBiYlRvSHRtbFJlcGxhY2VyRnVuYyk7CiAgICAgICAgICAgICAgICAgICAgbGlua0FjdGlvbnMgPSBudWxsOwogICAgICAgICAgICAgICAgICAgIHRpcExpc3QgPSBudWxsCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fbmVlZHNMaW5lQnJlYWtDb252ZXJzaW9uKSBzdHIgPSBzdHIucmVwbGFjZShMSU5FQlJFQUtfUkVHRVgsICI8YnI+Iik7CiAgICAgICAgICAgICAgICB0aGlzLl9odG1sc3RyID0gc3RyCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2h0bWxzdHIKICAgICAgICB9CiAgICAgICAgYXR0YWNoTGlua0hhbmRsZXJzKHBhcmVudEVsZW0pIHsKICAgICAgICAgICAgaWYgKCF0aGlzLl9saW5rQWN0aW9ucy5sZW5ndGgpIHJldHVybjsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IHRoaXMuX2xpbmtBY3Rpb25zLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7CiAgICAgICAgICAgICAgICBjb25zdCBsaW5rQWN0aW9uID0gdGhpcy5fbGlua0FjdGlvbnNbaV07CiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGxpbmtBY3Rpb24gIT09ICJmdW5jdGlvbiIpIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgY29uc3QgbGlua0VsZW0gPSBwYXJlbnRFbGVtLnF1ZXJ5U2VsZWN0b3IoIi5iYmxpbmsiICsgaSk7CiAgICAgICAgICAgICAgICBpZiAoIWxpbmtFbGVtKSB0aHJvdyBuZXcgRXJyb3IoInVuYWJsZSB0byBhdHRhY2ggQkJTdHJpbmcgbGluayBoYW5kbGVyIik7CiAgICAgICAgICAgICAgICBsaW5rRWxlbS5vbmNsaWNrID0gbGlua0FjdGlvbgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVxdWFscyhzKSB7CiAgICAgICAgICAgIGlmIChzIGluc3RhbmNlb2YgQzMuSHRtbFN0cmluZykgcmV0dXJuIHRoaXMudG9IVE1MKCkgPT09IHMudG9IVE1MKCk7CiAgICAgICAgICAgIGVsc2UgaWYgKHMgaW5zdGFuY2VvZiBDMy5CQlN0cmluZykgcmV0dXJuIHRoaXMuX2Jic3RyID09PSBzLl9iYnN0cjsKICAgICAgICAgICAgZWxzZSByZXR1cm4gdGhpcy5fYmJzdHIgPT09IHMKICAgICAgICB9CiAgICAgICAgdG9GcmFnbWVudExpc3QoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9oYXNQYXJzZWRGcmFnbWVudHMpIHJldHVybiB0aGlzLl9mcmFnbWVudHM7CiAgICAgICAgICAgIGNvbnN0IGJiU3RyID0gdGhpcy5fYmJzdHI7CiAgICAgICAgICAgIGNvbnN0IHN0eWxlU3RhY2sgPSBbXTsKICAgICAgICAgICAgQ1VTVE9NX0JCUkVHRVgubGFzdEluZGV4ID0gMDsKICAgICAgICAgICAgbGV0IHByZXZJbmRleCA9IDA7CiAgICAgICAgICAgIGxldCByZXN1bHQgPSBudWxsOwogICAgICAgICAgICB3aGlsZSAoKHJlc3VsdCA9IENVU1RPTV9CQlJFR0VYLmV4ZWMoYmJTdHIpKSAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSByZXN1bHQuaW5kZXg7CiAgICAgICAgICAgICAgICBpZiAoaW5kZXggPiAwICYmIGJiU3RyLmNoYXJBdChpbmRleCAtIDEpID09PSAiXFwiKSBjb250aW51ZTsKICAgICAgICAgICAgICAgIGNvbnN0IG1hdGNoU3RyID0KICAgICAgICAgICAgICAgICAgICByZXN1bHRbMF07CiAgICAgICAgICAgICAgICBjb25zdCBjbG9zZVNsYXNoID0gcmVzdWx0WzFdOwogICAgICAgICAgICAgICAgY29uc3QgdGFnTmFtZSA9IHJlc3VsdFsyXTsKICAgICAgICAgICAgICAgIGNvbnN0IHN0ckZyYWcgPSBiYlN0ci5zdWJzdHJpbmcocHJldkluZGV4LCBpbmRleCk7CiAgICAgICAgICAgICAgICBwcmV2SW5kZXggPSBpbmRleCArIG1hdGNoU3RyLmxlbmd0aDsKICAgICAgICAgICAgICAgIGlmIChzdHJGcmFnKSB0aGlzLl9mcmFnbWVudHMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgdGV4dDogc3RyRnJhZywKICAgICAgICAgICAgICAgICAgICBzdHlsZXM6IHN0eWxlU3RhY2suc2xpY2UoMCkKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgaWYgKCF0YWdOYW1lKSBjb250aW51ZTsKICAgICAgICAgICAgICAgIGlmIChjbG9zZVNsYXNoKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgbG93ZXJUYWdOYW1lID0gdGFnTmFtZS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSBzdHlsZVN0YWNrLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3R5bGVTdGFja1tpXS50YWcgPT09IGxvd2VyVGFnTmFtZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGVTdGFjay5zcGxpY2UoaSwgMSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGxldCB0YWcgPSB0YWdOYW1lOwogICAgICAgICAgICAgICAgICAgIGxldCBwYXJhbSA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZXEgPSB0YWdOYW1lLmluZGV4T2YoIj0iKTsKICAgICAgICAgICAgICAgICAgICBpZiAoZXEgIT09IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRhZyA9IHRhZ05hbWUuc3Vic3RyaW5nKDAsIGVxKS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgICAgICAgICAgICBwYXJhbSA9IHRhZ05hbWUuc3Vic3RyaW5nKGVxICsgMSkKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgdGFnID0gdGFnLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgICAgICAgICAgc3R5bGVTdGFjay5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgdGFnLAogICAgICAgICAgICAgICAgICAgICAgICBwYXJhbQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHByZXZJbmRleCA8IGJiU3RyLmxlbmd0aCkgdGhpcy5fZnJhZ21lbnRzLnB1c2goewogICAgICAgICAgICAgICAgdGV4dDogYmJTdHIuc3Vic3RyaW5nKHByZXZJbmRleCksCiAgICAgICAgICAgICAgICBzdHlsZXM6IHN0eWxlU3RhY2suc2xpY2UoMCkKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGZvciAoY29uc3QgZnJhZyBvZiB0aGlzLl9mcmFnbWVudHMpIGZyYWcudGV4dCA9IHRoaXMuX1Byb2Nlc3NCQkNvZGVFc2NhcGVTZXF1ZW5jZXMoZnJhZy50ZXh0KTsKICAgICAgICAgICAgdGhpcy5faGFzUGFyc2VkRnJhZ21lbnRzID0gdHJ1ZTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2ZyYWdtZW50cwogICAgICAgIH0KICAgICAgICBfUHJvY2Vzc0JCQ29kZUVzY2FwZVNlcXVlbmNlcyh0ZXh0KSB7CiAgICAgICAgICAgIHRleHQgPSBDMy5SZXBsYWNlQWxsKHRleHQsICJcXFsiLCAiWyIpOwogICAgICAgICAgICByZXR1cm4gQzMuUmVwbGFjZUFsbCh0ZXh0LCAiXFxcXCIsICJcXCIpCiAgICAgICAgfQogICAgICAgIHN0YXRpYyBTdHJpcFRhZ3Moc3RyKSB7CiAgICAgICAgICAgIHJldHVybiBDMy5OZXcoQzMuQkJTdHJpbmcsIHN0ciwgewogICAgICAgICAgICAgICAgbm9Fc2NhcGU6IHRydWUKICAgICAgICAgICAgfSkudG9QbGFpblRleHQoKQogICAgICAgIH0KICAgICAgICBzdGF0aWMgU3RyaXBBbnlUYWdzKHN0cikgewogICAgICAgICAgICByZXR1cm4gc3RyLnJlcGxhY2UoQ1VTVE9NX0JCUkVHRVgsICIiKQogICAgICAgIH0KICAgIH07Cgp9CgovLyAuLi9saWIvc3RyL3dvcmRXcmFwLmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKCiAgICBmdW5jdGlvbiBJc1dvcmRCcmVha1doaXRlU3BhY2UoY2gpIHsKICAgICAgICBpZiAoY2ggPT09ICJcdTAwYTAiIHx8IGNoID09PSAiXHUyMDJmIikgcmV0dXJuIGZhbHNlOwogICAgICAgIGVsc2UgcmV0dXJuIEMzLklzV2hpdGVzcGFjZUNoYXIoY2gpCiAgICB9CgogICAgZnVuY3Rpb24gV29yZEJyZWFrVHJpbUVuZChjaEFycikgewogICAgICAgIHdoaWxlIChjaEFyci5sZW5ndGggPiAwICYmIElzV29yZEJyZWFrV2hpdGVTcGFjZShjaEFyci5hdCgtMSkpKSBjaEFyci5wb3AoKQogICAgfQoKICAgIGZ1bmN0aW9uIElzTmV3bGluZShjaCkgewogICAgICAgIHJldHVybiBjaCA9PT0gIlxuIiB8fCBjaCA9PT0gIlxyXG4iCiAgICB9CiAgICBDMy5Xb3JkV3JhcCA9IGNsYXNzIFdvcmRXcmFwIHsKICAgICAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgICAgICAgdGhpcy5fbGluZXMgPSBbXQogICAgICAgIH0KICAgICAgICBHZXRMaW5lcygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2xpbmVzCiAgICAgICAgfQogICAgICAgIEdldExpbmVDb3VudCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2xpbmVzLmxlbmd0aAogICAgICAgIH0KICAgICAgICBfTWVhc3VyZUxpbmUobGluZSwgbWVhc3VyZUZ1bmMpIHsKICAgICAgICAgICAgbGV0IHdpZHRoID0gMDsKICAgICAgICAgICAgbGV0IGhlaWdodCA9IDA7CiAgICAgICAgICAgIGxldCBmYmJBc2NlbnQgPSAwOwogICAgICAgICAgICBsZXQgZmJiRGVzY2VudCA9IDA7CiAgICAgICAgICAgIGxldCB0b3BUb0FscGhhYmV0aWNEaXN0YW5jZSA9IDA7CiAgICAgICAgICAgIGZvciAoY29uc3QgZnJhZyBvZiBsaW5lKSB7CiAgICAgICAgICAgICAgICBpZiAoZnJhZy53aWR0aCA9PT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBtID0gbWVhc3VyZUZ1bmMoZnJhZy5jaEFyciwgZnJhZy5zdHlsZXMpOwogICAgICAgICAgICAgICAgICAgIGZyYWcud2lkdGggPSBtLndpZHRoOwogICAgICAgICAgICAgICAgICAgIGZyYWcuaGVpZ2h0ID0gbS5oZWlnaHQ7CiAgICAgICAgICAgICAgICAgICAgZnJhZy5mb250Qm91bmRpbmdCb3hBc2NlbnQgPSBtLmZvbnRCb3VuZGluZ0JveEFzY2VudCB8fCAwOwogICAgICAgICAgICAgICAgICAgIGZyYWcuZm9udEJvdW5kaW5nQm94RGVzY2VudCA9IG0uZm9udEJvdW5kaW5nQm94RGVzY2VudCB8fCAwOwogICAgICAgICAgICAgICAgICAgIGZyYWcudG9wVG9BbHBoYWJldGljRGlzdGFuY2UgPQogICAgICAgICAgICAgICAgICAgICAgICBtLnRvcFRvQWxwaGFiZXRpY0Rpc3RhbmNlIHx8IDAKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHdpZHRoICs9IGZyYWcud2lkdGg7CiAgICAgICAgICAgICAgICBoZWlnaHQgPSBNYXRoLm1heChoZWlnaHQsIGZyYWcuaGVpZ2h0KTsKICAgICAgICAgICAgICAgIGZiYkFzY2VudCA9IE1hdGgubWF4KGZiYkFzY2VudCwgZnJhZy5mb250Qm91bmRpbmdCb3hBc2NlbnQpOwogICAgICAgICAgICAgICAgZmJiRGVzY2VudCA9IE1hdGgubWF4KGZiYkRlc2NlbnQsIGZyYWcuZm9udEJvdW5kaW5nQm94RGVzY2VudCk7CiAgICAgICAgICAgICAgICB0b3BUb0FscGhhYmV0aWNEaXN0YW5jZSA9IE1hdGgubWF4KHRvcFRvQWxwaGFiZXRpY0Rpc3RhbmNlLCBmcmFnLnRvcFRvQWxwaGFiZXRpY0Rpc3RhbmNlKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICB3aWR0aCwKICAgICAgICAgICAgICAgIGhlaWdodCwKICAgICAgICAgICAgICAgIGZvbnRCb3VuZGluZ0JveEFzY2VudDogZmJiQXNjZW50LAogICAgICAgICAgICAgICAgZm9udEJvdW5kaW5nQm94RGVzY2VudDogZmJiRGVzY2VudCwKICAgICAgICAgICAgICAgIHRvcFRvQWxwaGFiZXRpY0Rpc3RhbmNlCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgX0FkZExpbmUoZnJhZ21lbnRzLCB3aWR0aCwgaGVpZ2h0LCBmYmJBc2NlbnQsIGZiYkRlc2NlbnQsIHRvcFRvQWxwaGFiZXRpY0Rpc3RhbmNlKSB7CiAgICAgICAgICAgIHRoaXMuX2xpbmVzLnB1c2goewogICAgICAgICAgICAgICAgZnJhZ21lbnRzLAogICAgICAgICAgICAgICAgd2lkdGgsCiAgICAgICAgICAgICAgICBoZWlnaHQsCiAgICAgICAgICAgICAgICBmb250Qm91bmRpbmdCb3hBc2NlbnQ6IGZiYkFzY2VudCwKICAgICAgICAgICAgICAgIGZvbnRCb3VuZGluZ0JveERlc2NlbnQ6IGZiYkRlc2NlbnQsCiAgICAgICAgICAgICAgICB0b3BUb0FscGhhYmV0aWNEaXN0YW5jZQogICAgICAgICAgICB9KQogICAgICAgIH0KICAgICAgICBXb3JkV3JhcChmcmFnbWVudEFyciwgbWVhc3VyZUZ1bmMsIHdyYXBXaWR0aCwgd3JhcE1vZGUsIGVuZE9mTGluZU1hcmdpbikgewogICAgICAgICAgICBpZiAodHlwZW9mIGZyYWdtZW50QXJyID09PSAic3RyaW5nIikgZnJhZ21lbnRBcnIgPSBbewogICAgICAgICAgICAgICAgdGV4dDogZnJhZ21lbnRBcnIsCiAgICAgICAgICAgICAgICBzdHlsZXM6IFtdCiAgICAgICAgICAgIH1dOwogICAgICAgICAgICBDMy5jbGVhckFycmF5KHRoaXMuX2xpbmVzKTsKICAgICAgICAgICAgaWYgKCFmcmFnbWVudEFyci5sZW5ndGggfHwgZnJhZ21lbnRBcnIubGVuZ3RoID09PSAxICYmICFmcmFnbWVudEFyclswXS50ZXh0Lmxlbmd0aCB8fCB3cmFwV2lkdGggPCAyKSByZXR1cm47CiAgICAgICAgICAgIGZyYWdtZW50QXJyID0gZnJhZ21lbnRBcnIubWFwKGZyYWcgPT4gKHsKICAgICAgICAgICAgICAgIGNoQXJyOiBDMy5TcGxpdEdyYXBoZW1lcyhmcmFnLnRleHQpLAogICAgICAgICAgICAgICAgc3R5bGVzOiBmcmFnLnN0eWxlcwogICAgICAgICAgICB9KSk7CiAgICAgICAgICAgIGlmIChmcmFnbWVudEFyci5sZW5ndGggPT09IDEpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGZyYWcgPQogICAgICAgICAgICAgICAgICAgIGZyYWdtZW50QXJyWzBdOwogICAgICAgICAgICAgICAgY29uc3QgY2hBcnIgPSBmcmFnLmNoQXJyOwogICAgICAgICAgICAgICAgY29uc3Qgc3R5bGVzID0gZnJhZy5zdHlsZXM7CiAgICAgICAgICAgICAgICBpZiAoY2hBcnIubGVuZ3RoIDw9IDEwMCAmJiAhY2hBcnIuaW5jbHVkZXMoIlxuIikpIHsKICAgICAgICAgICAgICAgICAgICBsZXQgewogICAgICAgICAgICAgICAgICAgICAgICB3aWR0aCwKICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0LAogICAgICAgICAgICAgICAgICAgICAgICBmb250Qm91bmRpbmdCb3hBc2NlbnQsCiAgICAgICAgICAgICAgICAgICAgICAgIGZvbnRCb3VuZGluZ0JveERlc2NlbnQsCiAgICAgICAgICAgICAgICAgICAgICAgIHRvcFRvQWxwaGFiZXRpY0Rpc3RhbmNlCiAgICAgICAgICAgICAgICAgICAgfSA9IG1lYXN1cmVGdW5jKGNoQXJyLCBzdHlsZXMpOwogICAgICAgICAgICAgICAgICAgIHdpZHRoICs9IGVuZE9mTGluZU1hcmdpbjsKICAgICAgICAgICAgICAgICAgICBmb250Qm91bmRpbmdCb3hBc2NlbnQgPSBmb250Qm91bmRpbmdCb3hBc2NlbnQgfHwgMDsKICAgICAgICAgICAgICAgICAgICBmb250Qm91bmRpbmdCb3hEZXNjZW50ID0gZm9udEJvdW5kaW5nQm94RGVzY2VudCB8fCAwOwogICAgICAgICAgICAgICAgICAgIHRvcFRvQWxwaGFiZXRpY0Rpc3RhbmNlID0gdG9wVG9BbHBoYWJldGljRGlzdGFuY2UgfHwgMDsKICAgICAgICAgICAgICAgICAgICBpZiAod2lkdGggPD0gd3JhcFdpZHRoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX0FkZExpbmUoW3sKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaEFyciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHlsZXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvbnRCb3VuZGluZ0JveEFzY2VudCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb250Qm91bmRpbmdCb3hEZXNjZW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcFRvQWxwaGFiZXRpY0Rpc3RhbmNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoLCBoZWlnaHQsIGZvbnRCb3VuZGluZ0JveEFzY2VudCwgZm9udEJvdW5kaW5nQm94RGVzY2VudCwgdG9wVG9BbHBoYWJldGljRGlzdGFuY2UpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGV0IHRva2VuaXNlZEZyYWdtZW50czsKICAgICAgICAgICAgaWYgKHdyYXBNb2RlID09PSAid29yZCIpIHRva2VuaXNlZEZyYWdtZW50cyA9IHRoaXMuX1Rva2VuaXNlV29yZHMoZnJhZ21lbnRBcnIpOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIHRva2VuaXNlZEZyYWdtZW50cyA9IFtdOwogICAgICAgICAgICAgICAgZm9yIChjb25zdCBmcmFnIG9mIGZyYWdtZW50QXJyKSBDMy5hcHBlbmRBcnJheSh0b2tlbmlzZWRGcmFnbWVudHMsIGZyYWcuY2hBcnIubWFwKGNoID0+IFt7CiAgICAgICAgICAgICAgICAgICAgY2hBcnI6IFtjaF0sCiAgICAgICAgICAgICAgICAgICAgc3R5bGVzOiBmcmFnLnN0eWxlcwogICAgICAgICAgICAgICAgfV0pKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuX1dyYXBUZXh0KHRva2VuaXNlZEZyYWdtZW50cywgbWVhc3VyZUZ1bmMsIHdyYXBXaWR0aCwgZW5kT2ZMaW5lTWFyZ2luKQogICAgICAgIH0KICAgICAgICBfVG9rZW5pc2VXb3JkcyhmcmFnbWVudEFycikgewogICAgICAgICAgICBjb25zdCByZXQgPSBbXTsKICAgICAgICAgICAgbGV0IGN1cldvcmQgPSBbXTsKICAgICAgICAgICAgbGV0IGlzQ3VyV2hpdGVzcGFjZSA9IGZhbHNlOwogICAgICAgICAgICBmb3IgKGNvbnN0IGZyYWcgb2YgZnJhZ21lbnRBcnIpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGNoQXJyID0KICAgICAgICAgICAgICAgICAgICBmcmFnLmNoQXJyOwogICAgICAgICAgICAgICAgY29uc3Qgc3R5bGVzID0gZnJhZy5zdHlsZXM7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGNoIG9mIGNoQXJyKQogICAgICAgICAgICAgICAgICAgIGlmIChJc05ld2xpbmUoY2gpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJXb3JkLmxlbmd0aCA+IDApIHJldC5wdXNoKGN1cldvcmQpOwogICAgICAgICAgICAgICAgICAgICAgICByZXQucHVzaChbewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hBcnI6IFsiXG4iXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlcwogICAgICAgICAgICAgICAgICAgICAgICB9XSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGN1cldvcmQgPSBbXQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoY3VyV29yZC5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICAgICAgICBjdXJXb3JkLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICBjaEFycjogW2NoXSwKICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGVzCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgaXNDdXJXaGl0ZXNwYWNlID0gSXNXb3JkQnJlYWtXaGl0ZVNwYWNlKGNoKQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBpc1doaXRlc3BhY2UgPSBJc1dvcmRCcmVha1doaXRlU3BhY2UoY2gpOwogICAgICAgICAgICAgICAgICAgIGlmIChpc1doaXRlc3BhY2UgPT09IGlzQ3VyV2hpdGVzcGFjZSkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjdXJGcmFnID0gY3VyV29yZC5hdCgtMSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJGcmFnLnN0eWxlcyA9PT0gc3R5bGVzKSBjdXJGcmFnLmNoQXJyLnB1c2goY2gpOwogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGN1cldvcmQucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaEFycjogW2NoXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlcwogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldC5wdXNoKGN1cldvcmQpOwogICAgICAgICAgICAgICAgICAgICAgICBjdXJXb3JkID0gW107CiAgICAgICAgICAgICAgICAgICAgICAgIGN1cldvcmQucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaEFycjogW2NoXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlcwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgaXNDdXJXaGl0ZXNwYWNlID0gaXNXaGl0ZXNwYWNlCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChjdXJXb3JkLmxlbmd0aCA+IDApIHJldC5wdXNoKGN1cldvcmQpOwogICAgICAgICAgICByZXR1cm4gcmV0CiAgICAgICAgfQogICAgICAgIF9Db3B5TGluZShsaW5lKSB7CiAgICAgICAgICAgIHJldHVybiBsaW5lLm1hcChmID0+ICh7CiAgICAgICAgICAgICAgICBjaEFycjogZi5jaEFyci5zbGljZSgwKSwKICAgICAgICAgICAgICAgIHN0eWxlczogZi5zdHlsZXMsCiAgICAgICAgICAgICAgICB3aWR0aDogZi53aWR0aCwKICAgICAgICAgICAgICAgIGhlaWdodDogZi5oZWlnaHQsCiAgICAgICAgICAgICAgICBmb250Qm91bmRpbmdCb3hBc2NlbnQ6IGYuZm9udEJvdW5kaW5nQm94QXNjZW50LAogICAgICAgICAgICAgICAgZm9udEJvdW5kaW5nQm94RGVzY2VudDogZi5mb250Qm91bmRpbmdCb3hEZXNjZW50LAogICAgICAgICAgICAgICAgdG9wVG9BbHBoYWJldGljRGlzdGFuY2U6IGYudG9wVG9BbHBoYWJldGljRGlzdGFuY2UKICAgICAgICAgICAgfSkpCiAgICAgICAgfQogICAgICAgIF9BZGRXb3JkVG9MaW5lKGN1cnJlbnRMaW5lLCBjdXJXb3JkKSB7CiAgICAgICAgICAgIGNvbnN0IGxhc3RGcmFnID0gY3VycmVudExpbmUubGVuZ3RoID8gY3VycmVudExpbmUuYXQoLTEpIDogbnVsbDsKICAgICAgICAgICAgbGV0IGkgPSAwOwogICAgICAgICAgICBpZiAobGFzdEZyYWcgJiYgY3VyV29yZFswXS5zdHlsZXMgPT09IGxhc3RGcmFnLnN0eWxlcykgewogICAgICAgICAgICAgICAgQzMuYXBwZW5kQXJyYXkobGFzdEZyYWcuY2hBcnIsCiAgICAgICAgICAgICAgICAgICAgY3VyV29yZFswXS5jaEFycik7CiAgICAgICAgICAgICAgICBsYXN0RnJhZy53aWR0aCA9IC0xOwogICAgICAgICAgICAgICAgbGFzdEZyYWcuaGVpZ2h0ID0gLTE7CiAgICAgICAgICAgICAgICBsYXN0RnJhZy5mb250Qm91bmRpbmdCb3hBc2NlbnQgPSAtMTsKICAgICAgICAgICAgICAgIGxhc3RGcmFnLmZvbnRCb3VuZGluZ0JveERlc2NlbnQgPSAtMTsKICAgICAgICAgICAgICAgIGxhc3RGcmFnLnRvcFRvQWxwaGFiZXRpY0Rpc3RhbmNlID0gLTE7CiAgICAgICAgICAgICAgICBpID0gMQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciAobGV0IGxlbiA9IGN1cldvcmQubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGYgPSBjdXJXb3JkW2ldOwogICAgICAgICAgICAgICAgY3VycmVudExpbmUucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgY2hBcnI6IGYuY2hBcnIuc2xpY2UoMCksCiAgICAgICAgICAgICAgICAgICAgc3R5bGVzOiBmLnN0eWxlcywKICAgICAgICAgICAgICAgICAgICB3aWR0aDogLTEsCiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiAtMSwKICAgICAgICAgICAgICAgICAgICBmb250Qm91bmRpbmdCb3hBc2NlbnQ6IC0xLAogICAgICAgICAgICAgICAgICAgIGZvbnRCb3VuZGluZ0JveERlc2NlbnQ6IC0xLAogICAgICAgICAgICAgICAgICAgIHRvcFRvQWxwaGFiZXRpY0Rpc3RhbmNlOiAtMQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBfV3JhcFRleHQodG9rZW5pc2VkRnJhZ21lbnRzLCBtZWFzdXJlRnVuYywgd3JhcFdpZHRoLCBlbmRPZkxpbmVNYXJnaW4pIHsKICAgICAgICAgICAgbGV0IGN1cnJlbnRMaW5lID0gW107CiAgICAgICAgICAgIGxldCBjdXJyZW50TGluZVdpZHRoID0gMDsKICAgICAgICAgICAgbGV0IGN1cnJlbnRMaW5lSGVpZ2h0ID0KICAgICAgICAgICAgICAgIDA7CiAgICAgICAgICAgIGxldCBjdXJyZW50TGluZUZiYkFzY2VudCA9IDA7CiAgICAgICAgICAgIGxldCBjdXJyZW50TGluZUZiYkRlc2NlbnQgPSAwOwogICAgICAgICAgICBsZXQgY3VycmVudExpbmVUb3BUb0FscGhhYmV0aWMgPSAwOwogICAgICAgICAgICBmb3IgKGNvbnN0IGN1cldvcmQgb2YgdG9rZW5pc2VkRnJhZ21lbnRzKSB7CiAgICAgICAgICAgICAgICBpZiAoY3VyV29yZC5sZW5ndGggPT09IDEgJiYgY3VyV29yZFswXS5jaEFyci5sZW5ndGggPT09IDEgJiYgSXNOZXdsaW5lKGN1cldvcmRbMF0uY2hBcnJbMF0pKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRMaW5lSGVpZ2h0ID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG0gPSBtZWFzdXJlRnVuYyhbIiAiXSwgY3VyV29yZFswXS5zdHlsZXMpOwogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50TGluZUhlaWdodCA9IG0uaGVpZ2h0OwogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50TGluZUZiYkFzY2VudCA9IG0uZm9udEJvdW5kaW5nQm94QXNjZW50IHx8IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRMaW5lRmJiRGVzY2VudCA9IG0uZm9udEJvdW5kaW5nQm94RGVzY2VudCB8fCAwOwogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50TGluZVRvcFRvQWxwaGFiZXRpYyA9IG0udG9wVG9BbHBoYWJldGljRGlzdGFuY2UgfHwgMAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9BZGRMaW5lKGN1cnJlbnRMaW5lLCBjdXJyZW50TGluZVdpZHRoLAogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50TGluZUhlaWdodCwgY3VycmVudExpbmVGYmJBc2NlbnQsIGN1cnJlbnRMaW5lRmJiRGVzY2VudCwgY3VycmVudExpbmVUb3BUb0FscGhhYmV0aWMpOwogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRMaW5lID0gW107CiAgICAgICAgICAgICAgICAgICAgY3VycmVudExpbmVXaWR0aCA9IDA7CiAgICAgICAgICAgICAgICAgICAgY3VycmVudExpbmVIZWlnaHQgPSAwOwogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRMaW5lRmJiQXNjZW50ID0gMDsKICAgICAgICAgICAgICAgICAgICBjdXJyZW50TGluZUZiYkRlc2NlbnQgPSAwOwogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRMaW5lVG9wVG9BbHBoYWJldGljID0gMDsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY29uc3QgdHJ5TGluZSA9IHRoaXMuX0NvcHlMaW5lKGN1cnJlbnRMaW5lKTsKICAgICAgICAgICAgICAgIHRoaXMuX0FkZFdvcmRUb0xpbmUodHJ5TGluZSwgY3VyV29yZCk7CiAgICAgICAgICAgICAgICBjb25zdCB0cnlNZXRyaWNzID0gdGhpcy5fTWVhc3VyZUxpbmUodHJ5TGluZSwgbWVhc3VyZUZ1bmMpOwogICAgICAgICAgICAgICAgY29uc3QgdHJ5TGluZVdpZHRoID0gdHJ5TWV0cmljcy53aWR0aDsKICAgICAgICAgICAgICAgIGlmICh0cnlMaW5lV2lkdGggPj0gd3JhcFdpZHRoKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRMaW5lLmxlbmd0aCA+IDApIHRoaXMuX0FkZExpbmUoY3VycmVudExpbmUsIGN1cnJlbnRMaW5lV2lkdGgsIGN1cnJlbnRMaW5lSGVpZ2h0LAogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50TGluZUZiYkFzY2VudCwgY3VycmVudExpbmVGYmJEZXNjZW50LCBjdXJyZW50TGluZVRvcFRvQWxwaGFiZXRpYyk7CiAgICAgICAgICAgICAgICAgICAgY3VycmVudExpbmUgPSBbXTsKICAgICAgICAgICAgICAgICAgICBpZiAoQzMuSXNDaGFyQXJyYXlBbGxXaGl0ZXNwYWNlKGN1cldvcmRbMF0uY2hBcnIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRMaW5lV2lkdGggPSAwOwogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50TGluZUhlaWdodCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRMaW5lRmJiQXNjZW50ID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudExpbmVGYmJEZXNjZW50ID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudExpbmVUb3BUb0FscGhhYmV0aWMgPSAwCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fQWRkV29yZFRvTGluZShjdXJyZW50TGluZSwgY3VyV29yZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG1ldHJpY3MgPSB0aGlzLl9NZWFzdXJlTGluZShjdXJyZW50TGluZSwgbWVhc3VyZUZ1bmMpOwogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50TGluZVdpZHRoID0gbWV0cmljcy53aWR0aDsKICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudExpbmVIZWlnaHQgPSBtZXRyaWNzLmhlaWdodDsKICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudExpbmVGYmJBc2NlbnQgPSBtZXRyaWNzLmZvbnRCb3VuZGluZ0JveEFzY2VudDsKICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudExpbmVGYmJEZXNjZW50ID0gbWV0cmljcy5mb250Qm91bmRpbmdCb3hEZXNjZW50OwogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50TGluZVRvcFRvQWxwaGFiZXRpYyA9IG1ldHJpY3MudG9wVG9BbHBoYWJldGljRGlzdGFuY2UKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRMaW5lID0gdHJ5TGluZTsKICAgICAgICAgICAgICAgICAgICBjdXJyZW50TGluZVdpZHRoID0gdHJ5TGluZVdpZHRoOwogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRMaW5lSGVpZ2h0ID0gdHJ5TWV0cmljcy5oZWlnaHQ7CiAgICAgICAgICAgICAgICAgICAgY3VycmVudExpbmVGYmJBc2NlbnQgPSB0cnlNZXRyaWNzLmZvbnRCb3VuZGluZ0JveEFzY2VudDsKICAgICAgICAgICAgICAgICAgICBjdXJyZW50TGluZUZiYkRlc2NlbnQgPSB0cnlNZXRyaWNzLmZvbnRCb3VuZGluZ0JveERlc2NlbnQ7CiAgICAgICAgICAgICAgICAgICAgY3VycmVudExpbmVUb3BUb0FscGhhYmV0aWMgPSB0cnlNZXRyaWNzLnRvcFRvQWxwaGFiZXRpY0Rpc3RhbmNlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGN1cnJlbnRMaW5lLmxlbmd0aCA+IDApIHRoaXMuX0FkZExpbmUoY3VycmVudExpbmUsIGN1cnJlbnRMaW5lV2lkdGgsIGN1cnJlbnRMaW5lSGVpZ2h0LCBjdXJyZW50TGluZUZiYkFzY2VudCwgY3VycmVudExpbmVGYmJEZXNjZW50LCBjdXJyZW50TGluZVRvcFRvQWxwaGFiZXRpYyk7CiAgICAgICAgICAgIHRoaXMuX1RyaW1MaW5lc1RyYWlsaW5nV2hpdGVzcGFjZShtZWFzdXJlRnVuYywKICAgICAgICAgICAgICAgIGVuZE9mTGluZU1hcmdpbikKICAgICAgICB9CiAgICAgICAgX1RyaW1MaW5lc1RyYWlsaW5nV2hpdGVzcGFjZShtZWFzdXJlRnVuYywgZW5kT2ZMaW5lTWFyZ2luKSB7CiAgICAgICAgICAgIGZvciAoY29uc3QgbGluZSBvZiB0aGlzLl9saW5lcykgewogICAgICAgICAgICAgICAgY29uc3QgZnJhZ21lbnRzID0gbGluZS5mcmFnbWVudHM7CiAgICAgICAgICAgICAgICBpZiAoIWZyYWdtZW50cy5sZW5ndGgpIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgbGV0IGxhc3RGcmFnID0gZnJhZ21lbnRzLmF0KC0xKTsKICAgICAgICAgICAgICAgIGNvbnN0IGNoQXJyID0gbGFzdEZyYWcuY2hBcnI7CiAgICAgICAgICAgICAgICBjb25zdCB0cmltbWVkQXJyID0gY2hBcnIuc2xpY2UoMCk7CiAgICAgICAgICAgICAgICBXb3JkQnJlYWtUcmltRW5kKHRyaW1tZWRBcnIpOwogICAgICAgICAgICAgICAgaWYgKHRyaW1tZWRBcnIubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgbGluZS53aWR0aCAtPSBsYXN0RnJhZy53aWR0aDsKICAgICAgICAgICAgICAgICAgICBmcmFnbWVudHMucG9wKCkKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodHJpbW1lZEFyci5sZW5ndGggPCBjaEFyci5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCB0cmltbWVkV2lkdGggPSBtZWFzdXJlRnVuYyh0cmltbWVkQXJyLCBsYXN0RnJhZy5zdHlsZXMpLndpZHRoOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGRpZmYgPSBsYXN0RnJhZy53aWR0aCAtIHRyaW1tZWRXaWR0aDsKICAgICAgICAgICAgICAgICAgICBsYXN0RnJhZy53aWR0aCA9CiAgICAgICAgICAgICAgICAgICAgICAgIHRyaW1tZWRXaWR0aDsKICAgICAgICAgICAgICAgICAgICBsYXN0RnJhZy5jaEFyciA9IHRyaW1tZWRBcnI7CiAgICAgICAgICAgICAgICAgICAgbGluZS53aWR0aCAtPSBkaWZmCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoZW5kT2ZMaW5lTWFyZ2luICE9PSAwICYmIGZyYWdtZW50cy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgbGFzdEZyYWcgPSBmcmFnbWVudHMuYXQoLTEpOwogICAgICAgICAgICAgICAgICAgIGxhc3RGcmFnLndpZHRoICs9IGVuZE9mTGluZU1hcmdpbjsKICAgICAgICAgICAgICAgICAgICBsaW5lLndpZHRoICs9IGVuZE9mTGluZU1hcmdpbgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIENsZWFyKCkgewogICAgICAgICAgICBDMy5jbGVhckFycmF5KHRoaXMuX2xpbmVzKQogICAgICAgIH0KICAgICAgICBHZXRNYXhMaW5lV2lkdGgoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9saW5lcy5yZWR1Y2UoKGEsIHYpID0+IE1hdGgubWF4KGEsIHYud2lkdGgpLCAwKQogICAgICAgIH0KICAgICAgICBHZXRUb3RhbExpbmVIZWlnaHQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9saW5lcy5yZWR1Y2UoKGEsIHYpID0+IGEgKyB2LmhlaWdodCwgMCkKICAgICAgICB9CiAgICB9OwoKfQoKLy8gLi4vbGliL2dmeC9nZnguanMKewogICAgJ3VzZSBzdHJpY3QnOwogICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgY29uc3QgZ2xNYXRyaXggPSBzZWxmLmdsTWF0cml4OwogICAgY29uc3QgdmVjMyA9IGdsTWF0cml4LnZlYzM7CiAgICBjb25zdCB2ZWM0ID0gZ2xNYXRyaXgudmVjNDsKICAgIGNvbnN0IG1hdDQgPSBnbE1hdHJpeC5tYXQ0OwogICAgY29uc3QgdGVtcFZlYzNhID0gdmVjMy5jcmVhdGUoKTsKICAgIGNvbnN0IHRlbXBWZWMzYiA9IHZlYzMuY3JlYXRlKCk7CiAgICBjb25zdCB0ZW1wVmVjM2MgPSB2ZWMzLmNyZWF0ZSgpOwogICAgY29uc3QgdGVtcFZlYzQgPSB2ZWM0LmNyZWF0ZSgpOwogICAgY29uc3QgdGVtcE1hdDQgPSBtYXQ0LmNyZWF0ZSgpOwogICAgY29uc3QgbmVhcnRsID0gdmVjMy5jcmVhdGUoKTsKICAgIGNvbnN0IG5lYXJ0ciA9IHZlYzMuY3JlYXRlKCk7CiAgICBjb25zdCBuZWFyYmwgPSB2ZWMzLmNyZWF0ZSgpOwogICAgY29uc3QgbmVhcmJyID0gdmVjMy5jcmVhdGUoKTsKICAgIGNvbnN0IGZhcnRsID0gdmVjMy5jcmVhdGUoKTsKICAgIGNvbnN0IGZhcnRyID0gdmVjMy5jcmVhdGUoKTsKICAgIGNvbnN0IGZhcmJsID0gdmVjMy5jcmVhdGUoKTsKICAgIGNvbnN0IGZhcmJyID0gdmVjMy5jcmVhdGUoKTsKICAgIGNvbnN0IHVuaXRWaWV3cG9ydCA9IHZlYzQuZnJvbVZhbHVlcygwLCAwLCAxLCAxKTsKICAgIEMzLkdmeCA9IHsKICAgICAgICBQcm9qZWN0KG9iangsIG9ianksIG9ianosIG12LCBwcm9qLCB2aWV3cG9ydCwgd2luZG93Q29vcmRpbmF0ZSkgewogICAgICAgICAgICBjb25zdCBmVGVtcDAgPSBtdlswXSAqIG9ianggKyBtdls0XSAqIG9iankgKyBtdls4XSAqIG9ianogKyBtdlsxMl07CiAgICAgICAgICAgIGNvbnN0IGZUZW1wMSA9IG12WzFdICogb2JqeCArIG12WzVdICogb2JqeSArIG12WzldICogb2JqeiArIG12WzEzXTsKICAgICAgICAgICAgY29uc3QgZlRlbXAyID0gbXZbMl0gKiBvYmp4ICsgbXZbNl0gKiBvYmp5ICsgbXZbMTBdICogb2JqeiArIG12WzE0XTsKICAgICAgICAgICAgY29uc3QgZlRlbXAzID0gbXZbM10gKiBvYmp4ICsgbXZbN10gKiBvYmp5ICsgbXZbMTFdICogb2JqeiArIG12WzE1XTsKICAgICAgICAgICAgbGV0IGZUZW1wNCA9IHByb2pbMF0gKiBmVGVtcDAgKyBwcm9qWzRdICogZlRlbXAxICsgcHJvals4XSAqIGZUZW1wMiArIHByb2pbMTJdICogZlRlbXAzOwogICAgICAgICAgICBsZXQgZlRlbXA1ID0gcHJvalsxXSAqIGZUZW1wMCArIHByb2pbNV0gKiBmVGVtcDEgKyBwcm9qWzldICogZlRlbXAyICsgcHJvalsxM10gKiBmVGVtcDM7CiAgICAgICAgICAgIGxldCBmVGVtcDYgPSBwcm9qWzJdICogZlRlbXAwICsgcHJvals2XSAqIGZUZW1wMSArIHByb2pbMTBdICogZlRlbXAyICsgcHJvalsxNF0gKiBmVGVtcDM7CiAgICAgICAgICAgIGxldCBmVGVtcDcgPQogICAgICAgICAgICAgICAgcHJvalszXSAqIGZUZW1wMCArIHByb2pbN10gKiBmVGVtcDEgKyBwcm9qWzExXSAqIGZUZW1wMiArIHByb2pbMTVdICogZlRlbXAzOwogICAgICAgICAgICBpZiAoZlRlbXA3ID09PSAwKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGZUZW1wNyA9IDEgLyBmVGVtcDc7CiAgICAgICAgICAgIGZUZW1wNCAqPSBmVGVtcDc7CiAgICAgICAgICAgIGZUZW1wNSAqPSBmVGVtcDc7CiAgICAgICAgICAgIGZUZW1wNiAqPSBmVGVtcDc7CiAgICAgICAgICAgIHdpbmRvd0Nvb3JkaW5hdGVbMF0gPSAoZlRlbXA0ICogLjUgKyAuNSkgKiB2aWV3cG9ydFsyXSArIHZpZXdwb3J0WzBdOwogICAgICAgICAgICB3aW5kb3dDb29yZGluYXRlWzFdID0gKGZUZW1wNSAqIC41ICsgLjUpICogdmlld3BvcnRbM10gKyB2aWV3cG9ydFsxXTsKICAgICAgICAgICAgd2luZG93Q29vcmRpbmF0ZVsyXSA9ICgxICsgZlRlbXA2KSAqIC41OwogICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgIH0sCiAgICAgICAgVW5wcm9qZWN0KHdpbngsIHdpbnksIHdpbnosIG12LCBwcm9qLCB2aWV3cG9ydCwgb2JqZWN0Q29vcmRpbmF0ZSkgewogICAgICAgICAgICBjb25zdCBBID0gdGVtcE1hdDQ7CiAgICAgICAgICAgIGNvbnN0IHZlYyA9IHRlbXBWZWM0OwogICAgICAgICAgICBtYXQ0Lm11bHRpcGx5KEEsIHByb2osIG12KTsKICAgICAgICAgICAgaWYgKG1hdDQuaW52ZXJ0KEEsIEEpID09PSBudWxsKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIHZlY1swXSA9ICh3aW54IC0gdmlld3BvcnRbMF0pIC8KICAgICAgICAgICAgICAgIHZpZXdwb3J0WzJdICogMiAtIDE7CiAgICAgICAgICAgIHZlY1sxXSA9ICh3aW55IC0gdmlld3BvcnRbMV0pIC8gdmlld3BvcnRbM10gKiAyIC0gMTsKICAgICAgICAgICAgdmVjWzJdID0gMiAqIHdpbnogLSAxOwogICAgICAgICAgICB2ZWNbM10gPSAxOwogICAgICAgICAgICB2ZWM0LnRyYW5zZm9ybU1hdDQodmVjLCB2ZWMsIEEpOwogICAgICAgICAgICBpZiAodmVjWzNdID09PSAwKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIHZlY1szXSA9IDEgLyB2ZWNbM107CiAgICAgICAgICAgIG9iamVjdENvb3JkaW5hdGVbMF0gPSB2ZWNbMF0gKiB2ZWNbM107CiAgICAgICAgICAgIG9iamVjdENvb3JkaW5hdGVbMV0gPSB2ZWNbMV0gKiB2ZWNbM107CiAgICAgICAgICAgIG9iamVjdENvb3JkaW5hdGVbMl0gPSB2ZWNbMl0gKiB2ZWNbM107CiAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgfSwKICAgICAgICBVbnByb2plY3RTY3JlZW5Ub1dvcmxkWih3aW54LCB3aW55LCB3b3JsZFosIG12LCBwcm9qLCB2aWV3cG9ydCwgb2JqZWN0Q29vcmRpbmF0ZSkgewogICAgICAgICAgICBjb25zdCBuZWFyUHQgPSB0ZW1wVmVjM2E7CiAgICAgICAgICAgIGNvbnN0IGZhclB0ID0gdGVtcFZlYzNiOwogICAgICAgICAgICBpZiAoIUMzLkdmeC5VbnByb2plY3Qod2lueCwgd2lueSwgMCwgbXYsIHByb2osIHZpZXdwb3J0LCBuZWFyUHQpKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGlmICghQzMuR2Z4LlVucHJvamVjdCh3aW54LCB3aW55LCAxLCBtdiwgcHJvaiwKICAgICAgICAgICAgICAgICAgICB2aWV3cG9ydCwgZmFyUHQpKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGNvbnN0IGRpclZlYyA9IHRlbXBWZWMzYjsKICAgICAgICAgICAgdmVjMy5zdWJ0cmFjdChkaXJWZWMsIGZhclB0LCBuZWFyUHQpOwogICAgICAgICAgICBjb25zdCBwbGFuZU5vcm1hbCA9IHRlbXBWZWMzYzsKICAgICAgICAgICAgdmVjMy5zZXQocGxhbmVOb3JtYWwsIDAsIDAsIDEpOwogICAgICAgICAgICBjb25zdCBwbGFuZUNvbnN0YW50ID0gLXdvcmxkWjsKICAgICAgICAgICAgY29uc3QgZGVub21pbmF0b3IgPSB2ZWMzLmRvdChwbGFuZU5vcm1hbCwgZGlyVmVjKTsKICAgICAgICAgICAgbGV0IGRpc3RhbmNlID0gMDsKICAgICAgICAgICAgaWYgKGRlbm9taW5hdG9yID09PSAwKSB7CiAgICAgICAgICAgICAgICBjb25zdCBwbGFuZURpc3RUb1B0ID0gdmVjMy5kb3QocGxhbmVOb3JtYWwsIG5lYXJQdCkgKyBwbGFuZUNvbnN0YW50OwogICAgICAgICAgICAgICAgaWYgKHBsYW5lRGlzdFRvUHQgIT09IDApIHJldHVybiBmYWxzZQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZGlzdGFuY2UgPSAtKHZlYzMuZG90KG5lYXJQdCwgcGxhbmVOb3JtYWwpICsgcGxhbmVDb25zdGFudCkgLyBkZW5vbWluYXRvcjsKICAgICAgICAgICAgICAgIGlmIChkaXN0YW5jZSA8IDApIHJldHVybiBmYWxzZQogICAgICAgICAgICB9CiAgICAgICAgICAgIHZlYzMuc2NhbGVBbmRBZGQob2JqZWN0Q29vcmRpbmF0ZSwgbmVhclB0LCBkaXJWZWMsIGRpc3RhbmNlKTsKICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICB9CiAgICB9OwoKICAgIGZ1bmN0aW9uIFBsYW5lRnJvbVBvaW50cyhwdEEsIHB0QiwgcHRDLCBwbGFuZSkgewogICAgICAgIGNvbnN0IG5vcm1hbCA9IHRlbXBWZWMzYzsKICAgICAgICB2ZWMzLnN1YnRyYWN0KHRlbXBWZWMzYSwgcHRDLCBwdEIpOwogICAgICAgIHZlYzMuc3VidHJhY3QodGVtcFZlYzNiLCBwdEEsIHB0Qik7CiAgICAgICAgdmVjMy5jcm9zcyhub3JtYWwsIHRlbXBWZWMzYSwgdGVtcFZlYzNiKTsKICAgICAgICB2ZWMzLm5vcm1hbGl6ZShub3JtYWwsIG5vcm1hbCk7CiAgICAgICAgcGxhbmUuc2V0KG5vcm1hbFswXSwgbm9ybWFsWzFdLCBub3JtYWxbMl0sIHZlYzMuZG90KHB0QSwgbm9ybWFsKSkKICAgIH0KCiAgICBmdW5jdGlvbiBJc0luRnJvbnRPZlBsYW5lKG1pblgsIG1pblksIG1pblosIG1heFgsIG1heFksIG1heFosIHBsYW5lKSB7CiAgICAgICAgY29uc3QgbnggPSBwbGFuZS54OwogICAgICAgIGNvbnN0IG55ID0gcGxhbmUueTsKICAgICAgICBjb25zdCBueiA9IHBsYW5lLno7CiAgICAgICAgY29uc3QgZCA9IHBsYW5lLnc7CiAgICAgICAgY29uc3QgbnhUID0gcGxhbmUueEY7CiAgICAgICAgY29uc3QgbnlUID0gcGxhbmUueUY7CiAgICAgICAgY29uc3QgbnpUID0gcGxhbmUuekY7CiAgICAgICAgY29uc3QgbnhGID0gMSAtIG54VDsKICAgICAgICBjb25zdCBueUYgPSAxIC0gbnlUOwogICAgICAgIGNvbnN0IG56RiA9IDEgLSBuelQ7CiAgICAgICAgY29uc3QgbWluRCA9IG54ICogbWluWCAqIG54VCArIG54ICogbWF4WCAqIG54RiArIG55ICogbWluWSAqIG55VCArIG55ICogbWF4WSAqIG55RiArIG56ICogbWluWiAqIG56VCArIG56ICogbWF4WiAqIG56RjsKICAgICAgICBpZiAobWluRCA+PSBkKSByZXR1cm4gdHJ1ZTsKICAgICAgICBjb25zdCBtYXhEID0gbnggKiBtYXhYICogbnhUICsgbnggKiBtaW5YICogbnhGICsgbnkgKiBtYXhZICogbnlUICsgbnkgKiBtaW5ZICogbnlGICsgbnogKiBtYXhaICogbnpUICsgbnogKiBtaW5aICogbnpGOwogICAgICAgIHJldHVybiBtYXhEID4gZAogICAgfQoKICAgIGZ1bmN0aW9uIElzUG9pbnRJbkZyb250T2ZQbGFuZSh4LCB5LCB6LCBwbGFuZSkgewogICAgICAgIGNvbnN0IG54ID0gcGxhbmUueDsKICAgICAgICBjb25zdCBueSA9IHBsYW5lLnk7CiAgICAgICAgY29uc3QgbnogPSBwbGFuZS56OwogICAgICAgIGNvbnN0IGQgPSBwbGFuZS53OwogICAgICAgIGNvbnN0IG1pbkQgPSBueCAqIHggKyBueSAqIHkgKyBueiAqIHo7CiAgICAgICAgcmV0dXJuIG1pbkQgPj0gZAogICAgfQogICAgY2xhc3MgUGxhbmUgewogICAgICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgICAgICB0aGlzLnggPSBOYU47CiAgICAgICAgICAgIHRoaXMueSA9IE5hTjsKICAgICAgICAgICAgdGhpcy56ID0gTmFOOwogICAgICAgICAgICB0aGlzLncgPSBOYU47CiAgICAgICAgICAgIHRoaXMueEYgPSBOYU47CiAgICAgICAgICAgIHRoaXMueUYgPSBOYU47CiAgICAgICAgICAgIHRoaXMuekYgPSBOYU4KICAgICAgICB9CiAgICAgICAgc2V0KHgsIHksIHosIHcpIHsKICAgICAgICAgICAgdGhpcy54ID0geDsKICAgICAgICAgICAgdGhpcy55ID0geTsKICAgICAgICAgICAgdGhpcy56ID0gejsKICAgICAgICAgICAgdGhpcy53ID0gdzsKICAgICAgICAgICAgdGhpcy54RiA9IHggPiAwID8gMSA6IDA7CiAgICAgICAgICAgIHRoaXMueUYgPSB5ID4gMCA/IDEgOiAwOwogICAgICAgICAgICB0aGlzLnpGID0geiA+IDAgPyAxIDogMAogICAgICAgIH0KICAgIH0KICAgIEMzLkdmeC5WaWV3RnJ1c3R1bSA9IGNsYXNzIFZpZXdGcnVzdHVtIHsKICAgICAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgICAgICAgdGhpcy5fbGVmdFAgPSBuZXcgUGxhbmU7CiAgICAgICAgICAgIHRoaXMuX3RvcFAgPSBuZXcgUGxhbmU7CiAgICAgICAgICAgIHRoaXMuX3JpZ2h0UCA9IG5ldyBQbGFuZTsKICAgICAgICAgICAgdGhpcy5fYm90dG9tUCA9IG5ldyBQbGFuZTsKICAgICAgICAgICAgdGhpcy5fbmVhclAgPSBuZXcgUGxhbmU7CiAgICAgICAgICAgIHRoaXMuX2ZhclAgPSBuZXcgUGxhbmUKICAgICAgICB9CiAgICAgICAgQ2FsY3VsYXRlUGxhbmVzKG12LCBwcm9qKSB7CiAgICAgICAgICAgIGNvbnN0IHZwID0gdW5pdFZpZXdwb3J0OwogICAgICAgICAgICBDMy5HZnguVW5wcm9qZWN0KDAsIDEsIDAsIG12LCBwcm9qLCB2cCwgbmVhcnRsKTsKICAgICAgICAgICAgQzMuR2Z4LlVucHJvamVjdCgxLCAxLCAwLCBtdiwgcHJvaiwgdnAsIG5lYXJ0cik7CiAgICAgICAgICAgIEMzLkdmeC5VbnByb2plY3QoMCwgMCwgMCwgbXYsIHByb2osIHZwLCBuZWFyYmwpOwogICAgICAgICAgICBDMy5HZnguVW5wcm9qZWN0KDEsIDAsIDAsIG12LCBwcm9qLCB2cCwgbmVhcmJyKTsKICAgICAgICAgICAgQzMuR2Z4LlVucHJvamVjdCgwLCAxLCAxLCBtdiwgcHJvaiwgdnAsIGZhcnRsKTsKICAgICAgICAgICAgQzMuR2Z4LlVucHJvamVjdCgxLCAxLCAxLCBtdiwgcHJvaiwgdnAsIGZhcnRyKTsKICAgICAgICAgICAgQzMuR2Z4LlVucHJvamVjdCgwLCAwLAogICAgICAgICAgICAgICAgMSwgbXYsIHByb2osIHZwLCBmYXJibCk7CiAgICAgICAgICAgIEMzLkdmeC5VbnByb2plY3QoMSwgMCwgMSwgbXYsIHByb2osIHZwLCBmYXJicik7CiAgICAgICAgICAgIFBsYW5lRnJvbVBvaW50cyhuZWFyYmwsIG5lYXJ0bCwgZmFydGwsIHRoaXMuX2xlZnRQKTsKICAgICAgICAgICAgUGxhbmVGcm9tUG9pbnRzKG5lYXJ0bCwgbmVhcnRyLCBmYXJ0ciwgdGhpcy5fdG9wUCk7CiAgICAgICAgICAgIFBsYW5lRnJvbVBvaW50cyhuZWFydHIsIG5lYXJiciwgZmFyYnIsIHRoaXMuX3JpZ2h0UCk7CiAgICAgICAgICAgIFBsYW5lRnJvbVBvaW50cyhuZWFyYnIsIG5lYXJibCwgZmFyYmwsIHRoaXMuX2JvdHRvbVApOwogICAgICAgICAgICBQbGFuZUZyb21Qb2ludHMoZmFyYmwsIGZhcnRsLCBmYXJ0ciwgdGhpcy5fZmFyUCk7CiAgICAgICAgICAgIFBsYW5lRnJvbVBvaW50cyhuZWFyYnIsIG5lYXJ0ciwgbmVhcnRsLCB0aGlzLl9uZWFyUCkKICAgICAgICB9CiAgICAgICAgQ29udGFpbnNBQUJCKG1pblgsIG1pblksIG1pblosIG1heFgsIG1heFksIG1heFopIHsKICAgICAgICAgICAgcmV0dXJuIElzSW5Gcm9udE9mUGxhbmUobWluWCwgbWluWSwgbWluWiwgbWF4WCwgbWF4WSwgbWF4WiwgdGhpcy5fbGVmdFApICYmIElzSW5Gcm9udE9mUGxhbmUobWluWCwgbWluWSwgbWluWiwgbWF4WCwKICAgICAgICAgICAgICAgIG1heFksIG1heFosIHRoaXMuX3RvcFApICYmIElzSW5Gcm9udE9mUGxhbmUobWluWCwgbWluWSwgbWluWiwgbWF4WCwgbWF4WSwgbWF4WiwgdGhpcy5fcmlnaHRQKSAmJiBJc0luRnJvbnRPZlBsYW5lKG1pblgsIG1pblksIG1pblosIG1heFgsIG1heFksIG1heFosIHRoaXMuX2JvdHRvbVApICYmIElzSW5Gcm9udE9mUGxhbmUobWluWCwgbWluWSwgbWluWiwgbWF4WCwgbWF4WSwgbWF4WiwgdGhpcy5fbmVhclApICYmIElzSW5Gcm9udE9mUGxhbmUobWluWCwgbWluWSwgbWluWiwgbWF4WCwgbWF4WSwgbWF4WiwgdGhpcy5fZmFyUCkKICAgICAgICB9CiAgICAgICAgSXNCZWhpbmROZWFyUGxhbmUoeCwgeSwgeikgewogICAgICAgICAgICByZXR1cm4gIUlzUG9pbnRJbkZyb250T2ZQbGFuZSh4LCB5LCB6LCB0aGlzLl9uZWFyUCkKICAgICAgICB9CiAgICB9OwoKfQoKLy8gLi4vbGliL2dmeC9yZW5kZXJlckJhc2UuanMKewogICAgJ3VzZSBzdHJpY3QnOwogICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgY29uc3QgZ2xNYXRyaXggPSBzZWxmLmdsTWF0cml4OwogICAgY29uc3QgdmVjMyA9IGdsTWF0cml4LnZlYzM7CiAgICBjb25zdCB2ZWM0ID0gZ2xNYXRyaXgudmVjNDsKICAgIGNvbnN0IG1hdDQgPSBnbE1hdHJpeC5tYXQ0OwogICAgY29uc3QgdGVtcE1hdDQgPSBtYXQ0LmNyZWF0ZSgpOwogICAgY29uc3QgdG1wVmVjM2EgPSB2ZWMzLmZyb21WYWx1ZXMoMCwgMCwgMCk7CiAgICBjb25zdCB0bXBWZWMzYiA9IHZlYzMuZnJvbVZhbHVlcygwLCAwLCAwKTsKICAgIGNvbnN0IHRtcFZlYzNjID0gdmVjMy5mcm9tVmFsdWVzKDAsIDAsIDApOwogICAgY29uc3QgZGVmYXVsdFVwVmVjdG9yID0gdmVjMy5mcm9tVmFsdWVzKDAsIDEsIDApOwogICAgY29uc3QgdG1wVmVjNCA9IHZlYzQuZnJvbVZhbHVlcygwLCAwLCAwLCAwKTsKICAgIGNvbnN0IHRtcFF1YWQgPSBuZXcgQzMuUXVhZDsKICAgIGNvbnN0IHRtcFJlY3QgPSBuZXcgQzMuUmVjdDsKICAgIGNvbnN0IGRlZmF1bHRUZXhDb29yZHNRdWFkID0gbmV3IEMzLlF1YWQoMCwgMCwgMSwgMCwgMSwgMSwgMCwgMSk7CiAgICBjb25zdCBERUZBVUxUX1JFTkRFUkVSQkFTRV9PUFRTID0gewogICAgICAgIG5lYXJaOiAxLAogICAgICAgIGZhclo6IDFFNAogICAgfTsKICAgIEMzLkdmeC5SZW5kZXJlckJhc2UgPSBjbGFzcyBSZW5kZXJlckJhc2UgewogICAgICAgIGNvbnN0cnVjdG9yKG9wdHMpIHsKICAgICAgICAgICAgb3B0cyA9IE9iamVjdC5hc3NpZ24oe30sIERFRkFVTFRfUkVOREVSRVJCQVNFX09QVFMsIG9wdHMpOwogICAgICAgICAgICB0aGlzLl93aWR0aCA9IDA7CiAgICAgICAgICAgIHRoaXMuX2hlaWdodCA9IDA7CiAgICAgICAgICAgIHRoaXMuX2ZvdlkgPSBDMy50b1JhZGlhbnMoNDUpOwogICAgICAgICAgICB0aGlzLl90YW5fZm92WV8yID0gTWF0aC50YW4odGhpcy5fZm92WSAvIDIpOwogICAgICAgICAgICB0aGlzLl9tYXRQID0gbWF0NC5jcmVhdGUoKTsKICAgICAgICAgICAgdGhpcy5fbWF0TVYgPSBtYXQ0LmNyZWF0ZSgpOwogICAgICAgICAgICB0aGlzLl96QXhpc1NjYWxlID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX25lYXJaID0gb3B0cy5uZWFyWjsKICAgICAgICAgICAgdGhpcy5fZmFyWiA9IG9wdHMuZmFyWjsKICAgICAgICAgICAgdGhpcy5fYWxsU2hhZGVyUHJvZ3JhbXMgPSBbXTsKICAgICAgICAgICAgdGhpcy5fc2hhZGVyUHJvZ3JhbXNCeU5hbWUgPSBuZXcgTWFwOwogICAgICAgICAgICB0aGlzLl9zcFRleHR1cmVGaWxsID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fc3BQb2ludHMgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9zcFRpbGVtYXBGaWxsID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fc3BUaWxlUmFuZG9taXphdGlvbiA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3NwQ29sb3JGaWxsID0KICAgICAgICAgICAgICAgIG51bGw7CiAgICAgICAgICAgIHRoaXMuX3NwTGluZWFyR3JhZGllbnRGaWxsID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fc3BQZW51bWJyYUZpbGwgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9zcEhhcmRFbGxpcHNlRmlsbCA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3NwSGFyZEVsbGlwc2VPdXRsaW5lID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fc3BTbW9vdGhFbGxpcHNlRmlsbCA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3NwU21vb3RoRWxsaXBzZU91dGxpbmUgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9zcFNtb290aExpbmVGaWxsID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fc3RhdGVHcm91cHMgPSBuZXcgTWFwOwogICAgICAgICAgICB0aGlzLl9jdXJyZW50U3RhdGVHcm91cCA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX2JsZW5kTW9kZVRhYmxlID0gW107CiAgICAgICAgICAgIHRoaXMuX25hbWVkQmxlbmRNb2RlTWFwID0gbmV3IE1hcDsKICAgICAgICAgICAgdGhpcy5fYmFzZVogPSAwOwogICAgICAgICAgICB0aGlzLl9jdXJyZW50WiA9IDA7CiAgICAgICAgICAgIHRoaXMuX2xpbmVXaWR0aCA9IDE7CiAgICAgICAgICAgIHRoaXMuX2xpbmVXaWR0aFN0YWNrID0gW3RoaXMuX2xpbmVXaWR0aF07CiAgICAgICAgICAgIHRoaXMuX2xpbmVDYXAgPSAxOwogICAgICAgICAgICB0aGlzLl9saW5lQ2FwU3RhY2sgPSBbdGhpcy5fbGluZUNhcF07CiAgICAgICAgICAgIHRoaXMuX2xpbmVPZmZzZXQgPSAuNTsKICAgICAgICAgICAgdGhpcy5fbGluZU9mZnNldFN0YWNrID0gW3RoaXMuX2xpbmVPZmZzZXRdOwogICAgICAgICAgICB0aGlzLl9mcmFtZU51bWJlciA9IDA7CiAgICAgICAgICAgIHRoaXMuX2VuYWJsZU1pcG1hcHMgPSB0cnVlOwogICAgICAgICAgICB0aGlzLl9oYXNNYWpvclBlcmZvcm1hbmNlQ2F2ZWF0ID0gZmFsc2UKICAgICAgICB9CiAgICAgICAgRmlsbEluZGV4QnVmZmVyRGF0YShpbmRleERhdGEpIHsKICAgICAgICAgICAgbGV0IGkgPSAwLAogICAgICAgICAgICAgICAgbGVuID0gaW5kZXhEYXRhLmxlbmd0aCwKICAgICAgICAgICAgICAgIGZ2ID0gMDsKICAgICAgICAgICAgd2hpbGUgKGkgPCBsZW4pIHsKICAgICAgICAgICAgICAgIGluZGV4RGF0YVtpKytdID0gZnY7CiAgICAgICAgICAgICAgICBpbmRleERhdGFbaSsrXSA9IGZ2ICsgMTsKICAgICAgICAgICAgICAgIGluZGV4RGF0YVtpKytdID0gZnYgKyAyOwogICAgICAgICAgICAgICAgaW5kZXhEYXRhW2krK10gPSBmdjsKICAgICAgICAgICAgICAgIGluZGV4RGF0YVtpKytdID0gZnYgKyAyOwogICAgICAgICAgICAgICAgaW5kZXhEYXRhW2krK10gPSBmdiArIDM7CiAgICAgICAgICAgICAgICBmdiArPSA0CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgX0NsZWFyU3RhdGUoKSB7CiAgICAgICAgICAgIHRoaXMuX2Jhc2VaID0gMDsKICAgICAgICAgICAgdGhpcy5fY3VycmVudFogPSAwOwogICAgICAgICAgICB0aGlzLl9zcFRleHR1cmVGaWxsID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fc3BQb2ludHMgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9zcFRpbGVtYXBGaWxsID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fc3BUaWxlUmFuZG9taXphdGlvbiA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3NwQ29sb3JGaWxsID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fc3BMaW5lYXJHcmFkaWVudEZpbGwgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9zcFBlbnVtYnJhRmlsbCA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3NwSGFyZEVsbGlwc2VGaWxsID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fc3BIYXJkRWxsaXBzZU91dGxpbmUgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9zcFNtb290aEVsbGlwc2VGaWxsID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fc3BTbW9vdGhFbGxpcHNlT3V0bGluZSA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3NwU21vb3RoTGluZUZpbGwgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9DbGVhckFsbFNoYWRlclByb2dyYW1zKCkKICAgICAgICB9CiAgICAgICAgSW5pdFN0YXRlKCkgewogICAgICAgICAgICB0aGlzLl9DbGVhclN0YXRlKCk7CiAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRTdGF0ZUdyb3VwID0gbnVsbAogICAgICAgIH0KICAgICAgICBPbkRldmljZU9yQ29udGV4dExvc3QoKSB7CiAgICAgICAgICAgIGZvciAoY29uc3QgcyBvZiB0aGlzLl9hbGxTaGFkZXJQcm9ncmFtcykgcy5SZWxlYXNlKCk7CiAgICAgICAgICAgIHRoaXMuX0NsZWFyU3RhdGUoKQogICAgICAgIH0KICAgICAgICBHZXRXaWR0aCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3dpZHRoCiAgICAgICAgfQogICAgICAgIEdldEhlaWdodCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2hlaWdodAogICAgICAgIH0KICAgICAgICBHZXREZWZhdWx0Q2FtZXJhWih2aWV3SCkgewogICAgICAgICAgICBpZiAodGhpcy5Jc1pBeGlzU2NhbGVOb3JtYWxpemVkKCkpIHJldHVybiAxMDA7CiAgICAgICAgICAgIGVsc2UgcmV0dXJuIHZpZXdIIC8KICAgICAgICAgICAgICAgICgyICogdGhpcy5fR2V0VGFuRm92WURpdjIoKSkKICAgICAgICB9CiAgICAgICAgR2V0WkF4aXNTY2FsZUZhY3Rvcih2aWV3SCkgewogICAgICAgICAgICBpZiAodGhpcy5Jc1pBeGlzU2NhbGVOb3JtYWxpemVkKCkpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHJlYWxadW5pdHMgPSB2aWV3SCAvICgyICogdGhpcy5fR2V0VGFuRm92WURpdjIoKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVhbFp1bml0cyAvIHRoaXMuR2V0RGVmYXVsdENhbWVyYVoodmlld0gpCiAgICAgICAgICAgIH0gZWxzZSByZXR1cm4gMQogICAgICAgIH0KICAgICAgICBTZXROZWFyWih6KSB7CiAgICAgICAgICAgIHRoaXMuX25lYXJaID0gegogICAgICAgIH0KICAgICAgICBHZXROZWFyWigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX25lYXJaCiAgICAgICAgfQogICAgICAgIFNldEZhclooeikgewogICAgICAgICAgICB0aGlzLl9mYXJaID0gegogICAgICAgIH0KICAgICAgICBHZXRGYXJaKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZmFyWgogICAgICAgIH0KICAgICAgICBTZXRGb3ZZKGYpIHsKICAgICAgICAgICAgdGhpcy5fZm92WSA9IGY7CiAgICAgICAgICAgIHRoaXMuX3Rhbl9mb3ZZXzIgPSBNYXRoLnRhbih0aGlzLl9mb3ZZIC8gMikKICAgICAgICB9CiAgICAgICAgR2V0Rm92WSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2ZvdlkKICAgICAgICB9CiAgICAgICAgX0dldFRhbkZvdllEaXYyKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fdGFuX2ZvdllfMgogICAgICAgIH0KICAgICAgICBTZXRaQXhpc1NjYWxlTm9ybWFsaXplZCgpIHsKICAgICAgICAgICAgdGhpcy5fekF4aXNTY2FsZSA9IGZhbHNlCiAgICAgICAgfQogICAgICAgIFNldFpBeGlzU2NhbGVSZWd1bGFyKCkgewogICAgICAgICAgICB0aGlzLl96QXhpc1NjYWxlID0KICAgICAgICAgICAgICAgIHRydWUKICAgICAgICB9CiAgICAgICAgSXNaQXhpc1NjYWxlTm9ybWFsaXplZCgpIHsKICAgICAgICAgICAgcmV0dXJuICF0aGlzLl96QXhpc1NjYWxlCiAgICAgICAgfQogICAgICAgIElzWkF4aXNTY2FsZVJlZ3VsYXIoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl96QXhpc1NjYWxlCiAgICAgICAgfQogICAgICAgIENhbGN1bGF0ZVBlcnNwZWN0aXZlTWF0cml4KG91dE1hdCwgYXNwZWN0LCB2cFggPSAuNSwgdnBZID0gLjUpIHsKICAgICAgICAgICAgY29uc3Qgek5lYXIgPSB0aGlzLkdldE5lYXJaKCk7CiAgICAgICAgICAgIGNvbnN0IHpGYXIgPSB0aGlzLkdldEZhclooKTsKICAgICAgICAgICAgY29uc3QgZm92WSA9IHRoaXMuR2V0Rm92WSgpOwogICAgICAgICAgICBpZiAodnBYID09PSAuNSAmJiB2cFkgPT09IC41KQogICAgICAgICAgICAgICAgaWYgKHRoaXMuSXNXZWJHUFUoKSkgbWF0NC5wZXJzcGVjdGl2ZVpPKG91dE1hdCwgZm92WSwgYXNwZWN0LCB6TmVhciwgekZhcik7CiAgICAgICAgICAgICAgICBlbHNlIG1hdDQucGVyc3BlY3RpdmUob3V0TWF0LCBmb3ZZLCBhc3BlY3QsIHpOZWFyLCB6RmFyKTsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICB2cFggPSAxIC0gdnBYOwogICAgICAgICAgICAgICAgY29uc3QgZkxlZnQgPSB2cFggKiAyIC0gMjsKICAgICAgICAgICAgICAgIGNvbnN0IGZSaWdodCA9IHZwWCAqIDI7CiAgICAgICAgICAgICAgICBjb25zdCBmQm90dG9tID0gdnBZICogMiAtIDI7CiAgICAgICAgICAgICAgICBjb25zdCBmVG9wID0gdnBZICogMjsKICAgICAgICAgICAgICAgIGNvbnN0IGZIID0gdGhpcy5fR2V0VGFuRm92WURpdjIoKSAqCiAgICAgICAgICAgICAgICAgICAgek5lYXI7CiAgICAgICAgICAgICAgICBjb25zdCBmVyA9IGZIICogYXNwZWN0OwogICAgICAgICAgICAgICAgbWF0NC5mcnVzdHVtKG91dE1hdCwgZkxlZnQgKiBmVywgZlJpZ2h0ICogZlcsIGZCb3R0b20gKiBmSCwgZlRvcCAqIGZILCB6TmVhciwgekZhcikKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBDYWxjdWxhdGVPcnRob2dyYXBoaWNNYXRyaXgob3V0TWF0LCB3aWR0aCwgaGVpZ2h0LCBzY2FsZSA9IDEpIHsKICAgICAgICAgICAgY29uc3QgZHByID0gc2VsZi5kZXZpY2VQaXhlbFJhdGlvOwogICAgICAgICAgICBjb25zdCB3b3JsZFNjYWxlID0gdGhpcy5HZXREZWZhdWx0Q2FtZXJhWihoZWlnaHQpICogMiAqIGRwciAqIHRoaXMuX0dldFRhbkZvdllEaXYyKCkgLyBoZWlnaHQ7CiAgICAgICAgICAgIGNvbnN0IGhTY2FsZVggPSB3aWR0aCAqIHdvcmxkU2NhbGUgLyAoMiAqIGRwciAqIHNjYWxlKTsKICAgICAgICAgICAgY29uc3QgaFNjYWxlWSA9IGhlaWdodCAqIHdvcmxkU2NhbGUgLyAoMiAqIGRwciAqIHNjYWxlKTsKICAgICAgICAgICAgY29uc3QgbGVmdCA9IC1oU2NhbGVYOwogICAgICAgICAgICBjb25zdCByaWdodCA9IGhTY2FsZVg7CiAgICAgICAgICAgIGNvbnN0IGJvdHRvbSA9IC1oU2NhbGVZOwogICAgICAgICAgICBjb25zdCB0b3AgPSBoU2NhbGVZOwogICAgICAgICAgICBpZiAodGhpcy5Jc1dlYkdQVSgpKSBtYXQ0Lm9ydGhvWk8ob3V0TWF0LCBsZWZ0LCByaWdodCwgYm90dG9tLCB0b3AsCiAgICAgICAgICAgICAgICB0aGlzLkdldE5lYXJaKCksIHRoaXMuR2V0RmFyWigpKTsKICAgICAgICAgICAgZWxzZSBtYXQ0Lm9ydGhvKG91dE1hdCwgbGVmdCwgcmlnaHQsIGJvdHRvbSwgdG9wLCB0aGlzLkdldE5lYXJaKCksIHRoaXMuR2V0RmFyWigpKQogICAgICAgIH0KICAgICAgICBDYWxjdWxhdGVMb29rQXRNb2RlbFZpZXcob3V0TWF0LCBjYW0sIGxvb2ssIHVwLCB2aWV3SCwgelNjYWxlID0gMSkgewogICAgICAgICAgICBsZXQgd29ybGRTY2FsZSA9IDE7CiAgICAgICAgICAgIGlmICh0aGlzLklzWkF4aXNTY2FsZU5vcm1hbGl6ZWQoKSkgd29ybGRTY2FsZSA9IDIwMCAqIHRoaXMuX0dldFRhbkZvdllEaXYyKCkgLyB2aWV3SDsKICAgICAgICAgICAgY29uc3Qgd29ybGRTY2FsZVZlYzMgPSB0bXBWZWMzYzsKICAgICAgICAgICAgdmVjMy5zZXQod29ybGRTY2FsZVZlYzMsIHdvcmxkU2NhbGUsIC13b3JsZFNjYWxlLCAxKTsKICAgICAgICAgICAgY29uc3QgdG1wQ2FtID0gdG1wVmVjM2E7CiAgICAgICAgICAgIGNvbnN0IHRtcExvb2sgPSB0bXBWZWMzYjsKICAgICAgICAgICAgdmVjMy5tdWx0aXBseSh0bXBDYW0sIGNhbSwgd29ybGRTY2FsZVZlYzMpOwogICAgICAgICAgICB2ZWMzLm11bHRpcGx5KHRtcExvb2ssIGxvb2ssIHdvcmxkU2NhbGVWZWMzKTsKICAgICAgICAgICAgbWF0NC5sb29rQXQob3V0TWF0LCB0bXBDYW0sIHRtcExvb2ssCiAgICAgICAgICAgICAgICB1cCB8fCBkZWZhdWx0VXBWZWN0b3IpOwogICAgICAgICAgICB3b3JsZFNjYWxlVmVjM1syXSA9IHpTY2FsZTsKICAgICAgICAgICAgbWF0NC5zY2FsZShvdXRNYXQsIG91dE1hdCwgd29ybGRTY2FsZVZlYzMpCiAgICAgICAgfQogICAgICAgIENhbGN1bGF0ZUxvb2tBdE1vZGVsVmlldzIoY2FtWCwgY2FtWSwgY2FtWiwgbG9va1gsIGxvb2tZLCBsb29rWiwgdmlld0gsIHpTY2FsZSkgewogICAgICAgICAgICB2ZWMzLnNldCh0bXBWZWMzYSwgY2FtWCwgY2FtWSwgY2FtWik7CiAgICAgICAgICAgIHZlYzMuc2V0KHRtcFZlYzNiLCBsb29rWCwgbG9va1ksIGxvb2taKTsKICAgICAgICAgICAgdGhpcy5DYWxjdWxhdGVMb29rQXRNb2RlbFZpZXcodGVtcE1hdDQsIHRtcFZlYzNhLCB0bXBWZWMzYiwgZGVmYXVsdFVwVmVjdG9yLCB2aWV3SCwgelNjYWxlKTsKICAgICAgICAgICAgcmV0dXJuIHRlbXBNYXQ0CiAgICAgICAgfQogICAgICAgIF9BZGRTaGFkZXJQcm9ncmFtKHNwKSB7CiAgICAgICAgICAgIHRoaXMuX2FsbFNoYWRlclByb2dyYW1zLnB1c2goc3ApOwogICAgICAgICAgICB0aGlzLl9zaGFkZXJQcm9ncmFtc0J5TmFtZS5zZXQoc3AuR2V0TmFtZSgpLCBzcCkKICAgICAgICB9CiAgICAgICAgX1JlbW92ZVNoYWRlclByb2dyYW0oc3ApIHsKICAgICAgICAgICAgY29uc3QgaSA9IHRoaXMuX2FsbFNoYWRlclByb2dyYW1zLmluZGV4T2Yoc3ApOwogICAgICAgICAgICBpZiAoaSAhPT0gLTEpIHRoaXMuX2FsbFNoYWRlclByb2dyYW1zLnNwbGljZShpLCAxKTsKICAgICAgICAgICAgdGhpcy5fc2hhZGVyUHJvZ3JhbXNCeU5hbWUuZGVsZXRlKHNwLkdldE5hbWUoKSkKICAgICAgICB9CiAgICAgICAgX0NsZWFyQWxsU2hhZGVyUHJvZ3JhbXMoKSB7CiAgICAgICAgICAgIEMzLmNsZWFyQXJyYXkodGhpcy5fYWxsU2hhZGVyUHJvZ3JhbXMpOwogICAgICAgICAgICB0aGlzLl9zaGFkZXJQcm9ncmFtc0J5TmFtZS5jbGVhcigpCiAgICAgICAgfQogICAgICAgIEdldFNoYWRlclByb2dyYW1CeU5hbWUobmFtZSkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fc2hhZGVyUHJvZ3JhbXNCeU5hbWUuZ2V0KG5hbWUpIHx8IG51bGwKICAgICAgICB9CiAgICAgICAgR2V0VGV4dHVyZUZpbGxTaGFkZXJQcm9ncmFtKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fc3BUZXh0dXJlRmlsbAogICAgICAgIH0KICAgICAgICBTZXRUZXh0dXJlRmlsbE1vZGUoKSB7CiAgICAgICAgICAgIHRoaXMuU2V0UHJvZ3JhbSh0aGlzLl9zcFRleHR1cmVGaWxsKQogICAgICAgIH0KICAgICAgICBHZXRQb2ludHNSZW5kZXJpbmdQcm9ncmFtKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fc3BQb2ludHMKICAgICAgICB9CiAgICAgICAgU2V0UG9pbnRzUmVuZGVyaW5nUHJvZ3JhbSgpIHsKICAgICAgICAgICAgdGhpcy5TZXRQcm9ncmFtKHRoaXMuX3NwUG9pbnRzKQogICAgICAgIH0KICAgICAgICBTZXRUaWxlbWFwRmlsbE1vZGUoKSB7CiAgICAgICAgICAgIHRoaXMuU2V0UHJvZ3JhbSh0aGlzLl9zcFRpbGVtYXBGaWxsKQogICAgICAgIH0KICAgICAgICBTZXRUaWxlUmFuZG9taXphdGlvbk1vZGUoKSB7CiAgICAgICAgICAgIHRoaXMuU2V0UHJvZ3JhbSh0aGlzLl9zcFRpbGVSYW5kb21pemF0aW9uKQogICAgICAgIH0KICAgICAgICBTZXRDb2xvckZpbGxNb2RlKCkgewogICAgICAgICAgICB0aGlzLlNldFByb2dyYW0odGhpcy5fc3BDb2xvckZpbGwpCiAgICAgICAgfQogICAgICAgIFNldExpbmVhckdyYWRpZW50RmlsbE1vZGUoKSB7CiAgICAgICAgICAgIHRoaXMuU2V0UHJvZ3JhbSh0aGlzLl9zcExpbmVhckdyYWRpZW50RmlsbCkKICAgICAgICB9CiAgICAgICAgU2V0UGVudW1icmFGaWxsTW9kZSgpIHsKICAgICAgICAgICAgdGhpcy5TZXRQcm9ncmFtKHRoaXMuX3NwUGVudW1icmFGaWxsKQogICAgICAgIH0KICAgICAgICBTZXRIYXJkRWxsaXBzZUZpbGxNb2RlKCkgewogICAgICAgICAgICB0aGlzLlNldFByb2dyYW0odGhpcy5fc3BIYXJkRWxsaXBzZUZpbGwpCiAgICAgICAgfQogICAgICAgIFNldEhhcmRFbGxpcHNlT3V0bGluZU1vZGUoKSB7CiAgICAgICAgICAgIHRoaXMuU2V0UHJvZ3JhbSh0aGlzLl9zcEhhcmRFbGxpcHNlT3V0bGluZSkKICAgICAgICB9CiAgICAgICAgU2V0U21vb3RoRWxsaXBzZUZpbGxNb2RlKCkgewogICAgICAgICAgICB0aGlzLlNldFByb2dyYW0odGhpcy5fc3BTbW9vdGhFbGxpcHNlRmlsbCkKICAgICAgICB9CiAgICAgICAgU2V0U21vb3RoRWxsaXBzZU91dGxpbmVNb2RlKCkgewogICAgICAgICAgICB0aGlzLlNldFByb2dyYW0odGhpcy5fc3BTbW9vdGhFbGxpcHNlT3V0bGluZSkKICAgICAgICB9CiAgICAgICAgU2V0U21vb3RoTGluZUZpbGxNb2RlKCkgewogICAgICAgICAgICB0aGlzLlNldFByb2dyYW0odGhpcy5fc3BTbW9vdGhMaW5lRmlsbCkKICAgICAgICB9CiAgICAgICAgX1NldEN1cnJlbnRTdGF0ZUdyb3VwKHNnKSB7CiAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRTdGF0ZUdyb3VwID0KICAgICAgICAgICAgICAgIHNnCiAgICAgICAgfQogICAgICAgIEdldEN1cnJlbnRTdGF0ZUdyb3VwKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fY3VycmVudFN0YXRlR3JvdXAKICAgICAgICB9CiAgICAgICAgQWNxdWlyZVN0YXRlR3JvdXAoc2hhZGVyUHJvZ3JhbV9vcl9uYW1lLCBibGVuZE1vZGUsIGNvbG9yLCB6RWxldmF0aW9uKSB7CiAgICAgICAgICAgIGNvbnN0IGtleSA9IEMzLkdmeC5TdGF0ZUdyb3VwLk1ha2VLZXkoc2hhZGVyUHJvZ3JhbV9vcl9uYW1lLCBibGVuZE1vZGUsIGNvbG9yLCB6RWxldmF0aW9uKTsKICAgICAgICAgICAgbGV0IHN0YXRlR3JvdXAgPSB0aGlzLl9zdGF0ZUdyb3Vwcy5nZXQoa2V5KTsKICAgICAgICAgICAgaWYgKCFzdGF0ZUdyb3VwKSB7CiAgICAgICAgICAgICAgICBzdGF0ZUdyb3VwID0gQzMuTmV3KEMzLkdmeC5TdGF0ZUdyb3VwLCB0aGlzLCBzaGFkZXJQcm9ncmFtX29yX25hbWUsIGJsZW5kTW9kZSwgY29sb3IsIHpFbGV2YXRpb24pOwogICAgICAgICAgICAgICAgdGhpcy5fc3RhdGVHcm91cHMuc2V0KGtleSwgc3RhdGVHcm91cCkKICAgICAgICAgICAgfQogICAgICAgICAgICBzdGF0ZUdyb3VwLkFkZFJlZigpOwogICAgICAgICAgICByZXR1cm4gc3RhdGVHcm91cAogICAgICAgIH0KICAgICAgICBSZWxlYXNlU3RhdGVHcm91cChzdGF0ZUdyb3VwKSB7CiAgICAgICAgICAgIHN0YXRlR3JvdXAuRGVjUmVmKCk7CiAgICAgICAgICAgIGlmIChzdGF0ZUdyb3VwLl9HZXRSZWZDb3VudCgpID09PQogICAgICAgICAgICAgICAgMCkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuX2N1cnJlbnRTdGF0ZUdyb3VwID09PSBzdGF0ZUdyb3VwKSB0aGlzLl9jdXJyZW50U3RhdGVHcm91cCA9IG51bGw7CiAgICAgICAgICAgICAgICB0aGlzLl9zdGF0ZUdyb3Vwcy5kZWxldGUoc3RhdGVHcm91cC5HZXRLZXkoKSk7CiAgICAgICAgICAgICAgICBzdGF0ZUdyb3VwLlJlbGVhc2UoKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIF9Jbml0QmxlbmRNb2RlRGF0YShibGVuZE1vZGVEYXRhKSB7CiAgICAgICAgICAgIEMzLmNsZWFyQXJyYXkodGhpcy5fYmxlbmRNb2RlVGFibGUpOwogICAgICAgICAgICB0aGlzLl9uYW1lZEJsZW5kTW9kZU1hcC5jbGVhcigpOwogICAgICAgICAgICBsZXQgbnVtYmVyID0gMDsKICAgICAgICAgICAgZm9yIChjb25zdCBibWQgb2YgYmxlbmRNb2RlRGF0YSkgewogICAgICAgICAgICAgICAgY29uc3QgbmFtZSA9IGJtZFswXTsKICAgICAgICAgICAgICAgIGNvbnN0IHNyY0JsZW5kID0gYm1kWzFdOwogICAgICAgICAgICAgICAgY29uc3QgZGVzdEJsZW5kID0gYm1kWzJdOwogICAgICAgICAgICAgICAgdGhpcy5fYmxlbmRNb2RlVGFibGUucHVzaChbc3JjQmxlbmQsIGRlc3RCbGVuZF0pOwogICAgICAgICAgICAgICAgdGhpcy5fbmFtZWRCbGVuZE1vZGVNYXAuc2V0KG5hbWUsIHsKICAgICAgICAgICAgICAgICAgICBudW1iZXIsCiAgICAgICAgICAgICAgICAgICAgc3JjQmxlbmQsCiAgICAgICAgICAgICAgICAgICAgZGVzdEJsZW5kCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIG51bWJlcisrCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgX0dldEJsZW5kQnlJbmRleChibGVuZEluZGV4KSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9ibGVuZE1vZGVUYWJsZVtibGVuZEluZGV4XQogICAgICAgIH0KICAgICAgICBHZXRTcmNCbGVuZEJ5SW5kZXgoYmxlbmRJbmRleCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fR2V0QmxlbmRCeUluZGV4KGJsZW5kSW5kZXgpWzBdCiAgICAgICAgfQogICAgICAgIEdldERlc3RCbGVuZEJ5SW5kZXgoYmxlbmRJbmRleCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fR2V0QmxlbmRCeUluZGV4KGJsZW5kSW5kZXgpWzFdCiAgICAgICAgfQogICAgICAgIEdldE5hbWVkQmxlbmQoYmxlbmROYW1lKSB7CiAgICAgICAgICAgIGNvbnN0IHJldCA9CiAgICAgICAgICAgICAgICB0aGlzLl9uYW1lZEJsZW5kTW9kZU1hcC5nZXQoYmxlbmROYW1lKTsKICAgICAgICAgICAgaWYgKHR5cGVvZiByZXQgPT09ICJ1bmRlZmluZWQiKSB0aHJvdyBuZXcgRXJyb3IoImludmFsaWQgYmxlbmQgbmFtZSIpOwogICAgICAgICAgICByZXR1cm4gcmV0CiAgICAgICAgfQogICAgICAgIE5hbWVkQmxlbmRUb051bWJlcihibGVuZE5hbWUpIHsKICAgICAgICAgICAgY29uc3QgcmV0ID0gdGhpcy5fbmFtZWRCbGVuZE1vZGVNYXAuZ2V0KGJsZW5kTmFtZSk7CiAgICAgICAgICAgIGlmICh0eXBlb2YgcmV0ID09PSAidW5kZWZpbmVkIikgdGhyb3cgbmV3IEVycm9yKCJpbnZhbGlkIGJsZW5kIG5hbWUiKTsKICAgICAgICAgICAgcmV0dXJuIHJldC5udW1iZXIKICAgICAgICB9CiAgICAgICAgU2V0QmFzZVooeikgewogICAgICAgICAgICB0aGlzLl9iYXNlWiA9IHoKICAgICAgICB9CiAgICAgICAgR2V0QmFzZVooKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9iYXNlWgogICAgICAgIH0KICAgICAgICBTZXRDdXJyZW50Wih6KSB7CiAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRaID0gejsKICAgICAgICAgICAgdGhpcy5fY3VycmVudFN0YXRlR3JvdXAgPSBudWxsCiAgICAgICAgfQogICAgICAgIEdldEN1cnJlbnRaKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fY3VycmVudFoKICAgICAgICB9CiAgICAgICAgTGluZSh4MSwgeTEsIHgyLCB5MikgewogICAgICAgICAgICBjb25zdCBhID0gQzMuYW5nbGVUbyh4MSwgeTEsIHgyLCB5Mik7CiAgICAgICAgICAgIGNvbnN0IHNpbl9hID0gTWF0aC5zaW4oYSk7CiAgICAgICAgICAgIGNvbnN0IGNvc19hID0gTWF0aC5jb3MoYSk7CiAgICAgICAgICAgIGNvbnN0IGhhbGZMaW5lV2lkdGggPSB0aGlzLl9saW5lV2lkdGggKiAuNTsKICAgICAgICAgICAgY29uc3Qgc2luX2FfaGx3ID0gc2luX2EgKiBoYWxmTGluZVdpZHRoOwogICAgICAgICAgICBjb25zdCBjb3NfYV9obHcgPSBjb3NfYSAqIGhhbGZMaW5lV2lkdGg7CiAgICAgICAgICAgIGNvbnN0IGxpbmVDYXAgPSB0aGlzLl9saW5lQ2FwOwogICAgICAgICAgICBpZiAobGluZUNhcCA9PT0gMikgdGhpcy5MaW5lUHJlQ2FsY19MaW5lQ2FwMih4MSwgeTEsIDAsIHgyLCB5MiwgMCwgc2luX2FfaGx3LCBjb3NfYV9obHcpOwogICAgICAgICAgICBlbHNlIGlmIChsaW5lQ2FwID09PSAxKSB0aGlzLkxpbmVQcmVDYWxjX0xpbmVDYXAxKHgxLCB5MSwgMCwgeDIsIHkyLCAwLCBzaW5fYV9obHcsIGNvc19hX2hsdyk7CiAgICAgICAgICAgIGVsc2UgdGhpcy5MaW5lUHJlQ2FsY19MaW5lQ2FwMCh4MSwgeTEsIDAsIHgyLCB5MiwgMCwgc2luX2FfaGx3LCBjb3NfYV9obHcpCiAgICAgICAgfQogICAgICAgIExpbmUzRCh4MSwgeTEsIHoxLCB4MiwgeTIsIHoyKSB7CiAgICAgICAgICAgIGNvbnN0IGEgPSBDMy5hbmdsZVRvKHgxLCB5MSwgeDIsIHkyKTsKICAgICAgICAgICAgY29uc3Qgc2luX2EgPSBNYXRoLnNpbihhKTsKICAgICAgICAgICAgY29uc3QgY29zX2EgPSBNYXRoLmNvcyhhKTsKICAgICAgICAgICAgY29uc3QgaGFsZkxpbmVXaWR0aCA9CiAgICAgICAgICAgICAgICB0aGlzLl9saW5lV2lkdGggKiAuNTsKICAgICAgICAgICAgY29uc3Qgc2luX2FfaGx3ID0gc2luX2EgKiBoYWxmTGluZVdpZHRoOwogICAgICAgICAgICBjb25zdCBjb3NfYV9obHcgPSBjb3NfYSAqIGhhbGZMaW5lV2lkdGg7CiAgICAgICAgICAgIGNvbnN0IGxpbmVDYXAgPSB0aGlzLl9saW5lQ2FwOwogICAgICAgICAgICBpZiAobGluZUNhcCA9PT0gMikgdGhpcy5MaW5lUHJlQ2FsY19MaW5lQ2FwMih4MSwgeTEsIHoxLCB4MiwgeTIsIHoyLCBzaW5fYV9obHcsIGNvc19hX2hsdyk7CiAgICAgICAgICAgIGVsc2UgaWYgKGxpbmVDYXAgPT09IDEpIHRoaXMuTGluZVByZUNhbGNfTGluZUNhcDEoeDEsIHkxLCB6MSwgeDIsIHkyLCB6Miwgc2luX2FfaGx3LCBjb3NfYV9obHcpOwogICAgICAgICAgICBlbHNlIHRoaXMuTGluZVByZUNhbGNfTGluZUNhcDAoeDEsIHkxLCB6MSwgeDIsIHkyLCB6Miwgc2luX2FfaGx3LCBjb3NfYV9obHcpCiAgICAgICAgfQogICAgICAgIExpbmVQcmVDYWxjX0xpbmVDYXAyKHgxLCB5MSwgejEsIHgyLCB5MiwgejIsIHNpbl9hX2hsdywgY29zX2FfaGx3KSB7CiAgICAgICAgICAgIGNvbnN0IGxpbmVPZmZzZXQgPSB0aGlzLl9saW5lT2Zmc2V0OwogICAgICAgICAgICBjb25zdCBzdGFydFggPSB4MSArIGxpbmVPZmZzZXQgLSBjb3NfYV9obHc7CiAgICAgICAgICAgIGNvbnN0IHN0YXJ0WSA9IHkxICsKICAgICAgICAgICAgICAgIGxpbmVPZmZzZXQgLSBzaW5fYV9obHc7CiAgICAgICAgICAgIGNvbnN0IGVuZFggPSB4MiArIGxpbmVPZmZzZXQgKyBjb3NfYV9obHc7CiAgICAgICAgICAgIGNvbnN0IGVuZFkgPSB5MiArIGxpbmVPZmZzZXQgKyBzaW5fYV9obHc7CiAgICAgICAgICAgIGNvbnN0IGNvc19hX2x3ID0gY29zX2FfaGx3ICogMjsKICAgICAgICAgICAgY29uc3Qgc2luX2FfbHcgPSBzaW5fYV9obHcgKiAyOwogICAgICAgICAgICBjb25zdCB0bHggPSBzdGFydFggKyBzaW5fYV9obHc7CiAgICAgICAgICAgIGNvbnN0IHRseSA9IHN0YXJ0WSAtIGNvc19hX2hsdzsKICAgICAgICAgICAgY29uc3QgYmx4ID0gc3RhcnRYIC0gc2luX2FfaGx3ICsgY29zX2FfbHc7CiAgICAgICAgICAgIGNvbnN0IGJseSA9IHN0YXJ0WSArIGNvc19hX2hsdyArIHNpbl9hX2x3OwogICAgICAgICAgICBjb25zdCB0cnggPSBlbmRYICsgc2luX2FfaGx3OwogICAgICAgICAgICBjb25zdCB0cnlfID0gZW5kWSAtIGNvc19hX2hsdzsKICAgICAgICAgICAgY29uc3QgYnJ4ID0gZW5kWCAtIHNpbl9hX2hsdyAtIGNvc19hX2x3OwogICAgICAgICAgICBjb25zdCBicnkgPSBlbmRZICsgY29zX2FfaGx3IC0gc2luX2FfbHc7CiAgICAgICAgICAgIHRoaXMuUXVhZDNEMih0bHgsIHRseSwgejEsIHRyeCwgdHJ5XywgejIsIGJyeCwgYnJ5LCB6MiwgYmx4LCBibHksIHoxLCBkZWZhdWx0VGV4Q29vcmRzUXVhZCkKICAgICAgICB9CiAgICAgICAgTGluZVByZUNhbGNfTGluZUNhcDEoeDEsIHkxLCB6MSwgeDIsCiAgICAgICAgICAgIHkyLCB6Miwgc2luX2FfaGx3LCBjb3NfYV9obHcpIHsKICAgICAgICAgICAgY29uc3QgbGluZU9mZnNldCA9IHRoaXMuX2xpbmVPZmZzZXQ7CiAgICAgICAgICAgIGNvbnN0IHN0YXJ0WCA9IHgxICsgbGluZU9mZnNldCAtIGNvc19hX2hsdzsKICAgICAgICAgICAgY29uc3Qgc3RhcnRZID0geTEgKyBsaW5lT2Zmc2V0IC0gc2luX2FfaGx3OwogICAgICAgICAgICBjb25zdCBlbmRYID0geDIgKyBsaW5lT2Zmc2V0ICsgY29zX2FfaGx3OwogICAgICAgICAgICBjb25zdCBlbmRZID0geTIgKyBsaW5lT2Zmc2V0ICsgc2luX2FfaGx3OwogICAgICAgICAgICBjb25zdCB0bHggPSBzdGFydFggKyBzaW5fYV9obHc7CiAgICAgICAgICAgIGNvbnN0IHRseSA9IHN0YXJ0WSAtIGNvc19hX2hsdzsKICAgICAgICAgICAgY29uc3QgYmx4ID0gc3RhcnRYIC0gc2luX2FfaGx3OwogICAgICAgICAgICBjb25zdCBibHkgPSBzdGFydFkgKyBjb3NfYV9obHc7CiAgICAgICAgICAgIGNvbnN0IHRyeCA9IGVuZFggKyBzaW5fYV9obHc7CiAgICAgICAgICAgIGNvbnN0IHRyeV8gPSBlbmRZIC0gY29zX2FfaGx3OwogICAgICAgICAgICBjb25zdCBicnggPSBlbmRYIC0gc2luX2FfaGx3OwogICAgICAgICAgICBjb25zdCBicnkgPSBlbmRZICsgY29zX2FfaGx3OwogICAgICAgICAgICB0aGlzLlF1YWQzRDIodGx4LCB0bHksIHoxLCB0cngsIHRyeV8sIHoyLCBicngsIGJyeSwgejIsIGJseCwgYmx5LCB6MSwgZGVmYXVsdFRleENvb3Jkc1F1YWQpCiAgICAgICAgfQogICAgICAgIExpbmVQcmVDYWxjX0xpbmVDYXAwKHgxLAogICAgICAgICAgICB5MSwgejEsIHgyLCB5MiwgejIsIHNpbl9hX2hsdywgY29zX2FfaGx3KSB7CiAgICAgICAgICAgIGNvbnN0IGxpbmVPZmZzZXQgPSB0aGlzLl9saW5lT2Zmc2V0OwogICAgICAgICAgICBjb25zdCBzdGFydFggPSB4MSArIGxpbmVPZmZzZXQ7CiAgICAgICAgICAgIGNvbnN0IHN0YXJ0WSA9IHkxICsgbGluZU9mZnNldDsKICAgICAgICAgICAgY29uc3QgZW5kWCA9IHgyICsgbGluZU9mZnNldDsKICAgICAgICAgICAgY29uc3QgZW5kWSA9IHkyICsgbGluZU9mZnNldDsKICAgICAgICAgICAgY29uc3QgdGx4ID0gc3RhcnRYICsgc2luX2FfaGx3OwogICAgICAgICAgICBjb25zdCB0bHkgPSBzdGFydFkgLSBjb3NfYV9obHc7CiAgICAgICAgICAgIGNvbnN0IGJseCA9IHN0YXJ0WCAtIHNpbl9hX2hsdzsKICAgICAgICAgICAgY29uc3QgYmx5ID0gc3RhcnRZICsgY29zX2FfaGx3OwogICAgICAgICAgICBjb25zdCB0cnggPSBlbmRYICsgc2luX2FfaGx3OwogICAgICAgICAgICBjb25zdCB0cnlfID0gZW5kWSAtIGNvc19hX2hsdzsKICAgICAgICAgICAgY29uc3QgYnJ4ID0gZW5kWCAtIHNpbl9hX2hsdzsKICAgICAgICAgICAgY29uc3QgYnJ5ID0gZW5kWSArIGNvc19hX2hsdzsKICAgICAgICAgICAgdGhpcy5RdWFkM0QyKHRseCwgdGx5LCB6MSwgdHJ4LCB0cnlfLCB6MiwgYnJ4LCBicnksIHoyLCBibHgsIGJseSwgejEsIGRlZmF1bHRUZXhDb29yZHNRdWFkKQogICAgICAgIH0KICAgICAgICBUZXh0dXJlZExpbmUoeDEsIHkxLCB4MiwgeTIsIHUsIHYpIHsKICAgICAgICAgICAgY29uc3QgYSA9CiAgICAgICAgICAgICAgICBDMy5hbmdsZVRvKHgxLCB5MSwgeDIsIHkyKTsKICAgICAgICAgICAgY29uc3Qgc2luX2EgPSBNYXRoLnNpbihhKTsKICAgICAgICAgICAgY29uc3QgY29zX2EgPSBNYXRoLmNvcyhhKTsKICAgICAgICAgICAgY29uc3QgaGFsZkxpbmVXaWR0aCA9IHRoaXMuX2xpbmVXaWR0aCAqIC41OwogICAgICAgICAgICBjb25zdCBzaW5fYV9obHcgPSBzaW5fYSAqIGhhbGZMaW5lV2lkdGg7CiAgICAgICAgICAgIGNvbnN0IGNvc19hX2hsdyA9IGNvc19hICogaGFsZkxpbmVXaWR0aDsKICAgICAgICAgICAgY29uc3QgbGluZUNhcCA9IHRoaXMuX2xpbmVDYXA7CiAgICAgICAgICAgIGlmIChsaW5lQ2FwID09PSAyKSB0aGlzLlRleHR1cmVkTGluZVByZUNhbGNfTGluZUNhcDIoeDEsIHkxLCB4MiwgeTIsIHNpbl9hX2hsdywgY29zX2FfaGx3LCB1LCB2KTsKICAgICAgICAgICAgZWxzZSBpZiAobGluZUNhcCA9PT0gMSkgdGhpcy5UZXh0dXJlZExpbmVQcmVDYWxjX0xpbmVDYXAxKHgxLCB5MSwgeDIsIHkyLCBzaW5fYV9obHcsIGNvc19hX2hsdywgdSwgdik7CiAgICAgICAgICAgIGVsc2UgdGhpcy5UZXh0dXJlZExpbmVQcmVDYWxjX0xpbmVDYXAwKHgxLCB5MSwgeDIsIHkyLCBzaW5fYV9obHcsIGNvc19hX2hsdywgdSwgdikKICAgICAgICB9CiAgICAgICAgVGV4dHVyZWRMaW5lUHJlQ2FsY19MaW5lQ2FwMih4MSwgeTEsIHgyLAogICAgICAgICAgICB5Miwgc2luX2FfaGx3LCBjb3NfYV9obHcsIHUsIHYpIHsKICAgICAgICAgICAgY29uc3QgbGluZU9mZnNldCA9IHRoaXMuX2xpbmVPZmZzZXQ7CiAgICAgICAgICAgIGNvbnN0IHN0YXJ0WCA9IHgxICsgbGluZU9mZnNldCAtIGNvc19hX2hsdzsKICAgICAgICAgICAgY29uc3Qgc3RhcnRZID0geTEgKyBsaW5lT2Zmc2V0IC0gc2luX2FfaGx3OwogICAgICAgICAgICBjb25zdCBlbmRYID0geDIgKyBsaW5lT2Zmc2V0ICsgY29zX2FfaGx3OwogICAgICAgICAgICBjb25zdCBlbmRZID0geTIgKyBsaW5lT2Zmc2V0ICsgc2luX2FfaGx3OwogICAgICAgICAgICBjb25zdCBjb3NfYV9sdyA9IGNvc19hX2hsdyAqIDI7CiAgICAgICAgICAgIGNvbnN0IHNpbl9hX2x3ID0gc2luX2FfaGx3ICogMjsKICAgICAgICAgICAgY29uc3QgdGx4ID0gc3RhcnRYICsgc2luX2FfaGx3OwogICAgICAgICAgICBjb25zdCB0bHkgPSBzdGFydFkgLSBjb3NfYV9obHc7CiAgICAgICAgICAgIGNvbnN0IGJseCA9IHN0YXJ0WCAtIHNpbl9hX2hsdyArIGNvc19hX2x3OwogICAgICAgICAgICBjb25zdCBibHkgPSBzdGFydFkgKyBjb3NfYV9obHcgKyBzaW5fYV9sdzsKICAgICAgICAgICAgY29uc3QgdHJ4ID0gZW5kWCArIHNpbl9hX2hsdzsKICAgICAgICAgICAgY29uc3QgdHJ5XyA9IGVuZFkgLSBjb3NfYV9obHc7CiAgICAgICAgICAgIGNvbnN0IGJyeCA9IGVuZFggLSBzaW5fYV9obHcgLSBjb3NfYV9sdzsKICAgICAgICAgICAgY29uc3QgYnJ5ID0gZW5kWSArIGNvc19hX2hsdyAtIHNpbl9hX2x3OwogICAgICAgICAgICB0bXBRdWFkLnNldCh0bHgsIHRseSwgdHJ4LCB0cnlfLCBicngsIGJyeSwgYmx4LCBibHkpOwogICAgICAgICAgICB0bXBSZWN0LnNldCh1LCAwLCB2LCAwKTsKICAgICAgICAgICAgdGhpcy5RdWFkMyh0bXBRdWFkLCB0bXBSZWN0KQogICAgICAgIH0KICAgICAgICBUZXh0dXJlZExpbmVQcmVDYWxjX0xpbmVDYXAxKHgxLCB5MSwgeDIsIHkyLCBzaW5fYV9obHcsIGNvc19hX2hsdywgdSwgdikgewogICAgICAgICAgICBjb25zdCBsaW5lT2Zmc2V0ID0gdGhpcy5fbGluZU9mZnNldDsKICAgICAgICAgICAgY29uc3Qgc3RhcnRYID0geDEgKyBsaW5lT2Zmc2V0IC0gY29zX2FfaGx3OwogICAgICAgICAgICBjb25zdCBzdGFydFkgPSB5MSArIGxpbmVPZmZzZXQgLSBzaW5fYV9obHc7CiAgICAgICAgICAgIGNvbnN0IGVuZFggPSB4MiArIGxpbmVPZmZzZXQgKyBjb3NfYV9obHc7CiAgICAgICAgICAgIGNvbnN0IGVuZFkgPSB5MiArIGxpbmVPZmZzZXQgKyBzaW5fYV9obHc7CiAgICAgICAgICAgIGNvbnN0IHRseCA9IHN0YXJ0WCArIHNpbl9hX2hsdzsKICAgICAgICAgICAgY29uc3QgdGx5ID0gc3RhcnRZIC0gY29zX2FfaGx3OwogICAgICAgICAgICBjb25zdCBibHggPSBzdGFydFggLSBzaW5fYV9obHc7CiAgICAgICAgICAgIGNvbnN0IGJseSA9IHN0YXJ0WSArIGNvc19hX2hsdzsKICAgICAgICAgICAgY29uc3QgdHJ4ID0gZW5kWCArIHNpbl9hX2hsdzsKICAgICAgICAgICAgY29uc3QgdHJ5XyA9IGVuZFkgLSBjb3NfYV9obHc7CiAgICAgICAgICAgIGNvbnN0IGJyeCA9CiAgICAgICAgICAgICAgICBlbmRYIC0gc2luX2FfaGx3OwogICAgICAgICAgICBjb25zdCBicnkgPSBlbmRZICsgY29zX2FfaGx3OwogICAgICAgICAgICB0bXBRdWFkLnNldCh0bHgsIHRseSwgdHJ4LCB0cnlfLCBicngsIGJyeSwgYmx4LCBibHkpOwogICAgICAgICAgICB0bXBSZWN0LnNldCh1LCAwLCB2LCAwKTsKICAgICAgICAgICAgdGhpcy5RdWFkMyh0bXBRdWFkLCB0bXBSZWN0KQogICAgICAgIH0KICAgICAgICBUZXh0dXJlZExpbmVQcmVDYWxjX0xpbmVDYXAwKHgxLCB5MSwgeDIsIHkyLCBzaW5fYV9obHcsIGNvc19hX2hsdywgdSwgdikgewogICAgICAgICAgICBjb25zdCBsaW5lT2Zmc2V0ID0gdGhpcy5fbGluZU9mZnNldDsKICAgICAgICAgICAgY29uc3Qgc3RhcnRYID0geDEgKyBsaW5lT2Zmc2V0OwogICAgICAgICAgICBjb25zdCBzdGFydFkgPSB5MSArIGxpbmVPZmZzZXQ7CiAgICAgICAgICAgIGNvbnN0IGVuZFggPSB4MiArIGxpbmVPZmZzZXQ7CiAgICAgICAgICAgIGNvbnN0IGVuZFkgPSB5MiArIGxpbmVPZmZzZXQ7CiAgICAgICAgICAgIGNvbnN0IHRseCA9IHN0YXJ0WCArIHNpbl9hX2hsdzsKICAgICAgICAgICAgY29uc3QgdGx5ID0gc3RhcnRZIC0gY29zX2FfaGx3OwogICAgICAgICAgICBjb25zdCBibHggPSBzdGFydFggLSBzaW5fYV9obHc7CiAgICAgICAgICAgIGNvbnN0IGJseSA9IHN0YXJ0WSArIGNvc19hX2hsdzsKICAgICAgICAgICAgY29uc3QgdHJ4ID0gZW5kWCArIHNpbl9hX2hsdzsKICAgICAgICAgICAgY29uc3QgdHJ5XyA9IGVuZFkgLSBjb3NfYV9obHc7CiAgICAgICAgICAgIGNvbnN0IGJyeCA9CiAgICAgICAgICAgICAgICBlbmRYIC0gc2luX2FfaGx3OwogICAgICAgICAgICBjb25zdCBicnkgPSBlbmRZICsgY29zX2FfaGx3OwogICAgICAgICAgICB0bXBRdWFkLnNldCh0bHgsIHRseSwgdHJ4LCB0cnlfLCBicngsIGJyeSwgYmx4LCBibHkpOwogICAgICAgICAgICB0bXBSZWN0LnNldCh1LCAwLCB2LCAwKTsKICAgICAgICAgICAgdGhpcy5RdWFkMyh0bXBRdWFkLCB0bXBSZWN0KQogICAgICAgIH0KICAgICAgICBMaW5lUmVjdChsZWZ0LCB0b3AsIHJpZ2h0LCBib3R0b20pIHsKICAgICAgICAgICAgY29uc3QgaGFsZkxpbmVXaWR0aCA9IHRoaXMuX2xpbmVXaWR0aCAqIC41OwogICAgICAgICAgICBjb25zdCBsaW5lQ2FwID0gdGhpcy5fbGluZUNhcDsKICAgICAgICAgICAgaWYgKGxpbmVDYXAgPT09IDIpIHRoaXMuX0xpbmVSZWN0UHJlQ2FsY19MaW5lQ2FwMihsZWZ0LCB0b3AsIHJpZ2h0LCBib3R0b20sIGhhbGZMaW5lV2lkdGgpOwogICAgICAgICAgICBlbHNlIGlmIChsaW5lQ2FwID09PSAxKSB0aGlzLl9MaW5lUmVjdFByZUNhbGNfTGluZUNhcDEobGVmdCwgdG9wLCByaWdodCwgYm90dG9tLCBoYWxmTGluZVdpZHRoKTsKICAgICAgICAgICAgZWxzZSB0aGlzLl9MaW5lUmVjdFByZUNhbGNfTGluZUNhcDAobGVmdCwgdG9wLCByaWdodCwgYm90dG9tLCBoYWxmTGluZVdpZHRoKQogICAgICAgIH0KICAgICAgICBfTGluZVJlY3RQcmVDYWxjX0xpbmVDYXAyKGxlZnQsCiAgICAgICAgICAgIHRvcCwgcmlnaHQsIGJvdHRvbSwgaGFsZkxpbmVXaWR0aCkgewogICAgICAgICAgICB0aGlzLkxpbmVQcmVDYWxjX0xpbmVDYXAyKGxlZnQsIHRvcCwgMCwgcmlnaHQsIHRvcCwgMCwgMCwgaGFsZkxpbmVXaWR0aCk7CiAgICAgICAgICAgIHRoaXMuTGluZVByZUNhbGNfTGluZUNhcDIocmlnaHQsIHRvcCwgMCwgcmlnaHQsIGJvdHRvbSwgMCwgaGFsZkxpbmVXaWR0aCwgMCk7CiAgICAgICAgICAgIHRoaXMuTGluZVByZUNhbGNfTGluZUNhcDIocmlnaHQsIGJvdHRvbSwgMCwgbGVmdCwgYm90dG9tLCAwLCAwLCAtaGFsZkxpbmVXaWR0aCk7CiAgICAgICAgICAgIHRoaXMuTGluZVByZUNhbGNfTGluZUNhcDIobGVmdCwgYm90dG9tLCAwLCBsZWZ0LCB0b3AsIDAsIC1oYWxmTGluZVdpZHRoLCAwKQogICAgICAgIH0KICAgICAgICBfTGluZVJlY3RQcmVDYWxjX0xpbmVDYXAxKGxlZnQsIHRvcCwgcmlnaHQsIGJvdHRvbSwgaGFsZkxpbmVXaWR0aCkgewogICAgICAgICAgICB0aGlzLkxpbmVQcmVDYWxjX0xpbmVDYXAxKGxlZnQsIHRvcCwgMCwgcmlnaHQsIHRvcCwgMCwgMCwgaGFsZkxpbmVXaWR0aCk7CiAgICAgICAgICAgIHRoaXMuTGluZVByZUNhbGNfTGluZUNhcDEocmlnaHQsIHRvcCwgMCwgcmlnaHQsIGJvdHRvbSwgMCwgaGFsZkxpbmVXaWR0aCwKICAgICAgICAgICAgICAgIDApOwogICAgICAgICAgICB0aGlzLkxpbmVQcmVDYWxjX0xpbmVDYXAxKHJpZ2h0LCBib3R0b20sIDAsIGxlZnQsIGJvdHRvbSwgMCwgMCwgLWhhbGZMaW5lV2lkdGgpOwogICAgICAgICAgICB0aGlzLkxpbmVQcmVDYWxjX0xpbmVDYXAxKGxlZnQsIGJvdHRvbSwgMCwgbGVmdCwgdG9wLCAwLCAtaGFsZkxpbmVXaWR0aCwgMCkKICAgICAgICB9CiAgICAgICAgX0xpbmVSZWN0UHJlQ2FsY19MaW5lQ2FwMChsZWZ0LCB0b3AsIHJpZ2h0LCBib3R0b20sIGhhbGZMaW5lV2lkdGgpIHsKICAgICAgICAgICAgdGhpcy5MaW5lUHJlQ2FsY19MaW5lQ2FwMChsZWZ0LCB0b3AsIDAsIHJpZ2h0LCB0b3AsIDAsIDAsIGhhbGZMaW5lV2lkdGgpOwogICAgICAgICAgICB0aGlzLkxpbmVQcmVDYWxjX0xpbmVDYXAwKHJpZ2h0LCB0b3AsIDAsIHJpZ2h0LCBib3R0b20sIDAsIGhhbGZMaW5lV2lkdGgsIDApOwogICAgICAgICAgICB0aGlzLkxpbmVQcmVDYWxjX0xpbmVDYXAwKHJpZ2h0LCBib3R0b20sIDAsIGxlZnQsIGJvdHRvbSwgMCwgMCwgLWhhbGZMaW5lV2lkdGgpOwogICAgICAgICAgICB0aGlzLkxpbmVQcmVDYWxjX0xpbmVDYXAwKGxlZnQsIGJvdHRvbSwgMCwgbGVmdCwgdG9wLCAwLCAtaGFsZkxpbmVXaWR0aCwgMCkKICAgICAgICB9CiAgICAgICAgTGluZVJlY3QyKHIpIHsKICAgICAgICAgICAgdGhpcy5MaW5lUmVjdChyLmdldExlZnQoKSwKICAgICAgICAgICAgICAgIHIuZ2V0VG9wKCksIHIuZ2V0UmlnaHQoKSwgci5nZXRCb3R0b20oKSkKICAgICAgICB9CiAgICAgICAgTGluZVF1YWQocSkgewogICAgICAgICAgICBjb25zdCBhID0gQzMuYW5nbGVUbyhxLmdldFRseCgpLCBxLmdldFRseSgpLCBxLmdldFRyeCgpLCBxLmdldFRyeSgpKTsKICAgICAgICAgICAgY29uc3Qgc2luX2EgPSBNYXRoLnNpbihhKTsKICAgICAgICAgICAgY29uc3QgY29zX2EgPSBNYXRoLmNvcyhhKTsKICAgICAgICAgICAgY29uc3QgaGFsZkxpbmVXaWR0aCA9IHRoaXMuX2xpbmVXaWR0aCAqIC41OwogICAgICAgICAgICBjb25zdCBzaW5fYV9obHcgPSBzaW5fYSAqIGhhbGZMaW5lV2lkdGg7CiAgICAgICAgICAgIGNvbnN0IGNvc19hX2hsdyA9IGNvc19hICogaGFsZkxpbmVXaWR0aDsKICAgICAgICAgICAgY29uc3QgbGluZUNhcCA9IHRoaXMuX2xpbmVDYXA7CiAgICAgICAgICAgIGlmIChsaW5lQ2FwID09PSAyKSB0aGlzLl9MaW5lUXVhZFByZUNhbGNfTGluZUNhcDIocSwgc2luX2FfaGx3LCBjb3NfYV9obHcpOwogICAgICAgICAgICBlbHNlIGlmIChsaW5lQ2FwID09PSAxKSB0aGlzLl9MaW5lUXVhZFByZUNhbGNfTGluZUNhcDEocSwgc2luX2FfaGx3LCBjb3NfYV9obHcpOwogICAgICAgICAgICBlbHNlIHRoaXMuX0xpbmVRdWFkUHJlQ2FsY19MaW5lQ2FwMChxLCBzaW5fYV9obHcsIGNvc19hX2hsdykKICAgICAgICB9CiAgICAgICAgX0xpbmVRdWFkUHJlQ2FsY19MaW5lQ2FwMihxLAogICAgICAgICAgICBzaW5fYV9obHcsIGNvc19hX2hsdykgewogICAgICAgICAgICB0aGlzLkxpbmVQcmVDYWxjX0xpbmVDYXAyKHEuZ2V0VGx4KCksIHEuZ2V0VGx5KCksIDAsIHEuZ2V0VHJ4KCksIHEuZ2V0VHJ5KCksIDAsIHNpbl9hX2hsdywgY29zX2FfaGx3KTsKICAgICAgICAgICAgdGhpcy5MaW5lUHJlQ2FsY19MaW5lQ2FwMihxLmdldFRyeCgpLCBxLmdldFRyeSgpLCAwLCBxLmdldEJyeCgpLCBxLmdldEJyeSgpLCAwLCBjb3NfYV9obHcsIC1zaW5fYV9obHcpOwogICAgICAgICAgICB0aGlzLkxpbmVQcmVDYWxjX0xpbmVDYXAyKHEuZ2V0QnJ4KCksIHEuZ2V0QnJ5KCksIDAsIHEuZ2V0Qmx4KCksIHEuZ2V0Qmx5KCksIDAsIC1zaW5fYV9obHcsIC1jb3NfYV9obHcpOwogICAgICAgICAgICB0aGlzLkxpbmVQcmVDYWxjX0xpbmVDYXAyKHEuZ2V0Qmx4KCksIHEuZ2V0Qmx5KCksIDAsIHEuZ2V0VGx4KCksIHEuZ2V0VGx5KCksIDAsIC1jb3NfYV9obHcsIHNpbl9hX2hsdykKICAgICAgICB9CiAgICAgICAgX0xpbmVRdWFkUHJlQ2FsY19MaW5lQ2FwMShxLCBzaW5fYV9obHcsIGNvc19hX2hsdykgewogICAgICAgICAgICB0aGlzLkxpbmVQcmVDYWxjX0xpbmVDYXAxKHEuZ2V0VGx4KCksIHEuZ2V0VGx5KCksCiAgICAgICAgICAgICAgICAwLCBxLmdldFRyeCgpLCBxLmdldFRyeSgpLCAwLCBzaW5fYV9obHcsIGNvc19hX2hsdyk7CiAgICAgICAgICAgIHRoaXMuTGluZVByZUNhbGNfTGluZUNhcDEocS5nZXRUcngoKSwgcS5nZXRUcnkoKSwgMCwgcS5nZXRCcngoKSwgcS5nZXRCcnkoKSwgMCwgY29zX2FfaGx3LCAtc2luX2FfaGx3KTsKICAgICAgICAgICAgdGhpcy5MaW5lUHJlQ2FsY19MaW5lQ2FwMShxLmdldEJyeCgpLCBxLmdldEJyeSgpLCAwLCBxLmdldEJseCgpLCBxLmdldEJseSgpLCAwLCAtc2luX2FfaGx3LCAtY29zX2FfaGx3KTsKICAgICAgICAgICAgdGhpcy5MaW5lUHJlQ2FsY19MaW5lQ2FwMShxLmdldEJseCgpLCBxLmdldEJseSgpLCAwLCBxLmdldFRseCgpLCBxLmdldFRseSgpLCAwLCAtY29zX2FfaGx3LCBzaW5fYV9obHcpCiAgICAgICAgfQogICAgICAgIF9MaW5lUXVhZFByZUNhbGNfTGluZUNhcDAocSwgc2luX2FfaGx3LCBjb3NfYV9obHcpIHsKICAgICAgICAgICAgdGhpcy5MaW5lUHJlQ2FsY19MaW5lQ2FwMChxLmdldFRseCgpLCBxLmdldFRseSgpLCAwLCBxLmdldFRyeCgpLCBxLmdldFRyeSgpLCAwLCBzaW5fYV9obHcsIGNvc19hX2hsdyk7CiAgICAgICAgICAgIHRoaXMuTGluZVByZUNhbGNfTGluZUNhcDAocS5nZXRUcngoKSwKICAgICAgICAgICAgICAgIHEuZ2V0VHJ5KCksIDAsIHEuZ2V0QnJ4KCksIHEuZ2V0QnJ5KCksIDAsIGNvc19hX2hsdywgLXNpbl9hX2hsdyk7CiAgICAgICAgICAgIHRoaXMuTGluZVByZUNhbGNfTGluZUNhcDAocS5nZXRCcngoKSwgcS5nZXRCcnkoKSwgMCwgcS5nZXRCbHgoKSwgcS5nZXRCbHkoKSwgMCwgLXNpbl9hX2hsdywgLWNvc19hX2hsdyk7CiAgICAgICAgICAgIHRoaXMuTGluZVByZUNhbGNfTGluZUNhcDAocS5nZXRCbHgoKSwgcS5nZXRCbHkoKSwgMCwgcS5nZXRUbHgoKSwgcS5nZXRUbHkoKSwgMCwgLWNvc19hX2hsdywgc2luX2FfaGx3KQogICAgICAgIH0KICAgICAgICBTZXRMaW5lV2lkdGgobikgewogICAgICAgICAgICB0aGlzLl9saW5lV2lkdGggPSBuOwogICAgICAgICAgICB0aGlzLl9saW5lV2lkdGhTdGFja1t0aGlzLl9saW5lV2lkdGhTdGFjay5sZW5ndGggLSAxXSA9IG4KICAgICAgICB9CiAgICAgICAgR2V0TGluZVdpZHRoKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fbGluZVdpZHRoCiAgICAgICAgfQogICAgICAgIFB1c2hMaW5lV2lkdGgobikgewogICAgICAgICAgICBpZiAodGhpcy5fbGluZVdpZHRoU3RhY2subGVuZ3RoID49IDEwMCkgdGhyb3cgbmV3IEVycm9yKCJwdXNoZWQgdG9vIG1hbnkgbGluZSB3aWR0aHMgLSBjaGVjayBwdXNoL3BvcCBwYWlycyIpOwogICAgICAgICAgICB0aGlzLl9saW5lV2lkdGhTdGFjay5wdXNoKG4pOwogICAgICAgICAgICB0aGlzLl9saW5lV2lkdGggPSBuCiAgICAgICAgfQogICAgICAgIFBvcExpbmVXaWR0aCgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX2xpbmVXaWR0aFN0YWNrLmxlbmd0aCA8PSAxKSB0aHJvdyBuZXcgRXJyb3IoImNhbm5vdCBwb3AgbGFzdCBsaW5lIHdpZHRoIC0gY2hlY2sgcHVzaC9wb3AgcGFpcnMiKTsKICAgICAgICAgICAgdGhpcy5fbGluZVdpZHRoU3RhY2sucG9wKCk7CiAgICAgICAgICAgIHRoaXMuX2xpbmVXaWR0aCA9IHRoaXMuX2xpbmVXaWR0aFN0YWNrLmF0KC0xKQogICAgICAgIH0KICAgICAgICBTZXRMaW5lQ2FwQnV0dCgpIHsKICAgICAgICAgICAgdGhpcy5fbGluZUNhcCA9IDA7CiAgICAgICAgICAgIHRoaXMuX2xpbmVDYXBTdGFja1t0aGlzLl9saW5lQ2FwU3RhY2subGVuZ3RoIC0gMV0gPSAwCiAgICAgICAgfQogICAgICAgIFNldExpbmVDYXBTcXVhcmUoKSB7CiAgICAgICAgICAgIHRoaXMuX2xpbmVDYXAgPSAxOwogICAgICAgICAgICB0aGlzLl9saW5lQ2FwU3RhY2tbdGhpcy5fbGluZUNhcFN0YWNrLmxlbmd0aCAtIDFdID0gMAogICAgICAgIH0KICAgICAgICBTZXRMaW5lQ2FwWmFnKCkgewogICAgICAgICAgICB0aGlzLl9saW5lQ2FwID0gMjsKICAgICAgICAgICAgdGhpcy5fbGluZUNhcFN0YWNrW3RoaXMuX2xpbmVDYXBTdGFjay5sZW5ndGggLSAxXSA9IDAKICAgICAgICB9CiAgICAgICAgUHVzaExpbmVDYXAodHlwZSkgewogICAgICAgICAgICBpZiAodHlwZSA9PT0KICAgICAgICAgICAgICAgICJidXR0IikgdGhpcy5QdXNoTGluZUNhcEJ1dHQoKTsKICAgICAgICAgICAgZWxzZSBpZiAodHlwZSA9PT0gInNxdWFyZSIpIHRoaXMuUHVzaExpbmVDYXBTcXVhcmUoKTsKICAgICAgICAgICAgZWxzZSBpZiAodHlwZSA9PT0gInphZyIpIHRoaXMuUHVzaExpbmVDYXBaYWcoKTsKICAgICAgICAgICAgZWxzZSB0aHJvdyBuZXcgRXJyb3IoImludmFsaWQgbGluZSBjYXAiKTsKICAgICAgICB9CiAgICAgICAgUHVzaExpbmVDYXBCdXR0KCkgewogICAgICAgICAgICBpZiAodGhpcy5fbGluZUNhcFN0YWNrLmxlbmd0aCA+PSAxMDApIHRocm93IG5ldyBFcnJvcigicHVzaGVkIHRvbyBtYW55IGxpbmUgY2FwcyAtIGNoZWNrIHB1c2gvcG9wIHBhaXJzIik7CiAgICAgICAgICAgIHRoaXMuX2xpbmVDYXBTdGFjay5wdXNoKDApOwogICAgICAgICAgICB0aGlzLl9saW5lQ2FwID0gMAogICAgICAgIH0KICAgICAgICBQdXNoTGluZUNhcFNxdWFyZSgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX2xpbmVDYXBTdGFjay5sZW5ndGggPj0gMTAwKSB0aHJvdyBuZXcgRXJyb3IoInB1c2hlZCB0b28gbWFueSBsaW5lIGNhcHMgLSBjaGVjayBwdXNoL3BvcCBwYWlycyIpOwogICAgICAgICAgICB0aGlzLl9saW5lQ2FwU3RhY2sucHVzaCgxKTsKICAgICAgICAgICAgdGhpcy5fbGluZUNhcCA9IDEKICAgICAgICB9CiAgICAgICAgUHVzaExpbmVDYXBaYWcoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9saW5lQ2FwU3RhY2subGVuZ3RoID49CiAgICAgICAgICAgICAgICAxMDApIHRocm93IG5ldyBFcnJvcigicHVzaGVkIHRvbyBtYW55IGxpbmUgY2FwcyAtIGNoZWNrIHB1c2gvcG9wIHBhaXJzIik7CiAgICAgICAgICAgIHRoaXMuX2xpbmVDYXBTdGFjay5wdXNoKDIpOwogICAgICAgICAgICB0aGlzLl9saW5lQ2FwID0gMgogICAgICAgIH0KICAgICAgICBQb3BMaW5lQ2FwKCkgewogICAgICAgICAgICBpZiAodGhpcy5fbGluZUNhcFN0YWNrLmxlbmd0aCA8PSAxKSB0aHJvdyBuZXcgRXJyb3IoImNhbm5vdCBwb3AgbGFzdCBsaW5lIGNhcCAtIGNoZWNrIHB1c2gvcG9wIHBhaXJzIik7CiAgICAgICAgICAgIHRoaXMuX2xpbmVDYXBTdGFjay5wb3AoKTsKICAgICAgICAgICAgdGhpcy5fbGluZUNhcCA9IHRoaXMuX2xpbmVDYXBTdGFjay5hdCgtMSkKICAgICAgICB9CiAgICAgICAgU2V0TGluZU9mZnNldChuKSB7CiAgICAgICAgICAgIHRoaXMuX2xpbmVPZmZzZXQgPSBuOwogICAgICAgICAgICB0aGlzLl9saW5lT2Zmc2V0U3RhY2tbdGhpcy5fbGluZU9mZnNldFN0YWNrLmxlbmd0aCAtIDFdID0gbgogICAgICAgIH0KICAgICAgICBHZXRMaW5lT2Zmc2V0KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fbGluZU9mZnNldAogICAgICAgIH0KICAgICAgICBQdXNoTGluZU9mZnNldChuKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9saW5lT2Zmc2V0U3RhY2subGVuZ3RoID49IDEwMCkgdGhyb3cgbmV3IEVycm9yKCJwdXNoZWQgdG9vIG1hbnkgbGluZSBvZmZzZXRzIC0gY2hlY2sgcHVzaC9wb3AgcGFpcnMiKTsKICAgICAgICAgICAgdGhpcy5fbGluZU9mZnNldFN0YWNrLnB1c2gobik7CiAgICAgICAgICAgIHRoaXMuX2xpbmVPZmZzZXQgPSBuCiAgICAgICAgfQogICAgICAgIFBvcExpbmVPZmZzZXQoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9saW5lT2Zmc2V0U3RhY2subGVuZ3RoIDw9IDEpIHRocm93IG5ldyBFcnJvcigiY2Fubm90IHBvcCBsYXN0IGxpbmUgb2Zmc2V0IC0gY2hlY2sgcHVzaC9wb3AgcGFpcnMiKTsKICAgICAgICAgICAgdGhpcy5fbGluZU9mZnNldFN0YWNrLnBvcCgpOwogICAgICAgICAgICB0aGlzLl9saW5lT2Zmc2V0ID0gdGhpcy5fbGluZU9mZnNldFN0YWNrLmF0KC0xKQogICAgICAgIH0KICAgICAgICBDb252ZXhQb2x5KHB0cykgewogICAgICAgICAgICBjb25zdCBwdHNfY291bnQgPSBwdHMubGVuZ3RoIC8gMjsKICAgICAgICAgICAgaWYgKHB0c19jb3VudCA8IDMpIHRocm93IG5ldyBFcnJvcigibmVlZCBhdCBsZWFzdCAzIHBvaW50cyIpOwogICAgICAgICAgICBjb25zdCB0cmlzID0gcHRzX2NvdW50IC0gMjsKICAgICAgICAgICAgY29uc3QgbGFzdF90cmkgPSB0cmlzIC0gMTsKICAgICAgICAgICAgY29uc3QgcDB4ID0gcHRzWzBdOwogICAgICAgICAgICBjb25zdCBwMHkgPSBwdHNbMV07CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdHJpczsgaSArPSAyKSB7CiAgICAgICAgICAgICAgICBjb25zdCBpMiA9IGkgKiAyOwogICAgICAgICAgICAgICAgY29uc3QgcDF4ID0gcHRzW2kyICsgMl07CiAgICAgICAgICAgICAgICBjb25zdCBwMXkgPSBwdHNbaTIgKyAzXTsKICAgICAgICAgICAgICAgIGNvbnN0IHAyeCA9IHB0c1tpMiArIDRdOwogICAgICAgICAgICAgICAgY29uc3QgcDJ5ID0gcHRzW2kyICsgNV07CiAgICAgICAgICAgICAgICBpZiAoaSA9PT0gbGFzdF90cmkpIHRoaXMuUXVhZDIocDB4LCBwMHksIHAxeCwgcDF5LCBwMngsIHAyeSwgcDJ4LCBwMnkpOwogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcDN4ID0gcHRzW2kyICsgNl07CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcDN5ID0gcHRzW2kyICsgN107CiAgICAgICAgICAgICAgICAgICAgdGhpcy5RdWFkMihwMHgsIHAweSwgcDF4LCBwMXksIHAyeCwgcDJ5LCBwM3gsIHAzeSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBHZXROdW1WZXJ0ZXhDb21wb25lbnRzKCkgewogICAgICAgICAgICByZXR1cm4gMwogICAgICAgIH0KICAgICAgICBGaW5pc2goKSB7CiAgICAgICAgICAgIHRoaXMuRW5kQmF0Y2godHJ1ZSk7CiAgICAgICAgICAgIHRoaXMuX2ZyYW1lTnVtYmVyKysKICAgICAgICB9CiAgICAgICAgR2V0RnJhbWVOdW1iZXIoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9mcmFtZU51bWJlcgogICAgICAgIH0KICAgICAgICBJbmNyZW1lbnRGcmFtZU51bWJlcigpIHsKICAgICAgICAgICAgdGhpcy5fZnJhbWVOdW1iZXIrKwogICAgICAgIH0KICAgICAgICBTZXRNaXBtYXBzRW5hYmxlZChlKSB7CiAgICAgICAgICAgIHRoaXMuX2VuYWJsZU1pcG1hcHMgPSAhIWUKICAgICAgICB9CiAgICAgICAgQXJlTWlwbWFwc0VuYWJsZWQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9lbmFibGVNaXBtYXBzCiAgICAgICAgfQogICAgICAgIFNldEhhc01ham9yUGVyZm9ybWFuY2VDYXZlYXQoYykgewogICAgICAgICAgICB0aGlzLl9oYXNNYWpvclBlcmZvcm1hbmNlQ2F2ZWF0ID0gISFjCiAgICAgICAgfQogICAgICAgIEhhc01ham9yUGVyZm9ybWFuY2VDYXZlYXQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9oYXNNYWpvclBlcmZvcm1hbmNlQ2F2ZWF0CiAgICAgICAgfQogICAgICAgIElzV2ViR0woKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZQogICAgICAgIH0KICAgICAgICBJc1dlYkdQVSgpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgfQogICAgfTsKCn0KCi8vIC4uL2xpYi9nZngvc2hhZGVyUHJvZ3JhbUJhc2UuanMKewogICAgJ3VzZSBzdHJpY3QnOwogICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgQzMuR2Z4LlNoYWRlclByb2dyYW1CYXNlID0gY2xhc3MgU2hhZGVyUHJvZ3JhbUJhc2UgewogICAgICAgIGNvbnN0cnVjdG9yKHJlbmRlcmVyLCBzaGFkZXJJbmZvKSB7CiAgICAgICAgICAgIHRoaXMuX25hbWUgPSBzaGFkZXJJbmZvLm5hbWU7CiAgICAgICAgICAgIHRoaXMuX3JlbmRlcmVyID0gcmVuZGVyZXI7CiAgICAgICAgICAgIHRoaXMuX2V4dGVuZEJveEhvcml6b250YWwgPSBzaGFkZXJJbmZvLmV4dGVuZEJveEhvcml6b250YWwgfHwgMDsKICAgICAgICAgICAgdGhpcy5fZXh0ZW5kQm94VmVydGljYWwgPSBzaGFkZXJJbmZvLmV4dGVuZEJveFZlcnRpY2FsIHx8IDA7CiAgICAgICAgICAgIHRoaXMuX2Nyb3NzU2FtcGxpbmcgPSAhIXNoYWRlckluZm8uY3Jvc3NTYW1wbGluZzsKICAgICAgICAgICAgdGhpcy5fbXVzdFByZURyYXcgPSAhIXNoYWRlckluZm8ubXVzdFByZURyYXc7CiAgICAgICAgICAgIHRoaXMuX3ByZXNlcnZlc09wYXF1ZW5lc3MgPSAhIXNoYWRlckluZm8ucHJlc2VydmVzT3BhcXVlbmVzczsKICAgICAgICAgICAgdGhpcy5fYW5pbWF0ZWQgPSAhIXNoYWRlckluZm8uYW5pbWF0ZWQ7CiAgICAgICAgICAgIHRoaXMuX2JsZW5kc0JhY2tncm91bmQgPSAhIXNoYWRlckluZm8uYmxlbmRzQmFja2dyb3VuZDsKICAgICAgICAgICAgdGhpcy5fdXNlc0RlcHRoID0gISFzaGFkZXJJbmZvLnVzZXNEZXB0aDsKICAgICAgICAgICAgdGhpcy5fdXNlc0FueVNyY1JlY3RPclBpeGVsU2l6ZSA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl9uZWVkc1Bvc3REcmF3T3JFeHRlbmRCb3ggPSB0aGlzLl9jcm9zc1NhbXBsaW5nIHx8IHRoaXMuX2JsZW5kc0JhY2tncm91bmQgfHwgdGhpcy5fZXh0ZW5kQm94SG9yaXpvbnRhbCAhPT0gMCB8fCB0aGlzLl9leHRlbmRCb3hWZXJ0aWNhbCAhPT0gMAogICAgICAgIH0KICAgICAgICBSZWxlYXNlKCkgewogICAgICAgICAgICB0aGlzLl9yZW5kZXJlciA9IG51bGwKICAgICAgICB9CiAgICAgICAgR2V0UmVuZGVyZXIoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9yZW5kZXJlcgogICAgICAgIH0KICAgICAgICBHZXROYW1lKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fbmFtZQogICAgICAgIH0KICAgICAgICBFeHRlbmRzQm94KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZXh0ZW5kQm94SG9yaXpvbnRhbCAhPT0gMCB8fCB0aGlzLl9leHRlbmRCb3hWZXJ0aWNhbCAhPT0gMAogICAgICAgIH0KICAgICAgICBHZXRCb3hFeHRlbmRIb3Jpem9udGFsKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZXh0ZW5kQm94SG9yaXpvbnRhbAogICAgICAgIH0KICAgICAgICBHZXRCb3hFeHRlbmRWZXJ0aWNhbCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2V4dGVuZEJveFZlcnRpY2FsCiAgICAgICAgfQogICAgICAgIFVzZXNDcm9zc1NhbXBsaW5nKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fY3Jvc3NTYW1wbGluZwogICAgICAgIH0KICAgICAgICBNdXN0UHJlRHJhdygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX211c3RQcmVEcmF3CiAgICAgICAgfQogICAgICAgIFByZXNlcnZlc09wYXF1ZW5lc3MoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9wcmVzZXJ2ZXNPcGFxdWVuZXNzCiAgICAgICAgfQogICAgICAgIElzQW5pbWF0ZWQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9hbmltYXRlZAogICAgICAgIH0KICAgICAgICBCbGVuZHNCYWNrZ3JvdW5kKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fYmxlbmRzQmFja2dyb3VuZAogICAgICAgIH0KICAgICAgICBVc2VzRGVwdGgoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl91c2VzRGVwdGgKICAgICAgICB9CiAgICAgICAgVXNlc0FueVNyY1JlY3RPclBpeGVsU2l6ZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3VzZXNBbnlTcmNSZWN0T3JQaXhlbFNpemUKICAgICAgICB9CiAgICAgICAgTmVlZHNQb3N0RHJhd09yRXh0ZW5kc0JveCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX25lZWRzUG9zdERyYXdPckV4dGVuZEJveAogICAgICAgIH0KICAgICAgICBVc2VzSXNTcmNUZXhSb3RhdGVkKCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICB9CiAgICB9OwoKfQoKLy8gLi4vbGliL2dmeC9zdGF0ZUdyb3VwLmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIEMzLkdmeC5TdGF0ZUdyb3VwID0gY2xhc3MgU3RhdGVHcm91cCB7CiAgICAgICAgY29uc3RydWN0b3IocmVuZGVyZXIsIHNoYWRlclByb2dyYW1fb3JfbmFtZSwgYmxlbmRNb2RlLCBjb2xvciwgekVsZXZhdGlvbikgewogICAgICAgICAgICB0aGlzLl9yZW5kZXJlciA9IHJlbmRlcmVyOwogICAgICAgICAgICB0aGlzLl9yZWZDb3VudCA9IDA7CiAgICAgICAgICAgIHRoaXMuX3NoYWRlclByb2dyYW0gPSBudWxsOwogICAgICAgICAgICB0aGlzLl9zaGFkZXJQcm9ncmFtTmFtZSA9ICIiOwogICAgICAgICAgICB0aGlzLl9ibGVuZE1vZGUgPSBibGVuZE1vZGU7CiAgICAgICAgICAgIHRoaXMuX2NvbG9yID0gQzMuTmV3KEMzLkNvbG9yKTsKICAgICAgICAgICAgdGhpcy5fY29sb3Iuc2V0KGNvbG9yKTsKICAgICAgICAgICAgdGhpcy5fekVsZXZhdGlvbiA9IHpFbGV2YXRpb247CiAgICAgICAgICAgIGlmICh0eXBlb2Ygc2hhZGVyUHJvZ3JhbV9vcl9uYW1lID09PSAic3RyaW5nIikgdGhpcy5fc2hhZGVyUHJvZ3JhbU5hbWUgPSBzaGFkZXJQcm9ncmFtX29yX25hbWU7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5fc2hhZGVyUHJvZ3JhbSA9IHNoYWRlclByb2dyYW1fb3JfbmFtZTsKICAgICAgICAgICAgICAgIHRoaXMuX3NoYWRlclByb2dyYW1OYW1lID0gdGhpcy5fc2hhZGVyUHJvZ3JhbS5HZXROYW1lKCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBSZWxlYXNlKCkgewogICAgICAgICAgICBpZiAodGhpcy5fcmVmQ291bnQgPiAwKSB0aHJvdyBuZXcgRXJyb3IoInJlbGVhc2luZyBzdGF0ZSBncm91cCBzdGlsbCBpbiB1c2UiKTsKICAgICAgICAgICAgdGhpcy5fcmVuZGVyZXIgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9zaGFkZXJQcm9ncmFtID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fc2hhZGVyUHJvZ3JhbU5hbWUgPSAiIgogICAgICAgIH0KICAgICAgICBBcHBseSgpIHsKICAgICAgICAgICAgY29uc3QgcmVuZGVyZXIgPSB0aGlzLl9yZW5kZXJlcjsKICAgICAgICAgICAgcmVuZGVyZXIuU2V0UHJvZ3JhbSh0aGlzLl9zaGFkZXJQcm9ncmFtKTsKICAgICAgICAgICAgcmVuZGVyZXIuU2V0QmxlbmRNb2RlKHRoaXMuX2JsZW5kTW9kZSk7CiAgICAgICAgICAgIHJlbmRlcmVyLlNldENvbG9yKHRoaXMuX2NvbG9yKTsKICAgICAgICAgICAgcmVuZGVyZXIuU2V0Q3VycmVudFoodGhpcy5fekVsZXZhdGlvbik7CiAgICAgICAgICAgIHJlbmRlcmVyLl9TZXRDdXJyZW50U3RhdGVHcm91cCh0aGlzKQogICAgICAgIH0KICAgICAgICBHZXRLZXkoKSB7CiAgICAgICAgICAgIHJldHVybiBDMy5HZnguU3RhdGVHcm91cC5NYWtlS2V5KHRoaXMuX3NoYWRlclByb2dyYW1OYW1lLCB0aGlzLl9ibGVuZE1vZGUsIHRoaXMuX2NvbG9yLCB0aGlzLl96RWxldmF0aW9uKQogICAgICAgIH0KICAgICAgICBBZGRSZWYoKSB7CiAgICAgICAgICAgICsrdGhpcy5fcmVmQ291bnQKICAgICAgICB9CiAgICAgICAgRGVjUmVmKCkgewogICAgICAgICAgICAtLXRoaXMuX3JlZkNvdW50CiAgICAgICAgfQogICAgICAgIF9HZXRSZWZDb3VudCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3JlZkNvdW50CiAgICAgICAgfQogICAgICAgIE9uQ29udGV4dExvc3QoKSB7CiAgICAgICAgICAgIHRoaXMuX3NoYWRlclByb2dyYW0gPQogICAgICAgICAgICAgICAgbnVsbAogICAgICAgIH0KICAgICAgICBPbkNvbnRleHRSZXN0b3JlZChyZW5kZXJlcikgewogICAgICAgICAgICB0aGlzLl9zaGFkZXJQcm9ncmFtID0gcmVuZGVyZXIuR2V0U2hhZGVyUHJvZ3JhbUJ5TmFtZSh0aGlzLl9zaGFkZXJQcm9ncmFtTmFtZSk7CiAgICAgICAgICAgIGlmICghdGhpcy5fc2hhZGVyUHJvZ3JhbSkgdGhyb3cgbmV3IEVycm9yKCJmYWlsZWQgdG8gcmVzdG9yZSBzaGFkZXIgcHJvZ3JhbSIpOwogICAgICAgIH0KICAgICAgICBzdGF0aWMgTWFrZUtleShzaGFkZXJQcm9ncmFtX29yX25hbWUsIGJsZW5kTW9kZSwgYywgekVsZXZhdGlvbikgewogICAgICAgICAgICBjb25zdCBzaGFkZXJQcm9ncmFtTmFtZSA9IHR5cGVvZiBzaGFkZXJQcm9ncmFtX29yX25hbWUgPT09ICJzdHJpbmciID8gc2hhZGVyUHJvZ3JhbV9vcl9uYW1lIDogc2hhZGVyUHJvZ3JhbV9vcl9uYW1lLkdldE5hbWUoKTsKICAgICAgICAgICAgcmV0dXJuIHNoYWRlclByb2dyYW1OYW1lICsgIiwiICsgYmxlbmRNb2RlICsgIiwiICsgYy5nZXRSKCkgKyAiLCIgKyBjLmdldEcoKSArICIsIiArIGMuZ2V0QigpICsgIiwiICsgYy5nZXRBKCkgKyAiLCIgKyB6RWxldmF0aW9uCiAgICAgICAgfQogICAgfTsKCn0KCi8vIC4uL2xpYi9nZngvbWVzaC5qcwp7CiAgICAndXNlIHN0cmljdCc7CiAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICBjb25zdCB0ZW1wUXVhZFRleCA9IEMzLk5ldyhDMy5RdWFkKTsKCiAgICBmdW5jdGlvbiBpbnRlcnBvbGF0ZVF1YWQoc3JjWCwgc3JjWSwgcXVhZCkgewogICAgICAgIGNvbnN0IHF0bHggPSBxdWFkLmdldFRseCgpOwogICAgICAgIGNvbnN0IHF0bHkgPSBxdWFkLmdldFRseSgpOwogICAgICAgIGNvbnN0IHF0cnggPSBxdWFkLmdldFRyeCgpIC0gcXRseDsKICAgICAgICBjb25zdCBxdHJ5ID0gcXVhZC5nZXRUcnkoKSAtIHF0bHk7CiAgICAgICAgY29uc3QgcWJseCA9IHF1YWQuZ2V0Qmx4KCkgLSBxdGx4OwogICAgICAgIGNvbnN0IHFibHkgPSBxdWFkLmdldEJseSgpIC0gcXRseTsKICAgICAgICBjb25zdCB4aXggPSBxdHJ4ICogc3JjWDsKICAgICAgICBjb25zdCB4aXkgPSBxdHJ5ICogc3JjWDsKICAgICAgICBjb25zdCB5aXggPSBxYmx4ICogc3JjWTsKICAgICAgICBjb25zdCB5aXkgPSBxYmx5ICogc3JjWTsKICAgICAgICByZXR1cm4gW3F0bHggKyB4aXggKyB5aXgsIHF0bHkgKyB4aXkgKyB5aXldCiAgICB9CiAgICBDMy5HZnguTWVzaFBvaW50ID0gY2xhc3MgTWVzaFBvaW50IHsKICAgICAgICBjb25zdHJ1Y3RvcihtZXNoLCBjb2wsIHJvdykgewogICAgICAgICAgICB0aGlzLl9tZXNoID0gbWVzaDsKICAgICAgICAgICAgdGhpcy5fY29sID0gY29sOwogICAgICAgICAgICB0aGlzLl9yb3cgPSByb3c7CiAgICAgICAgICAgIHRoaXMuX3ggPSBOYU47CiAgICAgICAgICAgIHRoaXMuX3kgPSBOYU47CiAgICAgICAgICAgIHRoaXMuX3pFbGV2YXRpb24gPSBOYU47CiAgICAgICAgICAgIHRoaXMuX3UgPSBOYU47CiAgICAgICAgICAgIHRoaXMuX3YgPSBOYU47CiAgICAgICAgICAgIHRoaXMuX3ggPSAwOwogICAgICAgICAgICB0aGlzLl95ID0gMDsKICAgICAgICAgICAgdGhpcy5fekVsZXZhdGlvbiA9IDA7CiAgICAgICAgICAgIHRoaXMuX3UgPSAwOwogICAgICAgICAgICB0aGlzLl92ID0gMAogICAgICAgIH0KICAgICAgICBfSW5pdCh4LCB5LCB1LCB2KSB7CiAgICAgICAgICAgIHRoaXMuX3ggPSB4OwogICAgICAgICAgICB0aGlzLl95ID0geTsKICAgICAgICAgICAgdGhpcy5fdSA9IHU7CiAgICAgICAgICAgIHRoaXMuX3YgPSB2CiAgICAgICAgfQogICAgICAgIEdldFgoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl94CiAgICAgICAgfQogICAgICAgIFNldFgoeCkgewogICAgICAgICAgICBpZiAodGhpcy5feCA9PT0geCkgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl94ID0geDsKICAgICAgICAgICAgdGhpcy5fbWVzaC5fU2V0UG9pbnRzQ2hhbmdlZCgpCiAgICAgICAgfQogICAgICAgIEdldFkoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl95CiAgICAgICAgfQogICAgICAgIFNldFkoeSkgewogICAgICAgICAgICBpZiAodGhpcy5feSA9PT0geSkgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl95ID0geTsKICAgICAgICAgICAgdGhpcy5fbWVzaC5fU2V0UG9pbnRzQ2hhbmdlZCgpCiAgICAgICAgfQogICAgICAgIEdldFpFbGV2YXRpb24oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl96RWxldmF0aW9uCiAgICAgICAgfQogICAgICAgIFNldFpFbGV2YXRpb24oeikgewogICAgICAgICAgICBpZiAodGhpcy5fekVsZXZhdGlvbiA9PT0KICAgICAgICAgICAgICAgIHopIHJldHVybjsKICAgICAgICAgICAgdGhpcy5fekVsZXZhdGlvbiA9IE1hdGgubWF4KHosIDApOwogICAgICAgICAgICB0aGlzLl9tZXNoLl9TZXRQb2ludHNDaGFuZ2VkKCkKICAgICAgICB9CiAgICAgICAgR2V0VSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3UKICAgICAgICB9CiAgICAgICAgU2V0VSh1KSB7CiAgICAgICAgICAgIHRoaXMuX3UgPSB1CiAgICAgICAgfQogICAgICAgIEdldFYoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl92CiAgICAgICAgfQogICAgICAgIFNldFYodikgewogICAgICAgICAgICB0aGlzLl92ID0gdgogICAgICAgIH0KICAgICAgICBfSW50ZXJwb2xhdGVfVGV4UmVjdChzcmNQb2ludCwgcXVhZFBvcywgcmNUZXgpIHsKICAgICAgICAgICAgW3RoaXMuX3gsIHRoaXMuX3ldID0gaW50ZXJwb2xhdGVRdWFkKHNyY1BvaW50Ll94LCBzcmNQb2ludC5feSwgcXVhZFBvcyk7CiAgICAgICAgICAgIHRoaXMuX3pFbGV2YXRpb24gPSBzcmNQb2ludC5fekVsZXZhdGlvbjsKICAgICAgICAgICAgdGhpcy5fdSA9IEMzLmxlcnAocmNUZXguZ2V0TGVmdCgpLCByY1RleC5nZXRSaWdodCgpLCBzcmNQb2ludC5fdSk7CiAgICAgICAgICAgIHRoaXMuX3YgPSBDMy5sZXJwKHJjVGV4LmdldFRvcCgpLCByY1RleC5nZXRCb3R0b20oKSwgc3JjUG9pbnQuX3YpCiAgICAgICAgfQogICAgICAgIF9JbnRlcnBvbGF0ZV9UZXhRdWFkKHNyY1BvaW50LCBxdWFkUG9zLCBxdWFkVGV4KSB7CiAgICAgICAgICAgIFt0aGlzLl94LCB0aGlzLl95XSA9IGludGVycG9sYXRlUXVhZChzcmNQb2ludC5feCwKICAgICAgICAgICAgICAgIHNyY1BvaW50Ll95LCBxdWFkUG9zKTsKICAgICAgICAgICAgdGhpcy5fekVsZXZhdGlvbiA9IHNyY1BvaW50Ll96RWxldmF0aW9uOwogICAgICAgICAgICBbdGhpcy5fdSwgdGhpcy5fdl0gPSBpbnRlcnBvbGF0ZVF1YWQoc3JjUG9pbnQuX3UsIHNyY1BvaW50Ll92LCBxdWFkVGV4KQogICAgICAgIH0KICAgICAgICBTYXZlVG9Kc29uKCkgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgIngiOiB0aGlzLkdldFgoKSwKICAgICAgICAgICAgICAgICJ5IjogdGhpcy5HZXRZKCksCiAgICAgICAgICAgICAgICAieiI6IHRoaXMuR2V0WkVsZXZhdGlvbigpLAogICAgICAgICAgICAgICAgInUiOiB0aGlzLkdldFUoKSwKICAgICAgICAgICAgICAgICJ2IjogdGhpcy5HZXRWKCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBMb2FkRnJvbUpzb24obykgewogICAgICAgICAgICB0aGlzLlNldFgob1sieCJdKTsKICAgICAgICAgICAgdGhpcy5TZXRZKG9bInkiXSk7CiAgICAgICAgICAgIGlmIChvLmhhc093blByb3BlcnR5KCJ6IikpIHRoaXMuU2V0WkVsZXZhdGlvbihvWyJ6Il0pOwogICAgICAgICAgICB0aGlzLlNldFUob1sidSJdKTsKICAgICAgICAgICAgdGhpcy5TZXRWKG9bInYiXSkKICAgICAgICB9CiAgICAgICAgR2V0TWVzaCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX21lc2gKICAgICAgICB9CiAgICAgICAgR2V0Q29sdW1uKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fY29sCiAgICAgICAgfQogICAgICAgIEdldFJvdygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3JvdwogICAgICAgIH0KICAgIH07CiAgICBDMy5HZnguTWVzaCA9IGNsYXNzIE1lc2ggewogICAgICAgIGNvbnN0cnVjdG9yKGhzaXplLCB2c2l6ZSwgb3duZXIpIHsKICAgICAgICAgICAgaWYgKGhzaXplIDwgMiB8fCB2c2l6ZSA8IDIpIHRocm93IG5ldyBFcnJvcigiaW52YWxpZCBtZXNoIHNpemUiKTsKICAgICAgICAgICAgdGhpcy5faHNpemUgPSBoc2l6ZTsKICAgICAgICAgICAgdGhpcy5fdnNpemUgPSB2c2l6ZTsKICAgICAgICAgICAgdGhpcy5fb3duZXIgPSBvd25lciB8fCBudWxsOwogICAgICAgICAgICB0aGlzLl9wdHMgPSBbXTsKICAgICAgICAgICAgdGhpcy5fbWluWCA9IDA7CiAgICAgICAgICAgIHRoaXMuX21pblkgPSAwOwogICAgICAgICAgICB0aGlzLl9tYXhYID0gMTsKICAgICAgICAgICAgdGhpcy5fbWF4WSA9IDE7CiAgICAgICAgICAgIHRoaXMuX21heFogPSAwOwogICAgICAgICAgICB0aGlzLl9wb2ludHNDaGFuZ2VkID0gZmFsc2U7CiAgICAgICAgICAgIGNvbnN0IGxhc3RYID0gaHNpemUgLSAxOwogICAgICAgICAgICBjb25zdCBsYXN0WSA9IHZzaXplIC0gMTsKICAgICAgICAgICAgZm9yIChsZXQgeSA9IDA7IHkgPCB2c2l6ZTsgKyt5KSB7CiAgICAgICAgICAgICAgICBjb25zdCByb3cgPSBbXTsKICAgICAgICAgICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgaHNpemU7ICsreCkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IG1lc2hQb2ludCA9IEMzLk5ldyhDMy5HZnguTWVzaFBvaW50LCB0aGlzLCB4LCB5KTsKICAgICAgICAgICAgICAgICAgICBjb25zdCB4ZiA9IHggLyBsYXN0WDsKICAgICAgICAgICAgICAgICAgICBjb25zdCB5ZiA9IHkgLyBsYXN0WTsKICAgICAgICAgICAgICAgICAgICBtZXNoUG9pbnQuX0luaXQoeGYsIHlmLCB4ZiwgeWYpOwogICAgICAgICAgICAgICAgICAgIHJvdy5wdXNoKG1lc2hQb2ludCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMuX3B0cy5wdXNoKHJvdykKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBSZWxlYXNlKCkgewogICAgICAgICAgICBDMy5jbGVhckFycmF5KHRoaXMuX3B0cykKICAgICAgICB9CiAgICAgICAgR2V0SFNpemUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9oc2l6ZQogICAgICAgIH0KICAgICAgICBHZXRWU2l6ZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3ZzaXplCiAgICAgICAgfQogICAgICAgIEdldE93bmVyKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fb3duZXIKICAgICAgICB9CiAgICAgICAgX0dldFBvaW50cygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3B0cwogICAgICAgIH0KICAgICAgICBfU2V0UG9pbnRzQ2hhbmdlZCgpIHsKICAgICAgICAgICAgdGhpcy5fcG9pbnRzQ2hhbmdlZCA9CiAgICAgICAgICAgICAgICB0cnVlCiAgICAgICAgfQogICAgICAgIF9NYXliZUNvbXB1dGVCb3VuZHMoKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5fcG9pbnRzQ2hhbmdlZCkgcmV0dXJuOwogICAgICAgICAgICBsZXQgbWluWCA9IEluZmluaXR5OwogICAgICAgICAgICBsZXQgbWluWSA9IEluZmluaXR5OwogICAgICAgICAgICBsZXQgbWF4WCA9IC1JbmZpbml0eTsKICAgICAgICAgICAgbGV0IG1heFkgPSAtSW5maW5pdHk7CiAgICAgICAgICAgIGxldCBtYXhaID0gMDsKICAgICAgICAgICAgZm9yIChjb25zdCByb3cgb2YgdGhpcy5fcHRzKQogICAgICAgICAgICAgICAgZm9yIChjb25zdCBtZXNoUG9pbnQgb2Ygcm93KSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgeCA9IG1lc2hQb2ludC5HZXRYKCk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgeSA9IG1lc2hQb2ludC5HZXRZKCk7CiAgICAgICAgICAgICAgICAgICAgbWluWCA9IE1hdGgubWluKG1pblgsIHgpOwogICAgICAgICAgICAgICAgICAgIG1pblkgPSBNYXRoLm1pbihtaW5ZLCB5KTsKICAgICAgICAgICAgICAgICAgICBtYXhYID0gTWF0aC5tYXgobWF4WCwgeCk7CiAgICAgICAgICAgICAgICAgICAgbWF4WSA9IE1hdGgubWF4KG1heFksIHkpOwogICAgICAgICAgICAgICAgICAgIG1heFogPSBNYXRoLm1heChtYXhaLCBtZXNoUG9pbnQuR2V0WkVsZXZhdGlvbigpKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLl9taW5YID0gbWluWDsKICAgICAgICAgICAgdGhpcy5fbWluWSA9IG1pblk7CiAgICAgICAgICAgIHRoaXMuX21heFggPSBtYXhYOwogICAgICAgICAgICB0aGlzLl9tYXhZID0gbWF4WTsKICAgICAgICAgICAgdGhpcy5fbWF4WiA9IG1heFo7CiAgICAgICAgICAgIHRoaXMuX3BvaW50c0NoYW5nZWQgPSBmYWxzZQogICAgICAgIH0KICAgICAgICBHZXRNaW5YKCkgewogICAgICAgICAgICB0aGlzLl9NYXliZUNvbXB1dGVCb3VuZHMoKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX21pblgKICAgICAgICB9CiAgICAgICAgR2V0TWluWSgpIHsKICAgICAgICAgICAgdGhpcy5fTWF5YmVDb21wdXRlQm91bmRzKCk7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9taW5ZCiAgICAgICAgfQogICAgICAgIEdldE1heFgoKSB7CiAgICAgICAgICAgIHRoaXMuX01heWJlQ29tcHV0ZUJvdW5kcygpOwogICAgICAgICAgICByZXR1cm4gdGhpcy5fbWF4WAogICAgICAgIH0KICAgICAgICBHZXRNYXhZKCkgewogICAgICAgICAgICB0aGlzLl9NYXliZUNvbXB1dGVCb3VuZHMoKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX21heFkKICAgICAgICB9CiAgICAgICAgR2V0TWF4WigpIHsKICAgICAgICAgICAgdGhpcy5fTWF5YmVDb21wdXRlQm91bmRzKCk7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9tYXhaCiAgICAgICAgfQogICAgICAgIEhhc0FueVpFbGV2YXRpb24oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLkdldE1heFooKSA+IDAKICAgICAgICB9CiAgICAgICAgR2V0TWVzaFBvaW50QXQoeCwgeSkgewogICAgICAgICAgICB4ID0gTWF0aC5mbG9vcih4KTsKICAgICAgICAgICAgeSA9IE1hdGguZmxvb3IoeSk7CiAgICAgICAgICAgIGlmICh4IDwgMCB8fCB4ID49IHRoaXMuX2hzaXplIHx8IHkgPCAwIHx8IHkgPj0gdGhpcy5fdnNpemUpIHJldHVybiBudWxsOwogICAgICAgICAgICByZXR1cm4gdGhpcy5fcHRzW3ldW3hdCiAgICAgICAgfQogICAgICAgIENhbGN1bGF0ZVRyYW5zZm9ybWVkTWVzaChzcmNNZXNoLCBxdWFkUG9zLCByY1RleF9vcl9xdWFkKSB7CiAgICAgICAgICAgIGNvbnN0IGlzVGV4UmVjdCA9IHJjVGV4X29yX3F1YWQgaW5zdGFuY2VvZgogICAgICAgICAgICBDMy5SZWN0OwogICAgICAgICAgICBpZiAoc3JjTWVzaC5HZXRIU2l6ZSgpICE9PSB0aGlzLkdldEhTaXplKCkgfHwgc3JjTWVzaC5HZXRWU2l6ZSgpICE9PSB0aGlzLkdldFZTaXplKCkpIHRocm93IG5ldyBFcnJvcigic291cmNlIG1lc2ggd3Jvbmcgc2l6ZSIpOwogICAgICAgICAgICBjb25zdCBzcmNQdHMgPSBzcmNNZXNoLl9wdHM7CiAgICAgICAgICAgIGNvbnN0IGRlc3RQdHMgPSB0aGlzLl9wdHM7CiAgICAgICAgICAgIGZvciAobGV0IHkgPSAwLCBsZW5ZID0gZGVzdFB0cy5sZW5ndGg7IHkgPCBsZW5ZOyArK3kpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHNyY1JvdyA9IHNyY1B0c1t5XTsKICAgICAgICAgICAgICAgIGNvbnN0IGRlc3RSb3cgPSBkZXN0UHRzW3ldOwogICAgICAgICAgICAgICAgZm9yIChsZXQgeCA9IDAsIGxlblggPSBkZXN0Um93Lmxlbmd0aDsgeCA8IGxlblg7ICsreCkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNyY1BvaW50ID0gc3JjUm93W3hdOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGRlc3RQb2ludCA9IGRlc3RSb3dbeF07CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzVGV4UmVjdCkgZGVzdFBvaW50Ll9JbnRlcnBvbGF0ZV9UZXhSZWN0KHNyY1BvaW50LCBxdWFkUG9zLCByY1RleF9vcl9xdWFkKTsKICAgICAgICAgICAgICAgICAgICBlbHNlIGRlc3RQb2ludC5fSW50ZXJwb2xhdGVfVGV4UXVhZChzcmNQb2ludCwgcXVhZFBvcywgcmNUZXhfb3JfcXVhZCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBEcmF3KHJlbmRlcmVyKSB7CiAgICAgICAgICAgIGNvbnN0IHB0cyA9CiAgICAgICAgICAgICAgICB0aGlzLl9wdHM7CiAgICAgICAgICAgIGxldCBwcmV2Um93ID0gcHRzWzBdOwogICAgICAgICAgICBmb3IgKGxldCB5ID0gMSwgbGVuWSA9IHB0cy5sZW5ndGg7IHkgPCBsZW5ZOyArK3kpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHJvdyA9IHB0c1t5XTsKICAgICAgICAgICAgICAgIGxldCB0bCA9IHByZXZSb3dbMF07CiAgICAgICAgICAgICAgICBsZXQgYmwgPSByb3dbMF07CiAgICAgICAgICAgICAgICBmb3IgKGxldCB4ID0gMSwgbGVuWCA9IHJvdy5sZW5ndGg7IHggPCBsZW5YOyArK3gpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCB0ciA9IHByZXZSb3dbeF07CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYnIgPSByb3dbeF07CiAgICAgICAgICAgICAgICAgICAgdGVtcFF1YWRUZXguc2V0KHRsLkdldFUoKSwgdGwuR2V0VigpLCB0ci5HZXRVKCksIHRyLkdldFYoKSwgYnIuR2V0VSgpLCBici5HZXRWKCksIGJsLkdldFUoKSwgYmwuR2V0VigpKTsKICAgICAgICAgICAgICAgICAgICByZW5kZXJlci5RdWFkM0QyKHRsLkdldFgoKSwgdGwuR2V0WSgpLCB0bC5HZXRaRWxldmF0aW9uKCksIHRyLkdldFgoKSwgdHIuR2V0WSgpLCB0ci5HZXRaRWxldmF0aW9uKCksIGJyLkdldFgoKSwgYnIuR2V0WSgpLCBici5HZXRaRWxldmF0aW9uKCksIGJsLkdldFgoKSwgYmwuR2V0WSgpLCBibC5HZXRaRWxldmF0aW9uKCksIHRlbXBRdWFkVGV4KTsKICAgICAgICAgICAgICAgICAgICB0bCA9IHRyOwogICAgICAgICAgICAgICAgICAgIGJsID0gYnIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHByZXZSb3cgPSByb3cKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBPdXRsaW5lKHJlbmRlcmVyLAogICAgICAgICAgICB0cmFuc2Zvcm1GdW5jKSB7CiAgICAgICAgICAgIGlmICghdHJhbnNmb3JtRnVuYykgdHJhbnNmb3JtRnVuYyA9ICh4LCB5LCB6KSA9PiBbeCwgeSwgel07CiAgICAgICAgICAgIGNvbnN0IHB0cyA9IHRoaXMuX3B0czsKICAgICAgICAgICAgbGV0IHByZXZSb3cgPSBwdHNbMF07CiAgICAgICAgICAgIGZvciAobGV0IHkgPSAxLCBsZW5ZID0gcHRzLmxlbmd0aDsgeSA8IGxlblk7ICsreSkgewogICAgICAgICAgICAgICAgY29uc3Qgcm93ID0gcHRzW3ldOwogICAgICAgICAgICAgICAgbGV0IHRsID0gcHJldlJvd1swXTsKICAgICAgICAgICAgICAgIGxldCBibCA9IHJvd1swXTsKICAgICAgICAgICAgICAgIGZvciAobGV0IHggPSAxLCBsZW5YID0gcm93Lmxlbmd0aDsgeCA8IGxlblg7ICsreCkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHRyID0gcHJldlJvd1t4XTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBiciA9IHJvd1t4XTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBbdGx4LCB0bHksIHRsel0gPSB0cmFuc2Zvcm1GdW5jKHRsLkdldFgoKSwgdGwuR2V0WSgpLCB0bC5HZXRaRWxldmF0aW9uKCkpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IFt0cngsIHRyeV8sIHRyel0gPSB0cmFuc2Zvcm1GdW5jKHRyLkdldFgoKSwgdHIuR2V0WSgpLCB0ci5HZXRaRWxldmF0aW9uKCkpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IFticngsIGJyeSwgYnJ6XSA9IHRyYW5zZm9ybUZ1bmMoYnIuR2V0WCgpLCBici5HZXRZKCksIGJyLkdldFpFbGV2YXRpb24oKSk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgW2JseCwKICAgICAgICAgICAgICAgICAgICAgICAgYmx5LCBibHoKICAgICAgICAgICAgICAgICAgICBdID0gdHJhbnNmb3JtRnVuYyhibC5HZXRYKCksIGJsLkdldFkoKSwgYmwuR2V0WkVsZXZhdGlvbigpKTsKICAgICAgICAgICAgICAgICAgICByZW5kZXJlci5MaW5lM0QodGx4LCB0bHksIHRseiwgdHJ4LCB0cnlfLCB0cnopOwogICAgICAgICAgICAgICAgICAgIHJlbmRlcmVyLkxpbmUzRCh0bHgsIHRseSwgdGx6LCBicngsIGJyeSwgYnJ6KTsKICAgICAgICAgICAgICAgICAgICByZW5kZXJlci5MaW5lM0QodGx4LCB0bHksIHRseiwgYmx4LCBibHksIGJseik7CiAgICAgICAgICAgICAgICAgICAgaWYgKHggPT09IGxlblggLSAxKSByZW5kZXJlci5MaW5lM0QodHJ4LCB0cnlfLCB0cnosIGJyeCwgYnJ5LCBicnopOwogICAgICAgICAgICAgICAgICAgIGlmICh5ID09PSBsZW5ZIC0gMSkgcmVuZGVyZXIuTGluZTNEKGJseCwgYmx5LCBibHosIGJyeCwgYnJ5LCBicnopOwogICAgICAgICAgICAgICAgICAgIHRsID0gdHI7CiAgICAgICAgICAgICAgICAgICAgYmwgPSBicgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcHJldlJvdyA9IHJvdwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIEluc2VydFBvbHlNZXNoVmVydGljZXMoc3JjUG9seSkgewogICAgICAgICAgICBjb25zdCBSQVlfRVhUX0RJU1QgPSAuMDAxOwogICAgICAgICAgICBjb25zdCBNSU5fUkFZX0RJU1QgPSAwOwogICAgICAgICAgICBjb25zdCBNQVhfUkFZX0RJU1QgPSAuOTk5OTk5OTk7CiAgICAgICAgICAgIGNvbnN0IGluUHRzID0gc3JjUG9seS5wb2ludHNBcnIoKTsKICAgICAgICAgICAgY29uc3Qgb3V0UHRzID0gW107CiAgICAgICAgICAgIGNvbnN0IGNvbENvdW50ID0gdGhpcy5HZXRIU2l6ZSgpIC0KICAgICAgICAgICAgICAgIDE7CiAgICAgICAgICAgIGNvbnN0IHJvd0NvdW50ID0gdGhpcy5HZXRWU2l6ZSgpIC0gMTsKICAgICAgICAgICAgY29uc3QgY29sV2lkdGhOb3JtID0gMSAvIGNvbENvdW50OwogICAgICAgICAgICBjb25zdCByb3dIZWlnaHROb3JtID0gMSAvIHJvd0NvdW50OwogICAgICAgICAgICBjb25zdCBsYXN0Q29sID0gY29sQ291bnQgLSAxOwogICAgICAgICAgICBjb25zdCBsYXN0Um93ID0gcm93Q291bnQgLSAxOwogICAgICAgICAgICBsZXQgY3VyWCA9IGluUHRzWzBdOwogICAgICAgICAgICBsZXQgY3VyWSA9IGluUHRzWzFdOwogICAgICAgICAgICBsZXQgY3VyQ29sID0gQzMuY2xhbXAoTWF0aC5mbG9vcihjdXJYICogY29sQ291bnQpLCAwLCBsYXN0Q29sKTsKICAgICAgICAgICAgbGV0IGN1clJvdyA9IEMzLmNsYW1wKE1hdGguZmxvb3IoY3VyWSAqIHJvd0NvdW50KSwgMCwgbGFzdFJvdyk7CiAgICAgICAgICAgIGxldCBpc1VwcGVyID0gdHJ1ZTsKICAgICAgICAgICAgbGV0IG5leHRYID0gMDsKICAgICAgICAgICAgbGV0IG5leHRZID0gMDsKICAgICAgICAgICAgbGV0IHJheUhpdCA9IDA7CiAgICAgICAgICAgIGNvbnN0IE5PVEhJTkdfRElTQUJMRUQgPSAtMTsKICAgICAgICAgICAgY29uc3QgRElTQUJMRV9ESUFHT05BTCA9IDA7CiAgICAgICAgICAgIGNvbnN0IERJU0FCTEVfTEVGVF9FREdFID0gMTsKICAgICAgICAgICAgY29uc3QgRElTQUJMRV9UT1BfRURHRSA9IDI7CiAgICAgICAgICAgIGNvbnN0IERJU0FCTEVfUklHSFRfRURHRSA9IDM7CiAgICAgICAgICAgIGNvbnN0IERJU0FCTEVfQk9UVE9NX0VER0UgPQogICAgICAgICAgICAgICAgNDsKICAgICAgICAgICAgbGV0IGRpc2FibGVDaGVjayA9IE5PVEhJTkdfRElTQUJMRUQ7CiAgICAgICAgICAgIGNvbnN0IGFkZFZlcnRleEF0UmF5SGl0ID0gKCkgPT4gewogICAgICAgICAgICAgICAgY3VyWCA9IEMzLmNsYW1wKEMzLmxlcnAoY3VyWCwgbmV4dFgsIHJheUhpdCksIDAsIDEpOwogICAgICAgICAgICAgICAgY3VyWSA9IEMzLmNsYW1wKEMzLmxlcnAoY3VyWSwgbmV4dFksIHJheUhpdCksIDAsIDEpOwogICAgICAgICAgICAgICAgb3V0UHRzLnB1c2goY3VyWCwgY3VyWSkKICAgICAgICAgICAgfTsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IGluUHRzLmxlbmd0aDsgaSA8IGxlbjsgaSArPSAyKSB7CiAgICAgICAgICAgICAgICBjdXJYID0gaW5QdHNbaV07CiAgICAgICAgICAgICAgICBjdXJZID0gaW5QdHNbaSArIDFdOwogICAgICAgICAgICAgICAgb3V0UHRzLnB1c2goY3VyWCwgY3VyWSk7CiAgICAgICAgICAgICAgICBjdXJDb2wgPSBDMy5jbGFtcChNYXRoLmZsb29yKGN1clggKiBjb2xDb3VudCksIDAsIGxhc3RDb2wpOwogICAgICAgICAgICAgICAgY3VyUm93ID0gQzMuY2xhbXAoTWF0aC5mbG9vcihjdXJZICogcm93Q291bnQpLCAwLCBsYXN0Um93KTsKICAgICAgICAgICAgICAgIGNvbnN0IGogPSAoaSArIDIpICUgbGVuOwogICAgICAgICAgICAgICAgbmV4dFggPSBpblB0c1tqXTsKICAgICAgICAgICAgICAgIG5leHRZID0gaW5QdHNbaiArIDFdOwogICAgICAgICAgICAgICAgZGlzYWJsZUNoZWNrID0gTk9USElOR19ESVNBQkxFRDsKICAgICAgICAgICAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKG91dFB0cy5sZW5ndGggPiAxRTYpIHRocm93IG5ldyBFcnJvcigiVG9vIG1hbnkgbWVzaCBwb2x5IHBvaW50cyIpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNyY1RseCA9IGN1ckNvbCAqIGNvbFdpZHRoTm9ybTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBzcmNUbHkgPSBjdXJSb3cgKiByb3dIZWlnaHROb3JtOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNyY0JyeCA9IChjdXJDb2wgKyAxKSAqIGNvbFdpZHRoTm9ybTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBzcmNCcnkgPSAoY3VyUm93ICsgMSkgKiByb3dIZWlnaHROb3JtOwogICAgICAgICAgICAgICAgICAgIGlzVXBwZXIgPSBDMy5pc1BvaW50SW5UcmlhbmdsZUluY2x1c2l2ZShjdXJYLCBjdXJZLCBzcmNUbHgsIHNyY1RseSwgc3JjQnJ4LCBzcmNUbHksIHNyY0JyeCwgc3JjQnJ5KTsKICAgICAgICAgICAgICAgICAgICBpZiAoZGlzYWJsZUNoZWNrICE9PSBESVNBQkxFX0RJQUdPTkFMKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJheUhpdCA9IEMzLnJheUludGVyc2VjdEV4dGVuZGVkKGN1clgsIGN1clksIG5leHRYLCBuZXh0WSwgc3JjVGx4LCBzcmNUbHksIHNyY0JyeCwgc3JjQnJ5LCAtUkFZX0VYVF9ESVNUKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJheUhpdCA+PSBNSU5fUkFZX0RJU1QgJiYgcmF5SGl0IDw9IE1BWF9SQVlfRElTVCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkVmVydGV4QXRSYXlIaXQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzVXBwZXIgPSAhaXNVcHBlcjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc2FibGVDaGVjayA9IERJU0FCTEVfRElBR09OQUw7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChjdXJSb3cgPiAwICYmCiAgICAgICAgICAgICAgICAgICAgICAgIGRpc2FibGVDaGVjayAhPT0gRElTQUJMRV9UT1BfRURHRSkgewogICAgICAgICAgICAgICAgICAgICAgICByYXlIaXQgPSBDMy5yYXlJbnRlcnNlY3RFeHRlbmRlZChjdXJYLCBjdXJZLCBuZXh0WCwgbmV4dFksIHNyY1RseCwgc3JjVGx5LCBzcmNCcngsIHNyY1RseSwgUkFZX0VYVF9ESVNUKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJheUhpdCA+PSBNSU5fUkFZX0RJU1QgJiYgcmF5SGl0IDw9IE1BWF9SQVlfRElTVCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkVmVydGV4QXRSYXlIaXQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1clJvdy0tOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNVcHBlciA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzYWJsZUNoZWNrID0gRElTQUJMRV9CT1RUT01fRURHRTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKGN1ckNvbCA8IGxhc3RDb2wgJiYgZGlzYWJsZUNoZWNrICE9PSBESVNBQkxFX1JJR0hUX0VER0UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmF5SGl0ID0gQzMucmF5SW50ZXJzZWN0RXh0ZW5kZWQoY3VyWCwgY3VyWSwgbmV4dFgsIG5leHRZLCBzcmNCcngsIHNyY1RseSwgc3JjQnJ4LCBzcmNCcnksIFJBWV9FWFRfRElTVCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyYXlIaXQgPj0gTUlOX1JBWV9ESVNUICYmIHJheUhpdCA8PSBNQVhfUkFZX0RJU1QpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZFZlcnRleEF0UmF5SGl0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJDb2wrKzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzVXBwZXIgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc2FibGVDaGVjayA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRElTQUJMRV9MRUZUX0VER0U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChjdXJDb2wgPiAwICYmIGRpc2FibGVDaGVjayAhPT0gRElTQUJMRV9MRUZUX0VER0UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmF5SGl0ID0gQzMucmF5SW50ZXJzZWN0RXh0ZW5kZWQoY3VyWCwgY3VyWSwgbmV4dFgsIG5leHRZLCBzcmNUbHgsIHNyY1RseSwgc3JjVGx4LCBzcmNCcnksIFJBWV9FWFRfRElTVCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyYXlIaXQgPj0gTUlOX1JBWV9ESVNUICYmIHJheUhpdCA8PSBNQVhfUkFZX0RJU1QpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZFZlcnRleEF0UmF5SGl0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJDb2wtLTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzVXBwZXIgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzYWJsZUNoZWNrID0gRElTQUJMRV9SSUdIVF9FREdFOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoY3VyUm93IDwgbGFzdFJvdyAmJiBkaXNhYmxlQ2hlY2sgIT09IERJU0FCTEVfQk9UVE9NX0VER0UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmF5SGl0ID0gQzMucmF5SW50ZXJzZWN0RXh0ZW5kZWQoY3VyWCwgY3VyWSwgbmV4dFgsIG5leHRZLCBzcmNUbHgsIHNyY0JyeSwgc3JjQnJ4LCBzcmNCcnksIFJBWV9FWFRfRElTVCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyYXlIaXQgPj0gTUlOX1JBWV9ESVNUICYmIHJheUhpdCA8PSBNQVhfUkFZX0RJU1QpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZFZlcnRleEF0UmF5SGl0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJSb3crKzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzVXBwZXIgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzYWJsZUNoZWNrID0gRElTQUJMRV9UT1BfRURHRTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gQzMuTmV3KEMzLkNvbGxpc2lvblBvbHksIG91dFB0cykKICAgICAgICB9CiAgICAgICAgVHJhbnNmb3JtQ29sbGlzaW9uUG9seShzcmNQb2x5LCBkZXN0UG9seSkgewogICAgICAgICAgICBjb25zdCBwdHNBcnIgPSB0aGlzLl9UcmFuc2Zvcm1Qb2x5UG9pbnRzKHNyY1BvbHkpOwogICAgICAgICAgICB0aGlzLl9TaW1wbGlmeVBvbHkocHRzQXJyKTsKICAgICAgICAgICAgZGVzdFBvbHkuc2V0UG9pbnRzKHB0c0FycikKICAgICAgICB9CiAgICAgICAgX1RyYW5zZm9ybVBvbHlQb2ludHMoc3JjUG9seSkgewogICAgICAgICAgICBjb25zdCBvdXRQdHMgPSBbXTsKICAgICAgICAgICAgY29uc3QgcHRzQXJyID0gc3JjUG9seS5wb2ludHNBcnIoKTsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IHB0c0Fyci5sZW5ndGg7IGkgPCBsZW47IGkgKz0gMikgewogICAgICAgICAgICAgICAgY29uc3Qgc3JjWCA9IHB0c0FycltpXTsKICAgICAgICAgICAgICAgIGNvbnN0IHNyY1kgPSBwdHNBcnJbaSArIDFdOwogICAgICAgICAgICAgICAgY29uc3QgW2Rlc3RYLCBkZXN0WV0gPSB0aGlzLlRyYW5zZm9ybVBvaW50KHNyY1gsIHNyY1kpOwogICAgICAgICAgICAgICAgb3V0UHRzLnB1c2goZGVzdFgsIGRlc3RZKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBvdXRQdHMKICAgICAgICB9CiAgICAgICAgVHJhbnNmb3JtUG9pbnQoc3JjWCwKICAgICAgICAgICAgc3JjWSkgewogICAgICAgICAgICBjb25zdCBsYXN0Q29sID0gdGhpcy5HZXRIU2l6ZSgpIC0gMTsKICAgICAgICAgICAgY29uc3QgbGFzdFJvdyA9IHRoaXMuR2V0VlNpemUoKSAtIDE7CiAgICAgICAgICAgIGNvbnN0IGNvbFdpZHRoTm9ybSA9IDEgLyBsYXN0Q29sOwogICAgICAgICAgICBjb25zdCByb3dIZWlnaHROb3JtID0gMSAvIGxhc3RSb3c7CiAgICAgICAgICAgIGNvbnN0IHNyY0NvbCA9IEMzLmNsYW1wKE1hdGguZmxvb3Ioc3JjWCAqIGxhc3RDb2wpLCAwLCBsYXN0Q29sIC0gMSk7CiAgICAgICAgICAgIGNvbnN0IHNyY1JvdyA9IEMzLmNsYW1wKE1hdGguZmxvb3Ioc3JjWSAqIGxhc3RSb3cpLCAwLCBsYXN0Um93IC0gMSk7CiAgICAgICAgICAgIGNvbnN0IHNyY1RseCA9IHNyY0NvbCAqIGNvbFdpZHRoTm9ybTsKICAgICAgICAgICAgY29uc3Qgc3JjVGx5ID0gc3JjUm93ICogcm93SGVpZ2h0Tm9ybTsKICAgICAgICAgICAgY29uc3Qgc3JjQnJ4ID0gKHNyY0NvbCArIDEpICogY29sV2lkdGhOb3JtOwogICAgICAgICAgICBjb25zdCBzcmNCcnkgPSAoc3JjUm93ICsgMSkgKiByb3dIZWlnaHROb3JtOwogICAgICAgICAgICBjb25zdCBkZXN0VGwgPSB0aGlzLkdldE1lc2hQb2ludEF0KHNyY0NvbCwgc3JjUm93KTsKICAgICAgICAgICAgY29uc3QgZGVzdEJyID0gdGhpcy5HZXRNZXNoUG9pbnRBdChzcmNDb2wgKyAxLCBzcmNSb3cgKyAxKTsKICAgICAgICAgICAgY29uc3QgaXNVcHBlciA9CiAgICAgICAgICAgICAgICBDMy5pc1BvaW50SW5UcmlhbmdsZUluY2x1c2l2ZShzcmNYLCBzcmNZLCBzcmNUbHgsIHNyY1RseSwgc3JjQnJ4LCBzcmNUbHksIHNyY0JyeCwgc3JjQnJ5KTsKICAgICAgICAgICAgY29uc3Qgc3JjQWx0WCA9IGlzVXBwZXIgPyBzcmNUbHggKyBjb2xXaWR0aE5vcm0gOiBzcmNUbHg7CiAgICAgICAgICAgIGNvbnN0IHNyY0FsdFkgPSBpc1VwcGVyID8gc3JjVGx5IDogc3JjVGx5ICsgcm93SGVpZ2h0Tm9ybTsKICAgICAgICAgICAgY29uc3QgZGVzdEFsdCA9IHRoaXMuR2V0TWVzaFBvaW50QXQoc3JjQ29sICsgKGlzVXBwZXIgPyAxIDogMCksIHNyY1JvdyArIChpc1VwcGVyID8gMCA6IDEpKTsKICAgICAgICAgICAgY29uc3QgW3UsIHYsIHddID0gQzMudHJpYW5nbGVDYXJ0ZXNpYW5Ub0JhcnljZW50cmljKHNyY1gsIHNyY1ksIHNyY1RseCwgc3JjVGx5LCBzcmNBbHRYLCBzcmNBbHRZLCBzcmNCcngsIHNyY0JyeSk7CiAgICAgICAgICAgIHJldHVybiBDMy50cmlhbmdsZUJhcnljZW50cmljVG9DYXJ0ZXNpYW4zZCh1LCB2LCB3LCBkZXN0VGwuR2V0WCgpLCBkZXN0VGwuR2V0WSgpLCBkZXN0VGwuR2V0WkVsZXZhdGlvbigpLCBkZXN0QWx0LkdldFgoKSwgZGVzdEFsdC5HZXRZKCksIGRlc3RBbHQuR2V0WkVsZXZhdGlvbigpLAogICAgICAgICAgICAgICAgZGVzdEJyLkdldFgoKSwgZGVzdEJyLkdldFkoKSwgZGVzdEJyLkdldFpFbGV2YXRpb24oKSkKICAgICAgICB9CiAgICAgICAgX1NpbXBsaWZ5UG9seShwdHNBcnIpIHsKICAgICAgICAgICAgY29uc3Qgb3V0UHRzID0gW107CiAgICAgICAgICAgIGNvbnN0IE5aX0VQU0lMT04gPSAxRS03OwogICAgICAgICAgICBjb25zdCBSX0VQU0lMT04gPSAuMDAxOwogICAgICAgICAgICBsZXQgY3VyWCA9IHB0c0FyclswXTsKICAgICAgICAgICAgbGV0IGN1clkgPSBwdHNBcnJbMV07CiAgICAgICAgICAgIGxldCBsYXN0RHggPSBjdXJYIC0gcHRzQXJyLmF0KC0yKTsKICAgICAgICAgICAgbGV0IGxhc3REeSA9IGN1clkgLSBwdHNBcnIuYXQoLTEpOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gcHRzQXJyLmxlbmd0aDsgaSA8IGxlbjsgaSArPSAyKSB7CiAgICAgICAgICAgICAgICBjb25zdCBqID0gKGkgKyAyKSAlIGxlbjsKICAgICAgICAgICAgICAgIGNvbnN0IG5leHRYID0gcHRzQXJyW2pdOwogICAgICAgICAgICAgICAgY29uc3QgbmV4dFkgPSBwdHNBcnJbaiArIDFdOwogICAgICAgICAgICAgICAgY29uc3QgZHggPSBuZXh0WCAtIGN1clg7CiAgICAgICAgICAgICAgICBjb25zdCBkeSA9IG5leHRZIC0gY3VyWTsKICAgICAgICAgICAgICAgIGNvbnN0IGJvdGhYTmVhclplcm8gPSBNYXRoLmFicyhkeCkgPCBOWl9FUFNJTE9OICYmIE1hdGguYWJzKGxhc3REeCkgPCBOWl9FUFNJTE9OICYmIE1hdGguc2lnbihkeSkgPT09IE1hdGguc2lnbihsYXN0RHkpOwogICAgICAgICAgICAgICAgY29uc3QgYm90aFlOZWFyWmVybyA9CiAgICAgICAgICAgICAgICAgICAgTWF0aC5hYnMoZHkpIDwgTlpfRVBTSUxPTiAmJiBNYXRoLmFicyhsYXN0RHkpIDwgTlpfRVBTSUxPTiAmJiBNYXRoLnNpZ24oZHgpID09PSBNYXRoLnNpZ24obGFzdER4KTsKICAgICAgICAgICAgICAgIGlmICghYm90aFhOZWFyWmVybyAmJiAhYm90aFlOZWFyWmVybyAmJiBNYXRoLmFicyhkeCAvIGxhc3REeCAtIGR5IC8gbGFzdER5KSA+IFJfRVBTSUxPTiB8fCBkeCA9PSAwICYmIGR5ID09PSAwKSBvdXRQdHMucHVzaChjdXJYLCBjdXJZKTsKICAgICAgICAgICAgICAgIGN1clggPSBuZXh0WDsKICAgICAgICAgICAgICAgIGN1clkgPSBuZXh0WTsKICAgICAgICAgICAgICAgIGxhc3REeCA9IGR4OwogICAgICAgICAgICAgICAgbGFzdER5ID0gZHkKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAob3V0UHRzLmxlbmd0aCA+PSA2ICYmIG91dFB0cy5sZW5ndGggPCBwdHNBcnIubGVuZ3RoKSBDMy5zaGFsbG93QXNzaWduQXJyYXkocHRzQXJyLCBvdXRQdHMpCiAgICAgICAgfQogICAgICAgIFNhdmVUb0pzb24oKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAiY29scyI6IHRoaXMuR2V0SFNpemUoKSwKICAgICAgICAgICAgICAgICJyb3dzIjogdGhpcy5HZXRWU2l6ZSgpLAogICAgICAgICAgICAgICAgInBvaW50cyI6IHRoaXMuX3B0cy5tYXAocm93ID0+IHJvdy5tYXAocHQgPT4gcHQuU2F2ZVRvSnNvbigpKSkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBMb2FkRnJvbUpzb24obykgewogICAgICAgICAgICBjb25zdCBjb2xzID0gdGhpcy5HZXRIU2l6ZSgpOwogICAgICAgICAgICBjb25zdCByb3dzID0KICAgICAgICAgICAgICAgIHRoaXMuR2V0VlNpemUoKTsKICAgICAgICAgICAgaWYgKG9bImNvbHMiXSAhPT0gY29scyB8fCBvWyJyb3dzIl0gIT09IHJvd3MpIHRocm93IG5ldyBFcnJvcigibWVzaCBkYXRhIHdyb25nIHNpemUiKTsKICAgICAgICAgICAgY29uc3QgbWVzaFJvd3MgPSBvWyJwb2ludHMiXTsKICAgICAgICAgICAgZm9yIChsZXQgeSA9IDA7IHkgPCByb3dzOyArK3kpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHJvd0RhdGEgPSBtZXNoUm93c1t5XTsKICAgICAgICAgICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgY29sczsgKyt4KSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcHQgPSB0aGlzLkdldE1lc2hQb2ludEF0KHgsIHkpOwogICAgICAgICAgICAgICAgICAgIHB0LkxvYWRGcm9tSnNvbihyb3dEYXRhW3hdKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKCn0KCi8vIC4uL2xpYi9nZngvd2ViZ2wvdGV4dHVyZS5qcwp7CiAgICAndXNlIHN0cmljdCc7CiAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICBjb25zdCBWQUxJRF9QSVhFTF9GT1JNQVRTID0gbmV3IFNldChbInJnYmE4IiwgInJnYjgiLCAicmdiYTQiLCAicmdiNV9hMSIsICJyZ2I1NjUiXSk7CiAgICBjb25zdCBWQUxJRF9TQU1QTElOR1MgPSBuZXcgU2V0KFsibmVhcmVzdCIsICJiaWxpbmVhciIsICJ0cmlsaW5lYXIiXSk7CiAgICBjb25zdCBWQUxJRF9NSVBNQVBfUVVBTElUSUVTID0gbmV3IFNldChbImRlZmF1bHQiLCAibG93IiwgImhpZ2giXSk7CiAgICBjb25zdCBWQUxJRF9XUkFQX01PREVTID0gbmV3IFNldChbImNsYW1wLXRvLWVkZ2UiLCAicmVwZWF0IiwgIm1pcnJvci1yZXBlYXQiXSk7CgogICAgZnVuY3Rpb24gR2V0Rm9ybWF0U3BlY2lmaWVycyhwaXhlbEZvcm1hdCwgZ2wpIHsKICAgICAgICBsZXQgc2l6ZWRpbnRlcm5hbGZvcm1hdDsKICAgICAgICBsZXQgaW50ZXJuYWxmb3JtYXQ7CiAgICAgICAgbGV0IGZvcm1hdDsKICAgICAgICBsZXQgdHlwZTsKICAgICAgICBzd2l0Y2ggKHBpeGVsRm9ybWF0KSB7CiAgICAgICAgICAgIGNhc2UgInJnYmE4IjoKICAgICAgICAgICAgICAgIHNpemVkaW50ZXJuYWxmb3JtYXQgPSBnbC5SR0JBODsKICAgICAgICAgICAgICAgIGludGVybmFsZm9ybWF0ID0gZ2wuUkdCQTsKICAgICAgICAgICAgICAgIGZvcm1hdCA9IGdsLlJHQkE7CiAgICAgICAgICAgICAgICB0eXBlID0gZ2wuVU5TSUdORURfQllURTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICJyZ2I4IjoKICAgICAgICAgICAgICAgIHNpemVkaW50ZXJuYWxmb3JtYXQgPSBnbC5SR0I4OwogICAgICAgICAgICAgICAgaW50ZXJuYWxmb3JtYXQgPSBnbC5SR0I7CiAgICAgICAgICAgICAgICBmb3JtYXQgPSBnbC5SR0I7CiAgICAgICAgICAgICAgICB0eXBlID0gZ2wuVU5TSUdORURfQllURTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICJyZ2JhNCI6CiAgICAgICAgICAgICAgICBzaXplZGludGVybmFsZm9ybWF0ID0gZ2wuUkdCQTQ7CiAgICAgICAgICAgICAgICBpbnRlcm5hbGZvcm1hdCA9IGdsLlJHQkE7CiAgICAgICAgICAgICAgICBmb3JtYXQgPSBnbC5SR0JBOwogICAgICAgICAgICAgICAgdHlwZSA9IGdsLlVOU0lHTkVEX1NIT1JUXzRfNF80XzQ7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAicmdiNV9hMSI6CiAgICAgICAgICAgICAgICBzaXplZGludGVybmFsZm9ybWF0ID0gZ2wuUkdCNV9BMTsKICAgICAgICAgICAgICAgIGludGVybmFsZm9ybWF0ID0gZ2wuUkdCQTsKICAgICAgICAgICAgICAgIGZvcm1hdCA9IGdsLlJHQkE7CiAgICAgICAgICAgICAgICB0eXBlID0gZ2wuVU5TSUdORURfU0hPUlRfNV81XzVfMTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICJyZ2I1NjUiOgogICAgICAgICAgICAgICAgc2l6ZWRpbnRlcm5hbGZvcm1hdCA9IGdsLlJHQjU2NTsKICAgICAgICAgICAgICAgIGludGVybmFsZm9ybWF0ID0gZ2wuUkdCOwogICAgICAgICAgICAgICAgZm9ybWF0ID0gZ2wuUkdCOwogICAgICAgICAgICAgICAgdHlwZSA9IGdsLlVOU0lHTkVEX1NIT1JUXzVfNl81OwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoImludmFsaWQgcGl4ZWwgZm9ybWF0Iik7CiAgICAgICAgfQogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHNpemVkaW50ZXJuYWxmb3JtYXQsCiAgICAgICAgICAgIGludGVybmFsZm9ybWF0LAogICAgICAgICAgICBmb3JtYXQsCiAgICAgICAgICAgIHR5cGUKICAgICAgICB9CiAgICB9CiAgICBjb25zdCBDUkVBVEVGUk9NX0RFRkFVTFRfT1BUSU9OUyA9IHsKICAgICAgICB3cmFwWDogImNsYW1wLXRvLWVkZ2UiLAogICAgICAgIHdyYXBZOiAiY2xhbXAtdG8tZWRnZSIsCiAgICAgICAgc2FtcGxpbmc6ICJ0cmlsaW5lYXIiLAogICAgICAgIGFuaXNvdHJvcHk6IDAsCiAgICAgICAgcGl4ZWxGb3JtYXQ6ICJyZ2JhOCIsCiAgICAgICAgbWlwTWFwOiB0cnVlLAogICAgICAgIG1pcE1hcFF1YWxpdHk6ICJkZWZhdWx0IiwKICAgICAgICBwcmVtdWx0aXBseUFscGhhOiB0cnVlLAogICAgICAgIGlzU3ZnOiBmYWxzZSwKICAgICAgICB3aWR0aDogLTEsCiAgICAgICAgaGVpZ2h0OiAtMQogICAgfTsKICAgIGNvbnN0IFVQREFURV9ERUZBVUxUX09QVElPTlMgPSB7CiAgICAgICAgcHJlbXVsdGlwbHlBbHBoYTogdHJ1ZSwKICAgICAgICBmbGlwWTogZmFsc2UKICAgIH07CiAgICBjb25zdCBhbGxUZXh0dXJlcyA9IG5ldyBTZXQ7CiAgICBDMy5HZnguV2ViR0xSZW5kZXJlclRleHR1cmUgPSBjbGFzcyBXZWJHTFJlbmRlcmVyVGV4dHVyZSB7CiAgICAgICAgY29uc3RydWN0b3IocmVuZGVyZXIpIHsKICAgICAgICAgICAgdGhpcy5fcmVuZGVyZXIgPSByZW5kZXJlcjsKICAgICAgICAgICAgdGhpcy5fdGV4dHVyZSA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3dpZHRoID0gMDsKICAgICAgICAgICAgdGhpcy5faGVpZ2h0ID0gMDsKICAgICAgICAgICAgdGhpcy5faXNTdGF0aWMgPSB0cnVlOwogICAgICAgICAgICB0aGlzLl93cmFwWCA9ICJjbGFtcC10by1lZGdlIjsKICAgICAgICAgICAgdGhpcy5fd3JhcFkgPSAiY2xhbXAtdG8tZWRnZSI7CiAgICAgICAgICAgIHRoaXMuX3NhbXBsaW5nID0gInRyaWxpbmVhciI7CiAgICAgICAgICAgIHRoaXMuX2FuaXNvdHJvcHkgPSAwOwogICAgICAgICAgICB0aGlzLl9waXhlbEZvcm1hdCA9ICJyZ2JhOCI7CiAgICAgICAgICAgIHRoaXMuX2lzTWlwTWFwcGVkID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX21pcE1hcFF1YWxpdHkgPSAiZGVmYXVsdCI7CiAgICAgICAgICAgIHRoaXMuX3JlZkNvdW50ID0gMAogICAgICAgIH0KICAgICAgICBfQ3JlYXRlU3RhdGljKGRhdGEsIG9wdHMpIHsKICAgICAgICAgICAgaWYgKCh0eXBlb2YgSFRNTEltYWdlRWxlbWVudCA9PT0gInVuZGVmaW5lZCIgfHwgIShkYXRhIGluc3RhbmNlb2YgSFRNTEltYWdlRWxlbWVudCkpICYmICh0eXBlb2YgSFRNTENhbnZhc0VsZW1lbnQgPT09CiAgICAgICAgICAgICAgICAgICAgInVuZGVmaW5lZCIgfHwgIShkYXRhIGluc3RhbmNlb2YgSFRNTENhbnZhc0VsZW1lbnQpKSAmJiAodHlwZW9mIEltYWdlQml0bWFwID09PSAidW5kZWZpbmVkIiB8fCAhKGRhdGEgaW5zdGFuY2VvZiBJbWFnZUJpdG1hcCkpICYmICh0eXBlb2YgT2Zmc2NyZWVuQ2FudmFzID09PSAidW5kZWZpbmVkIiB8fCAhKGRhdGEgaW5zdGFuY2VvZiBPZmZzY3JlZW5DYW52YXMpKSAmJiAhKGRhdGEgaW5zdGFuY2VvZiBJbWFnZURhdGEpICYmICEoZGF0YSBpbnN0YW5jZW9mIEFycmF5QnVmZmVyKSAmJiBkYXRhICE9PSBudWxsKSB0aHJvdyBuZXcgRXJyb3IoImludmFsaWQgdGV4dHVyZSBzb3VyY2UiKTsKICAgICAgICAgICAgb3B0cyA9IE9iamVjdC5hc3NpZ24oe30sIENSRUFURUZST01fREVGQVVMVF9PUFRJT05TLCBvcHRzKTsKICAgICAgICAgICAgaWYgKHRoaXMuX3RleHR1cmUpIHRocm93IG5ldyBFcnJvcigiYWxyZWFkeSBjcmVhdGVkIHRleHR1cmUiKTsKICAgICAgICAgICAgdGhpcy5fd3JhcFggPSBvcHRzLndyYXBYOwogICAgICAgICAgICB0aGlzLl93cmFwWSA9IG9wdHMud3JhcFk7CiAgICAgICAgICAgIHRoaXMuX3NhbXBsaW5nID0gb3B0cy5zYW1wbGluZzsKICAgICAgICAgICAgdGhpcy5fYW5pc290cm9weSA9IG9wdHMuYW5pc290cm9weTsKICAgICAgICAgICAgdGhpcy5fcGl4ZWxGb3JtYXQgPSBvcHRzLnBpeGVsRm9ybWF0OwogICAgICAgICAgICB0aGlzLl9pc01pcE1hcHBlZCA9ICEhb3B0cy5taXBNYXAgJiYgdGhpcy5fcmVuZGVyZXIuQXJlTWlwbWFwc0VuYWJsZWQoKTsKICAgICAgICAgICAgdGhpcy5fbWlwTWFwUXVhbGl0eSA9IG9wdHMubWlwTWFwUXVhbGl0eTsKICAgICAgICAgICAgaWYgKCFWQUxJRF9XUkFQX01PREVTLmhhcyh0aGlzLl93cmFwWCkgfHwgIVZBTElEX1dSQVBfTU9ERVMuaGFzKHRoaXMuX3dyYXBZKSkgdGhyb3cgbmV3IEVycm9yKCJpbnZhbGlkIHdyYXAgbW9kZSIpOwogICAgICAgICAgICBpZiAoIVZBTElEX1NBTVBMSU5HUy5oYXModGhpcy5fc2FtcGxpbmcpKSB0aHJvdyBuZXcgRXJyb3IoImludmFsaWQgc2FtcGxpbmciKTsKICAgICAgICAgICAgaWYgKCFWQUxJRF9QSVhFTF9GT1JNQVRTLmhhcyh0aGlzLl9waXhlbEZvcm1hdCkpIHRocm93IG5ldyBFcnJvcigiaW52YWxpZCBwaXhlbCBmb3JtYXQiKTsKICAgICAgICAgICAgaWYgKCFWQUxJRF9NSVBNQVBfUVVBTElUSUVTLmhhcyh0aGlzLl9taXBNYXBRdWFsaXR5KSkgdGhyb3cgbmV3IEVycm9yKCJpbnZhbGlkIG1pcG1hcCBxdWFsaXR5Iik7CiAgICAgICAgICAgIHRoaXMuX2lzU3RhdGljID0gdHJ1ZTsKICAgICAgICAgICAgaWYgKGRhdGEgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlciB8fCBkYXRhID09PSBudWxsIHx8IG9wdHMuaXNTdmcpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3dpZHRoID0gb3B0cy53aWR0aDsKICAgICAgICAgICAgICAgIHRoaXMuX2hlaWdodCA9IG9wdHMuaGVpZ2h0OwogICAgICAgICAgICAgICAgaWYgKGRhdGEgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlciAmJiBkYXRhLmJ5dGVMZW5ndGggIT09IHRoaXMuX3dpZHRoICogdGhpcy5faGVpZ2h0ICogNCkgdGhyb3cgbmV3IEVycm9yKCJBcnJheUJ1ZmZlciB3cm9uZyBzaXplIik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLl93aWR0aCA9IGRhdGEud2lkdGg7CiAgICAgICAgICAgICAgICB0aGlzLl9oZWlnaHQgPSBkYXRhLmhlaWdodAogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLl93aWR0aCA8PSAwIHx8IHRoaXMuX2hlaWdodCA8PSAwKSB0aHJvdyBuZXcgRXJyb3IoImludmFsaWQgdGV4dHVyZSBkYXRhIHNpemUiKTsKICAgICAgICAgICAgaWYgKG9wdHMuaXNTdmcpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGNhbnZhcyA9IEMzLkNyZWF0ZUNhbnZhcyh0aGlzLl93aWR0aCwgdGhpcy5faGVpZ2h0KTsKICAgICAgICAgICAgICAgIGNvbnN0IGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCIyZCIpOwogICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShkYXRhLAogICAgICAgICAgICAgICAgICAgIDAsIDAsIHRoaXMuX3dpZHRoLCB0aGlzLl9oZWlnaHQpOwogICAgICAgICAgICAgICAgZGF0YSA9IGNhbnZhcwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IGlzUE9UID0gQzMuaXNQT1QodGhpcy5fd2lkdGgpICYmIEMzLmlzUE9UKHRoaXMuX2hlaWdodCk7CiAgICAgICAgICAgIGNvbnN0IG1heFRleHR1cmVTaXplID0gdGhpcy5fcmVuZGVyZXIuR2V0TWF4VGV4dHVyZVNpemUoKTsKICAgICAgICAgICAgaWYgKHRoaXMuX3dpZHRoID4gbWF4VGV4dHVyZVNpemUgfHwgdGhpcy5faGVpZ2h0ID4gbWF4VGV4dHVyZVNpemUpIHRocm93IG5ldyBFcnJvcigidGV4dHVyZSBkYXRhIGV4Y2VlZHMgbWF4aW11bSB0ZXh0dXJlIHNpemUiKTsKICAgICAgICAgICAgY29uc3QgZ2wgPSB0aGlzLl9yZW5kZXJlci5HZXRDb250ZXh0KCk7CiAgICAgICAgICAgIGNvbnN0IHdlYmdsVmVyc2lvbiA9IHRoaXMuX3JlbmRlcmVyLkdldFdlYkdMVmVyc2lvbk51bWJlcigpOwogICAgICAgICAgICB0aGlzLl90ZXh0dXJlID0gZ2wuY3JlYXRlVGV4dHVyZSgpOwogICAgICAgICAgICBnbC5iaW5kVGV4dHVyZShnbC5URVhUVVJFXzJELCB0aGlzLl90ZXh0dXJlKTsKICAgICAgICAgICAgZ2wucGl4ZWxTdG9yZWkoZ2xbIlVOUEFDS19QUkVNVUxUSVBMWV9BTFBIQV9XRUJHTCJdLCBvcHRzLnByZW11bHRpcGx5QWxwaGEpOwogICAgICAgICAgICBnbC5waXhlbFN0b3JlaShnbFsiVU5QQUNLX0ZMSVBfWV9XRUJHTCJdLCBmYWxzZSk7CiAgICAgICAgICAgIGNvbnN0IGZvcm1hdHNwZWMgPSBHZXRGb3JtYXRTcGVjaWZpZXJzKHRoaXMuX3BpeGVsRm9ybWF0LCBnbCk7CiAgICAgICAgICAgIGlmICghdGhpcy5fcmVuZGVyZXIuU3VwcG9ydHNOUE9UVGV4dHVyZXMoKSAmJiAhaXNQT1QgJiYgdGhpcy5fSXNUaWxlZCgpKSB7CiAgICAgICAgICAgICAgICBpZiAoZGF0YSA9PT0gbnVsbCkgdGhyb3cgbmV3IEVycm9yKCJjYW5ub3QgcGFzcyBudWxsIGRhdGEgd2hlbiBjcmVhdGluZyBhIE5QT1QgdGlsZWQgdGV4dHVyZSB3aXRob3V0IE5QT1Qgc3VwcG9ydCIpOwogICAgICAgICAgICAgICAgaWYgKGRhdGEgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlcikgZGF0YSA9IG5ldyBJbWFnZURhdGEobmV3IFVpbnQ4Q2xhbXBlZEFycmF5KGRhdGEpLCB0aGlzLl93aWR0aCwgdGhpcy5faGVpZ2h0KTsKICAgICAgICAgICAgICAgIGlmIChkYXRhIGluc3RhbmNlb2YgSW1hZ2VEYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdG1wQ2FudmFzID0gQzMuQ3JlYXRlQ2FudmFzKHRoaXMuX3dpZHRoLCB0aGlzLl9oZWlnaHQpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHRtcEN0eCA9IHRtcENhbnZhcy5nZXRDb250ZXh0KCIyZCIpOwogICAgICAgICAgICAgICAgICAgIHRtcEN0eC5wdXRJbWFnZURhdGEoZGF0YSwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgZGF0YSA9IHRtcENhbnZhcwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY29uc3QgY2FudmFzID0gQzMuQ3JlYXRlQ2FudmFzKEMzLm5leHRIaWdoZXN0UG93ZXJPZlR3byh0aGlzLl93aWR0aCksIEMzLm5leHRIaWdoZXN0UG93ZXJPZlR3byh0aGlzLl9oZWlnaHQpKTsKICAgICAgICAgICAgICAgIGNvbnN0IGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCIyZCIpOwogICAgICAgICAgICAgICAgY3R4LmltYWdlU21vb3RoaW5nRW5hYmxlZCA9IHRoaXMuX3NhbXBsaW5nICE9PSAibmVhcmVzdCI7CiAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKGRhdGEsIDAsIDAsIHRoaXMuX3dpZHRoLCB0aGlzLl9oZWlnaHQsIDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7CiAgICAgICAgICAgICAgICBnbC50ZXhJbWFnZTJEKGdsLlRFWFRVUkVfMkQsIDAsIGZvcm1hdHNwZWMuaW50ZXJuYWxmb3JtYXQsIGZvcm1hdHNwZWMuZm9ybWF0LCBmb3JtYXRzcGVjLnR5cGUsIGNhbnZhcykKICAgICAgICAgICAgfSBlbHNlIGlmICh3ZWJnbFZlcnNpb24gPj0gMikgewogICAgICAgICAgICAgICAgbGV0IGxldmVsczsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9pc01pcE1hcHBlZCkgbGV2ZWxzID0gTWF0aC5mbG9vcihNYXRoLmxvZzIoTWF0aC5tYXgodGhpcy5fd2lkdGgsCiAgICAgICAgICAgICAgICAgICAgdGhpcy5faGVpZ2h0KSkgKyAxKTsKICAgICAgICAgICAgICAgIGVsc2UgbGV2ZWxzID0gMTsKICAgICAgICAgICAgICAgIGdsLnRleFN0b3JhZ2UyRChnbC5URVhUVVJFXzJELCBsZXZlbHMsIGZvcm1hdHNwZWMuc2l6ZWRpbnRlcm5hbGZvcm1hdCwgdGhpcy5fd2lkdGgsIHRoaXMuX2hlaWdodCk7CiAgICAgICAgICAgICAgICBpZiAoZGF0YSBpbnN0YW5jZW9mIEFycmF5QnVmZmVyKSBnbC50ZXhTdWJJbWFnZTJEKGdsLlRFWFRVUkVfMkQsIDAsIDAsIDAsIHRoaXMuX3dpZHRoLCB0aGlzLl9oZWlnaHQsIGZvcm1hdHNwZWMuZm9ybWF0LCBmb3JtYXRzcGVjLnR5cGUsIG5ldyBVaW50OEFycmF5KGRhdGEpKTsKICAgICAgICAgICAgICAgIGVsc2UgaWYgKGRhdGEgIT09IG51bGwpIGdsLnRleFN1YkltYWdlMkQoZ2wuVEVYVFVSRV8yRCwgMCwgMCwgMCwgZm9ybWF0c3BlYy5mb3JtYXQsIGZvcm1hdHNwZWMudHlwZSwgZGF0YSkKICAgICAgICAgICAgfSBlbHNlIGlmIChkYXRhIGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpIGdsLnRleEltYWdlMkQoZ2wuVEVYVFVSRV8yRCwgMCwgZm9ybWF0c3BlYy5pbnRlcm5hbGZvcm1hdCwgdGhpcy5fd2lkdGgsIHRoaXMuX2hlaWdodCwgMCwgZm9ybWF0c3BlYy5mb3JtYXQsCiAgICAgICAgICAgICAgICBmb3JtYXRzcGVjLnR5cGUsIG5ldyBVaW50OEFycmF5KGRhdGEpKTsKICAgICAgICAgICAgZWxzZSBpZiAoZGF0YSA9PT0gbnVsbCkgZ2wudGV4SW1hZ2UyRChnbC5URVhUVVJFXzJELCAwLCBmb3JtYXRzcGVjLmludGVybmFsZm9ybWF0LCB0aGlzLl93aWR0aCwgdGhpcy5faGVpZ2h0LCAwLCBmb3JtYXRzcGVjLmZvcm1hdCwgZm9ybWF0c3BlYy50eXBlLCBudWxsKTsKICAgICAgICAgICAgZWxzZSBnbC50ZXhJbWFnZTJEKGdsLlRFWFRVUkVfMkQsIDAsIGZvcm1hdHNwZWMuaW50ZXJuYWxmb3JtYXQsIGZvcm1hdHNwZWMuZm9ybWF0LCBmb3JtYXRzcGVjLnR5cGUsIGRhdGEpOwogICAgICAgICAgICBpZiAoZGF0YSAhPT0gbnVsbCkgdGhpcy5fU2V0VGV4dHVyZVBhcmFtZXRlcnMoZ2wpOwogICAgICAgICAgICBnbC5iaW5kVGV4dHVyZShnbC5URVhUVVJFXzJELCBudWxsKTsKICAgICAgICAgICAgdGhpcy5fcmVuZGVyZXIuX1Jlc2V0TGFzdFRleHR1cmUoKTsKICAgICAgICAgICAgdGhpcy5fcmVmQ291bnQgPSAxOwogICAgICAgICAgICBhbGxUZXh0dXJlcy5hZGQodGhpcykKICAgICAgICB9CiAgICAgICAgX0NyZWF0ZUR5bmFtaWMod2lkdGgsIGhlaWdodCwgb3B0cykgewogICAgICAgICAgICBvcHRzID0gT2JqZWN0LmFzc2lnbih7fSwgQ1JFQVRFRlJPTV9ERUZBVUxUX09QVElPTlMsCiAgICAgICAgICAgICAgICBvcHRzKTsKICAgICAgICAgICAgaWYgKHRoaXMuX3RleHR1cmUpIHRocm93IG5ldyBFcnJvcigiYWxyZWFkeSBjcmVhdGVkIHRleHR1cmUiKTsKICAgICAgICAgICAgdGhpcy5fd3JhcFggPSBvcHRzLndyYXBYOwogICAgICAgICAgICB0aGlzLl93cmFwWSA9IG9wdHMud3JhcFk7CiAgICAgICAgICAgIHRoaXMuX3NhbXBsaW5nID0gb3B0cy5zYW1wbGluZzsKICAgICAgICAgICAgdGhpcy5fcGl4ZWxGb3JtYXQgPSBvcHRzLnBpeGVsRm9ybWF0OwogICAgICAgICAgICB0aGlzLl9pc01pcE1hcHBlZCA9ICEhb3B0cy5taXBNYXAgJiYgdGhpcy5fcmVuZGVyZXIuQXJlTWlwbWFwc0VuYWJsZWQoKTsKICAgICAgICAgICAgdGhpcy5fbWlwTWFwUXVhbGl0eSA9IG9wdHMubWlwTWFwUXVhbGl0eTsKICAgICAgICAgICAgaWYgKCFWQUxJRF9XUkFQX01PREVTLmhhcyh0aGlzLl93cmFwWCkgfHwgIVZBTElEX1dSQVBfTU9ERVMuaGFzKHRoaXMuX3dyYXBZKSkgdGhyb3cgbmV3IEVycm9yKCJpbnZhbGlkIHdyYXAgbW9kZSIpOwogICAgICAgICAgICBpZiAoIVZBTElEX1NBTVBMSU5HUy5oYXModGhpcy5fc2FtcGxpbmcpKSB0aHJvdyBuZXcgRXJyb3IoImludmFsaWQgc2FtcGxpbmciKTsKICAgICAgICAgICAgaWYgKCFWQUxJRF9QSVhFTF9GT1JNQVRTLmhhcyh0aGlzLl9waXhlbEZvcm1hdCkpIHRocm93IG5ldyBFcnJvcigiaW52YWxpZCBwaXhlbCBmb3JtYXQiKTsKICAgICAgICAgICAgaWYgKCFWQUxJRF9NSVBNQVBfUVVBTElUSUVTLmhhcyh0aGlzLl9taXBNYXBRdWFsaXR5KSkgdGhyb3cgbmV3IEVycm9yKCJpbnZhbGlkIG1pcG1hcCBxdWFsaXR5Iik7CiAgICAgICAgICAgIHRoaXMuX2lzU3RhdGljID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX3dpZHRoID0gTWF0aC5mbG9vcih3aWR0aCk7CiAgICAgICAgICAgIHRoaXMuX2hlaWdodCA9IE1hdGguZmxvb3IoaGVpZ2h0KTsKICAgICAgICAgICAgY29uc3QgaXNQT1QgPSBDMy5pc1BPVCh0aGlzLl93aWR0aCkgJiYgQzMuaXNQT1QodGhpcy5faGVpZ2h0KTsKICAgICAgICAgICAgY29uc3QgbWF4VGV4dHVyZVNpemUgPSB0aGlzLl9yZW5kZXJlci5HZXRNYXhUZXh0dXJlU2l6ZSgpOwogICAgICAgICAgICBpZiAodGhpcy5fd2lkdGggPD0gMCB8fCB0aGlzLl9oZWlnaHQgPD0gMCkgdGhyb3cgbmV3IEVycm9yKCJpbnZhbGlkIHRleHR1cmUgc2l6ZSIpOwogICAgICAgICAgICBpZiAodGhpcy5fd2lkdGggPiBtYXhUZXh0dXJlU2l6ZSB8fCB0aGlzLl9oZWlnaHQgPiBtYXhUZXh0dXJlU2l6ZSkgdGhyb3cgbmV3IEVycm9yKCJ0ZXh0dXJlIGV4Y2VlZHMgbWF4aW11bSB0ZXh0dXJlIHNpemUiKTsKICAgICAgICAgICAgaWYgKCF0aGlzLl9yZW5kZXJlci5TdXBwb3J0c05QT1RUZXh0dXJlcygpICYmCiAgICAgICAgICAgICAgICB0aGlzLl9Jc1RpbGVkKCkgJiYgIWlzUE9UKSB0aHJvdyBuZXcgRXJyb3IoIm5vbi1wb3dlci1vZi10d28gdGlsZWQgdGV4dHVyZXMgbm90IHN1cHBvcnRlZCIpOwogICAgICAgICAgICBjb25zdCBnbCA9IHRoaXMuX3JlbmRlcmVyLkdldENvbnRleHQoKTsKICAgICAgICAgICAgY29uc3Qgd2ViZ2xWZXJzaW9uID0gdGhpcy5fcmVuZGVyZXIuR2V0V2ViR0xWZXJzaW9uTnVtYmVyKCk7CiAgICAgICAgICAgIHRoaXMuX3RleHR1cmUgPSBnbC5jcmVhdGVUZXh0dXJlKCk7CiAgICAgICAgICAgIGdsLmJpbmRUZXh0dXJlKGdsLlRFWFRVUkVfMkQsIHRoaXMuX3RleHR1cmUpOwogICAgICAgICAgICBnbC5waXhlbFN0b3JlaShnbFsiVU5QQUNLX1BSRU1VTFRJUExZX0FMUEhBX1dFQkdMIl0sIG9wdHMucHJlbXVsdGlwbHlBbHBoYSk7CiAgICAgICAgICAgIGdsLnBpeGVsU3RvcmVpKGdsWyJVTlBBQ0tfRkxJUF9ZX1dFQkdMIl0sIGZhbHNlKTsKICAgICAgICAgICAgY29uc3QgZm9ybWF0c3BlYyA9IEdldEZvcm1hdFNwZWNpZmllcnModGhpcy5fcGl4ZWxGb3JtYXQsIGdsKTsKICAgICAgICAgICAgY29uc3QgaW50ZXJuYWxmb3JtYXQgPSB3ZWJnbFZlcnNpb24gPj0gMiA/IGZvcm1hdHNwZWMuc2l6ZWRpbnRlcm5hbGZvcm1hdCA6CiAgICAgICAgICAgICAgICBmb3JtYXRzcGVjLmludGVybmFsZm9ybWF0OwogICAgICAgICAgICBnbC50ZXhJbWFnZTJEKGdsLlRFWFRVUkVfMkQsIDAsIGludGVybmFsZm9ybWF0LCB0aGlzLl93aWR0aCwgdGhpcy5faGVpZ2h0LCAwLCBmb3JtYXRzcGVjLmZvcm1hdCwgZm9ybWF0c3BlYy50eXBlLCBudWxsKTsKICAgICAgICAgICAgdGhpcy5fU2V0VGV4dHVyZVBhcmFtZXRlcnMoZ2wpOwogICAgICAgICAgICBnbC5iaW5kVGV4dHVyZShnbC5URVhUVVJFXzJELCBudWxsKTsKICAgICAgICAgICAgdGhpcy5fcmVuZGVyZXIuX1Jlc2V0TGFzdFRleHR1cmUoKTsKICAgICAgICAgICAgdGhpcy5fcmVmQ291bnQgPSAxOwogICAgICAgICAgICBhbGxUZXh0dXJlcy5hZGQodGhpcykKICAgICAgICB9CiAgICAgICAgX0dldE1pcE1hcEhpbnQoZ2wpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX21pcE1hcFF1YWxpdHkgPT09ICJkZWZhdWx0IikgcmV0dXJuIHRoaXMuX2lzU3RhdGljID8gZ2wuTklDRVNUIDogZ2wuRkFTVEVTVDsKICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5fbWlwTWFwUXVhbGl0eSA9PT0gImxvdyIpIHJldHVybiBnbC5GQVNURVNUOwogICAgICAgICAgICBlbHNlIGlmICh0aGlzLl9taXBNYXBRdWFsaXR5ID09PSAiaGlnaCIpIHJldHVybiBnbC5OSUNFU1Q7CiAgICAgICAgICAgIGVsc2UgdGhyb3cgbmV3IEVycm9yKCJpbnZhbGlkIG1pcG1hcCBxdWFsaXR5Iik7CiAgICAgICAgfQogICAgICAgIF9Jc1RpbGVkKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fd3JhcFggIT09ICJjbGFtcC10by1lZGdlIiB8fCB0aGlzLl93cmFwWSAhPT0gImNsYW1wLXRvLWVkZ2UiCiAgICAgICAgfQogICAgICAgIF9HZXRUZXh0dXJlV3JhcE1vZGUoZ2wsIHdyYXBNb2RlKSB7CiAgICAgICAgICAgIGlmICh3cmFwTW9kZSA9PT0gImNsYW1wLXRvLWVkZ2UiKSByZXR1cm4gZ2wuQ0xBTVBfVE9fRURHRTsKICAgICAgICAgICAgZWxzZSBpZiAod3JhcE1vZGUgPT09ICJyZXBlYXQiKSByZXR1cm4gZ2wuUkVQRUFUOwogICAgICAgICAgICBlbHNlIGlmICh3cmFwTW9kZSA9PT0gIm1pcnJvci1yZXBlYXQiKSByZXR1cm4gZ2wuTUlSUk9SRURfUkVQRUFUOwogICAgICAgICAgICBlbHNlIHRocm93IG5ldyBFcnJvcigiaW52YWxpZCB3cmFwIG1vZGUiKTsKICAgICAgICB9CiAgICAgICAgX1NldFRleHR1cmVQYXJhbWV0ZXJzKGdsKSB7CiAgICAgICAgICAgIGNvbnN0IGlzUE9UID0gQzMuaXNQT1QodGhpcy5fd2lkdGgpICYmIEMzLmlzUE9UKHRoaXMuX2hlaWdodCk7CiAgICAgICAgICAgIGdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV8yRCwgZ2wuVEVYVFVSRV9XUkFQX1MsIHRoaXMuX0dldFRleHR1cmVXcmFwTW9kZShnbCwgdGhpcy5fd3JhcFgpKTsKICAgICAgICAgICAgZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFXzJELAogICAgICAgICAgICAgICAgZ2wuVEVYVFVSRV9XUkFQX1QsIHRoaXMuX0dldFRleHR1cmVXcmFwTW9kZShnbCwgdGhpcy5fd3JhcFkpKTsKICAgICAgICAgICAgaWYgKHRoaXMuX3NhbXBsaW5nID09PSAibmVhcmVzdCIpIHsKICAgICAgICAgICAgICAgIGdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV8yRCwgZ2wuVEVYVFVSRV9NQUdfRklMVEVSLCBnbC5ORUFSRVNUKTsKICAgICAgICAgICAgICAgIGdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV8yRCwgZ2wuVEVYVFVSRV9NSU5fRklMVEVSLCBnbC5ORUFSRVNUKTsKICAgICAgICAgICAgICAgIHRoaXMuX2lzTWlwTWFwcGVkID0gZmFsc2UKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV8yRCwgZ2wuVEVYVFVSRV9NQUdfRklMVEVSLCBnbC5MSU5FQVIpOwogICAgICAgICAgICAgICAgaWYgKChpc1BPVCB8fCB0aGlzLl9yZW5kZXJlci5TdXBwb3J0c05QT1RUZXh0dXJlcygpKSAmJiB0aGlzLl9pc01pcE1hcHBlZCkgewogICAgICAgICAgICAgICAgICAgIGdsLmhpbnQoZ2wuR0VORVJBVEVfTUlQTUFQX0hJTlQsIHRoaXMuX0dldE1pcE1hcEhpbnQoZ2wpKTsKICAgICAgICAgICAgICAgICAgICBnbC5nZW5lcmF0ZU1pcG1hcChnbC5URVhUVVJFXzJEKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCB1c2VUcmlsaW5lYXIgPSB0aGlzLl9zYW1wbGluZyA9PT0KICAgICAgICAgICAgICAgICAgICAgICAgInRyaWxpbmVhciIgJiYgIXRoaXMuX3JlbmRlcmVyLkhhc01ham9yUGVyZm9ybWFuY2VDYXZlYXQoKTsKICAgICAgICAgICAgICAgICAgICBnbC50ZXhQYXJhbWV0ZXJpKGdsLlRFWFRVUkVfMkQsIGdsLlRFWFRVUkVfTUlOX0ZJTFRFUiwgdXNlVHJpbGluZWFyID8gZ2wuTElORUFSX01JUE1BUF9MSU5FQVIgOiBnbC5MSU5FQVJfTUlQTUFQX05FQVJFU1QpCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV8yRCwgZ2wuVEVYVFVSRV9NSU5fRklMVEVSLCBnbC5MSU5FQVIpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2lzTWlwTWFwcGVkID0gZmFsc2UKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBhbmlzb3Ryb3BpY0V4dCA9IHRoaXMuX3JlbmRlcmVyLl9HZXRBbmlzb3Ryb3BpY0V4dGVuc2lvbigpOwogICAgICAgICAgICBpZiAoYW5pc290cm9waWNFeHQgJiYgdGhpcy5fYW5pc290cm9weSA+IDAgJiYgdGhpcy5fc2FtcGxpbmcgIT09ICJuZWFyZXN0IikgZ2wudGV4UGFyYW1ldGVyZihnbC5URVhUVVJFXzJELCBhbmlzb3Ryb3BpY0V4dFsiVEVYVFVSRV9NQVhfQU5JU09UUk9QWV9FWFQiXSwgTWF0aC5taW4odGhpcy5fYW5pc290cm9weSwgdGhpcy5fcmVuZGVyZXIuX0dldE1heEFuaXNvdHJvcHkoKSkpCiAgICAgICAgfQogICAgICAgIF9VcGRhdGUoZGF0YSwKICAgICAgICAgICAgb3B0cykgewogICAgICAgICAgICBpZiAoKHR5cGVvZiBIVE1MSW1hZ2VFbGVtZW50ID09PSAidW5kZWZpbmVkIiB8fCAhKGRhdGEgaW5zdGFuY2VvZiBIVE1MSW1hZ2VFbGVtZW50KSkgJiYgKHR5cGVvZiBIVE1MVmlkZW9FbGVtZW50ID09PSAidW5kZWZpbmVkIiB8fCAhKGRhdGEgaW5zdGFuY2VvZiBIVE1MVmlkZW9FbGVtZW50KSkgJiYgKHR5cGVvZiBIVE1MQ2FudmFzRWxlbWVudCA9PT0gInVuZGVmaW5lZCIgfHwgIShkYXRhIGluc3RhbmNlb2YgSFRNTENhbnZhc0VsZW1lbnQpKSAmJiAodHlwZW9mIEltYWdlQml0bWFwID09PSAidW5kZWZpbmVkIiB8fCAhKGRhdGEgaW5zdGFuY2VvZiBJbWFnZUJpdG1hcCkpICYmICh0eXBlb2YgT2Zmc2NyZWVuQ2FudmFzID09PSAidW5kZWZpbmVkIiB8fCAhKGRhdGEgaW5zdGFuY2VvZiBPZmZzY3JlZW5DYW52YXMpKSAmJiAhKGRhdGEgaW5zdGFuY2VvZiBJbWFnZURhdGEpKSB0aHJvdyBuZXcgRXJyb3IoImludmFsaWQgdGV4dHVyZSBzb3VyY2UiKTsKICAgICAgICAgICAgaWYgKCF0aGlzLl90ZXh0dXJlIHx8IHRoaXMuX3JlZkNvdW50IDw9IDApIHRocm93IG5ldyBFcnJvcigidGV4dHVyZSBub3QgY3JlYXRlZCIpOwogICAgICAgICAgICBpZiAodGhpcy5faXNTdGF0aWMpIHRocm93IG5ldyBFcnJvcigiY2Fubm90IHVwZGF0ZSBzdGF0aWMgdGV4dHVyZSIpOwogICAgICAgICAgICBvcHRzID0gT2JqZWN0LmFzc2lnbih7fSwgVVBEQVRFX0RFRkFVTFRfT1BUSU9OUywgb3B0cyk7CiAgICAgICAgICAgIGNvbnN0IGRhdGFXaWR0aCA9IGRhdGEud2lkdGggfHwgZGF0YS52aWRlb1dpZHRoOwogICAgICAgICAgICBjb25zdCBkYXRhSGVpZ2h0ID0gZGF0YS5oZWlnaHQgfHwgZGF0YS52aWRlb0hlaWdodDsKICAgICAgICAgICAgY29uc3Qgd2ViZ2xWZXJzaW9uID0gdGhpcy5fcmVuZGVyZXIuR2V0V2ViR0xWZXJzaW9uTnVtYmVyKCk7CiAgICAgICAgICAgIGNvbnN0IGdsID0gdGhpcy5fcmVuZGVyZXIuR2V0Q29udGV4dCgpOwogICAgICAgICAgICBnbC5iaW5kVGV4dHVyZShnbC5URVhUVVJFXzJELCB0aGlzLl90ZXh0dXJlKTsKICAgICAgICAgICAgZ2wucGl4ZWxTdG9yZWkoZ2xbIlVOUEFDS19QUkVNVUxUSVBMWV9BTFBIQV9XRUJHTCJdLCBvcHRzLnByZW11bHRpcGx5QWxwaGEpOwogICAgICAgICAgICBnbC5waXhlbFN0b3JlaShnbFsiVU5QQUNLX0ZMSVBfWV9XRUJHTCJdLCAhIW9wdHMuZmxpcFkpOwogICAgICAgICAgICBjb25zdCBmb3JtYXRzcGVjID0gR2V0Rm9ybWF0U3BlY2lmaWVycyh0aGlzLl9waXhlbEZvcm1hdCwKICAgICAgICAgICAgICAgIGdsKTsKICAgICAgICAgICAgY29uc3QgaW50ZXJuYWxmb3JtYXQgPSB3ZWJnbFZlcnNpb24gPj0gMiA/IGZvcm1hdHNwZWMuc2l6ZWRpbnRlcm5hbGZvcm1hdCA6IGZvcm1hdHNwZWMuaW50ZXJuYWxmb3JtYXQ7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fd2lkdGggPT09IGRhdGFXaWR0aCAmJiB0aGlzLl9oZWlnaHQgPT09IGRhdGFIZWlnaHQpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBpc1BPVCA9IEMzLmlzUE9UKHRoaXMuX3dpZHRoKSAmJiBDMy5pc1BPVCh0aGlzLl9oZWlnaHQpOwogICAgICAgICAgICAgICAgICAgIGdsLnRleFN1YkltYWdlMkQoZ2wuVEVYVFVSRV8yRCwgMCwgMCwgMCwgZm9ybWF0c3BlYy5mb3JtYXQsIGZvcm1hdHNwZWMudHlwZSwgZGF0YSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKChpc1BPVCB8fCB0aGlzLl9yZW5kZXJlci5TdXBwb3J0c05QT1RUZXh0dXJlcygpKSAmJiB0aGlzLl9pc01pcE1hcHBlZCkgewogICAgICAgICAgICAgICAgICAgICAgICBnbC5oaW50KGdsLkdFTkVSQVRFX01JUE1BUF9ISU5ULCB0aGlzLl9HZXRNaXBNYXBIaW50KGdsKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGdsLmdlbmVyYXRlTWlwbWFwKGdsLlRFWFRVUkVfMkQpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl93aWR0aCA9IGRhdGFXaWR0aDsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9oZWlnaHQgPSBkYXRhSGVpZ2h0OwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGlzUE9UID0gQzMuaXNQT1QodGhpcy5fd2lkdGgpICYmIEMzLmlzUE9UKHRoaXMuX2hlaWdodCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9yZW5kZXJlci5TdXBwb3J0c05QT1RUZXh0dXJlcygpICYmIHRoaXMuX0lzVGlsZWQoKSAmJiAhaXNQT1QpIHRocm93IG5ldyBFcnJvcigibm9uLXBvd2VyLW9mLXR3byB0aWxlZCB0ZXh0dXJlcyBub3Qgc3VwcG9ydGVkIik7CiAgICAgICAgICAgICAgICAgICAgZ2wudGV4SW1hZ2UyRChnbC5URVhUVVJFXzJELCAwLCBpbnRlcm5hbGZvcm1hdCwgZm9ybWF0c3BlYy5mb3JtYXQsIGZvcm1hdHNwZWMudHlwZSwgZGF0YSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKChpc1BPVCB8fCB0aGlzLl9yZW5kZXJlci5TdXBwb3J0c05QT1RUZXh0dXJlcygpKSAmJiB0aGlzLl9pc01pcE1hcHBlZCkgewogICAgICAgICAgICAgICAgICAgICAgICBnbC5oaW50KGdsLkdFTkVSQVRFX01JUE1BUF9ISU5ULCB0aGlzLl9HZXRNaXBNYXBIaW50KGdsKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGdsLmdlbmVyYXRlTWlwbWFwKGdsLlRFWFRVUkVfMkQpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciB1cGRhdGluZyBXZWJHTCB0ZXh0dXJlOiAiLCBlKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGdsLmJpbmRUZXh0dXJlKGdsLlRFWFRVUkVfMkQsCiAgICAgICAgICAgICAgICBudWxsKTsKICAgICAgICAgICAgdGhpcy5fcmVuZGVyZXIuX1Jlc2V0TGFzdFRleHR1cmUoKQogICAgICAgIH0KICAgICAgICBfRGVsZXRlKCkgewogICAgICAgICAgICBpZiAodGhpcy5fcmVmQ291bnQgPiAwKSB0aHJvdyBuZXcgRXJyb3IoInRleHR1cmUgc3RpbGwgaGFzIHJlZmVyZW5jZXMiKTsKICAgICAgICAgICAgaWYgKCF0aGlzLl90ZXh0dXJlKSB0aHJvdyBuZXcgRXJyb3IoImFscmVhZHkgZGVsZXRlZCB0ZXh0dXJlIik7CiAgICAgICAgICAgIGFsbFRleHR1cmVzLmRlbGV0ZSh0aGlzKTsKICAgICAgICAgICAgY29uc3QgZ2wgPSB0aGlzLl9yZW5kZXJlci5HZXRDb250ZXh0KCk7CiAgICAgICAgICAgIGdsLmRlbGV0ZVRleHR1cmUodGhpcy5fdGV4dHVyZSk7CiAgICAgICAgICAgIHRoaXMuX3RleHR1cmUgPSBudWxsCiAgICAgICAgfQogICAgICAgIElzVmFsaWQoKSB7CiAgICAgICAgICAgIHJldHVybiAhIXRoaXMuX3RleHR1cmUKICAgICAgICB9CiAgICAgICAgX0dldFRleHR1cmUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl90ZXh0dXJlCiAgICAgICAgfQogICAgICAgIEdldFJlbmRlcmVyKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fcmVuZGVyZXIKICAgICAgICB9CiAgICAgICAgQWRkUmVmZXJlbmNlKCkgewogICAgICAgICAgICB0aGlzLl9yZWZDb3VudCsrCiAgICAgICAgfQogICAgICAgIFN1YnRyYWN0UmVmZXJlbmNlKCkgewogICAgICAgICAgICBpZiAodGhpcy5fcmVmQ291bnQgPD0gMCkgdGhyb3cgbmV3IEVycm9yKCJubyBtb3JlIHJlZmVyZW5jZXMiKTsKICAgICAgICAgICAgdGhpcy5fcmVmQ291bnQtLQogICAgICAgIH0KICAgICAgICBHZXRSZWZlcmVuY2VDb3VudCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3JlZkNvdW50CiAgICAgICAgfQogICAgICAgIEdldFdpZHRoKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fd2lkdGgKICAgICAgICB9CiAgICAgICAgR2V0SGVpZ2h0KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faGVpZ2h0CiAgICAgICAgfQogICAgICAgIElzU3RhdGljKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faXNTdGF0aWMKICAgICAgICB9CiAgICAgICAgR2V0RXN0aW1hdGVkTWVtb3J5VXNhZ2UoKSB7CiAgICAgICAgICAgIGxldCBzaXplID0gdGhpcy5fd2lkdGggKiB0aGlzLl9oZWlnaHQ7CiAgICAgICAgICAgIHN3aXRjaCAodGhpcy5fcGl4ZWxGb3JtYXQpIHsKICAgICAgICAgICAgICAgIGNhc2UgInJnYmE4IjoKICAgICAgICAgICAgICAgICAgICBzaXplICo9IDQ7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICJyZ2I4IjoKICAgICAgICAgICAgICAgICAgICBzaXplICo9IDM7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICJyZ2JhNCI6CiAgICAgICAgICAgICAgICBjYXNlICJyZ2I1X2ExIjoKICAgICAgICAgICAgICAgIGNhc2UgInJnYjU2NSI6CiAgICAgICAgICAgICAgICAgICAgc2l6ZSAqPSAyOwogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHRoaXMuX2lzTWlwTWFwcGVkKSBzaXplICs9IE1hdGguZmxvb3Ioc2l6ZSAvIDMpOwogICAgICAgICAgICByZXR1cm4gc2l6ZQogICAgICAgIH0KICAgICAgICBzdGF0aWMgT25Db250ZXh0TG9zdCgpIHsKICAgICAgICAgICAgYWxsVGV4dHVyZXMuY2xlYXIoKQogICAgICAgIH0KICAgICAgICBzdGF0aWMgYWxsVGV4dHVyZXMoKSB7CiAgICAgICAgICAgIHJldHVybiBhbGxUZXh0dXJlcy52YWx1ZXMoKQogICAgICAgIH0KICAgIH07Cgp9CgovLyAuLi9saWIvZ2Z4L3dlYmdsL3JlbmRlclRhcmdldC5qcwp7CiAgICAndXNlIHN0cmljdCc7CiAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICBjb25zdCBhc3NlcnQgPSBzZWxmLmFzc2VydDsKICAgIGNvbnN0IGdsTWF0cml4ID0gc2VsZi5nbE1hdHJpeDsKICAgIGNvbnN0IHZlYzMgPSBnbE1hdHJpeC52ZWMzOwogICAgY29uc3QgbWF0NCA9IGdsTWF0cml4Lm1hdDQ7CiAgICBjb25zdCBWQUxJRF9TQU1QTElOR1MgPSBuZXcgU2V0KFsibmVhcmVzdCIsICJiaWxpbmVhciIsICJ0cmlsaW5lYXIiXSk7CiAgICBjb25zdCBERUZBVUxUX1JFTkRFUlRBUkdFVF9PUFRJT05TID0gewogICAgICAgIHNhbXBsaW5nOiAidHJpbGluZWFyIiwKICAgICAgICBhbHBoYTogdHJ1ZSwKICAgICAgICBkZXB0aDogZmFsc2UsCiAgICAgICAgaXNTYW1wbGVkOiB0cnVlLAogICAgICAgIGlzRGVmYXVsdFNpemU6IHRydWUsCiAgICAgICAgbXVsdGlzYW1wbGluZzogMAogICAgfTsKICAgIGNvbnN0IGFsbFJlbmRlclRhcmdldHMgPSBuZXcgU2V0OwogICAgQzMuR2Z4LldlYkdMUmVuZGVyVGFyZ2V0ID0gY2xhc3MgV2ViR0xSZW5kZXJUYXJnZXQgewogICAgICAgIGNvbnN0cnVjdG9yKHJlbmRlcmVyKSB7CiAgICAgICAgICAgIHRoaXMuX3JlbmRlcmVyID0gcmVuZGVyZXI7CiAgICAgICAgICAgIHRoaXMuX2ZyYW1lQnVmZmVyID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fZnJhbWVCdWZmZXJOb0RlcHRoID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fdGV4dHVyZSA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3JlbmRlckJ1ZmZlciA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3dpZHRoID0gMDsKICAgICAgICAgICAgdGhpcy5faGVpZ2h0ID0gMDsKICAgICAgICAgICAgdGhpcy5faXNEZWZhdWx0U2l6ZSA9IHRydWU7CiAgICAgICAgICAgIHRoaXMuX3NhbXBsaW5nID0gInRyaWxpbmVhciI7CiAgICAgICAgICAgIHRoaXMuX2FscGhhID0gdHJ1ZTsKICAgICAgICAgICAgdGhpcy5fZGVwdGggPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5faXNTYW1wbGVkID0gdHJ1ZTsKICAgICAgICAgICAgdGhpcy5fbXVsdGlzYW1wbGluZyA9IDA7CiAgICAgICAgICAgIHRoaXMuX3Byb2plY3Rpb25NYXRyaXggPSBtYXQ0LmNyZWF0ZSgpOwogICAgICAgICAgICB0aGlzLl9sYXN0Rm92ID0gMDsKICAgICAgICAgICAgdGhpcy5fbGFzdE5lYXJaID0gMDsKICAgICAgICAgICAgdGhpcy5fbGFzdEZhclogPSAwCiAgICAgICAgfQogICAgICAgIF9DcmVhdGUod2lkdGgsIGhlaWdodCwgb3B0cykgewogICAgICAgICAgICBvcHRzID0gT2JqZWN0LmFzc2lnbih7fSwgREVGQVVMVF9SRU5ERVJUQVJHRVRfT1BUSU9OUywKICAgICAgICAgICAgICAgIG9wdHMpOwogICAgICAgICAgICBjb25zdCB3ZWJHTFZlcnNpb24gPSB0aGlzLl9yZW5kZXJlci5HZXRXZWJHTFZlcnNpb25OdW1iZXIoKTsKICAgICAgICAgICAgaWYgKHRoaXMuX3RleHR1cmUgfHwgdGhpcy5fcmVuZGVyQnVmZmVyKSB0aHJvdyBuZXcgRXJyb3IoImFscmVhZHkgY3JlYXRlZCByZW5kZXIgdGFyZ2V0Iik7CiAgICAgICAgICAgIHRoaXMuX3NhbXBsaW5nID0gb3B0cy5zYW1wbGluZzsKICAgICAgICAgICAgdGhpcy5fYWxwaGEgPSAhIW9wdHMuYWxwaGE7CiAgICAgICAgICAgIHRoaXMuX2RlcHRoID0gISFvcHRzLmRlcHRoOwogICAgICAgICAgICB0aGlzLl9pc1NhbXBsZWQgPSAhIW9wdHMuaXNTYW1wbGVkOwogICAgICAgICAgICB0aGlzLl9pc0RlZmF1bHRTaXplID0gISFvcHRzLmlzRGVmYXVsdFNpemU7CiAgICAgICAgICAgIHRoaXMuX211bHRpc2FtcGxpbmcgPSBvcHRzLm11bHRpc2FtcGxpbmc7CiAgICAgICAgICAgIGlmICghVkFMSURfU0FNUExJTkdTLmhhcyh0aGlzLl9zYW1wbGluZykpIHRocm93IG5ldyBFcnJvcigiaW52YWxpZCBzYW1wbGluZyIpOwogICAgICAgICAgICBpZiAodGhpcy5fbXVsdGlzYW1wbGluZyA+IDAgJiYgKHdlYkdMVmVyc2lvbiA8IDIgfHwgdGhpcy5faXNTYW1wbGVkKSkgdGhyb3cgbmV3IEVycm9yKCJpbnZhbGlkIHVzZSBvZiBtdWx0aXNhbXBsaW5nIik7CiAgICAgICAgICAgIGlmICh3ZWJHTFZlcnNpb24gPCAyKSB0aGlzLl9pc1NhbXBsZWQgPSB0cnVlOwogICAgICAgICAgICB0aGlzLl93aWR0aCA9IHdpZHRoOwogICAgICAgICAgICB0aGlzLl9oZWlnaHQgPSBoZWlnaHQ7CiAgICAgICAgICAgIGlmICh0aGlzLl93aWR0aCA8PSAwIHx8IHRoaXMuX2hlaWdodCA8PSAwKSB0aHJvdyBuZXcgRXJyb3IoImludmFsaWQgcmVuZGVyIHRhcmdldCBzaXplIik7CiAgICAgICAgICAgIHRoaXMuX0NhbGN1bGF0ZVByb2plY3Rpb24oKTsKICAgICAgICAgICAgY29uc3QgZ2wgPSB0aGlzLl9yZW5kZXJlci5HZXRDb250ZXh0KCk7CiAgICAgICAgICAgIHRoaXMuX2ZyYW1lQnVmZmVyID0gZ2wuY3JlYXRlRnJhbWVidWZmZXIoKTsKICAgICAgICAgICAgaWYgKHRoaXMuX2RlcHRoKSB0aGlzLl9mcmFtZUJ1ZmZlck5vRGVwdGggPSBnbC5jcmVhdGVGcmFtZWJ1ZmZlcigpOwogICAgICAgICAgICBpZiAodGhpcy5faXNTYW1wbGVkKSB7CiAgICAgICAgICAgICAgICB0aGlzLl90ZXh0dXJlID0gdGhpcy5fcmVuZGVyZXIuQ3JlYXRlRHluYW1pY1RleHR1cmUodGhpcy5fd2lkdGgsIHRoaXMuX2hlaWdodCwgewogICAgICAgICAgICAgICAgICAgIHNhbXBsaW5nOiB0aGlzLl9zYW1wbGluZywKICAgICAgICAgICAgICAgICAgICBwaXhlbEZvcm1hdDogdGhpcy5fYWxwaGEgPyAicmdiYTgiIDogInJnYjgiLAogICAgICAgICAgICAgICAgICAgIG1pcE1hcDogZmFsc2UKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgY29uc3QgdGV4ID0gdGhpcy5fdGV4dHVyZS5fR2V0VGV4dHVyZSgpOwogICAgICAgICAgICAgICAgZ2wuYmluZEZyYW1lYnVmZmVyKGdsLkZSQU1FQlVGRkVSLCB0aGlzLl9mcmFtZUJ1ZmZlcik7CiAgICAgICAgICAgICAgICBnbC5mcmFtZWJ1ZmZlclRleHR1cmUyRChnbC5GUkFNRUJVRkZFUiwgZ2wuQ09MT1JfQVRUQUNITUVOVDAsIGdsLlRFWFRVUkVfMkQsIHRleCwgMCk7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fZGVwdGgpIHsKICAgICAgICAgICAgICAgICAgICBnbC5iaW5kRnJhbWVidWZmZXIoZ2wuRlJBTUVCVUZGRVIsIHRoaXMuX2ZyYW1lQnVmZmVyTm9EZXB0aCk7CiAgICAgICAgICAgICAgICAgICAgZ2wuZnJhbWVidWZmZXJUZXh0dXJlMkQoZ2wuRlJBTUVCVUZGRVIsIGdsLkNPTE9SX0FUVEFDSE1FTlQwLCBnbC5URVhUVVJFXzJELCB0ZXgsIDApCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLl9yZW5kZXJCdWZmZXIgPSBnbC5jcmVhdGVSZW5kZXJidWZmZXIoKTsKICAgICAgICAgICAgICAgIGdsLmJpbmRSZW5kZXJidWZmZXIoZ2wuUkVOREVSQlVGRkVSLCB0aGlzLl9yZW5kZXJCdWZmZXIpOwogICAgICAgICAgICAgICAgY29uc3QgaW50ZXJuYWxGb3JtYXQgPSB0aGlzLl9hbHBoYSA/IGdsLlJHQkE4IDogZ2wuUkdCODsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9tdWx0aXNhbXBsaW5nID4KICAgICAgICAgICAgICAgICAgICAwKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZm9ybWF0U2FtcGxlcyA9IGdsLmdldEludGVybmFsZm9ybWF0UGFyYW1ldGVyKGdsLlJFTkRFUkJVRkZFUiwgaW50ZXJuYWxGb3JtYXQsIGdsLlNBTVBMRVMpOwogICAgICAgICAgICAgICAgICAgIGlmIChmb3JtYXRTYW1wbGVzICYmIGZvcm1hdFNhbXBsZXNbMF0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbWF4U2FtcGxlcyA9IGZvcm1hdFNhbXBsZXNbMF07CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9tdWx0aXNhbXBsaW5nID4gbWF4U2FtcGxlcykgdGhpcy5fbXVsdGlzYW1wbGluZyA9IG1heFNhbXBsZXMKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgdGhpcy5fbXVsdGlzYW1wbGluZyA9IDAKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh0aGlzLl9tdWx0aXNhbXBsaW5nID09PSAwKSBnbC5yZW5kZXJidWZmZXJTdG9yYWdlKGdsLlJFTkRFUkJVRkZFUiwgaW50ZXJuYWxGb3JtYXQsIHRoaXMuX3dpZHRoLCB0aGlzLl9oZWlnaHQpOwogICAgICAgICAgICAgICAgZWxzZSBnbC5yZW5kZXJidWZmZXJTdG9yYWdlTXVsdGlzYW1wbGUoZ2wuUkVOREVSQlVGRkVSLCB0aGlzLl9tdWx0aXNhbXBsaW5nLCBpbnRlcm5hbEZvcm1hdCwgdGhpcy5fd2lkdGgsIHRoaXMuX2hlaWdodCk7CiAgICAgICAgICAgICAgICBnbC5iaW5kRnJhbWVidWZmZXIoZ2wuRlJBTUVCVUZGRVIsCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZnJhbWVCdWZmZXIpOwogICAgICAgICAgICAgICAgZ2wuZnJhbWVidWZmZXJSZW5kZXJidWZmZXIoZ2wuRlJBTUVCVUZGRVIsIGdsLkNPTE9SX0FUVEFDSE1FTlQwLCBnbC5SRU5ERVJCVUZGRVIsIHRoaXMuX3JlbmRlckJ1ZmZlcik7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fZGVwdGgpIHsKICAgICAgICAgICAgICAgICAgICBnbC5iaW5kRnJhbWVidWZmZXIoZ2wuRlJBTUVCVUZGRVIsIHRoaXMuX2ZyYW1lQnVmZmVyTm9EZXB0aCk7CiAgICAgICAgICAgICAgICAgICAgZ2wuZnJhbWVidWZmZXJSZW5kZXJidWZmZXIoZ2wuRlJBTUVCVUZGRVIsIGdsLkNPTE9SX0FUVEFDSE1FTlQwLCBnbC5SRU5ERVJCVUZGRVIsIHRoaXMuX3JlbmRlckJ1ZmZlcikKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGdsLmJpbmRSZW5kZXJidWZmZXIoZ2wuUkVOREVSQlVGRkVSLCBudWxsKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IHJlbmRlcmVyRGVwdGhCdWZmZXIgPSB0aGlzLl9yZW5kZXJlci5fR2V0RGVwdGhCdWZmZXIoKTsKICAgICAgICAgICAgaWYgKHRoaXMuX2RlcHRoICYmIHJlbmRlcmVyRGVwdGhCdWZmZXIpIHsKICAgICAgICAgICAgICAgIGdsLmJpbmRGcmFtZWJ1ZmZlcihnbC5GUkFNRUJVRkZFUiwgdGhpcy5fZnJhbWVCdWZmZXIpOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuX3JlbmRlcmVyLl9DYW5TYW1wbGVEZXB0aCgpKSBnbC5mcmFtZWJ1ZmZlclRleHR1cmUyRChnbC5GUkFNRUJVRkZFUiwKICAgICAgICAgICAgICAgICAgICBnbC5ERVBUSF9TVEVOQ0lMX0FUVEFDSE1FTlQsIGdsLlRFWFRVUkVfMkQsIHJlbmRlcmVyRGVwdGhCdWZmZXIsIDApOwogICAgICAgICAgICAgICAgZWxzZSBnbC5mcmFtZWJ1ZmZlclJlbmRlcmJ1ZmZlcihnbC5GUkFNRUJVRkZFUiwgZ2wuREVQVEhfU1RFTkNJTF9BVFRBQ0hNRU5ULCBnbC5SRU5ERVJCVUZGRVIsIHJlbmRlcmVyRGVwdGhCdWZmZXIpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZ2wuYmluZEZyYW1lYnVmZmVyKGdsLkZSQU1FQlVGRkVSLCBudWxsKTsKICAgICAgICAgICAgYWxsUmVuZGVyVGFyZ2V0cy5hZGQodGhpcykKICAgICAgICB9CiAgICAgICAgX1Jlc2l6ZSh3aWR0aCwgaGVpZ2h0KSB7CiAgICAgICAgICAgIGlmICh0aGlzLl93aWR0aCA9PT0gd2lkdGggJiYgdGhpcy5faGVpZ2h0ID09PSBoZWlnaHQpIHJldHVybjsKICAgICAgICAgICAgdGhpcy5fd2lkdGggPSB3aWR0aDsKICAgICAgICAgICAgdGhpcy5faGVpZ2h0ID0gaGVpZ2h0OwogICAgICAgICAgICB0aGlzLl9DYWxjdWxhdGVQcm9qZWN0aW9uKCk7CiAgICAgICAgICAgIGNvbnN0IGdsID0gdGhpcy5fcmVuZGVyZXIuR2V0Q29udGV4dCgpOwogICAgICAgICAgICBnbC5iaW5kRnJhbWVidWZmZXIoZ2wuRlJBTUVCVUZGRVIsIHRoaXMuX2ZyYW1lQnVmZmVyKTsKICAgICAgICAgICAgaWYgKHRoaXMuX3RleHR1cmUpIHRoaXMuX3RleHR1cmUuX1VwZGF0ZShuZXcgSW1hZ2VEYXRhKHRoaXMuX3dpZHRoLAogICAgICAgICAgICAgICAgdGhpcy5faGVpZ2h0KSk7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgZ2wuYmluZFJlbmRlcmJ1ZmZlcihnbC5SRU5ERVJCVUZGRVIsIHRoaXMuX3JlbmRlckJ1ZmZlcik7CiAgICAgICAgICAgICAgICBnbC5yZW5kZXJidWZmZXJTdG9yYWdlKGdsLlJFTkRFUkJVRkZFUiwgdGhpcy5fYWxwaGEgPyBnbC5SR0JBOCA6IGdsLlJHQjgsIHRoaXMuX3dpZHRoLCB0aGlzLl9oZWlnaHQpOwogICAgICAgICAgICAgICAgZ2wuYmluZFJlbmRlcmJ1ZmZlcihnbC5SRU5ERVJCVUZGRVIsIG51bGwpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgcmVuZGVyZXJEZXB0aEJ1ZmZlciA9IHRoaXMuX3JlbmRlcmVyLl9HZXREZXB0aEJ1ZmZlcigpOwogICAgICAgICAgICBpZiAodGhpcy5fZGVwdGggJiYgcmVuZGVyZXJEZXB0aEJ1ZmZlcikKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9yZW5kZXJlci5fQ2FuU2FtcGxlRGVwdGgoKSkgZ2wuZnJhbWVidWZmZXJUZXh0dXJlMkQoZ2wuRlJBTUVCVUZGRVIsIGdsLkRFUFRIX1NURU5DSUxfQVRUQUNITUVOVCwgZ2wuVEVYVFVSRV8yRCwgcmVuZGVyZXJEZXB0aEJ1ZmZlciwgMCk7CiAgICAgICAgICAgICAgICBlbHNlIGdsLmZyYW1lYnVmZmVyUmVuZGVyYnVmZmVyKGdsLkZSQU1FQlVGRkVSLCBnbC5ERVBUSF9TVEVOQ0lMX0FUVEFDSE1FTlQsCiAgICAgICAgICAgICAgICAgICAgZ2wuUkVOREVSQlVGRkVSLCByZW5kZXJlckRlcHRoQnVmZmVyKTsKICAgICAgICAgICAgZ2wuYmluZEZyYW1lYnVmZmVyKGdsLkZSQU1FQlVGRkVSLCBudWxsKQogICAgICAgIH0KICAgICAgICBfRGVsZXRlKCkgewogICAgICAgICAgICBpZiAoIXRoaXMuX3RleHR1cmUgJiYgIXRoaXMuX3JlbmRlckJ1ZmZlcikgdGhyb3cgbmV3IEVycm9yKCJhbHJlYWR5IGRlbGV0ZWQgcmVuZGVyIHRhcmdldCIpOwogICAgICAgICAgICBhbGxSZW5kZXJUYXJnZXRzLmRlbGV0ZSh0aGlzKTsKICAgICAgICAgICAgY29uc3QgZ2wgPSB0aGlzLl9yZW5kZXJlci5HZXRDb250ZXh0KCk7CiAgICAgICAgICAgIGlmICh0aGlzLl90ZXh0dXJlKSB7CiAgICAgICAgICAgICAgICBnbC5iaW5kRnJhbWVidWZmZXIoZ2wuRlJBTUVCVUZGRVIsIHRoaXMuX2ZyYW1lQnVmZmVyKTsKICAgICAgICAgICAgICAgIGdsLmZyYW1lYnVmZmVyVGV4dHVyZTJEKGdsLkZSQU1FQlVGRkVSLCBnbC5DT0xPUl9BVFRBQ0hNRU5UMCwgZ2wuVEVYVFVSRV8yRCwgbnVsbCwgMCk7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fZGVwdGgpIHsKICAgICAgICAgICAgICAgICAgICBnbC5iaW5kRnJhbWVidWZmZXIoZ2wuRlJBTUVCVUZGRVIsIHRoaXMuX2ZyYW1lQnVmZmVyTm9EZXB0aCk7CiAgICAgICAgICAgICAgICAgICAgZ2wuZnJhbWVidWZmZXJUZXh0dXJlMkQoZ2wuRlJBTUVCVUZGRVIsCiAgICAgICAgICAgICAgICAgICAgICAgIGdsLkNPTE9SX0FUVEFDSE1FTlQwLCBnbC5URVhUVVJFXzJELCBudWxsLCAwKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5fcmVuZGVyZXIuRGVsZXRlVGV4dHVyZSh0aGlzLl90ZXh0dXJlKTsKICAgICAgICAgICAgICAgIHRoaXMuX3RleHR1cmUgPSBudWxsCiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5fcmVuZGVyQnVmZmVyKSB7CiAgICAgICAgICAgICAgICBnbC5iaW5kRnJhbWVidWZmZXIoZ2wuRlJBTUVCVUZGRVIsIHRoaXMuX2ZyYW1lQnVmZmVyKTsKICAgICAgICAgICAgICAgIGdsLmZyYW1lYnVmZmVyUmVuZGVyYnVmZmVyKGdsLkZSQU1FQlVGRkVSLCBnbC5DT0xPUl9BVFRBQ0hNRU5UMCwgZ2wuUkVOREVSQlVGRkVSLCBudWxsKTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9kZXB0aCkgewogICAgICAgICAgICAgICAgICAgIGdsLmJpbmRGcmFtZWJ1ZmZlcihnbC5GUkFNRUJVRkZFUiwgdGhpcy5fZnJhbWVCdWZmZXJOb0RlcHRoKTsKICAgICAgICAgICAgICAgICAgICBnbC5mcmFtZWJ1ZmZlclJlbmRlcmJ1ZmZlcihnbC5GUkFNRUJVRkZFUiwgZ2wuQ09MT1JfQVRUQUNITUVOVDAsIGdsLlJFTkRFUkJVRkZFUiwgbnVsbCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGdsLmRlbGV0ZVJlbmRlcmJ1ZmZlcih0aGlzLl9yZW5kZXJCdWZmZXIpOwogICAgICAgICAgICAgICAgdGhpcy5fcmVuZGVyQnVmZmVyID0gbnVsbAogICAgICAgICAgICB9CiAgICAgICAgICAgIGdsLmJpbmRGcmFtZWJ1ZmZlcihnbC5GUkFNRUJVRkZFUiwKICAgICAgICAgICAgICAgIG51bGwpOwogICAgICAgICAgICBpZiAodGhpcy5fcmVuZGVyZXIuR2V0V2ViR0xWZXJzaW9uTnVtYmVyKCkgPj0gMikgewogICAgICAgICAgICAgICAgZ2wuYmluZEZyYW1lYnVmZmVyKGdsLlJFQURfRlJBTUVCVUZGRVIsIG51bGwpOwogICAgICAgICAgICAgICAgZ2wuYmluZEZyYW1lYnVmZmVyKGdsLkRSQVdfRlJBTUVCVUZGRVIsIG51bGwpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZ2wuZGVsZXRlRnJhbWVidWZmZXIodGhpcy5fZnJhbWVCdWZmZXIpOwogICAgICAgICAgICBpZiAodGhpcy5fZGVwdGgpIGdsLmRlbGV0ZUZyYW1lYnVmZmVyKHRoaXMuX2ZyYW1lQnVmZmVyTm9EZXB0aCk7CiAgICAgICAgICAgIGNvbnN0IGJhdGNoU3RhdGUgPSB0aGlzLl9yZW5kZXJlci5HZXRCYXRjaFN0YXRlKCk7CiAgICAgICAgICAgIGJhdGNoU3RhdGUuY3VycmVudEZyYW1lYnVmZmVyID0gbnVsbDsKICAgICAgICAgICAgYmF0Y2hTdGF0ZS5jdXJyZW50RnJhbWVidWZmZXJOb0RlcHRoID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fZnJhbWVCdWZmZXIgPSBudWxsCiAgICAgICAgfQogICAgICAgIF9DYWxjdWxhdGVQcm9qZWN0aW9uKCkgewogICAgICAgICAgICB0aGlzLl9yZW5kZXJlci5DYWxjdWxhdGVQZXJzcGVjdGl2ZU1hdHJpeCh0aGlzLl9wcm9qZWN0aW9uTWF0cml4LCB0aGlzLl93aWR0aCAvIHRoaXMuX2hlaWdodCk7CiAgICAgICAgICAgIHRoaXMuX2xhc3RGb3YgPSB0aGlzLl9yZW5kZXJlci5HZXRGb3ZZKCk7CiAgICAgICAgICAgIHRoaXMuX2xhc3ROZWFyWiA9IHRoaXMuX3JlbmRlcmVyLkdldE5lYXJaKCk7CiAgICAgICAgICAgIHRoaXMuX2xhc3RGYXJaID0gdGhpcy5fcmVuZGVyZXIuR2V0RmFyWigpCiAgICAgICAgfQogICAgICAgIF9HZXRGcmFtZWJ1ZmZlcigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2ZyYW1lQnVmZmVyCiAgICAgICAgfQogICAgICAgIF9HZXRGcmFtZWJ1ZmZlck5vRGVwdGgoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9mcmFtZUJ1ZmZlck5vRGVwdGgKICAgICAgICB9CiAgICAgICAgR2V0UmVuZGVyZXIoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9yZW5kZXJlcgogICAgICAgIH0KICAgICAgICBHZXRUZXh0dXJlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fdGV4dHVyZQogICAgICAgIH0KICAgICAgICBHZXRQcm9qZWN0aW9uTWF0cml4KCkgewogICAgICAgICAgICBpZiAodGhpcy5fcmVuZGVyZXIuR2V0Rm92WSgpICE9PSB0aGlzLl9sYXN0Rm92IHx8IHRoaXMuX3JlbmRlcmVyLkdldE5lYXJaKCkgIT09IHRoaXMuX2xhc3ROZWFyWiB8fCB0aGlzLl9yZW5kZXJlci5HZXRGYXJaKCkgIT09IHRoaXMuX2xhc3RGYXJaKSB0aGlzLl9DYWxjdWxhdGVQcm9qZWN0aW9uKCk7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9wcm9qZWN0aW9uTWF0cml4CiAgICAgICAgfQogICAgICAgIElzTGluZWFyU2FtcGxpbmcoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zYW1wbGluZyAhPT0KICAgICAgICAgICAgICAgICJuZWFyZXN0IgogICAgICAgIH0KICAgICAgICBIYXNBbHBoYSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2FscGhhCiAgICAgICAgfQogICAgICAgIElzU2FtcGxlZCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2lzU2FtcGxlZAogICAgICAgIH0KICAgICAgICBIYXNEZXB0aEJ1ZmZlcigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2RlcHRoCiAgICAgICAgfQogICAgICAgIEdldFdpZHRoKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fd2lkdGgKICAgICAgICB9CiAgICAgICAgR2V0SGVpZ2h0KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faGVpZ2h0CiAgICAgICAgfQogICAgICAgIElzRGVmYXVsdFNpemUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pc0RlZmF1bHRTaXplCiAgICAgICAgfQogICAgICAgIEdldE11bHRpc2FtcGxpbmcoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9tdWx0aXNhbXBsaW5nCiAgICAgICAgfQogICAgICAgIEdldE9wdGlvbnMoKSB7CiAgICAgICAgICAgIGNvbnN0IHJldCA9IHsKICAgICAgICAgICAgICAgIHNhbXBsaW5nOiB0aGlzLl9zYW1wbGluZywKICAgICAgICAgICAgICAgIGFscGhhOiB0aGlzLl9hbHBoYSwKICAgICAgICAgICAgICAgIGlzU2FtcGxlZDogdGhpcy5faXNTYW1wbGVkCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGlmICghdGhpcy5faXNEZWZhdWx0U2l6ZSkgewogICAgICAgICAgICAgICAgcmV0LndpZHRoID0gdGhpcy5fd2lkdGg7CiAgICAgICAgICAgICAgICByZXQuaGVpZ2h0ID0gdGhpcy5faGVpZ2h0CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHJldAogICAgICAgIH0KICAgICAgICBJc0NvbXBhdGlibGVXaXRoT3B0aW9ucyhvcHRzKSB7CiAgICAgICAgICAgIG9wdHMgPSBPYmplY3QuYXNzaWduKHt9LCBERUZBVUxUX1JFTkRFUlRBUkdFVF9PUFRJT05TLAogICAgICAgICAgICAgICAgb3B0cyk7CiAgICAgICAgICAgIGlmIChvcHRzLnNhbXBsaW5nICE9PSAibmVhcmVzdCIgIT09IHRoaXMuSXNMaW5lYXJTYW1wbGluZygpKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGlmICghIW9wdHMuYWxwaGEgIT09IHRoaXMuSGFzQWxwaGEoKSkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBpZiAoISFvcHRzLmRlcHRoICE9PSB0aGlzLkhhc0RlcHRoQnVmZmVyKCkpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgaWYgKHRoaXMuX3JlbmRlcmVyLkdldFdlYkdMVmVyc2lvbk51bWJlcigpID49IDIpCiAgICAgICAgICAgICAgICBpZiAoISFvcHRzLmlzU2FtcGxlZCAhPT0gdGhpcy5Jc1NhbXBsZWQoKSkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBpZiAodHlwZW9mIG9wdHMud2lkdGggPT09ICJudW1iZXIiIHx8IHR5cGVvZiBvcHRzLmhlaWdodCA9PT0gIm51bWJlciIpIHJldHVybiAhdGhpcy5Jc0RlZmF1bHRTaXplKCkgJiYgdGhpcy5HZXRXaWR0aCgpID09PSBvcHRzLndpZHRoICYmIHRoaXMuR2V0SGVpZ2h0KCkgPT09IG9wdHMuaGVpZ2h0OwogICAgICAgICAgICBlbHNlIHJldHVybiB0aGlzLklzRGVmYXVsdFNpemUoKQogICAgICAgIH0KICAgICAgICBfR2V0V2ViR0xUZXh0dXJlKCkgewogICAgICAgICAgICBpZiAoIXRoaXMuX3RleHR1cmUpIHJldHVybiBudWxsOwogICAgICAgICAgICByZXR1cm4gdGhpcy5fdGV4dHVyZS5fR2V0VGV4dHVyZSgpCiAgICAgICAgfQogICAgICAgIEdldEVzdGltYXRlZE1lbW9yeVVzYWdlKCkgewogICAgICAgICAgICBpZiAodGhpcy5fdGV4dHVyZSkgcmV0dXJuIHRoaXMuX3RleHR1cmUuR2V0RXN0aW1hdGVkTWVtb3J5VXNhZ2UoKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3dpZHRoICogdGhpcy5faGVpZ2h0ICogKHRoaXMuX2FscGhhID8gNCA6IDMpCiAgICAgICAgfQogICAgICAgIHN0YXRpYyBhc3luYyBEZWJ1Z1JlYWRQaXhlbHNUb0Jsb2IocmVuZGVyZXIsIHJlbmRlclRhcmdldCkgewogICAgICAgICAgICBjb25zdCBpbWFnZURhdGEgPSBhd2FpdCByZW5kZXJlci5SZWFkQmFja1JlbmRlclRhcmdldFRvSW1hZ2VEYXRhKHJlbmRlclRhcmdldCwgdHJ1ZSk7CiAgICAgICAgICAgIHJldHVybiBhd2FpdCBDMy5JbWFnZURhdGFUb0Jsb2IoaW1hZ2VEYXRhKQogICAgICAgIH0KICAgICAgICBzdGF0aWMgT25Db250ZXh0TG9zdCgpIHsKICAgICAgICAgICAgYWxsUmVuZGVyVGFyZ2V0cy5jbGVhcigpCiAgICAgICAgfQogICAgICAgIHN0YXRpYyBhbGxSZW5kZXJUYXJnZXRzKCkgewogICAgICAgICAgICByZXR1cm4gYWxsUmVuZGVyVGFyZ2V0cy52YWx1ZXMoKQogICAgICAgIH0KICAgICAgICBzdGF0aWMgUmVzaXplQWxsKHdpZHRoLCBoZWlnaHQpIHsKICAgICAgICAgICAgZm9yIChjb25zdCBydCBvZiBhbGxSZW5kZXJUYXJnZXRzKQogICAgICAgICAgICAgICAgaWYgKHJ0LklzRGVmYXVsdFNpemUoKSkgcnQuX1Jlc2l6ZSh3aWR0aCwKICAgICAgICAgICAgICAgICAgICBoZWlnaHQpCiAgICAgICAgfQogICAgfTsKCn0KCi8vIC4uL2xpYi9nZngvd2ViZ2wvc2hhZGVyUHJvZ3JhbS5qcwp7CiAgICAndXNlIHN0cmljdCc7CiAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICBjb25zdCBnbE1hdHJpeCA9IHNlbGYuZ2xNYXRyaXg7CiAgICBjb25zdCB2ZWMzID0gZ2xNYXRyaXgudmVjMzsKICAgIGNvbnN0IG1hdDQgPSBnbE1hdHJpeC5tYXQ0OwogICAgY29uc3QgUkVTRVJWRURfVU5JRk9STV9OQU1FUyA9IG5ldyBTZXQoWyJhUG9zIiwgImFUZXgiLCAiYVBvaW50cyIsICJtYXRQIiwgIm1hdE1WIiwgInNhbXBsZXJGcm9udCIsICJzYW1wbGVyQmFjayIsICJzYW1wbGVyRGVwdGgiLCAiZGVzdFN0YXJ0IiwgImRlc3RFbmQiLCAic3JjU3RhcnQiLCAic3JjRW5kIiwgInNyY09yaWdpblN0YXJ0IiwgInNyY09yaWdpbkVuZCIsICJwaXhlbFNpemUiLCAic2Vjb25kcyIsICJkZXZpY2VQaXhlbFJhdGlvIiwgImxheWVyU2NhbGUiLCAibGF5ZXJBbmdsZSIsICJsYXlvdXRTdGFydCIsICJsYXlvdXRFbmQiLCAiY29sb3IiLCAiY29sb3IyXyIsICJwb2ludFRleFN0YXJ0IiwgInBvaW50VGV4RW5kIiwgInpFbGV2YXRpb24iLCAidGlsZVNpemUiLCAidGlsZVNwYWNpbmciLCAib3V0bGluZVRoaWNrbmVzcyIsICJ6TmVhciIsICJ6RmFyIl0pOwogICAgQzMuR2Z4LldlYkdMU2hhZGVyUHJvZ3JhbSA9IGNsYXNzIFdlYkdMU2hhZGVyUHJvZ3JhbSBleHRlbmRzIEMzLkdmeC5TaGFkZXJQcm9ncmFtQmFzZSB7CiAgICAgICAgc3RhdGljIGFzeW5jIENvbXBpbGUocmVuZGVyZXIsIHNoYWRlckluZm8pIHsKICAgICAgICAgICAgY29uc3QgZ2wgPSByZW5kZXJlci5HZXRDb250ZXh0KCk7CiAgICAgICAgICAgIGNvbnN0IGZyYWdTcmMgPSBzaGFkZXJJbmZvLnNyYzsKICAgICAgICAgICAgY29uc3QgdmVydGV4U3JjID0gc2hhZGVySW5mby52ZXJ0ZXhTcmM7CiAgICAgICAgICAgIGNvbnN0IG5hbWUgPSBzaGFkZXJJbmZvLm5hbWU7CiAgICAgICAgICAgIGNvbnN0IGZyYWdtZW50U2hhZGVyID0gZ2wuY3JlYXRlU2hhZGVyKGdsLkZSQUdNRU5UX1NIQURFUik7CiAgICAgICAgICAgIGdsLnNoYWRlclNvdXJjZShmcmFnbWVudFNoYWRlciwgZnJhZ1NyYyk7CiAgICAgICAgICAgIGdsLmNvbXBpbGVTaGFkZXIoZnJhZ21lbnRTaGFkZXIpOwogICAgICAgICAgICBjb25zdCB2ZXJ0ZXhTaGFkZXIgPSBnbC5jcmVhdGVTaGFkZXIoZ2wuVkVSVEVYX1NIQURFUik7CiAgICAgICAgICAgIGdsLnNoYWRlclNvdXJjZSh2ZXJ0ZXhTaGFkZXIsIHZlcnRleFNyYyk7CiAgICAgICAgICAgIGdsLmNvbXBpbGVTaGFkZXIodmVydGV4U2hhZGVyKTsKICAgICAgICAgICAgY29uc3Qgc2hhZGVyUHJvZ3JhbSA9IGdsLmNyZWF0ZVByb2dyYW0oKTsKICAgICAgICAgICAgZ2wuYXR0YWNoU2hhZGVyKHNoYWRlclByb2dyYW0sIGZyYWdtZW50U2hhZGVyKTsKICAgICAgICAgICAgZ2wuYXR0YWNoU2hhZGVyKHNoYWRlclByb2dyYW0sIHZlcnRleFNoYWRlcik7CiAgICAgICAgICAgIGdsLmJpbmRBdHRyaWJMb2NhdGlvbihzaGFkZXJQcm9ncmFtLCAwLCAiYVBvcyIpOwogICAgICAgICAgICBnbC5iaW5kQXR0cmliTG9jYXRpb24oc2hhZGVyUHJvZ3JhbSwgMSwgImFUZXgiKTsKICAgICAgICAgICAgZ2wuYmluZEF0dHJpYkxvY2F0aW9uKHNoYWRlclByb2dyYW0sIDIsICJhUG9pbnRzIik7CiAgICAgICAgICAgIGdsLmxpbmtQcm9ncmFtKHNoYWRlclByb2dyYW0pOwogICAgICAgICAgICBjb25zdCBwYXJhbGxlbFNoYWRlckNvbXBpbGVFeHQgPSByZW5kZXJlci5fR2V0UGFyYWxsZWxTaGFkZXJDb21waWxlRXh0ZW5zaW9uKCk7CiAgICAgICAgICAgIGlmIChwYXJhbGxlbFNoYWRlckNvbXBpbGVFeHQpIGF3YWl0IHJlbmRlcmVyLl9XYWl0Rm9yT2JqZWN0UmVhZHkoKCkgPT4gZ2wuZ2V0UHJvZ3JhbVBhcmFtZXRlcihzaGFkZXJQcm9ncmFtLCBwYXJhbGxlbFNoYWRlckNvbXBpbGVFeHRbIkNPTVBMRVRJT05fU1RBVFVTX0tIUiJdKSk7CiAgICAgICAgICAgIGVsc2UgYXdhaXQgQzMuV2FpdCg1KTsKICAgICAgICAgICAgaWYgKCFnbC5nZXRTaGFkZXJQYXJhbWV0ZXIoZnJhZ21lbnRTaGFkZXIsIGdsLkNPTVBJTEVfU1RBVFVTKSkgewogICAgICAgICAgICAgICAgY29uc3QgbG9nID0gZ2wuZ2V0U2hhZGVySW5mb0xvZyhmcmFnbWVudFNoYWRlcik7CiAgICAgICAgICAgICAgICBnbC5kZWxldGVTaGFkZXIoZnJhZ21lbnRTaGFkZXIpOwogICAgICAgICAgICAgICAgZ2wuZGVsZXRlU2hhZGVyKHZlcnRleFNoYWRlcik7CiAgICAgICAgICAgICAgICBnbC5kZWxldGVQcm9ncmFtKHNoYWRlclByb2dyYW0pOwogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJFcnJvciBjb21waWxpbmcgZnJhZ21lbnQgc2hhZGVyOiAiICsgbG9nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIWdsLmdldFNoYWRlclBhcmFtZXRlcih2ZXJ0ZXhTaGFkZXIsIGdsLkNPTVBJTEVfU1RBVFVTKSkgewogICAgICAgICAgICAgICAgY29uc3QgbG9nID0gZ2wuZ2V0U2hhZGVySW5mb0xvZyh2ZXJ0ZXhTaGFkZXIpOwogICAgICAgICAgICAgICAgZ2wuZGVsZXRlU2hhZGVyKGZyYWdtZW50U2hhZGVyKTsKICAgICAgICAgICAgICAgIGdsLmRlbGV0ZVNoYWRlcih2ZXJ0ZXhTaGFkZXIpOwogICAgICAgICAgICAgICAgZ2wuZGVsZXRlUHJvZ3JhbShzaGFkZXJQcm9ncmFtKTsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiRXJyb3IgY29tcGlsaW5nIHZlcnRleCBzaGFkZXI6ICIgKwogICAgICAgICAgICAgICAgICAgIGxvZyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCFnbC5nZXRQcm9ncmFtUGFyYW1ldGVyKHNoYWRlclByb2dyYW0sIGdsLkxJTktfU1RBVFVTKSkgewogICAgICAgICAgICAgICAgY29uc3QgbG9nID0gZ2wuZ2V0UHJvZ3JhbUluZm9Mb2coc2hhZGVyUHJvZ3JhbSk7CiAgICAgICAgICAgICAgICBnbC5kZWxldGVTaGFkZXIoZnJhZ21lbnRTaGFkZXIpOwogICAgICAgICAgICAgICAgZ2wuZGVsZXRlU2hhZGVyKHZlcnRleFNoYWRlcik7CiAgICAgICAgICAgICAgICBnbC5kZWxldGVQcm9ncmFtKHNoYWRlclByb2dyYW0pOwogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJFcnJvciBsaW5raW5nIHNoYWRlciBwcm9ncmFtOiAiICsgbG9nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBpbmZvTG9nID0gQzMuRmlsdGVyVW5wcmludGFibGVDaGFycyhnbC5nZXRQcm9ncmFtSW5mb0xvZyhzaGFkZXJQcm9ncmFtKSB8fCAiIikudHJpbSgpOwogICAgICAgICAgICBpZiAoaW5mb0xvZyAmJiAhQzMuSXNTdHJpbmdBbGxXaGl0ZXNwYWNlKGluZm9Mb2cpKSBjb25zb2xlLmluZm8oYFtXZWJHTF0gU2hhZGVyIHByb2dyYW0gJyR7bmFtZX0nIGNvbXBpbGF0aW9uIGxvZzogYCwgaW5mb0xvZyk7CiAgICAgICAgICAgIGdsLmRlbGV0ZVNoYWRlcihmcmFnbWVudFNoYWRlcik7CiAgICAgICAgICAgIGdsLmRlbGV0ZVNoYWRlcih2ZXJ0ZXhTaGFkZXIpOwogICAgICAgICAgICByZXR1cm4gc2hhZGVyUHJvZ3JhbQogICAgICAgIH0KICAgICAgICBzdGF0aWMgYXN5bmMgQ3JlYXRlKHJlbmRlcmVyLCBzaGFkZXJJbmZvKSB7CiAgICAgICAgICAgIGNvbnN0IHNoYWRlclByb2dyYW0gPSBhd2FpdCBDMy5HZnguV2ViR0xTaGFkZXJQcm9ncmFtLkNvbXBpbGUocmVuZGVyZXIsIHNoYWRlckluZm8pOwogICAgICAgICAgICByZXR1cm4gbmV3IEMzLkdmeC5XZWJHTFNoYWRlclByb2dyYW0ocmVuZGVyZXIsIHNoYWRlclByb2dyYW0sIHNoYWRlckluZm8pCiAgICAgICAgfQogICAgICAgIGNvbnN0cnVjdG9yKHJlbmRlcmVyLCBzaGFkZXJQcm9ncmFtLCBzaGFkZXJJbmZvKSB7CiAgICAgICAgICAgIHN1cGVyKHJlbmRlcmVyLCBzaGFkZXJJbmZvKTsKICAgICAgICAgICAgY29uc3QgZ2wgPSByZW5kZXJlci5HZXRDb250ZXh0KCk7CiAgICAgICAgICAgIGNvbnN0IGJhdGNoU3RhdGUgPSByZW5kZXJlci5HZXRCYXRjaFN0YXRlKCk7CiAgICAgICAgICAgIHJlbmRlcmVyLkVuZEJhdGNoKCk7CiAgICAgICAgICAgIGdsLnVzZVByb2dyYW0oc2hhZGVyUHJvZ3JhbSk7CiAgICAgICAgICAgIHRoaXMuX2dsID0gZ2w7CiAgICAgICAgICAgIHRoaXMuX3NoYWRlclByb2dyYW0gPSBzaGFkZXJQcm9ncmFtOwogICAgICAgICAgICB0aGlzLl9pc0RldmljZVRyYW5zZm9ybSA9CiAgICAgICAgICAgICAgICBzaGFkZXJJbmZvLm5hbWUgPT09ICI8ZGVmYXVsdC1kZXZpY2UtdHJhbnNmb3JtPiI7CiAgICAgICAgICAgIGNvbnN0IGxvY0FQb3MgPSBnbC5nZXRBdHRyaWJMb2NhdGlvbihzaGFkZXJQcm9ncmFtLCAiYVBvcyIpOwogICAgICAgICAgICBjb25zdCBsb2NBVGV4ID0gZ2wuZ2V0QXR0cmliTG9jYXRpb24oc2hhZGVyUHJvZ3JhbSwgImFUZXgiKTsKICAgICAgICAgICAgdGhpcy5fbG9jQVBvaW50cyA9IGdsLmdldEF0dHJpYkxvY2F0aW9uKHNoYWRlclByb2dyYW0sICJhUG9pbnRzIik7CiAgICAgICAgICAgIGlmIChsb2NBUG9zICE9PSAtMSkgewogICAgICAgICAgICAgICAgZ2wuYmluZEJ1ZmZlcihnbC5BUlJBWV9CVUZGRVIsIHJlbmRlcmVyLl92ZXJ0ZXhCdWZmZXIpOwogICAgICAgICAgICAgICAgZ2wudmVydGV4QXR0cmliUG9pbnRlcihsb2NBUG9zLCByZW5kZXJlci5HZXROdW1WZXJ0ZXhDb21wb25lbnRzKCksIGdsLkZMT0FULCBmYWxzZSwgMCwgMCk7CiAgICAgICAgICAgICAgICBnbC5lbmFibGVWZXJ0ZXhBdHRyaWJBcnJheShsb2NBUG9zKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChsb2NBVGV4ICE9PSAtMSkgewogICAgICAgICAgICAgICAgZ2wuYmluZEJ1ZmZlcihnbC5BUlJBWV9CVUZGRVIsIHJlbmRlcmVyLl90ZXhjb29yZEJ1ZmZlcik7CiAgICAgICAgICAgICAgICBnbC52ZXJ0ZXhBdHRyaWJQb2ludGVyKGxvY0FUZXgsCiAgICAgICAgICAgICAgICAgICAgMiwgZ2wuRkxPQVQsIGZhbHNlLCAwLCAwKTsKICAgICAgICAgICAgICAgIGdsLmVuYWJsZVZlcnRleEF0dHJpYkFycmF5KGxvY0FUZXgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHRoaXMuX2xvY0FQb2ludHMgIT09IC0xKSB7CiAgICAgICAgICAgICAgICBnbC5iaW5kQnVmZmVyKGdsLkFSUkFZX0JVRkZFUiwgcmVuZGVyZXIuX3BvaW50QnVmZmVyKTsKICAgICAgICAgICAgICAgIGdsLnZlcnRleEF0dHJpYlBvaW50ZXIodGhpcy5fbG9jQVBvaW50cywgNCwgZ2wuRkxPQVQsIGZhbHNlLCAwLCAwKTsKICAgICAgICAgICAgICAgIGdsLmVuYWJsZVZlcnRleEF0dHJpYkFycmF5KHRoaXMuX2xvY0FQb2ludHMpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZ2wuYmluZEJ1ZmZlcihnbC5BUlJBWV9CVUZGRVIsIG51bGwpOwogICAgICAgICAgICB0aGlzLl91TWF0UCA9IG5ldyBDMy5HZnguV2ViR0xTaGFkZXJVbmlmb3JtKHRoaXMsICJtYXRQIiwgIm1hdDQiKTsKICAgICAgICAgICAgdGhpcy5fdU1hdE1WID0gbmV3IEMzLkdmeC5XZWJHTFNoYWRlclVuaWZvcm0odGhpcywgIm1hdE1WIiwgIm1hdDQiKTsKICAgICAgICAgICAgdGhpcy5fdUNvbG9yID0gbmV3IEMzLkdmeC5XZWJHTFNoYWRlclVuaWZvcm0odGhpcywgImNvbG9yIiwgInZlYzQiKTsKICAgICAgICAgICAgdGhpcy5fdVNhbXBsZXJGcm9udCA9IG5ldyBDMy5HZnguV2ViR0xTaGFkZXJVbmlmb3JtKHRoaXMsCiAgICAgICAgICAgICAgICAic2FtcGxlckZyb250IiwgInNhbXBsZXIiKTsKICAgICAgICAgICAgdGhpcy5fdVBvaW50VGV4U3RhcnQgPSBuZXcgQzMuR2Z4LldlYkdMU2hhZGVyVW5pZm9ybSh0aGlzLCAicG9pbnRUZXhTdGFydCIsICJ2ZWMyIik7CiAgICAgICAgICAgIHRoaXMuX3VQb2ludFRleEVuZCA9IG5ldyBDMy5HZnguV2ViR0xTaGFkZXJVbmlmb3JtKHRoaXMsICJwb2ludFRleEVuZCIsICJ2ZWMyIik7CiAgICAgICAgICAgIHRoaXMuX3VaRWxldmF0aW9uID0gbmV3IEMzLkdmeC5XZWJHTFNoYWRlclVuaWZvcm0odGhpcywgInpFbGV2YXRpb24iLCAiZmxvYXQiKTsKICAgICAgICAgICAgdGhpcy5fdVRpbGVTaXplID0gbmV3IEMzLkdmeC5XZWJHTFNoYWRlclVuaWZvcm0odGhpcywgInRpbGVTaXplIiwgInZlYzIiKTsKICAgICAgICAgICAgdGhpcy5fdVRpbGVTcGFjaW5nID0gbmV3IEMzLkdmeC5XZWJHTFNoYWRlclVuaWZvcm0odGhpcywgInRpbGVTcGFjaW5nIiwgInZlYzIiKTsKICAgICAgICAgICAgdGhpcy5fdUNvbG9yMiA9IG5ldyBDMy5HZnguV2ViR0xTaGFkZXJVbmlmb3JtKHRoaXMsICJjb2xvcjJfIiwgInZlYzQiKTsKICAgICAgICAgICAgdGhpcy5fdU91dGxpbmVUaGlja25lc3MgPSBuZXcgQzMuR2Z4LldlYkdMU2hhZGVyVW5pZm9ybSh0aGlzLAogICAgICAgICAgICAgICAgIm91dGxpbmVUaGlja25lc3MiLCAiZmxvYXQiKTsKICAgICAgICAgICAgdGhpcy5fdVNhbXBsZXJCYWNrID0gbmV3IEMzLkdmeC5XZWJHTFNoYWRlclVuaWZvcm0odGhpcywgInNhbXBsZXJCYWNrIiwgInNhbXBsZXIiKTsKICAgICAgICAgICAgdGhpcy5fdVNhbXBsZXJEZXB0aCA9IG5ldyBDMy5HZnguV2ViR0xTaGFkZXJVbmlmb3JtKHRoaXMsICJzYW1wbGVyRGVwdGgiLCAic2FtcGxlciIpOwogICAgICAgICAgICB0aGlzLl91RGVzdFN0YXJ0ID0gbmV3IEMzLkdmeC5XZWJHTFNoYWRlclVuaWZvcm0odGhpcywgImRlc3RTdGFydCIsICJ2ZWMyIik7CiAgICAgICAgICAgIHRoaXMuX3VEZXN0RW5kID0gbmV3IEMzLkdmeC5XZWJHTFNoYWRlclVuaWZvcm0odGhpcywgImRlc3RFbmQiLCAidmVjMiIpOwogICAgICAgICAgICB0aGlzLl91U3JjU3RhcnQgPSBuZXcgQzMuR2Z4LldlYkdMU2hhZGVyVW5pZm9ybSh0aGlzLCAic3JjU3RhcnQiLCAidmVjMiIpOwogICAgICAgICAgICB0aGlzLl91U3JjRW5kID0gbmV3IEMzLkdmeC5XZWJHTFNoYWRlclVuaWZvcm0odGhpcywgInNyY0VuZCIsICJ2ZWMyIik7CiAgICAgICAgICAgIHRoaXMuX3VTcmNPcmlnaW5TdGFydCA9IG5ldyBDMy5HZnguV2ViR0xTaGFkZXJVbmlmb3JtKHRoaXMsCiAgICAgICAgICAgICAgICAic3JjT3JpZ2luU3RhcnQiLCAidmVjMiIpOwogICAgICAgICAgICB0aGlzLl91U3JjT3JpZ2luRW5kID0gbmV3IEMzLkdmeC5XZWJHTFNoYWRlclVuaWZvcm0odGhpcywgInNyY09yaWdpbkVuZCIsICJ2ZWMyIik7CiAgICAgICAgICAgIHRoaXMuX3VQaXhlbFNpemUgPSBuZXcgQzMuR2Z4LldlYkdMU2hhZGVyVW5pZm9ybSh0aGlzLCAicGl4ZWxTaXplIiwgInZlYzIiKTsKICAgICAgICAgICAgdGhpcy5fdVNlY29uZHMgPSBuZXcgQzMuR2Z4LldlYkdMU2hhZGVyVW5pZm9ybSh0aGlzLCAic2Vjb25kcyIsICJmbG9hdCIpOwogICAgICAgICAgICB0aGlzLl91RGV2aWNlUGl4ZWxSYXRpbyA9IG5ldyBDMy5HZnguV2ViR0xTaGFkZXJVbmlmb3JtKHRoaXMsICJkZXZpY2VQaXhlbFJhdGlvIiwgImZsb2F0Iik7CiAgICAgICAgICAgIHRoaXMuX3VMYXllclNjYWxlID0gbmV3IEMzLkdmeC5XZWJHTFNoYWRlclVuaWZvcm0odGhpcywgImxheWVyU2NhbGUiLCAiZmxvYXQiKTsKICAgICAgICAgICAgdGhpcy5fdUxheWVyQW5nbGUgPSBuZXcgQzMuR2Z4LldlYkdMU2hhZGVyVW5pZm9ybSh0aGlzLCAibGF5ZXJBbmdsZSIsICJmbG9hdCIpOwogICAgICAgICAgICB0aGlzLl91TGF5b3V0U3RhcnQgPSBuZXcgQzMuR2Z4LldlYkdMU2hhZGVyVW5pZm9ybSh0aGlzLAogICAgICAgICAgICAgICAgImxheW91dFN0YXJ0IiwgInZlYzIiKTsKICAgICAgICAgICAgdGhpcy5fdUxheW91dEVuZCA9IG5ldyBDMy5HZnguV2ViR0xTaGFkZXJVbmlmb3JtKHRoaXMsICJsYXlvdXRFbmQiLCAidmVjMiIpOwogICAgICAgICAgICB0aGlzLl91Wk5lYXIgPSBuZXcgQzMuR2Z4LldlYkdMU2hhZGVyVW5pZm9ybSh0aGlzLCAiek5lYXIiLCAiZmxvYXQiKTsKICAgICAgICAgICAgdGhpcy5fdVpGYXIgPSBuZXcgQzMuR2Z4LldlYkdMU2hhZGVyVW5pZm9ybSh0aGlzLCAiekZhciIsICJmbG9hdCIpOwogICAgICAgICAgICB0aGlzLl9oYXNBbnlPcHRpb25hbFVuaWZvcm1zID0gISEodGhpcy5fdVBpeGVsU2l6ZS5Jc1VzZWQoKSB8fCB0aGlzLl91U2Vjb25kcy5Jc1VzZWQoKSB8fCB0aGlzLl91U2FtcGxlckJhY2suSXNVc2VkKCkgfHwgdGhpcy5fdURlc3RTdGFydC5Jc1VzZWQoKSB8fCB0aGlzLl91RGVzdEVuZC5Jc1VzZWQoKSB8fCB0aGlzLl91U3JjU3RhcnQuSXNVc2VkKCkgfHwgdGhpcy5fdVNyY0VuZC5Jc1VzZWQoKSB8fCB0aGlzLl91U3JjT3JpZ2luU3RhcnQuSXNVc2VkKCkgfHwgdGhpcy5fdVNyY09yaWdpbkVuZC5Jc1VzZWQoKSB8fCB0aGlzLl91RGV2aWNlUGl4ZWxSYXRpby5Jc1VzZWQoKSB8fAogICAgICAgICAgICAgICAgdGhpcy5fdUxheWVyU2NhbGUuSXNVc2VkKCkgfHwgdGhpcy5fdUxheWVyQW5nbGUuSXNVc2VkKCkgfHwgdGhpcy5fdUxheW91dFN0YXJ0LklzVXNlZCgpIHx8IHRoaXMuX3VMYXlvdXRFbmQuSXNVc2VkKCkpOwogICAgICAgICAgICBjb25zdCBjdXN0b21QYXJhbWV0ZXJEZWZzID0gc2hhZGVySW5mby5wYXJhbWV0ZXJzIHx8IFtdOwogICAgICAgICAgICB0aGlzLl91Q3VzdG9tUGFyYW1ldGVycyA9IFtdOwogICAgICAgICAgICB0aGlzLl91c2VzQW55U3JjUmVjdE9yUGl4ZWxTaXplID0gdGhpcy5fdVBpeGVsU2l6ZS5Jc1VzZWQoKSB8fCB0aGlzLl91U3JjU3RhcnQuSXNVc2VkKCkgfHwgdGhpcy5fdVNyY0VuZC5Jc1VzZWQoKSB8fCB0aGlzLl91U3JjT3JpZ2luU3RhcnQuSXNVc2VkKCkgfHwgdGhpcy5fdVNyY09yaWdpbkVuZC5Jc1VzZWQoKTsKICAgICAgICAgICAgdGhpcy5faGFzQ3VycmVudE1hdFAgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5faGFzQ3VycmVudE1hdE1WID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX3VDb2xvci5Jbml0NGYoMSwgMSwgMSwgMSk7CiAgICAgICAgICAgIHRoaXMuX3VDb2xvcjIuSW5pdDRmKDEsIDEsIDEsIDEpOwogICAgICAgICAgICB0aGlzLl91U2FtcGxlckZyb250LkluaXQxaSgwKTsKICAgICAgICAgICAgdGhpcy5fdVNhbXBsZXJCYWNrLkluaXQxaSgxKTsKICAgICAgICAgICAgdGhpcy5fdVNhbXBsZXJEZXB0aC5Jbml0MWkoMik7CiAgICAgICAgICAgIHRoaXMuX3VQb2ludFRleFN0YXJ0LkluaXQyZigwLCAwKTsKICAgICAgICAgICAgdGhpcy5fdVBvaW50VGV4RW5kLkluaXQyZigxLCAxKTsKICAgICAgICAgICAgdGhpcy5fdVpFbGV2YXRpb24uSW5pdDFmKDApOwogICAgICAgICAgICB0aGlzLl91VGlsZVNpemUuSW5pdDJmKDAsIDApOwogICAgICAgICAgICB0aGlzLl91VGlsZVNwYWNpbmcuSW5pdDJmKDAsIDApOwogICAgICAgICAgICB0aGlzLl91RGVzdFN0YXJ0LkluaXQyZigwLCAwKTsKICAgICAgICAgICAgdGhpcy5fdURlc3RFbmQuSW5pdDJmKDEsIDEpOwogICAgICAgICAgICB0aGlzLl91U3JjU3RhcnQuSW5pdDJmKDAsIDApOwogICAgICAgICAgICB0aGlzLl91U3JjRW5kLkluaXQyZigwLCAwKTsKICAgICAgICAgICAgdGhpcy5fdVNyY09yaWdpblN0YXJ0LkluaXQyZigwLCAwKTsKICAgICAgICAgICAgdGhpcy5fdVNyY09yaWdpbkVuZC5Jbml0MmYoMCwgMCk7CiAgICAgICAgICAgIHRoaXMuX3VQaXhlbFNpemUuSW5pdDJmKDAsIDApOwogICAgICAgICAgICB0aGlzLl91RGV2aWNlUGl4ZWxSYXRpby5Jbml0MWYoMSk7CiAgICAgICAgICAgIHRoaXMuX3VaTmVhci5Jbml0MWYocmVuZGVyZXIuR2V0TmVhclooKSk7CiAgICAgICAgICAgIHRoaXMuX3VaRmFyLkluaXQxZihyZW5kZXJlci5HZXRGYXJaKCkpOwogICAgICAgICAgICB0aGlzLl91TGF5ZXJTY2FsZS5Jbml0MWYoMSk7CiAgICAgICAgICAgIHRoaXMuX3VMYXllckFuZ2xlLkluaXQxZigwKTsKICAgICAgICAgICAgdGhpcy5fdVNlY29uZHMuSW5pdDFmKDApOwogICAgICAgICAgICB0aGlzLl91TGF5b3V0U3RhcnQuSW5pdDJmKDAsIDApOwogICAgICAgICAgICB0aGlzLl91TGF5b3V0RW5kLkluaXQyZigwLCAwKTsKICAgICAgICAgICAgdGhpcy5fdU91dGxpbmVUaGlja25lc3MuSW5pdDFmKDEpOwogICAgICAgICAgICBmb3IgKGNvbnN0IHAgb2YgY3VzdG9tUGFyYW1ldGVyRGVmcykgewogICAgICAgICAgICAgICAgY29uc3QgdW5pZm9ybU5hbWUgPSBwWzBdOwogICAgICAgICAgICAgICAgY29uc3QgcGFyYW1UeXBlID0gcFsyXTsKICAgICAgICAgICAgICAgIGNvbnN0IHNoYWRlclVuaWZvcm0gPSBuZXcgQzMuR2Z4LldlYkdMU2hhZGVyVW5pZm9ybSh0aGlzLCB1bmlmb3JtTmFtZSwgcGFyYW1UeXBlKTsKICAgICAgICAgICAgICAgIGlmIChwYXJhbVR5cGUgPT09ICJjb2xvciIpIHNoYWRlclVuaWZvcm0uSW5pdDNmKDAsIDAsIDApOwogICAgICAgICAgICAgICAgZWxzZSBzaGFkZXJVbmlmb3JtLkluaXQxZigwKTsKICAgICAgICAgICAgICAgIHRoaXMuX3VDdXN0b21QYXJhbWV0ZXJzLnB1c2goc2hhZGVyVW5pZm9ybSkKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGhpcy5faXNEZXZpY2VUcmFuc2Zvcm0pIHRoaXMuX1VwZGF0ZURldmljZVRyYW5zZm9ybVVuaWZvcm1zKGJhdGNoU3RhdGUuY3VycmVudE1hdFApOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuVXBkYXRlTWF0UChiYXRjaFN0YXRlLmN1cnJlbnRNYXRQLCB0cnVlKTsKICAgICAgICAgICAgICAgIHRoaXMuVXBkYXRlTWF0TVYoYmF0Y2hTdGF0ZS5jdXJyZW50TVYsIHRydWUpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgY3VycmVudFNoYWRlciA9IGJhdGNoU3RhdGUuY3VycmVudFNoYWRlcjsKICAgICAgICAgICAgZ2wudXNlUHJvZ3JhbShjdXJyZW50U2hhZGVyID8gY3VycmVudFNoYWRlci5fc2hhZGVyUHJvZ3JhbSA6IG51bGwpCiAgICAgICAgfQogICAgICAgIFJlbGVhc2UoKSB7CiAgICAgICAgICAgIHRoaXMuX2dsLmRlbGV0ZVByb2dyYW0odGhpcy5fc2hhZGVyUHJvZ3JhbSk7CiAgICAgICAgICAgIHRoaXMuX3NoYWRlclByb2dyYW0gPSBudWxsOwogICAgICAgICAgICB0aGlzLl9yZW5kZXJlci5fUmVtb3ZlU2hhZGVyUHJvZ3JhbSh0aGlzKTsKICAgICAgICAgICAgdGhpcy5fZ2wgPSBudWxsOwogICAgICAgICAgICBzdXBlci5SZWxlYXNlKCkKICAgICAgICB9CiAgICAgICAgR2V0V2ViR0xDb250ZXh0KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZ2wKICAgICAgICB9CiAgICAgICAgR2V0U2hhZGVyUHJvZ3JhbSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NoYWRlclByb2dyYW0KICAgICAgICB9CiAgICAgICAgR2V0UGFyYW1ldGVyQ291bnQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl91Q3VzdG9tUGFyYW1ldGVycy5sZW5ndGgKICAgICAgICB9CiAgICAgICAgR2V0UGFyYW1ldGVyVHlwZShwYXJhbUluZGV4KSB7CiAgICAgICAgICAgIGlmIChwYXJhbUluZGV4IDwKICAgICAgICAgICAgICAgIDAgfHwgcGFyYW1JbmRleCA+PSB0aGlzLl91Q3VzdG9tUGFyYW1ldGVycy5sZW5ndGgpIHJldHVybiBudWxsOwogICAgICAgICAgICByZXR1cm4gdGhpcy5fdUN1c3RvbVBhcmFtZXRlcnNbcGFyYW1JbmRleF0uR2V0VHlwZSgpCiAgICAgICAgfQogICAgICAgIEFyZUN1c3RvbVBhcmFtZXRlcnNBbHJlYWR5U2V0SW5CYXRjaChwYXJhbXMpIHsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IHBhcmFtcy5sZW5ndGg7IGkgPCBsZW47ICsraSkKICAgICAgICAgICAgICAgIGlmICghdGhpcy5fdUN1c3RvbVBhcmFtZXRlcnNbaV0uSXNTZXRUb0N1c3RvbUluQmF0Y2gocGFyYW1zW2ldKSkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgIH0KICAgICAgICBTZXRDdXN0b21QYXJhbWV0ZXJzSW5CYXRjaChwYXJhbXMpIHsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IHBhcmFtcy5sZW5ndGg7IGkgPCBsZW47ICsraSkgdGhpcy5fdUN1c3RvbVBhcmFtZXRlcnNbaV0uU2V0QmF0Y2hWYWx1ZUN1c3RvbShwYXJhbXNbaV0pCiAgICAgICAgfQogICAgICAgIEFyZU9wdGlvbmFsVW5pZm9ybXNBbHJlYWR5U2V0SW5CYXRjaChkZXN0UmVjdCwgc3JjUmVjdCwgc3JjT3JpZ2luUmVjdCwgbGF5b3V0UmVjdCwgcGl4ZWxXaWR0aCwKICAgICAgICAgICAgcGl4ZWxIZWlnaHQsIGRwciwgbGF5ZXJTY2FsZSwgbGF5ZXJBbmdsZSwgdGltZSkgewogICAgICAgICAgICBpZiAodGhpcy5fdVNhbXBsZXJCYWNrLklzVXNlZCgpKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGlmICh0aGlzLl91UGl4ZWxTaXplLklzVXNlZCgpICYmICF0aGlzLl91UGl4ZWxTaXplLklzU2V0VG8ySW5CYXRjaChwaXhlbFdpZHRoLCBwaXhlbEhlaWdodCkpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgaWYgKHRoaXMuX3VEZXN0U3RhcnQuSXNVc2VkKCkgJiYgIXRoaXMuX3VEZXN0U3RhcnQuSXNTZXRUbzJJbkJhdGNoKGRlc3RSZWN0LmdldExlZnQoKSwgZGVzdFJlY3QuZ2V0VG9wKCkpKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGlmICh0aGlzLl91RGVzdEVuZC5Jc1VzZWQoKSAmJiAhdGhpcy5fdURlc3RFbmQuSXNTZXRUbzJJbkJhdGNoKGRlc3RSZWN0LmdldFJpZ2h0KCksIGRlc3RSZWN0LmdldEJvdHRvbSgpKSkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBpZiAodGhpcy5fdURldmljZVBpeGVsUmF0aW8uSXNVc2VkKCkgJiYgIXRoaXMuX3VEZXZpY2VQaXhlbFJhdGlvLklzU2V0VG8xSW5CYXRjaChkcHIpKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGlmICh0aGlzLl91TGF5ZXJTY2FsZS5Jc1VzZWQoKSAmJiAhdGhpcy5fdUxheWVyU2NhbGUuSXNTZXRUbzFJbkJhdGNoKGxheWVyU2NhbGUpKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGlmICh0aGlzLl91TGF5ZXJBbmdsZS5Jc1VzZWQoKSAmJiAhdGhpcy5fdUxheWVyQW5nbGUuSXNTZXRUbzFJbkJhdGNoKGxheWVyQW5nbGUpKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGlmICh0aGlzLl91U3JjU3RhcnQuSXNVc2VkKCkgJiYgIXRoaXMuX3VTcmNTdGFydC5Jc1NldFRvMkluQmF0Y2goc3JjUmVjdC5nZXRMZWZ0KCksIHNyY1JlY3QuZ2V0VG9wKCkpKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGlmICh0aGlzLl91U3JjRW5kLklzVXNlZCgpICYmICF0aGlzLl91U3JjRW5kLklzU2V0VG8ySW5CYXRjaChzcmNSZWN0LmdldFJpZ2h0KCksIHNyY1JlY3QuZ2V0Qm90dG9tKCkpKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGlmICh0aGlzLl91U3JjT3JpZ2luU3RhcnQuSXNVc2VkKCkgJiYgIXRoaXMuX3VTcmNPcmlnaW5TdGFydC5Jc1NldFRvMkluQmF0Y2goc3JjT3JpZ2luUmVjdC5nZXRMZWZ0KCksCiAgICAgICAgICAgICAgICAgICAgc3JjT3JpZ2luUmVjdC5nZXRUb3AoKSkpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgaWYgKHRoaXMuX3VTcmNPcmlnaW5FbmQuSXNVc2VkKCkgJiYgIXRoaXMuX3VTcmNPcmlnaW5FbmQuSXNTZXRUbzJJbkJhdGNoKHNyY09yaWdpblJlY3QuZ2V0UmlnaHQoKSwgc3JjT3JpZ2luUmVjdC5nZXRCb3R0b20oKSkpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgaWYgKHRoaXMuX3VMYXlvdXRTdGFydC5Jc1VzZWQoKSAmJiAhdGhpcy5fdUxheW91dFN0YXJ0LklzU2V0VG8ySW5CYXRjaChsYXlvdXRSZWN0LmdldExlZnQoKSwgbGF5b3V0UmVjdC5nZXRUb3AoKSkpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgaWYgKHRoaXMuX3VMYXlvdXRFbmQuSXNVc2VkKCkgJiYgIXRoaXMuX3VMYXlvdXRFbmQuSXNTZXRUbzJJbkJhdGNoKGxheW91dFJlY3QuZ2V0VG9wKCksIGxheW91dFJlY3QuZ2V0Qm90dG9tKCkpKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGlmICh0aGlzLl91U2Vjb25kcy5Jc1VzZWQoKSAmJiAhdGhpcy5fdVNlY29uZHMuSXNTZXRUbzFJbkJhdGNoKHRpbWUpKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgfQogICAgICAgIFNldE9wdGlvbmFsVW5pZm9ybXNJbkJhdGNoKGRlc3RSZWN0LAogICAgICAgICAgICBzcmNSZWN0LCBzcmNPcmlnaW5SZWN0LCBsYXlvdXRSZWN0LCBwaXhlbFdpZHRoLCBwaXhlbEhlaWdodCwgZHByLCBsYXllclNjYWxlLCBsYXllckFuZ2xlLCB0aW1lKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl91U2FtcGxlckJhY2suSXNVc2VkKCkpIHJldHVybjsKICAgICAgICAgICAgaWYgKHRoaXMuX3VQaXhlbFNpemUuSXNVc2VkKCkpIHRoaXMuX3VQaXhlbFNpemUuU2V0QmF0Y2gyKHBpeGVsV2lkdGgsIHBpeGVsSGVpZ2h0KTsKICAgICAgICAgICAgaWYgKHRoaXMuX3VEZXN0U3RhcnQuSXNVc2VkKCkpIHRoaXMuX3VEZXN0U3RhcnQuU2V0QmF0Y2gyKGRlc3RSZWN0LmdldExlZnQoKSwgZGVzdFJlY3QuZ2V0VG9wKCkpOwogICAgICAgICAgICBpZiAodGhpcy5fdURlc3RFbmQuSXNVc2VkKCkpIHRoaXMuX3VEZXN0RW5kLlNldEJhdGNoMihkZXN0UmVjdC5nZXRSaWdodCgpLCBkZXN0UmVjdC5nZXRCb3R0b20oKSk7CiAgICAgICAgICAgIGlmICh0aGlzLl91RGV2aWNlUGl4ZWxSYXRpby5Jc1VzZWQoKSkgdGhpcy5fdURldmljZVBpeGVsUmF0aW8uU2V0QmF0Y2gxKGRwcik7CiAgICAgICAgICAgIGlmICh0aGlzLl91TGF5ZXJTY2FsZS5Jc1VzZWQoKSkgdGhpcy5fdUxheWVyU2NhbGUuU2V0QmF0Y2gxKGxheWVyU2NhbGUpOwogICAgICAgICAgICBpZiAodGhpcy5fdUxheWVyQW5nbGUuSXNVc2VkKCkpIHRoaXMuX3VMYXllckFuZ2xlLlNldEJhdGNoMShsYXllckFuZ2xlKTsKICAgICAgICAgICAgaWYgKHRoaXMuX3VTcmNTdGFydC5Jc1VzZWQoKSkgdGhpcy5fdVNyY1N0YXJ0LlNldEJhdGNoMihzcmNSZWN0LmdldExlZnQoKSwgc3JjUmVjdC5nZXRUb3AoKSk7CiAgICAgICAgICAgIGlmICh0aGlzLl91U3JjRW5kLklzVXNlZCgpKSB0aGlzLl91U3JjRW5kLlNldEJhdGNoMihzcmNSZWN0LmdldFJpZ2h0KCksIHNyY1JlY3QuZ2V0Qm90dG9tKCkpOwogICAgICAgICAgICBpZiAodGhpcy5fdVNyY09yaWdpblN0YXJ0LklzVXNlZCgpKSB0aGlzLl91U3JjT3JpZ2luU3RhcnQuU2V0QmF0Y2gyKHNyY09yaWdpblJlY3QuZ2V0TGVmdCgpLCBzcmNPcmlnaW5SZWN0LmdldFRvcCgpKTsKICAgICAgICAgICAgaWYgKHRoaXMuX3VTcmNPcmlnaW5FbmQuSXNVc2VkKCkpIHRoaXMuX3VTcmNPcmlnaW5FbmQuU2V0QmF0Y2gyKHNyY09yaWdpblJlY3QuZ2V0UmlnaHQoKSwgc3JjT3JpZ2luUmVjdC5nZXRCb3R0b20oKSk7CiAgICAgICAgICAgIGlmICh0aGlzLl91TGF5b3V0U3RhcnQuSXNVc2VkKCkpIHRoaXMuX3VMYXlvdXRTdGFydC5TZXRCYXRjaDIobGF5b3V0UmVjdC5nZXRMZWZ0KCksCiAgICAgICAgICAgICAgICBsYXlvdXRSZWN0LmdldFRvcCgpKTsKICAgICAgICAgICAgaWYgKHRoaXMuX3VMYXlvdXRFbmQuSXNVc2VkKCkpIHRoaXMuX3VMYXlvdXRFbmQuU2V0QmF0Y2gyKGxheW91dFJlY3QuZ2V0VG9wKCksIGxheW91dFJlY3QuZ2V0Qm90dG9tKCkpOwogICAgICAgICAgICBpZiAodGhpcy5fdVNlY29uZHMuSXNVc2VkKCkpIHRoaXMuX3VTZWNvbmRzLlNldEJhdGNoMSh0aW1lKQogICAgICAgIH0KICAgICAgICBVcGRhdGVNYXRQKG1hdFAsIGZvcmNlKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9oYXNDdXJyZW50TWF0UCAmJiAhZm9yY2UpIHJldHVybjsKICAgICAgICAgICAgaWYgKHRoaXMuX2lzRGV2aWNlVHJhbnNmb3JtKSByZXR1cm47CiAgICAgICAgICAgIGlmICh0aGlzLl91TWF0UC5Jc1VzZWQoKSkgdGhpcy5fdU1hdFAuVXBkYXRlTWF0cml4NGZ2KG1hdFApOwogICAgICAgICAgICB0aGlzLl9oYXNDdXJyZW50TWF0UCA9IHRydWUKICAgICAgICB9CiAgICAgICAgU2V0TWF0UFN0YWxlKCkgewogICAgICAgICAgICB0aGlzLl9oYXNDdXJyZW50TWF0UCA9IGZhbHNlCiAgICAgICAgfQogICAgICAgIFVwZGF0ZU1hdE1WKG1hdE1WLCBmb3JjZSkgewogICAgICAgICAgICBpZiAodGhpcy5faGFzQ3VycmVudE1hdE1WICYmICFmb3JjZSkgcmV0dXJuOwogICAgICAgICAgICBpZiAodGhpcy5faXNEZXZpY2VUcmFuc2Zvcm0pIHJldHVybjsKICAgICAgICAgICAgaWYgKHRoaXMuX3VNYXRNVi5Jc1VzZWQoKSkgdGhpcy5fdU1hdE1WLlVwZGF0ZU1hdHJpeDRmdihtYXRNVik7CiAgICAgICAgICAgIHRoaXMuX2hhc0N1cnJlbnRNYXRNViA9IHRydWUKICAgICAgICB9CiAgICAgICAgU2V0TWF0TVZTdGFsZSgpIHsKICAgICAgICAgICAgdGhpcy5faGFzQ3VycmVudE1hdE1WID0gZmFsc2UKICAgICAgICB9CiAgICAgICAgX1VwZGF0ZURldmljZVRyYW5zZm9ybVVuaWZvcm1zKG1hdFApIHsKICAgICAgICAgICAgaWYgKCF0aGlzLl9pc0RldmljZVRyYW5zZm9ybSkgdGhyb3cgbmV3IEVycm9yKCJub3QgZGV2aWNlIHRyYW5zZm9ybSBzaGFkZXIiKTsKICAgICAgICAgICAgdGhpcy5fdU1hdFAuVXBkYXRlTWF0cml4NGZ2KG1hdFApOwogICAgICAgICAgICBjb25zdCByZW5kZXJlciA9IHRoaXMuX3JlbmRlcmVyOwogICAgICAgICAgICBjb25zdCBzY3JvbGxYID0gcmVuZGVyZXIuR2V0V2lkdGgoKSAvIDI7CiAgICAgICAgICAgIGNvbnN0IHNjcm9sbFkgPSByZW5kZXJlci5HZXRIZWlnaHQoKSAvIDI7CiAgICAgICAgICAgIGNvbnN0IHRlbXBNYXQ0ID0gcmVuZGVyZXIuQ2FsY3VsYXRlTG9va0F0TW9kZWxWaWV3MihzY3JvbGxYLCBzY3JvbGxZLCByZW5kZXJlci5HZXREZWZhdWx0Q2FtZXJhWihyZW5kZXJlci5HZXRIZWlnaHQoKSksIHNjcm9sbFgsIHNjcm9sbFksIDAsIHJlbmRlcmVyLkdldEhlaWdodCgpKTsKICAgICAgICAgICAgdGhpcy5fdU1hdE1WLlVwZGF0ZU1hdHJpeDRmdih0ZW1wTWF0NCkKICAgICAgICB9CiAgICAgICAgVXBkYXRlQ29sb3IoYykgewogICAgICAgICAgICBpZiAodGhpcy5fdUNvbG9yLklzVXNlZCgpKSB0aGlzLl91Q29sb3IuVXBkYXRlNGYoY1swXSwKICAgICAgICAgICAgICAgIGNbMV0sIGNbMl0sIGNbM10pCiAgICAgICAgfQogICAgICAgIHN0YXRpYyBHZXRSZXNlcnZlZFVuaWZvcm1OYW1lcygpIHsKICAgICAgICAgICAgcmV0dXJuIFJFU0VSVkVEX1VOSUZPUk1fTkFNRVMKICAgICAgICB9CiAgICAgICAgc3RhdGljIEdldERlZmF1bHRWZXJ0ZXhTaGFkZXJTb3VyY2UodXNlSGlnaFApIHsKICAgICAgICAgICAgY29uc3QgdGV4UHJlY2lzaW9uID0gdXNlSGlnaFAgPyAiaGlnaG1lZHAiIDogIm1lZGl1bXAiOwogICAgICAgICAgICByZXR1cm4gW2AjaWZkZWYgR0xfRlJBR01FTlRfUFJFQ0lTSU9OX0hJR0hgLCBgI2RlZmluZSBoaWdobWVkcCBoaWdocGAsIGAjZWxzZWAsIGAjZGVmaW5lIGhpZ2htZWRwIG1lZGl1bXBgLCBgI2VuZGlmYCwgYGF0dHJpYnV0ZSBoaWdocCB2ZWMzIGFQb3M7YCwgYGF0dHJpYnV0ZSAke3RleFByZWNpc2lvbn0gdmVjMiBhVGV4O2AsIGB2YXJ5aW5nICR7dGV4UHJlY2lzaW9ufSB2ZWMyIHZUZXg7YCwgYHVuaWZvcm0gaGlnaHAgbWF0NCBtYXRQO2AsIGB1bmlmb3JtIGhpZ2hwIG1hdDQgbWF0TVY7YCwgYHZvaWQgbWFpbih2b2lkKSB7YCwgYAlnbF9Qb3NpdGlvbiA9IG1hdFAgKiBtYXRNViAqIHZlYzQoYVBvcywgMS4wKTtgLAogICAgICAgICAgICAgICAgYAl2VGV4ID0gYVRleDtgLCBgfWAKICAgICAgICAgICAgXS5qb2luKCJcbiIpCiAgICAgICAgfQogICAgICAgIHN0YXRpYyBHZXREZWZhdWx0VmVydGV4U2hhZGVyU291cmNlX1dlYkdMMih1c2VIaWdoUCkgewogICAgICAgICAgICBjb25zdCB0ZXhQcmVjaXNpb24gPSB1c2VIaWdoUCA/ICJoaWdocCIgOiAibWVkaXVtcCI7CiAgICAgICAgICAgIHJldHVybiBbYCN2ZXJzaW9uIDMwMCBlc2AsIGBpbiBoaWdocCB2ZWMzIGFQb3M7YCwgYGluICR7dGV4UHJlY2lzaW9ufSB2ZWMyIGFUZXg7YCwgYG91dCAke3RleFByZWNpc2lvbn0gdmVjMiB2VGV4O2AsIGB1bmlmb3JtIGhpZ2hwIG1hdDQgbWF0UDtgLCBgdW5pZm9ybSBoaWdocCBtYXQ0IG1hdE1WO2AsIGB2b2lkIG1haW4odm9pZCkge2AsIGAJZ2xfUG9zaXRpb24gPSBtYXRQICogbWF0TVYgKiB2ZWM0KGFQb3MsIDEuMCk7YCwgYAl2VGV4ID0gYVRleDtgLCBgfWBdLmpvaW4oIlxuIikKICAgICAgICB9CiAgICAgICAgc3RhdGljIEdldFRleHR1cmVGaWxsRnJhZ21lbnRTaGFkZXJTb3VyY2VfV2ViR0wxX05vRnJhZ0RlcHRoKCkgewogICAgICAgICAgICByZXR1cm4gWyJ2YXJ5aW5nIG1lZGl1bXAgdmVjMiB2VGV4OyIsICJ1bmlmb3JtIGxvd3AgdmVjNCBjb2xvcjsiLAogICAgICAgICAgICAgICAgInVuaWZvcm0gbG93cCBzYW1wbGVyMkQgc2FtcGxlckZyb250OyIsICJ2b2lkIG1haW4odm9pZCkgeyIsICJcdGdsX0ZyYWdDb2xvciA9IHRleHR1cmUyRChzYW1wbGVyRnJvbnQsIHZUZXgpICogY29sb3I7IiwgIn0iCiAgICAgICAgICAgIF0uam9pbigiXG4iKQogICAgICAgIH0KICAgICAgICBzdGF0aWMgR2V0VGV4dHVyZUZpbGxGcmFnbWVudFNoYWRlclNvdXJjZV9XZWJHTDFfRnJhZ0RlcHRoRVhUKCkgewogICAgICAgICAgICByZXR1cm4gWyIjZXh0ZW5zaW9uIEdMX0VYVF9mcmFnX2RlcHRoIDogZW5hYmxlIiwgInZhcnlpbmcgbWVkaXVtcCB2ZWMyIHZUZXg7IiwgInVuaWZvcm0gbG93cCB2ZWM0IGNvbG9yOyIsICJ1bmlmb3JtIGxvd3Agc2FtcGxlcjJEIHNhbXBsZXJGcm9udDsiLCAidm9pZCBtYWluKHZvaWQpIHsiLCAiXHRnbF9GcmFnQ29sb3IgPSB0ZXh0dXJlMkQoc2FtcGxlckZyb250LCB2VGV4KSAqIGNvbG9yOyIsICJcdGdsX0ZyYWdEZXB0aEVYVCA9IChnbF9GcmFnQ29sb3IuYSA9PSAwLjAgPyAxLjAgOiBnbF9GcmFnQ29vcmQueik7IiwgIn0iXS5qb2luKCJcbiIpCiAgICAgICAgfQogICAgICAgIHN0YXRpYyBHZXRUZXh0dXJlRmlsbEZyYWdtZW50U2hhZGVyU291cmNlX1dlYkdMMigpIHsKICAgICAgICAgICAgcmV0dXJuIFsiI3ZlcnNpb24gMzAwIGVzIiwKICAgICAgICAgICAgICAgICJpbiBtZWRpdW1wIHZlYzIgdlRleDsiLCAib3V0IGxvd3AgdmVjNCBvdXRDb2xvcjsiLCAidW5pZm9ybSBsb3dwIHZlYzQgY29sb3I7IiwgInVuaWZvcm0gbG93cCBzYW1wbGVyMkQgc2FtcGxlckZyb250OyIsICJ2b2lkIG1haW4odm9pZCkgeyIsICJcdG91dENvbG9yID0gdGV4dHVyZShzYW1wbGVyRnJvbnQsIHZUZXgpICogY29sb3I7IiwgIlx0Z2xfRnJhZ0RlcHRoID0gKG91dENvbG9yLmEgPT0gMC4wID8gMS4wIDogZ2xfRnJhZ0Nvb3JkLnopOyIsICJ9IgogICAgICAgICAgICBdLmpvaW4oIlxuIikKICAgICAgICB9CiAgICAgICAgc3RhdGljIEdldFRpbGVtYXBGcmFnbWVudFNoYWRlclNvdXJjZV9XZWJHTDFfTm9GcmFnRGVwdGgoKSB7CiAgICAgICAgICAgIHJldHVybiBbIiNpZmRlZiBHTF9GUkFHTUVOVF9QUkVDSVNJT05fSElHSCIsICIjZGVmaW5lIGhpZ2htZWRwIGhpZ2hwIiwgIiNlbHNlIiwgIiNkZWZpbmUgaGlnaG1lZHAgbWVkaXVtcCIsICIjZW5kaWYiLCAidmFyeWluZyBoaWdobWVkcCB2ZWMyIHZUZXg7IiwgInVuaWZvcm0gbG93cCB2ZWM0IGNvbG9yOyIsICJ1bmlmb3JtIGxvd3Agc2FtcGxlcjJEIHNhbXBsZXJGcm9udDsiLAogICAgICAgICAgICAgICAgInVuaWZvcm0gaGlnaG1lZHAgdmVjMiBzcmNTdGFydDsiLCAidW5pZm9ybSBoaWdobWVkcCB2ZWMyIHBpeGVsU2l6ZTsiLCAidW5pZm9ybSBoaWdobWVkcCB2ZWMyIHRpbGVTaXplOyIsICJ1bmlmb3JtIGhpZ2htZWRwIHZlYzIgdGlsZVNwYWNpbmc7IiwgInZvaWQgbWFpbih2b2lkKSB7IiwgIlx0aGlnaG1lZHAgdmVjMiB0aWxlID0gZmxvb3IodlRleCk7IiwgIlx0aGlnaG1lZHAgdmVjMiB0ZXggPSBmcmFjdCh2VGV4KTsiLCAiXHRoaWdobWVkcCB2ZWMyIHRpbGVPcmlnaW4gPSBzcmNTdGFydCArIHRpbGUgKiAodGlsZVNpemUgKyB0aWxlU3BhY2luZyk7IiwgIlx0aGlnaG1lZHAgdmVjMiBsb3dlckJvdW5kID0gdGlsZU9yaWdpbiArIHBpeGVsU2l6ZSAvIDIuMDsiLCAiXHRoaWdobWVkcCB2ZWMyIHVwcGVyQm91bmQgPSB0aWxlT3JpZ2luICsgdGlsZVNpemUgLSBwaXhlbFNpemUgLyAyLjA7IiwgIlx0Z2xfRnJhZ0NvbG9yID0gdGV4dHVyZTJEKHNhbXBsZXJGcm9udCwgY2xhbXAodGV4LCBsb3dlckJvdW5kLCB1cHBlckJvdW5kKSwgLTE2LjApICogY29sb3I7IiwKICAgICAgICAgICAgICAgICJ9IgogICAgICAgICAgICBdLmpvaW4oIlxuIikKICAgICAgICB9CiAgICAgICAgc3RhdGljIEdldFRpbGVtYXBGcmFnbWVudFNoYWRlclNvdXJjZV9XZWJHTDFfRnJhZ0RlcHRoRVhUKCkgewogICAgICAgICAgICByZXR1cm4gWyIjZXh0ZW5zaW9uIEdMX0VYVF9mcmFnX2RlcHRoIDogZW5hYmxlIiwgIiNpZmRlZiBHTF9GUkFHTUVOVF9QUkVDSVNJT05fSElHSCIsICIjZGVmaW5lIGhpZ2htZWRwIGhpZ2hwIiwgIiNlbHNlIiwgIiNkZWZpbmUgaGlnaG1lZHAgbWVkaXVtcCIsICIjZW5kaWYiLCAidmFyeWluZyBoaWdobWVkcCB2ZWMyIHZUZXg7IiwgInVuaWZvcm0gbG93cCB2ZWM0IGNvbG9yOyIsICJ1bmlmb3JtIGxvd3Agc2FtcGxlcjJEIHNhbXBsZXJGcm9udDsiLCAidW5pZm9ybSBoaWdobWVkcCB2ZWMyIHNyY1N0YXJ0OyIsICJ1bmlmb3JtIGhpZ2htZWRwIHZlYzIgcGl4ZWxTaXplOyIsICJ1bmlmb3JtIGhpZ2htZWRwIHZlYzIgdGlsZVNpemU7IiwgInVuaWZvcm0gaGlnaG1lZHAgdmVjMiB0aWxlU3BhY2luZzsiLCAidm9pZCBtYWluKHZvaWQpIHsiLCAiXHRoaWdobWVkcCB2ZWMyIHRpbGUgPSBmbG9vcih2VGV4KTsiLAogICAgICAgICAgICAgICAgIlx0aGlnaG1lZHAgdmVjMiB0ZXggPSBmcmFjdCh2VGV4KTsiLCAiXHRoaWdobWVkcCB2ZWMyIHRpbGVPcmlnaW4gPSBzcmNTdGFydCArIHRpbGUgKiAodGlsZVNpemUgKyB0aWxlU3BhY2luZyk7IiwgIlx0aGlnaG1lZHAgdmVjMiBsb3dlckJvdW5kID0gdGlsZU9yaWdpbiArIHBpeGVsU2l6ZSAvIDIuMDsiLCAiXHRoaWdobWVkcCB2ZWMyIHVwcGVyQm91bmQgPSB0aWxlT3JpZ2luICsgdGlsZVNpemUgLSBwaXhlbFNpemUgLyAyLjA7IiwgIlx0Z2xfRnJhZ0NvbG9yID0gdGV4dHVyZTJEKHNhbXBsZXJGcm9udCwgY2xhbXAodGV4LCBsb3dlckJvdW5kLCB1cHBlckJvdW5kKSwgLTE2LjApICogY29sb3I7IiwgIlx0Z2xfRnJhZ0RlcHRoRVhUID0gKGdsX0ZyYWdDb2xvci5hID09IDAuMCA/IDEuMCA6IGdsX0ZyYWdDb29yZC56KTsiLCAifSIKICAgICAgICAgICAgXS5qb2luKCJcbiIpCiAgICAgICAgfQogICAgICAgIHN0YXRpYyBHZXRUaWxlbWFwRnJhZ21lbnRTaGFkZXJTb3VyY2VfV2ViR0wyKCkgewogICAgICAgICAgICByZXR1cm4gWyIjdmVyc2lvbiAzMDAgZXMiLCAiaW4gaGlnaHAgdmVjMiB2VGV4OyIsCiAgICAgICAgICAgICAgICAib3V0IGxvd3AgdmVjNCBvdXRDb2xvcjsiLCAidW5pZm9ybSBsb3dwIHZlYzQgY29sb3I7IiwgInVuaWZvcm0gbG93cCBzYW1wbGVyMkQgc2FtcGxlckZyb250OyIsICJ1bmlmb3JtIGhpZ2hwIHZlYzIgc3JjU3RhcnQ7IiwgInVuaWZvcm0gaGlnaHAgdmVjMiBwaXhlbFNpemU7IiwgInVuaWZvcm0gaGlnaHAgdmVjMiB0aWxlU2l6ZTsiLCAidW5pZm9ybSBoaWdocCB2ZWMyIHRpbGVTcGFjaW5nOyIsICJ2b2lkIG1haW4odm9pZCkgeyIsICJcdGhpZ2hwIHZlYzIgdGlsZSA9IGZsb29yKHZUZXgpOyIsICJcdGhpZ2hwIHZlYzIgdGV4ID0gZnJhY3QodlRleCk7IiwgIlx0aGlnaHAgdmVjMiB0aWxlT3JpZ2luID0gc3JjU3RhcnQgKyB0aWxlICogKHRpbGVTaXplICsgdGlsZVNwYWNpbmcpOyIsICJcdGhpZ2hwIHZlYzIgbG93ZXJCb3VuZCA9IHRpbGVPcmlnaW4gKyBwaXhlbFNpemUgLyAyLjA7IiwgIlx0aGlnaHAgdmVjMiB1cHBlckJvdW5kID0gdGlsZU9yaWdpbiArIHRpbGVTaXplIC0gcGl4ZWxTaXplIC8gMi4wOyIsCiAgICAgICAgICAgICAgICAiXHRvdXRDb2xvciA9IHRleHR1cmUoc2FtcGxlckZyb250LCBjbGFtcCh0ZXgsIGxvd2VyQm91bmQsIHVwcGVyQm91bmQpLCAtMTYuMCkgKiBjb2xvcjsiLCAiXHRnbF9GcmFnRGVwdGggPSAob3V0Q29sb3IuYSA9PSAwLjAgPyAxLjAgOiBnbF9GcmFnQ29vcmQueik7IiwgIn0iCiAgICAgICAgICAgIF0uam9pbigiXG4iKQogICAgICAgIH0KICAgICAgICBzdGF0aWMgR2V0VGlsZVJhbmRvbWl6YXRpb25GcmFnbWVudFNoYWRlclNvdXJjZSh3ZWJHTFZlciwgaGFzRnJhZ0RlcHRoRXh0LCB1c2VEZXJpdmF0aXZlcykgewogICAgICAgICAgICBsZXQgcHJlZml4ID0gIiI7CiAgICAgICAgICAgIGlmICh3ZWJHTFZlciA+PSAyKSBwcmVmaXggPSAiI3ZlcnNpb24gMzAwIGVzXG4iOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGlmIChoYXNGcmFnRGVwdGhFeHQpIHByZWZpeCA9ICIjZXh0ZW5zaW9uIEdMX0VYVF9mcmFnX2RlcHRoIDogZW5hYmxlXG4iOwogICAgICAgICAgICAgICAgaWYgKHVzZURlcml2YXRpdmVzKSB7CiAgICAgICAgICAgICAgICAgICAgcHJlZml4ICs9ICIjZXh0ZW5zaW9uIEdMX0VYVF9zaGFkZXJfdGV4dHVyZV9sb2QgOiBlbmFibGVcbiI7CiAgICAgICAgICAgICAgICAgICAgcHJlZml4ICs9ICIjZXh0ZW5zaW9uIEdMX09FU19zdGFuZGFyZF9kZXJpdmF0aXZlcyA6IGVuYWJsZVxuIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBwcmVmaXggKwogICAgICAgICAgICAgICAgYAojaWZkZWYgR0xfRlJBR01FTlRfUFJFQ0lTSU9OX0hJR0gKI2RlZmluZSBoaWdobWVkcCBoaWdocAojZWxzZQojZGVmaW5lIGhpZ2htZWRwIG1lZGl1bXAKI2VuZGlmCnByZWNpc2lvbiBoaWdobWVkcCBmbG9hdDsKJHt3ZWJHTFZlcj49Mj8iaW4iOiJ2YXJ5aW5nIn0gdmVjMiB2VGV4Owoke3dlYkdMVmVyPj0yPyJvdXQgbG93cCB2ZWM0IG91dENvbG9yOyI6IiJ9CnVuaWZvcm0gbG93cCB2ZWM0IGNvbG9yOwp1bmlmb3JtIGxvd3Agc2FtcGxlcjJEIHNhbXBsZXJGcm9udDsKdW5pZm9ybSB2ZWMyIHBpeGVsU2l6ZTsKCnVuaWZvcm0gdmVjMiB0aWxlU2l6ZTsKdW5pZm9ybSB2ZWMyIHRpbGVTcGFjaW5nOwp1bmlmb3JtIGZsb2F0IG91dGxpbmVUaGlja25lc3M7Cgpjb25zdCBmbG9hdCBQSSA9IDMuMTQxNTkyNjsKCmxvd3AgdmVjNCBjb3NwVmVjNChsb3dwIHZlYzQgYSwgbG93cCB2ZWM0IGIsIGZsb2F0IHgpCnsKCXJldHVybiAoYSArIGIgKyAoYSAtIGIpICogY29zKHggKiBQSSkpIC8gMi4wOwp9Cgp2ZWMzIHJhbmRWZWMzKHZlYzIgc2VlZCkKewoJcmV0dXJuIHZlYzMoZnJhY3Qoc2luKGRvdChzZWVkLnh5ICsgdmVjMigwLjEsIDAuMSksIHZlYzIoMTIuOTg5OCw3OC4yMzMpKSkgKiA0Mzc1OC41NDUzKSwKCQkJCWZyYWN0KHNpbihkb3Qoc2VlZC55eCArIHZlYzIoMC4xLCAwLjEpLCB2ZWMyKDEyLjk4OTgsLTc4LjIzMykpKSAqIDQzNzU4LjU0NTMpLAoJCQkJZnJhY3Qoc2luKGRvdChzZWVkLnh5ICsgdmVjMigwLjEsIDAuMSksIHZlYzIoLTEyLjk4OTgsLTc4LjIzMykpKSAqIDQzNzU4LjU0NTMpKTsKfQoKbG93cCB2ZWM0IHNhbXBsZVRpbGUodmVjMiB0aWxlLCB2ZWMyIHV2LCB2ZWMyIGRkeCwgdmVjMiBkZHkpCnsKCXZlYzIgcG9zUmFuZG9tID0gdGlsZVNpemU7CglmbG9hdCBhbmdsZVJhbmRvbSA9IG91dGxpbmVUaGlja25lc3M7CgkKCXZlYzMgcmFuZCA9IChyYW5kVmVjMyhmbG9vcih0aWxlICsgMC41KSkgLSAwLjUpICogMi4wOwoJCglmbG9hdCBhbmdsZSA9IGFuZ2xlUmFuZG9tICogcmFuZC56ICogUEk7CglmbG9hdCBzaW5fYSA9IHNpbihhbmdsZSk7CglmbG9hdCBjb3NfYSA9IGNvcyhhbmdsZSk7CglmbG9hdCBhc3BlY3QgPSBwaXhlbFNpemUueCAvIHBpeGVsU2l6ZS55OwoKCXZlYzIgbWlkID0gdGlsZSArIHZlYzIoMC41LCAwLjUpOwoJdmVjMiBkcCA9IHV2IC0gbWlkOwoJZHAueCAvPSBhc3BlY3Q7Cgl2ZWMyIHIgPSB2ZWMyKGRwLnggKiBjb3NfYSAtIGRwLnkgKiBzaW5fYSwKCQkJCSAgZHAueSAqIGNvc19hICsgZHAueCAqIHNpbl9hKTsKCXIueCAqPSBhc3BlY3Q7CgoJdmVjMiBwID0gbWlkICsgciArIChwb3NSYW5kb20gKiByYW5kLnh5IC8gMi4wKTsKCQoJJHt3ZWJHTFZlcj49Mj8icmV0dXJuIHRleHR1cmVHcmFkKHNhbXBsZXJGcm9udCwgcCwgZGR4LCBkZHkpOyI6IiJ9Cgkke3dlYkdMVmVyPDImJnVzZURlcml2YXRpdmVzPyJyZXR1cm4gdGV4dHVyZTJER3JhZEVYVChzYW1wbGVyRnJvbnQsIHAsIGRkeCwgZGR5KTsiOiIifQoJJHt3ZWJHTFZlcjwyJiYhdXNlRGVyaXZhdGl2ZXM/InJldHVybiB0ZXh0dXJlMkQoc2FtcGxlckZyb250LCBwKTsiOiIifQp9Cgp2b2lkIG1haW4odm9pZCkgewoJCgkke3dlYkdMVmVyPDI/Imxvd3AgdmVjNCBvdXRDb2xvcjsiOiIifQoJCglmbG9hdCBibGVuZE1hcmdpblggPSB0aWxlU3BhY2luZy54OwoJZmxvYXQgYmxlbmRNYXJnaW5ZID0gdGlsZVNwYWNpbmcueTsKCQoJdmVjMiB0aWxlID0gZmxvb3IodlRleCk7Cgl2ZWMyIHRleCA9IGZyYWN0KHZUZXgpOwoJdmVjMiBkZHggPSAke3dlYkdMVmVyPj0yfHx1c2VEZXJpdmF0aXZlcz8iZEZkeCh2VGV4KSI6InZlYzIoMC4wLCAwLjApIn07Cgl2ZWMyIGRkeSA9ICR7d2ViR0xWZXI+PTJ8fHVzZURlcml2YXRpdmVzPyJkRmR5KHZUZXgpIjoidmVjMigwLjAsIDAuMCkifTsKCQoJdmVjNCBjdXJUaWxlID0gc2FtcGxlVGlsZSh0aWxlLCB2VGV4LCBkZHgsIGRkeSk7CgkKCWJvb2wgaW5MZWZ0TWFyZ2luID0gKHRleC54IDwgYmxlbmRNYXJnaW5YKTsKCWJvb2wgaW5SaWdodE1hcmdpbiA9ICh0ZXgueCA+IDEuMCAtIGJsZW5kTWFyZ2luWCk7Cglib29sIGluVG9wTWFyZ2luID0gKHRleC55IDwgYmxlbmRNYXJnaW5ZKTsKCWJvb2wgaW5Cb3R0b21NYXJnaW4gPSAodGV4LnkgPiAxLjAgLSBibGVuZE1hcmdpblkpOwoJCglpZiAoaW5MZWZ0TWFyZ2luKQoJewoJCWxvd3AgdmVjNCBsZWZ0VGlsZSA9IHNhbXBsZVRpbGUodGlsZSArIHZlYzIoLTEuMCwgMC4wKSwgdlRleCwgZGR4LCBkZHkpOwoJCWZsb2F0IGxlZnRNaXggPSAodGV4LnggLyAoYmxlbmRNYXJnaW5YICogMi4wKSkgKyAwLjU7CgkJbG93cCB2ZWM0IGxlZnRNaXhlZFRpbGUgPSBjb3NwVmVjNChsZWZ0VGlsZSwgY3VyVGlsZSwgbGVmdE1peCk7CgkJCgkJaWYgKGluVG9wTWFyZ2luKQoJCXsKCQkJbG93cCB2ZWM0IHRvcFRpbGUgPSAgICAgc2FtcGxlVGlsZSh0aWxlICsgdmVjMigwLjAsICAtMS4wKSwgdlRleCwgZGR4LCBkZHkpOwoJCQlsb3dwIHZlYzQgdG9wTGVmdFRpbGUgPSBzYW1wbGVUaWxlKHRpbGUgKyB2ZWMyKC0xLjAsIC0xLjApLCB2VGV4LCBkZHgsIGRkeSk7CgkJCWxvd3AgdmVjNCB0b3BMZWZ0TWl4ZWRUaWxlID0gY29zcFZlYzQodG9wTGVmdFRpbGUsIHRvcFRpbGUsIGxlZnRNaXgpOwoJCQkKCQkJb3V0Q29sb3IgPSBjb3NwVmVjNCh0b3BMZWZ0TWl4ZWRUaWxlLCBsZWZ0TWl4ZWRUaWxlLCAodGV4LnkgLyAoYmxlbmRNYXJnaW5ZICogMi4wKSkgKyAwLjUpOwoJCX0KCQllbHNlIGlmIChpbkJvdHRvbU1hcmdpbikKCQl7CgkJCWxvd3AgdmVjNCBib3R0b21UaWxlID0gICAgIHNhbXBsZVRpbGUodGlsZSArIHZlYzIoMC4wLCAgMS4wKSwgdlRleCwgZGR4LCBkZHkpOwoJCQlsb3dwIHZlYzQgYm90dG9tTGVmdFRpbGUgPSBzYW1wbGVUaWxlKHRpbGUgKyB2ZWMyKC0xLjAsIDEuMCksIHZUZXgsIGRkeCwgZGR5KTsKCQkJbG93cCB2ZWM0IGJvdHRvbUxlZnRNaXhlZFRpbGUgPSBjb3NwVmVjNChib3R0b21MZWZ0VGlsZSwgYm90dG9tVGlsZSwgbGVmdE1peCk7CgkJCQoJCQlvdXRDb2xvciA9IGNvc3BWZWM0KGxlZnRNaXhlZFRpbGUsIGJvdHRvbUxlZnRNaXhlZFRpbGUsICh0ZXgueSAtICgxLjAgLSBibGVuZE1hcmdpblkpKSAvIChibGVuZE1hcmdpblkgKiAyLjApKTsKCQl9CgkJZWxzZQoJCXsKCQkJb3V0Q29sb3IgPSBsZWZ0TWl4ZWRUaWxlOwoJCX0KCX0KCWVsc2UgaWYgKGluUmlnaHRNYXJnaW4pCgl7CgkJbG93cCB2ZWM0IHJpZ2h0VGlsZSA9IHNhbXBsZVRpbGUodGlsZSArIHZlYzIoMS4wLCAwLjApLCB2VGV4LCBkZHgsIGRkeSk7CgkJZmxvYXQgcmlnaHRNaXggPSAodGV4LnggLSAoMS4wIC0gYmxlbmRNYXJnaW5YKSkgLyAoYmxlbmRNYXJnaW5YICogMi4wKTsKCQlsb3dwIHZlYzQgcmlnaHRNaXhlZFRpbGUgPSBjb3NwVmVjNChjdXJUaWxlLCByaWdodFRpbGUsIHJpZ2h0TWl4KTsKCQkKCQlpZiAoaW5Ub3BNYXJnaW4pCgkJewoJCQlsb3dwIHZlYzQgdG9wVGlsZSA9ICAgICAgc2FtcGxlVGlsZSh0aWxlICsgdmVjMigwLjAsIC0xLjApLCB2VGV4LCBkZHgsIGRkeSk7CgkJCWxvd3AgdmVjNCB0b3BSaWdodFRpbGUgPSBzYW1wbGVUaWxlKHRpbGUgKyB2ZWMyKDEuMCwgLTEuMCksIHZUZXgsIGRkeCwgZGR5KTsKCQkJbG93cCB2ZWM0IHRvcFJpZ2h0TWl4ZWRUaWxlID0gY29zcFZlYzQodG9wVGlsZSwgdG9wUmlnaHRUaWxlLCByaWdodE1peCk7CgkJCQoJCQlvdXRDb2xvciA9IGNvc3BWZWM0KHRvcFJpZ2h0TWl4ZWRUaWxlLCByaWdodE1peGVkVGlsZSwgKHRleC55IC8gKGJsZW5kTWFyZ2luWSAqIDIuMCkpICsgMC41KTsKCQl9CgkJZWxzZSBpZiAoaW5Cb3R0b21NYXJnaW4pCgkJewoJCQlsb3dwIHZlYzQgYm90dG9tVGlsZSA9ICAgICAgc2FtcGxlVGlsZSh0aWxlICsgdmVjMigwLjAsIDEuMCksIHZUZXgsIGRkeCwgZGR5KTsKCQkJbG93cCB2ZWM0IGJvdHRvbVJpZ2h0VGlsZSA9IHNhbXBsZVRpbGUodGlsZSArIHZlYzIoMS4wLCAxLjApLCB2VGV4LCBkZHgsIGRkeSk7CgkJCWxvd3AgdmVjNCBib3R0b21SaWdodE1peGVkVGlsZSA9IGNvc3BWZWM0KGJvdHRvbVRpbGUsIGJvdHRvbVJpZ2h0VGlsZSwgcmlnaHRNaXgpOwoJCQkKCQkJb3V0Q29sb3IgPSBjb3NwVmVjNChyaWdodE1peGVkVGlsZSwgYm90dG9tUmlnaHRNaXhlZFRpbGUsICh0ZXgueSAtICgxLjAgLSBibGVuZE1hcmdpblkpKSAvIChibGVuZE1hcmdpblkgKiAyLjApKTsKCQl9CgkJZWxzZQoJCXsKCQkJb3V0Q29sb3IgPSByaWdodE1peGVkVGlsZTsKCQl9Cgl9CgllbHNlIGlmIChpblRvcE1hcmdpbikKCXsKCQlsb3dwIHZlYzQgdG9wVGlsZSA9IHNhbXBsZVRpbGUodGlsZSArIHZlYzIoMC4wLCAtMS4wKSwgdlRleCwgZGR4LCBkZHkpOwoJCW91dENvbG9yID0gY29zcFZlYzQodG9wVGlsZSwgY3VyVGlsZSwgKHRleC55IC8gKGJsZW5kTWFyZ2luWSAqIDIuMCkpICsgMC41KTsKCX0KCWVsc2UgaWYgKGluQm90dG9tTWFyZ2luKQoJewoJCWxvd3AgdmVjNCBib3R0b21UaWxlID0gc2FtcGxlVGlsZSh0aWxlICsgdmVjMigwLjAsIDEuMCksIHZUZXgsIGRkeCwgZGR5KTsKCQlvdXRDb2xvciA9IGNvc3BWZWM0KGN1clRpbGUsIGJvdHRvbVRpbGUsICh0ZXgueSAtICgxLjAgLSBibGVuZE1hcmdpblkpKSAvIChibGVuZE1hcmdpblkgKiAyLjApKTsKCX0KCWVsc2UKCXsKCQlvdXRDb2xvciA9IGN1clRpbGU7Cgl9CgkKCW91dENvbG9yICo9IGNvbG9yOwoJJHt3ZWJHTFZlcjwyPyJnbF9GcmFnQ29sb3IgPSBvdXRDb2xvcjsiOiIifQoJJHt3ZWJHTFZlcj49Mj8iZ2xfRnJhZ0RlcHRoID0gKG91dENvbG9yLmEgPT0gMC4wID8gMS4wIDogZ2xfRnJhZ0Nvb3JkLnopOyI6IiJ9Cgkke3dlYkdMVmVyPDImJmhhc0ZyYWdEZXB0aEV4dD8iZ2xfRnJhZ0RlcHRoRVhUID0gKG91dENvbG9yLmEgPT0gMC4wID8gMS4wIDogZ2xfRnJhZ0Nvb3JkLnopOyI6IiJ9Cn0KYAogICAgICAgIH0KICAgICAgICBzdGF0aWMgR2V0UG9pbnRWZXJ0ZXhTaGFkZXJTb3VyY2VfV2ViR0wxKCkgewogICAgICAgICAgICByZXR1cm4gWyJhdHRyaWJ1dGUgdmVjNCBhUG9pbnRzOyIsICJ2YXJ5aW5nIGZsb2F0IHBvaW50T3BhY2l0eTsiLCAidW5pZm9ybSBmbG9hdCB6RWxldmF0aW9uOyIsICJ1bmlmb3JtIG1hdDQgbWF0UDsiLCAidW5pZm9ybSBtYXQ0IG1hdE1WOyIsICJ2b2lkIG1haW4odm9pZCkgeyIsICJcdGdsX1Bvc2l0aW9uID0gbWF0UCAqIG1hdE1WICogdmVjNChhUG9pbnRzLnh5LCB6RWxldmF0aW9uLCAxLjApOyIsICJcdGdsX1BvaW50U2l6ZSA9IGFQb2ludHMuejsiLCAiXHRwb2ludE9wYWNpdHkgPSBhUG9pbnRzLnc7IiwgIn0iXS5qb2luKCJcbiIpCiAgICAgICAgfQogICAgICAgIHN0YXRpYyBHZXRQb2ludFZlcnRleFNoYWRlclNvdXJjZV9XZWJHTDIoKSB7CiAgICAgICAgICAgIHJldHVybiBbIiN2ZXJzaW9uIDMwMCBlcyIsICJpbiB2ZWM0IGFQb2ludHM7IiwgIm91dCBmbG9hdCBwb2ludE9wYWNpdHk7IiwgInVuaWZvcm0gZmxvYXQgekVsZXZhdGlvbjsiLCAidW5pZm9ybSBtYXQ0IG1hdFA7IiwKICAgICAgICAgICAgICAgICJ1bmlmb3JtIG1hdDQgbWF0TVY7IiwgInZvaWQgbWFpbih2b2lkKSB7IiwgIlx0Z2xfUG9zaXRpb24gPSBtYXRQICogbWF0TVYgKiB2ZWM0KGFQb2ludHMueHksIHpFbGV2YXRpb24sIDEuMCk7IiwgIlx0Z2xfUG9pbnRTaXplID0gYVBvaW50cy56OyIsICJcdHBvaW50T3BhY2l0eSA9IGFQb2ludHMudzsiLCAifSIKICAgICAgICAgICAgXS5qb2luKCJcbiIpCiAgICAgICAgfQogICAgICAgIHN0YXRpYyBHZXRQb2ludEZyYWdtZW50U2hhZGVyU291cmNlX1dlYkdMMV9Ob0ZyYWdEZXB0aCgpIHsKICAgICAgICAgICAgcmV0dXJuIFsidW5pZm9ybSBsb3dwIHNhbXBsZXIyRCBzYW1wbGVyRnJvbnQ7IiwgInZhcnlpbmcgbG93cCBmbG9hdCBwb2ludE9wYWNpdHk7IiwgInVuaWZvcm0gbWVkaXVtcCB2ZWMyIHBvaW50VGV4U3RhcnQ7IiwgInVuaWZvcm0gbWVkaXVtcCB2ZWMyIHBvaW50VGV4RW5kOyIsICJ1bmlmb3JtIGxvd3AgdmVjNCBjb2xvcjsiLCAidm9pZCBtYWluKHZvaWQpIHsiLCAiXHRtZWRpdW1wIHZlYzIgcG9pbnRUZXhNaW4gPSBtaW4ocG9pbnRUZXhTdGFydCwgcG9pbnRUZXhFbmQpOyIsCiAgICAgICAgICAgICAgICAiXHRtZWRpdW1wIHZlYzIgcG9pbnRUZXhNYXggPSBtYXgocG9pbnRUZXhTdGFydCwgcG9pbnRUZXhFbmQpOyIsICJcdG1lZGl1bXAgdmVjMiBwb2ludENvb3JkID0gKHBvaW50VGV4RW5kLnggPiBwb2ludFRleFN0YXJ0LnggPyBnbF9Qb2ludENvb3JkIDogdmVjMigxLjAgLSBnbF9Qb2ludENvb3JkLnksIGdsX1BvaW50Q29vcmQueCkpOyIsICJcdGdsX0ZyYWdDb2xvciA9IHRleHR1cmUyRChzYW1wbGVyRnJvbnQsIG1peChwb2ludFRleE1pbiwgcG9pbnRUZXhNYXgsIHBvaW50Q29vcmQpKSAqIGNvbG9yICogcG9pbnRPcGFjaXR5OyIsICJ9IgogICAgICAgICAgICBdLmpvaW4oIlxuIikKICAgICAgICB9CiAgICAgICAgc3RhdGljIEdldFBvaW50RnJhZ21lbnRTaGFkZXJTb3VyY2VfV2ViR0wxX0ZyYWdEZXB0aEVYVCgpIHsKICAgICAgICAgICAgcmV0dXJuIFsiI2V4dGVuc2lvbiBHTF9FWFRfZnJhZ19kZXB0aCA6IGVuYWJsZSIsICJ1bmlmb3JtIGxvd3Agc2FtcGxlcjJEIHNhbXBsZXJGcm9udDsiLCAidmFyeWluZyBsb3dwIGZsb2F0IHBvaW50T3BhY2l0eTsiLCAidW5pZm9ybSBtZWRpdW1wIHZlYzIgcG9pbnRUZXhTdGFydDsiLAogICAgICAgICAgICAgICAgInVuaWZvcm0gbWVkaXVtcCB2ZWMyIHBvaW50VGV4RW5kOyIsICJ1bmlmb3JtIGxvd3AgdmVjNCBjb2xvcjsiLCAidm9pZCBtYWluKHZvaWQpIHsiLCAiXHRtZWRpdW1wIHZlYzIgcG9pbnRUZXhNaW4gPSBtaW4ocG9pbnRUZXhTdGFydCwgcG9pbnRUZXhFbmQpOyIsICJcdG1lZGl1bXAgdmVjMiBwb2ludFRleE1heCA9IG1heChwb2ludFRleFN0YXJ0LCBwb2ludFRleEVuZCk7IiwgIlx0bWVkaXVtcCB2ZWMyIHBvaW50Q29vcmQgPSAocG9pbnRUZXhFbmQueCA+IHBvaW50VGV4U3RhcnQueCA/IGdsX1BvaW50Q29vcmQgOiB2ZWMyKDEuMCAtIGdsX1BvaW50Q29vcmQueSwgZ2xfUG9pbnRDb29yZC54KSk7IiwgIlx0Z2xfRnJhZ0NvbG9yID0gdGV4dHVyZTJEKHNhbXBsZXJGcm9udCwgbWl4KHBvaW50VGV4TWluLCBwb2ludFRleE1heCwgcG9pbnRDb29yZCkpICogY29sb3IgKiBwb2ludE9wYWNpdHk7IiwgIlx0Z2xfRnJhZ0RlcHRoRVhUID0gKGdsX0ZyYWdDb2xvci5hID09IDAuMCA/IDEuMCA6IGdsX0ZyYWdDb29yZC56KTsiLAogICAgICAgICAgICAgICAgIn0iCiAgICAgICAgICAgIF0uam9pbigiXG4iKQogICAgICAgIH0KICAgICAgICBzdGF0aWMgR2V0UG9pbnRGcmFnbWVudFNoYWRlclNvdXJjZV9XZWJHTDIoKSB7CiAgICAgICAgICAgIHJldHVybiBbIiN2ZXJzaW9uIDMwMCBlcyIsICJ1bmlmb3JtIGxvd3Agc2FtcGxlcjJEIHNhbXBsZXJGcm9udDsiLCAiaW4gbG93cCBmbG9hdCBwb2ludE9wYWNpdHk7IiwgInVuaWZvcm0gbWVkaXVtcCB2ZWMyIHBvaW50VGV4U3RhcnQ7IiwgInVuaWZvcm0gbWVkaXVtcCB2ZWMyIHBvaW50VGV4RW5kOyIsICJ1bmlmb3JtIGxvd3AgdmVjNCBjb2xvcjsiLCAib3V0IGxvd3AgdmVjNCBvdXRDb2xvcjsiLCAidm9pZCBtYWluKHZvaWQpIHsiLCAiXHRtZWRpdW1wIHZlYzIgcG9pbnRUZXhNaW4gPSBtaW4ocG9pbnRUZXhTdGFydCwgcG9pbnRUZXhFbmQpOyIsICJcdG1lZGl1bXAgdmVjMiBwb2ludFRleE1heCA9IG1heChwb2ludFRleFN0YXJ0LCBwb2ludFRleEVuZCk7IiwgIlx0bWVkaXVtcCB2ZWMyIHBvaW50Q29vcmQgPSAocG9pbnRUZXhFbmQueCA+IHBvaW50VGV4U3RhcnQueCA/IGdsX1BvaW50Q29vcmQgOiB2ZWMyKDEuMCAtIGdsX1BvaW50Q29vcmQueSwgZ2xfUG9pbnRDb29yZC54KSk7IiwKICAgICAgICAgICAgICAgICJcdG91dENvbG9yID0gdGV4dHVyZShzYW1wbGVyRnJvbnQsIG1peChwb2ludFRleE1pbiwgcG9pbnRUZXhNYXgsIHBvaW50Q29vcmQpKSAqIGNvbG9yICogcG9pbnRPcGFjaXR5OyIsICJcdGdsX0ZyYWdEZXB0aCA9IChvdXRDb2xvci5hID09IDAuMCA/IDEuMCA6IGdsX0ZyYWdDb29yZC56KTsiLCAifSIKICAgICAgICAgICAgXS5qb2luKCJcbiIpCiAgICAgICAgfQogICAgICAgIHN0YXRpYyBHZXRDb2xvckZpbGxGcmFnbWVudFNoYWRlclNvdXJjZSgpIHsKICAgICAgICAgICAgcmV0dXJuIFsidW5pZm9ybSBsb3dwIHZlYzQgY29sb3I7IiwgInZvaWQgbWFpbih2b2lkKSB7IiwgIlx0Z2xfRnJhZ0NvbG9yID0gY29sb3I7IiwgIn0iXS5qb2luKCJcbiIpCiAgICAgICAgfQogICAgICAgIHN0YXRpYyBHZXRMaW5lYXJHcmFkaWVudEZpbGxGcmFnbWVudFNoYWRlclNvdXJjZSgpIHsKICAgICAgICAgICAgcmV0dXJuIFsicHJlY2lzaW9uIGxvd3AgZmxvYXQ7IiwgInZhcnlpbmcgbWVkaXVtcCB2ZWMyIHZUZXg7IiwgInVuaWZvcm0gdmVjNCBjb2xvcjsiLCAidW5pZm9ybSB2ZWM0IGNvbG9yMl87IiwgInZlYzMgZnJvbUxpbmVhcih2ZWMzIGxpbmVhclJHQikiLAogICAgICAgICAgICAgICAgInsiLCAiXHRidmVjMyBjdXRvZmYgPSBsZXNzVGhhbihsaW5lYXJSR0IsIHZlYzMoMC4wMDMxMzA4KSk7IiwgIlx0dmVjMyBoaWdoZXIgPSB2ZWMzKDEuMDU1KSAqIHBvdyhhYnMobGluZWFyUkdCKSwgdmVjMygxLjAvMi40KSkgLSB2ZWMzKDAuMDU1KTsiLCAiXHR2ZWMzIGxvd2VyID0gbGluZWFyUkdCICogdmVjMygxMi45Mik7IiwgIlx0cmV0dXJuIG1peChoaWdoZXIsIGxvd2VyLCB2ZWMzKGN1dG9mZikpOyIsICJ9IiwgInZlYzMgdG9MaW5lYXIodmVjMyBzUkdCKSIsICJ7IiwgIlx0YnZlYzMgY3V0b2ZmID0gbGVzc1RoYW4oc1JHQiwgdmVjMygwLjA0MDQ1KSk7IiwgIlx0dmVjMyBoaWdoZXIgPSBwb3coYWJzKChzUkdCICsgdmVjMygwLjA1NSkpL3ZlYzMoMS4wNTUpKSwgdmVjMygyLjQpKTsiLCAiXHR2ZWMzIGxvd2VyID0gc1JHQi92ZWMzKDEyLjkyKTsiLCAiXHRyZXR1cm4gbWl4KGhpZ2hlciwgbG93ZXIsIHZlYzMoY3V0b2ZmKSk7IiwgIn0iLCAidm9pZCBtYWluKHZvaWQpIHsiLCAiXHR2ZWMzIGxpbmVhckdyYWQgPSBtaXgodG9MaW5lYXIoY29sb3IucmdiKSwgdG9MaW5lYXIoY29sb3IyXy5yZ2IpLCB2VGV4LngpOyIsCiAgICAgICAgICAgICAgICAiXHRmbG9hdCBhID0gbWl4KGNvbG9yLmEsIGNvbG9yMl8uYSwgdlRleC54KTsiLCAiXHRnbF9GcmFnQ29sb3IgPSB2ZWM0KGZyb21MaW5lYXIobGluZWFyR3JhZCkgKiBhLCBhKTsiLCAifSIKICAgICAgICAgICAgXS5qb2luKCJcbiIpCiAgICAgICAgfQogICAgICAgIHN0YXRpYyBHZXRQZW51bWJyYUZpbGxGcmFnbWVudFNoYWRlclNvdXJjZSgpIHsKICAgICAgICAgICAgcmV0dXJuIFtgI2lmZGVmIEdMX0ZSQUdNRU5UX1BSRUNJU0lPTl9ISUdIYCwgYCNkZWZpbmUgaGlnaG1lZHAgaGlnaHBgLCBgI2Vsc2VgLCBgI2RlZmluZSBoaWdobWVkcCBtZWRpdW1wYCwgYCNlbmRpZmAsIGBwcmVjaXNpb24gbG93cCBmbG9hdDtgLCBgdmFyeWluZyBoaWdobWVkcCB2ZWMyIHZUZXg7YCwgYHVuaWZvcm0gdmVjNCBjb2xvcjtgLCBgdm9pZCBtYWluKHZvaWQpIHtgLCBgCWhpZ2htZWRwIGZsb2F0IGdyYWQgPSB2VGV4LnggLyAoMS4wIC0gdlRleC55KTtgLCBgCWdsX0ZyYWdDb2xvciA9IGNvbG9yICogKDEuMCAtIChjb3MoZ3JhZCAqIDMuMTQxNTkyNjUzNTg5NzkzKSArIDEuMCkgLyAyLjApO2AsCiAgICAgICAgICAgICAgICBgfWAKICAgICAgICAgICAgXS5qb2luKCJcbiIpCiAgICAgICAgfQogICAgICAgIHN0YXRpYyBHZXRTbW9vdGhMaW5lRmlsbEZyYWdtZW50U2hhZGVyU291cmNlKCkgewogICAgICAgICAgICByZXR1cm4gWyJ2YXJ5aW5nIG1lZGl1bXAgdmVjMiB2VGV4OyIsICJ1bmlmb3JtIGxvd3AgdmVjNCBjb2xvcjsiLCAidm9pZCBtYWluKHZvaWQpIHsiLCAiXHRsb3dwIGZsb2F0IGYgPSAxLjAgLSBhYnModlRleC55IC0gMC41KSAqIDIuMDsiLCAiXHRnbF9GcmFnQ29sb3IgPSBjb2xvciAqIGY7IiwgIn0iXS5qb2luKCJcbiIpCiAgICAgICAgfQogICAgICAgIHN0YXRpYyBHZXRIYXJkRWxsaXBzZUZpbGxGcmFnbWVudFNoYWRlclNvdXJjZSgpIHsKICAgICAgICAgICAgcmV0dXJuIFsidmFyeWluZyBtZWRpdW1wIHZlYzIgdlRleDsiLCAidW5pZm9ybSBsb3dwIHZlYzQgY29sb3I7IiwgInZvaWQgbWFpbih2b2lkKSB7IiwgIlx0bWVkaXVtcCB2ZWMyIGRpZmYgPSB2VGV4IC0gdmVjMigwLjUsIDAuNSk7IiwgIlx0bWVkaXVtcCB2ZWMyIGRpZmZTcSA9IGRpZmYgKiBkaWZmOyIsICJcdG1lZGl1bXAgZmxvYXQgZiA9IHN0ZXAoZGlmZlNxLnggKyBkaWZmU3EueSwgMC4yNSk7IiwKICAgICAgICAgICAgICAgICJcdGdsX0ZyYWdDb2xvciA9IGNvbG9yICogZjsiLCAifSIKICAgICAgICAgICAgXS5qb2luKCJcbiIpCiAgICAgICAgfQogICAgICAgIHN0YXRpYyBHZXRIYXJkRWxsaXBzZU91dGxpbmVGcmFnbWVudFNoYWRlclNvdXJjZSgpIHsKICAgICAgICAgICAgcmV0dXJuIFsidmFyeWluZyBtZWRpdW1wIHZlYzIgdlRleDsiLCAidW5pZm9ybSBsb3dwIHZlYzQgY29sb3I7IiwgInVuaWZvcm0gbWVkaXVtcCB2ZWMyIHBpeGVsU2l6ZTsiLCAidW5pZm9ybSBtZWRpdW1wIGZsb2F0IG91dGxpbmVUaGlja25lc3M7IiwgInZvaWQgbWFpbih2b2lkKSB7IiwgIlx0bWVkaXVtcCB2ZWMyIGRpZmYgPSB2VGV4IC0gdmVjMigwLjUsIDAuNSk7IiwgIlx0bWVkaXVtcCB2ZWMyIGRpZmZTcSA9IGRpZmYgKiBkaWZmOyIsICJcdG1lZGl1bXAgZmxvYXQgZGlzdFNxID0gZGlmZlNxLnggKyBkaWZmU3EueTsiLCAiXHRtZWRpdW1wIHZlYzIgbm9ybSA9IG5vcm1hbGl6ZShkaWZmKTsiLCAiXHRtZWRpdW1wIHZlYzIgaGFsZk5vcm0gPSBub3JtICogMC41OyIsICJcdG1lZGl1bXAgZmxvYXQgaW5uZXJGID0gc3RlcChkaXN0U3EsIDAuMjUpOyIsCiAgICAgICAgICAgICAgICAiXHRtZWRpdW1wIHZlYzIgaW5uZXJFZGdlID0gaGFsZk5vcm0gLSBwaXhlbFNpemUgKiBub3JtICogb3V0bGluZVRoaWNrbmVzczsiLCAiXHRtZWRpdW1wIHZlYzIgaW5uZXJFZGdlU3EgPSBpbm5lckVkZ2UgKiBpbm5lckVkZ2U7IiwgIlx0bWVkaXVtcCBmbG9hdCBvdXRlckYgPSBzdGVwKGlubmVyRWRnZVNxLnggKyBpbm5lckVkZ2VTcS55LCBkaXN0U3EpOyIsICJcdGdsX0ZyYWdDb2xvciA9IGNvbG9yICogaW5uZXJGICogb3V0ZXJGOyIsICJ9IgogICAgICAgICAgICBdLmpvaW4oIlxuIikKICAgICAgICB9CiAgICAgICAgc3RhdGljIEdldFNtb290aEVsbGlwc2VGaWxsRnJhZ21lbnRTaGFkZXJTb3VyY2UoKSB7CiAgICAgICAgICAgIHJldHVybiBbInZhcnlpbmcgbWVkaXVtcCB2ZWMyIHZUZXg7IiwgInVuaWZvcm0gbG93cCB2ZWM0IGNvbG9yOyIsICJ1bmlmb3JtIG1lZGl1bXAgdmVjMiBwaXhlbFNpemU7IiwgInZvaWQgbWFpbih2b2lkKSB7IiwgIlx0bWVkaXVtcCB2ZWMyIGRpZmYgPSB2VGV4IC0gdmVjMigwLjUsIDAuNSk7IiwgIlx0bWVkaXVtcCB2ZWMyIGRpZmZTcSA9IGRpZmYgKiBkaWZmOyIsCiAgICAgICAgICAgICAgICAiXHRtZWRpdW1wIHZlYzIgbm9ybSA9IG5vcm1hbGl6ZShkaWZmKTsiLCAiXHRtZWRpdW1wIHZlYzIgaGFsZk5vcm0gPSBub3JtICogMC41OyIsICJcdG1lZGl1bXAgdmVjMiBoYWxmTm9ybVNxID0gaGFsZk5vcm0gKiBoYWxmTm9ybTsiLCAiXHRtZWRpdW1wIHZlYzIgaW5uZXJFZGdlID0gaGFsZk5vcm0gLSBwaXhlbFNpemUgKiBub3JtOyIsICJcdG1lZGl1bXAgdmVjMiBpbm5lckVkZ2VTcSA9IGlubmVyRWRnZSAqIGlubmVyRWRnZTsiLCAiXHRtZWRpdW1wIGZsb2F0IGYgPSBzbW9vdGhzdGVwKGhhbGZOb3JtU3EueCArIGhhbGZOb3JtU3EueSwgaW5uZXJFZGdlU3EueCArIGlubmVyRWRnZVNxLnksIGRpZmZTcS54ICsgZGlmZlNxLnkpOyIsICJcdGdsX0ZyYWdDb2xvciA9IGNvbG9yICogZjsiLCAifSIKICAgICAgICAgICAgXS5qb2luKCJcbiIpCiAgICAgICAgfQogICAgICAgIHN0YXRpYyBHZXRTbW9vdGhFbGxpcHNlT3V0bGluZUZyYWdtZW50U2hhZGVyU291cmNlKCkgewogICAgICAgICAgICByZXR1cm4gWyJ2YXJ5aW5nIG1lZGl1bXAgdmVjMiB2VGV4OyIsICJ1bmlmb3JtIGxvd3AgdmVjNCBjb2xvcjsiLAogICAgICAgICAgICAgICAgInVuaWZvcm0gbWVkaXVtcCB2ZWMyIHBpeGVsU2l6ZTsiLCAidW5pZm9ybSBtZWRpdW1wIGZsb2F0IG91dGxpbmVUaGlja25lc3M7IiwgInZvaWQgbWFpbih2b2lkKSB7IiwgIlx0bWVkaXVtcCB2ZWMyIGRpZmYgPSB2VGV4IC0gdmVjMigwLjUsIDAuNSk7IiwgIlx0bWVkaXVtcCB2ZWMyIGRpZmZTcSA9IGRpZmYgKiBkaWZmOyIsICJcdG1lZGl1bXAgZmxvYXQgZGlzdFNxID0gZGlmZlNxLnggKyBkaWZmU3EueTsiLCAiXHRtZWRpdW1wIHZlYzIgbm9ybSA9IG5vcm1hbGl6ZShkaWZmKTsiLCAiXHRtZWRpdW1wIHZlYzIgaGFsZk5vcm0gPSBub3JtICogMC41OyIsICJcdG1lZGl1bXAgdmVjMiBoYWxmTm9ybVNxID0gaGFsZk5vcm0gKiBoYWxmTm9ybTsiLCAiXHRtZWRpdW1wIHZlYzIgcHhOb3JtID0gcGl4ZWxTaXplICogbm9ybTsiLCAiXHRtZWRpdW1wIHZlYzIgaW5uZXJFZGdlMSA9IGhhbGZOb3JtIC0gcHhOb3JtOyIsICJcdG1lZGl1bXAgdmVjMiBpbm5lckVkZ2UxU3EgPSBpbm5lckVkZ2UxICogaW5uZXJFZGdlMTsiLAogICAgICAgICAgICAgICAgIlx0bWVkaXVtcCBmbG9hdCBpbm5lckYgPSBzbW9vdGhzdGVwKGhhbGZOb3JtU3EueCArIGhhbGZOb3JtU3EueSwgaW5uZXJFZGdlMVNxLnggKyBpbm5lckVkZ2UxU3EueSwgZGlzdFNxKTsiLCAiXHRtZWRpdW1wIHZlYzIgaW5uZXJFZGdlMiA9IGhhbGZOb3JtIC0gcHhOb3JtICogb3V0bGluZVRoaWNrbmVzczsiLCAiXHRtZWRpdW1wIHZlYzIgaW5uZXJFZGdlMlNxID0gaW5uZXJFZGdlMiAqIGlubmVyRWRnZTI7IiwgIlx0bWVkaXVtcCB2ZWMyIGlubmVyRWRnZTMgPSBoYWxmTm9ybSAtIHB4Tm9ybSAqIChvdXRsaW5lVGhpY2tuZXNzICsgMS4wKTsiLCAiXHRtZWRpdW1wIHZlYzIgaW5uZXJFZGdlM1NxID0gaW5uZXJFZGdlMyAqIGlubmVyRWRnZTM7IiwgIlx0bWVkaXVtcCBmbG9hdCBvdXRlckYgPSBzbW9vdGhzdGVwKGlubmVyRWRnZTNTcS54ICsgaW5uZXJFZGdlM1NxLnksIGlubmVyRWRnZTJTcS54ICsgaW5uZXJFZGdlMlNxLnksIGRpc3RTcSk7IiwgIlx0Z2xfRnJhZ0NvbG9yID0gY29sb3IgKiBpbm5lckYgKiBvdXRlckY7IiwKICAgICAgICAgICAgICAgICJ9IgogICAgICAgICAgICBdLmpvaW4oIlxuIikKICAgICAgICB9CiAgICB9OwoKfQoKLy8gLi4vbGliL2dmeC93ZWJnbC9zaGFkZXJVbmlmb3JtLmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIGNvbnN0IGdsTWF0cml4ID0gc2VsZi5nbE1hdHJpeDsKICAgIGNvbnN0IG1hdDQgPSBnbE1hdHJpeC5tYXQ0OwogICAgY29uc3QgVFlQRV9TSVpFUyA9IG5ldyBNYXAoWwogICAgICAgIFsiZmxvYXQiLCAxXSwKICAgICAgICBbInBlcmNlbnQiLCAxXSwKICAgICAgICBbInNhbXBsZXIiLCAxXSwKICAgICAgICBbInZlYzIiLCAyXSwKICAgICAgICBbInZlYzMiLCAzXSwKICAgICAgICBbImNvbG9yIiwgM10sCiAgICAgICAgWyJ2ZWM0IiwgNF0sCiAgICAgICAgWyJtYXQ0IiwgMTZdCiAgICBdKTsKICAgIEMzLkdmeC5XZWJHTFNoYWRlclVuaWZvcm0gPSBjbGFzcyBXZWJHTFNoYWRlclVuaWZvcm0gewogICAgICAgIGNvbnN0cnVjdG9yKG93bmVyLCBuYW1lLCB0eXBlKSB7CiAgICAgICAgICAgIGlmICghVFlQRV9TSVpFUy5oYXModHlwZSkpIHRocm93IG5ldyBFcnJvcigiaW52YWxpZCB1bmlmb3JtIHR5cGUiKTsKICAgICAgICAgICAgdGhpcy5fb3duZXIgPSBvd25lcjsKICAgICAgICAgICAgdGhpcy5fZ2wgPSB0aGlzLl9vd25lci5HZXRXZWJHTENvbnRleHQoKTsKICAgICAgICAgICAgdGhpcy5fbmFtZSA9IG5hbWU7CiAgICAgICAgICAgIHRoaXMuX3R5cGUgPSB0eXBlOwogICAgICAgICAgICB0aGlzLl9pc0NvbG9yVHlwZSA9IHRoaXMuX3R5cGUgPT09ICJjb2xvciI7CiAgICAgICAgICAgIHRoaXMuX2xvY2F0aW9uID0gdGhpcy5fZ2wuZ2V0VW5pZm9ybUxvY2F0aW9uKHRoaXMuX293bmVyLkdldFNoYWRlclByb2dyYW0oKSwgbmFtZSk7CiAgICAgICAgICAgIHRoaXMuX2lzVXNlZCA9ICEhdGhpcy5fbG9jYXRpb247CiAgICAgICAgICAgIGNvbnN0IHR5cGVTaXplID0gVFlQRV9TSVpFUy5nZXQodHlwZSk7CiAgICAgICAgICAgIHRoaXMuX2xhc3RWYWx1ZSA9IG5ldyBGbG9hdDMyQXJyYXkodHlwZVNpemUpOwogICAgICAgICAgICB0aGlzLl9sYXN0QmF0Y2hWYWx1ZSA9IG5ldyBGbG9hdDMyQXJyYXkodHlwZVNpemUpCiAgICAgICAgfQogICAgICAgIFJlbGVhc2UoKSB7CiAgICAgICAgICAgIHRoaXMuX293bmVyID0KICAgICAgICAgICAgICAgIG51bGw7CiAgICAgICAgICAgIHRoaXMuX2dsID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fbG9jYXRpb24gPSBudWxsCiAgICAgICAgfQogICAgICAgIElzVXNlZCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2lzVXNlZAogICAgICAgIH0KICAgICAgICBHZXRUeXBlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fdHlwZQogICAgICAgIH0KICAgICAgICBJc0NvbG9yVHlwZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2lzQ29sb3JUeXBlCiAgICAgICAgfQogICAgICAgIEluaXQxZih2MCkgewogICAgICAgICAgICBpZiAoIXRoaXMuSXNVc2VkKCkpIHJldHVybjsKICAgICAgICAgICAgdGhpcy5fbGFzdFZhbHVlWzBdID0gdjA7CiAgICAgICAgICAgIHRoaXMuX2xhc3RCYXRjaFZhbHVlLnNldCh0aGlzLl9sYXN0VmFsdWUpOwogICAgICAgICAgICB0aGlzLl9nbC51bmlmb3JtMWYodGhpcy5fbG9jYXRpb24sIHYwKQogICAgICAgIH0KICAgICAgICBJbml0MWkodjApIHsKICAgICAgICAgICAgaWYgKCF0aGlzLklzVXNlZCgpKSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuX2xhc3RWYWx1ZVswXSA9IHYwOwogICAgICAgICAgICB0aGlzLl9sYXN0QmF0Y2hWYWx1ZS5zZXQodGhpcy5fbGFzdFZhbHVlKTsKICAgICAgICAgICAgdGhpcy5fZ2wudW5pZm9ybTFpKHRoaXMuX2xvY2F0aW9uLCB2MCkKICAgICAgICB9CiAgICAgICAgSW5pdDJmKHYwLCB2MSkgewogICAgICAgICAgICBpZiAoIXRoaXMuSXNVc2VkKCkpIHJldHVybjsKICAgICAgICAgICAgdGhpcy5fbGFzdFZhbHVlWzBdID0gdjA7CiAgICAgICAgICAgIHRoaXMuX2xhc3RWYWx1ZVsxXSA9IHYxOwogICAgICAgICAgICB0aGlzLl9sYXN0QmF0Y2hWYWx1ZS5zZXQodGhpcy5fbGFzdFZhbHVlKTsKICAgICAgICAgICAgdGhpcy5fZ2wudW5pZm9ybTJmKHRoaXMuX2xvY2F0aW9uLCB2MCwgdjEpCiAgICAgICAgfQogICAgICAgIEluaXQzZih2MCwgdjEsIHYyKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5Jc1VzZWQoKSkgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl9sYXN0VmFsdWVbMF0gPSB2MDsKICAgICAgICAgICAgdGhpcy5fbGFzdFZhbHVlWzFdID0gdjE7CiAgICAgICAgICAgIHRoaXMuX2xhc3RWYWx1ZVsyXSA9IHYyOwogICAgICAgICAgICB0aGlzLl9sYXN0QmF0Y2hWYWx1ZS5zZXQodGhpcy5fbGFzdFZhbHVlKTsKICAgICAgICAgICAgdGhpcy5fZ2wudW5pZm9ybTNmKHRoaXMuX2xvY2F0aW9uLCB2MCwgdjEsIHYyKQogICAgICAgIH0KICAgICAgICBJbml0NGYodjAsIHYxLCB2MiwgdjMpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLklzVXNlZCgpKSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuX2xhc3RWYWx1ZVswXSA9IHYwOwogICAgICAgICAgICB0aGlzLl9sYXN0VmFsdWVbMV0gPSB2MTsKICAgICAgICAgICAgdGhpcy5fbGFzdFZhbHVlWzJdID0gdjI7CiAgICAgICAgICAgIHRoaXMuX2xhc3RWYWx1ZVszXSA9IHYzOwogICAgICAgICAgICB0aGlzLl9sYXN0QmF0Y2hWYWx1ZS5zZXQodGhpcy5fbGFzdFZhbHVlKTsKICAgICAgICAgICAgdGhpcy5fZ2wudW5pZm9ybTRmKHRoaXMuX2xvY2F0aW9uLCB2MCwgdjEsIHYyLCB2MykKICAgICAgICB9CiAgICAgICAgVXBkYXRlMWYodjApIHsKICAgICAgICAgICAgdjAgPSBNYXRoLmZyb3VuZCh2MCk7CiAgICAgICAgICAgIGNvbnN0IGxhc3RWYWx1ZSA9CiAgICAgICAgICAgICAgICB0aGlzLl9sYXN0VmFsdWU7CiAgICAgICAgICAgIGlmIChsYXN0VmFsdWVbMF0gPT09IHYwKSByZXR1cm47CiAgICAgICAgICAgIGxhc3RWYWx1ZVswXSA9IHYwOwogICAgICAgICAgICB0aGlzLl9nbC51bmlmb3JtMWYodGhpcy5fbG9jYXRpb24sIHYwKQogICAgICAgIH0KICAgICAgICBVcGRhdGUxaSh2MCkgewogICAgICAgICAgICBjb25zdCBsYXN0VmFsdWUgPSB0aGlzLl9sYXN0VmFsdWU7CiAgICAgICAgICAgIGlmIChsYXN0VmFsdWVbMF0gPT09IHYwKSByZXR1cm47CiAgICAgICAgICAgIGxhc3RWYWx1ZVswXSA9IHYwOwogICAgICAgICAgICB0aGlzLl9nbC51bmlmb3JtMWkodGhpcy5fbG9jYXRpb24sIHYwKQogICAgICAgIH0KICAgICAgICBVcGRhdGUyZih2MCwgdjEpIHsKICAgICAgICAgICAgdjAgPSBNYXRoLmZyb3VuZCh2MCk7CiAgICAgICAgICAgIHYxID0gTWF0aC5mcm91bmQodjEpOwogICAgICAgICAgICBjb25zdCBsYXN0VmFsdWUgPSB0aGlzLl9sYXN0VmFsdWU7CiAgICAgICAgICAgIGlmIChsYXN0VmFsdWVbMF0gPT09IHYwICYmIGxhc3RWYWx1ZVsxXSA9PT0gdjEpIHJldHVybjsKICAgICAgICAgICAgbGFzdFZhbHVlWzBdID0gdjA7CiAgICAgICAgICAgIGxhc3RWYWx1ZVsxXSA9IHYxOwogICAgICAgICAgICB0aGlzLl9nbC51bmlmb3JtMmYodGhpcy5fbG9jYXRpb24sIHYwLCB2MSkKICAgICAgICB9CiAgICAgICAgVXBkYXRlM2YodjAsIHYxLCB2MikgewogICAgICAgICAgICB2MCA9IE1hdGguZnJvdW5kKHYwKTsKICAgICAgICAgICAgdjEgPSBNYXRoLmZyb3VuZCh2MSk7CiAgICAgICAgICAgIHYyID0gTWF0aC5mcm91bmQodjIpOwogICAgICAgICAgICBjb25zdCBsYXN0VmFsdWUgPSB0aGlzLl9sYXN0VmFsdWU7CiAgICAgICAgICAgIGlmIChsYXN0VmFsdWVbMF0gPT09IHYwICYmIGxhc3RWYWx1ZVsxXSA9PT0gdjEgJiYgbGFzdFZhbHVlWzJdID09PSB2MikgcmV0dXJuOwogICAgICAgICAgICBsYXN0VmFsdWVbMF0gPSB2MDsKICAgICAgICAgICAgbGFzdFZhbHVlWzFdID0gdjE7CiAgICAgICAgICAgIGxhc3RWYWx1ZVsyXSA9IHYyOwogICAgICAgICAgICB0aGlzLl9nbC51bmlmb3JtM2YodGhpcy5fbG9jYXRpb24sIHYwLCB2MSwgdjIpCiAgICAgICAgfQogICAgICAgIFVwZGF0ZTRmKHYwLCB2MSwgdjIsIHYzKSB7CiAgICAgICAgICAgIHYwID0gTWF0aC5mcm91bmQodjApOwogICAgICAgICAgICB2MSA9IE1hdGguZnJvdW5kKHYxKTsKICAgICAgICAgICAgdjIgPSBNYXRoLmZyb3VuZCh2Mik7CiAgICAgICAgICAgIHYzID0gTWF0aC5mcm91bmQodjMpOwogICAgICAgICAgICBjb25zdCBsYXN0VmFsdWUgPSB0aGlzLl9sYXN0VmFsdWU7CiAgICAgICAgICAgIGlmIChsYXN0VmFsdWVbMF0gPT09IHYwICYmIGxhc3RWYWx1ZVsxXSA9PT0gdjEgJiYgbGFzdFZhbHVlWzJdID09PSB2MiAmJiBsYXN0VmFsdWVbM10gPT09IHYzKSByZXR1cm47CiAgICAgICAgICAgIGxhc3RWYWx1ZVswXSA9IHYwOwogICAgICAgICAgICBsYXN0VmFsdWVbMV0gPSB2MTsKICAgICAgICAgICAgbGFzdFZhbHVlWzJdID0gdjI7CiAgICAgICAgICAgIGxhc3RWYWx1ZVszXSA9IHYzOwogICAgICAgICAgICB0aGlzLl9nbC51bmlmb3JtNGYodGhpcy5fbG9jYXRpb24sCiAgICAgICAgICAgICAgICB2MCwgdjEsIHYyLCB2MykKICAgICAgICB9CiAgICAgICAgVXBkYXRlTWF0cml4NGZ2KG0pIHsKICAgICAgICAgICAgY29uc3QgbGFzdFZhbHVlID0gdGhpcy5fbGFzdFZhbHVlOwogICAgICAgICAgICBpZiAobWF0NC5leGFjdEVxdWFscyhsYXN0VmFsdWUsIG0pKSByZXR1cm47CiAgICAgICAgICAgIEMzLnR5cGVkQXJyYXlTZXQxNihsYXN0VmFsdWUsIG0sIDApOwogICAgICAgICAgICB0aGlzLl9nbC51bmlmb3JtTWF0cml4NGZ2KHRoaXMuX2xvY2F0aW9uLCBmYWxzZSwgbSkKICAgICAgICB9CiAgICAgICAgSXNTZXRUb0N1c3RvbUluQmF0Y2gocCkgewogICAgICAgICAgICBjb25zdCBiYXRjaFZhbHVlID0gdGhpcy5fbGFzdEJhdGNoVmFsdWU7CiAgICAgICAgICAgIGlmICh0aGlzLklzQ29sb3JUeXBlKCkpIHJldHVybiBiYXRjaFZhbHVlWzBdID09PSBNYXRoLmZyb3VuZChwLmdldFIoKSkgJiYgYmF0Y2hWYWx1ZVsxXSA9PT0gTWF0aC5mcm91bmQocC5nZXRHKCkpICYmIGJhdGNoVmFsdWVbMl0gPT09IE1hdGguZnJvdW5kKHAuZ2V0QigpKTsKICAgICAgICAgICAgZWxzZSByZXR1cm4gYmF0Y2hWYWx1ZVswXSA9PT0gTWF0aC5mcm91bmQocCkKICAgICAgICB9CiAgICAgICAgU2V0QmF0Y2hWYWx1ZUN1c3RvbShwKSB7CiAgICAgICAgICAgIGNvbnN0IGJhdGNoVmFsdWUgPSB0aGlzLl9sYXN0QmF0Y2hWYWx1ZTsKICAgICAgICAgICAgaWYgKHRoaXMuSXNDb2xvclR5cGUoKSkgewogICAgICAgICAgICAgICAgYmF0Y2hWYWx1ZVswXSA9CiAgICAgICAgICAgICAgICAgICAgcC5nZXRSKCk7CiAgICAgICAgICAgICAgICBiYXRjaFZhbHVlWzFdID0gcC5nZXRHKCk7CiAgICAgICAgICAgICAgICBiYXRjaFZhbHVlWzJdID0gcC5nZXRCKCkKICAgICAgICAgICAgfSBlbHNlIGJhdGNoVmFsdWVbMF0gPSBwCiAgICAgICAgfQogICAgICAgIElzU2V0VG8xSW5CYXRjaCh4KSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9sYXN0QmF0Y2hWYWx1ZVswXSA9PT0gTWF0aC5mcm91bmQoeCkKICAgICAgICB9CiAgICAgICAgSXNTZXRUbzJJbkJhdGNoKHgsIHkpIHsKICAgICAgICAgICAgY29uc3QgYmF0Y2hWYWx1ZSA9IHRoaXMuX2xhc3RCYXRjaFZhbHVlOwogICAgICAgICAgICByZXR1cm4gYmF0Y2hWYWx1ZVswXSA9PT0gTWF0aC5mcm91bmQoeCkgJiYgYmF0Y2hWYWx1ZVsxXSA9PT0gTWF0aC5mcm91bmQoeSkKICAgICAgICB9CiAgICAgICAgU2V0QmF0Y2gxKHgpIHsKICAgICAgICAgICAgdGhpcy5fbGFzdEJhdGNoVmFsdWVbMF0gPSB4CiAgICAgICAgfQogICAgICAgIFNldEJhdGNoMih4LCB5KSB7CiAgICAgICAgICAgIGNvbnN0IGJhdGNoVmFsdWUgPSB0aGlzLl9sYXN0QmF0Y2hWYWx1ZTsKICAgICAgICAgICAgYmF0Y2hWYWx1ZVswXSA9IHg7CiAgICAgICAgICAgIGJhdGNoVmFsdWVbMV0gPSB5CiAgICAgICAgfQogICAgfTsKCn0KCi8vIC4uL2xpYi9nZngvd2ViZ2wvYmF0Y2hKb2IuanMKewogICAgJ3VzZSBzdHJpY3QnOwogICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgY29uc3QgZ2xNYXRyaXggPSBzZWxmLmdsTWF0cml4OwogICAgY29uc3QgdmVjNCA9IGdsTWF0cml4LnZlYzQ7CiAgICBjb25zdCBtYXQ0ID0gZ2xNYXRyaXgubWF0NDsKICAgIGNvbnN0IEJBVENIX05VTEwgPSAwOwogICAgY29uc3QgQkFUQ0hfUVVBRCA9IDE7CiAgICBjb25zdCBCQVRDSF9TRVRURVhUVVJFID0gMjsKICAgIGNvbnN0IEJBVENIX1NFVENPTE9SID0gMzsKICAgIGNvbnN0IEJBVENIX1NFVEJMRU5EID0gNDsKICAgIGNvbnN0IEJBVENIX1NFVFZJRVdQT1JUID0gNTsKICAgIGNvbnN0IEJBVENIX1NFVFBST0pFQ1RJT04gPSA2OwogICAgY29uc3QgQkFUQ0hfU0VUTU9ERUxWSUVXID0gNzsKICAgIGNvbnN0IEJBVENIX1NFVFJFTkRFUlRBUkdFVCA9IDg7CiAgICBjb25zdCBCQVRDSF9DTEVBUlNVUkZBQ0UgPSA5OwogICAgY29uc3QgQkFUQ0hfUE9JTlRTID0gMTA7CiAgICBjb25zdCBCQVRDSF9TRVRQUk9HUkFNID0gMTE7CiAgICBjb25zdCBCQVRDSF9TRVRQUk9HUkFNUEFSQU1FVEVSUyA9IDEyOwogICAgY29uc3QgQkFUQ0hfU0VUUFJPR1JBTUNVU1RPTVBBUkFNRVRFUlMgPSAxMzsKICAgIGNvbnN0IEJBVENIX0lOVkFMSURBVEVGUkFNRUJVRkZFUiA9IDE0OwogICAgY29uc3QgQkFUQ0hfU0VUUE9JTlRURVhDT09SRFMgPSAxNTsKICAgIGNvbnN0IEJBVENIX1NFVFRJTEVNQVBJTkZPID0gMTY7CiAgICBjb25zdCBCQVRDSF9CTElURlJBTUVCVUZGRVIgPSAxNzsKICAgIGNvbnN0IEJBVENIX1NUQVJUUVVFUlkgPSAxODsKICAgIGNvbnN0IEJBVENIX0VORFFVRVJZID0gMTk7CiAgICBjb25zdCBCQVRDSF9TRVRFTExJUFNFUEFSQU1TID0gMjA7CiAgICBjb25zdCBCQVRDSF9TRVRHUkFESUVOVENPTE9SID0gMjE7CiAgICBjb25zdCBCQVRDSF9DTEVBUkRFUFRIID0gMjI7CiAgICBjb25zdCBCQVRDSF9TRVRERVBUSEVOQUJMRUQgPSAyMzsKICAgIGNvbnN0IEJBVENIX1NFVERFUFRIU0FNUExJTkdFTkFCTEVEID0gMjQ7CiAgICBjb25zdCBCQVRDSF9DT1BMQU5BUl9TVEFSVFNURU5DSUxQQVNTID0gMjU7CiAgICBjb25zdCBCQVRDSF9DT1BMQU5BUl9TVEFSVENPTE9SUEFTUyA9IDI2OwogICAgY29uc3QgQkFUQ0hfQ09QTEFOQVJfUkVTVE9SRSA9IDI3OwogICAgY29uc3QgQkFUQ0hfU0VUX1NDSVNTT1IgPSAyODsKICAgIGNvbnN0IEJBVENIX1NFVFRJTEVSQU5ET01JWkFUSU9OSU5GTyA9IDI5OwogICAgQzMuR2Z4LkJhdGNoU3RhdGUgPSBjbGFzcyBCYXRjaFN0YXRlIHsKICAgICAgICBjb25zdHJ1Y3RvcihyZW5kZXJlcikgewogICAgICAgICAgICB0aGlzLnJlbmRlcmVyID0gcmVuZGVyZXI7CiAgICAgICAgICAgIHRoaXMuY3VycmVudE1WID0gbWF0NC5jcmVhdGUoKTsKICAgICAgICAgICAgdGhpcy5jdXJyZW50TWF0UCA9IG1hdDQuY3JlYXRlKCk7CiAgICAgICAgICAgIHRoaXMuY3VycmVudEZyYW1lYnVmZmVyID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5jdXJyZW50RnJhbWVidWZmZXJOb0RlcHRoID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5pc0RlcHRoU2FtcGxpbmdFbmFibGVkID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuY3VycmVudENvbG9yID0gdmVjNC5mcm9tVmFsdWVzKDEsIDEsIDEsIDEpOwogICAgICAgICAgICB0aGlzLmN1cnJlbnRTaGFkZXIgPSBudWxsOwogICAgICAgICAgICB0aGlzLnBvaW50VGV4Q29vcmRzID0gbmV3IEMzLlJlY3Q7CiAgICAgICAgICAgIHRoaXMuY2xlYXJDb2xvciA9IEMzLk5ldyhDMy5Db2xvciwgMCwgMCwgMCwgMCkKICAgICAgICB9CiAgICB9OwogICAgQzMuR2Z4LldlYkdMQmF0Y2hKb2IgPSBjbGFzcyBXZWJHTEJhdGNoSm9iIHsKICAgICAgICBjb25zdHJ1Y3RvcihiYXRjaFN0YXRlKSB7CiAgICAgICAgICAgIGNvbnN0IGFycmF5QnVmZmVyID0gbmV3IEFycmF5QnVmZmVyKDk2KTsKICAgICAgICAgICAgdGhpcy5fdHlwZSA9IDA7CiAgICAgICAgICAgIHRoaXMuX2JhdGNoU3RhdGUgPSBiYXRjaFN0YXRlOwogICAgICAgICAgICB0aGlzLl9nbCA9IGJhdGNoU3RhdGUucmVuZGVyZXIuR2V0Q29udGV4dCgpOwogICAgICAgICAgICB0aGlzLl9zdGFydEluZGV4ID0gMDsKICAgICAgICAgICAgdGhpcy5faW5kZXhDb3VudCA9IDA7CiAgICAgICAgICAgIHRoaXMuX3RleFBhcmFtID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fbWF0NHBhcmFtID0gbmV3IEZsb2F0MzJBcnJheShhcnJheUJ1ZmZlciwgMCwgMTYpOwogICAgICAgICAgICB0aGlzLl9jb2xvclBhcmFtID0gbmV3IEZsb2F0MzJBcnJheShhcnJheUJ1ZmZlciwgNjQsIDQpOwogICAgICAgICAgICB0aGlzLl9zcmNPcmlnaW5SZWN0ID0gbmV3IEZsb2F0MzJBcnJheShhcnJheUJ1ZmZlciwgODAsIDQpOwogICAgICAgICAgICB0aGlzLl9zaGFkZXJQYXJhbXMgPSBbXQogICAgICAgIH0KICAgICAgICBJbml0UXVhZChzdGFydEluZGV4LCBpbmRleENvdW50KSB7CiAgICAgICAgICAgIHRoaXMuX3R5cGUgPSBCQVRDSF9RVUFEOwogICAgICAgICAgICB0aGlzLl9zdGFydEluZGV4ID0gc3RhcnRJbmRleDsKICAgICAgICAgICAgdGhpcy5faW5kZXhDb3VudCA9IGluZGV4Q291bnQKICAgICAgICB9CiAgICAgICAgRG9RdWFkKCkgewogICAgICAgICAgICBjb25zdCBnbCA9IHRoaXMuX2dsOwogICAgICAgICAgICBnbC5kcmF3RWxlbWVudHMoZ2wuVFJJQU5HTEVTLCB0aGlzLl9pbmRleENvdW50LCBnbC5VTlNJR05FRF9TSE9SVCwgdGhpcy5fc3RhcnRJbmRleCkKICAgICAgICB9CiAgICAgICAgSW5pdFNldFRleHR1cmUocmVuZGVyZXJUZXgpIHsKICAgICAgICAgICAgdGhpcy5fdHlwZSA9IEJBVENIX1NFVFRFWFRVUkU7CiAgICAgICAgICAgIHRoaXMuX3RleFBhcmFtID0gcmVuZGVyZXJUZXgKICAgICAgICB9CiAgICAgICAgRG9TZXRUZXh0dXJlKCkgewogICAgICAgICAgICBjb25zdCBnbCA9IHRoaXMuX2dsOwogICAgICAgICAgICBjb25zdCB0ZXhQYXJhbSA9IHRoaXMuX3RleFBhcmFtOwogICAgICAgICAgICBnbC5iaW5kVGV4dHVyZShnbC5URVhUVVJFXzJELCB0ZXhQYXJhbSA/IHRleFBhcmFtLl9HZXRUZXh0dXJlKCkgOiBudWxsKQogICAgICAgIH0KICAgICAgICBJbml0U2V0Q29sb3IoYykgewogICAgICAgICAgICB0aGlzLl90eXBlID0gQkFUQ0hfU0VUQ09MT1I7CiAgICAgICAgICAgIGMud3JpdGVUb1R5cGVkQXJyYXkodGhpcy5fY29sb3JQYXJhbSwgMCkKICAgICAgICB9CiAgICAgICAgRG9TZXRDb2xvcigpIHsKICAgICAgICAgICAgY29uc3QgYyA9IHRoaXMuX2NvbG9yUGFyYW07CiAgICAgICAgICAgIGNvbnN0IGJhdGNoU3RhdGUgPSB0aGlzLl9iYXRjaFN0YXRlOwogICAgICAgICAgICB2ZWM0LmNvcHkoYmF0Y2hTdGF0ZS5jdXJyZW50Q29sb3IsIGMpOwogICAgICAgICAgICBiYXRjaFN0YXRlLmN1cnJlbnRTaGFkZXIuVXBkYXRlQ29sb3IoYykKICAgICAgICB9CiAgICAgICAgSW5pdFNldEdyYWRpZW50Q29sb3IoYykgewogICAgICAgICAgICB0aGlzLl90eXBlID0gQkFUQ0hfU0VUR1JBRElFTlRDT0xPUjsKICAgICAgICAgICAgYy53cml0ZVRvVHlwZWRBcnJheSh0aGlzLl9jb2xvclBhcmFtLCAwKQogICAgICAgIH0KICAgICAgICBEb1NldEdyYWRpZW50Q29sb3IoKSB7CiAgICAgICAgICAgIGNvbnN0IGMgPSB0aGlzLl9jb2xvclBhcmFtOwogICAgICAgICAgICBjb25zdCBzID0gdGhpcy5fYmF0Y2hTdGF0ZS5jdXJyZW50U2hhZGVyOwogICAgICAgICAgICBpZiAocy5fdUNvbG9yMi5Jc1VzZWQoKSkgcy5fdUNvbG9yMi5VcGRhdGU0ZihjWzBdLCBjWzFdLCBjWzJdLCBjWzNdKQogICAgICAgIH0KICAgICAgICBJbml0U2V0QmxlbmQocywgZCkgewogICAgICAgICAgICB0aGlzLl90eXBlID0gQkFUQ0hfU0VUQkxFTkQ7CiAgICAgICAgICAgIHRoaXMuX3N0YXJ0SW5kZXggPSBzOwogICAgICAgICAgICB0aGlzLl9pbmRleENvdW50ID0gZAogICAgICAgIH0KICAgICAgICBEb1NldEJsZW5kKCkgewogICAgICAgICAgICB0aGlzLl9nbC5ibGVuZEZ1bmModGhpcy5fc3RhcnRJbmRleCwgdGhpcy5faW5kZXhDb3VudCkKICAgICAgICB9CiAgICAgICAgSW5pdFNldFZpZXdwb3J0KHgsIHksIHcsIGgpIHsKICAgICAgICAgICAgdGhpcy5fdHlwZSA9CiAgICAgICAgICAgICAgICBCQVRDSF9TRVRWSUVXUE9SVDsKICAgICAgICAgICAgY29uc3QgY29sb3JQYXJhbSA9IHRoaXMuX2NvbG9yUGFyYW07CiAgICAgICAgICAgIGNvbG9yUGFyYW1bMF0gPSB4OwogICAgICAgICAgICBjb2xvclBhcmFtWzFdID0geTsKICAgICAgICAgICAgY29sb3JQYXJhbVsyXSA9IHc7CiAgICAgICAgICAgIGNvbG9yUGFyYW1bM10gPSBoCiAgICAgICAgfQogICAgICAgIERvU2V0Vmlld3BvcnQoKSB7CiAgICAgICAgICAgIGNvbnN0IGNvbG9yUGFyYW0gPSB0aGlzLl9jb2xvclBhcmFtOwogICAgICAgICAgICB0aGlzLl9nbC52aWV3cG9ydChjb2xvclBhcmFtWzBdLCBjb2xvclBhcmFtWzFdLCBjb2xvclBhcmFtWzJdLCBjb2xvclBhcmFtWzNdKQogICAgICAgIH0KICAgICAgICBJbml0U2V0UHJvamVjdGlvbihtKSB7CiAgICAgICAgICAgIHRoaXMuX3R5cGUgPSBCQVRDSF9TRVRQUk9KRUNUSU9OOwogICAgICAgICAgICBtYXQ0LmNvcHkodGhpcy5fbWF0NHBhcmFtLCBtKQogICAgICAgIH0KICAgICAgICBEb1NldFByb2plY3Rpb24oKSB7CiAgICAgICAgICAgIGNvbnN0IGJhdGNoU3RhdGUgPSB0aGlzLl9iYXRjaFN0YXRlOwogICAgICAgICAgICBjb25zdCBhbGxTaGFkZXJQcm9ncmFtcyA9IGJhdGNoU3RhdGUucmVuZGVyZXIuX2FsbFNoYWRlclByb2dyYW1zOwogICAgICAgICAgICBjb25zdCBjdXJyZW50U2hhZGVyID0gYmF0Y2hTdGF0ZS5jdXJyZW50U2hhZGVyOwogICAgICAgICAgICBjb25zdCBtYXQ0cGFyYW0gPSB0aGlzLl9tYXQ0cGFyYW07CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBhbGxTaGFkZXJQcm9ncmFtcy5sZW5ndGg7IGkgPCBsZW47ICsraSkgewogICAgICAgICAgICAgICAgY29uc3QgcyA9IGFsbFNoYWRlclByb2dyYW1zW2ldOwogICAgICAgICAgICAgICAgaWYgKHMgPT09IGN1cnJlbnRTaGFkZXIpIHMuVXBkYXRlTWF0UChtYXQ0cGFyYW0sIHRydWUpOwogICAgICAgICAgICAgICAgZWxzZSBzLlNldE1hdFBTdGFsZSgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgbWF0NC5jb3B5KGJhdGNoU3RhdGUuY3VycmVudE1hdFAsIG1hdDRwYXJhbSkKICAgICAgICB9CiAgICAgICAgSW5pdFNldE1vZGVsVmlldyhtKSB7CiAgICAgICAgICAgIHRoaXMuX3R5cGUgPSBCQVRDSF9TRVRNT0RFTFZJRVc7CiAgICAgICAgICAgIG1hdDQuY29weSh0aGlzLl9tYXQ0cGFyYW0sIG0pCiAgICAgICAgfQogICAgICAgIERvU2V0TW9kZWxWaWV3KCkgewogICAgICAgICAgICBjb25zdCBiYXRjaFN0YXRlID0gdGhpcy5fYmF0Y2hTdGF0ZTsKICAgICAgICAgICAgY29uc3QgYWxsU2hhZGVyUHJvZ3JhbXMgPSBiYXRjaFN0YXRlLnJlbmRlcmVyLl9hbGxTaGFkZXJQcm9ncmFtczsKICAgICAgICAgICAgY29uc3QgY3VycmVudFNoYWRlciA9IGJhdGNoU3RhdGUuY3VycmVudFNoYWRlcjsKICAgICAgICAgICAgY29uc3QgbWF0NHBhcmFtID0gdGhpcy5fbWF0NHBhcmFtOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gYWxsU2hhZGVyUHJvZ3JhbXMubGVuZ3RoOyBpIDwKICAgICAgICAgICAgICAgIGxlbjsgKytpKSB7CiAgICAgICAgICAgICAgICBjb25zdCBzID0gYWxsU2hhZGVyUHJvZ3JhbXNbaV07CiAgICAgICAgICAgICAgICBpZiAocyA9PT0gY3VycmVudFNoYWRlcikgcy5VcGRhdGVNYXRNVihtYXQ0cGFyYW0sIHRydWUpOwogICAgICAgICAgICAgICAgZWxzZSBzLlNldE1hdE1WU3RhbGUoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIG1hdDQuY29weShiYXRjaFN0YXRlLmN1cnJlbnRNViwgbWF0NHBhcmFtKQogICAgICAgIH0KICAgICAgICBJbml0U2V0UmVuZGVyVGFyZ2V0KHJlbmRlclRhcmdldCkgewogICAgICAgICAgICB0aGlzLl90eXBlID0gQkFUQ0hfU0VUUkVOREVSVEFSR0VUOwogICAgICAgICAgICB0aGlzLl90ZXhQYXJhbSA9IHJlbmRlclRhcmdldAogICAgICAgIH0KICAgICAgICBEb1NldFJlbmRlclRhcmdldCgpIHsKICAgICAgICAgICAgY29uc3QgZ2wgPSB0aGlzLl9nbDsKICAgICAgICAgICAgY29uc3QgcmVuZGVyVGFyZ2V0ID0gdGhpcy5fdGV4UGFyYW07CiAgICAgICAgICAgIGNvbnN0IGJhdGNoU3RhdGUgPSB0aGlzLl9iYXRjaFN0YXRlOwogICAgICAgICAgICBpZiAocmVuZGVyVGFyZ2V0KSB7CiAgICAgICAgICAgICAgICBiYXRjaFN0YXRlLmN1cnJlbnRGcmFtZWJ1ZmZlciA9IHJlbmRlclRhcmdldC5fR2V0RnJhbWVidWZmZXIoKTsKICAgICAgICAgICAgICAgIGJhdGNoU3RhdGUuY3VycmVudEZyYW1lYnVmZmVyTm9EZXB0aCA9IHJlbmRlclRhcmdldC5fR2V0RnJhbWVidWZmZXJOb0RlcHRoKCk7CiAgICAgICAgICAgICAgICBpZiAoYmF0Y2hTdGF0ZS5pc0RlcHRoU2FtcGxpbmdFbmFibGVkICYmIGJhdGNoU3RhdGUuY3VycmVudEZyYW1lYnVmZmVyTm9EZXB0aCkgZ2wuYmluZEZyYW1lYnVmZmVyKGdsLkZSQU1FQlVGRkVSLCBiYXRjaFN0YXRlLmN1cnJlbnRGcmFtZWJ1ZmZlck5vRGVwdGgpOwogICAgICAgICAgICAgICAgZWxzZSBnbC5iaW5kRnJhbWVidWZmZXIoZ2wuRlJBTUVCVUZGRVIsIGJhdGNoU3RhdGUuY3VycmVudEZyYW1lYnVmZmVyKQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgYmF0Y2hTdGF0ZS5jdXJyZW50RnJhbWVidWZmZXIgPSBudWxsOwogICAgICAgICAgICAgICAgYmF0Y2hTdGF0ZS5jdXJyZW50RnJhbWVidWZmZXJOb0RlcHRoID0gbnVsbDsKICAgICAgICAgICAgICAgIGdsLmJpbmRGcmFtZWJ1ZmZlcihnbC5GUkFNRUJVRkZFUiwgbnVsbCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBJbml0Q2xlYXJTdXJmYWNlKGMpIHsKICAgICAgICAgICAgdGhpcy5fdHlwZSA9IEJBVENIX0NMRUFSU1VSRkFDRTsKICAgICAgICAgICAgYy53cml0ZVRvVHlwZWRBcnJheSh0aGlzLl9tYXQ0cGFyYW0sIDApCiAgICAgICAgfQogICAgICAgIEluaXRDbGVhclN1cmZhY2UyKHIsIGcsIGIsIGEpIHsKICAgICAgICAgICAgdGhpcy5fdHlwZSA9IEJBVENIX0NMRUFSU1VSRkFDRTsKICAgICAgICAgICAgY29uc3QgYyA9IHRoaXMuX21hdDRwYXJhbTsKICAgICAgICAgICAgY1swXSA9IHI7CiAgICAgICAgICAgIGNbMV0gPSBnOwogICAgICAgICAgICBjWzJdID0gYjsKICAgICAgICAgICAgY1szXSA9IGEKICAgICAgICB9CiAgICAgICAgRG9DbGVhclN1cmZhY2UoKSB7CiAgICAgICAgICAgIGNvbnN0IGdsID0gdGhpcy5fZ2w7CiAgICAgICAgICAgIGNvbnN0IG1hdDRwYXJhbSA9IHRoaXMuX21hdDRwYXJhbTsKICAgICAgICAgICAgY29uc3QgYmF0Y2hTdGF0ZSA9IHRoaXMuX2JhdGNoU3RhdGU7CiAgICAgICAgICAgIGNvbnN0IGxhc3RDbGVhckNvbG9yID0gYmF0Y2hTdGF0ZS5jbGVhckNvbG9yOwogICAgICAgICAgICBjb25zdCByID0gbWF0NHBhcmFtWzBdOwogICAgICAgICAgICBjb25zdCBnID0gbWF0NHBhcmFtWzFdOwogICAgICAgICAgICBjb25zdCBiID0gbWF0NHBhcmFtWzJdOwogICAgICAgICAgICBjb25zdCBhID0gbWF0NHBhcmFtWzNdOwogICAgICAgICAgICBpZiAoIWxhc3RDbGVhckNvbG9yLmVxdWFsc1JnYmEociwgZywgYiwgYSkpIHsKICAgICAgICAgICAgICAgIGdsLmNsZWFyQ29sb3IociwgZywgYiwgYSk7CiAgICAgICAgICAgICAgICBsYXN0Q2xlYXJDb2xvci5zZXRSZ2JhKHIsIGcsIGIsIGEpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZ2wuY2xlYXIoZ2wuQ09MT1JfQlVGRkVSX0JJVCkKICAgICAgICB9CiAgICAgICAgSW5pdFNldFBvaW50VGV4Q29vcmRzKHJlY3QpIHsKICAgICAgICAgICAgdGhpcy5fdHlwZSA9IEJBVENIX1NFVFBPSU5UVEVYQ09PUkRTOwogICAgICAgICAgICByZWN0LndyaXRlVG9UeXBlZEFycmF5KHRoaXMuX21hdDRwYXJhbSwgMCkKICAgICAgICB9CiAgICAgICAgRG9TZXRQb2ludFRleHR1cmVDb29yZHMoKSB7CiAgICAgICAgICAgIGNvbnN0IG1hdDRwYXJhbSA9CiAgICAgICAgICAgICAgICB0aGlzLl9tYXQ0cGFyYW07CiAgICAgICAgICAgIHRoaXMuX2JhdGNoU3RhdGUucG9pbnRUZXhDb29yZHMuc2V0KG1hdDRwYXJhbVswXSwgbWF0NHBhcmFtWzFdLCBtYXQ0cGFyYW1bMl0sIG1hdDRwYXJhbVszXSkKICAgICAgICB9CiAgICAgICAgSW5pdFBvaW50cyhzdGFydEluZGV4LCB6KSB7CiAgICAgICAgICAgIHRoaXMuX3R5cGUgPSBCQVRDSF9QT0lOVFM7CiAgICAgICAgICAgIHRoaXMuX3N0YXJ0SW5kZXggPSBzdGFydEluZGV4OwogICAgICAgICAgICB0aGlzLl9pbmRleENvdW50ID0gMTsKICAgICAgICAgICAgdGhpcy5fbWF0NHBhcmFtWzBdID0gegogICAgICAgIH0KICAgICAgICBEb1BvaW50cygpIHsKICAgICAgICAgICAgY29uc3QgZ2wgPSB0aGlzLl9nbDsKICAgICAgICAgICAgY29uc3QgYmF0Y2hTdGF0ZSA9IHRoaXMuX2JhdGNoU3RhdGU7CiAgICAgICAgICAgIGNvbnN0IHJlbmRlcmVyID0gYmF0Y2hTdGF0ZS5yZW5kZXJlcjsKICAgICAgICAgICAgY29uc3QgcyA9IHJlbmRlcmVyLl9zcFBvaW50czsKICAgICAgICAgICAgZ2wudXNlUHJvZ3JhbShzLl9zaGFkZXJQcm9ncmFtKTsKICAgICAgICAgICAgcy5VcGRhdGVNYXRQKGJhdGNoU3RhdGUuY3VycmVudE1hdFAsIGZhbHNlKTsKICAgICAgICAgICAgcy5VcGRhdGVNYXRNVihiYXRjaFN0YXRlLmN1cnJlbnRNViwgZmFsc2UpOwogICAgICAgICAgICBjb25zdCBwdGMgPSBiYXRjaFN0YXRlLnBvaW50VGV4Q29vcmRzOwogICAgICAgICAgICBpZiAocy5fdVBvaW50VGV4U3RhcnQuSXNVc2VkKCkpIHMuX3VQb2ludFRleFN0YXJ0LlVwZGF0ZTJmKHB0Yy5nZXRMZWZ0KCksCiAgICAgICAgICAgICAgICBwdGMuZ2V0VG9wKCkpOwogICAgICAgICAgICBpZiAocy5fdVBvaW50VGV4RW5kLklzVXNlZCgpKSBzLl91UG9pbnRUZXhFbmQuVXBkYXRlMmYocHRjLmdldFJpZ2h0KCksIHB0Yy5nZXRCb3R0b20oKSk7CiAgICAgICAgICAgIGNvbnN0IHogPSB0aGlzLl9tYXQ0cGFyYW1bMF07CiAgICAgICAgICAgIGlmIChzLl91WkVsZXZhdGlvbi5Jc1VzZWQoKSkgcy5fdVpFbGV2YXRpb24uVXBkYXRlMWYoeik7CiAgICAgICAgICAgIGlmIChzLl91Q29sb3IuSXNVc2VkKCkpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGMgPSBiYXRjaFN0YXRlLmN1cnJlbnRDb2xvcjsKICAgICAgICAgICAgICAgIHMuX3VDb2xvci5VcGRhdGU0ZihjWzBdLCBjWzFdLCBjWzJdLCBjWzNdKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGdsLmRyYXdBcnJheXMoZ2wuUE9JTlRTLCB0aGlzLl9zdGFydEluZGV4IC8gNCwgdGhpcy5faW5kZXhDb3VudCk7CiAgICAgICAgICAgIGdsLnVzZVByb2dyYW0oYmF0Y2hTdGF0ZS5jdXJyZW50U2hhZGVyLl9zaGFkZXJQcm9ncmFtKQogICAgICAgIH0KICAgICAgICBJbml0U2V0UHJvZ3JhbShwcm9ncmFtKSB7CiAgICAgICAgICAgIHRoaXMuX3R5cGUgPSBCQVRDSF9TRVRQUk9HUkFNOwogICAgICAgICAgICB0aGlzLl90ZXhQYXJhbSA9IHByb2dyYW0KICAgICAgICB9CiAgICAgICAgRG9TZXRQcm9ncmFtKCkgewogICAgICAgICAgICBjb25zdCBnbCA9IHRoaXMuX2dsOwogICAgICAgICAgICBjb25zdCBiYXRjaFN0YXRlID0KICAgICAgICAgICAgICAgIHRoaXMuX2JhdGNoU3RhdGU7CiAgICAgICAgICAgIGNvbnN0IHMgPSB0aGlzLl90ZXhQYXJhbTsKICAgICAgICAgICAgYmF0Y2hTdGF0ZS5jdXJyZW50U2hhZGVyID0gczsKICAgICAgICAgICAgZ2wudXNlUHJvZ3JhbShzLl9zaGFkZXJQcm9ncmFtKTsKICAgICAgICAgICAgcy5VcGRhdGVNYXRQKGJhdGNoU3RhdGUuY3VycmVudE1hdFAsIGZhbHNlKTsKICAgICAgICAgICAgcy5VcGRhdGVNYXRNVihiYXRjaFN0YXRlLmN1cnJlbnRNViwgZmFsc2UpOwogICAgICAgICAgICBpZiAocy5fdUNvbG9yLklzVXNlZCgpKSB7CiAgICAgICAgICAgICAgICBjb25zdCBjID0gYmF0Y2hTdGF0ZS5jdXJyZW50Q29sb3I7CiAgICAgICAgICAgICAgICBzLl91Q29sb3IuVXBkYXRlNGYoY1swXSwgY1sxXSwgY1syXSwgY1szXSkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBJbml0U2V0UHJvZ3JhbVBhcmFtZXRlcnMoKSB7CiAgICAgICAgICAgIHRoaXMuX3R5cGUgPSBCQVRDSF9TRVRQUk9HUkFNUEFSQU1FVEVSUwogICAgICAgIH0KICAgICAgICBEb1NldFByb2dyYW1QYXJhbWV0ZXJzKCkgewogICAgICAgICAgICBjb25zdCBzID0gdGhpcy5fYmF0Y2hTdGF0ZS5jdXJyZW50U2hhZGVyOwogICAgICAgICAgICBjb25zdCBnbCA9IHRoaXMuX2dsOwogICAgICAgICAgICBjb25zdCBtYXQ0cGFyYW0gPSB0aGlzLl9tYXQ0cGFyYW07CiAgICAgICAgICAgIGNvbnN0IGNvbG9yUGFyYW0gPSB0aGlzLl9jb2xvclBhcmFtOwogICAgICAgICAgICBjb25zdCBzcmNPcmlnaW5SZWN0ID0KICAgICAgICAgICAgICAgIHRoaXMuX3NyY09yaWdpblJlY3Q7CiAgICAgICAgICAgIGlmIChzLl91U2FtcGxlckJhY2suSXNVc2VkKCkpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHJlbmRlcmVyID0gdGhpcy5fYmF0Y2hTdGF0ZS5yZW5kZXJlcjsKICAgICAgICAgICAgICAgIGNvbnN0IHRleFBhcmFtID0gdGhpcy5fdGV4UGFyYW07CiAgICAgICAgICAgICAgICBpZiAocmVuZGVyZXIuX2xhc3RUZXh0dXJlMSAhPT0gdGV4UGFyYW0pIHsKICAgICAgICAgICAgICAgICAgICBnbC5hY3RpdmVUZXh0dXJlKGdsLlRFWFRVUkUxKTsKICAgICAgICAgICAgICAgICAgICBnbC5iaW5kVGV4dHVyZShnbC5URVhUVVJFXzJELCB0ZXhQYXJhbSA/IHRleFBhcmFtLl9HZXRUZXh0dXJlKCkgOiBudWxsKTsKICAgICAgICAgICAgICAgICAgICByZW5kZXJlci5fbGFzdFRleHR1cmUxID0gdGV4UGFyYW07CiAgICAgICAgICAgICAgICAgICAgZ2wuYWN0aXZlVGV4dHVyZShnbC5URVhUVVJFMCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAocy5fdVBpeGVsU2l6ZS5Jc1VzZWQoKSkgcy5fdVBpeGVsU2l6ZS5VcGRhdGUyZihtYXQ0cGFyYW1bMF0sIG1hdDRwYXJhbVsxXSk7CiAgICAgICAgICAgIGlmIChzLl91RGVzdFN0YXJ0LklzVXNlZCgpKSBzLl91RGVzdFN0YXJ0LlVwZGF0ZTJmKG1hdDRwYXJhbVsyXSwgbWF0NHBhcmFtWzNdKTsKICAgICAgICAgICAgaWYgKHMuX3VEZXN0RW5kLklzVXNlZCgpKSBzLl91RGVzdEVuZC5VcGRhdGUyZihtYXQ0cGFyYW1bNF0sCiAgICAgICAgICAgICAgICBtYXQ0cGFyYW1bNV0pOwogICAgICAgICAgICBpZiAocy5fdURldmljZVBpeGVsUmF0aW8uSXNVc2VkKCkpIHMuX3VEZXZpY2VQaXhlbFJhdGlvLlVwZGF0ZTFmKHRoaXMuX2luZGV4Q291bnQpOwogICAgICAgICAgICBpZiAocy5fdUxheWVyU2NhbGUuSXNVc2VkKCkpIHMuX3VMYXllclNjYWxlLlVwZGF0ZTFmKG1hdDRwYXJhbVs2XSk7CiAgICAgICAgICAgIGlmIChzLl91TGF5ZXJBbmdsZS5Jc1VzZWQoKSkgcy5fdUxheWVyQW5nbGUuVXBkYXRlMWYobWF0NHBhcmFtWzddKTsKICAgICAgICAgICAgaWYgKHMuX3VTcmNTdGFydC5Jc1VzZWQoKSkgcy5fdVNyY1N0YXJ0LlVwZGF0ZTJmKG1hdDRwYXJhbVsxMl0sIG1hdDRwYXJhbVsxM10pOwogICAgICAgICAgICBpZiAocy5fdVNyY0VuZC5Jc1VzZWQoKSkgcy5fdVNyY0VuZC5VcGRhdGUyZihtYXQ0cGFyYW1bMTRdLCBtYXQ0cGFyYW1bMTVdKTsKICAgICAgICAgICAgaWYgKHMuX3VTcmNPcmlnaW5TdGFydC5Jc1VzZWQoKSkgcy5fdVNyY09yaWdpblN0YXJ0LlVwZGF0ZTJmKHNyY09yaWdpblJlY3RbMF0sIHNyY09yaWdpblJlY3RbMV0pOwogICAgICAgICAgICBpZiAocy5fdVNyY09yaWdpbkVuZC5Jc1VzZWQoKSkgcy5fdVNyY09yaWdpbkVuZC5VcGRhdGUyZihzcmNPcmlnaW5SZWN0WzJdLAogICAgICAgICAgICAgICAgc3JjT3JpZ2luUmVjdFszXSk7CiAgICAgICAgICAgIGlmIChzLl91TGF5b3V0U3RhcnQuSXNVc2VkKCkpIHMuX3VMYXlvdXRTdGFydC5VcGRhdGUyZihjb2xvclBhcmFtWzBdLCBjb2xvclBhcmFtWzFdKTsKICAgICAgICAgICAgaWYgKHMuX3VMYXlvdXRFbmQuSXNVc2VkKCkpIHMuX3VMYXlvdXRFbmQuVXBkYXRlMmYoY29sb3JQYXJhbVsyXSwgY29sb3JQYXJhbVszXSk7CiAgICAgICAgICAgIGlmIChzLl91U2Vjb25kcy5Jc1VzZWQoKSkgcy5fdVNlY29uZHMuVXBkYXRlMWYodGhpcy5fc3RhcnRJbmRleCkKICAgICAgICB9CiAgICAgICAgSW5pdFNldFByb2dyYW1DdXN0b21QYXJhbWV0ZXJzKCkgewogICAgICAgICAgICB0aGlzLl90eXBlID0gQkFUQ0hfU0VUUFJPR1JBTUNVU1RPTVBBUkFNRVRFUlMKICAgICAgICB9CiAgICAgICAgRG9TZXRQcm9ncmFtQ3VzdG9tUGFyYW1ldGVycygpIHsKICAgICAgICAgICAgY29uc3QgcyA9IHRoaXMuX2JhdGNoU3RhdGUuY3VycmVudFNoYWRlcjsKICAgICAgICAgICAgY29uc3QgdUN1c3RvbVBhcmFtZXRlcnMgPSBzLl91Q3VzdG9tUGFyYW1ldGVyczsKICAgICAgICAgICAgY29uc3Qgc2hhZGVyUGFyYW1zID0gdGhpcy5fc2hhZGVyUGFyYW1zOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gdUN1c3RvbVBhcmFtZXRlcnMubGVuZ3RoOyBpIDwKICAgICAgICAgICAgICAgIGxlbjsgKytpKSB7CiAgICAgICAgICAgICAgICBjb25zdCBzaGFkZXJVbmlmb3JtID0gdUN1c3RvbVBhcmFtZXRlcnNbaV07CiAgICAgICAgICAgICAgICBjb25zdCBwYXJhbVZhbHVlID0gc2hhZGVyUGFyYW1zW2ldOwogICAgICAgICAgICAgICAgaWYgKHNoYWRlclVuaWZvcm0uSXNDb2xvclR5cGUoKSkgc2hhZGVyVW5pZm9ybS5VcGRhdGUzZihwYXJhbVZhbHVlLmdldFIoKSwgcGFyYW1WYWx1ZS5nZXRHKCksIHBhcmFtVmFsdWUuZ2V0QigpKTsKICAgICAgICAgICAgICAgIGVsc2Ugc2hhZGVyVW5pZm9ybS5VcGRhdGUxZihwYXJhbVZhbHVlKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIEluaXRJbnZhbGlkYXRlRnJhbWVidWZmZXIoZmJvKSB7CiAgICAgICAgICAgIHRoaXMuX3R5cGUgPSBCQVRDSF9JTlZBTElEQVRFRlJBTUVCVUZGRVI7CiAgICAgICAgICAgIHRoaXMuX3RleFBhcmFtID0gZmJvCiAgICAgICAgfQogICAgICAgIERvSW52YWxpZGF0ZUZyYW1lYnVmZmVyKCkgewogICAgICAgICAgICBjb25zdCBnbCA9IHRoaXMuX2dsOwogICAgICAgICAgICBjb25zdCBmYm8gPSB0aGlzLl90ZXhQYXJhbTsKICAgICAgICAgICAgY29uc3QgbGFzdEJvdW5kRmJvID0gdGhpcy5fYmF0Y2hTdGF0ZS5jdXJyZW50RnJhbWVidWZmZXI7CiAgICAgICAgICAgIGlmIChmYm8gIT09IGxhc3RCb3VuZEZibykgZ2wuYmluZEZyYW1lYnVmZmVyKGdsLkZSQU1FQlVGRkVSLAogICAgICAgICAgICAgICAgZmJvKTsKICAgICAgICAgICAgZ2wuaW52YWxpZGF0ZUZyYW1lYnVmZmVyKGdsLkZSQU1FQlVGRkVSLCBbZ2wuQ09MT1JfQVRUQUNITUVOVDBdKTsKICAgICAgICAgICAgaWYgKGZibyAhPT0gbGFzdEJvdW5kRmJvKSBnbC5iaW5kRnJhbWVidWZmZXIoZ2wuRlJBTUVCVUZGRVIsIGxhc3RCb3VuZEZibykKICAgICAgICB9CiAgICAgICAgSW5pdEJsaXRGcmFtZWJ1ZmZlcihzb3VyY2VSZW5kZXJUYXJnZXQsIGRlc3RSZW5kZXJUYXJnZXQsIG1vZGUpIHsKICAgICAgICAgICAgdGhpcy5fdHlwZSA9IEJBVENIX0JMSVRGUkFNRUJVRkZFUjsKICAgICAgICAgICAgY29uc3QgbWF0NHBhcmFtID0gdGhpcy5fbWF0NHBhcmFtOwogICAgICAgICAgICBjb25zdCByZW5kZXJlciA9IHRoaXMuX2JhdGNoU3RhdGUucmVuZGVyZXI7CiAgICAgICAgICAgIG1hdDRwYXJhbVswXSA9IHNvdXJjZVJlbmRlclRhcmdldC5HZXRXaWR0aCgpOwogICAgICAgICAgICBtYXQ0cGFyYW1bMV0gPSBzb3VyY2VSZW5kZXJUYXJnZXQuR2V0SGVpZ2h0KCk7CiAgICAgICAgICAgIG1hdDRwYXJhbVsyXSA9IGRlc3RSZW5kZXJUYXJnZXQgPyBkZXN0UmVuZGVyVGFyZ2V0LkdldFdpZHRoKCkgOiByZW5kZXJlci5HZXRXaWR0aCgpOwogICAgICAgICAgICBtYXQ0cGFyYW1bM10gPSBkZXN0UmVuZGVyVGFyZ2V0ID8KICAgICAgICAgICAgICAgIGRlc3RSZW5kZXJUYXJnZXQuR2V0SGVpZ2h0KCkgOiByZW5kZXJlci5HZXRIZWlnaHQoKTsKICAgICAgICAgICAgbWF0NHBhcmFtWzRdID0gc291cmNlUmVuZGVyVGFyZ2V0LklzTGluZWFyU2FtcGxpbmcoKSA/IDEgOiAwOwogICAgICAgICAgICBtYXQ0cGFyYW1bNV0gPSBtb2RlID09PSAic3RyZXRjaCI7CiAgICAgICAgICAgIGNvbnN0IHNoYWRlclBhcmFtcyA9IHRoaXMuX3NoYWRlclBhcmFtczsKICAgICAgICAgICAgQzMuY2xlYXJBcnJheShzaGFkZXJQYXJhbXMpOwogICAgICAgICAgICBzaGFkZXJQYXJhbXMucHVzaChzb3VyY2VSZW5kZXJUYXJnZXQuX0dldEZyYW1lYnVmZmVyKCkpOwogICAgICAgICAgICBzaGFkZXJQYXJhbXMucHVzaChkZXN0UmVuZGVyVGFyZ2V0ID8gZGVzdFJlbmRlclRhcmdldC5fR2V0RnJhbWVidWZmZXIoKSA6IG51bGwpCiAgICAgICAgfQogICAgICAgIERvQmxpdEZyYW1lYnVmZmVyKCkgewogICAgICAgICAgICBjb25zdCBtYXQ0cGFyYW0gPSB0aGlzLl9tYXQ0cGFyYW07CiAgICAgICAgICAgIGNvbnN0IHNoYWRlclBhcmFtcyA9IHRoaXMuX3NoYWRlclBhcmFtczsKICAgICAgICAgICAgY29uc3QgZ2wgPSB0aGlzLl9nbDsKICAgICAgICAgICAgY29uc3Qgc3JjV2lkdGggPSBtYXQ0cGFyYW1bMF07CiAgICAgICAgICAgIGNvbnN0IHNyY0hlaWdodCA9IG1hdDRwYXJhbVsxXTsKICAgICAgICAgICAgY29uc3QgZGVzdFdpZHRoID0KICAgICAgICAgICAgICAgIG1hdDRwYXJhbVsyXTsKICAgICAgICAgICAgY29uc3QgZGVzdEhlaWdodCA9IG1hdDRwYXJhbVszXTsKICAgICAgICAgICAgY29uc3QgaXNMaW5lYXJTYW1wbGluZyA9IG1hdDRwYXJhbVs0XSAhPT0gMDsKICAgICAgICAgICAgY29uc3QgaXNTdHJldGNoID0gbWF0NHBhcmFtWzVdICE9PSAwOwogICAgICAgICAgICBjb25zdCBzcmNGYm8gPSBzaGFkZXJQYXJhbXNbMF07CiAgICAgICAgICAgIGNvbnN0IGRlc3RGYm8gPSBzaGFkZXJQYXJhbXNbMV07CiAgICAgICAgICAgIGdsLmJpbmRGcmFtZWJ1ZmZlcihnbC5SRUFEX0ZSQU1FQlVGRkVSLCBzcmNGYm8pOwogICAgICAgICAgICBnbC5iaW5kRnJhbWVidWZmZXIoZ2wuRFJBV19GUkFNRUJVRkZFUiwgZGVzdEZibyk7CiAgICAgICAgICAgIGlmIChpc1N0cmV0Y2gpIGdsLmJsaXRGcmFtZWJ1ZmZlcigwLCAwLCBzcmNXaWR0aCwgc3JjSGVpZ2h0LCAwLCAwLCBkZXN0V2lkdGgsIGRlc3RIZWlnaHQsIGdsLkNPTE9SX0JVRkZFUl9CSVQsIGlzTGluZWFyU2FtcGxpbmcgPyBnbC5MSU5FQVIgOiBnbC5ORUFSRVNUKTsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBjb25zdCB3ID0gTWF0aC5taW4oc3JjV2lkdGgsIGRlc3RXaWR0aCk7CiAgICAgICAgICAgICAgICBjb25zdCBoID0gTWF0aC5taW4oc3JjSGVpZ2h0LCBkZXN0SGVpZ2h0KTsKICAgICAgICAgICAgICAgIGNvbnN0IHNyY09mZlkgPQogICAgICAgICAgICAgICAgICAgIE1hdGgubWF4KHNyY0hlaWdodCAtIGRlc3RIZWlnaHQsIDApOwogICAgICAgICAgICAgICAgY29uc3QgZGVzdE9mZlkgPSBNYXRoLm1heChkZXN0SGVpZ2h0IC0gc3JjSGVpZ2h0LCAwKTsKICAgICAgICAgICAgICAgIGdsLmJsaXRGcmFtZWJ1ZmZlcigwLCBzcmNPZmZZLCB3LCBoICsgc3JjT2ZmWSwgMCwgZGVzdE9mZlksIHcsIGggKyBkZXN0T2ZmWSwgZ2wuQ09MT1JfQlVGRkVSX0JJVCwgZ2wuTkVBUkVTVCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBJbml0U3RhcnRRdWVyeShxdWVyeSkgewogICAgICAgICAgICB0aGlzLl90eXBlID0gQkFUQ0hfU1RBUlRRVUVSWTsKICAgICAgICAgICAgdGhpcy5fdGV4UGFyYW0gPSBxdWVyeQogICAgICAgIH0KICAgICAgICBEb1N0YXJ0UXVlcnkoKSB7CiAgICAgICAgICAgIHRoaXMuX3RleFBhcmFtLkJlZ2luVGltZUVsYXBzZWQoKTsKICAgICAgICAgICAgdGhpcy5fdGV4UGFyYW0gPSBudWxsCiAgICAgICAgfQogICAgICAgIEluaXRFbmRRdWVyeShxdWVyeSkgewogICAgICAgICAgICB0aGlzLl90eXBlID0gQkFUQ0hfRU5EUVVFUlk7CiAgICAgICAgICAgIHRoaXMuX3RleFBhcmFtID0gcXVlcnkKICAgICAgICB9CiAgICAgICAgRG9FbmRRdWVyeSgpIHsKICAgICAgICAgICAgdGhpcy5fdGV4UGFyYW0uRW5kVGltZUVsYXBzZWQoKTsKICAgICAgICAgICAgdGhpcy5fdGV4UGFyYW0gPSBudWxsCiAgICAgICAgfQogICAgICAgIEluaXRTZXRFbGxpcHNlUGFyYW1zKHBpeGVsVywgcGl4ZWxILCBvdXRsaW5lVGhpY2tuZXNzKSB7CiAgICAgICAgICAgIHRoaXMuX3R5cGUgPQogICAgICAgICAgICAgICAgQkFUQ0hfU0VURUxMSVBTRVBBUkFNUzsKICAgICAgICAgICAgY29uc3QgbWF0NHBhcmFtID0gdGhpcy5fbWF0NHBhcmFtOwogICAgICAgICAgICBtYXQ0cGFyYW1bMF0gPSBwaXhlbFc7CiAgICAgICAgICAgIG1hdDRwYXJhbVsxXSA9IHBpeGVsSDsKICAgICAgICAgICAgbWF0NHBhcmFtWzJdID0gb3V0bGluZVRoaWNrbmVzcwogICAgICAgIH0KICAgICAgICBEb1NldEVsbGlwc2VQYXJhbXMoKSB7CiAgICAgICAgICAgIGNvbnN0IHMgPSB0aGlzLl9iYXRjaFN0YXRlLmN1cnJlbnRTaGFkZXI7CiAgICAgICAgICAgIGNvbnN0IG1hdDRwYXJhbSA9IHRoaXMuX21hdDRwYXJhbTsKICAgICAgICAgICAgaWYgKHMuX3VQaXhlbFNpemUuSXNVc2VkKCkpIHMuX3VQaXhlbFNpemUuVXBkYXRlMmYobWF0NHBhcmFtWzBdLCBtYXQ0cGFyYW1bMV0pOwogICAgICAgICAgICBpZiAocy5fdU91dGxpbmVUaGlja25lc3MuSXNVc2VkKCkpIHMuX3VPdXRsaW5lVGhpY2tuZXNzLlVwZGF0ZTFmKG1hdDRwYXJhbVsyXSkKICAgICAgICB9CiAgICAgICAgSW5pdFNldFRpbGVtYXBJbmZvKHNyY1JlY3QsIHRleHR1cmVXaWR0aCwgdGV4dHVyZUhlaWdodCwgdGlsZVdpZHRoLCB0aWxlSGVpZ2h0LCB0aWxlU3BhY2luZ1gsIHRpbGVTcGFjaW5nWSkgewogICAgICAgICAgICB0aGlzLl90eXBlID0gQkFUQ0hfU0VUVElMRU1BUElORk87CiAgICAgICAgICAgIGNvbnN0IG1hdDRwYXJhbSA9IHRoaXMuX21hdDRwYXJhbTsKICAgICAgICAgICAgc3JjUmVjdC53cml0ZVRvVHlwZWRBcnJheShtYXQ0cGFyYW0sIDApOwogICAgICAgICAgICBtYXQ0cGFyYW1bNF0gPSAxIC8gdGV4dHVyZVdpZHRoOwogICAgICAgICAgICBtYXQ0cGFyYW1bNV0gPSAxIC8gdGV4dHVyZUhlaWdodDsKICAgICAgICAgICAgbWF0NHBhcmFtWzZdID0gdGlsZVdpZHRoIC8gdGV4dHVyZVdpZHRoOwogICAgICAgICAgICBtYXQ0cGFyYW1bN10gPSB0aWxlSGVpZ2h0IC8gdGV4dHVyZUhlaWdodDsKICAgICAgICAgICAgbWF0NHBhcmFtWzhdID0gdGlsZVNwYWNpbmdYIC8gdGV4dHVyZVdpZHRoOwogICAgICAgICAgICBtYXQ0cGFyYW1bOV0gPSB0aWxlU3BhY2luZ1kgLyB0ZXh0dXJlSGVpZ2h0CiAgICAgICAgfQogICAgICAgIERvU2V0VGlsZW1hcEluZm8oKSB7CiAgICAgICAgICAgIGNvbnN0IHMgPSB0aGlzLl9iYXRjaFN0YXRlLmN1cnJlbnRTaGFkZXI7CiAgICAgICAgICAgIGNvbnN0IG1hdDRwYXJhbSA9IHRoaXMuX21hdDRwYXJhbTsKICAgICAgICAgICAgaWYgKHMuX3VTcmNTdGFydC5Jc1VzZWQoKSkgcy5fdVNyY1N0YXJ0LlVwZGF0ZTJmKG1hdDRwYXJhbVswXSwgbWF0NHBhcmFtWzFdKTsKICAgICAgICAgICAgaWYgKHMuX3VQaXhlbFNpemUuSXNVc2VkKCkpIHMuX3VQaXhlbFNpemUuVXBkYXRlMmYobWF0NHBhcmFtWzRdLAogICAgICAgICAgICAgICAgbWF0NHBhcmFtWzVdKTsKICAgICAgICAgICAgaWYgKHMuX3VUaWxlU2l6ZS5Jc1VzZWQoKSkgcy5fdVRpbGVTaXplLlVwZGF0ZTJmKG1hdDRwYXJhbVs2XSwgbWF0NHBhcmFtWzddKTsKICAgICAgICAgICAgaWYgKHMuX3VUaWxlU3BhY2luZy5Jc1VzZWQoKSkgcy5fdVRpbGVTcGFjaW5nLlVwZGF0ZTJmKG1hdDRwYXJhbVs4XSwgbWF0NHBhcmFtWzldKQogICAgICAgIH0KICAgICAgICBJbml0U2V0VGlsZVJhbmRvbWl6YXRpb25JbmZvKHRleHR1cmVXaWR0aCwgdGV4dHVyZUhlaWdodCwgeFJhbmRvbSwgeVJhbmRvbSwgYW5nbGVSYW5kb20sIGJsZW5kTWFyZ2luWCwgYmxlbmRNYXJnaW5ZKSB7CiAgICAgICAgICAgIHRoaXMuX3R5cGUgPSBCQVRDSF9TRVRUSUxFUkFORE9NSVpBVElPTklORk87CiAgICAgICAgICAgIGNvbnN0IG1hdDRwYXJhbSA9IHRoaXMuX21hdDRwYXJhbTsKICAgICAgICAgICAgbWF0NHBhcmFtWzBdID0gMSAvIHRleHR1cmVXaWR0aDsKICAgICAgICAgICAgbWF0NHBhcmFtWzFdID0gMSAvIHRleHR1cmVIZWlnaHQ7CiAgICAgICAgICAgIG1hdDRwYXJhbVsyXSA9IHhSYW5kb207CiAgICAgICAgICAgIG1hdDRwYXJhbVszXSA9IHlSYW5kb207CiAgICAgICAgICAgIG1hdDRwYXJhbVs0XSA9IGFuZ2xlUmFuZG9tOwogICAgICAgICAgICBtYXQ0cGFyYW1bNV0gPSBibGVuZE1hcmdpblg7CiAgICAgICAgICAgIG1hdDRwYXJhbVs2XSA9IGJsZW5kTWFyZ2luWQogICAgICAgIH0KICAgICAgICBEb1NldFRpbGVSYW5kb21pemF0aW9uSW5mbygpIHsKICAgICAgICAgICAgY29uc3QgcyA9IHRoaXMuX2JhdGNoU3RhdGUuY3VycmVudFNoYWRlcjsKICAgICAgICAgICAgY29uc3QgbWF0NHBhcmFtID0gdGhpcy5fbWF0NHBhcmFtOwogICAgICAgICAgICBpZiAocy5fdVBpeGVsU2l6ZS5Jc1VzZWQoKSkgcy5fdVBpeGVsU2l6ZS5VcGRhdGUyZihtYXQ0cGFyYW1bMF0sIG1hdDRwYXJhbVsxXSk7CiAgICAgICAgICAgIGlmIChzLl91VGlsZVNpemUuSXNVc2VkKCkpIHMuX3VUaWxlU2l6ZS5VcGRhdGUyZihtYXQ0cGFyYW1bMl0sIG1hdDRwYXJhbVszXSk7CiAgICAgICAgICAgIGlmIChzLl91T3V0bGluZVRoaWNrbmVzcy5Jc1VzZWQoKSkgcy5fdU91dGxpbmVUaGlja25lc3MuVXBkYXRlMWYobWF0NHBhcmFtWzRdKTsKICAgICAgICAgICAgaWYgKHMuX3VUaWxlU3BhY2luZy5Jc1VzZWQoKSkgcy5fdVRpbGVTcGFjaW5nLlVwZGF0ZTJmKG1hdDRwYXJhbVs1XSwgbWF0NHBhcmFtWzZdKQogICAgICAgIH0KICAgICAgICBJbml0Q2xlYXJEZXB0aChpc0RlcHRoRW5hYmxlZCkgewogICAgICAgICAgICB0aGlzLl90eXBlID0gQkFUQ0hfQ0xFQVJERVBUSDsKICAgICAgICAgICAgdGhpcy5fc3RhcnRJbmRleCA9CiAgICAgICAgICAgICAgICBpc0RlcHRoRW5hYmxlZCA/IDEgOiAwCiAgICAgICAgfQogICAgICAgIERvQ2xlYXJEZXB0aCgpIHsKICAgICAgICAgICAgY29uc3QgZ2wgPSB0aGlzLl9nbDsKICAgICAgICAgICAgY29uc3QgaXNEZXB0aEVuYWJsZWQgPSB0aGlzLl9zdGFydEluZGV4ICE9PSAwOwogICAgICAgICAgICBpZiAoIWlzRGVwdGhFbmFibGVkKSBnbC5kZXB0aE1hc2sodHJ1ZSk7CiAgICAgICAgICAgIGdsLmNsZWFyKGdsLkRFUFRIX0JVRkZFUl9CSVQpOwogICAgICAgICAgICBpZiAoIWlzRGVwdGhFbmFibGVkKSBnbC5kZXB0aE1hc2soZmFsc2UpCiAgICAgICAgfQogICAgICAgIEluaXRTZXREZXB0aEVuYWJsZWQoZSkgewogICAgICAgICAgICB0aGlzLl90eXBlID0gQkFUQ0hfU0VUREVQVEhFTkFCTEVEOwogICAgICAgICAgICB0aGlzLl9zdGFydEluZGV4ID0gZSA/IDEgOiAwCiAgICAgICAgfQogICAgICAgIERvU2V0RGVwdGhFbmFibGVkKCkgewogICAgICAgICAgICBjb25zdCBnbCA9IHRoaXMuX2dsOwogICAgICAgICAgICBpZiAodGhpcy5fc3RhcnRJbmRleCA9PT0gMCkgewogICAgICAgICAgICAgICAgZ2wuZGlzYWJsZShnbC5ERVBUSF9URVNUKTsKICAgICAgICAgICAgICAgIGdsLmRlcHRoTWFzayhmYWxzZSkKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGdsLmVuYWJsZShnbC5ERVBUSF9URVNUKTsKICAgICAgICAgICAgICAgIGdsLmRlcHRoTWFzayh0cnVlKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIEluaXRTZXREZXB0aFNhbXBsaW5nRW5hYmxlZChlKSB7CiAgICAgICAgICAgIHRoaXMuX3R5cGUgPSBCQVRDSF9TRVRERVBUSFNBTVBMSU5HRU5BQkxFRDsKICAgICAgICAgICAgdGhpcy5fc3RhcnRJbmRleCA9IGUgPyAxIDogMAogICAgICAgIH0KICAgICAgICBEb1NldERlcHRoU2FtcGxpbmdFbmFibGVkKCkgewogICAgICAgICAgICBjb25zdCBnbCA9IHRoaXMuX2dsOwogICAgICAgICAgICBjb25zdCBiYXRjaFN0YXRlID0gdGhpcy5fYmF0Y2hTdGF0ZTsKICAgICAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBiYXRjaFN0YXRlLnJlbmRlcmVyOwogICAgICAgICAgICBjb25zdCBpc0RlcHRoU2FtcGxpbmdFbmFibGVkID0gdGhpcy5fc3RhcnRJbmRleCAhPT0gMDsKICAgICAgICAgICAgYmF0Y2hTdGF0ZS5pc0RlcHRoU2FtcGxpbmdFbmFibGVkID0gaXNEZXB0aFNhbXBsaW5nRW5hYmxlZDsKICAgICAgICAgICAgZ2wuYWN0aXZlVGV4dHVyZShnbC5URVhUVVJFMik7CiAgICAgICAgICAgIGlmIChpc0RlcHRoU2FtcGxpbmdFbmFibGVkKSB7CiAgICAgICAgICAgICAgICBpZiAoYmF0Y2hTdGF0ZS5jdXJyZW50RnJhbWVidWZmZXJOb0RlcHRoKSBnbC5iaW5kRnJhbWVidWZmZXIoZ2wuRlJBTUVCVUZGRVIsIGJhdGNoU3RhdGUuY3VycmVudEZyYW1lYnVmZmVyTm9EZXB0aCk7CiAgICAgICAgICAgICAgICBnbC5iaW5kVGV4dHVyZShnbC5URVhUVVJFXzJELCByZW5kZXJlci5fR2V0RGVwdGhCdWZmZXIoKSkKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGdsLmJpbmRUZXh0dXJlKGdsLlRFWFRVUkVfMkQsCiAgICAgICAgICAgICAgICAgICAgbnVsbCk7CiAgICAgICAgICAgICAgICBpZiAoYmF0Y2hTdGF0ZS5jdXJyZW50RnJhbWVidWZmZXJOb0RlcHRoKSBnbC5iaW5kRnJhbWVidWZmZXIoZ2wuRlJBTUVCVUZGRVIsIGJhdGNoU3RhdGUuY3VycmVudEZyYW1lYnVmZmVyKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGdsLmFjdGl2ZVRleHR1cmUoZ2wuVEVYVFVSRTApCiAgICAgICAgfQogICAgICAgIEluaXRDb3BsYW5hclN0YXJ0U3RlbmNpbFBhc3MoKSB7CiAgICAgICAgICAgIHRoaXMuX3R5cGUgPSBCQVRDSF9DT1BMQU5BUl9TVEFSVFNURU5DSUxQQVNTCiAgICAgICAgfQogICAgICAgIERvQ29wbGFuYXJTdGFydFN0ZW5jaWxQYXNzKCkgewogICAgICAgICAgICBjb25zdCBnbCA9IHRoaXMuX2dsOwogICAgICAgICAgICBnbC5jbGVhcihnbC5TVEVOQ0lMX0JVRkZFUl9CSVQpOwogICAgICAgICAgICBnbC5lbmFibGUoZ2wuU1RFTkNJTF9URVNUKTsKICAgICAgICAgICAgZ2wuc3RlbmNpbEZ1bmMoZ2wuQUxXQVlTLCAxLCAxKTsKICAgICAgICAgICAgZ2wuc3RlbmNpbE9wKGdsLktFRVAsIGdsLktFRVAsIGdsLlJFUExBQ0UpOwogICAgICAgICAgICBnbC5jb2xvck1hc2soZmFsc2UsIGZhbHNlLCBmYWxzZSwgZmFsc2UpCiAgICAgICAgfQogICAgICAgIEluaXRDb3BsYW5hclN0YXJ0Q29sb3JQYXNzKCkgewogICAgICAgICAgICB0aGlzLl90eXBlID0gQkFUQ0hfQ09QTEFOQVJfU1RBUlRDT0xPUlBBU1MKICAgICAgICB9CiAgICAgICAgRG9Db3BsYW5hclN0YXJ0Q29sb3JQYXNzKCkgewogICAgICAgICAgICBjb25zdCBnbCA9CiAgICAgICAgICAgICAgICB0aGlzLl9nbDsKICAgICAgICAgICAgZ2wuY29sb3JNYXNrKHRydWUsIHRydWUsIHRydWUsIHRydWUpOwogICAgICAgICAgICBnbC5zdGVuY2lsRnVuYyhnbC5FUVVBTCwgMSwgMSk7CiAgICAgICAgICAgIGdsLnN0ZW5jaWxPcChnbC5LRUVQLCBnbC5LRUVQLCBnbC5LRUVQKQogICAgICAgIH0KICAgICAgICBJbml0Q29wbGFuYXJSZXN0b3JlKCkgewogICAgICAgICAgICB0aGlzLl90eXBlID0gQkFUQ0hfQ09QTEFOQVJfUkVTVE9SRQogICAgICAgIH0KICAgICAgICBEb0NvcGxhbmFyUmVzdG9yZSgpIHsKICAgICAgICAgICAgY29uc3QgZ2wgPSB0aGlzLl9nbDsKICAgICAgICAgICAgZ2wuZGlzYWJsZShnbC5TVEVOQ0lMX1RFU1QpCiAgICAgICAgfQogICAgICAgIEluaXRTZXRTY2lzc29yKGVuYWJsZSwgeCwgeSwgdywgaCkgewogICAgICAgICAgICB0aGlzLl90eXBlID0gQkFUQ0hfU0VUX1NDSVNTT1I7CiAgICAgICAgICAgIHRoaXMuX3N0YXJ0SW5kZXggPSBlbmFibGUgPyAxIDogMDsKICAgICAgICAgICAgY29uc3QgbWF0NHBhcmFtID0gdGhpcy5fbWF0NHBhcmFtOwogICAgICAgICAgICBtYXQ0cGFyYW1bMF0gPSB4OwogICAgICAgICAgICBtYXQ0cGFyYW1bMV0gPSB5OwogICAgICAgICAgICBtYXQ0cGFyYW1bMl0gPSB3OwogICAgICAgICAgICBtYXQ0cGFyYW1bM10gPSBoCiAgICAgICAgfQogICAgICAgIERvU2V0U2Npc3NvcigpIHsKICAgICAgICAgICAgY29uc3QgZ2wgPSB0aGlzLl9nbDsKICAgICAgICAgICAgY29uc3QgbWF0NHBhcmFtID0gdGhpcy5fbWF0NHBhcmFtOwogICAgICAgICAgICBpZiAodGhpcy5fc3RhcnRJbmRleCA9PT0gMSkgewogICAgICAgICAgICAgICAgZ2wuZW5hYmxlKGdsLlNDSVNTT1JfVEVTVCk7CiAgICAgICAgICAgICAgICBnbC5zY2lzc29yKG1hdDRwYXJhbVswXSwgbWF0NHBhcmFtWzFdLCBtYXQ0cGFyYW1bMl0sIG1hdDRwYXJhbVszXSkKICAgICAgICAgICAgfSBlbHNlIGdsLmRpc2FibGUoZ2wuU0NJU1NPUl9URVNUKQogICAgICAgIH0KICAgICAgICBSdW4oKSB7CiAgICAgICAgICAgIHN3aXRjaCAodGhpcy5fdHlwZSkgewogICAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgICAgIHRoaXMuRG9RdWFkKCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgICAgIHRoaXMuRG9TZXRUZXh0dXJlKCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgICAgIHRoaXMuRG9TZXRDb2xvcigpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgICAgICB0aGlzLkRvU2V0QmxlbmQoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5Eb1NldFZpZXdwb3J0KCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgICAgICAgIHRoaXMuRG9TZXRQcm9qZWN0aW9uKCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgICAgIHRoaXMuRG9TZXRNb2RlbFZpZXcoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICBjYXNlIDg6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5Eb1NldFJlbmRlclRhcmdldCgpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICAgICAgICB0aGlzLkRvQ2xlYXJTdXJmYWNlKCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgICAgICAgICB0aGlzLkRvUG9pbnRzKCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgICAgICAgICB0aGlzLkRvU2V0UHJvZ3JhbSgpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5Eb1NldFByb2dyYW1QYXJhbWV0ZXJzKCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgY2FzZSAxMzoKICAgICAgICAgICAgICAgICAgICB0aGlzLkRvU2V0UHJvZ3JhbUN1c3RvbVBhcmFtZXRlcnMoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICBjYXNlIDE0OgogICAgICAgICAgICAgICAgICAgIHRoaXMuRG9JbnZhbGlkYXRlRnJhbWVidWZmZXIoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICBjYXNlIDE1OgogICAgICAgICAgICAgICAgICAgIHRoaXMuRG9TZXRQb2ludFRleHR1cmVDb29yZHMoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICBjYXNlIDE2OgogICAgICAgICAgICAgICAgICAgIHRoaXMuRG9TZXRUaWxlbWFwSW5mbygpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIGNhc2UgMTc6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5Eb0JsaXRGcmFtZWJ1ZmZlcigpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIGNhc2UgMTg6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5Eb1N0YXJ0UXVlcnkoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICBjYXNlIDE5OgogICAgICAgICAgICAgICAgICAgIHRoaXMuRG9FbmRRdWVyeSgpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIGNhc2UgMjA6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5Eb1NldEVsbGlwc2VQYXJhbXMoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICBjYXNlIDIxOgogICAgICAgICAgICAgICAgICAgIHRoaXMuRG9TZXRHcmFkaWVudENvbG9yKCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgY2FzZSAyMjoKICAgICAgICAgICAgICAgICAgICB0aGlzLkRvQ2xlYXJEZXB0aCgpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIGNhc2UgMjM6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5Eb1NldERlcHRoRW5hYmxlZCgpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIGNhc2UgMjQ6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5Eb1NldERlcHRoU2FtcGxpbmdFbmFibGVkKCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgY2FzZSAyNToKICAgICAgICAgICAgICAgICAgICB0aGlzLkRvQ29wbGFuYXJTdGFydFN0ZW5jaWxQYXNzKCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgY2FzZSAyNjoKICAgICAgICAgICAgICAgICAgICB0aGlzLkRvQ29wbGFuYXJTdGFydENvbG9yUGFzcygpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIGNhc2UgMjc6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5Eb0NvcGxhbmFyUmVzdG9yZSgpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIGNhc2UgMjg6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5Eb1NldFNjaXNzb3IoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICBjYXNlIDI5OgogICAgICAgICAgICAgICAgICAgIHRoaXMuRG9TZXRUaWxlUmFuZG9taXphdGlvbkluZm8oKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07Cgp9CgovLyAuLi9saWIvZ2Z4L3RleHQuanMKewogICAgJ3VzZSBzdHJpY3QnOwogICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgY29uc3QgTUFYX1RFWFRVUkVfU0laRSA9IDQwOTY7CiAgICBjb25zdCBFWFRSQV9MSU5FX0hFSUdIVCA9IDQ7CiAgICBjb25zdCBHRU5FUklDX0ZPTlRfRkFNSUxJRVMgPSBuZXcgU2V0KFsic2VyaWYiLCAic2Fucy1zZXJpZiIsICJtb25vc3BhY2UiLCAiY3Vyc2l2ZSIsICJmYW50YXN5IiwgInN5c3RlbS11aSIsICJ1aS1zZXJpZiIsICJ1aS1zYW5zLXNlcmlmIiwgInVpLW1vbm9zcGFjZSIsICJ1aS1yb3VuZGVkIiwgIm1hdGgiLCAiZW1vamkiLCAiZmFuZ3NvbmciXSk7CiAgICBjb25zdCBERUZBVUxUX09QVFMgPSB7CiAgICAgICAgdGltZW91dDogNjAKICAgIH07CiAgICBjb25zdCB0ZW1wQ29sb3IgPSBuZXcgQzMuQ29sb3IoMCwgMCwgMCwgMSk7CiAgICBjb25zdCBWQUxJRF9IT1JJWl9BTElHTk1FTlRTID0gbmV3IFNldChbImxlZnQiLCAiY2VudGVyIiwgInJpZ2h0Il0pOwogICAgY29uc3QgVkFMSURfVkVSVF9BTElHTk1FTlRTID0gbmV3IFNldChbInRvcCIsICJjZW50ZXIiLCAiYm90dG9tIl0pOwogICAgY29uc3QgVkFMSURfV09SRF9XUkFQX01PREVTID0gbmV3IFNldChbIndvcmQiLCAiY2hhcmFjdGVyIl0pOwogICAgY29uc3QgYWxsUmVuZGVyZXJUZXh0cyA9IG5ldyBTZXQ7CiAgICBpZiAoQzMuRm9udE1hbmFnZXIpIEMzLkZvbnRNYW5hZ2VyLmFkZEV2ZW50TGlzdGVuZXIoImZvbnRsb2FkIiwgZSA9PiB7CiAgICAgICAgY29uc3QgZm9udE5hbWUgPSBlLmZvbnQuR2V0TmFtZSgpOwogICAgICAgIGZvciAoY29uc3QgZiBvZiBhbGxSZW5kZXJlclRleHRzKQogICAgICAgICAgICBpZiAoZi5Jc0JCQ29kZUVuYWJsZWQoKSB8fCBDMy5lcXVhbHNOb0Nhc2UoZi5HZXRGb250TmFtZSgpLCBmb250TmFtZSkpIGYuX1NldFRleHRDaGFuZ2VkKCkKICAgIH0pOwoKICAgIGZ1bmN0aW9uIGZpbGxPclN0cm9rZVRleHQoY3R4LCBpc1N0cm9rZSwgdGV4dCwgeCwgeSwgbWF4V2lkdGgpIHsKICAgICAgICBpZiAoaXNTdHJva2UpCiAgICAgICAgICAgIGlmIChDMy5QbGF0Zm9ybS5Ccm93c2VyRW5naW5lID09PSAiR2Vja28iKSBjdHguc3Ryb2tlVGV4dCh0ZXh0LCB4LCB5LCBtYXhXaWR0aCk7CiAgICAgICAgICAgIGVsc2UgY3R4LnN0cm9rZVRleHQodGV4dCwgeCwgeSk7CiAgICAgICAgZWxzZSBpZiAoQzMuUGxhdGZvcm0uQnJvd3NlckVuZ2luZSA9PT0gIkdlY2tvIikgY3R4LmZpbGxUZXh0KHRleHQsIHgsIHksIG1heFdpZHRoKTsKICAgICAgICBlbHNlIGN0eC5maWxsVGV4dCh0ZXh0LCB4LCB5KQogICAgfQoKICAgIGZ1bmN0aW9uIGZpbGxPclN0cm9rZVJlY3QoY3R4LCBpc1N0cm9rZSwgeCwgeSwgdywgaCkgewogICAgICAgIGlmIChpc1N0cm9rZSkgY3R4LnN0cm9rZVJlY3QoeCwgeSwgdywgaCk7CiAgICAgICAgZWxzZSBjdHguZmlsbFJlY3QoeCwgeSwgdywgaCkKICAgIH0KCiAgICBmdW5jdGlvbiBwdFRvUHgocHQpIHsKICAgICAgICByZXR1cm4gcHQgKiAoNCAvIDMpCiAgICB9CiAgICBsZXQgZGlkQ2hlY2tGb3VuZEJvdW5kaW5nQm94U3VwcG9ydCA9IGZhbHNlOwogICAgbGV0IHN1cHBvcnRzRm9udEJvdW5kaW5nQm94TWVhc3VyZW1lbnRzID0gZmFsc2U7CiAgICBDMy5HZnguUmVuZGVyZXJUZXh0ID0gY2xhc3MgUmVuZGVyZXJUZXh0IHsKICAgICAgICBjb25zdHJ1Y3RvcihyZW5kZXJlciwgb3B0cykgewogICAgICAgICAgICBvcHRzID0gT2JqZWN0LmFzc2lnbih7fSwgREVGQVVMVF9PUFRTLCBvcHRzKTsKICAgICAgICAgICAgdGhpcy5fcmVuZGVyZXIgPSByZW5kZXJlcjsKICAgICAgICAgICAgdGhpcy5fZm9udE5hbWUgPSAiQXJpYWwiOwogICAgICAgICAgICB0aGlzLl9mb250U2l6ZSA9IDE2OwogICAgICAgICAgICB0aGlzLl9mb250U2l6ZVNjYWxlID0gMTsKICAgICAgICAgICAgdGhpcy5fbGluZUhlaWdodCA9IDA7CiAgICAgICAgICAgIHRoaXMuX2lzQm9sZCA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl9pc0l0YWxpYyA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl9jb2xvclN0ciA9ICJibGFjayI7CiAgICAgICAgICAgIHRoaXMuX2lzQkJjb2RlRW5hYmxlZCA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLm9ubG9hZGZvbnQgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9hbHJlYWR5TG9hZGVkRm9udHMgPSBuZXcgU2V0OwogICAgICAgICAgICB0aGlzLl9ob3Jpem9udGFsQWxpZ24gPSAibGVmdCI7CiAgICAgICAgICAgIHRoaXMuX3ZlcnRpY2FsQWxpZ24gPSAidG9wIjsKICAgICAgICAgICAgdGhpcy5fdGV4dCA9ICIiOwogICAgICAgICAgICB0aGlzLl9iYlN0cmluZyA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3dyYXBwZWRUZXh0ID0gQzMuTmV3KEMzLldvcmRXcmFwKTsKICAgICAgICAgICAgdGhpcy5fd3JhcE1vZGUgPSAid29yZCI7CiAgICAgICAgICAgIHRoaXMuX3RleHRDaGFuZ2VkID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX2RyYXdNYXhDaGFyQ291bnQgPSAtMTsKICAgICAgICAgICAgdGhpcy5fZHJhd0NoYXJDb3VudCA9IDA7CiAgICAgICAgICAgIHRoaXMuX2Nzc1dpZHRoID0gMDsKICAgICAgICAgICAgdGhpcy5fY3NzSGVpZ2h0ID0gMDsKICAgICAgICAgICAgdGhpcy5fd2lkdGggPSAwOwogICAgICAgICAgICB0aGlzLl9oZWlnaHQgPSAwOwogICAgICAgICAgICB0aGlzLl96b29tID0gMTsKICAgICAgICAgICAgdGhpcy5fY2hhbmdlZCA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl90ZXh0Q2FudmFzID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fdGV4dENvbnRleHQgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9tZWFzdXJlQ29udGV4dCA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX21lYXN1cmVDb250ZXh0VG9wID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fbGFzdENhbnZhc1dpZHRoID0gLTE7CiAgICAgICAgICAgIHRoaXMuX2xhc3RDYW52YXNIZWlnaHQgPSAtMTsKICAgICAgICAgICAgdGhpcy5fbGFzdFRleHRDYW52YXNGb250ID0gIiI7CiAgICAgICAgICAgIHRoaXMuX2xhc3RNZWFzdXJlQ2FudmFzRm9udCA9ICIiOwogICAgICAgICAgICB0aGlzLl9sYXN0VGV4dENhbnZhc0ZpbGxTdHlsZSA9ICIiOwogICAgICAgICAgICB0aGlzLl9sYXN0VGV4dENhbnZhc09wYWNpdHkgPSAxOwogICAgICAgICAgICB0aGlzLl9sYXN0VGV4dENhbnZhc0xpbmVXaWR0aCA9IDE7CiAgICAgICAgICAgIHRoaXMuX21lYXN1cmVUZXh0Q2FsbGJhY2sgPSAoY2hBcnIsCiAgICAgICAgICAgICAgICBzdHlsZXMpID0+IHRoaXMuX01lYXN1cmVUZXh0KGNoQXJyLCBzdHlsZXMpOwogICAgICAgICAgICB0aGlzLl90ZXh0dXJlID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fcmNUZXggPSBuZXcgQzMuUmVjdDsKICAgICAgICAgICAgdGhpcy5fc2NhbGVGYWN0b3IgPSAxOwogICAgICAgICAgICB0aGlzLl90ZXh0dXJlVGltZW91dCA9IG5ldyBDMy5JZGxlVGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLlJlbGVhc2VUZXh0dXJlKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9TZXRUZXh0Q2FudmFzU2l6ZSg4LCA4KQogICAgICAgICAgICB9LCBvcHRzLnRpbWVvdXQpOwogICAgICAgICAgICB0aGlzLm9udGV4dHVyZXVwZGF0ZSA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3dhc1JlbGVhc2VkID0gZmFsc2U7CiAgICAgICAgICAgIGFsbFJlbmRlcmVyVGV4dHMuYWRkKHRoaXMpCiAgICAgICAgfQogICAgICAgIFJlbGVhc2UoKSB7CiAgICAgICAgICAgIHRoaXMub25sb2FkZm9udCA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX2FscmVhZHlMb2FkZWRGb250cy5jbGVhcigpOwogICAgICAgICAgICB0aGlzLl9iYlN0cmluZyA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3RleHRDYW52YXMgPSBudWxsOwogICAgICAgICAgICB0aGlzLl90ZXh0Q29udGV4dCA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX21lYXN1cmVDb250ZXh0ID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fbWVhc3VyZUNvbnRleHRUb3AgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9tZWFzdXJlVGV4dENhbGxiYWNrID0KICAgICAgICAgICAgICAgIG51bGw7CiAgICAgICAgICAgIHRoaXMuX3RleHR1cmVUaW1lb3V0LlJlbGVhc2UoKTsKICAgICAgICAgICAgdGhpcy5vbnRleHR1cmV1cGRhdGUgPSBudWxsOwogICAgICAgICAgICB0aGlzLlJlbGVhc2VUZXh0dXJlKCk7CiAgICAgICAgICAgIHRoaXMuX3dyYXBwZWRUZXh0LkNsZWFyKCk7CiAgICAgICAgICAgIHRoaXMuX3dyYXBwZWRUZXh0ID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fcmVuZGVyZXIgPSBudWxsOwogICAgICAgICAgICB0aGlzLl93YXNSZWxlYXNlZCA9IHRydWU7CiAgICAgICAgICAgIGFsbFJlbmRlcmVyVGV4dHMuZGVsZXRlKHRoaXMpCiAgICAgICAgfQogICAgICAgIF9TZXRDaGFuZ2VkKCkgewogICAgICAgICAgICB0aGlzLl9jaGFuZ2VkID0gdHJ1ZQogICAgICAgIH0KICAgICAgICBfU2V0VGV4dENoYW5nZWQoKSB7CiAgICAgICAgICAgIHRoaXMuX1NldENoYW5nZWQoKTsKICAgICAgICAgICAgdGhpcy5fd3JhcHBlZFRleHQuQ2xlYXIoKTsKICAgICAgICAgICAgdGhpcy5fdGV4dENoYW5nZWQgPSB0cnVlCiAgICAgICAgfQogICAgICAgIFNldEJCQ29kZUVuYWJsZWQoZSkgewogICAgICAgICAgICBlID0gISFlOwogICAgICAgICAgICBpZiAodGhpcy5faXNCQmNvZGVFbmFibGVkID09PSBlKSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuX2lzQkJjb2RlRW5hYmxlZCA9IGU7CiAgICAgICAgICAgIGNvbnN0IHRleHRCYXNlbGluZSA9IHRoaXMuX2lzQkJjb2RlRW5hYmxlZCA/ICJhbHBoYWJldGljIiA6ICJ0b3AiOwogICAgICAgICAgICBpZiAodGhpcy5fdGV4dENvbnRleHQpIHRoaXMuX3RleHRDb250ZXh0LnRleHRCYXNlbGluZSA9CiAgICAgICAgICAgICAgICB0ZXh0QmFzZWxpbmU7CiAgICAgICAgICAgIGlmICh0aGlzLl9tZWFzdXJlQ29udGV4dCkgdGhpcy5fbWVhc3VyZUNvbnRleHQudGV4dEJhc2VsaW5lID0gdGV4dEJhc2VsaW5lOwogICAgICAgICAgICB0aGlzLl9TZXRUZXh0Q2hhbmdlZCgpCiAgICAgICAgfQogICAgICAgIElzQkJDb2RlRW5hYmxlZCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2lzQkJjb2RlRW5hYmxlZAogICAgICAgIH0KICAgICAgICBTZXRGb250TmFtZShmb250TmFtZSkgewogICAgICAgICAgICBpZiAoIWZvbnROYW1lKSBmb250TmFtZSA9ICJzZXJpZiI7CiAgICAgICAgICAgIGlmICh0aGlzLl9mb250TmFtZSA9PT0gZm9udE5hbWUpIHJldHVybjsKICAgICAgICAgICAgdGhpcy5fZm9udE5hbWUgPSBmb250TmFtZTsKICAgICAgICAgICAgdGhpcy5fU2V0VGV4dENoYW5nZWQoKQogICAgICAgIH0KICAgICAgICBHZXRGb250TmFtZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2ZvbnROYW1lCiAgICAgICAgfQogICAgICAgIFNldEZvbnRTaXplKGZvbnRTaXplKSB7CiAgICAgICAgICAgIGlmIChmb250U2l6ZSA8IC4xKSBmb250U2l6ZSA9IC4xOwogICAgICAgICAgICBpZiAodGhpcy5fZm9udFNpemUgPT09IGZvbnRTaXplKSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuX2ZvbnRTaXplID0gZm9udFNpemU7CiAgICAgICAgICAgIHRoaXMuX1NldFRleHRDaGFuZ2VkKCkKICAgICAgICB9CiAgICAgICAgU2V0Rm9udFNpemVTY2FsZShzKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9mb250U2l6ZVNjYWxlID09PQogICAgICAgICAgICAgICAgcykgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl9mb250U2l6ZVNjYWxlID0gczsKICAgICAgICAgICAgdGhpcy5fU2V0VGV4dENoYW5nZWQoKQogICAgICAgIH0KICAgICAgICBTZXRMaW5lSGVpZ2h0KGgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX2xpbmVIZWlnaHQgPT09IGgpIHJldHVybjsKICAgICAgICAgICAgdGhpcy5fbGluZUhlaWdodCA9IGg7CiAgICAgICAgICAgIHRoaXMuX1NldENoYW5nZWQoKQogICAgICAgIH0KICAgICAgICBTZXRCb2xkKGJvbGQpIHsKICAgICAgICAgICAgYm9sZCA9ICEhYm9sZDsKICAgICAgICAgICAgaWYgKHRoaXMuX2lzQm9sZCA9PT0gYm9sZCkgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl9pc0JvbGQgPSBib2xkOwogICAgICAgICAgICB0aGlzLl9TZXRUZXh0Q2hhbmdlZCgpCiAgICAgICAgfQogICAgICAgIFNldEl0YWxpYyhpdGFsaWMpIHsKICAgICAgICAgICAgaXRhbGljID0gISFpdGFsaWM7CiAgICAgICAgICAgIGlmICh0aGlzLl9pc0l0YWxpYyA9PT0gaXRhbGljKSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuX2lzSXRhbGljID0gaXRhbGljOwogICAgICAgICAgICB0aGlzLl9TZXRUZXh0Q2hhbmdlZCgpCiAgICAgICAgfQogICAgICAgIFNldERyYXdNYXhDaGFyYWN0ZXJDb3VudChuKSB7CiAgICAgICAgICAgIG4gPSBNYXRoLmZsb29yKG4pOwogICAgICAgICAgICBpZiAodGhpcy5fZHJhd01heENoYXJDb3VudCA9PT0gbikgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl9kcmF3TWF4Q2hhckNvdW50ID0gbjsKICAgICAgICAgICAgdGhpcy5fU2V0Q2hhbmdlZCgpCiAgICAgICAgfQogICAgICAgIEdldERyYXdNYXhDaGFyYWN0ZXJDb3VudCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2RyYXdNYXhDaGFyQ291bnQKICAgICAgICB9CiAgICAgICAgX0dldFN0eWxlVGFnKHN0eWxlcywKICAgICAgICAgICAgdGFnKSB7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSBzdHlsZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHMgPSBzdHlsZXNbaV07CiAgICAgICAgICAgICAgICBpZiAocy50YWcgPT09IHRhZykgcmV0dXJuIHMKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gbnVsbAogICAgICAgIH0KICAgICAgICBfSGFzU3R5bGVUYWcoc3R5bGVzLCB0YWcpIHsKICAgICAgICAgICAgcmV0dXJuICEhdGhpcy5fR2V0U3R5bGVUYWcoc3R5bGVzLCB0YWcpCiAgICAgICAgfQogICAgICAgIF9HZXRGb250U3RyaW5nKHVzZUNzc1VuaXRzLCBzdHlsZXMpIHsKICAgICAgICAgICAgbGV0IHJldCA9IFtdOwogICAgICAgICAgICBpZiAodGhpcy5faXNCb2xkIHx8IHRoaXMuX0hhc1N0eWxlVGFnKHN0eWxlcywgImIiKSkgcmV0LnB1c2goImJvbGQiKTsKICAgICAgICAgICAgaWYgKHRoaXMuX2lzSXRhbGljIHx8IHRoaXMuX0hhc1N0eWxlVGFnKHN0eWxlcywgImkiKSkgcmV0LnB1c2goIml0YWxpYyIpOwogICAgICAgICAgICBjb25zdCBzaXplU3R5bGUgPSB0aGlzLl9HZXRTdHlsZVRhZyhzdHlsZXMsICJzaXplIik7CiAgICAgICAgICAgIGNvbnN0IGZvbnRTaXplID0gKHNpemVTdHlsZSA/IHBhcnNlRmxvYXQoc2l6ZVN0eWxlLnBhcmFtKSA6IHRoaXMuX2ZvbnRTaXplKSAqIHRoaXMuX2ZvbnRTaXplU2NhbGU7CiAgICAgICAgICAgIGlmICh1c2VDc3NVbml0cykgcmV0LnB1c2goZm9udFNpemUgKwogICAgICAgICAgICAgICAgInB0Iik7CiAgICAgICAgICAgIGVsc2UgcmV0LnB1c2goZm9udFNpemUgKiB0aGlzLkdldERyYXdTY2FsZSgpICsgInB0Iik7CiAgICAgICAgICAgIGxldCBmb250TmFtZSA9IHRoaXMuX2ZvbnROYW1lOwogICAgICAgICAgICBjb25zdCBmb250U3R5bGUgPSB0aGlzLl9HZXRTdHlsZVRhZyhzdHlsZXMsICJmb250Iik7CiAgICAgICAgICAgIGlmIChmb250U3R5bGUgJiYgZm9udFN0eWxlLnBhcmFtKSB7CiAgICAgICAgICAgICAgICBmb250TmFtZSA9IGZvbnRTdHlsZS5wYXJhbTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLm9ubG9hZGZvbnQgJiYgIXRoaXMuX2FscmVhZHlMb2FkZWRGb250cy5oYXMoZm9udE5hbWUpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5vbmxvYWRmb250KGZvbnROYW1lKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9hbHJlYWR5TG9hZGVkRm9udHMuYWRkKGZvbnROYW1lKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChmb250TmFtZSkKICAgICAgICAgICAgICAgIGlmIChHRU5FUklDX0ZPTlRfRkFNSUxJRVMuaGFzKGZvbnROYW1lKSkgcmV0LnB1c2goZm9udE5hbWUpOwogICAgICAgICAgICAgICAgZWxzZSByZXQucHVzaCgnIicgKyBmb250TmFtZSArICciJyk7CiAgICAgICAgICAgIHJldHVybiByZXQuam9pbigiICIpCiAgICAgICAgfQogICAgICAgIFNldENvbG9yKGMpIHsKICAgICAgICAgICAgaWYgKGMgaW5zdGFuY2VvZiBDMy5Db2xvcikgYyA9IGMuZ2V0Q3NzUmdiKCk7CiAgICAgICAgICAgIGlmICh0aGlzLl9jb2xvclN0ciA9PT0KICAgICAgICAgICAgICAgIGMpIHJldHVybjsKICAgICAgICAgICAgdGhpcy5fY29sb3JTdHIgPSBjOwogICAgICAgICAgICB0aGlzLl9TZXRDaGFuZ2VkKCkKICAgICAgICB9CiAgICAgICAgU2V0Q29sb3JSZ2IociwgZywgYikgewogICAgICAgICAgICB0ZW1wQ29sb3Iuc2V0UmdiKHIsIGcsIGIpOwogICAgICAgICAgICB0aGlzLlNldENvbG9yKHRlbXBDb2xvcikKICAgICAgICB9CiAgICAgICAgU2V0SG9yaXpvbnRhbEFsaWdubWVudChoKSB7CiAgICAgICAgICAgIGlmICghVkFMSURfSE9SSVpfQUxJR05NRU5UUy5oYXMoaCkpIHRocm93IG5ldyBFcnJvcigiaW52YWxpZCBob3Jpem9udGFsIGFsaWdubWVudCIpOwogICAgICAgICAgICBpZiAodGhpcy5faG9yaXpvbnRhbEFsaWduID09PSBoKSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuX2hvcml6b250YWxBbGlnbiA9IGg7CiAgICAgICAgICAgIHRoaXMuX1NldENoYW5nZWQoKQogICAgICAgIH0KICAgICAgICBTZXRWZXJ0aWNhbEFsaWdubWVudCh2KSB7CiAgICAgICAgICAgIGlmICghVkFMSURfVkVSVF9BTElHTk1FTlRTLmhhcyh2KSkgdGhyb3cgbmV3IEVycm9yKCJpbnZhbGlkIHZlcnRpY2FsIGFsaWdubWVudCIpOwogICAgICAgICAgICBpZiAodGhpcy5fdmVydGljYWxBbGlnbiA9PT0gdikgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl92ZXJ0aWNhbEFsaWduID0gdjsKICAgICAgICAgICAgdGhpcy5fU2V0Q2hhbmdlZCgpCiAgICAgICAgfQogICAgICAgIFNldFdvcmRXcmFwTW9kZShtKSB7CiAgICAgICAgICAgIGlmICghVkFMSURfV09SRF9XUkFQX01PREVTLmhhcyhtKSkgdGhyb3cgbmV3IEVycm9yKCJpbnZhbGlkIHdvcmQgd3JhcCBtb2RlIik7CiAgICAgICAgICAgIGlmICh0aGlzLl93cmFwTW9kZSA9PT0gbSkgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl93cmFwTW9kZSA9IG07CiAgICAgICAgICAgIHRoaXMuX1NldFRleHRDaGFuZ2VkKCkKICAgICAgICB9CiAgICAgICAgU2V0VGV4dCh0ZXh0KSB7CiAgICAgICAgICAgIGlmICh0aGlzLl90ZXh0ID09PSB0ZXh0KSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuX3RleHQgPSB0ZXh0OwogICAgICAgICAgICB0aGlzLl9TZXRUZXh0Q2hhbmdlZCgpCiAgICAgICAgfQogICAgICAgIEdldERyYXdTY2FsZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NjYWxlRmFjdG9yICogdGhpcy5fem9vbSAqIHNlbGYuZGV2aWNlUGl4ZWxSYXRpbwogICAgICAgIH0KICAgICAgICBTZXRTaXplKGNzc1dpZHRoLCBjc3NIZWlnaHQsIHpvb20pIHsKICAgICAgICAgICAgaWYgKHR5cGVvZiB6b29tID09PSAidW5kZWZpbmVkIikgem9vbSA9IDE7CiAgICAgICAgICAgIGlmIChjc3NXaWR0aCA8PSAwIHx8IGNzc1dpZHRoIDw9IDApIHJldHVybjsKICAgICAgICAgICAgaWYgKHRoaXMuX2Nzc1dpZHRoID09PSBjc3NXaWR0aCAmJiB0aGlzLl9jc3NIZWlnaHQgPT09IGNzc0hlaWdodCAmJiB0aGlzLl96b29tID09PSB6b29tKSByZXR1cm47CiAgICAgICAgICAgIGNvbnN0IG9sZENzc1dpZHRoID0gdGhpcy5fY3NzV2lkdGg7CiAgICAgICAgICAgIHRoaXMuX2Nzc1dpZHRoID0gY3NzV2lkdGg7CiAgICAgICAgICAgIHRoaXMuX2Nzc0hlaWdodCA9IGNzc0hlaWdodDsKICAgICAgICAgICAgdGhpcy5fem9vbSA9CiAgICAgICAgICAgICAgICB6b29tOwogICAgICAgICAgICBjb25zdCBkcHIgPSBzZWxmLmRldmljZVBpeGVsUmF0aW87CiAgICAgICAgICAgIHRoaXMuX3dpZHRoID0gdGhpcy5fY3NzV2lkdGggKiB0aGlzLl96b29tICogZHByOwogICAgICAgICAgICB0aGlzLl9oZWlnaHQgPSB0aGlzLl9jc3NIZWlnaHQgKiB0aGlzLl96b29tICogZHByOwogICAgICAgICAgICBjb25zdCBtYXhEaW0gPSBNYXRoLm1heCh0aGlzLl93aWR0aCwgdGhpcy5faGVpZ2h0KTsKICAgICAgICAgICAgY29uc3QgbWF4VGV4dHVyZVNpemUgPSBNYXRoLm1pbih0aGlzLl9yZW5kZXJlci5HZXRNYXhUZXh0dXJlU2l6ZSgpLCBNQVhfVEVYVFVSRV9TSVpFKTsKICAgICAgICAgICAgbGV0IHNjYWxlID0gMTsKICAgICAgICAgICAgaWYgKG1heERpbSA+IG1heFRleHR1cmVTaXplKSB7CiAgICAgICAgICAgICAgICBzY2FsZSA9IG1heFRleHR1cmVTaXplIC8gbWF4RGltOwogICAgICAgICAgICAgICAgdGhpcy5fd2lkdGggPSBNYXRoLm1pbih0aGlzLl93aWR0aCAqIHNjYWxlLCBtYXhUZXh0dXJlU2l6ZSk7CiAgICAgICAgICAgICAgICB0aGlzLl9oZWlnaHQgPSBNYXRoLm1pbih0aGlzLl9oZWlnaHQgKiBzY2FsZSwgbWF4VGV4dHVyZVNpemUpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5fc2NhbGVGYWN0b3IgPSBzY2FsZTsKICAgICAgICAgICAgaWYgKHRoaXMuX2Nzc1dpZHRoICE9PSBvbGRDc3NXaWR0aCkgdGhpcy5fU2V0VGV4dENoYW5nZWQoKTsKICAgICAgICAgICAgZWxzZSB0aGlzLl9TZXRDaGFuZ2VkKCkKICAgICAgICB9CiAgICAgICAgR2V0V2lkdGgoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl93aWR0aAogICAgICAgIH0KICAgICAgICBHZXRIZWlnaHQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9oZWlnaHQKICAgICAgICB9CiAgICAgICAgR2V0Wm9vbSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3pvb20KICAgICAgICB9CiAgICAgICAgR2V0VGV4dFdpZHRoKCkgewogICAgICAgICAgICB0aGlzLl9NYXliZVdyYXBUZXh0KCk7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl93cmFwcGVkVGV4dC5HZXRNYXhMaW5lV2lkdGgoKQogICAgICAgIH0KICAgICAgICBHZXRUZXh0SGVpZ2h0KCkgewogICAgICAgICAgICB0aGlzLl9NYXliZVdyYXBUZXh0KCk7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl93cmFwcGVkVGV4dC5HZXRUb3RhbExpbmVIZWlnaHQoKSArIHRoaXMuX3dyYXBwZWRUZXh0LkdldExpbmVDb3VudCgpICogKHRoaXMuX2xpbmVIZWlnaHQgKyBFWFRSQV9MSU5FX0hFSUdIVCkgLSB0aGlzLl9saW5lSGVpZ2h0CiAgICAgICAgfQogICAgICAgIEdldFRleHR1cmUoKSB7CiAgICAgICAgICAgIHRoaXMuX3RleHR1cmVUaW1lb3V0LlJlc2V0KCk7CiAgICAgICAgICAgIHRoaXMuX01heWJlVXBkYXRlKCk7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl90ZXh0dXJlCiAgICAgICAgfQogICAgICAgIEhpdFRlc3RGcmFnbWVudCh4LCB5KSB7CiAgICAgICAgICAgIHRoaXMuX01heWJlVXBkYXRlKCk7CiAgICAgICAgICAgIGNvbnN0IHNjYWxlID0KICAgICAgICAgICAgICAgIHRoaXMuR2V0RHJhd1NjYWxlKCk7CiAgICAgICAgICAgIGNvbnN0IGxpbmVzID0gdGhpcy5fd3JhcHBlZFRleHQuR2V0TGluZXMoKTsKICAgICAgICAgICAgZm9yIChjb25zdCBsaW5lIG9mIGxpbmVzKSB7CiAgICAgICAgICAgICAgICBjb25zdCB5T2ZmID0gbGluZS5mb250Qm91bmRpbmdCb3hEZXNjZW50ICogc2NhbGU7CiAgICAgICAgICAgICAgICBpZiAoeSA+PSBsaW5lLnBlblkgLSBsaW5lLmhlaWdodCAqIHNjYWxlICsgeU9mZiAmJiB5IDwgbGluZS5wZW5ZICsgeU9mZikKICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGZyYWcgb2YgbGluZS5mcmFnbWVudHMpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh4ID49IGZyYWcucGVuWCAmJiB4IDwgZnJhZy5wZW5YICsgZnJhZy53aWR0aCAqIHNjYWxlKSByZXR1cm4gZnJhZwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBudWxsCiAgICAgICAgfSogZnJhZ21lbnRzV2l0aFRhZyh0YWcpIHsKICAgICAgICAgICAgdGhpcy5fTWF5YmVVcGRhdGUoKTsKICAgICAgICAgICAgY29uc3QgbGluZXMgPSB0aGlzLl93cmFwcGVkVGV4dC5HZXRMaW5lcygpOwogICAgICAgICAgICBmb3IgKGNvbnN0IGxpbmUgb2YgbGluZXMpCiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGZyYWcgb2YgbGluZS5mcmFnbWVudHMpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCB0YWdTdHlsZSA9IHRoaXMuX0dldFN0eWxlVGFnKGZyYWcuc3R5bGVzLCAidGFnIik7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRhZ1N0eWxlICYmIEMzLmVxdWFsc05vQ2FzZSh0YWdTdHlsZS5wYXJhbSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhZykpIHlpZWxkIGZyYWcKICAgICAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgRmluZEZyYWdtZW50V2l0aFRhZyh0YWcsIGluZGV4KSB7CiAgICAgICAgICAgIGZvciAoY29uc3QgZnJhZyBvZiB0aGlzLmZyYWdtZW50c1dpdGhUYWcodGFnKSkKICAgICAgICAgICAgICAgIGlmIChpbmRleCA9PT0gMCkgcmV0dXJuIGZyYWc7CiAgICAgICAgICAgICAgICBlbHNlIC0taW5kZXg7CiAgICAgICAgICAgIHJldHVybiBudWxsCiAgICAgICAgfQogICAgICAgIENvdW50RnJhZ21lbnRzV2l0aFRhZyh0YWcpIHsKICAgICAgICAgICAgbGV0IGNvdW50ID0gMDsKICAgICAgICAgICAgZm9yIChjb25zdCBmcmFnIG9mIHRoaXMuZnJhZ21lbnRzV2l0aFRhZyh0YWcpKSArK2NvdW50OwogICAgICAgICAgICByZXR1cm4gY291bnQKICAgICAgICB9CiAgICAgICAgX01heWJlVXBkYXRlKCkgewogICAgICAgICAgICBpZiAodGhpcy5fdGV4dHVyZSAmJiAhdGhpcy5fY2hhbmdlZCAmJiAhdGhpcy5fdGV4dENoYW5nZWQpIHJldHVybjsKICAgICAgICAgICAgaWYgKHRoaXMuX3dhc1JlbGVhc2VkKSByZXR1cm47CiAgICAgICAgICAgIGlmICh0aGlzLl93aWR0aCA8PSAwIHx8IHRoaXMuX2hlaWdodCA8PSAwKSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuX2NoYW5nZWQgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5fRG9VcGRhdGUoKQogICAgICAgIH0KICAgICAgICBfRG9VcGRhdGUoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl93YXNSZWxlYXNlZCkgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl9TZXRUZXh0Q2FudmFzU2l6ZShNYXRoLm1heChDMy5uZXh0SGlnaGVzdFBvd2VyT2ZUd28oTWF0aC5jZWlsKHRoaXMuX3dpZHRoKSksCiAgICAgICAgICAgICAgICAxMjgpLCBNYXRoLm1heChDMy5uZXh0SGlnaGVzdFBvd2VyT2ZUd28oTWF0aC5jZWlsKHRoaXMuX2hlaWdodCkpLCA2NCkpOwogICAgICAgICAgICB0aGlzLl9NYXliZVdyYXBUZXh0KCk7CiAgICAgICAgICAgIHRoaXMuX0RyYXdUZXh0VG9DYW52YXMoKTsKICAgICAgICAgICAgdGhpcy5fVXBkYXRlVGV4dHVyZSgpOwogICAgICAgICAgICB0aGlzLl90ZXh0dXJlVGltZW91dC5SZXNldCgpCiAgICAgICAgfQogICAgICAgIF9TZXRUZXh0Q2FudmFzU2l6ZSh3LCBoKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5fdGV4dENhbnZhcykgdGhpcy5fdGV4dENhbnZhcyA9IEMzLkNyZWF0ZUNhbnZhcygxNiwgMTYpOwogICAgICAgICAgICBsZXQgd2FzUmVzZXQgPSBmYWxzZTsKICAgICAgICAgICAgaWYgKHRoaXMuX2xhc3RDYW52YXNXaWR0aCAhPT0gdyB8fCB0aGlzLl9sYXN0Q2FudmFzSGVpZ2h0ICE9PSBoKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9sYXN0Q2FudmFzV2lkdGggPSB3OwogICAgICAgICAgICAgICAgdGhpcy5fbGFzdENhbnZhc0hlaWdodCA9IGg7CiAgICAgICAgICAgICAgICB0aGlzLl90ZXh0Q2FudmFzLndpZHRoID0gdzsKICAgICAgICAgICAgICAgIHRoaXMuX3RleHRDYW52YXMuaGVpZ2h0ID0gaDsKICAgICAgICAgICAgICAgIHdhc1Jlc2V0ID0gdHJ1ZQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghdGhpcy5fdGV4dENvbnRleHQpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3RleHRDb250ZXh0ID0gdGhpcy5fdGV4dENhbnZhcy5nZXRDb250ZXh0KCIyZCIpOwogICAgICAgICAgICAgICAgd2FzUmVzZXQgPSB0cnVlCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHdhc1Jlc2V0KSB7CiAgICAgICAgICAgICAgICB0aGlzLl90ZXh0Q29udGV4dC50ZXh0QmFzZWxpbmUgPSB0aGlzLl9pc0JCY29kZUVuYWJsZWQgPyAiYWxwaGFiZXRpYyIgOiAidG9wIjsKICAgICAgICAgICAgICAgIHRoaXMuX3RleHRDb250ZXh0LmZvbnQgPSB0aGlzLl9sYXN0VGV4dENhbnZhc0ZvbnQ7CiAgICAgICAgICAgICAgICB0aGlzLl90ZXh0Q29udGV4dC5maWxsU3R5bGUgPSB0aGlzLl9sYXN0VGV4dENhbnZhc0ZpbGxTdHlsZTsKICAgICAgICAgICAgICAgIHRoaXMuX3RleHRDb250ZXh0LnN0cm9rZVN0eWxlID0gdGhpcy5fbGFzdFRleHRDYW52YXNGaWxsU3R5bGU7CiAgICAgICAgICAgICAgICB0aGlzLl90ZXh0Q29udGV4dC5nbG9iYWxBbHBoYSA9IHRoaXMuX2xhc3RUZXh0Q2FudmFzT3BhY2l0eTsKICAgICAgICAgICAgICAgIHRoaXMuX3RleHRDb250ZXh0LmxpbmVXaWR0aCA9IHRoaXMuX2xhc3RUZXh0Q2FudmFzTGluZVdpZHRoCiAgICAgICAgICAgIH0gZWxzZSB0aGlzLl90ZXh0Q29udGV4dC5jbGVhclJlY3QoMCwgMCwgdywgaCkKICAgICAgICB9CiAgICAgICAgX01heWJlQ3JlYXRlTWVhc3VyZUNvbnRleHQoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9tZWFzdXJlQ29udGV4dCkgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl9tZWFzdXJlQ29udGV4dCA9CiAgICAgICAgICAgICAgICBDMy5DcmVhdGVDYW52YXMoMTYsIDE2KS5nZXRDb250ZXh0KCIyZCIpOwogICAgICAgICAgICB0aGlzLl9tZWFzdXJlQ29udGV4dFRvcCA9IEMzLkNyZWF0ZUNhbnZhcygxNiwgMTYpLmdldENvbnRleHQoIjJkIik7CiAgICAgICAgICAgIHRoaXMuX21lYXN1cmVDb250ZXh0LnRleHRCYXNlbGluZSA9IHRoaXMuX2lzQkJjb2RlRW5hYmxlZCA/ICJhbHBoYWJldGljIiA6ICJ0b3AiOwogICAgICAgICAgICB0aGlzLl9tZWFzdXJlQ29udGV4dFRvcC50ZXh0QmFzZWxpbmUgPSAidG9wIgogICAgICAgIH0KICAgICAgICBfU2V0TWVhc3VyZUZvbnRTdHJpbmcoZm9udFN0cmluZykgewogICAgICAgICAgICBpZiAodGhpcy5fbGFzdE1lYXN1cmVDYW52YXNGb250ID09PSBmb250U3RyaW5nKSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuX2xhc3RNZWFzdXJlQ2FudmFzRm9udCA9IGZvbnRTdHJpbmc7CiAgICAgICAgICAgIHRoaXMuX21lYXN1cmVDb250ZXh0LmZvbnQgPSBmb250U3RyaW5nOwogICAgICAgICAgICB0aGlzLl9tZWFzdXJlQ29udGV4dFRvcC5mb250ID0gZm9udFN0cmluZwogICAgICAgIH0KICAgICAgICBfU3VwcG9ydHNGb250Qm91bmRpbmdCb3hNZWFzdXJlbWVudHMoKSB7CiAgICAgICAgICAgIGlmICghZGlkQ2hlY2tGb3VuZEJvdW5kaW5nQm94U3VwcG9ydCkgewogICAgICAgICAgICAgICAgZGlkQ2hlY2tGb3VuZEJvdW5kaW5nQm94U3VwcG9ydCA9CiAgICAgICAgICAgICAgICAgICAgdHJ1ZTsKICAgICAgICAgICAgICAgIHRoaXMuX01heWJlQ3JlYXRlTWVhc3VyZUNvbnRleHQoKTsKICAgICAgICAgICAgICAgIGNvbnN0IHRleHRNZXRyaWNzID0gdGhpcy5fbWVhc3VyZUNvbnRleHQubWVhc3VyZVRleHQoInRlc3QiKTsKICAgICAgICAgICAgICAgIHN1cHBvcnRzRm9udEJvdW5kaW5nQm94TWVhc3VyZW1lbnRzID0gdHlwZW9mIHRleHRNZXRyaWNzWyJmb250Qm91bmRpbmdCb3hBc2NlbnQiXSA9PT0gIm51bWJlciIgJiYgdHlwZW9mIHRleHRNZXRyaWNzWyJmb250Qm91bmRpbmdCb3hEZXNjZW50Il0gPT09ICJudW1iZXIiCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHN1cHBvcnRzRm9udEJvdW5kaW5nQm94TWVhc3VyZW1lbnRzCiAgICAgICAgfQogICAgICAgIF9NYXliZVdyYXBUZXh0KCkgewogICAgICAgICAgICBpZiAoIXRoaXMuX3RleHRDaGFuZ2VkKSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuX01heWJlQ3JlYXRlTWVhc3VyZUNvbnRleHQoKTsKICAgICAgICAgICAgaWYgKHRoaXMuX2lzQkJjb2RlRW5hYmxlZCAmJiAoIXRoaXMuX2JiU3RyaW5nIHx8IHRoaXMuX2JiU3RyaW5nLnRvU3RyaW5nKCkgIT09IHRoaXMuX3RleHQpKSB0aGlzLl9iYlN0cmluZyA9IG5ldyBDMy5CQlN0cmluZyh0aGlzLl90ZXh0LCB7CiAgICAgICAgICAgICAgICBub0VzY2FwZTogdHJ1ZQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdGhpcy5fd3JhcHBlZFRleHQuV29yZFdyYXAodGhpcy5faXNCQmNvZGVFbmFibGVkID8gdGhpcy5fYmJTdHJpbmcudG9GcmFnbWVudExpc3QoKSA6IHRoaXMuX3RleHQsIHRoaXMuX21lYXN1cmVUZXh0Q2FsbGJhY2ssIHRoaXMuX2Nzc1dpZHRoLCB0aGlzLl93cmFwTW9kZSwgMCk7CiAgICAgICAgICAgIHRoaXMuX3RleHRDaGFuZ2VkID0gZmFsc2UKICAgICAgICB9CiAgICAgICAgX01lYXN1cmVUZXh0KGNoQXJyLCBzdHlsZXMpIHsKICAgICAgICAgICAgY29uc3QgdGV4dCA9IGNoQXJyLmpvaW4oIiIpOwogICAgICAgICAgICB0aGlzLl9TZXRNZWFzdXJlRm9udFN0cmluZyh0aGlzLl9HZXRGb250U3RyaW5nKHRydWUsIHN0eWxlcykpOwogICAgICAgICAgICBjb25zdCBzaXplU3R5bGUgPSB0aGlzLl9HZXRTdHlsZVRhZyhzdHlsZXMsICJzaXplIik7CiAgICAgICAgICAgIGNvbnN0IGZvbnRTaXplID0gKHNpemVTdHlsZSA/IHBhcnNlRmxvYXQoc2l6ZVN0eWxlLnBhcmFtKSA6IHRoaXMuX2ZvbnRTaXplKSAqIHRoaXMuX2ZvbnRTaXplU2NhbGU7CiAgICAgICAgICAgIGNvbnN0IHRleHRNZXRyaWNzID0gdGhpcy5fbWVhc3VyZUNvbnRleHQubWVhc3VyZVRleHQodGV4dCk7CiAgICAgICAgICAgIGxldCB0b3BUb0FscGhhYmV0aWNEaXN0YW5jZSA9CiAgICAgICAgICAgICAgICAwOwogICAgICAgICAgICBpZiAodGhpcy5faXNCQmNvZGVFbmFibGVkICYmIHRoaXMuX1N1cHBvcnRzRm9udEJvdW5kaW5nQm94TWVhc3VyZW1lbnRzKCkpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHRleHRNZXRyaWNzVG9wID0gdGhpcy5fbWVhc3VyZUNvbnRleHRUb3AubWVhc3VyZVRleHQodGV4dCk7CiAgICAgICAgICAgICAgICB0b3BUb0FscGhhYmV0aWNEaXN0YW5jZSA9IHRleHRNZXRyaWNzWyJmb250Qm91bmRpbmdCb3hBc2NlbnQiXSAtIHRleHRNZXRyaWNzVG9wWyJmb250Qm91bmRpbmdCb3hBc2NlbnQiXQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICB3aWR0aDogdGV4dE1ldHJpY3Mud2lkdGgsCiAgICAgICAgICAgICAgICBoZWlnaHQ6IHB0VG9QeChmb250U2l6ZSksCiAgICAgICAgICAgICAgICBmb250Qm91bmRpbmdCb3hBc2NlbnQ6IHRleHRNZXRyaWNzWyJmb250Qm91bmRpbmdCb3hBc2NlbnQiXSB8fCAwLAogICAgICAgICAgICAgICAgZm9udEJvdW5kaW5nQm94RGVzY2VudDogdGV4dE1ldHJpY3NbImZvbnRCb3VuZGluZ0JveERlc2NlbnQiXSB8fCAwLAogICAgICAgICAgICAgICAgdG9wVG9BbHBoYWJldGljRGlzdGFuY2UKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBfU2V0RHJhd0ZvbnRTdHJpbmcoZm9udFN0cmluZykgewogICAgICAgICAgICBpZiAodGhpcy5fbGFzdFRleHRDYW52YXNGb250ID09PQogICAgICAgICAgICAgICAgZm9udFN0cmluZykgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl9sYXN0VGV4dENhbnZhc0ZvbnQgPSBmb250U3RyaW5nOwogICAgICAgICAgICB0aGlzLl90ZXh0Q29udGV4dC5mb250ID0gZm9udFN0cmluZwogICAgICAgIH0KICAgICAgICBfU2V0RHJhd0NhbnZhc0NvbG9yKHN0eWxlU3RyKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9sYXN0VGV4dENhbnZhc0ZpbGxTdHlsZSA9PT0gc3R5bGVTdHIpIHJldHVybjsKICAgICAgICAgICAgdGhpcy5fbGFzdFRleHRDYW52YXNGaWxsU3R5bGUgPSBzdHlsZVN0cjsKICAgICAgICAgICAgdGhpcy5fdGV4dENvbnRleHQuZmlsbFN0eWxlID0gc3R5bGVTdHI7CiAgICAgICAgICAgIHRoaXMuX3RleHRDb250ZXh0LnN0cm9rZVN0eWxlID0gc3R5bGVTdHIKICAgICAgICB9CiAgICAgICAgX1NldERyYXdDYW52YXNPcGFjaXR5KG8pIHsKICAgICAgICAgICAgaWYgKHRoaXMuX2xhc3RUZXh0Q2FudmFzT3BhY2l0eSA9PT0gbykgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl9sYXN0VGV4dENhbnZhc09wYWNpdHkgPSBvOwogICAgICAgICAgICB0aGlzLl90ZXh0Q29udGV4dC5nbG9iYWxBbHBoYSA9IG8KICAgICAgICB9CiAgICAgICAgX1NldERyYXdDYW52YXNMaW5lV2l0aCh3KSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9sYXN0VGV4dENhbnZhc0xpbmVXaWR0aCA9PT0gdykgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl9sYXN0VGV4dENhbnZhc0xpbmVXaWR0aCA9CiAgICAgICAgICAgICAgICB3OwogICAgICAgICAgICB0aGlzLl90ZXh0Q29udGV4dC5saW5lV2lkdGggPSB3CiAgICAgICAgfQogICAgICAgIF9EcmF3VGV4dFRvQ2FudmFzKCkgewogICAgICAgICAgICB0aGlzLl9kcmF3Q2hhckNvdW50ID0gMDsKICAgICAgICAgICAgY29uc3Qgc2NhbGUgPSB0aGlzLkdldERyYXdTY2FsZSgpOwogICAgICAgICAgICBjb25zdCBsaW5lU3BhY2VIZWlnaHQgPSAoRVhUUkFfTElORV9IRUlHSFQgKyB0aGlzLl9saW5lSGVpZ2h0KSAqIHNjYWxlOwogICAgICAgICAgICBsZXQgcGVuWSA9IDA7CiAgICAgICAgICAgIGNvbnN0IGxpbmVzID0gdGhpcy5fd3JhcHBlZFRleHQuR2V0TGluZXMoKTsKICAgICAgICAgICAgaWYgKGxpbmVzLmxlbmd0aCA9PT0gMCkgcmV0dXJuOwogICAgICAgICAgICBjb25zdCB1c2VGb250Qm91bmRpbmdCb3hNZWFzdXJlbWVudHMgPSB0aGlzLl9pc0JCY29kZUVuYWJsZWQgJiYgdGhpcy5fU3VwcG9ydHNGb250Qm91bmRpbmdCb3hNZWFzdXJlbWVudHMoKTsKICAgICAgICAgICAgbGV0IGZpcnN0TGluZVRleHRIZWlnaHQgPSBsaW5lc1swXS5oZWlnaHQgKiBzY2FsZTsKICAgICAgICAgICAgaWYgKHRoaXMuX3ZlcnRpY2FsQWxpZ24gPT09ICJjZW50ZXIiKSB7CiAgICAgICAgICAgICAgICBjb25zdCBsaW5lc1RvdGFsSGVpZ2h0ID0gbGluZXMucmVkdWNlKChhLCB2KSA9PiBhICsgdi5oZWlnaHQgKiBzY2FsZSArIGxpbmVTcGFjZUhlaWdodCwKICAgICAgICAgICAgICAgICAgICAwKSAtIGxpbmVTcGFjZUhlaWdodDsKICAgICAgICAgICAgICAgIHBlblkgPSBNYXRoLm1heCh0aGlzLl9oZWlnaHQgLyAyIC0gbGluZXNUb3RhbEhlaWdodCAvIDIsIDApOwogICAgICAgICAgICAgICAgaWYgKHVzZUZvbnRCb3VuZGluZ0JveE1lYXN1cmVtZW50cykgZmlyc3RMaW5lVGV4dEhlaWdodCA9IGxpbmVzWzBdLnRvcFRvQWxwaGFiZXRpY0Rpc3RhbmNlICogc2NhbGUKICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLl92ZXJ0aWNhbEFsaWduID09PSAiYm90dG9tIikgewogICAgICAgICAgICAgICAgY29uc3QgbGluZXNUb3RhbEhlaWdodCA9IGxpbmVzLnJlZHVjZSgoYSwgdikgPT4gYSArIHYuaGVpZ2h0ICogc2NhbGUgKyBsaW5lU3BhY2VIZWlnaHQsIDApIC0gdGhpcy5fbGluZUhlaWdodCAqIHNjYWxlOwogICAgICAgICAgICAgICAgY29uc3QgbGFzdExpbmVEZXNjZW50SGVpZ2h0ID0gdXNlRm9udEJvdW5kaW5nQm94TWVhc3VyZW1lbnRzID8gbGluZXMuYXQoLTEpLmZvbnRCb3VuZGluZ0JveERlc2NlbnQgKiBzY2FsZSA6IDA7CiAgICAgICAgICAgICAgICBwZW5ZID0gdGhpcy5faGVpZ2h0IC0gbGluZXNUb3RhbEhlaWdodCAtIGxhc3RMaW5lRGVzY2VudEhlaWdodCAtIDIKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gbGluZXMubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGxpbmUgPQogICAgICAgICAgICAgICAgICAgIGxpbmVzW2ldOwogICAgICAgICAgICAgICAgY29uc3QgY3VyTGluZVRleHRIZWlnaHQgPSBsaW5lLmhlaWdodCAqIHNjYWxlOwogICAgICAgICAgICAgICAgY29uc3Qgc3RhcnRQZW5ZID0gcGVuWTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9pc0JCY29kZUVuYWJsZWQpIHsKICAgICAgICAgICAgICAgICAgICBwZW5ZICs9IGkgPT09IDAgPyBmaXJzdExpbmVUZXh0SGVpZ2h0IDogY3VyTGluZVRleHRIZWlnaHQ7CiAgICAgICAgICAgICAgICAgICAgaWYgKGkgPiAwICYmIHBlblkgPiB0aGlzLl9oZWlnaHQgLSBFWFRSQV9MSU5FX0hFSUdIVCAqIHNjYWxlKSBicmVhawogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpID4gMCAmJiBwZW5ZID49IHRoaXMuX2hlaWdodCAtIGN1ckxpbmVUZXh0SGVpZ2h0KSBicmVhazsKICAgICAgICAgICAgICAgIGlmIChzdGFydFBlblkgPj0gMCkgdGhpcy5fRHJhd1RleHRMaW5lKGxpbmUsIHBlblksIHNjYWxlKTsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5faXNCQmNvZGVFbmFibGVkKSBwZW5ZICs9IGN1ckxpbmVUZXh0SGVpZ2h0OwogICAgICAgICAgICAgICAgcGVuWSArPSBsaW5lU3BhY2VIZWlnaHQKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBfRHJhd1RleHRMaW5lKGxpbmUsIHBlblksIHNjYWxlKSB7CiAgICAgICAgICAgIGxldCBwZW5YID0gMDsKICAgICAgICAgICAgaWYgKHRoaXMuX2hvcml6b250YWxBbGlnbiA9PT0gImNlbnRlciIpIHBlblggPSAodGhpcy5fd2lkdGggLSBsaW5lLndpZHRoICogc2NhbGUpIC8gMjsKICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5faG9yaXpvbnRhbEFsaWduID09PSAicmlnaHQiKSBwZW5YID0gdGhpcy5fd2lkdGggLSBsaW5lLndpZHRoICogc2NhbGU7CiAgICAgICAgICAgIGxpbmUucGVuWCA9IHBlblg7CiAgICAgICAgICAgIGxpbmUucGVuWSA9IHBlblk7CiAgICAgICAgICAgIGZvciAoY29uc3QgZnJhZyBvZiBsaW5lLmZyYWdtZW50cykgewogICAgICAgICAgICAgICAgdGhpcy5fRHJhd1RleHRGcmFnbWVudChmcmFnLCBwZW5YLCBwZW5ZLCBzY2FsZSwgbGluZS5oZWlnaHQpOwogICAgICAgICAgICAgICAgcGVuWCArPSBmcmFnLndpZHRoICogc2NhbGUKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBfRHJhd1RleHRGcmFnbWVudChmcmFnLCBwZW5YLCBwZW5ZLCBzY2FsZSwgbGluZUhlaWdodCkgewogICAgICAgICAgICBmcmFnLnBlblggPSBwZW5YOwogICAgICAgICAgICBmcmFnLnBlblkgPSBwZW5ZOwogICAgICAgICAgICBjb25zdCB0ZXh0Q29udGV4dCA9IHRoaXMuX3RleHRDb250ZXh0OwogICAgICAgICAgICBjb25zdCBsaW5lRm9udFNjYWxlID0gbGluZUhlaWdodCAvIDE2OwogICAgICAgICAgICBsZXQgZnJhZ1dpZHRoID0gZnJhZy53aWR0aCAqIHNjYWxlOwogICAgICAgICAgICBjb25zdCBmcmFnSGVpZ2h0ID0gZnJhZy5oZWlnaHQgKiBzY2FsZTsKICAgICAgICAgICAgY29uc3QgZnJhZ0ZvbnRTY2FsZSA9IGZyYWcuaGVpZ2h0IC8gMTY7CiAgICAgICAgICAgIGNvbnN0IGxpbmVTcGFjZUhlaWdodCA9IChFWFRSQV9MSU5FX0hFSUdIVCArCiAgICAgICAgICAgICAgICB0aGlzLl9saW5lSGVpZ2h0KSAqIHNjYWxlOwogICAgICAgICAgICBjb25zdCBzdHlsZXMgPSBmcmFnLnN0eWxlczsKICAgICAgICAgICAgbGV0IGNoQXJyID0gZnJhZy5jaEFycjsKICAgICAgICAgICAgaWYgKHRoaXMuX2RyYXdNYXhDaGFyQ291bnQgIT09IC0xKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fZHJhd0NoYXJDb3VudCA+PSB0aGlzLl9kcmF3TWF4Q2hhckNvdW50KSByZXR1cm47CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fZHJhd0NoYXJDb3VudCArIGNoQXJyLmxlbmd0aCA+IHRoaXMuX2RyYXdNYXhDaGFyQ291bnQpIHsKICAgICAgICAgICAgICAgICAgICBjaEFyciA9IGNoQXJyLnNsaWNlKDAsIHRoaXMuX2RyYXdNYXhDaGFyQ291bnQgLSB0aGlzLl9kcmF3Q2hhckNvdW50KTsKICAgICAgICAgICAgICAgICAgICBmcmFnV2lkdGggPSB0aGlzLl9NZWFzdXJlVGV4dChjaEFyciwgc3R5bGVzKS53aWR0aCAqIHNjYWxlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLl9kcmF3Q2hhckNvdW50ICs9IGNoQXJyLmxlbmd0aAogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IGJhY2tncm91bmRTdHlsZSA9IHRoaXMuX0dldFN0eWxlVGFnKHN0eWxlcywgImJhY2tncm91bmQiKTsKICAgICAgICAgICAgY29uc3QgaGFzVW5kZXJsaW5lID0gdGhpcy5fSGFzU3R5bGVUYWcoc3R5bGVzLCAidSIpOwogICAgICAgICAgICBjb25zdCBoYXNTdHJpa2V0aHJvdWdoID0KICAgICAgICAgICAgICAgIHRoaXMuX0hhc1N0eWxlVGFnKHN0eWxlcywgInMiKTsKICAgICAgICAgICAgaWYgKEMzLklzQ2hhckFycmF5QWxsV2hpdGVzcGFjZShjaEFycikgJiYgIWJhY2tncm91bmRTdHlsZSAmJiAhaGFzVW5kZXJsaW5lICYmICFoYXNTdHJpa2V0aHJvdWdoIHx8IHRoaXMuX0hhc1N0eWxlVGFnKHN0eWxlcywgImhpZGUiKSkgcmV0dXJuOwogICAgICAgICAgICBjb25zdCB0ZXh0ID0gY2hBcnIuam9pbigiIik7CiAgICAgICAgICAgIGNvbnN0IG9mZnNldFhTdHlsZSA9IHRoaXMuX0dldFN0eWxlVGFnKHN0eWxlcywgIm9mZnNldHgiKTsKICAgICAgICAgICAgcGVuWCArPSBvZmZzZXRYU3R5bGUgPyBwYXJzZUZsb2F0KG9mZnNldFhTdHlsZS5wYXJhbSkgKiBzY2FsZSA6IDA7CiAgICAgICAgICAgIGNvbnN0IG9mZnNldFlTdHlsZSA9IHRoaXMuX0dldFN0eWxlVGFnKHN0eWxlcywgIm9mZnNldHkiKTsKICAgICAgICAgICAgcGVuWSArPSBvZmZzZXRZU3R5bGUgPyBwYXJzZUZsb2F0KG9mZnNldFlTdHlsZS5wYXJhbSkgKiBzY2FsZSA6IDA7CiAgICAgICAgICAgIGlmIChiYWNrZ3JvdW5kU3R5bGUpIHsKICAgICAgICAgICAgICAgIHRoaXMuX1NldERyYXdDYW52YXNDb2xvcihiYWNrZ3JvdW5kU3R5bGUucGFyYW0pOwogICAgICAgICAgICAgICAgdGV4dENvbnRleHQuZmlsbFJlY3QocGVuWCwKICAgICAgICAgICAgICAgICAgICBwZW5ZIC0gZnJhZ0hlaWdodCwgZnJhZ1dpZHRoLCBmcmFnSGVpZ2h0ICsgbGluZVNwYWNlSGVpZ2h0KQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IGNvbG9yU3R5bGUgPSB0aGlzLl9HZXRTdHlsZVRhZyhzdHlsZXMsICJjb2xvciIpOwogICAgICAgICAgICB0aGlzLl9TZXREcmF3Q2FudmFzQ29sb3IoY29sb3JTdHlsZSA/IGNvbG9yU3R5bGUucGFyYW0gOiB0aGlzLl9jb2xvclN0cik7CiAgICAgICAgICAgIGNvbnN0IG9wYWNpdHlTdHlsZSA9IHRoaXMuX0dldFN0eWxlVGFnKHN0eWxlcywgIm9wYWNpdHkiKTsKICAgICAgICAgICAgdGhpcy5fU2V0RHJhd0NhbnZhc09wYWNpdHkob3BhY2l0eVN0eWxlID8gcGFyc2VGbG9hdChvcGFjaXR5U3R5bGUucGFyYW0pIC8gMTAwIDogMSk7CiAgICAgICAgICAgIGNvbnN0IGxpbmVUaGlja25lc3NTdHlsZSA9IHRoaXMuX0dldFN0eWxlVGFnKHN0eWxlcywgImxpbmV0aGlja25lc3MiKTsKICAgICAgICAgICAgY29uc3QgbGluZVRoaWNrbmVzc1NjYWxlID0gbGluZVRoaWNrbmVzc1N0eWxlID8gcGFyc2VGbG9hdChsaW5lVGhpY2tuZXNzU3R5bGUucGFyYW0pIDogMTsKICAgICAgICAgICAgY29uc3QgaXNTdHJva2UgPSB0aGlzLl9IYXNTdHlsZVRhZyhzdHlsZXMsICJzdHJva2UiKTsKICAgICAgICAgICAgaWYgKGlzU3Ryb2tlKSB0aGlzLl9TZXREcmF3Q2FudmFzTGluZVdpdGgoZnJhZ0ZvbnRTY2FsZSAqIC41ICogbGluZVRoaWNrbmVzc1NjYWxlICogdGhpcy5HZXREcmF3U2NhbGUoKSk7CiAgICAgICAgICAgIHRoaXMuX1NldERyYXdGb250U3RyaW5nKHRoaXMuX0dldEZvbnRTdHJpbmcoZmFsc2UsIHN0eWxlcykpOwogICAgICAgICAgICBmaWxsT3JTdHJva2VUZXh0KHRleHRDb250ZXh0LCBpc1N0cm9rZSwgdGV4dCwgcGVuWCwgcGVuWSwgZnJhZ1dpZHRoKTsKICAgICAgICAgICAgaWYgKCFpc1N0cm9rZSkgewogICAgICAgICAgICAgICAgdGhpcy5fU2V0RHJhd0NhbnZhc0xpbmVXaXRoKGZyYWdGb250U2NhbGUgKiAuNSAqIGxpbmVUaGlja25lc3NTY2FsZSAqIHRoaXMuR2V0RHJhd1NjYWxlKCkpOwogICAgICAgICAgICAgICAgY29uc3Qgb3V0bGluZVN0eWxlID0gdGhpcy5fR2V0U3R5bGVUYWcoc3R5bGVzLCAib3V0bGluZSIpOwogICAgICAgICAgICAgICAgaWYgKG91dGxpbmVTdHlsZSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX1NldERyYXdDYW52YXNDb2xvcihvdXRsaW5lU3R5bGUucGFyYW0pOwogICAgICAgICAgICAgICAgICAgIGZpbGxPclN0cm9rZVRleHQodGV4dENvbnRleHQsIHRydWUsIHRleHQsIHBlblgsIHBlblksIGZyYWdXaWR0aCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLl9TZXREcmF3Q2FudmFzQ29sb3IoY29sb3JTdHlsZSA/CiAgICAgICAgICAgICAgICBjb2xvclN0eWxlLnBhcmFtIDogdGhpcy5fY29sb3JTdHIpOwogICAgICAgICAgICBpZiAoaGFzVW5kZXJsaW5lKSBmaWxsT3JTdHJva2VSZWN0KHRleHRDb250ZXh0LCBpc1N0cm9rZSwgcGVuWCwgcGVuWSArIHNjYWxlICogbGluZUZvbnRTY2FsZSwgZnJhZ1dpZHRoLCBzY2FsZSAqIGxpbmVGb250U2NhbGUgKiBsaW5lVGhpY2tuZXNzU2NhbGUpOwogICAgICAgICAgICBpZiAoaGFzU3RyaWtldGhyb3VnaCkgewogICAgICAgICAgICAgICAgY29uc3QgZGVmYXVsdFN0cmlrZVkgPSBwZW5ZIC0gZnJhZ0hlaWdodCAvIDQ7CiAgICAgICAgICAgICAgICBjb25zdCBkZWZhdWx0U3RyaWtlSGVpZ2h0ID0gc2NhbGUgKiBmcmFnRm9udFNjYWxlOwogICAgICAgICAgICAgICAgY29uc3Qgc3RyaWtlWU1pZCA9IGRlZmF1bHRTdHJpa2VZICsgZGVmYXVsdFN0cmlrZUhlaWdodCAvIDI7CiAgICAgICAgICAgICAgICB0ZXh0Q29udGV4dC5maWxsUmVjdChwZW5YLCBzdHJpa2VZTWlkIC0gZGVmYXVsdFN0cmlrZUhlaWdodCAqIGxpbmVUaGlja25lc3NTY2FsZSAvIDIsIGZyYWdXaWR0aCwgZGVmYXVsdFN0cmlrZUhlaWdodCAqIGxpbmVUaGlja25lc3NTY2FsZSkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBfVXBkYXRlVGV4dHVyZSgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX3JlbmRlcmVyLklzQ29udGV4dExvc3QoKSkgcmV0dXJuOwogICAgICAgICAgICBpZiAoIXRoaXMuX3RleHR1cmUpIHRoaXMuX3RleHR1cmUgPSB0aGlzLl9yZW5kZXJlci5DcmVhdGVEeW5hbWljVGV4dHVyZSh0aGlzLl90ZXh0Q2FudmFzLndpZHRoLCB0aGlzLl90ZXh0Q2FudmFzLmhlaWdodCwgewogICAgICAgICAgICAgICAgbWlwTWFwOiB0cnVlLAogICAgICAgICAgICAgICAgbWlwTWFwUXVhbGl0eTogImhpZ2giCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0aGlzLl9yZW5kZXJlci5VcGRhdGVUZXh0dXJlKHRoaXMuX3RleHRDYW52YXMsIHRoaXMuX3RleHR1cmUpOwogICAgICAgICAgICB0aGlzLl9yY1RleC5zZXQoMCwgMCwgdGhpcy5fd2lkdGggLyB0aGlzLl90ZXh0dXJlLkdldFdpZHRoKCksIHRoaXMuX2hlaWdodCAvIHRoaXMuX3RleHR1cmUuR2V0SGVpZ2h0KCkpOwogICAgICAgICAgICBpZiAodGhpcy5vbnRleHR1cmV1cGRhdGUpIHRoaXMub250ZXh0dXJldXBkYXRlKCkKICAgICAgICB9CiAgICAgICAgR2V0VGV4UmVjdCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3JjVGV4CiAgICAgICAgfQogICAgICAgIFJlbGVhc2VUZXh0dXJlKCkgewogICAgICAgICAgICBpZiAodGhpcy5fdGV4dHVyZSkgewogICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9yZW5kZXJlci5Jc0NvbnRleHRMb3N0KCkpIHRoaXMuX3JlbmRlcmVyLkRlbGV0ZVRleHR1cmUodGhpcy5fdGV4dHVyZSk7CiAgICAgICAgICAgICAgICB0aGlzLl90ZXh0dXJlID0gbnVsbAogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHN0YXRpYyBPbkNvbnRleHRMb3N0KCkgewogICAgICAgICAgICBmb3IgKGNvbnN0IHJlbmRlcmVyVGV4dCBvZiBhbGxSZW5kZXJlclRleHRzKSByZW5kZXJlclRleHQuUmVsZWFzZVRleHR1cmUoKQogICAgICAgIH0KICAgICAgICBzdGF0aWMgR2V0QWxsKCkgewogICAgICAgICAgICByZXR1cm4gYWxsUmVuZGVyZXJUZXh0cy52YWx1ZXMoKQogICAgICAgIH0KICAgIH07Cgp9CgovLyAuLi9saWIvZ2Z4L3dlYmdsL3F1ZXJ5LmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIGNsYXNzIFdlYkdMUmVhbFRpbWVFbGFwc2VkUXVlcnkgewogICAgICAgIGNvbnN0cnVjdG9yKHJlbmRlcmVyKSB7CiAgICAgICAgICAgIHRoaXMuX2dsID0gcmVuZGVyZXIuR2V0Q29udGV4dCgpOwogICAgICAgICAgICB0aGlzLl92ZXJzaW9uID0gcmVuZGVyZXIuR2V0V2ViR0xWZXJzaW9uTnVtYmVyKCk7CiAgICAgICAgICAgIHRoaXMuX3RpbWVyRXh0ID0gcmVuZGVyZXIuX0dldERpc2pvaW50VGltZXJRdWVyeUV4dGVuc2lvbigpOwogICAgICAgICAgICB0aGlzLl9xdWVyeSA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX2lzQWN0aXZlID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX2hhc1Jlc3VsdCA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl9yZXN1bHQgPSAwOwogICAgICAgICAgICBpZiAodGhpcy5fdmVyc2lvbiA9PT0gMSkgdGhpcy5fcXVlcnkgPSB0aGlzLl90aW1lckV4dFsiY3JlYXRlUXVlcnlFWFQiXSgpOwogICAgICAgICAgICBlbHNlIHRoaXMuX3F1ZXJ5ID0gdGhpcy5fZ2xbImNyZWF0ZVF1ZXJ5Il0oKQogICAgICAgIH0KICAgICAgICBSZWxlYXNlKCkgewogICAgICAgICAgICB0aGlzLl9EZWxldGVRdWVyeU9iamVjdCgpOwogICAgICAgICAgICB0aGlzLl9nbCA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3RpbWVyRXh0ID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5faGFzUmVzdWx0ID0gZmFsc2UKICAgICAgICB9CiAgICAgICAgX0RlbGV0ZVF1ZXJ5T2JqZWN0KCkgewogICAgICAgICAgICBpZiAoIXRoaXMuX3F1ZXJ5KSByZXR1cm47CiAgICAgICAgICAgIGlmICh0aGlzLl92ZXJzaW9uID09PQogICAgICAgICAgICAgICAgMSkgdGhpcy5fdGltZXJFeHRbImRlbGV0ZVF1ZXJ5RVhUIl0odGhpcy5fcXVlcnkpOwogICAgICAgICAgICBlbHNlIHRoaXMuX2dsWyJkZWxldGVRdWVyeSJdKHRoaXMuX3F1ZXJ5KTsKICAgICAgICAgICAgdGhpcy5fcXVlcnkgPSBudWxsCiAgICAgICAgfQogICAgICAgIEJlZ2luVGltZUVsYXBzZWQoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9pc0FjdGl2ZSkgdGhyb3cgbmV3IEVycm9yKCJxdWVyeSBhbHJlYWR5IGFjdGl2ZSIpOwogICAgICAgICAgICBpZiAodGhpcy5fdmVyc2lvbiA9PT0gMSkgdGhpcy5fdGltZXJFeHRbImJlZ2luUXVlcnlFWFQiXSh0aGlzLl90aW1lckV4dFsiVElNRV9FTEFQU0VEX0VYVCJdLCB0aGlzLl9xdWVyeSk7CiAgICAgICAgICAgIGVsc2UgdGhpcy5fZ2xbImJlZ2luUXVlcnkiXSh0aGlzLl90aW1lckV4dFsiVElNRV9FTEFQU0VEX0VYVCJdLCB0aGlzLl9xdWVyeSk7CiAgICAgICAgICAgIHRoaXMuX2lzQWN0aXZlID0gdHJ1ZQogICAgICAgIH0KICAgICAgICBFbmRUaW1lRWxhcHNlZCgpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLl9pc0FjdGl2ZSkgdGhyb3cgbmV3IEVycm9yKCJxdWVyeSBub3QgYWN0aXZlIik7CiAgICAgICAgICAgIGlmICh0aGlzLl92ZXJzaW9uID09PSAxKSB0aGlzLl90aW1lckV4dFsiZW5kUXVlcnlFWFQiXSh0aGlzLl90aW1lckV4dFsiVElNRV9FTEFQU0VEX0VYVCJdKTsKICAgICAgICAgICAgZWxzZSB0aGlzLl9nbFsiZW5kUXVlcnkiXSh0aGlzLl90aW1lckV4dFsiVElNRV9FTEFQU0VEX0VYVCJdKTsKICAgICAgICAgICAgdGhpcy5faXNBY3RpdmUgPSBmYWxzZQogICAgICAgIH0KICAgICAgICBDaGVja0ZvclJlc3VsdCgpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLl9xdWVyeSB8fCB0aGlzLl9oYXNSZXN1bHQgfHwgdGhpcy5faXNBY3RpdmUpIHJldHVybjsKICAgICAgICAgICAgbGV0IGF2YWlsYWJsZSA9IGZhbHNlOwogICAgICAgICAgICBpZiAodGhpcy5fdmVyc2lvbiA9PT0gMSkgYXZhaWxhYmxlID0gdGhpcy5fdGltZXJFeHRbImdldFF1ZXJ5T2JqZWN0RVhUIl0odGhpcy5fcXVlcnksIHRoaXMuX3RpbWVyRXh0WyJRVUVSWV9SRVNVTFRfQVZBSUxBQkxFX0VYVCJdKTsKICAgICAgICAgICAgZWxzZSBhdmFpbGFibGUgPSB0aGlzLl9nbFsiZ2V0UXVlcnlQYXJhbWV0ZXIiXSh0aGlzLl9xdWVyeSwgdGhpcy5fZ2xbIlFVRVJZX1JFU1VMVF9BVkFJTEFCTEUiXSk7CiAgICAgICAgICAgIGNvbnN0IGRpc2pvaW50ID0gdGhpcy5fZ2wuZ2V0UGFyYW1ldGVyKHRoaXMuX3RpbWVyRXh0WyJHUFVfRElTSk9JTlRfRVhUIl0pOwogICAgICAgICAgICBpZiAoYXZhaWxhYmxlICYmICFkaXNqb2ludCkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuX3ZlcnNpb24gPT09CiAgICAgICAgICAgICAgICAgICAgMSkgdGhpcy5fcmVzdWx0ID0gdGhpcy5fdGltZXJFeHRbImdldFF1ZXJ5T2JqZWN0RVhUIl0odGhpcy5fcXVlcnksIHRoaXMuX3RpbWVyRXh0WyJRVUVSWV9SRVNVTFRfRVhUIl0pOwogICAgICAgICAgICAgICAgZWxzZSB0aGlzLl9yZXN1bHQgPSB0aGlzLl9nbFsiZ2V0UXVlcnlQYXJhbWV0ZXIiXSh0aGlzLl9xdWVyeSwgdGhpcy5fZ2xbIlFVRVJZX1JFU1VMVCJdKTsKICAgICAgICAgICAgICAgIHRoaXMuX3Jlc3VsdCAvPSAxRTk7CiAgICAgICAgICAgICAgICB0aGlzLl9oYXNSZXN1bHQgPSB0cnVlCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGF2YWlsYWJsZSB8fCBkaXNqb2ludCkgdGhpcy5fRGVsZXRlUXVlcnlPYmplY3QoKQogICAgICAgIH0KICAgICAgICBIYXNSZXN1bHQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9oYXNSZXN1bHQKICAgICAgICB9CiAgICAgICAgR2V0UmVzdWx0KCkgewogICAgICAgICAgICBpZiAoIXRoaXMuX2hhc1Jlc3VsdCkgdGhyb3cgbmV3IEVycm9yKCJubyByZXN1bHQgYXZhaWxhYmxlIik7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9yZXN1bHQKICAgICAgICB9CiAgICB9CiAgICBDMy5HZnguV2ViR0xUaW1lRWxhcHNlZFF1ZXJ5ID0gY2xhc3MgV2ViR0xUaW1lRWxhcHNlZFF1ZXJ5IHsKICAgICAgICBjb25zdHJ1Y3RvcihyZW5kZXJlcikgewogICAgICAgICAgICB0aGlzLl9yZW5kZXJlciA9IHJlbmRlcmVyOwogICAgICAgICAgICB0aGlzLl9mcmFtZU51bWJlciA9IHJlbmRlcmVyLkdldEZyYW1lTnVtYmVyKCk7CiAgICAgICAgICAgIHRoaXMuX2lzQWN0aXZlID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX3BhcmVudFF1ZXJ5ID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5faXNOZXN0ZWQgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5fcmVhbFF1ZXJ5ID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fcXVlcmllcyA9IFtdCiAgICAgICAgfQogICAgICAgIFJlbGVhc2UoKSB7CiAgICAgICAgICAgIGZvciAoY29uc3QgcSBvZiB0aGlzLl9xdWVyaWVzKQogICAgICAgICAgICAgICAgaWYgKHEgaW5zdGFuY2VvZiBXZWJHTFJlYWxUaW1lRWxhcHNlZFF1ZXJ5KSBxLlJlbGVhc2UoKTsKICAgICAgICAgICAgQzMuY2xlYXJBcnJheSh0aGlzLl9xdWVyaWVzKTsKICAgICAgICAgICAgdGhpcy5fcGFyZW50UXVlcnkgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9yZWFsUXVlcnkgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9yZW5kZXJlciA9IG51bGwKICAgICAgICB9CiAgICAgICAgQmVnaW5UaW1lRWxhcHNlZCgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX2lzQWN0aXZlKSB0aHJvdyBuZXcgRXJyb3IoInF1ZXJ5IGFscmVhZHkgYWN0aXZlIik7CiAgICAgICAgICAgIGNvbnN0IHN0YWNrID0gdGhpcy5fcmVuZGVyZXIuX0dldFRpbWVRdWVyeVN0YWNrKCk7CiAgICAgICAgICAgIGlmIChzdGFjay5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9pc05lc3RlZCA9IHRydWU7CiAgICAgICAgICAgICAgICB0aGlzLl9wYXJlbnRRdWVyeSA9IHN0YWNrLmF0KC0xKTsKICAgICAgICAgICAgICAgIHRoaXMuX3BhcmVudFF1ZXJ5Ll9FbmRSZWFsKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9wYXJlbnRRdWVyeS5fcXVlcmllcy5wdXNoKHRoaXMpCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLl9pc05lc3RlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgdGhpcy5fcGFyZW50UXVlcnkgPSBudWxsCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5faXNBY3RpdmUgPSB0cnVlOwogICAgICAgICAgICBzdGFjay5wdXNoKHRoaXMpOwogICAgICAgICAgICB0aGlzLl9TdGFydFJlYWwoKQogICAgICAgIH0KICAgICAgICBFbmRUaW1lRWxhcHNlZCgpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLl9pc0FjdGl2ZSkgdGhyb3cgbmV3IEVycm9yKCJxdWVyeSBub3QgYWN0aXZlIik7CiAgICAgICAgICAgIGNvbnN0IHRvcCA9IHRoaXMuX3JlbmRlcmVyLl9HZXRUaW1lUXVlcnlTdGFjaygpLnBvcCgpOwogICAgICAgICAgICBpZiAodG9wICE9PSB0aGlzKSB0aHJvdyBuZXcgRXJyb3IoImNhbiBvbmx5IGVuZCBtb3N0IG5lc3RlZCBxdWVyeSIpOwogICAgICAgICAgICB0aGlzLl9pc0FjdGl2ZSA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl9FbmRSZWFsKCk7CiAgICAgICAgICAgIGlmICh0aGlzLl9wYXJlbnRRdWVyeSkgewogICAgICAgICAgICAgICAgdGhpcy5fcGFyZW50UXVlcnkuX1N0YXJ0UmVhbCgpOwogICAgICAgICAgICAgICAgdGhpcy5fcGFyZW50UXVlcnkgPSBudWxsCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgX1N0YXJ0UmVhbCgpIHsKICAgICAgICAgICAgdGhpcy5fcmVhbFF1ZXJ5ID0gQzMuTmV3KFdlYkdMUmVhbFRpbWVFbGFwc2VkUXVlcnksIHRoaXMuX3JlbmRlcmVyKTsKICAgICAgICAgICAgdGhpcy5fcXVlcmllcy5wdXNoKHRoaXMuX3JlYWxRdWVyeSk7CiAgICAgICAgICAgIHRoaXMuX3JlYWxRdWVyeS5CZWdpblRpbWVFbGFwc2VkKCkKICAgICAgICB9CiAgICAgICAgX0VuZFJlYWwoKSB7CiAgICAgICAgICAgIHRoaXMuX3JlYWxRdWVyeS5FbmRUaW1lRWxhcHNlZCgpOwogICAgICAgICAgICB0aGlzLl9yZWFsUXVlcnkgPSBudWxsCiAgICAgICAgfQogICAgICAgIENoZWNrRm9yUmVzdWx0KCkgewogICAgICAgICAgICBmb3IgKGNvbnN0IHEgb2YgdGhpcy5fcXVlcmllcykgcS5DaGVja0ZvclJlc3VsdCgpCiAgICAgICAgfQogICAgICAgIElzTmVzdGVkKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faXNOZXN0ZWQKICAgICAgICB9CiAgICAgICAgSGFzUmVzdWx0KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fcXVlcmllcy5ldmVyeShxID0+IHEuSGFzUmVzdWx0KCkpCiAgICAgICAgfQogICAgICAgIEdldFJlc3VsdCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3F1ZXJpZXMucmVkdWNlKChhLCB2KSA9PiBhICsgdi5HZXRSZXN1bHQoKSwKICAgICAgICAgICAgICAgIDApCiAgICAgICAgfQogICAgICAgIEdldEZyYW1lTnVtYmVyKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZnJhbWVOdW1iZXIKICAgICAgICB9CiAgICB9OwoKfQoKLy8gLi4vbGliL2dmeC93ZWJnbC9xdWVyeVJlc3VsdEJ1ZmZlci5qcwp7CiAgICAndXNlIHN0cmljdCc7CiAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICBDMy5HZnguV2ViR0xRdWVyeVJlc3VsdEJ1ZmZlciA9IGNsYXNzIFdlYkdMUXVlcnlSZXN1bHRCdWZmZXIgewogICAgICAgIGNvbnN0cnVjdG9yKHJlbmRlcmVyLCBtYXhRdWVyaWVzID0gMUUzKSB7CiAgICAgICAgICAgIHRoaXMuX3JlbmRlcmVyID0gcmVuZGVyZXI7CiAgICAgICAgICAgIHRoaXMuX21heFF1ZXJpZXMgPSBtYXhRdWVyaWVzOwogICAgICAgICAgICB0aGlzLl9idWZmZXIgPSBbXTsKICAgICAgICAgICAgdGhpcy5fcmVuZGVyZXIuX0FkZFF1ZXJ5UmVzdWx0QnVmZmVyKHRoaXMpCiAgICAgICAgfQogICAgICAgIFJlbGVhc2UoKSB7CiAgICAgICAgICAgIHRoaXMuQ2xlYXIoKTsKICAgICAgICAgICAgdGhpcy5fcmVuZGVyZXIuX1JlbW92ZVF1ZXJ5UmVzdWx0QnVmZmVyKHRoaXMpOwogICAgICAgICAgICB0aGlzLl9yZW5kZXJlciA9IG51bGwKICAgICAgICB9CiAgICAgICAgQ2xlYXIoKSB7CiAgICAgICAgICAgIGZvciAoY29uc3QgcSBvZiB0aGlzLl9idWZmZXIpIHEuUmVsZWFzZSgpOwogICAgICAgICAgICBDMy5jbGVhckFycmF5KHRoaXMuX2J1ZmZlcikKICAgICAgICB9CiAgICAgICAgQWRkVGltZUVsYXBzZWRRdWVyeSgpIHsKICAgICAgICAgICAgY29uc3QgcmV0ID0gbmV3IEMzLkdmeC5XZWJHTFRpbWVFbGFwc2VkUXVlcnkodGhpcy5fcmVuZGVyZXIpOwogICAgICAgICAgICB0aGlzLl9idWZmZXIucHVzaChyZXQpOwogICAgICAgICAgICBpZiAodGhpcy5fYnVmZmVyLmxlbmd0aCA+IHRoaXMuX21heFF1ZXJpZXMpIHsKICAgICAgICAgICAgICAgIGNvbnN0IG9sZGVzdCA9CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYnVmZmVyLnNoaWZ0KCk7CiAgICAgICAgICAgICAgICBvbGRlc3QuUmVsZWFzZSgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHJldAogICAgICAgIH0KICAgICAgICBDaGVja0ZvclJlc3VsdHModG9GcmFtZU51bWJlcikgewogICAgICAgICAgICBmb3IgKGNvbnN0IHEgb2YgdGhpcy5fYnVmZmVyKSB7CiAgICAgICAgICAgICAgICBpZiAocS5HZXRGcmFtZU51bWJlcigpID49IHRvRnJhbWVOdW1iZXIpIHJldHVybjsKICAgICAgICAgICAgICAgIGlmIChxLklzTmVzdGVkKCkpIHJldHVybjsKICAgICAgICAgICAgICAgIHEuQ2hlY2tGb3JSZXN1bHQoKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIEdldEZyYW1lUmFuZ2VSZXN1bHRTdW0oc3RhcnRGcmFtZSwgZW5kRnJhbWUpIHsKICAgICAgICAgICAgaWYgKGVuZEZyYW1lIDw9IHN0YXJ0RnJhbWUpIHJldHVybiBOYU47CiAgICAgICAgICAgIGxldCBzdW0gPSAwOwogICAgICAgICAgICBmb3IgKGNvbnN0IHEgb2YgdGhpcy5fYnVmZmVyKSB7CiAgICAgICAgICAgICAgICBpZiAocS5HZXRGcmFtZU51bWJlcigpID49IGVuZEZyYW1lKSBicmVhazsKICAgICAgICAgICAgICAgIGlmIChxLkdldEZyYW1lTnVtYmVyKCkgPCBzdGFydEZyYW1lKSBjb250aW51ZTsKICAgICAgICAgICAgICAgIGlmIChxLkhhc1Jlc3VsdCgpKSBzdW0gKz0gcS5HZXRSZXN1bHQoKTsKICAgICAgICAgICAgICAgIGVsc2UgcmV0dXJuIE5hTgogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBzdW0KICAgICAgICB9CiAgICAgICAgRGVsZXRlQWxsQmVmb3JlRnJhbWVOdW1iZXIoZnJhbWVOdW1iZXIpIHsKICAgICAgICAgICAgZm9yIChsZXQgaSA9CiAgICAgICAgICAgICAgICAgICAgMCwgbGVuID0gdGhpcy5fYnVmZmVyLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7CiAgICAgICAgICAgICAgICBjb25zdCBxID0gdGhpcy5fYnVmZmVyW2ldOwogICAgICAgICAgICAgICAgaWYgKHEuR2V0RnJhbWVOdW1iZXIoKSA8IGZyYW1lTnVtYmVyKSBxLlJlbGVhc2UoKTsKICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIGlmIChpID4gMCkgdGhpcy5fYnVmZmVyLnNwbGljZSgwLCBpKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07Cgp9CgovLyAuLi9saWIvZ2Z4L3dlYmdsL3dlYmdsUmVuZGVyZXIuanMKewogICAgJ3VzZSBzdHJpY3QnOwogICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgY29uc3QgYXNzZXJ0ID0gc2VsZi5hc3NlcnQ7CiAgICBjb25zdCBnbE1hdHJpeCA9IHNlbGYuZ2xNYXRyaXg7CiAgICBjb25zdCB2ZWMzID0gZ2xNYXRyaXgudmVjMzsKICAgIGNvbnN0IHZlYzQgPSBnbE1hdHJpeC52ZWM0OwogICAgY29uc3QgbWF0NCA9IGdsTWF0cml4Lm1hdDQ7CiAgICBjb25zdCBERUZBVUxUX1dFQkdMUkVOREVSRVJfT1BUUyA9IHsKICAgICAgICBwb3dlclByZWZlcmVuY2U6ICJkZWZhdWx0IiwKICAgICAgICBlbmFibGVHcHVQcm9maWxpbmc6IHRydWUsCiAgICAgICAgYWxwaGE6IGZhbHNlLAogICAgICAgIGxvd0xhdGVuY3k6IGZhbHNlLAogICAgICAgIGRlcHRoOiBmYWxzZSwKICAgICAgICBjYW5TYW1wbGVEZXB0aDogZmFsc2UsCiAgICAgICAgbWF4V2ViR0xWZXJzaW9uOiAyLAogICAgICAgIGZhaWxJZk1ham9yUGVyZm9ybWFuY2VDYXZlYXQ6IGZhbHNlCiAgICB9OwogICAgY29uc3QgVkFMSURfUE9XRVJfUFJFRkVSRU5DRVMgPSBuZXcgU2V0KFsiZGVmYXVsdCIsICJsb3ctcG93ZXIiLCAiaGlnaC1wZXJmb3JtYW5jZSJdKTsKICAgIGNvbnN0IE1BWF9WRVJUSUNFUyA9IDhFMzsKICAgIGNvbnN0IE1BWF9JTkRJQ0VTID0gTUFYX1ZFUlRJQ0VTIC8gMiAqIDM7CiAgICBjb25zdCBNQVhfUE9JTlRTID0gOEUzOwogICAgY29uc3QgTEFTVF9QT0lOVCA9IE1BWF9QT0lOVFMgLSA0OwogICAgY29uc3QgUEFSVElBTF9URVhUVVJFX1VQTE9BRF9DSFVOS19TSVpFID0gMjU2ICogMTAyNDsKICAgIGNvbnN0IGRlZmF1bHRUZXhDb29yZHNRdWFkID0gbmV3IEMzLlF1YWQoMCwgMCwgMSwgMCwgMSwgMSwgMCwgMSk7CiAgICBjb25zdCB0bXBQcm9qZWN0aW9uID0gbWF0NC5jcmVhdGUoKTsKICAgIGNvbnN0IHRtcE1vZGVsVmlldyA9IG1hdDQuY3JlYXRlKCk7CiAgICBjb25zdCB0bXBRdWFkID0gbmV3IEMzLlF1YWQ7CiAgICBjb25zdCB0bXBSZWN0ID0gbmV3IEMzLlJlY3Q7CiAgICBsZXQgbG9zZUNvbnRleHRFeHRlbnNpb24gPSBudWxsOwogICAgaWYgKEMzLmlzRGVidWcpIHsKICAgICAgICBzZWxmLmRlYnVnX2xvc2Vfd2ViZ2xfY29udGV4dCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICBpZiAoIWxvc2VDb250ZXh0RXh0ZW5zaW9uKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oIldFQkdMX2xvc2VfY29udGV4dCBub3Qgc3VwcG9ydGVkIik7CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBsb3NlQ29udGV4dEV4dGVuc2lvbi5sb3NlQ29udGV4dCgpCiAgICAgICAgfTsKICAgICAgICBzZWxmLmRlYnVnX3Jlc3RvcmVfd2ViZ2xfY29udGV4dCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICBpZiAoIWxvc2VDb250ZXh0RXh0ZW5zaW9uKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oIldFQkdMX2xvc2VfY29udGV4dCBub3Qgc3VwcG9ydGVkIik7CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBsb3NlQ29udGV4dEV4dGVuc2lvbi5yZXN0b3JlQ29udGV4dCgpCiAgICAgICAgfQogICAgfQogICAgY29uc3QgcGVuZGluZ1BvbGxzID0gbmV3IFNldDsKICAgIGxldCBwb2xsUmFmSWQgPSAtMTsKCiAgICBmdW5jdGlvbiBDaGVja1BlbmRpbmdQb2xscygpIHsKICAgICAgICBwb2xsUmFmSWQgPSAtMTsKICAgICAgICBmb3IgKGNvbnN0IGluZm8gb2YgcGVuZGluZ1BvbGxzKQogICAgICAgICAgICBpZiAoaW5mby5jaGVja0Z1bmMoKSkgewogICAgICAgICAgICAgICAgaW5mby5yZXNvbHZlKCk7CiAgICAgICAgICAgICAgICBwZW5kaW5nUG9sbHMuZGVsZXRlKGluZm8pCiAgICAgICAgICAgIH0KICAgICAgICBpZiAocGVuZGluZ1BvbGxzLnNpemUgPiAwKSBwb2xsUmFmSWQgPSBzZWxmLnJlcXVlc3RBbmltYXRpb25GcmFtZShDaGVja1BlbmRpbmdQb2xscykKICAgIH0KICAgIEMzLkdmeC5XZWJHTFJlbmRlcmVyID0gY2xhc3MgV2ViR0xSZW5kZXJlciBleHRlbmRzIEMzLkdmeC5SZW5kZXJlckJhc2UgewogICAgICAgIGNvbnN0cnVjdG9yKGNhbnZhcywgb3B0cykgewogICAgICAgICAgICBzdXBlcihvcHRzKTsKICAgICAgICAgICAgb3B0cyA9IE9iamVjdC5hc3NpZ24oe30sIERFRkFVTFRfV0VCR0xSRU5ERVJFUl9PUFRTLCBvcHRzKTsKICAgICAgICAgICAgaWYgKCFWQUxJRF9QT1dFUl9QUkVGRVJFTkNFUy5oYXMob3B0cy5wb3dlclByZWZlcmVuY2UpKSB0aHJvdyBuZXcgRXJyb3IoImludmFsaWQgcG93ZXIgcHJlZmVyZW5jZSIpOwogICAgICAgICAgICBjb25zdCBhdHRyaWJzID0gewogICAgICAgICAgICAgICAgImFscGhhIjogISFvcHRzLmFscGhhLAogICAgICAgICAgICAgICAgImRlcHRoIjogZmFsc2UsCiAgICAgICAgICAgICAgICAiYW50aWFsaWFzIjogZmFsc2UsCiAgICAgICAgICAgICAgICAicG93ZXJQcmVmZXJlbmNlIjogb3B0cy5wb3dlclByZWZlcmVuY2UsCiAgICAgICAgICAgICAgICAiZmFpbElmTWFqb3JQZXJmb3JtYW5jZUNhdmVhdCI6ICEhb3B0cy5mYWlsSWZNYWpvclBlcmZvcm1hbmNlQ2F2ZWF0CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGlmIChvcHRzLmxvd0xhdGVuY3kpIHsKICAgICAgICAgICAgICAgIGF0dHJpYnNbImRlc3luY2hyb25pemVkIl0gPSB0cnVlOwogICAgICAgICAgICAgICAgYXR0cmlic1sicHJlc2VydmVEcmF3aW5nQnVmZmVyIl0gPQogICAgICAgICAgICAgICAgICAgIHRydWUKICAgICAgICAgICAgfQogICAgICAgICAgICBsZXQgZ2wgPSBudWxsOwogICAgICAgICAgICBsZXQgdmVyc2lvbiA9IDA7CiAgICAgICAgICAgIGlmIChvcHRzLm1heFdlYkdMVmVyc2lvbiA+PSAyKSB7CiAgICAgICAgICAgICAgICBnbCA9IGNhbnZhcy5nZXRDb250ZXh0KCJ3ZWJnbDIiLCBhdHRyaWJzKTsKICAgICAgICAgICAgICAgIHZlcnNpb24gPSAyCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCFnbCkgewogICAgICAgICAgICAgICAgZ2wgPSBjYW52YXMuZ2V0Q29udGV4dCgid2ViZ2wiLCBhdHRyaWJzKTsKICAgICAgICAgICAgICAgIHZlcnNpb24gPSAxCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCFnbCkgdGhyb3cgbmV3IEVycm9yKCJyZW5kZXJlci11bmF2YWlsYWJsZSAoY291bGQgbm90IGdldCBXZWJHTCBjb250ZXh0KSIpOwogICAgICAgICAgICB0aGlzLl9nbCA9IGdsOwogICAgICAgICAgICB0aGlzLl9hdHRyaWJzID0gZ2wuZ2V0Q29udGV4dEF0dHJpYnV0ZXMoKTsKICAgICAgICAgICAgaWYgKG9wdHMubG93TGF0ZW5jeSAmJiAhdGhpcy5fYXR0cmlic1siZGVzeW5jaHJvbml6ZWQiXSkgY29uc29sZS5pbmZvKCJbV2ViR0xSZW5kZXJlcl0gTG93LWxhdGVuY3kgbW9kZSBzcGVjaWZpZWQgYnV0IGlzIG5vdCBzdXBwb3J0ZWQgaGVyZSIpOwogICAgICAgICAgICB0aGlzLl92ZXJzaW9uU3RyaW5nID0gZ2wuZ2V0UGFyYW1ldGVyKGdsLlZFUlNJT04pOwogICAgICAgICAgICB0aGlzLl92ZXJzaW9uID0gdmVyc2lvbjsKICAgICAgICAgICAgdGhpcy5fdmlld3BvcnQgPSB2ZWM0LmNyZWF0ZSgpOwogICAgICAgICAgICB0aGlzLl9kaWRDaGFuZ2VUcmFuc2Zvcm0gPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5fYmJQcm9qZWN0aW9uTWF0cml4ID0gbWF0NC5jcmVhdGUoKTsKICAgICAgICAgICAgdGhpcy5fdXNlc0RlcHRoQnVmZmVyID0gISFvcHRzLmRlcHRoOwogICAgICAgICAgICB0aGlzLl9jYW5TYW1wbGVEZXB0aCA9ICEhKG9wdHMuZGVwdGggJiYgb3B0cy5jYW5TYW1wbGVEZXB0aCk7CiAgICAgICAgICAgIHRoaXMuX2lzRGVwdGhFbmFibGVkID0gdGhpcy5fdXNlc0RlcHRoQnVmZmVyOwogICAgICAgICAgICB0aGlzLl9pc0RlcHRoU2FtcGxpbmdFbmFibGVkID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX2RlcHRoQnVmZmVyID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5faXNBdXRvU2l6ZURlcHRoQnVmZmVyID0gdHJ1ZTsKICAgICAgICAgICAgdGhpcy5fZGVwdGhCdWZmZXJXaWR0aCA9IDA7CiAgICAgICAgICAgIHRoaXMuX2RlcHRoQnVmZmVySGVpZ2h0ID0gMDsKICAgICAgICAgICAgdGhpcy5fdmVydGV4QnVmZmVyID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fdGV4Y29vcmRCdWZmZXIgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9pbmRleEJ1ZmZlciA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3BvaW50QnVmZmVyID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fdmVydGV4RGF0YSA9IG5ldyBGbG9hdDMyQXJyYXkoTUFYX1ZFUlRJQ0VTICoKICAgICAgICAgICAgICAgIHRoaXMuR2V0TnVtVmVydGV4Q29tcG9uZW50cygpKTsKICAgICAgICAgICAgdGhpcy5faW5kZXhEYXRhID0gbmV3IFVpbnQxNkFycmF5KE1BWF9JTkRJQ0VTKTsKICAgICAgICAgICAgdGhpcy5fdGV4Y29vcmREYXRhID0gbmV3IEZsb2F0MzJBcnJheShNQVhfVkVSVElDRVMgKiAyKTsKICAgICAgICAgICAgdGhpcy5fcG9pbnREYXRhID0gbmV3IEZsb2F0MzJBcnJheShNQVhfUE9JTlRTICogNCk7CiAgICAgICAgICAgIHRoaXMuX3ZlcnRleFB0ciA9IDA7CiAgICAgICAgICAgIHRoaXMuX3RleFB0ciA9IDA7CiAgICAgICAgICAgIHRoaXMuX3BvaW50UHRyID0gMDsKICAgICAgICAgICAgdGhpcy5fbGFzdFZlcnRleFB0ciA9IDA7CiAgICAgICAgICAgIHRoaXMuX2xhc3RQcm9ncmFtID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fc3BEZXZpY2VUcmFuc2Zvcm1UZXh0dXJlRmlsbCA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX2JhdGNoID0gW107CiAgICAgICAgICAgIHRoaXMuX2JhdGNoUHRyID0gMDsKICAgICAgICAgICAgdGhpcy5fdG9wT2ZCYXRjaCA9IDA7CiAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRSZW5kZXJUYXJnZXQgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9sYXN0UG9pbnRaID0gMDsKICAgICAgICAgICAgdGhpcy5fYmF0Y2hTdGF0ZSA9IEMzLk5ldyhDMy5HZnguQmF0Y2hTdGF0ZSwgdGhpcyk7CiAgICAgICAgICAgIHRoaXMuX2xhc3RDb2xvciA9IEMzLk5ldyhDMy5Db2xvciwgMSwgMSwgMSwgMSk7CiAgICAgICAgICAgIHRoaXMuX2xhc3RUZXh0dXJlMCA9CiAgICAgICAgICAgICAgICBudWxsOwogICAgICAgICAgICB0aGlzLl9sYXN0VGV4dHVyZTEgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9sYXN0U3JjQmxlbmQgPSAwOwogICAgICAgICAgICB0aGlzLl9sYXN0RGVzdEJsZW5kID0gMDsKICAgICAgICAgICAgdGhpcy5fbGFzdFBvaW50VGV4Q29vcmRzID0gbmV3IEMzLlJlY3Q7CiAgICAgICAgICAgIHRoaXMuX2xhc3RTY2lzc29yUmVjdCA9IEMzLk5ldyhDMy5SZWN0LCAwLCAwLCAtMSwgLTEpOwogICAgICAgICAgICB0aGlzLl9tYXhUZXh0dXJlU2l6ZSA9IC0xOwogICAgICAgICAgICB0aGlzLl9taW5Qb2ludFNpemUgPSAwOwogICAgICAgICAgICB0aGlzLl9tYXhQb2ludFNpemUgPSAwOwogICAgICAgICAgICB0aGlzLl9oaWdocFByZWNpc2lvbiA9IDA7CiAgICAgICAgICAgIHRoaXMuX3VubWFza2VkVmVuZG9yID0gIih1bmF2YWlsYWJsZSkiOwogICAgICAgICAgICB0aGlzLl91bm1hc2tlZFJlbmRlcmVyID0gIih1bmF2YWlsYWJsZSkiOwogICAgICAgICAgICB0aGlzLl9leHRlbnNpb25zID0gW107CiAgICAgICAgICAgIHRoaXMuX2lzSW5pdGlhbGlzaW5nQWZ0ZXJDb250ZXh0UmVzdG9yZWQgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5fcGFyYWxsZWxTaGFkZXJDb21waWxlRXh0ID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fYW5pc290cm9waWNFeHQgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9kZXB0aFRleHR1cmVFeHQgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9mcmFnRGVwdGhFeHQgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9zdGREZXJpdmF0aXZlc0V4dCA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3RleHR1cmVMb2RFeHQgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9tYXhBbmlzb3Ryb3B5ID0gMDsKICAgICAgICAgICAgdGhpcy5faXNHcHVQcm9maWxpbmdFbmFibGVkID0gISFvcHRzLmVuYWJsZUdwdVByb2ZpbGluZzsKICAgICAgICAgICAgdGhpcy5fdGltZXJFeHQgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9hbGxRdWVyeVJlc3VsdEJ1ZmZlcnMgPSBuZXcgU2V0OwogICAgICAgICAgICB0aGlzLl90aW1lUXVlcnlTdGFjayA9IFtdOwogICAgICAgICAgICB0aGlzLkZpbGxJbmRleEJ1ZmZlckRhdGEodGhpcy5faW5kZXhEYXRhKQogICAgICAgIH0KICAgICAgICBJc1dlYkdMKCkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgIH0KICAgICAgICBhc3luYyBJbml0U3RhdGUoKSB7CiAgICAgICAgICAgIHN1cGVyLkluaXRTdGF0ZSgpOwogICAgICAgICAgICBjb25zdCBnbCA9IHRoaXMuX2dsOwogICAgICAgICAgICBjb25zdCBudW1WZXJ0ZXhDb21wb25lbnRzID0gdGhpcy5HZXROdW1WZXJ0ZXhDb21wb25lbnRzKCk7CiAgICAgICAgICAgIHRoaXMuX2xhc3RDb2xvci5zZXRSZ2JhKDEsIDEsIDEsIDEpOwogICAgICAgICAgICB0aGlzLl9sYXN0VGV4dHVyZTAgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9sYXN0VGV4dHVyZTEgPSBudWxsOwogICAgICAgICAgICB0aGlzLl92ZXJ0ZXhQdHIgPSAwOwogICAgICAgICAgICB0aGlzLl9wb2ludFB0ciA9IDA7CiAgICAgICAgICAgIHRoaXMuX2xhc3RWZXJ0ZXhQdHIgPQogICAgICAgICAgICAgICAgTUFYX1ZFUlRJQ0VTICogbnVtVmVydGV4Q29tcG9uZW50cyAtIDQgKiBudW1WZXJ0ZXhDb21wb25lbnRzOwogICAgICAgICAgICBDMy5jbGVhckFycmF5KHRoaXMuX2JhdGNoKTsKICAgICAgICAgICAgdGhpcy5fYmF0Y2hQdHIgPSAwOwogICAgICAgICAgICB0aGlzLl90b3BPZkJhdGNoID0gMDsKICAgICAgICAgICAgdGhpcy5fbGFzdFByb2dyYW0gPSBudWxsOwogICAgICAgICAgICB0aGlzLl9jdXJyZW50UmVuZGVyVGFyZ2V0ID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fbGFzdFBvaW50VGV4Q29vcmRzLnNldCgwLCAwLCAxLCAxKTsKICAgICAgICAgICAgdGhpcy5fbGFzdFBvaW50WiA9IDA7CiAgICAgICAgICAgIGNvbnN0IGJhdGNoU3RhdGUgPSB0aGlzLl9iYXRjaFN0YXRlOwogICAgICAgICAgICBiYXRjaFN0YXRlLmN1cnJlbnRTaGFkZXIgPSBudWxsOwogICAgICAgICAgICBiYXRjaFN0YXRlLmN1cnJlbnRGcmFtZWJ1ZmZlciA9IG51bGw7CiAgICAgICAgICAgIGJhdGNoU3RhdGUuY3VycmVudEZyYW1lYnVmZmVyTm9EZXB0aCA9IG51bGw7CiAgICAgICAgICAgIHZlYzQuc2V0KGJhdGNoU3RhdGUuY3VycmVudENvbG9yLCAxLCAxLCAxLCAxKTsKICAgICAgICAgICAgYmF0Y2hTdGF0ZS5jbGVhckNvbG9yLnNldFJnYmEoMCwgMCwgMCwgMCk7CiAgICAgICAgICAgIGJhdGNoU3RhdGUucG9pbnRUZXhDb29yZHMuc2V0KDAsIDAsIDEsIDEpOwogICAgICAgICAgICBnbC5jbGVhckNvbG9yKDAsCiAgICAgICAgICAgICAgICAwLCAwLCAwKTsKICAgICAgICAgICAgZ2wuY2xlYXIoZ2wuQ09MT1JfQlVGRkVSX0JJVCk7CiAgICAgICAgICAgIGdsLmVuYWJsZShnbC5CTEVORCk7CiAgICAgICAgICAgIGdsLmJsZW5kRnVuYyhnbC5PTkUsIGdsLk9ORV9NSU5VU19TUkNfQUxQSEEpOwogICAgICAgICAgICB0aGlzLl9sYXN0U3JjQmxlbmQgPSBnbC5PTkU7CiAgICAgICAgICAgIHRoaXMuX2xhc3REZXN0QmxlbmQgPSBnbC5PTkVfTUlOVVNfU1JDX0FMUEhBOwogICAgICAgICAgICB0aGlzLl9Jbml0QmxlbmRNb2RlcyhnbCk7CiAgICAgICAgICAgIGdsLmRpc2FibGUoZ2wuQ1VMTF9GQUNFKTsKICAgICAgICAgICAgZ2wuZGlzYWJsZShnbC5TVEVOQ0lMX1RFU1QpOwogICAgICAgICAgICBnbC5kaXNhYmxlKGdsLkRJVEhFUik7CiAgICAgICAgICAgIGlmICh0aGlzLl91c2VzRGVwdGhCdWZmZXIpIHsKICAgICAgICAgICAgICAgIGdsLmVuYWJsZShnbC5ERVBUSF9URVNUKTsKICAgICAgICAgICAgICAgIGdsLmRlcHRoTWFzayh0cnVlKTsKICAgICAgICAgICAgICAgIGdsLmRlcHRoRnVuYyhnbC5MRVFVQUwpCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBnbC5kaXNhYmxlKGdsLkRFUFRIX1RFU1QpOwogICAgICAgICAgICAgICAgZ2wuZGVwdGhNYXNrKGZhbHNlKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuX2lzRGVwdGhFbmFibGVkID0gdGhpcy5fdXNlc0RlcHRoQnVmZmVyOwogICAgICAgICAgICB0aGlzLl9pc0RlcHRoU2FtcGxpbmdFbmFibGVkID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX3BvaW50QnVmZmVyID0KICAgICAgICAgICAgICAgIGdsLmNyZWF0ZUJ1ZmZlcigpOwogICAgICAgICAgICBnbC5iaW5kQnVmZmVyKGdsLkFSUkFZX0JVRkZFUiwgdGhpcy5fcG9pbnRCdWZmZXIpOwogICAgICAgICAgICBnbC5idWZmZXJEYXRhKGdsLkFSUkFZX0JVRkZFUiwgdGhpcy5fcG9pbnREYXRhLmJ5dGVMZW5ndGgsIGdsLkRZTkFNSUNfRFJBVyk7CiAgICAgICAgICAgIHRoaXMuX3ZlcnRleEJ1ZmZlciA9IGdsLmNyZWF0ZUJ1ZmZlcigpOwogICAgICAgICAgICBnbC5iaW5kQnVmZmVyKGdsLkFSUkFZX0JVRkZFUiwgdGhpcy5fdmVydGV4QnVmZmVyKTsKICAgICAgICAgICAgZ2wuYnVmZmVyRGF0YShnbC5BUlJBWV9CVUZGRVIsIHRoaXMuX3ZlcnRleERhdGEuYnl0ZUxlbmd0aCwgZ2wuRFlOQU1JQ19EUkFXKTsKICAgICAgICAgICAgdGhpcy5fdGV4Y29vcmRCdWZmZXIgPSBnbC5jcmVhdGVCdWZmZXIoKTsKICAgICAgICAgICAgZ2wuYmluZEJ1ZmZlcihnbC5BUlJBWV9CVUZGRVIsIHRoaXMuX3RleGNvb3JkQnVmZmVyKTsKICAgICAgICAgICAgZ2wuYnVmZmVyRGF0YShnbC5BUlJBWV9CVUZGRVIsIHRoaXMuX3RleGNvb3JkRGF0YS5ieXRlTGVuZ3RoLCBnbC5EWU5BTUlDX0RSQVcpOwogICAgICAgICAgICB0aGlzLl9pbmRleEJ1ZmZlciA9IGdsLmNyZWF0ZUJ1ZmZlcigpOwogICAgICAgICAgICBnbC5iaW5kQnVmZmVyKGdsLkVMRU1FTlRfQVJSQVlfQlVGRkVSLCB0aGlzLl9pbmRleEJ1ZmZlcik7CiAgICAgICAgICAgIGdsLmJ1ZmZlckRhdGEoZ2wuRUxFTUVOVF9BUlJBWV9CVUZGRVIsIHRoaXMuX2luZGV4RGF0YSwgZ2wuU1RBVElDX0RSQVcpOwogICAgICAgICAgICBnbC5hY3RpdmVUZXh0dXJlKGdsLlRFWFRVUkUwKTsKICAgICAgICAgICAgZ2wuYmluZFRleHR1cmUoZ2wuVEVYVFVSRV8yRCwgbnVsbCk7CiAgICAgICAgICAgIHRoaXMuX21heFRleHR1cmVTaXplID0gZ2wuZ2V0UGFyYW1ldGVyKGdsLk1BWF9URVhUVVJFX1NJWkUpOwogICAgICAgICAgICBjb25zdCBwb2ludHNpemVzID0gZ2wuZ2V0UGFyYW1ldGVyKGdsLkFMSUFTRURfUE9JTlRfU0laRV9SQU5HRSk7CiAgICAgICAgICAgIHRoaXMuX21pblBvaW50U2l6ZSA9IHBvaW50c2l6ZXNbMF07CiAgICAgICAgICAgIHRoaXMuX21heFBvaW50U2l6ZSA9IHBvaW50c2l6ZXNbMV07CiAgICAgICAgICAgIGNvbnN0IGhpZ2hwVmVydGV4ID0gZ2wuZ2V0U2hhZGVyUHJlY2lzaW9uRm9ybWF0KGdsLlZFUlRFWF9TSEFERVIsIGdsLkhJR0hfRkxPQVQpOwogICAgICAgICAgICBjb25zdCBoaWdocEZyYWcgPSBnbC5nZXRTaGFkZXJQcmVjaXNpb25Gb3JtYXQoZ2wuRlJBR01FTlRfU0hBREVSLAogICAgICAgICAgICAgICAgZ2wuSElHSF9GTE9BVCk7CiAgICAgICAgICAgIGlmIChoaWdocFZlcnRleCAmJiBoaWdocEZyYWcpIHRoaXMuX2hpZ2hwUHJlY2lzaW9uID0gTWF0aC5taW4oaGlnaHBWZXJ0ZXhbInByZWNpc2lvbiJdLCBoaWdocEZyYWdbInByZWNpc2lvbiJdKTsKICAgICAgICAgICAgZWxzZSB0aGlzLl9oaWdocFByZWNpc2lvbiA9IDA7CiAgICAgICAgICAgIGlmICh0aGlzLl9tYXhQb2ludFNpemUgPiAyMDQ4KSB0aGlzLl9tYXhQb2ludFNpemUgPSAyMDQ4OwogICAgICAgICAgICB0aGlzLl9leHRlbnNpb25zID0gZ2wuZ2V0U3VwcG9ydGVkRXh0ZW5zaW9ucygpOwogICAgICAgICAgICBjb25zdCBkZWJ1Z19leHQgPSBnbC5nZXRFeHRlbnNpb24oIldFQkdMX2RlYnVnX3JlbmRlcmVyX2luZm8iKTsKICAgICAgICAgICAgaWYgKGRlYnVnX2V4dCkgewogICAgICAgICAgICAgICAgdGhpcy5fdW5tYXNrZWRWZW5kb3IgPSBnbC5nZXRQYXJhbWV0ZXIoZGVidWdfZXh0WyJVTk1BU0tFRF9WRU5ET1JfV0VCR0wiXSk7CiAgICAgICAgICAgICAgICB0aGlzLl91bm1hc2tlZFJlbmRlcmVyID0gZ2wuZ2V0UGFyYW1ldGVyKGRlYnVnX2V4dFsiVU5NQVNLRURfUkVOREVSRVJfV0VCR0wiXSkKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLl9wYXJhbGxlbFNoYWRlckNvbXBpbGVFeHQgPSBnbC5nZXRFeHRlbnNpb24oIktIUl9wYXJhbGxlbF9zaGFkZXJfY29tcGlsZSIpOwogICAgICAgICAgICBpZiAoQzMuaXNEZWJ1ZykgbG9zZUNvbnRleHRFeHRlbnNpb24gPSBnbC5nZXRFeHRlbnNpb24oIldFQkdMX2xvc2VfY29udGV4dCIpOwogICAgICAgICAgICBpZiAodGhpcy5faXNHcHVQcm9maWxpbmdFbmFibGVkKQogICAgICAgICAgICAgICAgaWYgKHRoaXMuR2V0V2ViR0xWZXJzaW9uTnVtYmVyKCkgPT09IDEpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoQzMuUGxhdGZvcm0uQnJvd3NlckVuZ2luZSAhPT0gIkNocm9taXVtIiB8fCBDMy5QbGF0Zm9ybS5Ccm93c2VyVmVyc2lvbk51bWJlciA+PSA4MSB8fCB0eXBlb2YgZG9jdW1lbnQgIT09ICJ1bmRlZmluZWQiKSB0aGlzLl90aW1lckV4dCA9IGdsLmdldEV4dGVuc2lvbigiRVhUX2Rpc2pvaW50X3RpbWVyX3F1ZXJ5IikKICAgICAgICAgICAgICAgIH0gZWxzZSB0aGlzLl90aW1lckV4dCA9IGdsLmdldEV4dGVuc2lvbigiRVhUX2Rpc2pvaW50X3RpbWVyX3F1ZXJ5X3dlYmdsMiIpIHx8IGdsLmdldEV4dGVuc2lvbigiRVhUX2Rpc2pvaW50X3RpbWVyX3F1ZXJ5Iik7CiAgICAgICAgICAgIHRoaXMuX2FuaXNvdHJvcGljRXh0ID0gZ2wuZ2V0RXh0ZW5zaW9uKCJFWFRfdGV4dHVyZV9maWx0ZXJfYW5pc290cm9waWMiKTsKICAgICAgICAgICAgaWYgKHRoaXMuX2FuaXNvdHJvcGljRXh0KSB0aGlzLl9tYXhBbmlzb3Ryb3B5ID0KICAgICAgICAgICAgICAgIGdsLmdldFBhcmFtZXRlcih0aGlzLl9hbmlzb3Ryb3BpY0V4dFsiTUFYX1RFWFRVUkVfTUFYX0FOSVNPVFJPUFlfRVhUIl0pOwogICAgICAgICAgICBlbHNlIHRoaXMuX21heEFuaXNvdHJvcHkgPSAwOwogICAgICAgICAgICBpZiAodGhpcy5HZXRXZWJHTFZlcnNpb25OdW1iZXIoKSA8IDIgJiYgdGhpcy5fdXNlc0RlcHRoQnVmZmVyICYmIHRoaXMuX2NhblNhbXBsZURlcHRoKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9kZXB0aFRleHR1cmVFeHQgPSBnbC5nZXRFeHRlbnNpb24oIldFQkdMX2RlcHRoX3RleHR1cmUiKTsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5fZGVwdGhUZXh0dXJlRXh0KSB0aHJvdyBuZXcgRXJyb3IoIm5vIGRlcHRoIHRleHR1cmUgc3VwcG9ydCIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLkdldFdlYkdMVmVyc2lvbk51bWJlcigpIDwgMikgewogICAgICAgICAgICAgICAgdGhpcy5fZnJhZ0RlcHRoRXh0ID0gZ2wuZ2V0RXh0ZW5zaW9uKCJFWFRfZnJhZ19kZXB0aCIpOwogICAgICAgICAgICAgICAgdGhpcy5fc3RkRGVyaXZhdGl2ZXNFeHQgPSBnbC5nZXRFeHRlbnNpb24oIk9FU19zdGFuZGFyZF9kZXJpdmF0aXZlcyIpOwogICAgICAgICAgICAgICAgdGhpcy5fdGV4dHVyZUxvZEV4dCA9IGdsLmdldEV4dGVuc2lvbigiRVhUX3NoYWRlcl90ZXh0dXJlX2xvZCIpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgV2ViR0xTaGFkZXJQcm9ncmFtID0KICAgICAgICAgICAgICAgIEMzLkdmeC5XZWJHTFNoYWRlclByb2dyYW07CiAgICAgICAgICAgIGNvbnN0IHZzU291cmNlID0gV2ViR0xTaGFkZXJQcm9ncmFtLkdldERlZmF1bHRWZXJ0ZXhTaGFkZXJTb3VyY2UoZmFsc2UpOwogICAgICAgICAgICBsZXQgdGV4dHVyZUZpbGxGcmFnbWVudFNyYyA9IFdlYkdMU2hhZGVyUHJvZ3JhbS5HZXRUZXh0dXJlRmlsbEZyYWdtZW50U2hhZGVyU291cmNlX1dlYkdMMV9Ob0ZyYWdEZXB0aCgpOwogICAgICAgICAgICBsZXQgdGV4dHVyZUZpbGxWZXJ0ZXhTcmMgPSB2c1NvdXJjZTsKICAgICAgICAgICAgbGV0IHBvaW50RnJhZ21lbnRTcmMgPSBXZWJHTFNoYWRlclByb2dyYW0uR2V0UG9pbnRGcmFnbWVudFNoYWRlclNvdXJjZV9XZWJHTDFfTm9GcmFnRGVwdGgoKTsKICAgICAgICAgICAgbGV0IHBvaW50VmVydGV4U3JjID0gV2ViR0xTaGFkZXJQcm9ncmFtLkdldFBvaW50VmVydGV4U2hhZGVyU291cmNlX1dlYkdMMSgpOwogICAgICAgICAgICBsZXQgdGlsZW1hcEZyYWdtZW50U3JjID0gV2ViR0xTaGFkZXJQcm9ncmFtLkdldFRpbGVtYXBGcmFnbWVudFNoYWRlclNvdXJjZV9XZWJHTDFfTm9GcmFnRGVwdGgoKTsKICAgICAgICAgICAgbGV0IHRpbGVtYXBWZXJ0ZXhTcmMgPQogICAgICAgICAgICAgICAgV2ViR0xTaGFkZXJQcm9ncmFtLkdldERlZmF1bHRWZXJ0ZXhTaGFkZXJTb3VyY2UodHJ1ZSk7CiAgICAgICAgICAgIGxldCB1c2VGcmFnRGVwdGhFeHQgPSBmYWxzZTsKICAgICAgICAgICAgaWYgKHRoaXMuX3VzZXNEZXB0aEJ1ZmZlciAmJiAoQzMuUGxhdGZvcm0uQnJvd3NlciAhPT0gIlNhZmFyaSIgfHwgQzMuUGxhdGZvcm0uQnJvd3NlclZlcnNpb25OdW1iZXIgPj0gMTUuNSkpCiAgICAgICAgICAgICAgICBpZiAodGhpcy5HZXRXZWJHTFZlcnNpb25OdW1iZXIoKSA8IDIpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fZnJhZ0RlcHRoRXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRleHR1cmVGaWxsRnJhZ21lbnRTcmMgPSBXZWJHTFNoYWRlclByb2dyYW0uR2V0VGV4dHVyZUZpbGxGcmFnbWVudFNoYWRlclNvdXJjZV9XZWJHTDFfRnJhZ0RlcHRoRVhUKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50RnJhZ21lbnRTcmMgPSBXZWJHTFNoYWRlclByb2dyYW0uR2V0UG9pbnRGcmFnbWVudFNoYWRlclNvdXJjZV9XZWJHTDFfRnJhZ0RlcHRoRVhUKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRpbGVtYXBGcmFnbWVudFNyYyA9IFdlYkdMU2hhZGVyUHJvZ3JhbS5HZXRUaWxlbWFwRnJhZ21lbnRTaGFkZXJTb3VyY2VfV2ViR0wxX0ZyYWdEZXB0aEVYVCgpOwogICAgICAgICAgICAgICAgICAgICAgICB1c2VGcmFnRGVwdGhFeHQgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0ZXh0dXJlRmlsbFZlcnRleFNyYyA9IFdlYkdMU2hhZGVyUHJvZ3JhbS5HZXREZWZhdWx0VmVydGV4U2hhZGVyU291cmNlX1dlYkdMMigpOwogICAgICAgICAgICAgICAgICAgIHRleHR1cmVGaWxsRnJhZ21lbnRTcmMgPSBXZWJHTFNoYWRlclByb2dyYW0uR2V0VGV4dHVyZUZpbGxGcmFnbWVudFNoYWRlclNvdXJjZV9XZWJHTDIoKTsKICAgICAgICAgICAgICAgICAgICBwb2ludEZyYWdtZW50U3JjID0gV2ViR0xTaGFkZXJQcm9ncmFtLkdldFBvaW50RnJhZ21lbnRTaGFkZXJTb3VyY2VfV2ViR0wyKCk7CiAgICAgICAgICAgICAgICAgICAgcG9pbnRWZXJ0ZXhTcmMgPSBXZWJHTFNoYWRlclByb2dyYW0uR2V0UG9pbnRWZXJ0ZXhTaGFkZXJTb3VyY2VfV2ViR0wyKCk7CiAgICAgICAgICAgICAgICAgICAgdGlsZW1hcEZyYWdtZW50U3JjID0gV2ViR0xTaGFkZXJQcm9ncmFtLkdldFRpbGVtYXBGcmFnbWVudFNoYWRlclNvdXJjZV9XZWJHTDIoKTsKICAgICAgICAgICAgICAgICAgICB0aWxlbWFwVmVydGV4U3JjID0gV2ViR0xTaGFkZXJQcm9ncmFtLkdldERlZmF1bHRWZXJ0ZXhTaGFkZXJTb3VyY2VfV2ViR0wyKHRydWUpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IHRpbGVSYW5kb21pemF0aW9uRnJhZ21lbnRTcmMgPQogICAgICAgICAgICAgICAgV2ViR0xTaGFkZXJQcm9ncmFtLkdldFRpbGVSYW5kb21pemF0aW9uRnJhZ21lbnRTaGFkZXJTb3VyY2UodGhpcy5HZXRXZWJHTFZlcnNpb25OdW1iZXIoKSwgdXNlRnJhZ0RlcHRoRXh0LCB0aGlzLl9zdGREZXJpdmF0aXZlc0V4dCAmJiB0aGlzLl90ZXh0dXJlTG9kRXh0KTsKICAgICAgICAgICAgY29uc3QgdGlsZVJhbmRvbWl6YXRpb25WZXJ0ZXhTcmMgPSB0aGlzLkdldFdlYkdMVmVyc2lvbk51bWJlcigpID49IDIgPyBXZWJHTFNoYWRlclByb2dyYW0uR2V0RGVmYXVsdFZlcnRleFNoYWRlclNvdXJjZV9XZWJHTDIoKSA6IHZzU291cmNlOwogICAgICAgICAgICBjb25zdCBERUZBVUxUX1NIQURFUl9QUk9HUkFNUyA9IFsKICAgICAgICAgICAgICAgIFt0ZXh0dXJlRmlsbEZyYWdtZW50U3JjLCB0ZXh0dXJlRmlsbFZlcnRleFNyYywgIjxkZWZhdWx0PiJdLAogICAgICAgICAgICAgICAgW3RleHR1cmVGaWxsRnJhZ21lbnRTcmMsIHRleHR1cmVGaWxsVmVydGV4U3JjLCAiPGRlZmF1bHQtZGV2aWNlLXRyYW5zZm9ybT4iXSwKICAgICAgICAgICAgICAgIFtwb2ludEZyYWdtZW50U3JjLCBwb2ludFZlcnRleFNyYywgIjxwb2ludD4iXSwKICAgICAgICAgICAgICAgIFtXZWJHTFNoYWRlclByb2dyYW0uR2V0Q29sb3JGaWxsRnJhZ21lbnRTaGFkZXJTb3VyY2UoKSwKICAgICAgICAgICAgICAgICAgICB2c1NvdXJjZSwgIjxmaWxsPiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICBbV2ViR0xTaGFkZXJQcm9ncmFtLkdldExpbmVhckdyYWRpZW50RmlsbEZyYWdtZW50U2hhZGVyU291cmNlKCksIHZzU291cmNlLCAiPGxpbmVhcmdyYWRpZW50PiJdLAogICAgICAgICAgICAgICAgW1dlYkdMU2hhZGVyUHJvZ3JhbS5HZXRQZW51bWJyYUZpbGxGcmFnbWVudFNoYWRlclNvdXJjZSgpLCB2c1NvdXJjZSwgIjxwZW51bWJyYT4iXSwKICAgICAgICAgICAgICAgIFtXZWJHTFNoYWRlclByb2dyYW0uR2V0SGFyZEVsbGlwc2VGaWxsRnJhZ21lbnRTaGFkZXJTb3VyY2UoKSwgdnNTb3VyY2UsICI8aGFyZGVsbGlwc2U+Il0sCiAgICAgICAgICAgICAgICBbV2ViR0xTaGFkZXJQcm9ncmFtLkdldEhhcmRFbGxpcHNlT3V0bGluZUZyYWdtZW50U2hhZGVyU291cmNlKCksIHZzU291cmNlLCAiPGhhcmRlbGxpcHNlb3V0bGluZT4iXSwKICAgICAgICAgICAgICAgIFtXZWJHTFNoYWRlclByb2dyYW0uR2V0U21vb3RoRWxsaXBzZUZpbGxGcmFnbWVudFNoYWRlclNvdXJjZSgpLCB2c1NvdXJjZSwgIjxzbW9vdGhlbGxpcHNlPiJdLAogICAgICAgICAgICAgICAgW1dlYkdMU2hhZGVyUHJvZ3JhbS5HZXRTbW9vdGhFbGxpcHNlT3V0bGluZUZyYWdtZW50U2hhZGVyU291cmNlKCksCiAgICAgICAgICAgICAgICAgICAgdnNTb3VyY2UsICI8c21vb3RoZWxsaXBzZW91dGxpbmU+IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgIFtXZWJHTFNoYWRlclByb2dyYW0uR2V0U21vb3RoTGluZUZpbGxGcmFnbWVudFNoYWRlclNvdXJjZSgpLCB2c1NvdXJjZSwgIjxzbW9vdGhsaW5lPiJdLAogICAgICAgICAgICAgICAgW3RpbGVtYXBGcmFnbWVudFNyYywgdGlsZW1hcFZlcnRleFNyYywgIjx0aWxlbWFwPiJdLAogICAgICAgICAgICAgICAgW3RpbGVSYW5kb21pemF0aW9uRnJhZ21lbnRTcmMsIHRpbGVSYW5kb21pemF0aW9uVmVydGV4U3JjLCAiPHRpbGVyYW5kb21pemF0aW9uPiJdCiAgICAgICAgICAgIF07CiAgICAgICAgICAgIGNvbnN0IGRlZmF1bHRTaGFkZXJzID0gYXdhaXQgUHJvbWlzZS5hbGwoREVGQVVMVF9TSEFERVJfUFJPR1JBTVMubWFwKGkgPT4gdGhpcy5DcmVhdGVTaGFkZXJQcm9ncmFtKHsKICAgICAgICAgICAgICAgIHNyYzogaVswXSwKICAgICAgICAgICAgICAgIHZlcnRleFNyYzogaVsxXSwKICAgICAgICAgICAgICAgIG5hbWU6IGlbMl0KICAgICAgICAgICAgfSkpKTsKICAgICAgICAgICAgdGhpcy5fc3BUZXh0dXJlRmlsbCA9IGRlZmF1bHRTaGFkZXJzWzBdOwogICAgICAgICAgICB0aGlzLl9zcERldmljZVRyYW5zZm9ybVRleHR1cmVGaWxsID0gZGVmYXVsdFNoYWRlcnNbMV07CiAgICAgICAgICAgIHRoaXMuX3NwUG9pbnRzID0gZGVmYXVsdFNoYWRlcnNbMl07CiAgICAgICAgICAgIHRoaXMuX3NwQ29sb3JGaWxsID0gZGVmYXVsdFNoYWRlcnNbM107CiAgICAgICAgICAgIHRoaXMuX3NwTGluZWFyR3JhZGllbnRGaWxsID0gZGVmYXVsdFNoYWRlcnNbNF07CiAgICAgICAgICAgIHRoaXMuX3NwUGVudW1icmFGaWxsID0gZGVmYXVsdFNoYWRlcnNbNV07CiAgICAgICAgICAgIHRoaXMuX3NwSGFyZEVsbGlwc2VGaWxsID0gZGVmYXVsdFNoYWRlcnNbNl07CiAgICAgICAgICAgIHRoaXMuX3NwSGFyZEVsbGlwc2VPdXRsaW5lID0gZGVmYXVsdFNoYWRlcnNbN107CiAgICAgICAgICAgIHRoaXMuX3NwU21vb3RoRWxsaXBzZUZpbGwgPSBkZWZhdWx0U2hhZGVyc1s4XTsKICAgICAgICAgICAgdGhpcy5fc3BTbW9vdGhFbGxpcHNlT3V0bGluZSA9IGRlZmF1bHRTaGFkZXJzWzldOwogICAgICAgICAgICB0aGlzLl9zcFNtb290aExpbmVGaWxsID0gZGVmYXVsdFNoYWRlcnNbMTBdOwogICAgICAgICAgICB0aGlzLl9zcFRpbGVtYXBGaWxsID0gZGVmYXVsdFNoYWRlcnNbMTFdOwogICAgICAgICAgICB0aGlzLl9zcFRpbGVSYW5kb21pemF0aW9uID0gZGVmYXVsdFNoYWRlcnNbMTJdOwogICAgICAgICAgICB0aGlzLlNldFRleHR1cmVGaWxsTW9kZSgpCiAgICAgICAgfQogICAgICAgIGFzeW5jIENyZWF0ZVNoYWRlclByb2dyYW0oc2hhZGVySW5mbykgewogICAgICAgICAgICBjb25zdCByZXQgPSBhd2FpdCBDMy5HZnguV2ViR0xTaGFkZXJQcm9ncmFtLkNyZWF0ZSh0aGlzLAogICAgICAgICAgICAgICAgc2hhZGVySW5mbyk7CiAgICAgICAgICAgIHRoaXMuX0FkZFNoYWRlclByb2dyYW0ocmV0KTsKICAgICAgICAgICAgcmV0dXJuIHJldAogICAgICAgIH0KICAgICAgICBSZXNldExhc3RQcm9ncmFtKCkgewogICAgICAgICAgICB0aGlzLl9sYXN0UHJvZ3JhbSA9IG51bGwKICAgICAgICB9CiAgICAgICAgU2V0U2l6ZSh3LCBoLCBmb3JjZSkgewogICAgICAgICAgICBpZiAodGhpcy5fd2lkdGggPT09IHcgJiYgdGhpcy5faGVpZ2h0ID09PSBoICYmICFmb3JjZSkgcmV0dXJuOwogICAgICAgICAgICB0aGlzLkVuZEJhdGNoKCk7CiAgICAgICAgICAgIGNvbnN0IGdsID0gdGhpcy5fZ2w7CiAgICAgICAgICAgIGNvbnN0IGJhdGNoU3RhdGUgPSB0aGlzLl9iYXRjaFN0YXRlOwogICAgICAgICAgICB0aGlzLl93aWR0aCA9IHc7CiAgICAgICAgICAgIHRoaXMuX2hlaWdodCA9IGg7CiAgICAgICAgICAgIHRoaXMuX1NldFZpZXdwb3J0KDAsIDAsIHcsIGgpOwogICAgICAgICAgICB0aGlzLkNhbGN1bGF0ZVBlcnNwZWN0aXZlTWF0cml4KHRoaXMuX2JiUHJvamVjdGlvbk1hdHJpeCwgdyAvIGgpOwogICAgICAgICAgICB0aGlzLlNldFByb2plY3Rpb25NYXRyaXgodGhpcy5fYmJQcm9qZWN0aW9uTWF0cml4KTsKICAgICAgICAgICAgaWYgKHRoaXMuX3NwRGV2aWNlVHJhbnNmb3JtVGV4dHVyZUZpbGwpIHsKICAgICAgICAgICAgICAgIGdsLnVzZVByb2dyYW0odGhpcy5fc3BEZXZpY2VUcmFuc2Zvcm1UZXh0dXJlRmlsbC5HZXRTaGFkZXJQcm9ncmFtKCkpOwogICAgICAgICAgICAgICAgdGhpcy5fc3BEZXZpY2VUcmFuc2Zvcm1UZXh0dXJlRmlsbC5fVXBkYXRlRGV2aWNlVHJhbnNmb3JtVW5pZm9ybXModGhpcy5fbWF0UCk7CiAgICAgICAgICAgICAgICB0aGlzLl9sYXN0UHJvZ3JhbSA9IHRoaXMuX3NwRGV2aWNlVHJhbnNmb3JtVGV4dHVyZUZpbGw7CiAgICAgICAgICAgICAgICB0aGlzLl9iYXRjaFN0YXRlLmN1cnJlbnRTaGFkZXIgPSB0aGlzLl9zcERldmljZVRyYW5zZm9ybVRleHR1cmVGaWxsCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZ2wuYmluZFRleHR1cmUoZ2wuVEVYVFVSRV8yRCwgbnVsbCk7CiAgICAgICAgICAgIGdsLmFjdGl2ZVRleHR1cmUoZ2wuVEVYVFVSRTEpOwogICAgICAgICAgICBnbC5iaW5kVGV4dHVyZShnbC5URVhUVVJFXzJELCBudWxsKTsKICAgICAgICAgICAgZ2wuYWN0aXZlVGV4dHVyZShnbC5URVhUVVJFMCk7CiAgICAgICAgICAgIHRoaXMuX2xhc3RUZXh0dXJlMCA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX2xhc3RUZXh0dXJlMSA9IG51bGw7CiAgICAgICAgICAgIGlmICh0aGlzLl91c2VzRGVwdGhCdWZmZXIgJiYgdGhpcy5faXNBdXRvU2l6ZURlcHRoQnVmZmVyKSB0aGlzLl9TZXREZXB0aEJ1ZmZlclNpemUodGhpcy5fd2lkdGgsIHRoaXMuX2hlaWdodCk7CiAgICAgICAgICAgIGlmICh0aGlzLl9jdXJyZW50UmVuZGVyVGFyZ2V0KSB0aGlzLl9jdXJyZW50UmVuZGVyVGFyZ2V0Ll9SZXNpemUodGhpcy5fd2lkdGgsCiAgICAgICAgICAgICAgICB0aGlzLl9oZWlnaHQpOwogICAgICAgICAgICBnbC5iaW5kRnJhbWVidWZmZXIoZ2wuRlJBTUVCVUZGRVIsIG51bGwpOwogICAgICAgICAgICB0aGlzLl9jdXJyZW50UmVuZGVyVGFyZ2V0ID0gbnVsbDsKICAgICAgICAgICAgYmF0Y2hTdGF0ZS5jdXJyZW50RnJhbWVidWZmZXIgPSBudWxsOwogICAgICAgICAgICBiYXRjaFN0YXRlLmN1cnJlbnRGcmFtZWJ1ZmZlck5vRGVwdGggPSBudWxsCiAgICAgICAgfQogICAgICAgIF9TZXREZXB0aEJ1ZmZlclNpemUod2lkdGgsIGhlaWdodCkgewogICAgICAgICAgICBjb25zdCBnbCA9IHRoaXMuX2dsOwogICAgICAgICAgICBpZiAodGhpcy5fZGVwdGhCdWZmZXIgJiYgdGhpcy5fZGVwdGhCdWZmZXJXaWR0aCA9PT0gd2lkdGggJiYgdGhpcy5fZGVwdGhCdWZmZXJIZWlnaHQgPT09IGhlaWdodCkgcmV0dXJuOwogICAgICAgICAgICBpZiAodGhpcy5fY2FuU2FtcGxlRGVwdGgpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9kZXB0aEJ1ZmZlcikgZ2wuZGVsZXRlVGV4dHVyZSh0aGlzLl9kZXB0aEJ1ZmZlcik7CiAgICAgICAgICAgICAgICB0aGlzLl9kZXB0aEJ1ZmZlciA9IGdsLmNyZWF0ZVRleHR1cmUoKTsKICAgICAgICAgICAgICAgIGdsLmJpbmRUZXh0dXJlKGdsLlRFWFRVUkVfMkQsIHRoaXMuX2RlcHRoQnVmZmVyKTsKICAgICAgICAgICAgICAgIGdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV8yRCwKICAgICAgICAgICAgICAgICAgICBnbC5URVhUVVJFX01BR19GSUxURVIsIGdsLk5FQVJFU1QpOwogICAgICAgICAgICAgICAgZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFXzJELCBnbC5URVhUVVJFX01JTl9GSUxURVIsIGdsLk5FQVJFU1QpOwogICAgICAgICAgICAgICAgZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFXzJELCBnbC5URVhUVVJFX1dSQVBfUywgZ2wuQ0xBTVBfVE9fRURHRSk7CiAgICAgICAgICAgICAgICBnbC50ZXhQYXJhbWV0ZXJpKGdsLlRFWFRVUkVfMkQsIGdsLlRFWFRVUkVfV1JBUF9ULCBnbC5DTEFNUF9UT19FREdFKTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLkdldFdlYkdMVmVyc2lvbk51bWJlcigpID49IDIpIGdsLnRleEltYWdlMkQoZ2wuVEVYVFVSRV8yRCwgMCwgZ2wuREVQVEgyNF9TVEVOQ0lMOCwgd2lkdGgsIGhlaWdodCwgMCwgZ2wuREVQVEhfU1RFTkNJTCwgZ2wuVU5TSUdORURfSU5UXzI0XzgsIG51bGwpOwogICAgICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5fZGVwdGhUZXh0dXJlRXh0KSBnbC50ZXhJbWFnZTJEKGdsLlRFWFRVUkVfMkQsIDAsIGdsLkRFUFRIX1NURU5DSUwsIHdpZHRoLCBoZWlnaHQsIDAsIGdsLkRFUFRIX1NURU5DSUwsIHRoaXMuX2RlcHRoVGV4dHVyZUV4dFsiVU5TSUdORURfSU5UXzI0XzhfV0VCR0wiXSwKICAgICAgICAgICAgICAgICAgICBudWxsKTsKICAgICAgICAgICAgICAgIGVsc2U7CiAgICAgICAgICAgICAgICBnbC5iaW5kVGV4dHVyZShnbC5URVhUVVJFXzJELCBudWxsKQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuX2RlcHRoQnVmZmVyKSBnbC5kZWxldGVSZW5kZXJidWZmZXIodGhpcy5fZGVwdGhCdWZmZXIpOwogICAgICAgICAgICAgICAgdGhpcy5fZGVwdGhCdWZmZXIgPSBnbC5jcmVhdGVSZW5kZXJidWZmZXIoKTsKICAgICAgICAgICAgICAgIGdsLmJpbmRSZW5kZXJidWZmZXIoZ2wuUkVOREVSQlVGRkVSLCB0aGlzLl9kZXB0aEJ1ZmZlcik7CiAgICAgICAgICAgICAgICBnbC5yZW5kZXJidWZmZXJTdG9yYWdlKGdsLlJFTkRFUkJVRkZFUiwgdGhpcy5fdmVyc2lvbiA+PSAyID8gZ2wuREVQVEgyNF9TVEVOQ0lMOCA6IGdsLkRFUFRIX1NURU5DSUwsIHdpZHRoLCBoZWlnaHQpOwogICAgICAgICAgICAgICAgZ2wuYmluZFJlbmRlcmJ1ZmZlcihnbC5SRU5ERVJCVUZGRVIsIG51bGwpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5fZGVwdGhCdWZmZXJXaWR0aCA9IHdpZHRoOwogICAgICAgICAgICB0aGlzLl9kZXB0aEJ1ZmZlckhlaWdodCA9IGhlaWdodAogICAgICAgIH0KICAgICAgICBTZXRGaXhlZFNpemVEZXB0aEJ1ZmZlcih3aWR0aCwgaGVpZ2h0KSB7CiAgICAgICAgICAgIGlmICghdGhpcy5fdXNlc0RlcHRoQnVmZmVyKSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuX2lzQXV0b1NpemVEZXB0aEJ1ZmZlciA9CiAgICAgICAgICAgICAgICBmYWxzZTsKICAgICAgICAgICAgdGhpcy5fU2V0RGVwdGhCdWZmZXJTaXplKHdpZHRoLCBoZWlnaHQpCiAgICAgICAgfQogICAgICAgIFNldEF1dG9TaXplRGVwdGhCdWZmZXIoKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5fdXNlc0RlcHRoQnVmZmVyKSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuX2lzQXV0b1NpemVEZXB0aEJ1ZmZlciA9IHRydWU7CiAgICAgICAgICAgIHRoaXMuX1NldERlcHRoQnVmZmVyU2l6ZSh0aGlzLl93aWR0aCwgdGhpcy5faGVpZ2h0KQogICAgICAgIH0KICAgICAgICBfU2V0Vmlld3BvcnQoeCwgeSwgdywgaCkgewogICAgICAgICAgICBjb25zdCB2aWV3cG9ydCA9IHRoaXMuX3ZpZXdwb3J0OwogICAgICAgICAgICBpZiAodmlld3BvcnRbMF0gPT09IHggJiYgdmlld3BvcnRbMV0gPT09IHkgJiYgdmlld3BvcnRbMl0gPT09IHcgJiYgdmlld3BvcnRbM10gPT09IGgpIHJldHVybjsKICAgICAgICAgICAgY29uc3QgYiA9IHRoaXMuUHVzaEJhdGNoKCk7CiAgICAgICAgICAgIGIuSW5pdFNldFZpZXdwb3J0KHgsIHksIHcsIGgpOwogICAgICAgICAgICB2ZWM0LnNldCh2aWV3cG9ydCwgeCwgeSwgdywgaCk7CiAgICAgICAgICAgIHRoaXMuX3RvcE9mQmF0Y2ggPSAwCiAgICAgICAgfQogICAgICAgIFNldEZvdlkoZikgewogICAgICAgICAgICBzdXBlci5TZXRGb3ZZKGYpOwogICAgICAgICAgICB0aGlzLkNhbGN1bGF0ZVBlcnNwZWN0aXZlTWF0cml4KHRoaXMuX2JiUHJvamVjdGlvbk1hdHJpeCwgdGhpcy5fd2lkdGggLwogICAgICAgICAgICAgICAgdGhpcy5faGVpZ2h0KQogICAgICAgIH0KICAgICAgICBTZXROZWFyWih6KSB7CiAgICAgICAgICAgIHN1cGVyLlNldE5lYXJaKHopOwogICAgICAgICAgICB0aGlzLkNhbGN1bGF0ZVBlcnNwZWN0aXZlTWF0cml4KHRoaXMuX2JiUHJvamVjdGlvbk1hdHJpeCwgdGhpcy5fd2lkdGggLyB0aGlzLl9oZWlnaHQpCiAgICAgICAgfQogICAgICAgIFNldEZhclooeikgewogICAgICAgICAgICBzdXBlci5TZXRGYXJaKHopOwogICAgICAgICAgICB0aGlzLkNhbGN1bGF0ZVBlcnNwZWN0aXZlTWF0cml4KHRoaXMuX2JiUHJvamVjdGlvbk1hdHJpeCwgdGhpcy5fd2lkdGggLyB0aGlzLl9oZWlnaHQpCiAgICAgICAgfQogICAgICAgIFNldFByb2plY3Rpb25NYXRyaXgobWF0UCkgewogICAgICAgICAgICBpZiAobWF0NC5leGFjdEVxdWFscyh0aGlzLl9tYXRQLCBtYXRQKSkgcmV0dXJuOwogICAgICAgICAgICBjb25zdCBiID0gdGhpcy5QdXNoQmF0Y2goKTsKICAgICAgICAgICAgYi5Jbml0U2V0UHJvamVjdGlvbihtYXRQKTsKICAgICAgICAgICAgbWF0NC5jb3B5KHRoaXMuX21hdFAsIG1hdFApOwogICAgICAgICAgICB0aGlzLl90b3BPZkJhdGNoID0gMDsKICAgICAgICAgICAgdGhpcy5fZGlkQ2hhbmdlVHJhbnNmb3JtID0gdHJ1ZQogICAgICAgIH0KICAgICAgICBTZXREZWZhdWx0UmVuZGVyVGFyZ2V0UHJvamVjdGlvblN0YXRlKCkgewogICAgICAgICAgICBsZXQgcHJvamVjdGlvbk1hdHJpeDsKICAgICAgICAgICAgbGV0IHZpZXdwb3J0V2lkdGgsCiAgICAgICAgICAgICAgICB2aWV3cG9ydEhlaWdodDsKICAgICAgICAgICAgY29uc3QgY3VycmVudFJlbmRlclRhcmdldCA9IHRoaXMuX2N1cnJlbnRSZW5kZXJUYXJnZXQ7CiAgICAgICAgICAgIGlmIChjdXJyZW50UmVuZGVyVGFyZ2V0ID09PSBudWxsKSB7CiAgICAgICAgICAgICAgICBwcm9qZWN0aW9uTWF0cml4ID0gdGhpcy5fYmJQcm9qZWN0aW9uTWF0cml4OwogICAgICAgICAgICAgICAgdmlld3BvcnRXaWR0aCA9IHRoaXMuR2V0V2lkdGgoKTsKICAgICAgICAgICAgICAgIHZpZXdwb3J0SGVpZ2h0ID0gdGhpcy5HZXRIZWlnaHQoKQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcHJvamVjdGlvbk1hdHJpeCA9IGN1cnJlbnRSZW5kZXJUYXJnZXQuR2V0UHJvamVjdGlvbk1hdHJpeCgpOwogICAgICAgICAgICAgICAgdmlld3BvcnRXaWR0aCA9IGN1cnJlbnRSZW5kZXJUYXJnZXQuR2V0V2lkdGgoKTsKICAgICAgICAgICAgICAgIHZpZXdwb3J0SGVpZ2h0ID0gY3VycmVudFJlbmRlclRhcmdldC5HZXRIZWlnaHQoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuU2V0UHJvamVjdGlvbk1hdHJpeChwcm9qZWN0aW9uTWF0cml4KTsKICAgICAgICAgICAgdGhpcy5fU2V0Vmlld3BvcnQoMCwgMCwgdmlld3BvcnRXaWR0aCwgdmlld3BvcnRIZWlnaHQpCiAgICAgICAgfQogICAgICAgIFNldE1vZGVsVmlld01hdHJpeChtYXRNVikgewogICAgICAgICAgICBpZiAobWF0NC5leGFjdEVxdWFscyh0aGlzLl9tYXRNViwKICAgICAgICAgICAgICAgICAgICBtYXRNVikpIHJldHVybjsKICAgICAgICAgICAgY29uc3QgYiA9IHRoaXMuUHVzaEJhdGNoKCk7CiAgICAgICAgICAgIGIuSW5pdFNldE1vZGVsVmlldyhtYXRNVik7CiAgICAgICAgICAgIG1hdDQuY29weSh0aGlzLl9tYXRNViwgbWF0TVYpOwogICAgICAgICAgICB0aGlzLl90b3BPZkJhdGNoID0gMDsKICAgICAgICAgICAgdGhpcy5fZGlkQ2hhbmdlVHJhbnNmb3JtID0gdHJ1ZQogICAgICAgIH0KICAgICAgICBSZXNldERpZENoYW5nZVRyYW5zZm9ybUZsYWcoKSB7CiAgICAgICAgICAgIHRoaXMuX2RpZENoYW5nZVRyYW5zZm9ybSA9IGZhbHNlCiAgICAgICAgfQogICAgICAgIERpZENoYW5nZVRyYW5zZm9ybSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2RpZENoYW5nZVRyYW5zZm9ybQogICAgICAgIH0KICAgICAgICBHZXRCYXRjaFN0YXRlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fYmF0Y2hTdGF0ZQogICAgICAgIH0KICAgICAgICBQdXNoQmF0Y2goKSB7CiAgICAgICAgICAgIGNvbnN0IGJhdGNoID0gdGhpcy5fYmF0Y2g7CiAgICAgICAgICAgIGlmICh0aGlzLl9iYXRjaFB0ciA9PT0gYmF0Y2gubGVuZ3RoKSBiYXRjaC5wdXNoKG5ldyBDMy5HZnguV2ViR0xCYXRjaEpvYih0aGlzLl9iYXRjaFN0YXRlKSk7CiAgICAgICAgICAgIHJldHVybiBiYXRjaFt0aGlzLl9iYXRjaFB0cisrXQogICAgICAgIH0KICAgICAgICBFbmRCYXRjaCgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX2JhdGNoUHRyID09PSAwKSByZXR1cm47CiAgICAgICAgICAgIGlmICh0aGlzLklzQ29udGV4dExvc3QoKSkgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl9Xcml0ZUJ1ZmZlcnMoKTsKICAgICAgICAgICAgdGhpcy5fRXhlY3V0ZUJhdGNoKCk7CiAgICAgICAgICAgIHRoaXMuX2JhdGNoUHRyID0gMDsKICAgICAgICAgICAgdGhpcy5fdmVydGV4UHRyID0gMDsKICAgICAgICAgICAgdGhpcy5fdGV4UHRyID0gMDsKICAgICAgICAgICAgdGhpcy5fcG9pbnRQdHIgPSAwOwogICAgICAgICAgICB0aGlzLl90b3BPZkJhdGNoID0gMAogICAgICAgIH0KICAgICAgICBfV3JpdGVCdWZmZXJzKCkgewogICAgICAgICAgICBjb25zdCBnbCA9IHRoaXMuX2dsOwogICAgICAgICAgICBpZiAodGhpcy5fcG9pbnRQdHIgPiAwKSB7CiAgICAgICAgICAgICAgICBnbC5iaW5kQnVmZmVyKGdsLkFSUkFZX0JVRkZFUiwgdGhpcy5fcG9pbnRCdWZmZXIpOwogICAgICAgICAgICAgICAgZ2wuYnVmZmVyU3ViRGF0YShnbC5BUlJBWV9CVUZGRVIsIDAsIHRoaXMuX3BvaW50RGF0YS5zdWJhcnJheSgwLCB0aGlzLl9wb2ludFB0cikpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHRoaXMuX3ZlcnRleFB0ciA+IDApIHsKICAgICAgICAgICAgICAgIGdsLmJpbmRCdWZmZXIoZ2wuQVJSQVlfQlVGRkVSLCB0aGlzLl92ZXJ0ZXhCdWZmZXIpOwogICAgICAgICAgICAgICAgZ2wuYnVmZmVyU3ViRGF0YShnbC5BUlJBWV9CVUZGRVIsIDAsIHRoaXMuX3ZlcnRleERhdGEuc3ViYXJyYXkoMCwgdGhpcy5fdmVydGV4UHRyKSk7CiAgICAgICAgICAgICAgICBnbC5iaW5kQnVmZmVyKGdsLkFSUkFZX0JVRkZFUiwgdGhpcy5fdGV4Y29vcmRCdWZmZXIpOwogICAgICAgICAgICAgICAgZ2wuYnVmZmVyU3ViRGF0YShnbC5BUlJBWV9CVUZGRVIsIDAsIHRoaXMuX3RleGNvb3JkRGF0YS5zdWJhcnJheSgwLCB0aGlzLl90ZXhQdHIpKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIF9FeGVjdXRlQmF0Y2goKSB7CiAgICAgICAgICAgIGNvbnN0IGJhdGNoID0gdGhpcy5fYmF0Y2g7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSB0aGlzLl9iYXRjaFB0cjsgaSA8IGxlbjsgKytpKSBiYXRjaFtpXS5SdW4oKQogICAgICAgIH0KICAgICAgICBHZXRPcGFjaXR5KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fbGFzdENvbG9yLmdldEEoKQogICAgICAgIH0KICAgICAgICBTZXRDb2xvclJnYmEociwgZywgYiwgYSkgewogICAgICAgICAgICBjb25zdCBsYXN0Q29sb3IgPSB0aGlzLl9sYXN0Q29sb3I7CiAgICAgICAgICAgIGlmIChsYXN0Q29sb3IuZXF1YWxzUmdiYShyLCBnLCBiLCBhKSkgcmV0dXJuOwogICAgICAgICAgICBsYXN0Q29sb3Iuc2V0UmdiYShyLCBnLCBiLCBhKTsKICAgICAgICAgICAgY29uc3QgYmF0Y2ggPSB0aGlzLlB1c2hCYXRjaCgpOwogICAgICAgICAgICBiYXRjaC5Jbml0U2V0Q29sb3IobGFzdENvbG9yKTsKICAgICAgICAgICAgdGhpcy5fdG9wT2ZCYXRjaCA9IDA7CiAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRTdGF0ZUdyb3VwID0gbnVsbAogICAgICAgIH0KICAgICAgICBTZXRPcGFjaXR5KGEpIHsKICAgICAgICAgICAgY29uc3QgbGFzdENvbG9yID0gdGhpcy5fbGFzdENvbG9yOwogICAgICAgICAgICBpZiAobGFzdENvbG9yLmdldEEoKSA9PT0KICAgICAgICAgICAgICAgIGEpIHJldHVybjsKICAgICAgICAgICAgbGFzdENvbG9yLnNldEEoYSk7CiAgICAgICAgICAgIGNvbnN0IGJhdGNoID0gdGhpcy5QdXNoQmF0Y2goKTsKICAgICAgICAgICAgYmF0Y2guSW5pdFNldENvbG9yKGxhc3RDb2xvcik7CiAgICAgICAgICAgIHRoaXMuX3RvcE9mQmF0Y2ggPSAwOwogICAgICAgICAgICB0aGlzLl9jdXJyZW50U3RhdGVHcm91cCA9IG51bGwKICAgICAgICB9CiAgICAgICAgU2V0Q29sb3IoYykgewogICAgICAgICAgICBjb25zdCBsYXN0Q29sb3IgPSB0aGlzLl9sYXN0Q29sb3I7CiAgICAgICAgICAgIGlmIChsYXN0Q29sb3IuZXF1YWxzKGMpKSByZXR1cm47CiAgICAgICAgICAgIGxhc3RDb2xvci5zZXQoYyk7CiAgICAgICAgICAgIGNvbnN0IGJhdGNoID0gdGhpcy5QdXNoQmF0Y2goKTsKICAgICAgICAgICAgYmF0Y2guSW5pdFNldENvbG9yKGxhc3RDb2xvcik7CiAgICAgICAgICAgIHRoaXMuX3RvcE9mQmF0Y2ggPSAwOwogICAgICAgICAgICB0aGlzLl9jdXJyZW50U3RhdGVHcm91cCA9IG51bGwKICAgICAgICB9CiAgICAgICAgUmVzZXRDb2xvcigpIHsKICAgICAgICAgICAgdGhpcy5TZXRDb2xvclJnYmEoMSwgMSwgMSwgMSkKICAgICAgICB9CiAgICAgICAgR2V0Q29sb3IoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9sYXN0Q29sb3IKICAgICAgICB9CiAgICAgICAgU2V0VGV4dHVyZShyZW5kZXJlclRleCkgewogICAgICAgICAgICBpZiAocmVuZGVyZXJUZXggPT09IHRoaXMuX2xhc3RUZXh0dXJlMCkgcmV0dXJuOwogICAgICAgICAgICBjb25zdCBiID0gdGhpcy5QdXNoQmF0Y2goKTsKICAgICAgICAgICAgYi5Jbml0U2V0VGV4dHVyZShyZW5kZXJlclRleCk7CiAgICAgICAgICAgIHRoaXMuX2xhc3RUZXh0dXJlMCA9IHJlbmRlcmVyVGV4OwogICAgICAgICAgICB0aGlzLl90b3BPZkJhdGNoID0gMAogICAgICAgIH0KICAgICAgICBfUmVzZXRMYXN0VGV4dHVyZSgpIHsKICAgICAgICAgICAgdGhpcy5fbGFzdFRleHR1cmUwID0gbnVsbAogICAgICAgIH0KICAgICAgICBTZXRCbGVuZE1vZGUoYm0pIHsKICAgICAgICAgICAgY29uc3QgYXJyID0gdGhpcy5fR2V0QmxlbmRCeUluZGV4KGJtKTsKICAgICAgICAgICAgdGhpcy5fU2V0QmxlbmQoYXJyWzBdLCBhcnJbMV0pCiAgICAgICAgfQogICAgICAgIFNldE5hbWVkQmxlbmRNb2RlKGJtKSB7CiAgICAgICAgICAgIGNvbnN0IG8gPSB0aGlzLkdldE5hbWVkQmxlbmQoYm0pOwogICAgICAgICAgICB0aGlzLl9TZXRCbGVuZChvLnNyY0JsZW5kLCBvLmRlc3RCbGVuZCkKICAgICAgICB9CiAgICAgICAgX1NldEJsZW5kKHMsIGQpIHsKICAgICAgICAgICAgaWYgKHMgPT09IHRoaXMuX2xhc3RTcmNCbGVuZCAmJiBkID09PSB0aGlzLl9sYXN0RGVzdEJsZW5kKSByZXR1cm47CiAgICAgICAgICAgIGNvbnN0IGIgPSB0aGlzLlB1c2hCYXRjaCgpOwogICAgICAgICAgICBiLkluaXRTZXRCbGVuZChzLCBkKTsKICAgICAgICAgICAgdGhpcy5fbGFzdFNyY0JsZW5kID0gczsKICAgICAgICAgICAgdGhpcy5fbGFzdERlc3RCbGVuZCA9IGQ7CiAgICAgICAgICAgIHRoaXMuX3RvcE9mQmF0Y2ggPSAwOwogICAgICAgICAgICB0aGlzLl9jdXJyZW50U3RhdGVHcm91cCA9IG51bGwKICAgICAgICB9CiAgICAgICAgSXNQcmVtdWx0aXBsaWVkQWxwaGFCbGVuZCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2xhc3RTcmNCbGVuZCA9PT0KICAgICAgICAgICAgICAgIHRoaXMuX2dsLk9ORSAmJiB0aGlzLl9sYXN0RGVzdEJsZW5kID09PSB0aGlzLl9nbC5PTkVfTUlOVVNfU1JDX0FMUEhBCiAgICAgICAgfQogICAgICAgIFNldEFscGhhQmxlbmQoKSB7CiAgICAgICAgICAgIHRoaXMuX1NldEJsZW5kKHRoaXMuX2dsLk9ORSwgdGhpcy5fZ2wuT05FX01JTlVTX1NSQ19BTFBIQSkKICAgICAgICB9CiAgICAgICAgU2V0Tm9QcmVtdWx0aXBseUFscGhhQmxlbmQoKSB7CiAgICAgICAgICAgIHRoaXMuX1NldEJsZW5kKHRoaXMuX2dsLlNSQ19BTFBIQSwgdGhpcy5fZ2wuT05FX01JTlVTX1NSQ19BTFBIQSkKICAgICAgICB9CiAgICAgICAgU2V0Q29weUJsZW5kKCkgewogICAgICAgICAgICB0aGlzLl9TZXRCbGVuZCh0aGlzLl9nbC5PTkUsIHRoaXMuX2dsLlpFUk8pCiAgICAgICAgfQogICAgICAgIFJlY3QocikgewogICAgICAgICAgICB0aGlzLlJlY3QyKHIuZ2V0TGVmdCgpLCByLmdldFRvcCgpLCByLmdldFJpZ2h0KCksIHIuZ2V0Qm90dG9tKCkpCiAgICAgICAgfQogICAgICAgIFJlY3QyKGxlZnQsIHRvcCwgcmlnaHQsIGJvdHRvbSkgewogICAgICAgICAgICB0aGlzLlF1YWQyKGxlZnQsIHRvcCwgcmlnaHQsIHRvcCwgcmlnaHQsIGJvdHRvbSwgbGVmdCwgYm90dG9tKQogICAgICAgIH0KICAgICAgICBfRXh0ZW5kUXVhZEJhdGNoKCkgewogICAgICAgICAgICBsZXQgdiA9IHRoaXMuX3ZlcnRleFB0cjsKICAgICAgICAgICAgaWYgKHYgPj0gdGhpcy5fbGFzdFZlcnRleFB0cikgewogICAgICAgICAgICAgICAgdGhpcy5FbmRCYXRjaCgpOwogICAgICAgICAgICAgICAgdiA9IDAKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGhpcy5fdG9wT2ZCYXRjaCA9PT0gMSkgdGhpcy5fYmF0Y2hbdGhpcy5fYmF0Y2hQdHIgLSAxXS5faW5kZXhDb3VudCArPSA2OwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbnN0IGIgPSB0aGlzLlB1c2hCYXRjaCgpOwogICAgICAgICAgICAgICAgYi5Jbml0UXVhZCh2LCA2KTsKICAgICAgICAgICAgICAgIHRoaXMuX3RvcE9mQmF0Y2ggPSAxCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgX1dyaXRlUXVhZFRvVmVydGV4QnVmZmVyKHF1YWQpIHsKICAgICAgICAgICAgcXVhZC53cml0ZVRvVHlwZWRBcnJheTNEKHRoaXMuX3ZlcnRleERhdGEsIHRoaXMuX3ZlcnRleFB0ciwgdGhpcy5fYmFzZVogKyB0aGlzLl9jdXJyZW50Wik7CiAgICAgICAgICAgIHRoaXMuX3ZlcnRleFB0ciArPSAxMgogICAgICAgIH0KICAgICAgICBRdWFkKHF1YWQpIHsKICAgICAgICAgICAgdGhpcy5fRXh0ZW5kUXVhZEJhdGNoKCk7CiAgICAgICAgICAgIHRoaXMuX1dyaXRlUXVhZFRvVmVydGV4QnVmZmVyKHF1YWQpOwogICAgICAgICAgICBkZWZhdWx0VGV4Q29vcmRzUXVhZC53cml0ZVRvVHlwZWRBcnJheSh0aGlzLl90ZXhjb29yZERhdGEsIHRoaXMuX3RleFB0cik7CiAgICAgICAgICAgIHRoaXMuX3RleFB0ciArPSA4CiAgICAgICAgfQogICAgICAgIFF1YWQyKHRseCwgdGx5LCB0cngsIHRyeV8sIGJyeCwgYnJ5LCBibHgsIGJseSkgewogICAgICAgICAgICB0aGlzLl9FeHRlbmRRdWFkQmF0Y2goKTsKICAgICAgICAgICAgY29uc3QgdmQgPQogICAgICAgICAgICAgICAgdGhpcy5fdmVydGV4RGF0YTsKICAgICAgICAgICAgbGV0IHYgPSB0aGlzLl92ZXJ0ZXhQdHI7CiAgICAgICAgICAgIGNvbnN0IHogPSB0aGlzLl9iYXNlWiArIHRoaXMuX2N1cnJlbnRaOwogICAgICAgICAgICB2ZFt2KytdID0gdGx4OwogICAgICAgICAgICB2ZFt2KytdID0gdGx5OwogICAgICAgICAgICB2ZFt2KytdID0gejsKICAgICAgICAgICAgdmRbdisrXSA9IHRyeDsKICAgICAgICAgICAgdmRbdisrXSA9IHRyeV87CiAgICAgICAgICAgIHZkW3YrK10gPSB6OwogICAgICAgICAgICB2ZFt2KytdID0gYnJ4OwogICAgICAgICAgICB2ZFt2KytdID0gYnJ5OwogICAgICAgICAgICB2ZFt2KytdID0gejsKICAgICAgICAgICAgdmRbdisrXSA9IGJseDsKICAgICAgICAgICAgdmRbdisrXSA9IGJseTsKICAgICAgICAgICAgdmRbdisrXSA9IHo7CiAgICAgICAgICAgIHRoaXMuX3ZlcnRleFB0ciA9IHY7CiAgICAgICAgICAgIGRlZmF1bHRUZXhDb29yZHNRdWFkLndyaXRlVG9UeXBlZEFycmF5KHRoaXMuX3RleGNvb3JkRGF0YSwgdGhpcy5fdGV4UHRyKTsKICAgICAgICAgICAgdGhpcy5fdGV4UHRyICs9IDgKICAgICAgICB9CiAgICAgICAgUXVhZDMocXVhZCwgcmNUZXgpIHsKICAgICAgICAgICAgdGhpcy5fRXh0ZW5kUXVhZEJhdGNoKCk7CiAgICAgICAgICAgIHRoaXMuX1dyaXRlUXVhZFRvVmVydGV4QnVmZmVyKHF1YWQpOwogICAgICAgICAgICByY1RleC53cml0ZUFzUXVhZFRvVHlwZWRBcnJheSh0aGlzLl90ZXhjb29yZERhdGEsIHRoaXMuX3RleFB0cik7CiAgICAgICAgICAgIHRoaXMuX3RleFB0ciArPSA4CiAgICAgICAgfQogICAgICAgIFF1YWQ0KHF1YWQsIHV2KSB7CiAgICAgICAgICAgIHRoaXMuX0V4dGVuZFF1YWRCYXRjaCgpOwogICAgICAgICAgICB0aGlzLl9Xcml0ZVF1YWRUb1ZlcnRleEJ1ZmZlcihxdWFkKTsKICAgICAgICAgICAgdXYud3JpdGVUb1R5cGVkQXJyYXkodGhpcy5fdGV4Y29vcmREYXRhLCB0aGlzLl90ZXhQdHIpOwogICAgICAgICAgICB0aGlzLl90ZXhQdHIgKz0gOAogICAgICAgIH0KICAgICAgICBRdWFkM0QodGx4LCB0bHksIHRseiwgdHJ4LCB0cnlfLCB0cnosIGJyeCwgYnJ5LCBicnosIGJseCwgYmx5LCBibHosIHJjVGV4KSB7CiAgICAgICAgICAgIHRoaXMuX0V4dGVuZFF1YWRCYXRjaCgpOwogICAgICAgICAgICBjb25zdCB2ZCA9IHRoaXMuX3ZlcnRleERhdGE7CiAgICAgICAgICAgIGxldCB2ID0gdGhpcy5fdmVydGV4UHRyOwogICAgICAgICAgICBjb25zdCB6ID0gdGhpcy5fYmFzZVogKyB0aGlzLl9jdXJyZW50WjsKICAgICAgICAgICAgdmRbdisrXSA9IHRseDsKICAgICAgICAgICAgdmRbdisrXSA9IHRseTsKICAgICAgICAgICAgdmRbdisrXSA9IHogKyB0bHo7CiAgICAgICAgICAgIHZkW3YrK10gPSB0cng7CiAgICAgICAgICAgIHZkW3YrK10gPSB0cnlfOwogICAgICAgICAgICB2ZFt2KytdID0geiArIHRyejsKICAgICAgICAgICAgdmRbdisrXSA9IGJyeDsKICAgICAgICAgICAgdmRbdisrXSA9IGJyeTsKICAgICAgICAgICAgdmRbdisrXSA9IHogKyBicno7CiAgICAgICAgICAgIHZkW3YrK10gPSBibHg7CiAgICAgICAgICAgIHZkW3YrK10gPSBibHk7CiAgICAgICAgICAgIHZkW3YrK10gPSB6ICsgYmx6OwogICAgICAgICAgICB0aGlzLl92ZXJ0ZXhQdHIgPSB2OwogICAgICAgICAgICByY1RleC53cml0ZUFzUXVhZFRvVHlwZWRBcnJheSh0aGlzLl90ZXhjb29yZERhdGEsIHRoaXMuX3RleFB0cik7CiAgICAgICAgICAgIHRoaXMuX3RleFB0ciArPSA4CiAgICAgICAgfQogICAgICAgIFF1YWQzRDIodGx4LCB0bHksIHRseiwgdHJ4LCB0cnlfLCB0cnosIGJyeCwgYnJ5LCBicnosIGJseCwgYmx5LCBibHosIHV2KSB7CiAgICAgICAgICAgIHRoaXMuX0V4dGVuZFF1YWRCYXRjaCgpOwogICAgICAgICAgICBjb25zdCB2ZCA9IHRoaXMuX3ZlcnRleERhdGE7CiAgICAgICAgICAgIGxldCB2ID0gdGhpcy5fdmVydGV4UHRyOwogICAgICAgICAgICBjb25zdCB6ID0gdGhpcy5fYmFzZVogKyB0aGlzLl9jdXJyZW50WjsKICAgICAgICAgICAgdmRbdisrXSA9IHRseDsKICAgICAgICAgICAgdmRbdisrXSA9IHRseTsKICAgICAgICAgICAgdmRbdisrXSA9IHogKyB0bHo7CiAgICAgICAgICAgIHZkW3YrK10gPSB0cng7CiAgICAgICAgICAgIHZkW3YrK10gPSB0cnlfOwogICAgICAgICAgICB2ZFt2KytdID0geiArIHRyejsKICAgICAgICAgICAgdmRbdisrXSA9IGJyeDsKICAgICAgICAgICAgdmRbdisrXSA9IGJyeTsKICAgICAgICAgICAgdmRbdisrXSA9IHogKyBicno7CiAgICAgICAgICAgIHZkW3YrK10gPSBibHg7CiAgICAgICAgICAgIHZkW3YrK10gPSBibHk7CiAgICAgICAgICAgIHZkW3YrK10gPSB6ICsgYmx6OwogICAgICAgICAgICB0aGlzLl92ZXJ0ZXhQdHIgPSB2OwogICAgICAgICAgICB1di53cml0ZVRvVHlwZWRBcnJheSh0aGlzLl90ZXhjb29yZERhdGEsIHRoaXMuX3RleFB0cik7CiAgICAgICAgICAgIHRoaXMuX3RleFB0ciArPSA4CiAgICAgICAgfQogICAgICAgIEZ1bGxzY3JlZW5RdWFkKG1vZGUsIGN1clRleCkgewogICAgICAgICAgICBtYXQ0LmNvcHkodG1wUHJvamVjdGlvbiwgdGhpcy5fbWF0UCk7CiAgICAgICAgICAgIG1hdDQuY29weSh0bXBNb2RlbFZpZXcsCiAgICAgICAgICAgICAgICB0aGlzLl9tYXRNVik7CiAgICAgICAgICAgIHRoaXMuU2V0RGVmYXVsdFJlbmRlclRhcmdldFByb2plY3Rpb25TdGF0ZSgpOwogICAgICAgICAgICBjb25zdCBbd2lkdGgsIGhlaWdodF0gPSB0aGlzLkdldFJlbmRlclRhcmdldFNpemUodGhpcy5fY3VycmVudFJlbmRlclRhcmdldCk7CiAgICAgICAgICAgIGNvbnN0IHRlbXBNYXQ0YiA9IHRoaXMuQ2FsY3VsYXRlTG9va0F0TW9kZWxWaWV3MigwLCAwLCB0aGlzLkdldERlZmF1bHRDYW1lcmFaKGhlaWdodCksIDAsIDAsIDAsIGhlaWdodCk7CiAgICAgICAgICAgIHRoaXMuU2V0TW9kZWxWaWV3TWF0cml4KHRlbXBNYXQ0Yik7CiAgICAgICAgICAgIGlmIChtb2RlID09PSAiY3JvcCIgJiYgdGhpcy5fY3VycmVudFJlbmRlclRhcmdldCAmJiBjdXJUZXgpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGxlZnQgPSB0aGlzLl93aWR0aCAvIDI7CiAgICAgICAgICAgICAgICBjb25zdCB0b3AgPSB0aGlzLl9oZWlnaHQgLyAyOwogICAgICAgICAgICAgICAgY29uc3Qgc3JjVyA9IGN1clRleC5HZXRXaWR0aCgpOwogICAgICAgICAgICAgICAgY29uc3Qgc3JjSCA9IGN1clRleC5HZXRIZWlnaHQoKTsKICAgICAgICAgICAgICAgIGNvbnN0IGRlc3RXID0gdGhpcy5fY3VycmVudFJlbmRlclRhcmdldC5HZXRXaWR0aCgpOwogICAgICAgICAgICAgICAgY29uc3QgZGVzdEggPSB0aGlzLl9jdXJyZW50UmVuZGVyVGFyZ2V0LkdldEhlaWdodCgpOwogICAgICAgICAgICAgICAgY29uc3QgY29weVcgPSBNYXRoLm1pbihkZXN0Vywgc3JjVyk7CiAgICAgICAgICAgICAgICBjb25zdCBjb3B5SCA9IE1hdGgubWluKGRlc3RILCBzcmNIKTsKICAgICAgICAgICAgICAgIGNvbnN0IHNyY09mZlkgPSBNYXRoLm1heChzcmNIIC0gZGVzdEgsIDApOwogICAgICAgICAgICAgICAgY29uc3QgZGVzdE9mZlkgPSBNYXRoLm1heChkZXN0SCAtIHNyY0gsIDApOwogICAgICAgICAgICAgICAgdG1wUmVjdC5zZXQoLWxlZnQsIHRvcCAtIGRlc3RPZmZZLCAtbGVmdCArIGNvcHlXLCB0b3AgLSBjb3B5SCAtIGRlc3RPZmZZKTsKICAgICAgICAgICAgICAgIHRtcFF1YWQuc2V0RnJvbVJlY3QodG1wUmVjdCk7CiAgICAgICAgICAgICAgICB0bXBSZWN0LnNldCgwLCBzcmNPZmZZLCBjb3B5VywgY29weUggKyBzcmNPZmZZKTsKICAgICAgICAgICAgICAgIHRtcFJlY3QuZGl2aWRlKHNyY1csIHNyY0gpOwogICAgICAgICAgICAgICAgdGhpcy5RdWFkMyh0bXBRdWFkLCB0bXBSZWN0KQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29uc3QgaGFsZlcgPSB3aWR0aCAvIDI7CiAgICAgICAgICAgICAgICBjb25zdCBoYWxmSCA9IGhlaWdodCAvIDI7CiAgICAgICAgICAgICAgICB0aGlzLlJlY3QyKC1oYWxmVywgaGFsZkgsIGhhbGZXLCAtaGFsZkgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5TZXRQcm9qZWN0aW9uTWF0cml4KHRtcFByb2plY3Rpb24pOwogICAgICAgICAgICB0aGlzLlNldE1vZGVsVmlld01hdHJpeCh0bXBNb2RlbFZpZXcpCiAgICAgICAgfQogICAgICAgIFN0YXJ0UmVuZGVyaW5nUG9pbnRzKHJlY3QpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX2xhc3RQb2ludFRleENvb3Jkcy5lcXVhbHMocmVjdCkpIHJldHVybjsKICAgICAgICAgICAgdGhpcy5fbGFzdFBvaW50VGV4Q29vcmRzLmNvcHkocmVjdCk7CiAgICAgICAgICAgIGNvbnN0IGIgPSB0aGlzLlB1c2hCYXRjaCgpOwogICAgICAgICAgICBiLkluaXRTZXRQb2ludFRleENvb3JkcyhyZWN0KTsKICAgICAgICAgICAgdGhpcy5fdG9wT2ZCYXRjaCA9IDAKICAgICAgICB9CiAgICAgICAgRmluaXNoUmVuZGVyaW5nUG9pbnRzKCkge30KICAgICAgICBQb2ludCh4XywgeV8sIHNpemVfLCBvcGFjaXR5XykgewogICAgICAgICAgICBpZiAodGhpcy5fcG9pbnRQdHIgPj0gTEFTVF9QT0lOVCkgdGhpcy5FbmRCYXRjaCgpOwogICAgICAgICAgICBsZXQgcCA9IHRoaXMuX3BvaW50UHRyOwogICAgICAgICAgICBjb25zdCB6ID0gdGhpcy5fYmFzZVogKyB0aGlzLl9jdXJyZW50WjsKICAgICAgICAgICAgaWYgKHRoaXMuX3RvcE9mQmF0Y2ggPT09IDIgJiYgdGhpcy5fbGFzdFBvaW50WiA9PT0geikgdGhpcy5fYmF0Y2hbdGhpcy5fYmF0Y2hQdHIgLSAxXS5faW5kZXhDb3VudCsrOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbnN0IGIgPSB0aGlzLlB1c2hCYXRjaCgpOwogICAgICAgICAgICAgICAgYi5Jbml0UG9pbnRzKHAsIHopOwogICAgICAgICAgICAgICAgdGhpcy5fdG9wT2ZCYXRjaCA9IDI7CiAgICAgICAgICAgICAgICB0aGlzLl9sYXN0UG9pbnRaID0gegogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IHBkID0gdGhpcy5fcG9pbnREYXRhOwogICAgICAgICAgICBwZFtwKytdID0geF87CiAgICAgICAgICAgIHBkW3ArK10gPSB5XzsKICAgICAgICAgICAgcGRbcCsrXSA9IHNpemVfOwogICAgICAgICAgICBwZFtwKytdID0gb3BhY2l0eV87CiAgICAgICAgICAgIHRoaXMuX3BvaW50UHRyID0gcAogICAgICAgIH0KICAgICAgICBTZXRQcm9ncmFtKHByb2dyYW0pIHsKICAgICAgICAgICAgaWYgKHRoaXMuX2xhc3RQcm9ncmFtID09PSBwcm9ncmFtKSByZXR1cm47CiAgICAgICAgICAgIGNvbnN0IGIgPSB0aGlzLlB1c2hCYXRjaCgpOwogICAgICAgICAgICBiLkluaXRTZXRQcm9ncmFtKHByb2dyYW0pOwogICAgICAgICAgICB0aGlzLl9sYXN0UHJvZ3JhbSA9IHByb2dyYW07CiAgICAgICAgICAgIHRoaXMuX3RvcE9mQmF0Y2ggPSAwOwogICAgICAgICAgICB0aGlzLl9jdXJyZW50U3RhdGVHcm91cCA9IG51bGwKICAgICAgICB9CiAgICAgICAgU2V0RGV2aWNlVHJhbnNmb3JtVGV4dHVyZUZpbGxNb2RlKCkgewogICAgICAgICAgICB0aGlzLlNldFByb2dyYW0odGhpcy5fc3BEZXZpY2VUcmFuc2Zvcm1UZXh0dXJlRmlsbCkKICAgICAgICB9CiAgICAgICAgU2V0R3JhZGllbnRDb2xvcihjKSB7CiAgICAgICAgICAgIGNvbnN0IGIgPSB0aGlzLlB1c2hCYXRjaCgpOwogICAgICAgICAgICBiLkluaXRTZXRHcmFkaWVudENvbG9yKGMpOwogICAgICAgICAgICB0aGlzLl90b3BPZkJhdGNoID0gMAogICAgICAgIH0KICAgICAgICBTZXRFbGxpcHNlUGFyYW1zKHBpeGVsVywgcGl4ZWxILCBvdXRsaW5lVGhpY2tuZXNzID0gMSkgewogICAgICAgICAgICBjb25zdCBiID0gdGhpcy5QdXNoQmF0Y2goKTsKICAgICAgICAgICAgYi5Jbml0U2V0RWxsaXBzZVBhcmFtcyhwaXhlbFcsCiAgICAgICAgICAgICAgICBwaXhlbEgsIG91dGxpbmVUaGlja25lc3MpOwogICAgICAgICAgICB0aGlzLl90b3BPZkJhdGNoID0gMAogICAgICAgIH0KICAgICAgICBTZXRUaWxlbWFwSW5mbyhzcmNSZWN0LCB0ZXh0dXJlV2lkdGgsIHRleHR1cmVIZWlnaHQsIHRpbGVXaWR0aCwgdGlsZUhlaWdodCwgdGlsZVNwYWNpbmdYLCB0aWxlU3BhY2luZ1kpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX2xhc3RQcm9ncmFtICE9PSB0aGlzLl9zcFRpbGVtYXBGaWxsKSB0aHJvdyBuZXcgRXJyb3IoIm11c3Qgc2V0IHRpbGVtYXAgZmlsbCBtb2RlIGZpcnN0Iik7CiAgICAgICAgICAgIGNvbnN0IGIgPSB0aGlzLlB1c2hCYXRjaCgpOwogICAgICAgICAgICBiLkluaXRTZXRUaWxlbWFwSW5mbyhzcmNSZWN0LCB0ZXh0dXJlV2lkdGgsIHRleHR1cmVIZWlnaHQsIHRpbGVXaWR0aCwgdGlsZUhlaWdodCwgdGlsZVNwYWNpbmdYLCB0aWxlU3BhY2luZ1kpOwogICAgICAgICAgICB0aGlzLl90b3BPZkJhdGNoID0gMAogICAgICAgIH0KICAgICAgICBTZXRUaWxlUmFuZG9taXphdGlvbkluZm8odGV4dHVyZVdpZHRoLCB0ZXh0dXJlSGVpZ2h0LCB4UmFuZG9tLCB5UmFuZG9tLCBhbmdsZVJhbmRvbSwgYmxlbmRNYXJnaW5YLCBibGVuZE1hcmdpblkpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX2xhc3RQcm9ncmFtICE9PQogICAgICAgICAgICAgICAgdGhpcy5fc3BUaWxlUmFuZG9taXphdGlvbikgdGhyb3cgbmV3IEVycm9yKCJtdXN0IHNldCB0aWxlIHJhbmRvbWl6YXRpb24gbW9kZSBmaXJzdCIpOwogICAgICAgICAgICBjb25zdCBiID0gdGhpcy5QdXNoQmF0Y2goKTsKICAgICAgICAgICAgYi5Jbml0U2V0VGlsZVJhbmRvbWl6YXRpb25JbmZvKHRleHR1cmVXaWR0aCwgdGV4dHVyZUhlaWdodCwgeFJhbmRvbSwgeVJhbmRvbSwgYW5nbGVSYW5kb20sIGJsZW5kTWFyZ2luWCwgYmxlbmRNYXJnaW5ZKTsKICAgICAgICAgICAgdGhpcy5fdG9wT2ZCYXRjaCA9IDAKICAgICAgICB9CiAgICAgICAgU2V0UHJvZ3JhbVBhcmFtZXRlcnMoYmFja1RleCwgZGVzdFJlY3QsIHNyY1JlY3QsIHNyY09yaWdpblJlY3QsIGxheW91dFJlY3QsIHBpeGVsV2lkdGgsIHBpeGVsSGVpZ2h0LCBkcHIsIGxheWVyU2NhbGUsIGxheWVyQW5nbGUsIHRpbWUpIHsKICAgICAgICAgICAgY29uc3QgcyA9IHRoaXMuX2xhc3RQcm9ncmFtOwogICAgICAgICAgICB0aW1lID0gdGltZSAlIDEwODAwOwogICAgICAgICAgICBpZiAoIXMuX2hhc0FueU9wdGlvbmFsVW5pZm9ybXMgfHwgcy5BcmVPcHRpb25hbFVuaWZvcm1zQWxyZWFkeVNldEluQmF0Y2goZGVzdFJlY3QsIHNyY1JlY3QsIHNyY09yaWdpblJlY3QsCiAgICAgICAgICAgICAgICAgICAgbGF5b3V0UmVjdCwgcGl4ZWxXaWR0aCwgcGl4ZWxIZWlnaHQsIGRwciwgbGF5ZXJTY2FsZSwgbGF5ZXJBbmdsZSwgdGltZSkpIHJldHVybjsKICAgICAgICAgICAgY29uc3QgYiA9IHRoaXMuUHVzaEJhdGNoKCk7CiAgICAgICAgICAgIGIuSW5pdFNldFByb2dyYW1QYXJhbWV0ZXJzKCk7CiAgICAgICAgICAgIHMuU2V0T3B0aW9uYWxVbmlmb3Jtc0luQmF0Y2goZGVzdFJlY3QsIHNyY1JlY3QsIHNyY09yaWdpblJlY3QsIGxheW91dFJlY3QsIHBpeGVsV2lkdGgsIHBpeGVsSGVpZ2h0LCBkcHIsIGxheWVyU2NhbGUsIGxheWVyQW5nbGUsIHRpbWUpOwogICAgICAgICAgICBjb25zdCBtYXQ0cGFyYW0gPSBiLl9tYXQ0cGFyYW07CiAgICAgICAgICAgIG1hdDRwYXJhbVswXSA9IHBpeGVsV2lkdGg7CiAgICAgICAgICAgIG1hdDRwYXJhbVsxXSA9IHBpeGVsSGVpZ2h0OwogICAgICAgICAgICBkZXN0UmVjdC53cml0ZVRvVHlwZWRBcnJheShtYXQ0cGFyYW0sIDIpOwogICAgICAgICAgICBtYXQ0cGFyYW1bNl0gPSBsYXllclNjYWxlOwogICAgICAgICAgICBtYXQ0cGFyYW1bN10gPSBsYXllckFuZ2xlOwogICAgICAgICAgICBzcmNSZWN0LndyaXRlVG9UeXBlZEFycmF5KG1hdDRwYXJhbSwgMTIpOwogICAgICAgICAgICBjb25zdCBjb2xvclBhcmFtID0gYi5fY29sb3JQYXJhbTsKICAgICAgICAgICAgbGF5b3V0UmVjdC53cml0ZVRvVHlwZWRBcnJheShjb2xvclBhcmFtLAogICAgICAgICAgICAgICAgMCk7CiAgICAgICAgICAgIGNvbnN0IHRtcCA9IGNvbG9yUGFyYW1bMV07CiAgICAgICAgICAgIGNvbG9yUGFyYW1bMV0gPSBjb2xvclBhcmFtWzNdOwogICAgICAgICAgICBjb2xvclBhcmFtWzNdID0gdG1wOwogICAgICAgICAgICBzcmNPcmlnaW5SZWN0LndyaXRlVG9UeXBlZEFycmF5KGIuX3NyY09yaWdpblJlY3QsIDApOwogICAgICAgICAgICBiLl9zdGFydEluZGV4ID0gdGltZTsKICAgICAgICAgICAgYi5faW5kZXhDb3VudCA9IGRwcjsKICAgICAgICAgICAgaWYgKHMuX3VTYW1wbGVyQmFjay5Jc1VzZWQoKSkgYi5fdGV4UGFyYW0gPSBiYWNrVGV4ID8gYmFja1RleC5HZXRUZXh0dXJlKCkgOiBudWxsOwogICAgICAgICAgICBlbHNlIGIuX3RleFBhcmFtID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fdG9wT2ZCYXRjaCA9IDAKICAgICAgICB9CiAgICAgICAgU2V0UHJvZ3JhbUN1c3RvbVBhcmFtZXRlcnMocGFyYW1zKSB7CiAgICAgICAgICAgIGNvbnN0IHMgPSB0aGlzLl9sYXN0UHJvZ3JhbTsKICAgICAgICAgICAgaWYgKHBhcmFtcy5sZW5ndGggPT09IDAgfHwgcy5BcmVDdXN0b21QYXJhbWV0ZXJzQWxyZWFkeVNldEluQmF0Y2gocGFyYW1zKSkgcmV0dXJuOwogICAgICAgICAgICBjb25zdCBiID0gdGhpcy5QdXNoQmF0Y2goKTsKICAgICAgICAgICAgYi5Jbml0U2V0UHJvZ3JhbUN1c3RvbVBhcmFtZXRlcnMoKTsKICAgICAgICAgICAgcy5TZXRDdXN0b21QYXJhbWV0ZXJzSW5CYXRjaChwYXJhbXMpOwogICAgICAgICAgICBDMy5zaGFsbG93QXNzaWduQXJyYXkoYi5fc2hhZGVyUGFyYW1zLCBwYXJhbXMpOwogICAgICAgICAgICB0aGlzLl90b3BPZkJhdGNoID0gMAogICAgICAgIH0KICAgICAgICBDbGVhclJnYmEociwgZywgYl8sIGEpIHsKICAgICAgICAgICAgY29uc3QgYiA9IHRoaXMuUHVzaEJhdGNoKCk7CiAgICAgICAgICAgIGIuSW5pdENsZWFyU3VyZmFjZTIociwgZywgYl8sIGEpOwogICAgICAgICAgICB0aGlzLl90b3BPZkJhdGNoID0gMAogICAgICAgIH0KICAgICAgICBDbGVhcihjKSB7CiAgICAgICAgICAgIGNvbnN0IGIgPSB0aGlzLlB1c2hCYXRjaCgpOwogICAgICAgICAgICBiLkluaXRDbGVhclN1cmZhY2UoYyk7CiAgICAgICAgICAgIHRoaXMuX3RvcE9mQmF0Y2ggPSAwCiAgICAgICAgfQogICAgICAgIFN0YXJ0KCkge30KICAgICAgICBGaW5pc2goKSB7CiAgICAgICAgICAgIHN1cGVyLkZpbmlzaCgpOwogICAgICAgICAgICB0aGlzLl9nbC5mbHVzaCgpCiAgICAgICAgfQogICAgICAgIENsZWFyRGVwdGgoKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5fdXNlc0RlcHRoQnVmZmVyIHx8ICF0aGlzLl9jdXJyZW50UmVuZGVyVGFyZ2V0IHx8ICF0aGlzLl9jdXJyZW50UmVuZGVyVGFyZ2V0Lkhhc0RlcHRoQnVmZmVyKCkpIHJldHVybjsKICAgICAgICAgICAgY29uc3QgYmF0Y2ggPSB0aGlzLlB1c2hCYXRjaCgpOwogICAgICAgICAgICBiYXRjaC5Jbml0Q2xlYXJEZXB0aCh0aGlzLl9pc0RlcHRoRW5hYmxlZCk7CiAgICAgICAgICAgIHRoaXMuX3RvcE9mQmF0Y2ggPSAwCiAgICAgICAgfQogICAgICAgIFNldERlcHRoRW5hYmxlZChlKSB7CiAgICAgICAgICAgIGUgPSAhIWU7CiAgICAgICAgICAgIGlmICh0aGlzLl9pc0RlcHRoRW5hYmxlZCA9PT0gZSkgcmV0dXJuOwogICAgICAgICAgICBpZiAoIXRoaXMuX3VzZXNEZXB0aEJ1ZmZlcikgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl9pc0RlcHRoRW5hYmxlZCA9IGU7CiAgICAgICAgICAgIGNvbnN0IGJhdGNoID0gdGhpcy5QdXNoQmF0Y2goKTsKICAgICAgICAgICAgYmF0Y2guSW5pdFNldERlcHRoRW5hYmxlZChlKTsKICAgICAgICAgICAgdGhpcy5fdG9wT2ZCYXRjaCA9IDAKICAgICAgICB9CiAgICAgICAgSXNEZXB0aEVuYWJsZWQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pc0RlcHRoRW5hYmxlZAogICAgICAgIH0KICAgICAgICBfR2V0RGVwdGhCdWZmZXIoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9kZXB0aEJ1ZmZlcgogICAgICAgIH0KICAgICAgICBfQ2FuU2FtcGxlRGVwdGgoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9jYW5TYW1wbGVEZXB0aAogICAgICAgIH0KICAgICAgICBTZXREZXB0aFNhbXBsaW5nRW5hYmxlZChlKSB7CiAgICAgICAgICAgIGUgPSAhIWU7CiAgICAgICAgICAgIGlmICghdGhpcy5fY2FuU2FtcGxlRGVwdGgpIHJldHVybjsKICAgICAgICAgICAgaWYgKHRoaXMuX2lzRGVwdGhTYW1wbGluZ0VuYWJsZWQgPT09IGUpIHJldHVybjsKICAgICAgICAgICAgaWYgKGUgJiYgdGhpcy5Jc0RlcHRoRW5hYmxlZCgpKSB0aHJvdyBuZXcgRXJyb3IoImRlcHRoIHN0aWxsIGVuYWJsZWQiKTsKICAgICAgICAgICAgdGhpcy5faXNEZXB0aFNhbXBsaW5nRW5hYmxlZCA9CiAgICAgICAgICAgICAgICBlOwogICAgICAgICAgICBjb25zdCBiYXRjaCA9IHRoaXMuUHVzaEJhdGNoKCk7CiAgICAgICAgICAgIGJhdGNoLkluaXRTZXREZXB0aFNhbXBsaW5nRW5hYmxlZChlKTsKICAgICAgICAgICAgdGhpcy5fdG9wT2ZCYXRjaCA9IDAKICAgICAgICB9CiAgICAgICAgU2V0U2Npc3NvclJlY3QoeCwgeSwgdywgaCwgcnRIZWlnaHRfID0gMCkgewogICAgICAgICAgICB4ID0gTWF0aC5mbG9vcih4KTsKICAgICAgICAgICAgeSA9IE1hdGguZmxvb3IoeSk7CiAgICAgICAgICAgIHcgPSBNYXRoLmZsb29yKHcpOwogICAgICAgICAgICBoID0gTWF0aC5mbG9vcihoKTsKICAgICAgICAgICAgaWYgKHRoaXMuX2xhc3RTY2lzc29yUmVjdC5lcXVhbHNXSCh4LCB5LCB3LCBoKSkgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl9sYXN0U2Npc3NvclJlY3Quc2V0V0goeCwgeSwgdywgaCk7CiAgICAgICAgICAgIGNvbnN0IHJ0SGVpZ2h0ID0gcnRIZWlnaHRfIHx8IHRoaXMuR2V0UmVuZGVyVGFyZ2V0U2l6ZSh0aGlzLkdldFJlbmRlclRhcmdldCgpKVsxXTsKICAgICAgICAgICAgeSA9IHJ0SGVpZ2h0IC0geSAtIGg7CiAgICAgICAgICAgIGNvbnN0IGJhdGNoID0gdGhpcy5QdXNoQmF0Y2goKTsKICAgICAgICAgICAgYmF0Y2guSW5pdFNldFNjaXNzb3IodHJ1ZSwgeCwgeSwgdywgaCk7CiAgICAgICAgICAgIHRoaXMuX3RvcE9mQmF0Y2ggPSAwCiAgICAgICAgfQogICAgICAgIFJlbW92ZVNjaXNzb3JSZWN0KCkgewogICAgICAgICAgICBpZiAodGhpcy5fbGFzdFNjaXNzb3JSZWN0LmdldFJpZ2h0KCkgPT09CiAgICAgICAgICAgICAgICAtMSkgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl9sYXN0U2Npc3NvclJlY3Quc2V0KDAsIDAsIC0xLCAtMSk7CiAgICAgICAgICAgIGNvbnN0IGJhdGNoID0gdGhpcy5QdXNoQmF0Y2goKTsKICAgICAgICAgICAgYmF0Y2guSW5pdFNldFNjaXNzb3IoZmFsc2UsIDAsIDAsIDAsIDApOwogICAgICAgICAgICB0aGlzLl90b3BPZkJhdGNoID0gMAogICAgICAgIH0KICAgICAgICBDaGVja0ZvclF1ZXJ5UmVzdWx0cygpIHsKICAgICAgICAgICAgZm9yIChjb25zdCBxcmIgb2YgdGhpcy5fYWxsUXVlcnlSZXN1bHRCdWZmZXJzKSBxcmIuQ2hlY2tGb3JSZXN1bHRzKHRoaXMuX2ZyYW1lTnVtYmVyKQogICAgICAgIH0KICAgICAgICBJc0NvbnRleHRMb3N0KCkgewogICAgICAgICAgICByZXR1cm4gIXRoaXMuX2dsIHx8IHRoaXMuX2dsLmlzQ29udGV4dExvc3QoKSB8fCB0aGlzLl9pc0luaXRpYWxpc2luZ0FmdGVyQ29udGV4dFJlc3RvcmVkCiAgICAgICAgfQogICAgICAgIE9uQ29udGV4dExvc3QoKSB7CiAgICAgICAgICAgIHN1cGVyLk9uRGV2aWNlT3JDb250ZXh0TG9zdCgpOwogICAgICAgICAgICBDMy5HZnguV2ViR0xSZW5kZXJlclRleHR1cmUuT25Db250ZXh0TG9zdCgpOwogICAgICAgICAgICBDMy5HZnguV2ViR0xSZW5kZXJUYXJnZXQuT25Db250ZXh0TG9zdCgpOwogICAgICAgICAgICBDMy5HZnguUmVuZGVyZXJUZXh0Lk9uQ29udGV4dExvc3QoKTsKICAgICAgICAgICAgZm9yIChjb25zdCBxcmIgb2YgdGhpcy5fYWxsUXVlcnlSZXN1bHRCdWZmZXJzKSBxcmIuQ2xlYXIoKTsKICAgICAgICAgICAgdGhpcy5fZXh0ZW5zaW9ucyA9IFtdOwogICAgICAgICAgICB0aGlzLl90aW1lckV4dCA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3BhcmFsbGVsU2hhZGVyQ29tcGlsZUV4dCA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX2FuaXNvdHJvcGljRXh0ID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fZGVwdGhUZXh0dXJlRXh0ID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fZnJhZ0RlcHRoRXh0ID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fc3RkRGVyaXZhdGl2ZXNFeHQgPSBudWxsOwogICAgICAgICAgICB0aGlzLl90ZXh0dXJlTG9kRXh0ID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fbWF4QW5pc290cm9weSA9IDA7CiAgICAgICAgICAgIHRoaXMuX3VubWFza2VkVmVuZG9yID0gIih1bmF2YWlsYWJsZSkiOwogICAgICAgICAgICB0aGlzLl91bm1hc2tlZFJlbmRlcmVyID0gIih1bmF2YWlsYWJsZSkiOwogICAgICAgICAgICB0aGlzLl9sYXN0UHJvZ3JhbSA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3NwRGV2aWNlVHJhbnNmb3JtVGV4dHVyZUZpbGwgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9kZXB0aEJ1ZmZlciA9IG51bGw7CiAgICAgICAgICAgIGZvciAoY29uc3Qgc3RhdGVHcm91cCBvZiB0aGlzLl9zdGF0ZUdyb3Vwcy52YWx1ZXMoKSkgc3RhdGVHcm91cC5PbkNvbnRleHRMb3N0KCkKICAgICAgICB9CiAgICAgICAgYXN5bmMgT25Db250ZXh0UmVzdG9yZWQoKSB7CiAgICAgICAgICAgIHRoaXMuX2lzSW5pdGlhbGlzaW5nQWZ0ZXJDb250ZXh0UmVzdG9yZWQgPQogICAgICAgICAgICAgICAgdHJ1ZTsKICAgICAgICAgICAgYXdhaXQgdGhpcy5Jbml0U3RhdGUoKTsKICAgICAgICAgICAgdGhpcy5faXNJbml0aWFsaXNpbmdBZnRlckNvbnRleHRSZXN0b3JlZCA9IGZhbHNlOwogICAgICAgICAgICBmb3IgKGNvbnN0IHN0YXRlR3JvdXAgb2YgdGhpcy5fc3RhdGVHcm91cHMudmFsdWVzKCkpIHN0YXRlR3JvdXAuT25Db250ZXh0UmVzdG9yZWQodGhpcyk7CiAgICAgICAgICAgIHRoaXMuU2V0U2l6ZSh0aGlzLl93aWR0aCwgdGhpcy5faGVpZ2h0LCB0cnVlKQogICAgICAgIH0KICAgICAgICBDcmVhdGVTdGF0aWNUZXh0dXJlKGRhdGEsIG9wdHMpIHsKICAgICAgICAgICAgaWYgKHRoaXMuSXNDb250ZXh0TG9zdCgpKSB0aHJvdyBuZXcgRXJyb3IoImNvbnRleHQgbG9zdCIpOwogICAgICAgICAgICB0aGlzLkVuZEJhdGNoKCk7CiAgICAgICAgICAgIGNvbnN0IHJlbmRlcmVyVGV4ID0gQzMuTmV3KEMzLkdmeC5XZWJHTFJlbmRlcmVyVGV4dHVyZSwgdGhpcyk7CiAgICAgICAgICAgIHJlbmRlcmVyVGV4Ll9DcmVhdGVTdGF0aWMoZGF0YSwgb3B0cyk7CiAgICAgICAgICAgIHJldHVybiByZW5kZXJlclRleAogICAgICAgIH0KICAgICAgICBhc3luYyBDcmVhdGVTdGF0aWNUZXh0dXJlQXN5bmMoZGF0YSwgb3B0cykgewogICAgICAgICAgICBpZiAodGhpcy5Jc0NvbnRleHRMb3N0KCkpIHRocm93IG5ldyBFcnJvcigiY29udGV4dCBsb3N0Iik7CiAgICAgICAgICAgIG9wdHMgPSBPYmplY3QuYXNzaWduKHt9LCBvcHRzKTsKICAgICAgICAgICAgaWYgKEMzLlN1cHBvcnRzLkltYWdlQml0bWFwT3B0aW9ucyAmJiAoQzMuUGxhdGZvcm0uQnJvd3NlciAhPT0gIlNhZmFyaSIgfHwgIShkYXRhIGluc3RhbmNlb2YgSW1hZ2VEYXRhKSB8fCB0eXBlb2YgSW1hZ2UgPT09ICJ1bmRlZmluZWQiKSkgewogICAgICAgICAgICAgICAgbGV0IGltYWdlQml0bWFwID0gYXdhaXQgY3JlYXRlSW1hZ2VCaXRtYXAoZGF0YSwgewogICAgICAgICAgICAgICAgICAgICJwcmVtdWx0aXBseUFscGhhIjogInByZW11bHRpcGx5IgogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBjb25zdCBpc1RpbGVkID0gb3B0cy53cmFwWCAmJiBvcHRzLndyYXBYICE9PSAiY2xhbXAtdG8tZWRnZSIgfHwgb3B0cy53cmFwWSAmJiBvcHRzLndyYXBZICE9PSAiY2xhbXAtdG8tZWRnZSI7CiAgICAgICAgICAgICAgICBjb25zdCBpc1BPVCA9IEMzLmlzUE9UKGltYWdlQml0bWFwLndpZHRoKSAmJiBDMy5pc1BPVChpbWFnZUJpdG1hcC5oZWlnaHQpOwogICAgICAgICAgICAgICAgaWYgKCF0aGlzLlN1cHBvcnRzTlBPVFRleHR1cmVzKCkgJiYgIWlzUE9UICYmIGlzVGlsZWQpCiAgICAgICAgICAgICAgICAgICAgaWYgKEMzLlN1cHBvcnRzLkltYWdlQml0bWFwT3B0aW9uc1Jlc2l6ZSkgewogICAgICAgICAgICAgICAgICAgICAgICBpbWFnZUJpdG1hcCA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBjcmVhdGVJbWFnZUJpdG1hcChkYXRhLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInByZW11bHRpcGx5QWxwaGEiOiAicHJlbXVsdGlwbHkiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJyZXNpemVXaWR0aCI6IEMzLm5leHRIaWdoZXN0UG93ZXJPZlR3byhpbWFnZUJpdG1hcC53aWR0aCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInJlc2l6ZUhlaWdodCI6IEMzLm5leHRIaWdoZXN0UG93ZXJPZlR3byhpbWFnZUJpdG1hcC5oZWlnaHQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgb3B0cy5wcmVtdWx0aXBseUFscGhhID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaW1hZ2VCaXRtYXAgPSBhd2FpdCBjcmVhdGVJbWFnZUJpdG1hcChkYXRhLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICJwcmVtdWx0aXBseUFscGhhIjogIm5vbmUiCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBlbHNlIG9wdHMucHJlbXVsdGlwbHlBbHBoYSA9IGZhbHNlOwogICAgICAgICAgICAgICAgcmV0dXJuIGF3YWl0IEMzLkFzeW5jaWZ5KCgpID0+IHRoaXMuQ3JlYXRlU3RhdGljVGV4dHVyZShpbWFnZUJpdG1hcCwgb3B0cykpCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAoZGF0YSBpbnN0YW5jZW9mIEJsb2IpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIEltYWdlID09PSAidW5kZWZpbmVkIikgdGhyb3cgbmV3IEVycm9yKCJ0ZXh0dXJlIHVwbG9hZCB2YXJpYW50IG5vdCBzdXBwb3J0ZWQgaW4gd29ya2VyIik7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgaW1nID0gYXdhaXQgQzMuQmxvYlRvSW1hZ2UoZGF0YSk7CiAgICAgICAgICAgICAgICAgICAgZGF0YSA9IGltZwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIGF3YWl0IEMzLkFzeW5jaWZ5KCgpID0+IHRoaXMuQ3JlYXRlU3RhdGljVGV4dHVyZShkYXRhLCBvcHRzKSkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBDcmVhdGVEeW5hbWljVGV4dHVyZSh3aWR0aCwgaGVpZ2h0LCBvcHRzKSB7CiAgICAgICAgICAgIHRoaXMuRW5kQmF0Y2goKTsKICAgICAgICAgICAgY29uc3QgcmVuZGVyZXJUZXggPSBDMy5OZXcoQzMuR2Z4LldlYkdMUmVuZGVyZXJUZXh0dXJlLCB0aGlzKTsKICAgICAgICAgICAgcmVuZGVyZXJUZXguX0NyZWF0ZUR5bmFtaWMod2lkdGgsIGhlaWdodCwgb3B0cyk7CiAgICAgICAgICAgIHJldHVybiByZW5kZXJlclRleAogICAgICAgIH0KICAgICAgICBVcGRhdGVUZXh0dXJlKGRhdGEsIHJlbmRlcmVyVGV4LCBvcHRzKSB7CiAgICAgICAgICAgIHRoaXMuRW5kQmF0Y2goKTsKICAgICAgICAgICAgcmVuZGVyZXJUZXguX1VwZGF0ZShkYXRhLCBvcHRzKQogICAgICAgIH0KICAgICAgICBEZWxldGVUZXh0dXJlKHJlbmRlcmVyVGV4KSB7CiAgICAgICAgICAgIGlmICghcmVuZGVyZXJUZXgpIHJldHVybjsKICAgICAgICAgICAgcmVuZGVyZXJUZXguU3VidHJhY3RSZWZlcmVuY2UoKTsKICAgICAgICAgICAgaWYgKHJlbmRlcmVyVGV4LkdldFJlZmVyZW5jZUNvdW50KCkgPiAwKSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuRW5kQmF0Y2goKTsKICAgICAgICAgICAgaWYgKHJlbmRlcmVyVGV4ID09PSB0aGlzLl9sYXN0VGV4dHVyZTApIHsKICAgICAgICAgICAgICAgIHRoaXMuX2dsLmJpbmRUZXh0dXJlKHRoaXMuX2dsLlRFWFRVUkVfMkQsIG51bGwpOwogICAgICAgICAgICAgICAgdGhpcy5fbGFzdFRleHR1cmUwID0gbnVsbAogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChyZW5kZXJlclRleCA9PT0gdGhpcy5fbGFzdFRleHR1cmUxKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9nbC5hY3RpdmVUZXh0dXJlKHRoaXMuX2dsLlRFWFRVUkUxKTsKICAgICAgICAgICAgICAgIHRoaXMuX2dsLmJpbmRUZXh0dXJlKHRoaXMuX2dsLlRFWFRVUkVfMkQsIG51bGwpOwogICAgICAgICAgICAgICAgdGhpcy5fZ2wuYWN0aXZlVGV4dHVyZSh0aGlzLl9nbC5URVhUVVJFMCk7CiAgICAgICAgICAgICAgICB0aGlzLl9sYXN0VGV4dHVyZTEgPSBudWxsCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmVuZGVyZXJUZXguX0RlbGV0ZSgpCiAgICAgICAgfQogICAgICAgIENyZWF0ZVJlbmRlclRhcmdldChvcHRzKSB7CiAgICAgICAgICAgIGxldCB3aWR0aCA9IHRoaXMuX3dpZHRoOwogICAgICAgICAgICBsZXQgaGVpZ2h0ID0gdGhpcy5faGVpZ2h0OwogICAgICAgICAgICBsZXQgaXNEZWZhdWx0U2l6ZSA9IHRydWU7CiAgICAgICAgICAgIGlmIChvcHRzKSB7CiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIG9wdHMud2lkdGggPT09ICJudW1iZXIiKSB7CiAgICAgICAgICAgICAgICAgICAgd2lkdGggPSBvcHRzLndpZHRoOwogICAgICAgICAgICAgICAgICAgIGlzRGVmYXVsdFNpemUgPQogICAgICAgICAgICAgICAgICAgICAgICBmYWxzZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBvcHRzLmhlaWdodCA9PT0gIm51bWJlciIpIHsKICAgICAgICAgICAgICAgICAgICBoZWlnaHQgPSBvcHRzLmhlaWdodDsKICAgICAgICAgICAgICAgICAgICBpc0RlZmF1bHRTaXplID0gZmFsc2UKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAod2lkdGggPD0gMCB8fCBoZWlnaHQgPD0gMCkgdGhyb3cgbmV3IEVycm9yKCJpbnZhbGlkIHNpemUiKTsKICAgICAgICAgICAgdGhpcy5FbmRCYXRjaCgpOwogICAgICAgICAgICBjb25zdCByZW5kZXJUYXJnZXQgPSBDMy5OZXcoQzMuR2Z4LldlYkdMUmVuZGVyVGFyZ2V0LCB0aGlzKTsKICAgICAgICAgICAgcmVuZGVyVGFyZ2V0Ll9DcmVhdGUod2lkdGgsIGhlaWdodCwgT2JqZWN0LmFzc2lnbih7CiAgICAgICAgICAgICAgICBpc0RlZmF1bHRTaXplCiAgICAgICAgICAgIH0sIG9wdHMpKTsKICAgICAgICAgICAgdGhpcy5fY3VycmVudFJlbmRlclRhcmdldCA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX2JhdGNoU3RhdGUuY3VycmVudEZyYW1lYnVmZmVyID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fYmF0Y2hTdGF0ZS5jdXJyZW50RnJhbWVidWZmZXJOb0RlcHRoID0gbnVsbDsKICAgICAgICAgICAgcmV0dXJuIHJlbmRlclRhcmdldAogICAgICAgIH0KICAgICAgICBTZXRSZW5kZXJUYXJnZXQocmVuZGVyVGFyZ2V0LCB1cGRhdGVQcm9qZWN0aW9uID0gdHJ1ZSkgewogICAgICAgICAgICBpZiAocmVuZGVyVGFyZ2V0ID09PSB0aGlzLl9jdXJyZW50UmVuZGVyVGFyZ2V0KSByZXR1cm47CiAgICAgICAgICAgIGlmIChyZW5kZXJUYXJnZXQgJiYgcmVuZGVyVGFyZ2V0LklzRGVmYXVsdFNpemUoKSkgcmVuZGVyVGFyZ2V0Ll9SZXNpemUodGhpcy5fd2lkdGgsIHRoaXMuX2hlaWdodCk7CiAgICAgICAgICAgIGNvbnN0IGIgPSB0aGlzLlB1c2hCYXRjaCgpOwogICAgICAgICAgICBiLkluaXRTZXRSZW5kZXJUYXJnZXQocmVuZGVyVGFyZ2V0KTsKICAgICAgICAgICAgdGhpcy5fY3VycmVudFJlbmRlclRhcmdldCA9IHJlbmRlclRhcmdldDsKICAgICAgICAgICAgdGhpcy5fdG9wT2ZCYXRjaCA9IDA7CiAgICAgICAgICAgIGlmICh1cGRhdGVQcm9qZWN0aW9uKSB0aGlzLlNldERlZmF1bHRSZW5kZXJUYXJnZXRQcm9qZWN0aW9uU3RhdGUoKQogICAgICAgIH0KICAgICAgICBHZXRSZW5kZXJUYXJnZXQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9jdXJyZW50UmVuZGVyVGFyZ2V0CiAgICAgICAgfQogICAgICAgIEdldFJlbmRlclRhcmdldFNpemUocmVuZGVyVGFyZ2V0KSB7CiAgICAgICAgICAgIGlmIChyZW5kZXJUYXJnZXQpIHJldHVybiBbcmVuZGVyVGFyZ2V0LkdldFdpZHRoKCksIHJlbmRlclRhcmdldC5HZXRIZWlnaHQoKV07CiAgICAgICAgICAgIGVsc2UgcmV0dXJuIFt0aGlzLl93aWR0aCwgdGhpcy5faGVpZ2h0XQogICAgICAgIH0KICAgICAgICBDb3B5UmVuZGVyVGFyZ2V0KHJlbmRlclRhcmdldCwKICAgICAgICAgICAgbW9kZSA9ICJzdHJldGNoIikgewogICAgICAgICAgICBpZiAodGhpcy5fdmVyc2lvbiA8IDIgfHwgdGhpcy5fY3VycmVudFJlbmRlclRhcmdldCAmJiB0aGlzLl9jdXJyZW50UmVuZGVyVGFyZ2V0LkdldE11bHRpc2FtcGxpbmcoKSA+IDApIHsKICAgICAgICAgICAgICAgIHRoaXMuU2V0Q29weUJsZW5kKCk7CiAgICAgICAgICAgICAgICB0aGlzLlJlc2V0Q29sb3IoKTsKICAgICAgICAgICAgICAgIHRoaXMuRHJhd1JlbmRlclRhcmdldChyZW5kZXJUYXJnZXQsIG1vZGUpCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjb25zdCBiID0gdGhpcy5QdXNoQmF0Y2goKTsKICAgICAgICAgICAgICAgIGIuSW5pdEJsaXRGcmFtZWJ1ZmZlcihyZW5kZXJUYXJnZXQsIHRoaXMuX2N1cnJlbnRSZW5kZXJUYXJnZXQsIG1vZGUpOwogICAgICAgICAgICAgICAgdGhpcy5fdG9wT2ZCYXRjaCA9IDAKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBEcmF3UmVuZGVyVGFyZ2V0KHJlbmRlclRhcmdldCwgbW9kZSA9ICJzdHJldGNoIikgewogICAgICAgICAgICBjb25zdCB0ZXggPSByZW5kZXJUYXJnZXQuR2V0VGV4dHVyZSgpOwogICAgICAgICAgICBpZiAoIXRleCkgdGhyb3cgbmV3IEVycm9yKCJub3QgYSB0ZXh0dXJlLWJhY2tlZCByZW5kZXIgdGFyZ2V0Iik7CiAgICAgICAgICAgIHRoaXMuU2V0VGV4dHVyZSh0ZXgpOwogICAgICAgICAgICB0aGlzLkZ1bGxzY3JlZW5RdWFkKG1vZGUsIHRleCkKICAgICAgICB9CiAgICAgICAgSW52YWxpZGF0ZVJlbmRlclRhcmdldChyZW5kZXJUYXJnZXQpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX3ZlcnNpb24gPAogICAgICAgICAgICAgICAgMikgcmV0dXJuOwogICAgICAgICAgICBjb25zdCBiID0gdGhpcy5QdXNoQmF0Y2goKTsKICAgICAgICAgICAgYi5Jbml0SW52YWxpZGF0ZUZyYW1lYnVmZmVyKHJlbmRlclRhcmdldC5fR2V0RnJhbWVidWZmZXIoKSk7CiAgICAgICAgICAgIHRoaXMuX3RvcE9mQmF0Y2ggPSAwCiAgICAgICAgfQogICAgICAgIERlbGV0ZVJlbmRlclRhcmdldChyZW5kZXJUYXJnZXQpIHsKICAgICAgICAgICAgdGhpcy5TZXRSZW5kZXJUYXJnZXQobnVsbCk7CiAgICAgICAgICAgIHRoaXMuRW5kQmF0Y2goKTsKICAgICAgICAgICAgY29uc3QgcmVuZGVyVGV4ID0gcmVuZGVyVGFyZ2V0LkdldFRleHR1cmUoKTsKICAgICAgICAgICAgaWYgKHJlbmRlclRleCA9PT0gdGhpcy5fbGFzdFRleHR1cmUwKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9nbC5iaW5kVGV4dHVyZSh0aGlzLl9nbC5URVhUVVJFXzJELCBudWxsKTsKICAgICAgICAgICAgICAgIHRoaXMuX2xhc3RUZXh0dXJlMCA9IG51bGwKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAocmVuZGVyVGV4ID09PSB0aGlzLl9sYXN0VGV4dHVyZTEpIHsKICAgICAgICAgICAgICAgIHRoaXMuX2dsLmFjdGl2ZVRleHR1cmUodGhpcy5fZ2wuVEVYVFVSRTEpOwogICAgICAgICAgICAgICAgdGhpcy5fZ2wuYmluZFRleHR1cmUodGhpcy5fZ2wuVEVYVFVSRV8yRCwgbnVsbCk7CiAgICAgICAgICAgICAgICB0aGlzLl9nbC5hY3RpdmVUZXh0dXJlKHRoaXMuX2dsLlRFWFRVUkUwKTsKICAgICAgICAgICAgICAgIHRoaXMuX2xhc3RUZXh0dXJlMSA9IG51bGwKICAgICAgICAgICAgfQogICAgICAgICAgICByZW5kZXJUYXJnZXQuX0RlbGV0ZSgpCiAgICAgICAgfQogICAgICAgIGFzeW5jIFJlYWRCYWNrUmVuZGVyVGFyZ2V0VG9JbWFnZURhdGEocmVuZGVyVGFyZ2V0LCBmb3JjZVN5bmNocm9ub3VzLCBhcmVhUmVjdCkgewogICAgICAgICAgICB0aGlzLkVuZEJhdGNoKCk7CiAgICAgICAgICAgIGNvbnN0IG9sZFJlbmRlclRhcmdldCA9IHRoaXMuX2N1cnJlbnRSZW5kZXJUYXJnZXQ7CiAgICAgICAgICAgIGxldCB3aWR0aCwgaGVpZ2h0LCBmcmFtZWJ1ZmZlcjsKICAgICAgICAgICAgaWYgKHJlbmRlclRhcmdldCkgewogICAgICAgICAgICAgICAgd2lkdGggPSByZW5kZXJUYXJnZXQuR2V0V2lkdGgoKTsKICAgICAgICAgICAgICAgIGhlaWdodCA9IHJlbmRlclRhcmdldC5HZXRIZWlnaHQoKTsKICAgICAgICAgICAgICAgIGZyYW1lYnVmZmVyID0gcmVuZGVyVGFyZ2V0Ll9HZXRGcmFtZWJ1ZmZlcigpCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB3aWR0aCA9IHRoaXMuR2V0V2lkdGgoKTsKICAgICAgICAgICAgICAgIGhlaWdodCA9IHRoaXMuR2V0SGVpZ2h0KCk7CiAgICAgICAgICAgICAgICBmcmFtZWJ1ZmZlciA9IG51bGwKICAgICAgICAgICAgfQogICAgICAgICAgICBsZXQgeCA9IDA7CiAgICAgICAgICAgIGxldCB5ID0gMDsKICAgICAgICAgICAgbGV0IGFyZWFXaWR0aCA9IHdpZHRoOwogICAgICAgICAgICBsZXQgYXJlYUhlaWdodCA9IGhlaWdodDsKICAgICAgICAgICAgaWYgKGFyZWFSZWN0KSB7CiAgICAgICAgICAgICAgICB4ID0gQzMuY2xhbXAoTWF0aC5mbG9vcihhcmVhUmVjdC5nZXRMZWZ0KCkpLAogICAgICAgICAgICAgICAgICAgIDAsIHdpZHRoIC0gMSk7CiAgICAgICAgICAgICAgICB5ID0gQzMuY2xhbXAoTWF0aC5mbG9vcihhcmVhUmVjdC5nZXRUb3AoKSksIDAsIGhlaWdodCAtIDEpOwogICAgICAgICAgICAgICAgbGV0IHcgPSBhcmVhUmVjdC53aWR0aCgpOwogICAgICAgICAgICAgICAgaWYgKHcgPT09IDApIHcgPSB3aWR0aCAtIHg7CiAgICAgICAgICAgICAgICBlbHNlIHcgPSBDMy5jbGFtcChNYXRoLmZsb29yKHcpLCAwLCB3aWR0aCAtIHgpOwogICAgICAgICAgICAgICAgbGV0IGggPSBhcmVhUmVjdC5oZWlnaHQoKTsKICAgICAgICAgICAgICAgIGlmIChoID09PSAwKSBoID0gaGVpZ2h0IC0geTsKICAgICAgICAgICAgICAgIGVsc2UgaCA9IEMzLmNsYW1wKE1hdGguZmxvb3IoaCksIDAsIGhlaWdodCAtIHkpOwogICAgICAgICAgICAgICAgYXJlYVdpZHRoID0gdzsKICAgICAgICAgICAgICAgIGFyZWFIZWlnaHQgPSBoOwogICAgICAgICAgICAgICAgeSA9IGhlaWdodCAtICh5ICsgYXJlYUhlaWdodCkKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBnbCA9IHRoaXMuX2dsOwogICAgICAgICAgICBnbC5iaW5kRnJhbWVidWZmZXIoZ2wuRlJBTUVCVUZGRVIsIGZyYW1lYnVmZmVyKTsKICAgICAgICAgICAgY29uc3QgcmVzdG9yZVByZXZpb3VzUmVuZGVyVGFyZ2V0ID0gKCkgPT4gewogICAgICAgICAgICAgICAgZ2wuYmluZEZyYW1lYnVmZmVyKGdsLkZSQU1FQlVGRkVSLCBudWxsKTsKICAgICAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRSZW5kZXJUYXJnZXQgPSBudWxsOwogICAgICAgICAgICAgICAgdGhpcy5fYmF0Y2hTdGF0ZS5jdXJyZW50RnJhbWVidWZmZXIgPSBudWxsOwogICAgICAgICAgICAgICAgdGhpcy5fYmF0Y2hTdGF0ZS5jdXJyZW50RnJhbWVidWZmZXJOb0RlcHRoID0KICAgICAgICAgICAgICAgICAgICBudWxsOwogICAgICAgICAgICAgICAgdGhpcy5TZXRSZW5kZXJUYXJnZXQob2xkUmVuZGVyVGFyZ2V0KQogICAgICAgICAgICB9OwogICAgICAgICAgICBsZXQgaW1hZ2VEYXRhOwogICAgICAgICAgICBpZiAoIWZvcmNlU3luY2hyb25vdXMgJiYgdGhpcy5HZXRXZWJHTFZlcnNpb25OdW1iZXIoKSA+PSAyKSB7CiAgICAgICAgICAgICAgICBnbC5iaW5kRnJhbWVidWZmZXIoZ2wuUkVBRF9GUkFNRUJVRkZFUiwgZnJhbWVidWZmZXIpOwogICAgICAgICAgICAgICAgY29uc3QgcGl4ZWxCdWZmZXIgPSBnbC5jcmVhdGVCdWZmZXIoKTsKICAgICAgICAgICAgICAgIGNvbnN0IGJ1ZmZlclNpemUgPSBhcmVhV2lkdGggKiBhcmVhSGVpZ2h0ICogNDsKICAgICAgICAgICAgICAgIGNvbnN0IFBJWEVMX1BBQ0tfQlVGRkVSID0gZ2xbIlBJWEVMX1BBQ0tfQlVGRkVSIl07CiAgICAgICAgICAgICAgICBnbC5iaW5kQnVmZmVyKFBJWEVMX1BBQ0tfQlVGRkVSLCBwaXhlbEJ1ZmZlcik7CiAgICAgICAgICAgICAgICBnbC5idWZmZXJEYXRhKFBJWEVMX1BBQ0tfQlVGRkVSLCBidWZmZXJTaXplLCBnbFsiU1RSRUFNX1JFQUQiXSk7CiAgICAgICAgICAgICAgICBnbC5yZWFkUGl4ZWxzKHgsIHksIGFyZWFXaWR0aCwgYXJlYUhlaWdodCwgZ2wuUkdCQSwgZ2wuVU5TSUdORURfQllURSwgMCk7CiAgICAgICAgICAgICAgICBnbC5iaW5kRnJhbWVidWZmZXIoZ2wuUkVBRF9GUkFNRUJVRkZFUiwKICAgICAgICAgICAgICAgICAgICBudWxsKTsKICAgICAgICAgICAgICAgIGdsLmJpbmRCdWZmZXIoUElYRUxfUEFDS19CVUZGRVIsIG51bGwpOwogICAgICAgICAgICAgICAgcmVzdG9yZVByZXZpb3VzUmVuZGVyVGFyZ2V0KCk7CiAgICAgICAgICAgICAgICBjb25zdCBzeW5jID0gZ2xbImZlbmNlU3luYyJdKGdsWyJTWU5DX0dQVV9DT01NQU5EU19DT01QTEVURSJdLCAwKTsKICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuX1dhaXRGb3JPYmplY3RSZWFkeSgoKSA9PiBnbFsiZ2V0U3luY1BhcmFtZXRlciJdKHN5bmMsIGdsWyJTWU5DX1NUQVRVUyJdKSA9PT0gZ2xbIlNJR05BTEVEIl0pOwogICAgICAgICAgICAgICAgZ2xbImRlbGV0ZVN5bmMiXShzeW5jKTsKICAgICAgICAgICAgICAgIGltYWdlRGF0YSA9IG5ldyBJbWFnZURhdGEoYXJlYVdpZHRoLCBhcmVhSGVpZ2h0KTsKICAgICAgICAgICAgICAgIGdsLmJpbmRCdWZmZXIoUElYRUxfUEFDS19CVUZGRVIsIHBpeGVsQnVmZmVyKTsKICAgICAgICAgICAgICAgIGdsWyJnZXRCdWZmZXJTdWJEYXRhIl0oUElYRUxfUEFDS19CVUZGRVIsIDAsIG5ldyBVaW50OEFycmF5KGltYWdlRGF0YS5kYXRhLmJ1ZmZlciksIDAsIGJ1ZmZlclNpemUpOwogICAgICAgICAgICAgICAgZ2wuYmluZEJ1ZmZlcihQSVhFTF9QQUNLX0JVRkZFUiwgbnVsbCk7CiAgICAgICAgICAgICAgICBnbC5kZWxldGVCdWZmZXIocGl4ZWxCdWZmZXIpCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpbWFnZURhdGEgPQogICAgICAgICAgICAgICAgICAgIG5ldyBJbWFnZURhdGEoYXJlYVdpZHRoLCBhcmVhSGVpZ2h0KTsKICAgICAgICAgICAgICAgIGdsLnJlYWRQaXhlbHMoeCwgeSwgYXJlYVdpZHRoLCBhcmVhSGVpZ2h0LCBnbC5SR0JBLCBnbC5VTlNJR05FRF9CWVRFLCBuZXcgVWludDhBcnJheShpbWFnZURhdGEuZGF0YS5idWZmZXIpKTsKICAgICAgICAgICAgICAgIHJlc3RvcmVQcmV2aW91c1JlbmRlclRhcmdldCgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGltYWdlRGF0YQogICAgICAgIH0KICAgICAgICBDb3BsYW5hclN0YXJ0U3RlbmNpbFBhc3MoKSB7CiAgICAgICAgICAgIHRoaXMuU2V0RGVwdGhFbmFibGVkKHRydWUpOwogICAgICAgICAgICBjb25zdCBiYXRjaCA9IHRoaXMuUHVzaEJhdGNoKCk7CiAgICAgICAgICAgIGJhdGNoLkluaXRDb3BsYW5hclN0YXJ0U3RlbmNpbFBhc3MoKTsKICAgICAgICAgICAgdGhpcy5fdG9wT2ZCYXRjaCA9IDAKICAgICAgICB9CiAgICAgICAgQ29wbGFuYXJTdGFydENvbG9yUGFzcygpIHsKICAgICAgICAgICAgdGhpcy5TZXREZXB0aEVuYWJsZWQoZmFsc2UpOwogICAgICAgICAgICBjb25zdCBiYXRjaCA9IHRoaXMuUHVzaEJhdGNoKCk7CiAgICAgICAgICAgIGJhdGNoLkluaXRDb3BsYW5hclN0YXJ0Q29sb3JQYXNzKCk7CiAgICAgICAgICAgIHRoaXMuX3RvcE9mQmF0Y2ggPSAwCiAgICAgICAgfQogICAgICAgIENvcGxhbmFyUmVzdG9yZVN0YW5kYXJkUmVuZGVyaW5nKCkgewogICAgICAgICAgICB0aGlzLlNldERlcHRoRW5hYmxlZCh0cnVlKTsKICAgICAgICAgICAgY29uc3QgYmF0Y2ggPSB0aGlzLlB1c2hCYXRjaCgpOwogICAgICAgICAgICBiYXRjaC5Jbml0Q29wbGFuYXJSZXN0b3JlKCk7CiAgICAgICAgICAgIHRoaXMuX3RvcE9mQmF0Y2ggPSAwCiAgICAgICAgfQogICAgICAgIFN0YXJ0UXVlcnkocXVlcnkpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLlN1cHBvcnRzR1BVUHJvZmlsaW5nKCkpIHJldHVybjsKICAgICAgICAgICAgY29uc3QgYiA9IHRoaXMuUHVzaEJhdGNoKCk7CiAgICAgICAgICAgIGIuSW5pdFN0YXJ0UXVlcnkocXVlcnkpOwogICAgICAgICAgICB0aGlzLl90b3BPZkJhdGNoID0gMAogICAgICAgIH0KICAgICAgICBFbmRRdWVyeShxdWVyeSkgewogICAgICAgICAgICBpZiAoIXRoaXMuU3VwcG9ydHNHUFVQcm9maWxpbmcoKSkgcmV0dXJuOwogICAgICAgICAgICBjb25zdCBiID0gdGhpcy5QdXNoQmF0Y2goKTsKICAgICAgICAgICAgYi5Jbml0RW5kUXVlcnkocXVlcnkpOwogICAgICAgICAgICB0aGlzLl90b3BPZkJhdGNoID0gMAogICAgICAgIH0KICAgICAgICBfV2FpdEZvck9iamVjdFJlYWR5KGNoZWNrRnVuYykgewogICAgICAgICAgICBjb25zdCByZXQgPSBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHBlbmRpbmdQb2xscy5hZGQoewogICAgICAgICAgICAgICAgcmVzb2x2ZSwKICAgICAgICAgICAgICAgIGNoZWNrRnVuYwogICAgICAgICAgICB9KSk7CiAgICAgICAgICAgIGlmIChwb2xsUmFmSWQgPT09IC0xKSBwb2xsUmFmSWQgPSBzZWxmLnJlcXVlc3RBbmltYXRpb25GcmFtZShDaGVja1BlbmRpbmdQb2xscyk7CiAgICAgICAgICAgIHJldHVybiByZXQKICAgICAgICB9CiAgICAgICAgSXNEZXN5bmNocm9uaXplZCgpIHsKICAgICAgICAgICAgcmV0dXJuICEhdGhpcy5fYXR0cmlic1siZGVzeW5jaHJvbml6ZWQiXQogICAgICAgIH0KICAgICAgICBHZXRFc3RpbWF0ZWRCYWNrQnVmZmVyTWVtb3J5VXNhZ2UoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl93aWR0aCAqCiAgICAgICAgICAgICAgICB0aGlzLl9oZWlnaHQgKiAodGhpcy5fYXR0cmlic1siYWxwaGEiXSA/IDQgOiAzKQogICAgICAgIH0KICAgICAgICBHZXRFc3RpbWF0ZWRSZW5kZXJCdWZmZXJNZW1vcnlVc2FnZSgpIHsKICAgICAgICAgICAgbGV0IHJldCA9IDA7CiAgICAgICAgICAgIGZvciAoY29uc3QgdCBvZiBDMy5HZnguV2ViR0xSZW5kZXJUYXJnZXQuYWxsUmVuZGVyVGFyZ2V0cygpKSB7CiAgICAgICAgICAgICAgICBpZiAodC5HZXRUZXh0dXJlKCkpIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgcmV0ICs9IHQuR2V0RXN0aW1hdGVkTWVtb3J5VXNhZ2UoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiByZXQKICAgICAgICB9CiAgICAgICAgR2V0RXN0aW1hdGVkVGV4dHVyZU1lbW9yeVVzYWdlKCkgewogICAgICAgICAgICBsZXQgcmV0ID0gMDsKICAgICAgICAgICAgZm9yIChjb25zdCB0IG9mIEMzLkdmeC5XZWJHTFJlbmRlcmVyVGV4dHVyZS5hbGxUZXh0dXJlcygpKSByZXQgKz0gdC5HZXRFc3RpbWF0ZWRNZW1vcnlVc2FnZSgpOwogICAgICAgICAgICByZXR1cm4gcmV0CiAgICAgICAgfQogICAgICAgIEdldEVzdGltYXRlZFRvdGFsTWVtb3J5VXNhZ2UoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLkdldEVzdGltYXRlZEJhY2tCdWZmZXJNZW1vcnlVc2FnZSgpICsgdGhpcy5HZXRFc3RpbWF0ZWRSZW5kZXJCdWZmZXJNZW1vcnlVc2FnZSgpICsgdGhpcy5HZXRFc3RpbWF0ZWRUZXh0dXJlTWVtb3J5VXNhZ2UoKQogICAgICAgIH0KICAgICAgICBHZXRXZWJHTFZlcnNpb25TdHJpbmcoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl92ZXJzaW9uU3RyaW5nCiAgICAgICAgfQogICAgICAgIEdldFdlYkdMVmVyc2lvbk51bWJlcigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3ZlcnNpb24KICAgICAgICB9CiAgICAgICAgR2V0RGlzcGxheU5hbWUoKSB7CiAgICAgICAgICAgIHJldHVybiAid2ViZ2wiICsKICAgICAgICAgICAgICAgIHRoaXMuR2V0V2ViR0xWZXJzaW9uTnVtYmVyKCkKICAgICAgICB9CiAgICAgICAgU3VwcG9ydHNOUE9UVGV4dHVyZXMoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLkdldFdlYkdMVmVyc2lvbk51bWJlcigpID49IDIKICAgICAgICB9CiAgICAgICAgR2V0TWF4VGV4dHVyZVNpemUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9tYXhUZXh0dXJlU2l6ZQogICAgICAgIH0KICAgICAgICBHZXRNaW5Qb2ludFNpemUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9taW5Qb2ludFNpemUKICAgICAgICB9CiAgICAgICAgR2V0TWF4UG9pbnRTaXplKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fbWF4UG9pbnRTaXplCiAgICAgICAgfQogICAgICAgIFN1cHBvcnRzSGlnaFAoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9oaWdocFByZWNpc2lvbiAhPT0gMAogICAgICAgIH0KICAgICAgICBHZXRIaWdoUFByZWNpc2lvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2hpZ2hwUHJlY2lzaW9uCiAgICAgICAgfQogICAgICAgIEdldFVubWFza2VkVmVuZG9yKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fdW5tYXNrZWRWZW5kb3IKICAgICAgICB9CiAgICAgICAgR2V0VW5tYXNrZWRSZW5kZXJlcigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3VubWFza2VkUmVuZGVyZXIKICAgICAgICB9CiAgICAgICAgR2V0V2ViR0xFeHRlbnNpb25zQW5hbHl0aWNzU3RyaW5nKCkgewogICAgICAgICAgICBpZiAodGhpcy5HZXRXZWJHTFZlcnNpb25OdW1iZXIoKSA+PSAyKSByZXR1cm4gIndlYmdsMiI7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgY29uc3QgZXh0cyA9IFtdOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuX2ZyYWdEZXB0aEV4dCkgZXh0cy5wdXNoKCJFWFRfZnJhZ19kZXB0aCIpOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuX3N0ZERlcml2YXRpdmVzRXh0KSBleHRzLnB1c2goIk9FU19zdGFuZGFyZF9kZXJpdmF0aXZlcyIpOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuX3RleHR1cmVMb2RFeHQpIGV4dHMucHVzaCgiRVhUX3NoYWRlcl90ZXh0dXJlX2xvZCIpOwogICAgICAgICAgICAgICAgaWYgKGV4dHMubGVuZ3RoID4gMCkgcmV0dXJuICJ3ZWJnbDE6IiArIGV4dHMuam9pbigiLCIpOwogICAgICAgICAgICAgICAgZWxzZSByZXR1cm4gIndlYmdsMTpub25lIgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIEdldEV4dGVuc2lvbnMoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9leHRlbnNpb25zCiAgICAgICAgfQogICAgICAgIFN1cHBvcnRzR1BVUHJvZmlsaW5nKCkgewogICAgICAgICAgICByZXR1cm4gISF0aGlzLl90aW1lckV4dAogICAgICAgIH0KICAgICAgICBfR2V0RGlzam9pbnRUaW1lclF1ZXJ5RXh0ZW5zaW9uKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fdGltZXJFeHQKICAgICAgICB9CiAgICAgICAgX0dldFBhcmFsbGVsU2hhZGVyQ29tcGlsZUV4dGVuc2lvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3BhcmFsbGVsU2hhZGVyQ29tcGlsZUV4dAogICAgICAgIH0KICAgICAgICBfR2V0QW5pc290cm9waWNFeHRlbnNpb24oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9hbmlzb3Ryb3BpY0V4dAogICAgICAgIH0KICAgICAgICBfR2V0TWF4QW5pc290cm9weSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX21heEFuaXNvdHJvcHkKICAgICAgICB9CiAgICAgICAgX0FkZFF1ZXJ5UmVzdWx0QnVmZmVyKHFyYikgewogICAgICAgICAgICB0aGlzLl9hbGxRdWVyeVJlc3VsdEJ1ZmZlcnMuYWRkKHFyYikKICAgICAgICB9CiAgICAgICAgX1JlbW92ZVF1ZXJ5UmVzdWx0QnVmZmVyKHFyYikgewogICAgICAgICAgICB0aGlzLl9hbGxRdWVyeVJlc3VsdEJ1ZmZlcnMuZGVsZXRlKHFyYikKICAgICAgICB9CiAgICAgICAgX0dldFRpbWVRdWVyeVN0YWNrKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fdGltZVF1ZXJ5U3RhY2sKICAgICAgICB9CiAgICAgICAgR2V0Q29udGV4dCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2dsCiAgICAgICAgfQogICAgICAgIF9Jbml0QmxlbmRNb2RlcyhnbCkgewogICAgICAgICAgICB0aGlzLl9Jbml0QmxlbmRNb2RlRGF0YShbCiAgICAgICAgICAgICAgICBbIm5vcm1hbCIsCiAgICAgICAgICAgICAgICAgICAgZ2wuT05FLCBnbC5PTkVfTUlOVVNfU1JDX0FMUEhBCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgWyJhZGRpdGl2ZSIsIGdsLk9ORSwgZ2wuT05FXSwKICAgICAgICAgICAgICAgIFsieG9yIiwgZ2wuT05FLCBnbC5PTkVfTUlOVVNfU1JDX0FMUEhBXSwKICAgICAgICAgICAgICAgIFsiY29weSIsIGdsLk9ORSwgZ2wuWkVST10sCiAgICAgICAgICAgICAgICBbImRlc3RpbmF0aW9uLW92ZXIiLCBnbC5PTkVfTUlOVVNfRFNUX0FMUEhBLCBnbC5PTkVdLAogICAgICAgICAgICAgICAgWyJzb3VyY2UtaW4iLCBnbC5EU1RfQUxQSEEsIGdsLlpFUk9dLAogICAgICAgICAgICAgICAgWyJkZXN0aW5hdGlvbi1pbiIsIGdsLlpFUk8sIGdsLlNSQ19BTFBIQV0sCiAgICAgICAgICAgICAgICBbInNvdXJjZS1vdXQiLCBnbC5PTkVfTUlOVVNfRFNUX0FMUEhBLCBnbC5aRVJPXSwKICAgICAgICAgICAgICAgIFsiZGVzdGluYXRpb24tb3V0IiwgZ2wuWkVSTywgZ2wuT05FX01JTlVTX1NSQ19BTFBIQV0sCiAgICAgICAgICAgICAgICBbInNvdXJjZS1hdG9wIiwgZ2wuRFNUX0FMUEhBLCBnbC5PTkVfTUlOVVNfU1JDX0FMUEhBXSwKICAgICAgICAgICAgICAgIFsiZGVzdGluYXRpb24tYXRvcCIsIGdsLk9ORV9NSU5VU19EU1RfQUxQSEEsIGdsLlNSQ19BTFBIQV0KICAgICAgICAgICAgXSkKICAgICAgICB9CiAgICAgICAgQ3JlYXRlUmVuZGVyZXJUZXh0KCkgewogICAgICAgICAgICByZXR1cm4gQzMuTmV3KEMzLkdmeC5SZW5kZXJlclRleHQsCiAgICAgICAgICAgICAgICB0aGlzKQogICAgICAgIH0KICAgICAgICBDcmVhdGVXZWJHTFRleHQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLkNyZWF0ZVJlbmRlcmVyVGV4dCgpCiAgICAgICAgfQogICAgfTsKCn0KCi8vIC4uL2xpYi9nZngvZWZmZWN0Q29tcG9zaXRvci9lZmZlY3RDaGFpbk1hbmFnZXIuanMKewogICAgJ3VzZSBzdHJpY3QnOwogICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgY29uc3QgREVGQVVMVF9DVE9SX09QVFMgPSB7CiAgICAgICAgZ2V0RHJhd1NpemU6IG51bGwsCiAgICAgICAgZ2V0UmVuZGVyVGFyZ2V0OiBudWxsLAogICAgICAgIHJlbGVhc2VSZW5kZXJUYXJnZXQ6IG51bGwsCiAgICAgICAgZ2V0VGltZTogbnVsbCwKICAgICAgICByZWRyYXc6IG51bGwKICAgIH07CiAgICBDMy5HZnguRWZmZWN0Q2hhaW5NYW5hZ2VyID0gY2xhc3MgRWZmZWN0Q2hhaW5NYW5hZ2VyIHsKICAgICAgICBjb25zdHJ1Y3RvcihvcHRzKSB7CiAgICAgICAgICAgIG9wdHMgPSBPYmplY3QuYXNzaWduKHt9LCBERUZBVUxUX0NUT1JfT1BUUywgb3B0cyk7CiAgICAgICAgICAgIHRoaXMuX2NiR2V0RHJhd1NpemUgPSBvcHRzLmdldERyYXdTaXplOwogICAgICAgICAgICB0aGlzLl9jYkdldFJlbmRlclRhcmdldCA9IG9wdHMuZ2V0UmVuZGVyVGFyZ2V0OwogICAgICAgICAgICB0aGlzLl9jYlJlbGVhc2VSZW5kZXJUYXJnZXQgPSBvcHRzLnJlbGVhc2VSZW5kZXJUYXJnZXQ7CiAgICAgICAgICAgIHRoaXMuX2NiR2V0VGltZSA9IG9wdHMuZ2V0VGltZTsKICAgICAgICAgICAgdGhpcy5fY2JSZWRyYXcgPSBvcHRzLnJlZHJhdzsKICAgICAgICAgICAgdGhpcy5fd2ViZ3B1QmFja1RleHR1cmUgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9hbGxFZmZlY3RDaGFpbnMgPSBuZXcgU2V0CiAgICAgICAgfQogICAgICAgIF9BZGRFZmZlY3RDaGFpbihlYykgewogICAgICAgICAgICB0aGlzLl9hbGxFZmZlY3RDaGFpbnMuYWRkKGVjKQogICAgICAgIH0KICAgICAgICBfUmVtb3ZlRWZmZWN0Q2hhaW4oZWMpIHsKICAgICAgICAgICAgdGhpcy5fYWxsRWZmZWN0Q2hhaW5zLmRlbGV0ZShlYykKICAgICAgICB9CiAgICAgICAgT25Db250ZXh0TG9zdCgpIHsKICAgICAgICAgICAgdGhpcy5fd2ViZ3B1QmFja1RleHR1cmUgPQogICAgICAgICAgICAgICAgbnVsbDsKICAgICAgICAgICAgZm9yIChjb25zdCBlYyBvZiB0aGlzLl9hbGxFZmZlY3RDaGFpbnMpIGVjLk9uQ29udGV4dExvc3QoKQogICAgICAgIH0KICAgICAgICBHZXREcmF3U2l6ZShyZW5kZXJlcikgewogICAgICAgICAgICBpZiAodGhpcy5fY2JHZXREcmF3U2l6ZSkgcmV0dXJuIHRoaXMuX2NiR2V0RHJhd1NpemUocmVuZGVyZXIpOwogICAgICAgICAgICBlbHNlIHJldHVybiBbcmVuZGVyZXIuR2V0V2lkdGgoKSwgcmVuZGVyZXIuR2V0SGVpZ2h0KCldCiAgICAgICAgfQogICAgICAgIEdldFJlbmRlclRhcmdldChlZmZlY3RDaGFpbikgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fY2JHZXRSZW5kZXJUYXJnZXQoZWZmZWN0Q2hhaW4pCiAgICAgICAgfQogICAgICAgIFJlbGVhc2VSZW5kZXJUYXJnZXQocnQsIGVmZmVjdENoYWluKSB7CiAgICAgICAgICAgIHRoaXMuX2NiUmVsZWFzZVJlbmRlclRhcmdldChydCwgZWZmZWN0Q2hhaW4pCiAgICAgICAgfQogICAgICAgIEdldFRpbWUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9jYkdldFRpbWUoKQogICAgICAgIH0KICAgICAgICBSZWRyYXcoZWZmZWN0Q2hhaW4pIHsKICAgICAgICAgICAgdGhpcy5fY2JSZWRyYXcoZWZmZWN0Q2hhaW4pCiAgICAgICAgfQogICAgICAgIF9HZXRXZWJHUFVCYWNrVGV4dHVyZShyZW5kZXJlciwgd2lkdGgsIGhlaWdodCkgewogICAgICAgICAgICBpZiAodGhpcy5fd2ViZ3B1QmFja1RleHR1cmUgJiYKICAgICAgICAgICAgICAgICh0aGlzLl93ZWJncHVCYWNrVGV4dHVyZS5HZXRXaWR0aCgpICE9PSB3aWR0aCB8fCB0aGlzLl93ZWJncHVCYWNrVGV4dHVyZS5HZXRIZWlnaHQoKSAhPT0gaGVpZ2h0KSkgewogICAgICAgICAgICAgICAgcmVuZGVyZXIuRGVsZXRlVGV4dHVyZSh0aGlzLl93ZWJncHVCYWNrVGV4dHVyZSk7CiAgICAgICAgICAgICAgICB0aGlzLl93ZWJncHVCYWNrVGV4dHVyZSA9IG51bGwKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGhpcy5fd2ViZ3B1QmFja1RleHR1cmUgPT09IG51bGwpIHRoaXMuX3dlYmdwdUJhY2tUZXh0dXJlID0gcmVuZGVyZXIuQ3JlYXRlU3RhdGljVGV4dHVyZShudWxsLCB7CiAgICAgICAgICAgICAgICB3aWR0aCwKICAgICAgICAgICAgICAgIGhlaWdodCwKICAgICAgICAgICAgICAgIHNhbXBsaW5nOiAibmVhcmVzdCIsCiAgICAgICAgICAgICAgICBtaXBNYXA6IGZhbHNlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXR1cm4gdGhpcy5fd2ViZ3B1QmFja1RleHR1cmUKICAgICAgICB9CiAgICB9OwoKfQoKLy8gLi4vbGliL2dmeC9lZmZlY3RDb21wb3NpdG9yL2VmZmVjdENoYWluLmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIGNvbnN0IGFzc2VydCA9IHNlbGYuYXNzZXJ0OwogICAgY29uc3QgZ2xNYXRyaXggPSBzZWxmLmdsTWF0cml4OwogICAgY29uc3QgbWF0NCA9IGdsTWF0cml4Lm1hdDQ7CiAgICBjb25zdCB0ZW1wUmVjdCA9IEMzLk5ldyhDMy5SZWN0KTsKICAgIGNvbnN0IHRlbXBSZWN0MiA9IEMzLk5ldyhDMy5SZWN0KTsKICAgIGNvbnN0IHRlbXBSZWN0MyA9IEMzLk5ldyhDMy5SZWN0KTsKICAgIGNvbnN0IHRlbXBSZWN0NCA9IEMzLk5ldyhDMy5SZWN0KTsKICAgIGNvbnN0IHRlbXBNYXQ0YSA9IG1hdDQuY3JlYXRlKCk7CiAgICBjb25zdCB0ZW1wTWF0NGIgPSBtYXQ0LmNyZWF0ZSgpOwogICAgY29uc3QgREVGQVVMVF9DVE9SX09QVFMgPSB7CiAgICAgICAgZHJhd0NvbnRlbnQ6IG51bGwsCiAgICAgICAgZ2V0U291cmNlVGV4dHVyZUluZm86IG51bGwsCiAgICAgICAgZ2V0U2hhZGVyUGFyYW1ldGVyczogbnVsbCwKICAgICAgICBpbnZhbGlkYXRlUmVuZGVyVGFyZ2V0czogZmFsc2UKICAgIH07CiAgICBjb25zdCBERUZBVUxUX0JVSUxEU1RFUFNfT1BUUyA9IHsKICAgICAgICBpbmRleE1hcDogbnVsbCwKICAgICAgICBmb3JjZVByZURyYXc6IGZhbHNlLAogICAgICAgIGZvcmNlUG9zdERyYXc6IGZhbHNlLAogICAgICAgIGlzM0Q6IGZhbHNlLAogICAgICAgIGlzU291cmNlVGV4dHVyZVJvdGF0ZWQ6IGZhbHNlLAogICAgICAgIGlzUm90YXRlZE9yTmVnYXRpdmVTaXplSW5zdGFuY2U6IGZhbHNlLAogICAgICAgIHVzZUZ1bGxTdXJmYWNlOiBmYWxzZQogICAgfTsKICAgIEMzLkdmeC5FZmZlY3RDaGFpbiA9IGNsYXNzIEVmZmVjdENoYWluIHsKICAgICAgICBjb25zdHJ1Y3RvcihtYW5hZ2VyLCBvcHRzKSB7CiAgICAgICAgICAgIG9wdHMgPSBPYmplY3QuYXNzaWduKHt9LCBERUZBVUxUX0NUT1JfT1BUUywgb3B0cyk7CiAgICAgICAgICAgIHRoaXMuX21hbmFnZXIgPSBtYW5hZ2VyOwogICAgICAgICAgICB0aGlzLl9jYkRyYXdDb250ZW50ID0gb3B0cy5kcmF3Q29udGVudDsKICAgICAgICAgICAgdGhpcy5fY2JHZXRTb3VyY2VUZXh0dXJlSW5mbyA9IG9wdHMuZ2V0U291cmNlVGV4dHVyZUluZm87CiAgICAgICAgICAgIHRoaXMuX2NiR2V0U2hhZGVyUGFyYW1ldGVycyA9IG9wdHMuZ2V0U2hhZGVyUGFyYW1ldGVyczsKICAgICAgICAgICAgdGhpcy5fY2JEcmF3Q29udGVudEhvb2sgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9zaGFkZXJQcm9ncmFtTGlzdCA9IFtdOwogICAgICAgICAgICB0aGlzLl9zaGFkZXJQcm9ncmFtSW5kaWNlcyA9IFtdOwogICAgICAgICAgICB0aGlzLl9zdGVwcyA9IFtdOwogICAgICAgICAgICB0aGlzLl9uZWVkc1JlYnVpbGQgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5fYmxlbmRNb2RlID0gMDsKICAgICAgICAgICAgdGhpcy5faXNBbnlTaGFkZXJBbmltYXRlZCA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl9pc0FueVNoYWRlckRlcHRoU2FtcGxpbmcgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5faXNBbnlTaGFkZXJCYWNrZ3JvdW5kQmxlbmRpbmcgPQogICAgICAgICAgICAgICAgZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX2lzQW55U2hhZGVyQ3Jvc3NTYW1wbGluZyA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl9pc0FueUlzU3JjVGV4Um90YXRlZCA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl91c2VDb3B5VGV4dHVyZUJhY2tncm91bmRTYW1wbGluZyA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl9kaWRDaGFuZ2VUcmFuc2Zvcm0gPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5fZGVwdGhFbmFibGVkQXRTdGFydCA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl9jYW5Vc2VGYXN0UGF0aCA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl91c2VGdWxsU3VyZmFjZSA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl9pc1NvdXJjZVRleHR1cmVSb3RhdGVkID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX251bVRlbXBTdXJmYWNlc1JlcXVpcmVkID0gMDsKICAgICAgICAgICAgdGhpcy5fcmVuZGVyVGFyZ2V0cyA9IFtudWxsLCBudWxsLCBudWxsXTsKICAgICAgICAgICAgdGhpcy5faW52YWxpZGF0ZVJlbmRlclRhcmdldHMgPSAhIW9wdHMuaW52YWxpZGF0ZVJlbmRlclRhcmdldHM7CiAgICAgICAgICAgIHRoaXMuX2JveEV4dGVuZEhvcml6b250YWwgPSAwOwogICAgICAgICAgICB0aGlzLl9ib3hFeHRlbmRWZXJ0aWNhbCA9IDA7CiAgICAgICAgICAgIHRoaXMuX2RyYXdXaWR0aCA9IDA7CiAgICAgICAgICAgIHRoaXMuX2RyYXdIZWlnaHQgPSAwOwogICAgICAgICAgICB0aGlzLl9jb250ZW50T2JqZWN0ID0KICAgICAgICAgICAgICAgIG51bGw7CiAgICAgICAgICAgIHRoaXMuX2NvbnRleHRPYmplY3QgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9sYXlvdXRSZWN0ID0gQzMuTmV3KEMzLlJlY3QpOwogICAgICAgICAgICB0aGlzLl9kcmF3U3VyZmFjZVJlY3QgPSBDMy5OZXcoQzMuUmVjdCk7CiAgICAgICAgICAgIHRoaXMuX3JjVGV4T3JpZ2luYWwgPSBDMy5OZXcoQzMuUmVjdCk7CiAgICAgICAgICAgIHRoaXMuX3JjVGV4Qm91bmNlID0gQzMuTmV3KEMzLlJlY3QpOwogICAgICAgICAgICB0aGlzLl9yY1RleERlc3QgPSBDMy5OZXcoQzMuUmVjdCk7CiAgICAgICAgICAgIHRoaXMuX2RldmljZVBpeGVsUmF0aW8gPSAxOwogICAgICAgICAgICB0aGlzLl9sYXllclNjYWxlID0gMTsKICAgICAgICAgICAgdGhpcy5fbGF5ZXJBbmdsZSA9IDA7CiAgICAgICAgICAgIHRoaXMuX3RpbWUgPSAwOwogICAgICAgICAgICB0aGlzLl9kZXN0UmVuZGVyVGFyZ2V0ID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fYmFja1RleCA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX2NvbXBvc2l0T2ZmWCA9IDA7CiAgICAgICAgICAgIHRoaXMuX2NvbXBvc2l0T2ZmWSA9IDA7CiAgICAgICAgICAgIHRoaXMuX3VwZGF0ZU93blByb2plY3Rpb24gPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5fcHJvamVjdGlvbk1hdHJpeCA9IG1hdDQuY3JlYXRlKCk7CiAgICAgICAgICAgIHRoaXMuX21vZGVsVmlld01hdHJpeCA9IG1hdDQuY3JlYXRlKCk7CiAgICAgICAgICAgIHRoaXMuX21hbmFnZXIuX0FkZEVmZmVjdENoYWluKHRoaXMpCiAgICAgICAgfQogICAgICAgIFJlbGVhc2UoKSB7CiAgICAgICAgICAgIHRoaXMuX21hbmFnZXIuX1JlbW92ZUVmZmVjdENoYWluKHRoaXMpOwogICAgICAgICAgICBDMy5jbGVhckFycmF5KHRoaXMuX3N0ZXBzKTsKICAgICAgICAgICAgQzMuY2xlYXJBcnJheSh0aGlzLl9zaGFkZXJQcm9ncmFtTGlzdCk7CiAgICAgICAgICAgIEMzLmNsZWFyQXJyYXkodGhpcy5fc2hhZGVyUHJvZ3JhbUluZGljZXMpOwogICAgICAgICAgICB0aGlzLl9jb250ZW50T2JqZWN0ID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fY29udGV4dE9iamVjdCA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX2NiRHJhd0NvbnRlbnQgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9jYkdldFNvdXJjZVRleHR1cmVJbmZvID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fY2JHZXRTaGFkZXJQYXJhbWV0ZXJzID0gbnVsbAogICAgICAgIH0KICAgICAgICBPbkNvbnRleHRMb3N0KCkgewogICAgICAgICAgICB0aGlzLl9uZWVkc1JlYnVpbGQgPSB0cnVlOwogICAgICAgICAgICBDMy5jbGVhckFycmF5KHRoaXMuX3N0ZXBzKTsKICAgICAgICAgICAgQzMuY2xlYXJBcnJheSh0aGlzLl9zaGFkZXJQcm9ncmFtTGlzdCk7CiAgICAgICAgICAgIEMzLmNsZWFyQXJyYXkodGhpcy5fc2hhZGVyUHJvZ3JhbUluZGljZXMpCiAgICAgICAgfQogICAgICAgIE5lZWRzUmVidWlsZCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX25lZWRzUmVidWlsZAogICAgICAgIH0KICAgICAgICBCdWlsZFN0ZXBzKHNoYWRlclByb2dyYW1MaXN0LCBvcHRzKSB7CiAgICAgICAgICAgIG9wdHMgPSBPYmplY3QuYXNzaWduKHt9LCBERUZBVUxUX0JVSUxEU1RFUFNfT1BUUywKICAgICAgICAgICAgICAgIG9wdHMpOwogICAgICAgICAgICBDMy5jbGVhckFycmF5KHRoaXMuX3N0ZXBzKTsKICAgICAgICAgICAgdGhpcy5fYm94RXh0ZW5kSG9yaXpvbnRhbCA9IDA7CiAgICAgICAgICAgIHRoaXMuX2JveEV4dGVuZFZlcnRpY2FsID0gMDsKICAgICAgICAgICAgdGhpcy5faXNBbnlTaGFkZXJBbmltYXRlZCA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl9pc0FueVNoYWRlckRlcHRoU2FtcGxpbmcgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5faXNBbnlTaGFkZXJCYWNrZ3JvdW5kQmxlbmRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5faXNBbnlTaGFkZXJDcm9zc1NhbXBsaW5nID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX2lzQW55SXNTcmNUZXhSb3RhdGVkID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX3VzZUNvcHlUZXh0dXJlQmFja2dyb3VuZFNhbXBsaW5nID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX251bVRlbXBTdXJmYWNlc1JlcXVpcmVkID0gMDsKICAgICAgICAgICAgdGhpcy5faXNTb3VyY2VUZXh0dXJlUm90YXRlZCA9ICEhb3B0cy5pc1NvdXJjZVRleHR1cmVSb3RhdGVkOwogICAgICAgICAgICB0aGlzLl91c2VGdWxsU3VyZmFjZSA9ICEhb3B0cy51c2VGdWxsU3VyZmFjZTsKICAgICAgICAgICAgdGhpcy5fbmVlZHNSZWJ1aWxkID0gZmFsc2U7CiAgICAgICAgICAgIEMzLnNoYWxsb3dBc3NpZ25BcnJheSh0aGlzLl9zaGFkZXJQcm9ncmFtTGlzdCwKICAgICAgICAgICAgICAgIHNoYWRlclByb2dyYW1MaXN0KTsKICAgICAgICAgICAgaWYgKHNoYWRlclByb2dyYW1MaXN0Lmxlbmd0aCA9PT0gMCkgcmV0dXJuOwogICAgICAgICAgICBpZiAob3B0cy5pbmRleE1hcCkgewogICAgICAgICAgICAgICAgaWYgKG9wdHMuaW5kZXhNYXAubGVuZ3RoICE9PSBzaGFkZXJQcm9ncmFtTGlzdC5sZW5ndGgpIHRocm93IG5ldyBFcnJvcigiaW5jb3JyZWN0IGluZGV4TWFwIGxlbmd0aCIpOwogICAgICAgICAgICAgICAgQzMuc2hhbGxvd0Fzc2lnbkFycmF5KHRoaXMuX3NoYWRlclByb2dyYW1JbmRpY2VzLCBvcHRzLmluZGV4TWFwKQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgQzMuY2xlYXJBcnJheSh0aGlzLl9zaGFkZXJQcm9ncmFtSW5kaWNlcyk7CiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gc2hhZGVyUHJvZ3JhbUxpc3QubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHRoaXMuX3NoYWRlclByb2dyYW1JbmRpY2VzLnB1c2goaSkKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IgKGNvbnN0IHMgb2Ygc2hhZGVyUHJvZ3JhbUxpc3QpIHsKICAgICAgICAgICAgICAgIHRoaXMuX2JveEV4dGVuZEhvcml6b250YWwgKz0gcy5HZXRCb3hFeHRlbmRIb3Jpem9udGFsKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9ib3hFeHRlbmRWZXJ0aWNhbCArPSBzLkdldEJveEV4dGVuZFZlcnRpY2FsKCk7CiAgICAgICAgICAgICAgICBpZiAocy5Jc0FuaW1hdGVkKCkpIHRoaXMuX2lzQW55U2hhZGVyQW5pbWF0ZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgaWYgKHMuVXNlc0RlcHRoKCkpIHRoaXMuX2lzQW55U2hhZGVyRGVwdGhTYW1wbGluZyA9IHRydWU7CiAgICAgICAgICAgICAgICBpZiAocy5CbGVuZHNCYWNrZ3JvdW5kKCkpIHRoaXMuX2lzQW55U2hhZGVyQmFja2dyb3VuZEJsZW5kaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGlmIChzLlVzZXNDcm9zc1NhbXBsaW5nKCkpIHRoaXMuX2lzQW55U2hhZGVyQ3Jvc3NTYW1wbGluZyA9IHRydWU7CiAgICAgICAgICAgICAgICBpZiAocy5Vc2VzSXNTcmNUZXhSb3RhdGVkKCkpIHRoaXMuX2lzQW55SXNTcmNUZXhSb3RhdGVkID0gdHJ1ZQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuX3VzZUNvcHlUZXh0dXJlQmFja2dyb3VuZFNhbXBsaW5nID0gdGhpcy5fU2hvdWxkVXNlQ29weVRleHR1cmVCYWNrZ3JvdW5kU2FtcGxpbmcoc2hhZGVyUHJvZ3JhbUxpc3RbMF0uR2V0UmVuZGVyZXIoKSk7CiAgICAgICAgICAgIGNvbnN0IGRvUHJlRHJhdyA9IHRoaXMuX1Nob3VsZFByZURyYXcoc2hhZGVyUHJvZ3JhbUxpc3RbMF0sIG9wdHMpOwogICAgICAgICAgICBjb25zdCBkb1Bvc3REcmF3ID0gdGhpcy5fU2hvdWxkUG9zdERyYXcoc2hhZGVyUHJvZ3JhbUxpc3QuYXQoLTEpLAogICAgICAgICAgICAgICAgb3B0cyk7CiAgICAgICAgICAgIGlmIChzaGFkZXJQcm9ncmFtTGlzdC5sZW5ndGggPT09IDEgJiYgIWRvUHJlRHJhdyAmJiAhZG9Qb3N0RHJhdykgewogICAgICAgICAgICAgICAgdGhpcy5fY2FuVXNlRmFzdFBhdGggPSB0cnVlOwogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5fY2FuVXNlRmFzdFBhdGggPSBmYWxzZTsKICAgICAgICAgICAgbGV0IGxhc3RUYXJnZXRJZCA9IDA7CiAgICAgICAgICAgIGlmIChkb1ByZURyYXcpIHsKICAgICAgICAgICAgICAgIHRoaXMuX251bVRlbXBTdXJmYWNlc1JlcXVpcmVkID0gMTsKICAgICAgICAgICAgICAgIHRoaXMuX3N0ZXBzLnB1c2goQzMuTmV3KEMzLkdmeC5FZmZlY3RDaGFpbi5TdGVwLlByZURyYXcsIHRoaXMsIC0xLCAxKSk7CiAgICAgICAgICAgICAgICBsYXN0VGFyZ2V0SWQgPSAxCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IHNoYWRlclByb2dyYW1MaXN0Lmxlbmd0aDsgaSA8IGxlbjsgKytpKQogICAgICAgICAgICAgICAgaWYgKGkgPT09IDAgJiYgIWRvUHJlRHJhdykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX251bVRlbXBTdXJmYWNlc1JlcXVpcmVkID0gMTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9zdGVwcy5wdXNoKEMzLk5ldyhDMy5HZnguRWZmZWN0Q2hhaW4uU3RlcC5GaXJzdEJvdW5jZSwgdGhpcywgLTEsIDEsIGkpKTsKICAgICAgICAgICAgICAgICAgICBsYXN0VGFyZ2V0SWQgPSAxCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGxldCBuZXh0VGFyZ2V0SWQgPSBsYXN0VGFyZ2V0SWQgPT09CiAgICAgICAgICAgICAgICAgICAgICAgIDEgPyAyIDogMTsKICAgICAgICAgICAgICAgICAgICBpZiAoaSA9PT0gbGVuIC0gMSAmJiAhZG9Qb3N0RHJhdykgbmV4dFRhcmdldElkID0gMDsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9udW1UZW1wU3VyZmFjZXNSZXF1aXJlZCA9IE1hdGgubWF4KHRoaXMuX251bVRlbXBTdXJmYWNlc1JlcXVpcmVkLCBuZXh0VGFyZ2V0SWQpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3N0ZXBzLnB1c2goQzMuTmV3KEMzLkdmeC5FZmZlY3RDaGFpbi5TdGVwLkJvdW5jZSwgdGhpcywgbGFzdFRhcmdldElkLCBuZXh0VGFyZ2V0SWQsIGkpKTsKICAgICAgICAgICAgICAgICAgICBsYXN0VGFyZ2V0SWQgPSBuZXh0VGFyZ2V0SWQKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGRvUG9zdERyYXcpIHRoaXMuX3N0ZXBzLnB1c2goQzMuTmV3KEMzLkdmeC5FZmZlY3RDaGFpbi5TdGVwLlBvc3REcmF3LCB0aGlzLCBsYXN0VGFyZ2V0SWQsIDApKQogICAgICAgIH0KICAgICAgICBfU2hvdWxkUHJlRHJhdyhmaXJzdFNoYWRlclByb2dyYW0sIG9wdHMpIHsKICAgICAgICAgICAgaWYgKG9wdHMuZm9yY2VQcmVEcmF3IHx8IGZpcnN0U2hhZGVyUHJvZ3JhbS5NdXN0UHJlRHJhdygpIHx8IG9wdHMuaXMzRCB8fCBmaXJzdFNoYWRlclByb2dyYW0uVXNlc0RlcHRoKCkgJiYgIXRoaXMuX3VzZUZ1bGxTdXJmYWNlIHx8CiAgICAgICAgICAgICAgICAodGhpcy5fYm94RXh0ZW5kSG9yaXpvbnRhbCAhPT0gMCB8fCB0aGlzLl9ib3hFeHRlbmRWZXJ0aWNhbCAhPT0gMCkpIHJldHVybiB0cnVlOwogICAgICAgICAgICBpZiAoZmlyc3RTaGFkZXJQcm9ncmFtLkdldFJlbmRlcmVyKCkuSXNXZWJHTCgpKSByZXR1cm4gZmlyc3RTaGFkZXJQcm9ncmFtLkJsZW5kc0JhY2tncm91bmQoKSAmJiAob3B0cy5pc1JvdGF0ZWRPck5lZ2F0aXZlU2l6ZUluc3RhbmNlIHx8IG9wdHMuaXNTb3VyY2VUZXh0dXJlUm90YXRlZCkgfHwgZmlyc3RTaGFkZXJQcm9ncmFtLlVzZXNBbnlTcmNSZWN0T3JQaXhlbFNpemUoKSAmJiBvcHRzLmlzU291cmNlVGV4dHVyZVJvdGF0ZWQ7CiAgICAgICAgICAgIGVsc2UgcmV0dXJuIGZhbHNlCiAgICAgICAgfQogICAgICAgIF9TaG91bGRQb3N0RHJhdyhsYXN0U2hhZGVyUHJvZ3JhbSwgb3B0cykgewogICAgICAgICAgICBpZiAob3B0cy5mb3JjZVBvc3REcmF3KSByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgaWYgKGxhc3RTaGFkZXJQcm9ncmFtLkdldFJlbmRlcmVyKCkuSXNXZWJHTCgpKSByZXR1cm4gbGFzdFNoYWRlclByb2dyYW0uQmxlbmRzQmFja2dyb3VuZCgpIHx8IGxhc3RTaGFkZXJQcm9ncmFtLlVzZXNDcm9zc1NhbXBsaW5nKCk7CiAgICAgICAgICAgIGVsc2UgcmV0dXJuIChsYXN0U2hhZGVyUHJvZ3JhbS5CbGVuZHNCYWNrZ3JvdW5kKCkgfHwgbGFzdFNoYWRlclByb2dyYW0uVXNlc0Nyb3NzU2FtcGxpbmcoKSkgJiYgdGhpcy5fVXNlUmVuZGVyVGFyZ2V0QmFja2dyb3VuZFNhbXBsaW5nKCkKICAgICAgICB9CiAgICAgICAgX1Nob3VsZFVzZUNvcHlUZXh0dXJlQmFja2dyb3VuZFNhbXBsaW5nKHJlbmRlcmVyKSB7CiAgICAgICAgICAgIHJldHVybiByZW5kZXJlci5Jc1dlYkdQVSgpICYmIHRoaXMuX2lzQW55U2hhZGVyQmFja2dyb3VuZEJsZW5kaW5nICYmICF0aGlzLl9pc0FueVNoYWRlckNyb3NzU2FtcGxpbmcKICAgICAgICB9CiAgICAgICAgUmVuZGVyKHJlbmRlcmVyLCBkZXN0UmVuZGVyVGFyZ2V0LCBvcHRzKSB7CiAgICAgICAgICAgIGlmIChyZW5kZXJlci5Jc1dlYkdQVSgpICYmIGRlc3RSZW5kZXJUYXJnZXQgPT09IG51bGwpIGRlc3RSZW5kZXJUYXJnZXQgPSByZW5kZXJlci5HZXRCYWNrYnVmZmVyUmVuZGVyVGFyZ2V0KCk7CiAgICAgICAgICAgIHRoaXMuX2Rlc3RSZW5kZXJUYXJnZXQgPSBkZXN0UmVuZGVyVGFyZ2V0OwogICAgICAgICAgICB0aGlzLl9jb250ZW50T2JqZWN0ID0gb3B0cy5jb250ZW50T2JqZWN0IHx8IG51bGw7CiAgICAgICAgICAgIHRoaXMuX2NvbnRleHRPYmplY3QgPSBvcHRzLmNvbnRleHRPYmplY3QgfHwgbnVsbDsKICAgICAgICAgICAgdGhpcy5fYmxlbmRNb2RlID0gb3B0cy5ibGVuZE1vZGUgfHwgMDsKICAgICAgICAgICAgdGhpcy5fZGV2aWNlUGl4ZWxSYXRpbyA9IG9wdHMuZGV2aWNlUGl4ZWxSYXRpbyB8fCAxOwogICAgICAgICAgICB0aGlzLl9sYXllclNjYWxlID0gb3B0cy5sYXllclNjYWxlIHx8IDE7CiAgICAgICAgICAgIHRoaXMuX2xheWVyQW5nbGUgPSBvcHRzLmxheWVyQW5nbGUgfHwgMDsKICAgICAgICAgICAgdGhpcy5fdGltZSA9IHR5cGVvZiBvcHRzLnRpbWUgPT09ICJudW1iZXIiID8gb3B0cy50aW1lIDogdGhpcy5fbWFuYWdlci5HZXRUaW1lKCk7CiAgICAgICAgICAgIHRoaXMuX2RpZENoYW5nZVRyYW5zZm9ybSA9IGZhbHNlOwogICAgICAgICAgICByZW5kZXJlci5SZXNldERpZENoYW5nZVRyYW5zZm9ybUZsYWcoKTsKICAgICAgICAgICAgaWYgKHRoaXMuX2lzQW55U2hhZGVyQW5pbWF0ZWQpIHRoaXMuX1JlZHJhdygpOwogICAgICAgICAgICBsZXQgZGlkQ2FsY0RyYXdTaXplQW5kUmVjdHMgPSBmYWxzZTsKICAgICAgICAgICAgaWYgKHRoaXMuX1VzZUNvcHlUZXh0dXJlQmFja2dyb3VuZFNhbXBsaW5nKCkpIHsKICAgICAgICAgICAgICAgIHRoaXMuX0NhbGN1bGF0ZURyYXdTaXplQW5kUmVjdGFuZ2xlcyhyZW5kZXJlciwKICAgICAgICAgICAgICAgICAgICBvcHRzKTsKICAgICAgICAgICAgICAgIGRpZENhbGNEcmF3U2l6ZUFuZFJlY3RzID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHRoaXMuX2JhY2tUZXggPSB0aGlzLl9tYW5hZ2VyLl9HZXRXZWJHUFVCYWNrVGV4dHVyZShyZW5kZXJlciwgdGhpcy5fZHJhd1dpZHRoLCB0aGlzLl9kcmF3SGVpZ2h0KTsKICAgICAgICAgICAgICAgIHRlbXBSZWN0LmNvcHkodGhpcy5fZHJhd1N1cmZhY2VSZWN0KTsKICAgICAgICAgICAgICAgIHRlbXBSZWN0LnJvdW5kT3V0ZXIoKTsKICAgICAgICAgICAgICAgIHJlbmRlcmVyLkNvcHlUZXh0dXJlVG9UZXh0dXJlKHRoaXMuX2Rlc3RSZW5kZXJUYXJnZXQuR2V0VGV4dHVyZSgpLCB0aGlzLl9iYWNrVGV4LCB0ZW1wUmVjdC5nZXRMZWZ0KCksIHRlbXBSZWN0LmdldFRvcCgpLCB0ZW1wUmVjdC53aWR0aCgpLCB0ZW1wUmVjdC5oZWlnaHQoKSkKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGhpcy5fY2FuVXNlRmFzdFBhdGgpIHsKICAgICAgICAgICAgICAgIHRoaXMuX1JlbmRlcl9GYXN0UGF0aChyZW5kZXJlciwgb3B0cyk7CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIWRpZENhbGNEcmF3U2l6ZUFuZFJlY3RzKSB0aGlzLl9DYWxjdWxhdGVEcmF3U2l6ZUFuZFJlY3RhbmdsZXMocmVuZGVyZXIsIG9wdHMpOwogICAgICAgICAgICByZW5kZXJlci5SZXNldENvbG9yKCk7CiAgICAgICAgICAgIHJlbmRlcmVyLlNldEJhc2VaKDApOwogICAgICAgICAgICByZW5kZXJlci5TZXRDdXJyZW50WigwKTsKICAgICAgICAgICAgdGhpcy5fY2JEcmF3Q29udGVudEhvb2sgPSBvcHRzLmRyYXdDb250ZW50SG9vayB8fCBudWxsOwogICAgICAgICAgICB0aGlzLl9jb21wb3NpdE9mZlggPSBvcHRzLmNvbXBvc2l0T2ZmWCB8fCAwOwogICAgICAgICAgICB0aGlzLl9jb21wb3NpdE9mZlkgPSBvcHRzLmNvbXBvc2l0T2ZmWSB8fCAwOwogICAgICAgICAgICB0aGlzLl91cGRhdGVPd25Qcm9qZWN0aW9uID0gISFvcHRzLnVwZGF0ZU93blByb2plY3Rpb247CiAgICAgICAgICAgIHRoaXMuX09uQmVmb3JlU3RhcnRFZmZlY3RDaGFpbihyZW5kZXJlcik7CiAgICAgICAgICAgIHRoaXMuX3JlbmRlclRhcmdldHNbMF0gPSBkZXN0UmVuZGVyVGFyZ2V0OwogICAgICAgICAgICB0aGlzLl9yZW5kZXJUYXJnZXRzWzFdID0gdGhpcy5fbnVtVGVtcFN1cmZhY2VzUmVxdWlyZWQgPj0gMSA/IHRoaXMuX0dldFJlbmRlclRhcmdldCgpIDogbnVsbDsKICAgICAgICAgICAgdGhpcy5fcmVuZGVyVGFyZ2V0c1syXSA9IHRoaXMuX251bVRlbXBTdXJmYWNlc1JlcXVpcmVkID09PSAyID8gdGhpcy5fR2V0UmVuZGVyVGFyZ2V0KCkgOiBudWxsOwogICAgICAgICAgICBmb3IgKGNvbnN0IHN0ZXAgb2YgdGhpcy5fc3RlcHMpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHNyY1RhcmdldCA9CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fR2V0UmVuZGVyVGFyZ2V0Rm9ySWQoc3RlcC5HZXRTcmNUYXJnZXRJZCgpKTsKICAgICAgICAgICAgICAgIGNvbnN0IGRlc3RUYXJnZXQgPSB0aGlzLl9HZXRSZW5kZXJUYXJnZXRGb3JJZChzdGVwLkdldERlc3RUYXJnZXRJZCgpKTsKICAgICAgICAgICAgICAgIGlmIChyZW5kZXJlci5Jc1dlYkdQVSgpKSBzdGVwLlJ1bl9XZWJHUFUocmVuZGVyZXIsIHNyY1RhcmdldCwgZGVzdFRhcmdldCk7CiAgICAgICAgICAgICAgICBlbHNlIHN0ZXAuUnVuX1dlYkdMKHJlbmRlcmVyLCBzcmNUYXJnZXQsIGRlc3RUYXJnZXQpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHRoaXMuX3JlbmRlclRhcmdldHNbMV0pIHRoaXMuX1JlbGVhc2VSZW5kZXJUYXJnZXQodGhpcy5fcmVuZGVyVGFyZ2V0c1sxXSk7CiAgICAgICAgICAgIGlmICh0aGlzLl9yZW5kZXJUYXJnZXRzWzJdKSB0aGlzLl9SZWxlYXNlUmVuZGVyVGFyZ2V0KHRoaXMuX3JlbmRlclRhcmdldHNbMl0pOwogICAgICAgICAgICB0aGlzLl9yZW5kZXJUYXJnZXRzLmZpbGwobnVsbCk7CiAgICAgICAgICAgIHRoaXMuX09uQWZ0ZXJFbmRFZmZlY3RDaGFpbihyZW5kZXJlcik7CiAgICAgICAgICAgIHRoaXMuX2Rlc3RSZW5kZXJUYXJnZXQgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9iYWNrVGV4ID0KICAgICAgICAgICAgICAgIG51bGw7CiAgICAgICAgICAgIHRoaXMuX2NvbnRlbnRPYmplY3QgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9jb250ZXh0T2JqZWN0ID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fY2JEcmF3Q29udGVudEhvb2sgPSBudWxsCiAgICAgICAgfQogICAgICAgIF9DYWxjdWxhdGVEcmF3U2l6ZUFuZFJlY3RhbmdsZXMocmVuZGVyZXIsIG9wdHMpIHsKICAgICAgICAgICAgY29uc3QgW2RyYXdXaWR0aCwgZHJhd0hlaWdodF0gPSB0aGlzLl9tYW5hZ2VyLkdldERyYXdTaXplKHJlbmRlcmVyKTsKICAgICAgICAgICAgdGhpcy5fU2V0RHJhd1NpemUocmVuZGVyZXIsIGRyYXdXaWR0aCwgZHJhd0hlaWdodCk7CiAgICAgICAgICAgIHRoaXMuX0NhbGN1bGF0ZVJlY3RhbmdsZXMob3B0cykKICAgICAgICB9CiAgICAgICAgX1NldERyYXdTaXplKHJlbmRlcmVyLCBkcmF3V2lkdGgsIGRyYXdIZWlnaHQpIHsKICAgICAgICAgICAgaWYgKGRyYXdXaWR0aCA8PSAwIHx8IGRyYXdIZWlnaHQgPD0gMCkgdGhyb3cgbmV3IEVycm9yKCJpbnZhbGlkIGRyYXcgc2l6ZSIpOwogICAgICAgICAgICBpZiAodGhpcy5fZHJhd1dpZHRoICE9PSBkcmF3V2lkdGggfHwgdGhpcy5fZHJhd0hlaWdodCAhPT0gZHJhd0hlaWdodCkgdGhpcy5fQ2FsY3VsYXRlRGV2aWNlVHJhbnNmb3JtTWF0cmljZXMocmVuZGVyZXIsIGRyYXdXaWR0aCwKICAgICAgICAgICAgICAgIGRyYXdIZWlnaHQsIDAsIDAsIHRoaXMuX3Byb2plY3Rpb25NYXRyaXgsIHRoaXMuX21vZGVsVmlld01hdHJpeCk7CiAgICAgICAgICAgIHRoaXMuX2RyYXdXaWR0aCA9IGRyYXdXaWR0aDsKICAgICAgICAgICAgdGhpcy5fZHJhd0hlaWdodCA9IGRyYXdIZWlnaHQKICAgICAgICB9CiAgICAgICAgX0NhbGN1bGF0ZURldmljZVRyYW5zZm9ybU1hdHJpY2VzKHJlbmRlcmVyLCB3aWR0aCwgaGVpZ2h0LCBvZmZYLCBvZmZZLCBwcm9qTWF0LCBtdk1hdCkgewogICAgICAgICAgICBjb25zdCBzY3JvbGxYID0gd2lkdGggLyAyICsgb2ZmWDsKICAgICAgICAgICAgY29uc3Qgc2Nyb2xsWSA9IGhlaWdodCAvIDIgKyBvZmZZOwogICAgICAgICAgICByZW5kZXJlci5DYWxjdWxhdGVQZXJzcGVjdGl2ZU1hdHJpeChwcm9qTWF0LCB3aWR0aCAvIGhlaWdodCk7CiAgICAgICAgICAgIGNvbnN0IHRlbXBNYXQ0ID0gcmVuZGVyZXIuQ2FsY3VsYXRlTG9va0F0TW9kZWxWaWV3MihzY3JvbGxYLCBzY3JvbGxZLCByZW5kZXJlci5HZXREZWZhdWx0Q2FtZXJhWihoZWlnaHQpLCBzY3JvbGxYLCBzY3JvbGxZLCAwLCBoZWlnaHQpOwogICAgICAgICAgICBtYXQ0LmNvcHkobXZNYXQsIHRlbXBNYXQ0KQogICAgICAgIH0KICAgICAgICBfQ2FsY3VsYXRlUmVjdGFuZ2xlcyhvcHRzKSB7CiAgICAgICAgICAgIHRoaXMuX2xheW91dFJlY3QuY29weShvcHRzLmxheW91dFJlY3QpOwogICAgICAgICAgICBpZiAob3B0cy5kcmF3U3VyZmFjZVJlY3QpIHRoaXMuX2RyYXdTdXJmYWNlUmVjdC5jb3B5KG9wdHMuZHJhd1N1cmZhY2VSZWN0KTsKICAgICAgICAgICAgZWxzZSB0aGlzLl9kcmF3U3VyZmFjZVJlY3Quc2V0KDAsIDAsIHRoaXMuX2RyYXdXaWR0aCwgdGhpcy5fZHJhd0hlaWdodCk7CiAgICAgICAgICAgIHRoaXMuX3JjVGV4T3JpZ2luYWwuY29weSh0aGlzLl9kcmF3U3VyZmFjZVJlY3QpOwogICAgICAgICAgICB0aGlzLl9yY1RleE9yaWdpbmFsLmRpdmlkZSh0aGlzLl9kcmF3V2lkdGgsIHRoaXMuX2RyYXdIZWlnaHQpOwogICAgICAgICAgICBjb25zdCBib3hTY2FsZSA9IHRoaXMuX2xheWVyU2NhbGUgKiB0aGlzLl9kZXZpY2VQaXhlbFJhdGlvOwogICAgICAgICAgICB0aGlzLl9kcmF3U3VyZmFjZVJlY3QuaW5mbGF0ZSh0aGlzLl9ib3hFeHRlbmRIb3Jpem9udGFsICogYm94U2NhbGUsIHRoaXMuX2JveEV4dGVuZFZlcnRpY2FsICogYm94U2NhbGUpOwogICAgICAgICAgICB0aGlzLl9yY1RleERlc3QuY29weSh0aGlzLl9kcmF3U3VyZmFjZVJlY3QpOwogICAgICAgICAgICB0aGlzLl9yY1RleERlc3QuZGl2aWRlKHRoaXMuX2RyYXdXaWR0aCwgdGhpcy5fZHJhd0hlaWdodCk7CiAgICAgICAgICAgIHRoaXMuX2RyYXdTdXJmYWNlUmVjdC5jbGFtcCgwLCAwLCB0aGlzLl9kcmF3V2lkdGgsIHRoaXMuX2RyYXdIZWlnaHQpOwogICAgICAgICAgICB0aGlzLl9yY1RleEJvdW5jZS5jb3B5KHRoaXMuX2RyYXdTdXJmYWNlUmVjdCk7CiAgICAgICAgICAgIHRoaXMuX3JjVGV4Qm91bmNlLmRpdmlkZSh0aGlzLl9kcmF3V2lkdGgsIHRoaXMuX2RyYXdIZWlnaHQpCiAgICAgICAgfQogICAgICAgIF9PbkJlZm9yZVN0YXJ0RWZmZWN0Q2hhaW4ocmVuZGVyZXIpIHsKICAgICAgICAgICAgdGhpcy5fZGVwdGhFbmFibGVkQXRTdGFydCA9IHJlbmRlcmVyLklzRGVwdGhFbmFibGVkKCk7CiAgICAgICAgICAgIGlmICh0aGlzLl91c2VGdWxsU3VyZmFjZSkgewogICAgICAgICAgICAgICAgcmVuZGVyZXIuU2V0RGVwdGhFbmFibGVkKGZhbHNlKTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9pc0FueVNoYWRlckRlcHRoU2FtcGxpbmcpIHJlbmRlcmVyLlNldERlcHRoU2FtcGxpbmdFbmFibGVkKHRydWUpCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0ZW1wUmVjdC5jb3B5KHRoaXMuX2RyYXdTdXJmYWNlUmVjdCk7CiAgICAgICAgICAgICAgICBpZiAocmVuZGVyZXIuSXNXZWJHTCgpKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYm94U2NhbGUgPSB0aGlzLl9sYXllclNjYWxlICogdGhpcy5fZGV2aWNlUGl4ZWxSYXRpbzsKICAgICAgICAgICAgICAgICAgICB0ZW1wUmVjdC5pbmZsYXRlKE1hdGgubWF4KHRoaXMuX2JveEV4dGVuZEhvcml6b250YWwsIDEpICogYm94U2NhbGUsIE1hdGgubWF4KHRoaXMuX2JveEV4dGVuZFZlcnRpY2FsLCAxKSAqIGJveFNjYWxlKTsKICAgICAgICAgICAgICAgICAgICB0ZW1wUmVjdC5yb3VuZE91dGVyKCk7CiAgICAgICAgICAgICAgICAgICAgdGVtcFJlY3QuY2xhbXAoMCwgMCwgdGhpcy5fZHJhd1dpZHRoLCB0aGlzLl9kcmF3SGVpZ2h0KQogICAgICAgICAgICAgICAgfSBlbHNlIHRlbXBSZWN0LnJvdW5kT3V0ZXIoKTsKICAgICAgICAgICAgICAgIHJlbmRlcmVyLlNldFNjaXNzb3JSZWN0KHRlbXBSZWN0LmdldExlZnQoKSwgdGVtcFJlY3QuZ2V0VG9wKCksIHRlbXBSZWN0LndpZHRoKCksIHRlbXBSZWN0LmhlaWdodCgpLCB0aGlzLl9kcmF3SGVpZ2h0KQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIF9PbkFmdGVyRWZmZWN0Q2hhaW5EcmF3Q29udGVudChyZW5kZXJlcikgewogICAgICAgICAgICByZW5kZXJlci5SZXNldENvbG9yKCk7CiAgICAgICAgICAgIGlmICghdGhpcy5fdXNlRnVsbFN1cmZhY2UpIHsKICAgICAgICAgICAgICAgIHJlbmRlcmVyLlNldERlcHRoRW5hYmxlZChmYWxzZSk7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5faXNBbnlTaGFkZXJEZXB0aFNhbXBsaW5nKSByZW5kZXJlci5TZXREZXB0aFNhbXBsaW5nRW5hYmxlZCh0cnVlKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChyZW5kZXJlci5Jc1dlYkdQVSgpKSByZW5kZXJlci5TZXROb3JtYWxpemVkQ29vcmRzUHJvZ3JhbVZhcmlhbnQodHJ1ZSkKICAgICAgICB9CiAgICAgICAgX09uQWZ0ZXJFbmRFZmZlY3RDaGFpbihyZW5kZXJlcikgewogICAgICAgICAgICByZW5kZXJlci5TZXREZXB0aFNhbXBsaW5nRW5hYmxlZChmYWxzZSk7CiAgICAgICAgICAgIHJlbmRlcmVyLlNldERlcHRoRW5hYmxlZCh0aGlzLl9kZXB0aEVuYWJsZWRBdFN0YXJ0KTsKICAgICAgICAgICAgaWYgKCF0aGlzLl91c2VGdWxsU3VyZmFjZSkgcmVuZGVyZXIuUmVtb3ZlU2Npc3NvclJlY3QoKTsKICAgICAgICAgICAgaWYgKHJlbmRlcmVyLklzV2ViR1BVKCkpIHJlbmRlcmVyLlNldE5vcm1hbGl6ZWRDb29yZHNQcm9ncmFtVmFyaWFudChmYWxzZSk7CiAgICAgICAgICAgIHRoaXMuX2RpZENoYW5nZVRyYW5zZm9ybSA9IHJlbmRlcmVyLkRpZENoYW5nZVRyYW5zZm9ybSgpCiAgICAgICAgfQogICAgICAgIF9DbGFtcFJjVGV4RGVzdCgpIHsKICAgICAgICAgICAgdGhpcy5fcmNUZXhEZXN0LmNsYW1wKDAsIDAsIDEsIDEpCiAgICAgICAgfQogICAgICAgIF9HZXRSZW5kZXJUYXJnZXRGb3JJZChpZCkgewogICAgICAgICAgICByZXR1cm4gaWQgPCAwID8gbnVsbCA6IHRoaXMuX3JlbmRlclRhcmdldHNbaWRdCiAgICAgICAgfQogICAgICAgIF9HZXRSZW5kZXJUYXJnZXQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9tYW5hZ2VyLkdldFJlbmRlclRhcmdldCh0aGlzKQogICAgICAgIH0KICAgICAgICBfR2V0RGVzdFJlbmRlclRhcmdldCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2Rlc3RSZW5kZXJUYXJnZXQKICAgICAgICB9CiAgICAgICAgX1JlbGVhc2VSZW5kZXJUYXJnZXQocnQpIHsKICAgICAgICAgICAgdGhpcy5fbWFuYWdlci5SZWxlYXNlUmVuZGVyVGFyZ2V0KHJ0LAogICAgICAgICAgICAgICAgdGhpcykKICAgICAgICB9CiAgICAgICAgX0dldFNoYWRlclByb2dyYW1BdChpKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zaGFkZXJQcm9ncmFtTGlzdFtpXQogICAgICAgIH0KICAgICAgICBfRHJhd0NvbnRlbnQocmVuZGVyZXIpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX2NiRHJhd0NvbnRlbnRIb29rKSB0aGlzLl9jYkRyYXdDb250ZW50SG9vayh0aGlzLCByZW5kZXJlciwgKCkgPT4gdGhpcy5fY2JEcmF3Q29udGVudChyZW5kZXJlciwgdGhpcykpOwogICAgICAgICAgICBlbHNlIHRoaXMuX2NiRHJhd0NvbnRlbnQocmVuZGVyZXIsIHRoaXMpOwogICAgICAgICAgICBpZiAoIXRoaXMuX2NhblVzZUZhc3RQYXRoKSB0aGlzLl9PbkFmdGVyRWZmZWN0Q2hhaW5EcmF3Q29udGVudChyZW5kZXJlcikKICAgICAgICB9CiAgICAgICAgX0lzUmVuZGVyVGFyZ2V0U2FtZVNpemVBbmRPZmZzZXQocmVuZGVyZXIpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX3VzZUZ1bGxTdXJmYWNlKSByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgaWYgKHRoaXMuX2NvbXBvc2l0T2ZmWCAhPT0gMCB8fCB0aGlzLl9jb21wb3NpdE9mZlkgIT09IDApIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgY29uc3QgW3J0V2lkdGgsIHJ0SGVpZ2h0XSA9IHJlbmRlcmVyLkdldFJlbmRlclRhcmdldFNpemUocmVuZGVyZXIuR2V0UmVuZGVyVGFyZ2V0KCkpOwogICAgICAgICAgICBpZiAocnRXaWR0aCAhPT0gdGhpcy5fZHJhd1dpZHRoIHx8IHJ0SGVpZ2h0ICE9PSB0aGlzLl9kcmF3SGVpZ2h0KSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgfQogICAgICAgIF9TZXREZXZpY2VUcmFuc2Zvcm0ocmVuZGVyZXIsIGlzTGFzdCkgewogICAgICAgICAgICBsZXQgcHJvak1hdCA9IHRoaXMuX3Byb2plY3Rpb25NYXRyaXg7CiAgICAgICAgICAgIGxldCBtdk1hdCA9IHRoaXMuX21vZGVsVmlld01hdHJpeDsKICAgICAgICAgICAgaWYgKGlzTGFzdCAmJiAhdGhpcy5fSXNSZW5kZXJUYXJnZXRTYW1lU2l6ZUFuZE9mZnNldChyZW5kZXJlcikpIHsKICAgICAgICAgICAgICAgIHByb2pNYXQgPSB0ZW1wTWF0NGE7CiAgICAgICAgICAgICAgICBtdk1hdCA9IHRlbXBNYXQ0YjsKICAgICAgICAgICAgICAgIGNvbnN0IFtydFdpZHRoLCBydEhlaWdodF0gPSByZW5kZXJlci5HZXRSZW5kZXJUYXJnZXRTaXplKHJlbmRlcmVyLkdldFJlbmRlclRhcmdldCgpKTsKICAgICAgICAgICAgICAgIHRoaXMuX0NhbGN1bGF0ZURldmljZVRyYW5zZm9ybU1hdHJpY2VzKHJlbmRlcmVyLCBydFdpZHRoLCBydEhlaWdodCwgdGhpcy5fY29tcG9zaXRPZmZYLCB0aGlzLl9jb21wb3NpdE9mZlksIHByb2pNYXQsIG12TWF0KTsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5fdXNlRnVsbFN1cmZhY2UpIHJlbmRlcmVyLlJlbW92ZVNjaXNzb3JSZWN0KCkKICAgICAgICAgICAgfQogICAgICAgICAgICByZW5kZXJlci5TZXRQcm9qZWN0aW9uTWF0cml4KHByb2pNYXQpOwogICAgICAgICAgICByZW5kZXJlci5TZXRNb2RlbFZpZXdNYXRyaXgobXZNYXQpCiAgICAgICAgfQogICAgICAgIF9SZWRyYXcoKSB7CiAgICAgICAgICAgIHRoaXMuX21hbmFnZXIuUmVkcmF3KHRoaXMpCiAgICAgICAgfQogICAgICAgIF9HZXRTaGFkZXJQYXJhbWV0ZXJzKGluZGV4LCByZW5kZXJlcikgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fY2JHZXRTaGFkZXJQYXJhbWV0ZXJzKHRoaXMuX3NoYWRlclByb2dyYW1JbmRpY2VzW2luZGV4XSwgcmVuZGVyZXIpCiAgICAgICAgfQogICAgICAgIF9TZXRQcm9ncmFtUGFyYW1ldGVycyhyZW5kZXJlciwgaW5kZXgpIHsKICAgICAgICAgICAgbGV0IHJjVGV4RGVzdCA9IHRoaXMuX3JjVGV4RGVzdDsKICAgICAgICAgICAgbGV0IHNyY1JlY3QgPSB0aGlzLl9yY1RleEJvdW5jZTsKICAgICAgICAgICAgbGV0IHNyY09yaWdpblJlY3QgPSB0aGlzLl9yY1RleE9yaWdpbmFsOwogICAgICAgICAgICBpZiAocmVuZGVyZXIuSXNXZWJHTCgpKSB7CiAgICAgICAgICAgICAgICB0ZW1wUmVjdDIuY29weShyY1RleERlc3QpOwogICAgICAgICAgICAgICAgdGVtcFJlY3QyLmZsaXBBcm91bmQoMSk7CiAgICAgICAgICAgICAgICByY1RleERlc3QgPSB0ZW1wUmVjdDI7CiAgICAgICAgICAgICAgICB0ZW1wUmVjdDMuY29weShzcmNSZWN0KTsKICAgICAgICAgICAgICAgIHRlbXBSZWN0My5mbGlwQXJvdW5kKDEpOwogICAgICAgICAgICAgICAgc3JjUmVjdCA9IHRlbXBSZWN0MzsKICAgICAgICAgICAgICAgIHRlbXBSZWN0NC5jb3B5KHNyY09yaWdpblJlY3QpOwogICAgICAgICAgICAgICAgdGVtcFJlY3Q0LmZsaXBBcm91bmQoMSk7CiAgICAgICAgICAgICAgICBzcmNPcmlnaW5SZWN0ID0gdGVtcFJlY3Q0CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5fRG9TZXRQcm9ncmFtUGFyYW1ldGVycyhyZW5kZXJlciwgaW5kZXgsIHNyY1JlY3QsIHNyY09yaWdpblJlY3QsIHJjVGV4RGVzdCwgMSAvIHRoaXMuX2RyYXdXaWR0aCwgMSAvIHRoaXMuX2RyYXdIZWlnaHQpCiAgICAgICAgfQogICAgICAgIF9TZXRGaXJzdEJvdW5jZVByb2dyYW1QYXJhbWV0ZXJzKHJlbmRlcmVyLCBpbmRleCkgewogICAgICAgICAgICBsZXQgc3JjUmVjdCA9IHRoaXMuX3JjVGV4Qm91bmNlOwogICAgICAgICAgICBsZXQgc3JjT3JpZ2luUmVjdCA9IHRoaXMuX3JjVGV4T3JpZ2luYWw7CiAgICAgICAgICAgIGxldCBwaXhlbFdpZHRoID0gMSAvIHRoaXMuX2RyYXdXaWR0aDsKICAgICAgICAgICAgbGV0IHBpeGVsSGVpZ2h0ID0gMSAvIHRoaXMuX2RyYXdIZWlnaHQ7CiAgICAgICAgICAgIGlmICh0aGlzLl9jYkdldFNvdXJjZVRleHR1cmVJbmZvKSB7CiAgICAgICAgICAgICAgICBsZXQgewogICAgICAgICAgICAgICAgICAgIHNyY1RleFJlY3QsCiAgICAgICAgICAgICAgICAgICAgc3JjV2lkdGgsCiAgICAgICAgICAgICAgICAgICAgc3JjSGVpZ2h0CiAgICAgICAgICAgICAgICB9ID0gdGhpcy5fY2JHZXRTb3VyY2VUZXh0dXJlSW5mbyh0aGlzLl9jb250ZW50T2JqZWN0KTsKICAgICAgICAgICAgICAgIGlmICghc3JjVGV4UmVjdCkgewogICAgICAgICAgICAgICAgICAgIHRlbXBSZWN0LnNldCgwLCAwLCAwLAogICAgICAgICAgICAgICAgICAgICAgICAwKTsKICAgICAgICAgICAgICAgICAgICBzcmNUZXhSZWN0ID0gdGVtcFJlY3QKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICghc3JjV2lkdGgpIHNyY1dpZHRoID0gdGhpcy5fZHJhd1dpZHRoOwogICAgICAgICAgICAgICAgaWYgKCFzcmNIZWlnaHQpIHNyY0hlaWdodCA9IHRoaXMuX2RyYXdIZWlnaHQ7CiAgICAgICAgICAgICAgICBzcmNSZWN0ID0gc3JjVGV4UmVjdDsKICAgICAgICAgICAgICAgIHNyY09yaWdpblJlY3QgPSBzcmNUZXhSZWN0OwogICAgICAgICAgICAgICAgcGl4ZWxXaWR0aCA9IDEgLyBzcmNXaWR0aDsKICAgICAgICAgICAgICAgIHBpeGVsSGVpZ2h0ID0gMSAvIHNyY0hlaWdodAogICAgICAgICAgICB9IGVsc2UgaWYgKHJlbmRlcmVyLklzV2ViR0woKSkgewogICAgICAgICAgICAgICAgdGVtcFJlY3QzLmNvcHkoc3JjUmVjdCk7CiAgICAgICAgICAgICAgICB0ZW1wUmVjdDMuZmxpcEFyb3VuZCgxKTsKICAgICAgICAgICAgICAgIHNyY1JlY3QgPSB0ZW1wUmVjdDM7CiAgICAgICAgICAgICAgICB0ZW1wUmVjdDQuY29weShzcmNPcmlnaW5SZWN0KTsKICAgICAgICAgICAgICAgIHRlbXBSZWN0NC5mbGlwQXJvdW5kKDEpOwogICAgICAgICAgICAgICAgc3JjT3JpZ2luUmVjdCA9IHRlbXBSZWN0NAogICAgICAgICAgICB9CiAgICAgICAgICAgIGxldCByY1RleERlc3QgPSB0aGlzLl9yY1RleERlc3Q7CiAgICAgICAgICAgIGlmIChyZW5kZXJlci5Jc1dlYkdMKCkpIHsKICAgICAgICAgICAgICAgIHJjVGV4RGVzdCA9IHRlbXBSZWN0MjsKICAgICAgICAgICAgICAgIHJjVGV4RGVzdC5jb3B5KHRoaXMuX3JjVGV4RGVzdCk7CiAgICAgICAgICAgICAgICByY1RleERlc3QuZmxpcEFyb3VuZCgxKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuX0RvU2V0UHJvZ3JhbVBhcmFtZXRlcnMocmVuZGVyZXIsCiAgICAgICAgICAgICAgICBpbmRleCwgc3JjUmVjdCwgc3JjT3JpZ2luUmVjdCwgcmNUZXhEZXN0LCBwaXhlbFdpZHRoLCBwaXhlbEhlaWdodCk7CiAgICAgICAgICAgIGlmIChyZW5kZXJlci5Jc1dlYkdQVSgpICYmIHRoaXMuX2lzQW55SXNTcmNUZXhSb3RhdGVkKSByZW5kZXJlci5TZXRQcm9ncmFtUGFyYW1ldGVyX0lzU3JjVGV4Um90YXRlZCh0aGlzLl9pc1NvdXJjZVRleHR1cmVSb3RhdGVkKQogICAgICAgIH0KICAgICAgICBfR2V0QmFja1RleChyZW5kZXJlcikgewogICAgICAgICAgICBpZiAodGhpcy5faXNBbnlTaGFkZXJCYWNrZ3JvdW5kQmxlbmRpbmcpCiAgICAgICAgICAgICAgICBpZiAocmVuZGVyZXIuSXNXZWJHUFUoKSkKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fVXNlQ29weVRleHR1cmVCYWNrZ3JvdW5kU2FtcGxpbmcoKSkgcmV0dXJuIHRoaXMuX2JhY2tUZXg7CiAgICAgICAgICAgICAgICAgICAgZWxzZSByZXR1cm4gdGhpcy5fZGVzdFJlbmRlclRhcmdldC5HZXRUZXh0dXJlKCk7CiAgICAgICAgICAgIGVsc2UgcmV0dXJuIHRoaXMuX2Rlc3RSZW5kZXJUYXJnZXQ7CiAgICAgICAgICAgIGVsc2UgcmV0dXJuIG51bGwKICAgICAgICB9CiAgICAgICAgX0RvU2V0UHJvZ3JhbVBhcmFtZXRlcnMocmVuZGVyZXIsIGluZGV4LCBzcmNSZWN0LCBzcmNPcmlnaW5SZWN0LCByY1RleERlc3QsCiAgICAgICAgICAgIHBpeGVsV2lkdGgsIHBpeGVsSGVpZ2h0KSB7CiAgICAgICAgICAgIHJlbmRlcmVyLlNldFByb2dyYW1QYXJhbWV0ZXJzKHRoaXMuX0dldEJhY2tUZXgocmVuZGVyZXIpLCByY1RleERlc3QsIHNyY1JlY3QsIHNyY09yaWdpblJlY3QsIHRoaXMuX2xheW91dFJlY3QsIHBpeGVsV2lkdGgsIHBpeGVsSGVpZ2h0LCB0aGlzLl9kZXZpY2VQaXhlbFJhdGlvLCB0aGlzLl9sYXllclNjYWxlLCB0aGlzLl9sYXllckFuZ2xlLCB0aGlzLl90aW1lKTsKICAgICAgICAgICAgcmVuZGVyZXIuU2V0UHJvZ3JhbUN1c3RvbVBhcmFtZXRlcnModGhpcy5fR2V0U2hhZGVyUGFyYW1ldGVycyhpbmRleCwgcmVuZGVyZXIpKQogICAgICAgIH0KICAgICAgICBfUmVuZGVyX0Zhc3RQYXRoKHJlbmRlcmVyLCBvcHRzKSB7CiAgICAgICAgICAgIGNvbnN0IHNoYWRlclByb2dyYW0gPSB0aGlzLl9zaGFkZXJQcm9ncmFtTGlzdFswXTsKICAgICAgICAgICAgY29uc3Qgd2FzRGVwdGhFbmFibGVkID0gcmVuZGVyZXIuSXNEZXB0aEVuYWJsZWQoKTsKICAgICAgICAgICAgY29uc3QgdXNlc0RlcHRoID0gc2hhZGVyUHJvZ3JhbS5Vc2VzRGVwdGgoKTsKICAgICAgICAgICAgaWYgKHVzZXNEZXB0aCkgewogICAgICAgICAgICAgICAgcmVuZGVyZXIuU2V0RGVwdGhFbmFibGVkKGZhbHNlKTsKICAgICAgICAgICAgICAgIHJlbmRlcmVyLlNldERlcHRoU2FtcGxpbmdFbmFibGVkKHRydWUpOwogICAgICAgICAgICAgICAgdGhpcy5fcmNUZXhEZXN0LnNldCgwLCAwLCAxLCAxKTsKICAgICAgICAgICAgICAgIHRoaXMuX3JjVGV4T3JpZ2luYWwuc2V0KDAsIDAsIDEsIDEpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmVuZGVyZXIuU2V0UHJvZ3JhbShzaGFkZXJQcm9ncmFtKTsKICAgICAgICAgICAgcmVuZGVyZXIuU2V0QmxlbmRNb2RlKHRoaXMuX2JsZW5kTW9kZSk7CiAgICAgICAgICAgIHJlbmRlcmVyLlNldFJlbmRlclRhcmdldCh0aGlzLl9kZXN0UmVuZGVyVGFyZ2V0KTsKICAgICAgICAgICAgbGV0IHBpeGVsV2lkdGggPSAwOwogICAgICAgICAgICBsZXQgcGl4ZWxIZWlnaHQgPSAxOwogICAgICAgICAgICB0aGlzLl9yY1RleE9yaWdpbmFsLnNldCgwLCAwLCAxLCAxKTsKICAgICAgICAgICAgaWYgKHNoYWRlclByb2dyYW0uVXNlc0FueVNyY1JlY3RPclBpeGVsU2l6ZSgpICYmIHRoaXMuX2NiR2V0U291cmNlVGV4dHVyZUluZm8pIHsKICAgICAgICAgICAgICAgIGNvbnN0IHsKICAgICAgICAgICAgICAgICAgICBzcmNUZXhSZWN0LAogICAgICAgICAgICAgICAgICAgIHNyY1dpZHRoLAogICAgICAgICAgICAgICAgICAgIHNyY0hlaWdodAogICAgICAgICAgICAgICAgfSA9IHRoaXMuX2NiR2V0U291cmNlVGV4dHVyZUluZm8odGhpcy5fY29udGVudE9iamVjdCk7CiAgICAgICAgICAgICAgICBpZiAoc3JjVGV4UmVjdCkgdGhpcy5fcmNUZXhPcmlnaW5hbC5jb3B5KHNyY1RleFJlY3QpOwogICAgICAgICAgICAgICAgcGl4ZWxXaWR0aCA9IE51bWJlci5pc0Zpbml0ZShzcmNXaWR0aCkgPyAxIC8gc3JjV2lkdGggOiAwOwogICAgICAgICAgICAgICAgcGl4ZWxIZWlnaHQgPSBOdW1iZXIuaXNGaW5pdGUoc3JjSGVpZ2h0KSA/IDEgLyBzcmNIZWlnaHQgOiAwCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjb25zdCBbZHJhd1dpZHRoLCBkcmF3SGVpZ2h0XSA9IHRoaXMuX21hbmFnZXIuR2V0RHJhd1NpemUocmVuZGVyZXIpOwogICAgICAgICAgICAgICAgcGl4ZWxXaWR0aCA9IDEgLyBkcmF3V2lkdGg7CiAgICAgICAgICAgICAgICBwaXhlbEhlaWdodCA9IDEgLyBkcmF3SGVpZ2h0CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG9wdHMubGF5b3V0UmVjdCkgdGhpcy5fbGF5b3V0UmVjdC5jb3B5KG9wdHMubGF5b3V0UmVjdCk7CiAgICAgICAgICAgIGVsc2UgdGhpcy5fbGF5b3V0UmVjdC5zZXQoMCwgMCwgMCwgMCk7CiAgICAgICAgICAgIHJlbmRlcmVyLlNldFByb2dyYW1QYXJhbWV0ZXJzKHRoaXMuX0dldEJhY2tUZXgocmVuZGVyZXIpLCB0aGlzLl9yY1RleERlc3QsIHRoaXMuX3JjVGV4T3JpZ2luYWwsIHRoaXMuX3JjVGV4T3JpZ2luYWwsIHRoaXMuX2xheW91dFJlY3QsIHBpeGVsV2lkdGgsIHBpeGVsSGVpZ2h0LCB0aGlzLl9kZXZpY2VQaXhlbFJhdGlvLCB0aGlzLl9sYXllclNjYWxlLAogICAgICAgICAgICAgICAgdGhpcy5fbGF5ZXJBbmdsZSwgdGhpcy5fdGltZSk7CiAgICAgICAgICAgIHJlbmRlcmVyLlNldFByb2dyYW1DdXN0b21QYXJhbWV0ZXJzKHRoaXMuX0dldFNoYWRlclBhcmFtZXRlcnMoMCwgcmVuZGVyZXIpKTsKICAgICAgICAgICAgaWYgKHJlbmRlcmVyLklzV2ViR1BVKCkgJiYgdGhpcy5faXNBbnlJc1NyY1RleFJvdGF0ZWQpIHJlbmRlcmVyLlNldFByb2dyYW1QYXJhbWV0ZXJfSXNTcmNUZXhSb3RhdGVkKHRoaXMuX2lzU291cmNlVGV4dHVyZVJvdGF0ZWQpOwogICAgICAgICAgICByZW5kZXJlci5TZXRCYXNlWigwKTsKICAgICAgICAgICAgdGhpcy5fRHJhd0NvbnRlbnQocmVuZGVyZXIpOwogICAgICAgICAgICBpZiAodXNlc0RlcHRoKSB7CiAgICAgICAgICAgICAgICByZW5kZXJlci5TZXREZXB0aFNhbXBsaW5nRW5hYmxlZChmYWxzZSk7CiAgICAgICAgICAgICAgICByZW5kZXJlci5TZXREZXB0aEVuYWJsZWQod2FzRGVwdGhFbmFibGVkKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIF9Vc2VDb3B5VGV4dHVyZUJhY2tncm91bmRTYW1wbGluZygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3VzZUNvcHlUZXh0dXJlQmFja2dyb3VuZFNhbXBsaW5nCiAgICAgICAgfQogICAgICAgIF9Vc2VSZW5kZXJUYXJnZXRCYWNrZ3JvdW5kU2FtcGxpbmcoKSB7CiAgICAgICAgICAgIHJldHVybiAhdGhpcy5fdXNlQ29weVRleHR1cmVCYWNrZ3JvdW5kU2FtcGxpbmcKICAgICAgICB9CiAgICAgICAgSXNBbnlTaGFkZXJCYWNrZ3JvdW5kQmxlbmRpbmcoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pc0FueVNoYWRlckJhY2tncm91bmRCbGVuZGluZwogICAgICAgIH0KICAgICAgICBDYW5Ta2lwQ2FsY3VsYXRpbmdEcmF3U3VyZmFjZVJlY3QoKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5fY2FuVXNlRmFzdFBhdGgpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgaWYgKHRoaXMuX1VzZUNvcHlUZXh0dXJlQmFja2dyb3VuZFNhbXBsaW5nKCkpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICB9CiAgICAgICAgVXNlRnVsbFN1cmZhY2UoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl91c2VGdWxsU3VyZmFjZQogICAgICAgIH0KICAgICAgICBHZXRDb250ZW50T2JqZWN0KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fY29udGVudE9iamVjdAogICAgICAgIH0KICAgICAgICBHZXRDb250ZXh0T2JqZWN0KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fY29udGV4dE9iamVjdAogICAgICAgIH0KICAgICAgICBfR2V0QmxlbmRNb2RlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fYmxlbmRNb2RlCiAgICAgICAgfQogICAgICAgIF9VcGRhdGVPd25Qcm9qZWN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fdXBkYXRlT3duUHJvamVjdGlvbgogICAgICAgIH0KICAgICAgICBEaWRDaGFuZ2VUcmFuc2Zvcm0oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9kaWRDaGFuZ2VUcmFuc2Zvcm0KICAgICAgICB9CiAgICAgICAgX0dldERyYXdTdXJmYWNlUmVjdCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2RyYXdTdXJmYWNlUmVjdAogICAgICAgIH0KICAgICAgICBfR2V0UmNUZXhCb3VuY2UoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9yY1RleEJvdW5jZQogICAgICAgIH0KICAgICAgICBfU2hvdWxkSW52YWxpZGF0ZVJlbmRlclRhcmdldHMoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pbnZhbGlkYXRlUmVuZGVyVGFyZ2V0cwogICAgICAgIH0KICAgICAgICBhc3luYyBEZWJ1Z0xvZ1JlbmRlclRhcmdldENvbnRlbnRzKG1zZywKICAgICAgICAgICAgcmVuZGVyZXIsIHJlbmRlclRhcmdldCkge30KICAgIH07Cgp9CgovLyAuLi9saWIvZ2Z4L2VmZmVjdENvbXBvc2l0b3Ivc3RlcC5qcwp7CiAgICAndXNlIHN0cmljdCc7CiAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICBDMy5HZnguRWZmZWN0Q2hhaW4uU3RlcCA9IGNsYXNzIEVmZmVjdENoYWluU3RlcCB7CiAgICAgICAgY29uc3RydWN0b3IoZWZmZWN0Q2hhaW4sIHNyY1RhcmdldElkLCBkZXN0VGFyZ2V0SWQsIGluZGV4ID0gLTEpIHsKICAgICAgICAgICAgdGhpcy5fZWZmZWN0Q2hhaW4gPSBlZmZlY3RDaGFpbjsKICAgICAgICAgICAgdGhpcy5fc3JjVGFyZ2V0SWQgPSBzcmNUYXJnZXRJZDsKICAgICAgICAgICAgdGhpcy5fZGVzdFRhcmdldElkID0gZGVzdFRhcmdldElkOwogICAgICAgICAgICB0aGlzLl9pbmRleCA9IGluZGV4CiAgICAgICAgfQogICAgICAgIEdldEVmZmVjdENoYWluKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZWZmZWN0Q2hhaW4KICAgICAgICB9CiAgICAgICAgR2V0U3JjVGFyZ2V0SWQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zcmNUYXJnZXRJZAogICAgICAgIH0KICAgICAgICBHZXREZXN0VGFyZ2V0SWQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9kZXN0VGFyZ2V0SWQKICAgICAgICB9CiAgICAgICAgR2V0SW5kZXgoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pbmRleAogICAgICAgIH0KICAgICAgICBHZXRTaGFkZXJQcm9ncmFtKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5HZXRFZmZlY3RDaGFpbigpLl9HZXRTaGFkZXJQcm9ncmFtQXQodGhpcy5HZXRJbmRleCgpKQogICAgICAgIH0KICAgICAgICBSdW5fV2ViR0wocmVuZGVyZXIsIHNyY1JlbmRlclRhcmdldCwgZGVzdFJlbmRlclRhcmdldCkge30KICAgICAgICBSdW5fV2ViR1BVKHJlbmRlcmVyLAogICAgICAgICAgICBzcmNSZW5kZXJUYXJnZXQsIGRlc3RSZW5kZXJUYXJnZXQpIHt9CiAgICB9OwoKfQoKLy8gLi4vbGliL2dmeC9lZmZlY3RDb21wb3NpdG9yL3ByZURyYXdTdGVwLmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIEMzLkdmeC5FZmZlY3RDaGFpbi5TdGVwLlByZURyYXcgPSBjbGFzcyBQcmVEcmF3U3RlcCBleHRlbmRzIEMzLkdmeC5FZmZlY3RDaGFpbi5TdGVwIHsKICAgICAgICBjb25zdHJ1Y3RvcihlZmZlY3RDaGFpbiwgc3JjVGFyZ2V0SWQsIGRlc3RUYXJnZXRJZCwgaW5kZXgpIHsKICAgICAgICAgICAgc3VwZXIoZWZmZWN0Q2hhaW4sIHNyY1RhcmdldElkLCBkZXN0VGFyZ2V0SWQsIGluZGV4KQogICAgICAgIH0KICAgICAgICBSdW5fV2ViR0wocmVuZGVyZXIsIHNyY1JlbmRlclRhcmdldCwgZGVzdFJlbmRlclRhcmdldCkgewogICAgICAgICAgICBjb25zdCBlZmZlY3RDaGFpbiA9IHRoaXMuR2V0RWZmZWN0Q2hhaW4oKTsKICAgICAgICAgICAgcmVuZGVyZXIuU2V0QWxwaGFCbGVuZCgpOwogICAgICAgICAgICByZW5kZXJlci5TZXRUZXh0dXJlRmlsbE1vZGUoKTsKICAgICAgICAgICAgcmVuZGVyZXIuU2V0UmVuZGVyVGFyZ2V0KGRlc3RSZW5kZXJUYXJnZXQsIGVmZmVjdENoYWluLl9VcGRhdGVPd25Qcm9qZWN0aW9uKCkpOwogICAgICAgICAgICByZW5kZXJlci5DbGVhclJnYmEoMCwgMCwgMCwgMCk7CiAgICAgICAgICAgIGVmZmVjdENoYWluLl9EcmF3Q29udGVudChyZW5kZXJlcik7CiAgICAgICAgICAgIGVmZmVjdENoYWluLl9DbGFtcFJjVGV4RGVzdCgpCiAgICAgICAgfQogICAgICAgIFJ1bl9XZWJHUFUocmVuZGVyZXIsCiAgICAgICAgICAgIHNyY1JlbmRlclRhcmdldCwgZGVzdFJlbmRlclRhcmdldCkgewogICAgICAgICAgICBjb25zdCBlZmZlY3RDaGFpbiA9IHRoaXMuR2V0RWZmZWN0Q2hhaW4oKTsKICAgICAgICAgICAgcmVuZGVyZXIuU2V0QWxwaGFCbGVuZCgpOwogICAgICAgICAgICByZW5kZXJlci5TZXRUZXh0dXJlRmlsbE1vZGUoKTsKICAgICAgICAgICAgcmVuZGVyZXIuU2V0UmVuZGVyVGFyZ2V0KGRlc3RSZW5kZXJUYXJnZXQsIGZhbHNlKTsKICAgICAgICAgICAgcmVuZGVyZXIuQ2xlYXJSZ2JhKDAsIDAsIDAsIDApOwogICAgICAgICAgICBlZmZlY3RDaGFpbi5fRHJhd0NvbnRlbnQocmVuZGVyZXIpOwogICAgICAgICAgICBlZmZlY3RDaGFpbi5fQ2xhbXBSY1RleERlc3QoKQogICAgICAgIH0KICAgIH07Cgp9CgovLyAuLi9saWIvZ2Z4L2VmZmVjdENvbXBvc2l0b3IvcG9zdERyYXdTdGVwLmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIGNvbnN0IHRlbXBSZWN0ID0gQzMuTmV3KEMzLlJlY3QpOwogICAgY29uc3QgdGVtcFF1YWQgPSBDMy5OZXcoQzMuUXVhZCk7CiAgICBDMy5HZnguRWZmZWN0Q2hhaW4uU3RlcC5Qb3N0RHJhdyA9IGNsYXNzIFBvc3REcmF3U3RlcCBleHRlbmRzIEMzLkdmeC5FZmZlY3RDaGFpbi5TdGVwIHsKICAgICAgICBjb25zdHJ1Y3RvcihlZmZlY3RDaGFpbiwgc3JjVGFyZ2V0SWQsIGRlc3RUYXJnZXRJZCwgaW5kZXgpIHsKICAgICAgICAgICAgc3VwZXIoZWZmZWN0Q2hhaW4sIHNyY1RhcmdldElkLCBkZXN0VGFyZ2V0SWQsIGluZGV4KQogICAgICAgIH0KICAgICAgICBSdW5fV2ViR0wocmVuZGVyZXIsIHNyY1JlbmRlclRhcmdldCwgZGVzdFJlbmRlclRhcmdldCkgewogICAgICAgICAgICBjb25zdCBlZmZlY3RDaGFpbiA9IHRoaXMuR2V0RWZmZWN0Q2hhaW4oKTsKICAgICAgICAgICAgcmVuZGVyZXIuU2V0VGV4dHVyZUZpbGxNb2RlKCk7CiAgICAgICAgICAgIHJlbmRlcmVyLlNldFJlbmRlclRhcmdldChkZXN0UmVuZGVyVGFyZ2V0KTsKICAgICAgICAgICAgZWZmZWN0Q2hhaW4uX1NldERldmljZVRyYW5zZm9ybShyZW5kZXJlciwgdHJ1ZSk7CiAgICAgICAgICAgIHJlbmRlcmVyLlNldEJsZW5kTW9kZShlZmZlY3RDaGFpbi5fR2V0QmxlbmRNb2RlKCkpOwogICAgICAgICAgICByZW5kZXJlci5TZXRUZXh0dXJlKHNyY1JlbmRlclRhcmdldC5HZXRUZXh0dXJlKCkpOwogICAgICAgICAgICB0ZW1wUXVhZC5zZXRGcm9tUmVjdChlZmZlY3RDaGFpbi5fR2V0RHJhd1N1cmZhY2VSZWN0KCkpOwogICAgICAgICAgICB0ZW1wUmVjdC5jb3B5KGVmZmVjdENoYWluLl9HZXRSY1RleEJvdW5jZSgpKTsKICAgICAgICAgICAgdGVtcFJlY3QuZmxpcEFyb3VuZCgxKTsKICAgICAgICAgICAgcmVuZGVyZXIuUXVhZDModGVtcFF1YWQsIHRlbXBSZWN0KTsKICAgICAgICAgICAgaWYgKGVmZmVjdENoYWluLl9TaG91bGRJbnZhbGlkYXRlUmVuZGVyVGFyZ2V0cygpKSByZW5kZXJlci5JbnZhbGlkYXRlUmVuZGVyVGFyZ2V0KHNyY1JlbmRlclRhcmdldCkKICAgICAgICB9CiAgICAgICAgUnVuX1dlYkdQVShyZW5kZXJlciwgc3JjUmVuZGVyVGFyZ2V0LCBkZXN0UmVuZGVyVGFyZ2V0KSB7CiAgICAgICAgICAgIGNvbnN0IGVmZmVjdENoYWluID0gdGhpcy5HZXRFZmZlY3RDaGFpbigpOwogICAgICAgICAgICByZW5kZXJlci5TZXRUZXh0dXJlRmlsbE1vZGUoKTsKICAgICAgICAgICAgcmVuZGVyZXIuU2V0UmVuZGVyVGFyZ2V0KGRlc3RSZW5kZXJUYXJnZXQsIGZhbHNlKTsKICAgICAgICAgICAgaWYgKGVmZmVjdENoYWluLl9Jc1JlbmRlclRhcmdldFNhbWVTaXplQW5kT2Zmc2V0KHJlbmRlcmVyKSkgdGVtcFF1YWQuc2V0RnJvbVJlY3QoZWZmZWN0Q2hhaW4uX0dldFJjVGV4Qm91bmNlKCkpOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIHJlbmRlcmVyLlNldE5vcm1hbGl6ZWRDb29yZHNQcm9ncmFtVmFyaWFudChmYWxzZSk7CiAgICAgICAgICAgICAgICBlZmZlY3RDaGFpbi5fU2V0RGV2aWNlVHJhbnNmb3JtKHJlbmRlcmVyLCB0cnVlKTsKICAgICAgICAgICAgICAgIHRlbXBRdWFkLnNldEZyb21SZWN0KGVmZmVjdENoYWluLl9HZXREcmF3U3VyZmFjZVJlY3QoKSkKICAgICAgICAgICAgfQogICAgICAgICAgICByZW5kZXJlci5TZXRCYWNrVGV4dHVyZShudWxsKTsKICAgICAgICAgICAgcmVuZGVyZXIuU2V0QmxlbmRNb2RlKGVmZmVjdENoYWluLl9HZXRCbGVuZE1vZGUoKSk7CiAgICAgICAgICAgIHJlbmRlcmVyLlNldFRleHR1cmUoc3JjUmVuZGVyVGFyZ2V0LkdldFRleHR1cmUoKSk7CiAgICAgICAgICAgIGlmIChlZmZlY3RDaGFpbi5Vc2VGdWxsU3VyZmFjZSgpKSByZW5kZXJlci5GdWxsc2NyZWVuUXVhZCgpOwogICAgICAgICAgICBlbHNlIHJlbmRlcmVyLlF1YWQzKHRlbXBRdWFkLCBlZmZlY3RDaGFpbi5fR2V0UmNUZXhCb3VuY2UoKSkKICAgICAgICB9CiAgICB9OwoKfQoKLy8gLi4vbGliL2dmeC9lZmZlY3RDb21wb3NpdG9yL2ZpcnN0Qm91bmNlU3RlcC5qcwp7CiAgICAndXNlIHN0cmljdCc7CiAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICBDMy5HZnguRWZmZWN0Q2hhaW4uU3RlcC5GaXJzdEJvdW5jZSA9IGNsYXNzIEZpcnN0Qm91bmNlU3RlcCBleHRlbmRzIEMzLkdmeC5FZmZlY3RDaGFpbi5TdGVwIHsKICAgICAgICBjb25zdHJ1Y3RvcihlZmZlY3RDaGFpbiwgc3JjVGFyZ2V0SWQsIGRlc3RUYXJnZXRJZCwgaW5kZXgpIHsKICAgICAgICAgICAgc3VwZXIoZWZmZWN0Q2hhaW4sIHNyY1RhcmdldElkLCBkZXN0VGFyZ2V0SWQsIGluZGV4KQogICAgICAgIH0KICAgICAgICBSdW5fV2ViR0wocmVuZGVyZXIsIHNyY1JlbmRlclRhcmdldCwgZGVzdFJlbmRlclRhcmdldCkgewogICAgICAgICAgICBjb25zdCBlZmZlY3RDaGFpbiA9IHRoaXMuR2V0RWZmZWN0Q2hhaW4oKTsKICAgICAgICAgICAgcmVuZGVyZXIuU2V0UmVuZGVyVGFyZ2V0KGRlc3RSZW5kZXJUYXJnZXQsIGVmZmVjdENoYWluLl9VcGRhdGVPd25Qcm9qZWN0aW9uKCkpOwogICAgICAgICAgICByZW5kZXJlci5DbGVhclJnYmEoMCwgMCwgMCwgMCk7CiAgICAgICAgICAgIHJlbmRlcmVyLlNldENvcHlCbGVuZCgpOwogICAgICAgICAgICByZW5kZXJlci5TZXRQcm9ncmFtKHRoaXMuR2V0U2hhZGVyUHJvZ3JhbSgpKTsKICAgICAgICAgICAgZWZmZWN0Q2hhaW4uX1NldEZpcnN0Qm91bmNlUHJvZ3JhbVBhcmFtZXRlcnMocmVuZGVyZXIsIHRoaXMuR2V0SW5kZXgoKSk7CiAgICAgICAgICAgIGVmZmVjdENoYWluLl9EcmF3Q29udGVudChyZW5kZXJlcik7CiAgICAgICAgICAgIGVmZmVjdENoYWluLl9DbGFtcFJjVGV4RGVzdCgpCiAgICAgICAgfQogICAgICAgIFJ1bl9XZWJHUFUocmVuZGVyZXIsIHNyY1JlbmRlclRhcmdldCwgZGVzdFJlbmRlclRhcmdldCkgewogICAgICAgICAgICBjb25zdCBlZmZlY3RDaGFpbiA9IHRoaXMuR2V0RWZmZWN0Q2hhaW4oKTsKICAgICAgICAgICAgcmVuZGVyZXIuU2V0UmVuZGVyVGFyZ2V0KGRlc3RSZW5kZXJUYXJnZXQsIGZhbHNlKTsKICAgICAgICAgICAgcmVuZGVyZXIuQ2xlYXJSZ2JhKDAsIDAsIDAsIDApOwogICAgICAgICAgICByZW5kZXJlci5TZXRDb3B5QmxlbmQoKTsKICAgICAgICAgICAgcmVuZGVyZXIuU2V0UHJvZ3JhbSh0aGlzLkdldFNoYWRlclByb2dyYW0oKSk7CiAgICAgICAgICAgIGVmZmVjdENoYWluLl9TZXRGaXJzdEJvdW5jZVByb2dyYW1QYXJhbWV0ZXJzKHJlbmRlcmVyLCB0aGlzLkdldEluZGV4KCkpOwogICAgICAgICAgICBlZmZlY3RDaGFpbi5fRHJhd0NvbnRlbnQocmVuZGVyZXIpOwogICAgICAgICAgICBlZmZlY3RDaGFpbi5fQ2xhbXBSY1RleERlc3QoKQogICAgICAgIH0KICAgIH07Cgp9CgovLyAuLi9saWIvZ2Z4L2VmZmVjdENvbXBvc2l0b3IvYm91bmNlU3RlcC5qcwp7CiAgICAndXNlIHN0cmljdCc7CiAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICBjb25zdCB0ZW1wUmVjdCA9IEMzLk5ldyhDMy5SZWN0KTsKICAgIGNvbnN0IHRlbXBRdWFkID0gQzMuTmV3KEMzLlF1YWQpOwogICAgQzMuR2Z4LkVmZmVjdENoYWluLlN0ZXAuQm91bmNlID0gY2xhc3MgQm91bmNlU3RlcCBleHRlbmRzIEMzLkdmeC5FZmZlY3RDaGFpbi5TdGVwIHsKICAgICAgICBjb25zdHJ1Y3RvcihlZmZlY3RDaGFpbiwgc3JjVGFyZ2V0SWQsIGRlc3RUYXJnZXRJZCwgaW5kZXgpIHsKICAgICAgICAgICAgc3VwZXIoZWZmZWN0Q2hhaW4sIHNyY1RhcmdldElkLCBkZXN0VGFyZ2V0SWQsIGluZGV4KQogICAgICAgIH0KICAgICAgICBSdW5fV2ViR0wocmVuZGVyZXIsIHNyY1JlbmRlclRhcmdldCwgZGVzdFJlbmRlclRhcmdldCkgewogICAgICAgICAgICBjb25zdCBlZmZlY3RDaGFpbiA9IHRoaXMuR2V0RWZmZWN0Q2hhaW4oKTsKICAgICAgICAgICAgcmVuZGVyZXIuU2V0UmVuZGVyVGFyZ2V0KGRlc3RSZW5kZXJUYXJnZXQpOwogICAgICAgICAgICBjb25zdCBpc0xhc3QgPSB0aGlzLkdldERlc3RUYXJnZXRJZCgpID09PSAwOwogICAgICAgICAgICBpZiAoaXNMYXN0KSByZW5kZXJlci5TZXRCbGVuZE1vZGUoZWZmZWN0Q2hhaW4uX0dldEJsZW5kTW9kZSgpKTsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICByZW5kZXJlci5DbGVhclJnYmEoMCwgMCwgMCwgMCk7CiAgICAgICAgICAgICAgICByZW5kZXJlci5TZXRDb3B5QmxlbmQoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJlbmRlcmVyLlNldFByb2dyYW0odGhpcy5HZXRTaGFkZXJQcm9ncmFtKCkpOwogICAgICAgICAgICBlZmZlY3RDaGFpbi5fU2V0UHJvZ3JhbVBhcmFtZXRlcnMocmVuZGVyZXIsIHRoaXMuR2V0SW5kZXgoKSk7CiAgICAgICAgICAgIHJlbmRlcmVyLlNldFRleHR1cmUoc3JjUmVuZGVyVGFyZ2V0LkdldFRleHR1cmUoKSk7CiAgICAgICAgICAgIGVmZmVjdENoYWluLl9TZXREZXZpY2VUcmFuc2Zvcm0ocmVuZGVyZXIsIGlzTGFzdCk7CiAgICAgICAgICAgIHRlbXBRdWFkLnNldEZyb21SZWN0KGVmZmVjdENoYWluLl9HZXREcmF3U3VyZmFjZVJlY3QoKSk7CiAgICAgICAgICAgIHRlbXBSZWN0LmNvcHkoZWZmZWN0Q2hhaW4uX0dldFJjVGV4Qm91bmNlKCkpOwogICAgICAgICAgICB0ZW1wUmVjdC5mbGlwQXJvdW5kKDEpOwogICAgICAgICAgICByZW5kZXJlci5RdWFkMyh0ZW1wUXVhZCwgdGVtcFJlY3QpOwogICAgICAgICAgICBpZiAoZWZmZWN0Q2hhaW4uX1Nob3VsZEludmFsaWRhdGVSZW5kZXJUYXJnZXRzKCkpIHJlbmRlcmVyLkludmFsaWRhdGVSZW5kZXJUYXJnZXQoc3JjUmVuZGVyVGFyZ2V0KQogICAgICAgIH0KICAgICAgICBSdW5fV2ViR1BVKHJlbmRlcmVyLCBzcmNSZW5kZXJUYXJnZXQsIGRlc3RSZW5kZXJUYXJnZXQpIHsKICAgICAgICAgICAgY29uc3QgZWZmZWN0Q2hhaW4gPSB0aGlzLkdldEVmZmVjdENoYWluKCk7CiAgICAgICAgICAgIHJlbmRlcmVyLlNldFJlbmRlclRhcmdldChkZXN0UmVuZGVyVGFyZ2V0LCBmYWxzZSk7CiAgICAgICAgICAgIGNvbnN0IGlzTGFzdCA9IHRoaXMuR2V0RGVzdFRhcmdldElkKCkgPT09IDA7CiAgICAgICAgICAgIGlmIChpc0xhc3QpIHsKICAgICAgICAgICAgICAgIHJlbmRlcmVyLlNldEJsZW5kTW9kZShlZmZlY3RDaGFpbi5fR2V0QmxlbmRNb2RlKCkpOwogICAgICAgICAgICAgICAgcmVuZGVyZXIuU2V0QmFja1RleHR1cmUobnVsbCk7CiAgICAgICAgICAgICAgICBpZiAoZWZmZWN0Q2hhaW4uX0lzUmVuZGVyVGFyZ2V0U2FtZVNpemVBbmRPZmZzZXQocmVuZGVyZXIpKSB0ZW1wUXVhZC5zZXRGcm9tUmVjdChlZmZlY3RDaGFpbi5fR2V0UmNUZXhCb3VuY2UoKSk7CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICByZW5kZXJlci5TZXROb3JtYWxpemVkQ29vcmRzUHJvZ3JhbVZhcmlhbnQoZmFsc2UpOwogICAgICAgICAgICAgICAgICAgIGVmZmVjdENoYWluLl9TZXREZXZpY2VUcmFuc2Zvcm0ocmVuZGVyZXIsIHRydWUpOwogICAgICAgICAgICAgICAgICAgIHRlbXBRdWFkLnNldEZyb21SZWN0KGVmZmVjdENoYWluLl9HZXREcmF3U3VyZmFjZVJlY3QoKSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJlbmRlcmVyLkNsZWFyUmdiYSgwLCAwLCAwLCAwKTsKICAgICAgICAgICAgICAgIHJlbmRlcmVyLlNldENvcHlCbGVuZCgpOwogICAgICAgICAgICAgICAgdGVtcFF1YWQuc2V0RnJvbVJlY3QoZWZmZWN0Q2hhaW4uX0dldFJjVGV4Qm91bmNlKCkpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmVuZGVyZXIuU2V0UHJvZ3JhbSh0aGlzLkdldFNoYWRlclByb2dyYW0oKSk7CiAgICAgICAgICAgIGVmZmVjdENoYWluLl9TZXRQcm9ncmFtUGFyYW1ldGVycyhyZW5kZXJlciwgdGhpcy5HZXRJbmRleCgpKTsKICAgICAgICAgICAgcmVuZGVyZXIuU2V0VGV4dHVyZShzcmNSZW5kZXJUYXJnZXQuR2V0VGV4dHVyZSgpKTsKICAgICAgICAgICAgaWYgKGVmZmVjdENoYWluLlVzZUZ1bGxTdXJmYWNlKCkpIHJlbmRlcmVyLkZ1bGxzY3JlZW5RdWFkKCk7CiAgICAgICAgICAgIGVsc2UgcmVuZGVyZXIuUXVhZDModGVtcFF1YWQsIGVmZmVjdENoYWluLl9HZXRSY1RleEJvdW5jZSgpKQogICAgICAgIH0KICAgIH07Cgp9CgovLyBpbnRlcmZhY2VzL0lSdW50aW1lLmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIGNvbnN0IEMzWCA9IHNlbGYuQzNYOwogICAgbGV0IHJ1bnRpbWUgPSBudWxsOwogICAgY29uc3Qga2V5c0Rvd25CeUtleSA9IG5ldyBTZXQ7CgogICAgZnVuY3Rpb24gU29ydFpPcmRlckxpc3QoYSwgYikgewogICAgICAgIGNvbnN0IGxheWVyQSA9IGFbMF07CiAgICAgICAgY29uc3QgbGF5ZXJCID0gYlswXTsKICAgICAgICBjb25zdCBkaWZmID0gbGF5ZXJBIC0gbGF5ZXJCOwogICAgICAgIGlmIChkaWZmICE9PSAwKSByZXR1cm4gZGlmZjsKICAgICAgICBjb25zdCBpbmRleEEgPSBhWzFdOwogICAgICAgIGNvbnN0IGluZGV4QiA9IGJbMV07CiAgICAgICAgcmV0dXJuIGluZGV4QSAtIGluZGV4QgogICAgfQogICAgY29uc3QgdGVtcFpPcmRlckxpc3QgPSBbXTsKICAgIGNvbnN0IHRlbXBJbnN0YW5jZXMgPSBbXTsKICAgIGxldCBkaWRXYXJuSW5BbGVydFBvbHlmaWxsID0gZmFsc2U7CiAgICBzZWxmLklSdW50aW1lID0gY2xhc3MgSVJ1bnRpbWUgewogICAgICAgIGNvbnN0cnVjdG9yKHJ1bnRpbWVfLCBvYmplY3RzKSB7CiAgICAgICAgICAgIHJ1bnRpbWUgPSBydW50aW1lXzsKICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGhpcywgewogICAgICAgICAgICAgICAgYXNzZXRzOiB7CiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHJ1bnRpbWUuR2V0QXNzZXRNYW5hZ2VyKCkuR2V0SUFzc2V0TWFuYWdlcigpLAogICAgICAgICAgICAgICAgICAgIHdyaXRhYmxlOiBmYWxzZQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIG9iamVjdHM6IHsKICAgICAgICAgICAgICAgICAgICB2YWx1ZTogb2JqZWN0cywKICAgICAgICAgICAgICAgICAgICB3cml0YWJsZTogZmFsc2UKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBnbG9iYWxWYXJzOiB7CiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHt9LAogICAgICAgICAgICAgICAgICAgIHdyaXRhYmxlOiBmYWxzZQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHByb2plY3ROYW1lOiB7CiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHJ1bnRpbWUuR2V0UHJvamVjdE5hbWUoKSwKICAgICAgICAgICAgICAgICAgICB3cml0YWJsZTogZmFsc2UKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBwcm9qZWN0VmVyc2lvbjogewogICAgICAgICAgICAgICAgICAgIHZhbHVlOiBydW50aW1lLkdldFByb2plY3RWZXJzaW9uKCksCiAgICAgICAgICAgICAgICAgICAgd3JpdGFibGU6IGZhbHNlCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgc3RvcmFnZTogewogICAgICAgICAgICAgICAgICAgIHZhbHVlOiBuZXcgc2VsZi5JU3RvcmFnZShydW50aW1lKSwKICAgICAgICAgICAgICAgICAgICB3cml0YWJsZTogZmFsc2UKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBpc0luV29ya2VyOiB7CiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHJ1bnRpbWUuSXNJbldvcmtlcigpLAogICAgICAgICAgICAgICAgICAgIHdyaXRhYmxlOiBmYWxzZQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHZpZXdwb3J0V2lkdGg6IHsKICAgICAgICAgICAgICAgICAgICB2YWx1ZTogcnVudGltZS5HZXRPcmlnaW5hbFZpZXdwb3J0V2lkdGgoKSwKICAgICAgICAgICAgICAgICAgICB3cml0YWJsZTogZmFsc2UKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB2aWV3cG9ydEhlaWdodDogewogICAgICAgICAgICAgICAgICAgIHZhbHVlOiBydW50aW1lLkdldE9yaWdpbmFsVmlld3BvcnRIZWlnaHQoKSwKICAgICAgICAgICAgICAgICAgICB3cml0YWJsZTogZmFsc2UKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJ1bnRpbWUuVXNlclNjcmlwdERpc3BhdGNoZXIoKS5hZGRFdmVudExpc3RlbmVyKCJrZXlkb3duIiwgZSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoa2V5c0Rvd25CeUtleS5oYXMoZVsia2V5Il0pKSB7CiAgICAgICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGtleXNEb3duQnlLZXkuYWRkKGVbImtleSJdKQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcnVudGltZS5Vc2VyU2NyaXB0RGlzcGF0Y2hlcigpLmFkZEV2ZW50TGlzdGVuZXIoImtleXVwIiwgZSA9PiBrZXlzRG93bkJ5S2V5LmRlbGV0ZShlWyJrZXkiXSkpOwogICAgICAgICAgICBydW50aW1lLkRpc3BhdGNoZXIoKS5hZGRFdmVudExpc3RlbmVyKCJ3aW5kb3ctYmx1ciIsICgpID0+IGtleXNEb3duQnlLZXkuY2xlYXIoKSk7CiAgICAgICAgICAgIGlmIChydW50aW1lLklzSW5Xb3JrZXIoKSkgc2VsZlsiYWxlcnQiXSA9IG1lc3NhZ2UgPT4gewogICAgICAgICAgICAgICAgaWYgKCFkaWRXYXJuSW5BbGVydFBvbHlmaWxsKSB7CiAgICAgICAgICAgICAgICAgICAgZGlkV2FybkluQWxlcnRQb2x5ZmlsbCA9CiAgICAgICAgICAgICAgICAgICAgICAgIHRydWU7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCJbQ29uc3RydWN0XSBhbGVydCgpIHdhcyBjYWxsZWQgZnJvbSBhIFdlYiBXb3JrZXIsIGJlY2F1c2UgdGhlIHByb2plY3QgJ1VzZSB3b3JrZXInIHNldHRpbmcgaXMgZW5hYmxlZC4gVGhpcyBtZXRob2QgaXMgbm90IG5vcm1hbGx5IGF2YWlsYWJsZSBpbiBhIFdlYiBXb3JrZXIuIENvbnN0cnVjdCBoYXMgaW1wbGVtZW50ZWQgdGhlIGFsZXJ0IGZvciB5b3UsIGJ1dCBub3RlIHRoYXQgb3RoZXIgZmVhdHVyZXMgbWF5IGJlIG1pc3NpbmcgaW4gd29ya2VyIG1vZGUuIFlvdSBtYXkgd2lzaCB0byBkaXNhYmxlICdVc2Ugd29ya2VyJywgb3IgdXNlIGEgbW9yZSBjb252ZW5pZW50IGZ1bmN0aW9uIGxpa2UgY29uc29sZS5sb2coKS4gRm9yIG1vcmUgaW5mb3JtYXRpb24gcGxlYXNlIHJlZmVyIHRvIHRoZSBzY3JpcHRpbmcgc2VjdGlvbiBvZiB0aGUgbWFudWFsLiIpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5hbGVydChtZXNzYWdlKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIF9Jbml0R2xvYmFsVmFycyhnbG9iYWxWYXJEZXNjcmlwdG9ycykgewogICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0aGlzLmdsb2JhbFZhcnMsCiAgICAgICAgICAgICAgICBnbG9iYWxWYXJEZXNjcmlwdG9ycykKICAgICAgICB9CiAgICAgICAgYWRkRXZlbnRMaXN0ZW5lcihuYW1lLCBmdW5jKSB7CiAgICAgICAgICAgIHJ1bnRpbWUuVXNlclNjcmlwdERpc3BhdGNoZXIoKS5hZGRFdmVudExpc3RlbmVyKG5hbWUsIGZ1bmMpCiAgICAgICAgfQogICAgICAgIHJlbW92ZUV2ZW50TGlzdGVuZXIobmFtZSwgZnVuYykgewogICAgICAgICAgICBydW50aW1lLlVzZXJTY3JpcHREaXNwYXRjaGVyKCkucmVtb3ZlRXZlbnRMaXN0ZW5lcihuYW1lLCBmdW5jKQogICAgICAgIH0KICAgICAgICBjYWxsRnVuY3Rpb24obmFtZSwgLi4ucGFyYW1zKSB7CiAgICAgICAgICAgIEMzWC5SZXF1aXJlU3RyaW5nKG5hbWUpOwogICAgICAgICAgICBjb25zdCBldmVudFNoZWV0TWFuYWdlciA9IHJ1bnRpbWUuR2V0RXZlbnRTaGVldE1hbmFnZXIoKTsKICAgICAgICAgICAgY29uc3QgZnVuY3Rpb25CbG9jayA9IGV2ZW50U2hlZXRNYW5hZ2VyLkdldEZ1bmN0aW9uQmxvY2tCeU5hbWUobmFtZSk7CiAgICAgICAgICAgIGlmICghZnVuY3Rpb25CbG9jaykgdGhyb3cgbmV3IEVycm9yKGBjYW5ub3QgZmluZCBmdW5jdGlvbiBuYW1lICcke25hbWV9J2ApOwogICAgICAgICAgICBpZiAoIWZ1bmN0aW9uQmxvY2suSXNFbmFibGVkKCkpIHJldHVybiBmdW5jdGlvbkJsb2NrLkdldERlZmF1bHRSZXR1cm5WYWx1ZSgpOwogICAgICAgICAgICBpZiAocGFyYW1zLmxlbmd0aCA8IGZ1bmN0aW9uQmxvY2suR2V0RnVuY3Rpb25QYXJhbWV0ZXJDb3VudCgpKSB0aHJvdyBuZXcgRXJyb3IoYG5vdCBlbm91Z2ggZnVuY3Rpb24gcGFyYW1ldGVycyBwYXNzZWQgZm9yICcke25hbWV9JyAoJHtwYXJhbXMubGVuZ3RofSBwYXNzZWQsICR7ZnVuY3Rpb25CbG9jay5HZXRGdW5jdGlvblBhcmFtZXRlckNvdW50KCl9IGV4cGVjdGVkKWApOwogICAgICAgICAgICBjb25zdCBjYWxsRXZlbnRCbG9jayA9IGZ1bmN0aW9uQmxvY2suR2V0RXZlbnRCbG9jaygpOwogICAgICAgICAgICBsZXQgYWxsU29sTW9kaWZpZXJzID0gY2FsbEV2ZW50QmxvY2suR2V0U29sTW9kaWZpZXJzSW5jbHVkaW5nUGFyZW50cygpOwogICAgICAgICAgICBjb25zdCBjdXJyZW50RXZlbnQgPSBldmVudFNoZWV0TWFuYWdlci5HZXRDdXJyZW50RXZlbnQoKTsKICAgICAgICAgICAgaWYgKGN1cnJlbnRFdmVudCkgewogICAgICAgICAgICAgICAgYWxsU29sTW9kaWZpZXJzID0gYWxsU29sTW9kaWZpZXJzLnNsaWNlKDApOwogICAgICAgICAgICAgICAgY29uc3QgYWxsU29sTW9kaWZpZXJzU2V0ID0gbmV3IFNldChhbGxTb2xNb2RpZmllcnMpOwogICAgICAgICAgICAgICAgZm9yIChjb25zdCBvYmplY3RDbGFzcyBvZiBjdXJyZW50RXZlbnQuR2V0U29sTW9kaWZpZXJzSW5jbHVkaW5nUGFyZW50cygpKQogICAgICAgICAgICAgICAgICAgIGlmICghYWxsU29sTW9kaWZpZXJzU2V0LmhhcyhvYmplY3RDbGFzcykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYWxsU29sTW9kaWZpZXJzLnB1c2gob2JqZWN0Q2xhc3MpOwogICAgICAgICAgICAgICAgICAgICAgICBhbGxTb2xNb2RpZmllcnNTZXQuYWRkKG9iamVjdENsYXNzKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGZvciAoY29uc3Qgb2JqZWN0Q2xhc3Mgb2YgZXZlbnRTaGVldE1hbmFnZXIuR2V0RHluYW1pY1NvbE1vZGlmaWVyc1NldCgpKQogICAgICAgICAgICAgICAgICAgIGlmICghYWxsU29sTW9kaWZpZXJzU2V0LmhhcyhvYmplY3RDbGFzcykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYWxsU29sTW9kaWZpZXJzLnB1c2gob2JqZWN0Q2xhc3MpOwogICAgICAgICAgICAgICAgICAgICAgICBhbGxTb2xNb2RpZmllcnNTZXQuYWRkKG9iamVjdENsYXNzKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCByZXQgPSBjYWxsRXZlbnRCbG9jay5SdW5Bc0V4cHJlc3Npb25GdW5jdGlvbkNhbGwoYWxsU29sTW9kaWZpZXJzLCBmdW5jdGlvbkJsb2NrLklzQ29weVBpY2tlZCgpLCBmdW5jdGlvbkJsb2NrLkdldFJldHVyblR5cGUoKSwgZnVuY3Rpb25CbG9jay5HZXREZWZhdWx0UmV0dXJuVmFsdWUoKSwgLi4ucGFyYW1zKTsKICAgICAgICAgICAgcmV0dXJuIHJldAogICAgICAgIH0KICAgICAgICBzZXRSZXR1cm5WYWx1ZSh2KSB7CiAgICAgICAgICAgIGNvbnN0IGZyYW1lID0gcnVudGltZS5HZXRFdmVudFN0YWNrKCkuR2V0Q3VycmVudEV4cEZ1bmNTdGFja0ZyYW1lKCk7CiAgICAgICAgICAgIGlmICghZnJhbWUpIHRocm93IG5ldyBFcnJvcigibm90IGluIGEgZnVuY3Rpb24gd2hpY2ggcmV0dXJucyBhIHZhbHVlIik7CiAgICAgICAgICAgIHN3aXRjaCAoZnJhbWUuR2V0RnVuY3Rpb25SZXR1cm5UeXBlKCkpIHsKICAgICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHYgPT09ICJudW1iZXIiKSBmcmFtZS5TZXRGdW5jdGlvblJldHVyblZhbHVlKHYpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdiA9PT0gInN0cmluZyIpIGZyYW1lLlNldEZ1bmN0aW9uUmV0dXJuVmFsdWUodik7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB2ID09PSAibnVtYmVyIiB8fCB0eXBlb2YgdiA9PT0gInN0cmluZyIpIGZyYW1lLlNldEZ1bmN0aW9uUmV0dXJuVmFsdWUodik7CiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBnZXRWaWV3cG9ydFNpemUoKSB7CiAgICAgICAgICAgIHJldHVybiBbcnVudGltZS5HZXRPcmlnaW5hbFZpZXdwb3J0V2lkdGgoKSwgcnVudGltZS5HZXRPcmlnaW5hbFZpZXdwb3J0SGVpZ2h0KCldCiAgICAgICAgfQogICAgICAgIGdldCBkdCgpIHsKICAgICAgICAgICAgcmV0dXJuIHJ1bnRpbWUuR2V0RHQoKQogICAgICAgIH0KICAgICAgICBnZXQgZHRSYXcoKSB7CiAgICAgICAgICAgIHJldHVybiBydW50aW1lLkdldER0UmF3KCkKICAgICAgICB9CiAgICAgICAgZ2V0IGdhbWVUaW1lKCkgewogICAgICAgICAgICByZXR1cm4gcnVudGltZS5HZXRHYW1lVGltZSgpCiAgICAgICAgfQogICAgICAgIGdldCB3YWxsVGltZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHJ1bnRpbWUuR2V0V2FsbFRpbWUoKQogICAgICAgIH0KICAgICAgICBnZXQgdGltZVNjYWxlKCkgewogICAgICAgICAgICByZXR1cm4gcnVudGltZS5HZXRUaW1lU2NhbGUoKQogICAgICAgIH0KICAgICAgICBzZXQgdGltZVNjYWxlKHQpIHsKICAgICAgICAgICAgQzNYLlJlcXVpcmVGaW5pdGVOdW1iZXIodCk7CiAgICAgICAgICAgIHJ1bnRpbWUuU2V0VGltZVNjYWxlKHQpCiAgICAgICAgfQogICAgICAgIGdldCBmcHMoKSB7CiAgICAgICAgICAgIHJldHVybiBydW50aW1lLkdldEZQUygpCiAgICAgICAgfQogICAgICAgIGdldCBjcHVVdGlsaXNhdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHJ1bnRpbWUuR2V0TWFpblRocmVhZFRpbWUoKQogICAgICAgIH0KICAgICAgICBnZXQgZ3B1VXRpbGlzYXRpb24oKSB7CiAgICAgICAgICAgIHJldHVybiBydW50aW1lLkdldEdQVVV0aWxpc2F0aW9uKCkKICAgICAgICB9CiAgICAgICAgcmFuZG9tKCkgewogICAgICAgICAgICByZXR1cm4gcnVudGltZS5SYW5kb20oKQogICAgICAgIH0KICAgICAgICBnZXQgbGF5b3V0KCkgewogICAgICAgICAgICByZXR1cm4gcnVudGltZS5HZXRNYWluUnVubmluZ0xheW91dCgpLkdldElMYXlvdXQoKQogICAgICAgIH0KICAgICAgICBnZXRMYXlvdXQobmFtZU9ySW5kZXgpIHsKICAgICAgICAgICAgY29uc3QgbGF5b3V0TWFuYWdlciA9IHJ1bnRpbWUuR2V0TGF5b3V0TWFuYWdlcigpOwogICAgICAgICAgICBsZXQgbGF5b3V0ID0gbnVsbDsKICAgICAgICAgICAgaWYgKHR5cGVvZiBuYW1lT3JJbmRleCA9PT0gIm51bWJlciIgfHwgdHlwZW9mIG5hbWVPckluZGV4ID09PSAic3RyaW5nIikgbGF5b3V0ID0gbGF5b3V0TWFuYWdlci5HZXRMYXlvdXQobmFtZU9ySW5kZXgpOwogICAgICAgICAgICBlbHNlIHRocm93IG5ldyBUeXBlRXJyb3IoImV4cGVjdGVkIHN0cmluZyBvciBudW1iZXIiKTsKICAgICAgICAgICAgaWYgKCFsYXlvdXQpIHRocm93IG5ldyBFcnJvcigiaW52YWxpZCBsYXlvdXQiKTsKICAgICAgICAgICAgcmV0dXJuIGxheW91dC5HZXRJTGF5b3V0KCkKICAgICAgICB9CiAgICAgICAgZ2V0QWxsTGF5b3V0cygpIHsKICAgICAgICAgICAgcmV0dXJuIHJ1bnRpbWUuR2V0TGF5b3V0TWFuYWdlcigpLkdldEFsbExheW91dHMoKS5tYXAobGF5b3V0ID0+IGxheW91dC5HZXRJTGF5b3V0KCkpCiAgICAgICAgfQogICAgICAgIGdvVG9MYXlvdXQobmFtZU9ySW5kZXgpIHsKICAgICAgICAgICAgY29uc3QgbGF5b3V0TWFuYWdlciA9IHJ1bnRpbWUuR2V0TGF5b3V0TWFuYWdlcigpOwogICAgICAgICAgICBsZXQgbGF5b3V0ID0gbnVsbDsKICAgICAgICAgICAgaWYgKHR5cGVvZiBuYW1lT3JJbmRleCA9PT0gIm51bWJlciIgfHwgdHlwZW9mIG5hbWVPckluZGV4ID09PSAic3RyaW5nIikgbGF5b3V0ID0gbGF5b3V0TWFuYWdlci5HZXRMYXlvdXQobmFtZU9ySW5kZXgpOwogICAgICAgICAgICBlbHNlIHRocm93IG5ldyBUeXBlRXJyb3IoImV4cGVjdGVkIHN0cmluZyBvciBudW1iZXIiKTsKICAgICAgICAgICAgaWYgKCFsYXlvdXQpIHRocm93IG5ldyBFcnJvcigiaW52YWxpZCBsYXlvdXQiKTsKICAgICAgICAgICAgaWYgKGxheW91dE1hbmFnZXIuSXNQZW5kaW5nQ2hhbmdlTWFpbkxheW91dCgpKSByZXR1cm47CiAgICAgICAgICAgIGxheW91dE1hbmFnZXIuQ2hhbmdlTWFpbkxheW91dChsYXlvdXQpCiAgICAgICAgfQogICAgICAgIGdldCBrZXlib2FyZCgpIHsKICAgICAgICAgICAgY29uc3QgcmV0ID0gcnVudGltZS5fR2V0Q29tbW9uU2NyaXB0SW50ZXJmYWNlcygpLmtleWJvYXJkOwogICAgICAgICAgICBpZiAoIXJldCkgdGhyb3cgbmV3IEVycm9yKCJydW50aW1lLmtleWJvYXJkIHVzZWQgYnV0IEtleWJvYXJkIG9iamVjdCBtaXNzaW5nIC0gYWRkIGl0IHRvIHlvdXIgcHJvamVjdCBmaXJzdCIpOwogICAgICAgICAgICByZXR1cm4gcmV0CiAgICAgICAgfQogICAgICAgIGdldCBtb3VzZSgpIHsKICAgICAgICAgICAgY29uc3QgcmV0ID0gcnVudGltZS5fR2V0Q29tbW9uU2NyaXB0SW50ZXJmYWNlcygpLm1vdXNlOwogICAgICAgICAgICBpZiAoIXJldCkgdGhyb3cgbmV3IEVycm9yKCJydW50aW1lLm1vdXNlIHVzZWQgYnV0IE1vdXNlIG9iamVjdCBtaXNzaW5nIC0gYWRkIGl0IHRvIHlvdXIgcHJvamVjdCBmaXJzdCIpOwogICAgICAgICAgICByZXR1cm4gcmV0CiAgICAgICAgfQogICAgICAgIGdldCB0b3VjaCgpIHsKICAgICAgICAgICAgY29uc3QgcmV0ID0gcnVudGltZS5fR2V0Q29tbW9uU2NyaXB0SW50ZXJmYWNlcygpLnRvdWNoOwogICAgICAgICAgICBpZiAoIXJldCkgdGhyb3cgbmV3IEVycm9yKCJydW50aW1lLnRvdWNoIHVzZWQgYnV0IFRvdWNoIG9iamVjdCBtaXNzaW5nIC0gYWRkIGl0IHRvIHlvdXIgcHJvamVjdCBmaXJzdCIpOwogICAgICAgICAgICByZXR1cm4gcmV0CiAgICAgICAgfQogICAgICAgIGludm9rZURvd25sb2FkKHVybCwgZmlsZW5hbWUpIHsKICAgICAgICAgICAgQzNYLlJlcXVpcmVTdHJpbmcodXJsKTsKICAgICAgICAgICAgQzNYLlJlcXVpcmVTdHJpbmcoZmlsZW5hbWUpOwogICAgICAgICAgICBydW50aW1lLkludm9rZURvd25sb2FkKHVybCwgZmlsZW5hbWUpCiAgICAgICAgfQogICAgICAgIGdldEluc3RhbmNlQnlVaWQodWlkKSB7CiAgICAgICAgICAgIEMzWC5SZXF1aXJlRmluaXRlTnVtYmVyKHVpZCk7CiAgICAgICAgICAgIGNvbnN0IHJldCA9IHJ1bnRpbWUuR2V0SW5zdGFuY2VCeVVJRCh1aWQpOwogICAgICAgICAgICByZXR1cm4gcmV0ID8gcmV0LkdldEludGVyZmFjZUNsYXNzKCkgOiBudWxsCiAgICAgICAgfQogICAgICAgIHNvcnRaT3JkZXIoaXRlcmFibGUsIGNhbGxiYWNrKSB7CiAgICAgICAgICAgIEMzWC5SZXF1aXJlRnVuY3Rpb24oY2FsbGJhY2spOwogICAgICAgICAgICBjb25zdCBsYXlvdXQgPSBydW50aW1lLkdldEN1cnJlbnRMYXlvdXQoKTsKICAgICAgICAgICAgZm9yIChjb25zdCBpaW5zdCBvZiBpdGVyYWJsZSkgewogICAgICAgICAgICAgICAgY29uc3QgaW5zdCA9IHJ1bnRpbWUuX1Vud3JhcElXb3JsZEluc3RhbmNlKGlpbnN0KTsKICAgICAgICAgICAgICAgIGNvbnN0IHdpID0gaW5zdC5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgICAgIHRlbXBaT3JkZXJMaXN0LnB1c2goW3dpLkdldExheWVyKCkuR2V0SW5kZXgoKSwKICAgICAgICAgICAgICAgICAgICB3aS5HZXRaSW5kZXgoKQogICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgICAgICB0ZW1wSW5zdGFuY2VzLnB1c2goaW5zdCkKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGVtcFpPcmRlckxpc3QubGVuZ3RoID09PSAwKSByZXR1cm47CiAgICAgICAgICAgIHRlbXBaT3JkZXJMaXN0LnNvcnQoU29ydFpPcmRlckxpc3QpOwogICAgICAgICAgICB0ZW1wSW5zdGFuY2VzLnNvcnQoKGEsIGIpID0+IGNhbGxiYWNrKGEuR2V0SW50ZXJmYWNlQ2xhc3MoKSwgYi5HZXRJbnRlcmZhY2VDbGFzcygpKSk7CiAgICAgICAgICAgIGxldCBhbnlDaGFuZ2VkID0gZmFsc2U7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSB0ZW1wWk9yZGVyTGlzdC5sZW5ndGg7IGkgPCBsZW47ICsraSkgewogICAgICAgICAgICAgICAgY29uc3QgaW5zdCA9IHRlbXBJbnN0YW5jZXNbaV07CiAgICAgICAgICAgICAgICBjb25zdCBsYXllciA9IGxheW91dC5HZXRMYXllckJ5SW5kZXgodGVtcFpPcmRlckxpc3RbaV1bMF0pOwogICAgICAgICAgICAgICAgY29uc3QgdG9aID0gdGVtcFpPcmRlckxpc3RbaV1bMV07CiAgICAgICAgICAgICAgICBjb25zdCBsYXllckluc3RhbmNlcyA9IGxheWVyLl9HZXRJbnN0YW5jZXMoKTsKICAgICAgICAgICAgICAgIGlmIChsYXllckluc3RhbmNlc1t0b1pdICE9PSBpbnN0KSB7CiAgICAgICAgICAgICAgICAgICAgbGF5ZXJJbnN0YW5jZXNbdG9aXSA9IGluc3Q7CiAgICAgICAgICAgICAgICAgICAgaW5zdC5HZXRXb3JsZEluZm8oKS5fU2V0TGF5ZXIobGF5ZXIsCiAgICAgICAgICAgICAgICAgICAgICAgIHRydWUpOwogICAgICAgICAgICAgICAgICAgIGxheWVyLlNldFpJbmRpY2VzQ2hhbmdlZCgpOwogICAgICAgICAgICAgICAgICAgIGFueUNoYW5nZWQgPSB0cnVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGFueUNoYW5nZWQpIHJ1bnRpbWUuVXBkYXRlUmVuZGVyKCk7CiAgICAgICAgICAgIEMzLmNsZWFyQXJyYXkodGVtcFpPcmRlckxpc3QpOwogICAgICAgICAgICBDMy5jbGVhckFycmF5KHRlbXBJbnN0YW5jZXMpCiAgICAgICAgfQogICAgICAgIGFzeW5jIGNyZWF0ZVdvcmtlcih1cmwsIG9wdHMpIHsKICAgICAgICAgICAgY29uc3QgbWVzc2FnZUNoYW5uZWwgPSBuZXcgTWVzc2FnZUNoYW5uZWw7CiAgICAgICAgICAgIGNvbnN0IHBvcnQxID0gbWVzc2FnZUNoYW5uZWwucG9ydDE7CiAgICAgICAgICAgIGNvbnN0IHBvcnQyID0gbWVzc2FnZUNoYW5uZWwucG9ydDI7CiAgICAgICAgICAgIGF3YWl0IHJ1bnRpbWUuUG9zdENvbXBvbmVudE1lc3NhZ2VUb0RPTUFzeW5jKCJydW50aW1lIiwgInNjcmlwdC1jcmVhdGUtd29ya2VyIiwgewogICAgICAgICAgICAgICAgInVybCI6IHVybCwKICAgICAgICAgICAgICAgICJvcHRzIjogb3B0cywKICAgICAgICAgICAgICAgICJwb3J0MiI6IHBvcnQyCiAgICAgICAgICAgIH0sIFtwb3J0Ml0pOwogICAgICAgICAgICByZXR1cm4gcG9ydDEKICAgICAgICB9CiAgICAgICAgYWxlcnQobWVzc2FnZSkgewogICAgICAgICAgICByZXR1cm4gcnVudGltZS5Qb3N0Q29tcG9uZW50TWVzc2FnZVRvRE9NQXN5bmMoInJ1bnRpbWUiLCAiYWxlcnQiLCB7CiAgICAgICAgICAgICAgICAibWVzc2FnZSI6IG1lc3NhZ2UgKwogICAgICAgICAgICAgICAgICAgIChydW50aW1lLklzSW5Xb3JrZXIoKSA/ICIgW3ZpYSBXZWIgV29ya2VyXSIgOiAiIikKICAgICAgICAgICAgfSkKICAgICAgICB9CiAgICB9OwoKfQoKLy8gaW50ZXJmYWNlcy9JQXNzZXRNYW5hZ2VyLmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIGNvbnN0IEMzWCA9IHNlbGYuQzNYOwogICAgbGV0IGFzc2V0TWFuYWdlciA9IG51bGw7CiAgICBzZWxmLklBc3NldE1hbmFnZXIgPSBjbGFzcyBJQXNzZXRNYW5hZ2VyIHsKICAgICAgICBjb25zdHJ1Y3Rvcihhc3NldE1hbmFnZXJfKSB7CiAgICAgICAgICAgIGFzc2V0TWFuYWdlciA9IGFzc2V0TWFuYWdlcl87CiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRoaXMsIHsKICAgICAgICAgICAgICAgIGlzV2ViTU9wdXNTdXBwb3J0ZWQ6IHsKICAgICAgICAgICAgICAgICAgICB2YWx1ZTogYXNzZXRNYW5hZ2VyLklzQXVkaW9Gb3JtYXRTdXBwb3J0ZWQoImF1ZGlvL3dlYm07IGNvZGVjcz1vcHVzIiksCiAgICAgICAgICAgICAgICAgICAgd3JpdGFibGU6IGZhbHNlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgfQogICAgICAgIGZldGNoVGV4dCh1cmwpIHsKICAgICAgICAgICAgcmV0dXJuIGFzc2V0TWFuYWdlci5GZXRjaFRleHQodXJsKQogICAgICAgIH0KICAgICAgICBmZXRjaEpzb24odXJsKSB7CiAgICAgICAgICAgIHJldHVybiBhc3NldE1hbmFnZXIuRmV0Y2hKc29uKHVybCkKICAgICAgICB9CiAgICAgICAgZmV0Y2hCbG9iKHVybCkgewogICAgICAgICAgICByZXR1cm4gYXNzZXRNYW5hZ2VyLkZldGNoQmxvYih1cmwpCiAgICAgICAgfQogICAgICAgIGZldGNoQXJyYXlCdWZmZXIodXJsKSB7CiAgICAgICAgICAgIHJldHVybiBhc3NldE1hbmFnZXIuRmV0Y2hBcnJheUJ1ZmZlcih1cmwpCiAgICAgICAgfQogICAgICAgIGdldFByb2plY3RGaWxlVXJsKHVybCkgewogICAgICAgICAgICByZXR1cm4gYXNzZXRNYW5hZ2VyLkdldFByb2plY3RGaWxlVXJsKHVybCkKICAgICAgICB9CiAgICAgICAgZ2V0TWVkaWFGaWxlVXJsKHVybCkgewogICAgICAgICAgICBpZiAoYXNzZXRNYW5hZ2VyLkdldEZpbGVTdHJ1Y3R1cmUoKSA9PT0gImZsYXQiICYmCiAgICAgICAgICAgICAgICBDMy5Jc1JlbGF0aXZlVVJMKHVybCkpIHVybCA9IHVybC50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICByZXR1cm4gYXNzZXRNYW5hZ2VyLkdldE1lZGlhRmlsZVVybCh1cmwpCiAgICAgICAgfQogICAgICAgIGdldCBtZWRpYUZvbGRlcigpIHsKICAgICAgICAgICAgcmV0dXJuIGFzc2V0TWFuYWdlci5HZXRNZWRpYVN1YmZvbGRlcigpCiAgICAgICAgfQogICAgICAgIGFzeW5jIGRlY29kZVdlYk1PcHVzKGF1ZGlvQ29udGV4dCwgYXJyYXlCdWZmZXIpIHsKICAgICAgICAgICAgaWYgKHRoaXMuaXNXZWJNT3B1c1N1cHBvcnRlZCkgdGhyb3cgbmV3IEVycm9yKCJkZWNvZGVXZWJNT3B1cygpOiBub3Qgc3VwcG9ydGVkIGJlY2F1c2UgV2ViTSBPcHVzIGlzIHN1cHBvcnRlZCBieSB0aGUgcGxhdGZvcm0iKTsKICAgICAgICAgICAgY29uc3QgZGVjb2RlZEFycmF5QnVmZmVyID0gYXdhaXQgYXNzZXRNYW5hZ2VyLkdldFJ1bnRpbWUoKS5fV2FzbURlY29kZVdlYk1PcHVzKGFycmF5QnVmZmVyKTsKICAgICAgICAgICAgY29uc3QgZGVjb2RlZEZsb2F0cyA9IG5ldyBGbG9hdDMyQXJyYXkoZGVjb2RlZEFycmF5QnVmZmVyKTsKICAgICAgICAgICAgY29uc3QgYXVkaW9CdWZmZXIgPSBhdWRpb0NvbnRleHRbImNyZWF0ZUJ1ZmZlciJdKDEsCiAgICAgICAgICAgICAgICBkZWNvZGVkRmxvYXRzLmxlbmd0aCwgNDhFMyk7CiAgICAgICAgICAgIGNvbnN0IGNoYW5uZWxCdWZmZXIgPSBhdWRpb0J1ZmZlclsiZ2V0Q2hhbm5lbERhdGEiXSgwKTsKICAgICAgICAgICAgY2hhbm5lbEJ1ZmZlci5zZXQoZGVjb2RlZEZsb2F0cyk7CiAgICAgICAgICAgIHJldHVybiBhdWRpb0J1ZmZlcgogICAgICAgIH0KICAgICAgICBsb2FkU2NyaXB0cyguLi51cmxzKSB7CiAgICAgICAgICAgIHJldHVybiBhc3NldE1hbmFnZXIuTG9hZFNjcmlwdHMoLi4udXJscykKICAgICAgICB9CiAgICAgICAgY29tcGlsZVdlYkFzc2VtYmx5KHVybCkgewogICAgICAgICAgICByZXR1cm4gYXNzZXRNYW5hZ2VyLkNvbXBpbGVXZWJBc3NlbWJseSh1cmwpCiAgICAgICAgfQogICAgICAgIGxvYWRTdHlsZVNoZWV0KHVybCkgewogICAgICAgICAgICByZXR1cm4gYXNzZXRNYW5hZ2VyLkxvYWRTdHlsZVNoZWV0KHVybCkKICAgICAgICB9CiAgICB9OwoKfQoKLy8gaW50ZXJmYWNlcy9JU3RvcmFnZS5qcwp7CiAgICAndXNlIHN0cmljdCc7CiAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICBjb25zdCBDM1ggPSBzZWxmLkMzWDsKICAgIHNlbGYuSVN0b3JhZ2UgPSBjbGFzcyBJU3RvcmFnZSB7CiAgICAgICAgY29uc3RydWN0b3IocnVudGltZSkgewogICAgICAgICAgICB0aGlzLl9zdG9yYWdlID0gcnVudGltZS5fR2V0UHJvamVjdFN0b3JhZ2UoKQogICAgICAgIH0KICAgICAgICBnZXRJdGVtKGtleSkgewogICAgICAgICAgICBDM1guUmVxdWlyZVN0cmluZyhrZXkpOwogICAgICAgICAgICByZXR1cm4gdGhpcy5fc3RvcmFnZS5nZXRJdGVtKGtleSkKICAgICAgICB9CiAgICAgICAgc2V0SXRlbShrZXksIHZhbHVlKSB7CiAgICAgICAgICAgIEMzWC5SZXF1aXJlU3RyaW5nKGtleSk7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zdG9yYWdlLnNldEl0ZW0oa2V5LCB2YWx1ZSkKICAgICAgICB9CiAgICAgICAgcmVtb3ZlSXRlbShrZXkpIHsKICAgICAgICAgICAgQzNYLlJlcXVpcmVTdHJpbmcoa2V5KTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3N0b3JhZ2UucmVtb3ZlSXRlbShrZXkpCiAgICAgICAgfQogICAgICAgIGNsZWFyKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fc3RvcmFnZS5jbGVhcigpCiAgICAgICAgfQogICAgICAgIGtleXMoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zdG9yYWdlLmtleXMoKQogICAgICAgIH0KICAgIH07Cgp9CgovLyBpbnRlcmZhY2VzL0lPYmplY3RDbGFzcy5qcwp7CiAgICAndXNlIHN0cmljdCc7CiAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICBjb25zdCBDM1ggPSBzZWxmLkMzWDsKICAgIGNvbnN0IG1hcCA9IG5ldyBXZWFrTWFwOwogICAgc2VsZi5JT2JqZWN0Q2xhc3MgPSBjbGFzcyBJT2JqZWN0Q2xhc3MgewogICAgICAgIGNvbnN0cnVjdG9yKG9iamVjdENsYXNzKSB7CiAgICAgICAgICAgIG1hcC5zZXQodGhpcywgb2JqZWN0Q2xhc3MpOwogICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0aGlzLCB7CiAgICAgICAgICAgICAgICBuYW1lOiB7CiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IG9iamVjdENsYXNzLkdldE5hbWUoKSwKICAgICAgICAgICAgICAgICAgICB3cml0YWJsZTogZmFsc2UKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIG9iamVjdENsYXNzLkdldFJ1bnRpbWUoKS5fTWFwU2NyaXB0SW50ZXJmYWNlKHRoaXMsIG9iamVjdENsYXNzKQogICAgICAgIH0KICAgICAgICBhZGRFdmVudExpc3RlbmVyKHR5cGUsIGZ1bmMpIHsKICAgICAgICAgICAgQzNYLlJlcXVpcmVTdHJpbmcodHlwZSk7CiAgICAgICAgICAgIEMzWC5SZXF1aXJlRnVuY3Rpb24oZnVuYyk7CiAgICAgICAgICAgIG1hcC5nZXQodGhpcykuVXNlclNjcmlwdERpc3BhdGNoZXIoKS5hZGRFdmVudExpc3RlbmVyKHR5cGUsIGZ1bmMpCiAgICAgICAgfQogICAgICAgIHJlbW92ZUV2ZW50TGlzdGVuZXIodHlwZSwgZnVuYykgewogICAgICAgICAgICBDM1guUmVxdWlyZVN0cmluZyh0eXBlKTsKICAgICAgICAgICAgQzNYLlJlcXVpcmVGdW5jdGlvbihmdW5jKTsKICAgICAgICAgICAgbWFwLmdldCh0aGlzKS5Vc2VyU2NyaXB0RGlzcGF0Y2hlcigpLnJlbW92ZUV2ZW50TGlzdGVuZXIodHlwZSwKICAgICAgICAgICAgICAgIGZ1bmMpCiAgICAgICAgfQogICAgICAgIGdldEFsbEluc3RhbmNlcygpIHsKICAgICAgICAgICAgcmV0dXJuIFsuLi50aGlzLmluc3RhbmNlcygpXQogICAgICAgIH0KICAgICAgICBnZXRGaXJzdEluc3RhbmNlKCkgewogICAgICAgICAgICByZXR1cm4gQzMuZmlyc3QodGhpcy5pbnN0YW5jZXMoKSkKICAgICAgICB9CiAgICAgICAgZ2V0UGlja2VkSW5zdGFuY2VzKCkgewogICAgICAgICAgICByZXR1cm4gWy4uLnRoaXMucGlja2VkSW5zdGFuY2VzKCldCiAgICAgICAgfQogICAgICAgIGdldEZpcnN0UGlja2VkSW5zdGFuY2UoKSB7CiAgICAgICAgICAgIHJldHVybiBDMy5maXJzdCh0aGlzLnBpY2tlZEluc3RhbmNlcygpKQogICAgICAgIH0qIGluc3RhbmNlcygpIHsKICAgICAgICAgICAgZm9yIChjb25zdCBpbnN0IG9mIG1hcC5nZXQodGhpcykuaW5zdGFuY2VzSW5jbHVkaW5nUGVuZGluZ0NyZWF0ZSgpKSB5aWVsZCBpbnN0LkdldEludGVyZmFjZUNsYXNzKCkKICAgICAgICB9KiBwaWNrZWRJbnN0YW5jZXMoKSB7CiAgICAgICAgICAgIGZvciAoY29uc3QgaW5zdCBvZiBtYXAuZ2V0KHRoaXMpLkdldEN1cnJlbnRTb2woKS5HZXRJbnN0YW5jZXMoKSkgeWllbGQgaW5zdC5HZXRJbnRlcmZhY2VDbGFzcygpCiAgICAgICAgfQogICAgICAgIHNldEluc3RhbmNlQ2xhc3MoQ2xhc3MpIHsKICAgICAgICAgICAgQzNYLlJlcXVpcmVGdW5jdGlvbihDbGFzcyk7CiAgICAgICAgICAgIGNvbnN0IG9iamVjdENsYXNzID0KICAgICAgICAgICAgICAgIG1hcC5nZXQodGhpcyk7CiAgICAgICAgICAgIGlmIChvYmplY3RDbGFzcy5HZXRJbnN0YW5jZUNvdW50KCkgPiAwKSB0aHJvdyBuZXcgRXJyb3IoInNldEluc3RhbmNlQ2xhc3MoKSBjYWxsZWQgdG9vIGxhdGUsIGJlY2F1c2UgaW5zdGFuY2VzIGhhdmUgYWxyZWFkeSBiZWVuIGNyZWF0ZWQgLSBjYWxsIGluIHJ1bk9uU3RhcnR1cCIpOwogICAgICAgICAgICBtYXAuZ2V0KHRoaXMpLl9TZXRVc2VyU2NyaXB0SW5zdGFuY2VDbGFzcyhDbGFzcykKICAgICAgICB9CiAgICAgICAgY3JlYXRlSW5zdGFuY2UobGF5ZXJOYW1lT3JJbmRleCwgeCwgeSwgY3JlYXRlSGllcmFyY2h5LCB0ZW1wbGF0ZSkgewogICAgICAgICAgICBDM1guUmVxdWlyZU51bWJlcih4KTsKICAgICAgICAgICAgQzNYLlJlcXVpcmVOdW1iZXIoeSk7CiAgICAgICAgICAgIGlmICh0eXBlb2YgbGF5ZXJOYW1lT3JJbmRleCAhPT0gIm51bWJlciIgJiYgdHlwZW9mIGxheWVyTmFtZU9ySW5kZXggIT09ICJzdHJpbmciKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJpbnZhbGlkIGxheWVyIHBhcmFtZXRlciIpOwogICAgICAgICAgICBjb25zdCBvYmplY3RDbGFzcyA9IG1hcC5nZXQodGhpcyk7CiAgICAgICAgICAgIGNvbnN0IHJ1bnRpbWUgPSBvYmplY3RDbGFzcy5HZXRSdW50aW1lKCk7CiAgICAgICAgICAgIGNvbnN0IGxheWVyID0gcnVudGltZS5HZXRNYWluUnVubmluZ0xheW91dCgpLkdldExheWVyKGxheWVyTmFtZU9ySW5kZXgpOwogICAgICAgICAgICBpZiAoIWxheWVyKSB0aHJvdyBuZXcgRXJyb3IoImludmFsaWQgbGF5ZXIiKTsKICAgICAgICAgICAgY29uc3QgaW5zdCA9IHJ1bnRpbWUuQ3JlYXRlSW5zdGFuY2Uob2JqZWN0Q2xhc3MsIGxheWVyLCB4LCB5LCBjcmVhdGVIaWVyYXJjaHksIHRlbXBsYXRlKTsKICAgICAgICAgICAgaWYgKGNyZWF0ZUhpZXJhcmNoeSkgbGF5ZXIuU29ydEFuZEFkZEluc3RhbmNlc0J5WkluZGV4KGluc3QpOwogICAgICAgICAgICBjb25zdCBldmVudFNoZWV0TWFuYWdlciA9IHJ1bnRpbWUuR2V0RXZlbnRTaGVldE1hbmFnZXIoKTsKICAgICAgICAgICAgZXZlbnRTaGVldE1hbmFnZXIuQmxvY2tGbHVzaGluZ0luc3RhbmNlcyh0cnVlKTsKICAgICAgICAgICAgaW5zdC5fVHJpZ2dlck9uQ3JlYXRlZE9uU2VsZkFuZFJlbGF0ZWQoKTsKICAgICAgICAgICAgZXZlbnRTaGVldE1hbmFnZXIuQmxvY2tGbHVzaGluZ0luc3RhbmNlcyhmYWxzZSk7CiAgICAgICAgICAgIGlmICghZXZlbnRTaGVldE1hbmFnZXIuSXNJbkV2ZW50RW5naW5lKCkgJiYgIXJ1bnRpbWUuR2V0TGF5b3V0TWFuYWdlcigpLklzRW5kaW5nTGF5b3V0KCkpIHJ1bnRpbWUuRmx1c2hQZW5kaW5nSW5zdGFuY2VzKCk7CiAgICAgICAgICAgIHJldHVybiBpbnN0LkdldEludGVyZmFjZUNsYXNzKCkKICAgICAgICB9CiAgICB9OwoKfQoKLy8gaW50ZXJmYWNlcy9JTGF5b3V0LmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIGNvbnN0IEMzWCA9IHNlbGYuQzNYOwogICAgY29uc3QgbWFwID0gbmV3IFdlYWtNYXA7CiAgICBzZWxmLklMYXlvdXQgPSBjbGFzcyBJTGF5b3V0IHsKICAgICAgICBjb25zdHJ1Y3RvcihsYXlvdXQpIHsKICAgICAgICAgICAgbWFwLnNldCh0aGlzLCBsYXlvdXQpOwogICAgICAgICAgICBjb25zdCBlZmZlY3RJbnN0YW5jZUFyciA9IFtdOwogICAgICAgICAgICBjb25zdCBlZmZlY3RMaXN0ID0gbGF5b3V0LkdldEVmZmVjdExpc3QoKTsKICAgICAgICAgICAgY29uc3QgZWZmZWN0Q291bnQgPSBlZmZlY3RMaXN0LkdldEFsbEVmZmVjdFR5cGVzKCkubGVuZ3RoOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGVmZmVjdENvdW50OyArK2kpIGVmZmVjdEluc3RhbmNlQXJyLnB1c2gobmV3IHNlbGYuSUVmZmVjdEluc3RhbmNlKGVmZmVjdExpc3QsIGkpKTsKICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGhpcywgewogICAgICAgICAgICAgICAgbmFtZTogewogICAgICAgICAgICAgICAgICAgIHZhbHVlOiBsYXlvdXQuR2V0TmFtZSgpLAogICAgICAgICAgICAgICAgICAgIHdyaXRhYmxlOiBmYWxzZQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGluZGV4OiB7CiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGxheW91dC5HZXRJbmRleCgpLAogICAgICAgICAgICAgICAgICAgIHdyaXRhYmxlOiBmYWxzZQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGVmZmVjdHM6IHsKICAgICAgICAgICAgICAgICAgICB2YWx1ZTogZWZmZWN0SW5zdGFuY2VBcnIsCiAgICAgICAgICAgICAgICAgICAgd3JpdGFibGU6IGZhbHNlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgfQogICAgICAgIGFkZEV2ZW50TGlzdGVuZXIodHlwZSwgZnVuYykgewogICAgICAgICAgICBDM1guUmVxdWlyZVN0cmluZyh0eXBlKTsKICAgICAgICAgICAgQzNYLlJlcXVpcmVGdW5jdGlvbihmdW5jKTsKICAgICAgICAgICAgbWFwLmdldCh0aGlzKS5Vc2VyU2NyaXB0RGlzcGF0Y2hlcigpLmFkZEV2ZW50TGlzdGVuZXIodHlwZSwgZnVuYykKICAgICAgICB9CiAgICAgICAgcmVtb3ZlRXZlbnRMaXN0ZW5lcih0eXBlLCBmdW5jKSB7CiAgICAgICAgICAgIEMzWC5SZXF1aXJlU3RyaW5nKHR5cGUpOwogICAgICAgICAgICBDM1guUmVxdWlyZUZ1bmN0aW9uKGZ1bmMpOwogICAgICAgICAgICBtYXAuZ2V0KHRoaXMpLlVzZXJTY3JpcHREaXNwYXRjaGVyKCkucmVtb3ZlRXZlbnRMaXN0ZW5lcih0eXBlLCBmdW5jKQogICAgICAgIH0KICAgICAgICBnZXQgd2lkdGgoKSB7CiAgICAgICAgICAgIHJldHVybiBtYXAuZ2V0KHRoaXMpLkdldFdpZHRoKCkKICAgICAgICB9CiAgICAgICAgc2V0IHdpZHRoKHcpIHsKICAgICAgICAgICAgQzNYLlJlcXVpcmVGaW5pdGVOdW1iZXIodyk7CiAgICAgICAgICAgIG1hcC5nZXQodGhpcykuU2V0V2lkdGgodykKICAgICAgICB9CiAgICAgICAgZ2V0IGhlaWdodCgpIHsKICAgICAgICAgICAgcmV0dXJuIG1hcC5nZXQodGhpcykuR2V0SGVpZ2h0KCkKICAgICAgICB9CiAgICAgICAgc2V0IGhlaWdodChoKSB7CiAgICAgICAgICAgIEMzWC5SZXF1aXJlRmluaXRlTnVtYmVyKGgpOwogICAgICAgICAgICBtYXAuZ2V0KHRoaXMpLlNldEhlaWdodChoKQogICAgICAgIH0KICAgICAgICBzZXRTaXplKHcsIGgpIHsKICAgICAgICAgICAgQzNYLlJlcXVpcmVGaW5pdGVOdW1iZXIodyk7CiAgICAgICAgICAgIEMzWC5SZXF1aXJlRmluaXRlTnVtYmVyKGgpOwogICAgICAgICAgICBjb25zdCBsYXlvdXQgPSBtYXAuZ2V0KHRoaXMpOwogICAgICAgICAgICBsYXlvdXQuU2V0V2lkdGgodyk7CiAgICAgICAgICAgIGxheW91dC5TZXRIZWlnaHQoaCkKICAgICAgICB9CiAgICAgICAgZ2V0U2l6ZSgpIHsKICAgICAgICAgICAgY29uc3QgbGF5b3V0ID0gbWFwLmdldCh0aGlzKTsKICAgICAgICAgICAgcmV0dXJuIFtsYXlvdXQuR2V0V2lkdGgoKSwgbGF5b3V0LkdldEhlaWdodCgpXQogICAgICAgIH0KICAgICAgICBzZXQgc2NhbGUocykgewogICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcihzKTsKICAgICAgICAgICAgbWFwLmdldCh0aGlzKS5TZXRTY2FsZShzKQogICAgICAgIH0KICAgICAgICBnZXQgc2NhbGUoKSB7CiAgICAgICAgICAgIHJldHVybiBtYXAuZ2V0KHRoaXMpLkdldFNjYWxlKCkKICAgICAgICB9CiAgICAgICAgc2V0IGFuZ2xlKGEpIHsKICAgICAgICAgICAgQzNYLlJlcXVpcmVGaW5pdGVOdW1iZXIoYSk7CiAgICAgICAgICAgIG1hcC5nZXQodGhpcykuU2V0QW5nbGUoYSkKICAgICAgICB9CiAgICAgICAgZ2V0IGFuZ2xlKCkgewogICAgICAgICAgICByZXR1cm4gbWFwLmdldCh0aGlzKS5HZXRBbmdsZSgpCiAgICAgICAgfQogICAgICAgIHNldCBzY3JvbGxYKHgpIHsKICAgICAgICAgICAgQzNYLlJlcXVpcmVOdW1iZXIoeCk7CiAgICAgICAgICAgIG1hcC5nZXQodGhpcykuU2V0U2Nyb2xsWCh4KQogICAgICAgIH0KICAgICAgICBnZXQgc2Nyb2xsWCgpIHsKICAgICAgICAgICAgcmV0dXJuIG1hcC5nZXQodGhpcykuR2V0U2Nyb2xsWCgpCiAgICAgICAgfQogICAgICAgIHNldCBzY3JvbGxZKHkpIHsKICAgICAgICAgICAgQzNYLlJlcXVpcmVOdW1iZXIoeSk7CiAgICAgICAgICAgIG1hcC5nZXQodGhpcykuU2V0U2Nyb2xsWSh5KQogICAgICAgIH0KICAgICAgICBnZXQgc2Nyb2xsWSgpIHsKICAgICAgICAgICAgcmV0dXJuIG1hcC5nZXQodGhpcykuR2V0U2Nyb2xsWSgpCiAgICAgICAgfQogICAgICAgIHNjcm9sbFRvKHgsIHkpIHsKICAgICAgICAgICAgQzNYLlJlcXVpcmVOdW1iZXIoeCk7CiAgICAgICAgICAgIEMzWC5SZXF1aXJlTnVtYmVyKHkpOwogICAgICAgICAgICBjb25zdCBsYXlvdXQgPSBtYXAuZ2V0KHRoaXMpOwogICAgICAgICAgICBsYXlvdXQuU2V0U2Nyb2xsWCh4KTsKICAgICAgICAgICAgbGF5b3V0LlNldFNjcm9sbFkoeSkKICAgICAgICB9CiAgICAgICAgZ2V0U2Nyb2xsUG9zaXRpb24oKSB7CiAgICAgICAgICAgIGNvbnN0IGxheW91dCA9IG1hcC5nZXQodGhpcyk7CiAgICAgICAgICAgIHJldHVybiBbbGF5b3V0LkdldFNjcm9sbFgoKSwgbGF5b3V0LkdldFNjcm9sbFkoKV0KICAgICAgICB9CiAgICAgICAgZ2V0TGF5ZXIobmFtZU9ySW5kZXgpIHsKICAgICAgICAgICAgY29uc3QgbGF5b3V0ID0gbWFwLmdldCh0aGlzKTsKICAgICAgICAgICAgbGV0IGxheWVyID0gbnVsbDsKICAgICAgICAgICAgaWYgKHR5cGVvZiBuYW1lT3JJbmRleCA9PT0gIm51bWJlciIgfHwgdHlwZW9mIG5hbWVPckluZGV4ID09PSAic3RyaW5nIikgbGF5ZXIgPSBsYXlvdXQuR2V0TGF5ZXIobmFtZU9ySW5kZXgpOwogICAgICAgICAgICBlbHNlIHRocm93IG5ldyBUeXBlRXJyb3IoImV4cGVjdGVkIHN0cmluZyBvciBudW1iZXIiKTsKICAgICAgICAgICAgaWYgKCFsYXllcikgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIHJldHVybiBsYXllci5HZXRJTGF5ZXIoKQogICAgICAgIH0KICAgICAgICBnZXRBbGxMYXllcnMoKSB7CiAgICAgICAgICAgIHJldHVybiBtYXAuZ2V0KHRoaXMpLkdldExheWVycygpLm1hcChsYXllciA9PiBsYXllci5HZXRJTGF5ZXIoKSkKICAgICAgICB9KiBhbGxMYXllcnMoKSB7CiAgICAgICAgICAgIGZvciAoY29uc3QgbGF5ZXIgb2YgbWFwLmdldCh0aGlzKS5hbGxMYXllcnMoKSkgeWllbGQgbGF5ZXIuR2V0SUxheWVyKCkKICAgICAgICB9CiAgICAgICAgc2V0VmFuaXNoaW5nUG9pbnQodnBYLCB2cFkpIHsKICAgICAgICAgICAgQzNYLlJlcXVpcmVGaW5pdGVOdW1iZXIodnBYKTsKICAgICAgICAgICAgQzNYLlJlcXVpcmVGaW5pdGVOdW1iZXIodnBZKTsKICAgICAgICAgICAgbWFwLmdldCh0aGlzKS5TZXRWYW5pc2hpbmdQb2ludFhZKHZwWCwgdnBZKQogICAgICAgIH0KICAgICAgICBnZXRWYW5pc2hpbmdQb2ludCgpIHsKICAgICAgICAgICAgcmV0dXJuIG1hcC5nZXQodGhpcykuX0dldFZhbmlzaGluZ1BvaW50KCkKICAgICAgICB9CiAgICAgICAgc2V0IHByb2plY3Rpb24ocCkgewogICAgICAgICAgICBDM1guUmVxdWlyZVN0cmluZyhwKTsKICAgICAgICAgICAgY29uc3QgbGF5b3V0ID0gbWFwLmdldCh0aGlzKTsKICAgICAgICAgICAgaWYgKHAgPT09ICJwZXJzcGVjdGl2ZSIpIGxheW91dC5TZXRQZXJzcGVjdGl2ZVByb2plY3Rpb24oKTsKICAgICAgICAgICAgZWxzZSBpZiAocCA9PT0gIm9ydGhvZ3JhcGhpYyIpIGxheW91dC5TZXRPcnRob2dyYXBoaWNQcm9qZWN0aW9uKCk7CiAgICAgICAgICAgIGVsc2UgdGhyb3cgbmV3IEVycm9yKCJpbnZhbGlkIHByb2plY3Rpb24iKTsKICAgICAgICB9CiAgICAgICAgZ2V0IHByb2plY3Rpb24oKSB7CiAgICAgICAgICAgIGlmIChtYXAuZ2V0KHRoaXMpLklzT3J0aG9ncmFwaGljUHJvamVjdGlvbigpKSByZXR1cm4gIm9ydGhvZ3JhcGhpYyI7CiAgICAgICAgICAgIGVsc2UgcmV0dXJuICJwZXJzcGVjdGl2ZSIKICAgICAgICB9CiAgICB9OwoKfQoKLy8gaW50ZXJmYWNlcy9JTGF5ZXIuanMKewogICAgJ3VzZSBzdHJpY3QnOwogICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgY29uc3QgQzNYID0gc2VsZi5DM1g7CiAgICBjb25zdCBtYXAgPSBuZXcgV2Vha01hcDsKICAgIGNvbnN0IEJMRU5EX01PREVfVE9fSU5ERVggPSBuZXcgTWFwKFsKICAgICAgICBbIm5vcm1hbCIsIDBdLAogICAgICAgIFsiYWRkaXRpdmUiLCAxXSwKICAgICAgICBbImNvcHkiLCAzXSwKICAgICAgICBbImRlc3RpbmF0aW9uLW92ZXIiLCA0XSwKICAgICAgICBbInNvdXJjZS1pbiIsIDVdLAogICAgICAgIFsiZGVzdGluYXRpb24taW4iLCA2XSwKICAgICAgICBbInNvdXJjZS1vdXQiLCA3XSwKICAgICAgICBbImRlc3RpbmF0aW9uLW91dCIsIDhdLAogICAgICAgIFsic291cmNlLWF0b3AiLCA5XSwKICAgICAgICBbImRlc3RpbmF0aW9uLWF0b3AiLCAxMF0KICAgIF0pOwogICAgY29uc3QgSU5ERVhfVE9fQkxFTkRfTU9ERSA9IG5ldyBNYXAoWy4uLkJMRU5EX01PREVfVE9fSU5ERVguZW50cmllcygpXS5tYXAoYSA9PiBbYVsxXSwgYVswXV0pKTsKICAgIGNvbnN0IHRlbXBDb2xvciA9IEMzLk5ldyhDMy5Db2xvcik7CiAgICBzZWxmLklMYXllciA9IGNsYXNzIElMYXllciB7CiAgICAgICAgY29uc3RydWN0b3IobGF5ZXIpIHsKICAgICAgICAgICAgbWFwLnNldCh0aGlzLCBsYXllcik7CiAgICAgICAgICAgIGNvbnN0IGVmZmVjdEluc3RhbmNlQXJyID0gW107CiAgICAgICAgICAgIGNvbnN0IGVmZmVjdExpc3QgPSBsYXllci5HZXRFZmZlY3RMaXN0KCk7CiAgICAgICAgICAgIGNvbnN0IGVmZmVjdENvdW50ID0gZWZmZWN0TGlzdC5HZXRBbGxFZmZlY3RUeXBlcygpLmxlbmd0aDsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBlZmZlY3RDb3VudDsgKytpKSBlZmZlY3RJbnN0YW5jZUFyci5wdXNoKG5ldyBzZWxmLklFZmZlY3RJbnN0YW5jZShlZmZlY3RMaXN0LCBpKSk7CiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRoaXMsIHsKICAgICAgICAgICAgICAgIG5hbWU6IHsKICAgICAgICAgICAgICAgICAgICB2YWx1ZTogbGF5ZXIuR2V0TmFtZSgpLAogICAgICAgICAgICAgICAgICAgIHdyaXRhYmxlOiBmYWxzZQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGluZGV4OiB7CiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGxheWVyLkdldEluZGV4KCksCiAgICAgICAgICAgICAgICAgICAgd3JpdGFibGU6IGZhbHNlCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgbGF5b3V0OiB7CiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGxheWVyLkdldExheW91dCgpLkdldElMYXlvdXQoKSwKICAgICAgICAgICAgICAgICAgICB3cml0YWJsZTogZmFsc2UKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBlZmZlY3RzOiB7CiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGVmZmVjdEluc3RhbmNlQXJyLAogICAgICAgICAgICAgICAgICAgIHdyaXRhYmxlOiBmYWxzZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgIH0KICAgICAgICBzdGF0aWMgX1Vud3JhcChpbGF5ZXIpIHsKICAgICAgICAgICAgcmV0dXJuIG1hcC5nZXQoaWxheWVyKQogICAgICAgIH0KICAgICAgICBnZXQgcGFyZW50TGF5ZXIoKSB7CiAgICAgICAgICAgIGNvbnN0IHBhcmVudCA9CiAgICAgICAgICAgICAgICBtYXAuZ2V0KHRoaXMpLkdldFBhcmVudExheWVyKCk7CiAgICAgICAgICAgIHJldHVybiBwYXJlbnQgPyBwYXJlbnQuR2V0SUxheWVyKCkgOiBudWxsCiAgICAgICAgfSogcGFyZW50TGF5ZXJzKCkgewogICAgICAgICAgICBmb3IgKGNvbnN0IHBhcmVudCBvZiBtYXAuZ2V0KHRoaXMpLnBhcmVudExheWVycygpKSB5aWVsZCBwYXJlbnQuR2V0SUxheWVyKCkKICAgICAgICB9KiBzdWJMYXllcnMoKSB7CiAgICAgICAgICAgIGZvciAoY29uc3QgbGF5ZXIgb2YgbWFwLmdldCh0aGlzKS5HZXRTdWJMYXllcnMoKSkgeWllbGQgbGF5ZXIuR2V0SUxheWVyKCkKICAgICAgICB9KiBhbGxTdWJMYXllcnMoKSB7CiAgICAgICAgICAgIGZvciAoY29uc3Qgc3ViTGF5ZXIgb2YgbWFwLmdldCh0aGlzKS5HZXRTdWJMYXllcnMoKSkKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgbGF5ZXIgb2Ygc3ViTGF5ZXIuc2VsZkFuZEFsbFN1YkxheWVycygpKSB5aWVsZCBsYXllci5HZXRJTGF5ZXIoKQogICAgICAgIH0KICAgICAgICBnZXQgaXNWaXNpYmxlKCkgewogICAgICAgICAgICByZXR1cm4gbWFwLmdldCh0aGlzKS5fSXNWaXNpYmxlRmxhZ1NldCgpCiAgICAgICAgfQogICAgICAgIHNldCBpc1Zpc2libGUodikgewogICAgICAgICAgICBtYXAuZ2V0KHRoaXMpLlNldFZpc2libGUodikKICAgICAgICB9CiAgICAgICAgZ2V0IGlzU2VsZkFuZFBhcmVudHNWaXNpYmxlKCkgewogICAgICAgICAgICByZXR1cm4gbWFwLmdldCh0aGlzKS5Jc1Zpc2libGUoKQogICAgICAgIH0KICAgICAgICBnZXQgaXNJbnRlcmFjdGl2ZSgpIHsKICAgICAgICAgICAgcmV0dXJuIG1hcC5nZXQodGhpcykuSXNJbnRlcmFjdGl2ZSgpCiAgICAgICAgfQogICAgICAgIHNldCBpc0ludGVyYWN0aXZlKGkpIHsKICAgICAgICAgICAgbWFwLmdldCh0aGlzKS5TZXRJbnRlcmFjdGl2ZShpKQogICAgICAgIH0KICAgICAgICBnZXQgaXNTZWxmQW5kUGFyZW50c0ludGVyYWN0aXZlKCkgewogICAgICAgICAgICByZXR1cm4gbWFwLmdldCh0aGlzKS5Jc1NlbGZBbmRQYXJlbnRzSW50ZXJhY3RpdmUoKQogICAgICAgIH0KICAgICAgICBnZXQgb3BhY2l0eSgpIHsKICAgICAgICAgICAgcmV0dXJuIG1hcC5nZXQodGhpcykuR2V0T3BhY2l0eSgpCiAgICAgICAgfQogICAgICAgIHNldCBvcGFjaXR5KG8pIHsKICAgICAgICAgICAgbyA9CiAgICAgICAgICAgICAgICBDMy5jbGFtcCgrbywgMCwgMSk7CiAgICAgICAgICAgIGlmIChpc05hTihvKSkgcmV0dXJuOwogICAgICAgICAgICBtYXAuZ2V0KHRoaXMpLlNldE9wYWNpdHkobykKICAgICAgICB9CiAgICAgICAgc2V0IHNjYWxlKHMpIHsKICAgICAgICAgICAgQzNYLlJlcXVpcmVGaW5pdGVOdW1iZXIocyk7CiAgICAgICAgICAgIG1hcC5nZXQodGhpcykuU2V0T3duU2NhbGUocykKICAgICAgICB9CiAgICAgICAgZ2V0IHNjYWxlKCkgewogICAgICAgICAgICByZXR1cm4gbWFwLmdldCh0aGlzKS5HZXRPd25TY2FsZSgpCiAgICAgICAgfQogICAgICAgIHNldCBzY2FsZVJhdGUocikgewogICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcihyKTsKICAgICAgICAgICAgbWFwLmdldCh0aGlzKS5TZXRTY2FsZVJhdGUocikKICAgICAgICB9CiAgICAgICAgZ2V0IHNjYWxlUmF0ZSgpIHsKICAgICAgICAgICAgcmV0dXJuIG1hcC5nZXQodGhpcykuR2V0U2NhbGVSYXRlKCkKICAgICAgICB9CiAgICAgICAgc2V0IGFuZ2xlKGEpIHsKICAgICAgICAgICAgQzNYLlJlcXVpcmVGaW5pdGVOdW1iZXIoYSk7CiAgICAgICAgICAgIG1hcC5nZXQodGhpcykuU2V0QW5nbGUoYSkKICAgICAgICB9CiAgICAgICAgZ2V0IGFuZ2xlKCkgewogICAgICAgICAgICByZXR1cm4gbWFwLmdldCh0aGlzKS5HZXRPd25BbmdsZSgpCiAgICAgICAgfQogICAgICAgIHNldCBwYXJhbGxheFgocCkgewogICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcihwKTsKICAgICAgICAgICAgbWFwLmdldCh0aGlzKS5TZXRQYXJhbGxheFgocCkKICAgICAgICB9CiAgICAgICAgZ2V0IHBhcmFsbGF4WCgpIHsKICAgICAgICAgICAgcmV0dXJuIG1hcC5nZXQodGhpcykuR2V0UGFyYWxsYXhYKCkKICAgICAgICB9CiAgICAgICAgc2V0IHBhcmFsbGF4WShwKSB7CiAgICAgICAgICAgIEMzWC5SZXF1aXJlRmluaXRlTnVtYmVyKHApOwogICAgICAgICAgICBtYXAuZ2V0KHRoaXMpLlNldFBhcmFsbGF4WShwKQogICAgICAgIH0KICAgICAgICBnZXQgcGFyYWxsYXhZKCkgewogICAgICAgICAgICByZXR1cm4gbWFwLmdldCh0aGlzKS5HZXRQYXJhbGxheFkoKQogICAgICAgIH0KICAgICAgICBzZXQgekVsZXZhdGlvbih6KSB7CiAgICAgICAgICAgIEMzWC5SZXF1aXJlRmluaXRlTnVtYmVyKHopOwogICAgICAgICAgICBtYXAuZ2V0KHRoaXMpLlNldFpFbGV2YXRpb24oeikKICAgICAgICB9CiAgICAgICAgZ2V0IHpFbGV2YXRpb24oKSB7CiAgICAgICAgICAgIHJldHVybiBtYXAuZ2V0KHRoaXMpLkdldFpFbGV2YXRpb24oKQogICAgICAgIH0KICAgICAgICBzZXQgaXNUcmFuc3BhcmVudCh0KSB7CiAgICAgICAgICAgIG1hcC5nZXQodGhpcykuU2V0VHJhbnNwYXJlbnQodCkKICAgICAgICB9CiAgICAgICAgZ2V0IGlzVHJhbnNwYXJlbnQoKSB7CiAgICAgICAgICAgIHJldHVybiBtYXAuZ2V0KHRoaXMpLklzVHJhbnNwYXJlbnQoKQogICAgICAgIH0KICAgICAgICBzZXQgaXNGb3JjZU93blRleHR1cmUoZikgewogICAgICAgICAgICBtYXAuZ2V0KHRoaXMpLlNldEZvcmNlT3duVGV4dHVyZShmKQogICAgICAgIH0KICAgICAgICBnZXQgaXNGb3JjZU93blRleHR1cmUoKSB7CiAgICAgICAgICAgIHJldHVybiBtYXAuZ2V0KHRoaXMpLklzRm9yY2VPd25UZXh0dXJlKCkKICAgICAgICB9CiAgICAgICAgc2V0IGJsZW5kTW9kZShibSkgewogICAgICAgICAgICBDM1guUmVxdWlyZVN0cmluZyhibSk7CiAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gQkxFTkRfTU9ERV9UT19JTkRFWC5nZXQoYm0pOwogICAgICAgICAgICBpZiAodHlwZW9mIGluZGV4ICE9PSAibnVtYmVyIikgdGhyb3cgbmV3IEVycm9yKCJpbnZhbGlkIGJsZW5kIG1vZGUiKTsKICAgICAgICAgICAgbWFwLmdldCh0aGlzKS5TZXRCbGVuZE1vZGUoaW5kZXgpCiAgICAgICAgfQogICAgICAgIGdldCBibGVuZE1vZGUoKSB7CiAgICAgICAgICAgIHJldHVybiBJTkRFWF9UT19CTEVORF9NT0RFLmdldChtYXAuZ2V0KHRoaXMpLkdldEJsZW5kTW9kZSgpKQogICAgICAgIH0KICAgICAgICBzZXQgYmFja2dyb3VuZENvbG9yKGFycikgewogICAgICAgICAgICBDM1guUmVxdWlyZUFycmF5KGFycik7CiAgICAgICAgICAgIGlmIChhcnIubGVuZ3RoIDwgMykgdGhyb3cgbmV3IEVycm9yKCJleHBlY3RlZCAzIGVsZW1lbnRzIik7CiAgICAgICAgICAgIHRlbXBDb2xvci5zZXRSZ2IoYXJyWzBdLCBhcnJbMV0sIGFyclsyXSk7CiAgICAgICAgICAgIGNvbnN0IGxheWVyID0gbWFwLmdldCh0aGlzKTsKICAgICAgICAgICAgY29uc3QgYmdDb2xvciA9IGxheWVyLkdldEJhY2tncm91bmRDb2xvcigpOwogICAgICAgICAgICBpZiAoYmdDb2xvci5lcXVhbHNJZ25vcmluZ0FscGhhKHRlbXBDb2xvcikpIHJldHVybjsKICAgICAgICAgICAgYmdDb2xvci5jb3B5UmdiKHRlbXBDb2xvcik7CiAgICAgICAgICAgIGxheWVyLkdldFJ1bnRpbWUoKS5VcGRhdGVSZW5kZXIoKQogICAgICAgIH0KICAgICAgICBnZXQgYmFja2dyb3VuZENvbG9yKCkgewogICAgICAgICAgICBjb25zdCBjID0KICAgICAgICAgICAgICAgIG1hcC5nZXQodGhpcykuR2V0QmFja2dyb3VuZENvbG9yKCk7CiAgICAgICAgICAgIHJldHVybiBbYy5nZXRSKCksIGMuZ2V0RygpLCBjLmdldEIoKV0KICAgICAgICB9CiAgICAgICAgc2V0IHNjcm9sbFgoeCkgewogICAgICAgICAgICBDM1guUmVxdWlyZU51bWJlcih4KTsKICAgICAgICAgICAgY29uc3QgbGF5ZXIgPSBtYXAuZ2V0KHRoaXMpOwogICAgICAgICAgICBsYXllci5TZXRPd25TY3JvbGxQb3NpdGlvbkVuYWJsZWQodHJ1ZSk7CiAgICAgICAgICAgIGxheWVyLlNldFNjcm9sbFgoeCkKICAgICAgICB9CiAgICAgICAgZ2V0IHNjcm9sbFgoKSB7CiAgICAgICAgICAgIHJldHVybiBtYXAuZ2V0KHRoaXMpLkdldFNjcm9sbFgoKQogICAgICAgIH0KICAgICAgICBzZXQgc2Nyb2xsWSh5KSB7CiAgICAgICAgICAgIEMzWC5SZXF1aXJlTnVtYmVyKHkpOwogICAgICAgICAgICBjb25zdCBsYXllciA9IG1hcC5nZXQodGhpcyk7CiAgICAgICAgICAgIGxheWVyLlNldE93blNjcm9sbFBvc2l0aW9uRW5hYmxlZCh0cnVlKTsKICAgICAgICAgICAgbGF5ZXIuU2V0U2Nyb2xsWSh5KQogICAgICAgIH0KICAgICAgICBnZXQgc2Nyb2xsWSgpIHsKICAgICAgICAgICAgcmV0dXJuIG1hcC5nZXQodGhpcykuR2V0U2Nyb2xsWSgpCiAgICAgICAgfQogICAgICAgIHNjcm9sbFRvKHgsIHkpIHsKICAgICAgICAgICAgQzNYLlJlcXVpcmVOdW1iZXIoeCk7CiAgICAgICAgICAgIEMzWC5SZXF1aXJlTnVtYmVyKHkpOwogICAgICAgICAgICBjb25zdCBsYXllciA9IG1hcC5nZXQodGhpcyk7CiAgICAgICAgICAgIGxheWVyLlNldE93blNjcm9sbFBvc2l0aW9uRW5hYmxlZCh0cnVlKTsKICAgICAgICAgICAgbGF5ZXIuU2V0U2Nyb2xsWCh4KTsKICAgICAgICAgICAgbGF5ZXIuU2V0U2Nyb2xsWSh5KQogICAgICAgIH0KICAgICAgICBnZXRTY3JvbGxQb3NpdGlvbigpIHsKICAgICAgICAgICAgY29uc3QgbGF5ZXIgPSBtYXAuZ2V0KHRoaXMpOwogICAgICAgICAgICByZXR1cm4gW2xheWVyLkdldFNjcm9sbFgoKSwgbGF5ZXIuR2V0U2Nyb2xsWSgpXQogICAgICAgIH0KICAgICAgICByZXN0b3JlU2Nyb2xsUG9zaXRpb24oKSB7CiAgICAgICAgICAgIG1hcC5nZXQodGhpcykuU2V0T3duU2Nyb2xsUG9zaXRpb25FbmFibGVkKGZhbHNlKQogICAgICAgIH0KICAgICAgICBnZXRWaWV3cG9ydCgpIHsKICAgICAgICAgICAgcmV0dXJuIG1hcC5nZXQodGhpcykuR2V0Vmlld3BvcnQoKS50b0RPTVJlY3QoKQogICAgICAgIH0KICAgICAgICBjc3NQeFRvTGF5ZXIoY2xpZW50WCwgY2xpZW50WSwgeiA9IDApIHsKICAgICAgICAgICAgQzNYLlJlcXVpcmVOdW1iZXIoY2xpZW50WCk7CiAgICAgICAgICAgIEMzWC5SZXF1aXJlTnVtYmVyKGNsaWVudFkpOwogICAgICAgICAgICBDM1guUmVxdWlyZU51bWJlcih6KTsKICAgICAgICAgICAgY29uc3QgbGF5ZXIgPSBtYXAuZ2V0KHRoaXMpOwogICAgICAgICAgICBjb25zdCBydW50aW1lID0gbGF5ZXIuR2V0UnVudGltZSgpOwogICAgICAgICAgICByZXR1cm4gbGF5ZXIuQ2FudmFzQ3NzVG9MYXllcihjbGllbnRYIC0gcnVudGltZS5HZXRDYW52YXNDbGllbnRYKCksIGNsaWVudFkgLQogICAgICAgICAgICAgICAgcnVudGltZS5HZXRDYW52YXNDbGllbnRZKCksIHopCiAgICAgICAgfQogICAgICAgIGxheWVyVG9Dc3NQeChsYXllclgsIGxheWVyWSwgeiA9IDApIHsKICAgICAgICAgICAgQzNYLlJlcXVpcmVOdW1iZXIobGF5ZXJYKTsKICAgICAgICAgICAgQzNYLlJlcXVpcmVOdW1iZXIobGF5ZXJZKTsKICAgICAgICAgICAgQzNYLlJlcXVpcmVOdW1iZXIoeik7CiAgICAgICAgICAgIGNvbnN0IGxheWVyID0gbWFwLmdldCh0aGlzKTsKICAgICAgICAgICAgY29uc3QgcnVudGltZSA9IGxheWVyLkdldFJ1bnRpbWUoKTsKICAgICAgICAgICAgY29uc3QgW2NsaWVudFgsIGNsaWVudFldID0gbGF5ZXIuTGF5ZXJUb0NhbnZhc0NzcyhsYXllclgsIGxheWVyWSwgeik7CiAgICAgICAgICAgIHJldHVybiBbY2xpZW50WCArIHJ1bnRpbWUuR2V0Q2FudmFzQ2xpZW50WCgpLCBjbGllbnRZICsgcnVudGltZS5HZXRDYW52YXNDbGllbnRZKCldCiAgICAgICAgfQogICAgfTsKCn0KCi8vIGludGVyZmFjZXMvSUluc3RhbmNlLmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIGNvbnN0IEMzWCA9IHNlbGYuQzNYOwogICAgY29uc3QgbWFwID0gbmV3IFdlYWtNYXA7CiAgICBjb25zdCBkaXNwYXRjaGVycyA9IG5ldyBXZWFrTWFwOwoKICAgIGZ1bmN0aW9uIEdldERpc3BhdGNoZXIoaWluc3QpIHsKICAgICAgICBsZXQgZGlzcGF0Y2hlciA9IGRpc3BhdGNoZXJzLmdldChpaW5zdCk7CiAgICAgICAgaWYgKGRpc3BhdGNoZXIpIHJldHVybiBkaXNwYXRjaGVyOwogICAgICAgIGRpc3BhdGNoZXIgPSBDMy5OZXcoQzMuRXZlbnQuRGlzcGF0Y2hlcik7CiAgICAgICAgZGlzcGF0Y2hlcnMuc2V0KGlpbnN0LCBkaXNwYXRjaGVyKTsKICAgICAgICByZXR1cm4gZGlzcGF0Y2hlcgogICAgfQogICAgbGV0IGluaXRJbnN0ID0gbnVsbDsKICAgIHNlbGYuSUluc3RhbmNlID0gY2xhc3MgSUluc3RhbmNlIHsKICAgICAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgICAgICAgbWFwLnNldCh0aGlzLCBpbml0SW5zdCk7CiAgICAgICAgICAgIGNvbnN0IGRlc2NyaXB0b3JzID0gewogICAgICAgICAgICAgICAgcnVudGltZTogewogICAgICAgICAgICAgICAgICAgIHZhbHVlOiBpbml0SW5zdC5HZXRSdW50aW1lKCkuR2V0SVJ1bnRpbWUoKSwKICAgICAgICAgICAgICAgICAgICB3cml0YWJsZTogZmFsc2UKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBvYmplY3RUeXBlOiB7CiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGluaXRJbnN0LkdldE9iamVjdENsYXNzKCkuR2V0SU9iamVjdENsYXNzKCksCiAgICAgICAgICAgICAgICAgICAgd3JpdGFibGU6IGZhbHNlCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgdWlkOiB7CiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGluaXRJbnN0LkdldFVJRCgpLAogICAgICAgICAgICAgICAgICAgIHdyaXRhYmxlOiBmYWxzZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgICAgICBpbml0SW5zdC5fR2V0SW5zdFZhcnNTY3JpcHREZXNjcmlwdG9yKGRlc2NyaXB0b3JzKTsKICAgICAgICAgICAgaW5pdEluc3QuX0dldEJlaGF2aW9yc1NjcmlwdERlc2NyaXB0b3IoZGVzY3JpcHRvcnMpOwogICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0aGlzLCBkZXNjcmlwdG9ycyk7CiAgICAgICAgICAgIGluaXRJbnN0LkdldFJ1bnRpbWUoKS5fTWFwU2NyaXB0SW50ZXJmYWNlKHRoaXMsIGluaXRJbnN0KQogICAgICAgIH0KICAgICAgICBzdGF0aWMgX0luaXQoaW5zdCkgewogICAgICAgICAgICBpbml0SW5zdCA9CiAgICAgICAgICAgICAgICBpbnN0CiAgICAgICAgfQogICAgICAgIHN0YXRpYyBfR2V0SW5pdEluc3QoKSB7CiAgICAgICAgICAgIHJldHVybiBpbml0SW5zdAogICAgICAgIH0KICAgICAgICBfUmVsZWFzZSgpIHsKICAgICAgICAgICAgY29uc3QgZGlzcGF0Y2hlciA9IGRpc3BhdGNoZXJzLmdldCh0aGlzKTsKICAgICAgICAgICAgaWYgKGRpc3BhdGNoZXIpIHsKICAgICAgICAgICAgICAgIGRpc3BhdGNoZXIuUmVsZWFzZSgpOwogICAgICAgICAgICAgICAgZGlzcGF0Y2hlcnMuZGVsZXRlKHRoaXMpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgbWFwLmRlbGV0ZSh0aGlzKQogICAgICAgIH0KICAgICAgICBhZGRFdmVudExpc3RlbmVyKHR5cGUsIGZ1bmMsIGNhcHR1cmUpIHsKICAgICAgICAgICAgQzNYLlJlcXVpcmVTdHJpbmcodHlwZSk7CiAgICAgICAgICAgIEMzWC5SZXF1aXJlRnVuY3Rpb24oZnVuYyk7CiAgICAgICAgICAgIEdldERpc3BhdGNoZXIodGhpcykuYWRkRXZlbnRMaXN0ZW5lcih0eXBlLCBmdW5jLCBjYXB0dXJlKQogICAgICAgIH0KICAgICAgICByZW1vdmVFdmVudExpc3RlbmVyKHR5cGUsIGZ1bmMsIGNhcHR1cmUpIHsKICAgICAgICAgICAgQzNYLlJlcXVpcmVTdHJpbmcodHlwZSk7CiAgICAgICAgICAgIEMzWC5SZXF1aXJlRnVuY3Rpb24oZnVuYyk7CiAgICAgICAgICAgIEdldERpc3BhdGNoZXIodGhpcykucmVtb3ZlRXZlbnRMaXN0ZW5lcih0eXBlLCBmdW5jLCBjYXB0dXJlKQogICAgICAgIH0KICAgICAgICBkaXNwYXRjaEV2ZW50KGUpIHsKICAgICAgICAgICAgR2V0RGlzcGF0Y2hlcih0aGlzKS5kaXNwYXRjaEV2ZW50KGUpCiAgICAgICAgfQogICAgICAgIGRlc3Ryb3koKSB7CiAgICAgICAgICAgIGNvbnN0IGluc3QgPQogICAgICAgICAgICAgICAgbWFwLmdldCh0aGlzKTsKICAgICAgICAgICAgY29uc3QgcnVudGltZSA9IGluc3QuR2V0UnVudGltZSgpOwogICAgICAgICAgICBydW50aW1lLkRlc3Ryb3lJbnN0YW5jZShpbnN0KTsKICAgICAgICAgICAgaWYgKCFydW50aW1lLkdldEV2ZW50U2hlZXRNYW5hZ2VyKCkuSXNJbkV2ZW50RW5naW5lKCkgJiYgIXJ1bnRpbWUuR2V0TGF5b3V0TWFuYWdlcigpLklzRW5kaW5nTGF5b3V0KCkpIHJ1bnRpbWUuRmx1c2hQZW5kaW5nSW5zdGFuY2VzKCkKICAgICAgICB9CiAgICAgICAgZ2V0T3RoZXJDb250YWluZXJJbnN0YW5jZXMoKSB7CiAgICAgICAgICAgIGNvbnN0IHNpYmxpbmdzID0gbWFwLmdldCh0aGlzKS5HZXRTaWJsaW5ncygpOwogICAgICAgICAgICByZXR1cm4gc2libGluZ3MgPyBzaWJsaW5ncy5tYXAocyA9PiBzLkdldEludGVyZmFjZUNsYXNzKCkpIDogW10KICAgICAgICB9KiBvdGhlckNvbnRhaW5lckluc3RhbmNlcygpIHsKICAgICAgICAgICAgY29uc3QgaW5zdCA9IG1hcC5nZXQodGhpcyk7CiAgICAgICAgICAgIGlmICghaW5zdC5Jc0luQ29udGFpbmVyKCkpIHJldHVybjsKICAgICAgICAgICAgZm9yIChjb25zdCBzIG9mIGluc3Quc2libGluZ3MoKSkgeWllbGQgcy5HZXRJbnRlcmZhY2VDbGFzcygpCiAgICAgICAgfQogICAgICAgIGdldCB0ZW1wbGF0ZU5hbWUoKSB7CiAgICAgICAgICAgIHJldHVybiBtYXAuZ2V0KHRoaXMpLkdldFRlbXBsYXRlTmFtZSgpCiAgICAgICAgfQogICAgICAgIHNldCB0aW1lU2NhbGUodCkgewogICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcih0KTsKICAgICAgICAgICAgbWFwLmdldCh0aGlzKS5TZXRUaW1lU2NhbGUodCkKICAgICAgICB9CiAgICAgICAgZ2V0IHRpbWVTY2FsZSgpIHsKICAgICAgICAgICAgcmV0dXJuIG1hcC5nZXQodGhpcykuR2V0QWN0aXZlVGltZVNjYWxlKCkKICAgICAgICB9CiAgICAgICAgcmVzdG9yZVRpbWVTY2FsZSgpIHsKICAgICAgICAgICAgbWFwLmdldCh0aGlzKS5SZXN0b3JlVGltZVNjYWxlKCkKICAgICAgICB9CiAgICB9OwoKfQoKLy8gaW50ZXJmYWNlcy9JV29ybGRJbnN0YW5jZS5qcwp7CiAgICAndXNlIHN0cmljdCc7CiAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICBjb25zdCBDM1ggPSBzZWxmLkMzWDsKICAgIGNvbnN0IElJbnN0YW5jZSA9IHNlbGYuSUluc3RhbmNlOwogICAgY29uc3QgSUxheWVyID0gc2VsZi5JTGF5ZXI7CiAgICBjb25zdCBtYXAgPSBuZXcgV2Vha01hcDsKICAgIGNvbnN0IEJMRU5EX01PREVfVE9fSU5ERVggPSBuZXcgTWFwKFsKICAgICAgICBbIm5vcm1hbCIsIDBdLAogICAgICAgIFsiYWRkaXRpdmUiLCAxXSwKICAgICAgICBbImNvcHkiLCAzXSwKICAgICAgICBbImRlc3RpbmF0aW9uLW92ZXIiLCA0XSwKICAgICAgICBbInNvdXJjZS1pbiIsIDVdLAogICAgICAgIFsiZGVzdGluYXRpb24taW4iLCA2XSwKICAgICAgICBbInNvdXJjZS1vdXQiLCA3XSwKICAgICAgICBbImRlc3RpbmF0aW9uLW91dCIsIDhdLAogICAgICAgIFsic291cmNlLWF0b3AiLCA5XSwKICAgICAgICBbImRlc3RpbmF0aW9uLWF0b3AiLCAxMF0KICAgIF0pOwogICAgY29uc3QgSU5ERVhfVE9fQkxFTkRfTU9ERSA9IG5ldyBNYXAoWy4uLkJMRU5EX01PREVfVE9fSU5ERVguZW50cmllcygpXS5tYXAoYSA9PiBbYVsxXSwgYVswXV0pKTsKICAgIGNvbnN0IHRlbXBDb2xvciA9IEMzLk5ldyhDMy5Db2xvcik7CiAgICBzZWxmLklXb3JsZEluc3RhbmNlID0gY2xhc3MgSVdvcmxkSW5zdGFuY2UgZXh0ZW5kcyBJSW5zdGFuY2UgewogICAgICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgICAgICBzdXBlcigpOwogICAgICAgICAgICBjb25zdCBpbnN0ID0gSUluc3RhbmNlLl9HZXRJbml0SW5zdCgpOwogICAgICAgICAgICBtYXAuc2V0KHRoaXMsIGluc3QpOwogICAgICAgICAgICBjb25zdCBlZmZlY3RJbnN0YW5jZUFyciA9IFtdOwogICAgICAgICAgICBjb25zdCB3aSA9IGluc3QuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgIGNvbnN0IGluc3RhbmNlRWZmZWN0TGlzdCA9IHdpLkdldEluc3RhbmNlRWZmZWN0TGlzdCgpOwogICAgICAgICAgICBpZiAoaW5zdGFuY2VFZmZlY3RMaXN0KSB7CiAgICAgICAgICAgICAgICBjb25zdCBlZmZlY3RDb3VudCA9IHdpLkdldE9iamVjdENsYXNzKCkuR2V0RWZmZWN0TGlzdCgpLkdldEFsbEVmZmVjdFR5cGVzKCkubGVuZ3RoOwogICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBlZmZlY3RDb3VudDsgKytpKSBlZmZlY3RJbnN0YW5jZUFyci5wdXNoKG5ldyBzZWxmLklFZmZlY3RJbnN0YW5jZShpbnN0YW5jZUVmZmVjdExpc3QsIGkpKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IGRlc2NyaXB0b3JzID0gewogICAgICAgICAgICAgICAgZWZmZWN0czogewogICAgICAgICAgICAgICAgICAgIHZhbHVlOiBlZmZlY3RJbnN0YW5jZUFyciwKICAgICAgICAgICAgICAgICAgICB3cml0YWJsZTogZmFsc2UKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGhpcywgZGVzY3JpcHRvcnMpCiAgICAgICAgfQogICAgICAgIGdldCBsYXlvdXQoKSB7CiAgICAgICAgICAgIHJldHVybiBtYXAuZ2V0KHRoaXMpLkdldFdvcmxkSW5mbygpLkdldExheW91dCgpLkdldElMYXlvdXQoKQogICAgICAgIH0KICAgICAgICBnZXQgbGF5ZXIoKSB7CiAgICAgICAgICAgIHJldHVybiBtYXAuZ2V0KHRoaXMpLkdldFdvcmxkSW5mbygpLkdldExheWVyKCkuR2V0SUxheWVyKCkKICAgICAgICB9CiAgICAgICAgZ2V0IHgoKSB7CiAgICAgICAgICAgIHJldHVybiBtYXAuZ2V0KHRoaXMpLkdldFdvcmxkSW5mbygpLkdldFgoKQogICAgICAgIH0KICAgICAgICBzZXQgeCh2KSB7CiAgICAgICAgICAgIHYgPSArdjsKICAgICAgICAgICAgY29uc3Qgd2kgPSBtYXAuZ2V0KHRoaXMpLkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICBpZiAoaXNOYU4odikgfHwgd2kuR2V0WCgpID09PSB2KSByZXR1cm47CiAgICAgICAgICAgIHdpLlNldFgodik7CiAgICAgICAgICAgIHdpLlNldEJib3hDaGFuZ2VkKCkKICAgICAgICB9CiAgICAgICAgZ2V0IHkoKSB7CiAgICAgICAgICAgIHJldHVybiBtYXAuZ2V0KHRoaXMpLkdldFdvcmxkSW5mbygpLkdldFkoKQogICAgICAgIH0KICAgICAgICBzZXQgeSh2KSB7CiAgICAgICAgICAgIHYgPSArdjsKICAgICAgICAgICAgY29uc3Qgd2kgPSBtYXAuZ2V0KHRoaXMpLkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICBpZiAoaXNOYU4odikgfHwgd2kuR2V0WSgpID09PSB2KSByZXR1cm47CiAgICAgICAgICAgIHdpLlNldFkodik7CiAgICAgICAgICAgIHdpLlNldEJib3hDaGFuZ2VkKCkKICAgICAgICB9CiAgICAgICAgc2V0UG9zaXRpb24oeCwgeSkgewogICAgICAgICAgICB4ID0gK3g7CiAgICAgICAgICAgIHkgPSAreTsKICAgICAgICAgICAgY29uc3Qgd2kgPSBtYXAuZ2V0KHRoaXMpLkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICBpZiAoaXNOYU4oeCkgfHwgaXNOYU4oeSkgfHwgd2kuR2V0WCgpID09PSB4ICYmIHdpLkdldFkoKSA9PT0geSkgcmV0dXJuOwogICAgICAgICAgICB3aS5TZXRYWSh4LCB5KTsKICAgICAgICAgICAgd2kuU2V0QmJveENoYW5nZWQoKQogICAgICAgIH0KICAgICAgICBnZXRQb3NpdGlvbigpIHsKICAgICAgICAgICAgY29uc3Qgd2kgPSBtYXAuZ2V0KHRoaXMpLkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICByZXR1cm4gW3dpLkdldFgoKSwgd2kuR2V0WSgpXQogICAgICAgIH0KICAgICAgICBvZmZzZXRQb3NpdGlvbihkeCwgZHkpIHsKICAgICAgICAgICAgZHggPSArZHg7CiAgICAgICAgICAgIGR5ID0gK2R5OwogICAgICAgICAgICBpZiAoaXNOYU4oZHgpIHx8IGlzTmFOKGR5KSB8fCBkeCA9PT0gMCAmJiBkeSA9PT0gMCkgcmV0dXJuOwogICAgICAgICAgICBjb25zdCB3aSA9IG1hcC5nZXQodGhpcykuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgIHdpLk9mZnNldFhZKGR4LCBkeSk7CiAgICAgICAgICAgIHdpLlNldEJib3hDaGFuZ2VkKCkKICAgICAgICB9CiAgICAgICAgZ2V0IHpFbGV2YXRpb24oKSB7CiAgICAgICAgICAgIHJldHVybiBtYXAuZ2V0KHRoaXMpLkdldFdvcmxkSW5mbygpLkdldFpFbGV2YXRpb24oKQogICAgICAgIH0KICAgICAgICBzZXQgekVsZXZhdGlvbih6KSB7CiAgICAgICAgICAgIHogPSArejsKICAgICAgICAgICAgY29uc3QgaW5zdCA9IG1hcC5nZXQodGhpcyk7CiAgICAgICAgICAgIGNvbnN0IHdpID0gaW5zdC5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgaWYgKGlzTmFOKHopIHx8IHdpLkdldFpFbGV2YXRpb24oKSA9PT0geikgcmV0dXJuOwogICAgICAgICAgICB3aS5TZXRaRWxldmF0aW9uKHopOwogICAgICAgICAgICBpbnN0LkdldFJ1bnRpbWUoKS5VcGRhdGVSZW5kZXIoKQogICAgICAgIH0KICAgICAgICBnZXQgdG90YWxaRWxldmF0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gbWFwLmdldCh0aGlzKS5HZXRXb3JsZEluZm8oKS5HZXRUb3RhbFpFbGV2YXRpb24oKQogICAgICAgIH0KICAgICAgICBnZXQgd2lkdGgoKSB7CiAgICAgICAgICAgIHJldHVybiBtYXAuZ2V0KHRoaXMpLkdldFdvcmxkSW5mbygpLkdldFdpZHRoKCkKICAgICAgICB9CiAgICAgICAgc2V0IHdpZHRoKHcpIHsKICAgICAgICAgICAgdyA9ICt3OwogICAgICAgICAgICBjb25zdCB3aSA9IG1hcC5nZXQodGhpcykuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgIGlmIChpc05hTih3KSB8fCB3aS5HZXRXaWR0aCgpID09PSB3KSByZXR1cm47CiAgICAgICAgICAgIHdpLlNldFdpZHRoKHcpOwogICAgICAgICAgICB3aS5TZXRCYm94Q2hhbmdlZCgpCiAgICAgICAgfQogICAgICAgIGdldCBoZWlnaHQoKSB7CiAgICAgICAgICAgIHJldHVybiBtYXAuZ2V0KHRoaXMpLkdldFdvcmxkSW5mbygpLkdldEhlaWdodCgpCiAgICAgICAgfQogICAgICAgIHNldCBoZWlnaHQoaCkgewogICAgICAgICAgICBoID0gK2g7CiAgICAgICAgICAgIGNvbnN0IHdpID0KICAgICAgICAgICAgICAgIG1hcC5nZXQodGhpcykuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgIGlmIChpc05hTihoKSB8fCB3aS5HZXRIZWlnaHQoKSA9PT0gaCkgcmV0dXJuOwogICAgICAgICAgICB3aS5TZXRIZWlnaHQoaCk7CiAgICAgICAgICAgIHdpLlNldEJib3hDaGFuZ2VkKCkKICAgICAgICB9CiAgICAgICAgc2V0U2l6ZSh3LCBoKSB7CiAgICAgICAgICAgIHcgPSArdzsKICAgICAgICAgICAgaCA9ICtoOwogICAgICAgICAgICBjb25zdCB3aSA9IG1hcC5nZXQodGhpcykuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgIGlmIChpc05hTih3KSB8fCBpc05hTihoKSB8fCB3aS5HZXRXaWR0aCgpID09PSB3ICYmIHdpLkdldEhlaWdodCgpID09PSBoKSByZXR1cm47CiAgICAgICAgICAgIHdpLlNldFNpemUodywgaCk7CiAgICAgICAgICAgIHdpLlNldEJib3hDaGFuZ2VkKCkKICAgICAgICB9CiAgICAgICAgZ2V0U2l6ZSgpIHsKICAgICAgICAgICAgY29uc3Qgd2kgPSBtYXAuZ2V0KHRoaXMpLkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICByZXR1cm4gW3dpLkdldFdpZHRoKCksIHdpLkdldEhlaWdodCgpXQogICAgICAgIH0KICAgICAgICBnZXQgYW5nbGUoKSB7CiAgICAgICAgICAgIHJldHVybiBtYXAuZ2V0KHRoaXMpLkdldFdvcmxkSW5mbygpLkdldEFuZ2xlKCkKICAgICAgICB9CiAgICAgICAgc2V0IGFuZ2xlKGEpIHsKICAgICAgICAgICAgYSA9IEMzLmNsYW1wQW5nbGUoK2EpOwogICAgICAgICAgICBjb25zdCB3aSA9IG1hcC5nZXQodGhpcykuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgIGlmIChpc05hTihhKSB8fCB3aS5HZXRBbmdsZSgpID09PQogICAgICAgICAgICAgICAgYSkgcmV0dXJuOwogICAgICAgICAgICB3aS5TZXRBbmdsZShhKTsKICAgICAgICAgICAgd2kuU2V0QmJveENoYW5nZWQoKQogICAgICAgIH0KICAgICAgICBnZXQgYW5nbGVEZWdyZWVzKCkgewogICAgICAgICAgICByZXR1cm4gQzMudG9EZWdyZWVzKHRoaXMuYW5nbGUpCiAgICAgICAgfQogICAgICAgIHNldCBhbmdsZURlZ3JlZXMoYSkgewogICAgICAgICAgICB0aGlzLmFuZ2xlID0gQzMudG9SYWRpYW5zKGEpCiAgICAgICAgfQogICAgICAgIGdldEJvdW5kaW5nQm94KCkgewogICAgICAgICAgICByZXR1cm4gbWFwLmdldCh0aGlzKS5HZXRXb3JsZEluZm8oKS5HZXRCb3VuZGluZ0JveCgpLnRvRE9NUmVjdCgpCiAgICAgICAgfQogICAgICAgIGdldEJvdW5kaW5nUXVhZCgpIHsKICAgICAgICAgICAgcmV0dXJuIG1hcC5nZXQodGhpcykuR2V0V29ybGRJbmZvKCkuR2V0Qm91bmRpbmdRdWFkKCkudG9ET01RdWFkKCkKICAgICAgICB9CiAgICAgICAgZ2V0IGlzVmlzaWJsZSgpIHsKICAgICAgICAgICAgcmV0dXJuIG1hcC5nZXQodGhpcykuR2V0V29ybGRJbmZvKCkuSXNWaXNpYmxlKCkKICAgICAgICB9CiAgICAgICAgc2V0IGlzVmlzaWJsZSh2KSB7CiAgICAgICAgICAgIHYgPSAhIXY7CiAgICAgICAgICAgIGNvbnN0IGluc3QgPSBtYXAuZ2V0KHRoaXMpOwogICAgICAgICAgICBjb25zdCB3aSA9IGluc3QuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgIGlmICh3aS5Jc1Zpc2libGUoKSA9PT0gdikgcmV0dXJuOwogICAgICAgICAgICB3aS5TZXRWaXNpYmxlKHYpOwogICAgICAgICAgICBpbnN0LkdldFJ1bnRpbWUoKS5VcGRhdGVSZW5kZXIoKQogICAgICAgIH0KICAgICAgICBnZXQgb3BhY2l0eSgpIHsKICAgICAgICAgICAgcmV0dXJuIG1hcC5nZXQodGhpcykuR2V0V29ybGRJbmZvKCkuR2V0T3BhY2l0eSgpCiAgICAgICAgfQogICAgICAgIHNldCBvcGFjaXR5KG8pIHsKICAgICAgICAgICAgbyA9CiAgICAgICAgICAgICAgICBDMy5jbGFtcCgrbywgMCwgMSk7CiAgICAgICAgICAgIGNvbnN0IGluc3QgPSBtYXAuZ2V0KHRoaXMpOwogICAgICAgICAgICBjb25zdCB3aSA9IGluc3QuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgIGlmIChpc05hTihvKSB8fCB3aS5HZXRPcGFjaXR5KCkgPT09IG8pIHJldHVybjsKICAgICAgICAgICAgd2kuU2V0T3BhY2l0eShvKTsKICAgICAgICAgICAgaW5zdC5HZXRSdW50aW1lKCkuVXBkYXRlUmVuZGVyKCkKICAgICAgICB9CiAgICAgICAgc2V0IGNvbG9yUmdiKGFycikgewogICAgICAgICAgICBDM1guUmVxdWlyZUFycmF5KGFycik7CiAgICAgICAgICAgIGlmIChhcnIubGVuZ3RoIDwgMykgdGhyb3cgbmV3IEVycm9yKCJleHBlY3RlZCAzIGVsZW1lbnRzIik7CiAgICAgICAgICAgIHRlbXBDb2xvci5zZXRSZ2IoYXJyWzBdLCBhcnJbMV0sIGFyclsyXSk7CiAgICAgICAgICAgIGNvbnN0IGluc3QgPSBtYXAuZ2V0KHRoaXMpOwogICAgICAgICAgICBjb25zdCB3aSA9IGluc3QuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgIGlmICh3aS5HZXRVbnByZW11bHRpcGxpZWRDb2xvcigpLmVxdWFsc0lnbm9yaW5nQWxwaGEodGVtcENvbG9yKSkgcmV0dXJuOwogICAgICAgICAgICB3aS5TZXRVbnByZW11bHRpcGxpZWRDb2xvcih0ZW1wQ29sb3IpOwogICAgICAgICAgICBpbnN0LkdldFJ1bnRpbWUoKS5VcGRhdGVSZW5kZXIoKQogICAgICAgIH0KICAgICAgICBnZXQgY29sb3JSZ2IoKSB7CiAgICAgICAgICAgIGNvbnN0IGMgPQogICAgICAgICAgICAgICAgbWFwLmdldCh0aGlzKS5HZXRXb3JsZEluZm8oKS5HZXRVbnByZW11bHRpcGxpZWRDb2xvcigpOwogICAgICAgICAgICByZXR1cm4gW2MuZ2V0UigpLCBjLmdldEcoKSwgYy5nZXRCKCldCiAgICAgICAgfQogICAgICAgIHNldCBibGVuZE1vZGUoYm0pIHsKICAgICAgICAgICAgQzNYLlJlcXVpcmVTdHJpbmcoYm0pOwogICAgICAgICAgICBjb25zdCBpbmRleCA9IEJMRU5EX01PREVfVE9fSU5ERVguZ2V0KGJtKTsKICAgICAgICAgICAgaWYgKHR5cGVvZiBpbmRleCAhPT0gIm51bWJlciIpIHRocm93IG5ldyBFcnJvcigiaW52YWxpZCBibGVuZCBtb2RlIik7CiAgICAgICAgICAgIGNvbnN0IGluc3QgPSBtYXAuZ2V0KHRoaXMpOwogICAgICAgICAgICBjb25zdCB3aSA9IGluc3QuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgIHdpLlNldEJsZW5kTW9kZShpbmRleCk7CiAgICAgICAgICAgIGluc3QuR2V0UnVudGltZSgpLlVwZGF0ZVJlbmRlcigpCiAgICAgICAgfQogICAgICAgIGdldCBibGVuZE1vZGUoKSB7CiAgICAgICAgICAgIHJldHVybiBJTkRFWF9UT19CTEVORF9NT0RFLmdldChtYXAuZ2V0KHRoaXMpLkdldFdvcmxkSW5mbygpLkdldEJsZW5kTW9kZSgpKQogICAgICAgIH0KICAgICAgICBtb3ZlVG9Ub3AoKSB7CiAgICAgICAgICAgIG1hcC5nZXQodGhpcykuR2V0V29ybGRJbmZvKCkuWk9yZGVyTW92ZVRvVG9wKCkKICAgICAgICB9CiAgICAgICAgbW92ZVRvQm90dG9tKCkgewogICAgICAgICAgICBtYXAuZ2V0KHRoaXMpLkdldFdvcmxkSW5mbygpLlpPcmRlck1vdmVUb0JvdHRvbSgpCiAgICAgICAgfQogICAgICAgIG1vdmVUb0xheWVyKGlsYXllcikgewogICAgICAgICAgICBDM1guUmVxdWlyZUluc3RhbmNlT2YoaWxheWVyLAogICAgICAgICAgICAgICAgSUxheWVyKTsKICAgICAgICAgICAgY29uc3QgbGF5ZXIgPSBJTGF5ZXIuX1Vud3JhcChpbGF5ZXIpOwogICAgICAgICAgICBpZiAoIWxheWVyKSB0aHJvdyBuZXcgRXJyb3IoImludmFsaWQgbGF5ZXIiKTsKICAgICAgICAgICAgbWFwLmdldCh0aGlzKS5HZXRXb3JsZEluZm8oKS5aT3JkZXJNb3ZlVG9MYXllcihsYXllcikKICAgICAgICB9CiAgICAgICAgbW92ZUFkamFjZW50VG9JbnN0YW5jZShvdGhlciwgaXNBZnRlcikgewogICAgICAgICAgICBDM1guUmVxdWlyZUluc3RhbmNlT2Yob3RoZXIsIElXb3JsZEluc3RhbmNlKTsKICAgICAgICAgICAgbWFwLmdldCh0aGlzKS5HZXRXb3JsZEluZm8oKS5aT3JkZXJNb3ZlQWRqYWNlbnRUb0luc3RhbmNlKG1hcC5nZXQob3RoZXIpLCBpc0FmdGVyKQogICAgICAgIH0KICAgICAgICBnZXQgekluZGV4KCkgewogICAgICAgICAgICByZXR1cm4gbWFwLmdldCh0aGlzKS5HZXRXb3JsZEluZm8oKS5HZXRaSW5kZXgoKQogICAgICAgIH0KICAgICAgICBnZXQgaXNDb2xsaXNpb25FbmFibGVkKCkgewogICAgICAgICAgICByZXR1cm4gbWFwLmdldCh0aGlzKS5HZXRXb3JsZEluZm8oKS5Jc0NvbGxpc2lvbkVuYWJsZWQoKQogICAgICAgIH0KICAgICAgICBzZXQgaXNDb2xsaXNpb25FbmFibGVkKGUpIHsKICAgICAgICAgICAgbWFwLmdldCh0aGlzKS5HZXRXb3JsZEluZm8oKS5TZXRDb2xsaXNpb25FbmFibGVkKCEhZSkKICAgICAgICB9CiAgICAgICAgY29udGFpbnNQb2ludCh4LAogICAgICAgICAgICB5KSB7CiAgICAgICAgICAgIEMzWC5SZXF1aXJlTnVtYmVyKHgpOwogICAgICAgICAgICBDM1guUmVxdWlyZU51bWJlcih5KTsKICAgICAgICAgICAgcmV0dXJuIG1hcC5nZXQodGhpcykuR2V0V29ybGRJbmZvKCkuQ29udGFpbnNQb2ludCgreCwgK3kpCiAgICAgICAgfQogICAgICAgIHRlc3RPdmVybGFwKHdvcmxkSW5zdGFuY2UpIHsKICAgICAgICAgICAgQzNYLlJlcXVpcmVJbnN0YW5jZU9mKHdvcmxkSW5zdGFuY2UsIElXb3JsZEluc3RhbmNlKTsKICAgICAgICAgICAgY29uc3QgYSA9IG1hcC5nZXQodGhpcyk7CiAgICAgICAgICAgIGNvbnN0IGIgPSBtYXAuZ2V0KHdvcmxkSW5zdGFuY2UpOwogICAgICAgICAgICByZXR1cm4gYS5HZXRSdW50aW1lKCkuR2V0Q29sbGlzaW9uRW5naW5lKCkuVGVzdE92ZXJsYXAoYSwgYikKICAgICAgICB9CiAgICAgICAgdGVzdE92ZXJsYXBTb2xpZCgpIHsKICAgICAgICAgICAgY29uc3QgaW5zdCA9IG1hcC5nZXQodGhpcyk7CiAgICAgICAgICAgIGNvbnN0IG92ZXJsYXBJbnN0ID0gaW5zdC5HZXRSdW50aW1lKCkuR2V0Q29sbGlzaW9uRW5naW5lKCkuVGVzdE92ZXJsYXBTb2xpZChpbnN0KTsKICAgICAgICAgICAgcmV0dXJuIG92ZXJsYXBJbnN0ID8gb3ZlcmxhcEluc3QuR2V0SW50ZXJmYWNlQ2xhc3MoKSA6IG51bGwKICAgICAgICB9CiAgICAgICAgZ2V0UGFyZW50KCkgewogICAgICAgICAgICBjb25zdCBwYXJlbnQgPSBtYXAuZ2V0KHRoaXMpLkdldFBhcmVudCgpOwogICAgICAgICAgICByZXR1cm4gcGFyZW50ID8gcGFyZW50LkdldEludGVyZmFjZUNsYXNzKCkgOiBudWxsCiAgICAgICAgfQogICAgICAgIGdldFRvcFBhcmVudCgpIHsKICAgICAgICAgICAgY29uc3QgcGFyZW50ID0gbWFwLmdldCh0aGlzKS5HZXRUb3BQYXJlbnQoKTsKICAgICAgICAgICAgcmV0dXJuIHBhcmVudCA/IHBhcmVudC5HZXRJbnRlcmZhY2VDbGFzcygpIDogbnVsbAogICAgICAgIH0qIHBhcmVudHMoKSB7CiAgICAgICAgICAgIGZvciAoY29uc3QgcGFyZW50IG9mIG1hcC5nZXQodGhpcykucGFyZW50cygpKSB5aWVsZCBwYXJlbnQuR2V0SW50ZXJmYWNlQ2xhc3MoKQogICAgICAgIH0KICAgICAgICBnZXRDaGlsZENvdW50KCkgewogICAgICAgICAgICByZXR1cm4gbWFwLmdldCh0aGlzKS5HZXRDaGlsZENvdW50KCkKICAgICAgICB9CiAgICAgICAgZ2V0Q2hpbGRBdChpbmRleCkgewogICAgICAgICAgICBjb25zdCBjaGlsZCA9IG1hcC5nZXQodGhpcykuR2V0Q2hpbGRBdChpbmRleCk7CiAgICAgICAgICAgIHJldHVybiBjaGlsZCA/IGNoaWxkLkdldEludGVyZmFjZUNsYXNzKCkgOiBudWxsCiAgICAgICAgfSogY2hpbGRyZW4oKSB7CiAgICAgICAgICAgIGZvciAoY29uc3QgY2hpbGQgb2YgbWFwLmdldCh0aGlzKS5jaGlsZHJlbigpKSB5aWVsZCBjaGlsZC5HZXRJbnRlcmZhY2VDbGFzcygpCiAgICAgICAgfSogYWxsQ2hpbGRyZW4oKSB7CiAgICAgICAgICAgIGZvciAoY29uc3QgY2hpbGQgb2YgbWFwLmdldCh0aGlzKS5hbGxDaGlsZHJlbigpKSB5aWVsZCBjaGlsZC5HZXRJbnRlcmZhY2VDbGFzcygpCiAgICAgICAgfQogICAgICAgIGFkZENoaWxkKGljaGlsZCwKICAgICAgICAgICAgb3B0cykgewogICAgICAgICAgICBDM1guUmVxdWlyZUluc3RhbmNlT2YoaWNoaWxkLCBJV29ybGRJbnN0YW5jZSk7CiAgICAgICAgICAgIEMzWC5SZXF1aXJlT3B0aW9uYWxPYmplY3Qob3B0cyk7CiAgICAgICAgICAgIGlmICghb3B0cykgb3B0cyA9IHt9OwogICAgICAgICAgICBjb25zdCBpbnN0ID0gbWFwLmdldCh0aGlzKTsKICAgICAgICAgICAgY29uc3QgY2hpbGQgPSBtYXAuZ2V0KGljaGlsZCk7CiAgICAgICAgICAgIGluc3QuQWRkQ2hpbGQoY2hpbGQsIG9wdHMpCiAgICAgICAgfQogICAgICAgIHJlbW92ZUNoaWxkKGljaGlsZCkgewogICAgICAgICAgICBDM1guUmVxdWlyZUluc3RhbmNlT2YoaWNoaWxkLCBJV29ybGRJbnN0YW5jZSk7CiAgICAgICAgICAgIGNvbnN0IGluc3QgPSBtYXAuZ2V0KHRoaXMpOwogICAgICAgICAgICBjb25zdCBjaGlsZCA9IG1hcC5nZXQoaWNoaWxkKTsKICAgICAgICAgICAgaW5zdC5SZW1vdmVDaGlsZChjaGlsZCkKICAgICAgICB9CiAgICAgICAgcmVtb3ZlRnJvbVBhcmVudCgpIHsKICAgICAgICAgICAgY29uc3QgaW5zdCA9IG1hcC5nZXQodGhpcyk7CiAgICAgICAgICAgIGlmICghaW5zdC5IYXNQYXJlbnQoKSkgcmV0dXJuOwogICAgICAgICAgICBjb25zdCBwYXJlbnQgPSBpbnN0LkdldFBhcmVudCgpOwogICAgICAgICAgICBwYXJlbnQuUmVtb3ZlQ2hpbGQoaW5zdCkKICAgICAgICB9CiAgICAgICAgY3JlYXRlTWVzaChoc2l6ZSwgdnNpemUpIHsKICAgICAgICAgICAgQzNYLlJlcXVpcmVGaW5pdGVOdW1iZXIoaHNpemUpOwogICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcih2c2l6ZSk7CiAgICAgICAgICAgIG1hcC5nZXQodGhpcykuR2V0V29ybGRJbmZvKCkuQ3JlYXRlTWVzaChoc2l6ZSwgdnNpemUpCiAgICAgICAgfQogICAgICAgIHJlbGVhc2VNZXNoKCkgewogICAgICAgICAgICBjb25zdCB3aSA9IG1hcC5nZXQodGhpcykuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgIHdpLlJlbGVhc2VNZXNoKCk7CiAgICAgICAgICAgIHdpLlNldEJib3hDaGFuZ2VkKCkKICAgICAgICB9CiAgICAgICAgc2V0TWVzaFBvaW50KGNvbCwgcm93LCBvcHRzKSB7CiAgICAgICAgICAgIEMzWC5SZXF1aXJlRmluaXRlTnVtYmVyKGNvbCk7CiAgICAgICAgICAgIEMzWC5SZXF1aXJlRmluaXRlTnVtYmVyKHJvdyk7CiAgICAgICAgICAgIEMzWC5SZXF1aXJlT2JqZWN0KG9wdHMpOwogICAgICAgICAgICBjb25zdCB3aSA9IG1hcC5nZXQodGhpcykuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgIGlmICh3aS5TZXRNZXNoUG9pbnQoY29sLCByb3csIG9wdHMpKSB3aS5TZXRCYm94Q2hhbmdlZCgpCiAgICAgICAgfQogICAgICAgIGdldE1lc2hTaXplKCkgewogICAgICAgICAgICBjb25zdCB3aSA9IG1hcC5nZXQodGhpcykuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgIGlmICghd2kuSGFzTWVzaCgpKSByZXR1cm4gWzAsIDBdOwogICAgICAgICAgICBjb25zdCBzb3VyY2VNZXNoID0gd2kuR2V0U291cmNlTWVzaCgpOwogICAgICAgICAgICByZXR1cm4gW3NvdXJjZU1lc2guR2V0SFNpemUoKSwKICAgICAgICAgICAgICAgIHNvdXJjZU1lc2guR2V0VlNpemUoKQogICAgICAgICAgICBdCiAgICAgICAgfQogICAgfTsKCn0KCi8vIGludGVyZmFjZXMvSURPTUluc3RhbmNlLmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIGNvbnN0IEMzWCA9IHNlbGYuQzNYOwogICAgY29uc3QgbWFwID0gbmV3IFdlYWtNYXA7CiAgICBzZWxmLklET01JbnN0YW5jZSA9IGNsYXNzIElET01JbnN0YW5jZSBleHRlbmRzIHNlbGYuSVdvcmxkSW5zdGFuY2UgewogICAgICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgICAgICBzdXBlcigpOwogICAgICAgICAgICBtYXAuc2V0KHRoaXMsIHNlbGYuSUluc3RhbmNlLl9HZXRJbml0SW5zdCgpKQogICAgICAgIH0KICAgICAgICBnZXRFbGVtZW50KCkgewogICAgICAgICAgICByZXR1cm4gbWFwLmdldCh0aGlzKS5HZXRTZGtJbnN0YW5jZSgpLl9HZXRFbGVtZW50SW5ET01Nb2RlKCkKICAgICAgICB9CiAgICAgICAgZm9jdXMoKSB7CiAgICAgICAgICAgIG1hcC5nZXQodGhpcykuR2V0U2RrSW5zdGFuY2UoKS5Gb2N1c0VsZW1lbnQoKQogICAgICAgIH0KICAgICAgICBibHVyKCkgewogICAgICAgICAgICBtYXAuZ2V0KHRoaXMpLkdldFNka0luc3RhbmNlKCkuQmx1ckVsZW1lbnQoKQogICAgICAgIH0KICAgICAgICBzZXRDc3NTdHlsZShwcm9wLCB2YWwpIHsKICAgICAgICAgICAgQzNYLlJlcXVpcmVTdHJpbmcocHJvcCk7CiAgICAgICAgICAgIG1hcC5nZXQodGhpcykuR2V0U2RrSW5zdGFuY2UoKS5TZXRFbGVtZW50Q1NTU3R5bGUocHJvcCwgdmFsKQogICAgICAgIH0KICAgIH07Cgp9CgovLyBpbnRlcmZhY2VzL0lCZWhhdmlvckluc3RhbmNlLmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIGNvbnN0IEMzWCA9IHNlbGYuQzNYOwogICAgY29uc3QgbWFwID0gbmV3IFdlYWtNYXA7CiAgICBjb25zdCBkaXNwYXRjaGVycyA9IG5ldyBXZWFrTWFwOwoKICAgIGZ1bmN0aW9uIEdldERpc3BhdGNoZXIoaWJlaGluc3QpIHsKICAgICAgICBsZXQgZGlzcGF0Y2hlciA9IGRpc3BhdGNoZXJzLmdldChpYmVoaW5zdCk7CiAgICAgICAgaWYgKGRpc3BhdGNoZXIpIHJldHVybiBkaXNwYXRjaGVyOwogICAgICAgIGRpc3BhdGNoZXIgPSBDMy5OZXcoQzMuRXZlbnQuRGlzcGF0Y2hlcik7CiAgICAgICAgZGlzcGF0Y2hlcnMuc2V0KGliZWhpbnN0LCBkaXNwYXRjaGVyKTsKICAgICAgICByZXR1cm4gZGlzcGF0Y2hlcgogICAgfQogICAgbGV0IGluaXRCZWhJbnN0ID0gbnVsbDsKICAgIHNlbGYuSUJlaGF2aW9ySW5zdGFuY2UgPSBjbGFzcyBJQmVoYXZpb3JJbnN0YW5jZSB7CiAgICAgICAgY29uc3RydWN0b3IoKSB7CiAgICAgICAgICAgIG1hcC5zZXQodGhpcywgaW5pdEJlaEluc3QpOwogICAgICAgICAgICBjb25zdCBkZXNjcmlwdG9ycyA9IHsKICAgICAgICAgICAgICAgIHJ1bnRpbWU6IHsKICAgICAgICAgICAgICAgICAgICB2YWx1ZTogaW5pdEJlaEluc3QuR2V0UnVudGltZSgpLkdldElSdW50aW1lKCksCiAgICAgICAgICAgICAgICAgICAgd3JpdGFibGU6IGZhbHNlCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgYmVoYXZpb3I6IHsKICAgICAgICAgICAgICAgICAgICB2YWx1ZTogaW5pdEJlaEluc3QuR2V0QmVoYXZpb3IoKS5HZXRJQmVoYXZpb3IoKSwKICAgICAgICAgICAgICAgICAgICB3cml0YWJsZTogZmFsc2UKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGhpcywgZGVzY3JpcHRvcnMpCiAgICAgICAgfQogICAgICAgIHN0YXRpYyBfSW5pdChiZWhJbnN0KSB7CiAgICAgICAgICAgIGluaXRCZWhJbnN0ID0gYmVoSW5zdAogICAgICAgIH0KICAgICAgICBzdGF0aWMgX0dldEluaXRJbnN0KCkgewogICAgICAgICAgICByZXR1cm4gaW5pdEJlaEluc3QKICAgICAgICB9CiAgICAgICAgZ2V0IGluc3RhbmNlKCkgewogICAgICAgICAgICByZXR1cm4gbWFwLmdldCh0aGlzKS5HZXRPYmplY3RJbnN0YW5jZSgpLkdldEludGVyZmFjZUNsYXNzKCkKICAgICAgICB9CiAgICAgICAgX1JlbGVhc2UoKSB7CiAgICAgICAgICAgIGNvbnN0IGRpc3BhdGNoZXIgPSBkaXNwYXRjaGVycy5nZXQodGhpcyk7CiAgICAgICAgICAgIGlmIChkaXNwYXRjaGVyKSB7CiAgICAgICAgICAgICAgICBkaXNwYXRjaGVyLlJlbGVhc2UoKTsKICAgICAgICAgICAgICAgIGRpc3BhdGNoZXJzLmRlbGV0ZSh0aGlzKQogICAgICAgICAgICB9CiAgICAgICAgICAgIG1hcC5kZWxldGUodGhpcykKICAgICAgICB9CiAgICAgICAgYWRkRXZlbnRMaXN0ZW5lcih0eXBlLCBmdW5jLCBjYXB0dXJlKSB7CiAgICAgICAgICAgIEMzWC5SZXF1aXJlU3RyaW5nKHR5cGUpOwogICAgICAgICAgICBDM1guUmVxdWlyZUZ1bmN0aW9uKGZ1bmMpOwogICAgICAgICAgICBHZXREaXNwYXRjaGVyKHRoaXMpLmFkZEV2ZW50TGlzdGVuZXIodHlwZSwgZnVuYywgY2FwdHVyZSkKICAgICAgICB9CiAgICAgICAgcmVtb3ZlRXZlbnRMaXN0ZW5lcih0eXBlLCBmdW5jLCBjYXB0dXJlKSB7CiAgICAgICAgICAgIEMzWC5SZXF1aXJlU3RyaW5nKHR5cGUpOwogICAgICAgICAgICBDM1guUmVxdWlyZUZ1bmN0aW9uKGZ1bmMpOwogICAgICAgICAgICBHZXREaXNwYXRjaGVyKHRoaXMpLnJlbW92ZUV2ZW50TGlzdGVuZXIodHlwZSwgZnVuYywgY2FwdHVyZSkKICAgICAgICB9CiAgICAgICAgZGlzcGF0Y2hFdmVudChlKSB7CiAgICAgICAgICAgIEdldERpc3BhdGNoZXIodGhpcykuZGlzcGF0Y2hFdmVudChlKQogICAgICAgIH0KICAgIH07Cgp9CgovLyBpbnRlcmZhY2VzL0lCZWhhdmlvci5qcwp7CiAgICAndXNlIHN0cmljdCc7CiAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICBjb25zdCBDM1ggPSBzZWxmLkMzWDsKICAgIGNvbnN0IG1hcCA9IG5ldyBXZWFrTWFwOwogICAgc2VsZi5JQmVoYXZpb3IgPSBjbGFzcyBJQmVoYXZpb3IgewogICAgICAgIGNvbnN0cnVjdG9yKGJlaGF2aW9yKSB7CiAgICAgICAgICAgIG1hcC5zZXQodGhpcywgYmVoYXZpb3IpOwogICAgICAgICAgICBjb25zdCBkZXNjcmlwdG9ycyA9IHsKICAgICAgICAgICAgICAgIHJ1bnRpbWU6IHsKICAgICAgICAgICAgICAgICAgICB2YWx1ZTogYmVoYXZpb3IuR2V0UnVudGltZSgpLkdldElSdW50aW1lKCksCiAgICAgICAgICAgICAgICAgICAgd3JpdGFibGU6IGZhbHNlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRoaXMsIGRlc2NyaXB0b3JzKQogICAgICAgIH0KICAgICAgICBnZXRBbGxJbnN0YW5jZXMoKSB7CiAgICAgICAgICAgIHJldHVybiBtYXAuZ2V0KHRoaXMpLkdldEluc3RhbmNlcygpLm1hcChpbnN0ID0+IGluc3QuR2V0SW50ZXJmYWNlQ2xhc3MoKSkKICAgICAgICB9CiAgICB9OwoKfQoKLy8gaW50ZXJmYWNlcy9JRWZmZWN0SW5zdGFuY2UuanMKewogICAgJ3VzZSBzdHJpY3QnOwogICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgY29uc3QgQzNYID0gc2VsZi5DM1g7CiAgICBjb25zdCBtYXAgPSBuZXcgV2Vha01hcDsKICAgIGNvbnN0IHRlbXBDb2xvciA9IEMzLk5ldyhDMy5Db2xvcik7CiAgICBzZWxmLklFZmZlY3RJbnN0YW5jZSA9IGNsYXNzIElFZmZlY3RJbnN0YW5jZSB7CiAgICAgICAgY29uc3RydWN0b3IoZWZmZWN0TGlzdCwgaW5kZXgpIHsKICAgICAgICAgICAgbWFwLnNldCh0aGlzLCBlZmZlY3RMaXN0KTsKICAgICAgICAgICAgY29uc3QgZGVzY3JpcHRvcnMgPSB7CiAgICAgICAgICAgICAgICBpbmRleDogewogICAgICAgICAgICAgICAgICAgIHZhbHVlOiBpbmRleCwKICAgICAgICAgICAgICAgICAgICB3cml0YWJsZTogZmFsc2UKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGhpcywgZGVzY3JpcHRvcnMpCiAgICAgICAgfQogICAgICAgIGdldCBuYW1lKCkgewogICAgICAgICAgICBjb25zdCBlZmZlY3RUeXBlcyA9IG1hcC5nZXQodGhpcykuR2V0QWxsRWZmZWN0VHlwZXMoKTsKICAgICAgICAgICAgcmV0dXJuIGVmZmVjdFR5cGVzW3RoaXMuaW5kZXhdLkdldE5hbWUoKQogICAgICAgIH0KICAgICAgICBnZXQgaXNBY3RpdmUoKSB7CiAgICAgICAgICAgIHJldHVybiBtYXAuZ2V0KHRoaXMpLklzRWZmZWN0SW5kZXhBY3RpdmUodGhpcy5pbmRleCkKICAgICAgICB9CiAgICAgICAgc2V0IGlzQWN0aXZlKGEpIHsKICAgICAgICAgICAgYSA9ICEhYTsKICAgICAgICAgICAgY29uc3QgZnhMaXN0ID0gbWFwLmdldCh0aGlzKTsKICAgICAgICAgICAgaWYgKGZ4TGlzdC5Jc0VmZmVjdEluZGV4QWN0aXZlKHRoaXMuaW5kZXgpID09PSBhKSByZXR1cm47CiAgICAgICAgICAgIGZ4TGlzdC5TZXRFZmZlY3RJbmRleEFjdGl2ZSh0aGlzLmluZGV4LAogICAgICAgICAgICAgICAgYSk7CiAgICAgICAgICAgIGZ4TGlzdC5VcGRhdGVBY3RpdmVFZmZlY3RzKCk7CiAgICAgICAgICAgIGZ4TGlzdC5HZXRSdW50aW1lKCkuVXBkYXRlUmVuZGVyKCkKICAgICAgICB9CiAgICAgICAgc2V0UGFyYW1ldGVyKGksIHYpIHsKICAgICAgICAgICAgQzNYLlJlcXVpcmVGaW5pdGVOdW1iZXIoaSk7CiAgICAgICAgICAgIGkgPSBNYXRoLmZsb29yKCtpKTsKICAgICAgICAgICAgY29uc3QgZnhMaXN0ID0gbWFwLmdldCh0aGlzKTsKICAgICAgICAgICAgY29uc3Qgb2xkVmFsdWUgPSBmeExpc3QuR2V0RWZmZWN0UGFyYW1ldGVyKHRoaXMuaW5kZXgsIGkpOwogICAgICAgICAgICBpZiAob2xkVmFsdWUgPT09IG51bGwpIHRocm93IG5ldyBSYW5nZUVycm9yKCJpbnZhbGlkIGluZGV4Iik7CiAgICAgICAgICAgIGlmIChvbGRWYWx1ZSBpbnN0YW5jZW9mIEMzLkNvbG9yKSB7CiAgICAgICAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkodikgfHwgdi5sZW5ndGggPCAzKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJleHBlY3RlZCBhcnJheSB3aXRoIDMgZWxlbWVudHMiKTsKICAgICAgICAgICAgICAgIHRlbXBDb2xvci5zZXRSZ2IodlswXSwgdlsxXSwgdlsyXSk7CiAgICAgICAgICAgICAgICB2ID0gdGVtcENvbG9yCiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHYgIT09ICJudW1iZXIiKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJleHBlY3RlZCBudW1iZXIiKTsKICAgICAgICAgICAgY29uc3QgZGlkQ2hhbmdlID0KICAgICAgICAgICAgICAgIGZ4TGlzdC5TZXRFZmZlY3RQYXJhbWV0ZXIodGhpcy5pbmRleCwgaSwgdik7CiAgICAgICAgICAgIGlmIChkaWRDaGFuZ2UgJiYgZnhMaXN0LklzRWZmZWN0SW5kZXhBY3RpdmUodGhpcy5pbmRleCkpIGZ4TGlzdC5HZXRSdW50aW1lKCkuVXBkYXRlUmVuZGVyKCkKICAgICAgICB9CiAgICAgICAgZ2V0UGFyYW1ldGVyKGkpIHsKICAgICAgICAgICAgQzNYLlJlcXVpcmVGaW5pdGVOdW1iZXIoaSk7CiAgICAgICAgICAgIGkgPSBNYXRoLmZsb29yKCtpKTsKICAgICAgICAgICAgY29uc3QgZnhMaXN0ID0gbWFwLmdldCh0aGlzKTsKICAgICAgICAgICAgY29uc3QgcmV0ID0gZnhMaXN0LkdldEVmZmVjdFBhcmFtZXRlcih0aGlzLmluZGV4LCBpKTsKICAgICAgICAgICAgaWYgKHJldCA9PT0gbnVsbCkgdGhyb3cgbmV3IFJhbmdlRXJyb3IoImludmFsaWQgaW5kZXgiKTsKICAgICAgICAgICAgaWYgKHJldCBpbnN0YW5jZW9mIEMzLkNvbG9yKSByZXR1cm4gW3JldC5nZXRSKCksIHJldC5nZXRHKCksIHJldC5nZXRCKCldOwogICAgICAgICAgICBlbHNlIHJldHVybiByZXQKICAgICAgICB9CiAgICB9OwoKfQoKLy8gaW50ZXJmYWNlcy9JQW5pbWF0aW9uLmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIGNvbnN0IEMzWCA9IHNlbGYuQzNYOwogICAgY29uc3QgbWFwID0gbmV3IFdlYWtNYXA7CiAgICBzZWxmLklBbmltYXRpb24gPSBjbGFzcyBJQW5pbWF0aW9uIHsKICAgICAgICBjb25zdHJ1Y3RvcihhbmltYXRpb25JbmZvKSB7CiAgICAgICAgICAgIG1hcC5zZXQodGhpcywgYW5pbWF0aW9uSW5mbyk7CiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRoaXMsIHsKICAgICAgICAgICAgICAgIG5hbWU6IHsKICAgICAgICAgICAgICAgICAgICB2YWx1ZTogYW5pbWF0aW9uSW5mby5HZXROYW1lKCksCiAgICAgICAgICAgICAgICAgICAgd3JpdGFibGU6IGZhbHNlCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgc3BlZWQ6IHsKICAgICAgICAgICAgICAgICAgICB2YWx1ZTogYW5pbWF0aW9uSW5mby5HZXRTcGVlZCgpLAogICAgICAgICAgICAgICAgICAgIHdyaXRhYmxlOiBmYWxzZQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGlzTG9vcGluZzogewogICAgICAgICAgICAgICAgICAgIHZhbHVlOiBhbmltYXRpb25JbmZvLklzTG9vcGluZygpLAogICAgICAgICAgICAgICAgICAgIHdyaXRhYmxlOiBmYWxzZQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHJlcGVhdENvdW50OiB7CiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGFuaW1hdGlvbkluZm8uR2V0UmVwZWF0Q291bnQoKSwKICAgICAgICAgICAgICAgICAgICB3cml0YWJsZTogZmFsc2UKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICByZXBlYXRUbzogewogICAgICAgICAgICAgICAgICAgIHZhbHVlOiBhbmltYXRpb25JbmZvLkdldFJlcGVhdFRvKCksCiAgICAgICAgICAgICAgICAgICAgd3JpdGFibGU6IGZhbHNlCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgaXNQaW5nUG9uZzogewogICAgICAgICAgICAgICAgICAgIHZhbHVlOiBhbmltYXRpb25JbmZvLklzUGluZ1BvbmcoKSwKICAgICAgICAgICAgICAgICAgICB3cml0YWJsZTogZmFsc2UKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBmcmFtZUNvdW50OiB7CiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGFuaW1hdGlvbkluZm8uR2V0RnJhbWVDb3VudCgpLAogICAgICAgICAgICAgICAgICAgIHdyaXRhYmxlOiBmYWxzZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgIH0KICAgICAgICBnZXRGcmFtZXMoKSB7CiAgICAgICAgICAgIHJldHVybiBtYXAuZ2V0KHRoaXMpLkdldEZyYW1lcygpLm1hcChmID0+IGYuR2V0SUFuaW1hdGlvbkZyYW1lKCkpCiAgICAgICAgfSogZnJhbWVzKCkgewogICAgICAgICAgICBmb3IgKGNvbnN0IGYgb2YgbWFwLmdldCh0aGlzKS5HZXRGcmFtZXMoKSkgeWllbGQgZi5HZXRJQW5pbWF0aW9uRnJhbWUoKQogICAgICAgIH0KICAgIH07Cgp9CgovLyBpbnRlcmZhY2VzL0lJbWFnZUluZm8uanMKewogICAgJ3VzZSBzdHJpY3QnOwogICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgY29uc3QgQzNYID0gc2VsZi5DM1g7CiAgICBjb25zdCBtYXAgPSBuZXcgV2Vha01hcDsKICAgIHNlbGYuSUltYWdlSW5mbyA9IGNsYXNzIElJbWFnZUluZm8gewogICAgICAgIGNvbnN0cnVjdG9yKGltYWdlSW5mbykgewogICAgICAgICAgICBtYXAuc2V0KHRoaXMsIGltYWdlSW5mbykKICAgICAgICB9CiAgICAgICAgZ2V0IHdpZHRoKCkgewogICAgICAgICAgICByZXR1cm4gbWFwLmdldCh0aGlzKS5HZXRXaWR0aCgpCiAgICAgICAgfQogICAgICAgIGdldCBoZWlnaHQoKSB7CiAgICAgICAgICAgIHJldHVybiBtYXAuZ2V0KHRoaXMpLkdldEhlaWdodCgpCiAgICAgICAgfQogICAgICAgIGdldFNpemUoKSB7CiAgICAgICAgICAgIGNvbnN0IGltYWdlSW5mbyA9IG1hcC5nZXQodGhpcyk7CiAgICAgICAgICAgIHJldHVybiBbaW1hZ2VJbmZvLkdldFdpZHRoKCksIGltYWdlSW5mby5HZXRIZWlnaHQoKV0KICAgICAgICB9CiAgICB9OwoKfQoKLy8gaW50ZXJmYWNlcy9JQW5pbWF0aW9uRnJhbWUuanMKewogICAgJ3VzZSBzdHJpY3QnOwogICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgY29uc3QgQzNYID0gc2VsZi5DM1g7CiAgICBjb25zdCBtYXAgPSBuZXcgV2Vha01hcDsKICAgIHNlbGYuSUFuaW1hdGlvbkZyYW1lID0gY2xhc3MgSUFuaW1hdGlvbkZyYW1lIGV4dGVuZHMgc2VsZi5JSW1hZ2VJbmZvIHsKICAgICAgICBjb25zdHJ1Y3RvcihhbmltYXRpb25GcmFtZUluZm8pIHsKICAgICAgICAgICAgc3VwZXIoYW5pbWF0aW9uRnJhbWVJbmZvLkdldEltYWdlSW5mbygpKTsKICAgICAgICAgICAgbWFwLnNldCh0aGlzLCBhbmltYXRpb25GcmFtZUluZm8pOwogICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0aGlzLCB7CiAgICAgICAgICAgICAgICBkdXJhdGlvbjogewogICAgICAgICAgICAgICAgICAgIHZhbHVlOiBhbmltYXRpb25GcmFtZUluZm8uR2V0RHVyYXRpb24oKSwKICAgICAgICAgICAgICAgICAgICB3cml0YWJsZTogZmFsc2UKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBvcmlnaW5YOiB7CiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGFuaW1hdGlvbkZyYW1lSW5mby5HZXRPcmlnaW5YKCksCiAgICAgICAgICAgICAgICAgICAgd3JpdGFibGU6IGZhbHNlCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgb3JpZ2luWTogewogICAgICAgICAgICAgICAgICAgIHZhbHVlOiBhbmltYXRpb25GcmFtZUluZm8uR2V0T3JpZ2luWSgpLAogICAgICAgICAgICAgICAgICAgIHdyaXRhYmxlOiBmYWxzZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgIH0KICAgICAgICBnZXRPcmlnaW4oKSB7CiAgICAgICAgICAgIGNvbnN0IGFmaSA9IG1hcC5nZXQodGhpcyk7CiAgICAgICAgICAgIHJldHVybiBbYWZpLkdldE9yaWdpblgoKSwgYWZpLkdldE9yaWdpblkoKV0KICAgICAgICB9CiAgICAgICAgZ2V0SW1hZ2VQb2ludENvdW50KCkgewogICAgICAgICAgICByZXR1cm4gbWFwLmdldCh0aGlzKS5HZXRJbWFnZVBvaW50Q291bnQoKQogICAgICAgIH0KICAgICAgICBnZXRJbWFnZVBvaW50WChuYW1lT3JJbmRleCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRJbWFnZVBvaW50KG5hbWVPckluZGV4KVswXQogICAgICAgIH0KICAgICAgICBnZXRJbWFnZVBvaW50WShuYW1lT3JJbmRleCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRJbWFnZVBvaW50KG5hbWVPckluZGV4KVsxXQogICAgICAgIH0KICAgICAgICBnZXRJbWFnZVBvaW50KG5hbWVPckluZGV4KSB7CiAgICAgICAgICAgIGNvbnN0IGFmaSA9CiAgICAgICAgICAgICAgICBtYXAuZ2V0KHRoaXMpOwogICAgICAgICAgICBsZXQgaXAgPSBudWxsOwogICAgICAgICAgICBpZiAodHlwZW9mIG5hbWVPckluZGV4ID09PSAibnVtYmVyIikgaXAgPSBhZmkuR2V0SW1hZ2VQb2ludEJ5SW5kZXgoTWF0aC5mbG9vcihuYW1lT3JJbmRleCkpOwogICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgbmFtZU9ySW5kZXggPT09ICJzdHJpbmciKSBpcCA9IGFmaS5HZXRJbWFnZVBvaW50QnlOYW1lKG5hbWVPckluZGV4KTsKICAgICAgICAgICAgZWxzZSB0aHJvdyBuZXcgVHlwZUVycm9yKCJleHBlY3RlZCBzdHJpbmcgb3IgbnVtYmVyIik7CiAgICAgICAgICAgIGlmICghaXApIHJldHVybiB0aGlzLmdldE9yaWdpbigpOwogICAgICAgICAgICByZXR1cm4gW2lwLkdldFgoKSwgaXAuR2V0WSgpXQogICAgICAgIH0KICAgICAgICBnZXRQb2x5UG9pbnRDb3VudCgpIHsKICAgICAgICAgICAgY29uc3QgcG9seSA9IG1hcC5nZXQodGhpcykuR2V0Q29sbGlzaW9uUG9seSgpOwogICAgICAgICAgICByZXR1cm4gcG9seSA/IHBvbHkucG9pbnRDb3VudCgpIDogMAogICAgICAgIH0KICAgICAgICBnZXRQb2x5UG9pbnRYKGluZGV4KSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldFBvbHlQb2ludChpbmRleClbMF0KICAgICAgICB9CiAgICAgICAgZ2V0UG9seVBvaW50WShpbmRleCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRQb2x5UG9pbnQoaW5kZXgpWzFdCiAgICAgICAgfQogICAgICAgIGdldFBvbHlQb2ludChpbmRleCkgewogICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcihpbmRleCk7CiAgICAgICAgICAgIGluZGV4ID0gTWF0aC5mbG9vcihpbmRleCk7CiAgICAgICAgICAgIGNvbnN0IHBvbHkgPSBtYXAuZ2V0KHRoaXMpLkdldENvbGxpc2lvblBvbHkoKTsKICAgICAgICAgICAgaWYgKCFwb2x5IHx8IGluZGV4IDwgMCB8fCBpbmRleCA+PSBwb2x5LnBvaW50Q291bnQoKSkgcmV0dXJuIFswLCAwXTsKICAgICAgICAgICAgY29uc3QgcG9pbnRzQXJyID0gcG9seS5wb2ludHNBcnIoKTsKICAgICAgICAgICAgY29uc3QgcHRYID0gcG9pbnRzQXJyW2luZGV4ICogMl07CiAgICAgICAgICAgIGNvbnN0IHB0WSA9IHBvaW50c0FycltpbmRleCAqIDIgKyAxXTsKICAgICAgICAgICAgcmV0dXJuIFtwdFgsIHB0WV0KICAgICAgICB9CiAgICB9OwoKfQoKLy8gaW50ZXJmYWNlcy9JVGltZWxpbmVTdGF0ZS5qcwp7CiAgICAndXNlIHN0cmljdCc7CiAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICBjb25zdCBDM1ggPSBzZWxmLkMzWDsKICAgIGNvbnN0IG1hcCA9IG5ldyBXZWFrTWFwOwoKICAgIGZ1bmN0aW9uIEdldFRpbWVsaW5lU3RhdGUoaWZhY2UpIHsKICAgICAgICBjb25zdCB0aW1lbGluZVN0YXRlID0gbWFwLmdldChpZmFjZSk7CiAgICAgICAgaWYgKHRpbWVsaW5lU3RhdGUuSXNSZWxlYXNlZCgpKSB0aHJvdyBuZXcgRXJyb3IoInRpbWVsaW5lL3R3ZWVuIHdhcyByZWxlYXNlZCBhbmQgaXMgbm8gbG9uZ2VyIHZhbGlkIik7CiAgICAgICAgcmV0dXJuIHRpbWVsaW5lU3RhdGUKICAgIH0KICAgIHNlbGYuSVRpbWVsaW5lU3RhdGUgPSBjbGFzcyBJVGltZWxpbmVTdGF0ZSB7CiAgICAgICAgY29uc3RydWN0b3IodGltZWxpbmVTdGF0ZSkgewogICAgICAgICAgICBtYXAuc2V0KHRoaXMsIHRpbWVsaW5lU3RhdGUpCiAgICAgICAgfQogICAgICAgIHBhdXNlKCkgewogICAgICAgICAgICBHZXRUaW1lbGluZVN0YXRlKHRoaXMpLlN0b3AoKQogICAgICAgIH0KICAgICAgICByZXN1bWUoKSB7CiAgICAgICAgICAgIEdldFRpbWVsaW5lU3RhdGUodGhpcykuUmVzdW1lKCkKICAgICAgICB9CiAgICAgICAgaGFzVGFncyh0YWdzKSB7CiAgICAgICAgICAgIHJldHVybiBHZXRUaW1lbGluZVN0YXRlKHRoaXMpLkhhc1RhZ3ModGFncykKICAgICAgICB9CiAgICAgICAgc2V0IHRpbWUodCkgewogICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcih0KTsKICAgICAgICAgICAgR2V0VGltZWxpbmVTdGF0ZSh0aGlzKS5TZXRUaW1lKHQpCiAgICAgICAgfQogICAgICAgIGdldCB0aW1lKCkgewogICAgICAgICAgICByZXR1cm4gR2V0VGltZWxpbmVTdGF0ZSh0aGlzKS5HZXRUaW1lKCkKICAgICAgICB9CiAgICAgICAgc2V0IHRvdGFsVGltZSh0KSB7CiAgICAgICAgICAgIEMzWC5SZXF1aXJlRmluaXRlTnVtYmVyKHQpOwogICAgICAgICAgICBHZXRUaW1lbGluZVN0YXRlKHRoaXMpLlNldFRvdGFsVGltZSh0KQogICAgICAgIH0KICAgICAgICBnZXQgdG90YWxUaW1lKCkgewogICAgICAgICAgICByZXR1cm4gR2V0VGltZWxpbmVTdGF0ZSh0aGlzKS5HZXRUb3RhbFRpbWUoKQogICAgICAgIH0KICAgICAgICBzZXQgaXNMb29waW5nKGwpIHsKICAgICAgICAgICAgR2V0VGltZWxpbmVTdGF0ZSh0aGlzKS5TZXRMb29wKCEhbCkKICAgICAgICB9CiAgICAgICAgZ2V0IGlzTG9vcGluZygpIHsKICAgICAgICAgICAgcmV0dXJuIEdldFRpbWVsaW5lU3RhdGUodGhpcykuR2V0TG9vcCgpCiAgICAgICAgfQogICAgICAgIHNldCBpc1BpbmdQb25nKHApIHsKICAgICAgICAgICAgR2V0VGltZWxpbmVTdGF0ZSh0aGlzKS5TZXRQaW5nUG9uZyghIXApCiAgICAgICAgfQogICAgICAgIGdldCBpc1BpbmdQb25nKCkgewogICAgICAgICAgICByZXR1cm4gR2V0VGltZWxpbmVTdGF0ZSh0aGlzKS5HZXRQaW5nUG9uZygpCiAgICAgICAgfQogICAgICAgIHNldCBwbGF5YmFja1JhdGUocCkgewogICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcihwKTsKICAgICAgICAgICAgR2V0VGltZWxpbmVTdGF0ZSh0aGlzKS5TZXRQbGF5YmFja1JhdGUocCkKICAgICAgICB9CiAgICAgICAgZ2V0IHBsYXliYWNrUmF0ZSgpIHsKICAgICAgICAgICAgcmV0dXJuIEdldFRpbWVsaW5lU3RhdGUodGhpcykuR2V0UGxheWJhY2tSYXRlKCkKICAgICAgICB9CiAgICAgICAgZ2V0IHByb2dyZXNzKCkgewogICAgICAgICAgICBjb25zdCB0aW1lbGluZVN0YXRlID0gR2V0VGltZWxpbmVTdGF0ZSh0aGlzKTsKICAgICAgICAgICAgcmV0dXJuIHRpbWVsaW5lU3RhdGUuR2V0VGltZSgpIC8gdGltZWxpbmVTdGF0ZS5HZXRUb3RhbFRpbWUoKQogICAgICAgIH0KICAgICAgICBnZXQgdGFncygpIHsKICAgICAgICAgICAgcmV0dXJuIEdldFRpbWVsaW5lU3RhdGUodGhpcykuR2V0VGFncygpCiAgICAgICAgfQogICAgICAgIGdldCBmaW5pc2hlZCgpIHsKICAgICAgICAgICAgcmV0dXJuIEdldFRpbWVsaW5lU3RhdGUodGhpcykuR2V0UGxheVByb21pc2UoKQogICAgICAgIH0KICAgICAgICBnZXQgaXNQbGF5aW5nKCkgewogICAgICAgICAgICByZXR1cm4gR2V0VGltZWxpbmVTdGF0ZSh0aGlzKS5Jc1BsYXlpbmcoKQogICAgICAgIH0KICAgICAgICBnZXQgaXNQYXVzZWQoKSB7CiAgICAgICAgICAgIHJldHVybiBHZXRUaW1lbGluZVN0YXRlKHRoaXMpLklzUGF1c2VkKCkKICAgICAgICB9CiAgICAgICAgZ2V0IGlzUmVsZWFzZWQoKSB7CiAgICAgICAgICAgIHJldHVybiBtYXAuZ2V0KHRoaXMpLklzUmVsZWFzZWQoKQogICAgICAgIH0KICAgIH07Cgp9CgovLyBpbnRlcmZhY2VzL0lUd2VlblN0YXRlLmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIGNvbnN0IEMzWCA9IHNlbGYuQzNYOwogICAgY29uc3QgbWFwID0gbmV3IFdlYWtNYXA7CiAgICBjb25zdCBiZWhJbnN0TWFwID0gbmV3IFdlYWtNYXA7CiAgICBsZXQgZWFzZVRvSW5kZXhGdW5jID0gbnVsbDsKCiAgICBmdW5jdGlvbiBHZXRUd2VlblN0YXRlKGlmYWNlKSB7CiAgICAgICAgY29uc3QgdHdlZW5TdGF0ZSA9IG1hcC5nZXQoaWZhY2UpOwogICAgICAgIGlmICh0d2VlblN0YXRlLklzUmVsZWFzZWQoKSkgdGhyb3cgbmV3IEVycm9yKCJ0aW1lbGluZS90d2VlbiB3YXMgcmVsZWFzZWQgYW5kIGlzIG5vIGxvbmdlciB2YWxpZCIpOwogICAgICAgIHJldHVybiB0d2VlblN0YXRlCiAgICB9CiAgICBzZWxmLklUd2VlblN0YXRlID0gY2xhc3MgSVR3ZWVuU3RhdGUgZXh0ZW5kcyBzZWxmLklUaW1lbGluZVN0YXRlIHsKICAgICAgICBjb25zdHJ1Y3Rvcih0d2VlblN0YXRlLCBiZWhJbnN0LCBvcHRzKSB7CiAgICAgICAgICAgIHN1cGVyKHR3ZWVuU3RhdGUpOwogICAgICAgICAgICBpZiAoIWVhc2VUb0luZGV4RnVuYykgZWFzZVRvSW5kZXhGdW5jID0gb3B0cy5lYXNlVG9JbmRleEZ1bmM7CiAgICAgICAgICAgIG1hcC5zZXQodGhpcywgdHdlZW5TdGF0ZSk7CiAgICAgICAgICAgIGlmIChiZWhJbnN0KSBiZWhJbnN0TWFwLnNldCh0aGlzLCBiZWhJbnN0KQogICAgICAgIH0KICAgICAgICBzdG9wKCkgewogICAgICAgICAgICBjb25zdCB0d2VlblN0YXRlID0gR2V0VHdlZW5TdGF0ZSh0aGlzKTsKICAgICAgICAgICAgY29uc3QgYmVoSW5zdCA9IGJlaEluc3RNYXAuZ2V0KHRoaXMpOwogICAgICAgICAgICBiZWhJbnN0LlJlbGVhc2VUd2Vlbih0d2VlblN0YXRlKQogICAgICAgIH0KICAgICAgICBzZXRFYXNlKGVhc2VOYW1lKSB7CiAgICAgICAgICAgIEMzWC5SZXF1aXJlU3RyaW5nKGVhc2VOYW1lKTsKICAgICAgICAgICAgY29uc3QgZWFzZSA9IHNlbGYuRWFzZS5HZXRFYXNlRnJvbUluZGV4KGVhc2VUb0luZGV4RnVuYyhlYXNlTmFtZSkpOwogICAgICAgICAgICBHZXRUd2VlblN0YXRlKHRoaXMpLlNldEVhc2UoZWFzZSkKICAgICAgICB9CiAgICAgICAgZ2V0IGluc3RhbmNlKCkgewogICAgICAgICAgICBjb25zdCBpbnN0ID0KICAgICAgICAgICAgICAgIEdldFR3ZWVuU3RhdGUodGhpcykuR2V0SW5zdGFuY2UoKTsKICAgICAgICAgICAgcmV0dXJuIGluc3QgPyBpbnN0LkdldEludGVyZmFjZUNsYXNzKCkgOiBudWxsCiAgICAgICAgfQogICAgICAgIGdldCBpc0Rlc3Ryb3lPbkNvbXBsZXRlKCkgewogICAgICAgICAgICByZXR1cm4gR2V0VHdlZW5TdGF0ZSh0aGlzKS5HZXREZXN0cm95SW5zdGFuY2VPbkNvbXBsZXRlKCkKICAgICAgICB9CiAgICAgICAgc2V0IGlzRGVzdHJveU9uQ29tcGxldGUoZCkgewogICAgICAgICAgICBHZXRUd2VlblN0YXRlKHRoaXMpLlNldERlc3Ryb3lJbnN0YW5jZU9uQ29tcGxldGUoISFkKQogICAgICAgIH0KICAgICAgICBnZXQgdmFsdWUoKSB7CiAgICAgICAgICAgIGNvbnN0IHR3ZWVuU3RhdGUgPSBHZXRUd2VlblN0YXRlKHRoaXMpOwogICAgICAgICAgICBpZiAodHdlZW5TdGF0ZS5HZXRJZCgpICE9PSAidmFsdWUiKSB0aHJvdyBuZXcgRXJyb3IoIm5vdCBhIHZhbHVlIHR3ZWVuIik7CiAgICAgICAgICAgIHJldHVybiB0d2VlblN0YXRlLkdldFByb3BlcnR5VHJhY2soInZhbHVlIikuR2V0U291cmNlQWRhcHRlclZhbHVlKCkKICAgICAgICB9CiAgICB9OwoKfQoKLy8gYXNzZXRzL2Fzc2V0TWFuYWdlci5qcwp7CiAgICAndXNlIHN0cmljdCc7CiAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICBjb25zdCBWQUxJRF9MT0FEX1BPTElDSUVTID0gbmV3IFNldChbImxvY2FsIiwgInJlbW90ZSJdKTsKICAgIGNvbnN0IEVYVF9UT19UWVBFID0gbmV3IE1hcChbCiAgICAgICAgWyJtcDQiLCAidmlkZW8vbXA0Il0sCiAgICAgICAgWyJ3ZWJtIiwgInZpZGVvL3dlYm0iXSwKICAgICAgICBbIm00YSIsICJhdWRpby9tcDQiXSwKICAgICAgICBbIm1wMyIsICJhdWRpby9tcGVnIl0sCiAgICAgICAgWyJqcyIsICJhcHBsaWNhdGlvbi9qYXZhc2NyaXB0Il0sCiAgICAgICAgWyJ3YXNtIiwgImFwcGxpY2F0aW9uL3dhc20iXSwKICAgICAgICBbInN2ZyIsICJpbWFnZS9zdmcreG1sIl0sCiAgICAgICAgWyJodG1sIiwgInRleHQvaHRtbCJdCiAgICBdKTsKCiAgICBmdW5jdGlvbiBHZXRUeXBlRnJvbUZpbGVFeHRlbnNpb24oZmlsZW5hbWUpIHsKICAgICAgICBpZiAoIWZpbGVuYW1lKSByZXR1cm4gIiI7CiAgICAgICAgY29uc3QgcGFydHMgPSBmaWxlbmFtZS5zcGxpdCgiLiIpOwogICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPCAyKSByZXR1cm4gIiI7CiAgICAgICAgY29uc3QgZXh0ID0gcGFydHMuYXQoLTEpLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgcmV0dXJuIEVYVF9UT19UWVBFLmdldChleHQpIHx8ICIiCiAgICB9CgogICAgZnVuY3Rpb24gQWRkU2NyaXB0KHVybCkgewogICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICAgICAgICAgIGNvbnN0IGVsZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzY3JpcHQiKTsKICAgICAgICAgICAgZWxlbS5vbmxvYWQgPSByZXNvbHZlOwogICAgICAgICAgICBlbGVtLm9uZXJyb3IgPSByZWplY3Q7CiAgICAgICAgICAgIGVsZW0uYXN5bmMgPSBmYWxzZTsKICAgICAgICAgICAgZWxlbS50eXBlID0gIm1vZHVsZSI7CiAgICAgICAgICAgIGVsZW0uc3JjID0gdXJsOwogICAgICAgICAgICBkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKGVsZW0pCiAgICAgICAgfSkKICAgIH0KICAgIEMzLkFzc2V0TWFuYWdlciA9IGNsYXNzIEFzc2V0TWFuYWdlciBleHRlbmRzIEMzLkRlZmVuZGVkQmFzZSB7CiAgICAgICAgY29uc3RydWN0b3IocnVudGltZSwgb3B0cykgewogICAgICAgICAgICBzdXBlcigpOwogICAgICAgICAgICBjb25zdCBleHBvcnRUeXBlID0gb3B0c1siZXhwb3J0VHlwZSJdOwogICAgICAgICAgICB0aGlzLl9ydW50aW1lID0gcnVudGltZTsKICAgICAgICAgICAgdGhpcy5fZmlsZVN0cnVjdHVyZSA9ICJmb2xkZXJzIjsKICAgICAgICAgICAgdGhpcy5fbG9jYWxVcmxCbG9icyA9IG5ldyBNYXA7CiAgICAgICAgICAgIHRoaXMuX2xvY2FsQmxvYlVybENhY2hlID0gbmV3IE1hcDsKICAgICAgICAgICAgdGhpcy5fbG9jYWxCbG9iU1dVcmxzID0gbmV3IE1hcDsKICAgICAgICAgICAgdGhpcy5faXNDb3Jkb3ZhID0gZXhwb3J0VHlwZSA9PT0gImNvcmRvdmEiOwogICAgICAgICAgICB0aGlzLl9pc2lPU0NvcmRvdmEgPSAhIW9wdHNbImlzaU9TQ29yZG92YSJdOwogICAgICAgICAgICB0aGlzLl9pc0ZpbGVQcm90b2NvbCA9ICEhb3B0c1siaXNGaWxlUHJvdG9jb2wiXTsKICAgICAgICAgICAgdGhpcy5fc3dDbGllbnRJZCA9IG9wdHNbInN3Q2xpZW50SWQiXTsKICAgICAgICAgICAgdGhpcy5fc3VwcG9ydGVkQXVkaW9Gb3JtYXRzID0gb3B0c1sic3VwcG9ydGVkQXVkaW9Gb3JtYXRzIl0gfHwge307CiAgICAgICAgICAgIHRoaXMuX2F1ZGlvRmlsZXMgPQogICAgICAgICAgICAgICAgbmV3IE1hcDsKICAgICAgICAgICAgdGhpcy5fcHJlbG9hZFNvdW5kcyA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl9tZWRpYVN1YmZvbGRlciA9ICIiOwogICAgICAgICAgICB0aGlzLl9mb250c1N1YmZvbGRlciA9ICIiOwogICAgICAgICAgICB0aGlzLl9pY29uc1N1YmZvbGRlciA9ICIiOwogICAgICAgICAgICBjb25zdCBpc1JlbW90ZUxvYWRQb2xpY3kgPSBleHBvcnRUeXBlID09PSAiaHRtbDUiIHx8IGV4cG9ydFR5cGUgPT09ICJzY2lycmEtYXJjYWRlIiB8fCBleHBvcnRUeXBlID09PSAiaW5zdGFudC1nYW1lcyI7CiAgICAgICAgICAgIHRoaXMuX2RlZmF1bHRMb2FkUG9saWN5ID0gaXNSZW1vdGVMb2FkUG9saWN5ID8gInJlbW90ZSIgOiAibG9jYWwiOwogICAgICAgICAgICB0aGlzLl9hbGxBc3NldHMgPSBbXTsKICAgICAgICAgICAgdGhpcy5fYXNzZXRzQnlVcmwgPSBuZXcgTWFwOwogICAgICAgICAgICB0aGlzLl93ZWJGb250cyA9IFtdOwogICAgICAgICAgICB0aGlzLl9sb2FkUHJvbWlzZXMgPSBbXTsKICAgICAgICAgICAgdGhpcy5faGFzRmluaXNoZWRJbml0aWFsTG9hZCA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl90b3RhbEFzc2V0U2l6ZVRvTG9hZCA9IDA7CiAgICAgICAgICAgIHRoaXMuX2Fzc2V0U2l6ZUxvYWRlZCA9IDA7CiAgICAgICAgICAgIHRoaXMuX2xhc3RMb2FkUHJvZ3Jlc3MgPSAwOwogICAgICAgICAgICB0aGlzLl9oYXNIYWRFcnJvckxvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5fbG9hZGluZ1JhdGVMaW1pdGVyID0gQzMuTmV3KEMzLlJhdGVMaW1pdGVyLCAoKSA9PiB0aGlzLl9GaXJlTG9hZGluZ1Byb2dyZXNzRXZlbnQoKSwgNTApOwogICAgICAgICAgICB0aGlzLl9wcm9taXNlVGhyb3R0bGUgPSBuZXcgQzMuUHJvbWlzZVRocm90dGxlKE1hdGgubWF4KEMzLmhhcmR3YXJlQ29uY3VycmVuY3ksIDgpKTsKICAgICAgICAgICAgY29uc3QgbG9jYWxVcmxCbG9icyA9IG9wdHNbInByZXZpZXdJbWFnZUJsb2JzIl07CiAgICAgICAgICAgIGlmIChsb2NhbFVybEJsb2JzKSB7CiAgICAgICAgICAgICAgICBjb25zdCBwcm9qZWN0RmlsZUJsb2JzID0gb3B0c1sicHJldmlld1Byb2plY3RGaWxlQmxvYnMiXTsKICAgICAgICAgICAgICAgIGlmIChwcm9qZWN0RmlsZUJsb2JzKSBPYmplY3QuYXNzaWduKGxvY2FsVXJsQmxvYnMsIHByb2plY3RGaWxlQmxvYnMpOwogICAgICAgICAgICAgICAgY29uc3QgcHJvamVjdERhdGEgPSBvcHRzWyJwcm9qZWN0RGF0YSJdOwogICAgICAgICAgICAgICAgaWYgKHByb2plY3REYXRhKSBsb2NhbFVybEJsb2JzWyJkYXRhLmpzb24iXSA9IHByb2plY3REYXRhOwogICAgICAgICAgICAgICAgZm9yIChjb25zdCBbdXJsLCBibG9iXSBvZiBPYmplY3QuZW50cmllcyhsb2NhbFVybEJsb2JzKSkgdGhpcy5fbG9jYWxVcmxCbG9icy5zZXQodXJsLAogICAgICAgICAgICAgICAgICAgIGJsb2IpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgbG9jYWxTV1VybE1hcCA9IG9wdHNbInByZXZpZXdQcm9qZWN0RmlsZVNXVXJscyJdOwogICAgICAgICAgICBpZiAobG9jYWxTV1VybE1hcCkKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgW3NyY1VybCwgZGVzdFVybF0gb2YgT2JqZWN0LmVudHJpZXMobG9jYWxTV1VybE1hcCkpIHRoaXMuX2xvY2FsQmxvYlNXVXJscy5zZXQoc3JjVXJsLCBkZXN0VXJsKTsKICAgICAgICAgICAgdGhpcy5faUFzc2V0TWFuYWdlciA9IG5ldyBzZWxmLklBc3NldE1hbmFnZXIodGhpcykKICAgICAgICB9CiAgICAgICAgUmVsZWFzZSgpIHsKICAgICAgICAgICAgdGhpcy5fbG9jYWxVcmxCbG9icy5jbGVhcigpOwogICAgICAgICAgICBmb3IgKGNvbnN0IHVybCBvZiB0aGlzLl9sb2NhbEJsb2JVcmxDYWNoZS52YWx1ZXMoKSkKICAgICAgICAgICAgICAgIGlmICh1cmwuc3RhcnRzV2l0aCgiYmxvYjoiKSkgVVJMLnJldm9rZU9iamVjdFVSTCh1cmwpOwogICAgICAgICAgICB0aGlzLl9sb2NhbEJsb2JVcmxDYWNoZS5jbGVhcigpOwogICAgICAgICAgICBmb3IgKGNvbnN0IGFzc2V0IG9mIHRoaXMuX2FsbEFzc2V0cykgYXNzZXQuUmVsZWFzZSgpOwogICAgICAgICAgICBDMy5jbGVhckFycmF5KHRoaXMuX2FsbEFzc2V0cyk7CiAgICAgICAgICAgIHRoaXMuX2Fzc2V0c0J5VXJsLmNsZWFyKCk7CiAgICAgICAgICAgIEMzLmNsZWFyQXJyYXkodGhpcy5fbG9hZFByb21pc2VzKTsKICAgICAgICAgICAgdGhpcy5fcnVudGltZSA9IG51bGwKICAgICAgICB9CiAgICAgICAgR2V0UnVudGltZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUKICAgICAgICB9CiAgICAgICAgX1NldEZpbGVTdHJ1Y3R1cmUoZikgewogICAgICAgICAgICB0aGlzLl9maWxlU3RydWN0dXJlID0gZjsKICAgICAgICAgICAgaWYgKGYgPT09ICJmbGF0IikgewogICAgICAgICAgICAgICAgY29uc3QgbmV3TWFwID0gbmV3IE1hcDsKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgW3VybCwgYmxvYl0gb2YgdGhpcy5fbG9jYWxVcmxCbG9icy5lbnRyaWVzKCkpIG5ld01hcC5zZXQodXJsLnRvTG93ZXJDYXNlKCksIGJsb2IpOwogICAgICAgICAgICAgICAgdGhpcy5fbG9jYWxVcmxCbG9icyA9IG5ld01hcAogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIEdldEZpbGVTdHJ1Y3R1cmUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9maWxlU3RydWN0dXJlCiAgICAgICAgfQogICAgICAgIF9TZXRNZWRpYVN1YmZvbGRlcihmb2xkZXIpIHsKICAgICAgICAgICAgdGhpcy5fbWVkaWFTdWJmb2xkZXIgPSBmb2xkZXIKICAgICAgICB9CiAgICAgICAgR2V0TWVkaWFTdWJmb2xkZXIoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9tZWRpYVN1YmZvbGRlcgogICAgICAgIH0KICAgICAgICBfU2V0Rm9udHNTdWJmb2xkZXIoZm9sZGVyKSB7CiAgICAgICAgICAgIHRoaXMuX2ZvbnRzU3ViZm9sZGVyID0gZm9sZGVyCiAgICAgICAgfQogICAgICAgIEdldEZvbnRzU3ViZm9sZGVyKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZm9udHNTdWJmb2xkZXIKICAgICAgICB9CiAgICAgICAgX1NldEljb25zU3ViZm9sZGVyKGZvbGRlcikgewogICAgICAgICAgICB0aGlzLl9pY29uc1N1YmZvbGRlciA9CiAgICAgICAgICAgICAgICBmb2xkZXIKICAgICAgICB9CiAgICAgICAgR2V0SWNvbnNTdWJmb2xkZXIoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pY29uc1N1YmZvbGRlcgogICAgICAgIH0KICAgICAgICBJc0ZpbGVQcm90b2NvbCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2lzRmlsZVByb3RvY29sCiAgICAgICAgfQogICAgICAgIF9IYXNMb2NhbFVybEJsb2IodXJsKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9maWxlU3RydWN0dXJlID09PSAiZmxhdCIpIHVybCA9IHVybC50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICByZXR1cm4gdGhpcy5fbG9jYWxVcmxCbG9icy5oYXModXJsKQogICAgICAgIH0KICAgICAgICBfR2V0TG9jYWxVcmxCbG9iKHVybCkgewogICAgICAgICAgICBpZiAodGhpcy5fZmlsZVN0cnVjdHVyZSA9PT0gImZsYXQiKSB1cmwgPSB1cmwudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2xvY2FsVXJsQmxvYnMuZ2V0KHVybCkgfHwgbnVsbAogICAgICAgIH0KICAgICAgICBHZXRMb2NhbFVybEFzQmxvYlVybCh1cmwpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX2ZpbGVTdHJ1Y3R1cmUgPT09ICJmbGF0IikgdXJsID0gdXJsLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgIGlmICghdGhpcy5fSGFzTG9jYWxVcmxCbG9iKHVybCkpIHJldHVybiB1cmw7CiAgICAgICAgICAgIGxldCByZXQgPSB0aGlzLl9sb2NhbEJsb2JVcmxDYWNoZS5nZXQodXJsKTsKICAgICAgICAgICAgaWYgKCFyZXQpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGJsb2IgPQogICAgICAgICAgICAgICAgICAgIHRoaXMuX0dldExvY2FsVXJsQmxvYih1cmwpOwogICAgICAgICAgICAgICAgcmV0ID0gVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTsKICAgICAgICAgICAgICAgIHRoaXMuX2xvY2FsQmxvYlVybENhY2hlLnNldCh1cmwsIHJldCkKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcmV0CiAgICAgICAgfQogICAgICAgIEZldGNoQmxvYih1cmwsIGxvYWRQb2xpY3kpIHsKICAgICAgICAgICAgbG9hZFBvbGljeSA9IGxvYWRQb2xpY3kgfHwgdGhpcy5fZGVmYXVsdExvYWRQb2xpY3k7CiAgICAgICAgICAgIGNvbnN0IGxvY2FsQmxvYiA9IHRoaXMuX0dldExvY2FsVXJsQmxvYih1cmwpOwogICAgICAgICAgICBpZiAobG9jYWxCbG9iKSByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGxvY2FsQmxvYik7CiAgICAgICAgICAgIGVsc2UgaWYgKEMzLklzUmVsYXRpdmVVUkwodXJsKSkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuX2ZpbGVTdHJ1Y3R1cmUgPT09ICJmbGF0IikgdXJsID0gdXJsLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5faXNDb3Jkb3ZhICYmIHRoaXMuX2lzRmlsZVByb3RvY29sKSByZXR1cm4gdGhpcy5Db3Jkb3ZhRmV0Y2hMb2NhbEZpbGVBc0Jsb2IodXJsKTsKICAgICAgICAgICAgICAgIGVsc2UgaWYgKGxvYWRQb2xpY3kgPT09ICJsb2NhbCIpIHJldHVybiB0aGlzLl9wcm9taXNlVGhyb3R0bGUuQWRkKCgpID0+CiAgICAgICAgICAgICAgICAgICAgQzMuRmV0Y2hCbG9iKHVybCkpOwogICAgICAgICAgICAgICAgZWxzZSByZXR1cm4gQzMuRmV0Y2hCbG9iKHVybCkKICAgICAgICAgICAgfSBlbHNlIHJldHVybiBDMy5GZXRjaEJsb2IodXJsKQogICAgICAgIH0KICAgICAgICBGZXRjaEFycmF5QnVmZmVyKHVybCkgewogICAgICAgICAgICBjb25zdCBsb2NhbEJsb2IgPSB0aGlzLl9HZXRMb2NhbFVybEJsb2IodXJsKTsKICAgICAgICAgICAgaWYgKGxvY2FsQmxvYikgcmV0dXJuIEMzLkJsb2JUb0FycmF5QnVmZmVyKGxvY2FsQmxvYik7CiAgICAgICAgICAgIGVsc2UgaWYgKEMzLklzUmVsYXRpdmVVUkwodXJsKSkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuX2ZpbGVTdHJ1Y3R1cmUgPT09ICJmbGF0IikgdXJsID0gdXJsLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5faXNDb3Jkb3ZhICYmIHRoaXMuX2lzRmlsZVByb3RvY29sKSByZXR1cm4gdGhpcy5Db3Jkb3ZhRmV0Y2hMb2NhbEZpbGVBc0FycmF5QnVmZmVyKHVybCk7CiAgICAgICAgICAgICAgICBlbHNlIGlmICh0aGlzLl9kZWZhdWx0TG9hZFBvbGljeSA9PT0gImxvY2FsIikgcmV0dXJuIHRoaXMuX3Byb21pc2VUaHJvdHRsZS5BZGQoKCkgPT4gQzMuRmV0Y2hBcnJheUJ1ZmZlcih1cmwpKTsKICAgICAgICAgICAgICAgIGVsc2UgcmV0dXJuIEMzLkZldGNoQXJyYXlCdWZmZXIodXJsKQogICAgICAgICAgICB9IGVsc2UgcmV0dXJuIEMzLkZldGNoQXJyYXlCdWZmZXIodXJsKQogICAgICAgIH0KICAgICAgICBGZXRjaFRleHQodXJsKSB7CiAgICAgICAgICAgIGNvbnN0IGxvY2FsQmxvYiA9CiAgICAgICAgICAgICAgICB0aGlzLl9HZXRMb2NhbFVybEJsb2IodXJsKTsKICAgICAgICAgICAgaWYgKGxvY2FsQmxvYikgcmV0dXJuIEMzLkJsb2JUb1N0cmluZyhsb2NhbEJsb2IpOwogICAgICAgICAgICBlbHNlIGlmIChDMy5Jc1JlbGF0aXZlVVJMKHVybCkpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9maWxlU3RydWN0dXJlID09PSAiZmxhdCIpIHVybCA9IHVybC50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuX2lzQ29yZG92YSAmJiB0aGlzLl9pc0ZpbGVQcm90b2NvbCkgcmV0dXJuIHRoaXMuQ29yZG92YUZldGNoTG9jYWxGaWxlQXNUZXh0KHVybCk7CiAgICAgICAgICAgICAgICBlbHNlIGlmICh0aGlzLl9kZWZhdWx0TG9hZFBvbGljeSA9PT0gImxvY2FsIikgcmV0dXJuIHRoaXMuX3Byb21pc2VUaHJvdHRsZS5BZGQoKCkgPT4gQzMuRmV0Y2hUZXh0KHVybCkpOwogICAgICAgICAgICAgICAgZWxzZSByZXR1cm4gQzMuRmV0Y2hUZXh0KHVybCkKICAgICAgICAgICAgfSBlbHNlIHJldHVybiBDMy5GZXRjaFRleHQodXJsKQogICAgICAgIH0KICAgICAgICBhc3luYyBGZXRjaEpzb24odXJsKSB7CiAgICAgICAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCB0aGlzLkZldGNoVGV4dCh1cmwpOwogICAgICAgICAgICByZXR1cm4gSlNPTi5wYXJzZSh0ZXh0KQogICAgICAgIH0KICAgICAgICBfQ29yZG92YUZldGNoTG9jYWxGaWxlQXMoZmlsZW5hbWUsCiAgICAgICAgICAgIGFzXykgewogICAgICAgICAgICBpZiAodGhpcy5fZmlsZVN0cnVjdHVyZSA9PT0gImZsYXQiKSBmaWxlbmFtZSA9IGZpbGVuYW1lLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lLlBvc3RDb21wb25lbnRNZXNzYWdlVG9ET01Bc3luYygicnVudGltZSIsICJjb3Jkb3ZhLWZldGNoLWxvY2FsLWZpbGUiLCB7CiAgICAgICAgICAgICAgICAiZmlsZW5hbWUiOiBmaWxlbmFtZSwKICAgICAgICAgICAgICAgICJhcyI6IGFzXwogICAgICAgICAgICB9KQogICAgICAgIH0KICAgICAgICBDb3Jkb3ZhRmV0Y2hMb2NhbEZpbGVBc1RleHQoZmlsZW5hbWUpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX0NvcmRvdmFGZXRjaExvY2FsRmlsZUFzKGZpbGVuYW1lLCAidGV4dCIpCiAgICAgICAgfQogICAgICAgIGFzeW5jIENvcmRvdmFGZXRjaExvY2FsRmlsZUFzQmxvYihmaWxlbmFtZSkgewogICAgICAgICAgICBjb25zdCBidWZmZXIgPSBhd2FpdCB0aGlzLl9Db3Jkb3ZhRmV0Y2hMb2NhbEZpbGVBcyhmaWxlbmFtZSwgImJ1ZmZlciIpOwogICAgICAgICAgICBjb25zdCB0eXBlID0gR2V0VHlwZUZyb21GaWxlRXh0ZW5zaW9uKGZpbGVuYW1lKTsKICAgICAgICAgICAgcmV0dXJuIG5ldyBCbG9iKFtidWZmZXJdLCB7CiAgICAgICAgICAgICAgICAidHlwZSI6IHR5cGUKICAgICAgICAgICAgfSkKICAgICAgICB9CiAgICAgICAgYXN5bmMgQ29yZG92YUZldGNoTG9jYWxGaWxlQXNCbG9iVVJMKGZpbGVuYW1lKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9maWxlU3RydWN0dXJlID09PQogICAgICAgICAgICAgICAgImZsYXQiKSBmaWxlbmFtZSA9IGZpbGVuYW1lLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgIGxldCBibG9iVXJsID0gdGhpcy5fbG9jYWxCbG9iVXJsQ2FjaGUuZ2V0KGZpbGVuYW1lKTsKICAgICAgICAgICAgaWYgKGJsb2JVcmwpIHJldHVybiBibG9iVXJsOwogICAgICAgICAgICBjb25zdCBibG9iID0gYXdhaXQgdGhpcy5Db3Jkb3ZhRmV0Y2hMb2NhbEZpbGVBc0Jsb2IoZmlsZW5hbWUpOwogICAgICAgICAgICBibG9iVXJsID0gVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTsKICAgICAgICAgICAgdGhpcy5fbG9jYWxCbG9iVXJsQ2FjaGUuc2V0KGZpbGVuYW1lLCBibG9iVXJsKTsKICAgICAgICAgICAgcmV0dXJuIGJsb2JVcmwKICAgICAgICB9CiAgICAgICAgQ29yZG92YUZldGNoTG9jYWxGaWxlQXNBcnJheUJ1ZmZlcihmaWxlbmFtZSkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fQ29yZG92YUZldGNoTG9jYWxGaWxlQXMoZmlsZW5hbWUsICJidWZmZXIiKQogICAgICAgIH0KICAgICAgICBHZXRNZWRpYUZpbGVVcmwoZmlsZW5hbWUpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX2ZpbGVTdHJ1Y3R1cmUgPT09ICJmbGF0IikgZmlsZW5hbWUgPSBmaWxlbmFtZS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICBmaWxlbmFtZSA9IHRoaXMuX21lZGlhU3ViZm9sZGVyICsgZmlsZW5hbWU7CiAgICAgICAgICAgIGlmICh0aGlzLl9IYXNMb2NhbFVybEJsb2IoZmlsZW5hbWUpKSByZXR1cm4gdGhpcy5HZXRMb2NhbFVybEFzQmxvYlVybChmaWxlbmFtZSk7CiAgICAgICAgICAgIGVsc2UgcmV0dXJuIGZpbGVuYW1lCiAgICAgICAgfQogICAgICAgIEdldFByb2plY3RGaWxlVXJsKHVybCkgewogICAgICAgICAgICBpZiAoQzMuSXNBYnNvbHV0ZVVSTCh1cmwpKSByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHVybCk7CiAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuX0hhc0xvY2FsVXJsQmxvYih1cmwpKSByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHRoaXMuR2V0TG9jYWxVcmxBc0Jsb2JVcmwodXJsKSk7CiAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuX2lzQ29yZG92YSAmJiB0aGlzLl9pc0ZpbGVQcm90b2NvbCkgcmV0dXJuIHRoaXMuQ29yZG92YUZldGNoTG9jYWxGaWxlQXNCbG9iVVJMKHVybCk7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuX2ZpbGVTdHJ1Y3R1cmUgPT09ICJmbGF0IikgdXJsID0gdXJsLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHVybCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBHZXRQcm9qZWN0RmlsZUlmcmFtZVVybCh1cmwpIHsKICAgICAgICAgICAgaWYgKEMzLklzQWJzb2x1dGVVUkwodXJsKSkgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh1cmwpOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbnN0IHF1ZXJ5SW5kZXggPSB1cmwuaW5kZXhPZigiPyIpOwogICAgICAgICAgICAgICAgY29uc3QgcXVlcnlTdHIgPQogICAgICAgICAgICAgICAgICAgIHF1ZXJ5SW5kZXggPT09IC0xID8gIiIgOiB1cmwuc3Vic3RyKHF1ZXJ5SW5kZXgpOwogICAgICAgICAgICAgICAgY29uc3QgdXJsTm9TZWFyY2ggPSBxdWVyeUluZGV4ID09PSAtMSA/IHVybCA6IHVybC5zdWJzdHIoMCwgcXVlcnlJbmRleCk7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fSGFzTG9jYWxVcmxCbG9iKHVybE5vU2VhcmNoKSkgewogICAgICAgICAgICAgICAgICAgIGxldCBsb2NhbFVybCA9IHRoaXMuX2xvY2FsQmxvYlNXVXJscy5nZXQodXJsTm9TZWFyY2gpIHx8IHRoaXMuR2V0TG9jYWxVcmxBc0Jsb2JVcmwodXJsTm9TZWFyY2gpOwogICAgICAgICAgICAgICAgICAgIGlmICghbG9jYWxVcmwuc3RhcnRzV2l0aCgiYmxvYjoiKSAmJiB0aGlzLl9zd0NsaWVudElkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGFzVXJsID0gbmV3IFVSTChsb2NhbFVybCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMocXVlcnlTdHIpOwogICAgICAgICAgICAgICAgICAgICAgICBwYXJhbXMuc2V0KCJfX2MzX2NsaWVudF9pZCIsIHRoaXMuX3N3Q2xpZW50SWQpOwogICAgICAgICAgICAgICAgICAgICAgICBhc1VybC5zZWFyY2ggPSBwYXJhbXMudG9TdHJpbmcoKTsKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxVcmwgPSBhc1VybC50b1N0cmluZygpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUobG9jYWxVcmwpCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuX2lzQ29yZG92YSAmJgogICAgICAgICAgICAgICAgICAgIHRoaXMuX2lzRmlsZVByb3RvY29sKSByZXR1cm4gdGhpcy5Db3Jkb3ZhRmV0Y2hMb2NhbEZpbGVBc0Jsb2JVUkwodXJsTm9TZWFyY2gpOwogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX2ZpbGVTdHJ1Y3R1cmUgPT09ICJmbGF0IikgdXJsID0gdXJsLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh1cmwpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgTG9hZFByb2plY3RGaWxlVXJsKHVybCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5HZXRQcm9qZWN0RmlsZVVybCh1cmwpCiAgICAgICAgfQogICAgICAgIExvYWRJbWFnZShvcHRzKSB7CiAgICAgICAgICAgIGlmIChvcHRzLmxvYWRQb2xpY3kgJiYgIVZBTElEX0xPQURfUE9MSUNJRVMuaGFzKG9wdHMubG9hZFBvbGljeSkpIHRocm93IG5ldyBFcnJvcigiaW52YWxpZCBsb2FkIHBvbGljeSIpOwogICAgICAgICAgICBsZXQgYXNzZXQgPSB0aGlzLl9hc3NldHNCeVVybC5nZXQob3B0cy51cmwpOwogICAgICAgICAgICBpZiAoYXNzZXQpIHJldHVybiBhc3NldDsKICAgICAgICAgICAgYXNzZXQgPSBDMy5OZXcoQzMuSW1hZ2VBc3NldCwgdGhpcywgewogICAgICAgICAgICAgICAgdXJsOiBvcHRzLnVybCwKICAgICAgICAgICAgICAgIHNpemU6IG9wdHMuc2l6ZSB8fCAwLAogICAgICAgICAgICAgICAgbG9hZFBvbGljeTogb3B0cy5sb2FkUG9saWN5IHx8IHRoaXMuX2RlZmF1bHRMb2FkUG9saWN5CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0aGlzLl9hbGxBc3NldHMucHVzaChhc3NldCk7CiAgICAgICAgICAgIHRoaXMuX2Fzc2V0c0J5VXJsLnNldChhc3NldC5HZXRVUkwoKSwgYXNzZXQpOwogICAgICAgICAgICBpZiAoIXRoaXMuX2hhc0ZpbmlzaGVkSW5pdGlhbExvYWQpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3RvdGFsQXNzZXRTaXplVG9Mb2FkICs9IGFzc2V0LkdldFNpemUoKTsKICAgICAgICAgICAgICAgIHRoaXMuX2xvYWRQcm9taXNlcy5wdXNoKGFzc2V0LkxvYWQoKS50aGVuKCgpID0+IHRoaXMuX0FkZExvYWRlZFNpemUoYXNzZXQuR2V0U2l6ZSgpKSkpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGFzc2V0CiAgICAgICAgfQogICAgICAgIGFzeW5jIFdhaXRGb3JBbGxUb0xvYWQoKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBhd2FpdCBQcm9taXNlLmFsbCh0aGlzLl9sb2FkUHJvbWlzZXMpOwogICAgICAgICAgICAgICAgdGhpcy5fbGFzdExvYWRQcm9ncmVzcyA9IDEKICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBsb2FkaW5nOiAiLCBlcnIpOwogICAgICAgICAgICAgICAgdGhpcy5faGFzSGFkRXJyb3JMb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHRoaXMuX0ZpcmVMb2FkaW5nUHJvZ3Jlc3NFdmVudCgpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgU2V0SW5pdGlhbExvYWRGaW5pc2hlZCgpIHsKICAgICAgICAgICAgdGhpcy5faGFzRmluaXNoZWRJbml0aWFsTG9hZCA9CiAgICAgICAgICAgICAgICB0cnVlCiAgICAgICAgfQogICAgICAgIEhhc0hhZEVycm9yTG9hZGluZygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2hhc0hhZEVycm9yTG9hZGluZwogICAgICAgIH0KICAgICAgICBfQWRkTG9hZGVkU2l6ZShzKSB7CiAgICAgICAgICAgIHRoaXMuX2Fzc2V0U2l6ZUxvYWRlZCArPSBzOwogICAgICAgICAgICB0aGlzLl9sb2FkaW5nUmF0ZUxpbWl0ZXIuQ2FsbCgpCiAgICAgICAgfQogICAgICAgIF9GaXJlTG9hZGluZ1Byb2dyZXNzRXZlbnQoKSB7CiAgICAgICAgICAgIGNvbnN0IGV2ZW50ID0gQzMuTmV3KEMzLkV2ZW50LCAibG9hZGluZ3Byb2dyZXNzIik7CiAgICAgICAgICAgIHRoaXMuX2xhc3RMb2FkUHJvZ3Jlc3MgPSBDMy5jbGFtcCh0aGlzLl9hc3NldFNpemVMb2FkZWQgLyB0aGlzLl90b3RhbEFzc2V0U2l6ZVRvTG9hZCwgMCwgMSk7CiAgICAgICAgICAgIGV2ZW50LnByb2dyZXNzID0gdGhpcy5fbGFzdExvYWRQcm9ncmVzczsKICAgICAgICAgICAgdGhpcy5fcnVudGltZS5EaXNwYXRjaGVyKCkuZGlzcGF0Y2hFdmVudChldmVudCkKICAgICAgICB9CiAgICAgICAgR2V0TG9hZFByb2dyZXNzKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fbGFzdExvYWRQcm9ncmVzcwogICAgICAgIH0KICAgICAgICBfU2V0V2ViRm9udHMoYXJyKSB7CiAgICAgICAgICAgIEMzLnNoYWxsb3dBc3NpZ25BcnJheSh0aGlzLl93ZWJGb250cywgYXJyKTsKICAgICAgICAgICAgaWYgKHRoaXMuX3dlYkZvbnRzLmxlbmd0aCkgdGhpcy5fbG9hZFByb21pc2VzLnB1c2godGhpcy5fTG9hZFdlYkZvbnRzKCkpCiAgICAgICAgfQogICAgICAgIGFzeW5jIF9Mb2FkV2ViRm9udHMoKSB7CiAgICAgICAgICAgIGNvbnN0IHByb21pc2VzID0gW107CiAgICAgICAgICAgIGNvbnN0IGxvYWRGb250c0ZvckRPTSA9IFtdOwogICAgICAgICAgICBmb3IgKGNvbnN0IFtuYW1lLCBmaWxlbmFtZSwgc2l6ZV0gb2YgdGhpcy5fd2ViRm9udHMpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3RvdGFsQXNzZXRTaXplVG9Mb2FkICs9IHNpemU7CiAgICAgICAgICAgICAgICBwcm9taXNlcy5wdXNoKHRoaXMuX0xvYWRXZWJGb250KG5hbWUsIGZpbGVuYW1lLCBsb2FkRm9udHNGb3JET00pLnRoZW4oKCkgPT4gdGhpcy5fQWRkTG9hZGVkU2l6ZShzaXplKSkpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgYXdhaXQgUHJvbWlzZS5hbGwocHJvbWlzZXMpOwogICAgICAgICAgICBpZiAodGhpcy5fcnVudGltZS5Jc0luV29ya2VyKCkgJiYgbG9hZEZvbnRzRm9yRE9NLmxlbmd0aCA+IDApIGF3YWl0IHRoaXMuX3J1bnRpbWUuUG9zdENvbXBvbmVudE1lc3NhZ2VUb0RPTUFzeW5jKCJydW50aW1lIiwgImxvYWQtd2ViZm9udHMiLCB7CiAgICAgICAgICAgICAgICAid2ViZm9udHMiOiBsb2FkRm9udHNGb3JET00KICAgICAgICAgICAgfSkKICAgICAgICB9CiAgICAgICAgYXN5bmMgX0xvYWRXZWJGb250KG5hbWUsIGZpbGVuYW1lLCBsb2FkRm9udHNGb3JET00pIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGNvbnN0IHVybCA9IGF3YWl0IHRoaXMuR2V0UHJvamVjdEZpbGVVcmwoZmlsZW5hbWUpOwogICAgICAgICAgICAgICAgY29uc3QgZm9udEZhY2UgPSBuZXcgRm9udEZhY2UobmFtZSwgYHVybCgnJHt1cmx9JylgKTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9ydW50aW1lLklzSW5Xb3JrZXIoKSkgc2VsZi5mb250cy5hZGQoZm9udEZhY2UpOwogICAgICAgICAgICAgICAgZWxzZSBkb2N1bWVudC5mb250cy5hZGQoZm9udEZhY2UpOwogICAgICAgICAgICAgICAgYXdhaXQgZm9udEZhY2UubG9hZCgpOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuX3J1bnRpbWUuSXNJbldvcmtlcigpKSBsb2FkRm9udHNGb3JET00ucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgbmFtZSwKICAgICAgICAgICAgICAgICAgICB1cmwKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgY29uc29sZS53YXJuKGBbQzMgcnVudGltZV0gRmFpbGVkIHRvIGxvYWQgd2ViIGZvbnQgJyR7bmFtZX0nOiBgLCBlcnIpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgSXNBdWRpb0Zvcm1hdFN1cHBvcnRlZCh0eXBlKSB7CiAgICAgICAgICAgIHJldHVybiAhIXRoaXMuX3N1cHBvcnRlZEF1ZGlvRm9ybWF0c1t0eXBlXQogICAgICAgIH0KICAgICAgICBfU2V0QXVkaW9GaWxlcyhhcnIsIHByZWxvYWRTb3VuZHMpIHsKICAgICAgICAgICAgdGhpcy5fcHJlbG9hZFNvdW5kcyA9ICEhcHJlbG9hZFNvdW5kczsKICAgICAgICAgICAgZm9yIChjb25zdCBbZmlsZU5hbWUsIHByb2plY3RGaWxlc0luZm8sIGlzTXVzaWNdIG9mIGFycikgdGhpcy5fYXVkaW9GaWxlcy5zZXQoZmlsZU5hbWUsIHsKICAgICAgICAgICAgICAgIGZpbGVOYW1lLAogICAgICAgICAgICAgICAgZm9ybWF0czogcHJvamVjdEZpbGVzSW5mby5tYXAoc2kgPT4gKHsKICAgICAgICAgICAgICAgICAgICB0eXBlOiBzaVswXSwKICAgICAgICAgICAgICAgICAgICBmaWxlRXh0ZW5zaW9uOiBzaVsxXSwKICAgICAgICAgICAgICAgICAgICBmdWxsTmFtZTogZmlsZU5hbWUgKyBzaVsxXSwKICAgICAgICAgICAgICAgICAgICBmaWxlU2l6ZTogc2lbMl0KICAgICAgICAgICAgICAgIH0pKSwKICAgICAgICAgICAgICAgIGlzTXVzaWMKICAgICAgICAgICAgfSkKICAgICAgICB9CiAgICAgICAgR2V0UHJlZmVycmVkQXVkaW9GaWxlKG5hbWVQYXJ0KSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9maWxlU3RydWN0dXJlID09PSAiZmxhdCIpIG5hbWVQYXJ0ID0gbmFtZVBhcnQudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgY29uc3QgaW5mbyA9IHRoaXMuX2F1ZGlvRmlsZXMuZ2V0KG5hbWVQYXJ0KTsKICAgICAgICAgICAgaWYgKCFpbmZvKSByZXR1cm4gbnVsbDsKICAgICAgICAgICAgbGV0IHdlYk1PcHVzRmlsZSA9IG51bGw7CiAgICAgICAgICAgIGZvciAoY29uc3QgZm9ybWF0SW5mbyBvZiBpbmZvLmZvcm1hdHMpIHsKICAgICAgICAgICAgICAgIGlmICghd2ViTU9wdXNGaWxlICYmIGZvcm1hdEluZm8udHlwZSA9PT0gImF1ZGlvL3dlYm07IGNvZGVjcz1vcHVzIikgd2ViTU9wdXNGaWxlID0gZm9ybWF0SW5mbzsKICAgICAgICAgICAgICAgIGlmICh0aGlzLklzQXVkaW9Gb3JtYXRTdXBwb3J0ZWQoZm9ybWF0SW5mby50eXBlKSkgcmV0dXJuIGZvcm1hdEluZm8KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gd2ViTU9wdXNGaWxlCiAgICAgICAgfQogICAgICAgIEdldFByb2plY3RBdWRpb0ZpbGVVcmwobmFtZVBhcnQpIHsKICAgICAgICAgICAgY29uc3QgZm9ybWF0SW5mbyA9CiAgICAgICAgICAgICAgICB0aGlzLkdldFByZWZlcnJlZEF1ZGlvRmlsZShuYW1lUGFydCk7CiAgICAgICAgICAgIGlmICghZm9ybWF0SW5mbykgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICB1cmw6IHRoaXMuR2V0TWVkaWFGaWxlVXJsKGZvcm1hdEluZm8uZnVsbE5hbWUpLAogICAgICAgICAgICAgICAgdHlwZTogZm9ybWF0SW5mby50eXBlCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgR2V0QXVkaW9Ub1ByZWxvYWQoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9wcmVsb2FkU291bmRzKSB7CiAgICAgICAgICAgICAgICBjb25zdCByZXQgPSBbXTsKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgaW5mbyBvZiB0aGlzLl9hdWRpb0ZpbGVzLnZhbHVlcygpKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGluZm8uaXNNdXNpYykgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZm9ybWF0SW5mbyA9IHRoaXMuR2V0UHJlZmVycmVkQXVkaW9GaWxlKGluZm8uZmlsZU5hbWUpOwogICAgICAgICAgICAgICAgICAgIGlmICghZm9ybWF0SW5mbykgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgcmV0LnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICBvcmlnaW5hbFVybDogaW5mby5maWxlTmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiB0aGlzLkdldE1lZGlhRmlsZVVybChmb3JtYXRJbmZvLmZ1bGxOYW1lKSwKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogZm9ybWF0SW5mby50eXBlLAogICAgICAgICAgICAgICAgICAgICAgICBmaWxlU2l6ZTogZm9ybWF0SW5mby5maWxlU2l6ZQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gcmV0CiAgICAgICAgICAgIH0gZWxzZSByZXR1cm4gW10KICAgICAgICB9CiAgICAgICAgR2V0SUFzc2V0TWFuYWdlcigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2lBc3NldE1hbmFnZXIKICAgICAgICB9CiAgICAgICAgYXN5bmMgTG9hZFNjcmlwdHMoLi4udXJscykgewogICAgICAgICAgICBjb25zdCBzY3JpcHRVcmxzID0KICAgICAgICAgICAgICAgIGF3YWl0IFByb21pc2UuYWxsKHVybHMubWFwKHVybCA9PiB0aGlzLkdldFByb2plY3RGaWxlVXJsKHVybCkpKTsKICAgICAgICAgICAgaWYgKHRoaXMuX3J1bnRpbWUuSXNJbldvcmtlcigpKQogICAgICAgICAgICAgICAgaWYgKHVybHMubGVuZ3RoID09PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdXJsID0gdXJsc1swXTsKICAgICAgICAgICAgICAgICAgICBhd2FpdCBzZWxmLmMzX2ltcG9ydCgoQzMuSXNSZWxhdGl2ZVVSTCh1cmwpID8gIi4vIiA6ICIiKSArIHVybCkKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2NyaXB0U3RyID0gdXJscy5tYXAodXJsID0+IGBpbXBvcnQgIiR7QzMuSXNSZWxhdGl2ZVVSTCh1cmwpPyIuLyI6IiJ9JHt1cmx9IjtgKS5qb2luKCJcbiIpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGJsb2JVcmwgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKG5ldyBCbG9iKFtzY3JpcHRTdHJdLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICJhcHBsaWNhdGlvbi9qYXZhc2NyaXB0IgogICAgICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgICAgICBhd2FpdCBzZWxmLmMzX2ltcG9ydChibG9iVXJsKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGF3YWl0IFByb21pc2UuYWxsKHNjcmlwdFVybHMubWFwKHVybCA9PiBBZGRTY3JpcHQodXJsKSkpCiAgICAgICAgfQogICAgICAgIGFzeW5jIENvbXBpbGVXZWJBc3NlbWJseSh1cmwpIHsKICAgICAgICAgICAgaWYgKFdlYkFzc2VtYmx5LmNvbXBpbGVTdHJlYW1pbmcpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGZldGNoVXJsID0KICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLkdldFByb2plY3RGaWxlVXJsKHVybCk7CiAgICAgICAgICAgICAgICByZXR1cm4gYXdhaXQgV2ViQXNzZW1ibHkuY29tcGlsZVN0cmVhbWluZyhmZXRjaChmZXRjaFVybCkpCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjb25zdCBhcnJheUJ1ZmZlciA9IGF3YWl0IEMzLkZldGNoQXJyYXlCdWZmZXIodXJsKTsKICAgICAgICAgICAgICAgIHJldHVybiBhd2FpdCBXZWJBc3NlbWJseS5jb21waWxlKGFycmF5QnVmZmVyKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGFzeW5jIExvYWRTdHlsZVNoZWV0KHVybCkgewogICAgICAgICAgICBjb25zdCBmZXRjaFVybCA9IGF3YWl0IHRoaXMuR2V0UHJvamVjdEZpbGVVcmwodXJsKTsKICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuX3J1bnRpbWUuUG9zdENvbXBvbmVudE1lc3NhZ2VUb0RPTUFzeW5jKCJydW50aW1lIiwgImFkZC1zdHlsZXNoZWV0IiwgewogICAgICAgICAgICAgICAgInVybCI6IGZldGNoVXJsCiAgICAgICAgICAgIH0pCiAgICAgICAgfQogICAgfTsKCn0KCi8vIGFzc2V0cy9hc3NldC5qcwp7CiAgICAndXNlIHN0cmljdCc7CiAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICBDMy5Bc3NldCA9IGNsYXNzIEFzc2V0IGV4dGVuZHMgQzMuRGVmZW5kZWRCYXNlIHsKICAgICAgICBjb25zdHJ1Y3Rvcihhc3NldE1hbmFnZXIsIG9wdHMpIHsKICAgICAgICAgICAgc3VwZXIoKTsKICAgICAgICAgICAgdGhpcy5fYXNzZXRNYW5hZ2VyID0gYXNzZXRNYW5hZ2VyOwogICAgICAgICAgICB0aGlzLl9ydW50aW1lID0gYXNzZXRNYW5hZ2VyLkdldFJ1bnRpbWUoKTsKICAgICAgICAgICAgdGhpcy5fdXJsID0gb3B0cy51cmwgfHwgIiI7CiAgICAgICAgICAgIHRoaXMuX3NpemUgPSBvcHRzLnNpemU7CiAgICAgICAgICAgIHRoaXMuX2xvYWRQb2xpY3kgPSBvcHRzLmxvYWRQb2xpY3k7CiAgICAgICAgICAgIHRoaXMuX2Jsb2IgPSBvcHRzLmJsb2IgfHwgbnVsbDsKICAgICAgICAgICAgdGhpcy5faXNMb2FkZWQgPSAhIXRoaXMuX2Jsb2I7CiAgICAgICAgICAgIHRoaXMuX2xvYWRQcm9taXNlID0gbnVsbAogICAgICAgIH0KICAgICAgICBSZWxlYXNlKCkgewogICAgICAgICAgICB0aGlzLl9sb2FkUHJvbWlzZSA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX2Fzc2V0TWFuYWdlciA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9ibG9iID0gbnVsbAogICAgICAgIH0KICAgICAgICBHZXRVUkwoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl91cmwKICAgICAgICB9CiAgICAgICAgR2V0U2l6ZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NpemUKICAgICAgICB9CiAgICAgICAgTG9hZCgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX2xvYWRQb2xpY3kgPT09ICJsb2NhbCIgfHwgdGhpcy5fYmxvYikgewogICAgICAgICAgICAgICAgdGhpcy5faXNMb2FkZWQgPQogICAgICAgICAgICAgICAgICAgIHRydWU7CiAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGhpcy5fbG9hZFByb21pc2UpIHJldHVybiB0aGlzLl9sb2FkUHJvbWlzZTsKICAgICAgICAgICAgdGhpcy5fbG9hZFByb21pc2UgPSB0aGlzLl9hc3NldE1hbmFnZXIuRmV0Y2hCbG9iKHRoaXMuX3VybCwgdGhpcy5fbG9hZFBvbGljeSkudGhlbihibG9iID0+IHsKICAgICAgICAgICAgICAgIHRoaXMuX2lzTG9hZGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHRoaXMuX2xvYWRQcm9taXNlID0gbnVsbDsKICAgICAgICAgICAgICAgIHRoaXMuX2Jsb2IgPSBibG9iOwogICAgICAgICAgICAgICAgcmV0dXJuIGJsb2IKICAgICAgICAgICAgfSkuY2F0Y2goZXJyID0+IGNvbnNvbGUuZXJyb3IoIkVycm9yIGxvYWRpbmcgcmVzb3VyY2U6ICIsIGVycikpOwogICAgICAgICAgICByZXR1cm4gdGhpcy5fbG9hZFByb21pc2UKICAgICAgICB9CiAgICAgICAgSXNMb2FkZWQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pc0xvYWRlZAogICAgICAgIH0KICAgICAgICBHZXRCbG9iKCkgewogICAgICAgICAgICBpZiAodGhpcy5fYmxvYikgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh0aGlzLl9ibG9iKTsKICAgICAgICAgICAgaWYgKHRoaXMuX2xvYWRQcm9taXNlKSByZXR1cm4gdGhpcy5fbG9hZFByb21pc2U7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9hc3NldE1hbmFnZXIuRmV0Y2hCbG9iKHRoaXMuX3VybCwKICAgICAgICAgICAgICAgIHRoaXMuX2xvYWRQb2xpY3kpCiAgICAgICAgfQogICAgfTsKCn0KCi8vIGFzc2V0cy9pbWFnZUFzc2V0LmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIGNvbnN0IHByb21pc2VUaHJvdHRsZSA9IG5ldyBDMy5Qcm9taXNlVGhyb3R0bGU7CiAgICBjb25zdCBhbGxJbWFnZUFzc2V0cyA9IG5ldyBTZXQ7CiAgICBDMy5JbWFnZUFzc2V0ID0gY2xhc3MgSW1hZ2VBc3NldCBleHRlbmRzIEMzLkFzc2V0IHsKICAgICAgICBjb25zdHJ1Y3Rvcihhc3NldE1hbmFnZXIsIG9wdHMpIHsKICAgICAgICAgICAgc3VwZXIoYXNzZXRNYW5hZ2VyLCBvcHRzKTsKICAgICAgICAgICAgdGhpcy5fdGV4dHVyZVByb21pc2UgPSBudWxsOwogICAgICAgICAgICB0aGlzLl93ZWJnbFRleHR1cmUgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9yZWZDb3VudCA9IDA7CiAgICAgICAgICAgIHRoaXMuX2ltYWdlV2lkdGggPSAtMTsKICAgICAgICAgICAgdGhpcy5faW1hZ2VIZWlnaHQgPSAtMTsKICAgICAgICAgICAgYWxsSW1hZ2VBc3NldHMuYWRkKHRoaXMpCiAgICAgICAgfQogICAgICAgIFJlbGVhc2UoKSB7CiAgICAgICAgICAgIHRoaXMuUmVsZWFzZVRleHR1cmUoKTsKICAgICAgICAgICAgaWYgKHRoaXMuX3JlZkNvdW50ICE9PSAwKSB0aHJvdyBuZXcgRXJyb3IoInJlbGVhc2VkIGltYWdlIGFzc2V0IHdoaWNoIHN0aWxsIGhhcyB0ZXh0dXJlIHJlZmVyZW5jZXMiKTsKICAgICAgICAgICAgdGhpcy5fdGV4dHVyZVByb21pc2UgPSBudWxsOwogICAgICAgICAgICBhbGxJbWFnZUFzc2V0cy5kZWxldGUodGhpcyk7CiAgICAgICAgICAgIHN1cGVyLlJlbGVhc2UoKQogICAgICAgIH0KICAgICAgICBzdGF0aWMgT25SZW5kZXJlckNvbnRleHRMb3N0KCkgewogICAgICAgICAgICBmb3IgKGNvbnN0IGltYWdlQXNzZXQgb2YgYWxsSW1hZ2VBc3NldHMpIHsKICAgICAgICAgICAgICAgIGltYWdlQXNzZXQuX3RleHR1cmVQcm9taXNlID0KICAgICAgICAgICAgICAgICAgICBudWxsOwogICAgICAgICAgICAgICAgaW1hZ2VBc3NldC5fd2ViZ2xUZXh0dXJlID0gbnVsbDsKICAgICAgICAgICAgICAgIGltYWdlQXNzZXQuX3JlZkNvdW50ID0gMAogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIExvYWRTdGF0aWNUZXh0dXJlKHJlbmRlcmVyLCBvcHRzKSB7CiAgICAgICAgICAgIG9wdHMgPSBvcHRzIHx8IHt9OwogICAgICAgICAgICB0aGlzLl9yZWZDb3VudCsrOwogICAgICAgICAgICBpZiAodGhpcy5fd2ViZ2xUZXh0dXJlKSByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHRoaXMuX3dlYmdsVGV4dHVyZSk7CiAgICAgICAgICAgIGlmICh0aGlzLl90ZXh0dXJlUHJvbWlzZSkgcmV0dXJuIHRoaXMuX3RleHR1cmVQcm9taXNlOwogICAgICAgICAgICBvcHRzLmFuaXNvdHJvcHkgPSB0aGlzLl9ydW50aW1lLkdldENhbnZhc01hbmFnZXIoKS5HZXRUZXh0dXJlQW5pc290cm9weSgpOwogICAgICAgICAgICB0aGlzLl90ZXh0dXJlUHJvbWlzZSA9IHRoaXMuR2V0QmxvYigpLnRoZW4oYmxvYiA9PiBwcm9taXNlVGhyb3R0bGUuQWRkKCgpID0+IHJlbmRlcmVyLkNyZWF0ZVN0YXRpY1RleHR1cmVBc3luYyhibG9iLCBvcHRzKS50aGVuKHRleHR1cmUgPT4gewogICAgICAgICAgICAgICAgdGhpcy5fdGV4dHVyZVByb21pc2UgPSBudWxsOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuX3JlZkNvdW50ID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgcmVuZGVyZXIuRGVsZXRlVGV4dHVyZSh0ZXh0dXJlKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5fd2ViZ2xUZXh0dXJlID0gdGV4dHVyZTsKICAgICAgICAgICAgICAgIHRoaXMuX2ltYWdlV2lkdGggPSB0ZXh0dXJlLkdldFdpZHRoKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9pbWFnZUhlaWdodCA9IHRleHR1cmUuR2V0SGVpZ2h0KCk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fd2ViZ2xUZXh0dXJlCiAgICAgICAgICAgIH0pKSkuY2F0Y2goZXJyID0+IHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkZhaWxlZCB0byBsb2FkIHRleHR1cmU6ICIsIGVycik7CiAgICAgICAgICAgICAgICB0aHJvdyBlcnI7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXR1cm4gdGhpcy5fdGV4dHVyZVByb21pc2UKICAgICAgICB9CiAgICAgICAgUmVsZWFzZVRleHR1cmUoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9yZWZDb3VudCA8PSAwKSB0aHJvdyBuZXcgRXJyb3IoInRleHR1cmUgcmVsZWFzZWQgdG9vIG1hbnkgdGltZXMiKTsKICAgICAgICAgICAgdGhpcy5fcmVmQ291bnQtLTsKICAgICAgICAgICAgaWYgKHRoaXMuX3JlZkNvdW50ID09PSAwICYmIHRoaXMuX3dlYmdsVGV4dHVyZSkgewogICAgICAgICAgICAgICAgY29uc3QgcmVuZGVyZXIgPSB0aGlzLl93ZWJnbFRleHR1cmUuR2V0UmVuZGVyZXIoKTsKICAgICAgICAgICAgICAgIHJlbmRlcmVyLkRlbGV0ZVRleHR1cmUodGhpcy5fd2ViZ2xUZXh0dXJlKTsKICAgICAgICAgICAgICAgIHRoaXMuX3dlYmdsVGV4dHVyZSA9CiAgICAgICAgICAgICAgICAgICAgbnVsbAogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIEdldFRleHR1cmUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl93ZWJnbFRleHR1cmUKICAgICAgICB9CiAgICAgICAgR2V0V2lkdGgoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pbWFnZVdpZHRoCiAgICAgICAgfQogICAgICAgIEdldEhlaWdodCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2ltYWdlSGVpZ2h0CiAgICAgICAgfQogICAgICAgIGFzeW5jIExvYWRUb0RyYXdhYmxlKCkgewogICAgICAgICAgICBjb25zdCBibG9iID0gYXdhaXQgdGhpcy5HZXRCbG9iKCk7CiAgICAgICAgICAgIGlmIChDMy5TdXBwb3J0cy5JbWFnZUJpdG1hcE9wdGlvbnMpIHJldHVybiBhd2FpdCBjcmVhdGVJbWFnZUJpdG1hcChibG9iLCB7CiAgICAgICAgICAgICAgICAicHJlbXVsdGlwbHlBbHBoYSI6ICJub25lIgogICAgICAgICAgICB9KTsKICAgICAgICAgICAgZWxzZSBpZiAoQzMuU3VwcG9ydHMuSW1hZ2VCaXRtYXApIHJldHVybiBhd2FpdCBjcmVhdGVJbWFnZUJpdG1hcChibG9iKTsKICAgICAgICAgICAgZWxzZSByZXR1cm4gYXdhaXQgQzMuQmxvYlRvSW1hZ2UoYmxvYikKICAgICAgICB9CiAgICB9OwoKfQoKLy8gbGF5b3V0cy9yZW5kZXJDZWxsLmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIGNvbnN0IGFzc2VydCA9IHNlbGYuYXNzZXJ0OwoKICAgIGZ1bmN0aW9uIFNvcnRCeUluc3RMYXN0Q2FjaGVkWkluZGV4KGEsIGIpIHsKICAgICAgICByZXR1cm4gYS5HZXRXb3JsZEluZm8oKS5fR2V0TGFzdENhY2hlZFpJbmRleCgpIC0gYi5HZXRXb3JsZEluZm8oKS5fR2V0TGFzdENhY2hlZFpJbmRleCgpCiAgICB9CiAgICBDMy5SZW5kZXJDZWxsID0gY2xhc3MgUmVuZGVyQ2VsbCBleHRlbmRzIEMzLkRlZmVuZGVkQmFzZSB7CiAgICAgICAgY29uc3RydWN0b3IoZ3JpZCwgeCwgeSkgewogICAgICAgICAgICBzdXBlcigpOwogICAgICAgICAgICB0aGlzLl9ncmlkID0gZ3JpZDsKICAgICAgICAgICAgdGhpcy5feCA9IHg7CiAgICAgICAgICAgIHRoaXMuX3kgPSB5OwogICAgICAgICAgICB0aGlzLl9pbnN0YW5jZXMgPSBbXTsKICAgICAgICAgICAgdGhpcy5faXNTb3J0ZWQgPSB0cnVlOwogICAgICAgICAgICB0aGlzLl9wZW5kaW5nUmVtb3ZhbCA9IG5ldyBTZXQ7CiAgICAgICAgICAgIHRoaXMuX2lzQW55UGVuZGluZ1JlbW92YWwgPSBmYWxzZQogICAgICAgIH0KICAgICAgICBSZWxlYXNlKCkgewogICAgICAgICAgICBDMy5jbGVhckFycmF5KHRoaXMuX2luc3RhbmNlcyk7CiAgICAgICAgICAgIHRoaXMuX3BlbmRpbmdSZW1vdmFsLmNsZWFyKCk7CiAgICAgICAgICAgIHRoaXMuX2dyaWQgPSBudWxsCiAgICAgICAgfQogICAgICAgIFJlc2V0KCkgewogICAgICAgICAgICBDMy5jbGVhckFycmF5KHRoaXMuX2luc3RhbmNlcyk7CiAgICAgICAgICAgIHRoaXMuX2lzU29ydGVkID0gdHJ1ZTsKICAgICAgICAgICAgdGhpcy5fcGVuZGluZ1JlbW92YWwuY2xlYXIoKTsKICAgICAgICAgICAgdGhpcy5faXNBbnlQZW5kaW5nUmVtb3ZhbCA9IGZhbHNlCiAgICAgICAgfQogICAgICAgIFNldENoYW5nZWQoKSB7CiAgICAgICAgICAgIHRoaXMuX2lzU29ydGVkID0gZmFsc2UKICAgICAgICB9CiAgICAgICAgSXNFbXB0eSgpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLl9pbnN0YW5jZXMubGVuZ3RoKSByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgaWYgKHRoaXMuX2luc3RhbmNlcy5sZW5ndGggPiB0aGlzLl9wZW5kaW5nUmVtb3ZhbC5zaXplKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX0ZsdXNoUGVuZGluZygpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgIH0KICAgICAgICBJbnNlcnQoaW5zdCkgewogICAgICAgICAgICBpZiAodGhpcy5fcGVuZGluZ1JlbW92YWwuaGFzKGluc3QpKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9wZW5kaW5nUmVtb3ZhbC5kZWxldGUoaW5zdCk7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fcGVuZGluZ1JlbW92YWwuc2l6ZSA9PT0gMCkgdGhpcy5faXNBbnlQZW5kaW5nUmVtb3ZhbCA9IGZhbHNlOwogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5faW5zdGFuY2VzLnB1c2goaW5zdCk7CiAgICAgICAgICAgIHRoaXMuX2lzU29ydGVkID0gdGhpcy5faW5zdGFuY2VzLmxlbmd0aCA9PT0gMQogICAgICAgIH0KICAgICAgICBSZW1vdmUoaW5zdCkgewogICAgICAgICAgICB0aGlzLl9wZW5kaW5nUmVtb3ZhbC5hZGQoaW5zdCk7CiAgICAgICAgICAgIHRoaXMuX2lzQW55UGVuZGluZ1JlbW92YWwgPSB0cnVlOwogICAgICAgICAgICBpZiAodGhpcy5fcGVuZGluZ1JlbW92YWwuc2l6ZSA+PSA1MCkgdGhpcy5fRmx1c2hQZW5kaW5nKCkKICAgICAgICB9CiAgICAgICAgX0ZsdXNoUGVuZGluZygpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLl9pc0FueVBlbmRpbmdSZW1vdmFsKSByZXR1cm47CiAgICAgICAgICAgIGlmICh0aGlzLl9pbnN0YW5jZXMubGVuZ3RoID09PSB0aGlzLl9wZW5kaW5nUmVtb3ZhbC5zaXplKSB7CiAgICAgICAgICAgICAgICB0aGlzLlJlc2V0KCk7CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBDMy5hcnJheVJlbW92ZUFsbEluU2V0KHRoaXMuX2luc3RhbmNlcywgdGhpcy5fcGVuZGluZ1JlbW92YWwpOwogICAgICAgICAgICB0aGlzLl9wZW5kaW5nUmVtb3ZhbC5jbGVhcigpOwogICAgICAgICAgICB0aGlzLl9pc0FueVBlbmRpbmdSZW1vdmFsID0gZmFsc2UKICAgICAgICB9CiAgICAgICAgX0Vuc3VyZVNvcnRlZCgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX2lzU29ydGVkKSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuX2luc3RhbmNlcy5zb3J0KFNvcnRCeUluc3RMYXN0Q2FjaGVkWkluZGV4KTsKICAgICAgICAgICAgdGhpcy5faXNTb3J0ZWQgPSB0cnVlCiAgICAgICAgfQogICAgICAgIER1bXAocmVzdWx0KSB7CiAgICAgICAgICAgIHRoaXMuX0ZsdXNoUGVuZGluZygpOwogICAgICAgICAgICB0aGlzLl9FbnN1cmVTb3J0ZWQoKTsKICAgICAgICAgICAgaWYgKHRoaXMuX2luc3RhbmNlcy5sZW5ndGgpIHJlc3VsdC5wdXNoKHRoaXMuX2luc3RhbmNlcykKICAgICAgICB9CiAgICB9OwoKfQoKLy8gbGF5b3V0cy9yZW5kZXJHcmlkLmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIEMzLlJlbmRlckdyaWQgPSBjbGFzcyBSZW5kZXJHcmlkIGV4dGVuZHMgQzMuRGVmZW5kZWRCYXNlIHsKICAgICAgICBjb25zdHJ1Y3RvcihjZWxsV2lkdGgsIGNlbGxIZWlnaHQpIHsKICAgICAgICAgICAgc3VwZXIoKTsKICAgICAgICAgICAgdGhpcy5fY2VsbFdpZHRoID0gY2VsbFdpZHRoOwogICAgICAgICAgICB0aGlzLl9jZWxsSGVpZ2h0ID0gY2VsbEhlaWdodDsKICAgICAgICAgICAgdGhpcy5fY2VsbHMgPSBDMy5OZXcoQzMuUGFpck1hcCkKICAgICAgICB9CiAgICAgICAgUmVsZWFzZSgpIHsKICAgICAgICAgICAgdGhpcy5fY2VsbHMuUmVsZWFzZSgpOwogICAgICAgICAgICB0aGlzLl9jZWxscyA9IG51bGwKICAgICAgICB9CiAgICAgICAgR2V0Q2VsbCh4LCB5LCBjcmVhdGVJZk1pc3NpbmcpIHsKICAgICAgICAgICAgbGV0IHJldCA9IHRoaXMuX2NlbGxzLkdldCh4LCB5KTsKICAgICAgICAgICAgaWYgKHJldCkgcmV0dXJuIHJldDsKICAgICAgICAgICAgZWxzZSBpZiAoY3JlYXRlSWZNaXNzaW5nKSB7CiAgICAgICAgICAgICAgICByZXQgPSBDMy5OZXcoQzMuUmVuZGVyQ2VsbCwgdGhpcywgeCwgeSk7CiAgICAgICAgICAgICAgICB0aGlzLl9jZWxscy5TZXQoeCwgeSwgcmV0KTsKICAgICAgICAgICAgICAgIHJldHVybiByZXQKICAgICAgICAgICAgfSBlbHNlIHJldHVybiBudWxsCiAgICAgICAgfQogICAgICAgIFhUb0NlbGwoeCkgewogICAgICAgICAgICByZXR1cm4gTWF0aC5mbG9vcih4IC8gdGhpcy5fY2VsbFdpZHRoKQogICAgICAgIH0KICAgICAgICBZVG9DZWxsKHkpIHsKICAgICAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IoeSAvIHRoaXMuX2NlbGxIZWlnaHQpCiAgICAgICAgfQogICAgICAgIFVwZGF0ZShpbnN0LAogICAgICAgICAgICBvbGRSYW5nZSwgbmV3UmFuZ2UpIHsKICAgICAgICAgICAgaWYgKG9sZFJhbmdlKQogICAgICAgICAgICAgICAgZm9yIChsZXQgeCA9IG9sZFJhbmdlLmdldExlZnQoKSwgbGVueCA9IG9sZFJhbmdlLmdldFJpZ2h0KCk7IHggPD0gbGVueDsgKyt4KQogICAgICAgICAgICAgICAgICAgIGZvciAobGV0IHkgPSBvbGRSYW5nZS5nZXRUb3AoKSwgbGVueSA9IG9sZFJhbmdlLmdldEJvdHRvbSgpOyB5IDw9IGxlbnk7ICsreSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAobmV3UmFuZ2UgJiYgbmV3UmFuZ2UuY29udGFpbnNQb2ludCh4LCB5KSkgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNlbGwgPSB0aGlzLkdldENlbGwoeCwgeSwgZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWNlbGwpIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgICAgICBjZWxsLlJlbW92ZShpbnN0KTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNlbGwuSXNFbXB0eSgpKSB0aGlzLl9jZWxscy5EZWxldGUoeCwgeSkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChuZXdSYW5nZSkKICAgICAgICAgICAgICAgIGZvciAobGV0IHggPSBuZXdSYW5nZS5nZXRMZWZ0KCksIGxlbnggPSBuZXdSYW5nZS5nZXRSaWdodCgpOyB4IDw9IGxlbng7ICsreCkKICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCB5ID0gbmV3UmFuZ2UuZ2V0VG9wKCksIGxlbnkgPSBuZXdSYW5nZS5nZXRCb3R0b20oKTsgeSA8PSBsZW55OyArK3kpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9sZFJhbmdlICYmIG9sZFJhbmdlLmNvbnRhaW5zUG9pbnQoeCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB5KSkgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuR2V0Q2VsbCh4LCB5LCB0cnVlKS5JbnNlcnQoaW5zdCkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIFF1ZXJ5UmFuZ2UocmMsIHJlc3VsdCkgewogICAgICAgICAgICBsZXQgeCA9IHRoaXMuWFRvQ2VsbChyYy5nZXRMZWZ0KCkpOwogICAgICAgICAgICBjb25zdCB5c3RhcnQgPSB0aGlzLllUb0NlbGwocmMuZ2V0VG9wKCkpOwogICAgICAgICAgICBjb25zdCBsZW54ID0gdGhpcy5YVG9DZWxsKHJjLmdldFJpZ2h0KCkpOwogICAgICAgICAgICBjb25zdCBsZW55ID0gdGhpcy5ZVG9DZWxsKHJjLmdldEJvdHRvbSgpKTsKICAgICAgICAgICAgZm9yICg7IHggPD0gbGVueDsgKyt4KQogICAgICAgICAgICAgICAgZm9yIChsZXQgeSA9IHlzdGFydDsgeSA8PSBsZW55OyArK3kpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBjZWxsID0gdGhpcy5HZXRDZWxsKHgsIHksIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICBpZiAoIWNlbGwpIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgIGNlbGwuRHVtcChyZXN1bHQpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIE1hcmtSYW5nZUNoYW5nZWQocmMpIHsKICAgICAgICAgICAgbGV0IHggPSByYy5nZXRMZWZ0KCk7CiAgICAgICAgICAgIGNvbnN0IHlzdGFydCA9IHJjLmdldFRvcCgpOwogICAgICAgICAgICBjb25zdCBsZW54ID0gcmMuZ2V0UmlnaHQoKTsKICAgICAgICAgICAgY29uc3QgbGVueSA9IHJjLmdldEJvdHRvbSgpOwogICAgICAgICAgICBmb3IgKDsgeCA8PSBsZW54OyArK3gpCiAgICAgICAgICAgICAgICBmb3IgKGxldCB5ID0geXN0YXJ0OyB5IDw9IGxlbnk7ICsreSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGNlbGwgPQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLkdldENlbGwoeCwgeSwgZmFsc2UpOwogICAgICAgICAgICAgICAgICAgIGlmICghY2VsbCkgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgY2VsbC5TZXRDaGFuZ2VkKCkKICAgICAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwoKfQoKLy8gbGF5b3V0cy9sYXllci5qcwp7CiAgICAndXNlIHN0cmljdCc7CiAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICBjb25zdCB0bXBSZWN0ID0gbmV3IEMzLlJlY3Q7CiAgICBjb25zdCB0bXBRdWFkID0gbmV3IEMzLlF1YWQ7CiAgICBjb25zdCByZW5kZXJDZWxsQXJyID0gW107CiAgICBjb25zdCB0bXBEZXN0UmVjdCA9IG5ldyBDMy5SZWN0OwogICAgY29uc3QgdG1wU3JjUmVjdCA9IG5ldyBDMy5SZWN0OwogICAgY29uc3QgZ2xNYXRyaXggPSBzZWxmLmdsTWF0cml4OwogICAgY29uc3QgdmVjMyA9IGdsTWF0cml4LnZlYzM7CiAgICBjb25zdCB2ZWM0ID0gZ2xNYXRyaXgudmVjNDsKICAgIGNvbnN0IG1hdDQgPSBnbE1hdHJpeC5tYXQ0OwogICAgY29uc3QgdGVtcE1hdDQgPSBtYXQ0LmNyZWF0ZSgpOwogICAgY29uc3QgdGVtcFZlYzMgPSB2ZWMzLmNyZWF0ZSgpOwogICAgY29uc3QgdGVtcFZlYzQgPSB2ZWM0LmNyZWF0ZSgpOwogICAgY29uc3QgY2FtVmVjdG9yID0gdmVjMy5jcmVhdGUoKTsKICAgIGNvbnN0IGxvb2tWZWN0b3IgPSB2ZWMzLmNyZWF0ZSgpOwogICAgY29uc3QgdXBWZWN0b3IgPSB2ZWMzLmNyZWF0ZSgpOwogICAgY29uc3QgdGVtcFZlYzIgPSBDMy5OZXcoQzMuVmVjdG9yMik7CiAgICBjb25zdCB0ZW1wUmVjdCA9IEMzLk5ldyhDMy5SZWN0KTsKCiAgICBmdW5jdGlvbiBTb3J0QnlJbnN0TGFzdENhY2hlZFpJbmRleChhLCBiKSB7CiAgICAgICAgcmV0dXJuIGEuR2V0V29ybGRJbmZvKCkuX0dldExhc3RDYWNoZWRaSW5kZXgoKSAtIGIuR2V0V29ybGRJbmZvKCkuX0dldExhc3RDYWNoZWRaSW5kZXgoKQogICAgfQoKICAgIGZ1bmN0aW9uIFNvcnRCeUluc3RaRWxldmF0aW9uKGEsIGIpIHsKICAgICAgICByZXR1cm4gYS5HZXRXb3JsZEluZm8oKS5HZXRaRWxldmF0aW9uKCkgLSBiLkdldFdvcmxkSW5mbygpLkdldFpFbGV2YXRpb24oKQogICAgfQogICAgY29uc3QgdGVtcEluc3RhbmNlTGlzdDEgPSBbXTsKICAgIGNvbnN0IHRlbXBJbnN0YW5jZUxpc3QyID0gW107CiAgICBjb25zdCB0ZW1wSW5zdGFuY2VzQnlDYW1lcmFEaXN0ID0gW107CiAgICBDMy5MYXllciA9IGNsYXNzIExheWVyIGV4dGVuZHMgQzMuRGVmZW5kZWRCYXNlIHsKICAgICAgICBjb25zdHJ1Y3RvcihsYXlvdXQsIHBhcmVudExheWVyLCBkYXRhKSB7CiAgICAgICAgICAgIHN1cGVyKCk7CiAgICAgICAgICAgIHRoaXMuX2xheW91dCA9IGxheW91dDsKICAgICAgICAgICAgdGhpcy5fcnVudGltZSA9IGxheW91dC5HZXRSdW50aW1lKCk7CiAgICAgICAgICAgIHRoaXMuX3BhcmVudExheWVyID0gcGFyZW50TGF5ZXI7CiAgICAgICAgICAgIHRoaXMuX25hbWUgPSBkYXRhWzBdOwogICAgICAgICAgICB0aGlzLl9pbmRleCA9IC0xOwogICAgICAgICAgICB0aGlzLl9zaWQgPSBkYXRhWzJdOwogICAgICAgICAgICB0aGlzLl9pc1Zpc2libGUgPSAhIWRhdGFbM107CiAgICAgICAgICAgIHRoaXMuX2lzSW50ZXJhY3RpdmUgPSAhIWRhdGFbMTNdOwogICAgICAgICAgICB0aGlzLl9iYWNrZ3JvdW5kQ29sb3IgPSBDMy5OZXcoQzMuQ29sb3IpOwogICAgICAgICAgICB0aGlzLl9iYWNrZ3JvdW5kQ29sb3Iuc2V0RnJvbUpTT04oZGF0YVs0XS5tYXAoeCA9PiB4IC8gMjU1KSk7CiAgICAgICAgICAgIHRoaXMuX2lzVHJhbnNwYXJlbnQgPSAhIWRhdGFbNV07CiAgICAgICAgICAgIHRoaXMuX3BhcmFsbGF4WCA9IGRhdGFbNl07CiAgICAgICAgICAgIHRoaXMuX3BhcmFsbGF4WSA9IGRhdGFbN107CiAgICAgICAgICAgIHRoaXMuX2NvbG9yID0gQzMuTmV3KEMzLkNvbG9yLCAxLCAxLCAxLCBkYXRhWzhdKTsKICAgICAgICAgICAgdGhpcy5fcHJlbXVsdGlwbGllZENvbG9yID0KICAgICAgICAgICAgICAgIEMzLk5ldyhDMy5Db2xvcik7CiAgICAgICAgICAgIHRoaXMuX2lzRm9yY2VPd25UZXh0dXJlID0gZGF0YVs5XTsKICAgICAgICAgICAgdGhpcy5fcmVuZGVyQXMzZCA9IGRhdGFbMTddOwogICAgICAgICAgICB0aGlzLl91c2VDYW1lcmFEaXN0YW5jZURyYXdPcmRlciA9IGRhdGFbMThdOwogICAgICAgICAgICB0aGlzLl91c2VSZW5kZXJDZWxscyA9IGRhdGFbMTBdOwogICAgICAgICAgICB0aGlzLl9zY2FsZVJhdGUgPSBkYXRhWzExXTsKICAgICAgICAgICAgdGhpcy5fYmxlbmRNb2RlID0gZGF0YVsxMl07CiAgICAgICAgICAgIHRoaXMuX2N1clJlbmRlclRhcmdldCA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3NjYWxlID0gMTsKICAgICAgICAgICAgdGhpcy5fekVsZXZhdGlvbiA9IGRhdGFbMTZdOwogICAgICAgICAgICB0aGlzLl9hbmdsZSA9IDA7CiAgICAgICAgICAgIHRoaXMuX3Njcm9sbFggPSAwOwogICAgICAgICAgICB0aGlzLl9zY3JvbGxZID0gMDsKICAgICAgICAgICAgdGhpcy5faGFzT3duU2Nyb2xsUG9zaXRpb24gPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5fdmlld3BvcnQgPSBDMy5OZXcoQzMuUmVjdCk7CiAgICAgICAgICAgIHRoaXMuX3ZpZXdwb3J0WjAgPSBDMy5OZXcoQzMuUmVjdCk7CiAgICAgICAgICAgIHRoaXMuX3ZpZXdwb3J0M0QgPSBDMy5OZXcoQzMuUmVjdCk7CiAgICAgICAgICAgIHRoaXMuX2lzVmlld3BvcnRDaGFuZ2VkID0gdHJ1ZTsKICAgICAgICAgICAgdGhpcy5fcHJvamVjdGlvbk1hdHJpeCA9IG1hdDQuY3JlYXRlKCk7CiAgICAgICAgICAgIHRoaXMuX2lzUHJvamVjdGlvbk1hdHJpeENoYW5nZWQgPSB0cnVlOwogICAgICAgICAgICB0aGlzLl9tb2RlbFZpZXdNYXRyaXggPSBtYXQ0LmNyZWF0ZSgpOwogICAgICAgICAgICB0aGlzLl9pc01WTWF0cml4Q2hhbmdlZCA9IHRydWU7CiAgICAgICAgICAgIHRoaXMuX3ZpZXdGcnVzdHVtID0gQzMuTmV3KEMzLkdmeC5WaWV3RnJ1c3R1bSk7CiAgICAgICAgICAgIHRoaXMuX2lzVmlld0ZydXN0dW1DaGFuZ2VkID0gdHJ1ZTsKICAgICAgICAgICAgdGhpcy5fc3RhcnR1cEluaXRpYWxJbnN0YW5jZXMgPSBbXTsKICAgICAgICAgICAgdGhpcy5faW5pdGlhbEluc3RhbmNlc0RhdGEgPSBkYXRhWzE0XTsKICAgICAgICAgICAgdGhpcy5faW5pdGlhbEluc3RhbmNlcyA9IFtdOwogICAgICAgICAgICB0aGlzLl9jcmVhdGVkR2xvYmFsVWlkcyA9IFtdOwogICAgICAgICAgICB0aGlzLl9pbml0aWFsVUlEc1RvSW5zdGFuY2VEYXRhID0gbmV3IE1hcDsKICAgICAgICAgICAgdGhpcy5faW5zdGFuY2VzID0gW107CiAgICAgICAgICAgIHRoaXMuX3pJbmRpY2VzVXBUb0RhdGUgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5fYW55SW5zdGFuY2VaRWxldmF0ZWQgPSBmYWxzZTsKICAgICAgICAgICAgY29uc3QgY2FudmFzTWFuYWdlciA9IHRoaXMuX3J1bnRpbWUuR2V0Q2FudmFzTWFuYWdlcigpOwogICAgICAgICAgICB0aGlzLl9lZmZlY3RMaXN0ID0gQzMuTmV3KEMzLkVmZmVjdExpc3QsCiAgICAgICAgICAgICAgICB0aGlzLCBkYXRhWzE1XSk7CiAgICAgICAgICAgIHRoaXMuX2VmZmVjdENoYWluID0gQzMuTmV3KEMzLkdmeC5FZmZlY3RDaGFpbiwgY2FudmFzTWFuYWdlci5HZXRFZmZlY3RDaGFpbk1hbmFnZXIoKSwgewogICAgICAgICAgICAgICAgZHJhd0NvbnRlbnQ6IChyZW5kZXJlciwgZWZmZWN0Q2hhaW4pID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBsYXllciA9IGVmZmVjdENoYWluLkdldENvbnRlbnRPYmplY3QoKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCByZW5kZXJTdXJmYWNlID0gbGF5ZXIuR2V0UmVuZGVyVGFyZ2V0KCk7CiAgICAgICAgICAgICAgICAgICAgcmVuZGVyZXIuU2V0Q29sb3IobGF5ZXIuR2V0UHJlbXVsdGlwbGllZENvbG9yKCkpOwogICAgICAgICAgICAgICAgICAgIHJlbmRlcmVyLkRyYXdSZW5kZXJUYXJnZXQocmVuZGVyU3VyZmFjZSk7CiAgICAgICAgICAgICAgICAgICAgcmVuZGVyZXIuSW52YWxpZGF0ZVJlbmRlclRhcmdldChyZW5kZXJTdXJmYWNlKTsKICAgICAgICAgICAgICAgICAgICBjYW52YXNNYW5hZ2VyLlJlbGVhc2VBZGRpdGlvbmFsUmVuZGVyVGFyZ2V0KHJlbmRlclN1cmZhY2UpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZ2V0U2hhZGVyUGFyYW1ldGVyczogaW5kZXggPT4gdGhpcy5HZXRFZmZlY3RMaXN0KCkuX0dldEVmZmVjdENoYWluU2hhZGVyUGFyYW1ldGVyc0ZvckluZGV4KGluZGV4KQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdGhpcy5fbmVlZHNSZWJ1aWxkRWZmZWN0Q2hhaW5TdGVwcyA9IHRydWU7CiAgICAgICAgICAgIHRoaXMuX3dhc0RlZmF1bHRDb2xvciA9IHRydWU7CiAgICAgICAgICAgIHRoaXMuX3JlbmRlckdyaWQgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9sYXN0UmVuZGVyTGlzdCA9IFtdOwogICAgICAgICAgICB0aGlzLl9pc1JlbmRlckxpc3RVcFRvRGF0ZSA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl9sYXN0UmVuZGVyQ2VsbHMgPSBDMy5OZXcoQzMuUmVjdCwgMCwgMCwgLTEsIC0xKTsKICAgICAgICAgICAgdGhpcy5fY3VyUmVuZGVyQ2VsbHMgPSBDMy5OZXcoQzMuUmVjdCwgMCwgMCwgLTEsIC0xKTsKICAgICAgICAgICAgdGhpcy5faUxheWVyID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fVXBkYXRlUHJlbXVsdGlwbGllZENvbG9yKCk7CiAgICAgICAgICAgIGlmICh0aGlzLlVzZXNSZW5kZXJDZWxscygpKSB0aGlzLl9yZW5kZXJHcmlkID0gQzMuTmV3KEMzLlJlbmRlckdyaWQsIHRoaXMuX3J1bnRpbWUuR2V0T3JpZ2luYWxWaWV3cG9ydFdpZHRoKCksIHRoaXMuX3J1bnRpbWUuR2V0T3JpZ2luYWxWaWV3cG9ydEhlaWdodCgpKTsKICAgICAgICAgICAgdGhpcy5fc3ViTGF5ZXJzID0gZGF0YVsxOV0ubWFwKGxkID0+IEMzLk5ldyhDMy5MYXllciwgdGhpcy5fbGF5b3V0LAogICAgICAgICAgICAgICAgdGhpcywgbGQpKQogICAgICAgIH0KICAgICAgICBfSW5pdCgpIHsKICAgICAgICAgICAgZm9yIChjb25zdCBpbnN0RGF0YSBvZiB0aGlzLl9pbml0aWFsSW5zdGFuY2VzRGF0YSkgewogICAgICAgICAgICAgICAgY29uc3Qgb2JqZWN0Q2xhc3MgPSB0aGlzLl9ydW50aW1lLkdldE9iamVjdENsYXNzQnlJbmRleChpbnN0RGF0YVsxXSk7CiAgICAgICAgICAgICAgICB0aGlzLl9sYXlvdXQuX0FkZEluaXRpYWxPYmplY3RDbGFzcyhvYmplY3RDbGFzcyk7CiAgICAgICAgICAgICAgICBpZiAoIW9iamVjdENsYXNzLkdldERlZmF1bHRJbnN0YW5jZURhdGEoKSkgewogICAgICAgICAgICAgICAgICAgIG9iamVjdENsYXNzLlNldERlZmF1bHRJbnN0YW5jZURhdGEoaW5zdERhdGEpOwogICAgICAgICAgICAgICAgICAgIG9iamVjdENsYXNzLl9TZXREZWZhdWx0TGF5ZXJJbmRleCh0aGlzLl9pbmRleCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMuX2luaXRpYWxJbnN0YW5jZXMucHVzaChpbnN0RGF0YSk7CiAgICAgICAgICAgICAgICB0aGlzLl9pbml0aWFsVUlEc1RvSW5zdGFuY2VEYXRhLnNldChpbnN0RGF0YVsyXSwgaW5zdERhdGEpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgQzMuc2hhbGxvd0Fzc2lnbkFycmF5KHRoaXMuX3N0YXJ0dXBJbml0aWFsSW5zdGFuY2VzLCB0aGlzLl9pbml0aWFsSW5zdGFuY2VzKTsKICAgICAgICAgICAgdGhpcy5faW5pdGlhbEluc3RhbmNlc0RhdGEgPQogICAgICAgICAgICAgICAgbnVsbDsKICAgICAgICAgICAgdGhpcy5faUxheWVyID0gbmV3IHNlbGYuSUxheWVyKHRoaXMpCiAgICAgICAgfQogICAgICAgIFJlbGVhc2UoKSB7CiAgICAgICAgICAgIHRoaXMuX2xheW91dCA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUgPSBudWxsCiAgICAgICAgfQogICAgICAgIEdldEluaXRpYWxJbnN0YW5jZURhdGEodWlkKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pbml0aWFsVUlEc1RvSW5zdGFuY2VEYXRhLmdldCh1aWQpCiAgICAgICAgfQogICAgICAgIENyZWF0ZUluaXRpYWxJbnN0YW5jZXMoY3JlYXRlZEluc3RhbmNlcykgewogICAgICAgICAgICBjb25zdCBpc0ZpcnN0VmlzaXQgPSB0aGlzLl9sYXlvdXQuSXNGaXJzdFZpc2l0KCk7CiAgICAgICAgICAgIGxldCBrID0gMDsKICAgICAgICAgICAgY29uc3QgaW5pdGlhbEluc3RhbmNlcyA9IHRoaXMuX2luaXRpYWxJbnN0YW5jZXM7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBpbml0aWFsSW5zdGFuY2VzLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7CiAgICAgICAgICAgICAgICBjb25zdCBpbnN0RGF0YSA9IGluaXRpYWxJbnN0YW5jZXNbaV07CiAgICAgICAgICAgICAgICBjb25zdCBvYmplY3RDbGFzcyA9IHRoaXMuX3J1bnRpbWUuR2V0T2JqZWN0Q2xhc3NCeUluZGV4KGluc3REYXRhWzFdKTsKICAgICAgICAgICAgICAgIGxldCBrZWVwID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGlmICghb2JqZWN0Q2xhc3MuSGFzUGVyc2lzdEJlaGF2aW9yKCkgfHwKICAgICAgICAgICAgICAgICAgICBpc0ZpcnN0VmlzaXQpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBpbnN0ID0gdGhpcy5fcnVudGltZS5DcmVhdGVJbnN0YW5jZUZyb21EYXRhKGluc3REYXRhLCB0aGlzLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICBjcmVhdGVkSW5zdGFuY2VzLnB1c2goaW5zdCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKG9iamVjdENsYXNzLklzR2xvYmFsKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAga2VlcCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9jcmVhdGVkR2xvYmFsVWlkcy5wdXNoKGluc3QuR2V0VUlEKCkpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGtlZXApIHsKICAgICAgICAgICAgICAgICAgICBpbml0aWFsSW5zdGFuY2VzW2tdID0gaW5pdGlhbEluc3RhbmNlc1tpXTsKICAgICAgICAgICAgICAgICAgICArK2sKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBDMy50cnVuY2F0ZUFycmF5KGluaXRpYWxJbnN0YW5jZXMsIGspOwogICAgICAgICAgICB0aGlzLl9ydW50aW1lLkZsdXNoUGVuZGluZ0luc3RhbmNlcygpOwogICAgICAgICAgICB0aGlzLlNldFpJbmRpY2VzQ2hhbmdlZCgpCiAgICAgICAgfQogICAgICAgIF9BZGRJbnN0YW5jZShpbnN0LCBhZGRUb0dyaWQpIHsKICAgICAgICAgICAgaWYgKCFpbnN0LkdldFBsdWdpbigpLklzV29ybGRUeXBlKCkpIHRocm93IG5ldyBFcnJvcigiaW5zdGFuY2UgaXMgbm90IG9mIHdvcmxkIHR5cGUiKTsKICAgICAgICAgICAgY29uc3Qgd2kgPSBpbnN0LkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICBpZiAod2kuR2V0TGF5ZXIoKSAhPT0KICAgICAgICAgICAgICAgIHRoaXMpIHRocm93IG5ldyBFcnJvcigiaW5zdGFuY2UgYWRkZWQgdG8gd3JvbmcgbGF5ZXIiKTsKICAgICAgICAgICAgdGhpcy5faW5zdGFuY2VzLnB1c2goaW5zdCk7CiAgICAgICAgICAgIGlmICh3aS5HZXRaRWxldmF0aW9uKCkgIT09IDApIHRoaXMuX2FueUluc3RhbmNlWkVsZXZhdGVkID0gdHJ1ZTsKICAgICAgICAgICAgaWYgKGFkZFRvR3JpZCAmJiB0aGlzLlVzZXNSZW5kZXJDZWxscygpKSBpbnN0LkdldFdvcmxkSW5mbygpLlNldEJib3hDaGFuZ2VkKCk7CiAgICAgICAgICAgIHRoaXMuU2V0WkluZGljZXNDaGFuZ2VkKCkKICAgICAgICB9CiAgICAgICAgX01heWJlQWRkSW5zdGFuY2UoaW5zdCkgewogICAgICAgICAgICBpZiAodGhpcy5faW5zdGFuY2VzLmluY2x1ZGVzKGluc3QpKSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuX2luc3RhbmNlcy5wdXNoKGluc3QpOwogICAgICAgICAgICBpZiAoaW5zdC5HZXRXb3JsZEluZm8oKS5HZXRaRWxldmF0aW9uKCkgIT09IDApIHRoaXMuX2FueUluc3RhbmNlWkVsZXZhdGVkID0gdHJ1ZTsKICAgICAgICAgICAgdGhpcy5TZXRaSW5kaWNlc0NoYW5nZWQoKQogICAgICAgIH0KICAgICAgICBfUHJlcGVuZEluc3RhbmNlKGluc3QsIGFkZFRvR3JpZCkgewogICAgICAgICAgICBjb25zdCB3aSA9IGluc3QuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgIGlmICh3aS5HZXRMYXllcigpICE9PQogICAgICAgICAgICAgICAgdGhpcykgdGhyb3cgbmV3IEVycm9yKCJpbnN0YW5jZSBhZGRlZCB0byB3cm9uZyBsYXllciIpOwogICAgICAgICAgICB0aGlzLl9pbnN0YW5jZXMudW5zaGlmdChpbnN0KTsKICAgICAgICAgICAgaWYgKHdpLkdldFpFbGV2YXRpb24oKSAhPT0gMCkgdGhpcy5fYW55SW5zdGFuY2VaRWxldmF0ZWQgPSB0cnVlOwogICAgICAgICAgICB0aGlzLlNldFpJbmRpY2VzQ2hhbmdlZCgpOwogICAgICAgICAgICBpZiAoYWRkVG9HcmlkICYmIHRoaXMuVXNlc1JlbmRlckNlbGxzKCkpIGluc3QuR2V0V29ybGRJbmZvKCkuU2V0QmJveENoYW5nZWQoKQogICAgICAgIH0KICAgICAgICBfUmVtb3ZlSW5zdGFuY2UoaW5zdCwgcmVtb3ZlRnJvbUdyaWQpIHsKICAgICAgICAgICAgY29uc3QgaW5kZXggPSB0aGlzLl9pbnN0YW5jZXMuaW5kZXhPZihpbnN0KTsKICAgICAgICAgICAgaWYgKGluZGV4IDwgMCkgcmV0dXJuOwogICAgICAgICAgICBpZiAocmVtb3ZlRnJvbUdyaWQgJiYgdGhpcy5Vc2VzUmVuZGVyQ2VsbHMoKSkgaW5zdC5HZXRXb3JsZEluZm8oKS5fUmVtb3ZlRnJvbVJlbmRlckNlbGxzKCk7CiAgICAgICAgICAgIHRoaXMuX2luc3RhbmNlcy5zcGxpY2UoaW5kZXgsIDEpOwogICAgICAgICAgICB0aGlzLlNldFpJbmRpY2VzQ2hhbmdlZCgpOwogICAgICAgICAgICB0aGlzLl9NYXliZVJlc2V0QW55SW5zdGFuY2VaRWxldmF0ZWRGbGFnKCkKICAgICAgICB9CiAgICAgICAgX1NldEFueUluc3RhbmNlWkVsZXZhdGVkKCkgewogICAgICAgICAgICB0aGlzLl9hbnlJbnN0YW5jZVpFbGV2YXRlZCA9CiAgICAgICAgICAgICAgICB0cnVlCiAgICAgICAgfQogICAgICAgIF9NYXliZVJlc2V0QW55SW5zdGFuY2VaRWxldmF0ZWRGbGFnKCkgewogICAgICAgICAgICBpZiAodGhpcy5faW5zdGFuY2VzLmxlbmd0aCA9PT0gMCkgdGhpcy5fYW55SW5zdGFuY2VaRWxldmF0ZWQgPSBmYWxzZQogICAgICAgIH0KICAgICAgICBfU29ydEluc3RhbmNlc0J5TGFzdENhY2hlZFpJbmRleChpc1BlcnNpc3RNb2RlKSB7CiAgICAgICAgICAgIGlmIChpc1BlcnNpc3RNb2RlKSB7CiAgICAgICAgICAgICAgICBjb25zdCBhc3NpZ25lZFpJbmRpY2VzID0gbmV3IFNldDsKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgaW5zdCBvZiB0aGlzLl9pbnN0YW5jZXMpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBjYWNoZWRaSW5kZXggPSBpbnN0LkdldFdvcmxkSW5mbygpLl9HZXRMYXN0Q2FjaGVkWkluZGV4KCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGNhY2hlZFpJbmRleCA+PSAwKSBhc3NpZ25lZFpJbmRpY2VzLmFkZChjYWNoZWRaSW5kZXgpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBsZXQgaW5kZXggPSAtMTsKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgaW5zdCBvZiB0aGlzLl9pbnN0YW5jZXMpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCB3aSA9IGluc3QuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHdpLl9HZXRMYXN0Q2FjaGVkWkluZGV4KCkgPj0gMCkgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgKytpbmRleDsKICAgICAgICAgICAgICAgICAgICB3aGlsZSAoYXNzaWduZWRaSW5kaWNlcy5oYXMoaW5kZXgpKSArK2luZGV4OwogICAgICAgICAgICAgICAgICAgIHdpLl9TZXRaSW5kZXgoaW5kZXgpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5faW5zdGFuY2VzLnNvcnQoU29ydEJ5SW5zdExhc3RDYWNoZWRaSW5kZXgpCiAgICAgICAgfQogICAgICAgIF9TdGFydCgpIHt9CiAgICAgICAgX0VuZCgpIHsKICAgICAgICAgICAgZm9yIChjb25zdCBpbnN0IG9mIHRoaXMuX2luc3RhbmNlcykKICAgICAgICAgICAgICAgIGlmICghaW5zdC5HZXRPYmplY3RDbGFzcygpLklzR2xvYmFsKCkpIHRoaXMuX3J1bnRpbWUuRGVzdHJveUluc3RhbmNlKGluc3QpOwogICAgICAgICAgICB0aGlzLl9ydW50aW1lLkZsdXNoUGVuZGluZ0luc3RhbmNlcygpOwogICAgICAgICAgICBDMy5jbGVhckFycmF5KHRoaXMuX2luc3RhbmNlcyk7CiAgICAgICAgICAgIHRoaXMuX2FueUluc3RhbmNlWkVsZXZhdGVkID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuU2V0WkluZGljZXNDaGFuZ2VkKCkKICAgICAgICB9CiAgICAgICAgUmVjcmVhdGVJbml0aWFsT2JqZWN0cyhvYmplY3RDbGFzcywgcmMsIG9mZnNldFgsIG9mZnNldFksIGNyZWF0ZUhpZXJhcmNoeSkgewogICAgICAgICAgICBjb25zdCBldmVudFNoZWV0TWFuYWdlciA9IHRoaXMuX3J1bnRpbWUuR2V0RXZlbnRTaGVldE1hbmFnZXIoKTsKICAgICAgICAgICAgY29uc3QgYWxsT2JqZWN0Q2xhc3NlcyA9IHRoaXMuX3J1bnRpbWUuR2V0QWxsT2JqZWN0Q2xhc3NlcygpOwogICAgICAgICAgICBjb25zdCBpc0ZhbWlseSA9IG9iamVjdENsYXNzLklzRmFtaWx5KCk7CiAgICAgICAgICAgIGNvbnN0IHJldCA9IFtdOwogICAgICAgICAgICBmb3IgKGNvbnN0IGluc3REYXRhIG9mIHRoaXMuX2luaXRpYWxJbnN0YW5jZXMpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHdvcmxkRGF0YSA9IGluc3REYXRhWzBdOwogICAgICAgICAgICAgICAgY29uc3QgeCA9IHdvcmxkRGF0YVswXTsKICAgICAgICAgICAgICAgIGNvbnN0IHkgPSB3b3JsZERhdGFbMV07CiAgICAgICAgICAgICAgICBpZiAoIXJjLmNvbnRhaW5zUG9pbnQoeCwgeSkpIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgY29uc3Qgb2JqZWN0VHlwZSA9IGFsbE9iamVjdENsYXNzZXNbaW5zdERhdGFbMV1dOwogICAgICAgICAgICAgICAgaWYgKG9iamVjdFR5cGUgIT09IG9iamVjdENsYXNzKQogICAgICAgICAgICAgICAgICAgIGlmIChpc0ZhbWlseSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIW9iamVjdENsYXNzLkZhbWlseUhhc01lbWJlcihvYmplY3RUeXBlKSkgY29udGludWUKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgY29udGludWU7CiAgICAgICAgICAgICAgICBsZXQgY3JlYXRlT25MYXllciA9IHRoaXM7CiAgICAgICAgICAgICAgICBjb25zdCBydW5uaW5nTGF5b3V0ID0gdGhpcy5fcnVudGltZS5HZXRDdXJyZW50TGF5b3V0KCk7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5HZXRMYXlvdXQoKSAhPT0gcnVubmluZ0xheW91dCkgewogICAgICAgICAgICAgICAgICAgIGNyZWF0ZU9uTGF5ZXIgPSBydW5uaW5nTGF5b3V0LkdldExheWVyQnlOYW1lKHRoaXMuR2V0TmFtZSgpKTsKICAgICAgICAgICAgICAgICAgICBpZiAoIWNyZWF0ZU9uTGF5ZXIpIGNyZWF0ZU9uTGF5ZXIgPSBydW5uaW5nTGF5b3V0LkdldExheWVyQnlJbmRleCh0aGlzLkdldEluZGV4KCkpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjb25zdCBpbnN0ID0gdGhpcy5fcnVudGltZS5DcmVhdGVJbnN0YW5jZUZyb21EYXRhKGluc3REYXRhLCBjcmVhdGVPbkxheWVyLCBmYWxzZSwgdW5kZWZpbmVkLCB1bmRlZmluZWQsIGZhbHNlLCBjcmVhdGVIaWVyYXJjaHkpOwogICAgICAgICAgICAgICAgY3JlYXRlT25MYXllci5Tb3J0QW5kQWRkSW5zdGFuY2VzQnlaSW5kZXgoaW5zdCk7CiAgICAgICAgICAgICAgICBjb25zdCB3aSA9IGluc3QuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgICAgICB3aS5PZmZzZXRYWShvZmZzZXRYLCBvZmZzZXRZKTsKICAgICAgICAgICAgICAgIHdpLlNldEJib3hDaGFuZ2VkKCk7CiAgICAgICAgICAgICAgICBldmVudFNoZWV0TWFuYWdlci5CbG9ja0ZsdXNoaW5nSW5zdGFuY2VzKHRydWUpOwogICAgICAgICAgICAgICAgaW5zdC5fVHJpZ2dlck9uQ3JlYXRlZE9uU2VsZkFuZFJlbGF0ZWQoKTsKICAgICAgICAgICAgICAgIGV2ZW50U2hlZXRNYW5hZ2VyLkJsb2NrRmx1c2hpbmdJbnN0YW5jZXMoZmFsc2UpOwogICAgICAgICAgICAgICAgcmV0LnB1c2goaW5zdCkKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcmV0CiAgICAgICAgfQogICAgICAgIEdldEluc3RhbmNlQ291bnQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pbnN0YW5jZXMubGVuZ3RoCiAgICAgICAgfQogICAgICAgIEdldExheW91dCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2xheW91dAogICAgICAgIH0KICAgICAgICBHZXROYW1lKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fbmFtZQogICAgICAgIH0KICAgICAgICBfU2V0SW5kZXgoaSkgewogICAgICAgICAgICB0aGlzLl9pbmRleCA9CiAgICAgICAgICAgICAgICBpCiAgICAgICAgfQogICAgICAgIEdldEluZGV4KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faW5kZXgKICAgICAgICB9CiAgICAgICAgR2V0U0lEKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fc2lkCiAgICAgICAgfQogICAgICAgIEdldFJ1bnRpbWUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lCiAgICAgICAgfQogICAgICAgIEdldERldmljZVBpeGVsUmF0aW8oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lLkdldERldmljZVBpeGVsUmF0aW8oKQogICAgICAgIH0KICAgICAgICBHZXRFZmZlY3RMaXN0KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZWZmZWN0TGlzdAogICAgICAgIH0KICAgICAgICBHZXRFZmZlY3RDaGFpbigpIHsKICAgICAgICAgICAgdGhpcy5fTWF5YmVSZWJ1aWxkRWZmZWN0Q2hhaW5TdGVwcygpOwogICAgICAgICAgICByZXR1cm4gdGhpcy5fZWZmZWN0Q2hhaW4KICAgICAgICB9CiAgICAgICAgX01heWJlUmVidWlsZEVmZmVjdENoYWluU3RlcHMoKSB7CiAgICAgICAgICAgIGNvbnN0IGlzRGVmYXVsdENvbG9yID0gdGhpcy5IYXNEZWZhdWx0Q29sb3IoKTsKICAgICAgICAgICAgaWYgKCF0aGlzLl9uZWVkc1JlYnVpbGRFZmZlY3RDaGFpblN0ZXBzICYmIGlzRGVmYXVsdENvbG9yID09PSB0aGlzLl93YXNEZWZhdWx0Q29sb3IgJiYgIXRoaXMuX2VmZmVjdENoYWluLk5lZWRzUmVidWlsZCgpKSByZXR1cm47CiAgICAgICAgICAgIGNvbnN0IGFjdGl2ZUVmZmVjdFR5cGVzID0gdGhpcy5HZXRFZmZlY3RMaXN0KCkuR2V0QWN0aXZlRWZmZWN0VHlwZXMoKTsKICAgICAgICAgICAgdGhpcy5fZWZmZWN0Q2hhaW4uQnVpbGRTdGVwcyhhY3RpdmVFZmZlY3RUeXBlcy5tYXAoZSA9PiBlLkdldFNoYWRlclByb2dyYW0oKSksIHsKICAgICAgICAgICAgICAgIGluZGV4TWFwOiBhY3RpdmVFZmZlY3RUeXBlcy5tYXAoZSA9PiBlLkdldEluZGV4KCkpLAogICAgICAgICAgICAgICAgZm9yY2VQcmVEcmF3OiAhaXNEZWZhdWx0Q29sb3IsCiAgICAgICAgICAgICAgICB1c2VGdWxsU3VyZmFjZTogdHJ1ZQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdGhpcy5fbmVlZHNSZWJ1aWxkRWZmZWN0Q2hhaW5TdGVwcyA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl93YXNEZWZhdWx0Q29sb3IgPSBpc0RlZmF1bHRDb2xvcgogICAgICAgIH0KICAgICAgICBVcGRhdGVBY3RpdmVFZmZlY3RzKCkgewogICAgICAgICAgICB0aGlzLkdldEVmZmVjdExpc3QoKS5VcGRhdGVBY3RpdmVFZmZlY3RzKCk7CiAgICAgICAgICAgIHRoaXMuX25lZWRzUmVidWlsZEVmZmVjdENoYWluU3RlcHMgPSB0cnVlCiAgICAgICAgfQogICAgICAgIFVzZXNSZW5kZXJDZWxscygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3VzZVJlbmRlckNlbGxzICYmICF0aGlzLl91c2VDYW1lcmFEaXN0YW5jZURyYXdPcmRlcgogICAgICAgIH0KICAgICAgICBHZXRSZW5kZXJHcmlkKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fcmVuZGVyR3JpZAogICAgICAgIH0KICAgICAgICBTZXRSZW5kZXJMaXN0U3RhbGUoKSB7CiAgICAgICAgICAgIHRoaXMuX2lzUmVuZGVyTGlzdFVwVG9EYXRlID0KICAgICAgICAgICAgICAgIGZhbHNlCiAgICAgICAgfQogICAgICAgIElzVmlzaWJsZSgpIHsKICAgICAgICAgICAgZm9yIChjb25zdCBsYXllciBvZiB0aGlzLnNlbGZBbmRQYXJlbnRMYXllcnMoKSkKICAgICAgICAgICAgICAgIGlmICghbGF5ZXIuX0lzVmlzaWJsZUZsYWdTZXQoKSkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgIH0KICAgICAgICBfSXNWaXNpYmxlRmxhZ1NldCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2lzVmlzaWJsZQogICAgICAgIH0KICAgICAgICBTZXRWaXNpYmxlKHYpIHsKICAgICAgICAgICAgdiA9ICEhdjsKICAgICAgICAgICAgaWYgKHRoaXMuX2lzVmlzaWJsZSA9PT0gdikgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl9pc1Zpc2libGUgPSB2OwogICAgICAgICAgICB0aGlzLl9ydW50aW1lLlVwZGF0ZVJlbmRlcigpCiAgICAgICAgfQogICAgICAgIFNldEludGVyYWN0aXZlKGkpIHsKICAgICAgICAgICAgdGhpcy5faXNJbnRlcmFjdGl2ZSA9ICEhaQogICAgICAgIH0KICAgICAgICBJc0ludGVyYWN0aXZlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faXNJbnRlcmFjdGl2ZQogICAgICAgIH0KICAgICAgICBJc1NlbGZBbmRQYXJlbnRzSW50ZXJhY3RpdmUoKSB7CiAgICAgICAgICAgIGZvciAoY29uc3QgbGF5ZXIgb2YgdGhpcy5zZWxmQW5kUGFyZW50TGF5ZXJzKCkpCiAgICAgICAgICAgICAgICBpZiAoIWxheWVyLklzSW50ZXJhY3RpdmUoKSkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgIH0KICAgICAgICBTZXRPd25TY3JvbGxQb3NpdGlvbkVuYWJsZWQoZSkgewogICAgICAgICAgICBlID0gISFlOwogICAgICAgICAgICBpZiAodGhpcy5faGFzT3duU2Nyb2xsUG9zaXRpb24gPT09IGUpIHJldHVybjsKICAgICAgICAgICAgdGhpcy5faGFzT3duU2Nyb2xsUG9zaXRpb24gPSBlOwogICAgICAgICAgICBpZiAoZSkgewogICAgICAgICAgICAgICAgY29uc3QgbGF5b3V0ID0gdGhpcy5HZXRMYXlvdXQoKTsKICAgICAgICAgICAgICAgIHRoaXMuX3Njcm9sbFggPSBsYXlvdXQuR2V0U2Nyb2xsWCgpOwogICAgICAgICAgICAgICAgdGhpcy5fc2Nyb2xsWSA9IGxheW91dC5HZXRTY3JvbGxZKCkKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLl9TZXRNVk1hdHJpeENoYW5nZWQoKTsKICAgICAgICAgICAgdGhpcy5fcnVudGltZS5VcGRhdGVSZW5kZXIoKQogICAgICAgIH0KICAgICAgICBJc093blNjcm9sbFBvc2l0aW9uRW5hYmxlZCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2hhc093blNjcm9sbFBvc2l0aW9uCiAgICAgICAgfQogICAgICAgIFNldFNjcm9sbFgoeCkgewogICAgICAgICAgICBjb25zdCBsYXlvdXQgPSB0aGlzLkdldExheW91dCgpOwogICAgICAgICAgICBjb25zdCBsYm91bmQgPSBsYXlvdXQuR2V0U2Nyb2xsTGVmdEJvdW5kKCk7CiAgICAgICAgICAgIGNvbnN0IHJib3VuZCA9IGxheW91dC5HZXRTY3JvbGxSaWdodEJvdW5kKCk7CiAgICAgICAgICAgIGlmICh4ID4gcmJvdW5kKSB4ID0gcmJvdW5kOwogICAgICAgICAgICBpZiAoeCA8IGxib3VuZCkgeCA9IGxib3VuZDsKICAgICAgICAgICAgaWYgKHRoaXMuX3Njcm9sbFggIT09IHgpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3Njcm9sbFggPQogICAgICAgICAgICAgICAgICAgIHg7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5Jc093blNjcm9sbFBvc2l0aW9uRW5hYmxlZCgpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fU2V0TVZNYXRyaXhDaGFuZ2VkKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcnVudGltZS5VcGRhdGVSZW5kZXIoKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIFNldFNjcm9sbFkoeSkgewogICAgICAgICAgICBjb25zdCBsYXlvdXQgPSB0aGlzLkdldExheW91dCgpOwogICAgICAgICAgICBjb25zdCB1Ym91bmQgPSBsYXlvdXQuR2V0U2Nyb2xsVG9wQm91bmQoKTsKICAgICAgICAgICAgY29uc3QgYmJvdW5kID0gbGF5b3V0LkdldFNjcm9sbEJvdHRvbUJvdW5kKCk7CiAgICAgICAgICAgIGlmICh5ID4gYmJvdW5kKSB5ID0gYmJvdW5kOwogICAgICAgICAgICBpZiAoeSA8IHVib3VuZCkgeSA9IHVib3VuZDsKICAgICAgICAgICAgaWYgKHRoaXMuX3Njcm9sbFkgIT09IHkpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3Njcm9sbFkgPSB5OwogICAgICAgICAgICAgICAgaWYgKHRoaXMuSXNPd25TY3JvbGxQb3NpdGlvbkVuYWJsZWQoKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX1NldE1WTWF0cml4Q2hhbmdlZCgpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuVXBkYXRlUmVuZGVyKCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBHZXRTY3JvbGxYKCkgewogICAgICAgICAgICBpZiAodGhpcy5Jc093blNjcm9sbFBvc2l0aW9uRW5hYmxlZCgpKSByZXR1cm4gdGhpcy5fc2Nyb2xsWDsKICAgICAgICAgICAgZWxzZSByZXR1cm4gdGhpcy5HZXRMYXlvdXQoKS5HZXRTY3JvbGxYKCkKICAgICAgICB9CiAgICAgICAgR2V0U2Nyb2xsWSgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuSXNPd25TY3JvbGxQb3NpdGlvbkVuYWJsZWQoKSkgcmV0dXJuIHRoaXMuX3Njcm9sbFk7CiAgICAgICAgICAgIGVsc2UgcmV0dXJuIHRoaXMuR2V0TGF5b3V0KCkuR2V0U2Nyb2xsWSgpCiAgICAgICAgfQogICAgICAgIEdldFZpZXdwb3J0KCkgewogICAgICAgICAgICB0aGlzLl9NYXliZVVwZGF0ZVZpZXdwb3J0KCk7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl92aWV3cG9ydAogICAgICAgIH0KICAgICAgICBfR2V0Vmlld3BvcnRaMCgpIHsKICAgICAgICAgICAgdGhpcy5fTWF5YmVVcGRhdGVWaWV3cG9ydCgpOwogICAgICAgICAgICByZXR1cm4gdGhpcy5fdmlld3BvcnRaMAogICAgICAgIH0KICAgICAgICBHZXRWaWV3cG9ydDNEKCkgewogICAgICAgICAgICB0aGlzLl9NYXliZVVwZGF0ZVZpZXdwb3J0KCk7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl92aWV3cG9ydDNECiAgICAgICAgfQogICAgICAgIF9HZXRWYW5pc2hpbmdQb2ludCgpIHsKICAgICAgICAgICAgY29uc3QgbGF5b3V0ID0gdGhpcy5HZXRMYXlvdXQoKTsKICAgICAgICAgICAgcmV0dXJuIFtsYXlvdXQuR2V0VmFuaXNoaW5nUG9pbnRYKCksIGxheW91dC5HZXRWYW5pc2hpbmdQb2ludFkoKV0KICAgICAgICB9CiAgICAgICAgR2V0RGVmYXVsdENhbWVyYVoodmlld0gpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUuR2V0RGVmYXVsdENhbWVyYVoodmlld0gpCiAgICAgICAgfQogICAgICAgIEdldFZpZXdwb3J0Rm9yWih6LCBvdXRSZWN0KSB7CiAgICAgICAgICAgIGNvbnN0IHZpZXdwb3J0WjAgPSB0aGlzLl9HZXRWaWV3cG9ydFowKCk7CiAgICAgICAgICAgIGlmICh6ID09PQogICAgICAgICAgICAgICAgMCkgb3V0UmVjdC5jb3B5KHZpZXdwb3J0WjApOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGxldCBtaWRYID0gdmlld3BvcnRaMC5taWRYKCk7CiAgICAgICAgICAgICAgICBsZXQgbWlkWSA9IHZpZXdwb3J0WjAubWlkWSgpOwogICAgICAgICAgICAgICAgY29uc3Qgc2NhbGVGYWN0b3IgPSB0aGlzLkdldDJEU2NhbGVGYWN0b3JUb1ooeik7CiAgICAgICAgICAgICAgICBjb25zdCB2aWV3VyA9IHZpZXdwb3J0WjAud2lkdGgoKSAvIHNjYWxlRmFjdG9yOwogICAgICAgICAgICAgICAgY29uc3Qgdmlld0ggPSB2aWV3cG9ydFowLmhlaWdodCgpIC8gc2NhbGVGYWN0b3I7CiAgICAgICAgICAgICAgICBjb25zdCBbdnBYLCB2cFldID0gdGhpcy5fR2V0VmFuaXNoaW5nUG9pbnQoKTsKICAgICAgICAgICAgICAgIGlmICh2cFggIT09IC41IHx8IHZwWSAhPT0gLjUpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBjYW1lcmFaID0gdGhpcy5HZXRDYW1lcmFaKCk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcnVudGltZSA9IHRoaXMuX3J1bnRpbWU7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgemYgPSB0aGlzLkdldERlZmF1bHRDYW1lcmFaKCkgLyBjYW1lcmFaOwogICAgICAgICAgICAgICAgICAgIGxldCBjYW1PZmZYID0gKHZwWCAtIC41KSAqIHJ1bnRpbWUuR2V0Vmlld3BvcnRXaWR0aCgpIC8gemY7CiAgICAgICAgICAgICAgICAgICAgbGV0IGNhbU9mZlkgPSAodnBZIC0gLjUpICogcnVudGltZS5HZXRWaWV3cG9ydEhlaWdodCgpIC8gemY7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYSA9IHRoaXMuR2V0QW5nbGUoKTsKICAgICAgICAgICAgICAgICAgICBpZiAoYSAhPT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICB0ZW1wVmVjMi5zZXQoY2FtT2ZmWCwgY2FtT2ZmWSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBWZWMyLnJvdGF0ZShhKTsKICAgICAgICAgICAgICAgICAgICAgICAgY2FtT2ZmWCA9IHRlbXBWZWMyLmdldFgoKTsKICAgICAgICAgICAgICAgICAgICAgICAgY2FtT2ZmWSA9IHRlbXBWZWMyLmdldFkoKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBjb25zdCB6UHJvZyA9IEMzLnVubGVycChjYW1lcmFaLCAwLCB6KTsKICAgICAgICAgICAgICAgICAgICBtaWRYICs9IEMzLmxlcnAoY2FtT2ZmWCwgMCwgelByb2cpOwogICAgICAgICAgICAgICAgICAgIG1pZFkgKz0gQzMubGVycChjYW1PZmZZLCAwLCB6UHJvZykKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIG91dFJlY3Quc2V0KG1pZFggLSB2aWV3VyAvIDIsIG1pZFkgLSB2aWV3SCAvIDIsIG1pZFggKyB2aWV3VyAvIDIsIG1pZFkgKyB2aWV3SCAvIDIpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgR2V0T3BhY2l0eSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NvbG9yLmdldEEoKQogICAgICAgIH0KICAgICAgICBTZXRPcGFjaXR5KG8pIHsKICAgICAgICAgICAgbyA9IEMzLmNsYW1wKG8sIDAsIDEpOwogICAgICAgICAgICBpZiAodGhpcy5fY29sb3IuZ2V0QSgpID09PSBvKSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuX2NvbG9yLnNldEEobyk7CiAgICAgICAgICAgIHRoaXMuX1VwZGF0ZVByZW11bHRpcGxpZWRDb2xvcigpOwogICAgICAgICAgICB0aGlzLl9ydW50aW1lLlVwZGF0ZVJlbmRlcigpCiAgICAgICAgfQogICAgICAgIF9VcGRhdGVQcmVtdWx0aXBsaWVkQ29sb3IoKSB7CiAgICAgICAgICAgIHRoaXMuX3ByZW11bHRpcGxpZWRDb2xvci5jb3B5KHRoaXMuX2NvbG9yKTsKICAgICAgICAgICAgdGhpcy5fcHJlbXVsdGlwbGllZENvbG9yLnByZW11bHRpcGx5KCkKICAgICAgICB9CiAgICAgICAgR2V0UHJlbXVsdGlwbGllZENvbG9yKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fcHJlbXVsdGlwbGllZENvbG9yCiAgICAgICAgfQogICAgICAgIEhhc0RlZmF1bHRDb2xvcigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NvbG9yLmVxdWFsc1JnYmEoMSwgMSwgMSwgMSkKICAgICAgICB9CiAgICAgICAgR2V0U2NhbGVSYXRlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fc2NhbGVSYXRlCiAgICAgICAgfQogICAgICAgIFNldFNjYWxlUmF0ZShyKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9zY2FsZVJhdGUgPT09IHIpIHJldHVybjsKICAgICAgICAgICAgdGhpcy5fc2NhbGVSYXRlID0gcjsKICAgICAgICAgICAgdGhpcy5fU2V0TVZNYXRyaXhDaGFuZ2VkKCk7CiAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuVXBkYXRlUmVuZGVyKCkKICAgICAgICB9CiAgICAgICAgR2V0UGFyYWxsYXhYKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fcGFyYWxsYXhYCiAgICAgICAgfQogICAgICAgIEdldFBhcmFsbGF4WSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3BhcmFsbGF4WQogICAgICAgIH0KICAgICAgICBTZXRQYXJhbGxheChweCwgcHkpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX3BhcmFsbGF4WCA9PT0gcHggJiYgdGhpcy5fcGFyYWxsYXhZID09PSBweSkgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl9wYXJhbGxheFggPSBweDsKICAgICAgICAgICAgdGhpcy5fcGFyYWxsYXhZID0gcHk7CiAgICAgICAgICAgIHRoaXMuX1NldE1WTWF0cml4Q2hhbmdlZCgpOwogICAgICAgICAgICB0aGlzLl9ydW50aW1lLlVwZGF0ZVJlbmRlcigpOwogICAgICAgICAgICBpZiAodGhpcy5fcGFyYWxsYXhYICE9PSAxIHx8IHRoaXMuX3BhcmFsbGF4WSAhPT0gMSkKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgaW5zdCBvZiB0aGlzLl9pbnN0YW5jZXMpIGluc3QuR2V0T2JqZWN0Q2xhc3MoKS5fU2V0QW55SW5zdGFuY2VQYXJhbGxheGVkKHRydWUpCiAgICAgICAgfQogICAgICAgIFNldFBhcmFsbGF4WChweCkgewogICAgICAgICAgICB0aGlzLlNldFBhcmFsbGF4KHB4LCB0aGlzLkdldFBhcmFsbGF4WSgpKQogICAgICAgIH0KICAgICAgICBTZXRQYXJhbGxheFkocHkpIHsKICAgICAgICAgICAgdGhpcy5TZXRQYXJhbGxheCh0aGlzLkdldFBhcmFsbGF4WCgpLCBweSkKICAgICAgICB9CiAgICAgICAgU2V0WkVsZXZhdGlvbih6KSB7CiAgICAgICAgICAgIGlmICh0aGlzLl96RWxldmF0aW9uID09PSB6KSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuX3pFbGV2YXRpb24gPSB6OwogICAgICAgICAgICB0aGlzLl9ydW50aW1lLlVwZGF0ZVJlbmRlcigpCiAgICAgICAgfQogICAgICAgIEdldFpFbGV2YXRpb24oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl96RWxldmF0aW9uCiAgICAgICAgfQogICAgICAgIFNldEFuZ2xlKGEpIHsKICAgICAgICAgICAgYSA9IEMzLmNsYW1wQW5nbGUoYSk7CiAgICAgICAgICAgIGlmICh0aGlzLl9hbmdsZSA9PT0gYSkgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl9hbmdsZSA9IGE7CiAgICAgICAgICAgIHRoaXMuX1NldE1WTWF0cml4Q2hhbmdlZCgpOwogICAgICAgICAgICB0aGlzLl9ydW50aW1lLlVwZGF0ZVJlbmRlcigpCiAgICAgICAgfQogICAgICAgIEdldEFuZ2xlKCkgewogICAgICAgICAgICByZXR1cm4gQzMuY2xhbXBBbmdsZSh0aGlzLl9sYXlvdXQuR2V0QW5nbGUoKSArIHRoaXMuX2FuZ2xlKQogICAgICAgIH0KICAgICAgICBHZXRPd25BbmdsZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2FuZ2xlCiAgICAgICAgfQogICAgICAgIEhhc0luc3RhbmNlcygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2luc3RhbmNlcy5sZW5ndGggPiAwCiAgICAgICAgfQogICAgICAgIF9HZXRJbnN0YW5jZXMoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pbnN0YW5jZXMKICAgICAgICB9CiAgICAgICAgX0dldEluc3RhbmNlc0luRHJhd09yZGVyKCkgewogICAgICAgICAgICBpZiAodGhpcy5SZW5kZXJzSW4zRE1vZGUoKSAmJiB0aGlzLl91c2VDYW1lcmFEaXN0YW5jZURyYXdPcmRlcikgewogICAgICAgICAgICAgICAgQzMuc2hhbGxvd0Fzc2lnbkFycmF5KHRlbXBJbnN0YW5jZXNCeUNhbWVyYURpc3QsIHRoaXMuX0dldEluc3RhbmNlcygpKTsKICAgICAgICAgICAgICAgIHRlbXBJbnN0YW5jZXNCeUNhbWVyYURpc3Quc29ydCgoYSwgYikgPT4gdGhpcy5fU29ydEluc3RhbmNlc0J5Q2FtZXJhRGlzdGFuY2UoYSwgYikpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRlbXBJbnN0YW5jZXNCeUNhbWVyYURpc3QKICAgICAgICAgICAgfSBlbHNlIHJldHVybiB0aGlzLl9HZXRJbnN0YW5jZXMoKQogICAgICAgIH0KICAgICAgICBfQXBwZW5kQWxsSW5zdGFuY2VzSW5jbHVkaW5nU3ViTGF5ZXJzSW5EcmF3T3JkZXIoYXJyKSB7CiAgICAgICAgICAgIEMzLmFwcGVuZEFycmF5KGFyciwKICAgICAgICAgICAgICAgIHRoaXMuX0dldEluc3RhbmNlc0luRHJhd09yZGVyKCkpOwogICAgICAgICAgICBmb3IgKGNvbnN0IHN1YkxheWVyIG9mIHRoaXMuX3N1YkxheWVycykKICAgICAgICAgICAgICAgIGlmIChzdWJMYXllci5Jc1Zpc2libGUoKSAmJiBzdWJMYXllci5HZXRPcGFjaXR5KCkgPiAwKSBzdWJMYXllci5fQXBwZW5kQWxsSW5zdGFuY2VzSW5jbHVkaW5nU3ViTGF5ZXJzSW5EcmF3T3JkZXIoYXJyKQogICAgICAgIH0KICAgICAgICBfU29ydEluc3RhbmNlc0J5Q2FtZXJhRGlzdGFuY2UoYSwgYikgewogICAgICAgICAgICBjb25zdCBjYW1WZWMgPSB0aGlzLkdldExheW91dCgpLkdldDNEQ2FtZXJhUG9zaXRpb24oKTsKICAgICAgICAgICAgY29uc3QgY2FtWCA9IGNhbVZlY1swXTsKICAgICAgICAgICAgY29uc3QgY2FtWSA9IGNhbVZlY1sxXTsKICAgICAgICAgICAgY29uc3QgY2FtWiA9IGNhbVZlY1syXTsKICAgICAgICAgICAgY29uc3Qgd2lBID0gYS5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgY29uc3Qgd2lCID0gYi5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgY29uc3QgZHhBID0gd2lBLkdldFgoKSAtIGNhbVg7CiAgICAgICAgICAgIGNvbnN0IGR5QSA9IHdpQS5HZXRZKCkgLSBjYW1ZOwogICAgICAgICAgICBjb25zdCBkekEgPSB3aUEuR2V0WkVsZXZhdGlvbigpIC0gY2FtWjsKICAgICAgICAgICAgY29uc3QgZHhCID0gd2lCLkdldFgoKSAtIGNhbVg7CiAgICAgICAgICAgIGNvbnN0IGR5QiA9IHdpQi5HZXRZKCkgLSBjYW1ZOwogICAgICAgICAgICBjb25zdCBkekIgPSB3aUIuR2V0WkVsZXZhdGlvbigpIC0gY2FtWjsKICAgICAgICAgICAgcmV0dXJuIGR4QiAqIGR4QiArIGR5QiAqIGR5QiArIGR6QiAqIGR6QiAtIChkeEEgKiBkeEEgKyBkeUEgKiBkeUEgKyBkekEgKiBkekEpCiAgICAgICAgfQogICAgICAgIEdldEJhY2tncm91bmRDb2xvcigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2JhY2tncm91bmRDb2xvcgogICAgICAgIH0KICAgICAgICBJc1RyYW5zcGFyZW50KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faXNUcmFuc3BhcmVudAogICAgICAgIH0KICAgICAgICBTZXRUcmFuc3BhcmVudCh0KSB7CiAgICAgICAgICAgIHQgPSAhIXQ7CiAgICAgICAgICAgIGlmICh0aGlzLl9pc1RyYW5zcGFyZW50ID09PSB0KSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuX2lzVHJhbnNwYXJlbnQgPSB0OwogICAgICAgICAgICB0aGlzLl9ydW50aW1lLlVwZGF0ZVJlbmRlcigpCiAgICAgICAgfQogICAgICAgIElzRm9yY2VPd25UZXh0dXJlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faXNGb3JjZU93blRleHR1cmUKICAgICAgICB9CiAgICAgICAgU2V0Rm9yY2VPd25UZXh0dXJlKGYpIHsKICAgICAgICAgICAgZiA9ICEhZjsKICAgICAgICAgICAgaWYgKHRoaXMuX2lzRm9yY2VPd25UZXh0dXJlID09PSBmKSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuX2lzRm9yY2VPd25UZXh0dXJlID0gZjsKICAgICAgICAgICAgdGhpcy5fcnVudGltZS5VcGRhdGVSZW5kZXIoKQogICAgICAgIH0KICAgICAgICBSZW5kZXJzSW4yRE1vZGUoKSB7CiAgICAgICAgICAgIHJldHVybiAhdGhpcy5HZXRSdW50aW1lKCkuVXNlczNERmVhdHVyZXMoKSB8fAogICAgICAgICAgICAgICAgIXRoaXMuX3JlbmRlckFzM2QKICAgICAgICB9CiAgICAgICAgUmVuZGVyc0luM0RNb2RlKCkgewogICAgICAgICAgICByZXR1cm4gIXRoaXMuUmVuZGVyc0luMkRNb2RlKCkKICAgICAgICB9CiAgICAgICAgSGFzM0RDYW1lcmEoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLlJlbmRlcnNJbjNETW9kZSgpICYmIHRoaXMuR2V0TGF5b3V0KCkuSXMzRENhbWVyYUVuYWJsZWQoKQogICAgICAgIH0KICAgICAgICBTZWxmQW5kQWxsU3ViTGF5ZXJzSGF2ZTNEQ2FtZXJhKCkgewogICAgICAgICAgICBpZiAoIXRoaXMuSGFzM0RDYW1lcmEoKSkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBmb3IgKGNvbnN0IHN1YkxheWVyIG9mIHRoaXMuX3N1YkxheWVycykKICAgICAgICAgICAgICAgIGlmICghc3ViTGF5ZXIuU2VsZkFuZEFsbFN1YkxheWVyc0hhdmUzRENhbWVyYSgpKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgfQogICAgICAgIFNldEJsZW5kTW9kZShibSkgewogICAgICAgICAgICBpZiAodGhpcy5fYmxlbmRNb2RlID09PSBibSkgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl9ibGVuZE1vZGUgPSBibTsKICAgICAgICAgICAgdGhpcy5fcnVudGltZS5VcGRhdGVSZW5kZXIoKQogICAgICAgIH0KICAgICAgICBHZXRCbGVuZE1vZGUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9ibGVuZE1vZGUKICAgICAgICB9CiAgICAgICAgSXNSb290TGF5ZXIoKSB7CiAgICAgICAgICAgIHJldHVybiAhdGhpcy5fcGFyZW50TGF5ZXIKICAgICAgICB9CiAgICAgICAgR2V0UGFyZW50TGF5ZXIoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9wYXJlbnRMYXllcgogICAgICAgIH0KICAgICAgICBHZXRTdWJMYXllcnMoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zdWJMYXllcnMKICAgICAgICB9CiAgICAgICAgSGFzQW55U3ViTGF5ZXJzKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fc3ViTGF5ZXJzLmxlbmd0aCA+CiAgICAgICAgICAgICAgICAwCiAgICAgICAgfQogICAgICAgIEhhc0FueVZpc2libGVTdWJMYXllcigpIHsKICAgICAgICAgICAgZm9yIChjb25zdCBzdWJMYXllciBvZiB0aGlzLl9zdWJMYXllcnMpCiAgICAgICAgICAgICAgICBpZiAoc3ViTGF5ZXIuU2hvdWxkRHJhdygpKSByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgfSogc2VsZkFuZEFsbFN1YkxheWVycygpIHsKICAgICAgICAgICAgZm9yIChjb25zdCBzdWJMYXllciBvZiB0aGlzLl9zdWJMYXllcnMpIHlpZWxkKiBzdWJMYXllci5zZWxmQW5kQWxsU3ViTGF5ZXJzKCk7CiAgICAgICAgICAgIHlpZWxkIHRoaXMKICAgICAgICB9KiBwYXJlbnRMYXllcnMoKSB7CiAgICAgICAgICAgIGxldCBwYXJlbnRMYXllciA9IHRoaXMuR2V0UGFyZW50TGF5ZXIoKTsKICAgICAgICAgICAgd2hpbGUgKHBhcmVudExheWVyKSB7CiAgICAgICAgICAgICAgICB5aWVsZCBwYXJlbnRMYXllcjsKICAgICAgICAgICAgICAgIHBhcmVudExheWVyID0gcGFyZW50TGF5ZXIuR2V0UGFyZW50TGF5ZXIoKQogICAgICAgICAgICB9CiAgICAgICAgfSogc2VsZkFuZFBhcmVudExheWVycygpIHsKICAgICAgICAgICAgeWllbGQgdGhpczsKICAgICAgICAgICAgeWllbGQqIHRoaXMucGFyZW50TGF5ZXJzKCkKICAgICAgICB9CiAgICAgICAgSXNUcmFuc2Zvcm1Db21wYXRpYmxlV2l0aChvdGhlckxheWVyKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzID09PSBvdGhlckxheWVyIHx8IHRoaXMuX3BhcmFsbGF4WCA9PT0gb3RoZXJMYXllci5fcGFyYWxsYXhYICYmCiAgICAgICAgICAgICAgICB0aGlzLl9wYXJhbGxheFkgPT09IG90aGVyTGF5ZXIuX3BhcmFsbGF4WSAmJiB0aGlzLl9zY2FsZSA9PT0gb3RoZXJMYXllci5fc2NhbGUgJiYgdGhpcy5fc2NhbGVSYXRlID09PSBvdGhlckxheWVyLl9zY2FsZVJhdGUgJiYgdGhpcy5fYW5nbGUgPT09IG90aGVyTGF5ZXIuX2FuZ2xlICYmIHRoaXMuR2V0U2Nyb2xsWCgpID09PSBvdGhlckxheWVyLkdldFNjcm9sbFgoKSAmJiB0aGlzLkdldFNjcm9sbFkoKSA9PT0gb3RoZXJMYXllci5HZXRTY3JvbGxZKCkKICAgICAgICB9CiAgICAgICAgU2F2ZVRyYW5zZm9ybSgpIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICJwYXJhbGxheFgiOiB0aGlzLkdldFBhcmFsbGF4WCgpLAogICAgICAgICAgICAgICAgInBhcmFsbGF4WSI6IHRoaXMuR2V0UGFyYWxsYXhZKCksCiAgICAgICAgICAgICAgICAic2NhbGUiOiB0aGlzLkdldE93blNjYWxlKCksCiAgICAgICAgICAgICAgICAic2NhbGVSYXRlIjogdGhpcy5HZXRTY2FsZVJhdGUoKSwKICAgICAgICAgICAgICAgICJhbmdsZSI6IHRoaXMuR2V0T3duQW5nbGUoKSwKICAgICAgICAgICAgICAgICJoYXNPd25TY3JvbGwiOiB0aGlzLklzT3duU2Nyb2xsUG9zaXRpb25FbmFibGVkKCksCiAgICAgICAgICAgICAgICAic2Nyb2xsWCI6IHRoaXMuR2V0U2Nyb2xsWCgpLAogICAgICAgICAgICAgICAgInNjcm9sbFkiOiB0aGlzLkdldFNjcm9sbFkoKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIFJlc3RvcmVUcmFuc2Zvcm0odCkgewogICAgICAgICAgICB0aGlzLlNldFBhcmFsbGF4KHRbInBhcmFsbGF4WCJdLAogICAgICAgICAgICAgICAgdFsicGFyYWxsYXhZIl0pOwogICAgICAgICAgICB0aGlzLlNldE93blNjYWxlKHRbInNjYWxlIl0pOwogICAgICAgICAgICB0aGlzLlNldFNjYWxlUmF0ZSh0WyJzY2FsZVJhdGUiXSk7CiAgICAgICAgICAgIHRoaXMuU2V0QW5nbGUodFsiYW5nbGUiXSk7CiAgICAgICAgICAgIHRoaXMuU2V0T3duU2Nyb2xsUG9zaXRpb25FbmFibGVkKHRbImhhc093blNjcm9sbCJdKTsKICAgICAgICAgICAgdGhpcy5TZXRTY3JvbGxYKHRbInNjcm9sbFgiXSk7CiAgICAgICAgICAgIHRoaXMuU2V0U2Nyb2xsWSh0WyJzY3JvbGxZIl0pOwogICAgICAgICAgICB0aGlzLl9NYXliZVVwZGF0ZVZpZXdwb3J0KCkKICAgICAgICB9CiAgICAgICAgX1JlbW92ZUFsbEluc3RhbmNlc0luU2V0KHMpIHsKICAgICAgICAgICAgaWYgKHMuc2l6ZSA9PT0gMCkgcmV0dXJuOwogICAgICAgICAgICBjb25zdCBudW1SZW1vdmVkID0gQzMuYXJyYXlSZW1vdmVBbGxJblNldCh0aGlzLl9pbnN0YW5jZXMsIHMpOwogICAgICAgICAgICBpZiAobnVtUmVtb3ZlZCA+IDApIHsKICAgICAgICAgICAgICAgIHRoaXMuX01heWJlUmVzZXRBbnlJbnN0YW5jZVpFbGV2YXRlZEZsYWcoKTsKICAgICAgICAgICAgICAgIHRoaXMuU2V0WkluZGljZXNDaGFuZ2VkKCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBTZXRaSW5kaWNlc0NoYW5nZWQoKSB7CiAgICAgICAgICAgIHRoaXMuX3pJbmRpY2VzVXBUb0RhdGUgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5faXNSZW5kZXJMaXN0VXBUb0RhdGUgPQogICAgICAgICAgICAgICAgZmFsc2UKICAgICAgICB9CiAgICAgICAgX1VwZGF0ZVpJbmRpY2VzKCkgewogICAgICAgICAgICBpZiAodGhpcy5fekluZGljZXNVcFRvRGF0ZSkgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl9pbnN0YW5jZXMuc29ydChTb3J0QnlJbnN0WkVsZXZhdGlvbik7CiAgICAgICAgICAgIGlmICh0aGlzLlVzZXNSZW5kZXJDZWxscygpKQogICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IHRoaXMuX2luc3RhbmNlcy5sZW5ndGg7IGkgPCBsZW47ICsraSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHdpID0gdGhpcy5faW5zdGFuY2VzW2ldLkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICAgICAgICAgIHdpLl9TZXRaSW5kZXgoaSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVuZGVyR3JpZC5NYXJrUmFuZ2VDaGFuZ2VkKHdpLkdldFJlbmRlckNlbGxSYW5nZSgpKQogICAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IHRoaXMuX2luc3RhbmNlcy5sZW5ndGg7IGkgPCBsZW47ICsraSkgdGhpcy5faW5zdGFuY2VzW2ldLkdldFdvcmxkSW5mbygpLl9TZXRaSW5kZXgoaSk7CiAgICAgICAgICAgIHRoaXMuX3pJbmRpY2VzVXBUb0RhdGUgPSB0cnVlCiAgICAgICAgfQogICAgICAgIE1vdmVJbnN0YW5jZUFkamFjZW50KGluc3QsIG90aGVyLCBpc0FmdGVyKSB7CiAgICAgICAgICAgIGNvbnN0IGluc3RXaSA9IGluc3QuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgIGNvbnN0IG90aGVyV2kgPQogICAgICAgICAgICAgICAgb3RoZXIuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgIGlmIChpbnN0V2kuR2V0TGF5ZXIoKSAhPT0gdGhpcyB8fCBvdGhlcldpLkdldExheWVyKCkgIT09IHRoaXMpIHRocm93IG5ldyBFcnJvcigiY2FuJ3QgYXJyYW5nZSBaIG9yZGVyIHVubGVzcyBib3RoIG9iamVjdHMgb24gdGhpcyBsYXllciIpOwogICAgICAgICAgICBjb25zdCBteVogPSBpbnN0V2kuR2V0WkluZGV4KCk7CiAgICAgICAgICAgIGxldCBpbnNlcnRaID0gb3RoZXJXaS5HZXRaSW5kZXgoKTsKICAgICAgICAgICAgaWYgKG15WiA9PT0gaW5zZXJ0WiArIChpc0FmdGVyID8gMSA6IC0xKSkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBDMy5hcnJheVJlbW92ZSh0aGlzLl9pbnN0YW5jZXMsIG15Wik7CiAgICAgICAgICAgIGlmIChteVogPCBpbnNlcnRaKSBpbnNlcnRaLS07CiAgICAgICAgICAgIGlmIChpc0FmdGVyKSBpbnNlcnRaKys7CiAgICAgICAgICAgIGlmIChpbnNlcnRaID09PSB0aGlzLl9pbnN0YW5jZXMubGVuZ3RoKSB0aGlzLl9pbnN0YW5jZXMucHVzaChpbnN0KTsKICAgICAgICAgICAgZWxzZSB0aGlzLl9pbnN0YW5jZXMuc3BsaWNlKGluc2VydFosIDAsIGluc3QpOwogICAgICAgICAgICB0aGlzLlNldFpJbmRpY2VzQ2hhbmdlZCgpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgIH0KICAgICAgICBfTWVyZ2VTb3J0ZWRaQXJyYXlzKGEsCiAgICAgICAgICAgIGIpIHsKICAgICAgICAgICAgY29uc3QgcmV0ID0gW107CiAgICAgICAgICAgIGxldCBpID0gMCwKICAgICAgICAgICAgICAgIGogPSAwLAogICAgICAgICAgICAgICAgbGVuYSA9IGEubGVuZ3RoLAogICAgICAgICAgICAgICAgbGVuYiA9IGIubGVuZ3RoOwogICAgICAgICAgICB3aGlsZSAoaSA8IGxlbmEgJiYgaiA8IGxlbmIpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGFpID0gYVtpXTsKICAgICAgICAgICAgICAgIGNvbnN0IGJqID0gYltqXTsKICAgICAgICAgICAgICAgIGlmIChhaS5HZXRXb3JsZEluZm8oKS5fR2V0TGFzdENhY2hlZFpJbmRleCgpIDwgYmouR2V0V29ybGRJbmZvKCkuX0dldExhc3RDYWNoZWRaSW5kZXgoKSkgewogICAgICAgICAgICAgICAgICAgIHJldC5wdXNoKGFpKTsKICAgICAgICAgICAgICAgICAgICArK2kKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmV0LnB1c2goYmopOwogICAgICAgICAgICAgICAgICAgICsragogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciAoOyBpIDwgbGVuYTsgKytpKSByZXQucHVzaChhW2ldKTsKICAgICAgICAgICAgZm9yICg7IGogPCBsZW5iOyArK2opIHJldC5wdXNoKGJbal0pOwogICAgICAgICAgICByZXR1cm4gcmV0CiAgICAgICAgfQogICAgICAgIF9NZXJnZUFsbFNvcnRlZFpBcnJheXNfcGFzcyhhcnIpIHsKICAgICAgICAgICAgY29uc3QgcmV0ID0gW107CiAgICAgICAgICAgIGNvbnN0IGxlbiA9IGFyci5sZW5ndGg7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuIC0gMTsgaSArPSAyKSB7CiAgICAgICAgICAgICAgICBjb25zdCBhcnIxID0gYXJyW2ldOwogICAgICAgICAgICAgICAgY29uc3QgYXJyMiA9IGFycltpICsgMV07CiAgICAgICAgICAgICAgICByZXQucHVzaCh0aGlzLl9NZXJnZVNvcnRlZFpBcnJheXMoYXJyMSwgYXJyMikpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGxlbiAlIDIgPT09IDEpIHJldC5wdXNoKGFycltsZW4gLQogICAgICAgICAgICAgICAgMV0pOwogICAgICAgICAgICByZXR1cm4gcmV0CiAgICAgICAgfQogICAgICAgIF9NZXJnZUFsbFNvcnRlZFpBcnJheXMoYXJyKSB7CiAgICAgICAgICAgIHdoaWxlIChhcnIubGVuZ3RoID4gMSkgYXJyID0gdGhpcy5fTWVyZ2VBbGxTb3J0ZWRaQXJyYXlzX3Bhc3MoYXJyKTsKICAgICAgICAgICAgcmV0dXJuIGFyclswXQogICAgICAgIH0KICAgICAgICBfR2V0UmVuZGVyQ2VsbEluc3RhbmNlc1RvRHJhdygpIHsKICAgICAgICAgICAgdGhpcy5fVXBkYXRlWkluZGljZXMoKTsKICAgICAgICAgICAgQzMuY2xlYXJBcnJheShyZW5kZXJDZWxsQXJyKTsKICAgICAgICAgICAgdGhpcy5fcmVuZGVyR3JpZC5RdWVyeVJhbmdlKHRoaXMuR2V0Vmlld3BvcnQoKSwgcmVuZGVyQ2VsbEFycik7CiAgICAgICAgICAgIGlmICghcmVuZGVyQ2VsbEFyci5sZW5ndGgpIHJldHVybiBbXTsKICAgICAgICAgICAgaWYgKHJlbmRlckNlbGxBcnIubGVuZ3RoID09PSAxKSByZXR1cm4gcmVuZGVyQ2VsbEFyclswXTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX01lcmdlQWxsU29ydGVkWkFycmF5cyhyZW5kZXJDZWxsQXJyKQogICAgICAgIH0KICAgICAgICBTaG91bGREcmF3KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5Jc1Zpc2libGUoKSAmJiB0aGlzLkdldE9wYWNpdHkoKSA+IDAgJiYgdGhpcy5fRHJhd3NBbnlDb250ZW50SW5TZWxmT3JTdWJMYXllcnMoKQogICAgICAgIH0KICAgICAgICBfRHJhd3NBbnlDb250ZW50SW5TZWxmT3JTdWJMYXllcnMoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLkhhc0luc3RhbmNlcygpIHx8CiAgICAgICAgICAgICAgICAhdGhpcy5Jc1RyYW5zcGFyZW50KCkpIHJldHVybiB0cnVlOwogICAgICAgICAgICBmb3IgKGNvbnN0IHN1YkxheWVyIG9mIHRoaXMuX3N1YkxheWVycykKICAgICAgICAgICAgICAgIGlmIChzdWJMYXllci5fRHJhd3NBbnlDb250ZW50SW5TZWxmT3JTdWJMYXllcnMoKSkgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIHJldHVybiBmYWxzZQogICAgICAgIH0KICAgICAgICBVc2VzT3duVGV4dHVyZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuSXNGb3JjZU93blRleHR1cmUoKSB8fCAhdGhpcy5IYXNEZWZhdWx0Q29sb3IoKSB8fCB0aGlzLkdldEJsZW5kTW9kZSgpICE9PSAwIHx8IHRoaXMuX2VmZmVjdExpc3QuSGFzQW55QWN0aXZlRWZmZWN0KCkKICAgICAgICB9CiAgICAgICAgU2VsZk9yQW55U3ViTGF5ZXJVc2VzT3duVGV4dHVyZSgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuVXNlc093blRleHR1cmUoKSkgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIGZvciAoY29uc3Qgc3ViTGF5ZXIgb2YgdGhpcy5fc3ViTGF5ZXJzKQogICAgICAgICAgICAgICAgaWYgKHN1YkxheWVyLlNlbGZPckFueVN1YkxheWVyVXNlc093blRleHR1cmUoKSkgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIHJldHVybiBmYWxzZQogICAgICAgIH0KICAgICAgICBHZXRSZW5kZXJUYXJnZXQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9jdXJSZW5kZXJUYXJnZXQKICAgICAgICB9CiAgICAgICAgR2V0MkRTY2FsZUZhY3RvclRvWih6KSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9sYXlvdXQuSXNPcnRob2dyYXBoaWNQcm9qZWN0aW9uKCkpIHJldHVybiAxOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbnN0IGNhbVogPSB0aGlzLkdldENhbWVyYVooKTsKICAgICAgICAgICAgICAgIHJldHVybiBjYW1aIC8gKGNhbVogLSB6KQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIEdldENhbWVyYVoodmlld0gpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuR2V0RGVmYXVsdENhbWVyYVoodmlld0gpIC8gdGhpcy5HZXROb3JtYWxTY2FsZSgpCiAgICAgICAgfQogICAgICAgIF9TZXRNVk1hdHJpeENoYW5nZWQoKSB7CiAgICAgICAgICAgIHRoaXMuX2lzTVZNYXRyaXhDaGFuZ2VkID0gdHJ1ZTsKICAgICAgICAgICAgdGhpcy5faXNWaWV3RnJ1c3R1bUNoYW5nZWQgPSB0cnVlOwogICAgICAgICAgICB0aGlzLl9pc1ZpZXdwb3J0Q2hhbmdlZCA9IHRydWUKICAgICAgICB9CiAgICAgICAgX0dldE1vZGVsVmlld01hdHJpeChyZW5kZXJlcikgewogICAgICAgICAgICBpZiAodGhpcy5faXNNVk1hdHJpeENoYW5nZWQpIHsKICAgICAgICAgICAgICAgIHRoaXMuX0NhbGN1bGF0ZU1vZGVsVmlld01hdHJpeChyZW5kZXJlciwgdGhpcy5fbW9kZWxWaWV3TWF0cml4LCAwLCAwLCBudWxsKTsKICAgICAgICAgICAgICAgIHRoaXMuX2lzTVZNYXRyaXhDaGFuZ2VkID0gZmFsc2UKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdGhpcy5fbW9kZWxWaWV3TWF0cml4CiAgICAgICAgfQogICAgICAgIEdldENhbWVyYVBvc2l0aW9uKCkgewogICAgICAgICAgICBpZiAodGhpcy5IYXMzRENhbWVyYSgpKSB7CiAgICAgICAgICAgICAgICBjb25zdCBjYW1Qb3MgPSB0aGlzLkdldExheW91dCgpLkdldDNEQ2FtZXJhUG9zaXRpb24oKTsKICAgICAgICAgICAgICAgIHJldHVybiBbY2FtUG9zWzBdLCBjYW1Qb3NbMV0sIGNhbVBvc1syXV0KICAgICAgICAgICAgfSBlbHNlIHJldHVybiB0aGlzLl9HZXQyRENhbWVyYVBvc2l0aW9uKCkKICAgICAgICB9CiAgICAgICAgX0dldDJEQ2FtZXJhUG9zaXRpb24ob2ZmWCA9IDAsIG9mZlkgPSAwLCB2aWV3SCA9IDApIHsKICAgICAgICAgICAgY29uc3QgcnVudGltZSA9IHRoaXMuX3J1bnRpbWU7CiAgICAgICAgICAgIGNvbnN0IGxheW91dCA9IHRoaXMuR2V0TGF5b3V0KCk7CiAgICAgICAgICAgIGNvbnN0IHBhcmFsbGF4T3JpZ2luWCA9IHJ1bnRpbWUuR2V0UGFyYWxsYXhYT3JpZ2luKCk7CiAgICAgICAgICAgIGNvbnN0IHBhcmFsbGF4T3JpZ2luWSA9IHJ1bnRpbWUuR2V0UGFyYWxsYXhZT3JpZ2luKCk7CiAgICAgICAgICAgIGxldCBzY3JvbGxPcmlnaW5YID0gKHRoaXMuR2V0U2Nyb2xsWCgpIC0gcGFyYWxsYXhPcmlnaW5YKSAqIHRoaXMuX3BhcmFsbGF4WCArIHBhcmFsbGF4T3JpZ2luWDsKICAgICAgICAgICAgbGV0IHNjcm9sbE9yaWdpblkgPSAodGhpcy5HZXRTY3JvbGxZKCkgLSBwYXJhbGxheE9yaWdpblkpICogdGhpcy5fcGFyYWxsYXhZICsgcGFyYWxsYXhPcmlnaW5ZOwogICAgICAgICAgICBpZiAocnVudGltZS5Jc1BpeGVsUm91bmRpbmdFbmFibGVkKCkpIHsKICAgICAgICAgICAgICAgIHNjcm9sbE9yaWdpblggPQogICAgICAgICAgICAgICAgICAgIE1hdGgucm91bmQoc2Nyb2xsT3JpZ2luWCk7CiAgICAgICAgICAgICAgICBzY3JvbGxPcmlnaW5ZID0gTWF0aC5yb3VuZChzY3JvbGxPcmlnaW5ZKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGxldCBjYW1YID0gc2Nyb2xsT3JpZ2luWCArIG9mZlg7CiAgICAgICAgICAgIGxldCBjYW1ZID0gc2Nyb2xsT3JpZ2luWSArIG9mZlk7CiAgICAgICAgICAgIGNvbnN0IGNhbVogPSBsYXlvdXQuSXNPcnRob2dyYXBoaWNQcm9qZWN0aW9uKCkgPyB0aGlzLkdldERlZmF1bHRDYW1lcmFaKHZpZXdIKSA6IHRoaXMuR2V0Q2FtZXJhWih2aWV3SCk7CiAgICAgICAgICAgIGNvbnN0IFt2cFgsIHZwWV0gPSB0aGlzLl9HZXRWYW5pc2hpbmdQb2ludCgpOwogICAgICAgICAgICBpZiAodnBYICE9PSAuNSB8fCB2cFkgIT09IC41KSB7CiAgICAgICAgICAgICAgICBjb25zdCB6ZiA9IHRoaXMuR2V0RGVmYXVsdENhbWVyYVoodmlld0gpIC8gY2FtWjsKICAgICAgICAgICAgICAgIGxldCBjYW1PZmZYID0gKHZwWCAtIC41KSAqIHJ1bnRpbWUuR2V0Vmlld3BvcnRXaWR0aCgpIC8gemY7CiAgICAgICAgICAgICAgICBsZXQgY2FtT2ZmWSA9ICh2cFkgLSAuNSkgKiBydW50aW1lLkdldFZpZXdwb3J0SGVpZ2h0KCkgLyB6ZjsKICAgICAgICAgICAgICAgIGNvbnN0IGEgPSB0aGlzLkdldEFuZ2xlKCk7CiAgICAgICAgICAgICAgICBpZiAoYSAhPT0gMCkgewogICAgICAgICAgICAgICAgICAgIHRlbXBWZWMyLnNldChjYW1PZmZYLCBjYW1PZmZZKTsKICAgICAgICAgICAgICAgICAgICB0ZW1wVmVjMi5yb3RhdGUoYSk7CiAgICAgICAgICAgICAgICAgICAgY2FtT2ZmWCA9IHRlbXBWZWMyLmdldFgoKTsKICAgICAgICAgICAgICAgICAgICBjYW1PZmZZID0gdGVtcFZlYzIuZ2V0WSgpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjYW1YICs9IGNhbU9mZlg7CiAgICAgICAgICAgICAgICBjYW1ZICs9IGNhbU9mZlkKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gW2NhbVgsIGNhbVksIGNhbVpdCiAgICAgICAgfQogICAgICAgIF9DYWxjdWxhdGVNb2RlbFZpZXdNYXRyaXgocmVuZGVyZXIsIG91dE1hdCwgb2ZmWCwgb2ZmWSwgdmlld0gpIHsKICAgICAgICAgICAgY29uc3QgcnVudGltZSA9IHRoaXMuX3J1bnRpbWU7CiAgICAgICAgICAgIGNvbnN0IGxheW91dCA9IHRoaXMuR2V0TGF5b3V0KCk7CiAgICAgICAgICAgIGlmICh0aGlzLkhhczNEQ2FtZXJhKCkpIHsKICAgICAgICAgICAgICAgIHZlYzMuY29weShjYW1WZWN0b3IsIGxheW91dC5HZXQzRENhbWVyYVBvc2l0aW9uKCkpOwogICAgICAgICAgICAgICAgdmVjMy5jb3B5KGxvb2tWZWN0b3IsIGxheW91dC5HZXQzRENhbWVyYUxvb2tBdCgpKTsKICAgICAgICAgICAgICAgIHZlYzMuY29weSh1cFZlY3RvciwgbGF5b3V0LkdldDNEQ2FtZXJhVXBWZWN0b3IoKSk7CiAgICAgICAgICAgICAgICBjb25zdCBwYXJhbGxheE9yaWdpblggPSBydW50aW1lLkdldFBhcmFsbGF4WE9yaWdpbigpOwogICAgICAgICAgICAgICAgY29uc3QgcGFyYWxsYXhPcmlnaW5ZID0gcnVudGltZS5HZXRQYXJhbGxheFlPcmlnaW4oKTsKICAgICAgICAgICAgICAgIGNvbnN0IGxvb2tEeCA9CiAgICAgICAgICAgICAgICAgICAgbG9va1ZlY3RvclswXSAtIGNhbVZlY3RvclswXTsKICAgICAgICAgICAgICAgIGNvbnN0IGxvb2tEeSA9IGxvb2tWZWN0b3JbMV0gLSBjYW1WZWN0b3JbMV07CiAgICAgICAgICAgICAgICBjb25zdCBsb29rRHogPSBsb29rVmVjdG9yWzJdIC0gY2FtVmVjdG9yWzJdOwogICAgICAgICAgICAgICAgY2FtVmVjdG9yWzBdID0gKGNhbVZlY3RvclswXSAtIHBhcmFsbGF4T3JpZ2luWCkgKiB0aGlzLl9wYXJhbGxheFggKyBwYXJhbGxheE9yaWdpblg7CiAgICAgICAgICAgICAgICBjYW1WZWN0b3JbMV0gPSAoY2FtVmVjdG9yWzFdIC0gcGFyYWxsYXhPcmlnaW5ZKSAqIHRoaXMuX3BhcmFsbGF4WSArIHBhcmFsbGF4T3JpZ2luWTsKICAgICAgICAgICAgICAgIGNhbVZlY3RvclsyXSAqPSBNYXRoLm1heCh0aGlzLl9wYXJhbGxheFgsIHRoaXMuX3BhcmFsbGF4WSk7CiAgICAgICAgICAgICAgICBsb29rVmVjdG9yWzBdID0gY2FtVmVjdG9yWzBdICsgbG9va0R4OwogICAgICAgICAgICAgICAgbG9va1ZlY3RvclsxXSA9IGNhbVZlY3RvclsxXSArIGxvb2tEeTsKICAgICAgICAgICAgICAgIGxvb2tWZWN0b3JbMl0gPSBjYW1WZWN0b3JbMl0gKyBsb29rRHoKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbnN0IFtjYW1YLCBjYW1ZLCBjYW1aXSA9IHRoaXMuX0dldDJEQ2FtZXJhUG9zaXRpb24ob2ZmWCwgb2ZmWSwgdmlld0gpOwogICAgICAgICAgICAgICAgdmVjMy5zZXQoY2FtVmVjdG9yLAogICAgICAgICAgICAgICAgICAgIGNhbVgsIGNhbVksIGNhbVopOwogICAgICAgICAgICAgICAgdmVjMy5zZXQobG9va1ZlY3RvciwgY2FtWCwgY2FtWSwgY2FtWiAtIDEwMCk7CiAgICAgICAgICAgICAgICBjb25zdCBhID0gdGhpcy5HZXRBbmdsZSgpOwogICAgICAgICAgICAgICAgaWYgKGEgPT09IDApIHZlYzMuc2V0KHVwVmVjdG9yLCAwLCAxLCAwKTsKICAgICAgICAgICAgICAgIGVsc2UgdmVjMy5zZXQodXBWZWN0b3IsIE1hdGguc2luKGEpLCBNYXRoLmNvcyhhKSwgMCkKICAgICAgICAgICAgfQogICAgICAgICAgICByZW5kZXJlci5DYWxjdWxhdGVMb29rQXRNb2RlbFZpZXcob3V0TWF0LCBjYW1WZWN0b3IsIGxvb2tWZWN0b3IsIHVwVmVjdG9yLCB2aWV3SCB8fCBydW50aW1lLkdldFZpZXdwb3J0SGVpZ2h0KCkpCiAgICAgICAgfQogICAgICAgIF9TZXRQcm9qZWN0aW9uTWF0cml4Q2hhbmdlZCgpIHsKICAgICAgICAgICAgdGhpcy5faXNQcm9qZWN0aW9uTWF0cml4Q2hhbmdlZCA9IHRydWU7CiAgICAgICAgICAgIHRoaXMuX2lzVmlld0ZydXN0dW1DaGFuZ2VkID0gdHJ1ZTsKICAgICAgICAgICAgdGhpcy5faXNWaWV3cG9ydENoYW5nZWQgPSB0cnVlCiAgICAgICAgfQogICAgICAgIF9HZXRQcm9qZWN0aW9uTWF0cml4KHJlbmRlcmVyKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9pc1Byb2plY3Rpb25NYXRyaXhDaGFuZ2VkKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9DYWxjdWxhdGVQcm9qZWN0aW9uTWF0cml4KHJlbmRlcmVyKTsKICAgICAgICAgICAgICAgIHRoaXMuX2lzUHJvamVjdGlvbk1hdHJpeENoYW5nZWQgPSBmYWxzZQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9wcm9qZWN0aW9uTWF0cml4CiAgICAgICAgfQogICAgICAgIF9DYWxjdWxhdGVQcm9qZWN0aW9uTWF0cml4KHJlbmRlcmVyKSB7CiAgICAgICAgICAgIGNvbnN0IGNhbnZhc01hbmFnZXIgPSB0aGlzLl9ydW50aW1lLkdldENhbnZhc01hbmFnZXIoKTsKICAgICAgICAgICAgY29uc3QgW3ZwWCwgdnBZXSA9IHRoaXMuX0dldFZhbmlzaGluZ1BvaW50KCk7CiAgICAgICAgICAgIGlmICh0aGlzLl9sYXlvdXQuSXNPcnRob2dyYXBoaWNQcm9qZWN0aW9uKCkpIHJlbmRlcmVyLkNhbGN1bGF0ZU9ydGhvZ3JhcGhpY01hdHJpeCh0aGlzLl9wcm9qZWN0aW9uTWF0cml4LCBjYW52YXNNYW5hZ2VyLkdldERyYXdXaWR0aCgpLCBjYW52YXNNYW5hZ2VyLkdldERyYXdIZWlnaHQoKSk7CiAgICAgICAgICAgIGVsc2UgaWYgKHZwWCA9PT0gLjUgJiYgdnBZID09PSAuNSkgbWF0NC5jb3B5KHRoaXMuX3Byb2plY3Rpb25NYXRyaXgsIGNhbnZhc01hbmFnZXIuR2V0RGVmYXVsdFByb2plY3Rpb25NYXRyaXgoKSk7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgY29uc3QgZHJhd1cgPSBjYW52YXNNYW5hZ2VyLkdldERyYXdXaWR0aCgpOwogICAgICAgICAgICAgICAgY29uc3QgZHJhd0ggPSBjYW52YXNNYW5hZ2VyLkdldERyYXdIZWlnaHQoKTsKICAgICAgICAgICAgICAgIHJlbmRlcmVyLkNhbGN1bGF0ZVBlcnNwZWN0aXZlTWF0cml4KHRoaXMuX3Byb2plY3Rpb25NYXRyaXgsIGRyYXdXIC8gZHJhd0gsIHZwWCwgdnBZKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIF9TZXRUcmFuc2Zvcm0ocmVuZGVyZXIsIHVwZGF0ZVByb2plY3Rpb24gPSB0cnVlLCBvZmZYID0gMCwgb2ZmWSA9IDAsIHZpZXdIID0gMCkgewogICAgICAgICAgICBpZiAodXBkYXRlUHJvamVjdGlvbikgcmVuZGVyZXIuU2V0UHJvamVjdGlvbk1hdHJpeCh0aGlzLl9HZXRQcm9qZWN0aW9uTWF0cml4KHJlbmRlcmVyKSk7CiAgICAgICAgICAgIGxldCBtb2RlbFZpZXdNYXRyaXggPSBudWxsOwogICAgICAgICAgICBpZiAob2ZmWCA9PT0gMCAmJiBvZmZZID09PSAwICYmIHZpZXdIID09PSAwKSBtb2RlbFZpZXdNYXRyaXggPSB0aGlzLl9HZXRNb2RlbFZpZXdNYXRyaXgocmVuZGVyZXIpOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuX0NhbGN1bGF0ZU1vZGVsVmlld01hdHJpeChyZW5kZXJlciwgdGVtcE1hdDQsIG9mZlgsIG9mZlksIHZpZXdIKTsKICAgICAgICAgICAgICAgIG1vZGVsVmlld01hdHJpeCA9IHRlbXBNYXQ0CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmVuZGVyZXIuU2V0TW9kZWxWaWV3TWF0cml4KG1vZGVsVmlld01hdHJpeCkKICAgICAgICB9CiAgICAgICAgUHJlcGFyZUZvckRyYXcocmVuZGVyZXIpIHsKICAgICAgICAgICAgdGhpcy5fU2V0VHJhbnNmb3JtKHJlbmRlcmVyKTsKICAgICAgICAgICAgcmVuZGVyZXIuU2V0QmFzZVoodGhpcy5HZXRaRWxldmF0aW9uKCkpCiAgICAgICAgfQogICAgICAgIERyYXcocmVuZGVyZXIsIGRlc3RpbmF0aW9uUmVuZGVyVGFyZ2V0LCBpc0ZpcnN0VG9UYXJnZXQpIHsKICAgICAgICAgICAgY29uc3QgY2FudmFzTWFuYWdlciA9IHRoaXMuX3J1bnRpbWUuR2V0Q2FudmFzTWFuYWdlcigpOwogICAgICAgICAgICBjb25zdCB1c2VPd25UZXh0dXJlID0gdGhpcy5Vc2VzT3duVGV4dHVyZSgpOwogICAgICAgICAgICBsZXQgb3duUmVuZGVyVGFyZ2V0ID0gbnVsbDsKICAgICAgICAgICAgbGV0IGxheWVyUXVlcnkgPSBudWxsOwogICAgICAgICAgICBpZiAodGhpcy5fcnVudGltZS5Jc0dQVVByb2ZpbGluZygpKQogICAgICAgICAgICAgICAgaWYgKHJlbmRlcmVyLklzV2ViR0woKSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHRpbWluZ3NCdWZmZXIgPSBjYW52YXNNYW5hZ2VyLkdldExheWVyVGltaW5nc0J1ZmZlcih0aGlzKTsKICAgICAgICAgICAgICAgICAgICBpZiAodGltaW5nc0J1ZmZlcikgewogICAgICAgICAgICAgICAgICAgICAgICBsYXllclF1ZXJ5ID0gdGltaW5nc0J1ZmZlci5BZGRUaW1lRWxhcHNlZFF1ZXJ5KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlbmRlcmVyLlN0YXJ0UXVlcnkobGF5ZXJRdWVyeSkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlbmRlcmVyLklzV2ViR1BVKCkpIHJlbmRlcmVyLldyaXRlVGltZXN0YW1wKCh0aGlzLkdldEluZGV4KCkgKwogICAgICAgICAgICAgICAgMSkgKiAyKTsKICAgICAgICAgICAgaWYgKHVzZU93blRleHR1cmUpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHJ0T3B0cyA9IHsKICAgICAgICAgICAgICAgICAgICBzYW1wbGluZzogdGhpcy5fcnVudGltZS5HZXRTYW1wbGluZygpLAogICAgICAgICAgICAgICAgICAgIGlzU2FtcGxlZDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBjYW5SZWFkUGl4ZWxzOiByZW5kZXJlci5Jc1dlYkdQVSgpID8gdGhpcy5fcnVudGltZS5Vc2VzQW55QmFja2dyb3VuZEJsZW5kaW5nKCkgOiBmYWxzZQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIGlmIChjYW52YXNNYW5hZ2VyLkdldEN1cnJlbnRGdWxsc2NyZWVuU2NhbGluZ1F1YWxpdHkoKSA9PT0gImxvdyIpIHsKICAgICAgICAgICAgICAgICAgICBydE9wdHMud2lkdGggPSBjYW52YXNNYW5hZ2VyLkdldERyYXdXaWR0aCgpOwogICAgICAgICAgICAgICAgICAgIHJ0T3B0cy5oZWlnaHQgPSBjYW52YXNNYW5hZ2VyLkdldERyYXdIZWlnaHQoKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgb3duUmVuZGVyVGFyZ2V0ID0gdGhpcy5fcnVudGltZS5HZXRBZGRpdGlvbmFsUmVuZGVyVGFyZ2V0KHJ0T3B0cyk7CiAgICAgICAgICAgICAgICB0aGlzLl9jdXJSZW5kZXJUYXJnZXQgPSBvd25SZW5kZXJUYXJnZXQ7CiAgICAgICAgICAgICAgICByZW5kZXJlci5TZXRSZW5kZXJUYXJnZXQob3duUmVuZGVyVGFyZ2V0KTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLklzVHJhbnNwYXJlbnQoKSkgcmVuZGVyZXIuQ2xlYXJSZ2JhKDAsCiAgICAgICAgICAgICAgICAgICAgMCwgMCwgMCkKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuX2N1clJlbmRlclRhcmdldCA9IGRlc3RpbmF0aW9uUmVuZGVyVGFyZ2V0OwogICAgICAgICAgICAgICAgcmVuZGVyZXIuU2V0UmVuZGVyVGFyZ2V0KGRlc3RpbmF0aW9uUmVuZGVyVGFyZ2V0KQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghdGhpcy5Jc1RyYW5zcGFyZW50KCkpIHJlbmRlcmVyLkNsZWFyKHRoaXMuX2JhY2tncm91bmRDb2xvcik7CiAgICAgICAgICAgIHRoaXMuX2xheW91dC5fRHJhd0xheWVyTGlzdChyZW5kZXJlciwgdGhpcy5fY3VyUmVuZGVyVGFyZ2V0LCB0aGlzLl9zdWJMYXllcnMsIHVzZU93blRleHR1cmUgJiYgdGhpcy5Jc1RyYW5zcGFyZW50KCkpOwogICAgICAgICAgICB0aGlzLl9TZXRUcmFuc2Zvcm0ocmVuZGVyZXIpOwogICAgICAgICAgICByZW5kZXJlci5TZXRCYXNlWih0aGlzLkdldFpFbGV2YXRpb24oKSk7CiAgICAgICAgICAgIHJlbmRlcmVyLlNldERlcHRoRW5hYmxlZCh0aGlzLlJlbmRlcnNJbjNETW9kZSgpKTsKICAgICAgICAgICAgaWYgKHRoaXMuR2V0Tm9ybWFsU2NhbGUoKSA+IE51bWJlci5FUFNJTE9OKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9VcGRhdGVaSW5kaWNlcygpOwogICAgICAgICAgICAgICAgY29uc3QgdXNlUmVuZGVyQ2VsbHMgPSB0aGlzLlVzZXNSZW5kZXJDZWxscygpICYmCiAgICAgICAgICAgICAgICAgICAgdGhpcy5HZXRaRWxldmF0aW9uKCkgPT09IDAgJiYgIXRoaXMuX2FueUluc3RhbmNlWkVsZXZhdGVkOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuSGFzM0RDYW1lcmEoKSkgdGhpcy5fRHJhd0luc3RhbmNlc18zRENhbWVyYShyZW5kZXJlcik7CiAgICAgICAgICAgICAgICBlbHNlIGlmICh1c2VSZW5kZXJDZWxscykgdGhpcy5fRHJhd0luc3RhbmNlc19SZW5kZXJDZWxscyhyZW5kZXJlcik7CiAgICAgICAgICAgICAgICBlbHNlIHRoaXMuX0RyYXdJbnN0YW5jZXMocmVuZGVyZXIsIHRoaXMuX0dldEluc3RhbmNlc0luRHJhd09yZGVyKCkpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmVuZGVyZXIuU2V0QmFzZVooMCk7CiAgICAgICAgICAgIHJlbmRlcmVyLlNldEN1cnJlbnRaKDApOwogICAgICAgICAgICBpZiAodXNlT3duVGV4dHVyZSkgewogICAgICAgICAgICAgICAgcmVuZGVyZXIuU2V0RGVwdGhFbmFibGVkKGZhbHNlKTsKICAgICAgICAgICAgICAgIHRoaXMuX0RyYXdMYXllck93blRleHR1cmVUb1JlbmRlclRhcmdldChyZW5kZXJlciwgb3duUmVuZGVyVGFyZ2V0LCBkZXN0aW5hdGlvblJlbmRlclRhcmdldCwgaXNGaXJzdFRvVGFyZ2V0KQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChsYXllclF1ZXJ5KSByZW5kZXJlci5FbmRRdWVyeShsYXllclF1ZXJ5KTsKICAgICAgICAgICAgaWYgKHRoaXMuX3J1bnRpbWUuSXNHUFVQcm9maWxpbmcoKSAmJgogICAgICAgICAgICAgICAgcmVuZGVyZXIuSXNXZWJHUFUoKSkgcmVuZGVyZXIuV3JpdGVUaW1lc3RhbXAoKHRoaXMuR2V0SW5kZXgoKSArIDEpICogMiArIDEpOwogICAgICAgICAgICB0aGlzLl9jdXJSZW5kZXJUYXJnZXQgPSBudWxsCiAgICAgICAgfQogICAgICAgIF9EcmF3SW5zdGFuY2VzKHJlbmRlcmVyLCBpbnN0YW5jZXMpIHsKICAgICAgICAgICAgY29uc3Qgdmlld3BvcnQgPSB0aGlzLkdldFZpZXdwb3J0KCk7CiAgICAgICAgICAgIGNvbnN0IHJlbmRlclRhcmdldCA9IHRoaXMuX2N1clJlbmRlclRhcmdldDsKICAgICAgICAgICAgY29uc3QgaXNPcnRob2dyYXBoaWMgPSB0aGlzLkdldExheW91dCgpLklzT3J0aG9ncmFwaGljUHJvamVjdGlvbigpOwogICAgICAgICAgICBjb25zdCBoYXNWYW5pc2hpbmdQb2ludE91dHNpZGVWaWV3cG9ydCA9IHRoaXMuR2V0TGF5b3V0KCkuSGFzVmFuaXNoaW5nUG9pbnRPdXRzaWRlVmlld3BvcnQoKTsKICAgICAgICAgICAgbGV0IGxhc3RJbnN0ID0gbnVsbDsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IGluc3RhbmNlcy5sZW5ndGg7IGkgPCBsZW47ICsraSkgewogICAgICAgICAgICAgICAgY29uc3QgaW5zdCA9IGluc3RhbmNlc1tpXTsKICAgICAgICAgICAgICAgIGlmIChpbnN0ID09PSBsYXN0SW5zdCkgY29udGludWU7CiAgICAgICAgICAgICAgICBsYXN0SW5zdCA9IGluc3Q7CiAgICAgICAgICAgICAgICBjb25zdCB3aSA9IGluc3QuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgICAgICBpZiAod2kuSXNWaXNpYmxlKCkgJiYgd2kuSXNJblZpZXdwb3J0KHZpZXdwb3J0LCBoYXNWYW5pc2hpbmdQb2ludE91dHNpZGVWaWV3cG9ydCwgaXNPcnRob2dyYXBoaWMpKSB0aGlzLl9EcmF3SW5zdGFuY2VNYXliZVdpdGhFZmZlY3RzKGluc3QsIHdpLCByZW5kZXJlciwgcmVuZGVyVGFyZ2V0KQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIF9EcmF3SW5zdGFuY2VzXzNEQ2FtZXJhKHJlbmRlcmVyKSB7CiAgICAgICAgICAgIGNvbnN0IHJlbmRlclRhcmdldCA9IHRoaXMuX2N1clJlbmRlclRhcmdldDsKICAgICAgICAgICAgY29uc3Qgdmlld0ZydXN0dW0gPSB0aGlzLl9HZXRWaWV3RnJ1c3R1bSgpOwogICAgICAgICAgICBjb25zdCBjb3BsYW5hckluc3RhbmNlcyA9IHRlbXBJbnN0YW5jZUxpc3QxOwogICAgICAgICAgICBjb25zdCBwb3N0UmVuZGVySW5zdGFuY2VzID0gdGVtcEluc3RhbmNlTGlzdDI7CiAgICAgICAgICAgIGNvbnN0IGluc3RhbmNlcyA9IHRoaXMuX0dldEluc3RhbmNlc0luRHJhd09yZGVyKCk7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBpbnN0YW5jZXMubGVuZ3RoOyBpIDwgbGVuOykgewogICAgICAgICAgICAgICAgY29uc3QgaW5zdCA9IGluc3RhbmNlc1tpXTsKICAgICAgICAgICAgICAgIGNvbnN0IHdpID0gaW5zdC5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgICAgIGlmICghd2kuSXNWaXNpYmxlKCkgfHwgIXdpLklzSW5WaWV3cG9ydDNEKHZpZXdGcnVzdHVtKSkgewogICAgICAgICAgICAgICAgICAgICsraTsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKCFpbnN0LlJlbmRlcnNUb093blpQbGFuZSgpIHx8IHdpLkdldERlcHRoKCkgPiAwKSBwb3N0UmVuZGVySW5zdGFuY2VzLnB1c2goaW5zdCk7CiAgICAgICAgICAgICAgICBjb25zdCBzdGFydFogPSBpbnN0LkdldFdvcmxkSW5mbygpLkdldFRvdGFsWkVsZXZhdGlvbigpOwogICAgICAgICAgICAgICAgY29wbGFuYXJJbnN0YW5jZXMucHVzaChpbnN0KTsKICAgICAgICAgICAgICAgIGxldCBlbmRJbmRleCA9IGkgKyAxOwogICAgICAgICAgICAgICAgZm9yICg7IGVuZEluZGV4IDwgbGVuOyArK2VuZEluZGV4KSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgbmV4dEluc3QgPSBpbnN0YW5jZXNbZW5kSW5kZXhdOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IG5leHRXaSA9IG5leHRJbnN0LkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICAgICAgICAgIGlmICghbmV4dFdpLklzVmlzaWJsZSgpIHx8ICFuZXh0V2kuSXNJblZpZXdwb3J0M0Qodmlld0ZydXN0dW0pKSBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICBpZiAobmV4dFdpLkdldFRvdGFsWkVsZXZhdGlvbigpICE9PSBzdGFydFopIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGlmICghbmV4dEluc3QuUmVuZGVyc1RvT3duWlBsYW5lKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcG9zdFJlbmRlckluc3RhbmNlcy5wdXNoKG5leHRJbnN0KTsKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKG5leHRXaS5HZXREZXB0aCgpID4gMCkgcG9zdFJlbmRlckluc3RhbmNlcy5wdXNoKG5leHRJbnN0KTsKICAgICAgICAgICAgICAgICAgICBjb3BsYW5hckluc3RhbmNlcy5wdXNoKG5leHRJbnN0KQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGNvcGxhbmFySW5zdGFuY2VzLmxlbmd0aCA9PT0gMSAmJiAhY29wbGFuYXJJbnN0YW5jZXNbMF0uTXVzdE1pdGlnYXRlWkZpZ2h0aW5nKCkpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9EcmF3SW5zdGFuY2VNYXliZVdpdGhFZmZlY3RzKGluc3QsIHdpLCByZW5kZXJlciwgcmVuZGVyVGFyZ2V0KTsKICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBqID0gMCwgbGVuaiA9IHBvc3RSZW5kZXJJbnN0YW5jZXMubGVuZ3RoOyBqIDwgbGVuajsgKytqKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHBvc3RJbnN0ID0gcG9zdFJlbmRlckluc3RhbmNlc1tqXTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBvc3RJbnN0ID09PSBpbnN0KSBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcG9zdFdpID0gcG9zdEluc3QuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHBvc3RXaUxheWVyID0gcG9zdFdpLkdldExheWVyKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHBvc3RXaUxheWVyLl9EcmF3SW5zdGFuY2VNYXliZVdpdGhFZmZlY3RzKHBvc3RJbnN0LCBwb3N0V2ksIHJlbmRlcmVyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVuZGVyVGFyZ2V0KQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fRHJhd0NvcGxhbmFySW5zdGFuY2VzXzNEQ2FtZXJhKHJlbmRlcmVyLCBjb3BsYW5hckluc3RhbmNlcyk7CiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaiA9IDAsIGxlbmogPSBwb3N0UmVuZGVySW5zdGFuY2VzLmxlbmd0aDsgaiA8IGxlbmo7ICsraikgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwb3N0SW5zdCA9IHBvc3RSZW5kZXJJbnN0YW5jZXNbal07CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHBvc3RXaSA9IHBvc3RJbnN0LkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICAgICAgICAgICAgICBwb3N0V2kuX1NldERyYXdOb25CYWNrRmFjZXNPbmx5KHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9EcmF3SW5zdGFuY2VNYXliZVdpdGhFZmZlY3RzKHBvc3RJbnN0LCBwb3N0V2ksIHJlbmRlcmVyLCByZW5kZXJUYXJnZXQpOwogICAgICAgICAgICAgICAgICAgICAgICBwb3N0V2kuX1NldERyYXdOb25CYWNrRmFjZXNPbmx5KGZhbHNlKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGkgPSBlbmRJbmRleDsKICAgICAgICAgICAgICAgIEMzLmNsZWFyQXJyYXkoY29wbGFuYXJJbnN0YW5jZXMpOwogICAgICAgICAgICAgICAgQzMuY2xlYXJBcnJheShwb3N0UmVuZGVySW5zdGFuY2VzKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIF9EcmF3Q29wbGFuYXJJbnN0YW5jZXNfM0RDYW1lcmEocmVuZGVyZXIsIGluc3RhbmNlcykgewogICAgICAgICAgICBjb25zdCByZW5kZXJUYXJnZXQgPQogICAgICAgICAgICAgICAgdGhpcy5fY3VyUmVuZGVyVGFyZ2V0OwogICAgICAgICAgICByZW5kZXJlci5Db3BsYW5hclN0YXJ0U3RlbmNpbFBhc3MoKTsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IGluc3RhbmNlcy5sZW5ndGg7IGkgPCBsZW47ICsraSkgewogICAgICAgICAgICAgICAgY29uc3QgaW5zdCA9IGluc3RhbmNlc1tpXTsKICAgICAgICAgICAgICAgIGNvbnN0IHdpID0gaW5zdC5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgICAgIHdpLl9TZXREcmF3QmFja0ZhY2VPbmx5KHRydWUpOwogICAgICAgICAgICAgICAgdGhpcy5fRHJhd0luc3RhbmNlKGluc3QsIHdpLCByZW5kZXJlcikKICAgICAgICAgICAgfQogICAgICAgICAgICByZW5kZXJlci5Db3BsYW5hclN0YXJ0Q29sb3JQYXNzKCk7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBpbnN0YW5jZXMubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGluc3QgPSBpbnN0YW5jZXNbaV07CiAgICAgICAgICAgICAgICBjb25zdCB3aSA9IGluc3QuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9EcmF3SW5zdGFuY2VNYXliZVdpdGhFZmZlY3RzKGluc3QsIHdpLCByZW5kZXJlciwgcmVuZGVyVGFyZ2V0KTsKICAgICAgICAgICAgICAgIHdpLl9TZXREcmF3QmFja0ZhY2VPbmx5KGZhbHNlKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJlbmRlcmVyLkNvcGxhbmFyUmVzdG9yZVN0YW5kYXJkUmVuZGVyaW5nKCkKICAgICAgICB9CiAgICAgICAgX0RyYXdJbnN0YW5jZXNfUmVuZGVyQ2VsbHMocmVuZGVyZXIpIHsKICAgICAgICAgICAgY29uc3QgcmVuZGVyR3JpZCA9CiAgICAgICAgICAgICAgICB0aGlzLl9yZW5kZXJHcmlkOwogICAgICAgICAgICBjb25zdCBjdXJSZW5kZXJDZWxscyA9IHRoaXMuX2N1clJlbmRlckNlbGxzOwogICAgICAgICAgICBjb25zdCBsYXN0UmVuZGVyQ2VsbHMgPSB0aGlzLl9sYXN0UmVuZGVyQ2VsbHM7CiAgICAgICAgICAgIGNvbnN0IHZpZXdwb3J0ID0gdGhpcy5HZXRWaWV3cG9ydCgpOwogICAgICAgICAgICBsZXQgaW5zdGFuY2VzVG9EcmF3OwogICAgICAgICAgICBjdXJSZW5kZXJDZWxscy5zZXQocmVuZGVyR3JpZC5YVG9DZWxsKHZpZXdwb3J0LmdldExlZnQoKSksIHJlbmRlckdyaWQuWVRvQ2VsbCh2aWV3cG9ydC5nZXRUb3AoKSksIHJlbmRlckdyaWQuWFRvQ2VsbCh2aWV3cG9ydC5nZXRSaWdodCgpKSwgcmVuZGVyR3JpZC5ZVG9DZWxsKHZpZXdwb3J0LmdldEJvdHRvbSgpKSk7CiAgICAgICAgICAgIGlmICghdGhpcy5faXNSZW5kZXJMaXN0VXBUb0RhdGUgfHwgIWN1clJlbmRlckNlbGxzLmVxdWFscyhsYXN0UmVuZGVyQ2VsbHMpKSB7CiAgICAgICAgICAgICAgICBpbnN0YW5jZXNUb0RyYXcgPSB0aGlzLl9HZXRSZW5kZXJDZWxsSW5zdGFuY2VzVG9EcmF3KCk7CiAgICAgICAgICAgICAgICB0aGlzLl9pc1JlbmRlckxpc3RVcFRvRGF0ZSA9IHRydWU7CiAgICAgICAgICAgICAgICBsYXN0UmVuZGVyQ2VsbHMuY29weShjdXJSZW5kZXJDZWxscykKICAgICAgICAgICAgfSBlbHNlIGluc3RhbmNlc1RvRHJhdyA9CiAgICAgICAgICAgICAgICB0aGlzLl9sYXN0UmVuZGVyTGlzdDsKICAgICAgICAgICAgdGhpcy5fRHJhd0luc3RhbmNlcyhyZW5kZXJlciwgaW5zdGFuY2VzVG9EcmF3KTsKICAgICAgICAgICAgaWYgKGluc3RhbmNlc1RvRHJhdyAhPT0gdGhpcy5fbGFzdFJlbmRlckxpc3QpIEMzLnNoYWxsb3dBc3NpZ25BcnJheSh0aGlzLl9sYXN0UmVuZGVyTGlzdCwgaW5zdGFuY2VzVG9EcmF3KQogICAgICAgIH0KICAgICAgICBfRHJhd0luc3RhbmNlTWF5YmVXaXRoRWZmZWN0cyhpbnN0LCB3aSwgcmVuZGVyZXIsIHJlbmRlclRhcmdldCkgewogICAgICAgICAgICBpZiAod2kuSGFzQW55QWN0aXZlRWZmZWN0KCkpIHRoaXMuX0RyYXdJbnN0YW5jZVdpdGhFZmZlY3RzQW5kUmVzdG9yZShpbnN0LCB3aSwgcmVuZGVyZXIsIHJlbmRlclRhcmdldCk7CiAgICAgICAgICAgIGVsc2UgdGhpcy5fRHJhd0luc3RhbmNlKGluc3QsIHdpLCByZW5kZXJlcikKICAgICAgICB9CiAgICAgICAgX0RyYXdJbnN0YW5jZShpbnN0LCB3aSwgcmVuZGVyZXIpIHsKICAgICAgICAgICAgY29uc3Qgd2lTdGF0ZUdyb3VwID0gd2kuR2V0UmVuZGVyZXJTdGF0ZUdyb3VwKCk7CiAgICAgICAgICAgIGlmIChyZW5kZXJlci5HZXRDdXJyZW50U3RhdGVHcm91cCgpICE9PSB3aVN0YXRlR3JvdXApIHdpU3RhdGVHcm91cC5BcHBseSgpOwogICAgICAgICAgICBpbnN0LkRyYXcocmVuZGVyZXIpCiAgICAgICAgfQogICAgICAgIF9EcmF3SW5zdGFuY2VXaXRoRWZmZWN0c0FuZFJlc3RvcmUoaW5zdCwgd2ksIHJlbmRlcmVyLCByZW5kZXJUYXJnZXQpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX0RyYXdJbnN0YW5jZVdpdGhFZmZlY3RzKGluc3QsIHdpLCByZW5kZXJlciwgcmVuZGVyVGFyZ2V0LCBudWxsKSkgdGhpcy5fU2V0VHJhbnNmb3JtKHJlbmRlcmVyKQogICAgICAgIH0KICAgICAgICBfRHJhd0luc3RhbmNlV2l0aEVmZmVjdHMoaW5zdCwgd2ksIHJlbmRlcmVyLCByZW5kZXJUYXJnZXQsIG9wdHMpIHsKICAgICAgICAgICAgY29uc3QgZWZmZWN0Q2hhaW4gPSB3aS5HZXRJbnN0YW5jZUVmZmVjdExpc3QoKS5HZXRFZmZlY3RDaGFpbigpOwogICAgICAgICAgICBlZmZlY3RDaGFpbi5SZW5kZXIocmVuZGVyZXIsIHJlbmRlclRhcmdldCwgewogICAgICAgICAgICAgICAgY29udGVudE9iamVjdDogaW5zdCwKICAgICAgICAgICAgICAgIGJsZW5kTW9kZTogd2kuR2V0QmxlbmRNb2RlKCksCiAgICAgICAgICAgICAgICBkZXZpY2VQaXhlbFJhdGlvOiB0aGlzLl9ydW50aW1lLkdldEVmZmVjdERldmljZVBpeGVsUmF0aW9QYXJhbSgpLAogICAgICAgICAgICAgICAgdGltZTogaW5zdC5HZXRJbnN0YW5jZUdhbWVUaW1lKCksCiAgICAgICAgICAgICAgICBsYXllclNjYWxlOiB0aGlzLl9ydW50aW1lLkdldEVmZmVjdExheWVyU2NhbGVQYXJhbSgpICoKICAgICAgICAgICAgICAgICAgICB0aGlzLkdldE5vcm1hbFNjYWxlKCksCiAgICAgICAgICAgICAgICBsYXllckFuZ2xlOiB0aGlzLkdldEFuZ2xlKCksCiAgICAgICAgICAgICAgICBsYXlvdXRSZWN0OiB3aS5HZXRCb3VuZGluZ0JveCgpLAogICAgICAgICAgICAgICAgZHJhd1N1cmZhY2VSZWN0OiBlZmZlY3RDaGFpbi5DYW5Ta2lwQ2FsY3VsYXRpbmdEcmF3U3VyZmFjZVJlY3QoKSA/IG51bGwgOiB0aGlzLl9JbnN0YW5jZUJveFRvRHJhd1N1cmZhY2Uod2kpLAogICAgICAgICAgICAgICAgZHJhd0NvbnRlbnRIb29rOiBvcHRzICYmIG9wdHMuZHJhd0NvbnRlbnRIb29rLAogICAgICAgICAgICAgICAgY29tcG9zaXRPZmZYOiBvcHRzICYmIG9wdHMuY29tcG9zaXRPZmZYLAogICAgICAgICAgICAgICAgY29tcG9zaXRPZmZZOiBvcHRzICYmIG9wdHMuY29tcG9zaXRPZmZZLAogICAgICAgICAgICAgICAgdXBkYXRlT3duUHJvamVjdGlvbjogb3B0cyAmJiBvcHRzLnVwZGF0ZU93blByb2plY3Rpb24KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJlbmRlcmVyLlNldEJhc2VaKHRoaXMuR2V0WkVsZXZhdGlvbigpKTsKICAgICAgICAgICAgcmV0dXJuIGVmZmVjdENoYWluLkRpZENoYW5nZVRyYW5zZm9ybSgpCiAgICAgICAgfQogICAgICAgIF9EcmF3TGF5ZXJPd25UZXh0dXJlVG9SZW5kZXJUYXJnZXQocmVuZGVyZXIsIG93blJlbmRlclRhcmdldCwgZGVzdGluYXRpb25SZW5kZXJUYXJnZXQsCiAgICAgICAgICAgIGlzRmlyc3RUb1RhcmdldCkgewogICAgICAgICAgICBjb25zdCBhY3RpdmVFZmZlY3RUeXBlcyA9IHRoaXMuX2VmZmVjdExpc3QuR2V0QWN0aXZlRWZmZWN0VHlwZXMoKTsKICAgICAgICAgICAgY29uc3QgcnVudGltZSA9IHRoaXMuX3J1bnRpbWU7CiAgICAgICAgICAgIGlmIChhY3RpdmVFZmZlY3RUeXBlcy5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICAgIHJlbmRlcmVyLlNldFJlbmRlclRhcmdldChkZXN0aW5hdGlvblJlbmRlclRhcmdldCk7CiAgICAgICAgICAgICAgICByZW5kZXJlci5TZXRUZXh0dXJlRmlsbE1vZGUoKTsKICAgICAgICAgICAgICAgIGlmIChpc0ZpcnN0VG9UYXJnZXQgJiYgdGhpcy5fYmxlbmRNb2RlID09PSAwICYmIHRoaXMuSGFzRGVmYXVsdENvbG9yKCkpIHJlbmRlcmVyLkNvcHlSZW5kZXJUYXJnZXQob3duUmVuZGVyVGFyZ2V0KTsKICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIHJlbmRlcmVyLlNldEJsZW5kTW9kZSh0aGlzLl9ibGVuZE1vZGUpOwogICAgICAgICAgICAgICAgICAgIHJlbmRlcmVyLlNldENvbG9yKHRoaXMuX3ByZW11bHRpcGxpZWRDb2xvcik7CiAgICAgICAgICAgICAgICAgICAgcmVuZGVyZXIuRHJhd1JlbmRlclRhcmdldChvd25SZW5kZXJUYXJnZXQpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZW5kZXJlci5JbnZhbGlkYXRlUmVuZGVyVGFyZ2V0KG93blJlbmRlclRhcmdldCk7CiAgICAgICAgICAgICAgICBydW50aW1lLlJlbGVhc2VBZGRpdGlvbmFsUmVuZGVyVGFyZ2V0KG93blJlbmRlclRhcmdldCkKICAgICAgICAgICAgfSBlbHNlIHRoaXMuR2V0RWZmZWN0Q2hhaW4oKS5SZW5kZXIocmVuZGVyZXIsIGRlc3RpbmF0aW9uUmVuZGVyVGFyZ2V0LCB7CiAgICAgICAgICAgICAgICBjb250ZW50T2JqZWN0OiB0aGlzLAogICAgICAgICAgICAgICAgYmxlbmRNb2RlOiB0aGlzLkdldEJsZW5kTW9kZSgpLAogICAgICAgICAgICAgICAgZGV2aWNlUGl4ZWxSYXRpbzogcnVudGltZS5HZXRFZmZlY3REZXZpY2VQaXhlbFJhdGlvUGFyYW0oKSwKICAgICAgICAgICAgICAgIGxheWVyU2NhbGU6IHJ1bnRpbWUuR2V0RWZmZWN0TGF5ZXJTY2FsZVBhcmFtKCkgKiB0aGlzLkdldE5vcm1hbFNjYWxlKCksCiAgICAgICAgICAgICAgICBsYXllckFuZ2xlOiB0aGlzLkdldEFuZ2xlKCksCiAgICAgICAgICAgICAgICBsYXlvdXRSZWN0OiB0aGlzLkdldFZpZXdwb3J0KCksCiAgICAgICAgICAgICAgICBkcmF3U3VyZmFjZVJlY3Q6IG51bGwsCiAgICAgICAgICAgICAgICBpbnZhbGlkYXRlUmVuZGVyVGFyZ2V0czogdHJ1ZQogICAgICAgICAgICB9KQogICAgICAgIH0KICAgICAgICBHZXRPd25TY2FsZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NjYWxlCiAgICAgICAgfQogICAgICAgIFNldE93blNjYWxlKHMpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX3NjYWxlID09PSBzKSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuX3NjYWxlID0gczsKICAgICAgICAgICAgdGhpcy5fbGF5b3V0LkJvdW5kU2Nyb2xsaW5nKCk7CiAgICAgICAgICAgIHRoaXMuX1NldE1WTWF0cml4Q2hhbmdlZCgpOwogICAgICAgICAgICB0aGlzLl9ydW50aW1lLlVwZGF0ZVJlbmRlcigpCiAgICAgICAgfQogICAgICAgIEdldFJlbmRlclNjYWxlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5HZXROb3JtYWxTY2FsZSgpICogdGhpcy5fcnVudGltZS5HZXRSZW5kZXJTY2FsZSgpCiAgICAgICAgfQogICAgICAgIEdldERpc3BsYXlTY2FsZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuR2V0Tm9ybWFsU2NhbGUoKSAqIHRoaXMuX3J1bnRpbWUuR2V0RGlzcGxheVNjYWxlKCkKICAgICAgICB9CiAgICAgICAgR2V0Tm9ybWFsU2NhbGUoKSB7CiAgICAgICAgICAgIHJldHVybiAodGhpcy5fc2NhbGUgKiB0aGlzLl9sYXlvdXQuR2V0U2NhbGUoKSAtIDEpICogdGhpcy5fc2NhbGVSYXRlICsgMQogICAgICAgIH0KICAgICAgICBfTWF5YmVVcGRhdGVWaWV3cG9ydCgpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLl9pc1ZpZXdwb3J0Q2hhbmdlZCkgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl9pc1ZpZXdwb3J0Q2hhbmdlZCA9IGZhbHNlOwogICAgICAgICAgICBjb25zdCBwYXJhbGxheE9yaWdpblggPSB0aGlzLl9ydW50aW1lLkdldFBhcmFsbGF4WE9yaWdpbigpOwogICAgICAgICAgICBjb25zdCBwYXJhbGxheE9yaWdpblkgPSB0aGlzLl9ydW50aW1lLkdldFBhcmFsbGF4WU9yaWdpbigpOwogICAgICAgICAgICBjb25zdCBzY3JvbGxPcmlnaW5YID0KICAgICAgICAgICAgICAgICh0aGlzLkdldFNjcm9sbFgoKSAtIHBhcmFsbGF4T3JpZ2luWCkgKiB0aGlzLl9wYXJhbGxheFggKyBwYXJhbGxheE9yaWdpblg7CiAgICAgICAgICAgIGNvbnN0IHNjcm9sbE9yaWdpblkgPSAodGhpcy5HZXRTY3JvbGxZKCkgLSBwYXJhbGxheE9yaWdpblkpICogdGhpcy5fcGFyYWxsYXhZICsgcGFyYWxsYXhPcmlnaW5ZOwogICAgICAgICAgICBjb25zdCBub3JtYWxTY2FsZSA9IHRoaXMuR2V0Tm9ybWFsU2NhbGUoKTsKICAgICAgICAgICAgY29uc3Qgc2NhbGVkVmlld3BvcnRXaWR0aCA9IHRoaXMuX3J1bnRpbWUuR2V0Vmlld3BvcnRXaWR0aCgpIC8gbm9ybWFsU2NhbGU7CiAgICAgICAgICAgIGNvbnN0IHNjYWxlZFZpZXdwb3J0SGVpZ2h0ID0gdGhpcy5fcnVudGltZS5HZXRWaWV3cG9ydEhlaWdodCgpIC8gbm9ybWFsU2NhbGU7CiAgICAgICAgICAgIGxldCBweCA9IHNjcm9sbE9yaWdpblggLSBzY2FsZWRWaWV3cG9ydFdpZHRoIC8gMjsKICAgICAgICAgICAgbGV0IHB5ID0gc2Nyb2xsT3JpZ2luWSAtIHNjYWxlZFZpZXdwb3J0SGVpZ2h0IC8gMjsKICAgICAgICAgICAgaWYgKHRoaXMuX3J1bnRpbWUuSXNQaXhlbFJvdW5kaW5nRW5hYmxlZCgpKSB7CiAgICAgICAgICAgICAgICBweCA9IE1hdGgucm91bmQocHgpOwogICAgICAgICAgICAgICAgcHkgPSBNYXRoLnJvdW5kKHB5KQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IHZpZXdwb3J0WjAgPQogICAgICAgICAgICAgICAgdGhpcy5fdmlld3BvcnRaMDsKICAgICAgICAgICAgdmlld3BvcnRaMC5zZXQocHgsIHB5LCBweCArIHNjYWxlZFZpZXdwb3J0V2lkdGgsIHB5ICsgc2NhbGVkVmlld3BvcnRIZWlnaHQpOwogICAgICAgICAgICBjb25zdCBteUFuZ2xlID0gdGhpcy5HZXRBbmdsZSgpOwogICAgICAgICAgICBpZiAobXlBbmdsZSAhPT0gMCkgewogICAgICAgICAgICAgICAgdG1wUmVjdC5jb3B5KHZpZXdwb3J0WjApOwogICAgICAgICAgICAgICAgdG1wUmVjdC5vZmZzZXQoLXZpZXdwb3J0WjAubWlkWCgpLCAtdmlld3BvcnRaMC5taWRZKCkpOwogICAgICAgICAgICAgICAgdG1wUXVhZC5zZXRGcm9tUm90YXRlZFJlY3QodG1wUmVjdCwgbXlBbmdsZSk7CiAgICAgICAgICAgICAgICB0bXBRdWFkLmdldEJvdW5kaW5nQm94KHRtcFJlY3QpOwogICAgICAgICAgICAgICAgdG1wUmVjdC5vZmZzZXQodmlld3BvcnRaMC5taWRYKCksIHZpZXdwb3J0WjAubWlkWSgpKTsKICAgICAgICAgICAgICAgIHZpZXdwb3J0WjAuY29weSh0bXBSZWN0KQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IGxheWVyWiA9IHRoaXMuX3pFbGV2YXRpb247CiAgICAgICAgICAgIHRoaXMuR2V0Vmlld3BvcnRGb3JaKGxheWVyWiwgdGhpcy5fdmlld3BvcnQpOwogICAgICAgICAgICBpZiAodGhpcy5IYXMzRENhbWVyYSgpKSB0aGlzLkNhbGN1bGF0ZVZpZXdwb3J0M0QobGF5ZXJaLCB0aGlzLl92aWV3cG9ydDNEKTsKICAgICAgICAgICAgZWxzZSB0aGlzLl92aWV3cG9ydDNELmNvcHkodGhpcy5fdmlld3BvcnQpCiAgICAgICAgfQogICAgICAgIENhbGN1bGF0ZVZpZXdwb3J0M0Qoeiwgb3V0UmVjdCkgewogICAgICAgICAgICBjb25zdCBjYW52YXNNYW5hZ2VyID0gdGhpcy5fcnVudGltZS5HZXRDYW52YXNNYW5hZ2VyKCk7CiAgICAgICAgICAgIGNvbnN0IGNhbnZhc1dpZHRoID0gY2FudmFzTWFuYWdlci5HZXRDc3NXaWR0aCgpOwogICAgICAgICAgICBjb25zdCBjYW52YXNIZWlnaHQgPSBjYW52YXNNYW5hZ2VyLkdldENzc0hlaWdodCgpOwogICAgICAgICAgICBjb25zdCBbdGx4LCB0bHldID0gdGhpcy5DYW52YXNDc3NUb0xheWVyKDAsIDAsIHopOwogICAgICAgICAgICBjb25zdCBbdHJ4LCB0cnlfXSA9IHRoaXMuQ2FudmFzQ3NzVG9MYXllcihjYW52YXNXaWR0aCwgMCwgeik7CiAgICAgICAgICAgIGNvbnN0IFticngsIGJyeV0gPSB0aGlzLkNhbnZhc0Nzc1RvTGF5ZXIoY2FudmFzV2lkdGgsIGNhbnZhc0hlaWdodCwgeik7CiAgICAgICAgICAgIGNvbnN0IFtibHgsIGJseV0gPSB0aGlzLkNhbnZhc0Nzc1RvTGF5ZXIoMCwgY2FudmFzSGVpZ2h0LCB6KTsKICAgICAgICAgICAgbGV0IGxlZnQgPSBNYXRoLm1pbih0bHgsIHRyeCwgYnJ4LCBibHgpOwogICAgICAgICAgICBsZXQgdG9wID0gTWF0aC5taW4odGx5LCB0cnlfLAogICAgICAgICAgICAgICAgYnJ5LCBibHkpOwogICAgICAgICAgICBsZXQgcmlnaHQgPSBNYXRoLm1heCh0bHgsIHRyeCwgYnJ4LCBibHgpOwogICAgICAgICAgICBsZXQgYm90dG9tID0gTWF0aC5tYXgodGx5LCB0cnlfLCBicnksIGJseSk7CiAgICAgICAgICAgIGlmICghaXNGaW5pdGUobGVmdCkpIGxlZnQgPSAtSW5maW5pdHk7CiAgICAgICAgICAgIGlmICghaXNGaW5pdGUodG9wKSkgdG9wID0gLUluZmluaXR5OwogICAgICAgICAgICBpZiAoIWlzRmluaXRlKHJpZ2h0KSkgcmlnaHQgPSBJbmZpbml0eTsKICAgICAgICAgICAgaWYgKCFpc0Zpbml0ZShib3R0b20pKSBib3R0b20gPSBJbmZpbml0eTsKICAgICAgICAgICAgb3V0UmVjdC5zZXQobGVmdCwgdG9wLCByaWdodCwgYm90dG9tKQogICAgICAgIH0KICAgICAgICBDYW52YXNDc3NUb0xheWVyKHB0eCwgcHR5LCB6ID0gMCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fQ2FudmFzVG9MYXllcihwdHgsIHB0eSwgeiwgdGhpcy5HZXREaXNwbGF5U2NhbGUoKSkKICAgICAgICB9CiAgICAgICAgRHJhd1N1cmZhY2VUb0xheWVyKHB0eCwgcHR5LCB6ID0gMCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fQ2FudmFzVG9MYXllcihwdHgsIHB0eSwgeiwgdGhpcy5HZXRSZW5kZXJTY2FsZSgpICogdGhpcy5HZXREZXZpY2VQaXhlbFJhdGlvKCkpCiAgICAgICAgfQogICAgICAgIF9DYW52YXNUb0xheWVyKGNhbnZhc1gsIGNhbnZhc1ksIHpFbGV2YXRpb24sCiAgICAgICAgICAgIGRpc3BsYXlTY2FsZSkgewogICAgICAgICAgICBjb25zdCBydW50aW1lID0gdGhpcy5fcnVudGltZTsKICAgICAgICAgICAgY29uc3QgcmVuZGVyZXIgPSBydW50aW1lLkdldFJlbmRlcmVyKCk7CiAgICAgICAgICAgIGNvbnN0IG5vcm1hbFNjYWxlID0gdGhpcy5HZXROb3JtYWxTY2FsZSgpOwogICAgICAgICAgICBjb25zdCBzY2FsZWRWaWV3cG9ydFdpZHRoID0gcnVudGltZS5HZXRWaWV3cG9ydFdpZHRoKCkgLyBub3JtYWxTY2FsZTsKICAgICAgICAgICAgY29uc3Qgc2NhbGVkVmlld3BvcnRIZWlnaHQgPSBydW50aW1lLkdldFZpZXdwb3J0SGVpZ2h0KCkgLyBub3JtYWxTY2FsZTsKICAgICAgICAgICAgY29uc3Qgdmlld3BvcnQgPSB0ZW1wVmVjNDsKICAgICAgICAgICAgdmVjNC5zZXQodmlld3BvcnQsIDAsIDAsIHNjYWxlZFZpZXdwb3J0V2lkdGgsIHNjYWxlZFZpZXdwb3J0SGVpZ2h0KTsKICAgICAgICAgICAgY2FudmFzWCA9IGNhbnZhc1ggLyBkaXNwbGF5U2NhbGU7CiAgICAgICAgICAgIGNhbnZhc1kgPSB2aWV3cG9ydFszXSAtIGNhbnZhc1kgLyBkaXNwbGF5U2NhbGU7CiAgICAgICAgICAgIGNvbnN0IG1hdFAgPSB0aGlzLl9HZXRQcm9qZWN0aW9uTWF0cml4KHJlbmRlcmVyKTsKICAgICAgICAgICAgY29uc3QgbWF0TVYgPSB0aGlzLl9HZXRNb2RlbFZpZXdNYXRyaXgocmVuZGVyZXIpOwogICAgICAgICAgICBjb25zdCBvYmplY3RDb29yZCA9IHRlbXBWZWMzOwogICAgICAgICAgICBjb25zdCByZXN1bHQgPSBDMy5HZnguVW5wcm9qZWN0U2NyZWVuVG9Xb3JsZFooY2FudmFzWCwgY2FudmFzWSwgekVsZXZhdGlvbiwgbWF0TVYsIG1hdFAsIHZpZXdwb3J0LCBvYmplY3RDb29yZCk7CiAgICAgICAgICAgIGlmIChyZXN1bHQpIHJldHVybiBbb2JqZWN0Q29vcmRbMF0sIG9iamVjdENvb3JkWzFdXTsKICAgICAgICAgICAgZWxzZSByZXR1cm4gW05hTiwgTmFOXQogICAgICAgIH0KICAgICAgICBDYW52YXNDc3NUb0xheWVyX0RlZmF1bHRUcmFuc2Zvcm0ocHR4LCBwdHkpIHsKICAgICAgICAgICAgY29uc3Qgc2NhbGUgPSB0aGlzLl9zY2FsZTsKICAgICAgICAgICAgY29uc3Qgc2NhbGVSYXRlID0gdGhpcy5fc2NhbGVSYXRlOwogICAgICAgICAgICBjb25zdCBwYXJhbGxheFggPSB0aGlzLl9wYXJhbGxheFg7CiAgICAgICAgICAgIGNvbnN0IHBhcmFsbGF4WSA9IHRoaXMuX3BhcmFsbGF4WTsKICAgICAgICAgICAgY29uc3QgYW5nbGUgPSB0aGlzLl9hbmdsZTsKICAgICAgICAgICAgdGhpcy5fc2NhbGUgPSAxOwogICAgICAgICAgICB0aGlzLl9zY2FsZVJhdGUgPSAxOwogICAgICAgICAgICB0aGlzLl9wYXJhbGxheFggPSAxOwogICAgICAgICAgICB0aGlzLl9wYXJhbGxheFkgPSAxOwogICAgICAgICAgICB0aGlzLl9hbmdsZSA9IDA7CiAgICAgICAgICAgIHRoaXMuX1NldE1WTWF0cml4Q2hhbmdlZCgpOwogICAgICAgICAgICBjb25zdCByZXQgPQogICAgICAgICAgICAgICAgdGhpcy5DYW52YXNDc3NUb0xheWVyKHB0eCwgcHR5KTsKICAgICAgICAgICAgdGhpcy5fc2NhbGUgPSBzY2FsZTsKICAgICAgICAgICAgdGhpcy5fc2NhbGVSYXRlID0gc2NhbGVSYXRlOwogICAgICAgICAgICB0aGlzLl9wYXJhbGxheFggPSBwYXJhbGxheFg7CiAgICAgICAgICAgIHRoaXMuX3BhcmFsbGF4WSA9IHBhcmFsbGF4WTsKICAgICAgICAgICAgdGhpcy5fYW5nbGUgPSBhbmdsZTsKICAgICAgICAgICAgdGhpcy5fU2V0TVZNYXRyaXhDaGFuZ2VkKCk7CiAgICAgICAgICAgIHJldHVybiByZXQKICAgICAgICB9CiAgICAgICAgTGF5ZXJUb0NhbnZhc0NzcyhwdHgsIHB0eSwgeiA9IDApIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX0xheWVyVG9DYW52YXMocHR4LCBwdHksIHosIHRoaXMuR2V0RGlzcGxheVNjYWxlKCkpCiAgICAgICAgfQogICAgICAgIExheWVyVG9EcmF3U3VyZmFjZShwdHgsIHB0eSwgeiA9IDApIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX0xheWVyVG9DYW52YXMocHR4LCBwdHksIHosIHRoaXMuR2V0UmVuZGVyU2NhbGUoKSAqIHRoaXMuR2V0RGV2aWNlUGl4ZWxSYXRpbygpKQogICAgICAgIH0KICAgICAgICBfTGF5ZXJUb0NhbnZhcyhsYXllclgsIGxheWVyWSwgekVsZXZhdGlvbiwgZGlzcGxheVNjYWxlKSB7CiAgICAgICAgICAgIGNvbnN0IHJ1bnRpbWUgPSB0aGlzLl9ydW50aW1lOwogICAgICAgICAgICBjb25zdCByZW5kZXJlciA9IHJ1bnRpbWUuR2V0UmVuZGVyZXIoKTsKICAgICAgICAgICAgY29uc3Qgbm9ybWFsU2NhbGUgPSB0aGlzLkdldE5vcm1hbFNjYWxlKCk7CiAgICAgICAgICAgIGNvbnN0IHNjYWxlZFZpZXdwb3J0V2lkdGggPSBydW50aW1lLkdldFZpZXdwb3J0V2lkdGgoKSAvIG5vcm1hbFNjYWxlOwogICAgICAgICAgICBjb25zdCBzY2FsZWRWaWV3cG9ydEhlaWdodCA9IHJ1bnRpbWUuR2V0Vmlld3BvcnRIZWlnaHQoKSAvIG5vcm1hbFNjYWxlOwogICAgICAgICAgICBjb25zdCB2aWV3cG9ydCA9IHRlbXBWZWM0OwogICAgICAgICAgICB2ZWM0LnNldCh2aWV3cG9ydCwgMCwgMCwgc2NhbGVkVmlld3BvcnRXaWR0aCwgc2NhbGVkVmlld3BvcnRIZWlnaHQpOwogICAgICAgICAgICBjb25zdCBtYXRQID0gdGhpcy5fR2V0UHJvamVjdGlvbk1hdHJpeChyZW5kZXJlcik7CiAgICAgICAgICAgIGNvbnN0IG1hdE1WID0gdGhpcy5fR2V0TW9kZWxWaWV3TWF0cml4KHJlbmRlcmVyKTsKICAgICAgICAgICAgY29uc3Qgd2luZG93Q29vcmQgPSB0ZW1wVmVjMzsKICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gQzMuR2Z4LlByb2plY3QobGF5ZXJYLCBsYXllclksIHpFbGV2YXRpb24sIG1hdE1WLCBtYXRQLCB2aWV3cG9ydCwgd2luZG93Q29vcmQpOwogICAgICAgICAgICBpZiAocmVzdWx0KSByZXR1cm4gW3dpbmRvd0Nvb3JkWzBdICogZGlzcGxheVNjYWxlLAogICAgICAgICAgICAgICAgKHZpZXdwb3J0WzNdIC0gd2luZG93Q29vcmRbMV0pICogZGlzcGxheVNjYWxlCiAgICAgICAgICAgIF07CiAgICAgICAgICAgIGVsc2UgcmV0dXJuIFtOYU4sIE5hTl0KICAgICAgICB9CiAgICAgICAgX0dldExheWVyVG9EcmF3U3VyZmFjZVNjYWxlKHNpemUsIHpFbGV2YXRpb24pIHsKICAgICAgICAgICAgc2l6ZSAqPSB0aGlzLkdldFJlbmRlclNjYWxlKCkgKiB0aGlzLkdldERldmljZVBpeGVsUmF0aW8oKTsKICAgICAgICAgICAgaWYgKHpFbGV2YXRpb24gIT09IDApIHNpemUgKj0gdGhpcy5HZXQyRFNjYWxlRmFjdG9yVG9aKHpFbGV2YXRpb24pOwogICAgICAgICAgICByZXR1cm4gc2l6ZQogICAgICAgIH0KICAgICAgICBfSW5zdGFuY2VCb3hUb0RyYXdTdXJmYWNlKHdpKSB7CiAgICAgICAgICAgIGNvbnN0IGJib3ggPSB3aS5HZXRCb3VuZGluZ0JveCgpOwogICAgICAgICAgICBjb25zdCB6ID0gd2kuR2V0VG90YWxaRWxldmF0aW9uKCk7CiAgICAgICAgICAgIGNvbnN0IGRlcHRoID0gd2kuR2V0RGVwdGgoKTsKICAgICAgICAgICAgY29uc3QgdG9wWiA9IHogKyBkZXB0aDsKICAgICAgICAgICAgY29uc3QgYmJMZWZ0ID0gYmJveC5nZXRMZWZ0KCk7CiAgICAgICAgICAgIGNvbnN0IGJiVG9wID0gYmJveC5nZXRUb3AoKTsKICAgICAgICAgICAgY29uc3QgYmJSaWdodCA9IGJib3guZ2V0UmlnaHQoKTsKICAgICAgICAgICAgY29uc3QgYmJCb3R0b20gPSBiYm94LmdldEJvdHRvbSgpOwogICAgICAgICAgICBpZiAodGhpcy5IYXMzRENhbWVyYSgpKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fSXNQb2ludEJlaGluZE5lYXJQbGFuZShiYkxlZnQsCiAgICAgICAgICAgICAgICAgICAgICAgIGJiVG9wLCB6KSB8fCB0aGlzLl9Jc1BvaW50QmVoaW5kTmVhclBsYW5lKGJiUmlnaHQsIGJiVG9wLCB6KSB8fCB0aGlzLl9Jc1BvaW50QmVoaW5kTmVhclBsYW5lKGJiUmlnaHQsIGJiQm90dG9tLCB6KSB8fCB0aGlzLl9Jc1BvaW50QmVoaW5kTmVhclBsYW5lKGJiTGVmdCwgYmJCb3R0b20sIHopKSByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICAgIGlmIChkZXB0aCA+IDApCiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX0lzUG9pbnRCZWhpbmROZWFyUGxhbmUoYmJMZWZ0LCBiYlRvcCwgdG9wWikgfHwgdGhpcy5fSXNQb2ludEJlaGluZE5lYXJQbGFuZShiYlJpZ2h0LCBiYlRvcCwgdG9wWikgfHwgdGhpcy5fSXNQb2ludEJlaGluZE5lYXJQbGFuZShiYlJpZ2h0LCBiYkJvdHRvbSwgdG9wWikgfHwgdGhpcy5fSXNQb2ludEJlaGluZE5lYXJQbGFuZShiYkxlZnQsIGJiQm90dG9tLCB0b3BaKSkgcmV0dXJuIG51bGwKICAgICAgICAgICAgfSBlbHNlIGlmICh0b3BaID49IHRoaXMuR2V0Q2FtZXJhWigpKSByZXR1cm4gbnVsbDsKICAgICAgICAgICAgbGV0IFtzdGx4LCBzdGx5XSA9IHRoaXMuTGF5ZXJUb0RyYXdTdXJmYWNlKGJiTGVmdCwgYmJUb3AsIHopOwogICAgICAgICAgICBsZXQgW3NicngsCiAgICAgICAgICAgICAgICBzYnJ5CiAgICAgICAgICAgIF0gPSB0aGlzLkxheWVyVG9EcmF3U3VyZmFjZShiYlJpZ2h0LCBiYkJvdHRvbSwgeik7CiAgICAgICAgICAgIGlmICh0aGlzLkdldEFuZ2xlKCkgIT09IDAgfHwgZGVwdGggPiAwIHx8IHRoaXMuSGFzM0RDYW1lcmEoKSkgewogICAgICAgICAgICAgICAgY29uc3QgW3N0cngsIHN0cnldID0gdGhpcy5MYXllclRvRHJhd1N1cmZhY2UoYmJSaWdodCwgYmJUb3AsIHopOwogICAgICAgICAgICAgICAgY29uc3QgW3NibHgsIHNibHldID0gdGhpcy5MYXllclRvRHJhd1N1cmZhY2UoYmJMZWZ0LCBiYkJvdHRvbSwgeik7CiAgICAgICAgICAgICAgICBpZiAoZGVwdGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgW3N0bHhUb3AsIHN0bHlUb3BdID0gdGhpcy5MYXllclRvRHJhd1N1cmZhY2UoYmJMZWZ0LCBiYlRvcCwgdG9wWik7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgW3N0cnhUb3AsIHN0cnlUb3BdID0gdGhpcy5MYXllclRvRHJhd1N1cmZhY2UoYmJSaWdodCwgYmJUb3AsIHRvcFopOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IFtzYnJ4VG9wLCBzYnJ5VG9wXSA9IHRoaXMuTGF5ZXJUb0RyYXdTdXJmYWNlKGJiUmlnaHQsIGJiQm90dG9tLCB0b3BaKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBbc2JseFRvcCwgc2JseVRvcF0gPSB0aGlzLkxheWVyVG9EcmF3U3VyZmFjZShiYkxlZnQsIGJiQm90dG9tLAogICAgICAgICAgICAgICAgICAgICAgICB0b3BaKTsKICAgICAgICAgICAgICAgICAgICBsZXQgdGVtcCA9IE1hdGgubWluKHN0bHgsIHNicngsIHN0cngsIHNibHgsIHN0bHhUb3AsIHN0cnhUb3AsIHNicnhUb3AsIHNibHhUb3ApOwogICAgICAgICAgICAgICAgICAgIHNicnggPSBNYXRoLm1heChzdGx4LCBzYnJ4LCBzdHJ4LCBzYmx4LCBzdGx4VG9wLCBzdHJ4VG9wLCBzYnJ4VG9wLCBzYmx4VG9wKTsKICAgICAgICAgICAgICAgICAgICBzdGx4ID0gdGVtcDsKICAgICAgICAgICAgICAgICAgICB0ZW1wID0gTWF0aC5taW4oc3RseSwgc2JyeSwgc3RyeSwgc2JseSwgc3RseVRvcCwgc3RyeVRvcCwgc2JyeVRvcCwgc2JseVRvcCk7CiAgICAgICAgICAgICAgICAgICAgc2JyeSA9IE1hdGgubWF4KHN0bHksIHNicnksIHN0cnksIHNibHksIHN0bHlUb3AsIHN0cnlUb3AsIHNicnlUb3AsIHNibHlUb3ApOwogICAgICAgICAgICAgICAgICAgIHN0bHkgPSB0ZW1wCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGxldCB0ZW1wID0gTWF0aC5taW4oc3RseCwgc2JyeCwgc3RyeCwgc2JseCk7CiAgICAgICAgICAgICAgICAgICAgc2JyeCA9IE1hdGgubWF4KHN0bHgsIHNicngsIHN0cngsIHNibHgpOwogICAgICAgICAgICAgICAgICAgIHN0bHggPSB0ZW1wOwogICAgICAgICAgICAgICAgICAgIHRlbXAgPSBNYXRoLm1pbihzdGx5LCBzYnJ5LCBzdHJ5LCBzYmx5KTsKICAgICAgICAgICAgICAgICAgICBzYnJ5ID0gTWF0aC5tYXgoc3RseSwgc2JyeSwgc3RyeSwgc2JseSk7CiAgICAgICAgICAgICAgICAgICAgc3RseSA9IHRlbXAKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICB0bXBSZWN0LnNldChzdGx4LCBzdGx5LCBzYnJ4LCBzYnJ5KTsKICAgICAgICAgICAgcmV0dXJuIHRtcFJlY3QKICAgICAgICB9CiAgICAgICAgX0dldFZpZXdGcnVzdHVtKCkgewogICAgICAgICAgICBpZiAodGhpcy5faXNWaWV3RnJ1c3R1bUNoYW5nZWQpIHsKICAgICAgICAgICAgICAgIHRoaXMuX1VwZGF0ZVZpZXdGcnVzdHVtKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9pc1ZpZXdGcnVzdHVtQ2hhbmdlZCA9IGZhbHNlCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3ZpZXdGcnVzdHVtCiAgICAgICAgfQogICAgICAgIF9VcGRhdGVWaWV3RnJ1c3R1bSgpIHsKICAgICAgICAgICAgY29uc3QgcmVuZGVyZXIgPSB0aGlzLl9ydW50aW1lLkdldFJlbmRlcmVyKCk7CiAgICAgICAgICAgIGNvbnN0IG1hdFAgPSB0aGlzLl9HZXRQcm9qZWN0aW9uTWF0cml4KHJlbmRlcmVyKTsKICAgICAgICAgICAgY29uc3QgbWF0TVYgPSB0aGlzLl9HZXRNb2RlbFZpZXdNYXRyaXgocmVuZGVyZXIpOwogICAgICAgICAgICB0aGlzLl92aWV3RnJ1c3R1bS5DYWxjdWxhdGVQbGFuZXMobWF0TVYsIG1hdFApCiAgICAgICAgfQogICAgICAgIF9Jc1BvaW50QmVoaW5kTmVhclBsYW5lKHgsIHksIHopIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX0dldFZpZXdGcnVzdHVtKCkuSXNCZWhpbmROZWFyUGxhbmUoeCwgeSwgeikKICAgICAgICB9CiAgICAgICAgX1NhdmVUb0pzb24oKSB7CiAgICAgICAgICAgIGNvbnN0IG8gPSB7CiAgICAgICAgICAgICAgICAicyI6IHRoaXMuR2V0T3duU2NhbGUoKSwKICAgICAgICAgICAgICAgICJhIjogdGhpcy5HZXRPd25BbmdsZSgpLAogICAgICAgICAgICAgICAgInYiOiB0aGlzLl9Jc1Zpc2libGVGbGFnU2V0KCksCiAgICAgICAgICAgICAgICAiaSI6IHRoaXMuSXNJbnRlcmFjdGl2ZSgpLAogICAgICAgICAgICAgICAgImJjIjogdGhpcy5fYmFja2dyb3VuZENvbG9yLnRvSlNPTigpLAogICAgICAgICAgICAgICAgInQiOiB0aGlzLklzVHJhbnNwYXJlbnQoKSwKICAgICAgICAgICAgICAgICJzeCI6IHRoaXMuX3Njcm9sbFgsCiAgICAgICAgICAgICAgICAic3kiOiB0aGlzLl9zY3JvbGxZLAogICAgICAgICAgICAgICAgImhvc3AiOiB0aGlzLl9oYXNPd25TY3JvbGxQb3NpdGlvbiwKICAgICAgICAgICAgICAgICJweCI6IHRoaXMuR2V0UGFyYWxsYXhYKCksCiAgICAgICAgICAgICAgICAicHkiOiB0aGlzLkdldFBhcmFsbGF4WSgpLAogICAgICAgICAgICAgICAgImMiOiB0aGlzLl9jb2xvci50b0pTT04oKSwKICAgICAgICAgICAgICAgICJzciI6IHRoaXMuR2V0U2NhbGVSYXRlKCksCiAgICAgICAgICAgICAgICAiZngiOiB0aGlzLl9lZmZlY3RMaXN0LlNhdmVUb0pzb24oKSwKICAgICAgICAgICAgICAgICJjZyI6IHRoaXMuX2NyZWF0ZWRHbG9iYWxVaWRzCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHJldHVybiBvCiAgICAgICAgfQogICAgICAgIF9Mb2FkRnJvbUpzb24obykgewogICAgICAgICAgICB0aGlzLl9zY2FsZSA9IG9bInMiXTsKICAgICAgICAgICAgdGhpcy5fYW5nbGUgPSBvWyJhIl07CiAgICAgICAgICAgIHRoaXMuX2lzVmlzaWJsZSA9ICEhb1sidiJdOwogICAgICAgICAgICB0aGlzLl9pc0ludGVyYWN0aXZlID0gby5oYXNPd25Qcm9wZXJ0eSgiaSIpID8gb1siaSJdIDogdHJ1ZTsKICAgICAgICAgICAgdGhpcy5fYmFja2dyb3VuZENvbG9yLnNldEZyb21KU09OKG9bImJjIl0pOwogICAgICAgICAgICB0aGlzLl9pc1RyYW5zcGFyZW50ID0gISFvWyJ0Il07CiAgICAgICAgICAgIGlmIChvLmhhc093blByb3BlcnR5KCJzeCIpKSB0aGlzLl9zY3JvbGxYID0gb1sic3giXTsKICAgICAgICAgICAgaWYgKG8uaGFzT3duUHJvcGVydHkoInN5IikpIHRoaXMuX3Njcm9sbFkgPSBvWyJzeSJdOwogICAgICAgICAgICBpZiAoby5oYXNPd25Qcm9wZXJ0eSgiaG9zcCIpKSB0aGlzLl9oYXNPd25TY3JvbGxQb3NpdGlvbiA9ICEhb1siaG9zcCJdOwogICAgICAgICAgICB0aGlzLl9wYXJhbGxheFggPSBvWyJweCJdOwogICAgICAgICAgICB0aGlzLl9wYXJhbGxheFkgPSBvWyJweSJdOwogICAgICAgICAgICB0aGlzLl9jb2xvci5zZXRGcm9tSlNPTihvWyJjIl0pOwogICAgICAgICAgICB0aGlzLl9VcGRhdGVQcmVtdWx0aXBsaWVkQ29sb3IoKTsKICAgICAgICAgICAgdGhpcy5fc2NhbGVSYXRlID0gb1sic3IiXTsKICAgICAgICAgICAgQzMuc2hhbGxvd0Fzc2lnbkFycmF5KHRoaXMuX2NyZWF0ZWRHbG9iYWxVaWRzLCBvWyJjZyJdKTsKICAgICAgICAgICAgQzMuc2hhbGxvd0Fzc2lnbkFycmF5KHRoaXMuX2luaXRpYWxJbnN0YW5jZXMsIHRoaXMuX3N0YXJ0dXBJbml0aWFsSW5zdGFuY2VzKTsKICAgICAgICAgICAgY29uc3QgdGVtcFNldCA9IG5ldyBTZXQodGhpcy5fY3JlYXRlZEdsb2JhbFVpZHMpOwogICAgICAgICAgICBsZXQgaiA9IDA7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSB0aGlzLl9pbml0aWFsSW5zdGFuY2VzLmxlbmd0aDsgaSA8IGxlbjsgKytpKQogICAgICAgICAgICAgICAgaWYgKCF0ZW1wU2V0Lmhhcyh0aGlzLl9pbml0aWFsSW5zdGFuY2VzW2ldWzJdKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX2luaXRpYWxJbnN0YW5jZXNbal0gPSB0aGlzLl9pbml0aWFsSW5zdGFuY2VzW2ldOwogICAgICAgICAgICAgICAgICAgICsragogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBDMy50cnVuY2F0ZUFycmF5KHRoaXMuX2luaXRpYWxJbnN0YW5jZXMsIGopOwogICAgICAgICAgICB0aGlzLl9lZmZlY3RMaXN0LkxvYWRGcm9tSnNvbihvWyJmeCJdKTsKICAgICAgICAgICAgdGhpcy5fbmVlZHNSZWJ1aWxkRWZmZWN0Q2hhaW5TdGVwcyA9IHRydWU7CiAgICAgICAgICAgIHRoaXMuX1NvcnRJbnN0YW5jZXNCeUxhc3RDYWNoZWRaSW5kZXgoZmFsc2UpOwogICAgICAgICAgICB0aGlzLlNldFpJbmRpY2VzQ2hhbmdlZCgpOwogICAgICAgICAgICB0aGlzLl9TZXRNVk1hdHJpeENoYW5nZWQoKTsKICAgICAgICAgICAgdGhpcy5fU2V0UHJvamVjdGlvbk1hdHJpeENoYW5nZWQoKQogICAgICAgIH0KICAgICAgICBHZXRJTGF5ZXIoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pTGF5ZXIKICAgICAgICB9CiAgICAgICAgU29ydEFuZEFkZEluc3RhbmNlc0J5WkluZGV4KGluc3QsIHNvcnRFeGlzdGluZyA9IGZhbHNlKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9pbnN0YW5jZXMuaW5jbHVkZXMoaW5zdCkpIHsKICAgICAgICAgICAgICAgIGlmIChzb3J0RXhpc3RpbmcpIHRoaXMuX2luc3RhbmNlcy5zb3J0KChmLAogICAgICAgICAgICAgICAgICAgIHMpID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBmaXJzdFpJbmRleCA9IGYuR2V0V29ybGRJbmZvKCkuR2V0U2NlbmVHcmFwaFpJbmRleCgpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNlY29uZFpJbmRleCA9IHMuR2V0V29ybGRJbmZvKCkuR2V0U2NlbmVHcmFwaFpJbmRleCgpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBmaXJzdFpJbmRleCAtIHNlY29uZFpJbmRleAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoaW5zdC5IYXNDaGlsZHJlbigpKSB7CiAgICAgICAgICAgICAgICBjb25zdCBpbnN0YW5jZXMgPSBbLi4uaW5zdC5hbGxDaGlsZHJlbigpXTsKICAgICAgICAgICAgICAgIGluc3RhbmNlcy5wdXNoKGluc3QpOwogICAgICAgICAgICAgICAgaW5zdGFuY2VzLnNvcnQoKGYsIHMpID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBmaXJzdFpJbmRleCA9IGYuR2V0V29ybGRJbmZvKCkuR2V0U2NlbmVHcmFwaFpJbmRleCgpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNlY29uZFpJbmRleCA9IHMuR2V0V29ybGRJbmZvKCkuR2V0U2NlbmVHcmFwaFpJbmRleCgpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBmaXJzdFpJbmRleCAtIHNlY29uZFpJbmRleAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGluc3RhbmNlVG9BZGQgb2YgaW5zdGFuY2VzKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFpbnN0YW5jZVRvQWRkLklzSW5Db250YWluZXIoKSkgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBpbnN0YW5jZVRvQWRkU2libGluZyBvZiBpbnN0YW5jZVRvQWRkLnNpYmxpbmdzKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluc3RhbmNlcy5pbmNsdWRlcyhpbnN0YW5jZVRvQWRkU2libGluZykpIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzaWJsaW5nQW5kQ2hpbGRyZW4gPSBbLi4uaW5zdGFuY2VUb0FkZFNpYmxpbmcuYWxsQ2hpbGRyZW4oKV07CiAgICAgICAgICAgICAgICAgICAgICAgIHNpYmxpbmdBbmRDaGlsZHJlbi5wdXNoKGluc3RhbmNlVG9BZGRTaWJsaW5nKTsKICAgICAgICAgICAgICAgICAgICAgICAgc2libGluZ0FuZENoaWxkcmVuLnNvcnQoKGYsIHMpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGZpcnN0WkluZGV4ID0gZi5HZXRXb3JsZEluZm8oKS5HZXRTY2VuZUdyYXBoWkluZGV4KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzZWNvbmRaSW5kZXggPSBzLkdldFdvcmxkSW5mbygpLkdldFNjZW5lR3JhcGhaSW5kZXgoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmaXJzdFpJbmRleCAtIHNlY29uZFpJbmRleAogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFzaWJsaW5nQW5kQ2hpbGRyZW4gfHwgIXNpYmxpbmdBbmRDaGlsZHJlbi5sZW5ndGgpIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZXMuc3BsaWNlKGluc3RhbmNlcy5sZW5ndGgsIDAsIC4uLnNpYmxpbmdBbmRDaGlsZHJlbikKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGluc3RhbmNlIG9mIGluc3RhbmNlcykKICAgICAgICAgICAgICAgICAgICBpZiAoaW5zdGFuY2UuR2V0UGx1Z2luKCkuSXNXb3JsZFR5cGUoKSkgdGhpcy5fQWRkSW5zdGFuY2UoaW5zdGFuY2UsCiAgICAgICAgICAgICAgICAgICAgICAgIHRydWUpCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAoaW5zdC5HZXRQbHVnaW4oKS5Jc1dvcmxkVHlwZSgpKSB0aGlzLl9BZGRJbnN0YW5jZShpbnN0LCB0cnVlKTsKICAgICAgICAgICAgICAgIGlmICghaW5zdC5Jc0luQ29udGFpbmVyKCkpIHJldHVybjsKICAgICAgICAgICAgICAgIGZvciAoY29uc3Qgc2libGluZyBvZiBpbnN0LnNpYmxpbmdzKCkpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBzaWJsaW5nQW5kQ2hpbGRyZW4gPSBbLi4uc2libGluZy5hbGxDaGlsZHJlbigpXTsKICAgICAgICAgICAgICAgICAgICBzaWJsaW5nQW5kQ2hpbGRyZW4ucHVzaChzaWJsaW5nKTsKICAgICAgICAgICAgICAgICAgICBzaWJsaW5nQW5kQ2hpbGRyZW4uc29ydCgoZiwgcykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmaXJzdFpJbmRleCA9IGYuR2V0V29ybGRJbmZvKCkuR2V0U2NlbmVHcmFwaFpJbmRleCgpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzZWNvbmRaSW5kZXggPSBzLkdldFdvcmxkSW5mbygpLkdldFNjZW5lR3JhcGhaSW5kZXgoKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZpcnN0WkluZGV4IC0gc2Vjb25kWkluZGV4CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFzaWJsaW5nQW5kQ2hpbGRyZW4gfHwgIXNpYmxpbmdBbmRDaGlsZHJlbi5sZW5ndGgpIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgaW5zdGFuY2Ugb2Ygc2libGluZ0FuZENoaWxkcmVuKQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5zdGFuY2UuR2V0UGx1Z2luKCkuSXNXb3JsZFR5cGUoKSkgdGhpcy5fQWRkSW5zdGFuY2UoaW5zdGFuY2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnVlKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKCn0KCi8vIGxheW91dHMvbGF5b3V0LmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIGNvbnN0IEMzRGVidWdnZXIgPSBzZWxmLkMzRGVidWdnZXI7CiAgICBjb25zdCBhc3NlcnQgPSBzZWxmLmFzc2VydDsKICAgIGNvbnN0IHRlbXBEZXN0UmVjdCA9IEMzLk5ldyhDMy5SZWN0KTsKICAgIGNvbnN0IHRlbXBTcmNSZWN0ID0gQzMuTmV3KEMzLlJlY3QpOwogICAgY29uc3QgdGVtcExheW91dFJlY3QgPSBDMy5OZXcoQzMuUmVjdCk7CiAgICBjb25zdCB0ZW1wQ29sb3IgPSBDMy5OZXcoQzMuQ29sb3IpOwogICAgY29uc3QgZ2xNYXRyaXggPSBzZWxmLmdsTWF0cml4OwogICAgY29uc3QgdmVjMyA9IGdsTWF0cml4LnZlYzM7CiAgICBjb25zdCB0ZW1wUmVuZGVyM2RMaXN0ID0gW107CiAgICBjb25zdCB0ZW1wSW5zdGFuY2VMaXN0MSA9IFtdOwogICAgY29uc3QgdGVtcEluc3RhbmNlTGlzdDIgPSBbXTsKICAgIGNvbnN0IHRlbXBJbnN0YW5jZUxpc3QzID0gW107CgogICAgZnVuY3Rpb24gdmVjM0VxdWFsc1hZWih2LCB4LCB5LCB6KSB7CiAgICAgICAgcmV0dXJuIHZbMF0gPT09IE1hdGguZnJvdW5kKHgpICYmIHZbMV0gPT09IE1hdGguZnJvdW5kKHkpICYmIHZbMl0gPT09IE1hdGguZnJvdW5kKHopCiAgICB9CiAgICBsZXQgbGFzdExheWVyUHJlcGFyZWRGb3JEcmF3aW5nID0gbnVsbDsKCiAgICBmdW5jdGlvbiBNYXliZVByZXBhcmVMYXllckRyYXcobGF5ZXIsIHJlbmRlcmVyKSB7CiAgICAgICAgaWYgKGxhc3RMYXllclByZXBhcmVkRm9yRHJhd2luZyA9PT0gbGF5ZXIpIHJldHVybjsKICAgICAgICBsYXllci5QcmVwYXJlRm9yRHJhdyhyZW5kZXJlcik7CiAgICAgICAgbGFzdExheWVyUHJlcGFyZWRGb3JEcmF3aW5nID0gbGF5ZXIKICAgIH0KICAgIEMzLkxheW91dCA9IGNsYXNzIExheW91dCBleHRlbmRzIEMzLkRlZmVuZGVkQmFzZSB7CiAgICAgICAgY29uc3RydWN0b3IobGF5b3V0TWFuYWdlciwgaW5kZXgsIGRhdGEpIHsKICAgICAgICAgICAgc3VwZXIoKTsKICAgICAgICAgICAgdGhpcy5fbGF5b3V0TWFuYWdlciA9IGxheW91dE1hbmFnZXI7CiAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUgPSBsYXlvdXRNYW5hZ2VyLkdldFJ1bnRpbWUoKTsKICAgICAgICAgICAgdGhpcy5fbmFtZSA9IGRhdGFbMF07CiAgICAgICAgICAgIHRoaXMuX29yaWdpbmFsV2lkdGggPSBkYXRhWzFdOwogICAgICAgICAgICB0aGlzLl9vcmlnaW5hbEhlaWdodCA9IGRhdGFbMl07CiAgICAgICAgICAgIHRoaXMuX3dpZHRoID0gZGF0YVsxXTsKICAgICAgICAgICAgdGhpcy5faGVpZ2h0ID0gZGF0YVsyXTsKICAgICAgICAgICAgdGhpcy5faXNVbmJvdW5kZWRTY3JvbGxpbmcgPSAhIWRhdGFbM107CiAgICAgICAgICAgIHRoaXMuX2lzT3J0aG9ncmFwaGljUHJvamVjdGlvbiA9ICEhZGF0YVs0XTsKICAgICAgICAgICAgdGhpcy5fdmFuaXNoaW5nUG9pbnRYID0gZGF0YVs1XTsKICAgICAgICAgICAgdGhpcy5fdmFuaXNoaW5nUG9pbnRZID0gZGF0YVs2XTsKICAgICAgICAgICAgdGhpcy5fZXZlbnRTaGVldE5hbWUgPSBkYXRhWzddOwogICAgICAgICAgICB0aGlzLl9ldmVudFNoZWV0ID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fc2lkID0gZGF0YVs4XTsKICAgICAgICAgICAgdGhpcy5faW5kZXggPQogICAgICAgICAgICAgICAgaW5kZXg7CiAgICAgICAgICAgIHRoaXMuX3Njcm9sbFggPSAwOwogICAgICAgICAgICB0aGlzLl9zY3JvbGxZID0gMDsKICAgICAgICAgICAgdGhpcy5fc2NhbGUgPSAxOwogICAgICAgICAgICB0aGlzLl9hbmdsZSA9IDA7CiAgICAgICAgICAgIHRoaXMuX2luaXRpYWxPYmplY3RDbGFzc2VzID0gbmV3IFNldDsKICAgICAgICAgICAgdGhpcy5fdGV4dHVyZUxvYWRlZFR5cGVzID0gbmV3IFNldDsKICAgICAgICAgICAgdGhpcy5fdGV4dHVyZUxvYWRQZW5kaW5nUHJvbWlzZXMgPSBuZXcgU2V0OwogICAgICAgICAgICB0aGlzLl9jcmVhdGVkSW5zdGFuY2VzID0gW107CiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZWRQZXJzaXN0ZWRJbnN0YW5jZXMgPSBbXTsKICAgICAgICAgICAgdGhpcy5fY3JlYXRlZFBlcnNpc3RlZEluc3RhbmNlc1RvRGF0YU1hcCA9IG5ldyBNYXA7CiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZWRQZXJzaXN0ZWRJbmRleFRvSW5zdGFuY2VNYXAgPSBuZXcgTWFwOwogICAgICAgICAgICB0aGlzLl9pbml0aWFsTm9uV29ybGQgPSBbXTsKICAgICAgICAgICAgdGhpcy5faXMzZENhbWVyYUVuYWJsZWQgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5fY2FtM2Rwb3NpdGlvbiA9IHZlYzMuY3JlYXRlKCk7CiAgICAgICAgICAgIHRoaXMuX2NhbTNkbG9vayA9IHZlYzMuY3JlYXRlKCk7CiAgICAgICAgICAgIHRoaXMuX2NhbTNkdXAgPSB2ZWMzLmNyZWF0ZSgpOwogICAgICAgICAgICB0aGlzLl9yb290TGF5ZXJzID0gW107CiAgICAgICAgICAgIHRoaXMuX2FsbExheWVyc0ZsYXQgPSBbXTsKICAgICAgICAgICAgdGhpcy5fbGF5ZXJzQnlOYW1lID0gbmV3IE1hcDsKICAgICAgICAgICAgdGhpcy5fbGF5ZXJzQnlTaWQgPSBuZXcgTWFwOwogICAgICAgICAgICBjb25zdCBjYW52YXNNYW5hZ2VyID0gdGhpcy5fcnVudGltZS5HZXRDYW52YXNNYW5hZ2VyKCk7CiAgICAgICAgICAgIHRoaXMuX2VmZmVjdExpc3QgPSBDMy5OZXcoQzMuRWZmZWN0TGlzdCwgdGhpcywgZGF0YVsxMV0pOwogICAgICAgICAgICB0aGlzLl9lZmZlY3RDaGFpbiA9IEMzLk5ldyhDMy5HZnguRWZmZWN0Q2hhaW4sIGNhbnZhc01hbmFnZXIuR2V0RWZmZWN0Q2hhaW5NYW5hZ2VyKCksIHsKICAgICAgICAgICAgICAgIGRyYXdDb250ZW50OiAocmVuZGVyZXIsIGVmZmVjdENoYWluKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgbGF5b3V0ID0gZWZmZWN0Q2hhaW4uR2V0Q29udGVudE9iamVjdCgpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlbmRlclN1cmZhY2UgPSBsYXlvdXQuR2V0UmVuZGVyVGFyZ2V0KCk7CiAgICAgICAgICAgICAgICAgICAgcmVuZGVyZXIuUmVzZXRDb2xvcigpOwogICAgICAgICAgICAgICAgICAgIHJlbmRlcmVyLkRyYXdSZW5kZXJUYXJnZXQocmVuZGVyU3VyZmFjZSk7CiAgICAgICAgICAgICAgICAgICAgcmVuZGVyZXIuSW52YWxpZGF0ZVJlbmRlclRhcmdldChyZW5kZXJTdXJmYWNlKTsKICAgICAgICAgICAgICAgICAgICBjYW52YXNNYW5hZ2VyLlJlbGVhc2VBZGRpdGlvbmFsUmVuZGVyVGFyZ2V0KHJlbmRlclN1cmZhY2UpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZ2V0U2hhZGVyUGFyYW1ldGVyczogaW5kZXggPT4gdGhpcy5HZXRFZmZlY3RMaXN0KCkuX0dldEVmZmVjdENoYWluU2hhZGVyUGFyYW1ldGVyc0ZvckluZGV4KGluZGV4KQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdGhpcy5fbmVlZHNSZWJ1aWxkRWZmZWN0Q2hhaW5TdGVwcyA9IHRydWU7CiAgICAgICAgICAgIHRoaXMuX3dhc0Z1bGxTY3JlZW5RdWFsaXR5TG93ID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX2N1clJlbmRlclRhcmdldCA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3BlcnNpc3REYXRhID0ge307CiAgICAgICAgICAgIHRoaXMuX3BlcnNpc3RlZEludGFuY2VzID0gbmV3IE1hcDsKICAgICAgICAgICAgdGhpcy5faXNGaXJzdFZpc2l0ID0gdHJ1ZTsKICAgICAgICAgICAgdGhpcy5faUxheW91dCA9IG5ldyBzZWxmLklMYXlvdXQodGhpcyk7CiAgICAgICAgICAgIHRoaXMuX3VzZXJTY3JpcHREaXNwYXRjaGVyID0gQzMuTmV3KEMzLkV2ZW50LkRpc3BhdGNoZXIpOwogICAgICAgICAgICBmb3IgKGNvbnN0IGxheWVyRGF0YSBvZiBkYXRhWzldKSB0aGlzLl9yb290TGF5ZXJzLnB1c2goQzMuTmV3KEMzLkxheWVyLCB0aGlzLAogICAgICAgICAgICAgICAgbnVsbCwgbGF5ZXJEYXRhKSk7CiAgICAgICAgICAgIHRoaXMuX2FsbExheWVyc0ZsYXQgPSBbLi4udGhpcy5hbGxMYXllcnMoKV07CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSB0aGlzLl9hbGxMYXllcnNGbGF0Lmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7CiAgICAgICAgICAgICAgICBjb25zdCBsYXllciA9IHRoaXMuX2FsbExheWVyc0ZsYXRbaV07CiAgICAgICAgICAgICAgICBsYXllci5fU2V0SW5kZXgoaSk7CiAgICAgICAgICAgICAgICBsYXllci5fSW5pdCgpOwogICAgICAgICAgICAgICAgdGhpcy5fbGF5ZXJzQnlOYW1lLnNldChsYXllci5HZXROYW1lKCkudG9Mb3dlckNhc2UoKSwgbGF5ZXIpOwogICAgICAgICAgICAgICAgdGhpcy5fbGF5ZXJzQnlTaWQuc2V0KGxheWVyLkdldFNJRCgpLCBsYXllcikKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IgKGNvbnN0IGluc3REYXRhIG9mIGRhdGFbMTBdKSB7CiAgICAgICAgICAgICAgICBjb25zdCBvYmplY3RDbGFzcyA9IHRoaXMuX3J1bnRpbWUuR2V0T2JqZWN0Q2xhc3NCeUluZGV4KGluc3REYXRhWzFdKTsKICAgICAgICAgICAgICAgIGlmICghb2JqZWN0Q2xhc3MpIHRocm93IG5ldyBFcnJvcigibWlzc2luZyBub253b3JsZCBvYmplY3QgY2xhc3MiKTsKICAgICAgICAgICAgICAgIGlmICghb2JqZWN0Q2xhc3MuR2V0RGVmYXVsdEluc3RhbmNlRGF0YSgpKSBvYmplY3RDbGFzcy5TZXREZWZhdWx0SW5zdGFuY2VEYXRhKGluc3REYXRhKTsKICAgICAgICAgICAgICAgIHRoaXMuX2luaXRpYWxOb25Xb3JsZC5wdXNoKGluc3REYXRhKTsKICAgICAgICAgICAgICAgIHRoaXMuX0FkZEluaXRpYWxPYmplY3RDbGFzcyhvYmplY3RDbGFzcykKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBSZWxlYXNlKCkgewogICAgICAgICAgICBmb3IgKGNvbnN0IGwgb2YgdGhpcy5fYWxsTGF5ZXJzRmxhdCkgbC5SZWxlYXNlKCk7CiAgICAgICAgICAgIEMzLmNsZWFyQXJyYXkodGhpcy5fYWxsTGF5ZXJzRmxhdCk7CiAgICAgICAgICAgIHRoaXMuX3RleHR1cmVMb2FkUGVuZGluZ1Byb21pc2VzLmNsZWFyKCk7CiAgICAgICAgICAgIHRoaXMuX2V2ZW50U2hlZXQgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9sYXlvdXRNYW5hZ2VyID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fcnVudGltZSA9IG51bGwKICAgICAgICB9CiAgICAgICAgR2V0UnVudGltZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUKICAgICAgICB9CiAgICAgICAgR2V0TmFtZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX25hbWUKICAgICAgICB9CiAgICAgICAgR2V0U0lEKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fc2lkCiAgICAgICAgfQogICAgICAgIEdldEluZGV4KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faW5kZXgKICAgICAgICB9CiAgICAgICAgR2V0RWZmZWN0TGlzdCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2VmZmVjdExpc3QKICAgICAgICB9CiAgICAgICAgR2V0RWZmZWN0Q2hhaW4oKSB7CiAgICAgICAgICAgIHRoaXMuX01heWJlUmVidWlsZEVmZmVjdENoYWluU3RlcHMoKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2VmZmVjdENoYWluCiAgICAgICAgfQogICAgICAgIF9NYXliZVJlYnVpbGRFZmZlY3RDaGFpblN0ZXBzKCkgewogICAgICAgICAgICBjb25zdCBpc0Z1bGxzY3JlZW5RdWFsaXR5TG93ID0KICAgICAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuR2V0Q2FudmFzTWFuYWdlcigpLkdldEN1cnJlbnRGdWxsc2NyZWVuU2NhbGluZ1F1YWxpdHkoKSA9PT0gImxvdyI7CiAgICAgICAgICAgIGlmICghdGhpcy5fbmVlZHNSZWJ1aWxkRWZmZWN0Q2hhaW5TdGVwcyAmJiB0aGlzLl93YXNGdWxsU2NyZWVuUXVhbGl0eUxvdyA9PT0gaXNGdWxsc2NyZWVuUXVhbGl0eUxvdyAmJiAhdGhpcy5fZWZmZWN0Q2hhaW4uTmVlZHNSZWJ1aWxkKCkpIHJldHVybjsKICAgICAgICAgICAgY29uc3QgYWN0aXZlRWZmZWN0VHlwZXMgPSB0aGlzLkdldEVmZmVjdExpc3QoKS5HZXRBY3RpdmVFZmZlY3RUeXBlcygpOwogICAgICAgICAgICB0aGlzLl9lZmZlY3RDaGFpbi5CdWlsZFN0ZXBzKGFjdGl2ZUVmZmVjdFR5cGVzLm1hcChlID0+IGUuR2V0U2hhZGVyUHJvZ3JhbSgpKSwgewogICAgICAgICAgICAgICAgaW5kZXhNYXA6IGFjdGl2ZUVmZmVjdFR5cGVzLm1hcChlID0+IGUuR2V0SW5kZXgoKSksCiAgICAgICAgICAgICAgICBmb3JjZVBvc3REcmF3OiBpc0Z1bGxzY3JlZW5RdWFsaXR5TG93LAogICAgICAgICAgICAgICAgdXNlRnVsbFN1cmZhY2U6IHRydWUKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHRoaXMuX25lZWRzUmVidWlsZEVmZmVjdENoYWluU3RlcHMgPQogICAgICAgICAgICAgICAgZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX3dhc0Z1bGxTY3JlZW5RdWFsaXR5TG93ID0gaXNGdWxsc2NyZWVuUXVhbGl0eUxvdwogICAgICAgIH0KICAgICAgICBVcGRhdGVBY3RpdmVFZmZlY3RzKCkgewogICAgICAgICAgICB0aGlzLkdldEVmZmVjdExpc3QoKS5VcGRhdGVBY3RpdmVFZmZlY3RzKCk7CiAgICAgICAgICAgIHRoaXMuX25lZWRzUmVidWlsZEVmZmVjdENoYWluU3RlcHMgPSB0cnVlCiAgICAgICAgfQogICAgICAgIEdldE1pbkxheWVyU2NhbGUoKSB7CiAgICAgICAgICAgIGxldCBtID0gdGhpcy5fYWxsTGF5ZXJzRmxhdFswXS5HZXROb3JtYWxTY2FsZSgpOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMSwgbGVuID0gdGhpcy5fYWxsTGF5ZXJzRmxhdC5sZW5ndGg7IGkgPCBsZW47ICsraSkgewogICAgICAgICAgICAgICAgY29uc3QgbGF5ZXIgPSB0aGlzLl9hbGxMYXllcnNGbGF0W2ldOwogICAgICAgICAgICAgICAgaWYgKGxheWVyLkdldFBhcmFsbGF4WCgpID09PSAwICYmIGxheWVyLkdldFBhcmFsbGF4WSgpID09PSAwKSBjb250aW51ZTsKICAgICAgICAgICAgICAgIG0gPSBNYXRoLm1pbihtLCBsYXllci5HZXROb3JtYWxTY2FsZSgpKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBtCiAgICAgICAgfQogICAgICAgIF9HZXRTY3JvbGxCb3VuZE1hcmdpbkhvcml6b250YWwoKSB7CiAgICAgICAgICAgIHJldHVybiAuNSAqIHRoaXMuX3J1bnRpbWUuR2V0Vmlld3BvcnRXaWR0aCgpIC8KICAgICAgICAgICAgICAgIHRoaXMuR2V0TWluTGF5ZXJTY2FsZSgpCiAgICAgICAgfQogICAgICAgIF9HZXRTY3JvbGxCb3VuZE1hcmdpblZlcnRpY2FsKCkgewogICAgICAgICAgICByZXR1cm4gLjUgKiB0aGlzLl9ydW50aW1lLkdldFZpZXdwb3J0SGVpZ2h0KCkgLyB0aGlzLkdldE1pbkxheWVyU2NhbGUoKQogICAgICAgIH0KICAgICAgICBHZXRTY3JvbGxMZWZ0Qm91bmQoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLklzVW5ib3VuZGVkU2Nyb2xsaW5nKCkpIHJldHVybiAtSW5maW5pdHk7CiAgICAgICAgICAgIGVsc2UgcmV0dXJuIHRoaXMuX0dldFNjcm9sbEJvdW5kTWFyZ2luSG9yaXpvbnRhbCgpCiAgICAgICAgfQogICAgICAgIEdldFNjcm9sbFJpZ2h0Qm91bmQoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLklzVW5ib3VuZGVkU2Nyb2xsaW5nKCkpIHJldHVybiBJbmZpbml0eTsKICAgICAgICAgICAgZWxzZSByZXR1cm4gdGhpcy5HZXRXaWR0aCgpIC0gdGhpcy5fR2V0U2Nyb2xsQm91bmRNYXJnaW5Ib3Jpem9udGFsKCkKICAgICAgICB9CiAgICAgICAgR2V0U2Nyb2xsVG9wQm91bmQoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLklzVW5ib3VuZGVkU2Nyb2xsaW5nKCkpIHJldHVybiAtSW5maW5pdHk7CiAgICAgICAgICAgIGVsc2UgcmV0dXJuIHRoaXMuX0dldFNjcm9sbEJvdW5kTWFyZ2luVmVydGljYWwoKQogICAgICAgIH0KICAgICAgICBHZXRTY3JvbGxCb3R0b21Cb3VuZCgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuSXNVbmJvdW5kZWRTY3JvbGxpbmcoKSkgcmV0dXJuIEluZmluaXR5OwogICAgICAgICAgICBlbHNlIHJldHVybiB0aGlzLkdldEhlaWdodCgpIC0gdGhpcy5fR2V0U2Nyb2xsQm91bmRNYXJnaW5WZXJ0aWNhbCgpCiAgICAgICAgfQogICAgICAgIFNldFNjcm9sbFgoeCkgewogICAgICAgICAgICBjb25zdCBsYm91bmQgPSB0aGlzLkdldFNjcm9sbExlZnRCb3VuZCgpOwogICAgICAgICAgICBjb25zdCByYm91bmQgPSB0aGlzLkdldFNjcm9sbFJpZ2h0Qm91bmQoKTsKICAgICAgICAgICAgaWYgKHggPiByYm91bmQpIHggPSByYm91bmQ7CiAgICAgICAgICAgIGlmICh4IDwgbGJvdW5kKSB4ID0gbGJvdW5kOwogICAgICAgICAgICBpZiAodGhpcy5fc2Nyb2xsWCAhPT0geCkgewogICAgICAgICAgICAgICAgdGhpcy5fc2Nyb2xsWCA9IHg7CiAgICAgICAgICAgICAgICB0aGlzLl9TZXRBbGxMYXllcnNNVkNoYW5nZWQoKTsKICAgICAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuVXBkYXRlUmVuZGVyKCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBHZXRTY3JvbGxYKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fc2Nyb2xsWAogICAgICAgIH0KICAgICAgICBTZXRTY3JvbGxZKHkpIHsKICAgICAgICAgICAgY29uc3QgdWJvdW5kID0gdGhpcy5HZXRTY3JvbGxUb3BCb3VuZCgpOwogICAgICAgICAgICBjb25zdCBiYm91bmQgPSB0aGlzLkdldFNjcm9sbEJvdHRvbUJvdW5kKCk7CiAgICAgICAgICAgIGlmICh5ID4gYmJvdW5kKSB5ID0gYmJvdW5kOwogICAgICAgICAgICBpZiAoeSA8IHVib3VuZCkgeSA9IHVib3VuZDsKICAgICAgICAgICAgaWYgKHRoaXMuX3Njcm9sbFkgIT09IHkpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3Njcm9sbFkgPQogICAgICAgICAgICAgICAgICAgIHk7CiAgICAgICAgICAgICAgICB0aGlzLl9TZXRBbGxMYXllcnNNVkNoYW5nZWQoKTsKICAgICAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuVXBkYXRlUmVuZGVyKCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBHZXRTY3JvbGxZKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fc2Nyb2xsWQogICAgICAgIH0KICAgICAgICBJc1VuYm91bmRlZFNjcm9sbGluZygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2lzVW5ib3VuZGVkU2Nyb2xsaW5nCiAgICAgICAgfQogICAgICAgIEJvdW5kU2Nyb2xsaW5nKCkgewogICAgICAgICAgICB0aGlzLlNldFNjcm9sbFgodGhpcy5HZXRTY3JvbGxYKCkpOwogICAgICAgICAgICB0aGlzLlNldFNjcm9sbFkodGhpcy5HZXRTY3JvbGxZKCkpOwogICAgICAgICAgICBmb3IgKGNvbnN0IGxheWVyIG9mIHRoaXMuX2FsbExheWVyc0ZsYXQpCiAgICAgICAgICAgICAgICBpZiAobGF5ZXIuSXNPd25TY3JvbGxQb3NpdGlvbkVuYWJsZWQoKSkgewogICAgICAgICAgICAgICAgICAgIGxheWVyLlNldFNjcm9sbFgobGF5ZXIuR2V0U2Nyb2xsWCgpKTsKICAgICAgICAgICAgICAgICAgICBsYXllci5TZXRTY3JvbGxZKGxheWVyLkdldFNjcm9sbFkoKSkKICAgICAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgU2V0VmFuaXNoaW5nUG9pbnRYWSh2cFgsIHZwWSkgewogICAgICAgICAgICBpZiAodGhpcy5fdmFuaXNoaW5nUG9pbnRYID09PSB2cFggJiYgdGhpcy5fdmFuaXNoaW5nUG9pbnRZID09PSB2cFkpIHJldHVybjsKICAgICAgICAgICAgdGhpcy5fdmFuaXNoaW5nUG9pbnRYID0KICAgICAgICAgICAgICAgIHZwWDsKICAgICAgICAgICAgdGhpcy5fdmFuaXNoaW5nUG9pbnRZID0gdnBZOwogICAgICAgICAgICBpZiAodGhpcy5Jc1BlcnNwZWN0aXZlUHJvamVjdGlvbigpKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9TZXRBbGxMYXllcnNQcm9qZWN0aW9uQ2hhbmdlZCgpOwogICAgICAgICAgICAgICAgdGhpcy5fU2V0QWxsTGF5ZXJzTVZDaGFuZ2VkKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9ydW50aW1lLlVwZGF0ZVJlbmRlcigpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgR2V0VmFuaXNoaW5nUG9pbnRYKCkgewogICAgICAgICAgICBpZiAodGhpcy5Jc09ydGhvZ3JhcGhpY1Byb2plY3Rpb24oKSkgcmV0dXJuIC41OwogICAgICAgICAgICBlbHNlIHJldHVybiB0aGlzLl92YW5pc2hpbmdQb2ludFgKICAgICAgICB9CiAgICAgICAgR2V0VmFuaXNoaW5nUG9pbnRZKCkgewogICAgICAgICAgICBpZiAodGhpcy5Jc09ydGhvZ3JhcGhpY1Byb2plY3Rpb24oKSkgcmV0dXJuIC41OwogICAgICAgICAgICBlbHNlIHJldHVybiB0aGlzLl92YW5pc2hpbmdQb2ludFkKICAgICAgICB9CiAgICAgICAgSGFzVmFuaXNoaW5nUG9pbnRPdXRzaWRlVmlld3BvcnQoKSB7CiAgICAgICAgICAgIGNvbnN0IHZwWCA9IHRoaXMuR2V0VmFuaXNoaW5nUG9pbnRYKCk7CiAgICAgICAgICAgIGNvbnN0IHZwWSA9IHRoaXMuR2V0VmFuaXNoaW5nUG9pbnRZKCk7CiAgICAgICAgICAgIHJldHVybiB2cFggPCAwIHx8IHZwWCA+IDEgfHwgdnBZIDwgMCB8fCB2cFkgPiAxCiAgICAgICAgfQogICAgICAgIFNldFBlcnNwZWN0aXZlUHJvamVjdGlvbigpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLl9pc09ydGhvZ3JhcGhpY1Byb2plY3Rpb24pIHJldHVybjsKICAgICAgICAgICAgdGhpcy5faXNPcnRob2dyYXBoaWNQcm9qZWN0aW9uID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX1NldEFsbExheWVyc1Byb2plY3Rpb25DaGFuZ2VkKCk7CiAgICAgICAgICAgIHRoaXMuX1NldEFsbExheWVyc01WQ2hhbmdlZCgpOwogICAgICAgICAgICB0aGlzLl9ydW50aW1lLlVwZGF0ZVJlbmRlcigpCiAgICAgICAgfQogICAgICAgIFNldE9ydGhvZ3JhcGhpY1Byb2plY3Rpb24oKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9pc09ydGhvZ3JhcGhpY1Byb2plY3Rpb24pIHJldHVybjsKICAgICAgICAgICAgdGhpcy5faXNPcnRob2dyYXBoaWNQcm9qZWN0aW9uID0gdHJ1ZTsKICAgICAgICAgICAgdGhpcy5fU2V0QWxsTGF5ZXJzUHJvamVjdGlvbkNoYW5nZWQoKTsKICAgICAgICAgICAgdGhpcy5fU2V0QWxsTGF5ZXJzTVZDaGFuZ2VkKCk7CiAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuVXBkYXRlUmVuZGVyKCkKICAgICAgICB9CiAgICAgICAgSXNPcnRob2dyYXBoaWNQcm9qZWN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faXNPcnRob2dyYXBoaWNQcm9qZWN0aW9uCiAgICAgICAgfQogICAgICAgIElzUGVyc3BlY3RpdmVQcm9qZWN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gIXRoaXMuSXNPcnRob2dyYXBoaWNQcm9qZWN0aW9uKCkKICAgICAgICB9CiAgICAgICAgU2V0M0RDYW1lcmFFbmFibGVkKGUpIHsKICAgICAgICAgICAgZSA9ICEhZTsKICAgICAgICAgICAgaWYgKHRoaXMuX2lzM2RDYW1lcmFFbmFibGVkID09PQogICAgICAgICAgICAgICAgZSkgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl9pczNkQ2FtZXJhRW5hYmxlZCA9IGU7CiAgICAgICAgICAgIHRoaXMuX1NldEFsbExheWVyc01WQ2hhbmdlZCgpOwogICAgICAgICAgICB0aGlzLl9ydW50aW1lLlVwZGF0ZVJlbmRlcigpCiAgICAgICAgfQogICAgICAgIElzM0RDYW1lcmFFbmFibGVkKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faXMzZENhbWVyYUVuYWJsZWQKICAgICAgICB9CiAgICAgICAgU2V0M0RDYW1lcmFPcmllbnRhdGlvbihjYW1YLCBjYW1ZLCBjYW1aLCBsb29rWCwgbG9va1ksIGxvb2taLCB1cFgsIHVwWSwgdXBaKSB7CiAgICAgICAgICAgIGlmICh2ZWMzRXF1YWxzWFlaKHRoaXMuX2NhbTNkcG9zaXRpb24sIGNhbVgsIGNhbVksIGNhbVopICYmIHZlYzNFcXVhbHNYWVoodGhpcy5fY2FtM2Rsb29rLCBsb29rWCwgbG9va1ksIGxvb2taKSAmJiB2ZWMzRXF1YWxzWFlaKHRoaXMuX2NhbTNkdXAsIHVwWCwgdXBZLCB1cFopKSByZXR1cm47CiAgICAgICAgICAgIHZlYzMuc2V0KHRoaXMuX2NhbTNkcG9zaXRpb24sIGNhbVgsIGNhbVksIGNhbVopOwogICAgICAgICAgICB2ZWMzLnNldCh0aGlzLl9jYW0zZGxvb2ssIGxvb2tYLCBsb29rWSwgbG9va1opOwogICAgICAgICAgICB2ZWMzLnNldCh0aGlzLl9jYW0zZHVwLCB1cFgsIHVwWSwgdXBaKTsKICAgICAgICAgICAgdGhpcy5TZXQzRENhbWVyYUNoYW5nZWQoKQogICAgICAgIH0KICAgICAgICBTZXQzRENhbWVyYUNoYW5nZWQoKSB7CiAgICAgICAgICAgIHRoaXMuX1NldEFsbExheWVyc01WQ2hhbmdlZCgpOwogICAgICAgICAgICB0aGlzLl9ydW50aW1lLlVwZGF0ZVJlbmRlcigpCiAgICAgICAgfQogICAgICAgIEdldDNEQ2FtZXJhUG9zaXRpb24oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9jYW0zZHBvc2l0aW9uCiAgICAgICAgfQogICAgICAgIEdldDNEQ2FtZXJhTG9va0F0KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fY2FtM2Rsb29rCiAgICAgICAgfQogICAgICAgIEdldDNEQ2FtZXJhVXBWZWN0b3IoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9jYW0zZHVwCiAgICAgICAgfQogICAgICAgIEdldFNjYWxlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fc2NhbGUKICAgICAgICB9CiAgICAgICAgU2V0U2NhbGUocykgewogICAgICAgICAgICBpZiAodGhpcy5fc2NhbGUgPT09IHMpIHJldHVybjsKICAgICAgICAgICAgdGhpcy5fc2NhbGUgPSBzOwogICAgICAgICAgICB0aGlzLl9TZXRBbGxMYXllcnNNVkNoYW5nZWQoKTsKICAgICAgICAgICAgdGhpcy5Cb3VuZFNjcm9sbGluZygpOwogICAgICAgICAgICB0aGlzLl9ydW50aW1lLlVwZGF0ZVJlbmRlcigpCiAgICAgICAgfQogICAgICAgIFNldEFuZ2xlKGEpIHsKICAgICAgICAgICAgYSA9IEMzLmNsYW1wQW5nbGUoYSk7CiAgICAgICAgICAgIGlmICh0aGlzLl9hbmdsZSA9PT0gYSkgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl9hbmdsZSA9IGE7CiAgICAgICAgICAgIHRoaXMuX1NldEFsbExheWVyc01WQ2hhbmdlZCgpOwogICAgICAgICAgICB0aGlzLl9ydW50aW1lLlVwZGF0ZVJlbmRlcigpCiAgICAgICAgfQogICAgICAgIEdldEFuZ2xlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fYW5nbGUKICAgICAgICB9CiAgICAgICAgR2V0V2lkdGgoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl93aWR0aAogICAgICAgIH0KICAgICAgICBTZXRXaWR0aCh3KSB7CiAgICAgICAgICAgIGlmICghaXNGaW5pdGUodykgfHwKICAgICAgICAgICAgICAgIHcgPCAxKSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuX3dpZHRoID0gdwogICAgICAgIH0KICAgICAgICBHZXRIZWlnaHQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9oZWlnaHQKICAgICAgICB9CiAgICAgICAgU2V0SGVpZ2h0KGgpIHsKICAgICAgICAgICAgaWYgKCFpc0Zpbml0ZShoKSB8fCBoIDwgMSkgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl9oZWlnaHQgPSBoCiAgICAgICAgfQogICAgICAgIEdldEV2ZW50U2hlZXQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9ldmVudFNoZWV0CiAgICAgICAgfSogYWxsTGF5ZXJzKCkgewogICAgICAgICAgICBmb3IgKGNvbnN0IHJvb3RMYXllciBvZiB0aGlzLl9yb290TGF5ZXJzKSB5aWVsZCogcm9vdExheWVyLnNlbGZBbmRBbGxTdWJMYXllcnMoKQogICAgICAgIH0KICAgICAgICBHZXRMYXllcnMoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9hbGxMYXllcnNGbGF0CiAgICAgICAgfQogICAgICAgIEdldExheWVyQ291bnQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9hbGxMYXllcnNGbGF0Lmxlbmd0aAogICAgICAgIH0KICAgICAgICBHZXRMYXllcihwKSB7CiAgICAgICAgICAgIGlmICh0eXBlb2YgcCA9PT0gIm51bWJlciIpIHJldHVybiB0aGlzLkdldExheWVyQnlJbmRleChwKTsKICAgICAgICAgICAgZWxzZSByZXR1cm4gdGhpcy5HZXRMYXllckJ5TmFtZShwLnRvU3RyaW5nKCkpCiAgICAgICAgfQogICAgICAgIEdldExheWVyQnlJbmRleChpKSB7CiAgICAgICAgICAgIGkgPSBDMy5jbGFtcChNYXRoLmZsb29yKGkpLCAwLCB0aGlzLl9hbGxMYXllcnNGbGF0Lmxlbmd0aCAtCiAgICAgICAgICAgICAgICAxKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2FsbExheWVyc0ZsYXRbaV0KICAgICAgICB9CiAgICAgICAgR2V0TGF5ZXJCeU5hbWUobmFtZSkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fbGF5ZXJzQnlOYW1lLmdldChuYW1lLnRvTG93ZXJDYXNlKCkpIHx8IG51bGwKICAgICAgICB9CiAgICAgICAgR2V0TGF5ZXJCeVNJRChzaWQpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2xheWVyc0J5U2lkLmdldChzaWQpIHx8IG51bGwKICAgICAgICB9CiAgICAgICAgX1NldEFsbExheWVyc1Byb2plY3Rpb25DaGFuZ2VkKCkgewogICAgICAgICAgICBmb3IgKGNvbnN0IGxheWVyIG9mIHRoaXMuX2FsbExheWVyc0ZsYXQpIGxheWVyLl9TZXRQcm9qZWN0aW9uTWF0cml4Q2hhbmdlZCgpCiAgICAgICAgfQogICAgICAgIF9TZXRBbGxMYXllcnNNVkNoYW5nZWQoKSB7CiAgICAgICAgICAgIGZvciAoY29uc3QgbGF5ZXIgb2YgdGhpcy5fYWxsTGF5ZXJzRmxhdCkgbGF5ZXIuX1NldE1WTWF0cml4Q2hhbmdlZCgpCiAgICAgICAgfQogICAgICAgIFNhdmVUcmFuc2Zvcm0oKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAic2Nyb2xsWCI6IHRoaXMuR2V0U2Nyb2xsWCgpLAogICAgICAgICAgICAgICAgInNjcm9sbFkiOiB0aGlzLkdldFNjcm9sbFkoKSwKICAgICAgICAgICAgICAgICJzY2FsZSI6IHRoaXMuR2V0U2NhbGUoKSwKICAgICAgICAgICAgICAgICJhbmdsZSI6IHRoaXMuR2V0QW5nbGUoKSwKICAgICAgICAgICAgICAgICJ2cFgiOiB0aGlzLkdldFZhbmlzaGluZ1BvaW50WCgpLAogICAgICAgICAgICAgICAgInZwWSI6IHRoaXMuR2V0VmFuaXNoaW5nUG9pbnRZKCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBSZXN0b3JlVHJhbnNmb3JtKHQpIHsKICAgICAgICAgICAgdGhpcy5TZXRTY3JvbGxYKHRbInNjcm9sbFgiXSk7CiAgICAgICAgICAgIHRoaXMuU2V0U2Nyb2xsWSh0WyJzY3JvbGxZIl0pOwogICAgICAgICAgICB0aGlzLlNldFNjYWxlKHRbInNjYWxlIl0pOwogICAgICAgICAgICB0aGlzLlNldEFuZ2xlKHRbImFuZ2xlIl0pOwogICAgICAgICAgICB0aGlzLlNldFZhbmlzaGluZ1BvaW50WFkodFsidnBYIl0sIHRbInZwWSJdKQogICAgICAgIH0KICAgICAgICBHZXRMYXlvdXRCYWNrZ3JvdW5kQ29sb3IoKSB7CiAgICAgICAgICAgIGxldCBmaXJzdERyYXdMYXllciA9IHRoaXMuX3Jvb3RMYXllcnMuZmlsdGVyKGwgPT4gbC5TaG91bGREcmF3KCkpWzBdOwogICAgICAgICAgICB3aGlsZSAoZmlyc3REcmF3TGF5ZXIpIHsKICAgICAgICAgICAgICAgIGlmICghZmlyc3REcmF3TGF5ZXIuSXNUcmFuc3BhcmVudCgpKSB7CiAgICAgICAgICAgICAgICAgICAgdGVtcENvbG9yLmNvcHlSZ2IoZmlyc3REcmF3TGF5ZXIuR2V0QmFja2dyb3VuZENvbG9yKCkpOwogICAgICAgICAgICAgICAgICAgIHRlbXBDb2xvci5zZXRBKDEpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0ZW1wQ29sb3IKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZmlyc3REcmF3TGF5ZXIuVXNlc093blRleHR1cmUoKSkgewogICAgICAgICAgICAgICAgICAgIHRlbXBDb2xvci5zZXRSZ2JhKDAsCiAgICAgICAgICAgICAgICAgICAgICAgIDAsIDAsIDApOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0ZW1wQ29sb3IKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGZpcnN0RHJhd0xheWVyID0gZmlyc3REcmF3TGF5ZXIuR2V0U3ViTGF5ZXJzKCkuZmlsdGVyKGwgPT4gbC5TaG91bGREcmF3KCkpWzBdCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGVtcENvbG9yLnNldFJnYmEoMCwgMCwgMCwgMCk7CiAgICAgICAgICAgIHJldHVybiB0ZW1wQ29sb3IKICAgICAgICB9CiAgICAgICAgSXNGaXJzdFZpc2l0KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faXNGaXJzdFZpc2l0CiAgICAgICAgfQogICAgICAgIF9HZXRJbml0aWFsT2JqZWN0Q2xhc3NlcygpIHsKICAgICAgICAgICAgcmV0dXJuIFsuLi50aGlzLl9pbml0aWFsT2JqZWN0Q2xhc3Nlc10KICAgICAgICB9CiAgICAgICAgX0FkZEluaXRpYWxPYmplY3RDbGFzcyhvYmplY3RDbGFzcykgewogICAgICAgICAgICBpZiAob2JqZWN0Q2xhc3MuSXNJbkNvbnRhaW5lcigpKQogICAgICAgICAgICAgICAgZm9yIChjb25zdCBjb250YWluZXJUeXBlIG9mIG9iamVjdENsYXNzLkdldENvbnRhaW5lcigpLkdldE9iamVjdFR5cGVzKCkpIHRoaXMuX2luaXRpYWxPYmplY3RDbGFzc2VzLmFkZChjb250YWluZXJUeXBlKTsKICAgICAgICAgICAgZWxzZSB0aGlzLl9pbml0aWFsT2JqZWN0Q2xhc3Nlcy5hZGQob2JqZWN0Q2xhc3MpCiAgICAgICAgfQogICAgICAgIF9HZXRUZXh0dXJlTG9hZGVkT2JqZWN0VHlwZXMoKSB7CiAgICAgICAgICAgIHJldHVybiBbLi4udGhpcy5fdGV4dHVyZUxvYWRlZFR5cGVzXQogICAgICAgIH0KICAgICAgICBfTG9hZChwcmV2aW91c0xheW91dCwKICAgICAgICAgICAgcmVuZGVyZXIpIHsKICAgICAgICAgICAgaWYgKHByZXZpb3VzTGF5b3V0ID09PSB0aGlzIHx8ICFyZW5kZXJlcikgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpOwogICAgICAgICAgICBpZiAocHJldmlvdXNMYXlvdXQpIHsKICAgICAgICAgICAgICAgIEMzLkNvcHlTZXQodGhpcy5fdGV4dHVyZUxvYWRlZFR5cGVzLCBwcmV2aW91c0xheW91dC5fdGV4dHVyZUxvYWRlZFR5cGVzKTsKICAgICAgICAgICAgICAgIHByZXZpb3VzTGF5b3V0Ll90ZXh0dXJlTG9hZGVkVHlwZXMuY2xlYXIoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IHByb21pc2VzID0gW107CiAgICAgICAgICAgIGZvciAoY29uc3Qgb2Mgb2YgdGhpcy5faW5pdGlhbE9iamVjdENsYXNzZXMpCiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX3RleHR1cmVMb2FkZWRUeXBlcy5oYXMob2MpKSB7CiAgICAgICAgICAgICAgICAgICAgcHJvbWlzZXMucHVzaChvYy5Mb2FkVGV4dHVyZXMocmVuZGVyZXIpKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZXh0dXJlTG9hZGVkVHlwZXMuYWRkKG9jKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGwocHJvbWlzZXMpCiAgICAgICAgfQogICAgICAgIGFzeW5jIE1heWJlTG9hZFRleHR1cmVzRm9yKG9iamVjdENsYXNzKSB7CiAgICAgICAgICAgIGlmIChvYmplY3RDbGFzcy5Jc0ZhbWlseSgpKSB0aHJvdyBuZXcgRXJyb3IoImNhbm5vdCBsb2FkIHRleHR1cmVzIGZvciBmYW1pbHkiKTsKICAgICAgICAgICAgY29uc3QgcmVuZGVyZXIgPSB0aGlzLl9ydW50aW1lLkdldFJlbmRlcmVyKCk7CiAgICAgICAgICAgIGlmICghcmVuZGVyZXIgfHwgcmVuZGVyZXIuSXNDb250ZXh0TG9zdCgpIHx8IHRoaXMuX3RleHR1cmVMb2FkZWRUeXBlcy5oYXMob2JqZWN0Q2xhc3MpKSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuX3RleHR1cmVMb2FkZWRUeXBlcy5hZGQob2JqZWN0Q2xhc3MpOwogICAgICAgICAgICBjb25zdCBsb2FkUHJvbWlzZSA9IG9iamVjdENsYXNzLkxvYWRUZXh0dXJlcyhyZW5kZXJlcik7CiAgICAgICAgICAgIHRoaXMuX0FkZFBlbmRpbmdUZXh0dXJlTG9hZFByb21pc2UobG9hZFByb21pc2UpOwogICAgICAgICAgICBhd2FpdCBsb2FkUHJvbWlzZTsKICAgICAgICAgICAgb2JqZWN0Q2xhc3MuT25EeW5hbWljVGV4dHVyZUxvYWRDb21wbGV0ZSgpOwogICAgICAgICAgICB0aGlzLl9ydW50aW1lLlVwZGF0ZVJlbmRlcigpCiAgICAgICAgfQogICAgICAgIF9BZGRQZW5kaW5nVGV4dHVyZUxvYWRQcm9taXNlKHByb21pc2UpIHsKICAgICAgICAgICAgdGhpcy5fdGV4dHVyZUxvYWRQZW5kaW5nUHJvbWlzZXMuYWRkKHByb21pc2UpOwogICAgICAgICAgICBwcm9taXNlLnRoZW4oKCkgPT4gdGhpcy5fdGV4dHVyZUxvYWRQZW5kaW5nUHJvbWlzZXMuZGVsZXRlKHByb21pc2UpKS5jYXRjaCgoKSA9PgogICAgICAgICAgICAgICAgdGhpcy5fdGV4dHVyZUxvYWRQZW5kaW5nUHJvbWlzZXMuZGVsZXRlKHByb21pc2UpKQogICAgICAgIH0KICAgICAgICBXYWl0Rm9yUGVuZGluZ1RleHR1cmVMb2Fkc1RvQ29tcGxldGUoKSB7CiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLmFsbChbLi4udGhpcy5fdGV4dHVyZUxvYWRQZW5kaW5nUHJvbWlzZXNdKQogICAgICAgIH0KICAgICAgICBNYXliZVVubG9hZFRleHR1cmVzRm9yKG9iamVjdENsYXNzKSB7CiAgICAgICAgICAgIGlmIChvYmplY3RDbGFzcy5Jc0ZhbWlseSgpIHx8IG9iamVjdENsYXNzLkdldEluc3RhbmNlQ291bnQoKSA+IDApIHRocm93IG5ldyBFcnJvcigiY2Fubm90IHVubG9hZCB0ZXh0dXJlcyIpOwogICAgICAgICAgICBjb25zdCByZW5kZXJlciA9IHRoaXMuX3J1bnRpbWUuR2V0UmVuZGVyZXIoKTsKICAgICAgICAgICAgaWYgKCFyZW5kZXJlciB8fCAhdGhpcy5fdGV4dHVyZUxvYWRlZFR5cGVzLmhhcyhvYmplY3RDbGFzcykpIHJldHVybjsKICAgICAgICAgICAgdGhpcy5fdGV4dHVyZUxvYWRlZFR5cGVzLmRlbGV0ZShvYmplY3RDbGFzcyk7CiAgICAgICAgICAgIG9iamVjdENsYXNzLlJlbGVhc2VUZXh0dXJlcyhyZW5kZXJlcikKICAgICAgICB9CiAgICAgICAgX1VubG9hZChuZXh0TGF5b3V0LCByZW5kZXJlcikgewogICAgICAgICAgICBpZiAobmV4dExheW91dCA9PT0KICAgICAgICAgICAgICAgIHRoaXMgfHwgIXJlbmRlcmVyKSByZXR1cm47CiAgICAgICAgICAgIGZvciAoY29uc3Qgb2Mgb2YgdGhpcy5fdGV4dHVyZUxvYWRlZFR5cGVzKQogICAgICAgICAgICAgICAgaWYgKCFvYy5Jc0dsb2JhbCgpICYmICFuZXh0TGF5b3V0Ll9pbml0aWFsT2JqZWN0Q2xhc3Nlcy5oYXMob2MpKSB7CiAgICAgICAgICAgICAgICAgICAgb2MuUmVsZWFzZVRleHR1cmVzKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGV4dHVyZUxvYWRlZFR5cGVzLmRlbGV0ZShvYykKICAgICAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgX09uUmVuZGVyZXJDb250ZXh0TG9zdCgpIHsKICAgICAgICAgICAgdGhpcy5fdGV4dHVyZUxvYWRlZFR5cGVzLmNsZWFyKCkKICAgICAgICB9CiAgICAgICAgYXN5bmMgX1N0YXJ0UnVubmluZyhpc0ZpcnN0TGF5b3V0KSB7CiAgICAgICAgICAgIGNvbnN0IHJ1bnRpbWUgPSB0aGlzLl9ydW50aW1lOwogICAgICAgICAgICBjb25zdCBsYXlvdXRNYW5hZ2VyID0gdGhpcy5fbGF5b3V0TWFuYWdlcjsKICAgICAgICAgICAgY29uc3QgZXZlbnRTaGVldE1hbmFnZXIgPSBydW50aW1lLkdldEV2ZW50U2hlZXRNYW5hZ2VyKCk7CiAgICAgICAgICAgIGlmICh0aGlzLl9ldmVudFNoZWV0TmFtZSkgewogICAgICAgICAgICAgICAgdGhpcy5fZXZlbnRTaGVldCA9IGV2ZW50U2hlZXRNYW5hZ2VyLkdldEV2ZW50U2hlZXRCeU5hbWUodGhpcy5fZXZlbnRTaGVldE5hbWUpOwogICAgICAgICAgICAgICAgdGhpcy5fZXZlbnRTaGVldC5fVXBkYXRlRGVlcEluY2x1ZGVzKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBsYXlvdXRNYW5hZ2VyLl9TZXRNYWluUnVubmluZ0xheW91dCh0aGlzKTsKICAgICAgICAgICAgdGhpcy5fd2lkdGggPSB0aGlzLl9vcmlnaW5hbFdpZHRoOwogICAgICAgICAgICB0aGlzLl9oZWlnaHQgPSB0aGlzLl9vcmlnaW5hbEhlaWdodDsKICAgICAgICAgICAgdGhpcy5fc2Nyb2xsWCA9IHJ1bnRpbWUuR2V0T3JpZ2luYWxWaWV3cG9ydFdpZHRoKCkgLyAyOwogICAgICAgICAgICB0aGlzLl9zY3JvbGxZID0gcnVudGltZS5HZXRPcmlnaW5hbFZpZXdwb3J0SGVpZ2h0KCkgLyAyOwogICAgICAgICAgICB0aGlzLkJvdW5kU2Nyb2xsaW5nKCk7CiAgICAgICAgICAgIHRoaXMuX1NldEFsbExheWVyc1Byb2plY3Rpb25DaGFuZ2VkKCk7CiAgICAgICAgICAgIHRoaXMuX1NldEFsbExheWVyc01WQ2hhbmdlZCgpOwogICAgICAgICAgICB0aGlzLl9Nb3ZlR2xvYmFsT2JqZWN0c1RvVGhpc0xheW91dChpc0ZpcnN0TGF5b3V0KTsKICAgICAgICAgICAgdGhpcy5fcnVudGltZS5TZXRVc2luZ0NyZWF0ZVByb21pc2VzKHRydWUpOwogICAgICAgICAgICB0aGlzLl9DcmVhdGVJbml0aWFsSW5zdGFuY2VzKCk7CiAgICAgICAgICAgIGlmICghdGhpcy5faXNGaXJzdFZpc2l0KSB0aGlzLl9DcmVhdGVQZXJzaXN0ZWRJbnN0YW5jZXMoKTsKICAgICAgICAgICAgdGhpcy5fQ3JlYXRlQW5kTGlua0NvbnRhaW5lckluc3RhbmNlcyh0aGlzLl9jcmVhdGVkSW5zdGFuY2VzKTsKICAgICAgICAgICAgdGhpcy5fQ3JlYXRlQW5kTGlua0NvbnRhaW5lckluc3RhbmNlcyh0aGlzLl9jcmVhdGVkUGVyc2lzdGVkSW5zdGFuY2VzKTsKICAgICAgICAgICAgdGhpcy5fQ3JlYXRlSW5pdGlhbE5vbldvcmxkSW5zdGFuY2VzKCk7CiAgICAgICAgICAgIGxheW91dE1hbmFnZXIuQ2xlYXJQZW5kaW5nQ2hhbmdlTGF5b3V0KCk7CiAgICAgICAgICAgIHJ1bnRpbWUuRmx1c2hQZW5kaW5nSW5zdGFuY2VzKCk7CiAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuU2V0VXNpbmdDcmVhdGVQcm9taXNlcyhmYWxzZSk7CiAgICAgICAgICAgIGNvbnN0IGNyZWF0ZVByb21pc2VzID0gdGhpcy5fcnVudGltZS5HZXRDcmVhdGVQcm9taXNlcygpOwogICAgICAgICAgICBhd2FpdCBQcm9taXNlLmFsbChjcmVhdGVQcm9taXNlcyk7CiAgICAgICAgICAgIEMzLmNsZWFyQXJyYXkoY3JlYXRlUHJvbWlzZXMpOwogICAgICAgICAgICBpZiAoIXJ1bnRpbWUuSXNMb2FkaW5nU3RhdGUoKSkgewogICAgICAgICAgICAgICAgZm9yIChjb25zdCBpbnN0IG9mIHRoaXMuX2NyZWF0ZWRJbnN0YW5jZXMpIGluc3QuU2V0dXBJbml0aWFsU2NlbmVHcmFwaENvbm5lY3Rpb25zKCk7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGluc3Qgb2YgdGhpcy5fY3JlYXRlZFBlcnNpc3RlZEluc3RhbmNlcykgaW5zdC5TZXR1cFBlcnNpc3RlZFNjZW5lR3JhcGhDb25uZWN0aW9ucyh0aGlzLl9jcmVhdGVkUGVyc2lzdGVkSW5zdGFuY2VzVG9EYXRhTWFwLCB0aGlzLl9jcmVhdGVkUGVyc2lzdGVkSW5kZXhUb0luc3RhbmNlTWFwKTsKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgW3NpZFN0ciwgdHlwZURhdGFdIG9mIE9iamVjdC5lbnRyaWVzKHRoaXMuX3BlcnNpc3REYXRhKSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IG9iamVjdENsYXNzID0gdGhpcy5fcnVudGltZS5HZXRPYmplY3RDbGFzc0J5U0lEKHBhcnNlSW50KHNpZFN0ciwgMTApKTsKICAgICAgICAgICAgICAgICAgICBpZiAoIW9iamVjdENsYXNzIHx8IG9iamVjdENsYXNzLklzRmFtaWx5KCkgfHwgIW9iamVjdENsYXNzLkhhc1BlcnNpc3RCZWhhdmlvcigpKSBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICBDMy5jbGVhckFycmF5KHR5cGVEYXRhKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZm9yIChjb25zdCBpbnN0IG9mIHRoaXMuX2NyZWF0ZWRJbnN0YW5jZXMpIGluc3QuX1RyaWdnZXJPbkNyZWF0ZWQoKTsKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgaW5zdCBvZiB0aGlzLl9jcmVhdGVkUGVyc2lzdGVkSW5zdGFuY2VzKSBpbnN0Ll9UcmlnZ2VyT25DcmVhdGVkKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBDMy5jbGVhckFycmF5KHRoaXMuX2NyZWF0ZWRJbnN0YW5jZXMpOwogICAgICAgICAgICBDMy5jbGVhckFycmF5KHRoaXMuX2NyZWF0ZWRQZXJzaXN0ZWRJbnN0YW5jZXMpOwogICAgICAgICAgICB0aGlzLl9jcmVhdGVkUGVyc2lzdGVkSW5zdGFuY2VzVG9EYXRhTWFwLmNsZWFyKCk7CiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZWRQZXJzaXN0ZWRJbmRleFRvSW5zdGFuY2VNYXAuY2xlYXIoKTsKICAgICAgICAgICAgYXdhaXQgUHJvbWlzZS5hbGwoWy4uLnRoaXMuX2luaXRpYWxPYmplY3RDbGFzc2VzXS5tYXAob2MgPT4gb2MuUHJlbG9hZFRleHR1cmVzV2l0aEluc3RhbmNlcyh0aGlzLl9ydW50aW1lLkdldFJlbmRlcmVyKCkpKSk7CiAgICAgICAgICAgIGlmIChpc0ZpcnN0TGF5b3V0KSB7CiAgICAgICAgICAgICAgICBydW50aW1lLkRpc3BhdGNoZXIoKS5kaXNwYXRjaEV2ZW50KG5ldyBDMy5FdmVudCgiYmVmb3JlZmlyc3RsYXlvdXRzdGFydCIpKTsKICAgICAgICAgICAgICAgIGF3YWl0IHJ1bnRpbWUuRGlzcGF0Y2hVc2VyU2NyaXB0RXZlbnRBc3luY1dhaXQobmV3IEMzLkV2ZW50KCJiZWZvcmVwcm9qZWN0c3RhcnQiKSkKICAgICAgICAgICAgfQogICAgICAgICAgICBydW50aW1lLkRpc3BhdGNoZXIoKS5kaXNwYXRjaEV2ZW50KG5ldyBDMy5FdmVudCgiYmVmb3JlbGF5b3V0c3RhcnQiKSk7CiAgICAgICAgICAgIGF3YWl0IHRoaXMuRGlzcGF0Y2hVc2VyU2NyaXB0RXZlbnRBc3luY1dhaXQobmV3IEMzLkV2ZW50KCJiZWZvcmVsYXlvdXRzdGFydCIpKTsKICAgICAgICAgICAgaWYgKCFydW50aW1lLklzTG9hZGluZ1N0YXRlKCkpIGF3YWl0IHJ1bnRpbWUuVHJpZ2dlckFzeW5jKEMzLlBsdWdpbnMuU3lzdGVtLkNuZHMuT25MYXlvdXRTdGFydCwgbnVsbCwgbnVsbCk7CiAgICAgICAgICAgIHJ1bnRpbWUuRGlzcGF0Y2hlcigpLmRpc3BhdGNoRXZlbnQobmV3IEMzLkV2ZW50KCJhZnRlcmxheW91dHN0YXJ0IikpOwogICAgICAgICAgICBhd2FpdCB0aGlzLkRpc3BhdGNoVXNlclNjcmlwdEV2ZW50QXN5bmNXYWl0KG5ldyBDMy5FdmVudCgiYWZ0ZXJsYXlvdXRzdGFydCIpKTsKICAgICAgICAgICAgaWYgKGlzRmlyc3RMYXlvdXQpIHsKICAgICAgICAgICAgICAgIHJ1bnRpbWUuRGlzcGF0Y2hlcigpLmRpc3BhdGNoRXZlbnQobmV3IEMzLkV2ZW50KCJhZnRlcmZpcnN0bGF5b3V0c3RhcnQiKSk7CiAgICAgICAgICAgICAgICBhd2FpdCBydW50aW1lLkRpc3BhdGNoVXNlclNjcmlwdEV2ZW50QXN5bmNXYWl0KG5ldyBDMy5FdmVudCgiYWZ0ZXJwcm9qZWN0c3RhcnQiKSkKICAgICAgICAgICAgfQogICAgICAgICAgICBldmVudFNoZWV0TWFuYWdlci5fUnVuUXVldWVkVHJpZ2dlcnMobGF5b3V0TWFuYWdlcik7CiAgICAgICAgICAgIGF3YWl0IHRoaXMuV2FpdEZvclBlbmRpbmdUZXh0dXJlTG9hZHNUb0NvbXBsZXRlKCk7CiAgICAgICAgICAgIHRoaXMuX2lzRmlyc3RWaXNpdCA9IGZhbHNlCiAgICAgICAgfQogICAgICAgIF9Nb3ZlR2xvYmFsT2JqZWN0c1RvVGhpc0xheW91dChpc0ZpcnN0TGF5b3V0KSB7CiAgICAgICAgICAgIGZvciAoY29uc3Qgb2JqZWN0Q2xhc3Mgb2YgdGhpcy5fcnVudGltZS5HZXRBbGxPYmplY3RDbGFzc2VzKCkpIHsKICAgICAgICAgICAgICAgIGlmIChvYmplY3RDbGFzcy5Jc0ZhbWlseSgpIHx8ICFvYmplY3RDbGFzcy5Jc1dvcmxkVHlwZSgpKSBjb250aW51ZTsKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgaW5zdCBvZiBvYmplY3RDbGFzcy5HZXRJbnN0YW5jZXMoKSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHdpID0gaW5zdC5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBvbGRMYXllciA9IHdpLkdldExheWVyKCk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgbGF5ZXJJbmRleCA9IEMzLmNsYW1wKG9sZExheWVyLkdldEluZGV4KCksIDAsIHRoaXMuX2FsbExheWVyc0ZsYXQubGVuZ3RoIC0gMSk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgbmV3TGF5ZXIgPSB0aGlzLl9hbGxMYXllcnNGbGF0W2xheWVySW5kZXhdOwogICAgICAgICAgICAgICAgICAgIHdpLl9TZXRMYXllcihuZXdMYXllcik7CiAgICAgICAgICAgICAgICAgICAgbmV3TGF5ZXIuX01heWJlQWRkSW5zdGFuY2UoaW5zdCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIWlzRmlyc3RMYXlvdXQpCiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGxheWVyIG9mIHRoaXMuX2FsbExheWVyc0ZsYXQpIGxheWVyLl9Tb3J0SW5zdGFuY2VzQnlMYXN0Q2FjaGVkWkluZGV4KGZhbHNlKQogICAgICAgIH0KICAgICAgICBfQ3JlYXRlSW5pdGlhbEluc3RhbmNlcygpIHsKICAgICAgICAgICAgZm9yIChjb25zdCBsYXllciBvZiB0aGlzLl9hbGxMYXllcnNGbGF0KSB7CiAgICAgICAgICAgICAgICBsYXllci5DcmVhdGVJbml0aWFsSW5zdGFuY2VzKHRoaXMuX2NyZWF0ZWRJbnN0YW5jZXMpOwogICAgICAgICAgICAgICAgbGF5ZXIuX1N0YXJ0KCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBfQ3JlYXRlUGVyc2lzdGVkSW5zdGFuY2VzKCkgewogICAgICAgICAgICBsZXQgdWlkc0NoYW5nZWQgPSBmYWxzZTsKICAgICAgICAgICAgZm9yIChjb25zdCBbc2lkU3RyLCB0eXBlRGF0YV0gb2YgT2JqZWN0LmVudHJpZXModGhpcy5fcGVyc2lzdERhdGEpKSB7CiAgICAgICAgICAgICAgICBjb25zdCBvYmplY3RDbGFzcyA9IHRoaXMuX3J1bnRpbWUuR2V0T2JqZWN0Q2xhc3NCeVNJRChwYXJzZUludChzaWRTdHIsIDEwKSk7CiAgICAgICAgICAgICAgICBpZiAoIW9iamVjdENsYXNzIHx8IG9iamVjdENsYXNzLklzRmFtaWx5KCkgfHwgIW9iamVjdENsYXNzLkhhc1BlcnNpc3RCZWhhdmlvcigpKSBjb250aW51ZTsKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgaW5zdERhdGEgb2YgdHlwZURhdGEpIHsKICAgICAgICAgICAgICAgICAgICBsZXQgbGF5ZXIgPSBudWxsOwogICAgICAgICAgICAgICAgICAgIGlmIChvYmplY3RDbGFzcy5Jc1dvcmxkVHlwZSgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbnN0RGF0YS5oYXNPd25Qcm9wZXJ0eSgiaW5zdEpzb24iKSkgbGF5ZXIgPSB0aGlzLkdldExheWVyQnlTSUQoaW5zdERhdGFbImluc3RKc29uIl1bInciXVsibCJdKTsKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBsYXllciA9IHRoaXMuR2V0TGF5ZXJCeVNJRChpbnN0RGF0YVsidyJdWyJsIl0pOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWxheWVyKSBjb250aW51ZQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBjb25zdCBpbnN0ID0gdGhpcy5fcnVudGltZS5DcmVhdGVJbnN0YW5jZUZyb21EYXRhKG9iamVjdENsYXNzLCBsYXllciwgZmFsc2UsIDAsIDAsIHRydWUpOwogICAgICAgICAgICAgICAgICAgIGlmIChpbnN0RGF0YS5oYXNPd25Qcm9wZXJ0eSgiaW5zdEpzb24iKSkgaW5zdC5Mb2FkRnJvbUpzb24oaW5zdERhdGFbImluc3RKc29uIl0pOwogICAgICAgICAgICAgICAgICAgIGVsc2UgaW5zdC5Mb2FkRnJvbUpzb24oaW5zdERhdGEpOwogICAgICAgICAgICAgICAgICAgIHVpZHNDaGFuZ2VkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9jcmVhdGVkUGVyc2lzdGVkSW5zdGFuY2VzLnB1c2goaW5zdCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGluc3REYXRhLmhhc093blByb3BlcnR5KCJpbnN0SnNvbiIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2NyZWF0ZWRQZXJzaXN0ZWRJbnN0YW5jZXNUb0RhdGFNYXAuc2V0KGluc3QsIGluc3REYXRhKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fY3JlYXRlZFBlcnNpc3RlZEluZGV4VG9JbnN0YW5jZU1hcC5zZXQoaW5zdERhdGFbImluZGV4Il0sIGluc3QpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciAoY29uc3QgbGF5ZXIgb2YgdGhpcy5fYWxsTGF5ZXJzRmxhdCkgewogICAgICAgICAgICAgICAgbGF5ZXIuX1NvcnRJbnN0YW5jZXNCeUxhc3RDYWNoZWRaSW5kZXgodHJ1ZSk7CiAgICAgICAgICAgICAgICBsYXllci5TZXRaSW5kaWNlc0NoYW5nZWQoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh1aWRzQ2hhbmdlZCkgewogICAgICAgICAgICAgICAgdGhpcy5fcnVudGltZS5GbHVzaFBlbmRpbmdJbnN0YW5jZXMoKTsKICAgICAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuX1JlZnJlc2hVaWRNYXAoKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIF9DcmVhdGVBbmRMaW5rQ29udGFpbmVySW5zdGFuY2VzKGNyZWF0ZWRJbnN0YW5jZXMpIHsKICAgICAgICAgICAgZm9yIChjb25zdCBpbnN0IG9mIGNyZWF0ZWRJbnN0YW5jZXMpIHsKICAgICAgICAgICAgICAgIGlmICghaW5zdC5Jc0luQ29udGFpbmVyKCkpIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgY29uc3Qgd2kgPSBpbnN0LkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICAgICAgY29uc3QgaWlkID0gaW5zdC5HZXRJSUQoKTsKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgY29udGFpbmVyVHlwZSBvZiBpbnN0LkdldE9iamVjdENsYXNzKCkuR2V0Q29udGFpbmVyKCkub2JqZWN0VHlwZXMoKSkgewogICAgICAgICAgICAgICAgICAgIGlmIChjb250YWluZXJUeXBlID09PSBpbnN0LkdldE9iamVjdENsYXNzKCkpIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGluc3RhbmNlcyA9IGNvbnRhaW5lclR5cGUuR2V0SW5zdGFuY2VzKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGluc3RhbmNlcy5sZW5ndGggPiBpaWQpIGluc3QuX0FkZFNpYmxpbmcoaW5zdGFuY2VzW2lpZF0pOwogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBsZXQgczsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHdpKSBzID0gdGhpcy5fcnVudGltZS5DcmVhdGVJbnN0YW5jZUZyb21EYXRhKGNvbnRhaW5lclR5cGUsIHdpLkdldExheWVyKCksIHRydWUsIHdpLkdldFgoKSwgd2kuR2V0WSgpLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBzID0gdGhpcy5fcnVudGltZS5DcmVhdGVJbnN0YW5jZUZyb21EYXRhKGNvbnRhaW5lclR5cGUsIG51bGwsIHRydWUsIDAsIDAsIHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9ydW50aW1lLkZsdXNoUGVuZGluZ0luc3RhbmNlcygpOwogICAgICAgICAgICAgICAgICAgICAgICBjb250YWluZXJUeXBlLl9VcGRhdGVJSURzKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGluc3QuX0FkZFNpYmxpbmcocyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZWRJbnN0YW5jZXMucHVzaChzKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBfQ3JlYXRlSW5pdGlhbE5vbldvcmxkSW5zdGFuY2VzKCkgewogICAgICAgICAgICBmb3IgKGNvbnN0IGluc3REYXRhIG9mIHRoaXMuX2luaXRpYWxOb25Xb3JsZCkgewogICAgICAgICAgICAgICAgY29uc3Qgb2JqZWN0Q2xhc3MgPSB0aGlzLl9ydW50aW1lLkdldE9iamVjdENsYXNzQnlJbmRleChpbnN0RGF0YVsxXSk7CiAgICAgICAgICAgICAgICBpZiAoIW9iamVjdENsYXNzLklzSW5Db250YWluZXIoKSkgdGhpcy5fcnVudGltZS5DcmVhdGVJbnN0YW5jZUZyb21EYXRhKGluc3REYXRhLAogICAgICAgICAgICAgICAgICAgIG51bGwsIHRydWUpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgX0NyZWF0ZUdsb2JhbE5vbldvcmxkcygpIHsKICAgICAgICAgICAgY29uc3QgY3JlYXRlZEluc3RhbmNlcyA9IFtdOwogICAgICAgICAgICBjb25zdCBpbml0aWFsTm9uV29ybGQgPSB0aGlzLl9pbml0aWFsTm9uV29ybGQ7CiAgICAgICAgICAgIGxldCBrID0gMDsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IGluaXRpYWxOb25Xb3JsZC5sZW5ndGg7IGkgPCBsZW47ICsraSkgewogICAgICAgICAgICAgICAgY29uc3QgaW5zdERhdGEgPSBpbml0aWFsTm9uV29ybGRbaV07CiAgICAgICAgICAgICAgICBjb25zdCBvYmplY3RDbGFzcyA9IHRoaXMuX3J1bnRpbWUuR2V0T2JqZWN0Q2xhc3NCeUluZGV4KGluc3REYXRhWzFdKTsKICAgICAgICAgICAgICAgIGlmIChvYmplY3RDbGFzcy5Jc0dsb2JhbCgpKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFvYmplY3RDbGFzcy5Jc0luQ29udGFpbmVyKCkgfHwgIW9iamVjdENsYXNzLkdldENvbnRhaW5lcigpLkhhc0FueVdvcmxkVHlwZSgpKSBjcmVhdGVkSW5zdGFuY2VzLnB1c2godGhpcy5fcnVudGltZS5DcmVhdGVJbnN0YW5jZUZyb21EYXRhKGluc3REYXRhLCBudWxsLCB0cnVlKSkKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaW5pdGlhbE5vbldvcmxkW2tdID0gaW5zdERhdGE7CiAgICAgICAgICAgICAgICAgICAgKytrCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgQzMudHJ1bmNhdGVBcnJheShpbml0aWFsTm9uV29ybGQsCiAgICAgICAgICAgICAgICBrKTsKICAgICAgICAgICAgdGhpcy5fcnVudGltZS5GbHVzaFBlbmRpbmdJbnN0YW5jZXMoKTsKICAgICAgICAgICAgdGhpcy5fQ3JlYXRlQW5kTGlua0NvbnRhaW5lckluc3RhbmNlcyhjcmVhdGVkSW5zdGFuY2VzKQogICAgICAgIH0KICAgICAgICBSZWNyZWF0ZUluaXRpYWxPYmplY3RzKG9iamVjdENsYXNzLCByYywgc3JjTGF5ZXIsIG9mZnNldFgsIG9mZnNldFksIGNyZWF0ZUhpZXJhcmNoeSkgewogICAgICAgICAgICBpZiAoc3JjTGF5ZXIpIHJldHVybiBzcmNMYXllci5SZWNyZWF0ZUluaXRpYWxPYmplY3RzKG9iamVjdENsYXNzLCByYywgb2Zmc2V0WCwgb2Zmc2V0WSwgY3JlYXRlSGllcmFyY2h5KTsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBjb25zdCByZXQgPSBbXTsKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgbGF5ZXIgb2YgdGhpcy5fYWxsTGF5ZXJzRmxhdCkgcmV0LnB1c2gobGF5ZXIuUmVjcmVhdGVJbml0aWFsT2JqZWN0cyhvYmplY3RDbGFzcywgcmMsIG9mZnNldFgsIG9mZnNldFksIGNyZWF0ZUhpZXJhcmNoeSkpOwogICAgICAgICAgICAgICAgcmV0dXJuIHJldC5mbGF0KCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBhc3luYyBfU3RvcFJ1bm5pbmcoKSB7CiAgICAgICAgICAgIGNvbnN0IGxheW91dE1hbmFnZXIgPSB0aGlzLl9sYXlvdXRNYW5hZ2VyOwogICAgICAgICAgICBpZiAoIXRoaXMuX3J1bnRpbWUuSXNMb2FkaW5nU3RhdGUoKSkgewogICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5EaXNwYXRjaFVzZXJTY3JpcHRFdmVudEFzeW5jV2FpdChuZXcgQzMuRXZlbnQoImJlZm9yZWxheW91dGVuZCIpKTsKICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuX3J1bnRpbWUuVHJpZ2dlckFzeW5jKEMzLlBsdWdpbnMuU3lzdGVtLkNuZHMuT25MYXlvdXRFbmQsIG51bGwsIG51bGwpOwogICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5EaXNwYXRjaFVzZXJTY3JpcHRFdmVudEFzeW5jV2FpdChuZXcgQzMuRXZlbnQoImFmdGVybGF5b3V0ZW5kIikpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGF5b3V0TWFuYWdlci5TZXRJc0VuZGluZ0xheW91dCh0cnVlKTsKICAgICAgICAgICAgdGhpcy5fcnVudGltZS5HZXRFdmVudFNoZWV0TWFuYWdlcigpLkNsZWFyQWxsU2NoZWR1bGVkV2FpdHMoKTsKICAgICAgICAgICAgaWYgKCF0aGlzLl9pc0ZpcnN0VmlzaXQpIHRoaXMuX1NhdmVQZXJzaXN0RGF0YSgpOwogICAgICAgICAgICBmb3IgKGNvbnN0IGxheWVyIG9mIHRoaXMuX2FsbExheWVyc0ZsYXQpIGxheWVyLl9FbmQoKTsKICAgICAgICAgICAgZm9yIChjb25zdCBvYmplY3RDbGFzcyBvZiB0aGlzLl9ydW50aW1lLkdldEFsbE9iamVjdENsYXNzZXMoKSkgewogICAgICAgICAgICAgICAgaWYgKG9iamVjdENsYXNzLklzR2xvYmFsKCkgfHwgb2JqZWN0Q2xhc3MuSXNXb3JsZFR5cGUoKSB8fCBvYmplY3RDbGFzcy5HZXRQbHVnaW4oKS5Jc1NpbmdsZUdsb2JhbCgpIHx8CiAgICAgICAgICAgICAgICAgICAgb2JqZWN0Q2xhc3MuSXNGYW1pbHkoKSkgY29udGludWU7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGluc3Qgb2Ygb2JqZWN0Q2xhc3MuR2V0SW5zdGFuY2VzKCkpIHRoaXMuX3J1bnRpbWUuRGVzdHJveUluc3RhbmNlKGluc3QpOwogICAgICAgICAgICAgICAgdGhpcy5fcnVudGltZS5GbHVzaFBlbmRpbmdJbnN0YW5jZXMoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGxheW91dE1hbmFnZXIuU2V0SXNFbmRpbmdMYXlvdXQoZmFsc2UpOwogICAgICAgICAgICBpZiAobGF5b3V0TWFuYWdlci5HZXRNYWluUnVubmluZ0xheW91dCgpID09PSB0aGlzKSBsYXlvdXRNYW5hZ2VyLl9TZXRNYWluUnVubmluZ0xheW91dChudWxsKQogICAgICAgIH0KICAgICAgICBfU2F2ZUluc3RhbmNlVG9QZXJzaXN0KGluc3QsIGluZGV4KSB7CiAgICAgICAgICAgIGNvbnN0IHNpZFN0ciA9IGluc3QuR2V0T2JqZWN0Q2xhc3MoKS5HZXRTSUQoKS50b1N0cmluZygpOwogICAgICAgICAgICBpZiAoIXRoaXMuX3BlcnNpc3REYXRhLmhhc093blByb3BlcnR5KHNpZFN0cikpIHRoaXMuX3BlcnNpc3REYXRhW3NpZFN0cl0gPSBbXTsKICAgICAgICAgICAgY29uc3QgdHlwZVBlcnNpc3QgPSB0aGlzLl9wZXJzaXN0RGF0YVtzaWRTdHJdOwogICAgICAgICAgICBjb25zdCBwZXJzaXN0RGF0YSA9IHsKICAgICAgICAgICAgICAgICJpbmRleCI6IGluZGV4LAogICAgICAgICAgICAgICAgImluc3RKc29uIjogaW5zdC5TYXZlVG9Kc29uKCksCiAgICAgICAgICAgICAgICAic2NlbmVHcmFwaEpzb24iOiB7CiAgICAgICAgICAgICAgICAgICAgImNoaWxkcmVuIjogW10KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICAgICAgdHlwZVBlcnNpc3QucHVzaChwZXJzaXN0RGF0YSk7CiAgICAgICAgICAgIHRoaXMuX3BlcnNpc3RlZEludGFuY2VzLnNldChpbnN0LCBwZXJzaXN0RGF0YSkKICAgICAgICB9CiAgICAgICAgX1NhdmVTY2VuZUdyYXBoSW5mb1RvUGVyc2lzdChpbnN0KSB7CiAgICAgICAgICAgIGNvbnN0IHBlcnNpc3REYXRhID0gdGhpcy5fcGVyc2lzdGVkSW50YW5jZXMuZ2V0KGluc3QpOwogICAgICAgICAgICBmb3IgKGNvbnN0IGNoaWxkIG9mIGluc3QuR2V0Q2hpbGRyZW4oKSkgewogICAgICAgICAgICAgICAgY29uc3QgY2hpbGRQZXJzaXN0RGF0YSA9IHRoaXMuX3BlcnNpc3RlZEludGFuY2VzLmdldChjaGlsZCk7CiAgICAgICAgICAgICAgICBpZiAoY2hpbGRQZXJzaXN0RGF0YSkgcGVyc2lzdERhdGFbInNjZW5lR3JhcGhKc29uIl1bImNoaWxkcmVuIl0ucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgImluZGV4IjogY2hpbGRQZXJzaXN0RGF0YVsiaW5kZXgiXSwKICAgICAgICAgICAgICAgICAgICAiZmxhZ3MiOiBDMy5TY2VuZUdyYXBoSW5mby5fR2V0RmxhZ3NOdW1iZXIoY2hpbGQuR2V0V29ybGRJbmZvKCkpCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIF9TYXZlUGVyc2lzdERhdGEoKSB7CiAgICAgICAgICAgIHRoaXMuX3BlcnNpc3RlZEludGFuY2VzLmNsZWFyKCk7CiAgICAgICAgICAgIGxldCBwZXJzaXNEYXRhSW5kZXggPSAwOwogICAgICAgICAgICBmb3IgKGNvbnN0IGxheWVyIG9mIHRoaXMuX2FsbExheWVyc0ZsYXQpIHsKICAgICAgICAgICAgICAgIGxheWVyLl9VcGRhdGVaSW5kaWNlcygpOwogICAgICAgICAgICAgICAgZm9yIChjb25zdCBpbnN0IG9mIGxheWVyLl9HZXRJbnN0YW5jZXMoKSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IG9iamVjdENsYXNzID0gaW5zdC5HZXRPYmplY3RDbGFzcygpOwogICAgICAgICAgICAgICAgICAgIGlmICghb2JqZWN0Q2xhc3MuSXNHbG9iYWwoKSAmJiBvYmplY3RDbGFzcy5IYXNQZXJzaXN0QmVoYXZpb3IoKSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9TYXZlSW5zdGFuY2VUb1BlcnNpc3QoaW5zdCwgcGVyc2lzRGF0YUluZGV4KTsKICAgICAgICAgICAgICAgICAgICAgICAgcGVyc2lzRGF0YUluZGV4KysKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yIChjb25zdCBsYXllciBvZiB0aGlzLl9hbGxMYXllcnNGbGF0KQogICAgICAgICAgICAgICAgZm9yIChjb25zdCBpbnN0IG9mIGxheWVyLl9HZXRJbnN0YW5jZXMoKSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IG9iamVjdENsYXNzID0gaW5zdC5HZXRPYmplY3RDbGFzcygpOwogICAgICAgICAgICAgICAgICAgIGlmICghb2JqZWN0Q2xhc3MuSXNHbG9iYWwoKSAmJiBvYmplY3RDbGFzcy5IYXNQZXJzaXN0QmVoYXZpb3IoKSkgdGhpcy5fU2F2ZVNjZW5lR3JhcGhJbmZvVG9QZXJzaXN0KGluc3QpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuX3BlcnNpc3RlZEludGFuY2VzLmNsZWFyKCkKICAgICAgICB9CiAgICAgICAgUmVzZXRQZXJzaXN0RGF0YSgpIHsKICAgICAgICAgICAgdGhpcy5fcGVyc2lzdERhdGEgPSB7fTsKICAgICAgICAgICAgdGhpcy5faXNGaXJzdFZpc2l0ID0gdHJ1ZQogICAgICAgIH0KICAgICAgICBHZXRSZW5kZXJUYXJnZXQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9jdXJSZW5kZXJUYXJnZXQKICAgICAgICB9CiAgICAgICAgVXNlc093blRleHR1cmUoKSB7CiAgICAgICAgICAgIGNvbnN0IHJ1bnRpbWUgPSB0aGlzLl9ydW50aW1lOwogICAgICAgICAgICBjb25zdCBpc1dlYkdMID0gcnVudGltZS5HZXRSZW5kZXJlcigpLklzV2ViR0woKTsKICAgICAgICAgICAgcmV0dXJuIHJ1bnRpbWUuR2V0Q2FudmFzTWFuYWdlcigpLkdldEN1cnJlbnRGdWxsc2NyZWVuU2NhbGluZ1F1YWxpdHkoKSA9PT0gImxvdyIgfHwgaXNXZWJHTCAmJiBydW50aW1lLlVzZXNBbnlCYWNrZ3JvdW5kQmxlbmRpbmcoKSB8fCBydW50aW1lLkdldENvbXBvc2l0aW5nTW9kZSgpID09PSAibG93LWxhdGVuY3kiIHx8IHRoaXMuX2VmZmVjdExpc3QuSGFzQW55QWN0aXZlRWZmZWN0KCkgfHwgaXNXZWJHTCAmJiBydW50aW1lLlVzZXMzREZlYXR1cmVzKCkKICAgICAgICB9CiAgICAgICAgRHJhdyhyZW5kZXJlcikgewogICAgICAgICAgICBjb25zdCBjYW52YXNNYW5hZ2VyID0gdGhpcy5fcnVudGltZS5HZXRDYW52YXNNYW5hZ2VyKCk7CiAgICAgICAgICAgIGNvbnN0IHVzZU93blRleHR1cmUgPSB0aGlzLlVzZXNPd25UZXh0dXJlKCk7CiAgICAgICAgICAgIGlmICh1c2VPd25UZXh0dXJlKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fcnVudGltZS5HZXRDb21wb3NpdGluZ01vZGUoKSAhPT0gImxvdy1sYXRlbmN5IikgewogICAgICAgICAgICAgICAgICAgIHJlbmRlcmVyLlNldFJlbmRlclRhcmdldChudWxsKTsKICAgICAgICAgICAgICAgICAgICByZW5kZXJlci5DbGVhclJnYmEoMCwgMCwgMCwgMCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNvbnN0IHJ0T3B0cyA9IHsKICAgICAgICAgICAgICAgICAgICBzYW1wbGluZzogdGhpcy5fcnVudGltZS5HZXRTYW1wbGluZygpLAogICAgICAgICAgICAgICAgICAgIGlzU2FtcGxlZDogcmVuZGVyZXIuSXNXZWJHUFUoKSB8fCB0aGlzLl9ydW50aW1lLlVzZXNBbnlCYWNrZ3JvdW5kQmxlbmRpbmcoKSB8fCB0aGlzLl9lZmZlY3RMaXN0Lkhhc0FueUFjdGl2ZUVmZmVjdCgpLAogICAgICAgICAgICAgICAgICAgIGNhblJlYWRQaXhlbHM6IHJlbmRlcmVyLklzV2ViR1BVKCkgPyB0aGlzLl9ydW50aW1lLlVzZXNBbnlCYWNrZ3JvdW5kQmxlbmRpbmcoKSA6IGZhbHNlCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgaWYgKGNhbnZhc01hbmFnZXIuR2V0Q3VycmVudEZ1bGxzY3JlZW5TY2FsaW5nUXVhbGl0eSgpID09PSAibG93IikgewogICAgICAgICAgICAgICAgICAgIHJ0T3B0cy53aWR0aCA9IGNhbnZhc01hbmFnZXIuR2V0RHJhd1dpZHRoKCk7CiAgICAgICAgICAgICAgICAgICAgcnRPcHRzLmhlaWdodCA9IGNhbnZhc01hbmFnZXIuR2V0RHJhd0hlaWdodCgpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLl9jdXJSZW5kZXJUYXJnZXQgPQogICAgICAgICAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuR2V0QWRkaXRpb25hbFJlbmRlclRhcmdldChydE9wdHMpCiAgICAgICAgICAgIH0gZWxzZSB0aGlzLl9jdXJSZW5kZXJUYXJnZXQgPSBudWxsOwogICAgICAgICAgICByZW5kZXJlci5TZXRSZW5kZXJUYXJnZXQodGhpcy5fY3VyUmVuZGVyVGFyZ2V0KTsKICAgICAgICAgICAgcmVuZGVyZXIuQ2xlYXIodGhpcy5HZXRMYXlvdXRCYWNrZ3JvdW5kQ29sb3IoKSk7CiAgICAgICAgICAgIGlmICh0aGlzLl9ydW50aW1lLlVzZXMzREZlYXR1cmVzKCkpIHJlbmRlcmVyLkNsZWFyRGVwdGgoKTsKICAgICAgICAgICAgdGhpcy5fRHJhd0xheWVyTGlzdChyZW5kZXJlciwgdGhpcy5fY3VyUmVuZGVyVGFyZ2V0LCB0aGlzLl9yb290TGF5ZXJzLCB0cnVlKTsKICAgICAgICAgICAgaWYgKHVzZU93blRleHR1cmUpIHsKICAgICAgICAgICAgICAgIHJlbmRlcmVyLlNldERlcHRoRW5hYmxlZChmYWxzZSk7CiAgICAgICAgICAgICAgICB0aGlzLl9EcmF3TGF5b3V0T3duVGV4dHVyZVRvUmVuZGVyVGFyZ2V0KHJlbmRlcmVyLCB0aGlzLl9jdXJSZW5kZXJUYXJnZXQpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5fY3VyUmVuZGVyVGFyZ2V0ID0gbnVsbAogICAgICAgIH0KICAgICAgICBfRHJhd0xheWVyTGlzdChyZW5kZXJlciwgZGVzdFJlbmRlclRhcmdldCwgbGF5ZXJzQXJyLAogICAgICAgICAgICBjYW5Db3B5Rmlyc3RMYXllcikgewogICAgICAgICAgICBjb25zdCBsYXllcnNUb0RyYXcgPSBsYXllcnNBcnIuZmlsdGVyKGwgPT4gbC5TaG91bGREcmF3KCkpOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gbGF5ZXJzVG9EcmF3Lmxlbmd0aDsgaSA8IGxlbjspIHsKICAgICAgICAgICAgICAgIGNvbnN0IGxheWVyID0gbGF5ZXJzVG9EcmF3W2ldOwogICAgICAgICAgICAgICAgaWYgKGxheWVyLlNlbGZBbmRBbGxTdWJMYXllcnNIYXZlM0RDYW1lcmEoKSAmJiAhbGF5ZXIuU2VsZk9yQW55U3ViTGF5ZXJVc2VzT3duVGV4dHVyZSgpKSB7CiAgICAgICAgICAgICAgICAgICAgdGVtcFJlbmRlcjNkTGlzdC5wdXNoKGxheWVyKTsKICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBqID0gaSArIDE7IGogPCBsZW47ICsraikgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXh0TGF5ZXIgPSBsYXllcnNUb0RyYXdbal07CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuZXh0TGF5ZXIuU2VsZkFuZEFsbFN1YkxheWVyc0hhdmUzRENhbWVyYSgpICYmICFuZXh0TGF5ZXIuU2VsZk9yQW55U3ViTGF5ZXJVc2VzT3duVGV4dHVyZSgpKSB0ZW1wUmVuZGVyM2RMaXN0LnB1c2gobGF5ZXJzVG9EcmF3W2pdKTsKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBicmVhawogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAodGVtcFJlbmRlcjNkTGlzdC5sZW5ndGggPj0gMiB8fCB0ZW1wUmVuZGVyM2RMaXN0Lmxlbmd0aCA9PT0KICAgICAgICAgICAgICAgICAgICAgICAgMSAmJiB0ZW1wUmVuZGVyM2RMaXN0WzBdLkhhc0FueVZpc2libGVTdWJMYXllcigpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX0RyYXczRExheWVycyhyZW5kZXJlciwgZGVzdFJlbmRlclRhcmdldCwgdGVtcFJlbmRlcjNkTGlzdCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGkgKz0gdGVtcFJlbmRlcjNkTGlzdC5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgICAgIEMzLmNsZWFyQXJyYXkodGVtcFJlbmRlcjNkTGlzdCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIEMzLmNsZWFyQXJyYXkodGVtcFJlbmRlcjNkTGlzdCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGxheWVyLkRyYXcocmVuZGVyZXIsIGRlc3RSZW5kZXJUYXJnZXQsIGNhbkNvcHlGaXJzdExheWVyICYmIGkgPT09IDApOwogICAgICAgICAgICAgICAgKytpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgX0RyYXdMYXlvdXRPd25UZXh0dXJlVG9SZW5kZXJUYXJnZXQocmVuZGVyZXIsIG93blJlbmRlclRhcmdldCkgewogICAgICAgICAgICBjb25zdCBhY3RpdmVFZmZlY3RUeXBlcyA9IHRoaXMuX2VmZmVjdExpc3QuR2V0QWN0aXZlRWZmZWN0VHlwZXMoKTsKICAgICAgICAgICAgY29uc3QgcnVudGltZSA9IHRoaXMuX3J1bnRpbWU7CiAgICAgICAgICAgIGlmIChhY3RpdmVFZmZlY3RUeXBlcy5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICAgIHJlbmRlcmVyLlNldFJlbmRlclRhcmdldChudWxsKTsKICAgICAgICAgICAgICAgIHJlbmRlcmVyLlNldFRleHR1cmVGaWxsTW9kZSgpOwogICAgICAgICAgICAgICAgcmVuZGVyZXIuQ29weVJlbmRlclRhcmdldChvd25SZW5kZXJUYXJnZXQpOwogICAgICAgICAgICAgICAgcmVuZGVyZXIuSW52YWxpZGF0ZVJlbmRlclRhcmdldChvd25SZW5kZXJUYXJnZXQpOwogICAgICAgICAgICAgICAgcnVudGltZS5SZWxlYXNlQWRkaXRpb25hbFJlbmRlclRhcmdldChvd25SZW5kZXJUYXJnZXQpCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0ZW1wTGF5b3V0UmVjdC5zZXQoMCwgMCwgcnVudGltZS5HZXRWaWV3cG9ydFdpZHRoKCksIHJ1bnRpbWUuR2V0Vmlld3BvcnRIZWlnaHQoKSk7CiAgICAgICAgICAgICAgICB0aGlzLkdldEVmZmVjdENoYWluKCkuUmVuZGVyKHJlbmRlcmVyLCBudWxsLCB7CiAgICAgICAgICAgICAgICAgICAgY29udGVudE9iamVjdDogdGhpcywKICAgICAgICAgICAgICAgICAgICBibGVuZE1vZGU6IDMsCiAgICAgICAgICAgICAgICAgICAgZGV2aWNlUGl4ZWxSYXRpbzogdGhpcy5fcnVudGltZS5HZXRFZmZlY3REZXZpY2VQaXhlbFJhdGlvUGFyYW0oKSwKICAgICAgICAgICAgICAgICAgICBsYXllclNjYWxlOiB0aGlzLl9ydW50aW1lLkdldEVmZmVjdExheWVyU2NhbGVQYXJhbSgpICogdGhpcy5HZXRTY2FsZSgpLAogICAgICAgICAgICAgICAgICAgIGxheWVyQW5nbGU6IHRoaXMuR2V0QW5nbGUoKSwKICAgICAgICAgICAgICAgICAgICBsYXlvdXRSZWN0OiB0ZW1wTGF5b3V0UmVjdCwKICAgICAgICAgICAgICAgICAgICBkcmF3U3VyZmFjZVJlY3Q6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgaW52YWxpZGF0ZVJlbmRlclRhcmdldHM6IHRydWUKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgX0RyYXczRExheWVycyhyZW5kZXJlciwgcmVuZGVyVGFyZ2V0LCBsYXllckxpc3QpIHsKICAgICAgICAgICAgaWYgKCFsYXllckxpc3RbMF0uSXNUcmFuc3BhcmVudCgpKSB7CiAgICAgICAgICAgICAgICB0ZW1wQ29sb3IuY29weVJnYihsYXllckxpc3RbMF0uR2V0QmFja2dyb3VuZENvbG9yKCkpOwogICAgICAgICAgICAgICAgdGVtcENvbG9yLnNldEEoMSk7CiAgICAgICAgICAgICAgICByZW5kZXJlci5DbGVhcih0ZW1wQ29sb3IpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgY2FudmFzTWFuYWdlciA9IHRoaXMuX3J1bnRpbWUuR2V0Q2FudmFzTWFuYWdlcigpOwogICAgICAgICAgICByZW5kZXJlci5TZXREZXB0aEVuYWJsZWQodHJ1ZSk7CiAgICAgICAgICAgIGNvbnN0IGZ1bGxJbnN0YW5jZUxpc3QgPSB0ZW1wSW5zdGFuY2VMaXN0MTsKICAgICAgICAgICAgY29uc3QgY29wbGFuYXJJbnN0YW5jZXMgPSB0ZW1wSW5zdGFuY2VMaXN0MjsKICAgICAgICAgICAgY29uc3QgcG9zdFJlbmRlckluc3RhbmNlcyA9IHRlbXBJbnN0YW5jZUxpc3QzOwogICAgICAgICAgICBmb3IgKGNvbnN0IGxheWVyIG9mIGxheWVyTGlzdCkgewogICAgICAgICAgICAgICAgbGF5ZXIuX1VwZGF0ZVpJbmRpY2VzKCk7CiAgICAgICAgICAgICAgICBsYXllci5fQXBwZW5kQWxsSW5zdGFuY2VzSW5jbHVkaW5nU3ViTGF5ZXJzSW5EcmF3T3JkZXIoZnVsbEluc3RhbmNlTGlzdCkKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBmaXJzdExheWVyID0KICAgICAgICAgICAgICAgIGxheWVyTGlzdFswXTsKICAgICAgICAgICAgbGV0IGxheWVyUXVlcnkgPSBudWxsOwogICAgICAgICAgICBpZiAodGhpcy5fcnVudGltZS5Jc0dQVVByb2ZpbGluZygpKQogICAgICAgICAgICAgICAgaWYgKHJlbmRlcmVyLklzV2ViR0woKSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHRpbWluZ3NCdWZmZXIgPSBjYW52YXNNYW5hZ2VyLkdldExheWVyVGltaW5nc0J1ZmZlcihmaXJzdExheWVyKTsKICAgICAgICAgICAgICAgICAgICBpZiAodGltaW5nc0J1ZmZlcikgewogICAgICAgICAgICAgICAgICAgICAgICBsYXllclF1ZXJ5ID0gdGltaW5nc0J1ZmZlci5BZGRUaW1lRWxhcHNlZFF1ZXJ5KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlbmRlcmVyLlN0YXJ0UXVlcnkobGF5ZXJRdWVyeSkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlbmRlcmVyLklzV2ViR1BVKCkpIHJlbmRlcmVyLldyaXRlVGltZXN0YW1wKChmaXJzdExheWVyLkdldEluZGV4KCkgKyAxKSAqIDIpOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gZnVsbEluc3RhbmNlTGlzdC5sZW5ndGg7IGkgPCBsZW47KSB7CiAgICAgICAgICAgICAgICBjb25zdCBpbnN0ID0gZnVsbEluc3RhbmNlTGlzdFtpXTsKICAgICAgICAgICAgICAgIGNvbnN0IHdpID0gaW5zdC5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgICAgIGNvbnN0IHdpTGF5ZXIgPSB3aS5HZXRMYXllcigpOwogICAgICAgICAgICAgICAgaWYgKCF3aS5Jc1Zpc2libGUoKSB8fCAhd2kuSXNJblZpZXdwb3J0M0Qod2lMYXllci5fR2V0Vmlld0ZydXN0dW0oKSkpIHsKICAgICAgICAgICAgICAgICAgICArK2k7CiAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICghaW5zdC5SZW5kZXJzVG9Pd25aUGxhbmUoKSB8fCB3aS5HZXREZXB0aCgpID4gMCkgcG9zdFJlbmRlckluc3RhbmNlcy5wdXNoKGluc3QpOwogICAgICAgICAgICAgICAgY29uc3Qgc3RhcnRaID0gaW5zdC5HZXRXb3JsZEluZm8oKS5HZXRUb3RhbFpFbGV2YXRpb24oKTsKICAgICAgICAgICAgICAgIGNvcGxhbmFySW5zdGFuY2VzLnB1c2goaW5zdCk7CiAgICAgICAgICAgICAgICBsZXQgZW5kSW5kZXggPSBpICsgMTsKICAgICAgICAgICAgICAgIGZvciAoOyBlbmRJbmRleCA8IGxlbjsgKytlbmRJbmRleCkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IG5leHRJbnN0ID0gZnVsbEluc3RhbmNlTGlzdFtlbmRJbmRleF07CiAgICAgICAgICAgICAgICAgICAgY29uc3QgbmV4dFdpID0gbmV4dEluc3QuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFuZXh0V2kuSXNWaXNpYmxlKCkgfHwgIW5leHRXaS5Jc0luVmlld3BvcnQzRChuZXh0V2kuR2V0TGF5ZXIoKS5fR2V0Vmlld0ZydXN0dW0oKSkpIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgIGlmIChuZXh0V2kuR2V0VG90YWxaRWxldmF0aW9uKCkgIT09IHN0YXJ0WikgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFuZXh0SW5zdC5SZW5kZXJzVG9Pd25aUGxhbmUoKSkgewogICAgICAgICAgICAgICAgICAgICAgICBwb3N0UmVuZGVySW5zdGFuY2VzLnB1c2gobmV4dEluc3QpOwogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAobmV4dFdpLkdldERlcHRoKCkgPiAwKSBwb3N0UmVuZGVySW5zdGFuY2VzLnB1c2gobmV4dEluc3QpOwogICAgICAgICAgICAgICAgICAgIGNvcGxhbmFySW5zdGFuY2VzLnB1c2gobmV4dEluc3QpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoY29wbGFuYXJJbnN0YW5jZXMubGVuZ3RoID09PSAxICYmICFjb3BsYW5hckluc3RhbmNlc1swXS5NdXN0TWl0aWdhdGVaRmlnaHRpbmcoKSkgewogICAgICAgICAgICAgICAgICAgIE1heWJlUHJlcGFyZUxheWVyRHJhdyh3aUxheWVyLCByZW5kZXJlcik7CiAgICAgICAgICAgICAgICAgICAgd2lMYXllci5fRHJhd0luc3RhbmNlTWF5YmVXaXRoRWZmZWN0cyhpbnN0LCB3aSwgcmVuZGVyZXIsIHJlbmRlclRhcmdldCk7CiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaiA9IDAsIGxlbmogPSBwb3N0UmVuZGVySW5zdGFuY2VzLmxlbmd0aDsgaiA8IGxlbmo7ICsraikgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwb3N0SW5zdCA9IHBvc3RSZW5kZXJJbnN0YW5jZXNbal07CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwb3N0SW5zdCA9PT0gaW5zdCkgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHBvc3RXaSA9IHBvc3RJbnN0LkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwb3N0V2lMYXllciA9IHBvc3RXaS5HZXRMYXllcigpOwogICAgICAgICAgICAgICAgICAgICAgICBNYXliZVByZXBhcmVMYXllckRyYXcocG9zdFdpTGF5ZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZW5kZXJlcik7CiAgICAgICAgICAgICAgICAgICAgICAgIHBvc3RXaUxheWVyLl9EcmF3SW5zdGFuY2VNYXliZVdpdGhFZmZlY3RzKHBvc3RJbnN0LCBwb3N0V2ksIHJlbmRlcmVyLCByZW5kZXJUYXJnZXQpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9EcmF3M0RMYXllcnNDb3BsYW5hckluc3RhbmNlcyhyZW5kZXJlciwgcmVuZGVyVGFyZ2V0LCBjb3BsYW5hckluc3RhbmNlcyk7CiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaiA9IDAsIGxlbmogPSBwb3N0UmVuZGVySW5zdGFuY2VzLmxlbmd0aDsgaiA8IGxlbmo7ICsraikgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwb3N0SW5zdCA9IHBvc3RSZW5kZXJJbnN0YW5jZXNbal07CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHBvc3RXaSA9IHBvc3RJbnN0LkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwb3N0V2lMYXllciA9IHBvc3RXaS5HZXRMYXllcigpOwogICAgICAgICAgICAgICAgICAgICAgICBwb3N0V2kuX1NldERyYXdOb25CYWNrRmFjZXNPbmx5KHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICBNYXliZVByZXBhcmVMYXllckRyYXcocG9zdFdpTGF5ZXIsIHJlbmRlcmVyKTsKICAgICAgICAgICAgICAgICAgICAgICAgcG9zdFdpTGF5ZXIuX0RyYXdJbnN0YW5jZU1heWJlV2l0aEVmZmVjdHMocG9zdEluc3QsIHBvc3RXaSwgcmVuZGVyZXIsIHJlbmRlclRhcmdldCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHBvc3RXaS5fU2V0RHJhd05vbkJhY2tGYWNlc09ubHkoZmFsc2UpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaSA9IGVuZEluZGV4OwogICAgICAgICAgICAgICAgQzMuY2xlYXJBcnJheShjb3BsYW5hckluc3RhbmNlcyk7CiAgICAgICAgICAgICAgICBDMy5jbGVhckFycmF5KHBvc3RSZW5kZXJJbnN0YW5jZXMpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGxheWVyUXVlcnkpIHJlbmRlcmVyLkVuZFF1ZXJ5KGxheWVyUXVlcnkpOwogICAgICAgICAgICBpZiAodGhpcy5fcnVudGltZS5Jc0dQVVByb2ZpbGluZygpICYmIHJlbmRlcmVyLklzV2ViR1BVKCkpIHJlbmRlcmVyLldyaXRlVGltZXN0YW1wKChmaXJzdExheWVyLkdldEluZGV4KCkgKyAxKSAqIDIgKyAxKTsKICAgICAgICAgICAgQzMuY2xlYXJBcnJheShmdWxsSW5zdGFuY2VMaXN0KTsKICAgICAgICAgICAgbGFzdExheWVyUHJlcGFyZWRGb3JEcmF3aW5nID0gbnVsbAogICAgICAgIH0KICAgICAgICBfRHJhdzNETGF5ZXJzQ29wbGFuYXJJbnN0YW5jZXMocmVuZGVyZXIsIHJlbmRlclRhcmdldCwgaW5zdGFuY2VzKSB7CiAgICAgICAgICAgIHJlbmRlcmVyLkNvcGxhbmFyU3RhcnRTdGVuY2lsUGFzcygpOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gaW5zdGFuY2VzLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7CiAgICAgICAgICAgICAgICBjb25zdCBpbnN0ID0gaW5zdGFuY2VzW2ldOwogICAgICAgICAgICAgICAgY29uc3Qgd2kgPSBpbnN0LkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICAgICAgY29uc3QgbGF5ZXIgPSB3aS5HZXRMYXllcigpOwogICAgICAgICAgICAgICAgd2kuX1NldERyYXdCYWNrRmFjZU9ubHkodHJ1ZSk7CiAgICAgICAgICAgICAgICBNYXliZVByZXBhcmVMYXllckRyYXcobGF5ZXIsIHJlbmRlcmVyKTsKICAgICAgICAgICAgICAgIGxheWVyLl9EcmF3SW5zdGFuY2UoaW5zdCwgd2ksIHJlbmRlcmVyKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJlbmRlcmVyLkNvcGxhbmFyU3RhcnRDb2xvclBhc3MoKTsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IGluc3RhbmNlcy5sZW5ndGg7IGkgPCBsZW47ICsraSkgewogICAgICAgICAgICAgICAgY29uc3QgaW5zdCA9IGluc3RhbmNlc1tpXTsKICAgICAgICAgICAgICAgIGNvbnN0IHdpID0gaW5zdC5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgICAgIGNvbnN0IGxheWVyID0gd2kuR2V0TGF5ZXIoKTsKICAgICAgICAgICAgICAgIE1heWJlUHJlcGFyZUxheWVyRHJhdyhsYXllciwgcmVuZGVyZXIpOwogICAgICAgICAgICAgICAgbGF5ZXIuX0RyYXdJbnN0YW5jZU1heWJlV2l0aEVmZmVjdHMoaW5zdCwgd2ksIHJlbmRlcmVyLCByZW5kZXJUYXJnZXQpOwogICAgICAgICAgICAgICAgd2kuX1NldERyYXdCYWNrRmFjZU9ubHkoZmFsc2UpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmVuZGVyZXIuQ29wbGFuYXJSZXN0b3JlU3RhbmRhcmRSZW5kZXJpbmcoKQogICAgICAgIH0KICAgICAgICBfU2F2ZVRvSnNvbigpIHsKICAgICAgICAgICAgY29uc3QgbyA9IHsKICAgICAgICAgICAgICAgICJzeCI6IHRoaXMuR2V0U2Nyb2xsWCgpLAogICAgICAgICAgICAgICAgInN5IjogdGhpcy5HZXRTY3JvbGxZKCksCiAgICAgICAgICAgICAgICAicyI6IHRoaXMuR2V0U2NhbGUoKSwKICAgICAgICAgICAgICAgICJhIjogdGhpcy5HZXRBbmdsZSgpLAogICAgICAgICAgICAgICAgInciOiB0aGlzLkdldFdpZHRoKCksCiAgICAgICAgICAgICAgICAiaCI6IHRoaXMuR2V0SGVpZ2h0KCksCiAgICAgICAgICAgICAgICAib3J0aG8iOiB0aGlzLklzT3J0aG9ncmFwaGljUHJvamVjdGlvbigpLAogICAgICAgICAgICAgICAgInZwWCI6IHRoaXMuR2V0VmFuaXNoaW5nUG9pbnRYKCksCiAgICAgICAgICAgICAgICAidnBZIjogdGhpcy5HZXRWYW5pc2hpbmdQb2ludFkoKSwKICAgICAgICAgICAgICAgICJmdiI6IHRoaXMuX2lzRmlyc3RWaXNpdCwKICAgICAgICAgICAgICAgICJwZXJzaXN0IjogdGhpcy5fcGVyc2lzdERhdGEsCiAgICAgICAgICAgICAgICAiZngiOiB0aGlzLl9lZmZlY3RMaXN0LlNhdmVUb0pzb24oKSwKICAgICAgICAgICAgICAgICJsYXllcnMiOiB7fQogICAgICAgICAgICB9OwogICAgICAgICAgICBmb3IgKGNvbnN0IGxheWVyIG9mIHRoaXMuX2FsbExheWVyc0ZsYXQpIG9bImxheWVycyJdW2xheWVyLkdldFNJRCgpLnRvU3RyaW5nKCldID0gbGF5ZXIuX1NhdmVUb0pzb24oKTsKICAgICAgICAgICAgcmV0dXJuIG8KICAgICAgICB9CiAgICAgICAgX0xvYWRGcm9tSnNvbihvKSB7CiAgICAgICAgICAgIHRoaXMuX3Njcm9sbFggPSBvWyJzeCJdOwogICAgICAgICAgICB0aGlzLl9zY3JvbGxZID0gb1sic3kiXTsKICAgICAgICAgICAgdGhpcy5fc2NhbGUgPQogICAgICAgICAgICAgICAgb1sicyJdOwogICAgICAgICAgICB0aGlzLl9hbmdsZSA9IG9bImEiXTsKICAgICAgICAgICAgdGhpcy5fd2lkdGggPSBvWyJ3Il07CiAgICAgICAgICAgIHRoaXMuX2hlaWdodCA9IG9bImgiXTsKICAgICAgICAgICAgdGhpcy5faXNPcnRob2dyYXBoaWNQcm9qZWN0aW9uID0gISFvWyJvcnRobyJdOwogICAgICAgICAgICBpZiAoby5oYXNPd25Qcm9wZXJ0eSgidnBYIikpIHRoaXMuX3ZhbmlzaGluZ1BvaW50WCA9IG9bInZwWCJdOwogICAgICAgICAgICBpZiAoby5oYXNPd25Qcm9wZXJ0eSgidnBZIikpIHRoaXMuX3ZhbmlzaGluZ1BvaW50WSA9IG9bInZwWSJdOwogICAgICAgICAgICB0aGlzLl9pc0ZpcnN0VmlzaXQgPSAhIW9bImZ2Il07CiAgICAgICAgICAgIHRoaXMuX3BlcnNpc3REYXRhID0gb1sicGVyc2lzdCJdOwogICAgICAgICAgICB0aGlzLl9lZmZlY3RMaXN0LkxvYWRGcm9tSnNvbihvWyJmeCJdKTsKICAgICAgICAgICAgdGhpcy5fbmVlZHNSZWJ1aWxkRWZmZWN0Q2hhaW5TdGVwcyA9IHRydWU7CiAgICAgICAgICAgIGZvciAoY29uc3QgW3NpZFN0ciwgZGF0YV0gb2YgT2JqZWN0LmVudHJpZXMob1sibGF5ZXJzIl0pKSB7CiAgICAgICAgICAgICAgICBjb25zdCBzaWQgPSBwYXJzZUludChzaWRTdHIsIDEwKTsKICAgICAgICAgICAgICAgIGNvbnN0IGxheWVyID0gdGhpcy5HZXRMYXllckJ5U0lEKHNpZCk7CiAgICAgICAgICAgICAgICBpZiAoIWxheWVyKSBjb250aW51ZTsKICAgICAgICAgICAgICAgIGxheWVyLl9Mb2FkRnJvbUpzb24oZGF0YSkKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLl9TZXRBbGxMYXllcnNQcm9qZWN0aW9uQ2hhbmdlZCgpOwogICAgICAgICAgICB0aGlzLl9TZXRBbGxMYXllcnNNVkNoYW5nZWQoKQogICAgICAgIH0KICAgICAgICBHZXRJTGF5b3V0KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faUxheW91dAogICAgICAgIH0KICAgICAgICBVc2VyU2NyaXB0RGlzcGF0Y2hlcigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3VzZXJTY3JpcHREaXNwYXRjaGVyCiAgICAgICAgfQogICAgICAgIERpc3BhdGNoVXNlclNjcmlwdEV2ZW50KGUpIHsKICAgICAgICAgICAgZS5sYXlvdXQgPSB0aGlzLkdldElMYXlvdXQoKTsKICAgICAgICAgICAgY29uc3QgcnVudGltZSA9IHRoaXMuX3J1bnRpbWU7CiAgICAgICAgICAgIGNvbnN0IHNob3VsZFRpbWUgPSBydW50aW1lLklzRGVidWcoKSAmJiAhcnVudGltZS5HZXRFdmVudFNoZWV0TWFuYWdlcigpLklzSW5FdmVudEVuZ2luZSgpOwogICAgICAgICAgICBpZiAoc2hvdWxkVGltZSkgQzNEZWJ1Z2dlci5TdGFydE1lYXN1cmluZ1NjcmlwdFRpbWUoKTsKICAgICAgICAgICAgdGhpcy5fdXNlclNjcmlwdERpc3BhdGNoZXIuZGlzcGF0Y2hFdmVudChlKTsKICAgICAgICAgICAgaWYgKHNob3VsZFRpbWUpIEMzRGVidWdnZXIuQWRkU2NyaXB0VGltZSgpCiAgICAgICAgfQogICAgICAgIERpc3BhdGNoVXNlclNjcmlwdEV2ZW50QXN5bmNXYWl0KGUpIHsKICAgICAgICAgICAgZS5sYXlvdXQgPQogICAgICAgICAgICAgICAgdGhpcy5HZXRJTGF5b3V0KCk7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl91c2VyU2NyaXB0RGlzcGF0Y2hlci5kaXNwYXRjaEV2ZW50QW5kV2FpdEFzeW5jKGUpCiAgICAgICAgfQogICAgfTsKCn0KCi8vIGxheW91dHMvbGF5b3V0TWFuYWdlci5qcwp7CiAgICAndXNlIHN0cmljdCc7CiAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICBDMy5MYXlvdXRNYW5hZ2VyID0gY2xhc3MgTGF5b3V0TWFuYWdlciBleHRlbmRzIEMzLkRlZmVuZGVkQmFzZSB7CiAgICAgICAgY29uc3RydWN0b3IocnVudGltZSkgewogICAgICAgICAgICBzdXBlcigpOwogICAgICAgICAgICB0aGlzLl9ydW50aW1lID0gcnVudGltZTsKICAgICAgICAgICAgdGhpcy5fYWxsTGF5b3V0cyA9IFtdOwogICAgICAgICAgICB0aGlzLl9sYXlvdXRzQnlOYW1lID0gbmV3IE1hcDsKICAgICAgICAgICAgdGhpcy5fbGF5b3V0c0J5U2lkID0gbmV3IE1hcDsKICAgICAgICAgICAgdGhpcy5fbWFpblJ1bm5pbmdMYXlvdXQgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9ydW5uaW5nU3ViTGF5b3V0cyA9IFtdOwogICAgICAgICAgICB0aGlzLl9maXJzdExheW91dCA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX2lzRW5kaW5nTGF5b3V0ID0gMDsKICAgICAgICAgICAgdGhpcy5fcGVuZGluZ0NoYW5nZUxheW91dCA9IG51bGwKICAgICAgICB9CiAgICAgICAgUmVsZWFzZSgpIHsKICAgICAgICAgICAgdGhpcy5fcnVudGltZSA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX21haW5SdW5uaW5nTGF5b3V0ID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fZmlyc3RMYXlvdXQgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9wZW5kaW5nQ2hhbmdlTGF5b3V0ID0gbnVsbDsKICAgICAgICAgICAgQzMuY2xlYXJBcnJheSh0aGlzLl9hbGxMYXlvdXRzKTsKICAgICAgICAgICAgdGhpcy5fbGF5b3V0c0J5TmFtZS5jbGVhcigpOwogICAgICAgICAgICB0aGlzLl9sYXlvdXRzQnlTaWQuY2xlYXIoKTsKICAgICAgICAgICAgQzMuY2xlYXJBcnJheSh0aGlzLl9ydW5uaW5nU3ViTGF5b3V0cykKICAgICAgICB9CiAgICAgICAgQ3JlYXRlKGxheW91dERhdGEpIHsKICAgICAgICAgICAgY29uc3QgbGF5b3V0ID0gQzMuTmV3KEMzLkxheW91dCwgdGhpcywgdGhpcy5fYWxsTGF5b3V0cy5sZW5ndGgsIGxheW91dERhdGEpOwogICAgICAgICAgICB0aGlzLl9hbGxMYXlvdXRzLnB1c2gobGF5b3V0KTsKICAgICAgICAgICAgdGhpcy5fbGF5b3V0c0J5TmFtZS5zZXQobGF5b3V0LkdldE5hbWUoKS50b0xvd2VyQ2FzZSgpLCBsYXlvdXQpOwogICAgICAgICAgICB0aGlzLl9sYXlvdXRzQnlTaWQuc2V0KGxheW91dC5HZXRTSUQoKSwgbGF5b3V0KQogICAgICAgIH0KICAgICAgICBHZXRSdW50aW1lKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fcnVudGltZQogICAgICAgIH0KICAgICAgICBTZXRGaXJzdExheW91dChsYXlvdXQpIHsKICAgICAgICAgICAgdGhpcy5fZmlyc3RMYXlvdXQgPSBsYXlvdXQKICAgICAgICB9CiAgICAgICAgR2V0Rmlyc3RMYXlvdXQoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9maXJzdExheW91dCkgcmV0dXJuIHRoaXMuX2ZpcnN0TGF5b3V0OwogICAgICAgICAgICBpZiAodGhpcy5fYWxsTGF5b3V0cy5sZW5ndGgpIHJldHVybiB0aGlzLl9hbGxMYXlvdXRzWzBdOwogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIm5vIGZpcnN0IGxheW91dCIpOwogICAgICAgIH0KICAgICAgICBHZXRMYXlvdXRCeU5hbWUobmFtZSkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fbGF5b3V0c0J5TmFtZS5nZXQobmFtZS50b0xvd2VyQ2FzZSgpKSB8fCBudWxsCiAgICAgICAgfQogICAgICAgIEdldExheW91dEJ5U0lEKHNpZCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fbGF5b3V0c0J5U2lkLmdldChzaWQpIHx8IG51bGwKICAgICAgICB9CiAgICAgICAgR2V0TGF5b3V0QnlJbmRleChpbmRleCkgewogICAgICAgICAgICBpbmRleCA9IEMzLmNsYW1wKE1hdGguZmxvb3IoaW5kZXgpLCAwLCB0aGlzLl9hbGxMYXlvdXRzLmxlbmd0aCAtIDEpOwogICAgICAgICAgICByZXR1cm4gdGhpcy5fYWxsTGF5b3V0c1tpbmRleF0KICAgICAgICB9CiAgICAgICAgR2V0TGF5b3V0KHApIHsKICAgICAgICAgICAgaWYgKHR5cGVvZiBwID09PSAibnVtYmVyIikgcmV0dXJuIHRoaXMuR2V0TGF5b3V0QnlJbmRleChwKTsKICAgICAgICAgICAgZWxzZSByZXR1cm4gdGhpcy5HZXRMYXlvdXRCeU5hbWUocC50b1N0cmluZygpKQogICAgICAgIH0KICAgICAgICBHZXRBbGxMYXlvdXRzKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fYWxsTGF5b3V0cwogICAgICAgIH0KICAgICAgICBfU2V0TWFpblJ1bm5pbmdMYXlvdXQobGF5b3V0KSB7CiAgICAgICAgICAgIHRoaXMuX21haW5SdW5uaW5nTGF5b3V0ID0gbGF5b3V0CiAgICAgICAgfQogICAgICAgIEdldE1haW5SdW5uaW5nTGF5b3V0KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fbWFpblJ1bm5pbmdMYXlvdXQKICAgICAgICB9CiAgICAgICAgX0FkZFJ1bm5pbmdTdWJMYXlvdXQobGF5b3V0KSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9ydW5uaW5nU3ViTGF5b3V0cy5pbmNsdWRlcyhsYXlvdXQpKSB0aHJvdyBuZXcgRXJyb3IoImxheW91dCBhbHJlYWR5IHJ1bm5pbmciKTsKICAgICAgICAgICAgdGhpcy5fcnVubmluZ1N1YkxheW91dHMucHVzaChsYXlvdXQpCiAgICAgICAgfQogICAgICAgIF9SZW1vdmVSdW5uaW5nU3ViTGF5b3V0KGxheW91dCkgewogICAgICAgICAgICBjb25zdCBpID0gdGhpcy5fcnVubmluZ1N1YkxheW91dHMuaW5kZXhPZihsYXlvdXQpOwogICAgICAgICAgICBpZiAoaSA9PT0gLTEpIHRocm93IG5ldyBFcnJvcigibGF5b3V0IG5vdCBydW5uaW5nIik7CiAgICAgICAgICAgIHRoaXMuX3J1bm5pbmdTdWJMYXlvdXRzLnNwbGljZShpLCAxKQogICAgICAgIH0qIHJ1bm5pbmdMYXlvdXRzKCkgewogICAgICAgICAgICBpZiAodGhpcy5fbWFpblJ1bm5pbmdMYXlvdXQpIHlpZWxkIHRoaXMuX21haW5SdW5uaW5nTGF5b3V0OwogICAgICAgICAgICBpZiAodGhpcy5fcnVubmluZ1N1YkxheW91dHMubGVuZ3RoKSB5aWVsZCogdGhpcy5fcnVubmluZ1N1YkxheW91dHMKICAgICAgICB9CiAgICAgICAgSXNMYXlvdXRSdW5uaW5nKGxheW91dCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fbWFpblJ1bm5pbmdMYXlvdXQgPT09IGxheW91dCB8fCB0aGlzLl9ydW5uaW5nU3ViTGF5b3V0cy5pbmNsdWRlcyhsYXlvdXQpCiAgICAgICAgfQogICAgICAgIFNldElzRW5kaW5nTGF5b3V0KGUpIHsKICAgICAgICAgICAgaWYgKGUpIHRoaXMuX2lzRW5kaW5nTGF5b3V0Kys7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuX2lzRW5kaW5nTGF5b3V0IDw9CiAgICAgICAgICAgICAgICAgICAgMCkgdGhyb3cgbmV3IEVycm9yKCJhbHJlYWR5IHVuc2V0Iik7CiAgICAgICAgICAgICAgICB0aGlzLl9pc0VuZGluZ0xheW91dC0tCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgSXNFbmRpbmdMYXlvdXQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pc0VuZGluZ0xheW91dCA+IDAKICAgICAgICB9CiAgICAgICAgQ2hhbmdlTWFpbkxheW91dChsYXlvdXQpIHsKICAgICAgICAgICAgdGhpcy5fcGVuZGluZ0NoYW5nZUxheW91dCA9IGxheW91dAogICAgICAgIH0KICAgICAgICBDbGVhclBlbmRpbmdDaGFuZ2VMYXlvdXQoKSB7CiAgICAgICAgICAgIHRoaXMuX3BlbmRpbmdDaGFuZ2VMYXlvdXQgPSBudWxsCiAgICAgICAgfQogICAgICAgIElzUGVuZGluZ0NoYW5nZU1haW5MYXlvdXQoKSB7CiAgICAgICAgICAgIHJldHVybiAhIXRoaXMuX3BlbmRpbmdDaGFuZ2VMYXlvdXQKICAgICAgICB9CiAgICAgICAgR2V0UGVuZGluZ0NoYW5nZU1haW5MYXlvdXQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9wZW5kaW5nQ2hhbmdlTGF5b3V0CiAgICAgICAgfQogICAgICAgIFNldEFsbExheWVyUHJvamVjdGlvbkNoYW5nZWQoKSB7CiAgICAgICAgICAgIGNvbnN0IHJ1bm5pbmdMYXlvdXQgPSB0aGlzLkdldE1haW5SdW5uaW5nTGF5b3V0KCk7CiAgICAgICAgICAgIGlmICghcnVubmluZ0xheW91dCkgcmV0dXJuOwogICAgICAgICAgICBydW5uaW5nTGF5b3V0Ll9TZXRBbGxMYXllcnNQcm9qZWN0aW9uQ2hhbmdlZCgpCiAgICAgICAgfQogICAgICAgIFNldEFsbExheWVyTVZDaGFuZ2VkKCkgewogICAgICAgICAgICBjb25zdCBydW5uaW5nTGF5b3V0ID0KICAgICAgICAgICAgICAgIHRoaXMuR2V0TWFpblJ1bm5pbmdMYXlvdXQoKTsKICAgICAgICAgICAgaWYgKCFydW5uaW5nTGF5b3V0KSByZXR1cm47CiAgICAgICAgICAgIHJ1bm5pbmdMYXlvdXQuX1NldEFsbExheWVyc01WQ2hhbmdlZCgpCiAgICAgICAgfQogICAgfTsKCn0KCi8vIHRpbWVsaW5lcy90aW1lbGluZU1hbmFnZXIuanMKewogICAgJ3VzZSBzdHJpY3QnOwogICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgY29uc3QgTkFNRVNfUkVHRVhQID0gbmV3IFJlZ0V4cCgiPCguKz8pPiIsICJnIik7CiAgICBDMy5UaW1lbGluZU1hbmFnZXIgPSBjbGFzcyBUaW1lbGluZU1hbmFnZXIgZXh0ZW5kcyBDMy5EZWZlbmRlZEJhc2UgewogICAgICAgIGNvbnN0cnVjdG9yKHJ1bnRpbWUpIHsKICAgICAgICAgICAgc3VwZXIoKTsKICAgICAgICAgICAgdGhpcy5fcnVudGltZSA9IHJ1bnRpbWU7CiAgICAgICAgICAgIHRoaXMuX3RpbWVsaW5lRGF0YU1hbmFnZXIgPSBDMy5OZXcoQzMuVGltZWxpbmVEYXRhTWFuYWdlcik7CiAgICAgICAgICAgIHRoaXMuX3BsdWdpbkluc3RhbmNlID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fdGltZWxpbmVzID0gW107CiAgICAgICAgICAgIHRoaXMuX3RpbWVsaW5lc0J5TmFtZSA9IG5ldyBNYXA7CiAgICAgICAgICAgIHRoaXMuX29iamVjdENsYXNzVG9UaW1lbGluZU1hcCA9IG5ldyBNYXA7CiAgICAgICAgICAgIHRoaXMuX3RpbWVsaW5lc0NyZWF0ZWRCeVRlbXBsYXRlID0gbmV3IE1hcDsKICAgICAgICAgICAgdGhpcy5fc2NoZWR1bGVkVGltZWxpbmVzID0gW107CiAgICAgICAgICAgIHRoaXMuX3BsYXlpbmdUaW1lbGluZXMgPSBbXTsKICAgICAgICAgICAgdGhpcy5fbWFya2VkRm9yUmVtb3ZhbFRpbWVsaW5lcyA9IFtdOwogICAgICAgICAgICB0aGlzLl9oYXNSdW50aW1lTGlzdGVuZXJzID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX2NoYW5naW5nTGF5b3V0ID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX2lzVGlja2luZ1RpbWVsaW5lcyA9CiAgICAgICAgICAgICAgICBmYWxzZTsKICAgICAgICAgICAgdGhpcy5fdGlja0Z1bmMgPSAoKSA9PiB0aGlzLl9PblRpY2soKTsKICAgICAgICAgICAgdGhpcy5fdGljazJGdW5jID0gKCkgPT4gdGhpcy5fT25UaWNrMigpOwogICAgICAgICAgICB0aGlzLl9iZWZvcmVMYXlvdXRDaGFuZ2UgPSAoKSA9PiB0aGlzLl9PbkJlZm9yZUNoYW5nZUxheW91dCgpOwogICAgICAgICAgICB0aGlzLl9sYXlvdXRDaGFuZ2UgPSAoKSA9PiB0aGlzLl9PbkFmdGVyQ2hhbmdlTGF5b3V0KCk7CiAgICAgICAgICAgIHRoaXMuX2luc3RhbmNlRGVzdHJveSA9IGUgPT4gdGhpcy5fT25JbnN0YW5jZURlc3Ryb3koZS5pbnN0YW5jZSk7CiAgICAgICAgICAgIHRoaXMuX2JlZm9yZUxvYWQgPSBlID0+IHRoaXMuX09uQmVmb3JlTG9hZCgpOwogICAgICAgICAgICB0aGlzLl9hZnRlckxvYWQgPSBlID0+IHRoaXMuX09uQWZ0ZXJMb2FkKCk7CiAgICAgICAgICAgIHRoaXMuX2FmdGVyTGF5b3V0U3RhcnQgPSBlID0+IHRoaXMuX09uQWZ0ZXJMYXlvdXRTdGFydCgpOwogICAgICAgICAgICB0aGlzLl9kZXN0cm95ZWRXaGlsZUxvYWRpbmdTdGF0ZSA9IFtdOwogICAgICAgICAgICB0aGlzLl9yZW5kZXJDaGFuZ2UgPSAwCiAgICAgICAgfQogICAgICAgIFJlbGVhc2UoKSB7CiAgICAgICAgICAgIHRoaXMuUmVtb3ZlUnVudGltZUxpc3RlbmVycygpOwogICAgICAgICAgICB0aGlzLl90aWNrRnVuYyA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3RpY2syRnVuYyA9CiAgICAgICAgICAgICAgICBudWxsOwogICAgICAgICAgICB0aGlzLl9iZWZvcmVMYXlvdXRDaGFuZ2UgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9sYXlvdXRDaGFuZ2UgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9pbnN0YW5jZURlc3Ryb3kgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9hZnRlckxvYWQgPSBudWxsOwogICAgICAgICAgICBmb3IgKGNvbnN0IHRpbWVsaW5lIG9mIHRoaXMuX3RpbWVsaW5lcykgewogICAgICAgICAgICAgICAgdGltZWxpbmUuU3RvcCgpOwogICAgICAgICAgICAgICAgdGltZWxpbmUuUmVsZWFzZSgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgQzMuY2xlYXJBcnJheSh0aGlzLl90aW1lbGluZXMpOwogICAgICAgICAgICB0aGlzLl90aW1lbGluZXMgPSBudWxsOwogICAgICAgICAgICB0aGlzLl90aW1lbGluZURhdGFNYW5hZ2VyLlJlbGVhc2UoKTsKICAgICAgICAgICAgdGhpcy5fdGltZWxpbmVEYXRhTWFuYWdlciA9IG51bGw7CiAgICAgICAgICAgIEMzLmNsZWFyQXJyYXkodGhpcy5fc2NoZWR1bGVkVGltZWxpbmVzKTsKICAgICAgICAgICAgdGhpcy5fc2NoZWR1bGVkVGltZWxpbmVzID0gbnVsbDsKICAgICAgICAgICAgQzMuY2xlYXJBcnJheSh0aGlzLl9wbGF5aW5nVGltZWxpbmVzKTsKICAgICAgICAgICAgdGhpcy5fcGxheWluZ1RpbWVsaW5lcyA9IG51bGw7CiAgICAgICAgICAgIEMzLmNsZWFyQXJyYXkodGhpcy5fbWFya2VkRm9yUmVtb3ZhbFRpbWVsaW5lcyk7CiAgICAgICAgICAgIHRoaXMuX21hcmtlZEZvclJlbW92YWxUaW1lbGluZXMgPQogICAgICAgICAgICAgICAgbnVsbDsKICAgICAgICAgICAgdGhpcy5fdGltZWxpbmVzQnlOYW1lLmNsZWFyKCk7CiAgICAgICAgICAgIHRoaXMuX3RpbWVsaW5lc0J5TmFtZSA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX29iamVjdENsYXNzVG9UaW1lbGluZU1hcC5jbGVhcigpOwogICAgICAgICAgICB0aGlzLl9vYmplY3RDbGFzc1RvVGltZWxpbmVNYXAgPSBudWxsOwogICAgICAgICAgICB0aGlzLl90aW1lbGluZXNDcmVhdGVkQnlUZW1wbGF0ZS5jbGVhcigpOwogICAgICAgICAgICB0aGlzLl90aW1lbGluZXNDcmVhdGVkQnlUZW1wbGF0ZSA9IG51bGw7CiAgICAgICAgICAgIEMzLmNsZWFyQXJyYXkodGhpcy5fZGVzdHJveWVkV2hpbGVMb2FkaW5nU3RhdGUpOwogICAgICAgICAgICB0aGlzLl9kZXN0cm95ZWRXaGlsZUxvYWRpbmdTdGF0ZSA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUgPSBudWxsCiAgICAgICAgfQogICAgICAgIEFkZFJ1bnRpbWVMaXN0ZW5lcnMoKSB7CiAgICAgICAgICAgIGNvbnN0IGRpc3BhdGNoZXIgPSB0aGlzLl9ydW50aW1lLkRpc3BhdGNoZXIoKTsKICAgICAgICAgICAgZGlzcGF0Y2hlci5hZGRFdmVudExpc3RlbmVyKCJwcmV0aWNrIiwgdGhpcy5fdGlja0Z1bmMpOwogICAgICAgICAgICBkaXNwYXRjaGVyLmFkZEV2ZW50TGlzdGVuZXIoInRpY2syIiwgdGhpcy5fdGljazJGdW5jKTsKICAgICAgICAgICAgZGlzcGF0Y2hlci5hZGRFdmVudExpc3RlbmVyKCJiZWZvcmVsYXlvdXRjaGFuZ2UiLAogICAgICAgICAgICAgICAgdGhpcy5fYmVmb3JlTGF5b3V0Q2hhbmdlKTsKICAgICAgICAgICAgZGlzcGF0Y2hlci5hZGRFdmVudExpc3RlbmVyKCJsYXlvdXRjaGFuZ2UiLCB0aGlzLl9sYXlvdXRDaGFuZ2UpOwogICAgICAgICAgICBkaXNwYXRjaGVyLmFkZEV2ZW50TGlzdGVuZXIoImluc3RhbmNlZGVzdHJveSIsIHRoaXMuX2luc3RhbmNlRGVzdHJveSk7CiAgICAgICAgICAgIGRpc3BhdGNoZXIuYWRkRXZlbnRMaXN0ZW5lcigiYmVmb3JlbG9hZCIsIHRoaXMuX2JlZm9yZUxvYWQpOwogICAgICAgICAgICBkaXNwYXRjaGVyLmFkZEV2ZW50TGlzdGVuZXIoImFmdGVybG9hZCIsIHRoaXMuX2FmdGVyTG9hZCk7CiAgICAgICAgICAgIGRpc3BhdGNoZXIuYWRkRXZlbnRMaXN0ZW5lcigiYWZ0ZXJsYXlvdXRzdGFydCIsIHRoaXMuX2FmdGVyTGF5b3V0U3RhcnQpCiAgICAgICAgfQogICAgICAgIFJlbW92ZVJ1bnRpbWVMaXN0ZW5lcnMoKSB7CiAgICAgICAgICAgIGNvbnN0IGRpc3BhdGNoZXIgPSB0aGlzLl9ydW50aW1lLkRpc3BhdGNoZXIoKTsKICAgICAgICAgICAgZGlzcGF0Y2hlci5yZW1vdmVFdmVudExpc3RlbmVyKCJwcmV0aWNrIiwgdGhpcy5fdGlja0Z1bmMpOwogICAgICAgICAgICBkaXNwYXRjaGVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoInRpY2syIiwKICAgICAgICAgICAgICAgIHRoaXMuX3RpY2syRnVuYyk7CiAgICAgICAgICAgIGRpc3BhdGNoZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcigiYmVmb3JlbGF5b3V0Y2hhbmdlIiwgdGhpcy5fYmVmb3JlTGF5b3V0Q2hhbmdlKTsKICAgICAgICAgICAgZGlzcGF0Y2hlci5yZW1vdmVFdmVudExpc3RlbmVyKCJsYXlvdXRjaGFuZ2UiLCB0aGlzLl9sYXlvdXRDaGFuZ2UpOwogICAgICAgICAgICBkaXNwYXRjaGVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoImluc3RhbmNlZGVzdHJveSIsIHRoaXMuX2luc3RhbmNlRGVzdHJveSk7CiAgICAgICAgICAgIGRpc3BhdGNoZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcigiYmVmb3JlbG9hZCIsIHRoaXMuX2JlZm9yZUxvYWQpOwogICAgICAgICAgICBkaXNwYXRjaGVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoImFmdGVybG9hZCIsIHRoaXMuX2FmdGVyTG9hZCk7CiAgICAgICAgICAgIGRpc3BhdGNoZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcigiYWZ0ZXJsYXlvdXRzdGFydCIsIHRoaXMuX2FmdGVyTGF5b3V0U3RhcnQpCiAgICAgICAgfQogICAgICAgIENyZWF0ZSh0aW1lbGluZURhdGEpIHsKICAgICAgICAgICAgdGhpcy5fdGltZWxpbmVEYXRhTWFuYWdlci5BZGQodGltZWxpbmVEYXRhKTsKICAgICAgICAgICAgY29uc3QgdGltZWxpbmUgPQogICAgICAgICAgICAgICAgQzMuVGltZWxpbmVTdGF0ZS5DcmVhdGVJbml0aWFsKHRpbWVsaW5lRGF0YSwgdGhpcyk7CiAgICAgICAgICAgIHRoaXMuQWRkKHRpbWVsaW5lKTsKICAgICAgICAgICAgdGhpcy5TZXRUaW1lbGluZU9iamVjdENsYXNzZXNUb01hcCh0aW1lbGluZSk7CiAgICAgICAgICAgIHRoaXMuX3RpbWVsaW5lc0NyZWF0ZWRCeVRlbXBsYXRlLnNldCh0aW1lbGluZS5HZXROYW1lKCksIDApCiAgICAgICAgfQogICAgICAgIENyZWF0ZUZyb21UZW1wbGF0ZSh0ZW1wbGF0ZSkgewogICAgICAgICAgICBjb25zdCB0aW1lbGluZURhdGFNYW5hZ2VyID0gdGhpcy5HZXRUaW1lbGluZURhdGFNYW5hZ2VyKCk7CiAgICAgICAgICAgIGNvbnN0IHRlbXBsYXRlTmFtZSA9IHRlbXBsYXRlLkdldFRlbXBsYXRlTmFtZSgpOwogICAgICAgICAgICBjb25zdCB0aW1lbGluZURhdGFJdGVtID0gdGltZWxpbmVEYXRhTWFuYWdlci5HZXQodGVtcGxhdGVOYW1lKTsKICAgICAgICAgICAgY29uc3QgdGltZWxpbmUgPSBDMy5UaW1lbGluZVN0YXRlLkNyZWF0ZUZyb21UZW1wbGF0ZShgJHt0ZW1wbGF0ZU5hbWV9OiR7dGhpcy5fdGltZWxpbmVzQ3JlYXRlZEJ5VGVtcGxhdGUuZ2V0KHRlbXBsYXRlTmFtZSl9YCwgdGltZWxpbmVEYXRhSXRlbSwKICAgICAgICAgICAgICAgIHRoaXMpOwogICAgICAgICAgICB0aGlzLl9JbmNyZWFzZVRlbXBsYXRlVGltZWxpbmVzQ291bnQodGVtcGxhdGVOYW1lKTsKICAgICAgICAgICAgdGhpcy5BZGQodGltZWxpbmUpOwogICAgICAgICAgICByZXR1cm4gdGltZWxpbmUKICAgICAgICB9CiAgICAgICAgX0luY3JlYXNlVGVtcGxhdGVUaW1lbGluZXNDb3VudCh0ZW1wbGF0ZU5hbWUpIHsKICAgICAgICAgICAgdGhpcy5fdGltZWxpbmVzQ3JlYXRlZEJ5VGVtcGxhdGUuc2V0KHRlbXBsYXRlTmFtZSwgdGhpcy5fdGltZWxpbmVzQ3JlYXRlZEJ5VGVtcGxhdGUuZ2V0KHRlbXBsYXRlTmFtZSkgKyAxKQogICAgICAgIH0KICAgICAgICBfU2V0Q3JlYXRlZFRlbXBsYXRlVGltZWxpbmVzQ291bnQoKSB7CiAgICAgICAgICAgIGZvciAoY29uc3QgdGltZWxpbmUgb2YgdGhpcy5fdGltZWxpbmVzKSB7CiAgICAgICAgICAgICAgICBpZiAodGltZWxpbmUuSXNUZW1wbGF0ZSgpKSBjb250aW51ZTsKICAgICAgICAgICAgICAgIGNvbnN0IHRlbXBsYXRlTmFtZSA9IHRpbWVsaW5lLkdldFRlbXBsYXRlTmFtZSgpOwogICAgICAgICAgICAgICAgdGhpcy5fSW5jcmVhc2VUZW1wbGF0ZVRpbWVsaW5lc0NvdW50KHRlbXBsYXRlTmFtZSkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBfQ2xlYXJDcmVhdGVkVGVtcGxhdGVUaW1lbGluZXNDb3VudCgpIHsKICAgICAgICAgICAgZm9yIChjb25zdCB0ZW1wbGF0ZU5hbWUgb2YgdGhpcy5fdGltZWxpbmVzQ3JlYXRlZEJ5VGVtcGxhdGUua2V5cygpKSB0aGlzLl90aW1lbGluZXNDcmVhdGVkQnlUZW1wbGF0ZS5zZXQodGVtcGxhdGVOYW1lLAogICAgICAgICAgICAgICAgMCkKICAgICAgICB9CiAgICAgICAgQWRkKHRpbWVsaW5lKSB7CiAgICAgICAgICAgIHRoaXMuX3RpbWVsaW5lcy5wdXNoKHRpbWVsaW5lKTsKICAgICAgICAgICAgdGhpcy5fdGltZWxpbmVzQnlOYW1lLnNldCh0aW1lbGluZS5HZXROYW1lKCkudG9Mb3dlckNhc2UoKSwgdGltZWxpbmUpCiAgICAgICAgfQogICAgICAgIFJlbW92ZSh0aW1lbGluZSkgewogICAgICAgICAgICB0aW1lbGluZS5SZW1vdmVkKCk7CiAgICAgICAgICAgIGlmICh0aW1lbGluZS5Jc1RlbXBsYXRlKCkpIHJldHVybjsKICAgICAgICAgICAgQzMuYXJyYXlGaW5kUmVtb3ZlKHRoaXMuX3RpbWVsaW5lcywgdGltZWxpbmUpOwogICAgICAgICAgICBDMy5hcnJheUZpbmRSZW1vdmUodGhpcy5fc2NoZWR1bGVkVGltZWxpbmVzLCB0aW1lbGluZSk7CiAgICAgICAgICAgIEMzLmFycmF5RmluZFJlbW92ZSh0aGlzLl9wbGF5aW5nVGltZWxpbmVzLCB0aW1lbGluZSk7CiAgICAgICAgICAgIEMzLmFycmF5RmluZFJlbW92ZSh0aGlzLl9tYXJrZWRGb3JSZW1vdmFsVGltZWxpbmVzLCB0aW1lbGluZSk7CiAgICAgICAgICAgIHRoaXMuX3RpbWVsaW5lc0J5TmFtZS5kZWxldGUodGltZWxpbmUuR2V0TmFtZSgpLnRvTG93ZXJDYXNlKCkpOwogICAgICAgICAgICB0aGlzLlJlbW92ZVRpbWVsaW5lRnJvbU9iamVjdENsYXNzTWFwKHRpbWVsaW5lKTsKICAgICAgICAgICAgaWYgKCF0aW1lbGluZS5Jc1JlbGVhc2VkKCkpIHRpbWVsaW5lLlJlbGVhc2UoKQogICAgICAgIH0KICAgICAgICBUcmlnZ2VyKG1ldGhvZCkgewogICAgICAgICAgICB0aGlzLl9ydW50aW1lLlRyaWdnZXIobWV0aG9kLCB0aGlzLl9wbHVnaW5JbnN0YW5jZSwgbnVsbCkKICAgICAgICB9CiAgICAgICAgR2V0UnVudGltZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUKICAgICAgICB9CiAgICAgICAgR2V0VGltZWxpbmVEYXRhTWFuYWdlcigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RpbWVsaW5lRGF0YU1hbmFnZXIKICAgICAgICB9CiAgICAgICAgU2V0UGx1Z2luSW5zdGFuY2UoaW5zdCkgewogICAgICAgICAgICB0aGlzLl9wbHVnaW5JbnN0YW5jZSA9IGluc3QKICAgICAgICB9CiAgICAgICAgR2V0UGx1Z2luSW5zdGFuY2UoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9wbHVnaW5JbnN0YW5jZQogICAgICAgIH0qIEdldFRpbWVsaW5lcygpIHsKICAgICAgICAgICAgZm9yIChjb25zdCB0aW1lbGluZSBvZiB0aGlzLl90aW1lbGluZXMpIHlpZWxkIHRpbWVsaW5lCiAgICAgICAgfSogR2V0UGxheWluZ1RpbWVsaW5lcygpIHsKICAgICAgICAgICAgZm9yIChjb25zdCB0aW1lbGluZSBvZiB0aGlzLl9wbGF5aW5nVGltZWxpbmVzKSB5aWVsZCB0aW1lbGluZQogICAgICAgIH0KICAgICAgICBTZXRUaW1lbGluZU9iamVjdENsYXNzVG9NYXAob2JqZWN0Q2xhc3MsIHRpbWVsaW5lKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5fb2JqZWN0Q2xhc3NUb1RpbWVsaW5lTWFwLmhhcyhvYmplY3RDbGFzcykpIHRoaXMuX29iamVjdENsYXNzVG9UaW1lbGluZU1hcC5zZXQob2JqZWN0Q2xhc3MsCiAgICAgICAgICAgICAgICBuZXcgU2V0KTsKICAgICAgICAgICAgdGhpcy5fb2JqZWN0Q2xhc3NUb1RpbWVsaW5lTWFwLmdldChvYmplY3RDbGFzcykuYWRkKHRpbWVsaW5lKQogICAgICAgIH0KICAgICAgICBTZXRUaW1lbGluZU9iamVjdENsYXNzZXNUb01hcCh0aW1lbGluZSkgewogICAgICAgICAgICBmb3IgKGNvbnN0IG9iamVjdENsYXNzIG9mIHRpbWVsaW5lLkdldE9iamVjdENsYXNzZXMoKSkgdGhpcy5TZXRUaW1lbGluZU9iamVjdENsYXNzVG9NYXAob2JqZWN0Q2xhc3MsIHRpbWVsaW5lKQogICAgICAgIH0KICAgICAgICBSZW1vdmVUaW1lbGluZUZyb21PYmplY3RDbGFzc01hcCh0aW1lbGluZSkgewogICAgICAgICAgICBmb3IgKGNvbnN0IFtvYmplY3RDbGFzcywgdGltZWxpbmVzXSBvZiB0aGlzLl9vYmplY3RDbGFzc1RvVGltZWxpbmVNYXAuZW50cmllcygpKQogICAgICAgICAgICAgICAgaWYgKHRpbWVsaW5lcy5oYXModGltZWxpbmUpKSB7CiAgICAgICAgICAgICAgICAgICAgdGltZWxpbmVzLmRlbGV0ZSh0aW1lbGluZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRpbWVsaW5lcy5zaXplID09PSAwKSB0aGlzLl9vYmplY3RDbGFzc1RvVGltZWxpbmVNYXAuZGVsZXRlKG9iamVjdENsYXNzKQogICAgICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBHZXRUaW1lbGluZXNGb3JPYmplY3RDbGFzcyhvYmplY3RDbGFzcykgewogICAgICAgICAgICBpZiAoIXRoaXMuX29iamVjdENsYXNzVG9UaW1lbGluZU1hcC5oYXMob2JqZWN0Q2xhc3MpKSByZXR1cm47CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9vYmplY3RDbGFzc1RvVGltZWxpbmVNYXAuZ2V0KG9iamVjdENsYXNzKQogICAgICAgIH0KICAgICAgICBHZXRUaW1lbGluZU9mVGVtcGxhdGVGb3JJbnN0YW5jZXModGVtcGxhdGVUaW1lbGluZSwgaW5zdGFuY2VzT2JqZWN0KSB7CiAgICAgICAgICAgIGlmICghaW5zdGFuY2VzT2JqZWN0KSByZXR1cm47CiAgICAgICAgICAgIGZvciAoY29uc3QgdGltZWxpbmUgb2YgdGhpcy5fdGltZWxpbmVzKSB7CiAgICAgICAgICAgICAgICBjb25zdCBmb3VuZCA9IGluc3RhbmNlc09iamVjdC5ldmVyeShpbyA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRpbWVsaW5lLkhhc1RyYWNrSW5zdGFuY2UoaW8uaW5zdGFuY2UsIGlvLnRyYWNrSWQpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGlmIChmb3VuZCkKICAgICAgICAgICAgICAgICAgICBpZiAodGltZWxpbmUuR2V0TmFtZSgpLmluY2x1ZGVzKHRlbXBsYXRlVGltZWxpbmUuR2V0TmFtZSgpKSkgcmV0dXJuIHRpbWVsaW5lCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgR2V0VGltZWxpbmVCeU5hbWUobmFtZSkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fdGltZWxpbmVzQnlOYW1lLmdldChuYW1lLnRvTG93ZXJDYXNlKCkpIHx8IG51bGwKICAgICAgICB9CiAgICAgICAgR2V0U2NoZWR1bGVkT3JQbGF5aW5nVGltZWxpbmVCeU5hbWUobmFtZSkgewogICAgICAgICAgICBmb3IgKGNvbnN0IHRpbWVsaW5lIG9mIHRoaXMuX3NjaGVkdWxlZFRpbWVsaW5lcykKICAgICAgICAgICAgICAgIGlmICh0aW1lbGluZS5HZXROYW1lKCkgPT09CiAgICAgICAgICAgICAgICAgICAgbmFtZSkgcmV0dXJuIHRpbWVsaW5lOwogICAgICAgICAgICBmb3IgKGNvbnN0IHRpbWVsaW5lIG9mIHRoaXMuX3BsYXlpbmdUaW1lbGluZXMpCiAgICAgICAgICAgICAgICBpZiAodGltZWxpbmUuR2V0TmFtZSgpID09PSBuYW1lKSByZXR1cm4gdGltZWxpbmU7CiAgICAgICAgICAgIHJldHVybiBudWxsCiAgICAgICAgfSogR2V0VGltZWxpbmVzQnlOYW1lKG5hbWUpIHsKICAgICAgICAgICAgaWYgKE5BTUVTX1JFR0VYUC50ZXN0KG5hbWUpKSB7CiAgICAgICAgICAgICAgICBOQU1FU19SRUdFWFAubGFzdEluZGV4ID0gMDsKICAgICAgICAgICAgICAgIGxldCBtYXRjaDsKICAgICAgICAgICAgICAgIGNvbnN0IHVuaXF1ZU5hbWVzID0gbmV3IFNldDsKICAgICAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgICAgICBtYXRjaCA9IE5BTUVTX1JFR0VYUC5leGVjKG5hbWUpOwogICAgICAgICAgICAgICAgICAgIGlmIChtYXRjaCkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBuYW1lcyA9IG1hdGNoWzFdLnNwbGl0KCIsIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgbmFtZSBvZiBuYW1lcykgdW5pcXVlTmFtZXMuYWRkKG5hbWUpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSB3aGlsZSAobWF0Y2gpOwogICAgICAgICAgICAgICAgZm9yIChjb25zdCBuYW1lIG9mIHVuaXF1ZU5hbWVzLnZhbHVlcygpKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdGltZWxpbmUgPSB0aGlzLkdldFRpbWVsaW5lQnlOYW1lKG5hbWUpOwogICAgICAgICAgICAgICAgICAgIGlmICh0aW1lbGluZSkgeWllbGQgdGltZWxpbmUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHVuaXF1ZU5hbWVzLmNsZWFyKCkKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbnN0IHRpbWVsaW5lID0KICAgICAgICAgICAgICAgICAgICB0aGlzLkdldFRpbWVsaW5lQnlOYW1lKG5hbWUpOwogICAgICAgICAgICAgICAgaWYgKHRpbWVsaW5lKSB5aWVsZCB0aW1lbGluZQogICAgICAgICAgICB9CiAgICAgICAgfSogR2V0VGltZWxpbmVzQnlUYWdzKHRhZ3MpIHsKICAgICAgICAgICAgZm9yIChjb25zdCB0aW1lbGluZSBvZiB0aGlzLl90aW1lbGluZXMpCiAgICAgICAgICAgICAgICBpZiAodGltZWxpbmUuSGFzVGFncyh0YWdzKSkgeWllbGQgdGltZWxpbmUKICAgICAgICB9CiAgICAgICAgQWRkU2NoZWR1bGVkVGltZWxpbmUodGltZWxpbmUpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLl9zY2hlZHVsZWRUaW1lbGluZXMuaW5jbHVkZXModGltZWxpbmUpKSB0aGlzLl9zY2hlZHVsZWRUaW1lbGluZXMucHVzaCh0aW1lbGluZSk7CiAgICAgICAgICAgIHRoaXMuX01heWJlRW5hYmxlUnVudGltZUxpc3RlbmVycygpCiAgICAgICAgfQogICAgICAgIFJlbW92ZVBsYXlpbmdUaW1lbGluZSh0aW1lbGluZSkgewogICAgICAgICAgICBDMy5hcnJheUZpbmRSZW1vdmUodGhpcy5fcGxheWluZ1RpbWVsaW5lcywgdGltZWxpbmUpOwogICAgICAgICAgICB0aGlzLl9NYXliZURpc2FibGVSdW50aW1lTGlzdGVuZXJzKCkKICAgICAgICB9CiAgICAgICAgU2NoZWR1bGVUaW1lbGluZSh0aW1lbGluZSkgewogICAgICAgICAgICBpZiAodGhpcy5fcGxheWluZ1RpbWVsaW5lcy5pbmNsdWRlcyh0aW1lbGluZSkpIHsKICAgICAgICAgICAgICAgIHRpbWVsaW5lLlNldFBsYXlpbmcodHJ1ZSk7CiAgICAgICAgICAgICAgICB0aW1lbGluZS5TZXRTY2hlZHVsZWQoZmFsc2UpOwogICAgICAgICAgICAgICAgdGltZWxpbmUuU2V0TWFya2VkRm9yUmVtb3ZhbChmYWxzZSkKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRpbWVsaW5lLlNldFBsYXlpbmcoZmFsc2UpOwogICAgICAgICAgICAgICAgdGltZWxpbmUuU2V0U2NoZWR1bGVkKHRydWUpOwogICAgICAgICAgICAgICAgdGltZWxpbmUuU2V0TWFya2VkRm9yUmVtb3ZhbChmYWxzZSk7CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX3NjaGVkdWxlZFRpbWVsaW5lcy5pbmNsdWRlcyh0aW1lbGluZSkpIHRoaXMuX3NjaGVkdWxlZFRpbWVsaW5lcy5wdXNoKHRpbWVsaW5lKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuX01heWJlRW5hYmxlUnVudGltZUxpc3RlbmVycygpCiAgICAgICAgfQogICAgICAgIERlU2NoZWR1bGVUaW1lbGluZSh0aW1lbGluZSkgewogICAgICAgICAgICB0aW1lbGluZS5TZXRQbGF5aW5nKGZhbHNlKTsKICAgICAgICAgICAgdGltZWxpbmUuU2V0U2NoZWR1bGVkKGZhbHNlKTsKICAgICAgICAgICAgdGltZWxpbmUuUmVzb2x2ZVBsYXlQcm9taXNlKCk7CiAgICAgICAgICAgIEMzLmFycmF5RmluZFJlbW92ZSh0aGlzLl9zY2hlZHVsZWRUaW1lbGluZXMsIHRpbWVsaW5lKTsKICAgICAgICAgICAgdGhpcy5fTWF5YmVEaXNhYmxlUnVudGltZUxpc3RlbmVycygpCiAgICAgICAgfQogICAgICAgIENvbXBsZXRlVGltZWxpbmUodGltZWxpbmUpIHsKICAgICAgICAgICAgdGltZWxpbmUuU2V0UGxheWluZyhmYWxzZSk7CiAgICAgICAgICAgIHRpbWVsaW5lLlNldFNjaGVkdWxlZChmYWxzZSk7CiAgICAgICAgICAgIGlmICh0aGlzLl9wbGF5aW5nVGltZWxpbmVzLmluY2x1ZGVzKHRpbWVsaW5lKSkgewogICAgICAgICAgICAgICAgdGltZWxpbmUuU2V0TWFya2VkRm9yUmVtb3ZhbCh0cnVlKTsKICAgICAgICAgICAgICAgIHRoaXMuX21hcmtlZEZvclJlbW92YWxUaW1lbGluZXMucHVzaCh0aW1lbGluZSk7CiAgICAgICAgICAgICAgICBDMy5hcnJheUZpbmRSZW1vdmUodGhpcy5fcGxheWluZ1RpbWVsaW5lcywgdGltZWxpbmUpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgQ29tcGxldGVUaW1lbGluZUJlZm9yZUNoYW5nZU9mTGF5b3V0KHRpbWVsaW5lKSB7CiAgICAgICAgICAgIHRpbWVsaW5lLlNldFBsYXlpbmcoZmFsc2UpOwogICAgICAgICAgICB0aW1lbGluZS5TZXRTY2hlZHVsZWQoZmFsc2UpOwogICAgICAgICAgICB0aW1lbGluZS5TZXRNYXJrZWRGb3JSZW1vdmFsKGZhbHNlKTsKICAgICAgICAgICAgdGltZWxpbmUuU2V0UGxheWJhY2tSYXRlKDEpOwogICAgICAgICAgICBDMy5hcnJheUZpbmRSZW1vdmUodGhpcy5fcGxheWluZ1RpbWVsaW5lcywgdGltZWxpbmUpCiAgICAgICAgfQogICAgICAgIENvbXBsZXRlVGltZWxpbmVBbmRSZXNvbHZlKHRpbWVsaW5lKSB7CiAgICAgICAgICAgIHRoaXMuQ29tcGxldGVUaW1lbGluZSh0aW1lbGluZSk7CiAgICAgICAgICAgIHRpbWVsaW5lLlJlc29sdmVQbGF5UHJvbWlzZSgpCiAgICAgICAgfQogICAgICAgIF9PblRpY2soKSB7CiAgICAgICAgICAgIGlmICh0aGlzLkdldFJ1bnRpbWUoKS5Jc0xvYWRpbmdTdGF0ZSgpKSByZXR1cm47CiAgICAgICAgICAgIGlmICghdGhpcy5faGFzUnVudGltZUxpc3RlbmVycykgcmV0dXJuOwogICAgICAgICAgICBpZiAodGhpcy5fY2hhbmdpbmdMYXlvdXQpIHJldHVybjsKICAgICAgICAgICAgdGhpcy5faXNUaWNraW5nVGltZWxpbmVzID0gdHJ1ZTsKICAgICAgICAgICAgd2hpbGUgKHRoaXMuX3NjaGVkdWxlZFRpbWVsaW5lcy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHQgPSB0aGlzLl9zY2hlZHVsZWRUaW1lbGluZXMucG9wKCk7CiAgICAgICAgICAgICAgICB0LlNldEluaXRpYWxTdGF0ZSgpOwogICAgICAgICAgICAgICAgaWYgKHQuR2V0UmVuZGVyQ2hhbmdlKCkgIT09IDApIHRoaXMuX3JlbmRlckNoYW5nZSA9IDE7CiAgICAgICAgICAgICAgICB0aGlzLl9wbGF5aW5nVGltZWxpbmVzLnB1c2godCkKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBkdCA9IHRoaXMuX3J1bnRpbWUuX0dldER0RmFzdCgpOwogICAgICAgICAgICBjb25zdCBkdDEgPSB0aGlzLl9ydW50aW1lLkdldER0MSgpOwogICAgICAgICAgICBjb25zdCB0cyA9IHRoaXMuX3J1bnRpbWUuR2V0VGltZVNjYWxlKCk7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSB0aGlzLl9wbGF5aW5nVGltZWxpbmVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICAgICAgICAgICAgICBjb25zdCB0ID0gdGhpcy5fcGxheWluZ1RpbWVsaW5lc1tpXTsKICAgICAgICAgICAgICAgIGlmICh0KSB0LlRpY2soZHQsIHRzLCBkdDEpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5faXNUaWNraW5nVGltZWxpbmVzID0KICAgICAgICAgICAgICAgIGZhbHNlOwogICAgICAgICAgICBpZiAodGhpcy5fcmVuZGVyQ2hhbmdlICE9PSAwKSB0aGlzLkdldFJ1bnRpbWUoKS5VcGRhdGVSZW5kZXIoKQogICAgICAgIH0KICAgICAgICBfT25UaWNrMigpIHsKICAgICAgICAgICAgaWYgKHRoaXMuR2V0UnVudGltZSgpLklzTG9hZGluZ1N0YXRlKCkpIHJldHVybjsKICAgICAgICAgICAgaWYgKCF0aGlzLl9oYXNSdW50aW1lTGlzdGVuZXJzKSByZXR1cm47CiAgICAgICAgICAgIGlmICh0aGlzLl9jaGFuZ2luZ0xheW91dCkgcmV0dXJuOwogICAgICAgICAgICBsZXQgdGltZWxpbmVzVG9SZW1vdmU7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gdGhpcy5fbWFya2VkRm9yUmVtb3ZhbFRpbWVsaW5lcy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICAgICAgICAgIGNvbnN0IHQgPSB0aGlzLl9tYXJrZWRGb3JSZW1vdmFsVGltZWxpbmVzW2ldOwogICAgICAgICAgICAgICAgaWYgKCF0aW1lbGluZXNUb1JlbW92ZSkgdGltZWxpbmVzVG9SZW1vdmUgPSBuZXcgU2V0OwogICAgICAgICAgICAgICAgdC5SZW1vdmVkKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9NYXliZUV4ZWN1dGVUaW1lbGluZUZpbmlzaFRyaWdnZXJzKHQpOwogICAgICAgICAgICAgICAgdGltZWxpbmVzVG9SZW1vdmUuYWRkKHQpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHRpbWVsaW5lc1RvUmVtb3ZlKSB7CiAgICAgICAgICAgICAgICBDMy5hcnJheVJlbW92ZUFsbEluU2V0KHRoaXMuX21hcmtlZEZvclJlbW92YWxUaW1lbGluZXMsCiAgICAgICAgICAgICAgICAgICAgdGltZWxpbmVzVG9SZW1vdmUpOwogICAgICAgICAgICAgICAgdGhpcy5fcmVuZGVyQ2hhbmdlID0gMDsKICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gdGhpcy5fcGxheWluZ1RpbWVsaW5lcy5sZW5ndGg7IGkgPCBsOyBpKyspCiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX3BsYXlpbmdUaW1lbGluZXNbaV0uR2V0UmVuZGVyQ2hhbmdlKCkgIT09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVuZGVyQ2hhbmdlID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5fTWF5YmVEaXNhYmxlUnVudGltZUxpc3RlbmVycygpCiAgICAgICAgfQogICAgICAgIF9NYXliZUV4ZWN1dGVUaW1lbGluZUZpbmlzaFRyaWdnZXJzKHRpbWVsaW5lKSB7CiAgICAgICAgICAgIGlmICh0aW1lbGluZS5Jc1JlbGVhc2VkKCkpIHJldHVybjsKICAgICAgICAgICAgaWYgKCF0aW1lbGluZS5IYXNWYWxpZFRyYWNrcygpKSByZXR1cm47CiAgICAgICAgICAgIGlmICh0aW1lbGluZS5Jc0NvbXBsZXRlKCkgJiYgdGltZWxpbmUuSW5pdGlhbFN0YXRlU2V0KCkpIHRpbWVsaW5lLkZpbmlzaFRyaWdnZXJzKCkKICAgICAgICB9CiAgICAgICAgX01heWJlRW5hYmxlUnVudGltZUxpc3RlbmVycygpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX2hhc1J1bnRpbWVMaXN0ZW5lcnMpIHJldHVybjsKICAgICAgICAgICAgdGhpcy5faGFzUnVudGltZUxpc3RlbmVycyA9IHRydWUKICAgICAgICB9CiAgICAgICAgX01heWJlRGlzYWJsZVJ1bnRpbWVMaXN0ZW5lcnMoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9tYXJrZWRGb3JSZW1vdmFsVGltZWxpbmVzLmxlbmd0aCkgcmV0dXJuOwogICAgICAgICAgICBpZiAodGhpcy5fcGxheWluZ1RpbWVsaW5lcy5sZW5ndGgpIHJldHVybjsKICAgICAgICAgICAgaWYgKHRoaXMuX3NjaGVkdWxlZFRpbWVsaW5lcy5sZW5ndGgpIHJldHVybjsKICAgICAgICAgICAgaWYgKHRoaXMuX2lzVGlja2luZ1RpbWVsaW5lcykgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl9oYXNSdW50aW1lTGlzdGVuZXJzID0gZmFsc2UKICAgICAgICB9CiAgICAgICAgX09uQmVmb3JlQ2hhbmdlTGF5b3V0KCkgewogICAgICAgICAgICB0aGlzLl9jaGFuZ2luZ0xheW91dCA9IHRydWU7CiAgICAgICAgICAgIHdoaWxlICh0aGlzLl9zY2hlZHVsZWRUaW1lbGluZXMubGVuZ3RoKSB0aGlzLkRlU2NoZWR1bGVUaW1lbGluZSh0aGlzLl9zY2hlZHVsZWRUaW1lbGluZXMucG9wKCkpOwogICAgICAgICAgICBjb25zdCB0aW1lbGluZXNUb1JlbW92ZSA9IG5ldyBTZXQ7CiAgICAgICAgICAgIGZvciAoY29uc3QgdCBvZiB0aGlzLl9wbGF5aW5nVGltZWxpbmVzKSB7CiAgICAgICAgICAgICAgICBjb25zdCByZW1vdmUgPSB0Ll9PbkJlZm9yZUNoYW5nZUxheW91dCgpOwogICAgICAgICAgICAgICAgaWYgKHJlbW92ZSkgewogICAgICAgICAgICAgICAgICAgIHQuUmVtb3ZlZCgpOwogICAgICAgICAgICAgICAgICAgIHRpbWVsaW5lc1RvUmVtb3ZlLmFkZCh0KQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIEMzLmFycmF5UmVtb3ZlQWxsSW5TZXQodGhpcy5fcGxheWluZ1RpbWVsaW5lcywgdGltZWxpbmVzVG9SZW1vdmUpOwogICAgICAgICAgICB0aW1lbGluZXNUb1JlbW92ZS5jbGVhcigpOwogICAgICAgICAgICBmb3IgKGNvbnN0IHQgb2YgdGhpcy5fbWFya2VkRm9yUmVtb3ZhbFRpbWVsaW5lcykgewogICAgICAgICAgICAgICAgY29uc3QgcmVtb3ZlID0gdC5fT25CZWZvcmVDaGFuZ2VMYXlvdXQoKTsKICAgICAgICAgICAgICAgIGlmIChyZW1vdmUpIHsKICAgICAgICAgICAgICAgICAgICB0LlJlbW92ZWQoKTsKICAgICAgICAgICAgICAgICAgICB0aW1lbGluZXNUb1JlbW92ZS5hZGQodCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBDMy5hcnJheVJlbW92ZUFsbEluU2V0KHRoaXMuX21hcmtlZEZvclJlbW92YWxUaW1lbGluZXMsIHRpbWVsaW5lc1RvUmVtb3ZlKTsKICAgICAgICAgICAgdGhpcy5fTWF5YmVEaXNhYmxlUnVudGltZUxpc3RlbmVycygpOwogICAgICAgICAgICBmb3IgKGNvbnN0IHRpbWVsaW5lIG9mIHRoaXMuX3RpbWVsaW5lcykgdGltZWxpbmUuQ2xlYW5DYWNoZXMoKQogICAgICAgIH0KICAgICAgICBfT25BZnRlckNoYW5nZUxheW91dCgpIHsKICAgICAgICAgICAgdGhpcy5fY2hhbmdpbmdMYXlvdXQgPSBmYWxzZQogICAgICAgIH0KICAgICAgICBfT25JbnN0YW5jZURlc3Ryb3koaW5zdGFuY2UpIHsKICAgICAgICAgICAgY29uc3Qgb2JqZWN0Q2xhc3MgPSBpbnN0YW5jZS5HZXRPYmplY3RDbGFzcygpOwogICAgICAgICAgICBjb25zdCB0aW1lbGluZXMgPSB0aGlzLkdldFRpbWVsaW5lc0Zvck9iamVjdENsYXNzKG9iamVjdENsYXNzKTsKICAgICAgICAgICAgaWYgKCF0aW1lbGluZXMpIHJldHVybjsKICAgICAgICAgICAgaWYgKHRoaXMuX3J1bnRpbWUuSXNMb2FkaW5nU3RhdGUoKSkgdGhpcy5fZGVzdHJveWVkV2hpbGVMb2FkaW5nU3RhdGUucHVzaChpbnN0YW5jZSk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgdGltZWxpbmUgb2YgdGltZWxpbmVzKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRpbWVsaW5lLklzVGVtcGxhdGUoKSkgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRpbWVsaW5lLklzUmVsZWFzZWQoKSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLlJlbW92ZSh0aW1lbGluZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICghdGltZWxpbmUuSGFzVmFsaWRUcmFja3MoKSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9NYXliZUV4ZWN1dGVUaW1lbGluZUZpbmlzaFRyaWdnZXJzKHRpbWVsaW5lKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5SZW1vdmUodGltZWxpbmUpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBfT25CZWZvcmVMb2FkKCkgewogICAgICAgICAgICBmb3IgKGNvbnN0IHRpbWVsaW5lIG9mIHRoaXMuX3NjaGVkdWxlZFRpbWVsaW5lcy5tYXAodCA9PiB0KSkgewogICAgICAgICAgICAgICAgdGhpcy5fTWF5YmVFeGVjdXRlVGltZWxpbmVGaW5pc2hUcmlnZ2Vycyh0aW1lbGluZSk7CiAgICAgICAgICAgICAgICB0aGlzLlJlbW92ZSh0aW1lbGluZSkKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IgKGNvbnN0IHRpbWVsaW5lIG9mIHRoaXMuX3BsYXlpbmdUaW1lbGluZXMubWFwKHQgPT4KICAgICAgICAgICAgICAgICAgICB0KSkgewogICAgICAgICAgICAgICAgdGhpcy5fTWF5YmVFeGVjdXRlVGltZWxpbmVGaW5pc2hUcmlnZ2Vycyh0aW1lbGluZSk7CiAgICAgICAgICAgICAgICB0aGlzLlJlbW92ZSh0aW1lbGluZSkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBfT25BZnRlckxvYWQoKSB7CiAgICAgICAgICAgIGZvciAoY29uc3QgZGVzdHJveWVkSW5zdGFuY2Ugb2YgdGhpcy5fZGVzdHJveWVkV2hpbGVMb2FkaW5nU3RhdGUpIHRoaXMuX09uSW5zdGFuY2VEZXN0cm95KGRlc3Ryb3llZEluc3RhbmNlKTsKICAgICAgICAgICAgQzMuY2xlYXJBcnJheSh0aGlzLl9kZXN0cm95ZWRXaGlsZUxvYWRpbmdTdGF0ZSkKICAgICAgICB9CiAgICAgICAgX09uQWZ0ZXJMYXlvdXRTdGFydCgpIHsKICAgICAgICAgICAgY29uc3QgbGF5b3V0TWFuYWdlciA9IHRoaXMuX3J1bnRpbWUuR2V0TGF5b3V0TWFuYWdlcigpOwogICAgICAgICAgICBjb25zdCBydW5uaW5nTGF5b3V0ID0gbGF5b3V0TWFuYWdlci5HZXRNYWluUnVubmluZ0xheW91dCgpOwogICAgICAgICAgICBpZiAoIXJ1bm5pbmdMYXlvdXQpIHJldHVybjsKICAgICAgICAgICAgZm9yIChjb25zdCB0aW1lbGluZSBvZiB0aGlzLl90aW1lbGluZXMpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0T25MYXlvdXQgPSB0aW1lbGluZS5HZXRTdGFydE9uTGF5b3V0KCk7CiAgICAgICAgICAgICAgICBpZiAoIXN0YXJ0T25MYXlvdXQpIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgaWYgKHJ1bm5pbmdMYXlvdXQuR2V0TmFtZSgpID09PSBzdGFydE9uTGF5b3V0KSB0aGlzLlNjaGVkdWxlVGltZWxpbmUodGltZWxpbmUpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgX1NhdmVUb0pzb24oKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAidGltZWxpbmVzSnNvbiI6IHRoaXMuX1NhdmVUaW1lbGluZXNUb0pzb24oKSwKICAgICAgICAgICAgICAgICJzY2hlZHVsZWRUaW1lbGluZXNKc29uIjogdGhpcy5fU2F2ZVNjaGVkdWxlZFRpbWVsaW5lc1RvSnNvbigpLAogICAgICAgICAgICAgICAgInBsYXlpbmdUaW1lbGluZXNKc29uIjogdGhpcy5fU2F2ZVBsYXlpbmdUaW1lbGluZXNUb0pzb24oKSwKICAgICAgICAgICAgICAgICJtYXJrZWRGb3JSZW1vdmFsVGltZWxpbmVzSnNvbiI6IHRoaXMuX1NhdmVNYXJrZWRGb3JSZW1vdmFsVGltZWxpbmVzVG9Kc29uKCksCiAgICAgICAgICAgICAgICAiaGFzUnVudGltZUxpc3RlbmVycyI6IHRoaXMuX2hhc1J1bnRpbWVMaXN0ZW5lcnMsCiAgICAgICAgICAgICAgICAiY2hhbmdpbmdMYXlvdXQiOiB0aGlzLl9jaGFuZ2luZ0xheW91dCwKICAgICAgICAgICAgICAgICJpc1RpY2tpbmdUaW1lbGluZXMiOiB0aGlzLl9pc1RpY2tpbmdUaW1lbGluZXMKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBfTG9hZEZyb21Kc29uKG8pIHsKICAgICAgICAgICAgaWYgKCFvKSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuX0NsZWFyQ3JlYXRlZFRlbXBsYXRlVGltZWxpbmVzQ291bnQoKTsKICAgICAgICAgICAgdGhpcy5fTG9hZFRpbWVsaW5lc0Zyb21Kc29uKG9bInRpbWVsaW5lc0pzb24iXSk7CiAgICAgICAgICAgIHRoaXMuX0xvYWRTY2hlZHVsZWRUaW1lbGluZXNGcm9tSnNvbihvWyJzY2hlZHVsZWRUaW1lbGluZXNKc29uIl0pOwogICAgICAgICAgICB0aGlzLl9Mb2FkUGxheWluZ1RpbWVsaW5lc0Zyb21Kc29uKG9bInBsYXlpbmdUaW1lbGluZXNKc29uIl0pOwogICAgICAgICAgICB0aGlzLl9Mb2FkTWFya2VkRm9yUmVtb3ZhbFRpbWVsaW5lc0Zyb21Kc29uKG9bIm1hcmtlZEZvclJlbW92YWxUaW1lbGluZXNKc29uIl0pOwogICAgICAgICAgICB0aGlzLl9oYXNSdW50aW1lTGlzdGVuZXJzID0gIW9bImhhc1J1bnRpbWVMaXN0ZW5lcnMiXTsKICAgICAgICAgICAgdGhpcy5fY2hhbmdpbmdMYXlvdXQgPSAhIW9bImNoYW5naW5nTGF5b3V0Il07CiAgICAgICAgICAgIHRoaXMuX2lzVGlja2luZ1RpbWVsaW5lcyA9ICEhb1siaXNUaWNraW5nVGltZWxpbmVzIl07CiAgICAgICAgICAgIHRoaXMuX1NldENyZWF0ZWRUZW1wbGF0ZVRpbWVsaW5lc0NvdW50KCk7CiAgICAgICAgICAgIHRoaXMuX01heWJlRW5hYmxlUnVudGltZUxpc3RlbmVycygpOwogICAgICAgICAgICB0aGlzLl9NYXliZURpc2FibGVSdW50aW1lTGlzdGVuZXJzKCkKICAgICAgICB9CiAgICAgICAgX1NhdmVUaW1lbGluZXNUb0pzb24oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl90aW1lbGluZXMubWFwKHRpbWVsaW5lU3RhdGUgPT4KICAgICAgICAgICAgICAgIHRpbWVsaW5lU3RhdGUuX1NhdmVUb0pzb24oKSkKICAgICAgICB9CiAgICAgICAgX0xvYWRUaW1lbGluZXNGcm9tSnNvbih0aW1lbGluZXNKc29uKSB7CiAgICAgICAgICAgIGZvciAoY29uc3QgdGltZWxpbmVKc29uIG9mIHRpbWVsaW5lc0pzb24pIHsKICAgICAgICAgICAgICAgIGxldCB0aW1lbGluZSA9IHRoaXMuR2V0VGltZWxpbmVCeU5hbWUodGltZWxpbmVKc29uWyJuYW1lIl0pOwogICAgICAgICAgICAgICAgaWYgKHRpbWVsaW5lKSB0aW1lbGluZS5fTG9hZEZyb21Kc29uKHRpbWVsaW5lSnNvbik7CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCB0ZW1wbGF0ZU5hbWUgPSB0aGlzLl9HZXRUZW1wbGF0ZU5hbWVGcm9tSnNvbih0aW1lbGluZUpzb24pOwogICAgICAgICAgICAgICAgICAgIGlmICghdGVtcGxhdGVOYW1lKSBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICBjb25zdCB0ZW1wbGF0ZVRpbWVsaW5lID0gdGhpcy5HZXRUaW1lbGluZUJ5TmFtZSh0ZW1wbGF0ZU5hbWUpOwogICAgICAgICAgICAgICAgICAgIHRpbWVsaW5lID0gdGhpcy5DcmVhdGVGcm9tVGVtcGxhdGUodGVtcGxhdGVUaW1lbGluZSk7CiAgICAgICAgICAgICAgICAgICAgdGltZWxpbmUuX0xvYWRGcm9tSnNvbih0aW1lbGluZUpzb24pCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoIXRpbWVsaW5lLkhhc1RyYWNrcygpKSB0aGlzLlJlbW92ZSh0aW1lbGluZSkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBfR2V0VGVtcGxhdGVOYW1lRnJvbUpzb24odGltZWxpbmVKc29uKSB7CiAgICAgICAgICAgIGNvbnN0IG5hbWUgPQogICAgICAgICAgICAgICAgdGltZWxpbmVKc29uWyJuYW1lIl07CiAgICAgICAgICAgIGNvbnN0IG5hbWVQYXJ0cyA9IG5hbWUuc3BsaXQoIjoiKTsKICAgICAgICAgICAgaWYgKCFuYW1lUGFydHMgfHwgbmFtZVBhcnRzLmxlbmd0aCAhPT0gMikgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIHJldHVybiBuYW1lUGFydHNbMF0KICAgICAgICB9CiAgICAgICAgX1NhdmVTY2hlZHVsZWRUaW1lbGluZXNUb0pzb24oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9TYXZlVGltZWxpbmVzKHRoaXMuX3NjaGVkdWxlZFRpbWVsaW5lcykKICAgICAgICB9CiAgICAgICAgX0xvYWRTY2hlZHVsZWRUaW1lbGluZXNGcm9tSnNvbihzY2hlZHVsZWRUaW1lbGluZXNKc29uKSB7CiAgICAgICAgICAgIHRoaXMuX0xvYWRUaW1lbGluZXMoc2NoZWR1bGVkVGltZWxpbmVzSnNvbiwgdGhpcy5fc2NoZWR1bGVkVGltZWxpbmVzKQogICAgICAgIH0KICAgICAgICBfU2F2ZVBsYXlpbmdUaW1lbGluZXNUb0pzb24oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9TYXZlVGltZWxpbmVzKHRoaXMuX3BsYXlpbmdUaW1lbGluZXMpCiAgICAgICAgfQogICAgICAgIF9Mb2FkUGxheWluZ1RpbWVsaW5lc0Zyb21Kc29uKHBsYXlpbmdUaW1lbGluZXNKc29uKSB7CiAgICAgICAgICAgIHRoaXMuX0xvYWRUaW1lbGluZXMocGxheWluZ1RpbWVsaW5lc0pzb24sCiAgICAgICAgICAgICAgICB0aGlzLl9wbGF5aW5nVGltZWxpbmVzKQogICAgICAgIH0KICAgICAgICBfU2F2ZU1hcmtlZEZvclJlbW92YWxUaW1lbGluZXNUb0pzb24oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9TYXZlVGltZWxpbmVzKHRoaXMuX21hcmtlZEZvclJlbW92YWxUaW1lbGluZXMpCiAgICAgICAgfQogICAgICAgIF9Mb2FkTWFya2VkRm9yUmVtb3ZhbFRpbWVsaW5lc0Zyb21Kc29uKG1hcmtlZEZvclJlbW92YWxUaW1lbGluZXNKc29uKSB7CiAgICAgICAgICAgIHRoaXMuX0xvYWRUaW1lbGluZXMobWFya2VkRm9yUmVtb3ZhbFRpbWVsaW5lc0pzb24sIHRoaXMuX21hcmtlZEZvclJlbW92YWxUaW1lbGluZXMpCiAgICAgICAgfQogICAgICAgIF9Jc1RpbWVsaW5lSW5Kc29uKHRpbWVsaW5lLCBqc29uKSB7CiAgICAgICAgICAgIGlmICghanNvbikgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBmb3IgKGNvbnN0IG5hbWUgb2YganNvbikKICAgICAgICAgICAgICAgIGlmIChuYW1lID09PSB0aW1lbGluZS5HZXROYW1lKCkpIHJldHVybiB0cnVlOwogICAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICB9CiAgICAgICAgX1NhdmVUaW1lbGluZXMoY29sbGVjdGlvbikgewogICAgICAgICAgICByZXR1cm4gY29sbGVjdGlvbi5tYXAodCA9PiB0LkdldE5hbWUoKSkKICAgICAgICB9CiAgICAgICAgX0xvYWRUaW1lbGluZXModGltZWxpbmVzSnNvbiwKICAgICAgICAgICAgY29sbGVjdGlvbikgewogICAgICAgICAgICBjb25zdCB0aW1lbGluZXNUb1JlbW92ZSA9IG5ldyBTZXQ7CiAgICAgICAgICAgIGZvciAoY29uc3QgdGltZWxpbmUgb2YgY29sbGVjdGlvbikKICAgICAgICAgICAgICAgIGlmICghdGhpcy5fSXNUaW1lbGluZUluSnNvbih0aW1lbGluZSwgdGltZWxpbmVzSnNvbikpIHRpbWVsaW5lc1RvUmVtb3ZlLmFkZCh0aW1lbGluZSk7CiAgICAgICAgICAgIEMzLmFycmF5UmVtb3ZlQWxsSW5TZXQoY29sbGVjdGlvbiwgdGltZWxpbmVzVG9SZW1vdmUpOwogICAgICAgICAgICBpZiAodGltZWxpbmVzSnNvbikgewogICAgICAgICAgICAgICAgY29uc3QgZmYgPSB0biA9PiB0ID0+IHQuR2V0TmFtZSgpID09PSB0bjsKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgbmFtZSBvZiB0aW1lbGluZXNKc29uKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdGltZWxpbmUgPSB0aGlzLkdldFRpbWVsaW5lQnlOYW1lKG5hbWUpOwogICAgICAgICAgICAgICAgICAgIGlmICh0aW1lbGluZSkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0ID0gY29sbGVjdGlvbi5maW5kKGZmKG5hbWUpKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0KSBjb2xsZWN0aW9uLnB1c2godGltZWxpbmUpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKCn0KCi8vIHRpbWVsaW5lcy90aW1lbGluZUluZm8uanMKewogICAgJ3VzZSBzdHJpY3QnOwogICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgY29uc3QgU1RFUFMgPSAxMDA7CiAgICBjb25zdCBMRU5HVEhfU1RFUF9TSVpFID0gLjAxOwogICAgY29uc3QgQkVaSUVSX1NURVBfU0laRSA9IDMwOwogICAgY29uc3QgVEFOR0VOVF9SRVNVTFQgPSBbMCwgMF07CiAgICBjb25zdCBNQVBfUkVTVUxUID0gWzAsIDBdOwogICAgY29uc3QgUFJPSkVDVElPTl9SRVNVTFQgPSBbMCwgMCwgMCwgMCwgMF07CiAgICBDMy5UaW1lbGluZUluZm8gPSBjbGFzcyBUaW1lbGluZUluZm8gewogICAgICAgIGNvbnN0cnVjdG9yKHRpbWVsaW5lLCB0cmFja0lkKSB7CiAgICAgICAgICAgIHRoaXMuX2luaXRpYWxpemVkID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX3RpbWVsaW5lID0gdGltZWxpbmU7CiAgICAgICAgICAgIHRoaXMuX3NlZ21lbnRzID0gW107CiAgICAgICAgICAgIGxldCB0cmFja1N0YXRlID0gbnVsbDsKICAgICAgICAgICAgaWYgKHRyYWNrSWQpIHRyYWNrU3RhdGUgPSB0aGlzLl90aW1lbGluZS5HZXRUcmFja0J5SWQodHJhY2tJZCk7CiAgICAgICAgICAgIGVsc2UgdHJhY2tTdGF0ZSA9IEMzLmZpcnN0KHRoaXMuX3RpbWVsaW5lLkdldFRyYWNrcygpKTsKICAgICAgICAgICAgaWYgKCF0cmFja1N0YXRlKSByZXR1cm47CiAgICAgICAgICAgIGNvbnN0IHhUcmFjayA9IHRyYWNrU3RhdGUuR2V0UHJvcGVydHlUcmFjaygib2Zmc2V0WCIpOwogICAgICAgICAgICBjb25zdCB5VHJhY2sgPSB0cmFja1N0YXRlLkdldFByb3BlcnR5VHJhY2soIm9mZnNldFkiKTsKICAgICAgICAgICAgaWYgKCF4VHJhY2sgfHwgIXlUcmFjaykgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl94VHJhY2sgPSB4VHJhY2s7CiAgICAgICAgICAgIHRoaXMuX3lUcmFjayA9IHlUcmFjazsKICAgICAgICAgICAgY29uc3QgeFByb3BlcnR5S2V5ZnJhbWVzID0geFRyYWNrLkdldFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbUFycmF5SW5jbHVkaW5nRGlzYWJsZWQoKTsKICAgICAgICAgICAgY29uc3QgeVByb3BlcnR5S2V5ZnJhbWVzID0geVRyYWNrLkdldFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbUFycmF5SW5jbHVkaW5nRGlzYWJsZWQoKTsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDEsIGxlbiA9IE1hdGgubWluKHhQcm9wZXJ0eUtleWZyYW1lcy5sZW5ndGgsIHlQcm9wZXJ0eUtleWZyYW1lcy5sZW5ndGgpOyBpIDwgbGVuOyArK2kpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0WCA9IHhQcm9wZXJ0eUtleWZyYW1lc1tpXTsKICAgICAgICAgICAgICAgIGNvbnN0IGVuZFggPSBzdGFydFguR2V0TmV4dCgpOwogICAgICAgICAgICAgICAgY29uc3QgcHJldlggPSBzdGFydFguR2V0UHJldmlvdXMoKTsKICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0WSA9IHlQcm9wZXJ0eUtleWZyYW1lc1tpXTsKICAgICAgICAgICAgICAgIGNvbnN0IGVuZFkgPSBzdGFydFkuR2V0TmV4dCgpOwogICAgICAgICAgICAgICAgY29uc3QgcHJldlkgPSBzdGFydFkuR2V0UHJldmlvdXMoKTsKICAgICAgICAgICAgICAgIGlmIChwcmV2WCAmJiBwcmV2WC5HZXRQYXRoTW9kZSgpID09PSAiY3ViaWMtYmV6aWVyIiAmJiBwcmV2WSAmJiBwcmV2WS5HZXRQYXRoTW9kZSgpID09PSAiY3ViaWMtYmV6aWVyIikgdGhpcy5fc2VnbWVudHMucHVzaChDMy5OZXcoQzMuVGltZWxpbmVDdWJpY0JlemllclNlZ21lbnRJbmZvLAogICAgICAgICAgICAgICAgICAgIHByZXZYLCBwcmV2WSwgc3RhcnRYLCBzdGFydFksIHRoaXMuX3NlZ21lbnRzLmxlbmd0aCkpOwogICAgICAgICAgICAgICAgZWxzZSBpZiAocHJldlggJiYgcHJldlguR2V0UGF0aE1vZGUoKSA9PT0gImxpbmUiICYmIHByZXZZICYmIHByZXZZLkdldFBhdGhNb2RlKCkgPT09ICJsaW5lIikgdGhpcy5fc2VnbWVudHMucHVzaChDMy5OZXcoQzMuVGltZWxpbmVMaW5lU2VnbWVudEluZm8sIHN0YXJ0WCwgc3RhcnRZLCB0aGlzLl9zZWdtZW50cy5sZW5ndGgpKTsKICAgICAgICAgICAgICAgIGVsc2UgdGhpcy5fc2VnbWVudHMucHVzaChDMy5OZXcoQzMuVGltZWxpbmVMaW5lU2VnbWVudEluZm8sIHN0YXJ0WCwgc3RhcnRZLCB0aGlzLl9zZWdtZW50cy5sZW5ndGgpKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuX2luaXRpYWxpemVkID0gdHJ1ZQogICAgICAgIH0KICAgICAgICBSZWxlYXNlKCkgewogICAgICAgICAgICBmb3IgKGNvbnN0IHNlZ21lbnQgb2YgdGhpcy5fc2VnbWVudHMpIHNlZ21lbnQuUmVsZWFzZSgpOwogICAgICAgICAgICBDMy5jbGVhckFycmF5KHRoaXMuX3NlZ21lbnRzKTsKICAgICAgICAgICAgdGhpcy5fc2VnbWVudHMgPSBudWxsOwogICAgICAgICAgICB0aGlzLl90aW1lbGluZSA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3hUcmFjayA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3lUcmFjayA9CiAgICAgICAgICAgICAgICBudWxsCiAgICAgICAgfQogICAgICAgIFdhc0luaXRpYWxpemVkKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faW5pdGlhbGl6ZWQKICAgICAgICB9CiAgICAgICAgc2VnbWVudHMoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zZWdtZW50cwogICAgICAgIH0KICAgICAgICBTZXRPcmlnaW4od2kpIHsKICAgICAgICAgICAgY29uc3Qgb3ggPSB0aGlzLl94VHJhY2suR2V0UmVzdWx0TW9kZSgpID09PSAicmVsYXRpdmUiID8gd2kuR2V0WCgpIDogMDsKICAgICAgICAgICAgY29uc3Qgb3kgPSB0aGlzLl95VHJhY2suR2V0UmVzdWx0TW9kZSgpID09PSAicmVsYXRpdmUiID8gd2kuR2V0WSgpIDogMDsKICAgICAgICAgICAgZm9yIChjb25zdCBzZWdtZW50IG9mIHRoaXMuX3NlZ21lbnRzKSBzZWdtZW50LlNldE9yaWdpbihveCwgb3kpCiAgICAgICAgfQogICAgICAgIFByb2plY3QoeCwgeSwgb3B0cykgewogICAgICAgICAgICBpZiAob3B0cyAmJiBvcHRzLnRSYW5nZSkgewogICAgICAgICAgICAgICAgaWYgKCFDMy5Jc0Zpbml0ZU51bWJlcihvcHRzLnRSYW5nZVswXSkpIG9wdHMudFJhbmdlWzBdID0gMDsKICAgICAgICAgICAgICAgIGlmICghQzMuSXNGaW5pdGVOdW1iZXIob3B0cy50UmFuZ2VbMV0pKSBvcHRzLnRSYW5nZVsxXSA9IDEKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCByZXQgPSBbXTsKICAgICAgICAgICAgZm9yIChjb25zdCBzZWdtZW50IG9mIHRoaXMuX3NlZ21lbnRzKQogICAgICAgICAgICAgICAgaWYgKHNlZ21lbnQuR2V0VHlwZSgpID09PQogICAgICAgICAgICAgICAgICAgICJjdWJpYy1iZXppZXIiKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcCA9IHNlZ21lbnQuUHJvamVjdCh4LCB5LCBvcHRzID8gb3B0cy50UmFuZ2UgOiBudWxsKTsKICAgICAgICAgICAgICAgICAgICBwWzRdID0gc2VnbWVudC5HZXRJbmRleCgpOwogICAgICAgICAgICAgICAgICAgIHJldC5wdXNoKEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkocCkpKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICByZXQuc29ydCgoZiwgcykgPT4gZlszXSAtIHNbM10pOwogICAgICAgICAgICByZXR1cm4gcmV0WzBdCiAgICAgICAgfQogICAgICAgIFRhbmdlbnQodCwgc2VnbWVudEluZGV4KSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zZWdtZW50c1tzZWdtZW50SW5kZXhdLlRhbmdlbnQodCkKICAgICAgICB9CiAgICAgICAgVGFuZ2VudEFuZ2xlKHgsIHksIHQsIHNlZ21lbnRJbmRleCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fc2VnbWVudHNbc2VnbWVudEluZGV4XS5UYW5nZW50QW5nbGUoeCwgeSwgdCkKICAgICAgICB9CiAgICB9OwogICAgQzMuVGltZWxpbmVDdWJpY0JlemllclNlZ21lbnRJbmZvID0gY2xhc3MgVGltZWxpbmVDdWJpY0JlemllclNlZ21lbnRJbmZvIHsKICAgICAgICBjb25zdHJ1Y3RvcihzdGFydFgsIHN0YXJ0WSwgZW5kWCwgZW5kWSwgaW5kZXgpIHsKICAgICAgICAgICAgdGhpcy5faW5kZXggPSBpbmRleDsKICAgICAgICAgICAgY29uc3Qgc3RhcnRYQWRkb24gPSBzdGFydFguR2V0QWRkT24oImN1YmljLWJlemllciIpOwogICAgICAgICAgICBjb25zdCBlbmRYQWRkb24gPSBlbmRYLkdldEFkZE9uKCJjdWJpYy1iZXppZXIiKTsKICAgICAgICAgICAgY29uc3Qgc3RhcnRZQWRkb24gPSBzdGFydFkuR2V0QWRkT24oImN1YmljLWJlemllciIpOwogICAgICAgICAgICBjb25zdCBlbmRZQWRkb24gPSBlbmRZLkdldEFkZE9uKCJjdWJpYy1iZXppZXIiKTsKICAgICAgICAgICAgdGhpcy5fYVggPSBzdGFydFguR2V0VmFsdWVXaXRoUmVzdWx0TW9kZSgpOwogICAgICAgICAgICB0aGlzLl9hWSA9IHN0YXJ0WS5HZXRWYWx1ZVdpdGhSZXN1bHRNb2RlKCk7CiAgICAgICAgICAgIHRoaXMuX2JYID0gc3RhcnRYLkdldFZhbHVlV2l0aFJlc3VsdE1vZGUoKSArIHN0YXJ0WEFkZG9uLkdldFN0YXJ0QW5jaG9yKCk7CiAgICAgICAgICAgIHRoaXMuX2JZID0gc3RhcnRZLkdldFZhbHVlV2l0aFJlc3VsdE1vZGUoKSArCiAgICAgICAgICAgICAgICBzdGFydFlBZGRvbi5HZXRTdGFydEFuY2hvcigpOwogICAgICAgICAgICB0aGlzLl9jWCA9IGVuZFguR2V0VmFsdWVXaXRoUmVzdWx0TW9kZSgpICsgZW5kWEFkZG9uLkdldEVuZEFuY2hvcigpOwogICAgICAgICAgICB0aGlzLl9jWSA9IGVuZFkuR2V0VmFsdWVXaXRoUmVzdWx0TW9kZSgpICsgZW5kWUFkZG9uLkdldEVuZEFuY2hvcigpOwogICAgICAgICAgICB0aGlzLl9kWCA9IGVuZFguR2V0VmFsdWVXaXRoUmVzdWx0TW9kZSgpOwogICAgICAgICAgICB0aGlzLl9kWSA9IGVuZFkuR2V0VmFsdWVXaXRoUmVzdWx0TW9kZSgpOwogICAgICAgICAgICB0aGlzLl9pbml0aWFsaXplZCA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl9sZW4gPSBTVEVQUzsKICAgICAgICAgICAgdGhpcy5fYXJjTGVuZ3RocyA9IG5ldyBBcnJheSh0aGlzLl9sZW4gKyAxKTsKICAgICAgICAgICAgdGhpcy5fYXJjTGVuZ3Roc1swXSA9IDA7CiAgICAgICAgICAgIHRoaXMuX2xlbmd0aCA9IDA7CiAgICAgICAgICAgIHRoaXMuX2x1dCA9IFtdOwogICAgICAgICAgICB0aGlzLl9DYWxjdWxhdGVMZW5ndGgoKQogICAgICAgIH0KICAgICAgICBSZWxlYXNlKCkgewogICAgICAgICAgICBDMy5jbGVhckFycmF5KHRoaXMuX2FyY0xlbmd0aHMpOwogICAgICAgICAgICB0aGlzLl9hcmNMZW5ndGhzID0gbnVsbDsKICAgICAgICAgICAgQzMuY2xlYXJBcnJheSh0aGlzLl9sdXQpOwogICAgICAgICAgICB0aGlzLl9sdXQgPSBudWxsCiAgICAgICAgfQogICAgICAgIEdldFR5cGUoKSB7CiAgICAgICAgICAgIHJldHVybiAiY3ViaWMtYmV6aWVyIgogICAgICAgIH0KICAgICAgICBHZXRJbmRleCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2luZGV4CiAgICAgICAgfQogICAgICAgIEdldFN0ZXBDb3VudCgpIHsKICAgICAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IodGhpcy5fbGVuZ3RoIC8KICAgICAgICAgICAgICAgIEJFWklFUl9TVEVQX1NJWkUpCiAgICAgICAgfQogICAgICAgIEdldFN0ZXBJbmNyZW1lbnQoKSB7CiAgICAgICAgICAgIHJldHVybiAxIC8gdGhpcy5HZXRTdGVwQ291bnQoKQogICAgICAgIH0KICAgICAgICBTZXRPcmlnaW4ob3gsIG95KSB7CiAgICAgICAgICAgIHRoaXMuX29yaWdpblggPSBveDsKICAgICAgICAgICAgdGhpcy5fb3JpZ2luWSA9IG95OwogICAgICAgICAgICB0aGlzLl9hcmNMZW5ndGhzID0gbmV3IEFycmF5KHRoaXMuX2xlbiArIDEpOwogICAgICAgICAgICB0aGlzLl9hcmNMZW5ndGhzWzBdID0gMDsKICAgICAgICAgICAgdGhpcy5fQ2FsY3VsYXRlTGVuZ3RoKCkKICAgICAgICB9CiAgICAgICAgTWFwKHUpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLl9pbml0aWFsaXplZCkgcmV0dXJuIE5hTjsKICAgICAgICAgICAgY29uc3QgbXQgPSB0aGlzLl9NYXAodSk7CiAgICAgICAgICAgIE1BUF9SRVNVTFRbMF0gPSB0aGlzLl9YKG10KTsKICAgICAgICAgICAgTUFQX1JFU1VMVFsxXSA9IHRoaXMuX1kobXQpOwogICAgICAgICAgICByZXR1cm4gTUFQX1JFU1VMVAogICAgICAgIH0KICAgICAgICBQcm9qZWN0KHgsIHksIHRSYW5nZSkgewogICAgICAgICAgICBjb25zdCBsdXQgPSB0aGlzLl9HZW5lcmF0ZUxVVChTVEVQUyk7CiAgICAgICAgICAgIGNvbnN0IGkgPSB0aGlzLl9GaW5kQ2xvc2VzdEZyb21MVVQoeCwgeSwgbHV0LCB0UmFuZ2UpOwogICAgICAgICAgICBjb25zdCBwID0gdGhpcy5fUmVmaW5lUHJvamVjdGlvbih4LCB5LCBsdXQsIGkpOwogICAgICAgICAgICBQUk9KRUNUSU9OX1JFU1VMVFswXSA9CiAgICAgICAgICAgICAgICBwLng7CiAgICAgICAgICAgIFBST0pFQ1RJT05fUkVTVUxUWzFdID0gcC55OwogICAgICAgICAgICBQUk9KRUNUSU9OX1JFU1VMVFsyXSA9IHAudDsKICAgICAgICAgICAgUFJPSkVDVElPTl9SRVNVTFRbM10gPSBwLmRpc3RhbmNlOwogICAgICAgICAgICByZXR1cm4gUFJPSkVDVElPTl9SRVNVTFQKICAgICAgICB9CiAgICAgICAgVGFuZ2VudCh0KSB7CiAgICAgICAgICAgIGNvbnN0IG10ID0gMSAtIHQ7CiAgICAgICAgICAgIGNvbnN0IGEgPSBtdCAqIG10OwogICAgICAgICAgICBjb25zdCBiID0gMiAqIG10ICogdDsKICAgICAgICAgICAgY29uc3QgYyA9IHQgKiB0OwogICAgICAgICAgICBjb25zdCBkMHggPSAzICogKHRoaXMuX2JYICsgdGhpcy5fb3JpZ2luWCAtICh0aGlzLl9hWCArIHRoaXMuX29yaWdpblgpKTsKICAgICAgICAgICAgY29uc3QgZDB5ID0gMyAqICh0aGlzLl9iWSArIHRoaXMuX29yaWdpblkgLSAodGhpcy5fYVkgKyB0aGlzLl9vcmlnaW5ZKSk7CiAgICAgICAgICAgIGNvbnN0IGQxeCA9IDMgKiAodGhpcy5fY1ggKyB0aGlzLl9vcmlnaW5YIC0gKHRoaXMuX2JYICsgdGhpcy5fb3JpZ2luWCkpOwogICAgICAgICAgICBjb25zdCBkMXkgPSAzICogKHRoaXMuX2NZICsgdGhpcy5fb3JpZ2luWSAtICh0aGlzLl9iWSArIHRoaXMuX29yaWdpblkpKTsKICAgICAgICAgICAgY29uc3QgZDJ4ID0gMyAqICh0aGlzLl9kWCArIHRoaXMuX29yaWdpblggLSAodGhpcy5fY1ggKyB0aGlzLl9vcmlnaW5YKSk7CiAgICAgICAgICAgIGNvbnN0IGQyeSA9IDMgKiAodGhpcy5fZFkgKwogICAgICAgICAgICAgICAgdGhpcy5fb3JpZ2luWSAtICh0aGlzLl9jWSArIHRoaXMuX29yaWdpblkpKTsKICAgICAgICAgICAgY29uc3QgZHggPSBhICogZDB4ICsgYiAqIGQxeCArIGMgKiBkMng7CiAgICAgICAgICAgIGNvbnN0IGR5ID0gYSAqIGQweSArIGIgKiBkMXkgKyBjICogZDJ5OwogICAgICAgICAgICBjb25zdCBtID0gTWF0aC5oeXBvdChkeCwgZHkpOwogICAgICAgICAgICBUQU5HRU5UX1JFU1VMVFswXSA9IGR4IC8gbTsKICAgICAgICAgICAgVEFOR0VOVF9SRVNVTFRbMV0gPSBkeSAvIG07CiAgICAgICAgICAgIHJldHVybiBUQU5HRU5UX1JFU1VMVAogICAgICAgIH0KICAgICAgICBUYW5nZW50QW5nbGUoeCwgeSwgdCkgewogICAgICAgICAgICBjb25zdCB0YW5nZXQgPSB0aGlzLlRhbmdlbnQodCk7CiAgICAgICAgICAgIGNvbnN0IGFuZ2xlID0gQzMuYW5nbGVUbyh4LCB5LCB4ICsgdGFuZ2V0WzBdLCB5ICsgdGFuZ2V0WzFdKTsKICAgICAgICAgICAgcmV0dXJuIGFuZ2xlCiAgICAgICAgfQogICAgICAgIF9NYXAodSkgewogICAgICAgICAgICBpZiAoIXRoaXMuX2luaXRpYWxpemVkKSByZXR1cm47CiAgICAgICAgICAgIGxldCB0YXJnZXRMZW5ndGggPSB1ICogdGhpcy5fYXJjTGVuZ3Roc1t0aGlzLl9sZW5dOwogICAgICAgICAgICBsZXQgbG93ID0gMDsKICAgICAgICAgICAgbGV0IGhpZ2ggPSB0aGlzLl9sZW47CiAgICAgICAgICAgIGxldCBpbmRleCA9IDA7CiAgICAgICAgICAgIHdoaWxlIChsb3cgPCBoaWdoKSB7CiAgICAgICAgICAgICAgICBpbmRleCA9IGxvdyArICgoaGlnaCAtIGxvdykgLyAyIHwgMCk7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fYXJjTGVuZ3Roc1tpbmRleF0gPCB0YXJnZXRMZW5ndGgpIGxvdyA9CiAgICAgICAgICAgICAgICAgICAgaW5kZXggKyAxOwogICAgICAgICAgICAgICAgZWxzZSBoaWdoID0gaW5kZXgKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGhpcy5fYXJjTGVuZ3Roc1tpbmRleF0gPiB0YXJnZXRMZW5ndGgpIGluZGV4LS07CiAgICAgICAgICAgIGNvbnN0IGxlbmd0aEJlZm9yZSA9IHRoaXMuX2FyY0xlbmd0aHNbaW5kZXhdOwogICAgICAgICAgICBpZiAobGVuZ3RoQmVmb3JlID09PSB0YXJnZXRMZW5ndGgpIHJldHVybiBpbmRleCAvIHRoaXMuX2xlbjsKICAgICAgICAgICAgZWxzZSByZXR1cm4gKGluZGV4ICsgKHRhcmdldExlbmd0aCAtIGxlbmd0aEJlZm9yZSkgLyAodGhpcy5fYXJjTGVuZ3Roc1tpbmRleCArIDFdIC0gbGVuZ3RoQmVmb3JlKSkgLyB0aGlzLl9sZW4KICAgICAgICB9CiAgICAgICAgX1godCkgewogICAgICAgICAgICBpZiAoIXRoaXMuX2luaXRpYWxpemVkKSByZXR1cm4gTmFOOwogICAgICAgICAgICByZXR1cm4gc2VsZi5FYXNlLkdldFJ1bnRpbWVFYXNlKCJjdWJpY2JlemllciIpKHQsIHRoaXMuX2FYICsgdGhpcy5fb3JpZ2luWCwgdGhpcy5fYlggKyB0aGlzLl9vcmlnaW5YLCB0aGlzLl9jWCArIHRoaXMuX29yaWdpblgsIHRoaXMuX2RYICsgdGhpcy5fb3JpZ2luWCkKICAgICAgICB9CiAgICAgICAgX1kodCkgewogICAgICAgICAgICBpZiAoIXRoaXMuX2luaXRpYWxpemVkKSByZXR1cm4gTmFOOwogICAgICAgICAgICByZXR1cm4gc2VsZi5FYXNlLkdldFJ1bnRpbWVFYXNlKCJjdWJpY2JlemllciIpKHQsCiAgICAgICAgICAgICAgICB0aGlzLl9hWSArIHRoaXMuX29yaWdpblksIHRoaXMuX2JZICsgdGhpcy5fb3JpZ2luWSwgdGhpcy5fY1kgKyB0aGlzLl9vcmlnaW5ZLCB0aGlzLl9kWSArIHRoaXMuX29yaWdpblkpCiAgICAgICAgfQogICAgICAgIF9HZW5lcmF0ZUxVVChzdGVwcykgewogICAgICAgICAgICBzdGVwcyA9IHN0ZXBzIHx8IFNURVBTOwogICAgICAgICAgICBpZiAodGhpcy5fbHV0Lmxlbmd0aCA9PT0gc3RlcHMpIHJldHVybiB0aGlzLl9sdXQ7CiAgICAgICAgICAgIHRoaXMuX2x1dCA9IFtdOwogICAgICAgICAgICBzdGVwcysrOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHN0ZXBzOyBpKyspIHsKICAgICAgICAgICAgICAgIGNvbnN0IHQgPSBpIC8gKHN0ZXBzIC0gMSk7CiAgICAgICAgICAgICAgICBjb25zdCB4ID0gdGhpcy5fWCh0KTsKICAgICAgICAgICAgICAgIGNvbnN0IHkgPSB0aGlzLl9ZKHQpOwogICAgICAgICAgICAgICAgdGhpcy5fbHV0LnB1c2goewogICAgICAgICAgICAgICAgICAgIHg6IHgsCiAgICAgICAgICAgICAgICAgICAgeTogeSwKICAgICAgICAgICAgICAgICAgICB0OiB0LAogICAgICAgICAgICAgICAgICAgIGRpc3RhbmNlOiAwCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9sdXQKICAgICAgICB9CiAgICAgICAgX0ZpbmRDbG9zZXN0RnJvbUxVVCh4LCB5LCBMVVQsIHRSYW5nZSA9IG51bGwsIGRpc3RhbmNlID0gTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVIpIHsKICAgICAgICAgICAgbGV0IGkgPSAwOwogICAgICAgICAgICBMVVQuZm9yRWFjaCgocCwgaW5kZXgpID0+IHsKICAgICAgICAgICAgICAgIHAudCA9IGluZGV4IC8gKExVVC5sZW5ndGggLSAxKTsKICAgICAgICAgICAgICAgIHAuZGlzdGFuY2UgPSBDMy5kaXN0YW5jZVRvKHgsIHksIHAueCwKICAgICAgICAgICAgICAgICAgICBwLnkpOwogICAgICAgICAgICAgICAgaWYgKHRSYW5nZSAmJiBDMy5Jc0FycmF5KHRSYW5nZSkgJiYgQzMuSXNGaW5pdGVOdW1iZXIodFJhbmdlWzBdKSAmJiBDMy5Jc0Zpbml0ZU51bWJlcih0UmFuZ2VbMV0pKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHAudCA+PSB0UmFuZ2VbMF0gJiYgcC50IDw9IHRSYW5nZVsxXSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHAuZGlzdGFuY2UgPCBkaXN0YW5jZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzdGFuY2UgPSBwLmRpc3RhbmNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaSA9IGluZGV4CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocC5kaXN0YW5jZSA8IGRpc3RhbmNlKSB7CiAgICAgICAgICAgICAgICAgICAgZGlzdGFuY2UgPSBwLmRpc3RhbmNlOwogICAgICAgICAgICAgICAgICAgIGkgPSBpbmRleAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuIGkKICAgICAgICB9CiAgICAgICAgX1JlZmluZVByb2plY3Rpb24oeCwgeSwgTFVULCBpLCB0YXJnZXREaXN0YW5jZSA9IDAsIGVwc2lsb24gPSAxKSB7CiAgICAgICAgICAgIGxldCBxID0gTFVUW2ldOwogICAgICAgICAgICBsZXQgY291bnQgPSAxOwogICAgICAgICAgICBsZXQgZGlzdGFuY2UgPSBOdW1iZXIuTUFYX1NBRkVfSU5URUdFUjsKICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgICAgbGV0IGkxID0gaSA9PT0gMCA/IDAgOiBpIC0gMTsKICAgICAgICAgICAgICAgIGxldCBpMiA9IGkgPT09IExVVC5sZW5ndGggLSAxID8gTFVULmxlbmd0aCAtIDEgOiBpICsgMTsKICAgICAgICAgICAgICAgIGxldCB0MSA9IExVVFtpMV0udDsKICAgICAgICAgICAgICAgIGxldCB0MiA9IExVVFtpMl0udDsKICAgICAgICAgICAgICAgIGxldCBsdXQgPSBbXTsKICAgICAgICAgICAgICAgIGxldCBzdGVwID0gKHQyIC0gdDEpIC8gNDsKICAgICAgICAgICAgICAgIGlmIChzdGVwIDwKICAgICAgICAgICAgICAgICAgICAuMDAxKSBicmVhazsKICAgICAgICAgICAgICAgIGx1dC5wdXNoKExVVFtpMV0pOwogICAgICAgICAgICAgICAgZm9yIChsZXQgaiA9IDE7IGogPD0gMzsgaisrKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdCA9IHQxICsgaiAqIHN0ZXA7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcGF0aFggPSB0aGlzLl9YKHQpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHBhdGhZID0gdGhpcy5fWSh0KTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBwYXRoRGlzdGFuY2UgPSBNYXRoLmFicyhDMy5kaXN0YW5jZVRvKHBhdGhYLCBwYXRoWSwgeCwgeSkgLSB0YXJnZXREaXN0YW5jZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHBhdGhEaXN0YW5jZSA8IGRpc3RhbmNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRpc3RhbmNlID0gcGF0aERpc3RhbmNlOwogICAgICAgICAgICAgICAgICAgICAgICBxID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgeDogcGF0aFgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB5OiBwYXRoWSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQ6IHQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXN0YW5jZTogcGF0aERpc3RhbmNlCiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgIGkgPSBqCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGx1dC5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgeDogcGF0aFgsCiAgICAgICAgICAgICAgICAgICAgICAgIHk6IHBhdGhZLAogICAgICAgICAgICAgICAgICAgICAgICB0OiB0LAogICAgICAgICAgICAgICAgICAgICAgICBkaXN0YW5jZTogcGF0aERpc3RhbmNlCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGx1dC5wdXNoKExVVFtpMl0pOwogICAgICAgICAgICAgICAgTFVUID0gbHV0CiAgICAgICAgICAgIH0gd2hpbGUgKGNvdW50KysgPCAyNSk7CiAgICAgICAgICAgIGlmICh0YXJnZXREaXN0YW5jZSAmJiBkaXN0YW5jZSA+IGVwc2lsb24pIHEgPSBudWxsOwogICAgICAgICAgICByZXR1cm4gcQogICAgICAgIH0KICAgICAgICBfQ2FsY3VsYXRlTGVuZ3RoKCkgewogICAgICAgICAgICB0aGlzLl9pbml0aWFsaXplZCA9IHRydWU7CiAgICAgICAgICAgIGxldCBveCA9IHRoaXMuX1goMCk7CiAgICAgICAgICAgIGxldCBveSA9CiAgICAgICAgICAgICAgICB0aGlzLl9ZKDApOwogICAgICAgICAgICBsZXQgY2xlbiA9IDA7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDw9IHRoaXMuX2xlbjsgaSsrKSB7CiAgICAgICAgICAgICAgICBjb25zdCB4ID0gdGhpcy5fWChpICogTEVOR1RIX1NURVBfU0laRSk7CiAgICAgICAgICAgICAgICBjb25zdCB5ID0gdGhpcy5fWShpICogTEVOR1RIX1NURVBfU0laRSk7CiAgICAgICAgICAgICAgICBjb25zdCBkeCA9IG94IC0geDsKICAgICAgICAgICAgICAgIGNvbnN0IGR5ID0gb3kgLSB5OwogICAgICAgICAgICAgICAgY2xlbiArPSBNYXRoLmh5cG90KGR4LCBkeSk7CiAgICAgICAgICAgICAgICB0aGlzLl9hcmNMZW5ndGhzW2ldID0gY2xlbjsKICAgICAgICAgICAgICAgIG94ID0geDsKICAgICAgICAgICAgICAgIG95ID0geQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuX2xlbmd0aCA9IGNsZW4KICAgICAgICB9CiAgICB9OwogICAgQzMuVGltZWxpbmVMaW5lU2VnbWVudEluZm8gPSBjbGFzcyBUaW1lbGluZUxpbmVTZWdtZW50SW5mbyB7CiAgICAgICAgY29uc3RydWN0b3Ioc3RhcnRYLCBzdGFydFksIGluZGV4KSB7CiAgICAgICAgICAgIHRoaXMuX2luZGV4ID0gaW5kZXg7CiAgICAgICAgICAgIHRoaXMuX3RhcmdldFggPSBzdGFydFguR2V0VmFsdWVXaXRoUmVzdWx0TW9kZSgpOwogICAgICAgICAgICB0aGlzLl90YXJnZXRZID0gc3RhcnRZLkdldFZhbHVlV2l0aFJlc3VsdE1vZGUoKTsKICAgICAgICAgICAgdGhpcy5fb3JpZ2luWCA9IDA7CiAgICAgICAgICAgIHRoaXMuX29yaWdpblkgPSAwCiAgICAgICAgfQogICAgICAgIFJlbGVhc2UoKSB7fQogICAgICAgIEdldFR5cGUoKSB7CiAgICAgICAgICAgIHJldHVybiAibGluZSIKICAgICAgICB9CiAgICAgICAgR2V0SW5kZXgoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pbmRleAogICAgICAgIH0KICAgICAgICBTZXRPcmlnaW4ob3gsIG95KSB7CiAgICAgICAgICAgIHRoaXMuX29yaWdpblggPSBveDsKICAgICAgICAgICAgdGhpcy5fb3JpZ2luWSA9IG95CiAgICAgICAgfQogICAgICAgIEdldFgoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl90YXJnZXRYICsgdGhpcy5fb3JpZ2luWAogICAgICAgIH0KICAgICAgICBHZXRZKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fdGFyZ2V0WSArIHRoaXMuX29yaWdpblkKICAgICAgICB9CiAgICB9OwoKfQoKLy8gdGltZWxpbmVzL3N0YXRlL3RpbWVsaW5lU3RhdGUuanMKewogICAgJ3VzZSBzdHJpY3QnOwogICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgY29uc3QgUElOR19QT05HX0JFR0lOID0gMDsKICAgIGNvbnN0IFBJTkdfUE9OR19FTkQgPSAxOwogICAgQzMuVGltZWxpbmVTdGF0ZSA9IGNsYXNzIFRpbWVsaW5lIGV4dGVuZHMgQzMuRGVmZW5kZWRCYXNlIHsKICAgICAgICBjb25zdHJ1Y3RvcihuYW1lLCB0aW1lbGluZURhdGFJdGVtLCB0aW1lbGluZU1hbmFnZXIpIHsKICAgICAgICAgICAgc3VwZXIoKTsKICAgICAgICAgICAgdGhpcy5fcnVudGltZSA9IHRpbWVsaW5lTWFuYWdlci5HZXRSdW50aW1lKCk7CiAgICAgICAgICAgIHRoaXMuX3RpbWVsaW5lTWFuYWdlciA9IHRpbWVsaW5lTWFuYWdlcjsKICAgICAgICAgICAgdGhpcy5fdGltZWxpbmVEYXRhSXRlbSA9IHRpbWVsaW5lRGF0YUl0ZW07CiAgICAgICAgICAgIHRoaXMuX25hbWUgPSBuYW1lOwogICAgICAgICAgICB0aGlzLl90cmFja3MgPSBbXTsKICAgICAgICAgICAgdGhpcy5fdHJhY2tzTGVuZ3RoID0gMDsKICAgICAgICAgICAgdGhpcy5fYmVmb3JlQW5kQWZ0ZXJUcmFja3MgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9iZWZvcmVBbmRBZnRlclRyYWNrc0xlbmd0aCA9IDA7CiAgICAgICAgICAgIHRoaXMuQ3JlYXRlVHJhY2tTdGF0ZXMoKTsKICAgICAgICAgICAgdGhpcy5fcGxheVByb21pc2UgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9wbGF5UmVzb2x2ZSA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3BsYXloZWFkVGltZSA9IDA7CiAgICAgICAgICAgIHRoaXMuX3BsYXliYWNrUmF0ZSA9IDE7CiAgICAgICAgICAgIHRoaXMuX3BpbmdQb25nU3RhdGUgPSBQSU5HX1BPTkdfQkVHSU47CiAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRSZXBlYXRDb3VudCA9IDE7CiAgICAgICAgICAgIHRoaXMuX2lzUGxheWluZyA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl9pc1NjaGVkdWxlZCA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl9pbml0aWFsU3RhdGVTZXQgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5fY29tcGxldGUgPSB0cnVlOwogICAgICAgICAgICB0aGlzLl9yZWxlYXNlZCA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl9tYXJrZWRGb3JSZW1vdmFsID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX2NvbXBsZXRlZFRpY2sgPSAtMTsKICAgICAgICAgICAgdGhpcy5faW1wbGljaXRQYXVzZSA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl9pc1RlbXBsYXRlID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX2ZpbmlzaGVkVHJpZ2dlcnMgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5fZmlyc3RUaWNrID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX2xhc3REZWx0YSA9IE5hTjsKICAgICAgICAgICAgdGhpcy5fdGFncyA9IFsiIl07CiAgICAgICAgICAgIHRoaXMuX3N0cmluZ1RhZ3MgPSAiIjsKICAgICAgICAgICAgdGhpcy5fdGFnc0NoYW5nZWQgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5fcmVuZGVyQ2hhbmdlID0gMDsKICAgICAgICAgICAgdGhpcy5faGFzTmVzdGVkQ29udGVudCA9IDA7CiAgICAgICAgICAgIHRoaXMuX2lUaW1lbGluZVN0YXRlID0gbnVsbAogICAgICAgIH0KICAgICAgICBzdGF0aWMgQ3JlYXRlSW5pdGlhbCh0aW1lbGluZURhdGFKc29uLCB0aW1lbGluZU1hbmFnZXIpIHsKICAgICAgICAgICAgY29uc3QgdGltZWxpbmVEYXRhTWFuYWdlciA9CiAgICAgICAgICAgICAgICB0aW1lbGluZU1hbmFnZXIuR2V0VGltZWxpbmVEYXRhTWFuYWdlcigpOwogICAgICAgICAgICBjb25zdCBuYW1lSWQgPSB0aW1lbGluZURhdGFNYW5hZ2VyLkdldE5hbWVJZCgpOwogICAgICAgICAgICBjb25zdCB0aW1lbGluZURhdGFJdGVtID0gdGltZWxpbmVEYXRhTWFuYWdlci5HZXQodGltZWxpbmVEYXRhSnNvbltuYW1lSWRdKTsKICAgICAgICAgICAgY29uc3QgdGltZWxpbmUgPSBDMy5OZXcoQzMuVGltZWxpbmVTdGF0ZSwgdGltZWxpbmVEYXRhSnNvbltuYW1lSWRdLCB0aW1lbGluZURhdGFJdGVtLCB0aW1lbGluZU1hbmFnZXIpOwogICAgICAgICAgICB0aW1lbGluZS5TZXRJc1RlbXBsYXRlKHRydWUpOwogICAgICAgICAgICByZXR1cm4gdGltZWxpbmUKICAgICAgICB9CiAgICAgICAgc3RhdGljIENyZWF0ZUZyb21UZW1wbGF0ZShuYW1lLCB0aW1lbGluZURhdGFJdGVtLCB0aW1lbGluZU1hbmFnZXIpIHsKICAgICAgICAgICAgcmV0dXJuIEMzLk5ldyhDMy5UaW1lbGluZVN0YXRlLCBuYW1lLCB0aW1lbGluZURhdGFJdGVtLCB0aW1lbGluZU1hbmFnZXIpCiAgICAgICAgfQogICAgICAgIFJlbGVhc2UoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLklzUmVsZWFzZWQoKSkgcmV0dXJuOwogICAgICAgICAgICBjb25zdCBkaXNwYXRjaGVyID0gdGhpcy5fcnVudGltZS5EaXNwYXRjaGVyKCk7CiAgICAgICAgICAgIHRoaXMuX3RpbWVsaW5lTWFuYWdlci5EZVNjaGVkdWxlVGltZWxpbmUodGhpcyk7CiAgICAgICAgICAgIHRoaXMuX3RpbWVsaW5lTWFuYWdlci5Db21wbGV0ZVRpbWVsaW5lQW5kUmVzb2x2ZSh0aGlzKTsKICAgICAgICAgICAgZm9yIChjb25zdCB0cmFjayBvZiB0aGlzLl90cmFja3MpIHRyYWNrLlJlbGVhc2UoKTsKICAgICAgICAgICAgQzMuY2xlYXJBcnJheSh0aGlzLl90cmFja3MpOwogICAgICAgICAgICB0aGlzLl90cmFja3MgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9ydW50aW1lID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fdGltZWxpbmVNYW5hZ2VyID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fdGltZWxpbmVEYXRhSXRlbSA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3JlbGVhc2VkID0gdHJ1ZTsKICAgICAgICAgICAgdGhpcy5fcGxheVByb21pc2UgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9wbGF5UmVzb2x2ZSA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuRmlyZVJlbGVhc2VFdmVudChkaXNwYXRjaGVyKQogICAgICAgIH0KICAgICAgICBGaXJlUmVsZWFzZUV2ZW50KGRpc3BhdGNoZXIpIHsKICAgICAgICAgICAgY29uc3QgZXZlbnQgPSBDMy5OZXcoQzMuRXZlbnQsICJ0aW1lbGluZXN0YXRlcmVsZWFzZWQiKTsKICAgICAgICAgICAgZXZlbnQudGltZWxpbmVTdGF0ZSA9IHRoaXM7CiAgICAgICAgICAgIGRpc3BhdGNoZXIuZGlzcGF0Y2hFdmVudChldmVudCkKICAgICAgICB9CiAgICAgICAgR2V0VHlwZSgpIHsKICAgICAgICAgICAgcmV0dXJuIDAKICAgICAgICB9CiAgICAgICAgQ3JlYXRlVHJhY2tTdGF0ZXMoKSB7CiAgICAgICAgICAgIGZvciAoY29uc3QgdHJhY2tEYXRhSXRlbSBvZiB0aGlzLl90aW1lbGluZURhdGFJdGVtLkdldFRyYWNrRGF0YSgpLnRyYWNrRGF0YUl0ZW1zKCkpIHRoaXMuX3RyYWNrc0xlbmd0aCA9CiAgICAgICAgICAgICAgICB0aGlzLl90cmFja3MucHVzaChDMy5UcmFja1N0YXRlLkNyZWF0ZSh0aGlzLCB0cmFja0RhdGFJdGVtKSkKICAgICAgICB9CiAgICAgICAgR2V0VGltZWxpbmVNYW5hZ2VyKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fdGltZWxpbmVNYW5hZ2VyCiAgICAgICAgfQogICAgICAgIEdldFJ1bnRpbWUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lCiAgICAgICAgfQogICAgICAgIEdldFRyYWNrcygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RyYWNrcwogICAgICAgIH0KICAgICAgICBHZXRTaW1pbGFyUHJvcGVydHlUcmFja3MoaW5zdGFuY2UsIHNvdXJjZUFkYXB0ZXIsIHByb3BlcnR5TmFtZSkgewogICAgICAgICAgICBpZiAoIXRoaXMuX2hhc05lc3RlZENvbnRlbnQpIHJldHVybjsKICAgICAgICAgICAgbGV0IHJldDsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLl90cmFja3MubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGxldCB0cmFjayA9IHRoaXMuX3RyYWNrc1tpXTsKICAgICAgICAgICAgICAgIGlmIChpbnN0YW5jZSAhPT0gdHJhY2suR2V0SW5zdGFuY2UoKSkgY29udGludWU7CiAgICAgICAgICAgICAgICBjb25zdCBwcm9wZXJ0eVRyYWNrID0gdHJhY2suR2V0UHJvcGVydHlUcmFjayhwcm9wZXJ0eU5hbWUpOwogICAgICAgICAgICAgICAgaWYgKCFwcm9wZXJ0eVRyYWNrKSBjb250aW51ZTsKICAgICAgICAgICAgICAgIGlmIChzb3VyY2VBZGFwdGVyLmNvbnN0cnVjdG9yICE9PQogICAgICAgICAgICAgICAgICAgIHByb3BlcnR5VHJhY2suR2V0U291cmNlQWRhcHRlcigpLmNvbnN0cnVjdG9yKSBjb250aW51ZTsKICAgICAgICAgICAgICAgIGlmICghcmV0KSByZXQgPSBbXTsKICAgICAgICAgICAgICAgIHJldC5wdXNoKHByb3BlcnR5VHJhY2spCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHJldAogICAgICAgIH0KICAgICAgICBIYXNUcmFja3MoKSB7CiAgICAgICAgICAgIHJldHVybiAhIXRoaXMuX3RyYWNrcy5sZW5ndGgKICAgICAgICB9CiAgICAgICAgR2V0VHJhY2tCeUlkKHRyYWNrSWQpIHsKICAgICAgICAgICAgZm9yIChjb25zdCB0cmFjayBvZiB0aGlzLl90cmFja3MpCiAgICAgICAgICAgICAgICBpZiAoQzMuZXF1YWxzTm9DYXNlKHRyYWNrLkdldElkKCksIHRyYWNrSWQpKSByZXR1cm4gdHJhY2s7CiAgICAgICAgICAgIHJldHVybiBudWxsCiAgICAgICAgfQogICAgICAgIEdldFRyYWNrQnlOYW1lKG5hbWUpIHsKICAgICAgICAgICAgZm9yIChjb25zdCB0cmFjayBvZiB0aGlzLl90cmFja3MpIHsKICAgICAgICAgICAgICAgIGlmICh0cmFjay5Jc0luc3RhbmNlVHJhY2soKSkgY29udGludWU7CiAgICAgICAgICAgICAgICBpZiAoQzMuZXF1YWxzTm9DYXNlKHRyYWNrLkdldE5hbWUoKSwgbmFtZSkpIHJldHVybiB0cmFjawogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBudWxsCiAgICAgICAgfQogICAgICAgIFNldE5hbWUobmFtZSkgewogICAgICAgICAgICB0aGlzLl9uYW1lID0gbmFtZQogICAgICAgIH0KICAgICAgICBHZXROYW1lKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fbmFtZQogICAgICAgIH0KICAgICAgICBHZXRUaW1lbGluZURhdGFJdGVtKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fdGltZWxpbmVEYXRhSXRlbQogICAgICAgIH0KICAgICAgICBHZXRUZW1wbGF0ZU5hbWUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl90aW1lbGluZURhdGFJdGVtLkdldE5hbWUoKQogICAgICAgIH0KICAgICAgICBHZXRUb3RhbFRpbWUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl90aW1lbGluZURhdGFJdGVtLkdldFRvdGFsVGltZSgpCiAgICAgICAgfQogICAgICAgIFNldFRvdGFsVGltZSh0dCkgewogICAgICAgICAgICB0aGlzLl90aW1lbGluZURhdGFJdGVtLlNldFRvdGFsVGltZSh0dCkKICAgICAgICB9CiAgICAgICAgR2V0U3RlcCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RpbWVsaW5lRGF0YUl0ZW0uR2V0U3RlcCgpCiAgICAgICAgfQogICAgICAgIFNldFN0ZXAocykgewogICAgICAgICAgICB0aGlzLl90aW1lbGluZURhdGFJdGVtLlNldFN0ZXAocykKICAgICAgICB9CiAgICAgICAgR2V0SW50ZXJwb2xhdGlvbk1vZGUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl90aW1lbGluZURhdGFJdGVtLkdldEludGVycG9sYXRpb25Nb2RlKCkKICAgICAgICB9CiAgICAgICAgU2V0SW50ZXJwb2xhdGlvbk1vZGUoaW0pIHsKICAgICAgICAgICAgdGhpcy5fdGltZWxpbmVEYXRhSXRlbS5TZXRJbnRlcnBvbGF0aW9uTW9kZShpbSkKICAgICAgICB9CiAgICAgICAgR2V0UmVzdWx0TW9kZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RpbWVsaW5lRGF0YUl0ZW0uR2V0UmVzdWx0TW9kZSgpCiAgICAgICAgfQogICAgICAgIFNldFJlc3VsdE1vZGUocm0pIHsKICAgICAgICAgICAgdGhpcy5fdGltZWxpbmVEYXRhSXRlbS5HZXRSZXN1bHRNb2RlKHJtKQogICAgICAgIH0KICAgICAgICBTZXRFYXNlKGUpIHsKICAgICAgICAgICAgZm9yIChjb25zdCB0cmFjayBvZiB0aGlzLkdldFRyYWNrcygpKSB0cmFjay5TZXRFYXNlKGUpCiAgICAgICAgfQogICAgICAgIEdldExvb3AoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl90aW1lbGluZURhdGFJdGVtLkdldExvb3AoKQogICAgICAgIH0KICAgICAgICBTZXRMb29wKGwpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RpbWVsaW5lRGF0YUl0ZW0uU2V0TG9vcChsKQogICAgICAgIH0KICAgICAgICBHZXRQaW5nUG9uZygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RpbWVsaW5lRGF0YUl0ZW0uR2V0UGluZ1BvbmcoKQogICAgICAgIH0KICAgICAgICBTZXRQaW5nUG9uZyhwKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl90aW1lbGluZURhdGFJdGVtLlNldFBpbmdQb25nKHApCiAgICAgICAgfQogICAgICAgIEdldFJlcGVhdENvdW50KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fdGltZWxpbmVEYXRhSXRlbS5HZXRSZXBlYXRDb3VudCgpCiAgICAgICAgfQogICAgICAgIFNldFJlcGVhdENvdW50KHJjKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl90aW1lbGluZURhdGFJdGVtLlNldFJlcGVhdENvdW50KHJjKQogICAgICAgIH0KICAgICAgICBTZXRQbGF5YmFja1JhdGUocikgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fcGxheWJhY2tSYXRlID0KICAgICAgICAgICAgICAgIHIKICAgICAgICB9CiAgICAgICAgR2V0UGxheWJhY2tSYXRlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fcGxheWJhY2tSYXRlCiAgICAgICAgfQogICAgICAgIEdldFN0YXJ0T25MYXlvdXQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl90aW1lbGluZURhdGFJdGVtLkdldFN0YXJ0T25MYXlvdXQoKQogICAgICAgIH0KICAgICAgICBHZXRUcmFuc2Zvcm1XaXRoU2NlbmVHcmFwaCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RpbWVsaW5lRGF0YUl0ZW0uR2V0VHJhbnNmb3JtV2l0aFNjZW5lR3JhcGgoKQogICAgICAgIH0KICAgICAgICBHZXRVc2VTeXN0ZW1UaW1lc2NhbGUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl90aW1lbGluZURhdGFJdGVtLkdldFVzZVN5c3RlbVRpbWVzY2FsZSgpCiAgICAgICAgfQogICAgICAgIElzRm9yd2FyZFBsYXlCYWNrKCkgewogICAgICAgICAgICBpZiAoIXRoaXMuSXNQbGF5aW5nKCkpIHJldHVybiB0cnVlOwogICAgICAgICAgICByZXR1cm4gdGhpcy5fcGxheWJhY2tSYXRlID4gMAogICAgICAgIH0KICAgICAgICBHZXRQbGF5UHJvbWlzZSgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX3BsYXlQcm9taXNlKSByZXR1cm4gdGhpcy5fcGxheVByb21pc2U7CiAgICAgICAgICAgIHRoaXMuX3BsYXlQcm9taXNlID0gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLl9wbGF5UmVzb2x2ZSA9IHJlc29sdmUKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9wbGF5UHJvbWlzZQogICAgICAgIH0KICAgICAgICBSZXNvbHZlUGxheVByb21pc2UoKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5fcGxheVByb21pc2UpIHJldHVybjsKICAgICAgICAgICAgdGhpcy5fcGxheVJlc29sdmUoKTsKICAgICAgICAgICAgdGhpcy5fcGxheVByb21pc2UgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9wbGF5UmVzb2x2ZSA9IG51bGwKICAgICAgICB9CiAgICAgICAgU2V0VGFncyh0YWdzKSB7CiAgICAgICAgICAgIHRoaXMuX3RhZ3MgPSBDMy5UaW1lbGluZVN0YXRlLl9HZXRUYWdBcnJheSh0YWdzKTsKICAgICAgICAgICAgdGhpcy5fdGFnc0NoYW5nZWQgPSB0cnVlCiAgICAgICAgfQogICAgICAgIEdldFRhZ3MoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl90YWdzCiAgICAgICAgfQogICAgICAgIEdldFN0cmluZ1RhZ3MoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl90YWdzQ2hhbmdlZCkgdGhpcy5fc3RyaW5nVGFncyA9IHRoaXMuX3RhZ3Muam9pbigiICIpOwogICAgICAgICAgICB0aGlzLl90YWdzQ2hhbmdlZCA9IGZhbHNlOwogICAgICAgICAgICByZXR1cm4gdGhpcy5fc3RyaW5nVGFncwogICAgICAgIH0KICAgICAgICBIYXNUYWdzKHRhZ3MpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLl90YWdzKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGlmICghdGhpcy5fdGFncy5sZW5ndGgpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgY29uc3QgdCA9IEMzLlRpbWVsaW5lU3RhdGUuX0dldFRhZ0FycmF5KHRhZ3MpOwogICAgICAgICAgICBpZiAoIXQpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgaWYgKCF0Lmxlbmd0aCkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICByZXR1cm4gdC5ldmVyeShDMy5UaW1lbGluZVN0YXRlLl9IYXNUYWcsCiAgICAgICAgICAgICAgICB0aGlzKQogICAgICAgIH0KICAgICAgICBPblN0YXJ0ZWQoKSB7CiAgICAgICAgICAgIGlmICghQzMuUGx1Z2lucy5UaW1lbGluZSB8fCB0aGlzLmNvbnN0cnVjdG9yICE9PSBDMy5UaW1lbGluZVN0YXRlKSByZXR1cm47CiAgICAgICAgICAgIEMzLlBsdWdpbnMuVGltZWxpbmUuQ25kcy5QdXNoVHJpZ2dlclRpbWVsaW5lKHRoaXMpOwogICAgICAgICAgICB0aGlzLl90aW1lbGluZU1hbmFnZXIuVHJpZ2dlcihDMy5QbHVnaW5zLlRpbWVsaW5lLkNuZHMuT25UaW1lbGluZVN0YXJ0ZWQpOwogICAgICAgICAgICB0aGlzLl90aW1lbGluZU1hbmFnZXIuVHJpZ2dlcihDMy5QbHVnaW5zLlRpbWVsaW5lLkNuZHMuT25UaW1lbGluZVN0YXJ0ZWRCeU5hbWUpOwogICAgICAgICAgICB0aGlzLl90aW1lbGluZU1hbmFnZXIuVHJpZ2dlcihDMy5QbHVnaW5zLlRpbWVsaW5lLkNuZHMuT25UaW1lbGluZVN0YXJ0ZWRCeVRhZ3MpOwogICAgICAgICAgICB0aGlzLl90aW1lbGluZU1hbmFnZXIuVHJpZ2dlcihDMy5QbHVnaW5zLlRpbWVsaW5lLkNuZHMuT25BbnlUaW1lbGluZVN0YXJ0ZWQpOwogICAgICAgICAgICBDMy5QbHVnaW5zLlRpbWVsaW5lLkNuZHMuUG9wVHJpZ2dlclRpbWVsaW5lKCkKICAgICAgICB9CiAgICAgICAgT25Db21wbGV0ZWQoKSB7CiAgICAgICAgICAgIHRoaXMuX2NvbXBsZXRlZFRpY2sgPQogICAgICAgICAgICAgICAgdGhpcy5fcnVudGltZS5HZXRUaWNrQ291bnQoKQogICAgICAgIH0KICAgICAgICBGaW5pc2hUcmlnZ2VycygpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX2ZpbmlzaGVkVHJpZ2dlcnMpIHJldHVybjsKICAgICAgICAgICAgdGhpcy5fZmluaXNoZWRUcmlnZ2VycyA9IHRydWU7CiAgICAgICAgICAgIGlmICghQzMuUGx1Z2lucy5UaW1lbGluZSB8fCB0aGlzLmNvbnN0cnVjdG9yICE9PSBDMy5UaW1lbGluZVN0YXRlKSByZXR1cm47CiAgICAgICAgICAgIEMzLlBsdWdpbnMuVGltZWxpbmUuQ25kcy5QdXNoVHJpZ2dlclRpbWVsaW5lKHRoaXMpOwogICAgICAgICAgICB0aGlzLl90aW1lbGluZU1hbmFnZXIuVHJpZ2dlcihDMy5QbHVnaW5zLlRpbWVsaW5lLkNuZHMuT25UaW1lbGluZUZpbmlzaGVkKTsKICAgICAgICAgICAgdGhpcy5fdGltZWxpbmVNYW5hZ2VyLlRyaWdnZXIoQzMuUGx1Z2lucy5UaW1lbGluZS5DbmRzLk9uVGltZWxpbmVGaW5pc2hlZEJ5TmFtZSk7CiAgICAgICAgICAgIHRoaXMuX3RpbWVsaW5lTWFuYWdlci5UcmlnZ2VyKEMzLlBsdWdpbnMuVGltZWxpbmUuQ25kcy5PblRpbWVsaW5lRmluaXNoZWRCeVRhZ3MpOwogICAgICAgICAgICB0aGlzLl90aW1lbGluZU1hbmFnZXIuVHJpZ2dlcihDMy5QbHVnaW5zLlRpbWVsaW5lLkNuZHMuT25BbnlUaW1lbGluZUZpbmlzaGVkKTsKICAgICAgICAgICAgQzMuUGx1Z2lucy5UaW1lbGluZS5DbmRzLlBvcFRyaWdnZXJUaW1lbGluZSgpCiAgICAgICAgfQogICAgICAgIFNldFBsYXlpbmcocCkgewogICAgICAgICAgICB0aGlzLl9pc1BsYXlpbmcgPSBwCiAgICAgICAgfQogICAgICAgIElzQ29tcGxldGVkVGljaygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NvbXBsZXRlZFRpY2sgPT09IHRoaXMuX3J1bnRpbWUuR2V0VGlja0NvdW50KCkKICAgICAgICB9CiAgICAgICAgSXNQbGF5aW5nKHBsYXlpbmdPbmx5ID0gZmFsc2UpIHsKICAgICAgICAgICAgaWYgKHRoaXMuSXNDb21wbGV0ZWRUaWNrKCkpIHJldHVybiB0cnVlOwogICAgICAgICAgICBpZiAodGhpcy5Jc1NjaGVkdWxlZCgpICYmICFwbGF5aW5nT25seSkgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pc1BsYXlpbmcKICAgICAgICB9CiAgICAgICAgX0lzUGxheWluZygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuSXNQbGF5aW5nKHRydWUpCiAgICAgICAgfQogICAgICAgIElzUGF1c2VkKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fSXNQYXVzZWQoKQogICAgICAgIH0KICAgICAgICBfSXNQYXVzZWQoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLklzUmVsZWFzZWQoKSkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBpZiAodGhpcy5Jc1NjaGVkdWxlZCgpKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGlmICh0aGlzLl9Jc1BsYXlpbmcoKSkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBpZiAodGhpcy5Jc0NvbXBsZXRlKCkpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICB9CiAgICAgICAgU2V0U2NoZWR1bGVkKHMpIHsKICAgICAgICAgICAgdGhpcy5faXNTY2hlZHVsZWQgPSBzCiAgICAgICAgfQogICAgICAgIElzU2NoZWR1bGVkKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faXNTY2hlZHVsZWQKICAgICAgICB9CiAgICAgICAgU2V0Q29tcGxldGUoYykgewogICAgICAgICAgICB0aGlzLl9jb21wbGV0ZSA9IGM7CiAgICAgICAgICAgIGNvbnN0IHQgPSB0aGlzLkdldFRpbWUoKTsKICAgICAgICAgICAgaWYgKHQgPD0gMCB8fCB0ID49IHRoaXMuR2V0VG90YWxUaW1lKCkpIHRoaXMuX2NvbXBsZXRlID0gdHJ1ZQogICAgICAgIH0KICAgICAgICBJc0NvbXBsZXRlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fY29tcGxldGUKICAgICAgICB9CiAgICAgICAgSXNSZWxlYXNlZCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3JlbGVhc2VkCiAgICAgICAgfQogICAgICAgIFNldE1hcmtlZEZvclJlbW92YWwobWZyKSB7CiAgICAgICAgICAgIHRoaXMuX21hcmtlZEZvclJlbW92YWwgPSBtZnIKICAgICAgICB9CiAgICAgICAgSXNNYXJrZWRGb3JSZW1vdmFsKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fbWFya2VkRm9yUmVtb3ZhbAogICAgICAgIH0KICAgICAgICBTZXRJbXBsaWNpdFBhdXNlKGlwKSB7CiAgICAgICAgICAgIHRoaXMuX2ltcGxpY2l0UGF1c2UgPSBpcAogICAgICAgIH0KICAgICAgICBJc0ltcGxpY2l0UGF1c2UoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pbXBsaWNpdFBhdXNlCiAgICAgICAgfQogICAgICAgIFNldElzVGVtcGxhdGUoaXQpIHsKICAgICAgICAgICAgdGhpcy5faXNUZW1wbGF0ZSA9ICEhaXQKICAgICAgICB9CiAgICAgICAgSXNUZW1wbGF0ZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2lzVGVtcGxhdGUKICAgICAgICB9CiAgICAgICAgSW5pdGlhbFN0YXRlU2V0KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faW5pdGlhbFN0YXRlU2V0CiAgICAgICAgfQogICAgICAgIEdldFRpbWUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9wbGF5aGVhZFRpbWUKICAgICAgICB9CiAgICAgICAgU2V0VGltZSh0aW1lKSB7CiAgICAgICAgICAgIGNvbnN0IGxhc3RHbG9iYWxUaW1lID0KICAgICAgICAgICAgICAgIHRoaXMuR2V0VGltZSgpOwogICAgICAgICAgICB0aGlzLl9TZXRUaW1lKHRpbWUpOwogICAgICAgICAgICB0aGlzLlNldENvbXBsZXRlKGZhbHNlKTsKICAgICAgICAgICAgaWYgKCF0aGlzLklzQ29tcGxldGUoKSkgdGhpcy5TZXRJbXBsaWNpdFBhdXNlKHRydWUpOwogICAgICAgICAgICBpZiAoIXRoaXMuX0lzUGxheWluZygpICYmICF0aGlzLklzU2NoZWR1bGVkKCkgJiYgdGhpcy5faW5pdGlhbFN0YXRlU2V0KTsKICAgICAgICAgICAgZWxzZSBpZiAoIXRoaXMuX0lzUGxheWluZygpICYmICF0aGlzLklzU2NoZWR1bGVkKCkgJiYgIXRoaXMuX2luaXRpYWxTdGF0ZVNldCkgdGhpcy5TZXRJbml0aWFsU3RhdGVGcm9tU2V0VGltZSgpOwogICAgICAgICAgICBlbHNlIGlmICh0aGlzLl9Jc1BsYXlpbmcoKSkgdGhpcy5TdG9wKCk7CiAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuSXNTY2hlZHVsZWQoKSkgewogICAgICAgICAgICAgICAgdGhpcy5fdGltZWxpbmVNYW5hZ2VyLkRlU2NoZWR1bGVUaW1lbGluZSh0aGlzKTsKICAgICAgICAgICAgICAgIHRoaXMuU2V0SW5pdGlhbFN0YXRlRnJvbVNldFRpbWUoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuX1NldFVwZGF0ZVN0YXRlQmVmb3JlKCk7CiAgICAgICAgICAgIHRoaXMuX0ludGVycG9sYXRlKHRoaXMuR2V0VGltZSgpLCBmYWxzZSwgdHJ1ZSwKICAgICAgICAgICAgICAgIHRydWUsIGxhc3RHbG9iYWxUaW1lKTsKICAgICAgICAgICAgdGhpcy5fU2V0VXBkYXRlU3RhdGVBZnRlcigpOwogICAgICAgICAgICBpZiAodGhpcy5fcmVuZGVyQ2hhbmdlKSB0aGlzLkdldFJ1bnRpbWUoKS5VcGRhdGVSZW5kZXIoKTsKICAgICAgICAgICAgdGhpcy5fT25TZXRUaW1lKCkKICAgICAgICB9CiAgICAgICAgX1NldFRpbWUodGltZSkgewogICAgICAgICAgICBpZiAoIUMzLklzRmluaXRlTnVtYmVyKHRpbWUpKSB0aW1lID0gdGhpcy5HZXRUb3RhbFRpbWUoKTsKICAgICAgICAgICAgaWYgKHRpbWUgPCAwKSB0aGlzLl9wbGF5aGVhZFRpbWUgPSAwOwogICAgICAgICAgICBlbHNlIGlmICh0aW1lID49IHRoaXMuR2V0VG90YWxUaW1lKCkpIHRoaXMuX3BsYXloZWFkVGltZSA9IHRoaXMuR2V0VG90YWxUaW1lKCk7CiAgICAgICAgICAgIGVsc2UgdGhpcy5fcGxheWhlYWRUaW1lID0gdGltZQogICAgICAgIH0KICAgICAgICBfU2V0VGltZUFuZFJlc2V0KHRpbWUpIHsKICAgICAgICAgICAgaWYgKCFDMy5Jc0Zpbml0ZU51bWJlcih0aW1lKSkgdGltZSA9IHRoaXMuR2V0VG90YWxUaW1lKCk7CiAgICAgICAgICAgIGlmICh0aW1lIDwgMCkgdGhpcy5fcGxheWhlYWRUaW1lID0gMDsKICAgICAgICAgICAgZWxzZSBpZiAodGltZSA+PSB0aGlzLkdldFRvdGFsVGltZSgpKSB0aGlzLl9wbGF5aGVhZFRpbWUgPSB0aGlzLkdldFRvdGFsVGltZSgpOwogICAgICAgICAgICBlbHNlIHRoaXMuX3BsYXloZWFkVGltZSA9IHRpbWU7CiAgICAgICAgICAgIGZvciAoY29uc3QgdHJhY2sgb2YgdGhpcy5fdHJhY2tzKSB0cmFjay5TZXRSZXNldFN0YXRlKCkKICAgICAgICB9CiAgICAgICAgX09uU2V0VGltZSgpIHsKICAgICAgICAgICAgaWYgKCFDMy5QbHVnaW5zLlRpbWVsaW5lIHx8IHRoaXMuY29uc3RydWN0b3IgIT09IEMzLlRpbWVsaW5lU3RhdGUpIHJldHVybjsKICAgICAgICAgICAgQzMuUGx1Z2lucy5UaW1lbGluZS5DbmRzLlB1c2hUcmlnZ2VyVGltZWxpbmUodGhpcyk7CiAgICAgICAgICAgIHRoaXMuX3RpbWVsaW5lTWFuYWdlci5UcmlnZ2VyKEMzLlBsdWdpbnMuVGltZWxpbmUuQ25kcy5PblRpbWVTZXQpOwogICAgICAgICAgICB0aGlzLl90aW1lbGluZU1hbmFnZXIuVHJpZ2dlcihDMy5QbHVnaW5zLlRpbWVsaW5lLkNuZHMuT25UaW1lU2V0QnlOYW1lKTsKICAgICAgICAgICAgdGhpcy5fdGltZWxpbmVNYW5hZ2VyLlRyaWdnZXIoQzMuUGx1Z2lucy5UaW1lbGluZS5DbmRzLk9uVGltZVNldEJ5VGFncyk7CiAgICAgICAgICAgIEMzLlBsdWdpbnMuVGltZWxpbmUuQ25kcy5Qb3BUcmlnZ2VyVGltZWxpbmUoKQogICAgICAgIH0KICAgICAgICBfQ2FuUmVzdW1lKCkgewogICAgICAgICAgICBpZiAodGhpcy5HZXRMb29wKCkpIHJldHVybiB0cnVlOwogICAgICAgICAgICBlbHNlIGlmICh0aGlzLkdldFBpbmdQb25nKCkgJiYgdGhpcy5fcGluZ1BvbmdTdGF0ZSA9PT0gUElOR19QT05HX0VORCkKICAgICAgICAgICAgICAgIGlmICh0aGlzLklzRm9yd2FyZFBsYXlCYWNrKCkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5HZXRUaW1lKCkgPj0gdGhpcy5HZXRUb3RhbFRpbWUoKSkgcmV0dXJuIGZhbHNlCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLkdldFRpbWUoKSA8PSAwKSByZXR1cm4gZmFsc2UKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAoIXRoaXMuR2V0TG9vcCgpICYmICF0aGlzLkdldFBpbmdQb25nKCkpCiAgICAgICAgICAgICAgICBpZiAodGhpcy5Jc0ZvcndhcmRQbGF5QmFjaygpKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuR2V0VGltZSgpID49IHRoaXMuR2V0VG90YWxUaW1lKCkpIHJldHVybiBmYWxzZQogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLkdldFRpbWUoKSA8PSAwKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgfQogICAgICAgIFJlc3VtZSgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuSXNSZWxlYXNlZCgpKSByZXR1cm47CiAgICAgICAgICAgIGlmICh0aGlzLl9DYW5SZXN1bWUoKSkgdGhpcy5QbGF5KHRydWUpCiAgICAgICAgfQogICAgICAgIFBsYXkocmVzdW1lID0gZmFsc2UpIHsKICAgICAgICAgICAgaWYgKHRoaXMuSXNSZWxlYXNlZCgpKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGlmICh0aGlzLklzU2NoZWR1bGVkKCkpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgaWYgKHRoaXMuX0lzUGxheWluZygpICYmIHRoaXMuSXNDb21wbGV0ZWRUaWNrKCkpIHJldHVybiB0aGlzLl9TY2hlZHVsZVBsYXlpbmdUaW1lbGluZSgpOwogICAgICAgICAgICBpZiAodGhpcy5fSXNQbGF5aW5nKCkpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgaWYgKCF0aGlzLklzQ29tcGxldGUoKSAmJiAhcmVzdW1lICYmICF0aGlzLklzSW1wbGljaXRQYXVzZSgpKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9TY2hlZHVsZVN0b3BwZWRUaW1lbGluZSgpCiAgICAgICAgfQogICAgICAgIF9TY2hlZHVsZVBsYXlpbmdUaW1lbGluZSgpIHsKICAgICAgICAgICAgdGhpcy5TZXRJbXBsaWNpdFBhdXNlKGZhbHNlKTsKICAgICAgICAgICAgdGhpcy5fdGltZWxpbmVNYW5hZ2VyLlJlbW92ZVBsYXlpbmdUaW1lbGluZSh0aGlzKTsKICAgICAgICAgICAgdGhpcy5fdGltZWxpbmVNYW5hZ2VyLlNjaGVkdWxlVGltZWxpbmUodGhpcyk7CiAgICAgICAgICAgIHRoaXMuR2V0UGxheVByb21pc2UoKTsKICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICB9CiAgICAgICAgX1NjaGVkdWxlU3RvcHBlZFRpbWVsaW5lKCkgewogICAgICAgICAgICB0aGlzLlNldEltcGxpY2l0UGF1c2UoZmFsc2UpOwogICAgICAgICAgICB0aGlzLl90aW1lbGluZU1hbmFnZXIuU2NoZWR1bGVUaW1lbGluZSh0aGlzKTsKICAgICAgICAgICAgdGhpcy5HZXRQbGF5UHJvbWlzZSgpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgIH0KICAgICAgICBTdG9wKGNvbXBsZXRlZCA9IGZhbHNlKSB7CiAgICAgICAgICAgIGlmICh0aGlzLklzUmVsZWFzZWQoKSkgcmV0dXJuOwogICAgICAgICAgICB0aGlzLlNldENvbXBsZXRlKGNvbXBsZXRlZCk7CiAgICAgICAgICAgIHRoaXMuX3RpbWVsaW5lTWFuYWdlci5Db21wbGV0ZVRpbWVsaW5lKHRoaXMpOwogICAgICAgICAgICBpZiAodGhpcy5Jc0NvbXBsZXRlKCkpIHRoaXMuUmVzb2x2ZVBsYXlQcm9taXNlKCkKICAgICAgICB9CiAgICAgICAgUmVzZXQocmVuZGVyID0gdHJ1ZSwgYmVmb3JlQ2hhbmdlTGF5b3V0ID0gZmFsc2UpIHsKICAgICAgICAgICAgaWYgKHRoaXMuSXNSZWxlYXNlZCgpKSByZXR1cm47CiAgICAgICAgICAgIGlmICghdGhpcy5fSXNQbGF5aW5nKCkgJiYgdGhpcy5Jc1NjaGVkdWxlZCgpKSByZXR1cm4gdGhpcy5fdGltZWxpbmVNYW5hZ2VyLkRlU2NoZWR1bGVUaW1lbGluZSh0aGlzKTsKICAgICAgICAgICAgaWYgKHRoaXMuSXNDb21wbGV0ZSgpKSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuU3RvcCh0cnVlKTsKICAgICAgICAgICAgaWYgKHRoaXMuSXNGb3J3YXJkUGxheUJhY2soKSkgdGhpcy5fU2V0VGltZSgwKTsKICAgICAgICAgICAgZWxzZSB0aGlzLl9TZXRUaW1lKHRoaXMuR2V0VG90YWxUaW1lKCkpOwogICAgICAgICAgICBjb25zdCB0aW1lID0gdGhpcy5HZXRUaW1lKCk7CiAgICAgICAgICAgIHRoaXMuX1NldFVwZGF0ZVN0YXRlQmVmb3JlKCk7CiAgICAgICAgICAgIGlmIChiZWZvcmVDaGFuZ2VMYXlvdXQpIHRoaXMuX0ludGVycG9sYXRlQmVmb3JlQ2hhbmdlTGF5b3V0KHRpbWUpOwogICAgICAgICAgICBlbHNlIHRoaXMuX0ludGVycG9sYXRlKHRpbWUsIGZhbHNlLCBmYWxzZSwgdHJ1ZSk7CiAgICAgICAgICAgIGlmIChyZW5kZXIpIHRoaXMuX09uU2V0VGltZSgpOwogICAgICAgICAgICB0aGlzLl9TZXRVcGRhdGVTdGF0ZUFmdGVyKCk7CiAgICAgICAgICAgIGlmICh0aGlzLl9yZW5kZXJDaGFuZ2UgJiYgcmVuZGVyKSB0aGlzLkdldFJ1bnRpbWUoKS5VcGRhdGVSZW5kZXIoKQogICAgICAgIH0KICAgICAgICBSZXNldEJlZm9yZUNoYW5nZUxheW91dCgpIHsKICAgICAgICAgICAgdGhpcy5SZXNldChmYWxzZSwgdHJ1ZSkKICAgICAgICB9CiAgICAgICAgX0ludGVycG9sYXRlQmVmb3JlQ2hhbmdlTGF5b3V0KHRpbWUpIHsKICAgICAgICAgICAgdGhpcy5fSW50ZXJwb2xhdGUodGltZSwgZmFsc2UsIGZhbHNlLCB0cnVlLCBOYU4sIGZhbHNlLCB0cnVlKQogICAgICAgIH0KICAgICAgICBfT25CZWZvcmVDaGFuZ2VMYXlvdXQoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLklzUmVsZWFzZWQoKSkgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIGlmICghdGhpcy5HZXRSdW50aW1lKCkuSXNMb2FkaW5nU3RhdGUoKSkKICAgICAgICAgICAgICAgIGlmICh0aGlzLkhhc1ZhbGlkR2xvYmFsVHJhY2tzKCkpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgdGhpcy5fdGltZWxpbmVNYW5hZ2VyLkNvbXBsZXRlVGltZWxpbmVCZWZvcmVDaGFuZ2VPZkxheW91dCh0aGlzKTsKICAgICAgICAgICAgaWYgKCF0aGlzLkdldFJ1bnRpbWUoKS5Jc0xvYWRpbmdTdGF0ZSgpKSB0aGlzLlJlc2V0QmVmb3JlQ2hhbmdlTGF5b3V0KCk7CiAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgfQogICAgICAgIFNldEluaXRpYWxTdGF0ZUZyb21TZXRUaW1lKCkgewogICAgICAgICAgICB0aGlzLlNldEluaXRpYWxTdGF0ZSh0cnVlKQogICAgICAgIH0KICAgICAgICBTZXRJbml0aWFsU3RhdGUoZnJvbVNldFRpbWUpIHsKICAgICAgICAgICAgaWYgKHRoaXMuSXNNYXJrZWRGb3JSZW1vdmFsKCkpIHJldHVybjsKICAgICAgICAgICAgaWYgKGZyb21TZXRUaW1lKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9maW5pc2hlZFRyaWdnZXJzID0gZmFsc2U7CiAgICAgICAgICAgICAgICB0aGlzLl9pbml0aWFsU3RhdGVTZXQgPSB0cnVlOwogICAgICAgICAgICAgICAgdGhpcy5fZmlyc3RUaWNrID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHRoaXMuX1NldFVwZGF0ZVN0YXRlQmVmb3JlKCk7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHRyYWNrIG9mIHRoaXMuX3RyYWNrcykgdHJhY2suU2V0SW5pdGlhbFN0YXRlKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9TZXRVcGRhdGVTdGF0ZUFmdGVyKCkKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuU2V0UGxheWluZyh0cnVlKTsKICAgICAgICAgICAgICAgIHRoaXMuU2V0U2NoZWR1bGVkKGZhbHNlKTsKICAgICAgICAgICAgICAgIHRoaXMuT25TdGFydGVkKCk7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5Jc0NvbXBsZXRlKCkpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9jb21wbGV0ZWRUaWNrID0gLTE7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX3BpbmdQb25nU3RhdGUgIT09IFBJTkdfUE9OR19CRUdJTikgdGhpcy5fcGxheWJhY2tSYXRlID0gTWF0aC5hYnModGhpcy5fcGxheWJhY2tSYXRlKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9waW5nUG9uZ1N0YXRlID0gUElOR19QT05HX0JFR0lOOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRSZXBlYXRDb3VudCA9IDE7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY29tcGxldGUgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9maW5pc2hlZFRyaWdnZXJzID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5faW5pdGlhbFN0YXRlU2V0ID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9maXJzdFRpY2sgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLklzRm9yd2FyZFBsYXlCYWNrKCkpIHRoaXMuX1NldFRpbWUoMCk7CiAgICAgICAgICAgICAgICAgICAgZWxzZSB0aGlzLl9TZXRUaW1lKHRoaXMuR2V0VG90YWxUaW1lKCkpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX1NldFVwZGF0ZVN0YXRlQmVmb3JlKCk7CiAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCB0cmFjayBvZiB0aGlzLl90cmFja3MpIHRyYWNrLlNldEluaXRpYWxTdGF0ZSgpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX1NldFVwZGF0ZVN0YXRlQWZ0ZXIoKQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9maXJzdFRpY2sgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2ZpbmlzaGVkVHJpZ2dlcnMgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9TZXRVcGRhdGVTdGF0ZUJlZm9yZSgpOwogICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgdHJhY2sgb2YgdGhpcy5fdHJhY2tzKSB0cmFjay5TZXRSZXN1bWVTdGF0ZSgpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX1NldFVwZGF0ZVN0YXRlQWZ0ZXIoKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIEdldFJlbmRlckNoYW5nZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3JlbmRlckNoYW5nZQogICAgICAgIH0KICAgICAgICBfU2V0VXBkYXRlU3RhdGVCZWZvcmUoKSB7CiAgICAgICAgICAgIHRoaXMuX2hhc05lc3RlZENvbnRlbnQgPSAwOwogICAgICAgICAgICBmb3IgKGNvbnN0IHRyYWNrIG9mIHRoaXMuX3RyYWNrcykKICAgICAgICAgICAgICAgIGlmICh0cmFjay5Jc05lc3RlZCgpKSB0aGlzLl9oYXNOZXN0ZWRDb250ZW50ID0gMQogICAgICAgIH0KICAgICAgICBfU2V0VXBkYXRlU3RhdGVBZnRlcigpIHsKICAgICAgICAgICAgdGhpcy5fcmVuZGVyQ2hhbmdlID0gMDsKICAgICAgICAgICAgZm9yIChjb25zdCB0cmFjayBvZiB0aGlzLl90cmFja3MpIHsKICAgICAgICAgICAgICAgIHRyYWNrLl9TZXRVcGRhdGVTdGF0ZSgpOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuX3JlbmRlckNoYW5nZSA9PT0gMCAmJiB0cmFjay5HZXRSZW5kZXJDaGFuZ2UoKSA9PT0KICAgICAgICAgICAgICAgICAgICAxKSB0aGlzLl9yZW5kZXJDaGFuZ2UgPSAxOwogICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9iZWZvcmVBbmRBZnRlclRyYWNrcyAmJiB0cmFjay5HZXROZWVkc0JlZm9yZUFuZEFmdGVyKCkgPT09IDEpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX2JlZm9yZUFuZEFmdGVyVHJhY2tzKSB0aGlzLl9iZWZvcmVBbmRBZnRlclRyYWNrcyA9IFtdOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2JlZm9yZUFuZEFmdGVyVHJhY2tzTGVuZ3RoID0gdGhpcy5fYmVmb3JlQW5kQWZ0ZXJUcmFja3MucHVzaCh0cmFjaykKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBUaWNrKGRlbHRhVGltZSwgdGltZVNjYWxlLCBkZWx0YVRpbWUxKSB7CiAgICAgICAgICAgIGlmICh0aGlzLkdldFVzZVN5c3RlbVRpbWVzY2FsZSgpKSB7CiAgICAgICAgICAgICAgICBpZiAoZGVsdGFUaW1lID09PSAwICYmIHRoaXMuX2xhc3REZWx0YSA9PT0gMCkgcmV0dXJuOwogICAgICAgICAgICAgICAgdGhpcy5fbGFzdERlbHRhID0gZGVsdGFUaW1lCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAoZGVsdGFUaW1lMSA9PT0gMCAmJiB0aGlzLl9sYXN0RGVsdGEgPT09IDApIHJldHVybjsKICAgICAgICAgICAgICAgIHRoaXMuX2xhc3REZWx0YSA9IGRlbHRhVGltZTE7CiAgICAgICAgICAgICAgICBkZWx0YVRpbWUgPSBkZWx0YVRpbWUxOwogICAgICAgICAgICAgICAgdGltZVNjYWxlID0gMQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IGxhc3RUaW1lID0gdGhpcy5fcGxheWhlYWRUaW1lOwogICAgICAgICAgICBjb25zdCBuZXdEZWx0YVRpbWUgPSBkZWx0YVRpbWUgKiB0aW1lU2NhbGUgKiB0aGlzLl9wbGF5YmFja1JhdGU7CiAgICAgICAgICAgIGNvbnN0IG5ld1RpbWUgPSBsYXN0VGltZSArIG5ld0RlbHRhVGltZTsKICAgICAgICAgICAgY29uc3QgdG90YWxUaW1lID0gdGhpcy5fdGltZWxpbmVEYXRhSXRlbS5fdG90YWxUaW1lOwogICAgICAgICAgICBpZiAobmV3VGltZSA8IDApIHRoaXMuX3BsYXloZWFkVGltZSA9IDA7CiAgICAgICAgICAgIGVsc2UgaWYgKG5ld1RpbWUgPj0gdG90YWxUaW1lKSB0aGlzLl9wbGF5aGVhZFRpbWUgPSB0b3RhbFRpbWU7CiAgICAgICAgICAgIGVsc2UgdGhpcy5fcGxheWhlYWRUaW1lID0gbmV3VGltZTsKICAgICAgICAgICAgbGV0IGNvbXBsZXRlID0gZmFsc2U7CiAgICAgICAgICAgIGxldCBlbnN1cmVWYWx1ZSA9IGZhbHNlOwogICAgICAgICAgICBjb25zdCBsb29wID0gdGhpcy5HZXRMb29wKCk7CiAgICAgICAgICAgIGNvbnN0IHBpbmdQb25nID0gdGhpcy5HZXRQaW5nUG9uZygpOwogICAgICAgICAgICBpZiAoIWxvb3AgJiYgIXBpbmdQb25nKQogICAgICAgICAgICAgICAgaWYgKHRoaXMuX3BsYXliYWNrUmF0ZSA+IDApIHsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fcGxheWhlYWRUaW1lID49IHRvdGFsVGltZSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX2N1cnJlbnRSZXBlYXRDb3VudCA8IHRoaXMuR2V0UmVwZWF0Q291bnQoKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudFJlcGVhdENvdW50Kys7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9TZXRUaW1lQW5kUmVzZXQoMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbnN1cmVWYWx1ZSA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX1NldFRpbWUodG90YWxUaW1lKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9wbGF5aGVhZFRpbWUgPD0gMCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX2N1cnJlbnRSZXBlYXRDb3VudCA8IHRoaXMuR2V0UmVwZWF0Q291bnQoKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudFJlcGVhdENvdW50Kys7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9TZXRUaW1lQW5kUmVzZXQodG90YWxUaW1lKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuc3VyZVZhbHVlID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fU2V0VGltZSgwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgaWYgKGxvb3AgJiYgIXBpbmdQb25nKQogICAgICAgICAgICAgICAgaWYgKHRoaXMuX3BsYXliYWNrUmF0ZSA+IDApIHsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fcGxheWhlYWRUaW1lID49IHRvdGFsVGltZSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9TZXRUaW1lQW5kUmVzZXQoMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuc3VyZVZhbHVlID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX3BsYXloZWFkVGltZSA8PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX1NldFRpbWVBbmRSZXNldCh0b3RhbFRpbWUpOwogICAgICAgICAgICAgICAgICAgICAgICBlbnN1cmVWYWx1ZSA9IHRydWUKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgaWYgKCFsb29wICYmCiAgICAgICAgICAgICAgICBwaW5nUG9uZykKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9wbGF5YmFja1JhdGUgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX3BsYXloZWFkVGltZSA+PSB0b3RhbFRpbWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fU2V0VGltZSh0b3RhbFRpbWUpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLlNldFBsYXliYWNrUmF0ZSh0aGlzLkdldFBsYXliYWNrUmF0ZSgpICogLTEpOwogICAgICAgICAgICAgICAgICAgICAgICBlbnN1cmVWYWx1ZSA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9waW5nUG9uZ1N0YXRlID09PSBQSU5HX1BPTkdfRU5EKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX2N1cnJlbnRSZXBlYXRDb3VudCA8IHRoaXMuR2V0UmVwZWF0Q291bnQoKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRSZXBlYXRDb3VudCsrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3BpbmdQb25nU3RhdGUgPSBQSU5HX1BPTkdfQkVHSU4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBjb21wbGV0ZSA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuX3BpbmdQb25nU3RhdGUgPT09IFBJTkdfUE9OR19CRUdJTikgdGhpcy5fcGluZ1BvbmdTdGF0ZSA9IFBJTkdfUE9OR19FTkQKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9wbGF5aGVhZFRpbWUgPD0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9TZXRUaW1lKDApOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLlNldFBsYXliYWNrUmF0ZSh0aGlzLkdldFBsYXliYWNrUmF0ZSgpICoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0xKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5zdXJlVmFsdWUgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fcGluZ1BvbmdTdGF0ZSA9PT0gUElOR19QT05HX0VORCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9jdXJyZW50UmVwZWF0Q291bnQgPCB0aGlzLkdldFJlcGVhdENvdW50KCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50UmVwZWF0Q291bnQrKzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9waW5nUG9uZ1N0YXRlID0gUElOR19QT05HX0JFR0lOCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgY29tcGxldGUgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0aGlzLl9waW5nUG9uZ1N0YXRlID09PSBQSU5HX1BPTkdfQkVHSU4pIHRoaXMuX3BpbmdQb25nU3RhdGUgPSBQSU5HX1BPTkdfRU5ECiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmIChsb29wICYmIHBpbmdQb25nKQogICAgICAgICAgICAgICAgaWYgKHRoaXMuX3BsYXliYWNrUmF0ZSA+IDApIHsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fcGxheWhlYWRUaW1lID49IHRvdGFsVGltZSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9TZXRUaW1lKHRvdGFsVGltZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuU2V0UGxheWJhY2tSYXRlKHRoaXMuR2V0UGxheWJhY2tSYXRlKCkgKiAtMSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuc3VyZVZhbHVlID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcGluZ1BvbmdTdGF0ZSsrOwogICAgICAgICAgICAgICAgICAgICAgICBDMy53cmFwKHRoaXMuX3BpbmdQb25nU3RhdGUsIDAsIDIpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLl9wbGF5aGVhZFRpbWUgPD0KICAgICAgICAgICAgICAgIDApIHsKICAgICAgICAgICAgICAgIHRoaXMuX1NldFRpbWUoMCk7CiAgICAgICAgICAgICAgICB0aGlzLlNldFBsYXliYWNrUmF0ZSh0aGlzLkdldFBsYXliYWNrUmF0ZSgpICogLTEpOwogICAgICAgICAgICAgICAgZW5zdXJlVmFsdWUgPSB0cnVlOwogICAgICAgICAgICAgICAgdGhpcy5fcGluZ1BvbmdTdGF0ZSsrOwogICAgICAgICAgICAgICAgQzMud3JhcCh0aGlzLl9waW5nUG9uZ1N0YXRlLCAwLCAyKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGxldCBpOwogICAgICAgICAgICBjb25zdCBsID0gdGhpcy5fdHJhY2tzTGVuZ3RoOwogICAgICAgICAgICBpZiAoY29tcGxldGUpIHsKICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBsOyBpKyspIHRoaXMuX3RyYWNrc1tpXS5TZXRFbmRTdGF0ZSgpOwogICAgICAgICAgICAgICAgdGhpcy5TdG9wKHRydWUpOwogICAgICAgICAgICAgICAgdGhpcy5PbkNvbXBsZXRlZCgpOwogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgYmFsID0gdGhpcy5fYmVmb3JlQW5kQWZ0ZXJUcmFja3NMZW5ndGg7CiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBiYWw7IGkrKykgdGhpcy5fYmVmb3JlQW5kQWZ0ZXJUcmFja3NbaV0uQmVmb3JlSW50ZXJwb2xhdGUoKTsKICAgICAgICAgICAgaWYgKHRoaXMuX2hhc05lc3RlZENvbnRlbnQgPT09IDEpCiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdHJhY2sgPSB0aGlzLl90cmFja3NbaV07CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RhcnRPZmZzZXQgPSB0cmFjay5HZXRTdGFydE9mZnNldCgpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGxvY2FsVGltZSA9IHRoaXMuX3BsYXloZWFkVGltZSAtIHN0YXJ0T2Zmc2V0OwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGxhc3RMb2NhbFRpbWUgPSBsYXN0VGltZSAtIHN0YXJ0T2Zmc2V0OwogICAgICAgICAgICAgICAgICAgIGlmIChsb2NhbFRpbWUgPCAwICYmIGxhc3RMb2NhbFRpbWUgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdGFydE9mZnNldCA8IDApIHRoaXMuX3BsYXloZWFkVGltZSA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHN0YXJ0T2Zmc2V0ID49IHRvdGFsVGltZSkgdGhpcy5fcGxheWhlYWRUaW1lID0gdG90YWxUaW1lOwogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHRoaXMuX3BsYXloZWFkVGltZSA9IHN0YXJ0T2Zmc2V0OwogICAgICAgICAgICAgICAgICAgICAgICB0cmFjay5JbnRlcnBvbGF0ZShzdGFydE9mZnNldCwgdHJ1ZSwgZmFsc2UsIGVuc3VyZVZhbHVlLCB0aGlzLl9maXJzdFRpY2ssIGZhbHNlKQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB0cmFjay5JbnRlcnBvbGF0ZSh0aGlzLl9wbGF5aGVhZFRpbWUsIHRydWUsIGZhbHNlLCBlbnN1cmVWYWx1ZSwgdGhpcy5fZmlyc3RUaWNrLCBmYWxzZSkKICAgICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBsOyBpKyspIHRoaXMuX3RyYWNrc1tpXS5JbnRlcnBvbGF0ZSh0aGlzLl9wbGF5aGVhZFRpbWUsIHRydWUsIGZhbHNlLCBlbnN1cmVWYWx1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fZmlyc3RUaWNrLCBmYWxzZSk7CiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBiYWw7IGkrKykgdGhpcy5fYmVmb3JlQW5kQWZ0ZXJUcmFja3NbaV0uQWZ0ZXJJbnRlcnBvbGF0ZSgpOwogICAgICAgICAgICBpZiAodGhpcy5fZmlyc3RUaWNrKSB0aGlzLl9maXJzdFRpY2sgPSBmYWxzZQogICAgICAgIH0KICAgICAgICBfSW50ZXJwb2xhdGUodGltZSwgaXNUaWNraW5nID0gZmFsc2UsIHNldFRpbWUgPSBmYWxzZSwgZW5zdXJlVmFsdWUgPSBmYWxzZSwgbGFzdFRpbWUgPSBOYU4sIG9uVGlja0NhbGwgPSBmYWxzZSwgaWdub3JlR2xvYmFscyA9IGZhbHNlKSB7CiAgICAgICAgICAgIGZvciAoY29uc3QgdHJhY2sgb2YgdGhpcy5fdHJhY2tzKSB0cmFjay5CZWZvcmVJbnRlcnBvbGF0ZSgpOwogICAgICAgICAgICBmb3IgKGNvbnN0IHRyYWNrIG9mIHRoaXMuX3RyYWNrcykgewogICAgICAgICAgICAgICAgbGV0IHQgPSB0aW1lOwogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBsYXN0VGltZSA9PT0gIm51bWJlciIgJiYgIWlzTmFOKGxhc3RUaW1lKSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGdsb2JhbFRpbWUgPSB0aGlzLkdldFRpbWUoKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBsb2NhbFRpbWUgPSBnbG9iYWxUaW1lIC0gdHJhY2suR2V0U3RhcnRPZmZzZXQoKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBsYXN0TG9jYWxUaW1lID0KICAgICAgICAgICAgICAgICAgICAgICAgbGFzdFRpbWUgLSB0cmFjay5HZXRTdGFydE9mZnNldCgpOwogICAgICAgICAgICAgICAgICAgIGlmIChsb2NhbFRpbWUgPCAwICYmIGxhc3RMb2NhbFRpbWUgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHQgPSB0cmFjay5HZXRTdGFydE9mZnNldCgpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9TZXRUaW1lKHQpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdHJhY2suSW50ZXJwb2xhdGUodCwgaXNUaWNraW5nLCBzZXRUaW1lLCBlbnN1cmVWYWx1ZSwgdGhpcy5fZmlyc3RUaWNrLCBpZ25vcmVHbG9iYWxzKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciAoY29uc3QgdHJhY2sgb2YgdGhpcy5fdHJhY2tzKSB0cmFjay5BZnRlckludGVycG9sYXRlKCk7CiAgICAgICAgICAgIGlmICh0aGlzLl9maXJzdFRpY2sgJiYgb25UaWNrQ2FsbCkgdGhpcy5fZmlyc3RUaWNrID0gZmFsc2UKICAgICAgICB9CiAgICAgICAgQWRkVHJhY2soKSB7CiAgICAgICAgICAgIGNvbnN0IHRyYWNrRGF0YUl0ZW0gPSB0aGlzLl90aW1lbGluZURhdGFJdGVtLkdldFRyYWNrRGF0YSgpLkFkZEVtcHR5VHJhY2tEYXRhSXRlbSgpOwogICAgICAgICAgICBjb25zdCB0cmFjayA9IEMzLlRyYWNrU3RhdGUuQ3JlYXRlKHRoaXMsIHRyYWNrRGF0YUl0ZW0pOwogICAgICAgICAgICB0aGlzLl90cmFja3NMZW5ndGggPSB0aGlzLl90cmFja3MucHVzaCh0cmFjayk7CiAgICAgICAgICAgIHJldHVybiB0cmFjawogICAgICAgIH0KICAgICAgICBSZW1vdmVkKCkgewogICAgICAgICAgICBpZiAodGhpcy5Jc1JlbGVhc2VkKCkpIHJldHVybjsKICAgICAgICAgICAgZm9yIChjb25zdCB0cmFjayBvZiB0aGlzLl90cmFja3MpIHRyYWNrLlRpbWVsaW5lUmVtb3ZlZCgpCiAgICAgICAgfQogICAgICAgIENsZWFuQ2FjaGVzKCkgewogICAgICAgICAgICBmb3IgKGNvbnN0IHRyYWNrIG9mIHRoaXMuX3RyYWNrcykgdHJhY2suQ2xlYW5DYWNoZXMoKQogICAgICAgIH0KICAgICAgICBDbGVhclRyYWNrSW5zdGFuY2VzKCkgewogICAgICAgICAgICBmb3IgKGNvbnN0IHRyYWNrIG9mIHRoaXMuX3RyYWNrcykgdHJhY2suQ2xlYXJJbnN0YW5jZSgpCiAgICAgICAgfQogICAgICAgIFNldFRyYWNrSW5zdGFuY2UodHJhY2tJZCwgaW5zdGFuY2UpIHsKICAgICAgICAgICAgaWYgKCFpbnN0YW5jZSkgcmV0dXJuOwogICAgICAgICAgICBmb3IgKGNvbnN0IHRyYWNrIG9mIHRoaXMuX3RyYWNrcykgewogICAgICAgICAgICAgICAgaWYgKCF0cmFjay5Jc0luc3RhbmNlVHJhY2soKSkgY29udGludWU7CiAgICAgICAgICAgICAgICBpZiAodHJhY2tJZCkgewogICAgICAgICAgICAgICAgICAgIGlmICh0cmFjay5HZXRJZCgpICE9PSB0cmFja0lkKSBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICB0cmFjay5TZXRJbnN0YW5jZShpbnN0YW5jZSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGltZWxpbmVNYW5hZ2VyLlNldFRpbWVsaW5lT2JqZWN0Q2xhc3NUb01hcChpbnN0YW5jZS5HZXRPYmplY3RDbGFzcygpLCB0aGlzKTsKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBpZiAodHJhY2suSGFzSW5zdGFuY2UoKSkgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgdHJhY2suU2V0SW5zdGFuY2UoaW5zdGFuY2UpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3RpbWVsaW5lTWFuYWdlci5TZXRUaW1lbGluZU9iamVjdENsYXNzVG9NYXAoaW5zdGFuY2UuR2V0T2JqZWN0Q2xhc3MoKSwgdGhpcyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBIYXNUcmFja0luc3RhbmNlKGluc3RhbmNlLCB0cmFja0lkKSB7CiAgICAgICAgICAgIGZvciAoY29uc3QgdHJhY2sgb2YgdGhpcy5fdHJhY2tzKSB7CiAgICAgICAgICAgICAgICBpZiAoIXRyYWNrLklzSW5zdGFuY2VUcmFjaygpKSBjb250aW51ZTsKICAgICAgICAgICAgICAgIGlmICh0cmFja0lkKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRyYWNrSWQgPT09IHRyYWNrLkdldElkKCkgJiYgaW5zdGFuY2UgPT09IHRyYWNrLkdldEluc3RhbmNlKCkpIHJldHVybiB0cnVlCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGluc3RhbmNlID09PSB0cmFjay5HZXRJbnN0YW5jZSgpKSByZXR1cm4gdHJ1ZQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZQogICAgICAgIH0KICAgICAgICBIYXNWYWxpZFRyYWNrcygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RyYWNrcy5zb21lKHQgPT4gewogICAgICAgICAgICAgICAgaWYgKHQuSXNJbnN0YW5jZVRyYWNrKCkpIHJldHVybiB0LkNhbkluc3RhbmNlQmVWYWxpZCgpOwogICAgICAgICAgICAgICAgZWxzZSByZXR1cm4gdHJ1ZQogICAgICAgICAgICB9KQogICAgICAgIH0KICAgICAgICBIYXNWYWxpZEdsb2JhbFRyYWNrcygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RyYWNrcy5zb21lKHQgPT4gewogICAgICAgICAgICAgICAgaWYgKHQuSXNJbnN0YW5jZVRyYWNrKCkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIXQuQ2FuSW5zdGFuY2VCZVZhbGlkKCkpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBvYmplY3RDbGFzcyA9IHQuR2V0T2JqZWN0Q2xhc3MoKTsKICAgICAgICAgICAgICAgICAgICBpZiAoIW9iamVjdENsYXNzKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9iamVjdENsYXNzLklzR2xvYmFsKCkKICAgICAgICAgICAgICAgIH0gZWxzZSByZXR1cm4gZmFsc2UKICAgICAgICAgICAgfSkKICAgICAgICB9CiAgICAgICAgR2V0UHJvcGVydHlUcmFjayhwcm9wZXJ0eU5hbWUpIHsKICAgICAgICAgICAgZm9yIChjb25zdCB0cmFjayBvZiB0aGlzLkdldFRyYWNrcygpKQogICAgICAgICAgICAgICAgZm9yIChjb25zdCBwcm9wZXJ0eVRyYWNrIG9mIHRyYWNrLkdldFByb3BlcnR5VHJhY2tzKCkpCiAgICAgICAgICAgICAgICAgICAgaWYgKHByb3BlcnR5VHJhY2suR2V0UHJvcGVydHlOYW1lKCkgPT09IHByb3BlcnR5TmFtZSkgcmV0dXJuIHByb3BlcnR5VHJhY2sKICAgICAgICB9CiAgICAgICAgR2V0VHJhY2tGcm9tSW5zdGFuY2UoaW5zdGFuY2UpIHsKICAgICAgICAgICAgZm9yIChjb25zdCB0cmFjayBvZiB0aGlzLl90cmFja3MpCiAgICAgICAgICAgICAgICBpZiAoaW5zdGFuY2UgPT09IHRyYWNrLkdldEluc3RhbmNlKCkpIHJldHVybiB0cmFjazsKICAgICAgICAgICAgcmV0dXJuIG51bGwKICAgICAgICB9CiAgICAgICAgR2V0S2V5ZnJhbWVXaXRoVGFncyh0YWdzKSB7CiAgICAgICAgICAgIGxldCB0YWdzQXJyYXkgPQogICAgICAgICAgICAgICAgdGFncyA/IHRhZ3Muc3BsaXQoIiAiKSA6IFtdOwogICAgICAgICAgICBjb25zdCB0YWdzU2V0ID0gbmV3IFNldCh0YWdzQXJyYXkubWFwKHQgPT4gdC50b0xvd2VyQ2FzZSgpLnRyaW0oKSkpOwogICAgICAgICAgICB0YWdzQXJyYXkgPSBbLi4udGFnc1NldC52YWx1ZXMoKV07CiAgICAgICAgICAgIGZvciAoY29uc3QgdHJhY2sgb2YgdGhpcy5HZXRUcmFja3MoKSkKICAgICAgICAgICAgICAgIGZvciAoY29uc3Qga2V5ZnJhbWVEYXRhSXRlbSBvZiB0cmFjay5HZXRLZXlmcmFtZURhdGFJdGVtcygpKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgaGFzQWxsVGFncyA9IHRhZ3NBcnJheS5ldmVyeSh0ID0+IGtleWZyYW1lRGF0YUl0ZW0uSGFzVGFnKHQpKTsKICAgICAgICAgICAgICAgICAgICBpZiAoaGFzQWxsVGFncykgcmV0dXJuIGtleWZyYW1lRGF0YUl0ZW0KICAgICAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgR2V0T2JqZWN0Q2xhc3NlcygpIHsKICAgICAgICAgICAgY29uc3QgcmV0ID0gW107CiAgICAgICAgICAgIGZvciAoY29uc3QgdHJhY2sgb2YgdGhpcy5HZXRUcmFja3MoKSkgcmV0LnB1c2godHJhY2suR2V0T2JqZWN0Q2xhc3MoKSk7CiAgICAgICAgICAgIHJldHVybiByZXQuZmlsdGVyKG9jID0+IG9jKQogICAgICAgIH0KICAgICAgICBfU2F2ZVRvSnNvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICJ0cmFja3NKc29uIjogdGhpcy5fU2F2ZVRyYWNrc1RvSnNvbigpLAogICAgICAgICAgICAgICAgIm5hbWUiOiB0aGlzLl9uYW1lLAogICAgICAgICAgICAgICAgInBsYXloZWFkVGltZSI6IHRoaXMuR2V0VGltZSgpLAogICAgICAgICAgICAgICAgInBsYXliYWNrUmF0ZSI6IHRoaXMuX3BsYXliYWNrUmF0ZSwKICAgICAgICAgICAgICAgICJwaW5nUG9uZ1N0YXRlIjogdGhpcy5fcGluZ1BvbmdTdGF0ZSwKICAgICAgICAgICAgICAgICJjdXJyZW50UmVwZWF0Q291bnQiOiB0aGlzLl9jdXJyZW50UmVwZWF0Q291bnQsCiAgICAgICAgICAgICAgICAiaXNQbGF5aW5nIjogdGhpcy5faXNQbGF5aW5nLAogICAgICAgICAgICAgICAgImlzU2NoZWR1bGVkIjogdGhpcy5faXNTY2hlZHVsZWQsCiAgICAgICAgICAgICAgICAiaW5pdGlhbFN0YXRlU2V0IjogdGhpcy5faW5pdGlhbFN0YXRlU2V0LAogICAgICAgICAgICAgICAgImZpbmlzaGVkVHJpZ2dlcnMiOiB0aGlzLl9maW5pc2hlZFRyaWdnZXJzLAogICAgICAgICAgICAgICAgImNvbXBsZXRlIjogdGhpcy5fY29tcGxldGUsCiAgICAgICAgICAgICAgICAicmVsZWFzZWQiOiB0aGlzLl9yZWxlYXNlZCwKICAgICAgICAgICAgICAgICJtYXJrZWRGb3JSZW1vdmFsIjogdGhpcy5fbWFya2VkRm9yUmVtb3ZhbCwKICAgICAgICAgICAgICAgICJjb21wbGV0ZWRUaWNrIjogdGhpcy5fY29tcGxldGVkVGljaywKICAgICAgICAgICAgICAgICJpbXBsaWNpdFBhdXNlIjogdGhpcy5faW1wbGljaXRQYXVzZSwKICAgICAgICAgICAgICAgICJpc1RlbXBsYXRlIjogdGhpcy5faXNUZW1wbGF0ZSwKICAgICAgICAgICAgICAgICJ0YWdzIjogdGhpcy5fdGFncy5qb2luKCIgIiksCiAgICAgICAgICAgICAgICAic3RyaW5nVGFncyI6IHRoaXMuX3N0cmluZ1RhZ3MsCiAgICAgICAgICAgICAgICAidGFnc0NoYW5nZWQiOiB0aGlzLl90YWdzQ2hhbmdlZCwKICAgICAgICAgICAgICAgICJmaXJzdFRpY2siOiB0aGlzLl9maXJzdFRpY2sKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBfTG9hZEZyb21Kc29uKG8pIHsKICAgICAgICAgICAgaWYgKCFvKSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuX0xvYWRUcmFja3NGcm9tSnNvbihvWyJ0cmFja3NKc29uIl0pOwogICAgICAgICAgICB0aGlzLl9uYW1lID0gb1sibmFtZSJdOwogICAgICAgICAgICB0aGlzLl9wbGF5aGVhZFRpbWUgPSBvWyJwbGF5aGVhZFRpbWUiXTsKICAgICAgICAgICAgdGhpcy5fcGxheWJhY2tSYXRlID0gb1sicGxheWJhY2tSYXRlIl07CiAgICAgICAgICAgIHRoaXMuX3BpbmdQb25nU3RhdGUgPSBvWyJwaW5nUG9uZ1N0YXRlIl07CiAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRSZXBlYXRDb3VudCA9IG9bImN1cnJlbnRSZXBlYXRDb3VudCJdOwogICAgICAgICAgICB0aGlzLl9pc1BsYXlpbmcgPSAhIW9bImlzUGxheWluZyJdOwogICAgICAgICAgICB0aGlzLl9pc1NjaGVkdWxlZCA9ICEhb1siaXNTY2hlZHVsZWQiXTsKICAgICAgICAgICAgdGhpcy5faW5pdGlhbFN0YXRlU2V0ID0gISFvWyJpbml0aWFsU3RhdGVTZXQiXTsKICAgICAgICAgICAgdGhpcy5fZmluaXNoZWRUcmlnZ2VycyA9CiAgICAgICAgICAgICAgICBvLmhhc093blByb3BlcnR5KCJmaW5pc2hlZFRyaWdnZXJzIikgPyAhIW9bImZpbmlzaGVkVHJpZ2dlcnMiXSA6IGZhbHNlOwogICAgICAgICAgICB0aGlzLl9jb21wbGV0ZSA9ICEhb1siY29tcGxldGUiXTsKICAgICAgICAgICAgdGhpcy5fcmVsZWFzZWQgPSAhIW9bInJlbGVhc2VkIl07CiAgICAgICAgICAgIHRoaXMuX21hcmtlZEZvclJlbW92YWwgPSAhIW9bIm1hcmtlZEZvclJlbW92YWwiXTsKICAgICAgICAgICAgdGhpcy5fY29tcGxldGVkVGljayA9IG9bImNvbXBsZXRlZFRpY2siXTsKICAgICAgICAgICAgdGhpcy5faW1wbGljaXRQYXVzZSA9ICEhb1siaW1wbGljaXRQYXVzZSJdOwogICAgICAgICAgICB0aGlzLl9pc1RlbXBsYXRlID0gISFvWyJpc1RlbXBsYXRlIl07CiAgICAgICAgICAgIHRoaXMuX3RhZ3MgPSBvWyJ0YWdzIl0uc3BsaXQoIiAiKTsKICAgICAgICAgICAgdGhpcy5fc3RyaW5nVGFncyA9IG9bInN0cmluZ1RhZ3MiXTsKICAgICAgICAgICAgdGhpcy5fdGFnc0NoYW5nZWQgPSAhIW9bInRhZ3NDaGFuZ2VkIl07CiAgICAgICAgICAgIHRoaXMuX2ZpcnN0VGljayA9ICEhb1siZmlyc3RUaWNrIl0KICAgICAgICB9CiAgICAgICAgX1NhdmVUcmFja3NUb0pzb24oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl90cmFja3MubWFwKHRyYWNrU3RhdGUgPT4gdHJhY2tTdGF0ZS5fU2F2ZVRvSnNvbigpKQogICAgICAgIH0KICAgICAgICBfTG9hZFRyYWNrc0Zyb21Kc29uKHRyYWNrc0pzb24pIHsKICAgICAgICAgICAgdGhpcy5DbGVhclRyYWNrSW5zdGFuY2VzKCk7CiAgICAgICAgICAgIHRyYWNrc0pzb24uZm9yRWFjaCgodHJhY2tKc29uLCBpKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCB0cmFjayA9IHRoaXMuX3RyYWNrc1tpXTsKICAgICAgICAgICAgICAgIHRyYWNrLl9Mb2FkRnJvbUpzb24odHJhY2tKc29uKQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdGhpcy5fdHJhY2tzLmZpbHRlcih0cmFjayA9PiB0cmFjay5DYW5JbnN0YW5jZUJlVmFsaWQoKSkKICAgICAgICB9CiAgICAgICAgc3RhdGljIF9IYXNUYWcodGFnKSB7CiAgICAgICAgICAgIGNvbnN0IHRhZ3MgPSB0aGlzLkdldFRhZ3MoKTsKICAgICAgICAgICAgaWYgKHRhZyA9PT0gIiIpIHJldHVybiB0YWdzLmxlbmd0aCA9PT0gMSAmJiB0YWdzWzBdID09PSAiIjsKICAgICAgICAgICAgcmV0dXJuIHRhZ3MubWFwKHQgPT4gdC50b0xvd2VyQ2FzZSgpKS5pbmNsdWRlcyh0YWcudG9Mb3dlckNhc2UoKSkKICAgICAgICB9CiAgICAgICAgc3RhdGljIF9HZXRUYWdBcnJheSh0YWdzKSB7CiAgICAgICAgICAgIGlmIChDMy5Jc0FycmF5KHRhZ3MpKSByZXR1cm4gdGFncy5zbGljZSgwKTsKICAgICAgICAgICAgaWYgKEMzLklzU3RyaW5nKHRhZ3MpKSByZXR1cm4gdGFncy5zcGxpdCgiICIpOwogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoImludmFsaWQgdGFncyIpOwogICAgICAgIH0KICAgICAgICBHZXRJVGltZWxpbmVTdGF0ZSgpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLl9pVGltZWxpbmVTdGF0ZSkgdGhpcy5faVRpbWVsaW5lU3RhdGUgPQogICAgICAgICAgICAgICAgQzMuTmV3KHNlbGYuSVRpbWVsaW5lU3RhdGUsIHRoaXMpOwogICAgICAgICAgICByZXR1cm4gdGhpcy5faVRpbWVsaW5lU3RhdGUKICAgICAgICB9CiAgICB9OwoKfQoKLy8gdGltZWxpbmVzL3N0YXRlL3RyYWNrU3RhdGUuanMKewogICAgJ3VzZSBzdHJpY3QnOwogICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgY29uc3QgSU5TVEFOQ0VfVFJBQ0sgPSAwOwogICAgY29uc3QgVkFMVUVfVFJBQ0sgPSAxOwogICAgY29uc3QgQVVESU9fVFJBQ0sgPSAyOwogICAgQzMuVHJhY2tTdGF0ZSA9IGNsYXNzIFRyYWNrIGV4dGVuZHMgQzMuRGVmZW5kZWRCYXNlIHsKICAgICAgICBjb25zdHJ1Y3Rvcih0aW1lbGluZSwgdHJhY2tEYXRhSXRlbSkgewogICAgICAgICAgICBzdXBlcigpOwogICAgICAgICAgICB0aGlzLl90aW1lbGluZSA9IHRpbWVsaW5lOwogICAgICAgICAgICB0aGlzLl90cmFja0RhdGFJdGVtID0gdHJhY2tEYXRhSXRlbTsKICAgICAgICAgICAgdGhpcy5fdHJhY2tEYXRhID0gdHJhY2tEYXRhSXRlbS5HZXRUcmFja0RhdGEoKTsKICAgICAgICAgICAgdGhpcy5faW5zdGFuY2VVaWQgPSBOYU47CiAgICAgICAgICAgIHRoaXMuX29iamVjdENsYXNzSW5kZXggPSBOYU47CiAgICAgICAgICAgIHRoaXMuX2luc3RhbmNlID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fd29ybGRJbmZvID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5faXNOZXN0ZWQgPSB0cmFja0RhdGFJdGVtLkdldFN0YXJ0T2Zmc2V0KCkgPiAwOwogICAgICAgICAgICB0aGlzLl9pbml0aWFsU3RhdGVPZk5lc3RlZFNldCA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl9lbmRTdGF0ZU9mTmVzdGVkU2V0ID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX2xhc3RLZXlmcmFtZURhdGFJdGVtID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fa2V5ZnJhbWVEYXRhSXRlbXMgPSB0aGlzLl90cmFja0RhdGFJdGVtLkdldEtleWZyYW1lRGF0YSgpLkdldEtleWZyYW1lRGF0YUl0ZW1BcnJheSgpOwogICAgICAgICAgICB0aGlzLl9wcm9wZXJ0eVRyYWNrcyA9IFtdOwogICAgICAgICAgICB0aGlzLkNyZWF0ZVByb3BlcnR5VHJhY2tTdGF0ZXMoKTsKICAgICAgICAgICAgdGhpcy5fd29ybGRJbmZvQ2hhbmdlID0gMDsKICAgICAgICAgICAgdGhpcy5fcmVuZGVyQ2hhbmdlID0gMDsKICAgICAgICAgICAgdGhpcy5fbmVlZHNCZWZvcmVBbmRBZnRlciA9IDAKICAgICAgICB9CiAgICAgICAgc3RhdGljIENyZWF0ZSh0aW1lbGluZSwgdHJhY2tEYXRhSXRlbSkgewogICAgICAgICAgICByZXR1cm4gQzMuTmV3KEMzLlRyYWNrU3RhdGUsIHRpbWVsaW5lLCB0cmFja0RhdGFJdGVtKQogICAgICAgIH0KICAgICAgICBSZWxlYXNlKCkgewogICAgICAgICAgICB0aGlzLl9rZXlmcmFtZURhdGFJdGVtcyA9IG51bGw7CiAgICAgICAgICAgIGZvciAoY29uc3QgcHJvcGVydHlUcmFjayBvZiB0aGlzLl9wcm9wZXJ0eVRyYWNrcykgcHJvcGVydHlUcmFjay5SZWxlYXNlKCk7CiAgICAgICAgICAgIEMzLmNsZWFyQXJyYXkodGhpcy5fcHJvcGVydHlUcmFja3MpOwogICAgICAgICAgICB0aGlzLl9wcm9wZXJ0eVRyYWNrcyA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3RpbWVsaW5lID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5faW5zdGFuY2UgPSBudWxsOwogICAgICAgICAgICB0aGlzLl93b3JsZEluZm8gPSBudWxsOwogICAgICAgICAgICB0aGlzLl90cmFja0RhdGFJdGVtID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fbGFzdEtleWZyYW1lRGF0YUl0ZW0gPQogICAgICAgICAgICAgICAgbnVsbAogICAgICAgIH0KICAgICAgICBDcmVhdGVQcm9wZXJ0eVRyYWNrU3RhdGVzKCkgewogICAgICAgICAgICBmb3IgKGNvbnN0IHByb3BlcnR5VHJhY2tEYXRhSXRlbSBvZiB0aGlzLl90cmFja0RhdGFJdGVtLkdldFByb3BlcnR5VHJhY2tEYXRhKCkucHJvcGVydHlUcmFja0RhdGFJdGVtcygpKSB0aGlzLl9wcm9wZXJ0eVRyYWNrcy5wdXNoKEMzLlByb3BlcnR5VHJhY2tTdGF0ZS5DcmVhdGUodGhpcywgcHJvcGVydHlUcmFja0RhdGFJdGVtKSkKICAgICAgICB9CiAgICAgICAgVGltZWxpbmVSZW1vdmVkKCkgewogICAgICAgICAgICBmb3IgKGNvbnN0IHByb3BlcnR5VHJhY2sgb2YgdGhpcy5fcHJvcGVydHlUcmFja3MpIHByb3BlcnR5VHJhY2suVGltZWxpbmVSZW1vdmVkKCkKICAgICAgICB9CiAgICAgICAgQ2xlYW5DYWNoZXMoKSB7CiAgICAgICAgICAgIGZvciAoY29uc3QgcHJvcGVydHlUcmFjayBvZiB0aGlzLl9wcm9wZXJ0eVRyYWNrcykgcHJvcGVydHlUcmFjay5DbGVhbkNhY2hlcygpOwogICAgICAgICAgICB0aGlzLl9pbnN0YW5jZSA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3dvcmxkSW5mbyA9IG51bGwKICAgICAgICB9CiAgICAgICAgR2V0VGltZWxpbmUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl90aW1lbGluZQogICAgICAgIH0KICAgICAgICBHZXRSdW50aW1lKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fdGltZWxpbmUuR2V0UnVudGltZSgpCiAgICAgICAgfQogICAgICAgIEdldEtleWZyYW1lRGF0YUl0ZW1zKCkgewogICAgICAgICAgICBpZiAodGhpcy5fa2V5ZnJhbWVEYXRhSXRlbXMpIHJldHVybiB0aGlzLl9rZXlmcmFtZURhdGFJdGVtczsKICAgICAgICAgICAgdGhpcy5fa2V5ZnJhbWVEYXRhSXRlbXMgPSB0aGlzLl90cmFja0RhdGFJdGVtLkdldEtleWZyYW1lRGF0YSgpLkdldEtleWZyYW1lRGF0YUl0ZW1BcnJheSgpOwogICAgICAgICAgICByZXR1cm4gdGhpcy5fa2V5ZnJhbWVEYXRhSXRlbXMKICAgICAgICB9CiAgICAgICAgR2V0UHJvcGVydHlUcmFja3MoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9wcm9wZXJ0eVRyYWNrcwogICAgICAgIH0KICAgICAgICBHZXRQcm9wZXJ0eVRyYWNrKHByb3BlcnR5TmFtZSkgewogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuX3Byb3BlcnR5VHJhY2tzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBjb25zdCBwcm9wZXJ0eVRyYWNrID0gdGhpcy5fcHJvcGVydHlUcmFja3NbaV07CiAgICAgICAgICAgICAgICBpZiAocHJvcGVydHlUcmFjay5HZXRQcm9wZXJ0eU5hbWUoKSA9PT0gcHJvcGVydHlOYW1lKSByZXR1cm4gcHJvcGVydHlUcmFjawogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIE1heWJlR2V0SW5zdGFuY2UoKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5faW5zdGFuY2UpIHRoaXMuR2V0SW5zdGFuY2UoKQogICAgICAgIH0KICAgICAgICBJc0luc3RhbmNlVmFsaWQoKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5faW5zdGFuY2UpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgcmV0dXJuICF0aGlzLl9pbnN0YW5jZS5Jc0Rlc3Ryb3llZCgpCiAgICAgICAgfQogICAgICAgIENhbkluc3RhbmNlQmVWYWxpZCgpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLklzSW5zdGFuY2VUcmFjaygpKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGNvbnN0IHVpZCA9IHRoaXMuR2V0SW5zdGFuY2VVSUQoKTsKICAgICAgICAgICAgY29uc3QgaW5zdGFuY2UgPSB0aGlzLkdldFJ1bnRpbWUoKS5HZXRJbnN0YW5jZUJ5VUlEKHVpZCk7CiAgICAgICAgICAgIGlmICghaW5zdGFuY2UpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgcmV0dXJuICFpbnN0YW5jZS5Jc0Rlc3Ryb3llZCgpCiAgICAgICAgfQogICAgICAgIEdldE9iamVjdENsYXNzKCkgewogICAgICAgICAgICBpZiAoIXRoaXMuSXNJbnN0YW5jZVRyYWNrKCkpIHJldHVybjsKICAgICAgICAgICAgY29uc3QgaW5kZXggPSB0aGlzLkdldE9iamVjdENsYXNzSW5kZXgoKTsKICAgICAgICAgICAgaWYgKGluZGV4ID09PSAtMSkgcmV0dXJuOwogICAgICAgICAgICByZXR1cm4gdGhpcy5HZXRSdW50aW1lKCkuR2V0T2JqZWN0Q2xhc3NCeUluZGV4KGluZGV4KQogICAgICAgIH0KICAgICAgICBDbGVhckluc3RhbmNlKCkgewogICAgICAgICAgICB0aGlzLl9pbnN0YW5jZSA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX2luc3RhbmNlVWlkID0gLTE7CiAgICAgICAgICAgIHRoaXMuX3dvcmxkSW5mbyA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX29iamVjdENsYXNzSW5kZXggPSAtMQogICAgICAgIH0KICAgICAgICBIYXNJbnN0YW5jZSgpIHsKICAgICAgICAgICAgcmV0dXJuICEhdGhpcy5faW5zdGFuY2UKICAgICAgICB9CiAgICAgICAgR2V0SW5zdGFuY2UoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9pbnN0YW5jZSAmJiB0aGlzLklzSW5zdGFuY2VWYWxpZCgpKSByZXR1cm4gdGhpcy5faW5zdGFuY2U7CiAgICAgICAgICAgIGNvbnN0IHVpZCA9IHRoaXMuR2V0SW5zdGFuY2VVSUQoKTsKICAgICAgICAgICAgdGhpcy5faW5zdGFuY2UgPSB0aGlzLkdldFJ1bnRpbWUoKS5HZXRJbnN0YW5jZUJ5VUlEKHVpZCk7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pbnN0YW5jZQogICAgICAgIH0KICAgICAgICBTZXRJbnN0YW5jZShpbnN0YW5jZSkgewogICAgICAgICAgICBpZiAodGhpcy5faW5zdGFuY2UgPT09IGluc3RhbmNlKSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuQ2xlYW5DYWNoZXMoKTsKICAgICAgICAgICAgdGhpcy5faW5zdGFuY2UgPSBpbnN0YW5jZTsKICAgICAgICAgICAgdGhpcy5fb2JqZWN0Q2xhc3NJbmRleCA9IGluc3RhbmNlLkdldE9iamVjdENsYXNzKCkuR2V0SW5kZXgoKTsKICAgICAgICAgICAgdGhpcy5faW5zdGFuY2VVaWQgPSBpbnN0YW5jZS5HZXRVSUQoKTsKICAgICAgICAgICAgdGhpcy5fd29ybGRJbmZvID0gaW5zdGFuY2UuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgIGZvciAoY29uc3QgaXRlbSBvZiB0aGlzLnByb3BlcnR5VHJhY2tJdGVtcygpKSB7CiAgICAgICAgICAgICAgICBjb25zdCBwcm9wZXJ0eVRyYWNrID0gaXRlbS5wcm9wZXJ0eVRyYWNrOwogICAgICAgICAgICAgICAgY29uc3Qgc291cmNlQWRhcHRlciA9IGl0ZW0uc291cmNlQWRhcHRlcjsKICAgICAgICAgICAgICAgIGNvbnN0IGlkID0gcHJvcGVydHlUcmFjay5HZXRTb3VyY2VBZGFwdGVySWQoKTsKICAgICAgICAgICAgICAgIHN3aXRjaCAoaWQpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlICJpbnN0YW5jZS12YXJpYWJsZSI6CiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gc291cmNlQWRhcHRlci5HZXRFZGl0b3JJbmRleCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgb2JqZWN0Q2xhc3MgPSBpbnN0YW5jZS5HZXRPYmplY3RDbGFzcygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaSA9IG9iamVjdENsYXNzLkdldEluc3RhbmNlVmFyaWFibGVJbmRleEJ5TmFtZShpdGVtLm5hbWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbmFtZSA9IG9iamVjdENsYXNzLkdldEluc3RhbmNlVmFyaWFibGVOYW1lKGkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdHlwZSA9IG9iamVjdENsYXNzLkdldEluc3RhbmNlVmFyaWFibGVUeXBlKGkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5hbWUgPT09IGl0ZW0ubmFtZSAmJiB0eXBlID09PSBpdGVtLnR5cGUpIHNvdXJjZUFkYXB0ZXIuVXBkYXRlSW5zdGFuY2VWYXJpYWJsZUluZGV4KGkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGNhc2UgImJlaGF2aW9yIjoKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdGltZWxpbmVCZWhhdmlvclR5cGUgPSBpdGVtLmJlaGF2aW9yVHlwZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRyYWNrT2JqZWN0Q2xhc3MgPSB0aGlzLkdldE9iamVjdENsYXNzKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBvYmplY3RDbGFzcyA9IGluc3RhbmNlLkdldE9iamVjdENsYXNzKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpbnN0YW5jZUJlaGF2aW9yVHlwZSA9IHNvdXJjZUFkYXB0ZXIuR2V0QmVoYXZpb3JUeXBlKG9iamVjdENsYXNzKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aW1lbGluZUJlaGF2aW9yVHlwZSAmJiBpbnN0YW5jZUJlaGF2aW9yVHlwZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG5hbWUgPSB0aW1lbGluZUJlaGF2aW9yVHlwZS5HZXROYW1lKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdGVtcGxhdGVCZWhhdmlvckluZGV4ID0gdHJhY2tPYmplY3RDbGFzcy5HZXRCZWhhdmlvckluZGV4QnlOYW1lKG5hbWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGluc3RhbmNlQmVoYXZpb3JJbmRleCA9IG9iamVjdENsYXNzLkdldEJlaGF2aW9ySW5kZXhCeU5hbWUobmFtZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJvcGVydHlJbmRleCA9IHNvdXJjZUFkYXB0ZXIuR2V0RWRpdG9ySW5kZXgoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2VBZGFwdGVyLlVwZGF0ZUJlaGF2aW9yVHlwZVNpZChpbnN0YW5jZUJlaGF2aW9yVHlwZS5HZXRTSUQoKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0qIHByb3BlcnR5VHJhY2tJdGVtcygpIHsKICAgICAgICAgICAgZm9yIChjb25zdCBwcm9wZXJ0eVRyYWNrIG9mIHRoaXMuX3Byb3BlcnR5VHJhY2tzKSB7CiAgICAgICAgICAgICAgICBjb25zdCBzb3VyY2VBZGFwdGVyID0KICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eVRyYWNrLkdldFNvdXJjZUFkYXB0ZXIoKTsKICAgICAgICAgICAgICAgIGNvbnN0IG9iamVjdENsYXNzID0gdGhpcy5HZXRPYmplY3RDbGFzcygpOwogICAgICAgICAgICAgICAgY29uc3QgcmV0ID0gewogICAgICAgICAgICAgICAgICAgIHByb3BlcnR5VHJhY2s6IHByb3BlcnR5VHJhY2ssCiAgICAgICAgICAgICAgICAgICAgc291cmNlQWRhcHRlcjogc291cmNlQWRhcHRlcgogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIHN3aXRjaCAocHJvcGVydHlUcmFjay5HZXRTb3VyY2VBZGFwdGVySWQoKSkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgIndvcmxkLWluc3RhbmNlIjoKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0LnByb3BlcnR5ID0gcHJvcGVydHlUcmFjay5HZXRQcm9wZXJ0eU5hbWUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBjYXNlICJpbnN0YW5jZS12YXJpYWJsZSI6CiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gc291cmNlQWRhcHRlci5HZXRFZGl0b3JJbmRleCgpO3JldC5uYW1lID0gb2JqZWN0Q2xhc3MuR2V0SW5zdGFuY2VWYXJpYWJsZU5hbWUoaW5kZXgpO3JldC50eXBlID0gb2JqZWN0Q2xhc3MuR2V0SW5zdGFuY2VWYXJpYWJsZVR5cGUoaW5kZXgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGNhc2UgImVmZmVjdCI6CiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGVmZmVjdExpc3QgPSBvYmplY3RDbGFzcy5HZXRFZmZlY3RMaXN0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBlZmZlY3RUeXBlID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2VBZGFwdGVyLkdldEVmZmVjdFR5cGUoZWZmZWN0TGlzdCk7cmV0LmVmZmVjdFR5cGUgPSBlZmZlY3RUeXBlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGNhc2UgImJlaGF2aW9yIjoKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYmVoYXZpb3JUeXBlID0gc291cmNlQWRhcHRlci5HZXRCZWhhdmlvclR5cGUob2JqZWN0Q2xhc3MpO3JldC5iZWhhdmlvclR5cGUgPSBiZWhhdmlvclR5cGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY2FzZSAicGx1Z2luIjoKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0LnBsdWdpbiA9IG9iamVjdENsYXNzLkdldFBsdWdpbigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGNhc2UgInZhbHVlIjoKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgeWllbGQgcmV0CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgR2V0V29ybGRJbmZvKCkgewogICAgICAgICAgICBpZiAodGhpcy5fd29ybGRJbmZvICYmIHRoaXMuSXNJbnN0YW5jZVZhbGlkKCkpIHJldHVybiB0aGlzLl93b3JsZEluZm87CiAgICAgICAgICAgIGNvbnN0IGluc3RhbmNlID0gdGhpcy5HZXRJbnN0YW5jZSgpOwogICAgICAgICAgICBpZiAoaW5zdGFuY2UpIHRoaXMuX3dvcmxkSW5mbyA9IGluc3RhbmNlLkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICByZXR1cm4gdGhpcy5fd29ybGRJbmZvCiAgICAgICAgfQogICAgICAgIEdldFRyYWNrRGF0YUl0ZW0oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl90cmFja0RhdGFJdGVtCiAgICAgICAgfQogICAgICAgIEdldEluc3RhbmNlVUlEKCkgewogICAgICAgICAgICBpZiAodGhpcy5faW5zdGFuY2VVaWQpIHJldHVybiB0aGlzLl9pbnN0YW5jZVVpZDsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RyYWNrRGF0YUl0ZW0uR2V0SW5zdGFuY2VVSUQoKQogICAgICAgIH0KICAgICAgICBTZXRJbnN0YW5jZVVJRCh1aWQpIHsKICAgICAgICAgICAgdGhpcy5fdHJhY2tEYXRhSXRlbS5TZXRJbnN0YW5jZVVJRCh1aWQpCiAgICAgICAgfQogICAgICAgIEdldEludGVycG9sYXRpb25Nb2RlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fdHJhY2tEYXRhSXRlbS5HZXRJbnRlcnBvbGF0aW9uTW9kZSgpCiAgICAgICAgfQogICAgICAgIFNldEludGVycG9sYXRpb25Nb2RlKGltKSB7CiAgICAgICAgICAgIHRoaXMuX3RyYWNrRGF0YUl0ZW0uU2V0SW50ZXJwb2xhdGlvbk1vZGUoaW0pCiAgICAgICAgfQogICAgICAgIEdldFJlc3VsdE1vZGUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl90cmFja0RhdGFJdGVtLkdldFJlc3VsdE1vZGUoKQogICAgICAgIH0KICAgICAgICBHZXRJZCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RyYWNrRGF0YUl0ZW0uR2V0SWQoKQogICAgICAgIH0KICAgICAgICBHZXRTdGFydE9mZnNldCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RyYWNrRGF0YUl0ZW0uR2V0U3RhcnRPZmZzZXQoKQogICAgICAgIH0KICAgICAgICBHZXRMb2NhbFRvdGFsVGltZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RyYWNrRGF0YUl0ZW0uR2V0TG9jYWxUb3RhbFRpbWUoKQogICAgICAgIH0KICAgICAgICBTZXRMb2NhbFRvdGFsVGltZSh0KSB7CiAgICAgICAgICAgIHRoaXMuX3RyYWNrRGF0YUl0ZW0uU2V0TG9jYWxUb3RhbFRpbWUodCkKICAgICAgICB9CiAgICAgICAgU2V0UmVzdWx0TW9kZShybSkgewogICAgICAgICAgICB0aGlzLl90cmFja0RhdGFJdGVtLlNldFJlc3VsdE1vZGUocm0pCiAgICAgICAgfQogICAgICAgIFNldEVhc2UoZSkgewogICAgICAgICAgICBmb3IgKGNvbnN0IGtleWZyYW1lRGF0YUl0ZW0gb2YgdGhpcy5HZXRLZXlmcmFtZURhdGFJdGVtcygpKSBrZXlmcmFtZURhdGFJdGVtLlNldEVhc2UoZSk7CiAgICAgICAgICAgIGZvciAoY29uc3QgcHJvcGVydHlUcmFjayBvZiB0aGlzLkdldFByb3BlcnR5VHJhY2tzKCkpIHByb3BlcnR5VHJhY2suU2V0RWFzZShlKQogICAgICAgIH0KICAgICAgICBHZXRFbmFibGUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl90cmFja0RhdGFJdGVtLkdldEVuYWJsZSgpCiAgICAgICAgfQogICAgICAgIFNldEVuYWJsZShlKSB7CiAgICAgICAgICAgIHRoaXMuX3RyYWNrRGF0YUl0ZW0uU2V0RW5hYmxlKGUpCiAgICAgICAgfQogICAgICAgIEdldE9iamVjdENsYXNzSW5kZXgoKSB7CiAgICAgICAgICAgIGlmICghaXNOYU4odGhpcy5fb2JqZWN0Q2xhc3NJbmRleCkpIHJldHVybiB0aGlzLl9vYmplY3RDbGFzc0luZGV4OwogICAgICAgICAgICByZXR1cm4gdGhpcy5fdHJhY2tEYXRhSXRlbS5HZXRPYmplY3RDbGFzc0luZGV4KCkKICAgICAgICB9CiAgICAgICAgU2V0T2JqZWN0Q2xhc3NJbmRleChvYmplY3RDbGFzc0luZGV4KSB7CiAgICAgICAgICAgIHRoaXMuX3RyYWNrRGF0YUl0ZW0uU2V0T2JqZWN0Q2xhc3NJbmRleChvYmplY3RDbGFzc0luZGV4KQogICAgICAgIH0KICAgICAgICBTZXRPcmlnaW5hbFdpZHRoKHcpIHsKICAgICAgICAgICAgdGhpcy5fdHJhY2tEYXRhSXRlbS5TZXRPcmlnaW5hbFdpZHRoKHcpCiAgICAgICAgfQogICAgICAgIEdldE9yaWdpbmFsV2lkdGgoKSB7CiAgICAgICAgICAgIGNvbnN0IGluc3RhbmNlID0gdGhpcy5HZXRJbnN0YW5jZSgpOwogICAgICAgICAgICBpZiAoaW5zdGFuY2UpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHNka0ludGFuY2UgPSBpbnN0YW5jZS5HZXRTZGtJbnN0YW5jZSgpOwogICAgICAgICAgICAgICAgaWYgKHNka0ludGFuY2UuSXNPcmlnaW5hbFNpemVLbm93bigpKSByZXR1cm4gaW5zdGFuY2UuR2V0U2RrSW5zdGFuY2UoKS5HZXRPcmlnaW5hbFdpZHRoKCkKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdGhpcy5fdHJhY2tEYXRhSXRlbS5HZXRPcmlnaW5hbFdpZHRoKCkKICAgICAgICB9CiAgICAgICAgU2V0T3JpZ2luYWxIZWlnaHQoaCkgewogICAgICAgICAgICB0aGlzLl90cmFja0RhdGFJdGVtLlNldE9yaWdpbmFsSGVpZ2h0KGgpCiAgICAgICAgfQogICAgICAgIEdldE9yaWdpbmFsSGVpZ2h0KCkgewogICAgICAgICAgICBjb25zdCBpbnN0YW5jZSA9IHRoaXMuR2V0SW5zdGFuY2UoKTsKICAgICAgICAgICAgaWYgKGluc3RhbmNlKSB7CiAgICAgICAgICAgICAgICBjb25zdCBzZGtJbnRhbmNlID0gaW5zdGFuY2UuR2V0U2RrSW5zdGFuY2UoKTsKICAgICAgICAgICAgICAgIGlmIChzZGtJbnRhbmNlLklzT3JpZ2luYWxTaXplS25vd24oKSkgcmV0dXJuIGluc3RhbmNlLkdldFNka0luc3RhbmNlKCkuR2V0T3JpZ2luYWxIZWlnaHQoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0aGlzLl90cmFja0RhdGFJdGVtLkdldE9yaWdpbmFsSGVpZ2h0KCkKICAgICAgICB9CiAgICAgICAgR2V0VHlwZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RyYWNrRGF0YUl0ZW0uR2V0VHlwZSgpCiAgICAgICAgfQogICAgICAgIEdldE5hbWUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl90cmFja0RhdGFJdGVtLkdldE5hbWUoKQogICAgICAgIH0KICAgICAgICBJc0luc3RhbmNlVHJhY2soKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLkdldFR5cGUoKSA9PT0KICAgICAgICAgICAgICAgIElOU1RBTkNFX1RSQUNLCiAgICAgICAgfQogICAgICAgIElzVmFsdWVUcmFjaygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuR2V0VHlwZSgpID09PSBWQUxVRV9UUkFDSwogICAgICAgIH0KICAgICAgICBJc0F1ZGlvVHJhY2soKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLkdldFR5cGUoKSA9PT0gQVVESU9fVFJBQ0sKICAgICAgICB9CiAgICAgICAgR2V0V29ybGRJbmZvQ2hhbmdlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fd29ybGRJbmZvQ2hhbmdlCiAgICAgICAgfQogICAgICAgIEdldFJlbmRlckNoYW5nZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3JlbmRlckNoYW5nZQogICAgICAgIH0KICAgICAgICBHZXROZWVkc0JlZm9yZUFuZEFmdGVyKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fbmVlZHNCZWZvcmVBbmRBZnRlcgogICAgICAgIH0KICAgICAgICBJc05lc3RlZCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2lzTmVzdGVkCiAgICAgICAgfQogICAgICAgIFNldFJlc2V0U3RhdGUoKSB7CiAgICAgICAgICAgIGZvciAoY29uc3QgcHJvcGVydHlUcmFjayBvZiB0aGlzLl9wcm9wZXJ0eVRyYWNrcykgcHJvcGVydHlUcmFjay5TZXRSZXNldFN0YXRlKCkKICAgICAgICB9CiAgICAgICAgU2V0SW5pdGlhbFN0YXRlKCkgewogICAgICAgICAgICB0aGlzLk1heWJlR2V0SW5zdGFuY2UoKTsKICAgICAgICAgICAgaWYgKCF0aGlzLklzSW5zdGFuY2VWYWxpZCgpICYmIHRoaXMuSXNJbnN0YW5jZVRyYWNrKCkpIHJldHVybjsKICAgICAgICAgICAgY29uc3QgdGltZWxpbmUgPQogICAgICAgICAgICAgICAgdGhpcy5HZXRUaW1lbGluZSgpOwogICAgICAgICAgICBjb25zdCBpc0ZvcndhcmRQbGF5QmFjayA9IHRpbWVsaW5lLklzRm9yd2FyZFBsYXlCYWNrKCk7CiAgICAgICAgICAgIGNvbnN0IHRpbWUgPSBpc0ZvcndhcmRQbGF5QmFjayA/IDAgOiB0aGlzLkdldExvY2FsVG90YWxUaW1lKCk7CiAgICAgICAgICAgIGZvciAoY29uc3QgcHJvcGVydHlUcmFjayBvZiB0aGlzLl9wcm9wZXJ0eVRyYWNrcykgewogICAgICAgICAgICAgICAgcHJvcGVydHlUcmFjay5TZXRJbml0aWFsU3RhdGUodGltZSk7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fd29ybGRJbmZvQ2hhbmdlID09PSAwICYmIHByb3BlcnR5VHJhY2suR2V0V29ybGRJbmZvQ2hhbmdlKCkgPT09IDEpIHRoaXMuX3dvcmxkSW5mb0NoYW5nZSA9IDE7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fcmVuZGVyQ2hhbmdlID09PSAwICYmIHByb3BlcnR5VHJhY2suR2V0UmVuZGVyQ2hhbmdlKCkgPT09IDEpIHRoaXMuX3JlbmRlckNoYW5nZSA9IDEKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLl9uZWVkc0JlZm9yZUFuZEFmdGVyID0gMDsKICAgICAgICAgICAgY29uc3QgbmJhID0gdGhpcy5fcHJvcGVydHlUcmFja3Muc29tZShwdCA9PiBwdC5HZXROZWVkc0JlZm9yZUFuZEFmdGVyKCkpOwogICAgICAgICAgICBpZiAobmJhKSB0aGlzLl9uZWVkc0JlZm9yZUFuZEFmdGVyID0KICAgICAgICAgICAgICAgIDE7CiAgICAgICAgICAgIHRoaXMuX2xhc3RLZXlmcmFtZURhdGFJdGVtID0gdGhpcy5fR2V0TGFzdEtleUZyYW1lQmVmb3JlVGltZSh0aW1lKTsKICAgICAgICAgICAgdGhpcy5faW5pdGlhbFN0YXRlT2ZOZXN0ZWRTZXQgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5fZW5kU3RhdGVPZk5lc3RlZFNldCA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLkludGVycG9sYXRlKHRpbWUpOwogICAgICAgICAgICB0aGlzLk9uS2V5ZnJhbWVSZWFjaGVkKHRoaXMuX0dldExhc3RLZXlGcmFtZUJlZm9yZVRpbWUodGltZSkpCiAgICAgICAgfQogICAgICAgIFNldFJlc3VtZVN0YXRlKCkgewogICAgICAgICAgICB0aGlzLk1heWJlR2V0SW5zdGFuY2UoKTsKICAgICAgICAgICAgaWYgKCF0aGlzLklzSW5zdGFuY2VWYWxpZCgpICYmIHRoaXMuSXNJbnN0YW5jZVRyYWNrKCkpIHJldHVybjsKICAgICAgICAgICAgY29uc3QgcGxheWJhY2tEaXJlY3Rpb24gPSB0aGlzLl90aW1lbGluZS5Jc0ZvcndhcmRQbGF5QmFjaygpOwogICAgICAgICAgICBjb25zdCB0aW1lID0gdGhpcy5fdGltZWxpbmUuR2V0VGltZSgpIC0gdGhpcy5HZXRTdGFydE9mZnNldCgpOwogICAgICAgICAgICB0aGlzLl9sYXN0S2V5ZnJhbWVEYXRhSXRlbSA9IHRoaXMuX0dldExhc3RLZXlGcmFtZUJlZm9yZVRpbWUodGltZSk7CiAgICAgICAgICAgIGZvciAoY29uc3QgcHJvcGVydHlUcmFjayBvZiB0aGlzLl9wcm9wZXJ0eVRyYWNrcykgcHJvcGVydHlUcmFjay5TZXRSZXN1bWVTdGF0ZSh0aW1lKQogICAgICAgIH0KICAgICAgICBTZXRFbmRTdGF0ZSgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuR2V0VGltZWxpbmUoKS5Jc0NvbXBsZXRlKCkpIHJldHVybjsKICAgICAgICAgICAgdGhpcy5NYXliZUdldEluc3RhbmNlKCk7CiAgICAgICAgICAgIGlmICghdGhpcy5Jc0luc3RhbmNlVmFsaWQoKSAmJiB0aGlzLklzSW5zdGFuY2VUcmFjaygpKSByZXR1cm47CiAgICAgICAgICAgIGlmICghdGhpcy5faXNOZXN0ZWQpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHRpbWUgPSB0aGlzLl90aW1lbGluZS5HZXRUaW1lKCk7CiAgICAgICAgICAgICAgICBjb25zdCB0b3RhbFRpbWUgPSB0aGlzLkdldFN0YXJ0T2Zmc2V0KCkgKyB0aGlzLkdldExvY2FsVG90YWxUaW1lKCk7CiAgICAgICAgICAgICAgICBpZiAodGltZSA+PSB0b3RhbFRpbWUpIHRoaXMuSW50ZXJwb2xhdGUodGhpcy5HZXRMb2NhbFRvdGFsVGltZSgpLCB0cnVlLCBmYWxzZSwgdHJ1ZSwgZmFsc2UsIGZhbHNlLCB0cnVlKTsKICAgICAgICAgICAgICAgIGVsc2UgaWYgKHRpbWUgPD0gMCkgdGhpcy5JbnRlcnBvbGF0ZSgwLCB0cnVlLCBmYWxzZSwgdHJ1ZSwgZmFsc2UsIGZhbHNlLCB0cnVlKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIF9TZXRVcGRhdGVTdGF0ZSgpIHsKICAgICAgICAgICAgZm9yIChsZXQgaSA9CiAgICAgICAgICAgICAgICAgICAgMCwgbCA9IHRoaXMuX3Byb3BlcnR5VHJhY2tzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgICAgICAgICAgY29uc3QgcHJvcGVydHlUcmFjayA9IHRoaXMuX3Byb3BlcnR5VHJhY2tzW2ldOwogICAgICAgICAgICAgICAgcHJvcGVydHlUcmFjay5fU2V0VXBkYXRlU3RhdGUoKTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl93b3JsZEluZm9DaGFuZ2UgPT09IDAgJiYgcHJvcGVydHlUcmFjay5HZXRXb3JsZEluZm9DaGFuZ2UoKSA9PT0gMSkgdGhpcy5fd29ybGRJbmZvQ2hhbmdlID0gMTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9yZW5kZXJDaGFuZ2UgPT09IDAgJiYgcHJvcGVydHlUcmFjay5HZXRSZW5kZXJDaGFuZ2UoKSA9PT0gMSkgdGhpcy5fcmVuZGVyQ2hhbmdlID0gMQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIEJlZm9yZUludGVycG9sYXRlKCkgewogICAgICAgICAgICBjb25zdCBsID0gdGhpcy5fcHJvcGVydHlUcmFja3MubGVuZ3RoOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGw7IGkrKykgdGhpcy5fcHJvcGVydHlUcmFja3NbaV0uQmVmb3JlSW50ZXJwb2xhdGUoKQogICAgICAgIH0KICAgICAgICBJbnRlcnBvbGF0ZSh0aW1lLCBpc1RpY2tpbmcgPSBmYWxzZSwgc2V0VGltZSA9IGZhbHNlLCBlbnN1cmVWYWx1ZSA9IGZhbHNlLCBmaXJzdFRpY2sgPSBmYWxzZSwgaWdub3JlR2xvYmFscyA9CiAgICAgICAgICAgIGZhbHNlLCBlbmRTdGF0ZSA9IGZhbHNlKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5faW5zdGFuY2UpIHRoaXMuR2V0SW5zdGFuY2UoKTsKICAgICAgICAgICAgY29uc3QgaW5zdGFuY2VWYWxpZCA9IHRoaXMuX2luc3RhbmNlICYmICF0aGlzLl9pbnN0YW5jZS5Jc0Rlc3Ryb3llZCgpOwogICAgICAgICAgICBjb25zdCBpc0luc3RhbmNlVHJhY2sgPSB0aGlzLl90cmFja0RhdGFJdGVtLl90eXBlID09PSBJTlNUQU5DRV9UUkFDSzsKICAgICAgICAgICAgaWYgKCFpbnN0YW5jZVZhbGlkICYmIGlzSW5zdGFuY2VUcmFjaykgcmV0dXJuOwogICAgICAgICAgICBpZiAoaWdub3JlR2xvYmFscyAmJiBpc0luc3RhbmNlVHJhY2sgJiYgdGhpcy5HZXRPYmplY3RDbGFzcygpLklzR2xvYmFsKCkpIHJldHVybjsKICAgICAgICAgICAgdGltZSA9IHRpbWUgLSB0aGlzLkdldFN0YXJ0T2Zmc2V0KCk7CiAgICAgICAgICAgIGlmICh0aW1lIDwgMCkgcmV0dXJuOwogICAgICAgICAgICB0aGlzLk1heWJlU2V0SW5pdGlhbFN0YXRlT2ZOZXN0ZWRUcmFjayh0aW1lLCBpc1RpY2tpbmcpOwogICAgICAgICAgICB0aGlzLk1heWJlVHJpZ2dlcktleWZyYW1lUmVhY2hlZENvbmRpdGlvbnModGltZSwgaXNUaWNraW5nLCBmaXJzdFRpY2spOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IHRoaXMuX3Byb3BlcnR5VHJhY2tzLmxlbmd0aDsgaSA8CiAgICAgICAgICAgICAgICBsOyBpKyspIHRoaXMuX3Byb3BlcnR5VHJhY2tzW2ldLkludGVycG9sYXRlKHRpbWUsIHNldFRpbWUsIGVuc3VyZVZhbHVlLCBlbmRTdGF0ZSk7CiAgICAgICAgICAgIHRoaXMuTWF5YmVTZXRFbmRTdGF0ZU9mTmVzdGVkVHJhY2sodGltZSwgaXNUaWNraW5nKTsKICAgICAgICAgICAgaWYgKHRoaXMuX3dvcmxkSW5mb0NoYW5nZSAhPT0gMCkgewogICAgICAgICAgICAgICAgaWYgKCF0aGlzLl93b3JsZEluZm8pIHRoaXMuX3dvcmxkSW5mbyA9IHRoaXMuX2luc3RhbmNlLkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuX3dvcmxkSW5mbykgdGhpcy5fd29ybGRJbmZvLlNldEJib3hDaGFuZ2VkKCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBBZnRlckludGVycG9sYXRlKCkgewogICAgICAgICAgICBjb25zdCBsID0gdGhpcy5fcHJvcGVydHlUcmFja3MubGVuZ3RoOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGw7IGkrKykgdGhpcy5fcHJvcGVydHlUcmFja3NbaV0uQWZ0ZXJJbnRlcnBvbGF0ZSgpCiAgICAgICAgfQogICAgICAgIE1heWJlU2V0SW5pdGlhbFN0YXRlT2ZOZXN0ZWRUcmFjayh0aW1lLCBpc1RpY2tpbmcpIHsKICAgICAgICAgICAgaWYgKCFpc1RpY2tpbmcpIHJldHVybjsKICAgICAgICAgICAgaWYgKCF0aGlzLl9pc05lc3RlZCkgcmV0dXJuOwogICAgICAgICAgICBpZiAodGhpcy5faW5pdGlhbFN0YXRlT2ZOZXN0ZWRTZXQpIHJldHVybjsKICAgICAgICAgICAgY29uc3QgdGltZWxpbmUgPSB0aGlzLkdldFRpbWVsaW5lKCk7CiAgICAgICAgICAgIGlmICh0aW1lbGluZS5Jc0ZvcndhcmRQbGF5QmFjaygpKSB7CiAgICAgICAgICAgICAgICBpZiAodGltZSA8IDApIHJldHVybjsKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgcHJvcGVydHlUcmFjayBvZiB0aGlzLl9wcm9wZXJ0eVRyYWNrcykgcHJvcGVydHlUcmFjay5JbnRlcnBvbGF0ZSgwLCBmYWxzZSwgdHJ1ZSkKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlmICh0aW1lID4gdGhpcy5HZXRMb2NhbFRvdGFsVGltZSgpKSByZXR1cm47CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHByb3BlcnR5VHJhY2sgb2YgdGhpcy5fcHJvcGVydHlUcmFja3MpIHByb3BlcnR5VHJhY2suSW50ZXJwb2xhdGUodGhpcy5HZXRMb2NhbFRvdGFsVGltZSgpLCBmYWxzZSwgdHJ1ZSkKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IgKGNvbnN0IHByb3BlcnR5VHJhY2sgb2YgdGhpcy5fcHJvcGVydHlUcmFja3MpIHByb3BlcnR5VHJhY2suU2V0SW5pdGlhbFN0YXRlKCk7CiAgICAgICAgICAgIHRoaXMuX2luaXRpYWxTdGF0ZU9mTmVzdGVkU2V0ID0gdHJ1ZQogICAgICAgIH0KICAgICAgICBNYXliZVNldEVuZFN0YXRlT2ZOZXN0ZWRUcmFjayh0aW1lLCBpc1RpY2tpbmcpIHsKICAgICAgICAgICAgaWYgKCFpc1RpY2tpbmcpIHJldHVybjsKICAgICAgICAgICAgaWYgKCF0aGlzLl9pc05lc3RlZCkgcmV0dXJuOwogICAgICAgICAgICBpZiAodGhpcy5fZW5kU3RhdGVPZk5lc3RlZFNldCkgcmV0dXJuOwogICAgICAgICAgICBjb25zdCB0aW1lbGluZSA9IHRoaXMuR2V0VGltZWxpbmUoKTsKICAgICAgICAgICAgaWYgKHRpbWVsaW5lLklzRm9yd2FyZFBsYXlCYWNrKCkpIHsKICAgICAgICAgICAgICAgIGlmICh0aW1lID49IHRoaXMuR2V0TG9jYWxUb3RhbFRpbWUoKSkgewogICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgcHJvcGVydHlUcmFjayBvZiB0aGlzLl9wcm9wZXJ0eVRyYWNrcykgcHJvcGVydHlUcmFjay5JbnRlcnBvbGF0ZSh0aGlzLkdldExvY2FsVG90YWxUaW1lKCksIGZhbHNlLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9lbmRTdGF0ZU9mTmVzdGVkU2V0ID0gdHJ1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKHRpbWUgPD0gMCkgewogICAgICAgICAgICAgICAgZm9yIChjb25zdCBwcm9wZXJ0eVRyYWNrIG9mIHRoaXMuX3Byb3BlcnR5VHJhY2tzKSBwcm9wZXJ0eVRyYWNrLkludGVycG9sYXRlKDAsIGZhbHNlLCB0cnVlKTsKICAgICAgICAgICAgICAgIHRoaXMuX2VuZFN0YXRlT2ZOZXN0ZWRTZXQgPSB0cnVlCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgTWF5YmVUcmlnZ2VyS2V5ZnJhbWVSZWFjaGVkQ29uZGl0aW9ucyh0aW1lLCBpc1RpY2tpbmcsIGZpcnN0VGljaykgewogICAgICAgICAgICBpZiAoZmlyc3RUaWNrKSByZXR1cm47CiAgICAgICAgICAgIGlmICghaXNUaWNraW5nKSByZXR1cm47CiAgICAgICAgICAgIGlmICghQzMuUGx1Z2lucy5UaW1lbGluZSkgcmV0dXJuOwogICAgICAgICAgICBjb25zdCB0aW1lbGluZSA9IHRoaXMuR2V0VGltZWxpbmUoKTsKICAgICAgICAgICAgY29uc3QgbmV4dEtleWZyYW1lID0gdGhpcy5fbGFzdEtleWZyYW1lRGF0YUl0ZW0uR2V0TmV4dCgpOwogICAgICAgICAgICBjb25zdCBsYXN0VGltZSA9IHRoaXMuX2xhc3RLZXlmcmFtZURhdGFJdGVtLkdldFRpbWUoKTsKICAgICAgICAgICAgY29uc3QgbmV4dFRpbWUgPSBuZXh0S2V5ZnJhbWUgPyBuZXh0S2V5ZnJhbWUuR2V0VGltZSgpIDogdGltZWxpbmUuR2V0VG90YWxUaW1lKCk7CiAgICAgICAgICAgIGlmICh0aW1lIDw9IGxhc3RUaW1lIHx8IHRpbWUgPj0gbmV4dFRpbWUpIHsKICAgICAgICAgICAgICAgIHRoaXMuX2xhc3RLZXlmcmFtZURhdGFJdGVtID0gdGhpcy5fdHJhY2tEYXRhLkdldEZpcnN0S2V5RnJhbWVEYXRhSXRlbUxvd2VyT3JFcXVhbFRoYW4odGltZSwgdGhpcy5fdHJhY2tEYXRhSXRlbSk7CiAgICAgICAgICAgICAgICBpZiAodGltZWxpbmUuSXNGb3J3YXJkUGxheUJhY2soKSkgewogICAgICAgICAgICAgICAgICAgIGlmIChuZXh0S2V5ZnJhbWUpIHRoaXMuT25LZXlmcmFtZVJlYWNoZWQodGhpcy5fbGFzdEtleWZyYW1lRGF0YUl0ZW0pCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IG5leHRLZXlmcmFtZSA9CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2xhc3RLZXlmcmFtZURhdGFJdGVtLkdldE5leHQoKTsKICAgICAgICAgICAgICAgICAgICBpZiAobmV4dEtleWZyYW1lKSB0aGlzLk9uS2V5ZnJhbWVSZWFjaGVkKG5leHRLZXlmcmFtZSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBfR2V0TGFzdEtleUZyYW1lQmVmb3JlVGltZSh0aW1lKSB7CiAgICAgICAgICAgIGNvbnN0IGtleWZyYW1lRGF0YUl0ZW0gPSB0aGlzLl90cmFja0RhdGEuR2V0S2V5RnJhbWVEYXRhSXRlbUF0VGltZSh0aW1lLCB0aGlzLl90cmFja0RhdGFJdGVtKTsKICAgICAgICAgICAgaWYgKGtleWZyYW1lRGF0YUl0ZW0pIHJldHVybiBrZXlmcmFtZURhdGFJdGVtOwogICAgICAgICAgICBlbHNlIHJldHVybiB0aGlzLl90cmFja0RhdGEuR2V0Rmlyc3RLZXlGcmFtZURhdGFJdGVtTG93ZXJPckVxdWFsVGhhbih0aW1lLCB0aGlzLl90cmFja0RhdGFJdGVtKQogICAgICAgIH0KICAgICAgICBPbktleWZyYW1lUmVhY2hlZChrZXlmcmFtZURhdGFJdGVtKSB7CiAgICAgICAgICAgIGNvbnN0IHRpbWVsaW5lID0gdGhpcy5HZXRUaW1lbGluZSgpOwogICAgICAgICAgICBjb25zdCB0aW1lbGluZU1hbmFnZXIgPSB0aW1lbGluZS5HZXRUaW1lbGluZU1hbmFnZXIoKTsKICAgICAgICAgICAgQzMuUGx1Z2lucy5UaW1lbGluZS5DbmRzLlB1c2hUcmlnZ2VyVGltZWxpbmUodGltZWxpbmUpOwogICAgICAgICAgICBDMy5QbHVnaW5zLlRpbWVsaW5lLkNuZHMuUHVzaFRyaWdnZXJLZXlmcmFtZShrZXlmcmFtZURhdGFJdGVtKTsKICAgICAgICAgICAgdGltZWxpbmVNYW5hZ2VyLlRyaWdnZXIoQzMuUGx1Z2lucy5UaW1lbGluZS5DbmRzLk9uQW55S2V5ZnJhbWVSZWFjaGVkKTsKICAgICAgICAgICAgdGltZWxpbmVNYW5hZ2VyLlRyaWdnZXIoQzMuUGx1Z2lucy5UaW1lbGluZS5DbmRzLk9uS2V5ZnJhbWVSZWFjaGVkKTsKICAgICAgICAgICAgQzMuUGx1Z2lucy5UaW1lbGluZS5DbmRzLlBvcFRyaWdnZXJUaW1lbGluZSh0aW1lbGluZSk7CiAgICAgICAgICAgIEMzLlBsdWdpbnMuVGltZWxpbmUuQ25kcy5Qb3BUcmlnZ2VyS2V5ZnJhbWUoa2V5ZnJhbWVEYXRhSXRlbSkKICAgICAgICB9CiAgICAgICAgQWRkS2V5ZnJhbWUoKSB7CiAgICAgICAgICAgIGNvbnN0IGtleWZyYW1lRGF0YSA9IHRoaXMuX3RyYWNrRGF0YUl0ZW0uR2V0S2V5ZnJhbWVEYXRhKCk7CiAgICAgICAgICAgIGNvbnN0IGtleWZyYW1lRGF0YUl0ZW0gPSBrZXlmcmFtZURhdGEuQWRkRW1wdHlLZXlmcmFtZURhdGFJdGVtKCk7CiAgICAgICAgICAgIHJldHVybiBrZXlmcmFtZURhdGFJdGVtCiAgICAgICAgfQogICAgICAgIEFkZFByb3BlcnR5VHJhY2soKSB7CiAgICAgICAgICAgIGNvbnN0IHByb3BlcnR5VHJhY2tEYXRhID0KICAgICAgICAgICAgICAgIHRoaXMuX3RyYWNrRGF0YUl0ZW0uR2V0UHJvcGVydHlUcmFja0RhdGEoKTsKICAgICAgICAgICAgY29uc3QgcHJvcGVydHlUcmFja0RhdGFJdGVtID0gcHJvcGVydHlUcmFja0RhdGEuQWRkRW1wdHlQcm9wZXJ0eVRyYWNrRGF0YUl0ZW0oKTsKICAgICAgICAgICAgY29uc3QgcHJvcGVydHlUcmFjayA9IEMzLlByb3BlcnR5VHJhY2tTdGF0ZS5DcmVhdGUodGhpcywgcHJvcGVydHlUcmFja0RhdGFJdGVtKTsKICAgICAgICAgICAgdGhpcy5fcHJvcGVydHlUcmFja3MucHVzaChwcm9wZXJ0eVRyYWNrKTsKICAgICAgICAgICAgcmV0dXJuIHByb3BlcnR5VHJhY2sKICAgICAgICB9CiAgICAgICAgRGVsZXRlS2V5ZnJhbWVzKG1hdGNoKSB7CiAgICAgICAgICAgIGNvbnN0IGtleWZyYW1lRGF0YSA9IHRoaXMuX3RyYWNrRGF0YUl0ZW0uR2V0S2V5ZnJhbWVEYXRhKCk7CiAgICAgICAgICAgIGtleWZyYW1lRGF0YS5EZWxldGVLZXlmcmFtZURhdGFJdGVtcyhtYXRjaCkKICAgICAgICB9CiAgICAgICAgRGVsZXRlUHJvcGVydHlLZXlmcmFtZXMobWF0Y2gpIHsKICAgICAgICAgICAgZm9yIChjb25zdCBwcm9wZXJ0eVRyYWNrIG9mIHRoaXMuX3Byb3BlcnR5VHJhY2tzKSBwcm9wZXJ0eVRyYWNrLkRlbGV0ZVByb3BlcnR5S2V5ZnJhbWVzKG1hdGNoKQogICAgICAgIH0KICAgICAgICBTYXZlU3RhdGUoKSB7CiAgICAgICAgICAgIGZvciAoY29uc3QgcHJvcGVydHlUcmFjayBvZiB0aGlzLl9wcm9wZXJ0eVRyYWNrcykgcHJvcGVydHlUcmFjay5TYXZlU3RhdGUoKQogICAgICAgIH0KICAgICAgICBDb21wYXJlSW5pdGlhbFN0YXRlV2l0aEN1cnJlbnQoKSB7CiAgICAgICAgICAgIHRoaXMuTWF5YmVHZXRJbnN0YW5jZSgpOwogICAgICAgICAgICBpZiAoIXRoaXMuSXNJbnN0YW5jZVZhbGlkKCkgJiYgdGhpcy5Jc0luc3RhbmNlVHJhY2soKSkgcmV0dXJuOwogICAgICAgICAgICBmb3IgKGNvbnN0IHByb3BlcnR5VHJhY2sgb2YgdGhpcy5fcHJvcGVydHlUcmFja3MpIHByb3BlcnR5VHJhY2suQ29tcGFyZUluaXRpYWxTdGF0ZVdpdGhDdXJyZW50KCkKICAgICAgICB9CiAgICAgICAgQ29tcGFyZVNhdmVTdGF0ZVdpdGhDdXJyZW50KCkgewogICAgICAgICAgICB0aGlzLk1heWJlR2V0SW5zdGFuY2UoKTsKICAgICAgICAgICAgaWYgKCF0aGlzLklzSW5zdGFuY2VWYWxpZCgpICYmIHRoaXMuSXNJbnN0YW5jZVRyYWNrKCkpIHJldHVybjsKICAgICAgICAgICAgbGV0IGRpZmZlcmVuY2UgPSBmYWxzZTsKICAgICAgICAgICAgZm9yIChjb25zdCBwcm9wZXJ0eVRyYWNrIG9mIHRoaXMuX3Byb3BlcnR5VHJhY2tzKSB7CiAgICAgICAgICAgICAgICBjb25zdCBkaWZmID0gcHJvcGVydHlUcmFjay5Db21wYXJlU2F2ZVN0YXRlV2l0aEN1cnJlbnQoKTsKICAgICAgICAgICAgICAgIGlmICghZGlmZmVyZW5jZSAmJiBkaWZmKSBkaWZmZXJlbmNlID0gdHJ1ZQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChkaWZmZXJlbmNlKSB7CiAgICAgICAgICAgICAgICBjb25zdCBrZXlmcmFtZURhdGFJdGVtID0gdGhpcy5BZGRLZXlmcmFtZSgpOwogICAgICAgICAgICAgICAga2V5ZnJhbWVEYXRhSXRlbS5TZXRUaW1lKHRoaXMuR2V0VGltZWxpbmUoKS5HZXRUaW1lKCkpOwogICAgICAgICAgICAgICAga2V5ZnJhbWVEYXRhSXRlbS5TZXRFYXNlKCJub2Vhc2UiKTsKICAgICAgICAgICAgICAgIGtleWZyYW1lRGF0YUl0ZW0uU2V0RW5hYmxlKHRydWUpOwogICAgICAgICAgICAgICAga2V5ZnJhbWVEYXRhSXRlbS5TZXRUYWdzKCIiKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIF9TYXZlVG9Kc29uKCkgewogICAgICAgICAgICBjb25zdCBpbnN0YW5jZSA9IHRoaXMuR2V0SW5zdGFuY2UoKTsKICAgICAgICAgICAgY29uc3QgdWlkID0gaW5zdGFuY2UgPyBpbnN0YW5jZS5HZXRVSUQoKSA6IHRoaXMuR2V0SW5zdGFuY2VVSUQoKTsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICJwcm9wZXJ0eVRyYWNrc0pzb24iOiB0aGlzLl9TYXZlUHJvcGVydHlUcmFja3NUb0pzb24oKSwKICAgICAgICAgICAgICAgICJsYXN0S2V5ZnJhbWVEYXRhSXRlbUpzb24iOiB0aGlzLl9TYXZlTGFzdEtleWZyYW1lRGF0YUl0ZW1Ub0pzb24oKSwKICAgICAgICAgICAgICAgICJpbml0aWFsU3RhdGVPZk5lc3RlZFNldCI6IHRoaXMuX2luaXRpYWxTdGF0ZU9mTmVzdGVkU2V0LAogICAgICAgICAgICAgICAgImVuZFN0YXRlT2ZOZXN0ZWRTZXQiOiB0aGlzLl9lbmRTdGF0ZU9mTmVzdGVkU2V0LAogICAgICAgICAgICAgICAgImluc3RhbmNlVWlkIjogdWlkCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgX0xvYWRGcm9tSnNvbihvKSB7CiAgICAgICAgICAgIGlmICghbykgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl9Mb2FkUHJvcGVydHlUcmFja3NGcm9tSnNvbihvWyJwcm9wZXJ0eVRyYWNrc0pzb24iXSk7CiAgICAgICAgICAgIHRoaXMuX0xvYWRMYXN0S2V5ZnJhbWVEYXRhSXRlbUZyb21Kc29uKG9bImxhc3RLZXlmcmFtZURhdGFJdGVtSnNvbiJdKTsKICAgICAgICAgICAgdGhpcy5fTG9hZEluc3RhbmNlRnJvbUpzb24ob1siaW5zdGFuY2VVaWQiXSk7CiAgICAgICAgICAgIHRoaXMuX2luaXRpYWxTdGF0ZU9mTmVzdGVkU2V0ID0gZmFsc2U7CiAgICAgICAgICAgIGlmIChvLmhhc093blByb3BlcnR5WyJpbml0aWFsU3RhdGVPZk5lc3RlZFNldCJdKSB0aGlzLl9pbml0aWFsU3RhdGVPZk5lc3RlZFNldCA9IG9bImluaXRpYWxTdGF0ZU9mTmVzdGVkU2V0Il07CiAgICAgICAgICAgIHRoaXMuX2VuZFN0YXRlT2ZOZXN0ZWRTZXQgPSBmYWxzZTsKICAgICAgICAgICAgaWYgKG8uaGFzT3duUHJvcGVydHlbImVuZFN0YXRlT2ZOZXN0ZWRTZXQiXSkgdGhpcy5fZW5kU3RhdGVPZk5lc3RlZFNldCA9IG9bImVuZFN0YXRlT2ZOZXN0ZWRTZXQiXTsKICAgICAgICAgICAgZm9yIChjb25zdCBwcm9wZXJ0eVRyYWNrIG9mIHRoaXMuX3Byb3BlcnR5VHJhY2tzKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fd29ybGRJbmZvQ2hhbmdlID09PSAwICYmIHByb3BlcnR5VHJhY2suR2V0V29ybGRJbmZvQ2hhbmdlKCkgPT09IDEpIHRoaXMuX3dvcmxkSW5mb0NoYW5nZSA9CiAgICAgICAgICAgICAgICAgICAgMTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9yZW5kZXJDaGFuZ2UgPT09IDAgJiYgcHJvcGVydHlUcmFjay5HZXRSZW5kZXJDaGFuZ2UoKSA9PT0gMSkgdGhpcy5fcmVuZGVyQ2hhbmdlID0gMQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuX25lZWRzQmVmb3JlQW5kQWZ0ZXIgPSAwOwogICAgICAgICAgICBpZiAodGhpcy5fcHJvcGVydHlUcmFja3Muc29tZShwdCA9PiBwdC5HZXROZWVkc0JlZm9yZUFuZEFmdGVyKCkpKSB0aGlzLl9uZWVkc0JlZm9yZUFuZEFmdGVyID0gMQogICAgICAgIH0KICAgICAgICBfU2F2ZUxhc3RLZXlmcmFtZURhdGFJdGVtVG9Kc29uKCkgewogICAgICAgICAgICBjb25zdCBrZXlmcmFtZURhdGEgPSB0aGlzLl90cmFja0RhdGFJdGVtLkdldEtleWZyYW1lRGF0YSgpOwogICAgICAgICAgICByZXR1cm4ga2V5ZnJhbWVEYXRhLkdldEtleWZyYW1lRGF0YUl0ZW1JbmRleCh0aGlzLl9sYXN0S2V5ZnJhbWVEYXRhSXRlbSkKICAgICAgICB9CiAgICAgICAgX1NhdmVQcm9wZXJ0eVRyYWNrc1RvSnNvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3Byb3BlcnR5VHJhY2tzLm1hcChwcm9wZXJ0eVRyYWNrU3RhdGUgPT4gcHJvcGVydHlUcmFja1N0YXRlLl9TYXZlVG9Kc29uKCkpCiAgICAgICAgfQogICAgICAgIF9Mb2FkUHJvcGVydHlUcmFja3NGcm9tSnNvbihwcm9wZXJ0eVRyYWNrc0pzb24pIHsKICAgICAgICAgICAgcHJvcGVydHlUcmFja3NKc29uLmZvckVhY2goKHByb3BlcnR5VHJhY2tKc29uLAogICAgICAgICAgICAgICAgaSkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgcHJvcGVydHlUcmFjayA9IHRoaXMuX3Byb3BlcnR5VHJhY2tzW2ldOwogICAgICAgICAgICAgICAgcHJvcGVydHlUcmFjay5fTG9hZEZyb21Kc29uKHByb3BlcnR5VHJhY2tKc29uKQogICAgICAgICAgICB9KQogICAgICAgIH0KICAgICAgICBfTG9hZEluc3RhbmNlRnJvbUpzb24odWlkKSB7CiAgICAgICAgICAgIGlmICghQzMuSXNGaW5pdGVOdW1iZXIodWlkKSkgcmV0dXJuOwogICAgICAgICAgICBjb25zdCBpbnN0YW5jZSA9IHRoaXMuR2V0UnVudGltZSgpLkdldEluc3RhbmNlQnlVSUQodWlkKTsKICAgICAgICAgICAgaWYgKCFpbnN0YW5jZSkgcmV0dXJuOwogICAgICAgICAgICBjb25zdCB0aW1lbGluZSA9IHRoaXMuR2V0VGltZWxpbmUoKTsKICAgICAgICAgICAgdGltZWxpbmUuU2V0VHJhY2tJbnN0YW5jZSh0aGlzLl90cmFja0RhdGFJdGVtLkdldElkKCksIGluc3RhbmNlKQogICAgICAgIH0KICAgICAgICBfTG9hZExhc3RLZXlmcmFtZURhdGFJdGVtRnJvbUpzb24obGFzdEtleWZyYW1lRGF0YUl0ZW1JbmRleCkgewogICAgICAgICAgICBjb25zdCBrZXlmcmFtZURhdGEgPSB0aGlzLl90cmFja0RhdGFJdGVtLkdldEtleWZyYW1lRGF0YSgpOwogICAgICAgICAgICB0aGlzLl9sYXN0S2V5ZnJhbWVEYXRhSXRlbSA9IGtleWZyYW1lRGF0YS5HZXRLZXlmcmFtZURhdGFJdGVtRnJvbUluZGV4KGxhc3RLZXlmcmFtZURhdGFJdGVtSW5kZXgpCiAgICAgICAgfQogICAgfTsKCn0KCi8vIHRpbWVsaW5lcy9zdGF0ZS9wcm9wZXJ0eVRyYWNrU3RhdGUuanMKewogICAgJ3VzZSBzdHJpY3QnOwogICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgQzMuUHJvcGVydHlUcmFja1N0YXRlID0gY2xhc3MgUHJvcGVydHlUcmFjayBleHRlbmRzIEMzLkRlZmVuZGVkQmFzZSB7CiAgICAgICAgY29uc3RydWN0b3IodHJhY2ssIHByb3BlcnR5VHJhY2tEYXRhSXRlbSkgewogICAgICAgICAgICBzdXBlcigpOwogICAgICAgICAgICB0aGlzLl90cmFjayA9IHRyYWNrOwogICAgICAgICAgICB0aGlzLl9wcm9wZXJ0eVRyYWNrRGF0YUl0ZW0gPSBwcm9wZXJ0eVRyYWNrRGF0YUl0ZW07CiAgICAgICAgICAgIHRoaXMuX3Byb3BlcnR5VHJhY2tEYXRhID0gcHJvcGVydHlUcmFja0RhdGFJdGVtLkdldFByb3BlcnR5VHJhY2tEYXRhKCk7CiAgICAgICAgICAgIHRoaXMuX3dvcmxkSW5mb0NoYW5nZSA9IDA7CiAgICAgICAgICAgIHRoaXMuX3JlbmRlckNoYW5nZSA9IDA7CiAgICAgICAgICAgIHRoaXMuX25lZWRzQmVmb3JlQW5kQWZ0ZXIgPSAwOwogICAgICAgICAgICB0aGlzLl9zb3VyY2VBZGFwdGVyID0gdGhpcy5HZXRTb3VyY2VBZGFwdGVyKCk7CiAgICAgICAgICAgIHRoaXMuX3Byb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbXMgPSB0aGlzLl9wcm9wZXJ0eVRyYWNrRGF0YUl0ZW0uR2V0UHJvcGVydHlLZXlmcmFtZURhdGEoKS5HZXRQcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW1BcnJheSgpOwogICAgICAgICAgICB0aGlzLl9sYXN0UHJvcGVydHlLZXlmcmFtZURhdGFJdGVtID0KICAgICAgICAgICAgICAgIG51bGw7CiAgICAgICAgICAgIHRoaXMuX2Fic29sdXRlVmFsdWVPYmplY3QgPSBudWxsCiAgICAgICAgfQogICAgICAgIHN0YXRpYyBDcmVhdGUodHJhY2ssIHByb3BlcnR5VHJhY2tEYXRhSXRlbSkgewogICAgICAgICAgICByZXR1cm4gQzMuTmV3KEMzLlByb3BlcnR5VHJhY2tTdGF0ZSwgdHJhY2ssIHByb3BlcnR5VHJhY2tEYXRhSXRlbSkKICAgICAgICB9CiAgICAgICAgUmVsZWFzZSgpIHsKICAgICAgICAgICAgdGhpcy5fdHJhY2sgPSBudWxsOwogICAgICAgICAgICBpZiAodGhpcy5fc291cmNlQWRhcHRlcikgewogICAgICAgICAgICAgICAgdGhpcy5fc291cmNlQWRhcHRlci5SZWxlYXNlKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9zb3VyY2VBZGFwdGVyID0gbnVsbAogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuX3Byb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbXMgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9wcm9wZXJ0eVRyYWNrRGF0YUl0ZW0gPSBudWxsOwogICAgICAgICAgICB0aGlzLl9wcm9wZXJ0eVRyYWNrRGF0YSA9IG51bGwKICAgICAgICB9CiAgICAgICAgR2V0V29ybGRJbmZvQ2hhbmdlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fd29ybGRJbmZvQ2hhbmdlCiAgICAgICAgfQogICAgICAgIEdldFJlbmRlckNoYW5nZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3JlbmRlckNoYW5nZQogICAgICAgIH0KICAgICAgICBHZXROZWVkc0JlZm9yZUFuZEFmdGVyKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fbmVlZHNCZWZvcmVBbmRBZnRlcgogICAgICAgIH0KICAgICAgICBIYXNBYnNvbHV0ZVZhbHVlT2JqZWN0KCkgewogICAgICAgICAgICByZXR1cm4gISF0aGlzLl9hYnNvbHV0ZVZhbHVlT2JqZWN0CiAgICAgICAgfQogICAgICAgIFNldEFic29sdXRlVmFsdWVPYmplY3QoYXZvKSB7CiAgICAgICAgICAgIHRoaXMuX2Fic29sdXRlVmFsdWVPYmplY3QgPQogICAgICAgICAgICAgICAgYXZvCiAgICAgICAgfQogICAgICAgIEdldEFic29sdXRlVmFsdWVPYmplY3QoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9hYnNvbHV0ZVZhbHVlT2JqZWN0CiAgICAgICAgfQogICAgICAgIEdldFRyYWNrKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fdHJhY2sKICAgICAgICB9CiAgICAgICAgR2V0UHJvcGVydHlUcmFja0RhdGFJdGVtKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fcHJvcGVydHlUcmFja0RhdGFJdGVtCiAgICAgICAgfQogICAgICAgIEdldFByb3BlcnR5VHJhY2tEYXRhKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fcHJvcGVydHlUcmFja0RhdGEKICAgICAgICB9CiAgICAgICAgR2V0VGltZWxpbmUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl90cmFjay5HZXRUaW1lbGluZSgpCiAgICAgICAgfQogICAgICAgIEdldFJ1bnRpbWUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl90cmFjay5HZXRSdW50aW1lKCkKICAgICAgICB9CiAgICAgICAgR2V0SW5zdGFuY2UoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl90cmFjay5HZXRJbnN0YW5jZSgpCiAgICAgICAgfQogICAgICAgIEdldFNvdXJjZUFkYXB0ZXIoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9zb3VyY2VBZGFwdGVyKSByZXR1cm4gdGhpcy5fc291cmNlQWRhcHRlcjsKICAgICAgICAgICAgY29uc3QgaWQgPSB0aGlzLl9wcm9wZXJ0eVRyYWNrRGF0YUl0ZW0uR2V0U291cmNlQWRhcHRlcklkKCk7CiAgICAgICAgICAgIGxldCByZXQ7CiAgICAgICAgICAgIHN3aXRjaCAoaWQpIHsKICAgICAgICAgICAgICAgIGNhc2UgImJlaGF2aW9yIjoKICAgICAgICAgICAgICAgICAgICByZXQgPQogICAgICAgICAgICAgICAgICAgICAgICBuZXcgQzMuUHJvcGVydHlUcmFja1N0YXRlLkJlaGF2aW9yU291cmNlQWRhcHRlcih0aGlzKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgImVmZmVjdCI6CiAgICAgICAgICAgICAgICAgICAgcmV0ID0gbmV3IEMzLlByb3BlcnR5VHJhY2tTdGF0ZS5FZmZlY3RTb3VyY2VBZGFwdGVyKHRoaXMpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlbmRlckNoYW5nZSA9IDE7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICJpbnN0YW5jZS12YXJpYWJsZSI6CiAgICAgICAgICAgICAgICAgICAgcmV0ID0gbmV3IEMzLlByb3BlcnR5VHJhY2tTdGF0ZS5JbnN0YW5jZVZhcmlhYmxlU291cmNlQWRhcHRlcih0aGlzKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgInBsdWdpbiI6CiAgICAgICAgICAgICAgICAgICAgcmV0ID0gbmV3IEMzLlByb3BlcnR5VHJhY2tTdGF0ZS5QbHVnaW5Tb3VyY2VBZGFwdGVyKHRoaXMpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlbmRlckNoYW5nZSA9IDE7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICJ3b3JsZC1pbnN0YW5jZSI6CiAgICAgICAgICAgICAgICAgICAgcmV0ID0gbmV3IEMzLlByb3BlcnR5VHJhY2tTdGF0ZS5Qcm9wZXJ0eVNvdXJjZUFkYXB0ZXIodGhpcyk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVuZGVyQ2hhbmdlID0gMTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl93b3JsZEluZm9DaGFuZ2UgPSAxOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAidmFsdWUiOgogICAgICAgICAgICAgICAgICAgIHJldCA9IG5ldyBDMy5Qcm9wZXJ0eVRyYWNrU3RhdGUuVmFsdWVTb3VyY2VBZGFwdGVyKHRoaXMpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAiYXVkaW8iOgogICAgICAgICAgICAgICAgICAgIHJldCA9IG5ldyBDMy5Qcm9wZXJ0eVRyYWNrU3RhdGUuQXVkaW9Tb3VyY2VBZGFwdGVyKHRoaXMpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5fc291cmNlQWRhcHRlciA9IHJldDsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NvdXJjZUFkYXB0ZXIKICAgICAgICB9CiAgICAgICAgR2V0U291cmNlQWRhcHRlcklkKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fcHJvcGVydHlUcmFja0RhdGFJdGVtLkdldFNvdXJjZUFkYXB0ZXJJZCgpCiAgICAgICAgfQogICAgICAgIFNldFNvdXJjZUFkYXB0ZXJJZChzYWlkKSB7CiAgICAgICAgICAgIHRoaXMuX3Byb3BlcnR5VHJhY2tEYXRhSXRlbS5TZXRTb3VyY2VBZGFwdGVySWQoc2FpZCkKICAgICAgICB9CiAgICAgICAgR2V0U291cmNlQWRhcHRlckFyZ3MoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9wcm9wZXJ0eVRyYWNrRGF0YUl0ZW0uR2V0U291cmNlQWRhcHRlckFyZ3VtZW50cygpCiAgICAgICAgfQogICAgICAgIFNldFNvdXJjZUFkYXB0ZXJBcmdzKHNhcmdzKSB7CiAgICAgICAgICAgIHRoaXMuX3Byb3BlcnR5VHJhY2tEYXRhSXRlbS5TZXRTb3VyY2VBZGFwdGVyQXJndW1lbnRzKHNhcmdzKQogICAgICAgIH0KICAgICAgICBHZXRTb3VyY2VBZGFwdGVyVmFsdWUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLkdldFNvdXJjZUFkYXB0ZXIoKS5HZXRWYWx1ZSgpCiAgICAgICAgfQogICAgICAgIEdldFByb3BlcnR5TmFtZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3Byb3BlcnR5VHJhY2tEYXRhSXRlbS5HZXRQcm9wZXJ0eSgpCiAgICAgICAgfQogICAgICAgIFNldFByb3BlcnR5TmFtZShwbikgewogICAgICAgICAgICB0aGlzLl9wcm9wZXJ0eVRyYWNrRGF0YUl0ZW0uU2V0UHJvcGVydHkocG4pCiAgICAgICAgfQogICAgICAgIEdldFByb3BlcnR5VHlwZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3Byb3BlcnR5VHJhY2tEYXRhSXRlbS5HZXRUeXBlKCkKICAgICAgICB9CiAgICAgICAgU2V0UHJvcGVydHlUeXBlKHB0KSB7CiAgICAgICAgICAgIHRoaXMuX3Byb3BlcnR5VHJhY2tEYXRhSXRlbS5TZXRUeXBlKHB0KQogICAgICAgIH0KICAgICAgICBHZXRQcm9wZXJ0eUtleWZyYW1lVHlwZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuR2V0UHJvcGVydHlUcmFja0RhdGEoKS5HZXRGaXJzdFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbSh0aGlzLl9wcm9wZXJ0eVRyYWNrRGF0YUl0ZW0pLkdldFR5cGUoKQogICAgICAgIH0KICAgICAgICBHZXRNaW4oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9wcm9wZXJ0eVRyYWNrRGF0YUl0ZW0uR2V0TWluKCkKICAgICAgICB9CiAgICAgICAgU2V0TWluKG1pbikgewogICAgICAgICAgICB0aGlzLl9wcm9wZXJ0eVRyYWNrRGF0YUl0ZW0uU2V0TWluKG1pbikKICAgICAgICB9CiAgICAgICAgR2V0TWF4KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fcHJvcGVydHlUcmFja0RhdGFJdGVtLkdldE1heCgpCiAgICAgICAgfQogICAgICAgIFNldE1heChtYXgpIHsKICAgICAgICAgICAgdGhpcy5fcHJvcGVydHlUcmFja0RhdGFJdGVtLlNldE1heChtYXgpCiAgICAgICAgfQogICAgICAgIEdldEVuYWJsZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3Byb3BlcnR5VHJhY2tEYXRhSXRlbS5HZXRFbmFibGUoKQogICAgICAgIH0KICAgICAgICBTZXRFbmFibGUoZSkgewogICAgICAgICAgICB0aGlzLl9wcm9wZXJ0eVRyYWNrRGF0YUl0ZW0uU2V0RW5hYmxlKGUpCiAgICAgICAgfQogICAgICAgIEdldEludGVycG9sYXRpb25Nb2RlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fcHJvcGVydHlUcmFja0RhdGFJdGVtLkdldEludGVycG9sYXRpb25Nb2RlKCkKICAgICAgICB9CiAgICAgICAgU2V0SW50ZXJwb2xhdGlvbk1vZGUoaW0pIHsKICAgICAgICAgICAgdGhpcy5fcHJvcGVydHlUcmFja0RhdGFJdGVtLlNldEludGVycG9sYXRpb25Nb2RlKGltKQogICAgICAgIH0KICAgICAgICBHZXRSZXN1bHRNb2RlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fcHJvcGVydHlUcmFja0RhdGFJdGVtLkdldFJlc3VsdE1vZGUoKQogICAgICAgIH0KICAgICAgICBTZXRSZXN1bHRNb2RlKHJtKSB7CiAgICAgICAgICAgIHRoaXMuX3Byb3BlcnR5VHJhY2tEYXRhSXRlbS5TZXRSZXN1bHRNb2RlKHJtKQogICAgICAgIH0KICAgICAgICBTZXRFYXNlKGUpIHsKICAgICAgICAgICAgZm9yIChjb25zdCBwcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW0gb2YgdGhpcy5HZXRQcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW1zKCkpIHByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbS5TZXRFYXNlKGUpCiAgICAgICAgfQogICAgICAgIENhbkhhdmVQcm9wZXJ0eUtleWZyYW1lcygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3Byb3BlcnR5VHJhY2tEYXRhSXRlbS5DYW5IYXZlUHJvcGVydHlLZXlmcmFtZXMoKQogICAgICAgIH0KICAgICAgICBHZXRQcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW1zKCkgewogICAgICAgICAgICBpZiAodGhpcy5fcHJvcGVydHlLZXlmcmFtZURhdGFJdGVtcykgcmV0dXJuIHRoaXMuX3Byb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbXM7CiAgICAgICAgICAgIHRoaXMuX3Byb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbXMgPSB0aGlzLl9wcm9wZXJ0eVRyYWNrRGF0YUl0ZW0uR2V0UHJvcGVydHlLZXlmcmFtZURhdGEoKS5HZXRQcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW1BcnJheSgpOwogICAgICAgICAgICByZXR1cm4gdGhpcy5fcHJvcGVydHlLZXlmcmFtZURhdGFJdGVtcwogICAgICAgIH0KICAgICAgICBHZXRQcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW1BcnJheUluY2x1ZGluZ0Rpc2FibGVkKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fcHJvcGVydHlUcmFja0RhdGFJdGVtLkdldFByb3BlcnR5S2V5ZnJhbWVEYXRhKCkuR2V0UHJvcGVydHlLZXlmcmFtZURhdGFJdGVtQXJyYXlJbmNsdWRpbmdEaXNhYmxlZCgpCiAgICAgICAgfQogICAgICAgIEdldFByb3BlcnR5S2V5RnJhbWVEYXRhSXRlbUF0VGltZSh0aW1lKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9wcm9wZXJ0eVRyYWNrRGF0YS5HZXRQcm9wZXJ0eUtleUZyYW1lRGF0YUl0ZW1BdFRpbWUodGltZSwgdGhpcy5fcHJvcGVydHlUcmFja0RhdGFJdGVtKQogICAgICAgIH0KICAgICAgICBHZXRGaXJzdFByb3BlcnR5S2V5RnJhbWVEYXRhSXRlbUxvd2VyT3JFcXVhbFRoYW4odGltZSkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fcHJvcGVydHlUcmFja0RhdGEuR2V0Rmlyc3RQcm9wZXJ0eUtleUZyYW1lRGF0YUl0ZW1Mb3dlck9yRXF1YWxUaGFuKHRpbWUsCiAgICAgICAgICAgICAgICB0aGlzLl9wcm9wZXJ0eVRyYWNrRGF0YUl0ZW0pCiAgICAgICAgfQogICAgICAgIEdldFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbVBhaXJGb3JUaW1lKHRpbWUpIHsKICAgICAgICAgICAgbGV0IHN0YXJ0ID0gdGhpcy5fcHJvcGVydHlUcmFja0RhdGEuR2V0UHJvcGVydHlLZXlGcmFtZURhdGFJdGVtQXRUaW1lKHRpbWUsIHRoaXMuX3Byb3BlcnR5VHJhY2tEYXRhSXRlbSk7CiAgICAgICAgICAgIGxldCBlbmQ7CiAgICAgICAgICAgIGlmIChzdGFydCkgZW5kID0gdGhpcy5fcHJvcGVydHlUcmFja0RhdGEuR2V0Rmlyc3RQcm9wZXJ0eUtleUZyYW1lRGF0YUl0ZW1IaWdoZXJUaGFuKHRpbWUsIHRoaXMuX3Byb3BlcnR5VHJhY2tEYXRhSXRlbSk7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgc3RhcnQgPSB0aGlzLl9wcm9wZXJ0eVRyYWNrRGF0YS5HZXRGaXJzdFByb3BlcnR5S2V5RnJhbWVEYXRhSXRlbUxvd2VyT3JFcXVhbFRoYW4odGltZSwgdGhpcy5fcHJvcGVydHlUcmFja0RhdGFJdGVtKTsKICAgICAgICAgICAgICAgIGVuZCA9IHRoaXMuX3Byb3BlcnR5VHJhY2tEYXRhLkdldEZpcnN0UHJvcGVydHlLZXlGcmFtZURhdGFJdGVtSGlnaGVyT3JFcXVhbFRoYW4odGltZSwgdGhpcy5fcHJvcGVydHlUcmFja0RhdGFJdGVtKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBzdGFydCwKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICB9CiAgICAgICAgfSogR2V0UHJvcGVydHlLZXlmcmFtZVZhbHVlcygpIHsKICAgICAgICAgICAgZm9yIChjb25zdCBwcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW0gb2YgdGhpcy5HZXRQcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW1zKCkpIHlpZWxkIHByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbS5HZXRWYWx1ZVdpdGhSZXN1bHRNb2RlKCkKICAgICAgICB9KiBHZXRQcm9wZXJ0eUtleWZyYW1lVGltZXMoKSB7CiAgICAgICAgICAgIGZvciAoY29uc3QgcHJvcGVydHlLZXlmcmFtZURhdGFJdGVtIG9mIHRoaXMuR2V0UHJvcGVydHlLZXlmcmFtZURhdGFJdGVtcygpKSB5aWVsZCBwcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW0uR2V0VGltZSgpCiAgICAgICAgfQogICAgICAgIFRpbWVsaW5lUmVtb3ZlZCgpIHsKICAgICAgICAgICAgdGhpcy5HZXRTb3VyY2VBZGFwdGVyKCkuVGltZWxpbmVSZW1vdmVkKCkKICAgICAgICB9CiAgICAgICAgQ2xlYW5DYWNoZXMoKSB7CiAgICAgICAgICAgIHRoaXMuR2V0U291cmNlQWRhcHRlcigpLkNsZWFuQ2FjaGVzKCkKICAgICAgICB9CiAgICAgICAgR2V0Q3VycmVudFN0YXRlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5HZXRTb3VyY2VBZGFwdGVyKCkuR2V0Q3VycmVudFN0YXRlKCkKICAgICAgICB9CiAgICAgICAgU2V0UmVzZXRTdGF0ZSgpIHsKICAgICAgICAgICAgdGhpcy5HZXRTb3VyY2VBZGFwdGVyKCkuU2V0UmVzZXRTdGF0ZSgpCiAgICAgICAgfQogICAgICAgIFNldEluaXRpYWxTdGF0ZSh0aW1lKSB7CiAgICAgICAgICAgIHRoaXMuR2V0U291cmNlQWRhcHRlcigpLlNldEluaXRpYWxTdGF0ZSgpOwogICAgICAgICAgICB0aGlzLl9sYXN0UHJvcGVydHlLZXlmcmFtZURhdGFJdGVtID0gdGhpcy5fR2V0TGFzdFByb3BlcnR5S2V5RnJhbWVCZWZvcmVUaW1lKHRpbWUpOwogICAgICAgICAgICB0aGlzLl9TZXRVcGRhdGVTdGF0ZSgpCiAgICAgICAgfQogICAgICAgIFNldFJlc3VtZVN0YXRlKHRpbWUpIHsKICAgICAgICAgICAgdGhpcy5HZXRTb3VyY2VBZGFwdGVyKCkuU2V0UmVzdW1lU3RhdGUoKTsKICAgICAgICAgICAgdGhpcy5fbGFzdFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbSA9IHRoaXMuX0dldExhc3RQcm9wZXJ0eUtleUZyYW1lQmVmb3JlVGltZSh0aW1lKQogICAgICAgIH0KICAgICAgICBfU2V0VXBkYXRlU3RhdGUoKSB7CiAgICAgICAgICAgIGNvbnN0IHRyYWNrID0gdGhpcy5HZXRUcmFjaygpOwogICAgICAgICAgICB0aGlzLl9uZWVkc0JlZm9yZUFuZEFmdGVyID0gMDsKICAgICAgICAgICAgaWYgKHRyYWNrLklzSW5zdGFuY2VUcmFjaygpKSB7CiAgICAgICAgICAgICAgICBjb25zdCB0aW1lbGluZSA9IHRoaXMuR2V0VGltZWxpbmUoKTsKICAgICAgICAgICAgICAgIGNvbnN0IGluc3RhbmNlID0gdHJhY2suR2V0SW5zdGFuY2UoKTsKICAgICAgICAgICAgICAgIGNvbnN0IHNvdXJjZUFkYXB0ZXIgPSB0aGlzLkdldFNvdXJjZUFkYXB0ZXIoKTsKICAgICAgICAgICAgICAgIGNvbnN0IHByb3BlcnR5TmFtZSA9IHRoaXMuR2V0UHJvcGVydHlOYW1lKCk7CiAgICAgICAgICAgICAgICBjb25zdCBtYXlOZWVkQmVmb3JlQW5kQWZ0ZXJJbnRlcnBvbGF0ZSA9IHNvdXJjZUFkYXB0ZXIuTWF5TmVlZEJlZm9yZUFuZEFmdGVySW50ZXJwb2xhdGUoKTsKICAgICAgICAgICAgICAgIGlmIChtYXlOZWVkQmVmb3JlQW5kQWZ0ZXJJbnRlcnBvbGF0ZSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNpbWlsYXJQcm9wZXJ0eVRyYWNrcyA9IHRpbWVsaW5lLkdldFNpbWlsYXJQcm9wZXJ0eVRyYWNrcyhpbnN0YW5jZSwgc291cmNlQWRhcHRlciwgcHJvcGVydHlOYW1lKTsKICAgICAgICAgICAgICAgICAgICBpZiAoc2ltaWxhclByb3BlcnR5VHJhY2tzICYmIHNpbWlsYXJQcm9wZXJ0eVRyYWNrcy5sZW5ndGgpIHRoaXMuX25lZWRzQmVmb3JlQW5kQWZ0ZXIgPSAxCiAgICAgICAgICAgICAgICB9IGVsc2UgdGhpcy5fbmVlZHNCZWZvcmVBbmRBZnRlciA9IDAKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBfR2V0TGFzdFByb3BlcnR5S2V5RnJhbWVCZWZvcmVUaW1lKHRpbWUpIHsKICAgICAgICAgICAgY29uc3QgdGltZWxpbmUgPSB0aGlzLkdldFRpbWVsaW5lKCk7CiAgICAgICAgICAgIGNvbnN0IHByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbSA9IHRoaXMuX3Byb3BlcnR5VHJhY2tEYXRhLkdldFByb3BlcnR5S2V5RnJhbWVEYXRhSXRlbUF0VGltZSh0aW1lLAogICAgICAgICAgICAgICAgdGhpcy5fcHJvcGVydHlUcmFja0RhdGFJdGVtKTsKICAgICAgICAgICAgaWYgKHByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbSkgcmV0dXJuIHByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbTsKICAgICAgICAgICAgZWxzZSBpZiAodGltZWxpbmUuSXNGb3J3YXJkUGxheUJhY2soKSkgcmV0dXJuIHRoaXMuX3Byb3BlcnR5VHJhY2tEYXRhLkdldEZpcnN0UHJvcGVydHlLZXlGcmFtZURhdGFJdGVtTG93ZXJPckVxdWFsVGhhbih0aW1lLCB0aGlzLl9wcm9wZXJ0eVRyYWNrRGF0YUl0ZW0pOwogICAgICAgICAgICBlbHNlIHJldHVybiB0aGlzLl9wcm9wZXJ0eVRyYWNrRGF0YS5HZXRGaXJzdFByb3BlcnR5S2V5RnJhbWVEYXRhSXRlbUhpZ2hlck9yRXF1YWxUaGFuKHRpbWUsIHRoaXMuX3Byb3BlcnR5VHJhY2tEYXRhSXRlbSkKICAgICAgICB9CiAgICAgICAgQmVmb3JlSW50ZXJwb2xhdGUoKSB7CiAgICAgICAgICAgIHRoaXMuX3NvdXJjZUFkYXB0ZXIuQmVmb3JlSW50ZXJwb2xhdGUoKQogICAgICAgIH0KICAgICAgICBJbnRlcnBvbGF0ZSh0aW1lLCBzZXRUaW1lID0gZmFsc2UsIGVuc3VyZVZhbHVlID0gZmFsc2UsIGVuZFN0YXRlID0gZmFsc2UpIHsKICAgICAgICAgICAgbGV0IHN0YXJ0OwogICAgICAgICAgICBsZXQgZW5kOwogICAgICAgICAgICBpZiAoc2V0VGltZSkgc3RhcnQgPSB0aGlzLl9wcm9wZXJ0eVRyYWNrRGF0YS5HZXRGaXJzdFByb3BlcnR5S2V5RnJhbWVEYXRhSXRlbUxvd2VyT3JFcXVhbFRoYW4odGltZSwgdGhpcy5fcHJvcGVydHlUcmFja0RhdGFJdGVtKTsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fbGFzdFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHRpbWVsaW5lID0gdGhpcy5HZXRUaW1lbGluZSgpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IG5leHRQcm9wZXJ0eUtleWZyYW1lID0gdGhpcy5fbGFzdFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbS5HZXROZXh0KCk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgbGFzdFRpbWUgPSB0aGlzLl9sYXN0UHJvcGVydHlLZXlmcmFtZURhdGFJdGVtLkdldFRpbWUoKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXh0VGltZSA9IG5leHRQcm9wZXJ0eUtleWZyYW1lID8gbmV4dFByb3BlcnR5S2V5ZnJhbWUuR2V0VGltZSgpIDogdGltZWxpbmUuR2V0VG90YWxUaW1lKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRpbWUgPD0gbGFzdFRpbWUgfHwgdGltZSA+PSBuZXh0VGltZSkgdGhpcy5fbGFzdFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbSA9IHRoaXMuX3Byb3BlcnR5VHJhY2tEYXRhLkdldEZpcnN0UHJvcGVydHlLZXlGcmFtZURhdGFJdGVtTG93ZXJPckVxdWFsVGhhbih0aW1lLAogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9wcm9wZXJ0eVRyYWNrRGF0YUl0ZW0pCiAgICAgICAgICAgICAgICB9IGVsc2UgdGhpcy5fbGFzdFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbSA9IHRoaXMuX3Byb3BlcnR5VHJhY2tEYXRhLkdldEZpcnN0UHJvcGVydHlLZXlGcmFtZURhdGFJdGVtTG93ZXJPckVxdWFsVGhhbih0aW1lLCB0aGlzLl9wcm9wZXJ0eVRyYWNrRGF0YUl0ZW0pOwogICAgICAgICAgICAgICAgc3RhcnQgPSB0aGlzLl9sYXN0UHJvcGVydHlLZXlmcmFtZURhdGFJdGVtCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHN0YXJ0KSBlbmQgPSBzdGFydC5HZXROZXh0KCk7CiAgICAgICAgICAgIHRoaXMuX3NvdXJjZUFkYXB0ZXIuSW50ZXJwb2xhdGUodGltZSwgc3RhcnQsIGVuZCwgc2V0VGltZSwgZW5zdXJlVmFsdWUsIGVuZFN0YXRlKQogICAgICAgIH0KICAgICAgICBHZXRJbnRlcnBvbGF0ZWRWYWx1ZSh0aW1lKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9sYXN0UHJvcGVydHlLZXlmcmFtZURhdGFJdGVtKSB7CiAgICAgICAgICAgICAgICBjb25zdCB0aW1lbGluZSA9IHRoaXMuR2V0VGltZWxpbmUoKTsKICAgICAgICAgICAgICAgIGNvbnN0IG5leHRQcm9wZXJ0eUtleWZyYW1lID0gdGhpcy5fbGFzdFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbS5HZXROZXh0KCk7CiAgICAgICAgICAgICAgICBjb25zdCBsYXN0VGltZSA9CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbGFzdFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbS5HZXRUaW1lKCk7CiAgICAgICAgICAgICAgICBjb25zdCBuZXh0VGltZSA9IG5leHRQcm9wZXJ0eUtleWZyYW1lID8gbmV4dFByb3BlcnR5S2V5ZnJhbWUuR2V0VGltZSgpIDogdGltZWxpbmUuR2V0VG90YWxUaW1lKCk7CiAgICAgICAgICAgICAgICBpZiAodGltZSA8PSBsYXN0VGltZSB8fCB0aW1lID49IG5leHRUaW1lKSB0aGlzLl9sYXN0UHJvcGVydHlLZXlmcmFtZURhdGFJdGVtID0gdGhpcy5fcHJvcGVydHlUcmFja0RhdGEuR2V0Rmlyc3RQcm9wZXJ0eUtleUZyYW1lRGF0YUl0ZW1Mb3dlck9yRXF1YWxUaGFuKHRpbWUsIHRoaXMuX3Byb3BlcnR5VHJhY2tEYXRhSXRlbSkKICAgICAgICAgICAgfSBlbHNlIHRoaXMuX2xhc3RQcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW0gPSB0aGlzLl9wcm9wZXJ0eVRyYWNrRGF0YS5HZXRGaXJzdFByb3BlcnR5S2V5RnJhbWVEYXRhSXRlbUxvd2VyT3JFcXVhbFRoYW4odGltZSwgdGhpcy5fcHJvcGVydHlUcmFja0RhdGFJdGVtKTsKICAgICAgICAgICAgY29uc3Qgc3RhcnQgPSB0aGlzLl9sYXN0UHJvcGVydHlLZXlmcmFtZURhdGFJdGVtOwogICAgICAgICAgICBjb25zdCBlbmQgPSBzdGFydC5HZXROZXh0KCk7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zb3VyY2VBZGFwdGVyLkdldEludGVycG9sYXRlZFZhbHVlKHRpbWUsIHN0YXJ0LCBlbmQpCiAgICAgICAgfQogICAgICAgIEdldEludGVycG9sYXRlZFZhbHVlRmFzdCh0aW1lLCBzdGFydCwgZW5kKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zb3VyY2VBZGFwdGVyLkdldEludGVycG9sYXRlZFZhbHVlKHRpbWUsIHN0YXJ0LCBlbmQpCiAgICAgICAgfQogICAgICAgIEFmdGVySW50ZXJwb2xhdGUoKSB7CiAgICAgICAgICAgIHRoaXMuX3NvdXJjZUFkYXB0ZXIuQWZ0ZXJJbnRlcnBvbGF0ZSgpCiAgICAgICAgfQogICAgICAgIHN0YXRpYyBHZXRTdGFydFByb3BlcnR5S2V5ZnJhbWVGb3JUaW1lKHRpbWUsIHByb3BlcnR5VHJhY2spIHsKICAgICAgICAgICAgY29uc3QgcHJvcGVydHlUcmFja0RhdGFJdGVtID0gcHJvcGVydHlUcmFjay5HZXRQcm9wZXJ0eVRyYWNrRGF0YUl0ZW0oKTsKICAgICAgICAgICAgY29uc3QgcHJvcGVydHlUcmFja0RhdGEgPSBwcm9wZXJ0eVRyYWNrLl9wcm9wZXJ0eVRyYWNrRGF0YTsKICAgICAgICAgICAgcmV0dXJuIHByb3BlcnR5VHJhY2tEYXRhLkdldEZpcnN0UHJvcGVydHlLZXlGcmFtZURhdGFJdGVtTG93ZXJPckVxdWFsVGhhbih0aW1lLAogICAgICAgICAgICAgICAgcHJvcGVydHlUcmFja0RhdGFJdGVtKQogICAgICAgIH0KICAgICAgICBzdGF0aWMgR2V0RW5kUHJvcGVydHlLZXlmcmFtZUZvclRpbWUodGltZSwgcHJvcGVydHlUcmFjaykgewogICAgICAgICAgICBjb25zdCBwcm9wZXJ0eVRyYWNrRGF0YUl0ZW0gPSBwcm9wZXJ0eVRyYWNrLkdldFByb3BlcnR5VHJhY2tEYXRhSXRlbSgpOwogICAgICAgICAgICBjb25zdCBwcm9wZXJ0eVRyYWNrRGF0YSA9IHByb3BlcnR5VHJhY2suX3Byb3BlcnR5VHJhY2tEYXRhOwogICAgICAgICAgICByZXR1cm4gcHJvcGVydHlUcmFja0RhdGEuR2V0Rmlyc3RQcm9wZXJ0eUtleUZyYW1lRGF0YUl0ZW1IaWdoZXJPckVxdWFsVGhhbih0aW1lLCBwcm9wZXJ0eVRyYWNrRGF0YUl0ZW0pCiAgICAgICAgfQogICAgICAgIEFkZFByb3BlcnR5S2V5ZnJhbWUoKSB7CiAgICAgICAgICAgIGNvbnN0IHByb3BlcnR5S2V5ZnJhbWVEYXRhID0gdGhpcy5fcHJvcGVydHlUcmFja0RhdGFJdGVtLkdldFByb3BlcnR5S2V5ZnJhbWVEYXRhKCk7CiAgICAgICAgICAgIGNvbnN0IHByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbSA9IHByb3BlcnR5S2V5ZnJhbWVEYXRhLkFkZEVtcHR5UHJvcGVydHlLZXlmcmFtZURhdGFJdGVtKCk7CiAgICAgICAgICAgIHRoaXMuX2xhc3RQcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW0gPQogICAgICAgICAgICAgICAgbnVsbDsKICAgICAgICAgICAgcmV0dXJuIHByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbQogICAgICAgIH0KICAgICAgICBEZWxldGVQcm9wZXJ0eUtleWZyYW1lcyhtYXRjaCkgewogICAgICAgICAgICB0aGlzLl9sYXN0UHJvcGVydHlLZXlmcmFtZURhdGFJdGVtID0gbnVsbDsKICAgICAgICAgICAgY29uc3QgcHJvcGVydHlLZXlmcmFtZURhdGEgPSB0aGlzLl9wcm9wZXJ0eVRyYWNrRGF0YUl0ZW0uR2V0UHJvcGVydHlLZXlmcmFtZURhdGEoKTsKICAgICAgICAgICAgcHJvcGVydHlLZXlmcmFtZURhdGEuRGVsZXRlUHJvcGVydHlLZXlmcmFtZURhdGFJdGVtcyhtYXRjaCkKICAgICAgICB9CiAgICAgICAgU2F2ZVN0YXRlKCkgewogICAgICAgICAgICB0aGlzLkdldFNvdXJjZUFkYXB0ZXIoKS5TYXZlU3RhdGUoKQogICAgICAgIH0KICAgICAgICBDb21wYXJlSW5pdGlhbFN0YXRlV2l0aEN1cnJlbnQoKSB7CiAgICAgICAgICAgIGNvbnN0IGRpZmZlcmVuY2UgPSB0aGlzLkdldFNvdXJjZUFkYXB0ZXIoKS5Db21wYXJlSW5pdGlhbFN0YXRlV2l0aEN1cnJlbnQoKTsKICAgICAgICAgICAgaWYgKGRpZmZlcmVuY2UpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbSA9IHRoaXMuX3Byb3BlcnR5VHJhY2tEYXRhLkdldEZpcnN0UHJvcGVydHlLZXlmcmFtZURhdGFJdGVtKHRoaXMuX3Byb3BlcnR5VHJhY2tEYXRhSXRlbSk7CiAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50U3RhdGUgPSB0aGlzLkdldFNvdXJjZUFkYXB0ZXIoKS5HZXRDdXJyZW50U3RhdGUoKTsKICAgICAgICAgICAgICAgIHByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbS5TZXRBYnNvbHV0ZVZhbHVlKGN1cnJlbnRTdGF0ZSkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBDb21wYXJlU2F2ZVN0YXRlV2l0aEN1cnJlbnQoKSB7CiAgICAgICAgICAgIGNvbnN0IGRpZmZlcmVuY2UgPSB0aGlzLkdldFNvdXJjZUFkYXB0ZXIoKS5Db21wYXJlU2F2ZVN0YXRlV2l0aEN1cnJlbnQoKTsKICAgICAgICAgICAgaWYgKGRpZmZlcmVuY2UpIHRoaXMuQWRkUHJvcGVydHlLZXlmcmFtZUF0Q3VycmVudFRpbWUoKTsKICAgICAgICAgICAgdGhpcy5HZXRTb3VyY2VBZGFwdGVyKCkuQ2xlYXJTYXZlU3RhdGUoKTsKICAgICAgICAgICAgcmV0dXJuIGRpZmZlcmVuY2UKICAgICAgICB9CiAgICAgICAgQWRkUHJvcGVydHlLZXlmcmFtZUF0Q3VycmVudFRpbWUoKSB7CiAgICAgICAgICAgIGNvbnN0IHRpbWUgPSB0aGlzLkdldFRpbWVsaW5lKCkuR2V0VGltZSgpOwogICAgICAgICAgICBjb25zdCBzb3VyY2VBZGFwdGVyID0gdGhpcy5HZXRTb3VyY2VBZGFwdGVyKCk7CiAgICAgICAgICAgIGNvbnN0IHN0YXJ0UHJvcGVydHlLZXlmcmFtZSA9IEMzLlByb3BlcnR5VHJhY2tTdGF0ZS5HZXRTdGFydFByb3BlcnR5S2V5ZnJhbWVGb3JUaW1lKHRpbWUsCiAgICAgICAgICAgICAgICB0aGlzKTsKICAgICAgICAgICAgY29uc3QgcHJvcGVydHlLZXlmcmFtZURhdGFJdGVtID0gdGhpcy5BZGRQcm9wZXJ0eUtleWZyYW1lKCk7CiAgICAgICAgICAgIHByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbS5TZXRUeXBlKHN0YXJ0UHJvcGVydHlLZXlmcmFtZS5HZXRUeXBlKCkpOwogICAgICAgICAgICBwcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW0uU2V0VGltZSh0aW1lKTsKICAgICAgICAgICAgcHJvcGVydHlLZXlmcmFtZURhdGFJdGVtLlNldEVhc2Uoc3RhcnRQcm9wZXJ0eUtleWZyYW1lLkdldEVhc2UoKSk7CiAgICAgICAgICAgIHByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbS5TZXRFbmFibGUodHJ1ZSk7CiAgICAgICAgICAgIHByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbS5TZXRWYWx1ZShzb3VyY2VBZGFwdGVyLkdldFZhbHVlQXRUaW1lKCkpOwogICAgICAgICAgICBwcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW0uU2V0QWJzb2x1dGVWYWx1ZShzb3VyY2VBZGFwdGVyLkdldEN1cnJlbnRTdGF0ZSgpKQogICAgICAgIH0KICAgICAgICBfU2F2ZVRvSnNvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICJzb3VyY2VBZGFwdGVySnNvbiI6IHRoaXMuR2V0U291cmNlQWRhcHRlcigpLl9TYXZlVG9Kc29uKCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBfTG9hZEZyb21Kc29uKG8pIHsKICAgICAgICAgICAgaWYgKCFvKSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuR2V0U291cmNlQWRhcHRlcigpLl9Mb2FkRnJvbUpzb24ob1sic291cmNlQWRhcHRlckpzb24iXSkKICAgICAgICB9CiAgICB9OwoKfQoKLy8gdGltZWxpbmVzL3N0YXRlL3Byb3BlcnR5U291cmNlQWRhcHRlcnMvcHJvcGVydHlTb3VyY2VBZGFwdGVyLmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIGNvbnN0IE5TID0gQzMuUHJvcGVydHlUcmFja1N0YXRlOwogICAgTlMuUHJvcGVydHlTb3VyY2VBZGFwdGVyID0gY2xhc3MgUHJvcGVydHlTb3VyY2VBZGFwdGVyIHsKICAgICAgICBjb25zdHJ1Y3Rvcihwcm9wZXJ0eVRyYWNrKSB7CiAgICAgICAgICAgIHRoaXMuX3Byb3BlcnR5VHJhY2sgPSBwcm9wZXJ0eVRyYWNrOwogICAgICAgICAgICB0aGlzLl9wcm9wZXJ0eUFkYXB0ZXIgPSBudWxsOwogICAgICAgICAgICB0aGlzLkdldFByb3BlcnR5QWRhcHRlcigpCiAgICAgICAgfQogICAgICAgIFJlbGVhc2UoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9wcm9wZXJ0eUFkYXB0ZXIpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3Byb3BlcnR5QWRhcHRlci5SZWxlYXNlKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9wcm9wZXJ0eUFkYXB0ZXIgPSBudWxsCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5fcHJvcGVydHlUcmFjayA9IG51bGwKICAgICAgICB9CiAgICAgICAgTWF5TmVlZEJlZm9yZUFuZEFmdGVySW50ZXJwb2xhdGUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9wcm9wZXJ0eUFkYXB0ZXIuTWF5TmVlZEJlZm9yZUFuZEFmdGVySW50ZXJwb2xhdGUoKQogICAgICAgIH0KICAgICAgICBHZXRQcm9wZXJ0eVRyYWNrKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fcHJvcGVydHlUcmFjawogICAgICAgIH0KICAgICAgICBUaW1lbGluZVJlbW92ZWQoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9wcm9wZXJ0eUFkYXB0ZXIpIHRoaXMuX3Byb3BlcnR5QWRhcHRlci5UaW1lbGluZVJlbW92ZWQoKQogICAgICAgIH0KICAgICAgICBDbGVhbkNhY2hlcygpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX3Byb3BlcnR5QWRhcHRlcikgdGhpcy5fcHJvcGVydHlBZGFwdGVyLkNsZWFuQ2FjaGVzKCkKICAgICAgICB9CiAgICAgICAgR2V0UHJvcGVydHlBZGFwdGVyKCkgewogICAgICAgICAgICBpZiAodGhpcy5fcHJvcGVydHlBZGFwdGVyKSByZXR1cm4gdGhpcy5fcHJvcGVydHlBZGFwdGVyOwogICAgICAgICAgICB0aGlzLl9wcm9wZXJ0eUFkYXB0ZXIgPQogICAgICAgICAgICAgICAgdGhpcy5fQ3JlYXRlUHJvcGVydHlBZGFwdGVyKCk7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9wcm9wZXJ0eUFkYXB0ZXIKICAgICAgICB9CiAgICAgICAgR2V0RWRpdG9ySW5kZXgoKSB7fQogICAgICAgIEdldEluZGV4KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5HZXRFZGl0b3JJbmRleCgpCiAgICAgICAgfQogICAgICAgIEdldFRhcmdldCgpIHt9CiAgICAgICAgU2V0UmVzZXRTdGF0ZSgpIHsKICAgICAgICAgICAgdGhpcy5HZXRQcm9wZXJ0eUFkYXB0ZXIoKS5TZXRSZXNldFN0YXRlKCkKICAgICAgICB9CiAgICAgICAgU2V0SW5pdGlhbFN0YXRlKCkgewogICAgICAgICAgICB0aGlzLkdldFByb3BlcnR5QWRhcHRlcigpLlNldEluaXRpYWxTdGF0ZSgpCiAgICAgICAgfQogICAgICAgIFNldFJlc3VtZVN0YXRlKCkgewogICAgICAgICAgICB0aGlzLkdldFByb3BlcnR5QWRhcHRlcigpLlNldFJlc3VtZVN0YXRlKCkKICAgICAgICB9CiAgICAgICAgQmVmb3JlSW50ZXJwb2xhdGUoKSB7CiAgICAgICAgICAgIHRoaXMuX3Byb3BlcnR5QWRhcHRlci5CZWZvcmVDaGFuZ2VQcm9wZXJ0eSgpCiAgICAgICAgfQogICAgICAgIEludGVycG9sYXRlKHRpbWUsIHN0YXJ0LCBlbmQsIHNldFRpbWUsIGVuc3VyZVZhbHVlLCBlbmRTdGF0ZSkgewogICAgICAgICAgICBjb25zdCB0eXBlID0gdGhpcy5fcHJvcGVydHlUcmFjay5HZXRQcm9wZXJ0eUtleWZyYW1lVHlwZSgpOwogICAgICAgICAgICBsZXQgdmFsdWU7CiAgICAgICAgICAgIHN3aXRjaCAodHlwZSkgewogICAgICAgICAgICAgICAgY2FzZSAibnVtZXJpYyI6CiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9CiAgICAgICAgICAgICAgICAgICAgICAgIE5TLk51bWVyaWNUeXBlQWRhcHRlci5JbnRlcnBvbGF0ZSh0aW1lLCBzdGFydCwgZW5kLCB0aGlzLl9wcm9wZXJ0eVRyYWNrKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjYXNlICJhbmdsZSI6CiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IE5TLkFuZ2xlVHlwZUFkYXB0ZXIuSW50ZXJwb2xhdGUodGltZSwgc3RhcnQsIGVuZCwgdGhpcy5fcHJvcGVydHlUcmFjayk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2FzZSAiYm9vbGVhbiI6CiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IE5TLkJvb2xlYW5UeXBlQWRhcHRlci5JbnRlcnBvbGF0ZSh0aW1lLCBzdGFydCwgZW5kLCB0aGlzLl9wcm9wZXJ0eVRyYWNrKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjYXNlICJjb2xvciI6CiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IE5TLkNvbG9yVHlwZUFkYXB0ZXIuSW50ZXJwb2xhdGUodGltZSwgc3RhcnQsIGVuZCwgdGhpcy5fcHJvcGVydHlUcmFjayk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2FzZSAidGV4dCI6CiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IE5TLlRleHRUeXBlQWRhcHRlci5JbnRlcnBvbGF0ZSh0aW1lLCBzdGFydCwgZW5kLCB0aGlzLl9wcm9wZXJ0eVRyYWNrKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5fcHJvcGVydHlBZGFwdGVyLkNoYW5nZVByb3BlcnR5KHRpbWUsIHZhbHVlLAogICAgICAgICAgICAgICAgc3RhcnQsIGVuZCwgc2V0VGltZSwgZW5zdXJlVmFsdWUsIGVuZFN0YXRlKQogICAgICAgIH0KICAgICAgICBHZXRJbnRlcnBvbGF0ZWRWYWx1ZSh0aW1lLCBzdGFydCwgZW5kKSB7CiAgICAgICAgICAgIHN3aXRjaCAodGhpcy5fcHJvcGVydHlUcmFjay5HZXRQcm9wZXJ0eUtleWZyYW1lVHlwZSgpKSB7CiAgICAgICAgICAgICAgICBjYXNlICJudW1lcmljIjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gTlMuTnVtZXJpY1R5cGVBZGFwdGVyLkludGVycG9sYXRlKHRpbWUsIHN0YXJ0LCBlbmQsIHRoaXMuX3Byb3BlcnR5VHJhY2spOwogICAgICAgICAgICAgICAgY2FzZSAiYW5nbGUiOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBOUy5BbmdsZVR5cGVBZGFwdGVyLkludGVycG9sYXRlKHRpbWUsIHN0YXJ0LCBlbmQsIHRoaXMuX3Byb3BlcnR5VHJhY2spOwogICAgICAgICAgICAgICAgY2FzZSAiYm9vbGVhbiI6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE5TLkJvb2xlYW5UeXBlQWRhcHRlci5JbnRlcnBvbGF0ZSh0aW1lLCBzdGFydCwgZW5kLCB0aGlzLl9wcm9wZXJ0eVRyYWNrKTsKICAgICAgICAgICAgICAgIGNhc2UgImNvbG9yIjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gTlMuQ29sb3JUeXBlQWRhcHRlci5JbnRlcnBvbGF0ZSh0aW1lLCBzdGFydCwgZW5kLCB0aGlzLl9wcm9wZXJ0eVRyYWNrKTsKICAgICAgICAgICAgICAgIGNhc2UgInRleHQiOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBOUy5UZXh0VHlwZUFkYXB0ZXIuSW50ZXJwb2xhdGUodGltZSwKICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnQsIGVuZCwgdGhpcy5fcHJvcGVydHlUcmFjaykKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBBZnRlckludGVycG9sYXRlKCkgewogICAgICAgICAgICB0aGlzLl9wcm9wZXJ0eUFkYXB0ZXIuQWZ0ZXJDaGFuZ2VQcm9wZXJ0eSgpCiAgICAgICAgfQogICAgICAgIFNhdmVTdGF0ZSgpIHsKICAgICAgICAgICAgdGhpcy5HZXRQcm9wZXJ0eUFkYXB0ZXIoKS5TZXRTYXZlU3RhdGUoKQogICAgICAgIH0KICAgICAgICBDbGVhclNhdmVTdGF0ZSgpIHsKICAgICAgICAgICAgdGhpcy5HZXRQcm9wZXJ0eUFkYXB0ZXIoKS5DbGVhclNhdmVTdGF0ZSgpCiAgICAgICAgfQogICAgICAgIEdldEN1cnJlbnRTdGF0ZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuR2V0UHJvcGVydHlBZGFwdGVyKCkuR2V0Q3VycmVudFN0YXRlKCkKICAgICAgICB9CiAgICAgICAgQ29tcGFyZUluaXRpYWxTdGF0ZVdpdGhDdXJyZW50KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5HZXRQcm9wZXJ0eUFkYXB0ZXIoKS5Db21wYXJlSW5pdGlhbFN0YXRlV2l0aEN1cnJlbnQoKQogICAgICAgIH0KICAgICAgICBDb21wYXJlU2F2ZVN0YXRlV2l0aEN1cnJlbnQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLkdldFByb3BlcnR5QWRhcHRlcigpLkNvbXBhcmVTYXZlU3RhdGVXaXRoQ3VycmVudCgpCiAgICAgICAgfQogICAgICAgIEdldFZhbHVlQXRUaW1lKCkgewogICAgICAgICAgICBjb25zdCBwcm9wZXJ0eVRyYWNrID0KICAgICAgICAgICAgICAgIHRoaXMuX3Byb3BlcnR5VHJhY2s7CiAgICAgICAgICAgIGNvbnN0IHRyYWNrID0gcHJvcGVydHlUcmFjay5HZXRUcmFjaygpOwogICAgICAgICAgICBjb25zdCB0aW1lID0gdHJhY2suR2V0VGltZWxpbmUoKS5HZXRUaW1lKCk7CiAgICAgICAgICAgIGNvbnN0IHN0YXJ0ID0gTlMuR2V0U3RhcnRQcm9wZXJ0eUtleWZyYW1lRm9yVGltZSh0aW1lLCBwcm9wZXJ0eVRyYWNrKTsKICAgICAgICAgICAgY29uc3QgZW5kID0gc3RhcnQuR2V0TmV4dCgpOwogICAgICAgICAgICBjb25zdCB0eXBlID0gcHJvcGVydHlUcmFjay5HZXRQcm9wZXJ0eUtleWZyYW1lVHlwZSgpOwogICAgICAgICAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgICAgICAgICAgIGNhc2UgIm51bWVyaWMiOgogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE5TLk51bWVyaWNUeXBlQWRhcHRlci5JbnRlcnBvbGF0ZSh0aW1lLCBzdGFydCwgZW5kLCBwcm9wZXJ0eVRyYWNrKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNhc2UgImFuZ2xlIjoKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBOUy5BbmdsZVR5cGVBZGFwdGVyLkludGVycG9sYXRlKHRpbWUsIHN0YXJ0LCBlbmQsIHByb3BlcnR5VHJhY2spCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2FzZSAiYm9vbGVhbiI6CiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gTlMuQm9vbGVhblR5cGVBZGFwdGVyLkludGVycG9sYXRlKHRpbWUsIHN0YXJ0LCBlbmQsIHByb3BlcnR5VHJhY2spCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2FzZSAiY29sb3IiOgogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE5TLkNvbG9yVHlwZUFkYXB0ZXIuSW50ZXJwb2xhdGUodGltZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0LCBlbmQsIHByb3BlcnR5VHJhY2spCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2FzZSAidGV4dCI6CiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gTlMuVGV4dFR5cGVBZGFwdGVyLkludGVycG9sYXRlKHRpbWUsIHN0YXJ0LCBlbmQsIHByb3BlcnR5VHJhY2spCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIF9DcmVhdGVQcm9wZXJ0eUFkYXB0ZXIoKSB7CiAgICAgICAgICAgIGNvbnN0IHB0ID0gdGhpcy5fcHJvcGVydHlUcmFjazsKICAgICAgICAgICAgY29uc3QgdHlwZSA9IHB0LkNhbkhhdmVQcm9wZXJ0eUtleWZyYW1lcygpID8gcHQuR2V0UHJvcGVydHlLZXlmcmFtZVR5cGUoKSA6ICIiOwogICAgICAgICAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgICAgICAgICAgIGNhc2UgImNvbWJvIjoKICAgICAgICAgICAgICAgIGNhc2UgImJvb2xlYW4iOgogICAgICAgICAgICAgICAgY2FzZSAidGV4dCI6CiAgICAgICAgICAgICAgICBjYXNlICJzdHJpbmciOgogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBOUy5Qcm9wZXJ0eUludGVycG9sYXRpb25BZGFwdGVyLk5vSW50ZXJwb2xhdGlvbkFkYXB0ZXIodGhpcykKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjYXNlICJudW1lcmljIjoKICAgICAgICAgICAgICAgIGNhc2UgIm51bWJlciI6CiAgICAgICAgICAgICAgICBjYXNlICJhbmdsZSI6CiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fcHJvcGVydHlUcmFjay5HZXRQcm9wZXJ0eVR5cGUoKSA9PT0gImNvbWJvIikgcmV0dXJuIG5ldyBOUy5Qcm9wZXJ0eUludGVycG9sYXRpb25BZGFwdGVyLk5vSW50ZXJwb2xhdGlvbkFkYXB0ZXIodGhpcyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgTlMuUHJvcGVydHlJbnRlcnBvbGF0aW9uQWRhcHRlci5OdW1lcmljSW50ZXJwb2xhdGlvbkFkYXB0ZXIodGhpcykKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjYXNlICJjb2xvciI6CiAgICAgICAgICAgICAgICBjYXNlICJvZmZzZXRDb2xvciI6CiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IE5TLlByb3BlcnR5SW50ZXJwb2xhdGlvbkFkYXB0ZXIuQ29sb3JJbnRlcnBvbGF0aW9uQWRhcHRlcih0aGlzKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IE5TLlByb3BlcnR5SW50ZXJwb2xhdGlvbkFkYXB0ZXIuTnVtZXJpY0ludGVycG9sYXRpb25BZGFwdGVyKHRoaXMpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIF9TYXZlVG9Kc29uKCkgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgInByb3BlcnR5QWRhcHRlckpzb24iOiB0aGlzLkdldFByb3BlcnR5QWRhcHRlcigpLl9TYXZlVG9Kc29uKCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBfTG9hZEZyb21Kc29uKG8pIHsKICAgICAgICAgICAgaWYgKCFvKSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuR2V0UHJvcGVydHlBZGFwdGVyKCkuX0xvYWRGcm9tSnNvbihvWyJwcm9wZXJ0eUFkYXB0ZXJKc29uIl0pCiAgICAgICAgfQogICAgfTsKCn0KCi8vIHRpbWVsaW5lcy9zdGF0ZS9wcm9wZXJ0eVNvdXJjZUFkYXB0ZXJzL2luc3RhbmNlVmFyaWFibGVTb3VyY2VBZGFwdGVyLmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIGNvbnN0IElOREVYID0gMDsKICAgIGNsYXNzIEluc3RhbmNlVmFyaWFibGVTb3VyY2VBZGFwdGVyIGV4dGVuZHMgQzMuUHJvcGVydHlUcmFja1N0YXRlLlByb3BlcnR5U291cmNlQWRhcHRlciB7CiAgICAgICAgY29uc3RydWN0b3IocHJvcGVydHlUcmFjaykgewogICAgICAgICAgICBzdXBlcihwcm9wZXJ0eVRyYWNrKTsKICAgICAgICAgICAgdGhpcy5fdXBkYXRlZEluZGV4ID0gTmFOCiAgICAgICAgfQogICAgICAgIEdldEVkaXRvckluZGV4KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fcHJvcGVydHlUcmFjay5HZXRQcm9wZXJ0eVRyYWNrRGF0YUl0ZW0oKS5HZXRTb3VyY2VBZGFwdGVyQXJndW1lbnRzKClbSU5ERVhdCiAgICAgICAgfQogICAgICAgIEdldEluZGV4KCkgewogICAgICAgICAgICBpZiAodGhpcy5fdXBkYXRlZEluZGV4KSByZXR1cm4gdGhpcy5fdXBkYXRlZEluZGV4OwogICAgICAgICAgICByZXR1cm4gc3VwZXIuR2V0SW5kZXgoKQogICAgICAgIH0KICAgICAgICBHZXRUYXJnZXQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9wcm9wZXJ0eVRyYWNrLkdldFRyYWNrKCkuR2V0SW5zdGFuY2UoKQogICAgICAgIH0KICAgICAgICBVcGRhdGVJbnN0YW5jZVZhcmlhYmxlSW5kZXgoaW5kZXgpIHsKICAgICAgICAgICAgY29uc3QgaSA9IHRoaXMuX3Byb3BlcnR5VHJhY2suR2V0UHJvcGVydHlUcmFja0RhdGFJdGVtKCkuR2V0U291cmNlQWRhcHRlckFyZ3VtZW50cygpW0lOREVYXTsKICAgICAgICAgICAgaWYgKGkgPT09CiAgICAgICAgICAgICAgICBpbmRleCkgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl91cGRhdGVkSW5kZXggPSBpbmRleAogICAgICAgIH0KICAgICAgICBJbnRlcnBvbGF0ZSh0aW1lLCBzdGFydCwgZW5kLCBzZXRUaW1lLCBlbnN1cmVWYWx1ZSkgewogICAgICAgICAgICBpZiAoIXRoaXMuR2V0UHJvcGVydHlBZGFwdGVyKCkuQ2FuQ2hhbmdlKHN0YXJ0LkdldFZhbHVlKCkpKSByZXR1cm47CiAgICAgICAgICAgIHN1cGVyLkludGVycG9sYXRlKHRpbWUsIHN0YXJ0LCBlbmQsIHNldFRpbWUsIGVuc3VyZVZhbHVlKQogICAgICAgIH0KICAgICAgICBHZXRJbnRlcnBvbGF0ZWRWYWx1ZSh0aW1lLCBzdGFydCwgZW5kKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5HZXRQcm9wZXJ0eUFkYXB0ZXIoKS5DYW5DaGFuZ2Uoc3RhcnQuR2V0VmFsdWUoKSkpIHJldHVybjsKICAgICAgICAgICAgcmV0dXJuIHN1cGVyLkdldEludGVycG9sYXRlZFZhbHVlKHRpbWUsIHN0YXJ0LCBlbmQpCiAgICAgICAgfQogICAgICAgIF9TYXZlVG9Kc29uKCkgewogICAgICAgICAgICByZXR1cm4gT2JqZWN0LmFzc2lnbihzdXBlci5fU2F2ZVRvSnNvbigpLCB7CiAgICAgICAgICAgICAgICAiaW5kZXgiOiB0aGlzLl91cGRhdGVkSW5kZXgKICAgICAgICAgICAgfSkKICAgICAgICB9CiAgICAgICAgX0xvYWRGcm9tSnNvbihvKSB7CiAgICAgICAgICAgIGlmICghbykgcmV0dXJuOwogICAgICAgICAgICBzdXBlci5fTG9hZEZyb21Kc29uKG8pOwogICAgICAgICAgICB0aGlzLl91cGRhdGVkSW5kZXggPQogICAgICAgICAgICAgICAgb1siaW5kZXgiXQogICAgICAgIH0KICAgIH0KICAgIEMzLlByb3BlcnR5VHJhY2tTdGF0ZS5JbnN0YW5jZVZhcmlhYmxlU291cmNlQWRhcHRlciA9IEluc3RhbmNlVmFyaWFibGVTb3VyY2VBZGFwdGVyOwoKfQoKLy8gdGltZWxpbmVzL3N0YXRlL3Byb3BlcnR5U291cmNlQWRhcHRlcnMvYmVoYXZpb3JTb3VyY2VBZGFwdGVyLmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIGNvbnN0IFNJRCA9IDA7CiAgICBjb25zdCBJTkRFWCA9IDE7CiAgICBjb25zdCBOQU1FID0gMjsKICAgIGNsYXNzIEJlaGF2aW9yU291cmNlQWRhcHRlciBleHRlbmRzIEMzLlByb3BlcnR5VHJhY2tTdGF0ZS5Qcm9wZXJ0eVNvdXJjZUFkYXB0ZXIgewogICAgICAgIGNvbnN0cnVjdG9yKHByb3BlcnR5VHJhY2spIHsKICAgICAgICAgICAgc3VwZXIocHJvcGVydHlUcmFjayk7CiAgICAgICAgICAgIHRoaXMuX3NpZCA9IE5hTgogICAgICAgIH0KICAgICAgICBHZXRFZGl0b3JJbmRleCgpIHsKICAgICAgICAgICAgY29uc3QgZGF0YUl0ZW0gPSB0aGlzLl9wcm9wZXJ0eVRyYWNrLkdldFByb3BlcnR5VHJhY2tEYXRhSXRlbSgpOwogICAgICAgICAgICByZXR1cm4gZGF0YUl0ZW0uR2V0U291cmNlQWRhcHRlckFyZ3VtZW50cygpW0lOREVYXQogICAgICAgIH0KICAgICAgICBHZXRUYXJnZXQoKSB7CiAgICAgICAgICAgIGNvbnN0IGRhdGFJdGVtID0gdGhpcy5fcHJvcGVydHlUcmFjay5HZXRQcm9wZXJ0eVRyYWNrRGF0YUl0ZW0oKTsKICAgICAgICAgICAgY29uc3QgdHJhY2sgPSB0aGlzLl9wcm9wZXJ0eVRyYWNrLkdldFRyYWNrKCk7CiAgICAgICAgICAgIGNvbnN0IHNpZCA9IHRoaXMuX3NpZCA/IHRoaXMuX3NpZCA6IGRhdGFJdGVtLkdldFNvdXJjZUFkYXB0ZXJBcmd1bWVudHMoKVtTSURdOwogICAgICAgICAgICBjb25zdCBpbnN0YW5jZSA9IHRyYWNrLkdldEluc3RhbmNlKCk7CiAgICAgICAgICAgIGNvbnN0IGluZGV4ID0KICAgICAgICAgICAgICAgIGluc3RhbmNlLkdldEJlaGF2aW9ySW5kZXhCeVNJRChzaWQpOwogICAgICAgICAgICBjb25zdCBiZWhhdmlvckluc3RhbmNlID0gaW5zdGFuY2UuR2V0QmVoYXZpb3JJbnN0YW5jZXMoKVtpbmRleF07CiAgICAgICAgICAgIHJldHVybiBiZWhhdmlvckluc3RhbmNlLkdldFNka0luc3RhbmNlKCkKICAgICAgICB9CiAgICAgICAgR2V0QmVoYXZpb3JUeXBlKG9iamVjdENsYXNzKSB7CiAgICAgICAgICAgIGNvbnN0IGRhdGFJdGVtID0gdGhpcy5fcHJvcGVydHlUcmFjay5HZXRQcm9wZXJ0eVRyYWNrRGF0YUl0ZW0oKTsKICAgICAgICAgICAgY29uc3QgbmFtZSA9IGRhdGFJdGVtLkdldFNvdXJjZUFkYXB0ZXJBcmd1bWVudHMoKVtOQU1FXTsKICAgICAgICAgICAgcmV0dXJuIG9iamVjdENsYXNzLkdldEJlaGF2aW9yVHlwZUJ5TmFtZShuYW1lKQogICAgICAgIH0KICAgICAgICBVcGRhdGVCZWhhdmlvclR5cGVTaWQoc2lkKSB7CiAgICAgICAgICAgIGNvbnN0IGRhdGFJdGVtID0gdGhpcy5fcHJvcGVydHlUcmFjay5HZXRQcm9wZXJ0eVRyYWNrRGF0YUl0ZW0oKTsKICAgICAgICAgICAgaWYgKGRhdGFJdGVtLkdldFNvdXJjZUFkYXB0ZXJBcmd1bWVudHMoKVtTSURdID09PSBzaWQpIHJldHVybjsKICAgICAgICAgICAgdGhpcy5fc2lkID0gc2lkCiAgICAgICAgfQogICAgICAgIEludGVycG9sYXRlKHRpbWUsCiAgICAgICAgICAgIHN0YXJ0LCBlbmQsIHNldFRpbWUsIGVuc3VyZVZhbHVlKSB7CiAgICAgICAgICAgIGNvbnN0IHRyYWNrID0gdGhpcy5fcHJvcGVydHlUcmFjay5HZXRUcmFjaygpOwogICAgICAgICAgICBjb25zdCBpbnN0YW5jZSA9IHRyYWNrLkdldEluc3RhbmNlKCk7CiAgICAgICAgICAgIGlmICghdGhpcy5HZXRCZWhhdmlvclR5cGUoaW5zdGFuY2UuR2V0T2JqZWN0Q2xhc3MoKSkpIHJldHVybjsKICAgICAgICAgICAgc3VwZXIuSW50ZXJwb2xhdGUodGltZSwgc3RhcnQsIGVuZCwgc2V0VGltZSwgZW5zdXJlVmFsdWUpCiAgICAgICAgfQogICAgICAgIEdldEludGVycG9sYXRlZFZhbHVlKHRpbWUsIHN0YXJ0LCBlbmQpIHsKICAgICAgICAgICAgY29uc3QgdHJhY2sgPSB0aGlzLl9wcm9wZXJ0eVRyYWNrLkdldFRyYWNrKCk7CiAgICAgICAgICAgIGNvbnN0IGluc3RhbmNlID0gdHJhY2suR2V0SW5zdGFuY2UoKTsKICAgICAgICAgICAgaWYgKCF0aGlzLkdldEJlaGF2aW9yVHlwZShpbnN0YW5jZS5HZXRPYmplY3RDbGFzcygpKSkgcmV0dXJuOwogICAgICAgICAgICByZXR1cm4gc3VwZXIuR2V0SW50ZXJwb2xhdGVkVmFsdWUodGltZSwgc3RhcnQsIGVuZCkKICAgICAgICB9CiAgICAgICAgX1NhdmVUb0pzb24oKSB7CiAgICAgICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKHN1cGVyLl9TYXZlVG9Kc29uKCksIHsKICAgICAgICAgICAgICAgICJzaWQiOiB0aGlzLl9zaWQKICAgICAgICAgICAgfSkKICAgICAgICB9CiAgICAgICAgX0xvYWRGcm9tSnNvbihvKSB7CiAgICAgICAgICAgIGlmICghbykgcmV0dXJuOwogICAgICAgICAgICBzdXBlci5fTG9hZEZyb21Kc29uKG8pOwogICAgICAgICAgICB0aGlzLl9zaWQgPSBvWyJzaWQiXQogICAgICAgIH0KICAgIH0KICAgIEMzLlByb3BlcnR5VHJhY2tTdGF0ZS5CZWhhdmlvclNvdXJjZUFkYXB0ZXIgPSBCZWhhdmlvclNvdXJjZUFkYXB0ZXI7Cgp9CgovLyB0aW1lbGluZXMvc3RhdGUvcHJvcGVydHlTb3VyY2VBZGFwdGVycy9lZmZlY3RTb3VyY2VBZGFwdGVyLmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIGNvbnN0IE5BTUUgPSAwOwogICAgY29uc3QgSU5ERVggPSAxOwogICAgY2xhc3MgRWZmZWN0U291cmNlQWRhcHRlciBleHRlbmRzIEMzLlByb3BlcnR5VHJhY2tTdGF0ZS5Qcm9wZXJ0eVNvdXJjZUFkYXB0ZXIgewogICAgICAgIGNvbnN0cnVjdG9yKHByb3BlcnR5VHJhY2spIHsKICAgICAgICAgICAgc3VwZXIocHJvcGVydHlUcmFjaykKICAgICAgICB9CiAgICAgICAgR2V0RWRpdG9ySW5kZXgoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9wcm9wZXJ0eVRyYWNrLkdldFByb3BlcnR5VHJhY2tEYXRhSXRlbSgpLkdldFNvdXJjZUFkYXB0ZXJBcmd1bWVudHMoKVtJTkRFWF0KICAgICAgICB9CiAgICAgICAgR2V0VGFyZ2V0KCkgewogICAgICAgICAgICBjb25zdCBwVHJhY2sgPSB0aGlzLl9wcm9wZXJ0eVRyYWNrOwogICAgICAgICAgICBjb25zdCB0cmFjayA9IHBUcmFjay5HZXRUcmFjaygpOwogICAgICAgICAgICBjb25zdCB3b3JsZEluZm8gPSB0cmFjay5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgY29uc3QgaW5zdGFuY2VFZmZlY3RMaXN0ID0gd29ybGRJbmZvLkdldEluc3RhbmNlRWZmZWN0TGlzdCgpOwogICAgICAgICAgICBjb25zdCBlZmZlY3RMaXN0ID0gaW5zdGFuY2VFZmZlY3RMaXN0LkdldEVmZmVjdExpc3QoKTsKICAgICAgICAgICAgY29uc3QgZWZmZWN0VHlwZSA9IHRoaXMuR2V0RWZmZWN0VHlwZShlZmZlY3RMaXN0KTsKICAgICAgICAgICAgY29uc3QgZWZmZWN0SW5kZXggPSBlZmZlY3RUeXBlLkdldEluZGV4KCk7CiAgICAgICAgICAgIGlmIChpbnN0YW5jZUVmZmVjdExpc3QuSXNFZmZlY3RJbmRleEFjdGl2ZShlZmZlY3RJbmRleCkpIHJldHVybiBpbnN0YW5jZUVmZmVjdExpc3QuR2V0RWZmZWN0UGFyYW1ldGVyc0ZvckluZGV4KGVmZmVjdEluZGV4KTsKICAgICAgICAgICAgcmV0dXJuIG51bGwKICAgICAgICB9CiAgICAgICAgR2V0RWZmZWN0VHlwZShlZmZlY3RMaXN0KSB7CiAgICAgICAgICAgIGNvbnN0IHBUcmFjayA9IHRoaXMuX3Byb3BlcnR5VHJhY2s7CiAgICAgICAgICAgIGNvbnN0IG5hbWUgPSBwVHJhY2suR2V0UHJvcGVydHlUcmFja0RhdGFJdGVtKCkuR2V0U291cmNlQWRhcHRlckFyZ3VtZW50cygpW05BTUVdOwogICAgICAgICAgICByZXR1cm4gZWZmZWN0TGlzdC5HZXRFZmZlY3RUeXBlQnlOYW1lKG5hbWUpCiAgICAgICAgfQogICAgICAgIEludGVycG9sYXRlKHRpbWUsIHN0YXJ0LCBlbmQsIHNldFRpbWUsIGVuc3VyZVZhbHVlKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5fSXNFZmZlY3RBY3RpdmUoKSkgcmV0dXJuOwogICAgICAgICAgICBzdXBlci5JbnRlcnBvbGF0ZSh0aW1lLCBzdGFydCwgZW5kLCBzZXRUaW1lLCBlbnN1cmVWYWx1ZSkKICAgICAgICB9CiAgICAgICAgR2V0SW50ZXJwb2xhdGVkVmFsdWUodGltZSwKICAgICAgICAgICAgc3RhcnQsIGVuZCkgewogICAgICAgICAgICBpZiAoIXRoaXMuX0lzRWZmZWN0QWN0aXZlKCkpIHJldHVybjsKICAgICAgICAgICAgcmV0dXJuIHN1cGVyLkdldEludGVycG9sYXRlZFZhbHVlKHRpbWUsIHN0YXJ0LCBlbmQpCiAgICAgICAgfQogICAgICAgIF9Jc0VmZmVjdEFjdGl2ZSgpIHsKICAgICAgICAgICAgY29uc3QgcFRyYWNrID0gdGhpcy5fcHJvcGVydHlUcmFjazsKICAgICAgICAgICAgY29uc3QgdHJhY2sgPSBwVHJhY2suR2V0VHJhY2soKTsKICAgICAgICAgICAgY29uc3Qgd29ybGRJbmZvID0gdHJhY2suR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgIGNvbnN0IGluc3RhbmNlRWZmZWN0TGlzdCA9IHdvcmxkSW5mby5HZXRJbnN0YW5jZUVmZmVjdExpc3QoKTsKICAgICAgICAgICAgY29uc3QgZWZmZWN0TGlzdCA9IGluc3RhbmNlRWZmZWN0TGlzdC5HZXRFZmZlY3RMaXN0KCk7CiAgICAgICAgICAgIGNvbnN0IGVmZmVjdFR5cGUgPSB0aGlzLkdldEVmZmVjdFR5cGUoZWZmZWN0TGlzdCk7CiAgICAgICAgICAgIGlmICghZWZmZWN0VHlwZSkgcmV0dXJuOwogICAgICAgICAgICBjb25zdCBlZmZlY3RJbmRleCA9IGVmZmVjdFR5cGUuR2V0SW5kZXgoKTsKICAgICAgICAgICAgcmV0dXJuIGluc3RhbmNlRWZmZWN0TGlzdC5Jc0VmZmVjdEluZGV4QWN0aXZlKGVmZmVjdEluZGV4KQogICAgICAgIH0KICAgIH0KICAgIEMzLlByb3BlcnR5VHJhY2tTdGF0ZS5FZmZlY3RTb3VyY2VBZGFwdGVyID0gRWZmZWN0U291cmNlQWRhcHRlcjsKCn0KCi8vIHRpbWVsaW5lcy9zdGF0ZS9wcm9wZXJ0eVNvdXJjZUFkYXB0ZXJzL3BsdWdpblNvdXJjZUFkYXB0ZXIuanMKewogICAgJ3VzZSBzdHJpY3QnOwogICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgY29uc3QgSU5ERVggPSAwOwogICAgY2xhc3MgUGx1Z2luU291cmNlQWRhcHRlciBleHRlbmRzIEMzLlByb3BlcnR5VHJhY2tTdGF0ZS5Qcm9wZXJ0eVNvdXJjZUFkYXB0ZXIgewogICAgICAgIGNvbnN0cnVjdG9yKHByb3BlcnR5VHJhY2spIHsKICAgICAgICAgICAgc3VwZXIocHJvcGVydHlUcmFjaykKICAgICAgICB9CiAgICAgICAgR2V0RWRpdG9ySW5kZXgoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9wcm9wZXJ0eVRyYWNrLkdldFByb3BlcnR5VHJhY2tEYXRhSXRlbSgpLkdldFNvdXJjZUFkYXB0ZXJBcmd1bWVudHMoKVtJTkRFWF0KICAgICAgICB9CiAgICAgICAgR2V0VGFyZ2V0KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fcHJvcGVydHlUcmFjay5HZXRUcmFjaygpLkdldEluc3RhbmNlKCkuR2V0U2RrSW5zdGFuY2UoKQogICAgICAgIH0KICAgICAgICBJbnRlcnBvbGF0ZSh0aW1lLCBzdGFydCwgZW5kLCBzZXRUaW1lLCBlbnN1cmVWYWx1ZSkgewogICAgICAgICAgICBjb25zdCB0cmFjayA9IHRoaXMuX3Byb3BlcnR5VHJhY2suR2V0VHJhY2soKTsKICAgICAgICAgICAgY29uc3QgdGVtcGxhdGVQbHVnaW4gPSB0cmFjay5HZXRPYmplY3RDbGFzcygpLkdldFBsdWdpbigpOwogICAgICAgICAgICBjb25zdCBjdXJyZW50UGx1Z2luID0gdHJhY2suR2V0SW5zdGFuY2UoKS5HZXRPYmplY3RDbGFzcygpLkdldFBsdWdpbigpOwogICAgICAgICAgICBpZiAodGVtcGxhdGVQbHVnaW4gIT09IGN1cnJlbnRQbHVnaW4pIHJldHVybjsKICAgICAgICAgICAgc3VwZXIuSW50ZXJwb2xhdGUodGltZSwgc3RhcnQsIGVuZCwgc2V0VGltZSwgZW5zdXJlVmFsdWUpCiAgICAgICAgfQogICAgICAgIEdldEludGVycG9sYXRlZFZhbHVlKHRpbWUsIHN0YXJ0LCBlbmQpIHsKICAgICAgICAgICAgY29uc3QgdHJhY2sgPSB0aGlzLl9wcm9wZXJ0eVRyYWNrLkdldFRyYWNrKCk7CiAgICAgICAgICAgIGNvbnN0IHRlbXBsYXRlUGx1Z2luID0gdHJhY2suR2V0T2JqZWN0Q2xhc3MoKS5HZXRQbHVnaW4oKTsKICAgICAgICAgICAgY29uc3QgY3VycmVudFBsdWdpbiA9IHRyYWNrLkdldEluc3RhbmNlKCkuR2V0T2JqZWN0Q2xhc3MoKS5HZXRQbHVnaW4oKTsKICAgICAgICAgICAgaWYgKHRlbXBsYXRlUGx1Z2luICE9PSBjdXJyZW50UGx1Z2luKSByZXR1cm47CiAgICAgICAgICAgIHJldHVybiBzdXBlci5HZXRJbnRlcnBvbGF0ZWRWYWx1ZSh0aW1lLCBzdGFydCwgZW5kKQogICAgICAgIH0KICAgICAgICBHZXRPcHRpb25hbENhbGxiYWNrcygpIHsKICAgICAgICAgICAgY29uc3QgdHJhY2sgPSB0aGlzLl9wcm9wZXJ0eVRyYWNrLkdldFRyYWNrKCk7CiAgICAgICAgICAgIGNvbnN0IHBsdWdpbiA9IHRyYWNrLkdldE9iamVjdENsYXNzKCkuR2V0UGx1Z2luKCk7CiAgICAgICAgICAgIGlmIChwbHVnaW4gaW5zdGFuY2VvZiBDMy5QbHVnaW5zLlNwcml0ZSkKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9wcm9wZXJ0eVRyYWNrLkdldFByb3BlcnR5TmFtZSgpID09PSAiaW5pdGlhbC1mcmFtZSIgfHwgdGhpcy5fcHJvcGVydHlUcmFjay5HZXRQcm9wZXJ0eU5hbWUoKSA9PT0gImluaXRpYWwtYW5pbWF0aW9uIikgc3dpdGNoICh0aGlzLl9wcm9wZXJ0eVRyYWNrLkdldFJlc3VsdE1vZGUoKSkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgInJlbGF0aXZlIjoKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGwKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGNhc2UgImFic29sdXRlIjoKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGwKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIEMzLlByb3BlcnR5VHJhY2tTdGF0ZS5QbHVnaW5Tb3VyY2VBZGFwdGVyID0gUGx1Z2luU291cmNlQWRhcHRlcjsKCn0KCi8vIHRpbWVsaW5lcy9zdGF0ZS9wcm9wZXJ0eVNvdXJjZUFkYXB0ZXJzL3ZhbHVlU291cmNlQWRhcHRlci5qcwp7CiAgICAndXNlIHN0cmljdCc7CiAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICBjbGFzcyBWYWx1ZVNvdXJjZUFkYXB0ZXIgZXh0ZW5kcyBDMy5Qcm9wZXJ0eVRyYWNrU3RhdGUuUHJvcGVydHlTb3VyY2VBZGFwdGVyIHsKICAgICAgICBjb25zdHJ1Y3Rvcihwcm9wZXJ0eVRyYWNrKSB7CiAgICAgICAgICAgIHN1cGVyKHByb3BlcnR5VHJhY2spOwogICAgICAgICAgICB0aGlzLl92YWx1ZSA9IDA7CiAgICAgICAgICAgIHRoaXMuX2luaXQgPSBmYWxzZQogICAgICAgIH0KICAgICAgICBNYXlOZWVkQmVmb3JlQW5kQWZ0ZXJJbnRlcnBvbGF0ZSgpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgfQogICAgICAgIFNldEluaXRpYWxTdGF0ZSgpIHsKICAgICAgICAgICAgY29uc3QgcHJvcGVydHlUcmFja0RhdGEgPSB0aGlzLl9wcm9wZXJ0eVRyYWNrLkdldFByb3BlcnR5VHJhY2tEYXRhKCk7CiAgICAgICAgICAgIGxldCBwcm9wZXJ0eVRyYWNrRGF0YUl0ZW0gPSB0aGlzLl9wcm9wZXJ0eVRyYWNrLkdldFByb3BlcnR5VHJhY2tEYXRhSXRlbSgpOwogICAgICAgICAgICBwcm9wZXJ0eVRyYWNrRGF0YUl0ZW0gPSBwcm9wZXJ0eVRyYWNrRGF0YS5HZXRGaXJzdFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbShwcm9wZXJ0eVRyYWNrRGF0YUl0ZW0pOwogICAgICAgICAgICB0aGlzLl92YWx1ZSA9IHByb3BlcnR5VHJhY2tEYXRhSXRlbS5HZXRWYWx1ZVdpdGhSZXN1bHRNb2RlKCkKICAgICAgICB9CiAgICAgICAgU2V0UmVzdW1lU3RhdGUoKSB7fQogICAgICAgIEdldFZhbHVlKCkgewogICAgICAgICAgICBpZiAoIXRoaXMuX2luaXQpIHRoaXMuX3Byb3BlcnR5VHJhY2suSW50ZXJwb2xhdGUoMCk7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl92YWx1ZQogICAgICAgIH0KICAgICAgICBJbnRlcnBvbGF0ZSh0aW1lLAogICAgICAgICAgICBzdGFydCwgZW5kLCBzZXRUaW1lLCBlbnN1cmVWYWx1ZSkgewogICAgICAgICAgICB0aGlzLl92YWx1ZSA9IEMzLlByb3BlcnR5VHJhY2tTdGF0ZS5OdW1lcmljVHlwZUFkYXB0ZXIuSW50ZXJwb2xhdGUodGltZSwgc3RhcnQsIGVuZCwgdGhpcy5fcHJvcGVydHlUcmFjayk7CiAgICAgICAgICAgIHRoaXMuX2luaXQgPSB0cnVlCiAgICAgICAgfQogICAgICAgIFNhdmVTdGF0ZSgpIHt9CiAgICAgICAgQ2xlYXJTYXZlU3RhdGUoKSB7fQogICAgICAgIEdldEN1cnJlbnRTdGF0ZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3ZhbHVlCiAgICAgICAgfQogICAgICAgIENvbXBhcmVJbml0aWFsU3RhdGVXaXRoQ3VycmVudCgpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgfQogICAgICAgIENvbXBhcmVTYXZlU3RhdGVXaXRoQ3VycmVudCgpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgfQogICAgICAgIF9TYXZlVG9Kc29uKCkgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgInZhbHVlIjogdGhpcy5fdmFsdWUsCiAgICAgICAgICAgICAgICAiaW5pdCI6IHRoaXMuX2luaXQKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBfTG9hZEZyb21Kc29uKG8pIHsKICAgICAgICAgICAgaWYgKCFvKSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuX3ZhbHVlID0gb1sidmFsdWUiXTsKICAgICAgICAgICAgdGhpcy5faW5pdCA9IG8uaGFzT3duUHJvcGVydHkoImluaXQiKSA/IG9bImluaXQiXSA6IHRydWUKICAgICAgICB9CiAgICB9CiAgICBDMy5Qcm9wZXJ0eVRyYWNrU3RhdGUuVmFsdWVTb3VyY2VBZGFwdGVyID0gVmFsdWVTb3VyY2VBZGFwdGVyOwoKfQoKLy8gdGltZWxpbmVzL3N0YXRlL3Byb3BlcnR5U291cmNlQWRhcHRlcnMvYXVkaW9Tb3VyY2VBZGFwdGVyLmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIGNvbnN0IFBST0pFQ1RfRklMRSA9IDA7CiAgICBjb25zdCBQUk9KRUNUX0ZJTEVfTkFNRSA9IDA7CiAgICBjb25zdCBQUk9KRUNUX0ZJTEVfVFlQRSA9IDE7CiAgICBjb25zdCBTVEFSVF9PRkZTRVQgPSAxOwogICAgY29uc3QgQVVESU9fRFVSQVRJT04gPSAyOwogICAgY29uc3QgQVVESU9fVEFHID0gMzsKICAgIGNsYXNzIEF1ZGlvU291cmNlQWRhcHRlciBleHRlbmRzIEMzLlByb3BlcnR5VHJhY2tTdGF0ZS5Qcm9wZXJ0eVNvdXJjZUFkYXB0ZXIgewogICAgICAgIGNvbnN0cnVjdG9yKHByb3BlcnR5VHJhY2spIHsKICAgICAgICAgICAgc3VwZXIocHJvcGVydHlUcmFjayk7CiAgICAgICAgICAgIHRoaXMuX2F1ZGlvUGxheWJhY2tTdGFydGVkID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX3Nka0luc3RhbmNlID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fYWN0aW9ucyA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX2V4cHJlc3Npb25zID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fdGltZWxpbmUgPSB0aGlzLl9wcm9wZXJ0eVRyYWNrLkdldFRpbWVsaW5lKCk7CiAgICAgICAgICAgIHRoaXMuX3RyYWNrID0gdGhpcy5fcHJvcGVydHlUcmFjay5HZXRUcmFjaygpOwogICAgICAgICAgICB0aGlzLl9zb3VyY2VBZGFwdGVyQXJncyA9IHRoaXMuX3Byb3BlcnR5VHJhY2suR2V0U291cmNlQWRhcHRlckFyZ3MoKTsKICAgICAgICAgICAgdGhpcy5fZmlsZUFyZ3MgPSB0aGlzLl9zb3VyY2VBZGFwdGVyQXJnc1tQUk9KRUNUX0ZJTEVdOwogICAgICAgICAgICB0aGlzLl9zdGFydE9mZnNldFRpbWUgPSB0aGlzLl9zb3VyY2VBZGFwdGVyQXJnc1tTVEFSVF9PRkZTRVRdOwogICAgICAgICAgICBpZiAodGhpcy5fc291cmNlQWRhcHRlckFyZ3NbQVVESU9fVEFHXSkgdGhpcy5fYXVkaW9UYWcgPQogICAgICAgICAgICAgICAgdGhpcy5fc291cmNlQWRhcHRlckFyZ3NbQVVESU9fVEFHXTsKICAgICAgICAgICAgZWxzZSB0aGlzLl9hdWRpb1RhZyA9IE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnNsaWNlKDIpOwogICAgICAgICAgICB0aGlzLl9wYXVzZVRpbWUgPSBOYU47CiAgICAgICAgICAgIHRoaXMuX3BhdXNlVm9sdW1lID0gTmFOOwogICAgICAgICAgICB0aGlzLl92b2x1bWUgPSBOYU47CiAgICAgICAgICAgIHRoaXMuX2F1ZGlvU291cmNlID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fSW5pdGlhbGl6ZSgpCiAgICAgICAgfQogICAgICAgIFJlbGVhc2UoKSB7CiAgICAgICAgICAgIHN1cGVyLlJlbGVhc2UoKTsKICAgICAgICAgICAgdGhpcy5fc2RrSW5zdGFuY2UgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9hY3Rpb25zID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fZXhwcmVzc2lvbnMgPSBudWxsOwogICAgICAgICAgICB0aGlzLl90aW1lbGluZSA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3RyYWNrID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fc291cmNlQWRhcHRlckFyZ3MgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9maWxlQXJncyA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX2F1ZGlvU291cmNlID0gbnVsbAogICAgICAgIH0KICAgICAgICBfSW5pdGlhbGl6ZSgpIHsKICAgICAgICAgICAgaWYgKCFzZWxmLkMzLlBsdWdpbnMuQXVkaW8pIHJldHVybjsKICAgICAgICAgICAgY29uc3QgcnVudGltZSA9IHRoaXMuX3Byb3BlcnR5VHJhY2suR2V0UnVudGltZSgpOwogICAgICAgICAgICBjb25zdCBhdWRpb09iamVjdENsYXNzID0KICAgICAgICAgICAgICAgIHJ1bnRpbWUuR2V0T2JqZWN0Q2xhc3NCeU5hbWUoImF1ZGlvIik7CiAgICAgICAgICAgIGlmIChhdWRpb09iamVjdENsYXNzKSB0aGlzLl9zZGtJbnN0YW5jZSA9IGF1ZGlvT2JqZWN0Q2xhc3MuR2V0U2luZ2xlR2xvYmFsSW5zdGFuY2UoKS5HZXRTZGtJbnN0YW5jZSgpOwogICAgICAgICAgICB0aGlzLl9hY3Rpb25zID0gc2VsZi5DMy5QbHVnaW5zLkF1ZGlvLkFjdHM7CiAgICAgICAgICAgIHRoaXMuX2V4cHJlc3Npb25zID0gc2VsZi5DMy5QbHVnaW5zLkF1ZGlvLkV4cHMKICAgICAgICB9CiAgICAgICAgX01heWJlU2V0QXVkaW9Tb3VyY2UoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9hdWRpb1NvdXJjZSkgcmV0dXJuOwogICAgICAgICAgICBjb25zdCB0cmFjayA9IHRoaXMuX3Byb3BlcnR5VHJhY2suR2V0VHJhY2soKTsKICAgICAgICAgICAgY29uc3QgYXVkaW9Tb3VyY2VQcm9wZXJ0eVRyYWNrID0gdHJhY2suR2V0UHJvcGVydHlUcmFjaygiYXVkaW9Tb3VyY2UiKTsKICAgICAgICAgICAgaWYgKGF1ZGlvU291cmNlUHJvcGVydHlUcmFjaykgdGhpcy5fYXVkaW9Tb3VyY2UgPSBhdWRpb1NvdXJjZVByb3BlcnR5VHJhY2suR2V0U291cmNlQWRhcHRlcigpCiAgICAgICAgfQogICAgICAgIF9HZXRQYXVzZVZvbHVtZSgpIHsKICAgICAgICAgICAgY29uc3QgdHJhY2sgPQogICAgICAgICAgICAgICAgdGhpcy5fcHJvcGVydHlUcmFjay5HZXRUcmFjaygpOwogICAgICAgICAgICBjb25zdCB2b2x1bWVQcm9wZXJ0eVRyYWNrID0gdHJhY2suR2V0UHJvcGVydHlUcmFjaygidm9sdW1lIik7CiAgICAgICAgICAgIGlmICh2b2x1bWVQcm9wZXJ0eVRyYWNrKSByZXR1cm4gdm9sdW1lUHJvcGVydHlUcmFjay5HZXRTb3VyY2VBZGFwdGVyKCkuX3BhdXNlVm9sdW1lOwogICAgICAgICAgICBlbHNlIHJldHVybiB0aGlzLl9wYXVzZVZvbHVtZQogICAgICAgIH0KICAgICAgICBUaW1lbGluZVJlbW92ZWQoKSB7CiAgICAgICAgICAgIHN1cGVyLlRpbWVsaW5lUmVtb3ZlZCgpOwogICAgICAgICAgICB0aGlzLl9hdWRpb1BsYXliYWNrU3RhcnRlZCA9IGZhbHNlOwogICAgICAgICAgICBpZiAodGhpcy5fc2RrSW5zdGFuY2UpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9leHByZXNzaW9ucykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX3BhdXNlVGltZSA9IHRoaXMuX2V4cHJlc3Npb25zLlBsYXliYWNrVGltZS5jYWxsKHRoaXMuX3Nka0luc3RhbmNlLCB0aGlzLl9hdWRpb1RhZyk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcGF1c2VWb2x1bWUgPSB0aGlzLl9leHByZXNzaW9ucy5Wb2x1bWUuY2FsbCh0aGlzLl9zZGtJbnN0YW5jZSwgdGhpcy5fYXVkaW9UYWcpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fYWN0aW9ucykgdGhpcy5fYWN0aW9ucy5TdG9wLmNhbGwodGhpcy5fc2RrSW5zdGFuY2UsCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYXVkaW9UYWcpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgR2V0QXVkaW9UYWcoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9hdWRpb1RhZwogICAgICAgIH0KICAgICAgICBHZXRWb2x1bWUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl92b2x1bWUKICAgICAgICB9CiAgICAgICAgU2V0Vm9sdW1lKHYpIHsKICAgICAgICAgICAgdGhpcy5fdm9sdW1lID0gdgogICAgICAgIH0KICAgICAgICBTZXRJbml0aWFsU3RhdGUoKSB7CiAgICAgICAgICAgIHN1cGVyLlNldEluaXRpYWxTdGF0ZSgpOwogICAgICAgICAgICB0aGlzLl9wYXVzZVRpbWUgPSBOYU47CiAgICAgICAgICAgIHRoaXMuX2F1ZGlvUGxheWJhY2tTdGFydGVkID0gZmFsc2UKICAgICAgICB9CiAgICAgICAgU2V0UmVzdW1lU3RhdGUoKSB7CiAgICAgICAgICAgIHN1cGVyLlNldFJlc3VtZVN0YXRlKCk7CiAgICAgICAgICAgIGNvbnN0IHRpbWVsaW5lID0gdGhpcy5fcHJvcGVydHlUcmFjay5HZXRUaW1lbGluZSgpOwogICAgICAgICAgICBjb25zdCB0aW1lID0gdGltZWxpbmUuR2V0VGltZSgpOwogICAgICAgICAgICB0aGlzLl9wYXVzZVRpbWUgPSB0aW1lIC0gdGhpcy5fc3RhcnRPZmZzZXRUaW1lOwogICAgICAgICAgICBzd2l0Y2ggKHRoaXMuX3Byb3BlcnR5VHJhY2suR2V0UHJvcGVydHlOYW1lKCkpIHsKICAgICAgICAgICAgICAgIGNhc2UgImF1ZGlvU291cmNlIjoKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2FzZSAidm9sdW1lIjoKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3BhdXNlVm9sdW1lID0gdGhpcy5fcHJvcGVydHlUcmFjay5HZXRJbnRlcnBvbGF0ZWRWYWx1ZSh0aW1lKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5fYXVkaW9QbGF5YmFja1N0YXJ0ZWQgPSBmYWxzZQogICAgICAgIH0KICAgICAgICBJbnRlcnBvbGF0ZSh0aW1lLCBzdGFydCwgZW5kLCBzZXRUaW1lLCBlbnN1cmVWYWx1ZSkgewogICAgICAgICAgICBpZiAoIXRoaXMuX3Nka0luc3RhbmNlKSByZXR1cm47CiAgICAgICAgICAgIHN3aXRjaCAodGhpcy5fcHJvcGVydHlUcmFjay5HZXRQcm9wZXJ0eU5hbWUoKSkgewogICAgICAgICAgICAgICAgY2FzZSAiYXVkaW9Tb3VyY2UiOgogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLl90aW1lbGluZS5Jc0ZvcndhcmRQbGF5QmFjaygpKSByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZXRUaW1lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fYWN0aW9ucykgdGhpcy5fYWN0aW9ucy5TdG9wLmNhbGwodGhpcy5fc2RrSW5zdGFuY2UsIHRoaXMuX2F1ZGlvVGFnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aW1lIDwgdGhpcy5fc3RhcnRPZmZzZXRUaW1lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9hdWRpb1BsYXliYWNrU3RhcnRlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYVBsYXliYWNrUmF0ZSA9IHRoaXMuX2V4cHJlc3Npb25zLlBsYXliYWNrUmF0ZS5jYWxsKHRoaXMuX3Nka0luc3RhbmNlLCB0aGlzLl9hdWRpb1RhZyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRQbGF5YmFja1JhdGUgPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGltZWxpbmUuR2V0UGxheWJhY2tSYXRlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0UGxheWJhY2tSYXRlICE9PSBhUGxheWJhY2tSYXRlKSB0aGlzLl9hY3Rpb25zLlNldFBsYXliYWNrUmF0ZS5jYWxsKHRoaXMuX3Nka0luc3RhbmNlLCB0aGlzLl9hdWRpb1RhZywgdFBsYXliYWNrUmF0ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9hdWRpb1BsYXliYWNrU3RhcnRlZCkgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX3Byb3BlcnR5VHJhY2suR2V0VGltZWxpbmUoKS5Jc1BsYXlpbmcoKSkgcmV0dXJuO3RoaXMuX2F1ZGlvUGxheWJhY2tTdGFydGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzTmFOKHRoaXMuX3BhdXNlVGltZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRoZW5UaW1lID0gc2VsZlsicGVyZm9ybWFuY2UiXS5ub3coKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0RGVsdGFUaW1lID0gdGltZSAtIHRoaXMuX3N0YXJ0T2Zmc2V0VGltZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0YXRlID0gdGhpcy5fc2RrSW5zdGFuY2UuR2V0QXVkaW9Db250ZXh0U3RhdGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdGF0ZSA9PT0gInN1c3BlbmRlZCIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9hdWRpb1BsYXliYWNrU3RhcnRlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgbm93VGltZSA9IHNlbGZbInBlcmZvcm1hbmNlIl0ubm93KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwb3N0VG9ET01EZWx0YVRpbWUgPSAobm93VGltZSAtIHRoZW5UaW1lKSAvIDFFMzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0UGxheWJhY2tPZmZzZXQgPSBzdGFydERlbHRhVGltZSArIHBvc3RUb0RPTURlbHRhVGltZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9hY3Rpb25zKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHN0YXJ0Vm9sdW1lID0gdGhpcy5HZXRWb2x1bWUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNOYU4oc3RhcnRWb2x1bWUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuU2V0Vm9sdW1lKDApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydFZvbHVtZSA9IDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgdGhpcy5TZXRWb2x1bWUoc3RhcnRWb2x1bWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2FjdGlvbnMuUGxheUZyb21UaW1lbGluZS5jYWxsKHRoaXMuX3Nka0luc3RhbmNlLCB0aGlzLl9maWxlQXJncywgc3RhcnRWb2x1bWUsIHRoaXMuX2F1ZGlvVGFnLCBzdGFydFBsYXliYWNrT2Zmc2V0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RhcnRUaW1lID0gdGhpcy5fcGF1c2VUaW1lOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcGF1c2VUaW1lID0gTmFOOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RhcnRWb2x1bWUgPSB0aGlzLl9HZXRQYXVzZVZvbHVtZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcGF1c2VWb2x1bWUgPSBOYU47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzdGF0ZSA9IHRoaXMuX3Nka0luc3RhbmNlLkdldEF1ZGlvQ29udGV4dFN0YXRlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RhdGUgPT09ICJzdXNwZW5kZWQiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fYXVkaW9QbGF5YmFja1N0YXJ0ZWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9hY3Rpb25zKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5TZXRWb2x1bWUoc3RhcnRWb2x1bWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2FjdGlvbnMuUGxheUZyb21UaW1lbGluZS5jYWxsKHRoaXMuX3Nka0luc3RhbmNlLCB0aGlzLl9maWxlQXJncywgc3RhcnRWb2x1bWUsIHRoaXMuX2F1ZGlvVGFnLCBzdGFydFRpbWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjYXNlICJ2b2x1bWUiOgogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fTWF5YmVTZXRBdWRpb1NvdXJjZSgpO3N1cGVyLkludGVycG9sYXRlKHRpbWUsIHN0YXJ0LCBlbmQsIHNldFRpbWUsIGVuc3VyZVZhbHVlKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBHZXRJbnRlcnBvbGF0ZWRWYWx1ZSh0aW1lLCBzdGFydCwgZW5kKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5fc2RrSW5zdGFuY2UpIHJldHVybjsKICAgICAgICAgICAgc3dpdGNoICh0aGlzLl9wcm9wZXJ0eVRyYWNrLkdldFByb3BlcnR5TmFtZSgpKSB7CiAgICAgICAgICAgICAgICBjYXNlICJhdWRpb1NvdXJjZSI6CiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjYXNlICJ2b2x1bWUiOgogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fTWF5YmVTZXRBdWRpb1NvdXJjZSgpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3VwZXIuR2V0SW50ZXJwb2xhdGVkVmFsdWUodGltZSwgc3RhcnQsIGVuZCkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgR2V0dGVyKHdpLCB0cmFjaykgewogICAgICAgICAgICBpZiAodGhpcy5fYXVkaW9Tb3VyY2UpIHJldHVybiB0aGlzLl9hdWRpb1NvdXJjZS5HZXRWb2x1bWUoKTsKICAgICAgICAgICAgcmV0dXJuIDAKICAgICAgICB9CiAgICAgICAgU2V0dGVyKHdpLCB2YWx1ZSwgdHJhY2ssIGludGVycG9sYXRpb25BZGFwdGVyKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9hdWRpb1NvdXJjZSkgdGhpcy5fYXVkaW9Tb3VyY2UuU2V0Vm9sdW1lKHRoaXMuR2V0dGVyKCkgKyB2YWx1ZSk7CiAgICAgICAgICAgIGlmICh0aGlzLl9hY3Rpb25zICYmIHRoaXMuX2F1ZGlvU291cmNlKSB0aGlzLl9hY3Rpb25zLlNldFZvbHVtZS5jYWxsKHRoaXMuX3Nka0luc3RhbmNlLCB0aGlzLl9hdWRpb1NvdXJjZS5HZXRBdWRpb1RhZygpLCB0aGlzLl9hdWRpb1NvdXJjZS5HZXRWb2x1bWUoKSkKICAgICAgICB9CiAgICAgICAgQWJzb2x1dGVTZXR0ZXIod2ksIHZhbHVlLCB0cmFjaykgewogICAgICAgICAgICBpZiAodGhpcy5fYXVkaW9Tb3VyY2UpIHRoaXMuX2F1ZGlvU291cmNlLlNldFZvbHVtZSh2YWx1ZSk7CiAgICAgICAgICAgIGlmICh0aGlzLl9hY3Rpb25zICYmCiAgICAgICAgICAgICAgICB0aGlzLl9hdWRpb1NvdXJjZSkgdGhpcy5fYWN0aW9ucy5TZXRWb2x1bWUuY2FsbCh0aGlzLl9zZGtJbnN0YW5jZSwgdGhpcy5fYXVkaW9Tb3VyY2UuR2V0QXVkaW9UYWcoKSwgdGhpcy5fYXVkaW9Tb3VyY2UuR2V0Vm9sdW1lKCkpCiAgICAgICAgfQogICAgICAgIERvZXNSb3VuZGluZygpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICB9CiAgICAgICAgX1NhdmVUb0pzb24oKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAiYXVkaW9QbGF5YmFja1N0YXJ0ZWQiOiB0aGlzLl9hdWRpb1BsYXliYWNrU3RhcnRlZCwKICAgICAgICAgICAgICAgICJhdWRpb1RhZyI6IHRoaXMuX2F1ZGlvVGFnLAogICAgICAgICAgICAgICAgInBhdXNlVGltZSI6IHRoaXMuX3BhdXNlVGltZSwKICAgICAgICAgICAgICAgICJwYXVzZVZvbHVtZSI6IHRoaXMuX3BhdXNlVm9sdW1lLAogICAgICAgICAgICAgICAgInZvbHVtZSI6IHRoaXMuX3ZvbHVtZQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIF9Mb2FkRnJvbUpzb24obykgewogICAgICAgICAgICBpZiAoIW8pIHJldHVybjsKICAgICAgICAgICAgdGhpcy5fYXVkaW9QbGF5YmFja1N0YXJ0ZWQgPSBvWyJhdWRpb1BsYXliYWNrU3RhcnRlZCJdOwogICAgICAgICAgICB0aGlzLl9hdWRpb1RhZyA9IG9bImF1ZGlvVGFnIl07CiAgICAgICAgICAgIHRoaXMuX3BhdXNlVGltZSA9IG9bInBhdXNlVGltZSJdOwogICAgICAgICAgICB0aGlzLl9wYXVzZVZvbHVtZSA9IG9bInBhdXNlVm9sdW1lIl07CiAgICAgICAgICAgIHRoaXMuX3ZvbHVtZSA9IG9bInZvbHVtZSJdOwogICAgICAgICAgICB0aGlzLl9Jbml0aWFsaXplKCkKICAgICAgICB9CiAgICB9CiAgICBDMy5Qcm9wZXJ0eVRyYWNrU3RhdGUuQXVkaW9Tb3VyY2VBZGFwdGVyID0gQXVkaW9Tb3VyY2VBZGFwdGVyOwoKfQoKLy8gdGltZWxpbmVzL3N0YXRlL3Byb3BlcnR5SW50ZXJwb2xhdGlvbkFkYXB0ZXJzL3Byb3BlcnR5SW50ZXJwb2xhdGlvbkFkYXB0ZXIuanMKewogICAgJ3VzZSBzdHJpY3QnOwogICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgQzMuUHJvcGVydHlUcmFja1N0YXRlLlByb3BlcnR5SW50ZXJwb2xhdGlvbkFkYXB0ZXIgPSBjbGFzcyBQcm9wZXJ0eUludGVycG9sYXRpb25BZGFwdGVyIHsKICAgICAgICBjb25zdHJ1Y3Rvcihzb3VyY2VBZGFwdGVyKSB7CiAgICAgICAgICAgIHRoaXMuX3NvdXJjZUFkYXB0ZXIgPSBzb3VyY2VBZGFwdGVyOwogICAgICAgICAgICB0aGlzLl9wcm9wZXJ0eVRyYWNrID0gc291cmNlQWRhcHRlci5HZXRQcm9wZXJ0eVRyYWNrKCk7CiAgICAgICAgICAgIHRoaXMuX3dvcmxkSW5mbyA9IHRoaXMuX3Byb3BlcnR5VHJhY2suR2V0VHJhY2soKS5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgdGhpcy5fcHJvcGVydHkgPSB0aGlzLl9wcm9wZXJ0eVRyYWNrLkdldFByb3BlcnR5TmFtZSgpOwogICAgICAgICAgICB0aGlzLl9maXJzdEFic29sdXRlVXBkYXRlID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX3NhdmVTdGF0ZSA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3RhcmdldCA9IG51bGwKICAgICAgICB9CiAgICAgICAgUmVsZWFzZSgpIHsKICAgICAgICAgICAgdGhpcy5fc291cmNlQWRhcHRlciA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3Byb3BlcnR5VHJhY2sgPSBudWxsOwogICAgICAgICAgICB0aGlzLl93b3JsZEluZm8gPSBudWxsOwogICAgICAgICAgICB0aGlzLl9zYXZlU3RhdGUgPSBudWxsOwogICAgICAgICAgICB0aGlzLl90YXJnZXQgPQogICAgICAgICAgICAgICAgbnVsbAogICAgICAgIH0KICAgICAgICBNYXlOZWVkQmVmb3JlQW5kQWZ0ZXJJbnRlcnBvbGF0ZSgpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgfQogICAgICAgIFRpbWVsaW5lUmVtb3ZlZCgpIHt9CiAgICAgICAgQ2xlYW5DYWNoZXMoKSB7CiAgICAgICAgICAgIHRoaXMuX3dvcmxkSW5mbyA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3NhdmVTdGF0ZSA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3RhcmdldCA9IG51bGwKICAgICAgICB9CiAgICAgICAgR2V0U291cmNlQWRhcHRlcigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NvdXJjZUFkYXB0ZXIKICAgICAgICB9CiAgICAgICAgR2V0UHJvcGVydHlUcmFjaygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3Byb3BlcnR5VHJhY2sKICAgICAgICB9CiAgICAgICAgR2V0V29ybGRJbmZvKCkgewogICAgICAgICAgICBpZiAodGhpcy5fd29ybGRJbmZvKSByZXR1cm4gdGhpcy5fd29ybGRJbmZvOwogICAgICAgICAgICB0aGlzLl93b3JsZEluZm8gPSB0aGlzLl9wcm9wZXJ0eVRyYWNrLkdldFRyYWNrKCkuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl93b3JsZEluZm8KICAgICAgICB9CiAgICAgICAgU2V0Rmlyc3RBYnNvbHV0ZVVwZGF0ZShmKSB7CiAgICAgICAgICAgIHRoaXMuX2ZpcnN0QWJzb2x1dGVVcGRhdGUgPSAhIWYKICAgICAgICB9CiAgICAgICAgR2V0Rmlyc3RBYnNvbHV0ZVVwZGF0ZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2ZpcnN0QWJzb2x1dGVVcGRhdGUKICAgICAgICB9CiAgICAgICAgU2V0UmVzZXRTdGF0ZSgpIHt9CiAgICAgICAgU2V0SW5pdGlhbFN0YXRlKCkge30KICAgICAgICBTZXRSZXN1bWVTdGF0ZSgpIHt9CiAgICAgICAgU2V0U2F2ZVN0YXRlKCkgewogICAgICAgICAgICB0aGlzLl9zYXZlU3RhdGUgPQogICAgICAgICAgICAgICAgdGhpcy5HZXRDdXJyZW50U3RhdGUoKQogICAgICAgIH0KICAgICAgICBDbGVhclNhdmVTdGF0ZSgpIHsKICAgICAgICAgICAgdGhpcy5fc2F2ZVN0YXRlID0gbnVsbAogICAgICAgIH0KICAgICAgICBHZXRDdXJyZW50U3RhdGUoKSB7fQogICAgICAgIENvbXBhcmVJbml0aWFsU3RhdGVXaXRoQ3VycmVudCgpIHt9CiAgICAgICAgQ29tcGFyZVNhdmVTdGF0ZVdpdGhDdXJyZW50KCkge30KICAgICAgICBDYW5DaGFuZ2UodmFsdWUpIHsKICAgICAgICAgICAgY29uc3QgdGFyZ2V0VHlwZSA9IHR5cGVvZiB0aGlzLl9HZXR0ZXIoKTsKICAgICAgICAgICAgY29uc3QgbmV3VHlwZSA9IHR5cGVvZiB2YWx1ZTsKICAgICAgICAgICAgcmV0dXJuIHRhcmdldFR5cGUgPT09IG5ld1R5cGUKICAgICAgICB9CiAgICAgICAgQmVmb3JlQ2hhbmdlUHJvcGVydHkoKSB7fQogICAgICAgIENoYW5nZVByb3BlcnR5KHRpbWUsIHZhbHVlLCBzdGFydCwgZW5kLCBzZXRUaW1lLCBlbnN1cmVWYWx1ZSwgZW5kU3RhdGUpIHt9CiAgICAgICAgQWZ0ZXJDaGFuZ2VQcm9wZXJ0eSgpIHt9CiAgICAgICAgX0ZpcnN0S2V5ZnJhbWVHZXR0ZXIoKSB7CiAgICAgICAgICAgIGNvbnN0IHByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbSA9IHRoaXMuX1BpY2tUaW1lbGluZVBsYXliYWNrTW9kZSgoKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBwcm9wZXJ0eVRyYWNrRGF0YUl0ZW0gPSB0aGlzLl9wcm9wZXJ0eVRyYWNrLkdldFByb3BlcnR5VHJhY2tEYXRhSXRlbSgpOwogICAgICAgICAgICAgICAgY29uc3QgcHJvcGVydHlUcmFja0RhdGEgPSB0aGlzLl9wcm9wZXJ0eVRyYWNrLkdldFByb3BlcnR5VHJhY2tEYXRhKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gcHJvcGVydHlUcmFja0RhdGEuR2V0Rmlyc3RQcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW0ocHJvcGVydHlUcmFja0RhdGFJdGVtKQogICAgICAgICAgICB9LCAoKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBwcm9wZXJ0eVRyYWNrRGF0YUl0ZW0gPSB0aGlzLl9wcm9wZXJ0eVRyYWNrLkdldFByb3BlcnR5VHJhY2tEYXRhSXRlbSgpOwogICAgICAgICAgICAgICAgY29uc3QgcHJvcGVydHlUcmFja0RhdGEgPSB0aGlzLl9wcm9wZXJ0eVRyYWNrLkdldFByb3BlcnR5VHJhY2tEYXRhKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gcHJvcGVydHlUcmFja0RhdGEuR2V0TGFzdFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbShwcm9wZXJ0eVRyYWNrRGF0YUl0ZW0pCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXR1cm4gcHJvcGVydHlLZXlmcmFtZURhdGFJdGVtLkdldEFic29sdXRlVmFsdWUoKQogICAgICAgIH0KICAgICAgICBfQ3VycmVudEtleWZyYW1lR2V0dGVyKCkgewogICAgICAgICAgICBjb25zdCB0aW1lbGluZSA9IHRoaXMuX3Byb3BlcnR5VHJhY2suR2V0VGltZWxpbmUoKTsKICAgICAgICAgICAgY29uc3QgdGltZSA9IHRpbWVsaW5lLkdldFRpbWUoKSAtIHRoaXMuX3Byb3BlcnR5VHJhY2suR2V0VHJhY2soKS5HZXRTdGFydE9mZnNldCgpOwogICAgICAgICAgICBjb25zdCBwcm9wZXJ0eUtleWZyYW1lID0gdGhpcy5fUGlja1RpbWVsaW5lUGxheWJhY2tNb2RlKCgpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IHByb3BlcnR5VHJhY2tEYXRhSXRlbSA9IHRoaXMuX3Byb3BlcnR5VHJhY2suR2V0UHJvcGVydHlUcmFja0RhdGFJdGVtKCk7CiAgICAgICAgICAgICAgICBjb25zdCBwcm9wZXJ0eVRyYWNrRGF0YSA9IHRoaXMuX3Byb3BlcnR5VHJhY2suR2V0UHJvcGVydHlUcmFja0RhdGEoKTsKICAgICAgICAgICAgICAgIHJldHVybiBwcm9wZXJ0eVRyYWNrRGF0YS5HZXRGaXJzdFByb3BlcnR5S2V5RnJhbWVEYXRhSXRlbUxvd2VyT3JFcXVhbFRoYW4odGltZSwgcHJvcGVydHlUcmFja0RhdGFJdGVtKQogICAgICAgICAgICB9LCAoKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBwcm9wZXJ0eVRyYWNrRGF0YUl0ZW0gPSB0aGlzLl9wcm9wZXJ0eVRyYWNrLkdldFByb3BlcnR5VHJhY2tEYXRhSXRlbSgpOwogICAgICAgICAgICAgICAgY29uc3QgcHJvcGVydHlUcmFja0RhdGEgPSB0aGlzLl9wcm9wZXJ0eVRyYWNrLkdldFByb3BlcnR5VHJhY2tEYXRhKCk7CiAgICAgICAgICAgICAgICBjb25zdCByZXQgPSBwcm9wZXJ0eVRyYWNrRGF0YS5HZXRGaXJzdFByb3BlcnR5S2V5RnJhbWVEYXRhSXRlbUhpZ2hlck9yRXF1YWxUaGFuKHRpbWUsIHByb3BlcnR5VHJhY2tEYXRhSXRlbSk7CiAgICAgICAgICAgICAgICBpZiAoIXJldCkgcmV0dXJuIHByb3BlcnR5VHJhY2tEYXRhLkdldExhc3RQcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW0ocHJvcGVydHlUcmFja0RhdGFJdGVtKTsKICAgICAgICAgICAgICAgIHJldHVybiByZXQKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiBwcm9wZXJ0eUtleWZyYW1lLkdldEFic29sdXRlVmFsdWUoKQogICAgICAgIH0KICAgICAgICBfUGlja1RpbWVsaW5lUGxheWJhY2tNb2RlKGZvcndhcmRGdW5jLCBiYWNrd2FyZEZ1bmMpIHsKICAgICAgICAgICAgY29uc3QgdGltZWxpbmUgPSB0aGlzLl9wcm9wZXJ0eVRyYWNrLkdldFRpbWVsaW5lKCk7CiAgICAgICAgICAgIHJldHVybiB0aW1lbGluZS5Jc0ZvcndhcmRQbGF5QmFjaygpID8gZm9yd2FyZEZ1bmMoKSA6IGJhY2t3YXJkRnVuYygpCiAgICAgICAgfQogICAgICAgIF9QaWNrUmVzdWx0TW9kZShyZWxhdGl2ZUZ1bmMsIGFic29sdXRlRnVuYykgewogICAgICAgICAgICBjb25zdCByZXN1bHRNb2RlID0gdGhpcy5fcHJvcGVydHlUcmFjay5HZXRSZXN1bHRNb2RlKCk7CiAgICAgICAgICAgIHJldHVybiByZXN1bHRNb2RlID09PSAicmVsYXRpdmUiID8gcmVsYXRpdmVGdW5jKCkgOiBhYnNvbHV0ZUZ1bmMoKQogICAgICAgIH0KICAgICAgICBfUGlja0ZpcnN0QWJzb2x1dGVVcGRhdGUoZmlyc3RGdW5jLCBvdGhlckZ1bmMpIHsKICAgICAgICAgICAgaWYgKHRoaXMuR2V0Rmlyc3RBYnNvbHV0ZVVwZGF0ZSgpKSB7CiAgICAgICAgICAgICAgICB0aGlzLlNldEZpcnN0QWJzb2x1dGVVcGRhdGUoZmFsc2UpOwogICAgICAgICAgICAgICAgcmV0dXJuIGZpcnN0RnVuYygpCiAgICAgICAgICAgIH0gZWxzZSByZXR1cm4gb3RoZXJGdW5jKCkKICAgICAgICB9CiAgICAgICAgX0dldEFic29sdXRlSW5pdGlhbFZhbHVlKGtleWZyYW1lVmFsdWUpIHt9CiAgICAgICAgX0dldEluZGV4KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fc291cmNlQWRhcHRlci5HZXRJbmRleCgpCiAgICAgICAgfQogICAgICAgIF9HZXRUYXJnZXQoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl90YXJnZXQpIHJldHVybiB0aGlzLl90YXJnZXQ7CiAgICAgICAgICAgIHRoaXMuX3RhcmdldCA9IHRoaXMuX3NvdXJjZUFkYXB0ZXIuR2V0VGFyZ2V0KCk7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl90YXJnZXQKICAgICAgICB9CiAgICAgICAgX1BpY2tTb3VyY2UoYkZ1bmMsIGVGdW5jLCBpdkZ1bmMsIHBGdW5jLCB3aUZ1bmMsIGFGdW5jKSB7CiAgICAgICAgICAgIGNvbnN0IGlkID0gdGhpcy5fcHJvcGVydHlUcmFjay5HZXRTb3VyY2VBZGFwdGVySWQoKTsKICAgICAgICAgICAgc3dpdGNoIChpZCkgewogICAgICAgICAgICAgICAgY2FzZSAiYmVoYXZpb3IiOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBiRnVuYygpOwogICAgICAgICAgICAgICAgY2FzZSAiZWZmZWN0IjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZUZ1bmMoKTsKICAgICAgICAgICAgICAgIGNhc2UgImluc3RhbmNlLXZhcmlhYmxlIjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXZGdW5jKCk7CiAgICAgICAgICAgICAgICBjYXNlICJwbHVnaW4iOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBwRnVuYygpOwogICAgICAgICAgICAgICAgY2FzZSAid29ybGQtaW5zdGFuY2UiOgogICAgICAgICAgICAgICAgICAgIHJldHVybiB3aUZ1bmMoKTsKICAgICAgICAgICAgICAgIGNhc2UgImF1ZGlvIjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYUZ1bmMoKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIF9TYXZlVG9Kc29uKCkgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgImZpcnN0QWJzb2x1dGVVcGRhdGUiOiB0aGlzLl9maXJzdEFic29sdXRlVXBkYXRlLAogICAgICAgICAgICAgICAgInNhdmVTdGF0ZSI6IHRoaXMuX3NhdmVTdGF0ZQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIF9Mb2FkRnJvbUpzb24obykgewogICAgICAgICAgICBpZiAoIW8pIHJldHVybjsKICAgICAgICAgICAgdGhpcy5fZmlyc3RBYnNvbHV0ZVVwZGF0ZSA9IG9bImZpcnN0QWJzb2x1dGVVcGRhdGUiXTsKICAgICAgICAgICAgdGhpcy5fc2F2ZVN0YXRlID0gb1sic2F2ZVN0YXRlIl0KICAgICAgICB9CiAgICAgICAgX0dldFByb3BlcnR5S2V5ZnJhbWVTdHVicyhwcm9wZXJ0eVRyYWNrcywgZmlyc3RPbmx5ID0gZmFsc2UpIHsKICAgICAgICAgICAgY29uc3QgcmV0ID0gW107CiAgICAgICAgICAgIGZvciAoY29uc3QgcHJvcGVydHlUcmFjayBvZiBwcm9wZXJ0eVRyYWNrcykgewogICAgICAgICAgICAgICAgY29uc3Qgc3RhcnRPZmZzZXQgPQogICAgICAgICAgICAgICAgICAgIHByb3BlcnR5VHJhY2suR2V0VHJhY2soKS5HZXRTdGFydE9mZnNldCgpOwogICAgICAgICAgICAgICAgZm9yIChjb25zdCBwcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW0gb2YgcHJvcGVydHlUcmFjay5HZXRQcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW1zKCkpCiAgICAgICAgICAgICAgICAgICAgaWYgKGZpcnN0T25seSAmJiBwcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW0uR2V0VGltZSgpID09PSAwKSByZXQucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWU6IHN0YXJ0T2Zmc2V0ICsgcHJvcGVydHlLZXlmcmFtZURhdGFJdGVtLkdldFRpbWUoKSwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbS5HZXRBYnNvbHV0ZVZhbHVlKCkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICghZmlyc3RPbmx5KSByZXQucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgdGltZTogc3RhcnRPZmZzZXQgKyBwcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW0uR2V0VGltZSgpLAogICAgICAgICAgICAgICAgICAgIHZhbHVlOiBwcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW0uR2V0QWJzb2x1dGVWYWx1ZSgpCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiByZXQuc29ydCgoZiwgcykgPT4gZi50aW1lIC0gcy50aW1lKQogICAgICAgIH0KICAgICAgICBfR2V0TGFzdFByb3BlcnR5S2V5ZnJhbWVTdHViKHRpbWVsaW5lLAogICAgICAgICAgICB0aW1lLCBwcm9wZXJ0eUtleWZyYW1lU3R1YnMpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX0dldFByb3BlcnR5S2V5ZnJhbWVTdHViTG93ZXJUaGFuUGxheWhlYWQodGltZSwgcHJvcGVydHlLZXlmcmFtZVN0dWJzKQogICAgICAgIH0KICAgICAgICBfR2V0UHJvcGVydHlLZXlmcmFtZVN0dWJMb3dlclRoYW5QbGF5aGVhZCh0aW1lLCBwcm9wZXJ0eUtleWZyYW1lU3R1YnMpIHsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IHByb3BlcnR5S2V5ZnJhbWVTdHVicy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgICAgICAgICAgICAgY29uc3Qgc3R1YlRpbWUgPSBwcm9wZXJ0eUtleWZyYW1lU3R1YnNbaV0udGltZTsKICAgICAgICAgICAgICAgIGlmIChzdHViVGltZSA8PSB0aW1lKSByZXR1cm4gcHJvcGVydHlLZXlmcmFtZVN0dWJzW2ldCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG51bGwKICAgICAgICB9CiAgICB9OwoKfQoKLy8gdGltZWxpbmVzL3N0YXRlL3Byb3BlcnR5SW50ZXJwb2xhdGlvbkFkYXB0ZXJzL2NvbG9ySW50ZXJwb2xhdGlvbkFkYXB0ZXIuanMKewogICAgJ3VzZSBzdHJpY3QnOwogICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgY29uc3QgVE1QX0NPTE9SU19NQVAgPSBuZXcgTWFwOwogICAgY29uc3QgVE1QX0NPTE9SID0gWzAsIDAsIDBdOwogICAgY2xhc3MgQ29sb3JJbnRlcnBvbGF0aW9uQWRhcHRlciBleHRlbmRzIEMzLlByb3BlcnR5VHJhY2tTdGF0ZS5Qcm9wZXJ0eUludGVycG9sYXRpb25BZGFwdGVyIHsKICAgICAgICBjb25zdHJ1Y3Rvcihzb3VyY2VBZGFwdGVyKSB7CiAgICAgICAgICAgIHN1cGVyKHNvdXJjZUFkYXB0ZXIpCiAgICAgICAgfQogICAgICAgIFNldFJlc2V0U3RhdGUoKSB7fQogICAgICAgIFNldEluaXRpYWxTdGF0ZSgpIHt9CiAgICAgICAgU2V0UmVzdW1lU3RhdGUoKSB7fQogICAgICAgIEdldEN1cnJlbnRTdGF0ZSgpIHsKICAgICAgICAgICAgY29uc3QgaWQgPSB0aGlzLl9wcm9wZXJ0eVRyYWNrLkdldFNvdXJjZUFkYXB0ZXJJZCgpOwogICAgICAgICAgICBjb25zdCB0YXJnZXQgPSB0aGlzLl9HZXRUYXJnZXQoKTsKICAgICAgICAgICAgY29uc3QgaW5kZXggPSB0aGlzLl9HZXRJbmRleCgpOwogICAgICAgICAgICBzd2l0Y2ggKGlkKSB7CiAgICAgICAgICAgICAgICBjYXNlICJiZWhhdmlvciI6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX1RvQ29sb3JBcnJheSh0YXJnZXQuR2V0UHJvcGVydHlWYWx1ZUJ5SW5kZXgoaW5kZXgpKTsKICAgICAgICAgICAgICAgIGNhc2UgImVmZmVjdCI6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX1RvQ29sb3JBcnJheSh0YXJnZXRbaW5kZXhdKTsKICAgICAgICAgICAgICAgIGNhc2UgInBsdWdpbiI6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX1RvQ29sb3JBcnJheSh0YXJnZXQuR2V0UHJvcGVydHlWYWx1ZUJ5SW5kZXgoaW5kZXgpKTsKICAgICAgICAgICAgICAgIGNhc2UgIndvcmxkLWluc3RhbmNlIjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fVG9Db2xvckFycmF5KHRoaXMuX0dldHRlcigpKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIENvbXBhcmVJbml0aWFsU3RhdGVXaXRoQ3VycmVudCgpIHsKICAgICAgICAgICAgY29uc3QgZmlyc3RLZXlmcmFtZUNvbG9yID0gdGhpcy5fRmlyc3RLZXlmcmFtZUdldHRlcigpOwogICAgICAgICAgICByZXR1cm4gIXRoaXMuX0NvbXBhcmVDb2xvcnMoZmlyc3RLZXlmcmFtZUNvbG9yLCB0aGlzLl9HZXR0ZXIoKSkKICAgICAgICB9CiAgICAgICAgQ29tcGFyZVNhdmVTdGF0ZVdpdGhDdXJyZW50KCkgewogICAgICAgICAgICBpZiAoQzMuSXNOdWxsT3JVbmRlZmluZWQodGhpcy5fc2F2ZVN0YXRlKSkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICByZXR1cm4gIXRoaXMuX0NvbXBhcmVDb2xvcnModGhpcy5fc2F2ZVN0YXRlLCB0aGlzLl9HZXR0ZXIoKSkKICAgICAgICB9CiAgICAgICAgX0NvbXBhcmVDb2xvcnMoZkNvbG9yLCBzQ29sb3IpIHsKICAgICAgICAgICAgZkNvbG9yID0gdGhpcy5fR2V0Q29sb3JGcm9tQXJyYXkoZkNvbG9yKTsKICAgICAgICAgICAgc0NvbG9yID0gdGhpcy5fR2V0Q29sb3JGcm9tQXJyYXkoc0NvbG9yKTsKICAgICAgICAgICAgcmV0dXJuIGZDb2xvci5lcXVhbHNJZ25vcmluZ0FscGhhKHNDb2xvcikKICAgICAgICB9CiAgICAgICAgX0ZpcnN0S2V5ZnJhbWVHZXR0ZXIoKSB7CiAgICAgICAgICAgIGNvbnN0IGNvbG9yID0KICAgICAgICAgICAgICAgIHN1cGVyLl9GaXJzdEtleWZyYW1lR2V0dGVyKCk7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9HZXRDb2xvckZyb21BcnJheShjb2xvcikKICAgICAgICB9CiAgICAgICAgX0N1cnJlbnRLZXlmcmFtZUdldHRlcigpIHsKICAgICAgICAgICAgY29uc3QgY29sb3IgPSBzdXBlci5fQ3VycmVudEtleWZyYW1lR2V0dGVyKCk7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9HZXRDb2xvckZyb21BcnJheShjb2xvcikKICAgICAgICB9CiAgICAgICAgX0dldEFic29sdXRlSW5pdGlhbFZhbHVlKHZhbHVlKSB7fQogICAgICAgIF9Ub0NvbG9yQXJyYXkoY29sb3IpIHsKICAgICAgICAgICAgaWYgKEMzLklzSW5zdGFuY2VPZihjb2xvciwgQzMuQ29sb3IpKSByZXR1cm4gY29sb3IudG9BcnJheSgpLnNsaWNlKDAsIDMpOwogICAgICAgICAgICByZXR1cm4gY29sb3Iuc2xpY2UoMCwgMykKICAgICAgICB9CiAgICAgICAgX0dldENvbG9yRnJvbUFycmF5KGNvbG9yKSB7CiAgICAgICAgICAgIGlmIChDMy5Jc0luc3RhbmNlT2YoY29sb3IsIEMzLkNvbG9yKSkgcmV0dXJuIGNvbG9yOwogICAgICAgICAgICByZXR1cm4gbmV3IEMzLkNvbG9yKGNvbG9yWzBdLCBjb2xvclsxXSwgY29sb3JbMl0sIDEpCiAgICAgICAgfQogICAgICAgIENhbkNoYW5nZSh2YWx1ZSkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgIH0KICAgICAgICBNYXlOZWVkQmVmb3JlQW5kQWZ0ZXJJbnRlcnBvbGF0ZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICB9CiAgICAgICAgQmVmb3JlQ2hhbmdlUHJvcGVydHkoKSB7CiAgICAgICAgICAgIGNvbnN0IHRpbWVsaW5lID0KICAgICAgICAgICAgICAgIHRoaXMuX3Byb3BlcnR5VHJhY2suR2V0VGltZWxpbmUoKTsKICAgICAgICAgICAgY29uc3QgaW5zdGFuY2UgPSB0aGlzLl9wcm9wZXJ0eVRyYWNrLkdldEluc3RhbmNlKCk7CiAgICAgICAgICAgIGNvbnN0IHNvdXJjZUFkYXB0ZXIgPSB0aGlzLl9wcm9wZXJ0eVRyYWNrLkdldFNvdXJjZUFkYXB0ZXIoKTsKICAgICAgICAgICAgY29uc3QgcHJvcGVydHlUcmFja3MgPSB0aW1lbGluZS5HZXRTaW1pbGFyUHJvcGVydHlUcmFja3MoaW5zdGFuY2UsIHNvdXJjZUFkYXB0ZXIsIHRoaXMuX3Byb3BlcnR5KTsKICAgICAgICAgICAgaWYgKHByb3BlcnR5VHJhY2tzICYmIHByb3BlcnR5VHJhY2tzLmxlbmd0aCA+IDEpIHsKICAgICAgICAgICAgICAgIGlmICghVE1QX0NPTE9SU19NQVAuaGFzKGluc3RhbmNlKSkgVE1QX0NPTE9SU19NQVAuc2V0KGluc3RhbmNlLCBuZXcgTWFwKTsKICAgICAgICAgICAgICAgIGNvbnN0IGluc3RhbmNlTWFwID0gVE1QX0NPTE9SU19NQVAuZ2V0KGluc3RhbmNlKTsKICAgICAgICAgICAgICAgIGNvbnN0IGlkID0gdGhpcy5fcHJvcGVydHlUcmFjay5HZXRTb3VyY2VBZGFwdGVySWQoKTsKICAgICAgICAgICAgICAgIGlmICghaW5zdGFuY2VNYXAuaGFzKGlkKSkgaW5zdGFuY2VNYXAuc2V0KGlkLCBuZXcgTWFwKTsKICAgICAgICAgICAgICAgIGNvbnN0IHNvdXJjZU1hcCA9CiAgICAgICAgICAgICAgICAgICAgaW5zdGFuY2VNYXAuZ2V0KGlkKTsKICAgICAgICAgICAgICAgIGlmICghc291cmNlTWFwLmhhcyh0aGlzLl9wcm9wZXJ0eSkpIHNvdXJjZU1hcC5zZXQodGhpcy5fcHJvcGVydHksIHsKICAgICAgICAgICAgICAgICAgICB1c2VkOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICBjb2xvcjogbmV3IEMzLkNvbG9yKDAsIDAsIDAsIDEpCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIF9HZXRUbXBDb2xvcihpbnN0YW5jZSwgc291cmNlSWQsIHByb3BlcnR5TmFtZSkgewogICAgICAgICAgICBjb25zdCB0bXBDb2xvck9iaiA9IFRNUF9DT0xPUlNfTUFQLmdldChpbnN0YW5jZSkuZ2V0KHNvdXJjZUlkKS5nZXQocHJvcGVydHlOYW1lKTsKICAgICAgICAgICAgdG1wQ29sb3JPYmoudXNlZCA9IHRydWU7CiAgICAgICAgICAgIHJldHVybiB0bXBDb2xvck9iai5jb2xvcgogICAgICAgIH0KICAgICAgICBDaGFuZ2VQcm9wZXJ0eSh0aW1lLCB2YWx1ZSwgc3RhcnQsIGVuZCwgc2V0VGltZSkgewogICAgICAgICAgICBjb25zdCB0aW1lbGluZSA9IHRoaXMuX3Byb3BlcnR5VHJhY2suR2V0VGltZWxpbmUoKTsKICAgICAgICAgICAgY29uc3QgdHJhY2sgPSB0aGlzLl9wcm9wZXJ0eVRyYWNrLkdldFRyYWNrKCk7CiAgICAgICAgICAgIGNvbnN0IGluc3RhbmNlID0gdGhpcy5fcHJvcGVydHlUcmFjay5HZXRJbnN0YW5jZSgpOwogICAgICAgICAgICBjb25zdCBzb3VyY2VBZGFwdGVyID0KICAgICAgICAgICAgICAgIHRoaXMuX3Byb3BlcnR5VHJhY2suR2V0U291cmNlQWRhcHRlcigpOwogICAgICAgICAgICBjb25zdCBzb3VyY2VBZGFwdGVySWQgPSB0aGlzLl9wcm9wZXJ0eVRyYWNrLkdldFNvdXJjZUFkYXB0ZXJJZCgpOwogICAgICAgICAgICBjb25zdCBwcm9wZXJ0eSA9IHRoaXMuX3Byb3BlcnR5OwogICAgICAgICAgICBjb25zdCBwcm9wZXJ0eVRyYWNrcyA9IHRpbWVsaW5lLkdldFNpbWlsYXJQcm9wZXJ0eVRyYWNrcyhpbnN0YW5jZSwgc291cmNlQWRhcHRlciwgcHJvcGVydHkpOwogICAgICAgICAgICBpZiAocHJvcGVydHlUcmFja3MgJiYgcHJvcGVydHlUcmFja3MubGVuZ3RoID4gMSkgewogICAgICAgICAgICAgICAgY29uc3QgcHJvcGVydHlLZXlmcmFtZVN0dWJzID0gdGhpcy5fR2V0UHJvcGVydHlLZXlmcmFtZVN0dWJzKHByb3BlcnR5VHJhY2tzLCB0cnVlKTsKICAgICAgICAgICAgICAgIGNvbnN0IHN0dWIgPSB0aGlzLl9HZXRMYXN0UHJvcGVydHlLZXlmcmFtZVN0dWIodGltZWxpbmUsIHRpbWVsaW5lLkdldFRpbWUoKSwgcHJvcGVydHlLZXlmcmFtZVN0dWJzKTsKICAgICAgICAgICAgICAgIGlmIChzdHViKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RhcnRPZmZzZXQgPSB0cmFjay5HZXRTdGFydE9mZnNldCgpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHQgPSBzdHViLnRpbWUgLQogICAgICAgICAgICAgICAgICAgICAgICBzdGFydE9mZnNldDsKICAgICAgICAgICAgICAgICAgICBpZiAodCA9PT0gMCkgdGhpcy5fR2V0VG1wQ29sb3IoaW5zdGFuY2UsIHNvdXJjZUFkYXB0ZXJJZCwgdGhpcy5fcHJvcGVydHkpLmFkZFJnYih2YWx1ZVswXSwgdmFsdWVbMV0sIHZhbHVlWzJdKTsKICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHQgPCAwKSByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHIgPSB2YWx1ZVswXTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZyA9IHZhbHVlWzFdOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBiID0gdmFsdWVbMl07CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHYgPSB0aGlzLl9wcm9wZXJ0eVRyYWNrLkludGVycG9sYXRlKHQsIGZhbHNlLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZHIgPSBDMy5Db2xvci5EaWZmQ2hhbm5lbChyLCB2WzBdKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZGcgPSBDMy5Db2xvci5EaWZmQ2hhbm5lbChnLCB2WzFdKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZGIgPSBDMy5Db2xvci5EaWZmQ2hhbm5lbChiLCB2WzJdKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fR2V0VG1wQ29sb3IoaW5zdGFuY2UsIHNvdXJjZUFkYXB0ZXJJZCwgdGhpcy5fcHJvcGVydHkpLmFkZFJnYihkciwgZGcsIGRiKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHRoaXMuX1NldHRlcih2YWx1ZVswXSwgdmFsdWVbMV0sIHZhbHVlWzJdKQogICAgICAgIH0KICAgICAgICBBZnRlckNoYW5nZVByb3BlcnR5KCkgewogICAgICAgICAgICBjb25zdCBpbnN0YW5jZSA9CiAgICAgICAgICAgICAgICB0aGlzLl9wcm9wZXJ0eVRyYWNrLkdldEluc3RhbmNlKCk7CiAgICAgICAgICAgIGlmICghVE1QX0NPTE9SU19NQVAuaGFzKGluc3RhbmNlKSkgcmV0dXJuOwogICAgICAgICAgICBjb25zdCBpbnN0YW5jZU1hcCA9IFRNUF9DT0xPUlNfTUFQLmdldChpbnN0YW5jZSk7CiAgICAgICAgICAgIGNvbnN0IGlkID0gdGhpcy5fcHJvcGVydHlUcmFjay5HZXRTb3VyY2VBZGFwdGVySWQoKTsKICAgICAgICAgICAgaWYgKCFpbnN0YW5jZU1hcC5oYXMoaWQpKSByZXR1cm47CiAgICAgICAgICAgIGNvbnN0IHNvdXJjZU1hcCA9IGluc3RhbmNlTWFwLmdldChpZCk7CiAgICAgICAgICAgIGlmICghc291cmNlTWFwLmhhcyh0aGlzLl9wcm9wZXJ0eSkpIHJldHVybjsKICAgICAgICAgICAgY29uc3QgdG1wQ29sb3JPYmogPSBzb3VyY2VNYXAuZ2V0KHRoaXMuX3Byb3BlcnR5KTsKICAgICAgICAgICAgY29uc3QgdXNlZCA9IHRtcENvbG9yT2JqLnVzZWQ7CiAgICAgICAgICAgIGNvbnN0IGNvbG9yID0gdG1wQ29sb3JPYmouY29sb3I7CiAgICAgICAgICAgIGlmICh1c2VkKSB0aGlzLl9TZXR0ZXIoY29sb3IuZ2V0UigpLCBjb2xvci5nZXRHKCksIGNvbG9yLmdldEIoKSk7CiAgICAgICAgICAgIGlmIChzb3VyY2VNYXAuc2l6ZSA9PT0gMCkgaW5zdGFuY2VNYXAuZGVsZXRlKGlkKTsKICAgICAgICAgICAgaWYgKGluc3RhbmNlTWFwLnNpemUgPT09CiAgICAgICAgICAgICAgICAwKSBUTVBfQ09MT1JTX01BUC5kZWxldGUoaW5zdGFuY2UpCiAgICAgICAgfQogICAgICAgIF9HZXR0ZXIoKSB7CiAgICAgICAgICAgIGNvbnN0IGlkID0gdGhpcy5fcHJvcGVydHlUcmFjay5HZXRTb3VyY2VBZGFwdGVySWQoKTsKICAgICAgICAgICAgY29uc3QgdGFyZ2V0ID0gdGhpcy5fR2V0VGFyZ2V0KCk7CiAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5fR2V0SW5kZXgoKTsKICAgICAgICAgICAgc3dpdGNoIChpZCkgewogICAgICAgICAgICAgICAgY2FzZSAiYmVoYXZpb3IiOgogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9HZXRDb2xvckZyb21BcnJheSh0YXJnZXQuR2V0UHJvcGVydHlWYWx1ZUJ5SW5kZXgoaW5kZXgpKTsKICAgICAgICAgICAgICAgIGNhc2UgImVmZmVjdCI6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRhcmdldFtpbmRleF0uY2xvbmUoKTsKICAgICAgICAgICAgICAgIGNhc2UgInBsdWdpbiI6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX0dldENvbG9yRnJvbUFycmF5KHRhcmdldC5HZXRQcm9wZXJ0eVZhbHVlQnlJbmRleChpbmRleCkpOwogICAgICAgICAgICAgICAgY2FzZSAid29ybGQtaW5zdGFuY2UiOgogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLkdldFdvcmxkSW5mbygpLkdldFVucHJlbXVsdGlwbGllZENvbG9yKCkuY2xvbmUoKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIF9TZXR0ZXIociwgZywgYikgewogICAgICAgICAgICBjb25zdCBpZCA9IHRoaXMuX3Byb3BlcnR5VHJhY2suR2V0U291cmNlQWRhcHRlcklkKCk7CiAgICAgICAgICAgIGNvbnN0IHRhcmdldCA9IHRoaXMuX0dldFRhcmdldCgpOwogICAgICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMuX0dldEluZGV4KCk7CiAgICAgICAgICAgIHN3aXRjaCAoaWQpIHsKICAgICAgICAgICAgICAgIGNhc2UgImJlaGF2aW9yIjoKICAgICAgICAgICAgICAgICAgICBUTVBfQ09MT1JbMF0gPSByOwogICAgICAgICAgICAgICAgICAgIFRNUF9DT0xPUlsxXSA9IGc7CiAgICAgICAgICAgICAgICAgICAgVE1QX0NPTE9SWzJdID0gYjsKICAgICAgICAgICAgICAgICAgICB0YXJnZXQuU2V0UHJvcGVydHlWYWx1ZUJ5SW5kZXgoaW5kZXgsIFRNUF9DT0xPUik7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICJlZmZlY3QiOgogICAgICAgICAgICAgICAgICAgIHRhcmdldFtpbmRleF0uc2V0UmdiKHIsIGcsIGIpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAicGx1Z2luIjoKICAgICAgICAgICAgICAgICAgICBUTVBfQ09MT1JbMF0gPSByOwogICAgICAgICAgICAgICAgICAgIFRNUF9DT0xPUlsxXSA9IGc7CiAgICAgICAgICAgICAgICAgICAgVE1QX0NPTE9SWzJdID0gYjsKICAgICAgICAgICAgICAgICAgICB0YXJnZXQuU2V0UHJvcGVydHlWYWx1ZUJ5SW5kZXgoaW5kZXgsIFRNUF9DT0xPUik7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICJ3b3JsZC1pbnN0YW5jZSI6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5HZXRXb3JsZEluZm8oKS5TZXRVbnByZW11bHRpcGxpZWRDb2xvclJHQihyLCBnLCBiKTsKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIF9TYXZlVG9Kc29uKCkge30KICAgICAgICBfTG9hZEZyb21Kc29uKG8pIHt9CiAgICB9CiAgICBDMy5Qcm9wZXJ0eVRyYWNrU3RhdGUuUHJvcGVydHlJbnRlcnBvbGF0aW9uQWRhcHRlci5Db2xvckludGVycG9sYXRpb25BZGFwdGVyID0gQ29sb3JJbnRlcnBvbGF0aW9uQWRhcHRlcjsKCn0KCi8vIHRpbWVsaW5lcy9zdGF0ZS9wcm9wZXJ0eUludGVycG9sYXRpb25BZGFwdGVycy9ub0ludGVycG9sYXRpb25BZGFwdGVyLmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIGNvbnN0IE5TID0gQzMuUHJvcGVydHlUcmFja1N0YXRlOwogICAgY2xhc3MgTm9JbnRlcnBvbGF0aW9uQWRhcHRlciBleHRlbmRzIEMzLlByb3BlcnR5VHJhY2tTdGF0ZS5Qcm9wZXJ0eUludGVycG9sYXRpb25BZGFwdGVyIHsKICAgICAgICBjb25zdHJ1Y3Rvcihzb3VyY2VBZGFwdGVyKSB7CiAgICAgICAgICAgIHN1cGVyKHNvdXJjZUFkYXB0ZXIpCiAgICAgICAgfQogICAgICAgIFNldFJlc2V0U3RhdGUoKSB7fQogICAgICAgIFNldEluaXRpYWxTdGF0ZSgpIHt9CiAgICAgICAgU2V0UmVzdW1lU3RhdGUoKSB7fQogICAgICAgIEdldEN1cnJlbnRTdGF0ZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX0dldHRlcigpCiAgICAgICAgfQogICAgICAgIENvbXBhcmVJbml0aWFsU3RhdGVXaXRoQ3VycmVudCgpIHsKICAgICAgICAgICAgY29uc3QgZmlyc3RLZXlmcmFtZVZhbHVlID0gdGhpcy5fRmlyc3RLZXlmcmFtZUdldHRlcigpOwogICAgICAgICAgICByZXR1cm4gZmlyc3RLZXlmcmFtZVZhbHVlICE9PSB0aGlzLkdldEN1cnJlbnRTdGF0ZSgpCiAgICAgICAgfQogICAgICAgIENvbXBhcmVTYXZlU3RhdGVXaXRoQ3VycmVudCgpIHsKICAgICAgICAgICAgaWYgKEMzLklzTnVsbE9yVW5kZWZpbmVkKHRoaXMuX3NhdmVTdGF0ZSkpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NhdmVTdGF0ZSAhPT0gdGhpcy5HZXRDdXJyZW50U3RhdGUoKQogICAgICAgIH0KICAgICAgICBNYXlOZWVkQmVmb3JlQW5kQWZ0ZXJJbnRlcnBvbGF0ZSgpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgfQogICAgICAgIENoYW5nZVByb3BlcnR5KHRpbWUsCiAgICAgICAgICAgIHZhbHVlLCBzdGFydCwgZW5kLCBzZXRUaW1lKSB7CiAgICAgICAgICAgIGNvbnN0IHByb3BlcnR5VHJhY2sgPSB0aGlzLl9wcm9wZXJ0eVRyYWNrOwogICAgICAgICAgICBjb25zdCB0cmFjayA9IHByb3BlcnR5VHJhY2suR2V0VHJhY2soKTsKICAgICAgICAgICAgY29uc3QgaWQgPSBwcm9wZXJ0eVRyYWNrLkdldFNvdXJjZUFkYXB0ZXJJZCgpOwogICAgICAgICAgICBjb25zdCB0aW1lbGluZSA9IHByb3BlcnR5VHJhY2suR2V0VGltZWxpbmUoKTsKICAgICAgICAgICAgY29uc3QgaW5zdGFuY2UgPSB0cmFjay5HZXRJbnN0YW5jZSgpOwogICAgICAgICAgICBjb25zdCBzb3VyY2VBZGFwdGVyID0gcHJvcGVydHlUcmFjay5HZXRTb3VyY2VBZGFwdGVyKCk7CiAgICAgICAgICAgIGNvbnN0IHByb3BlcnR5ID0gdGhpcy5fcHJvcGVydHk7CiAgICAgICAgICAgIGNvbnN0IHByb3BlcnR5VHJhY2tzID0gdGltZWxpbmUuR2V0U2ltaWxhclByb3BlcnR5VHJhY2tzKGluc3RhbmNlLCBzb3VyY2VBZGFwdGVyLCBwcm9wZXJ0eSk7CiAgICAgICAgICAgIGlmIChwcm9wZXJ0eVRyYWNrcyAmJiBwcm9wZXJ0eVRyYWNrcy5sZW5ndGggPiAxKSB7CiAgICAgICAgICAgICAgICBjb25zdCBwcm9wZXJ0eUtleWZyYW1lU3R1YnMgPSB0aGlzLl9HZXRQcm9wZXJ0eUtleWZyYW1lU3R1YnMocHJvcGVydHlUcmFja3MpOwogICAgICAgICAgICAgICAgY29uc3QgdCA9IHRpbWUgKyB0cmFjay5HZXRTdGFydE9mZnNldCgpOwogICAgICAgICAgICAgICAgY29uc3Qgc3R1YiA9IHRoaXMuX0dldExhc3RQcm9wZXJ0eUtleWZyYW1lU3R1Yih0aW1lbGluZSwgdCwgcHJvcGVydHlLZXlmcmFtZVN0dWJzKTsKICAgICAgICAgICAgICAgIGlmIChzdHViKSB2YWx1ZSA9IHN0dWIudmFsdWUKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCB0eXBlID0gcHJvcGVydHlUcmFjay5HZXRQcm9wZXJ0eUtleWZyYW1lVHlwZSgpOwogICAgICAgICAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgICAgICAgICAgIGNhc2UgIm51bWVyaWMiOgogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFOUy5OdW1lcmljVHlwZUFkYXB0ZXIuV2lsbENoYW5nZSh0aGlzLl9HZXRJbmRleCgpLCB0aGlzLl9HZXRUYXJnZXQoKSwgdmFsdWUsIGlkKSkgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNhc2UgImFuZ2xlIjoKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghTlMuQW5nbGVUeXBlQWRhcHRlci5XaWxsQ2hhbmdlKHRoaXMuX0dldEluZGV4KCksIHRoaXMuX0dldFRhcmdldCgpLCB2YWx1ZSwgaWQpKSByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2FzZSAiYm9vbGVhbiI6CiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIU5TLkJvb2xlYW5UeXBlQWRhcHRlci5XaWxsQ2hhbmdlKHRoaXMuX0dldEluZGV4KCksIHRoaXMuX0dldFRhcmdldCgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlLCBpZCkpIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjYXNlICJjb2xvciI6CiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIU5TLkNvbG9yVHlwZUFkYXB0ZXIuV2lsbENoYW5nZSh0aGlzLl9HZXRJbmRleCgpLCB0aGlzLl9HZXRUYXJnZXQoKSwgdmFsdWUsIGlkKSkgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNhc2UgInRleHQiOgogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFOUy5UZXh0VHlwZUFkYXB0ZXIuV2lsbENoYW5nZSh0aGlzLl9HZXRJbmRleCgpLCB0aGlzLl9HZXRUYXJnZXQoKSwgdmFsdWUsIGlkKSkgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLl9TZXR0ZXIodmFsdWUpCiAgICAgICAgfQogICAgICAgIF9HZXR0ZXIoKSB7CiAgICAgICAgICAgIGNvbnN0IGlkID0gdGhpcy5fcHJvcGVydHlUcmFjay5HZXRTb3VyY2VBZGFwdGVySWQoKTsKICAgICAgICAgICAgY29uc3QgdGFyZ2V0ID0gdGhpcy5fR2V0VGFyZ2V0KCk7CiAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5fR2V0SW5kZXgoKTsKICAgICAgICAgICAgc3dpdGNoIChpZCkgewogICAgICAgICAgICAgICAgY2FzZSAiYmVoYXZpb3IiOgogICAgICAgICAgICAgICAgICAgIHJldHVybiB0YXJnZXQuR2V0UHJvcGVydHlWYWx1ZUJ5SW5kZXgoaW5kZXgpOwogICAgICAgICAgICAgICAgY2FzZSAiZWZmZWN0IjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGFyZ2V0W2luZGV4XTsKICAgICAgICAgICAgICAgIGNhc2UgImluc3RhbmNlLXZhcmlhYmxlIjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGFyZ2V0LkdldEluc3RhbmNlVmFyaWFibGVWYWx1ZShpbmRleCk7CiAgICAgICAgICAgICAgICBjYXNlICJwbHVnaW4iOgogICAgICAgICAgICAgICAgICAgIHJldHVybiB0YXJnZXQuR2V0UHJvcGVydHlWYWx1ZUJ5SW5kZXgoaW5kZXgpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgX1NldHRlcih2YWx1ZSkgewogICAgICAgICAgICBjb25zdCBpZCA9IHRoaXMuX3Byb3BlcnR5VHJhY2suR2V0U291cmNlQWRhcHRlcklkKCk7CiAgICAgICAgICAgIGNvbnN0IHRhcmdldCA9IHRoaXMuX0dldFRhcmdldCgpOwogICAgICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMuX0dldEluZGV4KCk7CiAgICAgICAgICAgIHN3aXRjaCAoaWQpIHsKICAgICAgICAgICAgICAgIGNhc2UgImJlaGF2aW9yIjoKICAgICAgICAgICAgICAgICAgICB0YXJnZXQuU2V0UHJvcGVydHlWYWx1ZUJ5SW5kZXgoaW5kZXgsIHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgImVmZmVjdCI6CiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0W2luZGV4XSA9IHZhbHVlOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAiaW5zdGFuY2UtdmFyaWFibGUiOgogICAgICAgICAgICAgICAgICAgIHRhcmdldC5TZXRJbnN0YW5jZVZhcmlhYmxlVmFsdWUoaW5kZXgsIHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgInBsdWdpbiI6CiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0LlNldFByb3BlcnR5VmFsdWVCeUluZGV4KGluZGV4LCB2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIEMzLlByb3BlcnR5VHJhY2tTdGF0ZS5Qcm9wZXJ0eUludGVycG9sYXRpb25BZGFwdGVyLk5vSW50ZXJwb2xhdGlvbkFkYXB0ZXIgPSBOb0ludGVycG9sYXRpb25BZGFwdGVyOwoKfQoKLy8gdGltZWxpbmVzL3N0YXRlL3Byb3BlcnR5SW50ZXJwb2xhdGlvbkFkYXB0ZXJzL251bWVyaWNJbnRlcnBvbGF0aW9uQWRhcHRlci5qcwp7CiAgICAndXNlIHN0cmljdCc7CiAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICBjb25zdCBOUyA9IEMzLlByb3BlcnR5VHJhY2tTdGF0ZS5Qcm9wZXJ0eUludGVycG9sYXRpb25BZGFwdGVyOwogICAgY29uc3QgSU5TVEFOQ0VfRlVOQ19NQVAgPSBuZXcgTWFwOwogICAgY29uc3QgYWRkID0gKHByb3AsIHNldHRlciwgYWJzb2x1dGVfc2V0dGVyLCBnZXR0ZXIsIHJvdW5kLCBmUm91bmQgPSBmYWxzZSwgaW5pdCA9IG51bGwsIHJlc2V0ID0gbnVsbCkgPT4gewogICAgICAgIElOU1RBTkNFX0ZVTkNfTUFQLnNldChwcm9wLCB7CiAgICAgICAgICAgIHNldHRlciwKICAgICAgICAgICAgYWJzb2x1dGVfc2V0dGVyLAogICAgICAgICAgICBnZXR0ZXIsCiAgICAgICAgICAgIHJvdW5kLAogICAgICAgICAgICBmUm91bmQsCiAgICAgICAgICAgIGluaXQsCiAgICAgICAgICAgIHJlc2V0CiAgICAgICAgfSkKICAgIH07CiAgICBhZGQoIm9mZnNldFgiLCAod2ksIHYsIHQsIGEpID0+IHsKICAgICAgICBpZiAoYS5fcHJvcGVydHlUcmFjay5HZXRSZXN1bHRNb2RlKCkgPT09ICJyZWxhdGl2ZSIpIHdpLk9mZnNldFgodiwgdC5HZXRUaW1lbGluZSgpLkdldFRyYW5zZm9ybVdpdGhTY2VuZUdyYXBoKCkpOwogICAgICAgIGVsc2Ugd2kuT2Zmc2V0WCh2KQogICAgfSwgKHdpLCB2KSA9PiB3aS5TZXRYKHYpLCB3aSA9PiB3aS5HZXRYKCksIHRydWUpOwogICAgYWRkKCJvZmZzZXRZIiwgKHdpLCB2LCB0LCBhKSA9PiB7CiAgICAgICAgaWYgKGEuX3Byb3BlcnR5VHJhY2suR2V0UmVzdWx0TW9kZSgpID09PSAicmVsYXRpdmUiKSB3aS5PZmZzZXRZKHYsIHQuR2V0VGltZWxpbmUoKS5HZXRUcmFuc2Zvcm1XaXRoU2NlbmVHcmFwaCgpKTsKICAgICAgICBlbHNlIHdpLk9mZnNldFkodikKICAgIH0sICh3aSwgdikgPT4gd2kuU2V0WSh2KSwgd2kgPT4gd2kuR2V0WSgpLCB0cnVlKTsKICAgIGFkZCgib2Zmc2V0V2lkdGgiLCAod2ksIHYsIHQsIGEsIG5vQ2hhbmdlcykgPT4gewogICAgICAgICAgICBpZiAodiA9PT0gMCkgcmV0dXJuOwogICAgICAgICAgICBjb25zdCBpc1JlbGF0aXZlID0gYS5fcHJvcGVydHlUcmFjay5HZXRSZXN1bHRNb2RlKCkgPT09ICJyZWxhdGl2ZSI7CiAgICAgICAgICAgIGNvbnN0IGlzVHdlZW4gPSBhLl90eXBlQWRhcHRlci5HZXRUeXBlKCkgPT09IDE7CiAgICAgICAgICAgIGlmICgoaXNSZWxhdGl2ZSB8fCBpc1R3ZWVuKSAmJiB3aS5IYXNQYXJlbnQoKSAmJiB3aS5HZXRUcmFuc2Zvcm1XaXRoUGFyZW50V2lkdGgoKSkgewogICAgICAgICAgICAgICAgaWYgKGlzTmFOKGEuX2Fic29sdXRlVG9GYWN0b3IpKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcGFyZW50cyA9IFtdOwogICAgICAgICAgICAgICAgICAgIGxldCBwYXJlbnQgPSB3aS5HZXRQYXJlbnQoKTsKICAgICAgICAgICAgICAgICAgICB3aGlsZSAocGFyZW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudHMucHVzaChwYXJlbnQpOwogICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnQgPSBwYXJlbnQuR2V0UGFyZW50KCkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcGFyZW50cy5yZXZlcnNlKCk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZ2V0X3RyYWNrID0gKHdpLCB0KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0LkdldFRpbWVsaW5lKCkuR2V0VHJhY2tGcm9tSW5zdGFuY2Uod2kuR2V0SW5zdGFuY2UoKSkKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGdldF9vcmlnaW5hbF9zaXplID0KICAgICAgICAgICAgICAgICAgICAgICAgKHdpLCB0KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0cmFjayA9IGdldF90cmFjayh3aSwgdCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHJhY2spIHJldHVybiB0cmFjay5HZXRPcmlnaW5hbFdpZHRoKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzZGtpID0gd2kuR2V0SW5zdGFuY2UoKS5HZXRTZGtJbnN0YW5jZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNka2kuSXNPcmlnaW5hbFNpemVLbm93bigpKSByZXR1cm4gc2RraS5HZXRPcmlnaW5hbFdpZHRoKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gd2kuX0dldFNjZW5lR3JhcGhJbmZvKCkuX0dldFN0YXJ0V2lkdGgoKQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGdldF9sYXN0X3Byb3BlcnR5X2tleWZyYW1lX3ZhbHVlID0gKHdpLCB0LCBwcm9wZXJ0eU5hbWUpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdHJhY2sgPSBnZXRfdHJhY2sod2ksIHQpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRyYWNrKSByZXR1cm4gMDsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJvcGVydHlUcmFjayA9IHRyYWNrLkdldFByb3BlcnR5VHJhY2socHJvcGVydHlOYW1lKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFwcm9wZXJ0eVRyYWNrKSByZXR1cm4gMDsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcGFyZW50UHJvcGVydHlLZXlmcmFtZURhdGEgPSBwcm9wZXJ0eVRyYWNrLkdldFByb3BlcnR5VHJhY2tEYXRhSXRlbSgpLkdldFByb3BlcnR5S2V5ZnJhbWVEYXRhKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcGFyZW50UHJvcGVydHlLZXlmcmFtZURhdGEpIHJldHVybiAwOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwYXJlbnRMYXN0UHJvcGVydHlLZXlmcmFtZURhdGFJdGVtID0gcGFyZW50UHJvcGVydHlLZXlmcmFtZURhdGEuR2V0TGFzdFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbSgpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXBhcmVudExhc3RQcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW0pIHJldHVybiAwOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFyZW50TGFzdFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbS5HZXRWYWx1ZSgpCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBsZXQgcCA9IHBhcmVudHNbMF07CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3duU3RhcnRTaXplID0gcC5fR2V0U2NlbmVHcmFwaEluZm8oKS5fR2V0U3RhcnRXaWR0aCgpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IG93blN0YXJ0U2NhbGUgPSBwLl9HZXRTY2VuZUdyYXBoSW5mbygpLkdldFN0YXJ0U2NhbGVYKCk7CiAgICAgICAgICAgICAgICAgICAgbGV0IGFic29sdXRlVG9GYWN0b3IgPSBvd25TdGFydFNpemUgKiBvd25TdGFydFNjYWxlOwogICAgICAgICAgICAgICAgICAgIGFic29sdXRlVG9GYWN0b3IgKz0gZ2V0X2xhc3RfcHJvcGVydHlfa2V5ZnJhbWVfdmFsdWUocCwgdCwgIm9mZnNldFdpZHRoIik7CiAgICAgICAgICAgICAgICAgICAgYWJzb2x1dGVUb0ZhY3RvciArPQogICAgICAgICAgICAgICAgICAgICAgICBnZXRfb3JpZ2luYWxfc2l6ZShwLCB0KSAqIGdldF9sYXN0X3Byb3BlcnR5X2tleWZyYW1lX3ZhbHVlKHAsIHQsICJvZmZzZXRTY2FsZVgiKTsKICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8IHBhcmVudHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgcCA9IHBhcmVudHNbaV07CiAgICAgICAgICAgICAgICAgICAgICAgIGFic29sdXRlVG9GYWN0b3IgKj0gcC5fR2V0U2NlbmVHcmFwaEluZm8oKS5HZXRTdGFydFNjYWxlWCgpOwogICAgICAgICAgICAgICAgICAgICAgICBhYnNvbHV0ZVRvRmFjdG9yICs9IGdldF9sYXN0X3Byb3BlcnR5X2tleWZyYW1lX3ZhbHVlKHAsIHQsICJvZmZzZXRXaWR0aCIpOwogICAgICAgICAgICAgICAgICAgICAgICBhYnNvbHV0ZVRvRmFjdG9yICs9IGdldF9vcmlnaW5hbF9zaXplKHAsIHQpICogZ2V0X2xhc3RfcHJvcGVydHlfa2V5ZnJhbWVfdmFsdWUocCwgdCwgIm9mZnNldFNjYWxlWCIpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGEuX2Fic29sdXRlVG9GYWN0b3IgPSBhYnNvbHV0ZVRvRmFjdG9yID09PSAwID8gTnVtYmVyLkVQU0lMT04gOiBhYnNvbHV0ZVRvRmFjdG9yCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAobm9DaGFuZ2VzKSByZXR1cm47CiAgICAgICAgICAgICAgICB3aS5PZmZzZXRXaWR0aCh2IC8gYS5fYWJzb2x1dGVUb0ZhY3RvciwgdHJ1ZSkKICAgICAgICAgICAgfSBlbHNlIHdpLk9mZnNldFdpZHRoKHYpCiAgICAgICAgfSwKICAgICAgICAod2ksIHYpID0+IHdpLlNldFdpZHRoKHYpLCB3aSA9PiB3aS5HZXRXaWR0aCgpLCB0cnVlKTsKICAgIGFkZCgib2Zmc2V0SGVpZ2h0IiwgKHdpLCB2LCB0LCBhLCBub0NoYW5nZXMpID0+IHsKICAgICAgICAgICAgaWYgKHYgPT09IDApIHJldHVybjsKICAgICAgICAgICAgY29uc3QgaXNSZWxhdGl2ZSA9IGEuX3Byb3BlcnR5VHJhY2suR2V0UmVzdWx0TW9kZSgpID09PSAicmVsYXRpdmUiOwogICAgICAgICAgICBjb25zdCBpc1R3ZWVuID0gYS5fdHlwZUFkYXB0ZXIuR2V0VHlwZSgpID09PSAxOwogICAgICAgICAgICBpZiAoKGlzUmVsYXRpdmUgfHwgaXNUd2VlbikgJiYgd2kuSGFzUGFyZW50KCkgJiYgd2kuR2V0VHJhbnNmb3JtV2l0aFBhcmVudEhlaWdodCgpKSB7CiAgICAgICAgICAgICAgICBpZiAoaXNOYU4oYS5fYWJzb2x1dGVUb0ZhY3RvcikpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBwYXJlbnRzID0gW107CiAgICAgICAgICAgICAgICAgICAgbGV0IHBhcmVudCA9IHdpLkdldFBhcmVudCgpOwogICAgICAgICAgICAgICAgICAgIHdoaWxlIChwYXJlbnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50cy5wdXNoKHBhcmVudCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudCA9IHBhcmVudC5HZXRQYXJlbnQoKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBwYXJlbnRzLnJldmVyc2UoKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBnZXRfdHJhY2sgPSAod2ksIHQpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQuR2V0VGltZWxpbmUoKS5HZXRUcmFja0Zyb21JbnN0YW5jZSh3aS5HZXRJbnN0YW5jZSgpKQogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZ2V0X29yaWdpbmFsX3NpemUgPQogICAgICAgICAgICAgICAgICAgICAgICAod2ksIHQpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRyYWNrID0gZ2V0X3RyYWNrKHdpLCB0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0cmFjaykgcmV0dXJuIHRyYWNrLkdldE9yaWdpbmFsSGVpZ2h0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzZGtpID0gd2kuR2V0SW5zdGFuY2UoKS5HZXRTZGtJbnN0YW5jZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNka2kuSXNPcmlnaW5hbFNpemVLbm93bigpKSByZXR1cm4gc2RraS5HZXRPcmlnaW5hbEhlaWdodCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdpLl9HZXRTY2VuZUdyYXBoSW5mbygpLl9HZXRTdGFydEhlaWdodCgpCiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZ2V0X2xhc3RfcHJvcGVydHlfa2V5ZnJhbWVfdmFsdWUgPSAod2ksIHQsIHByb3BlcnR5TmFtZSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0cmFjayA9IHQuR2V0VGltZWxpbmUoKS5HZXRUcmFja0Zyb21JbnN0YW5jZSh3aS5HZXRJbnN0YW5jZSgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0cmFjaykgcmV0dXJuIDA7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHByb3BlcnR5VHJhY2sgPSB0cmFjay5HZXRQcm9wZXJ0eVRyYWNrKHByb3BlcnR5TmFtZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcHJvcGVydHlUcmFjaykgcmV0dXJuIDA7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHBhcmVudFByb3BlcnR5S2V5ZnJhbWVEYXRhID0gcHJvcGVydHlUcmFjay5HZXRQcm9wZXJ0eVRyYWNrRGF0YUl0ZW0oKS5HZXRQcm9wZXJ0eUtleWZyYW1lRGF0YSgpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXBhcmVudFByb3BlcnR5S2V5ZnJhbWVEYXRhKSByZXR1cm4gMDsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcGFyZW50TGFzdFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbSA9IHBhcmVudFByb3BlcnR5S2V5ZnJhbWVEYXRhLkdldExhc3RQcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW0oKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFwYXJlbnRMYXN0UHJvcGVydHlLZXlmcmFtZURhdGFJdGVtKSByZXR1cm4gMDsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBhcmVudExhc3RQcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW0uR2V0VmFsdWUoKQogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgbGV0IHAgPSBwYXJlbnRzWzBdOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IG93blN0YXJ0U2l6ZSA9IHAuX0dldFNjZW5lR3JhcGhJbmZvKCkuX0dldFN0YXJ0SGVpZ2h0KCk7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3duU3RhcnRTY2FsZSA9IHAuX0dldFNjZW5lR3JhcGhJbmZvKCkuR2V0U3RhcnRTY2FsZVkoKTsKICAgICAgICAgICAgICAgICAgICBsZXQgYWJzb2x1dGVUb0ZhY3RvciA9IG93blN0YXJ0U2l6ZSAqIG93blN0YXJ0U2NhbGU7CiAgICAgICAgICAgICAgICAgICAgYWJzb2x1dGVUb0ZhY3RvciArPSBnZXRfbGFzdF9wcm9wZXJ0eV9rZXlmcmFtZV92YWx1ZShwLCB0LCAib2Zmc2V0SGVpZ2h0Iik7CiAgICAgICAgICAgICAgICAgICAgYWJzb2x1dGVUb0ZhY3RvciArPQogICAgICAgICAgICAgICAgICAgICAgICBnZXRfb3JpZ2luYWxfc2l6ZShwLCB0KSAqIGdldF9sYXN0X3Byb3BlcnR5X2tleWZyYW1lX3ZhbHVlKHAsIHQsICJvZmZzZXRTY2FsZVkiKTsKICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8IHBhcmVudHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgcCA9IHBhcmVudHNbaV07CiAgICAgICAgICAgICAgICAgICAgICAgIGFic29sdXRlVG9GYWN0b3IgKj0gcC5fR2V0U2NlbmVHcmFwaEluZm8oKS5HZXRTdGFydFNjYWxlWSgpOwogICAgICAgICAgICAgICAgICAgICAgICBhYnNvbHV0ZVRvRmFjdG9yICs9IGdldF9sYXN0X3Byb3BlcnR5X2tleWZyYW1lX3ZhbHVlKHAsIHQpOwogICAgICAgICAgICAgICAgICAgICAgICBhYnNvbHV0ZVRvRmFjdG9yICs9IGdldF9vcmlnaW5hbF9zaXplKHAsIHQpICogZ2V0X2xhc3RfcHJvcGVydHlfa2V5ZnJhbWVfdmFsdWUocCwgdCwgIm9mZnNldFNjYWxlWSIpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGEuX2Fic29sdXRlVG9GYWN0b3IgPSBhYnNvbHV0ZVRvRmFjdG9yID09PSAwID8gTnVtYmVyLkVQU0lMT04gOiBhYnNvbHV0ZVRvRmFjdG9yCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAobm9DaGFuZ2VzKSByZXR1cm47CiAgICAgICAgICAgICAgICB3aS5PZmZzZXRIZWlnaHQodiAvIGEuX2Fic29sdXRlVG9GYWN0b3IsIHRydWUpCiAgICAgICAgICAgIH0gZWxzZSB3aS5PZmZzZXRIZWlnaHQodikKICAgICAgICB9LCAod2ksIHYpID0+CiAgICAgICAgd2kuU2V0SGVpZ2h0KHYpLCB3aSA9PiB3aS5HZXRIZWlnaHQoKSwgdHJ1ZSk7CiAgICBhZGQoIm9mZnNldEFuZ2xlIiwgKHdpLCB2KSA9PiB3aS5PZmZzZXRBbmdsZSh2KSwgKHdpLCB2KSA9PiB3aS5TZXRBbmdsZSh2KSwgd2kgPT4gd2kuR2V0QW5nbGUoKSwgZmFsc2UsIHRydWUpOwogICAgYWRkKCJvZmZzZXRPcGFjaXR5IiwgKHdpLCB2LCB0LCBhLCBub0NoYW5nZXMpID0+IHsKICAgICAgICBjb25zdCBvcGFjaXR5RmFjdG9yID0gYS5fb3BhY2l0eUZhY3RvciA/IGEuX29wYWNpdHlGYWN0b3IgOiAxOwogICAgICAgIHYgLz0gb3BhY2l0eUZhY3RvcjsKICAgICAgICBjb25zdCBvID0gd2kuR2V0T3BhY2l0eSgpOwogICAgICAgIGNvbnN0IG52ID0gbyArIHY7CiAgICAgICAgY29uc3QgbWluID0gMDsKICAgICAgICBjb25zdCBtYXggPSAxOwogICAgICAgIGlmIChhLl9jbGFtcEFjY3VtdWxhdG9yID09PSAwKSB7CiAgICAgICAgICAgIGlmIChudiA+IG1heCkgYS5fY2xhbXBBY2N1bXVsYXRvciArPSBudiAtIG1heDsKICAgICAgICAgICAgZWxzZSBpZiAobnYgPCBtaW4pIGEuX2NsYW1wQWNjdW11bGF0b3IgKz0gbnY7CiAgICAgICAgICAgIHdpLk9mZnNldE9wYWNpdHkodikKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb25zdCBudiA9IHdpLkdldE9wYWNpdHkoKSArIHY7CiAgICAgICAgICAgIGlmICh2ID4gMCAmJiBhLl9jbGFtcEFjY3VtdWxhdG9yID4gMCkgewogICAgICAgICAgICAgICAgaWYgKG52ID4gbWF4KSBhLl9jbGFtcEFjY3VtdWxhdG9yICs9IG52IC0gbWF4CiAgICAgICAgICAgIH0gZWxzZSBpZiAodiA+IDAgJiYgYS5fY2xhbXBBY2N1bXVsYXRvciA8IDApIHsKICAgICAgICAgICAgICAgIGEuX2NsYW1wQWNjdW11bGF0b3IgKz0gdjsKICAgICAgICAgICAgICAgIGlmIChhLl9jbGFtcEFjY3VtdWxhdG9yID4gMCkgYS5fY2xhbXBBY2N1bXVsYXRvciA9CiAgICAgICAgICAgICAgICAgICAgMAogICAgICAgICAgICB9IGVsc2UgaWYgKHYgPCAwICYmIGEuX2NsYW1wQWNjdW11bGF0b3IgPiAwKSB7CiAgICAgICAgICAgICAgICBhLl9jbGFtcEFjY3VtdWxhdG9yICs9IHY7CiAgICAgICAgICAgICAgICBpZiAoYS5fY2xhbXBBY2N1bXVsYXRvciA8IDApIGEuX2NsYW1wQWNjdW11bGF0b3IgPSAwCiAgICAgICAgICAgIH0gZWxzZSBpZiAodiA8IDAgJiYgYS5fY2xhbXBBY2N1bXVsYXRvciA8IDApCiAgICAgICAgICAgICAgICBpZiAobnYgPCBtaW4pIGEuX2NsYW1wQWNjdW11bGF0b3IgKz0gbnYKICAgICAgICB9CiAgICB9LCAod2ksIHYpID0+IHsKICAgICAgICB3aS5TZXRPcGFjaXR5KHYpCiAgICB9LCB3aSA9PiB7CiAgICAgICAgcmV0dXJuIHdpLkdldE9wYWNpdHkoKQogICAgfSwgZmFsc2UsIHRydWUsIChhLCB3aSwgdCkgPT4gewogICAgICAgIGEuX2NsYW1wQWNjdW11bGF0b3IgPSAwOwogICAgICAgIHN3aXRjaCAoYS5fcHJvcGVydHlUcmFjay5HZXRSZXN1bHRNb2RlKCkpIHsKICAgICAgICAgICAgY2FzZSAicmVsYXRpdmUiOgogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHByb3BlcnR5VHJhY2tEYXRhID0gYS5fcHJvcGVydHlUcmFjay5HZXRQcm9wZXJ0eVRyYWNrRGF0YSgpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHByb3BlcnR5VHJhY2tEYXRhSXRlbSA9IGEuX3Byb3BlcnR5VHJhY2suR2V0UHJvcGVydHlUcmFja0RhdGFJdGVtKCk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJvcGVydHlLZXlmcmFtZURhdGEgPSBwcm9wZXJ0eVRyYWNrRGF0YUl0ZW0uR2V0UHJvcGVydHlLZXlmcmFtZURhdGEoKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBwcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW1zID0gcHJvcGVydHlLZXlmcmFtZURhdGEuR2V0UHJvcGVydHlLZXlmcmFtZURhdGFJdGVtQXJyYXkoKTsKICAgICAgICAgICAgICAgICAgICBsZXQgc3RhcnRpbmdBYnNvbHV0ZU9wYWNpdHkgPSBhLkdldFdvcmxkSW5mbygpLkdldE9wYWNpdHkoKTsKICAgICAgICAgICAgICAgICAgICBsZXQgY3VycmVudEFic29sdXRlT3BhY2l0eSA9IHN0YXJ0aW5nQWJzb2x1dGVPcGFjaXR5OwogICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgcHJvcGVydHlLZXlmcmFtZURhdGFJdGVtIG9mIHByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdGltZSA9IHByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbS5HZXRUaW1lKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRSZWxhdGl2ZU9wYWNpdHkgPSBhLl9wcm9wZXJ0eVRyYWNrLkdldEludGVycG9sYXRlZFZhbHVlKHRpbWUpOwogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50QWJzb2x1dGVPcGFjaXR5ID0gc3RhcnRpbmdBYnNvbHV0ZU9wYWNpdHkgKyBjdXJyZW50UmVsYXRpdmVPcGFjaXR5OwogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50QWJzb2x1dGVPcGFjaXR5ID0gQzMuY2xhbXAoY3VycmVudEFic29sdXRlT3BhY2l0eSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDAsIDEpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGEuX3RvdGFsRm9yZXdhcmRPcGFjaXR5RGVsdGEgPSBzdGFydGluZ0Fic29sdXRlT3BhY2l0eSAtIGN1cnJlbnRBYnNvbHV0ZU9wYWNpdHk7YS5fdG90YWxGb3Jld2FyZE9wYWNpdHlEZWx0YSA9IE1hdGgucm91bmQoKGEuX3RvdGFsRm9yZXdhcmRPcGFjaXR5RGVsdGEgKyBOdW1iZXIuRVBTSUxPTikgKiAxMDApIC8gMTAwO2N1cnJlbnRBYnNvbHV0ZU9wYWNpdHkgPSBzdGFydGluZ0Fic29sdXRlT3BhY2l0eTsKICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gcHJvcGVydHlLZXlmcmFtZURhdGFJdGVtcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0aW1lID0gcHJvcGVydHlLZXlmcmFtZURhdGFJdGVtc1tpXS5HZXRUaW1lKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRSZWxhdGl2ZU9wYWNpdHkgPSBhLl9wcm9wZXJ0eVRyYWNrLkdldEludGVycG9sYXRlZFZhbHVlKHRpbWUpOwogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50QWJzb2x1dGVPcGFjaXR5IC09IGN1cnJlbnRSZWxhdGl2ZU9wYWNpdHk7CiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRBYnNvbHV0ZU9wYWNpdHkgPSBDMy5jbGFtcChjdXJyZW50QWJzb2x1dGVPcGFjaXR5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgMCwgMSkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYS5fdG90YWxCYWNrd2FyZE9wYWNpdHlEZWx0YSA9IGN1cnJlbnRBYnNvbHV0ZU9wYWNpdHk7YS5fdG90YWxCYWNrd2FyZE9wYWNpdHlEZWx0YSA9IE1hdGgucm91bmQoKGEuX3RvdGFsQmFja3dhcmRPcGFjaXR5RGVsdGEgKyBOdW1iZXIuRVBTSUxPTikgKiAxMDApIC8gMTAwOwogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgImFic29sdXRlIjoKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjb25zdCBpc1JlbGF0aXZlID0gYS5fcHJvcGVydHlUcmFjay5HZXRSZXN1bHRNb2RlKCkgPT09ICJyZWxhdGl2ZSI7CiAgICAgICAgY29uc3QgaXNUd2VlbiA9IGEuX3R5cGVBZGFwdGVyLkdldFR5cGUoKSA9PT0gMTsKICAgICAgICBpZiAoKGlzUmVsYXRpdmUgfHwgaXNUd2VlbikgJiYgd2kuSGFzUGFyZW50KCkgJiYgd2kuR2V0VHJhbnNmb3JtV2l0aFBhcmVudE9wYWNpdHkoKSkgewogICAgICAgICAgICBjb25zdCBwYXJlbnRzID0gW107CiAgICAgICAgICAgIGxldCBwYXJlbnQgPSB3aS5HZXRQYXJlbnQoKTsKICAgICAgICAgICAgd2hpbGUgKHBhcmVudCkgewogICAgICAgICAgICAgICAgcGFyZW50cy5wdXNoKHBhcmVudCk7CiAgICAgICAgICAgICAgICBwYXJlbnQgPSBwYXJlbnQuR2V0UGFyZW50KCkKICAgICAgICAgICAgfQogICAgICAgICAgICBwYXJlbnRzLnJldmVyc2UoKTsKICAgICAgICAgICAgY29uc3QgZ2V0X2xhc3RfcHJvcGVydHlfa2V5ZnJhbWVfdmFsdWUgPQogICAgICAgICAgICAgICAgKHdpLCB0LCBwcm9wZXJ0eU5hbWUpID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCB0cmFjayA9IHQuR2V0VGltZWxpbmUoKS5HZXRUcmFja0Zyb21JbnN0YW5jZSh3aS5HZXRJbnN0YW5jZSgpKTsKICAgICAgICAgICAgICAgICAgICBpZiAoIXRyYWNrKSByZXR1cm4gMDsKICAgICAgICAgICAgICAgICAgICBjb25zdCBwcm9wZXJ0eVRyYWNrID0gdHJhY2suR2V0UHJvcGVydHlUcmFjayhwcm9wZXJ0eU5hbWUpOwogICAgICAgICAgICAgICAgICAgIGlmICghcHJvcGVydHlUcmFjaykgcmV0dXJuIDA7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcGFyZW50UHJvcGVydHlLZXlmcmFtZURhdGEgPSBwcm9wZXJ0eVRyYWNrLkdldFByb3BlcnR5VHJhY2tEYXRhSXRlbSgpLkdldFByb3BlcnR5S2V5ZnJhbWVEYXRhKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFwYXJlbnRQcm9wZXJ0eUtleWZyYW1lRGF0YSkgcmV0dXJuIDA7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcGFyZW50TGFzdFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbSA9IHBhcmVudFByb3BlcnR5S2V5ZnJhbWVEYXRhLkdldExhc3RQcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW0oKTsKICAgICAgICAgICAgICAgICAgICBpZiAoIXBhcmVudExhc3RQcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW0pIHJldHVybiAwOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBwYXJlbnRMYXN0UHJvcGVydHlLZXlmcmFtZURhdGFJdGVtLkdldFZhbHVlKCkKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIGxldCBvcGFjaXR5RmFjdG9yID0gcGFyZW50c1swXS5fR2V0U2NlbmVHcmFwaEluZm8oKS5HZXRTdGFydE9wYWNpdHkoKTsKICAgICAgICAgICAgb3BhY2l0eUZhY3RvciArPSBnZXRfbGFzdF9wcm9wZXJ0eV9rZXlmcmFtZV92YWx1ZShwYXJlbnRzWzBdLCB0LCAib2Zmc2V0T3BhY2l0eSIpOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8IHBhcmVudHMubGVuZ3RoOyBpKyspIG9wYWNpdHlGYWN0b3IgKz0gZ2V0X2xhc3RfcHJvcGVydHlfa2V5ZnJhbWVfdmFsdWUocGFyZW50c1tpXSwgdCwgIm9mZnNldE9wYWNpdHkiKTsKICAgICAgICAgICAgYS5fb3BhY2l0eUZhY3RvciA9IG9wYWNpdHlGYWN0b3IgPT09IDAgPyAxIDogb3BhY2l0eUZhY3RvcgogICAgICAgIH0KICAgIH0sIGEgPT4gewogICAgICAgIHN3aXRjaCAoYS5fcHJvcGVydHlUcmFjay5HZXRSZXN1bHRNb2RlKCkpIHsKICAgICAgICAgICAgY2FzZSAicmVsYXRpdmUiOgogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGEuX2NsYW1wQWNjdW11bGF0b3IgPSAwOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHdpID0gYS5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgICAgICAgICBsZXQgY3VycmVudE9wYWNpdHkgPSB3aS5HZXRPcGFjaXR5KCk7Y3VycmVudE9wYWNpdHkgPSBNYXRoLnJvdW5kKChjdXJyZW50T3BhY2l0eSArIE51bWJlci5FUFNJTE9OKSAqCiAgICAgICAgICAgICAgICAgICAgICAgIDEwMCkgLyAxMDA7CiAgICAgICAgICAgICAgICAgICAgaWYgKGEuX3Byb3BlcnR5VHJhY2suR2V0VGltZWxpbmUoKS5Jc0ZvcndhcmRQbGF5QmFjaygpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpLlNldE9wYWNpdHkoY3VycmVudE9wYWNpdHkgKyBhLl90b3RhbEZvcmV3YXJkT3BhY2l0eURlbHRhKTsKICAgICAgICAgICAgICAgICAgICAgICAgYS5fbGFzdFZhbHVlID0gMAogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpLlNldE9wYWNpdHkoY3VycmVudE9wYWNpdHkgLSBhLl90b3RhbEJhY2t3YXJkT3BhY2l0eURlbHRhKTsKICAgICAgICAgICAgICAgICAgICAgICAgYS5fbGFzdFZhbHVlID0gYS5HZXRTb3VyY2VBZGFwdGVyKCkuR2V0VmFsdWVBdFRpbWUoKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlICJhYnNvbHV0ZSI6CiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9KTsKICAgIGFkZCgib2Zmc2V0T3JpZ2luWCIsICh3aSwgdikgPT4gd2kuT2Zmc2V0T3JpZ2luWCh2KSwgKHdpLCB2KSA9PiB3aS5TZXRPcmlnaW5YKHYpLCB3aSA9PiB3aS5HZXRPcmlnaW5YKCksIGZhbHNlKTsKICAgIGFkZCgib2Zmc2V0T3JpZ2luWSIsICh3aSwgdikgPT4gd2kuT2Zmc2V0T3JpZ2luWSh2KSwgKHdpLCB2KSA9PiB3aS5TZXRPcmlnaW5ZKHYpLCB3aSA9PiB3aS5HZXRPcmlnaW5ZKCksIGZhbHNlKTsKICAgIGFkZCgib2Zmc2V0WkVsZXZhdGlvbiIsICh3aSwgdikgPT4gd2kuT2Zmc2V0WkVsZXZhdGlvbih2KSwgKHdpLCB2KSA9PiB3aS5TZXRaRWxldmF0aW9uKHYpLCB3aSA9PiB3aS5HZXRaRWxldmF0aW9uKCksIHRydWUpOwogICAgYWRkKCJvZmZzZXRTY2FsZVgiLCAod2ksIHYsIHQsIGEpID0+IHsKICAgICAgICBpZiAodiA9PT0gMCkgcmV0dXJuOwogICAgICAgIGNvbnN0IG1pcnJvckZhY3RvciA9IHdpLkdldFdpZHRoKCkgPCAwID8gLTEgOiAxOwogICAgICAgIGlmIChhLl9wcm9wZXJ0eVRyYWNrLkdldFJlc3VsdE1vZGUoKSA9PT0gInJlbGF0aXZlIiAmJiB3aS5IYXNQYXJlbnQoKSAmJiB3aS5HZXRUcmFuc2Zvcm1XaXRoUGFyZW50V2lkdGgoKSkgewogICAgICAgICAgICBjb25zdCB2YWx1ZSA9IHQuR2V0T3JpZ2luYWxXaWR0aCgpICogbWlycm9yRmFjdG9yICogdjsKICAgICAgICAgICAgaWYgKGlzTmFOKGEuX2Fic29sdXRlVG9GYWN0b3IpKSBJTlNUQU5DRV9GVU5DX01BUC5nZXQoIm9mZnNldFdpZHRoIikuc2V0dGVyKHdpLCAxLCB0LCBhLCB0cnVlKTsKICAgICAgICAgICAgd2kuT2Zmc2V0V2lkdGgodmFsdWUgLyBhLl9hYnNvbHV0ZVRvRmFjdG9yLCB0cnVlKQogICAgICAgIH0gZWxzZSB3aS5PZmZzZXRXaWR0aCh0LkdldE9yaWdpbmFsV2lkdGgoKSAqIG1pcnJvckZhY3RvciAqIHYpCiAgICB9LCAod2ksIHYsIHQpID0+IHsKICAgICAgICB3aS5TZXRXaWR0aCh0LkdldE9yaWdpbmFsV2lkdGgoKSAqIHYpCiAgICB9LCAod2ksIHQpID0+IHsKICAgICAgICBjb25zdCBtaXJyb3JGYWN0b3IgPQogICAgICAgICAgICB3aS5HZXRXaWR0aCgpIDwgMCA/IC0xIDogMTsKICAgICAgICBpZiAod2kuR2V0VHJhbnNmb3JtV2l0aFBhcmVudFdpZHRoKCkpIHsKICAgICAgICAgICAgY29uc3QgcGFyZW50V2kgPSB3aS5HZXRQYXJlbnQoKTsKICAgICAgICAgICAgY29uc3QgcGFyZW50VHJhY2sgPSB0LkdldFRpbWVsaW5lKCkuR2V0VHJhY2tGcm9tSW5zdGFuY2UocGFyZW50V2kuR2V0SW5zdGFuY2UoKSk7CiAgICAgICAgICAgIGxldCBwYXJlbnRTY2FsZSA9IE5hTjsKICAgICAgICAgICAgaWYgKHBhcmVudFRyYWNrKSBwYXJlbnRTY2FsZSA9IHBhcmVudFdpLkdldFdpZHRoKCkgLyBwYXJlbnRUcmFjay5HZXRPcmlnaW5hbFdpZHRoKCk7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgY29uc3Qgc2RraSA9IHBhcmVudFdpLkdldEluc3RhbmNlKCkuR2V0U2RrSW5zdGFuY2UoKTsKICAgICAgICAgICAgICAgIGlmIChzZGtpLklzT3JpZ2luYWxTaXplS25vd24oKSkgcGFyZW50U2NhbGUgPSBwYXJlbnRXaS5HZXRXaWR0aCgpIC8gc2RraS5HZXRPcmlnaW5hbFdpZHRoKCk7CiAgICAgICAgICAgICAgICBlbHNlIHBhcmVudFNjYWxlID0gMQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB3aS5HZXRXaWR0aCgpICogbWlycm9yRmFjdG9yIC8gKHQuR2V0T3JpZ2luYWxXaWR0aCgpICogcGFyZW50U2NhbGUpCiAgICAgICAgfSBlbHNlIHJldHVybiB3aS5HZXRXaWR0aCgpICoKICAgICAgICAgICAgbWlycm9yRmFjdG9yIC8gdC5HZXRPcmlnaW5hbFdpZHRoKCkKICAgIH0sIGZhbHNlKTsKICAgIGFkZCgib2Zmc2V0U2NhbGVZIiwgKHdpLCB2LCB0LCBhKSA9PiB7CiAgICAgICAgaWYgKHYgPT09IDApIHJldHVybjsKICAgICAgICBjb25zdCBmbGlwRmFjdG9yID0gd2kuR2V0SGVpZ2h0KCkgPCAwID8gLTEgOiAxOwogICAgICAgIGlmIChhLl9wcm9wZXJ0eVRyYWNrLkdldFJlc3VsdE1vZGUoKSA9PT0gInJlbGF0aXZlIiAmJiB3aS5IYXNQYXJlbnQoKSAmJiB3aS5HZXRUcmFuc2Zvcm1XaXRoUGFyZW50SGVpZ2h0KCkpIHsKICAgICAgICAgICAgY29uc3QgdmFsdWUgPSB0LkdldE9yaWdpbmFsSGVpZ2h0KCkgKiBmbGlwRmFjdG9yICogdjsKICAgICAgICAgICAgaWYgKGlzTmFOKGEuX2Fic29sdXRlVG9GYWN0b3IpKSBJTlNUQU5DRV9GVU5DX01BUC5nZXQoIm9mZnNldEhlaWdodCIpLnNldHRlcih3aSwgMSwgdCwgYSwgdHJ1ZSk7CiAgICAgICAgICAgIHdpLk9mZnNldEhlaWdodCh2YWx1ZSAvIGEuX2Fic29sdXRlVG9GYWN0b3IsIHRydWUpCiAgICAgICAgfSBlbHNlIHdpLk9mZnNldEhlaWdodCh0LkdldE9yaWdpbmFsSGVpZ2h0KCkgKiBmbGlwRmFjdG9yICogdikKICAgIH0sICh3aSwgdiwgdCkgPT4gewogICAgICAgIHdpLlNldEhlaWdodCh0LkdldE9yaWdpbmFsSGVpZ2h0KCkgKiB2KQogICAgfSwgKHdpLCB0KSA9PiB7CiAgICAgICAgY29uc3QgZmxpcEZhY3RvciA9CiAgICAgICAgICAgIHdpLkdldEhlaWdodCgpIDwgMCA/IC0xIDogMTsKICAgICAgICBpZiAod2kuR2V0VHJhbnNmb3JtV2l0aFBhcmVudEhlaWdodCgpKSB7CiAgICAgICAgICAgIGNvbnN0IHBhcmVudFdpID0gd2kuR2V0UGFyZW50KCk7CiAgICAgICAgICAgIGNvbnN0IHBhcmVudFRyYWNrID0gdC5HZXRUaW1lbGluZSgpLkdldFRyYWNrRnJvbUluc3RhbmNlKHBhcmVudFdpLkdldEluc3RhbmNlKCkpOwogICAgICAgICAgICBsZXQgcGFyZW50U2NhbGUgPSBOYU47CiAgICAgICAgICAgIGlmIChwYXJlbnRUcmFjaykgcGFyZW50U2NhbGUgPSBwYXJlbnRXaS5HZXRIZWlnaHQoKSAvIHBhcmVudFRyYWNrLkdldE9yaWdpbmFsSGVpZ2h0KCk7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgY29uc3Qgc2RraSA9IHBhcmVudFdpLkdldEluc3RhbmNlKCkuR2V0U2RrSW5zdGFuY2UoKTsKICAgICAgICAgICAgICAgIGlmIChzZGtpLklzT3JpZ2luYWxTaXplS25vd24oKSkgcGFyZW50U2NhbGUgPSBwYXJlbnRXaS5HZXRIZWlnaHQoKSAvIHNka2kuR2V0T3JpZ2luYWxIZWlnaHQoKTsKICAgICAgICAgICAgICAgIGVsc2UgcGFyZW50U2NhbGUgPSAxCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHdpLkdldEhlaWdodCgpICogZmxpcEZhY3RvciAvICh0LkdldE9yaWdpbmFsSGVpZ2h0KCkgKiBwYXJlbnRTY2FsZSkKICAgICAgICB9IGVsc2UgcmV0dXJuIHdpLkdldEhlaWdodCgpICoKICAgICAgICAgICAgZmxpcEZhY3RvciAvIHQuR2V0T3JpZ2luYWxIZWlnaHQoKQogICAgfSwgZmFsc2UpOwogICAgY2xhc3MgTnVtZXJpY0ludGVycG9sYXRpb25BZGFwdGVyIGV4dGVuZHMgQzMuUHJvcGVydHlUcmFja1N0YXRlLlByb3BlcnR5SW50ZXJwb2xhdGlvbkFkYXB0ZXIgewogICAgICAgIGNvbnN0cnVjdG9yKHNvdXJjZUFkYXB0ZXIpIHsKICAgICAgICAgICAgc3VwZXIoc291cmNlQWRhcHRlcik7CiAgICAgICAgICAgIHRoaXMuX2xhc3RWYWx1ZSA9IDA7CiAgICAgICAgICAgIHRoaXMuX2NsYW1wQWNjdW11bGF0b3IgPSAwOwogICAgICAgICAgICB0aGlzLl90b3RhbEZvcmV3YXJkT3BhY2l0eURlbHRhID0gMDsKICAgICAgICAgICAgdGhpcy5fdG90YWxCYWNrd2FyZE9wYWNpdHlEZWx0YSA9IDA7CiAgICAgICAgICAgIHRoaXMuX29wYWNpdHlGYWN0b3IgPSBOYU47CiAgICAgICAgICAgIHRoaXMuX2Fic29sdXRlVG9GYWN0b3IgPSBOYU47CiAgICAgICAgICAgIHRoaXMuX2luc3RhbmNlX2dldHRlciA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX2luc3RhbmNlX3NldHRlciA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX2luc3RhbmNlX2Fic29sdXRlX3NldHRlciA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3Jlc2V0X2FjdGlvbiA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX2luaXRfYWN0aW9uID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fc291cmNlX2FkYXB0ZXJfZ2V0dGVyID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fc291cmNlX2FkYXB0ZXJfc2V0dGVyID0KICAgICAgICAgICAgICAgIG51bGw7CiAgICAgICAgICAgIHRoaXMuX3NvdXJjZV9hZGFwdGVyX2Fic29sdXRlX3NldHRlciA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3JvdW5kID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX2ZSb3VuZCA9IGZhbHNlOwogICAgICAgICAgICBpZiAoQzMuSXNJbnN0YW5jZU9mKHRoaXMuX3Byb3BlcnR5VHJhY2suR2V0VGltZWxpbmUoKSwgQzMuVHdlZW5TdGF0ZSkpIHRoaXMuX3R5cGVBZGFwdGVyID0gbmV3IEMzLlByb3BlcnR5VHJhY2tTdGF0ZS5Qcm9wZXJ0eUludGVycG9sYXRpb25BZGFwdGVyLk51bWVyaWNJbnRlcnBvbGF0aW9uQWRhcHRlckZvclR3ZWVuKHRoaXMpOwogICAgICAgICAgICBlbHNlIHRoaXMuX3R5cGVBZGFwdGVyID0gbmV3IEMzLlByb3BlcnR5VHJhY2tTdGF0ZS5Qcm9wZXJ0eUludGVycG9sYXRpb25BZGFwdGVyLk51bWVyaWNJbnRlcnBvbGF0aW9uQWRhcHRlckZvclRpbWVsaW5lKHRoaXMpOwogICAgICAgICAgICBjb25zdCBwcm9wZXJ0eSA9IHRoaXMuX3Byb3BlcnR5VHJhY2suR2V0UHJvcGVydHlOYW1lKCk7CiAgICAgICAgICAgIHN3aXRjaCAodGhpcy5fcHJvcGVydHlUcmFjay5HZXRTb3VyY2VBZGFwdGVySWQoKSkgewogICAgICAgICAgICAgICAgY2FzZSAid29ybGQtaW5zdGFuY2UiOgogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcCA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBJTlNUQU5DRV9GVU5DX01BUC5nZXQocHJvcGVydHkpO3RoaXMuX2luc3RhbmNlX2dldHRlciA9IHAuZ2V0dGVyO3RoaXMuX2luc3RhbmNlX3NldHRlciA9IHAuc2V0dGVyO3RoaXMuX2luc3RhbmNlX2Fic29sdXRlX3NldHRlciA9IHAuYWJzb2x1dGVfc2V0dGVyO3RoaXMuX3JvdW5kID0gcC5yb3VuZDt0aGlzLl9mUm91bmQgPSBwLmZSb3VuZDt0aGlzLl9pbml0X2FjdGlvbiA9IHAuaW5pdDt0aGlzLl9yZXNldF9hY3Rpb24gPSBwLnJlc2V0OwogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNhc2UgImF1ZGlvIjoKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3NvdXJjZV9hZGFwdGVyX2dldHRlciA9IHNvdXJjZUFkYXB0ZXIuR2V0dGVyO3RoaXMuX3NvdXJjZV9hZGFwdGVyX3NldHRlciA9IHNvdXJjZUFkYXB0ZXIuU2V0dGVyO3RoaXMuX3NvdXJjZV9hZGFwdGVyX2Fic29sdXRlX3NldHRlciA9IHNvdXJjZUFkYXB0ZXIuQWJzb2x1dGVTZXR0ZXI7dGhpcy5fcm91bmQgPSAhIXNvdXJjZUFkYXB0ZXIuRG9lc1JvdW5kaW5nKCk7dGhpcy5fZlJvdW5kID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIFJlbGVhc2UoKSB7CiAgICAgICAgICAgIHRoaXMuX3R5cGVBZGFwdGVyID0KICAgICAgICAgICAgICAgIG51bGw7CiAgICAgICAgICAgIHRoaXMuX2luc3RhbmNlX2dldHRlciA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX2luc3RhbmNlX3NldHRlciA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX2luc3RhbmNlX2Fic29sdXRlX3NldHRlciA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX2Fic29sdXRlVG9GYWN0b3IgPSBOYU47CiAgICAgICAgICAgIHN1cGVyLlJlbGVhc2UoKQogICAgICAgIH0KICAgICAgICBNYXlOZWVkQmVmb3JlQW5kQWZ0ZXJJbnRlcnBvbGF0ZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3R5cGVBZGFwdGVyLk1heU5lZWRCZWZvcmVBbmRBZnRlckludGVycG9sYXRlKCkKICAgICAgICB9CiAgICAgICAgR2V0TGFzdFZhbHVlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fbGFzdFZhbHVlCiAgICAgICAgfQogICAgICAgIFNldExhc3RWYWx1ZSh2KSB7CiAgICAgICAgICAgIHRoaXMuX2xhc3RWYWx1ZSA9IHYKICAgICAgICB9CiAgICAgICAgU2V0UmVzZXRTdGF0ZSgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX3Jlc2V0X2FjdGlvbikgdGhpcy5fcmVzZXRfYWN0aW9uKHRoaXMpCiAgICAgICAgfQogICAgICAgIFNldEluaXRpYWxTdGF0ZSgpIHsKICAgICAgICAgICAgY29uc3QgaW5pdFZhbHVlID0gdGhpcy5fdHlwZUFkYXB0ZXIuU2V0SW5pdGlhbFN0YXRlKCk7CiAgICAgICAgICAgIGlmICh0eXBlb2YgaW5pdFZhbHVlID09PSAibnVtYmVyIikgdGhpcy5fbGFzdFZhbHVlID0gaW5pdFZhbHVlOwogICAgICAgICAgICBpZiAodGhpcy5faW5pdF9hY3Rpb24pIHsKICAgICAgICAgICAgICAgIGNvbnN0IHdpID0KICAgICAgICAgICAgICAgICAgICB0aGlzLkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICAgICAgY29uc3QgdHJhY2sgPSB0aGlzLl9wcm9wZXJ0eVRyYWNrLkdldFRyYWNrKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9pbml0X2FjdGlvbih0aGlzLCB3aSwgdHJhY2spCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgU2V0UmVzdW1lU3RhdGUoKSB7CiAgICAgICAgICAgIGNvbnN0IHJlc3VtZVZhbHVlID0gdGhpcy5fdHlwZUFkYXB0ZXIuU2V0UmVzdW1lU3RhdGUoKTsKICAgICAgICAgICAgaWYgKHR5cGVvZiByZXN1bWVWYWx1ZSA9PT0gIm51bWJlciIpIHRoaXMuX2xhc3RWYWx1ZSA9IHJlc3VtZVZhbHVlCiAgICAgICAgfQogICAgICAgIEdldEN1cnJlbnRTdGF0ZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX0dldHRlcigpCiAgICAgICAgfQogICAgICAgIENvbXBhcmVJbml0aWFsU3RhdGVXaXRoQ3VycmVudCgpIHsKICAgICAgICAgICAgY29uc3QgZmlyc3RLZXlmcmFtZVZhbHVlID0gdGhpcy5fRmlyc3RLZXlmcmFtZUdldHRlcigpOwogICAgICAgICAgICByZXR1cm4gZmlyc3RLZXlmcmFtZVZhbHVlICE9PSB0aGlzLkdldEN1cnJlbnRTdGF0ZSgpCiAgICAgICAgfQogICAgICAgIENvbXBhcmVTYXZlU3RhdGVXaXRoQ3VycmVudCgpIHsKICAgICAgICAgICAgaWYgKEMzLklzTnVsbE9yVW5kZWZpbmVkKHRoaXMuX3NhdmVTdGF0ZSkpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NhdmVTdGF0ZSAhPT0KICAgICAgICAgICAgICAgIHRoaXMuR2V0Q3VycmVudFN0YXRlKCkKICAgICAgICB9CiAgICAgICAgQmVmb3JlQ2hhbmdlUHJvcGVydHkoKSB7CiAgICAgICAgICAgIHRoaXMuX3R5cGVBZGFwdGVyLkJlZm9yZUNoYW5nZVByb3BlcnR5KCkKICAgICAgICB9CiAgICAgICAgQ2hhbmdlUHJvcGVydHkodGltZSwgdmFsdWUsIHN0YXJ0LCBlbmQsIHNldFRpbWUsIGVuc3VyZVZhbHVlLCBlbmRTdGF0ZSkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fdHlwZUFkYXB0ZXIuQ2hhbmdlUHJvcGVydHkodGltZSwgdmFsdWUsIHN0YXJ0LCBlbmQsIHNldFRpbWUsIGVuc3VyZVZhbHVlLCBlbmRTdGF0ZSkKICAgICAgICB9CiAgICAgICAgQWZ0ZXJDaGFuZ2VQcm9wZXJ0eSgpIHsKICAgICAgICAgICAgdGhpcy5fdHlwZUFkYXB0ZXIuQWZ0ZXJDaGFuZ2VQcm9wZXJ0eSgpCiAgICAgICAgfQogICAgICAgIF9HZXR0ZXIoKSB7CiAgICAgICAgICAgIGNvbnN0IHRhcmdldCA9IHRoaXMuX0dldFRhcmdldCgpOwogICAgICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMuX0dldEluZGV4KCk7CiAgICAgICAgICAgIGNvbnN0IHdpID0gdGhpcy5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgY29uc3QgdHJhY2sgPSB0aGlzLl9wcm9wZXJ0eVRyYWNrLkdldFRyYWNrKCk7CiAgICAgICAgICAgIGNvbnN0IGlkID0gdGhpcy5fcHJvcGVydHlUcmFjay5HZXRTb3VyY2VBZGFwdGVySWQoKTsKICAgICAgICAgICAgc3dpdGNoIChpZCkgewogICAgICAgICAgICAgICAgY2FzZSAiYmVoYXZpb3IiOgogICAgICAgICAgICAgICAgICAgIHJldHVybiB0YXJnZXQuR2V0UHJvcGVydHlWYWx1ZUJ5SW5kZXgoaW5kZXgpOwogICAgICAgICAgICAgICAgY2FzZSAiZWZmZWN0IjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGFyZ2V0W2luZGV4XTsKICAgICAgICAgICAgICAgIGNhc2UgImluc3RhbmNlLXZhcmlhYmxlIjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGFyZ2V0LkdldEluc3RhbmNlVmFyaWFibGVWYWx1ZShpbmRleCk7CiAgICAgICAgICAgICAgICBjYXNlICJwbHVnaW4iOgogICAgICAgICAgICAgICAgICAgIHJldHVybiB0YXJnZXQuR2V0UHJvcGVydHlWYWx1ZUJ5SW5kZXgoaW5kZXgpOwogICAgICAgICAgICAgICAgY2FzZSAid29ybGQtaW5zdGFuY2UiOgogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9pbnN0YW5jZV9nZXR0ZXIod2ksIHRyYWNrKTsKICAgICAgICAgICAgICAgIGNhc2UgImF1ZGlvIjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fc291cmNlX2FkYXB0ZXJfZ2V0dGVyLmNhbGwodGhpcy5HZXRTb3VyY2VBZGFwdGVyKCksIHdpLCB0cmFjaykKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBfU2V0dGVyKHZhbHVlLCBzdGFydCwgZW5kKSB7CiAgICAgICAgICAgIGNvbnN0IHRhcmdldCA9IHRoaXMuX0dldFRhcmdldCgpOwogICAgICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMuX0dldEluZGV4KCk7CiAgICAgICAgICAgIGNvbnN0IHdpID0gdGhpcy5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgY29uc3QgdHJhY2sgPSB0aGlzLl9wcm9wZXJ0eVRyYWNrLkdldFRyYWNrKCk7CiAgICAgICAgICAgIGNvbnN0IGlkID0gdGhpcy5fcHJvcGVydHlUcmFjay5HZXRTb3VyY2VBZGFwdGVySWQoKTsKICAgICAgICAgICAgc3dpdGNoIChpZCkgewogICAgICAgICAgICAgICAgY2FzZSAiYmVoYXZpb3IiOgogICAgICAgICAgICAgICAgICAgIHRhcmdldC5PZmZzZXRQcm9wZXJ0eVZhbHVlQnlJbmRleChpbmRleCwgdmFsdWUpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAiZWZmZWN0IjoKICAgICAgICAgICAgICAgICAgICB0YXJnZXRbaW5kZXhdICs9IHZhbHVlOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAiaW5zdGFuY2UtdmFyaWFibGUiOgogICAgICAgICAgICAgICAgICAgIHRhcmdldC5TZXRJbnN0YW5jZVZhcmlhYmxlT2Zmc2V0KGluZGV4LCB2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICJwbHVnaW4iOgogICAgICAgICAgICAgICAgICAgIHRhcmdldC5PZmZzZXRQcm9wZXJ0eVZhbHVlQnlJbmRleChpbmRleCwgdmFsdWUsIHRoaXMuR2V0U291cmNlQWRhcHRlcigpLkdldE9wdGlvbmFsQ2FsbGJhY2tzKCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAid29ybGQtaW5zdGFuY2UiOgogICAgICAgICAgICAgICAgICAgIHRoaXMuX2luc3RhbmNlX3NldHRlcih3aSwgdmFsdWUsIHRyYWNrLCB0aGlzKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgImF1ZGlvIjoKICAgICAgICAgICAgICAgICAgICB0aGlzLl9zb3VyY2VfYWRhcHRlcl9zZXR0ZXIuY2FsbCh0aGlzLkdldFNvdXJjZUFkYXB0ZXIoKSwgd2ksIHZhbHVlLCB0cmFjaywgdGhpcyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBfU2V0dGVyQWJzb2x1dGUodmFsdWUsCiAgICAgICAgICAgIHN0YXJ0LCBlbmQpIHsKICAgICAgICAgICAgY29uc3QgdGFyZ2V0ID0gdGhpcy5fR2V0VGFyZ2V0KCk7CiAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5fR2V0SW5kZXgoKTsKICAgICAgICAgICAgY29uc3Qgd2kgPSB0aGlzLkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICBjb25zdCB0cmFjayA9IHRoaXMuX3Byb3BlcnR5VHJhY2suR2V0VHJhY2soKTsKICAgICAgICAgICAgY29uc3QgaWQgPSB0aGlzLl9wcm9wZXJ0eVRyYWNrLkdldFNvdXJjZUFkYXB0ZXJJZCgpOwogICAgICAgICAgICBzd2l0Y2ggKGlkKSB7CiAgICAgICAgICAgICAgICBjYXNlICJiZWhhdmlvciI6CiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0LlNldFByb3BlcnR5VmFsdWVCeUluZGV4KGluZGV4LCB2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICJlZmZlY3QiOgogICAgICAgICAgICAgICAgICAgIHRhcmdldFtpbmRleF0gPSB2YWx1ZTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgImluc3RhbmNlLXZhcmlhYmxlIjoKICAgICAgICAgICAgICAgICAgICB0YXJnZXQuU2V0SW5zdGFuY2VWYXJpYWJsZVZhbHVlKGluZGV4LCB2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICJwbHVnaW4iOgogICAgICAgICAgICAgICAgICAgIHRhcmdldC5TZXRQcm9wZXJ0eVZhbHVlQnlJbmRleChpbmRleCwgdmFsdWUsIHRoaXMuR2V0U291cmNlQWRhcHRlcigpLkdldE9wdGlvbmFsQ2FsbGJhY2tzKCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAid29ybGQtaW5zdGFuY2UiOgogICAgICAgICAgICAgICAgICAgIHRoaXMuX2luc3RhbmNlX2Fic29sdXRlX3NldHRlcih3aSwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUsIHRyYWNrKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgImF1ZGlvIjoKICAgICAgICAgICAgICAgICAgICB0aGlzLl9zb3VyY2VfYWRhcHRlcl9hYnNvbHV0ZV9zZXR0ZXIuY2FsbCh0aGlzLkdldFNvdXJjZUFkYXB0ZXIoKSwgd2ksIHZhbHVlLCB0cmFjayk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBfTWF5YmVFbnN1cmVWYWx1ZSh0aW1lLCBzdGFydCwgZW5kLCBzZXRUaW1lLCBsYXN0VmFsdWUsIGN1cnJlbnRWYWx1ZSwgZm9yY2VFbmRWYWx1ZSwgZW5kU3RhdGUpIHsKICAgICAgICAgICAgdGhpcy5fdHlwZUFkYXB0ZXIuX01heWJlRW5zdXJlVmFsdWUodGltZSwgc3RhcnQsIGVuZCwgc2V0VGltZSwgbGFzdFZhbHVlLCBjdXJyZW50VmFsdWUsIGZvcmNlRW5kVmFsdWUsIGVuZFN0YXRlKQogICAgICAgIH0KICAgICAgICBfQWRkRGVsdGEodmFsdWUsIHN0YXJ0LCBlbmQsIGZvcmNlRW5kVmFsdWUsIGVuZFN0YXRlKSB7CiAgICAgICAgICAgIHN3aXRjaCAodGhpcy5fcHJvcGVydHlUcmFjay5HZXRQcm9wZXJ0eVR5cGUoKSkgewogICAgICAgICAgICAgICAgY2FzZSAiYW5nbGUiOgogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBDMy50b0RlZ3JlZXModmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBzdHJpbmdWYWx1ZSA9CiAgICAgICAgICAgICAgICB2YWx1ZS50b1N0cmluZygpOwogICAgICAgICAgICBjb25zdCBkZWNpbWFsc1N0cmluZyA9IHN0cmluZ1ZhbHVlLnNwbGl0KCIuIilbMV0gfHwgIiI7CiAgICAgICAgICAgIGNvbnN0IGRlY2ltYWxQbGFjZXMgPSBkZWNpbWFsc1N0cmluZy5sZW5ndGg7CiAgICAgICAgICAgIGNvbnN0IHYgPSB0aGlzLl9HZXR0ZXIoKTsKICAgICAgICAgICAgbGV0IHJ2OwogICAgICAgICAgICBpZiAoZGVjaW1hbFBsYWNlcyA9PT0gMCkKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9yb3VuZCkgcnYgPSBNYXRoLnJvdW5kKHYpOwogICAgICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5fZlJvdW5kKSBzd2l0Y2ggKHRoaXMuX3Byb3BlcnR5VHJhY2suR2V0UHJvcGVydHlUeXBlKCkpIHsKICAgICAgICAgICAgICAgIGNhc2UgImFuZ2xlIjoKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJ2ID0gQzMudG9SYWRpYW5zKE1hdGgucm91bmQoQzMudG9EZWdyZWVzKHYpKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJ2ID0gTWF0aC5yb3VuZCgodiArIE51bWJlci5FUFNJTE9OKSAqIDEwMCkgLyAxMDA7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgcnYgPSB2OwogICAgICAgICAgICBlbHNlIGlmICh0aGlzLl9yb3VuZCkgcnYgPSBOdW1iZXIoQzMudG9GaXhlZCh2LCBkZWNpbWFsUGxhY2VzKSk7CiAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuX2ZSb3VuZCkgcnYgPSB2OwogICAgICAgICAgICBlbHNlIHJ2ID0gdjsKICAgICAgICAgICAgdGhpcy5fU2V0dGVyKHJ2IC0KICAgICAgICAgICAgICAgIHYsIHN0YXJ0LCBlbmQpCiAgICAgICAgfQogICAgICAgIF9TYXZlVG9Kc29uKCkgewogICAgICAgICAgICByZXR1cm4gT2JqZWN0LmFzc2lnbihzdXBlci5fU2F2ZVRvSnNvbigpLCB7CiAgICAgICAgICAgICAgICAidiI6IHRoaXMuX2xhc3RWYWx1ZSwKICAgICAgICAgICAgICAgICJhIjogdGhpcy5fY2xhbXBBY2N1bXVsYXRvciwKICAgICAgICAgICAgICAgICJmb2QiOiB0aGlzLl90b3RhbEZvcmV3YXJkT3BhY2l0eURlbHRhLAogICAgICAgICAgICAgICAgImJvZCI6IHRoaXMuX3RvdGFsQmFja3dhcmRPcGFjaXR5RGVsdGEKICAgICAgICAgICAgfSkKICAgICAgICB9CiAgICAgICAgX0xvYWRGcm9tSnNvbihvKSB7CiAgICAgICAgICAgIGlmICghbykgcmV0dXJuOwogICAgICAgICAgICBzdXBlci5fTG9hZEZyb21Kc29uKG8pOwogICAgICAgICAgICB0aGlzLl9sYXN0VmFsdWUgPSBvWyJ2Il07CiAgICAgICAgICAgIHRoaXMuX2NsYW1wQWNjdW11bGF0b3IgPSBvWyJhIl07CiAgICAgICAgICAgIHRoaXMuX3RvdGFsRm9yZXdhcmRPcGFjaXR5RGVsdGEgPSBDMy5Jc0Zpbml0ZU51bWJlcihvWyJmb2QiXSkgPyBvWyJmb2QiXSA6IDA7CiAgICAgICAgICAgIHRoaXMuX3RvdGFsQmFja3dhcmRPcGFjaXR5RGVsdGEgPSBDMy5Jc0Zpbml0ZU51bWJlcihvWyJib2QiXSkgPyBvWyJib2QiXSA6IDAKICAgICAgICB9CiAgICB9CiAgICBDMy5Qcm9wZXJ0eVRyYWNrU3RhdGUuUHJvcGVydHlJbnRlcnBvbGF0aW9uQWRhcHRlci5OdW1lcmljSW50ZXJwb2xhdGlvbkFkYXB0ZXIgPSBOdW1lcmljSW50ZXJwb2xhdGlvbkFkYXB0ZXI7Cgp9CgovLyB0aW1lbGluZXMvc3RhdGUvcHJvcGVydHlJbnRlcnBvbGF0aW9uQWRhcHRlcnMvbnVtZXJpY0ludGVycG9sYXRpb25BZGFwdGVyRm9yVGltZWxpbmUuanMKewogICAgJ3VzZSBzdHJpY3QnOwogICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgY2xhc3MgQWJzb2x1dGVWYWx1ZU9iamVjdCB7CiAgICAgICAgY29uc3RydWN0b3IocHJvcGVydHlUcmFja3MpIHsKICAgICAgICAgICAgdGhpcy5fdXNlZCA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl92YWx1ZSA9IDA7CiAgICAgICAgICAgIHRoaXMuX3Byb3BlcnR5VHJhY2tzID0gcHJvcGVydHlUcmFja3M7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gdGhpcy5fcHJvcGVydHlUcmFja3MubGVuZ3RoOyBpIDwgbDsgaSsrKSB0aGlzLl9wcm9wZXJ0eVRyYWNrc1tpXS5TZXRBYnNvbHV0ZVZhbHVlT2JqZWN0KHRoaXMpCiAgICAgICAgfQogICAgICAgIEdldFByb3BlcnR5VHJhY2tzKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fcHJvcGVydHlUcmFja3MKICAgICAgICB9CiAgICAgICAgU2V0VXNlZCgpIHsKICAgICAgICAgICAgdGhpcy5fdXNlZCA9IHRydWUKICAgICAgICB9CiAgICAgICAgR2V0VXNlZCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3VzZWQKICAgICAgICB9CiAgICAgICAgU2V0VmFsdWUodikgewogICAgICAgICAgICB0aGlzLl92YWx1ZSA9IHYKICAgICAgICB9CiAgICAgICAgR2V0VmFsdWUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl92YWx1ZQogICAgICAgIH0KICAgICAgICBSZXNldCgpIHsKICAgICAgICAgICAgdGhpcy5fdXNlZCA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl92YWx1ZSA9IDAKICAgICAgICB9CiAgICB9CiAgICBjbGFzcyBOdW1lcmljSW50ZXJwb2xhdGlvbkFkYXB0ZXJGb3JUaW1lbGluZSB7CiAgICAgICAgY29uc3RydWN0b3IobnVtZXJpY0ludGVycG9sYXRpb25BZGFwdGVyKSB7CiAgICAgICAgICAgIHRoaXMuX251bWVyaWNJbnRlcnBvbGF0aW9uQWRhcHRlciA9IG51bWVyaWNJbnRlcnBvbGF0aW9uQWRhcHRlcgogICAgICAgIH0KICAgICAgICBSZWxlYXNlKCkgewogICAgICAgICAgICB0aGlzLl9udW1lcmljSW50ZXJwb2xhdGlvbkFkYXB0ZXIgPSBudWxsCiAgICAgICAgfQogICAgICAgIEdldFR5cGUoKSB7CiAgICAgICAgICAgIHJldHVybiAwCiAgICAgICAgfQogICAgICAgIFNldEluaXRpYWxTdGF0ZSgpIHsKICAgICAgICAgICAgY29uc3QgYWRhcHRlciA9IHRoaXMuX251bWVyaWNJbnRlcnBvbGF0aW9uQWRhcHRlcjsKICAgICAgICAgICAgY29uc3QgcHJvcGVydHlUcmFjayA9IHRoaXMuX251bWVyaWNJbnRlcnBvbGF0aW9uQWRhcHRlci5HZXRQcm9wZXJ0eVRyYWNrKCk7CiAgICAgICAgICAgIHJldHVybiBhZGFwdGVyLl9QaWNrUmVzdWx0TW9kZSgoKSA9PiB7CiAgICAgICAgICAgICAgICByZXR1cm4gYWRhcHRlci5fUGlja1RpbWVsaW5lUGxheWJhY2tNb2RlKCgpID0+IDAsICgpID0+IGFkYXB0ZXIuR2V0U291cmNlQWRhcHRlcigpLkdldFZhbHVlQXRUaW1lKCkpCiAgICAgICAgICAgIH0sICgpID0+IHt9KQogICAgICAgIH0KICAgICAgICBTZXRSZXN1bWVTdGF0ZSgpIHt9CiAgICAgICAgTWF5TmVlZEJlZm9yZUFuZEFmdGVySW50ZXJwb2xhdGUoKSB7CiAgICAgICAgICAgIGNvbnN0IGFkYXB0ZXIgPQogICAgICAgICAgICAgICAgdGhpcy5fbnVtZXJpY0ludGVycG9sYXRpb25BZGFwdGVyOwogICAgICAgICAgICBjb25zdCBwcm9wZXJ0eVRyYWNrID0gdGhpcy5fbnVtZXJpY0ludGVycG9sYXRpb25BZGFwdGVyLkdldFByb3BlcnR5VHJhY2soKTsKICAgICAgICAgICAgc3dpdGNoIChwcm9wZXJ0eVRyYWNrLkdldFJlc3VsdE1vZGUoKSkgewogICAgICAgICAgICAgICAgY2FzZSAicmVsYXRpdmUiOgogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2FzZSAiYWJzb2x1dGUiOgogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgQmVmb3JlQ2hhbmdlUHJvcGVydHkoKSB7CiAgICAgICAgICAgIGNvbnN0IGFkYXB0ZXIgPSB0aGlzLl9udW1lcmljSW50ZXJwb2xhdGlvbkFkYXB0ZXI7CiAgICAgICAgICAgIGNvbnN0IHByb3BlcnR5VHJhY2sgPSB0aGlzLl9udW1lcmljSW50ZXJwb2xhdGlvbkFkYXB0ZXIuR2V0UHJvcGVydHlUcmFjaygpOwogICAgICAgICAgICBjb25zdCBwcm9wZXJ0eSA9IHByb3BlcnR5VHJhY2suR2V0UHJvcGVydHlOYW1lKCk7CiAgICAgICAgICAgIHN3aXRjaCAocHJvcGVydHlUcmFjay5HZXRSZXN1bHRNb2RlKCkpIHsKICAgICAgICAgICAgICAgIGNhc2UgInJlbGF0aXZlIjoKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2FzZSAiYWJzb2x1dGUiOgogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHByb3BlcnR5VHJhY2suSGFzQWJzb2x1dGVWYWx1ZU9iamVjdCgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZU9iaiA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvcGVydHlUcmFjay5HZXRBYnNvbHV0ZVZhbHVlT2JqZWN0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZU9iai5SZXNldCgpCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0aW1lbGluZSA9IHByb3BlcnR5VHJhY2suR2V0VGltZWxpbmUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGluc3RhbmNlID0gcHJvcGVydHlUcmFjay5HZXRJbnN0YW5jZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc291cmNlQWRhcHRlciA9IHByb3BlcnR5VHJhY2suR2V0U291cmNlQWRhcHRlcigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2ltaWxhclByb3BlcnR5VHJhY2tzID0gdGltZWxpbmUuR2V0U2ltaWxhclByb3BlcnR5VHJhY2tzKGluc3RhbmNlLCBzb3VyY2VBZGFwdGVyLCBwcm9wZXJ0eSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2ltaWxhclByb3BlcnR5VHJhY2tzICYmIHNpbWlsYXJQcm9wZXJ0eVRyYWNrcy5sZW5ndGggPiAxKSBuZXcgQWJzb2x1dGVWYWx1ZU9iamVjdChzaW1pbGFyUHJvcGVydHlUcmFja3MpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgQ2hhbmdlUHJvcGVydHkodGltZSwgdmFsdWUsIHN0YXJ0LCBlbmQsIHNldFRpbWUsIGVuc3VyZVZhbHVlLCBlbmRTdGF0ZSkgewogICAgICAgICAgICBjb25zdCBhZGFwdGVyID0gdGhpcy5fbnVtZXJpY0ludGVycG9sYXRpb25BZGFwdGVyOwogICAgICAgICAgICBjb25zdCBwcm9wZXJ0eVRyYWNrID0gdGhpcy5fbnVtZXJpY0ludGVycG9sYXRpb25BZGFwdGVyLkdldFByb3BlcnR5VHJhY2soKTsKICAgICAgICAgICAgc3dpdGNoIChwcm9wZXJ0eVRyYWNrLkdldFJlc3VsdE1vZGUoKSkgewogICAgICAgICAgICAgICAgY2FzZSAicmVsYXRpdmUiOgogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbGFzdFZhbHVlID0gYWRhcHRlci5HZXRMYXN0VmFsdWUoKTthZGFwdGVyLl9TZXR0ZXIodmFsdWUgLSBsYXN0VmFsdWUsIHN0YXJ0LCBlbmQpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZW5zdXJlVmFsdWUpIHRoaXMuX01heWJlRW5zdXJlVmFsdWUodGltZSwgc3RhcnQsIGVuZCwgc2V0VGltZSwgbGFzdFZhbHVlLCB2YWx1ZSk7YWRhcHRlci5TZXRMYXN0VmFsdWUodmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNhc2UgImFic29sdXRlIjoKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRpbWVsaW5lID0gcHJvcGVydHlUcmFjay5HZXRUaW1lbGluZSgpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0cmFjayA9IHByb3BlcnR5VHJhY2suR2V0VHJhY2soKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5zdGFuY2UgPSBwcm9wZXJ0eVRyYWNrLkdldEluc3RhbmNlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHNvdXJjZUFkYXB0ZXIgPSBwcm9wZXJ0eVRyYWNrLkdldFNvdXJjZUFkYXB0ZXIoKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHByb3BlcnR5VHJhY2suSGFzQWJzb2x1dGVWYWx1ZU9iamVjdCgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhYnNvbHV0ZVZhbHVlT2JqZWN0ID0gcHJvcGVydHlUcmFjay5HZXRBYnNvbHV0ZVZhbHVlT2JqZWN0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzaW1pbGFycHJvcGVydHlUcmFja3MgPSBhYnNvbHV0ZVZhbHVlT2JqZWN0LkdldFByb3BlcnR5VHJhY2tzKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwcm9wZXJ0eUtleWZyYW1lU3R1YnMgPSBhZGFwdGVyLl9HZXRQcm9wZXJ0eUtleWZyYW1lU3R1YnMoc2ltaWxhcnByb3BlcnR5VHJhY2tzLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0dWIgPSBhZGFwdGVyLl9HZXRMYXN0UHJvcGVydHlLZXlmcmFtZVN0dWIodGltZWxpbmUsIHRpbWVsaW5lLkdldFRpbWUoKSwgcHJvcGVydHlLZXlmcmFtZVN0dWJzKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdHViKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RhcnRPZmZzZXQgPSB0cmFjay5HZXRTdGFydE9mZnNldCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHQgPSBzdHViLnRpbWUgLSBzdGFydE9mZnNldDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodCA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhYnNvbHV0ZVZhbHVlT2JqZWN0LlNldFVzZWQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWJzb2x1dGVWYWx1ZU9iamVjdC5TZXRWYWx1ZShhYnNvbHV0ZVZhbHVlT2JqZWN0LkdldFZhbHVlKCkgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHQgPCAwKSByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHYgPSBwcm9wZXJ0eVRyYWNrLkdldEludGVycG9sYXRlZFZhbHVlKHQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhYnNvbHV0ZVZhbHVlT2JqZWN0LlNldFVzZWQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWJzb2x1dGVWYWx1ZU9iamVjdC5TZXRWYWx1ZShhYnNvbHV0ZVZhbHVlT2JqZWN0LkdldFZhbHVlKCkgKyAodmFsdWUgLSB2KSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBhZGFwdGVyLl9TZXR0ZXJBYnNvbHV0ZSh2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIEFmdGVyQ2hhbmdlUHJvcGVydHkoKSB7CiAgICAgICAgICAgIGNvbnN0IGFkYXB0ZXIgPSB0aGlzLl9udW1lcmljSW50ZXJwb2xhdGlvbkFkYXB0ZXI7CiAgICAgICAgICAgIGNvbnN0IHByb3BlcnR5VHJhY2sgPSB0aGlzLl9udW1lcmljSW50ZXJwb2xhdGlvbkFkYXB0ZXIuR2V0UHJvcGVydHlUcmFjaygpOwogICAgICAgICAgICBzd2l0Y2ggKHByb3BlcnR5VHJhY2suR2V0UmVzdWx0TW9kZSgpKSB7CiAgICAgICAgICAgICAgICBjYXNlICJyZWxhdGl2ZSI6CiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNhc2UgImFic29sdXRlIjoKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwcm9wZXJ0eVRyYWNrLkhhc0Fic29sdXRlVmFsdWVPYmplY3QoKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYWJzb2x1dGVWYWx1ZU9iamVjdCA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvcGVydHlUcmFjay5HZXRBYnNvbHV0ZVZhbHVlT2JqZWN0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWJzb2x1dGVWYWx1ZU9iamVjdC5HZXRVc2VkKCkpIGFkYXB0ZXIuX1NldHRlckFic29sdXRlKGFic29sdXRlVmFsdWVPYmplY3QuR2V0VmFsdWUoKSkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBfTWF5YmVFbnN1cmVWYWx1ZSh0aW1lLCBzdGFydCwgZW5kLCBzZXRUaW1lLCBsYXN0VmFsdWUsIGN1cnJlbnRWYWx1ZSkgewogICAgICAgICAgICBjb25zdCBhZGFwdGVyID0gdGhpcy5fbnVtZXJpY0ludGVycG9sYXRpb25BZGFwdGVyOwogICAgICAgICAgICBpZiAoc2V0VGltZSkgcmV0dXJuOwogICAgICAgICAgICBpZiAoc3RhcnQgJiYgdGltZSA9PT0gc3RhcnQuR2V0VGltZSgpKSBhZGFwdGVyLl9BZGREZWx0YShzdGFydC5HZXRWYWx1ZVdpdGhSZXN1bHRNb2RlKCksIHN0YXJ0LCBlbmQpOwogICAgICAgICAgICBlbHNlIGlmIChlbmQgJiYgdGltZSA9PT0gZW5kLkdldFRpbWUoKSkgYWRhcHRlci5fQWRkRGVsdGEoZW5kLkdldFZhbHVlV2l0aFJlc3VsdE1vZGUoKSwgc3RhcnQsIGVuZCk7CiAgICAgICAgICAgIGVsc2UgaWYgKGN1cnJlbnRWYWx1ZSAtIGxhc3RWYWx1ZSA9PT0gMCkgYWRhcHRlci5fQWRkRGVsdGEoc3RhcnQuR2V0VmFsdWVXaXRoUmVzdWx0TW9kZSgpLAogICAgICAgICAgICAgICAgc3RhcnQsIGVuZCkKICAgICAgICB9CiAgICB9CiAgICBDMy5Qcm9wZXJ0eVRyYWNrU3RhdGUuUHJvcGVydHlJbnRlcnBvbGF0aW9uQWRhcHRlci5OdW1lcmljSW50ZXJwb2xhdGlvbkFkYXB0ZXJGb3JUaW1lbGluZSA9IE51bWVyaWNJbnRlcnBvbGF0aW9uQWRhcHRlckZvclRpbWVsaW5lOwoKfQoKLy8gdGltZWxpbmVzL3N0YXRlL3Byb3BlcnR5SW50ZXJwb2xhdGlvbkFkYXB0ZXJzL251bWVyaWNJbnRlcnBvbGF0aW9uQWRhcHRlckZvclR3ZWVuLmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIGNsYXNzIE51bWVyaWNJbnRlcnBvbGF0aW9uQWRhcHRlckZvclR3ZWVuIHsKICAgICAgICBjb25zdHJ1Y3RvcihudW1lcmljSW50ZXJwb2xhdGlvbkFkYXB0ZXIpIHsKICAgICAgICAgICAgdGhpcy5fbnVtZXJpY0ludGVycG9sYXRpb25BZGFwdGVyID0gbnVtZXJpY0ludGVycG9sYXRpb25BZGFwdGVyCiAgICAgICAgfQogICAgICAgIFJlbGVhc2UoKSB7CiAgICAgICAgICAgIHRoaXMuX251bWVyaWNJbnRlcnBvbGF0aW9uQWRhcHRlciA9IG51bGwKICAgICAgICB9CiAgICAgICAgR2V0VHlwZSgpIHsKICAgICAgICAgICAgcmV0dXJuIDEKICAgICAgICB9CiAgICAgICAgU2V0SW5pdGlhbFN0YXRlKCkgewogICAgICAgICAgICBjb25zdCBhZGFwdGVyID0gdGhpcy5fbnVtZXJpY0ludGVycG9sYXRpb25BZGFwdGVyOwogICAgICAgICAgICBhZGFwdGVyLlNldEZpcnN0QWJzb2x1dGVVcGRhdGUodHJ1ZSk7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9HZXRBYnNvbHV0ZUluaXRpYWxWYWx1ZShhZGFwdGVyLl9GaXJzdEtleWZyYW1lR2V0dGVyKCkpCiAgICAgICAgfQogICAgICAgIFNldFJlc3VtZVN0YXRlKCkgewogICAgICAgICAgICBjb25zdCBhZGFwdGVyID0gdGhpcy5fbnVtZXJpY0ludGVycG9sYXRpb25BZGFwdGVyOwogICAgICAgICAgICBpZiAoYWRhcHRlci5fRmlyc3RLZXlmcmFtZUdldHRlcigpID09PSBhZGFwdGVyLl9DdXJyZW50S2V5ZnJhbWVHZXR0ZXIoKSkgcmV0dXJuOwogICAgICAgICAgICBhZGFwdGVyLlNldEZpcnN0QWJzb2x1dGVVcGRhdGUodHJ1ZSk7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9HZXRBYnNvbHV0ZUluaXRpYWxWYWx1ZShhZGFwdGVyLl9DdXJyZW50S2V5ZnJhbWVHZXR0ZXIoKSkKICAgICAgICB9CiAgICAgICAgTWF5TmVlZEJlZm9yZUFuZEFmdGVySW50ZXJwb2xhdGUoKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZQogICAgICAgIH0KICAgICAgICBCZWZvcmVDaGFuZ2VQcm9wZXJ0eSgpIHt9CiAgICAgICAgQ2hhbmdlUHJvcGVydHkodGltZSwgdmFsdWUsIHN0YXJ0LCBlbmQsIHNldFRpbWUsIGVuc3VyZVZhbHVlLCBlbmRTdGF0ZSkgewogICAgICAgICAgICBjb25zdCBhZGFwdGVyID0gdGhpcy5fbnVtZXJpY0ludGVycG9sYXRpb25BZGFwdGVyOwogICAgICAgICAgICBjb25zdCBsYXN0VmFsdWUgPSBhZGFwdGVyLkdldExhc3RWYWx1ZSgpOwogICAgICAgICAgICBzd2l0Y2ggKGFkYXB0ZXIuR2V0UHJvcGVydHlUcmFjaygpLkdldFJlc3VsdE1vZGUoKSkgewogICAgICAgICAgICAgICAgY2FzZSAicmVsYXRpdmUiOgogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgYWRhcHRlci5fU2V0dGVyKHZhbHVlIC0gbGFzdFZhbHVlLCBzdGFydCwgZW5kKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVuc3VyZVZhbHVlKSB0aGlzLl9NYXliZUVuc3VyZVZhbHVlKHRpbWUsIHN0YXJ0LCBlbmQsIHNldFRpbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0VmFsdWUsIHZhbHVlLCBmYWxzZSwgZW5kU3RhdGUpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNhc2UgImFic29sdXRlIjoKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhZGFwdGVyLkdldEZpcnN0QWJzb2x1dGVVcGRhdGUoKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRhcHRlci5TZXRGaXJzdEFic29sdXRlVXBkYXRlKGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkYXB0ZXIuX1NldHRlcihsYXN0VmFsdWUsIHN0YXJ0LCBlbmQpCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGFwdGVyLl9TZXR0ZXIodmFsdWUgLSBsYXN0VmFsdWUsIHN0YXJ0LCBlbmQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVuc3VyZVZhbHVlKSB0aGlzLl9NYXliZUVuc3VyZVZhbHVlKHRpbWUsIHN0YXJ0LCBlbmQsIHNldFRpbWUsIGxhc3RWYWx1ZSwgdmFsdWUsIHRoaXMuX0ZvcmNlRW5kVmFsdWUoKSwgZW5kU3RhdGUpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYWRhcHRlci5TZXRMYXN0VmFsdWUodmFsdWUpCiAgICAgICAgfQogICAgICAgIEFmdGVyQ2hhbmdlUHJvcGVydHkoKSB7fQogICAgICAgIF9HZXRBYnNvbHV0ZUluaXRpYWxWYWx1ZShrZXlmcmFtZVZhbHVlKSB7CiAgICAgICAgICAgIGNvbnN0IGFkYXB0ZXIgPSB0aGlzLl9udW1lcmljSW50ZXJwb2xhdGlvbkFkYXB0ZXI7CiAgICAgICAgICAgIHJldHVybiBrZXlmcmFtZVZhbHVlIC0gYWRhcHRlci5HZXRDdXJyZW50U3RhdGUoKQogICAgICAgIH0KICAgICAgICBfRm9yY2VFbmRWYWx1ZSgpIHsKICAgICAgICAgICAgY29uc3QgYWRhcHRlciA9CiAgICAgICAgICAgICAgICB0aGlzLl9udW1lcmljSW50ZXJwb2xhdGlvbkFkYXB0ZXI7CiAgICAgICAgICAgIGNvbnN0IGluc3QgPSBhZGFwdGVyLkdldFdvcmxkSW5mbygpLkdldEluc3RhbmNlKCk7CiAgICAgICAgICAgIGNvbnN0IHJ1bnRpbWUgPSBhZGFwdGVyLkdldFByb3BlcnR5VHJhY2soKS5HZXRSdW50aW1lKCk7CiAgICAgICAgICAgIGNvbnN0IHRpbWVsaW5lTWFuYWdlciA9IHJ1bnRpbWUuR2V0VGltZWxpbmVNYW5hZ2VyKCk7CiAgICAgICAgICAgIGxldCBhY3RpdmVUaW1lbGluZUNvdW50ID0gMDsKICAgICAgICAgICAgZm9yIChjb25zdCB0aW1lbGluZSBvZiB0aW1lbGluZU1hbmFnZXIuR2V0UGxheWluZ1RpbWVsaW5lcygpKQogICAgICAgICAgICAgICAgaWYgKHRpbWVsaW5lLkdldFR5cGUoKSA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgIGlmICh0aW1lbGluZS5IYXNUcmFja0luc3RhbmNlKGluc3QpKSBhY3RpdmVUaW1lbGluZUNvdW50KysKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGltZWxpbmUuR2V0VHlwZSgpID09PSAxKQogICAgICAgICAgICAgICAgaWYgKHRpbWVsaW5lLkdldEluc3RhbmNlKCkgPT09IGluc3QpIGFjdGl2ZVRpbWVsaW5lQ291bnQrKzsKICAgICAgICAgICAgcmV0dXJuIGFjdGl2ZVRpbWVsaW5lQ291bnQgPD0gMQogICAgICAgIH0KICAgICAgICBfTWF5YmVFbnN1cmVWYWx1ZSh0aW1lLCBzdGFydCwKICAgICAgICAgICAgZW5kLCBzZXRUaW1lLCBsYXN0VmFsdWUsIGN1cnJlbnRWYWx1ZSwgZm9yY2VFbmRWYWx1ZSwgZW5kU3RhdGUpIHsKICAgICAgICAgICAgY29uc3QgYWRhcHRlciA9IHRoaXMuX251bWVyaWNJbnRlcnBvbGF0aW9uQWRhcHRlcjsKICAgICAgICAgICAgaWYgKHNldFRpbWUpCiAgICAgICAgICAgICAgICBpZiAoc3RhcnQgJiYgdGltZSA9PT0gc3RhcnQuR2V0VGltZSgpKSBhZGFwdGVyLl9BZGREZWx0YShzdGFydC5HZXRWYWx1ZVdpdGhSZXN1bHRNb2RlKCksIHN0YXJ0LCBlbmQsIGZvcmNlRW5kVmFsdWUsIGVuZFN0YXRlKTsKICAgICAgICAgICAgICAgIGVsc2UgaWYgKGVuZCAmJiB0aW1lID09PSBlbmQuR2V0VGltZSgpKSBhZGFwdGVyLl9BZGREZWx0YShlbmQuR2V0VmFsdWVXaXRoUmVzdWx0TW9kZSgpLCBzdGFydCwgZW5kLCBmb3JjZUVuZFZhbHVlLCBlbmRTdGF0ZSk7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgaWYgKCFlbmQpIGFkYXB0ZXIuX0FkZERlbHRhKHN0YXJ0LkdldFZhbHVlV2l0aFJlc3VsdE1vZGUoKSwgc3RhcnQsIGVuZCwgZm9yY2VFbmRWYWx1ZSwgZW5kU3RhdGUpCiAgICAgICAgICAgIH0gZWxzZSBpZiAoc3RhcnQgJiYgdGltZSA9PT0gc3RhcnQuR2V0VGltZSgpKSBhZGFwdGVyLl9BZGREZWx0YShzdGFydC5HZXRWYWx1ZVdpdGhSZXN1bHRNb2RlKCksCiAgICAgICAgICAgICAgICBzdGFydCwgZW5kLCBmb3JjZUVuZFZhbHVlLCBlbmRTdGF0ZSk7CiAgICAgICAgICAgIGVsc2UgaWYgKGVuZCAmJiB0aW1lID09PSBlbmQuR2V0VGltZSgpKSBhZGFwdGVyLl9BZGREZWx0YShlbmQuR2V0VmFsdWVXaXRoUmVzdWx0TW9kZSgpLCBzdGFydCwgZW5kLCBmb3JjZUVuZFZhbHVlLCBlbmRTdGF0ZSk7CiAgICAgICAgICAgIGVsc2UgaWYgKGN1cnJlbnRWYWx1ZSAtIGxhc3RWYWx1ZSA9PT0gMCkgYWRhcHRlci5fQWRkRGVsdGEoc3RhcnQuR2V0VmFsdWVXaXRoUmVzdWx0TW9kZSgpLCBzdGFydCwgZW5kLCBmb3JjZUVuZFZhbHVlLCBlbmRTdGF0ZSkKICAgICAgICB9CiAgICB9CiAgICBDMy5Qcm9wZXJ0eVRyYWNrU3RhdGUuUHJvcGVydHlJbnRlcnBvbGF0aW9uQWRhcHRlci5OdW1lcmljSW50ZXJwb2xhdGlvbkFkYXB0ZXJGb3JUd2VlbiA9IE51bWVyaWNJbnRlcnBvbGF0aW9uQWRhcHRlckZvclR3ZWVuOwoKfQoKLy8gdGltZWxpbmVzL3N0YXRlL3Byb3BlcnR5VHlwZUFkYXB0ZXJzL251bWVyaWNUeXBlQWRhcHRlci5qcwp7CiAgICAndXNlIHN0cmljdCc7CiAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICBjb25zdCBFYXNlID0gc2VsZi5FYXNlOwogICAgQzMuUHJvcGVydHlUcmFja1N0YXRlLk51bWVyaWNUeXBlQWRhcHRlciA9IGNsYXNzIE51bWVyaWNUeXBlQWRhcHRlciB7CiAgICAgICAgY29uc3RydWN0b3IoKSB7fQogICAgICAgIHN0YXRpYyBXaWxsQ2hhbmdlKGluZGV4LCBzb3VyY2UsIG5ld1ZhbHVlLCB0eXBlKSB7CiAgICAgICAgICAgIGxldCBvbGRWYWx1ZTsKICAgICAgICAgICAgc3dpdGNoICh0eXBlKSB7CiAgICAgICAgICAgICAgICBjYXNlICJiZWhhdmlvciI6CiAgICAgICAgICAgICAgICAgICAgb2xkVmFsdWUgPSBzb3VyY2UuR2V0UHJvcGVydHlWYWx1ZUJ5SW5kZXgoaW5kZXgpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAiZWZmZWN0IjoKICAgICAgICAgICAgICAgICAgICBvbGRWYWx1ZSA9IHNvdXJjZVtpbmRleF07CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICJpbnN0YW5jZS12YXJpYWJsZSI6CiAgICAgICAgICAgICAgICAgICAgb2xkVmFsdWUgPSBzb3VyY2UuR2V0SW5zdGFuY2VWYXJpYWJsZVZhbHVlKGluZGV4KTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgInBsdWdpbiI6CiAgICAgICAgICAgICAgICAgICAgb2xkVmFsdWUgPSBzb3VyY2UuR2V0UHJvcGVydHlWYWx1ZUJ5SW5kZXgoaW5kZXgpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG9sZFZhbHVlID09PSBuZXdWYWx1ZSkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgIH0KICAgICAgICBzdGF0aWMgSW50ZXJwb2xhdGUodGltZSwgc3RhcnQsIGVuZCwgcHJvcGVydHlUcmFjaykgewogICAgICAgICAgICBpZiAoIWVuZCkgewogICAgICAgICAgICAgICAgbGV0IHByb3BlcnR5VHJhY2tEYXRhSXRlbSA9CiAgICAgICAgICAgICAgICAgICAgcHJvcGVydHlUcmFjay5HZXRQcm9wZXJ0eVRyYWNrRGF0YUl0ZW0oKTsKICAgICAgICAgICAgICAgIGNvbnN0IHByb3BlcnR5VHJhY2tEYXRhID0gcHJvcGVydHlUcmFjay5HZXRQcm9wZXJ0eVRyYWNrRGF0YSgpOwogICAgICAgICAgICAgICAgcHJvcGVydHlUcmFja0RhdGFJdGVtID0gcHJvcGVydHlUcmFja0RhdGEuR2V0TGFzdFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbShwcm9wZXJ0eVRyYWNrRGF0YUl0ZW0pOwogICAgICAgICAgICAgICAgcmV0dXJuIHByb3BlcnR5VHJhY2tEYXRhSXRlbS5HZXRWYWx1ZVdpdGhSZXN1bHRNb2RlKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBsZXQgbW9kZSA9IHByb3BlcnR5VHJhY2suR2V0SW50ZXJwb2xhdGlvbk1vZGUoKTsKICAgICAgICAgICAgaWYgKG1vZGUgPT09ICJkZWZhdWx0IikgbW9kZSA9ICJjb250aW51b3VzIjsKICAgICAgICAgICAgaWYgKHByb3BlcnR5VHJhY2suR2V0UHJvcGVydHlUeXBlKCkgPT09ICJjb21ibyIpIG1vZGUgPSAiZGlzY3JldGUiOwogICAgICAgICAgICBpZiAobW9kZSA9PT0gImRpc2NyZXRlIikgcmV0dXJuIHN0YXJ0LkdldFZhbHVlV2l0aFJlc3VsdE1vZGUoKTsKICAgICAgICAgICAgZWxzZSBpZiAobW9kZSA9PT0gImNvbnRpbnVvdXMiIHx8IG1vZGUgPT09ICJzdGVwIikgewogICAgICAgICAgICAgICAgaWYgKG1vZGUgPT09CiAgICAgICAgICAgICAgICAgICAgInN0ZXAiKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RlcCA9IHByb3BlcnR5VHJhY2suR2V0VGltZWxpbmUoKS5HZXRTdGVwKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHN0ZXAgIT09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcyA9IDEgLyBzdGVwOwogICAgICAgICAgICAgICAgICAgICAgICB0aW1lID0gTWF0aC5mbG9vcih0aW1lICogcykgLyBzCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY29uc3Qgc3YgPSBzdGFydC5HZXRWYWx1ZVdpdGhSZXN1bHRNb2RlKCk7CiAgICAgICAgICAgICAgICBjb25zdCBldiA9IGVuZC5HZXRWYWx1ZVdpdGhSZXN1bHRNb2RlKCk7CiAgICAgICAgICAgICAgICBjb25zdCBzdGFydEFkZG9uID0gc3RhcnQuR2V0QWRkT24oImN1YmljLWJlemllciIpOwogICAgICAgICAgICAgICAgY29uc3QgZW5kQWRkb24gPSBlbmQuR2V0QWRkT24oImN1YmljLWJlemllciIpOwogICAgICAgICAgICAgICAgY29uc3QgZG9DdWJpY0JlemllciA9IHN0YXJ0QWRkb24gJiYgc3RhcnRBZGRvbi5HZXRTdGFydEVuYWJsZSgpICYmIGVuZEFkZG9uICYmIGVuZEFkZG9uLkdldEVuZEVuYWJsZSgpOwogICAgICAgICAgICAgICAgaWYgKCFkb0N1YmljQmV6aWVyICYmIHN2ID09PSBldikgcmV0dXJuIHN2OwogICAgICAgICAgICAgICAgY29uc3Qgc3QgPSBzdGFydC5HZXRUaW1lKCk7CiAgICAgICAgICAgICAgICBjb25zdCBldCA9IGVuZC5HZXRUaW1lKCk7CiAgICAgICAgICAgICAgICBjb25zdCBuID0gQzMubm9ybWFsaXplKHRpbWUsIHN0LCBldCk7CiAgICAgICAgICAgICAgICBjb25zdCBlID0KICAgICAgICAgICAgICAgICAgICBzdGFydC5HZXRFYXNlKCk7CiAgICAgICAgICAgICAgICBsZXQgcmV0OwogICAgICAgICAgICAgICAgaWYgKGRvQ3ViaWNCZXppZXIpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBkdCA9IGV0IC0gc3Q7CiAgICAgICAgICAgICAgICAgICAgcmV0ID0gRWFzZS5HZXRSdW50aW1lRWFzZShlKShkdCAqIG4sIDAsIDEsIGR0KTsKICAgICAgICAgICAgICAgICAgICByZXQgPSBFYXNlLkdldFJ1bnRpbWVFYXNlKCJjdWJpY2JlemllciIpKHJldCwgc3YsIHN2ICsgc3RhcnRBZGRvbi5HZXRTdGFydEFuY2hvcigpLCBldiArIGVuZEFkZG9uLkdldEVuZEFuY2hvcigpLCBldikKICAgICAgICAgICAgICAgIH0gZWxzZSByZXQgPSBFYXNlLkdldFJ1bnRpbWVFYXNlKGUpKChldCAtIHN0KSAqIG4sIHN2LCBldiAtIHN2LCBldCAtIHN0KTsKICAgICAgICAgICAgICAgIGlmIChwcm9wZXJ0eVRyYWNrLkdldFByb3BlcnR5VHlwZSgpID09PSAiaW50ZWdlciIpIHJldHVybiBNYXRoLmZsb29yKHJldCk7CiAgICAgICAgICAgICAgICByZXR1cm4gcmV0CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwoKfQoKLy8gdGltZWxpbmVzL3N0YXRlL3Byb3BlcnR5VHlwZUFkYXB0ZXJzL2FuZ2xlVHlwZUFkYXB0ZXIuanMKewogICAgJ3VzZSBzdHJpY3QnOwogICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgQzMuUHJvcGVydHlUcmFja1N0YXRlLkFuZ2xlVHlwZUFkYXB0ZXIgPSBjbGFzcyBBbmdsZVR5cGVBZGFwdGVyIHsKICAgICAgICBjb25zdHJ1Y3RvcigpIHt9CiAgICAgICAgc3RhdGljIFdpbGxDaGFuZ2UoaW5kZXgsIHNvdXJjZSwgbmV3VmFsdWUsIHR5cGUpIHsKICAgICAgICAgICAgbGV0IG9sZFZhbHVlOwogICAgICAgICAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgICAgICAgICAgIGNhc2UgImJlaGF2aW9yIjoKICAgICAgICAgICAgICAgICAgICBvbGRWYWx1ZSA9IHNvdXJjZS5HZXRQcm9wZXJ0eVZhbHVlQnlJbmRleChpbmRleCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICJlZmZlY3QiOgogICAgICAgICAgICAgICAgICAgIG9sZFZhbHVlID0gc291cmNlW2luZGV4XTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgImluc3RhbmNlLXZhcmlhYmxlIjoKICAgICAgICAgICAgICAgICAgICBvbGRWYWx1ZSA9IHNvdXJjZS5HZXRJbnN0YW5jZVZhcmlhYmxlVmFsdWUoaW5kZXgpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAicGx1Z2luIjoKICAgICAgICAgICAgICAgICAgICBvbGRWYWx1ZSA9IHNvdXJjZS5HZXRQcm9wZXJ0eVZhbHVlQnlJbmRleChpbmRleCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAob2xkVmFsdWUgPT09IG5ld1ZhbHVlKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgfQogICAgICAgIHN0YXRpYyBJbnRlcnBvbGF0ZSh0aW1lLCBzdGFydCwgZW5kLCBwcm9wZXJ0eVRyYWNrKSB7CiAgICAgICAgICAgIGlmICghZW5kKSB7CiAgICAgICAgICAgICAgICBsZXQgcHJvcGVydHlUcmFja0RhdGFJdGVtID0KICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eVRyYWNrLkdldFByb3BlcnR5VHJhY2tEYXRhSXRlbSgpOwogICAgICAgICAgICAgICAgY29uc3QgcHJvcGVydHlUcmFja0RhdGEgPSBwcm9wZXJ0eVRyYWNrLkdldFByb3BlcnR5VHJhY2tEYXRhKCk7CiAgICAgICAgICAgICAgICBwcm9wZXJ0eVRyYWNrRGF0YUl0ZW0gPSBwcm9wZXJ0eVRyYWNrRGF0YS5HZXRMYXN0UHJvcGVydHlLZXlmcmFtZURhdGFJdGVtKHByb3BlcnR5VHJhY2tEYXRhSXRlbSk7CiAgICAgICAgICAgICAgICByZXR1cm4gcHJvcGVydHlUcmFja0RhdGFJdGVtLkdldFZhbHVlV2l0aFJlc3VsdE1vZGUoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGxldCBtb2RlID0gcHJvcGVydHlUcmFjay5HZXRJbnRlcnBvbGF0aW9uTW9kZSgpOwogICAgICAgICAgICBpZiAobW9kZSA9PT0gImRlZmF1bHQiKSBtb2RlID0gImNvbnRpbnVvdXMiOwogICAgICAgICAgICBpZiAocHJvcGVydHlUcmFjay5HZXRQcm9wZXJ0eVR5cGUoKSA9PT0gImNvbWJvIikgbW9kZSA9ICJkaXNjcmV0ZSI7CiAgICAgICAgICAgIGlmIChtb2RlID09PSAiZGlzY3JldGUiKSByZXR1cm4gc3RhcnQuR2V0VmFsdWVXaXRoUmVzdWx0TW9kZSgpOwogICAgICAgICAgICBlbHNlIGlmIChtb2RlID09PSAiY29udGludW91cyIgfHwgbW9kZSA9PT0gInN0ZXAiKSB7CiAgICAgICAgICAgICAgICBpZiAobW9kZSA9PT0KICAgICAgICAgICAgICAgICAgICAic3RlcCIpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBzdGVwID0gcHJvcGVydHlUcmFjay5HZXRUaW1lbGluZSgpLkdldFN0ZXAoKTsKICAgICAgICAgICAgICAgICAgICBpZiAoc3RlcCAhPT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzID0gMSAvIHN0ZXA7CiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWUgPSBNYXRoLmZsb29yKHRpbWUgKiBzKSAvIHMKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjb25zdCBzdCA9IHN0YXJ0LkdldFRpbWUoKTsKICAgICAgICAgICAgICAgIGNvbnN0IGV0ID0gZW5kLkdldFRpbWUoKTsKICAgICAgICAgICAgICAgIGNvbnN0IHN2ID0gc3RhcnQuR2V0VmFsdWVXaXRoUmVzdWx0TW9kZSgpOwogICAgICAgICAgICAgICAgY29uc3QgZXYgPSBlbmQuR2V0VmFsdWVXaXRoUmVzdWx0TW9kZSgpOwogICAgICAgICAgICAgICAgY29uc3QgYW5nbGVBZGRvbiA9IHN0YXJ0LkdldEFkZE9uKCJhbmdsZSIpOwogICAgICAgICAgICAgICAgaWYgKGFuZ2xlQWRkb24pIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCByZXZvbHV0aW9ucyA9IGFuZ2xlQWRkb24uR2V0UmV2b2x1dGlvbnMoKTsKICAgICAgICAgICAgICAgICAgICBpZiAoc3YgPT09IGV2ICYmIHJldm9sdXRpb25zID09PSAwKSByZXR1cm4gc3Y7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgbiA9IEMzLm5vcm1hbGl6ZSh0aW1lLCBzdCwgZXQpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGVhc2VGdW5jID0gc2VsZi5FYXNlLkdldFJ1bnRpbWVFYXNlKHN0YXJ0LkdldEVhc2UoKSk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZWFzZVJlcyA9IGVhc2VGdW5jKG4sIDAsIDEsIDEpOwogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoYW5nbGVBZGRvbi5HZXREaXJlY3Rpb24oKSkgewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJjbG9zZXN0IjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBDMy5hbmdsZUxlcnAoc3YsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXYsIGVhc2VSZXMsIHJldm9sdXRpb25zKTsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiY2xvY2t3aXNlIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBDMy5hbmdsZUxlcnBDbG9ja3dpc2Uoc3YsIGV2LCBlYXNlUmVzLCByZXZvbHV0aW9ucyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImFudGktY2xvY2t3aXNlIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBDMy5hbmdsZUxlcnBBbnRpQ2xvY2t3aXNlKHN2LCBldiwgZWFzZVJlcywgcmV2b2x1dGlvbnMpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBpZiAoc3YgPT09IGV2KSByZXR1cm4gc3Y7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgbiA9IEMzLm5vcm1hbGl6ZSh0aW1lLCBzdCwgZXQpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGVhc2VGdW5jID0gc2VsZi5FYXNlLkdldFJ1bnRpbWVFYXNlKHN0YXJ0LkdldEVhc2UoKSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEMzLmFuZ2xlTGVycChzdiwgZXYsIGVhc2VGdW5jKG4sIDAsIDEsIDEpKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKCn0KCi8vIHRpbWVsaW5lcy9zdGF0ZS9wcm9wZXJ0eVR5cGVBZGFwdGVycy9ib29sZWFuVHlwZUFkYXB0ZXIuanMKewogICAgJ3VzZSBzdHJpY3QnOwogICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgQzMuUHJvcGVydHlUcmFja1N0YXRlLkJvb2xlYW5UeXBlQWRhcHRlciA9IGNsYXNzIEJvb2xlYW5UeXBlQWRhcHRlciB7CiAgICAgICAgY29uc3RydWN0b3IoKSB7fQogICAgICAgIHN0YXRpYyBXaWxsQ2hhbmdlKGluZGV4LCBzb3VyY2UsIG5ld1ZhbHVlLCB0eXBlKSB7CiAgICAgICAgICAgIGxldCBvbGRWYWx1ZTsKICAgICAgICAgICAgc3dpdGNoICh0eXBlKSB7CiAgICAgICAgICAgICAgICBjYXNlICJiZWhhdmlvciI6CiAgICAgICAgICAgICAgICAgICAgb2xkVmFsdWUgPSBzb3VyY2UuR2V0UHJvcGVydHlWYWx1ZUJ5SW5kZXgoaW5kZXgpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAiZWZmZWN0IjoKICAgICAgICAgICAgICAgICAgICBvbGRWYWx1ZSA9IHNvdXJjZVtpbmRleF07CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICJpbnN0YW5jZS12YXJpYWJsZSI6CiAgICAgICAgICAgICAgICAgICAgb2xkVmFsdWUgPSBzb3VyY2UuR2V0SW5zdGFuY2VWYXJpYWJsZVZhbHVlKGluZGV4KTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgInBsdWdpbiI6CiAgICAgICAgICAgICAgICAgICAgb2xkVmFsdWUgPSBzb3VyY2UuR2V0UHJvcGVydHlWYWx1ZUJ5SW5kZXgoaW5kZXgpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCEhb2xkVmFsdWUgPT09ICEhbmV3VmFsdWUpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICB9CiAgICAgICAgc3RhdGljIEludGVycG9sYXRlKHRpbWUsIHN0YXJ0LCBlbmQsIHByb3BlcnR5VHJhY2spIHsKICAgICAgICAgICAgaWYgKCFlbmQpIHsKICAgICAgICAgICAgICAgIGxldCBwcm9wZXJ0eVRyYWNrRGF0YUl0ZW0gPQogICAgICAgICAgICAgICAgICAgIHByb3BlcnR5VHJhY2suR2V0UHJvcGVydHlUcmFja0RhdGFJdGVtKCk7CiAgICAgICAgICAgICAgICBjb25zdCBwcm9wZXJ0eVRyYWNrRGF0YSA9IHByb3BlcnR5VHJhY2suR2V0UHJvcGVydHlUcmFja0RhdGEoKTsKICAgICAgICAgICAgICAgIHByb3BlcnR5VHJhY2tEYXRhSXRlbSA9IHByb3BlcnR5VHJhY2tEYXRhLkdldExhc3RQcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW0ocHJvcGVydHlUcmFja0RhdGFJdGVtKTsKICAgICAgICAgICAgICAgIHJldHVybiBwcm9wZXJ0eVRyYWNrRGF0YUl0ZW0uR2V0VmFsdWVXaXRoUmVzdWx0TW9kZSgpID8gMSA6IDAKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gc3RhcnQuR2V0VmFsdWVXaXRoUmVzdWx0TW9kZSgpID8gMSA6IDAKICAgICAgICB9CiAgICB9OwoKfQoKLy8gdGltZWxpbmVzL3N0YXRlL3Byb3BlcnR5VHlwZUFkYXB0ZXJzL2NvbG9yVHlwZUFkYXB0ZXIuanMKewogICAgJ3VzZSBzdHJpY3QnOwogICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgY29uc3QgVEVNUF9DT0xPUl9BUlJBWSA9IFswLCAwLCAwXTsKICAgIGNvbnN0IFRFTVBfQ09MT1JfQVJSQVlfMiA9IFswLCAwLCAwXTsKICAgIGNvbnN0IFRFTVBfQ09MT1JfQVJSQVlfMyA9IFswLCAwLCAwXTsKICAgIEMzLlByb3BlcnR5VHJhY2tTdGF0ZS5Db2xvclR5cGVBZGFwdGVyID0gY2xhc3MgQ29sb3JUeXBlQWRhcHRlciB7CiAgICAgICAgY29uc3RydWN0b3IoKSB7fQogICAgICAgIHN0YXRpYyBXaWxsQ2hhbmdlKGluZGV4LCBzb3VyY2UsIG5ld1ZhbHVlLCB0eXBlKSB7CiAgICAgICAgICAgIGxldCBvbGRWYWx1ZTsKICAgICAgICAgICAgc3dpdGNoICh0eXBlKSB7CiAgICAgICAgICAgICAgICBjYXNlICJiZWhhdmlvciI6CiAgICAgICAgICAgICAgICAgICAgb2xkVmFsdWUgPSBzb3VyY2UuR2V0UHJvcGVydHlWYWx1ZUJ5SW5kZXgoaW5kZXgpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAiZWZmZWN0IjoKICAgICAgICAgICAgICAgICAgICBvbGRWYWx1ZSA9IHNvdXJjZVtpbmRleF07CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICJpbnN0YW5jZS12YXJpYWJsZSI6CiAgICAgICAgICAgICAgICAgICAgb2xkVmFsdWUgPSBzb3VyY2UuR2V0SW5zdGFuY2VWYXJpYWJsZVZhbHVlKGluZGV4KTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgInBsdWdpbiI6CiAgICAgICAgICAgICAgICAgICAgb2xkVmFsdWUgPSBzb3VyY2UuR2V0UHJvcGVydHlWYWx1ZUJ5SW5kZXgoaW5kZXgpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkobmV3VmFsdWUpKSB7CiAgICAgICAgICAgICAgICBURU1QX0NPTE9SX0FSUkFZWzBdID0gbmV3VmFsdWVbMF07CiAgICAgICAgICAgICAgICBURU1QX0NPTE9SX0FSUkFZWzFdID0gbmV3VmFsdWVbMV07CiAgICAgICAgICAgICAgICBURU1QX0NPTE9SX0FSUkFZWzJdID0KICAgICAgICAgICAgICAgICAgICBuZXdWYWx1ZVsyXQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgVEVNUF9DT0xPUl9BUlJBWV8zLnBhcnNlQ29tbWFTZXBhcmF0ZWRSZ2IobmV3VmFsdWUpOwogICAgICAgICAgICAgICAgVEVNUF9DT0xPUl9BUlJBWVswXSA9IE1hdGguZmxvb3IoVEVNUF9DT0xPUl9BUlJBWV8zLmdldFIoKSAqIDI1NSk7CiAgICAgICAgICAgICAgICBURU1QX0NPTE9SX0FSUkFZWzFdID0gTWF0aC5mbG9vcihURU1QX0NPTE9SX0FSUkFZXzMuZ2V0RygpICogMjU1KTsKICAgICAgICAgICAgICAgIFRFTVBfQ09MT1JfQVJSQVlbMl0gPSBNYXRoLmZsb29yKFRFTVBfQ09MT1JfQVJSQVlfMy5nZXRCKCkgKiAyNTUpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkob2xkVmFsdWUpKSB7CiAgICAgICAgICAgICAgICBURU1QX0NPTE9SX0FSUkFZXzJbMF0gPSBvbGRWYWx1ZVswXTsKICAgICAgICAgICAgICAgIFRFTVBfQ09MT1JfQVJSQVlfMlsxXSA9IG9sZFZhbHVlWzFdOwogICAgICAgICAgICAgICAgVEVNUF9DT0xPUl9BUlJBWV8yWzJdID0gb2xkVmFsdWVbMl0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIFRFTVBfQ09MT1JfQVJSQVlfMy5wYXJzZUNvbW1hU2VwYXJhdGVkUmdiKG9sZFZhbHVlKTsKICAgICAgICAgICAgICAgIFRFTVBfQ09MT1JfQVJSQVlfMlswXSA9IE1hdGguZmxvb3IoVEVNUF9DT0xPUl9BUlJBWV8zLmdldFIoKSAqCiAgICAgICAgICAgICAgICAgICAgMjU1KTsKICAgICAgICAgICAgICAgIFRFTVBfQ09MT1JfQVJSQVlfMlsxXSA9IE1hdGguZmxvb3IoVEVNUF9DT0xPUl9BUlJBWV8zLmdldEcoKSAqIDI1NSk7CiAgICAgICAgICAgICAgICBURU1QX0NPTE9SX0FSUkFZXzJbMl0gPSBNYXRoLmZsb29yKFRFTVBfQ09MT1JfQVJSQVlfMy5nZXRCKCkgKiAyNTUpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKFRFTVBfQ09MT1JfQVJSQVlbMF0gIT09IFRFTVBfQ09MT1JfQVJSQVlfMlswXSkgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIGlmIChURU1QX0NPTE9SX0FSUkFZWzFdICE9PSBURU1QX0NPTE9SX0FSUkFZXzJbMV0pIHJldHVybiB0cnVlOwogICAgICAgICAgICBpZiAoVEVNUF9DT0xPUl9BUlJBWVsyXSAhPT0gVEVNUF9DT0xPUl9BUlJBWV8yWzJdKSByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgfQogICAgICAgIHN0YXRpYyBJbnRlcnBvbGF0ZSh0aW1lLCBzdGFydCwgZW5kLCBwcm9wZXJ0eVRyYWNrKSB7CiAgICAgICAgICAgIGlmICghZW5kKSB7CiAgICAgICAgICAgICAgICBsZXQgcHJvcGVydHlUcmFja0RhdGFJdGVtID0gcHJvcGVydHlUcmFjay5HZXRQcm9wZXJ0eVRyYWNrRGF0YUl0ZW0oKTsKICAgICAgICAgICAgICAgIGNvbnN0IHByb3BlcnR5VHJhY2tEYXRhID0gcHJvcGVydHlUcmFjay5HZXRQcm9wZXJ0eVRyYWNrRGF0YSgpOwogICAgICAgICAgICAgICAgcHJvcGVydHlUcmFja0RhdGFJdGVtID0gcHJvcGVydHlUcmFja0RhdGEuR2V0TGFzdFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbShwcm9wZXJ0eVRyYWNrRGF0YUl0ZW0pOwogICAgICAgICAgICAgICAgY29uc3QgY29sb3IgPSBwcm9wZXJ0eVRyYWNrRGF0YUl0ZW0uR2V0VmFsdWVXaXRoUmVzdWx0TW9kZSgpOwogICAgICAgICAgICAgICAgVEVNUF9DT0xPUl9BUlJBWVswXSA9IGNvbG9yWzBdOwogICAgICAgICAgICAgICAgVEVNUF9DT0xPUl9BUlJBWVsxXSA9IGNvbG9yWzFdOwogICAgICAgICAgICAgICAgVEVNUF9DT0xPUl9BUlJBWVsyXSA9IGNvbG9yWzJdOwogICAgICAgICAgICAgICAgcmV0dXJuIFRFTVBfQ09MT1JfQVJSQVkKICAgICAgICAgICAgfQogICAgICAgICAgICBsZXQgbW9kZSA9IHByb3BlcnR5VHJhY2suR2V0SW50ZXJwb2xhdGlvbk1vZGUoKTsKICAgICAgICAgICAgaWYgKG1vZGUgPT09ICJkZWZhdWx0IikgbW9kZSA9ICJjb250aW51b3VzIjsKICAgICAgICAgICAgaWYgKG1vZGUgPT09ICJkaXNjcmV0ZSIpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGNvbG9yID0gc3RhcnQuR2V0VmFsdWVXaXRoUmVzdWx0TW9kZSgpOwogICAgICAgICAgICAgICAgVEVNUF9DT0xPUl9BUlJBWVswXSA9IGNvbG9yWzBdOwogICAgICAgICAgICAgICAgVEVNUF9DT0xPUl9BUlJBWVsxXSA9IGNvbG9yWzFdOwogICAgICAgICAgICAgICAgVEVNUF9DT0xPUl9BUlJBWVsyXSA9IGNvbG9yWzJdOwogICAgICAgICAgICAgICAgcmV0dXJuIFRFTVBfQ09MT1JfQVJSQVkKICAgICAgICAgICAgfSBlbHNlIGlmIChtb2RlID09PSAiY29udGludW91cyIgfHwgbW9kZSA9PT0gInN0ZXAiKSB7CiAgICAgICAgICAgICAgICBpZiAobW9kZSA9PT0gInN0ZXAiKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RlcCA9IHByb3BlcnR5VHJhY2suR2V0VGltZWxpbmUoKS5HZXRTdGVwKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHN0ZXAgIT09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcyA9IDEgLyBzdGVwOwogICAgICAgICAgICAgICAgICAgICAgICB0aW1lID0gTWF0aC5mbG9vcih0aW1lICogcykgLyBzCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY29uc3Qgc3QgPSBzdGFydC5HZXRUaW1lKCk7CiAgICAgICAgICAgICAgICBjb25zdCBldCA9IGVuZC5HZXRUaW1lKCk7CiAgICAgICAgICAgICAgICBjb25zdCBzdiA9IHN0YXJ0LkdldFZhbHVlV2l0aFJlc3VsdE1vZGUoKTsKICAgICAgICAgICAgICAgIGNvbnN0IGV2ID0gZW5kLkdldFZhbHVlV2l0aFJlc3VsdE1vZGUoKTsKICAgICAgICAgICAgICAgIGNvbnN0IG4gPSBDMy5ub3JtYWxpemUodGltZSwgc3QsIGV0KTsKICAgICAgICAgICAgICAgIGNvbnN0IGUgPSBzdGFydC5HZXRFYXNlKCk7CiAgICAgICAgICAgICAgICBjb25zdCBzciA9IHN2WzBdOwogICAgICAgICAgICAgICAgY29uc3Qgc2cgPSBzdlsxXTsKICAgICAgICAgICAgICAgIGNvbnN0IHNiID0gc3ZbMl07CiAgICAgICAgICAgICAgICBjb25zdCBlciA9IGV2WzBdOwogICAgICAgICAgICAgICAgY29uc3QgZWcgPSBldlsxXTsKICAgICAgICAgICAgICAgIGNvbnN0IGViID0gZXZbMl07CiAgICAgICAgICAgICAgICBjb25zdCBlYXNlRnVuYyA9IHNlbGYuRWFzZS5HZXRSdW50aW1lRWFzZShlKTsKICAgICAgICAgICAgICAgIGNvbnN0IGQgPSBldCAtIHN0OwogICAgICAgICAgICAgICAgY29uc3QgZG4gPSBkICogbjsKICAgICAgICAgICAgICAgIGlmIChzciA9PT0gZXIpIFRFTVBfQ09MT1JfQVJSQVlbMF0gPSBzcjsKICAgICAgICAgICAgICAgIGVsc2UgVEVNUF9DT0xPUl9BUlJBWVswXSA9IGVhc2VGdW5jKGRuLCBzciwgZXIgLSBzciwgZCk7CiAgICAgICAgICAgICAgICBpZiAoc2cgPT09IGVnKSBURU1QX0NPTE9SX0FSUkFZWzFdID0gc2c7CiAgICAgICAgICAgICAgICBlbHNlIFRFTVBfQ09MT1JfQVJSQVlbMV0gPSBlYXNlRnVuYyhkbiwgc2csIGVnIC0gc2csIGQpOwogICAgICAgICAgICAgICAgaWYgKHNiID09PSBlYikgVEVNUF9DT0xPUl9BUlJBWVsyXSA9IHNiOwogICAgICAgICAgICAgICAgZWxzZSBURU1QX0NPTE9SX0FSUkFZWzJdID0gZWFzZUZ1bmMoZG4sIHNiLCBlYiAtIHNiLCBkKTsKICAgICAgICAgICAgICAgIHJldHVybiBURU1QX0NPTE9SX0FSUkFZCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwoKfQoKLy8gdGltZWxpbmVzL3N0YXRlL3Byb3BlcnR5VHlwZUFkYXB0ZXJzL3RleHRUeXBlQWRhcHRlci5qcwp7CiAgICAndXNlIHN0cmljdCc7CiAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICBDMy5Qcm9wZXJ0eVRyYWNrU3RhdGUuVGV4dFR5cGVBZGFwdGVyID0gY2xhc3MgVGV4dFR5cGVBZGFwdGVyIHsKICAgICAgICBjb25zdHJ1Y3RvcigpIHt9CiAgICAgICAgc3RhdGljIFdpbGxDaGFuZ2UoaW5kZXgsIHNvdXJjZSwgbmV3VmFsdWUsIHR5cGUpIHsKICAgICAgICAgICAgbGV0IG9sZFZhbHVlOwogICAgICAgICAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgICAgICAgICAgIGNhc2UgImJlaGF2aW9yIjoKICAgICAgICAgICAgICAgICAgICBvbGRWYWx1ZSA9IHNvdXJjZS5HZXRQcm9wZXJ0eVZhbHVlQnlJbmRleChpbmRleCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICJlZmZlY3QiOgogICAgICAgICAgICAgICAgICAgIG9sZFZhbHVlID0gc291cmNlW2luZGV4XTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgImluc3RhbmNlLXZhcmlhYmxlIjoKICAgICAgICAgICAgICAgICAgICBvbGRWYWx1ZSA9IHNvdXJjZS5HZXRJbnN0YW5jZVZhcmlhYmxlVmFsdWUoaW5kZXgpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAicGx1Z2luIjoKICAgICAgICAgICAgICAgICAgICBvbGRWYWx1ZSA9IHNvdXJjZS5HZXRQcm9wZXJ0eVZhbHVlQnlJbmRleChpbmRleCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAob2xkVmFsdWUgPT09IG5ld1ZhbHVlKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgfQogICAgICAgIHN0YXRpYyBJbnRlcnBvbGF0ZSh0aW1lLCBzdGFydCwgZW5kLCBwcm9wZXJ0eVRyYWNrKSB7CiAgICAgICAgICAgIGlmICghZW5kKSB7CiAgICAgICAgICAgICAgICBsZXQgcHJvcGVydHlUcmFja0RhdGFJdGVtID0KICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eVRyYWNrLkdldFByb3BlcnR5VHJhY2tEYXRhSXRlbSgpOwogICAgICAgICAgICAgICAgY29uc3QgcHJvcGVydHlUcmFja0RhdGEgPSBwcm9wZXJ0eVRyYWNrLkdldFByb3BlcnR5VHJhY2tEYXRhKCk7CiAgICAgICAgICAgICAgICBwcm9wZXJ0eVRyYWNrRGF0YUl0ZW0gPSBwcm9wZXJ0eVRyYWNrRGF0YS5HZXRMYXN0UHJvcGVydHlLZXlmcmFtZURhdGFJdGVtKHByb3BlcnR5VHJhY2tEYXRhSXRlbSk7CiAgICAgICAgICAgICAgICByZXR1cm4gcHJvcGVydHlUcmFja0RhdGFJdGVtLkdldFZhbHVlV2l0aFJlc3VsdE1vZGUoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBzdGFydC5HZXRWYWx1ZVdpdGhSZXN1bHRNb2RlKCkKICAgICAgICB9CiAgICB9OwoKfQoKLy8gdGltZWxpbmVzL2RhdGEvdGltZWxpbmVEYXRhTWFuYWdlci5qcwp7CiAgICAndXNlIHN0cmljdCc7CiAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICBDMy5UaW1lbGluZURhdGFNYW5hZ2VyID0gY2xhc3MgVGltZWxpbmVEYXRhTWFuYWdlciB7CiAgICAgICAgY29uc3RydWN0b3IoKSB7CiAgICAgICAgICAgIHRoaXMuX3RpbWVsaW5lRGF0YUl0ZW1zID0gbmV3IE1hcAogICAgICAgIH0KICAgICAgICBSZWxlYXNlKCkgewogICAgICAgICAgICBmb3IgKGNvbnN0IHRpbWVsaW5lRGF0YUl0ZW0gb2YgdGhpcy5fdGltZWxpbmVEYXRhSXRlbXMudmFsdWVzKCkpIHRpbWVsaW5lRGF0YUl0ZW0uUmVsZWFzZSgpOwogICAgICAgICAgICB0aGlzLl90aW1lbGluZURhdGFJdGVtcy5jbGVhcigpOwogICAgICAgICAgICB0aGlzLl90aW1lbGluZURhdGFJdGVtcyA9IG51bGwKICAgICAgICB9CiAgICAgICAgQWRkKGRhdGEpIHsKICAgICAgICAgICAgY29uc3QgdGltZWxpbmVEYXRhSXRlbSA9IG5ldyBDMy5UaW1lbGluZURhdGFJdGVtKGRhdGEpOwogICAgICAgICAgICBjb25zdCBuYW1lID0gdGltZWxpbmVEYXRhSXRlbS5HZXROYW1lKCk7CiAgICAgICAgICAgIHRoaXMuX3RpbWVsaW5lRGF0YUl0ZW1zLnNldChuYW1lLCB0aW1lbGluZURhdGFJdGVtKQogICAgICAgIH0KICAgICAgICBHZXQobmFtZSkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fdGltZWxpbmVEYXRhSXRlbXMuZ2V0KG5hbWUpCiAgICAgICAgfQogICAgICAgIEdldE5hbWVJZCgpIHsKICAgICAgICAgICAgcmV0dXJuIDAKICAgICAgICB9CiAgICAgICAgc3RhdGljIF9DcmVhdGVEYXRhSXRlbXMoaXRlbXMsIGpzb25JdGVtcywKICAgICAgICAgICAgZGF0YUl0ZW1Db25zdHJ1Y3RvciwgZGF0YUNvbnRhaW5lcikgewogICAgICAgICAgICBpZiAoIWpzb25JdGVtcykgcmV0dXJuOwogICAgICAgICAgICBmb3IgKGNvbnN0IGpzb25JdGVtIG9mIGpzb25JdGVtcykgQzMuVGltZWxpbmVEYXRhTWFuYWdlci5fQ3JlYXRlRGF0YUl0ZW0oImNyZWF0ZSIsIGpzb25JdGVtLCBpdGVtcywgZGF0YUl0ZW1Db25zdHJ1Y3RvciwgZGF0YUNvbnRhaW5lcikKICAgICAgICB9CiAgICAgICAgc3RhdGljIF9DcmVhdGVEYXRhSXRlbXNJbmNsdWRpbmdEaXNhYmxlZChpdGVtcywganNvbkl0ZW1zLCBkYXRhSXRlbUNvbnN0cnVjdG9yLCBkYXRhQ29udGFpbmVyKSB7CiAgICAgICAgICAgIGlmICghanNvbkl0ZW1zKSByZXR1cm47CiAgICAgICAgICAgIGZvciAoY29uc3QganNvbkl0ZW0gb2YganNvbkl0ZW1zKSBDMy5UaW1lbGluZURhdGFNYW5hZ2VyLl9DcmVhdGVEYXRhSXRlbSgiY3JlYXRlLWluY2x1ZGluZy1kaXNhYmxlZCIsIGpzb25JdGVtLCBpdGVtcywgZGF0YUl0ZW1Db25zdHJ1Y3RvciwgZGF0YUNvbnRhaW5lcikKICAgICAgICB9CiAgICAgICAgc3RhdGljIF9Mb2FkRGF0YUl0ZW1zRnJvbUpzb24oaXRlbXMsIGpzb25JdGVtcywgZGF0YUl0ZW1Db25zdHJ1Y3RvciwKICAgICAgICAgICAgZGF0YUNvbnRhaW5lcikgewogICAgICAgICAgICBpZiAoaXRlbXMubGVuZ3RoKSBqc29uSXRlbXMuZm9yRWFjaCgoanNvbkl0ZW0sIGluZGV4KSA9PiB7CiAgICAgICAgICAgICAgICBpdGVtc1tpbmRleF0uX0xvYWRGcm9tSnNvbihqc29uSXRlbSkKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGVsc2UganNvbkl0ZW1zLmZvckVhY2goanNvbkl0ZW0gPT4gewogICAgICAgICAgICAgICAgQzMuVGltZWxpbmVEYXRhTWFuYWdlci5fQ3JlYXRlRGF0YUl0ZW0oImxvYWQiLCBqc29uSXRlbSwgaXRlbXMsIGRhdGFJdGVtQ29uc3RydWN0b3IsIGRhdGFDb250YWluZXIpCiAgICAgICAgICAgIH0pCiAgICAgICAgfQogICAgICAgIHN0YXRpYyBfQ3JlYXRlRGF0YUl0ZW0obW9kZSwganNvbiwgaXRlbXMsIGRhdGFJdGVtQ29uc3RydWN0b3IsIGRhdGFDb250YWluZXIpIHsKICAgICAgICAgICAgbGV0IGRhdGFJdGVtOwogICAgICAgICAgICBpZiAodHlwZW9mIGRhdGFJdGVtQ29uc3RydWN0b3IgPT09ICJmdW5jdGlvbiIpIHN3aXRjaCAobW9kZSkgewogICAgICAgICAgICAgICAgY2FzZSAibG9hZCI6CiAgICAgICAgICAgICAgICAgICAgZGF0YUl0ZW0gPSBuZXcgZGF0YUl0ZW1Db25zdHJ1Y3RvcihudWxsLCBkYXRhQ29udGFpbmVyKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgImNyZWF0ZSI6CiAgICAgICAgICAgICAgICAgICAgZGF0YUl0ZW0gPSBuZXcgZGF0YUl0ZW1Db25zdHJ1Y3Rvcihqc29uLAogICAgICAgICAgICAgICAgICAgICAgICBkYXRhQ29udGFpbmVyKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgImNyZWF0ZS1pbmNsdWRpbmctZGlzYWJsZWQiOgogICAgICAgICAgICAgICAgICAgIGRhdGFJdGVtID0gbmV3IGRhdGFJdGVtQ29uc3RydWN0b3IoanNvbiwgZGF0YUNvbnRhaW5lcik7CiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgZGF0YUl0ZW1Db25zdHJ1Y3RvciA9PT0gIm9iamVjdCIpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHByb3AgPSBkYXRhSXRlbUNvbnN0cnVjdG9yLnByb3A7CiAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IGpzb25bcHJvcF07CiAgICAgICAgICAgICAgICBjb25zdCBjbnN0cmN0ciA9IGRhdGFJdGVtQ29uc3RydWN0b3IubWFwLmdldCh2YWx1ZSk7CiAgICAgICAgICAgICAgICBzd2l0Y2ggKG1vZGUpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlICJsb2FkIjoKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YUl0ZW0gPSBuZXcgY25zdHJjdHIobnVsbCwgZGF0YUNvbnRhaW5lcik7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgImNyZWF0ZSI6CiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFJdGVtID0gbmV3IGNuc3RyY3RyKGpzb24sIGRhdGFDb250YWluZXIpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICJjcmVhdGUtaW5jbHVkaW5nLWRpc2FibGVkIjoKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YUl0ZW0gPSBuZXcgY25zdHJjdHIoanNvbiwgZGF0YUNvbnRhaW5lcik7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3dpdGNoIChtb2RlKSB7CiAgICAgICAgICAgICAgICBjYXNlICJsb2FkIjoKICAgICAgICAgICAgICAgICAgICBkYXRhSXRlbS5fTG9hZEZyb21Kc29uKGpzb24pOwogICAgICAgICAgICAgICAgICAgIGl0ZW1zLnB1c2goZGF0YUl0ZW0pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAiY3JlYXRlIjoKICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGRhdGFJdGVtLkdldEVuYWJsZSA9PT0gImZ1bmN0aW9uIiAmJiAhZGF0YUl0ZW0uR2V0RW5hYmxlKCkpIHJldHVybiBkYXRhSXRlbS5SZWxlYXNlKCk7CiAgICAgICAgICAgICAgICAgICAgaXRlbXMucHVzaChkYXRhSXRlbSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICJjcmVhdGUtaW5jbHVkaW5nLWRpc2FibGVkIjoKICAgICAgICAgICAgICAgICAgICBpdGVtcy5wdXNoKGRhdGFJdGVtKTsKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKCn0KCi8vIHRpbWVsaW5lcy9kYXRhL3RpbWVsaW5lRGF0YS5qcwp7CiAgICAndXNlIHN0cmljdCc7CiAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICBjb25zdCBOQU1FID0gMDsKICAgIGNvbnN0IFRPVEFMX1RJTUUgPSAxOwogICAgY29uc3QgU1RFUCA9IDI7CiAgICBjb25zdCBJTlRFUlBPTEFUSU9OX01PREUgPSAzOwogICAgY29uc3QgUkVTVUxUX01PREUgPSA0OwogICAgY29uc3QgVFJBQ0tTID0gNTsKICAgIGNvbnN0IExPT1AgPSA2OwogICAgY29uc3QgUElOR19QT05HID0gNzsKICAgIGNvbnN0IFJFUEVBVF9DT1VOVCA9IDg7CiAgICBjb25zdCBTVEFSVF9PTl9MQVlPVVQgPSA5OwogICAgY29uc3QgVFJBTlNGT1JNX1dJVEhfU0NFTkVfR1JBUEggPSAxMDsKICAgIGNvbnN0IFVTRV9TWVNURU1fVElNRVNDQUxFID0gMTE7CiAgICBDMy5UaW1lbGluZURhdGFJdGVtID0gY2xhc3MgVGltZWxpbmVEYXRhSXRlbSB7CiAgICAgICAgY29uc3RydWN0b3IodGltZWxpbmVEYXRhSnNvbikgewogICAgICAgICAgICB0aGlzLl9uYW1lID0gIiI7CiAgICAgICAgICAgIHRoaXMuX3RvdGFsVGltZSA9IE5hTjsKICAgICAgICAgICAgdGhpcy5fc3RlcCA9IDA7CiAgICAgICAgICAgIHRoaXMuX2ludGVycG9sYXRpb25Nb2RlID0gImRlZmF1bHQiOwogICAgICAgICAgICB0aGlzLl9yZXN1bHRNb2RlID0gImRlZmF1bHQiOwogICAgICAgICAgICB0aGlzLl9sb29wID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX3BpbmdQb25nID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX3JlcGVhdENvdW50ID0gMTsKICAgICAgICAgICAgdGhpcy5fdHJhY2tEYXRhID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fc3RhcnRPbkxheW91dCA9ICIiOwogICAgICAgICAgICB0aGlzLl90cmFuc2Zvcm1XaXRoU2NlbmVHcmFwaCA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl91c2VTeXN0ZW1UaW1lc2NhbGUgPSB0cnVlOwogICAgICAgICAgICBpZiAoIXRpbWVsaW5lRGF0YUpzb24pIHJldHVybjsKICAgICAgICAgICAgdGhpcy5fbmFtZSA9IHRpbWVsaW5lRGF0YUpzb25bTkFNRV07CiAgICAgICAgICAgIHRoaXMuX3RvdGFsVGltZSA9IHRpbWVsaW5lRGF0YUpzb25bVE9UQUxfVElNRV07CiAgICAgICAgICAgIHRoaXMuX3N0ZXAgPSB0aW1lbGluZURhdGFKc29uW1NURVBdOwogICAgICAgICAgICB0aGlzLl9pbnRlcnBvbGF0aW9uTW9kZSA9CiAgICAgICAgICAgICAgICB0aW1lbGluZURhdGFKc29uW0lOVEVSUE9MQVRJT05fTU9ERV07CiAgICAgICAgICAgIHRoaXMuX3Jlc3VsdE1vZGUgPSB0aW1lbGluZURhdGFKc29uW1JFU1VMVF9NT0RFXTsKICAgICAgICAgICAgdGhpcy5fbG9vcCA9ICEhdGltZWxpbmVEYXRhSnNvbltMT09QXTsKICAgICAgICAgICAgdGhpcy5fcGluZ1BvbmcgPSAhIXRpbWVsaW5lRGF0YUpzb25bUElOR19QT05HXTsKICAgICAgICAgICAgdGhpcy5fcmVwZWF0Q291bnQgPSB0aW1lbGluZURhdGFKc29uW1JFUEVBVF9DT1VOVF07CiAgICAgICAgICAgIHRoaXMuX3N0YXJ0T25MYXlvdXQgPSB0aW1lbGluZURhdGFKc29uW1NUQVJUX09OX0xBWU9VVF07CiAgICAgICAgICAgIHRoaXMuX3RyYW5zZm9ybVdpdGhTY2VuZUdyYXBoID0gISF0aW1lbGluZURhdGFKc29uW1RSQU5TRk9STV9XSVRIX1NDRU5FX0dSQVBIXTsKICAgICAgICAgICAgdGhpcy5fdXNlU3lzdGVtVGltZXNjYWxlID0gISF0aW1lbGluZURhdGFKc29uW1VTRV9TWVNURU1fVElNRVNDQUxFXTsKICAgICAgICAgICAgdGhpcy5fdHJhY2tEYXRhID0gbmV3IEMzLlRyYWNrRGF0YSh0aW1lbGluZURhdGFKc29uW1RSQUNLU10sIHRoaXMpCiAgICAgICAgfQogICAgICAgIFJlbGVhc2UoKSB7CiAgICAgICAgICAgIHRoaXMuX3RyYWNrRGF0YS5SZWxlYXNlKCk7CiAgICAgICAgICAgIHRoaXMuX3RyYWNrRGF0YSA9IG51bGwKICAgICAgICB9CiAgICAgICAgR2V0VHJhY2tEYXRhKCkgewogICAgICAgICAgICBpZiAoIXRoaXMuX3RyYWNrRGF0YSkgdGhpcy5fdHJhY2tEYXRhID0gbmV3IEMzLlRyYWNrRGF0YShudWxsLCB0aGlzKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RyYWNrRGF0YQogICAgICAgIH0KICAgICAgICBHZXROYW1lKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fbmFtZQogICAgICAgIH0KICAgICAgICBTZXROYW1lKG4pIHsKICAgICAgICAgICAgdGhpcy5fbmFtZSA9IG4KICAgICAgICB9CiAgICAgICAgR2V0VG90YWxUaW1lKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fdG90YWxUaW1lCiAgICAgICAgfQogICAgICAgIFNldFRvdGFsVGltZSh0dCkgewogICAgICAgICAgICB0aGlzLl90b3RhbFRpbWUgPSB0dAogICAgICAgIH0KICAgICAgICBHZXRTdGVwKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fc3RlcAogICAgICAgIH0KICAgICAgICBTZXRTdGVwKHMpIHsKICAgICAgICAgICAgdGhpcy5fc3RlcCA9IHMKICAgICAgICB9CiAgICAgICAgR2V0SW50ZXJwb2xhdGlvbk1vZGUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pbnRlcnBvbGF0aW9uTW9kZQogICAgICAgIH0KICAgICAgICBTZXRJbnRlcnBvbGF0aW9uTW9kZShpbSkgewogICAgICAgICAgICB0aGlzLl9pbnRlcnBvbGF0aW9uTW9kZSA9IGltCiAgICAgICAgfQogICAgICAgIEdldFJlc3VsdE1vZGUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9yZXN1bHRNb2RlCiAgICAgICAgfQogICAgICAgIFNldFJlc3VsdE1vZGUocm0pIHsKICAgICAgICAgICAgdGhpcy5fcmVzdWx0TW9kZSA9IHJtCiAgICAgICAgfQogICAgICAgIEdldExvb3AoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9sb29wCiAgICAgICAgfQogICAgICAgIFNldExvb3AobCkgewogICAgICAgICAgICB0aGlzLl9sb29wID0KICAgICAgICAgICAgICAgIGwKICAgICAgICB9CiAgICAgICAgR2V0UGluZ1BvbmcoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9waW5nUG9uZwogICAgICAgIH0KICAgICAgICBTZXRQaW5nUG9uZyhwKSB7CiAgICAgICAgICAgIHRoaXMuX3BpbmdQb25nID0gcAogICAgICAgIH0KICAgICAgICBHZXRSZXBlYXRDb3VudCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3JlcGVhdENvdW50CiAgICAgICAgfQogICAgICAgIFNldFJlcGVhdENvdW50KHJjKSB7CiAgICAgICAgICAgIHRoaXMuX3JlcGVhdENvdW50ID0gcmMKICAgICAgICB9CiAgICAgICAgR2V0U3RhcnRPbkxheW91dCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3N0YXJ0T25MYXlvdXQKICAgICAgICB9CiAgICAgICAgR2V0VHJhbnNmb3JtV2l0aFNjZW5lR3JhcGgoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl90cmFuc2Zvcm1XaXRoU2NlbmVHcmFwaAogICAgICAgIH0KICAgICAgICBHZXRVc2VTeXN0ZW1UaW1lc2NhbGUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl91c2VTeXN0ZW1UaW1lc2NhbGUKICAgICAgICB9CiAgICAgICAgX1NhdmVUb0pzb24oKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAidHJhY2tEYXRhSnNvbiI6IHRoaXMuX3RyYWNrRGF0YS5fU2F2ZVRvSnNvbigpLAogICAgICAgICAgICAgICAgIm5hbWUiOiB0aGlzLl9uYW1lLAogICAgICAgICAgICAgICAgInRvdGFsVGltZSI6IHRoaXMuX3RvdGFsVGltZSwKICAgICAgICAgICAgICAgICJzdGVwIjogdGhpcy5fc3RlcCwKICAgICAgICAgICAgICAgICJpbnRlcnBvbGF0aW9uTW9kZSI6IHRoaXMuX2ludGVycG9sYXRpb25Nb2RlLAogICAgICAgICAgICAgICAgInJlc3VsdE1vZGUiOiB0aGlzLl9yZXN1bHRNb2RlLAogICAgICAgICAgICAgICAgImxvb3AiOiB0aGlzLl9sb29wLAogICAgICAgICAgICAgICAgInBpbmdQb25nIjogdGhpcy5fcGluZ1BvbmcsCiAgICAgICAgICAgICAgICAicmVwZWF0Q291bnQiOiB0aGlzLl9yZXBlYXRDb3VudCwKICAgICAgICAgICAgICAgICJzdGFydE9uTGF5b3V0IjogdGhpcy5fc3RhcnRPbkxheW91dCwKICAgICAgICAgICAgICAgICJ0cmFuc2Zvcm1XaXRoU2NlbmVHcmFwaCI6ICEhdGhpcy5fdHJhbnNmb3JtV2l0aFNjZW5lR3JhcGgsCiAgICAgICAgICAgICAgICAidXNlU3lzdGVtVGltZXNjYWxlIjogdGhpcy5fdXNlU3lzdGVtVGltZXNjYWxlCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgX0xvYWRGcm9tSnNvbihvKSB7CiAgICAgICAgICAgIGlmICghbykgcmV0dXJuOwogICAgICAgICAgICB0aGlzLkdldFRyYWNrRGF0YSgpLl9Mb2FkRnJvbUpzb24ob1sidHJhY2tEYXRhSnNvbiJdKTsKICAgICAgICAgICAgdGhpcy5fbmFtZSA9IG9bIm5hbWUiXTsKICAgICAgICAgICAgdGhpcy5fdG90YWxUaW1lID0gb1sidG90YWxUaW1lIl07CiAgICAgICAgICAgIHRoaXMuX3N0ZXAgPSBvWyJzdGVwIl07CiAgICAgICAgICAgIHRoaXMuX2ludGVycG9sYXRpb25Nb2RlID0gb1siaW50ZXJwb2xhdGlvbk1vZGUiXTsKICAgICAgICAgICAgdGhpcy5fcmVzdWx0TW9kZSA9IG9bInJlc3VsdE1vZGUiXTsKICAgICAgICAgICAgdGhpcy5fbG9vcCA9IG9bImxvb3AiXTsKICAgICAgICAgICAgdGhpcy5fcGluZ1BvbmcgPSBvWyJwaW5nUG9uZyJdOwogICAgICAgICAgICB0aGlzLl9yZXBlYXRDb3VudCA9IG9bInJlcGVhdENvdW50Il07CiAgICAgICAgICAgIHRoaXMuX3N0YXJ0T25MYXlvdXQgPSBvWyJzdGFydE9uTGF5b3V0Il07CiAgICAgICAgICAgIHRoaXMuX3RyYW5zZm9ybVdpdGhTY2VuZUdyYXBoID0gISFvWyJ0cmFuc2Zvcm1XaXRoU2NlbmVHcmFwaCJdOwogICAgICAgICAgICB0aGlzLl91c2VTeXN0ZW1UaW1lc2NhbGUgPSAhIW9bInVzZVN5c3RlbVRpbWVzY2FsZSJdCiAgICAgICAgfQogICAgfTsKCn0KCi8vIHRpbWVsaW5lcy9kYXRhL3RyYWNrRGF0YS5qcwp7CiAgICAndXNlIHN0cmljdCc7CiAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICBjb25zdCBXSV9EQVRBID0gMDsKICAgIGNvbnN0IE9DX0lOREVYID0gMTsKICAgIGNvbnN0IFdJX1VJRCA9IDI7CiAgICBjb25zdCBJTlRFUlBPTEFUSU9OX01PREUgPSAxOwogICAgY29uc3QgUkVTVUxUX01PREUgPSAyOwogICAgY29uc3QgRU5BQkxFRCA9IDM7CiAgICBjb25zdCBLRVlGUkFNRVMgPSA0OwogICAgY29uc3QgUFJPUEVSVFlfVFJBQ0tTID0gNTsKICAgIGNvbnN0IElEID0gNjsKICAgIGNvbnN0IE5FU1RFRF9EQVRBID0gNzsKICAgIGNvbnN0IFNUQVJUX09GRlNFVCA9IDA7CiAgICBjb25zdCBMT0NBTF9UT1RBTF9USU1FID0gMTsKICAgIGNvbnN0IFdJX0FERElUSU9OQUxfREFUQSA9IDg7CiAgICBjb25zdCBPUklHSU5BTF9XSURUSCA9IDA7CiAgICBjb25zdCBPUklHSU5BTF9IRUlHSFQgPSAxOwogICAgY29uc3QgVFJBQ0tfVFlQRSA9IDk7CiAgICBjb25zdCBUUkFDS19OQU1FID0gMTA7CiAgICBjbGFzcyBUcmFja0RhdGFJdGVtIHsKICAgICAgICBjb25zdHJ1Y3Rvcih0cmFja0RhdGFKc29uLCB0cmFja0RhdGEpIHsKICAgICAgICAgICAgdGhpcy5fdHJhY2tEYXRhID0gdHJhY2tEYXRhOwogICAgICAgICAgICB0aGlzLl9pbnN0YW5jZURhdGEgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9hZGRpdGlvbmFsSW5zdGFuY2VEYXRhID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5faW5zdGFuY2VVaWQgPSBOYU47CiAgICAgICAgICAgIHRoaXMuX29iamVjdENsYXNzSW5kZXggPSBOYU47CiAgICAgICAgICAgIHRoaXMuX2ludGVycG9sYXRpb25Nb2RlID0gImRlZmF1bHQiOwogICAgICAgICAgICB0aGlzLl9yZXN1bHRNb2RlID0gImRlZmF1bHQiOwogICAgICAgICAgICB0aGlzLl9lbmFibGVkID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX2tleWZyYW1lRGF0YSA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3Byb3BlcnR5VHJhY2tEYXRhID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5faWQgPSAiIjsKICAgICAgICAgICAgdGhpcy5fbmVzdGVkRGF0YSA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3N0YXJ0T2Zmc2V0ID0gMDsKICAgICAgICAgICAgdGhpcy5fbG9jYWxUb3RhbFRpbWUgPSB0aGlzLl90cmFja0RhdGEuR2V0VGltZWxpbmVEYXRhSXRlbSgpLkdldFRvdGFsVGltZSgpOwogICAgICAgICAgICB0aGlzLl90eXBlID0gMDsKICAgICAgICAgICAgdGhpcy5fbmFtZSA9ICIiOwogICAgICAgICAgICBpZiAoIXRyYWNrRGF0YUpzb24pIHJldHVybjsKICAgICAgICAgICAgaWYgKHRyYWNrRGF0YUpzb25bV0lfREFUQV0pIHsKICAgICAgICAgICAgICAgIHRoaXMuX2luc3RhbmNlRGF0YSA9IHRyYWNrRGF0YUpzb25bV0lfREFUQV07CiAgICAgICAgICAgICAgICB0aGlzLl9pbnN0YW5jZVVpZCA9IHRyYWNrRGF0YUpzb25bV0lfREFUQV1bV0lfVUlEXTsKICAgICAgICAgICAgICAgIHRoaXMuX29iamVjdENsYXNzSW5kZXggPSB0cmFja0RhdGFKc29uW1dJX0RBVEFdW09DX0lOREVYXQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuX2ludGVycG9sYXRpb25Nb2RlID0gdHJhY2tEYXRhSnNvbltJTlRFUlBPTEFUSU9OX01PREVdOwogICAgICAgICAgICB0aGlzLl9yZXN1bHRNb2RlID0gdHJhY2tEYXRhSnNvbltSRVNVTFRfTU9ERV07CiAgICAgICAgICAgIHRoaXMuX2VuYWJsZWQgPSAhIXRyYWNrRGF0YUpzb25bRU5BQkxFRF07CiAgICAgICAgICAgIGlmICh0cmFja0RhdGFKc29uW0lEXSkgdGhpcy5faWQgPSB0cmFja0RhdGFKc29uW0lEXTsKICAgICAgICAgICAgaWYgKHRyYWNrRGF0YUpzb25bTkVTVEVEX0RBVEFdKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9uZXN0ZWREYXRhID0gdHJhY2tEYXRhSnNvbltORVNURURfREFUQV07CiAgICAgICAgICAgICAgICB0aGlzLl9zdGFydE9mZnNldCA9IHRyYWNrRGF0YUpzb25bTkVTVEVEX0RBVEFdW1NUQVJUX09GRlNFVF07CiAgICAgICAgICAgICAgICB0aGlzLl9sb2NhbFRvdGFsVGltZSA9CiAgICAgICAgICAgICAgICAgICAgdHJhY2tEYXRhSnNvbltORVNURURfREFUQV1bTE9DQUxfVE9UQUxfVElNRV0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodHJhY2tEYXRhSnNvbltXSV9BRERJVElPTkFMX0RBVEFdKSB0aGlzLl9hZGRpdGlvbmFsSW5zdGFuY2VEYXRhID0gdHJhY2tEYXRhSnNvbltXSV9BRERJVElPTkFMX0RBVEFdOwogICAgICAgICAgICBpZiAodHJhY2tEYXRhSnNvbltXSV9BRERJVElPTkFMX0RBVEFdKSB0aGlzLl9hZGRpdGlvbmFsSW5zdGFuY2VEYXRhID0gdHJhY2tEYXRhSnNvbltXSV9BRERJVElPTkFMX0RBVEFdOwogICAgICAgICAgICBpZiAodHJhY2tEYXRhSnNvbltUUkFDS19UWVBFXSkgdGhpcy5fdHlwZSA9IHRyYWNrRGF0YUpzb25bVFJBQ0tfVFlQRV07CiAgICAgICAgICAgIGlmICh0cmFja0RhdGFKc29uW1RSQUNLX05BTUVdKSB0aGlzLl9uYW1lID0gdHJhY2tEYXRhSnNvbltUUkFDS19OQU1FXTsKICAgICAgICAgICAgdGhpcy5fa2V5ZnJhbWVEYXRhID0gbmV3IEMzLktleWZyYW1lRGF0YSh0cmFja0RhdGFKc29uW0tFWUZSQU1FU10sIHRoaXMpOwogICAgICAgICAgICB0aGlzLl9wcm9wZXJ0eVRyYWNrRGF0YSA9IG5ldyBDMy5Qcm9wZXJ0eVRyYWNrRGF0YSh0cmFja0RhdGFKc29uW1BST1BFUlRZX1RSQUNLU10sCiAgICAgICAgICAgICAgICB0aGlzKQogICAgICAgIH0KICAgICAgICBSZWxlYXNlKCkgewogICAgICAgICAgICB0aGlzLl9pbnN0YW5jZURhdGEgPSBudWxsOwogICAgICAgICAgICB0aGlzLl90cmFja0RhdGEgPSBudWxsOwogICAgICAgICAgICBpZiAodGhpcy5fa2V5ZnJhbWVEYXRhKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9rZXlmcmFtZURhdGEuUmVsZWFzZSgpOwogICAgICAgICAgICAgICAgdGhpcy5fa2V5ZnJhbWVEYXRhID0gbnVsbAogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLl9wcm9wZXJ0eVRyYWNrRGF0YSkgewogICAgICAgICAgICAgICAgdGhpcy5fcHJvcGVydHlUcmFja0RhdGEuUmVsZWFzZSgpOwogICAgICAgICAgICAgICAgdGhpcy5fcHJvcGVydHlUcmFja0RhdGEgPSBudWxsCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5fbmVzdGVkRGF0YSA9IG51bGwKICAgICAgICB9CiAgICAgICAgR2V0VHJhY2tEYXRhKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fdHJhY2tEYXRhCiAgICAgICAgfQogICAgICAgIEdldEtleWZyYW1lRGF0YSgpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLl9rZXlmcmFtZURhdGEpIHRoaXMuX2tleWZyYW1lRGF0YSA9IG5ldyBDMy5LZXlmcmFtZURhdGEobnVsbCwgdGhpcyk7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9rZXlmcmFtZURhdGEKICAgICAgICB9CiAgICAgICAgR2V0UHJvcGVydHlUcmFja0RhdGEoKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5fcHJvcGVydHlUcmFja0RhdGEpIHRoaXMuX3Byb3BlcnR5VHJhY2tEYXRhID0gbmV3IEMzLlByb3BlcnR5VHJhY2tEYXRhKG51bGwsCiAgICAgICAgICAgICAgICB0aGlzKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3Byb3BlcnR5VHJhY2tEYXRhCiAgICAgICAgfQogICAgICAgIEdldEluc3RhbmNlRGF0YSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2luc3RhbmNlRGF0YQogICAgICAgIH0KICAgICAgICBHZXRPYmplY3RDbGFzc0luZGV4KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fb2JqZWN0Q2xhc3NJbmRleAogICAgICAgIH0KICAgICAgICBTZXRPYmplY3RDbGFzc0luZGV4KGluZGV4KSB7CiAgICAgICAgICAgIHRoaXMuX29iamVjdENsYXNzSW5kZXggPSBpbmRleAogICAgICAgIH0KICAgICAgICBHZXRJbnN0YW5jZVVJRCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2luc3RhbmNlVWlkCiAgICAgICAgfQogICAgICAgIFNldEluc3RhbmNlVUlEKHVpZCkgewogICAgICAgICAgICB0aGlzLl9pbnN0YW5jZVVpZCA9IHVpZAogICAgICAgIH0KICAgICAgICBHZXRJbnRlcnBvbGF0aW9uTW9kZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2ludGVycG9sYXRpb25Nb2RlCiAgICAgICAgfQogICAgICAgIFNldEludGVycG9sYXRpb25Nb2RlKGltKSB7CiAgICAgICAgICAgIHRoaXMuX2ludGVycG9sYXRpb25Nb2RlID0gaW0KICAgICAgICB9CiAgICAgICAgR2V0UmVzdWx0TW9kZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3Jlc3VsdE1vZGUKICAgICAgICB9CiAgICAgICAgU2V0UmVzdWx0TW9kZShybSkgewogICAgICAgICAgICB0aGlzLl9yZXN1bHRNb2RlID0gcm0KICAgICAgICB9CiAgICAgICAgR2V0RW5hYmxlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZW5hYmxlZAogICAgICAgIH0KICAgICAgICBTZXRFbmFibGUoZSkgewogICAgICAgICAgICB0aGlzLl9lbmFibGVkID0gISFlCiAgICAgICAgfQogICAgICAgIEdldElkKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faWQKICAgICAgICB9CiAgICAgICAgR2V0U3RhcnRPZmZzZXQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zdGFydE9mZnNldAogICAgICAgIH0KICAgICAgICBHZXRMb2NhbFRvdGFsVGltZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2xvY2FsVG90YWxUaW1lCiAgICAgICAgfQogICAgICAgIFNldExvY2FsVG90YWxUaW1lKHQpIHsKICAgICAgICAgICAgdGhpcy5fbG9jYWxUb3RhbFRpbWUgPSB0CiAgICAgICAgfQogICAgICAgIEdldE9yaWdpbmFsV2lkdGgoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9hZGRpdGlvbmFsSW5zdGFuY2VEYXRhW09SSUdJTkFMX1dJRFRIXQogICAgICAgIH0KICAgICAgICBTZXRPcmlnaW5hbFdpZHRoKHcpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLl9hZGRpdGlvbmFsSW5zdGFuY2VEYXRhKSB0aGlzLl9hZGRpdGlvbmFsSW5zdGFuY2VEYXRhID0gW107CiAgICAgICAgICAgIHRoaXMuX2FkZGl0aW9uYWxJbnN0YW5jZURhdGFbT1JJR0lOQUxfV0lEVEhdID0gdwogICAgICAgIH0KICAgICAgICBHZXRPcmlnaW5hbEhlaWdodCgpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLl9hZGRpdGlvbmFsSW5zdGFuY2VEYXRhKSB0aGlzLl9hZGRpdGlvbmFsSW5zdGFuY2VEYXRhID0gW107CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9hZGRpdGlvbmFsSW5zdGFuY2VEYXRhW09SSUdJTkFMX0hFSUdIVF0KICAgICAgICB9CiAgICAgICAgU2V0T3JpZ2luYWxIZWlnaHQoaCkgewogICAgICAgICAgICBpZiAoIXRoaXMuX2FkZGl0aW9uYWxJbnN0YW5jZURhdGEpIHRoaXMuX2FkZGl0aW9uYWxJbnN0YW5jZURhdGEgPSBbXTsKICAgICAgICAgICAgdGhpcy5fYWRkaXRpb25hbEluc3RhbmNlRGF0YVtPUklHSU5BTF9IRUlHSFRdID0gaAogICAgICAgIH0KICAgICAgICBHZXRUeXBlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fdHlwZQogICAgICAgIH0KICAgICAgICBHZXROYW1lKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fbmFtZQogICAgICAgIH0KICAgICAgICBfU2F2ZVRvSnNvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICJrZXlmcmFtZURhdGFKc29uIjogdGhpcy5fa2V5ZnJhbWVEYXRhLl9TYXZlVG9Kc29uKCksCiAgICAgICAgICAgICAgICAicHJvcGVydHlUcmFja0RhdGFKc29uIjogdGhpcy5fcHJvcGVydHlUcmFja0RhdGEuX1NhdmVUb0pzb24oKSwKICAgICAgICAgICAgICAgICJpbnN0YW5jZURhdGEiOiB0aGlzLl9pbnN0YW5jZURhdGEsCiAgICAgICAgICAgICAgICAiYWRkaXRpb25hbEluc3RhbmNlRGF0YSI6IHRoaXMuX2FkZGl0aW9uYWxJbnN0YW5jZURhdGEsCiAgICAgICAgICAgICAgICAiaW5zdGFuY2VVaWQiOiB0aGlzLl9pbnN0YW5jZVVpZCwKICAgICAgICAgICAgICAgICJvYmplY3RDbGFzc0luZGV4IjogdGhpcy5fb2JqZWN0Q2xhc3NJbmRleCwKICAgICAgICAgICAgICAgICJpbnRlcnBvbGF0aW9uTW9kZSI6IHRoaXMuX2ludGVycG9sYXRpb25Nb2RlLAogICAgICAgICAgICAgICAgInJlc3VsdE1vZGUiOiB0aGlzLl9yZXN1bHRNb2RlLAogICAgICAgICAgICAgICAgImVuYWJsZWQiOiB0aGlzLl9lbmFibGVkLAogICAgICAgICAgICAgICAgImlkIjogdGhpcy5faWQsCiAgICAgICAgICAgICAgICAibmVzdGVkRGF0YSI6IHRoaXMuX25lc3RlZERhdGEsCiAgICAgICAgICAgICAgICAidHlwZSI6IHRoaXMuX3R5cGUsCiAgICAgICAgICAgICAgICAibmFtZSI6IHRoaXMuX25hbWUKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBfTG9hZEZyb21Kc29uKG8pIHsKICAgICAgICAgICAgaWYgKCFvKSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuX2luc3RhbmNlRGF0YSA9IG9bImluc3RhbmNlRGF0YSJdOwogICAgICAgICAgICB0aGlzLl9pbnN0YW5jZVVpZCA9IG9bImluc3RhbmNlVWlkIl07CiAgICAgICAgICAgIHRoaXMuX29iamVjdENsYXNzSW5kZXggPSBvWyJvYmplY3RDbGFzc0luZGV4Il07CiAgICAgICAgICAgIHRoaXMuX2ludGVycG9sYXRpb25Nb2RlID0gb1siaW50ZXJwb2xhdGlvbk1vZGUiXTsKICAgICAgICAgICAgdGhpcy5fcmVzdWx0TW9kZSA9IG9bInJlc3VsdE1vZGUiXTsKICAgICAgICAgICAgdGhpcy5fZW5hYmxlZCA9IG9bImVuYWJsZWQiXTsKICAgICAgICAgICAgdGhpcy5faWQgPSBvWyJpZCJdOwogICAgICAgICAgICB0aGlzLl90eXBlID0gb1sidHlwZSJdID8gb1sidHlwZSJdIDogMDsKICAgICAgICAgICAgdGhpcy5fbmFtZSA9IG9bIm5hbWUiXSA/IG9bIm5hbWUiXSA6ICIiOwogICAgICAgICAgICB0aGlzLl9sb2NhbFRvdGFsVGltZSA9IHRoaXMuX3RyYWNrRGF0YS5HZXRUaW1lbGluZURhdGFJdGVtKCkuR2V0VG90YWxUaW1lKCk7CiAgICAgICAgICAgIGlmIChvWyJuZXN0ZWREYXRhIl0pIHsKICAgICAgICAgICAgICAgIHRoaXMuX25lc3RlZERhdGEgPQogICAgICAgICAgICAgICAgICAgIG9bIm5lc3RlZERhdGEiXTsKICAgICAgICAgICAgICAgIHRoaXMuX3N0YXJ0T2Zmc2V0ID0gdGhpcy5fbmVzdGVkRGF0YVtTVEFSVF9PRkZTRVRdOwogICAgICAgICAgICAgICAgdGhpcy5fbG9jYWxUb3RhbFRpbWUgPSB0aGlzLl9uZXN0ZWREYXRhW0xPQ0FMX1RPVEFMX1RJTUVdCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG9bImFkZGl0aW9uYWxJbnN0YW5jZURhdGEiXSkgdGhpcy5fYWRkaXRpb25hbEluc3RhbmNlRGF0YSA9IG9bImFkZGl0aW9uYWxJbnN0YW5jZURhdGEiXTsKICAgICAgICAgICAgdGhpcy5HZXRLZXlmcmFtZURhdGEoKS5fTG9hZEZyb21Kc29uKG9bImtleWZyYW1lRGF0YUpzb24iXSk7CiAgICAgICAgICAgIHRoaXMuR2V0UHJvcGVydHlUcmFja0RhdGEoKS5fTG9hZEZyb21Kc29uKG9bInByb3BlcnR5VHJhY2tEYXRhSnNvbiJdKQogICAgICAgIH0KICAgIH0KICAgIEMzLlRyYWNrRGF0YSA9IGNsYXNzIFRyYWNrRGF0YSB7CiAgICAgICAgY29uc3RydWN0b3IodHJhY2tzRGF0YUpzb24sIHRpbWVsaW5lRGF0YUl0ZW0pIHsKICAgICAgICAgICAgdGhpcy5fdGltZWxpbmVEYXRhSXRlbSA9IHRpbWVsaW5lRGF0YUl0ZW07CiAgICAgICAgICAgIHRoaXMuX3RyYWNrRGF0YUl0ZW1zID0gW107CiAgICAgICAgICAgIEMzLlRpbWVsaW5lRGF0YU1hbmFnZXIuX0NyZWF0ZURhdGFJdGVtcyh0aGlzLl90cmFja0RhdGFJdGVtcywgdHJhY2tzRGF0YUpzb24sIFRyYWNrRGF0YUl0ZW0sIHRoaXMpCiAgICAgICAgfQogICAgICAgIFJlbGVhc2UoKSB7CiAgICAgICAgICAgIHRoaXMuX3RpbWVsaW5lRGF0YUl0ZW0gPSBudWxsOwogICAgICAgICAgICBmb3IgKGNvbnN0IHRyYWNrRGF0YUl0ZW0gb2YgdGhpcy5fdHJhY2tEYXRhSXRlbXMpIHRyYWNrRGF0YUl0ZW0uUmVsZWFzZSgpOwogICAgICAgICAgICBDMy5jbGVhckFycmF5KHRoaXMuX3RyYWNrRGF0YUl0ZW1zKTsKICAgICAgICAgICAgdGhpcy5fdHJhY2tEYXRhSXRlbXMgPSBudWxsCiAgICAgICAgfQogICAgICAgIEdldFRpbWVsaW5lRGF0YUl0ZW0oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl90aW1lbGluZURhdGFJdGVtCiAgICAgICAgfQogICAgICAgIEFkZEVtcHR5VHJhY2tEYXRhSXRlbSgpIHsKICAgICAgICAgICAgY29uc3QgdHJhY2tEYXRhSXRlbSA9CiAgICAgICAgICAgICAgICBuZXcgVHJhY2tEYXRhSXRlbShudWxsLCB0aGlzKTsKICAgICAgICAgICAgdGhpcy5fdHJhY2tEYXRhSXRlbXMucHVzaCh0cmFja0RhdGFJdGVtKTsKICAgICAgICAgICAgcmV0dXJuIHRyYWNrRGF0YUl0ZW0KICAgICAgICB9CiAgICAgICAgR2V0Rmlyc3RLZXlmcmFtZURhdGFJdGVtKHRyYWNrRGF0YUl0ZW0pIHsKICAgICAgICAgICAgcmV0dXJuIHRyYWNrRGF0YUl0ZW0uR2V0S2V5ZnJhbWVEYXRhKCkuR2V0S2V5ZnJhbWVEYXRhSXRlbUFycmF5KClbMF0KICAgICAgICB9CiAgICAgICAgR2V0TGFzdEtleWZyYW1lRGF0YUl0ZW0odHJhY2tEYXRhSXRlbSkgewogICAgICAgICAgICBjb25zdCBrZXlmcmFtZURhdGFJdGVtcyA9IHRyYWNrRGF0YUl0ZW0uR2V0S2V5ZnJhbWVEYXRhKCkuR2V0S2V5ZnJhbWVEYXRhSXRlbUFycmF5KCk7CiAgICAgICAgICAgIHJldHVybiBrZXlmcmFtZURhdGFJdGVtcy5hdCgtMSkKICAgICAgICB9CiAgICAgICAgR2V0S2V5RnJhbWVEYXRhSXRlbUF0VGltZSh0aW1lLCB0cmFja0RhdGFJdGVtKSB7CiAgICAgICAgICAgIGNvbnN0IGtleWZyYW1lRGF0YUl0ZW1zID0gdHJhY2tEYXRhSXRlbS5HZXRLZXlmcmFtZURhdGEoKS5HZXRLZXlmcmFtZURhdGFJdGVtQXJyYXkoKTsKICAgICAgICAgICAgY29uc3QgbCA9IGtleWZyYW1lRGF0YUl0ZW1zLmxlbmd0aDsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsOyBpKyspIHsKICAgICAgICAgICAgICAgIGNvbnN0IGtleWZyYW1lRGF0YUl0ZW0gPSBrZXlmcmFtZURhdGFJdGVtc1tpXTsKICAgICAgICAgICAgICAgIGlmIChrZXlmcmFtZURhdGFJdGVtLkdldFRpbWUoKSA9PT0gdGltZSkgcmV0dXJuIGtleWZyYW1lRGF0YUl0ZW0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBHZXRGaXJzdEtleUZyYW1lRGF0YUl0ZW1IaWdoZXJUaGFuKHRpbWUsIHRyYWNrRGF0YUl0ZW0pIHsKICAgICAgICAgICAgY29uc3Qga2V5ZnJhbWVEYXRhSXRlbXMgPSB0cmFja0RhdGFJdGVtLkdldEtleWZyYW1lRGF0YSgpLkdldEtleWZyYW1lRGF0YUl0ZW1BcnJheSgpOwogICAgICAgICAgICBjb25zdCBsID0ga2V5ZnJhbWVEYXRhSXRlbXMubGVuZ3RoOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGw7IGkrKykgewogICAgICAgICAgICAgICAgY29uc3Qga2V5ZnJhbWVEYXRhSXRlbSA9IGtleWZyYW1lRGF0YUl0ZW1zW2ldOwogICAgICAgICAgICAgICAgaWYgKGtleWZyYW1lRGF0YUl0ZW0uR2V0VGltZSgpID4gdGltZSkgcmV0dXJuIGtleWZyYW1lRGF0YUl0ZW0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBHZXRGaXJzdEtleUZyYW1lRGF0YUl0ZW1IaWdoZXJPckVxdWFsVGhhbih0aW1lLCB0cmFja0RhdGFJdGVtKSB7CiAgICAgICAgICAgIGNvbnN0IGtleWZyYW1lRGF0YUl0ZW1zID0KICAgICAgICAgICAgICAgIHRyYWNrRGF0YUl0ZW0uR2V0S2V5ZnJhbWVEYXRhKCkuR2V0S2V5ZnJhbWVEYXRhSXRlbUFycmF5KCk7CiAgICAgICAgICAgIGNvbnN0IGwgPSBrZXlmcmFtZURhdGFJdGVtcy5sZW5ndGg7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICAgICAgICBjb25zdCBrZXlmcmFtZURhdGFJdGVtID0ga2V5ZnJhbWVEYXRhSXRlbXNbaV07CiAgICAgICAgICAgICAgICBpZiAoa2V5ZnJhbWVEYXRhSXRlbS5HZXRUaW1lKCkgPj0gdGltZSkgcmV0dXJuIGtleWZyYW1lRGF0YUl0ZW0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBHZXRGaXJzdEtleUZyYW1lRGF0YUl0ZW1Mb3dlck9yRXF1YWxUaGFuKHRpbWUsIHRyYWNrRGF0YUl0ZW0pIHsKICAgICAgICAgICAgY29uc3Qga2V5ZnJhbWVEYXRhSXRlbXMgPSB0cmFja0RhdGFJdGVtLkdldEtleWZyYW1lRGF0YSgpLkdldEtleWZyYW1lRGF0YUl0ZW1BcnJheSgpOwogICAgICAgICAgICBmb3IgKGxldCBpID0ga2V5ZnJhbWVEYXRhSXRlbXMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgICAgICAgICAgIGNvbnN0IGtleWZyYW1lRGF0YUl0ZW0gPSBrZXlmcmFtZURhdGFJdGVtc1tpXTsKICAgICAgICAgICAgICAgIGlmIChrZXlmcmFtZURhdGFJdGVtLkdldFRpbWUoKSA8PSB0aW1lKSByZXR1cm4ga2V5ZnJhbWVEYXRhSXRlbQogICAgICAgICAgICB9CiAgICAgICAgfSogdHJhY2tEYXRhSXRlbXMoKSB7CiAgICAgICAgICAgIGZvciAoY29uc3QgdHJhY2tEYXRhSXRlbSBvZiB0aGlzLl90cmFja0RhdGFJdGVtcykgeWllbGQgdHJhY2tEYXRhSXRlbQogICAgICAgIH0KICAgICAgICBfU2F2ZVRvSnNvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICJ0cmFja0RhdGFJdGVtc0pzb24iOiB0aGlzLl90cmFja0RhdGFJdGVtcy5tYXAodHJhY2tEYXRhSXRlbSA9PgogICAgICAgICAgICAgICAgICAgIHRyYWNrRGF0YUl0ZW0uX1NhdmVUb0pzb24oKSkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBfTG9hZEZyb21Kc29uKG8pIHsKICAgICAgICAgICAgaWYgKCFvKSByZXR1cm47CiAgICAgICAgICAgIEMzLlRpbWVsaW5lRGF0YU1hbmFnZXIuX0xvYWREYXRhSXRlbXNGcm9tSnNvbih0aGlzLl90cmFja0RhdGFJdGVtcywgb1sidHJhY2tEYXRhSXRlbXNKc29uIl0sIFRyYWNrRGF0YUl0ZW0sIHRoaXMpCiAgICAgICAgfQogICAgfTsKCn0KCi8vIHRpbWVsaW5lcy9kYXRhL3Byb3BlcnR5VHJhY2tEYXRhLmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIGNvbnN0IFNPVVJDRV9EQVRBID0gMDsKICAgIGNvbnN0IFNPVVJDRSA9IDA7CiAgICBjb25zdCBQUk9QRVJUWSA9IDE7CiAgICBjb25zdCBUWVBFID0gMjsKICAgIGNvbnN0IE1JTiA9IDM7CiAgICBjb25zdCBNQVggPSA0OwogICAgY29uc3QgSU5URVJQT0xBVElPTl9NT0RFID0gNTsKICAgIGNvbnN0IFJFU1VMVF9NT0RFID0gNjsKICAgIGNvbnN0IEVOQUJMRUQgPSA3OwogICAgY29uc3QgUFJPUEVSVFlfS0VZRlJBTUVTID0gODsKICAgIGNvbnN0IENBTl9IQVZFX1BST1BFUlRZX0tFWUZSQU1FUyA9IDk7CiAgICBjbGFzcyBQcm9wZXJ0eVRyYWNrRGF0YUl0ZW0gewogICAgICAgIGNvbnN0cnVjdG9yKHByb3BlcnR5VHJhY2tEYXRhSnNvbiwgcHJvcGVydHlUcmFja0RhdGEpIHsKICAgICAgICAgICAgdGhpcy5fcHJvcGVydHlUcmFja0RhdGEgPSBwcm9wZXJ0eVRyYWNrRGF0YTsKICAgICAgICAgICAgdGhpcy5fc291cmNlQWRhcHRlcklkID0gIiI7CiAgICAgICAgICAgIHRoaXMuX3NvdXJjZUFkYXB0ZXJBcmd1bWVudHMgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9wcm9wZXJ0eSA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3R5cGUgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9taW4gPSBOYU47CiAgICAgICAgICAgIHRoaXMuX21heCA9IE5hTjsKICAgICAgICAgICAgdGhpcy5faW50ZXJwb2xhdGlvbk1vZGUgPSAiZGVmYXVsdCI7CiAgICAgICAgICAgIHRoaXMuX3Jlc3VsdE1vZGUgPSAiZGVmYXVsdCI7CiAgICAgICAgICAgIHRoaXMuX2VuYWJsZWQgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5fcHJvcGVydHlLZXlmcmFtZURhdGEgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9jYW5IYXZlUHJvcGVydHlLZXlmcmFtZXMgPSB0cnVlOwogICAgICAgICAgICBpZiAoIXByb3BlcnR5VHJhY2tEYXRhSnNvbikgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl9zb3VyY2VBZGFwdGVySWQgPSBwcm9wZXJ0eVRyYWNrRGF0YUpzb25bU09VUkNFX0RBVEFdW1NPVVJDRV07CiAgICAgICAgICAgIHRoaXMuX3NvdXJjZUFkYXB0ZXJBcmd1bWVudHMgPQogICAgICAgICAgICAgICAgcHJvcGVydHlUcmFja0RhdGFKc29uW1NPVVJDRV9EQVRBXS5zbGljZSgxKTsKICAgICAgICAgICAgdGhpcy5fcHJvcGVydHkgPSBwcm9wZXJ0eVRyYWNrRGF0YUpzb25bUFJPUEVSVFldOwogICAgICAgICAgICB0aGlzLl90eXBlID0gcHJvcGVydHlUcmFja0RhdGFKc29uW1RZUEVdOwogICAgICAgICAgICB0aGlzLl9taW4gPSBwcm9wZXJ0eVRyYWNrRGF0YUpzb25bTUlOXTsKICAgICAgICAgICAgdGhpcy5fbWF4ID0gcHJvcGVydHlUcmFja0RhdGFKc29uW01BWF07CiAgICAgICAgICAgIHRoaXMuX2ludGVycG9sYXRpb25Nb2RlID0gcHJvcGVydHlUcmFja0RhdGFKc29uW0lOVEVSUE9MQVRJT05fTU9ERV07CiAgICAgICAgICAgIHRoaXMuX3Jlc3VsdE1vZGUgPSBwcm9wZXJ0eVRyYWNrRGF0YUpzb25bUkVTVUxUX01PREVdOwogICAgICAgICAgICB0aGlzLl9lbmFibGVkID0gISFwcm9wZXJ0eVRyYWNrRGF0YUpzb25bRU5BQkxFRF07CiAgICAgICAgICAgIHRoaXMuX3Byb3BlcnR5S2V5ZnJhbWVEYXRhID0gbmV3IEMzLlByb3BlcnR5S2V5ZnJhbWVEYXRhKHByb3BlcnR5VHJhY2tEYXRhSnNvbltQUk9QRVJUWV9LRVlGUkFNRVNdLCB0aGlzKTsKICAgICAgICAgICAgdGhpcy5fY2FuSGF2ZVByb3BlcnR5S2V5ZnJhbWVzID0KICAgICAgICAgICAgICAgIHByb3BlcnR5VHJhY2tEYXRhSnNvbltDQU5fSEFWRV9QUk9QRVJUWV9LRVlGUkFNRVNdCiAgICAgICAgfQogICAgICAgIFJlbGVhc2UoKSB7CiAgICAgICAgICAgIHRoaXMuX3Byb3BlcnR5S2V5ZnJhbWVEYXRhLlJlbGVhc2UoKTsKICAgICAgICAgICAgdGhpcy5fcHJvcGVydHlLZXlmcmFtZURhdGEgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9wcm9wZXJ0eVRyYWNrRGF0YSA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3NvdXJjZUFkYXB0ZXJBcmd1bWVudHMgPSBudWxsCiAgICAgICAgfQogICAgICAgIEdldFByb3BlcnR5VHJhY2tEYXRhKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fcHJvcGVydHlUcmFja0RhdGEKICAgICAgICB9CiAgICAgICAgR2V0UHJvcGVydHlLZXlmcmFtZURhdGEoKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5fcHJvcGVydHlLZXlmcmFtZURhdGEpIHRoaXMuX3Byb3BlcnR5S2V5ZnJhbWVEYXRhID0gbmV3IEMzLlByb3BlcnR5S2V5ZnJhbWVEYXRhKG51bGwsIHRoaXMpOwogICAgICAgICAgICByZXR1cm4gdGhpcy5fcHJvcGVydHlLZXlmcmFtZURhdGEKICAgICAgICB9CiAgICAgICAgR2V0U291cmNlQWRhcHRlcklkKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fc291cmNlQWRhcHRlcklkCiAgICAgICAgfQogICAgICAgIFNldFNvdXJjZUFkYXB0ZXJJZChzYWlkKSB7CiAgICAgICAgICAgIHRoaXMuX3NvdXJjZUFkYXB0ZXJJZCA9CiAgICAgICAgICAgICAgICBzYWlkCiAgICAgICAgfQogICAgICAgIEdldFNvdXJjZUFkYXB0ZXJBcmd1bWVudHMoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zb3VyY2VBZGFwdGVyQXJndW1lbnRzCiAgICAgICAgfQogICAgICAgIFNldFNvdXJjZUFkYXB0ZXJBcmd1bWVudHMoc2FyZ3MpIHsKICAgICAgICAgICAgdGhpcy5fc291cmNlQWRhcHRlckFyZ3VtZW50cyA9IHNhcmdzCiAgICAgICAgfQogICAgICAgIEdldFByb3BlcnR5KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fcHJvcGVydHkKICAgICAgICB9CiAgICAgICAgU2V0UHJvcGVydHkocCkgewogICAgICAgICAgICB0aGlzLl9wcm9wZXJ0eSA9IHAKICAgICAgICB9CiAgICAgICAgR2V0VHlwZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3R5cGUKICAgICAgICB9CiAgICAgICAgU2V0VHlwZSh0KSB7CiAgICAgICAgICAgIHRoaXMuX3R5cGUgPSB0CiAgICAgICAgfQogICAgICAgIEdldE1pbigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX21pbgogICAgICAgIH0KICAgICAgICBTZXRNaW4obWluKSB7CiAgICAgICAgICAgIHRoaXMuX21pbiA9IG1pbgogICAgICAgIH0KICAgICAgICBHZXRNYXgoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9tYXgKICAgICAgICB9CiAgICAgICAgU2V0TWF4KG1heCkgewogICAgICAgICAgICB0aGlzLl9tYXggPSBtYXgKICAgICAgICB9CiAgICAgICAgR2V0SW50ZXJwb2xhdGlvbk1vZGUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pbnRlcnBvbGF0aW9uTW9kZQogICAgICAgIH0KICAgICAgICBTZXRJbnRlcnBvbGF0aW9uTW9kZShpbSkgewogICAgICAgICAgICB0aGlzLl9pbnRlcnBvbGF0aW9uTW9kZSA9IGltCiAgICAgICAgfQogICAgICAgIEdldFJlc3VsdE1vZGUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9yZXN1bHRNb2RlCiAgICAgICAgfQogICAgICAgIFNldFJlc3VsdE1vZGUocm0pIHsKICAgICAgICAgICAgdGhpcy5fcmVzdWx0TW9kZSA9CiAgICAgICAgICAgICAgICBybQogICAgICAgIH0KICAgICAgICBHZXRFbmFibGUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9lbmFibGVkCiAgICAgICAgfQogICAgICAgIFNldEVuYWJsZShlKSB7CiAgICAgICAgICAgIHRoaXMuX2VuYWJsZWQgPSAhIWUKICAgICAgICB9CiAgICAgICAgQ2FuSGF2ZVByb3BlcnR5S2V5ZnJhbWVzKCkgewogICAgICAgICAgICByZXR1cm4gISF0aGlzLl9jYW5IYXZlUHJvcGVydHlLZXlmcmFtZXMKICAgICAgICB9CiAgICAgICAgX1NhdmVUb0pzb24oKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAicHJvcGVydHlLZXlmcmFtZURhdGFKc29uIjogdGhpcy5fcHJvcGVydHlLZXlmcmFtZURhdGEuX1NhdmVUb0pzb24oKSwKICAgICAgICAgICAgICAgICJzb3VyY2VBZGFwdGVySWQiOiB0aGlzLl9zb3VyY2VBZGFwdGVySWQsCiAgICAgICAgICAgICAgICAic291cmNlQWRhcHRlckFyZ3VtZW50cyI6IHRoaXMuX3NvdXJjZUFkYXB0ZXJBcmd1bWVudHMsCiAgICAgICAgICAgICAgICAicHJvcGVydHkiOiB0aGlzLl9wcm9wZXJ0eSwKICAgICAgICAgICAgICAgICJ0eXBlIjogdGhpcy5fdHlwZSwKICAgICAgICAgICAgICAgICJtaW4iOiB0aGlzLl9taW4sCiAgICAgICAgICAgICAgICAibWF4IjogdGhpcy5fbWF4LAogICAgICAgICAgICAgICAgImludGVycG9sYXRpb25Nb2RlIjogdGhpcy5faW50ZXJwb2xhdGlvbk1vZGUsCiAgICAgICAgICAgICAgICAicmVzdWx0TW9kZSI6IHRoaXMuX3Jlc3VsdE1vZGUsCiAgICAgICAgICAgICAgICAiZW5hYmxlZCI6IHRoaXMuX2VuYWJsZWQsCiAgICAgICAgICAgICAgICAiY2FuSGF2ZVByb3BlcnR5S2V5ZnJhbWVzIjogdGhpcy5fY2FuSGF2ZVByb3BlcnR5S2V5ZnJhbWVzCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgX0xvYWRGcm9tSnNvbihvKSB7CiAgICAgICAgICAgIGlmICghbykgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl9zb3VyY2VBZGFwdGVySWQgPSBvWyJzb3VyY2VBZGFwdGVySWQiXTsKICAgICAgICAgICAgdGhpcy5fc291cmNlQWRhcHRlckFyZ3VtZW50cyA9IG9bInNvdXJjZUFkYXB0ZXJBcmd1bWVudHMiXTsKICAgICAgICAgICAgdGhpcy5fcHJvcGVydHkgPSBvWyJwcm9wZXJ0eSJdOwogICAgICAgICAgICB0aGlzLl90eXBlID0gb1sidHlwZSJdOwogICAgICAgICAgICB0aGlzLl9taW4gPSBvWyJtaW4iXTsKICAgICAgICAgICAgdGhpcy5fbWF4ID0gb1sibWF4Il07CiAgICAgICAgICAgIHRoaXMuX2ludGVycG9sYXRpb25Nb2RlID0gb1siaW50ZXJwb2xhdGlvbk1vZGUiXTsKICAgICAgICAgICAgdGhpcy5fcmVzdWx0TW9kZSA9IG9bInJlc3VsdE1vZGUiXTsKICAgICAgICAgICAgdGhpcy5fZW5hYmxlZCA9IG9bImVuYWJsZWQiXTsKICAgICAgICAgICAgdGhpcy5fY2FuSGF2ZVByb3BlcnR5S2V5ZnJhbWVzID0gb1siY2FuSGF2ZVByb3BlcnR5S2V5ZnJhbWVzIl07CiAgICAgICAgICAgIHRoaXMuR2V0UHJvcGVydHlLZXlmcmFtZURhdGEoKS5fTG9hZEZyb21Kc29uKG9bInByb3BlcnR5S2V5ZnJhbWVEYXRhSnNvbiJdKQogICAgICAgIH0KICAgIH0KICAgIEMzLlByb3BlcnR5VHJhY2tEYXRhID0gY2xhc3MgUHJvcGVydHlUcmFja0RhdGEgewogICAgICAgIGNvbnN0cnVjdG9yKHByb3BlcnR5VHJhY2tzRGF0YUpzb24sIHRyYWNrRGF0YUl0ZW0pIHsKICAgICAgICAgICAgdGhpcy5fdHJhY2tEYXRhSXRlbSA9IHRyYWNrRGF0YUl0ZW07CiAgICAgICAgICAgIHRoaXMuX3Byb3BlcnR5VHJhY2tEYXRhSXRlbXMgPSBbXTsKICAgICAgICAgICAgQzMuVGltZWxpbmVEYXRhTWFuYWdlci5fQ3JlYXRlRGF0YUl0ZW1zKHRoaXMuX3Byb3BlcnR5VHJhY2tEYXRhSXRlbXMsIHByb3BlcnR5VHJhY2tzRGF0YUpzb24sIFByb3BlcnR5VHJhY2tEYXRhSXRlbSwgdGhpcykKICAgICAgICB9CiAgICAgICAgUmVsZWFzZSgpIHsKICAgICAgICAgICAgdGhpcy5fdHJhY2tEYXRhSXRlbSA9IG51bGw7CiAgICAgICAgICAgIGZvciAoY29uc3QgcHJvcGVydHlUcmFja0RhdGFJdGVtIG9mIHRoaXMuX3Byb3BlcnR5VHJhY2tEYXRhSXRlbXMpIHByb3BlcnR5VHJhY2tEYXRhSXRlbS5SZWxlYXNlKCk7CiAgICAgICAgICAgIEMzLmNsZWFyQXJyYXkodGhpcy5fcHJvcGVydHlUcmFja0RhdGFJdGVtcyk7CiAgICAgICAgICAgIHRoaXMuX3Byb3BlcnR5VHJhY2tEYXRhSXRlbXMgPSBudWxsCiAgICAgICAgfQogICAgICAgIEdldFRyYWNrRGF0YUl0ZW0oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl90cmFja0RhdGFJdGVtCiAgICAgICAgfQogICAgICAgIEFkZEVtcHR5UHJvcGVydHlUcmFja0RhdGFJdGVtKCkgewogICAgICAgICAgICBjb25zdCBwcm9wZXJ0eVRyYWNrRGF0YUl0ZW0gPQogICAgICAgICAgICAgICAgbmV3IFByb3BlcnR5VHJhY2tEYXRhSXRlbShudWxsLCB0aGlzKTsKICAgICAgICAgICAgdGhpcy5fcHJvcGVydHlUcmFja0RhdGFJdGVtcy5wdXNoKHByb3BlcnR5VHJhY2tEYXRhSXRlbSk7CiAgICAgICAgICAgIHJldHVybiBwcm9wZXJ0eVRyYWNrRGF0YUl0ZW0KICAgICAgICB9CiAgICAgICAgR2V0Rmlyc3RQcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW0ocHJvcGVydHlUcmFja0RhdGFJdGVtKSB7CiAgICAgICAgICAgIGNvbnN0IHByb3BlcnR5S2V5ZnJhbWVEYXRhID0gcHJvcGVydHlUcmFja0RhdGFJdGVtLkdldFByb3BlcnR5S2V5ZnJhbWVEYXRhKCk7CiAgICAgICAgICAgIHJldHVybiBwcm9wZXJ0eUtleWZyYW1lRGF0YS5HZXRQcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW1BcnJheSgpWzBdCiAgICAgICAgfQogICAgICAgIEdldExhc3RQcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW0ocHJvcGVydHlUcmFja0RhdGFJdGVtKSB7CiAgICAgICAgICAgIGNvbnN0IHByb3BlcnR5S2V5ZnJhbWVEYXRhID0gcHJvcGVydHlUcmFja0RhdGFJdGVtLkdldFByb3BlcnR5S2V5ZnJhbWVEYXRhKCk7CiAgICAgICAgICAgIGNvbnN0IHByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbXMgPSBwcm9wZXJ0eUtleWZyYW1lRGF0YS5HZXRQcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW1BcnJheSgpOwogICAgICAgICAgICByZXR1cm4gcHJvcGVydHlLZXlmcmFtZURhdGFJdGVtcy5hdCgtMSkKICAgICAgICB9CiAgICAgICAgR2V0UHJvcGVydHlLZXlGcmFtZURhdGFJdGVtQXRUaW1lKHRpbWUsIHByb3BlcnR5VHJhY2tEYXRhSXRlbSkgewogICAgICAgICAgICBjb25zdCBwcm9wZXJ0eUtleWZyYW1lRGF0YSA9IHByb3BlcnR5VHJhY2tEYXRhSXRlbS5HZXRQcm9wZXJ0eUtleWZyYW1lRGF0YSgpOwogICAgICAgICAgICBjb25zdCBwcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW1zID0gcHJvcGVydHlLZXlmcmFtZURhdGEuR2V0UHJvcGVydHlLZXlmcmFtZURhdGFJdGVtQXJyYXkoKTsKICAgICAgICAgICAgY29uc3QgbCA9IHByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbXMubGVuZ3RoOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGw7IGkrKykgewogICAgICAgICAgICAgICAgY29uc3QgcHJvcGVydHlLZXlmcmFtZURhdGFJdGVtID0gcHJvcGVydHlLZXlmcmFtZURhdGFJdGVtc1tpXTsKICAgICAgICAgICAgICAgIGlmIChwcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW0uR2V0VGltZSgpID09PSB0aW1lKSByZXR1cm4gcHJvcGVydHlLZXlmcmFtZURhdGFJdGVtCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgR2V0Rmlyc3RQcm9wZXJ0eUtleUZyYW1lRGF0YUl0ZW1IaWdoZXJUaGFuKHRpbWUsCiAgICAgICAgICAgIHByb3BlcnR5VHJhY2tEYXRhSXRlbSkgewogICAgICAgICAgICBjb25zdCBwcm9wZXJ0eUtleWZyYW1lRGF0YSA9IHByb3BlcnR5VHJhY2tEYXRhSXRlbS5HZXRQcm9wZXJ0eUtleWZyYW1lRGF0YSgpOwogICAgICAgICAgICBjb25zdCBwcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW1zID0gcHJvcGVydHlLZXlmcmFtZURhdGEuR2V0UHJvcGVydHlLZXlmcmFtZURhdGFJdGVtQXJyYXkoKTsKICAgICAgICAgICAgY29uc3QgbCA9IHByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbXMubGVuZ3RoOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGw7IGkrKykgewogICAgICAgICAgICAgICAgY29uc3QgcHJvcGVydHlLZXlmcmFtZURhdGFJdGVtID0gcHJvcGVydHlLZXlmcmFtZURhdGFJdGVtc1tpXTsKICAgICAgICAgICAgICAgIGlmIChwcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW0uR2V0VGltZSgpID4gdGltZSkgcmV0dXJuIHByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIEdldEZpcnN0UHJvcGVydHlLZXlGcmFtZURhdGFJdGVtSGlnaGVyT3JFcXVhbFRoYW4odGltZSwgcHJvcGVydHlUcmFja0RhdGFJdGVtKSB7CiAgICAgICAgICAgIGNvbnN0IHByb3BlcnR5S2V5ZnJhbWVEYXRhID0gcHJvcGVydHlUcmFja0RhdGFJdGVtLkdldFByb3BlcnR5S2V5ZnJhbWVEYXRhKCk7CiAgICAgICAgICAgIGNvbnN0IHByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbXMgPSBwcm9wZXJ0eUtleWZyYW1lRGF0YS5HZXRQcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW1BcnJheSgpOwogICAgICAgICAgICBjb25zdCBsID0gcHJvcGVydHlLZXlmcmFtZURhdGFJdGVtcy5sZW5ndGg7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICAgICAgICBjb25zdCBwcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW0gPSBwcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW1zW2ldOwogICAgICAgICAgICAgICAgaWYgKHByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbS5HZXRUaW1lKCkgPj0gdGltZSkgcmV0dXJuIHByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIEdldEZpcnN0UHJvcGVydHlLZXlGcmFtZURhdGFJdGVtTG93ZXJPckVxdWFsVGhhbih0aW1lLCBwcm9wZXJ0eVRyYWNrRGF0YUl0ZW0pIHsKICAgICAgICAgICAgY29uc3QgcHJvcGVydHlLZXlmcmFtZURhdGEgPSBwcm9wZXJ0eVRyYWNrRGF0YUl0ZW0uR2V0UHJvcGVydHlLZXlmcmFtZURhdGEoKTsKICAgICAgICAgICAgY29uc3QgcHJvcGVydHlLZXlmcmFtZURhdGFJdGVtcyA9IHByb3BlcnR5S2V5ZnJhbWVEYXRhLkdldFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbUFycmF5KCk7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSBwcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW1zLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICAgICAgICAgICAgICBjb25zdCBwcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW0gPSBwcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW1zW2ldOwogICAgICAgICAgICAgICAgaWYgKHByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbS5HZXRUaW1lKCkgPD0gdGltZSkgcmV0dXJuIHByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbQogICAgICAgICAgICB9CiAgICAgICAgfSogcHJvcGVydHlUcmFja0RhdGFJdGVtcygpIHsKICAgICAgICAgICAgZm9yIChjb25zdCBwcm9wZXJ0eVRyYWNrRGF0YUl0ZW0gb2YgdGhpcy5fcHJvcGVydHlUcmFja0RhdGFJdGVtcykgeWllbGQgcHJvcGVydHlUcmFja0RhdGFJdGVtCiAgICAgICAgfQogICAgICAgIF9TYXZlVG9Kc29uKCkgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgInByb3BlcnR5VHJhY2tEYXRhSXRlbXNKc29uIjogdGhpcy5fcHJvcGVydHlUcmFja0RhdGFJdGVtcy5tYXAocHJvcGVydHlUcmFja0RhdGFJdGVtID0+IHByb3BlcnR5VHJhY2tEYXRhSXRlbS5fU2F2ZVRvSnNvbigpKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIF9Mb2FkRnJvbUpzb24obykgewogICAgICAgICAgICBpZiAoIW8pIHJldHVybjsKICAgICAgICAgICAgQzMuVGltZWxpbmVEYXRhTWFuYWdlci5fTG9hZERhdGFJdGVtc0Zyb21Kc29uKHRoaXMuX3Byb3BlcnR5VHJhY2tEYXRhSXRlbXMsCiAgICAgICAgICAgICAgICBvWyJwcm9wZXJ0eVRyYWNrRGF0YUl0ZW1zSnNvbiJdLCBQcm9wZXJ0eVRyYWNrRGF0YUl0ZW0sIHRoaXMpCiAgICAgICAgfQogICAgfTsKCn0KCi8vIHRpbWVsaW5lcy9kYXRhL2tleWZyYW1lRGF0YS5qcwp7CiAgICAndXNlIHN0cmljdCc7CiAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICBjb25zdCBUSU1FID0gMDsKICAgIGNvbnN0IEVBU0UgPSAxOwogICAgY29uc3QgRU5BQkxFID0gMjsKICAgIGNvbnN0IFRBR1MgPSAzOwogICAgY2xhc3MgS2V5ZnJhbWVEYXRhSXRlbSB7CiAgICAgICAgY29uc3RydWN0b3Ioa2V5ZnJhbWVEYXRhSnNvbiwga2V5ZnJhbWVEYXRhKSB7CiAgICAgICAgICAgIHRoaXMuX2tleWZyYW1lRGF0YSA9IGtleWZyYW1lRGF0YTsKICAgICAgICAgICAgdGhpcy5fdGltZSA9IC0xOwogICAgICAgICAgICB0aGlzLl9lYXNlID0gIm5vZWFzZSI7CiAgICAgICAgICAgIHRoaXMuX2VuYWJsZSA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl90YWdzID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fbG93ZXJUYWdzID0gbnVsbDsKICAgICAgICAgICAgaWYgKCFrZXlmcmFtZURhdGFKc29uKSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuX3RpbWUgPSBrZXlmcmFtZURhdGFKc29uW1RJTUVdOwogICAgICAgICAgICB0aGlzLl9lYXNlID0ga2V5ZnJhbWVEYXRhSnNvbltFQVNFXTsKICAgICAgICAgICAgdGhpcy5fZW5hYmxlID0gISFrZXlmcmFtZURhdGFKc29uW0VOQUJMRV07CiAgICAgICAgICAgIGNvbnN0IHRhZ1N0ciA9IGtleWZyYW1lRGF0YUpzb25bVEFHU107CiAgICAgICAgICAgIHRoaXMuX3RhZ3MgPSB0YWdTdHIgPyB0YWdTdHIuc3BsaXQoIiAiKSA6IFtdOwogICAgICAgICAgICB0aGlzLl9sb3dlclRhZ3MgPSBuZXcgU2V0KHRoaXMuX3RhZ3MubWFwKHQgPT4gdC50b0xvd2VyQ2FzZSgpKSk7CiAgICAgICAgICAgIHRoaXMuX25leHQgPSBudWxsCiAgICAgICAgfQogICAgICAgIFJlbGVhc2UoKSB7CiAgICAgICAgICAgIHRoaXMuX2tleWZyYW1lRGF0YSA9CiAgICAgICAgICAgICAgICBudWxsOwogICAgICAgICAgICBDMy5jbGVhckFycmF5KHRoaXMuX3RhZ3MpOwogICAgICAgICAgICB0aGlzLl90YWdzID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fbG93ZXJUYWdzLmNsZWFyKCk7CiAgICAgICAgICAgIHRoaXMuX2xvd2VyVGFncyA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX25leHQgPSBudWxsCiAgICAgICAgfQogICAgICAgIEdldEtleWZyYW1lRGF0YSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2tleWZyYW1lRGF0YQogICAgICAgIH0KICAgICAgICBHZXROZXh0KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fbmV4dAogICAgICAgIH0KICAgICAgICBTZXROZXh0KG5leHQpIHsKICAgICAgICAgICAgdGhpcy5fbmV4dCA9IG5leHQKICAgICAgICB9CiAgICAgICAgR2V0VGltZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RpbWUKICAgICAgICB9CiAgICAgICAgU2V0VGltZSh0KSB7CiAgICAgICAgICAgIHRoaXMuX3RpbWUgPSB0OwogICAgICAgICAgICB0aGlzLl9rZXlmcmFtZURhdGEuX0xpbmtLZXlmcmFtZURhdGFJdGVtcygpCiAgICAgICAgfQogICAgICAgIEdldEVhc2UoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9lYXNlCiAgICAgICAgfQogICAgICAgIFNldEVhc2UoZSkgewogICAgICAgICAgICB0aGlzLl9lYXNlID0gZQogICAgICAgIH0KICAgICAgICBHZXRFbmFibGUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9lbmFibGUKICAgICAgICB9CiAgICAgICAgU2V0RW5hYmxlKGUpIHsKICAgICAgICAgICAgdGhpcy5fZW5hYmxlID0gISFlCiAgICAgICAgfQogICAgICAgIEdldFRhZ3MoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl90YWdzCiAgICAgICAgfQogICAgICAgIFNldFRhZ3ModCkgewogICAgICAgICAgICB0aGlzLl90YWdzID0gdCA/IHQuc3BsaXQoIiAiKSA6IFtdOwogICAgICAgICAgICB0aGlzLl9sb3dlclRhZ3MgPQogICAgICAgICAgICAgICAgbmV3IFNldCh0aGlzLl90YWdzLm1hcCh0ID0+IHQudG9Mb3dlckNhc2UoKSkpCiAgICAgICAgfQogICAgICAgIEdldExvd2VyVGFncygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2xvd2VyVGFncwogICAgICAgIH0KICAgICAgICBIYXNUYWcodGFnKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9sb3dlclRhZ3MuaGFzKHRhZy50b0xvd2VyQ2FzZSgpKQogICAgICAgIH0KICAgICAgICBfU2F2ZVRvSnNvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICJ0aW1lIjogdGhpcy5fdGltZSwKICAgICAgICAgICAgICAgICJlYXNlIjogdGhpcy5fZWFzZSwKICAgICAgICAgICAgICAgICJlbmFibGUiOiB0aGlzLl9lbmFibGUsCiAgICAgICAgICAgICAgICAidGFncyI6IHRoaXMuX3RhZ3MKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBfTG9hZEZyb21Kc29uKG8pIHsKICAgICAgICAgICAgaWYgKCFvKSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuX3RpbWUgPSBvWyJ0aW1lIl07CiAgICAgICAgICAgIHRoaXMuX2Vhc2UgPSBvWyJlYXNlIl07CiAgICAgICAgICAgIHRoaXMuX2VuYWJsZSA9IG9bImVuYWJsZSJdOwogICAgICAgICAgICB0aGlzLl90YWdzID0gb1sidGFncyJdOwogICAgICAgICAgICB0aGlzLl9sb3dlclRhZ3MgPSBuZXcgU2V0KHRoaXMuX3RhZ3MubWFwKHQgPT4gdC50b0xvd2VyQ2FzZSgpKSkKICAgICAgICB9CiAgICB9CiAgICBDMy5LZXlmcmFtZURhdGEgPSBjbGFzcyBLZXlmcmFtZURhdGEgewogICAgICAgIGNvbnN0cnVjdG9yKGtleWZyYW1lc0RhdGFKc29uLCB0cmFja0RhdGFJdGVtKSB7CiAgICAgICAgICAgIHRoaXMuX3RyYWNrRGF0YUl0ZW0gPSB0cmFja0RhdGFJdGVtOwogICAgICAgICAgICB0aGlzLl9rZXlmcmFtZURhdGFJdGVtcyA9IFtdOwogICAgICAgICAgICBDMy5UaW1lbGluZURhdGFNYW5hZ2VyLl9DcmVhdGVEYXRhSXRlbXModGhpcy5fa2V5ZnJhbWVEYXRhSXRlbXMsIGtleWZyYW1lc0RhdGFKc29uLCBLZXlmcmFtZURhdGFJdGVtLCB0aGlzKTsKICAgICAgICAgICAgdGhpcy5fTGlua0tleWZyYW1lRGF0YUl0ZW1zKCkKICAgICAgICB9CiAgICAgICAgUmVsZWFzZSgpIHsKICAgICAgICAgICAgdGhpcy5fdHJhY2tEYXRhSXRlbSA9IG51bGw7CiAgICAgICAgICAgIGZvciAoY29uc3Qga2V5ZnJhbWVEYXRhSXRlbSBvZiB0aGlzLl9rZXlmcmFtZURhdGFJdGVtcykga2V5ZnJhbWVEYXRhSXRlbS5SZWxlYXNlKCk7CiAgICAgICAgICAgIEMzLmNsZWFyQXJyYXkodGhpcy5fa2V5ZnJhbWVEYXRhSXRlbXMpOwogICAgICAgICAgICB0aGlzLl9rZXlmcmFtZURhdGFJdGVtcyA9IG51bGwKICAgICAgICB9CiAgICAgICAgX0xpbmtLZXlmcmFtZURhdGFJdGVtcygpIHsKICAgICAgICAgICAgdGhpcy5fa2V5ZnJhbWVEYXRhSXRlbXMuc29ydCgoZmlyc3QsCiAgICAgICAgICAgICAgICBzZWNvbmQpID0+IGZpcnN0LkdldFRpbWUoKSAtIHNlY29uZC5HZXRUaW1lKCkpOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuX2tleWZyYW1lRGF0YUl0ZW1zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50ID0gdGhpcy5fa2V5ZnJhbWVEYXRhSXRlbXNbaV07CiAgICAgICAgICAgICAgICBjdXJyZW50LlNldE5leHQodGhpcy5fa2V5ZnJhbWVEYXRhSXRlbXNbaSArIDFdKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIEdldFRyYWNrRGF0YUl0ZW0oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl90cmFja0RhdGFJdGVtCiAgICAgICAgfQogICAgICAgIEdldEtleWZyYW1lRGF0YUl0ZW1Db3VudCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2tleWZyYW1lRGF0YUl0ZW1zLmxlbmd0aAogICAgICAgIH0KICAgICAgICBHZXRLZXlmcmFtZURhdGFJdGVtQXJyYXkoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9rZXlmcmFtZURhdGFJdGVtcwogICAgICAgIH0KICAgICAgICBBZGRFbXB0eUtleWZyYW1lRGF0YUl0ZW0oKSB7CiAgICAgICAgICAgIGNvbnN0IGtleWZyYW1lRGF0YUl0ZW0gPSBuZXcgS2V5ZnJhbWVEYXRhSXRlbShudWxsLCB0aGlzKTsKICAgICAgICAgICAgdGhpcy5fa2V5ZnJhbWVEYXRhSXRlbXMucHVzaChrZXlmcmFtZURhdGFJdGVtKTsKICAgICAgICAgICAgdGhpcy5fTGlua0tleWZyYW1lRGF0YUl0ZW1zKCk7CiAgICAgICAgICAgIHJldHVybiBrZXlmcmFtZURhdGFJdGVtCiAgICAgICAgfQogICAgICAgIERlbGV0ZUtleWZyYW1lRGF0YUl0ZW1zKG1hdGNoKSB7CiAgICAgICAgICAgIGZvciAoY29uc3Qga2V5ZnJhbWVEYXRhSXRlbSBvZiB0aGlzLl9rZXlmcmFtZURhdGFJdGVtcykgewogICAgICAgICAgICAgICAgaWYgKCFtYXRjaChrZXlmcmFtZURhdGFJdGVtKSkgY29udGludWU7CiAgICAgICAgICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMuX2tleWZyYW1lRGF0YUl0ZW1zLmluZGV4T2Yoa2V5ZnJhbWVEYXRhSXRlbSk7CiAgICAgICAgICAgICAgICBpZiAoaW5kZXggPT09IC0xKSBjb250aW51ZTsKICAgICAgICAgICAgICAgIGtleWZyYW1lRGF0YUl0ZW0uUmVsZWFzZSgpOwogICAgICAgICAgICAgICAgdGhpcy5fa2V5ZnJhbWVEYXRhSXRlbXMuc3BsaWNlKGluZGV4LCAxKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuU29ydEtleWZyYW1lRGF0YUl0ZW1zKCk7CiAgICAgICAgICAgIHRoaXMuX0xpbmtLZXlmcmFtZURhdGFJdGVtcygpCiAgICAgICAgfQogICAgICAgIFNvcnRLZXlmcmFtZURhdGFJdGVtcygpIHsKICAgICAgICAgICAgdGhpcy5fa2V5ZnJhbWVEYXRhSXRlbXMuc29ydCgoYSwgYikgPT4gYS5HZXRUaW1lKCkgLSBiLkdldFRpbWUoKSkKICAgICAgICB9CiAgICAgICAgR2V0S2V5ZnJhbWVEYXRhSXRlbUluZGV4KGtleWZyYW1lRGF0YUl0ZW0pIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2tleWZyYW1lRGF0YUl0ZW1zLmluZGV4T2Yoa2V5ZnJhbWVEYXRhSXRlbSkKICAgICAgICB9CiAgICAgICAgR2V0S2V5ZnJhbWVEYXRhSXRlbUZyb21JbmRleChpbmRleCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fa2V5ZnJhbWVEYXRhSXRlbXNbaW5kZXhdCiAgICAgICAgfSoga2V5ZnJhbWVEYXRhSXRlbXMoKSB7CiAgICAgICAgICAgIGZvciAoY29uc3Qga2V5ZnJhbWVEYXRhSXRlbSBvZiB0aGlzLl9rZXlmcmFtZURhdGFJdGVtcykgeWllbGQga2V5ZnJhbWVEYXRhSXRlbQogICAgICAgIH0qIGtleWZyYW1lRGF0YUl0ZW1zUmV2ZXJzZSgpIHsKICAgICAgICAgICAgZm9yIChsZXQgaSA9CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fa2V5ZnJhbWVEYXRhSXRlbXMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHlpZWxkIHRoaXMuX2tleWZyYW1lRGF0YUl0ZW1zW2ldCiAgICAgICAgfQogICAgICAgIF9TYXZlVG9Kc29uKCkgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgImtleWZyYW1lRGF0YUl0ZW1zSnNvbiI6IHRoaXMuX2tleWZyYW1lRGF0YUl0ZW1zLm1hcChrZXlmcmFtZURhdGFJdGVtID0+IGtleWZyYW1lRGF0YUl0ZW0uX1NhdmVUb0pzb24oKSkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBfTG9hZEZyb21Kc29uKG8pIHsKICAgICAgICAgICAgaWYgKCFvKSByZXR1cm47CiAgICAgICAgICAgIEMzLlRpbWVsaW5lRGF0YU1hbmFnZXIuX0xvYWREYXRhSXRlbXNGcm9tSnNvbih0aGlzLl9rZXlmcmFtZURhdGFJdGVtcywgb1sia2V5ZnJhbWVEYXRhSXRlbXNKc29uIl0sIEtleWZyYW1lRGF0YUl0ZW0sIHRoaXMpOwogICAgICAgICAgICB0aGlzLl9MaW5rS2V5ZnJhbWVEYXRhSXRlbXMoKQogICAgICAgIH0KICAgIH07Cgp9CgovLyB0aW1lbGluZXMvZGF0YS9wcm9wZXJ0eUtleWZyYW1lRGF0YS5qcwp7CiAgICAndXNlIHN0cmljdCc7CiAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICBjb25zdCBWQUxVRV9EQVRBID0gMDsKICAgIGNvbnN0IFZBTFVFX0RBVEFfVkFMVUUgPSAwOwogICAgY29uc3QgVkFMVUVfREFUQV9BQlNPTFVURV9WQUxVRSA9IDE7CiAgICBjb25zdCBWQUxVRV9EQVRBX1RZUEUgPSAyOwogICAgY29uc3QgVElNRSA9IDE7CiAgICBjb25zdCBFQVNFID0gMjsKICAgIGNvbnN0IEVOQUJMRSA9IDM7CiAgICBjb25zdCBBRERPTlMgPSA0OwogICAgY29uc3QgUEFUSF9NT0RFID0gNTsKICAgIGNsYXNzIFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbSB7CiAgICAgICAgY29uc3RydWN0b3IocHJvcGVydHlLZXlmcmFtZURhdGFKc29uLCBwcm9wZXJ0eUtleWZyYW1lRGF0YSkgewogICAgICAgICAgICB0aGlzLl9wcm9wZXJ0eUtleWZyYW1lRGF0YSA9IHByb3BlcnR5S2V5ZnJhbWVEYXRhOwogICAgICAgICAgICB0aGlzLl92YWx1ZSA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX2FWYWx1ZSA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3R5cGUgPSAiIjsKICAgICAgICAgICAgdGhpcy5fdGltZSA9IE5hTjsKICAgICAgICAgICAgdGhpcy5fZWFzZSA9ICJub2Vhc2UiOwogICAgICAgICAgICB0aGlzLl9lbmFibGUgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5fYWRkb25EYXRhID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fYWRkb25JbnN0YW5jZSA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgdGhpcy5fcGF0aE1vZGUgPSAibGluZSI7CiAgICAgICAgICAgIGlmICghcHJvcGVydHlLZXlmcmFtZURhdGFKc29uKSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuX3ZhbHVlID0gcHJvcGVydHlLZXlmcmFtZURhdGFKc29uW1ZBTFVFX0RBVEFdW1ZBTFVFX0RBVEFfVkFMVUVdOwogICAgICAgICAgICB0aGlzLl9hVmFsdWUgPSBwcm9wZXJ0eUtleWZyYW1lRGF0YUpzb25bVkFMVUVfREFUQV1bVkFMVUVfREFUQV9BQlNPTFVURV9WQUxVRV07CiAgICAgICAgICAgIHRoaXMuX3R5cGUgPQogICAgICAgICAgICAgICAgcHJvcGVydHlLZXlmcmFtZURhdGFKc29uW1ZBTFVFX0RBVEFdW1ZBTFVFX0RBVEFfVFlQRV07CiAgICAgICAgICAgIHRoaXMuX3RpbWUgPSBwcm9wZXJ0eUtleWZyYW1lRGF0YUpzb25bVElNRV07CiAgICAgICAgICAgIHRoaXMuX2Vhc2UgPSBwcm9wZXJ0eUtleWZyYW1lRGF0YUpzb25bRUFTRV07CiAgICAgICAgICAgIHRoaXMuX2VuYWJsZSA9ICEhcHJvcGVydHlLZXlmcmFtZURhdGFKc29uW0VOQUJMRV07CiAgICAgICAgICAgIHRoaXMuX3BhdGhNb2RlID0gcHJvcGVydHlLZXlmcmFtZURhdGFKc29uW1BBVEhfTU9ERV07CiAgICAgICAgICAgIHRoaXMuX2FkZG9uRGF0YSA9IG51bGw7CiAgICAgICAgICAgIGlmICghIXByb3BlcnR5S2V5ZnJhbWVEYXRhSnNvbltBRERPTlNdKSB0aGlzLl9hZGRvbkRhdGEgPSBuZXcgQzMuQWRkb25EYXRhKHByb3BlcnR5S2V5ZnJhbWVEYXRhSnNvbltBRERPTlNdLCB0aGlzKTsKICAgICAgICAgICAgdGhpcy5fbmV4dCA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3ByZXYgPSBudWxsCiAgICAgICAgfQogICAgICAgIFJlbGVhc2UoKSB7CiAgICAgICAgICAgIHRoaXMuX3Byb3BlcnR5S2V5ZnJhbWVEYXRhID0gbnVsbDsKICAgICAgICAgICAgaWYgKHRoaXMuX2FkZG9uRGF0YSkgewogICAgICAgICAgICAgICAgdGhpcy5fYWRkb25EYXRhLlJlbGVhc2UoKTsKICAgICAgICAgICAgICAgIHRoaXMuX2FkZG9uRGF0YSA9CiAgICAgICAgICAgICAgICAgICAgbnVsbAogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuX25leHQgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9wcmV2ID0gbnVsbAogICAgICAgIH0KICAgICAgICBHZXRBZGRvbkRhdGEoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9hZGRvbkRhdGEKICAgICAgICB9CiAgICAgICAgU2V0TmV4dChuZXh0KSB7CiAgICAgICAgICAgIHRoaXMuX25leHQgPSBuZXh0CiAgICAgICAgfQogICAgICAgIEdldE5leHQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9uZXh0CiAgICAgICAgfQogICAgICAgIFNldFByZXZpb3VzKHByZXYpIHsKICAgICAgICAgICAgdGhpcy5fcHJldiA9IHByZXYKICAgICAgICB9CiAgICAgICAgR2V0UHJldmlvdXMoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9wcmV2CiAgICAgICAgfQogICAgICAgIEdldFZhbHVlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fdmFsdWUKICAgICAgICB9CiAgICAgICAgU2V0VmFsdWUodmFsdWUpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX3R5cGUgPT09ICJjb2xvciIgJiYgQzMuSXNGaW5pdGVOdW1iZXIodmFsdWUpKSB7CiAgICAgICAgICAgICAgICB0aGlzLl92YWx1ZVswXSA9IEMzLkdldFJWYWx1ZSh2YWx1ZSk7CiAgICAgICAgICAgICAgICB0aGlzLl92YWx1ZVsxXSA9IEMzLkdldEdWYWx1ZSh2YWx1ZSk7CiAgICAgICAgICAgICAgICB0aGlzLl92YWx1ZVsyXSA9IEMzLkdldEJWYWx1ZSh2YWx1ZSkKICAgICAgICAgICAgfSBlbHNlIHRoaXMuX3ZhbHVlID0gdmFsdWUKICAgICAgICB9CiAgICAgICAgR2V0QWJzb2x1dGVWYWx1ZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2FWYWx1ZQogICAgICAgIH0KICAgICAgICBTZXRBYnNvbHV0ZVZhbHVlKGFWYWx1ZSkgewogICAgICAgICAgICBpZiAodGhpcy5fdHlwZSA9PT0KICAgICAgICAgICAgICAgICJjb2xvciIgJiYgQzMuSXNGaW5pdGVOdW1iZXIoYVZhbHVlKSkgewogICAgICAgICAgICAgICAgdGhpcy5fYVZhbHVlWzBdID0gQzMuR2V0UlZhbHVlKGFWYWx1ZSk7CiAgICAgICAgICAgICAgICB0aGlzLl9hVmFsdWVbMV0gPSBDMy5HZXRHVmFsdWUoYVZhbHVlKTsKICAgICAgICAgICAgICAgIHRoaXMuX2FWYWx1ZVsyXSA9IEMzLkdldEJWYWx1ZShhVmFsdWUpCiAgICAgICAgICAgIH0gZWxzZSB0aGlzLl9hVmFsdWUgPSBhVmFsdWUKICAgICAgICB9CiAgICAgICAgR2V0VmFsdWVXaXRoUmVzdWx0TW9kZSgpIHsKICAgICAgICAgICAgY29uc3Qgcm0gPSB0aGlzLl9wcm9wZXJ0eUtleWZyYW1lRGF0YS5HZXRQcm9wZXJ0eVRyYWNrRGF0YUl0ZW0oKS5HZXRSZXN1bHRNb2RlKCk7CiAgICAgICAgICAgIGlmIChybSA9PT0gInJlbGF0aXZlIikgcmV0dXJuIHRoaXMuR2V0VmFsdWUoKTsKICAgICAgICAgICAgZWxzZSBpZiAocm0gPT09ICJhYnNvbHV0ZSIpIHJldHVybiB0aGlzLkdldEFic29sdXRlVmFsdWUoKQogICAgICAgIH0KICAgICAgICBHZXRUeXBlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fdHlwZQogICAgICAgIH0KICAgICAgICBTZXRUeXBlKHQpIHsKICAgICAgICAgICAgdGhpcy5fdHlwZSA9IHQKICAgICAgICB9CiAgICAgICAgR2V0VGltZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RpbWUKICAgICAgICB9CiAgICAgICAgU2V0VGltZSh0KSB7CiAgICAgICAgICAgIHRoaXMuX3RpbWUgPSB0OwogICAgICAgICAgICB0aGlzLl9wcm9wZXJ0eUtleWZyYW1lRGF0YS5fTGlua1Byb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbXMoKQogICAgICAgIH0KICAgICAgICBHZXRFYXNlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZWFzZQogICAgICAgIH0KICAgICAgICBTZXRFYXNlKGUpIHsKICAgICAgICAgICAgdGhpcy5fZWFzZSA9CiAgICAgICAgICAgICAgICBlCiAgICAgICAgfQogICAgICAgIEdldEVuYWJsZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2VuYWJsZQogICAgICAgIH0KICAgICAgICBTZXRFbmFibGUoZSkgewogICAgICAgICAgICB0aGlzLl9lbmFibGUgPSAhIWUKICAgICAgICB9CiAgICAgICAgR2V0UGF0aE1vZGUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9wYXRoTW9kZQogICAgICAgIH0KICAgICAgICBHZXRBZGRPbihpZCkgewogICAgICAgICAgICBpZiAoIXRoaXMuX2FkZG9uRGF0YSkgcmV0dXJuOwogICAgICAgICAgICBpZiAodGhpcy5fYWRkb25JbnN0YW5jZSB8fCB0aGlzLl9hZGRvbkluc3RhbmNlID09PSBudWxsKSByZXR1cm4gdGhpcy5fYWRkb25JbnN0YW5jZTsKICAgICAgICAgICAgY29uc3QgYWRkb25BcnJheSA9IHRoaXMuX2FkZG9uRGF0YS5HZXRBZGREYXRhSXRlbUFycmF5KCk7CiAgICAgICAgICAgIGlmICghYWRkb25BcnJheSkgewogICAgICAgICAgICAgICAgdGhpcy5fYWRkb25JbnN0YW5jZSA9IG51bGw7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fYWRkb25JbnN0YW5jZQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IGxlbiA9IGFkZG9uQXJyYXkubGVuZ3RoOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICAgICAgICBjb25zdCBhZGRvbiA9IGFkZG9uQXJyYXlbaV07CiAgICAgICAgICAgICAgICBpZiAoYWRkb24uR2V0SWQoKSA9PT0gaWQpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9hZGRvbkluc3RhbmNlID0gYWRkb247CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2FkZG9uSW5zdGFuY2UKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLl9hZGRvbkluc3RhbmNlID0KICAgICAgICAgICAgICAgIG51bGw7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9hZGRvbkluc3RhbmNlCiAgICAgICAgfQogICAgICAgIF9TYXZlVG9Kc29uKCkgewogICAgICAgICAgICBjb25zdCBhRGF0YSA9IHRoaXMuX2FkZG9uRGF0YTsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICJhZGRvbkRhdGFKc29uIjogYURhdGEgPyBhRGF0YS5fU2F2ZVRvSnNvbigpIDogYURhdGEsCiAgICAgICAgICAgICAgICAidmFsdWUiOiB0aGlzLl92YWx1ZSwKICAgICAgICAgICAgICAgICJhVmFsdWUiOiB0aGlzLl9hVmFsdWUsCiAgICAgICAgICAgICAgICAidHlwZSI6IHRoaXMuX3R5cGUsCiAgICAgICAgICAgICAgICAidGltZSI6IHRoaXMuX3RpbWUsCiAgICAgICAgICAgICAgICAiZWFzZSI6IHRoaXMuX2Vhc2UsCiAgICAgICAgICAgICAgICAiZW5hYmxlIjogdGhpcy5fZW5hYmxlCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgX0xvYWRGcm9tSnNvbihvKSB7CiAgICAgICAgICAgIGlmICghbykgcmV0dXJuOwogICAgICAgICAgICBpZiAob1siYWRkb25EYXRhSnNvbiJdKSB0aGlzLl9hZGRvbkRhdGEuX1NldEZyb21Kc29uKG9bImFkZG9uRGF0YUpzb24iXSk7CiAgICAgICAgICAgIHRoaXMuX3ZhbHVlID0gb1sidmFsdWUiXTsKICAgICAgICAgICAgdGhpcy5fYVZhbHVlID0gb1siYVZhbHVlIl07CiAgICAgICAgICAgIHRoaXMuX3R5cGUgPSBvWyJ0eXBlIl07CiAgICAgICAgICAgIHRoaXMuX3RpbWUgPSBvWyJ0aW1lIl07CiAgICAgICAgICAgIHRoaXMuX2Vhc2UgPSBvWyJlYXNlIl07CiAgICAgICAgICAgIHRoaXMuX2VuYWJsZSA9IG9bImVuYWJsZSJdCiAgICAgICAgfQogICAgfQogICAgQzMuUHJvcGVydHlLZXlmcmFtZURhdGEgPSBjbGFzcyBQcm9wZXJ0eUtleWZyYW1lRGF0YSB7CiAgICAgICAgY29uc3RydWN0b3IocHJvcGVydHlLZXlmcmFtZXNEYXRhSnNvbiwgcHJvcGVydHlUcmFja0RhdGFJdGVtKSB7CiAgICAgICAgICAgIHRoaXMuX3Byb3BlcnR5VHJhY2tEYXRhSXRlbSA9IHByb3BlcnR5VHJhY2tEYXRhSXRlbTsKICAgICAgICAgICAgdGhpcy5fcHJvcGVydHlLZXlmcmFtZURhdGFJdGVtcyA9IFtdOwogICAgICAgICAgICB0aGlzLl9wcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW1zSW5jbHVkaW5nRGlzYWJsZWQgPSBbXTsKICAgICAgICAgICAgQzMuVGltZWxpbmVEYXRhTWFuYWdlci5fQ3JlYXRlRGF0YUl0ZW1zKHRoaXMuX3Byb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbXMsIHByb3BlcnR5S2V5ZnJhbWVzRGF0YUpzb24sIFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbSwgdGhpcyk7CiAgICAgICAgICAgIEMzLlRpbWVsaW5lRGF0YU1hbmFnZXIuX0NyZWF0ZURhdGFJdGVtc0luY2x1ZGluZ0Rpc2FibGVkKHRoaXMuX3Byb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbXNJbmNsdWRpbmdEaXNhYmxlZCwgcHJvcGVydHlLZXlmcmFtZXNEYXRhSnNvbiwKICAgICAgICAgICAgICAgIFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbSwgdGhpcyk7CiAgICAgICAgICAgIHRoaXMuX0xpbmtQcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW1zKCkKICAgICAgICB9CiAgICAgICAgUmVsZWFzZSgpIHsKICAgICAgICAgICAgdGhpcy5fcHJvcGVydHlUcmFja0RhdGFJdGVtID0gbnVsbDsKICAgICAgICAgICAgZm9yIChjb25zdCBwcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW0gb2YgdGhpcy5fcHJvcGVydHlLZXlmcmFtZURhdGFJdGVtcykgcHJvcGVydHlLZXlmcmFtZURhdGFJdGVtLlJlbGVhc2UoKTsKICAgICAgICAgICAgQzMuY2xlYXJBcnJheSh0aGlzLl9wcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW1zKTsKICAgICAgICAgICAgdGhpcy5fcHJvcGVydHlLZXlmcmFtZURhdGFJdGVtcyA9IG51bGw7CiAgICAgICAgICAgIGZvciAoY29uc3QgcHJvcGVydHlLZXlmcmFtZURhdGFJdGVtIG9mIHRoaXMuX3Byb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbXNJbmNsdWRpbmdEaXNhYmxlZCkgcHJvcGVydHlLZXlmcmFtZURhdGFJdGVtLlJlbGVhc2UoKTsKICAgICAgICAgICAgQzMuY2xlYXJBcnJheSh0aGlzLl9wcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW1zSW5jbHVkaW5nRGlzYWJsZWQpOwogICAgICAgICAgICB0aGlzLl9wcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW1zSW5jbHVkaW5nRGlzYWJsZWQgPQogICAgICAgICAgICAgICAgbnVsbAogICAgICAgIH0KICAgICAgICBfTGlua1Byb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbXMoKSB7CiAgICAgICAgICAgIGxldCBkYXRhSXRlbXMgPSB0aGlzLl9wcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW1zOwogICAgICAgICAgICBkYXRhSXRlbXMuc29ydCgoZmlyc3QsIHNlY29uZCkgPT4gZmlyc3QuR2V0VGltZSgpIC0gc2Vjb25kLkdldFRpbWUoKSk7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGF0YUl0ZW1zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50ID0gZGF0YUl0ZW1zW2ldOwogICAgICAgICAgICAgICAgaWYgKGkgKyAxIDwgZGF0YUl0ZW1zLmxlbmd0aCkgY3VycmVudC5TZXROZXh0KGRhdGFJdGVtc1tpICsgMV0pOwogICAgICAgICAgICAgICAgaWYgKGkgLSAxID49IDApIGN1cnJlbnQuU2V0UHJldmlvdXMoZGF0YUl0ZW1zW2kgLSAxXSkKICAgICAgICAgICAgfQogICAgICAgICAgICBkYXRhSXRlbXMgPSB0aGlzLl9wcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW1zSW5jbHVkaW5nRGlzYWJsZWQ7CiAgICAgICAgICAgIGRhdGFJdGVtcy5zb3J0KChmaXJzdCwgc2Vjb25kKSA9PiBmaXJzdC5HZXRUaW1lKCkgLSBzZWNvbmQuR2V0VGltZSgpKTsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkYXRhSXRlbXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnQgPSBkYXRhSXRlbXNbaV07CiAgICAgICAgICAgICAgICBpZiAoaSArIDEgPCBkYXRhSXRlbXMubGVuZ3RoKSBjdXJyZW50LlNldE5leHQoZGF0YUl0ZW1zW2kgKyAxXSk7CiAgICAgICAgICAgICAgICBpZiAoaSAtIDEgPj0gMCkgY3VycmVudC5TZXRQcmV2aW91cyhkYXRhSXRlbXNbaSAtIDFdKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIEFkZEVtcHR5UHJvcGVydHlLZXlmcmFtZURhdGFJdGVtKCkgewogICAgICAgICAgICBjb25zdCBwcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW0gPSBuZXcgUHJvcGVydHlLZXlmcmFtZURhdGFJdGVtKG51bGwsIHRoaXMpOwogICAgICAgICAgICB0aGlzLl9wcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW1zLnB1c2gocHJvcGVydHlLZXlmcmFtZURhdGFJdGVtKTsKICAgICAgICAgICAgdGhpcy5fTGlua1Byb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbXMoKTsKICAgICAgICAgICAgcmV0dXJuIHByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbQogICAgICAgIH0KICAgICAgICBEZWxldGVQcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW1zKG1hdGNoKSB7CiAgICAgICAgICAgIGZvciAoY29uc3QgcHJvcGVydHlLZXlmcmFtZURhdGFJdGVtIG9mIHRoaXMuX3Byb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbXMpIHsKICAgICAgICAgICAgICAgIGlmICghbWF0Y2gocHJvcGVydHlLZXlmcmFtZURhdGFJdGVtKSkgY29udGludWU7CiAgICAgICAgICAgICAgICBjb25zdCBpbmRleCA9CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcHJvcGVydHlLZXlmcmFtZURhdGFJdGVtcy5pbmRleE9mKHByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbSk7CiAgICAgICAgICAgICAgICBpZiAoaW5kZXggPT09IC0xKSBjb250aW51ZTsKICAgICAgICAgICAgICAgIHByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbS5SZWxlYXNlKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9wcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW1zLnNwbGljZShpbmRleCwgMSkKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLlNvcnRQcm9wZXJ0eUtleUZyYW1lRGF0YUl0ZW1zKCk7CiAgICAgICAgICAgIHRoaXMuX0xpbmtQcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW1zKCkKICAgICAgICB9CiAgICAgICAgU29ydFByb3BlcnR5S2V5RnJhbWVEYXRhSXRlbXMoKSB7CiAgICAgICAgICAgIHRoaXMuX3Byb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbXMuc29ydCgoYSwgYikgPT4gYS5HZXRUaW1lKCkgLSBiLkdldFRpbWUoKSkKICAgICAgICB9CiAgICAgICAgR2V0UHJvcGVydHlUcmFja0RhdGFJdGVtKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fcHJvcGVydHlUcmFja0RhdGFJdGVtCiAgICAgICAgfQogICAgICAgIEdldFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbUNvdW50KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fcHJvcGVydHlLZXlmcmFtZURhdGFJdGVtcy5sZW5ndGgKICAgICAgICB9CiAgICAgICAgR2V0TGFzdFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3Byb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbXNbdGhpcy5fcHJvcGVydHlLZXlmcmFtZURhdGFJdGVtcy5sZW5ndGggLQogICAgICAgICAgICAgICAgMV0KICAgICAgICB9CiAgICAgICAgR2V0UHJvcGVydHlLZXlmcmFtZURhdGFJdGVtQXJyYXkoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9wcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW1zCiAgICAgICAgfQogICAgICAgIEdldFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbUFycmF5SW5jbHVkaW5nRGlzYWJsZWQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9wcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW1zSW5jbHVkaW5nRGlzYWJsZWQKICAgICAgICB9KiBwcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW1zKCkgewogICAgICAgICAgICBmb3IgKGNvbnN0IHByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbSBvZiB0aGlzLl9wcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW1zKSB5aWVsZCBwcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW0KICAgICAgICB9KiBwcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW1zUmV2ZXJzZSgpIHsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IHRoaXMuX3Byb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbXMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHlpZWxkIHRoaXMuX3Byb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbXNbaV0KICAgICAgICB9CiAgICAgICAgX1NhdmVUb0pzb24oKSB7CiAgICAgICAgICAgIGNvbnN0IHByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbXMgPSB0aGlzLl9wcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW1zOwogICAgICAgICAgICBjb25zdCBwcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW1zSW5jbHVkaW5nRGlzYWJsZWQgPSB0aGlzLl9wcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW1zSW5jbHVkaW5nRGlzYWJsZWQ7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAicHJvcGVydHlLZXlmcmFtZURhdGFJdGVtc0pzb24iOiBwcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW1zLm1hcChwcm9wZXJ0eVRyYWNrRGF0YUl0ZW0gPT4gewogICAgICAgICAgICAgICAgICAgIHJldHVybiBwcm9wZXJ0eVRyYWNrRGF0YUl0ZW0uX1NhdmVUb0pzb24oKQogICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAicHJvcGVydHlLZXlmcmFtZURhdGFJdGVtc0luY2x1ZGluZ0Rpc2FibGVkSnNvbiI6IHByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbXNJbmNsdWRpbmdEaXNhYmxlZC5tYXAocHJvcGVydHlUcmFja0RhdGFJdGVtID0+IHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcHJvcGVydHlUcmFja0RhdGFJdGVtLl9TYXZlVG9Kc29uKCkKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgX0xvYWRGcm9tSnNvbihvKSB7CiAgICAgICAgICAgIGlmICghbykgcmV0dXJuOwogICAgICAgICAgICBDMy5UaW1lbGluZURhdGFNYW5hZ2VyLl9Mb2FkRGF0YUl0ZW1zRnJvbUpzb24odGhpcy5fcHJvcGVydHlLZXlmcmFtZURhdGFJdGVtcywKICAgICAgICAgICAgICAgIG9bInByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbXNKc29uIl0sIFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbSwgdGhpcyk7CiAgICAgICAgICAgIEMzLlRpbWVsaW5lRGF0YU1hbmFnZXIuX0xvYWREYXRhSXRlbXNGcm9tSnNvbih0aGlzLl9wcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW1zSW5jbHVkaW5nRGlzYWJsZWQsIG9bInByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbXNJbmNsdWRpbmdEaXNhYmxlZEpzb24iXSwgUHJvcGVydHlLZXlmcmFtZURhdGFJdGVtLCB0aGlzKTsKICAgICAgICAgICAgdGhpcy5fTGlua1Byb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbXMoKQogICAgICAgIH0KICAgIH07Cgp9CgovLyB0aW1lbGluZXMvZGF0YS9wcm9wZXJ0eUtleWZyYW1lQWRkb25EYXRhLmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIGNvbnN0IEFERE9OX0lEID0gMDsKICAgIGNvbnN0IEFERE9OX0RBVEEgPSAxOwogICAgY2xhc3MgQWRkb25EYXRhSXRlbSB7CiAgICAgICAgY29uc3RydWN0b3IoYWRkb25EYXRhSnNvbiwgYWRkb25EYXRhKSB7CiAgICAgICAgICAgIHRoaXMuX2FkZG9uRGF0YSA9IGFkZG9uRGF0YTsKICAgICAgICAgICAgdGhpcy5faWQgPSBhZGRvbkRhdGFKc29uW0FERE9OX0lEXTsKICAgICAgICAgICAgdGhpcy5fZGF0YSA9IGFkZG9uRGF0YUpzb25bQURET05fREFUQV0KICAgICAgICB9CiAgICAgICAgUmVsZWFzZSgpIHsKICAgICAgICAgICAgdGhpcy5fYWRkb25EYXRhID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fZGF0YSA9IG51bGwKICAgICAgICB9CiAgICAgICAgR2V0QWRkb25EYXRhKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fYWRkb25EYXRhCiAgICAgICAgfQogICAgICAgIEdldElkKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faWQKICAgICAgICB9CiAgICAgICAgX1NhdmVUb0pzb24oKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAiaWQiOiB0aGlzLl9pZCwKICAgICAgICAgICAgICAgICJkYXRhIjogdGhpcy5fZGF0YQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIF9Mb2FkRnJvbUpzb24obykgewogICAgICAgICAgICBpZiAoIW8pIHJldHVybjsKICAgICAgICAgICAgdGhpcy5faWQgPSBvWyJpZCJdOwogICAgICAgICAgICB0aGlzLl9kYXRhID0gb1siZGF0YSJdCiAgICAgICAgfQogICAgfQogICAgY29uc3QgU1RBUlRfQU5DSE9SID0gMDsKICAgIGNvbnN0IFNUQVJUX0VOQUJMRSA9IDE7CiAgICBjb25zdCBFTkRfQU5DSE9SID0gMjsKICAgIGNvbnN0IEVORF9FTkFCTEUgPSAzOwogICAgY2xhc3MgQWRkb25EYXRhQ3ViaWNCZXppZXJJdGVtIGV4dGVuZHMgQWRkb25EYXRhSXRlbSB7CiAgICAgICAgY29uc3RydWN0b3IoYWRkb25EYXRhSnNvbiwgYWRkb25EYXRhKSB7CiAgICAgICAgICAgIHN1cGVyKGFkZG9uRGF0YUpzb24sIGFkZG9uRGF0YSk7CiAgICAgICAgICAgIHRoaXMuX3N0YXJ0QW5jaG9yID0gdGhpcy5fZGF0YVtTVEFSVF9BTkNIT1JdOwogICAgICAgICAgICB0aGlzLl9zdGFydEVuYWJsZSA9ICEhdGhpcy5fZGF0YVtTVEFSVF9FTkFCTEVdOwogICAgICAgICAgICB0aGlzLl9lbmRBbmNob3IgPSB0aGlzLl9kYXRhW0VORF9BTkNIT1JdOwogICAgICAgICAgICB0aGlzLl9lbmRFbmFibGUgPSAhIXRoaXMuX2RhdGFbRU5EX0VOQUJMRV0KICAgICAgICB9CiAgICAgICAgUmVsZWFzZSgpIHsKICAgICAgICAgICAgc3VwZXIuUmVsZWFzZSgpCiAgICAgICAgfQogICAgICAgIEdldFN0YXJ0QW5jaG9yKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fc3RhcnRBbmNob3IKICAgICAgICB9CiAgICAgICAgR2V0U3RhcnRFbmFibGUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zdGFydEVuYWJsZQogICAgICAgIH0KICAgICAgICBHZXRFbmRBbmNob3IoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9lbmRBbmNob3IKICAgICAgICB9CiAgICAgICAgR2V0RW5kRW5hYmxlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZW5kRW5hYmxlCiAgICAgICAgfQogICAgICAgIF9TYXZlVG9Kc29uKCkgewogICAgICAgICAgICByZXR1cm4gT2JqZWN0LmFzc2lnbihzdXBlci5fU2F2ZVRvSnNvbigpLCB7CiAgICAgICAgICAgICAgICAic3RhcnRBbmNob3IiOiB0aGlzLl9zdGFydEFuY2hvciwKICAgICAgICAgICAgICAgICJzdGFydEVuYWJsZSI6ICEhdGhpcy5fc3RhcnRFbmFibGUsCiAgICAgICAgICAgICAgICAiZW5kQW5jaG9yIjogdGhpcy5fZW5kQW5jaG9yLAogICAgICAgICAgICAgICAgImVuZEVuYWJsZSI6ICEhdGhpcy5fZW5kRW5hYmxlCiAgICAgICAgICAgIH0pCiAgICAgICAgfQogICAgICAgIF9Mb2FkRnJvbUpzb24obykgewogICAgICAgICAgICBpZiAoIW8pIHJldHVybjsKICAgICAgICAgICAgc3VwZXIuX0xvYWRGcm9tSnNvbihvKTsKICAgICAgICAgICAgdGhpcy5fc3RhcnRBbmNob3IgPSBvWyJzdGFydEFuY2hvciJdOwogICAgICAgICAgICB0aGlzLl9zdGFydEVuYWJsZSA9ICEhb1sic3RhcnRFbmFibGUiXTsKICAgICAgICAgICAgdGhpcy5fZW5kQW5jaG9yID0gb1siZW5kQW5jaG9yIl07CiAgICAgICAgICAgIHRoaXMuX2VuZEVuYWJsZSA9ICEhb1siZW5kRW5hYmxlIl0KICAgICAgICB9CiAgICB9CiAgICBjb25zdCBESVJFQ1RJT04gPSAwOwogICAgY29uc3QgUkVWT0xVVElPTlMgPSAxOwogICAgY2xhc3MgQWRkb25EYXRhQW5nbGVJdGVtIGV4dGVuZHMgQWRkb25EYXRhSXRlbSB7CiAgICAgICAgY29uc3RydWN0b3IoYWRkb25EYXRhSnNvbiwgYWRkb25EYXRhKSB7CiAgICAgICAgICAgIHN1cGVyKGFkZG9uRGF0YUpzb24sIGFkZG9uRGF0YSk7CiAgICAgICAgICAgIHRoaXMuX2RpcmVjdGlvbiA9IHRoaXMuX2RhdGFbRElSRUNUSU9OXTsKICAgICAgICAgICAgdGhpcy5fcmV2b2x1dGlvbnMgPSB0aGlzLl9kYXRhW1JFVk9MVVRJT05TXQogICAgICAgIH0KICAgICAgICBSZWxlYXNlKCkgewogICAgICAgICAgICBzdXBlci5SZWxlYXNlKCkKICAgICAgICB9CiAgICAgICAgR2V0RGlyZWN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZGlyZWN0aW9uCiAgICAgICAgfQogICAgICAgIEdldFJldm9sdXRpb25zKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fcmV2b2x1dGlvbnMKICAgICAgICB9CiAgICAgICAgX1NhdmVUb0pzb24oKSB7CiAgICAgICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKHN1cGVyLl9TYXZlVG9Kc29uKCksIHsKICAgICAgICAgICAgICAgICJkaXJlY3Rpb24iOiB0aGlzLl9kaXJlY3Rpb24sCiAgICAgICAgICAgICAgICAicmV2b2x1dGlvbnMiOiB0aGlzLl9yZXZvbHV0aW9ucwogICAgICAgICAgICB9KQogICAgICAgIH0KICAgICAgICBfTG9hZEZyb21Kc29uKG8pIHsKICAgICAgICAgICAgaWYgKCFvKSByZXR1cm47CiAgICAgICAgICAgIHN1cGVyLl9Mb2FkRnJvbUpzb24obyk7CiAgICAgICAgICAgIHRoaXMuX2RpcmVjdGlvbiA9IG9bImRpcmVjdGlvbiJdOwogICAgICAgICAgICB0aGlzLl9yZXZvbHV0aW9ucyA9IG9bInJldm9sdXRpb25zIl0KICAgICAgICB9CiAgICB9CiAgICBDMy5BZGRvbkRhdGEgPSBjbGFzcyBBZGRvbkRhdGEgewogICAgICAgIGNvbnN0cnVjdG9yKGFkZG9uc0RhdGFKc29uLCBwcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW0pIHsKICAgICAgICAgICAgdGhpcy5fcHJvcGVydHlLZXlmcmFtZURhdGFJdGVtID0gcHJvcGVydHlLZXlmcmFtZURhdGFJdGVtOwogICAgICAgICAgICB0aGlzLl9hZGRvbkRhdGFJdGVtcyA9IFtdOwogICAgICAgICAgICBDMy5UaW1lbGluZURhdGFNYW5hZ2VyLl9DcmVhdGVEYXRhSXRlbXModGhpcy5fYWRkb25EYXRhSXRlbXMsIGFkZG9uc0RhdGFKc29uLCB7CiAgICAgICAgICAgICAgICBwcm9wOiAwLAogICAgICAgICAgICAgICAgbWFwOiBuZXcgTWFwKFsKICAgICAgICAgICAgICAgICAgICBbImN1YmljLWJlemllciIsIEFkZG9uRGF0YUN1YmljQmV6aWVySXRlbV0sCiAgICAgICAgICAgICAgICAgICAgWyJhbmdsZSIsIEFkZG9uRGF0YUFuZ2xlSXRlbV0KICAgICAgICAgICAgICAgIF0pCiAgICAgICAgICAgIH0sIHRoaXMpCiAgICAgICAgfQogICAgICAgIFJlbGVhc2UoKSB7CiAgICAgICAgICAgIHRoaXMuX3Byb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbSA9IG51bGw7CiAgICAgICAgICAgIGZvciAoY29uc3QgYWRkb25EYXRhSXRlbSBvZiB0aGlzLl9hZGRvbkRhdGFJdGVtcykgYWRkb25EYXRhSXRlbS5SZWxlYXNlKCk7CiAgICAgICAgICAgIEMzLmNsZWFyQXJyYXkodGhpcy5fYWRkb25EYXRhSXRlbXMpOwogICAgICAgICAgICB0aGlzLl9hZGRvbkRhdGFJdGVtcyA9CiAgICAgICAgICAgICAgICBudWxsCiAgICAgICAgfQogICAgICAgIEdldFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3Byb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbQogICAgICAgIH0KICAgICAgICBHZXRBZGREYXRhSXRlbUFycmF5KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fYWRkb25EYXRhSXRlbXMKICAgICAgICB9KiBhZGRvbkRhdGFJdGVtcygpIHsKICAgICAgICAgICAgZm9yIChjb25zdCBhZGRvbkRhdGFJdGVtIG9mIHRoaXMuX2FkZG9uRGF0YUl0ZW1zKSB5aWVsZCBhZGRvbkRhdGFJdGVtCiAgICAgICAgfQogICAgICAgIF9TYXZlVG9Kc29uKCkgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgImFkZG9uRGF0YUl0ZW1zSnNvbiI6IHRoaXMuX2FkZG9uRGF0YUl0ZW1zLm1hcChhZGRvbkRhdGFJdGVtID0+IGFkZG9uRGF0YUl0ZW0uX1NhdmVUb0pzb24oKSkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBfTG9hZEZyb21Kc29uKG8pIHsKICAgICAgICAgICAgaWYgKCFvKSByZXR1cm47CiAgICAgICAgICAgIEMzLlRpbWVsaW5lRGF0YU1hbmFnZXIuX0xvYWREYXRhSXRlbXNGcm9tSnNvbih0aGlzLl9hZGRvbkRhdGFJdGVtcywgb1siYWRkb25EYXRhSXRlbXNKc29uIl0sIHsKICAgICAgICAgICAgICAgIHByb3A6ICJpZCIsCiAgICAgICAgICAgICAgICBtYXA6IG5ldyBNYXAoWwogICAgICAgICAgICAgICAgICAgIFsiY3ViaWMtYmV6aWVyIiwgQWRkb25EYXRhQ3ViaWNCZXppZXJJdGVtXSwKICAgICAgICAgICAgICAgICAgICBbImFuZ2xlIiwgQWRkb25EYXRhQW5nbGVJdGVtXQogICAgICAgICAgICAgICAgXSkKICAgICAgICAgICAgfSwgdGhpcykKICAgICAgICB9CiAgICB9OwoKfQoKLy8gdGltZWxpbmVzL3R3ZWVucy90d2VlblN0YXRlLmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIGNvbnN0IElOSVRJQUxfVkFMVUVfTU9ERV9TVEFSVF9WQUxVRSA9ICJzdGFydC12YWx1ZSI7CiAgICBjb25zdCBJTklUSUFMX1ZBTFVFX01PREVfQ1VSUkVOVF9TVEFURSA9ICJjdXJyZW50LXN0YXRlIjsKICAgIGNvbnN0IFBJTkdfUE9OR19CRUdJTiA9IDA7CiAgICBjb25zdCBQSU5HX1BPTkdfRU5EID0gMTsKICAgIGxldCBjcmVhdGVkVHdlZW5zID0gMDsKICAgIEMzLlR3ZWVuU3RhdGUgPSBjbGFzcyBUd2VlbiBleHRlbmRzIEMzLlRpbWVsaW5lU3RhdGUgewogICAgICAgIGNvbnN0cnVjdG9yKHR3ZWVuRGF0YUl0ZW0sIHRpbWVsaW5lTWFuYWdlcikgewogICAgICAgICAgICBzdXBlcihgdHdlZW4tJHtjcmVhdGVkVHdlZW5zKyt9YCwgdHdlZW5EYXRhSXRlbSwgdGltZWxpbmVNYW5hZ2VyKTsKICAgICAgICAgICAgdGhpcy5faWQgPSAiIjsKICAgICAgICAgICAgdGhpcy5fZGVzdHJveUluc3RhbmNlT25Db21wbGV0ZSA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl9pbml0aWFsVmFsdWVNb2RlID0gSU5JVElBTF9WQUxVRV9NT0RFX1NUQVJUX1ZBTFVFOwogICAgICAgICAgICB0aGlzLl9pbnN0YW5jZSA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX29uX2NvbXBsZXRlZF9jYWxsYmFja3MgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9vbl9zdGFydGVkX2NhbGxiYWNrcyA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3RyYWNrID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5faVR3ZWVuU3RhdGUgPSBudWxsCiAgICAgICAgfQogICAgICAgIEZpcmVSZWxlYXNlRXZlbnQoZGlzcGF0Y2hlcikgewogICAgICAgICAgICBjb25zdCBldmVudCA9IEMzLk5ldyhDMy5FdmVudCwgInR3ZWVuc3RhdGVyZWxlYXNlZCIpOwogICAgICAgICAgICBldmVudC50d2VlblN0YXRlID0gdGhpczsKICAgICAgICAgICAgZGlzcGF0Y2hlci5kaXNwYXRjaEV2ZW50KGV2ZW50KQogICAgICAgIH0KICAgICAgICBHZXRUeXBlKCkgewogICAgICAgICAgICByZXR1cm4gMQogICAgICAgIH0KICAgICAgICBDcmVhdGVUcmFja1N0YXRlcygpIHsKICAgICAgICAgICAgZm9yIChjb25zdCB0cmFja0RhdGFJdGVtIG9mIHRoaXMuX3RpbWVsaW5lRGF0YUl0ZW0uR2V0VHJhY2tEYXRhKCkudHJhY2tEYXRhSXRlbXMoKSkgdGhpcy5fdHJhY2tzLnB1c2goQzMuVHdlZW5UcmFja1N0YXRlLkNyZWF0ZSh0aGlzLAogICAgICAgICAgICAgICAgdHJhY2tEYXRhSXRlbSkpOwogICAgICAgICAgICB0aGlzLl90cmFjayA9IHRoaXMuX3RyYWNrc1swXQogICAgICAgIH0KICAgICAgICBBZGRUcmFjaygpIHsKICAgICAgICAgICAgY29uc3QgdHJhY2tEYXRhSXRlbSA9IHRoaXMuX3RpbWVsaW5lRGF0YUl0ZW0uR2V0VHJhY2tEYXRhKCkuQWRkRW1wdHlUcmFja0RhdGFJdGVtKCk7CiAgICAgICAgICAgIGNvbnN0IHRyYWNrID0gQzMuVHdlZW5UcmFja1N0YXRlLkNyZWF0ZSh0aGlzLCB0cmFja0RhdGFJdGVtKTsKICAgICAgICAgICAgdGhpcy5fdHJhY2tzLnB1c2godHJhY2spOwogICAgICAgICAgICB0aGlzLl90cmFjayA9IHRoaXMuX3RyYWNrc1swXTsKICAgICAgICAgICAgcmV0dXJuIHRyYWNrCiAgICAgICAgfQogICAgICAgIEdldFByb3BlcnR5VHJhY2socHJvcGVydHlOYW1lKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl90cmFjay5HZXRQcm9wZXJ0eVRyYWNrcygpWzBdCiAgICAgICAgfQogICAgICAgIFNldFByb3BlcnR5VHlwZSh0eXBlKSB7CiAgICAgICAgICAgIHRoaXMuX3Byb3BlcnR5VHlwZSA9IHR5cGUKICAgICAgICB9CiAgICAgICAgR2V0SW5zdGFuY2UoKSB7CiAgICAgICAgICAgIGNvbnN0IHRyYWNrcyA9IHRoaXMuR2V0VHJhY2tzKCk7CiAgICAgICAgICAgIGlmICghdHJhY2tzIHx8ICF0cmFja3MubGVuZ3RoKSByZXR1cm47CiAgICAgICAgICAgIGNvbnN0IHRyYWNrID0gdHJhY2tzWzBdOwogICAgICAgICAgICB0aGlzLl90cmFjayA9IHRyYWNrOwogICAgICAgICAgICBpZiAoIXRyYWNrKSByZXR1cm47CiAgICAgICAgICAgIGNvbnN0IGluc3RhbmNlID0gdHJhY2suR2V0SW5zdGFuY2UoKTsKICAgICAgICAgICAgcmV0dXJuIHRyYWNrLklzSW5zdGFuY2VWYWxpZCgpID8gaW5zdGFuY2UgOiB1bmRlZmluZWQKICAgICAgICB9CiAgICAgICAgQWRkU3RhcnRlZENhbGxiYWNrKGMpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLl9vbl9zdGFydGVkX2NhbGxiYWNrcykgdGhpcy5fb25fc3RhcnRlZF9jYWxsYmFja3MgPSBbXTsKICAgICAgICAgICAgdGhpcy5fb25fc3RhcnRlZF9jYWxsYmFja3MucHVzaChjKQogICAgICAgIH0KICAgICAgICBBZGRDb21wbGV0ZWRDYWxsYmFjayhjKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5fb25fY29tcGxldGVkX2NhbGxiYWNrcykgdGhpcy5fb25fY29tcGxldGVkX2NhbGxiYWNrcyA9IFtdOwogICAgICAgICAgICB0aGlzLl9vbl9jb21wbGV0ZWRfY2FsbGJhY2tzLnB1c2goYykKICAgICAgICB9CiAgICAgICAgUmVtb3ZlU3RhcnRlZENhbGxiYWNrKGMpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLl9vbl9zdGFydGVkX2NhbGxiYWNrcykgcmV0dXJuOwogICAgICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMuX29uX3N0YXJ0ZWRfY2FsbGJhY2tzLmluZGV4T2YoYyk7CiAgICAgICAgICAgIGlmIChpbmRleCAhPT0gLTEpIHRoaXMuX29uX3N0YXJ0ZWRfY2FsbGJhY2tzLnNwbGljZShpbmRleCwgMSkKICAgICAgICB9CiAgICAgICAgUmVtb3ZlQ29tcGxldGVkQ2FsbGJhY2soYykgewogICAgICAgICAgICBpZiAoIXRoaXMuX29uX2NvbXBsZXRlZF9jYWxsYmFja3MpIHJldHVybjsKICAgICAgICAgICAgY29uc3QgaW5kZXggPSB0aGlzLl9vbl9jb21wbGV0ZWRfY2FsbGJhY2tzLmluZGV4T2YoYyk7CiAgICAgICAgICAgIGlmIChpbmRleCAhPT0gLTEpIHRoaXMuX29uX2NvbXBsZXRlZF9jYWxsYmFja3Muc3BsaWNlKGluZGV4LCAxKQogICAgICAgIH0KICAgICAgICBTZXRTdGFydFZhbHVlKHN0YXJ0VmFsdWUsIHByb3BlcnR5TmFtZSkgewogICAgICAgICAgICBmb3IgKGNvbnN0IHRyYWNrIG9mIHRoaXMuX3RyYWNrcykKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgcHJvcGVydHlUcmFjayBvZiB0cmFjay5fcHJvcGVydHlUcmFja3MpIHsKICAgICAgICAgICAgICAgICAgICBpZiAocHJvcGVydHlUcmFjay5HZXRQcm9wZXJ0eU5hbWUoKSAhPT0gcHJvcGVydHlOYW1lKSBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBwcm9wZXJ0eVRyYWNrRGF0YSA9IHByb3BlcnR5VHJhY2suR2V0UHJvcGVydHlUcmFja0RhdGEoKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBwcm9wZXJ0eVRyYWNrRGF0YUl0ZW0gPSBwcm9wZXJ0eVRyYWNrLkdldFByb3BlcnR5VHJhY2tEYXRhSXRlbSgpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbSA9IHByb3BlcnR5VHJhY2tEYXRhLkdldEZpcnN0UHJvcGVydHlLZXlmcmFtZURhdGFJdGVtKHByb3BlcnR5VHJhY2tEYXRhSXRlbSk7CiAgICAgICAgICAgICAgICAgICAgcHJvcGVydHlLZXlmcmFtZURhdGFJdGVtLlNldFZhbHVlKHN0YXJ0VmFsdWUpOwogICAgICAgICAgICAgICAgICAgIHByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbS5TZXRBYnNvbHV0ZVZhbHVlKHN0YXJ0VmFsdWUpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIF9HZXRQcm9wZXJ0eVRyYWNrU3RhdGUocHJvcGVydHlOYW1lKSB7CiAgICAgICAgICAgIGZvciAoY29uc3QgdHJhY2sgb2YgdGhpcy5fdHJhY2tzKQogICAgICAgICAgICAgICAgZm9yIChjb25zdCBwcm9wZXJ0eVRyYWNrIG9mIHRyYWNrLl9wcm9wZXJ0eVRyYWNrcykKICAgICAgICAgICAgICAgICAgICBpZiAocHJvcGVydHlUcmFjay5HZXRQcm9wZXJ0eU5hbWUoKSA9PT0gcHJvcGVydHlOYW1lKSByZXR1cm4gcHJvcGVydHlUcmFjawogICAgICAgIH0KICAgICAgICBCZWZvcmVTZXRFbmRWYWx1ZXMocHJvcGVydGllcykgewogICAgICAgICAgICBmb3IgKGNvbnN0IHByb3BlcnR5TmFtZSBvZiBwcm9wZXJ0aWVzKSB7CiAgICAgICAgICAgICAgICBjb25zdCBwcm9wZXJ0eVRyYWNrU3RhdGUgPSB0aGlzLl9HZXRQcm9wZXJ0eVRyYWNrU3RhdGUocHJvcGVydHlOYW1lKTsKICAgICAgICAgICAgICAgIHRoaXMuU2V0U3RhcnRWYWx1ZShwcm9wZXJ0eVRyYWNrU3RhdGUuR2V0Q3VycmVudFN0YXRlKCksIHByb3BlcnR5TmFtZSkKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGhpcy5Jc0ZvcndhcmRQbGF5QmFjaygpKSB7CiAgICAgICAgICAgICAgICBjb25zdCBuZXdUb3RhbFRpbWUgPQogICAgICAgICAgICAgICAgICAgIHRoaXMuR2V0VG90YWxUaW1lKCkgLSB0aGlzLkdldFRpbWUoKTsKICAgICAgICAgICAgICAgIHRoaXMuU2V0VG90YWxUaW1lKG5ld1RvdGFsVGltZSk7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHRyYWNrIG9mIHRoaXMuX3RyYWNrcykgdHJhY2suU2V0TG9jYWxUb3RhbFRpbWUobmV3VG90YWxUaW1lKTsKICAgICAgICAgICAgICAgIHRoaXMuX1NldFRpbWUoMCkKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbnN0IG5ld1RvdGFsVGltZSA9IHRoaXMuR2V0VGltZSgpOwogICAgICAgICAgICAgICAgdGhpcy5TZXRUb3RhbFRpbWUobmV3VG90YWxUaW1lKTsKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgdHJhY2sgb2YgdGhpcy5fdHJhY2tzKSB0cmFjay5TZXRMb2NhbFRvdGFsVGltZShuZXdUb3RhbFRpbWUpOwogICAgICAgICAgICAgICAgdGhpcy5fU2V0VGltZShuZXdUb3RhbFRpbWUpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5TZXRJbml0aWFsU3RhdGVGcm9tU2V0VGltZSgpCiAgICAgICAgfQogICAgICAgIFNldEVuZFZhbHVlKGVuZFZhbHVlLCBwcm9wZXJ0eU5hbWUpIHsKICAgICAgICAgICAgY29uc3QgcHJvcGVydHlUcmFja1N0YXRlID0gdGhpcy5fR2V0UHJvcGVydHlUcmFja1N0YXRlKHByb3BlcnR5TmFtZSk7CiAgICAgICAgICAgIGNvbnN0IHByb3BlcnR5VHJhY2tEYXRhID0gcHJvcGVydHlUcmFja1N0YXRlLkdldFByb3BlcnR5VHJhY2tEYXRhKCk7CiAgICAgICAgICAgIGNvbnN0IHByb3BlcnR5VHJhY2tEYXRhSXRlbSA9IHByb3BlcnR5VHJhY2tTdGF0ZS5HZXRQcm9wZXJ0eVRyYWNrRGF0YUl0ZW0oKTsKICAgICAgICAgICAgY29uc3QgcHJvcGVydHlLZXlmcmFtZURhdGFJdGVtID0gcHJvcGVydHlUcmFja0RhdGEuR2V0TGFzdFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbShwcm9wZXJ0eVRyYWNrRGF0YUl0ZW0pOwogICAgICAgICAgICBwcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW0uU2V0VGltZSh0aGlzLkdldFRvdGFsVGltZSgpKTsKICAgICAgICAgICAgcHJvcGVydHlLZXlmcmFtZURhdGFJdGVtLlNldFZhbHVlKGVuZFZhbHVlKTsKICAgICAgICAgICAgcHJvcGVydHlLZXlmcmFtZURhdGFJdGVtLlNldEFic29sdXRlVmFsdWUoZW5kVmFsdWUpCiAgICAgICAgfQogICAgICAgIFNldElkKGlkKSB7CiAgICAgICAgICAgIHRoaXMuX2lkID0gaWQKICAgICAgICB9CiAgICAgICAgR2V0SWQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pZAogICAgICAgIH0KICAgICAgICBTZXRJbml0aWFsVmFsdWVNb2RlKGluaXRpYWxWYWx1ZU1vZGUpIHsKICAgICAgICAgICAgdGhpcy5faW5pdGlhbFZhbHVlTW9kZSA9IGluaXRpYWxWYWx1ZU1vZGUKICAgICAgICB9CiAgICAgICAgR2V0SW5pdGlhbFZhbHVlTW9kZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2luaXRpYWxWYWx1ZU1vZGUKICAgICAgICB9CiAgICAgICAgU2V0RGVzdHJveUluc3RhbmNlT25Db21wbGV0ZShyZWxlYXNlT25Db21wbGV0ZSkgewogICAgICAgICAgICB0aGlzLl9kZXN0cm95SW5zdGFuY2VPbkNvbXBsZXRlID0KICAgICAgICAgICAgICAgIHJlbGVhc2VPbkNvbXBsZXRlCiAgICAgICAgfQogICAgICAgIEdldERlc3Ryb3lJbnN0YW5jZU9uQ29tcGxldGUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9kZXN0cm95SW5zdGFuY2VPbkNvbXBsZXRlCiAgICAgICAgfQogICAgICAgIE9uU3RhcnRlZCgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX29uX3N0YXJ0ZWRfY2FsbGJhY2tzKQogICAgICAgICAgICAgICAgZm9yIChjb25zdCBjIG9mIHRoaXMuX29uX3N0YXJ0ZWRfY2FsbGJhY2tzKSBjKHRoaXMpOwogICAgICAgICAgICBpZiAodGhpcy5Jc0NvbXBsZXRlKCkpIHJldHVybjsKICAgICAgICAgICAgZm9yIChjb25zdCB0cmFjayBvZiB0aGlzLl90cmFja3MpIHRyYWNrLkNvbXBhcmVTYXZlU3RhdGVXaXRoQ3VycmVudCgpCiAgICAgICAgfQogICAgICAgIE9uQ29tcGxldGVkKCkgewogICAgICAgICAgICB0aGlzLl9jb21wbGV0ZWRUaWNrID0gdGhpcy5fcnVudGltZS5HZXRUaWNrQ291bnQoKQogICAgICAgIH0KICAgICAgICBGaW5pc2hUcmlnZ2VycygpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX2ZpbmlzaGVkVHJpZ2dlcnMpIHJldHVybjsKICAgICAgICAgICAgdGhpcy5fZmluaXNoZWRUcmlnZ2VycyA9IHRydWU7CiAgICAgICAgICAgIGlmICh0aGlzLl9vbl9jb21wbGV0ZWRfY2FsbGJhY2tzKQogICAgICAgICAgICAgICAgZm9yIChjb25zdCBjIG9mIHRoaXMuX29uX2NvbXBsZXRlZF9jYWxsYmFja3MpIGModGhpcykKICAgICAgICB9CiAgICAgICAgU2V0VGltZSh0aW1lKSB7CiAgICAgICAgICAgIHRoaXMuX0RlbGV0ZUludGVybWVkaWF0ZUtleWZyYW1lcygpOwogICAgICAgICAgICBzdXBlci5TZXRUaW1lKHRpbWUpCiAgICAgICAgfQogICAgICAgIF9TZXRUaW1lQW5kUmVzZXQodGltZSkgewogICAgICAgICAgICBpZiAoIUMzLklzRmluaXRlTnVtYmVyKHRpbWUpKSB0aW1lID0gdGhpcy5HZXRUb3RhbFRpbWUoKTsKICAgICAgICAgICAgaWYgKHRpbWUgPCAwKSB0aGlzLl9wbGF5aGVhZFRpbWUgPSAwOwogICAgICAgICAgICBlbHNlIGlmICh0aW1lID49IHRoaXMuR2V0VG90YWxUaW1lKCkpIHRoaXMuX3BsYXloZWFkVGltZSA9IHRoaXMuR2V0VG90YWxUaW1lKCk7CiAgICAgICAgICAgIGVsc2UgdGhpcy5fcGxheWhlYWRUaW1lID0gdGltZTsKICAgICAgICAgICAgdGhpcy5fdHJhY2suU2V0UmVzZXRTdGF0ZSgpCiAgICAgICAgfQogICAgICAgIFNldEluaXRpYWxTdGF0ZShmcm9tU2V0VGltZSkgewogICAgICAgICAgICBpZiAoIXRoaXMuSW5pdGlhbFN0YXRlU2V0KCkgJiYgdGhpcy5HZXRJbml0aWFsVmFsdWVNb2RlKCkgPT09IElOSVRJQUxfVkFMVUVfTU9ERV9DVVJSRU5UX1NUQVRFKQogICAgICAgICAgICAgICAgZm9yIChjb25zdCB0cmFjayBvZiB0aGlzLl90cmFja3MpIHRyYWNrLkNvbXBhcmVJbml0aWFsU3RhdGVXaXRoQ3VycmVudCgpOwogICAgICAgICAgICBzdXBlci5TZXRJbml0aWFsU3RhdGUoZnJvbVNldFRpbWUpCiAgICAgICAgfQogICAgICAgIFN0b3AoY29tcGxldGVkID0gZmFsc2UpIHsKICAgICAgICAgICAgc3VwZXIuU3RvcChjb21wbGV0ZWQpOwogICAgICAgICAgICBpZiAodGhpcy5Jc0NvbXBsZXRlKCkpIHJldHVybjsKICAgICAgICAgICAgZm9yIChjb25zdCB0cmFjayBvZiB0aGlzLl90cmFja3MpIHRyYWNrLlNhdmVTdGF0ZSgpCiAgICAgICAgfQogICAgICAgIFJlc2V0KHJlbmRlciA9IHRydWUsIGJlZm9yZUNoYW5nZUxheW91dCA9IGZhbHNlKSB7CiAgICAgICAgICAgIHRoaXMuX0RlbGV0ZUludGVybWVkaWF0ZUtleWZyYW1lcygpOwogICAgICAgICAgICBzdXBlci5SZXNldChyZW5kZXIsIGJlZm9yZUNoYW5nZUxheW91dCkKICAgICAgICB9CiAgICAgICAgX0RlbGV0ZUludGVybWVkaWF0ZUtleWZyYW1lcygpIHsKICAgICAgICAgICAgZm9yIChjb25zdCB0cmFjayBvZiB0aGlzLl90cmFja3MpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGRlbCA9IGtmID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCB0aW1lID0ga2YuR2V0VGltZSgpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHRvdGFsVGltZSA9IHRoaXMuR2V0VG90YWxUaW1lKCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRpbWUgIT09IDAgJiYgdGltZSAhPT0gdG90YWxUaW1lCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgdHJhY2suRGVsZXRlS2V5ZnJhbWVzKGRlbCk7CiAgICAgICAgICAgICAgICB0cmFjay5EZWxldGVQcm9wZXJ0eUtleWZyYW1lcyhkZWwpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgX09uQmVmb3JlQ2hhbmdlTGF5b3V0KCkgewogICAgICAgICAgICBpZiAodGhpcy5Jc1JlbGVhc2VkKCkpIHJldHVybiB0cnVlOwogICAgICAgICAgICBjb25zdCBpbnN0YW5jZSA9CiAgICAgICAgICAgICAgICB0aGlzLkdldEluc3RhbmNlKCk7CiAgICAgICAgICAgIGlmIChpbnN0YW5jZSAmJiBpbnN0YW5jZS5HZXRPYmplY3RDbGFzcygpLklzR2xvYmFsKCkpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgdGhpcy5fdGltZWxpbmVNYW5hZ2VyLkNvbXBsZXRlVGltZWxpbmVCZWZvcmVDaGFuZ2VPZkxheW91dCh0aGlzKTsKICAgICAgICAgICAgdGhpcy5SZXNldEJlZm9yZUNoYW5nZUxheW91dCgpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgIH0KICAgICAgICBUaWNrKGRlbHRhVGltZSwgdGltZVNjYWxlLCBkZWx0YVRpbWUxKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5faW5zdGFuY2UpIHRoaXMuX2luc3RhbmNlID0gdGhpcy5HZXRJbnN0YW5jZSgpOwogICAgICAgICAgICBpZiAoIXRoaXMuX2luc3RhbmNlIHx8IHRoaXMuX2luc3RhbmNlLklzRGVzdHJveWVkKCkpIHsKICAgICAgICAgICAgICAgIHRoaXMuU3RvcCh0cnVlKTsKICAgICAgICAgICAgICAgIHRoaXMuT25Db21wbGV0ZWQoKTsKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IGluc3RhbmNlVGltZVNjYWxlID0gdGhpcy5faW5zdGFuY2UuR2V0VGltZVNjYWxlKCk7CiAgICAgICAgICAgIGlmIChpbnN0YW5jZVRpbWVTY2FsZSAhPT0gLTEpIGRlbHRhVGltZSA9IGRlbHRhVGltZTEgKiBpbnN0YW5jZVRpbWVTY2FsZTsKICAgICAgICAgICAgaWYgKGRlbHRhVGltZSA9PT0KICAgICAgICAgICAgICAgIDAgJiYgdGhpcy5fbGFzdERlbHRhID09PSAwKSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuX2xhc3REZWx0YSA9IGRlbHRhVGltZTsKICAgICAgICAgICAgY29uc3QgbGFzdFRpbWUgPSB0aGlzLl9wbGF5aGVhZFRpbWU7CiAgICAgICAgICAgIGNvbnN0IG5ld0RlbHRhVGltZSA9IGRlbHRhVGltZSAqIHRoaXMuX3BsYXliYWNrUmF0ZTsKICAgICAgICAgICAgY29uc3QgbmV3VGltZSA9IGxhc3RUaW1lICsgbmV3RGVsdGFUaW1lOwogICAgICAgICAgICBjb25zdCB0b3RhbFRpbWUgPSB0aGlzLl90aW1lbGluZURhdGFJdGVtLl90b3RhbFRpbWU7CiAgICAgICAgICAgIGlmIChuZXdUaW1lIDwgMCkgdGhpcy5fcGxheWhlYWRUaW1lID0gMDsKICAgICAgICAgICAgZWxzZSBpZiAobmV3VGltZSA+PSB0b3RhbFRpbWUpIHRoaXMuX3BsYXloZWFkVGltZSA9IHRvdGFsVGltZTsKICAgICAgICAgICAgZWxzZSB0aGlzLl9wbGF5aGVhZFRpbWUgPSBuZXdUaW1lOwogICAgICAgICAgICBsZXQgY29tcGxldGUgPSBmYWxzZTsKICAgICAgICAgICAgbGV0IGVuc3VyZVZhbHVlID0gZmFsc2U7CiAgICAgICAgICAgIGNvbnN0IGxvb3AgPSB0aGlzLkdldExvb3AoKTsKICAgICAgICAgICAgY29uc3QgcGluZ1BvbmcgPSB0aGlzLkdldFBpbmdQb25nKCk7CiAgICAgICAgICAgIGlmICghbG9vcCAmJiAhcGluZ1BvbmcpCiAgICAgICAgICAgICAgICBpZiAodGhpcy5fcGxheWJhY2tSYXRlID4gMCkgewogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9wbGF5aGVhZFRpbWUgPj0KICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxUaW1lKQogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fY3VycmVudFJlcGVhdENvdW50IDwgdGhpcy5HZXRSZXBlYXRDb3VudCgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50UmVwZWF0Q291bnQrKzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX1NldFRpbWVBbmRSZXNldCgwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuc3VyZVZhbHVlID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fU2V0VGltZSh0b3RhbFRpbWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGUgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX3BsYXloZWFkVGltZSA8PSAwKQogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fY3VycmVudFJlcGVhdENvdW50IDwgdGhpcy5HZXRSZXBlYXRDb3VudCgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50UmVwZWF0Q291bnQrKzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX1NldFRpbWVBbmRSZXNldCh0b3RhbFRpbWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5zdXJlVmFsdWUgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9TZXRUaW1lKDApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGUgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAobG9vcCAmJiAhcGluZ1BvbmcpCiAgICAgICAgICAgICAgICBpZiAodGhpcy5fcGxheWJhY2tSYXRlID4gMCkgewogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9wbGF5aGVhZFRpbWUgPj0gdG90YWxUaW1lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX1NldFRpbWVBbmRSZXNldCgwKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5zdXJlVmFsdWUgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fcGxheWhlYWRUaW1lIDw9CiAgICAgICAgICAgICAgICAgICAgICAgIDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fU2V0VGltZUFuZFJlc2V0KHRvdGFsVGltZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuc3VyZVZhbHVlID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAoIWxvb3AgJiYgcGluZ1BvbmcpCiAgICAgICAgICAgICAgICBpZiAodGhpcy5fcGxheWJhY2tSYXRlID4gMCkgewogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9wbGF5aGVhZFRpbWUgPj0gdG90YWxUaW1lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX1NldFRpbWUodG90YWxUaW1lKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5TZXRQbGF5YmFja1JhdGUodGhpcy5HZXRQbGF5YmFja1JhdGUoKSAqIC0xKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5zdXJlVmFsdWUgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fcGluZ1BvbmdTdGF0ZSA9PT0gUElOR19QT05HX0VORCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9jdXJyZW50UmVwZWF0Q291bnQgPCB0aGlzLkdldFJlcGVhdENvdW50KCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50UmVwZWF0Q291bnQrKzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9waW5nUG9uZ1N0YXRlID0gUElOR19QT05HX0JFR0lOCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgY29tcGxldGUgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0aGlzLl9waW5nUG9uZ1N0YXRlID09PSBQSU5HX1BPTkdfQkVHSU4pIHRoaXMuX3BpbmdQb25nU3RhdGUgPSBQSU5HX1BPTkdfRU5ECiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fcGxheWhlYWRUaW1lIDw9CiAgICAgICAgICAgICAgICAgICAgICAgIDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fU2V0VGltZSgwKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5TZXRQbGF5YmFja1JhdGUodGhpcy5HZXRQbGF5YmFja1JhdGUoKSAqIC0xKTsKICAgICAgICAgICAgICAgICAgICAgICAgZW5zdXJlVmFsdWUgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fcGluZ1BvbmdTdGF0ZSA9PT0gUElOR19QT05HX0VORCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9jdXJyZW50UmVwZWF0Q291bnQgPCB0aGlzLkdldFJlcGVhdENvdW50KCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50UmVwZWF0Q291bnQrKzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9waW5nUG9uZ1N0YXRlID0gUElOR19QT05HX0JFR0lOCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgY29tcGxldGUgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0aGlzLl9waW5nUG9uZ1N0YXRlID09PSBQSU5HX1BPTkdfQkVHSU4pIHRoaXMuX3BpbmdQb25nU3RhdGUgPSBQSU5HX1BPTkdfRU5ECiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmIChsb29wICYmIHBpbmdQb25nKQogICAgICAgICAgICAgICAgaWYgKHRoaXMuX3BsYXliYWNrUmF0ZSA+IDApIHsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fcGxheWhlYWRUaW1lID49IHRvdGFsVGltZSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9TZXRUaW1lKHRvdGFsVGltZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuU2V0UGxheWJhY2tSYXRlKHRoaXMuR2V0UGxheWJhY2tSYXRlKCkgKiAtMSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuc3VyZVZhbHVlID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3BpbmdQb25nU3RhdGUrKzsKICAgICAgICAgICAgICAgICAgICAgICAgQzMud3JhcCh0aGlzLl9waW5nUG9uZ1N0YXRlLCAwLCAyKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5fcGxheWhlYWRUaW1lIDw9IDApIHsKICAgICAgICAgICAgICAgIHRoaXMuX1NldFRpbWUoMCk7CiAgICAgICAgICAgICAgICB0aGlzLlNldFBsYXliYWNrUmF0ZSh0aGlzLkdldFBsYXliYWNrUmF0ZSgpICogLTEpOwogICAgICAgICAgICAgICAgZW5zdXJlVmFsdWUgPSB0cnVlOwogICAgICAgICAgICAgICAgdGhpcy5fcGluZ1BvbmdTdGF0ZSsrOwogICAgICAgICAgICAgICAgQzMud3JhcCh0aGlzLl9waW5nUG9uZ1N0YXRlLCAwLCAyKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChjb21wbGV0ZSkgewogICAgICAgICAgICAgICAgdGhpcy5fdHJhY2suU2V0RW5kU3RhdGUoKTsKICAgICAgICAgICAgICAgIHRoaXMuU3RvcCh0cnVlKTsKICAgICAgICAgICAgICAgIHRoaXMuT25Db21wbGV0ZWQoKTsKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuX3RyYWNrLkludGVycG9sYXRlKHRoaXMuX3BsYXloZWFkVGltZSwgdHJ1ZSwgZmFsc2UsIGVuc3VyZVZhbHVlLCB0aGlzLl9maXJzdFRpY2ssIGZhbHNlKTsKICAgICAgICAgICAgaWYgKHRoaXMuX2ZpcnN0VGljaykgdGhpcy5fZmlyc3RUaWNrID0gZmFsc2UKICAgICAgICB9CiAgICAgICAgX1NhdmVUb0pzb24oKSB7CiAgICAgICAgICAgIGNvbnN0IHJldCA9IHN1cGVyLl9TYXZlVG9Kc29uKCk7CiAgICAgICAgICAgIGNvbnN0IHR3ZWVuRGF0YUl0ZW0gPQogICAgICAgICAgICAgICAgdGhpcy5HZXRUaW1lbGluZURhdGFJdGVtKCk7CiAgICAgICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKHJldCwgewogICAgICAgICAgICAgICAgInR3ZWVuRGF0YUl0ZW1Kc29uIjogdHdlZW5EYXRhSXRlbS5fU2F2ZVRvSnNvbigpLAogICAgICAgICAgICAgICAgImlkIjogdGhpcy5faWQsCiAgICAgICAgICAgICAgICAiZGVzdHJveUluc3RhbmNlT25Db21wbGV0ZSI6IHRoaXMuX2Rlc3Ryb3lJbnN0YW5jZU9uQ29tcGxldGUsCiAgICAgICAgICAgICAgICAiaW5pdGlhbFZhbHVlTW9kZSI6IHRoaXMuX2luaXRpYWxWYWx1ZU1vZGUKICAgICAgICAgICAgfSkKICAgICAgICB9CiAgICAgICAgX0xvYWRGcm9tSnNvbihvKSB7CiAgICAgICAgICAgIGlmICghbykgcmV0dXJuOwogICAgICAgICAgICBjb25zdCB0d2VlbkRhdGFJdGVtID0gdGhpcy5HZXRUaW1lbGluZURhdGFJdGVtKCk7CiAgICAgICAgICAgIHR3ZWVuRGF0YUl0ZW0uX0xvYWRGcm9tSnNvbihvWyJ0d2VlbkRhdGFJdGVtSnNvbiJdKTsKICAgICAgICAgICAgc3VwZXIuX0xvYWRGcm9tSnNvbihvKTsKICAgICAgICAgICAgdGhpcy5faWQgPSBvWyJpZCJdOwogICAgICAgICAgICB0aGlzLl9kZXN0cm95SW5zdGFuY2VPbkNvbXBsZXRlID0gb1siZGVzdHJveUluc3RhbmNlT25Db21wbGV0ZSJdOwogICAgICAgICAgICB0aGlzLl9pbml0aWFsVmFsdWVNb2RlID0gb1siaW5pdGlhbFZhbHVlTW9kZSJdCiAgICAgICAgfQogICAgICAgIHN0YXRpYyBJc1BsYXlpbmcodHdlZW4pIHsKICAgICAgICAgICAgcmV0dXJuIHR3ZWVuLklzUGxheWluZygpCiAgICAgICAgfQogICAgICAgIHN0YXRpYyBJc1BhdXNlZCh0d2VlbikgewogICAgICAgICAgICByZXR1cm4gdHdlZW4uSXNQYXVzZWQoKQogICAgICAgIH0KICAgICAgICBzdGF0aWMgQnVpbGQoY29uZmlnKSB7CiAgICAgICAgICAgIGNvbnN0IHRpbWVsaW5lTWFuYWdlciA9CiAgICAgICAgICAgICAgICBjb25maWcucnVudGltZS5HZXRUaW1lbGluZU1hbmFnZXIoKTsKICAgICAgICAgICAgY29uc3QgdHdlZW5EYXRhSXRlbSA9IG5ldyBDMy5UaW1lbGluZURhdGFJdGVtOwogICAgICAgICAgICBpZiAoY29uZmlnLmpzb24pIHsKICAgICAgICAgICAgICAgIHR3ZWVuRGF0YUl0ZW0uX0xvYWRGcm9tSnNvbihjb25maWcuanNvblsidHdlZW5EYXRhSXRlbUpzb24iXSk7CiAgICAgICAgICAgICAgICBjb25zdCB0d2VlbiA9IG5ldyBDMy5Ud2VlblN0YXRlKHR3ZWVuRGF0YUl0ZW0sIHRpbWVsaW5lTWFuYWdlcik7CiAgICAgICAgICAgICAgICB0d2Vlbi5fTG9hZEZyb21Kc29uKGNvbmZpZy5qc29uKTsKICAgICAgICAgICAgICAgIHJldHVybiB0d2VlbgogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29uc3QgdHdlZW4gPSBuZXcgQzMuVHdlZW5TdGF0ZSh0d2VlbkRhdGFJdGVtLCB0aW1lbGluZU1hbmFnZXIpOwogICAgICAgICAgICAgICAgaWYgKCFDMy5Jc0FycmF5KGNvbmZpZy5wcm9wZXJ0eVRyYWNrc0NvbmZpZykpIGNvbmZpZy5wcm9wZXJ0eVRyYWNrc0NvbmZpZyA9IFtjb25maWcucHJvcGVydHlUcmFja3NDb25maWddOwogICAgICAgICAgICAgICAgdHdlZW4uU2V0SWQoY29uZmlnLmlkKTsKICAgICAgICAgICAgICAgIHR3ZWVuLlNldFRhZ3MoY29uZmlnLnRhZ3MpOwogICAgICAgICAgICAgICAgdHdlZW4uU2V0SW5pdGlhbFZhbHVlTW9kZShjb25maWcuaW5pdGlhbFZhbHVlTW9kZSk7CiAgICAgICAgICAgICAgICB0d2Vlbi5TZXREZXN0cm95SW5zdGFuY2VPbkNvbXBsZXRlKGNvbmZpZy5yZWxlYXNlT25Db21wbGV0ZSk7CiAgICAgICAgICAgICAgICB0d2Vlbi5TZXRMb29wKGNvbmZpZy5sb29wKTsKICAgICAgICAgICAgICAgIHR3ZWVuLlNldFBpbmdQb25nKGNvbmZpZy5waW5nUG9uZyk7CiAgICAgICAgICAgICAgICB0d2Vlbi5TZXRUb3RhbFRpbWUoY29uZmlnLnRpbWUpOwogICAgICAgICAgICAgICAgdHdlZW4uU2V0U3RlcCgwKTsKICAgICAgICAgICAgICAgIHR3ZWVuLlNldEludGVycG9sYXRpb25Nb2RlKCJkZWZhdWx0Iik7CiAgICAgICAgICAgICAgICB0d2Vlbi5TZXRSZXN1bHRNb2RlKGNvbmZpZy5wcm9wZXJ0eVRyYWNrc0NvbmZpZ1swXS5yZXN1bHRNb2RlKTsKICAgICAgICAgICAgICAgIHR3ZWVuLlNldFJlcGVhdENvdW50KGNvbmZpZy5yZXBlYXRDb3VudCk7CiAgICAgICAgICAgICAgICBjb25zdCB0cmFjayA9IHR3ZWVuLkFkZFRyYWNrKCk7CiAgICAgICAgICAgICAgICB0cmFjay5TZXRJbnN0YW5jZVVJRChjb25maWcuaW5zdGFuY2UuR2V0VUlEKCkpOwogICAgICAgICAgICAgICAgdHJhY2suU2V0SW50ZXJwb2xhdGlvbk1vZGUoImRlZmF1bHQiKTsKICAgICAgICAgICAgICAgIHRyYWNrLlNldFJlc3VsdE1vZGUoY29uZmlnLnByb3BlcnR5VHJhY2tzQ29uZmlnWzBdLnJlc3VsdE1vZGUpOwogICAgICAgICAgICAgICAgdHJhY2suU2V0RW5hYmxlKHRydWUpOwogICAgICAgICAgICAgICAgdHJhY2suU2V0T2JqZWN0Q2xhc3NJbmRleChjb25maWcuaW5zdGFuY2UuR2V0T2JqZWN0Q2xhc3MoKS5HZXRJbmRleCgpKTsKICAgICAgICAgICAgICAgIGNvbnN0IHNka0ludGFuY2UgPSBjb25maWcuaW5zdGFuY2UuR2V0U2RrSW5zdGFuY2UoKTsKICAgICAgICAgICAgICAgIGNvbnN0IHcgPSBzZGtJbnRhbmNlLklzT3JpZ2luYWxTaXplS25vd24oKSA/IHNka0ludGFuY2UuR2V0T3JpZ2luYWxXaWR0aCgpIDogY29uZmlnLmluc3RhbmNlLkdldFdvcmxkSW5mbygpLkdldFdpZHRoKCk7CiAgICAgICAgICAgICAgICBjb25zdCBoID0gc2RrSW50YW5jZS5Jc09yaWdpbmFsU2l6ZUtub3duKCkgPyBzZGtJbnRhbmNlLkdldE9yaWdpbmFsSGVpZ2h0KCkgOiBjb25maWcuaW5zdGFuY2UuR2V0V29ybGRJbmZvKCkuR2V0SGVpZ2h0KCk7CiAgICAgICAgICAgICAgICB0cmFjay5TZXRPcmlnaW5hbFdpZHRoKHcpOwogICAgICAgICAgICAgICAgdHJhY2suU2V0T3JpZ2luYWxIZWlnaHQoaCk7CiAgICAgICAgICAgICAgICBjb25zdCBzdGFydEtleWZyYW1lRGF0YUl0ZW0gPSB0cmFjay5BZGRLZXlmcmFtZSgpOwogICAgICAgICAgICAgICAgc3RhcnRLZXlmcmFtZURhdGFJdGVtLlNldFRpbWUoMCk7CiAgICAgICAgICAgICAgICBzdGFydEtleWZyYW1lRGF0YUl0ZW0uU2V0RWFzZSgibm9lYXNlIik7CiAgICAgICAgICAgICAgICBzdGFydEtleWZyYW1lRGF0YUl0ZW0uU2V0RW5hYmxlKHRydWUpOwogICAgICAgICAgICAgICAgc3RhcnRLZXlmcmFtZURhdGFJdGVtLlNldFRhZ3MoIiIpOwogICAgICAgICAgICAgICAgY29uc3QgZW5kS2V5ZnJhbWVEYXRhSXRlbSA9IHRyYWNrLkFkZEtleWZyYW1lKCk7CiAgICAgICAgICAgICAgICBlbmRLZXlmcmFtZURhdGFJdGVtLlNldFRpbWUoY29uZmlnLnRpbWUpOwogICAgICAgICAgICAgICAgZW5kS2V5ZnJhbWVEYXRhSXRlbS5TZXRFYXNlKCJub2Vhc2UiKTsKICAgICAgICAgICAgICAgIGVuZEtleWZyYW1lRGF0YUl0ZW0uU2V0RW5hYmxlKHRydWUpOwogICAgICAgICAgICAgICAgZW5kS2V5ZnJhbWVEYXRhSXRlbS5TZXRUYWdzKCIiKTsKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgcHJvcGVydHlUcmFja0NvbmZpZyBvZiBjb25maWcucHJvcGVydHlUcmFja3NDb25maWcpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBwcm9wZXJ0eVRyYWNrID0gdHJhY2suQWRkUHJvcGVydHlUcmFjaygpOwogICAgICAgICAgICAgICAgICAgIHByb3BlcnR5VHJhY2suU2V0U291cmNlQWRhcHRlcklkKHByb3BlcnR5VHJhY2tDb25maWcuc291cmNlSWQpOwogICAgICAgICAgICAgICAgICAgIHByb3BlcnR5VHJhY2suU2V0U291cmNlQWRhcHRlckFyZ3MocHJvcGVydHlUcmFja0NvbmZpZy5zb3VyY2VBcmdzKTsKICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eVRyYWNrLlNldFByb3BlcnR5TmFtZShwcm9wZXJ0eVRyYWNrQ29uZmlnLnByb3BlcnR5KTsKICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eVRyYWNrLlNldFByb3BlcnR5VHlwZShwcm9wZXJ0eVRyYWNrQ29uZmlnLnR5cGUpOwogICAgICAgICAgICAgICAgICAgIHByb3BlcnR5VHJhY2suU2V0TWluKE5hTik7CiAgICAgICAgICAgICAgICAgICAgcHJvcGVydHlUcmFjay5TZXRNYXgoTmFOKTsKICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eVRyYWNrLlNldEludGVycG9sYXRpb25Nb2RlKCJkZWZhdWx0Iik7CiAgICAgICAgICAgICAgICAgICAgcHJvcGVydHlUcmFjay5TZXRSZXN1bHRNb2RlKHByb3BlcnR5VHJhY2tDb25maWcucmVzdWx0TW9kZSk7CiAgICAgICAgICAgICAgICAgICAgcHJvcGVydHlUcmFjay5TZXRFbmFibGUodHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RhcnRQcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW0gPSBwcm9wZXJ0eVRyYWNrLkFkZFByb3BlcnR5S2V5ZnJhbWUoKTsKICAgICAgICAgICAgICAgICAgICBzdGFydFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbS5TZXRUeXBlKHByb3BlcnR5VHJhY2tDb25maWcudmFsdWVUeXBlKTsKICAgICAgICAgICAgICAgICAgICBzdGFydFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbS5TZXRUaW1lKDApOwogICAgICAgICAgICAgICAgICAgIHN0YXJ0UHJvcGVydHlLZXlmcmFtZURhdGFJdGVtLlNldEVhc2UocHJvcGVydHlUcmFja0NvbmZpZy5lYXNlKTsKICAgICAgICAgICAgICAgICAgICBzdGFydFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbS5TZXRFbmFibGUodHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgc3RhcnRQcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW0uU2V0VmFsdWUocHJvcGVydHlUcmFja0NvbmZpZy5zdGFydFZhbHVlKTsKICAgICAgICAgICAgICAgICAgICBzdGFydFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbS5TZXRBYnNvbHV0ZVZhbHVlKHByb3BlcnR5VHJhY2tDb25maWcuc3RhcnRWYWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZW5kUHJvcGVydHlLZXlmcmFtZURhdGFJdGVtID0gcHJvcGVydHlUcmFjay5BZGRQcm9wZXJ0eUtleWZyYW1lKCk7CiAgICAgICAgICAgICAgICAgICAgZW5kUHJvcGVydHlLZXlmcmFtZURhdGFJdGVtLlNldFR5cGUocHJvcGVydHlUcmFja0NvbmZpZy52YWx1ZVR5cGUpOwogICAgICAgICAgICAgICAgICAgIGVuZFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbS5TZXRUaW1lKGNvbmZpZy50aW1lKTsKICAgICAgICAgICAgICAgICAgICBlbmRQcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW0uU2V0RWFzZShwcm9wZXJ0eVRyYWNrQ29uZmlnLmVhc2UpOwogICAgICAgICAgICAgICAgICAgIGVuZFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbS5TZXRFbmFibGUodHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgZW5kUHJvcGVydHlLZXlmcmFtZURhdGFJdGVtLlNldFZhbHVlKHByb3BlcnR5VHJhY2tDb25maWcuZW5kVmFsdWUpOwogICAgICAgICAgICAgICAgICAgIGVuZFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbS5TZXRBYnNvbHV0ZVZhbHVlKHByb3BlcnR5VHJhY2tDb25maWcuZW5kVmFsdWUpOwogICAgICAgICAgICAgICAgICAgIHByb3BlcnR5VHJhY2suR2V0U291cmNlQWRhcHRlcigpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gdHdlZW4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBHZXRJVHdlZW5TdGF0ZShiZWhJbnN0LCBvcHRzKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5faVR3ZWVuU3RhdGUpIHRoaXMuX2lUd2VlblN0YXRlID0gQzMuTmV3KHNlbGYuSVR3ZWVuU3RhdGUsIHRoaXMsIGJlaEluc3QsIG9wdHMpOwogICAgICAgICAgICByZXR1cm4gdGhpcy5faVR3ZWVuU3RhdGUKICAgICAgICB9CiAgICB9OwoKfQoKLy8gdGltZWxpbmVzL3R3ZWVucy90d2VlblRyYWNrU3RhdGUuanMKewogICAgJ3VzZSBzdHJpY3QnOwogICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgQzMuVHdlZW5UcmFja1N0YXRlID0gY2xhc3MgVHdlZW5UcmFjayBleHRlbmRzIEMzLlRyYWNrU3RhdGUgewogICAgICAgIGNvbnN0cnVjdG9yKHRpbWVsaW5lLCB0cmFja0RhdGFJdGVtKSB7CiAgICAgICAgICAgIHN1cGVyKHRpbWVsaW5lLCB0cmFja0RhdGFJdGVtKTsKICAgICAgICAgICAgdGhpcy5fZmlyc3RQcm9wZXJ0eVRyYWNrID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fc2Vjb25kUHJvcGVydHlUcmFjayA9IG51bGwKICAgICAgICB9CiAgICAgICAgc3RhdGljIENyZWF0ZSh0aW1lbGluZSwgdHJhY2tEYXRhSXRlbSkgewogICAgICAgICAgICByZXR1cm4gQzMuTmV3KEMzLlR3ZWVuVHJhY2tTdGF0ZSwgdGltZWxpbmUsIHRyYWNrRGF0YUl0ZW0pCiAgICAgICAgfQogICAgICAgIF9DYWNoZVByb3BlcnR5VHJhY2tzKCkgewogICAgICAgICAgICBpZiAodGhpcy5fcHJvcGVydHlUcmFja3MubGVuZ3RoID09PSAxKSB0aGlzLl9maXJzdFByb3BlcnR5VHJhY2sgPSB0aGlzLl9wcm9wZXJ0eVRyYWNrc1swXTsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLl9maXJzdFByb3BlcnR5VHJhY2sgPSB0aGlzLl9wcm9wZXJ0eVRyYWNrc1swXTsKICAgICAgICAgICAgICAgIHRoaXMuX3NlY29uZFByb3BlcnR5VHJhY2sgPSB0aGlzLl9wcm9wZXJ0eVRyYWNrc1sxXQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIENyZWF0ZVByb3BlcnR5VHJhY2tTdGF0ZXMoKSB7CiAgICAgICAgICAgIGZvciAoY29uc3QgcHJvcGVydHlUcmFja0RhdGFJdGVtIG9mIHRoaXMuX3RyYWNrRGF0YUl0ZW0uR2V0UHJvcGVydHlUcmFja0RhdGEoKS5wcm9wZXJ0eVRyYWNrRGF0YUl0ZW1zKCkpIHRoaXMuX3Byb3BlcnR5VHJhY2tzLnB1c2goQzMuVHdlZW5Qcm9wZXJ0eVRyYWNrU3RhdGUuQ3JlYXRlKHRoaXMsIHByb3BlcnR5VHJhY2tEYXRhSXRlbSkpOwogICAgICAgICAgICB0aGlzLl9DYWNoZVByb3BlcnR5VHJhY2tzKCkKICAgICAgICB9CiAgICAgICAgQWRkUHJvcGVydHlUcmFjaygpIHsKICAgICAgICAgICAgY29uc3QgcHJvcGVydHlUcmFja0RhdGEgPSB0aGlzLl90cmFja0RhdGFJdGVtLkdldFByb3BlcnR5VHJhY2tEYXRhKCk7CiAgICAgICAgICAgIGNvbnN0IHByb3BlcnR5VHJhY2tEYXRhSXRlbSA9IHByb3BlcnR5VHJhY2tEYXRhLkFkZEVtcHR5UHJvcGVydHlUcmFja0RhdGFJdGVtKCk7CiAgICAgICAgICAgIGNvbnN0IHByb3BlcnR5VHJhY2sgPSBDMy5Ud2VlblByb3BlcnR5VHJhY2tTdGF0ZS5DcmVhdGUodGhpcywgcHJvcGVydHlUcmFja0RhdGFJdGVtKTsKICAgICAgICAgICAgdGhpcy5fcHJvcGVydHlUcmFja3MucHVzaChwcm9wZXJ0eVRyYWNrKTsKICAgICAgICAgICAgdGhpcy5fQ2FjaGVQcm9wZXJ0eVRyYWNrcygpOwogICAgICAgICAgICByZXR1cm4gcHJvcGVydHlUcmFjawogICAgICAgIH0KICAgICAgICBTZXRJbml0aWFsU3RhdGUoKSB7CiAgICAgICAgICAgIHRoaXMuTWF5YmVHZXRJbnN0YW5jZSgpOwogICAgICAgICAgICBpZiAoIXRoaXMuSXNJbnN0YW5jZVZhbGlkKCkgJiYgdGhpcy5Jc0luc3RhbmNlVHJhY2soKSkgcmV0dXJuOwogICAgICAgICAgICBjb25zdCB0aW1lbGluZSA9IHRoaXMuR2V0VGltZWxpbmUoKTsKICAgICAgICAgICAgY29uc3QgaXNGb3J3YXJkUGxheUJhY2sgPQogICAgICAgICAgICAgICAgdGltZWxpbmUuSXNGb3J3YXJkUGxheUJhY2soKTsKICAgICAgICAgICAgY29uc3QgdGltZSA9IGlzRm9yd2FyZFBsYXlCYWNrID8gMCA6IHRoaXMuR2V0TG9jYWxUb3RhbFRpbWUoKTsKICAgICAgICAgICAgZm9yIChjb25zdCBwcm9wZXJ0eVRyYWNrIG9mIHRoaXMuX3Byb3BlcnR5VHJhY2tzKSB7CiAgICAgICAgICAgICAgICBwcm9wZXJ0eVRyYWNrLlNldEluaXRpYWxTdGF0ZSh0aW1lKTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl93b3JsZEluZm9DaGFuZ2UgPT09IDAgJiYgcHJvcGVydHlUcmFjay5HZXRXb3JsZEluZm9DaGFuZ2UoKSA9PT0gMSkgdGhpcy5fd29ybGRJbmZvQ2hhbmdlID0gMTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9yZW5kZXJDaGFuZ2UgPT09IDAgJiYgcHJvcGVydHlUcmFjay5HZXRSZW5kZXJDaGFuZ2UoKSA9PT0gMSkgdGhpcy5fcmVuZGVyQ2hhbmdlID0gMQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuX25lZWRzQmVmb3JlQW5kQWZ0ZXIgPSAwOwogICAgICAgICAgICBjb25zdCBuYmEgPSB0aGlzLl9wcm9wZXJ0eVRyYWNrcy5zb21lKHB0ID0+IHB0LkdldE5lZWRzQmVmb3JlQW5kQWZ0ZXIoKSk7CiAgICAgICAgICAgIGlmIChuYmEpIHRoaXMuX25lZWRzQmVmb3JlQW5kQWZ0ZXIgPSAxOwogICAgICAgICAgICB0aGlzLl9sYXN0S2V5ZnJhbWVEYXRhSXRlbSA9CiAgICAgICAgICAgICAgICB0aGlzLl9HZXRMYXN0S2V5RnJhbWVCZWZvcmVUaW1lKHRpbWUpOwogICAgICAgICAgICB0aGlzLl9pbml0aWFsU3RhdGVPZk5lc3RlZFNldCA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl9lbmRTdGF0ZU9mTmVzdGVkU2V0ID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuSW50ZXJwb2xhdGUodGltZSkKICAgICAgICB9CiAgICAgICAgQmVmb3JlSW50ZXJwb2xhdGUoKSB7fQogICAgICAgIEludGVycG9sYXRlKHRpbWUsIGlzVGlja2luZyA9IGZhbHNlLCBzZXRUaW1lID0gZmFsc2UsIGVuc3VyZVZhbHVlID0gZmFsc2UsIGZpcnN0VGljayA9IGZhbHNlLCBpZ25vcmVHbG9iYWxzID0gZmFsc2UsIGVuZFN0YXRlID0gZmFsc2UpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLl9pbnN0YW5jZSkgdGhpcy5HZXRJbnN0YW5jZSgpOwogICAgICAgICAgICBpZiAoIXRoaXMuX2luc3RhbmNlKSByZXR1cm47CiAgICAgICAgICAgIGNvbnN0IGluc3RhbmNlVmFsaWQgPSAhdGhpcy5faW5zdGFuY2UuSXNEZXN0cm95ZWQoKTsKICAgICAgICAgICAgaWYgKCFpbnN0YW5jZVZhbGlkKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGlmIChpZ25vcmVHbG9iYWxzICYmIHRoaXMuR2V0T2JqZWN0Q2xhc3MoKS5Jc0dsb2JhbCgpKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGlmICh0aGlzLl9zZWNvbmRQcm9wZXJ0eVRyYWNrKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9maXJzdFByb3BlcnR5VHJhY2suSW50ZXJwb2xhdGUodGltZSwKICAgICAgICAgICAgICAgICAgICBzZXRUaW1lLCBlbnN1cmVWYWx1ZSwgZW5kU3RhdGUpOwogICAgICAgICAgICAgICAgdGhpcy5fc2Vjb25kUHJvcGVydHlUcmFjay5JbnRlcnBvbGF0ZSh0aW1lLCBzZXRUaW1lLCBlbnN1cmVWYWx1ZSwgZW5kU3RhdGUpCiAgICAgICAgICAgIH0gZWxzZSB0aGlzLl9maXJzdFByb3BlcnR5VHJhY2suSW50ZXJwb2xhdGUodGltZSwgc2V0VGltZSwgZW5zdXJlVmFsdWUsIGVuZFN0YXRlKTsKICAgICAgICAgICAgaWYgKHRoaXMuX2ZpcnN0UHJvcGVydHlUcmFjay5HZXRXb3JsZEluZm9DaGFuZ2UoKSAhPT0gMCkgewogICAgICAgICAgICAgICAgaWYgKCF0aGlzLl93b3JsZEluZm8pIHRoaXMuX3dvcmxkSW5mbyA9IHRoaXMuX2luc3RhbmNlLkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuX3dvcmxkSW5mbykgdGhpcy5fd29ybGRJbmZvLlNldEJib3hDaGFuZ2VkKCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBBZnRlckludGVycG9sYXRlKCkge30KICAgICAgICBfTG9hZEZyb21Kc29uKG8pIHsKICAgICAgICAgICAgc3VwZXIuX0xvYWRGcm9tSnNvbihvKTsKICAgICAgICAgICAgdGhpcy5fQ2FjaGVQcm9wZXJ0eVRyYWNrcygpCiAgICAgICAgfQogICAgfTsKCn0KCi8vIHRpbWVsaW5lcy90d2VlbnMvdHdlZW5Qcm9wZXJ0eVRyYWNrU3RhdGUuanMKewogICAgJ3VzZSBzdHJpY3QnOwogICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgQzMuVHdlZW5Qcm9wZXJ0eVRyYWNrU3RhdGUgPSBjbGFzcyBUd2VlblByb3BlcnR5VHJhY2tTdGF0ZSBleHRlbmRzIEMzLlByb3BlcnR5VHJhY2tTdGF0ZSB7CiAgICAgICAgY29uc3RydWN0b3IodHJhY2ssIHByb3BlcnR5VHJhY2tEYXRhSXRlbSkgewogICAgICAgICAgICBzdXBlcih0cmFjaywgcHJvcGVydHlUcmFja0RhdGFJdGVtKTsKICAgICAgICAgICAgdGhpcy5fYmFzaWMgPSBmYWxzZQogICAgICAgIH0KICAgICAgICBzdGF0aWMgQ3JlYXRlKHRyYWNrLCBwcm9wZXJ0eVRyYWNrRGF0YUl0ZW0pIHsKICAgICAgICAgICAgcmV0dXJuIEMzLk5ldyhDMy5Ud2VlblByb3BlcnR5VHJhY2tTdGF0ZSwgdHJhY2ssIHByb3BlcnR5VHJhY2tEYXRhSXRlbSkKICAgICAgICB9CiAgICAgICAgSW50ZXJwb2xhdGUodGltZSwgc2V0VGltZSA9IGZhbHNlLCBlbnN1cmVWYWx1ZSA9IGZhbHNlLCBlbmRTdGF0ZSA9IGZhbHNlKSB7CiAgICAgICAgICAgIGxldCBzdGFydDsKICAgICAgICAgICAgbGV0IGVuZDsKICAgICAgICAgICAgaWYgKHRoaXMuX2Jhc2ljKSB7CiAgICAgICAgICAgICAgICBzdGFydCA9IHRoaXMuX3Byb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbXNbMF07CiAgICAgICAgICAgICAgICBlbmQgPSB0aGlzLl9wcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW1zWzFdCiAgICAgICAgICAgIH0gZWxzZSBpZiAoc2V0VGltZSkgewogICAgICAgICAgICAgICAgc3RhcnQgPSB0aGlzLl9wcm9wZXJ0eVRyYWNrRGF0YS5HZXRGaXJzdFByb3BlcnR5S2V5RnJhbWVEYXRhSXRlbUxvd2VyT3JFcXVhbFRoYW4odGltZSwKICAgICAgICAgICAgICAgICAgICB0aGlzLl9wcm9wZXJ0eVRyYWNrRGF0YUl0ZW0pOwogICAgICAgICAgICAgICAgZW5kID0gc3RhcnQuR2V0TmV4dCgpCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fbGFzdFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHRpbWVsaW5lID0gdGhpcy5HZXRUaW1lbGluZSgpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IG5leHRQcm9wZXJ0eUtleWZyYW1lID0gdGhpcy5fbGFzdFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbS5HZXROZXh0KCk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgbGFzdFRpbWUgPSB0aGlzLl9sYXN0UHJvcGVydHlLZXlmcmFtZURhdGFJdGVtLkdldFRpbWUoKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXh0VGltZSA9IG5leHRQcm9wZXJ0eUtleWZyYW1lID8gbmV4dFByb3BlcnR5S2V5ZnJhbWUuR2V0VGltZSgpIDogdGltZWxpbmUuR2V0VG90YWxUaW1lKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRpbWUgPD0gbGFzdFRpbWUgfHwgdGltZSA+PSBuZXh0VGltZSkgdGhpcy5fbGFzdFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbSA9IHRoaXMuX3Byb3BlcnR5VHJhY2tEYXRhLkdldEZpcnN0UHJvcGVydHlLZXlGcmFtZURhdGFJdGVtTG93ZXJPckVxdWFsVGhhbih0aW1lLCB0aGlzLl9wcm9wZXJ0eVRyYWNrRGF0YUl0ZW0pCiAgICAgICAgICAgICAgICB9IGVsc2UgdGhpcy5fbGFzdFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbSA9CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcHJvcGVydHlUcmFja0RhdGEuR2V0Rmlyc3RQcm9wZXJ0eUtleUZyYW1lRGF0YUl0ZW1Mb3dlck9yRXF1YWxUaGFuKHRpbWUsIHRoaXMuX3Byb3BlcnR5VHJhY2tEYXRhSXRlbSk7CiAgICAgICAgICAgICAgICBzdGFydCA9IHRoaXMuX2xhc3RQcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW07CiAgICAgICAgICAgICAgICBlbmQgPSBzdGFydC5HZXROZXh0KCkKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLl9zb3VyY2VBZGFwdGVyLkludGVycG9sYXRlKHRpbWUsIHN0YXJ0LCBlbmQsIHNldFRpbWUsIGVuc3VyZVZhbHVlLCBlbmRTdGF0ZSkKICAgICAgICB9CiAgICAgICAgQWRkUHJvcGVydHlLZXlmcmFtZSgpIHsKICAgICAgICAgICAgY29uc3QgcHJvcGVydHlLZXlmcmFtZURhdGEgPSB0aGlzLl9wcm9wZXJ0eVRyYWNrRGF0YUl0ZW0uR2V0UHJvcGVydHlLZXlmcmFtZURhdGEoKTsKICAgICAgICAgICAgY29uc3QgcHJvcGVydHlLZXlmcmFtZURhdGFJdGVtID0gcHJvcGVydHlLZXlmcmFtZURhdGEuQWRkRW1wdHlQcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW0oKTsKICAgICAgICAgICAgdGhpcy5fbGFzdFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbSA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX2Jhc2ljID0gdGhpcy5HZXRQcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW1zKCkubGVuZ3RoIDw9CiAgICAgICAgICAgICAgICAyOwogICAgICAgICAgICByZXR1cm4gcHJvcGVydHlLZXlmcmFtZURhdGFJdGVtCiAgICAgICAgfQogICAgICAgIERlbGV0ZVByb3BlcnR5S2V5ZnJhbWVzKG1hdGNoKSB7CiAgICAgICAgICAgIHRoaXMuX2xhc3RQcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW0gPSBudWxsOwogICAgICAgICAgICBjb25zdCBwcm9wZXJ0eUtleWZyYW1lRGF0YSA9IHRoaXMuX3Byb3BlcnR5VHJhY2tEYXRhSXRlbS5HZXRQcm9wZXJ0eUtleWZyYW1lRGF0YSgpOwogICAgICAgICAgICBwcm9wZXJ0eUtleWZyYW1lRGF0YS5EZWxldGVQcm9wZXJ0eUtleWZyYW1lRGF0YUl0ZW1zKG1hdGNoKTsKICAgICAgICAgICAgdGhpcy5fYmFzaWMgPSB0aGlzLkdldFByb3BlcnR5S2V5ZnJhbWVEYXRhSXRlbXMoKS5sZW5ndGggPD0gMgogICAgICAgIH0KICAgICAgICBfU2F2ZVRvSnNvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICJzb3VyY2VBZGFwdGVySnNvbiI6IHRoaXMuR2V0U291cmNlQWRhcHRlcigpLl9TYXZlVG9Kc29uKCksCiAgICAgICAgICAgICAgICAiYmFzaWMiOiB0aGlzLl9iYXNpYwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIF9Mb2FkRnJvbUpzb24obykgewogICAgICAgICAgICBpZiAoIW8pIHJldHVybjsKICAgICAgICAgICAgdGhpcy5HZXRTb3VyY2VBZGFwdGVyKCkuX0xvYWRGcm9tSnNvbihvWyJzb3VyY2VBZGFwdGVySnNvbiJdKTsKICAgICAgICAgICAgdGhpcy5fYmFzaWMgPQogICAgICAgICAgICAgICAgb1siYmFzaWMiXQogICAgICAgIH0KICAgIH07Cgp9CgovLyB0aW1lbGluZXMvdHJhbnNpdGlvbnMvdHJhbnNpdGlvbi5qcwp7CiAgICAndXNlIHN0cmljdCc7CiAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICBjb25zdCBFYXNlID0gc2VsZi5FYXNlOwogICAgY29uc3QgTkFNRSA9IDA7CiAgICBjb25zdCBUUkFOU0lUSU9OX0tFWUZSQU1FUyA9IDE7CiAgICBDMy5UcmFuc2l0aW9uID0gY2xhc3MgVHJhbnNpdGlvbiBleHRlbmRzIEMzLkRlZmVuZGVkQmFzZSB7CiAgICAgICAgY29uc3RydWN0b3IoZGF0YSwgYWRkQ3VzdG9tRWFzZSA9IHRydWUpIHsKICAgICAgICAgICAgc3VwZXIoKTsKICAgICAgICAgICAgdGhpcy5fbmFtZSA9IGRhdGFbTkFNRV07CiAgICAgICAgICAgIHRoaXMuX2xpbmVhciA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl90cmFuc2l0aW9uS2V5ZnJhbWVzID0gW107CiAgICAgICAgICAgIGZvciAoY29uc3QgdHJhbnNpdGlvbktleWZyYW1lRGF0YSBvZiBkYXRhW1RSQU5TSVRJT05fS0VZRlJBTUVTXSkgewogICAgICAgICAgICAgICAgY29uc3QgdHJhbnNpdGlvbktleWZyYW1lID0gQzMuVHJhbnNpdGlvbktleWZyYW1lLkNyZWF0ZSh0aGlzLCB0cmFuc2l0aW9uS2V5ZnJhbWVEYXRhKTsKICAgICAgICAgICAgICAgIHRoaXMuX3RyYW5zaXRpb25LZXlmcmFtZXMucHVzaCh0cmFuc2l0aW9uS2V5ZnJhbWUpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLl90cmFuc2l0aW9uS2V5ZnJhbWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50ID0gdGhpcy5fdHJhbnNpdGlvbktleWZyYW1lc1tpXTsKICAgICAgICAgICAgICAgIGN1cnJlbnQuU2V0TmV4dCh0aGlzLl90cmFuc2l0aW9uS2V5ZnJhbWVzW2kgKwogICAgICAgICAgICAgICAgICAgIDFdKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuX3ByZWNhbGN1bGF0ZWRTYW1wbGVzID0gbmV3IE1hcDsKICAgICAgICAgICAgdGhpcy5fdHJhbnNpdGlvbktleWZyYW1lQ2FjaGUgPSBuZXcgTWFwOwogICAgICAgICAgICB0aGlzLl9QcmVDYWxjU2FtcGxlcygpOwogICAgICAgICAgICBpZiAoYWRkQ3VzdG9tRWFzZSkgRWFzZS5BZGRDdXN0b21FYXNlKHRoaXMuX25hbWUsICh0LCBzdiwgZHYsIHR0KSA9PiB0aGlzLkludGVycG9sYXRlKHQsIHN2LCBkdiwgdHQpKQogICAgICAgIH0KICAgICAgICBzdGF0aWMgQ3JlYXRlKGRhdGEpIHsKICAgICAgICAgICAgcmV0dXJuIEMzLk5ldyhDMy5UcmFuc2l0aW9uLCBkYXRhKQogICAgICAgIH0KICAgICAgICBSZWxlYXNlKCkgewogICAgICAgICAgICBmb3IgKGNvbnN0IHRyYW5zaXRpb25LZXlmcmFtZSBvZiB0aGlzLl90cmFuc2l0aW9uS2V5ZnJhbWVzKSB0cmFuc2l0aW9uS2V5ZnJhbWUuUmVsZWFzZSgpOwogICAgICAgICAgICBDMy5jbGVhckFycmF5KHRoaXMuX3RyYW5zaXRpb25LZXlmcmFtZXMpOwogICAgICAgICAgICB0aGlzLl90cmFuc2l0aW9uS2V5ZnJhbWVzID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fcHJlY2FsY3VsYXRlZFNhbXBsZXMuY2xlYXIoKTsKICAgICAgICAgICAgdGhpcy5fcHJlY2FsY3VsYXRlZFNhbXBsZXMgPSBudWxsOwogICAgICAgICAgICB0aGlzLl90cmFuc2l0aW9uS2V5ZnJhbWVDYWNoZS5jbGVhcigpOwogICAgICAgICAgICB0aGlzLl90cmFuc2l0aW9uS2V5ZnJhbWVDYWNoZSA9IG51bGwKICAgICAgICB9CiAgICAgICAgTWFrZUxpbmVhcihsaW5lYXIpIHsKICAgICAgICAgICAgdGhpcy5fbGluZWFyID0gISFsaW5lYXIKICAgICAgICB9CiAgICAgICAgR2V0VHJhbnNpdGlvbktleUZyYW1lQXQoeCkgewogICAgICAgICAgICBjb25zdCB0cmFuc2l0aW9uS2V5ZnJhbWUgPSB0aGlzLl90cmFuc2l0aW9uS2V5ZnJhbWVDYWNoZS5nZXQoeCk7CiAgICAgICAgICAgIGlmICh0cmFuc2l0aW9uS2V5ZnJhbWUpIHJldHVybiB0cmFuc2l0aW9uS2V5ZnJhbWU7CiAgICAgICAgICAgIGZvciAoY29uc3QgdHJhbnNpdGlvbktleWZyYW1lIG9mIHRoaXMuX3RyYW5zaXRpb25LZXlmcmFtZXMpCiAgICAgICAgICAgICAgICBpZiAodHJhbnNpdGlvbktleWZyYW1lLkdldFZhbHVlWCgpID09PSB4KSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdHJhbnNpdGlvbktleWZyYW1lQ2FjaGUuc2V0KHgsIHRyYW5zaXRpb25LZXlmcmFtZSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRyYW5zaXRpb25LZXlmcmFtZQogICAgICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBHZXRGaXJzdFRyYW5zaXRpb25LZXlGcmFtZUhpZ2hlclRoYW4oeCkgewogICAgICAgICAgICBmb3IgKGNvbnN0IHRyYW5zaXRpb25LZXlmcmFtZSBvZiB0aGlzLl90cmFuc2l0aW9uS2V5ZnJhbWVzKQogICAgICAgICAgICAgICAgaWYgKHRyYW5zaXRpb25LZXlmcmFtZS5HZXRWYWx1ZVgoKSA+CiAgICAgICAgICAgICAgICAgICAgeCkgcmV0dXJuIHRyYW5zaXRpb25LZXlmcmFtZQogICAgICAgIH0KICAgICAgICBHZXRGaXJzdFRyYW5zaXRpb25LZXlGcmFtZUhpZ2hlck9yRXF1YWxUaGFuKHgpIHsKICAgICAgICAgICAgZm9yIChjb25zdCB0cmFuc2l0aW9uS2V5ZnJhbWUgb2YgdGhpcy5fdHJhbnNpdGlvbktleWZyYW1lcykKICAgICAgICAgICAgICAgIGlmICh0cmFuc2l0aW9uS2V5ZnJhbWUuR2V0VmFsdWVYKCkgPj0geCkgcmV0dXJuIHRyYW5zaXRpb25LZXlmcmFtZQogICAgICAgIH0KICAgICAgICBHZXRGaXJzdFRyYW5zaXRpb25LZXlGcmFtZUxvd2VyVGhhbih4KSB7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSB0aGlzLl90cmFuc2l0aW9uS2V5ZnJhbWVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICAgICAgICAgICAgICBjb25zdCB0cmFuc2l0aW9uS2V5ZnJhbWUgPSB0aGlzLl90cmFuc2l0aW9uS2V5ZnJhbWVzW2ldOwogICAgICAgICAgICAgICAgaWYgKHRyYW5zaXRpb25LZXlmcmFtZS5HZXRWYWx1ZVgoKSA8IHgpIHJldHVybiB0cmFuc2l0aW9uS2V5ZnJhbWUKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBHZXRGaXJzdFRyYW5zaXRpb25LZXlGcmFtZUxvd2VyT3JFcXVhbFRoYW4oeCkgewogICAgICAgICAgICBmb3IgKGxldCBpID0gdGhpcy5fdHJhbnNpdGlvbktleWZyYW1lcy5sZW5ndGggLSAxOyBpID49CiAgICAgICAgICAgICAgICAwOyBpLS0pIHsKICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5zaXRpb25LZXlmcmFtZSA9IHRoaXMuX3RyYW5zaXRpb25LZXlmcmFtZXNbaV07CiAgICAgICAgICAgICAgICBpZiAodHJhbnNpdGlvbktleWZyYW1lLkdldFZhbHVlWCgpIDw9IHgpIHJldHVybiB0cmFuc2l0aW9uS2V5ZnJhbWUKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBJbnRlcnBvbGF0ZSh0aW1lLCBzdGFydFZhbHVlLCBkZWx0YVZhbHVlLCB0b3RhbFRpbWUpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX2xpbmVhcikgcmV0dXJuIEVhc2UuTm9FYXNlKHRpbWUsIHN0YXJ0VmFsdWUsIGRlbHRhVmFsdWUsIHRvdGFsVGltZSk7CiAgICAgICAgICAgIGNvbnN0IG4gPSB0aW1lIC8gdG90YWxUaW1lOwogICAgICAgICAgICBsZXQgc3RhcnQgPSB0aGlzLkdldEZpcnN0VHJhbnNpdGlvbktleUZyYW1lTG93ZXJPckVxdWFsVGhhbihuKTsKICAgICAgICAgICAgbGV0IGVuZCA9IHN0YXJ0LkdldE5leHQoKTsKICAgICAgICAgICAgaWYgKCFlbmQpIHsKICAgICAgICAgICAgICAgIHN0YXJ0ID0gdGhpcy5HZXRGaXJzdFRyYW5zaXRpb25LZXlGcmFtZUxvd2VyVGhhbihuKTsKICAgICAgICAgICAgICAgIGVuZCA9IHN0YXJ0LkdldE5leHQoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IGRlbHRhID0gZW5kLkdldFZhbHVlWCgpIC0gc3RhcnQuR2V0VmFsdWVYKCk7CiAgICAgICAgICAgIGNvbnN0IG5uID0gQzMubWFwVG9SYW5nZShuLAogICAgICAgICAgICAgICAgc3RhcnQuR2V0VmFsdWVYKCksIGVuZC5HZXRWYWx1ZVgoKSwgMCwgZGVsdGEpOwogICAgICAgICAgICBjb25zdCBzdGFydFggPSBzdGFydC5HZXRWYWx1ZVgoKTsKICAgICAgICAgICAgY29uc3Qgc3RhcnRZID0gc3RhcnQuR2V0VmFsdWVZKCk7CiAgICAgICAgICAgIGNvbnN0IGFuY2hvcjFYID0gc3RhcnQuR2V0VmFsdWVYKCkgKyBzdGFydC5HZXRTdGFydEFuY2hvclgoKTsKICAgICAgICAgICAgY29uc3QgYW5jaG9yMVkgPSBzdGFydC5HZXRWYWx1ZVkoKSArIHN0YXJ0LkdldFN0YXJ0QW5jaG9yWSgpOwogICAgICAgICAgICBjb25zdCBhbmNob3IyWCA9IGVuZC5HZXRWYWx1ZVgoKSArIGVuZC5HZXRFbmRBbmNob3JYKCk7CiAgICAgICAgICAgIGNvbnN0IGFuY2hvcjJZID0gZW5kLkdldFZhbHVlWSgpICsgZW5kLkdldEVuZEFuY2hvclkoKTsKICAgICAgICAgICAgY29uc3QgZW5kWCA9IGVuZC5HZXRWYWx1ZVgoKTsKICAgICAgICAgICAgY29uc3QgZW5kWSA9IGVuZC5HZXRWYWx1ZVkoKTsKICAgICAgICAgICAgbGV0IHJldCA9IEVhc2UuR2V0UnVudGltZUVhc2UoInNwbGluZSIpKG5uLCBzdGFydFgsIHN0YXJ0WSwgYW5jaG9yMVgsIGFuY2hvcjFZLCBhbmNob3IyWCwgYW5jaG9yMlksIGVuZFgsIGVuZFksIHRoaXMuX3ByZWNhbGN1bGF0ZWRTYW1wbGVzLmdldChzdGFydCkpOwogICAgICAgICAgICByZXQgKz0gc3RhcnQuR2V0VmFsdWVZKCk7CiAgICAgICAgICAgIHJldHVybiAoMSAtIHJldCkgKiBzdGFydFZhbHVlICsgcmV0ICogKHN0YXJ0VmFsdWUgKyBkZWx0YVZhbHVlKQogICAgICAgIH0KICAgICAgICBfUHJlQ2FsY1NhbXBsZXMoKSB7CiAgICAgICAgICAgIHRoaXMuX3ByZWNhbGN1bGF0ZWRTYW1wbGVzLmNsZWFyKCk7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5fdHJhbnNpdGlvbktleWZyYW1lcy5sZW5ndGggLSAxOyBpKyspIHsKICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5zaXRpb25LZXlmcmFtZSA9IHRoaXMuX3RyYW5zaXRpb25LZXlmcmFtZXNbaV07CiAgICAgICAgICAgICAgICBpZiAoIXRyYW5zaXRpb25LZXlmcmFtZS5HZXRTdGFydEVuYWJsZSgpKSBjb250aW51ZTsKICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0ID0gdHJhbnNpdGlvbktleWZyYW1lOwogICAgICAgICAgICAgICAgY29uc3QgZW5kID0gdGhpcy5fdHJhbnNpdGlvbktleWZyYW1lc1tpICsgMV07CiAgICAgICAgICAgICAgICBjb25zdCBzdGFydFZhbHVlID0gc3RhcnQuR2V0VmFsdWVYKCk7CiAgICAgICAgICAgICAgICBjb25zdCBhbmNob3IxVmFsdWUgPSBzdGFydC5HZXRWYWx1ZVgoKSArIHN0YXJ0LkdldFN0YXJ0QW5jaG9yWCgpOwogICAgICAgICAgICAgICAgY29uc3QgYW5jaG9yMlZhbHVlID0gZW5kLkdldFZhbHVlWCgpICsgZW5kLkdldEVuZEFuY2hvclgoKTsKICAgICAgICAgICAgICAgIGNvbnN0IGVuZFZhbHVlID0gZW5kLkdldFZhbHVlWCgpOwogICAgICAgICAgICAgICAgdGhpcy5fcHJlY2FsY3VsYXRlZFNhbXBsZXMuc2V0KHN0YXJ0LCBFYXNlLkdldEJlemllclNhbXBsZXMoc3RhcnRWYWx1ZSwgYW5jaG9yMVZhbHVlLCBhbmNob3IyVmFsdWUsIGVuZFZhbHVlKSkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07Cgp9CgovLyB0aW1lbGluZXMvdHJhbnNpdGlvbnMvdHJhbnNpdGlvbktleWZyYW1lLmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIGNvbnN0IFZBTFVFX1ggPSAwOwogICAgY29uc3QgVkFMVUVfWSA9IDE7CiAgICBjb25zdCBTVEFSVF9BTkNIT1JfWCA9IDI7CiAgICBjb25zdCBTVEFSVF9BTkNIT1JfWSA9IDM7CiAgICBjb25zdCBFTkRfQU5DSE9SX1ggPSA0OwogICAgY29uc3QgRU5EX0FOQ0hPUl9ZID0gNTsKICAgIGNvbnN0IFNUQVJUX0VOQUJMRSA9IDY7CiAgICBjb25zdCBFTkRfRU5BQkxFID0gNzsKICAgIEMzLlRyYW5zaXRpb25LZXlmcmFtZSA9IGNsYXNzIFRyYW5zaXRpb25LZXlmcmFtZSBleHRlbmRzIEMzLkRlZmVuZGVkQmFzZSB7CiAgICAgICAgY29uc3RydWN0b3IodHJhbnNpdGlvbiwgZGF0YSkgewogICAgICAgICAgICBzdXBlcigpOwogICAgICAgICAgICB0aGlzLl90cmFuc2l0aW9uID0gdHJhbnNpdGlvbjsKICAgICAgICAgICAgdGhpcy5fdmFsdWVYID0gZGF0YVtWQUxVRV9YXTsKICAgICAgICAgICAgdGhpcy5fdmFsdWVZID0gZGF0YVtWQUxVRV9ZXTsKICAgICAgICAgICAgdGhpcy5fc3RhcnRBbmNob3JYID0gZGF0YVtTVEFSVF9BTkNIT1JfWF07CiAgICAgICAgICAgIHRoaXMuX3N0YXJ0QW5jaG9yWSA9IGRhdGFbU1RBUlRfQU5DSE9SX1ldOwogICAgICAgICAgICB0aGlzLl9lbmRBbmNob3JYID0gZGF0YVtFTkRfQU5DSE9SX1hdOwogICAgICAgICAgICB0aGlzLl9lbmRBbmNob3JZID0gZGF0YVtFTkRfQU5DSE9SX1ldOwogICAgICAgICAgICB0aGlzLl9zdGFydEVuYWJsZSA9IGRhdGFbU1RBUlRfRU5BQkxFXTsKICAgICAgICAgICAgdGhpcy5fZW5kRW5hYmxlID0gZGF0YVtFTkRfRU5BQkxFXTsKICAgICAgICAgICAgdGhpcy5fbmV4dCA9IG51bGwKICAgICAgICB9CiAgICAgICAgUmVsZWFzZSgpIHsKICAgICAgICAgICAgdGhpcy5fdHJhbnNpdGlvbiA9IG51bGwKICAgICAgICB9CiAgICAgICAgc3RhdGljIENyZWF0ZSh0cmFuc2l0aW9uLCBkYXRhKSB7CiAgICAgICAgICAgIHJldHVybiBDMy5OZXcoQzMuVHJhbnNpdGlvbktleWZyYW1lLAogICAgICAgICAgICAgICAgdHJhbnNpdGlvbiwgZGF0YSkKICAgICAgICB9CiAgICAgICAgU2V0TmV4dCh0cmFuc2l0aW9uS2V5ZnJhbWUpIHsKICAgICAgICAgICAgdGhpcy5fbmV4dCA9IHRyYW5zaXRpb25LZXlmcmFtZQogICAgICAgIH0KICAgICAgICBHZXROZXh0KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fbmV4dAogICAgICAgIH0KICAgICAgICBHZXRWYWx1ZVgoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl92YWx1ZVgKICAgICAgICB9CiAgICAgICAgR2V0VmFsdWVZKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fdmFsdWVZCiAgICAgICAgfQogICAgICAgIEdldFN0YXJ0QW5jaG9yWCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3N0YXJ0QW5jaG9yWAogICAgICAgIH0KICAgICAgICBHZXRTdGFydEFuY2hvclkoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zdGFydEFuY2hvclkKICAgICAgICB9CiAgICAgICAgR2V0RW5kQW5jaG9yWCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2VuZEFuY2hvclgKICAgICAgICB9CiAgICAgICAgR2V0RW5kQW5jaG9yWSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2VuZEFuY2hvclkKICAgICAgICB9CiAgICAgICAgR2V0U3RhcnRFbmFibGUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zdGFydEVuYWJsZQogICAgICAgIH0KICAgICAgICBHZXRFbmRFbmFibGUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9lbmRFbmFibGUKICAgICAgICB9CiAgICB9OwoKfQoKLy8gdGltZWxpbmVzL3RyYW5zaXRpb25zL3RyYW5zaXRpb25NYW5hZ2VyLmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIEMzLlRyYW5zaXRpb25NYW5hZ2VyID0gY2xhc3MgVHJhbnNpdGlvbk1hbmFnZXIgZXh0ZW5kcyBDMy5EZWZlbmRlZEJhc2UgewogICAgICAgIGNvbnN0cnVjdG9yKHJ1bnRpbWUpIHsKICAgICAgICAgICAgc3VwZXIoKTsKICAgICAgICAgICAgdGhpcy5fcnVudGltZSA9IHJ1bnRpbWU7CiAgICAgICAgICAgIHRoaXMuX3RyYW5zaXRpb25zID0gW10KICAgICAgICB9CiAgICAgICAgUmVsZWFzZSgpIHsKICAgICAgICAgICAgZm9yIChjb25zdCB0cmFuc2l0aW9uIG9mIHRoaXMuX3RyYW5zaXRpb25zKSB0cmFuc2l0aW9uLlJlbGVhc2UoKTsKICAgICAgICAgICAgQzMuY2xlYXJBcnJheSh0aGlzLl90cmFuc2l0aW9ucyk7CiAgICAgICAgICAgIHRoaXMuX3RyYW5zaXRpb25zID0gbnVsbAogICAgICAgIH0KICAgICAgICBDcmVhdGUodHJhbnNpdGlvbkRhdGEpIHsKICAgICAgICAgICAgdGhpcy5fdHJhbnNpdGlvbnMucHVzaChDMy5UcmFuc2l0aW9uLkNyZWF0ZSh0cmFuc2l0aW9uRGF0YSkpCiAgICAgICAgfQogICAgfTsKCn0KCi8vIHRlbXBsYXRlcy90ZW1wbGF0ZU1hbmFnZXIuanMKewogICAgJ3VzZSBzdHJpY3QnOwogICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgQzMuVGVtcGxhdGVNYW5hZ2VyID0gY2xhc3MgVGVtcGxhdGVNYW5hZ2VyIGV4dGVuZHMgQzMuRGVmZW5kZWRCYXNlIHsKICAgICAgICBjb25zdHJ1Y3RvcihydW50aW1lKSB7CiAgICAgICAgICAgIHN1cGVyKCk7CiAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUgPSBydW50aW1lOwogICAgICAgICAgICB0aGlzLl90ZW1wbGF0ZURhdGFNYXAgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9pbnN0YW5jZVRvVGVtcGxhdGVOYW1lTWFwID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5faW5zdGFuY2VEZXN0cm95ID0gZSA9PiB0aGlzLl9Pbkluc3RhbmNlRGVzdHJveShlLmluc3RhbmNlKQogICAgICAgIH0KICAgICAgICBSZWxlYXNlKCkgewogICAgICAgICAgICB0aGlzLlJlbW92ZVJ1bnRpbWVMaXN0ZW5lcnMoKTsKICAgICAgICAgICAgaWYgKHRoaXMuX3RlbXBsYXRlRGF0YU1hcCkgewogICAgICAgICAgICAgICAgZm9yIChjb25zdCBvYmplY3RDbGFzc1RlbXBsYXRlc01hcCBvZiB0aGlzLl90ZW1wbGF0ZURhdGFNYXAudmFsdWVzKCkpIG9iamVjdENsYXNzVGVtcGxhdGVzTWFwLmNsZWFyKCk7CiAgICAgICAgICAgICAgICB0aGlzLl90ZW1wbGF0ZURhdGFNYXAuY2xlYXIoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuX3RlbXBsYXRlRGF0YU1hcCA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUgPSBudWxsCiAgICAgICAgfQogICAgICAgIENyZWF0ZSh0ZW1wbGF0ZUluc3RhbmNlRGF0YSkgewogICAgICAgICAgICBpZiAoIXRoaXMuX3RlbXBsYXRlRGF0YU1hcCkgdGhpcy5fdGVtcGxhdGVEYXRhTWFwID0KICAgICAgICAgICAgICAgIG5ldyBNYXA7CiAgICAgICAgICAgIGlmICghdGVtcGxhdGVJbnN0YW5jZURhdGEpIHJldHVybjsKICAgICAgICAgICAgY29uc3QgdGVtcGxhdGVEYXRhID0gdGVtcGxhdGVJbnN0YW5jZURhdGFbMF1bMTZdOwogICAgICAgICAgICBjb25zdCB0ZW1wbGF0ZU5hbWUgPSB0ZW1wbGF0ZURhdGFbMF07CiAgICAgICAgICAgIGNvbnN0IG9iamVjdENsYXNzSW5kZXggPSB0ZW1wbGF0ZUluc3RhbmNlRGF0YVsxXTsKICAgICAgICAgICAgaWYgKCF0aGlzLl90ZW1wbGF0ZURhdGFNYXAuaGFzKG9iamVjdENsYXNzSW5kZXgpKSB0aGlzLl90ZW1wbGF0ZURhdGFNYXAuc2V0KG9iamVjdENsYXNzSW5kZXgsIG5ldyBNYXApOwogICAgICAgICAgICBjb25zdCBvYmplY3RDbGFzc1RlbXBsYXRlc01hcCA9IHRoaXMuX3RlbXBsYXRlRGF0YU1hcC5nZXQob2JqZWN0Q2xhc3NJbmRleCk7CiAgICAgICAgICAgIG9iamVjdENsYXNzVGVtcGxhdGVzTWFwLnNldCh0ZW1wbGF0ZU5hbWUsIHRlbXBsYXRlSW5zdGFuY2VEYXRhKQogICAgICAgIH0KICAgICAgICBBZGRSdW50aW1lTGlzdGVuZXJzKCkgewogICAgICAgICAgICBjb25zdCBkaXNwYXRjaGVyID0gdGhpcy5fcnVudGltZS5EaXNwYXRjaGVyKCk7CiAgICAgICAgICAgIGlmIChkaXNwYXRjaGVyKSBkaXNwYXRjaGVyLmFkZEV2ZW50TGlzdGVuZXIoImluc3RhbmNlZGVzdHJveSIsCiAgICAgICAgICAgICAgICB0aGlzLl9pbnN0YW5jZURlc3Ryb3kpCiAgICAgICAgfQogICAgICAgIFJlbW92ZVJ1bnRpbWVMaXN0ZW5lcnMoKSB7CiAgICAgICAgICAgIGNvbnN0IGRpc3BhdGNoZXIgPSB0aGlzLl9ydW50aW1lLkRpc3BhdGNoZXIoKTsKICAgICAgICAgICAgaWYgKGRpc3BhdGNoZXIpIGRpc3BhdGNoZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcigiaW5zdGFuY2VkZXN0cm95IiwgdGhpcy5faW5zdGFuY2VEZXN0cm95KQogICAgICAgIH0KICAgICAgICBIYXNUZW1wbGF0ZXMoKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5fdGVtcGxhdGVEYXRhTWFwKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl90ZW1wbGF0ZURhdGFNYXAuc2l6ZSAhPT0gMAogICAgICAgIH0KICAgICAgICBHZXRUZW1wbGF0ZURhdGEob2JqZWN0Q2xhc3Nfb3JfaW5kZXgsIHRlbXBsYXRlTmFtZSkgewogICAgICAgICAgICBsZXQgaW5kZXggPSAwOwogICAgICAgICAgICBpZiAob2JqZWN0Q2xhc3Nfb3JfaW5kZXggaW5zdGFuY2VvZiBDMy5PYmplY3RDbGFzcykgaW5kZXggPSBvYmplY3RDbGFzc19vcl9pbmRleC5HZXRJbmRleCgpOwogICAgICAgICAgICBlbHNlIGluZGV4ID0gb2JqZWN0Q2xhc3Nfb3JfaW5kZXg7CiAgICAgICAgICAgIGlmICghdGhpcy5fdGVtcGxhdGVEYXRhTWFwLmhhcyhpbmRleCkpIHJldHVybjsKICAgICAgICAgICAgY29uc3QgcmV0ID0KICAgICAgICAgICAgICAgIHRoaXMuX3RlbXBsYXRlRGF0YU1hcC5nZXQoaW5kZXgpLmdldCh0ZW1wbGF0ZU5hbWUpOwogICAgICAgICAgICBpZiAocmV0KSByZXR1cm4gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShyZXQpKTsKICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZAogICAgICAgIH0KICAgICAgICBNYXBJbnN0YW5jZVRvVGVtcGxhdGVOYW1lKGluc3QsIHRlbXBsYXRlTmFtZSkgewogICAgICAgICAgICBpZiAoIXRoaXMuX2luc3RhbmNlVG9UZW1wbGF0ZU5hbWVNYXApIHRoaXMuX2luc3RhbmNlVG9UZW1wbGF0ZU5hbWVNYXAgPSBuZXcgV2Vha01hcDsKICAgICAgICAgICAgaWYgKHRoaXMuX2luc3RhbmNlVG9UZW1wbGF0ZU5hbWVNYXAuaGFzKGluc3QpKSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuX2luc3RhbmNlVG9UZW1wbGF0ZU5hbWVNYXAuc2V0KGluc3QsIHRlbXBsYXRlTmFtZSkKICAgICAgICB9CiAgICAgICAgR2V0SW5zdGFuY2VUZW1wbGF0ZU5hbWUoaW5zdCkgewogICAgICAgICAgICBpZiAoIXRoaXMuX2luc3RhbmNlVG9UZW1wbGF0ZU5hbWVNYXApIHJldHVybiAiIjsKICAgICAgICAgICAgY29uc3QgcmV0ID0gdGhpcy5faW5zdGFuY2VUb1RlbXBsYXRlTmFtZU1hcC5nZXQoaW5zdCk7CiAgICAgICAgICAgIGlmIChyZXQpIHJldHVybiByZXQ7CiAgICAgICAgICAgIHJldHVybiAiIgogICAgICAgIH0KICAgICAgICBfT25JbnN0YW5jZURlc3Ryb3koaW5zdCkgewogICAgICAgICAgICBpZiAoIXRoaXMuX2luc3RhbmNlVG9UZW1wbGF0ZU5hbWVNYXApIHJldHVybjsKICAgICAgICAgICAgaWYgKCF0aGlzLl9pbnN0YW5jZVRvVGVtcGxhdGVOYW1lTWFwLmhhcyhpbnN0KSkgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl9pbnN0YW5jZVRvVGVtcGxhdGVOYW1lTWFwLmRlbGV0ZShpbnN0KQogICAgICAgIH0KICAgIH07Cgp9CgovLyBldmVudHMvc3RhY2tzL3NvbFN0YWNrLmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIEMzLlNvbFN0YWNrID0gY2xhc3MgU29sU3RhY2sgZXh0ZW5kcyBDMy5EZWZlbmRlZEJhc2UgewogICAgICAgIGNvbnN0cnVjdG9yKG9iamVjdENsYXNzKSB7CiAgICAgICAgICAgIHN1cGVyKCk7CiAgICAgICAgICAgIHRoaXMuX29iamVjdENsYXNzID0gb2JqZWN0Q2xhc3M7CiAgICAgICAgICAgIHRoaXMuX3N0YWNrID0gW107CiAgICAgICAgICAgIHRoaXMuX3N0YWNrLnB1c2goQzMuTmV3KEMzLlNvbCwgdGhpcykpOwogICAgICAgICAgICB0aGlzLl9pbmRleCA9IDA7CiAgICAgICAgICAgIHRoaXMuX2N1cnJlbnQgPSB0aGlzLl9zdGFja1swXQogICAgICAgIH0KICAgICAgICBSZWxlYXNlKCkgewogICAgICAgICAgICBmb3IgKGNvbnN0IHMgb2YgdGhpcy5fc3RhY2spIHMuUmVsZWFzZSgpOwogICAgICAgICAgICBDMy5jbGVhckFycmF5KHRoaXMuX3N0YWNrKTsKICAgICAgICAgICAgdGhpcy5fY3VycmVudCA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX29iamVjdENsYXNzID0gbnVsbAogICAgICAgIH0KICAgICAgICBHZXRPYmplY3RDbGFzcygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX29iamVjdENsYXNzCiAgICAgICAgfQogICAgICAgIEdldEN1cnJlbnRTb2woKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9jdXJyZW50CiAgICAgICAgfQogICAgICAgIEdldE9uZUJlbG93Q3VycmVudFNvbCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3N0YWNrW3RoaXMuX2luZGV4IC0gMV0KICAgICAgICB9CiAgICAgICAgQ2xlYXIoKSB7CiAgICAgICAgICAgIHRoaXMuR2V0Q3VycmVudFNvbCgpLkNsZWFyKCkKICAgICAgICB9CiAgICAgICAgUHVzaENsZWFuKCkgewogICAgICAgICAgICBjb25zdCBzdGFjayA9IHRoaXMuX3N0YWNrOwogICAgICAgICAgICBjb25zdCBpbmRleCA9ICsrdGhpcy5faW5kZXg7CiAgICAgICAgICAgIGlmIChpbmRleCA9PT0gc3RhY2subGVuZ3RoKSB7CiAgICAgICAgICAgICAgICBjb25zdCBzb2wgPSBDMy5OZXcoQzMuU29sLCB0aGlzKTsKICAgICAgICAgICAgICAgIHN0YWNrLnB1c2goc29sKTsKICAgICAgICAgICAgICAgIHRoaXMuX2N1cnJlbnQgPSBzb2wKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbnN0IHNvbCA9IHN0YWNrW2luZGV4XTsKICAgICAgICAgICAgICAgIHNvbC5SZXNldCgpOwogICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudCA9IHNvbAogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIFB1c2hDb3B5KCkgewogICAgICAgICAgICBjb25zdCBzdGFjayA9IHRoaXMuX3N0YWNrOwogICAgICAgICAgICBjb25zdCBpbmRleCA9ICsrdGhpcy5faW5kZXg7CiAgICAgICAgICAgIGlmIChpbmRleCA9PT0gc3RhY2subGVuZ3RoKSBzdGFjay5wdXNoKEMzLk5ldyhDMy5Tb2wsIHRoaXMpKTsKICAgICAgICAgICAgY29uc3Qgc29sID0gc3RhY2tbaW5kZXhdOwogICAgICAgICAgICBzb2wuQ29weShzdGFja1tpbmRleCAtIDFdKTsKICAgICAgICAgICAgdGhpcy5fY3VycmVudCA9IHNvbAogICAgICAgIH0KICAgICAgICBQb3AoKSB7CiAgICAgICAgICAgIHRoaXMuX2N1cnJlbnQgPSB0aGlzLl9zdGFja1stLXRoaXMuX2luZGV4XQogICAgICAgIH0KICAgICAgICBSZW1vdmVJbnN0YW5jZXMocykgewogICAgICAgICAgICBjb25zdCBzdGFjayA9IHRoaXMuX3N0YWNrOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gc3RhY2subGVuZ3RoOyBpIDwgbGVuOyArK2kpIHN0YWNrW2ldLlJlbW92ZUluc3RhbmNlcyhzKQogICAgICAgIH0KICAgIH07Cgp9CgovLyBldmVudHMvc3RhY2tzL3NvbC5qcwp7CiAgICAndXNlIHN0cmljdCc7CiAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICBDMy5Tb2wgPSBjbGFzcyBTb2wgZXh0ZW5kcyBDMy5EZWZlbmRlZEJhc2UgewogICAgICAgIGNvbnN0cnVjdG9yKHN0YWNrKSB7CiAgICAgICAgICAgIHN1cGVyKCk7CiAgICAgICAgICAgIHRoaXMuX3N0YWNrID0gc3RhY2s7CiAgICAgICAgICAgIHRoaXMuX29iamVjdENsYXNzID0gdGhpcy5fc3RhY2suR2V0T2JqZWN0Q2xhc3MoKTsKICAgICAgICAgICAgdGhpcy5fZXZlbnRTdGFjayA9IHRoaXMuX29iamVjdENsYXNzLkdldFJ1bnRpbWUoKS5HZXRFdmVudFN0YWNrKCk7CiAgICAgICAgICAgIHRoaXMuX3NlbGVjdEFsbCA9IHRydWU7CiAgICAgICAgICAgIHRoaXMuX2luc3RhbmNlcyA9IFtdOwogICAgICAgICAgICB0aGlzLl9lbHNlSW5zdGFuY2VzID0gW10KICAgICAgICB9CiAgICAgICAgUmVsZWFzZSgpIHsKICAgICAgICAgICAgdGhpcy5DbGVhckFycmF5cygpOwogICAgICAgICAgICB0aGlzLl9zdGFjayA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX29iamVjdENsYXNzID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fZXZlbnRTdGFjayA9IG51bGwKICAgICAgICB9CiAgICAgICAgQ2xlYXJBcnJheXMoKSB7CiAgICAgICAgICAgIEMzLmNsZWFyQXJyYXkodGhpcy5faW5zdGFuY2VzKTsKICAgICAgICAgICAgQzMuY2xlYXJBcnJheSh0aGlzLl9lbHNlSW5zdGFuY2VzKQogICAgICAgIH0KICAgICAgICBHZXRPYmplY3RDbGFzcygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX29iamVjdENsYXNzCiAgICAgICAgfQogICAgICAgIElzU2VsZWN0QWxsKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fc2VsZWN0QWxsCiAgICAgICAgfQogICAgICAgIEhhc0FueUluc3RhbmNlcygpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX3NlbGVjdEFsbCkgcmV0dXJuICEhdGhpcy5fb2JqZWN0Q2xhc3MuR2V0SW5zdGFuY2VDb3VudCgpOwogICAgICAgICAgICBlbHNlIHJldHVybiAhIXRoaXMuX2luc3RhbmNlcy5sZW5ndGgKICAgICAgICB9CiAgICAgICAgR2V0SW5zdGFuY2VzKCkgewogICAgICAgICAgICBpZiAodGhpcy5fc2VsZWN0QWxsKSByZXR1cm4gdGhpcy5fb2JqZWN0Q2xhc3MuR2V0SW5zdGFuY2VzKCk7CiAgICAgICAgICAgIGVsc2UgcmV0dXJuIHRoaXMuX2luc3RhbmNlcwogICAgICAgIH0KICAgICAgICBIYXNBbnlFbHNlSW5zdGFuY2VzKCkgewogICAgICAgICAgICByZXR1cm4gISF0aGlzLl9lbHNlSW5zdGFuY2VzLmxlbmd0aAogICAgICAgIH0KICAgICAgICBHZXRFbHNlSW5zdGFuY2VzKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZWxzZUluc3RhbmNlcwogICAgICAgIH0KICAgICAgICBHZXRFeHByZXNzaW9uSW5zdGFuY2VzKCkgewogICAgICAgICAgICBjb25zdCByZXQgPSB0aGlzLkdldEluc3RhbmNlcygpOwogICAgICAgICAgICBpZiAocmV0Lmxlbmd0aCkgcmV0dXJuIHJldDsKICAgICAgICAgICAgZWxzZSByZXR1cm4gdGhpcy5fZWxzZUluc3RhbmNlcwogICAgICAgIH0KICAgICAgICBSZXNldCgpIHsKICAgICAgICAgICAgdGhpcy5fc2VsZWN0QWxsID0gdHJ1ZTsKICAgICAgICAgICAgQzMuY2xlYXJBcnJheSh0aGlzLl9lbHNlSW5zdGFuY2VzKQogICAgICAgIH0KICAgICAgICBDbGVhcigpIHsKICAgICAgICAgICAgdGhpcy5fc2VsZWN0QWxsID0gdHJ1ZQogICAgICAgIH0KICAgICAgICBDb3B5KHNvbCkgewogICAgICAgICAgICBpZiAoc29sLklzU2VsZWN0QWxsKCkpIHRoaXMuUmVzZXQoKTsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLl9zZWxlY3RBbGwgPSBmYWxzZTsKICAgICAgICAgICAgICAgIEMzLnNoYWxsb3dBc3NpZ25BcnJheSh0aGlzLl9pbnN0YW5jZXMsIHNvbC5faW5zdGFuY2VzKTsKICAgICAgICAgICAgICAgIEMzLmNsZWFyQXJyYXkodGhpcy5fZWxzZUluc3RhbmNlcykKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBfUHVzaEluc3RhbmNlKGluc3QpIHsKICAgICAgICAgICAgdGhpcy5faW5zdGFuY2VzLnB1c2goaW5zdCkKICAgICAgICB9CiAgICAgICAgX1B1c2hFbHNlSW5zdGFuY2UoaW5zdCkgewogICAgICAgICAgICB0aGlzLl9lbHNlSW5zdGFuY2VzLnB1c2goaW5zdCkKICAgICAgICB9CiAgICAgICAgX1NldFNlbGVjdEFsbChzKSB7CiAgICAgICAgICAgIHRoaXMuX3NlbGVjdEFsbCA9ICEhcwogICAgICAgIH0KICAgICAgICBfR2V0T3duSW5zdGFuY2VzKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faW5zdGFuY2VzCiAgICAgICAgfQogICAgICAgIF9HZXRPd25FbHNlSW5zdGFuY2VzKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZWxzZUluc3RhbmNlcwogICAgICAgIH0KICAgICAgICBTZXRTaW5nbGVQaWNrZWQoaW5zdCkgewogICAgICAgICAgICB0aGlzLl9zZWxlY3RBbGwgPSBmYWxzZTsKICAgICAgICAgICAgQzMuY2xlYXJBcnJheSh0aGlzLl9pbnN0YW5jZXMpOwogICAgICAgICAgICB0aGlzLl9pbnN0YW5jZXMucHVzaChpbnN0KQogICAgICAgIH0KICAgICAgICBTZXRBcnJheVBpY2tlZChhcnIpIHsKICAgICAgICAgICAgdGhpcy5fc2VsZWN0QWxsID0gZmFsc2U7CiAgICAgICAgICAgIEMzLnNoYWxsb3dBc3NpZ25BcnJheSh0aGlzLl9pbnN0YW5jZXMsIGFycikKICAgICAgICB9CiAgICAgICAgU2V0U2V0UGlja2VkKHNldCkgewogICAgICAgICAgICB0aGlzLl9zZWxlY3RBbGwgPSBmYWxzZTsKICAgICAgICAgICAgQzMuY2xlYXJBcnJheSh0aGlzLl9pbnN0YW5jZXMpOwogICAgICAgICAgICBmb3IgKGNvbnN0IGl0ZW0gb2Ygc2V0KSB0aGlzLl9pbnN0YW5jZXMucHVzaChpdGVtKQogICAgICAgIH0KICAgICAgICBBZGRFbHNlSW5zdGFuY2VzKHNldE9mUGlja2VkLCBhcnJheU9mQWxsUGlja2VkKSB7CiAgICAgICAgICAgIGZvciAoY29uc3QgaW5zdCBvZiBhcnJheU9mQWxsUGlja2VkKQogICAgICAgICAgICAgICAgaWYgKCFzZXRPZlBpY2tlZC5oYXMoaW5zdCkpIHRoaXMuX2Vsc2VJbnN0YW5jZXMucHVzaChpbnN0KQogICAgICAgIH0KICAgICAgICBUcmFuc2ZlckVsc2VJbnN0YW5jZXNUb093bihzZXRPZlBpY2tlZCkgewogICAgICAgICAgICBmb3IgKGNvbnN0IGluc3Qgb2Ygc2V0T2ZQaWNrZWQpIHRoaXMuX2luc3RhbmNlcy5wdXNoKGluc3QpOwogICAgICAgICAgICBDMy5hcnJheVJlbW92ZUFsbEluU2V0KHRoaXMuX2Vsc2VJbnN0YW5jZXMsIHNldE9mUGlja2VkKQogICAgICAgIH0KICAgICAgICBDbGVhckVsc2VJbnN0YW5jZXMoKSB7CiAgICAgICAgICAgIEMzLmNsZWFyQXJyYXkodGhpcy5fZWxzZUluc3RhbmNlcykKICAgICAgICB9CiAgICAgICAgUGlja09uZShpbnN0KSB7CiAgICAgICAgICAgIGlmICghaW5zdCkgcmV0dXJuOwogICAgICAgICAgICBpZiAodGhpcy5fZXZlbnRTdGFjay5HZXRDdXJyZW50U3RhY2tGcmFtZSgpLkdldEN1cnJlbnRFdmVudCgpLklzT3JCbG9jaygpKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5Jc1NlbGVjdEFsbCgpKSB7CiAgICAgICAgICAgICAgICAgICAgQzMuY2xlYXJBcnJheSh0aGlzLl9pbnN0YW5jZXMpOwogICAgICAgICAgICAgICAgICAgIEMzLnNoYWxsb3dBc3NpZ25BcnJheSh0aGlzLl9lbHNlSW5zdGFuY2VzLCBpbnN0LkdldE9iamVjdENsYXNzKCkuR2V0SW5zdGFuY2VzKCkpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3NlbGVjdEFsbCA9IGZhbHNlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjb25zdCBpID0gdGhpcy5fZWxzZUluc3RhbmNlcy5pbmRleE9mKGluc3QpOwogICAgICAgICAgICAgICAgaWYgKGkgIT09IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5faW5zdGFuY2VzLnB1c2godGhpcy5fZWxzZUluc3RhbmNlc1tpXSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZWxzZUluc3RhbmNlcy5zcGxpY2UoaSwgMSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHRoaXMuU2V0U2luZ2xlUGlja2VkKGluc3QpCiAgICAgICAgfQogICAgICAgIFJlbW92ZUluc3RhbmNlcyhzKSB7CiAgICAgICAgICAgIEMzLmFycmF5UmVtb3ZlQWxsSW5TZXQodGhpcy5faW5zdGFuY2VzLAogICAgICAgICAgICAgICAgcyk7CiAgICAgICAgICAgIEMzLmFycmF5UmVtb3ZlQWxsSW5TZXQodGhpcy5fZWxzZUluc3RhbmNlcywgcykKICAgICAgICB9CiAgICB9OwoKfQoKLy8gZXZlbnRzL3N0YWNrcy9ldmVudFN0YWNrLmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIEMzLkV2ZW50U3RhY2sgPSBjbGFzcyBFdmVudFN0YWNrIGV4dGVuZHMgQzMuRGVmZW5kZWRCYXNlIHsKICAgICAgICBjb25zdHJ1Y3RvcihldmVudFNoZWV0TWFuYWdlcikgewogICAgICAgICAgICBzdXBlcigpOwogICAgICAgICAgICB0aGlzLl9ldmVudFNoZWV0TWFuYWdlciA9IGV2ZW50U2hlZXRNYW5hZ2VyOwogICAgICAgICAgICB0aGlzLl9ydW50aW1lID0gdGhpcy5fZXZlbnRTaGVldE1hbmFnZXIuR2V0UnVudGltZSgpOwogICAgICAgICAgICB0aGlzLl9zdGFjayA9IFtdOwogICAgICAgICAgICB0aGlzLl9zdGFjay5wdXNoKEMzLk5ldyhDMy5FdmVudFN0YWNrRnJhbWUsIHRoaXMsIG51bGwpKTsKICAgICAgICAgICAgdGhpcy5faW5kZXggPSAwOwogICAgICAgICAgICB0aGlzLl9leHBGdW5jU3RhY2sgPSBbXQogICAgICAgIH0KICAgICAgICBSZWxlYXNlKCkgewogICAgICAgICAgICBmb3IgKGNvbnN0IGUgb2YgdGhpcy5fc3RhY2spIGUuUmVsZWFzZSgpOwogICAgICAgICAgICBDMy5jbGVhckFycmF5KHRoaXMuX3N0YWNrKTsKICAgICAgICAgICAgQzMuY2xlYXJBcnJheSh0aGlzLl9leHBGdW5jU3RhY2spOwogICAgICAgICAgICB0aGlzLl9ldmVudFNoZWV0TWFuYWdlciA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUgPSBudWxsCiAgICAgICAgfQogICAgICAgIEdldEV2ZW50U2hlZXRNYW5hZ2VyKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZXZlbnRTaGVldE1hbmFnZXIKICAgICAgICB9CiAgICAgICAgR2V0UnVudGltZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUKICAgICAgICB9CiAgICAgICAgR2V0Q3VycmVudFN0YWNrRnJhbWUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zdGFja1t0aGlzLl9pbmRleF0KICAgICAgICB9CiAgICAgICAgR2V0QWxsU3RhY2tGcmFtZXMoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zdGFjawogICAgICAgIH0KICAgICAgICBHZXRDdXJyZW50U3RhY2tGcmFtZUluZGV4KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faW5kZXgKICAgICAgICB9CiAgICAgICAgUHVzaChjdXJyZW50RXZlbnQpIHsKICAgICAgICAgICAgY29uc3Qgc3RhY2sgPSB0aGlzLl9zdGFjazsKICAgICAgICAgICAgY29uc3QgaW5kZXggPSArK3RoaXMuX2luZGV4OwogICAgICAgICAgICBpZiAoaW5kZXggPT09IHN0YWNrLmxlbmd0aCkgewogICAgICAgICAgICAgICAgY29uc3QgcmV0ID0gQzMuTmV3KEMzLkV2ZW50U3RhY2tGcmFtZSwgdGhpcywgY3VycmVudEV2ZW50KTsKICAgICAgICAgICAgICAgIHN0YWNrLnB1c2gocmV0KTsKICAgICAgICAgICAgICAgIHJldHVybiByZXQKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbnN0IHJldCA9IHN0YWNrW2luZGV4XTsKICAgICAgICAgICAgICAgIHJldC5SZXNldChjdXJyZW50RXZlbnQpOwogICAgICAgICAgICAgICAgcmV0dXJuIHJldAogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIFBvcCgpIHsKICAgICAgICAgICAgLS10aGlzLl9pbmRleAogICAgICAgIH0KICAgICAgICBQdXNoRXhwRnVuYyhmcmFtZSkgewogICAgICAgICAgICB0aGlzLl9leHBGdW5jU3RhY2sucHVzaChmcmFtZSkKICAgICAgICB9CiAgICAgICAgUG9wRXhwRnVuYygpIHsKICAgICAgICAgICAgdGhpcy5fZXhwRnVuY1N0YWNrLnBvcCgpCiAgICAgICAgfQogICAgICAgIEdldEN1cnJlbnRFeHBGdW5jU3RhY2tGcmFtZSgpIHsKICAgICAgICAgICAgY29uc3QgZXhwRnVuY1N0YWNrID0gdGhpcy5fZXhwRnVuY1N0YWNrOwogICAgICAgICAgICBpZiAoZXhwRnVuY1N0YWNrLmxlbmd0aCA9PT0gMCkgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIGVsc2UgcmV0dXJuIGV4cEZ1bmNTdGFjay5hdCgtMSkKICAgICAgICB9CiAgICB9OwoKfQoKLy8gZXZlbnRzL3N0YWNrcy9ldmVudFN0YWNrRnJhbWUuanMKewogICAgJ3VzZSBzdHJpY3QnOwogICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgQzMuRXZlbnRTdGFja0ZyYW1lID0gY2xhc3MgRXZlbnRTdGFja0ZyYW1lIGV4dGVuZHMgQzMuRGVmZW5kZWRCYXNlIHsKICAgICAgICBjb25zdHJ1Y3RvcihzdGFjaywgY3VycmVudEV2ZW50KSB7CiAgICAgICAgICAgIHN1cGVyKCk7CiAgICAgICAgICAgIHRoaXMuX3N0YWNrID0gc3RhY2s7CiAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUgPSB0aGlzLl9zdGFjay5HZXRSdW50aW1lKCk7CiAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRFdmVudCA9IGN1cnJlbnRFdmVudDsKICAgICAgICAgICAgdGhpcy5fY25kSW5kZXggPSAwOwogICAgICAgICAgICB0aGlzLl9hY3RJbmRleCA9IDA7CiAgICAgICAgICAgIHRoaXMuX2xhc3RFdmVudFRydWUgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5fZWxzZUJyYW5jaFJhbiA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl9leHByZXNzaW9uT2JqZWN0Q2xhc3MgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9mdW5jdGlvblJldHVyblR5cGUgPSAwOwogICAgICAgICAgICB0aGlzLl9mdW5jdGlvblJldHVyblZhbHVlID0gMDsKICAgICAgICAgICAgdGhpcy5fZHluYW1pY1NvbE1vZGlmaWVycyA9IG51bGwKICAgICAgICB9CiAgICAgICAgUmVsZWFzZSgpIHsKICAgICAgICAgICAgdGhpcy5SZXNldChudWxsKTsKICAgICAgICAgICAgdGhpcy5fc3RhY2sgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9ydW50aW1lID0gbnVsbAogICAgICAgIH0KICAgICAgICBSZXNldChjdXJyZW50RXZlbnQpIHsKICAgICAgICAgICAgdGhpcy5fY3VycmVudEV2ZW50ID0gY3VycmVudEV2ZW50OwogICAgICAgICAgICB0aGlzLl9jbmRJbmRleCA9IDA7CiAgICAgICAgICAgIHRoaXMuX2FjdEluZGV4ID0gMDsKICAgICAgICAgICAgdGhpcy5fbGFzdEV2ZW50VHJ1ZSA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl9lbHNlQnJhbmNoUmFuID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX2R5bmFtaWNTb2xNb2RpZmllcnMgPSBudWxsCiAgICAgICAgfQogICAgICAgIF9SZXN0b3JlKGN1cnJlbnRFdmVudCwgYWN0SW5kZXgpIHsKICAgICAgICAgICAgdGhpcy5fY3VycmVudEV2ZW50ID0gY3VycmVudEV2ZW50OwogICAgICAgICAgICB0aGlzLl9jbmRJbmRleCA9IDA7CiAgICAgICAgICAgIHRoaXMuX2FjdEluZGV4ID0gYWN0SW5kZXgKICAgICAgICB9CiAgICAgICAgUmVzZXRRdWljaygpIHsKICAgICAgICAgICAgdGhpcy5fY25kSW5kZXggPSAwOwogICAgICAgICAgICB0aGlzLl9hY3RJbmRleCA9IDAKICAgICAgICB9CiAgICAgICAgR2V0Q3VycmVudEV2ZW50KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fY3VycmVudEV2ZW50CiAgICAgICAgfQogICAgICAgIFNldEN1cnJlbnRFdmVudChjdXJyZW50RXZlbnQpIHsKICAgICAgICAgICAgdGhpcy5fY3VycmVudEV2ZW50ID0gY3VycmVudEV2ZW50CiAgICAgICAgfQogICAgICAgIEdldENvbmRpdGlvbkluZGV4KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fY25kSW5kZXgKICAgICAgICB9CiAgICAgICAgU2V0Q29uZGl0aW9uSW5kZXgoaSkgewogICAgICAgICAgICB0aGlzLl9jbmRJbmRleCA9IGkKICAgICAgICB9CiAgICAgICAgR2V0QWN0aW9uSW5kZXgoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9hY3RJbmRleAogICAgICAgIH0KICAgICAgICBTZXRBY3Rpb25JbmRleChpKSB7CiAgICAgICAgICAgIHRoaXMuX2FjdEluZGV4ID0KICAgICAgICAgICAgICAgIGkKICAgICAgICB9CiAgICAgICAgU2V0TGFzdEV2ZW50VHJ1ZSh0KSB7CiAgICAgICAgICAgIHRoaXMuX2xhc3RFdmVudFRydWUgPSAhIXQKICAgICAgICB9CiAgICAgICAgR2V0TGFzdEV2ZW50VHJ1ZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2xhc3RFdmVudFRydWUKICAgICAgICB9CiAgICAgICAgU2V0RWxzZUJyYW5jaFJhbihyKSB7CiAgICAgICAgICAgIHRoaXMuX2Vsc2VCcmFuY2hSYW4gPSAhIXIKICAgICAgICB9CiAgICAgICAgR2V0RWxzZUJyYW5jaFJhbigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2Vsc2VCcmFuY2hSYW4KICAgICAgICB9CiAgICAgICAgU2V0RXhwcmVzc2lvbk9iamVjdENsYXNzKG9iamVjdENsYXNzKSB7CiAgICAgICAgICAgIHRoaXMuX2V4cHJlc3Npb25PYmplY3RDbGFzcyA9IG9iamVjdENsYXNzCiAgICAgICAgfQogICAgICAgIEdldEV4cHJlc3Npb25PYmplY3RDbGFzcygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2V4cHJlc3Npb25PYmplY3RDbGFzcwogICAgICAgIH0KICAgICAgICBJbml0Q2FsbEZ1bmN0aW9uRXhwcmVzc2lvbihyZXR1cm5UeXBlLCBkZWZhdWx0UmV0dXJuVmFsdWUpIHsKICAgICAgICAgICAgdGhpcy5fZnVuY3Rpb25SZXR1cm5UeXBlID0gcmV0dXJuVHlwZTsKICAgICAgICAgICAgdGhpcy5fZnVuY3Rpb25SZXR1cm5WYWx1ZSA9IGRlZmF1bHRSZXR1cm5WYWx1ZQogICAgICAgIH0KICAgICAgICBHZXRGdW5jdGlvblJldHVyblR5cGUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9mdW5jdGlvblJldHVyblR5cGUKICAgICAgICB9CiAgICAgICAgU2V0RnVuY3Rpb25SZXR1cm5WYWx1ZSh2KSB7CiAgICAgICAgICAgIHRoaXMuX2Z1bmN0aW9uUmV0dXJuVmFsdWUgPQogICAgICAgICAgICAgICAgdgogICAgICAgIH0KICAgICAgICBHZXRGdW5jdGlvblJldHVyblZhbHVlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZnVuY3Rpb25SZXR1cm5WYWx1ZQogICAgICAgIH0KICAgICAgICBJc1NvbE1vZGlmaWVyQWZ0ZXJDbmRzKCkgewogICAgICAgICAgICBjb25zdCBjdXJyZW50RXZlbnQgPSB0aGlzLl9jdXJyZW50RXZlbnQ7CiAgICAgICAgICAgIGlmIChjdXJyZW50RXZlbnQuSXNTb2xXcml0ZXJBZnRlckNuZHMoKSkgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIGlmICh0aGlzLl9jbmRJbmRleCA8IGN1cnJlbnRFdmVudC5HZXRDb25kaXRpb25Db3VudCgpIC0gMSkgcmV0dXJuICEhY3VycmVudEV2ZW50LkdldFNvbE1vZGlmaWVycygpLmxlbmd0aDsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgfQogICAgICAgIFNldER5bmFtaWNTb2xNb2RpZmllcnMoc29sTW9kaWZpZXJzKSB7CiAgICAgICAgICAgIHRoaXMuX2R5bmFtaWNTb2xNb2RpZmllcnMgPSBzb2xNb2RpZmllcnMKICAgICAgICB9CiAgICAgICAgR2V0RHluYW1pY1NvbE1vZGlmaWVycygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2R5bmFtaWNTb2xNb2RpZmllcnMKICAgICAgICB9CiAgICB9OwoKfQoKLy8gZXZlbnRzL3N0YWNrcy9sb2NhbFZhclN0YWNrLmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIEMzLkxvY2FsVmFyU3RhY2sgPSBjbGFzcyBMb2NhbFZhclN0YWNrIGV4dGVuZHMgQzMuRGVmZW5kZWRCYXNlIHsKICAgICAgICBjb25zdHJ1Y3RvcihldmVudFNoZWV0TWFuYWdlcikgewogICAgICAgICAgICBzdXBlcigpOwogICAgICAgICAgICB0aGlzLl9ldmVudFNoZWV0TWFuYWdlciA9IGV2ZW50U2hlZXRNYW5hZ2VyOwogICAgICAgICAgICB0aGlzLl9ydW50aW1lID0gdGhpcy5fZXZlbnRTaGVldE1hbmFnZXIuR2V0UnVudGltZSgpOwogICAgICAgICAgICB0aGlzLl9zdGFjayA9IFtdOwogICAgICAgICAgICB0aGlzLl9pbmRleCA9IC0xOwogICAgICAgICAgICB0aGlzLl9jdXJyZW50ID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5faW5pdGlhbFZhbHVlcyA9IFtdCiAgICAgICAgfQogICAgICAgIFJlbGVhc2UoKSB7CiAgICAgICAgICAgIEMzLmNsZWFyQXJyYXkodGhpcy5fc3RhY2spOwogICAgICAgICAgICB0aGlzLl9ldmVudFNoZWV0TWFuYWdlciA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUgPSBudWxsCiAgICAgICAgfQogICAgICAgIF9TZXRJbml0aWFsVmFsdWVzKGluaXRpYWxWYWx1ZXMpIHsKICAgICAgICAgICAgdGhpcy5faW5pdGlhbFZhbHVlcyA9IGluaXRpYWxWYWx1ZXM7CiAgICAgICAgICAgIGNvbnN0IGFyciA9IHRoaXMuX2luaXRpYWxWYWx1ZXMuc2xpY2UoMCk7CiAgICAgICAgICAgIHRoaXMuX3N0YWNrLnB1c2goYXJyKTsKICAgICAgICAgICAgdGhpcy5faW5kZXggPSAwOwogICAgICAgICAgICB0aGlzLl9jdXJyZW50ID0KICAgICAgICAgICAgICAgIGFycgogICAgICAgIH0KICAgICAgICBHZXRFdmVudFNoZWV0TWFuYWdlcigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2V2ZW50U2hlZXRNYW5hZ2VyCiAgICAgICAgfQogICAgICAgIEdldFJ1bnRpbWUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lCiAgICAgICAgfQogICAgICAgIEdldEN1cnJlbnQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9jdXJyZW50CiAgICAgICAgfQogICAgICAgIFB1c2goKSB7CiAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gKyt0aGlzLl9pbmRleDsKICAgICAgICAgICAgY29uc3Qgc3RhY2sgPSB0aGlzLl9zdGFjazsKICAgICAgICAgICAgaWYgKGluZGV4ID09PSBzdGFjay5sZW5ndGgpIHN0YWNrLnB1c2godGhpcy5faW5pdGlhbFZhbHVlcy5zbGljZSgwKSk7CiAgICAgICAgICAgIGVsc2UgQzMuc2hhbGxvd0Fzc2lnbkFycmF5KHN0YWNrW2luZGV4XSwgdGhpcy5faW5pdGlhbFZhbHVlcyk7CiAgICAgICAgICAgIHRoaXMuX2N1cnJlbnQgPSBzdGFja1tpbmRleF0KICAgICAgICB9CiAgICAgICAgUG9wKCkgewogICAgICAgICAgICB0aGlzLl9jdXJyZW50ID0gdGhpcy5fc3RhY2tbLS10aGlzLl9pbmRleF0KICAgICAgICB9CiAgICB9OwoKfQoKLy8gZXZlbnRzL3N0YWNrcy9sb29wU3RhY2suanMKewogICAgJ3VzZSBzdHJpY3QnOwogICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgQzMuTG9vcFN0YWNrID0gY2xhc3MgTG9vcFN0YWNrIGV4dGVuZHMgQzMuRGVmZW5kZWRCYXNlIHsKICAgICAgICBjb25zdHJ1Y3RvcihldmVudFNoZWV0TWFuYWdlcikgewogICAgICAgICAgICBzdXBlcigpOwogICAgICAgICAgICB0aGlzLl9ldmVudFNoZWV0TWFuYWdlciA9IGV2ZW50U2hlZXRNYW5hZ2VyOwogICAgICAgICAgICB0aGlzLl9ydW50aW1lID0gdGhpcy5fZXZlbnRTaGVldE1hbmFnZXIuR2V0UnVudGltZSgpOwogICAgICAgICAgICB0aGlzLl9zdGFjayA9IFtdOwogICAgICAgICAgICB0aGlzLl9pbmRleCA9IC0xCiAgICAgICAgfQogICAgICAgIFJlbGVhc2UoKSB7CiAgICAgICAgICAgIEMzLmNsZWFyQXJyYXkodGhpcy5fc3RhY2spOwogICAgICAgICAgICB0aGlzLl9ldmVudFNoZWV0TWFuYWdlciA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUgPSBudWxsCiAgICAgICAgfQogICAgICAgIEdldEV2ZW50U2hlZXRNYW5hZ2VyKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZXZlbnRTaGVldE1hbmFnZXIKICAgICAgICB9CiAgICAgICAgR2V0UnVudGltZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUKICAgICAgICB9CiAgICAgICAgSXNJbkxvb3AoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pbmRleCA+PSAwCiAgICAgICAgfQogICAgICAgIEdldEN1cnJlbnQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zdGFja1t0aGlzLl9pbmRleF0KICAgICAgICB9CiAgICAgICAgUHVzaCgpIHsKICAgICAgICAgICAgKyt0aGlzLl9pbmRleDsKICAgICAgICAgICAgaWYgKHRoaXMuX2luZGV4ID09PQogICAgICAgICAgICAgICAgdGhpcy5fc3RhY2subGVuZ3RoKSB7CiAgICAgICAgICAgICAgICBjb25zdCByZXQgPSBDMy5OZXcoQzMuTG9vcCwgdGhpcyk7CiAgICAgICAgICAgICAgICB0aGlzLl9zdGFjay5wdXNoKHJldCk7CiAgICAgICAgICAgICAgICByZXR1cm4gcmV0CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjb25zdCByZXQgPSB0aGlzLl9zdGFja1t0aGlzLl9pbmRleF07CiAgICAgICAgICAgICAgICByZXQuUmVzZXQoKTsKICAgICAgICAgICAgICAgIHJldHVybiByZXQKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBQb3AoKSB7CiAgICAgICAgICAgIC0tdGhpcy5faW5kZXgKICAgICAgICB9CiAgICAgICAgRmluZEJ5TmFtZShuYW1lKSB7CiAgICAgICAgICAgIGNvbnN0IHN0YWNrID0gdGhpcy5fc3RhY2s7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSB0aGlzLl9pbmRleDsgaSA+PSAwOyAtLWkpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGxvb3AgPSBzdGFja1tpXTsKICAgICAgICAgICAgICAgIGlmIChsb29wLkdldE5hbWUoKSA9PT0gbmFtZSkgcmV0dXJuIGxvb3AKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gbnVsbAogICAgICAgIH0KICAgICAgICBfR2V0U3RhY2soKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zdGFjay5zbGljZSgwLCB0aGlzLl9pbmRleCArIDEpCiAgICAgICAgfQogICAgfTsKCn0KCi8vIGV2ZW50cy9zdGFja3MvbG9vcC5qcwp7CiAgICAndXNlIHN0cmljdCc7CiAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICBDMy5Mb29wID0gY2xhc3MgTG9vcCBleHRlbmRzIEMzLkRlZmVuZGVkQmFzZSB7CiAgICAgICAgY29uc3RydWN0b3IobG9vcFN0YWNrKSB7CiAgICAgICAgICAgIHN1cGVyKCk7CiAgICAgICAgICAgIHRoaXMuX2xvb3BTdGFjayA9IGxvb3BTdGFjazsKICAgICAgICAgICAgdGhpcy5fbmFtZSA9ICIiOwogICAgICAgICAgICB0aGlzLl9pbmRleCA9IDA7CiAgICAgICAgICAgIHRoaXMuX2lzU3RvcHBlZCA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl9lbmQgPSBOYU4KICAgICAgICB9CiAgICAgICAgUmVzZXQoKSB7CiAgICAgICAgICAgIHRoaXMuX25hbWUgPSAiIjsKICAgICAgICAgICAgdGhpcy5faW5kZXggPSAwOwogICAgICAgICAgICB0aGlzLl9pc1N0b3BwZWQgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5fZW5kID0gTmFOCiAgICAgICAgfQogICAgICAgIFNldE5hbWUobmFtZSkgewogICAgICAgICAgICB0aGlzLl9uYW1lID0gbmFtZQogICAgICAgIH0KICAgICAgICBHZXROYW1lKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fbmFtZQogICAgICAgIH0KICAgICAgICBTZXRJbmRleChpKSB7CiAgICAgICAgICAgIHRoaXMuX2luZGV4ID0gaQogICAgICAgIH0KICAgICAgICBHZXRJbmRleCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2luZGV4CiAgICAgICAgfQogICAgICAgIFN0b3AoKSB7CiAgICAgICAgICAgIHRoaXMuX2lzU3RvcHBlZCA9IHRydWUKICAgICAgICB9CiAgICAgICAgSXNTdG9wcGVkKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faXNTdG9wcGVkCiAgICAgICAgfQogICAgICAgIFNldEVuZChlKSB7CiAgICAgICAgICAgIHRoaXMuX2VuZCA9IGUKICAgICAgICB9CiAgICAgICAgR2V0RW5kKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZW5kCiAgICAgICAgfQogICAgfTsKCn0KCi8vIGV2ZW50cy9zdGFja3MvYXJyYXlTdGFjay5qcwp7CiAgICAndXNlIHN0cmljdCc7CiAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICBDMy5BcnJheVN0YWNrID0gY2xhc3MgQXJyYXlTdGFjayBleHRlbmRzIEMzLkRlZmVuZGVkQmFzZSB7CiAgICAgICAgY29uc3RydWN0b3IoKSB7CiAgICAgICAgICAgIHN1cGVyKCk7CiAgICAgICAgICAgIHRoaXMuX3N0YWNrID0gW107CiAgICAgICAgICAgIHRoaXMuX2luZGV4ID0gLTEKICAgICAgICB9CiAgICAgICAgUmVsZWFzZSgpIHsKICAgICAgICAgICAgQzMuY2xlYXJBcnJheSh0aGlzLl9zdGFjaykKICAgICAgICB9CiAgICAgICAgR2V0Q3VycmVudCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3N0YWNrW3RoaXMuX2luZGV4XQogICAgICAgIH0KICAgICAgICBQdXNoKCkgewogICAgICAgICAgICArK3RoaXMuX2luZGV4OwogICAgICAgICAgICBpZiAodGhpcy5faW5kZXggPT09IHRoaXMuX3N0YWNrLmxlbmd0aCkgewogICAgICAgICAgICAgICAgY29uc3QgcmV0ID0gW107CiAgICAgICAgICAgICAgICB0aGlzLl9zdGFjay5wdXNoKHJldCk7CiAgICAgICAgICAgICAgICByZXR1cm4gcmV0CiAgICAgICAgICAgIH0gZWxzZSByZXR1cm4gdGhpcy5fc3RhY2tbdGhpcy5faW5kZXhdCiAgICAgICAgfQogICAgICAgIFBvcCgpIHsKICAgICAgICAgICAgLS10aGlzLl9pbmRleAogICAgICAgIH0KICAgIH07Cgp9CgovLyBldmVudHMvZXZlbnRTaGVldE1hbmFnZXIuanMKewogICAgJ3VzZSBzdHJpY3QnOwogICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgY29uc3QgYXNzZXJ0ID0gc2VsZi5hc3NlcnQ7CgogICAgZnVuY3Rpb24gU29ydFNvbEFycmF5KGEsIGIpIHsKICAgICAgICByZXR1cm4gYS5HZXRJbmRleCgpIC0gYi5HZXRJbmRleCgpCiAgICB9CgogICAgZnVuY3Rpb24gSXNTb2xBcnJheUlkZW50aWNhbChhLCBiKSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IGEubGVuZ3RoOyBpIDwgbGVuOyArK2kpCiAgICAgICAgICAgIGlmIChhW2ldICE9PSBiW2ldKSByZXR1cm4gZmFsc2U7CiAgICAgICAgcmV0dXJuIHRydWUKICAgIH0KICAgIEMzLkV2ZW50U2hlZXRNYW5hZ2VyID0gY2xhc3MgRXZlbnRTaGVldE1hbmFnZXIgZXh0ZW5kcyBDMy5EZWZlbmRlZEJhc2UgewogICAgICAgIGNvbnN0cnVjdG9yKHJ1bnRpbWUpIHsKICAgICAgICAgICAgc3VwZXIoKTsKICAgICAgICAgICAgdGhpcy5fcnVudGltZSA9IHJ1bnRpbWU7CiAgICAgICAgICAgIHRoaXMuX2FsbFNoZWV0cyA9IFtdOwogICAgICAgICAgICB0aGlzLl9zaGVldHNCeU5hbWUgPSBuZXcgTWFwOwogICAgICAgICAgICB0aGlzLl9hbGxHcm91cHMgPSBbXTsKICAgICAgICAgICAgdGhpcy5fZ3JvdXBzQnlOYW1lID0gbmV3IE1hcDsKICAgICAgICAgICAgdGhpcy5fYmxvY2tzQnlTaWQgPSBuZXcgTWFwOwogICAgICAgICAgICB0aGlzLl9jbmRzQnlTaWQgPSBuZXcgTWFwOwogICAgICAgICAgICB0aGlzLl9hY3RzQnlTaWQgPSBuZXcgTWFwOwogICAgICAgICAgICB0aGlzLl9hbGxVbmlxdWVTb2xNb2RpZmllcnMgPSBuZXcgTWFwOwogICAgICAgICAgICB0aGlzLl9ldmVudFZhcnNCeVNpZCA9IG5ldyBNYXA7CiAgICAgICAgICAgIHRoaXMuX25leHRMb2NhbFZhckluZGV4ID0gMDsKICAgICAgICAgICAgdGhpcy5fYWxsR2xvYmFsVmFycyA9IFtdOwogICAgICAgICAgICB0aGlzLl9hbGxMb2NhbFZhcnMgPSBbXTsKICAgICAgICAgICAgdGhpcy5fbG9jYWxWYXJJbml0aWFsVmFsdWVzID0gW107CiAgICAgICAgICAgIHRoaXMuX2Z1bmN0aW9uQmxvY2tzQnlOYW1lID0gbmV3IE1hcDsKICAgICAgICAgICAgdGhpcy5fY3VzdG9tQWN0aW9uQmxvY2tzTWFwID0KICAgICAgICAgICAgICAgIG5ldyBNYXA7CiAgICAgICAgICAgIHRoaXMuX2V2ZW50U3RhY2sgPSBDMy5OZXcoQzMuRXZlbnRTdGFjaywgdGhpcyk7CiAgICAgICAgICAgIHRoaXMuX2xvY2FsVmFyU3RhY2sgPSBDMy5OZXcoQzMuTG9jYWxWYXJTdGFjaywgdGhpcyk7CiAgICAgICAgICAgIHRoaXMuX2xvb3BTdGFjayA9IEMzLk5ldyhDMy5Mb29wU3RhY2ssIHRoaXMpOwogICAgICAgICAgICB0aGlzLl90cmlnZ2Vyc1RvUG9zdEluaXQgPSBbXTsKICAgICAgICAgICAgdGhpcy5fcXVldWVkVHJpZ2dlcnMgPSBbXTsKICAgICAgICAgICAgdGhpcy5fcXVldWVkRGVidWdUcmlnZ2VycyA9IFtdOwogICAgICAgICAgICB0aGlzLl9ydW5uaW5nRXZlbnRzRGVwdGggPSAwOwogICAgICAgICAgICB0aGlzLl9leGVjdXRpbmdUcmlnZ2VyRGVwdGggPSAwOwogICAgICAgICAgICB0aGlzLl9ibG9ja0ZsdXNoaW5nRGVwdGggPSAwOwogICAgICAgICAgICB0aGlzLl9zY2hlZHVsZWRXYWl0cyA9IFtdOwogICAgICAgICAgICB0aGlzLl9hc3luY0FjdGlvblByb21pc2VzID0gW107CiAgICAgICAgICAgIHNlbGZbImMzX2NhbGxGdW5jdGlvbiJdID0gKG5hbWUsIHBhcmFtcykgPT4gdGhpcy5fSW52b2tlRnVuY3Rpb25Gcm9tSlMobmFtZSwgcGFyYW1zKQogICAgICAgIH0KICAgICAgICBSZWxlYXNlKCkgewogICAgICAgICAgICB0aGlzLkNsZWFyQWxsU2NoZWR1bGVkV2FpdHMoKTsKICAgICAgICAgICAgdGhpcy5fZXZlbnRTdGFjay5SZWxlYXNlKCk7CiAgICAgICAgICAgIHRoaXMuX2V2ZW50U3RhY2sgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9sb2NhbFZhclN0YWNrLlJlbGVhc2UoKTsKICAgICAgICAgICAgdGhpcy5fbG9jYWxWYXJTdGFjayA9IG51bGw7CiAgICAgICAgICAgIEMzLmNsZWFyQXJyYXkodGhpcy5fcXVldWVkVHJpZ2dlcnMpOwogICAgICAgICAgICBDMy5jbGVhckFycmF5KHRoaXMuX3F1ZXVlZERlYnVnVHJpZ2dlcnMpOwogICAgICAgICAgICB0aGlzLl9ydW50aW1lID0gbnVsbDsKICAgICAgICAgICAgQzMuY2xlYXJBcnJheSh0aGlzLl9hbGxTaGVldHMpOwogICAgICAgICAgICB0aGlzLl9zaGVldHNCeU5hbWUuY2xlYXIoKQogICAgICAgIH0KICAgICAgICBDcmVhdGUoZXZlbnRTaGVldERhdGEpIHsKICAgICAgICAgICAgY29uc3QgZXZlbnRTaGVldCA9IEMzLk5ldyhDMy5FdmVudFNoZWV0LCB0aGlzLCBldmVudFNoZWV0RGF0YSk7CiAgICAgICAgICAgIHRoaXMuX2FsbFNoZWV0cy5wdXNoKGV2ZW50U2hlZXQpOwogICAgICAgICAgICB0aGlzLl9zaGVldHNCeU5hbWUuc2V0KGV2ZW50U2hlZXQuR2V0TmFtZSgpLnRvTG93ZXJDYXNlKCksIGV2ZW50U2hlZXQpCiAgICAgICAgfQogICAgICAgIF9BZGRUcmlnZ2VyVG9Qb3N0SW5pdCh0cmlnKSB7CiAgICAgICAgICAgIHRoaXMuX3RyaWdnZXJzVG9Qb3N0SW5pdC5wdXNoKHRyaWcpCiAgICAgICAgfQogICAgICAgIF9Qb3N0SW5pdCgpIHsKICAgICAgICAgICAgZm9yIChjb25zdCBjdXN0b21BY3Rpb25CbG9jayBvZiB0aGlzLl9jdXN0b21BY3Rpb25CbG9ja3NNYXAudmFsdWVzKCkpIGN1c3RvbUFjdGlvbkJsb2NrLl9DaGVja092ZXJyaWRlU3RhdGUoKTsKICAgICAgICAgICAgZm9yIChjb25zdCBmdW5jdGlvbkJsb2NrIG9mIHRoaXMuX2Z1bmN0aW9uQmxvY2tzQnlOYW1lLnZhbHVlcygpKSBmdW5jdGlvbkJsb2NrLl9Qb3N0SW5pdCgpOwogICAgICAgICAgICBmb3IgKGNvbnN0IGN1c3RvbUFjdGlvbkJsb2NrIG9mIHRoaXMuX2N1c3RvbUFjdGlvbkJsb2Nrc01hcC52YWx1ZXMoKSkgY3VzdG9tQWN0aW9uQmxvY2suX1Bvc3RJbml0KCk7CiAgICAgICAgICAgIGZvciAoY29uc3Qgc2hlZXQgb2YgdGhpcy5fYWxsU2hlZXRzKSBzaGVldC5fUG9zdEluaXQoKTsKICAgICAgICAgICAgZm9yIChjb25zdCBzaGVldCBvZiB0aGlzLl9hbGxTaGVldHMpIHNoZWV0Ll9VcGRhdGVEZWVwSW5jbHVkZXMoKTsKICAgICAgICAgICAgZm9yIChjb25zdCB0cmlnIG9mIHRoaXMuX3RyaWdnZXJzVG9Qb3N0SW5pdCkgdHJpZy5fUG9zdEluaXQoZmFsc2UpOwogICAgICAgICAgICBDMy5jbGVhckFycmF5KHRoaXMuX3RyaWdnZXJzVG9Qb3N0SW5pdCk7CiAgICAgICAgICAgIHRoaXMuX2xvY2FsVmFyU3RhY2suX1NldEluaXRpYWxWYWx1ZXModGhpcy5fbG9jYWxWYXJJbml0aWFsVmFsdWVzKQogICAgICAgIH0KICAgICAgICBHZXRSdW50aW1lKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fcnVudGltZQogICAgICAgIH0KICAgICAgICBHZXRFdmVudFNoZWV0QnlOYW1lKG5hbWUpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NoZWV0c0J5TmFtZS5nZXQobmFtZS50b0xvd2VyQ2FzZSgpKSB8fAogICAgICAgICAgICAgICAgbnVsbAogICAgICAgIH0KICAgICAgICBfUmVnaXN0ZXJHcm91cChncm91cCkgewogICAgICAgICAgICB0aGlzLl9hbGxHcm91cHMucHVzaChncm91cCk7CiAgICAgICAgICAgIHRoaXMuX2dyb3Vwc0J5TmFtZS5zZXQoZ3JvdXAuR2V0R3JvdXBOYW1lKCksIGdyb3VwKQogICAgICAgIH0KICAgICAgICBfUmVnaXN0ZXJFdmVudEJsb2NrKGV2ZW50QmxvY2spIHsKICAgICAgICAgICAgdGhpcy5fYmxvY2tzQnlTaWQuc2V0KGV2ZW50QmxvY2suR2V0U0lEKCksIGV2ZW50QmxvY2spCiAgICAgICAgfQogICAgICAgIF9SZWdpc3RlckNvbmRpdGlvbihjb25kaXRpb24pIHsKICAgICAgICAgICAgdGhpcy5fY25kc0J5U2lkLnNldChjb25kaXRpb24uR2V0U0lEKCksIGNvbmRpdGlvbikKICAgICAgICB9CiAgICAgICAgX1JlZ2lzdGVyQWN0aW9uKGFjdGlvbikgewogICAgICAgICAgICB0aGlzLl9hY3RzQnlTaWQuc2V0KGFjdGlvbi5HZXRTSUQoKSwgYWN0aW9uKQogICAgICAgIH0KICAgICAgICBfUmVnaXN0ZXJGdW5jdGlvbkJsb2NrKGZ1bmN0aW9uQmxvY2spIHsKICAgICAgICAgICAgc3dpdGNoIChmdW5jdGlvbkJsb2NrLkdldEZ1bmN0aW9uVHlwZSgpKSB7CiAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZnVuY3Rpb25CbG9ja3NCeU5hbWUuc2V0KGZ1bmN0aW9uQmxvY2suR2V0RnVuY3Rpb25OYW1lKCkudG9Mb3dlckNhc2UoKSwKICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb25CbG9jayk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY3VzdG9tQWN0aW9uQmxvY2tzTWFwLnNldChmdW5jdGlvbkJsb2NrLkdldEZ1bmN0aW9uTmFtZSgpLnRvTG93ZXJDYXNlKCksIGZ1bmN0aW9uQmxvY2spOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBfUmVnaXN0ZXJFdmVudFZhcmlhYmxlKGV2KSB7CiAgICAgICAgICAgIHRoaXMuX2V2ZW50VmFyc0J5U2lkLnNldChldi5HZXRTSUQoKSwgZXYpOwogICAgICAgICAgICBpZiAoZXYuSXNHbG9iYWwoKSkgdGhpcy5fYWxsR2xvYmFsVmFycy5wdXNoKGV2KTsKICAgICAgICAgICAgZWxzZSB0aGlzLl9hbGxMb2NhbFZhcnMucHVzaChldikKICAgICAgICB9CiAgICAgICAgX0RlZHVwbGljYXRlU29sTW9kaWZpZXJMaXN0KGFycikgewogICAgICAgICAgICBpZiAoYXJyLmxlbmd0aCA+PSAyKSBhcnIuc29ydChTb3J0U29sQXJyYXkpOwogICAgICAgICAgICBsZXQgY2FuZGlkYXRlTGlzdCA9IHRoaXMuX2FsbFVuaXF1ZVNvbE1vZGlmaWVycy5nZXQoYXJyLmxlbmd0aCk7CiAgICAgICAgICAgIGlmICghY2FuZGlkYXRlTGlzdCkgewogICAgICAgICAgICAgICAgY2FuZGlkYXRlTGlzdCA9IFtdOwogICAgICAgICAgICAgICAgdGhpcy5fYWxsVW5pcXVlU29sTW9kaWZpZXJzLnNldChhcnIubGVuZ3RoLCBjYW5kaWRhdGVMaXN0KQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciAobGV0IGkgPQogICAgICAgICAgICAgICAgICAgIDAsIGxlbiA9IGNhbmRpZGF0ZUxpc3QubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGNhbmRpZGF0ZSA9IGNhbmRpZGF0ZUxpc3RbaV07CiAgICAgICAgICAgICAgICBpZiAoSXNTb2xBcnJheUlkZW50aWNhbChhcnIsIGNhbmRpZGF0ZSkpIHJldHVybiBjYW5kaWRhdGUKICAgICAgICAgICAgfQogICAgICAgICAgICBjYW5kaWRhdGVMaXN0LnB1c2goYXJyKTsKICAgICAgICAgICAgcmV0dXJuIGFycgogICAgICAgIH0KICAgICAgICBfR2V0TmV4dExvY2FsVmFySW5kZXgoZXZlbnRWYXIpIHsKICAgICAgICAgICAgdGhpcy5fbG9jYWxWYXJJbml0aWFsVmFsdWVzLnB1c2goZXZlbnRWYXIuR2V0SW5pdGlhbFZhbHVlKCkpOwogICAgICAgICAgICByZXR1cm4gdGhpcy5fbmV4dExvY2FsVmFySW5kZXgrKwogICAgICAgIH0KICAgICAgICBHZXRFdmVudFN0YWNrKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZXZlbnRTdGFjawogICAgICAgIH0KICAgICAgICBHZXRDdXJyZW50RXZlbnRTdGFja0ZyYW1lKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5HZXRFdmVudFN0YWNrKCkuR2V0Q3VycmVudFN0YWNrRnJhbWUoKQogICAgICAgIH0KICAgICAgICBHZXRDdXJyZW50RXZlbnQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLkdldEN1cnJlbnRFdmVudFN0YWNrRnJhbWUoKS5HZXRDdXJyZW50RXZlbnQoKQogICAgICAgIH0KICAgICAgICBHZXRDdXJyZW50Q29uZGl0aW9uKCkgewogICAgICAgICAgICBjb25zdCBmcmFtZSA9CiAgICAgICAgICAgICAgICB0aGlzLkdldEN1cnJlbnRFdmVudFN0YWNrRnJhbWUoKTsKICAgICAgICAgICAgY29uc3QgZXZlbnQgPSBmcmFtZS5HZXRDdXJyZW50RXZlbnQoKTsKICAgICAgICAgICAgcmV0dXJuIGV2ZW50LkdldENvbmRpdGlvbkF0KGZyYW1lLkdldENvbmRpdGlvbkluZGV4KCkpCiAgICAgICAgfQogICAgICAgIEdldEN1cnJlbnRBY3Rpb24oKSB7CiAgICAgICAgICAgIGNvbnN0IGZyYW1lID0gdGhpcy5HZXRDdXJyZW50RXZlbnRTdGFja0ZyYW1lKCk7CiAgICAgICAgICAgIGNvbnN0IGV2ZW50ID0gZnJhbWUuR2V0Q3VycmVudEV2ZW50KCk7CiAgICAgICAgICAgIHJldHVybiBldmVudC5HZXRBY3Rpb25BdChmcmFtZS5HZXRBY3Rpb25JbmRleCgpKQogICAgICAgIH0KICAgICAgICBHZXRMb2NhbFZhclN0YWNrKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fbG9jYWxWYXJTdGFjawogICAgICAgIH0KICAgICAgICBHZXRMb29wU3RhY2soKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9sb29wU3RhY2sKICAgICAgICB9CiAgICAgICAgR2V0QWxsTG9jYWxWYXJpYWJsZXNJblNjb3BlKGZyb21Sb3cpIHsKICAgICAgICAgICAgY29uc3QgcmV0ID0gW107CiAgICAgICAgICAgIGZyb21Sb3cgPSBmcm9tUm93LkdldFNjb3BlUGFyZW50KCk7CiAgICAgICAgICAgIHdoaWxlIChmcm9tUm93KSB7CiAgICAgICAgICAgICAgICBDMy5hcHBlbmRBcnJheShyZXQsIGZyb21Sb3cuX0dldEFsbExvY2FsVmFyaWFibGVzSW5TY29wZSgpKTsKICAgICAgICAgICAgICAgIGZyb21Sb3cgPSBmcm9tUm93LkdldFNjb3BlUGFyZW50KCkKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcmV0CiAgICAgICAgfQogICAgICAgIF9HZXRMb2NhbFZhcmlhYmxlc1NjcmlwdEludGVyZmFjZShmcm9tUm93KSB7CiAgICAgICAgICAgIGNvbnN0IGxvY2FsVmFyRGVzY3JpcHRvcnMgPSB7fTsKICAgICAgICAgICAgZm9yIChjb25zdCB2IG9mIHRoaXMuR2V0QWxsTG9jYWxWYXJpYWJsZXNJblNjb3BlKGZyb21Sb3cpKSBsb2NhbFZhckRlc2NyaXB0b3JzW3YuR2V0SnNQcm9wTmFtZSgpXSA9IHYuX0dldFNjcmlwdEludGVyZmFjZURlc2NyaXB0b3IoKTsKICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5jcmVhdGUoT2JqZWN0LnByb3RvdHlwZSwgbG9jYWxWYXJEZXNjcmlwdG9ycykKICAgICAgICB9CiAgICAgICAgR2V0RXZlbnRWYXJpYWJsZUJ5U0lEKHNpZCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZXZlbnRWYXJzQnlTaWQuZ2V0KHNpZCkgfHwgbnVsbAogICAgICAgIH0KICAgICAgICBHZXRFdmVudEJsb2NrQnlTSUQoc2lkKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9ibG9ja3NCeVNpZC5nZXQoc2lkKSB8fCBudWxsCiAgICAgICAgfQogICAgICAgIEdldENvbmRpdGlvbkJ5U0lEKHNpZCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fY25kc0J5U2lkLmdldChzaWQpIHx8IG51bGwKICAgICAgICB9CiAgICAgICAgR2V0QWN0aW9uQnlTSUQoc2lkKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9hY3RzQnlTaWQuZ2V0KHNpZCkgfHwKICAgICAgICAgICAgICAgIG51bGwKICAgICAgICB9CiAgICAgICAgR2V0RnVuY3Rpb25CbG9ja0J5TmFtZShuYW1lKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9mdW5jdGlvbkJsb2Nrc0J5TmFtZS5nZXQobmFtZS50b0xvd2VyQ2FzZSgpKSB8fCBudWxsCiAgICAgICAgfQogICAgICAgIEdldEN1c3RvbUFjdGlvbkJsb2NrQnlOYW1lKG9iamVjdENsYXNzLCBuYW1lKSB7CiAgICAgICAgICAgIGxldCByZXQgPSB0aGlzLl9jdXN0b21BY3Rpb25CbG9ja3NNYXAuZ2V0KChvYmplY3RDbGFzcy5HZXROYW1lKCkgKyAiLiIgKyBuYW1lKS50b0xvd2VyQ2FzZSgpKTsKICAgICAgICAgICAgaWYgKHJldCkgcmV0dXJuIHJldDsKICAgICAgICAgICAgaWYgKCFvYmplY3RDbGFzcy5Jc0ZhbWlseSgpKQogICAgICAgICAgICAgICAgZm9yIChjb25zdCBmYW1pbHkgb2Ygb2JqZWN0Q2xhc3MuR2V0RmFtaWxpZXMoKSkgewogICAgICAgICAgICAgICAgICAgIHJldCA9IHRoaXMuX2N1c3RvbUFjdGlvbkJsb2Nrc01hcC5nZXQoKGZhbWlseS5HZXROYW1lKCkgKyAiLiIgKyBuYW1lKS50b0xvd2VyQ2FzZSgpKTsKICAgICAgICAgICAgICAgICAgICBpZiAocmV0KSByZXR1cm4gcmV0CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBudWxsCiAgICAgICAgfQogICAgICAgIEdldEFsbEdsb2JhbFZhcmlhYmxlcygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2FsbEdsb2JhbFZhcnMKICAgICAgICB9CiAgICAgICAgR2V0QWxsTG9jYWxWYXJpYWJsZXMoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9hbGxMb2NhbFZhcnMKICAgICAgICB9CiAgICAgICAgUmVzZXRBbGxHbG9iYWxzVG9Jbml0aWFsVmFsdWUoKSB7CiAgICAgICAgICAgIGZvciAoY29uc3QgZXYgb2YgdGhpcy5fYWxsR2xvYmFsVmFycykgZXYuUmVzZXRUb0luaXRpYWxWYWx1ZSgpCiAgICAgICAgfQogICAgICAgIEdldEV2ZW50R3JvdXBCeU5hbWUobmFtZSkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZ3JvdXBzQnlOYW1lLmdldChuYW1lLnRvTG93ZXJDYXNlKCkpIHx8CiAgICAgICAgICAgICAgICBudWxsCiAgICAgICAgfQogICAgICAgIEdldEV2ZW50R3JvdXBCeVNJRChzaWQpIHsKICAgICAgICAgICAgY29uc3QgZ3JvdXAgPSB0aGlzLl9ibG9ja3NCeVNpZC5nZXQoc2lkKTsKICAgICAgICAgICAgaWYgKGdyb3VwICYmIGdyb3VwLklzR3JvdXAoKSkgcmV0dXJuIGdyb3VwOwogICAgICAgICAgICBlbHNlIHJldHVybiBudWxsCiAgICAgICAgfQogICAgICAgIEdldEFsbEdyb3VwcygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2FsbEdyb3VwcwogICAgICAgIH0KICAgICAgICBSZXNldEFsbEdyb3Vwc0luaXRpYWxBY3RpdmF0aW9uKCkgewogICAgICAgICAgICBmb3IgKGNvbnN0IGdyb3VwIG9mIHRoaXMuX2FsbEdyb3VwcykgZ3JvdXAuUmVzZXRJbml0aWFsQWN0aXZhdGlvbigpCiAgICAgICAgfQogICAgICAgIF9SZXNldEFsbEhhc1J1bkZsYWdzKCkgewogICAgICAgICAgICBmb3IgKGNvbnN0IHNoZWV0IG9mIHRoaXMuX2FsbFNoZWV0cykgc2hlZXQuX1Jlc2V0SGFzUnVuRmxhZygpCiAgICAgICAgfQogICAgICAgIFJ1bkV2ZW50cyhsYXlvdXRNYW5hZ2VyKSB7CiAgICAgICAgICAgIHRoaXMuX1Jlc2V0QWxsSGFzUnVuRmxhZ3MoKTsKICAgICAgICAgICAgdGhpcy5fcnVubmluZ0V2ZW50c0RlcHRoKys7CiAgICAgICAgICAgIGZvciAoY29uc3QgbGF5b3V0IG9mIGxheW91dE1hbmFnZXIucnVubmluZ0xheW91dHMoKSkgewogICAgICAgICAgICAgICAgY29uc3QgZXZlbnRTaGVldCA9IGxheW91dC5HZXRFdmVudFNoZWV0KCk7CiAgICAgICAgICAgICAgICBpZiAoIWV2ZW50U2hlZXQpIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgdGhpcy5fcnVudGltZS5QdXNoQ3VycmVudExheW91dChsYXlvdXQpOwogICAgICAgICAgICAgICAgZXZlbnRTaGVldC5SdW4oKTsKICAgICAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuUG9wQ3VycmVudExheW91dCgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5fcnVubmluZ0V2ZW50c0RlcHRoLS0KICAgICAgICB9CiAgICAgICAgYXN5bmMgRGVidWdSdW5FdmVudHMobGF5b3V0TWFuYWdlcikgewogICAgICAgICAgICB0aGlzLl9SZXNldEFsbEhhc1J1bkZsYWdzKCk7CiAgICAgICAgICAgIHRoaXMuX3J1bm5pbmdFdmVudHNEZXB0aCsrOwogICAgICAgICAgICBmb3IgKGNvbnN0IGJyZWFrRXZlbnRPYmplY3Qgb2YgdGhpcy5fRGVidWdSdW5FdmVudHNHZW4obGF5b3V0TWFuYWdlcikpIGF3YWl0IHRoaXMuX3J1bnRpbWUuRGVidWdCcmVhayhicmVha0V2ZW50T2JqZWN0KTsKICAgICAgICAgICAgdGhpcy5fcnVubmluZ0V2ZW50c0RlcHRoLS0KICAgICAgICB9KiBfRGVidWdSdW5FdmVudHNHZW4obGF5b3V0TWFuYWdlcikgewogICAgICAgICAgICBmb3IgKGNvbnN0IGxheW91dCBvZiBsYXlvdXRNYW5hZ2VyLnJ1bm5pbmdMYXlvdXRzKCkpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGV2ZW50U2hlZXQgPSBsYXlvdXQuR2V0RXZlbnRTaGVldCgpOwogICAgICAgICAgICAgICAgaWYgKCFldmVudFNoZWV0KSBjb250aW51ZTsKICAgICAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuUHVzaEN1cnJlbnRMYXlvdXQobGF5b3V0KTsKICAgICAgICAgICAgICAgIHlpZWxkKiBldmVudFNoZWV0LkRlYnVnUnVuKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9ydW50aW1lLlBvcEN1cnJlbnRMYXlvdXQoKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIF9UcmlnZ2VyKGxheW91dE1hbmFnZXIsIG1ldGhvZCwgaW5zdCwgYmVoYXZpb3JUeXBlKSB7CiAgICAgICAgICAgIGxldCByZXQgPSBmYWxzZTsKICAgICAgICAgICAgaWYgKCFsYXlvdXRNYW5hZ2VyLkdldE1haW5SdW5uaW5nTGF5b3V0KCkpIHJldHVybiB0aGlzLlF1ZXVlVHJpZ2dlcihtZXRob2QsIGluc3QsIGJlaGF2aW9yVHlwZSk7CiAgICAgICAgICAgIHRoaXMuX2V4ZWN1dGluZ1RyaWdnZXJEZXB0aCsrOwogICAgICAgICAgICBmb3IgKGNvbnN0IGxheW91dCBvZiBsYXlvdXRNYW5hZ2VyLnJ1bm5pbmdMYXlvdXRzKCkpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGV2ZW50U2hlZXQgPSBsYXlvdXQuR2V0RXZlbnRTaGVldCgpOwogICAgICAgICAgICAgICAgaWYgKCFldmVudFNoZWV0KSBjb250aW51ZTsKICAgICAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuUHVzaEN1cnJlbnRMYXlvdXQobGF5b3V0KTsKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgaW5jbHVkZVNoZWV0IG9mIGV2ZW50U2hlZXQuZGVlcEluY2x1ZGVzKCkpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPQogICAgICAgICAgICAgICAgICAgICAgICBpbmNsdWRlU2hlZXQuX1RyaWdnZXIobWV0aG9kLCBpbnN0LCBiZWhhdmlvclR5cGUpOwogICAgICAgICAgICAgICAgICAgIHJldCA9IHJldCB8fCByZXN1bHQKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdDIgPSBldmVudFNoZWV0Ll9UcmlnZ2VyKG1ldGhvZCwgaW5zdCwgYmVoYXZpb3JUeXBlKTsKICAgICAgICAgICAgICAgIHJldCA9IHJldCB8fCByZXN1bHQyOwogICAgICAgICAgICAgICAgdGhpcy5fcnVudGltZS5Qb3BDdXJyZW50TGF5b3V0KCkKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLl9leGVjdXRpbmdUcmlnZ2VyRGVwdGgtLTsKICAgICAgICAgICAgcmV0dXJuIHJldAogICAgICAgIH0qIF9EZWJ1Z1RyaWdnZXIobGF5b3V0TWFuYWdlciwgbWV0aG9kLCBpbnN0LCBiZWhhdmlvclR5cGUpIHsKICAgICAgICAgICAgbGV0IHJldCA9IGZhbHNlOwogICAgICAgICAgICBpZiAoIWxheW91dE1hbmFnZXIuR2V0TWFpblJ1bm5pbmdMYXlvdXQoKSkgcmV0dXJuIHRoaXMuUXVldWVUcmlnZ2VyKG1ldGhvZCwgaW5zdCwgYmVoYXZpb3JUeXBlKTsKICAgICAgICAgICAgdGhpcy5fZXhlY3V0aW5nVHJpZ2dlckRlcHRoKys7CiAgICAgICAgICAgIGZvciAoY29uc3QgbGF5b3V0IG9mIGxheW91dE1hbmFnZXIucnVubmluZ0xheW91dHMoKSkgewogICAgICAgICAgICAgICAgY29uc3QgZXZlbnRTaGVldCA9IGxheW91dC5HZXRFdmVudFNoZWV0KCk7CiAgICAgICAgICAgICAgICBpZiAoIWV2ZW50U2hlZXQpIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgdGhpcy5fcnVudGltZS5QdXNoQ3VycmVudExheW91dChsYXlvdXQpOwogICAgICAgICAgICAgICAgZm9yIChjb25zdCBpbmNsdWRlU2hlZXQgb2YgZXZlbnRTaGVldC5kZWVwSW5jbHVkZXMoKSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHlpZWxkKiBpbmNsdWRlU2hlZXQuX0RlYnVnVHJpZ2dlcihtZXRob2QsIGluc3QsIGJlaGF2aW9yVHlwZSk7CiAgICAgICAgICAgICAgICAgICAgcmV0ID0gcmV0IHx8IHJlc3VsdAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0MiA9IHlpZWxkKiBldmVudFNoZWV0Ll9EZWJ1Z1RyaWdnZXIobWV0aG9kLCBpbnN0LCBiZWhhdmlvclR5cGUpOwogICAgICAgICAgICAgICAgcmV0ID0gcmV0IHx8IHJlc3VsdDI7CiAgICAgICAgICAgICAgICB0aGlzLl9ydW50aW1lLlBvcEN1cnJlbnRMYXlvdXQoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuX2V4ZWN1dGluZ1RyaWdnZXJEZXB0aC0tOwogICAgICAgICAgICByZXR1cm4gcmV0CiAgICAgICAgfQogICAgICAgIFF1ZXVlVHJpZ2dlcihtZXRob2QsIGluc3QsIGJlaGF2aW9yVHlwZSkgewogICAgICAgICAgICB0aGlzLl9xdWV1ZWRUcmlnZ2Vycy5wdXNoKFttZXRob2QsIGluc3QsIGJlaGF2aW9yVHlwZV0pOwogICAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICB9CiAgICAgICAgUXVldWVEZWJ1Z1RyaWdnZXIobWV0aG9kLCBpbnN0LCBiZWhhdmlvclR5cGUpIHsKICAgICAgICAgICAgbGV0IHJlc29sdmUgPQogICAgICAgICAgICAgICAgbnVsbDsKICAgICAgICAgICAgY29uc3QgcmV0ID0gbmV3IFByb21pc2UociA9PiByZXNvbHZlID0gcik7CiAgICAgICAgICAgIHRoaXMuX3F1ZXVlZERlYnVnVHJpZ2dlcnMucHVzaChbbWV0aG9kLCBpbnN0LCBiZWhhdmlvclR5cGUsIHJlc29sdmVdKTsKICAgICAgICAgICAgcmV0dXJuIHJldAogICAgICAgIH0qIF9SdW5RdWV1ZWREZWJ1Z1RyaWdnZXJzR2VuKCkgewogICAgICAgICAgICBpZiAodGhpcy5fcnVudGltZS5IaXRCcmVha3BvaW50KCkpIHRocm93IG5ldyBFcnJvcigic2hvdWxkIG5vdCBiZSBpbiBicmVha3BvaW50Iik7CiAgICAgICAgICAgIGNvbnN0IGxheW91dE1hbmFnZXIgPSB0aGlzLl9ydW50aW1lLkdldExheW91dE1hbmFnZXIoKTsKICAgICAgICAgICAgd2hpbGUgKHRoaXMuX3F1ZXVlZERlYnVnVHJpZ2dlcnMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICBjb25zdCBbbWV0aG9kLCBpbnN0LCBiZWhhdmlvclR5cGUsIHJlc29sdmVdID0gdGhpcy5fcXVldWVkRGVidWdUcmlnZ2Vycy5zaGlmdCgpOwogICAgICAgICAgICAgICAgY29uc3QgcmV0ID0geWllbGQqIHRoaXMuX0RlYnVnVHJpZ2dlcihsYXlvdXRNYW5hZ2VyLCBtZXRob2QsIGluc3QsIGJlaGF2aW9yVHlwZSk7CiAgICAgICAgICAgICAgICByZXNvbHZlKHJldCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBhc3luYyBSdW5RdWV1ZWREZWJ1Z1RyaWdnZXJzQXN5bmMoKSB7CiAgICAgICAgICAgIGZvciAoY29uc3QgYnJlYWtFdmVudE9iamVjdCBvZiB0aGlzLl9SdW5RdWV1ZWREZWJ1Z1RyaWdnZXJzR2VuKCkpIGF3YWl0IHRoaXMuX3J1bnRpbWUuRGVidWdCcmVhayhicmVha0V2ZW50T2JqZWN0KQogICAgICAgIH0KICAgICAgICBfRmFzdFRyaWdnZXIobGF5b3V0TWFuYWdlciwKICAgICAgICAgICAgbWV0aG9kLCBpbnN0LCB2YWx1ZSkgewogICAgICAgICAgICBsZXQgcmV0ID0gZmFsc2U7CiAgICAgICAgICAgIGNvbnN0IGxheW91dCA9IGxheW91dE1hbmFnZXIuR2V0TWFpblJ1bm5pbmdMYXlvdXQoKTsKICAgICAgICAgICAgY29uc3QgZXZlbnRTaGVldCA9IGxheW91dC5HZXRFdmVudFNoZWV0KCk7CiAgICAgICAgICAgIGlmICghZXZlbnRTaGVldCkgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl9leGVjdXRpbmdUcmlnZ2VyRGVwdGgrKzsKICAgICAgICAgICAgdGhpcy5fcnVudGltZS5QdXNoQ3VycmVudExheW91dChsYXlvdXQpOwogICAgICAgICAgICBjb25zdCBkZWVwSW5jbHVkZXMgPSBldmVudFNoZWV0LmRlZXBJbmNsdWRlcygpOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gZGVlcEluY2x1ZGVzLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7CiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSBkZWVwSW5jbHVkZXNbaV0uX0Zhc3RUcmlnZ2VyKG1ldGhvZCwgaW5zdCwgdmFsdWUpOwogICAgICAgICAgICAgICAgcmV0ID0gcmV0IHx8IHJlc3VsdAogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IHJlc3VsdDIgPSBldmVudFNoZWV0Ll9GYXN0VHJpZ2dlcihtZXRob2QsIGluc3QsIHZhbHVlKTsKICAgICAgICAgICAgcmV0ID0gcmV0IHx8IHJlc3VsdDI7CiAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuUG9wQ3VycmVudExheW91dCgpOwogICAgICAgICAgICB0aGlzLl9leGVjdXRpbmdUcmlnZ2VyRGVwdGgtLTsKICAgICAgICAgICAgcmV0dXJuIHJldAogICAgICAgIH0qIF9EZWJ1Z0Zhc3RUcmlnZ2VyKGxheW91dE1hbmFnZXIsIG1ldGhvZCwgaW5zdCwgdmFsdWUpIHsKICAgICAgICAgICAgbGV0IHJldCA9IGZhbHNlOwogICAgICAgICAgICBjb25zdCBsYXlvdXQgPSBsYXlvdXRNYW5hZ2VyLkdldE1haW5SdW5uaW5nTGF5b3V0KCk7CiAgICAgICAgICAgIGNvbnN0IGV2ZW50U2hlZXQgPSBsYXlvdXQuR2V0RXZlbnRTaGVldCgpOwogICAgICAgICAgICBpZiAoIWV2ZW50U2hlZXQpIHJldHVybjsKICAgICAgICAgICAgdGhpcy5fZXhlY3V0aW5nVHJpZ2dlckRlcHRoKys7CiAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuUHVzaEN1cnJlbnRMYXlvdXQobGF5b3V0KTsKICAgICAgICAgICAgY29uc3QgZGVlcEluY2x1ZGVzID0gZXZlbnRTaGVldC5kZWVwSW5jbHVkZXMoKTsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IGRlZXBJbmNsdWRlcy5sZW5ndGg7IGkgPCBsZW47ICsraSkgewogICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0geWllbGQqIGRlZXBJbmNsdWRlc1tpXS5fRGVidWdGYXN0VHJpZ2dlcihtZXRob2QsIGluc3QsIHZhbHVlKTsKICAgICAgICAgICAgICAgIHJldCA9IHJldCB8fCByZXN1bHQKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCByZXN1bHQyID0geWllbGQqIGV2ZW50U2hlZXQuX0RlYnVnRmFzdFRyaWdnZXIobWV0aG9kLCBpbnN0LCB2YWx1ZSk7CiAgICAgICAgICAgIHJldCA9IHJldCB8fCByZXN1bHQyOwogICAgICAgICAgICB0aGlzLl9ydW50aW1lLlBvcEN1cnJlbnRMYXlvdXQoKTsKICAgICAgICAgICAgdGhpcy5fZXhlY3V0aW5nVHJpZ2dlckRlcHRoLS07CiAgICAgICAgICAgIHJldHVybiByZXQKICAgICAgICB9CiAgICAgICAgR2V0VHJpZ2dlckRlcHRoKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZXhlY3V0aW5nVHJpZ2dlckRlcHRoCiAgICAgICAgfQogICAgICAgIElzSW5UcmlnZ2VyKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5HZXRUcmlnZ2VyRGVwdGgoKSA+IDAKICAgICAgICB9CiAgICAgICAgX0luY1RyaWdnZXJEZXB0aCgpIHsKICAgICAgICAgICAgcmV0dXJuICsrdGhpcy5fZXhlY3V0aW5nVHJpZ2dlckRlcHRoCiAgICAgICAgfQogICAgICAgIF9EZWNUcmlnZ2VyRGVwdGgoKSB7CiAgICAgICAgICAgIC0tdGhpcy5fZXhlY3V0aW5nVHJpZ2dlckRlcHRoCiAgICAgICAgfQogICAgICAgIElzUnVubmluZ0V2ZW50cygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3J1bm5pbmdFdmVudHNEZXB0aCA+IDAKICAgICAgICB9CiAgICAgICAgSXNJbkV2ZW50RW5naW5lKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5Jc1J1bm5pbmdFdmVudHMoKSB8fCB0aGlzLklzSW5UcmlnZ2VyKCkKICAgICAgICB9CiAgICAgICAgX1J1blF1ZXVlZFRyaWdnZXJzKGxheW91dE1hbmFnZXIpIHsKICAgICAgICAgICAgZm9yIChjb25zdCBbbWV0aG9kLCBpbnN0LCBiZWhhdmlvclR5cGVdIG9mIHRoaXMuX3F1ZXVlZFRyaWdnZXJzKSB0aGlzLl9UcmlnZ2VyKGxheW91dE1hbmFnZXIsCiAgICAgICAgICAgICAgICBtZXRob2QsIGluc3QsIGJlaGF2aW9yVHlwZSk7CiAgICAgICAgICAgIEMzLmNsZWFyQXJyYXkodGhpcy5fcXVldWVkVHJpZ2dlcnMpCiAgICAgICAgfQogICAgICAgIEJsb2NrRmx1c2hpbmdJbnN0YW5jZXMoZSkgewogICAgICAgICAgICBpZiAoZSkgdGhpcy5fYmxvY2tGbHVzaGluZ0RlcHRoKys7CiAgICAgICAgICAgIGVsc2UgdGhpcy5fYmxvY2tGbHVzaGluZ0RlcHRoLS0KICAgICAgICB9CiAgICAgICAgSXNGbHVzaGluZ0Jsb2NrZWQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9ibG9ja0ZsdXNoaW5nRGVwdGggPiAwCiAgICAgICAgfQogICAgICAgIENsZWFyU29sKHNvbE1vZGlmaWVycykgewogICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gc29sTW9kaWZpZXJzLmxlbmd0aDsgaSA8IGxlbjsgKytpKSBzb2xNb2RpZmllcnNbaV0uR2V0U29sU3RhY2soKS5DbGVhcigpCiAgICAgICAgfQogICAgICAgIFB1c2hDbGVhblNvbChzb2xNb2RpZmllcnMpIHsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IHNvbE1vZGlmaWVycy5sZW5ndGg7IGkgPCBsZW47ICsraSkgc29sTW9kaWZpZXJzW2ldLkdldFNvbFN0YWNrKCkuUHVzaENsZWFuKCkKICAgICAgICB9CiAgICAgICAgUHVzaENvcHlTb2woc29sTW9kaWZpZXJzKSB7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBzb2xNb2RpZmllcnMubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHNvbE1vZGlmaWVyc1tpXS5HZXRTb2xTdGFjaygpLlB1c2hDb3B5KCkKICAgICAgICB9CiAgICAgICAgUG9wU29sKHNvbE1vZGlmaWVycykgewogICAgICAgICAgICBmb3IgKGxldCBpID0KICAgICAgICAgICAgICAgICAgICAwLCBsZW4gPSBzb2xNb2RpZmllcnMubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHNvbE1vZGlmaWVyc1tpXS5HZXRTb2xTdGFjaygpLlBvcCgpCiAgICAgICAgfQogICAgICAgIEdldER5bmFtaWNTb2xNb2RpZmllcnNTZXQoc2tpcFNldCkgewogICAgICAgICAgICBjb25zdCByZXQgPSBuZXcgU2V0OwogICAgICAgICAgICBjb25zdCBhbGxTdGFja0ZyYW1lcyA9IHRoaXMuX2V2ZW50U3RhY2suR2V0QWxsU3RhY2tGcmFtZXMoKTsKICAgICAgICAgICAgY29uc3Qgc3RhY2tJbmRleCA9IHRoaXMuX2V2ZW50U3RhY2suR2V0Q3VycmVudFN0YWNrRnJhbWVJbmRleCgpOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8PSBzdGFja0luZGV4OyArK2kpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGR5bmFtaWNTb2xNb2RpZmllcnMgPSBhbGxTdGFja0ZyYW1lc1tpXS5HZXREeW5hbWljU29sTW9kaWZpZXJzKCk7CiAgICAgICAgICAgICAgICBpZiAoZHluYW1pY1NvbE1vZGlmaWVycykKICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHQgb2YgZHluYW1pY1NvbE1vZGlmaWVycykKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFza2lwU2V0IHx8ICFza2lwU2V0Lmhhcyh0KSkgcmV0LmFkZCh0KQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiByZXQKICAgICAgICB9CiAgICAgICAgUHVzaENsZWFuU29sRHluYW1pYyhleGlzdGluZ1NvbE1vZGlmaWVycykgewogICAgICAgICAgICBjb25zdCBleGlzdGluZ1NldCA9CiAgICAgICAgICAgICAgICBuZXcgU2V0KFsuLi5leGlzdGluZ1NvbE1vZGlmaWVyc10pOwogICAgICAgICAgICBjb25zdCBwdXNoU2V0ID0gdGhpcy5HZXREeW5hbWljU29sTW9kaWZpZXJzU2V0KGV4aXN0aW5nU2V0KTsKICAgICAgICAgICAgaWYgKHB1c2hTZXQuc2l6ZSA+IDApIHsKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgdCBvZiBwdXNoU2V0KSB0LkdldFNvbFN0YWNrKCkuUHVzaENsZWFuKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gWy4uLnB1c2hTZXRdCiAgICAgICAgICAgIH0gZWxzZSByZXR1cm4gbnVsbAogICAgICAgIH0KICAgICAgICBBZGRTY2hlZHVsZWRXYWl0KCkgewogICAgICAgICAgICBjb25zdCB3ID0gQzMuTmV3KEMzLlNjaGVkdWxlZFdhaXQsIHRoaXMpOwogICAgICAgICAgICB0aGlzLl9zY2hlZHVsZWRXYWl0cy5wdXNoKHcpOwogICAgICAgICAgICByZXR1cm4gdwogICAgICAgIH0KICAgICAgICBzY2hlZHVsZWRXYWl0cygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NjaGVkdWxlZFdhaXRzCiAgICAgICAgfQogICAgICAgIFJ1blNjaGVkdWxlZFdhaXRzKCkgewogICAgICAgICAgICBpZiAoIXRoaXMuX3NjaGVkdWxlZFdhaXRzLmxlbmd0aCkgcmV0dXJuOwogICAgICAgICAgICBjb25zdCBmcmFtZSA9IHRoaXMuR2V0Q3VycmVudEV2ZW50U3RhY2tGcmFtZSgpOwogICAgICAgICAgICBsZXQgZGlkQW55UnVuID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX3J1bm5pbmdFdmVudHNEZXB0aCsrOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMCwKICAgICAgICAgICAgICAgICAgICBsZW4gPSB0aGlzLl9zY2hlZHVsZWRXYWl0cy5sZW5ndGg7IGkgPCBsZW47ICsraSkgewogICAgICAgICAgICAgICAgY29uc3QgdyA9IHRoaXMuX3NjaGVkdWxlZFdhaXRzW2ldOwogICAgICAgICAgICAgICAgaWYgKHcuX1Nob3VsZFJ1bigpKSB3Ll9SdW4oZnJhbWUpOwogICAgICAgICAgICAgICAgaWYgKHcuU2hvdWxkUmVsZWFzZSgpKSBkaWRBbnlSdW4gPSB0cnVlCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGRpZEFueVJ1bikgewogICAgICAgICAgICAgICAgdGhpcy5fRmlsdGVyU2NoZWR1bGVkV2FpdHNUb1JlbGVhc2UoKTsKICAgICAgICAgICAgICAgIGZyYW1lLlJlc2V0KG51bGwpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5fcnVubmluZ0V2ZW50c0RlcHRoLS0KICAgICAgICB9CiAgICAgICAgYXN5bmMgRGVidWdSdW5TY2hlZHVsZWRXYWl0cygpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLl9zY2hlZHVsZWRXYWl0cy5sZW5ndGgpIHJldHVybjsKICAgICAgICAgICAgY29uc3QgZnJhbWUgPSB0aGlzLkdldEN1cnJlbnRFdmVudFN0YWNrRnJhbWUoKTsKICAgICAgICAgICAgbGV0IGRpZEFueVJ1biA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl9ydW5uaW5nRXZlbnRzRGVwdGgrKzsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IHRoaXMuX3NjaGVkdWxlZFdhaXRzLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7CiAgICAgICAgICAgICAgICBjb25zdCB3ID0gdGhpcy5fc2NoZWR1bGVkV2FpdHNbaV07CiAgICAgICAgICAgICAgICBpZiAody5fU2hvdWxkUnVuKCkpIGF3YWl0IHcuX0RlYnVnUnVuKGZyYW1lKTsKICAgICAgICAgICAgICAgIGlmICh3LlNob3VsZFJlbGVhc2UoKSkgZGlkQW55UnVuID0gdHJ1ZQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChkaWRBbnlSdW4pIHsKICAgICAgICAgICAgICAgIHRoaXMuX0ZpbHRlclNjaGVkdWxlZFdhaXRzVG9SZWxlYXNlKCk7CiAgICAgICAgICAgICAgICBmcmFtZS5SZXNldChudWxsKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuX3J1bm5pbmdFdmVudHNEZXB0aC0tCiAgICAgICAgfQogICAgICAgIF9GaWx0ZXJTY2hlZHVsZWRXYWl0c1RvUmVsZWFzZSgpIHsKICAgICAgICAgICAgY29uc3QgdG9SZWxlYXNlID0gQzMuYXJyYXlGaWx0ZXJPdXQodGhpcy5fc2NoZWR1bGVkV2FpdHMsIHcgPT4gdy5TaG91bGRSZWxlYXNlKCkpOwogICAgICAgICAgICBmb3IgKGNvbnN0IHcgb2YgdG9SZWxlYXNlKSB3LlJlbGVhc2UoKQogICAgICAgIH0KICAgICAgICBDbGVhckFsbFNjaGVkdWxlZFdhaXRzKCkgewogICAgICAgICAgICBmb3IgKGNvbnN0IHcgb2YgdGhpcy5fc2NoZWR1bGVkV2FpdHMpIHcuUmVsZWFzZSgpOwogICAgICAgICAgICBDMy5jbGVhckFycmF5KHRoaXMuX3NjaGVkdWxlZFdhaXRzKQogICAgICAgIH0KICAgICAgICBSZW1vdmVJbnN0YW5jZXNGcm9tU2NoZWR1bGVkV2FpdHMocykgewogICAgICAgICAgICBmb3IgKGNvbnN0IHcgb2YgdGhpcy5fc2NoZWR1bGVkV2FpdHMpIHcuUmVtb3ZlSW5zdGFuY2VzKHMpCiAgICAgICAgfQogICAgICAgIEFkZEFzeW5jQWN0aW9uUHJvbWlzZShwKSB7CiAgICAgICAgICAgIHRoaXMuX2FzeW5jQWN0aW9uUHJvbWlzZXMucHVzaChwKQogICAgICAgIH0KICAgICAgICBDbGVhckFzeW5jQWN0aW9uUHJvbWlzZXMoKSB7CiAgICAgICAgICAgIEMzLmNsZWFyQXJyYXkodGhpcy5fYXN5bmNBY3Rpb25Qcm9taXNlcykKICAgICAgICB9CiAgICAgICAgR2V0UHJvbWlzZUZvckFsbEFzeW5jQWN0aW9ucygpIHsKICAgICAgICAgICAgY29uc3QgcmV0ID0KICAgICAgICAgICAgICAgIFByb21pc2UuYWxsKHRoaXMuX2FzeW5jQWN0aW9uUHJvbWlzZXMpOwogICAgICAgICAgICB0aGlzLl9hc3luY0FjdGlvblByb21pc2VzID0gW107CiAgICAgICAgICAgIHJldHVybiByZXQKICAgICAgICB9CiAgICAgICAgX1NhdmVUb0pzb24oKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAiZ3JvdXBzIjogdGhpcy5fU2F2ZUdyb3Vwc1RvSnNvbigpLAogICAgICAgICAgICAgICAgImNuZHMiOiB0aGlzLl9TYXZlQ25kc1RvSnNvbigpLAogICAgICAgICAgICAgICAgImFjdHMiOiB0aGlzLl9TYXZlQWN0c1RvSnNvbigpLAogICAgICAgICAgICAgICAgInZhcnMiOiB0aGlzLl9TYXZlVmFyc1RvSnNvbigpLAogICAgICAgICAgICAgICAgIndhaXRzIjogdGhpcy5fU2F2ZVNjaGVkdWxlZFdhaXRzVG9Kc29uKCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBfTG9hZEZyb21Kc29uKG8pIHsKICAgICAgICAgICAgdGhpcy5fTG9hZEdyb3Vwc0Zyb21Kc29uKG9bImdyb3VwcyJdKTsKICAgICAgICAgICAgdGhpcy5fTG9hZENuZHNGcm9tSnNvbihvWyJjbmRzIl0pOwogICAgICAgICAgICB0aGlzLl9Mb2FkQWN0c0Zyb21Kc29uKG9bImFjdHMiXSk7CiAgICAgICAgICAgIHRoaXMuX0xvYWRWYXJzRnJvbUpzb24ob1sidmFycyJdKTsKICAgICAgICAgICAgdGhpcy5fTG9hZFNjaGVkdWxlZFdhaXRzRnJvbUpzb24ob1sid2FpdHMiXSkKICAgICAgICB9CiAgICAgICAgX1NhdmVHcm91cHNUb0pzb24oKSB7CiAgICAgICAgICAgIGNvbnN0IG8gPSB7fTsKICAgICAgICAgICAgZm9yIChjb25zdCBncm91cCBvZiB0aGlzLkdldEFsbEdyb3VwcygpKSBvW2dyb3VwLkdldFNJRCgpLnRvU3RyaW5nKCldID0KICAgICAgICAgICAgICAgIGdyb3VwLklzR3JvdXBBY3RpdmUoKTsKICAgICAgICAgICAgcmV0dXJuIG8KICAgICAgICB9CiAgICAgICAgX0xvYWRHcm91cHNGcm9tSnNvbihvKSB7CiAgICAgICAgICAgIGZvciAoY29uc3QgW3NpZFN0ciwgZGF0YV0gb2YgT2JqZWN0LmVudHJpZXMobykpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHNpZCA9IHBhcnNlSW50KHNpZFN0ciwgMTApOwogICAgICAgICAgICAgICAgY29uc3QgZ3JvdXAgPSB0aGlzLkdldEV2ZW50R3JvdXBCeVNJRChzaWQpOwogICAgICAgICAgICAgICAgaWYgKGdyb3VwKSBncm91cC5TZXRHcm91cEFjdGl2ZShkYXRhKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIF9TYXZlQ25kc1RvSnNvbigpIHsKICAgICAgICAgICAgY29uc3QgbyA9IHt9OwogICAgICAgICAgICBmb3IgKGNvbnN0IFtzaWQsIGNuZF0gb2YgdGhpcy5fY25kc0J5U2lkKSB7CiAgICAgICAgICAgICAgICBjb25zdCBkYXRhID0gY25kLl9TYXZlVG9Kc29uKCk7CiAgICAgICAgICAgICAgICBpZiAoZGF0YSkgb1tzaWQudG9TdHJpbmcoKV0gPSBkYXRhCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG8KICAgICAgICB9CiAgICAgICAgX0xvYWRDbmRzRnJvbUpzb24obykgewogICAgICAgICAgICBjb25zdCBtYXAgPSBuZXcgTWFwOwogICAgICAgICAgICBmb3IgKGNvbnN0IFtzaWRTdHIsIGRhdGFdIG9mIE9iamVjdC5lbnRyaWVzKG8pKSBtYXAuc2V0KHBhcnNlSW50KHNpZFN0ciwgMTApLCBkYXRhKTsKICAgICAgICAgICAgZm9yIChjb25zdCBbc2lkLCBjbmRdIG9mIHRoaXMuX2NuZHNCeVNpZCkgY25kLl9Mb2FkRnJvbUpzb24obWFwLmdldChzaWQpIHx8CiAgICAgICAgICAgICAgICBudWxsKQogICAgICAgIH0KICAgICAgICBfU2F2ZUFjdHNUb0pzb24oKSB7CiAgICAgICAgICAgIGNvbnN0IG8gPSB7fTsKICAgICAgICAgICAgZm9yIChjb25zdCBbc2lkLCBhY3RdIG9mIHRoaXMuX2FjdHNCeVNpZCkgewogICAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IGFjdC5fU2F2ZVRvSnNvbigpOwogICAgICAgICAgICAgICAgaWYgKGRhdGEpIG9bc2lkLnRvU3RyaW5nKCldID0gZGF0YQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBvCiAgICAgICAgfQogICAgICAgIF9Mb2FkQWN0c0Zyb21Kc29uKG8pIHsKICAgICAgICAgICAgY29uc3QgbWFwID0gbmV3IE1hcDsKICAgICAgICAgICAgZm9yIChjb25zdCBbc2lkU3RyLCBkYXRhXSBvZiBPYmplY3QuZW50cmllcyhvKSkgbWFwLnNldChwYXJzZUludChzaWRTdHIsIDEwKSwgZGF0YSk7CiAgICAgICAgICAgIGZvciAoY29uc3QgW3NpZCwgYWN0XSBvZiB0aGlzLl9hY3RzQnlTaWQpIGFjdC5fTG9hZEZyb21Kc29uKG1hcC5nZXQoc2lkKSB8fCBudWxsKQogICAgICAgIH0KICAgICAgICBfU2F2ZVZhcnNUb0pzb24oKSB7CiAgICAgICAgICAgIGNvbnN0IG8gPSB7fTsKICAgICAgICAgICAgZm9yIChjb25zdCBbc2lkLCBldmVudFZhcl0gb2YgdGhpcy5fZXZlbnRWYXJzQnlTaWQpCiAgICAgICAgICAgICAgICBpZiAoIWV2ZW50VmFyLklzQ29uc3RhbnQoKSAmJiAoZXZlbnRWYXIuSXNHbG9iYWwoKSB8fCBldmVudFZhci5Jc1N0YXRpYygpKSkgb1tzaWQudG9TdHJpbmcoKV0gPQogICAgICAgICAgICAgICAgICAgIGV2ZW50VmFyLkdldFZhbHVlKCk7CiAgICAgICAgICAgIHJldHVybiBvCiAgICAgICAgfQogICAgICAgIF9Mb2FkVmFyc0Zyb21Kc29uKG8pIHsKICAgICAgICAgICAgZm9yIChjb25zdCBbc2lkU3RyLCBkYXRhXSBvZiBPYmplY3QuZW50cmllcyhvKSkgewogICAgICAgICAgICAgICAgY29uc3Qgc2lkID0gcGFyc2VJbnQoc2lkU3RyLCAxMCk7CiAgICAgICAgICAgICAgICBjb25zdCBldmVudFZhciA9IHRoaXMuR2V0RXZlbnRWYXJpYWJsZUJ5U0lEKHNpZCk7CiAgICAgICAgICAgICAgICBpZiAoZXZlbnRWYXIpIGV2ZW50VmFyLlNldFZhbHVlKGRhdGEpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgX1NhdmVTY2hlZHVsZWRXYWl0c1RvSnNvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NjaGVkdWxlZFdhaXRzLmZpbHRlcih3ID0+ICF3LklzUHJvbWlzZSgpKS5tYXAodyA9PiB3Ll9TYXZlVG9Kc29uKCkpCiAgICAgICAgfQogICAgICAgIF9Mb2FkU2NoZWR1bGVkV2FpdHNGcm9tSnNvbihhcnIpIHsKICAgICAgICAgICAgdGhpcy5DbGVhckFsbFNjaGVkdWxlZFdhaXRzKCk7CiAgICAgICAgICAgIGZvciAoY29uc3QgZGF0YSBvZiBhcnIpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHN3ID0gQzMuU2NoZWR1bGVkV2FpdC5fQ3JlYXRlRnJvbUpzb24odGhpcywgZGF0YSk7CiAgICAgICAgICAgICAgICBpZiAoc3cpIHRoaXMuX3NjaGVkdWxlZFdhaXRzLnB1c2goc3cpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgX0dldFBlcmZSZWNvcmRzKCkgewogICAgICAgICAgICByZXR1cm4gWy4uLnRoaXMuX3J1bnRpbWUuR2V0TGF5b3V0TWFuYWdlcigpLnJ1bm5pbmdMYXlvdXRzKCldLm1hcChsID0+CiAgICAgICAgICAgICAgICBsLkdldEV2ZW50U2hlZXQoKSkuZmlsdGVyKGV2ZW50U2hlZXQgPT4gZXZlbnRTaGVldCkubWFwKGUgPT4gZS5fR2V0UGVyZlJlY29yZCgpKQogICAgICAgIH0KICAgICAgICBGaW5kRmlyc3RGdW5jdGlvbkJsb2NrUGFyZW50KHBhcmVudCkgewogICAgICAgICAgICB3aGlsZSAocGFyZW50KSB7CiAgICAgICAgICAgICAgICBjb25zdCBzY29wZVBhcmVudCA9IHBhcmVudC5HZXRTY29wZVBhcmVudCgpOwogICAgICAgICAgICAgICAgaWYgKHNjb3BlUGFyZW50IGluc3RhbmNlb2YgQzMuRnVuY3Rpb25CbG9jaykgcmV0dXJuIHNjb3BlUGFyZW50OwogICAgICAgICAgICAgICAgcGFyZW50ID0gc2NvcGVQYXJlbnQKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gbnVsbAogICAgICAgIH0KICAgICAgICBfSW52b2tlRnVuY3Rpb25Gcm9tSlMobmFtZSwgcGFyYW1zKSB7CiAgICAgICAgICAgIGlmICghQXJyYXkuaXNBcnJheShwYXJhbXMpKSBwYXJhbXMgPSBbXTsKICAgICAgICAgICAgY29uc3QgZnVuY3Rpb25CbG9jayA9IHRoaXMuR2V0RnVuY3Rpb25CbG9ja0J5TmFtZShuYW1lLnRvTG93ZXJDYXNlKCkpOwogICAgICAgICAgICBpZiAoIWZ1bmN0aW9uQmxvY2spIHJldHVybiBudWxsOwogICAgICAgICAgICBpZiAoIWZ1bmN0aW9uQmxvY2suSXNFbmFibGVkKCkpIHJldHVybiBmdW5jdGlvbkJsb2NrLkdldERlZmF1bHRSZXR1cm5WYWx1ZSgpOwogICAgICAgICAgICBjb25zdCBmdW5jdGlvblBhcmFtZXRlcnMgPSBmdW5jdGlvbkJsb2NrLkdldEZ1bmN0aW9uUGFyYW1ldGVycygpOwogICAgICAgICAgICBpZiAocGFyYW1zLmxlbmd0aCA8IGZ1bmN0aW9uUGFyYW1ldGVycy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIHBhcmFtcyA9IHBhcmFtcy5zbGljZSgwKTsKICAgICAgICAgICAgICAgIGRvIHBhcmFtcy5wdXNoKGZ1bmN0aW9uUGFyYW1ldGVyc1twYXJhbXMubGVuZ3RoXS5HZXRJbml0aWFsVmFsdWUoKSk7IHdoaWxlIChwYXJhbXMubGVuZ3RoIDwgZnVuY3Rpb25QYXJhbWV0ZXJzLmxlbmd0aCkKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBjYWxsRXZlbnRCbG9jayA9IGZ1bmN0aW9uQmxvY2suR2V0RXZlbnRCbG9jaygpOwogICAgICAgICAgICByZXR1cm4gY2FsbEV2ZW50QmxvY2suUnVuQXNFeHByZXNzaW9uRnVuY3Rpb25DYWxsKGNhbGxFdmVudEJsb2NrLkdldFNvbE1vZGlmaWVyc0luY2x1ZGluZ1BhcmVudHMoKSwgZmFsc2UsIGZ1bmN0aW9uQmxvY2suR2V0UmV0dXJuVHlwZSgpLCBmdW5jdGlvbkJsb2NrLkdldERlZmF1bHRSZXR1cm5WYWx1ZSgpLCAuLi5wYXJhbXMpCiAgICAgICAgfQogICAgfTsKCn0KCi8vIGV2ZW50cy9ldmVudFNoZWV0LmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIEMzLkV2ZW50U2hlZXQgPSBjbGFzcyBFdmVudFNoZWV0IGV4dGVuZHMgQzMuRGVmZW5kZWRCYXNlIHsKICAgICAgICBjb25zdHJ1Y3RvcihldmVudFNoZWV0TWFuYWdlciwgZGF0YSkgewogICAgICAgICAgICBzdXBlcigpOwogICAgICAgICAgICB0aGlzLl9ldmVudFNoZWV0TWFuYWdlciA9IGV2ZW50U2hlZXRNYW5hZ2VyOwogICAgICAgICAgICB0aGlzLl9ydW50aW1lID0gZXZlbnRTaGVldE1hbmFnZXIuR2V0UnVudGltZSgpOwogICAgICAgICAgICB0aGlzLl9uYW1lID0gZGF0YVswXTsKICAgICAgICAgICAgdGhpcy5fZXZlbnRzID0gW107CiAgICAgICAgICAgIHRoaXMuX3RyaWdnZXJzID0gbmV3IE1hcDsKICAgICAgICAgICAgdGhpcy5fZmFzdFRyaWdnZXJzID0gbmV3IE1hcDsKICAgICAgICAgICAgdGhpcy5fZXZlbnRzQnlEaXNwbGF5TnVtYmVyID0gbmV3IE1hcDsKICAgICAgICAgICAgdGhpcy5faGFzUnVuID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX3NoYWxsb3dJbmNsdWRlcyA9IFtdOwogICAgICAgICAgICB0aGlzLl9kZWVwSW5jbHVkZXMgPSBbXTsKICAgICAgICAgICAgdGhpcy5fYWxyZWFkeUluY2x1ZGVkU2hlZXRzID0gbmV3IFNldDsKICAgICAgICAgICAgZm9yIChjb25zdCBldmVudERhdGEgb2YgZGF0YVsxXSkgdGhpcy5fQ3JlYXRlRXZlbnQoZXZlbnREYXRhLCBudWxsLCB0aGlzLl9ldmVudHMpOwogICAgICAgICAgICB0aGlzLl9wZXJmUmVjb3JkID0KICAgICAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuSXNEZWJ1ZygpID8gewogICAgICAgICAgICAgICAgICAgIHR5cGU6ICJzaGVldCIsCiAgICAgICAgICAgICAgICAgICAgbmFtZTogdGhpcy5fbmFtZSwKICAgICAgICAgICAgICAgICAgICB0b3RhbFRpbWVDb3VudGVyOiAwLAogICAgICAgICAgICAgICAgICAgIGNoaWxkcmVuOiBbXQogICAgICAgICAgICAgICAgfSA6IG51bGwKICAgICAgICB9CiAgICAgICAgUmVsZWFzZSgpIHsKICAgICAgICAgICAgdGhpcy5fZXZlbnRTaGVldE1hbmFnZXIgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9ydW50aW1lID0gbnVsbAogICAgICAgIH0KICAgICAgICBfQ3JlYXRlRXZlbnQoZXZlbnREYXRhLCBwYXJlbnQsIG5vbnRyaWdnZXJzKSB7CiAgICAgICAgICAgIHN3aXRjaCAoZXZlbnREYXRhWzBdKSB7CiAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fQ3JlYXRlRXZlbnRCbG9jayhldmVudERhdGEsIHBhcmVudCwgbm9udHJpZ2dlcnMpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgICAgIHRoaXMuX0NyZWF0ZUV2ZW50VmFyaWFibGUoZXZlbnREYXRhLCBwYXJlbnQsIG5vbnRyaWdnZXJzKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgICAgICB0aGlzLl9DcmVhdGVJbmNsdWRlKGV2ZW50RGF0YSwgcGFyZW50LCBub250cmlnZ2Vycyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fQ3JlYXRlRnVuY3Rpb25CbG9jayhldmVudERhdGEsIHBhcmVudCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fQ3JlYXRlU2NyaXB0QmxvY2soZXZlbnREYXRhLAogICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnQsIG5vbnRyaWdnZXJzKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICAgICAgICB0aGlzLl9DcmVhdGVDdXN0b21BQ0VCbG9jayhldmVudERhdGEsIHBhcmVudCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiaW52YWxpZCBldmVudCB0eXBlIik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgX0NyZWF0ZUV2ZW50QmxvY2soZGF0YSwgcGFyZW50LCBub250cmlnZ2VycykgewogICAgICAgICAgICBjb25zdCBldmVudEJsb2NrID0gQzMuRXZlbnRCbG9jay5DcmVhdGUodGhpcywgcGFyZW50LCBkYXRhKTsKICAgICAgICAgICAgaWYgKGV2ZW50QmxvY2suSXNPckJsb2NrKCkpIHsKICAgICAgICAgICAgICAgIG5vbnRyaWdnZXJzLnB1c2goZXZlbnRCbG9jayk7CiAgICAgICAgICAgICAgICBjb25zdCBjb25kaXRpb25zID0gZXZlbnRCbG9jay5HZXRDb25kaXRpb25zKCk7CiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gY29uZGl0aW9ucy5sZW5ndGg7IGkgPCBsZW47ICsraSkKICAgICAgICAgICAgICAgICAgICBpZiAoY29uZGl0aW9uc1tpXS5Jc1RyaWdnZXIoKSkgdGhpcy5fSW5pdFRyaWdnZXIoZXZlbnRCbG9jaywgaSkKICAgICAgICAgICAgfSBlbHNlIGlmIChldmVudEJsb2NrLklzVHJpZ2dlcigpKSB0aGlzLl9Jbml0VHJpZ2dlcihldmVudEJsb2NrLCAwKTsKICAgICAgICAgICAgZWxzZSBub250cmlnZ2Vycy5wdXNoKGV2ZW50QmxvY2spCiAgICAgICAgfQogICAgICAgIF9DcmVhdGVGdW5jdGlvbkJsb2NrKGRhdGEsCiAgICAgICAgICAgIHBhcmVudCkgewogICAgICAgICAgICBjb25zdCBmdW5jdGlvbkJsb2NrID0gQzMuRnVuY3Rpb25CbG9jay5DcmVhdGVGdW5jdGlvbkJsb2NrKHRoaXMsIHBhcmVudCwgZGF0YSk7CiAgICAgICAgICAgIHRoaXMuX2V2ZW50U2hlZXRNYW5hZ2VyLl9SZWdpc3RlckZ1bmN0aW9uQmxvY2soZnVuY3Rpb25CbG9jaykKICAgICAgICB9CiAgICAgICAgX0NyZWF0ZUN1c3RvbUFDRUJsb2NrKGRhdGEsIHBhcmVudCkgewogICAgICAgICAgICBjb25zdCBjdXN0b21BY2VCbG9jayA9IEMzLkZ1bmN0aW9uQmxvY2suQ3JlYXRlQ3VzdG9tQUNFQmxvY2sodGhpcywgcGFyZW50LCBkYXRhKTsKICAgICAgICAgICAgdGhpcy5fZXZlbnRTaGVldE1hbmFnZXIuX1JlZ2lzdGVyRnVuY3Rpb25CbG9jayhjdXN0b21BY2VCbG9jaykKICAgICAgICB9CiAgICAgICAgX0NyZWF0ZUV2ZW50VmFyaWFibGUoZGF0YSwgcGFyZW50LCBub250cmlnZ2VycykgewogICAgICAgICAgICBjb25zdCB2ID0gQzMuRXZlbnRWYXJpYWJsZS5DcmVhdGUodGhpcywgcGFyZW50LCBkYXRhKTsKICAgICAgICAgICAgbm9udHJpZ2dlcnMucHVzaCh2KQogICAgICAgIH0KICAgICAgICBfQ3JlYXRlSW5jbHVkZShkYXRhLCBwYXJlbnQsIG5vbnRyaWdnZXJzKSB7CiAgICAgICAgICAgIGNvbnN0IGluY2x1ZGUgPSBDMy5FdmVudEluY2x1ZGUuQ3JlYXRlKHRoaXMsCiAgICAgICAgICAgICAgICBwYXJlbnQsIGRhdGEpOwogICAgICAgICAgICBub250cmlnZ2Vycy5wdXNoKGluY2x1ZGUpCiAgICAgICAgfQogICAgICAgIF9DcmVhdGVTY3JpcHRCbG9jayhkYXRhLCBwYXJlbnQsIG5vbnRyaWdnZXJzKSB7CiAgICAgICAgICAgIGNvbnN0IHNjcmlwdEJsb2NrID0gQzMuRXZlbnRTY3JpcHQuQ3JlYXRlKHRoaXMsIHBhcmVudCwgZGF0YSk7CiAgICAgICAgICAgIG5vbnRyaWdnZXJzLnB1c2goc2NyaXB0QmxvY2spCiAgICAgICAgfQogICAgICAgIF9Jbml0VHJpZ2dlcihldmVudEJsb2NrLCBpKSB7CiAgICAgICAgICAgIGlmICghZXZlbnRCbG9jay5Jc09yQmxvY2soKSkgdGhpcy5fZXZlbnRTaGVldE1hbmFnZXIuX0FkZFRyaWdnZXJUb1Bvc3RJbml0KGV2ZW50QmxvY2spOwogICAgICAgICAgICBjb25zdCBjbmQgPSBldmVudEJsb2NrLkdldENvbmRpdGlvbkF0KGkpOwogICAgICAgICAgICBjb25zdCBmdW5jID0gY25kLl9HZXRGdW5jKCk7CiAgICAgICAgICAgIGNvbnN0IG9iamVjdENsYXNzID0gY25kLkdldE9iamVjdENsYXNzKCk7CiAgICAgICAgICAgIGlmIChjbmQuSXNGYXN0VHJpZ2dlcigpKSB7CiAgICAgICAgICAgICAgICBsZXQgbWV0aG9kTWFwID0gdGhpcy5fZmFzdFRyaWdnZXJzLmdldChvYmplY3RDbGFzcyk7CiAgICAgICAgICAgICAgICBpZiAoIW1ldGhvZE1hcCkgewogICAgICAgICAgICAgICAgICAgIG1ldGhvZE1hcCA9IG5ldyBNYXA7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZmFzdFRyaWdnZXJzLnNldChvYmplY3RDbGFzcywKICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kTWFwKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBjbmQuR2V0RmFzdFRyaWdnZXJWYWx1ZSgpLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgICAgICBsZXQgdmFsdWVNYXAgPSBtZXRob2RNYXAuZ2V0KGZ1bmMpOwogICAgICAgICAgICAgICAgaWYgKCF2YWx1ZU1hcCkgewogICAgICAgICAgICAgICAgICAgIHZhbHVlTWFwID0gbmV3IE1hcDsKICAgICAgICAgICAgICAgICAgICBtZXRob2RNYXAuc2V0KGZ1bmMsIHZhbHVlTWFwKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbGV0IHRyaWdnZXJBcnIgPSB2YWx1ZU1hcC5nZXQodmFsdWUpOwogICAgICAgICAgICAgICAgaWYgKCF0cmlnZ2VyQXJyKSB7CiAgICAgICAgICAgICAgICAgICAgdHJpZ2dlckFyciA9IFtdOwogICAgICAgICAgICAgICAgICAgIHZhbHVlTWFwLnNldCh2YWx1ZSwgdHJpZ2dlckFycikKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRyaWdnZXJBcnIucHVzaChbZXZlbnRCbG9jaywgaV0pCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBsZXQgb2NJbmZvID0gdGhpcy5fdHJpZ2dlcnMuZ2V0KG9iamVjdENsYXNzKTsKICAgICAgICAgICAgICAgIGlmICghb2NJbmZvKSB7CiAgICAgICAgICAgICAgICAgICAgb2NJbmZvID0gewogICAgICAgICAgICAgICAgICAgICAgICBtZXRob2RNYXA6IG5ldyBNYXAsCiAgICAgICAgICAgICAgICAgICAgICAgIGJlaGF2aW9yczogbmV3IE1hcAogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdHJpZ2dlcnMuc2V0KG9iamVjdENsYXNzLCBvY0luZm8pCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjb25zdCBiZWhhdmlvclR5cGUgPSBjbmQuR2V0QmVoYXZpb3JUeXBlKCk7CiAgICAgICAgICAgICAgICBsZXQgbWV0aG9kTWFwOwogICAgICAgICAgICAgICAgaWYgKGJlaGF2aW9yVHlwZSkgewogICAgICAgICAgICAgICAgICAgIG1ldGhvZE1hcCA9CiAgICAgICAgICAgICAgICAgICAgICAgIG9jSW5mby5iZWhhdmlvcnMuZ2V0KGJlaGF2aW9yVHlwZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFtZXRob2RNYXApIHsKICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kTWFwID0gbmV3IE1hcDsKICAgICAgICAgICAgICAgICAgICAgICAgb2NJbmZvLmJlaGF2aW9ycy5zZXQoYmVoYXZpb3JUeXBlLCBtZXRob2RNYXApCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIG1ldGhvZE1hcCA9IG9jSW5mby5tZXRob2RNYXA7CiAgICAgICAgICAgICAgICBsZXQgdHJpZ2dlckFyciA9IG1ldGhvZE1hcC5nZXQoZnVuYyk7CiAgICAgICAgICAgICAgICBpZiAoIXRyaWdnZXJBcnIpIHsKICAgICAgICAgICAgICAgICAgICB0cmlnZ2VyQXJyID0gW107CiAgICAgICAgICAgICAgICAgICAgbWV0aG9kTWFwLnNldChmdW5jLCB0cmlnZ2VyQXJyKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdHJpZ2dlckFyci5wdXNoKFtldmVudEJsb2NrLCBpXSkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBfUG9zdEluaXQoKSB7CiAgICAgICAgICAgIGNvbnN0IGV2ZW50cyA9IHRoaXMuX2V2ZW50czsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IGV2ZW50cy5sZW5ndGg7IGkgPCBsZW47ICsraSkgewogICAgICAgICAgICAgICAgY29uc3QgaGFzRWxzZUJsb2NrID0gaSA8IGxlbiAtIDEgJiYgZXZlbnRzW2kgKyAxXSBpbnN0YW5jZW9mIEMzLkV2ZW50QmxvY2sgJiYgZXZlbnRzW2kgKyAxXS5Jc0Vsc2VCbG9jaygpOwogICAgICAgICAgICAgICAgZXZlbnRzW2ldLl9Qb3N0SW5pdChoYXNFbHNlQmxvY2spCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgX0FkZFNoYWxsb3dJbmNsdWRlKGluY2x1ZGUpIHsKICAgICAgICAgICAgdGhpcy5fc2hhbGxvd0luY2x1ZGVzLnB1c2goaW5jbHVkZSkKICAgICAgICB9CiAgICAgICAgX1VwZGF0ZURlZXBJbmNsdWRlcygpIHsKICAgICAgICAgICAgQzMuY2xlYXJBcnJheSh0aGlzLl9kZWVwSW5jbHVkZXMpOwogICAgICAgICAgICB0aGlzLl9BZGREZWVwSW5jbHVkZXModGhpcyk7CiAgICAgICAgICAgIHRoaXMuX2FscmVhZHlJbmNsdWRlZFNoZWV0cy5jbGVhcigpCiAgICAgICAgfQogICAgICAgIF9BZGREZWVwSW5jbHVkZXMocm9vdFNoZWV0KSB7CiAgICAgICAgICAgIGNvbnN0IGRlZXBJbmNsdWRlcyA9IHJvb3RTaGVldC5fZGVlcEluY2x1ZGVzOwogICAgICAgICAgICBjb25zdCBhbHJlYWR5SW5jbHVkZWRTaGVldHMgPSByb290U2hlZXQuX2FscmVhZHlJbmNsdWRlZFNoZWV0czsKICAgICAgICAgICAgZm9yIChjb25zdCBpbmNsdWRlIG9mIHRoaXMuX3NoYWxsb3dJbmNsdWRlcykgewogICAgICAgICAgICAgICAgY29uc3Qgc2hlZXQgPSBpbmNsdWRlLkdldEluY2x1ZGVTaGVldCgpOwogICAgICAgICAgICAgICAgaWYgKCFpbmNsdWRlLklzQWN0aXZlKCkgfHwgcm9vdFNoZWV0ID09PSBzaGVldCB8fCBhbHJlYWR5SW5jbHVkZWRTaGVldHMuaGFzKHNoZWV0KSkgY29udGludWU7CiAgICAgICAgICAgICAgICBhbHJlYWR5SW5jbHVkZWRTaGVldHMuYWRkKHNoZWV0KTsKICAgICAgICAgICAgICAgIHNoZWV0Ll9BZGREZWVwSW5jbHVkZXMocm9vdFNoZWV0KTsKICAgICAgICAgICAgICAgIGRlZXBJbmNsdWRlcy5wdXNoKHNoZWV0KQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGRlZXBJbmNsdWRlcygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2RlZXBJbmNsdWRlcwogICAgICAgIH0KICAgICAgICBHZXRFdmVudFNoZWV0TWFuYWdlcigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2V2ZW50U2hlZXRNYW5hZ2VyCiAgICAgICAgfQogICAgICAgIEdldFJ1bnRpbWUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lCiAgICAgICAgfQogICAgICAgIEdldE5hbWUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9uYW1lCiAgICAgICAgfQogICAgICAgIF9SZWdpc3RlckV2ZW50QnlEaXNwbGF5TnVtYmVyKGV2ZW50QmxvY2ssCiAgICAgICAgICAgIGRpc3BsYXlOdW1iZXIpIHsKICAgICAgICAgICAgdGhpcy5fZXZlbnRzQnlEaXNwbGF5TnVtYmVyLnNldChkaXNwbGF5TnVtYmVyLCBldmVudEJsb2NrKQogICAgICAgIH0KICAgICAgICBfR2V0RXZlbnRCeURpc3BsYXlOdW1iZXIoZGlzcGxheU51bWJlcikgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZXZlbnRzQnlEaXNwbGF5TnVtYmVyLmdldChkaXNwbGF5TnVtYmVyKSB8fCBudWxsCiAgICAgICAgfQogICAgICAgIF9SZXNldEhhc1J1bkZsYWcoKSB7CiAgICAgICAgICAgIHRoaXMuX2hhc1J1biA9IGZhbHNlCiAgICAgICAgfQogICAgICAgIFJ1bigpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX2hhc1J1bikgcmV0dXJuOwogICAgICAgICAgICBjb25zdCBydW50aW1lID0gdGhpcy5fcnVudGltZTsKICAgICAgICAgICAgY29uc3QgcHJvZmlsZSA9IHJ1bnRpbWUuSXNDUFVQcm9maWxpbmcoKTsKICAgICAgICAgICAgY29uc3Qgc3RhcnRUaW1lID0gcHJvZmlsZSA/IHBlcmZvcm1hbmNlLm5vdygpIDogMDsKICAgICAgICAgICAgdGhpcy5faGFzUnVuID0gdHJ1ZTsKICAgICAgICAgICAgY29uc3QgZXZlbnRTaGVldE1hbmFnZXIgPSB0aGlzLkdldEV2ZW50U2hlZXRNYW5hZ2VyKCk7CiAgICAgICAgICAgIGNvbnN0IGZyYW1lID0gZXZlbnRTaGVldE1hbmFnZXIuR2V0Q3VycmVudEV2ZW50U3RhY2tGcmFtZSgpOwogICAgICAgICAgICBmb3IgKGNvbnN0IGUgb2YgdGhpcy5fZXZlbnRzKSB7CiAgICAgICAgICAgICAgICBlLlJ1bihmcmFtZSk7CiAgICAgICAgICAgICAgICBldmVudFNoZWV0TWFuYWdlci5DbGVhclNvbChlLkdldFNvbE1vZGlmaWVycygpKTsKICAgICAgICAgICAgICAgIGV2ZW50U2hlZXRNYW5hZ2VyLkNsZWFyQXN5bmNBY3Rpb25Qcm9taXNlcygpOwogICAgICAgICAgICAgICAgcnVudGltZS5GbHVzaFBlbmRpbmdJbnN0YW5jZXMoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZyYW1lLlJlc2V0KG51bGwpOwogICAgICAgICAgICBpZiAocHJvZmlsZSkgdGhpcy5fcGVyZlJlY29yZC50b3RhbFRpbWVDb3VudGVyICs9IHBlcmZvcm1hbmNlLm5vdygpIC0gc3RhcnRUaW1lCiAgICAgICAgfSogRGVidWdSdW4oKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9oYXNSdW4pIHJldHVybjsKICAgICAgICAgICAgdGhpcy5faGFzUnVuID0gdHJ1ZTsKICAgICAgICAgICAgY29uc3QgcnVudGltZSA9IHRoaXMuX3J1bnRpbWU7CiAgICAgICAgICAgIGNvbnN0IGV2ZW50U2hlZXRNYW5hZ2VyID0gdGhpcy5HZXRFdmVudFNoZWV0TWFuYWdlcigpOwogICAgICAgICAgICBjb25zdCBmcmFtZSA9IGV2ZW50U2hlZXRNYW5hZ2VyLkdldEN1cnJlbnRFdmVudFN0YWNrRnJhbWUoKTsKICAgICAgICAgICAgZm9yIChjb25zdCBlIG9mIHRoaXMuX2V2ZW50cykgewogICAgICAgICAgICAgICAgeWllbGQqIGUuRGVidWdSdW4oZnJhbWUpOwogICAgICAgICAgICAgICAgZXZlbnRTaGVldE1hbmFnZXIuQ2xlYXJTb2woZS5HZXRTb2xNb2RpZmllcnMoKSk7CiAgICAgICAgICAgICAgICBldmVudFNoZWV0TWFuYWdlci5DbGVhckFzeW5jQWN0aW9uUHJvbWlzZXMoKTsKICAgICAgICAgICAgICAgIHJ1bnRpbWUuRmx1c2hQZW5kaW5nSW5zdGFuY2VzKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBmcmFtZS5SZXNldChudWxsKQogICAgICAgIH0KICAgICAgICBfVHJpZ2dlcihtZXRob2QsIGluc3QsIGJlaGF2aW9yVHlwZSkgewogICAgICAgICAgICBpZiAoaW5zdCkgewogICAgICAgICAgICAgICAgY29uc3Qgb2JqZWN0Q2xhc3MgPSBpbnN0LkdldE9iamVjdENsYXNzKCk7CiAgICAgICAgICAgICAgICBsZXQgcmV0ID0gZmFsc2U7CiAgICAgICAgICAgICAgICBsZXQgciA9IHRoaXMuX1RyaWdnZXJGb3JDbGFzcyhtZXRob2QsIGluc3QsIG9iamVjdENsYXNzLCBiZWhhdmlvclR5cGUpOwogICAgICAgICAgICAgICAgcmV0ID0gcmV0IHx8IHI7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGZhbWlseSBvZiBvYmplY3RDbGFzcy5HZXRGYW1pbGllcygpKSB7CiAgICAgICAgICAgICAgICAgICAgciA9IHRoaXMuX1RyaWdnZXJGb3JDbGFzcyhtZXRob2QsIGluc3QsIGZhbWlseSwgYmVoYXZpb3JUeXBlKTsKICAgICAgICAgICAgICAgICAgICByZXQgPSByZXQgfHwgcgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgcmV0dXJuIHRoaXMuX1RyaWdnZXJGb3JDbGFzcyhtZXRob2QsIGluc3QsIG51bGwsIG51bGwpCiAgICAgICAgfQogICAgICAgIF9UcmlnZ2VyRm9yQ2xhc3MobWV0aG9kLCBpbnN0LCBvYmplY3RDbGFzcywgYmVoYXZpb3JUeXBlKSB7CiAgICAgICAgICAgIGNvbnN0IG9jSW5mbyA9CiAgICAgICAgICAgICAgICB0aGlzLl90cmlnZ2Vycy5nZXQob2JqZWN0Q2xhc3MpOwogICAgICAgICAgICBpZiAoIW9jSW5mbykgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBjb25zdCBtZXRob2RNYXAgPSBiZWhhdmlvclR5cGUgPyBvY0luZm8uYmVoYXZpb3JzLmdldChiZWhhdmlvclR5cGUpIDogb2NJbmZvLm1ldGhvZE1hcDsKICAgICAgICAgICAgaWYgKCFtZXRob2RNYXApIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgY29uc3QgdHJpZ2dlckxpc3QgPSBtZXRob2RNYXAuZ2V0KG1ldGhvZCk7CiAgICAgICAgICAgIGlmICghdHJpZ2dlckxpc3QpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgbGV0IHJldCA9IGZhbHNlOwogICAgICAgICAgICBmb3IgKGNvbnN0IFt0cmlnZ2VyLCBpbmRleF0gb2YgdHJpZ2dlckxpc3QpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLl9FeGVjdXRlVHJpZ2dlcihpbnN0LCB0cmlnZ2VyLCBpbmRleCk7CiAgICAgICAgICAgICAgICByZXQgPSByZXQgfHwgcgogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiByZXQKICAgICAgICB9KiBfRGVidWdUcmlnZ2VyKG1ldGhvZCwgaW5zdCwgYmVoYXZpb3JUeXBlKSB7CiAgICAgICAgICAgIGlmIChpbnN0KSB7CiAgICAgICAgICAgICAgICBjb25zdCBvYmplY3RDbGFzcyA9IGluc3QuR2V0T2JqZWN0Q2xhc3MoKTsKICAgICAgICAgICAgICAgIGxldCByZXQgPSBmYWxzZTsKICAgICAgICAgICAgICAgIGxldCByID0geWllbGQqIHRoaXMuX0RlYnVnVHJpZ2dlckZvckNsYXNzKG1ldGhvZCwKICAgICAgICAgICAgICAgICAgICBpbnN0LCBvYmplY3RDbGFzcywgYmVoYXZpb3JUeXBlKTsKICAgICAgICAgICAgICAgIHJldCA9IHJldCB8fCByOwogICAgICAgICAgICAgICAgZm9yIChjb25zdCBmYW1pbHkgb2Ygb2JqZWN0Q2xhc3MuR2V0RmFtaWxpZXMoKSkgewogICAgICAgICAgICAgICAgICAgIHIgPSB5aWVsZCogdGhpcy5fRGVidWdUcmlnZ2VyRm9yQ2xhc3MobWV0aG9kLCBpbnN0LCBmYW1pbHksIGJlaGF2aW9yVHlwZSk7CiAgICAgICAgICAgICAgICAgICAgcmV0ID0gcmV0IHx8IHIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHJldHVybiB5aWVsZCogdGhpcy5fRGVidWdUcmlnZ2VyRm9yQ2xhc3MobWV0aG9kLCBpbnN0LCBudWxsLCBudWxsKQogICAgICAgIH0qIF9EZWJ1Z1RyaWdnZXJGb3JDbGFzcyhtZXRob2QsIGluc3QsIG9iamVjdENsYXNzLCBiZWhhdmlvclR5cGUpIHsKICAgICAgICAgICAgY29uc3Qgb2NJbmZvID0gdGhpcy5fdHJpZ2dlcnMuZ2V0KG9iamVjdENsYXNzKTsKICAgICAgICAgICAgaWYgKCFvY0luZm8pIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgY29uc3QgbWV0aG9kTWFwID0gYmVoYXZpb3JUeXBlID8gb2NJbmZvLmJlaGF2aW9ycy5nZXQoYmVoYXZpb3JUeXBlKSA6IG9jSW5mby5tZXRob2RNYXA7CiAgICAgICAgICAgIGlmICghbWV0aG9kTWFwKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGNvbnN0IHRyaWdnZXJMaXN0ID0gbWV0aG9kTWFwLmdldChtZXRob2QpOwogICAgICAgICAgICBpZiAoIXRyaWdnZXJMaXN0KSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGxldCByZXQgPSBmYWxzZTsKICAgICAgICAgICAgZm9yIChjb25zdCBbdHJpZ2dlciwgaW5kZXhdIG9mIHRyaWdnZXJMaXN0KSB7CiAgICAgICAgICAgICAgICBsZXQgcjsKICAgICAgICAgICAgICAgIGlmICh0cmlnZ2VyLkRlYnVnQ2FuUnVuRmFzdCgpKSByID0gdGhpcy5fRXhlY3V0ZVRyaWdnZXIoaW5zdCwgdHJpZ2dlciwgaW5kZXgpOwogICAgICAgICAgICAgICAgZWxzZSByID0geWllbGQqIHRoaXMuX0RlYnVnRXhlY3V0ZVRyaWdnZXIoaW5zdCwgdHJpZ2dlciwgaW5kZXgpOwogICAgICAgICAgICAgICAgcmV0ID0gcmV0IHx8IHIKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcmV0CiAgICAgICAgfQogICAgICAgIF9GYXN0VHJpZ2dlcihtZXRob2QsIGluc3QsIHZhbHVlKSB7CiAgICAgICAgICAgIGNvbnN0IG9iamVjdENsYXNzID0gaW5zdC5HZXRPYmplY3RDbGFzcygpOwogICAgICAgICAgICBjb25zdCBtZXRob2RNYXAgPSB0aGlzLl9mYXN0VHJpZ2dlcnMuZ2V0KG9iamVjdENsYXNzKTsKICAgICAgICAgICAgaWYgKCFtZXRob2RNYXApIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgY29uc3QgdmFsdWVNYXAgPSBtZXRob2RNYXAuZ2V0KG1ldGhvZCk7CiAgICAgICAgICAgIGlmICghdmFsdWVNYXApIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgY29uc3QgdHJpZ2dlckxpc3QgPSB2YWx1ZU1hcC5nZXQodmFsdWUpOwogICAgICAgICAgICBpZiAoIXRyaWdnZXJMaXN0KSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGxldCByZXQgPSBmYWxzZTsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IHRyaWdnZXJMaXN0Lmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7CiAgICAgICAgICAgICAgICBjb25zdCB0ID0gdHJpZ2dlckxpc3RbaV07CiAgICAgICAgICAgICAgICBjb25zdCByID0gdGhpcy5fRXhlY3V0ZVRyaWdnZXIobnVsbCwgdFswXSwgdFsxXSk7CiAgICAgICAgICAgICAgICByZXQgPSByZXQgfHwgcgogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiByZXQKICAgICAgICB9KiBfRGVidWdGYXN0VHJpZ2dlcihtZXRob2QsIGluc3QsIHZhbHVlKSB7CiAgICAgICAgICAgIGNvbnN0IG9iamVjdENsYXNzID0gaW5zdC5HZXRPYmplY3RDbGFzcygpOwogICAgICAgICAgICBjb25zdCBtZXRob2RNYXAgPSB0aGlzLl9mYXN0VHJpZ2dlcnMuZ2V0KG9iamVjdENsYXNzKTsKICAgICAgICAgICAgaWYgKCFtZXRob2RNYXApIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgY29uc3QgdmFsdWVNYXAgPSBtZXRob2RNYXAuZ2V0KG1ldGhvZCk7CiAgICAgICAgICAgIGlmICghdmFsdWVNYXApIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgY29uc3QgdHJpZ2dlckxpc3QgPSB2YWx1ZU1hcC5nZXQodmFsdWUpOwogICAgICAgICAgICBpZiAoIXRyaWdnZXJMaXN0KSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGxldCByZXQgPSBmYWxzZTsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IHRyaWdnZXJMaXN0Lmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7CiAgICAgICAgICAgICAgICBjb25zdCB0ID0KICAgICAgICAgICAgICAgICAgICB0cmlnZ2VyTGlzdFtpXTsKICAgICAgICAgICAgICAgIGNvbnN0IHRyaWdnZXIgPSB0WzBdOwogICAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSB0WzFdOwogICAgICAgICAgICAgICAgbGV0IHI7CiAgICAgICAgICAgICAgICBpZiAodHJpZ2dlci5EZWJ1Z0NhblJ1bkZhc3QoKSkgciA9IHRoaXMuX0V4ZWN1dGVUcmlnZ2VyKG51bGwsIHRyaWdnZXIsIGluZGV4KTsKICAgICAgICAgICAgICAgIGVsc2UgciA9IHlpZWxkKiB0aGlzLl9EZWJ1Z0V4ZWN1dGVUcmlnZ2VyKG51bGwsIHRyaWdnZXIsIGluZGV4KTsKICAgICAgICAgICAgICAgIHJldCA9IHJldCB8fCByCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHJldAogICAgICAgIH0KICAgICAgICBfRXhlY3V0ZVRyaWdnZXIoaW5zdCwgdHJpZ2dlciwgaW5kZXgpIHsKICAgICAgICAgICAgY29uc3QgcnVudGltZSA9IHRoaXMuX3J1bnRpbWU7CiAgICAgICAgICAgIGNvbnN0IGV2ZW50U2hlZXRNYW5hZ2VyID0gdGhpcy5fZXZlbnRTaGVldE1hbmFnZXI7CiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRFdmVudCA9IGV2ZW50U2hlZXRNYW5hZ2VyLkdldEN1cnJlbnRFdmVudCgpOwogICAgICAgICAgICBjb25zdCBldmVudFN0YWNrID0gZXZlbnRTaGVldE1hbmFnZXIuR2V0RXZlbnRTdGFjaygpOwogICAgICAgICAgICBjb25zdCB0cmlnZ2VyRGVwdGggPSBldmVudFNoZWV0TWFuYWdlci5HZXRUcmlnZ2VyRGVwdGgoKTsKICAgICAgICAgICAgbGV0IHJldCA9IGZhbHNlOwogICAgICAgICAgICBpZiAoY3VycmVudEV2ZW50KSBldmVudFNoZWV0TWFuYWdlci5QdXNoQ2xlYW5Tb2woY3VycmVudEV2ZW50LkdldFNvbE1vZGlmaWVyc0luY2x1ZGluZ1BhcmVudHMoKSk7CiAgICAgICAgICAgIGV2ZW50U2hlZXRNYW5hZ2VyLlB1c2hDbGVhblNvbCh0cmlnZ2VyLkdldFNvbE1vZGlmaWVyc0luY2x1ZGluZ1BhcmVudHMoKSk7CiAgICAgICAgICAgIGNvbnN0IGlzUmVjdXJzaXZlID0gdHJpZ2dlckRlcHRoID4gMTsKICAgICAgICAgICAgaWYgKGlzUmVjdXJzaXZlKSBldmVudFNoZWV0TWFuYWdlci5HZXRMb2NhbFZhclN0YWNrKCkuUHVzaCgpOwogICAgICAgICAgICBjb25zdCBmcmFtZSA9IGV2ZW50U3RhY2suUHVzaCh0cmlnZ2VyKTsKICAgICAgICAgICAgaWYgKGluc3QpIHsKICAgICAgICAgICAgICAgIGNvbnN0IG9iamVjdENsYXNzID0gdHJpZ2dlci5HZXRDb25kaXRpb25zKClbaW5kZXhdLkdldE9iamVjdENsYXNzKCk7CiAgICAgICAgICAgICAgICBjb25zdCBzb2wgPSBvYmplY3RDbGFzcy5HZXRDdXJyZW50U29sKCk7CiAgICAgICAgICAgICAgICBzb2wuU2V0U2luZ2xlUGlja2VkKGluc3QpOwogICAgICAgICAgICAgICAgaWYgKGluc3QuSXNJbkNvbnRhaW5lcigpKSBpbnN0LlNldFNpYmxpbmdzU2luZ2xlUGlja2VkKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBsZXQgb2tUb1J1biA9IHRydWU7CiAgICAgICAgICAgIGlmICh0cmlnZ2VyLkdldFBhcmVudCgpKSB7CiAgICAgICAgICAgICAgICBjb25zdCBwYXJlbnRzID0gdHJpZ2dlci5HZXRUcmlnZ2VyUGFyZW50cygpOwogICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IHBhcmVudHMubGVuZ3RoOyBpIDwKICAgICAgICAgICAgICAgICAgICBsZW47ICsraSkKICAgICAgICAgICAgICAgICAgICBpZiAoIXBhcmVudHNbaV0uUnVuUHJlVHJpZ2dlcihmcmFtZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgb2tUb1J1biA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAob2tUb1J1bikgewogICAgICAgICAgICAgICAgaWYgKHRyaWdnZXIuSXNPckJsb2NrKCkpIHRyaWdnZXIuUnVuT3JCbG9ja1RyaWdnZXIoZnJhbWUsIGluZGV4KTsKICAgICAgICAgICAgICAgIGVsc2UgdHJpZ2dlci5SdW4oZnJhbWUpOwogICAgICAgICAgICAgICAgcmV0ID0gZnJhbWUuR2V0TGFzdEV2ZW50VHJ1ZSgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZXZlbnRTdGFjay5Qb3AoKTsKICAgICAgICAgICAgaWYgKGlzUmVjdXJzaXZlKSBldmVudFNoZWV0TWFuYWdlci5HZXRMb2NhbFZhclN0YWNrKCkuUG9wKCk7CiAgICAgICAgICAgIGV2ZW50U2hlZXRNYW5hZ2VyLlBvcFNvbCh0cmlnZ2VyLkdldFNvbE1vZGlmaWVyc0luY2x1ZGluZ1BhcmVudHMoKSk7CiAgICAgICAgICAgIGlmIChjdXJyZW50RXZlbnQpIGV2ZW50U2hlZXRNYW5hZ2VyLlBvcFNvbChjdXJyZW50RXZlbnQuR2V0U29sTW9kaWZpZXJzSW5jbHVkaW5nUGFyZW50cygpKTsKICAgICAgICAgICAgaWYgKCFjdXJyZW50RXZlbnQgJiYgdHJpZ2dlckRlcHRoID09PSAxKSB7CiAgICAgICAgICAgICAgICBldmVudFNoZWV0TWFuYWdlci5DbGVhckFzeW5jQWN0aW9uUHJvbWlzZXMoKTsKICAgICAgICAgICAgICAgIGlmICghZXZlbnRTaGVldE1hbmFnZXIuSXNGbHVzaGluZ0Jsb2NrZWQoKSkgcnVudGltZS5GbHVzaFBlbmRpbmdJbnN0YW5jZXMoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiByZXQKICAgICAgICB9KiBfRGVidWdFeGVjdXRlVHJpZ2dlcihpbnN0LCB0cmlnZ2VyLCBpbmRleCkgewogICAgICAgICAgICBjb25zdCBydW50aW1lID0gdGhpcy5fcnVudGltZTsKICAgICAgICAgICAgY29uc3QgZXZlbnRTaGVldE1hbmFnZXIgPSB0aGlzLl9ldmVudFNoZWV0TWFuYWdlcjsKICAgICAgICAgICAgY29uc3QgY3VycmVudEV2ZW50ID0gZXZlbnRTaGVldE1hbmFnZXIuR2V0Q3VycmVudEV2ZW50KCk7CiAgICAgICAgICAgIGNvbnN0IGV2ZW50U3RhY2sgPSBldmVudFNoZWV0TWFuYWdlci5HZXRFdmVudFN0YWNrKCk7CiAgICAgICAgICAgIGNvbnN0IHRyaWdnZXJEZXB0aCA9IGV2ZW50U2hlZXRNYW5hZ2VyLkdldFRyaWdnZXJEZXB0aCgpOwogICAgICAgICAgICBsZXQgcmV0ID0gZmFsc2U7CiAgICAgICAgICAgIGlmIChjdXJyZW50RXZlbnQpIGV2ZW50U2hlZXRNYW5hZ2VyLlB1c2hDbGVhblNvbChjdXJyZW50RXZlbnQuR2V0U29sTW9kaWZpZXJzSW5jbHVkaW5nUGFyZW50cygpKTsKICAgICAgICAgICAgZXZlbnRTaGVldE1hbmFnZXIuUHVzaENsZWFuU29sKHRyaWdnZXIuR2V0U29sTW9kaWZpZXJzSW5jbHVkaW5nUGFyZW50cygpKTsKICAgICAgICAgICAgY29uc3QgaXNSZWN1cnNpdmUgPSB0cmlnZ2VyRGVwdGggPiAxOwogICAgICAgICAgICBpZiAoaXNSZWN1cnNpdmUpIGV2ZW50U2hlZXRNYW5hZ2VyLkdldExvY2FsVmFyU3RhY2soKS5QdXNoKCk7CiAgICAgICAgICAgIGNvbnN0IGZyYW1lID0gZXZlbnRTdGFjay5QdXNoKHRyaWdnZXIpOwogICAgICAgICAgICBpZiAoaW5zdCkgewogICAgICAgICAgICAgICAgY29uc3Qgb2JqZWN0Q2xhc3MgPSB0cmlnZ2VyLkdldENvbmRpdGlvbnMoKVtpbmRleF0uR2V0T2JqZWN0Q2xhc3MoKTsKICAgICAgICAgICAgICAgIGNvbnN0IHNvbCA9IG9iamVjdENsYXNzLkdldEN1cnJlbnRTb2woKTsKICAgICAgICAgICAgICAgIHNvbC5TZXRTaW5nbGVQaWNrZWQoaW5zdCk7CiAgICAgICAgICAgICAgICBpZiAoaW5zdC5Jc0luQ29udGFpbmVyKCkpIGluc3QuU2V0U2libGluZ3NTaW5nbGVQaWNrZWQoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGxldCBva1RvUnVuID0gdHJ1ZTsKICAgICAgICAgICAgaWYgKHRyaWdnZXIuR2V0UGFyZW50KCkpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHBhcmVudHMgPSB0cmlnZ2VyLkdldFRyaWdnZXJQYXJlbnRzKCk7CiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gcGFyZW50cy5sZW5ndGg7IGkgPCBsZW47ICsraSkKICAgICAgICAgICAgICAgICAgICBpZiAoISh5aWVsZCogcGFyZW50c1tpXS5EZWJ1Z1J1blByZVRyaWdnZXIoZnJhbWUpKSkgewogICAgICAgICAgICAgICAgICAgICAgICBva1RvUnVuID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAob2tUb1J1bikgewogICAgICAgICAgICAgICAgaWYgKHRyaWdnZXIuSXNPckJsb2NrKCkpIHlpZWxkKiB0cmlnZ2VyLkRlYnVnUnVuT3JCbG9ja1RyaWdnZXIoZnJhbWUsIGluZGV4KTsKICAgICAgICAgICAgICAgIGVsc2UgeWllbGQqIHRyaWdnZXIuRGVidWdSdW4oZnJhbWUpOwogICAgICAgICAgICAgICAgcmV0ID0gZnJhbWUuR2V0TGFzdEV2ZW50VHJ1ZSgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZXZlbnRTdGFjay5Qb3AoKTsKICAgICAgICAgICAgaWYgKGlzUmVjdXJzaXZlKSBldmVudFNoZWV0TWFuYWdlci5HZXRMb2NhbFZhclN0YWNrKCkuUG9wKCk7CiAgICAgICAgICAgIGV2ZW50U2hlZXRNYW5hZ2VyLlBvcFNvbCh0cmlnZ2VyLkdldFNvbE1vZGlmaWVyc0luY2x1ZGluZ1BhcmVudHMoKSk7CiAgICAgICAgICAgIGlmIChjdXJyZW50RXZlbnQpIGV2ZW50U2hlZXRNYW5hZ2VyLlBvcFNvbChjdXJyZW50RXZlbnQuR2V0U29sTW9kaWZpZXJzSW5jbHVkaW5nUGFyZW50cygpKTsKICAgICAgICAgICAgaWYgKCFjdXJyZW50RXZlbnQgJiYgdHJpZ2dlckRlcHRoID09PSAxKSB7CiAgICAgICAgICAgICAgICBldmVudFNoZWV0TWFuYWdlci5DbGVhckFzeW5jQWN0aW9uUHJvbWlzZXMoKTsKICAgICAgICAgICAgICAgIGlmICghZXZlbnRTaGVldE1hbmFnZXIuSXNGbHVzaGluZ0Jsb2NrZWQoKSkgcnVudGltZS5GbHVzaFBlbmRpbmdJbnN0YW5jZXMoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiByZXQKICAgICAgICB9CiAgICAgICAgX0dldFBlcmZSZWNvcmQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9wZXJmUmVjb3JkCiAgICAgICAgfQogICAgfTsKCn0KCi8vIGV2ZW50cy9ldmVudEJsb2NrLmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIGNvbnN0IEVNUFRZX0FSUkFZID0gW107CgogICAgZnVuY3Rpb24gTm9BY3Rpb25zKGZyYW1lLCBpbmRleCkgewogICAgICAgIHJldHVybiB0cnVlCiAgICB9CgogICAgZnVuY3Rpb24qIERlYnVnTm9BY3Rpb25zKGZyYW1lLCBpbmRleCkgewogICAgICAgIHJldHVybiB0cnVlCiAgICB9CiAgICBDMy5FdmVudEJsb2NrID0gY2xhc3MgRXZlbnRCbG9jayBleHRlbmRzIEMzLkRlZmVuZGVkQmFzZSB7CiAgICAgICAgY29uc3RydWN0b3IoZXZlbnRTaGVldCwgcGFyZW50LCBkYXRhKSB7CiAgICAgICAgICAgIHN1cGVyKCk7CiAgICAgICAgICAgIHRoaXMuX2V2ZW50U2hlZXQgPSBldmVudFNoZWV0OwogICAgICAgICAgICB0aGlzLl9ydW50aW1lID0gZXZlbnRTaGVldC5HZXRSdW50aW1lKCk7CiAgICAgICAgICAgIHRoaXMuX3BhcmVudCA9IHBhcmVudDsKICAgICAgICAgICAgdGhpcy5fc2NvcGVQYXJlbnQgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9ldmVudFN0YWNrID0gdGhpcy5fcnVudGltZS5HZXRFdmVudFNoZWV0TWFuYWdlcigpLkdldEV2ZW50U3RhY2soKTsKICAgICAgICAgICAgdGhpcy5fc29sTW9kaWZpZXJzID0gW107CiAgICAgICAgICAgIHRoaXMuX3NvbE1vZGlmaWVyc0luY2x1ZGluZ1BhcmVudHMgPSBbXTsKICAgICAgICAgICAgdGhpcy5faGFzR290U29sTW9kaWZpZXJzSW5jbHVkaW5nUGFyZW50cyA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl9pc1NvbFdyaXRlckFmdGVyQ25kcyA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl9pc1RvcExldmVsR3JvdXAgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5faGFzRWxzZUJsb2NrID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX2lzT3JCbG9jayA9ICEhZGF0YVsyXTsKICAgICAgICAgICAgdGhpcy5faXNFbHNlQmxvY2sgPQogICAgICAgICAgICAgICAgZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX3RyaWdnZXJQYXJlbnRzID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fY29uZGl0aW9ucyA9IFtdOwogICAgICAgICAgICB0aGlzLl9hY3Rpb25zID0gW107CiAgICAgICAgICAgIHRoaXMuX3N1YkV2ZW50cyA9IFtdOwogICAgICAgICAgICB0aGlzLl9SdW5BY3Rpb25zID0gTm9BY3Rpb25zOwogICAgICAgICAgICB0aGlzLl9EZWJ1Z1J1bkFjdGlvbnMgPSBEZWJ1Z05vQWN0aW9uczsKICAgICAgICAgICAgdGhpcy5faXNHcm91cCA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl9pc0luaXRpYWxseUFjdGl2ZSA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl9ncm91cE5hbWUgPSAiIjsKICAgICAgICAgICAgdGhpcy5faXNHcm91cEFjdGl2ZSA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl9jb250YWluZWRJbmNsdWRlcyA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3BlcmZSZWNvcmQgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9zaWQgPSBkYXRhWzRdOwogICAgICAgICAgICB0aGlzLl9kaXNwbGF5TnVtYmVyID0gZGF0YVs1XTsKICAgICAgICAgICAgdGhpcy5fZXZlbnRTaGVldC5fUmVnaXN0ZXJFdmVudEJ5RGlzcGxheU51bWJlcih0aGlzLCB0aGlzLl9kaXNwbGF5TnVtYmVyKTsKICAgICAgICAgICAgdGhpcy5fZGVidWdEYXRhID0gdGhpcy5fcnVudGltZS5Jc0RlYnVnKCkgPyB7CiAgICAgICAgICAgICAgICBpc0JyZWFrcG9pbnQ6IGRhdGFbM11bMF0sCiAgICAgICAgICAgICAgICBpc0JyZWFrYWJsZTogZGF0YVszXVsxXSwKICAgICAgICAgICAgICAgIGNhblJ1bkFsbENvbmRpdGlvbnNGYXN0OiBmYWxzZSwKICAgICAgICAgICAgICAgIGNhblJ1bkFsbEFjdGlvbnNGYXN0OiBmYWxzZSwKICAgICAgICAgICAgICAgIGNhblJ1bkFsbFN1YkV2ZW50c0Zhc3Q6IGZhbHNlLAogICAgICAgICAgICAgICAgY2FuUnVuU2VsZkZhc3Q6IGZhbHNlCiAgICAgICAgICAgIH0gOiBudWxsOwogICAgICAgICAgICB0aGlzLkdldEV2ZW50U2hlZXRNYW5hZ2VyKCkuX1JlZ2lzdGVyRXZlbnRCbG9jayh0aGlzKTsKICAgICAgICAgICAgaWYgKGRhdGFbMF0gPT09IDMpIHRoaXMuX0luaXRHcm91cChkYXRhWzFdKTsKICAgICAgICAgICAgbGV0IGluZGV4ID0gMDsKICAgICAgICAgICAgZm9yIChjb25zdCBjbmREYXRhIG9mIGRhdGFbNl0pIHsKICAgICAgICAgICAgICAgIGNvbnN0IGNvbmRpdGlvbiA9IEMzLkNvbmRpdGlvbi5DcmVhdGUodGhpcywgY25kRGF0YSwgaW5kZXgrKyk7CiAgICAgICAgICAgICAgICB0aGlzLl9jb25kaXRpb25zLnB1c2goY29uZGl0aW9uKTsKICAgICAgICAgICAgICAgIHRoaXMuX0FkZFNvbE1vZGlmaWVyKGNvbmRpdGlvbi5HZXRPYmplY3RDbGFzcygpKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGluZGV4ID0gMDsKICAgICAgICAgICAgZm9yIChjb25zdCBhY3REYXRhIG9mIGRhdGFbN10pIHsKICAgICAgICAgICAgICAgIGNvbnN0IGFjdGlvbiA9IEMzLkFjdGlvbi5DcmVhdGUodGhpcywgYWN0RGF0YSwgaW5kZXgrKyk7CiAgICAgICAgICAgICAgICB0aGlzLl9hY3Rpb25zLnB1c2goYWN0aW9uKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChkYXRhLmxlbmd0aCA9PT0KICAgICAgICAgICAgICAgIDkpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHN1YkV2ZW50c0RhdGEgPSBkYXRhWzhdOwogICAgICAgICAgICAgICAgZm9yIChjb25zdCBldmVudERhdGEgb2Ygc3ViRXZlbnRzRGF0YSkgdGhpcy5fZXZlbnRTaGVldC5fQ3JlYXRlRXZlbnQoZXZlbnREYXRhLCB0aGlzLCB0aGlzLl9zdWJFdmVudHMpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHRoaXMuX2NvbmRpdGlvbnMubGVuZ3RoKSB0aGlzLl9pc0Vsc2VCbG9jayA9IHRoaXMuX2NvbmRpdGlvbnNbMF0uR2V0T2JqZWN0Q2xhc3MoKSA9PT0gbnVsbCAmJiB0aGlzLl9jb25kaXRpb25zWzBdLl9HZXRGdW5jKCkgPT09IEMzLlBsdWdpbnMuU3lzdGVtLkNuZHMuRWxzZTsKICAgICAgICAgICAgaWYgKHRoaXMuX2NvbmRpdGlvbnMubGVuZ3RoID09PSAwKSB0aGlzLl9jb25kaXRpb25zID0gRU1QVFlfQVJSQVk7CiAgICAgICAgICAgIGlmICh0aGlzLl9hY3Rpb25zLmxlbmd0aCA9PT0gMCkgdGhpcy5fYWN0aW9ucyA9IEVNUFRZX0FSUkFZOwogICAgICAgICAgICBpZiAodGhpcy5fc3ViRXZlbnRzLmxlbmd0aCA9PT0gMCkgdGhpcy5fc3ViRXZlbnRzID0gRU1QVFlfQVJSQVkKICAgICAgICB9CiAgICAgICAgc3RhdGljIENyZWF0ZShldmVudFNoZWV0LCBwYXJlbnQsIGRhdGEpIHsKICAgICAgICAgICAgcmV0dXJuIEMzLk5ldyhDMy5FdmVudEJsb2NrLAogICAgICAgICAgICAgICAgZXZlbnRTaGVldCwgcGFyZW50LCBkYXRhKQogICAgICAgIH0KICAgICAgICBfSW5pdEdyb3VwKGdyb3VwRGF0YSkgewogICAgICAgICAgICB0aGlzLl9pc0dyb3VwID0gdHJ1ZTsKICAgICAgICAgICAgdGhpcy5faXNJbml0aWFsbHlBY3RpdmUgPSAhIWdyb3VwRGF0YVswXTsKICAgICAgICAgICAgdGhpcy5faXNHcm91cEFjdGl2ZSA9IHRoaXMuX2lzSW5pdGlhbGx5QWN0aXZlOwogICAgICAgICAgICB0aGlzLl9ncm91cE5hbWUgPSBncm91cERhdGFbMV0udG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgdGhpcy5fY29udGFpbmVkSW5jbHVkZXMgPSBbXTsKICAgICAgICAgICAgdGhpcy5HZXRFdmVudFNoZWV0TWFuYWdlcigpLl9SZWdpc3Rlckdyb3VwKHRoaXMpOwogICAgICAgICAgICBpZiAodGhpcy5fcnVudGltZS5Jc0RlYnVnKCkpIHRoaXMuX3BlcmZSZWNvcmQgPSB7CiAgICAgICAgICAgICAgICB0eXBlOiAiZ3JvdXAiLAogICAgICAgICAgICAgICAgbmFtZTogZ3JvdXBEYXRhWzFdLAogICAgICAgICAgICAgICAgdG90YWxUaW1lQ291bnRlcjogMCwKICAgICAgICAgICAgICAgIGNoaWxkcmVuOiBbXQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIF9BZGRDb250YWluZWRJbmNsdWRlKGluY2x1ZGUpIHsKICAgICAgICAgICAgdGhpcy5fY29udGFpbmVkSW5jbHVkZXMucHVzaChpbmNsdWRlKQogICAgICAgIH0KICAgICAgICBfQWRkQ29udGFpbmVyU29sTW9kaWZpZXJUb0xpc3Qob2JqZWN0Q2xhc3MsIGFycikgewogICAgICAgICAgICBmb3IgKGNvbnN0IGNvbnRhaW5lclR5cGUgb2Ygb2JqZWN0Q2xhc3MuR2V0Q29udGFpbmVyKCkub2JqZWN0VHlwZXMoKSkKICAgICAgICAgICAgICAgIGlmICghYXJyLmluY2x1ZGVzKGNvbnRhaW5lclR5cGUpKSBhcnIucHVzaChjb250YWluZXJUeXBlKQogICAgICAgIH0KICAgICAgICBfQWRkU29sTW9kaWZpZXJUb0xpc3Qob2JqZWN0Q2xhc3MsCiAgICAgICAgICAgIGFycikgewogICAgICAgICAgICBpZiAoIW9iamVjdENsYXNzKSByZXR1cm47CiAgICAgICAgICAgIGlmICghYXJyLmluY2x1ZGVzKG9iamVjdENsYXNzKSkgYXJyLnB1c2gob2JqZWN0Q2xhc3MpOwogICAgICAgICAgICBpZiAob2JqZWN0Q2xhc3MuSXNGYW1pbHkoKSkKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgZmFtaWx5TWVtYmVyIG9mIG9iamVjdENsYXNzLkdldEZhbWlseU1lbWJlcnMoKSkgewogICAgICAgICAgICAgICAgICAgIGlmIChmYW1pbHlNZW1iZXIuSXNJbkNvbnRhaW5lcigpKSB0aGlzLl9BZGRDb250YWluZXJTb2xNb2RpZmllclRvTGlzdChmYW1pbHlNZW1iZXIsIGFycikKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAob2JqZWN0Q2xhc3MuSXNJbkNvbnRhaW5lcigpKSB0aGlzLl9BZGRDb250YWluZXJTb2xNb2RpZmllclRvTGlzdChvYmplY3RDbGFzcywgYXJyKQogICAgICAgIH0KICAgICAgICBfQWRkU29sTW9kaWZpZXIob2JqZWN0Q2xhc3MpIHsKICAgICAgICAgICAgdGhpcy5fQWRkU29sTW9kaWZpZXJUb0xpc3Qob2JqZWN0Q2xhc3MsIHRoaXMuX3NvbE1vZGlmaWVycykKICAgICAgICB9CiAgICAgICAgX0FkZFBhcmVudFNvbE1vZGlmaWVyKG9iamVjdENsYXNzKSB7CiAgICAgICAgICAgIHRoaXMuX0FkZFNvbE1vZGlmaWVyVG9MaXN0KG9iamVjdENsYXNzLAogICAgICAgICAgICAgICAgdGhpcy5fc29sTW9kaWZpZXJzSW5jbHVkaW5nUGFyZW50cykKICAgICAgICB9CiAgICAgICAgU2V0QWxsU29sTW9kaWZpZXJzKCkgewogICAgICAgICAgICB0aGlzLl9zb2xNb2RpZmllcnMgPSB0aGlzLl9ydW50aW1lLkdldEFsbE9iamVjdENsYXNzZXMoKQogICAgICAgIH0KICAgICAgICBfUG9zdEluaXQoaGFzRWxzZSkgewogICAgICAgICAgICB0aGlzLl9oYXNFbHNlQmxvY2sgPSAhIWhhc0Vsc2U7CiAgICAgICAgICAgIHRoaXMuX0lkZW50aWZ5VG9wTGV2ZWxHcm91cCgpOwogICAgICAgICAgICB0aGlzLl9JZGVudGlmeVRyaWdnZXJQYXJlbnRzKCk7CiAgICAgICAgICAgIGZvciAoY29uc3QgYyBvZiB0aGlzLl9jb25kaXRpb25zKSBjLl9Qb3N0SW5pdCgpOwogICAgICAgICAgICBpZiAodGhpcy5fYWN0aW9ucy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICBsZXQgaGFzQW55QWN0aW9uV2l0aFJldHVyblR5cGUgPSBmYWxzZTsKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgYSBvZiB0aGlzLl9hY3Rpb25zKSB7CiAgICAgICAgICAgICAgICAgICAgYS5fUG9zdEluaXQoKTsKICAgICAgICAgICAgICAgICAgICBpZiAoYS5IYXNSZXR1cm5UeXBlKCkpIGhhc0FueUFjdGlvbldpdGhSZXR1cm5UeXBlID0gdHJ1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGhhc0FueUFjdGlvbldpdGhSZXR1cm5UeXBlKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fUnVuQWN0aW9ucyA9IHRoaXMuX1J1bkFjdGlvbnNfUmV0dXJuVmFsdWU7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fRGVidWdSdW5BY3Rpb25zID0gdGhpcy5fRGVidWdSdW5BY3Rpb25zX1JldHVyblZhbHVlCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX1J1bkFjdGlvbnMgPSB0aGlzLl9SdW5BY3Rpb25zX0Zhc3Q7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fRGVidWdSdW5BY3Rpb25zID0gdGhpcy5fRGVidWdSdW5BY3Rpb25zX0Zhc3QKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBzdWJFdmVudHMgPSB0aGlzLl9zdWJFdmVudHM7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBzdWJFdmVudHMubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGhhc0Vsc2VCbG9jayA9IGkgPCBsZW4gLSAxICYmIHN1YkV2ZW50c1tpICsgMV0gaW5zdGFuY2VvZiBDMy5FdmVudEJsb2NrICYmIHN1YkV2ZW50c1tpICsgMV0uSXNFbHNlQmxvY2soKTsKICAgICAgICAgICAgICAgIHN1YkV2ZW50c1tpXS5fUG9zdEluaXQoaGFzRWxzZUJsb2NrKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLl9kZWJ1Z0RhdGEpIHRoaXMuX1VwZGF0ZUNhblJ1bkZhc3QoKTsKICAgICAgICAgICAgaWYgKHRoaXMuX3BlcmZSZWNvcmQpIHRoaXMuX0dldFBlcmZSZWNvcmRQYXJlbnQoKS5fR2V0UGVyZlJlY29yZCgpLmNoaWxkcmVuLnB1c2godGhpcy5fcGVyZlJlY29yZCkKICAgICAgICB9CiAgICAgICAgX0dldFBlcmZSZWNvcmQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9wZXJmUmVjb3JkCiAgICAgICAgfQogICAgICAgIF9HZXRQZXJmUmVjb3JkUGFyZW50KCkgewogICAgICAgICAgICBsZXQgcCA9CiAgICAgICAgICAgICAgICB0aGlzLkdldFBhcmVudCgpOwogICAgICAgICAgICB3aGlsZSAocCkgewogICAgICAgICAgICAgICAgaWYgKHAuSXNHcm91cCgpKSByZXR1cm4gcDsKICAgICAgICAgICAgICAgIHAgPSBwLkdldFBhcmVudCgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2V2ZW50U2hlZXQKICAgICAgICB9CiAgICAgICAgX1VwZGF0ZUNhblJ1bkZhc3QoKSB7CiAgICAgICAgICAgIGNvbnN0IGRkID0gdGhpcy5fZGVidWdEYXRhOwogICAgICAgICAgICBkZC5jYW5SdW5BbGxDb25kaXRpb25zRmFzdCA9IHRoaXMuX2NvbmRpdGlvbnMuZXZlcnkoYyA9PiBjLkRlYnVnQ2FuUnVuRmFzdCgpKTsKICAgICAgICAgICAgZGQuY2FuUnVuQWxsQWN0aW9uc0Zhc3QgPSB0aGlzLl9hY3Rpb25zLmV2ZXJ5KGEgPT4gYS5EZWJ1Z0NhblJ1bkZhc3QoKSk7CiAgICAgICAgICAgIGRkLmNhblJ1bkFsbFN1YkV2ZW50c0Zhc3QgPSB0aGlzLl9zdWJFdmVudHMuZXZlcnkocyA9PiBzLkRlYnVnQ2FuUnVuRmFzdCgpKTsKICAgICAgICAgICAgZGQuY2FuUnVuU2VsZkZhc3QgPSBkZC5jYW5SdW5BbGxDb25kaXRpb25zRmFzdCAmJiBkZC5jYW5SdW5BbGxBY3Rpb25zRmFzdCAmJiBkZC5jYW5SdW5BbGxTdWJFdmVudHNGYXN0CiAgICAgICAgfQogICAgICAgIF9VcGRhdGVDYW5SdW5GYXN0UmVjdXJzaXZlKCkgewogICAgICAgICAgICBsZXQgZSA9IHRoaXM7CiAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgIGUuX1VwZGF0ZUNhblJ1bkZhc3QoKTsKICAgICAgICAgICAgICAgIGUgPSBlLkdldFBhcmVudCgpCiAgICAgICAgICAgIH0gd2hpbGUgKGUpCiAgICAgICAgfQogICAgICAgIF9JZGVudGlmeVRvcExldmVsR3JvdXAoKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5Jc0dyb3VwKCkpIHJldHVybjsKICAgICAgICAgICAgbGV0IHAgPSB0aGlzLkdldFBhcmVudCgpOwogICAgICAgICAgICB0aGlzLl9pc1RvcExldmVsR3JvdXAgPSB0cnVlOwogICAgICAgICAgICB3aGlsZSAocCkgewogICAgICAgICAgICAgICAgaWYgKCFwLklzR3JvdXAoKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX2lzVG9wTGV2ZWxHcm91cCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBwID0gcC5HZXRQYXJlbnQoKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIF9JZGVudGlmeVNvbE1vZGlmaWVyc0luY2x1ZGluZ1BhcmVudHMoKSB7CiAgICAgICAgICAgIGNvbnN0IGFsbE9iamVjdENsYXNzZXMgPSB0aGlzLl9ydW50aW1lLkdldEFsbE9iamVjdENsYXNzZXMoKTsKICAgICAgICAgICAgaWYgKHRoaXMuX3NvbE1vZGlmaWVycyA9PT0gYWxsT2JqZWN0Q2xhc3NlcykgdGhpcy5fc29sTW9kaWZpZXJzSW5jbHVkaW5nUGFyZW50cyA9IGFsbE9iamVjdENsYXNzZXM7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5fc29sTW9kaWZpZXJzSW5jbHVkaW5nUGFyZW50cyA9IEMzLmNsb25lQXJyYXkodGhpcy5fc29sTW9kaWZpZXJzKTsKICAgICAgICAgICAgICAgIGxldCBwID0gdGhpcy5HZXRQYXJlbnQoKTsKICAgICAgICAgICAgICAgIHdoaWxlIChwKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBvIG9mIHAuX3NvbE1vZGlmaWVycykgdGhpcy5fQWRkUGFyZW50U29sTW9kaWZpZXIobyk7CiAgICAgICAgICAgICAgICAgICAgcCA9IHAuR2V0UGFyZW50KCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNvbnN0IGV2ZW50U2hlZXRNYW5hZ2VyID0gdGhpcy5HZXRFdmVudFNoZWV0TWFuYWdlcigpOwogICAgICAgICAgICAgICAgdGhpcy5fc29sTW9kaWZpZXJzID0gZXZlbnRTaGVldE1hbmFnZXIuX0RlZHVwbGljYXRlU29sTW9kaWZpZXJMaXN0KHRoaXMuX3NvbE1vZGlmaWVycyk7CiAgICAgICAgICAgICAgICB0aGlzLl9zb2xNb2RpZmllcnNJbmNsdWRpbmdQYXJlbnRzID0gZXZlbnRTaGVldE1hbmFnZXIuX0RlZHVwbGljYXRlU29sTW9kaWZpZXJMaXN0KHRoaXMuX3NvbE1vZGlmaWVyc0luY2x1ZGluZ1BhcmVudHMpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgX0lkZW50aWZ5VHJpZ2dlclBhcmVudHMoKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5IYXNBbnlUcmlnZ2VyZWRDb25kaXRpb24oKSkgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl90cmlnZ2VyUGFyZW50cyA9IFtdOwogICAgICAgICAgICBsZXQgcCA9IHRoaXMuR2V0UGFyZW50KCk7CiAgICAgICAgICAgIHdoaWxlIChwKSB7CiAgICAgICAgICAgICAgICB0aGlzLl90cmlnZ2VyUGFyZW50cy5wdXNoKHApOwogICAgICAgICAgICAgICAgcCA9IHAuR2V0UGFyZW50KCkKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLl90cmlnZ2VyUGFyZW50cy5yZXZlcnNlKCkKICAgICAgICB9CiAgICAgICAgU2V0U29sV3JpdGVyQWZ0ZXJDbmRzKCkgewogICAgICAgICAgICB0aGlzLl9pc1NvbFdyaXRlckFmdGVyQ25kcyA9CiAgICAgICAgICAgICAgICB0cnVlOwogICAgICAgICAgICBpZiAodGhpcy5fcGFyZW50KSB0aGlzLl9wYXJlbnQuU2V0U29sV3JpdGVyQWZ0ZXJDbmRzKCkKICAgICAgICB9CiAgICAgICAgSXNTb2xXcml0ZXJBZnRlckNuZHMoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pc1NvbFdyaXRlckFmdGVyQ25kcwogICAgICAgIH0KICAgICAgICBHZXRTb2xNb2RpZmllcnMoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zb2xNb2RpZmllcnMKICAgICAgICB9CiAgICAgICAgR2V0U29sTW9kaWZpZXJzSW5jbHVkaW5nUGFyZW50cygpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLl9oYXNHb3RTb2xNb2RpZmllcnNJbmNsdWRpbmdQYXJlbnRzKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9oYXNHb3RTb2xNb2RpZmllcnNJbmNsdWRpbmdQYXJlbnRzID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHRoaXMuX0lkZW50aWZ5U29sTW9kaWZpZXJzSW5jbHVkaW5nUGFyZW50cygpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NvbE1vZGlmaWVyc0luY2x1ZGluZ1BhcmVudHMKICAgICAgICB9CiAgICAgICAgSGFzU29sTW9kaWZpZXIob2JqZWN0Q2xhc3MpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NvbE1vZGlmaWVycy5pbmNsdWRlcyhvYmplY3RDbGFzcykKICAgICAgICB9CiAgICAgICAgR2V0VHJpZ2dlclBhcmVudHMoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl90cmlnZ2VyUGFyZW50cwogICAgICAgIH0KICAgICAgICBHZXRFdmVudFNoZWV0KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZXZlbnRTaGVldAogICAgICAgIH0KICAgICAgICBHZXRFdmVudFNoZWV0TWFuYWdlcigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2V2ZW50U2hlZXQuR2V0RXZlbnRTaGVldE1hbmFnZXIoKQogICAgICAgIH0KICAgICAgICBHZXRSdW50aW1lKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fcnVudGltZQogICAgICAgIH0KICAgICAgICBHZXRQYXJlbnQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9wYXJlbnQKICAgICAgICB9CiAgICAgICAgX1NldFNjb3BlUGFyZW50KHApIHsKICAgICAgICAgICAgdGhpcy5fc2NvcGVQYXJlbnQgPQogICAgICAgICAgICAgICAgcAogICAgICAgIH0KICAgICAgICBHZXRTY29wZVBhcmVudCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3Njb3BlUGFyZW50IHx8IHRoaXMuX3BhcmVudAogICAgICAgIH0KICAgICAgICBHZXREaXNwbGF5TnVtYmVyKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZGlzcGxheU51bWJlcgogICAgICAgIH0KICAgICAgICBJc0RlYnVnQnJlYWthYmxlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZGVidWdEYXRhICYmIHRoaXMuX2RlYnVnRGF0YS5pc0JyZWFrYWJsZQogICAgICAgIH0KICAgICAgICBJc0RlYnVnQnJlYWtwb2ludCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuSXNEZWJ1Z0JyZWFrYWJsZSgpICYmIHRoaXMuX2RlYnVnRGF0YS5pc0JyZWFrcG9pbnQKICAgICAgICB9CiAgICAgICAgX1NldERlYnVnQnJlYWtwb2ludChiKSB7CiAgICAgICAgICAgIHRoaXMuX2RlYnVnRGF0YS5pc0JyZWFrcG9pbnQgPSAhIWI7CiAgICAgICAgICAgIHRoaXMuX1VwZGF0ZUNhblJ1bkZhc3RSZWN1cnNpdmUoKQogICAgICAgIH0KICAgICAgICBJc0dyb3VwKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faXNHcm91cAogICAgICAgIH0KICAgICAgICBJc1RvcExldmVsR3JvdXAoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pc1RvcExldmVsR3JvdXAKICAgICAgICB9CiAgICAgICAgSXNFbHNlQmxvY2soKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pc0Vsc2VCbG9jawogICAgICAgIH0KICAgICAgICBIYXNFbHNlQmxvY2soKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9oYXNFbHNlQmxvY2sKICAgICAgICB9CiAgICAgICAgR2V0R3JvdXBOYW1lKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZ3JvdXBOYW1lCiAgICAgICAgfQogICAgICAgIElzR3JvdXBBY3RpdmUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pc0dyb3VwQWN0aXZlCiAgICAgICAgfQogICAgICAgIFJlc2V0SW5pdGlhbEFjdGl2YXRpb24oKSB7CiAgICAgICAgICAgIHRoaXMuU2V0R3JvdXBBY3RpdmUodGhpcy5faXNJbml0aWFsbHlBY3RpdmUpCiAgICAgICAgfQogICAgICAgIFNldEdyb3VwQWN0aXZlKGEpIHsKICAgICAgICAgICAgYSA9ICEhYTsKICAgICAgICAgICAgaWYgKCF0aGlzLl9pc0dyb3VwKSB0aHJvdyBuZXcgRXJyb3IoIm5vdCBhIGdyb3VwIik7CiAgICAgICAgICAgIGlmICh0aGlzLl9pc0dyb3VwQWN0aXZlID09PSBhKSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuX2lzR3JvdXBBY3RpdmUgPSBhOwogICAgICAgICAgICBmb3IgKGNvbnN0IGluY2x1ZGUgb2YgdGhpcy5fY29udGFpbmVkSW5jbHVkZXMpIGluY2x1ZGUuVXBkYXRlQWN0aXZlKCk7CiAgICAgICAgICAgIGlmICh0aGlzLl9jb250YWluZWRJbmNsdWRlcy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRMYXlvdXQgPSB0aGlzLl9ydW50aW1lLkdldEN1cnJlbnRMYXlvdXQoKTsKICAgICAgICAgICAgICAgIGNvbnN0IG1haW5FdmVudFNoZWV0ID0gY3VycmVudExheW91dC5HZXRFdmVudFNoZWV0KCk7CiAgICAgICAgICAgICAgICBpZiAobWFpbkV2ZW50U2hlZXQpIG1haW5FdmVudFNoZWV0Ll9VcGRhdGVEZWVwSW5jbHVkZXMoKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIEdldFNJRCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NpZAogICAgICAgIH0KICAgICAgICBJc09yQmxvY2soKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pc09yQmxvY2sKICAgICAgICB9CiAgICAgICAgSXNUcmlnZ2VyKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fY29uZGl0aW9ucy5sZW5ndGggJiYgdGhpcy5fY29uZGl0aW9uc1swXS5Jc1RyaWdnZXIoKQogICAgICAgIH0KICAgICAgICBJc0ZvckZ1bmN0aW9uQmxvY2soKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zY29wZVBhcmVudCAmJgogICAgICAgICAgICAgICAgdGhpcy5fc2NvcGVQYXJlbnQgaW5zdGFuY2VvZiBDMy5GdW5jdGlvbkJsb2NrCiAgICAgICAgfQogICAgICAgIEhhc0FueVRyaWdnZXJlZENvbmRpdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuSXNGb3JGdW5jdGlvbkJsb2NrKCkgfHwgdGhpcy5fY29uZGl0aW9ucy5zb21lKGMgPT4gYy5Jc1RyaWdnZXIoKSkKICAgICAgICB9CiAgICAgICAgR2V0Q29uZGl0aW9ucygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NvbmRpdGlvbnMKICAgICAgICB9CiAgICAgICAgR2V0Q29uZGl0aW9uQ291bnQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9jb25kaXRpb25zLmxlbmd0aAogICAgICAgIH0KICAgICAgICBHZXRDb25kaXRpb25BdChpKSB7CiAgICAgICAgICAgIGkgPSBNYXRoLmZsb29yKGkpOwogICAgICAgICAgICBpZiAoaSA8IDAgfHwgaSA+PSB0aGlzLl9jb25kaXRpb25zLmxlbmd0aCkgdGhyb3cgbmV3IFJhbmdlRXJyb3IoImludmFsaWQgY29uZGl0aW9uIGluZGV4Iik7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9jb25kaXRpb25zW2ldCiAgICAgICAgfQogICAgICAgIEdldENvbmRpdGlvbkJ5RGVidWdJbmRleChpKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLkdldENvbmRpdGlvbkF0KGkpCiAgICAgICAgfQogICAgICAgIElzRmlyc3RDb25kaXRpb25PZlR5cGUoY25kKSB7CiAgICAgICAgICAgIGxldCBpID0gY25kLkdldEluZGV4KCk7CiAgICAgICAgICAgIGlmIChpID09PSAwKSByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgLS1pOwogICAgICAgICAgICBjb25zdCBjbmRPYmplY3RDbGFzcyA9IGNuZC5HZXRPYmplY3RDbGFzcygpOwogICAgICAgICAgICBmb3IgKDsgaSA+PSAwOyAtLWkpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGMgPSB0aGlzLl9jb25kaXRpb25zW2ldOwogICAgICAgICAgICAgICAgaWYgKGMuR2V0T2JqZWN0Q2xhc3MoKSA9PT0gY25kT2JqZWN0Q2xhc3MgfHwgYy5Jc1N5c3RlbUNvbmRpdGlvbigpICYmIGMuR2V0Rmlyc3RPYmplY3RQYXJhbWV0ZXJPYmplY3RDbGFzcygpID09PSBjbmRPYmplY3RDbGFzcykgcmV0dXJuIGZhbHNlCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICB9CiAgICAgICAgR2V0QWN0aW9ucygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2FjdGlvbnMKICAgICAgICB9CiAgICAgICAgR2V0QWN0aW9uQ291bnQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9hY3Rpb25zLmxlbmd0aAogICAgICAgIH0KICAgICAgICBHZXRBY3Rpb25BdChpKSB7CiAgICAgICAgICAgIGkgPSBNYXRoLmZsb29yKGkpOwogICAgICAgICAgICBpZiAoaSA8IDAgfHwgaSA+PSB0aGlzLl9hY3Rpb25zLmxlbmd0aCkgdGhyb3cgbmV3IFJhbmdlRXJyb3IoImludmFsaWQgYWN0aW9uIGluZGV4Iik7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9hY3Rpb25zW2ldCiAgICAgICAgfQogICAgICAgIEdldEFjdGlvbkJ5RGVidWdJbmRleChpKSB7CiAgICAgICAgICAgIGkgPSBNYXRoLmZsb29yKGkpOwogICAgICAgICAgICBjb25zdCByZXQgPSB0aGlzLl9hY3Rpb25zLmZpbmQoYSA9PgogICAgICAgICAgICAgICAgYS5HZXREZWJ1Z0luZGV4KCkgPT09IGkpOwogICAgICAgICAgICBpZiAoIXJldCkgdGhyb3cgbmV3IFJhbmdlRXJyb3IoImludmFsaWQgYWN0aW9uIGRlYnVnIGluZGV4Iik7CiAgICAgICAgICAgIHJldHVybiByZXQKICAgICAgICB9CiAgICAgICAgX0hhc0FjdGlvbkluZGV4KGkpIHsKICAgICAgICAgICAgaSA9IE1hdGguZmxvb3IoaSk7CiAgICAgICAgICAgIHJldHVybiBpID49IDAgJiYgaSA8IHRoaXMuX2FjdGlvbnMubGVuZ3RoCiAgICAgICAgfQogICAgICAgIEdldFN1YkV2ZW50cygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3N1YkV2ZW50cwogICAgICAgIH0KICAgICAgICBfR2V0QWxsTG9jYWxWYXJpYWJsZXNJblNjb3BlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fc3ViRXZlbnRzLmZpbHRlcihlID0+IGUgaW5zdGFuY2VvZiBDMy5FdmVudFZhcmlhYmxlKQogICAgICAgIH0KICAgICAgICBSdW5QcmVUcmlnZ2VyKGZyYW1lKSB7CiAgICAgICAgICAgIGZyYW1lLlNldEN1cnJlbnRFdmVudCh0aGlzKTsKICAgICAgICAgICAgY29uc3QgY29uZGl0aW9ucyA9IHRoaXMuX2NvbmRpdGlvbnM7CiAgICAgICAgICAgIGxldCBpc0FueVRydWUgPSBjb25kaXRpb25zLmxlbmd0aCA9PT0gMDsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IGNvbmRpdGlvbnMubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGMgPSBjb25kaXRpb25zW2ldOwogICAgICAgICAgICAgICAgZnJhbWUuU2V0Q29uZGl0aW9uSW5kZXgoaSk7CiAgICAgICAgICAgICAgICBpZiAoYy5Jc0xvb3BpbmcoKSkgdGhyb3cgbmV3IEVycm9yKCJ0cmlnZ2VyIGNhbm5vdCBiZSB1c2VkIGFzIHN1Yi1ldmVudCB0byBhIGxvb3AiKTsKICAgICAgICAgICAgICAgIGlmIChjLlJ1bigpKSBpc0FueVRydWUgPSB0cnVlOwogICAgICAgICAgICAgICAgZWxzZSBpZiAoIXRoaXMuX2lzT3JCbG9jaykgcmV0dXJuIGZhbHNlCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2lzT3JCbG9jayA/IGlzQW55VHJ1ZSA6IHRydWUKICAgICAgICB9CiAgICAgICAgUnVuT3JCbG9ja1RyaWdnZXIoZnJhbWUsIGluZGV4KSB7CiAgICAgICAgICAgIGZyYW1lLlNldEN1cnJlbnRFdmVudCh0aGlzKTsKICAgICAgICAgICAgaWYgKHRoaXMuX2NvbmRpdGlvbnNbaW5kZXhdLlJ1bigpKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fUnVuQWN0aW9ucyhmcmFtZSwgMCkpIHRoaXMuX1J1blN1YkV2ZW50cyhmcmFtZSk7CiAgICAgICAgICAgICAgICBmcmFtZS5TZXRMYXN0RXZlbnRUcnVlKHRydWUpCiAgICAgICAgICAgIH0KICAgICAgICB9KiBEZWJ1Z1J1blByZVRyaWdnZXIoZnJhbWUpIHsKICAgICAgICAgICAgZnJhbWUuU2V0Q3VycmVudEV2ZW50KHRoaXMpOwogICAgICAgICAgICBjb25zdCBjb25kaXRpb25zID0gdGhpcy5fY29uZGl0aW9uczsKICAgICAgICAgICAgbGV0IGlzQW55VHJ1ZSA9IGNvbmRpdGlvbnMubGVuZ3RoID09PSAwOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0KICAgICAgICAgICAgICAgICAgICBjb25kaXRpb25zLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7CiAgICAgICAgICAgICAgICBjb25zdCBjID0gY29uZGl0aW9uc1tpXTsKICAgICAgICAgICAgICAgIGZyYW1lLlNldENvbmRpdGlvbkluZGV4KGkpOwogICAgICAgICAgICAgICAgaWYgKGMuSXNMb29waW5nKCkpIHRocm93IG5ldyBFcnJvcigidHJpZ2dlciBjYW5ub3QgYmUgdXNlZCBhcyBzdWItZXZlbnQgdG8gYSBsb29wIik7CiAgICAgICAgICAgICAgICBsZXQgcmV0OwogICAgICAgICAgICAgICAgaWYgKGMuRGVidWdDYW5SdW5GYXN0KCkpIHJldCA9IGMuUnVuKCk7CiAgICAgICAgICAgICAgICBlbHNlIHJldCA9IHlpZWxkKiBjLkRlYnVnUnVuKCk7CiAgICAgICAgICAgICAgICBpZiAocmV0KSBpc0FueVRydWUgPSB0cnVlOwogICAgICAgICAgICAgICAgZWxzZSBpZiAoIXRoaXMuX2lzT3JCbG9jaykgcmV0dXJuIGZhbHNlCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2lzT3JCbG9jayA/IGlzQW55VHJ1ZSA6IHRydWUKICAgICAgICB9KiBEZWJ1Z1J1bk9yQmxvY2tUcmlnZ2VyKGZyYW1lLCBpbmRleCkgewogICAgICAgICAgICBmcmFtZS5TZXRDdXJyZW50RXZlbnQodGhpcyk7CiAgICAgICAgICAgIGNvbnN0IGMgPSB0aGlzLl9jb25kaXRpb25zW2luZGV4XTsKICAgICAgICAgICAgbGV0IHJldDsKICAgICAgICAgICAgaWYgKGMuRGVidWdDYW5SdW5GYXN0KCkpIHJldCA9IGMuUnVuKCk7CiAgICAgICAgICAgIGVsc2UgcmV0ID0geWllbGQqIGMuRGVidWdSdW4oKTsKICAgICAgICAgICAgaWYgKHJldCkgewogICAgICAgICAgICAgICAgbGV0IGFjdFJldDsKICAgICAgICAgICAgICAgIGlmICh0aGlzLkRlYnVnQ2FuUnVuQWN0aW9uc0Zhc3QoKSkgYWN0UmV0ID0gdGhpcy5fUnVuQWN0aW9ucyhmcmFtZSwgMCk7CiAgICAgICAgICAgICAgICBlbHNlIGFjdFJldCA9IHlpZWxkKiB0aGlzLl9EZWJ1Z1J1bkFjdGlvbnMoZnJhbWUsIDApOwogICAgICAgICAgICAgICAgaWYgKGFjdFJldCkKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5EZWJ1Z0NhblJ1blN1YkV2ZW50c0Zhc3QoKSkgdGhpcy5fUnVuU3ViRXZlbnRzKCk7CiAgICAgICAgICAgICAgICAgICAgZWxzZSB5aWVsZCogdGhpcy5fRGVidWdSdW5TdWJFdmVudHMoKTsKICAgICAgICAgICAgICAgIGZyYW1lLlNldExhc3RFdmVudFRydWUodHJ1ZSkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBSdW4oZnJhbWUpIHsKICAgICAgICAgICAgZnJhbWUuU2V0Q3VycmVudEV2ZW50KHRoaXMpOwogICAgICAgICAgICBpZiAoIXRoaXMuX2lzRWxzZUJsb2NrKSBmcmFtZS5TZXRFbHNlQnJhbmNoUmFuKGZhbHNlKTsKICAgICAgICAgICAgaWYgKHRoaXMuX2lzT3JCbG9jaykgdGhpcy5fUnVuT3JCbG9jayhmcmFtZSk7CiAgICAgICAgICAgIGVsc2UgdGhpcy5fUnVuQW5kQmxvY2soZnJhbWUpCiAgICAgICAgfSogRGVidWdSdW4oZnJhbWUpIHsKICAgICAgICAgICAgaWYgKHRoaXMuSXNEZWJ1Z0JyZWFrcG9pbnQoKSB8fCB0aGlzLl9ydW50aW1lLkRlYnVnQnJlYWtOZXh0KCkpIHlpZWxkIHRoaXM7CiAgICAgICAgICAgIGZyYW1lLlNldEN1cnJlbnRFdmVudCh0aGlzKTsKICAgICAgICAgICAgaWYgKCF0aGlzLl9pc0Vsc2VCbG9jaykgZnJhbWUuU2V0RWxzZUJyYW5jaFJhbihmYWxzZSk7CiAgICAgICAgICAgIGlmICh0aGlzLl9pc09yQmxvY2spIHlpZWxkKiB0aGlzLl9EZWJ1Z1J1bk9yQmxvY2soZnJhbWUpOwogICAgICAgICAgICBlbHNlIHlpZWxkKiB0aGlzLl9EZWJ1Z1J1bkFuZEJsb2NrKGZyYW1lKQogICAgICAgIH0KICAgICAgICBfUnVuT3JCbG9jayhmcmFtZSkgewogICAgICAgICAgICBjb25zdCBjb25kaXRpb25zID0gdGhpcy5fY29uZGl0aW9uczsKICAgICAgICAgICAgbGV0IGlzQW55VHJ1ZSA9IGNvbmRpdGlvbnMubGVuZ3RoID09PSAwOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gY29uZGl0aW9ucy5sZW5ndGg7IGkgPCBsZW47ICsraSkgewogICAgICAgICAgICAgICAgY29uc3QgYyA9IGNvbmRpdGlvbnNbaV07CiAgICAgICAgICAgICAgICBpZiAoYy5Jc1RyaWdnZXIoKSkgY29udGludWU7CiAgICAgICAgICAgICAgICBmcmFtZS5TZXRDb25kaXRpb25JbmRleChpKTsKICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGMuUnVuKCk7CiAgICAgICAgICAgICAgICBpc0FueVRydWUgPSBpc0FueVRydWUgfHwgcmVzdWx0CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnJhbWUuU2V0TGFzdEV2ZW50VHJ1ZShpc0FueVRydWUpOwogICAgICAgICAgICBpZiAoaXNBbnlUcnVlKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fUnVuQWN0aW9ucyhmcmFtZSwgMCkpIHRoaXMuX1J1blN1YkV2ZW50cyhmcmFtZSk7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5faGFzRWxzZUJsb2NrKSBmcmFtZS5TZXRFbHNlQnJhbmNoUmFuKHRydWUpCiAgICAgICAgICAgIH0KICAgICAgICB9KiBfRGVidWdSdW5PckJsb2NrKGZyYW1lKSB7CiAgICAgICAgICAgIGNvbnN0IGNvbmRpdGlvbnMgPSB0aGlzLl9jb25kaXRpb25zOwogICAgICAgICAgICBsZXQgaXNBbnlUcnVlID0gY29uZGl0aW9ucy5sZW5ndGggPT09IDA7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBjb25kaXRpb25zLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7CiAgICAgICAgICAgICAgICBjb25zdCBjID0gY29uZGl0aW9uc1tpXTsKICAgICAgICAgICAgICAgIGlmIChjLklzVHJpZ2dlcigpKSBjb250aW51ZTsKICAgICAgICAgICAgICAgIGZyYW1lLlNldENvbmRpdGlvbkluZGV4KGkpOwogICAgICAgICAgICAgICAgbGV0IHJldDsKICAgICAgICAgICAgICAgIGlmIChjLkRlYnVnQ2FuUnVuRmFzdCgpKSByZXQgPSBjLlJ1bigpOwogICAgICAgICAgICAgICAgZWxzZSByZXQgPSB5aWVsZCogYy5EZWJ1Z1J1bigpOwogICAgICAgICAgICAgICAgaXNBbnlUcnVlID0gaXNBbnlUcnVlIHx8IHJldAogICAgICAgICAgICB9CiAgICAgICAgICAgIGZyYW1lLlNldExhc3RFdmVudFRydWUoaXNBbnlUcnVlKTsKICAgICAgICAgICAgaWYgKGlzQW55VHJ1ZSkgewogICAgICAgICAgICAgICAgbGV0IGFjdFJldDsKICAgICAgICAgICAgICAgIGlmICh0aGlzLkRlYnVnQ2FuUnVuQWN0aW9uc0Zhc3QoKSkgYWN0UmV0ID0gdGhpcy5fUnVuQWN0aW9ucyhmcmFtZSwgMCk7CiAgICAgICAgICAgICAgICBlbHNlIGFjdFJldCA9IHlpZWxkKiB0aGlzLl9EZWJ1Z1J1bkFjdGlvbnMoZnJhbWUsCiAgICAgICAgICAgICAgICAgICAgMCk7CiAgICAgICAgICAgICAgICBpZiAoYWN0UmV0KQogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLkRlYnVnQ2FuUnVuU3ViRXZlbnRzRmFzdCgpKSB0aGlzLl9SdW5TdWJFdmVudHMoKTsKICAgICAgICAgICAgICAgICAgICBlbHNlIHlpZWxkKiB0aGlzLl9EZWJ1Z1J1blN1YkV2ZW50cygpOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuX2hhc0Vsc2VCbG9jaykgZnJhbWUuU2V0RWxzZUJyYW5jaFJhbih0cnVlKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIF9SdW5BbmRCbG9jayhmcmFtZSkgewogICAgICAgICAgICBjb25zdCBjb25kaXRpb25zID0gdGhpcy5fY29uZGl0aW9uczsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IGNvbmRpdGlvbnMubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGMgPSBjb25kaXRpb25zW2ldOwogICAgICAgICAgICAgICAgZnJhbWUuU2V0Q29uZGl0aW9uSW5kZXgoaSk7CiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSBjLlJ1bigpOwogICAgICAgICAgICAgICAgaWYgKCFyZXN1bHQpIHsKICAgICAgICAgICAgICAgICAgICBmcmFtZS5TZXRMYXN0RXZlbnRUcnVlKGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmcmFtZS5TZXRMYXN0RXZlbnRUcnVlKHRydWUpOwogICAgICAgICAgICBpZiAodGhpcy5fUnVuQWN0aW9ucyhmcmFtZSwgMCkpIHRoaXMuX1J1blN1YkV2ZW50cyhmcmFtZSk7CiAgICAgICAgICAgIGlmIChmcmFtZS5HZXRMYXN0RXZlbnRUcnVlKCkgJiYgdGhpcy5faGFzRWxzZUJsb2NrKSBmcmFtZS5TZXRFbHNlQnJhbmNoUmFuKHRydWUpCiAgICAgICAgfSogX0RlYnVnUnVuQW5kQmxvY2soZnJhbWUpIHsKICAgICAgICAgICAgY29uc3QgY29uZGl0aW9ucyA9CiAgICAgICAgICAgICAgICB0aGlzLl9jb25kaXRpb25zOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gY29uZGl0aW9ucy5sZW5ndGg7IGkgPCBsZW47ICsraSkgewogICAgICAgICAgICAgICAgY29uc3QgYyA9IGNvbmRpdGlvbnNbaV07CiAgICAgICAgICAgICAgICBmcmFtZS5TZXRDb25kaXRpb25JbmRleChpKTsKICAgICAgICAgICAgICAgIGxldCByZXQ7CiAgICAgICAgICAgICAgICBpZiAoYy5EZWJ1Z0NhblJ1bkZhc3QoKSkgcmV0ID0gYy5SdW4oKTsKICAgICAgICAgICAgICAgIGVsc2UgcmV0ID0geWllbGQqIGMuRGVidWdSdW4oKTsKICAgICAgICAgICAgICAgIGlmICghcmV0KSB7CiAgICAgICAgICAgICAgICAgICAgZnJhbWUuU2V0TGFzdEV2ZW50VHJ1ZShmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnJhbWUuU2V0TGFzdEV2ZW50VHJ1ZSh0cnVlKTsKICAgICAgICAgICAgbGV0IGFjdFJldDsKICAgICAgICAgICAgaWYgKHRoaXMuRGVidWdDYW5SdW5BY3Rpb25zRmFzdCgpKSBhY3RSZXQgPSB0aGlzLl9SdW5BY3Rpb25zKGZyYW1lLCAwKTsKICAgICAgICAgICAgZWxzZSBhY3RSZXQgPSB5aWVsZCogdGhpcy5fRGVidWdSdW5BY3Rpb25zKGZyYW1lLCAwKTsKICAgICAgICAgICAgaWYgKGFjdFJldCkKICAgICAgICAgICAgICAgIGlmICh0aGlzLkRlYnVnQ2FuUnVuU3ViRXZlbnRzRmFzdCgpKSB0aGlzLl9SdW5TdWJFdmVudHMoKTsKICAgICAgICAgICAgICAgIGVsc2UgeWllbGQqIHRoaXMuX0RlYnVnUnVuU3ViRXZlbnRzKCk7CiAgICAgICAgICAgIGlmIChmcmFtZS5HZXRMYXN0RXZlbnRUcnVlKCkgJiYKICAgICAgICAgICAgICAgIHRoaXMuX2hhc0Vsc2VCbG9jaykgZnJhbWUuU2V0RWxzZUJyYW5jaFJhbih0cnVlKQogICAgICAgIH0KICAgICAgICBfUnVuQWN0aW9uc19GYXN0KGZyYW1lLCBzdGFydEluZGV4KSB7CiAgICAgICAgICAgIGNvbnN0IGFjdGlvbnMgPSB0aGlzLl9hY3Rpb25zOwogICAgICAgICAgICBmb3IgKGxldCBpID0gc3RhcnRJbmRleCwgbGVuID0gYWN0aW9ucy5sZW5ndGg7IGkgPCBsZW47ICsraSkgewogICAgICAgICAgICAgICAgY29uc3QgYSA9IGFjdGlvbnNbaV07CiAgICAgICAgICAgICAgICBmcmFtZS5TZXRBY3Rpb25JbmRleChpKTsKICAgICAgICAgICAgICAgIGEuUnVuKCkKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgIH0qIF9EZWJ1Z1J1bkFjdGlvbnNfRmFzdChmcmFtZSwgc3RhcnRJbmRleCkgewogICAgICAgICAgICBjb25zdCBhY3Rpb25zID0gdGhpcy5fYWN0aW9uczsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IHN0YXJ0SW5kZXgsIGxlbiA9IGFjdGlvbnMubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGEgPSBhY3Rpb25zW2ldOwogICAgICAgICAgICAgICAgZnJhbWUuU2V0QWN0aW9uSW5kZXgoaSk7CiAgICAgICAgICAgICAgICBpZiAoYS5EZWJ1Z0NhblJ1bkZhc3QoKSkgYS5SdW4oKTsKICAgICAgICAgICAgICAgIGVsc2UgeWllbGQqIGEuRGVidWdSdW4oKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgfQogICAgICAgIF9SdW5BY3Rpb25zX1JldHVyblZhbHVlKGZyYW1lLCBzdGFydEluZGV4KSB7CiAgICAgICAgICAgIGNvbnN0IGV2ZW50U2hlZXRNYW5hZ2VyID0KICAgICAgICAgICAgICAgIHRoaXMuR2V0RXZlbnRTaGVldE1hbmFnZXIoKTsKICAgICAgICAgICAgY29uc3QgYWN0aW9ucyA9IHRoaXMuX2FjdGlvbnM7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSBzdGFydEluZGV4LCBsZW4gPSBhY3Rpb25zLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7CiAgICAgICAgICAgICAgICBjb25zdCBhID0gYWN0aW9uc1tpXTsKICAgICAgICAgICAgICAgIGZyYW1lLlNldEFjdGlvbkluZGV4KGkpOwogICAgICAgICAgICAgICAgY29uc3QgcmV0ID0gYS5SdW4oKTsKICAgICAgICAgICAgICAgIGlmIChhLkNhbkJhaWxPdXQoKSAmJiByZXQgPT09IHRydWUpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIGVsc2UgaWYgKGEuSXNBc3luYygpICYmIHJldCBpbnN0YW5jZW9mIFByb21pc2UpIGV2ZW50U2hlZXRNYW5hZ2VyLkFkZEFzeW5jQWN0aW9uUHJvbWlzZShyZXQpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICB9KiBfRGVidWdSdW5BY3Rpb25zX1JldHVyblZhbHVlKGZyYW1lLCBzdGFydEluZGV4KSB7CiAgICAgICAgICAgIGNvbnN0IGV2ZW50U2hlZXRNYW5hZ2VyID0gdGhpcy5HZXRFdmVudFNoZWV0TWFuYWdlcigpOwogICAgICAgICAgICBjb25zdCBhY3Rpb25zID0gdGhpcy5fYWN0aW9uczsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IHN0YXJ0SW5kZXgsIGxlbiA9IGFjdGlvbnMubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGEgPSBhY3Rpb25zW2ldOwogICAgICAgICAgICAgICAgZnJhbWUuU2V0QWN0aW9uSW5kZXgoaSk7CiAgICAgICAgICAgICAgICBsZXQgcmV0OwogICAgICAgICAgICAgICAgaWYgKGEuRGVidWdDYW5SdW5GYXN0KCkpIHJldCA9IGEuUnVuKCk7CiAgICAgICAgICAgICAgICBlbHNlIHJldCA9IHlpZWxkKiBhLkRlYnVnUnVuKCk7CiAgICAgICAgICAgICAgICBpZiAoYS5DYW5CYWlsT3V0KCkgJiYgcmV0ID09PSB0cnVlKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICBlbHNlIGlmIChhLklzQXN5bmMoKSAmJiByZXQgaW5zdGFuY2VvZiBQcm9taXNlKSBldmVudFNoZWV0TWFuYWdlci5BZGRBc3luY0FjdGlvblByb21pc2UocmV0KQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgfQogICAgICAgIF9SZXN1bWVBY3Rpb25zQW5kU3ViRXZlbnRzKGZyYW1lKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9SdW5BY3Rpb25zKGZyYW1lLCBmcmFtZS5HZXRBY3Rpb25JbmRleCgpKSkgdGhpcy5fUnVuU3ViRXZlbnRzKCkKICAgICAgICB9KiBfRGVidWdSZXN1bWVBY3Rpb25zQW5kU3ViRXZlbnRzKGZyYW1lKSB7CiAgICAgICAgICAgIGlmICh5aWVsZCogdGhpcy5fRGVidWdSdW5BY3Rpb25zKGZyYW1lLCBmcmFtZS5HZXRBY3Rpb25JbmRleCgpKSkgeWllbGQqIHRoaXMuX0RlYnVnUnVuU3ViRXZlbnRzKCkKICAgICAgICB9CiAgICAgICAgX1J1blN1YkV2ZW50cygpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLl9zdWJFdmVudHMubGVuZ3RoKSByZXR1cm47CiAgICAgICAgICAgIGNvbnN0IHByb2ZpbGUgPSB0aGlzLklzR3JvdXAoKSAmJiB0aGlzLl9ydW50aW1lLklzQ1BVUHJvZmlsaW5nKCk7CiAgICAgICAgICAgIGNvbnN0IHN0YXJ0VGltZSA9IHByb2ZpbGUgPyBwZXJmb3JtYW5jZS5ub3coKSA6IDA7CiAgICAgICAgICAgIGNvbnN0IGV2ZW50U3RhY2sgPSB0aGlzLl9ldmVudFN0YWNrOwogICAgICAgICAgICBjb25zdCBmcmFtZSA9IGV2ZW50U3RhY2suUHVzaCh0aGlzKTsKICAgICAgICAgICAgaWYgKHRoaXMuX2lzU29sV3JpdGVyQWZ0ZXJDbmRzKSB0aGlzLl9SdW5TdWJFdmVudHNfU29sV3JpdGVyQWZ0ZXJDbmRzKGZyYW1lKTsKICAgICAgICAgICAgZWxzZSB0aGlzLl9SdW5TdWJFdmVudHNfRmFzdChmcmFtZSk7CiAgICAgICAgICAgIGV2ZW50U3RhY2suUG9wKCk7CiAgICAgICAgICAgIGlmIChwcm9maWxlKSB0aGlzLl9wZXJmUmVjb3JkLnRvdGFsVGltZUNvdW50ZXIgKz0gcGVyZm9ybWFuY2Uubm93KCkgLSBzdGFydFRpbWUKICAgICAgICB9CiAgICAgICAgX1J1blN1YkV2ZW50c19Tb2xXcml0ZXJBZnRlckNuZHMoZnJhbWUpIHsKICAgICAgICAgICAgY29uc3QgaXNHcm91cCA9IHRoaXMuX2lzR3JvdXA7CiAgICAgICAgICAgIGNvbnN0IGlzVG9wTGV2ZWxHcm91cCA9IHRoaXMuX2lzVG9wTGV2ZWxHcm91cDsKICAgICAgICAgICAgY29uc3QgZXZlbnRTaGVldE1hbmFnZXIgPQogICAgICAgICAgICAgICAgdGhpcy5HZXRFdmVudFNoZWV0TWFuYWdlcigpOwogICAgICAgICAgICBjb25zdCBzdWJFdmVudHMgPSB0aGlzLl9zdWJFdmVudHM7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBzdWJFdmVudHMubGVuZ3RoLCBsYXN0ID0gbGVuIC0gMTsgaSA8IGxlbjsgKytpKSB7CiAgICAgICAgICAgICAgICBjb25zdCBlID0gc3ViRXZlbnRzW2ldOwogICAgICAgICAgICAgICAgY29uc3Qgc29sTW9kaWZpZXJzID0gZS5HZXRTb2xNb2RpZmllcnMoKTsKICAgICAgICAgICAgICAgIGNvbnN0IGNvcHlTb2wgPSAhaXNUb3BMZXZlbEdyb3VwIHx8ICFpc0dyb3VwICYmIGkgPCBsYXN0OwogICAgICAgICAgICAgICAgaWYgKGNvcHlTb2wpIGV2ZW50U2hlZXRNYW5hZ2VyLlB1c2hDb3B5U29sKHNvbE1vZGlmaWVycyk7CiAgICAgICAgICAgICAgICBlLlJ1bihmcmFtZSk7CiAgICAgICAgICAgICAgICBpZiAoY29weVNvbCkgZXZlbnRTaGVldE1hbmFnZXIuUG9wU29sKHNvbE1vZGlmaWVycyk7CiAgICAgICAgICAgICAgICBlbHNlIGV2ZW50U2hlZXRNYW5hZ2VyLkNsZWFyU29sKHNvbE1vZGlmaWVycykKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBfUnVuU3ViRXZlbnRzX0Zhc3QoZnJhbWUpIHsKICAgICAgICAgICAgY29uc3Qgc3ViRXZlbnRzID0gdGhpcy5fc3ViRXZlbnRzOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gc3ViRXZlbnRzLmxlbmd0aDsgaSA8IGxlbjsgKytpKSBzdWJFdmVudHNbaV0uUnVuKGZyYW1lKQogICAgICAgIH0qIF9EZWJ1Z1J1blN1YkV2ZW50cygpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLl9zdWJFdmVudHMubGVuZ3RoKSByZXR1cm47CiAgICAgICAgICAgIGNvbnN0IGV2ZW50U3RhY2sgPSB0aGlzLl9ldmVudFN0YWNrOwogICAgICAgICAgICBjb25zdCBmcmFtZSA9IGV2ZW50U3RhY2suUHVzaCh0aGlzKTsKICAgICAgICAgICAgaWYgKHRoaXMuX2lzU29sV3JpdGVyQWZ0ZXJDbmRzKSB5aWVsZCogdGhpcy5fRGVidWdSdW5TdWJFdmVudHNfU29sV3JpdGVyQWZ0ZXJDbmRzKGZyYW1lKTsKICAgICAgICAgICAgZWxzZSB5aWVsZCogdGhpcy5fRGVidWdSdW5TdWJFdmVudHNfRmFzdChmcmFtZSk7CiAgICAgICAgICAgIGV2ZW50U3RhY2suUG9wKCkKICAgICAgICB9KiBfRGVidWdSdW5TdWJFdmVudHNfU29sV3JpdGVyQWZ0ZXJDbmRzKGZyYW1lKSB7CiAgICAgICAgICAgIGNvbnN0IGlzR3JvdXAgPSB0aGlzLl9pc0dyb3VwOwogICAgICAgICAgICBjb25zdCBpc1RvcExldmVsR3JvdXAgPSB0aGlzLl9pc1RvcExldmVsR3JvdXA7CiAgICAgICAgICAgIGNvbnN0IGV2ZW50U2hlZXRNYW5hZ2VyID0gdGhpcy5HZXRFdmVudFNoZWV0TWFuYWdlcigpOwogICAgICAgICAgICBjb25zdCBzdWJFdmVudHMgPSB0aGlzLl9zdWJFdmVudHM7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBzdWJFdmVudHMubGVuZ3RoLCBsYXN0ID0gbGVuIC0gMTsgaSA8IGxlbjsgKytpKSB7CiAgICAgICAgICAgICAgICBjb25zdCBlID0gc3ViRXZlbnRzW2ldOwogICAgICAgICAgICAgICAgY29uc3Qgc29sTW9kaWZpZXJzID0KICAgICAgICAgICAgICAgICAgICBlLkdldFNvbE1vZGlmaWVycygpOwogICAgICAgICAgICAgICAgY29uc3QgY29weVNvbCA9ICFpc1RvcExldmVsR3JvdXAgfHwgIWlzR3JvdXAgJiYgaSA8IGxhc3Q7CiAgICAgICAgICAgICAgICBpZiAoY29weVNvbCkgZXZlbnRTaGVldE1hbmFnZXIuUHVzaENvcHlTb2woc29sTW9kaWZpZXJzKTsKICAgICAgICAgICAgICAgIHlpZWxkKiBlLkRlYnVnUnVuKGZyYW1lKTsKICAgICAgICAgICAgICAgIGlmIChjb3B5U29sKSBldmVudFNoZWV0TWFuYWdlci5Qb3BTb2woc29sTW9kaWZpZXJzKTsKICAgICAgICAgICAgICAgIGVsc2UgZXZlbnRTaGVldE1hbmFnZXIuQ2xlYXJTb2woc29sTW9kaWZpZXJzKQogICAgICAgICAgICB9CiAgICAgICAgfSogX0RlYnVnUnVuU3ViRXZlbnRzX0Zhc3QoZnJhbWUpIHsKICAgICAgICAgICAgY29uc3Qgc3ViRXZlbnRzID0gdGhpcy5fc3ViRXZlbnRzOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gc3ViRXZlbnRzLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB5aWVsZCogc3ViRXZlbnRzW2ldLkRlYnVnUnVuKGZyYW1lKQogICAgICAgIH0KICAgICAgICBSZXRyaWdnZXIob2xkRnJhbWUsIG5ld0ZyYW1lKSB7CiAgICAgICAgICAgIG5ld0ZyYW1lLlJlc2V0UXVpY2soKTsKICAgICAgICAgICAgY29uc3QgY29uZGl0aW9ucyA9IHRoaXMuX2NvbmRpdGlvbnM7CiAgICAgICAgICAgIGlmICghdGhpcy5Jc09yQmxvY2soKSkKICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPQogICAgICAgICAgICAgICAgICAgICAgICBvbGRGcmFtZS5HZXRDb25kaXRpb25JbmRleCgpICsgMSwgbGVuID0gY29uZGl0aW9ucy5sZW5ndGg7IGkgPCBsZW47ICsraSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGMgPSBjb25kaXRpb25zW2ldOwogICAgICAgICAgICAgICAgICAgIG5ld0ZyYW1lLlNldENvbmRpdGlvbkluZGV4KGkpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGMuUnVuKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFyZXN1bHQpIHJldHVybiBmYWxzZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGhpcy5fUnVuQWN0aW9ucyhuZXdGcmFtZSwgMCkpIHRoaXMuX1J1blN1YkV2ZW50cyhuZXdGcmFtZSk7CiAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgfSogRGVidWdSZXRyaWdnZXIob2xkRnJhbWUsIG5ld0ZyYW1lKSB7CiAgICAgICAgICAgIG5ld0ZyYW1lLlJlc2V0UXVpY2soKTsKICAgICAgICAgICAgY29uc3QgY29uZGl0aW9ucyA9IHRoaXMuX2NvbmRpdGlvbnM7CiAgICAgICAgICAgIGlmICghdGhpcy5Jc09yQmxvY2soKSkKICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSBvbGRGcmFtZS5HZXRDb25kaXRpb25JbmRleCgpICsgMSwgbGVuID0gY29uZGl0aW9ucy5sZW5ndGg7IGkgPCBsZW47ICsraSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGMgPSBjb25kaXRpb25zW2ldOwogICAgICAgICAgICAgICAgICAgIG5ld0ZyYW1lLlNldENvbmRpdGlvbkluZGV4KGkpOwogICAgICAgICAgICAgICAgICAgIGxldCByZXQ7CiAgICAgICAgICAgICAgICAgICAgaWYgKGMuRGVidWdDYW5SdW5GYXN0KCkpIHJldCA9CiAgICAgICAgICAgICAgICAgICAgICAgIGMuUnVuKCk7CiAgICAgICAgICAgICAgICAgICAgZWxzZSByZXQgPSB5aWVsZCogYy5EZWJ1Z1J1bigpOwogICAgICAgICAgICAgICAgICAgIGlmICghcmV0KSByZXR1cm4gZmFsc2UKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgbGV0IGFjdFJldDsKICAgICAgICAgICAgaWYgKHRoaXMuRGVidWdDYW5SdW5BY3Rpb25zRmFzdCgpKSBhY3RSZXQgPSB0aGlzLl9SdW5BY3Rpb25zKG5ld0ZyYW1lLCAwKTsKICAgICAgICAgICAgZWxzZSBhY3RSZXQgPSB5aWVsZCogdGhpcy5fRGVidWdSdW5BY3Rpb25zKG5ld0ZyYW1lLCAwKTsKICAgICAgICAgICAgaWYgKGFjdFJldCkKICAgICAgICAgICAgICAgIGlmICh0aGlzLkRlYnVnQ2FuUnVuU3ViRXZlbnRzRmFzdCgpKSB0aGlzLl9SdW5TdWJFdmVudHMoKTsKICAgICAgICAgICAgICAgIGVsc2UgeWllbGQqIHRoaXMuX0RlYnVnUnVuU3ViRXZlbnRzKCk7CiAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgfQogICAgICAgIERlYnVnQ2FuUnVuRmFzdCgpIHsKICAgICAgICAgICAgcmV0dXJuICF0aGlzLklzRGVidWdCcmVha3BvaW50KCkgJiYgIXRoaXMuX3J1bnRpbWUuRGVidWdCcmVha05leHQoKSAmJiB0aGlzLl9kZWJ1Z0RhdGEuY2FuUnVuU2VsZkZhc3QKICAgICAgICB9CiAgICAgICAgRGVidWdDYW5SdW5BY3Rpb25zRmFzdCgpIHsKICAgICAgICAgICAgcmV0dXJuICF0aGlzLl9ydW50aW1lLkRlYnVnQnJlYWtOZXh0KCkgJiYgdGhpcy5fZGVidWdEYXRhLmNhblJ1bkFsbEFjdGlvbnNGYXN0CiAgICAgICAgfQogICAgICAgIERlYnVnQ2FuUnVuU3ViRXZlbnRzRmFzdCgpIHsKICAgICAgICAgICAgcmV0dXJuICF0aGlzLl9ydW50aW1lLkRlYnVnQnJlYWtOZXh0KCkgJiYKICAgICAgICAgICAgICAgIHRoaXMuX2RlYnVnRGF0YS5jYW5SdW5BbGxTdWJFdmVudHNGYXN0CiAgICAgICAgfQogICAgICAgIF9DaGVja1BhcmVudHNPS1RvUnVuKGZyYW1lKSB7CiAgICAgICAgICAgIGlmICh0aGlzLkdldFBhcmVudCgpKSB7CiAgICAgICAgICAgICAgICBjb25zdCBwYXJlbnRzID0gdGhpcy5HZXRUcmlnZ2VyUGFyZW50cygpOwogICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IHBhcmVudHMubGVuZ3RoOyBpIDwgbGVuOyArK2kpCiAgICAgICAgICAgICAgICAgICAgaWYgKCFwYXJlbnRzW2ldLlJ1blByZVRyaWdnZXIoZnJhbWUpKSByZXR1cm4gZmFsc2UKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgIH0qIF9EZWJ1Z0NoZWNrUGFyZW50c09LVG9SdW4oZnJhbWUpIHsKICAgICAgICAgICAgaWYgKHRoaXMuR2V0UGFyZW50KCkpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHBhcmVudHMgPSB0aGlzLkdldFRyaWdnZXJQYXJlbnRzKCk7CiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gcGFyZW50cy5sZW5ndGg7IGkgPCBsZW47ICsraSkKICAgICAgICAgICAgICAgICAgICBpZiAoISh5aWVsZCogcGFyZW50c1tpXS5EZWJ1Z1J1blByZVRyaWdnZXIoZnJhbWUpKSkgcmV0dXJuIGZhbHNlCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICB9CiAgICAgICAgX0V2YWx1YXRlRnVuY3Rpb25DYWxsUGFyYW1ldGVycyhldmVudFNoZWV0TWFuYWdlciwgcGFyYW1ldGVycywgaXNSZWN1cnNpdmUpIHsKICAgICAgICAgICAgaWYgKHBhcmFtZXRlcnMubGVuZ3RoID4KICAgICAgICAgICAgICAgIDApCiAgICAgICAgICAgICAgICBpZiAoaXNSZWN1cnNpdmUpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBwYXJhbVJlc3VsdHMgPSBwYXJhbWV0ZXJzLm1hcChwID0+IHAuR2V0KDApKTsKICAgICAgICAgICAgICAgICAgICBldmVudFNoZWV0TWFuYWdlci5HZXRMb2NhbFZhclN0YWNrKCkuUHVzaCgpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3Njb3BlUGFyZW50LlNldEZ1bmN0aW9uUGFyYW1ldGVycyhwYXJhbVJlc3VsdHMpCiAgICAgICAgICAgICAgICB9IGVsc2UgdGhpcy5fc2NvcGVQYXJlbnQuRXZhbHVhdGVGdW5jdGlvblBhcmFtZXRlcnMocGFyYW1ldGVycyk7CiAgICAgICAgICAgIGVsc2UgaWYgKGlzUmVjdXJzaXZlKSBldmVudFNoZWV0TWFuYWdlci5HZXRMb2NhbFZhclN0YWNrKCkuUHVzaCgpCiAgICAgICAgfQogICAgICAgIFJ1bkFzRnVuY3Rpb25DYWxsKGNvbWJpbmVkU29sTW9kaWZpZXJzLCBwYXJhbWV0ZXJzLCBpc0NvcHlQaWNrZWQsIHBpY2tJbmZvKSB7CiAgICAgICAgICAgIGxldCByZXQ7CiAgICAgICAgICAgIGxldCBhc3luY0lkOwogICAgICAgICAgICBjb25zdCBoYXNBbnlTb2xNb2RpZmllcnMgPSBjb21iaW5lZFNvbE1vZGlmaWVycy5sZW5ndGggPiAwOwogICAgICAgICAgICBsZXQgZXh0cmFQb3BTb2xNb2RpZmllcnMgPSBudWxsOwogICAgICAgICAgICBjb25zdCBydW50aW1lID0gdGhpcy5fcnVudGltZTsKICAgICAgICAgICAgY29uc3QgZXZlbnRTdGFjayA9CiAgICAgICAgICAgICAgICB0aGlzLl9ldmVudFN0YWNrOwogICAgICAgICAgICBjb25zdCBldmVudFNoZWV0TWFuYWdlciA9IHJ1bnRpbWUuR2V0RXZlbnRTaGVldE1hbmFnZXIoKTsKICAgICAgICAgICAgY29uc3QgdHJpZ2dlckRlcHRoID0gZXZlbnRTaGVldE1hbmFnZXIuX0luY1RyaWdnZXJEZXB0aCgpOwogICAgICAgICAgICBjb25zdCBpc1JlY3Vyc2l2ZSA9IHRyaWdnZXJEZXB0aCA+IDE7CiAgICAgICAgICAgIHRoaXMuX0V2YWx1YXRlRnVuY3Rpb25DYWxsUGFyYW1ldGVycyhldmVudFNoZWV0TWFuYWdlciwgcGFyYW1ldGVycywgaXNSZWN1cnNpdmUpOwogICAgICAgICAgICBpZiAoaGFzQW55U29sTW9kaWZpZXJzKQogICAgICAgICAgICAgICAgaWYgKGlzQ29weVBpY2tlZCkgZXZlbnRTaGVldE1hbmFnZXIuUHVzaENvcHlTb2woY29tYmluZWRTb2xNb2RpZmllcnMpOwogICAgICAgICAgICAgICAgZWxzZSBldmVudFNoZWV0TWFuYWdlci5QdXNoQ2xlYW5Tb2woY29tYmluZWRTb2xNb2RpZmllcnMpOwogICAgICAgICAgICBpZiAocGlja0luZm8gIT09IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmIChwaWNrSW5mby5jb3B5RnJvbU9iamVjdENsYXNzKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29weUZyb21Tb2wgPSBpc0NvcHlQaWNrZWQgPyBwaWNrSW5mby5jb3B5RnJvbU9iamVjdENsYXNzLkdldEN1cnJlbnRTb2woKSA6CiAgICAgICAgICAgICAgICAgICAgICAgIHBpY2tJbmZvLmNvcHlGcm9tT2JqZWN0Q2xhc3MuR2V0U29sU3RhY2soKS5HZXRPbmVCZWxvd0N1cnJlbnRTb2woKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBjb3B5VG9Tb2wgPSBwaWNrSW5mby5jb3B5VG9PYmplY3RDbGFzcy5HZXRDdXJyZW50U29sKCk7CiAgICAgICAgICAgICAgICAgICAgY29weVRvU29sLlNldEFycmF5UGlja2VkKGNvcHlGcm9tU29sLkdldEluc3RhbmNlcygpKTsKICAgICAgICAgICAgICAgICAgICBjb3B5VG9Tb2wuQ2xlYXJFbHNlSW5zdGFuY2VzKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFpc0NvcHlQaWNrZWQpIHBpY2tJbmZvLmNvcHlUb09iamVjdENsYXNzLkFwcGx5U29sVG9Db250YWluZXIoKQogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChwaWNrSW5mby5waWNrT2JqZWN0Q2xhc3MpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBvYmplY3RDbGFzc1NvbCA9IHBpY2tJbmZvLnBpY2tPYmplY3RDbGFzcy5HZXRDdXJyZW50U29sKCk7CiAgICAgICAgICAgICAgICAgICAgb2JqZWN0Q2xhc3NTb2wuU2V0QXJyYXlQaWNrZWQocGlja0luZm8ucGlja0luc3RhbmNlcyk7CiAgICAgICAgICAgICAgICAgICAgb2JqZWN0Q2xhc3NTb2wuQ2xlYXJFbHNlSW5zdGFuY2VzKCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChwaWNrSW5mby5wdXNoQ2xlYW5Tb2xEeW5hbWljKSBleHRyYVBvcFNvbE1vZGlmaWVycyA9CiAgICAgICAgICAgICAgICAgICAgZXZlbnRTaGVldE1hbmFnZXIuUHVzaENsZWFuU29sRHluYW1pYyhjb21iaW5lZFNvbE1vZGlmaWVycykKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBmcmFtZSA9IGV2ZW50U3RhY2suUHVzaCh0aGlzKTsKICAgICAgICAgICAgaWYgKGlzQ29weVBpY2tlZCkgZnJhbWUuU2V0RHluYW1pY1NvbE1vZGlmaWVycyhjb21iaW5lZFNvbE1vZGlmaWVycyk7CiAgICAgICAgICAgIGlmICh0aGlzLl9DaGVja1BhcmVudHNPS1RvUnVuKGZyYW1lKSkgewogICAgICAgICAgICAgICAgZnJhbWUuU2V0Q3VycmVudEV2ZW50KHRoaXMpOwogICAgICAgICAgICAgICAgY29uc3QgaXNBc3luYyA9IHRoaXMuX3Njb3BlUGFyZW50LklzQXN5bmMoKTsKICAgICAgICAgICAgICAgIGlmIChpc0FzeW5jKVthc3luY0lkLCByZXRdID0gdGhpcy5fc2NvcGVQYXJlbnQuU3RhcnRBc3luY0Z1bmN0aW9uQ2FsbCgpOwogICAgICAgICAgICAgICAgdGhpcy5fUnVuQW5kQmxvY2soZnJhbWUpOwogICAgICAgICAgICAgICAgaWYgKGlzQXN5bmMpIHRoaXMuX3Njb3BlUGFyZW50Lk1heWJlRmluaXNoQXN5bmNGdW5jdGlvbkNhbGwoYXN5bmNJZCkKICAgICAgICAgICAgfQogICAgICAgICAgICBldmVudFN0YWNrLlBvcCgpOwogICAgICAgICAgICBpZiAoaXNSZWN1cnNpdmUpIGV2ZW50U2hlZXRNYW5hZ2VyLkdldExvY2FsVmFyU3RhY2soKS5Qb3AoKTsKICAgICAgICAgICAgaWYgKGV4dHJhUG9wU29sTW9kaWZpZXJzICE9PSBudWxsKSBldmVudFNoZWV0TWFuYWdlci5Qb3BTb2woZXh0cmFQb3BTb2xNb2RpZmllcnMpOwogICAgICAgICAgICBpZiAoaGFzQW55U29sTW9kaWZpZXJzKSBldmVudFNoZWV0TWFuYWdlci5Qb3BTb2woY29tYmluZWRTb2xNb2RpZmllcnMpOwogICAgICAgICAgICBldmVudFNoZWV0TWFuYWdlci5fRGVjVHJpZ2dlckRlcHRoKCk7CiAgICAgICAgICAgIHJldHVybiByZXQKICAgICAgICB9KiBEZWJ1Z1J1bkFzRnVuY3Rpb25DYWxsKGNvbWJpbmVkU29sTW9kaWZpZXJzLCBwYXJhbWV0ZXJzLCBpc0NvcHlQaWNrZWQsIHBpY2tJbmZvKSB7CiAgICAgICAgICAgIGxldCByZXQ7CiAgICAgICAgICAgIGxldCBhc3luY0lkOwogICAgICAgICAgICBpZiAodGhpcy5Jc0RlYnVnQnJlYWtwb2ludCgpIHx8IHRoaXMuX3J1bnRpbWUuRGVidWdCcmVha05leHQoKSkgeWllbGQgdGhpczsKICAgICAgICAgICAgY29uc3QgaGFzQW55U29sTW9kaWZpZXJzID0gY29tYmluZWRTb2xNb2RpZmllcnMubGVuZ3RoID4gMDsKICAgICAgICAgICAgbGV0IGV4dHJhUG9wU29sTW9kaWZpZXJzID0gbnVsbDsKICAgICAgICAgICAgY29uc3QgcnVudGltZSA9IHRoaXMuX3J1bnRpbWU7CiAgICAgICAgICAgIGNvbnN0IGV2ZW50U3RhY2sgPSB0aGlzLl9ldmVudFN0YWNrOwogICAgICAgICAgICBjb25zdCBldmVudFNoZWV0TWFuYWdlciA9IHJ1bnRpbWUuR2V0RXZlbnRTaGVldE1hbmFnZXIoKTsKICAgICAgICAgICAgY29uc3QgdHJpZ2dlckRlcHRoID0gZXZlbnRTaGVldE1hbmFnZXIuX0luY1RyaWdnZXJEZXB0aCgpOwogICAgICAgICAgICBjb25zdCBpc1JlY3Vyc2l2ZSA9IHRyaWdnZXJEZXB0aCA+IDE7CiAgICAgICAgICAgIHRoaXMuX0V2YWx1YXRlRnVuY3Rpb25DYWxsUGFyYW1ldGVycyhldmVudFNoZWV0TWFuYWdlciwgcGFyYW1ldGVycywgaXNSZWN1cnNpdmUpOwogICAgICAgICAgICBpZiAoaGFzQW55U29sTW9kaWZpZXJzKQogICAgICAgICAgICAgICAgaWYgKGlzQ29weVBpY2tlZCkgZXZlbnRTaGVldE1hbmFnZXIuUHVzaENvcHlTb2woY29tYmluZWRTb2xNb2RpZmllcnMpOwogICAgICAgICAgICAgICAgZWxzZSBldmVudFNoZWV0TWFuYWdlci5QdXNoQ2xlYW5Tb2woY29tYmluZWRTb2xNb2RpZmllcnMpOwogICAgICAgICAgICBpZiAocGlja0luZm8gIT09IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmIChwaWNrSW5mby5jb3B5RnJvbU9iamVjdENsYXNzKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29weUZyb21Tb2wgPSBpc0NvcHlQaWNrZWQgPyBwaWNrSW5mby5jb3B5RnJvbU9iamVjdENsYXNzLkdldEN1cnJlbnRTb2woKSA6IHBpY2tJbmZvLmNvcHlGcm9tT2JqZWN0Q2xhc3MuR2V0U29sU3RhY2soKS5HZXRPbmVCZWxvd0N1cnJlbnRTb2woKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBjb3B5VG9Tb2wgPSBwaWNrSW5mby5jb3B5VG9PYmplY3RDbGFzcy5HZXRDdXJyZW50U29sKCk7CiAgICAgICAgICAgICAgICAgICAgY29weVRvU29sLlNldEFycmF5UGlja2VkKGNvcHlGcm9tU29sLkdldEluc3RhbmNlcygpKTsKICAgICAgICAgICAgICAgICAgICBjb3B5VG9Tb2wuQ2xlYXJFbHNlSW5zdGFuY2VzKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFpc0NvcHlQaWNrZWQpIHBpY2tJbmZvLmNvcHlUb09iamVjdENsYXNzLkFwcGx5U29sVG9Db250YWluZXIoKQogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChwaWNrSW5mby5waWNrT2JqZWN0Q2xhc3MpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBvYmplY3RDbGFzc1NvbCA9IHBpY2tJbmZvLnBpY2tPYmplY3RDbGFzcy5HZXRDdXJyZW50U29sKCk7CiAgICAgICAgICAgICAgICAgICAgb2JqZWN0Q2xhc3NTb2wuU2V0QXJyYXlQaWNrZWQocGlja0luZm8ucGlja0luc3RhbmNlcyk7CiAgICAgICAgICAgICAgICAgICAgb2JqZWN0Q2xhc3NTb2wuQ2xlYXJFbHNlSW5zdGFuY2VzKCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChwaWNrSW5mby5wdXNoQ2xlYW5Tb2xEeW5hbWljKSBleHRyYVBvcFNvbE1vZGlmaWVycyA9IGV2ZW50U2hlZXRNYW5hZ2VyLlB1c2hDbGVhblNvbER5bmFtaWMoY29tYmluZWRTb2xNb2RpZmllcnMpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgZnJhbWUgPQogICAgICAgICAgICAgICAgZXZlbnRTdGFjay5QdXNoKHRoaXMpOwogICAgICAgICAgICBpZiAoaXNDb3B5UGlja2VkKSBmcmFtZS5TZXREeW5hbWljU29sTW9kaWZpZXJzKGNvbWJpbmVkU29sTW9kaWZpZXJzKTsKICAgICAgICAgICAgaWYgKHlpZWxkKiB0aGlzLl9EZWJ1Z0NoZWNrUGFyZW50c09LVG9SdW4oZnJhbWUpKSB7CiAgICAgICAgICAgICAgICBmcmFtZS5TZXRDdXJyZW50RXZlbnQodGhpcyk7CiAgICAgICAgICAgICAgICBjb25zdCBpc0FzeW5jID0gdGhpcy5fc2NvcGVQYXJlbnQuSXNBc3luYygpOwogICAgICAgICAgICAgICAgaWYgKGlzQXN5bmMpW2FzeW5jSWQsIHJldF0gPSB0aGlzLl9zY29wZVBhcmVudC5TdGFydEFzeW5jRnVuY3Rpb25DYWxsKCk7CiAgICAgICAgICAgICAgICB5aWVsZCogdGhpcy5fRGVidWdSdW5BbmRCbG9jayhmcmFtZSk7CiAgICAgICAgICAgICAgICBpZiAoaXNBc3luYykgdGhpcy5fc2NvcGVQYXJlbnQuTWF5YmVGaW5pc2hBc3luY0Z1bmN0aW9uQ2FsbChhc3luY0lkKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGV2ZW50U3RhY2suUG9wKCk7CiAgICAgICAgICAgIGlmIChpc1JlY3Vyc2l2ZSkgZXZlbnRTaGVldE1hbmFnZXIuR2V0TG9jYWxWYXJTdGFjaygpLlBvcCgpOwogICAgICAgICAgICBpZiAoZXh0cmFQb3BTb2xNb2RpZmllcnMgIT09IG51bGwpIGV2ZW50U2hlZXRNYW5hZ2VyLlBvcFNvbChleHRyYVBvcFNvbE1vZGlmaWVycyk7CiAgICAgICAgICAgIGlmIChoYXNBbnlTb2xNb2RpZmllcnMpIGV2ZW50U2hlZXRNYW5hZ2VyLlBvcFNvbChjb21iaW5lZFNvbE1vZGlmaWVycyk7CiAgICAgICAgICAgIGV2ZW50U2hlZXRNYW5hZ2VyLl9EZWNUcmlnZ2VyRGVwdGgoKTsKICAgICAgICAgICAgcmV0dXJuIHJldAogICAgICAgIH0KICAgICAgICBSdW5Bc01hcHBlZEZ1bmN0aW9uQ2FsbChwYXJhbVJlc3VsdHMsIGlzQ29weVBpY2tlZCkgewogICAgICAgICAgICBjb25zdCBzb2xNb2RpZmllcnMgPSB0aGlzLkdldFNvbE1vZGlmaWVyc0luY2x1ZGluZ1BhcmVudHMoKTsKICAgICAgICAgICAgY29uc3QgaGFzQW55U29sTW9kaWZpZXJzID0gc29sTW9kaWZpZXJzLmxlbmd0aCA+IDA7CiAgICAgICAgICAgIGNvbnN0IHJ1bnRpbWUgPSB0aGlzLl9ydW50aW1lOwogICAgICAgICAgICBjb25zdCBldmVudFN0YWNrID0gdGhpcy5fZXZlbnRTdGFjazsKICAgICAgICAgICAgY29uc3QgZXZlbnRTaGVldE1hbmFnZXIgPSBydW50aW1lLkdldEV2ZW50U2hlZXRNYW5hZ2VyKCk7CiAgICAgICAgICAgIGNvbnN0IHRyaWdnZXJEZXB0aCA9IGV2ZW50U2hlZXRNYW5hZ2VyLl9JbmNUcmlnZ2VyRGVwdGgoKTsKICAgICAgICAgICAgY29uc3QgaXNSZWN1cnNpdmUgPSB0cmlnZ2VyRGVwdGggPiAxOwogICAgICAgICAgICBpZiAoaXNSZWN1cnNpdmUpIGV2ZW50U2hlZXRNYW5hZ2VyLkdldExvY2FsVmFyU3RhY2soKS5QdXNoKCk7CiAgICAgICAgICAgIHRoaXMuX3Njb3BlUGFyZW50LlNldEZ1bmN0aW9uUGFyYW1ldGVycyhwYXJhbVJlc3VsdHMpOwogICAgICAgICAgICBpZiAoaGFzQW55U29sTW9kaWZpZXJzKQogICAgICAgICAgICAgICAgaWYgKGlzQ29weVBpY2tlZCkgZXZlbnRTaGVldE1hbmFnZXIuUHVzaENvcHlTb2woc29sTW9kaWZpZXJzKTsKICAgICAgICAgICAgICAgIGVsc2UgZXZlbnRTaGVldE1hbmFnZXIuUHVzaENsZWFuU29sKHNvbE1vZGlmaWVycyk7CiAgICAgICAgICAgIGNvbnN0IGZyYW1lID0gZXZlbnRTdGFjay5QdXNoKHRoaXMpOwogICAgICAgICAgICBpZiAodGhpcy5fQ2hlY2tQYXJlbnRzT0tUb1J1bihmcmFtZSkpIHsKICAgICAgICAgICAgICAgIGZyYW1lLlNldEN1cnJlbnRFdmVudCh0aGlzKTsKICAgICAgICAgICAgICAgIHRoaXMuX1J1bkFuZEJsb2NrKGZyYW1lKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGV2ZW50U3RhY2suUG9wKCk7CiAgICAgICAgICAgIGlmIChpc1JlY3Vyc2l2ZSkgZXZlbnRTaGVldE1hbmFnZXIuR2V0TG9jYWxWYXJTdGFjaygpLlBvcCgpOwogICAgICAgICAgICBpZiAoaGFzQW55U29sTW9kaWZpZXJzKSBldmVudFNoZWV0TWFuYWdlci5Qb3BTb2woc29sTW9kaWZpZXJzKTsKICAgICAgICAgICAgZXZlbnRTaGVldE1hbmFnZXIuX0RlY1RyaWdnZXJEZXB0aCgpCiAgICAgICAgfSogRGVidWdSdW5Bc01hcHBlZEZ1bmN0aW9uQ2FsbChwYXJhbVJlc3VsdHMsCiAgICAgICAgICAgIGlzQ29weVBpY2tlZCkgewogICAgICAgICAgICBpZiAodGhpcy5Jc0RlYnVnQnJlYWtwb2ludCgpIHx8IHRoaXMuX3J1bnRpbWUuRGVidWdCcmVha05leHQoKSkgeWllbGQgdGhpczsKICAgICAgICAgICAgY29uc3Qgc29sTW9kaWZpZXJzID0gdGhpcy5HZXRTb2xNb2RpZmllcnNJbmNsdWRpbmdQYXJlbnRzKCk7CiAgICAgICAgICAgIGNvbnN0IGhhc0FueVNvbE1vZGlmaWVycyA9IHNvbE1vZGlmaWVycy5sZW5ndGggPiAwOwogICAgICAgICAgICBjb25zdCBydW50aW1lID0gdGhpcy5fcnVudGltZTsKICAgICAgICAgICAgY29uc3QgZXZlbnRTdGFjayA9IHRoaXMuX2V2ZW50U3RhY2s7CiAgICAgICAgICAgIGNvbnN0IGV2ZW50U2hlZXRNYW5hZ2VyID0gcnVudGltZS5HZXRFdmVudFNoZWV0TWFuYWdlcigpOwogICAgICAgICAgICBjb25zdCB0cmlnZ2VyRGVwdGggPSBldmVudFNoZWV0TWFuYWdlci5fSW5jVHJpZ2dlckRlcHRoKCk7CiAgICAgICAgICAgIGNvbnN0IGlzUmVjdXJzaXZlID0gdHJpZ2dlckRlcHRoID4gMTsKICAgICAgICAgICAgaWYgKGlzUmVjdXJzaXZlKSBldmVudFNoZWV0TWFuYWdlci5HZXRMb2NhbFZhclN0YWNrKCkuUHVzaCgpOwogICAgICAgICAgICB0aGlzLl9zY29wZVBhcmVudC5TZXRGdW5jdGlvblBhcmFtZXRlcnMocGFyYW1SZXN1bHRzKTsKICAgICAgICAgICAgaWYgKGhhc0FueVNvbE1vZGlmaWVycykKICAgICAgICAgICAgICAgIGlmIChpc0NvcHlQaWNrZWQpIGV2ZW50U2hlZXRNYW5hZ2VyLlB1c2hDb3B5U29sKHNvbE1vZGlmaWVycyk7CiAgICAgICAgICAgICAgICBlbHNlIGV2ZW50U2hlZXRNYW5hZ2VyLlB1c2hDbGVhblNvbChzb2xNb2RpZmllcnMpOwogICAgICAgICAgICBjb25zdCBmcmFtZSA9IGV2ZW50U3RhY2suUHVzaCh0aGlzKTsKICAgICAgICAgICAgaWYgKHlpZWxkKiB0aGlzLl9EZWJ1Z0NoZWNrUGFyZW50c09LVG9SdW4oZnJhbWUpKSB7CiAgICAgICAgICAgICAgICBmcmFtZS5TZXRDdXJyZW50RXZlbnQodGhpcyk7CiAgICAgICAgICAgICAgICB5aWVsZCogdGhpcy5fRGVidWdSdW5BbmRCbG9jayhmcmFtZSkKICAgICAgICAgICAgfQogICAgICAgICAgICBldmVudFN0YWNrLlBvcCgpOwogICAgICAgICAgICBpZiAoaXNSZWN1cnNpdmUpIGV2ZW50U2hlZXRNYW5hZ2VyLkdldExvY2FsVmFyU3RhY2soKS5Qb3AoKTsKICAgICAgICAgICAgaWYgKGhhc0FueVNvbE1vZGlmaWVycykgZXZlbnRTaGVldE1hbmFnZXIuUG9wU29sKHNvbE1vZGlmaWVycyk7CiAgICAgICAgICAgIGV2ZW50U2hlZXRNYW5hZ2VyLl9EZWNUcmlnZ2VyRGVwdGgoKQogICAgICAgIH0KICAgICAgICBSdW5Bc0V4cHJlc3Npb25GdW5jdGlvbkNhbGwoY29tYmluZWRTb2xNb2RpZmllcnMsIGlzQ29weVBpY2tlZCwKICAgICAgICAgICAgcmV0dXJuVHlwZSwgZGVmYXVsdFJldHVyblZhbHVlLCAuLi5wYXJhbVJlc3VsdHMpIHsKICAgICAgICAgICAgbGV0IHJldDsKICAgICAgICAgICAgbGV0IGFzeW5jSWQ7CiAgICAgICAgICAgIGNvbnN0IGhhc0FueVNvbE1vZGlmaWVycyA9IGNvbWJpbmVkU29sTW9kaWZpZXJzLmxlbmd0aCA+IDA7CiAgICAgICAgICAgIGNvbnN0IHJ1bnRpbWUgPSB0aGlzLl9ydW50aW1lOwogICAgICAgICAgICBjb25zdCBldmVudFN0YWNrID0gdGhpcy5fZXZlbnRTdGFjazsKICAgICAgICAgICAgY29uc3QgZXZlbnRTaGVldE1hbmFnZXIgPSBydW50aW1lLkdldEV2ZW50U2hlZXRNYW5hZ2VyKCk7CiAgICAgICAgICAgIGNvbnN0IHRyaWdnZXJEZXB0aCA9IGV2ZW50U2hlZXRNYW5hZ2VyLl9JbmNUcmlnZ2VyRGVwdGgoKTsKICAgICAgICAgICAgY29uc3QgaXNSZWN1cnNpdmUgPSB0cmlnZ2VyRGVwdGggPiAxOwogICAgICAgICAgICBpZiAoaXNSZWN1cnNpdmUpIGV2ZW50U2hlZXRNYW5hZ2VyLkdldExvY2FsVmFyU3RhY2soKS5QdXNoKCk7CiAgICAgICAgICAgIGlmIChwYXJhbVJlc3VsdHMubGVuZ3RoID4gMCkgdGhpcy5fc2NvcGVQYXJlbnQuU2V0RnVuY3Rpb25QYXJhbWV0ZXJzKHBhcmFtUmVzdWx0cyk7CiAgICAgICAgICAgIGlmIChoYXNBbnlTb2xNb2RpZmllcnMpCiAgICAgICAgICAgICAgICBpZiAoaXNDb3B5UGlja2VkKSBldmVudFNoZWV0TWFuYWdlci5QdXNoQ29weVNvbChjb21iaW5lZFNvbE1vZGlmaWVycyk7CiAgICAgICAgICAgICAgICBlbHNlIGV2ZW50U2hlZXRNYW5hZ2VyLlB1c2hDbGVhblNvbChjb21iaW5lZFNvbE1vZGlmaWVycyk7CiAgICAgICAgICAgIGNvbnN0IGZyYW1lID0gZXZlbnRTdGFjay5QdXNoKHRoaXMpOwogICAgICAgICAgICBmcmFtZS5Jbml0Q2FsbEZ1bmN0aW9uRXhwcmVzc2lvbihyZXR1cm5UeXBlLCBkZWZhdWx0UmV0dXJuVmFsdWUpOwogICAgICAgICAgICBldmVudFN0YWNrLlB1c2hFeHBGdW5jKGZyYW1lKTsKICAgICAgICAgICAgcnVudGltZS5TZXREZWJ1Z2dpbmdFbmFibGVkKGZhbHNlKTsKICAgICAgICAgICAgaWYgKHRoaXMuX0NoZWNrUGFyZW50c09LVG9SdW4oZnJhbWUpKSB7CiAgICAgICAgICAgICAgICBmcmFtZS5TZXRDdXJyZW50RXZlbnQodGhpcyk7CiAgICAgICAgICAgICAgICBjb25zdCBpc0FzeW5jID0gdGhpcy5fc2NvcGVQYXJlbnQuSXNBc3luYygpOwogICAgICAgICAgICAgICAgaWYgKGlzQXN5bmMpW2FzeW5jSWQsIHJldF0gPSB0aGlzLl9zY29wZVBhcmVudC5TdGFydEFzeW5jRnVuY3Rpb25DYWxsKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9SdW5BbmRCbG9jayhmcmFtZSk7CiAgICAgICAgICAgICAgICBpZiAoaXNBc3luYykgdGhpcy5fc2NvcGVQYXJlbnQuTWF5YmVGaW5pc2hBc3luY0Z1bmN0aW9uQ2FsbChhc3luY0lkKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJ1bnRpbWUuU2V0RGVidWdnaW5nRW5hYmxlZCh0cnVlKTsKICAgICAgICAgICAgZXZlbnRTdGFjay5Qb3AoKTsKICAgICAgICAgICAgZXZlbnRTdGFjay5Qb3BFeHBGdW5jKCk7CiAgICAgICAgICAgIGlmIChpc1JlY3Vyc2l2ZSkgZXZlbnRTaGVldE1hbmFnZXIuR2V0TG9jYWxWYXJTdGFjaygpLlBvcCgpOwogICAgICAgICAgICBpZiAoaGFzQW55U29sTW9kaWZpZXJzKSBldmVudFNoZWV0TWFuYWdlci5Qb3BTb2woY29tYmluZWRTb2xNb2RpZmllcnMpOwogICAgICAgICAgICBldmVudFNoZWV0TWFuYWdlci5fRGVjVHJpZ2dlckRlcHRoKCk7CiAgICAgICAgICAgIHJldHVybiByZXQgfHwgZnJhbWUuR2V0RnVuY3Rpb25SZXR1cm5WYWx1ZSgpCiAgICAgICAgfQogICAgfTsKCn0KCi8vIGV2ZW50cy9ldmVudFNjcmlwdC5qcwp7CiAgICAndXNlIHN0cmljdCc7CiAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICBjb25zdCBFTVBUWV9TT0xfTU9ESUZJRVJTID0gW107CiAgICBsZXQgaGFkVXNlclNjcmlwdEV4Y2VwdGlvbiA9IGZhbHNlOwogICAgQzMuRXZlbnRTY3JpcHQgPSBjbGFzcyBFdmVudFNjcmlwdCBleHRlbmRzIEMzLkRlZmVuZGVkQmFzZSB7CiAgICAgICAgY29uc3RydWN0b3IoZXZlbnRTaGVldCwgcGFyZW50LCBkYXRhKSB7CiAgICAgICAgICAgIHN1cGVyKCk7CiAgICAgICAgICAgIGNvbnN0IHJ1bnRpbWUgPSBldmVudFNoZWV0LkdldFJ1bnRpbWUoKTsKICAgICAgICAgICAgY29uc3QgZXZlbnRTaGVldE1hbmFnZXIgPSBldmVudFNoZWV0LkdldEV2ZW50U2hlZXRNYW5hZ2VyKCk7CiAgICAgICAgICAgIHRoaXMuX2V2ZW50U2hlZXQgPSBldmVudFNoZWV0OwogICAgICAgICAgICB0aGlzLl9ldmVudFNoZWV0TWFuYWdlciA9IGV2ZW50U2hlZXRNYW5hZ2VyOwogICAgICAgICAgICB0aGlzLl9ydW50aW1lID0gZXZlbnRTaGVldC5HZXRSdW50aW1lKCk7CiAgICAgICAgICAgIHRoaXMuX3BhcmVudCA9IHBhcmVudDsKICAgICAgICAgICAgY29uc3QgdXNlck1ldGhvZCA9IHJ1bnRpbWUuR2V0T2JqZWN0UmVmZXJlbmNlKGRhdGFbMV0pOwogICAgICAgICAgICB0aGlzLl9mdW5jID0gdXNlck1ldGhvZDsKICAgICAgICAgICAgdGhpcy5fZGlzcGxheU51bWJlciA9IGRhdGFbMl07CiAgICAgICAgICAgIHRoaXMuX2V2ZW50U2hlZXQuX1JlZ2lzdGVyRXZlbnRCeURpc3BsYXlOdW1iZXIodGhpcywgdGhpcy5fZGlzcGxheU51bWJlcik7CiAgICAgICAgICAgIHRoaXMuX2RlYnVnRGF0YSA9IHJ1bnRpbWUuSXNEZWJ1ZygpID8gewogICAgICAgICAgICAgICAgaXNCcmVha3BvaW50OiBkYXRhWzNdWzBdLAogICAgICAgICAgICAgICAgaXNCcmVha2FibGU6IGRhdGFbM11bMV0KICAgICAgICAgICAgfSA6IG51bGwKICAgICAgICB9CiAgICAgICAgc3RhdGljIENyZWF0ZShldmVudFNoZWV0LCBwYXJlbnQsIGRhdGEpIHsKICAgICAgICAgICAgcmV0dXJuIEMzLk5ldyhDMy5FdmVudFNjcmlwdCwgZXZlbnRTaGVldCwgcGFyZW50LCBkYXRhKQogICAgICAgIH0KICAgICAgICBfUG9zdEluaXQoKSB7CiAgICAgICAgICAgIGNvbnN0IHVzZXJNZXRob2QgPSB0aGlzLl9mdW5jOwogICAgICAgICAgICBjb25zdCBsb2NhbFZhcnMgPSB0aGlzLl9ydW50aW1lLkdldEV2ZW50U2hlZXRNYW5hZ2VyKCkuX0dldExvY2FsVmFyaWFibGVzU2NyaXB0SW50ZXJmYWNlKHRoaXMpOwogICAgICAgICAgICB0aGlzLl9mdW5jID0gdXNlck1ldGhvZC5iaW5kKG51bGwsIHRoaXMuX3J1bnRpbWUuR2V0SVJ1bnRpbWUoKSwgbG9jYWxWYXJzKQogICAgICAgIH0KICAgICAgICBHZXRQYXJlbnQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9wYXJlbnQKICAgICAgICB9CiAgICAgICAgR2V0U2NvcGVQYXJlbnQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9wYXJlbnQKICAgICAgICB9CiAgICAgICAgR2V0RXZlbnRTaGVldCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2V2ZW50U2hlZXQKICAgICAgICB9CiAgICAgICAgR2V0RGlzcGxheU51bWJlcigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2Rpc3BsYXlOdW1iZXIKICAgICAgICB9CiAgICAgICAgSXNEZWJ1Z0JyZWFrYWJsZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2RlYnVnRGF0YSAmJgogICAgICAgICAgICAgICAgdGhpcy5fZGVidWdEYXRhLmlzQnJlYWthYmxlCiAgICAgICAgfQogICAgICAgIElzRGVidWdCcmVha3BvaW50KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5Jc0RlYnVnQnJlYWthYmxlKCkgJiYgdGhpcy5fZGVidWdEYXRhLmlzQnJlYWtwb2ludAogICAgICAgIH0KICAgICAgICBfU2V0RGVidWdCcmVha3BvaW50KGIpIHsKICAgICAgICAgICAgdGhpcy5fZGVidWdEYXRhLmlzQnJlYWtwb2ludCA9ICEhYgogICAgICAgIH0KICAgICAgICBJc0Vsc2VCbG9jaygpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgfQogICAgICAgIEdldFNvbE1vZGlmaWVycygpIHsKICAgICAgICAgICAgcmV0dXJuIEVNUFRZX1NPTF9NT0RJRklFUlMKICAgICAgICB9CiAgICAgICAgR2V0U29sTW9kaWZpZXJzSW5jbHVkaW5nUGFyZW50cygpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX3BhcmVudCkgcmV0dXJuIHRoaXMuX3BhcmVudC5HZXRTb2xNb2RpZmllcnNJbmNsdWRpbmdQYXJlbnRzKCk7CiAgICAgICAgICAgIGVsc2UgcmV0dXJuIEVNUFRZX1NPTF9NT0RJRklFUlMKICAgICAgICB9CiAgICAgICAgUnVuKGZyYW1lKSB7CiAgICAgICAgICAgIGZyYW1lLlNldEN1cnJlbnRFdmVudCh0aGlzKTsKICAgICAgICAgICAgdGhpcy5fZXZlbnRTaGVldE1hbmFnZXIuQWRkQXN5bmNBY3Rpb25Qcm9taXNlKHRoaXMuX1J1blVzZXJTY3JpcHQoKSkKICAgICAgICB9CiAgICAgICAgYXN5bmMgX1J1blVzZXJTY3JpcHQoKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLl9mdW5jKCkKICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGBVbmhhbmRsZWQgZXhjZXB0aW9uIHJ1bm5pbmcgc2NyaXB0ICVjJHt0aGlzLkdldEV2ZW50U2hlZXQoKS5HZXROYW1lKCl9LCBldmVudCAke3RoaXMuR2V0RGlzcGxheU51bWJlcigpfTpgLAogICAgICAgICAgICAgICAgICAgICJmb250LXNpemU6IDEuMmVtOyBmb250LXdlaWdodDogYm9sZDsiLCBlcnIpOwogICAgICAgICAgICAgICAgaWYgKHNlbGYuQzNEZWJ1Z2dlcikgc2VsZi5DM0RlYnVnZ2VyLl9TZXRMYXN0RXJyb3JTY3JpcHQodGhpcyk7CiAgICAgICAgICAgICAgICBpZiAoIWhhZFVzZXJTY3JpcHRFeGNlcHRpb24pIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmluZm8oYCVjVGlwOiVjIHJ1biB0aGlzIHRvIGhpZ2hsaWdodCBpbiBDb25zdHJ1Y3QgdGhlIGxhc3Qgc2NyaXB0IHRoYXQgaGFkIGFuIGVycm9yOiAlY2dvVG9MYXN0RXJyb3JTY3JpcHQoKWAsICJmb250LXdlaWdodDogYm9sZDsgdGV4dC1kZWNvcmF0aW9uOiB1bmRlcmxpbmUiLCAiIiwgImZvbnQtd2VpZ2h0OiBib2xkIik7CiAgICAgICAgICAgICAgICAgICAgaGFkVXNlclNjcmlwdEV4Y2VwdGlvbiA9IHRydWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0qIERlYnVnUnVuKGZyYW1lKSB7CiAgICAgICAgICAgIGZyYW1lLlNldEN1cnJlbnRFdmVudCh0aGlzKTsKICAgICAgICAgICAgaWYgKHRoaXMuSXNEZWJ1Z0JyZWFrcG9pbnQoKSB8fCB0aGlzLl9ydW50aW1lLkRlYnVnQnJlYWtOZXh0KCkpIHlpZWxkIHRoaXM7CiAgICAgICAgICAgIHRoaXMuUnVuKGZyYW1lKQogICAgICAgIH0KICAgICAgICBEZWJ1Z0NhblJ1bkZhc3QoKSB7CiAgICAgICAgICAgIHJldHVybiAhdGhpcy5Jc0RlYnVnQnJlYWtwb2ludCgpICYmCiAgICAgICAgICAgICAgICAhdGhpcy5fcnVudGltZS5EZWJ1Z0JyZWFrTmV4dCgpCiAgICAgICAgfQogICAgICAgIHN0YXRpYyBIYWRVc2VyU2NyaXB0RXhjZXB0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gaGFkVXNlclNjcmlwdEV4Y2VwdGlvbgogICAgICAgIH0KICAgICAgICBzdGF0aWMgU2V0SGFkVXNlclNjcmlwdEV4Y2VwdGlvbigpIHsKICAgICAgICAgICAgaGFkVXNlclNjcmlwdEV4Y2VwdGlvbiA9IHRydWUKICAgICAgICB9CiAgICB9OwoKfQoKLy8gZXZlbnRzL2Z1bmN0aW9uQmxvY2suanMKewogICAgJ3VzZSBzdHJpY3QnOwogICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgY29uc3QgYXNzZXJ0ID0gc2VsZi5hc3NlcnQ7CiAgICBDMy5GdW5jdGlvbkJsb2NrID0gY2xhc3MgRnVuY3Rpb25CbG9jayBleHRlbmRzIEMzLkRlZmVuZGVkQmFzZSB7CiAgICAgICAgY29uc3RydWN0b3IoZXZlbnRTaGVldCwgcGFyZW50LCBkYXRhKSB7CiAgICAgICAgICAgIHN1cGVyKCk7CiAgICAgICAgICAgIHRoaXMuX2V2ZW50U2hlZXQgPSBldmVudFNoZWV0OwogICAgICAgICAgICB0aGlzLl9ydW50aW1lID0gZXZlbnRTaGVldC5HZXRSdW50aW1lKCk7CiAgICAgICAgICAgIHRoaXMuX3BhcmVudCA9IHBhcmVudDsKICAgICAgICAgICAgdGhpcy5fZnVuY3Rpb25UeXBlID0gMDsKICAgICAgICAgICAgdGhpcy5fZnVuY3Rpb25OYW1lID0gIiI7CiAgICAgICAgICAgIHRoaXMuX3JldHVyblR5cGUgPSAwOwogICAgICAgICAgICB0aGlzLl9mdW5jdGlvblBhcmFtZXRlcnMgPSBbXTsKICAgICAgICAgICAgdGhpcy5faXNFbmFibGVkID0gdHJ1ZTsKICAgICAgICAgICAgdGhpcy5fYWNlTmFtZSA9ICIiOwogICAgICAgICAgICB0aGlzLl9vYmplY3RDbGFzcyA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX2hhc092ZXJyaWRlcyA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl9pbm5lckxvY2FsVmFyaWFibGVzID0gW107CiAgICAgICAgICAgIHRoaXMuX2lzQ29weVBpY2tlZCA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl9pc0FzeW5jID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX25leHRBc3luY0lkID0gMDsKICAgICAgICAgICAgdGhpcy5fY3VycmVudEFzeW5jSWQgPSAtMTsKICAgICAgICAgICAgdGhpcy5fYXN5bmNNYXAgPSBuZXcgTWFwOwogICAgICAgICAgICB0aGlzLl9ldmVudEJsb2NrID0gQzMuRXZlbnRCbG9jay5DcmVhdGUoZXZlbnRTaGVldCwgcGFyZW50LCBkYXRhKTsKICAgICAgICAgICAgdGhpcy5fZXZlbnRCbG9jay5fU2V0U2NvcGVQYXJlbnQodGhpcykKICAgICAgICB9CiAgICAgICAgSW5pdEZ1bmN0aW9uQmxvY2soZnVuY0RhdGEpIHsKICAgICAgICAgICAgdGhpcy5fZnVuY3Rpb25UeXBlID0gMDsKICAgICAgICAgICAgdGhpcy5fZnVuY3Rpb25OYW1lID0gZnVuY0RhdGFbMF07CiAgICAgICAgICAgIHRoaXMuX3JldHVyblR5cGUgPSBmdW5jRGF0YVsxXTsKICAgICAgICAgICAgdGhpcy5fZnVuY3Rpb25QYXJhbWV0ZXJzID0gZnVuY0RhdGFbMl0ubWFwKHBhcmFtRGF0YSA9PiBDMy5FdmVudFZhcmlhYmxlLkNyZWF0ZSh0aGlzLl9ldmVudFNoZWV0LCB0aGlzLCBwYXJhbURhdGEpKTsKICAgICAgICAgICAgdGhpcy5faXNFbmFibGVkID0gZnVuY0RhdGFbM107CiAgICAgICAgICAgIHRoaXMuX2lzQXN5bmMgPSBmdW5jRGF0YVs0XTsKICAgICAgICAgICAgdGhpcy5faXNDb3B5UGlja2VkID0gZnVuY0RhdGFbNV0KICAgICAgICB9CiAgICAgICAgSW5pdEN1c3RvbUFDRUJsb2NrKGZ1bmNEYXRhKSB7CiAgICAgICAgICAgIHRoaXMuX2Z1bmN0aW9uVHlwZSA9IDE7CiAgICAgICAgICAgIHRoaXMuX2FjZU5hbWUgPSBmdW5jRGF0YVsxXTsKICAgICAgICAgICAgdGhpcy5fb2JqZWN0Q2xhc3MgPSB0aGlzLl9ydW50aW1lLkdldE9iamVjdENsYXNzQnlJbmRleChmdW5jRGF0YVsyXSk7CiAgICAgICAgICAgIHRoaXMuX2V2ZW50QmxvY2suX0FkZFNvbE1vZGlmaWVyKHRoaXMuX29iamVjdENsYXNzKTsKICAgICAgICAgICAgdGhpcy5fZnVuY3Rpb25OYW1lID0gdGhpcy5fb2JqZWN0Q2xhc3MuR2V0TmFtZSgpICsgIi4iICsgdGhpcy5fYWNlTmFtZTsKICAgICAgICAgICAgdGhpcy5fcmV0dXJuVHlwZSA9IGZ1bmNEYXRhWzNdOwogICAgICAgICAgICB0aGlzLl9mdW5jdGlvblBhcmFtZXRlcnMgPSBmdW5jRGF0YVs0XS5tYXAocGFyYW1EYXRhID0+IEMzLkV2ZW50VmFyaWFibGUuQ3JlYXRlKHRoaXMuX2V2ZW50U2hlZXQsIHRoaXMsIHBhcmFtRGF0YSkpOwogICAgICAgICAgICB0aGlzLl9pc0VuYWJsZWQgPSBmdW5jRGF0YVs1XTsKICAgICAgICAgICAgdGhpcy5faXNBc3luYyA9IGZ1bmNEYXRhWzZdOwogICAgICAgICAgICB0aGlzLl9pc0NvcHlQaWNrZWQgPSBmdW5jRGF0YVs3XTsKICAgICAgICAgICAgdGhpcy5fb2JqZWN0Q2xhc3MuQWRkQ3VzdG9tQWN0aW9uKHRoaXMpCiAgICAgICAgfQogICAgICAgIHN0YXRpYyBDcmVhdGVGdW5jdGlvbkJsb2NrKGV2ZW50U2hlZXQsIHBhcmVudCwgZGF0YSkgewogICAgICAgICAgICBjb25zdCByZXQgPSBDMy5OZXcoQzMuRnVuY3Rpb25CbG9jaywgZXZlbnRTaGVldCwgcGFyZW50LCBkYXRhKTsKICAgICAgICAgICAgY29uc3QgZnVuY0RhdGEgPQogICAgICAgICAgICAgICAgZGF0YVsxXTsKICAgICAgICAgICAgcmV0LkluaXRGdW5jdGlvbkJsb2NrKGZ1bmNEYXRhKTsKICAgICAgICAgICAgcmV0dXJuIHJldAogICAgICAgIH0KICAgICAgICBzdGF0aWMgQ3JlYXRlQ3VzdG9tQUNFQmxvY2soZXZlbnRTaGVldCwgcGFyZW50LCBkYXRhKSB7CiAgICAgICAgICAgIGNvbnN0IHJldCA9IEMzLk5ldyhDMy5GdW5jdGlvbkJsb2NrLCBldmVudFNoZWV0LCBwYXJlbnQsIGRhdGEpOwogICAgICAgICAgICBjb25zdCBmdW5jRGF0YSA9IGRhdGFbMV07CiAgICAgICAgICAgIHJldC5Jbml0Q3VzdG9tQUNFQmxvY2soZnVuY0RhdGEpOwogICAgICAgICAgICByZXR1cm4gcmV0CiAgICAgICAgfQogICAgICAgIF9DaGVja092ZXJyaWRlU3RhdGUoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9vYmplY3RDbGFzcyAmJiB0aGlzLl9vYmplY3RDbGFzcy5Jc0ZhbWlseSgpKQogICAgICAgICAgICAgICAgZm9yIChjb25zdCBvYmplY3RUeXBlIG9mIHRoaXMuX29iamVjdENsYXNzLkdldEZhbWlseU1lbWJlcnMoKSkKICAgICAgICAgICAgICAgICAgICBpZiAob2JqZWN0VHlwZS5IYXNPd25DdXN0b21BY3Rpb25CeU5hbWUodGhpcy5fYWNlTmFtZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5faGFzT3ZlcnJpZGVzID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIF9Qb3N0SW5pdCgpIHsKICAgICAgICAgICAgZm9yIChjb25zdCBmcCBvZiB0aGlzLl9mdW5jdGlvblBhcmFtZXRlcnMpIGZwLl9Qb3N0SW5pdCgpOwogICAgICAgICAgICB0aGlzLl9ldmVudEJsb2NrLl9Qb3N0SW5pdChmYWxzZSkKICAgICAgICB9CiAgICAgICAgR2V0RnVuY3Rpb25UeXBlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZnVuY3Rpb25UeXBlCiAgICAgICAgfQogICAgICAgIF9HZXRBbGxMb2NhbFZhcmlhYmxlc0luU2NvcGUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9mdW5jdGlvblBhcmFtZXRlcnMKICAgICAgICB9CiAgICAgICAgR2V0RnVuY3Rpb25QYXJhbWV0ZXJzKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZnVuY3Rpb25QYXJhbWV0ZXJzCiAgICAgICAgfQogICAgICAgIEdldEZ1bmN0aW9uUGFyYW1ldGVyQ291bnQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9mdW5jdGlvblBhcmFtZXRlcnMubGVuZ3RoCiAgICAgICAgfQogICAgICAgIF9SZWdpc3RlckxvY2FsVmFyaWFibGUobG9jYWxWYXJpYWJsZSkgewogICAgICAgICAgICB0aGlzLl9pbm5lckxvY2FsVmFyaWFibGVzLnB1c2gobG9jYWxWYXJpYWJsZSkKICAgICAgICB9CiAgICAgICAgX0dldEFsbElubmVyTG9jYWxWYXJpYWJsZXMoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pbm5lckxvY2FsVmFyaWFibGVzCiAgICAgICAgfQogICAgICAgIEV2YWx1YXRlRnVuY3Rpb25QYXJhbWV0ZXJzKHBhcmFtZXRlcnMpIHsKICAgICAgICAgICAgY29uc3QgZnVuY3Rpb25QYXJhbWV0ZXJzID0gdGhpcy5fZnVuY3Rpb25QYXJhbWV0ZXJzOwogICAgICAgICAgICBmb3IgKGxldCBpID0KICAgICAgICAgICAgICAgICAgICAwLCBsZW4gPSBmdW5jdGlvblBhcmFtZXRlcnMubGVuZ3RoOyBpIDwgbGVuOyArK2kpIGZ1bmN0aW9uUGFyYW1ldGVyc1tpXS5TZXRWYWx1ZShwYXJhbWV0ZXJzW2ldLkdldCgwKSkKICAgICAgICB9CiAgICAgICAgU2V0RnVuY3Rpb25QYXJhbWV0ZXJzKHBhcmFtUmVzdWx0cykgewogICAgICAgICAgICBjb25zdCBmdW5jdGlvblBhcmFtZXRlcnMgPSB0aGlzLl9mdW5jdGlvblBhcmFtZXRlcnM7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBmdW5jdGlvblBhcmFtZXRlcnMubGVuZ3RoOyBpIDwgbGVuOyArK2kpIGZ1bmN0aW9uUGFyYW1ldGVyc1tpXS5TZXRWYWx1ZShwYXJhbVJlc3VsdHNbaV0pCiAgICAgICAgfQogICAgICAgIENhcHR1cmVGdW5jdGlvblBhcmFtZXRlcnMoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9mdW5jdGlvblBhcmFtZXRlcnMubWFwKHAgPT4gcC5HZXRWYWx1ZSgpKQogICAgICAgIH0KICAgICAgICBHZXRQYXJlbnQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9wYXJlbnQKICAgICAgICB9CiAgICAgICAgR2V0U2NvcGVQYXJlbnQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9wYXJlbnQKICAgICAgICB9CiAgICAgICAgR2V0RnVuY3Rpb25OYW1lKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZnVuY3Rpb25OYW1lCiAgICAgICAgfQogICAgICAgIEdldEFDRU5hbWUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9hY2VOYW1lCiAgICAgICAgfQogICAgICAgIEhhc0N1c3RvbUFDRU92ZXJyaWRlcygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2hhc092ZXJyaWRlcwogICAgICAgIH0KICAgICAgICBHZXRSZXR1cm5UeXBlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fcmV0dXJuVHlwZQogICAgICAgIH0KICAgICAgICBHZXRPYmplY3RDbGFzcygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX29iamVjdENsYXNzCiAgICAgICAgfQogICAgICAgIElzRW5hYmxlZCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2lzRW5hYmxlZAogICAgICAgIH0KICAgICAgICBHZXREZWZhdWx0UmV0dXJuVmFsdWUoKSB7CiAgICAgICAgICAgIHN3aXRjaCAodGhpcy5fcmV0dXJuVHlwZSkgewogICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgICAgIHJldHVybiAiIjsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDAKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBHZXRFdmVudEJsb2NrKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZXZlbnRCbG9jawogICAgICAgIH0KICAgICAgICBJc0NvcHlQaWNrZWQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pc0NvcHlQaWNrZWQKICAgICAgICB9CiAgICAgICAgSXNBc3luYygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2lzQXN5bmMKICAgICAgICB9CiAgICAgICAgU3RhcnRBc3luY0Z1bmN0aW9uQ2FsbCgpIHsKICAgICAgICAgICAgY29uc3QgYXN5bmNJZCA9IHRoaXMuX25leHRBc3luY0lkKys7CiAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRBc3luY0lkID0gYXN5bmNJZDsKICAgICAgICAgICAgbGV0IHJlc29sdmU7CiAgICAgICAgICAgIGNvbnN0IHByb21pc2UgPSBuZXcgUHJvbWlzZShyID0+IHJlc29sdmUgPSByKTsKICAgICAgICAgICAgdGhpcy5fYXN5bmNNYXAuc2V0KGFzeW5jSWQsIHsKICAgICAgICAgICAgICAgIHJlc29sdmUsCiAgICAgICAgICAgICAgICBwYXVzZUNvdW50OiAwCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXR1cm4gW2FzeW5jSWQsIHByb21pc2VdCiAgICAgICAgfQogICAgICAgIE1heWJlRmluaXNoQXN5bmNGdW5jdGlvbkNhbGwoYXN5bmNJZCkgewogICAgICAgICAgICBjb25zdCBpbmZvID0gdGhpcy5fYXN5bmNNYXAuZ2V0KGFzeW5jSWQpOwogICAgICAgICAgICBpZiAoaW5mby5wYXVzZUNvdW50ID09PSAwKSB7CiAgICAgICAgICAgICAgICBpbmZvLnJlc29sdmUoKTsKICAgICAgICAgICAgICAgIHRoaXMuX2FzeW5jTWFwLmRlbGV0ZShhc3luY0lkKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRBc3luY0lkID0gLTEKICAgICAgICB9CiAgICAgICAgUGF1c2VDdXJyZW50QXN5bmNGdW5jdGlvbigpIHsKICAgICAgICAgICAgY29uc3QgaW5mbyA9IHRoaXMuX2FzeW5jTWFwLmdldCh0aGlzLl9jdXJyZW50QXN5bmNJZCk7CiAgICAgICAgICAgIGluZm8ucGF1c2VDb3VudCsrOwogICAgICAgICAgICByZXR1cm4gdGhpcy5fY3VycmVudEFzeW5jSWQKICAgICAgICB9CiAgICAgICAgUmVzdW1lQXN5bmNGdW5jdGlvbihhc3luY0lkKSB7CiAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRBc3luY0lkID0gYXN5bmNJZDsKICAgICAgICAgICAgY29uc3QgaW5mbyA9IHRoaXMuX2FzeW5jTWFwLmdldChhc3luY0lkKTsKICAgICAgICAgICAgaW5mby5wYXVzZUNvdW50LS0KICAgICAgICB9CiAgICAgICAgUnVuQXNGYW1pbHlDdXN0b21BY3Rpb25XaXRoT3ZlcnJpZGVzKGNvbWJpbmVkU29sTW9kaWZpZXJzLCBwYXJhbWV0ZXJzKSB7CiAgICAgICAgICAgIGNvbnN0IG9iamVjdFR5cGVNYXAgPSBuZXcgTWFwOwogICAgICAgICAgICBjb25zdCBmYW1pbHlJbnN0YW5jZXMgPSBbXTsKICAgICAgICAgICAgZm9yIChjb25zdCBpbnN0IG9mIHRoaXMuX29iamVjdENsYXNzLkdldEN1cnJlbnRTb2woKS5HZXRJbnN0YW5jZXMoKSkgewogICAgICAgICAgICAgICAgY29uc3Qgb2JqZWN0VHlwZSA9IGluc3QuR2V0T2JqZWN0Q2xhc3MoKTsKICAgICAgICAgICAgICAgIGlmIChvYmplY3RUeXBlLkhhc093bkN1c3RvbUFjdGlvbkJ5TmFtZSh0aGlzLl9hY2VOYW1lKSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGFyciA9CiAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdFR5cGVNYXAuZ2V0KG9iamVjdFR5cGUpOwogICAgICAgICAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGFycikpIGFyci5wdXNoKGluc3QpOwogICAgICAgICAgICAgICAgICAgIGVsc2Ugb2JqZWN0VHlwZU1hcC5zZXQob2JqZWN0VHlwZSwgW2luc3RdKQogICAgICAgICAgICAgICAgfSBlbHNlIGZhbWlseUluc3RhbmNlcy5wdXNoKGluc3QpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGZhbWlseUluc3RhbmNlcy5sZW5ndGggPiAwKSB0aGlzLl9ldmVudEJsb2NrLlJ1bkFzRnVuY3Rpb25DYWxsKGNvbWJpbmVkU29sTW9kaWZpZXJzLCBwYXJhbWV0ZXJzLCB0aGlzLl9pc0NvcHlQaWNrZWQsIHsKICAgICAgICAgICAgICAgIHBpY2tPYmplY3RDbGFzczogdGhpcy5fb2JqZWN0Q2xhc3MsCiAgICAgICAgICAgICAgICBwaWNrSW5zdGFuY2VzOiBmYW1pbHlJbnN0YW5jZXMKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGlmIChvYmplY3RUeXBlTWFwLnNpemUgPiAwKQogICAgICAgICAgICAgICAgZm9yIChjb25zdCBbb2JqZWN0VHlwZSwgYXJyXSBvZiBvYmplY3RUeXBlTWFwKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZXZlbnRCbG9jayA9IG9iamVjdFR5cGUuR2V0T3duQ3VzdG9tQWN0aW9uQnlOYW1lKHRoaXMuX2FjZU5hbWUpLkdldEV2ZW50QmxvY2soKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBhbGxDb21iaW5lZFNvbE1vZGlmaWVycyA9IFsuLi4obmV3IFNldChbLi4uY29tYmluZWRTb2xNb2RpZmllcnMsIC4uLmV2ZW50QmxvY2suR2V0U29sTW9kaWZpZXJzKCldKSldOwogICAgICAgICAgICAgICAgICAgIGV2ZW50QmxvY2suUnVuQXNGdW5jdGlvbkNhbGwoYWxsQ29tYmluZWRTb2xNb2RpZmllcnMsIHBhcmFtZXRlcnMsIHRoaXMuX2lzQ29weVBpY2tlZCwgewogICAgICAgICAgICAgICAgICAgICAgICBwaWNrT2JqZWN0Q2xhc3M6IG9iamVjdFR5cGUsCiAgICAgICAgICAgICAgICAgICAgICAgIHBpY2tJbnN0YW5jZXM6IGFycgogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9CiAgICAgICAgfSogRGVidWdSdW5Bc0ZhbWlseUN1c3RvbUFjdGlvbldpdGhPdmVycmlkZXMoY29tYmluZWRTb2xNb2RpZmllcnMsIHBhcmFtZXRlcnMpIHsKICAgICAgICAgICAgY29uc3Qgb2JqZWN0VHlwZU1hcCA9IG5ldyBNYXA7CiAgICAgICAgICAgIGNvbnN0IGZhbWlseUluc3RhbmNlcyA9IFtdOwogICAgICAgICAgICBmb3IgKGNvbnN0IGluc3Qgb2YgdGhpcy5fb2JqZWN0Q2xhc3MuR2V0Q3VycmVudFNvbCgpLkdldEluc3RhbmNlcygpKSB7CiAgICAgICAgICAgICAgICBjb25zdCBvYmplY3RUeXBlID0gaW5zdC5HZXRPYmplY3RDbGFzcygpOwogICAgICAgICAgICAgICAgaWYgKG9iamVjdFR5cGUuSGFzT3duQ3VzdG9tQWN0aW9uQnlOYW1lKHRoaXMuX2FjZU5hbWUpKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYXJyID0KICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0VHlwZU1hcC5nZXQob2JqZWN0VHlwZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgYXJyLnB1c2goaW5zdCk7CiAgICAgICAgICAgICAgICAgICAgZWxzZSBvYmplY3RUeXBlTWFwLnNldChvYmplY3RUeXBlLCBbaW5zdF0pCiAgICAgICAgICAgICAgICB9IGVsc2UgZmFtaWx5SW5zdGFuY2VzLnB1c2goaW5zdCkKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZmFtaWx5SW5zdGFuY2VzLmxlbmd0aCA+IDApIHlpZWxkKiB0aGlzLl9ldmVudEJsb2NrLkRlYnVnUnVuQXNGdW5jdGlvbkNhbGwoY29tYmluZWRTb2xNb2RpZmllcnMsIHBhcmFtZXRlcnMsIHRoaXMuX2lzQ29weVBpY2tlZCwgewogICAgICAgICAgICAgICAgcGlja09iamVjdENsYXNzOiB0aGlzLl9vYmplY3RDbGFzcywKICAgICAgICAgICAgICAgIHBpY2tJbnN0YW5jZXM6IGZhbWlseUluc3RhbmNlcwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgaWYgKG9iamVjdFR5cGVNYXAuc2l6ZSA+IDApCiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IFtvYmplY3RUeXBlLCBhcnJdIG9mIG9iamVjdFR5cGVNYXApIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBldmVudEJsb2NrID0gb2JqZWN0VHlwZS5HZXRPd25DdXN0b21BY3Rpb25CeU5hbWUodGhpcy5fYWNlTmFtZSkuR2V0RXZlbnRCbG9jaygpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGFsbENvbWJpbmVkU29sTW9kaWZpZXJzID0gWy4uLihuZXcgU2V0KFsuLi5jb21iaW5lZFNvbE1vZGlmaWVycywgLi4uZXZlbnRCbG9jay5HZXRTb2xNb2RpZmllcnMoKV0pKV07CiAgICAgICAgICAgICAgICAgICAgeWllbGQqIGV2ZW50QmxvY2suRGVidWdSdW5Bc0Z1bmN0aW9uQ2FsbChhbGxDb21iaW5lZFNvbE1vZGlmaWVycywgcGFyYW1ldGVycywgdGhpcy5faXNDb3B5UGlja2VkLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIHBpY2tPYmplY3RDbGFzczogb2JqZWN0VHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgcGlja0luc3RhbmNlczogYXJyCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwoKfQoKLy8gZXZlbnRzL2V2ZW50VmFyaWFibGUuanMKewogICAgJ3VzZSBzdHJpY3QnOwogICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgY29uc3QgRU1QVFlfU09MX01PRElGSUVSUyA9IFtdOwogICAgQzMuRXZlbnRWYXJpYWJsZSA9IGNsYXNzIEV2ZW50VmFyaWFibGUgZXh0ZW5kcyBDMy5EZWZlbmRlZEJhc2UgewogICAgICAgIGNvbnN0cnVjdG9yKGV2ZW50U2hlZXQsIHBhcmVudCwgZGF0YSkgewogICAgICAgICAgICBzdXBlcigpOwogICAgICAgICAgICBjb25zdCBldmVudFNoZWV0TWFuYWdlciA9IGV2ZW50U2hlZXQuR2V0RXZlbnRTaGVldE1hbmFnZXIoKTsKICAgICAgICAgICAgdGhpcy5fZXZlbnRTaGVldCA9IGV2ZW50U2hlZXQ7CiAgICAgICAgICAgIHRoaXMuX2V2ZW50U2hlZXRNYW5hZ2VyID0gZXZlbnRTaGVldE1hbmFnZXI7CiAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUgPSBldmVudFNoZWV0LkdldFJ1bnRpbWUoKTsKICAgICAgICAgICAgdGhpcy5fcGFyZW50ID0gcGFyZW50OwogICAgICAgICAgICB0aGlzLl9sb2NhbFZhclN0YWNrID0gZXZlbnRTaGVldE1hbmFnZXIuR2V0TG9jYWxWYXJTdGFjaygpOwogICAgICAgICAgICB0aGlzLl9uYW1lID0gZGF0YVsxXTsKICAgICAgICAgICAgdGhpcy5fdHlwZSA9IGRhdGFbMl07CiAgICAgICAgICAgIHRoaXMuX2luaXRpYWxWYWx1ZSA9IGRhdGFbM107CiAgICAgICAgICAgIHRoaXMuX2lzU3RhdGljID0gISFkYXRhWzRdOwogICAgICAgICAgICB0aGlzLl9pc0NvbnN0YW50ID0gISFkYXRhWzVdOwogICAgICAgICAgICB0aGlzLl9pc0Z1bmN0aW9uUGFyYW1ldGVyID0gcGFyZW50IGluc3RhbmNlb2YKICAgICAgICAgICAgQzMuRnVuY3Rpb25CbG9jazsKICAgICAgICAgICAgdGhpcy5fc2lkID0gZGF0YVs2XTsKICAgICAgICAgICAgdGhpcy5fanNQcm9wTmFtZSA9IHRoaXMuX3J1bnRpbWUuR2V0SnNQcm9wTmFtZShkYXRhWzhdKTsKICAgICAgICAgICAgdGhpcy5fc2NyaXB0U2V0dGVyID0gdiA9PiB0aGlzLlNldFZhbHVlKHYpOwogICAgICAgICAgICB0aGlzLl9zY3JpcHRHZXR0ZXIgPSAoKSA9PiB0aGlzLkdldFZhbHVlKCk7CiAgICAgICAgICAgIHRoaXMuX2hhc1NpbmdsZVZhbHVlID0gIXRoaXMuX3BhcmVudCB8fCB0aGlzLl9pc1N0YXRpYyB8fCB0aGlzLl9pc0NvbnN0YW50OwogICAgICAgICAgICB0aGlzLl92YWx1ZSA9IHRoaXMuX2luaXRpYWxWYWx1ZTsKICAgICAgICAgICAgdGhpcy5fbG9jYWxJbmRleCA9IC0xOwogICAgICAgICAgICBpZiAodGhpcy5Jc0Jvb2xlYW4oKSkgdGhpcy5fdmFsdWUgPSB0aGlzLl92YWx1ZSA/IDEgOiAwOwogICAgICAgICAgICBpZiAodGhpcy5Jc0xvY2FsKCkgJiYgIXRoaXMuSXNTdGF0aWMoKSAmJiAhdGhpcy5Jc0NvbnN0YW50KCkpIHRoaXMuX2xvY2FsSW5kZXggPSBldmVudFNoZWV0TWFuYWdlci5fR2V0TmV4dExvY2FsVmFySW5kZXgodGhpcyk7CiAgICAgICAgICAgIGV2ZW50U2hlZXRNYW5hZ2VyLl9SZWdpc3RlckV2ZW50VmFyaWFibGUodGhpcykKICAgICAgICB9CiAgICAgICAgc3RhdGljIENyZWF0ZShldmVudFNoZWV0LAogICAgICAgICAgICBwYXJlbnQsIGRhdGEpIHsKICAgICAgICAgICAgcmV0dXJuIEMzLk5ldyhDMy5FdmVudFZhcmlhYmxlLCBldmVudFNoZWV0LCBwYXJlbnQsIGRhdGEpCiAgICAgICAgfQogICAgICAgIF9Qb3N0SW5pdCgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuSXNMb2NhbCgpICYmICF0aGlzLklzU3RhdGljKCkgJiYgIXRoaXMuSXNDb25zdGFudCgpICYmICF0aGlzLklzRnVuY3Rpb25QYXJhbWV0ZXIoKSkgewogICAgICAgICAgICAgICAgY29uc3QgZnVuY3Rpb25CbG9jayA9IHRoaXMuX2V2ZW50U2hlZXRNYW5hZ2VyLkZpbmRGaXJzdEZ1bmN0aW9uQmxvY2tQYXJlbnQodGhpcyk7CiAgICAgICAgICAgICAgICBpZiAoZnVuY3Rpb25CbG9jaykgZnVuY3Rpb25CbG9jay5fUmVnaXN0ZXJMb2NhbFZhcmlhYmxlKHRoaXMpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgR2V0TmFtZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX25hbWUKICAgICAgICB9CiAgICAgICAgR2V0SnNQcm9wTmFtZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2pzUHJvcE5hbWUKICAgICAgICB9CiAgICAgICAgR2V0UGFyZW50KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fcGFyZW50CiAgICAgICAgfQogICAgICAgIEdldFNjb3BlUGFyZW50KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5HZXRQYXJlbnQoKQogICAgICAgIH0KICAgICAgICBJc0dsb2JhbCgpIHsKICAgICAgICAgICAgcmV0dXJuICF0aGlzLkdldFBhcmVudCgpCiAgICAgICAgfQogICAgICAgIElzTG9jYWwoKSB7CiAgICAgICAgICAgIHJldHVybiAhdGhpcy5Jc0dsb2JhbCgpCiAgICAgICAgfQogICAgICAgIElzRnVuY3Rpb25QYXJhbWV0ZXIoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pc0Z1bmN0aW9uUGFyYW1ldGVyCiAgICAgICAgfQogICAgICAgIElzU3RhdGljKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faXNTdGF0aWMKICAgICAgICB9CiAgICAgICAgSXNDb25zdGFudCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2lzQ29uc3RhbnQKICAgICAgICB9CiAgICAgICAgSXNOdW1iZXIoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl90eXBlID09PQogICAgICAgICAgICAgICAgMAogICAgICAgIH0KICAgICAgICBJc1N0cmluZygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3R5cGUgPT09IDEKICAgICAgICB9CiAgICAgICAgSXNCb29sZWFuKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fdHlwZSA9PT0gMgogICAgICAgIH0KICAgICAgICBJc0Vsc2VCbG9jaygpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgfQogICAgICAgIEdldFNJRCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NpZAogICAgICAgIH0KICAgICAgICBHZXRJbml0aWFsVmFsdWUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pbml0aWFsVmFsdWUKICAgICAgICB9CiAgICAgICAgR2V0U29sTW9kaWZpZXJzKCkgewogICAgICAgICAgICByZXR1cm4gRU1QVFlfU09MX01PRElGSUVSUwogICAgICAgIH0KICAgICAgICBSdW4oZnJhbWUpIHsKICAgICAgICAgICAgaWYgKHRoaXMuSXNMb2NhbCgpICYmICF0aGlzLklzU3RhdGljKCkgJiYgIXRoaXMuSXNDb25zdGFudCgpKSB0aGlzLlNldFZhbHVlKHRoaXMuR2V0SW5pdGlhbFZhbHVlKCkpCiAgICAgICAgfQogICAgICAgIERlYnVnQ2FuUnVuRmFzdCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICB9KiBEZWJ1Z1J1bihmcmFtZSkgewogICAgICAgICAgICB0aGlzLlJ1bihmcmFtZSkKICAgICAgICB9CiAgICAgICAgU2V0VmFsdWUodikgewogICAgICAgICAgICBpZiAodGhpcy5Jc051bWJlcigpKSB7CiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHYgIT09ICJudW1iZXIiKSB2ID0gcGFyc2VGbG9hdCh2KQogICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuSXNTdHJpbmcoKSkgewogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB2ICE9PSAic3RyaW5nIikgdiA9IHYudG9TdHJpbmcoKQogICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuSXNCb29sZWFuKCkpIHYgPQogICAgICAgICAgICAgICAgdiA/IDEgOiAwOwogICAgICAgICAgICBpZiAodGhpcy5faGFzU2luZ2xlVmFsdWUpIHRoaXMuX3ZhbHVlID0gdjsKICAgICAgICAgICAgZWxzZSB0aGlzLl9sb2NhbFZhclN0YWNrLkdldEN1cnJlbnQoKVt0aGlzLl9sb2NhbEluZGV4XSA9IHYKICAgICAgICB9CiAgICAgICAgR2V0VmFsdWUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9oYXNTaW5nbGVWYWx1ZSA/IHRoaXMuX3ZhbHVlIDogdGhpcy5fbG9jYWxWYXJTdGFjay5HZXRDdXJyZW50KClbdGhpcy5fbG9jYWxJbmRleF0KICAgICAgICB9CiAgICAgICAgR2V0VHlwZWRWYWx1ZSgpIHsKICAgICAgICAgICAgbGV0IHJldCA9IHRoaXMuR2V0VmFsdWUoKTsKICAgICAgICAgICAgaWYgKHRoaXMuSXNCb29sZWFuKCkpIHJldCA9ICEhcmV0OwogICAgICAgICAgICByZXR1cm4gcmV0CiAgICAgICAgfQogICAgICAgIFJlc2V0VG9Jbml0aWFsVmFsdWUoKSB7CiAgICAgICAgICAgIHRoaXMuX3ZhbHVlID0gdGhpcy5faW5pdGlhbFZhbHVlCiAgICAgICAgfQogICAgICAgIF9HZXRTY3JpcHRJbnRlcmZhY2VEZXNjcmlwdG9yKCkgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgY29uZmlndXJhYmxlOiBmYWxzZSwKICAgICAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgICAgICAgICBnZXQ6IHRoaXMuX3NjcmlwdEdldHRlciwKICAgICAgICAgICAgICAgIHNldDogdGhpcy5fc2NyaXB0U2V0dGVyCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwoKfQoKLy8gZXZlbnRzL2V2ZW50SW5jbHVkZS5qcwp7CiAgICAndXNlIHN0cmljdCc7CiAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICBjb25zdCBhc3NlcnQgPSBzZWxmLmFzc2VydDsKICAgIGNvbnN0IEVNUFRZX1NPTF9NT0RJRklFUlMgPSBbXTsKICAgIEMzLkV2ZW50SW5jbHVkZSA9IGNsYXNzIEV2ZW50SW5jbHVkZSBleHRlbmRzIEMzLkRlZmVuZGVkQmFzZSB7CiAgICAgICAgY29uc3RydWN0b3IoZXZlbnRTaGVldCwgcGFyZW50LCBkYXRhKSB7CiAgICAgICAgICAgIHN1cGVyKCk7CiAgICAgICAgICAgIGNvbnN0IGV2ZW50U2hlZXRNYW5hZ2VyID0gZXZlbnRTaGVldC5HZXRFdmVudFNoZWV0TWFuYWdlcigpOwogICAgICAgICAgICB0aGlzLl9ldmVudFNoZWV0ID0gZXZlbnRTaGVldDsKICAgICAgICAgICAgdGhpcy5fZXZlbnRTaGVldE1hbmFnZXIgPSBldmVudFNoZWV0TWFuYWdlcjsKICAgICAgICAgICAgdGhpcy5fcnVudGltZSA9IGV2ZW50U2hlZXQuR2V0UnVudGltZSgpOwogICAgICAgICAgICB0aGlzLl9wYXJlbnQgPSBwYXJlbnQ7CiAgICAgICAgICAgIHRoaXMuX2luY2x1ZGVTaGVldCA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX2luY2x1ZGVTaGVldE5hbWUgPSBkYXRhWzFdOwogICAgICAgICAgICB0aGlzLl9pc0FjdGl2ZSA9IHRydWUKICAgICAgICB9CiAgICAgICAgc3RhdGljIENyZWF0ZShldmVudFNoZWV0LCBwYXJlbnQsIGRhdGEpIHsKICAgICAgICAgICAgcmV0dXJuIEMzLk5ldyhDMy5FdmVudEluY2x1ZGUsIGV2ZW50U2hlZXQsIHBhcmVudCwgZGF0YSkKICAgICAgICB9CiAgICAgICAgX1Bvc3RJbml0KCkgewogICAgICAgICAgICB0aGlzLl9pbmNsdWRlU2hlZXQgPSB0aGlzLl9ldmVudFNoZWV0TWFuYWdlci5HZXRFdmVudFNoZWV0QnlOYW1lKHRoaXMuX2luY2x1ZGVTaGVldE5hbWUpOwogICAgICAgICAgICB0aGlzLl9ldmVudFNoZWV0Ll9BZGRTaGFsbG93SW5jbHVkZSh0aGlzKTsKICAgICAgICAgICAgbGV0IHAgPSB0aGlzLkdldFBhcmVudCgpOwogICAgICAgICAgICB3aGlsZSAocCkgewogICAgICAgICAgICAgICAgaWYgKHAgaW5zdGFuY2VvZiBDMy5FdmVudEJsb2NrICYmIHAuSXNHcm91cCgpKSBwLl9BZGRDb250YWluZWRJbmNsdWRlKHRoaXMpOwogICAgICAgICAgICAgICAgcCA9IHAuR2V0UGFyZW50KCkKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLlVwZGF0ZUFjdGl2ZSgpOwogICAgICAgICAgICBpZiAodGhpcy5fcnVudGltZS5Jc0RlYnVnKCkpIHRoaXMuX2V2ZW50U2hlZXQuX0dldFBlcmZSZWNvcmQoKS5jaGlsZHJlbi5wdXNoKHRoaXMuX2luY2x1ZGVTaGVldC5fR2V0UGVyZlJlY29yZCgpKQogICAgICAgIH0KICAgICAgICBHZXRQYXJlbnQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9wYXJlbnQKICAgICAgICB9CiAgICAgICAgR2V0U29sTW9kaWZpZXJzKCkgewogICAgICAgICAgICByZXR1cm4gRU1QVFlfU09MX01PRElGSUVSUwogICAgICAgIH0KICAgICAgICBHZXRJbmNsdWRlU2hlZXQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pbmNsdWRlU2hlZXQKICAgICAgICB9CiAgICAgICAgUnVuKGZyYW1lKSB7CiAgICAgICAgICAgIGNvbnN0IHB1c2hTb2wgPSAhIXRoaXMuR2V0UGFyZW50KCk7CiAgICAgICAgICAgIGNvbnN0IGFsbE9iamVjdENsYXNzZXMgPSB0aGlzLl9ydW50aW1lLkdldEFsbE9iamVjdENsYXNzZXMoKTsKICAgICAgICAgICAgaWYgKHB1c2hTb2wpIHRoaXMuX2V2ZW50U2hlZXRNYW5hZ2VyLlB1c2hDbGVhblNvbChhbGxPYmplY3RDbGFzc2VzKTsKICAgICAgICAgICAgdGhpcy5faW5jbHVkZVNoZWV0LlJ1bigpOwogICAgICAgICAgICBpZiAocHVzaFNvbCkgdGhpcy5fZXZlbnRTaGVldE1hbmFnZXIuUG9wU29sKGFsbE9iamVjdENsYXNzZXMpCiAgICAgICAgfSogRGVidWdSdW4oZnJhbWUpIHsKICAgICAgICAgICAgY29uc3QgcHVzaFNvbCA9ICEhdGhpcy5HZXRQYXJlbnQoKTsKICAgICAgICAgICAgY29uc3QgYWxsT2JqZWN0Q2xhc3NlcyA9IHRoaXMuX3J1bnRpbWUuR2V0QWxsT2JqZWN0Q2xhc3NlcygpOwogICAgICAgICAgICBpZiAocHVzaFNvbCkgdGhpcy5fZXZlbnRTaGVldE1hbmFnZXIuUHVzaENsZWFuU29sKGFsbE9iamVjdENsYXNzZXMpOwogICAgICAgICAgICB5aWVsZCogdGhpcy5faW5jbHVkZVNoZWV0LkRlYnVnUnVuKCk7CiAgICAgICAgICAgIGlmIChwdXNoU29sKSB0aGlzLl9ldmVudFNoZWV0TWFuYWdlci5Qb3BTb2woYWxsT2JqZWN0Q2xhc3NlcykKICAgICAgICB9CiAgICAgICAgRGVidWdDYW5SdW5GYXN0KCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICB9CiAgICAgICAgSXNBY3RpdmUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pc0FjdGl2ZQogICAgICAgIH0KICAgICAgICBVcGRhdGVBY3RpdmUoKSB7CiAgICAgICAgICAgIGxldCBwID0KICAgICAgICAgICAgICAgIHRoaXMuR2V0UGFyZW50KCk7CiAgICAgICAgICAgIHdoaWxlIChwKSB7CiAgICAgICAgICAgICAgICBpZiAocCBpbnN0YW5jZW9mIEMzLkV2ZW50QmxvY2sgJiYgcC5Jc0dyb3VwKCkgJiYgIXAuSXNHcm91cEFjdGl2ZSgpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5faXNBY3RpdmUgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHAgPSBwLkdldFBhcmVudCgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5faXNBY3RpdmUgPSB0cnVlCiAgICAgICAgfQogICAgfTsKCn0KCi8vIGV2ZW50cy9leHBOb2RlLmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIGNvbnN0IGFzc2VydCA9IHNlbGYuYXNzZXJ0OwogICAgQzMuRXhwTm9kZSA9IGNsYXNzIEV4cE5vZGUgZXh0ZW5kcyBDMy5EZWZlbmRlZEJhc2UgewogICAgICAgIGNvbnN0cnVjdG9yKG93bmVyKSB7CiAgICAgICAgICAgIHN1cGVyKCk7CiAgICAgICAgICAgIHRoaXMuX293bmVyID0gb3duZXI7CiAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUgPSBvd25lci5HZXRSdW50aW1lKCkKICAgICAgICB9CiAgICAgICAgX1Bvc3RJbml0KCkge30KICAgICAgICBzdGF0aWMgQ3JlYXRlTm9kZShvd25lciwgZGF0YSkgewogICAgICAgICAgICBjb25zdCB0eXBlID0gZGF0YVswXTsKICAgICAgICAgICAgY29uc3QgQ2xhc3NlcyA9IFtCZWhhdmlvckV4cHJlc3Npb25Ob2RlLCBPYmplY3RFeHByZXNzaW9uTm9kZSwgSW5zdFZhckV4cHJlc3Npb25Ob2RlLCBFdmVudFZhckV4cE5vZGUsIFN5c3RlbUV4cHJlc3Npb25FeHBOb2RlLCBDYWxsRnVuY3Rpb25FeHByZXNzaW9uRXhwTm9kZV07CiAgICAgICAgICAgIHJldHVybiBDMy5OZXcoQ2xhc3Nlc1t0eXBlXSwgb3duZXIsIGRhdGEpCiAgICAgICAgfQogICAgfTsKICAgIGNsYXNzIFN5c3RlbUV4cHJlc3Npb25FeHBOb2RlIGV4dGVuZHMgQzMuRXhwTm9kZSB7CiAgICAgICAgY29uc3RydWN0b3Iob3duZXIsIGRhdGEpIHsKICAgICAgICAgICAgc3VwZXIob3duZXIpOwogICAgICAgICAgICB0aGlzLl9zeXN0ZW1QbHVnaW4gPSB0aGlzLl9ydW50aW1lLkdldFN5c3RlbVBsdWdpbigpOwogICAgICAgICAgICB0aGlzLl9mdW5jID0gdGhpcy5fcnVudGltZS5HZXRPYmplY3RSZWZlcmVuY2UoZGF0YVsxXSk7CiAgICAgICAgICAgIGlmICh0aGlzLl9mdW5jID09PSBDMy5QbHVnaW5zLlN5c3RlbS5FeHBzLnJhbmRvbSB8fCB0aGlzLl9mdW5jID09PSBDMy5QbHVnaW5zLlN5c3RlbS5FeHBzLmNob29zZSkgdGhpcy5fb3duZXIuU2V0VmFyaWVzUGVySW5zdGFuY2UoKQogICAgICAgIH0KICAgICAgICBHZXRCb3VuZE1ldGhvZCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3N5c3RlbVBsdWdpbi5fR2V0Qm91bmRBQ0VNZXRob2QodGhpcy5fZnVuYywgdGhpcy5fc3lzdGVtUGx1Z2luKQogICAgICAgIH0KICAgIH0KICAgIGNsYXNzIENhbGxGdW5jdGlvbkV4cHJlc3Npb25FeHBOb2RlIGV4dGVuZHMgQzMuRXhwTm9kZSB7CiAgICAgICAgY29uc3RydWN0b3Iob3duZXIsIGRhdGEpIHsKICAgICAgICAgICAgc3VwZXIob3duZXIpOwogICAgICAgICAgICB0aGlzLl9mdW5jdGlvbkJsb2NrID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fZnVuY3Rpb25OYW1lID0gZGF0YVsxXTsKICAgICAgICAgICAgdGhpcy5fb3duZXIuU2V0VmFyaWVzUGVySW5zdGFuY2UoKQogICAgICAgIH0KICAgICAgICBfUG9zdEluaXQoKSB7CiAgICAgICAgICAgIGNvbnN0IGV2ZW50U2hlZXRNYW5hZ2VyID0gdGhpcy5fcnVudGltZS5HZXRFdmVudFNoZWV0TWFuYWdlcigpOwogICAgICAgICAgICB0aGlzLl9mdW5jdGlvbkJsb2NrID0gZXZlbnRTaGVldE1hbmFnZXIuR2V0RnVuY3Rpb25CbG9ja0J5TmFtZSh0aGlzLl9mdW5jdGlvbk5hbWUpOwogICAgICAgICAgICB0aGlzLl9mdW5jdGlvbk5hbWUgPSBudWxsOwogICAgICAgICAgICBjb25zdCBteUV2ZW50QmxvY2sgPSB0aGlzLl9vd25lci5HZXRFdmVudEJsb2NrKCk7CiAgICAgICAgICAgIGNvbnN0IGNhbGxFdmVudEJsb2NrID0gdGhpcy5fZnVuY3Rpb25CbG9jay5HZXRFdmVudEJsb2NrKCk7CiAgICAgICAgICAgIHRoaXMuX2NvbWJpbmVkU29sTW9kaWZpZXJzID0gWy4uLihuZXcgU2V0KFsuLi5teUV2ZW50QmxvY2suR2V0U29sTW9kaWZpZXJzSW5jbHVkaW5nUGFyZW50cygpLAogICAgICAgICAgICAgICAgLi4uY2FsbEV2ZW50QmxvY2suR2V0U29sTW9kaWZpZXJzSW5jbHVkaW5nUGFyZW50cygpCiAgICAgICAgICAgIF0pKV07CiAgICAgICAgICAgIHRoaXMuX2NvbWJpbmVkU29sTW9kaWZpZXJzID0gZXZlbnRTaGVldE1hbmFnZXIuX0RlZHVwbGljYXRlU29sTW9kaWZpZXJMaXN0KHRoaXMuX2NvbWJpbmVkU29sTW9kaWZpZXJzKQogICAgICAgIH0KICAgICAgICBHZXRCb3VuZE1ldGhvZCgpIHsKICAgICAgICAgICAgY29uc3QgZnVuY3Rpb25CbG9jayA9IHRoaXMuX2Z1bmN0aW9uQmxvY2s7CiAgICAgICAgICAgIGlmIChmdW5jdGlvbkJsb2NrLklzRW5hYmxlZCgpKSB7CiAgICAgICAgICAgICAgICBjb25zdCBjYWxsRXZlbnRCbG9jayA9IGZ1bmN0aW9uQmxvY2suR2V0RXZlbnRCbG9jaygpOwogICAgICAgICAgICAgICAgcmV0dXJuIEMzLkV2ZW50QmxvY2sucHJvdG90eXBlLlJ1bkFzRXhwcmVzc2lvbkZ1bmN0aW9uQ2FsbC5iaW5kKGNhbGxFdmVudEJsb2NrLCB0aGlzLl9jb21iaW5lZFNvbE1vZGlmaWVycywgZnVuY3Rpb25CbG9jay5Jc0NvcHlQaWNrZWQoKSwgZnVuY3Rpb25CbG9jay5HZXRSZXR1cm5UeXBlKCksIGZ1bmN0aW9uQmxvY2suR2V0RGVmYXVsdFJldHVyblZhbHVlKCkpCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjb25zdCBkZWZhdWx0UmV0dXJuVmFsdWUgPQogICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uQmxvY2suR2V0RGVmYXVsdFJldHVyblZhbHVlKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gKCkgPT4gZGVmYXVsdFJldHVyblZhbHVlCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gV3JhcEluZGV4KGluZGV4LCBsZW4pIHsKICAgICAgICBpZiAoaW5kZXggPj0gbGVuKSByZXR1cm4gaW5kZXggJSBsZW47CiAgICAgICAgZWxzZSBpZiAoaW5kZXggPCAwKSB7CiAgICAgICAgICAgIGlmIChpbmRleCA8PSAtbGVuKSBpbmRleCAlPSBsZW47CiAgICAgICAgICAgIGlmIChpbmRleCA8IDApIGluZGV4ICs9IGxlbjsKICAgICAgICAgICAgcmV0dXJuIGluZGV4CiAgICAgICAgfSBlbHNlIHJldHVybiBpbmRleAogICAgfQogICAgY2xhc3MgT2JqZWN0RXhwcmVzc2lvbk5vZGUgZXh0ZW5kcyBDMy5FeHBOb2RlIHsKICAgICAgICBjb25zdHJ1Y3Rvcihvd25lciwgZGF0YSkgewogICAgICAgICAgICBzdXBlcihvd25lcik7CiAgICAgICAgICAgIHRoaXMuX29iamVjdENsYXNzID0gdGhpcy5fcnVudGltZS5HZXRPYmplY3RDbGFzc0J5SW5kZXgoZGF0YVsxXSk7CiAgICAgICAgICAgIHRoaXMuX2Z1bmMgPSB0aGlzLl9ydW50aW1lLkdldE9iamVjdFJlZmVyZW5jZShkYXRhWzJdKTsKICAgICAgICAgICAgdGhpcy5fcmV0dXJuc1N0cmluZyA9ICEhZGF0YVszXTsKICAgICAgICAgICAgdGhpcy5fZXZlbnRTdGFjayA9IHRoaXMuX3J1bnRpbWUuR2V0RXZlbnRTaGVldE1hbmFnZXIoKS5HZXRFdmVudFN0YWNrKCk7CiAgICAgICAgICAgIHRoaXMuX293bmVyLl9NYXliZVZhcnlGb3IodGhpcy5fb2JqZWN0Q2xhc3MpCiAgICAgICAgfQogICAgICAgIEdldEJvdW5kTWV0aG9kKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fb2JqZWN0Q2xhc3MuR2V0UGx1Z2luKCkuX0dldEJvdW5kQUNFTWV0aG9kKHRoaXMuX2Z1bmMsIHRoaXMuX29iamVjdENsYXNzLkdldFNpbmdsZUdsb2JhbEluc3RhbmNlKCkuR2V0U2RrSW5zdGFuY2UoKSkKICAgICAgICB9CiAgICAgICAgRXhwT2JqZWN0KC4uLmFyZ3MpIHsKICAgICAgICAgICAgY29uc3Qgb2JqZWN0Q2xhc3MgPQogICAgICAgICAgICAgICAgdGhpcy5fb2JqZWN0Q2xhc3M7CiAgICAgICAgICAgIGNvbnN0IGluc3RhbmNlcyA9IG9iamVjdENsYXNzLkdldEN1cnJlbnRTb2woKS5HZXRFeHByZXNzaW9uSW5zdGFuY2VzKCk7CiAgICAgICAgICAgIGNvbnN0IGxlbiA9IGluc3RhbmNlcy5sZW5ndGg7CiAgICAgICAgICAgIGlmIChsZW4gPT09IDApIHJldHVybiB0aGlzLl9yZXR1cm5zU3RyaW5nID8gIiIgOiAwOwogICAgICAgICAgICBjb25zdCBpbmRleCA9IFdyYXBJbmRleCh0aGlzLl9vd25lci5HZXRTb2xJbmRleCgpLCBsZW4pOwogICAgICAgICAgICB0aGlzLl9ldmVudFN0YWNrLkdldEN1cnJlbnRTdGFja0ZyYW1lKCkuU2V0RXhwcmVzc2lvbk9iamVjdENsYXNzKG9iamVjdENsYXNzKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2Z1bmMuYXBwbHkoaW5zdGFuY2VzW2luZGV4XS5HZXRTZGtJbnN0YW5jZSgpLCBhcmdzKQogICAgICAgIH0KICAgICAgICBFeHBPYmplY3RfSW5zdEV4cHIoaW5zdEluZGV4LCAuLi5hcmdzKSB7CiAgICAgICAgICAgIGNvbnN0IG9iamVjdENsYXNzID0gdGhpcy5fb2JqZWN0Q2xhc3M7CiAgICAgICAgICAgIGNvbnN0IGluc3RhbmNlcyA9IG9iamVjdENsYXNzLkdldEluc3RhbmNlcygpOwogICAgICAgICAgICBjb25zdCBsZW4gPSBpbnN0YW5jZXMubGVuZ3RoOwogICAgICAgICAgICBpZiAobGVuID09PQogICAgICAgICAgICAgICAgMCkgcmV0dXJuIHRoaXMuX3JldHVybnNTdHJpbmcgPyAiIiA6IDA7CiAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gV3JhcEluZGV4KGluc3RJbmRleCwgbGVuKTsKICAgICAgICAgICAgdGhpcy5fZXZlbnRTdGFjay5HZXRDdXJyZW50U3RhY2tGcmFtZSgpLlNldEV4cHJlc3Npb25PYmplY3RDbGFzcyhvYmplY3RDbGFzcyk7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9mdW5jLmFwcGx5KGluc3RhbmNlc1tpbmRleF0uR2V0U2RrSW5zdGFuY2UoKSwgYXJncykKICAgICAgICB9CiAgICB9CiAgICBjbGFzcyBJbnN0VmFyRXhwcmVzc2lvbk5vZGUgZXh0ZW5kcyBDMy5FeHBOb2RlIHsKICAgICAgICBjb25zdHJ1Y3Rvcihvd25lciwgZGF0YSkgewogICAgICAgICAgICBzdXBlcihvd25lcik7CiAgICAgICAgICAgIHRoaXMuX29iamVjdENsYXNzID0gdGhpcy5fcnVudGltZS5HZXRPYmplY3RDbGFzc0J5SW5kZXgoZGF0YVsxXSk7CiAgICAgICAgICAgIHRoaXMuX3ZhckluZGV4ID0gZGF0YVszXTsKICAgICAgICAgICAgdGhpcy5fcmV0dXJuc1N0cmluZyA9ICEhZGF0YVsyXTsKICAgICAgICAgICAgdGhpcy5fb3duZXIuX01heWJlVmFyeUZvcih0aGlzLl9vYmplY3RDbGFzcykKICAgICAgICB9CiAgICAgICAgRXhwSW5zdFZhcigpIHsKICAgICAgICAgICAgY29uc3QgaW5zdGFuY2VzID0gdGhpcy5fb2JqZWN0Q2xhc3MuR2V0Q3VycmVudFNvbCgpLkdldEV4cHJlc3Npb25JbnN0YW5jZXMoKTsKICAgICAgICAgICAgY29uc3QgbGVuID0gaW5zdGFuY2VzLmxlbmd0aDsKICAgICAgICAgICAgaWYgKGxlbiA9PT0gMCkgcmV0dXJuIHRoaXMuX3JldHVybnNTdHJpbmcgPyAiIiA6IDA7CiAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gV3JhcEluZGV4KHRoaXMuX293bmVyLkdldFNvbEluZGV4KCksIGxlbik7CiAgICAgICAgICAgIHJldHVybiBpbnN0YW5jZXNbaW5kZXhdLl9HZXRJbnN0YW5jZVZhcmlhYmxlVmFsdWVVbmNoZWNrZWQodGhpcy5fdmFySW5kZXgpCiAgICAgICAgfQogICAgICAgIEV4cEluc3RWYXJfRmFtaWx5KCkgewogICAgICAgICAgICBjb25zdCBvYmplY3RDbGFzcyA9CiAgICAgICAgICAgICAgICB0aGlzLl9vYmplY3RDbGFzczsKICAgICAgICAgICAgY29uc3QgaW5zdGFuY2VzID0gb2JqZWN0Q2xhc3MuR2V0Q3VycmVudFNvbCgpLkdldEV4cHJlc3Npb25JbnN0YW5jZXMoKTsKICAgICAgICAgICAgY29uc3QgbGVuID0gaW5zdGFuY2VzLmxlbmd0aDsKICAgICAgICAgICAgaWYgKGxlbiA9PT0gMCkgcmV0dXJuIHRoaXMuX3JldHVybnNTdHJpbmcgPyAiIiA6IDA7CiAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gV3JhcEluZGV4KHRoaXMuX293bmVyLkdldFNvbEluZGV4KCksIGxlbik7CiAgICAgICAgICAgIGNvbnN0IGluc3QgPSBpbnN0YW5jZXNbaW5kZXhdOwogICAgICAgICAgICBjb25zdCBvZmZzZXQgPSBpbnN0LkdldE9iamVjdENsYXNzKCkuR2V0RmFtaWx5SW5zdGFuY2VWYXJpYWJsZU9mZnNldChvYmplY3RDbGFzcy5HZXRGYW1pbHlJbmRleCgpKTsKICAgICAgICAgICAgcmV0dXJuIGluc3QuX0dldEluc3RhbmNlVmFyaWFibGVWYWx1ZVVuY2hlY2tlZCh0aGlzLl92YXJJbmRleCArIG9mZnNldCkKICAgICAgICB9CiAgICAgICAgRXhwSW5zdFZhcl9JbnN0RXhwcihpbnN0SW5kZXgpIHsKICAgICAgICAgICAgY29uc3Qgb2JqZWN0Q2xhc3MgPSB0aGlzLl9vYmplY3RDbGFzczsKICAgICAgICAgICAgY29uc3QgaW5zdGFuY2VzID0gb2JqZWN0Q2xhc3MuR2V0SW5zdGFuY2VzKCk7CiAgICAgICAgICAgIGNvbnN0IGxlbiA9IGluc3RhbmNlcy5sZW5ndGg7CiAgICAgICAgICAgIGlmIChsZW4gPT09IDApIHJldHVybiB0aGlzLl9yZXR1cm5zU3RyaW5nID8gIiIgOiAwOwogICAgICAgICAgICBjb25zdCBpbmRleCA9IFdyYXBJbmRleChpbnN0SW5kZXgsIGxlbik7CiAgICAgICAgICAgIGNvbnN0IGluc3QgPSBpbnN0YW5jZXNbaW5kZXhdOwogICAgICAgICAgICBsZXQgb2Zmc2V0ID0gMDsKICAgICAgICAgICAgaWYgKG9iamVjdENsYXNzLklzRmFtaWx5KCkpIG9mZnNldCA9IGluc3QuR2V0T2JqZWN0Q2xhc3MoKS5HZXRGYW1pbHlJbnN0YW5jZVZhcmlhYmxlT2Zmc2V0KG9iamVjdENsYXNzLkdldEZhbWlseUluZGV4KCkpOwogICAgICAgICAgICByZXR1cm4gaW5zdC5fR2V0SW5zdGFuY2VWYXJpYWJsZVZhbHVlVW5jaGVja2VkKHRoaXMuX3ZhckluZGV4ICsgb2Zmc2V0KQogICAgICAgIH0KICAgIH0KICAgIGNsYXNzIEJlaGF2aW9yRXhwcmVzc2lvbk5vZGUgZXh0ZW5kcyBDMy5FeHBOb2RlIHsKICAgICAgICBjb25zdHJ1Y3Rvcihvd25lciwgZGF0YSkgewogICAgICAgICAgICBzdXBlcihvd25lcik7CiAgICAgICAgICAgIHRoaXMuX29iamVjdENsYXNzID0gdGhpcy5fcnVudGltZS5HZXRPYmplY3RDbGFzc0J5SW5kZXgoZGF0YVsxXSk7CiAgICAgICAgICAgIHRoaXMuX2JlaGF2aW9yVHlwZSA9IHRoaXMuX29iamVjdENsYXNzLkdldEJlaGF2aW9yVHlwZUJ5TmFtZShkYXRhWzJdKTsKICAgICAgICAgICAgdGhpcy5fYmVoYXZpb3JJbmRleCA9IHRoaXMuX29iamVjdENsYXNzLkdldEJlaGF2aW9ySW5kZXhCeU5hbWUoZGF0YVsyXSk7CiAgICAgICAgICAgIHRoaXMuX2Z1bmMgPSB0aGlzLl9ydW50aW1lLkdldE9iamVjdFJlZmVyZW5jZShkYXRhWzNdKTsKICAgICAgICAgICAgdGhpcy5fcmV0dXJuc1N0cmluZyA9ICEhZGF0YVs0XTsKICAgICAgICAgICAgdGhpcy5fZXZlbnRTdGFjayA9IHRoaXMuX3J1bnRpbWUuR2V0RXZlbnRTaGVldE1hbmFnZXIoKS5HZXRFdmVudFN0YWNrKCk7CiAgICAgICAgICAgIHRoaXMuX293bmVyLl9NYXliZVZhcnlGb3IodGhpcy5fb2JqZWN0Q2xhc3MpCiAgICAgICAgfQogICAgICAgIEV4cEJlaGF2aW9yKC4uLmFyZ3MpIHsKICAgICAgICAgICAgY29uc3Qgb2JqZWN0Q2xhc3MgPQogICAgICAgICAgICAgICAgdGhpcy5fb2JqZWN0Q2xhc3M7CiAgICAgICAgICAgIGNvbnN0IGluc3RhbmNlcyA9IG9iamVjdENsYXNzLkdldEN1cnJlbnRTb2woKS5HZXRFeHByZXNzaW9uSW5zdGFuY2VzKCk7CiAgICAgICAgICAgIGNvbnN0IGxlbiA9IGluc3RhbmNlcy5sZW5ndGg7CiAgICAgICAgICAgIGlmIChsZW4gPT09IDApIHJldHVybiB0aGlzLl9yZXR1cm5zU3RyaW5nID8gIiIgOiAwOwogICAgICAgICAgICBjb25zdCBpbmRleCA9IFdyYXBJbmRleCh0aGlzLl9vd25lci5HZXRTb2xJbmRleCgpLCBsZW4pOwogICAgICAgICAgICB0aGlzLl9ldmVudFN0YWNrLkdldEN1cnJlbnRTdGFja0ZyYW1lKCkuU2V0RXhwcmVzc2lvbk9iamVjdENsYXNzKG9iamVjdENsYXNzKTsKICAgICAgICAgICAgY29uc3QgaW5zdCA9IGluc3RhbmNlc1tpbmRleF07CiAgICAgICAgICAgIGxldCBvZmZzZXQgPSAwOwogICAgICAgICAgICBpZiAob2JqZWN0Q2xhc3MuSXNGYW1pbHkoKSkgb2Zmc2V0ID0gaW5zdC5HZXRPYmplY3RDbGFzcygpLkdldEZhbWlseUJlaGF2aW9yT2Zmc2V0KG9iamVjdENsYXNzLkdldEZhbWlseUluZGV4KCkpOwogICAgICAgICAgICByZXR1cm4gdGhpcy5fZnVuYy5hcHBseShpbnN0LkdldEJlaGF2aW9ySW5zdGFuY2VzKClbdGhpcy5fYmVoYXZpb3JJbmRleCArCiAgICAgICAgICAgICAgICBvZmZzZXRdLkdldFNka0luc3RhbmNlKCksIGFyZ3MpCiAgICAgICAgfQogICAgICAgIEV4cEJlaGF2aW9yX0luc3RFeHByKGluc3RJbmRleCwgLi4uYXJncykgewogICAgICAgICAgICBjb25zdCBvYmplY3RDbGFzcyA9IHRoaXMuX29iamVjdENsYXNzOwogICAgICAgICAgICBjb25zdCBpbnN0YW5jZXMgPSBvYmplY3RDbGFzcy5HZXRJbnN0YW5jZXMoKTsKICAgICAgICAgICAgY29uc3QgbGVuID0gaW5zdGFuY2VzLmxlbmd0aDsKICAgICAgICAgICAgaWYgKGxlbiA9PT0gMCkgcmV0dXJuIHRoaXMuX3JldHVybnNTdHJpbmcgPyAiIiA6IDA7CiAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gV3JhcEluZGV4KGluc3RJbmRleCwgbGVuKTsKICAgICAgICAgICAgdGhpcy5fZXZlbnRTdGFjay5HZXRDdXJyZW50U3RhY2tGcmFtZSgpLlNldEV4cHJlc3Npb25PYmplY3RDbGFzcyhvYmplY3RDbGFzcyk7CiAgICAgICAgICAgIGNvbnN0IGluc3QgPSBpbnN0YW5jZXNbaW5kZXhdOwogICAgICAgICAgICBsZXQgb2Zmc2V0ID0gMDsKICAgICAgICAgICAgaWYgKG9iamVjdENsYXNzLklzRmFtaWx5KCkpIG9mZnNldCA9IGluc3QuR2V0T2JqZWN0Q2xhc3MoKS5HZXRGYW1pbHlCZWhhdmlvck9mZnNldChvYmplY3RDbGFzcy5HZXRGYW1pbHlJbmRleCgpKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2Z1bmMuYXBwbHkoaW5zdC5HZXRCZWhhdmlvckluc3RhbmNlcygpW3RoaXMuX2JlaGF2aW9ySW5kZXggKwogICAgICAgICAgICAgICAgb2Zmc2V0XS5HZXRTZGtJbnN0YW5jZSgpLCBhcmdzKQogICAgICAgIH0KICAgIH0KICAgIGNsYXNzIEV2ZW50VmFyRXhwTm9kZSBleHRlbmRzIEMzLkV4cE5vZGUgewogICAgICAgIGNvbnN0cnVjdG9yKG93bmVyLCBkYXRhKSB7CiAgICAgICAgICAgIHN1cGVyKG93bmVyKTsKICAgICAgICAgICAgdGhpcy5fZXZlbnRWYXIgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9ldmVudFZhclNpZCA9IGRhdGFbMV0KICAgICAgICB9CiAgICAgICAgX1Bvc3RJbml0KCkgewogICAgICAgICAgICB0aGlzLl9ldmVudFZhciA9IHRoaXMuX3J1bnRpbWUuR2V0RXZlbnRTaGVldE1hbmFnZXIoKS5HZXRFdmVudFZhcmlhYmxlQnlTSUQodGhpcy5fZXZlbnRWYXJTaWQpCiAgICAgICAgfQogICAgICAgIEdldFZhcigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2V2ZW50VmFyCiAgICAgICAgfQogICAgfTsKCn0KCi8vIGV2ZW50cy9wYXJhbWV0ZXIuanMKewogICAgJ3VzZSBzdHJpY3QnOwogICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgY29uc3QgYXNzZXJ0ID0gc2VsZi5hc3NlcnQ7CiAgICBDMy5QYXJhbWV0ZXIgPSBjbGFzcyBQYXJhbWV0ZXIgZXh0ZW5kcyBDMy5EZWZlbmRlZEJhc2UgewogICAgICAgIGNvbnN0cnVjdG9yKG93bmVyLCB0eXBlLCBpbmRleCkgewogICAgICAgICAgICBzdXBlcigpOwogICAgICAgICAgICB0aGlzLl9vd25lciA9IG93bmVyOwogICAgICAgICAgICB0aGlzLl9pbmRleCA9IGluZGV4OwogICAgICAgICAgICB0aGlzLl90eXBlID0gdHlwZTsKICAgICAgICAgICAgdGhpcy5HZXQgPSBudWxsOwogICAgICAgICAgICB0aGlzLl92YXJpZXNQZXJJbnN0YW5jZSA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl9pc0NvbnN0YW50ID0gZmFsc2UKICAgICAgICB9CiAgICAgICAgc3RhdGljIENyZWF0ZShvd25lciwgZGF0YSwgaW5kZXgpIHsKICAgICAgICAgICAgY29uc3QgdHlwZSA9IGRhdGFbMF07CiAgICAgICAgICAgIGNvbnN0IENsYXNzZXMgPSBbRXhwcmVzc2lvblBhcmFtZXRlciwgU3RyaW5nRXhwcmVzc2lvblBhcmFtZXRlciwgRmlsZVBhcmFtZXRlciwgQ29tYm9QYXJhbWV0ZXIsIE9iamVjdFBhcmFtZXRlciwgTGF5ZXJFeHByZXNzaW9uUGFyYW1ldGVyLCBMYXlvdXRQYXJhbWV0ZXIsIEV4cHJlc3Npb25QYXJhbWV0ZXIsIENvbWJvUGFyYW1ldGVyLCBDb21ib1BhcmFtZXRlciwgSW5zdFZhclBhcmFtZXRlciwgRXZlbnRWYXJQYXJhbWV0ZXIsIEZpbGVQYXJhbWV0ZXIsCiAgICAgICAgICAgICAgICBWYXJpYWRpY1BhcmFtZXRlciwgU3RyaW5nRXhwcmVzc2lvblBhcmFtZXRlciwgVGltZWxpbmVQYXJhbWV0ZXIsIEJvb2xlYW5QYXJhbWV0ZXIsIEZ1bmN0aW9uUGFyYW1ldGVyLCBFYXNlUGFyYW1ldGVyLCBUaWxlbWFwQnJ1c2hQYXJhbWV0ZXIsIFRlbXBsYXRlRXhwcmVzc2lvblBhcmFtZXRlcgogICAgICAgICAgICBdOwogICAgICAgICAgICByZXR1cm4gQzMuTmV3KENsYXNzZXNbdHlwZV0sIG93bmVyLCB0eXBlLCBpbmRleCwgZGF0YSkKICAgICAgICB9CiAgICAgICAgX1Bvc3RJbml0KCkge30KICAgICAgICBTZXRWYXJpZXNQZXJJbnN0YW5jZSgpIHsKICAgICAgICAgICAgdGhpcy5fdmFyaWVzUGVySW5zdGFuY2UgPSB0cnVlCiAgICAgICAgfQogICAgICAgIF9NYXliZVZhcnlGb3Iob2JqZWN0Q2xhc3MpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX3Zhcmllc1Blckluc3RhbmNlKSByZXR1cm47CiAgICAgICAgICAgIGlmICghb2JqZWN0Q2xhc3MpIHJldHVybjsKICAgICAgICAgICAgaWYgKCFvYmplY3RDbGFzcy5HZXRQbHVnaW4oKS5Jc1NpbmdsZUdsb2JhbCgpKSB0aGlzLl92YXJpZXNQZXJJbnN0YW5jZSA9IHRydWUKICAgICAgICB9CiAgICAgICAgVmFyaWVzUGVySW5zdGFuY2UoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl92YXJpZXNQZXJJbnN0YW5jZQogICAgICAgIH0KICAgICAgICBHZXRJbmRleCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2luZGV4CiAgICAgICAgfQogICAgICAgIEdldFJ1bnRpbWUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9vd25lci5HZXRSdW50aW1lKCkKICAgICAgICB9CiAgICAgICAgR2V0RXZlbnRCbG9jaygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX293bmVyLkdldEV2ZW50QmxvY2soKQogICAgICAgIH0KICAgICAgICBJc0NvbnN0YW50KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faXNDb25zdGFudAogICAgICAgIH0KICAgICAgICBJc09iamVjdFBhcmFtZXRlcigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3R5cGUgPT09CiAgICAgICAgICAgICAgICA0CiAgICAgICAgfQogICAgfTsKCiAgICBmdW5jdGlvbiBHZXRFeHByZXNzaW9uRnVuYyhudW1iZXIpIHsKICAgICAgICBjb25zdCByZXQgPSBzZWxmLkMzX0V4cHJlc3Npb25GdW5jc1tudW1iZXJdOwogICAgICAgIGlmICghcmV0KSB0aHJvdyBuZXcgRXJyb3IoImludmFsaWQgZXhwcmVzc2lvbiBudW1iZXIiKTsKICAgICAgICByZXR1cm4gcmV0CiAgICB9CiAgICBjbGFzcyBFeHByZXNzaW9uUGFyYW1ldGVyIGV4dGVuZHMgQzMuUGFyYW1ldGVyIHsKICAgICAgICBjb25zdHJ1Y3Rvcihvd25lciwgdHlwZSwgaW5kZXgsIGRhdGEpIHsKICAgICAgICAgICAgc3VwZXIob3duZXIsIHR5cGUsIGluZGV4KTsKICAgICAgICAgICAgdGhpcy5fc29sSW5kZXggPSAwOwogICAgICAgICAgICBjb25zdCBleHBEYXRhID0gZGF0YVsxXTsKICAgICAgICAgICAgdGhpcy5fZXhwcmVzc2lvbk51bWJlciA9IGV4cERhdGFbMF07CiAgICAgICAgICAgIHRoaXMuX251bWJlcmVkTm9kZXMgPSBbXTsKICAgICAgICAgICAgdGhpcy5fZXhwcmVzc2lvbkZ1bmMgPSBudWxsOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMSwgbGVuID0gZXhwRGF0YS5sZW5ndGg7IGkgPCBsZW47ICsraSkgdGhpcy5fbnVtYmVyZWROb2Rlcy5wdXNoKEMzLkV4cE5vZGUuQ3JlYXRlTm9kZSh0aGlzLCBleHBEYXRhW2ldKSk7CiAgICAgICAgICAgIGlmICh0aGlzLl9udW1iZXJlZE5vZGVzLmxlbmd0aCkgdGhpcy5HZXQgPSB0aGlzLkdldEV4cHJlc3Npb247CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5HZXQgPSBHZXRFeHByZXNzaW9uRnVuYyh0aGlzLl9leHByZXNzaW9uTnVtYmVyKTsKICAgICAgICAgICAgICAgIHRoaXMuX2lzQ29uc3RhbnQgPSB0cnVlCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgX0dldE5vZGUoaSkgewogICAgICAgICAgICBpZiAoaSA8IDAgfHwgaSA+PSB0aGlzLl9udW1iZXJlZE5vZGVzLmxlbmd0aCkgdGhyb3cgbmV3IFJhbmdlRXJyb3IoImludmFsaWQgbnVtYmVyZWQgbm9kZSIpOwogICAgICAgICAgICByZXR1cm4gdGhpcy5fbnVtYmVyZWROb2Rlc1tpXQogICAgICAgIH0KICAgICAgICBfUG9zdEluaXQoKSB7CiAgICAgICAgICAgIGZvciAoY29uc3Qgbm9kZSBvZiB0aGlzLl9udW1iZXJlZE5vZGVzKSBub2RlLl9Qb3N0SW5pdCgpOwogICAgICAgICAgICBjb25zdCBmdW5jID0gR2V0RXhwcmVzc2lvbkZ1bmModGhpcy5fZXhwcmVzc2lvbk51bWJlcik7CiAgICAgICAgICAgIGlmICh0aGlzLl9udW1iZXJlZE5vZGVzLmxlbmd0aCkgdGhpcy5fZXhwcmVzc2lvbkZ1bmMgPSBmdW5jKHRoaXMpOwogICAgICAgICAgICBlbHNlIHRoaXMuX2V4cHJlc3Npb25GdW5jID0gZnVuYwogICAgICAgIH0KICAgICAgICBHZXRTb2xJbmRleCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NvbEluZGV4CiAgICAgICAgfQogICAgICAgIEdldEV4cHJlc3Npb24oc29sSW5kZXgpIHsKICAgICAgICAgICAgdGhpcy5fc29sSW5kZXggPSBzb2xJbmRleDsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2V4cHJlc3Npb25GdW5jKCkKICAgICAgICB9CiAgICB9CiAgICBjbGFzcyBTdHJpbmdFeHByZXNzaW9uUGFyYW1ldGVyIGV4dGVuZHMgRXhwcmVzc2lvblBhcmFtZXRlciB7CiAgICAgICAgY29uc3RydWN0b3Iob3duZXIsIHR5cGUsIGluZGV4LCBkYXRhKSB7CiAgICAgICAgICAgIHN1cGVyKG93bmVyLCB0eXBlLCBpbmRleCwgZGF0YSk7CiAgICAgICAgICAgIHRoaXMuR2V0ID0gdGhpcy5HZXRTdHJpbmdFeHByZXNzaW9uOwogICAgICAgICAgICBpZiAodHlwZSA9PT0gMTQpIHsKICAgICAgICAgICAgICAgIHRoaXMuR2V0RXZlbnRCbG9jaygpLlNldEFsbFNvbE1vZGlmaWVycygpOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuX293bmVyIGluc3RhbmNlb2YgQzMuQWN0aW9uKSB0aGlzLkdldEV2ZW50QmxvY2soKS5TZXRTb2xXcml0ZXJBZnRlckNuZHMoKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIEdldFN0cmluZ0V4cHJlc3Npb24oc29sSW5kZXgpIHsKICAgICAgICAgICAgdGhpcy5fc29sSW5kZXggPSBzb2xJbmRleDsKICAgICAgICAgICAgY29uc3QgcmV0ID0gdGhpcy5fZXhwcmVzc2lvbkZ1bmMoKTsKICAgICAgICAgICAgaWYgKHR5cGVvZiByZXQgPT09ICJzdHJpbmciKSByZXR1cm4gcmV0OwogICAgICAgICAgICBlbHNlIHJldHVybiAiIgogICAgICAgIH0KICAgICAgICBfR2V0RmFzdFRyaWdnZXJWYWx1ZSgpIHsKICAgICAgICAgICAgcmV0dXJuIEdldEV4cHJlc3Npb25GdW5jKHRoaXMuX2V4cHJlc3Npb25OdW1iZXIpKCkKICAgICAgICB9CiAgICB9CiAgICBjbGFzcyBMYXllckV4cHJlc3Npb25QYXJhbWV0ZXIgZXh0ZW5kcyBFeHByZXNzaW9uUGFyYW1ldGVyIHsKICAgICAgICBjb25zdHJ1Y3Rvcihvd25lciwgdHlwZSwgaW5kZXgsIGRhdGEpIHsKICAgICAgICAgICAgc3VwZXIob3duZXIsIHR5cGUsIGluZGV4LCBkYXRhKTsKICAgICAgICAgICAgdGhpcy5HZXQgPSB0aGlzLkdldExheWVyOwogICAgICAgICAgICB0aGlzLl9pc0NvbnN0YW50ID0gZmFsc2UKICAgICAgICB9CiAgICAgICAgR2V0TGF5ZXIoc29sSW5kZXgpIHsKICAgICAgICAgICAgdGhpcy5fc29sSW5kZXggPSBzb2xJbmRleDsKICAgICAgICAgICAgY29uc3QgcmV0ID0gdGhpcy5fZXhwcmVzc2lvbkZ1bmMoKTsKICAgICAgICAgICAgY29uc3QgbGF5b3V0ID0gdGhpcy5HZXRSdW50aW1lKCkuR2V0Q3VycmVudExheW91dCgpOwogICAgICAgICAgICByZXR1cm4gbGF5b3V0LkdldExheWVyKHJldCkKICAgICAgICB9CiAgICB9CiAgICBjbGFzcyBDb21ib1BhcmFtZXRlciBleHRlbmRzIEMzLlBhcmFtZXRlciB7CiAgICAgICAgY29uc3RydWN0b3Iob3duZXIsIHR5cGUsIGluZGV4LCBkYXRhKSB7CiAgICAgICAgICAgIHN1cGVyKG93bmVyLCB0eXBlLCBpbmRleCk7CiAgICAgICAgICAgIHRoaXMuX2NvbWJvID0gZGF0YVsxXTsKICAgICAgICAgICAgdGhpcy5HZXQgPSB0aGlzLkdldENvbWJvOwogICAgICAgICAgICB0aGlzLl9pc0NvbnN0YW50ID0gdHJ1ZQogICAgICAgIH0KICAgICAgICBHZXRDb21ibygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NvbWJvCiAgICAgICAgfQogICAgfQogICAgY2xhc3MgQm9vbGVhblBhcmFtZXRlciBleHRlbmRzIEMzLlBhcmFtZXRlciB7CiAgICAgICAgY29uc3RydWN0b3Iob3duZXIsIHR5cGUsIGluZGV4LCBkYXRhKSB7CiAgICAgICAgICAgIHN1cGVyKG93bmVyLCB0eXBlLCBpbmRleCk7CiAgICAgICAgICAgIHRoaXMuX2Jvb2wgPSBkYXRhWzFdOwogICAgICAgICAgICB0aGlzLkdldCA9IHRoaXMuR2V0Qm9vbGVhbjsKICAgICAgICAgICAgdGhpcy5faXNDb25zdGFudCA9IHRydWUKICAgICAgICB9CiAgICAgICAgR2V0Qm9vbGVhbigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2Jvb2wKICAgICAgICB9CiAgICB9CiAgICBjbGFzcyBPYmplY3RQYXJhbWV0ZXIgZXh0ZW5kcyBDMy5QYXJhbWV0ZXIgewogICAgICAgIGNvbnN0cnVjdG9yKG93bmVyLCB0eXBlLCBpbmRleCwgZGF0YSkgewogICAgICAgICAgICBzdXBlcihvd25lciwgdHlwZSwgaW5kZXgpOwogICAgICAgICAgICB0aGlzLl9vYmplY3RDbGFzcyA9IHRoaXMuR2V0UnVudGltZSgpLkdldE9iamVjdENsYXNzQnlJbmRleChkYXRhWzFdKTsKICAgICAgICAgICAgdGhpcy5HZXQgPSB0aGlzLkdldE9iamVjdENsYXNzOwogICAgICAgICAgICBjb25zdCBldmVudEJsb2NrID0gdGhpcy5HZXRFdmVudEJsb2NrKCk7CiAgICAgICAgICAgIGV2ZW50QmxvY2suX0FkZFNvbE1vZGlmaWVyKHRoaXMuX29iamVjdENsYXNzKTsKICAgICAgICAgICAgaWYgKHRoaXMuX293bmVyIGluc3RhbmNlb2YgQzMuQWN0aW9uKSBldmVudEJsb2NrLlNldFNvbFdyaXRlckFmdGVyQ25kcygpOwogICAgICAgICAgICBlbHNlIGlmIChldmVudEJsb2NrLkdldFBhcmVudCgpKSBldmVudEJsb2NrLkdldFBhcmVudCgpLlNldFNvbFdyaXRlckFmdGVyQ25kcygpOwogICAgICAgICAgICB0aGlzLl9pc0NvbnN0YW50ID0gdHJ1ZQogICAgICAgIH0KICAgICAgICBHZXRPYmplY3RDbGFzcygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX29iamVjdENsYXNzCiAgICAgICAgfQogICAgfQogICAgY2xhc3MgTGF5b3V0UGFyYW1ldGVyIGV4dGVuZHMgQzMuUGFyYW1ldGVyIHsKICAgICAgICBjb25zdHJ1Y3Rvcihvd25lciwgdHlwZSwgaW5kZXgsIGRhdGEpIHsKICAgICAgICAgICAgc3VwZXIob3duZXIsIHR5cGUsIGluZGV4KTsKICAgICAgICAgICAgdGhpcy5fbGF5b3V0ID0gdGhpcy5HZXRSdW50aW1lKCkuR2V0TGF5b3V0TWFuYWdlcigpLkdldExheW91dEJ5TmFtZShkYXRhWzFdKTsKICAgICAgICAgICAgdGhpcy5HZXQgPSB0aGlzLkdldExheW91dDsKICAgICAgICAgICAgdGhpcy5faXNDb25zdGFudCA9IHRydWUKICAgICAgICB9CiAgICAgICAgR2V0TGF5b3V0KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fbGF5b3V0CiAgICAgICAgfQogICAgfQogICAgY2xhc3MgVGltZWxpbmVQYXJhbWV0ZXIgZXh0ZW5kcyBDMy5QYXJhbWV0ZXIgewogICAgICAgIGNvbnN0cnVjdG9yKG93bmVyLCB0eXBlLCBpbmRleCwgZGF0YSkgewogICAgICAgICAgICBzdXBlcihvd25lciwgdHlwZSwgaW5kZXgpOwogICAgICAgICAgICB0aGlzLl90aW1lbGluZSA9IHRoaXMuR2V0UnVudGltZSgpLkdldFRpbWVsaW5lTWFuYWdlcigpLkdldFRpbWVsaW5lQnlOYW1lKGRhdGFbMV0pOwogICAgICAgICAgICB0aGlzLkdldCA9IHRoaXMuR2V0VGltZWxpbmU7CiAgICAgICAgICAgIHRoaXMuX2lzQ29uc3RhbnQgPSB0cnVlCiAgICAgICAgfQogICAgICAgIEdldFRpbWVsaW5lKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fdGltZWxpbmUKICAgICAgICB9CiAgICB9CiAgICBjbGFzcyBGaWxlUGFyYW1ldGVyIGV4dGVuZHMgQzMuUGFyYW1ldGVyIHsKICAgICAgICBjb25zdHJ1Y3Rvcihvd25lciwgdHlwZSwgaW5kZXgsIGRhdGEpIHsKICAgICAgICAgICAgc3VwZXIob3duZXIsIHR5cGUsIGluZGV4KTsKICAgICAgICAgICAgdGhpcy5fZmlsZUluZm8gPSBkYXRhWzFdOwogICAgICAgICAgICB0aGlzLkdldCA9IHRoaXMuR2V0RmlsZTsKICAgICAgICAgICAgdGhpcy5faXNDb25zdGFudCA9IHRydWUKICAgICAgICB9CiAgICAgICAgR2V0RmlsZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2ZpbGVJbmZvCiAgICAgICAgfQogICAgfQogICAgY2xhc3MgSW5zdFZhclBhcmFtZXRlciBleHRlbmRzIEMzLlBhcmFtZXRlciB7CiAgICAgICAgY29uc3RydWN0b3Iob3duZXIsIHR5cGUsIGluZGV4LCBkYXRhKSB7CiAgICAgICAgICAgIHN1cGVyKG93bmVyLCB0eXBlLCBpbmRleCk7CiAgICAgICAgICAgIHRoaXMuX2luc3RWYXJJbmRleCA9IGRhdGFbMV07CiAgICAgICAgICAgIGNvbnN0IG93bmVyT2JqZWN0Q2xhc3MgPSB0aGlzLl9vd25lci5HZXRPYmplY3RDbGFzcygpOwogICAgICAgICAgICBpZiAodGhpcy5fb3duZXIgaW5zdGFuY2VvZiBDMy5Db25kaXRpb24gJiYgdGhpcy5fb3duZXIuSXNTdGF0aWMoKSkgewogICAgICAgICAgICAgICAgdGhpcy5HZXQgPSB0aGlzLkdldEluc3RhbmNlVmFyaWFibGU7CiAgICAgICAgICAgICAgICB0aGlzLl9pc0NvbnN0YW50ID0gdHJ1ZQogICAgICAgICAgICB9IGVsc2UgaWYgKG93bmVyT2JqZWN0Q2xhc3MgJiYgb3duZXJPYmplY3RDbGFzcy5Jc0ZhbWlseSgpKSB7CiAgICAgICAgICAgICAgICB0aGlzLkdldCA9IHRoaXMuR2V0RmFtaWx5SW5zdGFuY2VWYXJpYWJsZTsKICAgICAgICAgICAgICAgIHRoaXMuU2V0VmFyaWVzUGVySW5zdGFuY2UoKQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5HZXQgPSB0aGlzLkdldEluc3RhbmNlVmFyaWFibGU7CiAgICAgICAgICAgICAgICB0aGlzLl9pc0NvbnN0YW50ID0gdHJ1ZQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIEdldEluc3RhbmNlVmFyaWFibGUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pbnN0VmFySW5kZXgKICAgICAgICB9CiAgICAgICAgR2V0RmFtaWx5SW5zdGFuY2VWYXJpYWJsZShzb2xJbmRleCkgewogICAgICAgICAgICBzb2xJbmRleCA9CiAgICAgICAgICAgICAgICBzb2xJbmRleCB8fCAwOwogICAgICAgICAgICBjb25zdCBmYW1pbHlUeXBlID0gdGhpcy5fb3duZXIuR2V0T2JqZWN0Q2xhc3MoKTsKICAgICAgICAgICAgY29uc3Qgc29sID0gZmFtaWx5VHlwZS5HZXRDdXJyZW50U29sKCk7CiAgICAgICAgICAgIGNvbnN0IGluc3RhbmNlcyA9IHNvbC5HZXRJbnN0YW5jZXMoKTsKICAgICAgICAgICAgbGV0IHJlYWxUeXBlID0gbnVsbDsKICAgICAgICAgICAgaWYgKGluc3RhbmNlcy5sZW5ndGgpIHJlYWxUeXBlID0gaW5zdGFuY2VzW3NvbEluZGV4ICUgaW5zdGFuY2VzLmxlbmd0aF0uR2V0T2JqZWN0Q2xhc3MoKTsKICAgICAgICAgICAgZWxzZSBpZiAoc29sLkhhc0FueUVsc2VJbnN0YW5jZXMoKSkgewogICAgICAgICAgICAgICAgY29uc3QgZWxzZUluc3RhbmNlcyA9IHNvbC5HZXRFbHNlSW5zdGFuY2VzKCk7CiAgICAgICAgICAgICAgICByZWFsVHlwZSA9IGVsc2VJbnN0YW5jZXNbc29sSW5kZXggJSBlbHNlSW5zdGFuY2VzLmxlbmd0aF0uR2V0T2JqZWN0Q2xhc3MoKQogICAgICAgICAgICB9IGVsc2UgaWYgKGZhbWlseVR5cGUuR2V0SW5zdGFuY2VDb3VudCgpID4gMCkgewogICAgICAgICAgICAgICAgY29uc3QgZmFtaWx5SW5zdGFuY2VzID0gZmFtaWx5VHlwZS5HZXRJbnN0YW5jZXMoKTsKICAgICAgICAgICAgICAgIHJlYWxUeXBlID0gZmFtaWx5SW5zdGFuY2VzW3NvbEluZGV4ICUKICAgICAgICAgICAgICAgICAgICBmYW1pbHlJbnN0YW5jZXMubGVuZ3RoXS5HZXRPYmplY3RDbGFzcygpCiAgICAgICAgICAgIH0gZWxzZSByZXR1cm4gMDsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2luc3RWYXJJbmRleCArIHJlYWxUeXBlLkdldEZhbWlseUluc3RhbmNlVmFyaWFibGVPZmZzZXQoZmFtaWx5VHlwZS5HZXRGYW1pbHlJbmRleCgpKQogICAgICAgIH0KICAgIH0KICAgIGNsYXNzIEV2ZW50VmFyUGFyYW1ldGVyIGV4dGVuZHMgQzMuUGFyYW1ldGVyIHsKICAgICAgICBjb25zdHJ1Y3Rvcihvd25lciwgdHlwZSwgaW5kZXgsIGRhdGEpIHsKICAgICAgICAgICAgc3VwZXIob3duZXIsIHR5cGUsIGluZGV4KTsKICAgICAgICAgICAgdGhpcy5fZXZlbnRWYXJTaWQgPSBkYXRhWzFdOwogICAgICAgICAgICB0aGlzLl9ldmVudFZhciA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuR2V0ID0gdGhpcy5HZXRFdmVudFZhcmlhYmxlOwogICAgICAgICAgICB0aGlzLl9pc0NvbnN0YW50ID0gdHJ1ZQogICAgICAgIH0KICAgICAgICBfUG9zdEluaXQoKSB7CiAgICAgICAgICAgIHRoaXMuX2V2ZW50VmFyID0gdGhpcy5HZXRSdW50aW1lKCkuR2V0RXZlbnRTaGVldE1hbmFnZXIoKS5HZXRFdmVudFZhcmlhYmxlQnlTSUQodGhpcy5fZXZlbnRWYXJTaWQpCiAgICAgICAgfQogICAgICAgIEdldEV2ZW50VmFyaWFibGUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9ldmVudFZhcgogICAgICAgIH0KICAgIH0KICAgIGNsYXNzIEZ1bmN0aW9uUGFyYW1ldGVyIGV4dGVuZHMgQzMuUGFyYW1ldGVyIHsKICAgICAgICBjb25zdHJ1Y3Rvcihvd25lciwgdHlwZSwgaW5kZXgsIGRhdGEpIHsKICAgICAgICAgICAgc3VwZXIob3duZXIsIHR5cGUsIGluZGV4KTsKICAgICAgICAgICAgdGhpcy5fZnVuY3Rpb25CbG9ja05hbWUgPSBkYXRhWzFdOwogICAgICAgICAgICB0aGlzLl9mdW5jdGlvbkJsb2NrID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5HZXQgPSB0aGlzLkdldEZ1bmN0aW9uOwogICAgICAgICAgICB0aGlzLl9pc0NvbnN0YW50ID0gdHJ1ZQogICAgICAgIH0KICAgICAgICBfUG9zdEluaXQoKSB7CiAgICAgICAgICAgIHRoaXMuX2Z1bmN0aW9uQmxvY2sgPSB0aGlzLkdldFJ1bnRpbWUoKS5HZXRFdmVudFNoZWV0TWFuYWdlcigpLkdldEZ1bmN0aW9uQmxvY2tCeU5hbWUodGhpcy5fZnVuY3Rpb25CbG9ja05hbWUpOwogICAgICAgICAgICB0aGlzLl9mdW5jdGlvbkJsb2NrTmFtZSA9IG51bGwKICAgICAgICB9CiAgICAgICAgR2V0RnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9mdW5jdGlvbkJsb2NrCiAgICAgICAgfQogICAgfQogICAgY2xhc3MgVmFyaWFkaWNQYXJhbWV0ZXIgZXh0ZW5kcyBDMy5QYXJhbWV0ZXIgewogICAgICAgIGNvbnN0cnVjdG9yKG93bmVyLCB0eXBlLCBpbmRleCwgZGF0YSkgewogICAgICAgICAgICBzdXBlcihvd25lciwgdHlwZSwgaW5kZXgpOwogICAgICAgICAgICB0aGlzLl9zdWJQYXJhbXMgPSBbXTsKICAgICAgICAgICAgdGhpcy5fdmFyaWFkaWNSZXQgPSBbXTsKICAgICAgICAgICAgdGhpcy5faXNDb25zdGFudCA9IHRydWU7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAxLCBsZW4gPSBkYXRhLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7CiAgICAgICAgICAgICAgICBjb25zdCBzdWJQYXJhbSA9IEMzLlBhcmFtZXRlci5DcmVhdGUodGhpcy5fb3duZXIsIGRhdGFbaV0sIDApOwogICAgICAgICAgICAgICAgdGhpcy5fc3ViUGFyYW1zLnB1c2goc3ViUGFyYW0pOwogICAgICAgICAgICAgICAgdGhpcy5fdmFyaWFkaWNSZXQucHVzaCgwKTsKICAgICAgICAgICAgICAgIGlmICghc3ViUGFyYW0uSXNDb25zdGFudCgpKSB0aGlzLl9pc0NvbnN0YW50ID0gZmFsc2UKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLkdldCA9IHRoaXMuR2V0VmFyaWFkaWMKICAgICAgICB9CiAgICAgICAgX1Bvc3RJbml0KCkgewogICAgICAgICAgICBmb3IgKGNvbnN0IHN1YlBhcmFtIG9mIHRoaXMuX3N1YlBhcmFtcykgc3ViUGFyYW0uX1Bvc3RJbml0KCkKICAgICAgICB9CiAgICAgICAgR2V0VmFyaWFkaWMoKSB7CiAgICAgICAgICAgIGNvbnN0IHN1YlBhcmFtcyA9IHRoaXMuX3N1YlBhcmFtczsKICAgICAgICAgICAgY29uc3QgdmFyaWFkaWNSZXQgPSB0aGlzLl92YXJpYWRpY1JldDsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IHN1YlBhcmFtcy5sZW5ndGg7IGkgPCBsZW47ICsraSkgdmFyaWFkaWNSZXRbaV0gPSBzdWJQYXJhbXNbaV0uR2V0KDApOwogICAgICAgICAgICByZXR1cm4gdmFyaWFkaWNSZXQKICAgICAgICB9CiAgICB9CiAgICBjbGFzcyBFYXNlUGFyYW1ldGVyIGV4dGVuZHMgQzMuUGFyYW1ldGVyIHsKICAgICAgICBjb25zdHJ1Y3Rvcihvd25lciwgdHlwZSwgaW5kZXgsIGRhdGEpIHsKICAgICAgICAgICAgc3VwZXIob3duZXIsIHR5cGUsIGluZGV4KTsKICAgICAgICAgICAgdGhpcy5fZWFzZUluZGV4ID0gZGF0YVsxXTsKICAgICAgICAgICAgdGhpcy5HZXQgPSB0aGlzLkdldEVhc2U7CiAgICAgICAgICAgIHRoaXMuX2lzQ29uc3RhbnQgPSB0cnVlCiAgICAgICAgfQogICAgICAgIEdldEVhc2UoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9lYXNlSW5kZXgKICAgICAgICB9CiAgICB9CiAgICBjbGFzcyBUaWxlbWFwQnJ1c2hQYXJhbWV0ZXIgZXh0ZW5kcyBDMy5QYXJhbWV0ZXIgewogICAgICAgIGNvbnN0cnVjdG9yKG93bmVyLCB0eXBlLCBpbmRleCwgZGF0YSkgewogICAgICAgICAgICBzdXBlcihvd25lciwgdHlwZSwgaW5kZXgpOwogICAgICAgICAgICB0aGlzLl9icnVzaEluZGV4ID0gZGF0YVsxXTsKICAgICAgICAgICAgdGhpcy5HZXQgPSB0aGlzLkdldFRpbGVtYXBCcnVzaDsKICAgICAgICAgICAgdGhpcy5faXNDb25zdGFudCA9IHRydWUKICAgICAgICB9CiAgICAgICAgR2V0VGlsZW1hcEJydXNoKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fYnJ1c2hJbmRleAogICAgICAgIH0KICAgIH0KICAgIGNsYXNzIFRlbXBsYXRlRXhwcmVzc2lvblBhcmFtZXRlciBleHRlbmRzIEV4cHJlc3Npb25QYXJhbWV0ZXIgewogICAgICAgIGNvbnN0cnVjdG9yKG93bmVyLCB0eXBlLCBpbmRleCwgZGF0YSkgewogICAgICAgICAgICBzdXBlcihvd25lciwgdHlwZSwgaW5kZXgsIGRhdGEpOwogICAgICAgICAgICB0aGlzLkdldCA9IHRoaXMuR2V0VGVtcGxhdGVOYW1lOwogICAgICAgICAgICB0aGlzLl9pc0NvbnN0YW50ID0gZmFsc2UKICAgICAgICB9CiAgICAgICAgR2V0VGVtcGxhdGVOYW1lKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZXhwcmVzc2lvbkZ1bmMoKQogICAgICAgIH0KICAgIH07Cgp9CgovLyBldmVudHMvY29uZGl0aW9uLmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIGNvbnN0IGFzc2VydCA9IHNlbGYuYXNzZXJ0OwoKICAgIGZ1bmN0aW9uIEV2YWxQYXJhbXMocGFyYW1ldGVycywgcmVzdWx0cykgewogICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBwYXJhbWV0ZXJzLmxlbmd0aDsgaSA8IGxlbjsgKytpKSByZXN1bHRzW2ldID0gcGFyYW1ldGVyc1tpXS5HZXQoMCkKICAgIH0KICAgIGNvbnN0IEVNUFRZX1BBUkFNU19BUlJBWSA9IFtdOwogICAgY29uc3Qgbm9vcCA9IGZ1bmN0aW9uKCkge307CiAgICBDMy5Db25kaXRpb24gPSBjbGFzcyBDb25kaXRpb24gZXh0ZW5kcyBDMy5EZWZlbmRlZEJhc2UgewogICAgICAgIGNvbnN0cnVjdG9yKGV2ZW50QmxvY2ssIGRhdGEsIGluZGV4KSB7CiAgICAgICAgICAgIHN1cGVyKCk7CiAgICAgICAgICAgIHRoaXMuX2V2ZW50QmxvY2sgPSBldmVudEJsb2NrOwogICAgICAgICAgICB0aGlzLl9ydW50aW1lID0gZXZlbnRCbG9jay5HZXRSdW50aW1lKCk7CiAgICAgICAgICAgIHRoaXMuX2luZGV4ID0gaW5kZXg7CiAgICAgICAgICAgIHRoaXMuX2Z1bmMgPSB0aGlzLl9ydW50aW1lLkdldE9iamVjdFJlZmVyZW5jZShkYXRhWzFdKTsKICAgICAgICAgICAgdGhpcy5faXNUcmlnZ2VyID0gZGF0YVszXSA+IDA7CiAgICAgICAgICAgIHRoaXMuX2lzRmFzdFRyaWdnZXIgPSBkYXRhWzNdID09PSAyOwogICAgICAgICAgICB0aGlzLl9pc0xvb3BpbmcgPSAhIWRhdGFbNF07CiAgICAgICAgICAgIHRoaXMuX2lzSW52ZXJ0ZWQgPSAhIWRhdGFbNV07CiAgICAgICAgICAgIHRoaXMuX2lzU3RhdGljID0gISFkYXRhWzZdOwogICAgICAgICAgICB0aGlzLl9zaWQgPSBkYXRhWzddOwogICAgICAgICAgICB0aGlzLl9pc0luT3JCbG9jayA9IHRoaXMuX2V2ZW50QmxvY2suSXNPckJsb2NrKCk7CiAgICAgICAgICAgIHRoaXMuX29iamVjdENsYXNzID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fYmVoYXZpb3JUeXBlID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fYmVoYXZpb3JJbmRleCA9IC0xOwogICAgICAgICAgICB0aGlzLl9zeXN0ZW1QbHVnaW4gPSBudWxsOwogICAgICAgICAgICB0aGlzLlJ1biA9IG5vb3A7CiAgICAgICAgICAgIHRoaXMuRGVidWdSdW4gPSBub29wOwogICAgICAgICAgICB0aGlzLl9wYXJhbWV0ZXJzID0gW107CiAgICAgICAgICAgIHRoaXMuX3Jlc3VsdHMgPSBbXTsKICAgICAgICAgICAgdGhpcy5fYW55UGFyYW1WYXJpZXNQZXJJbnN0YW5jZSA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl9zYXZlZERhdGEgPSBudWxsOwogICAgICAgICAgICB0aGlzLl91bnNhdmVkRGF0YSA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX2RlYnVnRGF0YSA9IHRoaXMuX3J1bnRpbWUuSXNEZWJ1ZygpID8gewogICAgICAgICAgICAgICAgaXNCcmVha3BvaW50OiBkYXRhWzhdWzBdLAogICAgICAgICAgICAgICAgY2FuRGVidWc6IGRhdGFbOF1bMV0KICAgICAgICAgICAgfSA6IG51bGw7CiAgICAgICAgICAgIGlmIChkYXRhWzBdID09PSAtMSkgdGhpcy5fc3lzdGVtUGx1Z2luID0gdGhpcy5fcnVudGltZS5HZXRTeXN0ZW1QbHVnaW4oKTsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLl9vYmplY3RDbGFzcyA9IHRoaXMuX3J1bnRpbWUuR2V0T2JqZWN0Q2xhc3NCeUluZGV4KGRhdGFbMF0pOwogICAgICAgICAgICAgICAgaWYgKGRhdGFbMl0pIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9iZWhhdmlvclR5cGUgPSB0aGlzLl9vYmplY3RDbGFzcy5HZXRCZWhhdmlvclR5cGVCeU5hbWUoZGF0YVsyXSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYmVoYXZpb3JJbmRleCA9CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX29iamVjdENsYXNzLkdldEJlaGF2aW9ySW5kZXhCeU5hbWUoZGF0YVsyXSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh0aGlzLl9ldmVudEJsb2NrLkdldFBhcmVudCgpKSB0aGlzLl9ldmVudEJsb2NrLkdldFBhcmVudCgpLlNldFNvbFdyaXRlckFmdGVyQ25kcygpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGRhdGEubGVuZ3RoID09PSAxMCkgewogICAgICAgICAgICAgICAgbGV0IHBhcmFtRGF0YSA9IGRhdGFbOV07CiAgICAgICAgICAgICAgICBmb3IgKGxldCBkYXRhIG9mIHBhcmFtRGF0YSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX3BhcmFtZXRlcnMucHVzaChDMy5QYXJhbWV0ZXIuQ3JlYXRlKHRoaXMsIGRhdGEsIHRoaXMuX3BhcmFtZXRlcnMubGVuZ3RoKSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVzdWx0cy5wdXNoKDApCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHRoaXMuX3BhcmFtZXRlcnMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9wYXJhbWV0ZXJzID0gRU1QVFlfUEFSQU1TX0FSUkFZOwogICAgICAgICAgICAgICAgdGhpcy5fcmVzdWx0cyA9IEVNUFRZX1BBUkFNU19BUlJBWQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuX2V2ZW50QmxvY2suR2V0RXZlbnRTaGVldE1hbmFnZXIoKS5fUmVnaXN0ZXJDb25kaXRpb24odGhpcykKICAgICAgICB9CiAgICAgICAgc3RhdGljIENyZWF0ZShldmVudEJsb2NrLCBkYXRhLAogICAgICAgICAgICBpbmRleCkgewogICAgICAgICAgICByZXR1cm4gQzMuTmV3KEMzLkNvbmRpdGlvbiwgZXZlbnRCbG9jaywgZGF0YSwgaW5kZXgpCiAgICAgICAgfQogICAgICAgIF9Qb3N0SW5pdCgpIHsKICAgICAgICAgICAgZm9yIChjb25zdCBwYXJhbSBvZiB0aGlzLl9wYXJhbWV0ZXJzKSB7CiAgICAgICAgICAgICAgICBwYXJhbS5fUG9zdEluaXQoKTsKICAgICAgICAgICAgICAgIGlmIChwYXJhbS5WYXJpZXNQZXJJbnN0YW5jZSgpKSB0aGlzLl9hbnlQYXJhbVZhcmllc1Blckluc3RhbmNlID0gdHJ1ZQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLl9pc0Zhc3RUcmlnZ2VyKSB7CiAgICAgICAgICAgICAgICB0aGlzLlJ1biA9IHRoaXMuX1J1bkZhc3RUcmlnZ2VyOwogICAgICAgICAgICAgICAgdGhpcy5EZWJ1Z1J1biA9IHRoaXMuX0RlYnVnUnVuRmFzdFRyaWdnZXIKICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLl9zeXN0ZW1QbHVnaW4pIHsKICAgICAgICAgICAgICAgIHRoaXMuX1NldFN5c3RlbVJ1bk1ldGhvZCgpOwogICAgICAgICAgICAgICAgdGhpcy5EZWJ1Z1J1biA9IHRoaXMuX0RlYnVnUnVuU3lzdGVtCiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5fb2JqZWN0Q2xhc3MuR2V0UGx1Z2luKCkuSXNTaW5nbGVHbG9iYWwoKSkgewogICAgICAgICAgICAgICAgdGhpcy5fU2V0U2luZ2xlR2xvYmFsUnVuTWV0aG9kKCk7CiAgICAgICAgICAgICAgICB0aGlzLkRlYnVnUnVuID0gdGhpcy5fRGVidWdSdW5TaW5nbGVHbG9iYWwKICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLl9pc1N0YXRpYykgewogICAgICAgICAgICAgICAgdGhpcy5SdW4gPQogICAgICAgICAgICAgICAgICAgIHRoaXMuX1J1blN0YXRpYzsKICAgICAgICAgICAgICAgIHRoaXMuRGVidWdSdW4gPSB0aGlzLl9EZWJ1Z1J1blN0YXRpYwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5SdW4gPSB0aGlzLl9SdW5PYmplY3Q7CiAgICAgICAgICAgICAgICB0aGlzLkRlYnVnUnVuID0gdGhpcy5fRGVidWdSdW5PYmplY3QKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBfU2V0U3lzdGVtUnVuTWV0aG9kKCkgewogICAgICAgICAgICBjb25zdCBwbHVnaW4gPSB0aGlzLl9zeXN0ZW1QbHVnaW47CiAgICAgICAgICAgIGNvbnN0IGJpbmRUaGlzID0gdGhpcy5fc3lzdGVtUGx1Z2luOwogICAgICAgICAgICB0aGlzLl9TZXRSdW5NZXRob2RGb3JCb3VuZEZ1bmMocGx1Z2luLCBiaW5kVGhpcywgdGhpcy5fUnVuU3lzdGVtKQogICAgICAgIH0KICAgICAgICBfU2V0U2luZ2xlR2xvYmFsUnVuTWV0aG9kKCkgewogICAgICAgICAgICBjb25zdCBwbHVnaW4gPSB0aGlzLl9vYmplY3RDbGFzcy5HZXRQbHVnaW4oKTsKICAgICAgICAgICAgY29uc3QgYmluZFRoaXMgPSB0aGlzLl9vYmplY3RDbGFzcy5HZXRTaW5nbGVHbG9iYWxJbnN0YW5jZSgpLkdldFNka0luc3RhbmNlKCk7CiAgICAgICAgICAgIHRoaXMuX1NldFJ1bk1ldGhvZEZvckJvdW5kRnVuYyhwbHVnaW4sIGJpbmRUaGlzLCB0aGlzLl9SdW5TaW5nbGVHbG9iYWwpCiAgICAgICAgfQogICAgICAgIF9TZXRSdW5NZXRob2RGb3JCb3VuZEZ1bmMocGx1Z2luLAogICAgICAgICAgICBiaW5kVGhpcywgZmFsbGJhY2tNZXRob2QpIHsKICAgICAgICAgICAgY29uc3QgZnVuYyA9IHRoaXMuX2Z1bmM7CiAgICAgICAgICAgIGNvbnN0IGlzSW52ZXJ0ZWQgPSB0aGlzLl9pc0ludmVydGVkOwogICAgICAgICAgICBjb25zdCBwYXJhbWV0ZXJzID0gdGhpcy5fcGFyYW1ldGVyczsKICAgICAgICAgICAgaWYgKHBhcmFtZXRlcnMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgICAgICBjb25zdCBib3VuZEZ1bmMgPSBwbHVnaW4uX0dldEJvdW5kQUNFTWV0aG9kKGZ1bmMsIGJpbmRUaGlzKTsKICAgICAgICAgICAgICAgIGlmIChpc0ludmVydGVkKSB0aGlzLlJ1biA9IGZ1bmN0aW9uIFJ1blNpbmdsZUNuZF8wcGFyYW0oKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEMzLnhvcihib3VuZEZ1bmMoKSwgaXNJbnZlcnRlZCkKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBlbHNlIHRoaXMuUnVuID0gYm91bmRGdW5jCiAgICAgICAgICAgIH0gZWxzZSBpZiAocGFyYW1ldGVycy5sZW5ndGggPT09IDEpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHBhcmFtMCA9IHBhcmFtZXRlcnNbMF07CiAgICAgICAgICAgICAgICBpZiAoIWlzSW52ZXJ0ZWQgJiYgcGFyYW0wLklzQ29uc3RhbnQoKSkgdGhpcy5SdW4gPSBwbHVnaW4uX0dldEJvdW5kQUNFTWV0aG9kXzFwYXJhbShmdW5jLCBiaW5kVGhpcywgcGFyYW0wLkdldCgwKSk7CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBib3VuZEZ1bmMgPQogICAgICAgICAgICAgICAgICAgICAgICBwbHVnaW4uX0dldEJvdW5kQUNFTWV0aG9kKGZ1bmMsIGJpbmRUaGlzKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLlJ1biA9IGZ1bmN0aW9uIFJ1blNpbmdsZUNuZF8xcGFyYW0oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBDMy54b3IoYm91bmRGdW5jKHBhcmFtMC5HZXQoMCkpLCBpc0ludmVydGVkKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChwYXJhbWV0ZXJzLmxlbmd0aCA9PT0gMikgewogICAgICAgICAgICAgICAgY29uc3QgcGFyYW0wID0gcGFyYW1ldGVyc1swXTsKICAgICAgICAgICAgICAgIGNvbnN0IHBhcmFtMSA9IHBhcmFtZXRlcnNbMV07CiAgICAgICAgICAgICAgICBpZiAoIWlzSW52ZXJ0ZWQgJiYgcGFyYW0wLklzQ29uc3RhbnQoKSAmJiBwYXJhbTEuSXNDb25zdGFudCgpKSB0aGlzLlJ1biA9IHBsdWdpbi5fR2V0Qm91bmRBQ0VNZXRob2RfMnBhcmFtcyhmdW5jLCBiaW5kVGhpcywgcGFyYW0wLkdldCgwKSwgcGFyYW0xLkdldCgwKSk7CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBib3VuZEZ1bmMgPSBwbHVnaW4uX0dldEJvdW5kQUNFTWV0aG9kKGZ1bmMsIGJpbmRUaGlzKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLlJ1biA9IGZ1bmN0aW9uIFJ1blNpbmdsZUNuZF8ycGFyYW1zKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gQzMueG9yKGJvdW5kRnVuYyhwYXJhbTAuR2V0KDApLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW0xLkdldCgwKSksIGlzSW52ZXJ0ZWQpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKHBhcmFtZXRlcnMubGVuZ3RoID09PSAzKSB7CiAgICAgICAgICAgICAgICBjb25zdCBwYXJhbTAgPSBwYXJhbWV0ZXJzWzBdOwogICAgICAgICAgICAgICAgY29uc3QgcGFyYW0xID0gcGFyYW1ldGVyc1sxXTsKICAgICAgICAgICAgICAgIGNvbnN0IHBhcmFtMiA9IHBhcmFtZXRlcnNbMl07CiAgICAgICAgICAgICAgICBpZiAoIWlzSW52ZXJ0ZWQgJiYgcGFyYW0wLklzQ29uc3RhbnQoKSAmJiBwYXJhbTEuSXNDb25zdGFudCgpICYmIHBhcmFtMi5Jc0NvbnN0YW50KCkpIHRoaXMuUnVuID0gcGx1Z2luLl9HZXRCb3VuZEFDRU1ldGhvZF8zcGFyYW1zKGZ1bmMsIGJpbmRUaGlzLCBwYXJhbTAuR2V0KDApLCBwYXJhbTEuR2V0KDApLCBwYXJhbTIuR2V0KDApKTsKICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGJvdW5kRnVuYyA9IHBsdWdpbi5fR2V0Qm91bmRBQ0VNZXRob2QoZnVuYywgYmluZFRoaXMpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuUnVuID0gZnVuY3Rpb24gUnVuU2luZ2xlQ25kXzNwYXJhbXMoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBDMy54b3IoYm91bmRGdW5jKHBhcmFtMC5HZXQoMCksIHBhcmFtMS5HZXQoMCksIHBhcmFtMi5HZXQoMCkpLCBpc0ludmVydGVkKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHRoaXMuUnVuID0KICAgICAgICAgICAgICAgIGZhbGxiYWNrTWV0aG9kCiAgICAgICAgfQogICAgICAgIEdldFNJRCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NpZAogICAgICAgIH0KICAgICAgICBfR2V0RnVuYygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2Z1bmMKICAgICAgICB9CiAgICAgICAgR2V0T2JqZWN0Q2xhc3MoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9vYmplY3RDbGFzcwogICAgICAgIH0KICAgICAgICBHZXRCZWhhdmlvclR5cGUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9iZWhhdmlvclR5cGUKICAgICAgICB9CiAgICAgICAgR2V0RXZlbnRCbG9jaygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2V2ZW50QmxvY2sKICAgICAgICB9CiAgICAgICAgR2V0UnVudGltZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUKICAgICAgICB9CiAgICAgICAgR2V0SW5kZXgoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pbmRleAogICAgICAgIH0KICAgICAgICBHZXREZWJ1Z0luZGV4KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5HZXRJbmRleCgpCiAgICAgICAgfQogICAgICAgIElzVHJpZ2dlcigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2lzVHJpZ2dlcgogICAgICAgIH0KICAgICAgICBJc0Zhc3RUcmlnZ2VyKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faXNGYXN0VHJpZ2dlcgogICAgICAgIH0KICAgICAgICBJc0ludmVydGVkKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faXNJbnZlcnRlZAogICAgICAgIH0KICAgICAgICBJc0xvb3BpbmcoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pc0xvb3BpbmcKICAgICAgICB9CiAgICAgICAgSXNTdGF0aWMoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pc1N0YXRpYwogICAgICAgIH0KICAgICAgICBJc0JyZWFrcG9pbnQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9kZWJ1Z0RhdGEuaXNCcmVha3BvaW50CiAgICAgICAgfQogICAgICAgIElzU3lzdGVtQ29uZGl0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gISF0aGlzLl9zeXN0ZW1QbHVnaW4KICAgICAgICB9CiAgICAgICAgR2V0Rmlyc3RPYmplY3RQYXJhbWV0ZXJPYmplY3RDbGFzcygpIHsKICAgICAgICAgICAgZm9yIChjb25zdCBwIG9mIHRoaXMuX3BhcmFtZXRlcnMpCiAgICAgICAgICAgICAgICBpZiAocC5Jc09iamVjdFBhcmFtZXRlcigpKSByZXR1cm4gcC5HZXRPYmplY3RDbGFzcygpOwogICAgICAgICAgICByZXR1cm4gbnVsbAogICAgICAgIH0KICAgICAgICBfU2V0QnJlYWtwb2ludChiKSB7CiAgICAgICAgICAgIHRoaXMuX2RlYnVnRGF0YS5pc0JyZWFrcG9pbnQgPSAhIWI7CiAgICAgICAgICAgIHRoaXMuX2V2ZW50QmxvY2suX1VwZGF0ZUNhblJ1bkZhc3RSZWN1cnNpdmUoKQogICAgICAgIH0KICAgICAgICBfRGVidWdSZXR1cm5zR2VuZXJhdG9yKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZGVidWdEYXRhLmNhbkRlYnVnCiAgICAgICAgfQogICAgICAgIERlYnVnQ2FuUnVuRmFzdCgpIHsKICAgICAgICAgICAgcmV0dXJuICF0aGlzLklzQnJlYWtwb2ludCgpICYmICF0aGlzLl9ydW50aW1lLkRlYnVnQnJlYWtOZXh0KCkgJiYgIXRoaXMuX0RlYnVnUmV0dXJuc0dlbmVyYXRvcigpCiAgICAgICAgfQogICAgICAgIEdldFNhdmVkRGF0YU1hcCgpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLl9zYXZlZERhdGEpIHRoaXMuX3NhdmVkRGF0YSA9IG5ldyBNYXA7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zYXZlZERhdGEKICAgICAgICB9CiAgICAgICAgR2V0VW5zYXZlZERhdGFNYXAoKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5fdW5zYXZlZERhdGEpIHRoaXMuX3Vuc2F2ZWREYXRhID0gbmV3IE1hcDsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3Vuc2F2ZWREYXRhCiAgICAgICAgfQogICAgICAgIF9SdW5TeXN0ZW0oKSB7CiAgICAgICAgICAgIGNvbnN0IHJlc3VsdHMgPSB0aGlzLl9yZXN1bHRzOwogICAgICAgICAgICBFdmFsUGFyYW1zKHRoaXMuX3BhcmFtZXRlcnMsCiAgICAgICAgICAgICAgICByZXN1bHRzKTsKICAgICAgICAgICAgcmV0dXJuIEMzLnhvcih0aGlzLl9mdW5jLmFwcGx5KHRoaXMuX3N5c3RlbVBsdWdpbiwgcmVzdWx0cyksIHRoaXMuX2lzSW52ZXJ0ZWQpCiAgICAgICAgfSogX0RlYnVnUnVuU3lzdGVtKCkgewogICAgICAgICAgICBpZiAodGhpcy5Jc0JyZWFrcG9pbnQoKSB8fCB0aGlzLl9ydW50aW1lLkRlYnVnQnJlYWtOZXh0KCkpIHlpZWxkIHRoaXM7CiAgICAgICAgICAgIGlmICh0aGlzLl9EZWJ1Z1JldHVybnNHZW5lcmF0b3IoKSkgewogICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0cyA9IHRoaXMuX3Jlc3VsdHM7CiAgICAgICAgICAgICAgICBFdmFsUGFyYW1zKHRoaXMuX3BhcmFtZXRlcnMsIHJlc3VsdHMpOwogICAgICAgICAgICAgICAgbGV0IHJldCA9IHRoaXMuX2Z1bmMuYXBwbHkodGhpcy5fc3lzdGVtUGx1Z2luLCByZXN1bHRzKTsKICAgICAgICAgICAgICAgIGlmIChDMy5Jc0l0ZXJhdG9yKHJldCkpIHJldCA9IHlpZWxkKiByZXQ7CiAgICAgICAgICAgICAgICByZXR1cm4gQzMueG9yKHJldCwgdGhpcy5faXNJbnZlcnRlZCkKICAgICAgICAgICAgfSBlbHNlIHJldHVybiB0aGlzLlJ1bigpCiAgICAgICAgfQogICAgICAgIF9SdW5TaW5nbGVHbG9iYWwoKSB7CiAgICAgICAgICAgIGNvbnN0IHJlc3VsdHMgPSB0aGlzLl9yZXN1bHRzOwogICAgICAgICAgICBFdmFsUGFyYW1zKHRoaXMuX3BhcmFtZXRlcnMsIHJlc3VsdHMpOwogICAgICAgICAgICBjb25zdCBpbnN0ID0gdGhpcy5fb2JqZWN0Q2xhc3MuR2V0U2luZ2xlR2xvYmFsSW5zdGFuY2UoKS5HZXRTZGtJbnN0YW5jZSgpOwogICAgICAgICAgICByZXR1cm4gQzMueG9yKHRoaXMuX2Z1bmMuYXBwbHkoaW5zdCwgcmVzdWx0cyksIHRoaXMuX2lzSW52ZXJ0ZWQpCiAgICAgICAgfSogX0RlYnVnUnVuU2luZ2xlR2xvYmFsKCkgewogICAgICAgICAgICBpZiAodGhpcy5Jc0JyZWFrcG9pbnQoKSB8fCB0aGlzLl9ydW50aW1lLkRlYnVnQnJlYWtOZXh0KCkpIHlpZWxkIHRoaXM7CiAgICAgICAgICAgIGlmICh0aGlzLl9EZWJ1Z1JldHVybnNHZW5lcmF0b3IoKSkgewogICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0cyA9IHRoaXMuX3Jlc3VsdHM7CiAgICAgICAgICAgICAgICBFdmFsUGFyYW1zKHRoaXMuX3BhcmFtZXRlcnMsIHJlc3VsdHMpOwogICAgICAgICAgICAgICAgY29uc3QgaW5zdCA9IHRoaXMuX29iamVjdENsYXNzLkdldFNpbmdsZUdsb2JhbEluc3RhbmNlKCkuR2V0U2RrSW5zdGFuY2UoKTsKICAgICAgICAgICAgICAgIGxldCByZXQgPSB0aGlzLl9mdW5jLmFwcGx5KGluc3QsIHJlc3VsdHMpOwogICAgICAgICAgICAgICAgaWYgKEMzLklzSXRlcmF0b3IocmV0KSkgcmV0ID0geWllbGQqIHJldDsKICAgICAgICAgICAgICAgIHJldHVybiBDMy54b3IocmV0LCB0aGlzLl9pc0ludmVydGVkKQogICAgICAgICAgICB9IGVsc2UgcmV0dXJuIHRoaXMuUnVuKCkKICAgICAgICB9CiAgICAgICAgX1J1bkZhc3RUcmlnZ2VyKCkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgIH0qIF9EZWJ1Z1J1bkZhc3RUcmlnZ2VyKCkgewogICAgICAgICAgICBpZiAodGhpcy5Jc0JyZWFrcG9pbnQoKSB8fAogICAgICAgICAgICAgICAgdGhpcy5fcnVudGltZS5EZWJ1Z0JyZWFrTmV4dCgpKSB5aWVsZCB0aGlzOwogICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgIH0KICAgICAgICBfUnVuU3RhdGljKCkgewogICAgICAgICAgICBjb25zdCByZXN1bHRzID0gdGhpcy5fcmVzdWx0czsKICAgICAgICAgICAgRXZhbFBhcmFtcyh0aGlzLl9wYXJhbWV0ZXJzLCByZXN1bHRzKTsKICAgICAgICAgICAgY29uc3QgcmV0ID0gdGhpcy5fZnVuYy5hcHBseSh0aGlzLl9iZWhhdmlvclR5cGUgfHwgdGhpcy5fb2JqZWN0Q2xhc3MsIHJlc3VsdHMpOwogICAgICAgICAgICB0aGlzLl9vYmplY3RDbGFzcy5BcHBseVNvbFRvQ29udGFpbmVyKCk7CiAgICAgICAgICAgIHJldHVybiByZXQKICAgICAgICB9KiBfRGVidWdSdW5TdGF0aWMoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLklzQnJlYWtwb2ludCgpIHx8IHRoaXMuX3J1bnRpbWUuRGVidWdCcmVha05leHQoKSkgeWllbGQgdGhpczsKICAgICAgICAgICAgaWYgKHRoaXMuX0RlYnVnUmV0dXJuc0dlbmVyYXRvcigpKSB7CiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHRzID0gdGhpcy5fcmVzdWx0czsKICAgICAgICAgICAgICAgIEV2YWxQYXJhbXModGhpcy5fcGFyYW1ldGVycywgcmVzdWx0cyk7CiAgICAgICAgICAgICAgICBsZXQgcmV0ID0gdGhpcy5fZnVuYy5hcHBseSh0aGlzLl9iZWhhdmlvclR5cGUgfHwgdGhpcy5fb2JqZWN0Q2xhc3MsCiAgICAgICAgICAgICAgICAgICAgcmVzdWx0cyk7CiAgICAgICAgICAgICAgICBpZiAoQzMuSXNJdGVyYXRvcihyZXQpKSByZXQgPSB5aWVsZCogcmV0OwogICAgICAgICAgICAgICAgdGhpcy5fb2JqZWN0Q2xhc3MuQXBwbHlTb2xUb0NvbnRhaW5lcigpOwogICAgICAgICAgICAgICAgcmV0dXJuIHJldAogICAgICAgICAgICB9IGVsc2UgcmV0dXJuIHRoaXMuUnVuKCkKICAgICAgICB9CiAgICAgICAgX1J1bk9iamVjdCgpIHsKICAgICAgICAgICAgY29uc3QgcGFyYW1ldGVycyA9IHRoaXMuX3BhcmFtZXRlcnM7CiAgICAgICAgICAgIGNvbnN0IHJlc3VsdHMgPSB0aGlzLl9yZXN1bHRzOwogICAgICAgICAgICBjb25zdCBzb2wgPSB0aGlzLl9vYmplY3RDbGFzcy5HZXRDdXJyZW50U29sKCk7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBwYXJhbWV0ZXJzLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7CiAgICAgICAgICAgICAgICBjb25zdCBwID0gcGFyYW1ldGVyc1tpXTsKICAgICAgICAgICAgICAgIGlmICghcC5WYXJpZXNQZXJJbnN0YW5jZSgpKSByZXN1bHRzW2ldID0gcC5HZXQoMCkKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoc29sLklzU2VsZWN0QWxsKCkpIHJldHVybiB0aGlzLl9SdW5PYmplY3RfRmlyc3RGaWx0ZXIoc29sKTsKICAgICAgICAgICAgZWxzZSByZXR1cm4gdGhpcy5fUnVuT2JqZWN0X05leHRGaWx0ZXIoc29sKQogICAgICAgIH0qIF9EZWJ1Z1J1bk9iamVjdCgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuSXNCcmVha3BvaW50KCkgfHwgdGhpcy5fcnVudGltZS5EZWJ1Z0JyZWFrTmV4dCgpKSB5aWVsZCB0aGlzOwogICAgICAgICAgICByZXR1cm4gdGhpcy5fUnVuT2JqZWN0KCkKICAgICAgICB9CiAgICAgICAgX0V2YWx1YXRlVmFyeWluZ1BhcmFtZXRlcnMoc29sSW5kZXgpIHsKICAgICAgICAgICAgY29uc3QgcGFyYW1ldGVycyA9IHRoaXMuX3BhcmFtZXRlcnM7CiAgICAgICAgICAgIGNvbnN0IHJlc3VsdHMgPSB0aGlzLl9yZXN1bHRzOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gcGFyYW1ldGVycy5sZW5ndGg7IGkgPCBsZW47ICsraSkgewogICAgICAgICAgICAgICAgY29uc3QgcCA9IHBhcmFtZXRlcnNbaV07CiAgICAgICAgICAgICAgICBpZiAocC5WYXJpZXNQZXJJbnN0YW5jZSgpKSByZXN1bHRzW2ldID0gcC5HZXQoc29sSW5kZXgpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgX1J1bk9iamVjdF9GaXJzdEZpbHRlcihzb2wpIHsKICAgICAgICAgICAgY29uc3Qgb2JqZWN0Q2xhc3MgPSB0aGlzLl9vYmplY3RDbGFzczsKICAgICAgICAgICAgY29uc3QgaXNGYW1pbHkgPSBvYmplY3RDbGFzcy5Jc0ZhbWlseSgpOwogICAgICAgICAgICBjb25zdCBmYW1pbHlJbmRleCA9IG9iamVjdENsYXNzLkdldEZhbWlseUluZGV4KCk7CiAgICAgICAgICAgIGNvbnN0IGJlaGF2aW9ySW5kZXggPSB0aGlzLl9iZWhhdmlvckluZGV4OwogICAgICAgICAgICBjb25zdCBpc0JlaGF2aW9yID0gYmVoYXZpb3JJbmRleCA+PSAwOwogICAgICAgICAgICBjb25zdCBhbGxJbnN0YW5jZXMgPSBvYmplY3RDbGFzcy5HZXRJbnN0YW5jZXMoKTsKICAgICAgICAgICAgY29uc3QgcGFyYW1zVmFyeSA9IHRoaXMuX2FueVBhcmFtVmFyaWVzUGVySW5zdGFuY2U7CiAgICAgICAgICAgIGNvbnN0IHJlc3VsdHMgPSB0aGlzLl9yZXN1bHRzOwogICAgICAgICAgICBjb25zdCBmdW5jID0gdGhpcy5fZnVuYzsKICAgICAgICAgICAgY29uc3QgaXNJbnZlcnRlZCA9IHRoaXMuX2lzSW52ZXJ0ZWQ7CiAgICAgICAgICAgIGNvbnN0IGlzSW5PckJsb2NrID0gdGhpcy5faXNJbk9yQmxvY2sgJiYgIXRoaXMuX2lzVHJpZ2dlcjsKICAgICAgICAgICAgc29sLkNsZWFyQXJyYXlzKCk7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBhbGxJbnN0YW5jZXMubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGluc3QgPSBhbGxJbnN0YW5jZXNbaV07CiAgICAgICAgICAgICAgICBpZiAocGFyYW1zVmFyeSkgdGhpcy5fRXZhbHVhdGVWYXJ5aW5nUGFyYW1ldGVycyhpKTsKICAgICAgICAgICAgICAgIGxldCByZXQ7CiAgICAgICAgICAgICAgICBpZiAoaXNCZWhhdmlvcikgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IG9mZnNldCA9IGlzRmFtaWx5ID8gaW5zdC5HZXRPYmplY3RDbGFzcygpLkdldEZhbWlseUJlaGF2aW9yT2Zmc2V0KGZhbWlseUluZGV4KSA6IDA7CiAgICAgICAgICAgICAgICAgICAgcmV0ID0gZnVuYy5hcHBseShpbnN0LkdldEJlaGF2aW9ySW5zdGFuY2VzKClbYmVoYXZpb3JJbmRleCArIG9mZnNldF0uR2V0U2RrSW5zdGFuY2UoKSwKICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0cykKICAgICAgICAgICAgICAgIH0gZWxzZSByZXQgPSBmdW5jLmFwcGx5KGluc3QuR2V0U2RrSW5zdGFuY2UoKSwgcmVzdWx0cyk7CiAgICAgICAgICAgICAgICBpZiAoQzMueG9yKHJldCwgaXNJbnZlcnRlZCkpIHNvbC5fUHVzaEluc3RhbmNlKGluc3QpOwogICAgICAgICAgICAgICAgZWxzZSBpZiAoaXNJbk9yQmxvY2spIHNvbC5fUHVzaEVsc2VJbnN0YW5jZShpbnN0KQogICAgICAgICAgICB9CiAgICAgICAgICAgIG9iamVjdENsYXNzLkZpbmlzaENvbmRpdGlvbih0cnVlKTsKICAgICAgICAgICAgc29sLl9TZXRTZWxlY3RBbGwoZmFsc2UpOwogICAgICAgICAgICBvYmplY3RDbGFzcy5BcHBseVNvbFRvQ29udGFpbmVyKCk7CiAgICAgICAgICAgIHJldHVybiBzb2wuSGFzQW55SW5zdGFuY2VzKCkKICAgICAgICB9CiAgICAgICAgX1J1bk9iamVjdF9OZXh0RmlsdGVyKHNvbCkgewogICAgICAgICAgICBjb25zdCBvYmplY3RDbGFzcyA9IHRoaXMuX29iamVjdENsYXNzOwogICAgICAgICAgICBjb25zdCBpc0ZhbWlseSA9IG9iamVjdENsYXNzLklzRmFtaWx5KCk7CiAgICAgICAgICAgIGNvbnN0IGZhbWlseUluZGV4ID0gb2JqZWN0Q2xhc3MuR2V0RmFtaWx5SW5kZXgoKTsKICAgICAgICAgICAgY29uc3QgaXNJbkNvbnRhaW5lciA9IG9iamVjdENsYXNzLklzSW5Db250YWluZXIoKTsKICAgICAgICAgICAgY29uc3QgYmVoYXZpb3JJbmRleCA9IHRoaXMuX2JlaGF2aW9ySW5kZXg7CiAgICAgICAgICAgIGNvbnN0IGlzQmVoYXZpb3IgPSBiZWhhdmlvckluZGV4ID49IDA7CiAgICAgICAgICAgIGNvbnN0IHBhcmFtc1ZhcnkgPSB0aGlzLl9hbnlQYXJhbVZhcmllc1Blckluc3RhbmNlOwogICAgICAgICAgICBjb25zdCByZXN1bHRzID0gdGhpcy5fcmVzdWx0czsKICAgICAgICAgICAgY29uc3QgZnVuYyA9IHRoaXMuX2Z1bmM7CiAgICAgICAgICAgIGNvbnN0IGlzSW52ZXJ0ZWQgPSB0aGlzLl9pc0ludmVydGVkOwogICAgICAgICAgICBjb25zdCBpc0luT3JCbG9jayA9IHRoaXMuX2lzSW5PckJsb2NrICYmICF0aGlzLl9pc1RyaWdnZXI7CiAgICAgICAgICAgIGNvbnN0IHNvbEluc3RhbmNlcyA9IHNvbC5fR2V0T3duSW5zdGFuY2VzKCk7CiAgICAgICAgICAgIGNvbnN0IHNvbEVsc2VJbnN0YW5jZXMgPSBzb2wuX0dldE93bkVsc2VJbnN0YW5jZXMoKTsKICAgICAgICAgICAgY29uc3QgaXNVc2luZ0Vsc2VJbnN0YW5jZXMgPSBpc0luT3JCbG9jayAmJiAhdGhpcy5fZXZlbnRCbG9jay5Jc0ZpcnN0Q29uZGl0aW9uT2ZUeXBlKHRoaXMpOwogICAgICAgICAgICBjb25zdCBhcnIgPSBpc1VzaW5nRWxzZUluc3RhbmNlcyA/IHNvbEVsc2VJbnN0YW5jZXMgOiBzb2xJbnN0YW5jZXM7CiAgICAgICAgICAgIGxldCBrID0gMDsKICAgICAgICAgICAgbGV0IGlzQW55VHJ1ZSA9IGZhbHNlOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMCwKICAgICAgICAgICAgICAgICAgICBsZW4gPSBhcnIubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGluc3QgPSBhcnJbaV07CiAgICAgICAgICAgICAgICBpZiAocGFyYW1zVmFyeSkgdGhpcy5fRXZhbHVhdGVWYXJ5aW5nUGFyYW1ldGVycyhpKTsKICAgICAgICAgICAgICAgIGxldCByZXQ7CiAgICAgICAgICAgICAgICBpZiAoaXNCZWhhdmlvcikgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IG9mZnNldCA9IGlzRmFtaWx5ID8gaW5zdC5HZXRPYmplY3RDbGFzcygpLkdldEZhbWlseUJlaGF2aW9yT2Zmc2V0KGZhbWlseUluZGV4KSA6IDA7CiAgICAgICAgICAgICAgICAgICAgcmV0ID0gZnVuYy5hcHBseShpbnN0LkdldEJlaGF2aW9ySW5zdGFuY2VzKClbYmVoYXZpb3JJbmRleCArIG9mZnNldF0uR2V0U2RrSW5zdGFuY2UoKSwgcmVzdWx0cykKICAgICAgICAgICAgICAgIH0gZWxzZSByZXQgPSBmdW5jLmFwcGx5KGluc3QuR2V0U2RrSW5zdGFuY2UoKSwgcmVzdWx0cyk7CiAgICAgICAgICAgICAgICBpZiAoQzMueG9yKHJldCwgaXNJbnZlcnRlZCkpIHsKICAgICAgICAgICAgICAgICAgICBpc0FueVRydWUgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGlmIChpc1VzaW5nRWxzZUluc3RhbmNlcykgewogICAgICAgICAgICAgICAgICAgICAgICBzb2xJbnN0YW5jZXMucHVzaChpbnN0KTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzSW5Db250YWluZXIpIGluc3QuX1B1c2hTaWJsaW5nc1RvU29sSW5zdGFuY2VzKCkKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBhcnJba10gPSBpbnN0OwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNJbkNvbnRhaW5lcikgaW5zdC5fU2V0U2libGluZ3NUb1NvbEluc3RhbmNlc0luZGV4KGspOwogICAgICAgICAgICAgICAgICAgICAgICArK2sKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGlzVXNpbmdFbHNlSW5zdGFuY2VzKSB7CiAgICAgICAgICAgICAgICAgICAgYXJyW2tdID0gaW5zdDsKICAgICAgICAgICAgICAgICAgICBpZiAoaXNJbkNvbnRhaW5lcikgaW5zdC5fU2V0U2libGluZ3NUb1NvbEVsc2VJbnN0YW5jZXNJbmRleChrKTsKICAgICAgICAgICAgICAgICAgICArK2sKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNJbk9yQmxvY2spIHsKICAgICAgICAgICAgICAgICAgICBzb2xFbHNlSW5zdGFuY2VzLnB1c2goaW5zdCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzSW5Db250YWluZXIpIGluc3QuX1B1c2hTaWJsaW5nc1RvU29sRWxzZUluc3RhbmNlcygpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgQzMudHJ1bmNhdGVBcnJheShhcnIsIGspOwogICAgICAgICAgICBpZiAoaXNJbkNvbnRhaW5lcikgb2JqZWN0Q2xhc3MuX1RydW5jYXRlQ29udGFpbmVyU29scyhpc1VzaW5nRWxzZUluc3RhbmNlcywgayk7CiAgICAgICAgICAgIGNvbnN0IHBpY2tJbkZpbmlzaCA9IGlzQW55VHJ1ZTsKICAgICAgICAgICAgaWYgKGlzVXNpbmdFbHNlSW5zdGFuY2VzICYmICFpc0FueVRydWUpIGlzQW55VHJ1ZSA9IHRoaXMuX09yQmxvY2tDaGVja0luc3RhbmNlcyhzb2xJbnN0YW5jZXMpOwogICAgICAgICAgICBvYmplY3RDbGFzcy5GaW5pc2hDb25kaXRpb24ocGlja0luRmluaXNoIHx8CiAgICAgICAgICAgICAgICBpc0luT3JCbG9jayk7CiAgICAgICAgICAgIHJldHVybiBpc0luT3JCbG9jayA/IGlzQW55VHJ1ZSA6IHNvbC5IYXNBbnlJbnN0YW5jZXMoKQogICAgICAgIH0KICAgICAgICBfT3JCbG9ja0NoZWNrSW5zdGFuY2VzKHNvbEluc3RhbmNlcykgewogICAgICAgICAgICBjb25zdCBvYmplY3RDbGFzcyA9IHRoaXMuX29iamVjdENsYXNzOwogICAgICAgICAgICBjb25zdCBpc0ZhbWlseSA9IG9iamVjdENsYXNzLklzRmFtaWx5KCk7CiAgICAgICAgICAgIGNvbnN0IGZhbWlseUluZGV4ID0gb2JqZWN0Q2xhc3MuR2V0RmFtaWx5SW5kZXgoKTsKICAgICAgICAgICAgY29uc3QgcGFyYW1zVmFyeSA9IHRoaXMuX2FueVBhcmFtVmFyaWVzUGVySW5zdGFuY2U7CiAgICAgICAgICAgIGNvbnN0IGJlaGF2aW9ySW5kZXggPSB0aGlzLl9iZWhhdmlvckluZGV4OwogICAgICAgICAgICBjb25zdCBpc0JlaGF2aW9yID0gYmVoYXZpb3JJbmRleCA+PSAwOwogICAgICAgICAgICBjb25zdCByZXN1bHRzID0gdGhpcy5fcmVzdWx0czsKICAgICAgICAgICAgY29uc3QgZnVuYyA9IHRoaXMuX2Z1bmM7CiAgICAgICAgICAgIGNvbnN0IGlzSW52ZXJ0ZWQgPSB0aGlzLl9pc0ludmVydGVkOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gc29sSW5zdGFuY2VzLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7CiAgICAgICAgICAgICAgICBjb25zdCBpbnN0ID0gc29sSW5zdGFuY2VzW2ldOwogICAgICAgICAgICAgICAgaWYgKHBhcmFtc1ZhcnkpIHRoaXMuX0V2YWx1YXRlVmFyeWluZ1BhcmFtZXRlcnMoaSk7CiAgICAgICAgICAgICAgICBsZXQgcmV0OwogICAgICAgICAgICAgICAgaWYgKGlzQmVoYXZpb3IpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBvZmZzZXQgPSBpc0ZhbWlseSA/IGluc3QuR2V0T2JqZWN0Q2xhc3MoKS5HZXRGYW1pbHlCZWhhdmlvck9mZnNldChmYW1pbHlJbmRleCkgOiAwOwogICAgICAgICAgICAgICAgICAgIHJldCA9IGZ1bmMuYXBwbHkoaW5zdC5HZXRCZWhhdmlvckluc3RhbmNlcygpW2JlaGF2aW9ySW5kZXggKyBvZmZzZXRdLkdldFNka0luc3RhbmNlKCksIHJlc3VsdHMpCiAgICAgICAgICAgICAgICB9IGVsc2UgcmV0ID0gZnVuYy5hcHBseShpbnN0LkdldFNka0luc3RhbmNlKCksIHJlc3VsdHMpOwogICAgICAgICAgICAgICAgaWYgKEMzLnhvcihyZXQsIGlzSW52ZXJ0ZWQpKSByZXR1cm4gdHJ1ZQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZQogICAgICAgIH0KICAgICAgICBSZWV2YWx1YXRlUGFyYW1ldGVyKHBhcmFtSW5kZXgsIHNvbEluZGV4KSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9wYXJhbWV0ZXJzW3BhcmFtSW5kZXhdLkdldChzb2xJbmRleCkKICAgICAgICB9CiAgICAgICAgR2V0RmFzdFRyaWdnZXJWYWx1ZSgpIHsKICAgICAgICAgICAgY29uc3QgcGFyYW1ldGVycyA9IHRoaXMuX3BhcmFtZXRlcnM7CiAgICAgICAgICAgIGlmICghcGFyYW1ldGVycy5sZW5ndGgpIHRocm93IG5ldyBFcnJvcigibm8gcGFyYW1ldGVycyIpOwogICAgICAgICAgICByZXR1cm4gcGFyYW1ldGVyc1swXS5fR2V0RmFzdFRyaWdnZXJWYWx1ZSgpCiAgICAgICAgfQogICAgICAgIF9TYXZlVG9Kc29uKCkgewogICAgICAgICAgICBpZiAoIXRoaXMuX3NhdmVkRGF0YSB8fCAhdGhpcy5fc2F2ZWREYXRhLnNpemUpIHJldHVybiBudWxsOwogICAgICAgICAgICBjb25zdCBleCA9IHt9OwogICAgICAgICAgICBmb3IgKGNvbnN0IFtrLCB2XSBvZiB0aGlzLl9zYXZlZERhdGEuZW50cmllcygpKSB7CiAgICAgICAgICAgICAgICBsZXQgc2F2ZVZhbCA9IHY7CiAgICAgICAgICAgICAgICBpZiAoayA9PT0gImNvbGxtZW1vcnkiKSBzYXZlVmFsID0gWy4uLnYuZW50cmllcygpXS5tYXAoYXJyID0+IFthcnJbMF0uR2V0VUlEKCksIGFyclsxXS5HZXRVSUQoKSwgYXJyWzJdXSk7CiAgICAgICAgICAgICAgICBleFtrXSA9IHNhdmVWYWwKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgImV4IjogZXgKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBfTG9hZEZyb21Kc29uKG8pIHsKICAgICAgICAgICAgaWYgKHRoaXMuX3NhdmVkRGF0YSkgewogICAgICAgICAgICAgICAgdGhpcy5fc2F2ZWREYXRhLmNsZWFyKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9zYXZlZERhdGEgPSBudWxsCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCFvKSByZXR1cm47CiAgICAgICAgICAgIGNvbnN0IHJ1bnRpbWUgPSB0aGlzLl9ydW50aW1lOwogICAgICAgICAgICBjb25zdCBleCA9IG9bImV4Il07CiAgICAgICAgICAgIGlmIChleCkgewogICAgICAgICAgICAgICAgY29uc3QgbWFwID0gdGhpcy5HZXRTYXZlZERhdGFNYXAoKTsKICAgICAgICAgICAgICAgIG1hcC5jbGVhcigpOwogICAgICAgICAgICAgICAgZm9yIChjb25zdCBbaywgdl0gb2YgT2JqZWN0LmVudHJpZXMoZXgpKSB7CiAgICAgICAgICAgICAgICAgICAgbGV0IGxvYWRWYWwgPSB2OwogICAgICAgICAgICAgICAgICAgIGlmIChrID09PSAiY29sbG1lbW9yeSIpIGxvYWRWYWwgPSBDMy5OZXcoQzMuUGFpck1hcCwgdi5tYXAoYXJyID0+IFtydW50aW1lLkdldEluc3RhbmNlQnlVSUQoYXJyWzBdKSwgcnVudGltZS5HZXRJbnN0YW5jZUJ5VUlEKGFyclsxXSksIGFyclsyXV0pLmZpbHRlcihhcnIgPT4gYXJyWzBdICYmIGFyclsxXSkpOwogICAgICAgICAgICAgICAgICAgIG1hcC5zZXQoaywgbG9hZFZhbCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07Cgp9CgovLyBldmVudHMvYWN0aW9uLmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIGNvbnN0IGFzc2VydCA9IHNlbGYuYXNzZXJ0OwoKICAgIGZ1bmN0aW9uIEV2YWxQYXJhbXMocGFyYW1ldGVycywgcmVzdWx0cykgewogICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBwYXJhbWV0ZXJzLmxlbmd0aDsgaSA8IGxlbjsgKytpKSByZXN1bHRzW2ldID0gcGFyYW1ldGVyc1tpXS5HZXQoMCkKICAgIH0KICAgIGNvbnN0IEVNUFRZX1BBUkFNU19BUlJBWSA9IFtdOwogICAgY29uc3Qgbm9vcCA9IGZ1bmN0aW9uKCkge307CiAgICBjb25zdCBub29wR2VuZXJhdG9yID0gZnVuY3Rpb24qKCkge307CiAgICBjb25zdCBGTEFHX0NBTlBJQ0tBTllPQkpFQ1RDTEFTUyA9IDE7CiAgICBjb25zdCBGTEFHX0NPUFlQSUNLRUQgPSAyOwogICAgY29uc3QgRkxBR19DVVNUT01fQUNFID0gNDsKICAgIEMzLkFjdGlvbiA9IGNsYXNzIEFjdGlvbiBleHRlbmRzIEMzLkRlZmVuZGVkQmFzZSB7CiAgICAgICAgY29uc3RydWN0b3IoZXZlbnRCbG9jaywgZGF0YSwgaW5kZXgpIHsKICAgICAgICAgICAgc3VwZXIoKTsKICAgICAgICAgICAgdGhpcy5fZXZlbnRCbG9jayA9IGV2ZW50QmxvY2s7CiAgICAgICAgICAgIGNvbnN0IHJ1bnRpbWUgPSBldmVudEJsb2NrLkdldFJ1bnRpbWUoKTsKICAgICAgICAgICAgdGhpcy5fcnVudGltZSA9IHJ1bnRpbWU7CiAgICAgICAgICAgIHRoaXMuX2luZGV4ID0gaW5kZXg7CiAgICAgICAgICAgIHRoaXMuX3NpZCA9IGRhdGEubGVuZ3RoID49IDQgPyBkYXRhWzNdIDogLTE7CiAgICAgICAgICAgIHRoaXMuX2FjdGlvblR5cGUgPSBkYXRhLmxlbmd0aCA+PSA1ID8gZGF0YVs0XSAmIDI1NSA6IDA7CiAgICAgICAgICAgIHRoaXMuX2ZsYWdzID0gZGF0YS5sZW5ndGggPj0gNSA/IGRhdGFbNF0gPj4gOCA6IDA7CiAgICAgICAgICAgIHRoaXMuX2Z1bmMgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9vYmplY3RDbGFzcyA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX2JlaGF2aW9yVHlwZSA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX2JlaGF2aW9ySW5kZXggPSAtMTsKICAgICAgICAgICAgdGhpcy5fc3lzdGVtUGx1Z2luID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fY2FsbEZ1bmN0aW9uTmFtZSA9ICIiOwogICAgICAgICAgICB0aGlzLl9jYWxsQ3VzdG9tQWNlT2JqZWN0Q2xhc3MgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9jYWxsRXZlbnRCbG9jayA9CiAgICAgICAgICAgICAgICBudWxsOwogICAgICAgICAgICB0aGlzLlJ1biA9IG5vb3A7CiAgICAgICAgICAgIHRoaXMuRGVidWdSdW4gPSBub29wOwogICAgICAgICAgICB0aGlzLl9wYXJhbWV0ZXJzID0gW107CiAgICAgICAgICAgIHRoaXMuX3Jlc3VsdHMgPSBbXTsKICAgICAgICAgICAgdGhpcy5fYW55UGFyYW1WYXJpZXNQZXJJbnN0YW5jZSA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl9zYXZlZERhdGEgPSBudWxsOwogICAgICAgICAgICB0aGlzLl91bnNhdmVkRGF0YSA9IG51bGw7CiAgICAgICAgICAgIGNvbnN0IGlzU2NyaXB0ID0gZGF0YVswXSA9PT0gLTM7CiAgICAgICAgICAgIGNvbnN0IGRlYnVnSW5mbyA9IGlzU2NyaXB0ID8gZGF0YVsyXSA6IGRhdGFbNV07CiAgICAgICAgICAgIHRoaXMuX2RlYnVnRGF0YSA9IHJ1bnRpbWUuSXNEZWJ1ZygpIHx8IGlzU2NyaXB0ID8gewogICAgICAgICAgICAgICAgaXNCcmVha3BvaW50OiBkZWJ1Z0luZm9bMF0sCiAgICAgICAgICAgICAgICBjYW5EZWJ1ZzogZGVidWdJbmZvWzFdLAogICAgICAgICAgICAgICAgaW5kZXg6IGRlYnVnSW5mb1syXQogICAgICAgICAgICB9IDogbnVsbDsKICAgICAgICAgICAgaWYgKGRhdGFbMF0gPT09IC0xKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9zeXN0ZW1QbHVnaW4gPSBydW50aW1lLkdldFN5c3RlbVBsdWdpbigpOwogICAgICAgICAgICAgICAgdGhpcy5fZnVuYyA9IHJ1bnRpbWUuR2V0T2JqZWN0UmVmZXJlbmNlKGRhdGFbMV0pCiAgICAgICAgICAgIH0gZWxzZSBpZiAoZGF0YVswXSA9PT0gLTIpIHRoaXMuX2NhbGxGdW5jdGlvbk5hbWUgPSBkYXRhWzFdOwogICAgICAgICAgICBlbHNlIGlmIChpc1NjcmlwdCkgewogICAgICAgICAgICAgICAgY29uc3QgdXNlck1ldGhvZCA9IHJ1bnRpbWUuR2V0T2JqZWN0UmVmZXJlbmNlKGRhdGFbMV0pOwogICAgICAgICAgICAgICAgdGhpcy5fZnVuYyA9IHVzZXJNZXRob2Q7CiAgICAgICAgICAgICAgICB0aGlzLlJ1biA9IHRoaXMuUnVuVXNlclNjcmlwdDsKICAgICAgICAgICAgICAgIHRoaXMuRGVidWdSdW4gPSB0aGlzLkRlYnVnUnVuVXNlclNjcmlwdDsKICAgICAgICAgICAgICAgIHRoaXMuX2FjdGlvblR5cGUgPSAxCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLl9vYmplY3RDbGFzcyA9IHJ1bnRpbWUuR2V0T2JqZWN0Q2xhc3NCeUluZGV4KGRhdGFbMF0pOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuX2ZsYWdzICYgRkxBR19DVVNUT01fQUNFKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY2FsbEZ1bmN0aW9uTmFtZSA9IGRhdGFbMV07CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY2FsbEN1c3RvbUFjZU9iamVjdENsYXNzID0gcnVudGltZS5HZXRPYmplY3RDbGFzc0J5SW5kZXgoZGF0YVsyXSkKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGFbMl0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fYmVoYXZpb3JUeXBlID0gdGhpcy5fb2JqZWN0Q2xhc3MuR2V0QmVoYXZpb3JUeXBlQnlOYW1lKGRhdGFbMl0pOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9iZWhhdmlvckluZGV4ID0gdGhpcy5fb2JqZWN0Q2xhc3MuR2V0QmVoYXZpb3JJbmRleEJ5TmFtZShkYXRhWzJdKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9mdW5jID0KICAgICAgICAgICAgICAgICAgICAgICAgcnVudGltZS5HZXRPYmplY3RSZWZlcmVuY2UoZGF0YVsxXSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZGF0YS5sZW5ndGggPT09IDcpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHBhcmFtRGF0YSA9IGRhdGFbNl07CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGRhdGEgb2YgcGFyYW1EYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcGFyYW1ldGVycy5wdXNoKEMzLlBhcmFtZXRlci5DcmVhdGUodGhpcywgZGF0YSwgdGhpcy5fcGFyYW1ldGVycy5sZW5ndGgpKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZXN1bHRzLnB1c2goMCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGhpcy5fcGFyYW1ldGVycy5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICAgIHRoaXMuX3BhcmFtZXRlcnMgPSBFTVBUWV9QQVJBTVNfQVJSQVk7CiAgICAgICAgICAgICAgICB0aGlzLl9yZXN1bHRzID0gRU1QVFlfUEFSQU1TX0FSUkFZCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHRoaXMuQ2FuUGlja0FueU9iamVjdENsYXNzKCkpIHsKICAgICAgICAgICAgICAgIHRoaXMuX2V2ZW50QmxvY2suU2V0QWxsU29sTW9kaWZpZXJzKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9ldmVudEJsb2NrLlNldFNvbFdyaXRlckFmdGVyQ25kcygpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5fZXZlbnRCbG9jay5HZXRFdmVudFNoZWV0TWFuYWdlcigpLl9SZWdpc3RlckFjdGlvbih0aGlzKQogICAgICAgIH0KICAgICAgICBzdGF0aWMgQ3JlYXRlKGV2ZW50QmxvY2ssCiAgICAgICAgICAgIGRhdGEsIGluZGV4KSB7CiAgICAgICAgICAgIHJldHVybiBDMy5OZXcoQzMuQWN0aW9uLCBldmVudEJsb2NrLCBkYXRhLCBpbmRleCkKICAgICAgICB9CiAgICAgICAgX1Bvc3RJbml0KCkgewogICAgICAgICAgICBmb3IgKGNvbnN0IHBhcmFtIG9mIHRoaXMuX3BhcmFtZXRlcnMpIHsKICAgICAgICAgICAgICAgIHBhcmFtLl9Qb3N0SW5pdCgpOwogICAgICAgICAgICAgICAgaWYgKHBhcmFtLlZhcmllc1Blckluc3RhbmNlKCkpIHRoaXMuX2FueVBhcmFtVmFyaWVzUGVySW5zdGFuY2UgPSB0cnVlCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHRoaXMuX3N5c3RlbVBsdWdpbikgewogICAgICAgICAgICAgICAgdGhpcy5fU2V0U3lzdGVtUnVuTWV0aG9kKCk7CiAgICAgICAgICAgICAgICB0aGlzLkRlYnVnUnVuID0gdGhpcy5fRGVidWdSdW5TeXN0ZW0KICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLl9jYWxsRnVuY3Rpb25OYW1lKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fZmxhZ3MgJiBGTEFHX0NVU1RPTV9BQ0UpIHRoaXMuX1NldENhbGxDdXN0b21BY3Rpb25SdW5NZXRob2QoKTsKICAgICAgICAgICAgICAgIGVsc2UgdGhpcy5fU2V0Q2FsbEZ1bmN0aW9uUnVuTWV0aG9kKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9jYWxsRnVuY3Rpb25OYW1lID0gIiI7CiAgICAgICAgICAgICAgICB0aGlzLl9jYWxsQ3VzdG9tQWNlT2JqZWN0Q2xhc3MgPSBudWxsCiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5SdW4gPT09IHRoaXMuUnVuVXNlclNjcmlwdCkgewogICAgICAgICAgICAgICAgY29uc3QgdXNlck1ldGhvZCA9CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZnVuYzsKICAgICAgICAgICAgICAgIGNvbnN0IGxvY2FsVmFycyA9IHRoaXMuX3J1bnRpbWUuR2V0RXZlbnRTaGVldE1hbmFnZXIoKS5fR2V0TG9jYWxWYXJpYWJsZXNTY3JpcHRJbnRlcmZhY2UodGhpcy5fZXZlbnRCbG9jayk7CiAgICAgICAgICAgICAgICB0aGlzLl9mdW5jID0gdXNlck1ldGhvZC5iaW5kKG51bGwsIHRoaXMuX3J1bnRpbWUuR2V0SVJ1bnRpbWUoKSwgbG9jYWxWYXJzKQogICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuX2JlaGF2aW9yVHlwZSkKICAgICAgICAgICAgICAgIGlmICh0aGlzLklzQXN5bmMoKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuUnVuID0gdGhpcy5fUnVuQmVoYXZpb3JfQXN5bmM7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5EZWJ1Z1J1biA9IHRoaXMuX0RlYnVnUnVuQmVoYXZpb3JfQXN5bmMKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5SdW4gPSB0aGlzLl9SdW5CZWhhdmlvcjsKICAgICAgICAgICAgICAgICAgICB0aGlzLkRlYnVnUnVuID0gdGhpcy5fRGVidWdSdW5CZWhhdmlvcgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmICh0aGlzLl9vYmplY3RDbGFzcy5HZXRQbHVnaW4oKS5Jc1NpbmdsZUdsb2JhbCgpKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9TZXRTaW5nbGVHbG9iYWxSdW5NZXRob2QoKTsKICAgICAgICAgICAgICAgIHRoaXMuRGVidWdSdW4gPSB0aGlzLl9EZWJ1Z1J1blNpbmdsZUdsb2JhbAogICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuSXNBc3luYygpKSB7CiAgICAgICAgICAgICAgICB0aGlzLlJ1biA9CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fUnVuT2JqZWN0X0FzeW5jOwogICAgICAgICAgICAgICAgdGhpcy5EZWJ1Z1J1biA9IHRoaXMuX0RlYnVnUnVuT2JqZWN0X0FzeW5jCiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5DYWxsQmVmb3JlQWZ0ZXJIb29rcygpKSB7CiAgICAgICAgICAgICAgICB0aGlzLlJ1biA9IHRoaXMuX1J1bk9iamVjdF9CZWZvcmVBZnRlckhvb2tzOwogICAgICAgICAgICAgICAgdGhpcy5EZWJ1Z1J1biA9IHRoaXMuX0RlYnVnUnVuT2JqZWN0X0JlZm9yZUFmdGVySG9va3MKICAgICAgICAgICAgfSBlbHNlIGlmICghdGhpcy5fcGFyYW1ldGVycy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIHRoaXMuUnVuID0gdGhpcy5fUnVuT2JqZWN0X1BhcmFtc0NvbnN0OwogICAgICAgICAgICAgICAgdGhpcy5EZWJ1Z1J1biA9IHRoaXMuX0RlYnVnUnVuT2JqZWN0X1BhcmFtc0NvbnN0CiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5fcGFyYW1ldGVycy5ldmVyeShwID0+IHAuVmFyaWVzUGVySW5zdGFuY2UoKSkpIHsKICAgICAgICAgICAgICAgIHRoaXMuUnVuID0gdGhpcy5fUnVuT2JqZWN0X0FsbFBhcmFtc1Zhcnk7CiAgICAgICAgICAgICAgICB0aGlzLkRlYnVnUnVuID0gdGhpcy5fRGVidWdSdW5PYmplY3RfQWxsUGFyYW1zVmFyeQogICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuX2FueVBhcmFtVmFyaWVzUGVySW5zdGFuY2UpIHsKICAgICAgICAgICAgICAgIHRoaXMuUnVuID0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9SdW5PYmplY3RfU29tZVBhcmFtc1Zhcnk7CiAgICAgICAgICAgICAgICB0aGlzLkRlYnVnUnVuID0gdGhpcy5fRGVidWdSdW5PYmplY3RfU29tZVBhcmFtc1ZhcnkKICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLl9wYXJhbWV0ZXJzLmV2ZXJ5KHAgPT4gcC5Jc0NvbnN0YW50KCkpKSB7CiAgICAgICAgICAgICAgICBFdmFsUGFyYW1zKHRoaXMuX3BhcmFtZXRlcnMsIHRoaXMuX3Jlc3VsdHMpOwogICAgICAgICAgICAgICAgdGhpcy5SdW4gPSB0aGlzLl9SdW5PYmplY3RfUGFyYW1zQ29uc3Q7CiAgICAgICAgICAgICAgICB0aGlzLkRlYnVnUnVuID0gdGhpcy5fRGVidWdSdW5PYmplY3RfUGFyYW1zQ29uc3QKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuUnVuID0gdGhpcy5fUnVuT2JqZWN0X1BhcmFtc0RvbnRWYXJ5OwogICAgICAgICAgICAgICAgdGhpcy5EZWJ1Z1J1biA9IHRoaXMuX0RlYnVnUnVuT2JqZWN0X1BhcmFtc0RvbnRWYXJ5CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgX1NldFN5c3RlbVJ1bk1ldGhvZCgpIHsKICAgICAgICAgICAgY29uc3QgcGx1Z2luID0gdGhpcy5fc3lzdGVtUGx1Z2luOwogICAgICAgICAgICBjb25zdCBiaW5kVGhpcyA9IHRoaXMuX3N5c3RlbVBsdWdpbjsKICAgICAgICAgICAgdGhpcy5fU2V0UnVuTWV0aG9kRm9yQm91bmRGdW5jKHBsdWdpbiwgYmluZFRoaXMsIHRoaXMuX1J1blN5c3RlbSkKICAgICAgICB9CiAgICAgICAgX1NldFNpbmdsZUdsb2JhbFJ1bk1ldGhvZCgpIHsKICAgICAgICAgICAgY29uc3QgcGx1Z2luID0KICAgICAgICAgICAgICAgIHRoaXMuX29iamVjdENsYXNzLkdldFBsdWdpbigpOwogICAgICAgICAgICBjb25zdCBiaW5kVGhpcyA9IHRoaXMuX29iamVjdENsYXNzLkdldFNpbmdsZUdsb2JhbEluc3RhbmNlKCkuR2V0U2RrSW5zdGFuY2UoKTsKICAgICAgICAgICAgdGhpcy5fU2V0UnVuTWV0aG9kRm9yQm91bmRGdW5jKHBsdWdpbiwgYmluZFRoaXMsIHRoaXMuX1J1blNpbmdsZUdsb2JhbCkKICAgICAgICB9CiAgICAgICAgX1NldENhbGxGdW5jdGlvblJ1bk1ldGhvZCgpIHsKICAgICAgICAgICAgY29uc3QgZXZlbnRTaGVldE1hbmFnZXIgPSB0aGlzLl9ldmVudEJsb2NrLkdldEV2ZW50U2hlZXRNYW5hZ2VyKCk7CiAgICAgICAgICAgIGNvbnN0IGZ1bmN0aW9uQmxvY2sgPSBldmVudFNoZWV0TWFuYWdlci5HZXRGdW5jdGlvbkJsb2NrQnlOYW1lKHRoaXMuX2NhbGxGdW5jdGlvbk5hbWUpOwogICAgICAgICAgICBpZiAoZnVuY3Rpb25CbG9jay5Jc0VuYWJsZWQoKSkgewogICAgICAgICAgICAgICAgY29uc3QgaXNDb3B5UGlja2VkID0gKHRoaXMuX2ZsYWdzICYgRkxBR19DT1BZUElDS0VEKSAhPT0gMDsKICAgICAgICAgICAgICAgIHRoaXMuX2NhbGxFdmVudEJsb2NrID0gZnVuY3Rpb25CbG9jay5HZXRFdmVudEJsb2NrKCk7CiAgICAgICAgICAgICAgICBsZXQgY29tYmluZWRTb2xNb2RpZmllcnMgPSBbLi4uKG5ldyBTZXQoWy4uLnRoaXMuX2V2ZW50QmxvY2suR2V0U29sTW9kaWZpZXJzSW5jbHVkaW5nUGFyZW50cygpLCAuLi50aGlzLl9jYWxsRXZlbnRCbG9jay5HZXRTb2xNb2RpZmllcnNJbmNsdWRpbmdQYXJlbnRzKCldKSldOwogICAgICAgICAgICAgICAgY29tYmluZWRTb2xNb2RpZmllcnMgPSBldmVudFNoZWV0TWFuYWdlci5fRGVkdXBsaWNhdGVTb2xNb2RpZmllckxpc3QoY29tYmluZWRTb2xNb2RpZmllcnMpOwogICAgICAgICAgICAgICAgY29uc3QgcGlja0luZm8gPSAhZnVuY3Rpb25CbG9jay5Jc0NvcHlQaWNrZWQoKSAmJiB0aGlzLl9IYXNDb3B5UGlja2VkUGFyZW50KCkgPyB7CiAgICAgICAgICAgICAgICAgICAgcHVzaENsZWFuU29sRHluYW1pYzogdHJ1ZQogICAgICAgICAgICAgICAgfSA6IG51bGw7CiAgICAgICAgICAgICAgICB0aGlzLlJ1biA9IEMzLkV2ZW50QmxvY2sucHJvdG90eXBlLlJ1bkFzRnVuY3Rpb25DYWxsLmJpbmQodGhpcy5fY2FsbEV2ZW50QmxvY2ssIGNvbWJpbmVkU29sTW9kaWZpZXJzLCB0aGlzLl9wYXJhbWV0ZXJzLCBpc0NvcHlQaWNrZWQsIHBpY2tJbmZvKTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9ydW50aW1lLklzRGVidWcoKSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHRoaXogPQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzOwogICAgICAgICAgICAgICAgICAgIHRoaXMuRGVidWdSdW4gPSBmdW5jdGlvbiogRGVidWdSdW5DYWxsRnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGl6LklzQnJlYWtwb2ludCgpIHx8IHRoaXouX3J1bnRpbWUuRGVidWdCcmVha05leHQoKSkgeWllbGQgdGhpejsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmV0ID0geWllbGQqIHRoaXouX2NhbGxFdmVudEJsb2NrLkRlYnVnUnVuQXNGdW5jdGlvbkNhbGwoY29tYmluZWRTb2xNb2RpZmllcnMsIHRoaXouX3BhcmFtZXRlcnMsIGlzQ29weVBpY2tlZCwgcGlja0luZm8pOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHRoaXMuRGVidWdSdW4gPSBub29wR2VuZXJhdG9yCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLlJ1biA9IG5vb3A7CiAgICAgICAgICAgICAgICB0aGlzLkRlYnVnUnVuID0gbm9vcEdlbmVyYXRvcgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIF9TZXRDYWxsQ3VzdG9tQWN0aW9uUnVuTWV0aG9kKCkgewogICAgICAgICAgICBjb25zdCBldmVudFNoZWV0TWFuYWdlciA9IHRoaXMuX2V2ZW50QmxvY2suR2V0RXZlbnRTaGVldE1hbmFnZXIoKTsKICAgICAgICAgICAgY29uc3QgY3VzdG9tQWNlQmxvY2sgPSBldmVudFNoZWV0TWFuYWdlci5HZXRDdXN0b21BY3Rpb25CbG9ja0J5TmFtZSh0aGlzLl9jYWxsQ3VzdG9tQWNlT2JqZWN0Q2xhc3MsCiAgICAgICAgICAgICAgICB0aGlzLl9jYWxsRnVuY3Rpb25OYW1lKTsKICAgICAgICAgICAgaWYgKGN1c3RvbUFjZUJsb2NrLklzRW5hYmxlZCgpKSB7CiAgICAgICAgICAgICAgICBjb25zdCBpc0NvcHlQaWNrZWQgPSAodGhpcy5fZmxhZ3MgJiBGTEFHX0NPUFlQSUNLRUQpICE9PSAwOwogICAgICAgICAgICAgICAgdGhpcy5fY2FsbEV2ZW50QmxvY2sgPSBjdXN0b21BY2VCbG9jay5HZXRFdmVudEJsb2NrKCk7CiAgICAgICAgICAgICAgICBsZXQgY29tYmluZWRTb2xNb2RpZmllcnMgPSBbLi4uKG5ldyBTZXQoWy4uLnRoaXMuX2V2ZW50QmxvY2suR2V0U29sTW9kaWZpZXJzSW5jbHVkaW5nUGFyZW50cygpLCAuLi50aGlzLl9jYWxsRXZlbnRCbG9jay5HZXRTb2xNb2RpZmllcnNJbmNsdWRpbmdQYXJlbnRzKCksIHRoaXMuX29iamVjdENsYXNzLCBjdXN0b21BY2VCbG9jay5HZXRPYmplY3RDbGFzcygpXSkpXTsKICAgICAgICAgICAgICAgIGNvbWJpbmVkU29sTW9kaWZpZXJzID0gZXZlbnRTaGVldE1hbmFnZXIuX0RlZHVwbGljYXRlU29sTW9kaWZpZXJMaXN0KGNvbWJpbmVkU29sTW9kaWZpZXJzKTsKICAgICAgICAgICAgICAgIGNvbnN0IGlzT1R0b09UID0gIXRoaXMuX29iamVjdENsYXNzLklzRmFtaWx5KCkgJiYgIWN1c3RvbUFjZUJsb2NrLkdldE9iamVjdENsYXNzKCkuSXNGYW1pbHkoKTsKICAgICAgICAgICAgICAgIGNvbnN0IGlzT1R0b0ZhbWlseSA9ICF0aGlzLl9vYmplY3RDbGFzcy5Jc0ZhbWlseSgpICYmIGN1c3RvbUFjZUJsb2NrLkdldE9iamVjdENsYXNzKCkuSXNGYW1pbHkoKTsKICAgICAgICAgICAgICAgIGNvbnN0IGlzRmFtaWx5VG9GYW1pbHkgPSB0aGlzLl9vYmplY3RDbGFzcy5Jc0ZhbWlseSgpOwogICAgICAgICAgICAgICAgbGV0IHBpY2tJbmZvID0gbnVsbDsKICAgICAgICAgICAgICAgIGlmICghY3VzdG9tQWNlQmxvY2suSXNDb3B5UGlja2VkKCkgJiYgdGhpcy5fSGFzQ29weVBpY2tlZFBhcmVudCgpKSB7CiAgICAgICAgICAgICAgICAgICAgcGlja0luZm8gPSBwaWNrSW5mbyB8fCB7fTsKICAgICAgICAgICAgICAgICAgICBwaWNrSW5mby5wdXNoQ2xlYW5Tb2xEeW5hbWljID0gdHJ1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGlzT1R0b0ZhbWlseSB8fCAhaXNDb3B5UGlja2VkKSB7CiAgICAgICAgICAgICAgICAgICAgcGlja0luZm8gPSBwaWNrSW5mbyB8fCB7fTsKICAgICAgICAgICAgICAgICAgICBwaWNrSW5mby5jb3B5RnJvbU9iamVjdENsYXNzID0gdGhpcy5fb2JqZWN0Q2xhc3M7CiAgICAgICAgICAgICAgICAgICAgcGlja0luZm8uY29weVRvT2JqZWN0Q2xhc3MgPSBjdXN0b21BY2VCbG9jay5HZXRPYmplY3RDbGFzcygpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoaXNPVHRvT1QgfHwgaXNPVHRvRmFtaWx5IHx8IGlzRmFtaWx5VG9GYW1pbHkgJiYgIWN1c3RvbUFjZUJsb2NrLkhhc0N1c3RvbUFDRU92ZXJyaWRlcygpKSB0aGlzLlJ1biA9CiAgICAgICAgICAgICAgICAgICAgQzMuRXZlbnRCbG9jay5wcm90b3R5cGUuUnVuQXNGdW5jdGlvbkNhbGwuYmluZCh0aGlzLl9jYWxsRXZlbnRCbG9jaywgY29tYmluZWRTb2xNb2RpZmllcnMsIHRoaXMuX3BhcmFtZXRlcnMsIGlzQ29weVBpY2tlZCwgcGlja0luZm8pOwogICAgICAgICAgICAgICAgZWxzZSBpZiAoaXNGYW1pbHlUb0ZhbWlseSkgdGhpcy5SdW4gPSBDMy5GdW5jdGlvbkJsb2NrLnByb3RvdHlwZS5SdW5Bc0ZhbWlseUN1c3RvbUFjdGlvbldpdGhPdmVycmlkZXMuYmluZChjdXN0b21BY2VCbG9jaywgY29tYmluZWRTb2xNb2RpZmllcnMsIHRoaXMuX3BhcmFtZXRlcnMpOwogICAgICAgICAgICAgICAgZWxzZTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9ydW50aW1lLklzRGVidWcoKSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHRoaXogPSB0aGlzOwogICAgICAgICAgICAgICAgICAgIGlmIChpc09UdG9PVCB8fCBpc09UdG9GYW1pbHkgfHwgaXNGYW1pbHlUb0ZhbWlseSAmJiAhY3VzdG9tQWNlQmxvY2suSGFzQ3VzdG9tQUNFT3ZlcnJpZGVzKCkpIHRoaXMuRGVidWdSdW4gPSBmdW5jdGlvbiogRGVidWdSdW5DdXN0b21BY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGl6LklzQnJlYWtwb2ludCgpIHx8IHRoaXouX3J1bnRpbWUuRGVidWdCcmVha05leHQoKSkgeWllbGQgdGhpejsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmV0ID0geWllbGQqIHRoaXouX2NhbGxFdmVudEJsb2NrLkRlYnVnUnVuQXNGdW5jdGlvbkNhbGwoY29tYmluZWRTb2xNb2RpZmllcnMsIHRoaXouX3BhcmFtZXRlcnMsIGlzQ29weVBpY2tlZCwgcGlja0luZm8pOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0CiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChpc0ZhbWlseVRvRmFtaWx5KSB0aGlzLkRlYnVnUnVuID0gZnVuY3Rpb24qIERlYnVnUnVuQ3VzdG9tQWN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpei5Jc0JyZWFrcG9pbnQoKSB8fCB0aGl6Ll9ydW50aW1lLkRlYnVnQnJlYWtOZXh0KCkpIHlpZWxkIHRoaXo7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJldCA9IHlpZWxkKiBjdXN0b21BY2VCbG9jay5EZWJ1Z1J1bkFzRmFtaWx5Q3VzdG9tQWN0aW9uV2l0aE92ZXJyaWRlcyhjb21iaW5lZFNvbE1vZGlmaWVycywgdGhpei5fcGFyYW1ldGVycyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXQKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgdGhpcy5EZWJ1Z1J1biA9IG5vb3BHZW5lcmF0b3IKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuUnVuID0gbm9vcDsKICAgICAgICAgICAgICAgIHRoaXMuRGVidWdSdW4gPSBub29wR2VuZXJhdG9yCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgX1NldFJ1bk1ldGhvZEZvckJvdW5kRnVuYyhwbHVnaW4sCiAgICAgICAgICAgIGJpbmRUaGlzLCBmYWxsYmFja01ldGhvZCkgewogICAgICAgICAgICBjb25zdCBmdW5jID0gdGhpcy5fZnVuYzsKICAgICAgICAgICAgY29uc3QgcGFyYW1ldGVycyA9IHRoaXMuX3BhcmFtZXRlcnM7CiAgICAgICAgICAgIGlmIChwYXJhbWV0ZXJzLmxlbmd0aCA9PT0gMCkgdGhpcy5SdW4gPSBwbHVnaW4uX0dldEJvdW5kQUNFTWV0aG9kKGZ1bmMsIGJpbmRUaGlzKTsKICAgICAgICAgICAgZWxzZSBpZiAocGFyYW1ldGVycy5sZW5ndGggPT09IDEpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHBhcmFtMCA9IHBhcmFtZXRlcnNbMF07CiAgICAgICAgICAgICAgICBpZiAocGFyYW0wLklzQ29uc3RhbnQoKSkgdGhpcy5SdW4gPSBwbHVnaW4uX0dldEJvdW5kQUNFTWV0aG9kXzFwYXJhbShmdW5jLCBiaW5kVGhpcywgcGFyYW0wLkdldCgwKSk7CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBib3VuZEZ1bmMgPSBwbHVnaW4uX0dldEJvdW5kQUNFTWV0aG9kKGZ1bmMsIGJpbmRUaGlzKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLlJ1biA9IGZ1bmN0aW9uIFJ1blNpbmdsZUFjdF8xcGFyYW0oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBib3VuZEZ1bmMocGFyYW0wLkdldCgwKSkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAocGFyYW1ldGVycy5sZW5ndGggPT09IDIpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHBhcmFtMCA9IHBhcmFtZXRlcnNbMF07CiAgICAgICAgICAgICAgICBjb25zdCBwYXJhbTEgPSBwYXJhbWV0ZXJzWzFdOwogICAgICAgICAgICAgICAgaWYgKHBhcmFtMC5Jc0NvbnN0YW50KCkgJiYgcGFyYW0xLklzQ29uc3RhbnQoKSkgdGhpcy5SdW4gPSBwbHVnaW4uX0dldEJvdW5kQUNFTWV0aG9kXzJwYXJhbXMoZnVuYywgYmluZFRoaXMsIHBhcmFtMC5HZXQoMCksIHBhcmFtMS5HZXQoMCkpOwogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYm91bmRGdW5jID0gcGx1Z2luLl9HZXRCb3VuZEFDRU1ldGhvZChmdW5jLCBiaW5kVGhpcyk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5SdW4gPSBmdW5jdGlvbiBSdW5TaW5nbGVBY3RfMnBhcmFtcygpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGJvdW5kRnVuYyhwYXJhbTAuR2V0KDApLCBwYXJhbTEuR2V0KDApKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChwYXJhbWV0ZXJzLmxlbmd0aCA9PT0gMykgewogICAgICAgICAgICAgICAgY29uc3QgcGFyYW0wID0gcGFyYW1ldGVyc1swXTsKICAgICAgICAgICAgICAgIGNvbnN0IHBhcmFtMSA9IHBhcmFtZXRlcnNbMV07CiAgICAgICAgICAgICAgICBjb25zdCBwYXJhbTIgPSBwYXJhbWV0ZXJzWzJdOwogICAgICAgICAgICAgICAgaWYgKHBhcmFtMC5Jc0NvbnN0YW50KCkgJiYgcGFyYW0xLklzQ29uc3RhbnQoKSAmJiBwYXJhbTIuSXNDb25zdGFudCgpKSB0aGlzLlJ1biA9IHBsdWdpbi5fR2V0Qm91bmRBQ0VNZXRob2RfM3BhcmFtcyhmdW5jLAogICAgICAgICAgICAgICAgICAgIGJpbmRUaGlzLCBwYXJhbTAuR2V0KDApLCBwYXJhbTEuR2V0KDApLCBwYXJhbTIuR2V0KDApKTsKICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGJvdW5kRnVuYyA9IHBsdWdpbi5fR2V0Qm91bmRBQ0VNZXRob2QoZnVuYywgYmluZFRoaXMpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuUnVuID0gZnVuY3Rpb24gUnVuU2luZ2xlQWN0XzNwYXJhbXMoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBib3VuZEZ1bmMocGFyYW0wLkdldCgwKSwgcGFyYW0xLkdldCgwKSwgcGFyYW0yLkdldCgwKSkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB0aGlzLlJ1biA9IGZhbGxiYWNrTWV0aG9kCiAgICAgICAgfQogICAgICAgIEdldFNJRCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NpZAogICAgICAgIH0KICAgICAgICBJc0FzeW5jKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fYWN0aW9uVHlwZSA9PT0gMQogICAgICAgIH0KICAgICAgICBDYW5CYWlsT3V0KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fYWN0aW9uVHlwZSA9PT0gMgogICAgICAgIH0KICAgICAgICBDYWxsQmVmb3JlQWZ0ZXJIb29rcygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2FjdGlvblR5cGUgPT09IDMKICAgICAgICB9CiAgICAgICAgQ2FuUGlja0FueU9iamVjdENsYXNzKCkgewogICAgICAgICAgICByZXR1cm4gKHRoaXMuX2ZsYWdzICYgRkxBR19DQU5QSUNLQU5ZT0JKRUNUQ0xBU1MpICE9PSAwCiAgICAgICAgfQogICAgICAgIEhhc1JldHVyblR5cGUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLklzQXN5bmMoKSB8fAogICAgICAgICAgICAgICAgdGhpcy5DYW5CYWlsT3V0KCkKICAgICAgICB9CiAgICAgICAgR2V0T2JqZWN0Q2xhc3MoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9vYmplY3RDbGFzcwogICAgICAgIH0KICAgICAgICBHZXRFdmVudEJsb2NrKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZXZlbnRCbG9jawogICAgICAgIH0KICAgICAgICBfSGFzQ29weVBpY2tlZFBhcmVudCgpIHsKICAgICAgICAgICAgbGV0IHBhcmVudCA9IHRoaXMuX2V2ZW50QmxvY2s7CiAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgIGlmIChwYXJlbnQgaW5zdGFuY2VvZiBDMy5GdW5jdGlvbkJsb2NrICYmIHBhcmVudC5Jc0NvcHlQaWNrZWQoKSkgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICBwYXJlbnQgPSBwYXJlbnQuR2V0U2NvcGVQYXJlbnQoKQogICAgICAgICAgICB9IHdoaWxlIChwYXJlbnQpOwogICAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICB9CiAgICAgICAgR2V0UnVudGltZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUKICAgICAgICB9CiAgICAgICAgR2V0SW5kZXgoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pbmRleAogICAgICAgIH0KICAgICAgICBHZXREZWJ1Z0luZGV4KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZGVidWdEYXRhLmluZGV4CiAgICAgICAgfQogICAgICAgIElzQnJlYWtwb2ludCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2RlYnVnRGF0YS5pc0JyZWFrcG9pbnQKICAgICAgICB9CiAgICAgICAgX1NldEJyZWFrcG9pbnQoYikgewogICAgICAgICAgICB0aGlzLl9kZWJ1Z0RhdGEuaXNCcmVha3BvaW50ID0gISFiOwogICAgICAgICAgICB0aGlzLl9ldmVudEJsb2NrLl9VcGRhdGVDYW5SdW5GYXN0UmVjdXJzaXZlKCkKICAgICAgICB9CiAgICAgICAgX0RlYnVnUmV0dXJuc0dlbmVyYXRvcigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2RlYnVnRGF0YS5jYW5EZWJ1ZwogICAgICAgIH0KICAgICAgICBEZWJ1Z0NhblJ1bkZhc3QoKSB7CiAgICAgICAgICAgIHJldHVybiAhdGhpcy5Jc0JyZWFrcG9pbnQoKSAmJgogICAgICAgICAgICAgICAgIXRoaXMuX3J1bnRpbWUuRGVidWdCcmVha05leHQoKSAmJiAhdGhpcy5fRGVidWdSZXR1cm5zR2VuZXJhdG9yKCkKICAgICAgICB9CiAgICAgICAgR2V0U2F2ZWREYXRhTWFwKCkgewogICAgICAgICAgICBpZiAoIXRoaXMuX3NhdmVkRGF0YSkgdGhpcy5fc2F2ZWREYXRhID0gbmV3IE1hcDsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NhdmVkRGF0YQogICAgICAgIH0KICAgICAgICBHZXRVbnNhdmVkRGF0YU1hcCgpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLl91bnNhdmVkRGF0YSkgdGhpcy5fdW5zYXZlZERhdGEgPSBuZXcgTWFwOwogICAgICAgICAgICByZXR1cm4gdGhpcy5fdW5zYXZlZERhdGEKICAgICAgICB9CiAgICAgICAgX1J1blN5c3RlbSgpIHsKICAgICAgICAgICAgY29uc3QgcmVzdWx0cyA9IHRoaXMuX3Jlc3VsdHM7CiAgICAgICAgICAgIEV2YWxQYXJhbXModGhpcy5fcGFyYW1ldGVycywgcmVzdWx0cyk7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9mdW5jLmFwcGx5KHRoaXMuX3N5c3RlbVBsdWdpbiwgcmVzdWx0cykKICAgICAgICB9KiBfRGVidWdSdW5TeXN0ZW0oKSB7CiAgICAgICAgICAgIGlmICh0aGlzLklzQnJlYWtwb2ludCgpIHx8IHRoaXMuX3J1bnRpbWUuRGVidWdCcmVha05leHQoKSkgeWllbGQgdGhpczsKICAgICAgICAgICAgaWYgKHRoaXMuX0RlYnVnUmV0dXJuc0dlbmVyYXRvcigpKSB7CiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHRzID0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZXN1bHRzOwogICAgICAgICAgICAgICAgRXZhbFBhcmFtcyh0aGlzLl9wYXJhbWV0ZXJzLCByZXN1bHRzKTsKICAgICAgICAgICAgICAgIGNvbnN0IHJldCA9IHlpZWxkKiB0aGlzLl9mdW5jLmFwcGx5KHRoaXMuX3N5c3RlbVBsdWdpbiwgcmVzdWx0cyk7CiAgICAgICAgICAgICAgICByZXR1cm4gcmV0CiAgICAgICAgICAgIH0gZWxzZSByZXR1cm4gdGhpcy5SdW4oKQogICAgICAgIH0KICAgICAgICBfUnVuU2luZ2xlR2xvYmFsKCkgewogICAgICAgICAgICBjb25zdCByZXN1bHRzID0gdGhpcy5fcmVzdWx0czsKICAgICAgICAgICAgRXZhbFBhcmFtcyh0aGlzLl9wYXJhbWV0ZXJzLCByZXN1bHRzKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2Z1bmMuYXBwbHkodGhpcy5fb2JqZWN0Q2xhc3MuR2V0U2luZ2xlR2xvYmFsSW5zdGFuY2UoKS5HZXRTZGtJbnN0YW5jZSgpLCByZXN1bHRzKQogICAgICAgIH0qIF9EZWJ1Z1J1blNpbmdsZUdsb2JhbCgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuSXNCcmVha3BvaW50KCkgfHwgdGhpcy5fcnVudGltZS5EZWJ1Z0JyZWFrTmV4dCgpKSB5aWVsZCB0aGlzOwogICAgICAgICAgICBpZiAodGhpcy5fRGVidWdSZXR1cm5zR2VuZXJhdG9yKCkpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdHMgPSB0aGlzLl9yZXN1bHRzOwogICAgICAgICAgICAgICAgRXZhbFBhcmFtcyh0aGlzLl9wYXJhbWV0ZXJzLAogICAgICAgICAgICAgICAgICAgIHJlc3VsdHMpOwogICAgICAgICAgICAgICAgY29uc3QgcmV0ID0geWllbGQqIHRoaXMuX2Z1bmMuYXBwbHkodGhpcy5fb2JqZWN0Q2xhc3MuR2V0U2luZ2xlR2xvYmFsSW5zdGFuY2UoKS5HZXRTZGtJbnN0YW5jZSgpLCByZXN1bHRzKTsKICAgICAgICAgICAgICAgIHJldHVybiByZXQKICAgICAgICAgICAgfSBlbHNlIHJldHVybiB0aGlzLlJ1bigpCiAgICAgICAgfQogICAgICAgIF9SdW5PYmplY3RfUGFyYW1zQ29uc3QoKSB7CiAgICAgICAgICAgIGNvbnN0IHJlc3VsdHMgPSB0aGlzLl9yZXN1bHRzOwogICAgICAgICAgICBjb25zdCBpbnN0YW5jZXMgPSB0aGlzLl9vYmplY3RDbGFzcy5HZXRDdXJyZW50U29sKCkuR2V0SW5zdGFuY2VzKCk7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBpbnN0YW5jZXMubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHRoaXMuX2Z1bmMuYXBwbHkoaW5zdGFuY2VzW2ldLkdldFNka0luc3RhbmNlKCksIHJlc3VsdHMpCiAgICAgICAgfSogX0RlYnVnUnVuT2JqZWN0X1BhcmFtc0NvbnN0KCkgewogICAgICAgICAgICBpZiAodGhpcy5Jc0JyZWFrcG9pbnQoKSB8fCB0aGlzLl9ydW50aW1lLkRlYnVnQnJlYWtOZXh0KCkpIHlpZWxkIHRoaXM7CiAgICAgICAgICAgIGlmICh0aGlzLl9EZWJ1Z1JldHVybnNHZW5lcmF0b3IoKSkgewogICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0cyA9CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVzdWx0czsKICAgICAgICAgICAgICAgIGNvbnN0IGluc3RhbmNlcyA9IHRoaXMuX29iamVjdENsYXNzLkdldEN1cnJlbnRTb2woKS5HZXRJbnN0YW5jZXMoKTsKICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBpbnN0YW5jZXMubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHlpZWxkKiB0aGlzLl9mdW5jLmFwcGx5KGluc3RhbmNlc1tpXS5HZXRTZGtJbnN0YW5jZSgpLCByZXN1bHRzKQogICAgICAgICAgICB9IGVsc2UgdGhpcy5fUnVuT2JqZWN0X1BhcmFtc0NvbnN0KCkKICAgICAgICB9CiAgICAgICAgX1J1bk9iamVjdF9QYXJhbXNEb250VmFyeSgpIHsKICAgICAgICAgICAgY29uc3QgcmVzdWx0cyA9IHRoaXMuX3Jlc3VsdHM7CiAgICAgICAgICAgIEV2YWxQYXJhbXModGhpcy5fcGFyYW1ldGVycywgcmVzdWx0cyk7CiAgICAgICAgICAgIGNvbnN0IGluc3RhbmNlcyA9IHRoaXMuX29iamVjdENsYXNzLkdldEN1cnJlbnRTb2woKS5HZXRJbnN0YW5jZXMoKTsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IGluc3RhbmNlcy5sZW5ndGg7IGkgPCBsZW47ICsraSkgdGhpcy5fZnVuYy5hcHBseShpbnN0YW5jZXNbaV0uR2V0U2RrSW5zdGFuY2UoKSwgcmVzdWx0cykKICAgICAgICB9KiBfRGVidWdSdW5PYmplY3RfUGFyYW1zRG9udFZhcnkoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLklzQnJlYWtwb2ludCgpIHx8CiAgICAgICAgICAgICAgICB0aGlzLl9ydW50aW1lLkRlYnVnQnJlYWtOZXh0KCkpIHlpZWxkIHRoaXM7CiAgICAgICAgICAgIGlmICh0aGlzLl9EZWJ1Z1JldHVybnNHZW5lcmF0b3IoKSkgewogICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0cyA9IHRoaXMuX3Jlc3VsdHM7CiAgICAgICAgICAgICAgICBFdmFsUGFyYW1zKHRoaXMuX3BhcmFtZXRlcnMsIHJlc3VsdHMpOwogICAgICAgICAgICAgICAgY29uc3QgaW5zdGFuY2VzID0gdGhpcy5fb2JqZWN0Q2xhc3MuR2V0Q3VycmVudFNvbCgpLkdldEluc3RhbmNlcygpOwogICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IGluc3RhbmNlcy5sZW5ndGg7IGkgPCBsZW47ICsraSkgeWllbGQqIHRoaXMuX2Z1bmMuYXBwbHkoaW5zdGFuY2VzW2ldLkdldFNka0luc3RhbmNlKCksIHJlc3VsdHMpCiAgICAgICAgICAgIH0gZWxzZSB0aGlzLl9SdW5PYmplY3RfUGFyYW1zRG9udFZhcnkoKQogICAgICAgIH0KICAgICAgICBfUnVuT2JqZWN0X0FsbFBhcmFtc1ZhcnkoKSB7CiAgICAgICAgICAgIGNvbnN0IHBhcmFtZXRlcnMgPSB0aGlzLl9wYXJhbWV0ZXJzOwogICAgICAgICAgICBjb25zdCByZXN1bHRzID0gdGhpcy5fcmVzdWx0czsKICAgICAgICAgICAgY29uc3QgZnVuYyA9IHRoaXMuX2Z1bmM7CiAgICAgICAgICAgIGNvbnN0IGluc3RhbmNlcyA9IHRoaXMuX29iamVjdENsYXNzLkdldEN1cnJlbnRTb2woKS5HZXRJbnN0YW5jZXMoKTsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IGluc3RhbmNlcy5sZW5ndGg7IGkgPCBsZW47ICsraSkgewogICAgICAgICAgICAgICAgY29uc3QgaW5zdCA9IGluc3RhbmNlc1tpXTsKICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAwLCBsZW5qID0gcGFyYW1ldGVycy5sZW5ndGg7IGogPCBsZW5qOyArK2opIHJlc3VsdHNbal0gPSBwYXJhbWV0ZXJzW2pdLkdldChpKTsKICAgICAgICAgICAgICAgIGZ1bmMuYXBwbHkoaW5zdC5HZXRTZGtJbnN0YW5jZSgpLCByZXN1bHRzKQogICAgICAgICAgICB9CiAgICAgICAgfSogX0RlYnVnUnVuT2JqZWN0X0FsbFBhcmFtc1ZhcnkoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLklzQnJlYWtwb2ludCgpIHx8IHRoaXMuX3J1bnRpbWUuRGVidWdCcmVha05leHQoKSkgeWllbGQgdGhpczsKICAgICAgICAgICAgaWYgKHRoaXMuX0RlYnVnUmV0dXJuc0dlbmVyYXRvcigpKSB7CiAgICAgICAgICAgICAgICBjb25zdCBwYXJhbWV0ZXJzID0gdGhpcy5fcGFyYW1ldGVyczsKICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdHMgPSB0aGlzLl9yZXN1bHRzOwogICAgICAgICAgICAgICAgY29uc3QgZnVuYyA9IHRoaXMuX2Z1bmM7CiAgICAgICAgICAgICAgICBjb25zdCBpbnN0YW5jZXMgPSB0aGlzLl9vYmplY3RDbGFzcy5HZXRDdXJyZW50U29sKCkuR2V0SW5zdGFuY2VzKCk7CiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gaW5zdGFuY2VzLmxlbmd0aDsgaSA8CiAgICAgICAgICAgICAgICAgICAgbGVuOyArK2kpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBpbnN0ID0gaW5zdGFuY2VzW2ldOwogICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAwLCBsZW5qID0gcGFyYW1ldGVycy5sZW5ndGg7IGogPCBsZW5qOyArK2opIHJlc3VsdHNbal0gPSBwYXJhbWV0ZXJzW2pdLkdldChpKTsKICAgICAgICAgICAgICAgICAgICB5aWVsZCogZnVuYy5hcHBseShpbnN0LkdldFNka0luc3RhbmNlKCksIHJlc3VsdHMpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB0aGlzLl9SdW5PYmplY3RfQWxsUGFyYW1zVmFyeSgpCiAgICAgICAgfQogICAgICAgIF9SdW5PYmplY3RfU29tZVBhcmFtc1ZhcnkoKSB7CiAgICAgICAgICAgIGNvbnN0IHBhcmFtZXRlcnMgPSB0aGlzLl9wYXJhbWV0ZXJzOwogICAgICAgICAgICBjb25zdCByZXN1bHRzID0gdGhpcy5fcmVzdWx0czsKICAgICAgICAgICAgY29uc3QgZnVuYyA9IHRoaXMuX2Z1bmM7CiAgICAgICAgICAgIGNvbnN0IGluc3RhbmNlcyA9IHRoaXMuX29iamVjdENsYXNzLkdldEN1cnJlbnRTb2woKS5HZXRJbnN0YW5jZXMoKTsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IHBhcmFtZXRlcnMubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHAgPSBwYXJhbWV0ZXJzW2ldOwogICAgICAgICAgICAgICAgaWYgKCFwLlZhcmllc1Blckluc3RhbmNlKCkpIHJlc3VsdHNbaV0gPSBwLkdldCgwKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPQogICAgICAgICAgICAgICAgICAgIGluc3RhbmNlcy5sZW5ndGg7IGkgPCBsZW47ICsraSkgewogICAgICAgICAgICAgICAgY29uc3QgaW5zdCA9IGluc3RhbmNlc1tpXTsKICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAwLCBsZW5qID0gcGFyYW1ldGVycy5sZW5ndGg7IGogPCBsZW5qOyArK2opIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBwID0gcGFyYW1ldGVyc1tqXTsKICAgICAgICAgICAgICAgICAgICBpZiAocC5WYXJpZXNQZXJJbnN0YW5jZSgpKSByZXN1bHRzW2pdID0gcC5HZXQoaSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGZ1bmMuYXBwbHkoaW5zdC5HZXRTZGtJbnN0YW5jZSgpLCByZXN1bHRzKQogICAgICAgICAgICB9CiAgICAgICAgfSogX0RlYnVnUnVuT2JqZWN0X1NvbWVQYXJhbXNWYXJ5KCkgewogICAgICAgICAgICBpZiAodGhpcy5Jc0JyZWFrcG9pbnQoKSB8fCB0aGlzLl9ydW50aW1lLkRlYnVnQnJlYWtOZXh0KCkpIHlpZWxkIHRoaXM7CiAgICAgICAgICAgIGlmICh0aGlzLl9EZWJ1Z1JldHVybnNHZW5lcmF0b3IoKSkgewogICAgICAgICAgICAgICAgY29uc3QgcGFyYW1ldGVycyA9IHRoaXMuX3BhcmFtZXRlcnM7CiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHRzID0gdGhpcy5fcmVzdWx0czsKICAgICAgICAgICAgICAgIGNvbnN0IGZ1bmMgPSB0aGlzLl9mdW5jOwogICAgICAgICAgICAgICAgY29uc3QgaW5zdGFuY2VzID0gdGhpcy5fb2JqZWN0Q2xhc3MuR2V0Q3VycmVudFNvbCgpLkdldEluc3RhbmNlcygpOwogICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9CiAgICAgICAgICAgICAgICAgICAgICAgIDAsIGxlbiA9IHBhcmFtZXRlcnMubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBwID0gcGFyYW1ldGVyc1tpXTsKICAgICAgICAgICAgICAgICAgICBpZiAoIXAuVmFyaWVzUGVySW5zdGFuY2UoKSkgcmVzdWx0c1tpXSA9IHAuR2V0KDApCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gaW5zdGFuY2VzLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5zdCA9IGluc3RhbmNlc1tpXTsKICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBqID0gMCwgbGVuaiA9IHBhcmFtZXRlcnMubGVuZ3RoOyBqIDwgbGVuajsgKytqKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHAgPSBwYXJhbWV0ZXJzW2pdOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAocC5WYXJpZXNQZXJJbnN0YW5jZSgpKSByZXN1bHRzW2pdID0gcC5HZXQoaSkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgeWllbGQqIGZ1bmMuYXBwbHkoaW5zdC5HZXRTZGtJbnN0YW5jZSgpLCByZXN1bHRzKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgdGhpcy5fUnVuT2JqZWN0X1NvbWVQYXJhbXNWYXJ5KCkKICAgICAgICB9CiAgICAgICAgX1J1bk9iamVjdF9CZWZvcmVBZnRlckhvb2tzKCkgewogICAgICAgICAgICBjb25zdCBwYXJhbWV0ZXJzID0gdGhpcy5fcGFyYW1ldGVyczsKICAgICAgICAgICAgY29uc3QgcmVzdWx0cyA9IHRoaXMuX3Jlc3VsdHM7CiAgICAgICAgICAgIGNvbnN0IGZ1bmMgPSB0aGlzLl9mdW5jOwogICAgICAgICAgICBjb25zdCBvYmplY3RDbGFzcyA9CiAgICAgICAgICAgICAgICB0aGlzLl9vYmplY3RDbGFzczsKICAgICAgICAgICAgY29uc3Qgc2RrVHlwZSA9IG9iamVjdENsYXNzLkdldFNka1R5cGUoKTsKICAgICAgICAgICAgY29uc3QgaW5zdGFuY2VzID0gb2JqZWN0Q2xhc3MuR2V0Q3VycmVudFNvbCgpLkdldEluc3RhbmNlcygpOwogICAgICAgICAgICBzZGtUeXBlLkJlZm9yZVJ1bkFjdGlvbihmdW5jKTsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IGluc3RhbmNlcy5sZW5ndGg7IGkgPCBsZW47ICsraSkgewogICAgICAgICAgICAgICAgY29uc3QgaW5zdCA9IGluc3RhbmNlc1tpXTsKICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAwLCBsZW5qID0gcGFyYW1ldGVycy5sZW5ndGg7IGogPCBsZW5qOyArK2opIHJlc3VsdHNbal0gPSBwYXJhbWV0ZXJzW2pdLkdldChpKTsKICAgICAgICAgICAgICAgIGZ1bmMuYXBwbHkoaW5zdC5HZXRTZGtJbnN0YW5jZSgpLCByZXN1bHRzKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHNka1R5cGUuQWZ0ZXJSdW5BY3Rpb24oZnVuYykKICAgICAgICB9KiBfRGVidWdSdW5PYmplY3RfQmVmb3JlQWZ0ZXJIb29rcygpIHsKICAgICAgICAgICAgaWYgKHRoaXMuSXNCcmVha3BvaW50KCkgfHwgdGhpcy5fcnVudGltZS5EZWJ1Z0JyZWFrTmV4dCgpKSB5aWVsZCB0aGlzOwogICAgICAgICAgICBpZiAodGhpcy5fRGVidWdSZXR1cm5zR2VuZXJhdG9yKCkpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHBhcmFtZXRlcnMgPQogICAgICAgICAgICAgICAgICAgIHRoaXMuX3BhcmFtZXRlcnM7CiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHRzID0gdGhpcy5fcmVzdWx0czsKICAgICAgICAgICAgICAgIGNvbnN0IGZ1bmMgPSB0aGlzLl9mdW5jOwogICAgICAgICAgICAgICAgY29uc3Qgb2JqZWN0Q2xhc3MgPSB0aGlzLl9vYmplY3RDbGFzczsKICAgICAgICAgICAgICAgIGNvbnN0IHNka1R5cGUgPSBvYmplY3RDbGFzcy5HZXRTZGtUeXBlKCk7CiAgICAgICAgICAgICAgICBjb25zdCBpbnN0YW5jZXMgPSBvYmplY3RDbGFzcy5HZXRDdXJyZW50U29sKCkuR2V0SW5zdGFuY2VzKCk7CiAgICAgICAgICAgICAgICBzZGtUeXBlLkJlZm9yZVJ1bkFjdGlvbihmdW5jKTsKICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBpbnN0YW5jZXMubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBpbnN0ID0gaW5zdGFuY2VzW2ldOwogICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAwLCBsZW5qID0gcGFyYW1ldGVycy5sZW5ndGg7IGogPCBsZW5qOyArK2opIHJlc3VsdHNbal0gPSBwYXJhbWV0ZXJzW2pdLkdldChpKTsKICAgICAgICAgICAgICAgICAgICB5aWVsZCogZnVuYy5hcHBseShpbnN0LkdldFNka0luc3RhbmNlKCksIHJlc3VsdHMpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzZGtUeXBlLkFmdGVyUnVuQWN0aW9uKGZ1bmMpCiAgICAgICAgICAgIH0gZWxzZSB0aGlzLl9SdW5PYmplY3RfQmVmb3JlQWZ0ZXJIb29rcygpCiAgICAgICAgfQogICAgICAgIF9SdW5CZWhhdmlvcigpIHsKICAgICAgICAgICAgY29uc3Qgb2JqZWN0Q2xhc3MgPQogICAgICAgICAgICAgICAgdGhpcy5fb2JqZWN0Q2xhc3M7CiAgICAgICAgICAgIGNvbnN0IGlzRmFtaWx5ID0gb2JqZWN0Q2xhc3MuSXNGYW1pbHkoKTsKICAgICAgICAgICAgY29uc3QgZmFtaWx5SW5kZXggPSBvYmplY3RDbGFzcy5HZXRGYW1pbHlJbmRleCgpOwogICAgICAgICAgICBjb25zdCBwYXJhbWV0ZXJzID0gdGhpcy5fcGFyYW1ldGVyczsKICAgICAgICAgICAgY29uc3QgcGFyYW1zVmFyeSA9IHRoaXMuX2FueVBhcmFtVmFyaWVzUGVySW5zdGFuY2U7CiAgICAgICAgICAgIGNvbnN0IHJlc3VsdHMgPSB0aGlzLl9yZXN1bHRzOwogICAgICAgICAgICBjb25zdCBmdW5jID0gdGhpcy5fZnVuYzsKICAgICAgICAgICAgY29uc3QgYmVoYXZpb3JJbmRleCA9IHRoaXMuX2JlaGF2aW9ySW5kZXg7CiAgICAgICAgICAgIGNvbnN0IGluc3RhbmNlcyA9IG9iamVjdENsYXNzLkdldEN1cnJlbnRTb2woKS5HZXRJbnN0YW5jZXMoKTsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IHBhcmFtZXRlcnMubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHAgPSBwYXJhbWV0ZXJzW2ldOwogICAgICAgICAgICAgICAgaWYgKCFwLlZhcmllc1Blckluc3RhbmNlKCkpIHJlc3VsdHNbaV0gPSBwLkdldCgwKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBpbnN0YW5jZXMubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGluc3QgPQogICAgICAgICAgICAgICAgICAgIGluc3RhbmNlc1tpXTsKICAgICAgICAgICAgICAgIGlmIChwYXJhbXNWYXJ5KQogICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAwLCBsZW5qID0gcGFyYW1ldGVycy5sZW5ndGg7IGogPCBsZW5qOyArK2opIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcCA9IHBhcmFtZXRlcnNbal07CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwLlZhcmllc1Blckluc3RhbmNlKCkpIHJlc3VsdHNbal0gPSBwLkdldChpKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNvbnN0IG9mZnNldCA9IGlzRmFtaWx5ID8gaW5zdC5HZXRPYmplY3RDbGFzcygpLkdldEZhbWlseUJlaGF2aW9yT2Zmc2V0KGZhbWlseUluZGV4KSA6IDA7CiAgICAgICAgICAgICAgICBmdW5jLmFwcGx5KGluc3QuR2V0QmVoYXZpb3JJbnN0YW5jZXMoKVtiZWhhdmlvckluZGV4ICsgb2Zmc2V0XS5HZXRTZGtJbnN0YW5jZSgpLCByZXN1bHRzKQogICAgICAgICAgICB9CiAgICAgICAgfSogX0RlYnVnUnVuQmVoYXZpb3IoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLklzQnJlYWtwb2ludCgpIHx8IHRoaXMuX3J1bnRpbWUuRGVidWdCcmVha05leHQoKSkgeWllbGQgdGhpczsKICAgICAgICAgICAgaWYgKHRoaXMuX0RlYnVnUmV0dXJuc0dlbmVyYXRvcigpKSB7CiAgICAgICAgICAgICAgICBjb25zdCBvYmplY3RDbGFzcyA9IHRoaXMuX29iamVjdENsYXNzOwogICAgICAgICAgICAgICAgY29uc3QgaXNGYW1pbHkgPSBvYmplY3RDbGFzcy5Jc0ZhbWlseSgpOwogICAgICAgICAgICAgICAgY29uc3QgZmFtaWx5SW5kZXggPSBvYmplY3RDbGFzcy5HZXRGYW1pbHlJbmRleCgpOwogICAgICAgICAgICAgICAgY29uc3QgcGFyYW1ldGVycyA9IHRoaXMuX3BhcmFtZXRlcnM7CiAgICAgICAgICAgICAgICBjb25zdCBwYXJhbXNWYXJ5ID0gdGhpcy5fYW55UGFyYW1WYXJpZXNQZXJJbnN0YW5jZTsKICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdHMgPSB0aGlzLl9yZXN1bHRzOwogICAgICAgICAgICAgICAgY29uc3QgZnVuYyA9IHRoaXMuX2Z1bmM7CiAgICAgICAgICAgICAgICBjb25zdCBiZWhhdmlvckluZGV4ID0gdGhpcy5fYmVoYXZpb3JJbmRleDsKICAgICAgICAgICAgICAgIGNvbnN0IGluc3RhbmNlcyA9IG9iamVjdENsYXNzLkdldEN1cnJlbnRTb2woKS5HZXRJbnN0YW5jZXMoKTsKICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBwYXJhbWV0ZXJzLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcCA9IHBhcmFtZXRlcnNbaV07CiAgICAgICAgICAgICAgICAgICAgaWYgKCFwLlZhcmllc1Blckluc3RhbmNlKCkpIHJlc3VsdHNbaV0gPSBwLkdldCgwKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IGluc3RhbmNlcy5sZW5ndGg7IGkgPCBsZW47ICsraSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGluc3QgPSBpbnN0YW5jZXNbaV07CiAgICAgICAgICAgICAgICAgICAgaWYgKHBhcmFtc1ZhcnkpCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAwLCBsZW5qID0gcGFyYW1ldGVycy5sZW5ndGg7IGogPAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVuajsgKytqKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwID0gcGFyYW1ldGVyc1tqXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwLlZhcmllc1Blckluc3RhbmNlKCkpIHJlc3VsdHNbal0gPSBwLkdldChpKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgb2Zmc2V0ID0gaXNGYW1pbHkgPyBpbnN0LkdldE9iamVjdENsYXNzKCkuR2V0RmFtaWx5QmVoYXZpb3JPZmZzZXQoZmFtaWx5SW5kZXgpIDogMDsKICAgICAgICAgICAgICAgICAgICB5aWVsZCogZnVuYy5hcHBseShpbnN0LkdldEJlaGF2aW9ySW5zdGFuY2VzKClbYmVoYXZpb3JJbmRleCArIG9mZnNldF0uR2V0U2RrSW5zdGFuY2UoKSwgcmVzdWx0cykKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHRoaXMuX1J1bkJlaGF2aW9yKCkKICAgICAgICB9CiAgICAgICAgX1J1bk9iamVjdF9Bc3luYygpIHsKICAgICAgICAgICAgY29uc3QgcGFyYW1ldGVycyA9IHRoaXMuX3BhcmFtZXRlcnM7CiAgICAgICAgICAgIGNvbnN0IHJlc3VsdHMgPSB0aGlzLl9yZXN1bHRzOwogICAgICAgICAgICBjb25zdCBmdW5jID0gdGhpcy5fZnVuYzsKICAgICAgICAgICAgY29uc3QgaW5zdGFuY2VzID0gdGhpcy5fb2JqZWN0Q2xhc3MuR2V0Q3VycmVudFNvbCgpLkdldEluc3RhbmNlcygpOwogICAgICAgICAgICBjb25zdCBwcm9taXNlcyA9IFtdOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gaW5zdGFuY2VzLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7CiAgICAgICAgICAgICAgICBjb25zdCBpbnN0ID0KICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZXNbaV07CiAgICAgICAgICAgICAgICBmb3IgKGxldCBqID0gMCwgbGVuaiA9IHBhcmFtZXRlcnMubGVuZ3RoOyBqIDwgbGVuajsgKytqKSByZXN1bHRzW2pdID0gcGFyYW1ldGVyc1tqXS5HZXQoaSk7CiAgICAgICAgICAgICAgICBwcm9taXNlcy5wdXNoKGZ1bmMuYXBwbHkoaW5zdC5HZXRTZGtJbnN0YW5jZSgpLCByZXN1bHRzKSkKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGwocHJvbWlzZXMpCiAgICAgICAgfSogX0RlYnVnUnVuT2JqZWN0X0FzeW5jKCkgewogICAgICAgICAgICBpZiAodGhpcy5Jc0JyZWFrcG9pbnQoKSB8fCB0aGlzLl9ydW50aW1lLkRlYnVnQnJlYWtOZXh0KCkpIHlpZWxkIHRoaXM7CiAgICAgICAgICAgIGlmICh0aGlzLl9EZWJ1Z1JldHVybnNHZW5lcmF0b3IoKSkgewogICAgICAgICAgICAgICAgY29uc3QgcGFyYW1ldGVycyA9IHRoaXMuX3BhcmFtZXRlcnM7CiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHRzID0gdGhpcy5fcmVzdWx0czsKICAgICAgICAgICAgICAgIGNvbnN0IGZ1bmMgPSB0aGlzLl9mdW5jOwogICAgICAgICAgICAgICAgY29uc3QgaW5zdGFuY2VzID0gdGhpcy5fb2JqZWN0Q2xhc3MuR2V0Q3VycmVudFNvbCgpLkdldEluc3RhbmNlcygpOwogICAgICAgICAgICAgICAgY29uc3QgcHJvbWlzZXMgPSBbXTsKICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBpbnN0YW5jZXMubGVuZ3RoOyBpIDwKICAgICAgICAgICAgICAgICAgICBsZW47ICsraSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGluc3QgPSBpbnN0YW5jZXNbaV07CiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaiA9IDAsIGxlbmogPSBwYXJhbWV0ZXJzLmxlbmd0aDsgaiA8IGxlbmo7ICsraikgcmVzdWx0c1tqXSA9IHBhcmFtZXRlcnNbal0uR2V0KGkpOwogICAgICAgICAgICAgICAgICAgIHByb21pc2VzLnB1c2goeWllbGQqIGZ1bmMuYXBwbHkoaW5zdC5HZXRTZGtJbnN0YW5jZSgpLCByZXN1bHRzKSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBQcm9taXNlLmFsbChwcm9taXNlcykKICAgICAgICAgICAgfSBlbHNlIHJldHVybiB0aGlzLl9SdW5PYmplY3RfQXN5bmMoKQogICAgICAgIH0KICAgICAgICBfUnVuQmVoYXZpb3JfQXN5bmMoKSB7CiAgICAgICAgICAgIGNvbnN0IG9iamVjdENsYXNzID0gdGhpcy5fb2JqZWN0Q2xhc3M7CiAgICAgICAgICAgIGNvbnN0IGlzRmFtaWx5ID0gb2JqZWN0Q2xhc3MuSXNGYW1pbHkoKTsKICAgICAgICAgICAgY29uc3QgZmFtaWx5SW5kZXggPSBvYmplY3RDbGFzcy5HZXRGYW1pbHlJbmRleCgpOwogICAgICAgICAgICBjb25zdCBwYXJhbWV0ZXJzID0gdGhpcy5fcGFyYW1ldGVyczsKICAgICAgICAgICAgY29uc3QgcmVzdWx0cyA9IHRoaXMuX3Jlc3VsdHM7CiAgICAgICAgICAgIGNvbnN0IGZ1bmMgPSB0aGlzLl9mdW5jOwogICAgICAgICAgICBjb25zdCBiZWhhdmlvckluZGV4ID0gdGhpcy5fYmVoYXZpb3JJbmRleDsKICAgICAgICAgICAgY29uc3QgaW5zdGFuY2VzID0gb2JqZWN0Q2xhc3MuR2V0Q3VycmVudFNvbCgpLkdldEluc3RhbmNlcygpOwogICAgICAgICAgICBjb25zdCBwcm9taXNlcyA9IFtdOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gaW5zdGFuY2VzLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7CiAgICAgICAgICAgICAgICBjb25zdCBpbnN0ID0gaW5zdGFuY2VzW2ldOwogICAgICAgICAgICAgICAgZm9yIChsZXQgaiA9IDAsIGxlbmogPSBwYXJhbWV0ZXJzLmxlbmd0aDsgaiA8IGxlbmo7ICsraikgcmVzdWx0c1tqXSA9IHBhcmFtZXRlcnNbal0uR2V0KGkpOwogICAgICAgICAgICAgICAgY29uc3Qgb2Zmc2V0ID0gaXNGYW1pbHkgPyBpbnN0LkdldE9iamVjdENsYXNzKCkuR2V0RmFtaWx5QmVoYXZpb3JPZmZzZXQoZmFtaWx5SW5kZXgpIDogMDsKICAgICAgICAgICAgICAgIHByb21pc2VzLnB1c2goZnVuYy5hcHBseShpbnN0LkdldEJlaGF2aW9ySW5zdGFuY2VzKClbYmVoYXZpb3JJbmRleCArIG9mZnNldF0uR2V0U2RrSW5zdGFuY2UoKSwgcmVzdWx0cykpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIFByb21pc2UuYWxsKHByb21pc2VzKQogICAgICAgIH0qIF9EZWJ1Z1J1bkJlaGF2aW9yX0FzeW5jKCkgewogICAgICAgICAgICBpZiAodGhpcy5Jc0JyZWFrcG9pbnQoKSB8fCB0aGlzLl9ydW50aW1lLkRlYnVnQnJlYWtOZXh0KCkpIHlpZWxkIHRoaXM7CiAgICAgICAgICAgIGlmICh0aGlzLl9EZWJ1Z1JldHVybnNHZW5lcmF0b3IoKSkgewogICAgICAgICAgICAgICAgY29uc3Qgb2JqZWN0Q2xhc3MgPSB0aGlzLl9vYmplY3RDbGFzczsKICAgICAgICAgICAgICAgIGNvbnN0IGlzRmFtaWx5ID0gb2JqZWN0Q2xhc3MuSXNGYW1pbHkoKTsKICAgICAgICAgICAgICAgIGNvbnN0IGZhbWlseUluZGV4ID0gb2JqZWN0Q2xhc3MuR2V0RmFtaWx5SW5kZXgoKTsKICAgICAgICAgICAgICAgIGNvbnN0IHBhcmFtZXRlcnMgPSB0aGlzLl9wYXJhbWV0ZXJzOwogICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0cyA9IHRoaXMuX3Jlc3VsdHM7CiAgICAgICAgICAgICAgICBjb25zdCBmdW5jID0gdGhpcy5fZnVuYzsKICAgICAgICAgICAgICAgIGNvbnN0IGJlaGF2aW9ySW5kZXggPSB0aGlzLl9iZWhhdmlvckluZGV4OwogICAgICAgICAgICAgICAgY29uc3QgaW5zdGFuY2VzID0gb2JqZWN0Q2xhc3MuR2V0Q3VycmVudFNvbCgpLkdldEluc3RhbmNlcygpOwogICAgICAgICAgICAgICAgY29uc3QgcHJvbWlzZXMgPSBbXTsKICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBpbnN0YW5jZXMubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBpbnN0ID0gaW5zdGFuY2VzW2ldOwogICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAwLCBsZW5qID0gcGFyYW1ldGVycy5sZW5ndGg7IGogPCBsZW5qOyArK2opIHJlc3VsdHNbal0gPSBwYXJhbWV0ZXJzW2pdLkdldChpKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBvZmZzZXQgPSBpc0ZhbWlseSA/IGluc3QuR2V0T2JqZWN0Q2xhc3MoKS5HZXRGYW1pbHlCZWhhdmlvck9mZnNldChmYW1pbHlJbmRleCkgOiAwOwogICAgICAgICAgICAgICAgICAgIHByb21pc2VzLnB1c2goeWllbGQqIGZ1bmMuYXBwbHkoaW5zdC5HZXRCZWhhdmlvckluc3RhbmNlcygpW2JlaGF2aW9ySW5kZXggKyBvZmZzZXRdLkdldFNka0luc3RhbmNlKCksIHJlc3VsdHMpKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UuYWxsKHByb21pc2VzKQogICAgICAgICAgICB9IGVsc2UgcmV0dXJuIHRoaXMuX1J1bkJlaGF2aW9yX0FzeW5jKCkKICAgICAgICB9CiAgICAgICAgYXN5bmMgUnVuVXNlclNjcmlwdCgpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuX2Z1bmMoKQogICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYFVuaGFuZGxlZCBleGNlcHRpb24gcnVubmluZyBzY3JpcHQgJWMke3RoaXMuX2V2ZW50QmxvY2suR2V0RXZlbnRTaGVldCgpLkdldE5hbWUoKX0sIGV2ZW50ICR7dGhpcy5fZXZlbnRCbG9jay5HZXREaXNwbGF5TnVtYmVyKCl9LCBhY3Rpb24gJHt0aGlzLkdldERlYnVnSW5kZXgoKSsxfTpgLCAiZm9udC1zaXplOiAxLjJlbTsgZm9udC13ZWlnaHQ6IGJvbGQ7IiwKICAgICAgICAgICAgICAgICAgICBlcnIpOwogICAgICAgICAgICAgICAgaWYgKHNlbGYuQzNEZWJ1Z2dlcikgc2VsZi5DM0RlYnVnZ2VyLl9TZXRMYXN0RXJyb3JTY3JpcHQodGhpcyk7CiAgICAgICAgICAgICAgICBpZiAoIUMzLkV2ZW50U2NyaXB0LkhhZFVzZXJTY3JpcHRFeGNlcHRpb24oKSkgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuaW5mbyhgJWNUaXA6JWMgcnVuIHRoaXMgdG8gaGlnaGxpZ2h0IGluIENvbnN0cnVjdCB0aGUgbGFzdCBzY3JpcHQgdGhhdCBoYWQgYW4gZXJyb3I6ICVjZ29Ub0xhc3RFcnJvclNjcmlwdCgpYCwgImZvbnQtd2VpZ2h0OiBib2xkOyB0ZXh0LWRlY29yYXRpb246IHVuZGVybGluZSIsICIiLCAiZm9udC13ZWlnaHQ6IGJvbGQiKTsKICAgICAgICAgICAgICAgICAgICBDMy5FdmVudFNjcmlwdC5TZXRIYWRVc2VyU2NyaXB0RXhjZXB0aW9uKCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0qIERlYnVnUnVuVXNlclNjcmlwdCgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuSXNCcmVha3BvaW50KCkgfHwgdGhpcy5fcnVudGltZS5EZWJ1Z0JyZWFrTmV4dCgpKSB5aWVsZCB0aGlzOwogICAgICAgICAgICByZXR1cm4gdGhpcy5SdW5Vc2VyU2NyaXB0KCkKICAgICAgICB9CiAgICAgICAgX1NhdmVUb0pzb24oKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5fc2F2ZWREYXRhIHx8ICF0aGlzLl9zYXZlZERhdGEuc2l6ZSkgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAiZXgiOiBDMy5Ub1N1cGVySlNPTih0aGlzLl9zYXZlZERhdGEpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgX0xvYWRGcm9tSnNvbihvKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9zYXZlZERhdGEpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3NhdmVkRGF0YS5jbGVhcigpOwogICAgICAgICAgICAgICAgdGhpcy5fc2F2ZWREYXRhID0gbnVsbAogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghbykgcmV0dXJuOwogICAgICAgICAgICBjb25zdCBleCA9IG9bImV4Il07CiAgICAgICAgICAgIGlmIChleCkgdGhpcy5fc2F2ZWREYXRhID0gQzMuRnJvbVN1cGVySlNPTihleCkKICAgICAgICB9CiAgICB9OwoKfQoKLy8gZXZlbnRzL2NvbW1vbkFDRXMuanMKewogICAgJ3VzZSBzdHJpY3QnOwogICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgY29uc3QgdGVtcENvbG9yID0gbmV3IEMzLkNvbG9yOwoKICAgIGZ1bmN0aW9uIENvbXBhcmVYKGNtcCwgeCkgewogICAgICAgIHJldHVybiBDMy5jb21wYXJlKHRoaXMuR2V0V29ybGRJbmZvKCkuR2V0WCgpLCBjbXAsIHgpCiAgICB9CgogICAgZnVuY3Rpb24gQ29tcGFyZVkoY21wLCB5KSB7CiAgICAgICAgcmV0dXJuIEMzLmNvbXBhcmUodGhpcy5HZXRXb3JsZEluZm8oKS5HZXRZKCksIGNtcCwgeSkKICAgIH0KCiAgICBmdW5jdGlvbiBJc09uU2NyZWVuKCkgewogICAgICAgIHJldHVybiB0aGlzLkdldFdvcmxkSW5mbygpLklzSW5WaWV3cG9ydDIoKQogICAgfQoKICAgIGZ1bmN0aW9uIElzT3V0c2lkZUxheW91dCgpIHsKICAgICAgICBjb25zdCB3aSA9IHRoaXMuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgY29uc3QgbGF5b3V0ID0gd2kuR2V0TGF5b3V0KCk7CiAgICAgICAgY29uc3QgYmJveCA9IHdpLkdldEJvdW5kaW5nQm94KCk7CiAgICAgICAgcmV0dXJuIGJib3guZ2V0UmlnaHQoKSA8IDAgfHwgYmJveC5nZXRCb3R0b20oKSA8IDAgfHwgYmJveC5nZXRMZWZ0KCkgPiBsYXlvdXQuR2V0V2lkdGgoKSB8fCBiYm94LmdldFRvcCgpID4gbGF5b3V0LkdldEhlaWdodCgpCiAgICB9CgogICAgZnVuY3Rpb24gUGlja0Rpc3RhbmNlKHdoaWNoLCB4LCB5KSB7CiAgICAgICAgY29uc3Qgc29sID0gdGhpcy5HZXRDdXJyZW50U29sKCk7CiAgICAgICAgY29uc3QgaW5zdGFuY2VzID0gc29sLkdldEluc3RhbmNlcygpOwogICAgICAgIGlmICghaW5zdGFuY2VzLmxlbmd0aCkgcmV0dXJuIGZhbHNlOwogICAgICAgIGxldCBpbnN0ID0gaW5zdGFuY2VzWzBdOwogICAgICAgIGxldCB3aSA9IGluc3QuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgbGV0IHBpY2ttZSA9IGluc3Q7CiAgICAgICAgbGV0IGRpc3QyID0gQzMuZGlzdGFuY2VTcXVhcmVkKHdpLkdldFgoKSwgd2kuR2V0WSgpLCB4LCB5KTsKICAgICAgICBmb3IgKGxldCBpID0gMSwgbGVuID0gaW5zdGFuY2VzLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7CiAgICAgICAgICAgIGluc3QgPSBpbnN0YW5jZXNbaV07CiAgICAgICAgICAgIHdpID0gaW5zdC5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgY29uc3QgZDIgPSBDMy5kaXN0YW5jZVNxdWFyZWQod2kuR2V0WCgpLCB3aS5HZXRZKCksIHgsIHkpOwogICAgICAgICAgICBpZiAod2hpY2ggPT09IDAgJiYgZDIgPCBkaXN0MiB8fCB3aGljaCA9PT0gMSAmJiBkMiA+IGRpc3QyKSB7CiAgICAgICAgICAgICAgICBkaXN0MiA9IGQyOwogICAgICAgICAgICAgICAgcGlja21lID0gaW5zdAogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHNvbC5QaWNrT25lKHBpY2ttZSk7CiAgICAgICAgcmV0dXJuIHRydWUKICAgIH0KCiAgICBmdW5jdGlvbiBTZXRYKHgpIHsKICAgICAgICBjb25zdCB3aSA9IHRoaXMuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgaWYgKHdpLkdldFgoKSA9PT0geCkgcmV0dXJuOwogICAgICAgIHdpLlNldFgoeCk7CiAgICAgICAgd2kuU2V0QmJveENoYW5nZWQoKQogICAgfQoKICAgIGZ1bmN0aW9uIFNldFkoeSkgewogICAgICAgIGNvbnN0IHdpID0gdGhpcy5HZXRXb3JsZEluZm8oKTsKICAgICAgICBpZiAod2kuR2V0WSgpID09PSB5KSByZXR1cm47CiAgICAgICAgd2kuU2V0WSh5KTsKICAgICAgICB3aS5TZXRCYm94Q2hhbmdlZCgpCiAgICB9CgogICAgZnVuY3Rpb24gU2V0UG9zKHgsIHkpIHsKICAgICAgICBjb25zdCB3aSA9IHRoaXMuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgaWYgKHdpLkVxdWFsc1hZKHgsIHkpKSByZXR1cm47CiAgICAgICAgd2kuU2V0WFkoeCwgeSk7CiAgICAgICAgd2kuU2V0QmJveENoYW5nZWQoKQogICAgfQoKICAgIGZ1bmN0aW9uIFNldFBvc1RvT2JqZWN0KG9iamVjdENsYXNzLCBpbWdQdCkgewogICAgICAgIGlmICghb2JqZWN0Q2xhc3MpIHJldHVybjsKICAgICAgICBjb25zdCBpbnN0ID0gb2JqZWN0Q2xhc3MuR2V0UGFpcmVkSW5zdGFuY2UodGhpcy5faW5zdCk7CiAgICAgICAgaWYgKCFpbnN0KSByZXR1cm47CiAgICAgICAgY29uc3QgW3gsIHldID0gaW5zdC5HZXRJbWFnZVBvaW50KGltZ1B0KTsKICAgICAgICBjb25zdCB3aSA9IHRoaXMuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgaWYgKHdpLkdldFgoKSA9PT0geCAmJiB3aS5HZXRZKCkgPT09IHkpIHJldHVybjsKICAgICAgICB3aS5TZXRYWSh4LCB5KTsKICAgICAgICB3aS5TZXRCYm94Q2hhbmdlZCgpCiAgICB9CgogICAgZnVuY3Rpb24gTW92ZUZvcndhcmQoZGlzdCkgewogICAgICAgIGlmIChkaXN0ID09PSAwKSByZXR1cm47CiAgICAgICAgY29uc3Qgd2kgPSB0aGlzLkdldFdvcmxkSW5mbygpOwogICAgICAgIHdpLk9mZnNldFhZKHdpLkdldENvc0FuZ2xlKCkgKiBkaXN0LCB3aS5HZXRTaW5BbmdsZSgpICogZGlzdCk7CiAgICAgICAgd2kuU2V0QmJveENoYW5nZWQoKQogICAgfQoKICAgIGZ1bmN0aW9uIE1vdmVBdEFuZ2xlKGEsIGRpc3QpIHsKICAgICAgICBpZiAoZGlzdCA9PT0gMCkgcmV0dXJuOwogICAgICAgIGNvbnN0IHdpID0gdGhpcy5HZXRXb3JsZEluZm8oKTsKICAgICAgICBhID0gQzMudG9SYWRpYW5zKGEpOwogICAgICAgIHdpLk9mZnNldFhZKE1hdGguY29zKGEpICogZGlzdCwgTWF0aC5zaW4oYSkgKiBkaXN0KTsKICAgICAgICB3aS5TZXRCYm94Q2hhbmdlZCgpCiAgICB9CgogICAgZnVuY3Rpb24gR2V0WCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5HZXRXb3JsZEluZm8oKS5HZXRYKCkKICAgIH0KCiAgICBmdW5jdGlvbiBHZXRZKCkgewogICAgICAgIHJldHVybiB0aGlzLkdldFdvcmxkSW5mbygpLkdldFkoKQogICAgfQoKICAgIGZ1bmN0aW9uIEdldER0KCkgewogICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lLkdldER0KHRoaXMuX2luc3QpCiAgICB9CgogICAgZnVuY3Rpb24gQ29tcGFyZVdpZHRoKGNtcCwgdykgewogICAgICAgIHJldHVybiBDMy5jb21wYXJlKHRoaXMuR2V0V29ybGRJbmZvKCkuR2V0V2lkdGgoKSwgY21wLCB3KQogICAgfQoKICAgIGZ1bmN0aW9uIENvbXBhcmVIZWlnaHQoY21wLCBoKSB7CiAgICAgICAgcmV0dXJuIEMzLmNvbXBhcmUodGhpcy5HZXRXb3JsZEluZm8oKS5HZXRIZWlnaHQoKSwgY21wLCBoKQogICAgfQoKICAgIGZ1bmN0aW9uIFNldFdpZHRoKHcpIHsKICAgICAgICBjb25zdCB3aSA9IHRoaXMuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgaWYgKHdpLkdldFdpZHRoKCkgPT09IHcpIHJldHVybjsKICAgICAgICB3aS5TZXRXaWR0aCh3KTsKICAgICAgICB3aS5TZXRCYm94Q2hhbmdlZCgpCiAgICB9CgogICAgZnVuY3Rpb24gU2V0SGVpZ2h0KGgpIHsKICAgICAgICBjb25zdCB3aSA9IHRoaXMuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgaWYgKHdpLkdldEhlaWdodCgpID09PSBoKSByZXR1cm47CiAgICAgICAgd2kuU2V0SGVpZ2h0KGgpOwogICAgICAgIHdpLlNldEJib3hDaGFuZ2VkKCkKICAgIH0KCiAgICBmdW5jdGlvbiBTZXRTaXplKHcsIGgpIHsKICAgICAgICBjb25zdCB3aSA9IHRoaXMuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgaWYgKHdpLkdldFdpZHRoKCkgPT09IHcgJiYgd2kuR2V0SGVpZ2h0KCkgPT09IGgpIHJldHVybjsKICAgICAgICB3aS5TZXRTaXplKHcsIGgpOwogICAgICAgIHdpLlNldEJib3hDaGFuZ2VkKCkKICAgIH0KCiAgICBmdW5jdGlvbiBHZXRXaWR0aCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5HZXRXb3JsZEluZm8oKS5HZXRXaWR0aCgpCiAgICB9CgogICAgZnVuY3Rpb24gR2V0SGVpZ2h0KCkgewogICAgICAgIHJldHVybiB0aGlzLkdldFdvcmxkSW5mbygpLkdldEhlaWdodCgpCiAgICB9CgogICAgZnVuY3Rpb24gR2V0QmJveExlZnQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuR2V0V29ybGRJbmZvKCkuR2V0Qm91bmRpbmdCb3goKS5nZXRMZWZ0KCkKICAgIH0KCiAgICBmdW5jdGlvbiBHZXRCYm94VG9wKCkgewogICAgICAgIHJldHVybiB0aGlzLkdldFdvcmxkSW5mbygpLkdldEJvdW5kaW5nQm94KCkuZ2V0VG9wKCkKICAgIH0KCiAgICBmdW5jdGlvbiBHZXRCYm94UmlnaHQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuR2V0V29ybGRJbmZvKCkuR2V0Qm91bmRpbmdCb3goKS5nZXRSaWdodCgpCiAgICB9CgogICAgZnVuY3Rpb24gR2V0QmJveEJvdHRvbSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5HZXRXb3JsZEluZm8oKS5HZXRCb3VuZGluZ0JveCgpLmdldEJvdHRvbSgpCiAgICB9CgogICAgZnVuY3Rpb24gR2V0QmJveE1pZFgoKSB7CiAgICAgICAgY29uc3QgYmJveCA9IHRoaXMuR2V0V29ybGRJbmZvKCkuR2V0Qm91bmRpbmdCb3goKTsKICAgICAgICByZXR1cm4gKGJib3guZ2V0TGVmdCgpICsgYmJveC5nZXRSaWdodCgpKSAvIDIKICAgIH0KCiAgICBmdW5jdGlvbiBHZXRCYm94TWlkWSgpIHsKICAgICAgICBjb25zdCBiYm94ID0gdGhpcy5HZXRXb3JsZEluZm8oKS5HZXRCb3VuZGluZ0JveCgpOwogICAgICAgIHJldHVybiAoYmJveC5nZXRUb3AoKSArIGJib3guZ2V0Qm90dG9tKCkpIC8gMgogICAgfQoKICAgIGZ1bmN0aW9uIElzQW5nbGVXaXRoaW4od2l0aGluLCBhKSB7CiAgICAgICAgcmV0dXJuIEMzLmFuZ2xlRGlmZih0aGlzLkdldFdvcmxkSW5mbygpLkdldEFuZ2xlKCksIEMzLnRvUmFkaWFucyhhKSkgPD0gQzMudG9SYWRpYW5zKHdpdGhpbikKICAgIH0KCiAgICBmdW5jdGlvbiBJc0FuZ2xlQ2xvY2t3aXNlRnJvbShhKSB7CiAgICAgICAgcmV0dXJuIEMzLmFuZ2xlQ2xvY2t3aXNlKHRoaXMuR2V0V29ybGRJbmZvKCkuR2V0QW5nbGUoKSwgQzMudG9SYWRpYW5zKGEpKQogICAgfQoKICAgIGZ1bmN0aW9uIElzQmV0d2VlbkFuZ2xlcyhhLCBiKSB7CiAgICAgICAgY29uc3QgbG93ZXIgPSBDMy50b1JhZGlhbnMoYSk7CiAgICAgICAgY29uc3QgdXBwZXIgPSBDMy50b1JhZGlhbnMoYik7CiAgICAgICAgY29uc3QgYW5nbGUgPSB0aGlzLkdldFdvcmxkSW5mbygpLkdldEFuZ2xlKCk7CiAgICAgICAgY29uc3Qgb2J0dXNlID0gIUMzLmFuZ2xlQ2xvY2t3aXNlKHVwcGVyLCBsb3dlcik7CiAgICAgICAgaWYgKG9idHVzZSkgcmV0dXJuICEoIUMzLmFuZ2xlQ2xvY2t3aXNlKGFuZ2xlLCBsb3dlcikgJiYgQzMuYW5nbGVDbG9ja3dpc2UoYW5nbGUsIHVwcGVyKSk7CiAgICAgICAgZWxzZSByZXR1cm4gQzMuYW5nbGVDbG9ja3dpc2UoYW5nbGUsIGxvd2VyKSAmJiAhQzMuYW5nbGVDbG9ja3dpc2UoYW5nbGUsIHVwcGVyKQogICAgfQoKICAgIGZ1bmN0aW9uIFNldEFuZ2xlKGEpIHsKICAgICAgICBjb25zdCB3aSA9IHRoaXMuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgY29uc3QgbmV3QW5nbGUgPSBDMy5jbGFtcEFuZ2xlKEMzLnRvUmFkaWFucyhhKSk7CiAgICAgICAgaWYgKGlzTmFOKG5ld0FuZ2xlKSB8fCB3aS5HZXRBbmdsZSgpID09PSBuZXdBbmdsZSkgcmV0dXJuOwogICAgICAgIHdpLlNldEFuZ2xlKG5ld0FuZ2xlKTsKICAgICAgICB3aS5TZXRCYm94Q2hhbmdlZCgpCiAgICB9CgogICAgZnVuY3Rpb24gUm90YXRlQ2xvY2t3aXNlKGEpIHsKICAgICAgICBpZiAoaXNOYU4oYSkgfHwgYSA9PT0gMCkgcmV0dXJuOwogICAgICAgIGNvbnN0IHdpID0gdGhpcy5HZXRXb3JsZEluZm8oKTsKICAgICAgICB3aS5TZXRBbmdsZSh3aS5HZXRBbmdsZSgpICsgQzMudG9SYWRpYW5zKGEpKTsKICAgICAgICB3aS5TZXRCYm94Q2hhbmdlZCgpCiAgICB9CgogICAgZnVuY3Rpb24gUm90YXRlQ291bnRlcmNsb2Nrd2lzZShhKSB7CiAgICAgICAgaWYgKGlzTmFOKGEpIHx8IGEgPT09IDApIHJldHVybjsKICAgICAgICBjb25zdCB3aSA9IHRoaXMuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgd2kuU2V0QW5nbGUod2kuR2V0QW5nbGUoKSAtIEMzLnRvUmFkaWFucyhhKSk7CiAgICAgICAgd2kuU2V0QmJveENoYW5nZWQoKQogICAgfQoKICAgIGZ1bmN0aW9uIFJvdGF0ZVRvd2FyZEFuZ2xlKGFtdCwgdGFyZ2V0KSB7CiAgICAgICAgY29uc3Qgd2kgPSB0aGlzLkdldFdvcmxkSW5mbygpOwogICAgICAgIGNvbnN0IGEgPSB3aS5HZXRBbmdsZSgpOwogICAgICAgIGNvbnN0IG5ld0FuZ2xlID0gQzMuYW5nbGVSb3RhdGUoYSwgQzMudG9SYWRpYW5zKHRhcmdldCksIEMzLnRvUmFkaWFucyhhbXQpKTsKICAgICAgICBpZiAoaXNOYU4obmV3QW5nbGUpIHx8IGEgPT09IG5ld0FuZ2xlKSByZXR1cm47CiAgICAgICAgd2kuU2V0QW5nbGUobmV3QW5nbGUpOwogICAgICAgIHdpLlNldEJib3hDaGFuZ2VkKCkKICAgIH0KCiAgICBmdW5jdGlvbiBSb3RhdGVUb3dhcmRQb3NpdGlvbihhbXQsIHgsIHkpIHsKICAgICAgICBjb25zdCB3aSA9IHRoaXMuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgY29uc3QgYSA9IHdpLkdldEFuZ2xlKCk7CiAgICAgICAgY29uc3QgZHggPSB4IC0gd2kuR2V0WCgpOwogICAgICAgIGNvbnN0IGR5ID0geSAtIHdpLkdldFkoKTsKICAgICAgICBjb25zdCB0YXJnZXQgPSBNYXRoLmF0YW4yKGR5LCBkeCk7CiAgICAgICAgY29uc3QgbmV3QW5nbGUgPSBDMy5hbmdsZVJvdGF0ZShhLCB0YXJnZXQsIEMzLnRvUmFkaWFucyhhbXQpKTsKICAgICAgICBpZiAoaXNOYU4obmV3QW5nbGUpIHx8IGEgPT09IG5ld0FuZ2xlKSByZXR1cm47CiAgICAgICAgd2kuU2V0QW5nbGUobmV3QW5nbGUpOwogICAgICAgIHdpLlNldEJib3hDaGFuZ2VkKCkKICAgIH0KCiAgICBmdW5jdGlvbiBTZXRUb3dhcmRQb3NpdGlvbih4LCB5KSB7CiAgICAgICAgY29uc3Qgd2kgPSB0aGlzLkdldFdvcmxkSW5mbygpOwogICAgICAgIGNvbnN0IGEgPSB3aS5HZXRBbmdsZSgpOwogICAgICAgIGNvbnN0IGR4ID0geCAtIHdpLkdldFgoKTsKICAgICAgICBjb25zdCBkeSA9IHkgLSB3aS5HZXRZKCk7CiAgICAgICAgY29uc3QgbmV3QW5nbGUgPSBNYXRoLmF0YW4yKGR5LCBkeCk7CiAgICAgICAgaWYgKGlzTmFOKG5ld0FuZ2xlKSB8fCBhID09PSBuZXdBbmdsZSkgcmV0dXJuOwogICAgICAgIHdpLlNldEFuZ2xlKG5ld0FuZ2xlKTsKICAgICAgICB3aS5TZXRCYm94Q2hhbmdlZCgpCiAgICB9CgogICAgZnVuY3Rpb24gR2V0QW5nbGUoKSB7CiAgICAgICAgcmV0dXJuIEMzLnRvRGVncmVlcyh0aGlzLkdldFdvcmxkSW5mbygpLkdldEFuZ2xlKCkpCiAgICB9CgogICAgZnVuY3Rpb24gQ29tcGFyZU9wYWNpdHkoY21wLCB4KSB7CiAgICAgICAgcmV0dXJuIEMzLmNvbXBhcmUoQzMucm91bmRUb0RwKHRoaXMuR2V0V29ybGRJbmZvKCkuR2V0T3BhY2l0eSgpICogMTAwLCA2KSwgY21wLCB4KQogICAgfQoKICAgIGZ1bmN0aW9uIElzVmlzaWJsZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5HZXRXb3JsZEluZm8oKS5Jc1Zpc2libGUoKQogICAgfQoKICAgIGZ1bmN0aW9uIFNldFZpc2libGUodikgewogICAgICAgIGNvbnN0IHdpID0gdGhpcy5HZXRXb3JsZEluZm8oKTsKICAgICAgICBpZiAodiA9PT0gMikgdiA9ICF3aS5Jc1Zpc2libGUoKTsKICAgICAgICBlbHNlIHYgPSB2ICE9PSAwOwogICAgICAgIGlmICh3aS5Jc1Zpc2libGUoKSA9PT0gdikgcmV0dXJuOwogICAgICAgIHdpLlNldFZpc2libGUodik7CiAgICAgICAgdGhpcy5fcnVudGltZS5VcGRhdGVSZW5kZXIoKQogICAgfQoKICAgIGZ1bmN0aW9uIFNldE9wYWNpdHkobykgewogICAgICAgIGNvbnN0IG5ld09wYWNpdHkgPSBDMy5jbGFtcChvIC8gMTAwLCAwLCAxKTsKICAgICAgICBjb25zdCB3aSA9IHRoaXMuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgaWYgKHdpLkdldFRyYW5zZm9ybVdpdGhQYXJlbnRPcGFjaXR5KCkpIHsKICAgICAgICAgICAgaWYgKHdpLl9HZXRTY2VuZUdyYXBoSW5mbygpLkdldE93bk9wYWNpdHkoKSA9PT0gbmV3T3BhY2l0eSkgcmV0dXJuCiAgICAgICAgfSBlbHNlIGlmICh3aS5HZXRPcGFjaXR5KCkgPT09IG5ld09wYWNpdHkpIHJldHVybjsKICAgICAgICB3aS5TZXRPcGFjaXR5KG5ld09wYWNpdHkpOwogICAgICAgIHRoaXMuX3J1bnRpbWUuVXBkYXRlUmVuZGVyKCkKICAgIH0KCiAgICBmdW5jdGlvbiBTZXREZWZhdWx0Q29sb3IocmdiKSB7CiAgICAgICAgdGVtcENvbG9yLnNldEZyb21SZ2JWYWx1ZShyZ2IpOwogICAgICAgIGNvbnN0IHdpID0gdGhpcy5HZXRXb3JsZEluZm8oKTsKICAgICAgICBpZiAod2kuR2V0VW5wcmVtdWx0aXBsaWVkQ29sb3IoKS5lcXVhbHNJZ25vcmluZ0FscGhhKHRlbXBDb2xvcikpIHJldHVybjsKICAgICAgICB3aS5TZXRVbnByZW11bHRpcGxpZWRDb2xvcih0ZW1wQ29sb3IpOwogICAgICAgIHRoaXMuX3J1bnRpbWUuVXBkYXRlUmVuZGVyKCkKICAgIH0KCiAgICBmdW5jdGlvbiBHZXRDb2xvcigpIHsKICAgICAgICBjb25zdCBjID0gdGhpcy5HZXRXb3JsZEluZm8oKS5HZXRVbnByZW11bHRpcGxpZWRDb2xvcigpOwogICAgICAgIHJldHVybiBDMy5QYWNrUkdCQUV4KGMuZ2V0UigpLCBjLmdldEcoKSwgYy5nZXRCKCksIGMuZ2V0QSgpKQogICAgfQoKICAgIGZ1bmN0aW9uIEdldE9wYWNpdHkoKSB7CiAgICAgICAgcmV0dXJuIEMzLnJvdW5kVG9EcCh0aGlzLkdldFdvcmxkSW5mbygpLkdldE9wYWNpdHkoKSAqIDEwMCwgNikKICAgIH0KCiAgICBmdW5jdGlvbiBJc09uTGF5ZXIobGF5ZXIpIHsKICAgICAgICBpZiAoIWxheWVyKSByZXR1cm4gZmFsc2U7CiAgICAgICAgcmV0dXJuIHRoaXMuR2V0V29ybGRJbmZvKCkuR2V0TGF5ZXIoKSA9PT0gbGF5ZXIKICAgIH0KCiAgICBmdW5jdGlvbiBQaWNrVG9wQm90dG9tKHdoaWNoKSB7CiAgICAgICAgY29uc3Qgc29sID0gdGhpcy5HZXRDdXJyZW50U29sKCk7CiAgICAgICAgY29uc3QgaW5zdGFuY2VzID0gc29sLkdldEluc3RhbmNlcygpOwogICAgICAgIGlmICghaW5zdGFuY2VzLmxlbmd0aCkgcmV0dXJuIGZhbHNlOwogICAgICAgIGxldCBpbnN0ID0gaW5zdGFuY2VzWzBdOwogICAgICAgIGxldCBwaWNrbWUgPSBpbnN0OwogICAgICAgIGZvciAobGV0IGkgPSAxLCBsZW4gPSBpbnN0YW5jZXMubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHsKICAgICAgICAgICAgY29uc3QgaW5zdCA9IGluc3RhbmNlc1tpXTsKICAgICAgICAgICAgY29uc3QgaW5zdFdpID0gaW5zdC5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgY29uc3QgcGlja21lV2kgPSBwaWNrbWUuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgIGNvbnN0IGluc3RMYXllckluZGV4ID0gaW5zdFdpLkdldExheWVyKCkuR2V0SW5kZXgoKTsKICAgICAgICAgICAgY29uc3QgcGlja21lTGF5ZXJJbmRleCA9IHBpY2ttZVdpLkdldExheWVyKCkuR2V0SW5kZXgoKTsKICAgICAgICAgICAgaWYgKHdoaWNoID09PSAwKSB7CiAgICAgICAgICAgICAgICBpZiAoaW5zdExheWVySW5kZXggPiBwaWNrbWVMYXllckluZGV4IHx8IGluc3RMYXllckluZGV4ID09PSBwaWNrbWVMYXllckluZGV4ICYmIGluc3RXaS5HZXRaSW5kZXgoKSA+CiAgICAgICAgICAgICAgICAgICAgcGlja21lV2kuR2V0WkluZGV4KCkpIHBpY2ttZSA9IGluc3QKICAgICAgICAgICAgfSBlbHNlIGlmIChpbnN0TGF5ZXJJbmRleCA8IHBpY2ttZUxheWVySW5kZXggfHwgaW5zdExheWVySW5kZXggPT09IHBpY2ttZUxheWVySW5kZXggJiYgaW5zdFdpLkdldFpJbmRleCgpIDwgcGlja21lV2kuR2V0WkluZGV4KCkpIHBpY2ttZSA9IGluc3QKICAgICAgICB9CiAgICAgICAgc29sLlBpY2tPbmUocGlja21lKTsKICAgICAgICByZXR1cm4gdHJ1ZQogICAgfQoKICAgIGZ1bmN0aW9uIENvbXBhcmVaRWxldmF0aW9uKHdoaWNoLCBjbXAsIHZhbHVlKSB7CiAgICAgICAgY29uc3Qgd2kgPSB0aGlzLkdldFdvcmxkSW5mbygpOwogICAgICAgIGNvbnN0IHogPSB3aGljaCA9PT0gMCA/IHdpLkdldFpFbGV2YXRpb24oKSA6IHdpLkdldFRvdGFsWkVsZXZhdGlvbigpOwogICAgICAgIHJldHVybiBDMy5jb21wYXJlKHosIGNtcCwgdmFsdWUpCiAgICB9CgogICAgZnVuY3Rpb24gTW92ZVRvVG9wKCkgewogICAgICAgIHRoaXMuR2V0V29ybGRJbmZvKCkuWk9yZGVyTW92ZVRvVG9wKCkKICAgIH0KCiAgICBmdW5jdGlvbiBNb3ZlVG9Cb3R0b20oKSB7CiAgICAgICAgdGhpcy5HZXRXb3JsZEluZm8oKS5aT3JkZXJNb3ZlVG9Cb3R0b20oKQogICAgfQoKICAgIGZ1bmN0aW9uIE1vdmVUb0xheWVyKGxheWVyTW92ZSkgewogICAgICAgIGlmICghbGF5ZXJNb3ZlKSByZXR1cm47CiAgICAgICAgdGhpcy5HZXRXb3JsZEluZm8oKS5aT3JkZXJNb3ZlVG9MYXllcihsYXllck1vdmUpCiAgICB9CgogICAgZnVuY3Rpb24gWk1vdmVUb09iamVjdCh3aGVyZSwgb2JqZWN0Q2xhc3MpIHsKICAgICAgICBjb25zdCBpc0FmdGVyID0gd2hlcmUgPT09IDA7CiAgICAgICAgaWYgKCFvYmplY3RDbGFzcykgcmV0dXJuOwogICAgICAgIGNvbnN0IG90aGVySW5zdCA9IG9iamVjdENsYXNzLkdldEZpcnN0UGlja2VkKHRoaXMuR2V0SW5zdGFuY2UoKSk7CiAgICAgICAgaWYgKCFvdGhlckluc3QpIHJldHVybjsKICAgICAgICB0aGlzLkdldFdvcmxkSW5mbygpLlpPcmRlck1vdmVBZGphY2VudFRvSW5zdGFuY2Uob3RoZXJJbnN0LCBpc0FmdGVyKQogICAgfQoKICAgIGZ1bmN0aW9uIFNldFpFbGV2YXRpb24oeikgewogICAgICAgIGNvbnN0IHdpID0gdGhpcy5HZXRXb3JsZEluZm8oKTsKICAgICAgICBpZiAod2kuR2V0WkVsZXZhdGlvbigpID09PSB6KSByZXR1cm47CiAgICAgICAgd2kuU2V0WkVsZXZhdGlvbih6KTsKICAgICAgICB0aGlzLl9ydW50aW1lLlVwZGF0ZVJlbmRlcigpCiAgICB9CgogICAgZnVuY3Rpb24gTGF5ZXJOdW1iZXIoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuR2V0V29ybGRJbmZvKCkuR2V0TGF5ZXIoKS5HZXRJbmRleCgpCiAgICB9CgogICAgZnVuY3Rpb24gTGF5ZXJOYW1lKCkgewogICAgICAgIHJldHVybiB0aGlzLkdldFdvcmxkSW5mbygpLkdldExheWVyKCkuR2V0TmFtZSgpCiAgICB9CgogICAgZnVuY3Rpb24gWkluZGV4KCkgewogICAgICAgIHJldHVybiB0aGlzLkdldFdvcmxkSW5mbygpLkdldFpJbmRleCgpCiAgICB9CgogICAgZnVuY3Rpb24gWkVsZXZhdGlvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5HZXRXb3JsZEluZm8oKS5HZXRaRWxldmF0aW9uKCkKICAgIH0KCiAgICBmdW5jdGlvbiBUb3RhbFpFbGV2YXRpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuR2V0V29ybGRJbmZvKCkuR2V0VG90YWxaRWxldmF0aW9uKCkKICAgIH0KCiAgICBmdW5jdGlvbiBJc0VmZmVjdEVuYWJsZWQoZWZmZWN0TmFtZSkgewogICAgICAgIGNvbnN0IGVmZmVjdFR5cGUgPSB0aGlzLkdldE9iamVjdENsYXNzKCkuR2V0RWZmZWN0TGlzdCgpLkdldEVmZmVjdFR5cGVCeU5hbWUoZWZmZWN0TmFtZSk7CiAgICAgICAgaWYgKCFlZmZlY3RUeXBlKSByZXR1cm47CiAgICAgICAgY29uc3QgZWZmZWN0VHlwZUluZGV4ID0gZWZmZWN0VHlwZS5HZXRJbmRleCgpOwogICAgICAgIGNvbnN0IGluc3RGeExpc3QgPSB0aGlzLkdldFdvcmxkSW5mbygpLkdldEluc3RhbmNlRWZmZWN0TGlzdCgpOwogICAgICAgIHJldHVybiBpbnN0RnhMaXN0LklzRWZmZWN0SW5kZXhBY3RpdmUoZWZmZWN0VHlwZUluZGV4KQogICAgfQoKICAgIGZ1bmN0aW9uIFNldEVmZmVjdEVuYWJsZWQoZW5hYmxlZCwgZWZmZWN0TmFtZSkgewogICAgICAgIGNvbnN0IGVmZmVjdFR5cGUgPSB0aGlzLkdldE9iamVjdENsYXNzKCkuR2V0RWZmZWN0TGlzdCgpLkdldEVmZmVjdFR5cGVCeU5hbWUoZWZmZWN0TmFtZSk7CiAgICAgICAgaWYgKCFlZmZlY3RUeXBlKSByZXR1cm47CiAgICAgICAgY29uc3QgZWZmZWN0VHlwZUluZGV4ID0gZWZmZWN0VHlwZS5HZXRJbmRleCgpOwogICAgICAgIGNvbnN0IGUgPSBlbmFibGVkID09PSAxOwogICAgICAgIGNvbnN0IGluc3RGeExpc3QgPSB0aGlzLkdldFdvcmxkSW5mbygpLkdldEluc3RhbmNlRWZmZWN0TGlzdCgpOwogICAgICAgIGlmIChpbnN0RnhMaXN0LklzRWZmZWN0SW5kZXhBY3RpdmUoZWZmZWN0VHlwZUluZGV4KSA9PT0gZSkgcmV0dXJuOwogICAgICAgIGluc3RGeExpc3QuU2V0RWZmZWN0SW5kZXhBY3RpdmUoZWZmZWN0VHlwZUluZGV4LCBlKTsKICAgICAgICBpbnN0RnhMaXN0LlVwZGF0ZUFjdGl2ZUVmZmVjdHMoKTsKICAgICAgICB0aGlzLl9ydW50aW1lLlVwZGF0ZVJlbmRlcigpCiAgICB9CgogICAgZnVuY3Rpb24gU2V0RWZmZWN0UGFyYW0oZWZmZWN0TmFtZSwgcGFyYW1JbmRleCwgdmFsdWUpIHsKICAgICAgICBjb25zdCBlZmZlY3RUeXBlID0gdGhpcy5HZXRPYmplY3RDbGFzcygpLkdldEVmZmVjdExpc3QoKS5HZXRFZmZlY3RUeXBlQnlOYW1lKGVmZmVjdE5hbWUpOwogICAgICAgIGlmICghZWZmZWN0VHlwZSkgcmV0dXJuOwogICAgICAgIHBhcmFtSW5kZXggPSBNYXRoLmZsb29yKHBhcmFtSW5kZXgpOwogICAgICAgIGNvbnN0IHBhcmFtVHlwZSA9IGVmZmVjdFR5cGUuR2V0U2hhZGVyUHJvZ3JhbSgpLkdldFBhcmFtZXRlclR5cGUocGFyYW1JbmRleCk7CiAgICAgICAgaWYgKCFwYXJhbVR5cGUpIHJldHVybjsKICAgICAgICBpZiAocGFyYW1UeXBlID09PSAiY29sb3IiKSB7CiAgICAgICAgICAgIHRlbXBDb2xvci5zZXRGcm9tUmdiVmFsdWUodmFsdWUpOwogICAgICAgICAgICB2YWx1ZSA9IHRlbXBDb2xvcgogICAgICAgIH0gZWxzZSBpZiAocGFyYW1UeXBlID09PSAicGVyY2VudCIpIHZhbHVlIC89IDEwMDsKICAgICAgICBjb25zdCBlZmZlY3RUeXBlSW5kZXggPSBlZmZlY3RUeXBlLkdldEluZGV4KCk7CiAgICAgICAgY29uc3QgaW5zdEZ4TGlzdCA9IHRoaXMuR2V0V29ybGRJbmZvKCkuR2V0SW5zdGFuY2VFZmZlY3RMaXN0KCk7CiAgICAgICAgY29uc3QgZGlkQ2hhbmdlID0gaW5zdEZ4TGlzdC5TZXRFZmZlY3RQYXJhbWV0ZXIoZWZmZWN0VHlwZUluZGV4LCBwYXJhbUluZGV4LCB2YWx1ZSk7CiAgICAgICAgaWYgKGRpZENoYW5nZSAmJiBpbnN0RnhMaXN0LklzRWZmZWN0SW5kZXhBY3RpdmUoZWZmZWN0VHlwZUluZGV4KSkgdGhpcy5fcnVudGltZS5VcGRhdGVSZW5kZXIoKQogICAgfQogICAgY29uc3QgdGVtcFJlY3QgPSBDMy5OZXcoQzMuUmVjdCk7CiAgICBjb25zdCB0ZW1wQ2FuZGlkYXRlczEgPSBbXTsKICAgIGNvbnN0IHRlbXBDYW5kaWRhdGVzMiA9IFtdOwogICAgbGV0IG5lZWRzQ29sbGlzaW9uRmluaXNoID0gZmFsc2U7CiAgICBsZXQgclBpY2tUeXBlID0gbnVsbDsKICAgIGxldCByUGlja0Zyb21FbHNlSW5zdGFuY2VzID0gZmFsc2U7CiAgICBjb25zdCByVG9QaWNrID0gbmV3IFNldDsKCiAgICBmdW5jdGlvbiBDb2xsTWVtb3J5X0FkZChjb2xsTWVtb3J5LCBhLCBiLCB0aWNrQ291bnQpIHsKICAgICAgICBjb25zdCBhX3VpZCA9IGEuR2V0VUlEKCk7CiAgICAgICAgY29uc3QgYl91aWQgPSBiLkdldFVJRCgpOwogICAgICAgIGlmIChhX3VpZCA8IGJfdWlkKSBjb2xsTWVtb3J5LlNldChhLCBiLCB0aWNrQ291bnQpOwogICAgICAgIGVsc2UgY29sbE1lbW9yeS5TZXQoYiwgYSwgdGlja0NvdW50KQogICAgfQoKICAgIGZ1bmN0aW9uIENvbGxNZW1vcnlfUmVtb3ZlKGNvbGxNZW1vcnksIGEsIGIpIHsKICAgICAgICBjb25zdCBhX3VpZCA9IGEuR2V0VUlEKCk7CiAgICAgICAgY29uc3QgYl91aWQgPSBiLkdldFVJRCgpOwogICAgICAgIGlmIChhX3VpZCA8IGJfdWlkKSBjb2xsTWVtb3J5LkRlbGV0ZShhLCBiKTsKICAgICAgICBlbHNlIGNvbGxNZW1vcnkuRGVsZXRlKGIsIGEpCiAgICB9CgogICAgZnVuY3Rpb24gQ29sbE1lbW9yeV9SZW1vdmVJbnN0YW5jZShjb2xsTWVtb3J5LCBpbnN0KSB7CiAgICAgICAgY29sbE1lbW9yeS5EZWxldGVFaXRoZXIoaW5zdCkKICAgIH0KCiAgICBmdW5jdGlvbiBDb2xsTWVtb3J5X0dldChjb2xsTWVtb3J5LCBhLCBiKSB7CiAgICAgICAgY29uc3QgYV91aWQgPSBhLkdldFVJRCgpOwogICAgICAgIGNvbnN0IGJfdWlkID0gYi5HZXRVSUQoKTsKICAgICAgICBpZiAoYV91aWQgPCBiX3VpZCkgcmV0dXJuIGNvbGxNZW1vcnkuR2V0KGEsIGIpOwogICAgICAgIGVsc2UgcmV0dXJuIGNvbGxNZW1vcnkuR2V0KGIsIGEpCiAgICB9CgogICAgZnVuY3Rpb24gRG9PdmVybGFwQ29uZGl0aW9uKHNka0luc3QsIHJ0eXBlLCBvZmZYLCBvZmZZKSB7CiAgICAgICAgaWYgKCFydHlwZSkgcmV0dXJuIGZhbHNlOwogICAgICAgIGNvbnN0IGluc3QgPSBzZGtJbnN0LkdldEluc3RhbmNlKCk7CiAgICAgICAgY29uc3QgaGFzT2Zmc2V0ID0gb2ZmWCAhPT0gMCB8fCBvZmZZICE9PSAwOwogICAgICAgIGNvbnN0IHdpID0gaW5zdC5HZXRXb3JsZEluZm8oKTsKICAgICAgICBjb25zdCBydW50aW1lID0gaW5zdC5HZXRSdW50aW1lKCk7CiAgICAgICAgY29uc3QgY29sbGlzaW9uRW5naW5lID0gcnVudGltZS5HZXRDb2xsaXNpb25FbmdpbmUoKTsKICAgICAgICBjb25zdCBjbmQgPSBydW50aW1lLkdldEN1cnJlbnRDb25kaXRpb24oKTsKICAgICAgICBjb25zdCBpc09yQmxvY2sgPSBjbmQuR2V0RXZlbnRCbG9jaygpLklzT3JCbG9jaygpOwogICAgICAgIGNvbnN0IGx0eXBlID0gY25kLkdldE9iamVjdENsYXNzKCk7CiAgICAgICAgY29uc3QgaXNJbnZlcnRlZCA9IGNuZC5Jc0ludmVydGVkKCk7CiAgICAgICAgY29uc3QgcnNvbCA9IHJ0eXBlLkdldEN1cnJlbnRTb2woKTsKICAgICAgICBjb25zdCBpc0RpZmZlcmVudFR5cGVzID0gbHR5cGUgIT09IHJ0eXBlOwogICAgICAgIHJQaWNrVHlwZSA9IHJ0eXBlOwogICAgICAgIG5lZWRzQ29sbGlzaW9uRmluaXNoID0KICAgICAgICAgICAgaXNEaWZmZXJlbnRUeXBlcyAmJiAhaXNJbnZlcnRlZDsKICAgICAgICByUGlja0Zyb21FbHNlSW5zdGFuY2VzID0gZmFsc2U7CiAgICAgICAgbGV0IHJpbnN0YW5jZXM7CiAgICAgICAgbGV0IG9sZFggPSAwOwogICAgICAgIGxldCBvbGRZID0gMDsKICAgICAgICBsZXQgcmV0ID0gZmFsc2U7CiAgICAgICAgaWYgKHJzb2wuSXNTZWxlY3RBbGwoKSkgewogICAgICAgICAgICB0ZW1wUmVjdC5jb3B5KHdpLkdldEJvdW5kaW5nQm94KCkpOwogICAgICAgICAgICB0ZW1wUmVjdC5vZmZzZXQob2ZmWCwgb2ZmWSk7CiAgICAgICAgICAgIGNvbGxpc2lvbkVuZ2luZS5HZXRDb2xsaXNpb25DYW5kaWRhdGVzKHdpLkdldExheWVyKCksIHJ0eXBlLCB0ZW1wUmVjdCwgdGVtcENhbmRpZGF0ZXMyKTsKICAgICAgICAgICAgcmluc3RhbmNlcyA9IHRlbXBDYW5kaWRhdGVzMgogICAgICAgIH0gZWxzZSBpZiAoaXNPckJsb2NrKQogICAgICAgICAgICBpZiAocnVudGltZS5Jc0N1cnJlbnRDb25kaXRpb25GaXJzdCgpICYmICFyc29sLl9HZXRPd25FbHNlSW5zdGFuY2VzKCkubGVuZ3RoICYmIHJzb2wuX0dldE93bkluc3RhbmNlcygpLmxlbmd0aCkgcmluc3RhbmNlcyA9IHJzb2wuX0dldE93bkluc3RhbmNlcygpOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIHJpbnN0YW5jZXMgPSByc29sLl9HZXRPd25FbHNlSW5zdGFuY2VzKCk7CiAgICAgICAgICAgICAgICByUGlja0Zyb21FbHNlSW5zdGFuY2VzID0gdHJ1ZQogICAgICAgICAgICB9CiAgICAgICAgZWxzZSByaW5zdGFuY2VzID0gcnNvbC5fR2V0T3duSW5zdGFuY2VzKCk7CiAgICAgICAgaWYgKGhhc09mZnNldCkgewogICAgICAgICAgICBvbGRYID0gd2kuR2V0WCgpOwogICAgICAgICAgICBvbGRZID0gd2kuR2V0WSgpOwogICAgICAgICAgICB3aS5PZmZzZXRYWShvZmZYLCBvZmZZKTsKICAgICAgICAgICAgd2kuU2V0QmJveENoYW5nZWQoKQogICAgICAgIH0KICAgICAgICBmb3IgKGNvbnN0IHJpbnN0IG9mIHJpbnN0YW5jZXMpCiAgICAgICAgICAgIGlmIChjb2xsaXNpb25FbmdpbmUuVGVzdE92ZXJsYXAoaW5zdCwgcmluc3QpKSB7CiAgICAgICAgICAgICAgICByZXQgPSB0cnVlOwogICAgICAgICAgICAgICAgaWYgKGlzSW52ZXJ0ZWQpIGJyZWFrOwogICAgICAgICAgICAgICAgaWYgKGlzRGlmZmVyZW50VHlwZXMpIHJUb1BpY2suYWRkKHJpbnN0KQogICAgICAgICAgICB9CiAgICAgICAgaWYgKGhhc09mZnNldCkgewogICAgICAgICAgICB3aS5TZXRYWShvbGRYLCBvbGRZKTsKICAgICAgICAgICAgd2kuU2V0QmJveENoYW5nZWQoKQogICAgICAgIH0KICAgICAgICBDMy5jbGVhckFycmF5KHRlbXBDYW5kaWRhdGVzMik7CiAgICAgICAgcmV0dXJuIHJldAogICAgfQoKICAgIGZ1bmN0aW9uIEZpbmlzaENvbGxpc2lvbkNvbmRpdGlvblBpY2tpbmcodHlwZSkgewogICAgICAgIGNvbnN0IGlzT3JCbG9jayA9IHR5cGUuR2V0UnVudGltZSgpLkdldEN1cnJlbnRFdmVudCgpLklzT3JCbG9jaygpOwogICAgICAgIGNvbnN0IHNvbCA9IHJQaWNrVHlwZS5HZXRDdXJyZW50U29sKCk7CiAgICAgICAgY29uc3Qgc29sSW5zdGFuY2VzID0gc29sLl9HZXRPd25JbnN0YW5jZXMoKTsKICAgICAgICBjb25zdCBzb2xFbHNlSW5zdGFuY2VzID0gc29sLl9HZXRPd25FbHNlSW5zdGFuY2VzKCk7CiAgICAgICAgaWYgKHNvbC5Jc1NlbGVjdEFsbCgpKSB7CiAgICAgICAgICAgIHNvbC5TZXRTZXRQaWNrZWQoclRvUGljayk7CiAgICAgICAgICAgIGlmIChpc09yQmxvY2spIHsKICAgICAgICAgICAgICAgIEMzLmNsZWFyQXJyYXkoc29sRWxzZUluc3RhbmNlcyk7CiAgICAgICAgICAgICAgICBzb2wuQWRkRWxzZUluc3RhbmNlcyhyVG9QaWNrLCByUGlja1R5cGUuR2V0SW5zdGFuY2VzKCkpCiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKGlzT3JCbG9jaykKICAgICAgICAgICAgaWYgKHJQaWNrRnJvbUVsc2VJbnN0YW5jZXMpIHNvbC5UcmFuc2ZlckVsc2VJbnN0YW5jZXNUb093bihyVG9QaWNrKTsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBzb2wuQWRkRWxzZUluc3RhbmNlcyhyVG9QaWNrLAogICAgICAgICAgICAgICAgICAgIHNvbEluc3RhbmNlcyk7CiAgICAgICAgICAgICAgICBzb2wuU2V0U2V0UGlja2VkKHJUb1BpY2spCiAgICAgICAgICAgIH0KICAgICAgICBlbHNlIHNvbC5TZXRTZXRQaWNrZWQoclRvUGljayk7CiAgICAgICAgclBpY2tUeXBlLkFwcGx5U29sVG9Db250YWluZXIoKQogICAgfQoKICAgIGZ1bmN0aW9uIEZpbmlzaENvbGxpc2lvbkNvbmRpdGlvbih0eXBlLCBkb1BpY2spIHsKICAgICAgICBpZiAoIW5lZWRzQ29sbGlzaW9uRmluaXNoKSByZXR1cm47CiAgICAgICAgaWYgKGRvUGljaykgRmluaXNoQ29sbGlzaW9uQ29uZGl0aW9uUGlja2luZyh0eXBlKTsKICAgICAgICByVG9QaWNrLmNsZWFyKCk7CiAgICAgICAgclBpY2tUeXBlID0gbnVsbDsKICAgICAgICBuZWVkc0NvbGxpc2lvbkZpbmlzaCA9IGZhbHNlCiAgICB9CgogICAgZnVuY3Rpb24gT25Db2xsaXNpb24ocnR5cGUpIHsKICAgICAgICBpZiAodGhpcy5fcnVudGltZS5Jc0RlYnVnZ2luZygpKSByZXR1cm4gRGVidWdPbkNvbGxpc2lvbi5jYWxsKHRoaXMsIHJ0eXBlKTsKICAgICAgICBpZiAoIXJ0eXBlKSByZXR1cm4gZmFsc2U7CiAgICAgICAgY29uc3QgcnVudGltZSA9IHRoaXMuX3J1bnRpbWU7CiAgICAgICAgY29uc3QgY29sbGlzaW9uRW5naW5lID0gcnVudGltZS5HZXRDb2xsaXNpb25FbmdpbmUoKTsKICAgICAgICBjb25zdCBldmVudFNoZWV0TWFuYWdlciA9IHJ1bnRpbWUuR2V0RXZlbnRTaGVldE1hbmFnZXIoKTsKICAgICAgICBjb25zdCBldmVudFN0YWNrID0gZXZlbnRTaGVldE1hbmFnZXIuR2V0RXZlbnRTdGFjaygpOwogICAgICAgIGNvbnN0IGNuZCA9IGV2ZW50U2hlZXRNYW5hZ2VyLkdldEN1cnJlbnRDb25kaXRpb24oKTsKICAgICAgICBjb25zdCBsdHlwZSA9IGNuZC5HZXRPYmplY3RDbGFzcygpOwogICAgICAgIGNvbnN0IHNhdmVkRGF0YSA9IGNuZC5HZXRTYXZlZERhdGFNYXAoKTsKICAgICAgICBjb25zdCB1bnNhdmVkRGF0YSA9IGNuZC5HZXRVbnNhdmVkRGF0YU1hcCgpOwogICAgICAgIGNvbnN0IG9sZEZyYW1lID0gZXZlbnRTdGFjay5HZXRDdXJyZW50U3RhY2tGcmFtZSgpOwogICAgICAgIGNvbnN0IHRpY2tDb3VudCA9IHJ1bnRpbWUuR2V0VGlja0NvdW50KCk7CiAgICAgICAgY29uc3QgbGFzdFRpY2tDb3VudCA9IHRpY2tDb3VudCAtIDE7CiAgICAgICAgY29uc3QgY3VycmVudEV2ZW50ID0gb2xkRnJhbWUuR2V0Q3VycmVudEV2ZW50KCk7CiAgICAgICAgY29uc3QgbmV3RnJhbWUgPSBldmVudFN0YWNrLlB1c2goY3VycmVudEV2ZW50KTsKICAgICAgICBsZXQgY29sbE1lbW9yeSA9IHNhdmVkRGF0YS5nZXQoImNvbGxtZW1vcnkiKTsKICAgICAgICBpZiAoIWNvbGxNZW1vcnkpIHsKICAgICAgICAgICAgY29sbE1lbW9yeSA9IEMzLk5ldyhDMy5QYWlyTWFwKTsKICAgICAgICAgICAgc2F2ZWREYXRhLnNldCgiY29sbG1lbW9yeSIsIGNvbGxNZW1vcnkpCiAgICAgICAgfQogICAgICAgIGlmICghdW5zYXZlZERhdGEuZ2V0KCJjb2xsaXNpb25DcmVhdGVkRGVzdHJveUNhbGxiYWNrIikpIHsKICAgICAgICAgICAgdW5zYXZlZERhdGEuc2V0KCJjb2xsaXNpb25DcmVhdGVkRGVzdHJveUNhbGxiYWNrIiwgdHJ1ZSk7CiAgICAgICAgICAgIHJ1bnRpbWUuRGlzcGF0Y2hlcigpLmFkZEV2ZW50TGlzdGVuZXIoImluc3RhbmNlZGVzdHJveSIsIGUgPT4gQ29sbE1lbW9yeV9SZW1vdmVJbnN0YW5jZShjb2xsTWVtb3J5LCBlLmluc3RhbmNlKSkKICAgICAgICB9CiAgICAgICAgY29uc3QgbHNvbCA9CiAgICAgICAgICAgIGx0eXBlLkdldEN1cnJlbnRTb2woKTsKICAgICAgICBjb25zdCByc29sID0gcnR5cGUuR2V0Q3VycmVudFNvbCgpOwogICAgICAgIGNvbnN0IGxpbnN0YW5jZXMgPSBsc29sLkdldEluc3RhbmNlcygpOwogICAgICAgIGxldCByaW5zdGFuY2VzID0gbnVsbDsKICAgICAgICBmb3IgKGxldCBsID0gMDsgbCA8IGxpbnN0YW5jZXMubGVuZ3RoOyArK2wpIHsKICAgICAgICAgICAgY29uc3QgbGluc3QgPSBsaW5zdGFuY2VzW2xdOwogICAgICAgICAgICBpZiAocnNvbC5Jc1NlbGVjdEFsbCgpKSB7CiAgICAgICAgICAgICAgICBjb2xsaXNpb25FbmdpbmUuR2V0Q29sbGlzaW9uQ2FuZGlkYXRlcyhsaW5zdC5HZXRXb3JsZEluZm8oKS5HZXRMYXllcigpLCBydHlwZSwgbGluc3QuR2V0V29ybGRJbmZvKCkuR2V0Qm91bmRpbmdCb3goKSwgdGVtcENhbmRpZGF0ZXMxKTsKICAgICAgICAgICAgICAgIHJpbnN0YW5jZXMgPSB0ZW1wQ2FuZGlkYXRlczE7CiAgICAgICAgICAgICAgICBjb2xsaXNpb25FbmdpbmUuQWRkUmVnaXN0ZXJlZENvbGxpc2lvbkNhbmRpZGF0ZXMobGluc3QsIHJ0eXBlLCByaW5zdGFuY2VzKQogICAgICAgICAgICB9IGVsc2Ugcmluc3RhbmNlcyA9IHJzb2wuR2V0SW5zdGFuY2VzKCk7CiAgICAgICAgICAgIGZvciAobGV0IHIgPSAwOyByIDwgcmluc3RhbmNlcy5sZW5ndGg7ICsrcikgewogICAgICAgICAgICAgICAgY29uc3Qgcmluc3QgPQogICAgICAgICAgICAgICAgICAgIHJpbnN0YW5jZXNbcl07CiAgICAgICAgICAgICAgICBpZiAoY29sbGlzaW9uRW5naW5lLlRlc3RPdmVybGFwKGxpbnN0LCByaW5zdCkgfHwgY29sbGlzaW9uRW5naW5lLkNoZWNrUmVnaXN0ZXJlZENvbGxpc2lvbihsaW5zdCwgcmluc3QpKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZW50cnkgPSBDb2xsTWVtb3J5X0dldChjb2xsTWVtb3J5LCBsaW5zdCwgcmluc3QpOwogICAgICAgICAgICAgICAgICAgIGxldCBlbnRyeUV4aXN0cyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIGxldCBsYXN0Q29sbFRpY2tDb3VudCA9IC0yOwogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZW50cnkgPT09ICJudW1iZXIiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGVudHJ5RXhpc3RzID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgbGFzdENvbGxUaWNrQ291bnQgPSBlbnRyeQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBjb25zdCBzaG91bGRSdW4gPSAhZW50cnlFeGlzdHMgfHwgbGFzdENvbGxUaWNrQ291bnQgPCBsYXN0VGlja0NvdW50OwogICAgICAgICAgICAgICAgICAgIENvbGxNZW1vcnlfQWRkKGNvbGxNZW1vcnksIGxpbnN0LCByaW5zdCwgdGlja0NvdW50KTsKICAgICAgICAgICAgICAgICAgICBpZiAoc2hvdWxkUnVuKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHNvbE1vZGlmaWVycyA9IGN1cnJlbnRFdmVudC5HZXRTb2xNb2RpZmllcnMoKTsKICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnRTaGVldE1hbmFnZXIuUHVzaENvcHlTb2woc29sTW9kaWZpZXJzKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VybHNvbCA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsdHlwZS5HZXRDdXJyZW50U29sKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJzb2wgPSBydHlwZS5HZXRDdXJyZW50U29sKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGN1cmxzb2wuX1NldFNlbGVjdEFsbChmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJzb2wuX1NldFNlbGVjdEFsbChmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsdHlwZSA9PT0gcnR5cGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHNvbEluc3RhbmNlcyA9IGN1cmxzb2wuX0dldE93bkluc3RhbmNlcygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgQzMuY2xlYXJBcnJheShzb2xJbnN0YW5jZXMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc29sSW5zdGFuY2VzLnB1c2gobGluc3QpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc29sSW5zdGFuY2VzLnB1c2gocmluc3QpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbHR5cGUuQXBwbHlTb2xUb0NvbnRhaW5lcigpCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBsc29sSW5zdGFuY2VzID0gY3VybHNvbC5fR2V0T3duSW5zdGFuY2VzKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByc29sSW5zdGFuY2VzID0gY3VycnNvbC5fR2V0T3duSW5zdGFuY2VzKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDMy5jbGVhckFycmF5KGxzb2xJbnN0YW5jZXMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgQzMuY2xlYXJBcnJheShyc29sSW5zdGFuY2VzKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxzb2xJbnN0YW5jZXMucHVzaChsaW5zdCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByc29sSW5zdGFuY2VzLnB1c2gocmluc3QpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbHR5cGUuQXBwbHlTb2xUb0NvbnRhaW5lcigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcnR5cGUuQXBwbHlTb2xUb0NvbnRhaW5lcigpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudEV2ZW50LlJldHJpZ2dlcihvbGRGcmFtZSwgbmV3RnJhbWUpOwogICAgICAgICAgICAgICAgICAgICAgICBldmVudFNoZWV0TWFuYWdlci5Qb3BTb2woc29sTW9kaWZpZXJzKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSBDb2xsTWVtb3J5X1JlbW92ZShjb2xsTWVtb3J5LCBsaW5zdCwgcmluc3QpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgQzMuY2xlYXJBcnJheSh0ZW1wQ2FuZGlkYXRlczEpCiAgICAgICAgfQogICAgICAgIGV2ZW50U3RhY2suUG9wKCk7CiAgICAgICAgcmV0dXJuIGZhbHNlCiAgICB9CgogICAgZnVuY3Rpb24qIERlYnVnT25Db2xsaXNpb24ocnR5cGUpIHsKICAgICAgICBpZiAoIXJ0eXBlKSByZXR1cm4gZmFsc2U7CiAgICAgICAgY29uc3QgcnVudGltZSA9IHRoaXMuX3J1bnRpbWU7CiAgICAgICAgY29uc3QgY29sbGlzaW9uRW5naW5lID0gcnVudGltZS5HZXRDb2xsaXNpb25FbmdpbmUoKTsKICAgICAgICBjb25zdCBldmVudFNoZWV0TWFuYWdlciA9IHJ1bnRpbWUuR2V0RXZlbnRTaGVldE1hbmFnZXIoKTsKICAgICAgICBjb25zdCBldmVudFN0YWNrID0gZXZlbnRTaGVldE1hbmFnZXIuR2V0RXZlbnRTdGFjaygpOwogICAgICAgIGNvbnN0IGNuZCA9IGV2ZW50U2hlZXRNYW5hZ2VyLkdldEN1cnJlbnRDb25kaXRpb24oKTsKICAgICAgICBjb25zdCBsdHlwZSA9IGNuZC5HZXRPYmplY3RDbGFzcygpOwogICAgICAgIGNvbnN0IHNhdmVkRGF0YSA9IGNuZC5HZXRTYXZlZERhdGFNYXAoKTsKICAgICAgICBjb25zdCB1bnNhdmVkRGF0YSA9IGNuZC5HZXRVbnNhdmVkRGF0YU1hcCgpOwogICAgICAgIGNvbnN0IG9sZEZyYW1lID0gZXZlbnRTdGFjay5HZXRDdXJyZW50U3RhY2tGcmFtZSgpOwogICAgICAgIGNvbnN0IHRpY2tDb3VudCA9IHJ1bnRpbWUuR2V0VGlja0NvdW50KCk7CiAgICAgICAgY29uc3QgbGFzdFRpY2tDb3VudCA9CiAgICAgICAgICAgIHRpY2tDb3VudCAtIDE7CiAgICAgICAgY29uc3QgY3VycmVudEV2ZW50ID0gb2xkRnJhbWUuR2V0Q3VycmVudEV2ZW50KCk7CiAgICAgICAgY29uc3QgbmV3RnJhbWUgPSBldmVudFN0YWNrLlB1c2goY3VycmVudEV2ZW50KTsKICAgICAgICBsZXQgY29sbE1lbW9yeSA9IHNhdmVkRGF0YS5nZXQoImNvbGxtZW1vcnkiKTsKICAgICAgICBpZiAoIWNvbGxNZW1vcnkpIHsKICAgICAgICAgICAgY29sbE1lbW9yeSA9IEMzLk5ldyhDMy5QYWlyTWFwKTsKICAgICAgICAgICAgc2F2ZWREYXRhLnNldCgiY29sbG1lbW9yeSIsIGNvbGxNZW1vcnkpCiAgICAgICAgfQogICAgICAgIGlmICghdW5zYXZlZERhdGEuZ2V0KCJjb2xsaXNpb25DcmVhdGVkRGVzdHJveUNhbGxiYWNrIikpIHsKICAgICAgICAgICAgdW5zYXZlZERhdGEuc2V0KCJjb2xsaXNpb25DcmVhdGVkRGVzdHJveUNhbGxiYWNrIiwgdHJ1ZSk7CiAgICAgICAgICAgIHJ1bnRpbWUuRGlzcGF0Y2hlcigpLmFkZEV2ZW50TGlzdGVuZXIoImluc3RhbmNlZGVzdHJveSIsIGUgPT4gQ29sbE1lbW9yeV9SZW1vdmVJbnN0YW5jZShjb2xsTWVtb3J5LCBlLmluc3RhbmNlKSkKICAgICAgICB9CiAgICAgICAgY29uc3QgbHNvbCA9IGx0eXBlLkdldEN1cnJlbnRTb2woKTsKICAgICAgICBjb25zdCByc29sID0gcnR5cGUuR2V0Q3VycmVudFNvbCgpOwogICAgICAgIGNvbnN0IGxpbnN0YW5jZXMgPSBsc29sLkdldEluc3RhbmNlcygpOwogICAgICAgIGxldCByaW5zdGFuY2VzID0gbnVsbDsKICAgICAgICBmb3IgKGxldCBsID0gMDsgbCA8IGxpbnN0YW5jZXMubGVuZ3RoOyArK2wpIHsKICAgICAgICAgICAgY29uc3QgbGluc3QgPSBsaW5zdGFuY2VzW2xdOwogICAgICAgICAgICBpZiAocnNvbC5Jc1NlbGVjdEFsbCgpKSB7CiAgICAgICAgICAgICAgICBjb2xsaXNpb25FbmdpbmUuR2V0Q29sbGlzaW9uQ2FuZGlkYXRlcyhsaW5zdC5HZXRXb3JsZEluZm8oKS5HZXRMYXllcigpLCBydHlwZSwgbGluc3QuR2V0V29ybGRJbmZvKCkuR2V0Qm91bmRpbmdCb3goKSwgdGVtcENhbmRpZGF0ZXMxKTsKICAgICAgICAgICAgICAgIHJpbnN0YW5jZXMgPSB0ZW1wQ2FuZGlkYXRlczE7CiAgICAgICAgICAgICAgICBjb2xsaXNpb25FbmdpbmUuQWRkUmVnaXN0ZXJlZENvbGxpc2lvbkNhbmRpZGF0ZXMobGluc3QsIHJ0eXBlLCByaW5zdGFuY2VzKQogICAgICAgICAgICB9IGVsc2Ugcmluc3RhbmNlcyA9IHJzb2wuR2V0SW5zdGFuY2VzKCk7CiAgICAgICAgICAgIGZvciAobGV0IHIgPSAwOyByIDwgcmluc3RhbmNlcy5sZW5ndGg7ICsrcikgewogICAgICAgICAgICAgICAgY29uc3Qgcmluc3QgPSByaW5zdGFuY2VzW3JdOwogICAgICAgICAgICAgICAgaWYgKGNvbGxpc2lvbkVuZ2luZS5UZXN0T3ZlcmxhcChsaW5zdCwKICAgICAgICAgICAgICAgICAgICAgICAgcmluc3QpIHx8IGNvbGxpc2lvbkVuZ2luZS5DaGVja1JlZ2lzdGVyZWRDb2xsaXNpb24obGluc3QsIHJpbnN0KSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGVudHJ5ID0gQ29sbE1lbW9yeV9HZXQoY29sbE1lbW9yeSwgbGluc3QsIHJpbnN0KTsKICAgICAgICAgICAgICAgICAgICBsZXQgZW50cnlFeGlzdHMgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICBsZXQgbGFzdENvbGxUaWNrQ291bnQgPSAtMjsKICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGVudHJ5ID09PSAibnVtYmVyIikgewogICAgICAgICAgICAgICAgICAgICAgICBlbnRyeUV4aXN0cyA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RDb2xsVGlja0NvdW50ID0gZW50cnkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2hvdWxkUnVuID0gIWVudHJ5RXhpc3RzIHx8IGxhc3RDb2xsVGlja0NvdW50IDwgbGFzdFRpY2tDb3VudDsKICAgICAgICAgICAgICAgICAgICBDb2xsTWVtb3J5X0FkZChjb2xsTWVtb3J5LCBsaW5zdCwgcmluc3QsIHRpY2tDb3VudCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHNob3VsZFJ1bikgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzb2xNb2RpZmllcnMgPSBjdXJyZW50RXZlbnQuR2V0U29sTW9kaWZpZXJzKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50U2hlZXRNYW5hZ2VyLlB1c2hDb3B5U29sKHNvbE1vZGlmaWVycyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGN1cmxzb2wgPSBsdHlwZS5HZXRDdXJyZW50U29sKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJzb2wgPSBydHlwZS5HZXRDdXJyZW50U29sKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGN1cmxzb2wuX1NldFNlbGVjdEFsbChmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJzb2wuX1NldFNlbGVjdEFsbChmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsdHlwZSA9PT0gcnR5cGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHNvbEluc3RhbmNlcyA9IGN1cmxzb2wuX0dldE93bkluc3RhbmNlcygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgQzMuY2xlYXJBcnJheShzb2xJbnN0YW5jZXMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc29sSW5zdGFuY2VzLnB1c2gobGluc3QpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc29sSW5zdGFuY2VzLnB1c2gocmluc3QpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbHR5cGUuQXBwbHlTb2xUb0NvbnRhaW5lcigpCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBsc29sSW5zdGFuY2VzID0gY3VybHNvbC5fR2V0T3duSW5zdGFuY2VzKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByc29sSW5zdGFuY2VzID0gY3VycnNvbC5fR2V0T3duSW5zdGFuY2VzKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDMy5jbGVhckFycmF5KGxzb2xJbnN0YW5jZXMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgQzMuY2xlYXJBcnJheShyc29sSW5zdGFuY2VzKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxzb2xJbnN0YW5jZXMucHVzaChsaW5zdCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByc29sSW5zdGFuY2VzLnB1c2gocmluc3QpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbHR5cGUuQXBwbHlTb2xUb0NvbnRhaW5lcigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcnR5cGUuQXBwbHlTb2xUb0NvbnRhaW5lcigpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgeWllbGQqIGN1cnJlbnRFdmVudC5EZWJ1Z1JldHJpZ2dlcihvbGRGcmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld0ZyYW1lKTsKICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnRTaGVldE1hbmFnZXIuUG9wU29sKHNvbE1vZGlmaWVycykKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgQ29sbE1lbW9yeV9SZW1vdmUoY29sbE1lbW9yeSwgbGluc3QsIHJpbnN0KQogICAgICAgICAgICB9CiAgICAgICAgICAgIEMzLmNsZWFyQXJyYXkodGVtcENhbmRpZGF0ZXMxKQogICAgICAgIH0KICAgICAgICBldmVudFN0YWNrLlBvcCgpOwogICAgICAgIHJldHVybiBmYWxzZQogICAgfQoKICAgIGZ1bmN0aW9uIElzT3ZlcmxhcHBpbmcocnR5cGUpIHsKICAgICAgICByZXR1cm4gRG9PdmVybGFwQ29uZGl0aW9uKHRoaXMsIHJ0eXBlLCAwLCAwKQogICAgfQoKICAgIGZ1bmN0aW9uIElzT3ZlcmxhcHBpbmdPZmZzZXQocnR5cGUsIG9mZlgsIG9mZlkpIHsKICAgICAgICByZXR1cm4gRG9PdmVybGFwQ29uZGl0aW9uKHRoaXMsIHJ0eXBlLCBvZmZYLCBvZmZZKQogICAgfQoKICAgIGZ1bmN0aW9uIEhhc1BhcmVudCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5HZXRXb3JsZEluZm8oKS5IYXNQYXJlbnQoKQogICAgfQoKICAgIGZ1bmN0aW9uIEhhc0NoaWxkcmVuKCkgewogICAgICAgIHJldHVybiB0aGlzLkdldFdvcmxkSW5mbygpLkhhc0NoaWxkcmVuKCkKICAgIH0KCiAgICBmdW5jdGlvbiBQaWNrUGFyZW50KHBhcmVudE9iamVjdENsYXNzLCB3aGljaCkgewogICAgICAgIGNvbnN0IG15U29sID0gdGhpcy5HZXRDdXJyZW50U29sKCk7CiAgICAgICAgY29uc3QgbXlJbnN0YW5jZXMgPSBteVNvbC5HZXRJbnN0YW5jZXMoKTsKICAgICAgICBpZiAobXlJbnN0YW5jZXMubGVuZ3RoID09PSAwKSByZXR1cm4gZmFsc2U7CiAgICAgICAgY29uc3QgcGFyZW50U29sID0gcGFyZW50T2JqZWN0Q2xhc3MuR2V0Q3VycmVudFNvbCgpOwogICAgICAgIGxldCBwYXJlbnRJbnN0YW5jZXMgPSBwYXJlbnRTb2wuR2V0SW5zdGFuY2VzKCk7CiAgICAgICAgaWYgKHBhcmVudFNvbC5Jc1NlbGVjdEFsbCgpKSB7CiAgICAgICAgICAgIGNvbnN0IHBhcmVudEluc3RzUGVuZGluZ0NyZWF0ZSA9IFsuLi50aGlzLl9ydW50aW1lLmluc3RhbmNlc1BlbmRpbmdDcmVhdGVGb3JPYmplY3RDbGFzcyhwYXJlbnRPYmplY3RDbGFzcyldOwogICAgICAgICAgICBpZiAocGFyZW50SW5zdHNQZW5kaW5nQ3JlYXRlLmxlbmd0aCA+IDApIHBhcmVudEluc3RhbmNlcyA9IHBhcmVudEluc3RhbmNlcy5jb25jYXQocGFyZW50SW5zdHNQZW5kaW5nQ3JlYXRlKQogICAgICAgIH0KICAgICAgICBpZiAocGFyZW50SW5zdGFuY2VzLmxlbmd0aCA9PT0KICAgICAgICAgICAgMCkgcmV0dXJuIGZhbHNlOwogICAgICAgIGNvbnN0IHBhcmVudEluc3RhbmNlc1NldCA9IG5ldyBTZXQocGFyZW50SW5zdGFuY2VzKTsKICAgICAgICBjb25zdCBwaWNrUGFyZW50cyA9IG5ldyBTZXQ7CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IG15SW5zdGFuY2VzLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7CiAgICAgICAgICAgIGNvbnN0IG15SW5zdCA9IG15SW5zdGFuY2VzW2ldOwogICAgICAgICAgICBpZiAod2hpY2ggPT09IDEpCiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHBhcmVudEluc3Qgb2YgbXlJbnN0LnBhcmVudHMoKSkgewogICAgICAgICAgICAgICAgICAgIGlmIChwYXJlbnRJbnN0LkJlbG9uZ3NUb09iamVjdENsYXNzKHBhcmVudE9iamVjdENsYXNzKSAmJiBwYXJlbnRJbnN0YW5jZXNTZXQuaGFzKHBhcmVudEluc3QpKSBwaWNrUGFyZW50cy5hZGQocGFyZW50SW5zdCkKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbGV0IHBhcmVudEluc3Q7CiAgICAgICAgICAgICAgICAgICAgaWYgKHdoaWNoID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudEluc3QgPSBteUluc3QuR2V0UGFyZW50KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJlbnRJbnN0ID09PSBudWxsKSBjb250aW51ZQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBwYXJlbnRJbnN0ID0gbXlJbnN0LkdldFRvcFBhcmVudCgpOwogICAgICAgICAgICAgICAgICAgIGlmIChwYXJlbnRJbnN0LkJlbG9uZ3NUb09iamVjdENsYXNzKHBhcmVudE9iamVjdENsYXNzKSAmJgogICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnRJbnN0YW5jZXNTZXQuaGFzKHBhcmVudEluc3QpKSBwaWNrUGFyZW50cy5hZGQocGFyZW50SW5zdCkKICAgICAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKHBpY2tQYXJlbnRzLnNpemUgPT09IDApIHJldHVybiBmYWxzZTsKICAgICAgICBwYXJlbnRTb2wuU2V0U2V0UGlja2VkKHBpY2tQYXJlbnRzKTsKICAgICAgICBwYXJlbnRPYmplY3RDbGFzcy5BcHBseVNvbFRvQ29udGFpbmVyKCk7CiAgICAgICAgcmV0dXJuIHRydWUKICAgIH0KCiAgICBmdW5jdGlvbiBQaWNrQ2hpbGRyZW4oY2hpbGRPYmplY3RDbGFzcywgd2hpY2gpIHsKICAgICAgICBjb25zdCBteVNvbCA9IHRoaXMuR2V0Q3VycmVudFNvbCgpOwogICAgICAgIGNvbnN0IG15SW5zdGFuY2VzID0gbXlTb2wuR2V0SW5zdGFuY2VzKCk7CiAgICAgICAgaWYgKG15SW5zdGFuY2VzLmxlbmd0aCA9PT0gMCkgcmV0dXJuIGZhbHNlOwogICAgICAgIGNvbnN0IGNoaWxkU29sID0gY2hpbGRPYmplY3RDbGFzcy5HZXRDdXJyZW50U29sKCk7CiAgICAgICAgbGV0IGNoaWxkSW5zdGFuY2VzID0gY2hpbGRTb2wuR2V0SW5zdGFuY2VzKCk7CiAgICAgICAgaWYgKGNoaWxkU29sLklzU2VsZWN0QWxsKCkpIHsKICAgICAgICAgICAgY29uc3QgY2hpbGRJbnN0c1BlbmRpbmdDcmVhdGUgPSBbLi4udGhpcy5fcnVudGltZS5pbnN0YW5jZXNQZW5kaW5nQ3JlYXRlRm9yT2JqZWN0Q2xhc3MoY2hpbGRPYmplY3RDbGFzcyldOwogICAgICAgICAgICBpZiAoY2hpbGRJbnN0c1BlbmRpbmdDcmVhdGUubGVuZ3RoID4gMCkgY2hpbGRJbnN0YW5jZXMgPSBjaGlsZEluc3RhbmNlcy5jb25jYXQoY2hpbGRJbnN0c1BlbmRpbmdDcmVhdGUpCiAgICAgICAgfQogICAgICAgIGlmIChjaGlsZEluc3RhbmNlcy5sZW5ndGggPT09CiAgICAgICAgICAgIDApIHJldHVybiBmYWxzZTsKICAgICAgICBjb25zdCBjaGlsZEluc3RhbmNlc1NldCA9IG5ldyBTZXQoY2hpbGRJbnN0YW5jZXMpOwogICAgICAgIGNvbnN0IHBpY2tDaGlsZHJlbiA9IG5ldyBTZXQ7CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IG15SW5zdGFuY2VzLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7CiAgICAgICAgICAgIGNvbnN0IG15SW5zdCA9IG15SW5zdGFuY2VzW2ldOwogICAgICAgICAgICBpZiAod2hpY2ggPT09IDIgJiYgIW15SW5zdC5IYXNDaGlsZHJlbigpICYmIG15SW5zdC5CZWxvbmdzVG9PYmplY3RDbGFzcyhjaGlsZE9iamVjdENsYXNzKSAmJiBjaGlsZEluc3RhbmNlc1NldC5oYXMobXlJbnN0KSkgcGlja0NoaWxkcmVuLmFkZChteUluc3QpOwogICAgICAgICAgICBmb3IgKGNvbnN0IGNoaWxkSW5zdCBvZiB3aGljaCA9PT0gMCA/IG15SW5zdC5jaGlsZHJlbigpIDogbXlJbnN0LmFsbENoaWxkcmVuKCkpIHsKICAgICAgICAgICAgICAgIGlmICh3aGljaCA9PT0gMiAmJiBjaGlsZEluc3QuSGFzQ2hpbGRyZW4oKSkgY29udGludWU7CiAgICAgICAgICAgICAgICBpZiAoY2hpbGRJbnN0LkJlbG9uZ3NUb09iamVjdENsYXNzKGNoaWxkT2JqZWN0Q2xhc3MpICYmIGNoaWxkSW5zdGFuY2VzU2V0LmhhcyhjaGlsZEluc3QpKSBwaWNrQ2hpbGRyZW4uYWRkKGNoaWxkSW5zdCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAocGlja0NoaWxkcmVuLnNpemUgPT09CiAgICAgICAgICAgIDApIHJldHVybiBmYWxzZTsKICAgICAgICBjaGlsZFNvbC5TZXRTZXRQaWNrZWQocGlja0NoaWxkcmVuKTsKICAgICAgICBjaGlsZE9iamVjdENsYXNzLkFwcGx5U29sVG9Db250YWluZXIoKTsKICAgICAgICByZXR1cm4gdHJ1ZQogICAgfQoKICAgIGZ1bmN0aW9uIFBpY2tOdGhDaGlsZChjaGlsZE9iamVjdENsYXNzLCBpbmRleCkgewogICAgICAgIGNvbnN0IG15U29sID0gdGhpcy5HZXRDdXJyZW50U29sKCk7CiAgICAgICAgY29uc3QgbXlJbnN0YW5jZXMgPSBteVNvbC5HZXRJbnN0YW5jZXMoKTsKICAgICAgICBpZiAobXlJbnN0YW5jZXMubGVuZ3RoID09PSAwKSByZXR1cm4gZmFsc2U7CiAgICAgICAgY29uc3QgY2hpbGRTb2wgPSBjaGlsZE9iamVjdENsYXNzLkdldEN1cnJlbnRTb2woKTsKICAgICAgICBsZXQgY2hpbGRJbnN0YW5jZXMgPSBjaGlsZFNvbC5HZXRJbnN0YW5jZXMoKTsKICAgICAgICBpZiAoY2hpbGRTb2wuSXNTZWxlY3RBbGwoKSkgewogICAgICAgICAgICBjb25zdCBjaGlsZEluc3RzUGVuZGluZ0NyZWF0ZSA9IFsuLi50aGlzLl9ydW50aW1lLmluc3RhbmNlc1BlbmRpbmdDcmVhdGVGb3JPYmplY3RDbGFzcyhjaGlsZE9iamVjdENsYXNzKV07CiAgICAgICAgICAgIGlmIChjaGlsZEluc3RzUGVuZGluZ0NyZWF0ZS5sZW5ndGggPiAwKSBjaGlsZEluc3RhbmNlcyA9IGNoaWxkSW5zdGFuY2VzLmNvbmNhdChjaGlsZEluc3RzUGVuZGluZ0NyZWF0ZSkKICAgICAgICB9CiAgICAgICAgaWYgKGNoaWxkSW5zdGFuY2VzLmxlbmd0aCA9PT0KICAgICAgICAgICAgMCkgcmV0dXJuIGZhbHNlOwogICAgICAgIGNvbnN0IGNoaWxkSW5zdGFuY2VzU2V0ID0gbmV3IFNldChjaGlsZEluc3RhbmNlcyk7CiAgICAgICAgY29uc3QgcGlja0NoaWxkcmVuID0gW107CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IG15SW5zdGFuY2VzLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7CiAgICAgICAgICAgIGNvbnN0IG15SW5zdCA9IG15SW5zdGFuY2VzW2ldOwogICAgICAgICAgICBjb25zdCBjaGlsZEluc3QgPSBteUluc3QuR2V0Q2hpbGRBdChpbmRleCk7CiAgICAgICAgICAgIGlmIChjaGlsZEluc3QgIT09IG51bGwgJiYgY2hpbGRJbnN0LkJlbG9uZ3NUb09iamVjdENsYXNzKGNoaWxkT2JqZWN0Q2xhc3MpICYmIGNoaWxkSW5zdGFuY2VzU2V0LmhhcyhjaGlsZEluc3QpKSBwaWNrQ2hpbGRyZW4ucHVzaChjaGlsZEluc3QpCiAgICAgICAgfQogICAgICAgIGlmIChwaWNrQ2hpbGRyZW4ubGVuZ3RoID09PSAwKSByZXR1cm4gZmFsc2U7CiAgICAgICAgY2hpbGRTb2wuU2V0QXJyYXlQaWNrZWQocGlja0NoaWxkcmVuKTsKICAgICAgICBjaGlsZE9iamVjdENsYXNzLkFwcGx5U29sVG9Db250YWluZXIoKTsKICAgICAgICByZXR1cm4gdHJ1ZQogICAgfQoKICAgIGZ1bmN0aW9uIENvbXBhcmVDaGlsZENvdW50KHdoaWNoLCBjbXAsIGNvdW50KSB7CiAgICAgICAgc3dpdGNoICh3aGljaCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEMzLmNvbXBhcmUodGhpcy5faW5zdC5HZXRDaGlsZENvdW50KCksIGNtcCwgY291bnQpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gQzMuY29tcGFyZSh0aGlzLl9pbnN0LkdldEFsbENoaWxkQ291bnQoKSwgY21wLCBjb3VudCkKICAgICAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gQWRkQ2hpbGQoY2hpbGRPYmplY3RDbGFzcywgdHJhbnNmb3JtWCwgdHJhbnNmb3JtWSwgdHJhbnNmb3JtV2lkdGgsIHRyYW5zZm9ybUhlaWdodCwgdHJhbnNmb3JtQW5nbGUsIHRyYW5zZm9ybU9wYWNpdHksIHRyYW5zZm9ybVpFbGV2YXRpb24sIHRyYW5zZm9ybVZpc2liaWxpdHksIGRlc3Ryb3lXaXRoUGFyZW50KSB7CiAgICAgICAgY29uc3QgaW5zdCA9IHRoaXMuX2luc3Q7CiAgICAgICAgY29uc3QgYWN0T2JqZWN0Q2xhc3MgPSB0aGlzLl9ydW50aW1lLkdldEN1cnJlbnRBY3Rpb24oKS5HZXRPYmplY3RDbGFzcygpOwogICAgICAgIGZvciAoY29uc3QgY2hpbGQgb2YgY2hpbGRPYmplY3RDbGFzcy5hbGxDb3JyZXNwb25kaW5nSW5zdGFuY2VzKGluc3QsIGFjdE9iamVjdENsYXNzKSkgewogICAgICAgICAgICBpZiAoIWNoaWxkLkdldFBsdWdpbigpLlN1cHBvcnRzU2NlbmVHcmFwaCgpKSByZXR1cm47CiAgICAgICAgICAgIGluc3QuQWRkQ2hpbGQoY2hpbGQsIHsKICAgICAgICAgICAgICAgIHRyYW5zZm9ybVgsCiAgICAgICAgICAgICAgICB0cmFuc2Zvcm1ZLAogICAgICAgICAgICAgICAgdHJhbnNmb3JtV2lkdGgsCiAgICAgICAgICAgICAgICB0cmFuc2Zvcm1IZWlnaHQsCiAgICAgICAgICAgICAgICB0cmFuc2Zvcm1BbmdsZSwKICAgICAgICAgICAgICAgIHRyYW5zZm9ybU9wYWNpdHksCiAgICAgICAgICAgICAgICB0cmFuc2Zvcm1aRWxldmF0aW9uLAogICAgICAgICAgICAgICAgdHJhbnNmb3JtVmlzaWJpbGl0eSwKICAgICAgICAgICAgICAgIGRlc3Ryb3lXaXRoUGFyZW50CiAgICAgICAgICAgIH0pCiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIFJlbW92ZUNoaWxkKGNoaWxkT2JqZWN0Q2xhc3MpIHsKICAgICAgICBjb25zdCBpbnN0ID0gdGhpcy5faW5zdDsKICAgICAgICBjb25zdCBhY3RPYmplY3RDbGFzcyA9IHRoaXMuX3J1bnRpbWUuR2V0Q3VycmVudEFjdGlvbigpLkdldE9iamVjdENsYXNzKCk7CiAgICAgICAgZm9yIChjb25zdCBjaGlsZCBvZiBjaGlsZE9iamVjdENsYXNzLmFsbENvcnJlc3BvbmRpbmdJbnN0YW5jZXMoaW5zdCwgYWN0T2JqZWN0Q2xhc3MpKSBpbnN0LlJlbW92ZUNoaWxkKGNoaWxkKQogICAgfQoKICAgIGZ1bmN0aW9uIFJlbW92ZUZyb21QYXJlbnQoKSB7CiAgICAgICAgaWYgKCF0aGlzLl9pbnN0Lkhhc1BhcmVudCgpKSByZXR1cm47CiAgICAgICAgY29uc3QgcGFyZW50ID0gdGhpcy5faW5zdC5HZXRQYXJlbnQoKTsKICAgICAgICBwYXJlbnQuUmVtb3ZlQ2hpbGQodGhpcy5faW5zdCkKICAgIH0KCiAgICBmdW5jdGlvbiBDaGlsZENvdW50KCkgewogICAgICAgIHJldHVybiB0aGlzLl9pbnN0LkdldENoaWxkQ291bnQoKQogICAgfQoKICAgIGZ1bmN0aW9uIEFsbENoaWxkQ291bnQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2luc3QuR2V0QWxsQ2hpbGRDb3VudCgpCiAgICB9CgogICAgZnVuY3Rpb24gU2V0TWVzaFNpemUoY29scywgcm93cykgewogICAgICAgIGNvbHMgPSBNYXRoLmZsb29yKGNvbHMpOwogICAgICAgIHJvd3MgPSBNYXRoLmZsb29yKHJvd3MpOwogICAgICAgIGNvbnN0IHdpID0gdGhpcy5HZXRXb3JsZEluZm8oKTsKICAgICAgICBpZiAoY29scyA8IDIgfHwgcm93cyA8IDIgfHwgIWlzRmluaXRlKGNvbHMpIHx8ICFpc0Zpbml0ZShyb3dzKSkgewogICAgICAgICAgICB3aS5SZWxlYXNlTWVzaCgpOwogICAgICAgICAgICB3aS5TZXRCYm94Q2hhbmdlZCgpCiAgICAgICAgfSBlbHNlIHdpLkNyZWF0ZU1lc2goY29scywgcm93cykKICAgIH0KCiAgICBmdW5jdGlvbiBTZXRNZXNoUG9pbnQoY29sLCByb3csIG1vZGUsIHBvc3gsIHBvc3ksIHpFbGV2YXRpb24sIHRleHUsIHRleHYpIHsKICAgICAgICBjb25zdCB3aSA9IHRoaXMuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgY29uc3QgZGlkQmJveENoYW5nZSA9IHdpLlNldE1lc2hQb2ludChjb2wsIHJvdywgewogICAgICAgICAgICBtb2RlOiBtb2RlID09PSAwID8gImFic29sdXRlIiA6ICJyZWxhdGl2ZSIsCiAgICAgICAgICAgIHg6IHBvc3gsCiAgICAgICAgICAgIHk6IHBvc3ksCiAgICAgICAgICAgIHpFbGV2YXRpb24sCiAgICAgICAgICAgIHU6IHRleHUsCiAgICAgICAgICAgIHY6IHRleHYKICAgICAgICB9KTsKICAgICAgICBpZiAoZGlkQmJveENoYW5nZSkgd2kuU2V0QmJveENoYW5nZWQoKQogICAgfQoKICAgIGZ1bmN0aW9uIE1lc2hDb2x1bW5zKCkgewogICAgICAgIGNvbnN0IHdpID0gdGhpcy5HZXRXb3JsZEluZm8oKTsKICAgICAgICByZXR1cm4gd2kuSGFzTWVzaCgpID8gd2kuR2V0U291cmNlTWVzaCgpLkdldEhTaXplKCkgOiAwCiAgICB9CgogICAgZnVuY3Rpb24gTWVzaFJvd3MoKSB7CiAgICAgICAgY29uc3Qgd2kgPSB0aGlzLkdldFdvcmxkSW5mbygpOwogICAgICAgIHJldHVybiB3aS5IYXNNZXNoKCkgPyB3aS5HZXRTb3VyY2VNZXNoKCkuR2V0VlNpemUoKSA6IDAKICAgIH0KCiAgICBmdW5jdGlvbiBTZXRFbGVtZW50VmlzaWJsZSh2KSB7CiAgICAgICAgY29uc3Qgd2kgPSB0aGlzLkdldFdvcmxkSW5mbygpOwogICAgICAgIGlmICh2ID09PSAyKSB2ID0gIXdpLklzVmlzaWJsZSgpOwogICAgICAgIGVsc2UgdiA9IHYgIT09IDA7CiAgICAgICAgaWYgKHdpLklzVmlzaWJsZSgpID09PSB2KSByZXR1cm47CiAgICAgICAgd2kuU2V0VmlzaWJsZSh2KQogICAgfQoKICAgIGZ1bmN0aW9uIFNldEVsZW1lbnRDU1NTdHlsZShwcm9wLCB2YWwpIHsKICAgICAgICB0aGlzLlNldEVsZW1lbnRDU1NTdHlsZShwcm9wLCB2YWwpCiAgICB9CgogICAgZnVuY3Rpb24gU2V0RWxlbWVudEF0dHJpYnV0ZShhdHRyaWJOYW1lLCB2YWx1ZSkgewogICAgICAgIHRoaXMuU2V0RWxlbWVudEF0dHJpYnV0ZShhdHRyaWJOYW1lLCAiIiArIHZhbHVlKQogICAgfQoKICAgIGZ1bmN0aW9uIFJlbW92ZUVsZW1lbnRBdHRyaWJ1dGUoYXR0cmliTmFtZSkgewogICAgICAgIHRoaXMuUmVtb3ZlRWxlbWVudEF0dHJpYnV0ZShhdHRyaWJOYW1lKQogICAgfQoKICAgIGZ1bmN0aW9uIFNldEVsZW1lbnRGb2N1cygpIHsKICAgICAgICB0aGlzLkZvY3VzRWxlbWVudCgpCiAgICB9CgogICAgZnVuY3Rpb24gU2V0RWxlbWVudEJsdXIoKSB7CiAgICAgICAgdGhpcy5CbHVyRWxlbWVudCgpCiAgICB9CgogICAgZnVuY3Rpb24gSXNFbGVtZW50Rm9jdXNlZCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5Jc0VsZW1lbnRGb2N1c2VkKCkKICAgIH0KCiAgICBmdW5jdGlvbiBTZXRFbGVtZW50RW5hYmxlZChlKSB7CiAgICAgICAgdGhpcy5fU2V0RW5hYmxlZChlICE9PSAwKQogICAgfQoKICAgIGZ1bmN0aW9uIElzRWxlbWVudEVuYWJsZWQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX0lzRW5hYmxlZCgpCiAgICB9CgogICAgZnVuY3Rpb24gQ29tcGFyZUluc3RhbmNlVmFyKGl2LCBjbXAsIHZhbCkgewogICAgICAgIHJldHVybiBDMy5jb21wYXJlKHRoaXMuR2V0SW5zdGFuY2UoKS5HZXRJbnN0YW5jZVZhcmlhYmxlVmFsdWUoaXYpLCBjbXAsIHZhbCkKICAgIH0KCiAgICBmdW5jdGlvbiBJc0Jvb2xJbnN0YW5jZVZhclNldChpdikgewogICAgICAgIHJldHVybiAhIXRoaXMuR2V0SW5zdGFuY2UoKS5HZXRJbnN0YW5jZVZhcmlhYmxlVmFsdWUoaXYpCiAgICB9CgogICAgZnVuY3Rpb24gVGVtcGxhdGVOYW1lKCkgewogICAgICAgIHJldHVybiB0aGlzLkdldEluc3RhbmNlKCkuR2V0VGVtcGxhdGVOYW1lKCkKICAgIH0KCiAgICBmdW5jdGlvbiBQaWNrSW5zdFZhckhpTG93KHdoaWNoLCBpdikgewogICAgICAgIGNvbnN0IHNvbCA9IHRoaXMuR2V0Q3VycmVudFNvbCgpOwogICAgICAgIGNvbnN0IGluc3RhbmNlcyA9IHNvbC5HZXRJbnN0YW5jZXMoKTsKICAgICAgICBpZiAoIWluc3RhbmNlcy5sZW5ndGgpIHJldHVybiBmYWxzZTsKICAgICAgICBjb25zdCBpc0ZhbWlseSA9IHRoaXMuSXNGYW1pbHkoKTsKICAgICAgICBsZXQgcGlja0luc3QgPSBudWxsOwogICAgICAgIGxldCBiZXN0VmFsID0gMDsKICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gaW5zdGFuY2VzLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7CiAgICAgICAgICAgIGNvbnN0IGluc3QgPSBpbnN0YW5jZXNbaV07CiAgICAgICAgICAgIGNvbnN0IG9mZnNldCA9IGlzRmFtaWx5ID8gaW5zdC5HZXRPYmplY3RDbGFzcygpLkdldEZhbWlseUluc3RhbmNlVmFyaWFibGVPZmZzZXQodGhpcy5HZXRGYW1pbHlJbmRleCgpKSA6IDA7CiAgICAgICAgICAgIGNvbnN0IHYgPSBpbnN0LkdldEluc3RhbmNlVmFyaWFibGVWYWx1ZShvZmZzZXQgKyBpdik7CiAgICAgICAgICAgIGlmIChwaWNrSW5zdCA9PT0gbnVsbCB8fCB3aGljaCA9PT0gMCAmJiB2IDwgYmVzdFZhbCB8fCB3aGljaCA9PT0gMSAmJiB2ID4gYmVzdFZhbCkgewogICAgICAgICAgICAgICAgYmVzdFZhbCA9IHY7CiAgICAgICAgICAgICAgICBwaWNrSW5zdCA9IGluc3QKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBzb2wuUGlja09uZShwaWNrSW5zdCk7CiAgICAgICAgcmV0dXJuIHRydWUKICAgIH0KCiAgICBmdW5jdGlvbiBQaWNrQnlVSUQodWlkKSB7CiAgICAgICAgaWYgKHRoaXMuX3J1bnRpbWUuR2V0Q3VycmVudENvbmRpdGlvbigpLklzSW52ZXJ0ZWQoKSkgcmV0dXJuIFBpY2tCeVVJRF9JbnZlcnRlZCh0aGlzLCB1aWQpOwogICAgICAgIGVsc2UgcmV0dXJuIFBpY2tCeVVJRF9Ob3JtYWwodGhpcywgdWlkKQogICAgfQoKICAgIGZ1bmN0aW9uIFBpY2tCeVVJRF9Ob3JtYWwob2JqZWN0Q2xhc3MsIHVpZCkgewogICAgICAgIGNvbnN0IGluc3QgPSBvYmplY3RDbGFzcy5HZXRSdW50aW1lKCkuR2V0SW5zdGFuY2VCeVVJRCh1aWQpOwogICAgICAgIGlmICghaW5zdCkgcmV0dXJuIGZhbHNlOwogICAgICAgIGNvbnN0IHNvbCA9IG9iamVjdENsYXNzLkdldEN1cnJlbnRTb2woKTsKICAgICAgICBpZiAoIXNvbC5Jc1NlbGVjdEFsbCgpICYmICFzb2wuX0dldE93bkluc3RhbmNlcygpLmluY2x1ZGVzKGluc3QpKSByZXR1cm4gZmFsc2U7CiAgICAgICAgaWYgKG9iamVjdENsYXNzLklzRmFtaWx5KCkpIHsKICAgICAgICAgICAgaWYgKGluc3QuR2V0T2JqZWN0Q2xhc3MoKS5CZWxvbmdzVG9GYW1pbHkob2JqZWN0Q2xhc3MpKSB7CiAgICAgICAgICAgICAgICBzb2wuUGlja09uZShpbnN0KTsKICAgICAgICAgICAgICAgIG9iamVjdENsYXNzLkFwcGx5U29sVG9Db250YWluZXIoKTsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKGluc3QuR2V0T2JqZWN0Q2xhc3MoKSA9PT0gb2JqZWN0Q2xhc3MpIHsKICAgICAgICAgICAgc29sLlBpY2tPbmUoaW5zdCk7CiAgICAgICAgICAgIG9iamVjdENsYXNzLkFwcGx5U29sVG9Db250YWluZXIoKTsKICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlCiAgICB9CgogICAgZnVuY3Rpb24gUGlja0J5VUlEX0ludmVydGVkKG9iamVjdENsYXNzLCB1aWQpIHsKICAgICAgICBjb25zdCBzb2wgPSBvYmplY3RDbGFzcy5HZXRDdXJyZW50U29sKCk7CiAgICAgICAgaWYgKHNvbC5Jc1NlbGVjdEFsbCgpKSB7CiAgICAgICAgICAgIHNvbC5fU2V0U2VsZWN0QWxsKGZhbHNlKTsKICAgICAgICAgICAgc29sLkNsZWFyQXJyYXlzKCk7CiAgICAgICAgICAgIGNvbnN0IGluc3RhbmNlcyA9IG9iamVjdENsYXNzLkdldEluc3RhbmNlcygpOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gaW5zdGFuY2VzLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7CiAgICAgICAgICAgICAgICBjb25zdCBpbnN0ID0gaW5zdGFuY2VzW2ldOwogICAgICAgICAgICAgICAgaWYgKGluc3QuR2V0VUlEKCkgPT09IHVpZCkgc29sLl9QdXNoRWxzZUluc3RhbmNlKGluc3QpOwogICAgICAgICAgICAgICAgZWxzZSBzb2wuX1B1c2hJbnN0YW5jZShpbnN0KQogICAgICAgICAgICB9CiAgICAgICAgICAgIG9iamVjdENsYXNzLkFwcGx5U29sVG9Db250YWluZXIoKTsKICAgICAgICAgICAgcmV0dXJuICEhc29sLl9HZXRPd25JbnN0YW5jZXMoKS5sZW5ndGgKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb25zdCBpbnN0YW5jZXMgPSBzb2wuX0dldE93bkluc3RhbmNlcygpOwogICAgICAgICAgICBsZXQgaiA9IDA7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBpbnN0YW5jZXMubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGluc3QgPQogICAgICAgICAgICAgICAgICAgIGluc3RhbmNlc1tpXTsKICAgICAgICAgICAgICAgIGluc3RhbmNlc1tqXSA9IGluc3Q7CiAgICAgICAgICAgICAgICBpZiAoaW5zdC5HZXRVSUQoKSA9PT0gdWlkKSBzb2wuX1B1c2hFbHNlSW5zdGFuY2UoaW5zdCk7CiAgICAgICAgICAgICAgICBlbHNlICsragogICAgICAgICAgICB9CiAgICAgICAgICAgIEMzLnRydW5jYXRlQXJyYXkoaW5zdGFuY2VzLCBqKTsKICAgICAgICAgICAgb2JqZWN0Q2xhc3MuQXBwbHlTb2xUb0NvbnRhaW5lcigpOwogICAgICAgICAgICByZXR1cm4gISFpbnN0YW5jZXMubGVuZ3RoCiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIERlc3Ryb3koKSB7CiAgICAgICAgdGhpcy5fcnVudGltZS5EZXN0cm95SW5zdGFuY2UodGhpcy5faW5zdCkKICAgIH0KCiAgICBmdW5jdGlvbiBPbkNyZWF0ZWQoKSB7CiAgICAgICAgcmV0dXJuIHRydWUKICAgIH0KCiAgICBmdW5jdGlvbiBPbkRlc3Ryb3llZCgpIHsKICAgICAgICByZXR1cm4gdHJ1ZQogICAgfQoKICAgIGZ1bmN0aW9uIFNldEluc3RhbmNlVmFyKGl2LCB2YWx1ZSkgewogICAgICAgIHRoaXMuR2V0SW5zdGFuY2UoKS5TZXRJbnN0YW5jZVZhcmlhYmxlVmFsdWUoaXYsIHZhbHVlKQogICAgfQoKICAgIGZ1bmN0aW9uIEFkZEluc3RhbmNlVmFyKGl2LCB2YWx1ZSkgewogICAgICAgIGNvbnN0IGluc3RhbmNlID0gdGhpcy5HZXRJbnN0YW5jZSgpOwogICAgICAgIGNvbnN0IGxhc3RWYWx1ZSA9IGluc3RhbmNlLkdldEluc3RhbmNlVmFyaWFibGVWYWx1ZShpdik7CiAgICAgICAgaWYgKHR5cGVvZiBsYXN0VmFsdWUgPT09ICJudW1iZXIiICYmIHR5cGVvZiB2YWx1ZSAhPT0gIm51bWJlciIpIHZhbHVlID0gcGFyc2VGbG9hdCh2YWx1ZSk7CiAgICAgICAgZWxzZSBpZiAodHlwZW9mIGxhc3RWYWx1ZSA9PT0gInN0cmluZyIgJiYgdHlwZW9mIHZhbHVlICE9PSAic3RyaW5nIikgdmFsdWUgPSB2YWx1ZS50b1N0cmluZygpOwogICAgICAgIGluc3RhbmNlLlNldEluc3RhbmNlVmFyaWFibGVWYWx1ZShpdiwgbGFzdFZhbHVlICsgdmFsdWUpCiAgICB9CgogICAgZnVuY3Rpb24gU3ViSW5zdGFuY2VWYXIoaXYsIHZhbHVlKSB7CiAgICAgICAgY29uc3QgaW5zdGFuY2UgPSB0aGlzLkdldEluc3RhbmNlKCk7CiAgICAgICAgY29uc3QgbGFzdFZhbHVlID0gaW5zdGFuY2UuR2V0SW5zdGFuY2VWYXJpYWJsZVZhbHVlKGl2KTsKICAgICAgICBpZiAodHlwZW9mIGxhc3RWYWx1ZSAhPT0gIm51bWJlciIpIHJldHVybjsKICAgICAgICBpZiAodHlwZW9mIHZhbHVlICE9PSAibnVtYmVyIikgdmFsdWUgPSBwYXJzZUZsb2F0KHZhbHVlKTsKICAgICAgICBpbnN0YW5jZS5TZXRJbnN0YW5jZVZhcmlhYmxlVmFsdWUoaXYsIGxhc3RWYWx1ZSAtIHZhbHVlKQogICAgfQoKICAgIGZ1bmN0aW9uIFNldEJvb2xJbnN0YW5jZVZhcihpdiwgdmFsdWUpIHsKICAgICAgICB0aGlzLkdldEluc3RhbmNlKCkuU2V0SW5zdGFuY2VWYXJpYWJsZVZhbHVlKGl2LCB2YWx1ZSA/IDEgOiAwKQogICAgfQoKICAgIGZ1bmN0aW9uIFRvZ2dsZUJvb2xJbnN0YW5jZVZhcihpdikgewogICAgICAgIGNvbnN0IGluc3RhbmNlID0gdGhpcy5HZXRJbnN0YW5jZSgpOwogICAgICAgIGluc3RhbmNlLlNldEluc3RhbmNlVmFyaWFibGVWYWx1ZShpdiwgaW5zdGFuY2UuR2V0SW5zdGFuY2VWYXJpYWJsZVZhbHVlKGl2KSA9PT0gMCA/IDEgOiAwKQogICAgfQoKICAgIGZ1bmN0aW9uIExvYWRGcm9tSnNvblN0cmluZyhzdHIpIHsKICAgICAgICBsZXQgbzsKICAgICAgICB0cnkgewogICAgICAgICAgICBvID0gSlNPTi5wYXJzZShzdHIpCiAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkZhaWxlZCB0byBsb2FkIGZyb20gSlNPTiBzdHJpbmc6ICIsIGVycik7CiAgICAgICAgICAgIHJldHVybgogICAgICAgIH0KICAgICAgICBjb25zdCBpbnN0ID0gdGhpcy5HZXRJbnN0YW5jZSgpOwogICAgICAgIGNvbnN0IG1vZGUgPSAic3RhdGUiOwogICAgICAgIGluc3QuX09uQmVmb3JlTG9hZChtb2RlKTsKICAgICAgICBpbnN0LkxvYWRGcm9tSnNvbihvLCBtb2RlKTsKICAgICAgICBjb25zdCBldmVudCA9IEMzLk5ldyhDMy5FdmVudCwgImFmdGVybG9hZGluc3RhbmNlIik7CiAgICAgICAgZXZlbnRbImluc3RhbmNlIl0gPSBpbnN0OwogICAgICAgIHRoaXMuX3J1bnRpbWUuRGlzcGF0Y2hlcigpLmRpc3BhdGNoRXZlbnQoZXZlbnQpCiAgICB9CgogICAgZnVuY3Rpb24gQXNKU09OKCkgewogICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeSh0aGlzLkdldEluc3RhbmNlKCkuU2F2ZVRvSnNvbigic3RhdGUiKSkKICAgIH0KCiAgICBmdW5jdGlvbiBPYmplY3RUeXBlTmFtZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5HZXRJbnN0YW5jZSgpLkdldE9iamVjdENsYXNzKCkuR2V0TmFtZSgpCiAgICB9CgogICAgZnVuY3Rpb24gQ291bnQoKSB7CiAgICAgICAgY29uc3QgZXhwT2JqZWN0Q2xhc3MgPSB0aGlzLl9ydW50aW1lLkdldEN1cnJlbnRFdmVudFN0YWNrRnJhbWUoKS5HZXRFeHByZXNzaW9uT2JqZWN0Q2xhc3MoKTsKICAgICAgICBsZXQgY291bnQgPSBleHBPYmplY3RDbGFzcy5HZXRJbnN0YW5jZUNvdW50KCk7CiAgICAgICAgZm9yIChjb25zdCBpbnN0IG9mIHRoaXMuX3J1bnRpbWUuaW5zdGFuY2VzUGVuZGluZ0NyZWF0ZUZvck9iamVjdENsYXNzKGV4cE9iamVjdENsYXNzKSkgKytjb3VudDsKICAgICAgICByZXR1cm4gY291bnQKICAgIH0KCiAgICBmdW5jdGlvbiBQaWNrZWRDb3VudCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcnVudGltZS5HZXRDdXJyZW50RXZlbnRTdGFja0ZyYW1lKCkuR2V0RXhwcmVzc2lvbk9iamVjdENsYXNzKCkuR2V0Q3VycmVudFNvbCgpLkdldEluc3RhbmNlcygpLmxlbmd0aAogICAgfQoKICAgIGZ1bmN0aW9uIEdldElJRCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5faW5zdC5HZXRJSUQoKQogICAgfQoKICAgIGZ1bmN0aW9uIEdldFVJRCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5faW5zdC5HZXRVSUQoKQogICAgfQogICAgQzMuQWRkQ29tbW9uQUNFcyA9IGZ1bmN0aW9uIEFkZENvbW1vbkFDRXMocGx1Z2luRGF0YSwgcGx1Z2luQ3RvcikgewogICAgICAgIGNvbnN0IGlzU2luZ2xlR2xvYmFsID0gcGx1Z2luRGF0YVsxXTsKICAgICAgICBjb25zdCBoYXNQb3NpdGlvbkFDRXMgPSBwbHVnaW5EYXRhWzNdOwogICAgICAgIGNvbnN0IGhhc1NpemVBQ0VzID0gcGx1Z2luRGF0YVs0XTsKICAgICAgICBjb25zdCBoYXNBbmdsZUFDRXMgPSBwbHVnaW5EYXRhWzVdOwogICAgICAgIGNvbnN0IGhhc0FwcGVhcmFuY2VBQ0VzID0gcGx1Z2luRGF0YVs2XTsKICAgICAgICBjb25zdCBoYXNaT3JkZXJBQ0VzID0gcGx1Z2luRGF0YVs3XTsKICAgICAgICBjb25zdCBoYXNFZmZlY3RzQUNFcyA9IHBsdWdpbkRhdGFbOF07CiAgICAgICAgY29uc3QgaGFzRWxlbWVudEFDRXMgPSBwbHVnaW5EYXRhWzEwXTsKICAgICAgICBjb25zdCBoYXNFbGVtZW50Rm9jdXNBQ0VzID0gcGx1Z2luRGF0YVsxMV07CiAgICAgICAgY29uc3QgaGFzRWxlbWVudEVuYWJsZWRBQ0VzID0gcGx1Z2luRGF0YVsxMl07CiAgICAgICAgY29uc3QgaGFzU2NlbmVHcmFwaEFDRXMgPSBwbHVnaW5EYXRhWzEzXTsKICAgICAgICBjb25zdCBoYXNNZXNoQUNFcyA9IHBsdWdpbkRhdGFbMTRdOwogICAgICAgIGNvbnN0IGhhc0NvbGxpc2lvbkFDRXMgPQogICAgICAgICAgICBwbHVnaW5EYXRhWzE1XTsKICAgICAgICBjb25zdCBoYXNUZW1wbGF0ZUFDRXMgPSBwbHVnaW5EYXRhWzE2XTsKICAgICAgICBjb25zdCBDbmRzID0gcGx1Z2luQ3Rvci5DbmRzOwogICAgICAgIGNvbnN0IEFjdHMgPSBwbHVnaW5DdG9yLkFjdHM7CiAgICAgICAgY29uc3QgRXhwcyA9IHBsdWdpbkN0b3IuRXhwczsKICAgICAgICBpZiAoaGFzUG9zaXRpb25BQ0VzKSB7CiAgICAgICAgICAgIENuZHMuQ29tcGFyZVggPSBDb21wYXJlWDsKICAgICAgICAgICAgQ25kcy5Db21wYXJlWSA9IENvbXBhcmVZOwogICAgICAgICAgICBDbmRzLklzT25TY3JlZW4gPSBJc09uU2NyZWVuOwogICAgICAgICAgICBDbmRzLklzT3V0c2lkZUxheW91dCA9IElzT3V0c2lkZUxheW91dDsKICAgICAgICAgICAgQ25kcy5QaWNrRGlzdGFuY2UgPSBQaWNrRGlzdGFuY2U7CiAgICAgICAgICAgIEFjdHMuU2V0WCA9IFNldFg7CiAgICAgICAgICAgIEFjdHMuU2V0WSA9IFNldFk7CiAgICAgICAgICAgIEFjdHMuU2V0UG9zID0gU2V0UG9zOwogICAgICAgICAgICBBY3RzLlNldFBvc1RvT2JqZWN0ID0gU2V0UG9zVG9PYmplY3Q7CiAgICAgICAgICAgIEFjdHMuTW92ZUZvcndhcmQgPSBNb3ZlRm9yd2FyZDsKICAgICAgICAgICAgQWN0cy5Nb3ZlQXRBbmdsZSA9IE1vdmVBdEFuZ2xlOwogICAgICAgICAgICBFeHBzLlggPSBHZXRYOwogICAgICAgICAgICBFeHBzLlkgPSBHZXRZOwogICAgICAgICAgICBFeHBzLmR0ID0gR2V0RHQKICAgICAgICB9CiAgICAgICAgaWYgKGhhc1NpemVBQ0VzKSB7CiAgICAgICAgICAgIENuZHMuQ29tcGFyZVdpZHRoID0KICAgICAgICAgICAgICAgIENvbXBhcmVXaWR0aDsKICAgICAgICAgICAgQ25kcy5Db21wYXJlSGVpZ2h0ID0gQ29tcGFyZUhlaWdodDsKICAgICAgICAgICAgQWN0cy5TZXRXaWR0aCA9IFNldFdpZHRoOwogICAgICAgICAgICBBY3RzLlNldEhlaWdodCA9IFNldEhlaWdodDsKICAgICAgICAgICAgQWN0cy5TZXRTaXplID0gU2V0U2l6ZTsKICAgICAgICAgICAgRXhwcy5XaWR0aCA9IEdldFdpZHRoOwogICAgICAgICAgICBFeHBzLkhlaWdodCA9IEdldEhlaWdodDsKICAgICAgICAgICAgRXhwcy5CQm94TGVmdCA9IEdldEJib3hMZWZ0OwogICAgICAgICAgICBFeHBzLkJCb3hUb3AgPSBHZXRCYm94VG9wOwogICAgICAgICAgICBFeHBzLkJCb3hSaWdodCA9IEdldEJib3hSaWdodDsKICAgICAgICAgICAgRXhwcy5CQm94Qm90dG9tID0gR2V0QmJveEJvdHRvbTsKICAgICAgICAgICAgRXhwcy5CQm94TWlkWCA9IEdldEJib3hNaWRYOwogICAgICAgICAgICBFeHBzLkJCb3hNaWRZID0gR2V0QmJveE1pZFkKICAgICAgICB9CiAgICAgICAgaWYgKGhhc0FuZ2xlQUNFcykgewogICAgICAgICAgICBDbmRzLkFuZ2xlV2l0aGluID0gSXNBbmdsZVdpdGhpbjsKICAgICAgICAgICAgQ25kcy5Jc0Nsb2Nrd2lzZUZyb20gPSBJc0FuZ2xlQ2xvY2t3aXNlRnJvbTsKICAgICAgICAgICAgQ25kcy5Jc0JldHdlZW5BbmdsZXMgPSBJc0JldHdlZW5BbmdsZXM7CiAgICAgICAgICAgIEFjdHMuU2V0QW5nbGUgPSBTZXRBbmdsZTsKICAgICAgICAgICAgQWN0cy5Sb3RhdGVDbG9ja3dpc2UgPSBSb3RhdGVDbG9ja3dpc2U7CiAgICAgICAgICAgIEFjdHMuUm90YXRlQ291bnRlcmNsb2Nrd2lzZSA9IFJvdGF0ZUNvdW50ZXJjbG9ja3dpc2U7CiAgICAgICAgICAgIEFjdHMuUm90YXRlVG93YXJkQW5nbGUgPSBSb3RhdGVUb3dhcmRBbmdsZTsKICAgICAgICAgICAgQWN0cy5Sb3RhdGVUb3dhcmRQb3NpdGlvbiA9IFJvdGF0ZVRvd2FyZFBvc2l0aW9uOwogICAgICAgICAgICBBY3RzLlNldFRvd2FyZFBvc2l0aW9uID0gU2V0VG93YXJkUG9zaXRpb247CiAgICAgICAgICAgIEV4cHMuQW5nbGUgPSBHZXRBbmdsZQogICAgICAgIH0KICAgICAgICBpZiAoaGFzQXBwZWFyYW5jZUFDRXMpIHsKICAgICAgICAgICAgQ25kcy5Jc1Zpc2libGUgPSBJc1Zpc2libGU7CiAgICAgICAgICAgIENuZHMuQ29tcGFyZU9wYWNpdHkgPSBDb21wYXJlT3BhY2l0eTsKICAgICAgICAgICAgQWN0cy5TZXRWaXNpYmxlID0gU2V0VmlzaWJsZTsKICAgICAgICAgICAgQWN0cy5TZXRPcGFjaXR5ID0gU2V0T3BhY2l0eTsKICAgICAgICAgICAgQWN0cy5TZXREZWZhdWx0Q29sb3IgPSBTZXREZWZhdWx0Q29sb3I7CiAgICAgICAgICAgIEV4cHMuT3BhY2l0eSA9IEdldE9wYWNpdHk7CiAgICAgICAgICAgIEV4cHMuQ29sb3JWYWx1ZSA9IEdldENvbG9yCiAgICAgICAgfQogICAgICAgIGlmIChoYXNaT3JkZXJBQ0VzKSB7CiAgICAgICAgICAgIENuZHMuSXNPbkxheWVyID0gSXNPbkxheWVyOwogICAgICAgICAgICBDbmRzLlBpY2tUb3BCb3R0b20gPSBQaWNrVG9wQm90dG9tOwogICAgICAgICAgICBDbmRzLkNvbXBhcmVaRWxldmF0aW9uID0KICAgICAgICAgICAgICAgIENvbXBhcmVaRWxldmF0aW9uOwogICAgICAgICAgICBBY3RzLk1vdmVUb1RvcCA9IE1vdmVUb1RvcDsKICAgICAgICAgICAgQWN0cy5Nb3ZlVG9Cb3R0b20gPSBNb3ZlVG9Cb3R0b207CiAgICAgICAgICAgIEFjdHMuTW92ZVRvTGF5ZXIgPSBNb3ZlVG9MYXllcjsKICAgICAgICAgICAgQWN0cy5aTW92ZVRvT2JqZWN0ID0gWk1vdmVUb09iamVjdDsKICAgICAgICAgICAgQWN0cy5TZXRaRWxldmF0aW9uID0gU2V0WkVsZXZhdGlvbjsKICAgICAgICAgICAgRXhwcy5MYXllck51bWJlciA9IExheWVyTnVtYmVyOwogICAgICAgICAgICBFeHBzLkxheWVyTmFtZSA9IExheWVyTmFtZTsKICAgICAgICAgICAgRXhwcy5aSW5kZXggPSBaSW5kZXg7CiAgICAgICAgICAgIEV4cHMuWkVsZXZhdGlvbiA9IFpFbGV2YXRpb247CiAgICAgICAgICAgIEV4cHMuVG90YWxaRWxldmF0aW9uID0gVG90YWxaRWxldmF0aW9uCiAgICAgICAgfQogICAgICAgIGlmIChoYXNFZmZlY3RzQUNFcykgewogICAgICAgICAgICBDbmRzLklzRWZmZWN0RW5hYmxlZCA9IElzRWZmZWN0RW5hYmxlZDsKICAgICAgICAgICAgQWN0cy5TZXRFZmZlY3RFbmFibGVkID0gU2V0RWZmZWN0RW5hYmxlZDsKICAgICAgICAgICAgQWN0cy5TZXRFZmZlY3RQYXJhbSA9IFNldEVmZmVjdFBhcmFtCiAgICAgICAgfQogICAgICAgIGlmIChoYXNTY2VuZUdyYXBoQUNFcykgewogICAgICAgICAgICBDbmRzLkhhc1BhcmVudCA9IEhhc1BhcmVudDsKICAgICAgICAgICAgQ25kcy5IYXNDaGlsZHJlbiA9IEhhc0NoaWxkcmVuOwogICAgICAgICAgICBDbmRzLlBpY2tQYXJlbnQgPSBQaWNrUGFyZW50OwogICAgICAgICAgICBDbmRzLlBpY2tDaGlsZHJlbiA9IFBpY2tDaGlsZHJlbjsKICAgICAgICAgICAgQ25kcy5QaWNrTnRoQ2hpbGQgPSBQaWNrTnRoQ2hpbGQ7CiAgICAgICAgICAgIENuZHMuQ29tcGFyZUNoaWxkQ291bnQgPSBDb21wYXJlQ2hpbGRDb3VudDsKICAgICAgICAgICAgQWN0cy5BZGRDaGlsZCA9IEFkZENoaWxkOwogICAgICAgICAgICBBY3RzLlJlbW92ZUNoaWxkID0gUmVtb3ZlQ2hpbGQ7CiAgICAgICAgICAgIEFjdHMuUmVtb3ZlRnJvbVBhcmVudCA9IFJlbW92ZUZyb21QYXJlbnQ7CiAgICAgICAgICAgIEV4cHMuQ2hpbGRDb3VudCA9IENoaWxkQ291bnQ7CiAgICAgICAgICAgIEV4cHMuQWxsQ2hpbGRDb3VudCA9IEFsbENoaWxkQ291bnQKICAgICAgICB9CiAgICAgICAgaWYgKGhhc01lc2hBQ0VzKSB7CiAgICAgICAgICAgIEFjdHMuU2V0TWVzaFNpemUgPSBTZXRNZXNoU2l6ZTsKICAgICAgICAgICAgQWN0cy5TZXRNZXNoUG9pbnQgPSBTZXRNZXNoUG9pbnQ7CiAgICAgICAgICAgIEV4cHMuTWVzaENvbHVtbnMgPSBNZXNoQ29sdW1uczsKICAgICAgICAgICAgRXhwcy5NZXNoUm93cyA9IE1lc2hSb3dzCiAgICAgICAgfQogICAgICAgIGlmIChoYXNFbGVtZW50QUNFcykgewogICAgICAgICAgICBDbmRzLklzVmlzaWJsZSA9IElzVmlzaWJsZTsKICAgICAgICAgICAgQWN0cy5TZXRWaXNpYmxlID0gU2V0RWxlbWVudFZpc2libGU7CiAgICAgICAgICAgIEFjdHMuU2V0Q1NTU3R5bGUgPQogICAgICAgICAgICAgICAgU2V0RWxlbWVudENTU1N0eWxlOwogICAgICAgICAgICBBY3RzLlNldEVsZW1BdHRyaWJ1dGUgPSBTZXRFbGVtZW50QXR0cmlidXRlOwogICAgICAgICAgICBBY3RzLlJlbW92ZUVsZW1BdHRyaWJ1dGUgPSBSZW1vdmVFbGVtZW50QXR0cmlidXRlCiAgICAgICAgfQogICAgICAgIGlmIChoYXNFbGVtZW50Rm9jdXNBQ0VzKSB7CiAgICAgICAgICAgIENuZHMuSXNGb2N1c2VkID0gSXNFbGVtZW50Rm9jdXNlZDsKICAgICAgICAgICAgQWN0cy5TZXRGb2N1cyA9IFNldEVsZW1lbnRGb2N1czsKICAgICAgICAgICAgQWN0cy5TZXRCbHVyID0gU2V0RWxlbWVudEJsdXIKICAgICAgICB9CiAgICAgICAgaWYgKGhhc0VsZW1lbnRFbmFibGVkQUNFcykgewogICAgICAgICAgICBDbmRzLklzRW5hYmxlZCA9IElzRWxlbWVudEVuYWJsZWQ7CiAgICAgICAgICAgIEFjdHMuU2V0RW5hYmxlZCA9IFNldEVsZW1lbnRFbmFibGVkCiAgICAgICAgfQogICAgICAgIGlmIChoYXNDb2xsaXNpb25BQ0VzKSB7CiAgICAgICAgICAgIENuZHMuT25Db2xsaXNpb24gPSBPbkNvbGxpc2lvbjsKICAgICAgICAgICAgQ25kcy5Jc092ZXJsYXBwaW5nID0gSXNPdmVybGFwcGluZzsKICAgICAgICAgICAgQ25kcy5Jc092ZXJsYXBwaW5nT2Zmc2V0ID0gSXNPdmVybGFwcGluZ09mZnNldDsKICAgICAgICAgICAgcGx1Z2luQ3Rvci5GaW5pc2hDb2xsaXNpb25Db25kaXRpb24gPSBGaW5pc2hDb2xsaXNpb25Db25kaXRpb24KICAgICAgICB9CiAgICAgICAgaWYgKCFpc1NpbmdsZUdsb2JhbCkgewogICAgICAgICAgICBDbmRzLkNvbXBhcmVJbnN0YW5jZVZhciA9CiAgICAgICAgICAgICAgICBDb21wYXJlSW5zdGFuY2VWYXI7CiAgICAgICAgICAgIENuZHMuSXNCb29sSW5zdGFuY2VWYXJTZXQgPSBJc0Jvb2xJbnN0YW5jZVZhclNldDsKICAgICAgICAgICAgQ25kcy5QaWNrSW5zdFZhckhpTG93ID0gUGlja0luc3RWYXJIaUxvdzsKICAgICAgICAgICAgQ25kcy5QaWNrQnlVSUQgPSBQaWNrQnlVSUQ7CiAgICAgICAgICAgIEFjdHMuU2V0SW5zdGFuY2VWYXIgPSBTZXRJbnN0YW5jZVZhcjsKICAgICAgICAgICAgQWN0cy5BZGRJbnN0YW5jZVZhciA9IEFkZEluc3RhbmNlVmFyOwogICAgICAgICAgICBBY3RzLlN1Ykluc3RhbmNlVmFyID0gU3ViSW5zdGFuY2VWYXI7CiAgICAgICAgICAgIEFjdHMuU2V0Qm9vbEluc3RhbmNlVmFyID0gU2V0Qm9vbEluc3RhbmNlVmFyOwogICAgICAgICAgICBBY3RzLlRvZ2dsZUJvb2xJbnN0YW5jZVZhciA9IFRvZ2dsZUJvb2xJbnN0YW5jZVZhcjsKICAgICAgICAgICAgQ25kcy5PbkNyZWF0ZWQgPSBPbkNyZWF0ZWQ7CiAgICAgICAgICAgIENuZHMuT25EZXN0cm95ZWQgPSBPbkRlc3Ryb3llZDsKICAgICAgICAgICAgQWN0cy5EZXN0cm95ID0gRGVzdHJveTsKICAgICAgICAgICAgaWYgKCFBY3RzLkxvYWRGcm9tSnNvblN0cmluZykgQWN0cy5Mb2FkRnJvbUpzb25TdHJpbmcgPSBMb2FkRnJvbUpzb25TdHJpbmc7CiAgICAgICAgICAgIGlmICghRXhwcy5Bc0pTT04pIEV4cHMuQXNKU09OID0KICAgICAgICAgICAgICAgIEFzSlNPTjsKICAgICAgICAgICAgRXhwcy5Db3VudCA9IENvdW50OwogICAgICAgICAgICBFeHBzLlBpY2tlZENvdW50ID0gUGlja2VkQ291bnQ7CiAgICAgICAgICAgIEV4cHMuSUlEID0gR2V0SUlEOwogICAgICAgICAgICBFeHBzLlVJRCA9IEdldFVJRDsKICAgICAgICAgICAgRXhwcy5PYmplY3RUeXBlTmFtZSA9IE9iamVjdFR5cGVOYW1lCiAgICAgICAgfQogICAgICAgIGlmIChoYXNUZW1wbGF0ZUFDRXMpIEV4cHMuVGVtcGxhdGVOYW1lID0gVGVtcGxhdGVOYW1lCiAgICB9OwoKfQoKLy8gZXZlbnRzL3NjaGVkdWxlZFdhaXQuanMKewogICAgJ3VzZSBzdHJpY3QnOwogICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgQzMuU2NoZWR1bGVkV2FpdCA9IGNsYXNzIFNjaGVkdWxlZFdhaXQgZXh0ZW5kcyBDMy5EZWZlbmRlZEJhc2UgewogICAgICAgIGNvbnN0cnVjdG9yKGV2ZW50U2hlZXRNYW5hZ2VyKSB7CiAgICAgICAgICAgIHN1cGVyKCk7CiAgICAgICAgICAgIHRoaXMuX2V2ZW50U2hlZXRNYW5hZ2VyID0gZXZlbnRTaGVldE1hbmFnZXI7CiAgICAgICAgICAgIHRoaXMuX3R5cGUgPSAiIjsKICAgICAgICAgICAgdGhpcy5fdGltZSA9IC0xOwogICAgICAgICAgICB0aGlzLl9zaWduYWxUYWcgPSAiIjsKICAgICAgICAgICAgdGhpcy5faXNTaWduYWxsZWQgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5fZXZlbnQgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9hY3RJbmRleCA9IDA7CiAgICAgICAgICAgIHRoaXMuX3NvbE1vZGlmaWVycyA9IFtdOwogICAgICAgICAgICB0aGlzLl9keW5hbWljU29sTW9kaWZpZXJzID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fc29scyA9IG5ldyBNYXA7CiAgICAgICAgICAgIHRoaXMuX2NhbGxpbmdGdW5jdGlvbkJsb2NrID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fYXN5bmNJZCA9IC0xOwogICAgICAgICAgICB0aGlzLl9mdW5jdGlvblBhcmFtZXRlcnMgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9mdW5jdGlvbklubmVyTG9jYWxWYXJzID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fc2hvdWxkUmVsZWFzZSA9IGZhbHNlCiAgICAgICAgfQogICAgICAgIFJlbGVhc2UoKSB7CiAgICAgICAgICAgIHRoaXMuX3R5cGUgPSAiIjsKICAgICAgICAgICAgdGhpcy5fdGltZSA9IC0xOwogICAgICAgICAgICB0aGlzLl9zaWduYWxUYWcgPQogICAgICAgICAgICAgICAgIiI7CiAgICAgICAgICAgIHRoaXMuX2V2ZW50ID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fY2FsbGluZ0Z1bmN0aW9uQmxvY2sgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9mdW5jdGlvblBhcmFtZXRlcnMgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9mdW5jdGlvbklubmVyTG9jYWxWYXJzID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fYXN5bmNJZCA9IC0xOwogICAgICAgICAgICBDMy5jbGVhckFycmF5KHRoaXMuX3NvbE1vZGlmaWVycyk7CiAgICAgICAgICAgIGlmICh0aGlzLl9keW5hbWljU29sTW9kaWZpZXJzKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9keW5hbWljU29sTW9kaWZpZXJzLmNsZWFyKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9keW5hbWljU29sTW9kaWZpZXJzID0gbnVsbAogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciAoY29uc3QgcyBvZiB0aGlzLl9zb2xzLnZhbHVlcygpKSBzLlJlbGVhc2UoKTsKICAgICAgICAgICAgdGhpcy5fc29scy5jbGVhcigpCiAgICAgICAgfQogICAgICAgIF9Jbml0KCkgewogICAgICAgICAgICBjb25zdCBldmVudFNoZWV0TWFuYWdlciA9IHRoaXMuX2V2ZW50U2hlZXRNYW5hZ2VyOwogICAgICAgICAgICBjb25zdCBhbGxPYmplY3RDbGFzc2VzID0gZXZlbnRTaGVldE1hbmFnZXIuR2V0UnVudGltZSgpLkdldEFsbE9iamVjdENsYXNzZXMoKTsKICAgICAgICAgICAgY29uc3QgZnJhbWUgPSBldmVudFNoZWV0TWFuYWdlci5HZXRDdXJyZW50RXZlbnRTdGFja0ZyYW1lKCk7CiAgICAgICAgICAgIHRoaXMuX2V2ZW50ID0gZnJhbWUuR2V0Q3VycmVudEV2ZW50KCk7CiAgICAgICAgICAgIHRoaXMuX2FjdEluZGV4ID0gZnJhbWUuR2V0QWN0aW9uSW5kZXgoKSArIDE7CiAgICAgICAgICAgIGNvbnN0IGZ1bmN0aW9uQmxvY2sgPSBldmVudFNoZWV0TWFuYWdlci5GaW5kRmlyc3RGdW5jdGlvbkJsb2NrUGFyZW50KHRoaXMuX2V2ZW50KTsKICAgICAgICAgICAgaWYgKGZ1bmN0aW9uQmxvY2spIHsKICAgICAgICAgICAgICAgIHRoaXMuX2NhbGxpbmdGdW5jdGlvbkJsb2NrID0gZnVuY3Rpb25CbG9jazsKICAgICAgICAgICAgICAgIHRoaXMuX2Z1bmN0aW9uUGFyYW1ldGVycyA9IGZ1bmN0aW9uQmxvY2suQ2FwdHVyZUZ1bmN0aW9uUGFyYW1ldGVycygpOwogICAgICAgICAgICAgICAgdGhpcy5fZnVuY3Rpb25Jbm5lckxvY2FsVmFycyA9IGZ1bmN0aW9uQmxvY2suX0dldEFsbElubmVyTG9jYWxWYXJpYWJsZXMoKS5tYXAodiA9PiB2LkdldFZhbHVlKCkpOwogICAgICAgICAgICAgICAgaWYgKGZ1bmN0aW9uQmxvY2suSXNBc3luYygpKSB0aGlzLl9hc3luY0lkID0gZnVuY3Rpb25CbG9jay5QYXVzZUN1cnJlbnRBc3luY0Z1bmN0aW9uKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IgKGNvbnN0IG9iamVjdENsYXNzIG9mIGFsbE9iamVjdENsYXNzZXMpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHNvbCA9CiAgICAgICAgICAgICAgICAgICAgb2JqZWN0Q2xhc3MuR2V0Q3VycmVudFNvbCgpOwogICAgICAgICAgICAgICAgaWYgKHNvbC5Jc1NlbGVjdEFsbCgpICYmICF0aGlzLl9ldmVudC5IYXNTb2xNb2RpZmllcihvYmplY3RDbGFzcykpIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgdGhpcy5fc29sTW9kaWZpZXJzLnB1c2gob2JqZWN0Q2xhc3MpOwogICAgICAgICAgICAgICAgdGhpcy5fc29scy5zZXQob2JqZWN0Q2xhc3MsIEMzLk5ldyhDMy5Tb2xTdGF0ZSwgc29sKSkKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBkeW5hbWljU29sTW9kaWZpZXJzU2V0ID0gZXZlbnRTaGVldE1hbmFnZXIuR2V0RHluYW1pY1NvbE1vZGlmaWVyc1NldCgpOwogICAgICAgICAgICB0aGlzLl9keW5hbWljU29sTW9kaWZpZXJzID0gZHluYW1pY1NvbE1vZGlmaWVyc1NldC5zaXplID4gMCA/IGR5bmFtaWNTb2xNb2RpZmllcnNTZXQgOiBudWxsCiAgICAgICAgfQogICAgICAgIEluaXRUaW1lcihzZWNvbmRzKSB7CiAgICAgICAgICAgIHRoaXMuX3R5cGUgPSAidGltZXIiOwogICAgICAgICAgICB0aGlzLl9Jbml0KCk7CiAgICAgICAgICAgIHRoaXMuX3RpbWUgPSB0aGlzLl9ldmVudFNoZWV0TWFuYWdlci5HZXRSdW50aW1lKCkuR2V0R2FtZVRpbWUoKSArIHNlY29uZHMKICAgICAgICB9CiAgICAgICAgSW5pdFNpZ25hbCh0YWcpIHsKICAgICAgICAgICAgdGhpcy5fdHlwZSA9ICJzaWduYWwiOwogICAgICAgICAgICB0aGlzLl9Jbml0KCk7CiAgICAgICAgICAgIHRoaXMuX3NpZ25hbFRhZyA9IHRhZy50b0xvd2VyQ2FzZSgpCiAgICAgICAgfQogICAgICAgIEluaXRQcm9taXNlKHApIHsKICAgICAgICAgICAgdGhpcy5fdHlwZSA9ICJwcm9taXNlIjsKICAgICAgICAgICAgdGhpcy5fSW5pdCgpOwogICAgICAgICAgICBwLnRoZW4oKCkgPT4gdGhpcy5TZXRTaWduYWxsZWQoKSkuY2F0Y2goZXJyID0+IHsKICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybigiW0MzIHJ1bnRpbWVdIFByb21pc2UgcmVqZWN0ZWQgaW4gJ1dhaXQgZm9yIHByZXZpb3VzIGFjdGlvbnMgdG8gY29tcGxldGUnOiAiLCBlcnIpOwogICAgICAgICAgICAgICAgdGhpcy5TZXRTaWduYWxsZWQoKQogICAgICAgICAgICB9KQogICAgICAgIH0KICAgICAgICBJc1RpbWVyKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fdHlwZSA9PT0gInRpbWVyIgogICAgICAgIH0KICAgICAgICBJc1NpZ25hbCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3R5cGUgPT09ICJzaWduYWwiCiAgICAgICAgfQogICAgICAgIElzUHJvbWlzZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3R5cGUgPT09ICJwcm9taXNlIgogICAgICAgIH0KICAgICAgICBHZXRTaWduYWxUYWcoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zaWduYWxUYWcKICAgICAgICB9CiAgICAgICAgSXNTaWduYWxsZWQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pc1NpZ25hbGxlZAogICAgICAgIH0KICAgICAgICBTZXRTaWduYWxsZWQoKSB7CiAgICAgICAgICAgIHRoaXMuX2lzU2lnbmFsbGVkID0gdHJ1ZQogICAgICAgIH0KICAgICAgICBfU2hvdWxkUnVuKCkgewogICAgICAgICAgICBpZiAodGhpcy5Jc1RpbWVyKCkpIHJldHVybiB0aGlzLl90aW1lIDw9CiAgICAgICAgICAgICAgICB0aGlzLl9ldmVudFNoZWV0TWFuYWdlci5HZXRSdW50aW1lKCkuR2V0R2FtZVRpbWUoKTsKICAgICAgICAgICAgZWxzZSByZXR1cm4gdGhpcy5Jc1NpZ25hbGxlZCgpCiAgICAgICAgfQogICAgICAgIF9SZXN0b3JlU3RhdGUoZnJhbWUpIHsKICAgICAgICAgICAgZnJhbWUuX1Jlc3RvcmUodGhpcy5fZXZlbnQsIHRoaXMuX2FjdEluZGV4KTsKICAgICAgICAgICAgZm9yIChjb25zdCBbb2JqZWN0Q2xhc3MsIHNvbFN0YXRlXSBvZiB0aGlzLl9zb2xzLmVudHJpZXMoKSkgewogICAgICAgICAgICAgICAgY29uc3Qgc29sID0gb2JqZWN0Q2xhc3MuR2V0Q3VycmVudFNvbCgpOwogICAgICAgICAgICAgICAgc29sU3RhdGUuX1Jlc3RvcmUoc29sKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLl9keW5hbWljU29sTW9kaWZpZXJzKSBmcmFtZS5TZXREeW5hbWljU29sTW9kaWZpZXJzKFsuLi50aGlzLl9keW5hbWljU29sTW9kaWZpZXJzXSk7CiAgICAgICAgICAgIGNvbnN0IGNhbGxpbmdGdW5jdGlvbkJsb2NrID0gdGhpcy5fY2FsbGluZ0Z1bmN0aW9uQmxvY2s7CiAgICAgICAgICAgIGlmIChjYWxsaW5nRnVuY3Rpb25CbG9jaykgewogICAgICAgICAgICAgICAgY2FsbGluZ0Z1bmN0aW9uQmxvY2suU2V0RnVuY3Rpb25QYXJhbWV0ZXJzKHRoaXMuX2Z1bmN0aW9uUGFyYW1ldGVycyk7CiAgICAgICAgICAgICAgICBjYWxsaW5nRnVuY3Rpb25CbG9jay5fR2V0QWxsSW5uZXJMb2NhbFZhcmlhYmxlcygpLm1hcCgodiwgaW5kZXgpID0+IHYuU2V0VmFsdWUodGhpcy5fZnVuY3Rpb25Jbm5lckxvY2FsVmFyc1tpbmRleF0pKTsKICAgICAgICAgICAgICAgIGlmIChjYWxsaW5nRnVuY3Rpb25CbG9jay5Jc0FzeW5jKCkpIGNhbGxpbmdGdW5jdGlvbkJsb2NrLlJlc3VtZUFzeW5jRnVuY3Rpb24odGhpcy5fYXN5bmNJZCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBfUnVuKGZyYW1lKSB7CiAgICAgICAgICAgIHRoaXMuX1Jlc3RvcmVTdGF0ZShmcmFtZSk7CiAgICAgICAgICAgIHRoaXMuX2V2ZW50Ll9SZXN1bWVBY3Rpb25zQW5kU3ViRXZlbnRzKGZyYW1lKTsKICAgICAgICAgICAgaWYgKHRoaXMuX2NhbGxpbmdGdW5jdGlvbkJsb2NrICYmIHRoaXMuX2NhbGxpbmdGdW5jdGlvbkJsb2NrLklzQXN5bmMoKSkgdGhpcy5fY2FsbGluZ0Z1bmN0aW9uQmxvY2suTWF5YmVGaW5pc2hBc3luY0Z1bmN0aW9uQ2FsbCh0aGlzLl9hc3luY0lkKTsKICAgICAgICAgICAgdGhpcy5fZXZlbnRTaGVldE1hbmFnZXIuQ2xlYXJTb2wodGhpcy5fc29sTW9kaWZpZXJzKTsKICAgICAgICAgICAgdGhpcy5fc2hvdWxkUmVsZWFzZSA9CiAgICAgICAgICAgICAgICB0cnVlCiAgICAgICAgfQogICAgICAgIGFzeW5jIF9EZWJ1Z1J1bihmcmFtZSkgewogICAgICAgICAgICB0aGlzLl9SZXN0b3JlU3RhdGUoZnJhbWUpOwogICAgICAgICAgICBmb3IgKGNvbnN0IGJyZWFrRXZlbnRPYmplY3Qgb2YgdGhpcy5fZXZlbnQuX0RlYnVnUmVzdW1lQWN0aW9uc0FuZFN1YkV2ZW50cyhmcmFtZSkpIGF3YWl0IHRoaXMuX2V2ZW50U2hlZXRNYW5hZ2VyLkdldFJ1bnRpbWUoKS5EZWJ1Z0JyZWFrKGJyZWFrRXZlbnRPYmplY3QpOwogICAgICAgICAgICBpZiAodGhpcy5fY2FsbGluZ0Z1bmN0aW9uQmxvY2sgJiYgdGhpcy5fY2FsbGluZ0Z1bmN0aW9uQmxvY2suSXNBc3luYygpKSB0aGlzLl9jYWxsaW5nRnVuY3Rpb25CbG9jay5NYXliZUZpbmlzaEFzeW5jRnVuY3Rpb25DYWxsKHRoaXMuX2FzeW5jSWQpOwogICAgICAgICAgICB0aGlzLl9ldmVudFNoZWV0TWFuYWdlci5DbGVhclNvbCh0aGlzLl9zb2xNb2RpZmllcnMpOwogICAgICAgICAgICB0aGlzLl9zaG91bGRSZWxlYXNlID0gdHJ1ZQogICAgICAgIH0KICAgICAgICBTaG91bGRSZWxlYXNlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fc2hvdWxkUmVsZWFzZQogICAgICAgIH0KICAgICAgICBSZW1vdmVJbnN0YW5jZXMocykgewogICAgICAgICAgICBmb3IgKGNvbnN0IHNvbFN0YXRlIG9mIHRoaXMuX3NvbHMudmFsdWVzKCkpIHNvbFN0YXRlLlJlbW92ZUluc3RhbmNlcyhzKQogICAgICAgIH0KICAgICAgICBfU2F2ZVRvSnNvbigpIHsKICAgICAgICAgICAgY29uc3Qgc29scyA9IHt9OwogICAgICAgICAgICBjb25zdCBvID0gewogICAgICAgICAgICAgICAgInQiOiB0aGlzLl90aW1lLAogICAgICAgICAgICAgICAgInN0IjogdGhpcy5fc2lnbmFsVGFnLAogICAgICAgICAgICAgICAgInMiOiB0aGlzLl9pc1NpZ25hbGxlZCwKICAgICAgICAgICAgICAgICJldiI6IHRoaXMuX2V2ZW50LkdldFNJRCgpLAogICAgICAgICAgICAgICAgInNtIjogdGhpcy5fc29sTW9kaWZpZXJzLm1hcChvYyA9PiBvYy5HZXRTSUQoKSksCiAgICAgICAgICAgICAgICAiZHNtIjogdGhpcy5fZHluYW1pY1NvbE1vZGlmaWVycyA/IFsuLi50aGlzLl9keW5hbWljU29sTW9kaWZpZXJzXS5tYXAob2MgPT4gb2MuR2V0U0lEKCkpIDogbnVsbCwKICAgICAgICAgICAgICAgICJzb2xzIjogc29scwogICAgICAgICAgICB9OwogICAgICAgICAgICBpZiAodGhpcy5fZXZlbnQuX0hhc0FjdGlvbkluZGV4KHRoaXMuX2FjdEluZGV4KSkgb1siYWN0Il0gPSB0aGlzLl9ldmVudC5HZXRBY3Rpb25BdCh0aGlzLl9hY3RJbmRleCkuR2V0U0lEKCk7CiAgICAgICAgICAgIGZvciAoY29uc3QgW29iamVjdENsYXNzLCBzb2xTdGF0ZV0gb2YgdGhpcy5fc29scykgc29sc1tvYmplY3RDbGFzcy5HZXRTSUQoKS50b1N0cmluZygpXSA9IHNvbFN0YXRlLl9TYXZlVG9Kc29uKCk7CiAgICAgICAgICAgIHJldHVybiBvCiAgICAgICAgfQogICAgICAgIHN0YXRpYyBfQ3JlYXRlRnJvbUpzb24oZXZlbnRTaGVldE1hbmFnZXIsCiAgICAgICAgICAgIG8pIHsKICAgICAgICAgICAgY29uc3QgcnVudGltZSA9IGV2ZW50U2hlZXRNYW5hZ2VyLkdldFJ1bnRpbWUoKTsKICAgICAgICAgICAgY29uc3QgZXZlbnQgPSBldmVudFNoZWV0TWFuYWdlci5HZXRFdmVudEJsb2NrQnlTSUQob1siZXYiXSk7CiAgICAgICAgICAgIGlmICghZXZlbnQpIHJldHVybiBudWxsOwogICAgICAgICAgICBsZXQgYWN0SW5kZXggPSAwOwogICAgICAgICAgICBpZiAoby5oYXNPd25Qcm9wZXJ0eSgiYWN0IikpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGFjdCA9IGV2ZW50U2hlZXRNYW5hZ2VyLkdldEFjdGlvbkJ5U0lEKG9bImFjdCJdKTsKICAgICAgICAgICAgICAgIGlmICghYWN0KSByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICAgIGFjdEluZGV4ID0gYWN0LkdldEluZGV4KCkKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBzdyA9IEMzLk5ldyhDMy5TY2hlZHVsZWRXYWl0LCBldmVudFNoZWV0TWFuYWdlcik7CiAgICAgICAgICAgIHN3Ll90aW1lID0gb1sidCJdOwogICAgICAgICAgICBzdy5fdHlwZSA9IHN3Ll90aW1lID09PSAtMSA/ICJzaWduYWwiIDogInRpbWVyIjsKICAgICAgICAgICAgc3cuX3NpZ25hbFRhZyA9IG9bInN0Il07CiAgICAgICAgICAgIHN3Ll9pc1NpZ25hbGxlZCA9IG9bInMiXTsKICAgICAgICAgICAgc3cuX2V2ZW50ID0gZXZlbnQ7CiAgICAgICAgICAgIHN3Ll9hY3RJbmRleCA9IGFjdEluZGV4OwogICAgICAgICAgICBmb3IgKGNvbnN0IHNpZCBvZiBvWyJzbSJdKSB7CiAgICAgICAgICAgICAgICBjb25zdCBvYmplY3RDbGFzcyA9CiAgICAgICAgICAgICAgICAgICAgcnVudGltZS5HZXRPYmplY3RDbGFzc0J5U0lEKHNpZCk7CiAgICAgICAgICAgICAgICBpZiAob2JqZWN0Q2xhc3MpIHN3Ll9zb2xNb2RpZmllcnMucHVzaChvYmplY3RDbGFzcykKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShvWyJkc20iXSkpCiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHNpZCBvZiBvWyJkc20iXSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IG9iamVjdENsYXNzID0gcnVudGltZS5HZXRPYmplY3RDbGFzc0J5U0lEKHNpZCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKG9iamVjdENsYXNzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghc3cuX2R5bmFtaWNTb2xNb2RpZmllcnMpIHN3Ll9keW5hbWljU29sTW9kaWZpZXJzID0gbmV3IFNldDsKICAgICAgICAgICAgICAgICAgICAgICAgc3cuX2R5bmFtaWNTb2xNb2RpZmllcnMuYWRkKG9iamVjdENsYXNzKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yIChjb25zdCBbc2lkU3RyLCBzb2xEYXRhXSBvZiBPYmplY3QuZW50cmllcyhvWyJzb2xzIl0pKSB7CiAgICAgICAgICAgICAgICBjb25zdCBzaWQgPSBwYXJzZUludChzaWRTdHIsIDEwKTsKICAgICAgICAgICAgICAgIGNvbnN0IG9iamVjdENsYXNzID0gcnVudGltZS5HZXRPYmplY3RDbGFzc0J5U0lEKHNpZCk7CiAgICAgICAgICAgICAgICBpZiAoIW9iamVjdENsYXNzKSBjb250aW51ZTsKICAgICAgICAgICAgICAgIGNvbnN0IHNvbFN0YXRlID0gQzMuTmV3KEMzLlNvbFN0YXRlLAogICAgICAgICAgICAgICAgICAgIG51bGwpOwogICAgICAgICAgICAgICAgc29sU3RhdGUuX0xvYWRGcm9tSnNvbihldmVudFNoZWV0TWFuYWdlciwgc29sRGF0YSk7CiAgICAgICAgICAgICAgICBzdy5fc29scy5zZXQob2JqZWN0Q2xhc3MsIHNvbFN0YXRlKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBzdwogICAgICAgIH0KICAgIH07Cgp9CgovLyBldmVudHMvc29sU3RhdGUuanMKewogICAgJ3VzZSBzdHJpY3QnOwogICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgQzMuU29sU3RhdGUgPSBjbGFzcyBTb2xTdGF0ZSBleHRlbmRzIEMzLkRlZmVuZGVkQmFzZSB7CiAgICAgICAgY29uc3RydWN0b3Ioc29sKSB7CiAgICAgICAgICAgIHN1cGVyKCk7CiAgICAgICAgICAgIHRoaXMuX29iamVjdENsYXNzID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5faXNTZWxlY3RBbGwgPSB0cnVlOwogICAgICAgICAgICB0aGlzLl9pbnN0YW5jZXMgPSBbXTsKICAgICAgICAgICAgaWYgKHNvbCkgewogICAgICAgICAgICAgICAgdGhpcy5fb2JqZWN0Q2xhc3MgPSBzb2wuR2V0T2JqZWN0Q2xhc3MoKTsKICAgICAgICAgICAgICAgIHRoaXMuX2lzU2VsZWN0QWxsID0gc29sLklzU2VsZWN0QWxsKCk7CiAgICAgICAgICAgICAgICBDMy5zaGFsbG93QXNzaWduQXJyYXkodGhpcy5faW5zdGFuY2VzLCBzb2wuX0dldE93bkluc3RhbmNlcygpKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIFJlbGVhc2UoKSB7CiAgICAgICAgICAgIHRoaXMuX29iamVjdENsYXNzID0gbnVsbDsKICAgICAgICAgICAgQzMuY2xlYXJBcnJheSh0aGlzLl9pbnN0YW5jZXMpCiAgICAgICAgfQogICAgICAgIF9SZXN0b3JlKHNvbCkgewogICAgICAgICAgICBzb2wuX1NldFNlbGVjdEFsbCh0aGlzLl9pc1NlbGVjdEFsbCk7CiAgICAgICAgICAgIEMzLnNoYWxsb3dBc3NpZ25BcnJheShzb2wuX0dldE93bkluc3RhbmNlcygpLCB0aGlzLl9pbnN0YW5jZXMpCiAgICAgICAgfQogICAgICAgIFJlbW92ZUluc3RhbmNlcyhzKSB7CiAgICAgICAgICAgIEMzLmFycmF5UmVtb3ZlQWxsSW5TZXQodGhpcy5faW5zdGFuY2VzLCBzKQogICAgICAgIH0KICAgICAgICBfU2F2ZVRvSnNvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICJzYSI6IHRoaXMuX2lzU2VsZWN0QWxsLAogICAgICAgICAgICAgICAgImluc3RzIjogdGhpcy5faW5zdGFuY2VzLm1hcChpbnN0ID0+IGluc3QuR2V0VUlEKCkpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgX0xvYWRGcm9tSnNvbihldmVudFNoZWV0TWFuYWdlciwgbykgewogICAgICAgICAgICBjb25zdCBydW50aW1lID0gZXZlbnRTaGVldE1hbmFnZXIuR2V0UnVudGltZSgpOwogICAgICAgICAgICB0aGlzLl9pc1NlbGVjdEFsbCA9ICEhb1sic2EiXTsKICAgICAgICAgICAgQzMuY2xlYXJBcnJheSh0aGlzLl9pbnN0YW5jZXMpOwogICAgICAgICAgICBmb3IgKGNvbnN0IHVpZCBvZiBvWyJpbnN0cyJdKSB7CiAgICAgICAgICAgICAgICBjb25zdCBpbnN0ID0gcnVudGltZS5HZXRJbnN0YW5jZUJ5VUlEKHVpZCk7CiAgICAgICAgICAgICAgICBpZiAoaW5zdCkgdGhpcy5faW5zdGFuY2VzLnB1c2goaW5zdCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07Cgp9CgovLyBzZGsvc2RrUGx1Z2luQmFzZS5qcwp7CiAgICAndXNlIHN0cmljdCc7CiAgICBjb25zdCBDMyA9IHNlbGYuQzM7CgogICAgZnVuY3Rpb24gR2V0TmV4dFBhcmFtTWFwKHBhcmFtTWFwLCBwYXJhbSkgewogICAgICAgIGxldCBuZXh0UGFyYW1NYXAgPSBwYXJhbU1hcC5nZXQocGFyYW0pOwogICAgICAgIGlmICghbmV4dFBhcmFtTWFwKSB7CiAgICAgICAgICAgIG5leHRQYXJhbU1hcCA9IG5ldyBNYXA7CiAgICAgICAgICAgIHBhcmFtTWFwLnNldChwYXJhbSwgbmV4dFBhcmFtTWFwKQogICAgICAgIH0KICAgICAgICByZXR1cm4gbmV4dFBhcmFtTWFwCiAgICB9CiAgICBDMy5TREtQbHVnaW5CYXNlID0gY2xhc3MgU0RLUGx1Z2luQmFzZSBleHRlbmRzIEMzLkRlZmVuZGVkQmFzZSB7CiAgICAgICAgY29uc3RydWN0b3Iob3B0cykgewogICAgICAgICAgICBzdXBlcigpOwogICAgICAgICAgICB0aGlzLl9ydW50aW1lID0gb3B0cy5ydW50aW1lOwogICAgICAgICAgICB0aGlzLl9pc1NpbmdsZUdsb2JhbCA9ICEhb3B0cy5pc1NpbmdsZUdsb2JhbDsKICAgICAgICAgICAgdGhpcy5faXNXb3JsZFR5cGUgPSAhIW9wdHMuaXNXb3JsZDsKICAgICAgICAgICAgdGhpcy5faXNSb3RhdGFibGUgPSAhIW9wdHMuaXNSb3RhdGFibGU7CiAgICAgICAgICAgIHRoaXMuX211c3RQcmVkcmF3ID0gISFvcHRzLm11c3RQcmVkcmF3OwogICAgICAgICAgICB0aGlzLl9oYXNFZmZlY3RzID0gISFvcHRzLmhhc0VmZmVjdHM7CiAgICAgICAgICAgIHRoaXMuX3N1cHBvcnRzU2NlbmVHcmFwaCA9ICEhb3B0cy5zdXBwb3J0c1NjZW5lR3JhcGg7CiAgICAgICAgICAgIHRoaXMuX3N1cHBvcnRzTWVzaCA9ICEhb3B0cy5zdXBwb3J0c01lc2g7CiAgICAgICAgICAgIHRoaXMuX3NpbmdsZUdsb2JhbE9iamVjdENsYXNzID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fYm91bmRBQ0VNZXRob2RDYWNoZSA9IG5ldyBNYXA7CiAgICAgICAgICAgIHRoaXMuX2JvdW5kQUNFTWV0aG9kQ2FjaGVfMXBhcmFtID0gbmV3IE1hcDsKICAgICAgICAgICAgdGhpcy5fYm91bmRBQ0VNZXRob2RDYWNoZV8ycGFyYW1zID0KICAgICAgICAgICAgICAgIG5ldyBNYXA7CiAgICAgICAgICAgIHRoaXMuX2JvdW5kQUNFTWV0aG9kQ2FjaGVfM3BhcmFtcyA9IG5ldyBNYXAKICAgICAgICB9CiAgICAgICAgUmVsZWFzZSgpIHsKICAgICAgICAgICAgdGhpcy5fcnVudGltZSA9IG51bGwKICAgICAgICB9CiAgICAgICAgR2V0UnVudGltZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUKICAgICAgICB9CiAgICAgICAgT25DcmVhdGUoKSB7fQogICAgICAgIElzU2luZ2xlR2xvYmFsKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faXNTaW5nbGVHbG9iYWwKICAgICAgICB9CiAgICAgICAgSXNXb3JsZFR5cGUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pc1dvcmxkVHlwZQogICAgICAgIH0KICAgICAgICBJc1JvdGF0YWJsZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2lzUm90YXRhYmxlCiAgICAgICAgfQogICAgICAgIE11c3RQcmVEcmF3KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fbXVzdFByZWRyYXcKICAgICAgICB9CiAgICAgICAgSGFzRWZmZWN0cygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2hhc0VmZmVjdHMKICAgICAgICB9CiAgICAgICAgU3VwcG9ydHNTY2VuZUdyYXBoKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fc3VwcG9ydHNTY2VuZUdyYXBoCiAgICAgICAgfQogICAgICAgIFN1cHBvcnRzTWVzaCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3N1cHBvcnRzTWVzaAogICAgICAgIH0KICAgICAgICBfR2V0Qm91bmRBQ0VNZXRob2QoZnVuYywgYmluZFRoaXMpIHsKICAgICAgICAgICAgaWYgKCFiaW5kVGhpcykgdGhyb3cgbmV3IEVycm9yKCJtaXNzaW5nICd0aGlzJyBiaW5kaW5nIik7CiAgICAgICAgICAgIGxldCByZXQgPSB0aGlzLl9ib3VuZEFDRU1ldGhvZENhY2hlLmdldChmdW5jKTsKICAgICAgICAgICAgaWYgKHJldCkgcmV0dXJuIHJldDsKICAgICAgICAgICAgcmV0ID0gZnVuYy5iaW5kKGJpbmRUaGlzKTsKICAgICAgICAgICAgdGhpcy5fYm91bmRBQ0VNZXRob2RDYWNoZS5zZXQoZnVuYywgcmV0KTsKICAgICAgICAgICAgcmV0dXJuIHJldAogICAgICAgIH0KICAgICAgICBfR2V0Qm91bmRBQ0VNZXRob2RfMXBhcmFtKGZ1bmMsIGJpbmRUaGlzLCBwYXJhbTApIHsKICAgICAgICAgICAgaWYgKCFiaW5kVGhpcykgdGhyb3cgbmV3IEVycm9yKCJtaXNzaW5nICd0aGlzJyBiaW5kaW5nIik7CiAgICAgICAgICAgIGNvbnN0IHBhcmFtMG1hcCA9IEdldE5leHRQYXJhbU1hcCh0aGlzLl9ib3VuZEFDRU1ldGhvZENhY2hlXzFwYXJhbSwgZnVuYyk7CiAgICAgICAgICAgIGxldCByZXQgPSBwYXJhbTBtYXAuZ2V0KHBhcmFtMCk7CiAgICAgICAgICAgIGlmIChyZXQpIHJldHVybiByZXQ7CiAgICAgICAgICAgIHJldCA9IGZ1bmMuYmluZChiaW5kVGhpcywgcGFyYW0wKTsKICAgICAgICAgICAgcGFyYW0wbWFwLnNldChwYXJhbTAsIHJldCk7CiAgICAgICAgICAgIHJldHVybiByZXQKICAgICAgICB9CiAgICAgICAgX0dldEJvdW5kQUNFTWV0aG9kXzJwYXJhbXMoZnVuYywgYmluZFRoaXMsIHBhcmFtMCwgcGFyYW0xKSB7CiAgICAgICAgICAgIGlmICghYmluZFRoaXMpIHRocm93IG5ldyBFcnJvcigibWlzc2luZyAndGhpcycgYmluZGluZyIpOwogICAgICAgICAgICBjb25zdCBwYXJhbTBtYXAgPSBHZXROZXh0UGFyYW1NYXAodGhpcy5fYm91bmRBQ0VNZXRob2RDYWNoZV8ycGFyYW1zLCBmdW5jKTsKICAgICAgICAgICAgY29uc3QgcGFyYW0xbWFwID0gR2V0TmV4dFBhcmFtTWFwKHBhcmFtMG1hcCwgcGFyYW0wKTsKICAgICAgICAgICAgbGV0IHJldCA9IHBhcmFtMW1hcC5nZXQocGFyYW0xKTsKICAgICAgICAgICAgaWYgKHJldCkgcmV0dXJuIHJldDsKICAgICAgICAgICAgcmV0ID0gZnVuYy5iaW5kKGJpbmRUaGlzLCBwYXJhbTAsIHBhcmFtMSk7CiAgICAgICAgICAgIHBhcmFtMW1hcC5zZXQocGFyYW0xLCByZXQpOwogICAgICAgICAgICByZXR1cm4gcmV0CiAgICAgICAgfQogICAgICAgIF9HZXRCb3VuZEFDRU1ldGhvZF8zcGFyYW1zKGZ1bmMsIGJpbmRUaGlzLCBwYXJhbTAsIHBhcmFtMSwgcGFyYW0yKSB7CiAgICAgICAgICAgIGlmICghYmluZFRoaXMpIHRocm93IG5ldyBFcnJvcigibWlzc2luZyAndGhpcycgYmluZGluZyIpOwogICAgICAgICAgICBjb25zdCBwYXJhbTBtYXAgPSBHZXROZXh0UGFyYW1NYXAodGhpcy5fYm91bmRBQ0VNZXRob2RDYWNoZV8zcGFyYW1zLCBmdW5jKTsKICAgICAgICAgICAgY29uc3QgcGFyYW0xbWFwID0gR2V0TmV4dFBhcmFtTWFwKHBhcmFtMG1hcCwgcGFyYW0wKTsKICAgICAgICAgICAgY29uc3QgcGFyYW0ybWFwID0KICAgICAgICAgICAgICAgIEdldE5leHRQYXJhbU1hcChwYXJhbTFtYXAsIHBhcmFtMSk7CiAgICAgICAgICAgIGxldCByZXQgPSBwYXJhbTJtYXAuZ2V0KHBhcmFtMik7CiAgICAgICAgICAgIGlmIChyZXQpIHJldHVybiByZXQ7CiAgICAgICAgICAgIHJldCA9IGZ1bmMuYmluZChiaW5kVGhpcywgcGFyYW0wLCBwYXJhbTEsIHBhcmFtMik7CiAgICAgICAgICAgIHBhcmFtMm1hcC5zZXQocGFyYW0yLCByZXQpOwogICAgICAgICAgICByZXR1cm4gcmV0CiAgICAgICAgfQogICAgICAgIF9TZXRTaW5nbGVHbG9iYWxPYmplY3RDbGFzcyhvYmplY3RDbGFzcykgewogICAgICAgICAgICBpZiAoIXRoaXMuSXNTaW5nbGVHbG9iYWwoKSkgdGhyb3cgbmV3IEVycm9yKCJtdXN0IGJlIHNpbmdsZS1nbG9iYWwgcGx1Z2luIik7CiAgICAgICAgICAgIHRoaXMuX3NpbmdsZUdsb2JhbE9iamVjdENsYXNzID0gb2JqZWN0Q2xhc3MKICAgICAgICB9CiAgICAgICAgR2V0U2luZ2xlR2xvYmFsT2JqZWN0Q2xhc3MoKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5Jc1NpbmdsZUdsb2JhbCgpKSB0aHJvdyBuZXcgRXJyb3IoIm11c3QgYmUgc2luZ2xlLWdsb2JhbCBwbHVnaW4iKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NpbmdsZUdsb2JhbE9iamVjdENsYXNzCiAgICAgICAgfQogICAgICAgIEdldFNpbmdsZUdsb2JhbEluc3RhbmNlKCkgewogICAgICAgICAgICBpZiAoIXRoaXMuSXNTaW5nbGVHbG9iYWwoKSkgdGhyb3cgbmV3IEVycm9yKCJtdXN0IGJlIHNpbmdsZS1nbG9iYWwgcGx1Z2luIik7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zaW5nbGVHbG9iYWxPYmplY3RDbGFzcy5HZXRTaW5nbGVHbG9iYWxJbnN0YW5jZSgpCiAgICAgICAgfQogICAgfTsKCn0KCi8vIHNkay9zZGtET01QbHVnaW5CYXNlLmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIEMzLlNES0RPTVBsdWdpbkJhc2UgPSBjbGFzcyBTREtET01QbHVnaW5CYXNlIGV4dGVuZHMgQzMuU0RLUGx1Z2luQmFzZSB7CiAgICAgICAgY29uc3RydWN0b3Iob3B0cywgRE9NX0NPTVBPTkVOVF9JRCkgewogICAgICAgICAgICBzdXBlcihvcHRzKTsKICAgICAgICAgICAgdGhpcy5fZG9tQ29tcG9uZW50SWQgPSBET01fQ09NUE9ORU5UX0lEOwogICAgICAgICAgICB0aGlzLl9uZXh0RWxlbWVudElkID0gMDsKICAgICAgICAgICAgdGhpcy5faW5zdE1hcCA9IG5ldyBNYXA7CiAgICAgICAgICAgIHRoaXMuQWRkRWxlbWVudE1lc3NhZ2VIYW5kbGVyKCJlbGVtLWZvY3VzZWQiLCBzZGtJbnN0ID0+IHNka0luc3QuX09uRWxlbUZvY3VzZWQoKSk7CiAgICAgICAgICAgIHRoaXMuQWRkRWxlbWVudE1lc3NhZ2VIYW5kbGVyKCJlbGVtLWJsdXJyZWQiLCBzZGtJbnN0ID0+IHsKICAgICAgICAgICAgICAgIGlmIChzZGtJbnN0KSBzZGtJbnN0Ll9PbkVsZW1CbHVycmVkKCkKICAgICAgICAgICAgfSkKICAgICAgICB9CiAgICAgICAgUmVsZWFzZSgpIHsKICAgICAgICAgICAgc3VwZXIuUmVsZWFzZSgpCiAgICAgICAgfQogICAgICAgIF9BZGRFbGVtZW50KHNka0luc3QpIHsKICAgICAgICAgICAgY29uc3QgZWxlbWVudElkID0gdGhpcy5fbmV4dEVsZW1lbnRJZCsrOwogICAgICAgICAgICB0aGlzLl9pbnN0TWFwLnNldChlbGVtZW50SWQsIHNka0luc3QpOwogICAgICAgICAgICByZXR1cm4gZWxlbWVudElkCiAgICAgICAgfQogICAgICAgIF9SZW1vdmVFbGVtZW50KGVsZW1lbnRJZCkgewogICAgICAgICAgICB0aGlzLl9pbnN0TWFwLmRlbGV0ZShlbGVtZW50SWQpCiAgICAgICAgfQogICAgICAgIEFkZEVsZW1lbnRNZXNzYWdlSGFuZGxlcihoYW5kbGVyLAogICAgICAgICAgICBmdW5jKSB7CiAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuQWRkRE9NQ29tcG9uZW50TWVzc2FnZUhhbmRsZXIodGhpcy5fZG9tQ29tcG9uZW50SWQsIGhhbmRsZXIsIGUgPT4gewogICAgICAgICAgICAgICAgY29uc3Qgc2RrSW5zdCA9IHRoaXMuX2luc3RNYXAuZ2V0KGVbImVsZW1lbnRJZCJdKTsKICAgICAgICAgICAgICAgIGZ1bmMoc2RrSW5zdCwgZSkKICAgICAgICAgICAgfSkKICAgICAgICB9CiAgICB9OwoKfQoKLy8gc2RrL3Nka1R5cGVCYXNlLmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIEMzLlNES1R5cGVCYXNlID0gY2xhc3MgU0RLVHlwZUJhc2UgZXh0ZW5kcyBDMy5EZWZlbmRlZEJhc2UgewogICAgICAgIGNvbnN0cnVjdG9yKG9iamVjdENsYXNzKSB7CiAgICAgICAgICAgIHN1cGVyKCk7CiAgICAgICAgICAgIHRoaXMuX29iamVjdENsYXNzID0gb2JqZWN0Q2xhc3M7CiAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUgPSBvYmplY3RDbGFzcy5HZXRSdW50aW1lKCk7CiAgICAgICAgICAgIHRoaXMuX3BsdWdpbiA9IG9iamVjdENsYXNzLkdldFBsdWdpbigpCiAgICAgICAgfQogICAgICAgIFJlbGVhc2UoKSB7CiAgICAgICAgICAgIHRoaXMuX29iamVjdENsYXNzID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fcnVudGltZSA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3BsdWdpbiA9IG51bGwKICAgICAgICB9CiAgICAgICAgR2V0T2JqZWN0Q2xhc3MoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9vYmplY3RDbGFzcwogICAgICAgIH0KICAgICAgICBHZXRSdW50aW1lKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fcnVudGltZQogICAgICAgIH0KICAgICAgICBHZXRQbHVnaW4oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9wbHVnaW4KICAgICAgICB9CiAgICAgICAgR2V0SW1hZ2VJbmZvKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fb2JqZWN0Q2xhc3MuR2V0SW1hZ2VJbmZvKCkKICAgICAgICB9CiAgICAgICAgT25DcmVhdGUoKSB7fQogICAgICAgIEZpbmlzaENvbmRpdGlvbihmKSB7fQogICAgICAgIEJlZm9yZVJ1bkFjdGlvbihtZXRob2QpIHt9CiAgICAgICAgQWZ0ZXJSdW5BY3Rpb24obWV0aG9kKSB7fQogICAgICAgIExvYWRUZXh0dXJlcyhyZW5kZXJlcikge30KICAgICAgICBSZWxlYXNlVGV4dHVyZXMoKSB7fQogICAgICAgIE9uRHluYW1pY1RleHR1cmVMb2FkQ29tcGxldGUoKSB7fQogICAgICAgIFByZWxvYWRUZXh0dXJlc1dpdGhJbnN0YW5jZXMocmVuZGVyZXIpIHt9CiAgICAgICAgTG9hZFRpbGVtYXBEYXRhKCkge30KICAgICAgICBHZXRTY3JpcHRJbnRlcmZhY2VDbGFzcygpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGwKICAgICAgICB9CiAgICAgICAgRGlzcGF0Y2hTY3JpcHRFdmVudChuYW1lLCBjYW5jZWxhYmxlLAogICAgICAgICAgICBhZGRpdGlvbmFsUHJvcGVydGllcykgewogICAgICAgICAgICBjb25zdCBlID0gQzMuTmV3KEMzLkV2ZW50LCBuYW1lLCBjYW5jZWxhYmxlKTsKICAgICAgICAgICAgZS5vYmplY3RDbGFzcyA9IHRoaXM7CiAgICAgICAgICAgIGlmIChhZGRpdGlvbmFsUHJvcGVydGllcykgT2JqZWN0LmFzc2lnbihlLCBhZGRpdGlvbmFsUHJvcGVydGllcyk7CiAgICAgICAgICAgIHRoaXMuR2V0T2JqZWN0Q2xhc3MoKS5EaXNwYXRjaFVzZXJTY3JpcHRFdmVudChlKQogICAgICAgIH0KICAgIH07Cgp9CgovLyBzZGsvc2RrSW5zdGFuY2VCYXNlLmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIEMzLlNES0luc3RhbmNlQmFzZSA9IGNsYXNzIFNES0luc3RhbmNlQmFzZSBleHRlbmRzIEMzLkRlZmVuZGVkQmFzZSB7CiAgICAgICAgY29uc3RydWN0b3IoaW5zdCwgZG9tQ29tcG9uZW50SWQpIHsKICAgICAgICAgICAgc3VwZXIoKTsKICAgICAgICAgICAgdGhpcy5faW5zdCA9IGluc3Q7CiAgICAgICAgICAgIHRoaXMuX2RvbUNvbXBvbmVudElkID0gZG9tQ29tcG9uZW50SWQ7CiAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUgPSBpbnN0LkdldFJ1bnRpbWUoKTsKICAgICAgICAgICAgdGhpcy5fb2JqZWN0Q2xhc3MgPSB0aGlzLl9pbnN0LkdldE9iamVjdENsYXNzKCk7CiAgICAgICAgICAgIHRoaXMuX3Nka1R5cGUgPSB0aGlzLl9vYmplY3RDbGFzcy5HZXRTZGtUeXBlKCk7CiAgICAgICAgICAgIHRoaXMuX3RpY2tGdW5jID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fdGljazJGdW5jID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5faXNUaWNraW5nID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX2lzVGlja2luZzIgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5fZGlzcG9zYWJsZXMgPSBudWxsOwogICAgICAgICAgICB0aGlzLl93YXNSZWxlYXNlZCA9IGZhbHNlCiAgICAgICAgfQogICAgICAgIFJlbGVhc2UoKSB7CiAgICAgICAgICAgIHRoaXMuX3dhc1JlbGVhc2VkID0gdHJ1ZTsKICAgICAgICAgICAgdGhpcy5fU3RvcFRpY2tpbmcoKTsKICAgICAgICAgICAgdGhpcy5fU3RvcFRpY2tpbmcyKCk7CiAgICAgICAgICAgIHRoaXMuX3RpY2tGdW5jID0KICAgICAgICAgICAgICAgIG51bGw7CiAgICAgICAgICAgIHRoaXMuX3RpY2syRnVuYyA9IG51bGw7CiAgICAgICAgICAgIGlmICh0aGlzLl9kaXNwb3NhYmxlcykgewogICAgICAgICAgICAgICAgdGhpcy5fZGlzcG9zYWJsZXMuUmVsZWFzZSgpOwogICAgICAgICAgICAgICAgdGhpcy5fZGlzcG9zYWJsZXMgPSBudWxsCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5faW5zdCA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9vYmplY3RDbGFzcyA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3Nka1R5cGUgPSBudWxsCiAgICAgICAgfQogICAgICAgIFdhc1JlbGVhc2VkKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fd2FzUmVsZWFzZWQKICAgICAgICB9CiAgICAgICAgR2V0SW5zdGFuY2UoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pbnN0CiAgICAgICAgfQogICAgICAgIEdldFJ1bnRpbWUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lCiAgICAgICAgfQogICAgICAgIEdldE9iamVjdENsYXNzKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fb2JqZWN0Q2xhc3MKICAgICAgICB9CiAgICAgICAgR2V0UGx1Z2luKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fc2RrVHlwZS5HZXRQbHVnaW4oKQogICAgICAgIH0KICAgICAgICBHZXRTZGtUeXBlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fc2RrVHlwZQogICAgICAgIH0KICAgICAgICBHZXRTY3JpcHRJbnRlcmZhY2UoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pbnN0LkdldEludGVyZmFjZUNsYXNzKCkKICAgICAgICB9CiAgICAgICAgVHJpZ2dlcihtZXRob2QpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUuVHJpZ2dlcihtZXRob2QsCiAgICAgICAgICAgICAgICB0aGlzLl9pbnN0LCBudWxsKQogICAgICAgIH0KICAgICAgICBEZWJ1Z1RyaWdnZXIobWV0aG9kKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lLkRlYnVnVHJpZ2dlcihtZXRob2QsIHRoaXMuX2luc3QsIG51bGwpCiAgICAgICAgfQogICAgICAgIFRyaWdnZXJBc3luYyhtZXRob2QpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUuVHJpZ2dlckFzeW5jKG1ldGhvZCwgdGhpcy5faW5zdCwgbnVsbCkKICAgICAgICB9CiAgICAgICAgRmFzdFRyaWdnZXIobWV0aG9kLCB2YWx1ZSkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fcnVudGltZS5GYXN0VHJpZ2dlcihtZXRob2QsIHRoaXMuX2luc3QsIHZhbHVlKQogICAgICAgIH0KICAgICAgICBEZWJ1Z0Zhc3RUcmlnZ2VyKG1ldGhvZCwgdmFsdWUpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUuRGVidWdGYXN0VHJpZ2dlcihtZXRob2QsIHRoaXMuX2luc3QsIHZhbHVlKQogICAgICAgIH0KICAgICAgICBTY2hlZHVsZVRyaWdnZXJzKGYpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUuU2NoZWR1bGVUcmlnZ2VycyhmKQogICAgICAgIH0KICAgICAgICBBZGRET01NZXNzYWdlSGFuZGxlcihoYW5kbGVyLCBmdW5jKSB7CiAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuQWRkRE9NQ29tcG9uZW50TWVzc2FnZUhhbmRsZXIodGhpcy5fZG9tQ29tcG9uZW50SWQsCiAgICAgICAgICAgICAgICBoYW5kbGVyLCBmdW5jKQogICAgICAgIH0KICAgICAgICBBZGRET01NZXNzYWdlSGFuZGxlcnMobGlzdCkgewogICAgICAgICAgICBmb3IgKGNvbnN0IFtoYW5kbGVyLCBmdW5jXSBvZiBsaXN0KSB0aGlzLkFkZERPTU1lc3NhZ2VIYW5kbGVyKGhhbmRsZXIsIGZ1bmMpCiAgICAgICAgfQogICAgICAgIFBvc3RUb0RPTShoYW5kbGVyLCBkYXRhKSB7CiAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuUG9zdENvbXBvbmVudE1lc3NhZ2VUb0RPTSh0aGlzLl9kb21Db21wb25lbnRJZCwgaGFuZGxlciwgZGF0YSkKICAgICAgICB9CiAgICAgICAgUG9zdFRvRE9NQXN5bmMoaGFuZGxlciwgZGF0YSkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fcnVudGltZS5Qb3N0Q29tcG9uZW50TWVzc2FnZVRvRE9NQXN5bmModGhpcy5fZG9tQ29tcG9uZW50SWQsIGhhbmRsZXIsIGRhdGEpCiAgICAgICAgfQogICAgICAgIF9Qb3N0VG9ET01NYXliZVN5bmMoaGFuZGxlciwgZGF0YSkgewogICAgICAgICAgICBpZiAodGhpcy5fcnVudGltZS5Jc0luV29ya2VyKCkpIHRoaXMuUG9zdFRvRE9NKGhhbmRsZXIsIGRhdGEpOwogICAgICAgICAgICBlbHNlIHJldHVybiB3aW5kb3dbImMzX3J1bnRpbWVJbnRlcmZhY2UiXVsiX09uTWVzc2FnZUZyb21SdW50aW1lIl0oewogICAgICAgICAgICAgICAgInR5cGUiOiAiZXZlbnQiLAogICAgICAgICAgICAgICAgImNvbXBvbmVudCI6IHRoaXMuX2RvbUNvbXBvbmVudElkLAogICAgICAgICAgICAgICAgImhhbmRsZXIiOiBoYW5kbGVyLAogICAgICAgICAgICAgICAgImRhdGEiOiBkYXRhLAogICAgICAgICAgICAgICAgInJlc3BvbnNlSWQiOiBudWxsCiAgICAgICAgICAgIH0pCiAgICAgICAgfQogICAgICAgIFRpY2soKSB7fQogICAgICAgIFRpY2syKCkge30KICAgICAgICBfU3RhcnRUaWNraW5nKCkgewogICAgICAgICAgICBpZiAodGhpcy5faXNUaWNraW5nKSByZXR1cm47CiAgICAgICAgICAgIGlmICghdGhpcy5fdGlja0Z1bmMpIHRoaXMuX3RpY2tGdW5jID0gKCkgPT4gdGhpcy5UaWNrKCk7CiAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuRGlzcGF0Y2hlcigpLmFkZEV2ZW50TGlzdGVuZXIoInRpY2siLCB0aGlzLl90aWNrRnVuYyk7CiAgICAgICAgICAgIHRoaXMuX2lzVGlja2luZyA9IHRydWUKICAgICAgICB9CiAgICAgICAgX1N0b3BUaWNraW5nKCkgewogICAgICAgICAgICBpZiAoIXRoaXMuX2lzVGlja2luZykgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl9ydW50aW1lLkRpc3BhdGNoZXIoKS5yZW1vdmVFdmVudExpc3RlbmVyKCJ0aWNrIiwgdGhpcy5fdGlja0Z1bmMpOwogICAgICAgICAgICB0aGlzLl9pc1RpY2tpbmcgPSBmYWxzZQogICAgICAgIH0KICAgICAgICBJc1RpY2tpbmcoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pc1RpY2tpbmcKICAgICAgICB9CiAgICAgICAgX1N0YXJ0VGlja2luZzIoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9pc1RpY2tpbmcyKSByZXR1cm47CiAgICAgICAgICAgIGlmICghdGhpcy5fdGljazJGdW5jKSB0aGlzLl90aWNrMkZ1bmMgPQogICAgICAgICAgICAgICAgKCkgPT4gdGhpcy5UaWNrMigpOwogICAgICAgICAgICB0aGlzLl9ydW50aW1lLkRpc3BhdGNoZXIoKS5hZGRFdmVudExpc3RlbmVyKCJ0aWNrMiIsIHRoaXMuX3RpY2syRnVuYyk7CiAgICAgICAgICAgIHRoaXMuX2lzVGlja2luZzIgPSB0cnVlCiAgICAgICAgfQogICAgICAgIF9TdG9wVGlja2luZzIoKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5faXNUaWNraW5nMikgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl9ydW50aW1lLkRpc3BhdGNoZXIoKS5yZW1vdmVFdmVudExpc3RlbmVyKCJ0aWNrMiIsIHRoaXMuX3RpY2syRnVuYyk7CiAgICAgICAgICAgIHRoaXMuX2lzVGlja2luZzIgPSBmYWxzZQogICAgICAgIH0KICAgICAgICBJc1RpY2tpbmcyKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faXNUaWNraW5nMgogICAgICAgIH0KICAgICAgICBHZXREZWJ1Z2dlclByb3BlcnRpZXMoKSB7CiAgICAgICAgICAgIHJldHVybiBbXQogICAgICAgIH0KICAgICAgICBTYXZlVG9Kc29uKCkgewogICAgICAgICAgICByZXR1cm4gbnVsbAogICAgICAgIH0KICAgICAgICBMb2FkRnJvbUpzb24obykge30KICAgICAgICBHZXRQcm9wZXJ0eVZhbHVlQnlJbmRleChpbmRleCkge30KICAgICAgICBTZXRQcm9wZXJ0eVZhbHVlQnlJbmRleChpbmRleCwgdmFsdWUpIHt9CiAgICAgICAgT2Zmc2V0UHJvcGVydHlWYWx1ZUJ5SW5kZXgoaW5kZXgsIG9mZnNldCwgb3B0cykgewogICAgICAgICAgICBpZiAob2Zmc2V0ID09PSAwKSByZXR1cm47CiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0KICAgICAgICAgICAgICAgIHRoaXMuR2V0UHJvcGVydHlWYWx1ZUJ5SW5kZXgoaW5kZXgpOwogICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlICE9PSAibnVtYmVyIikgdGhyb3cgbmV3IEVycm9yKCJleHBlY3RlZCBudW1iZXIiKTsKICAgICAgICAgICAgdGhpcy5TZXRQcm9wZXJ0eVZhbHVlQnlJbmRleChpbmRleCwgdmFsdWUgKyBvZmZzZXQsIG9wdHMpCiAgICAgICAgfQogICAgICAgIFNldFByb3BlcnR5Q29sb3JPZmZzZXRWYWx1ZUJ5SW5kZXgob2Zmc2V0LCByLCBnLCBiKSB7fQogICAgICAgIENhbGxBY3Rpb24oYWN0TWV0aG9kLCAuLi5hcmdzKSB7CiAgICAgICAgICAgIGFjdE1ldGhvZC5jYWxsKHRoaXMsIC4uLmFyZ3MpCiAgICAgICAgfQogICAgICAgIENhbGxFeHByZXNzaW9uKGV4cE1ldGhvZCwgLi4uYXJncykgewogICAgICAgICAgICByZXR1cm4gZXhwTWV0aG9kLmNhbGwodGhpcywgLi4uYXJncykKICAgICAgICB9CiAgICAgICAgR2V0U2NyaXB0SW50ZXJmYWNlQ2xhc3MoKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsCiAgICAgICAgfQogICAgICAgIERpc3BhdGNoU2NyaXB0RXZlbnQobmFtZSwgY2FuY2VsYWJsZSwgYWRkaXRpb25hbFByb3BlcnRpZXMpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLl9pbnN0Lkhhc1NjcmlwdEludGVyZmFjZSgpKSByZXR1cm47CiAgICAgICAgICAgIGNvbnN0IHNjcmlwdEludGVyZmFjZSA9IHRoaXMuR2V0U2NyaXB0SW50ZXJmYWNlKCk7CiAgICAgICAgICAgIGNvbnN0IGUgPSBDMy5OZXcoQzMuRXZlbnQsIG5hbWUsIGNhbmNlbGFibGUpOwogICAgICAgICAgICBlLmluc3RhbmNlID0gc2NyaXB0SW50ZXJmYWNlOwogICAgICAgICAgICBpZiAoYWRkaXRpb25hbFByb3BlcnRpZXMpIE9iamVjdC5hc3NpZ24oZSwgYWRkaXRpb25hbFByb3BlcnRpZXMpOwogICAgICAgICAgICBzY3JpcHRJbnRlcmZhY2UuZGlzcGF0Y2hFdmVudChlKQogICAgICAgIH0KICAgIH07Cgp9CgovLyBzZGsvc2RrV29ybGRJbnN0YW5jZUJhc2UuanMKewogICAgJ3VzZSBzdHJpY3QnOwogICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgQzMuU0RLV29ybGRJbnN0YW5jZUJhc2UgPSBjbGFzcyBTREtXb3JsZEluc3RhbmNlQmFzZSBleHRlbmRzIEMzLlNES0luc3RhbmNlQmFzZSB7CiAgICAgICAgY29uc3RydWN0b3IoaW5zdCwgZG9tQ29tcG9uZW50SWQpIHsKICAgICAgICAgICAgc3VwZXIoaW5zdCwgZG9tQ29tcG9uZW50SWQpOwogICAgICAgICAgICB0aGlzLl93b3JsZEluZm8gPSBpbnN0LkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICB0aGlzLl9yZW5kZXJlcmNvbnRleHRsb3N0X2hhbmRsZXIgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9yZW5kZXJlcmNvbnRleHRyZXN0b3JlZF9oYW5kbGVyID0gbnVsbAogICAgICAgIH0KICAgICAgICBSZWxlYXNlKCkgewogICAgICAgICAgICBpZiAodGhpcy5fcmVuZGVyZXJjb250ZXh0bG9zdF9oYW5kbGVyKSB7CiAgICAgICAgICAgICAgICBjb25zdCBkaXNwYXRjaGVyID0gdGhpcy5fcnVudGltZS5EaXNwYXRjaGVyKCk7CiAgICAgICAgICAgICAgICBkaXNwYXRjaGVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoInJlbmRlcmVyY29udGV4dGxvc3QiLCB0aGlzLl9yZW5kZXJlcmNvbnRleHRsb3N0X2hhbmRsZXIpOwogICAgICAgICAgICAgICAgZGlzcGF0Y2hlci5yZW1vdmVFdmVudExpc3RlbmVyKCJyZW5kZXJlcmNvbnRleHRyZXN0b3JlZCIsIHRoaXMuX3JlbmRlcmVyY29udGV4dHJlc3RvcmVkX2hhbmRsZXIpOwogICAgICAgICAgICAgICAgdGhpcy5fcmVuZGVyZXJjb250ZXh0bG9zdF9oYW5kbGVyID0gbnVsbDsKICAgICAgICAgICAgICAgIHRoaXMuX3JlbmRlcmVyY29udGV4dHJlc3RvcmVkX2hhbmRsZXIgPSBudWxsCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5fd29ybGRJbmZvID0gbnVsbDsKICAgICAgICAgICAgc3VwZXIuUmVsZWFzZSgpCiAgICAgICAgfQogICAgICAgIEhhbmRsZVdlYkdMQ29udGV4dExvc3MoKSB7CiAgICAgICAgICAgIHRoaXMuSGFuZGxlUmVuZGVyZXJDb250ZXh0TG9zcygpCiAgICAgICAgfQogICAgICAgIE9uV2ViR0xDb250ZXh0TG9zdCgpIHt9CiAgICAgICAgT25XZWJHTENvbnRleHRSZXN0b3JlZCgpIHt9CiAgICAgICAgSGFuZGxlUmVuZGVyZXJDb250ZXh0TG9zcygpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX3JlbmRlcmVyY29udGV4dGxvc3RfaGFuZGxlcikgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl9yZW5kZXJlcmNvbnRleHRsb3N0X2hhbmRsZXIgPSAoKSA9PiB0aGlzLk9uUmVuZGVyZXJDb250ZXh0TG9zdCgpOwogICAgICAgICAgICB0aGlzLl9yZW5kZXJlcmNvbnRleHRyZXN0b3JlZF9oYW5kbGVyID0gKCkgPT4gdGhpcy5PblJlbmRlcmVyQ29udGV4dFJlc3RvcmVkKCk7CiAgICAgICAgICAgIGNvbnN0IGRpc3BhdGNoZXIgPSB0aGlzLl9ydW50aW1lLkRpc3BhdGNoZXIoKTsKICAgICAgICAgICAgZGlzcGF0Y2hlci5hZGRFdmVudExpc3RlbmVyKCJyZW5kZXJlcm9udGV4dGxvc3QiLAogICAgICAgICAgICAgICAgdGhpcy5fcmVuZGVyZXJjb250ZXh0bG9zdF9oYW5kbGVyKTsKICAgICAgICAgICAgZGlzcGF0Y2hlci5hZGRFdmVudExpc3RlbmVyKCJyZW5kZXJlcmNvbnRleHRyZXN0b3JlZCIsIHRoaXMuX3JlbmRlcmVyY29udGV4dHJlc3RvcmVkX2hhbmRsZXIpCiAgICAgICAgfQogICAgICAgIE9uUmVuZGVyZXJDb250ZXh0TG9zdCgpIHsKICAgICAgICAgICAgdGhpcy5PbldlYkdMQ29udGV4dExvc3QoKQogICAgICAgIH0KICAgICAgICBPblJlbmRlcmVyQ29udGV4dFJlc3RvcmVkKCkgewogICAgICAgICAgICB0aGlzLk9uV2ViR0xDb250ZXh0UmVzdG9yZWQoKQogICAgICAgIH0KICAgICAgICBHZXRXb3JsZEluZm8oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl93b3JsZEluZm8KICAgICAgICB9CiAgICAgICAgSXNPcmlnaW5hbFNpemVLbm93bigpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgfQogICAgICAgIEdldE9yaWdpbmFsV2lkdGgoKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5Jc09yaWdpbmFsU2l6ZUtub3duKCkpIHRocm93IG5ldyBFcnJvcigib3JpZ2luYWwgc2l6ZSBub3Qga25vd24iKTsKICAgICAgICAgICAgY29uc3QgaW1hZ2VJbmZvID0gdGhpcy5HZXRDdXJyZW50SW1hZ2VJbmZvKCk7CiAgICAgICAgICAgIGlmIChpbWFnZUluZm8pIHJldHVybiBpbWFnZUluZm8uR2V0V2lkdGgoKTsKICAgICAgICAgICAgZWxzZTsKICAgICAgICB9CiAgICAgICAgR2V0T3JpZ2luYWxIZWlnaHQoKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5Jc09yaWdpbmFsU2l6ZUtub3duKCkpIHRocm93IG5ldyBFcnJvcigib3JpZ2luYWwgc2l6ZSBub3Qga25vd24iKTsKICAgICAgICAgICAgY29uc3QgaW1hZ2VJbmZvID0gdGhpcy5HZXRDdXJyZW50SW1hZ2VJbmZvKCk7CiAgICAgICAgICAgIGlmIChpbWFnZUluZm8pIHJldHVybiBpbWFnZUluZm8uR2V0SGVpZ2h0KCk7CiAgICAgICAgICAgIGVsc2U7CiAgICAgICAgfQogICAgICAgIEdldEN1cnJlbnRJbWFnZUluZm8oKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsCiAgICAgICAgfQogICAgICAgIEdldEN1cnJlbnRTdXJmYWNlU2l6ZSgpIHsKICAgICAgICAgICAgY29uc3QgaW1hZ2VJbmZvID0gdGhpcy5HZXRDdXJyZW50SW1hZ2VJbmZvKCk7CiAgICAgICAgICAgIGlmIChpbWFnZUluZm8pIHsKICAgICAgICAgICAgICAgIGNvbnN0IHRleHR1cmUgPSBpbWFnZUluZm8uR2V0VGV4dHVyZSgpOwogICAgICAgICAgICAgICAgaWYgKHRleHR1cmUpIHJldHVybiBbdGV4dHVyZS5HZXRXaWR0aCgpLCB0ZXh0dXJlLkdldEhlaWdodCgpXQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBbMTAwLCAxMDBdCiAgICAgICAgfQogICAgICAgIEdldEN1cnJlbnRUZXhSZWN0KCkgewogICAgICAgICAgICBjb25zdCBpbWFnZUluZm8gPSB0aGlzLkdldEN1cnJlbnRJbWFnZUluZm8oKTsKICAgICAgICAgICAgcmV0dXJuIGltYWdlSW5mbyA/IGltYWdlSW5mby5HZXRUZXhSZWN0KCkgOiBudWxsCiAgICAgICAgfQogICAgICAgIEdldEN1cnJlbnRUZXhRdWFkKCkgewogICAgICAgICAgICBjb25zdCBpbWFnZUluZm8gPSB0aGlzLkdldEN1cnJlbnRJbWFnZUluZm8oKTsKICAgICAgICAgICAgcmV0dXJuIGltYWdlSW5mbyA/CiAgICAgICAgICAgICAgICBpbWFnZUluZm8uR2V0VGV4UXVhZCgpIDogbnVsbAogICAgICAgIH0KICAgICAgICBJc0N1cnJlbnRUZXhSb3RhdGVkKCkgewogICAgICAgICAgICBjb25zdCBpbWFnZUluZm8gPSB0aGlzLkdldEN1cnJlbnRJbWFnZUluZm8oKTsKICAgICAgICAgICAgcmV0dXJuIGltYWdlSW5mbyA/IGltYWdlSW5mby5Jc1JvdGF0ZWQoKSA6IGZhbHNlCiAgICAgICAgfQogICAgICAgIEdldEltYWdlUG9pbnQobmFtZU9ySW5kZXgpIHsKICAgICAgICAgICAgY29uc3Qgd2kgPSB0aGlzLl9pbnN0LkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICByZXR1cm4gW3dpLkdldFgoKSwgd2kuR2V0WSgpLCB3aS5HZXRUb3RhbFpFbGV2YXRpb24oKV0KICAgICAgICB9CiAgICAgICAgTG9hZFRpbGVtYXBEYXRhKGRhdGEsIG1hcFdpZHRoLCBtYXBIZWlnaHQpIHt9CiAgICAgICAgVGVzdFBvaW50T3ZlcmxhcFRpbGUoeCwgeSkge30KICAgICAgICBSZW5kZXJzVG9Pd25aUGxhbmUoKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgfQogICAgfTsKCn0KCi8vIHNkay9zZGtET01JbnN0YW5jZUJhc2UuanMKewogICAgJ3VzZSBzdHJpY3QnOwogICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgY29uc3QgdGVtcFJlY3QgPSBDMy5OZXcoQzMuUmVjdCk7CiAgICBDMy5TREtET01JbnN0YW5jZUJhc2UgPSBjbGFzcyBTREtET01JbnN0YW5jZUJhc2UgZXh0ZW5kcyBDMy5TREtXb3JsZEluc3RhbmNlQmFzZSB7CiAgICAgICAgY29uc3RydWN0b3IoaW5zdCwgZG9tQ29tcG9uZW50SWQpIHsKICAgICAgICAgICAgc3VwZXIoaW5zdCwgZG9tQ29tcG9uZW50SWQpOwogICAgICAgICAgICB0aGlzLl9lbGVtZW50SWQgPSB0aGlzLkdldFBsdWdpbigpLl9BZGRFbGVtZW50KHRoaXMpOwogICAgICAgICAgICB0aGlzLl9pc0VsZW1lbnRTaG93aW5nID0gdHJ1ZTsKICAgICAgICAgICAgdGhpcy5fZWxlbUhhc0ZvY3VzID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX2F1dG9Gb250U2l6ZSA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl9hdXRvRm9udFNpemVPZmZzZXQgPSAtLjI7CiAgICAgICAgICAgIHRoaXMuX2xhc3RSZWN0ID0gQzMuTmV3KEMzLlJlY3QsIDAsIDAsIC0xLCAtMSk7CiAgICAgICAgICAgIGNvbnN0IGNhbnZhc01hbmFnZXIgPSB0aGlzLl9ydW50aW1lLkdldENhbnZhc01hbmFnZXIoKTsKICAgICAgICAgICAgdGhpcy5fbGFzdFdpbmRvd1dpZHRoID0gY2FudmFzTWFuYWdlci5HZXRMYXN0V2lkdGgoKTsKICAgICAgICAgICAgdGhpcy5fbGFzdFdpbmRvd0hlaWdodCA9IGNhbnZhc01hbmFnZXIuR2V0TGFzdEhlaWdodCgpOwogICAgICAgICAgICB0aGlzLl9pc1BlbmRpbmdVcGRhdGVTdGF0ZSA9CiAgICAgICAgICAgICAgICBmYWxzZTsKICAgICAgICAgICAgdGhpcy5fU3RhcnRUaWNraW5nKCkKICAgICAgICB9CiAgICAgICAgUmVsZWFzZSgpIHsKICAgICAgICAgICAgdGhpcy5HZXRQbHVnaW4oKS5fUmVtb3ZlRWxlbWVudCh0aGlzLl9lbGVtZW50SWQpOwogICAgICAgICAgICB0aGlzLlBvc3RUb0RPTUVsZW1lbnQoImRlc3Ryb3kiKTsKICAgICAgICAgICAgdGhpcy5fZWxlbWVudElkID0gLTE7CiAgICAgICAgICAgIHN1cGVyLlJlbGVhc2UoKQogICAgICAgIH0KICAgICAgICBfR2V0RWxlbWVudEluRE9NTW9kZSgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX3J1bnRpbWUuSXNJbldvcmtlcigpKSB0aHJvdyBuZXcgRXJyb3IoIm5vdCB2YWxpZCBpbiB3b3JrZXIgbW9kZSIpOwogICAgICAgICAgICByZXR1cm4gdGhpcy5fUG9zdFRvRE9NRWxlbWVudE1heWJlU3luYygiZ2V0LWVsZW1lbnQiKQogICAgICAgIH0KICAgICAgICBQb3N0VG9ET01FbGVtZW50KGhhbmRsZXIsIGRhdGEpIHsKICAgICAgICAgICAgaWYgKCFkYXRhKSBkYXRhID0ge307CiAgICAgICAgICAgIGRhdGFbImVsZW1lbnRJZCJdID0gdGhpcy5fZWxlbWVudElkOwogICAgICAgICAgICB0aGlzLlBvc3RUb0RPTShoYW5kbGVyLCBkYXRhKQogICAgICAgIH0KICAgICAgICBfUG9zdFRvRE9NRWxlbWVudE1heWJlU3luYyhoYW5kbGVyLCBkYXRhKSB7CiAgICAgICAgICAgIGlmICghZGF0YSkgZGF0YSA9IHt9OwogICAgICAgICAgICBkYXRhWyJlbGVtZW50SWQiXSA9IHRoaXMuX2VsZW1lbnRJZDsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX1Bvc3RUb0RPTU1heWJlU3luYyhoYW5kbGVyLCBkYXRhKQogICAgICAgIH0KICAgICAgICBQb3N0VG9ET01FbGVtZW50QXN5bmMoaGFuZGxlciwgZGF0YSkgewogICAgICAgICAgICBpZiAoIWRhdGEpIGRhdGEgPSB7fTsKICAgICAgICAgICAgZGF0YVsiZWxlbWVudElkIl0gPSB0aGlzLl9lbGVtZW50SWQ7CiAgICAgICAgICAgIHJldHVybiB0aGlzLlBvc3RUb0RPTUFzeW5jKGhhbmRsZXIsIGRhdGEpCiAgICAgICAgfQogICAgICAgIENyZWF0ZUVsZW1lbnQoZGF0YSkgewogICAgICAgICAgICBpZiAoIWRhdGEpIGRhdGEgPSB7fTsKICAgICAgICAgICAgY29uc3QgaXNWaXNpYmxlID0gdGhpcy5HZXRXb3JsZEluZm8oKS5Jc1Zpc2libGUoKTsKICAgICAgICAgICAgZGF0YVsiZWxlbWVudElkIl0gPSB0aGlzLl9lbGVtZW50SWQ7CiAgICAgICAgICAgIGRhdGFbImlzVmlzaWJsZSJdID0gaXNWaXNpYmxlOwogICAgICAgICAgICBPYmplY3QuYXNzaWduKGRhdGEsIHRoaXMuR2V0RWxlbWVudFN0YXRlKCkpOwogICAgICAgICAgICB0aGlzLl9pc0VsZW1lbnRTaG93aW5nID0gISFkYXRhWyJpc1Zpc2libGUiXTsKICAgICAgICAgICAgdGhpcy5fUG9zdFRvRE9NTWF5YmVTeW5jKCJjcmVhdGUiLCBkYXRhKTsKICAgICAgICAgICAgdGhpcy5fVXBkYXRlUG9zaXRpb24odHJ1ZSkKICAgICAgICB9CiAgICAgICAgU2V0RWxlbWVudFZpc2libGUodikgewogICAgICAgICAgICB2ID0gISF2OwogICAgICAgICAgICBpZiAodGhpcy5faXNFbGVtZW50U2hvd2luZyA9PT0gdikgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl9pc0VsZW1lbnRTaG93aW5nID0gdjsKICAgICAgICAgICAgdGhpcy5Qb3N0VG9ET01FbGVtZW50KCJzZXQtdmlzaWJsZSIsIHsKICAgICAgICAgICAgICAgICJpc1Zpc2libGUiOiB2CiAgICAgICAgICAgIH0pCiAgICAgICAgfQogICAgICAgIFRpY2soKSB7CiAgICAgICAgICAgIHRoaXMuX1VwZGF0ZVBvc2l0aW9uKGZhbHNlKQogICAgICAgIH0KICAgICAgICBfU2hvdWxkUHJlc2VydmVFbGVtZW50KCkgewogICAgICAgICAgICBjb25zdCBmdWxsc2NyZWVuTW9kZSA9IHRoaXMuX3J1bnRpbWUuR2V0Q2FudmFzTWFuYWdlcigpLkdldEZ1bGxzY3JlZW5Nb2RlKCk7CiAgICAgICAgICAgIHJldHVybiBDMy5QbGF0Zm9ybS5PUyA9PT0gIkFuZHJvaWQiICYmIChmdWxsc2NyZWVuTW9kZSA9PT0gInNjYWxlLWlubmVyIiB8fCBmdWxsc2NyZWVuTW9kZSA9PT0gInNjYWxlLW91dGVyIiB8fCBmdWxsc2NyZWVuTW9kZSA9PT0gImNyb3AiKQogICAgICAgIH0KICAgICAgICBfVXBkYXRlUG9zaXRpb24oZmlyc3QpIHsKICAgICAgICAgICAgY29uc3Qgd2kgPSB0aGlzLkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICBjb25zdCBsYXllciA9IHdpLkdldExheWVyKCk7CiAgICAgICAgICAgIGNvbnN0IGJib3ggPSB3aS5HZXRCb3VuZGluZ0JveCgpOwogICAgICAgICAgICBsZXQgW2NsZWZ0LCBjdG9wXSA9IGxheWVyLkxheWVyVG9DYW52YXNDc3MoYmJveC5nZXRMZWZ0KCksCiAgICAgICAgICAgICAgICBiYm94LmdldFRvcCgpKTsKICAgICAgICAgICAgbGV0IFtjcmlnaHQsIGNib3R0b21dID0gbGF5ZXIuTGF5ZXJUb0NhbnZhc0NzcyhiYm94LmdldFJpZ2h0KCksIGJib3guZ2V0Qm90dG9tKCkpOwogICAgICAgICAgICBjb25zdCBjYW52YXNNYW5hZ2VyID0gdGhpcy5fcnVudGltZS5HZXRDYW52YXNNYW5hZ2VyKCk7CiAgICAgICAgICAgIGNvbnN0IHJpZ2h0RWRnZSA9IGNhbnZhc01hbmFnZXIuR2V0Q3NzV2lkdGgoKTsKICAgICAgICAgICAgY29uc3QgYm90dG9tRWRnZSA9IGNhbnZhc01hbmFnZXIuR2V0Q3NzSGVpZ2h0KCk7CiAgICAgICAgICAgIGlmICghd2kuSXNWaXNpYmxlKCkgfHwgIWxheWVyLklzVmlzaWJsZSgpKSB7CiAgICAgICAgICAgICAgICB0aGlzLlNldEVsZW1lbnRWaXNpYmxlKGZhbHNlKTsKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghdGhpcy5fU2hvdWxkUHJlc2VydmVFbGVtZW50KCkpIHsKICAgICAgICAgICAgICAgIGlmIChjcmlnaHQgPD0gMCB8fCBjYm90dG9tIDw9IDAgfHwgY2xlZnQgPj0gcmlnaHRFZGdlIHx8IGN0b3AgPj0gYm90dG9tRWRnZSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuU2V0RWxlbWVudFZpc2libGUoZmFsc2UpOwogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGNsZWZ0IDwgMSkgY2xlZnQgPSAxOwogICAgICAgICAgICAgICAgaWYgKGN0b3AgPCAxKSBjdG9wID0gMTsKICAgICAgICAgICAgICAgIGlmIChjcmlnaHQgPj0gcmlnaHRFZGdlKSBjcmlnaHQgPQogICAgICAgICAgICAgICAgICAgIHJpZ2h0RWRnZSAtIDE7CiAgICAgICAgICAgICAgICBpZiAoY2JvdHRvbSA+PSBib3R0b21FZGdlKSBjYm90dG9tID0gYm90dG9tRWRnZSAtIDEKICAgICAgICAgICAgfQogICAgICAgICAgICB0ZW1wUmVjdC5zZXQoY2xlZnQsIGN0b3AsIGNyaWdodCwgY2JvdHRvbSk7CiAgICAgICAgICAgIGNvbnN0IGN1cldpbldpZHRoID0gY2FudmFzTWFuYWdlci5HZXRMYXN0V2lkdGgoKTsKICAgICAgICAgICAgY29uc3QgY3VyV2luSGVpZ2h0ID0gY2FudmFzTWFuYWdlci5HZXRMYXN0SGVpZ2h0KCk7CiAgICAgICAgICAgIGlmICghZmlyc3QgJiYgdGVtcFJlY3QuZXF1YWxzKHRoaXMuX2xhc3RSZWN0KSAmJiB0aGlzLl9sYXN0V2luZG93V2lkdGggPT09IGN1cldpbldpZHRoICYmIHRoaXMuX2xhc3RXaW5kb3dIZWlnaHQgPT09IGN1cldpbkhlaWdodCkgewogICAgICAgICAgICAgICAgdGhpcy5TZXRFbGVtZW50VmlzaWJsZSh0cnVlKTsKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuX2xhc3RSZWN0LmNvcHkodGVtcFJlY3QpOwogICAgICAgICAgICB0aGlzLl9sYXN0V2luZG93V2lkdGggPSBjdXJXaW5XaWR0aDsKICAgICAgICAgICAgdGhpcy5fbGFzdFdpbmRvd0hlaWdodCA9IGN1cldpbkhlaWdodDsKICAgICAgICAgICAgdGhpcy5TZXRFbGVtZW50VmlzaWJsZSh0cnVlKTsKICAgICAgICAgICAgbGV0IGZvbnRTaXplID0gbnVsbDsKICAgICAgICAgICAgaWYgKHRoaXMuX2F1dG9Gb250U2l6ZSkgZm9udFNpemUgPQogICAgICAgICAgICAgICAgbGF5ZXIuR2V0RGlzcGxheVNjYWxlKCkgKyB0aGlzLl9hdXRvRm9udFNpemVPZmZzZXQ7CiAgICAgICAgICAgIHRoaXMuUG9zdFRvRE9NRWxlbWVudCgidXBkYXRlLXBvc2l0aW9uIiwgewogICAgICAgICAgICAgICAgImxlZnQiOiBNYXRoLnJvdW5kKHRoaXMuX2xhc3RSZWN0LmdldExlZnQoKSkgKyBjYW52YXNNYW5hZ2VyLkdldENhbnZhc0NsaWVudFgoKSwKICAgICAgICAgICAgICAgICJ0b3AiOiBNYXRoLnJvdW5kKHRoaXMuX2xhc3RSZWN0LmdldFRvcCgpKSArIGNhbnZhc01hbmFnZXIuR2V0Q2FudmFzQ2xpZW50WSgpLAogICAgICAgICAgICAgICAgIndpZHRoIjogTWF0aC5yb3VuZCh0aGlzLl9sYXN0UmVjdC53aWR0aCgpKSwKICAgICAgICAgICAgICAgICJoZWlnaHQiOiBNYXRoLnJvdW5kKHRoaXMuX2xhc3RSZWN0LmhlaWdodCgpKSwKICAgICAgICAgICAgICAgICJmb250U2l6ZSI6IGZvbnRTaXplCiAgICAgICAgICAgIH0pCiAgICAgICAgfQogICAgICAgIEZvY3VzRWxlbWVudCgpIHsKICAgICAgICAgICAgdGhpcy5fUG9zdFRvRE9NRWxlbWVudE1heWJlU3luYygiZm9jdXMiLCB7CiAgICAgICAgICAgICAgICAiZm9jdXMiOiB0cnVlCiAgICAgICAgICAgIH0pCiAgICAgICAgfQogICAgICAgIEJsdXJFbGVtZW50KCkgewogICAgICAgICAgICB0aGlzLl9Qb3N0VG9ET01FbGVtZW50TWF5YmVTeW5jKCJmb2N1cyIsIHsKICAgICAgICAgICAgICAgICJmb2N1cyI6IGZhbHNlCiAgICAgICAgICAgIH0pCiAgICAgICAgfQogICAgICAgIF9PbkVsZW1Gb2N1c2VkKCkgewogICAgICAgICAgICB0aGlzLl9lbGVtSGFzRm9jdXMgPQogICAgICAgICAgICAgICAgdHJ1ZQogICAgICAgIH0KICAgICAgICBfT25FbGVtQmx1cnJlZCgpIHsKICAgICAgICAgICAgdGhpcy5fZWxlbUhhc0ZvY3VzID0gZmFsc2UKICAgICAgICB9CiAgICAgICAgSXNFbGVtZW50Rm9jdXNlZCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2VsZW1IYXNGb2N1cwogICAgICAgIH0KICAgICAgICBTZXRFbGVtZW50Q1NTU3R5bGUocHJvcCwgdmFsKSB7CiAgICAgICAgICAgIHRoaXMuUG9zdFRvRE9NRWxlbWVudCgic2V0LWNzcy1zdHlsZSIsIHsKICAgICAgICAgICAgICAgICJwcm9wIjogQzMuQ1NTVG9DYW1lbENhc2UocHJvcCksCiAgICAgICAgICAgICAgICAidmFsIjogdmFsCiAgICAgICAgICAgIH0pCiAgICAgICAgfQogICAgICAgIFNldEVsZW1lbnRBdHRyaWJ1dGUoYXR0cmliTmFtZSwgdmFsdWUpIHsKICAgICAgICAgICAgdGhpcy5Qb3N0VG9ET01FbGVtZW50KCJzZXQtYXR0cmlidXRlIiwgewogICAgICAgICAgICAgICAgIm5hbWUiOiBhdHRyaWJOYW1lLAogICAgICAgICAgICAgICAgInZhbCI6IHZhbHVlCiAgICAgICAgICAgIH0pCiAgICAgICAgfQogICAgICAgIFJlbW92ZUVsZW1lbnRBdHRyaWJ1dGUoYXR0cmliTmFtZSkgewogICAgICAgICAgICB0aGlzLlBvc3RUb0RPTUVsZW1lbnQoInJlbW92ZS1hdHRyaWJ1dGUiLCB7CiAgICAgICAgICAgICAgICAibmFtZSI6IGF0dHJpYk5hbWUKICAgICAgICAgICAgfSkKICAgICAgICB9CiAgICAgICAgVXBkYXRlRWxlbWVudFN0YXRlKCkgewogICAgICAgICAgICBpZiAodGhpcy5faXNQZW5kaW5nVXBkYXRlU3RhdGUpIHJldHVybjsKICAgICAgICAgICAgdGhpcy5faXNQZW5kaW5nVXBkYXRlU3RhdGUgPSB0cnVlOwogICAgICAgICAgICBQcm9taXNlLnJlc29sdmUoKS50aGVuKCgpID0+IHsKICAgICAgICAgICAgICAgIHRoaXMuX2lzUGVuZGluZ1VwZGF0ZVN0YXRlID0gZmFsc2U7CiAgICAgICAgICAgICAgICB0aGlzLlBvc3RUb0RPTUVsZW1lbnQoInVwZGF0ZS1zdGF0ZSIsIHRoaXMuR2V0RWxlbWVudFN0YXRlKCkpCiAgICAgICAgICAgIH0pCiAgICAgICAgfQogICAgICAgIEdldEVsZW1lbnRTdGF0ZSgpIHt9CiAgICAgICAgR2V0RWxlbWVudElkKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZWxlbWVudElkCiAgICAgICAgfQogICAgfTsKCn0KCi8vIHNkay9zZGtCZWhhdmlvckJhc2UuanMKewogICAgJ3VzZSBzdHJpY3QnOwogICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgY29uc3QgSUJlaGF2aW9yID0gc2VsZi5JQmVoYXZpb3I7CiAgICBDMy5TREtCZWhhdmlvckJhc2UgPSBjbGFzcyBTREtCZWhhdmlvckJhc2UgZXh0ZW5kcyBDMy5EZWZlbmRlZEJhc2UgewogICAgICAgIGNvbnN0cnVjdG9yKG9wdHMpIHsKICAgICAgICAgICAgc3VwZXIoKTsKICAgICAgICAgICAgdGhpcy5fcnVudGltZSA9IG9wdHMucnVudGltZTsKICAgICAgICAgICAgdGhpcy5fbXlPYmplY3RDbGFzc2VzID0gQzMuTmV3KEMzLkFycmF5U2V0KTsKICAgICAgICAgICAgdGhpcy5fbXlJbnN0YW5jZXMgPSBDMy5OZXcoQzMuQXJyYXlTZXQpOwogICAgICAgICAgICB0aGlzLl9pQmVoYXZpb3IgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9zY3JpcHRJbnRlcmZhY2VDbGFzcyA9IG9wdHMuc2NyaXB0SW50ZXJmYWNlQ2xhc3MgfHwgbnVsbAogICAgICAgIH0KICAgICAgICBSZWxlYXNlKCkgewogICAgICAgICAgICB0aGlzLl9teUluc3RhbmNlcy5SZWxlYXNlKCk7CiAgICAgICAgICAgIHRoaXMuX215T2JqZWN0Q2xhc3Nlcy5SZWxlYXNlKCk7CiAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUgPSBudWxsCiAgICAgICAgfQogICAgICAgIEdldFJ1bnRpbWUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lCiAgICAgICAgfQogICAgICAgIE9uQ3JlYXRlKCkge30KICAgICAgICBfQWRkT2JqZWN0Q2xhc3Mob2JqZWN0Q2xhc3MpIHsKICAgICAgICAgICAgdGhpcy5fbXlPYmplY3RDbGFzc2VzLkFkZChvYmplY3RDbGFzcykKICAgICAgICB9CiAgICAgICAgR2V0T2JqZWN0Q2xhc3NlcygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX215T2JqZWN0Q2xhc3Nlcy5HZXRBcnJheSgpCiAgICAgICAgfQogICAgICAgIF9BZGRJbnN0YW5jZShpbnN0KSB7CiAgICAgICAgICAgIHRoaXMuX215SW5zdGFuY2VzLkFkZChpbnN0KQogICAgICAgIH0KICAgICAgICBfUmVtb3ZlSW5zdGFuY2UoaW5zdCkgewogICAgICAgICAgICB0aGlzLl9teUluc3RhbmNlcy5EZWxldGUoaW5zdCkKICAgICAgICB9CiAgICAgICAgR2V0SW5zdGFuY2VzKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fbXlJbnN0YW5jZXMuR2V0QXJyYXkoKQogICAgICAgIH0KICAgICAgICBHZXRJQmVoYXZpb3IoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9pQmVoYXZpb3IgPT09IG51bGwpIHsKICAgICAgICAgICAgICAgIGNvbnN0IEN1c3RvbVNjcmlwdENsYXNzID0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9zY3JpcHRJbnRlcmZhY2VDbGFzczsKICAgICAgICAgICAgICAgIGlmIChDdXN0b21TY3JpcHRDbGFzcykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX2lCZWhhdmlvciA9IG5ldyBDdXN0b21TY3JpcHRDbGFzcyh0aGlzKTsKICAgICAgICAgICAgICAgICAgICBpZiAoISh0aGlzLl9pQmVoYXZpb3IgaW5zdGFuY2VvZiBJQmVoYXZpb3IpKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJzY3JpcHQgaW50ZXJmYWNlIGNsYXNzIG11c3QgZGVyaXZlIGZyb20gSUJlaGF2aW9yIik7CiAgICAgICAgICAgICAgICB9IGVsc2UgdGhpcy5faUJlaGF2aW9yID0gbmV3IElCZWhhdmlvcih0aGlzKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pQmVoYXZpb3IKICAgICAgICB9CiAgICB9OwoKfQoKLy8gc2RrL3Nka0JlaGF2aW9yVHlwZUJhc2UuanMKewogICAgJ3VzZSBzdHJpY3QnOwogICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgQzMuU0RLQmVoYXZpb3JUeXBlQmFzZSA9IGNsYXNzIFNES0JlaGF2aW9yVHlwZUJhc2UgZXh0ZW5kcyBDMy5EZWZlbmRlZEJhc2UgewogICAgICAgIGNvbnN0cnVjdG9yKGJlaGF2aW9yVHlwZSkgewogICAgICAgICAgICBzdXBlcigpOwogICAgICAgICAgICB0aGlzLl9ydW50aW1lID0gYmVoYXZpb3JUeXBlLkdldFJ1bnRpbWUoKTsKICAgICAgICAgICAgdGhpcy5fYmVoYXZpb3JUeXBlID0gYmVoYXZpb3JUeXBlOwogICAgICAgICAgICB0aGlzLl9vYmplY3RDbGFzcyA9IGJlaGF2aW9yVHlwZS5HZXRPYmplY3RDbGFzcygpOwogICAgICAgICAgICB0aGlzLl9iZWhhdmlvciA9IGJlaGF2aW9yVHlwZS5HZXRCZWhhdmlvcigpOwogICAgICAgICAgICB0aGlzLl9iZWhhdmlvci5fQWRkT2JqZWN0Q2xhc3ModGhpcy5fb2JqZWN0Q2xhc3MpCiAgICAgICAgfQogICAgICAgIFJlbGVhc2UoKSB7CiAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9iZWhhdmlvclR5cGUgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9vYmplY3RDbGFzcyA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX2JlaGF2aW9yID0gbnVsbAogICAgICAgIH0KICAgICAgICBPbkNyZWF0ZSgpIHt9CiAgICAgICAgR2V0QmVoYXZpb3JUeXBlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fYmVoYXZpb3JUeXBlCiAgICAgICAgfQogICAgICAgIEdldE9iamVjdENsYXNzKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fb2JqZWN0Q2xhc3MKICAgICAgICB9CiAgICAgICAgR2V0UnVudGltZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUKICAgICAgICB9CiAgICAgICAgR2V0QmVoYXZpb3IoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9iZWhhdmlvcgogICAgICAgIH0KICAgIH07Cgp9CgovLyBzZGsvc2RrQmVoYXZpb3JJbnN0YW5jZUJhc2UuanMKewogICAgJ3VzZSBzdHJpY3QnOwogICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgQzMuU0RLQmVoYXZpb3JJbnN0YW5jZUJhc2UgPSBjbGFzcyBTREtCZWhhdmlvckluc3RhbmNlQmFzZSBleHRlbmRzIEMzLkRlZmVuZGVkQmFzZSB7CiAgICAgICAgY29uc3RydWN0b3IoYmVoSW5zdCwgZG9tQ29tcG9uZW50SWQpIHsKICAgICAgICAgICAgc3VwZXIoKTsKICAgICAgICAgICAgdGhpcy5fYmVoSW5zdCA9IGJlaEluc3Q7CiAgICAgICAgICAgIHRoaXMuX2RvbUNvbXBvbmVudElkID0gZG9tQ29tcG9uZW50SWQ7CiAgICAgICAgICAgIHRoaXMuX2luc3QgPSBiZWhJbnN0LkdldE9iamVjdEluc3RhbmNlKCk7CiAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUgPSBiZWhJbnN0LkdldFJ1bnRpbWUoKTsKICAgICAgICAgICAgdGhpcy5fYmVoYXZpb3JUeXBlID0gYmVoSW5zdC5HZXRCZWhhdmlvclR5cGUoKTsKICAgICAgICAgICAgdGhpcy5fc2RrVHlwZSA9IHRoaXMuX2JlaGF2aW9yVHlwZS5HZXRTZGtUeXBlKCk7CiAgICAgICAgICAgIHRoaXMuX2lzVGlja2luZyA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl9pc1RpY2tpbmcyID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX2lzUG9zdFRpY2tpbmcgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5fZGlzcG9zYWJsZXMgPSBudWxsCiAgICAgICAgfQogICAgICAgIFJlbGVhc2UoKSB7CiAgICAgICAgICAgIHRoaXMuX1N0b3BUaWNraW5nKCk7CiAgICAgICAgICAgIHRoaXMuX1N0b3BUaWNraW5nMigpOwogICAgICAgICAgICB0aGlzLl9TdG9wUG9zdFRpY2tpbmcoKTsKICAgICAgICAgICAgaWYgKHRoaXMuX2Rpc3Bvc2FibGVzKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9kaXNwb3NhYmxlcy5SZWxlYXNlKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9kaXNwb3NhYmxlcyA9IG51bGwKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLl9iZWhJbnN0ID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5faW5zdCA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9iZWhhdmlvclR5cGUgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9zZGtUeXBlID0gbnVsbAogICAgICAgIH0KICAgICAgICBHZXRCZWhhdmlvcigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2JlaGF2aW9yVHlwZS5HZXRCZWhhdmlvcigpCiAgICAgICAgfQogICAgICAgIEdldEJlaGF2aW9ySW5zdGFuY2UoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9iZWhJbnN0CiAgICAgICAgfQogICAgICAgIEdldE9iamVjdEluc3RhbmNlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faW5zdAogICAgICAgIH0KICAgICAgICBHZXRPYmplY3RDbGFzcygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2luc3QuR2V0T2JqZWN0Q2xhc3MoKQogICAgICAgIH0KICAgICAgICBHZXRXb3JsZEluZm8oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pbnN0LkdldFdvcmxkSW5mbygpCiAgICAgICAgfQogICAgICAgIEdldFJ1bnRpbWUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lCiAgICAgICAgfQogICAgICAgIEdldEJlaGF2aW9yVHlwZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2JlaGF2aW9yVHlwZQogICAgICAgIH0KICAgICAgICBHZXRTZGtUeXBlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fc2RrVHlwZQogICAgICAgIH0KICAgICAgICBHZXRTY3JpcHRJbnRlcmZhY2UoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9iZWhJbnN0LkdldFNjcmlwdEludGVyZmFjZSgpCiAgICAgICAgfQogICAgICAgIFRyaWdnZXIobWV0aG9kKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lLlRyaWdnZXIobWV0aG9kLAogICAgICAgICAgICAgICAgdGhpcy5faW5zdCwgdGhpcy5fYmVoYXZpb3JUeXBlKQogICAgICAgIH0KICAgICAgICBEZWJ1Z1RyaWdnZXIobWV0aG9kKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lLkRlYnVnVHJpZ2dlcihtZXRob2QsIHRoaXMuX2luc3QsIHRoaXMuX2JlaGF2aW9yVHlwZSkKICAgICAgICB9CiAgICAgICAgVHJpZ2dlckFzeW5jKG1ldGhvZCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fcnVudGltZS5UcmlnZ2VyQXN5bmMobWV0aG9kLCB0aGlzLl9pbnN0LCB0aGlzLl9iZWhhdmlvclR5cGUpCiAgICAgICAgfQogICAgICAgIFBvc3RDcmVhdGUoKSB7fQogICAgICAgIFRpY2soKSB7fQogICAgICAgIFRpY2syKCkge30KICAgICAgICBQb3N0VGljaygpIHt9CiAgICAgICAgX1N0YXJ0VGlja2luZygpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX2lzVGlja2luZykgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl9ydW50aW1lLl9BZGRCZWhJbnN0VG9UaWNrKHRoaXMpOwogICAgICAgICAgICB0aGlzLl9pc1RpY2tpbmcgPSB0cnVlCiAgICAgICAgfQogICAgICAgIF9TdG9wVGlja2luZygpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLl9pc1RpY2tpbmcpIHJldHVybjsKICAgICAgICAgICAgdGhpcy5fcnVudGltZS5fUmVtb3ZlQmVoSW5zdFRvVGljayh0aGlzKTsKICAgICAgICAgICAgdGhpcy5faXNUaWNraW5nID0gZmFsc2UKICAgICAgICB9CiAgICAgICAgSXNUaWNraW5nKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faXNUaWNraW5nCiAgICAgICAgfQogICAgICAgIF9TdGFydFRpY2tpbmcyKCkgewogICAgICAgICAgICBpZiAodGhpcy5faXNUaWNraW5nMikgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl9ydW50aW1lLl9BZGRCZWhJbnN0VG9UaWNrMih0aGlzKTsKICAgICAgICAgICAgdGhpcy5faXNUaWNraW5nMiA9IHRydWUKICAgICAgICB9CiAgICAgICAgX1N0b3BUaWNraW5nMigpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLl9pc1RpY2tpbmcyKSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuX1JlbW92ZUJlaEluc3RUb1RpY2syKHRoaXMpOwogICAgICAgICAgICB0aGlzLl9pc1RpY2tpbmcyID0gZmFsc2UKICAgICAgICB9CiAgICAgICAgSXNUaWNraW5nMigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2lzVGlja2luZzIKICAgICAgICB9CiAgICAgICAgX1N0YXJ0UG9zdFRpY2tpbmcoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9pc1Bvc3RUaWNraW5nKSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuX0FkZEJlaEluc3RUb1Bvc3RUaWNrKHRoaXMpOwogICAgICAgICAgICB0aGlzLl9pc1Bvc3RUaWNraW5nID0gdHJ1ZQogICAgICAgIH0KICAgICAgICBfU3RvcFBvc3RUaWNraW5nKCkgewogICAgICAgICAgICBpZiAoIXRoaXMuX2lzUG9zdFRpY2tpbmcpIHJldHVybjsKICAgICAgICAgICAgdGhpcy5fcnVudGltZS5fUmVtb3ZlQmVoSW5zdFRvUG9zdFRpY2sodGhpcyk7CiAgICAgICAgICAgIHRoaXMuX2lzUG9zdFRpY2tpbmcgPSBmYWxzZQogICAgICAgIH0KICAgICAgICBJc1Bvc3RUaWNraW5nKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faXNQb3N0VGlja2luZwogICAgICAgIH0KICAgICAgICBHZXREZWJ1Z2dlclByb3BlcnRpZXMoKSB7CiAgICAgICAgICAgIHJldHVybiBbXQogICAgICAgIH0KICAgICAgICBBZGRET01NZXNzYWdlSGFuZGxlcihoYW5kbGVyLAogICAgICAgICAgICBmdW5jKSB7CiAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuQWRkRE9NQ29tcG9uZW50TWVzc2FnZUhhbmRsZXIodGhpcy5fZG9tQ29tcG9uZW50SWQsIGhhbmRsZXIsIGZ1bmMpCiAgICAgICAgfQogICAgICAgIE9uU3ByaXRlRnJhbWVDaGFuZ2VkKHByZXZGcmFtZSwgbmV4dEZyYW1lKSB7fQogICAgICAgIFNhdmVUb0pzb24oKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsCiAgICAgICAgfQogICAgICAgIExvYWRGcm9tSnNvbihvKSB7fQogICAgICAgIEdldFByb3BlcnR5VmFsdWVCeUluZGV4KGluZGV4KSB7fQogICAgICAgIFNldFByb3BlcnR5VmFsdWVCeUluZGV4KGluZGV4LCB2YWx1ZSkge30KICAgICAgICBPZmZzZXRQcm9wZXJ0eVZhbHVlQnlJbmRleChpbmRleCwgb2Zmc2V0KSB7CiAgICAgICAgICAgIGlmIChvZmZzZXQgPT09IDApIHJldHVybjsKICAgICAgICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLkdldFByb3BlcnR5VmFsdWVCeUluZGV4KGluZGV4KTsKICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gIm51bWJlciIpIHRocm93IG5ldyBFcnJvcigiZXhwZWN0ZWQgbnVtYmVyIik7CiAgICAgICAgICAgIHRoaXMuU2V0UHJvcGVydHlWYWx1ZUJ5SW5kZXgoaW5kZXgsIHZhbHVlICsgb2Zmc2V0KQogICAgICAgIH0KICAgICAgICBTZXRQcm9wZXJ0eUNvbG9yT2Zmc2V0VmFsdWVCeUluZGV4KGluZGV4LAogICAgICAgICAgICBvZmZzZXRSLCBvZmZzZXRHLCBvZmZzZXRCKSB7fQogICAgICAgIENhbGxBY3Rpb24oYWN0TWV0aG9kLCAuLi5hcmdzKSB7CiAgICAgICAgICAgIGFjdE1ldGhvZC5jYWxsKHRoaXMsIC4uLmFyZ3MpCiAgICAgICAgfQogICAgICAgIENhbGxFeHByZXNzaW9uKGV4cE1ldGhvZCwgLi4uYXJncykgewogICAgICAgICAgICByZXR1cm4gZXhwTWV0aG9kLmNhbGwodGhpcywgLi4uYXJncykKICAgICAgICB9CiAgICAgICAgR2V0U2NyaXB0SW50ZXJmYWNlQ2xhc3MoKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsCiAgICAgICAgfQogICAgICAgIERpc3BhdGNoU2NyaXB0RXZlbnQobmFtZSwgY2FuY2VsYWJsZSwgYWRkaXRpb25hbFByb3BlcnRpZXMpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLl9iZWhJbnN0Lkhhc1NjcmlwdEludGVyZmFjZSgpKSByZXR1cm47CiAgICAgICAgICAgIGNvbnN0IHNjcmlwdEludGVyZmFjZSA9IHRoaXMuR2V0U2NyaXB0SW50ZXJmYWNlKCk7CiAgICAgICAgICAgIGNvbnN0IGUgPSBDMy5OZXcoQzMuRXZlbnQsIG5hbWUsIGNhbmNlbGFibGUpOwogICAgICAgICAgICBlLmJlaGF2aW9ySW5zdGFuY2UgPSBzY3JpcHRJbnRlcmZhY2U7CiAgICAgICAgICAgIGUuaW5zdGFuY2UgPSBzY3JpcHRJbnRlcmZhY2UuaW5zdGFuY2U7CiAgICAgICAgICAgIGlmIChhZGRpdGlvbmFsUHJvcGVydGllcykgT2JqZWN0LmFzc2lnbihlLCBhZGRpdGlvbmFsUHJvcGVydGllcyk7CiAgICAgICAgICAgIHNjcmlwdEludGVyZmFjZS5kaXNwYXRjaEV2ZW50KGUpCiAgICAgICAgfQogICAgfTsKCn0KCi8vIG9iamVjdHMvcGx1Z2luTWFuYWdlci5qcwp7CiAgICAndXNlIHN0cmljdCc7CiAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICBDMy5QbHVnaW5zID0ge307CiAgICBDMy5CZWhhdmlvcnMgPSB7fTsKICAgIEMzLlBsdWdpbk1hbmFnZXIgPSBjbGFzcyBQbHVnaW5NYW5hZ2VyIGV4dGVuZHMgQzMuRGVmZW5kZWRCYXNlIHsKICAgICAgICBjb25zdHJ1Y3RvcihydW50aW1lKSB7CiAgICAgICAgICAgIHN1cGVyKCk7CiAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUgPSBydW50aW1lOwogICAgICAgICAgICB0aGlzLl9hbGxQbHVnaW5zID0gW107CiAgICAgICAgICAgIHRoaXMuX3BsdWdpbnNCeUN0b3IgPSBuZXcgTWFwOwogICAgICAgICAgICB0aGlzLl9zeXN0ZW1QbHVnaW4gPSBudWxsOwogICAgICAgICAgICB0aGlzLl9hbGxCZWhhdmlvcnMgPSBbXTsKICAgICAgICAgICAgdGhpcy5fYmVoYXZpb3JzQnlDdG9yID0gbmV3IE1hcDsKICAgICAgICAgICAgdGhpcy5fc29saWRCZWhhdmlvciA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX2p1bXB0aHJ1QmVoYXZpb3IgPSBudWxsCiAgICAgICAgfQogICAgICAgIENyZWF0ZVBsdWdpbihwbHVnaW5EYXRhKSB7CiAgICAgICAgICAgIGNvbnN0IEN0b3IgPSB0aGlzLl9ydW50aW1lLkdldE9iamVjdFJlZmVyZW5jZShwbHVnaW5EYXRhWzBdKTsKICAgICAgICAgICAgaWYgKCFDdG9yKSB0aHJvdyBuZXcgRXJyb3IoIm1pc3NpbmcgcGx1Z2luIik7CiAgICAgICAgICAgIEMzLkFkZENvbW1vbkFDRXMocGx1Z2luRGF0YSwgQ3Rvcik7CiAgICAgICAgICAgIGNvbnN0IHBsdWdpbiA9IEMzLk5ldyhDdG9yLCB7CiAgICAgICAgICAgICAgICBydW50aW1lOiB0aGlzLl9ydW50aW1lLAogICAgICAgICAgICAgICAgaXNTaW5nbGVHbG9iYWw6IHBsdWdpbkRhdGFbMV0sCiAgICAgICAgICAgICAgICBpc1dvcmxkOiBwbHVnaW5EYXRhWzJdLAogICAgICAgICAgICAgICAgaXNSb3RhdGFibGU6IHBsdWdpbkRhdGFbNV0sCiAgICAgICAgICAgICAgICBoYXNFZmZlY3RzOiBwbHVnaW5EYXRhWzhdLAogICAgICAgICAgICAgICAgbXVzdFByZWRyYXc6IHBsdWdpbkRhdGFbOV0sCiAgICAgICAgICAgICAgICBzdXBwb3J0c1NjZW5lR3JhcGg6IHBsdWdpbkRhdGFbMTNdLAogICAgICAgICAgICAgICAgc3VwcG9ydHNNZXNoOiBwbHVnaW5EYXRhWzE0XQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcGx1Z2luLk9uQ3JlYXRlKCk7CiAgICAgICAgICAgIHRoaXMuX2FsbFBsdWdpbnMucHVzaChwbHVnaW4pOwogICAgICAgICAgICB0aGlzLl9wbHVnaW5zQnlDdG9yLnNldChDdG9yLCBwbHVnaW4pCiAgICAgICAgfQogICAgICAgIENyZWF0ZVN5c3RlbVBsdWdpbigpIHsKICAgICAgICAgICAgdGhpcy5fc3lzdGVtUGx1Z2luID0gQzMuTmV3KEMzLlBsdWdpbnMuU3lzdGVtLCB7CiAgICAgICAgICAgICAgICBydW50aW1lOiB0aGlzLl9ydW50aW1lLAogICAgICAgICAgICAgICAgaXNTaW5nbGVHbG9iYWw6IHRydWUKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHRoaXMuX3N5c3RlbVBsdWdpbi5PbkNyZWF0ZSgpCiAgICAgICAgfQogICAgICAgIENyZWF0ZUJlaGF2aW9yKGJlaGF2aW9yRGF0YSkgewogICAgICAgICAgICBjb25zdCBDdG9yID0gdGhpcy5fcnVudGltZS5HZXRPYmplY3RSZWZlcmVuY2UoYmVoYXZpb3JEYXRhWzFdKTsKICAgICAgICAgICAgaWYgKCFDdG9yKSB0aHJvdyBuZXcgRXJyb3IoIm1pc3NpbmcgYmVoYXZpb3IiKTsKICAgICAgICAgICAgY29uc3QgYmVoYXZpb3IgPSBDMy5OZXcoQ3RvciwgewogICAgICAgICAgICAgICAgcnVudGltZTogdGhpcy5fcnVudGltZQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYmVoYXZpb3IuT25DcmVhdGUoKTsKICAgICAgICAgICAgdGhpcy5fYWxsQmVoYXZpb3JzLnB1c2goYmVoYXZpb3IpOwogICAgICAgICAgICB0aGlzLl9iZWhhdmlvcnNCeUN0b3Iuc2V0KEN0b3IsIGJlaGF2aW9yKTsKICAgICAgICAgICAgaWYgKCF0aGlzLl9zb2xpZEJlaGF2aW9yICYmIEMzLkJlaGF2aW9ycy5zb2xpZCAmJiBiZWhhdmlvciBpbnN0YW5jZW9mIEMzLkJlaGF2aW9ycy5zb2xpZCkgdGhpcy5fc29saWRCZWhhdmlvciA9IGJlaGF2aW9yOwogICAgICAgICAgICBlbHNlIGlmICghdGhpcy5fanVtcHRocnVCZWhhdmlvciAmJiBDMy5CZWhhdmlvcnMuanVtcHRocnUgJiYgYmVoYXZpb3IgaW5zdGFuY2VvZiBDMy5CZWhhdmlvcnMuanVtcHRocnUpIHRoaXMuX2p1bXB0aHJ1QmVoYXZpb3IgPSBiZWhhdmlvcgogICAgICAgIH0KICAgICAgICBHZXRQbHVnaW5CeUNvbnN0cnVjdG9yRnVuY3Rpb24oY3RvcikgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fcGx1Z2luc0J5Q3Rvci5nZXQoY3RvcikgfHwgbnVsbAogICAgICAgIH0KICAgICAgICBIYXNCZWhhdmlvckJ5Q29uc3RydWN0b3JGdW5jdGlvbihjdG9yKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9iZWhhdmlvcnNCeUN0b3IuaGFzKGN0b3IpCiAgICAgICAgfQogICAgICAgIEdldEJlaGF2aW9yQnlDb25zdHJ1Y3RvckZ1bmN0aW9uKGN0b3IpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2JlaGF2aW9yc0J5Q3Rvci5nZXQoY3RvcikgfHwKICAgICAgICAgICAgICAgIG51bGwKICAgICAgICB9CiAgICAgICAgR2V0U3lzdGVtUGx1Z2luKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fc3lzdGVtUGx1Z2luCiAgICAgICAgfQogICAgICAgIEdldFNvbGlkQmVoYXZpb3IoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zb2xpZEJlaGF2aW9yCiAgICAgICAgfQogICAgICAgIEdldEp1bXB0aHJ1QmVoYXZpb3IoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9qdW1wdGhydUJlaGF2aW9yCiAgICAgICAgfQogICAgfTsKCn0KCi8vIG9iamVjdHMvaW1hZ2VJbmZvLmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIGNvbnN0IGFsbEltYWdlSW5mb3MgPSBuZXcgU2V0OwogICAgQzMuSW1hZ2VJbmZvID0gY2xhc3MgSW1hZ2VJbmZvIGV4dGVuZHMgQzMuRGVmZW5kZWRCYXNlIHsKICAgICAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgICAgICAgc3VwZXIoKTsKICAgICAgICAgICAgdGhpcy5fZ2VuZXJhdGlvbiA9IDA7CiAgICAgICAgICAgIHRoaXMuX3VybCA9ICIiOwogICAgICAgICAgICB0aGlzLl9zaXplID0gMDsKICAgICAgICAgICAgdGhpcy5fb2Zmc2V0WCA9IDA7CiAgICAgICAgICAgIHRoaXMuX29mZnNldFkgPSAwOwogICAgICAgICAgICB0aGlzLl93aWR0aCA9IDA7CiAgICAgICAgICAgIHRoaXMuX2hlaWdodCA9IDA7CiAgICAgICAgICAgIHRoaXMuX2lzUm90YXRlZCA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl9oYXNNZXRhRGF0YSA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl9pbWFnZUFzc2V0ID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fdGV4dHVyZVN0YXRlID0gIiI7CiAgICAgICAgICAgIHRoaXMuX3JjVGV4ID0gQzMuTmV3KEMzLlJlY3QpOwogICAgICAgICAgICB0aGlzLl9xdWFkVGV4ID0gQzMuTmV3KEMzLlF1YWQpOwogICAgICAgICAgICB0aGlzLl9ibG9iVXJsID0gIiI7CiAgICAgICAgICAgIHRoaXMuX2lJbWFnZUluZm8gPSBuZXcgc2VsZi5JSW1hZ2VJbmZvKHRoaXMpOwogICAgICAgICAgICBhbGxJbWFnZUluZm9zLmFkZCh0aGlzKQogICAgICAgIH0KICAgICAgICBSZWxlYXNlKCkgewogICAgICAgICAgICB0aGlzLlJlbGVhc2VUZXh0dXJlKCk7CiAgICAgICAgICAgIHRoaXMuX2ltYWdlQXNzZXQgPSBudWxsOwogICAgICAgICAgICBhbGxJbWFnZUluZm9zLmRlbGV0ZSh0aGlzKTsKICAgICAgICAgICAgdGhpcy5SZWxlYXNlQmxvYlVSTCgpCiAgICAgICAgfQogICAgICAgIHN0YXRpYyBPblJlbmRlcmVyQ29udGV4dExvc3QoKSB7CiAgICAgICAgICAgIGZvciAoY29uc3QgaW1hZ2VJbmZvIG9mIGFsbEltYWdlSW5mb3MpIHsKICAgICAgICAgICAgICAgIGltYWdlSW5mby5fdGV4dHVyZVN0YXRlID0KICAgICAgICAgICAgICAgICAgICAiIjsKICAgICAgICAgICAgICAgIGltYWdlSW5mby5fcmNUZXguc2V0KDAsIDAsIDAsIDApOwogICAgICAgICAgICAgICAgaW1hZ2VJbmZvLl9xdWFkVGV4LnNldEZyb21SZWN0KGltYWdlSW5mby5fcmNUZXgpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgTG9hZERhdGEoaW1hZ2VEYXRhKSB7CiAgICAgICAgICAgIHRoaXMuX3VybCA9IGltYWdlRGF0YVswXTsKICAgICAgICAgICAgdGhpcy5fc2l6ZSA9IGltYWdlRGF0YVsxXTsKICAgICAgICAgICAgdGhpcy5fb2Zmc2V0WCA9IGltYWdlRGF0YVsyXTsKICAgICAgICAgICAgdGhpcy5fb2Zmc2V0WSA9IGltYWdlRGF0YVszXTsKICAgICAgICAgICAgdGhpcy5fd2lkdGggPSBpbWFnZURhdGFbNF07CiAgICAgICAgICAgIHRoaXMuX2hlaWdodCA9IGltYWdlRGF0YVs1XTsKICAgICAgICAgICAgdGhpcy5faXNSb3RhdGVkID0gaW1hZ2VEYXRhWzZdOwogICAgICAgICAgICB0aGlzLl9oYXNNZXRhRGF0YSA9IHRydWUKICAgICAgICB9CiAgICAgICAgTG9hZER5bmFtaWNBc3NldChydW50aW1lLCB1cmwpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX2ltYWdlQXNzZXQpIHRocm93IG5ldyBFcnJvcigiYWxyZWFkeSBsb2FkZWQgYXNzZXQiKTsKICAgICAgICAgICAgdGhpcy5fdXJsID0gdXJsOwogICAgICAgICAgICBjb25zdCBvcHRzID0ge307CiAgICAgICAgICAgIGlmIChDMy5Jc0Fic29sdXRlVVJMKHVybCkpIG9wdHMubG9hZFBvbGljeSA9ICJyZW1vdGUiOwogICAgICAgICAgICB0aGlzLkxvYWRBc3NldChydW50aW1lLCBvcHRzKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2ltYWdlQXNzZXQuTG9hZCgpCiAgICAgICAgfQogICAgICAgIGFzeW5jIExvYWREeW5hbWljQmxvYkFzc2V0KHJ1bnRpbWUsIGJsb2IpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX2ltYWdlQXNzZXQpIHRocm93IG5ldyBFcnJvcigiYWxyZWFkeSBsb2FkZWQgYXNzZXQiKTsKICAgICAgICAgICAgdGhpcy5fdXJsID0gIiI7CiAgICAgICAgICAgIHRoaXMuX3NpemUgPSBibG9iLnNpemU7CiAgICAgICAgICAgIHRoaXMuX2ltYWdlQXNzZXQgPSBDMy5OZXcoQzMuSW1hZ2VBc3NldCwgcnVudGltZS5HZXRBc3NldE1hbmFnZXIoKSwgewogICAgICAgICAgICAgICAgYmxvYiwKICAgICAgICAgICAgICAgIHNpemU6IHRoaXMuX3NpemUsCiAgICAgICAgICAgICAgICBsb2FkUG9saWN5OiAibG9jYWwiCiAgICAgICAgICAgIH0pCiAgICAgICAgfQogICAgICAgIFJlcGxhY2VXaXRoKG90aGVySW1hZ2VJbmZvKSB7CiAgICAgICAgICAgIGlmIChvdGhlckltYWdlSW5mbyA9PT0gdGhpcykgdGhyb3cgbmV3IEVycm9yKCJjYW5ub3QgcmVwbGFjZSB3aXRoIHNlbGYiKTsKICAgICAgICAgICAgdGhpcy5fZ2VuZXJhdGlvbisrOwogICAgICAgICAgICB0aGlzLlJlbGVhc2VUZXh0dXJlKCk7CiAgICAgICAgICAgIHRoaXMuX3VybCA9IG90aGVySW1hZ2VJbmZvLl91cmw7CiAgICAgICAgICAgIHRoaXMuX3NpemUgPSBvdGhlckltYWdlSW5mby5fc2l6ZTsKICAgICAgICAgICAgdGhpcy5fb2Zmc2V0WCA9IG90aGVySW1hZ2VJbmZvLl9vZmZzZXRYOwogICAgICAgICAgICB0aGlzLl9vZmZzZXRZID0gb3RoZXJJbWFnZUluZm8uX29mZnNldFk7CiAgICAgICAgICAgIHRoaXMuX3dpZHRoID0gb3RoZXJJbWFnZUluZm8uX3dpZHRoOwogICAgICAgICAgICB0aGlzLl9oZWlnaHQgPSBvdGhlckltYWdlSW5mby5faGVpZ2h0OwogICAgICAgICAgICB0aGlzLl9pc1JvdGF0ZWQgPSBvdGhlckltYWdlSW5mby5faXNSb3RhdGVkOwogICAgICAgICAgICB0aGlzLl9oYXNNZXRhRGF0YSA9IG90aGVySW1hZ2VJbmZvLl9oYXNNZXRhRGF0YTsKICAgICAgICAgICAgdGhpcy5faW1hZ2VBc3NldCA9IG90aGVySW1hZ2VJbmZvLl9pbWFnZUFzc2V0OwogICAgICAgICAgICB0aGlzLl90ZXh0dXJlU3RhdGUgPSBvdGhlckltYWdlSW5mby5fdGV4dHVyZVN0YXRlOwogICAgICAgICAgICB0aGlzLl9yY1RleCA9IG90aGVySW1hZ2VJbmZvLl9yY1RleDsKICAgICAgICAgICAgdGhpcy5fcXVhZFRleCA9IG90aGVySW1hZ2VJbmZvLl9xdWFkVGV4OwogICAgICAgICAgICB0aGlzLlJlbGVhc2VCbG9iVVJMKCkKICAgICAgICB9CiAgICAgICAgR2V0VVJMKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fdXJsCiAgICAgICAgfQogICAgICAgIEdldFNpemUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zaXplCiAgICAgICAgfQogICAgICAgIEdldE9mZnNldFgoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9vZmZzZXRYCiAgICAgICAgfQogICAgICAgIEdldE9mZnNldFkoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9vZmZzZXRZCiAgICAgICAgfQogICAgICAgIElzUm90YXRlZCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2lzUm90YXRlZAogICAgICAgIH0KICAgICAgICBHZXRXaWR0aCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3dpZHRoCiAgICAgICAgfQogICAgICAgIEdldEhlaWdodCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2hlaWdodAogICAgICAgIH0KICAgICAgICBHZXRTaGVldFdpZHRoKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faW1hZ2VBc3NldC5HZXRXaWR0aCgpCiAgICAgICAgfQogICAgICAgIEdldFNoZWV0SGVpZ2h0KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faW1hZ2VBc3NldC5HZXRIZWlnaHQoKQogICAgICAgIH0KICAgICAgICBMb2FkQXNzZXQocnVudGltZSwKICAgICAgICAgICAgb3B0cykgewogICAgICAgICAgICBpZiAodGhpcy5faW1hZ2VBc3NldCkgdGhyb3cgbmV3IEVycm9yKCJhbHJlYWR5IGdvdCBhc3NldCIpOwogICAgICAgICAgICBvcHRzID0gT2JqZWN0LmFzc2lnbih7fSwgb3B0cywgewogICAgICAgICAgICAgICAgdXJsOiB0aGlzLkdldFVSTCgpLAogICAgICAgICAgICAgICAgc2l6ZTogdGhpcy5HZXRTaXplKCkKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHRoaXMuX2ltYWdlQXNzZXQgPSBydW50aW1lLkxvYWRJbWFnZShvcHRzKQogICAgICAgIH0KICAgICAgICBJc0xvYWRlZCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2ltYWdlQXNzZXQgJiYgdGhpcy5faW1hZ2VBc3NldC5Jc0xvYWRlZCgpCiAgICAgICAgfQogICAgICAgIGFzeW5jIExvYWRTdGF0aWNUZXh0dXJlKHJlbmRlcmVyLCBvcHRzKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5faW1hZ2VBc3NldCkgdGhyb3cgbmV3IEVycm9yKCJubyBhc3NldCIpOwogICAgICAgICAgICBpZiAodGhpcy5fdGV4dHVyZVN0YXRlKSB0aHJvdyBuZXcgRXJyb3IoImFscmVhZHkgbG9hZGVkIHRleHR1cmUiKTsKICAgICAgICAgICAgY29uc3Qgc3RhcnRHZW5lcmF0aW9uID0gdGhpcy5fZ2VuZXJhdGlvbjsKICAgICAgICAgICAgdGhpcy5fdGV4dHVyZVN0YXRlID0gImxvYWRpbmciOwogICAgICAgICAgICBjb25zdCB0ZXh0dXJlID0gYXdhaXQgdGhpcy5faW1hZ2VBc3NldC5Mb2FkU3RhdGljVGV4dHVyZShyZW5kZXJlciwKICAgICAgICAgICAgICAgIG9wdHMpOwogICAgICAgICAgICBpZiAodGhpcy5fZ2VuZXJhdGlvbiAhPT0gc3RhcnRHZW5lcmF0aW9uKSByZXR1cm4gbnVsbDsKICAgICAgICAgICAgaWYgKCF0ZXh0dXJlKSB7CiAgICAgICAgICAgICAgICB0aGlzLl90ZXh0dXJlU3RhdGUgPSAiIjsKICAgICAgICAgICAgICAgIHJldHVybiBudWxsCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5fdGV4dHVyZVN0YXRlID0gImxvYWRlZCI7CiAgICAgICAgICAgIGlmICghdGhpcy5faGFzTWV0YURhdGEpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3dpZHRoID0gdGV4dHVyZS5HZXRXaWR0aCgpOwogICAgICAgICAgICAgICAgdGhpcy5faGVpZ2h0ID0gdGV4dHVyZS5HZXRIZWlnaHQoKTsKICAgICAgICAgICAgICAgIHRoaXMuX2hhc01ldGFEYXRhID0gdHJ1ZQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IHdyID0gdGhpcy5faXNSb3RhdGVkID8gdGhpcy5faGVpZ2h0IDogdGhpcy5fd2lkdGg7CiAgICAgICAgICAgIGNvbnN0IGhyID0gdGhpcy5faXNSb3RhdGVkID8gdGhpcy5fd2lkdGggOiB0aGlzLl9oZWlnaHQ7CiAgICAgICAgICAgIHRoaXMuX3JjVGV4LnNldCh0aGlzLl9vZmZzZXRYLCB0aGlzLl9vZmZzZXRZLCB0aGlzLl9vZmZzZXRYICsgd3IsIHRoaXMuX29mZnNldFkgKyBocik7CiAgICAgICAgICAgIHRoaXMuX3JjVGV4LmRpdmlkZSh0ZXh0dXJlLkdldFdpZHRoKCksIHRleHR1cmUuR2V0SGVpZ2h0KCkpOwogICAgICAgICAgICB0aGlzLl9xdWFkVGV4LnNldEZyb21SZWN0KHRoaXMuX3JjVGV4KTsKICAgICAgICAgICAgaWYgKHRoaXMuX2lzUm90YXRlZCkgdGhpcy5fcXVhZFRleC5yb3RhdGVQb2ludHNBbnRpY2xvY2t3aXNlKCk7CiAgICAgICAgICAgIHJldHVybiB0ZXh0dXJlCiAgICAgICAgfQogICAgICAgIFJlbGVhc2VUZXh0dXJlKCkgewogICAgICAgICAgICBpZiAoIXRoaXMuX3RleHR1cmVTdGF0ZSkgcmV0dXJuOwogICAgICAgICAgICBpZiAodGhpcy5faW1hZ2VBc3NldCkgdGhpcy5faW1hZ2VBc3NldC5SZWxlYXNlVGV4dHVyZSgpOwogICAgICAgICAgICB0aGlzLl90ZXh0dXJlU3RhdGUgPSAiIjsKICAgICAgICAgICAgdGhpcy5fcmNUZXguc2V0KDAsIDAsIDAsIDApOwogICAgICAgICAgICB0aGlzLl9xdWFkVGV4LnNldEZyb21SZWN0KHRoaXMuX3JjVGV4KQogICAgICAgIH0KICAgICAgICBHZXRUZXh0dXJlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faW1hZ2VBc3NldCA/IHRoaXMuX2ltYWdlQXNzZXQuR2V0VGV4dHVyZSgpIDogbnVsbAogICAgICAgIH0KICAgICAgICBHZXRUZXhSZWN0KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fcmNUZXgKICAgICAgICB9CiAgICAgICAgR2V0VGV4UXVhZCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3F1YWRUZXgKICAgICAgICB9CiAgICAgICAgR2V0SUltYWdlSW5mbygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2lJbWFnZUluZm8KICAgICAgICB9CiAgICAgICAgYXN5bmMgRXh0cmFjdEltYWdlVG9DYW52YXMoKSB7CiAgICAgICAgICAgIGNvbnN0IHNyY0RyYXdhYmxlID0gYXdhaXQgdGhpcy5faW1hZ2VBc3NldC5Mb2FkVG9EcmF3YWJsZSgpOwogICAgICAgICAgICBjb25zdCBjYW52YXMgPSBDMy5DcmVhdGVDYW52YXModGhpcy5fd2lkdGgsIHRoaXMuX2hlaWdodCk7CiAgICAgICAgICAgIGNvbnN0IGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCIyZCIpOwogICAgICAgICAgICBpZiAodGhpcy5faXNSb3RhdGVkKSB7CiAgICAgICAgICAgICAgICBjdHgucm90YXRlKE1hdGguUEkgLyAtMik7CiAgICAgICAgICAgICAgICBjdHgudHJhbnNsYXRlKC10aGlzLl9oZWlnaHQsIDApOwogICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShzcmNEcmF3YWJsZSwgdGhpcy5fb2Zmc2V0WCwgdGhpcy5fb2Zmc2V0WSwgdGhpcy5faGVpZ2h0LCB0aGlzLl93aWR0aCwgMCwgMCwgdGhpcy5faGVpZ2h0LCB0aGlzLl93aWR0aCkKICAgICAgICAgICAgfSBlbHNlIGN0eC5kcmF3SW1hZ2Uoc3JjRHJhd2FibGUsIHRoaXMuX29mZnNldFgsIHRoaXMuX29mZnNldFksIHRoaXMuX3dpZHRoLCB0aGlzLl9oZWlnaHQsIDAsIDAsIHRoaXMuX3dpZHRoLCB0aGlzLl9oZWlnaHQpOwogICAgICAgICAgICByZXR1cm4gY2FudmFzCiAgICAgICAgfQogICAgICAgIGFzeW5jIEV4dHJhY3RJbWFnZVRvQmxvYlVSTCgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX2Jsb2JVcmwpIHJldHVybiB0aGlzLl9ibG9iVXJsOwogICAgICAgICAgICBjb25zdCBjYW52YXMgPSBhd2FpdCB0aGlzLkV4dHJhY3RJbWFnZVRvQ2FudmFzKCk7CiAgICAgICAgICAgIGNvbnN0IGJsb2IgPSBhd2FpdCBDMy5DYW52YXNUb0Jsb2IoY2FudmFzKTsKICAgICAgICAgICAgdGhpcy5fYmxvYlVybCA9IFVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9ibG9iVXJsCiAgICAgICAgfQogICAgICAgIFJlbGVhc2VCbG9iVVJMKCkgewogICAgICAgICAgICBpZiAodGhpcy5fYmxvYlVybCkgewogICAgICAgICAgICAgICAgVVJMLnJldm9rZU9iamVjdFVSTCh0aGlzLl9ibG9iVXJsKTsKICAgICAgICAgICAgICAgIHRoaXMuX2Jsb2JVcmwgPSAiIgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKCn0KCi8vIG9iamVjdHMvYW5pbWF0aW9uSW5mby5qcwp7CiAgICAndXNlIHN0cmljdCc7CiAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICBDMy5BbmltYXRpb25JbmZvID0gY2xhc3MgQW5pbWF0aW9uSW5mbyBleHRlbmRzIEMzLkRlZmVuZGVkQmFzZSB7CiAgICAgICAgY29uc3RydWN0b3IoYW5pbURhdGEpIHsKICAgICAgICAgICAgc3VwZXIoKTsKICAgICAgICAgICAgdGhpcy5fbmFtZSA9IGFuaW1EYXRhWzBdOwogICAgICAgICAgICB0aGlzLl9zcGVlZCA9IGFuaW1EYXRhWzFdOwogICAgICAgICAgICB0aGlzLl9pc0xvb3BpbmcgPSAhIWFuaW1EYXRhWzJdOwogICAgICAgICAgICB0aGlzLl9yZXBlYXRDb3VudCA9IGFuaW1EYXRhWzNdOwogICAgICAgICAgICB0aGlzLl9yZXBlYXRUbyA9IGFuaW1EYXRhWzRdOwogICAgICAgICAgICB0aGlzLl9pc1BpbmdQb25nID0gISFhbmltRGF0YVs1XTsKICAgICAgICAgICAgdGhpcy5fc2lkID0gYW5pbURhdGFbNl07CiAgICAgICAgICAgIHRoaXMuX2ZyYW1lcyA9IGFuaW1EYXRhWzddLm1hcChmcmFtZURhdGEgPT4gQzMuTmV3KEMzLkFuaW1hdGlvbkZyYW1lSW5mbywgZnJhbWVEYXRhKSk7CiAgICAgICAgICAgIHRoaXMuX2lBbmltYXRpb24gPSBuZXcgc2VsZi5JQW5pbWF0aW9uKHRoaXMpCiAgICAgICAgfQogICAgICAgIFJlbGVhc2UoKSB7CiAgICAgICAgICAgIGZvciAoY29uc3QgZiBvZiB0aGlzLl9mcmFtZXMpIGYuUmVsZWFzZSgpOwogICAgICAgICAgICBDMy5jbGVhckFycmF5KHRoaXMuX2ZyYW1lcykKICAgICAgICB9CiAgICAgICAgTG9hZEFsbEFzc2V0cyhydW50aW1lKSB7CiAgICAgICAgICAgIGZvciAoY29uc3QgZiBvZiB0aGlzLl9mcmFtZXMpIGYuR2V0SW1hZ2VJbmZvKCkuTG9hZEFzc2V0KHJ1bnRpbWUpCiAgICAgICAgfQogICAgICAgIExvYWRBbGxUZXh0dXJlcyhyZW5kZXJlciwgb3B0cykgewogICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGwodGhpcy5fZnJhbWVzLm1hcChmID0+CiAgICAgICAgICAgICAgICBmLkdldEltYWdlSW5mbygpLkxvYWRTdGF0aWNUZXh0dXJlKHJlbmRlcmVyLCBvcHRzKSkpCiAgICAgICAgfQogICAgICAgIFJlbGVhc2VBbGxUZXh0dXJlcygpIHsKICAgICAgICAgICAgZm9yIChjb25zdCBmIG9mIHRoaXMuX2ZyYW1lcykgZi5HZXRJbWFnZUluZm8oKS5SZWxlYXNlVGV4dHVyZSgpCiAgICAgICAgfQogICAgICAgIEdldE5hbWUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9uYW1lCiAgICAgICAgfQogICAgICAgIEdldFNJRCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NpZAogICAgICAgIH0KICAgICAgICBHZXRGcmFtZUNvdW50KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZnJhbWVzLmxlbmd0aAogICAgICAgIH0KICAgICAgICBHZXRGcmFtZXMoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9mcmFtZXMKICAgICAgICB9CiAgICAgICAgR2V0RnJhbWVBdChpKSB7CiAgICAgICAgICAgIGkgPSBNYXRoLmZsb29yKGkpOwogICAgICAgICAgICBpZiAoaSA8IDAgfHwgaSA+PSB0aGlzLl9mcmFtZXMubGVuZ3RoKSB0aHJvdyBuZXcgUmFuZ2VFcnJvcigiaW52YWxpZCBmcmFtZSIpOwogICAgICAgICAgICByZXR1cm4gdGhpcy5fZnJhbWVzW2ldCiAgICAgICAgfQogICAgICAgIEdldFNwZWVkKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fc3BlZWQKICAgICAgICB9CiAgICAgICAgSXNMb29waW5nKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faXNMb29waW5nCiAgICAgICAgfQogICAgICAgIEdldFJlcGVhdENvdW50KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fcmVwZWF0Q291bnQKICAgICAgICB9CiAgICAgICAgR2V0UmVwZWF0VG8oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9yZXBlYXRUbwogICAgICAgIH0KICAgICAgICBJc1BpbmdQb25nKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faXNQaW5nUG9uZwogICAgICAgIH0KICAgICAgICBHZXRJQW5pbWF0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faUFuaW1hdGlvbgogICAgICAgIH0KICAgIH07Cgp9CgovLyBvYmplY3RzL2FuaW1hdGlvbkZyYW1lSW5mby5qcwp7CiAgICAndXNlIHN0cmljdCc7CiAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICBDMy5BbmltYXRpb25GcmFtZUluZm8gPSBjbGFzcyBBbmltYXRpb25GcmFtZUluZm8gZXh0ZW5kcyBDMy5EZWZlbmRlZEJhc2UgewogICAgICAgIGNvbnN0cnVjdG9yKGZyYW1lRGF0YSkgewogICAgICAgICAgICBzdXBlcigpOwogICAgICAgICAgICB0aGlzLl9pbWFnZUluZm8gPSBDMy5OZXcoQzMuSW1hZ2VJbmZvKTsKICAgICAgICAgICAgdGhpcy5faW1hZ2VJbmZvLkxvYWREYXRhKGZyYW1lRGF0YSk7CiAgICAgICAgICAgIHRoaXMuX2R1cmF0aW9uID0gZnJhbWVEYXRhWzddOwogICAgICAgICAgICB0aGlzLl9vcmlnaW4gPSBDMy5OZXcoQzMuVmVjdG9yMiwgZnJhbWVEYXRhWzhdLCBmcmFtZURhdGFbOV0pOwogICAgICAgICAgICB0aGlzLl9pbWFnZVBvaW50cyA9IGZyYW1lRGF0YVsxMF0ubWFwKGRhdGEgPT4gQzMuTmV3KEMzLkltYWdlUG9pbnQsIHRoaXMsIGRhdGEpKTsKICAgICAgICAgICAgdGhpcy5faW1hZ2VQb2ludHNCeU5hbWUgPSBuZXcgTWFwOwogICAgICAgICAgICBmb3IgKGNvbnN0IGlwIG9mIHRoaXMuX2ltYWdlUG9pbnRzKSB0aGlzLl9pbWFnZVBvaW50c0J5TmFtZS5zZXQoaXAuR2V0TmFtZSgpLnRvTG93ZXJDYXNlKCksIGlwKTsKICAgICAgICAgICAgdGhpcy5fY29sbGlzaW9uUG9seSA9IG51bGw7CiAgICAgICAgICAgIGNvbnN0IHBvbHlQb2ludHMgPQogICAgICAgICAgICAgICAgZnJhbWVEYXRhWzExXTsKICAgICAgICAgICAgaWYgKHBvbHlQb2ludHMubGVuZ3RoID49IDYpIHRoaXMuX2NvbGxpc2lvblBvbHkgPSBDMy5OZXcoQzMuQ29sbGlzaW9uUG9seSwgcG9seVBvaW50cyk7CiAgICAgICAgICAgIHRoaXMuX2lBbmltYXRpb25GcmFtZSA9IG5ldyBzZWxmLklBbmltYXRpb25GcmFtZSh0aGlzKQogICAgICAgIH0KICAgICAgICBSZWxlYXNlKCkgewogICAgICAgICAgICBpZiAodGhpcy5fY29sbGlzaW9uUG9seSkgewogICAgICAgICAgICAgICAgdGhpcy5fY29sbGlzaW9uUG9seS5SZWxlYXNlKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9jb2xsaXNpb25Qb2x5ID0gbnVsbAogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuX2ltYWdlSW5mby5SZWxlYXNlKCk7CiAgICAgICAgICAgIHRoaXMuX2ltYWdlSW5mbyA9IG51bGwKICAgICAgICB9CiAgICAgICAgR2V0SW1hZ2VJbmZvKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faW1hZ2VJbmZvCiAgICAgICAgfQogICAgICAgIEdldER1cmF0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZHVyYXRpb24KICAgICAgICB9CiAgICAgICAgR2V0T3JpZ2luWCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX29yaWdpbi5nZXRYKCkKICAgICAgICB9CiAgICAgICAgR2V0T3JpZ2luWSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX29yaWdpbi5nZXRZKCkKICAgICAgICB9CiAgICAgICAgR2V0Q29sbGlzaW9uUG9seSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NvbGxpc2lvblBvbHkKICAgICAgICB9CiAgICAgICAgR2V0SW1hZ2VQb2ludEJ5TmFtZShuYW1lKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pbWFnZVBvaW50c0J5TmFtZS5nZXQobmFtZS50b0xvd2VyQ2FzZSgpKSB8fAogICAgICAgICAgICAgICAgbnVsbAogICAgICAgIH0KICAgICAgICBHZXRJbWFnZVBvaW50QnlJbmRleChpbmRleCkgewogICAgICAgICAgICBpbmRleCA9IE1hdGguZmxvb3IoaW5kZXgpOwogICAgICAgICAgICBpZiAoaW5kZXggPCAwIHx8IGluZGV4ID49IHRoaXMuX2ltYWdlUG9pbnRzLmxlbmd0aCkgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pbWFnZVBvaW50c1tpbmRleF0KICAgICAgICB9CiAgICAgICAgR2V0SW1hZ2VQb2ludENvdW50KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faW1hZ2VQb2ludHMubGVuZ3RoCiAgICAgICAgfQogICAgICAgIEdldElBbmltYXRpb25GcmFtZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2lBbmltYXRpb25GcmFtZQogICAgICAgIH0KICAgIH07Cgp9CgovLyBvYmplY3RzL2ltYWdlUG9pbnQuanMKewogICAgJ3VzZSBzdHJpY3QnOwogICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgQzMuSW1hZ2VQb2ludCA9IGNsYXNzIEltYWdlUG9pbnQgZXh0ZW5kcyBDMy5EZWZlbmRlZEJhc2UgewogICAgICAgIGNvbnN0cnVjdG9yKGFmaSwgZGF0YSkgewogICAgICAgICAgICBzdXBlcigpOwogICAgICAgICAgICB0aGlzLl9hZmkgPSBhZmk7CiAgICAgICAgICAgIHRoaXMuX25hbWUgPSBkYXRhWzBdOwogICAgICAgICAgICB0aGlzLl9wb3MgPSBDMy5OZXcoQzMuVmVjdG9yMiwgZGF0YVsxXSwgZGF0YVsyXSkKICAgICAgICB9CiAgICAgICAgUmVsZWFzZSgpIHt9CiAgICAgICAgR2V0TmFtZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX25hbWUKICAgICAgICB9CiAgICAgICAgR2V0WCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3Bvcy5nZXRYKCkKICAgICAgICB9CiAgICAgICAgR2V0WSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3Bvcy5nZXRZKCkKICAgICAgICB9CiAgICAgICAgR2V0VmVjMigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3BvcwogICAgICAgIH0KICAgIH07Cgp9CgovLyBvYmplY3RzL29iamVjdENsYXNzLmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIGNvbnN0IEMzRGVidWdnZXIgPSBzZWxmLkMzRGVidWdnZXI7CiAgICBjb25zdCBJT2JqZWN0Q2xhc3MgPSBzZWxmLklPYmplY3RDbGFzczsKICAgIGNvbnN0IGFzc2VydCA9IHNlbGYuYXNzZXJ0OwogICAgQzMuT2JqZWN0Q2xhc3MgPSBjbGFzcyBPYmplY3RDbGFzcyBleHRlbmRzIEMzLkRlZmVuZGVkQmFzZSB7CiAgICAgICAgY29uc3RydWN0b3IocnVudGltZSwgaW5kZXgsIGRhdGEpIHsKICAgICAgICAgICAgc3VwZXIoKTsKICAgICAgICAgICAgY29uc3QgUGx1Z2luQ3RvciA9IHJ1bnRpbWUuR2V0T2JqZWN0UmVmZXJlbmNlKGRhdGFbMV0pOwogICAgICAgICAgICB0aGlzLl9ydW50aW1lID0gcnVudGltZTsKICAgICAgICAgICAgdGhpcy5fcGx1Z2luID0gcnVudGltZS5HZXRQbHVnaW5NYW5hZ2VyKCkuR2V0UGx1Z2luQnlDb25zdHJ1Y3RvckZ1bmN0aW9uKFBsdWdpbkN0b3IpOwogICAgICAgICAgICB0aGlzLl9zZGtUeXBlID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5faW5zdFNka0N0b3IgPSBQbHVnaW5DdG9yLkluc3RhbmNlOwogICAgICAgICAgICB0aGlzLl9pbmRleCA9IGluZGV4OwogICAgICAgICAgICB0aGlzLl9zaWQgPSBkYXRhWzExXTsKICAgICAgICAgICAgdGhpcy5fbmFtZSA9IGRhdGFbMF07CiAgICAgICAgICAgIHRoaXMuX2pzUHJvcE5hbWUgPSB0aGlzLl9ydW50aW1lLkdldEpzUHJvcE5hbWUoZGF0YVsxNF0pOwogICAgICAgICAgICB0aGlzLl9pc0dsb2JhbCA9ICEhZGF0YVs5XTsKICAgICAgICAgICAgdGhpcy5faXNGYW1pbHkgPSAhIWRhdGFbMl07CiAgICAgICAgICAgIHRoaXMuX2lzT25Mb2FkZXJMYXlvdXQgPSAhIWRhdGFbMTBdOwogICAgICAgICAgICB0aGlzLl9pbnN0VmFycyA9IGRhdGFbM10ubWFwKGFyciA9PiAoewogICAgICAgICAgICAgICAgc2lkOiBhcnJbMF0sCiAgICAgICAgICAgICAgICB0eXBlOiBhcnJbMV0sCiAgICAgICAgICAgICAgICBuYW1lOiBhcnJbMl0sCiAgICAgICAgICAgICAgICBqc1Byb3BOYW1lOiBydW50aW1lLkdldEpzUHJvcE5hbWUoYXJyWzNdKQogICAgICAgICAgICB9KSk7CiAgICAgICAgICAgIHRoaXMuX2JlaGF2aW9yc0NvdW50ID0gZGF0YVs0XTsKICAgICAgICAgICAgdGhpcy5fZWZmZWN0c0NvdW50ID0gZGF0YVs1XTsKICAgICAgICAgICAgdGhpcy5faXNXb3JsZFR5cGUgPSB0aGlzLl9wbHVnaW4uSXNXb3JsZFR5cGUoKTsKICAgICAgICAgICAgdGhpcy5fZWZmZWN0TGlzdCA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX2NvbGxpc2lvbkdyaWQgPSBDMy5OZXcoQzMuU3BhcnNlR3JpZCwgcnVudGltZS5HZXRPcmlnaW5hbFZpZXdwb3J0V2lkdGgoKSwgcnVudGltZS5HZXRPcmlnaW5hbFZpZXdwb3J0SGVpZ2h0KCkpOwogICAgICAgICAgICB0aGlzLl9hbnlDb2xsaXNpb25DZWxsQ2hhbmdlZCA9IHRydWU7CiAgICAgICAgICAgIHRoaXMuX2FueUluc3RhbmNlUGFyYWxsYXhlZCA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl9mYW1pbHlNZW1iZXJzID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fZmFtaWx5TWVtYmVyc1NldCA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX2ZhbWlseUluZGV4ID0gLTE7CiAgICAgICAgICAgIHRoaXMuX2ZhbWlsaWVzID0KICAgICAgICAgICAgICAgIG51bGw7CiAgICAgICAgICAgIHRoaXMuX2ZhbWlsaWVzU2V0ID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fZmFtaWx5SW5zdFZhck1hcCA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX2ZhbWlseUJlaGF2aW9yTWFwID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fZmFtaWx5RWZmZWN0TWFwID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5faXNJbkNvbnRhaW5lciA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl9jb250YWluZXIgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9iZWhhdmlvclR5cGVzID0gZGF0YVs4XS5tYXAoYmVoYXZpb3JUeXBlRGF0YSA9PiBDMy5CZWhhdmlvclR5cGUuQ3JlYXRlKHRoaXMsIGJlaGF2aW9yVHlwZURhdGEpKTsKICAgICAgICAgICAgdGhpcy5fYmVoYXZpb3JUeXBlc0luY2x1ZGluZ0luaGVyaXRlZCA9IFtdOwogICAgICAgICAgICB0aGlzLl9iZWhhdmlvcnNCeU5hbWUgPSBuZXcgTWFwOwogICAgICAgICAgICB0aGlzLl9iZWhhdmlvck5hbWVUb0luZGV4ID0gbmV3IE1hcDsKICAgICAgICAgICAgdGhpcy5fdXNlZEJlaGF2aW9yQ3RvcnMgPSBuZXcgU2V0OwogICAgICAgICAgICB0aGlzLl9jdXN0b21BY3Rpb25NYXAgPSBuZXcgTWFwOwogICAgICAgICAgICB0aGlzLl9zb2xTdGFjayA9IEMzLk5ldyhDMy5Tb2xTdGFjaywgdGhpcyk7CiAgICAgICAgICAgIHRoaXMuX2RlZmF1bHRJbnN0YW5jZURhdGEgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9kZWZhdWx0TGF5ZXJJbmRleCA9CiAgICAgICAgICAgICAgICAwOwogICAgICAgICAgICB0aGlzLl9pc0NvbnRhaW5lZCA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl9jb250YWluZXIgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9pbWFnZUluZm8gPSBudWxsOwogICAgICAgICAgICB0aGlzLl9hbmltYXRpb25zID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fYW5pbWF0aW9uc0J5TmFtZSA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX2FuaW1hdGlvbnNCeVNpZCA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3RleHR1cmVSZWZDb3VudCA9IDA7CiAgICAgICAgICAgIHRoaXMuX3NhdmVkRGF0YSA9IG5ldyBNYXA7CiAgICAgICAgICAgIHRoaXMuX3Vuc2F2ZWREYXRhID0gbmV3IE1hcDsKICAgICAgICAgICAgdGhpcy5faW5zdGFuY2VzID0gW107CiAgICAgICAgICAgIHRoaXMuX2lpZHNTdGFsZSA9IHRydWU7CiAgICAgICAgICAgIGlmICh0aGlzLl9wbHVnaW4uSGFzRWZmZWN0cygpKSB0aGlzLl9lZmZlY3RMaXN0ID0gQzMuTmV3KEMzLkVmZmVjdExpc3QsIHRoaXMsIGRhdGFbMTJdKTsKICAgICAgICAgICAgaWYgKGRhdGFbNl0pIHsKICAgICAgICAgICAgICAgIHRoaXMuX2ltYWdlSW5mbyA9IEMzLk5ldyhDMy5JbWFnZUluZm8pOwogICAgICAgICAgICAgICAgdGhpcy5faW1hZ2VJbmZvLkxvYWREYXRhKGRhdGFbNl0pCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGRhdGFbN10pIHsKICAgICAgICAgICAgICAgIHRoaXMuX2FuaW1hdGlvbnMgPSBkYXRhWzddLm1hcChhbmltRGF0YSA9PiBDMy5OZXcoQzMuQW5pbWF0aW9uSW5mbywgYW5pbURhdGEpKTsKICAgICAgICAgICAgICAgIHRoaXMuX2FuaW1hdGlvbnNCeU5hbWUgPSBuZXcgTWFwOwogICAgICAgICAgICAgICAgdGhpcy5fYW5pbWF0aW9uc0J5U2lkID0gbmV3IE1hcDsKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgYW5pbSBvZiB0aGlzLl9hbmltYXRpb25zKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYW5pbWF0aW9uc0J5TmFtZS5zZXQoYW5pbS5HZXROYW1lKCkudG9Mb3dlckNhc2UoKSwgYW5pbSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYW5pbWF0aW9uc0J5U2lkLnNldChhbmltLkdldFNJRCgpLCBhbmltKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLl9pc0ZhbWlseSkgewogICAgICAgICAgICAgICAgdGhpcy5fZmFtaWx5TWVtYmVycyA9IFtdOwogICAgICAgICAgICAgICAgdGhpcy5fZmFtaWx5TWVtYmVyc1NldCA9IG5ldyBTZXQ7CiAgICAgICAgICAgICAgICB0aGlzLl9mYW1pbHlJbmRleCA9IHRoaXMuX3J1bnRpbWUuX0dldE5leHRGYW1pbHlJbmRleCgpCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLl9mYW1pbGllcyA9IFtdOwogICAgICAgICAgICAgICAgdGhpcy5fZmFtaWxpZXNTZXQgPSBuZXcgU2V0OwogICAgICAgICAgICAgICAgdGhpcy5fZmFtaWx5SW5zdFZhck1hcCA9IFtdOwogICAgICAgICAgICAgICAgdGhpcy5fZmFtaWx5QmVoYXZpb3JNYXAgPSBbXTsKICAgICAgICAgICAgICAgIHRoaXMuX2ZhbWlseUVmZmVjdE1hcCA9IFtdCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5fc2RrVHlwZSA9IEMzLk5ldyhQbHVnaW5DdG9yLlR5cGUsIHRoaXMsCiAgICAgICAgICAgICAgICBkYXRhWzE1XSk7CiAgICAgICAgICAgIHRoaXMuX2lPYmplY3RDbGFzcyA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX2luc3RhbmNlVXNlclNjcmlwdENsYXNzID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fdXNlclNjcmlwdERpc3BhdGNoZXIgPSBDMy5OZXcoQzMuRXZlbnQuRGlzcGF0Y2hlcik7CiAgICAgICAgICAgIGNvbnN0IEN1c3RvbVNjcmlwdENsYXNzID0gdGhpcy5fc2RrVHlwZS5HZXRTY3JpcHRJbnRlcmZhY2VDbGFzcygpOwogICAgICAgICAgICBpZiAoQ3VzdG9tU2NyaXB0Q2xhc3MpIHsKICAgICAgICAgICAgICAgIHRoaXMuX2lPYmplY3RDbGFzcyA9IG5ldyBDdXN0b21TY3JpcHRDbGFzcyh0aGlzKTsKICAgICAgICAgICAgICAgIGlmICghKHRoaXMuX2lPYmplY3RDbGFzcyBpbnN0YW5jZW9mIElPYmplY3RDbGFzcykpIHRocm93IG5ldyBUeXBlRXJyb3IoInNjcmlwdCBpbnRlcmZhY2UgY2xhc3MgbXVzdCBkZXJpdmUgZnJvbSBJT2JqZWN0Q2xhc3MiKTsKICAgICAgICAgICAgfSBlbHNlIHRoaXMuX2lPYmplY3RDbGFzcyA9IG5ldyBJT2JqZWN0Q2xhc3ModGhpcyk7CiAgICAgICAgICAgIGlmIChkYXRhWzEzXSkgewogICAgICAgICAgICAgICAgY29uc3QgdGlsZW1hcERhdGEgPSBkYXRhWzEzXTsKICAgICAgICAgICAgICAgIGlmICh0aWxlbWFwRGF0YSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHRpbGVQb2x5RGF0YSA9CiAgICAgICAgICAgICAgICAgICAgICAgIHRpbGVtYXBEYXRhWzBdOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IG1heFRpbGVJbmRleCA9IHRpbGVtYXBEYXRhWzFdOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGJydXNoRGF0YSA9IHRpbGVtYXBEYXRhWzJdOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3Nka1R5cGUuTG9hZFRpbGVtYXBEYXRhKHRpbGVQb2x5RGF0YSwgbWF4VGlsZUluZGV4LCBicnVzaERhdGEpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCF0aGlzLl9ydW50aW1lLlVzZXNMb2FkZXJMYXlvdXQoKSB8fCB0aGlzLl9pc0ZhbWlseSB8fCB0aGlzLl9pc09uTG9hZGVyTGF5b3V0IHx8ICF0aGlzLl9pc1dvcmxkVHlwZSkgdGhpcy5PbkNyZWF0ZSgpOwogICAgICAgICAgICBpZiAodGhpcy5fcGx1Z2luLklzU2luZ2xlR2xvYmFsKCkpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3BsdWdpbi5fU2V0U2luZ2xlR2xvYmFsT2JqZWN0Q2xhc3ModGhpcyk7CiAgICAgICAgICAgICAgICB0aGlzLl9DcmVhdGVTaW5nbGVHbG9iYWxJbnN0YW5jZShkYXRhKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuX2xvYWRJbnN0YW5jZXNKc29uID0gbnVsbAogICAgICAgIH0KICAgICAgICBzdGF0aWMgQ3JlYXRlKHJ1bnRpbWUsIGluZGV4LCBvYmplY3RDbGFzc0RhdGEpIHsKICAgICAgICAgICAgcmV0dXJuIEMzLk5ldyhDMy5PYmplY3RDbGFzcywgcnVudGltZSwgaW5kZXgsIG9iamVjdENsYXNzRGF0YSkKICAgICAgICB9CiAgICAgICAgUmVsZWFzZSgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX2ltYWdlSW5mbykgewogICAgICAgICAgICAgICAgdGhpcy5faW1hZ2VJbmZvLlJlbGVhc2UoKTsKICAgICAgICAgICAgICAgIHRoaXMuX2ltYWdlSW5mbyA9IG51bGwKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGhpcy5fYW5pbWF0aW9ucykgewogICAgICAgICAgICAgICAgZm9yIChjb25zdCBhIG9mIHRoaXMuX2FuaW1hdGlvbnMpIGEuUmVsZWFzZSgpOwogICAgICAgICAgICAgICAgQzMuY2xlYXJBcnJheSh0aGlzLl9hbmltYXRpb25zKTsKICAgICAgICAgICAgICAgIHRoaXMuX2FuaW1hdGlvbnNCeU5hbWUuY2xlYXIoKTsKICAgICAgICAgICAgICAgIHRoaXMuX2FuaW1hdGlvbnNCeVNpZC5jbGVhcigpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5fbG9hZEluc3RhbmNlc0pzb24gPSBudWxsOwogICAgICAgICAgICB0aGlzLl9zb2xTdGFjay5SZWxlYXNlKCk7CiAgICAgICAgICAgIHRoaXMuX3NvbFN0YWNrID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fc2F2ZWREYXRhLmNsZWFyKCk7CiAgICAgICAgICAgIHRoaXMuX3Vuc2F2ZWREYXRhLmNsZWFyKCk7CiAgICAgICAgICAgIHRoaXMuX2NvbnRhaW5lciA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUgPSBudWxsCiAgICAgICAgfQogICAgICAgIF9Mb2FkRmFtaWx5KGZhbWlseURhdGEpIHsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDEsIGxlbiA9IGZhbWlseURhdGEubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHsKICAgICAgICAgICAgICAgIGNvbnN0IG1lbWJlclR5cGUgPSB0aGlzLl9ydW50aW1lLkdldE9iamVjdENsYXNzQnlJbmRleChmYW1pbHlEYXRhW2ldKTsKICAgICAgICAgICAgICAgIHRoaXMuX2ZhbWlseU1lbWJlcnMucHVzaChtZW1iZXJUeXBlKTsKICAgICAgICAgICAgICAgIHRoaXMuX2ZhbWlseU1lbWJlcnNTZXQuYWRkKG1lbWJlclR5cGUpOwogICAgICAgICAgICAgICAgbWVtYmVyVHlwZS5fZmFtaWxpZXMucHVzaCh0aGlzKTsKICAgICAgICAgICAgICAgIG1lbWJlclR5cGUuX2ZhbWlsaWVzU2V0LmFkZCh0aGlzKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIF9TZXRDb250YWluZXIoY29udGFpbmVyKSB7CiAgICAgICAgICAgIHRoaXMuX2lzSW5Db250YWluZXIgPSB0cnVlOwogICAgICAgICAgICB0aGlzLl9jb250YWluZXIgPSBjb250YWluZXIKICAgICAgICB9CiAgICAgICAgSXNJbkNvbnRhaW5lcigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2lzSW5Db250YWluZXIKICAgICAgICB9CiAgICAgICAgR2V0Q29udGFpbmVyKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fY29udGFpbmVyCiAgICAgICAgfQogICAgICAgIF9PbkFmdGVyQ3JlYXRlKCkgewogICAgICAgICAgICBsZXQgaW5kZXggPSAwOwogICAgICAgICAgICBpZiAoIXRoaXMuX2lzRmFtaWx5KQogICAgICAgICAgICAgICAgZm9yIChjb25zdCBmYW1pbHkgb2YgdGhpcy5fZmFtaWxpZXMpCiAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBmYW1pbHlCZWhUeXBlIG9mIGZhbWlseS5HZXRCZWhhdmlvclR5cGVzKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbG93ZXJOYW1lID0gZmFtaWx5QmVoVHlwZS5HZXROYW1lKCkudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fYmVoYXZpb3JzQnlOYW1lLnNldChsb3dlck5hbWUsIGZhbWlseUJlaFR5cGUpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9iZWhhdmlvck5hbWVUb0luZGV4LnNldChsb3dlck5hbWUsIGluZGV4KTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fYmVoYXZpb3JUeXBlc0luY2x1ZGluZ0luaGVyaXRlZC5wdXNoKGZhbWlseUJlaFR5cGUpOwogICAgICAgICAgICAgICAgICAgICAgICArK2luZGV4CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IgKGNvbnN0IGJlaGF2aW9yVHlwZSBvZiB0aGlzLkdldEJlaGF2aW9yVHlwZXMoKSkgewogICAgICAgICAgICAgICAgY29uc3QgbG93ZXJOYW1lID0gYmVoYXZpb3JUeXBlLkdldE5hbWUoKS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgICAgdGhpcy5fYmVoYXZpb3JzQnlOYW1lLnNldChsb3dlck5hbWUsIGJlaGF2aW9yVHlwZSk7CiAgICAgICAgICAgICAgICB0aGlzLl9iZWhhdmlvck5hbWVUb0luZGV4LnNldChsb3dlck5hbWUsIGluZGV4KTsKICAgICAgICAgICAgICAgIHRoaXMuX2JlaGF2aW9yVHlwZXNJbmNsdWRpbmdJbmhlcml0ZWQucHVzaChiZWhhdmlvclR5cGUpOwogICAgICAgICAgICAgICAgKytpbmRleAogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciAoY29uc3QgYmVoYXZpb3JUeXBlIG9mIHRoaXMuX2JlaGF2aW9yVHlwZXNJbmNsdWRpbmdJbmhlcml0ZWQpIHRoaXMuX3VzZWRCZWhhdmlvckN0b3JzLmFkZChiZWhhdmlvclR5cGUuR2V0QmVoYXZpb3IoKS5jb25zdHJ1Y3Rvcik7CiAgICAgICAgICAgIGlmICghdGhpcy5faXNGYW1pbHkgJiYgdGhpcy5fZmFtaWxpZXMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICBjb25zdCBmYW1pbHlDb3VudCA9IHRoaXMuX3J1bnRpbWUuR2V0RmFtaWx5Q291bnQoKTsKICAgICAgICAgICAgICAgIEMzLmV4dGVuZEFycmF5KHRoaXMuX2ZhbWlseUluc3RWYXJNYXAsIGZhbWlseUNvdW50LCAwKTsKICAgICAgICAgICAgICAgIEMzLmV4dGVuZEFycmF5KHRoaXMuX2ZhbWlseUJlaGF2aW9yTWFwLCBmYW1pbHlDb3VudCwgMCk7CiAgICAgICAgICAgICAgICBDMy5leHRlbmRBcnJheSh0aGlzLl9mYW1pbHlFZmZlY3RNYXAsIGZhbWlseUNvdW50LCAwKTsKICAgICAgICAgICAgICAgIGNvbnN0IGFsbEZ4ID0gW107CiAgICAgICAgICAgICAgICBsZXQgaXZTdW0gPSAwOwogICAgICAgICAgICAgICAgbGV0IGJlaFN1bSA9IDA7CiAgICAgICAgICAgICAgICBsZXQgZnhTdW0gPSAwOwogICAgICAgICAgICAgICAgZm9yIChjb25zdCBmYW1pbHkgb2YgdGhpcy5fZmFtaWxpZXMpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBmYW1pbHlJbmRleCA9IGZhbWlseS5HZXRGYW1pbHlJbmRleCgpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2ZhbWlseUluc3RWYXJNYXBbZmFtaWx5SW5kZXhdID0gaXZTdW07CiAgICAgICAgICAgICAgICAgICAgaXZTdW0gKz0gZmFtaWx5LkdldEluc3RhbmNlVmFyaWFibGVzQ291bnQoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9mYW1pbHlCZWhhdmlvck1hcFtmYW1pbHlJbmRleF0gPQogICAgICAgICAgICAgICAgICAgICAgICBiZWhTdW07CiAgICAgICAgICAgICAgICAgICAgYmVoU3VtICs9IGZhbWlseS5HZXRCZWhhdmlvclR5cGVzQ291bnQoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9mYW1pbHlFZmZlY3RNYXBbZmFtaWx5SW5kZXhdID0gZnhTdW07CiAgICAgICAgICAgICAgICAgICAgZnhTdW0gKz0gZmFtaWx5LkdldEVmZmVjdFR5cGVzQ291bnQoKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBmYW1pbHlFZmZlY3RMaXN0ID0gZmFtaWx5LkdldEVmZmVjdExpc3QoKTsKICAgICAgICAgICAgICAgICAgICBpZiAoZmFtaWx5RWZmZWN0TGlzdCAmJiB0aGlzLl9lZmZlY3RMaXN0KQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGVmZmVjdFR5cGUgb2YgZmFtaWx5RWZmZWN0TGlzdC5HZXRBbGxFZmZlY3RUeXBlcygpKSBhbGxGeC5wdXNoKGVmZmVjdFR5cGUuQ2xvbmUodGhpcy5fZWZmZWN0TGlzdCkpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fZWZmZWN0TGlzdCkgdGhpcy5fZWZmZWN0TGlzdC5QcmVwZW5kRWZmZWN0VHlwZXMoYWxsRngpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgX0NyZWF0ZVNpbmdsZUdsb2JhbEluc3RhbmNlKGRhdGEpIHsKICAgICAgICAgICAgY29uc3QgdWlkID0gdGhpcy5fcnVudGltZS5fR2V0TmV3VUlEKCk7CiAgICAgICAgICAgIGNvbnN0IGluc3QgPSBDMy5OZXcoQzMuSW5zdGFuY2UsIHsKICAgICAgICAgICAgICAgIHJ1bnRpbWU6IHRoaXMuX3J1bnRpbWUsCiAgICAgICAgICAgICAgICBvYmplY3RUeXBlOiB0aGlzLAogICAgICAgICAgICAgICAgdWlkOiB1aWQKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGluc3QuX0NyZWF0ZVNka0luc3RhbmNlKGRhdGFbMTZdLCBbXSk7CiAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuX01hcEluc3RhbmNlQnlVSUQodWlkLCBpbnN0KTsKICAgICAgICAgICAgdGhpcy5faW5zdGFuY2VzLnB1c2goaW5zdCkKICAgICAgICB9CiAgICAgICAgR2V0U2RrVHlwZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3Nka1R5cGUKICAgICAgICB9CiAgICAgICAgSXNPbkxvYWRlckxheW91dCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2lzT25Mb2FkZXJMYXlvdXQKICAgICAgICB9CiAgICAgICAgT25DcmVhdGUoKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5faXNGYW1pbHkpIHRoaXMuX3Nka1R5cGUuT25DcmVhdGUoKQogICAgICAgIH0KICAgICAgICBIYXNMb2FkZWRUZXh0dXJlcygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RleHR1cmVSZWZDb3VudCA+IDAKICAgICAgICB9CiAgICAgICAgTG9hZFRleHR1cmVzKHJlbmRlcmVyKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9pc0ZhbWlseSkgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpOwogICAgICAgICAgICB0aGlzLl90ZXh0dXJlUmVmQ291bnQrKzsKICAgICAgICAgICAgaWYgKHRoaXMuX3RleHR1cmVSZWZDb3VudCA9PT0gMSkgcmV0dXJuIHRoaXMuX3Nka1R5cGUuTG9hZFRleHR1cmVzKHJlbmRlcmVyKSB8fCBQcm9taXNlLnJlc29sdmUoKTsKICAgICAgICAgICAgZWxzZSByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCkKICAgICAgICB9CiAgICAgICAgUmVsZWFzZVRleHR1cmVzKCkgewogICAgICAgICAgICBpZiAodGhpcy5faXNGYW1pbHkpIHJldHVybjsKICAgICAgICAgICAgdGhpcy5fdGV4dHVyZVJlZkNvdW50LS07CiAgICAgICAgICAgIGlmICh0aGlzLl90ZXh0dXJlUmVmQ291bnQgPCAwKSB0aHJvdyBuZXcgRXJyb3IoInJlbGVhc2VkIHRleHR1cmVzIHRvbyBtYW55IHRpbWVzIik7CiAgICAgICAgICAgIGlmICh0aGlzLl90ZXh0dXJlUmVmQ291bnQgPT09IDApIHRoaXMuX3Nka1R5cGUuUmVsZWFzZVRleHR1cmVzKCkKICAgICAgICB9CiAgICAgICAgT25EeW5hbWljVGV4dHVyZUxvYWRDb21wbGV0ZSgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX2lzRmFtaWx5KSB0aHJvdyBuZXcgRXJyb3IoIm5vdCBhcHBsaWNhYmxlIHRvIGZhbWlseSIpOwogICAgICAgICAgICB0aGlzLl9zZGtUeXBlLk9uRHluYW1pY1RleHR1cmVMb2FkQ29tcGxldGUoKQogICAgICAgIH0KICAgICAgICBQcmVsb2FkVGV4dHVyZXNXaXRoSW5zdGFuY2VzKHJlbmRlcmVyKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9pc0ZhbWlseSkgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpOwogICAgICAgICAgICByZXR1cm4gdGhpcy5fc2RrVHlwZS5QcmVsb2FkVGV4dHVyZXNXaXRoSW5zdGFuY2VzKHJlbmRlcmVyKQogICAgICAgIH0KICAgICAgICBHZXRSdW50aW1lKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fcnVudGltZQogICAgICAgIH0KICAgICAgICBHZXRQbHVnaW4oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9wbHVnaW4KICAgICAgICB9CiAgICAgICAgR2V0SW5zdGFuY2VTZGtDdG9yKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faW5zdFNka0N0b3IKICAgICAgICB9CiAgICAgICAgR2V0TmFtZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX25hbWUKICAgICAgICB9CiAgICAgICAgR2V0SnNQcm9wTmFtZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2pzUHJvcE5hbWUKICAgICAgICB9CiAgICAgICAgR2V0SW5kZXgoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pbmRleAogICAgICAgIH0KICAgICAgICBHZXRTSUQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zaWQKICAgICAgICB9CiAgICAgICAgSXNGYW1pbHkoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pc0ZhbWlseQogICAgICAgIH0KICAgICAgICBJc0dsb2JhbCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2lzR2xvYmFsCiAgICAgICAgfQogICAgICAgIElzV29ybGRUeXBlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faXNXb3JsZFR5cGUKICAgICAgICB9CiAgICAgICAgR2V0RmFtaWx5SW5kZXgoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9mYW1pbHlJbmRleAogICAgICAgIH0KICAgICAgICBHZXRCZWhhdmlvclR5cGVzKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fYmVoYXZpb3JUeXBlcwogICAgICAgIH0KICAgICAgICBHZXRCZWhhdmlvclR5cGVzQ291bnQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9iZWhhdmlvcnNDb3VudAogICAgICAgIH0KICAgICAgICBVc2VzQmVoYXZpb3JCeUN0b3IoQ3RvcikgewogICAgICAgICAgICByZXR1cm4gQ3RvciAmJgogICAgICAgICAgICAgICAgdGhpcy5fdXNlZEJlaGF2aW9yQ3RvcnMuaGFzKEN0b3IpCiAgICAgICAgfQogICAgICAgIEdldEluc3RhbmNlVmFyaWFibGVzQ291bnQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pbnN0VmFycy5sZW5ndGgKICAgICAgICB9CiAgICAgICAgR2V0SW5zdGFuY2VWYXJpYWJsZVNJRHMoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pbnN0VmFycy5tYXAoaXYgPT4gaXYuc2lkKQogICAgICAgIH0KICAgICAgICBHZXRJbnN0YW5jZVZhcmlhYmxlSW5kZXhCeVNJRChzaWQpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2luc3RWYXJzLmZpbmRJbmRleChpdiA9PiBpdi5zaWQgPT09IHNpZCkKICAgICAgICB9CiAgICAgICAgR2V0SW5zdGFuY2VWYXJpYWJsZUluZGV4QnlOYW1lKG5hbWUpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2luc3RWYXJzLmZpbmRJbmRleChpdiA9PiBpdi5uYW1lID09PSBuYW1lKQogICAgICAgIH0KICAgICAgICBfR2V0QWxsSW5zdGFuY2VWYXJpYWJsZU5hbWVzKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faW5zdFZhcnMubWFwKGl2ID0+IGl2Lm5hbWUpCiAgICAgICAgfQogICAgICAgIF9HZXRBbGxJbnN0YW5jZVZhcmlhYmxlSnNQcm9wTmFtZXMoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pbnN0VmFycy5tYXAoaXYgPT4gaXYuanNQcm9wTmFtZSkKICAgICAgICB9CiAgICAgICAgR2V0SW5zdGFuY2VWYXJpYWJsZVR5cGUoaSkgewogICAgICAgICAgICBpID0KICAgICAgICAgICAgICAgIE1hdGguZmxvb3IoaSk7CiAgICAgICAgICAgIGlmIChpIDwgMCB8fCBpID49IHRoaXMuX2luc3RWYXJzLmxlbmd0aCkgdGhyb3cgbmV3IFJhbmdlRXJyb3IoImludmFsaWQgaW5zdGFuY2UgdmFyaWFibGUgaW5kZXgiKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2luc3RWYXJzW2ldLnR5cGUKICAgICAgICB9CiAgICAgICAgR2V0SW5zdGFuY2VWYXJpYWJsZU5hbWUoaSkgewogICAgICAgICAgICBpID0gTWF0aC5mbG9vcihpKTsKICAgICAgICAgICAgaWYgKGkgPCAwIHx8IGkgPj0gdGhpcy5faW5zdFZhcnMubGVuZ3RoKSB0aHJvdyBuZXcgUmFuZ2VFcnJvcigiaW52YWxpZCBpbnN0YW5jZSB2YXJpYWJsZSBpbmRleCIpOwogICAgICAgICAgICByZXR1cm4gdGhpcy5faW5zdFZhcnNbaV0ubmFtZQogICAgICAgIH0KICAgICAgICBHZXRFZmZlY3RUeXBlc0NvdW50KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZWZmZWN0c0NvdW50CiAgICAgICAgfQogICAgICAgIEdldEJlaGF2aW9yVHlwZXNJbmNsdWRpbmdJbmhlcml0ZWQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9iZWhhdmlvclR5cGVzSW5jbHVkaW5nSW5oZXJpdGVkCiAgICAgICAgfQogICAgICAgIEdldEJlaGF2aW9yVHlwZUJ5TmFtZShuYW1lKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9iZWhhdmlvcnNCeU5hbWUuZ2V0KG5hbWUudG9Mb3dlckNhc2UoKSkgfHwKICAgICAgICAgICAgICAgIG51bGwKICAgICAgICB9CiAgICAgICAgR2V0QmVoYXZpb3JJbmRleEJ5TmFtZShuYW1lKSB7CiAgICAgICAgICAgIGNvbnN0IHJldCA9IHRoaXMuX2JlaGF2aW9yTmFtZVRvSW5kZXguZ2V0KG5hbWUudG9Mb3dlckNhc2UoKSk7CiAgICAgICAgICAgIGlmICh0eXBlb2YgcmV0ID09PSAidW5kZWZpbmVkIikgcmV0dXJuIC0xOwogICAgICAgICAgICBlbHNlIHJldHVybiByZXQKICAgICAgICB9CiAgICAgICAgR2V0RWZmZWN0TGlzdCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2VmZmVjdExpc3QKICAgICAgICB9CiAgICAgICAgSGFzRWZmZWN0cygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3BsdWdpbi5IYXNFZmZlY3RzKCkKICAgICAgICB9CiAgICAgICAgVXNlc0VmZmVjdHMoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9lZmZlY3RMaXN0ICYmIHRoaXMuX2VmZmVjdExpc3QuSGFzQW55RWZmZWN0VHlwZSgpCiAgICAgICAgfQogICAgICAgIEdldFNvbFN0YWNrKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fc29sU3RhY2sKICAgICAgICB9CiAgICAgICAgR2V0Q3VycmVudFNvbCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NvbFN0YWNrLkdldEN1cnJlbnRTb2woKQogICAgICAgIH0KICAgICAgICBHZXRJbWFnZUluZm8oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pbWFnZUluZm8KICAgICAgICB9CiAgICAgICAgU2V0RGVmYXVsdEluc3RhbmNlRGF0YShkKSB7CiAgICAgICAgICAgIHRoaXMuX2RlZmF1bHRJbnN0YW5jZURhdGEgPSBkCiAgICAgICAgfQogICAgICAgIEdldERlZmF1bHRJbnN0YW5jZURhdGEoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9kZWZhdWx0SW5zdGFuY2VEYXRhCiAgICAgICAgfQogICAgICAgIF9TZXREZWZhdWx0TGF5ZXJJbmRleChpKSB7CiAgICAgICAgICAgIHRoaXMuX2RlZmF1bHRMYXllckluZGV4ID0KICAgICAgICAgICAgICAgIGkKICAgICAgICB9CiAgICAgICAgR2V0RGVmYXVsdExheWVySW5kZXgoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9kZWZhdWx0TGF5ZXJJbmRleAogICAgICAgIH0KICAgICAgICBHZXRBbmltYXRpb25zKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fYW5pbWF0aW9ucwogICAgICAgIH0KICAgICAgICBHZXRBbmltYXRpb25Db3VudCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2FuaW1hdGlvbnMubGVuZ3RoCiAgICAgICAgfQogICAgICAgIEdldEZhbWlsaWVzKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZmFtaWxpZXMKICAgICAgICB9CiAgICAgICAgQmVsb25nc1RvRmFtaWx5KGZhbWlseSkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZmFtaWxpZXNTZXQuaGFzKGZhbWlseSkKICAgICAgICB9CiAgICAgICAgR2V0RmFtaWx5TWVtYmVycygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2ZhbWlseU1lbWJlcnMKICAgICAgICB9CiAgICAgICAgRmFtaWx5SGFzTWVtYmVyKG9iamVjdFR5cGUpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2ZhbWlseU1lbWJlcnNTZXQuaGFzKG9iamVjdFR5cGUpCiAgICAgICAgfQogICAgICAgIEdldEZhbWlseUJlaGF2aW9yT2Zmc2V0KGZhbWlseUluZGV4KSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9mYW1pbHlCZWhhdmlvck1hcFtmYW1pbHlJbmRleF0KICAgICAgICB9CiAgICAgICAgR2V0RmFtaWx5SW5zdGFuY2VWYXJpYWJsZU9mZnNldChmYW1pbHlJbmRleCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZmFtaWx5SW5zdFZhck1hcFtmYW1pbHlJbmRleF0KICAgICAgICB9CiAgICAgICAgQWRkQ3VzdG9tQWN0aW9uKGN1c3RvbUFjZUJsb2NrKSB7CiAgICAgICAgICAgIHRoaXMuX2N1c3RvbUFjdGlvbk1hcC5zZXQoY3VzdG9tQWNlQmxvY2suR2V0QUNFTmFtZSgpLnRvTG93ZXJDYXNlKCksCiAgICAgICAgICAgICAgICBjdXN0b21BY2VCbG9jaykKICAgICAgICB9CiAgICAgICAgSGFzT3duQ3VzdG9tQWN0aW9uQnlOYW1lKG5hbWUpIHsKICAgICAgICAgICAgcmV0dXJuICEhdGhpcy5HZXRPd25DdXN0b21BY3Rpb25CeU5hbWUobmFtZSkKICAgICAgICB9CiAgICAgICAgR2V0T3duQ3VzdG9tQWN0aW9uQnlOYW1lKG5hbWUpIHsKICAgICAgICAgICAgY29uc3QgcmV0ID0gdGhpcy5fY3VzdG9tQWN0aW9uTWFwLmdldChuYW1lLnRvTG93ZXJDYXNlKCkpOwogICAgICAgICAgICByZXR1cm4gcmV0ICYmIHJldC5Jc0VuYWJsZWQoKSA/IHJldCA6IG51bGwKICAgICAgICB9CiAgICAgICAgR2V0QW5pbWF0aW9uQnlOYW1lKG5hbWUpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLl9hbmltYXRpb25zKSB0aHJvdyBuZXcgRXJyb3IoIm5vIGFuaW1hdGlvbnMiKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2FuaW1hdGlvbnNCeU5hbWUuZ2V0KG5hbWUudG9Mb3dlckNhc2UoKSkgfHwgbnVsbAogICAgICAgIH0KICAgICAgICBHZXRBbmltYXRpb25CeVNJRChzaWQpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLl9hbmltYXRpb25zKSB0aHJvdyBuZXcgRXJyb3IoIm5vIGFuaW1hdGlvbnMiKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2FuaW1hdGlvbnNCeVNpZC5nZXQoc2lkKSB8fCBudWxsCiAgICAgICAgfQogICAgICAgIEdldEZpcnN0QW5pbWF0aW9uRnJhbWUoKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5fYW5pbWF0aW9ucykgdGhyb3cgbmV3IEVycm9yKCJubyBhbmltYXRpb25zIik7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9hbmltYXRpb25zWzBdLkdldEZyYW1lQXQoMCkKICAgICAgICB9CiAgICAgICAgR2V0RGVmYXVsdEluc3RhbmNlU2l6ZSgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX2FuaW1hdGlvbnMpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGZpcnN0RnJhbWVJbmZvID0gdGhpcy5HZXRGaXJzdEFuaW1hdGlvbkZyYW1lKCkuR2V0SW1hZ2VJbmZvKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gW2ZpcnN0RnJhbWVJbmZvLkdldFdpZHRoKCksIGZpcnN0RnJhbWVJbmZvLkdldEhlaWdodCgpXQogICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuX2ltYWdlSW5mbykgcmV0dXJuIFt0aGlzLl9pbWFnZUluZm8uR2V0V2lkdGgoKSwgdGhpcy5faW1hZ2VJbmZvLkdldEhlaWdodCgpXTsKICAgICAgICAgICAgZWxzZSByZXR1cm4gWzEwMCwgMTAwXQogICAgICAgIH0KICAgICAgICBHZXRTaW5nbGVHbG9iYWxJbnN0YW5jZSgpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLl9wbHVnaW4uSXNTaW5nbGVHbG9iYWwoKSkgdGhyb3cgbmV3IEVycm9yKCJub3QgYSBzaW5nbGUtZ2xvYmFsIHBsdWdpbiIpOwogICAgICAgICAgICByZXR1cm4gdGhpcy5faW5zdGFuY2VzWzBdCiAgICAgICAgfQogICAgICAgIEdldEluc3RhbmNlcygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2luc3RhbmNlcwogICAgICAgIH0qIGluc3RhbmNlcygpIHsKICAgICAgICAgICAgeWllbGQqIHRoaXMuX2luc3RhbmNlcwogICAgICAgIH0qIGluc3RhbmNlc0luY2x1ZGluZ1BlbmRpbmdDcmVhdGUoKSB7CiAgICAgICAgICAgIHlpZWxkKiB0aGlzLl9pbnN0YW5jZXM7CiAgICAgICAgICAgIHlpZWxkKiB0aGlzLl9ydW50aW1lLmluc3RhbmNlc1BlbmRpbmdDcmVhdGVGb3JPYmplY3RDbGFzcyh0aGlzKQogICAgICAgIH0KICAgICAgICBHZXRJbnN0YW5jZUNvdW50KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faW5zdGFuY2VzLmxlbmd0aAogICAgICAgIH0KICAgICAgICBfQWRkSW5zdGFuY2UoaW5zdCkgewogICAgICAgICAgICB0aGlzLl9pbnN0YW5jZXMucHVzaChpbnN0KQogICAgICAgIH0KICAgICAgICBfU2V0SUlEc1N0YWxlKCkgewogICAgICAgICAgICB0aGlzLl9paWRzU3RhbGUgPSB0cnVlCiAgICAgICAgfQogICAgICAgIF9VcGRhdGVJSURzKCkgewogICAgICAgICAgICBpZiAoIXRoaXMuX2lpZHNTdGFsZSB8fCB0aGlzLl9pc0ZhbWlseSkgcmV0dXJuOwogICAgICAgICAgICBjb25zdCBpbnN0YW5jZXMgPSB0aGlzLl9pbnN0YW5jZXM7CiAgICAgICAgICAgIGxldCBpID0gMDsKICAgICAgICAgICAgZm9yIChsZXQgbGVuID0gaW5zdGFuY2VzLmxlbmd0aDsgaSA8IGxlbjsgKytpKSBpbnN0YW5jZXNbaV0uX1NldElJRChpKTsKICAgICAgICAgICAgY29uc3QgaW5zdGFuY2VzUGVuZGluZ0NyZWF0ZSA9IHRoaXMuX3J1bnRpbWUuX0dldEluc3RhbmNlc1BlbmRpbmdDcmVhdGUoKTsKICAgICAgICAgICAgZm9yIChjb25zdCBpbnN0IG9mIGluc3RhbmNlc1BlbmRpbmdDcmVhdGUpCiAgICAgICAgICAgICAgICBpZiAoaW5zdC5HZXRPYmplY3RDbGFzcygpID09PSB0aGlzKSBpbnN0Ll9TZXRJSUQoaSsrKTsKICAgICAgICAgICAgdGhpcy5faWlkc1N0YWxlID0gZmFsc2UKICAgICAgICB9CiAgICAgICAgR2V0SW5zdGFuY2VCeUlJRChpKSB7CiAgICAgICAgICAgIGNvbnN0IGluc3RhbmNlcyA9IHRoaXMuX2luc3RhbmNlczsKICAgICAgICAgICAgaWYgKGkgPCBpbnN0YW5jZXMubGVuZ3RoKSByZXR1cm4gaW5zdGFuY2VzW2ldOwogICAgICAgICAgICBpIC09IGluc3RhbmNlcy5sZW5ndGg7CiAgICAgICAgICAgIGNvbnN0IGluc3RhbmNlc1BlbmRpbmdDcmVhdGUgPSB0aGlzLl9ydW50aW1lLl9HZXRJbnN0YW5jZXNQZW5kaW5nQ3JlYXRlKCk7CiAgICAgICAgICAgIGZvciAoY29uc3QgaW5zdCBvZiBpbnN0YW5jZXNQZW5kaW5nQ3JlYXRlKQogICAgICAgICAgICAgICAgaWYgKGluc3QuR2V0T2JqZWN0Q2xhc3MoKSA9PT0gdGhpcykgewogICAgICAgICAgICAgICAgICAgIGlmIChpID09PSAwKSByZXR1cm4gaW5zdDsKICAgICAgICAgICAgICAgICAgICAtLWkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG51bGwKICAgICAgICB9CiAgICAgICAgR2V0Rmlyc3RQaWNrZWQoZnJvbUluc3QpIHsKICAgICAgICAgICAgaWYgKGZyb21JbnN0ICYmIGZyb21JbnN0LklzSW5Db250YWluZXIoKSAmJiBmcm9tSW5zdC5HZXRPYmplY3RDbGFzcygpICE9PSB0aGlzKQogICAgICAgICAgICAgICAgZm9yIChjb25zdCBzIG9mIGZyb21JbnN0LnNpYmxpbmdzKCkpCiAgICAgICAgICAgICAgICAgICAgaWYgKHMuR2V0T2JqZWN0Q2xhc3MoKSA9PT0gdGhpcykgcmV0dXJuIHM7CiAgICAgICAgICAgIGNvbnN0IGluc3RhbmNlcyA9CiAgICAgICAgICAgICAgICB0aGlzLkdldEN1cnJlbnRTb2woKS5HZXRJbnN0YW5jZXMoKTsKICAgICAgICAgICAgaWYgKGluc3RhbmNlcy5sZW5ndGgpIHJldHVybiBpbnN0YW5jZXNbMF07CiAgICAgICAgICAgIGVsc2UgcmV0dXJuIG51bGwKICAgICAgICB9CiAgICAgICAgR2V0UGFpcmVkSW5zdGFuY2UoaW5zdCkgewogICAgICAgICAgICBjb25zdCBpbnN0YW5jZXMgPSB0aGlzLkdldEN1cnJlbnRTb2woKS5HZXRJbnN0YW5jZXMoKTsKICAgICAgICAgICAgaWYgKGluc3RhbmNlcy5sZW5ndGggPiAwKSByZXR1cm4gaW5zdGFuY2VzW2luc3QuR2V0SUlEKCkgJSBpbnN0YW5jZXMubGVuZ3RoXTsKICAgICAgICAgICAgZWxzZSByZXR1cm4gbnVsbAogICAgICAgIH0qIGFsbENvcnJlc3BvbmRpbmdJbnN0YW5jZXMoaW5zdCwgb2JqZWN0Q2xhc3MpIHsKICAgICAgICAgICAgY29uc3QgbXlJbnN0YW5jZXMgPSB0aGlzLkdldEN1cnJlbnRTb2woKS5HZXRJbnN0YW5jZXMoKTsKICAgICAgICAgICAgY29uc3QgbXlJbnN0YW5jZUNvdW50ID0gbXlJbnN0YW5jZXMubGVuZ3RoOwogICAgICAgICAgICBjb25zdCBvdGhlclNvbCA9IG9iamVjdENsYXNzLkdldEN1cnJlbnRTb2woKTsKICAgICAgICAgICAgY29uc3Qgb3RoZXJJbnN0YW5jZXMgPSBvYmplY3RDbGFzcy5HZXRDdXJyZW50U29sKCkuR2V0SW5zdGFuY2VzKCk7CiAgICAgICAgICAgIGNvbnN0IG90aGVySW5zdGFuY2VDb3VudCA9IG90aGVySW5zdGFuY2VzLmxlbmd0aDsKICAgICAgICAgICAgbGV0IGluZGV4ID0gaW5zdC5HZXRJSUQoKTsKICAgICAgICAgICAgaWYgKG9iamVjdENsYXNzLklzRmFtaWx5KCkgfHwgIW90aGVyU29sLklzU2VsZWN0QWxsKCkpIGluZGV4ID0gb3RoZXJJbnN0YW5jZXMuaW5kZXhPZihpbnN0KTsKICAgICAgICAgICAgY29uc3QgZGl2aXNvciA9IE1hdGguY2VpbChteUluc3RhbmNlQ291bnQgLyBvdGhlckluc3RhbmNlQ291bnQpOwogICAgICAgICAgICBjb25zdCByZW1haW5kZXIgPSBteUluc3RhbmNlQ291bnQgJSBvdGhlckluc3RhbmNlQ291bnQ7CiAgICAgICAgICAgIGxldCBzdGFydEluZGV4ID0gMDsKICAgICAgICAgICAgbGV0IGNvcnJlc3BvbmRDb3VudCA9IDA7CiAgICAgICAgICAgIGlmIChyZW1haW5kZXIgPT09IDAgfHwgaW5kZXggPCByZW1haW5kZXIpIHsKICAgICAgICAgICAgICAgIHN0YXJ0SW5kZXggPSBpbmRleCAqIGRpdmlzb3I7CiAgICAgICAgICAgICAgICBjb3JyZXNwb25kQ291bnQgPSBkaXZpc29yCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBzdGFydEluZGV4ID0gcmVtYWluZGVyICogZGl2aXNvciArIChpbmRleCAtIHJlbWFpbmRlcikgKiAoZGl2aXNvciAtIDEpOwogICAgICAgICAgICAgICAgY29ycmVzcG9uZENvdW50ID0gZGl2aXNvciAtIDEKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IgKGxldCBpID0gc3RhcnRJbmRleCwKICAgICAgICAgICAgICAgICAgICBlbmQgPSBzdGFydEluZGV4ICsgY29ycmVzcG9uZENvdW50OyBpIDwgZW5kOyArK2kpIHlpZWxkIG15SW5zdGFuY2VzW2ldCiAgICAgICAgfQogICAgICAgIEZpbmlzaENvbmRpdGlvbihmKSB7CiAgICAgICAgICAgIHRoaXMuX3Nka1R5cGUuRmluaXNoQ29uZGl0aW9uKGYpCiAgICAgICAgfQogICAgICAgIEFwcGx5U29sVG9Db250YWluZXIoKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5faXNJbkNvbnRhaW5lciB8fCB0aGlzLl9pc0ZhbWlseSkgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl9VcGRhdGVJSURzKCk7CiAgICAgICAgICAgIGNvbnN0IHNvbDEgPSB0aGlzLkdldEN1cnJlbnRTb2woKTsKICAgICAgICAgICAgY29uc3Qgc29sMWluc3RhbmNlcyA9IHNvbDEuX0dldE93bkluc3RhbmNlcygpOwogICAgICAgICAgICBjb25zdCBzZWxlY3RBbGwgPSBzb2wxLklzU2VsZWN0QWxsKCk7CiAgICAgICAgICAgIGNvbnN0IGVzID0gdGhpcy5fcnVudGltZS5HZXRDdXJyZW50RXZlbnRTdGFja0ZyYW1lKCk7CiAgICAgICAgICAgIGNvbnN0IGlzT3JCbG9jayA9IGVzICYmIGVzLkdldEN1cnJlbnRFdmVudCgpICYmIGVzLkdldEN1cnJlbnRFdmVudCgpLklzT3JCbG9jaygpOwogICAgICAgICAgICBmb3IgKGNvbnN0IGNvbnRhaW5lclR5cGUgb2YgdGhpcy5fY29udGFpbmVyLm9iamVjdFR5cGVzKCkpIHsKICAgICAgICAgICAgICAgIGlmIChjb250YWluZXJUeXBlID09PQogICAgICAgICAgICAgICAgICAgIHRoaXMpIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgY29udGFpbmVyVHlwZS5fVXBkYXRlSUlEcygpOwogICAgICAgICAgICAgICAgY29uc3Qgc29sMiA9IGNvbnRhaW5lclR5cGUuR2V0Q3VycmVudFNvbCgpOwogICAgICAgICAgICAgICAgc29sMi5fU2V0U2VsZWN0QWxsKHNlbGVjdEFsbCk7CiAgICAgICAgICAgICAgICBpZiAoIXNlbGVjdEFsbCkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNvbDJpbnN0YW5jZXMgPSBzb2wyLl9HZXRPd25JbnN0YW5jZXMoKTsKICAgICAgICAgICAgICAgICAgICBDMy5jbGVhckFycmF5KHNvbDJpbnN0YW5jZXMpOwogICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgaW5zdCBvZiBzb2wxaW5zdGFuY2VzKSBzb2wyaW5zdGFuY2VzLnB1c2goY29udGFpbmVyVHlwZS5HZXRJbnN0YW5jZUJ5SUlEKGluc3QuR2V0SUlEKCkpKTsKICAgICAgICAgICAgICAgICAgICBpZiAoaXNPckJsb2NrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHNvbDFlbHNlSW5zdGFuY2VzID0gc29sMS5fR2V0T3duRWxzZUluc3RhbmNlcygpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzb2wyZWxzZUluc3RhbmNlcyA9IHNvbDIuX0dldE93bkVsc2VJbnN0YW5jZXMoKTsKICAgICAgICAgICAgICAgICAgICAgICAgQzMuY2xlYXJBcnJheShzb2wyZWxzZUluc3RhbmNlcyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgaW5zdCBvZiBzb2wxZWxzZUluc3RhbmNlcykgc29sMmVsc2VJbnN0YW5jZXMucHVzaChjb250YWluZXJUeXBlLkdldEluc3RhbmNlQnlJSUQoaW5zdC5HZXRJSUQoKSkpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIF9UcnVuY2F0ZUNvbnRhaW5lclNvbHModXNlRWxzZUluc3RhbmNlcywKICAgICAgICAgICAgaSkgewogICAgICAgICAgICBmb3IgKGNvbnN0IGNvbnRhaW5lclR5cGUgb2YgdGhpcy5HZXRDb250YWluZXIoKS5vYmplY3RUeXBlcygpKSB7CiAgICAgICAgICAgICAgICBjb25zdCBzb2wgPSBjb250YWluZXJUeXBlLkdldEN1cnJlbnRTb2woKTsKICAgICAgICAgICAgICAgIGlmICh1c2VFbHNlSW5zdGFuY2VzKSBDMy50cnVuY2F0ZUFycmF5KHNvbC5fR2V0T3duRWxzZUluc3RhbmNlcygpLCBpKTsKICAgICAgICAgICAgICAgIGVsc2UgQzMudHJ1bmNhdGVBcnJheShzb2wuX0dldE93bkluc3RhbmNlcygpLCBpKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIF9HZXRDb2xsaXNpb25DZWxsR3JpZCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NvbGxpc2lvbkdyaWQKICAgICAgICB9CiAgICAgICAgX1NldEFueUNvbGxpc2lvbkNlbGxDaGFuZ2VkKGMpIHsKICAgICAgICAgICAgdGhpcy5fYW55Q29sbGlzaW9uQ2VsbENoYW5nZWQgPSAhIWMKICAgICAgICB9CiAgICAgICAgX1NldEFueUluc3RhbmNlUGFyYWxsYXhlZChwKSB7CiAgICAgICAgICAgIHRoaXMuX2FueUluc3RhbmNlUGFyYWxsYXhlZCA9ICEhcAogICAgICAgIH0KICAgICAgICBJc0FueUluc3RhbmNlUGFyYWxsYXhlZCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2FueUluc3RhbmNlUGFyYWxsYXhlZAogICAgICAgIH0KICAgICAgICBfVXBkYXRlQWxsQ29sbGlzaW9uQ2VsbHMoKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5fYW55Q29sbGlzaW9uQ2VsbENoYW5nZWQgfHwKICAgICAgICAgICAgICAgICF0aGlzLl9pc1dvcmxkVHlwZSkgcmV0dXJuOwogICAgICAgICAgICBmb3IgKGNvbnN0IGluc3Qgb2YgdGhpcy5faW5zdGFuY2VzKSBpbnN0LkdldFdvcmxkSW5mbygpLl9VcGRhdGVDb2xsaXNpb25DZWxsKCk7CiAgICAgICAgICAgIGZvciAoY29uc3QgaW5zdCBvZiB0aGlzLl9ydW50aW1lLl9HZXRJbnN0YW5jZXNQZW5kaW5nQ3JlYXRlKCkpCiAgICAgICAgICAgICAgICBpZiAoaW5zdC5HZXRPYmplY3RDbGFzcygpID09PSB0aGlzKSBpbnN0LkdldFdvcmxkSW5mbygpLl9VcGRhdGVDb2xsaXNpb25DZWxsKCk7CiAgICAgICAgICAgIHRoaXMuX2FueUNvbGxpc2lvbkNlbGxDaGFuZ2VkID0gZmFsc2UKICAgICAgICB9CiAgICAgICAgR2V0U2F2ZWREYXRhTWFwKCkgewogICAgICAgICAgICBpZiAoIXRoaXMuX3NhdmVkRGF0YSkgdGhpcy5fc2F2ZWREYXRhID0gbmV3IE1hcDsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NhdmVkRGF0YQogICAgICAgIH0KICAgICAgICBHZXRVbnNhdmVkRGF0YU1hcCgpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLl91bnNhdmVkRGF0YSkgdGhpcy5fdW5zYXZlZERhdGEgPSBuZXcgTWFwOwogICAgICAgICAgICByZXR1cm4gdGhpcy5fdW5zYXZlZERhdGEKICAgICAgICB9CiAgICAgICAgSGFzU29saWRCZWhhdmlvcigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuVXNlc0JlaGF2aW9yQnlDdG9yKEMzLkJlaGF2aW9ycy5zb2xpZCkKICAgICAgICB9CiAgICAgICAgSGFzSnVtcHRocnVCZWhhdmlvcigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuVXNlc0JlaGF2aW9yQnlDdG9yKEMzLkJlaGF2aW9ycy5qdW1wdGhydSkKICAgICAgICB9CiAgICAgICAgSGFzTm9TYXZlQmVoYXZpb3IoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLlVzZXNCZWhhdmlvckJ5Q3RvcihDMy5CZWhhdmlvcnMuTm9TYXZlKQogICAgICAgIH0KICAgICAgICBIYXNQZXJzaXN0QmVoYXZpb3IoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLlVzZXNCZWhhdmlvckJ5Q3RvcihDMy5CZWhhdmlvcnMuUGVyc2lzdCkKICAgICAgICB9CiAgICAgICAgX1NhdmVUb0pzb24oKSB7CiAgICAgICAgICAgIGNvbnN0IG8gPSB7CiAgICAgICAgICAgICAgICAiaW5zdGFuY2VzIjogdGhpcy5faW5zdGFuY2VzLm1hcChpbnN0ID0+IGluc3QuU2F2ZVRvSnNvbigpKQogICAgICAgICAgICB9OwogICAgICAgICAgICBpZiAodGhpcy5fc2F2ZWREYXRhICYmIHRoaXMuX3NhdmVkRGF0YS5zaXplKSBvWyJleCJdID0gQzMuVG9TdXBlckpTT04odGhpcy5fc2F2ZWREYXRhKTsKICAgICAgICAgICAgcmV0dXJuIG8KICAgICAgICB9CiAgICAgICAgX0xvYWRGcm9tSnNvbihvKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9zYXZlZERhdGEpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3NhdmVkRGF0YS5jbGVhcigpOwogICAgICAgICAgICAgICAgdGhpcy5fc2F2ZWREYXRhID0gbnVsbAogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IGV4ID0gb1siZXgiXTsKICAgICAgICAgICAgaWYgKGV4KSB0aGlzLl9zYXZlZERhdGEgPSBDMy5Gcm9tU3VwZXJKU09OKGV4KTsKICAgICAgICAgICAgY29uc3QgZXhpc3RpbmdJbnN0YW5jZXMgPSB0aGlzLl9pbnN0YW5jZXM7CiAgICAgICAgICAgIGNvbnN0IGxvYWRJbnN0YW5jZXMgPSBvWyJpbnN0YW5jZXMiXTsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IE1hdGgubWluKGV4aXN0aW5nSW5zdGFuY2VzLmxlbmd0aCwgbG9hZEluc3RhbmNlcy5sZW5ndGgpOyBpIDwgbGVuOyArK2kpIGV4aXN0aW5nSW5zdGFuY2VzW2ldLkxvYWRGcm9tSnNvbihsb2FkSW5zdGFuY2VzW2ldKTsKICAgICAgICAgICAgZm9yIChsZXQgaSA9CiAgICAgICAgICAgICAgICAgICAgbG9hZEluc3RhbmNlcy5sZW5ndGgsIGxlbiA9IGV4aXN0aW5nSW5zdGFuY2VzLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB0aGlzLl9ydW50aW1lLkRlc3Ryb3lJbnN0YW5jZShleGlzdGluZ0luc3RhbmNlc1tpXSk7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSBleGlzdGluZ0luc3RhbmNlcy5sZW5ndGgsIGxlbiA9IGxvYWRJbnN0YW5jZXMubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBsb2FkSW5zdGFuY2VzW2ldOwogICAgICAgICAgICAgICAgbGV0IGxheWVyID0gbnVsbDsKICAgICAgICAgICAgICAgIGlmICh0aGlzLklzV29ybGRUeXBlKCkpIHsKICAgICAgICAgICAgICAgICAgICBsYXllciA9IHRoaXMuX3J1bnRpbWUuR2V0TWFpblJ1bm5pbmdMYXlvdXQoKS5HZXRMYXllckJ5U0lEKGRhdGFbInciXVsibCJdKTsKICAgICAgICAgICAgICAgICAgICBpZiAoIWxheWVyKSBjb250aW51ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY29uc3QgaW5zdCA9IHRoaXMuX3J1bnRpbWUuQ3JlYXRlSW5zdGFuY2VGcm9tRGF0YSh0aGlzLl9kZWZhdWx0SW5zdGFuY2VEYXRhIHx8IHRoaXMsIGxheWVyLCBmYWxzZSwgMCwgMCwgdHJ1ZSk7CiAgICAgICAgICAgICAgICBpbnN0LkxvYWRGcm9tSnNvbihkYXRhKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuX2xvYWRJbnN0YW5jZXNKc29uID0gbG9hZEluc3RhbmNlczsKICAgICAgICAgICAgdGhpcy5fU2V0SUlEc1N0YWxlKCkKICAgICAgICB9CiAgICAgICAgX0dldExvYWRJbnN0YW5jZXNKc29uKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fbG9hZEluc3RhbmNlc0pzb24KICAgICAgICB9CiAgICAgICAgX0NsZWFyTG9hZEluc3RhbmNlc0pzb24oKSB7CiAgICAgICAgICAgIHRoaXMuX2xvYWRJbnN0YW5jZXNKc29uID0gbnVsbAogICAgICAgIH0KICAgICAgICBfU2V0dXBTY2VuZUdyYXBoQ29ubmVjdGlvbnNPbkNoYW5nZU9mTGF5b3V0KCkgewogICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gdGhpcy5faW5zdGFuY2VzOyBpIDwgbGVuOyArK2kpIHRoaXMuX2luc3RhbmNlc1tpXS5fU2V0dXBTY2VuZUdyYXBoQ29ubmVjdGlvbnNPbkNoYW5nZU9mTGF5b3V0KCkKICAgICAgICB9CiAgICAgICAgR2V0SU9iamVjdENsYXNzKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faU9iamVjdENsYXNzCiAgICAgICAgfQogICAgICAgIFVzZXJTY3JpcHREaXNwYXRjaGVyKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fdXNlclNjcmlwdERpc3BhdGNoZXIKICAgICAgICB9CiAgICAgICAgX0dldFVzZXJTY3JpcHRJbnN0YW5jZUNsYXNzKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faW5zdGFuY2VVc2VyU2NyaXB0Q2xhc3MKICAgICAgICB9CiAgICAgICAgX1NldFVzZXJTY3JpcHRJbnN0YW5jZUNsYXNzKENsYXNzKSB7CiAgICAgICAgICAgIHRoaXMuX2luc3RhbmNlVXNlclNjcmlwdENsYXNzID0KICAgICAgICAgICAgICAgIENsYXNzCiAgICAgICAgfQogICAgICAgIERpc3BhdGNoVXNlclNjcmlwdEV2ZW50KGUpIHsKICAgICAgICAgICAgY29uc3QgcnVudGltZSA9IHRoaXMuX3J1bnRpbWU7CiAgICAgICAgICAgIGNvbnN0IHNob3VsZFRpbWUgPSBydW50aW1lLklzRGVidWcoKSAmJiAhcnVudGltZS5HZXRFdmVudFNoZWV0TWFuYWdlcigpLklzSW5FdmVudEVuZ2luZSgpOwogICAgICAgICAgICBpZiAoc2hvdWxkVGltZSkgQzNEZWJ1Z2dlci5TdGFydE1lYXN1cmluZ1NjcmlwdFRpbWUoKTsKICAgICAgICAgICAgdGhpcy5fdXNlclNjcmlwdERpc3BhdGNoZXIuZGlzcGF0Y2hFdmVudChlKTsKICAgICAgICAgICAgaWYgKHNob3VsZFRpbWUpIEMzRGVidWdnZXIuQWRkU2NyaXB0VGltZSgpCiAgICAgICAgfQogICAgfTsKCn0KCi8vIG9iamVjdHMvY29udGFpbmVyLmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIEMzLkNvbnRhaW5lciA9IGNsYXNzIENvbnRhaW5lciBleHRlbmRzIEMzLkRlZmVuZGVkQmFzZSB7CiAgICAgICAgY29uc3RydWN0b3IocnVudGltZSwgb2JqZWN0VHlwZXMpIHsKICAgICAgICAgICAgc3VwZXIoKTsKICAgICAgICAgICAgdGhpcy5fcnVudGltZSA9IHJ1bnRpbWU7CiAgICAgICAgICAgIHRoaXMuX29iamVjdFR5cGVzID0gb2JqZWN0VHlwZXM7CiAgICAgICAgICAgIGZvciAoY29uc3Qgb2JqZWN0VHlwZSBvZiB0aGlzLl9vYmplY3RUeXBlcykgb2JqZWN0VHlwZS5fU2V0Q29udGFpbmVyKHRoaXMpCiAgICAgICAgfQogICAgICAgIFJlbGVhc2UoKSB7CiAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUgPSBudWxsCiAgICAgICAgfQogICAgICAgIEdldFJ1bnRpbWUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lCiAgICAgICAgfQogICAgICAgIEdldE9iamVjdFR5cGVzKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fb2JqZWN0VHlwZXMKICAgICAgICB9CiAgICAgICAgb2JqZWN0VHlwZXMoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9vYmplY3RUeXBlcwogICAgICAgIH0KICAgICAgICBIYXNBbnlXb3JsZFR5cGUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9vYmplY3RUeXBlcy5zb21lKG8gPT4gby5Jc1dvcmxkVHlwZSgpKQogICAgICAgIH0KICAgIH07Cgp9CgovLyBvYmplY3RzL2luc3RhbmNlLmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIGNvbnN0IEMzRGVidWdnZXIgPSBzZWxmLkMzRGVidWdnZXI7CiAgICBjb25zdCBJSW5zdGFuY2UgPSBzZWxmLklJbnN0YW5jZTsKICAgIGNvbnN0IEVNUFRZX0FSUkFZID0gW107CiAgICBsZXQgbmV4dFB1aWQgPSAwOwogICAgY29uc3Qgc2F2ZWREYXRhTWFwcyA9IG5ldyBXZWFrTWFwOwogICAgY29uc3QgdW5zYXZlZERhdGFNYXBzID0gbmV3IFdlYWtNYXA7CiAgICBjb25zdCBGTEFHX0RFU1RST1lFRCA9IDEgPDwgMDsKICAgIGNvbnN0IEZMQUdfVElMRU1BUCA9IDEgPDwgMTsKICAgIGNvbnN0IEZMQUdfTVVTVF9QUkVEUkFXID0gMSA8PCAyOwogICAgY29uc3QgRkxBR19TT0xJRF9FTkFCTEVEID0gMSA8PCAzOwogICAgY29uc3QgRkxBR19KVU1QVEhSVV9FTkFCTEVEID0gMSA8PCA0OwogICAgY29uc3QgRkxBR19NVVNUX01JVElHQVRFX1pfRklHSFRJTkcgPSAxIDw8IDU7CiAgICBjb25zdCBGTEFHX0lTX0RSQVdJTkdfV0lUSF9FRkZFQ1RTID0gMSA8PCA2OwogICAgQzMuSW5zdGFuY2UgPSBjbGFzcyBJbnN0YW5jZSBleHRlbmRzIEMzLkRlZmVuZGVkQmFzZSB7CiAgICAgICAgY29uc3RydWN0b3Iob3B0cykgewogICAgICAgICAgICBzdXBlcigpOwogICAgICAgICAgICB0aGlzLl9ydW50aW1lID0gb3B0cy5ydW50aW1lOwogICAgICAgICAgICB0aGlzLl9vYmplY3RUeXBlID0gb3B0cy5vYmplY3RUeXBlOwogICAgICAgICAgICB0aGlzLl93b3JsZEluZm8gPSBudWxsOwogICAgICAgICAgICB0aGlzLl9zZGtJbnN0ID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5faVNjcmlwdEludGVyZmFjZSA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX2lpZCA9IDA7CiAgICAgICAgICAgIHRoaXMuX3VpZCA9IG9wdHMudWlkOwogICAgICAgICAgICB0aGlzLl9wdWlkID0gbmV4dFB1aWQrKzsKICAgICAgICAgICAgdGhpcy5fZmxhZ3MgPSAwOwogICAgICAgICAgICB0aGlzLl9pbnN0VmFyVmFsdWVzID0gRU1QVFlfQVJSQVk7CiAgICAgICAgICAgIHRoaXMuX2JlaGF2aW9ySW5zdGFuY2VzID0gRU1QVFlfQVJSQVk7CiAgICAgICAgICAgIGNvbnN0IGJlaGF2aW9yVHlwZXMgPSB0aGlzLl9vYmplY3RUeXBlLkdldEJlaGF2aW9yVHlwZXNJbmNsdWRpbmdJbmhlcml0ZWQoKTsKICAgICAgICAgICAgaWYgKGJlaGF2aW9yVHlwZXMubGVuZ3RoID4gMCkgdGhpcy5fYmVoYXZpb3JJbnN0YW5jZXMgPSBiZWhhdmlvclR5cGVzLm1hcCgoYmVoYXZpb3JUeXBlLCBpbmRleCkgPT4KICAgICAgICAgICAgICAgIEMzLk5ldyhDMy5CZWhhdmlvckluc3RhbmNlLCB7CiAgICAgICAgICAgICAgICAgICAgcnVudGltZTogdGhpcy5fcnVudGltZSwKICAgICAgICAgICAgICAgICAgICBiZWhhdmlvclR5cGU6IGJlaGF2aW9yVHlwZSwKICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZTogdGhpcywKICAgICAgICAgICAgICAgICAgICBpbmRleAogICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICB0aGlzLl9zaWJsaW5ncyA9IHRoaXMuX29iamVjdFR5cGUuSXNJbkNvbnRhaW5lcigpID8gW10gOiBudWxsOwogICAgICAgICAgICB0aGlzLl90aW1lU2NhbGUgPSAtMTsKICAgICAgICAgICAgdGhpcy5fZGlzcGF0Y2hlciA9IG51bGw7CiAgICAgICAgICAgIGNvbnN0IHBsdWdpbiA9IHRoaXMuR2V0UGx1Z2luKCk7CiAgICAgICAgICAgIGlmIChwbHVnaW4uTXVzdFByZURyYXcoKSkgdGhpcy5fZmxhZ3MgfD0gRkxBR19NVVNUX1BSRURSQVc7CiAgICAgICAgICAgIGlmIChwbHVnaW4uSXNXb3JsZFR5cGUoKSkgewogICAgICAgICAgICAgICAgdGhpcy5fd29ybGRJbmZvID0gQzMuTmV3KEMzLldvcmxkSW5mbywgdGhpcywgb3B0cy5sYXllcik7CiAgICAgICAgICAgICAgICBpZiAob3B0cy53b3JsZERhdGEpIHRoaXMuX3dvcmxkSW5mby5Jbml0KG9wdHMud29ybGREYXRhKTsKICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX3dvcmxkSW5mby5Jbml0Tm9EYXRhKCk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgW3dpZHRoLCBoZWlnaHRdID0gdGhpcy5fb2JqZWN0VHlwZS5HZXREZWZhdWx0SW5zdGFuY2VTaXplKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fd29ybGRJbmZvLlNldFNpemUod2lkdGgsIGhlaWdodCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuR2V0T2JqZWN0Q2xhc3MoKS5Vc2VzRWZmZWN0cygpKSB0aGlzLl93b3JsZEluZm8uR2V0SW5zdGFuY2VFZmZlY3RMaXN0KCkuTG9hZERlZmF1bHRFZmZlY3RQYXJhbWV0ZXJzKCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAob3B0cy5pbnN0VmFyRGF0YSkgdGhpcy5fTG9hZEluc3RhbmNlVmFyaWFibGVEYXRhKG9wdHMuaW5zdFZhckRhdGEpOwogICAgICAgICAgICBlbHNlIHRoaXMuX0xvYWREZWZhdWx0SW5zdGFuY2VWYXJpYWJsZXMoKQogICAgICAgIH0KICAgICAgICBSZWxlYXNlKCkgewogICAgICAgICAgICBpZiAodGhpcy5faVNjcmlwdEludGVyZmFjZSkgewogICAgICAgICAgICAgICAgdGhpcy5faVNjcmlwdEludGVyZmFjZS5fUmVsZWFzZSgpOwogICAgICAgICAgICAgICAgdGhpcy5faVNjcmlwdEludGVyZmFjZSA9IG51bGwKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGhpcy5fYmVoYXZpb3JJbnN0YW5jZXMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgZm9yIChjb25zdCBiZWhJbnN0IG9mIHRoaXMuX2JlaGF2aW9ySW5zdGFuY2VzKSBiZWhJbnN0LlJlbGVhc2UoKTsKICAgICAgICAgICAgICAgIEMzLmNsZWFyQXJyYXkodGhpcy5fYmVoYXZpb3JJbnN0YW5jZXMpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5fc2RrSW5zdC5SZWxlYXNlKCk7CiAgICAgICAgICAgIHRoaXMuX3Nka0luc3QgPSBudWxsOwogICAgICAgICAgICBjb25zdCBzYXZlZERhdGEgPSBzYXZlZERhdGFNYXBzLmdldCh0aGlzKTsKICAgICAgICAgICAgaWYgKHNhdmVkRGF0YSkgewogICAgICAgICAgICAgICAgc2F2ZWREYXRhLmNsZWFyKCk7CiAgICAgICAgICAgICAgICBzYXZlZERhdGFNYXBzLmRlbGV0ZSh0aGlzKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IHVuc2F2ZWREYXRhID0gdW5zYXZlZERhdGFNYXBzLmdldCh0aGlzKTsKICAgICAgICAgICAgaWYgKHVuc2F2ZWREYXRhKSB7CiAgICAgICAgICAgICAgICB1bnNhdmVkRGF0YS5jbGVhcigpOwogICAgICAgICAgICAgICAgdW5zYXZlZERhdGFNYXBzLmRlbGV0ZSh0aGlzKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLl9zaWJsaW5ncykgQzMuY2xlYXJBcnJheSh0aGlzLl9zaWJsaW5ncyk7CiAgICAgICAgICAgIGlmICh0aGlzLl9kaXNwYXRjaGVyKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9kaXNwYXRjaGVyLlJlbGVhc2UoKTsKICAgICAgICAgICAgICAgIHRoaXMuX2Rpc3BhdGNoZXIgPSBudWxsCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5fcnVudGltZSA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX29iamVjdFR5cGUgPSBudWxsOwogICAgICAgICAgICBpZiAodGhpcy5faW5zdFZhclZhbHVlcy5sZW5ndGggPiAwKSBDMy5jbGVhckFycmF5KHRoaXMuX2luc3RWYXJWYWx1ZXMpOwogICAgICAgICAgICBpZiAodGhpcy5fd29ybGRJbmZvKSB7CiAgICAgICAgICAgICAgICB0aGlzLl93b3JsZEluZm8uUmVsZWFzZSgpOwogICAgICAgICAgICAgICAgdGhpcy5fd29ybGRJbmZvID0KICAgICAgICAgICAgICAgICAgICBudWxsCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgX0xvYWRJbnN0YW5jZVZhcmlhYmxlRGF0YShpbnN0VmFyRGF0YSkgewogICAgICAgICAgICBpZiAoaW5zdFZhckRhdGEubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgdGhpcy5faW5zdFZhclZhbHVlcyA9IFtdOwogICAgICAgICAgICAgICAgQzMuc2hhbGxvd0Fzc2lnbkFycmF5KHRoaXMuX2luc3RWYXJWYWx1ZXMsIGluc3RWYXJEYXRhKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIF9Mb2FkRGVmYXVsdEluc3RhbmNlVmFyaWFibGVzKCkgewogICAgICAgICAgICBjb25zdCBsZW4gPSB0aGlzLl9vYmplY3RUeXBlLkdldEluc3RhbmNlVmFyaWFibGVzQ291bnQoKTsKICAgICAgICAgICAgaWYgKGxlbiA9PT0gMCkgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl9pbnN0VmFyVmFsdWVzID0gW107CiAgICAgICAgICAgIGNvbnN0IHR5cGVUb0luaXRWYWx1ZSA9IFswLCAwLCAiIl07CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuOyArK2kpIHRoaXMuX2luc3RWYXJWYWx1ZXMucHVzaCh0eXBlVG9Jbml0VmFsdWVbdGhpcy5fb2JqZWN0VHlwZS5HZXRJbnN0YW5jZVZhcmlhYmxlVHlwZShpKV0pCiAgICAgICAgfQogICAgICAgIF9DcmVhdGVTZGtJbnN0YW5jZShwcm9wZXJ0aWVzLCBiZWhJbnN0UHJvcGVydGllcykgewogICAgICAgICAgICBpZiAodGhpcy5fc2RrSW5zdCkgdGhyb3cgbmV3IEVycm9yKCJhbHJlYWR5IGdvdCBzZGsgaW5zdGFuY2UiKTsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IHRoaXMuX2JlaGF2aW9ySW5zdGFuY2VzLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7CiAgICAgICAgICAgICAgICBjb25zdCBiZWhJbnN0ID0gdGhpcy5fYmVoYXZpb3JJbnN0YW5jZXNbaV07CiAgICAgICAgICAgICAgICBiZWhJbnN0Ll9DcmVhdGVTZGtJbnN0YW5jZShiZWhJbnN0UHJvcGVydGllcyA/IGJlaEluc3RQcm9wZXJ0aWVzW2ldIDogbnVsbCkKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLl9zZGtJbnN0ID0gQzMuTmV3KHRoaXMuX29iamVjdFR5cGUuR2V0SW5zdGFuY2VTZGtDdG9yKCksIHRoaXMsIHByb3BlcnRpZXMpOwogICAgICAgICAgICBpZiAoISh0aGlzLl9zZGtJbnN0IGluc3RhbmNlb2YgQzMuU0RLSW5zdGFuY2VCYXNlKSkgdGhyb3cgbmV3IEVycm9yKCJzZGsgdHlwZSBtdXN0IGRlcml2ZSBmcm9tIFNES0luc3RhbmNlQmFzZSIpOwogICAgICAgICAgICBpZiAoIXRoaXMuR2V0UGx1Z2luKCkuSXNXb3JsZFR5cGUoKSAmJiB0aGlzLl9vYmplY3RUeXBlLl9HZXRVc2VyU2NyaXB0SW5zdGFuY2VDbGFzcygpKSB0aGlzLkdldEludGVyZmFjZUNsYXNzKCk7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSB0aGlzLl9iZWhhdmlvckluc3RhbmNlcy5sZW5ndGg7IGkgPAogICAgICAgICAgICAgICAgbGVuOyArK2kpIHRoaXMuX2JlaGF2aW9ySW5zdGFuY2VzW2ldLlBvc3RDcmVhdGUoKQogICAgICAgIH0KICAgICAgICBHZXRTZGtJbnN0YW5jZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3Nka0luc3QKICAgICAgICB9CiAgICAgICAgR2V0V29ybGRJbmZvKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fd29ybGRJbmZvCiAgICAgICAgfQogICAgICAgIEdldFJ1bnRpbWUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lCiAgICAgICAgfQogICAgICAgIEdldFRpbWVTY2FsZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RpbWVTY2FsZQogICAgICAgIH0KICAgICAgICBHZXRBY3RpdmVUaW1lU2NhbGUoKSB7CiAgICAgICAgICAgIGNvbnN0IHRzID0gdGhpcy5fdGltZVNjYWxlOwogICAgICAgICAgICBpZiAodHMgPT09IC0xKSByZXR1cm4gdGhpcy5HZXRSdW50aW1lKCkuR2V0VGltZVNjYWxlKCk7CiAgICAgICAgICAgIGVsc2UgcmV0dXJuIHRzCiAgICAgICAgfQogICAgICAgIFNldFRpbWVTY2FsZSh0cykgewogICAgICAgICAgICB0cyA9ICt0czsKICAgICAgICAgICAgaWYgKHRzIDwgMCB8fCAhaXNGaW5pdGUodHMpKSB0cyA9IDA7CiAgICAgICAgICAgIHRoaXMuX3RpbWVTY2FsZSA9IHRzOwogICAgICAgICAgICBpZiAodGhpcy5HZXRPYmplY3RDbGFzcygpLlVzZXNFZmZlY3RzKCkpIHRoaXMuX3J1bnRpbWUuX1NldFRyYWNraW5nSW5zdGFuY2VUaW1lKHRoaXMsIHRydWUpCiAgICAgICAgfQogICAgICAgIFJlc3RvcmVUaW1lU2NhbGUoKSB7CiAgICAgICAgICAgIHRoaXMuX3RpbWVTY2FsZSA9IC0xOwogICAgICAgICAgICBpZiAodGhpcy5HZXRPYmplY3RDbGFzcygpLlVzZXNFZmZlY3RzKCkpIHRoaXMuX3J1bnRpbWUuX1NldFRyYWNraW5nSW5zdGFuY2VUaW1lKHRoaXMsIGZhbHNlKQogICAgICAgIH0KICAgICAgICBHZXRJbnN0YW5jZUdhbWVUaW1lKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fcnVudGltZS5fR2V0SW5zdGFuY2VHYW1lVGltZSh0aGlzKQogICAgICAgIH0KICAgICAgICBEaXNwYXRjaGVyKCkgewogICAgICAgICAgICBpZiAoIXRoaXMuX2Rpc3BhdGNoZXIpIHRoaXMuX2Rpc3BhdGNoZXIgPSBDMy5OZXcoQzMuRXZlbnQuRGlzcGF0Y2hlcik7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9kaXNwYXRjaGVyCiAgICAgICAgfQogICAgICAgIERyYXcocmVuZGVyZXIpIHsKICAgICAgICAgICAgdGhpcy5fc2RrSW5zdC5EcmF3KHJlbmRlcmVyKQogICAgICAgIH0KICAgICAgICBPbkNyZWF0ZShwcm9wZXJ0aWVzKSB7CiAgICAgICAgICAgIHRoaXMuX3Nka0luc3QuT25DcmVhdGUocHJvcGVydGllcykKICAgICAgICB9CiAgICAgICAgX1NldEhhc1RpbGVtYXAoKSB7CiAgICAgICAgICAgIHRoaXMuX2ZsYWdzIHw9IEZMQUdfVElMRU1BUAogICAgICAgIH0KICAgICAgICBIYXNUaWxlbWFwKCkgewogICAgICAgICAgICByZXR1cm4gKHRoaXMuX2ZsYWdzICYgRkxBR19USUxFTUFQKSAhPT0gMAogICAgICAgIH0KICAgICAgICBfTWFya0Rlc3Ryb3llZCgpIHsKICAgICAgICAgICAgdGhpcy5fZmxhZ3MgfD0gRkxBR19ERVNUUk9ZRUQKICAgICAgICB9CiAgICAgICAgSXNEZXN0cm95ZWQoKSB7CiAgICAgICAgICAgIHJldHVybiAodGhpcy5fZmxhZ3MgJgogICAgICAgICAgICAgICAgRkxBR19ERVNUUk9ZRUQpICE9PSAwCiAgICAgICAgfQogICAgICAgIE11c3RQcmVEcmF3KCkgewogICAgICAgICAgICByZXR1cm4gKHRoaXMuX2ZsYWdzICYgRkxBR19NVVNUX1BSRURSQVcpICE9PSAwCiAgICAgICAgfQogICAgICAgIFNldE11c3RNaXRpZ2F0ZVpGaWdodGluZygpIHsKICAgICAgICAgICAgdGhpcy5fZmxhZ3MgfD0gRkxBR19NVVNUX01JVElHQVRFX1pfRklHSFRJTkcKICAgICAgICB9CiAgICAgICAgTXVzdE1pdGlnYXRlWkZpZ2h0aW5nKCkgewogICAgICAgICAgICByZXR1cm4gKHRoaXMuX2ZsYWdzICYgRkxBR19NVVNUX01JVElHQVRFX1pfRklHSFRJTkcpICE9PSAwCiAgICAgICAgfQogICAgICAgIF9Jc1NvbGlkRW5hYmxlZCgpIHsKICAgICAgICAgICAgcmV0dXJuICh0aGlzLl9mbGFncyAmIEZMQUdfU09MSURfRU5BQkxFRCkgIT09IDAKICAgICAgICB9CiAgICAgICAgX1NldFNvbGlkRW5hYmxlZChlKSB7CiAgICAgICAgICAgIGlmIChlKSB0aGlzLl9mbGFncyB8PSBGTEFHX1NPTElEX0VOQUJMRUQ7CiAgICAgICAgICAgIGVsc2UgdGhpcy5fZmxhZ3MgJj0gfkZMQUdfU09MSURfRU5BQkxFRAogICAgICAgIH0KICAgICAgICBfSXNKdW1wdGhydUVuYWJsZWQoKSB7CiAgICAgICAgICAgIHJldHVybiAodGhpcy5fZmxhZ3MgJiBGTEFHX0pVTVBUSFJVX0VOQUJMRUQpICE9PSAwCiAgICAgICAgfQogICAgICAgIF9TZXRKdW1wdGhydUVuYWJsZWQoZSkgewogICAgICAgICAgICBpZiAoZSkgdGhpcy5fZmxhZ3MgfD0gRkxBR19KVU1QVEhSVV9FTkFCTEVEOwogICAgICAgICAgICBlbHNlIHRoaXMuX2ZsYWdzICY9IH5GTEFHX0pVTVBUSFJVX0VOQUJMRUQKICAgICAgICB9CiAgICAgICAgX0lzRHJhd2luZ1dpdGhFZmZlY3RzKCkgewogICAgICAgICAgICByZXR1cm4gKHRoaXMuX2ZsYWdzICYgRkxBR19JU19EUkFXSU5HX1dJVEhfRUZGRUNUUykgIT09IDAKICAgICAgICB9CiAgICAgICAgX1NldElzRHJhd2luZ1dpdGhFZmZlY3RzKGUpIHsKICAgICAgICAgICAgaWYgKGUpIHRoaXMuX2ZsYWdzIHw9IEZMQUdfSVNfRFJBV0lOR19XSVRIX0VGRkVDVFM7CiAgICAgICAgICAgIGVsc2UgdGhpcy5fZmxhZ3MgJj0gfkZMQUdfSVNfRFJBV0lOR19XSVRIX0VGRkVDVFMKICAgICAgICB9CiAgICAgICAgU2V0RmxhZyhiaXQsIGVuYWJsZSkgewogICAgICAgICAgICBiaXQgPDw9IDE2OwogICAgICAgICAgICBpZiAoZW5hYmxlKSB0aGlzLl9mbGFncyB8PSBiaXQ7CiAgICAgICAgICAgIGVsc2UgdGhpcy5fZmxhZ3MgJj0gfmJpdAogICAgICAgIH0KICAgICAgICBHZXRGbGFnKGJpdCkgewogICAgICAgICAgICByZXR1cm4gKHRoaXMuX2ZsYWdzICYgYml0IDw8IDE2KSAhPT0gMAogICAgICAgIH0KICAgICAgICBHZXRDdXJyZW50SW1hZ2VJbmZvKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fc2RrSW5zdC5HZXRDdXJyZW50SW1hZ2VJbmZvKCkKICAgICAgICB9CiAgICAgICAgR2V0Q3VycmVudFN1cmZhY2VTaXplKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fc2RrSW5zdC5HZXRDdXJyZW50U3VyZmFjZVNpemUoKQogICAgICAgIH0KICAgICAgICBHZXRDdXJyZW50VGV4UmVjdCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3Nka0luc3QuR2V0Q3VycmVudFRleFJlY3QoKQogICAgICAgIH0KICAgICAgICBHZXRDdXJyZW50VGV4UXVhZCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3Nka0luc3QuR2V0Q3VycmVudFRleFF1YWQoKQogICAgICAgIH0KICAgICAgICBJc0N1cnJlbnRUZXhSb3RhdGVkKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fc2RrSW5zdC5Jc0N1cnJlbnRUZXhSb3RhdGVkKCkKICAgICAgICB9CiAgICAgICAgR2V0SW1hZ2VQb2ludChuYW1lT3JJbmRleCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fc2RrSW5zdC5HZXRJbWFnZVBvaW50KG5hbWVPckluZGV4KQogICAgICAgIH0KICAgICAgICBHZXRPYmplY3RDbGFzcygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX29iamVjdFR5cGUKICAgICAgICB9CiAgICAgICAgUmVuZGVyc1RvT3duWlBsYW5lKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fc2RrSW5zdC5SZW5kZXJzVG9Pd25aUGxhbmUoKQogICAgICAgIH0KICAgICAgICBCZWxvbmdzVG9PYmplY3RDbGFzcyhvYmplY3RDbGFzcykgewogICAgICAgICAgICBpZiAob2JqZWN0Q2xhc3MuSXNGYW1pbHkoKSkgcmV0dXJuIG9iamVjdENsYXNzLkZhbWlseUhhc01lbWJlcih0aGlzLkdldE9iamVjdENsYXNzKCkpOwogICAgICAgICAgICBlbHNlIHJldHVybiB0aGlzLkdldE9iamVjdENsYXNzKCkgPT09IG9iamVjdENsYXNzCiAgICAgICAgfQogICAgICAgIENvbGxlY3RJbnN0YW5jZXNUb1BpY2socGlja01hcCwgY3JlYXRlZE9iamVjdENsYXNzLCBpbmNsdWRlSGllcmFyY2h5KSB7CiAgICAgICAgICAgIGNvbnN0IGFkZEluc3QgPSAoaW5zdCwgb2JqZWN0Q2xhc3NfKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBvYmplY3RDbGFzcyA9IG9iamVjdENsYXNzXyB8fCBpbnN0LkdldE9iamVjdENsYXNzKCk7CiAgICAgICAgICAgICAgICBjb25zdCBpbnN0U2V0ID0gcGlja01hcC5nZXQob2JqZWN0Q2xhc3MpOwogICAgICAgICAgICAgICAgaWYgKGluc3RTZXQpIGluc3RTZXQuYWRkKGluc3QpOwogICAgICAgICAgICAgICAgZWxzZSBwaWNrTWFwLnNldChvYmplY3RDbGFzcywgbmV3IFNldChbaW5zdF0pKQogICAgICAgICAgICB9OwogICAgICAgICAgICBhZGRJbnN0KHRoaXMsIGNyZWF0ZWRPYmplY3RDbGFzcyk7CiAgICAgICAgICAgIGlmICh0aGlzLklzSW5Db250YWluZXIoKSkKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgcyBvZiB0aGlzLnNpYmxpbmdzKCkpIGFkZEluc3Qocyk7CiAgICAgICAgICAgIGlmIChpbmNsdWRlSGllcmFyY2h5KQogICAgICAgICAgICAgICAgZm9yIChjb25zdCBjIG9mIHRoaXMuYWxsQ2hpbGRyZW4oKSkgYWRkSW5zdChjKQogICAgICAgIH0KICAgICAgICBWZXJpZnlTdXBwb3J0c1NjZW5lR3JhcGgoKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5HZXRQbHVnaW4oKS5TdXBwb3J0c1NjZW5lR3JhcGgoKSkgdGhyb3cgbmV3IEVycm9yKCJvYmplY3QgZG9lcyBub3Qgc3VwcG9ydCBzY2VuZSBncmFwaCIpOwogICAgICAgIH0KICAgICAgICBIYXNQYXJlbnQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLkdldFBhcmVudCgpICE9PSBudWxsCiAgICAgICAgfQogICAgICAgIEdldFBhcmVudCgpIHsKICAgICAgICAgICAgY29uc3Qgd2kgPSB0aGlzLkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICBpZiAoIXdpKSByZXR1cm4gbnVsbDsKICAgICAgICAgICAgY29uc3QgcGFyZW50V2kgPSB3aS5HZXRQYXJlbnQoKTsKICAgICAgICAgICAgcmV0dXJuIHBhcmVudFdpID8gcGFyZW50V2kuR2V0SW5zdGFuY2UoKSA6IG51bGwKICAgICAgICB9CiAgICAgICAgR2V0VG9wUGFyZW50KCkgewogICAgICAgICAgICBjb25zdCB3aSA9IHRoaXMuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgIGlmICghd2kpIHJldHVybiBudWxsOwogICAgICAgICAgICBjb25zdCBwYXJlbnRXaSA9IHdpLkdldFRvcFBhcmVudCgpOwogICAgICAgICAgICByZXR1cm4gcGFyZW50V2kgPyBwYXJlbnRXaS5HZXRJbnN0YW5jZSgpIDogbnVsbAogICAgICAgIH0qIHBhcmVudHMoKSB7CiAgICAgICAgICAgIGNvbnN0IHdpID0gdGhpcy5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgaWYgKCF3aSkgcmV0dXJuOwogICAgICAgICAgICBmb3IgKGNvbnN0IHBhcmVudFdpIG9mIHdpLnBhcmVudHMoKSkgeWllbGQgcGFyZW50V2kuR2V0SW5zdGFuY2UoKQogICAgICAgIH0KICAgICAgICBIYXNDaGlsZChjaGlsZCkgewogICAgICAgICAgICBpZiAoIWNoaWxkKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGZvciAoY29uc3QgYyBvZiB0aGlzLmNoaWxkcmVuKCkpCiAgICAgICAgICAgICAgICBpZiAoYyA9PT0KICAgICAgICAgICAgICAgICAgICBjaGlsZCkgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIHJldHVybiBmYWxzZQogICAgICAgIH0KICAgICAgICBIYXNDaGlsZHJlbigpIHsKICAgICAgICAgICAgY29uc3Qgd2kgPSB0aGlzLkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICByZXR1cm4gd2kgPyB3aS5IYXNDaGlsZHJlbigpIDogZmFsc2UKICAgICAgICB9CiAgICAgICAgR2V0Q2hpbGRyZW5PZk9iamVjdENsYXNzKG9iamVjdENsYXNzKSB7CiAgICAgICAgICAgIGNvbnN0IHdpID0gdGhpcy5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgaWYgKCF3aSkgcmV0dXJuIFtdOwogICAgICAgICAgICBjb25zdCBvYmplY3RDbGFzc05hbWUgPSBvYmplY3RDbGFzcy5HZXROYW1lKCk7CiAgICAgICAgICAgIHJldHVybiB3aS5HZXRDaGlsZHJlbigpLm1hcCh3aSA9PiB3aS5HZXRJbnN0YW5jZSgpKS5maWx0ZXIoaSA9PiBpLkdldE9iamVjdENsYXNzKCkuR2V0TmFtZSgpID09PSBvYmplY3RDbGFzc05hbWUpCiAgICAgICAgfQogICAgICAgIEdldENoaWxkcmVuKCkgewogICAgICAgICAgICBjb25zdCB3aSA9IHRoaXMuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgIGlmICghd2kpIHJldHVybiBbXTsKICAgICAgICAgICAgcmV0dXJuIHdpLkdldENoaWxkcmVuKCkubWFwKHdpID0+IHdpLkdldEluc3RhbmNlKCkpCiAgICAgICAgfSogY2hpbGRyZW4oKSB7CiAgICAgICAgICAgIGNvbnN0IHdpID0gdGhpcy5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgaWYgKCF3aSkgcmV0dXJuOwogICAgICAgICAgICBmb3IgKGNvbnN0IGNoaWxkV2kgb2Ygd2kuY2hpbGRyZW4oKSkgeWllbGQgY2hpbGRXaS5HZXRJbnN0YW5jZSgpCiAgICAgICAgfSogYWxsQ2hpbGRyZW4oKSB7CiAgICAgICAgICAgIGNvbnN0IHdpID0gdGhpcy5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgaWYgKCF3aSkgcmV0dXJuOwogICAgICAgICAgICBmb3IgKGNvbnN0IGNoaWxkV2kgb2Ygd2kuYWxsQ2hpbGRyZW4oKSkgeWllbGQgY2hpbGRXaS5HZXRJbnN0YW5jZSgpCiAgICAgICAgfQogICAgICAgIEdldENoaWxkQ291bnQoKSB7CiAgICAgICAgICAgIGNvbnN0IHdpID0gdGhpcy5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgcmV0dXJuIHdpID8gd2kuR2V0Q2hpbGRDb3VudCgpIDogMAogICAgICAgIH0KICAgICAgICBHZXRQYXJlbnRDb3VudCgpIHsKICAgICAgICAgICAgcmV0dXJuIFsuLi50aGlzLnBhcmVudHMoKV0ubGVuZ3RoCiAgICAgICAgfQogICAgICAgIEdldEFsbENoaWxkQ291bnQoKSB7CiAgICAgICAgICAgIGNvbnN0IHdpID0gdGhpcy5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgcmV0dXJuIHdpID8gd2kuR2V0QWxsQ2hpbGRDb3VudCgpIDogMAogICAgICAgIH0KICAgICAgICBHZXRDaGlsZEF0KGluZGV4KSB7CiAgICAgICAgICAgIGNvbnN0IHdpID0gdGhpcy5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgaWYgKCF3aSkgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIGNvbnN0IGNoaWxkV2kgPSB3aS5HZXRDaGlsZEF0KGluZGV4KTsKICAgICAgICAgICAgcmV0dXJuIGNoaWxkV2kgPwogICAgICAgICAgICAgICAgY2hpbGRXaS5HZXRJbnN0YW5jZSgpIDogbnVsbAogICAgICAgIH0KICAgICAgICBBZGRDaGlsZChjaGlsZEluc3QsIG9wdHMpIHsKICAgICAgICAgICAgdGhpcy5WZXJpZnlTdXBwb3J0c1NjZW5lR3JhcGgoKTsKICAgICAgICAgICAgY2hpbGRJbnN0LlZlcmlmeVN1cHBvcnRzU2NlbmVHcmFwaCgpOwogICAgICAgICAgICB0aGlzLkdldFdvcmxkSW5mbygpLkFkZENoaWxkKGNoaWxkSW5zdC5HZXRXb3JsZEluZm8oKSwgb3B0cyB8fCB7fSkKICAgICAgICB9CiAgICAgICAgUmVtb3ZlQ2hpbGQoY2hpbGRJbnN0KSB7CiAgICAgICAgICAgIGNvbnN0IHdpID0gdGhpcy5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgaWYgKCF3aSkgcmV0dXJuOwogICAgICAgICAgICB3aS5SZW1vdmVDaGlsZChjaGlsZEluc3QuR2V0V29ybGRJbmZvKCkpCiAgICAgICAgfQogICAgICAgIEdldERlc3Ryb3lXaXRoUGFyZW50KCkgewogICAgICAgICAgICBjb25zdCB3aSA9IHRoaXMuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgIHJldHVybiB3aSA/IHdpLkdldERlc3Ryb3lXaXRoUGFyZW50KCkgOiBmYWxzZQogICAgICAgIH0KICAgICAgICBTZXR1cEluaXRpYWxTY2VuZUdyYXBoQ29ubmVjdGlvbnMoKSB7CiAgICAgICAgICAgIGNvbnN0IHdpID0gdGhpcy5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgaWYgKCF3aSkgcmV0dXJuOwogICAgICAgICAgICBjb25zdCBjaGlsZHJlbkRhdGEgPSB3aS5HZXRTY2VuZUdyYXBoQ2hpbGRyZW5FeHBvcnREYXRhKCk7CiAgICAgICAgICAgIGlmICghY2hpbGRyZW5EYXRhKSByZXR1cm47CiAgICAgICAgICAgIGZvciAoY29uc3QgY2hpbGREYXRhIG9mIGNoaWxkcmVuRGF0YSkgewogICAgICAgICAgICAgICAgY29uc3QgY2hpbGQgPSB0aGlzLl9ydW50aW1lLkdldEluc3RhbmNlQnlVSUQoY2hpbGREYXRhWzJdKTsKICAgICAgICAgICAgICAgIGlmIChjaGlsZCkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGZsYWdzID0gY2hpbGREYXRhWzNdOwogICAgICAgICAgICAgICAgICAgIHRoaXMuQWRkQ2hpbGQoY2hpbGQsIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNmb3JtWDogISEoZmxhZ3MgPj4gMCAmIDEpLAogICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2Zvcm1ZOiAhIShmbGFncyA+PiAxICYgMSksCiAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zZm9ybVdpZHRoOiAhIShmbGFncyA+PiAyICYgMSksCiAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zZm9ybUhlaWdodDogISEoZmxhZ3MgPj4gMyAmIDEpLAogICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2Zvcm1BbmdsZTogISEoZmxhZ3MgPj4gNCAmIDEpLAogICAgICAgICAgICAgICAgICAgICAgICBkZXN0cm95V2l0aFBhcmVudDogISEoZmxhZ3MgPj4gNSAmIDEpLAogICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2Zvcm1aRWxldmF0aW9uOiAhIShmbGFncyA+PiA2ICYgMSksCiAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zZm9ybU9wYWNpdHk6ICEhKGZsYWdzID4+IDcgJiAxKSwKICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNmb3JtVmlzaWJpbGl0eTogISEoZmxhZ3MgPj4gOCAmIDEpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBTZXR1cFBlcnNpc3RlZFNjZW5lR3JhcGhDb25uZWN0aW9ucyhpbnN0YW5jZVRvUGVyc2lzdGVkRGF0YU1hcCwKICAgICAgICAgICAgcGVyc2lzdGVkSW5kZXhUb0luc3RhbmNlTWFwKSB7CiAgICAgICAgICAgIGNvbnN0IHBlcnNpc3RlZERhdGEgPSBpbnN0YW5jZVRvUGVyc2lzdGVkRGF0YU1hcC5nZXQodGhpcyk7CiAgICAgICAgICAgIGlmICghcGVyc2lzdGVkRGF0YSkgcmV0dXJuOwogICAgICAgICAgICBmb3IgKGNvbnN0IHBlcnNpc3RlZENoaWxkRGF0YSBvZiBwZXJzaXN0ZWREYXRhWyJzY2VuZUdyYXBoSnNvbiJdWyJjaGlsZHJlbiJdKSB7CiAgICAgICAgICAgICAgICBjb25zdCBjaGlsZCA9IHBlcnNpc3RlZEluZGV4VG9JbnN0YW5jZU1hcC5nZXQocGVyc2lzdGVkQ2hpbGREYXRhWyJpbmRleCJdKTsKICAgICAgICAgICAgICAgIGlmICghY2hpbGQpIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgY29uc3QgZmxhZ3MgPSBwZXJzaXN0ZWRDaGlsZERhdGFbImZsYWdzIl07CiAgICAgICAgICAgICAgICB0aGlzLkFkZENoaWxkKGNoaWxkLCB7CiAgICAgICAgICAgICAgICAgICAgdHJhbnNmb3JtWDogISEoZmxhZ3MgPj4gMCAmIDEpLAogICAgICAgICAgICAgICAgICAgIHRyYW5zZm9ybVk6ICEhKGZsYWdzID4+IDEgJiAxKSwKICAgICAgICAgICAgICAgICAgICB0cmFuc2Zvcm1XaWR0aDogISEoZmxhZ3MgPj4gMiAmIDEpLAogICAgICAgICAgICAgICAgICAgIHRyYW5zZm9ybUhlaWdodDogISEoZmxhZ3MgPj4gMyAmIDEpLAogICAgICAgICAgICAgICAgICAgIHRyYW5zZm9ybUFuZ2xlOiAhIShmbGFncyA+PiA0ICYgMSksCiAgICAgICAgICAgICAgICAgICAgZGVzdHJveVdpdGhQYXJlbnQ6ICEhKGZsYWdzID4+CiAgICAgICAgICAgICAgICAgICAgICAgIDUgJiAxKSwKICAgICAgICAgICAgICAgICAgICB0cmFuc2Zvcm1aRWxldmF0aW9uOiAhIShmbGFncyA+PiA2ICYgMSksCiAgICAgICAgICAgICAgICAgICAgdHJhbnNmb3JtT3BhY2l0eTogISEoZmxhZ3MgPj4gNyAmIDEpLAogICAgICAgICAgICAgICAgICAgIHRyYW5zZm9ybVZpc2liaWxpdHk6ICEhKGZsYWdzID4+IDggJiAxKQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBHZXRUZW1wbGF0ZU5hbWUoKSB7CiAgICAgICAgICAgIGNvbnN0IHRlbXBsYXRlTWFuYWdlciA9IHRoaXMuX3J1bnRpbWUuR2V0VGVtcGxhdGVNYW5hZ2VyKCk7CiAgICAgICAgICAgIHJldHVybiB0ZW1wbGF0ZU1hbmFnZXIgPyB0ZW1wbGF0ZU1hbmFnZXIuR2V0SW5zdGFuY2VUZW1wbGF0ZU5hbWUodGhpcykgOiAiIgogICAgICAgIH0KICAgICAgICBJc0luQ29udGFpbmVyKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fc2libGluZ3MgIT09IG51bGwKICAgICAgICB9CiAgICAgICAgX0FkZFNpYmxpbmcoaW5zdCkgewogICAgICAgICAgICB0aGlzLl9zaWJsaW5ncy5wdXNoKGluc3QpCiAgICAgICAgfQogICAgICAgIEdldFNpYmxpbmdzKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fc2libGluZ3MKICAgICAgICB9CiAgICAgICAgSGFzU2libGluZyhvYmplY3RDbGFzcykgewogICAgICAgICAgICByZXR1cm4gISF0aGlzLkdldFNpYmxpbmcob2JqZWN0Q2xhc3MpCiAgICAgICAgfQogICAgICAgIEdldFNpYmxpbmcob2JqZWN0Q2xhc3MpIHsKICAgICAgICAgICAgY29uc3Qgc2libGluZ3MgPSB0aGlzLnNpYmxpbmdzKCk7CiAgICAgICAgICAgIGlmIChzaWJsaW5ncyA9PT0KICAgICAgICAgICAgICAgIG51bGwgfHwgc2libGluZ3MubGVuZ3RoID09PSAwKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGZvciAoY29uc3QgcyBvZiBzaWJsaW5ncykKICAgICAgICAgICAgICAgIGlmIChzLkdldE9iamVjdENsYXNzKCkgPT09IG9iamVjdENsYXNzKSByZXR1cm4gczsKICAgICAgICAgICAgcmV0dXJuIG51bGwKICAgICAgICB9CiAgICAgICAgc2libGluZ3MoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zaWJsaW5ncwogICAgICAgIH0KICAgICAgICBTZXRTaWJsaW5nc1NpbmdsZVBpY2tlZCgpIHsKICAgICAgICAgICAgZm9yIChjb25zdCBzIG9mIHRoaXMuc2libGluZ3MoKSkgcy5HZXRPYmplY3RDbGFzcygpLkdldEN1cnJlbnRTb2woKS5TZXRTaW5nbGVQaWNrZWQocykKICAgICAgICB9CiAgICAgICAgX1B1c2hTaWJsaW5nc1RvU29sSW5zdGFuY2VzKCkgewogICAgICAgICAgICBmb3IgKGNvbnN0IHMgb2YgdGhpcy5zaWJsaW5ncygpKSBzLkdldE9iamVjdENsYXNzKCkuR2V0Q3VycmVudFNvbCgpLl9QdXNoSW5zdGFuY2UocykKICAgICAgICB9CiAgICAgICAgX1NldFNpYmxpbmdzVG9Tb2xJbnN0YW5jZXNJbmRleChpKSB7CiAgICAgICAgICAgIGZvciAoY29uc3QgcyBvZiB0aGlzLnNpYmxpbmdzKCkpIHMuR2V0T2JqZWN0Q2xhc3MoKS5HZXRDdXJyZW50U29sKCkuX0dldE93bkluc3RhbmNlcygpW2ldID0gcwogICAgICAgIH0KICAgICAgICBfUHVzaFNpYmxpbmdzVG9Tb2xFbHNlSW5zdGFuY2VzKCkgewogICAgICAgICAgICBmb3IgKGNvbnN0IHMgb2YgdGhpcy5zaWJsaW5ncygpKSBzLkdldE9iamVjdENsYXNzKCkuR2V0Q3VycmVudFNvbCgpLl9QdXNoRWxzZUluc3RhbmNlKHMpCiAgICAgICAgfQogICAgICAgIF9TZXRTaWJsaW5nc1RvU29sRWxzZUluc3RhbmNlc0luZGV4KGkpIHsKICAgICAgICAgICAgZm9yIChjb25zdCBzIG9mIHRoaXMuc2libGluZ3MoKSkgcy5HZXRPYmplY3RDbGFzcygpLkdldEN1cnJlbnRTb2woKS5fR2V0T3duRWxzZUluc3RhbmNlcygpW2ldID0KICAgICAgICAgICAgICAgIHMKICAgICAgICB9CiAgICAgICAgR2V0UGx1Z2luKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fb2JqZWN0VHlwZS5HZXRQbHVnaW4oKQogICAgICAgIH0KICAgICAgICBfU2V0SUlEKGkpIHsKICAgICAgICAgICAgdGhpcy5faWlkID0gaQogICAgICAgIH0KICAgICAgICBHZXRJSUQoKSB7CiAgICAgICAgICAgIHRoaXMuX29iamVjdFR5cGUuX1VwZGF0ZUlJRHMoKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2lpZAogICAgICAgIH0KICAgICAgICBHZXRVSUQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl91aWQKICAgICAgICB9CiAgICAgICAgR2V0UFVJRCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3B1aWQKICAgICAgICB9CiAgICAgICAgR2V0QmVoYXZpb3JJbnN0YW5jZXMoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9iZWhhdmlvckluc3RhbmNlcwogICAgICAgIH0KICAgICAgICBHZXRCZWhhdmlvckluc3RhbmNlRnJvbUN0b3IoY3RvcikgewogICAgICAgICAgICBpZiAoIWN0b3IpIHJldHVybiBudWxsOwogICAgICAgICAgICBmb3IgKGNvbnN0IGJlaEluc3Qgb2YgdGhpcy5fYmVoYXZpb3JJbnN0YW5jZXMpCiAgICAgICAgICAgICAgICBpZiAoYmVoSW5zdC5HZXRCZWhhdmlvcigpIGluc3RhbmNlb2YgY3RvcikgcmV0dXJuIGJlaEluc3Q7CiAgICAgICAgICAgIHJldHVybiBudWxsCiAgICAgICAgfQogICAgICAgIEdldEJlaGF2aW9yU2RrSW5zdGFuY2VGcm9tQ3RvcihjdG9yKSB7CiAgICAgICAgICAgIGlmICghY3RvcikgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIGNvbnN0IGJlaEluc3QgPSB0aGlzLkdldEJlaGF2aW9ySW5zdGFuY2VGcm9tQ3RvcihjdG9yKTsKICAgICAgICAgICAgaWYgKGJlaEluc3QpIHJldHVybiBiZWhJbnN0LkdldFNka0luc3RhbmNlKCk7CiAgICAgICAgICAgIGVsc2UgcmV0dXJuIG51bGwKICAgICAgICB9CiAgICAgICAgR2V0QmVoYXZpb3JJbmRleEJ5U0lEKHNpZCkgewogICAgICAgICAgICBjb25zdCBiZWhhdmlvckluc3RhbmNlcyA9IHRoaXMuX2JlaGF2aW9ySW5zdGFuY2VzOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gYmVoYXZpb3JJbnN0YW5jZXMubGVuZ3RoOyBpIDwgbGVuOyArK2kpCiAgICAgICAgICAgICAgICBpZiAoYmVoYXZpb3JJbnN0YW5jZXNbaV0uR2V0QmVoYXZpb3JUeXBlKCkuR2V0U0lEKCkgPT09IHNpZCkgcmV0dXJuIGk7CiAgICAgICAgICAgIHJldHVybiAtMQogICAgICAgIH0KICAgICAgICBHZXRBbGxJbnN0YW5jZVZhcmlhYmxlVmFsdWVzKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faW5zdFZhclZhbHVlcwogICAgICAgIH0KICAgICAgICBfR2V0QWxsSW5zdGFuY2VWYXJpYWJsZU5hbWVzKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fb2JqZWN0VHlwZS5fR2V0QWxsSW5zdGFuY2VWYXJpYWJsZU5hbWVzKCkKICAgICAgICB9CiAgICAgICAgR2V0SW5zdGFuY2VWYXJpYWJsZUNvdW50KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faW5zdFZhclZhbHVlcy5sZW5ndGgKICAgICAgICB9CiAgICAgICAgR2V0SW5zdGFuY2VWYXJpYWJsZVZhbHVlKGluZGV4KSB7CiAgICAgICAgICAgIGluZGV4ID0KICAgICAgICAgICAgICAgIGluZGV4IHwgMDsKICAgICAgICAgICAgY29uc3QgaW5zdFZhclZhbHVlcyA9IHRoaXMuX2luc3RWYXJWYWx1ZXM7CiAgICAgICAgICAgIGlmIChpbmRleCA8IDAgfHwgaW5kZXggPj0gaW5zdFZhclZhbHVlcy5sZW5ndGgpIHRocm93IG5ldyBSYW5nZUVycm9yKCJpbnZhbGlkIGluc3RhbmNlIHZhcmlhYmxlIik7CiAgICAgICAgICAgIHJldHVybiBpbnN0VmFyVmFsdWVzW2luZGV4XQogICAgICAgIH0KICAgICAgICBfR2V0SW5zdGFuY2VWYXJpYWJsZVZhbHVlVW5jaGVja2VkKGluZGV4KSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pbnN0VmFyVmFsdWVzW2luZGV4XQogICAgICAgIH0KICAgICAgICBfR2V0SW5zdGFuY2VWYXJpYWJsZVR5cGVkVmFsdWUoaW5kZXgpIHsKICAgICAgICAgICAgY29uc3QgcmV0ID0gdGhpcy5faW5zdFZhclZhbHVlc1tpbmRleF07CiAgICAgICAgICAgIGlmICh0aGlzLl9vYmplY3RUeXBlLkdldEluc3RhbmNlVmFyaWFibGVUeXBlKGluZGV4KSA9PT0gMCkgcmV0dXJuICEhcmV0OwogICAgICAgICAgICBlbHNlIHJldHVybiByZXQKICAgICAgICB9CiAgICAgICAgU2V0SW5zdGFuY2VWYXJpYWJsZVZhbHVlKGluZGV4LCB2YWx1ZSkgewogICAgICAgICAgICBpbmRleCA9IGluZGV4IHwgMDsKICAgICAgICAgICAgY29uc3QgaW5zdFZhclZhbHVlcyA9IHRoaXMuX2luc3RWYXJWYWx1ZXM7CiAgICAgICAgICAgIGlmIChpbmRleCA8CiAgICAgICAgICAgICAgICAwIHx8IGluZGV4ID49IGluc3RWYXJWYWx1ZXMubGVuZ3RoKSB0aHJvdyBuZXcgUmFuZ2VFcnJvcigiaW52YWxpZCBpbnN0YW5jZSB2YXJpYWJsZSIpOwogICAgICAgICAgICBjb25zdCB0eXBlID0gdGhpcy5fb2JqZWN0VHlwZS5HZXRJbnN0YW5jZVZhcmlhYmxlVHlwZShpbmRleCk7CiAgICAgICAgICAgIHN3aXRjaCAodHlwZSkgewogICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgIGluc3RWYXJWYWx1ZXNbaW5kZXhdID0gdmFsdWUgPyAxIDogMDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgICAgICBpbnN0VmFyVmFsdWVzW2luZGV4XSA9IHR5cGVvZiB2YWx1ZSA9PT0gIm51bWJlciIgPyB2YWx1ZSA6IHBhcnNlRmxvYXQodmFsdWUpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgICAgIGluc3RWYXJWYWx1ZXNbaW5kZXhdID0gdHlwZW9mIHZhbHVlID09PSAic3RyaW5nIiA/IHZhbHVlIDogdmFsdWUudG9TdHJpbmcoKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJ1bmtub3duIGluc3RhbmNlIHZhcmlhYmxlIHR5cGUiKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBTZXRJbnN0YW5jZVZhcmlhYmxlT2Zmc2V0KGluZGV4LCBvZmZzZXQpIHsKICAgICAgICAgICAgaWYgKG9mZnNldCA9PT0gMCkgcmV0dXJuOwogICAgICAgICAgICBpbmRleCA9IGluZGV4IHwgMDsKICAgICAgICAgICAgY29uc3QgaW5zdFZhclZhbHVlcyA9CiAgICAgICAgICAgICAgICB0aGlzLl9pbnN0VmFyVmFsdWVzOwogICAgICAgICAgICBpZiAoaW5kZXggPCAwIHx8IGluZGV4ID49IGluc3RWYXJWYWx1ZXMubGVuZ3RoKSB0aHJvdyBuZXcgUmFuZ2VFcnJvcigiaW52YWxpZCBpbnN0YW5jZSB2YXJpYWJsZSIpOwogICAgICAgICAgICBjb25zdCBsYXN0VmFsdWUgPSBpbnN0VmFyVmFsdWVzW2luZGV4XTsKICAgICAgICAgICAgaWYgKHR5cGVvZiBsYXN0VmFsdWUgPT09ICJudW1iZXIiKQogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBvZmZzZXQgPT09ICJudW1iZXIiKSBpbnN0VmFyVmFsdWVzW2luZGV4XSArPSBvZmZzZXQ7CiAgICAgICAgICAgICAgICBlbHNlIGluc3RWYXJWYWx1ZXNbaW5kZXhdICs9IHBhcnNlRmxvYXQob2Zmc2V0KTsKICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIGxhc3RWYWx1ZSA9PT0gImJvb2xlYW4iKSB0aHJvdyBuZXcgRXJyb3IoImNhbiBub3Qgc2V0IG9mZnNldCBvZiBib29sZWFuIHZhcmlhYmxlIik7CiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiBsYXN0VmFsdWUgPT09ICJzdHJpbmciKSB0aHJvdyBuZXcgRXJyb3IoImNhbiBub3Qgc2V0IG9mZnNldCBvZiBzdHJpbmcgdmFyaWFibGUiKTsKICAgICAgICAgICAgZWxzZSB0aHJvdyBuZXcgRXJyb3IoInVua25vd24gaW5zdGFuY2UgdmFyaWFibGUgdHlwZSIpOwogICAgICAgIH0KICAgICAgICBHZXRTYXZlZERhdGFNYXAoKSB7CiAgICAgICAgICAgIGxldCByZXQgPSBzYXZlZERhdGFNYXBzLmdldCh0aGlzKTsKICAgICAgICAgICAgaWYgKHJldCkgcmV0dXJuIHJldDsKICAgICAgICAgICAgcmV0ID0gbmV3IE1hcDsKICAgICAgICAgICAgc2F2ZWREYXRhTWFwcy5zZXQodGhpcywgcmV0KTsKICAgICAgICAgICAgcmV0dXJuIHJldAogICAgICAgIH0KICAgICAgICBHZXRVbnNhdmVkRGF0YU1hcCgpIHsKICAgICAgICAgICAgbGV0IHJldCA9IHVuc2F2ZWREYXRhTWFwcy5nZXQodGhpcyk7CiAgICAgICAgICAgIGlmIChyZXQpIHJldHVybiByZXQ7CiAgICAgICAgICAgIHJldCA9IG5ldyBNYXA7CiAgICAgICAgICAgIHVuc2F2ZWREYXRhTWFwcy5zZXQodGhpcywgcmV0KTsKICAgICAgICAgICAgcmV0dXJuIHJldAogICAgICAgIH0KICAgICAgICBfSGFzQW55Q3JlYXRlRGVzdHJveUhhbmRsZXIobmFtZSkgewogICAgICAgICAgICBjb25zdCBvYmplY3RUeXBlID0gdGhpcy5HZXRPYmplY3RDbGFzcygpOwogICAgICAgICAgICBpZiAob2JqZWN0VHlwZS5Vc2VyU2NyaXB0RGlzcGF0Y2hlcigpLkhhc0FueUhhbmRsZXJGb3IobmFtZSkpIHJldHVybiB0cnVlOwogICAgICAgICAgICBmb3IgKGNvbnN0IGZhbWlseSBvZiBvYmplY3RUeXBlLkdldEZhbWlsaWVzKCkpCiAgICAgICAgICAgICAgICBpZiAoZmFtaWx5LlVzZXJTY3JpcHREaXNwYXRjaGVyKCkuSGFzQW55SGFuZGxlckZvcihuYW1lKSkgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIGlmICh0aGlzLl9ydW50aW1lLlVzZXJTY3JpcHREaXNwYXRjaGVyKCkuSGFzQW55SGFuZGxlckZvcihuYW1lKSkgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIHJldHVybiBmYWxzZQogICAgICAgIH0KICAgICAgICBfVHJpZ2dlck9uQ3JlYXRlZE9uU2VsZkFuZFJlbGF0ZWQoKSB7CiAgICAgICAgICAgIGNvbnN0IGluc3RhbmNlc1RvVHJpZ2dlck9uQ3JlYXRlZCA9IG5ldyBTZXQ7CiAgICAgICAgICAgIGluc3RhbmNlc1RvVHJpZ2dlck9uQ3JlYXRlZC5hZGQodGhpcyk7CiAgICAgICAgICAgIGNvbnN0IHdpID0gdGhpcy5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgaWYgKHdpICYmIHdpLkhhc0NoaWxkcmVuKCkpCiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGMgb2YgdGhpcy5hbGxDaGlsZHJlbigpKSB7CiAgICAgICAgICAgICAgICAgICAgaW5zdGFuY2VzVG9UcmlnZ2VyT25DcmVhdGVkLmFkZChjKTsKICAgICAgICAgICAgICAgICAgICBpZiAoIWMuSXNJbkNvbnRhaW5lcigpKSBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHMgb2YgYy5zaWJsaW5ncygpKSBpbnN0YW5jZXNUb1RyaWdnZXJPbkNyZWF0ZWQuYWRkKHMpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLklzSW5Db250YWluZXIoKSkKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgcyBvZiB0aGlzLnNpYmxpbmdzKCkpIGluc3RhbmNlc1RvVHJpZ2dlck9uQ3JlYXRlZC5hZGQocyk7CiAgICAgICAgICAgIGZvciAoY29uc3QgaW5zdGFuY2Ugb2YgaW5zdGFuY2VzVG9UcmlnZ2VyT25DcmVhdGVkLnZhbHVlcygpKSBpbnN0YW5jZS5fVHJpZ2dlck9uQ3JlYXRlZCgpCiAgICAgICAgfQogICAgICAgIF9UcmlnZ2VyT25DcmVhdGVkKCkgewogICAgICAgICAgICBpZiAodGhpcy5fb2JqZWN0VHlwZS5fR2V0VXNlclNjcmlwdEluc3RhbmNlQ2xhc3MoKSkgdGhpcy5HZXRJbnRlcmZhY2VDbGFzcygpOwogICAgICAgICAgICBpZiAodGhpcy5fSGFzQW55Q3JlYXRlRGVzdHJveUhhbmRsZXIoImluc3RhbmNlY3JlYXRlIikpIHsKICAgICAgICAgICAgICAgIGNvbnN0IG9iamVjdFR5cGUgPSB0aGlzLkdldE9iamVjdENsYXNzKCk7CiAgICAgICAgICAgICAgICBjb25zdCBpbnN0Q3JlYXRlRXZlbnQgPSBuZXcgQzMuRXZlbnQoImluc3RhbmNlY3JlYXRlIik7CiAgICAgICAgICAgICAgICBpbnN0Q3JlYXRlRXZlbnQuaW5zdGFuY2UgPSB0aGlzLkdldEludGVyZmFjZUNsYXNzKCk7CiAgICAgICAgICAgICAgICBvYmplY3RUeXBlLkRpc3BhdGNoVXNlclNjcmlwdEV2ZW50KGluc3RDcmVhdGVFdmVudCk7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGZhbWlseSBvZiBvYmplY3RUeXBlLkdldEZhbWlsaWVzKCkpIGZhbWlseS5EaXNwYXRjaFVzZXJTY3JpcHRFdmVudChpbnN0Q3JlYXRlRXZlbnQpOwogICAgICAgICAgICAgICAgdGhpcy5fcnVudGltZS5EaXNwYXRjaFVzZXJTY3JpcHRFdmVudChpbnN0Q3JlYXRlRXZlbnQpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5fcnVudGltZS5UcmlnZ2VyKHRoaXMuR2V0UGx1Z2luKCkuY29uc3RydWN0b3IuQ25kcy5PbkNyZWF0ZWQsIHRoaXMsIG51bGwpCiAgICAgICAgfQogICAgICAgIF9UcmlnZ2VyT25EZXN0cm95ZWQoKSB7CiAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuVHJpZ2dlcih0aGlzLkdldFBsdWdpbigpLmNvbnN0cnVjdG9yLkNuZHMuT25EZXN0cm95ZWQsIHRoaXMsIG51bGwpCiAgICAgICAgfQogICAgICAgIF9GaXJlRGVzdHJveWVkU2NyaXB0RXZlbnRzKGlzRW5kaW5nTGF5b3V0KSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9pU2NyaXB0SW50ZXJmYWNlKSB7CiAgICAgICAgICAgICAgICBjb25zdCBlID0gbmV3IEMzLkV2ZW50KCJkZXN0cm95Iik7CiAgICAgICAgICAgICAgICBlLmlzRW5kaW5nTGF5b3V0ID0gaXNFbmRpbmdMYXlvdXQ7CiAgICAgICAgICAgICAgICB0aGlzLkRpc3BhdGNoVXNlclNjcmlwdEV2ZW50KGUpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCF0aGlzLl9IYXNBbnlDcmVhdGVEZXN0cm95SGFuZGxlcigiaW5zdGFuY2VkZXN0cm95IikpIHJldHVybjsKICAgICAgICAgICAgY29uc3Qgb2JqZWN0VHlwZSA9IHRoaXMuR2V0T2JqZWN0Q2xhc3MoKTsKICAgICAgICAgICAgY29uc3QgaW5zdERlc3Ryb3lFdmVudCA9IG5ldyBDMy5FdmVudCgiaW5zdGFuY2VkZXN0cm95Iik7CiAgICAgICAgICAgIGluc3REZXN0cm95RXZlbnQuaW5zdGFuY2UgPSB0aGlzLkdldEludGVyZmFjZUNsYXNzKCk7CiAgICAgICAgICAgIGluc3REZXN0cm95RXZlbnQuaXNFbmRpbmdMYXlvdXQgPSBpc0VuZGluZ0xheW91dDsKICAgICAgICAgICAgb2JqZWN0VHlwZS5EaXNwYXRjaFVzZXJTY3JpcHRFdmVudChpbnN0RGVzdHJveUV2ZW50KTsKICAgICAgICAgICAgZm9yIChjb25zdCBmYW1pbHkgb2Ygb2JqZWN0VHlwZS5HZXRGYW1pbGllcygpKSBmYW1pbHkuRGlzcGF0Y2hVc2VyU2NyaXB0RXZlbnQoaW5zdERlc3Ryb3lFdmVudCk7CiAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuRGlzcGF0Y2hVc2VyU2NyaXB0RXZlbnQoaW5zdERlc3Ryb3lFdmVudCkKICAgICAgICB9CiAgICAgICAgX0dldERlYnVnZ2VyUHJvcGVydGllcygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3Nka0luc3QuR2V0RGVidWdnZXJQcm9wZXJ0aWVzKCkKICAgICAgICB9CiAgICAgICAgU2F2ZVRvSnNvbihtb2RlID0gImZ1bGwiKSB7CiAgICAgICAgICAgIGNvbnN0IG8gPSB7fTsKICAgICAgICAgICAgaWYgKG1vZGUgPT09ICJmdWxsIikgb1sidWlkIl0gPSB0aGlzLkdldFVJRCgpOwogICAgICAgICAgICBlbHNlIG9bImMzIl0gPSB0cnVlOwogICAgICAgICAgICBpZiAobW9kZSAhPT0gInZpc3VhbC1zdGF0ZSIpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHNhdmVkRGF0YSA9IHNhdmVkRGF0YU1hcHMuZ2V0KHRoaXMpOwogICAgICAgICAgICAgICAgaWYgKHNhdmVkRGF0YSAmJiBzYXZlZERhdGEuc2l6ZSkgb1siZXgiXSA9IEMzLlRvU3VwZXJKU09OKHNhdmVkRGF0YSk7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5HZXRUaW1lU2NhbGUoKSAhPT0gLTEpIG9bIm10cyJdID0gdGhpcy5HZXRUaW1lU2NhbGUoKTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9vYmplY3RUeXBlLkdldEluc3RhbmNlVmFyaWFibGVzQ291bnQoKSA+IDApIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBpdnMgPSB7fTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBpdlNpZHMgPSB0aGlzLl9vYmplY3RUeXBlLkdldEluc3RhbmNlVmFyaWFibGVTSURzKCk7CiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IHRoaXMuX2luc3RWYXJWYWx1ZXMubGVuZ3RoOyBpIDwgbGVuOyArK2kpIGl2c1tpdlNpZHNbaV0udG9TdHJpbmcoKV0gPSB0aGlzLl9pbnN0VmFyVmFsdWVzW2ldOwogICAgICAgICAgICAgICAgICAgIG9bIml2cyJdID0gaXZzCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fYmVoYXZpb3JJbnN0YW5jZXMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYmVocyA9IHt9OwogICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgYmVoSW5zdCBvZiB0aGlzLl9iZWhhdmlvckluc3RhbmNlcykgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXRhID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJlaEluc3QuU2F2ZVRvSnNvbigpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YSkgYmVoc1tiZWhJbnN0LkdldEJlaGF2aW9yVHlwZSgpLkdldFNJRCgpLnRvU3RyaW5nKCldID0gZGF0YQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBvWyJiZWhzIl0gPSBiZWhzCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHRoaXMuX3dvcmxkSW5mbykgb1sidyJdID0gdGhpcy5fd29ybGRJbmZvLl9TYXZlVG9Kc29uKG1vZGUpOwogICAgICAgICAgICBjb25zdCBvd25EYXRhID0gdGhpcy5fc2RrSW5zdC5TYXZlVG9Kc29uKCk7CiAgICAgICAgICAgIGlmIChvd25EYXRhKSBvWyJkYXRhIl0gPSBvd25EYXRhOwogICAgICAgICAgICByZXR1cm4gbwogICAgICAgIH0KICAgICAgICBfT25CZWZvcmVMb2FkKG1vZGUgPSAiZnVsbCIpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX3dvcmxkSW5mbykgdGhpcy5fd29ybGRJbmZvLl9PbkJlZm9yZUxvYWQobW9kZSkKICAgICAgICB9CiAgICAgICAgX1NldHVwU2NlbmVHcmFwaENvbm5lY3Rpb25zT25DaGFuZ2VPZkxheW91dCgpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLkdldFBsdWdpbigpLklzV29ybGRUeXBlKCkpIHJldHVybjsKICAgICAgICAgICAgdGhpcy5fd29ybGRJbmZvLl9TZXR1cFNjZW5lR3JhcGhDb25uZWN0aW9uc09uQ2hhbmdlT2ZMYXlvdXQoKQogICAgICAgIH0KICAgICAgICBMb2FkRnJvbUpzb24obywgbW9kZSA9ICJmdWxsIikgewogICAgICAgICAgICBpZiAobW9kZSA9PT0KICAgICAgICAgICAgICAgICJmdWxsIikgdGhpcy5fdWlkID0gb1sidWlkIl07CiAgICAgICAgICAgIGVsc2UgaWYgKCFvWyJjMyJdKSByZXR1cm47CiAgICAgICAgICAgIGlmIChtb2RlICE9PSAidmlzdWFsLXN0YXRlIikgewogICAgICAgICAgICAgICAgbGV0IHNhdmVkRGF0YSA9IHNhdmVkRGF0YU1hcHMuZ2V0KHRoaXMpOwogICAgICAgICAgICAgICAgaWYgKHNhdmVkRGF0YSkgewogICAgICAgICAgICAgICAgICAgIHNhdmVkRGF0YS5jbGVhcigpOwogICAgICAgICAgICAgICAgICAgIHNhdmVkRGF0YU1hcHMuZGVsZXRlKHRoaXMpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjb25zdCBleCA9IG9bImV4Il07CiAgICAgICAgICAgICAgICBpZiAoZXgpIHsKICAgICAgICAgICAgICAgICAgICBzYXZlZERhdGEgPSBDMy5Gcm9tU3VwZXJKU09OKGV4KTsKICAgICAgICAgICAgICAgICAgICBzYXZlZERhdGFNYXBzLnNldCh0aGlzLCBzYXZlZERhdGEpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLl90aW1lU2NhbGUgPSBvLmhhc093blByb3BlcnR5KCJtdHMiKSA/IG9bIm10cyJdIDogLTE7CiAgICAgICAgICAgICAgICBjb25zdCBpdnMgPSBvWyJpdnMiXTsKICAgICAgICAgICAgICAgIGlmIChpdnMpCiAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBbc2lkU3RyLCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMoaXZzKSkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzaWQgPSBwYXJzZUludChzaWRTdHIsIDEwKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSB0aGlzLl9vYmplY3RUeXBlLkdldEluc3RhbmNlVmFyaWFibGVJbmRleEJ5U0lEKHNpZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbmRleCA8IDAgfHwgaW5kZXggPj0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2luc3RWYXJWYWx1ZXMubGVuZ3RoKSBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHYgPSB2YWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHYgPT09IG51bGwpIHYgPSBOYU47CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2luc3RWYXJWYWx1ZXNbaW5kZXhdID0gdgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGhpcy5HZXRQbHVnaW4oKS5Jc1dvcmxkVHlwZSgpKSB7CiAgICAgICAgICAgICAgICBjb25zdCB3b3JsZERhdGEgPSBvWyJ3Il07CiAgICAgICAgICAgICAgICBjb25zdCBsYXllclNpZCA9IHdvcmxkRGF0YVsibCJdOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuX3dvcmxkSW5mby5HZXRMYXllcigpLkdldFNJRCgpICE9PSBsYXllclNpZCkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IG9sZExheWVyID0gdGhpcy5fd29ybGRJbmZvLkdldExheWVyKCk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgbmV3TGF5ZXIgPSBvbGRMYXllci5HZXRMYXlvdXQoKS5HZXRMYXllckJ5U0lEKGxheWVyU2lkKTsKICAgICAgICAgICAgICAgICAgICBpZiAobmV3TGF5ZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fd29ybGRJbmZvLl9TZXRMYXllcihuZXdMYXllcik7CiAgICAgICAgICAgICAgICAgICAgICAgIG9sZExheWVyLl9SZW1vdmVJbnN0YW5jZSh0aGlzLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgbmV3TGF5ZXIuX0FkZEluc3RhbmNlKHRoaXMsIHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICBuZXdMYXllci5TZXRaSW5kaWNlc0NoYW5nZWQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fd29ybGRJbmZvLlNldEJib3hDaGFuZ2VkKCkKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG1vZGUgPT09CiAgICAgICAgICAgICAgICAgICAgICAgICJmdWxsIikgdGhpcy5fcnVudGltZS5EZXN0cm95SW5zdGFuY2UodGhpcykKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMuX3dvcmxkSW5mby5fTG9hZEZyb21Kc29uKHdvcmxkRGF0YSwgbW9kZSkKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAobW9kZSAhPT0gInZpc3VhbC1zdGF0ZSIpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGJlaHMgPSBvWyJiZWhzIl07CiAgICAgICAgICAgICAgICBpZiAoYmVocykKICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IFtzaWRTdHIsIGRhdGFdIG9mIE9iamVjdC5lbnRyaWVzKGJlaHMpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHNpZCA9IHBhcnNlSW50KHNpZFN0ciwgMTApOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMuR2V0QmVoYXZpb3JJbmRleEJ5U0lEKHNpZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbmRleCA8IDAgfHwgaW5kZXggPj0gdGhpcy5fYmVoYXZpb3JJbnN0YW5jZXMubGVuZ3RoKSBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fYmVoYXZpb3JJbnN0YW5jZXNbaW5kZXhdLkxvYWRGcm9tSnNvbihkYXRhKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBvd25EYXRhID0gb1siZGF0YSJdOwogICAgICAgICAgICBpZiAob3duRGF0YSkgdGhpcy5fc2RrSW5zdC5Mb2FkRnJvbUpzb24ob3duRGF0YSwgbW9kZSkKICAgICAgICB9CiAgICAgICAgR2V0SW50ZXJmYWNlQ2xhc3MoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pU2NyaXB0SW50ZXJmYWNlIHx8CiAgICAgICAgICAgICAgICB0aGlzLl9Jbml0VXNlclNjcmlwdEludGVyZmFjZSgpCiAgICAgICAgfQogICAgICAgIEhhc1NjcmlwdEludGVyZmFjZSgpIHsKICAgICAgICAgICAgcmV0dXJuICEhdGhpcy5faVNjcmlwdEludGVyZmFjZQogICAgICAgIH0KICAgICAgICBfSW5pdFVzZXJTY3JpcHRJbnRlcmZhY2UoKSB7CiAgICAgICAgICAgIGNvbnN0IERlZmF1bHRTY3JpcHRDbGFzcyA9IHRoaXMuX3dvcmxkSW5mbyA/IHNlbGYuSVdvcmxkSW5zdGFuY2UgOiBJSW5zdGFuY2U7CiAgICAgICAgICAgIGNvbnN0IFNka1NjcmlwdENsYXNzID0gdGhpcy5fc2RrSW5zdC5HZXRTY3JpcHRJbnRlcmZhY2VDbGFzcygpOwogICAgICAgICAgICBjb25zdCBVc2VyU2NyaXB0Q2xhc3MgPSB0aGlzLl9vYmplY3RUeXBlLl9HZXRVc2VyU2NyaXB0SW5zdGFuY2VDbGFzcygpOwogICAgICAgICAgICBjb25zdCBTY3JpcHRJbnRlcmZhY2VDbGFzcyA9IFVzZXJTY3JpcHRDbGFzcyB8fCBTZGtTY3JpcHRDbGFzcyB8fCBEZWZhdWx0U2NyaXB0Q2xhc3M7CiAgICAgICAgICAgIElJbnN0YW5jZS5fSW5pdCh0aGlzKTsKICAgICAgICAgICAgdGhpcy5faVNjcmlwdEludGVyZmFjZSA9IG5ldyBTY3JpcHRJbnRlcmZhY2VDbGFzczsKICAgICAgICAgICAgSUluc3RhbmNlLl9Jbml0KG51bGwpOwogICAgICAgICAgICBpZiAoU2RrU2NyaXB0Q2xhc3MgJiYKICAgICAgICAgICAgICAgICEodGhpcy5faVNjcmlwdEludGVyZmFjZSBpbnN0YW5jZW9mIERlZmF1bHRTY3JpcHRDbGFzcykpIHRocm93IG5ldyBUeXBlRXJyb3IoYHNjcmlwdCBpbnRlcmZhY2UgY2xhc3MgJyR7U2RrU2NyaXB0Q2xhc3MubmFtZX0nIGRvZXMgbm90IGV4dGVuZCB0aGUgcmlnaHQgYmFzZSBjbGFzcyAnJHtEZWZhdWx0U2NyaXB0Q2xhc3MubmFtZX0nYCk7CiAgICAgICAgICAgIGlmIChVc2VyU2NyaXB0Q2xhc3MpIHsKICAgICAgICAgICAgICAgIGNvbnN0IEV4cGVjdGVkQmFzZUNsYXNzID0gU2RrU2NyaXB0Q2xhc3MgfHwgRGVmYXVsdFNjcmlwdENsYXNzOwogICAgICAgICAgICAgICAgaWYgKCEodGhpcy5faVNjcmlwdEludGVyZmFjZSBpbnN0YW5jZW9mIEV4cGVjdGVkQmFzZUNsYXNzKSkgdGhyb3cgbmV3IFR5cGVFcnJvcihgc2V0SW5zdGFuY2VDbGFzcygpOiBjbGFzcyAnJHtVc2VyU2NyaXB0Q2xhc3MubmFtZX0nIGRvZXMgbm90IGV4dGVuZCB0aGUgcmlnaHQgYmFzZSBjbGFzcyAnJHtFeHBlY3RlZEJhc2VDbGFzcy5uYW1lfSdgKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdGhpcy5faVNjcmlwdEludGVyZmFjZQogICAgICAgIH0KICAgICAgICBfR2V0SW5zdFZhcnNTY3JpcHREZXNjcmlwdG9yKGluc3REZXNjcmlwdG9ycykgewogICAgICAgICAgICBpZiAodGhpcy5faW5zdFZhclZhbHVlcy5sZW5ndGggPT09CiAgICAgICAgICAgICAgICAwKSByZXR1cm47CiAgICAgICAgICAgIGNvbnN0IHZhckRlc2NyaXB0b3JzID0ge307CiAgICAgICAgICAgIGNvbnN0IGluc3RWYXJKc1Byb3BOYW1lcyA9IHRoaXMuX29iamVjdFR5cGUuX0dldEFsbEluc3RhbmNlVmFyaWFibGVKc1Byb3BOYW1lcygpOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gaW5zdFZhckpzUHJvcE5hbWVzLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB2YXJEZXNjcmlwdG9yc1tpbnN0VmFySnNQcm9wTmFtZXNbaV1dID0gewogICAgICAgICAgICAgICAgY29uZmlndXJhYmxlOiBmYWxzZSwKICAgICAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgICAgICAgICBnZXQ6IEMzLkluc3RhbmNlLnByb3RvdHlwZS5fR2V0SW5zdGFuY2VWYXJpYWJsZVR5cGVkVmFsdWUuYmluZCh0aGlzLCBpKSwKICAgICAgICAgICAgICAgIHNldDogQzMuSW5zdGFuY2UucHJvdG90eXBlLlNldEluc3RhbmNlVmFyaWFibGVWYWx1ZS5iaW5kKHRoaXMsIGkpCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGNvbnN0IGluc3RWYXJzT2JqID0gT2JqZWN0LmNyZWF0ZShPYmplY3QucHJvdG90eXBlLCB2YXJEZXNjcmlwdG9ycyk7CiAgICAgICAgICAgIGluc3REZXNjcmlwdG9ycy5pbnN0VmFycyA9IHsKICAgICAgICAgICAgICAgIHZhbHVlOiBpbnN0VmFyc09iaiwKICAgICAgICAgICAgICAgIHdyaXRhYmxlOiBmYWxzZQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIF9HZXRCZWhhdmlvcnNTY3JpcHREZXNjcmlwdG9yKGluc3REZXNjcmlwdG9ycykgewogICAgICAgICAgICBjb25zdCBiZWhhdmlvckluc3RhbmNlcyA9CiAgICAgICAgICAgICAgICB0aGlzLl9iZWhhdmlvckluc3RhbmNlczsKICAgICAgICAgICAgaWYgKGJlaGF2aW9ySW5zdGFuY2VzLmxlbmd0aCA9PT0gMCkgcmV0dXJuOwogICAgICAgICAgICBjb25zdCBiZWhEZXNjcmlwdG9ycyA9IHt9OwogICAgICAgICAgICBmb3IgKGNvbnN0IGJlaEluc3Qgb2YgYmVoYXZpb3JJbnN0YW5jZXMpIGJlaERlc2NyaXB0b3JzW2JlaEluc3QuR2V0QmVoYXZpb3JUeXBlKCkuR2V0SnNQcm9wTmFtZSgpXSA9IHsKICAgICAgICAgICAgICAgIHZhbHVlOiBiZWhJbnN0LkdldFNjcmlwdEludGVyZmFjZSgpLAogICAgICAgICAgICAgICAgd3JpdGFibGU6IGZhbHNlCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGNvbnN0IGJlaGF2aW9yc09iaiA9IE9iamVjdC5jcmVhdGUoT2JqZWN0LnByb3RvdHlwZSwgYmVoRGVzY3JpcHRvcnMpOwogICAgICAgICAgICBpbnN0RGVzY3JpcHRvcnMuYmVoYXZpb3JzID0gewogICAgICAgICAgICAgICAgdmFsdWU6IGJlaGF2aW9yc09iaiwKICAgICAgICAgICAgICAgIHdyaXRhYmxlOiBmYWxzZQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIERpc3BhdGNoVXNlclNjcmlwdEV2ZW50KGUpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLkhhc1NjcmlwdEludGVyZmFjZSgpKSByZXR1cm47CiAgICAgICAgICAgIGNvbnN0IHNjcmlwdEludGVyZmFjZSA9IHRoaXMuR2V0SW50ZXJmYWNlQ2xhc3MoKTsKICAgICAgICAgICAgZS5pbnN0YW5jZSA9IHNjcmlwdEludGVyZmFjZTsKICAgICAgICAgICAgY29uc3QgcnVudGltZSA9IHRoaXMuX3J1bnRpbWU7CiAgICAgICAgICAgIGNvbnN0IHNob3VsZFRpbWUgPSBydW50aW1lLklzRGVidWcoKSAmJiAhcnVudGltZS5HZXRFdmVudFNoZWV0TWFuYWdlcigpLklzSW5FdmVudEVuZ2luZSgpOwogICAgICAgICAgICBpZiAoc2hvdWxkVGltZSkgQzNEZWJ1Z2dlci5TdGFydE1lYXN1cmluZ1NjcmlwdFRpbWUoKTsKICAgICAgICAgICAgc2NyaXB0SW50ZXJmYWNlLmRpc3BhdGNoRXZlbnQoZSk7CiAgICAgICAgICAgIGlmIChzaG91bGRUaW1lKSBDM0RlYnVnZ2VyLkFkZFNjcmlwdFRpbWUoKQogICAgICAgIH0KICAgIH07Cgp9CgovLyBvYmplY3RzL3NjZW5lR3JhcGhJbmZvLmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIEMzLlNjZW5lR3JhcGhJbmZvID0gY2xhc3MgU2NlbmVHcmFwaEluZm8gZXh0ZW5kcyBDMy5EZWZlbmRlZEJhc2UgewogICAgICAgIGNvbnN0cnVjdG9yKG93bmVyKSB7CiAgICAgICAgICAgIHN1cGVyKCk7CiAgICAgICAgICAgIHRoaXMuX293bmVyID0gb3duZXI7CiAgICAgICAgICAgIHRoaXMuX3BhcmVudCA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX2NoaWxkcmVuID0gW107CiAgICAgICAgICAgIHRoaXMuX3N0YXJ0V2lkdGggPSBvd25lci5HZXRXaWR0aCgpOwogICAgICAgICAgICB0aGlzLl9zdGFydEhlaWdodCA9IG93bmVyLkdldEhlaWdodCgpOwogICAgICAgICAgICB0aGlzLl9zdGFydFNjYWxlWCA9IDE7CiAgICAgICAgICAgIHRoaXMuX3N0YXJ0U2NhbGVZID0gMTsKICAgICAgICAgICAgdGhpcy5fcGFyZW50U3RhcnRBbmdsZSA9IDA7CiAgICAgICAgICAgIHRoaXMuX293bk9wYWNpdHkgPSAxOwogICAgICAgICAgICB0aGlzLl9zdGFydE9wYWNpdHkgPSBvd25lci5HZXRPcGFjaXR5KCk7CiAgICAgICAgICAgIHRoaXMuX3RtcFNjZW5lR3JhcGhDaGlsZHJlbiA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3RtcFNjZW5lR3JhcGhDaGlsZHJlbkluZGV4ZXMgPSBudWxsCiAgICAgICAgfQogICAgICAgIFJlbGVhc2UoKSB7CiAgICAgICAgICAgIHRoaXMuX3BhcmVudCA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3RtcFNjZW5lR3JhcGhDaGlsZHJlbiA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3RtcFNjZW5lR3JhcGhDaGlsZHJlbkluZGV4ZXMgPSBudWxsOwogICAgICAgICAgICBDMy5jbGVhckFycmF5KHRoaXMuX2NoaWxkcmVuKQogICAgICAgIH0KICAgICAgICBTZXRQYXJlbnQocGFyZW50KSB7CiAgICAgICAgICAgIHRoaXMuX293bk9wYWNpdHkgPSB0aGlzLl9vd25lci5HZXRPcGFjaXR5KCk7CiAgICAgICAgICAgIHRoaXMuX3N0YXJ0T3BhY2l0eSA9IHRoaXMuX293bk9wYWNpdHk7CiAgICAgICAgICAgIHRoaXMuX3BhcmVudCA9IHBhcmVudDsKICAgICAgICAgICAgdGhpcy5fcGFyZW50U3RhcnRBbmdsZSA9IHBhcmVudCA/IHBhcmVudC5HZXRBbmdsZSgpIDogMAogICAgICAgIH0KICAgICAgICBHZXRQYXJlbnQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9wYXJlbnQKICAgICAgICB9CiAgICAgICAgSGFzQ2hpbGRyZW4oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9jaGlsZHJlbi5sZW5ndGggPiAwCiAgICAgICAgfQogICAgICAgIEdldENoaWxkcmVuKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fY2hpbGRyZW4KICAgICAgICB9CiAgICAgICAgX01heWJlU29ydENoaWxkcmVuKCkgewogICAgICAgICAgICBpZiAoIXRoaXMuSGFzQ2hpbGRyZW4oKSkgcmV0dXJuOwogICAgICAgICAgICBpZiAoIXRoaXMuX3RtcFNjZW5lR3JhcGhDaGlsZHJlbkluZGV4ZXMpIHJldHVybjsKICAgICAgICAgICAgaWYgKHRoaXMuX2NoaWxkcmVuLmxlbmd0aCA9PT0gMSkgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl9jaGlsZHJlbi5zb3J0KChmLCBzKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBmSW5kZXggPSB0aGlzLl90bXBTY2VuZUdyYXBoQ2hpbGRyZW5JbmRleGVzLmdldChmLkdldEluc3RhbmNlKCkpOwogICAgICAgICAgICAgICAgY29uc3Qgc0luZGV4ID0gdGhpcy5fdG1wU2NlbmVHcmFwaENoaWxkcmVuSW5kZXhlcy5nZXQocy5HZXRJbnN0YW5jZSgpKTsKICAgICAgICAgICAgICAgIGlmIChDMy5Jc0Zpbml0ZU51bWJlcihmSW5kZXgpICYmIEMzLklzRmluaXRlTnVtYmVyKHNJbmRleCkpIHJldHVybiBmSW5kZXggLSBzSW5kZXg7CiAgICAgICAgICAgICAgICByZXR1cm4gMAogICAgICAgICAgICB9KQogICAgICAgIH0KICAgICAgICBHZXRTdGFydFNjYWxlWCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3N0YXJ0U2NhbGVYCiAgICAgICAgfQogICAgICAgIFNldFN0YXJ0U2NhbGVYKHN4KSB7CiAgICAgICAgICAgIHRoaXMuX3N0YXJ0U2NhbGVYID0gc3gKICAgICAgICB9CiAgICAgICAgR2V0U3RhcnRTY2FsZVkoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zdGFydFNjYWxlWQogICAgICAgIH0KICAgICAgICBTZXRTdGFydFNjYWxlWShzeSkgewogICAgICAgICAgICB0aGlzLl9zdGFydFNjYWxlWSA9IHN5CiAgICAgICAgfQogICAgICAgIEdldFN0YXJ0T3BhY2l0eSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3N0YXJ0T3BhY2l0eQogICAgICAgIH0KICAgICAgICBHZXRPd25PcGFjaXR5KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fb3duT3BhY2l0eQogICAgICAgIH0KICAgICAgICBTZXRPd25PcGFjaXR5KG93bk9wYWNpdHkpIHsKICAgICAgICAgICAgdGhpcy5fb3duT3BhY2l0eSA9IG93bk9wYWNpdHkKICAgICAgICB9CiAgICAgICAgX0dldFN0YXJ0V2lkdGgoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9zdGFydFdpZHRoID09PSAwKSByZXR1cm4gTnVtYmVyLkVQU0lMT047CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zdGFydFdpZHRoCiAgICAgICAgfQogICAgICAgIF9HZXRTdGFydEhlaWdodCgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX3N0YXJ0SGVpZ2h0ID09PSAwKSByZXR1cm4gTnVtYmVyLkVQU0lMT047CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zdGFydEhlaWdodAogICAgICAgIH0KICAgICAgICBHZXRQYXJlbnRTY2FsZVgoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9vd25lci5HZXRUcmFuc2Zvcm1XaXRoUGFyZW50V2lkdGgoKSkgewogICAgICAgICAgICAgICAgY29uc3QgcCA9IHRoaXMuX3BhcmVudDsKICAgICAgICAgICAgICAgIGxldCBjdyA9IHAuR2V0V2lkdGgoKTsKICAgICAgICAgICAgICAgIGxldCBzdyA9IHAuX0dldFNjZW5lR3JhcGhJbmZvKCkuX0dldFN0YXJ0V2lkdGgoKTsKICAgICAgICAgICAgICAgIGlmIChjdyA9PT0gMCkgY3cgPSBOdW1iZXIuRVBTSUxPTjsKICAgICAgICAgICAgICAgIGlmIChzdyA9PT0gTnVtYmVyLkVQU0lMT04gJiYgY3cgPT09IE51bWJlci5FUFNJTE9OKSByZXR1cm4gMTsKICAgICAgICAgICAgICAgIGlmIChzdyA9PT0gTnVtYmVyLkVQU0lMT04gJiYgY3cgIT09IE51bWJlci5FUFNJTE9OKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2RrSW50YW5jZSA9IHAuR2V0SW5zdGFuY2UoKS5HZXRTZGtJbnN0YW5jZSgpOwogICAgICAgICAgICAgICAgICAgIGlmIChzZGtJbnRhbmNlLklzT3JpZ2luYWxTaXplS25vd24oKSkgcmV0dXJuIDEgKyBjdyAvIHNka0ludGFuY2UuR2V0T3JpZ2luYWxXaWR0aCgpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gY3cgLwogICAgICAgICAgICAgICAgICAgIHN3CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIDEKICAgICAgICB9CiAgICAgICAgR2V0UGFyZW50U2NhbGVZKCkgewogICAgICAgICAgICBpZiAodGhpcy5fb3duZXIuR2V0VHJhbnNmb3JtV2l0aFBhcmVudEhlaWdodCgpKSB7CiAgICAgICAgICAgICAgICBjb25zdCBwID0gdGhpcy5fcGFyZW50OwogICAgICAgICAgICAgICAgbGV0IGNoID0gcC5HZXRIZWlnaHQoKTsKICAgICAgICAgICAgICAgIGxldCBzaCA9IHAuX0dldFNjZW5lR3JhcGhJbmZvKCkuX0dldFN0YXJ0SGVpZ2h0KCk7CiAgICAgICAgICAgICAgICBpZiAoY2ggPT09IDApIGNoID0gTnVtYmVyLkVQU0lMT047CiAgICAgICAgICAgICAgICBpZiAoc2ggPT09IE51bWJlci5FUFNJTE9OICYmIGNoID09PSBOdW1iZXIuRVBTSUxPTikgcmV0dXJuIDE7CiAgICAgICAgICAgICAgICBpZiAoc2ggPT09IE51bWJlci5FUFNJTE9OICYmIGNoICE9PSBOdW1iZXIuRVBTSUxPTikgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNka0ludGFuY2UgPSBwLkdldEluc3RhbmNlKCkuR2V0U2RrSW5zdGFuY2UoKTsKICAgICAgICAgICAgICAgICAgICBpZiAoc2RrSW50YW5jZS5Jc09yaWdpbmFsU2l6ZUtub3duKCkpIHJldHVybiAxICsgY2ggLyBzZGtJbnRhbmNlLkdldE9yaWdpbmFsSGVpZ2h0KCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBjaCAvIHNoCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIDEKICAgICAgICB9CiAgICAgICAgR2V0UGFyZW50U3RhcnRBbmdsZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3BhcmVudFN0YXJ0QW5nbGUKICAgICAgICB9CiAgICAgICAgX1NhdmVUb0pzb24obW9kZSkgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgInN3IjogdGhpcy5fc3RhcnRXaWR0aCwKICAgICAgICAgICAgICAgICJzaCI6IHRoaXMuX3N0YXJ0SGVpZ2h0LAogICAgICAgICAgICAgICAgInN4IjogdGhpcy5fc3RhcnRTY2FsZVgsCiAgICAgICAgICAgICAgICAic3kiOiB0aGlzLl9zdGFydFNjYWxlWSwKICAgICAgICAgICAgICAgICJwc2EiOiB0aGlzLl9wYXJlbnRTdGFydEFuZ2xlLAogICAgICAgICAgICAgICAgIm9vIjogdGhpcy5fb3duT3BhY2l0eSwKICAgICAgICAgICAgICAgICJzbyI6IHRoaXMuX3N0YXJ0T3BhY2l0eSwKICAgICAgICAgICAgICAgICJwIjogdGhpcy5fR2V0UGFyZW50SnNvbihtb2RlKSwKICAgICAgICAgICAgICAgICJjIjogdGhpcy5fR2V0Q2hpbGRyZW5Kc29uKG1vZGUpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgX0dldEZsYWdzU3RyaW5nKHdpKSB7CiAgICAgICAgICAgIGxldCBmbGFnc1N0ciA9ICIiOwogICAgICAgICAgICBpZiAod2kuR2V0VHJhbnNmb3JtV2l0aFBhcmVudFgoKSkgZmxhZ3NTdHIgKz0gIngiOwogICAgICAgICAgICBpZiAod2kuR2V0VHJhbnNmb3JtV2l0aFBhcmVudFkoKSkgZmxhZ3NTdHIgKz0gInkiOwogICAgICAgICAgICBpZiAod2kuR2V0VHJhbnNmb3JtV2l0aFBhcmVudFdpZHRoKCkpIGZsYWdzU3RyICs9ICJ3IjsKICAgICAgICAgICAgaWYgKHdpLkdldFRyYW5zZm9ybVdpdGhQYXJlbnRIZWlnaHQoKSkgZmxhZ3NTdHIgKz0gImgiOwogICAgICAgICAgICBpZiAod2kuR2V0VHJhbnNmb3JtV2l0aFBhcmVudEFuZ2xlKCkpIGZsYWdzU3RyICs9ICJhIjsKICAgICAgICAgICAgaWYgKHdpLkdldFRyYW5zZm9ybVdpdGhQYXJlbnRaRWxldmF0aW9uKCkpIGZsYWdzU3RyICs9CiAgICAgICAgICAgICAgICAieiI7CiAgICAgICAgICAgIGlmICh3aS5HZXREZXN0cm95V2l0aFBhcmVudCgpKSBmbGFnc1N0ciArPSAiZCI7CiAgICAgICAgICAgIGlmICh3aS5HZXRUcmFuc2Zvcm1XaXRoUGFyZW50T3BhY2l0eSgpKSBmbGFnc1N0ciArPSAibyI7CiAgICAgICAgICAgIGlmICh3aS5HZXRUcmFuc2Zvcm1XaXRoUGFyZW50VmlzaWJpbGl0eSgpKSBmbGFnc1N0ciArPSAidiI7CiAgICAgICAgICAgIHJldHVybiBmbGFnc1N0cgogICAgICAgIH0KICAgICAgICBfR2V0UGFyZW50SnNvbihtb2RlKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5fcGFyZW50KSByZXR1cm4gbnVsbDsKICAgICAgICAgICAgaWYgKCF0aGlzLl9wYXJlbnQuR2V0SW5zdGFuY2UoKSB8fCB0aGlzLl9wYXJlbnQuR2V0SW5zdGFuY2UoKS5Jc0Rlc3Ryb3llZCgpKSByZXR1cm4gbnVsbDsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX0dldEluc3RhbmNlSnNvbih0aGlzLl9wYXJlbnQsIHRoaXMuX293bmVyLCBtb2RlKQogICAgICAgIH0KICAgICAgICBfR2V0Q2hpbGRyZW5Kc29uKG1vZGUpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NoaWxkcmVuLm1hcChjID0+IHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9HZXRJbnN0YW5jZUpzb24oYywgYywgbW9kZSkKICAgICAgICAgICAgfSkKICAgICAgICB9CiAgICAgICAgX0dldEluc3RhbmNlSnNvbih3aSwgZmxhZ3NTb3VyY2UsIG1vZGUpIHsKICAgICAgICAgICAgY29uc3QgaW5zdCA9CiAgICAgICAgICAgICAgICB3aS5HZXRJbnN0YW5jZSgpOwogICAgICAgICAgICBjb25zdCByZXQgPSB7fTsKICAgICAgICAgICAgcmV0WyJ1aWQiXSA9IGluc3QuR2V0VUlEKCk7CiAgICAgICAgICAgIHJldFsiZiJdID0gdGhpcy5fR2V0RmxhZ3NTdHJpbmcoZmxhZ3NTb3VyY2UpOwogICAgICAgICAgICByZXRbIm9mZnNldHMiXSA9IGZsYWdzU291cmNlLl9TYXZlU2NlbmVHcmFwaFByb3BlcnRpZXNUb0pzb24oKTsKICAgICAgICAgICAgcmV0WyJkYXRhIl0gPSBDMy5TY2VuZUdyYXBoSW5mby5HZXRTY2VuZUdyYXBoSW5zdGFuY2VEYXRhRnJvbUluc3RhbmNlKGluc3QpOwogICAgICAgICAgICByZXRbIm9jaSJdID0gaW5zdC5HZXRPYmplY3RDbGFzcygpLkdldEluZGV4KCk7CiAgICAgICAgICAgIGlmIChtb2RlID09PSAic3RhdGUiKSB7CiAgICAgICAgICAgICAgICByZXRbImluc3QiXSA9IGluc3QuU2F2ZVRvSnNvbigpOwogICAgICAgICAgICAgICAgcmV0WyJpbnN0SW5kZXgiXSA9IE5hTgogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0WyJpbnN0SW5kZXgiXSA9IGluc3QuR2V0T2JqZWN0Q2xhc3MoKS5HZXRJbnN0YW5jZXMoKS5pbmRleE9mKGluc3QpOwogICAgICAgICAgICAgICAgcmV0WyJpbnN0Il0gPSBudWxsCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHJldAogICAgICAgIH0KICAgICAgICBfTG9hZEZyb21Kc29uKG8pIHsKICAgICAgICAgICAgdGhpcy5fc3RhcnRXaWR0aCA9IG9bInN3Il07CiAgICAgICAgICAgIHRoaXMuX3N0YXJ0SGVpZ2h0ID0KICAgICAgICAgICAgICAgIG9bInNoIl07CiAgICAgICAgICAgIHRoaXMuX3N0YXJ0U2NhbGVYID0gb1sic3giXTsKICAgICAgICAgICAgdGhpcy5fc3RhcnRTY2FsZVkgPSBvWyJzeSJdOwogICAgICAgICAgICB0aGlzLl9wYXJlbnRTdGFydEFuZ2xlID0gb1sicHNhIl07CiAgICAgICAgICAgIHRoaXMuX293bk9wYWNpdHkgPSBvWyJvbyJdOwogICAgICAgICAgICB0aGlzLl9zdGFydE9wYWNpdHkgPSBvWyJzbyJdCiAgICAgICAgfQogICAgICAgIF9TZXRUbXBTY2VuZUdyYXBoQ2hpbGRyZW4odG1wU2NlbmVHcmFwaENoaWxkcmVuLCB0bXBTY2VuZUdyYXBoQ2hpbGRyZW5JbmRleGVzKSB7CiAgICAgICAgICAgIHRoaXMuX3RtcFNjZW5lR3JhcGhDaGlsZHJlbiA9IHRtcFNjZW5lR3JhcGhDaGlsZHJlbjsKICAgICAgICAgICAgdGhpcy5fdG1wU2NlbmVHcmFwaENoaWxkcmVuSW5kZXhlcyA9IHRtcFNjZW5lR3JhcGhDaGlsZHJlbkluZGV4ZXMKICAgICAgICB9CiAgICAgICAgX09uQWZ0ZXJMb2FkKG8sIG9wdHMpIHsKICAgICAgICAgICAgY29uc3Qgb3duZXIgPSB0aGlzLl9vd25lcjsKICAgICAgICAgICAgY29uc3QgcnVudGltZSA9IG93bmVyLkdldFJ1bnRpbWUoKTsKICAgICAgICAgICAgY29uc3QgcHJvY2Vzc2VkRXhpc3RpbmdXaXMgPSBuZXcgU2V0OwogICAgICAgICAgICBpZiAob1sicCJdICYmICF0aGlzLl9wYXJlbnQpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHBhcmVudFVpZCA9IG9bInAiXVsidWlkIl07CiAgICAgICAgICAgICAgICBjb25zdCBwYXJlbnRJbnN0ID0gcnVudGltZS5HZXRJbnN0YW5jZUJ5VUlEKHBhcmVudFVpZCk7CiAgICAgICAgICAgICAgICBpZiAob3B0cyAmJiAhb3B0cy5pZ25vcmVNaXNzaW5nSW5zdGFuY2VzKTsKICAgICAgICAgICAgICAgIGlmIChwYXJlbnRJbnN0KSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcGFyZW50V2kgPSBwYXJlbnRJbnN0LkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICAgICAgICAgIGlmIChwYXJlbnRJbnN0Lkhhc0NoaWxkKHRoaXMuX293bmVyLkdldEluc3RhbmNlKCkpKSB0aGlzLl9wYXJlbnQgPSBwYXJlbnRXaTsKICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50SW5zdC5BZGRDaGlsZCh0aGlzLl9vd25lci5HZXRJbnN0YW5jZSgpLCB0aGlzLl9HZXRGbGFnc09iaihvWyJwIl1bImYiXSkpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXByb2Nlc3NlZEV4aXN0aW5nV2lzLmhhcyh0aGlzLl9vd25lcikpIHRoaXMuX293bmVyLl9Mb2FkU2NlbmVHcmFwaFByb3BlcnRpZXNGcm9tSnNvbihvWyJwIl1bIm9mZnNldHMiXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NlZEV4aXN0aW5nV2lzLmFkZCh0aGlzLl9vd25lcik7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHB3aSA9IHBhcmVudEluc3QuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHB3aS5fR2V0U2NlbmVHcmFwaEluZm8oKS5fTWF5YmVTb3J0Q2hpbGRyZW4oKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoQzMuSXNGaW5pdGVOdW1iZXIob1sicCJdWyJvY2kiXSkpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBvYmplY3RDbGFzcyA9CiAgICAgICAgICAgICAgICAgICAgICAgIHJ1bnRpbWUuR2V0T2JqZWN0Q2xhc3NCeUluZGV4KG9bInAiXVsib2NpIl0pOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHN5c3RlbSA9IHJ1bnRpbWUuR2V0U3lzdGVtUGx1Z2luKCk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcGFyZW50SW5zdGFuY2UgPSBydW50aW1lLkNyZWF0ZUluc3RhbmNlKG9iamVjdENsYXNzLCBvd25lci5HZXRMYXllcigpLCAwLCAwLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICBpZiAob3B0cyAmJiAhb3B0cy5pZ25vcmVNaXNzaW5nSW5zdGFuY2VzKTsKICAgICAgICAgICAgICAgICAgICBpZiAocGFyZW50SW5zdGFuY2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5zdERhdGEgPSB0aGlzLl9HZXRJbnN0YW5jZURhdGEob1sicCJdLCBydW50aW1lKTsKICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50SW5zdGFuY2UuTG9hZEZyb21Kc29uKGluc3REYXRhKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcGFyZW50V2kgPSBwYXJlbnRJbnN0YW5jZS5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50V2kuR2V0TGF5ZXIoKS5Tb3J0QW5kQWRkSW5zdGFuY2VzQnlaSW5kZXgocGFyZW50SW5zdGFuY2UpOwogICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnRJbnN0YW5jZS5BZGRDaGlsZChvd25lci5HZXRJbnN0YW5jZSgpLCB0aGlzLl9HZXRGbGFnc09iaihvWyJwIl1bImYiXSkpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwd2kgPSBwYXJlbnRJbnN0YW5jZS5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgICAgICAgICAgICAgcHdpLl9HZXRTY2VuZUdyYXBoSW5mbygpLl9NYXliZVNvcnRDaGlsZHJlbigpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IGNoaWxkSW5zdGFuY2VzID0gW107CiAgICAgICAgICAgIGZvciAoY29uc3QgY2hpbGREYXRhIG9mIG9bImMiXSkgewogICAgICAgICAgICAgICAgY29uc3QgY2hpbGRVaWQgPSBjaGlsZERhdGFbInVpZCJdOwogICAgICAgICAgICAgICAgY29uc3QgY2hpbGRJbnN0ID0gcnVudGltZS5HZXRJbnN0YW5jZUJ5VUlEKGNoaWxkVWlkKTsKICAgICAgICAgICAgICAgIGlmIChjaGlsZEluc3QpIGNoaWxkSW5zdGFuY2VzLnB1c2goY2hpbGRJbnN0KQogICAgICAgICAgICB9CiAgICAgICAgICAgIGxldCBjaGlsZEluZGV4ID0gMDsKICAgICAgICAgICAgZm9yIChjb25zdCBjaGlsZERhdGEgb2Ygb1siYyJdKSB7CiAgICAgICAgICAgICAgICBjb25zdCBjaGlsZFVpZCA9IGNoaWxkRGF0YVsidWlkIl07CiAgICAgICAgICAgICAgICBjb25zdCBjaGlsZEluc3QgPSBydW50aW1lLkdldEluc3RhbmNlQnlVSUQoY2hpbGRVaWQpOwogICAgICAgICAgICAgICAgaWYgKG9wdHMgJiYgIW9wdHMuaWdub3JlTWlzc2luZ0luc3RhbmNlcyk7CiAgICAgICAgICAgICAgICBpZiAoY2hpbGRJbnN0KSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX3RtcFNjZW5lR3JhcGhDaGlsZHJlbiAmJiB0aGlzLl90bXBTY2VuZUdyYXBoQ2hpbGRyZW5bY2hpbGRJbmRleF0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZXhpc3RpbmdDaGlsZEludGFuY2UgPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fdG1wU2NlbmVHcmFwaENoaWxkcmVuW2NoaWxkSW5kZXhdOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXhpc3RpbmdDaGlsZEludGFuY2UuR2V0T2JqZWN0Q2xhc3MoKSAhPT0gY2hpbGRJbnN0LkdldE9iamVjdENsYXNzKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkSW5kZXgrKzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGV4aXN0aW5nQ2hpbGRJbnRhbmNlLklzRGVzdHJveWVkKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkSW5kZXgrKzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbmV3Q2hpbGREYXRhID0gb1siYyJdW2NoaWxkSW5kZXhdOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9BZGRBbmRTZXRDaGlsZEluc3RhbmNlKGV4aXN0aW5nQ2hpbGRJbnRhbmNlLkdldFdvcmxkSW5mbygpLCBuZXdDaGlsZERhdGEsIHByb2Nlc3NlZEV4aXN0aW5nV2lzLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkSW5kZXgrKzsKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgb2JqZWN0Q2xhc3MgPSBjaGlsZEluc3QuR2V0T2JqZWN0Q2xhc3MoKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBjaGlsZHJlbkNvdW50ID0gdGhpcy5fR2V0SW5zdGFuY2VzT2ZPYmplY3RDbGFzc0NvdW50KGNoaWxkSW5zdGFuY2VzLCBvYmplY3RDbGFzcyk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgY2hpbGRyZW5PZkNsYXNzQ291bnQgPQogICAgICAgICAgICAgICAgICAgICAgICBvd25lci5HZXRJbnN0YW5jZSgpLkdldENoaWxkcmVuT2ZPYmplY3RDbGFzcyhvYmplY3RDbGFzcykubGVuZ3RoOwogICAgICAgICAgICAgICAgICAgIGlmIChjaGlsZHJlbkNvdW50ID09PSBjaGlsZHJlbk9mQ2xhc3NDb3VudCkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBleGlzdGluZ0NoaWxkID0gb3duZXIuR2V0SW5zdGFuY2UoKS5HZXRDaGlsZEF0KGNoaWxkSW5kZXgpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBleGlzdGluZ0NoaWxkV2kgPSBleGlzdGluZ0NoaWxkLkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXhpc3RpbmdDaGlsZFdpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXByb2Nlc3NlZEV4aXN0aW5nV2lzLmhhcyhleGlzdGluZ0NoaWxkV2kpKSBleGlzdGluZ0NoaWxkV2kuX0xvYWRTY2VuZUdyYXBoUHJvcGVydGllc0Zyb21Kc29uKGNoaWxkRGF0YVsib2Zmc2V0cyJdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NlZEV4aXN0aW5nV2lzLmFkZChleGlzdGluZ0NoaWxkV2kpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRJbmRleCsrOwogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoY2hpbGRJbnN0Lkhhc1BhcmVudCgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNoaWxkV2kgPSB0aGlzLl9DcmVhdGVOZXdDaGlsZEluc3RhbmNlKGNoaWxkRGF0YSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdHMpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9BZGRBbmRTZXRDaGlsZEluc3RhbmNlKGNoaWxkV2ksIGNoaWxkRGF0YSwgcHJvY2Vzc2VkRXhpc3RpbmdXaXMpOwogICAgICAgICAgICAgICAgICAgICAgICBjaGlsZEluZGV4Kys7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHRoaXMuX0FkZEFuZFNldENoaWxkSW5zdGFuY2UoY2hpbGRJbnN0LkdldFdvcmxkSW5mbygpLCBjaGlsZERhdGEsIHByb2Nlc3NlZEV4aXN0aW5nV2lzKQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBjaGlsZFdpID0gdGhpcy5fQ3JlYXRlTmV3Q2hpbGRJbnN0YW5jZShjaGlsZERhdGEsIG9wdHMpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX0FkZEFuZFNldENoaWxkSW5zdGFuY2UoY2hpbGRXaSwgY2hpbGREYXRhLCBwcm9jZXNzZWRFeGlzdGluZ1dpcykKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNoaWxkSW5kZXgrKwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIF9HZXRGbGFnc09iaihmbGFnc1N0cmluZykgewogICAgICAgICAgICBjb25zdCBvcHRzID0ge307CiAgICAgICAgICAgIG9wdHMudHJhbnNmb3JtWCA9IGZsYWdzU3RyaW5nLmluY2x1ZGVzKCJ4Iik7CiAgICAgICAgICAgIG9wdHMudHJhbnNmb3JtWSA9IGZsYWdzU3RyaW5nLmluY2x1ZGVzKCJ5Iik7CiAgICAgICAgICAgIG9wdHMudHJhbnNmb3JtV2lkdGggPSBmbGFnc1N0cmluZy5pbmNsdWRlcygidyIpOwogICAgICAgICAgICBvcHRzLnRyYW5zZm9ybUhlaWdodCA9CiAgICAgICAgICAgICAgICBmbGFnc1N0cmluZy5pbmNsdWRlcygiaCIpOwogICAgICAgICAgICBvcHRzLnRyYW5zZm9ybUFuZ2xlID0gZmxhZ3NTdHJpbmcuaW5jbHVkZXMoImEiKTsKICAgICAgICAgICAgb3B0cy50cmFuc2Zvcm1aRWxldmF0aW9uID0gZmxhZ3NTdHJpbmcuaW5jbHVkZXMoInoiKTsKICAgICAgICAgICAgb3B0cy5kZXN0cm95V2l0aFBhcmVudCA9IGZsYWdzU3RyaW5nLmluY2x1ZGVzKCJkIik7CiAgICAgICAgICAgIG9wdHMudHJhbnNmb3JtT3BhY2l0eSA9IGZsYWdzU3RyaW5nLmluY2x1ZGVzKCJvIik7CiAgICAgICAgICAgIG9wdHMudHJhbnNmb3JtVmlzaWJpbGl0eSA9IGZsYWdzU3RyaW5nLmluY2x1ZGVzKCJ2Iik7CiAgICAgICAgICAgIHJldHVybiBvcHRzCiAgICAgICAgfQogICAgICAgIF9DcmVhdGVOZXdDaGlsZEluc3RhbmNlKGNoaWxkRGF0YSwgb3B0cykgewogICAgICAgICAgICBpZiAoIUMzLklzRmluaXRlTnVtYmVyKGNoaWxkRGF0YVsib2NpIl0pKSByZXR1cm47CiAgICAgICAgICAgIGNvbnN0IG93bmVyID0gdGhpcy5fb3duZXI7CiAgICAgICAgICAgIGNvbnN0IHJ1bnRpbWUgPSBvd25lci5HZXRSdW50aW1lKCk7CiAgICAgICAgICAgIGxldCBjaGlsZEluc3RhbmNlOwogICAgICAgICAgICBpZiAoY2hpbGREYXRhWyJkYXRhIl0pIGNoaWxkSW5zdGFuY2UgPSBydW50aW1lLkNyZWF0ZUluc3RhbmNlRnJvbURhdGEoY2hpbGREYXRhWyJkYXRhIl0sCiAgICAgICAgICAgICAgICBvd25lci5HZXRMYXllcigpLCBmYWxzZSwgMCwgMCwgZmFsc2UsIHRydWUpOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbnN0IG9iamVjdENsYXNzID0gcnVudGltZS5HZXRPYmplY3RDbGFzc0J5SW5kZXgoY2hpbGREYXRhWyJvY2kiXSk7CiAgICAgICAgICAgICAgICBjaGlsZEluc3RhbmNlID0gcnVudGltZS5DcmVhdGVJbnN0YW5jZShvYmplY3RDbGFzcywgb3duZXIuR2V0TGF5ZXIoKSwgMCwgMCwgdHJ1ZSkKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAob3B0cyAmJiAhb3B0cy5pZ25vcmVNaXNzaW5nSW5zdGFuY2VzKTsKICAgICAgICAgICAgaWYgKCFjaGlsZEluc3RhbmNlKSByZXR1cm47CiAgICAgICAgICAgIGNvbnN0IGluc3REYXRhID0gdGhpcy5fR2V0SW5zdGFuY2VEYXRhKGNoaWxkRGF0YSwgcnVudGltZSk7CiAgICAgICAgICAgIGNoaWxkSW5zdGFuY2UuTG9hZEZyb21Kc29uKGluc3REYXRhKTsKICAgICAgICAgICAgY29uc3QgY2hpbGRXaSA9IGNoaWxkSW5zdGFuY2UuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgIGNoaWxkV2kuR2V0TGF5ZXIoKS5Tb3J0QW5kQWRkSW5zdGFuY2VzQnlaSW5kZXgoY2hpbGRJbnN0YW5jZSwgdHJ1ZSk7CiAgICAgICAgICAgIHJldHVybiBjaGlsZFdpCiAgICAgICAgfQogICAgICAgIF9BZGRBbmRTZXRDaGlsZEluc3RhbmNlKGNoaWxkV2ksIGNoaWxkRGF0YSwKICAgICAgICAgICAgcHJvY2Vzc2VkRXhpc3RpbmdXaXMsIHNldEpzb24gPSB0cnVlKSB7CiAgICAgICAgICAgIGNvbnN0IG93bmVyID0gdGhpcy5fb3duZXI7CiAgICAgICAgICAgIG93bmVyLkFkZENoaWxkKGNoaWxkV2ksIHRoaXMuX0dldEZsYWdzT2JqKGNoaWxkRGF0YVsiZiJdKSk7CiAgICAgICAgICAgIGlmIChzZXRKc29uKSB7CiAgICAgICAgICAgICAgICBpZiAoIXByb2Nlc3NlZEV4aXN0aW5nV2lzLmhhcyhjaGlsZFdpKSkgY2hpbGRXaS5fTG9hZFNjZW5lR3JhcGhQcm9wZXJ0aWVzRnJvbUpzb24oY2hpbGREYXRhWyJvZmZzZXRzIl0pOwogICAgICAgICAgICAgICAgcHJvY2Vzc2VkRXhpc3RpbmdXaXMuYWRkKGNoaWxkV2kpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5fTWF5YmVTb3J0Q2hpbGRyZW4oKQogICAgICAgIH0KICAgICAgICBfR2V0SW5zdGFuY2VzT2ZPYmplY3RDbGFzc0NvdW50KGluc3RhbmNlcywgb2JqZWN0Q2xhc3MpIHsKICAgICAgICAgICAgcmV0dXJuIGluc3RhbmNlcy5maWx0ZXIoaSA9PiBpLkdldE9iamVjdENsYXNzKCkuR2V0TmFtZSgpID09PSBvYmplY3RDbGFzcy5HZXROYW1lKCkpLmxlbmd0aAogICAgICAgIH0KICAgICAgICBfR2V0SW5zdGFuY2VEYXRhKGpzb24sIHJ1bnRpbWUpIHsKICAgICAgICAgICAgaWYgKEMzLklzRmluaXRlTnVtYmVyKGpzb25bImluc3RJbmRleCJdKSkgewogICAgICAgICAgICAgICAgY29uc3Qgb2JqZWN0Q2xhc3MgPQogICAgICAgICAgICAgICAgICAgIHJ1bnRpbWUuR2V0T2JqZWN0Q2xhc3NCeUluZGV4KGpzb25bIm9jaSJdKTsKICAgICAgICAgICAgICAgIGNvbnN0IGluc3RhbmNlc0pzb24gPSBvYmplY3RDbGFzcy5fR2V0TG9hZEluc3RhbmNlc0pzb24oKTsKICAgICAgICAgICAgICAgIHJldHVybiBpbnN0YW5jZXNKc29uW2pzb25bImluc3RJbmRleCJdXQogICAgICAgICAgICB9IGVsc2UgaWYgKEMzLklzU3RyaW5nKGpzb25bImluc3QiXSkpIHJldHVybiBKU09OLnBhcnNlKGpzb25bImluc3QiXSk7CiAgICAgICAgICAgIGVsc2UgaWYgKGpzb25bImluc3QiXSkgcmV0dXJuIGpzb25bImluc3QiXQogICAgICAgIH0KICAgICAgICBzdGF0aWMgR2V0U2NlbmVHcmFwaEluc3RhbmNlRGF0YUZyb21JbnN0YW5jZShzb3VyY2VJbnN0YW5jZSkgewogICAgICAgICAgICBsZXQgaW5zdERhdGEgPSBzb3VyY2VJbnN0YW5jZS5HZXRXb3JsZEluZm8oKS5HZXRMYXllcigpLkdldEluaXRpYWxJbnN0YW5jZURhdGEoc291cmNlSW5zdGFuY2UuR2V0VUlEKCkpOwogICAgICAgICAgICBpZiAoIWluc3REYXRhKSByZXR1cm4gbnVsbDsKICAgICAgICAgICAgaW5zdERhdGEgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGluc3REYXRhKSk7CiAgICAgICAgICAgIGNvbnN0IG5ld1NnaURhdGEgPSBbXTsKICAgICAgICAgICAgZm9yIChjb25zdCBjaGlsZCBvZiBbLi4uc291cmNlSW5zdGFuY2UuR2V0Q2hpbGRyZW4oKV0pIHsKICAgICAgICAgICAgICAgIGNvbnN0IGNoaWxkV2kgPQogICAgICAgICAgICAgICAgICAgIGNoaWxkLkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICAgICAgbmV3U2dpRGF0YS5wdXNoKFtjaGlsZFdpLkdldExheW91dCgpLkdldFNJRCgpLCBjaGlsZFdpLkdldExheWVyKCkuR2V0SW5kZXgoKSwgY2hpbGQuR2V0VUlEKCksIEMzLlNjZW5lR3JhcGhJbmZvLl9HZXRGbGFnc051bWJlcihjaGlsZFdpKSwgY2hpbGQuR2V0T2JqZWN0Q2xhc3MoKS5Jc0luQ29udGFpbmVyKCkgPyAxIDogMCwgY2hpbGRXaS5HZXRaSW5kZXgoKSwgQzMuU2NlbmVHcmFwaEluZm8uR2V0U2NlbmVHcmFwaEluc3RhbmNlRGF0YUZyb21JbnN0YW5jZShjaGlsZCldKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChDMy5Jc0FycmF5KGluc3REYXRhWzBdWzE0XSkpIGluc3REYXRhWzBdWzE0XVsxXSA9IG5ld1NnaURhdGE7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgaW5zdERhdGFbMF1bMTRdID0gW107CiAgICAgICAgICAgICAgICBpbnN0RGF0YVswXVsxNF1bMF0gPSBDMy5TY2VuZUdyYXBoSW5mby5fR2V0RGVmYXVsdEZsYWdzTnVtYmVyKCk7CiAgICAgICAgICAgICAgICBpbnN0RGF0YVswXVsxNF1bMV0gPSBuZXdTZ2lEYXRhOwogICAgICAgICAgICAgICAgaW5zdERhdGFbMF1bMTRdWzJdID0gc291cmNlSW5zdGFuY2UuR2V0V29ybGRJbmZvKCkuR2V0WkluZGV4KCkKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gaW5zdERhdGEKICAgICAgICB9CiAgICAgICAgc3RhdGljIF9HZXRGbGFnc051bWJlcih3aSkgewogICAgICAgICAgICBsZXQgZmxhZ3NOdW1iZXIgPQogICAgICAgICAgICAgICAgMDsKICAgICAgICAgICAgZmxhZ3NOdW1iZXIgfD0gTnVtYmVyKHdpLkdldFRyYW5zZm9ybVdpdGhQYXJlbnRWaXNpYmlsaXR5KCkpIDw8IDg7CiAgICAgICAgICAgIGZsYWdzTnVtYmVyIHw9IE51bWJlcih3aS5HZXRUcmFuc2Zvcm1XaXRoUGFyZW50T3BhY2l0eSgpKSA8PCA3OwogICAgICAgICAgICBmbGFnc051bWJlciB8PSBOdW1iZXIod2kuR2V0VHJhbnNmb3JtV2l0aFBhcmVudFpFbGV2YXRpb24oKSkgPDwgNjsKICAgICAgICAgICAgZmxhZ3NOdW1iZXIgfD0gTnVtYmVyKHdpLkdldERlc3Ryb3lXaXRoUGFyZW50KCkpIDw8IDU7CiAgICAgICAgICAgIGZsYWdzTnVtYmVyIHw9IE51bWJlcih3aS5HZXRUcmFuc2Zvcm1XaXRoUGFyZW50QW5nbGUoKSkgPDwgNDsKICAgICAgICAgICAgZmxhZ3NOdW1iZXIgfD0gTnVtYmVyKHdpLkdldFRyYW5zZm9ybVdpdGhQYXJlbnRIZWlnaHQoKSkgPDwgMzsKICAgICAgICAgICAgZmxhZ3NOdW1iZXIgfD0gTnVtYmVyKHdpLkdldFRyYW5zZm9ybVdpdGhQYXJlbnRXaWR0aCgpKSA8PCAyOwogICAgICAgICAgICBmbGFnc051bWJlciB8PSBOdW1iZXIod2kuR2V0VHJhbnNmb3JtV2l0aFBhcmVudFkoKSkgPDwgMTsKICAgICAgICAgICAgZmxhZ3NOdW1iZXIgfD0gTnVtYmVyKHdpLkdldFRyYW5zZm9ybVdpdGhQYXJlbnRYKCkpIDw8CiAgICAgICAgICAgICAgICAwOwogICAgICAgICAgICByZXR1cm4gZmxhZ3NOdW1iZXIKICAgICAgICB9CiAgICAgICAgc3RhdGljIF9HZXREZWZhdWx0RmxhZ3NOdW1iZXIod2kpIHsKICAgICAgICAgICAgbGV0IGZsYWdzTnVtYmVyID0gMDsKICAgICAgICAgICAgZmxhZ3NOdW1iZXIgfD0gMSA8PCA4OwogICAgICAgICAgICBmbGFnc051bWJlciB8PSAxIDw8IDc7CiAgICAgICAgICAgIGZsYWdzTnVtYmVyIHw9IDEgPDwgNjsKICAgICAgICAgICAgZmxhZ3NOdW1iZXIgfD0gMSA8PCA1OwogICAgICAgICAgICBmbGFnc051bWJlciB8PSAxIDw8IDQ7CiAgICAgICAgICAgIGZsYWdzTnVtYmVyIHw9IDEgPDwgMzsKICAgICAgICAgICAgZmxhZ3NOdW1iZXIgfD0gMSA8PCAyOwogICAgICAgICAgICBmbGFnc051bWJlciB8PSAxIDw8IDE7CiAgICAgICAgICAgIGZsYWdzTnVtYmVyIHw9IDEgPDwgMDsKICAgICAgICAgICAgcmV0dXJuIGZsYWdzTnVtYmVyCiAgICAgICAgfQogICAgfTsKCn0KCi8vIG9iamVjdHMvd29ybGRJbmZvLmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIGNvbnN0IGdsTWF0cml4ID0gc2VsZi5nbE1hdHJpeDsKICAgIGNvbnN0IHZlYzMgPSBnbE1hdHJpeC52ZWMzOwogICAgY29uc3QgdmVjNCA9IGdsTWF0cml4LnZlYzQ7CiAgICBjb25zdCB0ZW1wUmVjdCA9IEMzLk5ldyhDMy5SZWN0KTsKICAgIGNvbnN0IHRlbXBRdWFkID0gQzMuTmV3KEMzLlF1YWQpOwogICAgY29uc3QgYmJveENoYW5nZUV2ZW50ID0gQzMuTmV3KEMzLkV2ZW50LCAiYmJveGNoYW5nZSIsIGZhbHNlKTsKICAgIGNvbnN0IHRlbXBDb2xvciA9IEMzLk5ldyhDMy5Db2xvciwgMCwgMCwgMCwgMCk7CiAgICBjb25zdCB0ZW1wQ29sbGlzaW9uUG9seSA9IEMzLk5ldyhDMy5Db2xsaXNpb25Qb2x5KTsKICAgIGNvbnN0IERFRkFVTFRfQ09MT1IgPSBDMy5OZXcoQzMuQ29sb3IsIDEsIDEsIDEsIDEpOwogICAgY29uc3QgREVGQVVMVF9SRU5ERVJfQ0VMTFMgPSBDMy5OZXcoQzMuUmVjdCwgMCwgMCwgLTEsIC0xKTsKICAgIGNvbnN0IERFRkFVTFRfQ09MTElTSU9OX0NFTExTID0gQzMuTmV3KEMzLlJlY3QsIDAsIDAsIC0xLCAtMSk7CiAgICBjb25zdCBWQUxJRF9TRVRfTUVTSF9QT0lOVF9NT0RFUyA9IG5ldyBTZXQoWyJhYnNvbHV0ZSIsICJyZWxhdGl2ZSJdKTsKICAgIGNvbnN0IEVNUFRZX0FSUkFZID0gW107CiAgICBsZXQgZW5hYmxlVXBkYXRlUmVuZGVyZXJTdGF0ZUdyb3VwID0gdHJ1ZTsKICAgIGNvbnN0IEZMQUdfSVNfVklTSUJMRSA9IDEgPDwgMDsKICAgIGNvbnN0IEZMQUdfQkJPWF9DSEFOR0VEID0gMSA8PCAxOwogICAgY29uc3QgRkxBR19FTkFCTEVfQkJPWF9DSEFOR0VEX0VWRU5UID0gMSA8PCAyOwogICAgY29uc3QgRkxBR19DT0xMSVNJT05fRU5BQkxFRCA9IDEgPDwgMzsKICAgIGNvbnN0IEZMQUdfQ09MTElTSU9OX0NFTExfQ0hBTkdFRCA9IDEgPDwgNDsKICAgIGNvbnN0IEZMQUdfU09MSURfRklMVEVSX0lOQ0xVU0lWRSA9IDEgPDwgNTsKICAgIGNvbnN0IEZMQUdfSEFTX0FOWV9BQ1RJVkVfRUZGRUNUID0gMSA8PCA2OwogICAgY29uc3QgRkxBR19JU19ST1RBVEFCTEUgPSAxIDw8IDc7CiAgICBjb25zdCBGTEFHX0RFU1RST1lFRCA9IDEgPDwgODsKICAgIGNvbnN0IEZMQUdfREVTVFJPWV9XSVRIX1BBUkVOVCA9IDEgPDwgOTsKICAgIGNvbnN0IEZMQUdfVFJBTlNGT1JNX1dJVEhfUEFSRU5UX1ggPSAxIDw8IDEwOwogICAgY29uc3QgRkxBR19UUkFOU0ZPUk1fV0lUSF9QQVJFTlRfWSA9IDEgPDwgMTE7CiAgICBjb25zdCBGTEFHX1RSQU5TRk9STV9XSVRIX1BBUkVOVF9XID0gMSA8PCAxMjsKICAgIGNvbnN0IEZMQUdfVFJBTlNGT1JNX1dJVEhfUEFSRU5UX0ggPSAxIDw8IDEzOwogICAgY29uc3QgRkxBR19UUkFOU0ZPUk1fV0lUSF9QQVJFTlRfQSA9IDEgPDwgMTQ7CiAgICBjb25zdCBGTEFHX1RSQU5TRk9STV9XSVRIX1BBUkVOVF9aX0VMRVZBVElPTiA9IDEgPDwgMTU7CiAgICBjb25zdCBGTEFHX1RSQU5TRk9STV9XSVRIX1BBUkVOVF9PUEFDSVRZID0gMSA8PCAyMjsKICAgIGNvbnN0IEZMQUdfVFJBTlNGT1JNX1dJVEhfUEFSRU5UX1ZJU0lCSUxJVFkgPSAxIDw8IDIzOwogICAgY29uc3QgTUFTS19BTExfU0NFTkVfR1JBUEhfRkxBR1MgPSBGTEFHX0RFU1RST1lfV0lUSF9QQVJFTlQgfCBGTEFHX1RSQU5TRk9STV9XSVRIX1BBUkVOVF9YIHwgRkxBR19UUkFOU0ZPUk1fV0lUSF9QQVJFTlRfWSB8IEZMQUdfVFJBTlNGT1JNX1dJVEhfUEFSRU5UX1cgfCBGTEFHX1RSQU5TRk9STV9XSVRIX1BBUkVOVF9IIHwgRkxBR19UUkFOU0ZPUk1fV0lUSF9QQVJFTlRfQSB8IEZMQUdfVFJBTlNGT1JNX1dJVEhfUEFSRU5UX1pfRUxFVkFUSU9OIHwgRkxBR19UUkFOU0ZPUk1fV0lUSF9QQVJFTlRfT1BBQ0lUWSB8IEZMQUdfVFJBTlNGT1JNX1dJVEhfUEFSRU5UX1ZJU0lCSUxJVFk7CiAgICBjb25zdCBGTEFHX01FU0hfQ0hBTkdFRCA9IDEgPDwgMTY7CiAgICBjb25zdCBGTEFHX1BIWVNJQ1NfQk9EWV9DSEFOR0VEID0gMSA8PCAxNzsKICAgIGNvbnN0IEZMQUdfU0lOX0NPU19BTkdMRV9DSEFOR0VEID0gMSA8PCAxODsKICAgIGNvbnN0IEZMQUdfVVNFX1BPSU5UU19TSEFERVJfUFJPR1JBTSA9IDEgPDwgMTk7CiAgICBjb25zdCBGTEFHX0RSQVdfQkFDS19GQUNFX09OTFkgPSAxIDw8IDIwOwogICAgY29uc3QgRkxBR19EUkFXX05PTl9CQUNLX0ZBQ0VTX09OTFkgPSAxIDw8IDIxOwogICAgY29uc3QgRkxBR19CTEVORF9NT0RFX0JJVF9PRkZTRVQgPSAyNjsKICAgIGNvbnN0IEZMQUdfQkxFTkRfTU9ERV9NQVNLID0gMzEgPDwgRkxBR19CTEVORF9NT0RFX0JJVF9PRkZTRVQ7CiAgICBjb25zdCBzY2VuZUdyYXBoRXhwb3J0RGF0YU1hcCA9IG5ldyBXZWFrTWFwOwogICAgY29uc3Qgc2NlbmVHcmFwaFpJbmRleE1hcCA9IG5ldyBXZWFrTWFwOwogICAgY29uc3QgbmVlZHNTY2VuZUdyYXBoQWZ0ZXJMb2FkID0gbmV3IFdlYWtNYXA7CiAgICBDMy5Xb3JsZEluZm8gPSBjbGFzcyBXb3JsZEluZm8gZXh0ZW5kcyBDMy5EZWZlbmRlZEJhc2UgewogICAgICAgIGNvbnN0cnVjdG9yKGluc3QsIGxheWVyKSB7CiAgICAgICAgICAgIHN1cGVyKCk7CiAgICAgICAgICAgIHRoaXMuX2luc3QgPSBpbnN0OwogICAgICAgICAgICB0aGlzLl9vYmplY3RDbGFzcyA9IGluc3QuR2V0T2JqZWN0Q2xhc3MoKTsKICAgICAgICAgICAgdGhpcy5fcnVudGltZSA9IGluc3QuR2V0UnVudGltZSgpOwogICAgICAgICAgICB0aGlzLl9sYXllciA9IGxheWVyOwogICAgICAgICAgICB0aGlzLl96SW5kZXggPSAtMTsKICAgICAgICAgICAgdGhpcy5fZmxhZ3MgPSBGTEFHX0lTX1ZJU0lCTEUgfCBGTEFHX0JCT1hfQ0hBTkdFRCB8IEZMQUdfQ09MTElTSU9OX0VOQUJMRUQgfCBGTEFHX0NPTExJU0lPTl9DRUxMX0NIQU5HRUQgfCBGTEFHX01FU0hfQ0hBTkdFRCB8IEZMQUdfUEhZU0lDU19CT0RZX0NIQU5HRUQ7CiAgICAgICAgICAgIGlmICh0aGlzLl9vYmplY3RDbGFzcy5HZXRQbHVnaW4oKS5Jc1JvdGF0YWJsZSgpKSB0aGlzLl9mbGFncyB8PSBGTEFHX0lTX1JPVEFUQUJMRTsKICAgICAgICAgICAgdGhpcy5feCA9IE5hTjsKICAgICAgICAgICAgdGhpcy5feSA9IE5hTjsKICAgICAgICAgICAgdGhpcy5fekVsZXZhdGlvbiA9IE5hTjsKICAgICAgICAgICAgdGhpcy5fdyA9IE5hTjsKICAgICAgICAgICAgdGhpcy5faCA9IE5hTjsKICAgICAgICAgICAgdGhpcy5fZGVwdGggPQogICAgICAgICAgICAgICAgTmFOOwogICAgICAgICAgICB0aGlzLl9hID0gTmFOOwogICAgICAgICAgICB0aGlzLl9zaW5BID0gTmFOOwogICAgICAgICAgICB0aGlzLl9jb3NBID0gTmFOOwogICAgICAgICAgICB0aGlzLl9veCA9IE5hTjsKICAgICAgICAgICAgdGhpcy5fb3kgPSBOYU47CiAgICAgICAgICAgIHRoaXMuX2JvdW5kaW5nQm94ID0gQzMuTmV3KEMzLlJlY3QpOwogICAgICAgICAgICB0aGlzLl9ib3VuZGluZ1F1YWQgPSBDMy5OZXcoQzMuUXVhZCk7CiAgICAgICAgICAgIHRoaXMuX2NvbGxpc2lvbkNlbGxzID0gREVGQVVMVF9DT0xMSVNJT05fQ0VMTFM7CiAgICAgICAgICAgIHRoaXMuX3JlbmRlckNlbGxzID0gREVGQVVMVF9SRU5ERVJfQ0VMTFM7CiAgICAgICAgICAgIHRoaXMuX3NvdXJjZUNvbGxpc2lvblBvbHkgPSBudWxsOwogICAgICAgICAgICB0aGlzLl90cmFuc2Zvcm1lZFBvbHlJbmZvID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fc29saWRGaWx0ZXJUYWdzID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fY29sb3IgPSBERUZBVUxUX0NPTE9SOwogICAgICAgICAgICB0aGlzLl9jb2xvclByZW11bHRpcGxpZWQgPSBERUZBVUxUX0NPTE9SOwogICAgICAgICAgICB0aGlzLl9zdGF0ZUdyb3VwID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5faW5zdGFuY2VFZmZlY3RMaXN0ID0gbnVsbDsKICAgICAgICAgICAgaWYgKHRoaXMuX2luc3QuR2V0T2JqZWN0Q2xhc3MoKS5Vc2VzRWZmZWN0cygpKSB0aGlzLl9pbnN0YW5jZUVmZmVjdExpc3QgPQogICAgICAgICAgICAgICAgQzMuTmV3KEMzLkluc3RhbmNlRWZmZWN0TGlzdCwgdGhpcy5faW5zdCwgdGhpcyk7CiAgICAgICAgICAgIHRoaXMuX3NjZW5lR3JhcGhJbmZvID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fdG1wU2NlbmVHcmFwaENoaWxkcmVuID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fdG1wU2NlbmVHcmFwaENoaWxkcmVuSW5kZXhlcyA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX2FmdGVyX2xvYWQgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9hZnRlcl9sb2FkX2luc3RhbmNlID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fbWVzaEluZm8gPSBudWxsCiAgICAgICAgfQogICAgICAgIF9NYXJrRGVzdHJveWVkKCkgewogICAgICAgICAgICB0aGlzLl9mbGFncyB8PSBGTEFHX0RFU1RST1lFRAogICAgICAgIH0KICAgICAgICBSZWxlYXNlKCkgewogICAgICAgICAgICBpZiAodGhpcy5fc3RhdGVHcm91cCkgewogICAgICAgICAgICAgICAgdGhpcy5fcnVudGltZS5HZXRSZW5kZXJlcigpLlJlbGVhc2VTdGF0ZUdyb3VwKHRoaXMuX3N0YXRlR3JvdXApOwogICAgICAgICAgICAgICAgdGhpcy5fc3RhdGVHcm91cCA9IG51bGwKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLl9zb3VyY2VDb2xsaXNpb25Qb2x5ID0gbnVsbDsKICAgICAgICAgICAgaWYgKHRoaXMuX3RyYW5zZm9ybWVkUG9seUluZm8pIHsKICAgICAgICAgICAgICAgIHRoaXMuX3RyYW5zZm9ybWVkUG9seUluZm8ucG9seS5SZWxlYXNlKCk7CiAgICAgICAgICAgICAgICB0aGlzLl90cmFuc2Zvcm1lZFBvbHlJbmZvID0KICAgICAgICAgICAgICAgICAgICBudWxsCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHRoaXMuX3NvbGlkRmlsdGVyVGFncykgewogICAgICAgICAgICAgICAgdGhpcy5fc29saWRGaWx0ZXJUYWdzLmNsZWFyKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9zb2xpZEZpbHRlclRhZ3MgPSBudWxsCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5SZWxlYXNlTWVzaCgpOwogICAgICAgICAgICBpZiAodGhpcy5faW5zdGFuY2VFZmZlY3RMaXN0KSB0aGlzLl9pbnN0YW5jZUVmZmVjdExpc3QuUmVsZWFzZSgpOwogICAgICAgICAgICBpZiAodGhpcy5IYXNQYXJlbnQoKSkgdGhpcy5HZXRQYXJlbnQoKS5SZW1vdmVDaGlsZCh0aGlzKTsKICAgICAgICAgICAgaWYgKHRoaXMuSGFzQ2hpbGRyZW4oKSkgewogICAgICAgICAgICAgICAgY29uc3QgY2hpbGRyZW5Ub1JlbGVhc2UgPSBbLi4udGhpcy5HZXRDaGlsZHJlbigpXTsKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgY2hpbGQgb2YgY2hpbGRyZW5Ub1JlbGVhc2UpIHRoaXMuUmVtb3ZlQ2hpbGQoY2hpbGQpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5fUmVsZWFzZVNjZW5lR3JhcGhJbmZvKCk7CiAgICAgICAgICAgIHRoaXMuX1JlbGVhc2VUbXBTY2VuZUdyYXBoSW5mbygpOwogICAgICAgICAgICBzY2VuZUdyYXBoRXhwb3J0RGF0YU1hcC5kZWxldGUodGhpcyk7CiAgICAgICAgICAgIHNjZW5lR3JhcGhaSW5kZXhNYXAuZGVsZXRlKHRoaXMpOwogICAgICAgICAgICBpZiAodGhpcy5fYWZ0ZXJfbG9hZCkgewogICAgICAgICAgICAgICAgdGhpcy5HZXRSdW50aW1lKCkuRGlzcGF0Y2hlcigpLnJlbW92ZUV2ZW50TGlzdGVuZXIoImFmdGVybG9hZCIsCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYWZ0ZXJfbG9hZCk7CiAgICAgICAgICAgICAgICB0aGlzLl9hZnRlcl9sb2FkID0gbnVsbAogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLl9hZnRlcl9sb2FkX2luc3RhbmNlKSB7CiAgICAgICAgICAgICAgICB0aGlzLkdldFJ1bnRpbWUoKS5EaXNwYXRjaGVyKCkucmVtb3ZlRXZlbnRMaXN0ZW5lcigiYWZ0ZXJsb2FkaW5zdGFuY2UiLCB0aGlzLl9hZnRlcl9sb2FkX2luc3RhbmNlKTsKICAgICAgICAgICAgICAgIHRoaXMuX2FmdGVyX2xvYWRfaW5zdGFuY2UgPSBudWxsCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5faW5zdCA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX29iamVjdENsYXNzID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fcnVudGltZSA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX2xheWVyID0gbnVsbAogICAgICAgIH0KICAgICAgICBJbml0KGRhdGEpIHsKICAgICAgICAgICAgZW5hYmxlVXBkYXRlUmVuZGVyZXJTdGF0ZUdyb3VwID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuU2V0WFkoZGF0YVswXSwgZGF0YVsxXSk7CiAgICAgICAgICAgIHRoaXMuU2V0WkVsZXZhdGlvbihkYXRhWzJdKTsKICAgICAgICAgICAgdGhpcy5TZXRTaXplKGRhdGFbM10sIGRhdGFbNF0pOwogICAgICAgICAgICB0aGlzLl9kZXB0aCA9IDA7CiAgICAgICAgICAgIGlmICh0aGlzLklzUm90YXRhYmxlKCkpIHRoaXMuU2V0QW5nbGUoZGF0YVs2XSk7CiAgICAgICAgICAgIGVsc2UgdGhpcy5fYSA9IDA7CiAgICAgICAgICAgIHRlbXBDb2xvci5zZXRGcm9tSlNPTihkYXRhWzddKTsKICAgICAgICAgICAgdGhpcy5fU2V0Q29sb3IodGVtcENvbG9yKTsKICAgICAgICAgICAgdGhpcy5TZXRPcmlnaW5YKGRhdGFbOF0pOwogICAgICAgICAgICB0aGlzLlNldE9yaWdpblkoZGF0YVs5XSk7CiAgICAgICAgICAgIHRoaXMuU2V0QmxlbmRNb2RlKGRhdGFbMTBdKTsKICAgICAgICAgICAgaWYgKHRoaXMuX2luc3RhbmNlRWZmZWN0TGlzdCkgdGhpcy5faW5zdGFuY2VFZmZlY3RMaXN0Ll9Mb2FkRWZmZWN0UGFyYW1ldGVycyhkYXRhWzEyXSk7CiAgICAgICAgICAgIGlmIChkYXRhWzE0XSkgc2NlbmVHcmFwaEV4cG9ydERhdGFNYXAuc2V0KHRoaXMsIHsKICAgICAgICAgICAgICAgIGNoaWxkcmVuRGF0YTogZGF0YVsxNF1bMV0sCiAgICAgICAgICAgICAgICB6SW5kZXhEYXRhOiBkYXRhWzE0XVsyXQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgaWYgKGRhdGFbMTVdKSB7CiAgICAgICAgICAgICAgICBjb25zdCBtZXNoRGF0YSA9IGRhdGFbMTVdOwogICAgICAgICAgICAgICAgdGhpcy5DcmVhdGVNZXNoKG1lc2hEYXRhWzBdLCBtZXNoRGF0YVsxXSk7CiAgICAgICAgICAgICAgICBjb25zdCBzb3VyY2VNZXNoID0gdGhpcy5HZXRTb3VyY2VNZXNoKCk7CiAgICAgICAgICAgICAgICBjb25zdCBtZXNoUm93cyA9IG1lc2hEYXRhWzJdOwogICAgICAgICAgICAgICAgZm9yIChsZXQgeSA9IDAsIGxlblkgPSBtZXNoUm93cy5sZW5ndGg7IHkgPCBsZW5ZOyArK3kpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCByb3dEYXRhID0gbWVzaFJvd3NbeV07CiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgeCA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAwLCBsZW5YID0gcm93RGF0YS5sZW5ndGg7IHggPCBsZW5YOyArK3gpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZCA9IHJvd0RhdGFbeF07CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHB0ID0gc291cmNlTWVzaC5HZXRNZXNoUG9pbnRBdCh4LCB5KTsKICAgICAgICAgICAgICAgICAgICAgICAgcHQuU2V0WChkWzBdKTsKICAgICAgICAgICAgICAgICAgICAgICAgcHQuU2V0WShkWzFdKTsKICAgICAgICAgICAgICAgICAgICAgICAgcHQuU2V0WkVsZXZhdGlvbihkWzJdKTsKICAgICAgICAgICAgICAgICAgICAgICAgcHQuU2V0VShkWzNdKTsKICAgICAgICAgICAgICAgICAgICAgICAgcHQuU2V0VihkWzRdKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZGF0YVsxNl0pIHsKICAgICAgICAgICAgICAgIGNvbnN0IHRlbXBsYXRlTmFtZSA9IGRhdGFbMTZdWzBdOwogICAgICAgICAgICAgICAgY29uc3Qgc291cmNlVGVtcGxhdGVOYW1lID0gZGF0YVsxNl1bMV07CiAgICAgICAgICAgICAgICBjb25zdCBpc1JlcGxpY2EgPSAhIXNvdXJjZVRlbXBsYXRlTmFtZTsKICAgICAgICAgICAgICAgIGNvbnN0IGlzVGVtcGxhdGUgPSAhaXNSZXBsaWNhOwogICAgICAgICAgICAgICAgY29uc3QgdGVtcGxhdGVNYW5hZ2VyID0gdGhpcy5fcnVudGltZS5HZXRUZW1wbGF0ZU1hbmFnZXIoKTsKICAgICAgICAgICAgICAgIGlmIChpc1JlcGxpY2EgJiYgdGVtcGxhdGVNYW5hZ2VyKSB0ZW1wbGF0ZU1hbmFnZXIuTWFwSW5zdGFuY2VUb1RlbXBsYXRlTmFtZSh0aGlzLkdldEluc3RhbmNlKCksIHNvdXJjZVRlbXBsYXRlTmFtZSk7CiAgICAgICAgICAgICAgICBpZiAoaXNUZW1wbGF0ZSAmJgogICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlTWFuYWdlcikgdGVtcGxhdGVNYW5hZ2VyLk1hcEluc3RhbmNlVG9UZW1wbGF0ZU5hbWUodGhpcy5HZXRJbnN0YW5jZSgpLCB0ZW1wbGF0ZU5hbWUpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZW5hYmxlVXBkYXRlUmVuZGVyZXJTdGF0ZUdyb3VwID0gdHJ1ZTsKICAgICAgICAgICAgdGhpcy5fVXBkYXRlUmVuZGVyZXJTdGF0ZUdyb3VwKCkKICAgICAgICB9CiAgICAgICAgSW5pdE5vRGF0YSgpIHsKICAgICAgICAgICAgdGhpcy5feCA9IDA7CiAgICAgICAgICAgIHRoaXMuX3kgPSAwOwogICAgICAgICAgICB0aGlzLl96RWxldmF0aW9uID0gMDsKICAgICAgICAgICAgdGhpcy5fdyA9IDA7CiAgICAgICAgICAgIHRoaXMuX2ggPSAwOwogICAgICAgICAgICB0aGlzLl9kZXB0aCA9IDA7CiAgICAgICAgICAgIHRoaXMuX2EgPSAwOwogICAgICAgICAgICB0aGlzLl9zaW5BID0gMDsKICAgICAgICAgICAgdGhpcy5fY29zQSA9IDE7CiAgICAgICAgICAgIHRoaXMuX294ID0gMDsKICAgICAgICAgICAgdGhpcy5fb3kgPSAwOwogICAgICAgICAgICB0aGlzLl9VcGRhdGVSZW5kZXJlclN0YXRlR3JvdXAoKQogICAgICAgIH0KICAgICAgICBHZXRSdW50aW1lKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fcnVudGltZQogICAgICAgIH0KICAgICAgICBHZXRPYmplY3RDbGFzcygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX29iamVjdENsYXNzCiAgICAgICAgfQogICAgICAgIEdldEluc3RhbmNlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faW5zdAogICAgICAgIH0KICAgICAgICBfR2V0UGFyZW50T2Zmc2V0QW5nbGUoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLkdldFRyYW5zZm9ybVdpdGhQYXJlbnRBbmdsZSgpKSByZXR1cm4gdGhpcy5fTWF5YmVSZWZsZWN0QW5nbGVGb3JNaXJyb3JGbGlwKHRoaXMuR2V0UGFyZW50KCkuX0dldEFuZ2xlTm9SZWZsZWN0KCkgLQogICAgICAgICAgICAgICAgdGhpcy5fc2NlbmVHcmFwaEluZm8uR2V0UGFyZW50U3RhcnRBbmdsZSgpKTsKICAgICAgICAgICAgcmV0dXJuIDAKICAgICAgICB9CiAgICAgICAgU2V0WCh4KSB7CiAgICAgICAgICAgIHggPSAreDsKICAgICAgICAgICAgaWYgKHRoaXMuR2V0VHJhbnNmb3JtV2l0aFBhcmVudFgoKSkgewogICAgICAgICAgICAgICAgY29uc3Qgc2dpID0gdGhpcy5fc2NlbmVHcmFwaEluZm87CiAgICAgICAgICAgICAgICBjb25zdCBkeCA9IHggLSB0aGlzLkdldFgoKTsKICAgICAgICAgICAgICAgIGNvbnN0IGRhID0gLXRoaXMuX0dldFBhcmVudE9mZnNldEFuZ2xlKCk7CiAgICAgICAgICAgICAgICBpZiAoZGEgPT09IDApIHRoaXMuX3ggKz0gZHggLyBzZ2kuR2V0UGFyZW50U2NhbGVYKCk7CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl94ICs9IE1hdGguY29zKGRhKSAqIGR4IC8gc2dpLkdldFBhcmVudFNjYWxlWCgpOwogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLkdldFRyYW5zZm9ybVdpdGhQYXJlbnRZKCkpIHRoaXMuX3kgKz0gTWF0aC5zaW4oZGEpICogZHggLyBzZ2kuR2V0UGFyZW50U2NhbGVZKCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHRoaXMuX3ggPSB4CiAgICAgICAgfQogICAgICAgIE9mZnNldFgoeCwgdHJhbnNmb3JtV2l0aFNjZW5lR3JhcGggPSBmYWxzZSkgewogICAgICAgICAgICB4ID0gK3g7CiAgICAgICAgICAgIGlmICh0cmFuc2Zvcm1XaXRoU2NlbmVHcmFwaCkgdGhpcy5feCArPSB4OwogICAgICAgICAgICBlbHNlIGlmICh0aGlzLkdldFRyYW5zZm9ybVdpdGhQYXJlbnRYKCkpIHRoaXMuU2V0WCh0aGlzLkdldFgoKSArCiAgICAgICAgICAgICAgICB4KTsKICAgICAgICAgICAgZWxzZSB0aGlzLl94ICs9IHgKICAgICAgICB9CiAgICAgICAgR2V0WCgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuR2V0VHJhbnNmb3JtV2l0aFBhcmVudFgoKSkgewogICAgICAgICAgICAgICAgbGV0IHggPSB0aGlzLl94OwogICAgICAgICAgICAgICAgY29uc3Qgc2dpID0gdGhpcy5fc2NlbmVHcmFwaEluZm87CiAgICAgICAgICAgICAgICBjb25zdCBwYXJlbnQgPSB0aGlzLkdldFBhcmVudCgpOwogICAgICAgICAgICAgICAgY29uc3QgZGEgPSB0aGlzLl9HZXRQYXJlbnRPZmZzZXRBbmdsZSgpOwogICAgICAgICAgICAgICAgaWYgKGRhID09PSAwKSB4ICo9IHNnaS5HZXRQYXJlbnRTY2FsZVgoKTsKICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIHggPSB4ICogc2dpLkdldFBhcmVudFNjYWxlWCgpICogTWF0aC5jb3MoZGEpOwogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLkdldFRyYW5zZm9ybVdpdGhQYXJlbnRZKCkpIHggLT0gdGhpcy5feSAqIHNnaS5HZXRQYXJlbnRTY2FsZVkoKSAqIE1hdGguc2luKGRhKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHBhcmVudC5HZXRYKCkgKyB4CiAgICAgICAgICAgIH0gZWxzZSByZXR1cm4gdGhpcy5feAogICAgICAgIH0KICAgICAgICBTZXRZKHkpIHsKICAgICAgICAgICAgeSA9ICt5OwogICAgICAgICAgICBpZiAodGhpcy5HZXRUcmFuc2Zvcm1XaXRoUGFyZW50WSgpKSB7CiAgICAgICAgICAgICAgICBjb25zdCBzZ2kgPSB0aGlzLl9zY2VuZUdyYXBoSW5mbzsKICAgICAgICAgICAgICAgIGNvbnN0IGR5ID0geSAtIHRoaXMuR2V0WSgpOwogICAgICAgICAgICAgICAgY29uc3QgZGEgPSAtdGhpcy5fR2V0UGFyZW50T2Zmc2V0QW5nbGUoKTsKICAgICAgICAgICAgICAgIGlmIChkYSA9PT0gMCkgdGhpcy5feSArPSBkeSAvIHNnaS5HZXRQYXJlbnRTY2FsZVkoKTsKICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLkdldFRyYW5zZm9ybVdpdGhQYXJlbnRYKCkpIHRoaXMuX3ggLT0gTWF0aC5zaW4oZGEpICogZHkgLyBzZ2kuR2V0UGFyZW50U2NhbGVYKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5feSArPSBNYXRoLmNvcyhkYSkgKiBkeSAvIHNnaS5HZXRQYXJlbnRTY2FsZVkoKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgdGhpcy5feSA9IHkKICAgICAgICB9CiAgICAgICAgT2Zmc2V0WSh5LCB0cmFuc2Zvcm1XaXRoU2NlbmVHcmFwaCA9IGZhbHNlKSB7CiAgICAgICAgICAgIHkgPSAreTsKICAgICAgICAgICAgaWYgKHRyYW5zZm9ybVdpdGhTY2VuZUdyYXBoKSB0aGlzLl95ICs9IHk7CiAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuR2V0VHJhbnNmb3JtV2l0aFBhcmVudFkoKSkgdGhpcy5TZXRZKHRoaXMuR2V0WSgpICsgeSk7CiAgICAgICAgICAgIGVsc2UgdGhpcy5feSArPSB5CiAgICAgICAgfQogICAgICAgIEdldFkoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLkdldFRyYW5zZm9ybVdpdGhQYXJlbnRZKCkpIHsKICAgICAgICAgICAgICAgIGxldCB5ID0gdGhpcy5feTsKICAgICAgICAgICAgICAgIGNvbnN0IHNnaSA9IHRoaXMuX3NjZW5lR3JhcGhJbmZvOwogICAgICAgICAgICAgICAgY29uc3QgcGFyZW50ID0gdGhpcy5HZXRQYXJlbnQoKTsKICAgICAgICAgICAgICAgIGNvbnN0IGRhID0gdGhpcy5fR2V0UGFyZW50T2Zmc2V0QW5nbGUoKTsKICAgICAgICAgICAgICAgIGlmIChkYSA9PT0gMCkgeSAqPSBzZ2kuR2V0UGFyZW50U2NhbGVZKCk7CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB5ID0geSAqIHNnaS5HZXRQYXJlbnRTY2FsZVkoKSAqIE1hdGguY29zKGRhKTsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5HZXRUcmFuc2Zvcm1XaXRoUGFyZW50WCgpKSB5ICs9IHRoaXMuX3ggKiBzZ2kuR2V0UGFyZW50U2NhbGVYKCkgKiBNYXRoLnNpbihkYSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBwYXJlbnQuR2V0WSgpICsgeQogICAgICAgICAgICB9IGVsc2UgcmV0dXJuIHRoaXMuX3kKICAgICAgICB9CiAgICAgICAgU2V0WFkoeCwgeSkgewogICAgICAgICAgICB4ID0gK3g7CiAgICAgICAgICAgIHkgPSAreTsKICAgICAgICAgICAgaWYgKHRoaXMuR2V0VHJhbnNmb3JtV2l0aFBhcmVudFhPclkoKSkgewogICAgICAgICAgICAgICAgY29uc3QgaXNUcmFuc2Zvcm1YID0gdGhpcy5HZXRUcmFuc2Zvcm1XaXRoUGFyZW50WCgpOwogICAgICAgICAgICAgICAgY29uc3QgaXNUcmFuc2Zvcm1ZID0gdGhpcy5HZXRUcmFuc2Zvcm1XaXRoUGFyZW50WSgpOwogICAgICAgICAgICAgICAgY29uc3Qgc2dpID0gdGhpcy5fc2NlbmVHcmFwaEluZm87CiAgICAgICAgICAgICAgICBjb25zdCBkeCA9IHggLSB0aGlzLkdldFgoKTsKICAgICAgICAgICAgICAgIGNvbnN0IGR5ID0geSAtIHRoaXMuR2V0WSgpOwogICAgICAgICAgICAgICAgY29uc3QgZGEgPSAtdGhpcy5fR2V0UGFyZW50T2Zmc2V0QW5nbGUoKTsKICAgICAgICAgICAgICAgIGlmIChkYSA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgIGlmIChpc1RyYW5zZm9ybVgpIHRoaXMuX3ggKz0KICAgICAgICAgICAgICAgICAgICAgICAgZHggLyBzZ2kuR2V0UGFyZW50U2NhbGVYKCk7CiAgICAgICAgICAgICAgICAgICAgZWxzZSB0aGlzLl94ID0geDsKICAgICAgICAgICAgICAgICAgICBpZiAoaXNUcmFuc2Zvcm1ZKSB0aGlzLl95ICs9IGR5IC8gc2dpLkdldFBhcmVudFNjYWxlWSgpOwogICAgICAgICAgICAgICAgICAgIGVsc2UgdGhpcy5feSA9IHkKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2luRGEgPSBNYXRoLnNpbihkYSk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29zRGEgPSBNYXRoLmNvcyhkYSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzVHJhbnNmb3JtWCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzVHJhbnNmb3JtWSkgdGhpcy5feCArPSAoY29zRGEgKiBkeCAtIHNpbkRhICogZHkpIC8gc2dpLkdldFBhcmVudFNjYWxlWCgpOwogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHRoaXMuX3ggKz0gY29zRGEgKiBkeCAvIHNnaS5HZXRQYXJlbnRTY2FsZVgoKTsKICAgICAgICAgICAgICAgICAgICBlbHNlIHRoaXMuX3ggPSB4OwogICAgICAgICAgICAgICAgICAgIGlmIChpc1RyYW5zZm9ybVkpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc1RyYW5zZm9ybVgpIHRoaXMuX3kgKz0gKHNpbkRhICogZHggKyBjb3NEYSAqIGR5KSAvIHNnaS5HZXRQYXJlbnRTY2FsZVkoKTsKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB0aGlzLl95ICs9IGNvc0RhICogZHkgLyBzZ2kuR2V0UGFyZW50U2NhbGVZKCk7CiAgICAgICAgICAgICAgICAgICAgZWxzZSB0aGlzLl95ID0geQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5feCA9IHg7CiAgICAgICAgICAgICAgICB0aGlzLl95ID0geQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIE9mZnNldFhZKHgsIHkpIHsKICAgICAgICAgICAgeCA9ICt4OwogICAgICAgICAgICB5ID0gK3k7CiAgICAgICAgICAgIGlmICh0aGlzLkdldFRyYW5zZm9ybVdpdGhQYXJlbnRYT3JZKCkpIHRoaXMuU2V0WFkodGhpcy5HZXRYKCkgKwogICAgICAgICAgICAgICAgeCwgdGhpcy5HZXRZKCkgKyB5KTsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLl94ICs9IHg7CiAgICAgICAgICAgICAgICB0aGlzLl95ICs9IHkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBFcXVhbHNYWSh4LCB5KSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLkdldFgoKSA9PT0geCAmJiB0aGlzLkdldFkoKSA9PT0geQogICAgICAgIH0KICAgICAgICBTZXRaRWxldmF0aW9uKHopIHsKICAgICAgICAgICAgeiA9ICt6OwogICAgICAgICAgICBpZiAodGhpcy5HZXRUcmFuc2Zvcm1XaXRoUGFyZW50WkVsZXZhdGlvbigpKSB6IC09IHRoaXMuR2V0UGFyZW50KCkuR2V0WkVsZXZhdGlvbigpOwogICAgICAgICAgICBpZiAodGhpcy5fekVsZXZhdGlvbiA9PT0geikgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl96RWxldmF0aW9uID0gejsKICAgICAgICAgICAgdGhpcy5fVXBkYXRlWkVsZXZhdGlvbigpOwogICAgICAgICAgICBjb25zdCBsYXllciA9IHRoaXMuR2V0TGF5ZXIoKTsKICAgICAgICAgICAgaWYgKHRoaXMuX3pFbGV2YXRpb24gIT09IDApIGxheWVyLl9TZXRBbnlJbnN0YW5jZVpFbGV2YXRlZCgpOwogICAgICAgICAgICBsYXllci5TZXRaSW5kaWNlc0NoYW5nZWQoKQogICAgICAgIH0KICAgICAgICBfVXBkYXRlWkVsZXZhdGlvbigpIHsKICAgICAgICAgICAgdGhpcy5fVXBkYXRlUmVuZGVyZXJTdGF0ZUdyb3VwKCk7CiAgICAgICAgICAgIGlmICh0aGlzLkhhc0NoaWxkcmVuKCkpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGNoaWxkcmVuID0gdGhpcy5HZXRDaGlsZHJlbigpOwogICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9CiAgICAgICAgICAgICAgICAgICAgICAgIDAsIGxlbiA9IGNoaWxkcmVuLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgY2hpbGQgPSBjaGlsZHJlbltpXTsKICAgICAgICAgICAgICAgICAgICBpZiAoY2hpbGQuR2V0VHJhbnNmb3JtV2l0aFBhcmVudFpFbGV2YXRpb24oKSkgY2hpbGQuX1VwZGF0ZVpFbGV2YXRpb24oKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIE9mZnNldFpFbGV2YXRpb24oeikgewogICAgICAgICAgICB0aGlzLlNldFpFbGV2YXRpb24odGhpcy5HZXRaRWxldmF0aW9uKCkgKyB6KQogICAgICAgIH0KICAgICAgICBHZXRaRWxldmF0aW9uKCkgewogICAgICAgICAgICBpZiAodGhpcy5HZXRUcmFuc2Zvcm1XaXRoUGFyZW50WkVsZXZhdGlvbigpKSByZXR1cm4gdGhpcy5HZXRQYXJlbnQoKS5HZXRaRWxldmF0aW9uKCkgKyB0aGlzLl96RWxldmF0aW9uOwogICAgICAgICAgICBlbHNlIHJldHVybiB0aGlzLl96RWxldmF0aW9uCiAgICAgICAgfQogICAgICAgIEdldFRvdGFsWkVsZXZhdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuR2V0TGF5ZXIoKS5HZXRaRWxldmF0aW9uKCkgKyB0aGlzLkdldFpFbGV2YXRpb24oKQogICAgICAgIH0KICAgICAgICBTZXRXaWR0aCh3KSB7CiAgICAgICAgICAgIHcgPSArdzsKICAgICAgICAgICAgaWYgKHRoaXMuR2V0VHJhbnNmb3JtV2l0aFBhcmVudFdpZHRoKCkpIHsKICAgICAgICAgICAgICAgIGNvbnN0IG93bldpZHRoID0gdGhpcy5HZXRXaWR0aCgpOwogICAgICAgICAgICAgICAgaWYgKG93bldpZHRoID09PSAwKSB0aGlzLl93ID0gTnVtYmVyLkVQU0lMT047CiAgICAgICAgICAgICAgICBlbHNlIHRoaXMuX3cgKj0gdyAvIG93bldpZHRoCiAgICAgICAgICAgIH0gZWxzZSB0aGlzLl93ID0gdzsKICAgICAgICAgICAgdGhpcy5fTWFya1NpbkNvc0FuZ2xlQ2hhbmdlZCgpCiAgICAgICAgfQogICAgICAgIE9mZnNldFdpZHRoKHcsIHRyYW5zZm9ybVdpdGhTY2VuZUdyYXBoKSB7CiAgICAgICAgICAgIHcgPSArdzsKICAgICAgICAgICAgaWYgKHRyYW5zZm9ybVdpdGhTY2VuZUdyYXBoKSB0aGlzLl93ICs9IHc7CiAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuR2V0VHJhbnNmb3JtV2l0aFBhcmVudFdpZHRoKCkpIHRoaXMuU2V0V2lkdGgodGhpcy5HZXRXaWR0aCgpICsgdyk7CiAgICAgICAgICAgIGVsc2UgdGhpcy5fdyArPSB3OwogICAgICAgICAgICB0aGlzLl9NYXJrU2luQ29zQW5nbGVDaGFuZ2VkKCkKICAgICAgICB9CiAgICAgICAgR2V0V2lkdGgoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLkdldFRyYW5zZm9ybVdpdGhQYXJlbnRXaWR0aCgpKSB7CiAgICAgICAgICAgICAgICBjb25zdCBwYXJlbnQgPSB0aGlzLkdldFBhcmVudCgpOwogICAgICAgICAgICAgICAgY29uc3QgcHcgPSBwYXJlbnQuR2V0V2lkdGgoKTsKICAgICAgICAgICAgICAgIGNvbnN0IHBzdyA9IHBhcmVudC5fR2V0U2NlbmVHcmFwaEluZm8oKS5fR2V0U3RhcnRXaWR0aCgpOwogICAgICAgICAgICAgICAgaWYgKHBzdyA9PT0gTnVtYmVyLkVQU0lMT04pIHJldHVybiAodGhpcy5fR2V0U2NlbmVHcmFwaEluZm8oKS5fR2V0U3RhcnRXaWR0aCgpICsKICAgICAgICAgICAgICAgICAgICBwdykgKiB0aGlzLl93OwogICAgICAgICAgICAgICAgcmV0dXJuIHB3ICogdGhpcy5fdwogICAgICAgICAgICB9IGVsc2UgcmV0dXJuIHRoaXMuX3cKICAgICAgICB9CiAgICAgICAgU2V0SGVpZ2h0KGgpIHsKICAgICAgICAgICAgaCA9ICtoOwogICAgICAgICAgICBpZiAodGhpcy5HZXRUcmFuc2Zvcm1XaXRoUGFyZW50SGVpZ2h0KCkpIHsKICAgICAgICAgICAgICAgIGNvbnN0IG93bkhlaWdodCA9IHRoaXMuR2V0SGVpZ2h0KCk7CiAgICAgICAgICAgICAgICBpZiAob3duSGVpZ2h0ID09PSAwKSB0aGlzLl9oID0gTnVtYmVyLkVQU0lMT047CiAgICAgICAgICAgICAgICBlbHNlIHRoaXMuX2ggKj0gaCAvIG93bkhlaWdodAogICAgICAgICAgICB9IGVsc2UgdGhpcy5faCA9IGg7CiAgICAgICAgICAgIHRoaXMuX01hcmtTaW5Db3NBbmdsZUNoYW5nZWQoKQogICAgICAgIH0KICAgICAgICBPZmZzZXRIZWlnaHQoaCwgdHJhbnNmb3JtV2l0aFNjZW5lR3JhcGgpIHsKICAgICAgICAgICAgaCA9ICtoOwogICAgICAgICAgICBpZiAodHJhbnNmb3JtV2l0aFNjZW5lR3JhcGgpIHRoaXMuX2ggKz0gaDsKICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5HZXRUcmFuc2Zvcm1XaXRoUGFyZW50SGVpZ2h0KCkpIHRoaXMuU2V0SGVpZ2h0KHRoaXMuR2V0SGVpZ2h0KCkgKyBoKTsKICAgICAgICAgICAgZWxzZSB0aGlzLl9oICs9IGg7CiAgICAgICAgICAgIHRoaXMuX01hcmtTaW5Db3NBbmdsZUNoYW5nZWQoKQogICAgICAgIH0KICAgICAgICBHZXRIZWlnaHQoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLkdldFRyYW5zZm9ybVdpdGhQYXJlbnRIZWlnaHQoKSkgewogICAgICAgICAgICAgICAgY29uc3QgcGFyZW50ID0KICAgICAgICAgICAgICAgICAgICB0aGlzLkdldFBhcmVudCgpOwogICAgICAgICAgICAgICAgY29uc3QgcGggPSBwYXJlbnQuR2V0SGVpZ2h0KCk7CiAgICAgICAgICAgICAgICBjb25zdCBwc2ggPSBwYXJlbnQuX0dldFNjZW5lR3JhcGhJbmZvKCkuX0dldFN0YXJ0SGVpZ2h0KCk7CiAgICAgICAgICAgICAgICBpZiAocHNoID09PSBOdW1iZXIuRVBTSUxPTikgcmV0dXJuICh0aGlzLl9HZXRTY2VuZUdyYXBoSW5mbygpLl9HZXRTdGFydEhlaWdodCgpICsgcGgpICogdGhpcy5faDsKICAgICAgICAgICAgICAgIHJldHVybiBwaCAqIHRoaXMuX2gKICAgICAgICAgICAgfSBlbHNlIHJldHVybiB0aGlzLl9oCiAgICAgICAgfQogICAgICAgIFNldFNpemUodywgaCkgewogICAgICAgICAgICB3ID0gK3c7CiAgICAgICAgICAgIGggPSAraDsKICAgICAgICAgICAgaWYgKHRoaXMuR2V0VHJhbnNmb3JtV2l0aFBhcmVudFdpZHRoKCkpIHsKICAgICAgICAgICAgICAgIGNvbnN0IG93bldpZHRoID0gdGhpcy5HZXRXaWR0aCgpOwogICAgICAgICAgICAgICAgaWYgKG93bldpZHRoID09PSAwKSB0aGlzLl93ID0gTnVtYmVyLkVQU0lMT047CiAgICAgICAgICAgICAgICBlbHNlIHRoaXMuX3cgKj0gdyAvIG93bldpZHRoCiAgICAgICAgICAgIH0gZWxzZSB0aGlzLl93ID0gdzsKICAgICAgICAgICAgaWYgKHRoaXMuR2V0VHJhbnNmb3JtV2l0aFBhcmVudEhlaWdodCgpKSB7CiAgICAgICAgICAgICAgICBjb25zdCBvd25IZWlnaHQgPSB0aGlzLkdldEhlaWdodCgpOwogICAgICAgICAgICAgICAgaWYgKG93bkhlaWdodCA9PT0gMCkgdGhpcy5faCA9IE51bWJlci5FUFNJTE9OOwogICAgICAgICAgICAgICAgZWxzZSB0aGlzLl9oICo9IGggLyBvd25IZWlnaHQKICAgICAgICAgICAgfSBlbHNlIHRoaXMuX2ggPSBoOwogICAgICAgICAgICB0aGlzLl9NYXJrU2luQ29zQW5nbGVDaGFuZ2VkKCkKICAgICAgICB9CiAgICAgICAgR2V0RGVwdGgoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9kZXB0aAogICAgICAgIH0KICAgICAgICBTZXREZXB0aChkKSB7CiAgICAgICAgICAgIGlmIChkIDwgMCkgdGhyb3cgbmV3IFJhbmdlRXJyb3IoImludmFsaWQgZGVwdGgiKTsKICAgICAgICAgICAgdGhpcy5fZGVwdGggPSBkCiAgICAgICAgfQogICAgICAgIEdldFNjZW5lR3JhcGhTY2FsZSgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuSGFzUGFyZW50KCkpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHNnaSA9IHRoaXMuX3NjZW5lR3JhcGhJbmZvOwogICAgICAgICAgICAgICAgcmV0dXJuIE1hdGgubWluKHNnaS5HZXRQYXJlbnRTY2FsZVgoKSwgc2dpLkdldFBhcmVudFNjYWxlWSgpKQogICAgICAgICAgICB9IGVsc2UgcmV0dXJuIDEKICAgICAgICB9CiAgICAgICAgSXNSb3RhdGFibGUoKSB7CiAgICAgICAgICAgIHJldHVybiAodGhpcy5fZmxhZ3MgJiBGTEFHX0lTX1JPVEFUQUJMRSkgIT09IDAKICAgICAgICB9CiAgICAgICAgU2V0QW5nbGUoYSkgewogICAgICAgICAgICBhID0gK2E7CiAgICAgICAgICAgIGlmICghdGhpcy5Jc1JvdGF0YWJsZSgpKSByZXR1cm47CiAgICAgICAgICAgIGlmICh0aGlzLkdldFRyYW5zZm9ybVdpdGhQYXJlbnRBbmdsZSgpKSBhIC09IHRoaXMuR2V0UGFyZW50KCkuR2V0QW5nbGUoKTsKICAgICAgICAgICAgYSA9IEMzLmNsYW1wQW5nbGUoYSk7CiAgICAgICAgICAgIGlmICh0aGlzLl9hID09PSBhKSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuX2EgPSBhOwogICAgICAgICAgICB0aGlzLl9NYXJrU2luQ29zQW5nbGVDaGFuZ2VkKCkKICAgICAgICB9CiAgICAgICAgT2Zmc2V0QW5nbGUoYSkgewogICAgICAgICAgICBhID0gK2E7CiAgICAgICAgICAgIGlmIChhID09PSAwIHx8ICF0aGlzLklzUm90YXRhYmxlKCkpIHJldHVybjsKICAgICAgICAgICAgdGhpcy5fYSA9IEMzLmNsYW1wQW5nbGUodGhpcy5fYSArIGEpOwogICAgICAgICAgICB0aGlzLl9NYXJrU2luQ29zQW5nbGVDaGFuZ2VkKCkKICAgICAgICB9CiAgICAgICAgX01hcmtTaW5Db3NBbmdsZUNoYW5nZWQoKSB7CiAgICAgICAgICAgIHRoaXMuX2ZsYWdzIHw9IEZMQUdfU0lOX0NPU19BTkdMRV9DSEFOR0VEOwogICAgICAgICAgICBpZiAodGhpcy5IYXNDaGlsZHJlbigpKSB7CiAgICAgICAgICAgICAgICBjb25zdCBjaGlsZHJlbiA9IHRoaXMuR2V0Q2hpbGRyZW4oKTsKICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBjaGlsZHJlbi5sZW5ndGg7IGkgPCBsZW47IGkrKykgY2hpbGRyZW5baV0uX01hcmtTaW5Db3NBbmdsZUNoYW5nZWQoKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIEdldEFuZ2xlKCkgewogICAgICAgICAgICBpZiAodGhpcy5HZXRUcmFuc2Zvcm1XaXRoUGFyZW50QW5nbGUoKSAmJiB0aGlzLklzUm90YXRhYmxlKCkpIHJldHVybiB0aGlzLl9NYXliZVJlZmxlY3RBbmdsZUZvck1pcnJvckZsaXAoQzMuY2xhbXBBbmdsZSh0aGlzLkdldFBhcmVudCgpLl9HZXRBbmdsZU5vUmVmbGVjdCgpICsKICAgICAgICAgICAgICAgIHRoaXMuX2EpKTsKICAgICAgICAgICAgZWxzZSByZXR1cm4gdGhpcy5fYQogICAgICAgIH0KICAgICAgICBfR2V0QW5nbGVOb1JlZmxlY3QoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLkdldFRyYW5zZm9ybVdpdGhQYXJlbnRBbmdsZSgpICYmIHRoaXMuSXNSb3RhdGFibGUoKSkgcmV0dXJuIEMzLmNsYW1wQW5nbGUodGhpcy5HZXRQYXJlbnQoKS5fR2V0QW5nbGVOb1JlZmxlY3QoKSArIHRoaXMuX2EpOwogICAgICAgICAgICBlbHNlIHJldHVybiB0aGlzLl9hCiAgICAgICAgfQogICAgICAgIF9NYXliZVJlZmxlY3RBbmdsZUZvck1pcnJvckZsaXAoYSkgewogICAgICAgICAgICBpZiAodGhpcy5HZXRUcmFuc2Zvcm1XaXRoUGFyZW50V2lkdGgoKSAmJiB0aGlzLkdldFRvcFBhcmVudCgpLkdldFdpZHRoKCkgPCAwKSBhID0gQzMuY2xhbXBBbmdsZShDMy5hbmdsZVJlZmxlY3QoYSwgdGhpcy5HZXRUb3BQYXJlbnQoKS5HZXRBbmdsZSgpICsgTWF0aC5QSSkpOwogICAgICAgICAgICBpZiAodGhpcy5HZXRUcmFuc2Zvcm1XaXRoUGFyZW50SGVpZ2h0KCkgJiYgdGhpcy5HZXRUb3BQYXJlbnQoKS5HZXRIZWlnaHQoKSA8IDApIGEgPSBDMy5hbmdsZVJlZmxlY3QoYSwgdGhpcy5HZXRUb3BQYXJlbnQoKS5HZXRBbmdsZSgpKTsKICAgICAgICAgICAgcmV0dXJuIGEKICAgICAgICB9CiAgICAgICAgX01heWJlVXBkYXRlU2luQ29zQW5nbGUoKSB7CiAgICAgICAgICAgIGNvbnN0IGZsYWdzID0gdGhpcy5fZmxhZ3M7CiAgICAgICAgICAgIGlmICgoZmxhZ3MgJiBGTEFHX1NJTl9DT1NfQU5HTEVfQ0hBTkdFRCkgPT09IDApIHJldHVybjsKICAgICAgICAgICAgY29uc3QgYSA9IHRoaXMuR2V0QW5nbGUoKTsKICAgICAgICAgICAgdGhpcy5fc2luQSA9IE1hdGguc2luKGEpOwogICAgICAgICAgICB0aGlzLl9jb3NBID0gTWF0aC5jb3MoYSk7CiAgICAgICAgICAgIHRoaXMuX2ZsYWdzID0gZmxhZ3MgJiB+RkxBR19TSU5fQ09TX0FOR0xFX0NIQU5HRUQKICAgICAgICB9CiAgICAgICAgR2V0U2luQW5nbGUoKSB7CiAgICAgICAgICAgIHRoaXMuX01heWJlVXBkYXRlU2luQ29zQW5nbGUoKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NpbkEKICAgICAgICB9CiAgICAgICAgR2V0Q29zQW5nbGUoKSB7CiAgICAgICAgICAgIHRoaXMuX01heWJlVXBkYXRlU2luQ29zQW5nbGUoKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2Nvc0EKICAgICAgICB9CiAgICAgICAgU2V0T3JpZ2luWCh4KSB7CiAgICAgICAgICAgIHRoaXMuX294ID0gK3gKICAgICAgICB9CiAgICAgICAgT2Zmc2V0T3JpZ2luWCh4KSB7CiAgICAgICAgICAgIHRoaXMuX294ICs9ICt4CiAgICAgICAgfQogICAgICAgIEdldE9yaWdpblgoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9veAogICAgICAgIH0KICAgICAgICBTZXRPcmlnaW5ZKHkpIHsKICAgICAgICAgICAgdGhpcy5fb3kgPSAreQogICAgICAgIH0KICAgICAgICBPZmZzZXRPcmlnaW5ZKHkpIHsKICAgICAgICAgICAgdGhpcy5fb3kgKz0gK3kKICAgICAgICB9CiAgICAgICAgR2V0T3JpZ2luWSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX295CiAgICAgICAgfQogICAgICAgIF9TZXRDb2xvcihjKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9jb2xvci5lcXVhbHMoYykpIHJldHVybjsKICAgICAgICAgICAgaWYgKHRoaXMuX2NvbG9yID09PSBERUZBVUxUX0NPTE9SKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9jb2xvciA9IEMzLk5ldyhDMy5Db2xvciwgYyk7CiAgICAgICAgICAgICAgICB0aGlzLl9jb2xvclByZW11bHRpcGxpZWQgPSBDMy5OZXcoQzMuQ29sb3IsIGMpOwogICAgICAgICAgICAgICAgdGhpcy5fY29sb3JQcmVtdWx0aXBsaWVkLnByZW11bHRpcGx5KCkKICAgICAgICAgICAgfSBlbHNlIGlmIChjLmVxdWFsc1JnYmEoMSwgMSwgMSwgMSkpIHsKICAgICAgICAgICAgICAgIHRoaXMuX2NvbG9yID0gREVGQVVMVF9DT0xPUjsKICAgICAgICAgICAgICAgIHRoaXMuX2NvbG9yUHJlbXVsdGlwbGllZCA9IERFRkFVTFRfQ09MT1IKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuX2NvbG9yLnNldChjKTsKICAgICAgICAgICAgICAgIHRoaXMuX2NvbG9yUHJlbXVsdGlwbGllZC5zZXQoYyk7CiAgICAgICAgICAgICAgICB0aGlzLl9jb2xvclByZW11bHRpcGxpZWQucHJlbXVsdGlwbHkoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuX1VwZGF0ZVJlbmRlcmVyU3RhdGVHcm91cCgpCiAgICAgICAgfQogICAgICAgIFNldE9wYWNpdHkobykgewogICAgICAgICAgICBvID0gQzMuY2xhbXAoK28sIDAsIDEpOwogICAgICAgICAgICBpZiAodGhpcy5HZXRUcmFuc2Zvcm1XaXRoUGFyZW50T3BhY2l0eSgpKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fR2V0U2NlbmVHcmFwaEluZm8oKS5HZXRPd25PcGFjaXR5KCkgPT09IG8pIHJldHVybjsKICAgICAgICAgICAgICAgIHRoaXMuX0dldFNjZW5lR3JhcGhJbmZvKCkuU2V0T3duT3BhY2l0eShvKTsKICAgICAgICAgICAgICAgIG8gPSB0aGlzLkdldE9wYWNpdHkoKQogICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuX2NvbG9yLmEgPT09IG8pIHJldHVybjsKICAgICAgICAgICAgdGhpcy5fU2V0Q29sb3JXaXRoT3BhY2l0eShvKQogICAgICAgIH0KICAgICAgICBfU2V0T3BhY2l0eU9mQ2hpbGRyZW4oKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5IYXNDaGlsZHJlbigpKSByZXR1cm47CiAgICAgICAgICAgIGNvbnN0IGNoaWxkcmVuID0gdGhpcy5HZXRDaGlsZHJlbigpOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gY2hpbGRyZW4ubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgICAgICAgIGNvbnN0IGNoaWxkID0gY2hpbGRyZW5baV07CiAgICAgICAgICAgICAgICBjaGlsZC5fU2V0Q29sb3JXaXRoT3BhY2l0eShjaGlsZC5HZXRPcGFjaXR5KCkpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgX1NldENvbG9yV2l0aE9wYWNpdHkobykgewogICAgICAgICAgICB0ZW1wQ29sb3IuY29weVJnYih0aGlzLl9jb2xvcik7CiAgICAgICAgICAgIHRlbXBDb2xvci5hID0gbzsKICAgICAgICAgICAgdGhpcy5fU2V0Q29sb3IodGVtcENvbG9yKTsKICAgICAgICAgICAgdGhpcy5fU2V0T3BhY2l0eU9mQ2hpbGRyZW4oKQogICAgICAgIH0KICAgICAgICBPZmZzZXRPcGFjaXR5KG8pIHsKICAgICAgICAgICAgaWYgKHRoaXMuR2V0VHJhbnNmb3JtV2l0aFBhcmVudE9wYWNpdHkoKSkgdGhpcy5TZXRPcGFjaXR5KHRoaXMuX0dldFNjZW5lR3JhcGhJbmZvKCkuR2V0T3duT3BhY2l0eSgpICsKICAgICAgICAgICAgICAgIG8pOwogICAgICAgICAgICBlbHNlIHRoaXMuU2V0T3BhY2l0eSh0aGlzLkdldE9wYWNpdHkoKSArIG8pCiAgICAgICAgfQogICAgICAgIEdldE9wYWNpdHkoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLkdldFRyYW5zZm9ybVdpdGhQYXJlbnRPcGFjaXR5KCkpIHJldHVybiB0aGlzLkdldFBhcmVudCgpLkdldE9wYWNpdHkoKSAqIHRoaXMuX0dldFNjZW5lR3JhcGhJbmZvKCkuR2V0T3duT3BhY2l0eSgpOwogICAgICAgICAgICBlbHNlIHJldHVybiB0aGlzLl9jb2xvci5hCiAgICAgICAgfQogICAgICAgIFNldFVucHJlbXVsdGlwbGllZENvbG9yKGMpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX2NvbG9yLmVxdWFsc0lnbm9yaW5nQWxwaGEoYykpIHJldHVybjsKICAgICAgICAgICAgdGVtcENvbG9yLmNvcHlSZ2IoYyk7CiAgICAgICAgICAgIHRlbXBDb2xvci5hID0gdGhpcy5HZXRPcGFjaXR5KCk7CiAgICAgICAgICAgIHRoaXMuX1NldENvbG9yKHRlbXBDb2xvcikKICAgICAgICB9CiAgICAgICAgU2V0VW5wcmVtdWx0aXBsaWVkQ29sb3JSR0IociwgZywgYikgewogICAgICAgICAgICB0ZW1wQ29sb3Iuc2V0UmdiKHIsIGcsIGIpOwogICAgICAgICAgICB0aGlzLlNldFVucHJlbXVsdGlwbGllZENvbG9yKHRlbXBDb2xvcikKICAgICAgICB9CiAgICAgICAgT2Zmc2V0VW5wcmVtdWx0aXBsaWVkQ29sb3JSR0IociwgZywgYikgewogICAgICAgICAgICBpZiAociA9PT0gMCAmJiBnID09PQogICAgICAgICAgICAgICAgMCAmJiBiID09PSAwKSByZXR1cm47CiAgICAgICAgICAgIHRlbXBDb2xvci5jb3B5UmdiKHRoaXMuX2NvbG9yKTsKICAgICAgICAgICAgdGVtcENvbG9yLnIgKz0gcjsKICAgICAgICAgICAgdGVtcENvbG9yLmcgKz0gZzsKICAgICAgICAgICAgdGVtcENvbG9yLmIgKz0gYjsKICAgICAgICAgICAgdGhpcy5TZXRVbnByZW11bHRpcGxpZWRDb2xvcih0ZW1wQ29sb3IpCiAgICAgICAgfQogICAgICAgIEdldFVucHJlbXVsdGlwbGllZENvbG9yKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fY29sb3IKICAgICAgICB9CiAgICAgICAgR2V0UHJlbXVsdGlwbGllZENvbG9yKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fY29sb3JQcmVtdWx0aXBsaWVkCiAgICAgICAgfQogICAgICAgIEdldERlc3Ryb3lXaXRoUGFyZW50KCkgewogICAgICAgICAgICByZXR1cm4gKHRoaXMuX2ZsYWdzICYgRkxBR19ERVNUUk9ZX1dJVEhfUEFSRU5UKSAhPT0gMAogICAgICAgIH0KICAgICAgICBTZXREZXN0cm95V2l0aFBhcmVudChkKSB7CiAgICAgICAgICAgIHRoaXMuX1NldEZsYWcoRkxBR19ERVNUUk9ZX1dJVEhfUEFSRU5ULCBkKQogICAgICAgIH0KICAgICAgICBHZXRUcmFuc2Zvcm1XaXRoUGFyZW50WCgpIHsKICAgICAgICAgICAgcmV0dXJuICh0aGlzLl9mbGFncyAmIEZMQUdfVFJBTlNGT1JNX1dJVEhfUEFSRU5UX1gpICE9PSAwCiAgICAgICAgfQogICAgICAgIFNldFRyYW5zZm9ybVdpdGhQYXJlbnRYKHRweCkgewogICAgICAgICAgICB0aGlzLl9TZXRGbGFnKEZMQUdfVFJBTlNGT1JNX1dJVEhfUEFSRU5UX1gsCiAgICAgICAgICAgICAgICB0cHgpCiAgICAgICAgfQogICAgICAgIEdldFRyYW5zZm9ybVdpdGhQYXJlbnRZKCkgewogICAgICAgICAgICByZXR1cm4gKHRoaXMuX2ZsYWdzICYgRkxBR19UUkFOU0ZPUk1fV0lUSF9QQVJFTlRfWSkgIT09IDAKICAgICAgICB9CiAgICAgICAgR2V0VHJhbnNmb3JtV2l0aFBhcmVudFhPclkoKSB7CiAgICAgICAgICAgIHJldHVybiAodGhpcy5fZmxhZ3MgJiAoRkxBR19UUkFOU0ZPUk1fV0lUSF9QQVJFTlRfWCB8IEZMQUdfVFJBTlNGT1JNX1dJVEhfUEFSRU5UX1kpKSAhPT0gMAogICAgICAgIH0KICAgICAgICBTZXRUcmFuc2Zvcm1XaXRoUGFyZW50WSh0cHgpIHsKICAgICAgICAgICAgdGhpcy5fU2V0RmxhZyhGTEFHX1RSQU5TRk9STV9XSVRIX1BBUkVOVF9ZLCB0cHgpCiAgICAgICAgfQogICAgICAgIEdldFRyYW5zZm9ybVdpdGhQYXJlbnRXaWR0aCgpIHsKICAgICAgICAgICAgcmV0dXJuICh0aGlzLl9mbGFncyAmIEZMQUdfVFJBTlNGT1JNX1dJVEhfUEFSRU5UX1cpICE9PSAwCiAgICAgICAgfQogICAgICAgIFNldFRyYW5zZm9ybVdpdGhQYXJlbnRXaWR0aCh0cHcpIHsKICAgICAgICAgICAgdGhpcy5fU2V0RmxhZyhGTEFHX1RSQU5TRk9STV9XSVRIX1BBUkVOVF9XLCB0cHcpCiAgICAgICAgfQogICAgICAgIEdldFRyYW5zZm9ybVdpdGhQYXJlbnRIZWlnaHQoKSB7CiAgICAgICAgICAgIHJldHVybiAodGhpcy5fZmxhZ3MgJiBGTEFHX1RSQU5TRk9STV9XSVRIX1BBUkVOVF9IKSAhPT0KICAgICAgICAgICAgICAgIDAKICAgICAgICB9CiAgICAgICAgU2V0VHJhbnNmb3JtV2l0aFBhcmVudEhlaWdodCh0cGgpIHsKICAgICAgICAgICAgdGhpcy5fU2V0RmxhZyhGTEFHX1RSQU5TRk9STV9XSVRIX1BBUkVOVF9ILCB0cGgpCiAgICAgICAgfQogICAgICAgIEdldFRyYW5zZm9ybVdpdGhQYXJlbnRBbmdsZSgpIHsKICAgICAgICAgICAgcmV0dXJuICh0aGlzLl9mbGFncyAmIEZMQUdfVFJBTlNGT1JNX1dJVEhfUEFSRU5UX0EpICE9PSAwCiAgICAgICAgfQogICAgICAgIFNldFRyYW5zZm9ybVdpdGhQYXJlbnRBbmdsZSh0cGEpIHsKICAgICAgICAgICAgdGhpcy5fU2V0RmxhZyhGTEFHX1RSQU5TRk9STV9XSVRIX1BBUkVOVF9BLCB0cGEpCiAgICAgICAgfQogICAgICAgIEdldFRyYW5zZm9ybVdpdGhQYXJlbnRaRWxldmF0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gKHRoaXMuX2ZsYWdzICYgRkxBR19UUkFOU0ZPUk1fV0lUSF9QQVJFTlRfWl9FTEVWQVRJT04pICE9PSAwCiAgICAgICAgfQogICAgICAgIFNldFRyYW5zZm9ybVdpdGhQYXJlbnRaRWxldmF0aW9uKHRweikgewogICAgICAgICAgICB0aGlzLl9TZXRGbGFnKEZMQUdfVFJBTlNGT1JNX1dJVEhfUEFSRU5UX1pfRUxFVkFUSU9OLCB0cHopCiAgICAgICAgfQogICAgICAgIEdldFRyYW5zZm9ybVdpdGhQYXJlbnRPcGFjaXR5KCkgewogICAgICAgICAgICByZXR1cm4gKHRoaXMuX2ZsYWdzICYgRkxBR19UUkFOU0ZPUk1fV0lUSF9QQVJFTlRfT1BBQ0lUWSkgIT09CiAgICAgICAgICAgICAgICAwCiAgICAgICAgfQogICAgICAgIFNldFRyYW5zZm9ybVdpdGhQYXJlbnRPcGFjaXR5KHRwbykgewogICAgICAgICAgICB0aGlzLl9TZXRGbGFnKEZMQUdfVFJBTlNGT1JNX1dJVEhfUEFSRU5UX09QQUNJVFksIHRwbykKICAgICAgICB9CiAgICAgICAgR2V0VHJhbnNmb3JtV2l0aFBhcmVudFZpc2liaWxpdHkoKSB7CiAgICAgICAgICAgIHJldHVybiAodGhpcy5fZmxhZ3MgJiBGTEFHX1RSQU5TRk9STV9XSVRIX1BBUkVOVF9WSVNJQklMSVRZKSAhPT0gMAogICAgICAgIH0KICAgICAgICBTZXRUcmFuc2Zvcm1XaXRoUGFyZW50VmlzaWJpbGl0eSh0cHYpIHsKICAgICAgICAgICAgdGhpcy5fU2V0RmxhZyhGTEFHX1RSQU5TRk9STV9XSVRIX1BBUkVOVF9WSVNJQklMSVRZLCB0cHYpCiAgICAgICAgfQogICAgICAgIF9DbGVhckFsbFNjZW5lR3JhcGhGbGFncygpIHsKICAgICAgICAgICAgdGhpcy5fZmxhZ3MgJj0gfk1BU0tfQUxMX1NDRU5FX0dSQVBIX0ZMQUdTCiAgICAgICAgfQogICAgICAgIEFkZENoaWxkKGNoaWxkLCBvcHRzKSB7CiAgICAgICAgICAgIGlmIChjaGlsZCA9PT0gdGhpcykgcmV0dXJuOwogICAgICAgICAgICBpZiAoY2hpbGQuSGFzUGFyZW50KCkpIHJldHVybjsKICAgICAgICAgICAgaWYgKHRoaXMuX0hhc0NoaWxkUmVjdXJzaXZlKGNoaWxkKSkgcmV0dXJuOwogICAgICAgICAgICBpZiAodGhpcy5fSGFzQW55UGFyZW50KGNoaWxkKSkgcmV0dXJuOwogICAgICAgICAgICBjb25zdCBhYnNYID0KICAgICAgICAgICAgICAgIGNoaWxkLkdldFgoKTsKICAgICAgICAgICAgY29uc3QgYWJzWSA9IGNoaWxkLkdldFkoKTsKICAgICAgICAgICAgY29uc3QgYWJzVyA9IGNoaWxkLkdldFdpZHRoKCk7CiAgICAgICAgICAgIGNvbnN0IGFic0ggPSBjaGlsZC5HZXRIZWlnaHQoKTsKICAgICAgICAgICAgY29uc3QgYWJzQSA9IGNoaWxkLkdldEFuZ2xlKCk7CiAgICAgICAgICAgIGNvbnN0IGFic1pFbGV2YXRpb24gPSBjaGlsZC5HZXRaRWxldmF0aW9uKCk7CiAgICAgICAgICAgIGNvbnN0IGFic09wYWNpdHkgPSBjaGlsZC5HZXRPcGFjaXR5KCk7CiAgICAgICAgICAgIGNoaWxkLl9TZXRQYXJlbnQodGhpcyk7CiAgICAgICAgICAgIGNoaWxkLlNldFRyYW5zZm9ybVdpdGhQYXJlbnRYKG9wdHMudHJhbnNmb3JtWCk7CiAgICAgICAgICAgIGNoaWxkLlNldFRyYW5zZm9ybVdpdGhQYXJlbnRZKG9wdHMudHJhbnNmb3JtWSk7CiAgICAgICAgICAgIGNoaWxkLlNldFRyYW5zZm9ybVdpdGhQYXJlbnRXaWR0aChvcHRzLnRyYW5zZm9ybVdpZHRoKTsKICAgICAgICAgICAgY2hpbGQuU2V0VHJhbnNmb3JtV2l0aFBhcmVudEhlaWdodChvcHRzLnRyYW5zZm9ybUhlaWdodCk7CiAgICAgICAgICAgIGNoaWxkLlNldFRyYW5zZm9ybVdpdGhQYXJlbnRBbmdsZShvcHRzLnRyYW5zZm9ybUFuZ2xlKTsKICAgICAgICAgICAgY2hpbGQuU2V0VHJhbnNmb3JtV2l0aFBhcmVudFpFbGV2YXRpb24ob3B0cy50cmFuc2Zvcm1aRWxldmF0aW9uKTsKICAgICAgICAgICAgY2hpbGQuU2V0VHJhbnNmb3JtV2l0aFBhcmVudE9wYWNpdHkob3B0cy50cmFuc2Zvcm1PcGFjaXR5KTsKICAgICAgICAgICAgY2hpbGQuU2V0VHJhbnNmb3JtV2l0aFBhcmVudFZpc2liaWxpdHkob3B0cy50cmFuc2Zvcm1WaXNpYmlsaXR5KTsKICAgICAgICAgICAgY2hpbGQuU2V0RGVzdHJveVdpdGhQYXJlbnQob3B0cy5kZXN0cm95V2l0aFBhcmVudCk7CiAgICAgICAgICAgIGlmIChvcHRzLnRyYW5zZm9ybVgpIHsKICAgICAgICAgICAgICAgIGNoaWxkLl94ID0gYWJzWCAtIHRoaXMuR2V0WCgpOwogICAgICAgICAgICAgICAgaWYgKG9wdHMudHJhbnNmb3JtV2lkdGgpIGNoaWxkLl94IC89IHRoaXMuR2V0V2lkdGgoKSAvIHRoaXMuX3NjZW5lR3JhcGhJbmZvLl9HZXRTdGFydFdpZHRoKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAob3B0cy50cmFuc2Zvcm1ZKSB7CiAgICAgICAgICAgICAgICBjaGlsZC5feSA9IGFic1kgLSB0aGlzLkdldFkoKTsKICAgICAgICAgICAgICAgIGlmIChvcHRzLnRyYW5zZm9ybUhlaWdodCkgY2hpbGQuX3kgLz0gdGhpcy5HZXRIZWlnaHQoKSAvIHRoaXMuX3NjZW5lR3JhcGhJbmZvLl9HZXRTdGFydEhlaWdodCgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG9wdHMudHJhbnNmb3JtV2lkdGgpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHB3ID0gdGhpcy5HZXRXaWR0aCgpOwogICAgICAgICAgICAgICAgaWYgKHB3ID09PQogICAgICAgICAgICAgICAgICAgIDAgfHwgcHcgPT09IE51bWJlci5FUFNJTE9OKSB7CiAgICAgICAgICAgICAgICAgICAgY2hpbGQuX3cgPSAxOwogICAgICAgICAgICAgICAgICAgIGNoaWxkLl9zY2VuZUdyYXBoSW5mby5TZXRTdGFydFNjYWxlWCgxKQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBjaGlsZC5fdyA9IGFic1cgLyB0aGlzLkdldFdpZHRoKCk7CiAgICAgICAgICAgICAgICAgICAgY2hpbGQuX3NjZW5lR3JhcGhJbmZvLlNldFN0YXJ0U2NhbGVYKGNoaWxkLl93KQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChvcHRzLnRyYW5zZm9ybUhlaWdodCkgewogICAgICAgICAgICAgICAgY29uc3QgcGggPSB0aGlzLkdldEhlaWdodCgpOwogICAgICAgICAgICAgICAgaWYgKHBoID09PSAwIHx8IHBoID09PSBOdW1iZXIuRVBTSUxPTikgewogICAgICAgICAgICAgICAgICAgIGNoaWxkLl9oID0gMTsKICAgICAgICAgICAgICAgICAgICBjaGlsZC5fc2NlbmVHcmFwaEluZm8uU2V0U3RhcnRTY2FsZVkoMSkKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgY2hpbGQuX2ggPSBhYnNIIC8gdGhpcy5HZXRIZWlnaHQoKTsKICAgICAgICAgICAgICAgICAgICBjaGlsZC5fc2NlbmVHcmFwaEluZm8uU2V0U3RhcnRTY2FsZVkoY2hpbGQuX2gpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG9wdHMudHJhbnNmb3JtQW5nbGUpIGNoaWxkLl9hID0gYWJzQSAtIHRoaXMuR2V0QW5nbGUoKTsKICAgICAgICAgICAgaWYgKG9wdHMudHJhbnNmb3JtWkVsZXZhdGlvbikgY2hpbGQuX3pFbGV2YXRpb24gPSBhYnNaRWxldmF0aW9uIC0gdGhpcy5HZXRaRWxldmF0aW9uKCk7CiAgICAgICAgICAgIGlmIChvcHRzLnRyYW5zZm9ybU9wYWNpdHkpIGNoaWxkLl9zY2VuZUdyYXBoSW5mby5TZXRPd25PcGFjaXR5KGFic09wYWNpdHkpOwogICAgICAgICAgICBpZiAob3B0cy50cmFuc2Zvcm1WaXNpYmlsaXR5KSBjaGlsZC5TZXRWaXNpYmxlKHRoaXMuSXNWaXNpYmxlKCkpOwogICAgICAgICAgICB0aGlzLl9BZGRDaGlsZFRvU2NlbmVHcmFwaEluZm8oY2hpbGQpOwogICAgICAgICAgICB0aGlzLlNldEJib3hDaGFuZ2VkKCk7CiAgICAgICAgICAgIHRoaXMuX1NldE9wYWNpdHlPZkNoaWxkcmVuKCkKICAgICAgICB9CiAgICAgICAgUmVtb3ZlQ2hpbGQoY2hpbGQpIHsKICAgICAgICAgICAgaWYgKGNoaWxkLkdldFBhcmVudCgpICE9PSB0aGlzKSByZXR1cm47CiAgICAgICAgICAgIGNvbnN0IGFic1ggPSBjaGlsZC5HZXRYKCk7CiAgICAgICAgICAgIGNvbnN0IGFic1kgPSBjaGlsZC5HZXRZKCk7CiAgICAgICAgICAgIGNvbnN0IGFic1cgPSBjaGlsZC5HZXRXaWR0aCgpOwogICAgICAgICAgICBjb25zdCBhYnNIID0gY2hpbGQuR2V0SGVpZ2h0KCk7CiAgICAgICAgICAgIGNvbnN0IGFic0EgPSBjaGlsZC5HZXRBbmdsZSgpOwogICAgICAgICAgICBjb25zdCBhYnNaRWxldmF0aW9uID0gY2hpbGQuR2V0WkVsZXZhdGlvbigpOwogICAgICAgICAgICBjb25zdCBhYnNPcGFjaXR5ID0gY2hpbGQuR2V0T3BhY2l0eSgpOwogICAgICAgICAgICBjaGlsZC5fU2V0UGFyZW50KG51bGwpOwogICAgICAgICAgICBjaGlsZC5fQ2xlYXJBbGxTY2VuZUdyYXBoRmxhZ3MoKTsKICAgICAgICAgICAgY2hpbGQuU2V0WFkoYWJzWCwgYWJzWSk7CiAgICAgICAgICAgIGNoaWxkLlNldFNpemUoYWJzVywgYWJzSCk7CiAgICAgICAgICAgIGNoaWxkLlNldEFuZ2xlKGFic0EpOwogICAgICAgICAgICBjaGlsZC5TZXRaRWxldmF0aW9uKGFic1pFbGV2YXRpb24pOwogICAgICAgICAgICBjaGlsZC5TZXRPcGFjaXR5KGFic09wYWNpdHkpOwogICAgICAgICAgICB0aGlzLl9SZW1vdmVDaGlsZEZyb21TY2VuZUdyYXBoSW5mbyhjaGlsZCk7CiAgICAgICAgICAgIHRoaXMuU2V0QmJveENoYW5nZWQoKTsKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgfQogICAgICAgIF9SZXNldEFsbFNjZW5lR3JhcGhTdGF0ZSgpIHsKICAgICAgICAgICAgdGhpcy5fQnVpbGRUbXBTY2VuZUdyYXBoQ2hpbGRyZW4oKTsKICAgICAgICAgICAgY29uc3QgY2hpbGRyZW4gPSBbLi4udGhpcy5jaGlsZHJlbigpXTsKICAgICAgICAgICAgZm9yIChjb25zdCBjIG9mIGNoaWxkcmVuKSB0aGlzLlJlbW92ZUNoaWxkKGMpOwogICAgICAgICAgICBjb25zdCBwYXJlbnQgPSB0aGlzLkdldFBhcmVudCgpOwogICAgICAgICAgICBpZiAocGFyZW50KSBwYXJlbnQuUmVtb3ZlQ2hpbGQodGhpcyk7CiAgICAgICAgICAgIHRoaXMuX0NsZWFyQWxsU2NlbmVHcmFwaEZsYWdzKCkKICAgICAgICB9CiAgICAgICAgX0J1aWxkVG1wU2NlbmVHcmFwaENoaWxkcmVuKCkgewogICAgICAgICAgICBpZiAoIXRoaXMuX3RtcFNjZW5lR3JhcGhDaGlsZHJlbikgewogICAgICAgICAgICAgICAgY29uc3QgY2hpbGRyZW4gPSBbLi4udGhpcy5jaGlsZHJlbigpXTsKICAgICAgICAgICAgICAgIGlmIChjaGlsZHJlbi5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl90bXBTY2VuZUdyYXBoQ2hpbGRyZW4gPSBbXTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl90bXBTY2VuZUdyYXBoQ2hpbGRyZW5JbmRleGVzID0gbmV3IFdlYWtNYXAKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGxldCBpbmRleCA9IDA7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGMgb2YgY2hpbGRyZW4pIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBpbnN0ID0gYy5HZXRJbnN0YW5jZSgpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3RtcFNjZW5lR3JhcGhDaGlsZHJlbi5wdXNoKGluc3QpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3RtcFNjZW5lR3JhcGhDaGlsZHJlbkluZGV4ZXMuc2V0KGluc3QsIGluZGV4KTsKICAgICAgICAgICAgICAgICAgICBpbmRleCsrCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgcGFyZW50ID0gdGhpcy5HZXRQYXJlbnQoKTsKICAgICAgICAgICAgaWYgKHBhcmVudCkgcGFyZW50Ll9CdWlsZFRtcFNjZW5lR3JhcGhDaGlsZHJlbigpCiAgICAgICAgfQogICAgICAgIF9SZWxlYXNlVG1wU2NlbmVHcmFwaEluZm8oKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl90bXBTY2VuZUdyYXBoQ2hpbGRyZW4pIHRoaXMuX3RtcFNjZW5lR3JhcGhDaGlsZHJlbi5sZW5ndGggPSAwOwogICAgICAgICAgICB0aGlzLl90bXBTY2VuZUdyYXBoQ2hpbGRyZW4gPSBudWxsOwogICAgICAgICAgICB0aGlzLl90bXBTY2VuZUdyYXBoQ2hpbGRyZW5JbmRleGVzID0KICAgICAgICAgICAgICAgIG51bGw7CiAgICAgICAgICAgIG5lZWRzU2NlbmVHcmFwaEFmdGVyTG9hZC5kZWxldGUodGhpcyk7CiAgICAgICAgICAgIGNvbnN0IHBhcmVudCA9IHRoaXMuR2V0UGFyZW50KCk7CiAgICAgICAgICAgIGlmIChwYXJlbnQgJiYgIW5lZWRzU2NlbmVHcmFwaEFmdGVyTG9hZC5oYXMocGFyZW50KSkgcGFyZW50Ll9SZWxlYXNlVG1wU2NlbmVHcmFwaEluZm8oKQogICAgICAgIH0KICAgICAgICBIYXNQYXJlbnQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLkdldFBhcmVudCgpICE9PSBudWxsCiAgICAgICAgfQogICAgICAgIEdldFBhcmVudCgpIHsKICAgICAgICAgICAgY29uc3Qgc2dpID0gdGhpcy5fc2NlbmVHcmFwaEluZm87CiAgICAgICAgICAgIHJldHVybiBzZ2kgIT09IG51bGwgPyBzZ2kuR2V0UGFyZW50KCkgOiBudWxsCiAgICAgICAgfQogICAgICAgIEdldFRvcFBhcmVudCgpIHsKICAgICAgICAgICAgbGV0IHAgPSB0aGlzOwogICAgICAgICAgICB3aGlsZSAocC5IYXNQYXJlbnQoKSkgcCA9IHAuR2V0UGFyZW50KCk7CiAgICAgICAgICAgIHJldHVybiBwCiAgICAgICAgfSogcGFyZW50cygpIHsKICAgICAgICAgICAgbGV0IHBhcmVudCA9IHRoaXMuR2V0UGFyZW50KCk7CiAgICAgICAgICAgIHdoaWxlIChwYXJlbnQpIHsKICAgICAgICAgICAgICAgIHlpZWxkIHBhcmVudDsKICAgICAgICAgICAgICAgIHBhcmVudCA9IHBhcmVudC5HZXRQYXJlbnQoKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIEhhc0NoaWxkKGNoaWxkKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLkdldENoaWxkcmVuKCkuaW5jbHVkZXMoY2hpbGQpCiAgICAgICAgfQogICAgICAgIEhhc0NoaWxkcmVuKCkgewogICAgICAgICAgICBjb25zdCBzZ2kgPQogICAgICAgICAgICAgICAgdGhpcy5fc2NlbmVHcmFwaEluZm87CiAgICAgICAgICAgIHJldHVybiBzZ2kgIT09IG51bGwgPyBzZ2kuSGFzQ2hpbGRyZW4oKSA6IGZhbHNlCiAgICAgICAgfQogICAgICAgIEdldENoaWxkcmVuKCkgewogICAgICAgICAgICBjb25zdCBzZ2kgPSB0aGlzLl9zY2VuZUdyYXBoSW5mbzsKICAgICAgICAgICAgcmV0dXJuIHNnaSAhPT0gbnVsbCA/IHNnaS5HZXRDaGlsZHJlbigpIDogRU1QVFlfQVJSQVkKICAgICAgICB9CiAgICAgICAgY2hpbGRyZW4oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLkdldENoaWxkcmVuKCkKICAgICAgICB9KiBhbGxDaGlsZHJlbigpIHsKICAgICAgICAgICAgZm9yIChjb25zdCBjaGlsZCBvZiB0aGlzLmNoaWxkcmVuKCkpIHsKICAgICAgICAgICAgICAgIHlpZWxkIGNoaWxkOwogICAgICAgICAgICAgICAgeWllbGQqIGNoaWxkLmFsbENoaWxkcmVuKCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBHZXRDaGlsZENvdW50KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5HZXRDaGlsZHJlbigpLmxlbmd0aAogICAgICAgIH0KICAgICAgICBHZXRBbGxDaGlsZENvdW50KCkgewogICAgICAgICAgICByZXR1cm4gWy4uLnRoaXMuYWxsQ2hpbGRyZW4oKV0ubGVuZ3RoCiAgICAgICAgfQogICAgICAgIEdldENoaWxkQXQoaW5kZXgpIHsKICAgICAgICAgICAgY29uc3QgY2hpbGRyZW4gPSB0aGlzLkdldENoaWxkcmVuKCk7CiAgICAgICAgICAgIGluZGV4ID0gTWF0aC5mbG9vcigraW5kZXgpOwogICAgICAgICAgICBpZiAoaW5kZXggPCAwIHx8IGluZGV4ID49IGNoaWxkcmVuLmxlbmd0aCkgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIHJldHVybiBjaGlsZHJlbltpbmRleF0KICAgICAgICB9CiAgICAgICAgX0NyZWF0ZVNjZW5lR3JhcGhJbmZvKHBhcmVudCkgewogICAgICAgICAgICBpZiAoIXRoaXMuX3NjZW5lR3JhcGhJbmZvKSB0aGlzLl9zY2VuZUdyYXBoSW5mbyA9IEMzLk5ldyhDMy5TY2VuZUdyYXBoSW5mbywgdGhpcyk7CiAgICAgICAgICAgIGlmIChwYXJlbnQpIHRoaXMuX3NjZW5lR3JhcGhJbmZvLlNldFBhcmVudChwYXJlbnQpCiAgICAgICAgfQogICAgICAgIF9HZXRTY2VuZUdyYXBoSW5mbygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NjZW5lR3JhcGhJbmZvCiAgICAgICAgfQogICAgICAgIF9SZWxlYXNlU2NlbmVHcmFwaEluZm8oKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5fc2NlbmVHcmFwaEluZm8pIHJldHVybjsKICAgICAgICAgICAgdGhpcy5fc2NlbmVHcmFwaEluZm8uUmVsZWFzZSgpOwogICAgICAgICAgICB0aGlzLl9zY2VuZUdyYXBoSW5mbyA9IG51bGwKICAgICAgICB9CiAgICAgICAgX1NldFBhcmVudChwYXJlbnQpIHsKICAgICAgICAgICAgaWYgKHBhcmVudCkgewogICAgICAgICAgICAgICAgcGFyZW50Ll9DcmVhdGVTY2VuZUdyYXBoSW5mbyhudWxsKTsKICAgICAgICAgICAgICAgIHRoaXMuX0NyZWF0ZVNjZW5lR3JhcGhJbmZvKHBhcmVudCkKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9zY2VuZUdyYXBoSW5mbykgdGhpcy5fc2NlbmVHcmFwaEluZm8uU2V0UGFyZW50KG51bGwpOwogICAgICAgICAgICAgICAgaWYgKCF0aGlzLkhhc0NoaWxkcmVuKCkpIHRoaXMuX1JlbGVhc2VTY2VuZUdyYXBoSW5mbygpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgX0hhc0FueVBhcmVudChjaGlsZCkgewogICAgICAgICAgICBpZiAoIXRoaXMuSGFzUGFyZW50KCkpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgY29uc3QgcGFyZW50ID0gdGhpcy5HZXRQYXJlbnQoKTsKICAgICAgICAgICAgaWYgKHBhcmVudCA9PT0gY2hpbGQpIHJldHVybiB0cnVlOwogICAgICAgICAgICByZXR1cm4gcGFyZW50Ll9IYXNBbnlQYXJlbnQoY2hpbGQpCiAgICAgICAgfQogICAgICAgIF9IYXNDaGlsZFJlY3Vyc2l2ZShjaGlsZCkgewogICAgICAgICAgICBpZiAodGhpcy5IYXNDaGlsZChjaGlsZCkpIHJldHVybiB0cnVlOwogICAgICAgICAgICBmb3IgKGNvbnN0IGMgb2YgdGhpcy5HZXRDaGlsZHJlbigpKQogICAgICAgICAgICAgICAgaWYgKGMuX0hhc0NoaWxkUmVjdXJzaXZlKGNoaWxkKSkgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIHJldHVybiBmYWxzZQogICAgICAgIH0KICAgICAgICBfQWRkQ2hpbGRUb1NjZW5lR3JhcGhJbmZvKGNoaWxkKSB7CiAgICAgICAgICAgIHRoaXMuX3NjZW5lR3JhcGhJbmZvLkdldENoaWxkcmVuKCkucHVzaChjaGlsZCkKICAgICAgICB9CiAgICAgICAgX1JlbW92ZUNoaWxkRnJvbVNjZW5lR3JhcGhJbmZvKGNoaWxkKSB7CiAgICAgICAgICAgIGNvbnN0IGNoaWxkcmVuID0gdGhpcy5fc2NlbmVHcmFwaEluZm8uR2V0Q2hpbGRyZW4oKTsKICAgICAgICAgICAgY29uc3QgaW5kZXggPSBjaGlsZHJlbi5pbmRleE9mKGNoaWxkKTsKICAgICAgICAgICAgaWYgKGluZGV4ICE9PSAtMSkgY2hpbGRyZW4uc3BsaWNlKGluZGV4LCAxKTsKICAgICAgICAgICAgaWYgKGNoaWxkcmVuLmxlbmd0aCA9PT0gMCAmJiAhdGhpcy5IYXNQYXJlbnQoKSkgdGhpcy5fUmVsZWFzZVNjZW5lR3JhcGhJbmZvKCk7CiAgICAgICAgICAgIGlmICghY2hpbGQuSGFzQ2hpbGRyZW4oKSkgY2hpbGQuX1JlbGVhc2VTY2VuZUdyYXBoSW5mbygpCiAgICAgICAgfQogICAgICAgIEdldFNjZW5lR3JhcGhDaGlsZHJlbkV4cG9ydERhdGEoKSB7CiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBzY2VuZUdyYXBoRXhwb3J0RGF0YU1hcC5nZXQodGhpcyk7CiAgICAgICAgICAgIHJldHVybiBkYXRhID8gZGF0YS5jaGlsZHJlbkRhdGEgOiBudWxsCiAgICAgICAgfQogICAgICAgIEdldFNjZW5lR3JhcGhaSW5kZXhFeHBvcnREYXRhKCkgewogICAgICAgICAgICBjb25zdCBkYXRhID0gc2NlbmVHcmFwaEV4cG9ydERhdGFNYXAuZ2V0KHRoaXMpOwogICAgICAgICAgICByZXR1cm4gZGF0YSA/IGRhdGEuekluZGV4RGF0YSA6IE5hTgogICAgICAgIH0KICAgICAgICBHZXRTY2VuZUdyYXBoWkluZGV4KCkgewogICAgICAgICAgICBjb25zdCBzY2VuZUdyYXBoWkluZGV4ID0gc2NlbmVHcmFwaFpJbmRleE1hcC5nZXQodGhpcyk7CiAgICAgICAgICAgIHJldHVybiBDMy5Jc0Zpbml0ZU51bWJlcihzY2VuZUdyYXBoWkluZGV4KSA/CiAgICAgICAgICAgICAgICBzY2VuZUdyYXBoWkluZGV4IDogTmFOCiAgICAgICAgfQogICAgICAgIFNldFNjZW5lR3JhcGhaSW5kZXgoeikgewogICAgICAgICAgICBzY2VuZUdyYXBoWkluZGV4TWFwLnNldCh0aGlzLCB6KQogICAgICAgIH0KICAgICAgICBTZXRVc2VQb2ludHNTaGFkZXJQcm9ncmFtKCkgewogICAgICAgICAgICB0aGlzLl9TZXRGbGFnKEZMQUdfVVNFX1BPSU5UU19TSEFERVJfUFJPR1JBTSwgdHJ1ZSk7CiAgICAgICAgICAgIHRoaXMuX1VwZGF0ZVJlbmRlcmVyU3RhdGVHcm91cCgpCiAgICAgICAgfQogICAgICAgIF9VcGRhdGVSZW5kZXJlclN0YXRlR3JvdXAoKSB7CiAgICAgICAgICAgIGlmICghZW5hYmxlVXBkYXRlUmVuZGVyZXJTdGF0ZUdyb3VwKSByZXR1cm47CiAgICAgICAgICAgIGNvbnN0IHJlbmRlcmVyID0gdGhpcy5fcnVudGltZS5HZXRSZW5kZXJlcigpOwogICAgICAgICAgICBpZiAodGhpcy5fc3RhdGVHcm91cCkgcmVuZGVyZXIuUmVsZWFzZVN0YXRlR3JvdXAodGhpcy5fc3RhdGVHcm91cCk7CiAgICAgICAgICAgIGxldCBzaGFkZXJQcm9ncmFtOwogICAgICAgICAgICBpZiAoKHRoaXMuX2ZsYWdzICYgRkxBR19VU0VfUE9JTlRTX1NIQURFUl9QUk9HUkFNKSAhPT0gMCkgc2hhZGVyUHJvZ3JhbSA9IHJlbmRlcmVyLkdldFBvaW50c1JlbmRlcmluZ1Byb2dyYW0oKSB8fCAiPHBvaW50PiI7CiAgICAgICAgICAgIGVsc2Ugc2hhZGVyUHJvZ3JhbSA9CiAgICAgICAgICAgICAgICByZW5kZXJlci5HZXRUZXh0dXJlRmlsbFNoYWRlclByb2dyYW0oKSB8fCAiPGRlZmF1bHQ+IjsKICAgICAgICAgICAgdGhpcy5fc3RhdGVHcm91cCA9IHJlbmRlcmVyLkFjcXVpcmVTdGF0ZUdyb3VwKHNoYWRlclByb2dyYW0sIHRoaXMuR2V0QmxlbmRNb2RlKCksIHRoaXMuX2NvbG9yUHJlbXVsdGlwbGllZCwgdGhpcy5HZXRaRWxldmF0aW9uKCkpCiAgICAgICAgfQogICAgICAgIEdldFJlbmRlcmVyU3RhdGVHcm91cCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3N0YXRlR3JvdXAKICAgICAgICB9CiAgICAgICAgSGFzRGVmYXVsdENvbG9yKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fY29sb3IgPT09IERFRkFVTFRfQ09MT1IKICAgICAgICB9CiAgICAgICAgU2V0QmxlbmRNb2RlKGJtKSB7CiAgICAgICAgICAgIGJtID0gYm0gfCAwOwogICAgICAgICAgICBpZiAoYm0gPCAwIHx8IGJtID4gMzEpIHRocm93IG5ldyBSYW5nZUVycm9yKCJpbnZhbGlkIGJsZW5kIG1vZGUiKTsKICAgICAgICAgICAgaWYgKHRoaXMuR2V0QmxlbmRNb2RlKCkgPT09IGJtKSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuX2ZsYWdzID0gdGhpcy5fZmxhZ3MgJiB+RkxBR19CTEVORF9NT0RFX01BU0sgfCBibSA8PCBGTEFHX0JMRU5EX01PREVfQklUX09GRlNFVDsKICAgICAgICAgICAgdGhpcy5fVXBkYXRlUmVuZGVyZXJTdGF0ZUdyb3VwKCkKICAgICAgICB9CiAgICAgICAgR2V0QmxlbmRNb2RlKCkgewogICAgICAgICAgICByZXR1cm4gKHRoaXMuX2ZsYWdzICYKICAgICAgICAgICAgICAgIEZMQUdfQkxFTkRfTU9ERV9NQVNLKSA+PiBGTEFHX0JMRU5EX01PREVfQklUX09GRlNFVAogICAgICAgIH0KICAgICAgICBfU2V0TGF5ZXIobGF5ZXIsIHVwZGF0ZVJlbmRlckNlbGwpIHsKICAgICAgICAgICAgY29uc3QgZG9VcGRhdGVSZW5kZXJDZWxsID0gdXBkYXRlUmVuZGVyQ2VsbCAmJiB0aGlzLl9sYXllciAhPT0gbGF5ZXI7CiAgICAgICAgICAgIGlmIChkb1VwZGF0ZVJlbmRlckNlbGwpIHRoaXMuX1JlbW92ZUZyb21SZW5kZXJDZWxscygpOwogICAgICAgICAgICB0aGlzLl9sYXllciA9IGxheWVyOwogICAgICAgICAgICBpZiAoZG9VcGRhdGVSZW5kZXJDZWxsKSB0aGlzLl9VcGRhdGVSZW5kZXJDZWxsKCk7CiAgICAgICAgICAgIGlmICh0aGlzLkdldFpFbGV2YXRpb24oKSAhPT0gMCkgdGhpcy5fbGF5ZXIuX1NldEFueUluc3RhbmNlWkVsZXZhdGVkKCkKICAgICAgICB9CiAgICAgICAgR2V0TGF5ZXIoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9sYXllcgogICAgICAgIH0KICAgICAgICBHZXRMYXlvdXQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLkdldExheWVyKCkuR2V0TGF5b3V0KCkKICAgICAgICB9CiAgICAgICAgX1NldFpJbmRleCh6KSB7CiAgICAgICAgICAgIHRoaXMuX3pJbmRleCA9IHogfCAwCiAgICAgICAgfQogICAgICAgIEdldFpJbmRleCgpIHsKICAgICAgICAgICAgdGhpcy5fbGF5ZXIuX1VwZGF0ZVpJbmRpY2VzKCk7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl96SW5kZXgKICAgICAgICB9CiAgICAgICAgX0dldExhc3RDYWNoZWRaSW5kZXgoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl96SW5kZXgKICAgICAgICB9CiAgICAgICAgX1NldEZsYWcoYml0LAogICAgICAgICAgICBlbmFibGUpIHsKICAgICAgICAgICAgaWYgKGVuYWJsZSkgdGhpcy5fZmxhZ3MgfD0gYml0OwogICAgICAgICAgICBlbHNlIHRoaXMuX2ZsYWdzICY9IH5iaXQKICAgICAgICB9CiAgICAgICAgSXNWaXNpYmxlKCkgewogICAgICAgICAgICByZXR1cm4gKHRoaXMuX2ZsYWdzICYgRkxBR19JU19WSVNJQkxFKSAhPT0gMAogICAgICAgIH0KICAgICAgICBTZXRWaXNpYmxlKHYpIHsKICAgICAgICAgICAgdGhpcy5fU2V0RmxhZyhGTEFHX0lTX1ZJU0lCTEUsIHYpOwogICAgICAgICAgICBpZiAoIXRoaXMuSGFzQ2hpbGRyZW4oKSkgcmV0dXJuOwogICAgICAgICAgICBmb3IgKGNvbnN0IGNoaWxkIG9mIHRoaXMuR2V0Q2hpbGRyZW4oKSkKICAgICAgICAgICAgICAgIGlmIChjaGlsZC5HZXRUcmFuc2Zvcm1XaXRoUGFyZW50VmlzaWJpbGl0eSgpKSBjaGlsZC5TZXRWaXNpYmxlKHYpCiAgICAgICAgfQogICAgICAgIElzQ29sbGlzaW9uRW5hYmxlZCgpIHsKICAgICAgICAgICAgcmV0dXJuICh0aGlzLl9mbGFncyAmIEZMQUdfQ09MTElTSU9OX0VOQUJMRUQpICE9PSAwCiAgICAgICAgfQogICAgICAgIFNldENvbGxpc2lvbkVuYWJsZWQoZSkgewogICAgICAgICAgICBlID0gISFlOwogICAgICAgICAgICBpZiAodGhpcy5Jc0NvbGxpc2lvbkVuYWJsZWQoKSA9PT0gZSkgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl9TZXRGbGFnKEZMQUdfQ09MTElTSU9OX0VOQUJMRUQsIGUpOwogICAgICAgICAgICBpZiAoZSkgdGhpcy5TZXRCYm94Q2hhbmdlZCgpOwogICAgICAgICAgICBlbHNlIHRoaXMuX1JlbW92ZUZyb21Db2xsaXNpb25DZWxscygpCiAgICAgICAgfQogICAgICAgIFNldFNvbGlkQ29sbGlzaW9uRmlsdGVyKGlzSW5jbHVzaXZlLAogICAgICAgICAgICB0YWdzKSB7CiAgICAgICAgICAgIHRoaXMuX1NldEZsYWcoRkxBR19TT0xJRF9GSUxURVJfSU5DTFVTSVZFLCBpc0luY2x1c2l2ZSk7CiAgICAgICAgICAgIGlmICh0aGlzLl9zb2xpZEZpbHRlclRhZ3MpIHRoaXMuX3NvbGlkRmlsdGVyVGFncy5jbGVhcigpOwogICAgICAgICAgICBpZiAoIXRhZ3MudHJpbSgpKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9zb2xpZEZpbHRlclRhZ3MgPSBudWxsOwogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCF0aGlzLl9zb2xpZEZpbHRlclRhZ3MpIHRoaXMuX3NvbGlkRmlsdGVyVGFncyA9IG5ldyBTZXQ7CiAgICAgICAgICAgIGZvciAoY29uc3QgdGFnIG9mIHRhZ3Muc3BsaXQoIiAiKSkKICAgICAgICAgICAgICAgIGlmICh0YWcpIHRoaXMuX3NvbGlkRmlsdGVyVGFncy5hZGQodGFnLnRvTG93ZXJDYXNlKCkpCiAgICAgICAgfQogICAgICAgIElzU29saWRDb2xsaXNpb25BbGxvd2VkKHNvbGlkVGFnU2V0KSB7CiAgICAgICAgICAgIGNvbnN0IGlzSW5jbHVzaXZlID0gKHRoaXMuX2ZsYWdzICYgRkxBR19TT0xJRF9GSUxURVJfSU5DTFVTSVZFKSAhPT0gMDsKICAgICAgICAgICAgY29uc3QgZmlsdGVyVGFncyA9IHRoaXMuX3NvbGlkRmlsdGVyVGFnczsKICAgICAgICAgICAgaWYgKCFzb2xpZFRhZ1NldCB8fCAhZmlsdGVyVGFncykgcmV0dXJuICFpc0luY2x1c2l2ZTsKICAgICAgICAgICAgZm9yIChjb25zdCB0YWcgb2YgZmlsdGVyVGFncykKICAgICAgICAgICAgICAgIGlmIChzb2xpZFRhZ1NldC5oYXModGFnKSkgcmV0dXJuIGlzSW5jbHVzaXZlOwogICAgICAgICAgICByZXR1cm4gIWlzSW5jbHVzaXZlCiAgICAgICAgfQogICAgICAgIFNldEJib3hDaGFuZ2VkKCkgewogICAgICAgICAgICB0aGlzLl9mbGFncyB8PSBGTEFHX0JCT1hfQ0hBTkdFRCB8IEZMQUdfQ09MTElTSU9OX0NFTExfQ0hBTkdFRCB8IEZMQUdfTUVTSF9DSEFOR0VEOwogICAgICAgICAgICB0aGlzLl9vYmplY3RDbGFzcy5fU2V0QW55Q29sbGlzaW9uQ2VsbENoYW5nZWQodHJ1ZSk7CiAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuVXBkYXRlUmVuZGVyKCk7CiAgICAgICAgICAgIGlmICh0aGlzLl9sYXllci5Vc2VzUmVuZGVyQ2VsbHMoKSkgewogICAgICAgICAgICAgICAgdGhpcy5DYWxjdWxhdGVCYm94KHRoaXMuX2JvdW5kaW5nQm94LCB0aGlzLl9ib3VuZGluZ1F1YWQsIHRydWUpOwogICAgICAgICAgICAgICAgdGhpcy5fZmxhZ3MgJj0gfkZMQUdfQkJPWF9DSEFOR0VEOwogICAgICAgICAgICAgICAgdGhpcy5fVXBkYXRlUmVuZGVyQ2VsbCgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCh0aGlzLl9mbGFncyAmIEZMQUdfRU5BQkxFX0JCT1hfQ0hBTkdFRF9FVkVOVCkgIT09IDApIHRoaXMuX2luc3QuRGlzcGF0Y2hlcigpLmRpc3BhdGNoRXZlbnQoYmJveENoYW5nZUV2ZW50KTsKICAgICAgICAgICAgaWYgKHRoaXMuX3NjZW5lR3JhcGhJbmZvICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBjb25zdCBjaGlsZHJlbiA9CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2NlbmVHcmFwaEluZm8uR2V0Q2hpbGRyZW4oKTsKICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBjaGlsZHJlbi5sZW5ndGg7IGkgPCBsZW47ICsraSkgY2hpbGRyZW5baV0uU2V0QmJveENoYW5nZWQoKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIENhbGN1bGF0ZUJib3goYmJveCwgYnF1YWQsIGluY2x1ZGVNZXNoKSB7CiAgICAgICAgICAgIGNvbnN0IHggPSB0aGlzLkdldFgoKTsKICAgICAgICAgICAgY29uc3QgeSA9IHRoaXMuR2V0WSgpOwogICAgICAgICAgICBjb25zdCB3ID0gdGhpcy5HZXRXaWR0aCgpOwogICAgICAgICAgICBjb25zdCBoID0gdGhpcy5HZXRIZWlnaHQoKTsKICAgICAgICAgICAgY29uc3QgYSA9IHRoaXMuR2V0QW5nbGUoKTsKICAgICAgICAgICAgYmJveC5zZXRXSCh4IC0gdGhpcy5fb3ggKiB3LCB5IC0gdGhpcy5fb3kgKiBoLCB3LCBoKTsKICAgICAgICAgICAgaWYgKGluY2x1ZGVNZXNoICYmIHRoaXMuSGFzTWVzaCgpKSB0aGlzLl9FeHBhbmRCYm94Rm9yTWVzaChiYm94KTsKICAgICAgICAgICAgaWYgKGEgPT09IDApIGJxdWFkLnNldEZyb21SZWN0KGJib3gpOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGJib3gub2Zmc2V0KC14LCAteSk7CiAgICAgICAgICAgICAgICBicXVhZC5zZXRGcm9tUm90YXRlZFJlY3RQcmVjYWxjKGJib3gsIHRoaXMuR2V0U2luQW5nbGUoKSwgdGhpcy5HZXRDb3NBbmdsZSgpKTsKICAgICAgICAgICAgICAgIGJxdWFkLm9mZnNldCh4LAogICAgICAgICAgICAgICAgICAgIHkpOwogICAgICAgICAgICAgICAgYnF1YWQuZ2V0Qm91bmRpbmdCb3goYmJveCkKICAgICAgICAgICAgfQogICAgICAgICAgICBiYm94Lm5vcm1hbGl6ZSgpCiAgICAgICAgfQogICAgICAgIF9VcGRhdGVCYm94KCkgewogICAgICAgICAgICBjb25zdCBmbGFncyA9IHRoaXMuX2ZsYWdzOwogICAgICAgICAgICBpZiAoKGZsYWdzICYgRkxBR19CQk9YX0NIQU5HRUQpICE9PSAwKSB7CiAgICAgICAgICAgICAgICB0aGlzLkNhbGN1bGF0ZUJib3godGhpcy5fYm91bmRpbmdCb3gsIHRoaXMuX2JvdW5kaW5nUXVhZCwgdHJ1ZSk7CiAgICAgICAgICAgICAgICB0aGlzLl9mbGFncyA9IGZsYWdzICYgfkZMQUdfQkJPWF9DSEFOR0VECiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgR2V0Qm91bmRpbmdCb3goKSB7CiAgICAgICAgICAgIHRoaXMuX1VwZGF0ZUJib3goKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2JvdW5kaW5nQm94CiAgICAgICAgfQogICAgICAgIEdldEJvdW5kaW5nUXVhZCgpIHsKICAgICAgICAgICAgdGhpcy5fVXBkYXRlQmJveCgpOwogICAgICAgICAgICByZXR1cm4gdGhpcy5fYm91bmRpbmdRdWFkCiAgICAgICAgfQogICAgICAgIFBpeGVsUm91bmRRdWFkKHF1YWQpIHsKICAgICAgICAgICAgY29uc3QgeCA9IHRoaXMuR2V0WCgpOwogICAgICAgICAgICBjb25zdCB5ID0gdGhpcy5HZXRZKCk7CiAgICAgICAgICAgIGNvbnN0IG94ID0gTWF0aC5yb3VuZCh4KSAtIHg7CiAgICAgICAgICAgIGNvbnN0IG95ID0gTWF0aC5yb3VuZCh5KSAtIHk7CiAgICAgICAgICAgIGlmIChveCA9PT0gMCAmJiBveSA9PT0gMCkgcmV0dXJuIHF1YWQ7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgdGVtcFF1YWQuY29weShxdWFkKTsKICAgICAgICAgICAgICAgIHRlbXBRdWFkLm9mZnNldChveCwgb3kpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRlbXBRdWFkCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgT3ZlcndyaXRlQm91bmRpbmdCb3goYm94KSB7CiAgICAgICAgICAgIHRoaXMuX2JvdW5kaW5nQm94LmNvcHkoYm94KTsKICAgICAgICAgICAgdGhpcy5fYm91bmRpbmdRdWFkLnNldEZyb21SZWN0KHRoaXMuX2JvdW5kaW5nQm94KTsKICAgICAgICAgICAgdGhpcy5fZmxhZ3MgJj0gfkZMQUdfQkJPWF9DSEFOR0VEOwogICAgICAgICAgICB0aGlzLl9VcGRhdGVDb2xsaXNpb25DZWxsKCk7CiAgICAgICAgICAgIHRoaXMuX1VwZGF0ZVJlbmRlckNlbGwoKQogICAgICAgIH0KICAgICAgICBTZXRCYm94Q2hhbmdlRXZlbnRFbmFibGVkKGUpIHsKICAgICAgICAgICAgdGhpcy5fU2V0RmxhZyhGTEFHX0VOQUJMRV9CQk9YX0NIQU5HRURfRVZFTlQsIGUpCiAgICAgICAgfQogICAgICAgIElzQmJveENoYW5nZUV2ZW50RW5hYmxlZCgpIHsKICAgICAgICAgICAgcmV0dXJuICh0aGlzLl9mbGFncyAmIEZMQUdfRU5BQkxFX0JCT1hfQ0hBTkdFRF9FVkVOVCkgIT09IDAKICAgICAgICB9CiAgICAgICAgSXNJblZpZXdwb3J0KHZpZXdwb3J0LCBoYXNWYW5pc2hpbmdQb2ludE91dHNpZGVWaWV3cG9ydCwgaXNPcnRob2dyYXBoaWMpIHsKICAgICAgICAgICAgaWYgKGhhc1ZhbmlzaGluZ1BvaW50T3V0c2lkZVZpZXdwb3J0ICYmIHRoaXMuR2V0RGVwdGgoKSAhPT0KICAgICAgICAgICAgICAgIDApIHJldHVybiB0aGlzLklzSW5WaWV3cG9ydDNEKHRoaXMuR2V0TGF5ZXIoKS5fR2V0Vmlld0ZydXN0dW0oKSk7CiAgICAgICAgICAgIGVsc2UgcmV0dXJuIHRoaXMuR2V0WkVsZXZhdGlvbigpID09PSAwIHx8IGlzT3J0aG9ncmFwaGljID8gdmlld3BvcnQuaW50ZXJzZWN0c1JlY3QodGhpcy5HZXRCb3VuZGluZ0JveCgpKSA6IHRoaXMuX0lzSW5WaWV3cG9ydF9aRWxldmF0ZWQoKQogICAgICAgIH0KICAgICAgICBfSXNJblZpZXdwb3J0X1pFbGV2YXRlZCgpIHsKICAgICAgICAgICAgY29uc3QgbGF5ZXIgPSB0aGlzLkdldExheWVyKCk7CiAgICAgICAgICAgIGNvbnN0IHRvdGFsWkVsZXZhdGlvbiA9IHRoaXMuR2V0VG90YWxaRWxldmF0aW9uKCk7CiAgICAgICAgICAgIGlmICh0b3RhbFpFbGV2YXRpb24gPj0gbGF5ZXIuR2V0Q2FtZXJhWigpKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGxheWVyLkdldFZpZXdwb3J0Rm9yWih0b3RhbFpFbGV2YXRpb24sIHRlbXBSZWN0KTsKICAgICAgICAgICAgcmV0dXJuIHRlbXBSZWN0LmludGVyc2VjdHNSZWN0KHRoaXMuR2V0Qm91bmRpbmdCb3goKSkKICAgICAgICB9CiAgICAgICAgSXNJblZpZXdwb3J0M0Qodmlld0ZydXN0dW0pIHsKICAgICAgICAgICAgY29uc3QgYmJveCA9IHRoaXMuR2V0Qm91bmRpbmdCb3goKTsKICAgICAgICAgICAgY29uc3QgbWluWCA9IGJib3guZ2V0TGVmdCgpOwogICAgICAgICAgICBjb25zdCBtYXhYID0gYmJveC5nZXRSaWdodCgpOwogICAgICAgICAgICBjb25zdCBtaW5ZID0gYmJveC5nZXRUb3AoKTsKICAgICAgICAgICAgY29uc3QgbWF4WSA9IGJib3guZ2V0Qm90dG9tKCk7CiAgICAgICAgICAgIGNvbnN0IG1pblogPSB0aGlzLkdldFRvdGFsWkVsZXZhdGlvbigpOwogICAgICAgICAgICBjb25zdCBtYXhaID0gbWluWiArIHRoaXMuR2V0RGVwdGgoKTsKICAgICAgICAgICAgcmV0dXJuIHZpZXdGcnVzdHVtLkNvbnRhaW5zQUFCQihtaW5YLCBtaW5ZLCBtaW5aLCBtYXhYLCBtYXhZLCBtYXhaKQogICAgICAgIH0KICAgICAgICBJc0luVmlld3BvcnQyKCkgewogICAgICAgICAgICBjb25zdCBsYXllciA9IHRoaXMuR2V0TGF5ZXIoKTsKICAgICAgICAgICAgaWYgKGxheWVyLkhhczNEQ2FtZXJhKCkpIHJldHVybiB0aGlzLklzSW5WaWV3cG9ydDNEKGxheWVyLl9HZXRWaWV3RnJ1c3R1bSgpKTsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBjb25zdCBsYXlvdXQgPSBsYXllci5HZXRMYXlvdXQoKTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLklzSW5WaWV3cG9ydChsYXllci5HZXRWaWV3cG9ydCgpLCBsYXlvdXQuSGFzVmFuaXNoaW5nUG9pbnRPdXRzaWRlVmlld3BvcnQoKSwgbGF5b3V0LklzT3J0aG9ncmFwaGljUHJvamVjdGlvbigpKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIF9TZXREcmF3QmFja0ZhY2VPbmx5KGUpIHsKICAgICAgICAgICAgdGhpcy5fU2V0RmxhZyhGTEFHX0RSQVdfQkFDS19GQUNFX09OTFksCiAgICAgICAgICAgICAgICBlKQogICAgICAgIH0KICAgICAgICBfU2V0RHJhd05vbkJhY2tGYWNlc09ubHkoZSkgewogICAgICAgICAgICB0aGlzLl9TZXRGbGFnKEZMQUdfRFJBV19OT05fQkFDS19GQUNFU19PTkxZLCBlKQogICAgICAgIH0KICAgICAgICBJc0RyYXdCYWNrRmFjZU9ubHkoKSB7CiAgICAgICAgICAgIHJldHVybiAodGhpcy5fZmxhZ3MgJiBGTEFHX0RSQVdfQkFDS19GQUNFX09OTFkpICE9PSAwCiAgICAgICAgfQogICAgICAgIElzRHJhd05vbkJhY2tGYWNlc09ubHkoKSB7CiAgICAgICAgICAgIHJldHVybiAodGhpcy5fZmxhZ3MgJiBGTEFHX0RSQVdfTk9OX0JBQ0tfRkFDRVNfT05MWSkgIT09IDAKICAgICAgICB9CiAgICAgICAgU2V0U291cmNlQ29sbGlzaW9uUG9seShwb2x5KSB7CiAgICAgICAgICAgIHRoaXMuX3NvdXJjZUNvbGxpc2lvblBvbHkgPSBwb2x5OwogICAgICAgICAgICB0aGlzLl9EaXNjYXJkVHJhbnNmb3JtZWRDb2xsaXNpb25Qb2x5KCk7CiAgICAgICAgICAgIGlmICh0aGlzLkhhc01lc2goKSkgdGhpcy5fbWVzaEluZm8ubWVzaFBvbHkgPSBudWxsCiAgICAgICAgfQogICAgICAgIEdldFNvdXJjZUNvbGxpc2lvblBvbHkoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zb3VyY2VDb2xsaXNpb25Qb2x5CiAgICAgICAgfQogICAgICAgIEhhc093bkNvbGxpc2lvblBvbHkoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zb3VyY2VDb2xsaXNpb25Qb2x5ICE9PSBudWxsIHx8IHRoaXMuSGFzTWVzaCgpCiAgICAgICAgfQogICAgICAgIEdldFRyYW5zZm9ybWVkQ29sbGlzaW9uUG9seSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX0dldEN1c3RvbVRyYW5zZm9ybWVkQ29sbGlzaW9uUG9seVByZWNhbGModGhpcy5HZXRXaWR0aCgpLAogICAgICAgICAgICAgICAgdGhpcy5HZXRIZWlnaHQoKSwgdGhpcy5HZXRBbmdsZSgpLCB0aGlzLkdldFNpbkFuZ2xlKCksIHRoaXMuR2V0Q29zQW5nbGUoKSkKICAgICAgICB9CiAgICAgICAgR2V0Q3VzdG9tVHJhbnNmb3JtZWRDb2xsaXNpb25Qb2x5KHcsIGgsIGEpIHsKICAgICAgICAgICAgbGV0IHNpbmEgPSAwOwogICAgICAgICAgICBsZXQgY29zYSA9IDE7CiAgICAgICAgICAgIGlmIChhICE9PSAwKSB7CiAgICAgICAgICAgICAgICBzaW5hID0gTWF0aC5zaW4oYSk7CiAgICAgICAgICAgICAgICBjb3NhID0gTWF0aC5jb3MoYSkKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdGhpcy5fR2V0Q3VzdG9tVHJhbnNmb3JtZWRDb2xsaXNpb25Qb2x5UHJlY2FsYyh3LCBoLCBhLCBzaW5hLCBjb3NhKQogICAgICAgIH0KICAgICAgICBfR2V0Q3VzdG9tVHJhbnNmb3JtZWRDb2xsaXNpb25Qb2x5UHJlY2FsYyh3LCBoLCBhLCBzaW5BLCBjb3NBKSB7CiAgICAgICAgICAgIGxldCB0cGkgPSB0aGlzLl90cmFuc2Zvcm1lZFBvbHlJbmZvOwogICAgICAgICAgICBpZiAodHBpID09PSBudWxsKSB7CiAgICAgICAgICAgICAgICB0cGkgPSB7CiAgICAgICAgICAgICAgICAgICAgcG9seTogQzMuTmV3KEMzLkNvbGxpc2lvblBvbHkpLAogICAgICAgICAgICAgICAgICAgIHdpZHRoOiBOYU4sCiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBOYU4sCiAgICAgICAgICAgICAgICAgICAgYW5nbGU6IE5hTgogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIHRoaXMuX3RyYW5zZm9ybWVkUG9seUluZm8gPSB0cGkKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCB0cmFuc2Zvcm1lZFBvbHkgPSB0cGkucG9seTsKICAgICAgICAgICAgaWYgKHRwaS53aWR0aCA9PT0KICAgICAgICAgICAgICAgIHcgJiYgdHBpLmhlaWdodCA9PT0gaCAmJiB0cGkuYW5nbGUgPT09IGEpIHJldHVybiB0cmFuc2Zvcm1lZFBvbHk7CiAgICAgICAgICAgIGNvbnN0IHNvdXJjZVBvbHkgPSB0aGlzLl9zb3VyY2VDb2xsaXNpb25Qb2x5OwogICAgICAgICAgICBpZiAodGhpcy5IYXNNZXNoKCkpIHsKICAgICAgICAgICAgICAgIGNvbnN0IG94ID0gdGhpcy5HZXRPcmlnaW5YKCk7CiAgICAgICAgICAgICAgICBjb25zdCBveSA9IHRoaXMuR2V0T3JpZ2luWSgpOwogICAgICAgICAgICAgICAgY29uc3Qgc291cmNlTWVzaCA9IHRoaXMuR2V0U291cmNlTWVzaCgpOwogICAgICAgICAgICAgICAgbGV0IG1lc2hQb2x5ID0gdGhpcy5fbWVzaEluZm8ubWVzaFBvbHk7CiAgICAgICAgICAgICAgICBpZiAoIW1lc2hQb2x5KSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHNvdXJjZVBvbHkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGVtcENvbGxpc2lvblBvbHkuY29weShzb3VyY2VQb2x5KTsKICAgICAgICAgICAgICAgICAgICAgICAgdGVtcENvbGxpc2lvblBvbHkub2Zmc2V0KG94LCBveSkKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgdGVtcENvbGxpc2lvblBvbHkuc2V0RGVmYXVsdFBvaW50cygpOwogICAgICAgICAgICAgICAgICAgIG1lc2hQb2x5ID0gc291cmNlTWVzaC5JbnNlcnRQb2x5TWVzaFZlcnRpY2VzKHRlbXBDb2xsaXNpb25Qb2x5KTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9tZXNoSW5mby5tZXNoUG9seSA9IG1lc2hQb2x5CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzb3VyY2VNZXNoLlRyYW5zZm9ybUNvbGxpc2lvblBvbHkobWVzaFBvbHksCiAgICAgICAgICAgICAgICAgICAgdHJhbnNmb3JtZWRQb2x5KTsKICAgICAgICAgICAgICAgIHRyYW5zZm9ybWVkUG9seS5vZmZzZXQoLW94LCAtb3kpOwogICAgICAgICAgICAgICAgdHJhbnNmb3JtZWRQb2x5LnRyYW5zZm9ybVByZWNhbGModywgaCwgc2luQSwgY29zQSkKICAgICAgICAgICAgfSBlbHNlIGlmIChzb3VyY2VQb2x5KSB7CiAgICAgICAgICAgICAgICB0cmFuc2Zvcm1lZFBvbHkuY29weShzb3VyY2VQb2x5KTsKICAgICAgICAgICAgICAgIHRyYW5zZm9ybWVkUG9seS50cmFuc2Zvcm1QcmVjYWxjKHcsIGgsIHNpbkEsIGNvc0EpCiAgICAgICAgICAgIH0gZWxzZSB0cmFuc2Zvcm1lZFBvbHkuc2V0RnJvbVF1YWQodGhpcy5HZXRCb3VuZGluZ1F1YWQoKSwgLXRoaXMuR2V0WCgpLCAtdGhpcy5HZXRZKCkpOwogICAgICAgICAgICB0cGkud2lkdGggPSB3OwogICAgICAgICAgICB0cGkuaGVpZ2h0ID0gaDsKICAgICAgICAgICAgdHBpLmFuZ2xlID0gYTsKICAgICAgICAgICAgcmV0dXJuIHRyYW5zZm9ybWVkUG9seQogICAgICAgIH0KICAgICAgICBfRGlzY2FyZFRyYW5zZm9ybWVkQ29sbGlzaW9uUG9seSgpIHsKICAgICAgICAgICAgdGhpcy5TZXRQaHlzaWNzQm9keUNoYW5nZWQodHJ1ZSk7CiAgICAgICAgICAgIGNvbnN0IHRwaSA9IHRoaXMuX3RyYW5zZm9ybWVkUG9seUluZm87CiAgICAgICAgICAgIGlmICh0cGkgPT09IG51bGwpIHJldHVybjsKICAgICAgICAgICAgdHBpLndpZHRoID0gTmFOCiAgICAgICAgfQogICAgICAgIENyZWF0ZU1lc2goaHNpemUsIHZzaXplKSB7CiAgICAgICAgICAgIGhzaXplID0KICAgICAgICAgICAgICAgIE1hdGguZmxvb3IoaHNpemUpOwogICAgICAgICAgICB2c2l6ZSA9IE1hdGguZmxvb3IodnNpemUpOwogICAgICAgICAgICBpZiAoIXRoaXMuR2V0SW5zdGFuY2UoKS5HZXRQbHVnaW4oKS5TdXBwb3J0c01lc2goKSkgdGhyb3cgbmV3IEVycm9yKCJvYmplY3QgZG9lcyBub3Qgc3VwcG9ydCBtZXNoIik7CiAgICAgICAgICAgIHRoaXMuUmVsZWFzZU1lc2goKTsKICAgICAgICAgICAgdGhpcy5fbWVzaEluZm8gPSB7CiAgICAgICAgICAgICAgICBzb3VyY2VNZXNoOiBDMy5OZXcoQzMuR2Z4Lk1lc2gsIGhzaXplLCB2c2l6ZSksCiAgICAgICAgICAgICAgICB0cmFuc2Zvcm1lZE1lc2g6IEMzLk5ldyhDMy5HZnguTWVzaCwgaHNpemUsIHZzaXplKSwKICAgICAgICAgICAgICAgIG1lc2hQb2x5OiBudWxsCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgSGFzTWVzaCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX21lc2hJbmZvICE9PSBudWxsCiAgICAgICAgfQogICAgICAgIEdldFNvdXJjZU1lc2goKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5IYXNNZXNoKCkpIHRocm93IG5ldyBFcnJvcigibm8gbWVzaCIpOwogICAgICAgICAgICByZXR1cm4gdGhpcy5fbWVzaEluZm8uc291cmNlTWVzaAogICAgICAgIH0KICAgICAgICBHZXRUcmFuc2Zvcm1lZE1lc2goKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5IYXNNZXNoKCkpIHRocm93IG5ldyBFcnJvcigibm8gbWVzaCIpOwogICAgICAgICAgICByZXR1cm4gdGhpcy5fbWVzaEluZm8udHJhbnNmb3JtZWRNZXNoCiAgICAgICAgfQogICAgICAgIFNldE1lc2hDaGFuZ2VkKGUpIHsKICAgICAgICAgICAgdGhpcy5fU2V0RmxhZyhGTEFHX01FU0hfQ0hBTkdFRCwKICAgICAgICAgICAgICAgIGUpCiAgICAgICAgfQogICAgICAgIElzTWVzaENoYW5nZWQoKSB7CiAgICAgICAgICAgIHJldHVybiAodGhpcy5fZmxhZ3MgJiBGTEFHX01FU0hfQ0hBTkdFRCkgIT09IDAKICAgICAgICB9CiAgICAgICAgU2V0UGh5c2ljc0JvZHlDaGFuZ2VkKGUpIHsKICAgICAgICAgICAgdGhpcy5fU2V0RmxhZyhGTEFHX1BIWVNJQ1NfQk9EWV9DSEFOR0VELCBlKQogICAgICAgIH0KICAgICAgICBJc1BoeXNpY3NCb2R5Q2hhbmdlZCgpIHsKICAgICAgICAgICAgcmV0dXJuICh0aGlzLl9mbGFncyAmIEZMQUdfUEhZU0lDU19CT0RZX0NIQU5HRUQpICE9PSAwCiAgICAgICAgfQogICAgICAgIF9FeHBhbmRCYm94Rm9yTWVzaChiYm94KSB7CiAgICAgICAgICAgIGNvbnN0IHNvdXJjZU1lc2ggPSB0aGlzLl9tZXNoSW5mby5zb3VyY2VNZXNoOwogICAgICAgICAgICBjb25zdCBtaW5YID0gTWF0aC5taW4oc291cmNlTWVzaC5HZXRNaW5YKCksIDApOwogICAgICAgICAgICBjb25zdCBtaW5ZID0gTWF0aC5taW4oc291cmNlTWVzaC5HZXRNaW5ZKCksIDApOwogICAgICAgICAgICBjb25zdCBtYXhYID0gTWF0aC5tYXgoc291cmNlTWVzaC5HZXRNYXhYKCksIDEpOwogICAgICAgICAgICBjb25zdCBtYXhZID0gTWF0aC5tYXgoc291cmNlTWVzaC5HZXRNYXhZKCksIDEpOwogICAgICAgICAgICBjb25zdCB3ID0gYmJveC53aWR0aCgpOwogICAgICAgICAgICBjb25zdCBoID0gYmJveC5oZWlnaHQoKTsKICAgICAgICAgICAgYmJveC5vZmZzZXRMZWZ0KG1pblggKgogICAgICAgICAgICAgICAgdyk7CiAgICAgICAgICAgIGJib3gub2Zmc2V0VG9wKG1pblkgKiBoKTsKICAgICAgICAgICAgYmJveC5vZmZzZXRSaWdodCgobWF4WCAtIDEpICogdyk7CiAgICAgICAgICAgIGJib3gub2Zmc2V0Qm90dG9tKChtYXhZIC0gMSkgKiBoKTsKICAgICAgICAgICAgdGhpcy5fZGVwdGggPSBzb3VyY2VNZXNoLkdldE1heFooKQogICAgICAgIH0KICAgICAgICBSZWxlYXNlTWVzaCgpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLl9tZXNoSW5mbykgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl9tZXNoSW5mby5zb3VyY2VNZXNoLlJlbGVhc2UoKTsKICAgICAgICAgICAgdGhpcy5fbWVzaEluZm8udHJhbnNmb3JtZWRNZXNoLlJlbGVhc2UoKTsKICAgICAgICAgICAgdGhpcy5fbWVzaEluZm8gPSBudWxsOwogICAgICAgICAgICB0aGlzLl9EaXNjYXJkVHJhbnNmb3JtZWRDb2xsaXNpb25Qb2x5KCkKICAgICAgICB9CiAgICAgICAgU2V0TWVzaFBvaW50KGNvbCwgcm93LCBvcHRzKSB7CiAgICAgICAgICAgIGNvbCA9IE1hdGguZmxvb3IoY29sKTsKICAgICAgICAgICAgcm93ID0gTWF0aC5mbG9vcihyb3cpOwogICAgICAgICAgICBjb25zdCBtb2RlID0gb3B0cy5tb2RlIHx8ICJhYnNvbHV0ZSI7CiAgICAgICAgICAgIGlmICghVkFMSURfU0VUX01FU0hfUE9JTlRfTU9ERVMuaGFzKG1vZGUpKSB0aHJvdyBuZXcgRXJyb3IoImludmFsaWQgbW9kZSIpOwogICAgICAgICAgICBjb25zdCBpc1JlbGF0aXZlID0gbW9kZSA9PT0gInJlbGF0aXZlIjsKICAgICAgICAgICAgbGV0IHBvc3ggPSBvcHRzLng7CiAgICAgICAgICAgIGxldCBwb3N5ID0gb3B0cy55OwogICAgICAgICAgICBjb25zdCB6RWxldmF0aW9uID0gb3B0cy56RWxldmF0aW9uOwogICAgICAgICAgICBsZXQgdGV4dSA9IHR5cGVvZiBvcHRzLnUgPT09ICJudW1iZXIiID8gb3B0cy51IDogaXNSZWxhdGl2ZSA/IDAgOiAtMTsKICAgICAgICAgICAgbGV0IHRleHYgPSB0eXBlb2Ygb3B0cy52ID09PSAibnVtYmVyIiA/IG9wdHMudiA6IGlzUmVsYXRpdmUgPyAwIDogLTE7CiAgICAgICAgICAgIGlmICghdGhpcy5IYXNNZXNoKCkpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgY29uc3Qgc291cmNlTWVzaCA9IHRoaXMuR2V0U291cmNlTWVzaCgpOwogICAgICAgICAgICBjb25zdCBwID0gc291cmNlTWVzaC5HZXRNZXNoUG9pbnRBdChjb2wsIHJvdyk7CiAgICAgICAgICAgIGlmIChwID09PSBudWxsKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGxldCByZXQgPSBmYWxzZTsKICAgICAgICAgICAgaWYgKHR5cGVvZiB6RWxldmF0aW9uID09PSAibnVtYmVyIiAmJiBwLkdldFpFbGV2YXRpb24oKSAhPT0gekVsZXZhdGlvbikgewogICAgICAgICAgICAgICAgcC5TZXRaRWxldmF0aW9uKHpFbGV2YXRpb24pOwogICAgICAgICAgICAgICAgcmV0ID0gdHJ1ZQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChpc1JlbGF0aXZlKSB7CiAgICAgICAgICAgICAgICBwb3N4ICs9IGNvbCAvIChzb3VyY2VNZXNoLkdldEhTaXplKCkgLSAxKTsKICAgICAgICAgICAgICAgIHBvc3kgKz0gcm93IC8gKHNvdXJjZU1lc2guR2V0VlNpemUoKSAtCiAgICAgICAgICAgICAgICAgICAgMSkKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGV4dSA9PT0gLTEgJiYgIWlzUmVsYXRpdmUpIHRleHUgPSBwLkdldFUoKTsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAoaXNSZWxhdGl2ZSkgdGV4dSArPSBjb2wgLyAoc291cmNlTWVzaC5HZXRIU2l6ZSgpIC0gMSk7CiAgICAgICAgICAgICAgICB0ZXh1ID0gQzMuY2xhbXAodGV4dSwgMCwgMSkKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGV4diA9PT0gLTEgJiYgIWlzUmVsYXRpdmUpIHRleHYgPSBwLkdldFYoKTsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAoaXNSZWxhdGl2ZSkgdGV4diArPSByb3cgLyAoc291cmNlTWVzaC5HZXRWU2l6ZSgpIC0gMSk7CiAgICAgICAgICAgICAgICB0ZXh2ID0gQzMuY2xhbXAodGV4diwgMCwgMSkKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAocC5HZXRYKCkgPT09IHBvc3ggJiYgcC5HZXRZKCkgPT09IHBvc3kgJiYgcC5HZXRVKCkgPT09IHRleHUgJiYgcC5HZXRWKCkgPT09IHRleHYpIHJldHVybiByZXQ7CiAgICAgICAgICAgIHAuU2V0WChwb3N4KTsKICAgICAgICAgICAgcC5TZXRZKHBvc3kpOwogICAgICAgICAgICBwLlNldFUodGV4dSk7CiAgICAgICAgICAgIHAuU2V0Vih0ZXh2KTsKICAgICAgICAgICAgdGhpcy5fRGlzY2FyZFRyYW5zZm9ybWVkQ29sbGlzaW9uUG9seSgpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgIH0KICAgICAgICBIYXNUaWxlbWFwKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faW5zdC5IYXNUaWxlbWFwKCkKICAgICAgICB9CiAgICAgICAgQ29udGFpbnNQb2ludCh4LCB5KSB7CiAgICAgICAgICAgIGlmICghdGhpcy5HZXRCb3VuZGluZ0JveCgpLmNvbnRhaW5zUG9pbnQoeCwKICAgICAgICAgICAgICAgICAgICB5KSkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBpZiAoIXRoaXMuR2V0Qm91bmRpbmdRdWFkKCkuY29udGFpbnNQb2ludCh4LCB5KSkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBpZiAodGhpcy5IYXNUaWxlbWFwKCkpIHJldHVybiB0aGlzLl9pbnN0LkdldFNka0luc3RhbmNlKCkuVGVzdFBvaW50T3ZlcmxhcFRpbGUoeCwgeSk7CiAgICAgICAgICAgIGlmICghdGhpcy5IYXNPd25Db2xsaXNpb25Qb2x5KCkpIHJldHVybiB0cnVlOwogICAgICAgICAgICByZXR1cm4gdGhpcy5HZXRUcmFuc2Zvcm1lZENvbGxpc2lvblBvbHkoKS5jb250YWluc1BvaW50KHggLSB0aGlzLkdldFgoKSwgeSAtIHRoaXMuR2V0WSgpKQogICAgICAgIH0KICAgICAgICBfSXNDb2xsaXNpb25DZWxsQ2hhbmdlZCgpIHsKICAgICAgICAgICAgcmV0dXJuICh0aGlzLl9mbGFncyAmIEZMQUdfQ09MTElTSU9OX0NFTExfQ0hBTkdFRCkgIT09IDAKICAgICAgICB9CiAgICAgICAgX1VwZGF0ZUNvbGxpc2lvbkNlbGwoKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5fSXNDb2xsaXNpb25DZWxsQ2hhbmdlZCgpIHx8ICF0aGlzLklzQ29sbGlzaW9uRW5hYmxlZCgpIHx8ICh0aGlzLl9mbGFncyAmIEZMQUdfREVTVFJPWUVEKSAhPT0gMCkgcmV0dXJuOwogICAgICAgICAgICBjb25zdCBiYm94ID0KICAgICAgICAgICAgICAgIHRoaXMuR2V0Qm91bmRpbmdCb3goKTsKICAgICAgICAgICAgY29uc3QgZ3JpZCA9IHRoaXMuX29iamVjdENsYXNzLl9HZXRDb2xsaXNpb25DZWxsR3JpZCgpOwogICAgICAgICAgICBjb25zdCBjb2xsaXNpb25DZWxscyA9IHRoaXMuX2NvbGxpc2lvbkNlbGxzOwogICAgICAgICAgICB0ZW1wUmVjdC5zZXQoZ3JpZC5YVG9DZWxsKGJib3guZ2V0TGVmdCgpKSwgZ3JpZC5ZVG9DZWxsKGJib3guZ2V0VG9wKCkpLCBncmlkLlhUb0NlbGwoYmJveC5nZXRSaWdodCgpKSwgZ3JpZC5ZVG9DZWxsKGJib3guZ2V0Qm90dG9tKCkpKTsKICAgICAgICAgICAgaWYgKGNvbGxpc2lvbkNlbGxzLmVxdWFscyh0ZW1wUmVjdCkpIHJldHVybjsKICAgICAgICAgICAgY29uc3QgaW5zdCA9IHRoaXMuX2luc3Q7CiAgICAgICAgICAgIGlmIChjb2xsaXNpb25DZWxscyA9PT0gREVGQVVMVF9DT0xMSVNJT05fQ0VMTFMpIHsKICAgICAgICAgICAgICAgIGdyaWQuVXBkYXRlKGluc3QsIG51bGwsIHRlbXBSZWN0KTsKICAgICAgICAgICAgICAgIHRoaXMuX2NvbGxpc2lvbkNlbGxzID0gQzMuTmV3KEMzLlJlY3QsIHRlbXBSZWN0KQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZ3JpZC5VcGRhdGUoaW5zdCwgY29sbGlzaW9uQ2VsbHMsIHRlbXBSZWN0KTsKICAgICAgICAgICAgICAgIGNvbGxpc2lvbkNlbGxzLmNvcHkodGVtcFJlY3QpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5fZmxhZ3MgJj0KICAgICAgICAgICAgICAgIH5GTEFHX0NPTExJU0lPTl9DRUxMX0NIQU5HRUQKICAgICAgICB9CiAgICAgICAgX1JlbW92ZUZyb21Db2xsaXNpb25DZWxscygpIHsKICAgICAgICAgICAgY29uc3QgY29sbGlzaW9uQ2VsbHMgPSB0aGlzLl9jb2xsaXNpb25DZWxsczsKICAgICAgICAgICAgaWYgKGNvbGxpc2lvbkNlbGxzID09PSBERUZBVUxUX0NPTExJU0lPTl9DRUxMUykgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl9vYmplY3RDbGFzcy5fR2V0Q29sbGlzaW9uQ2VsbEdyaWQoKS5VcGRhdGUodGhpcy5faW5zdCwgY29sbGlzaW9uQ2VsbHMsIG51bGwpOwogICAgICAgICAgICB0aGlzLl9jb2xsaXNpb25DZWxscyA9IERFRkFVTFRfQ09MTElTSU9OX0NFTExTCiAgICAgICAgfQogICAgICAgIF9VcGRhdGVSZW5kZXJDZWxsKCkgewogICAgICAgICAgICBjb25zdCBsYXllciA9IHRoaXMuR2V0TGF5ZXIoKTsKICAgICAgICAgICAgaWYgKCFsYXllci5Vc2VzUmVuZGVyQ2VsbHMoKSB8fCAodGhpcy5fZmxhZ3MgJiBGTEFHX0RFU1RST1lFRCkgIT09IDApIHJldHVybjsKICAgICAgICAgICAgY29uc3QgcmVuZGVyR3JpZCA9IGxheWVyLkdldFJlbmRlckdyaWQoKTsKICAgICAgICAgICAgY29uc3QgYmJveCA9IHRoaXMuR2V0Qm91bmRpbmdCb3goKTsKICAgICAgICAgICAgY29uc3QgcmVuZGVyQ2VsbHMgPSB0aGlzLl9yZW5kZXJDZWxsczsKICAgICAgICAgICAgdGVtcFJlY3Quc2V0KHJlbmRlckdyaWQuWFRvQ2VsbChiYm94LmdldExlZnQoKSksIHJlbmRlckdyaWQuWVRvQ2VsbChiYm94LmdldFRvcCgpKSwgcmVuZGVyR3JpZC5YVG9DZWxsKGJib3guZ2V0UmlnaHQoKSksIHJlbmRlckdyaWQuWVRvQ2VsbChiYm94LmdldEJvdHRvbSgpKSk7CiAgICAgICAgICAgIGlmIChyZW5kZXJDZWxscy5lcXVhbHModGVtcFJlY3QpKSByZXR1cm47CiAgICAgICAgICAgIGNvbnN0IGluc3QgPSB0aGlzLl9pbnN0OwogICAgICAgICAgICBpZiAocmVuZGVyQ2VsbHMgPT09IERFRkFVTFRfUkVOREVSX0NFTExTKSB7CiAgICAgICAgICAgICAgICByZW5kZXJHcmlkLlVwZGF0ZShpbnN0LCBudWxsLCB0ZW1wUmVjdCk7CiAgICAgICAgICAgICAgICB0aGlzLl9yZW5kZXJDZWxscyA9IEMzLk5ldyhDMy5SZWN0LCB0ZW1wUmVjdCkKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJlbmRlckdyaWQuVXBkYXRlKGluc3QsIHJlbmRlckNlbGxzLCB0ZW1wUmVjdCk7CiAgICAgICAgICAgICAgICByZW5kZXJDZWxscy5jb3B5KHRlbXBSZWN0KQogICAgICAgICAgICB9CiAgICAgICAgICAgIGxheWVyLlNldFJlbmRlckxpc3RTdGFsZSgpCiAgICAgICAgfQogICAgICAgIF9SZW1vdmVGcm9tUmVuZGVyQ2VsbHMoKSB7CiAgICAgICAgICAgIGNvbnN0IHJlbmRlckNlbGxzID0gdGhpcy5fcmVuZGVyQ2VsbHM7CiAgICAgICAgICAgIGlmIChyZW5kZXJDZWxscyA9PT0gREVGQVVMVF9SRU5ERVJfQ0VMTFMpIHJldHVybjsKICAgICAgICAgICAgdGhpcy5HZXRMYXllcigpLkdldFJlbmRlckdyaWQoKS5VcGRhdGUodGhpcy5faW5zdCwgcmVuZGVyQ2VsbHMsIG51bGwpOwogICAgICAgICAgICB0aGlzLl9yZW5kZXJDZWxscyA9IERFRkFVTFRfUkVOREVSX0NFTExTCiAgICAgICAgfQogICAgICAgIEdldFJlbmRlckNlbGxSYW5nZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3JlbmRlckNlbGxzCiAgICAgICAgfQogICAgICAgIFpPcmRlck1vdmVUb1RvcCgpIHsKICAgICAgICAgICAgY29uc3QgaW5zdCA9IHRoaXMuX2luc3Q7CiAgICAgICAgICAgIGNvbnN0IGxheWVyID0gdGhpcy5fbGF5ZXI7CiAgICAgICAgICAgIGNvbnN0IGxheWVySW5zdGFuY2VzID0gbGF5ZXIuX0dldEluc3RhbmNlcygpOwogICAgICAgICAgICBpZiAobGF5ZXJJbnN0YW5jZXMubGVuZ3RoICYmIGxheWVySW5zdGFuY2VzLmF0KC0xKSA9PT0gaW5zdCkgcmV0dXJuOwogICAgICAgICAgICBsYXllci5fUmVtb3ZlSW5zdGFuY2UoaW5zdCwgZmFsc2UpOwogICAgICAgICAgICBsYXllci5fQWRkSW5zdGFuY2UoaW5zdCwgZmFsc2UpOwogICAgICAgICAgICB0aGlzLl9ydW50aW1lLlVwZGF0ZVJlbmRlcigpCiAgICAgICAgfQogICAgICAgIFpPcmRlck1vdmVUb0JvdHRvbSgpIHsKICAgICAgICAgICAgY29uc3QgaW5zdCA9IHRoaXMuX2luc3Q7CiAgICAgICAgICAgIGNvbnN0IGxheWVyID0gdGhpcy5fbGF5ZXI7CiAgICAgICAgICAgIGNvbnN0IGxheWVySW5zdGFuY2VzID0gbGF5ZXIuX0dldEluc3RhbmNlcygpOwogICAgICAgICAgICBpZiAobGF5ZXJJbnN0YW5jZXMubGVuZ3RoICYmIGxheWVySW5zdGFuY2VzWzBdID09PSBpbnN0KSByZXR1cm47CiAgICAgICAgICAgIGxheWVyLl9SZW1vdmVJbnN0YW5jZShpbnN0LCBmYWxzZSk7CiAgICAgICAgICAgIGxheWVyLl9QcmVwZW5kSW5zdGFuY2UoaW5zdCwgZmFsc2UpOwogICAgICAgICAgICB0aGlzLl9ydW50aW1lLlVwZGF0ZVJlbmRlcigpCiAgICAgICAgfQogICAgICAgIFpPcmRlck1vdmVUb0xheWVyKGxheWVyTW92ZSkgewogICAgICAgICAgICBjb25zdCBpbnN0ID0gdGhpcy5faW5zdDsKICAgICAgICAgICAgY29uc3QgY3VyTGF5ZXIgPSB0aGlzLl9sYXllcjsKICAgICAgICAgICAgaWYgKGN1ckxheWVyLkdldExheW91dCgpICE9PSBsYXllck1vdmUuR2V0TGF5b3V0KCkpIHRocm93IG5ldyBFcnJvcigibGF5ZXIgZnJvbSBkaWZmZXJlbnQgbGF5b3V0Iik7CiAgICAgICAgICAgIGlmIChsYXllck1vdmUgPT09IGN1ckxheWVyKSByZXR1cm47CiAgICAgICAgICAgIGN1ckxheWVyLl9SZW1vdmVJbnN0YW5jZShpbnN0LCB0cnVlKTsKICAgICAgICAgICAgdGhpcy5fU2V0TGF5ZXIobGF5ZXJNb3ZlKTsKICAgICAgICAgICAgbGF5ZXJNb3ZlLl9BZGRJbnN0YW5jZShpbnN0LAogICAgICAgICAgICAgICAgdHJ1ZSk7CiAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuVXBkYXRlUmVuZGVyKCkKICAgICAgICB9CiAgICAgICAgWk9yZGVyTW92ZUFkamFjZW50VG9JbnN0YW5jZShvdGhlckluc3QsIGlzQWZ0ZXIpIHsKICAgICAgICAgICAgY29uc3QgaW5zdCA9IHRoaXMuX2luc3Q7CiAgICAgICAgICAgIGxldCBkaWRDaGFuZ2VMYXllciA9IGZhbHNlOwogICAgICAgICAgICBjb25zdCBjdXJMYXllciA9IHRoaXMuX2xheWVyOwogICAgICAgICAgICBpZiAob3RoZXJJbnN0LkdldFVJRCgpID09PSBpbnN0LkdldFVJRCgpKSByZXR1cm47CiAgICAgICAgICAgIGNvbnN0IG90aGVyV2kgPSBvdGhlckluc3QuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgIGlmICghb3RoZXJXaSkgdGhyb3cgbmV3IEVycm9yKCJleHBlY3RlZCB3b3JsZCBpbnN0YW5jZSIpOwogICAgICAgICAgICBjb25zdCBvdGhlckxheWVyID0gb3RoZXJXaS5HZXRMYXllcigpOwogICAgICAgICAgICBpZiAoY3VyTGF5ZXIuR2V0SW5kZXgoKSAhPT0gb3RoZXJMYXllci5HZXRJbmRleCgpKSB7CiAgICAgICAgICAgICAgICBjdXJMYXllci5fUmVtb3ZlSW5zdGFuY2UoaW5zdCwgdHJ1ZSk7CiAgICAgICAgICAgICAgICB0aGlzLl9TZXRMYXllcihvdGhlckxheWVyKTsKICAgICAgICAgICAgICAgIG90aGVyTGF5ZXIuX0FkZEluc3RhbmNlKGluc3QsIHRydWUpOwogICAgICAgICAgICAgICAgZGlkQ2hhbmdlTGF5ZXIgPSB0cnVlCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgZGlkQ2hhbmdlWk9yZGVyID0KICAgICAgICAgICAgICAgIG90aGVyTGF5ZXIuTW92ZUluc3RhbmNlQWRqYWNlbnQoaW5zdCwgb3RoZXJJbnN0LCAhIWlzQWZ0ZXIpOwogICAgICAgICAgICBpZiAoZGlkQ2hhbmdlTGF5ZXIgfHwgZGlkQ2hhbmdlWk9yZGVyKSB0aGlzLl9ydW50aW1lLlVwZGF0ZVJlbmRlcigpCiAgICAgICAgfQogICAgICAgIEdldEluc3RhbmNlRWZmZWN0TGlzdCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2luc3RhbmNlRWZmZWN0TGlzdAogICAgICAgIH0KICAgICAgICBfU2V0SGFzQW55QWN0aXZlRWZmZWN0KGUpIHsKICAgICAgICAgICAgdGhpcy5fU2V0RmxhZyhGTEFHX0hBU19BTllfQUNUSVZFX0VGRkVDVCwgZSkKICAgICAgICB9CiAgICAgICAgSGFzQW55QWN0aXZlRWZmZWN0KCkgewogICAgICAgICAgICByZXR1cm4gKHRoaXMuX2ZsYWdzICYgRkxBR19IQVNfQU5ZX0FDVElWRV9FRkZFQ1QpICE9PSAwCiAgICAgICAgfQogICAgICAgIF9TYXZlVG9Kc29uKG1vZGUpIHsKICAgICAgICAgICAgY29uc3QgbyA9IHsKICAgICAgICAgICAgICAgICJ4IjogdGhpcy5HZXRYKCksCiAgICAgICAgICAgICAgICAieSI6IHRoaXMuR2V0WSgpLAogICAgICAgICAgICAgICAgInciOiB0aGlzLkdldFdpZHRoKCksCiAgICAgICAgICAgICAgICAiaCI6IHRoaXMuR2V0SGVpZ2h0KCksCiAgICAgICAgICAgICAgICAibCI6IHRoaXMuR2V0TGF5ZXIoKS5HZXRTSUQoKSwKICAgICAgICAgICAgICAgICJ6aSI6IHRoaXMuR2V0WkluZGV4KCkKICAgICAgICAgICAgfTsKICAgICAgICAgICAgaWYgKHRoaXMuR2V0WkVsZXZhdGlvbigpICE9PSAwKSBvWyJ6ZSJdID0KICAgICAgICAgICAgICAgIHRoaXMuR2V0WkVsZXZhdGlvbigpOwogICAgICAgICAgICBpZiAodGhpcy5HZXRBbmdsZSgpICE9PSAwKSBvWyJhIl0gPSB0aGlzLkdldEFuZ2xlKCk7CiAgICAgICAgICAgIGlmICghdGhpcy5IYXNEZWZhdWx0Q29sb3IoKSkgb1siYyJdID0gdGhpcy5fY29sb3IudG9KU09OKCk7CiAgICAgICAgICAgIGlmICh0aGlzLkdldE9yaWdpblgoKSAhPT0gLjUpIG9bIm9YIl0gPSB0aGlzLkdldE9yaWdpblgoKTsKICAgICAgICAgICAgaWYgKHRoaXMuR2V0T3JpZ2luWSgpICE9PSAuNSkgb1sib1kiXSA9IHRoaXMuR2V0T3JpZ2luWSgpOwogICAgICAgICAgICBpZiAodGhpcy5HZXRCbGVuZE1vZGUoKSAhPT0gMCkgb1siYm0iXSA9IHRoaXMuR2V0QmxlbmRNb2RlKCk7CiAgICAgICAgICAgIGlmICghdGhpcy5Jc1Zpc2libGUoKSkgb1sidiJdID0gdGhpcy5Jc1Zpc2libGUoKTsKICAgICAgICAgICAgaWYgKCF0aGlzLklzQ29sbGlzaW9uRW5hYmxlZCgpKSBvWyJjZSJdID0gdGhpcy5Jc0NvbGxpc2lvbkVuYWJsZWQoKTsKICAgICAgICAgICAgaWYgKHRoaXMuSXNCYm94Q2hhbmdlRXZlbnRFbmFibGVkKCkpIG9bImJlIl0gPSB0aGlzLklzQmJveENoYW5nZUV2ZW50RW5hYmxlZCgpOwogICAgICAgICAgICBpZiAodGhpcy5faW5zdGFuY2VFZmZlY3RMaXN0KSBvWyJmeCJdID0KICAgICAgICAgICAgICAgIHRoaXMuX2luc3RhbmNlRWZmZWN0TGlzdC5fU2F2ZVRvSnNvbigpOwogICAgICAgICAgICBjb25zdCBpc1NvbGlkRmlsdGVySW5jbHVzaXZlID0gKHRoaXMuX2ZsYWdzICYgRkxBR19TT0xJRF9GSUxURVJfSU5DTFVTSVZFKSAhPT0gMDsKICAgICAgICAgICAgaWYgKGlzU29saWRGaWx0ZXJJbmNsdXNpdmUpIG9bInNmaSJdID0gaXNTb2xpZEZpbHRlckluY2x1c2l2ZTsKICAgICAgICAgICAgaWYgKHRoaXMuX3NvbGlkRmlsdGVyVGFncykgb1sic2Z0Il0gPSBbLi4udGhpcy5fc29saWRGaWx0ZXJUYWdzXS5qb2luKCIgIik7CiAgICAgICAgICAgIGlmICh0aGlzLl9zY2VuZUdyYXBoSW5mbyAmJiBtb2RlICE9PSAidmlzdWFsLXN0YXRlIikgewogICAgICAgICAgICAgICAgb1sic2dpIl0gPSB0aGlzLl9zY2VuZUdyYXBoSW5mby5fU2F2ZVRvSnNvbihtb2RlKTsKICAgICAgICAgICAgICAgIGlmIChzY2VuZUdyYXBoRXhwb3J0RGF0YU1hcC5oYXModGhpcykpIHsKICAgICAgICAgICAgICAgICAgICBvWyJzZ2NkIl0gPSBzY2VuZUdyYXBoRXhwb3J0RGF0YU1hcC5nZXQodGhpcykuY2hpbGRyZW5EYXRhOwogICAgICAgICAgICAgICAgICAgIG9bInNnemlkIl0gPSBzY2VuZUdyYXBoRXhwb3J0RGF0YU1hcC5nZXQodGhpcykuekluZGV4RGF0YQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLkhhc01lc2goKSkgb1sibWVzaCJdID0KICAgICAgICAgICAgICAgIHRoaXMuR2V0U291cmNlTWVzaCgpLlNhdmVUb0pzb24oKTsKICAgICAgICAgICAgcmV0dXJuIG8KICAgICAgICB9CiAgICAgICAgX1NhdmVTY2VuZUdyYXBoUHJvcGVydGllc1RvSnNvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICJ4IjogdGhpcy5feCwKICAgICAgICAgICAgICAgICJ5IjogdGhpcy5feSwKICAgICAgICAgICAgICAgICJ6IjogdGhpcy5fekVsZXZhdGlvbiwKICAgICAgICAgICAgICAgICJ3IjogdGhpcy5fdywKICAgICAgICAgICAgICAgICJoIjogdGhpcy5faCwKICAgICAgICAgICAgICAgICJhIjogdGhpcy5fYQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIF9Mb2FkU2NlbmVHcmFwaFByb3BlcnRpZXNGcm9tSnNvbihvKSB7CiAgICAgICAgICAgIGlmICghbykgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl94ID0gb1sieCJdOwogICAgICAgICAgICB0aGlzLl95ID0gb1sieSJdOwogICAgICAgICAgICB0aGlzLl96RWxldmF0aW9uID0gb1sieiJdOwogICAgICAgICAgICB0aGlzLl93ID0gb1sidyJdOwogICAgICAgICAgICB0aGlzLl9oID0gb1siaCJdOwogICAgICAgICAgICB0aGlzLl9hID0gb1siYSJdOwogICAgICAgICAgICB0aGlzLl9NYXJrU2luQ29zQW5nbGVDaGFuZ2VkKCk7CiAgICAgICAgICAgIHRoaXMuU2V0QmJveENoYW5nZWQoKQogICAgICAgIH0KICAgICAgICBfU2V0dXBTY2VuZUdyYXBoQ29ubmVjdGlvbnNPbkNoYW5nZU9mTGF5b3V0KCkgewogICAgICAgICAgICB0aGlzLl9SZWxlYXNlVG1wU2NlbmVHcmFwaEluZm8oKTsKICAgICAgICAgICAgdGhpcy5fUmVzZXRBbGxTY2VuZUdyYXBoU3RhdGUoKTsKICAgICAgICAgICAgdGhpcy5fQ3JlYXRlU2NlbmVHcmFwaEluZm8obnVsbCk7CiAgICAgICAgICAgIGlmICh0aGlzLl9zY2VuZUdyYXBoSW5mbykgdGhpcy5fc2NlbmVHcmFwaEluZm8uX1NldFRtcFNjZW5lR3JhcGhDaGlsZHJlbih0aGlzLl90bXBTY2VuZUdyYXBoQ2hpbGRyZW4sIHRoaXMuX3RtcFNjZW5lR3JhcGhDaGlsZHJlbkluZGV4ZXMpCiAgICAgICAgfQogICAgICAgIF9PbkJlZm9yZUxvYWQobW9kZSkgewogICAgICAgICAgICBpZiAobW9kZSAhPT0gInZpc3VhbC1zdGF0ZSIpIHRoaXMuX1Jlc2V0QWxsU2NlbmVHcmFwaFN0YXRlKCkKICAgICAgICB9CiAgICAgICAgX0xvYWRGcm9tSnNvbihvLCBtb2RlKSB7CiAgICAgICAgICAgIGVuYWJsZVVwZGF0ZVJlbmRlcmVyU3RhdGVHcm91cCA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLlNldFgob1sieCJdKTsKICAgICAgICAgICAgdGhpcy5TZXRZKG9bInkiXSk7CiAgICAgICAgICAgIHRoaXMuU2V0V2lkdGgob1sidyJdKTsKICAgICAgICAgICAgdGhpcy5TZXRIZWlnaHQob1siaCJdKTsKICAgICAgICAgICAgdGhpcy5fU2V0WkluZGV4KG9bInppIl0pOwogICAgICAgICAgICB0aGlzLlNldFpFbGV2YXRpb24oby5oYXNPd25Qcm9wZXJ0eSgiemUiKSA/IG9bInplIl0gOiAwKTsKICAgICAgICAgICAgdGhpcy5TZXRBbmdsZShvLmhhc093blByb3BlcnR5KCJhIikgPyBvWyJhIl0gOiAwKTsKICAgICAgICAgICAgaWYgKG8uaGFzT3duUHJvcGVydHkoImMiKSkgdGVtcENvbG9yLnNldEZyb21KU09OKG9bImMiXSk7CiAgICAgICAgICAgIGVsc2UgaWYgKG8uaGFzT3duUHJvcGVydHkoIm8iKSkgewogICAgICAgICAgICAgICAgdGVtcENvbG9yLmNvcHlSZ2IodGhpcy5fY29sb3IpOwogICAgICAgICAgICAgICAgdGVtcENvbG9yLmEgPSBvWyJvIl0KICAgICAgICAgICAgfSBlbHNlIHRlbXBDb2xvci5zZXRSZ2JhKDEsIDEsIDEsIDEpOwogICAgICAgICAgICB0aGlzLl9TZXRDb2xvcih0ZW1wQ29sb3IpOwogICAgICAgICAgICB0aGlzLlNldE9yaWdpblgoby5oYXNPd25Qcm9wZXJ0eSgib1giKSA/IG9bIm9YIl0gOiAuNSk7CiAgICAgICAgICAgIHRoaXMuU2V0T3JpZ2luWShvLmhhc093blByb3BlcnR5KCJvWSIpID8gb1sib1kiXSA6IC41KTsKICAgICAgICAgICAgdGhpcy5TZXRCbGVuZE1vZGUoby5oYXNPd25Qcm9wZXJ0eSgiYm0iKSA/IG9bImJtIl0gOiAwKTsKICAgICAgICAgICAgdGhpcy5TZXRWaXNpYmxlKG8uaGFzT3duUHJvcGVydHkoInYiKSA/IG9bInYiXSA6IHRydWUpOwogICAgICAgICAgICB0aGlzLlNldENvbGxpc2lvbkVuYWJsZWQoby5oYXNPd25Qcm9wZXJ0eSgiY2UiKSA/IG9bImNlIl0gOiB0cnVlKTsKICAgICAgICAgICAgdGhpcy5TZXRCYm94Q2hhbmdlRXZlbnRFbmFibGVkKG8uaGFzT3duUHJvcGVydHkoImJlIikgPyBvWyJiZSJdIDogZmFsc2UpOwogICAgICAgICAgICB0aGlzLlNldFNvbGlkQ29sbGlzaW9uRmlsdGVyKG8uaGFzT3duUHJvcGVydHkoInNmaSIpID8KICAgICAgICAgICAgICAgIG9bInNmaSJdIDogZmFsc2UsIG8uaGFzT3duUHJvcGVydHkoInNmdCIpID8gb1sic2Z0Il0gOiAiIik7CiAgICAgICAgICAgIGlmICh0aGlzLl9pbnN0YW5jZUVmZmVjdExpc3QgJiYgby5oYXNPd25Qcm9wZXJ0eSgiZngiKSkgdGhpcy5faW5zdGFuY2VFZmZlY3RMaXN0Ll9Mb2FkRnJvbUpzb24ob1siZngiXSk7CiAgICAgICAgICAgIGlmICghby5oYXNPd25Qcm9wZXJ0eSgic2dpIikgJiYgbW9kZSAhPT0gInZpc3VhbC1zdGF0ZSIpCiAgICAgICAgICAgICAgICBpZiAodGhpcy5fdG1wU2NlbmVHcmFwaENoaWxkcmVuKQogICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgaW5zdCBvZiB0aGlzLl90bXBTY2VuZUdyYXBoQ2hpbGRyZW4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluc3QuSXNEZXN0cm95ZWQoKSkgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuRGVzdHJveUluc3RhbmNlKGluc3QpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoby5oYXNPd25Qcm9wZXJ0eSgic2dpIikgJiYgbW9kZSAhPT0gInZpc3VhbC1zdGF0ZSIpIHsKICAgICAgICAgICAgICAgIHRoaXMuX0NyZWF0ZVNjZW5lR3JhcGhJbmZvKG51bGwpOwogICAgICAgICAgICAgICAgY29uc3Qgc2dpID0gdGhpcy5fc2NlbmVHcmFwaEluZm87CiAgICAgICAgICAgICAgICBjb25zdCBzZ2lEYXRhID0gb1sic2dpIl07CiAgICAgICAgICAgICAgICBzZ2kuX0xvYWRGcm9tSnNvbihzZ2lEYXRhKTsKICAgICAgICAgICAgICAgIHNnaS5fU2V0VG1wU2NlbmVHcmFwaENoaWxkcmVuKHRoaXMuX3RtcFNjZW5lR3JhcGhDaGlsZHJlbiwgdGhpcy5fdG1wU2NlbmVHcmFwaENoaWxkcmVuSW5kZXhlcyk7CiAgICAgICAgICAgICAgICBuZWVkc1NjZW5lR3JhcGhBZnRlckxvYWQuc2V0KHRoaXMsIHRydWUpOwogICAgICAgICAgICAgICAgY29uc3QgcnVudGltZURpc3BhdGNoZXIgPSB0aGlzLkdldFJ1bnRpbWUoKS5EaXNwYXRjaGVyKCk7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fYWZ0ZXJfbG9hZCkgcnVudGltZURpc3BhdGNoZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcigiYWZ0ZXJsb2FkIiwgdGhpcy5fYWZ0ZXJfbG9hZCk7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fYWZ0ZXJfbG9hZF9pbnN0YW5jZSkgcnVudGltZURpc3BhdGNoZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcigiYWZ0ZXJsb2FkaW5zdGFuY2UiLCB0aGlzLl9hZnRlcl9sb2FkX2luc3RhbmNlKTsKICAgICAgICAgICAgICAgIHRoaXMuX2FmdGVyX2xvYWQgPSBudWxsOwogICAgICAgICAgICAgICAgdGhpcy5fYWZ0ZXJfbG9hZF9pbnN0YW5jZSA9IG51bGw7CiAgICAgICAgICAgICAgICB0aGlzLl9hZnRlcl9sb2FkID0gKGUsIG9wdHMpID0+IHsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fYWZ0ZXJfbG9hZCkgcnVudGltZURpc3BhdGNoZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcigiYWZ0ZXJsb2FkIiwKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fYWZ0ZXJfbG9hZCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX2FmdGVyX2xvYWRfaW5zdGFuY2UpIHJ1bnRpbWVEaXNwYXRjaGVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoImFmdGVybG9hZGluc3RhbmNlIiwgdGhpcy5fYWZ0ZXJfbG9hZF9pbnN0YW5jZSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYWZ0ZXJfbG9hZF9pbnN0YW5jZSA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYWZ0ZXJfbG9hZCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgaWYgKCh0aGlzLl9mbGFncyAmIEZMQUdfREVTVFJPWUVEKSA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBzZ2kuX09uQWZ0ZXJMb2FkKHNnaURhdGEsIG9wdHMpOwogICAgICAgICAgICAgICAgICAgICAgICBzZ2kuX1NldFRtcFNjZW5lR3JhcGhDaGlsZHJlbihudWxsLCBudWxsKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fUmVsZWFzZVRtcFNjZW5lR3JhcGhJbmZvKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuU2V0QmJveENoYW5nZWQoKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB0aGlzLl9hZnRlcl9sb2FkX2luc3RhbmNlID0gZSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGVbImluc3RhbmNlIl0gIT09IHRoaXMuR2V0SW5zdGFuY2UoKSkgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2FmdGVyX2xvYWQoZSwgewogICAgICAgICAgICAgICAgICAgICAgICBpZ25vcmVNaXNzaW5nSW5zdGFuY2VzOiB0cnVlCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBydW50aW1lRGlzcGF0Y2hlci5hZGRFdmVudExpc3RlbmVyKCJhZnRlcmxvYWQiLAogICAgICAgICAgICAgICAgICAgIHRoaXMuX2FmdGVyX2xvYWQpOwogICAgICAgICAgICAgICAgcnVudGltZURpc3BhdGNoZXIuYWRkRXZlbnRMaXN0ZW5lcigiYWZ0ZXJsb2FkaW5zdGFuY2UiLCB0aGlzLl9hZnRlcl9sb2FkX2luc3RhbmNlKTsKICAgICAgICAgICAgICAgIGlmIChvWyJzZ2NkIl0gJiYgQzMuSXNGaW5pdGVOdW1iZXIob1sic2d6aWQiXSkpIHNjZW5lR3JhcGhFeHBvcnREYXRhTWFwLnNldCh0aGlzLCB7CiAgICAgICAgICAgICAgICAgICAgY2hpbGRyZW5EYXRhOiBvWyJzZ2NkIl0sCiAgICAgICAgICAgICAgICAgICAgekluZGV4RGF0YTogb1sic2d6aWQiXQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoby5oYXNPd25Qcm9wZXJ0eSgibWVzaCIpKSB7CiAgICAgICAgICAgICAgICBjb25zdCBtZXNoRGF0YSA9IG9bIm1lc2giXTsKICAgICAgICAgICAgICAgIHRoaXMuQ3JlYXRlTWVzaChtZXNoRGF0YVsiY29scyJdLCBtZXNoRGF0YVsicm93cyJdKTsKICAgICAgICAgICAgICAgIHRoaXMuR2V0U291cmNlTWVzaCgpLkxvYWRGcm9tSnNvbihtZXNoRGF0YSkKICAgICAgICAgICAgfSBlbHNlIHRoaXMuUmVsZWFzZU1lc2goKTsKICAgICAgICAgICAgdGhpcy5TZXRCYm94Q2hhbmdlZCgpOwogICAgICAgICAgICBlbmFibGVVcGRhdGVSZW5kZXJlclN0YXRlR3JvdXAgPSB0cnVlOwogICAgICAgICAgICB0aGlzLl9VcGRhdGVSZW5kZXJlclN0YXRlR3JvdXAoKQogICAgICAgIH0KICAgIH07Cgp9CgovLyBvYmplY3RzL2JlaGF2aW9yVHlwZS5qcwp7CiAgICAndXNlIHN0cmljdCc7CiAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICBDMy5CZWhhdmlvclR5cGUgPSBjbGFzcyBCZWhhdmlvclR5cGUgZXh0ZW5kcyBDMy5EZWZlbmRlZEJhc2UgewogICAgICAgIGNvbnN0cnVjdG9yKG9iamVjdENsYXNzLCBkYXRhKSB7CiAgICAgICAgICAgIHN1cGVyKCk7CiAgICAgICAgICAgIGNvbnN0IHJ1bnRpbWUgPSBvYmplY3RDbGFzcy5HZXRSdW50aW1lKCk7CiAgICAgICAgICAgIGNvbnN0IHBsdWdpbk1hbmFnZXIgPSBydW50aW1lLkdldFBsdWdpbk1hbmFnZXIoKTsKICAgICAgICAgICAgY29uc3QgQmVoYXZpb3JDdG9yID0gcnVudGltZS5HZXRPYmplY3RSZWZlcmVuY2UoZGF0YVsxXSk7CiAgICAgICAgICAgIGlmICghcGx1Z2luTWFuYWdlci5IYXNCZWhhdmlvckJ5Q29uc3RydWN0b3JGdW5jdGlvbihCZWhhdmlvckN0b3IpKSBwbHVnaW5NYW5hZ2VyLkNyZWF0ZUJlaGF2aW9yKGRhdGEpOwogICAgICAgICAgICB0aGlzLl9ydW50aW1lID0gcnVudGltZTsKICAgICAgICAgICAgdGhpcy5fb2JqZWN0Q2xhc3MgPSBvYmplY3RDbGFzczsKICAgICAgICAgICAgdGhpcy5fYmVoYXZpb3IgPSBwbHVnaW5NYW5hZ2VyLkdldEJlaGF2aW9yQnlDb25zdHJ1Y3RvckZ1bmN0aW9uKEJlaGF2aW9yQ3Rvcik7CiAgICAgICAgICAgIHRoaXMuX3Nka1R5cGUgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9pbnN0U2RrQ3RvciA9CiAgICAgICAgICAgICAgICBCZWhhdmlvckN0b3IuSW5zdGFuY2U7CiAgICAgICAgICAgIHRoaXMuX3NpZCA9IGRhdGFbMl07CiAgICAgICAgICAgIHRoaXMuX25hbWUgPSBkYXRhWzBdOwogICAgICAgICAgICB0aGlzLl9qc1Byb3BOYW1lID0gdGhpcy5fcnVudGltZS5HZXRKc1Byb3BOYW1lKGRhdGFbM10pOwogICAgICAgICAgICB0aGlzLl9zZGtUeXBlID0gQzMuTmV3KEJlaGF2aW9yQ3Rvci5UeXBlLCB0aGlzKTsKICAgICAgICAgICAgdGhpcy5PbkNyZWF0ZSgpCiAgICAgICAgfQogICAgICAgIHN0YXRpYyBDcmVhdGUob2JqZWN0Q2xhc3MsIGJlaGF2aW9yVHlwZURhdGEpIHsKICAgICAgICAgICAgcmV0dXJuIEMzLk5ldyhDMy5CZWhhdmlvclR5cGUsIG9iamVjdENsYXNzLCBiZWhhdmlvclR5cGVEYXRhKQogICAgICAgIH0KICAgICAgICBSZWxlYXNlKCkgewogICAgICAgICAgICB0aGlzLl9ydW50aW1lID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fYmVoYXZpb3IgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9zZGtUeXBlLlJlbGVhc2UoKTsKICAgICAgICAgICAgdGhpcy5fc2RrVHlwZSA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX2luc3RTZGtDdG9yID0gbnVsbAogICAgICAgIH0KICAgICAgICBHZXRTZGtUeXBlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fc2RrVHlwZQogICAgICAgIH0KICAgICAgICBPbkNyZWF0ZSgpIHsKICAgICAgICAgICAgdGhpcy5fc2RrVHlwZS5PbkNyZWF0ZSgpCiAgICAgICAgfQogICAgICAgIEdldFJ1bnRpbWUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lCiAgICAgICAgfQogICAgICAgIEdldE9iamVjdENsYXNzKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fb2JqZWN0Q2xhc3MKICAgICAgICB9CiAgICAgICAgR2V0QmVoYXZpb3IoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9iZWhhdmlvcgogICAgICAgIH0KICAgICAgICBHZXRJbnN0YW5jZVNka0N0b3IoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pbnN0U2RrQ3RvcgogICAgICAgIH0KICAgICAgICBHZXROYW1lKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fbmFtZQogICAgICAgIH0KICAgICAgICBHZXRTSUQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zaWQKICAgICAgICB9CiAgICAgICAgR2V0SnNQcm9wTmFtZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2pzUHJvcE5hbWUKICAgICAgICB9CiAgICB9OwoKfQoKLy8gb2JqZWN0cy9iZWhhdmlvckluc3RhbmNlLmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIGNvbnN0IElCZWhhdmlvckluc3RhbmNlID0gc2VsZi5JQmVoYXZpb3JJbnN0YW5jZTsKICAgIEMzLkJlaGF2aW9ySW5zdGFuY2UgPSBjbGFzcyBCZWhhdmlvckluc3RhbmNlIGV4dGVuZHMgQzMuRGVmZW5kZWRCYXNlIHsKICAgICAgICBjb25zdHJ1Y3RvcihvcHRzKSB7CiAgICAgICAgICAgIHN1cGVyKCk7CiAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUgPSBvcHRzLnJ1bnRpbWU7CiAgICAgICAgICAgIHRoaXMuX2JlaGF2aW9yVHlwZSA9IG9wdHMuYmVoYXZpb3JUeXBlOwogICAgICAgICAgICB0aGlzLl9iZWhhdmlvciA9IHRoaXMuX2JlaGF2aW9yVHlwZS5HZXRCZWhhdmlvcigpOwogICAgICAgICAgICB0aGlzLl9pbnN0ID0gb3B0cy5pbnN0YW5jZTsKICAgICAgICAgICAgdGhpcy5faW5kZXggPSBvcHRzLmluZGV4OwogICAgICAgICAgICB0aGlzLl9zZGtJbnN0ID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5faVNjcmlwdEludGVyZmFjZSA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX2JlaGF2aW9yLl9BZGRJbnN0YW5jZSh0aGlzLl9pbnN0KQogICAgICAgIH0KICAgICAgICBSZWxlYXNlKCkgewogICAgICAgICAgICBpZiAodGhpcy5faVNjcmlwdEludGVyZmFjZSkgewogICAgICAgICAgICAgICAgdGhpcy5faVNjcmlwdEludGVyZmFjZS5fUmVsZWFzZSgpOwogICAgICAgICAgICAgICAgdGhpcy5faVNjcmlwdEludGVyZmFjZSA9IG51bGwKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLl9iZWhhdmlvci5fUmVtb3ZlSW5zdGFuY2UodGhpcy5faW5zdCk7CiAgICAgICAgICAgIHRoaXMuX3Nka0luc3QuUmVsZWFzZSgpOwogICAgICAgICAgICB0aGlzLl9zZGtJbnN0ID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fcnVudGltZSA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX2JlaGF2aW9yVHlwZSA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX2JlaGF2aW9yID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5faW5zdCA9IG51bGwKICAgICAgICB9CiAgICAgICAgX0NyZWF0ZVNka0luc3RhbmNlKHByb3BlcnRpZXMpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX3Nka0luc3QpIHRocm93IG5ldyBFcnJvcigiYWxyZWFkeSBnb3Qgc2RrIGluc3RhbmNlIik7CiAgICAgICAgICAgIHRoaXMuX3Nka0luc3QgPSBDMy5OZXcodGhpcy5fYmVoYXZpb3JUeXBlLkdldEluc3RhbmNlU2RrQ3RvcigpLCB0aGlzLCBwcm9wZXJ0aWVzKQogICAgICAgIH0KICAgICAgICBHZXRTZGtJbnN0YW5jZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3Nka0luc3QKICAgICAgICB9CiAgICAgICAgR2V0T2JqZWN0SW5zdGFuY2UoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pbnN0CiAgICAgICAgfQogICAgICAgIEdldFJ1bnRpbWUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lCiAgICAgICAgfQogICAgICAgIEdldEJlaGF2aW9yVHlwZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2JlaGF2aW9yVHlwZQogICAgICAgIH0KICAgICAgICBHZXRCZWhhdmlvcigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2JlaGF2aW9yCiAgICAgICAgfQogICAgICAgIF9HZXRJbmRleCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2luZGV4CiAgICAgICAgfQogICAgICAgIFBvc3RDcmVhdGUoKSB7CiAgICAgICAgICAgIHRoaXMuX3Nka0luc3QuUG9zdENyZWF0ZSgpCiAgICAgICAgfQogICAgICAgIE9uU3ByaXRlRnJhbWVDaGFuZ2VkKHByZXZGcmFtZSwKICAgICAgICAgICAgbmV4dEZyYW1lKSB7CiAgICAgICAgICAgIHRoaXMuX3Nka0luc3QuT25TcHJpdGVGcmFtZUNoYW5nZWQocHJldkZyYW1lLCBuZXh0RnJhbWUpCiAgICAgICAgfQogICAgICAgIF9HZXREZWJ1Z2dlclByb3BlcnRpZXMoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zZGtJbnN0LkdldERlYnVnZ2VyUHJvcGVydGllcygpCiAgICAgICAgfQogICAgICAgIFNhdmVUb0pzb24oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zZGtJbnN0LlNhdmVUb0pzb24oKQogICAgICAgIH0KICAgICAgICBMb2FkRnJvbUpzb24obykgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fc2RrSW5zdC5Mb2FkRnJvbUpzb24obykKICAgICAgICB9CiAgICAgICAgc3RhdGljIFNvcnRCeVRpY2tTZXF1ZW5jZShhLCBiKSB7CiAgICAgICAgICAgIGNvbnN0IGluc3RBID0gYS5HZXRPYmplY3RJbnN0YW5jZSgpOwogICAgICAgICAgICBjb25zdCBpbnN0QiA9IGIuR2V0T2JqZWN0SW5zdGFuY2UoKTsKICAgICAgICAgICAgY29uc3QgdHlwZUluZGV4QSA9IGluc3RBLkdldE9iamVjdENsYXNzKCkuR2V0SW5kZXgoKTsKICAgICAgICAgICAgY29uc3QgdHlwZUluZGV4QiA9IGluc3RCLkdldE9iamVjdENsYXNzKCkuR2V0SW5kZXgoKTsKICAgICAgICAgICAgaWYgKHR5cGVJbmRleEEgIT09IHR5cGVJbmRleEIpIHJldHVybiB0eXBlSW5kZXhBIC0gdHlwZUluZGV4QjsKICAgICAgICAgICAgY29uc3Qgc2VxQSA9CiAgICAgICAgICAgICAgICBpbnN0QS5HZXRQVUlEKCk7CiAgICAgICAgICAgIGNvbnN0IHNlcUIgPSBpbnN0Qi5HZXRQVUlEKCk7CiAgICAgICAgICAgIGlmIChzZXFBICE9PSBzZXFCKSByZXR1cm4gc2VxQSAtIHNlcUI7CiAgICAgICAgICAgIHJldHVybiBhLkdldEJlaGF2aW9ySW5zdGFuY2UoKS5fR2V0SW5kZXgoKSAtIGIuR2V0QmVoYXZpb3JJbnN0YW5jZSgpLl9HZXRJbmRleCgpCiAgICAgICAgfQogICAgICAgIF9Jbml0U2NyaXB0SW50ZXJmYWNlKCkgewogICAgICAgICAgICBjb25zdCBEZWZhdWx0U2NyaXB0Q2xhc3MgPSBJQmVoYXZpb3JJbnN0YW5jZTsKICAgICAgICAgICAgY29uc3QgU2RrU2NyaXB0Q2xhc3MgPSB0aGlzLl9zZGtJbnN0LkdldFNjcmlwdEludGVyZmFjZUNsYXNzKCk7CiAgICAgICAgICAgIGNvbnN0IFNjcmlwdEludGVyZmFjZUNsYXNzID0gU2RrU2NyaXB0Q2xhc3MgfHwgRGVmYXVsdFNjcmlwdENsYXNzOwogICAgICAgICAgICBJQmVoYXZpb3JJbnN0YW5jZS5fSW5pdCh0aGlzKTsKICAgICAgICAgICAgdGhpcy5faVNjcmlwdEludGVyZmFjZSA9IG5ldyBTY3JpcHRJbnRlcmZhY2VDbGFzczsKICAgICAgICAgICAgSUJlaGF2aW9ySW5zdGFuY2UuX0luaXQobnVsbCk7CiAgICAgICAgICAgIGlmIChTZGtTY3JpcHRDbGFzcyAmJiAhKHRoaXMuX2lTY3JpcHRJbnRlcmZhY2UgaW5zdGFuY2VvZiBEZWZhdWx0U2NyaXB0Q2xhc3MpKSB0aHJvdyBuZXcgVHlwZUVycm9yKGBzY3JpcHQgaW50ZXJmYWNlIGNsYXNzICcke1Nka1NjcmlwdENsYXNzLm5hbWV9JyBkb2VzIG5vdCBleHRlbmQgdGhlIHJpZ2h0IGJhc2UgY2xhc3MgJyR7RGVmYXVsdFNjcmlwdENsYXNzLm5hbWV9J2ApOwogICAgICAgICAgICByZXR1cm4gdGhpcy5faVNjcmlwdEludGVyZmFjZQogICAgICAgIH0KICAgICAgICBHZXRTY3JpcHRJbnRlcmZhY2UoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pU2NyaXB0SW50ZXJmYWNlIHx8IHRoaXMuX0luaXRTY3JpcHRJbnRlcmZhY2UoKQogICAgICAgIH0KICAgICAgICBIYXNTY3JpcHRJbnRlcmZhY2UoKSB7CiAgICAgICAgICAgIHJldHVybiAhIXRoaXMuX2lTY3JpcHRJbnRlcmZhY2UKICAgICAgICB9CiAgICB9OwoKfQoKLy8gb2JqZWN0cy9lZmZlY3RMaXN0LmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIEMzLkVmZmVjdExpc3QgPSBjbGFzcyBFZmZlY3RMaXN0IGV4dGVuZHMgQzMuRGVmZW5kZWRCYXNlIHsKICAgICAgICBjb25zdHJ1Y3Rvcihvd25lciwgZGF0YSkgewogICAgICAgICAgICBzdXBlcigpOwogICAgICAgICAgICB0aGlzLl9vd25lciA9IG93bmVyOwogICAgICAgICAgICB0aGlzLl9hbGxFZmZlY3RUeXBlcyA9IFtdOwogICAgICAgICAgICB0aGlzLl9hY3RpdmVFZmZlY3RUeXBlcyA9IFtdOwogICAgICAgICAgICB0aGlzLl9lZmZlY3RUeXBlc0J5TmFtZSA9IG5ldyBNYXA7CiAgICAgICAgICAgIHRoaXMuX2VmZmVjdFBhcmFtcyA9IFtdOwogICAgICAgICAgICB0aGlzLl9lZmZlY3RQYXJhbUJ1ZmZlcnMgPSBbXTsKICAgICAgICAgICAgdGhpcy5fYWxsSW5zdGFuY2VFZmZlY3RMaXN0cyA9IG5ldyBTZXQ7CiAgICAgICAgICAgIHRoaXMuX3ByZXNlcnZlc09wYXF1ZW5lc3MgPSB0cnVlOwogICAgICAgICAgICBmb3IgKGNvbnN0IGQgb2YgZGF0YSkgewogICAgICAgICAgICAgICAgY29uc3QgZXQgPSBDMy5OZXcoQzMuRWZmZWN0VHlwZSwgdGhpcywgZCwgdGhpcy5fYWxsRWZmZWN0VHlwZXMubGVuZ3RoKTsKICAgICAgICAgICAgICAgIHRoaXMuX2FsbEVmZmVjdFR5cGVzLnB1c2goZXQpOwogICAgICAgICAgICAgICAgdGhpcy5fZWZmZWN0VHlwZXNCeU5hbWUuc2V0KGV0LkdldE5hbWUoKS50b0xvd2VyQ2FzZSgpLCBldCk7CiAgICAgICAgICAgICAgICBpZiAoZC5sZW5ndGggPj0gMykgdGhpcy5fZWZmZWN0UGFyYW1zLnB1c2godGhpcy5fTG9hZFNpbmdsZUVmZmVjdFBhcmFtZXRlcnMoZXQsCiAgICAgICAgICAgICAgICAgICAgZFsyXSkpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5HZXRSdW50aW1lKCkuX0FkZEVmZmVjdExpc3QodGhpcykKICAgICAgICB9CiAgICAgICAgUmVsZWFzZSgpIHsKICAgICAgICAgICAgZm9yIChjb25zdCBjcGIgb2YgdGhpcy5fZWZmZWN0UGFyYW1CdWZmZXJzKSBjcGIuUmVsZWFzZSgpOwogICAgICAgICAgICBDMy5jbGVhckFycmF5KHRoaXMuX2VmZmVjdFBhcmFtQnVmZmVycyk7CiAgICAgICAgICAgIEMzLmNsZWFyQXJyYXkodGhpcy5fYWxsRWZmZWN0VHlwZXMpOwogICAgICAgICAgICBDMy5jbGVhckFycmF5KHRoaXMuX2FjdGl2ZUVmZmVjdFR5cGVzKTsKICAgICAgICAgICAgdGhpcy5fZWZmZWN0VHlwZXNCeU5hbWUuY2xlYXIoKTsKICAgICAgICAgICAgQzMuY2xlYXJBcnJheSh0aGlzLl9lZmZlY3RQYXJhbXMpOwogICAgICAgICAgICB0aGlzLl9vd25lciA9IG51bGwKICAgICAgICB9CiAgICAgICAgX0FkZEluc3RhbmNlRWZmZWN0TGlzdChpZWwpIHsKICAgICAgICAgICAgdGhpcy5fYWxsSW5zdGFuY2VFZmZlY3RMaXN0cy5hZGQoaWVsKQogICAgICAgIH0KICAgICAgICBfUmVtb3ZlSW5zdGFuY2VFZmZlY3RMaXN0KGllbCkgewogICAgICAgICAgICB0aGlzLl9hbGxJbnN0YW5jZUVmZmVjdExpc3RzLmRlbGV0ZShpZWwpCiAgICAgICAgfQogICAgICAgIF9Jbml0UmVuZGVyZXIocmVuZGVyZXIpIHsKICAgICAgICAgICAgaWYgKHJlbmRlcmVyLklzV2ViR1BVKCkpIHsKICAgICAgICAgICAgICAgIHRoaXMuX2VmZmVjdFBhcmFtQnVmZmVycyA9CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYWxsRWZmZWN0VHlwZXMubWFwKGV0ID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2hhZGVyUHJvZ3JhbSA9IGV0LkdldFNoYWRlclByb2dyYW0oKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNoYWRlclByb2dyYW0uR2V0Q3VzdG9tUGFyYW1ldGVyc0J5dGVTaXplKCkgPiAwKSByZXR1cm4gQzMuTmV3KEMzLkdmeC5XZWJHUFVFZmZlY3RDdXN0b21QYXJhbXNCdWZmZXIsIHNoYWRlclByb2dyYW0pOwogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHJldHVybiBudWxsCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB0aGlzLl9VcGRhdGVBbGxFZmZlY3RQYXJhbUJ1ZmZlcnMoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciAoY29uc3QgaWVsIG9mIHRoaXMuX2FsbEluc3RhbmNlRWZmZWN0TGlzdHMpIGllbC5fSW5pdFJlbmRlcmVyKHJlbmRlcmVyKQogICAgICAgIH0KICAgICAgICBQcmVwZW5kRWZmZWN0VHlwZXMoYXJyKSB7CiAgICAgICAgICAgIGlmICghYXJyLmxlbmd0aCkgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl9hbGxFZmZlY3RUeXBlcyA9IGFyci5jb25jYXQodGhpcy5fYWxsRWZmZWN0VHlwZXMpOwogICAgICAgICAgICBmb3IgKGNvbnN0IGV0IG9mIGFycikgdGhpcy5fZWZmZWN0VHlwZXNCeU5hbWUuc2V0KGV0LkdldE5hbWUoKS50b0xvd2VyQ2FzZSgpLCBldCk7CiAgICAgICAgICAgIGZvciAobGV0IGkgPQogICAgICAgICAgICAgICAgICAgIDAsIGxlbiA9IHRoaXMuX2FsbEVmZmVjdFR5cGVzLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB0aGlzLl9hbGxFZmZlY3RUeXBlc1tpXS5fU2V0SW5kZXgoaSkKICAgICAgICB9CiAgICAgICAgX0xvYWRTaW5nbGVFZmZlY3RQYXJhbWV0ZXJzKGVmZmVjdFR5cGUsIGFycikgewogICAgICAgICAgICBlZmZlY3RUeXBlLlNldEFjdGl2ZShhcnJbMF0pOwogICAgICAgICAgICBjb25zdCByZXQgPSBhcnIuc2xpY2UoMSk7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSByZXQubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHAgPSByZXRbaV07CiAgICAgICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShwKSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGMgPSBDMy5OZXcoQzMuQ29sb3IpOwogICAgICAgICAgICAgICAgICAgIGMuc2V0RnJvbUpTT04ocCk7CiAgICAgICAgICAgICAgICAgICAgcmV0W2ldID0gYwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiByZXQKICAgICAgICB9CiAgICAgICAgR2V0T3duZXIoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9vd25lcgogICAgICAgIH0KICAgICAgICBHZXRSdW50aW1lKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fb3duZXIuR2V0UnVudGltZSgpCiAgICAgICAgfQogICAgICAgIFVwZGF0ZUFjdGl2ZUVmZmVjdHMoKSB7CiAgICAgICAgICAgIEMzLmNsZWFyQXJyYXkodGhpcy5fYWN0aXZlRWZmZWN0VHlwZXMpOwogICAgICAgICAgICBsZXQgcHJlc2VydmVzT3BhcXVlbmVzcyA9IHRydWU7CiAgICAgICAgICAgIGZvciAoY29uc3QgZXQgb2YgdGhpcy5fYWxsRWZmZWN0VHlwZXMpCiAgICAgICAgICAgICAgICBpZiAoZXQuSXNBY3RpdmUoKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX2FjdGl2ZUVmZmVjdFR5cGVzLnB1c2goZXQpOwogICAgICAgICAgICAgICAgICAgIGlmICghZXQuR2V0U2hhZGVyUHJvZ3JhbSgpLlByZXNlcnZlc09wYXF1ZW5lc3MoKSkgcHJlc2VydmVzT3BhcXVlbmVzcyA9IGZhbHNlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuX3ByZXNlcnZlc09wYXF1ZW5lc3MgPSBwcmVzZXJ2ZXNPcGFxdWVuZXNzCiAgICAgICAgfQogICAgICAgIEdldEFsbEVmZmVjdFR5cGVzKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fYWxsRWZmZWN0VHlwZXMKICAgICAgICB9CiAgICAgICAgSGFzQW55RWZmZWN0VHlwZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2FsbEVmZmVjdFR5cGVzLmxlbmd0aCA+IDAKICAgICAgICB9CiAgICAgICAgR2V0RWZmZWN0VHlwZUJ5TmFtZShuYW1lKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9lZmZlY3RUeXBlc0J5TmFtZS5nZXQobmFtZS50b0xvd2VyQ2FzZSgpKSB8fCBudWxsCiAgICAgICAgfQogICAgICAgIEdldEVmZmVjdFR5cGVCeUluZGV4KGluZGV4KSB7CiAgICAgICAgICAgIGluZGV4ID0gTWF0aC5mbG9vcigraW5kZXgpOwogICAgICAgICAgICBpZiAoaW5kZXggPCAwIHx8IGluZGV4ID49IHRoaXMuX2FsbEVmZmVjdFR5cGVzLmxlbmd0aCkgdGhyb3cgbmV3IFJhbmdlRXJyb3IoImludmFsaWQgZWZmZWN0IHR5cGUgaW5kZXgiKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2FsbEVmZmVjdFR5cGVzW2luZGV4XQogICAgICAgIH0KICAgICAgICBJc0VmZmVjdEluZGV4QWN0aXZlKGluZGV4KSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLkdldEVmZmVjdFR5cGVCeUluZGV4KGluZGV4KS5Jc0FjdGl2ZSgpCiAgICAgICAgfQogICAgICAgIFNldEVmZmVjdEluZGV4QWN0aXZlKGluZGV4LAogICAgICAgICAgICBhKSB7CiAgICAgICAgICAgIHRoaXMuR2V0RWZmZWN0VHlwZUJ5SW5kZXgoaW5kZXgpLlNldEFjdGl2ZShhKQogICAgICAgIH0KICAgICAgICBHZXRBY3RpdmVFZmZlY3RUeXBlcygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2FjdGl2ZUVmZmVjdFR5cGVzCiAgICAgICAgfQogICAgICAgIEhhc0FueUFjdGl2ZUVmZmVjdCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2FjdGl2ZUVmZmVjdFR5cGVzLmxlbmd0aCA+IDAKICAgICAgICB9CiAgICAgICAgUHJlc2VydmVzT3BhcXVlbmVzcygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3ByZXNlcnZlc09wYXF1ZW5lc3MKICAgICAgICB9CiAgICAgICAgR2V0RWZmZWN0UGFyYW1ldGVyc0ZvckluZGV4KGluZGV4KSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9lZmZlY3RQYXJhbXNbaW5kZXhdCiAgICAgICAgfQogICAgICAgIF9HZXRFZmZlY3RDaGFpblNoYWRlclBhcmFtZXRlcnNGb3JJbmRleChpbmRleCkgewogICAgICAgICAgICBpZiAoaW5kZXggPCB0aGlzLl9lZmZlY3RQYXJhbUJ1ZmZlcnMubGVuZ3RoKSByZXR1cm4gdGhpcy5fZWZmZWN0UGFyYW1CdWZmZXJzW2luZGV4XTsKICAgICAgICAgICAgZWxzZSByZXR1cm4gdGhpcy5fZWZmZWN0UGFyYW1zW2luZGV4XQogICAgICAgIH0KICAgICAgICBHZXRFZmZlY3RQYXJhbWV0ZXIoZWZmZWN0SW5kZXgsIHBhcmFtSW5kZXgpIHsKICAgICAgICAgICAgaWYgKGVmZmVjdEluZGV4IDwKICAgICAgICAgICAgICAgIDAgfHwgZWZmZWN0SW5kZXggPj0gdGhpcy5fZWZmZWN0UGFyYW1zLmxlbmd0aCkgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIGNvbnN0IGVmZmVjdFBhcmFtcyA9IHRoaXMuX2VmZmVjdFBhcmFtc1tlZmZlY3RJbmRleF07CiAgICAgICAgICAgIGlmIChwYXJhbUluZGV4IDwgMCB8fCBwYXJhbUluZGV4ID49IGVmZmVjdFBhcmFtcy5sZW5ndGgpIHJldHVybiBudWxsOwogICAgICAgICAgICByZXR1cm4gZWZmZWN0UGFyYW1zW3BhcmFtSW5kZXhdCiAgICAgICAgfQogICAgICAgIFNldEVmZmVjdFBhcmFtZXRlcihlZmZlY3RJbmRleCwgcGFyYW1JbmRleCwgdmFsdWUpIHsKICAgICAgICAgICAgaWYgKGVmZmVjdEluZGV4IDwgMCB8fCBlZmZlY3RJbmRleCA+PSB0aGlzLl9lZmZlY3RQYXJhbXMubGVuZ3RoKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGNvbnN0IGVmZmVjdFBhcmFtcyA9IHRoaXMuX2VmZmVjdFBhcmFtc1tlZmZlY3RJbmRleF07CiAgICAgICAgICAgIGlmIChwYXJhbUluZGV4IDwgMCB8fCBwYXJhbUluZGV4ID49IGVmZmVjdFBhcmFtcy5sZW5ndGgpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgY29uc3Qgb2xkVmFsdWUgPSBlZmZlY3RQYXJhbXNbcGFyYW1JbmRleF07CiAgICAgICAgICAgIGlmIChvbGRWYWx1ZSBpbnN0YW5jZW9mIEMzLkNvbG9yKSB7CiAgICAgICAgICAgICAgICBpZiAob2xkVmFsdWUuZXF1YWxzSWdub3JpbmdBbHBoYSh2YWx1ZSkpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIG9sZFZhbHVlLmNvcHlSZ2IodmFsdWUpCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAob2xkVmFsdWUgPT09IHZhbHVlKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICBlZmZlY3RQYXJhbXNbcGFyYW1JbmRleF0gPSB2YWx1ZQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChlZmZlY3RJbmRleCA8IHRoaXMuX2VmZmVjdFBhcmFtQnVmZmVycy5sZW5ndGgpIHRoaXMuX2VmZmVjdFBhcmFtQnVmZmVyc1tlZmZlY3RJbmRleF0uU2V0UGFyYW1ldGVyVmFsdWUocGFyYW1JbmRleCwgdmFsdWUpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgIH0KICAgICAgICBfVXBkYXRlQWxsRWZmZWN0UGFyYW1CdWZmZXJzKCkgewogICAgICAgICAgICBjb25zdCBlZmZlY3RQYXJhbXMgPSB0aGlzLl9lZmZlY3RQYXJhbXM7CiAgICAgICAgICAgIGNvbnN0IGVmZmVjdFBhcmFtQnVmZmVycyA9IHRoaXMuX2VmZmVjdFBhcmFtQnVmZmVyczsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IE1hdGgubWluKGVmZmVjdFBhcmFtcy5sZW5ndGgsIGVmZmVjdFBhcmFtQnVmZmVycy5sZW5ndGgpOyBpIDwgbGVuOyArK2kpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHBhcmFtc0J1ZiA9IGVmZmVjdFBhcmFtQnVmZmVyc1tpXTsKICAgICAgICAgICAgICAgIGNvbnN0IHBhcmFtcyA9IGVmZmVjdFBhcmFtc1tpXTsKICAgICAgICAgICAgICAgIGZvciAobGV0IGogPQogICAgICAgICAgICAgICAgICAgICAgICAwLCBsZW5qID0gcGFyYW1zLmxlbmd0aDsgaiA8IGxlbmo7ICsraikgcGFyYW1zQnVmLlNldFBhcmFtZXRlclZhbHVlKGosIHBhcmFtc1tqXSkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBzdGF0aWMgU2F2ZUZ4UGFyYW1Ub0pzb24ocGFyYW0pIHsKICAgICAgICAgICAgaWYgKHBhcmFtICYmIHBhcmFtIGluc3RhbmNlb2YgQzMuQ29sb3IpIHJldHVybiB7CiAgICAgICAgICAgICAgICAidCI6ICJjb2xvciIsCiAgICAgICAgICAgICAgICAidiI6IHBhcmFtLnRvSlNPTigpCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGVsc2UgcmV0dXJuIHBhcmFtCiAgICAgICAgfQogICAgICAgIHN0YXRpYyBMb2FkRnhQYXJhbUZyb21Kc29uKG8pIHsKICAgICAgICAgICAgaWYgKG8gPT09IG51bGwpIHJldHVybiBOYU47CiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiBvID09PSAib2JqZWN0IikgewogICAgICAgICAgICAgICAgY29uc3QgdHlwZSA9IG9bInQiXTsKICAgICAgICAgICAgICAgIGlmICh0eXBlID09PSAiY29sb3IiKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29sb3IgPSBDMy5OZXcoQzMuQ29sb3IpOwogICAgICAgICAgICAgICAgICAgIGNvbG9yLnNldEZyb21KU09OKG9bInYiXSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbG9yCiAgICAgICAgICAgICAgICB9IGVsc2UgdGhyb3cgbmV3IEVycm9yKCJpbnZhbGlkIGVmZmVjdCBwYXJhbWV0ZXIgdHlwZSIpOwogICAgICAgICAgICB9IGVsc2UgcmV0dXJuIG8KICAgICAgICB9CiAgICAgICAgc3RhdGljIFNhdmVGeFBhcmFtc1RvSnNvbihwYXJhbXMpIHsKICAgICAgICAgICAgcmV0dXJuIHBhcmFtcy5tYXAoQzMuRWZmZWN0TGlzdC5TYXZlRnhQYXJhbVRvSnNvbikKICAgICAgICB9CiAgICAgICAgc3RhdGljIExvYWRGeFBhcmFtc0Zyb21Kc29uKGFycikgewogICAgICAgICAgICByZXR1cm4gYXJyLm1hcChDMy5FZmZlY3RMaXN0LkxvYWRGeFBhcmFtRnJvbUpzb24pCiAgICAgICAgfQogICAgICAgIFNhdmVUb0pzb24oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9hbGxFZmZlY3RUeXBlcy5tYXAoZXQgPT4KICAgICAgICAgICAgICAgICh7CiAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiBldC5HZXROYW1lKCksCiAgICAgICAgICAgICAgICAgICAgImFjdGl2ZSI6IGV0LklzQWN0aXZlKCksCiAgICAgICAgICAgICAgICAgICAgInBhcmFtcyI6IEMzLkVmZmVjdExpc3QuU2F2ZUZ4UGFyYW1zVG9Kc29uKHRoaXMuX2VmZmVjdFBhcmFtc1tldC5HZXRJbmRleCgpXSkKICAgICAgICAgICAgICAgIH0pKQogICAgICAgIH0KICAgICAgICBMb2FkRnJvbUpzb24oYXJyKSB7CiAgICAgICAgICAgIGZvciAoY29uc3QgbyBvZiBhcnIpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGV0ID0gdGhpcy5HZXRFZmZlY3RUeXBlQnlOYW1lKG9bIm5hbWUiXSk7CiAgICAgICAgICAgICAgICBpZiAoIWV0KSBjb250aW51ZTsKICAgICAgICAgICAgICAgIGV0LlNldEFjdGl2ZShvWyJhY3RpdmUiXSk7CiAgICAgICAgICAgICAgICB0aGlzLl9lZmZlY3RQYXJhbXNbZXQuR2V0SW5kZXgoKV0gPSBDMy5FZmZlY3RMaXN0LkxvYWRGeFBhcmFtc0Zyb21Kc29uKG9bInBhcmFtcyJdKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuVXBkYXRlQWN0aXZlRWZmZWN0cygpOwogICAgICAgICAgICB0aGlzLl9VcGRhdGVBbGxFZmZlY3RQYXJhbUJ1ZmZlcnMoKQogICAgICAgIH0KICAgIH07Cgp9CgovLyBvYmplY3RzL2VmZmVjdFR5cGUuanMKewogICAgJ3VzZSBzdHJpY3QnOwogICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgQzMuRWZmZWN0VHlwZSA9IGNsYXNzIEVmZmVjdFR5cGUgZXh0ZW5kcyBDMy5EZWZlbmRlZEJhc2UgewogICAgICAgIGNvbnN0cnVjdG9yKGVmZmVjdExpc3QsIGRhdGEsIGluZGV4KSB7CiAgICAgICAgICAgIHN1cGVyKCk7CiAgICAgICAgICAgIHRoaXMuX2VmZmVjdExpc3QgPSBlZmZlY3RMaXN0OwogICAgICAgICAgICB0aGlzLl9pZCA9IGRhdGFbMF07CiAgICAgICAgICAgIHRoaXMuX25hbWUgPSBkYXRhWzFdOwogICAgICAgICAgICB0aGlzLl9pbmRleCA9IGluZGV4OwogICAgICAgICAgICB0aGlzLl9zaGFkZXJQcm9ncmFtID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5faXNBY3RpdmUgPSB0cnVlCiAgICAgICAgfQogICAgICAgIFJlbGVhc2UoKSB7CiAgICAgICAgICAgIHRoaXMuX2VmZmVjdExpc3QgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9zaGFkZXJQcm9ncmFtID0gbnVsbAogICAgICAgIH0KICAgICAgICBDbG9uZShlZmZlY3RMaXN0T3duZXIpIHsKICAgICAgICAgICAgY29uc3QgcmV0ID0gQzMuTmV3KEMzLkVmZmVjdFR5cGUsIGVmZmVjdExpc3RPd25lciwgW3RoaXMuX2lkLCB0aGlzLl9uYW1lXSwgLTEpOwogICAgICAgICAgICByZXQuX3NoYWRlclByb2dyYW0gPSB0aGlzLl9zaGFkZXJQcm9ncmFtOwogICAgICAgICAgICByZXQuX2lzQWN0aXZlID0gdGhpcy5faXNBY3RpdmU7CiAgICAgICAgICAgIHJldHVybiByZXQKICAgICAgICB9CiAgICAgICAgX0luaXRSZW5kZXJlcihyZW5kZXJlcikgewogICAgICAgICAgICBjb25zdCBzaGFkZXJQcm9ncmFtID0gcmVuZGVyZXIuR2V0U2hhZGVyUHJvZ3JhbUJ5TmFtZSh0aGlzLl9pZCk7CiAgICAgICAgICAgIGlmICghc2hhZGVyUHJvZ3JhbSkgdGhyb3cgbmV3IEVycm9yKCJmYWlsZWQgdG8gZmluZCBzaGFkZXIgcHJvZ3JhbSAnIiArIHRoaXMuX2lkICsgIiciKTsKICAgICAgICAgICAgdGhpcy5fc2hhZGVyUHJvZ3JhbSA9IHNoYWRlclByb2dyYW0KICAgICAgICB9CiAgICAgICAgR2V0RWZmZWN0TGlzdCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2VmZmVjdExpc3QKICAgICAgICB9CiAgICAgICAgR2V0TmFtZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX25hbWUKICAgICAgICB9CiAgICAgICAgX1NldEluZGV4KGkpIHsKICAgICAgICAgICAgdGhpcy5faW5kZXggPSBpCiAgICAgICAgfQogICAgICAgIEdldEluZGV4KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faW5kZXgKICAgICAgICB9CiAgICAgICAgR2V0T3duZXIoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9lZmZlY3RMaXN0LkdldE93bmVyKCkKICAgICAgICB9CiAgICAgICAgR2V0UnVudGltZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2VmZmVjdExpc3QuR2V0UnVudGltZSgpCiAgICAgICAgfQogICAgICAgIFNldEFjdGl2ZShhKSB7CiAgICAgICAgICAgIHRoaXMuX2lzQWN0aXZlID0gISFhCiAgICAgICAgfQogICAgICAgIElzQWN0aXZlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faXNBY3RpdmUKICAgICAgICB9CiAgICAgICAgR2V0U2hhZGVyUHJvZ3JhbSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NoYWRlclByb2dyYW0KICAgICAgICB9CiAgICAgICAgR2V0RGVmYXVsdFBhcmFtZXRlclZhbHVlcygpIHsKICAgICAgICAgICAgY29uc3QgcmV0ID0gW107CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLAogICAgICAgICAgICAgICAgICAgIGxlbiA9IHRoaXMuX3NoYWRlclByb2dyYW0uR2V0UGFyYW1ldGVyQ291bnQoKTsgaSA8IGxlbjsgKytpKSB7CiAgICAgICAgICAgICAgICBjb25zdCB0eXBlID0gdGhpcy5fc2hhZGVyUHJvZ3JhbS5HZXRQYXJhbWV0ZXJUeXBlKGkpOwogICAgICAgICAgICAgICAgaWYgKHR5cGUgPT09ICJmbG9hdCIgfHwgdHlwZSA9PT0gInBlcmNlbnQiKSByZXQucHVzaCgwKTsKICAgICAgICAgICAgICAgIGVsc2UgaWYgKHR5cGUgPT09ICJjb2xvciIpIHJldC5wdXNoKEMzLk5ldyhDMy5Db2xvciwgMSwgMSwgMSwgMSkpOwogICAgICAgICAgICAgICAgZWxzZSB0aHJvdyBuZXcgVHlwZUVycm9yKCJ1bmtub3duIGVmZmVjdCBwYXJhbWV0ZXIgdHlwZSIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiByZXQKICAgICAgICB9CiAgICB9OwoKfQoKLy8gb2JqZWN0cy9pbnN0YW5jZUVmZmVjdExpc3QuanMKewogICAgJ3VzZSBzdHJpY3QnOwogICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgQzMuSW5zdGFuY2VFZmZlY3RMaXN0ID0gY2xhc3MgSW5zdGFuY2VFZmZlY3RMaXN0IGV4dGVuZHMgQzMuRGVmZW5kZWRCYXNlIHsKICAgICAgICBjb25zdHJ1Y3RvcihpbnN0LCB3aSkgewogICAgICAgICAgICBzdXBlcigpOwogICAgICAgICAgICB0aGlzLl9pbnN0ID0gaW5zdDsKICAgICAgICAgICAgdGhpcy5fd2kgPSB3aTsKICAgICAgICAgICAgdGhpcy5fZWZmZWN0TGlzdCA9IGluc3QuR2V0T2JqZWN0Q2xhc3MoKS5HZXRFZmZlY3RMaXN0KCk7CiAgICAgICAgICAgIHRoaXMuX25lZWRzUmVidWlsZFN0ZXBzID0gdHJ1ZTsKICAgICAgICAgICAgdGhpcy5fd2FzRGVmYXVsdENvbG9yID0gdHJ1ZTsKICAgICAgICAgICAgdGhpcy5fd2FzM0QgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5fd2FzUm90YXRlZE9yTmVnYXRpdmVTaXplID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX3dhc1RleFJvdGF0ZWQgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5fZWZmZWN0Q2hhaW4gPSBDMy5OZXcoQzMuR2Z4LkVmZmVjdENoYWluLCBpbnN0LkdldFJ1bnRpbWUoKS5HZXRDYW52YXNNYW5hZ2VyKCkuR2V0RWZmZWN0Q2hhaW5NYW5hZ2VyKCksIHsKICAgICAgICAgICAgICAgIGRyYXdDb250ZW50OiAocmVuZGVyZXIsIGVmZmVjdENoYWluKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5zdCA9IGVmZmVjdENoYWluLkdldENvbnRlbnRPYmplY3QoKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCB3aSA9IGluc3QuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgICAgICAgICAgcmVuZGVyZXIuU2V0Q29sb3Iod2kuR2V0UHJlbXVsdGlwbGllZENvbG9yKCkpOwogICAgICAgICAgICAgICAgICAgIHJlbmRlcmVyLlNldEN1cnJlbnRaKHdpLkdldFRvdGFsWkVsZXZhdGlvbigpKTsKICAgICAgICAgICAgICAgICAgICBpbnN0LkRyYXcocmVuZGVyZXIpOwogICAgICAgICAgICAgICAgICAgIHJlbmRlcmVyLlNldEN1cnJlbnRaKDApCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZ2V0U291cmNlVGV4dHVyZUluZm86IGluc3QgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNyY1RleFJlY3QgPSBpbnN0LkdldEN1cnJlbnRUZXhSZWN0KCk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgW3NyY1dpZHRoLCBzcmNIZWlnaHRdID0gaW5zdC5HZXRDdXJyZW50U3VyZmFjZVNpemUoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICBzcmNUZXhSZWN0LAogICAgICAgICAgICAgICAgICAgICAgICBzcmNXaWR0aCwKICAgICAgICAgICAgICAgICAgICAgICAgc3JjSGVpZ2h0CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGdldFNoYWRlclBhcmFtZXRlcnM6IGluZGV4ID0+IHRoaXMuX0dldEVmZmVjdENoYWluU2hhZGVyUGFyYW1ldGVyc0ZvckluZGV4KGluZGV4KQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdGhpcy5fYWN0aXZlRWZmZWN0RmxhZ3MgPSBbXTsKICAgICAgICAgICAgdGhpcy5fYWN0aXZlRWZmZWN0VHlwZXMgPSBbXTsKICAgICAgICAgICAgdGhpcy5fcHJlc2VydmVzT3BhcXVlbmVzcyA9IHRydWU7CiAgICAgICAgICAgIHRoaXMuX2VmZmVjdFBhcmFtcyA9IFtdOwogICAgICAgICAgICB0aGlzLl9lZmZlY3RQYXJhbUJ1ZmZlcnMgPSBbXTsKICAgICAgICAgICAgdGhpcy5fSW5pdFJlbmRlcmVyKGluc3QuR2V0UnVudGltZSgpLkdldFJlbmRlcmVyKCkpOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gdGhpcy5fZWZmZWN0TGlzdC5HZXRBbGxFZmZlY3RUeXBlcygpLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB0aGlzLl9hY3RpdmVFZmZlY3RGbGFncy5wdXNoKHRydWUpOwogICAgICAgICAgICB0aGlzLlVwZGF0ZUFjdGl2ZUVmZmVjdHMoKTsKICAgICAgICAgICAgdGhpcy5fZWZmZWN0TGlzdC5fQWRkSW5zdGFuY2VFZmZlY3RMaXN0KHRoaXMpCiAgICAgICAgfQogICAgICAgIFJlbGVhc2UoKSB7CiAgICAgICAgICAgIHRoaXMuX2VmZmVjdExpc3QuX1JlbW92ZUluc3RhbmNlRWZmZWN0TGlzdCh0aGlzKTsKICAgICAgICAgICAgZm9yIChjb25zdCBjcGIgb2YgdGhpcy5fZWZmZWN0UGFyYW1CdWZmZXJzKQogICAgICAgICAgICAgICAgaWYgKGNwYikgY3BiLlJlbGVhc2UoKTsKICAgICAgICAgICAgQzMuY2xlYXJBcnJheSh0aGlzLl9lZmZlY3RQYXJhbUJ1ZmZlcnMpOwogICAgICAgICAgICB0aGlzLl9lZmZlY3RDaGFpbi5SZWxlYXNlKCk7CiAgICAgICAgICAgIHRoaXMuX2VmZmVjdENoYWluID0gbnVsbDsKICAgICAgICAgICAgQzMuY2xlYXJBcnJheSh0aGlzLl9hY3RpdmVFZmZlY3RGbGFncyk7CiAgICAgICAgICAgIEMzLmNsZWFyQXJyYXkodGhpcy5fYWN0aXZlRWZmZWN0VHlwZXMpOwogICAgICAgICAgICBDMy5jbGVhckFycmF5KHRoaXMuX2VmZmVjdFBhcmFtcyk7CiAgICAgICAgICAgIHRoaXMuX2luc3QgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9lZmZlY3RMaXN0ID0gbnVsbAogICAgICAgIH0KICAgICAgICBfSW5pdFJlbmRlcmVyKHJlbmRlcmVyKSB7CiAgICAgICAgICAgIGlmIChyZW5kZXJlci5Jc1dlYkdQVSgpKSB0aGlzLl9lZmZlY3RQYXJhbUJ1ZmZlcnMgPSB0aGlzLl9lZmZlY3RMaXN0LkdldEFsbEVmZmVjdFR5cGVzKCkubWFwKGV0ID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IHNoYWRlclByb2dyYW0gPSBldC5HZXRTaGFkZXJQcm9ncmFtKCk7CiAgICAgICAgICAgICAgICBpZiAoc2hhZGVyUHJvZ3JhbS5HZXRDdXN0b21QYXJhbWV0ZXJzQnl0ZVNpemUoKSA+IDApIHJldHVybiBDMy5OZXcoQzMuR2Z4LldlYkdQVUVmZmVjdEN1c3RvbVBhcmFtc0J1ZmZlciwgc2hhZGVyUHJvZ3JhbSk7CiAgICAgICAgICAgICAgICBlbHNlIHJldHVybiBudWxsCiAgICAgICAgICAgIH0pCiAgICAgICAgfQogICAgICAgIF9Mb2FkRWZmZWN0UGFyYW1ldGVycyhkYXRhKSB7CiAgICAgICAgICAgIGxldCBpbmRleCA9IDA7CiAgICAgICAgICAgIGZvciAoY29uc3QgZSBvZiBkYXRhKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9lZmZlY3RQYXJhbXMucHVzaCh0aGlzLl9Mb2FkU2luZ2xlRWZmZWN0UGFyYW1ldGVycyhpbmRleCwKICAgICAgICAgICAgICAgICAgICBlKSk7CiAgICAgICAgICAgICAgICArK2luZGV4CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5fVXBkYXRlQWxsRWZmZWN0UGFyYW1CdWZmZXJzKCk7CiAgICAgICAgICAgIHRoaXMuVXBkYXRlQWN0aXZlRWZmZWN0cygpCiAgICAgICAgfQogICAgICAgIF9Mb2FkU2luZ2xlRWZmZWN0UGFyYW1ldGVycyhpbmRleCwgYXJyKSB7CiAgICAgICAgICAgIHRoaXMuX2FjdGl2ZUVmZmVjdEZsYWdzW2luZGV4XSA9IGFyclswXTsKICAgICAgICAgICAgY29uc3QgcmV0ID0gYXJyLnNsaWNlKDEpOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gcmV0Lmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7CiAgICAgICAgICAgICAgICBjb25zdCBwID0gcmV0W2ldOwogICAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkocCkpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBjID0gQzMuTmV3KEMzLkNvbG9yKTsKICAgICAgICAgICAgICAgICAgICBjLnNldEZyb21KU09OKHApOwogICAgICAgICAgICAgICAgICAgIHJldFtpXSA9IGMKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcmV0CiAgICAgICAgfQogICAgICAgIExvYWREZWZhdWx0RWZmZWN0UGFyYW1ldGVycygpIHsKICAgICAgICAgICAgZm9yIChjb25zdCBlZmZlY3RUeXBlIG9mIHRoaXMuX2VmZmVjdExpc3QuR2V0QWxsRWZmZWN0VHlwZXMoKSkgdGhpcy5fZWZmZWN0UGFyYW1zLnB1c2goZWZmZWN0VHlwZS5HZXREZWZhdWx0UGFyYW1ldGVyVmFsdWVzKCkpOwogICAgICAgICAgICB0aGlzLl9VcGRhdGVBbGxFZmZlY3RQYXJhbUJ1ZmZlcnMoKQogICAgICAgIH0KICAgICAgICBHZXRPd25lcigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX293bmVyCiAgICAgICAgfQogICAgICAgIEdldEVmZmVjdExpc3QoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9lZmZlY3RMaXN0CiAgICAgICAgfQogICAgICAgIEdldEVmZmVjdENoYWluKCkgewogICAgICAgICAgICB0aGlzLl9NYXliZVJlYnVpbGRFZmZlY3RDaGFpblN0ZXBzKCk7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9lZmZlY3RDaGFpbgogICAgICAgIH0KICAgICAgICBHZXRSdW50aW1lKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faW5zdC5HZXRSdW50aW1lKCkKICAgICAgICB9CiAgICAgICAgVXBkYXRlQWN0aXZlRWZmZWN0cygpIHsKICAgICAgICAgICAgQzMuY2xlYXJBcnJheSh0aGlzLl9hY3RpdmVFZmZlY3RUeXBlcyk7CiAgICAgICAgICAgIGNvbnN0IHdpID0gdGhpcy5fd2k7CiAgICAgICAgICAgIGNvbnN0IGFsbEVmZmVjdFR5cGVzID0gdGhpcy5fZWZmZWN0TGlzdC5HZXRBbGxFZmZlY3RUeXBlcygpOwogICAgICAgICAgICBjb25zdCBhY3RpdmVFZmZlY3RUeXBlcyA9IHRoaXMuX2FjdGl2ZUVmZmVjdFR5cGVzOwogICAgICAgICAgICBjb25zdCBhY3RpdmVFZmZlY3RGbGFncyA9IHRoaXMuX2FjdGl2ZUVmZmVjdEZsYWdzOwogICAgICAgICAgICBsZXQgcHJlc2VydmVzT3BhcXVlbmVzcyA9IHRydWU7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBhbGxFZmZlY3RUeXBlcy5sZW5ndGg7IGkgPCBsZW47ICsraSkKICAgICAgICAgICAgICAgIGlmIChhY3RpdmVFZmZlY3RGbGFnc1tpXSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGV0ID0gYWxsRWZmZWN0VHlwZXNbaV07CiAgICAgICAgICAgICAgICAgICAgYWN0aXZlRWZmZWN0VHlwZXMucHVzaChldCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFldC5HZXRTaGFkZXJQcm9ncmFtKCkuUHJlc2VydmVzT3BhcXVlbmVzcygpKSBwcmVzZXJ2ZXNPcGFxdWVuZXNzID0KICAgICAgICAgICAgICAgICAgICAgICAgZmFsc2UKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5fcHJlc2VydmVzT3BhcXVlbmVzcyA9IHByZXNlcnZlc09wYXF1ZW5lc3M7CiAgICAgICAgICAgIHdpLl9TZXRIYXNBbnlBY3RpdmVFZmZlY3QoISFhY3RpdmVFZmZlY3RUeXBlcy5sZW5ndGgpOwogICAgICAgICAgICB0aGlzLl9uZWVkc1JlYnVpbGRTdGVwcyA9IHRydWUKICAgICAgICB9CiAgICAgICAgX01heWJlUmVidWlsZEVmZmVjdENoYWluU3RlcHMoKSB7CiAgICAgICAgICAgIGNvbnN0IGluc3QgPSB0aGlzLl9pbnN0OwogICAgICAgICAgICBjb25zdCB3aSA9IHRoaXMuX3dpOwogICAgICAgICAgICBjb25zdCBpc0RlZmF1bHRDb2xvciA9IHdpLkhhc0RlZmF1bHRDb2xvcigpOwogICAgICAgICAgICBjb25zdCBpczNEID0gd2kuR2V0RGVwdGgoKSA+IDA7CiAgICAgICAgICAgIGNvbnN0IGlzUm90YXRlZE9yTmVnYXRpdmVTaXplSW5zdGFuY2UgPSB3aS5HZXRBbmdsZSgpICE9PSAwIHx8IHdpLkdldFdpZHRoKCkgPCAwIHx8IHdpLkdldEhlaWdodCgpIDwgMDsKICAgICAgICAgICAgY29uc3QgaXNUZXhSb3RhdGVkID0gaW5zdC5Jc0N1cnJlbnRUZXhSb3RhdGVkKCk7CiAgICAgICAgICAgIGlmICghdGhpcy5fbmVlZHNSZWJ1aWxkU3RlcHMgJiYgaXNEZWZhdWx0Q29sb3IgPT09IHRoaXMuX3dhc0RlZmF1bHRDb2xvciAmJiBpczNEID09PSB0aGlzLl93YXMzRCAmJgogICAgICAgICAgICAgICAgaXNSb3RhdGVkT3JOZWdhdGl2ZVNpemVJbnN0YW5jZSA9PT0gdGhpcy5fd2FzUm90YXRlZE9yTmVnYXRpdmVTaXplICYmIGlzVGV4Um90YXRlZCA9PT0gdGhpcy5fd2FzVGV4Um90YXRlZCAmJiAhdGhpcy5fZWZmZWN0Q2hhaW4uTmVlZHNSZWJ1aWxkKCkpIHJldHVybjsKICAgICAgICAgICAgdGhpcy5fZWZmZWN0Q2hhaW4uQnVpbGRTdGVwcyh0aGlzLl9hY3RpdmVFZmZlY3RUeXBlcy5tYXAoZSA9PiBlLkdldFNoYWRlclByb2dyYW0oKSksIHsKICAgICAgICAgICAgICAgIGluZGV4TWFwOiB0aGlzLl9hY3RpdmVFZmZlY3RUeXBlcy5tYXAoZSA9PiBlLkdldEluZGV4KCkpLAogICAgICAgICAgICAgICAgZm9yY2VQcmVEcmF3OiAhaXNEZWZhdWx0Q29sb3IgfHwgaW5zdC5NdXN0UHJlRHJhdygpLAogICAgICAgICAgICAgICAgaXMzRCwKICAgICAgICAgICAgICAgIGlzU291cmNlVGV4dHVyZVJvdGF0ZWQ6IGlzVGV4Um90YXRlZCwKICAgICAgICAgICAgICAgIGlzUm90YXRlZE9yTmVnYXRpdmVTaXplSW5zdGFuY2UKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHRoaXMuX25lZWRzUmVidWlsZFN0ZXBzID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX3dhc0RlZmF1bHRDb2xvciA9IGlzRGVmYXVsdENvbG9yOwogICAgICAgICAgICB0aGlzLl93YXMzRCA9IGlzM0Q7CiAgICAgICAgICAgIHRoaXMuX3dhc1JvdGF0ZWRPck5lZ2F0aXZlU2l6ZSA9CiAgICAgICAgICAgICAgICBpc1JvdGF0ZWRPck5lZ2F0aXZlU2l6ZUluc3RhbmNlOwogICAgICAgICAgICB0aGlzLl93YXNUZXhSb3RhdGVkID0gaXNUZXhSb3RhdGVkCiAgICAgICAgfQogICAgICAgIEdldEFjdGl2ZUVmZmVjdFR5cGVzKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fYWN0aXZlRWZmZWN0VHlwZXMKICAgICAgICB9CiAgICAgICAgR2V0RWZmZWN0UGFyYW1ldGVyc0ZvckluZGV4KGluZGV4KSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9lZmZlY3RQYXJhbXNbaW5kZXhdCiAgICAgICAgfQogICAgICAgIF9HZXRFZmZlY3RDaGFpblNoYWRlclBhcmFtZXRlcnNGb3JJbmRleChpbmRleCkgewogICAgICAgICAgICBpZiAoaW5kZXggPCB0aGlzLl9lZmZlY3RQYXJhbUJ1ZmZlcnMubGVuZ3RoKSByZXR1cm4gdGhpcy5fZWZmZWN0UGFyYW1CdWZmZXJzW2luZGV4XTsKICAgICAgICAgICAgZWxzZSByZXR1cm4gdGhpcy5fZWZmZWN0UGFyYW1zW2luZGV4XQogICAgICAgIH0KICAgICAgICBHZXRFZmZlY3RQYXJhbWV0ZXIoZWZmZWN0SW5kZXgsIHBhcmFtSW5kZXgpIHsKICAgICAgICAgICAgaWYgKGVmZmVjdEluZGV4IDwgMCB8fCBlZmZlY3RJbmRleCA+PSB0aGlzLl9lZmZlY3RQYXJhbXMubGVuZ3RoKSByZXR1cm4gbnVsbDsKICAgICAgICAgICAgY29uc3QgZWZmZWN0UGFyYW1zID0gdGhpcy5fZWZmZWN0UGFyYW1zW2VmZmVjdEluZGV4XTsKICAgICAgICAgICAgaWYgKHBhcmFtSW5kZXggPCAwIHx8IHBhcmFtSW5kZXggPj0gZWZmZWN0UGFyYW1zLmxlbmd0aCkgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIHJldHVybiBlZmZlY3RQYXJhbXNbcGFyYW1JbmRleF0KICAgICAgICB9CiAgICAgICAgU2V0RWZmZWN0UGFyYW1ldGVyKGVmZmVjdEluZGV4LCBwYXJhbUluZGV4LCB2YWx1ZSkgewogICAgICAgICAgICBpZiAoZWZmZWN0SW5kZXggPCAwIHx8IGVmZmVjdEluZGV4ID49IHRoaXMuX2VmZmVjdFBhcmFtcy5sZW5ndGgpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgY29uc3QgZWZmZWN0UGFyYW1zID0gdGhpcy5fZWZmZWN0UGFyYW1zW2VmZmVjdEluZGV4XTsKICAgICAgICAgICAgaWYgKHBhcmFtSW5kZXggPCAwIHx8IHBhcmFtSW5kZXggPj0gZWZmZWN0UGFyYW1zLmxlbmd0aCkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBjb25zdCBvbGRWYWx1ZSA9IGVmZmVjdFBhcmFtc1twYXJhbUluZGV4XTsKICAgICAgICAgICAgaWYgKG9sZFZhbHVlIGluc3RhbmNlb2YgQzMuQ29sb3IpIHsKICAgICAgICAgICAgICAgIGlmIChvbGRWYWx1ZS5lcXVhbHNJZ25vcmluZ0FscGhhKHZhbHVlKSkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgb2xkVmFsdWUuY29weVJnYih2YWx1ZSkKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlmIChvbGRWYWx1ZSA9PT0gdmFsdWUpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIGVmZmVjdFBhcmFtc1twYXJhbUluZGV4XSA9IHZhbHVlCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGVmZmVjdEluZGV4IDwgdGhpcy5fZWZmZWN0UGFyYW1CdWZmZXJzLmxlbmd0aCkgdGhpcy5fZWZmZWN0UGFyYW1CdWZmZXJzW2VmZmVjdEluZGV4XS5TZXRQYXJhbWV0ZXJWYWx1ZShwYXJhbUluZGV4LCB2YWx1ZSk7CiAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgfQogICAgICAgIF9VcGRhdGVBbGxFZmZlY3RQYXJhbUJ1ZmZlcnMoKSB7CiAgICAgICAgICAgIGNvbnN0IGVmZmVjdFBhcmFtcyA9IHRoaXMuX2VmZmVjdFBhcmFtczsKICAgICAgICAgICAgY29uc3QgZWZmZWN0UGFyYW1CdWZmZXJzID0gdGhpcy5fZWZmZWN0UGFyYW1CdWZmZXJzOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gZWZmZWN0UGFyYW1CdWZmZXJzLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7CiAgICAgICAgICAgICAgICBjb25zdCBwYXJhbXNCdWYgPSBlZmZlY3RQYXJhbUJ1ZmZlcnNbaV07CiAgICAgICAgICAgICAgICBjb25zdCBwYXJhbXMgPSBlZmZlY3RQYXJhbXNbaV07CiAgICAgICAgICAgICAgICBmb3IgKGxldCBqID0gMCwgbGVuaiA9IHBhcmFtcy5sZW5ndGg7IGogPCBsZW5qOyArK2opIHBhcmFtc0J1Zi5TZXRQYXJhbWV0ZXJWYWx1ZShqLCBwYXJhbXNbal0pCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgUHJlc2VydmVzT3BhcXVlbmVzcygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3ByZXNlcnZlc09wYXF1ZW5lc3MKICAgICAgICB9CiAgICAgICAgSGFzQW55QWN0aXZlQmFja2dyb3VuZEJsZW5kaW5nRWZmZWN0KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fYWN0aXZlRWZmZWN0VHlwZXMuc29tZShldCA9PgogICAgICAgICAgICAgICAgZXQuR2V0U2hhZGVyUHJvZ3JhbSgpLkJsZW5kc0JhY2tncm91bmQoKSkKICAgICAgICB9CiAgICAgICAgSXNFZmZlY3RJbmRleEFjdGl2ZShpKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9hY3RpdmVFZmZlY3RGbGFnc1tpXQogICAgICAgIH0KICAgICAgICBTZXRFZmZlY3RJbmRleEFjdGl2ZShpLCBlKSB7CiAgICAgICAgICAgIHRoaXMuX2FjdGl2ZUVmZmVjdEZsYWdzW2ldID0gISFlCiAgICAgICAgfQogICAgICAgIEdldEFsbEVmZmVjdFR5cGVzKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZWZmZWN0TGlzdC5HZXRBbGxFZmZlY3RUeXBlcygpCiAgICAgICAgfQogICAgICAgIF9TYXZlVG9Kc29uKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZWZmZWN0TGlzdC5HZXRBbGxFZmZlY3RUeXBlcygpLm1hcChldCA9PiAoewogICAgICAgICAgICAgICAgIm5hbWUiOiBldC5HZXROYW1lKCksCiAgICAgICAgICAgICAgICAiYWN0aXZlIjogdGhpcy5fYWN0aXZlRWZmZWN0RmxhZ3NbZXQuR2V0SW5kZXgoKV0sCiAgICAgICAgICAgICAgICAicGFyYW1zIjogQzMuRWZmZWN0TGlzdC5TYXZlRnhQYXJhbXNUb0pzb24odGhpcy5fZWZmZWN0UGFyYW1zW2V0LkdldEluZGV4KCldKQogICAgICAgICAgICB9KSkKICAgICAgICB9CiAgICAgICAgX0xvYWRGcm9tSnNvbihhcnIpIHsKICAgICAgICAgICAgZm9yIChjb25zdCBvIG9mIGFycikgewogICAgICAgICAgICAgICAgY29uc3QgZXQgPSB0aGlzLl9lZmZlY3RMaXN0LkdldEVmZmVjdFR5cGVCeU5hbWUob1sibmFtZSJdKTsKICAgICAgICAgICAgICAgIGlmICghZXQpIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgdGhpcy5fYWN0aXZlRWZmZWN0RmxhZ3NbZXQuR2V0SW5kZXgoKV0gPSBvWyJhY3RpdmUiXTsKICAgICAgICAgICAgICAgIHRoaXMuX2VmZmVjdFBhcmFtc1tldC5HZXRJbmRleCgpXSA9IEMzLkVmZmVjdExpc3QuTG9hZEZ4UGFyYW1zRnJvbUpzb24ob1sicGFyYW1zIl0pCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5VcGRhdGVBY3RpdmVFZmZlY3RzKCk7CiAgICAgICAgICAgIHRoaXMuX1VwZGF0ZUFsbEVmZmVjdFBhcmFtQnVmZmVycygpCiAgICAgICAgfQogICAgfTsKCn0KCi8vIGNvbGxpc2lvbnMvY29sbGlzaW9uRW5naW5lLmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIGNvbnN0IHRlbXBDYW5kaWRhdGVzID0gW107CiAgICBjb25zdCB0aWxlQ29sbFJlY3RDYW5kaWRhdGVzID0gW107CiAgICBjb25zdCB0ZW1wSnVtcHRocnVSZXQgPSBbXTsKICAgIGNvbnN0IHRlbXBQb2x5QSA9IEMzLk5ldyhDMy5Db2xsaXNpb25Qb2x5KTsKICAgIGNvbnN0IHRlbXBQb2x5QiA9IEMzLk5ldyhDMy5Db2xsaXNpb25Qb2x5KTsKICAgIGNvbnN0IHRlbXBRdWFkID0gQzMuTmV3KEMzLlF1YWQpOwogICAgY29uc3QgdGVtcFJlY3QgPSBDMy5OZXcoQzMuUmVjdCk7CiAgICBjb25zdCB0ZW1wUmVjdDIgPSBDMy5OZXcoQzMuUmVjdCk7CiAgICBsZXQgdGVtcFBvbHlDID0gbnVsbDsKICAgIGxldCB0ZW1wUmVjdDMgPSBudWxsOwogICAgbGV0IHRlbXBRdWFkQiA9IG51bGw7CiAgICBDMy5Db2xsaXNpb25FbmdpbmUgPSBjbGFzcyBDb2xsaXNpb25FbmdpbmUgZXh0ZW5kcyBDMy5EZWZlbmRlZEJhc2UgewogICAgICAgIGNvbnN0cnVjdG9yKHJ1bnRpbWUpIHsKICAgICAgICAgICAgc3VwZXIoKTsKICAgICAgICAgICAgdGhpcy5fcnVudGltZSA9IHJ1bnRpbWU7CiAgICAgICAgICAgIHRoaXMuX3JlZ2lzdGVyZWRDb2xsaXNpb25zID0gW107CiAgICAgICAgICAgIHRoaXMuX2NvbGxpc2lvbkNoZWNrQ291bnQgPSAwOwogICAgICAgICAgICB0aGlzLl9jb2xsaXNpb25DaGVja1NlYyA9IDA7CiAgICAgICAgICAgIHRoaXMuX3BvbHlDaGVja0NvdW50ID0gMDsKICAgICAgICAgICAgdGhpcy5fcG9seUNoZWNrU2VjID0gMAogICAgICAgIH0KICAgICAgICBSZWxlYXNlKCkgewogICAgICAgICAgICB0aGlzLl9ydW50aW1lID0gbnVsbAogICAgICAgIH0KICAgICAgICBfVXBkYXRlMXNTdGF0cygpIHsKICAgICAgICAgICAgdGhpcy5fY29sbGlzaW9uQ2hlY2tTZWMgPSB0aGlzLl9jb2xsaXNpb25DaGVja0NvdW50OwogICAgICAgICAgICB0aGlzLl9jb2xsaXNpb25DaGVja0NvdW50ID0gMDsKICAgICAgICAgICAgdGhpcy5fcG9seUNoZWNrU2VjID0gdGhpcy5fcG9seUNoZWNrQ291bnQ7CiAgICAgICAgICAgIHRoaXMuX3BvbHlDaGVja0NvdW50ID0gMAogICAgICAgIH0KICAgICAgICBHZXQxc2VjQ29sbGlzaW9uQ2hlY2tzKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fY29sbGlzaW9uQ2hlY2tTZWMKICAgICAgICB9CiAgICAgICAgR2V0MXNlY1BvbHlDaGVja3MoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9wb2x5Q2hlY2tTZWMKICAgICAgICB9CiAgICAgICAgUmVnaXN0ZXJDb2xsaXNpb24oYSwKICAgICAgICAgICAgYikgewogICAgICAgICAgICBjb25zdCBhdyA9IGEuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgIGNvbnN0IGJ3ID0gYi5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgaWYgKCFhdyB8fCAhYncpIHJldHVybjsKICAgICAgICAgICAgaWYgKCFhdy5Jc0NvbGxpc2lvbkVuYWJsZWQoKSB8fCAhYncuSXNDb2xsaXNpb25FbmFibGVkKCkpIHJldHVybjsKICAgICAgICAgICAgdGhpcy5fcmVnaXN0ZXJlZENvbGxpc2lvbnMucHVzaChbYSwgYl0pCiAgICAgICAgfQogICAgICAgIEFkZFJlZ2lzdGVyZWRDb2xsaXNpb25DYW5kaWRhdGVzKGluc3QsIG90aGVyVHlwZSwgYXJyKSB7CiAgICAgICAgICAgIGZvciAoY29uc3QgW2EsIGJdIG9mIHRoaXMuX3JlZ2lzdGVyZWRDb2xsaXNpb25zKSB7CiAgICAgICAgICAgICAgICBsZXQgb3RoZXJJbnN0ID0gbnVsbDsKICAgICAgICAgICAgICAgIGlmIChpbnN0ID09PSBhKSBvdGhlckluc3QgPSBiOwogICAgICAgICAgICAgICAgZWxzZSBpZiAoaW5zdCA9PT0gYikgb3RoZXJJbnN0ID0gYTsKICAgICAgICAgICAgICAgIGVsc2UgY29udGludWU7CiAgICAgICAgICAgICAgICBpZiAoIW90aGVySW5zdC5CZWxvbmdzVG9PYmplY3RDbGFzcyhvdGhlclR5cGUpKSBjb250aW51ZTsKICAgICAgICAgICAgICAgIGlmICghYXJyLmluY2x1ZGVzKG90aGVySW5zdCkpIGFyci5wdXNoKG90aGVySW5zdCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBDaGVja1JlZ2lzdGVyZWRDb2xsaXNpb24oYSwgYikgewogICAgICAgICAgICBpZiAoIXRoaXMuX3JlZ2lzdGVyZWRDb2xsaXNpb25zLmxlbmd0aCkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBmb3IgKGNvbnN0IFtjLCBkXSBvZiB0aGlzLl9yZWdpc3RlcmVkQ29sbGlzaW9ucykKICAgICAgICAgICAgICAgIGlmIChhID09PSBjICYmIGIgPT09IGQgfHwgYSA9PT0gZCAmJiBiID09PSBjKSByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgfQogICAgICAgIENsZWFyUmVnaXN0ZXJlZENvbGxpc2lvbnMoKSB7CiAgICAgICAgICAgIEMzLmNsZWFyQXJyYXkodGhpcy5fcmVnaXN0ZXJlZENvbGxpc2lvbnMpCiAgICAgICAgfQogICAgICAgIFRlc3RPdmVybGFwKGEsIGIpIHsKICAgICAgICAgICAgaWYgKCFhIHx8ICFiIHx8IGEgPT09IGIpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgY29uc3QgYXcgPSBhLkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICBjb25zdCBidyA9IGIuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgIGlmICghYXcuSXNDb2xsaXNpb25FbmFibGVkKCkgfHwgIWJ3LklzQ29sbGlzaW9uRW5hYmxlZCgpKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX2NvbGxpc2lvbkNoZWNrQ291bnQrKzsKICAgICAgICAgICAgY29uc3QgbGF5ZXJBID0gYXcuR2V0TGF5ZXIoKTsKICAgICAgICAgICAgY29uc3QgbGF5ZXJCID0gYncuR2V0TGF5ZXIoKTsKICAgICAgICAgICAgY29uc3QgYXJlTGF5ZXJUcmFuc2Zvcm1zQ29tcGF0aWJsZSA9IGxheWVyQS5Jc1RyYW5zZm9ybUNvbXBhdGlibGVXaXRoKGxheWVyQik7CiAgICAgICAgICAgIGlmIChhcmVMYXllclRyYW5zZm9ybXNDb21wYXRpYmxlKSByZXR1cm4gdGhpcy5fVGVzdE92ZXJsYXBfU2FtZUxheWVycyhhdywKICAgICAgICAgICAgICAgIGJ3KTsKICAgICAgICAgICAgZWxzZSByZXR1cm4gdGhpcy5fVGVzdE92ZXJsYXBfRGlmZmVyZW50TGF5ZXJzKGF3LCBidykKICAgICAgICB9CiAgICAgICAgX1Rlc3RPdmVybGFwX1NhbWVMYXllcnMoYXcsIGJ3KSB7CiAgICAgICAgICAgIGlmICghYXcuR2V0Qm91bmRpbmdCb3goKS5pbnRlcnNlY3RzUmVjdChidy5HZXRCb3VuZGluZ0JveCgpKSkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB0aGlzLl9wb2x5Q2hlY2tDb3VudCsrOwogICAgICAgICAgICBpZiAoIWF3LkdldEJvdW5kaW5nUXVhZCgpLmludGVyc2VjdHNRdWFkKGJ3LkdldEJvdW5kaW5nUXVhZCgpKSkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBpZiAoYXcuSGFzVGlsZW1hcCgpICYmIGJ3Lkhhc1RpbGVtYXAoKSkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBpZiAoYXcuSGFzVGlsZW1hcCgpKSByZXR1cm4gdGhpcy5UZXN0VGlsZW1hcE92ZXJsYXAoYXcsIGJ3KTsKICAgICAgICAgICAgZWxzZSBpZiAoYncuSGFzVGlsZW1hcCgpKSByZXR1cm4gdGhpcy5UZXN0VGlsZW1hcE92ZXJsYXAoYncsIGF3KTsKICAgICAgICAgICAgaWYgKCFhdy5IYXNPd25Db2xsaXNpb25Qb2x5KCkgJiYgIWJ3Lkhhc093bkNvbGxpc2lvblBvbHkoKSkgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIGNvbnN0IHBvbHlBID0KICAgICAgICAgICAgICAgIGF3LkdldFRyYW5zZm9ybWVkQ29sbGlzaW9uUG9seSgpOwogICAgICAgICAgICBjb25zdCBwb2x5QiA9IGJ3LkdldFRyYW5zZm9ybWVkQ29sbGlzaW9uUG9seSgpOwogICAgICAgICAgICByZXR1cm4gcG9seUEuaW50ZXJzZWN0c1BvbHkocG9seUIsIGJ3LkdldFgoKSAtIGF3LkdldFgoKSwgYncuR2V0WSgpIC0gYXcuR2V0WSgpKQogICAgICAgIH0KICAgICAgICBfVGVzdE92ZXJsYXBfRGlmZmVyZW50TGF5ZXJzKGF3LCBidykgewogICAgICAgICAgICBjb25zdCBhSXNUaWxlTWFwID0gYXcuSGFzVGlsZW1hcCgpOwogICAgICAgICAgICBjb25zdCBiSXNUaWxlTWFwID0gYncuSGFzVGlsZW1hcCgpOwogICAgICAgICAgICBpZiAoYUlzVGlsZU1hcCAmJiAhYklzVGlsZU1hcCkgcmV0dXJuIHRoaXMuVGVzdFRpbGVtYXBPdmVybGFwRGlmZmVyZW50TGF5ZXJzKGF3LCBidyk7CiAgICAgICAgICAgIGVsc2UgaWYgKGJJc1RpbGVNYXAgJiYgIWFJc1RpbGVNYXApIHJldHVybiB0aGlzLlRlc3RUaWxlbWFwT3ZlcmxhcERpZmZlcmVudExheWVycyhidywgYXcpOwogICAgICAgICAgICBlbHNlIGlmICghYklzVGlsZU1hcCAmJiAhYUlzVGlsZU1hcCkgewogICAgICAgICAgICAgICAgY29uc3QgbGF5ZXJBID0gYXcuR2V0TGF5ZXIoKTsKICAgICAgICAgICAgICAgIGNvbnN0IGxheWVyQiA9IGJ3LkdldExheWVyKCk7CiAgICAgICAgICAgICAgICB0ZW1wUG9seUEuY29weShhdy5HZXRUcmFuc2Zvcm1lZENvbGxpc2lvblBvbHkoKSk7CiAgICAgICAgICAgICAgICB0ZW1wUG9seUIuY29weShidy5HZXRUcmFuc2Zvcm1lZENvbGxpc2lvblBvbHkoKSk7CiAgICAgICAgICAgICAgICBjb25zdCBwdHNBcnJBID0gdGVtcFBvbHlBLnBvaW50c0FycigpOwogICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IHB0c0FyckEubGVuZ3RoOyBpIDwgbGVuOyBpICs9IDIpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBqID0gaSArIDE7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgeCA9IHB0c0FyckFbaV07CiAgICAgICAgICAgICAgICAgICAgY29uc3QgeSA9IHB0c0FyckFbal07CiAgICAgICAgICAgICAgICAgICAgY29uc3QgW2x4LCBseV0gPSBsYXllckEuTGF5ZXJUb0NhbnZhc0Nzcyh4ICsgYXcuR2V0WCgpLCB5ICsgYXcuR2V0WSgpKTsKICAgICAgICAgICAgICAgICAgICBwdHNBcnJBW2ldID0gbHg7CiAgICAgICAgICAgICAgICAgICAgcHRzQXJyQVtqXSA9IGx5CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjb25zdCBwdHNBcnJCID0gdGVtcFBvbHlCLnBvaW50c0FycigpOwogICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IHB0c0FyckIubGVuZ3RoOyBpIDwgbGVuOyBpICs9IDIpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBqID0gaSArIDE7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgeCA9IHB0c0FyckJbaV07CiAgICAgICAgICAgICAgICAgICAgY29uc3QgeSA9IHB0c0FyckJbal07CiAgICAgICAgICAgICAgICAgICAgY29uc3QgW2x4LCBseV0gPSBsYXllckIuTGF5ZXJUb0NhbnZhc0Nzcyh4ICsgYncuR2V0WCgpLCB5ICsgYncuR2V0WSgpKTsKICAgICAgICAgICAgICAgICAgICBwdHNBcnJCW2ldID0gbHg7CiAgICAgICAgICAgICAgICAgICAgcHRzQXJyQltqXSA9IGx5CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0ZW1wUG9seUEuc2V0QmJveENoYW5nZWQoKTsKICAgICAgICAgICAgICAgIHRlbXBQb2x5Qi5zZXRCYm94Q2hhbmdlZCgpOwogICAgICAgICAgICAgICAgdGhpcy5fcG9seUNoZWNrQ291bnQrKzsKICAgICAgICAgICAgICAgIHJldHVybiB0ZW1wUG9seUEuaW50ZXJzZWN0c1BvbHkodGVtcFBvbHlCLCAwLCAwKQogICAgICAgICAgICB9IGVsc2UgcmV0dXJuIGZhbHNlCiAgICAgICAgfQogICAgICAgIFRlc3RUaWxlbWFwT3ZlcmxhcERpZmZlcmVudExheWVycyh0aWxlbWFwV2ksIG5vblRpbGVtYXBXaSkgewogICAgICAgICAgICBjb25zdCB0aWxlbWFwTGF5ZXIgPSB0aWxlbWFwV2kuR2V0TGF5ZXIoKTsKICAgICAgICAgICAgY29uc3Qgbm9uVGlsZW1hcExheWVyID0gbm9uVGlsZW1hcFdpLkdldExheWVyKCk7CiAgICAgICAgICAgIGlmICghdGVtcFBvbHlDKSB0ZW1wUG9seUMgPSBDMy5OZXcoQzMuQ29sbGlzaW9uUG9seSk7CiAgICAgICAgICAgIGlmICghdGVtcFJlY3QzKSB0ZW1wUmVjdDMgPSBDMy5OZXcoQzMuUmVjdCk7CiAgICAgICAgICAgIGlmICghdGVtcFF1YWRCKSB0ZW1wUXVhZEIgPSBDMy5OZXcoQzMuUXVhZCk7CiAgICAgICAgICAgIGNvbnN0IG5vblRpbGVtYXBYID0gbm9uVGlsZW1hcFdpLkdldFgoKTsKICAgICAgICAgICAgY29uc3Qgbm9uVGlsZW1hcFkgPSBub25UaWxlbWFwV2kuR2V0WSgpOwogICAgICAgICAgICBjb25zdCBbbHgsIGx5XSA9IG5vblRpbGVtYXBMYXllci5MYXllclRvQ2FudmFzQ3NzKG5vblRpbGVtYXBYLCBub25UaWxlbWFwWSk7CiAgICAgICAgICAgIGNvbnN0IFtub25UaWxlbWFwVHJhbnNmb3JtZWRYLCBub25UaWxlbWFwVHJhbnNmb3JtZWRZXSA9IHRpbGVtYXBMYXllci5DYW52YXNDc3NUb0xheWVyKGx4LCBseSk7CiAgICAgICAgICAgIGNvbnN0IGRlbHRhWCA9IG5vblRpbGVtYXBUcmFuc2Zvcm1lZFggLSBub25UaWxlbWFwWDsKICAgICAgICAgICAgY29uc3QgZGVsdGFZID0gbm9uVGlsZW1hcFRyYW5zZm9ybWVkWSAtIG5vblRpbGVtYXBZOwogICAgICAgICAgICB0ZW1wUmVjdDMuY29weShub25UaWxlbWFwV2kuR2V0Qm91bmRpbmdCb3goKSk7CiAgICAgICAgICAgIHRlbXBSZWN0My5vZmZzZXQoZGVsdGFYLCBkZWx0YVkpOwogICAgICAgICAgICBpZiAoIXRpbGVtYXBXaS5HZXRCb3VuZGluZ0JveCgpLmludGVyc2VjdHNSZWN0KHRlbXBSZWN0MykpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgdGVtcFF1YWRCLmNvcHkobm9uVGlsZW1hcFdpLkdldEJvdW5kaW5nUXVhZCgpKTsKICAgICAgICAgICAgdGVtcFF1YWRCLm9mZnNldChkZWx0YVgsIGRlbHRhWSk7CiAgICAgICAgICAgIHRoaXMuX3BvbHlDaGVja0NvdW50Kys7CiAgICAgICAgICAgIGlmICghdGlsZW1hcFdpLkdldEJvdW5kaW5nUXVhZCgpLmludGVyc2VjdHNRdWFkKHRlbXBRdWFkQikpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgdGVtcFBvbHlDLmNvcHkobm9uVGlsZW1hcFdpLkdldFRyYW5zZm9ybWVkQ29sbGlzaW9uUG9seSgpKTsKICAgICAgICAgICAgY29uc3QgcHRzQXJyQiA9IHRlbXBQb2x5Qy5wb2ludHNBcnIoKTsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IHB0c0FyckIubGVuZ3RoOyBpIDwgbGVuOyBpICs9IDIpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGogPSBpICsgMTsKICAgICAgICAgICAgICAgIHB0c0FyckJbaV0gKz0gZGVsdGFYOwogICAgICAgICAgICAgICAgcHRzQXJyQltqXSArPSBkZWx0YVkKICAgICAgICAgICAgfQogICAgICAgICAgICB0ZW1wUG9seUMuc2V0QmJveENoYW5nZWQoKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuVGVzdFRpbGVtYXBPdmVybGFwKHRpbGVtYXBXaSwgbm9uVGlsZW1hcFdpLCBub25UaWxlbWFwVHJhbnNmb3JtZWRYLCBub25UaWxlbWFwVHJhbnNmb3JtZWRZLCB0ZW1wUG9seUMsIHRlbXBSZWN0MywgdGVtcFF1YWRCKQogICAgICAgIH0KICAgICAgICBUZXN0VGlsZW1hcE92ZXJsYXAodG1XaSwgd2ksIHRyYW5zZm9ybWVkV2lYLCB0cmFuc2Zvcm1lZFdpWSwgdHJhbnNmb3JtZWRDb2xsaXNpb25Qb2x5LCB0cmFuc2Zvcm1lZEJvdW5kaW5nQm94LAogICAgICAgICAgICB0cmFuc2Zvcm1lZEJvdW5kaW5nUXVhZCkgewogICAgICAgICAgICBjb25zdCBiYm94ID0gdHJhbnNmb3JtZWRCb3VuZGluZ0JveCAhPT0gdW5kZWZpbmVkID8gdHJhbnNmb3JtZWRCb3VuZGluZ0JveCA6IHdpLkdldEJvdW5kaW5nQm94KCk7CiAgICAgICAgICAgIGNvbnN0IHRtWCA9IHRtV2kuR2V0WCgpOwogICAgICAgICAgICBjb25zdCB0bVkgPSB0bVdpLkdldFkoKTsKICAgICAgICAgICAgY29uc3QgdG1TZGtJbnN0ID0gdG1XaS5HZXRJbnN0YW5jZSgpLkdldFNka0luc3RhbmNlKCk7CiAgICAgICAgICAgIGNvbnN0IGluc3RYID0gdHJhbnNmb3JtZWRXaVggIT09IHVuZGVmaW5lZCA/IHRyYW5zZm9ybWVkV2lYIDogd2kuR2V0WCgpOwogICAgICAgICAgICBjb25zdCBpbnN0WSA9IHRyYW5zZm9ybWVkV2lZICE9PSB1bmRlZmluZWQgPyB0cmFuc2Zvcm1lZFdpWSA6IHdpLkdldFkoKTsKICAgICAgICAgICAgY29uc3QgaW5zdEhhc1BvbHkgPSB3aS5IYXNPd25Db2xsaXNpb25Qb2x5KCk7CiAgICAgICAgICAgIGNvbnN0IGluc3RRdWFkID0gdHJhbnNmb3JtZWRCb3VuZGluZ1F1YWQgIT09IHVuZGVmaW5lZCA/IHRyYW5zZm9ybWVkQm91bmRpbmdRdWFkIDogd2kuR2V0Qm91bmRpbmdRdWFkKCk7CiAgICAgICAgICAgIGNvbnN0IGNvbGxSZWN0cyA9IHRpbGVDb2xsUmVjdENhbmRpZGF0ZXM7CiAgICAgICAgICAgIHRtU2RrSW5zdC5HZXRDb2xsaXNpb25SZWN0Q2FuZGlkYXRlcyhiYm94LCBjb2xsUmVjdHMpOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gY29sbFJlY3RzLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7CiAgICAgICAgICAgICAgICBjb25zdCBjID0gY29sbFJlY3RzW2ldOwogICAgICAgICAgICAgICAgY29uc3QgcmMgPSBjLkdldFJlY3QoKTsKICAgICAgICAgICAgICAgIHRoaXMuX2NvbGxpc2lvbkNoZWNrQ291bnQrKzsKICAgICAgICAgICAgICAgIGlmIChiYm94LmludGVyc2VjdHNSZWN0T2Zmc2V0KHJjLCB0bVgsIHRtWSkpIHsKICAgICAgICAgICAgICAgICAgICB0ZW1wUXVhZC5zZXRGcm9tUmVjdChyYyk7CiAgICAgICAgICAgICAgICAgICAgdGVtcFF1YWQub2Zmc2V0KHRtWCwgdG1ZKTsKICAgICAgICAgICAgICAgICAgICBpZiAodGVtcFF1YWQuaW50ZXJzZWN0c1F1YWQoaW5zdFF1YWQpKQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5zdEhhc1BvbHkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGluc3RQb2x5ID0gdHJhbnNmb3JtZWRDb2xsaXNpb25Qb2x5ICE9PSB1bmRlZmluZWQgPyB0cmFuc2Zvcm1lZENvbGxpc2lvblBvbHkgOiB3aS5HZXRUcmFuc2Zvcm1lZENvbGxpc2lvblBvbHkoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBpbnN0T2ZmWCA9IGluc3RYOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGluc3RPZmZZID0gaW5zdFk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHJhbnNmb3JtZWRDb2xsaXNpb25Qb2x5ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnN0T2ZmWCA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpLkdldFgoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnN0T2ZmWSA9IHdpLkdldFkoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdGlsZVBvbHkgPSBjLkdldFBvbHkoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aWxlUG9seSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3BvbHlDaGVja0NvdW50Kys7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRpbGVQb2x5LmludGVyc2VjdHNQb2x5KGluc3RQb2x5LCBpbnN0T2ZmWCAtICh0bVggKyByYy5nZXRMZWZ0KCkpLCBpbnN0T2ZmWSAtICh0bVkgKyByYy5nZXRUb3AoKSkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEMzLmNsZWFyQXJyYXkoY29sbFJlY3RzKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBQb2x5QS5zZXRGcm9tUXVhZCh0ZW1wUXVhZCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRlbXBQb2x5QS5pbnRlcnNlY3RzUG9seShpbnN0UG9seSwgaW5zdE9mZlgsIGluc3RPZmZZKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDMy5jbGVhckFycmF5KGNvbGxSZWN0cyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdGlsZVBvbHkgPSBjLkdldFBvbHkoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aWxlUG9seSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBQb2x5QS5zZXRGcm9tUXVhZChpbnN0UXVhZCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRpbGVQb2x5LmludGVyc2VjdHNQb2x5KHRlbXBQb2x5QSwgLSh0bVggKyByYy5nZXRMZWZ0KCkpLCAtKHRtWSArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByYy5nZXRUb3AoKSkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEMzLmNsZWFyQXJyYXkoY29sbFJlY3RzKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEMzLmNsZWFyQXJyYXkoY29sbFJlY3RzKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgQzMuY2xlYXJBcnJheShjb2xsUmVjdHMpOwogICAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICB9CiAgICAgICAgVGVzdEFuZFNlbGVjdENhbnZhc1BvaW50T3ZlcmxhcChvYmplY3RDbGFzcywgcHR4LCBwdHksIGlzSW52ZXJ0ZWQpIHsKICAgICAgICAgICAgY29uc3Qgc29sID0gb2JqZWN0Q2xhc3MuR2V0Q3VycmVudFNvbCgpOwogICAgICAgICAgICBjb25zdCBjdXJyZW50RXZlbnQgPSB0aGlzLl9ydW50aW1lLkdldEN1cnJlbnRFdmVudCgpOwogICAgICAgICAgICBpZiAoIWN1cnJlbnRFdmVudCkgdGhyb3cgbmV3IEVycm9yKCJjYW5ub3QgY2FsbCBvdXRzaWRlIGV2ZW50Iik7CiAgICAgICAgICAgIGNvbnN0IGlzT3JCbG9jayA9IGN1cnJlbnRFdmVudC5Jc09yQmxvY2soKTsKICAgICAgICAgICAgY29uc3QgaW50ZXJhY3RpdmVMYXllcnNDYWNoZSA9IG5ldyBNYXA7CiAgICAgICAgICAgIGNvbnN0IGlzTGF5ZXJJbnRlcmFjdGl2ZSA9IGxheWVyID0+IHsKICAgICAgICAgICAgICAgIGxldCByZXQgPSBpbnRlcmFjdGl2ZUxheWVyc0NhY2hlLmdldChsYXllcik7CiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHJldCA9PT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgICAgICAgICAgICByZXQgPSBsYXllci5Jc1NlbGZBbmRQYXJlbnRzSW50ZXJhY3RpdmUoKTsKICAgICAgICAgICAgICAgICAgICBpbnRlcmFjdGl2ZUxheWVyc0NhY2hlLnNldChsYXllciwgcmV0KQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHJldAogICAgICAgICAgICB9OwogICAgICAgICAgICBpZiAoc29sLklzU2VsZWN0QWxsKCkpIHsKICAgICAgICAgICAgICAgIGlmICghaXNJbnZlcnRlZCkgewogICAgICAgICAgICAgICAgICAgIHNvbC5fU2V0U2VsZWN0QWxsKGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICBDMy5jbGVhckFycmF5KHNvbC5fR2V0T3duSW5zdGFuY2VzKCkpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGluc3Qgb2Ygb2JqZWN0Q2xhc3MuR2V0SW5zdGFuY2VzKCkpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCB3aSA9IGluc3QuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgbGF5ZXIgPSB3aS5HZXRMYXllcigpOwogICAgICAgICAgICAgICAgICAgIGxldCBjb250YWluc1BvaW50ID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTGF5ZXJJbnRlcmFjdGl2ZShsYXllcikgJiYgd2kuSXNJblZpZXdwb3J0MigpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IFtseCwgbHldID0gbGF5ZXIuQ2FudmFzQ3NzVG9MYXllcihwdHgsIHB0eSwgd2kuR2V0VG90YWxaRWxldmF0aW9uKCkpOwogICAgICAgICAgICAgICAgICAgICAgICBjb250YWluc1BvaW50ID0gd2kuQ29udGFpbnNQb2ludChseCwgbHkpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChjb250YWluc1BvaW50KQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNJbnZlcnRlZCkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHNvbC5fUHVzaEluc3RhbmNlKGluc3QpOwogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGlzT3JCbG9jaykgc29sLl9QdXNoRWxzZUluc3RhbmNlKGluc3QpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBsZXQgYXJyOwogICAgICAgICAgICAgICAgbGV0IGlzUGlja2luZ0Vsc2VJbnN0YW5jZXMgPSBmYWxzZTsKICAgICAgICAgICAgICAgIGlmIChpc09yQmxvY2spCiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX3J1bnRpbWUuSXNDdXJyZW50Q29uZGl0aW9uRmlyc3QoKSAmJiAhc29sLl9HZXRPd25FbHNlSW5zdGFuY2VzKCkubGVuZ3RoICYmIHNvbC5fR2V0T3duSW5zdGFuY2VzKCkubGVuZ3RoKSBhcnIgPSBzb2wuX0dldE93bkluc3RhbmNlcygpOwogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBhcnIgPSBzb2wuX0dldE93bkVsc2VJbnN0YW5jZXMoKTsKICAgICAgICAgICAgICAgICAgICAgICAgaXNQaWNraW5nRWxzZUluc3RhbmNlcyA9IHRydWUKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIGFyciA9IHNvbC5fR2V0T3duSW5zdGFuY2VzKCk7CiAgICAgICAgICAgICAgICBsZXQgaiA9IDA7CiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gYXJyLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5zdCA9IGFycltpXTsKICAgICAgICAgICAgICAgICAgICBjb25zdCB3aSA9IGluc3QuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgbGF5ZXIgPSB3aS5HZXRMYXllcigpOwogICAgICAgICAgICAgICAgICAgIGxldCBjb250YWluc1BvaW50ID0KICAgICAgICAgICAgICAgICAgICAgICAgZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTGF5ZXJJbnRlcmFjdGl2ZShsYXllcikgJiYgd2kuSXNJblZpZXdwb3J0MigpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IFtseCwgbHldID0gbGF5ZXIuQ2FudmFzQ3NzVG9MYXllcihwdHgsIHB0eSwgd2kuR2V0VG90YWxaRWxldmF0aW9uKCkpOwogICAgICAgICAgICAgICAgICAgICAgICBjb250YWluc1BvaW50ID0gd2kuQ29udGFpbnNQb2ludChseCwgbHkpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChjb250YWluc1BvaW50KQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNJbnZlcnRlZCkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChpc1BpY2tpbmdFbHNlSW5zdGFuY2VzKSBzb2wuX1B1c2hJbnN0YW5jZShpbnN0KTsKICAgICAgICAgICAgICAgICAgICBlbHNlIGFycltqKytdID0gaW5zdDsKICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChpc1BpY2tpbmdFbHNlSW5zdGFuY2VzKSBhcnJbaisrXSA9IGluc3Q7CiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoaXNPckJsb2NrKSBzb2wuX1B1c2hFbHNlSW5zdGFuY2UoaW5zdCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICghaXNJbnZlcnRlZCkgYXJyLmxlbmd0aCA9IGoKICAgICAgICAgICAgfQogICAgICAgICAgICBvYmplY3RDbGFzcy5BcHBseVNvbFRvQ29udGFpbmVyKCk7CiAgICAgICAgICAgIGludGVyYWN0aXZlTGF5ZXJzQ2FjaGUuY2xlYXIoKTsKICAgICAgICAgICAgaWYgKGlzSW52ZXJ0ZWQpIHJldHVybiB0cnVlOwogICAgICAgICAgICBlbHNlIHJldHVybiBzb2wuSGFzQW55SW5zdGFuY2VzKCkKICAgICAgICB9CiAgICAgICAgR2V0Q29sbGlzaW9uQ2FuZGlkYXRlcyhsYXllciwKICAgICAgICAgICAgcnR5cGUsIGJib3gsIGNhbmRpZGF0ZXMpIHsKICAgICAgICAgICAgY29uc3QgaXNQYXJhbGxheGVkID0gbGF5ZXIgPyBsYXllci5HZXRQYXJhbGxheFgoKSAhPT0gMSB8fCBsYXllci5HZXRQYXJhbGxheFkoKSAhPT0gMSA6IGZhbHNlOwogICAgICAgICAgICBpZiAocnR5cGUuSXNGYW1pbHkoKSkKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgbWVtYmVyVHlwZSBvZiBydHlwZS5HZXRGYW1pbHlNZW1iZXJzKCkpCiAgICAgICAgICAgICAgICAgICAgaWYgKGlzUGFyYWxsYXhlZCB8fCBtZW1iZXJUeXBlLklzQW55SW5zdGFuY2VQYXJhbGxheGVkKCkpIEMzLmFwcGVuZEFycmF5KGNhbmRpZGF0ZXMsIG1lbWJlclR5cGUuR2V0SW5zdGFuY2VzKCkpOwogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBtZW1iZXJUeXBlLl9VcGRhdGVBbGxDb2xsaXNpb25DZWxscygpOwogICAgICAgICAgICAgICAgICAgICAgICBtZW1iZXJUeXBlLl9HZXRDb2xsaXNpb25DZWxsR3JpZCgpLlF1ZXJ5UmFuZ2UoYmJveCwgY2FuZGlkYXRlcykKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgaWYgKGlzUGFyYWxsYXhlZCB8fCBydHlwZS5Jc0FueUluc3RhbmNlUGFyYWxsYXhlZCgpKSBDMy5hcHBlbmRBcnJheShjYW5kaWRhdGVzLCBydHlwZS5HZXRJbnN0YW5jZXMoKSk7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgcnR5cGUuX1VwZGF0ZUFsbENvbGxpc2lvbkNlbGxzKCk7CiAgICAgICAgICAgICAgICBydHlwZS5fR2V0Q29sbGlzaW9uQ2VsbEdyaWQoKS5RdWVyeVJhbmdlKGJib3gsIGNhbmRpZGF0ZXMpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgR2V0T2JqZWN0Q2xhc3Nlc0NvbGxpc2lvbkNhbmRpZGF0ZXMobGF5ZXIsIG9iamVjdENsYXNzZXMsIGJib3gsIGNhbmRpZGF0ZXMpIHsKICAgICAgICAgICAgZm9yIChjb25zdCBvYmplY3RDbGFzcyBvZiBvYmplY3RDbGFzc2VzKSB0aGlzLkdldENvbGxpc2lvbkNhbmRpZGF0ZXMobGF5ZXIsIG9iamVjdENsYXNzLCBiYm94LCBjYW5kaWRhdGVzKQogICAgICAgIH0KICAgICAgICBHZXRTb2xpZENvbGxpc2lvbkNhbmRpZGF0ZXMobGF5ZXIsIGJib3gsIGNhbmRpZGF0ZXMpIHsKICAgICAgICAgICAgY29uc3Qgc29saWRCZWhhdmlvciA9IHRoaXMuX3J1bnRpbWUuR2V0U29saWRCZWhhdmlvcigpOwogICAgICAgICAgICBpZiAoIXNvbGlkQmVoYXZpb3IpIHJldHVybjsKICAgICAgICAgICAgdGhpcy5HZXRPYmplY3RDbGFzc2VzQ29sbGlzaW9uQ2FuZGlkYXRlcyhsYXllciwgc29saWRCZWhhdmlvci5HZXRPYmplY3RDbGFzc2VzKCksIGJib3gsIGNhbmRpZGF0ZXMpCiAgICAgICAgfQogICAgICAgIEdldEp1bXB0aHJ1Q29sbGlzaW9uQ2FuZGlkYXRlcyhsYXllciwgYmJveCwKICAgICAgICAgICAgY2FuZGlkYXRlcykgewogICAgICAgICAgICBjb25zdCBqdW1wdGhydUJlaGF2aW9yID0gdGhpcy5fcnVudGltZS5HZXRKdW1wdGhydUJlaGF2aW9yKCk7CiAgICAgICAgICAgIGlmICghanVtcHRocnVCZWhhdmlvcikgcmV0dXJuOwogICAgICAgICAgICB0aGlzLkdldE9iamVjdENsYXNzZXNDb2xsaXNpb25DYW5kaWRhdGVzKGxheWVyLCBqdW1wdGhydUJlaGF2aW9yLkdldE9iamVjdENsYXNzZXMoKSwgYmJveCwgY2FuZGlkYXRlcykKICAgICAgICB9CiAgICAgICAgSXNTb2xpZENvbGxpc2lvbkFsbG93ZWQoc29saWRJbnN0LCBpbnN0KSB7CiAgICAgICAgICAgIHJldHVybiBzb2xpZEluc3QuX0lzU29saWRFbmFibGVkKCkgJiYgKCFpbnN0IHx8IGluc3QuR2V0V29ybGRJbmZvKCkuSXNTb2xpZENvbGxpc2lvbkFsbG93ZWQoc29saWRJbnN0LkdldFNhdmVkRGF0YU1hcCgpLmdldCgic29saWRUYWdzIikpKQogICAgICAgIH0KICAgICAgICBUZXN0T3ZlcmxhcFNvbGlkKGluc3QpIHsKICAgICAgICAgICAgY29uc3Qgd2kgPSBpbnN0LkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICB0aGlzLkdldFNvbGlkQ29sbGlzaW9uQ2FuZGlkYXRlcyh3aS5HZXRMYXllcigpLCB3aS5HZXRCb3VuZGluZ0JveCgpLCB0ZW1wQ2FuZGlkYXRlcyk7CiAgICAgICAgICAgIGZvciAoY29uc3QgcyBvZiB0ZW1wQ2FuZGlkYXRlcykgewogICAgICAgICAgICAgICAgaWYgKCF0aGlzLklzU29saWRDb2xsaXNpb25BbGxvd2VkKHMsIGluc3QpKSBjb250aW51ZTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLlRlc3RPdmVybGFwKGluc3QsIHMpKSB7CiAgICAgICAgICAgICAgICAgICAgQzMuY2xlYXJBcnJheSh0ZW1wQ2FuZGlkYXRlcyk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHMKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBDMy5jbGVhckFycmF5KHRlbXBDYW5kaWRhdGVzKTsKICAgICAgICAgICAgcmV0dXJuIG51bGwKICAgICAgICB9CiAgICAgICAgVGVzdFJlY3RPdmVybGFwU29saWQocmVjdCwgaW5zdCkgewogICAgICAgICAgICB0aGlzLkdldFNvbGlkQ29sbGlzaW9uQ2FuZGlkYXRlcyhudWxsLCByZWN0LCB0ZW1wQ2FuZGlkYXRlcyk7CiAgICAgICAgICAgIGZvciAoY29uc3QgcyBvZiB0ZW1wQ2FuZGlkYXRlcykgewogICAgICAgICAgICAgICAgaWYgKCF0aGlzLklzU29saWRDb2xsaXNpb25BbGxvd2VkKHMsIGluc3QpKSBjb250aW51ZTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLlRlc3RSZWN0T3ZlcmxhcChyZWN0LCBzKSkgewogICAgICAgICAgICAgICAgICAgIEMzLmNsZWFyQXJyYXkodGVtcENhbmRpZGF0ZXMpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBzCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgQzMuY2xlYXJBcnJheSh0ZW1wQ2FuZGlkYXRlcyk7CiAgICAgICAgICAgIHJldHVybiBudWxsCiAgICAgICAgfQogICAgICAgIFRlc3RPdmVybGFwSnVtcHRocnUoaW5zdCwKICAgICAgICAgICAgYWxsKSB7CiAgICAgICAgICAgIGxldCByZXQgPSBudWxsOwogICAgICAgICAgICBpZiAoYWxsKSB7CiAgICAgICAgICAgICAgICByZXQgPSB0ZW1wSnVtcHRocnVSZXQ7CiAgICAgICAgICAgICAgICBDMy5jbGVhckFycmF5KHJldCkKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCB3aSA9IGluc3QuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgIHRoaXMuR2V0SnVtcHRocnVDb2xsaXNpb25DYW5kaWRhdGVzKHdpLkdldExheWVyKCksIHdpLkdldEJvdW5kaW5nQm94KCksIHRlbXBDYW5kaWRhdGVzKTsKICAgICAgICAgICAgZm9yIChjb25zdCBqIG9mIHRlbXBDYW5kaWRhdGVzKSB7CiAgICAgICAgICAgICAgICBpZiAoIWouX0lzSnVtcHRocnVFbmFibGVkKCkpIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuVGVzdE92ZXJsYXAoaW5zdCwgaikpCiAgICAgICAgICAgICAgICAgICAgaWYgKGFsbCkgcmV0LnB1c2goaik7CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIEMzLmNsZWFyQXJyYXkodGVtcENhbmRpZGF0ZXMpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gagogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBDMy5jbGVhckFycmF5KHRlbXBDYW5kaWRhdGVzKTsKICAgICAgICAgICAgcmV0dXJuIHJldAogICAgICAgIH0KICAgICAgICBQdXNoT3V0KGluc3QsIHhkaXIsIHlkaXIsIGRpc3QsIG90aGVySW5zdCkgewogICAgICAgICAgICBkaXN0ID0gZGlzdCB8fCA1MDsKICAgICAgICAgICAgY29uc3Qgd2kgPSBpbnN0LkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICBjb25zdCBvbGRYID0gd2kuR2V0WCgpOwogICAgICAgICAgICBjb25zdCBvbGRZID0gd2kuR2V0WSgpOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGRpc3Q7ICsraSkgewogICAgICAgICAgICAgICAgd2kuU2V0WFkob2xkWCArIHhkaXIgKiBpLCBvbGRZICsgeWRpciAqIGkpOwogICAgICAgICAgICAgICAgd2kuU2V0QmJveENoYW5nZWQoKTsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5UZXN0T3ZlcmxhcChpbnN0LCBvdGhlckluc3QpKSByZXR1cm4gdHJ1ZQogICAgICAgICAgICB9CiAgICAgICAgICAgIHdpLlNldFhZKG9sZFgsIG9sZFkpOwogICAgICAgICAgICB3aS5TZXRCYm94Q2hhbmdlZCgpOwogICAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICB9CiAgICAgICAgUHVzaE91dFNvbGlkKGluc3QsIHhkaXIsIHlkaXIsIGRpc3QsIGluY2x1ZGVKdW1wdGhydXMsIHNwZWNpZmljSnVtcHRocnUpIHsKICAgICAgICAgICAgZGlzdCA9IGRpc3QgfHwgNTA7CiAgICAgICAgICAgIGNvbnN0IHdpID0gaW5zdC5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgY29uc3Qgb2xkWCA9IHdpLkdldFgoKTsKICAgICAgICAgICAgY29uc3Qgb2xkWSA9IHdpLkdldFkoKTsKICAgICAgICAgICAgbGV0IGxhc3RPdmVybGFwcGVkID0gbnVsbDsKICAgICAgICAgICAgbGV0IHNlY29uZExhc3RPdmVybGFwcGVkID0gbnVsbDsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkaXN0OyArK2kpIHsKICAgICAgICAgICAgICAgIHdpLlNldFhZKG9sZFggKyB4ZGlyICogaSwgb2xkWSArIHlkaXIgKiBpKTsKICAgICAgICAgICAgICAgIHdpLlNldEJib3hDaGFuZ2VkKCk7CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuVGVzdE92ZXJsYXAoaW5zdCwgbGFzdE92ZXJsYXBwZWQpKSB7CiAgICAgICAgICAgICAgICAgICAgbGFzdE92ZXJsYXBwZWQgPQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLlRlc3RPdmVybGFwU29saWQoaW5zdCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGxhc3RPdmVybGFwcGVkKSBzZWNvbmRMYXN0T3ZlcmxhcHBlZCA9IGxhc3RPdmVybGFwcGVkOwogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5jbHVkZUp1bXB0aHJ1cykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNwZWNpZmljSnVtcHRocnUpIGxhc3RPdmVybGFwcGVkID0gdGhpcy5UZXN0T3ZlcmxhcChpbnN0LCBzcGVjaWZpY0p1bXB0aHJ1KSA/IHNwZWNpZmljSnVtcHRocnUgOiBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBsYXN0T3ZlcmxhcHBlZCA9IHRoaXMuVGVzdE92ZXJsYXBKdW1wdGhydShpbnN0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsYXN0T3ZlcmxhcHBlZCkgc2Vjb25kTGFzdE92ZXJsYXBwZWQgPSBsYXN0T3ZlcmxhcHBlZAogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghbGFzdE92ZXJsYXBwZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZWNvbmRMYXN0T3ZlcmxhcHBlZCkgdGhpcy5QdXNoSW5GcmFjdGlvbmFsKGluc3QsIHhkaXIsIHlkaXIsIHNlY29uZExhc3RPdmVybGFwcGVkLCAxNiwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHdpLlNldFhZKG9sZFgsIG9sZFkpOwogICAgICAgICAgICB3aS5TZXRCYm94Q2hhbmdlZCgpOwogICAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICB9CiAgICAgICAgUHVzaE91dFNvbGlkQXhpcyhpbnN0LAogICAgICAgICAgICB4ZGlyLCB5ZGlyLCBkaXN0KSB7CiAgICAgICAgICAgIGRpc3QgPSBkaXN0IHx8IDUwOwogICAgICAgICAgICBjb25zdCB3aSA9IGluc3QuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgIGNvbnN0IG9sZFggPSB3aS5HZXRYKCk7CiAgICAgICAgICAgIGNvbnN0IG9sZFkgPSB3aS5HZXRZKCk7CiAgICAgICAgICAgIGxldCBsYXN0T3ZlcmxhcHBlZCA9IG51bGw7CiAgICAgICAgICAgIGxldCBzZWNvbmRMYXN0T3ZlcmxhcHBlZCA9IG51bGw7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGlzdDsgKytpKQogICAgICAgICAgICAgICAgZm9yIChsZXQgd2hpY2ggPSAwOyB3aGljaCA8IDI7ICsrd2hpY2gpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBzaWduID0gd2hpY2ggKiAyIC0gMTsKICAgICAgICAgICAgICAgICAgICB3aS5TZXRYWShvbGRYICsgeGRpciAqIGkgKiBzaWduLCBvbGRZICsgeWRpciAqIGkgKiBzaWduKTsKICAgICAgICAgICAgICAgICAgICB3aS5TZXRCYm94Q2hhbmdlZCgpOwogICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5UZXN0T3ZlcmxhcChpbnN0LCBsYXN0T3ZlcmxhcHBlZCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbGFzdE92ZXJsYXBwZWQgPSB0aGlzLlRlc3RPdmVybGFwU29saWQoaW5zdCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsYXN0T3ZlcmxhcHBlZCkgc2Vjb25kTGFzdE92ZXJsYXBwZWQgPSBsYXN0T3ZlcmxhcHBlZDsKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2Vjb25kTGFzdE92ZXJsYXBwZWQpIHRoaXMuUHVzaEluRnJhY3Rpb25hbChpbnN0LCB4ZGlyICogc2lnbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB5ZGlyICogc2lnbiwgc2Vjb25kTGFzdE92ZXJsYXBwZWQsIDE2LCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIHdpLlNldFhZKG9sZFgsIG9sZFkpOwogICAgICAgICAgICB3aS5TZXRCYm94Q2hhbmdlZCgpOwogICAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICB9CiAgICAgICAgUHVzaEluRnJhY3Rpb25hbChpbnN0LCB4ZGlyLCB5ZGlyLCBvdGhlckluc3QsIGxpbWl0LCBpbmNsdWRlQW55U29saWQpIHsKICAgICAgICAgICAgbGV0IGRpdmlzb3IgPSAyOwogICAgICAgICAgICBsZXQgZm9yd2FyZCA9IGZhbHNlOwogICAgICAgICAgICBsZXQgb3ZlcmxhcHBpbmcgPSBmYWxzZTsKICAgICAgICAgICAgY29uc3Qgd2kgPSBpbnN0LkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICBsZXQgYmVzdFggPSB3aS5HZXRYKCk7CiAgICAgICAgICAgIGxldCBiZXN0WSA9IHdpLkdldFkoKTsKICAgICAgICAgICAgd2hpbGUgKGRpdmlzb3IgPD0gbGltaXQpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGZyYWMgPSAxIC8gZGl2aXNvcjsKICAgICAgICAgICAgICAgIGRpdmlzb3IgKj0gMjsKICAgICAgICAgICAgICAgIHdpLk9mZnNldFhZKHhkaXIgKiBmcmFjICogKGZvcndhcmQgPyAxIDogLTEpLCB5ZGlyICogZnJhYyAqIChmb3J3YXJkID8gMSA6IC0xKSk7CiAgICAgICAgICAgICAgICB3aS5TZXRCYm94Q2hhbmdlZCgpOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuVGVzdE92ZXJsYXAoaW5zdCwgb3RoZXJJbnN0KSB8fCBpbmNsdWRlQW55U29saWQgJiYgdGhpcy5UZXN0T3ZlcmxhcFNvbGlkKGluc3QpKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yd2FyZCA9CiAgICAgICAgICAgICAgICAgICAgICAgIHRydWU7CiAgICAgICAgICAgICAgICAgICAgb3ZlcmxhcHBpbmcgPSB0cnVlCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGZvcndhcmQgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICBvdmVybGFwcGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIGJlc3RYID0gd2kuR2V0WCgpOwogICAgICAgICAgICAgICAgICAgIGJlc3RZID0gd2kuR2V0WSgpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG92ZXJsYXBwaW5nKSB7CiAgICAgICAgICAgICAgICB3aS5TZXRYWShiZXN0WCwgYmVzdFkpOwogICAgICAgICAgICAgICAgd2kuU2V0QmJveENoYW5nZWQoKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIFB1c2hPdXRTb2xpZE5lYXJlc3QoaW5zdCwgbWF4RGlzdCA9IDEwMCkgewogICAgICAgICAgICBsZXQgZGlzdCA9IDA7CiAgICAgICAgICAgIGNvbnN0IHdpID0gaW5zdC5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgY29uc3Qgb2xkWCA9IHdpLkdldFgoKTsKICAgICAgICAgICAgY29uc3Qgb2xkWSA9IHdpLkdldFkoKTsKICAgICAgICAgICAgbGV0IGRpciA9IDA7CiAgICAgICAgICAgIGxldCBsYXN0T3ZlcmxhcHBlZCA9IHRoaXMuVGVzdE92ZXJsYXBTb2xpZChpbnN0KTsKICAgICAgICAgICAgaWYgKCFsYXN0T3ZlcmxhcHBlZCkgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIHdoaWxlIChkaXN0IDw9IG1heERpc3QpIHsKICAgICAgICAgICAgICAgIGxldCBkeCA9IDA7CiAgICAgICAgICAgICAgICBsZXQgZHkgPSAwOwogICAgICAgICAgICAgICAgc3dpdGNoIChkaXIpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICAgIGR4ID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgZHkgPSAtMTsKICAgICAgICAgICAgICAgICAgICAgICAgZGlzdCsrOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICAgICAgICAgIGR4ID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgZHkgPSAtMTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgICAgICAgICBkeCA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgIGR5ID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgICAgICAgICBkeCA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgIGR5ID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDE7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgICAgICAgICAgZHggPSAwOwogICAgICAgICAgICAgICAgICAgICAgICBkeSA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgICAgICAgICAgZHggPSAtMTsKICAgICAgICAgICAgICAgICAgICAgICAgZHkgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgICAgICAgICAgIGR4ID0gLTE7CiAgICAgICAgICAgICAgICAgICAgICAgIGR5ID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgICAgICAgICBkeCA9IC0xOwogICAgICAgICAgICAgICAgICAgICAgICBkeSA9IC0xOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZGlyID0gKGRpciArIDEpICUgODsKICAgICAgICAgICAgICAgIHdpLlNldFhZKE1hdGguZmxvb3Iob2xkWCArIGR4ICogZGlzdCksIE1hdGguZmxvb3Iob2xkWSArIGR5ICogZGlzdCkpOwogICAgICAgICAgICAgICAgd2kuU2V0QmJveENoYW5nZWQoKTsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5UZXN0T3ZlcmxhcChpbnN0LCBsYXN0T3ZlcmxhcHBlZCkpIHsKICAgICAgICAgICAgICAgICAgICBsYXN0T3ZlcmxhcHBlZCA9IHRoaXMuVGVzdE92ZXJsYXBTb2xpZChpbnN0KTsKICAgICAgICAgICAgICAgICAgICBpZiAoIWxhc3RPdmVybGFwcGVkKSByZXR1cm4gdHJ1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHdpLlNldFhZKG9sZFgsIG9sZFkpOwogICAgICAgICAgICB3aS5TZXRCYm94Q2hhbmdlZCgpOwogICAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICB9CiAgICAgICAgQ2FsY3VsYXRlQm91bmNlQW5nbGUoaW5zdCwgc3RhcnRYLCBzdGFydFksIG90aGVySW5zdCkgewogICAgICAgICAgICBjb25zdCB3aSA9IGluc3QuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgIGNvbnN0IG9sZFggPSB3aS5HZXRYKCk7CiAgICAgICAgICAgIGNvbnN0IG9sZFkgPSB3aS5HZXRZKCk7CiAgICAgICAgICAgIGNvbnN0IHJhZGl1cyA9CiAgICAgICAgICAgICAgICBNYXRoLm1heCgxMCwgQzMuZGlzdGFuY2VUbyhzdGFydFgsIHN0YXJ0WSwgb2xkWCwgb2xkWSkpOwogICAgICAgICAgICBjb25zdCBzdGFydEFuZ2xlID0gQzMuYW5nbGVUbyhzdGFydFgsIHN0YXJ0WSwgb2xkWCwgb2xkWSk7CiAgICAgICAgICAgIGNvbnN0IGZpcnN0SW5zdCA9IG90aGVySW5zdCB8fCB0aGlzLlRlc3RPdmVybGFwU29saWQoaW5zdCk7CiAgICAgICAgICAgIGlmICghZmlyc3RJbnN0KSByZXR1cm4gQzMuY2xhbXBBbmdsZShzdGFydEFuZ2xlICsgTWF0aC5QSSk7CiAgICAgICAgICAgIGxldCBjdXJJbnN0ID0gZmlyc3RJbnN0OwogICAgICAgICAgICBsZXQgYW50aWNsb2Nrd2lzZUZyZWVBbmdsZSA9IDA7CiAgICAgICAgICAgIGxldCBjbG9ja3dpc2VGcmVlQW5nbGUgPSAwOwogICAgICAgICAgICBjb25zdCBpbmNyZW1lbnQgPSBDMy50b1JhZGlhbnMoNSk7CiAgICAgICAgICAgIGxldCBpOwogICAgICAgICAgICBmb3IgKGkgPSAxOyBpIDwgMzY7ICsraSkgewogICAgICAgICAgICAgICAgY29uc3QgY3VyQW5nbGUgPSBzdGFydEFuZ2xlIC0gaSAqIGluY3JlbWVudDsKICAgICAgICAgICAgICAgIHdpLlNldFhZKHN0YXJ0WCArIE1hdGguY29zKGN1ckFuZ2xlKSAqIHJhZGl1cywgc3RhcnRZICsgTWF0aC5zaW4oY3VyQW5nbGUpICogcmFkaXVzKTsKICAgICAgICAgICAgICAgIHdpLlNldEJib3hDaGFuZ2VkKCk7CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuVGVzdE92ZXJsYXAoaW5zdCwKICAgICAgICAgICAgICAgICAgICAgICAgY3VySW5zdCkpIHsKICAgICAgICAgICAgICAgICAgICBjdXJJbnN0ID0gb3RoZXJJbnN0ID8gbnVsbCA6IHRoaXMuVGVzdE92ZXJsYXBTb2xpZChpbnN0KTsKICAgICAgICAgICAgICAgICAgICBpZiAoIWN1ckluc3QpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYW50aWNsb2Nrd2lzZUZyZWVBbmdsZSA9IGN1ckFuZ2xlOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoaSA9PT0gMzYpIGFudGljbG9ja3dpc2VGcmVlQW5nbGUgPSBDMy5jbGFtcEFuZ2xlKHN0YXJ0QW5nbGUgKyBNYXRoLlBJKTsKICAgICAgICAgICAgY3VySW5zdCA9IGZpcnN0SW5zdDsKICAgICAgICAgICAgZm9yIChpID0gMTsgaSA8IDM2OyArK2kpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGN1ckFuZ2xlID0gc3RhcnRBbmdsZSArIGkgKiBpbmNyZW1lbnQ7CiAgICAgICAgICAgICAgICB3aS5TZXRYWShzdGFydFggKyBNYXRoLmNvcyhjdXJBbmdsZSkgKiByYWRpdXMsIHN0YXJ0WSArIE1hdGguc2luKGN1ckFuZ2xlKSAqIHJhZGl1cyk7CiAgICAgICAgICAgICAgICB3aS5TZXRCYm94Q2hhbmdlZCgpOwogICAgICAgICAgICAgICAgaWYgKCF0aGlzLlRlc3RPdmVybGFwKGluc3QsIGN1ckluc3QpKSB7CiAgICAgICAgICAgICAgICAgICAgY3VySW5zdCA9IG90aGVySW5zdCA/IG51bGwgOiB0aGlzLlRlc3RPdmVybGFwU29saWQoaW5zdCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFjdXJJbnN0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNsb2Nrd2lzZUZyZWVBbmdsZSA9IGN1ckFuZ2xlOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoaSA9PT0gMzYpIGNsb2Nrd2lzZUZyZWVBbmdsZSA9CiAgICAgICAgICAgICAgICBDMy5jbGFtcEFuZ2xlKHN0YXJ0QW5nbGUgKyBNYXRoLlBJKTsKICAgICAgICAgICAgd2kuU2V0WFkob2xkWCwgb2xkWSk7CiAgICAgICAgICAgIHdpLlNldEJib3hDaGFuZ2VkKCk7CiAgICAgICAgICAgIGlmIChjbG9ja3dpc2VGcmVlQW5nbGUgPT09IGFudGljbG9ja3dpc2VGcmVlQW5nbGUpIHJldHVybiBjbG9ja3dpc2VGcmVlQW5nbGU7CiAgICAgICAgICAgIGNvbnN0IGhhbGZEaWZmID0gQzMuYW5nbGVEaWZmKGNsb2Nrd2lzZUZyZWVBbmdsZSwgYW50aWNsb2Nrd2lzZUZyZWVBbmdsZSkgLyAyOwogICAgICAgICAgICBsZXQgbm9ybWFsOwogICAgICAgICAgICBpZiAoQzMuYW5nbGVDbG9ja3dpc2UoY2xvY2t3aXNlRnJlZUFuZ2xlLCBhbnRpY2xvY2t3aXNlRnJlZUFuZ2xlKSkgbm9ybWFsID0gQzMuY2xhbXBBbmdsZShhbnRpY2xvY2t3aXNlRnJlZUFuZ2xlICsgaGFsZkRpZmYgKyBNYXRoLlBJKTsKICAgICAgICAgICAgZWxzZSBub3JtYWwgPSBDMy5jbGFtcEFuZ2xlKGNsb2Nrd2lzZUZyZWVBbmdsZSArIGhhbGZEaWZmKTsKICAgICAgICAgICAgY29uc3QgdnggPSBNYXRoLmNvcyhzdGFydEFuZ2xlKTsKICAgICAgICAgICAgY29uc3QgdnkgPSBNYXRoLnNpbihzdGFydEFuZ2xlKTsKICAgICAgICAgICAgY29uc3QgbnggPSBNYXRoLmNvcyhub3JtYWwpOwogICAgICAgICAgICBjb25zdCBueSA9CiAgICAgICAgICAgICAgICBNYXRoLnNpbihub3JtYWwpOwogICAgICAgICAgICBjb25zdCB2X2RvdF9uID0gdnggKiBueCArIHZ5ICogbnk7CiAgICAgICAgICAgIGNvbnN0IHJ4ID0gdnggLSAyICogdl9kb3RfbiAqIG54OwogICAgICAgICAgICBjb25zdCByeSA9IHZ5IC0gMiAqIHZfZG90X24gKiBueTsKICAgICAgICAgICAgcmV0dXJuIEMzLmFuZ2xlVG8oMCwgMCwgcngsIHJ5KQogICAgICAgIH0KICAgICAgICBUZXN0U2VnbWVudE92ZXJsYXAoeDEsIHkxLCB4MiwgeTIsIGluc3QpIHsKICAgICAgICAgICAgaWYgKCFpbnN0KSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGNvbnN0IHdpID0gaW5zdC5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgaWYgKCF3aS5Jc0NvbGxpc2lvbkVuYWJsZWQoKSkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB0aGlzLl9jb2xsaXNpb25DaGVja0NvdW50Kys7CiAgICAgICAgICAgIHRlbXBSZWN0LnNldChNYXRoLm1pbih4MSwgeDIpLCBNYXRoLm1pbih5MSwgeTIpLCBNYXRoLm1heCh4MSwgeDIpLCBNYXRoLm1heCh5MSwgeTIpKTsKICAgICAgICAgICAgaWYgKCF3aS5HZXRCb3VuZGluZ0JveCgpLmludGVyc2VjdHNSZWN0KHRlbXBSZWN0KSkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBpZiAoaW5zdC5IYXNUaWxlbWFwKCkpIHJldHVybiB0aGlzLl9UZXN0U2VnbWVudE92ZXJsYXBUaWxlbWFwKHgxLCB5MSwgeDIsIHkyLCBpbnN0LCB3aSk7CiAgICAgICAgICAgIHRoaXMuX3BvbHlDaGVja0NvdW50Kys7CiAgICAgICAgICAgIGlmICghd2kuR2V0Qm91bmRpbmdRdWFkKCkuaW50ZXJzZWN0c1NlZ21lbnQoeDEsIHkxLCB4MiwgeTIpKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGlmICghd2kuSGFzT3duQ29sbGlzaW9uUG9seSgpKSByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgY29uc3QgcG9seSA9IHdpLkdldFRyYW5zZm9ybWVkQ29sbGlzaW9uUG9seSgpOwogICAgICAgICAgICByZXR1cm4gcG9seS5pbnRlcnNlY3RzU2VnbWVudCh3aS5HZXRYKCksIHdpLkdldFkoKSwgeDEsIHkxLCB4MiwgeTIpCiAgICAgICAgfQogICAgICAgIF9UZXN0U2VnbWVudE92ZXJsYXBUaWxlbWFwKHgxLCB5MSwgeDIsIHkyLCBpbnN0LCB3aSkgewogICAgICAgICAgICBjb25zdCB0bVggPSB3aS5HZXRYKCk7CiAgICAgICAgICAgIGNvbnN0IHRtWSA9IHdpLkdldFkoKTsKICAgICAgICAgICAgY29uc3Qgc2RrSW5zdCA9IGluc3QuR2V0U2RrSW5zdGFuY2UoKTsKICAgICAgICAgICAgY29uc3QgY29sbFJlY3RzID0gdGlsZUNvbGxSZWN0Q2FuZGlkYXRlczsKICAgICAgICAgICAgdGVtcFJlY3QyLnNldCh4MSwgeTEsIHgyLCB5Mik7CiAgICAgICAgICAgIHRlbXBSZWN0Mi5ub3JtYWxpemUoKTsKICAgICAgICAgICAgc2RrSW5zdC5HZXRDb2xsaXNpb25SZWN0Q2FuZGlkYXRlcyh0ZW1wUmVjdDIsIGNvbGxSZWN0cyk7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPQogICAgICAgICAgICAgICAgICAgIGNvbGxSZWN0cy5sZW5ndGg7IGkgPCBsZW47ICsraSkgewogICAgICAgICAgICAgICAgY29uc3QgYyA9IGNvbGxSZWN0c1tpXTsKICAgICAgICAgICAgICAgIGNvbnN0IHRpbGVSYyA9IGMuR2V0UmVjdCgpOwogICAgICAgICAgICAgICAgdGhpcy5fY29sbGlzaW9uQ2hlY2tDb3VudCsrOwogICAgICAgICAgICAgICAgaWYgKHRlbXBSZWN0LmludGVyc2VjdHNSZWN0T2Zmc2V0KHRpbGVSYywgdG1YLCB0bVkpKSB7CiAgICAgICAgICAgICAgICAgICAgdGVtcFF1YWQuc2V0RnJvbVJlY3QodGlsZVJjKTsKICAgICAgICAgICAgICAgICAgICB0ZW1wUXVhZC5vZmZzZXQodG1YLCB0bVkpOwogICAgICAgICAgICAgICAgICAgIGlmICh0ZW1wUXVhZC5pbnRlcnNlY3RzU2VnbWVudCh4MSwgeTEsIHgyLCB5MikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdGlsZVBvbHkgPSBjLkdldFBvbHkoKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRpbGVQb2x5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9wb2x5Q2hlY2tDb3VudCsrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRpbGVQb2x5LmludGVyc2VjdHNTZWdtZW50KHRtWCArIHRpbGVSYy5nZXRMZWZ0KCksIHRtWSArIHRpbGVSYy5nZXRUb3AoKSwgeDEsIHkxLCB4MiwgeTIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQzMuY2xlYXJBcnJheShjb2xsUmVjdHMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDMy5jbGVhckFycmF5KGNvbGxSZWN0cyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIEMzLmNsZWFyQXJyYXkoY29sbFJlY3RzKTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgfQogICAgICAgIFRlc3RSZWN0T3ZlcmxhcChyZWN0LCBpbnN0KSB7CiAgICAgICAgICAgIGlmICghaW5zdCkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBjb25zdCB3aSA9IGluc3QuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgIGlmICghd2kuSXNDb2xsaXNpb25FbmFibGVkKCkpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgdGhpcy5fY29sbGlzaW9uQ2hlY2tDb3VudCsrOwogICAgICAgICAgICBpZiAoIXdpLkdldEJvdW5kaW5nQm94KCkuaW50ZXJzZWN0c1JlY3QocmVjdCkpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgaWYgKGluc3QuSGFzVGlsZW1hcCgpKSByZXR1cm4gdGhpcy5fVGVzdFJlY3RPdmVybGFwVGlsZW1hcChyZWN0LCBpbnN0LCB3aSk7CiAgICAgICAgICAgIHRoaXMuX3BvbHlDaGVja0NvdW50Kys7CiAgICAgICAgICAgIHRlbXBRdWFkLnNldEZyb21SZWN0KHJlY3QpOwogICAgICAgICAgICBpZiAoIXdpLkdldEJvdW5kaW5nUXVhZCgpLmludGVyc2VjdHNRdWFkKHRlbXBRdWFkKSkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBpZiAoIXdpLkhhc093bkNvbGxpc2lvblBvbHkoKSkgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIGNvbnN0IHBvbHlBID0gdGVtcFBvbHlBOwogICAgICAgICAgICBwb2x5QS5zZXRGcm9tUmVjdChyZWN0LCB3aS5HZXRYKCksIHdpLkdldFkoKSk7CiAgICAgICAgICAgIGNvbnN0IHBvbHlCID0gd2kuR2V0VHJhbnNmb3JtZWRDb2xsaXNpb25Qb2x5KCk7CiAgICAgICAgICAgIHJldHVybiBwb2x5QS5pbnRlcnNlY3RzUG9seShwb2x5QiwgMCwgMCkKICAgICAgICB9CiAgICAgICAgX1Rlc3RSZWN0T3ZlcmxhcFRpbGVtYXAocmVjdCwgaW5zdCwgd2kpIHsKICAgICAgICAgICAgY29uc3QgdG1YID0gd2kuR2V0WCgpOwogICAgICAgICAgICBjb25zdCB0bVkgPSB3aS5HZXRZKCk7CiAgICAgICAgICAgIGNvbnN0IHNka0luc3QgPSBpbnN0LkdldFNka0luc3RhbmNlKCk7CiAgICAgICAgICAgIGNvbnN0IGNvbGxSZWN0cyA9IHRpbGVDb2xsUmVjdENhbmRpZGF0ZXM7CiAgICAgICAgICAgIHNka0luc3QuR2V0Q29sbGlzaW9uUmVjdENhbmRpZGF0ZXMocmVjdCwgY29sbFJlY3RzKTsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IGNvbGxSZWN0cy5sZW5ndGg7IGkgPCBsZW47ICsraSkgewogICAgICAgICAgICAgICAgY29uc3QgYyA9IGNvbGxSZWN0c1tpXTsKICAgICAgICAgICAgICAgIGNvbnN0IHRpbGVSYyA9IGMuR2V0UmVjdCgpOwogICAgICAgICAgICAgICAgdGhpcy5fY29sbGlzaW9uQ2hlY2tDb3VudCsrOwogICAgICAgICAgICAgICAgaWYgKHJlY3QuaW50ZXJzZWN0c1JlY3RPZmZzZXQodGlsZVJjLCB0bVgsIHRtWSkpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCB0aWxlUG9seSA9IGMuR2V0UG9seSgpOwogICAgICAgICAgICAgICAgICAgIGlmICh0aWxlUG9seSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9wb2x5Q2hlY2tDb3VudCsrOwogICAgICAgICAgICAgICAgICAgICAgICB0ZW1wUG9seUEuc2V0RnJvbVJlY3QocmVjdCwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aWxlUG9seS5pbnRlcnNlY3RzUG9seSh0ZW1wUG9seUEsIC0odG1YICsgdGlsZVJjLmdldExlZnQoKSksIC0odG1ZICsgdGlsZVJjLmdldFRvcCgpKSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEMzLmNsZWFyQXJyYXkoY29sbFJlY3RzKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBDMy5jbGVhckFycmF5KGNvbGxSZWN0cyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIEMzLmNsZWFyQXJyYXkoY29sbFJlY3RzKTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgfQogICAgICAgIFRlc3RSYXlJbnRlcnNlY3RzSW5zdGFuY2UoaW5zdCwgcmF5KSB7CiAgICAgICAgICAgIGlmICghaW5zdCkgcmV0dXJuOwogICAgICAgICAgICBjb25zdCB3aSA9IGluc3QuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgIGlmICghd2kuSXNDb2xsaXNpb25FbmFibGVkKCkpIHJldHVybjsKICAgICAgICAgICAgdGhpcy5fY29sbGlzaW9uQ2hlY2tDb3VudCsrOwogICAgICAgICAgICBpZiAoIXdpLkdldEJvdW5kaW5nQm94KCkuaW50ZXJzZWN0c1JlY3QocmF5LnJlY3QpKSByZXR1cm47CiAgICAgICAgICAgIGlmIChpbnN0Lkhhc1RpbGVtYXAoKSkgewogICAgICAgICAgICAgICAgdGhpcy5fVGVzdFJheUludGVyc2VjdHNUaWxlbWFwKGluc3QsIHdpLCByYXkpOwogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5fcG9seUNoZWNrQ291bnQrKzsKICAgICAgICAgICAgaWYgKHdpLkhhc093bkNvbGxpc2lvblBvbHkoKSkgcmF5LlRlc3RJbnN0YW5jZVBvbHkoaW5zdCwgd2kuR2V0WCgpLCB3aS5HZXRZKCksIHdpLkdldFRyYW5zZm9ybWVkQ29sbGlzaW9uUG9seSgpKTsKICAgICAgICAgICAgZWxzZSByYXkuVGVzdEluc3RhbmNlUXVhZChpbnN0LCB3aS5HZXRCb3VuZGluZ1F1YWQoKSkKICAgICAgICB9CiAgICAgICAgX1Rlc3RSYXlJbnRlcnNlY3RzVGlsZW1hcChpbnN0LCB3aSwgcmF5KSB7CiAgICAgICAgICAgIGNvbnN0IHhPZmZzZXQgPSB3aS5HZXRYKCk7CiAgICAgICAgICAgIGNvbnN0IHlPZmZzZXQgPSB3aS5HZXRZKCk7CiAgICAgICAgICAgIGNvbnN0IGNvbGxSZWN0cyA9IHRpbGVDb2xsUmVjdENhbmRpZGF0ZXM7CiAgICAgICAgICAgIGluc3QuR2V0U2RrSW5zdGFuY2UoKS5HZXRDb2xsaXNpb25SZWN0Q2FuZGlkYXRlcyhyYXkucmVjdCwgY29sbFJlY3RzKTsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBjb2xsUmVjdHMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICAgICAgICBjb25zdCBjID0gY29sbFJlY3RzW2ldOwogICAgICAgICAgICAgICAgY29uc3QgdGlsZVJjID0gYy5HZXRSZWN0KCk7CiAgICAgICAgICAgICAgICB0aGlzLl9jb2xsaXNpb25DaGVja0NvdW50Kys7CiAgICAgICAgICAgICAgICBpZiAocmF5LnJlY3QuaW50ZXJzZWN0c1JlY3RPZmZzZXQodGlsZVJjLAogICAgICAgICAgICAgICAgICAgICAgICB4T2Zmc2V0LCB5T2Zmc2V0KSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHRpbGVQb2x5ID0gYy5HZXRQb2x5KCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcG9seUNoZWNrQ291bnQrKzsKICAgICAgICAgICAgICAgICAgICBpZiAodGlsZVBvbHkpIHJheS5UZXN0SW5zdGFuY2VQb2x5KGluc3QsIHhPZmZzZXQgKyB0aWxlUmMuZ2V0TGVmdCgpLCB5T2Zmc2V0ICsgdGlsZVJjLmdldFRvcCgpLCB0aWxlUG9seSk7CiAgICAgICAgICAgICAgICAgICAgZWxzZSByYXkuVGVzdEluc3RhbmNlUmVjdChpbnN0LCB3aS5HZXRYKCksIHdpLkdldFkoKSwgdGlsZVJjKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIEMzLmNsZWFyQXJyYXkoY29sbFJlY3RzKQogICAgICAgIH0KICAgIH07Cgp9CgovLyBjb2xsaXNpb25zL3NwYXJzZUdyaWQuanMKewogICAgJ3VzZSBzdHJpY3QnOwogICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgQzMuU3BhcnNlR3JpZCA9IGNsYXNzIFNwYXJzZUdyaWQgZXh0ZW5kcyBDMy5EZWZlbmRlZEJhc2UgewogICAgICAgIGNvbnN0cnVjdG9yKGNlbGxXaWR0aCwgY2VsbEhlaWdodCkgewogICAgICAgICAgICBzdXBlcigpOwogICAgICAgICAgICB0aGlzLl9jZWxsV2lkdGggPSBjZWxsV2lkdGg7CiAgICAgICAgICAgIHRoaXMuX2NlbGxIZWlnaHQgPSBjZWxsSGVpZ2h0OwogICAgICAgICAgICB0aGlzLl9jZWxscyA9IEMzLk5ldyhDMy5QYWlyTWFwKQogICAgICAgIH0KICAgICAgICBSZWxlYXNlKCkgewogICAgICAgICAgICB0aGlzLl9jZWxscy5SZWxlYXNlKCk7CiAgICAgICAgICAgIHRoaXMuX2NlbGxzID0gbnVsbAogICAgICAgIH0KICAgICAgICBHZXRDZWxsKHgsIHksIGNyZWF0ZUlmTWlzc2luZykgewogICAgICAgICAgICBsZXQgcmV0ID0gdGhpcy5fY2VsbHMuR2V0KHgsIHkpOwogICAgICAgICAgICBpZiAocmV0KSByZXR1cm4gcmV0OwogICAgICAgICAgICBlbHNlIGlmIChjcmVhdGVJZk1pc3NpbmcpIHsKICAgICAgICAgICAgICAgIHJldCA9IEMzLk5ldyhDMy5HcmlkQ2VsbCwgdGhpcywgeCwgeSk7CiAgICAgICAgICAgICAgICB0aGlzLl9jZWxscy5TZXQoeCwgeSwgcmV0KTsKICAgICAgICAgICAgICAgIHJldHVybiByZXQKICAgICAgICAgICAgfSBlbHNlIHJldHVybiBudWxsCiAgICAgICAgfQogICAgICAgIFhUb0NlbGwoeCkgewogICAgICAgICAgICBjb25zdCByZXQgPSBNYXRoLmZsb29yKHggLyB0aGlzLl9jZWxsV2lkdGgpOwogICAgICAgICAgICByZXR1cm4gaXNGaW5pdGUocmV0KSA/IHJldCA6IDAKICAgICAgICB9CiAgICAgICAgWVRvQ2VsbCh5KSB7CiAgICAgICAgICAgIGNvbnN0IHJldCA9CiAgICAgICAgICAgICAgICBNYXRoLmZsb29yKHkgLyB0aGlzLl9jZWxsSGVpZ2h0KTsKICAgICAgICAgICAgcmV0dXJuIGlzRmluaXRlKHJldCkgPyByZXQgOiAwCiAgICAgICAgfQogICAgICAgIFVwZGF0ZShpbnN0LCBvbGRSYW5nZSwgbmV3UmFuZ2UpIHsKICAgICAgICAgICAgaWYgKG9sZFJhbmdlKQogICAgICAgICAgICAgICAgZm9yIChsZXQgeCA9IG9sZFJhbmdlLmdldExlZnQoKSwgbGVueCA9IG9sZFJhbmdlLmdldFJpZ2h0KCk7IHggPD0gbGVueDsgKyt4KQogICAgICAgICAgICAgICAgICAgIGZvciAobGV0IHkgPSBvbGRSYW5nZS5nZXRUb3AoKSwgbGVueSA9IG9sZFJhbmdlLmdldEJvdHRvbSgpOyB5IDw9IGxlbnk7ICsreSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAobmV3UmFuZ2UgJiYgbmV3UmFuZ2UuY29udGFpbnNQb2ludCh4LCB5KSkgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNlbGwgPSB0aGlzLkdldENlbGwoeCwgeSwgZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWNlbGwpIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgICAgICBjZWxsLlJlbW92ZShpbnN0KTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNlbGwuSXNFbXB0eSgpKSB0aGlzLl9jZWxscy5EZWxldGUoeCwgeSkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChuZXdSYW5nZSkKICAgICAgICAgICAgICAgIGZvciAobGV0IHggPSBuZXdSYW5nZS5nZXRMZWZ0KCksIGxlbnggPSBuZXdSYW5nZS5nZXRSaWdodCgpOyB4IDw9IGxlbng7ICsreCkKICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCB5ID0gbmV3UmFuZ2UuZ2V0VG9wKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZW55ID0gbmV3UmFuZ2UuZ2V0Qm90dG9tKCk7IHkgPD0gbGVueTsgKyt5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvbGRSYW5nZSAmJiBvbGRSYW5nZS5jb250YWluc1BvaW50KHgsIHkpKSBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5HZXRDZWxsKHgsIHksIHRydWUpLkluc2VydChpbnN0KQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgUXVlcnlSYW5nZShyYywgcmVzdWx0KSB7CiAgICAgICAgICAgIGxldCB4ID0gdGhpcy5YVG9DZWxsKHJjLmdldExlZnQoKSk7CiAgICAgICAgICAgIGNvbnN0IHlzdGFydCA9IHRoaXMuWVRvQ2VsbChyYy5nZXRUb3AoKSk7CiAgICAgICAgICAgIGNvbnN0IGxlbnggPSB0aGlzLlhUb0NlbGwocmMuZ2V0UmlnaHQoKSk7CiAgICAgICAgICAgIGNvbnN0IGxlbnkgPSB0aGlzLllUb0NlbGwocmMuZ2V0Qm90dG9tKCkpOwogICAgICAgICAgICBpZiAoIWlzRmluaXRlKGxlbngpIHx8ICFpc0Zpbml0ZShsZW55KSkgcmV0dXJuOwogICAgICAgICAgICBmb3IgKDsgeCA8PSBsZW54OyArK3gpCiAgICAgICAgICAgICAgICBmb3IgKGxldCB5ID0geXN0YXJ0OyB5IDw9IGxlbnk7ICsreSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGNlbGwgPSB0aGlzLkdldENlbGwoeCwgeSwgZmFsc2UpOwogICAgICAgICAgICAgICAgICAgIGlmICghY2VsbCkgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgY2VsbC5EdW1wKHJlc3VsdCkKICAgICAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwoKfQoKLy8gY29sbGlzaW9ucy9ncmlkQ2VsbC5qcwp7CiAgICAndXNlIHN0cmljdCc7CiAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICBDMy5HcmlkQ2VsbCA9IGNsYXNzIEdyaWRDZWxsIGV4dGVuZHMgQzMuRGVmZW5kZWRCYXNlIHsKICAgICAgICBjb25zdHJ1Y3RvcihncmlkLCB4LCB5KSB7CiAgICAgICAgICAgIHN1cGVyKCk7CiAgICAgICAgICAgIHRoaXMuX2dyaWQgPSBncmlkOwogICAgICAgICAgICB0aGlzLl94ID0geDsKICAgICAgICAgICAgdGhpcy5feSA9IHk7CiAgICAgICAgICAgIHRoaXMuX2luc3RhbmNlcyA9IEMzLk5ldyhDMy5BcnJheVNldCkKICAgICAgICB9CiAgICAgICAgUmVsZWFzZSgpIHsKICAgICAgICAgICAgdGhpcy5faW5zdGFuY2VzLlJlbGVhc2UoKTsKICAgICAgICAgICAgdGhpcy5faW5zdGFuY2VzID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fZ3JpZCA9IG51bGwKICAgICAgICB9CiAgICAgICAgSXNFbXB0eSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2luc3RhbmNlcy5Jc0VtcHR5KCkKICAgICAgICB9CiAgICAgICAgSW5zZXJ0KGluc3QpIHsKICAgICAgICAgICAgdGhpcy5faW5zdGFuY2VzLkFkZChpbnN0KQogICAgICAgIH0KICAgICAgICBSZW1vdmUoaW5zdCkgewogICAgICAgICAgICB0aGlzLl9pbnN0YW5jZXMuRGVsZXRlKGluc3QpCiAgICAgICAgfQogICAgICAgIER1bXAocmVzdWx0KSB7CiAgICAgICAgICAgIEMzLmFwcGVuZEFycmF5KHJlc3VsdCwgdGhpcy5faW5zdGFuY2VzLkdldEFycmF5KCkpCiAgICAgICAgfQogICAgfTsKCn0KCi8vIGNvbGxpc2lvbnMvcmF5LmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIGNvbnN0IFBBRERJTkcgPSAxRS02OwogICAgY29uc3QgTk9fSElUID0gMjsKICAgIEMzLlJheSA9IGNsYXNzIFJheSB7CiAgICAgICAgY29uc3RydWN0b3IoKSB7CiAgICAgICAgICAgIHRoaXMueDEgPSAwOwogICAgICAgICAgICB0aGlzLnkxID0gMDsKICAgICAgICAgICAgdGhpcy54MiA9IDA7CiAgICAgICAgICAgIHRoaXMueTIgPSAwOwogICAgICAgICAgICB0aGlzLmR4ID0gMDsKICAgICAgICAgICAgdGhpcy5keSA9IDA7CiAgICAgICAgICAgIHRoaXMucmVjdCA9IG5ldyBDMy5SZWN0OwogICAgICAgICAgICB0aGlzLmhpdEZyYWN0aW9uID0gTk9fSElUOwogICAgICAgICAgICB0aGlzLmhpdFVpZCA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuaGl0Tm9ybWFsID0gMDsKICAgICAgICAgICAgdGhpcy5oaXROb3JtYWxEeCA9IDA7CiAgICAgICAgICAgIHRoaXMuaGl0Tm9ybWFsRHkgPSAwOwogICAgICAgICAgICB0aGlzLmhpdFggPSAwOwogICAgICAgICAgICB0aGlzLmhpdFkgPSAwOwogICAgICAgICAgICB0aGlzLmRpc3RhbmNlID0gMDsKICAgICAgICAgICAgdGhpcy5ub3JtYWxYID0gMTsKICAgICAgICAgICAgdGhpcy5ub3JtYWxZID0gMDsKICAgICAgICAgICAgdGhpcy5yZWZsZWN0aW9uWCA9IDE7CiAgICAgICAgICAgIHRoaXMucmVmbGVjdGlvblkgPSAwCiAgICAgICAgfQogICAgICAgIERpZENvbGxpZGUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmhpdEZyYWN0aW9uIDwgMSArIFBBRERJTkcKICAgICAgICB9CiAgICAgICAgUmVzZXQoKSB7CiAgICAgICAgICAgIHRoaXMuaGl0RnJhY3Rpb24gPSBOT19ISVQKICAgICAgICB9CiAgICAgICAgU2V0KHgxLCB5MSwgeDIsIHkyKSB7CiAgICAgICAgICAgIHRoaXMueDEgPSB4MTsKICAgICAgICAgICAgdGhpcy55MSA9IHkxOwogICAgICAgICAgICB0aGlzLngyID0geDI7CiAgICAgICAgICAgIHRoaXMueTIgPSB5MjsKICAgICAgICAgICAgdGhpcy5keCA9IHgyIC0geDE7CiAgICAgICAgICAgIHRoaXMuZHkgPSB5MiAtIHkxOwogICAgICAgICAgICB0aGlzLnJlY3Quc2V0KHgxLAogICAgICAgICAgICAgICAgeTEsIHgyLCB5Mik7CiAgICAgICAgICAgIHRoaXMucmVjdC5ub3JtYWxpemUoKTsKICAgICAgICAgICAgdGhpcy5oaXRGcmFjdGlvbiA9IE5PX0hJVDsKICAgICAgICAgICAgdGhpcy5oaXRVaWQgPSBudWxsOwogICAgICAgICAgICB0aGlzLmhpdE5vcm1hbCA9IDA7CiAgICAgICAgICAgIHRoaXMuaGl0Tm9ybWFsRHggPSAwOwogICAgICAgICAgICB0aGlzLmhpdE5vcm1hbER5ID0gMDsKICAgICAgICAgICAgdGhpcy5oaXRYID0gMDsKICAgICAgICAgICAgdGhpcy5oaXRZID0gMDsKICAgICAgICAgICAgdGhpcy5kaXN0YW5jZSA9IDA7CiAgICAgICAgICAgIHRoaXMubm9ybWFsWCA9IDE7CiAgICAgICAgICAgIHRoaXMubm9ybWFsWSA9IDA7CiAgICAgICAgICAgIHRoaXMucmVmbGVjdGlvblggPSAxOwogICAgICAgICAgICB0aGlzLnJlZmxlY3Rpb25ZID0gMDsKICAgICAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgICB9CiAgICAgICAgQ29tcGxldGUoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLkRpZENvbGxpZGUoKSA9PT0gZmFsc2UpIHJldHVybjsKICAgICAgICAgICAgY29uc3QgZHggPSB0aGlzLmR4ICogdGhpcy5oaXRGcmFjdGlvbjsKICAgICAgICAgICAgY29uc3QgZHkgPSB0aGlzLmR5ICogdGhpcy5oaXRGcmFjdGlvbjsKICAgICAgICAgICAgY29uc3QgbGVuZ3RoID0gTWF0aC5oeXBvdChkeCwgZHkpOwogICAgICAgICAgICBjb25zdCBkaXJ4ID0gZHggLyBsZW5ndGg7CiAgICAgICAgICAgIGNvbnN0IGRpcnkgPSBkeSAvIGxlbmd0aDsKICAgICAgICAgICAgdGhpcy5kaXN0YW5jZSA9IGxlbmd0aCAtIFBBRERJTkc7CiAgICAgICAgICAgIHRoaXMuaGl0WCA9IHRoaXMueDEgKyBkaXJ4ICogdGhpcy5kaXN0YW5jZTsKICAgICAgICAgICAgdGhpcy5oaXRZID0gdGhpcy55MSArIGRpcnkgKiB0aGlzLmRpc3RhbmNlOwogICAgICAgICAgICB0aGlzLmhpdE5vcm1hbCA9IE1hdGguYXRhbjIodGhpcy5oaXROb3JtYWxEeSwgdGhpcy5oaXROb3JtYWxEeCkgKyBNYXRoLlBJIC8gMjsKICAgICAgICAgICAgdGhpcy5ub3JtYWxYID0gTWF0aC5jb3ModGhpcy5oaXROb3JtYWwpOwogICAgICAgICAgICB0aGlzLm5vcm1hbFkgPSBNYXRoLnNpbih0aGlzLmhpdE5vcm1hbCk7CiAgICAgICAgICAgIGNvbnN0IGRvdCA9IGRpcnggKiB0aGlzLm5vcm1hbFggKyBkaXJ5ICogdGhpcy5ub3JtYWxZOwogICAgICAgICAgICB0aGlzLnJlZmxlY3Rpb25YID0gZGlyeCAtIDIgKiB0aGlzLm5vcm1hbFggKiBkb3Q7CiAgICAgICAgICAgIHRoaXMucmVmbGVjdGlvblkgPSBkaXJ5IC0gMiAqIHRoaXMubm9ybWFsWSAqIGRvdDsKICAgICAgICAgICAgaWYgKGRvdCA+IDApIHsKICAgICAgICAgICAgICAgIGNvbnN0IFBJID0gTWF0aC5QSTsKICAgICAgICAgICAgICAgIHRoaXMuaGl0Tm9ybWFsID0gQzMuY2xhbXBBbmdsZSh0aGlzLmhpdE5vcm1hbCArIFBJKTsKICAgICAgICAgICAgICAgIHRoaXMubm9ybWFsWCA9IC10aGlzLm5vcm1hbFg7CiAgICAgICAgICAgICAgICB0aGlzLm5vcm1hbFkgPSAtdGhpcy5ub3JtYWxZCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgVGVzdEluc3RhbmNlU2VnbWVudChpbnN0LCBzeDEsIHN5MSwgc3gyLCBzeTIpIHsKICAgICAgICAgICAgY29uc3QgdCA9IEMzLnJheUludGVyc2VjdCh0aGlzLngxLAogICAgICAgICAgICAgICAgdGhpcy55MSwgdGhpcy54MiwgdGhpcy55Miwgc3gxLCBzeTEsIHN4Miwgc3kyKTsKICAgICAgICAgICAgaWYgKHQgPj0gMCAmJiB0IDwgdGhpcy5oaXRGcmFjdGlvbikgewogICAgICAgICAgICAgICAgdGhpcy5oaXRGcmFjdGlvbiA9IHQ7CiAgICAgICAgICAgICAgICB0aGlzLmhpdFVpZCA9IGluc3QuR2V0VUlEKCk7CiAgICAgICAgICAgICAgICB0aGlzLmhpdE5vcm1hbER4ID0gc3gxIC0gc3gyOwogICAgICAgICAgICAgICAgdGhpcy5oaXROb3JtYWxEeSA9IHN5MSAtIHN5MgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIFRlc3RJbnN0YW5jZVJlY3QoaW5zdCwgb2ZmWCwgb2ZmWSwgcmVjdCkgewogICAgICAgICAgICBjb25zdCBsdCA9IG9mZlggKyByZWN0LmdldExlZnQoKSwKICAgICAgICAgICAgICAgIHJ0ID0gb2ZmWCArIHJlY3QuZ2V0UmlnaHQoKSwKICAgICAgICAgICAgICAgIHRwID0gb2ZmWSArIHJlY3QuZ2V0VG9wKCksCiAgICAgICAgICAgICAgICBibSA9IG9mZlkgKyByZWN0LmdldEJvdHRvbSgpOwogICAgICAgICAgICB0aGlzLlRlc3RJbnN0YW5jZVNlZ21lbnQoaW5zdCwgbHQsIHRwLCBydCwgdHApOwogICAgICAgICAgICB0aGlzLlRlc3RJbnN0YW5jZVNlZ21lbnQoaW5zdCwgcnQsIHRwLCBydCwgYm0pOwogICAgICAgICAgICB0aGlzLlRlc3RJbnN0YW5jZVNlZ21lbnQoaW5zdCwgcnQsIGJtLCBsdCwgYm0pOwogICAgICAgICAgICB0aGlzLlRlc3RJbnN0YW5jZVNlZ21lbnQoaW5zdCwgbHQsIGJtLCBsdCwgdHApCiAgICAgICAgfQogICAgICAgIFRlc3RJbnN0YW5jZVF1YWQoaW5zdCwgcXVhZCkgewogICAgICAgICAgICBjb25zdCB0bFggPQogICAgICAgICAgICAgICAgcXVhZC5nZXRUbHgoKSwKICAgICAgICAgICAgICAgIHRsWSA9IHF1YWQuZ2V0VGx5KCksCiAgICAgICAgICAgICAgICB0clggPSBxdWFkLmdldFRyeCgpLAogICAgICAgICAgICAgICAgdHJZID0gcXVhZC5nZXRUcnkoKSwKICAgICAgICAgICAgICAgIGJyWCA9IHF1YWQuZ2V0QnJ4KCksCiAgICAgICAgICAgICAgICBiclkgPSBxdWFkLmdldEJyeSgpLAogICAgICAgICAgICAgICAgYmxYID0gcXVhZC5nZXRCbHgoKSwKICAgICAgICAgICAgICAgIGJsWSA9IHF1YWQuZ2V0Qmx5KCk7CiAgICAgICAgICAgIHRoaXMuVGVzdEluc3RhbmNlU2VnbWVudChpbnN0LCB0bFgsIHRsWSwgdHJYLCB0clkpOwogICAgICAgICAgICB0aGlzLlRlc3RJbnN0YW5jZVNlZ21lbnQoaW5zdCwgdHJYLCB0clksIGJyWCwgYnJZKTsKICAgICAgICAgICAgdGhpcy5UZXN0SW5zdGFuY2VTZWdtZW50KGluc3QsIGJyWCwgYnJZLCBibFgsIGJsWSk7CiAgICAgICAgICAgIHRoaXMuVGVzdEluc3RhbmNlU2VnbWVudChpbnN0LCBibFgsIGJsWSwgdGxYLCB0bFkpCiAgICAgICAgfQogICAgICAgIFRlc3RJbnN0YW5jZVBvbHkoaW5zdCwgb2ZmWCwgb2ZmWSwgcG9seSkgewogICAgICAgICAgICBjb25zdCBwb2ludHMgPSBwb2x5LnBvaW50c0FycigpOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IHBvaW50cy5sZW5ndGg7IGkgPCBsOyBpICs9IDIpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGlpID0gKGkgKyAyKSAlIGw7CiAgICAgICAgICAgICAgICBjb25zdCB4MSA9IHBvaW50c1tpXSArIG9mZlg7CiAgICAgICAgICAgICAgICBjb25zdCB5MSA9IHBvaW50c1tpICsgMV0gKyBvZmZZOwogICAgICAgICAgICAgICAgY29uc3QgeDIgPSBwb2ludHNbaWldICsgb2ZmWDsKICAgICAgICAgICAgICAgIGNvbnN0IHkyID0gcG9pbnRzW2lpICsgMV0gKyBvZmZZOwogICAgICAgICAgICAgICAgdGhpcy5UZXN0SW5zdGFuY2VTZWdtZW50KGluc3QsIHgxLCB5MSwgeDIsIHkyKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKCn0KCi8vIGNhbnZhc01hbmFnZXIuanMKewogICAgJ3VzZSBzdHJpY3QnOwogICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgY29uc3QgVkFMSURfRlVMTFNDUkVFTl9NT0RFUyA9IG5ldyBTZXQoWyJvZmYiLCAiY3JvcCIsICJzY2FsZS1pbm5lciIsICJzY2FsZS1vdXRlciIsICJsZXR0ZXJib3gtc2NhbGUiLCAibGV0dGVyYm94LWludGVnZXItc2NhbGUiXSk7CiAgICBjb25zdCBWQUxJRF9GVUxMU0NSRUVOX1NDQUxJTkdfUVVBTElUSUVTID0gbmV3IFNldChbImhpZ2giLCAibG93Il0pOwogICAgY29uc3QgZ2xNYXRyaXggPSBzZWxmLmdsTWF0cml4OwogICAgY29uc3QgbWF0NCA9IGdsTWF0cml4Lm1hdDQ7CiAgICBjb25zdCB2ZWMzID0gZ2xNYXRyaXgudmVjMzsKICAgIGNvbnN0IHRlbXBQcm9qZWN0aW9uID0gbWF0NC5jcmVhdGUoKTsKICAgIGNvbnN0IFBFUkNFTlRURVhUX1dJRFRIID0gMzAwOwogICAgY29uc3QgUEVSQ0VOVFRFWFRfSEVJR0hUID0gMjAwOwogICAgY29uc3QgUFJPR1JFU1NCQVJfV0lEVEggPSAxMjA7CiAgICBjb25zdCBQUk9HUkVTU0JBUl9IRUlHSFQgPSA4OwogICAgY29uc3QgdGVtcFF1YWQgPSBDMy5OZXcoQzMuUXVhZCk7CiAgICBjb25zdCB0ZW1wUmVjdCA9IEMzLk5ldyhDMy5SZWN0KTsKICAgIGNvbnN0IFNQTEFTSF9NSU5fRElTUExBWV9USU1FID0gM0UzOwogICAgY29uc3QgU1BMQVNIX0FGVEVSX0ZBREVPVVRfV0FJVF9USU1FID0gMjAwOwogICAgY29uc3QgU1BMQVNIX0ZBREVfRFVSQVRJT04gPSAzMDA7CiAgICBDMy5DYW52YXNNYW5hZ2VyID0gY2xhc3MgQ2FudmFzTWFuYWdlciBleHRlbmRzIEMzLkRlZmVuZGVkQmFzZSB7CiAgICAgICAgY29uc3RydWN0b3IocnVudGltZSkgewogICAgICAgICAgICBzdXBlcigpOwogICAgICAgICAgICB0aGlzLl9ydW50aW1lID0gcnVudGltZTsKICAgICAgICAgICAgdGhpcy5fY2FudmFzID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5faXNXZWJHUFVFbmFibGVkID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX3dlYmdsUmVuZGVyZXIgPSBudWxsOwogICAgICAgICAgICB0aGlzLl93ZWJncHVSZW5kZXJlciA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX2dwdVByZWZlcmVuY2UgPSAiaGlnaC1wZXJmb3JtYW5jZSI7CiAgICAgICAgICAgIHRoaXMuX2lzTGltaXRlZFRvV2ViR0wxID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX3dpbmRvd0lubmVyV2lkdGggPSAwOwogICAgICAgICAgICB0aGlzLl93aW5kb3dJbm5lckhlaWdodCA9IDA7CiAgICAgICAgICAgIHRoaXMuX2NhbnZhc0Nzc1dpZHRoID0gMDsKICAgICAgICAgICAgdGhpcy5fY2FudmFzQ3NzSGVpZ2h0ID0gMDsKICAgICAgICAgICAgdGhpcy5fY2FudmFzRGV2aWNlV2lkdGggPSAwOwogICAgICAgICAgICB0aGlzLl9jYW52YXNEZXZpY2VIZWlnaHQgPSAwOwogICAgICAgICAgICB0aGlzLl9jYW52YXNDc3NPZmZzZXRYID0gMDsKICAgICAgICAgICAgdGhpcy5fY2FudmFzQ3NzT2Zmc2V0WSA9IDA7CiAgICAgICAgICAgIHRoaXMuX3pBeGlzU2NhbGUgPSAibm9ybWFsaXplZCI7CiAgICAgICAgICAgIHRoaXMuX2ZpZWxkT2ZWaWV3ID0gMDsKICAgICAgICAgICAgdGhpcy5fek5lYXIgPSAxOwogICAgICAgICAgICB0aGlzLl96RmFyID0gMUU0OwogICAgICAgICAgICB0aGlzLl9lbmFibGVNaXBtYXBzID0gdHJ1ZTsKICAgICAgICAgICAgdGhpcy5fdGV4dHVyZUFuaXNvdHJvcHkgPSAwOwogICAgICAgICAgICB0aGlzLl9kcmF3V2lkdGggPSAwOwogICAgICAgICAgICB0aGlzLl9kcmF3SGVpZ2h0ID0gMDsKICAgICAgICAgICAgdGhpcy5fZnVsbHNjcmVlbk1vZGUgPSAibGV0dGVyYm94LXNjYWxlIjsKICAgICAgICAgICAgdGhpcy5fZG9jdW1lbnRGdWxsc2NyZWVuTW9kZSA9ICJsZXR0ZXJib3gtc2NhbGUiOwogICAgICAgICAgICB0aGlzLl9kZXZpY2VUcmFuc2Zvcm1PZmZYID0gMDsKICAgICAgICAgICAgdGhpcy5fZGV2aWNlVHJhbnNmb3JtT2ZmWSA9IDA7CiAgICAgICAgICAgIHRoaXMuX2RlZmF1bHRQcm9qZWN0aW9uTWF0cml4ID0gbWF0NC5jcmVhdGUoKTsKICAgICAgICAgICAgdGhpcy5fd2FudEZ1bGxzY3JlZW5TY2FsaW5nUXVhbGl0eSA9ICJoaWdoIjsKICAgICAgICAgICAgdGhpcy5fZnVsbHNjcmVlblNjYWxpbmdRdWFsaXR5ID0gdGhpcy5fd2FudEZ1bGxzY3JlZW5TY2FsaW5nUXVhbGl0eTsKICAgICAgICAgICAgdGhpcy5faXNEb2N1bWVudEZ1bGxzY3JlZW4gPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5fYXZhaWxhYmxlQWRkaXRpb25hbFJlbmRlclRhcmdldHMgPSBbXTsKICAgICAgICAgICAgdGhpcy5fdXNlZEFkZGl0aW9uYWxSZW5kZXJUYXJnZXRzID0gbmV3IFNldDsKICAgICAgICAgICAgdGhpcy5fc2hhZGVyRGF0YSA9IHNlbGZbIkMzX1NoYWRlcnMiXTsKICAgICAgICAgICAgdGhpcy5fZWZmZWN0Q2hhaW5NYW5hZ2VyID0gQzMuTmV3KEMzLkdmeC5FZmZlY3RDaGFpbk1hbmFnZXIsIHsKICAgICAgICAgICAgICAgIGdldERyYXdTaXplOiAoKSA9PiBbdGhpcy5HZXREcmF3V2lkdGgoKSwgdGhpcy5HZXREcmF3SGVpZ2h0KCldLAogICAgICAgICAgICAgICAgZ2V0UmVuZGVyVGFyZ2V0OiAoKSA9PiB0aGlzLkdldEVmZmVjdENvbXBvc2l0b3JSZW5kZXJUYXJnZXQoKSwKICAgICAgICAgICAgICAgIHJlbGVhc2VSZW5kZXJUYXJnZXQ6IHJ0ID0+IHRoaXMuUmVsZWFzZUVmZmVjdENvbXBvc2l0b3JSZW5kZXJUYXJnZXQocnQpLAogICAgICAgICAgICAgICAgZ2V0VGltZTogKCkgPT4gdGhpcy5HZXRSdW50aW1lKCkuR2V0R2FtZVRpbWUoKSwKICAgICAgICAgICAgICAgIHJlZHJhdzogKCkgPT4gdGhpcy5HZXRSdW50aW1lKCkuVXBkYXRlUmVuZGVyKCkKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHRoaXMuX2dwdVRpbWVTdGFydEZyYW1lID0gMDsKICAgICAgICAgICAgdGhpcy5fZ3B1VGltZUVuZEZyYW1lID0gMDsKICAgICAgICAgICAgdGhpcy5fZ3B1TGFzdFV0aWxpc2F0aW9uID0gTmFOOwogICAgICAgICAgICB0aGlzLl9ncHVGcmFtZVRpbWluZ3NCdWZmZXIgPQogICAgICAgICAgICAgICAgbnVsbDsKICAgICAgICAgICAgdGhpcy5fbGF5ZXJzR3B1UHJvZmlsZSA9IG5ldyBNYXA7CiAgICAgICAgICAgIHRoaXMuX2dwdUN1clV0aWxpc2F0aW9uID0gTmFOOwogICAgICAgICAgICB0aGlzLl93ZWJncHVGcmFtZVRpbWluZ3MgPSBuZXcgTWFwOwogICAgICAgICAgICB0aGlzLl9zbmFwc2hvdEZvcm1hdCA9ICIiOwogICAgICAgICAgICB0aGlzLl9zbmFwc2hvdFF1YWxpdHkgPSAxOwogICAgICAgICAgICB0aGlzLl9zbmFwc2hvdEFyZWEgPSBDMy5OZXcoQzMuUmVjdCk7CiAgICAgICAgICAgIHRoaXMuX3NuYXBzaG90VXJsID0gIiI7CiAgICAgICAgICAgIHRoaXMuX3NuYXBzaG90UHJvbWlzZSA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3NuYXBzaG90UmVzb2x2ZSA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX2lzUGFzdGluZ1RvRHJhd2luZ0NhbnZhcyA9IDA7CiAgICAgICAgICAgIHRoaXMuX2xvYWRlclN0YXJ0VGltZSA9IDA7CiAgICAgICAgICAgIHRoaXMuX3JhZklkID0gLTE7CiAgICAgICAgICAgIHRoaXMuX2xvYWRpbmdQcm9ncmVzcyA9IDA7CiAgICAgICAgICAgIHRoaXMuX2xvYWRpbmdwcm9ncmVzc19oYW5kbGVyID0gZSA9PiB0aGlzLl9sb2FkaW5nUHJvZ3Jlc3MgPSBlLnByb2dyZXNzOwogICAgICAgICAgICB0aGlzLl9wZXJjZW50VGV4dCA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3NwbGFzaFRleHR1cmVzID0gewogICAgICAgICAgICAgICAgbG9nbzogbnVsbCwKICAgICAgICAgICAgICAgIHBvd2VyZWQ6IG51bGwsCiAgICAgICAgICAgICAgICB3ZWJzaXRlOiBudWxsCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHRoaXMuX3NwbGFzaEZyYW1lTnVtYmVyID0KICAgICAgICAgICAgICAgIDA7CiAgICAgICAgICAgIHRoaXMuX3NwbGFzaEZhZGVJbkZpbmlzaFRpbWUgPSAwOwogICAgICAgICAgICB0aGlzLl9zcGxhc2hGYWRlT3V0U3RhcnRUaW1lID0gMDsKICAgICAgICAgICAgdGhpcy5fc3BsYXNoU3RhdGUgPSAiZmFkZS1pbiI7CiAgICAgICAgICAgIHRoaXMuX3NwbGFzaERvbmVSZXNvbHZlID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fc3BsYXNoRG9uZVByb21pc2UgPSBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHRoaXMuX3NwbGFzaERvbmVSZXNvbHZlID0gcmVzb2x2ZSkKICAgICAgICB9CiAgICAgICAgX1NldEdQVVBvd2VyUHJlZmVyZW5jZShwcmVmKSB7CiAgICAgICAgICAgIHRoaXMuX2dwdVByZWZlcmVuY2UgPSBwcmVmCiAgICAgICAgfQogICAgICAgIF9TZXRXZWJHUFVFbmFibGVkKGUpIHsKICAgICAgICAgICAgdGhpcy5faXNXZWJHUFVFbmFibGVkID0gISFlCiAgICAgICAgfQogICAgICAgIF9TZXRaQXhpc1NjYWxlKHMpIHsKICAgICAgICAgICAgdGhpcy5fekF4aXNTY2FsZSA9IHMKICAgICAgICB9CiAgICAgICAgX1NldEZpZWxkT2ZWaWV3KGYpIHsKICAgICAgICAgICAgdGhpcy5fZmllbGRPZlZpZXcgPSBmCiAgICAgICAgfQogICAgICAgIF9TZXRaRGlzdGFuY2VzKHpOZWFyLCB6RmFyKSB7CiAgICAgICAgICAgIHRoaXMuX3pOZWFyID0gek5lYXI7CiAgICAgICAgICAgIHRoaXMuX3pGYXIgPSB6RmFyCiAgICAgICAgfQogICAgICAgIF9TZXRMaW1pdGVkVG9XZWJHTDEobCkgewogICAgICAgICAgICB0aGlzLl9pc0xpbWl0ZWRUb1dlYkdMMSA9ICEhbAogICAgICAgIH0KICAgICAgICBhc3luYyBDcmVhdGVDYW52YXMob3B0cykgewogICAgICAgICAgICB0aGlzLl9jYW52YXMgPQogICAgICAgICAgICAgICAgb3B0c1siY2FudmFzIl07CiAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuQWRkRE9NQ29tcG9uZW50TWVzc2FnZUhhbmRsZXIoInJ1bnRpbWUiLCAid2luZG93LXJlc2l6ZSIsIGUgPT4gdGhpcy5fT25XaW5kb3dSZXNpemUoZSkpOwogICAgICAgICAgICB0aGlzLl9ydW50aW1lLkFkZERPTUNvbXBvbmVudE1lc3NhZ2VIYW5kbGVyKCJydW50aW1lIiwgImZ1bGxzY3JlZW5jaGFuZ2UiLCBlID0+IHRoaXMuX09uRnVsbHNjcmVlbkNoYW5nZShlKSk7CiAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuQWRkRE9NQ29tcG9uZW50TWVzc2FnZUhhbmRsZXIoInJ1bnRpbWUiLCAiZnVsbHNjcmVlbmVycm9yIiwgZSA9PiB0aGlzLl9PbkZ1bGxzY3JlZW5FcnJvcihlKSk7CiAgICAgICAgICAgIHRoaXMuX2NhbnZhcy5hZGRFdmVudExpc3RlbmVyKCJ3ZWJnbGNvbnRleHRsb3N0IiwgZSA9PiB0aGlzLl9PbldlYkdMQ29udGV4dExvc3QoZSkpOwogICAgICAgICAgICB0aGlzLl9jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcigid2ViZ2xjb250ZXh0cmVzdG9yZWQiLCBlID0+IHRoaXMuX09uV2ViR0xDb250ZXh0UmVzdG9yZWQoZSkpOwogICAgICAgICAgICB0aGlzLl9pc0RvY3VtZW50RnVsbHNjcmVlbiA9ICEhb3B0c1siaXNGdWxsc2NyZWVuIl07CiAgICAgICAgICAgIGNvbnN0IHVzZVdlYkdQVSA9IG5hdmlnYXRvclsiZ3B1Il0gJiYgdGhpcy5faXNXZWJHUFVFbmFibGVkOwogICAgICAgICAgICBsZXQgaGFzTWFqb3JQZXJmb3JtYW5jZUNhdmVhdCA9IGZhbHNlOwogICAgICAgICAgICBpZiAodXNlV2ViR1BVKSB0cnkgewogICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5fSW5pdFdlYkdQVUNvbnRleHQodHJ1ZSkKICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9NYXliZUxvZ1JlbmRlcmVyRXJyb3IoIldlYkdQVSIsIGVycik7CiAgICAgICAgICAgICAgICB0aGlzLl93ZWJncHVSZW5kZXJlciA9IG51bGwKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIXRoaXMuR2V0UmVuZGVyZXIoKSkgdHJ5IHsKICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuX0luaXRXZWJHTENvbnRleHQodHJ1ZSkKICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9NYXliZUxvZ1JlbmRlcmVyRXJyb3IoIldlYkdMIiwgZXJyKTsKICAgICAgICAgICAgICAgIHRoaXMuX3dlYmdsUmVuZGVyZXIgPSBudWxsCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCF0aGlzLkdldFJlbmRlcmVyKCkpIGhhc01ham9yUGVyZm9ybWFuY2VDYXZlYXQgPSB0cnVlOwogICAgICAgICAgICBpZiAoIXRoaXMuR2V0UmVuZGVyZXIoKSAmJiB1c2VXZWJHUFUpIHRyeSB7CiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLl9Jbml0V2ViR1BVQ29udGV4dChmYWxzZSkKICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9NYXliZUxvZ1JlbmRlcmVyRXJyb3IoIldlYkdQVSIsCiAgICAgICAgICAgICAgICAgICAgZXJyKTsKICAgICAgICAgICAgICAgIHRoaXMuX3dlYmdwdVJlbmRlcmVyID0gbnVsbAogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghdGhpcy5HZXRSZW5kZXJlcigpKSB0cnkgewogICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5fSW5pdFdlYkdMQ29udGV4dChmYWxzZSkKICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9NYXliZUxvZ1JlbmRlcmVyRXJyb3IoIldlYkdMIiwgZXJyKTsKICAgICAgICAgICAgICAgIHRoaXMuX3dlYmdsUmVuZGVyZXIgPSBudWxsCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgcmVuZGVyZXIgPSB0aGlzLkdldFJlbmRlcmVyKCk7CiAgICAgICAgICAgIGlmICghcmVuZGVyZXIpIHRocm93IG5ldyBFcnJvcigiZmFpbGVkIHRvIGFjcXVpcmUgYSByZW5kZXJlciAtIGNoZWNrIFdlYkdMIG9yIFdlYkdQVSBpcyBzdXBwb3J0ZWQiKTsKICAgICAgICAgICAgcmVuZGVyZXIuU2V0SGFzTWFqb3JQZXJmb3JtYW5jZUNhdmVhdChoYXNNYWpvclBlcmZvcm1hbmNlQ2F2ZWF0KTsKICAgICAgICAgICAgaWYgKHRoaXMuX3dlYmdwdVJlbmRlcmVyKSB7CiAgICAgICAgICAgICAgICB0aGlzLl93ZWJncHVSZW5kZXJlci5vbmRldmljZWxvc3QgPSAoKSA9PiB0aGlzLl9PbldlYkdQVURldmljZUxvc3QoKTsKICAgICAgICAgICAgICAgIHRoaXMuX3dlYmdwdVJlbmRlcmVyLm9uZGV2aWNlcmVzdG9yZWQgPSAoKSA9PiB0aGlzLl9PbldlYkdQVURldmljZVJlc3RvcmVkKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGhpcy5fekF4aXNTY2FsZSA9PT0KICAgICAgICAgICAgICAgICJub3JtYWxpemVkIikgcmVuZGVyZXIuU2V0WkF4aXNTY2FsZU5vcm1hbGl6ZWQoKTsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICByZW5kZXJlci5TZXRaQXhpc1NjYWxlUmVndWxhcigpOwogICAgICAgICAgICAgICAgcmVuZGVyZXIuU2V0Rm92WSh0aGlzLl9maWVsZE9mVmlldykKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLlNldFNpemUob3B0c1sid2luZG93SW5uZXJXaWR0aCJdLCBvcHRzWyJ3aW5kb3dJbm5lckhlaWdodCJdLCB0cnVlKTsKICAgICAgICAgICAgYXdhaXQgdGhpcy5fSW5pdFJlbmRlcmVyKCkKICAgICAgICB9CiAgICAgICAgX01heWJlTG9nUmVuZGVyZXJFcnJvcihyZW5kZXJlclR5cGUsIGVycikgewogICAgICAgICAgICBpZiAoZXJyICYmIHR5cGVvZiBlcnIubWVzc2FnZSA9PT0gInN0cmluZyIgJiYgZXJyLm1lc3NhZ2Uuc3RhcnRzV2l0aCgicmVuZGVyZXItdW5hdmFpbGFibGUiKSkgcmV0dXJuOwogICAgICAgICAgICBjb25zb2xlLmVycm9yKGBFcnJvciBjcmVhdGluZyAke3JlbmRlcmVyVHlwZX0gcmVuZGVyZXI6IGAsIGVycikKICAgICAgICB9CiAgICAgICAgYXN5bmMgX0luaXRXZWJHUFVDb250ZXh0KGZhaWxJZk1ham9yUGVyZm9ybWFuY2VDYXZlYXQpIHsKICAgICAgICAgICAgY29uc3QgcmVuZGVyZXJPcHRzID0gewogICAgICAgICAgICAgICAgcG93ZXJQcmVmZXJlbmNlOiB0aGlzLl9ncHVQcmVmZXJlbmNlLAogICAgICAgICAgICAgICAgZGVwdGg6IHRoaXMuX3J1bnRpbWUuVXNlczNERmVhdHVyZXMoKSwKICAgICAgICAgICAgICAgIGZhaWxJZk1ham9yUGVyZm9ybWFuY2VDYXZlYXQsCiAgICAgICAgICAgICAgICB1c2VzQmFja2dyb3VuZEJsZW5kaW5nOiB0aGlzLl9ydW50aW1lLlVzZXNBbnlCYWNrZ3JvdW5kQmxlbmRpbmcoKSwKICAgICAgICAgICAgICAgIGNhblNhbXBsZUJhY2tidWZmZXI6IHRoaXMuX3J1bnRpbWUuVXNlc0FueUNyb3NzU2FtcGxpbmcoKSwKICAgICAgICAgICAgICAgIGNhblNhbXBsZURlcHRoOiB0aGlzLl9ydW50aW1lLlVzZXNBbnlEZXB0aFNhbXBsaW5nKCksCiAgICAgICAgICAgICAgICBuZWFyWjogdGhpcy5fek5lYXIsCiAgICAgICAgICAgICAgICBmYXJaOiB0aGlzLl96RmFyCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHRoaXMuX3dlYmdwdVJlbmRlcmVyID0gQzMuTmV3KEMzLkdmeC5XZWJHUFVSZW5kZXJlcik7CiAgICAgICAgICAgIGF3YWl0IHRoaXMuX3dlYmdwdVJlbmRlcmVyLkNyZWF0ZSh0aGlzLl9jYW52YXMsIHJlbmRlcmVyT3B0cykKICAgICAgICB9CiAgICAgICAgYXN5bmMgX0luaXRXZWJHTENvbnRleHQoZmFpbElmTWFqb3JQZXJmb3JtYW5jZUNhdmVhdCkgewogICAgICAgICAgICBjb25zdCByZW5kZXJlck9wdHMgPSB7CiAgICAgICAgICAgICAgICBwb3dlclByZWZlcmVuY2U6IHRoaXMuX2dwdVByZWZlcmVuY2UsCiAgICAgICAgICAgICAgICBlbmFibGVHcHVQcm9maWxpbmc6IHRydWUsCiAgICAgICAgICAgICAgICBkZXB0aDogdGhpcy5fcnVudGltZS5Vc2VzM0RGZWF0dXJlcygpLAogICAgICAgICAgICAgICAgY2FuU2FtcGxlRGVwdGg6IHRoaXMuX3J1bnRpbWUuVXNlc0FueURlcHRoU2FtcGxpbmcoKSwKICAgICAgICAgICAgICAgIGZhaWxJZk1ham9yUGVyZm9ybWFuY2VDYXZlYXQsCiAgICAgICAgICAgICAgICBuZWFyWjogdGhpcy5fek5lYXIsCiAgICAgICAgICAgICAgICBmYXJaOiB0aGlzLl96RmFyCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGlmICh0aGlzLl9pc0xpbWl0ZWRUb1dlYkdMMSkgcmVuZGVyZXJPcHRzLm1heFdlYkdMVmVyc2lvbiA9IDE7CiAgICAgICAgICAgIGlmIChDMy5QbGF0Zm9ybS5PUyA9PT0gIkFuZHJvaWQiICYmIEMzLlBsYXRmb3JtLkJyb3dzZXJFbmdpbmUgPT09ICJDaHJvbWl1bSIgJiYgQzMuUGxhdGZvcm0uQnJvd3NlclZlcnNpb25OdW1iZXIgPCA3NSkgewogICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCJbQ29uc3RydWN0XSBEaXNhYmxpbmcgV2ViR0wgMiBiZWNhdXNlIHRoaXMgZGV2aWNlIGFwcGVhcnMgdG8gYmUgYWZmZWN0ZWQgYnkgY3JidWcuY29tLzkzNDgyMy4gSW5zdGFsbCBzb2Z0d2FyZSB1cGRhdGVzIHRvIGF2b2lkIHRoaXMuIik7CiAgICAgICAgICAgICAgICByZW5kZXJlck9wdHMubWF4V2ViR0xWZXJzaW9uID0gMQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLl9ydW50aW1lLkdldENvbXBvc2l0aW5nTW9kZSgpID09PQogICAgICAgICAgICAgICAgInN0YW5kYXJkIikgcmVuZGVyZXJPcHRzLmFscGhhID0gdHJ1ZTsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICByZW5kZXJlck9wdHMuYWxwaGEgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHJlbmRlcmVyT3B0cy5sb3dMYXRlbmN5ID0gdHJ1ZQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuX3dlYmdsUmVuZGVyZXIgPSBDMy5OZXcoQzMuR2Z4LldlYkdMUmVuZGVyZXIsIHRoaXMuX2NhbnZhcywgcmVuZGVyZXJPcHRzKTsKICAgICAgICAgICAgYXdhaXQgdGhpcy5fd2ViZ2xSZW5kZXJlci5Jbml0U3RhdGUoKQogICAgICAgIH0KICAgICAgICBhc3luYyBfSW5pdFdlYkdQVSgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX3NoYWRlckRhdGEpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHByb21pc2VzID0gW107CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IFtpZCwgZGF0YV0gb2YgT2JqZWN0LmVudHJpZXModGhpcy5fc2hhZGVyRGF0YSkpIHsKICAgICAgICAgICAgICAgICAgICBkYXRhLnNyYyA9IGRhdGEud2dzbDsKICAgICAgICAgICAgICAgICAgICBjb25zdCB2ZXJ0ZXhTcmMgPSBDMy5HZnguV2ViR1BVU2hhZGVyUHJvZ3JhbS5HZXREZWZhdWx0VmVydGV4U2hhZGVyU291cmNlKCk7CiAgICAgICAgICAgICAgICAgICAgcHJvbWlzZXMucHVzaCh0aGlzLl93ZWJncHVSZW5kZXJlci5DcmVhdGVTaGFkZXJQcm9ncmFtKE9iamVjdC5hc3NpZ24oewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmVydGV4U3JjLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogaWQKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSkpKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYXdhaXQgUHJvbWlzZS5hbGwocHJvbWlzZXMpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgYXN5bmMgX0luaXRXZWJHTCgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX3NoYWRlckRhdGEpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHByb21pc2VzID0gW107CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IFtpZCwgZGF0YV0gb2YgT2JqZWN0LmVudHJpZXModGhpcy5fc2hhZGVyRGF0YSkpIHsKICAgICAgICAgICAgICAgICAgICBsZXQgdmVydGV4U3JjOwogICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLmdsc2xXZWJHTDIgJiYgdGhpcy5fd2ViZ2xSZW5kZXJlci5HZXRXZWJHTFZlcnNpb25OdW1iZXIoKSA+PSAyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEuc3JjID0gZGF0YS5nbHNsV2ViR0wyOwogICAgICAgICAgICAgICAgICAgICAgICB2ZXJ0ZXhTcmMgPSBDMy5HZnguV2ViR0xTaGFkZXJQcm9ncmFtLkdldERlZmF1bHRWZXJ0ZXhTaGFkZXJTb3VyY2VfV2ViR0wyKCkKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWRhdGEuZ2xzbCkgdGhyb3cgbmV3IEVycm9yKGBzaGFkZXIgJyR7aWR9JyBkb2VzIG5vdCBzdXBwb3J0IFdlYkdMIDFgKTsKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5zcmMgPSBkYXRhLmdsc2w7CiAgICAgICAgICAgICAgICAgICAgICAgIHZlcnRleFNyYyA9IEMzLkdmeC5XZWJHTFNoYWRlclByb2dyYW0uR2V0RGVmYXVsdFZlcnRleFNoYWRlclNvdXJjZSgpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHByb21pc2VzLnB1c2godGhpcy5fd2ViZ2xSZW5kZXJlci5DcmVhdGVTaGFkZXJQcm9ncmFtKE9iamVjdC5hc3NpZ24oewogICAgICAgICAgICAgICAgICAgICAgICB2ZXJ0ZXhTcmMsCiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGlkCiAgICAgICAgICAgICAgICAgICAgfSwgZGF0YSkpKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYXdhaXQgUHJvbWlzZS5hbGwocHJvbWlzZXMpOwogICAgICAgICAgICAgICAgdGhpcy5fd2ViZ2xSZW5kZXJlci5SZXNldExhc3RQcm9ncmFtKCk7CiAgICAgICAgICAgICAgICB0aGlzLl93ZWJnbFJlbmRlcmVyLlNldFRleHR1cmVGaWxsTW9kZSgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHRoaXMuX3dlYmdsUmVuZGVyZXIuU3VwcG9ydHNHUFVQcm9maWxpbmcoKSkgdGhpcy5fZ3B1RnJhbWVUaW1pbmdzQnVmZmVyID0gQzMuTmV3KEMzLkdmeC5XZWJHTFF1ZXJ5UmVzdWx0QnVmZmVyLCB0aGlzLl93ZWJnbFJlbmRlcmVyKQogICAgICAgIH0KICAgICAgICBhc3luYyBfSW5pdFJlbmRlcmVyKCkgewogICAgICAgICAgICBpZiAodGhpcy5fd2ViZ3B1UmVuZGVyZXIpIGF3YWl0IHRoaXMuX0luaXRXZWJHUFUoKTsKICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5fd2ViZ2xSZW5kZXJlcikgYXdhaXQgdGhpcy5fSW5pdFdlYkdMKCk7CiAgICAgICAgICAgIGNvbnN0IHJlbmRlcmVyID0gdGhpcy5HZXRSZW5kZXJlcigpOwogICAgICAgICAgICByZW5kZXJlci5TZXRNaXBtYXBzRW5hYmxlZCh0aGlzLl9lbmFibGVNaXBtYXBzKTsKICAgICAgICAgICAgaWYgKHJlbmRlcmVyLlN1cHBvcnRzR1BVUHJvZmlsaW5nKCkpIHRoaXMuX2dwdUxhc3RVdGlsaXNhdGlvbiA9CiAgICAgICAgICAgICAgICAwOwogICAgICAgICAgICBmb3IgKGNvbnN0IGVmZmVjdExpc3Qgb2YgdGhpcy5fcnVudGltZS5fR2V0QWxsRWZmZWN0TGlzdHMoKSkgewogICAgICAgICAgICAgICAgZm9yIChjb25zdCBlZmZlY3RUeXBlIG9mIGVmZmVjdExpc3QuR2V0QWxsRWZmZWN0VHlwZXMoKSkgZWZmZWN0VHlwZS5fSW5pdFJlbmRlcmVyKHJlbmRlcmVyKTsKICAgICAgICAgICAgICAgIGVmZmVjdExpc3QuX0luaXRSZW5kZXJlcihyZW5kZXJlcik7CiAgICAgICAgICAgICAgICBlZmZlY3RMaXN0LlVwZGF0ZUFjdGl2ZUVmZmVjdHMoKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIFJlbGVhc2UoKSB7CiAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUgPSBudWxsOwogICAgICAgICAgICB0aGlzLl93ZWJnbFJlbmRlcmVyID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fY2FudmFzID0gbnVsbAogICAgICAgIH0KICAgICAgICBfT25XaW5kb3dSZXNpemUoZSkgewogICAgICAgICAgICBjb25zdCBydW50aW1lID0gdGhpcy5fcnVudGltZTsKICAgICAgICAgICAgaWYgKHJ1bnRpbWUuSXNFeHBvcnRUb1ZpZGVvKCkpIHJldHVybjsKICAgICAgICAgICAgY29uc3QgZHByID0gZVsiZGV2aWNlUGl4ZWxSYXRpbyJdOwogICAgICAgICAgICBpZiAocnVudGltZS5Jc0luV29ya2VyKCkpIHNlbGYuZGV2aWNlUGl4ZWxSYXRpbyA9IGRwcjsKICAgICAgICAgICAgcnVudGltZS5fU2V0RGV2aWNlUGl4ZWxSYXRpbyhkcHIpOwogICAgICAgICAgICB0aGlzLl9pc0RvY3VtZW50RnVsbHNjcmVlbiA9ICEhZVsiaXNGdWxsc2NyZWVuIl07CiAgICAgICAgICAgIHRoaXMuU2V0U2l6ZShlWyJpbm5lcldpZHRoIl0sIGVbImlubmVySGVpZ2h0Il0pOwogICAgICAgICAgICBydW50aW1lLlVwZGF0ZVJlbmRlcigpOwogICAgICAgICAgICBjb25zdCBldiA9IG5ldyBDMy5FdmVudCgid2luZG93LXJlc2l6ZSIpOwogICAgICAgICAgICBldi5kYXRhID0gZTsKICAgICAgICAgICAgcnVudGltZS5EaXNwYXRjaGVyKCkuZGlzcGF0Y2hFdmVudEFuZFdhaXRBc3luY1NlcXVlbnRpYWwoZXYpOwogICAgICAgICAgICBjb25zdCBldjIgPSBuZXcgQzMuRXZlbnQoInJlc2l6ZSIpOwogICAgICAgICAgICBldjIuY3NzV2lkdGggPSB0aGlzLkdldENzc1dpZHRoKCk7CiAgICAgICAgICAgIGV2Mi5jc3NIZWlnaHQgPSB0aGlzLkdldENzc0hlaWdodCgpOwogICAgICAgICAgICBldjIuZGV2aWNlV2lkdGggPSB0aGlzLkdldERldmljZVdpZHRoKCk7CiAgICAgICAgICAgIGV2Mi5kZXZpY2VIZWlnaHQgPSB0aGlzLkdldERldmljZUhlaWdodCgpOwogICAgICAgICAgICBydW50aW1lLkRpc3BhdGNoVXNlclNjcmlwdEV2ZW50KGV2Mik7CiAgICAgICAgICAgIGlmIChydW50aW1lLklzRGVidWcoKSAmJiAocnVudGltZS5IaXRCcmVha3BvaW50KCkgfHwgc2VsZi5DM0RlYnVnZ2VyLklzRGVidWdnZXJQYXVzZWQoKSkpIHJ1bnRpbWUuUmVuZGVyKCkKICAgICAgICB9CiAgICAgICAgX09uRnVsbHNjcmVlbkNoYW5nZShlKSB7CiAgICAgICAgICAgIHRoaXMuX2lzRG9jdW1lbnRGdWxsc2NyZWVuID0gISFlWyJpc0Z1bGxzY3JlZW4iXTsKICAgICAgICAgICAgdGhpcy5TZXRTaXplKGVbImlubmVyV2lkdGgiXSwgZVsiaW5uZXJIZWlnaHQiXSwgdHJ1ZSk7CiAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuVXBkYXRlUmVuZGVyKCkKICAgICAgICB9CiAgICAgICAgX09uRnVsbHNjcmVlbkVycm9yKGUpIHsKICAgICAgICAgICAgdGhpcy5faXNEb2N1bWVudEZ1bGxzY3JlZW4gPSAhIWVbImlzRnVsbHNjcmVlbiJdOwogICAgICAgICAgICB0aGlzLlNldFNpemUoZVsiaW5uZXJXaWR0aCJdLCBlWyJpbm5lckhlaWdodCJdLCB0cnVlKTsKICAgICAgICAgICAgdGhpcy5fcnVudGltZS5VcGRhdGVSZW5kZXIoKQogICAgICAgIH0KICAgICAgICBTZXRTaXplKGF2YWlsYWJsZVdpZHRoLCBhdmFpbGFibGVIZWlnaHQsIGZvcmNlID0gZmFsc2UpIHsKICAgICAgICAgICAgYXZhaWxhYmxlV2lkdGggPSBNYXRoLmZsb29yKGF2YWlsYWJsZVdpZHRoKTsKICAgICAgICAgICAgYXZhaWxhYmxlSGVpZ2h0ID0gTWF0aC5mbG9vcihhdmFpbGFibGVIZWlnaHQpOwogICAgICAgICAgICBpZiAoYXZhaWxhYmxlV2lkdGggPD0gMCB8fCBhdmFpbGFibGVIZWlnaHQgPD0gMCkgdGhyb3cgbmV3IEVycm9yKCJpbnZhbGlkIHNpemUiKTsKICAgICAgICAgICAgaWYgKHRoaXMuX3dpbmRvd0lubmVyV2lkdGggPT09IGF2YWlsYWJsZVdpZHRoICYmCiAgICAgICAgICAgICAgICB0aGlzLl93aW5kb3dJbm5lckhlaWdodCA9PT0gYXZhaWxhYmxlSGVpZ2h0ICYmICFmb3JjZSkgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl93aW5kb3dJbm5lcldpZHRoID0gYXZhaWxhYmxlV2lkdGg7CiAgICAgICAgICAgIHRoaXMuX3dpbmRvd0lubmVySGVpZ2h0ID0gYXZhaWxhYmxlSGVpZ2h0OwogICAgICAgICAgICBjb25zdCBmdWxsc2NyZWVuTW9kZSA9IHRoaXMuR2V0Q3VycmVudEZ1bGxzY3JlZW5Nb2RlKCk7CiAgICAgICAgICAgIGlmIChmdWxsc2NyZWVuTW9kZSA9PT0gImxldHRlcmJveC1zY2FsZSIpIHRoaXMuX0NhbGN1bGF0ZUxldHRlcmJveFNjYWxlKGF2YWlsYWJsZVdpZHRoLCBhdmFpbGFibGVIZWlnaHQpOwogICAgICAgICAgICBlbHNlIGlmIChmdWxsc2NyZWVuTW9kZSA9PT0gImxldHRlcmJveC1pbnRlZ2VyLXNjYWxlIikgdGhpcy5fQ2FsY3VsYXRlTGV0dGVyYm94SW50ZWdlclNjYWxlKGF2YWlsYWJsZVdpZHRoLCBhdmFpbGFibGVIZWlnaHQpOwogICAgICAgICAgICBlbHNlIGlmIChmdWxsc2NyZWVuTW9kZSA9PT0gIm9mZiIpIHRoaXMuX0NhbGN1bGF0ZUZpeGVkU2l6ZUNhbnZhcyhhdmFpbGFibGVXaWR0aCwgYXZhaWxhYmxlSGVpZ2h0KTsKICAgICAgICAgICAgZWxzZSB0aGlzLl9DYWxjdWxhdGVGdWxsc2l6ZUNhbnZhcyhhdmFpbGFibGVXaWR0aCwgYXZhaWxhYmxlSGVpZ2h0KTsKICAgICAgICAgICAgdGhpcy5fVXBkYXRlRnVsbHNjcmVlblNjYWxpbmdRdWFsaXR5KGZ1bGxzY3JlZW5Nb2RlKTsKICAgICAgICAgICAgdGhpcy5fY2FudmFzLndpZHRoID0gdGhpcy5fY2FudmFzRGV2aWNlV2lkdGg7CiAgICAgICAgICAgIHRoaXMuX2NhbnZhcy5oZWlnaHQgPSB0aGlzLl9jYW52YXNEZXZpY2VIZWlnaHQ7CiAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuUG9zdENvbXBvbmVudE1lc3NhZ2VUb0RPTSgiY2FudmFzIiwgInVwZGF0ZS1zaXplIiwgewogICAgICAgICAgICAgICAgIm1hcmdpbkxlZnQiOiB0aGlzLl9jYW52YXNDc3NPZmZzZXRYLAogICAgICAgICAgICAgICAgIm1hcmdpblRvcCI6IHRoaXMuX2NhbnZhc0Nzc09mZnNldFksCiAgICAgICAgICAgICAgICAic3R5bGVXaWR0aCI6IHRoaXMuX2NhbnZhc0Nzc1dpZHRoLAogICAgICAgICAgICAgICAgInN0eWxlSGVpZ2h0IjogdGhpcy5fY2FudmFzQ3NzSGVpZ2h0LAogICAgICAgICAgICAgICAgImRpc3BsYXlTY2FsZSI6IHRoaXMuR2V0RGlzcGxheVNjYWxlKCkKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGNvbnN0IHJlbmRlcmVyID0gdGhpcy5HZXRSZW5kZXJlcigpOwogICAgICAgICAgICByZW5kZXJlci5TZXRTaXplKHRoaXMuX2NhbnZhc0RldmljZVdpZHRoLAogICAgICAgICAgICAgICAgdGhpcy5fY2FudmFzRGV2aWNlSGVpZ2h0LCB0cnVlKTsKICAgICAgICAgICAgZm9yIChjb25zdCBydCBvZiB0aGlzLl9hdmFpbGFibGVBZGRpdGlvbmFsUmVuZGVyVGFyZ2V0cykgcmVuZGVyZXIuRGVsZXRlUmVuZGVyVGFyZ2V0KHJ0KTsKICAgICAgICAgICAgQzMuY2xlYXJBcnJheSh0aGlzLl9hdmFpbGFibGVBZGRpdGlvbmFsUmVuZGVyVGFyZ2V0cyk7CiAgICAgICAgICAgIHJlbmRlcmVyLkNhbGN1bGF0ZVBlcnNwZWN0aXZlTWF0cml4KHRoaXMuX2RlZmF1bHRQcm9qZWN0aW9uTWF0cml4LCB0aGlzLkdldERyYXdXaWR0aCgpIC8gdGhpcy5HZXREcmF3SGVpZ2h0KCkpOwogICAgICAgICAgICBjb25zdCBsYXlvdXRNYW5hZ2VyID0gdGhpcy5fcnVudGltZS5HZXRMYXlvdXRNYW5hZ2VyKCk7CiAgICAgICAgICAgIGxheW91dE1hbmFnZXIuU2V0QWxsTGF5ZXJQcm9qZWN0aW9uQ2hhbmdlZCgpOwogICAgICAgICAgICBsYXlvdXRNYW5hZ2VyLlNldEFsbExheWVyTVZDaGFuZ2VkKCkKICAgICAgICB9CiAgICAgICAgR2V0RGVmYXVsdFByb2plY3Rpb25NYXRyaXgoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9kZWZhdWx0UHJvamVjdGlvbk1hdHJpeAogICAgICAgIH0KICAgICAgICBfQ2FsY3VsYXRlTGV0dGVyYm94U2NhbGUoYXZhaWxhYmxlV2lkdGgsCiAgICAgICAgICAgIGF2YWlsYWJsZUhlaWdodCkgewogICAgICAgICAgICBjb25zdCBkcHIgPSB0aGlzLl9ydW50aW1lLkdldERldmljZVBpeGVsUmF0aW8oKTsKICAgICAgICAgICAgY29uc3Qgb3JpZ2luYWxWaWV3cG9ydFdpZHRoID0gdGhpcy5fcnVudGltZS5HZXRPcmlnaW5hbFZpZXdwb3J0V2lkdGgoKTsKICAgICAgICAgICAgY29uc3Qgb3JpZ2luYWxWaWV3cG9ydEhlaWdodCA9IHRoaXMuX3J1bnRpbWUuR2V0T3JpZ2luYWxWaWV3cG9ydEhlaWdodCgpOwogICAgICAgICAgICBjb25zdCBvcmlnaW5hbEFzcGVjdFJhdGlvID0gb3JpZ2luYWxWaWV3cG9ydFdpZHRoIC8gb3JpZ2luYWxWaWV3cG9ydEhlaWdodDsKICAgICAgICAgICAgY29uc3QgYXZhaWxhYmxlQXNwZWN0UmF0aW8gPSBhdmFpbGFibGVXaWR0aCAvIGF2YWlsYWJsZUhlaWdodDsKICAgICAgICAgICAgaWYgKGF2YWlsYWJsZUFzcGVjdFJhdGlvID4gb3JpZ2luYWxBc3BlY3RSYXRpbykgewogICAgICAgICAgICAgICAgY29uc3QgbGV0dGVyYm94ZWRXaWR0aCA9IGF2YWlsYWJsZUhlaWdodCAqIG9yaWdpbmFsQXNwZWN0UmF0aW87CiAgICAgICAgICAgICAgICB0aGlzLl9jYW52YXNDc3NXaWR0aCA9IE1hdGgucm91bmQobGV0dGVyYm94ZWRXaWR0aCk7CiAgICAgICAgICAgICAgICB0aGlzLl9jYW52YXNDc3NIZWlnaHQgPQogICAgICAgICAgICAgICAgICAgIGF2YWlsYWJsZUhlaWdodDsKICAgICAgICAgICAgICAgIHRoaXMuX2NhbnZhc0Nzc09mZnNldFggPSBNYXRoLmZsb29yKChhdmFpbGFibGVXaWR0aCAtIHRoaXMuX2NhbnZhc0Nzc1dpZHRoKSAvIDIpOwogICAgICAgICAgICAgICAgdGhpcy5fY2FudmFzQ3NzT2Zmc2V0WSA9IDAKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbnN0IGxldHRlcmJveGVkSGVpZ2h0ID0gYXZhaWxhYmxlV2lkdGggLyBvcmlnaW5hbEFzcGVjdFJhdGlvOwogICAgICAgICAgICAgICAgdGhpcy5fY2FudmFzQ3NzV2lkdGggPSBhdmFpbGFibGVXaWR0aDsKICAgICAgICAgICAgICAgIHRoaXMuX2NhbnZhc0Nzc0hlaWdodCA9IE1hdGgucm91bmQobGV0dGVyYm94ZWRIZWlnaHQpOwogICAgICAgICAgICAgICAgdGhpcy5fY2FudmFzQ3NzT2Zmc2V0WCA9IDA7CiAgICAgICAgICAgICAgICB0aGlzLl9jYW52YXNDc3NPZmZzZXRZID0gTWF0aC5mbG9vcigoYXZhaWxhYmxlSGVpZ2h0IC0gdGhpcy5fY2FudmFzQ3NzSGVpZ2h0KSAvIDIpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5fY2FudmFzRGV2aWNlV2lkdGggPSBNYXRoLnJvdW5kKHRoaXMuX2NhbnZhc0Nzc1dpZHRoICogZHByKTsKICAgICAgICAgICAgdGhpcy5fY2FudmFzRGV2aWNlSGVpZ2h0ID0gTWF0aC5yb3VuZCh0aGlzLl9jYW52YXNDc3NIZWlnaHQgKiBkcHIpOwogICAgICAgICAgICB0aGlzLl9ydW50aW1lLlNldFZpZXdwb3J0U2l6ZShvcmlnaW5hbFZpZXdwb3J0V2lkdGgsCiAgICAgICAgICAgICAgICBvcmlnaW5hbFZpZXdwb3J0SGVpZ2h0KQogICAgICAgIH0KICAgICAgICBfQ2FsY3VsYXRlTGV0dGVyYm94SW50ZWdlclNjYWxlKGF2YWlsYWJsZVdpZHRoLCBhdmFpbGFibGVIZWlnaHQpIHsKICAgICAgICAgICAgY29uc3QgZHByID0gdGhpcy5fcnVudGltZS5HZXREZXZpY2VQaXhlbFJhdGlvKCk7CiAgICAgICAgICAgIGlmIChkcHIgIT09IDEpIHsKICAgICAgICAgICAgICAgIGF2YWlsYWJsZVdpZHRoICs9IDE7CiAgICAgICAgICAgICAgICBhdmFpbGFibGVIZWlnaHQgKz0gMQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IG9yaWdpbmFsVmlld3BvcnRXaWR0aCA9IHRoaXMuX3J1bnRpbWUuR2V0T3JpZ2luYWxWaWV3cG9ydFdpZHRoKCk7CiAgICAgICAgICAgIGNvbnN0IG9yaWdpbmFsVmlld3BvcnRIZWlnaHQgPSB0aGlzLl9ydW50aW1lLkdldE9yaWdpbmFsVmlld3BvcnRIZWlnaHQoKTsKICAgICAgICAgICAgY29uc3Qgb3JpZ2luYWxBc3BlY3RSYXRpbyA9IG9yaWdpbmFsVmlld3BvcnRXaWR0aCAvIG9yaWdpbmFsVmlld3BvcnRIZWlnaHQ7CiAgICAgICAgICAgIGNvbnN0IGF2YWlsYWJsZUFzcGVjdFJhdGlvID0gYXZhaWxhYmxlV2lkdGggLyBhdmFpbGFibGVIZWlnaHQ7CiAgICAgICAgICAgIGxldCBpbnRTY2FsZTsKICAgICAgICAgICAgaWYgKGF2YWlsYWJsZUFzcGVjdFJhdGlvID4gb3JpZ2luYWxBc3BlY3RSYXRpbykgewogICAgICAgICAgICAgICAgY29uc3QgbGV0dGVyYm94ZWRXaWR0aCA9CiAgICAgICAgICAgICAgICAgICAgYXZhaWxhYmxlSGVpZ2h0ICogb3JpZ2luYWxBc3BlY3RSYXRpbzsKICAgICAgICAgICAgICAgIGludFNjYWxlID0gbGV0dGVyYm94ZWRXaWR0aCAqIGRwciAvIG9yaWdpbmFsVmlld3BvcnRXaWR0aAogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29uc3QgbGV0dGVyYm94ZWRIZWlnaHQgPSBhdmFpbGFibGVXaWR0aCAvIG9yaWdpbmFsQXNwZWN0UmF0aW87CiAgICAgICAgICAgICAgICBpbnRTY2FsZSA9IGxldHRlcmJveGVkSGVpZ2h0ICogZHByIC8gb3JpZ2luYWxWaWV3cG9ydEhlaWdodAogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChpbnRTY2FsZSA+IDEpIGludFNjYWxlID0gTWF0aC5mbG9vcihpbnRTY2FsZSk7CiAgICAgICAgICAgIGVsc2UgaWYgKGludFNjYWxlIDwgMSkgaW50U2NhbGUgPSAxIC8gTWF0aC5jZWlsKDEgLyBpbnRTY2FsZSk7CiAgICAgICAgICAgIHRoaXMuX2NhbnZhc0RldmljZVdpZHRoID0gTWF0aC5yb3VuZChvcmlnaW5hbFZpZXdwb3J0V2lkdGggKiBpbnRTY2FsZSk7CiAgICAgICAgICAgIHRoaXMuX2NhbnZhc0RldmljZUhlaWdodCA9IE1hdGgucm91bmQob3JpZ2luYWxWaWV3cG9ydEhlaWdodCAqIGludFNjYWxlKTsKICAgICAgICAgICAgdGhpcy5fY2FudmFzQ3NzV2lkdGggPSB0aGlzLl9jYW52YXNEZXZpY2VXaWR0aCAvIGRwcjsKICAgICAgICAgICAgdGhpcy5fY2FudmFzQ3NzSGVpZ2h0ID0KICAgICAgICAgICAgICAgIHRoaXMuX2NhbnZhc0RldmljZUhlaWdodCAvIGRwcjsKICAgICAgICAgICAgdGhpcy5fY2FudmFzQ3NzT2Zmc2V0WCA9IE1hdGgubWF4KE1hdGguZmxvb3IoKGF2YWlsYWJsZVdpZHRoIC0gdGhpcy5fY2FudmFzQ3NzV2lkdGgpIC8gMiksIDApOwogICAgICAgICAgICB0aGlzLl9jYW52YXNDc3NPZmZzZXRZID0gTWF0aC5tYXgoTWF0aC5mbG9vcigoYXZhaWxhYmxlSGVpZ2h0IC0gdGhpcy5fY2FudmFzQ3NzSGVpZ2h0KSAvIDIpLCAwKTsKICAgICAgICAgICAgdGhpcy5fcnVudGltZS5TZXRWaWV3cG9ydFNpemUob3JpZ2luYWxWaWV3cG9ydFdpZHRoLCBvcmlnaW5hbFZpZXdwb3J0SGVpZ2h0KQogICAgICAgIH0KICAgICAgICBfQ2FsY3VsYXRlRnVsbHNpemVDYW52YXMoYXZhaWxhYmxlV2lkdGgsIGF2YWlsYWJsZUhlaWdodCkgewogICAgICAgICAgICBjb25zdCBkcHIgPSB0aGlzLl9ydW50aW1lLkdldERldmljZVBpeGVsUmF0aW8oKTsKICAgICAgICAgICAgdGhpcy5fY2FudmFzQ3NzV2lkdGggPSBhdmFpbGFibGVXaWR0aDsKICAgICAgICAgICAgdGhpcy5fY2FudmFzQ3NzSGVpZ2h0ID0gYXZhaWxhYmxlSGVpZ2h0OwogICAgICAgICAgICB0aGlzLl9jYW52YXNEZXZpY2VXaWR0aCA9IE1hdGgucm91bmQodGhpcy5fY2FudmFzQ3NzV2lkdGggKgogICAgICAgICAgICAgICAgZHByKTsKICAgICAgICAgICAgdGhpcy5fY2FudmFzRGV2aWNlSGVpZ2h0ID0gTWF0aC5yb3VuZCh0aGlzLl9jYW52YXNDc3NIZWlnaHQgKiBkcHIpOwogICAgICAgICAgICB0aGlzLl9jYW52YXNDc3NPZmZzZXRYID0gMDsKICAgICAgICAgICAgdGhpcy5fY2FudmFzQ3NzT2Zmc2V0WSA9IDA7CiAgICAgICAgICAgIGNvbnN0IGRpc3BsYXlTY2FsZSA9IHRoaXMuR2V0RGlzcGxheVNjYWxlKCk7CiAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuU2V0Vmlld3BvcnRTaXplKHRoaXMuX2NhbnZhc0Nzc1dpZHRoIC8gZGlzcGxheVNjYWxlLCB0aGlzLl9jYW52YXNDc3NIZWlnaHQgLyBkaXNwbGF5U2NhbGUpCiAgICAgICAgfQogICAgICAgIF9DYWxjdWxhdGVGaXhlZFNpemVDYW52YXMoYXZhaWxhYmxlV2lkdGgsIGF2YWlsYWJsZUhlaWdodCkgewogICAgICAgICAgICBjb25zdCBkcHIgPSB0aGlzLl9ydW50aW1lLkdldERldmljZVBpeGVsUmF0aW8oKTsKICAgICAgICAgICAgdGhpcy5fY2FudmFzQ3NzV2lkdGggPSB0aGlzLl9ydW50aW1lLkdldFZpZXdwb3J0V2lkdGgoKTsKICAgICAgICAgICAgdGhpcy5fY2FudmFzQ3NzSGVpZ2h0ID0gdGhpcy5fcnVudGltZS5HZXRWaWV3cG9ydEhlaWdodCgpOwogICAgICAgICAgICB0aGlzLl9jYW52YXNEZXZpY2VXaWR0aCA9IE1hdGgucm91bmQodGhpcy5fY2FudmFzQ3NzV2lkdGggKgogICAgICAgICAgICAgICAgZHByKTsKICAgICAgICAgICAgdGhpcy5fY2FudmFzRGV2aWNlSGVpZ2h0ID0gTWF0aC5yb3VuZCh0aGlzLl9jYW52YXNDc3NIZWlnaHQgKiBkcHIpOwogICAgICAgICAgICBpZiAodGhpcy5Jc0RvY3VtZW50RnVsbHNjcmVlbigpKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9jYW52YXNDc3NPZmZzZXRYID0gTWF0aC5mbG9vcigoYXZhaWxhYmxlV2lkdGggLSB0aGlzLl9jYW52YXNDc3NXaWR0aCkgLyAyKTsKICAgICAgICAgICAgICAgIHRoaXMuX2NhbnZhc0Nzc09mZnNldFkgPSBNYXRoLmZsb29yKChhdmFpbGFibGVIZWlnaHQgLSB0aGlzLl9jYW52YXNDc3NIZWlnaHQpIC8gMikKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuX2NhbnZhc0Nzc09mZnNldFggPSAwOwogICAgICAgICAgICAgICAgdGhpcy5fY2FudmFzQ3NzT2Zmc2V0WSA9IDAKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLl9ydW50aW1lLlNldFZpZXdwb3J0U2l6ZSh0aGlzLl9ydW50aW1lLkdldFZpZXdwb3J0V2lkdGgoKSwgdGhpcy5fcnVudGltZS5HZXRWaWV3cG9ydEhlaWdodCgpKQogICAgICAgIH0KICAgICAgICBfVXBkYXRlRnVsbHNjcmVlblNjYWxpbmdRdWFsaXR5KGZ1bGxzY3JlZW5Nb2RlKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl93YW50RnVsbHNjcmVlblNjYWxpbmdRdWFsaXR5ID09PSAiaGlnaCIpIHsKICAgICAgICAgICAgICAgIHRoaXMuX2RyYXdXaWR0aCA9CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY2FudmFzRGV2aWNlV2lkdGg7CiAgICAgICAgICAgICAgICB0aGlzLl9kcmF3SGVpZ2h0ID0gdGhpcy5fY2FudmFzRGV2aWNlSGVpZ2h0OwogICAgICAgICAgICAgICAgdGhpcy5fZnVsbHNjcmVlblNjYWxpbmdRdWFsaXR5ID0gImhpZ2giCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBsZXQgdmlld3BvcnRXaWR0aCwgdmlld3BvcnRIZWlnaHQ7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5HZXRDdXJyZW50RnVsbHNjcmVlbk1vZGUoKSA9PT0gIm9mZiIpIHsKICAgICAgICAgICAgICAgICAgICB2aWV3cG9ydFdpZHRoID0gdGhpcy5fcnVudGltZS5HZXRWaWV3cG9ydFdpZHRoKCk7CiAgICAgICAgICAgICAgICAgICAgdmlld3BvcnRIZWlnaHQgPSB0aGlzLl9ydW50aW1lLkdldFZpZXdwb3J0SGVpZ2h0KCkKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdmlld3BvcnRXaWR0aCA9IHRoaXMuX3J1bnRpbWUuR2V0T3JpZ2luYWxWaWV3cG9ydFdpZHRoKCk7CiAgICAgICAgICAgICAgICAgICAgdmlld3BvcnRIZWlnaHQgPSB0aGlzLl9ydW50aW1lLkdldE9yaWdpbmFsVmlld3BvcnRIZWlnaHQoKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHRoaXMuX2NhbnZhc0RldmljZVdpZHRoIDwgdmlld3BvcnRXaWR0aCB8fCB0aGlzLl9jYW52YXNEZXZpY2VIZWlnaHQgPCB2aWV3cG9ydEhlaWdodCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX2RyYXdXaWR0aCA9IHRoaXMuX2NhbnZhc0RldmljZVdpZHRoOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2RyYXdIZWlnaHQgPSB0aGlzLl9jYW52YXNEZXZpY2VIZWlnaHQ7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZnVsbHNjcmVlblNjYWxpbmdRdWFsaXR5ID0gImhpZ2giCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX2RyYXdXaWR0aCA9IHZpZXdwb3J0V2lkdGg7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZHJhd0hlaWdodCA9IHZpZXdwb3J0SGVpZ2h0OwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2Z1bGxzY3JlZW5TY2FsaW5nUXVhbGl0eSA9ICJsb3ciOwogICAgICAgICAgICAgICAgICAgIGlmIChmdWxsc2NyZWVuTW9kZSA9PT0gInNjYWxlLWlubmVyIikgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBvcmlnaW5hbEFzcGVjdFJhdGlvID0gdmlld3BvcnRXaWR0aCAvIHZpZXdwb3J0SGVpZ2h0OwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50QXNwZWN0UmF0aW8gPSB0aGlzLl93aW5kb3dJbm5lcldpZHRoIC8gdGhpcy5fd2luZG93SW5uZXJIZWlnaHQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50QXNwZWN0UmF0aW8gPCBvcmlnaW5hbEFzcGVjdFJhdGlvKSB0aGlzLl9kcmF3V2lkdGggPSB0aGlzLl9kcmF3SGVpZ2h0ICogY3VycmVudEFzcGVjdFJhdGlvOwogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChjdXJyZW50QXNwZWN0UmF0aW8gPiBvcmlnaW5hbEFzcGVjdFJhdGlvKSB0aGlzLl9kcmF3SGVpZ2h0ID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2RyYXdXaWR0aCAvIGN1cnJlbnRBc3BlY3RSYXRpbwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZnVsbHNjcmVlbk1vZGUgPT09ICJzY2FsZS1vdXRlciIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3JpZ2luYWxBc3BlY3RSYXRpbyA9IHZpZXdwb3J0V2lkdGggLyB2aWV3cG9ydEhlaWdodDsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VycmVudEFzcGVjdFJhdGlvID0gdGhpcy5fd2luZG93SW5uZXJXaWR0aCAvIHRoaXMuX3dpbmRvd0lubmVySGVpZ2h0OwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudEFzcGVjdFJhdGlvID4gb3JpZ2luYWxBc3BlY3RSYXRpbykgdGhpcy5fZHJhd1dpZHRoID0gdGhpcy5fZHJhd0hlaWdodCAqIGN1cnJlbnRBc3BlY3RSYXRpbzsKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoY3VycmVudEFzcGVjdFJhdGlvIDwgb3JpZ2luYWxBc3BlY3RSYXRpbykgdGhpcy5fZHJhd0hlaWdodCA9IHRoaXMuX2RyYXdXaWR0aCAvIGN1cnJlbnRBc3BlY3RSYXRpbwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBHZXRSdW50aW1lKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fcnVudGltZQogICAgICAgIH0KICAgICAgICBHZXRDYW52YXMoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9jYW52YXMKICAgICAgICB9CiAgICAgICAgR2V0RWZmZWN0Q2hhaW5NYW5hZ2VyKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZWZmZWN0Q2hhaW5NYW5hZ2VyCiAgICAgICAgfQogICAgICAgIElzRG9jdW1lbnRGdWxsc2NyZWVuKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faXNEb2N1bWVudEZ1bGxzY3JlZW4KICAgICAgICB9CiAgICAgICAgU2V0RnVsbHNjcmVlbk1vZGUobSkgewogICAgICAgICAgICBpZiAoIVZBTElEX0ZVTExTQ1JFRU5fTU9ERVMuaGFzKG0pKSB0aHJvdyBuZXcgRXJyb3IoImludmFsaWQgZnVsbHNjcmVlbiBtb2RlIik7CiAgICAgICAgICAgIHRoaXMuX2Z1bGxzY3JlZW5Nb2RlID0gbTsKICAgICAgICAgICAgY29uc3QgbGF5b3V0TWFuYWdlciA9IHRoaXMuX3J1bnRpbWUuR2V0TGF5b3V0TWFuYWdlcigpOwogICAgICAgICAgICBsYXlvdXRNYW5hZ2VyLlNldEFsbExheWVyUHJvamVjdGlvbkNoYW5nZWQoKTsKICAgICAgICAgICAgbGF5b3V0TWFuYWdlci5TZXRBbGxMYXllck1WQ2hhbmdlZCgpCiAgICAgICAgfQogICAgICAgIEdldEZ1bGxzY3JlZW5Nb2RlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZnVsbHNjcmVlbk1vZGUKICAgICAgICB9CiAgICAgICAgU2V0RG9jdW1lbnRGdWxsc2NyZWVuTW9kZShtKSB7CiAgICAgICAgICAgIGlmICghVkFMSURfRlVMTFNDUkVFTl9NT0RFUy5oYXMobSkpIHRocm93IG5ldyBFcnJvcigiaW52YWxpZCBmdWxsc2NyZWVuIG1vZGUiKTsKICAgICAgICAgICAgdGhpcy5fZG9jdW1lbnRGdWxsc2NyZWVuTW9kZSA9IG07CiAgICAgICAgICAgIGNvbnN0IGxheW91dE1hbmFnZXIgPSB0aGlzLl9ydW50aW1lLkdldExheW91dE1hbmFnZXIoKTsKICAgICAgICAgICAgbGF5b3V0TWFuYWdlci5TZXRBbGxMYXllclByb2plY3Rpb25DaGFuZ2VkKCk7CiAgICAgICAgICAgIGxheW91dE1hbmFnZXIuU2V0QWxsTGF5ZXJNVkNoYW5nZWQoKQogICAgICAgIH0KICAgICAgICBHZXREb2N1bWVudEZ1bGxzY3JlZW5Nb2RlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZG9jdW1lbnRGdWxsc2NyZWVuTW9kZQogICAgICAgIH0KICAgICAgICBHZXRDdXJyZW50RnVsbHNjcmVlbk1vZGUoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLklzRG9jdW1lbnRGdWxsc2NyZWVuKCkpIHJldHVybiB0aGlzLkdldERvY3VtZW50RnVsbHNjcmVlbk1vZGUoKTsKICAgICAgICAgICAgZWxzZSByZXR1cm4gdGhpcy5HZXRGdWxsc2NyZWVuTW9kZSgpCiAgICAgICAgfQogICAgICAgIFNldEZ1bGxzY3JlZW5TY2FsaW5nUXVhbGl0eShxKSB7CiAgICAgICAgICAgIGlmICghVkFMSURfRlVMTFNDUkVFTl9TQ0FMSU5HX1FVQUxJVElFUy5oYXMocSkpIHRocm93IG5ldyBFcnJvcigiaW52YWxpZCBmdWxsc2NyZWVuIHNjYWxpbmcgcXVhbGl0eSIpOwogICAgICAgICAgICB0aGlzLl93YW50RnVsbHNjcmVlblNjYWxpbmdRdWFsaXR5ID0gcTsKICAgICAgICAgICAgdGhpcy5fcnVudGltZS5HZXRMYXlvdXRNYW5hZ2VyKCkuU2V0QWxsTGF5ZXJQcm9qZWN0aW9uQ2hhbmdlZCgpCiAgICAgICAgfQogICAgICAgIEdldFNldEZ1bGxzY3JlZW5TY2FsaW5nUXVhbGl0eSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3dhbnRGdWxsc2NyZWVuU2NhbGluZ1F1YWxpdHkKICAgICAgICB9CiAgICAgICAgR2V0Q3VycmVudEZ1bGxzY3JlZW5TY2FsaW5nUXVhbGl0eSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2Z1bGxzY3JlZW5TY2FsaW5nUXVhbGl0eQogICAgICAgIH0KICAgICAgICBzdGF0aWMgX0Z1bGxzY3JlZW5Nb2RlTnVtYmVyVG9TdHJpbmcobikgewogICAgICAgICAgICBzd2l0Y2ggKG4pIHsKICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gIm9mZiI7CiAgICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJjcm9wIjsKICAgICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gInNjYWxlLWlubmVyIjsKICAgICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gInNjYWxlLW91dGVyIjsKICAgICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gImxldHRlcmJveC1zY2FsZSI7CiAgICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJsZXR0ZXJib3gtaW50ZWdlci1zY2FsZSI7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiaW52YWxpZCBmdWxsc2NyZWVuIG1vZGUiKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBHZXRMYXN0V2lkdGgoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl93aW5kb3dJbm5lcldpZHRoCiAgICAgICAgfQogICAgICAgIEdldExhc3RIZWlnaHQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl93aW5kb3dJbm5lckhlaWdodAogICAgICAgIH0KICAgICAgICBHZXREcmF3V2lkdGgoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9kcmF3V2lkdGgKICAgICAgICB9CiAgICAgICAgR2V0RHJhd0hlaWdodCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2RyYXdIZWlnaHQKICAgICAgICB9CiAgICAgICAgU2V0TWlwbWFwc0VuYWJsZWQoZSkgewogICAgICAgICAgICB0aGlzLl9lbmFibGVNaXBtYXBzID0gISFlCiAgICAgICAgfQogICAgICAgIF9TZXRUZXh0dXJlQW5pc290cm9weShhKSB7CiAgICAgICAgICAgIHRoaXMuX3RleHR1cmVBbmlzb3Ryb3B5ID0gYQogICAgICAgIH0KICAgICAgICBHZXRUZXh0dXJlQW5pc290cm9weSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RleHR1cmVBbmlzb3Ryb3B5CiAgICAgICAgfQogICAgICAgIElzUmVuZGVyZXJDb250ZXh0TG9zdCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuR2V0UmVuZGVyZXIoKS5Jc0NvbnRleHRMb3N0KCkKICAgICAgICB9CiAgICAgICAgX09uV2ViR0xDb250ZXh0TG9zdChlKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCJbQ29uc3RydWN0XSBXZWJHTCBjb250ZXh0IGxvc3QiKTsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICB0aGlzLl9hdmFpbGFibGVBZGRpdGlvbmFsUmVuZGVyVGFyZ2V0cyA9IFtdOwogICAgICAgICAgICB0aGlzLl91c2VkQWRkaXRpb25hbFJlbmRlclRhcmdldHMuY2xlYXIoKTsKICAgICAgICAgICAgdGhpcy5fZWZmZWN0Q2hhaW5NYW5hZ2VyLk9uQ29udGV4dExvc3QoKTsKICAgICAgICAgICAgdGhpcy5fd2ViZ2xSZW5kZXJlci5PbkNvbnRleHRMb3N0KCk7CiAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuX09uUmVuZGVyZXJDb250ZXh0TG9zdCgpCiAgICAgICAgfQogICAgICAgIF9PbldlYkdQVURldmljZUxvc3QoKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCJbQ29uc3RydWN0XSBXZWJHUFUgZGV2aWNlIGxvc3QiKTsKICAgICAgICAgICAgdGhpcy5fYXZhaWxhYmxlQWRkaXRpb25hbFJlbmRlclRhcmdldHMgPSBbXTsKICAgICAgICAgICAgdGhpcy5fdXNlZEFkZGl0aW9uYWxSZW5kZXJUYXJnZXRzLmNsZWFyKCk7CiAgICAgICAgICAgIHRoaXMuX2VmZmVjdENoYWluTWFuYWdlci5PbkNvbnRleHRMb3N0KCk7CiAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuX09uUmVuZGVyZXJDb250ZXh0TG9zdCgpCiAgICAgICAgfQogICAgICAgIGFzeW5jIF9PbldlYkdMQ29udGV4dFJlc3RvcmVkKGUpIHsKICAgICAgICAgICAgYXdhaXQgdGhpcy5fd2ViZ2xSZW5kZXJlci5PbkNvbnRleHRSZXN0b3JlZCgpOwogICAgICAgICAgICBhd2FpdCB0aGlzLl9Jbml0UmVuZGVyZXIoKTsKICAgICAgICAgICAgYXdhaXQgdGhpcy5fcnVudGltZS5fT25SZW5kZXJlckNvbnRleHRSZXN0b3JlZCgpOwogICAgICAgICAgICBjb25zb2xlLmxvZygiW0NvbnN0cnVjdF0gV2ViR0wgY29udGV4dCByZXN0b3JlZCIpCiAgICAgICAgfQogICAgICAgIGFzeW5jIF9PbldlYkdQVURldmljZVJlc3RvcmVkKCkgewogICAgICAgICAgICBhd2FpdCB0aGlzLl9Jbml0UmVuZGVyZXIoKTsKICAgICAgICAgICAgYXdhaXQgdGhpcy5fcnVudGltZS5fT25SZW5kZXJlckNvbnRleHRSZXN0b3JlZCgpOwogICAgICAgICAgICBjb25zb2xlLmxvZygiW0NvbnN0cnVjdF0gV2ViR1BVIGRldmljZSByZXN0b3JlZCIpCiAgICAgICAgfQogICAgICAgIEdldFdlYkdMUmVuZGVyZXIoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl93ZWJnbFJlbmRlcmVyCiAgICAgICAgfQogICAgICAgIEdldFdlYkdQVVJlbmRlcmVyKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fd2ViZ3B1UmVuZGVyZXIKICAgICAgICB9CiAgICAgICAgR2V0UmVuZGVyZXIoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl93ZWJncHVSZW5kZXJlciB8fCB0aGlzLl93ZWJnbFJlbmRlcmVyCiAgICAgICAgfQogICAgICAgIEdldFJlbmRlclNjYWxlKCkgewogICAgICAgICAgICBpZiAodGhpcy5fZnVsbHNjcmVlblNjYWxpbmdRdWFsaXR5ID09PSAibG93IikgcmV0dXJuIDEgLwogICAgICAgICAgICAgICAgdGhpcy5fcnVudGltZS5HZXREZXZpY2VQaXhlbFJhdGlvKCk7CiAgICAgICAgICAgIHJldHVybiB0aGlzLkdldERpc3BsYXlTY2FsZSgpCiAgICAgICAgfQogICAgICAgIEdldERpc3BsYXlTY2FsZSgpIHsKICAgICAgICAgICAgY29uc3QgZnVsbHNjcmVlbk1vZGUgPSB0aGlzLkdldEN1cnJlbnRGdWxsc2NyZWVuTW9kZSgpOwogICAgICAgICAgICBpZiAoZnVsbHNjcmVlbk1vZGUgPT09ICJvZmYiIHx8IGZ1bGxzY3JlZW5Nb2RlID09PSAiY3JvcCIpIHJldHVybiAxOwogICAgICAgICAgICBjb25zdCBvcmlnaW5hbFZpZXdwb3J0V2lkdGggPSB0aGlzLl9ydW50aW1lLkdldE9yaWdpbmFsVmlld3BvcnRXaWR0aCgpOwogICAgICAgICAgICBjb25zdCBvcmlnaW5hbFZpZXdwb3J0SGVpZ2h0ID0gdGhpcy5fcnVudGltZS5HZXRPcmlnaW5hbFZpZXdwb3J0SGVpZ2h0KCk7CiAgICAgICAgICAgIGNvbnN0IG9yaWdpbmFsQXNwZWN0UmF0aW8gPSBvcmlnaW5hbFZpZXdwb3J0V2lkdGggLyBvcmlnaW5hbFZpZXdwb3J0SGVpZ2h0OwogICAgICAgICAgICBjb25zdCBjdXJyZW50QXNwZWN0UmF0aW8gPSB0aGlzLl9jYW52YXNEZXZpY2VXaWR0aCAvIHRoaXMuX2NhbnZhc0RldmljZUhlaWdodDsKICAgICAgICAgICAgaWYgKGZ1bGxzY3JlZW5Nb2RlICE9PQogICAgICAgICAgICAgICAgInNjYWxlLWlubmVyIiAmJiBjdXJyZW50QXNwZWN0UmF0aW8gPiBvcmlnaW5hbEFzcGVjdFJhdGlvIHx8IGZ1bGxzY3JlZW5Nb2RlID09PSAic2NhbGUtaW5uZXIiICYmIGN1cnJlbnRBc3BlY3RSYXRpbyA8IG9yaWdpbmFsQXNwZWN0UmF0aW8pIHJldHVybiB0aGlzLl9jYW52YXNDc3NIZWlnaHQgLyBvcmlnaW5hbFZpZXdwb3J0SGVpZ2h0OwogICAgICAgICAgICBlbHNlIHJldHVybiB0aGlzLl9jYW52YXNDc3NXaWR0aCAvIG9yaWdpbmFsVmlld3BvcnRXaWR0aAogICAgICAgIH0KICAgICAgICBHZXRFZmZlY3RMYXllclNjYWxlUGFyYW0oKSB7CiAgICAgICAgICAgIGlmICh0aGlzLkdldEN1cnJlbnRGdWxsc2NyZWVuU2NhbGluZ1F1YWxpdHkoKSA9PT0gImxvdyIpIHJldHVybiAxOwogICAgICAgICAgICBlbHNlIHJldHVybiB0aGlzLkdldERpc3BsYXlTY2FsZSgpCiAgICAgICAgfQogICAgICAgIEdldEVmZmVjdERldmljZVBpeGVsUmF0aW9QYXJhbSgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuR2V0Q3VycmVudEZ1bGxzY3JlZW5TY2FsaW5nUXVhbGl0eSgpID09PSAibG93IikgcmV0dXJuIDE7CiAgICAgICAgICAgIGVsc2UgcmV0dXJuIHRoaXMuX3J1bnRpbWUuR2V0RGV2aWNlUGl4ZWxSYXRpbygpCiAgICAgICAgfQogICAgICAgIFNldERldmljZVRyYW5zZm9ybU9mZnNldCh4LAogICAgICAgICAgICB5KSB7CiAgICAgICAgICAgIHRoaXMuX2RldmljZVRyYW5zZm9ybU9mZlggPSB4OwogICAgICAgICAgICB0aGlzLl9kZXZpY2VUcmFuc2Zvcm1PZmZZID0geQogICAgICAgIH0KICAgICAgICBTZXREZXZpY2VUcmFuc2Zvcm0ocmVuZGVyZXIsIHcsIGgsIHVwZGF0ZVByb2plY3Rpb24gPSB0cnVlKSB7CiAgICAgICAgICAgIHcgPSB3IHx8IHRoaXMuX2RyYXdXaWR0aDsKICAgICAgICAgICAgaCA9IGggfHwgdGhpcy5fZHJhd0hlaWdodDsKICAgICAgICAgICAgY29uc3Qgc2Nyb2xsWCA9IHcgLyAyICsgdGhpcy5fZGV2aWNlVHJhbnNmb3JtT2ZmWDsKICAgICAgICAgICAgY29uc3Qgc2Nyb2xsWSA9IGggLyAyICsgdGhpcy5fZGV2aWNlVHJhbnNmb3JtT2ZmWTsKICAgICAgICAgICAgaWYgKHVwZGF0ZVByb2plY3Rpb24pIHsKICAgICAgICAgICAgICAgIGxldCBwcm9qZWN0aW9uTWF0cml4ID0gdGhpcy5HZXREZWZhdWx0UHJvamVjdGlvbk1hdHJpeCgpOwogICAgICAgICAgICAgICAgaWYgKHcgIT09IHRoaXMuX2RyYXdXaWR0aCB8fCBoICE9PSB0aGlzLl9kcmF3SGVpZ2h0KSB7CiAgICAgICAgICAgICAgICAgICAgcmVuZGVyZXIuQ2FsY3VsYXRlUGVyc3BlY3RpdmVNYXRyaXgodGVtcFByb2plY3Rpb24sIHcgLyBoKTsKICAgICAgICAgICAgICAgICAgICBwcm9qZWN0aW9uTWF0cml4ID0gdGVtcFByb2plY3Rpb24KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJlbmRlcmVyLlNldFByb2plY3Rpb25NYXRyaXgocHJvamVjdGlvbk1hdHJpeCkKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCB0ZW1wTWF0NCA9CiAgICAgICAgICAgICAgICByZW5kZXJlci5DYWxjdWxhdGVMb29rQXRNb2RlbFZpZXcyKHNjcm9sbFgsIHNjcm9sbFksIHJlbmRlcmVyLkdldERlZmF1bHRDYW1lcmFaKGgpLCBzY3JvbGxYLCBzY3JvbGxZLCAwLCBoKTsKICAgICAgICAgICAgcmVuZGVyZXIuU2V0TW9kZWxWaWV3TWF0cml4KHRlbXBNYXQ0KQogICAgICAgIH0KICAgICAgICBTZXRDc3NUcmFuc2Zvcm0ocmVuZGVyZXIsIHVwZGF0ZVByb2plY3Rpb24gPSB0cnVlKSB7CiAgICAgICAgICAgIGNvbnN0IHdpZHRoID0gdGhpcy5HZXRDc3NXaWR0aCgpOwogICAgICAgICAgICBjb25zdCBoZWlnaHQgPSB0aGlzLkdldENzc0hlaWdodCgpOwogICAgICAgICAgICBjb25zdCBzY3JvbGxYID0gd2lkdGggLyAyOwogICAgICAgICAgICBjb25zdCBzY3JvbGxZID0gaGVpZ2h0IC8gMjsKICAgICAgICAgICAgaWYgKHVwZGF0ZVByb2plY3Rpb24pIHJlbmRlcmVyLlNldFByb2plY3Rpb25NYXRyaXgodGhpcy5HZXREZWZhdWx0UHJvamVjdGlvbk1hdHJpeCgpKTsKICAgICAgICAgICAgY29uc3QgdGVtcE1hdDQgPSByZW5kZXJlci5DYWxjdWxhdGVMb29rQXRNb2RlbFZpZXcyKHNjcm9sbFgsIHNjcm9sbFksIHJlbmRlcmVyLkdldERlZmF1bHRDYW1lcmFaKGhlaWdodCksIHNjcm9sbFgsIHNjcm9sbFksIDAsIGhlaWdodCk7CiAgICAgICAgICAgIHJlbmRlcmVyLlNldE1vZGVsVmlld01hdHJpeCh0ZW1wTWF0NCkKICAgICAgICB9CiAgICAgICAgR2V0RGV2aWNlV2lkdGgoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9jYW52YXNEZXZpY2VXaWR0aAogICAgICAgIH0KICAgICAgICBHZXREZXZpY2VIZWlnaHQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9jYW52YXNEZXZpY2VIZWlnaHQKICAgICAgICB9CiAgICAgICAgR2V0Q3NzV2lkdGgoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9jYW52YXNDc3NXaWR0aAogICAgICAgIH0KICAgICAgICBHZXRDc3NIZWlnaHQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9jYW52YXNDc3NIZWlnaHQKICAgICAgICB9CiAgICAgICAgR2V0Q2FudmFzQ2xpZW50WCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NhbnZhc0Nzc09mZnNldFgKICAgICAgICB9CiAgICAgICAgR2V0Q2FudmFzQ2xpZW50WSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NhbnZhc0Nzc09mZnNldFkKICAgICAgICB9CiAgICAgICAgR2V0QWRkaXRpb25hbFJlbmRlclRhcmdldChvcHRzKSB7CiAgICAgICAgICAgIG9wdHMuZGVwdGggPSB0aGlzLl9ydW50aW1lLlVzZXMzREZlYXR1cmVzKCk7CiAgICAgICAgICAgIGNvbnN0IGFyciA9IHRoaXMuX2F2YWlsYWJsZUFkZGl0aW9uYWxSZW5kZXJUYXJnZXRzOwogICAgICAgICAgICBjb25zdCB1c2VJbmRleCA9IGFyci5maW5kSW5kZXgocnQgPT4gcnQuSXNDb21wYXRpYmxlV2l0aE9wdGlvbnMob3B0cykpOwogICAgICAgICAgICBsZXQgcmV0OwogICAgICAgICAgICBpZiAodXNlSW5kZXggIT09IC0xKSB7CiAgICAgICAgICAgICAgICByZXQgPSBhcnJbdXNlSW5kZXhdOwogICAgICAgICAgICAgICAgYXJyLnNwbGljZSh1c2VJbmRleCwgMSkKICAgICAgICAgICAgfSBlbHNlIHJldCA9IHRoaXMuR2V0UmVuZGVyZXIoKS5DcmVhdGVSZW5kZXJUYXJnZXQob3B0cyk7CiAgICAgICAgICAgIHRoaXMuX3VzZWRBZGRpdGlvbmFsUmVuZGVyVGFyZ2V0cy5hZGQocmV0KTsKICAgICAgICAgICAgcmV0dXJuIHJldAogICAgICAgIH0KICAgICAgICBSZWxlYXNlQWRkaXRpb25hbFJlbmRlclRhcmdldChyZW5kZXJUYXJnZXQpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLl91c2VkQWRkaXRpb25hbFJlbmRlclRhcmdldHMuaGFzKHJlbmRlclRhcmdldCkpIHRocm93IG5ldyBFcnJvcigicmVuZGVyIHRhcmdldCBub3QgaW4gdXNlIik7CiAgICAgICAgICAgIHRoaXMuX3VzZWRBZGRpdGlvbmFsUmVuZGVyVGFyZ2V0cy5kZWxldGUocmVuZGVyVGFyZ2V0KTsKICAgICAgICAgICAgdGhpcy5fYXZhaWxhYmxlQWRkaXRpb25hbFJlbmRlclRhcmdldHMucHVzaChyZW5kZXJUYXJnZXQpCiAgICAgICAgfQogICAgICAgIEdldEVmZmVjdENvbXBvc2l0b3JSZW5kZXJUYXJnZXQoKSB7CiAgICAgICAgICAgIGNvbnN0IG9wdHMgPSB7CiAgICAgICAgICAgICAgICBzYW1wbGluZzogdGhpcy5fcnVudGltZS5HZXRTYW1wbGluZygpCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGlmICh0aGlzLkdldEN1cnJlbnRGdWxsc2NyZWVuU2NhbGluZ1F1YWxpdHkoKSA9PT0gImxvdyIpIHsKICAgICAgICAgICAgICAgIG9wdHMud2lkdGggPSB0aGlzLkdldERyYXdXaWR0aCgpOwogICAgICAgICAgICAgICAgb3B0cy5oZWlnaHQgPSB0aGlzLkdldERyYXdIZWlnaHQoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0aGlzLkdldEFkZGl0aW9uYWxSZW5kZXJUYXJnZXQob3B0cykKICAgICAgICB9CiAgICAgICAgUmVsZWFzZUVmZmVjdENvbXBvc2l0b3JSZW5kZXJUYXJnZXQocmVuZGVyVGFyZ2V0KSB7CiAgICAgICAgICAgIHRoaXMuUmVsZWFzZUFkZGl0aW9uYWxSZW5kZXJUYXJnZXQocmVuZGVyVGFyZ2V0KQogICAgICAgIH0qIGFjdGl2ZUxheWVyc0dwdVByb2ZpbGVzKCkgewogICAgICAgICAgICBmb3IgKGNvbnN0IGxheW91dCBvZiB0aGlzLl9ydW50aW1lLkdldExheW91dE1hbmFnZXIoKS5ydW5uaW5nTGF5b3V0cygpKQogICAgICAgICAgICAgICAgZm9yIChjb25zdCBsYXllciBvZiBsYXlvdXQuR2V0TGF5ZXJzKCkpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBwID0gdGhpcy5fbGF5ZXJzR3B1UHJvZmlsZS5nZXQobGF5ZXIpOwogICAgICAgICAgICAgICAgICAgIGlmIChwKSB5aWVsZCBwCiAgICAgICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIEdldExheWVyVGltaW5nc0J1ZmZlcihsYXllcikgewogICAgICAgICAgICBpZiAoIXRoaXMuR2V0UmVuZGVyZXIoKS5TdXBwb3J0c0dQVVByb2ZpbGluZygpKSByZXR1cm4gbnVsbDsKICAgICAgICAgICAgbGV0IHAgPSB0aGlzLl9sYXllcnNHcHVQcm9maWxlLmdldChsYXllcik7CiAgICAgICAgICAgIGlmICghcCkgewogICAgICAgICAgICAgICAgcCA9IHsKICAgICAgICAgICAgICAgICAgICBuYW1lOiBsYXllci5HZXROYW1lKCksCiAgICAgICAgICAgICAgICAgICAgdGltaW5nc0J1ZmZlcjogQzMuTmV3KEMzLkdmeC5XZWJHTFF1ZXJ5UmVzdWx0QnVmZmVyLCB0aGlzLl93ZWJnbFJlbmRlcmVyKSwKICAgICAgICAgICAgICAgICAgICBjdXJVdGlsaXNhdGlvbjogMCwKICAgICAgICAgICAgICAgICAgICBsYXN0VXRpbGlzYXRpb246IDAKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB0aGlzLl9sYXllcnNHcHVQcm9maWxlLnNldChsYXllciwgcCkKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcC50aW1pbmdzQnVmZmVyCiAgICAgICAgfQogICAgICAgIF9VcGRhdGUxc0ZyYW1lUmFuZ2UoKSB7CiAgICAgICAgICAgIGNvbnN0IHJlbmRlcmVyID0gdGhpcy5HZXRSZW5kZXJlcigpOwogICAgICAgICAgICBpZiAoIXJlbmRlcmVyLlN1cHBvcnRzR1BVUHJvZmlsaW5nKCkpIHJldHVybjsKICAgICAgICAgICAgaWYgKHRoaXMuX2dwdVRpbWVFbmRGcmFtZSA9PT0gMCkgewogICAgICAgICAgICAgICAgdGhpcy5fZ3B1VGltZUVuZEZyYW1lID0gcmVuZGVyZXIuR2V0RnJhbWVOdW1iZXIoKTsKICAgICAgICAgICAgICAgIHRoaXMuX2dwdUN1clV0aWxpc2F0aW9uID0gTmFOOwogICAgICAgICAgICAgICAgZm9yIChjb25zdCBwIG9mIHRoaXMuYWN0aXZlTGF5ZXJzR3B1UHJvZmlsZXMoKSkgcC5jdXJVdGlsaXNhdGlvbiA9CiAgICAgICAgICAgICAgICAgICAgTmFOCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgX1VwZGF0ZVRpY2soKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl93ZWJnbFJlbmRlcmVyICYmIHRoaXMuX3dlYmdsUmVuZGVyZXIuU3VwcG9ydHNHUFVQcm9maWxpbmcoKSkgdGhpcy5fVXBkYXRlVGlja19XZWJHTCgpOwogICAgICAgICAgICBpZiAodGhpcy5fd2ViZ3B1UmVuZGVyZXIgJiYgdGhpcy5fd2ViZ3B1UmVuZGVyZXIuU3VwcG9ydHNHUFVQcm9maWxpbmcoKSkgdGhpcy5fVXBkYXRlVGlja19XZWJHUFUoKQogICAgICAgIH0KICAgICAgICBfVXBkYXRlVGlja19XZWJHTCgpIHsKICAgICAgICAgICAgaWYgKCFpc05hTih0aGlzLl9ncHVDdXJVdGlsaXNhdGlvbikpIHJldHVybjsKICAgICAgICAgICAgdGhpcy5fZ3B1Q3VyVXRpbGlzYXRpb24gPSB0aGlzLl9ncHVGcmFtZVRpbWluZ3NCdWZmZXIuR2V0RnJhbWVSYW5nZVJlc3VsdFN1bSh0aGlzLl9ncHVUaW1lU3RhcnRGcmFtZSwgdGhpcy5fZ3B1VGltZUVuZEZyYW1lKTsKICAgICAgICAgICAgaWYgKGlzTmFOKHRoaXMuX2dwdUN1clV0aWxpc2F0aW9uKSkgcmV0dXJuOwogICAgICAgICAgICBpZiAodGhpcy5fcnVudGltZS5Jc0RlYnVnKCkpCiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHAgb2YgdGhpcy5hY3RpdmVMYXllcnNHcHVQcm9maWxlcygpKSB7CiAgICAgICAgICAgICAgICAgICAgcC5jdXJVdGlsaXNhdGlvbiA9CiAgICAgICAgICAgICAgICAgICAgICAgIHAudGltaW5nc0J1ZmZlci5HZXRGcmFtZVJhbmdlUmVzdWx0U3VtKHRoaXMuX2dwdVRpbWVTdGFydEZyYW1lLCB0aGlzLl9ncHVUaW1lRW5kRnJhbWUpOwogICAgICAgICAgICAgICAgICAgIGlmIChpc05hTihwLmN1clV0aWxpc2F0aW9uKSkgcmV0dXJuCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuX2dwdUZyYW1lVGltaW5nc0J1ZmZlci5EZWxldGVBbGxCZWZvcmVGcmFtZU51bWJlcih0aGlzLl9ncHVUaW1lRW5kRnJhbWUpOwogICAgICAgICAgICB0aGlzLl9ncHVMYXN0VXRpbGlzYXRpb24gPSBNYXRoLm1pbih0aGlzLl9ncHVDdXJVdGlsaXNhdGlvbiwgMSk7CiAgICAgICAgICAgIGlmICh0aGlzLl9ydW50aW1lLklzRGVidWcoKSkgewogICAgICAgICAgICAgICAgZm9yIChjb25zdCBwIG9mIHRoaXMuYWN0aXZlTGF5ZXJzR3B1UHJvZmlsZXMoKSkgewogICAgICAgICAgICAgICAgICAgIHAudGltaW5nc0J1ZmZlci5EZWxldGVBbGxCZWZvcmVGcmFtZU51bWJlcih0aGlzLl9ncHVUaW1lRW5kRnJhbWUpOwogICAgICAgICAgICAgICAgICAgIHAubGFzdFV0aWxpc2F0aW9uID0gTWF0aC5taW4ocC5jdXJVdGlsaXNhdGlvbiwgMSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHNlbGYuQzNEZWJ1Z2dlci5VcGRhdGVHUFVQcm9maWxlKHRoaXMuX2dwdUxhc3RVdGlsaXNhdGlvbiwgWy4uLnRoaXMuYWN0aXZlTGF5ZXJzR3B1UHJvZmlsZXMoKV0pCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5fZ3B1VGltZVN0YXJ0RnJhbWUgPSB0aGlzLl9ncHVUaW1lRW5kRnJhbWU7CiAgICAgICAgICAgIHRoaXMuX2dwdVRpbWVFbmRGcmFtZSA9IDAKICAgICAgICB9CiAgICAgICAgR2V0R1BVRnJhbWVUaW1pbmdzQnVmZmVyKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZ3B1RnJhbWVUaW1pbmdzQnVmZmVyCiAgICAgICAgfQogICAgICAgIF9VcGRhdGVUaWNrX1dlYkdQVSgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX2dwdVRpbWVFbmRGcmFtZSA9PT0gMCkgcmV0dXJuOwogICAgICAgICAgICBmb3IgKGxldCBmcmFtZU51bWJlciA9IHRoaXMuX2dwdVRpbWVTdGFydEZyYW1lOyBmcmFtZU51bWJlciA8IHRoaXMuX2dwdVRpbWVFbmRGcmFtZTsgKytmcmFtZU51bWJlcikgewogICAgICAgICAgICAgICAgY29uc3QgZnJhbWVUaW1pbmcgPSB0aGlzLl93ZWJncHVGcmFtZVRpbWluZ3MuZ2V0KGZyYW1lTnVtYmVyKTsKICAgICAgICAgICAgICAgIGlmIChmcmFtZVRpbWluZyAmJiAhZnJhbWVUaW1pbmcuSGFzUmVzdWx0KCkpIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IGxheW91dCA9IHRoaXMuX3J1bnRpbWUuR2V0TWFpblJ1bm5pbmdMYXlvdXQoKTsKICAgICAgICAgICAgY29uc3QgcHJvZmlsZVJlc3VsdHMgPSBDMy5NYWtlRmlsbGVkQXJyYXkobGF5b3V0LkdldExheWVyQ291bnQoKSArCiAgICAgICAgICAgICAgICAxLCAwKTsKICAgICAgICAgICAgZm9yIChsZXQgZnJhbWVOdW1iZXIgPSB0aGlzLl9ncHVUaW1lU3RhcnRGcmFtZTsgZnJhbWVOdW1iZXIgPCB0aGlzLl9ncHVUaW1lRW5kRnJhbWU7ICsrZnJhbWVOdW1iZXIpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGZyYW1lVGltaW5nID0gdGhpcy5fd2ViZ3B1RnJhbWVUaW1pbmdzLmdldChmcmFtZU51bWJlcik7CiAgICAgICAgICAgICAgICBpZiAoIWZyYW1lVGltaW5nKSBjb250aW51ZTsKICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdHMgPSBmcmFtZVRpbWluZy5HZXRSZXN1bHQoKTsKICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBNYXRoLm1pbihwcm9maWxlUmVzdWx0cy5sZW5ndGgsIHJlc3VsdHMubGVuZ3RoIC8gMik7IGkgPCBsZW47ICsraSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0NjQgPSByZXN1bHRzW2kgKiAyXTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBlbmQ2NCA9IHJlc3VsdHNbaSAqIDIgKyAxXTsKICAgICAgICAgICAgICAgICAgICBpZiAoTnVtYmVyKHN0YXJ0NjQpID09PSAwIHx8IE51bWJlcihlbmQ2NCkgPT09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgcHJvZmlsZVJlc3VsdHNbaV0gPSBOYU47CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGRpZmY2NCA9IGVuZDY0IC0gc3RhcnQ2NDsKICAgICAgICAgICAgICAgICAgICBjb25zdCBkdXJhdGlvbiA9IE51bWJlcihkaWZmNjQpIC8gMUU5OwogICAgICAgICAgICAgICAgICAgIHByb2ZpbGVSZXN1bHRzW2ldICs9CiAgICAgICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5fZ3B1TGFzdFV0aWxpc2F0aW9uID0gQzMuY2xhbXAocHJvZmlsZVJlc3VsdHNbMF0sIDAsIDEpOwogICAgICAgICAgICBpZiAodGhpcy5fcnVudGltZS5Jc0RlYnVnKCkpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGxheWVyUHJvZmlsZXMgPSBbXTsKICAgICAgICAgICAgICAgIGNvbnN0IGxheWVycyA9IGxheW91dC5HZXRMYXllcnMoKTsKICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBNYXRoLm1pbihsYXllcnMubGVuZ3RoLCBwcm9maWxlUmVzdWx0cy5sZW5ndGggLSAxKTsgaSA8IGxlbjsgKytpKSBsYXllclByb2ZpbGVzLnB1c2goewogICAgICAgICAgICAgICAgICAgIG5hbWU6IGxheWVyc1tpXS5HZXROYW1lKCksCiAgICAgICAgICAgICAgICAgICAgbGFzdFV0aWxpc2F0aW9uOiBDMy5jbGFtcChwcm9maWxlUmVzdWx0c1tpICsgMV0sIDAsIDEpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHNlbGYuQzNEZWJ1Z2dlci5VcGRhdGVHUFVQcm9maWxlKHRoaXMuX2dwdUxhc3RVdGlsaXNhdGlvbiwgbGF5ZXJQcm9maWxlcykKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IgKGxldCBmcmFtZU51bWJlciA9IHRoaXMuX2dwdVRpbWVTdGFydEZyYW1lOyBmcmFtZU51bWJlciA8IHRoaXMuX2dwdVRpbWVFbmRGcmFtZTsgKytmcmFtZU51bWJlcikgdGhpcy5fd2ViZ3B1RnJhbWVUaW1pbmdzLmRlbGV0ZShmcmFtZU51bWJlcik7CiAgICAgICAgICAgIHRoaXMuX2dwdVRpbWVTdGFydEZyYW1lID0gdGhpcy5fZ3B1VGltZUVuZEZyYW1lOwogICAgICAgICAgICB0aGlzLl9ncHVUaW1lRW5kRnJhbWUgPSAwCiAgICAgICAgfQogICAgICAgIF9BZGRXZWJHUFVGcmFtZVRpbWluZyhmcmFtZVRpbWluZykgewogICAgICAgICAgICB0aGlzLl93ZWJncHVGcmFtZVRpbWluZ3Muc2V0KHRoaXMuX3dlYmdwdVJlbmRlcmVyLkdldEZyYW1lTnVtYmVyKCksIGZyYW1lVGltaW5nKQogICAgICAgIH0KICAgICAgICBHZXRHUFVVdGlsaXNhdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2dwdUxhc3RVdGlsaXNhdGlvbgogICAgICAgIH0KICAgICAgICBTbmFwc2hvdENhbnZhcyhmb3JtYXQsIHF1YWxpdHksIHgsIHksIHdpZHRoLCBoZWlnaHQpIHsKICAgICAgICAgICAgdGhpcy5fc25hcHNob3RGb3JtYXQgPSBmb3JtYXQ7CiAgICAgICAgICAgIHRoaXMuX3NuYXBzaG90UXVhbGl0eSA9IHF1YWxpdHk7CiAgICAgICAgICAgIHRoaXMuX3NuYXBzaG90QXJlYS5zZXRXSCh4LCB5LCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgICAgICAgaWYgKHRoaXMuX3NuYXBzaG90UHJvbWlzZSkgcmV0dXJuIHRoaXMuX3NuYXBzaG90UHJvbWlzZTsKICAgICAgICAgICAgdGhpcy5fc25hcHNob3RQcm9taXNlID0gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLl9zbmFwc2hvdFJlc29sdmUgPQogICAgICAgICAgICAgICAgICAgIHJlc29sdmUKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zbmFwc2hvdFByb21pc2UKICAgICAgICB9CiAgICAgICAgX01heWJlVGFrZVNuYXBzaG90KCkgewogICAgICAgICAgICBpZiAoIXRoaXMuX3NuYXBzaG90Rm9ybWF0KSByZXR1cm47CiAgICAgICAgICAgIGxldCBjYW52YXMgPSB0aGlzLl9jYW52YXM7CiAgICAgICAgICAgIGNvbnN0IHNuYXBBcmVhID0gdGhpcy5fc25hcHNob3RBcmVhOwogICAgICAgICAgICBjb25zdCB4ID0gQzMuY2xhbXAoTWF0aC5mbG9vcihzbmFwQXJlYS5nZXRMZWZ0KCkpLCAwLCBjYW52YXMud2lkdGgpOwogICAgICAgICAgICBjb25zdCB5ID0gQzMuY2xhbXAoTWF0aC5mbG9vcihzbmFwQXJlYS5nZXRUb3AoKSksIDAsIGNhbnZhcy5oZWlnaHQpOwogICAgICAgICAgICBsZXQgdyA9IHNuYXBBcmVhLndpZHRoKCk7CiAgICAgICAgICAgIGlmICh3ID09PSAwKSB3ID0gY2FudmFzLndpZHRoIC0geDsKICAgICAgICAgICAgZWxzZSB3ID0gQzMuY2xhbXAoTWF0aC5mbG9vcih3KSwgMCwgY2FudmFzLndpZHRoIC0geCk7CiAgICAgICAgICAgIGxldCBoID0gc25hcEFyZWEuaGVpZ2h0KCk7CiAgICAgICAgICAgIGlmIChoID09PSAwKSBoID0gY2FudmFzLmhlaWdodCAtIHk7CiAgICAgICAgICAgIGVsc2UgaCA9IEMzLmNsYW1wKE1hdGguZmxvb3IoaCksIDAsIGNhbnZhcy5oZWlnaHQgLSB5KTsKICAgICAgICAgICAgaWYgKCh4ICE9PSAwIHx8IHkgIT09IDAgfHwgdyAhPT0gY2FudmFzLndpZHRoIHx8CiAgICAgICAgICAgICAgICAgICAgaCAhPT0gY2FudmFzLmhlaWdodCkgJiYgKHcgPiAwICYmIGggPiAwKSkgewogICAgICAgICAgICAgICAgY2FudmFzID0gQzMuQ3JlYXRlQ2FudmFzKHcsIGgpOwogICAgICAgICAgICAgICAgY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoIjJkIik7CiAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKHRoaXMuX2NhbnZhcywgeCwgeSwgdywgaCwgMCwgMCwgdywgaCkKICAgICAgICAgICAgfQogICAgICAgICAgICBDMy5DYW52YXNUb0Jsb2IoY2FudmFzLCB0aGlzLl9zbmFwc2hvdEZvcm1hdCwgdGhpcy5fc25hcHNob3RRdWFsaXR5KS50aGVuKGJsb2IgPT4gewogICAgICAgICAgICAgICAgaWYgKHRoaXMuX3NuYXBzaG90VXJsKSBVUkwucmV2b2tlT2JqZWN0VVJMKHRoaXMuX3NuYXBzaG90VXJsKTsKICAgICAgICAgICAgICAgIHRoaXMuX3NuYXBzaG90VXJsID0gVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTsKICAgICAgICAgICAgICAgIHRoaXMuX3NuYXBzaG90UHJvbWlzZSA9IG51bGw7CiAgICAgICAgICAgICAgICB0aGlzLl9zbmFwc2hvdFJlc29sdmUodGhpcy5fc25hcHNob3RVcmwpCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0aGlzLl9zbmFwc2hvdEZvcm1hdCA9ICIiOwogICAgICAgICAgICB0aGlzLl9zbmFwc2hvdFF1YWxpdHkgPSAxCiAgICAgICAgfQogICAgICAgIEdldENhbnZhc1NuYXBzaG90VXJsKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fc25hcHNob3RVcmwKICAgICAgICB9CiAgICAgICAgU2V0SXNQYXN0aW5nVG9EcmF3aW5nQ2FudmFzKHApIHsKICAgICAgICAgICAgaWYgKHApIHRoaXMuX2lzUGFzdGluZ1RvRHJhd2luZ0NhbnZhcysrOwogICAgICAgICAgICBlbHNlIHRoaXMuX2lzUGFzdGluZ1RvRHJhd2luZ0NhbnZhcy0tCiAgICAgICAgfQogICAgICAgIElzUGFzdGluZ1RvRHJhd2luZ0NhbnZhcygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2lzUGFzdGluZ1RvRHJhd2luZ0NhbnZhcyA+IDAKICAgICAgICB9CiAgICAgICAgSW5pdExvYWRpbmdTY3JlZW4obG9hZGVyU3R5bGUpIHsKICAgICAgICAgICAgY29uc3QgcmVuZGVyZXIgPSB0aGlzLkdldFJlbmRlcmVyKCk7CiAgICAgICAgICAgIGlmIChsb2FkZXJTdHlsZSA9PT0gMikgewogICAgICAgICAgICAgICAgdGhpcy5fcGVyY2VudFRleHQgPSBDMy5OZXcoQzMuR2Z4LlJlbmRlcmVyVGV4dCwgdGhpcy5HZXRSZW5kZXJlcigpKTsKICAgICAgICAgICAgICAgIHRoaXMuX3BlcmNlbnRUZXh0LlNldEZvbnROYW1lKCJBcmlhbCIpOwogICAgICAgICAgICAgICAgdGhpcy5fcGVyY2VudFRleHQuU2V0Rm9udFNpemUoMTYpOwogICAgICAgICAgICAgICAgdGhpcy5fcGVyY2VudFRleHQuU2V0SG9yaXpvbnRhbEFsaWdubWVudCgiY2VudGVyIik7CiAgICAgICAgICAgICAgICB0aGlzLl9wZXJjZW50VGV4dC5TZXRWZXJ0aWNhbEFsaWdubWVudCgiY2VudGVyIik7CiAgICAgICAgICAgICAgICB0aGlzLl9wZXJjZW50VGV4dC5TZXRTaXplKFBFUkNFTlRURVhUX1dJRFRILCBQRVJDRU5UVEVYVF9IRUlHSFQpCiAgICAgICAgICAgIH0gZWxzZSBpZiAobG9hZGVyU3R5bGUgPT09CiAgICAgICAgICAgICAgICAwKSB7CiAgICAgICAgICAgICAgICBjb25zdCBsb2FkaW5nTG9nb0Fzc2V0ID0gdGhpcy5fcnVudGltZS5HZXRMb2FkaW5nTG9nb0Fzc2V0KCk7CiAgICAgICAgICAgICAgICBpZiAobG9hZGluZ0xvZ29Bc3NldCkgbG9hZGluZ0xvZ29Bc3NldC5Mb2FkU3RhdGljVGV4dHVyZShyZW5kZXJlcikuY2F0Y2goZXJyID0+IGNvbnNvbGUud2FybihgW0MzIHJ1bnRpbWVdIEZhaWxlZCB0byBjcmVhdGUgdGV4dHVyZSBmb3IgbG9hZGluZyBsb2dvOiBgLCBlcnIpKQogICAgICAgICAgICB9IGVsc2UgaWYgKGxvYWRlclN0eWxlID09PSA0KSB7CiAgICAgICAgICAgICAgICB0aGlzLl9Mb2FkU3ZnU3BsYXNoSW1hZ2UoInNwbGFzaC1pbWFnZXMvc3BsYXNoLWxvZ28uc3ZnIikudGhlbih0ZXggPT4gewogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9zcGxhc2hTdGF0ZSA9PT0gImRvbmUiKSByZW5kZXJlci5EZWxldGVUZXh0dXJlKHRleCk7CiAgICAgICAgICAgICAgICAgICAgZWxzZSB0aGlzLl9zcGxhc2hUZXh0dXJlcy5sb2dvID0gdGV4CiAgICAgICAgICAgICAgICB9KS5jYXRjaChlcnIgPT4gY29uc29sZS53YXJuKCJGYWlsZWQgdG8gbG9hZCBzcGxhc2ggaW1hZ2U6ICIsIGVycikpOwogICAgICAgICAgICAgICAgdGhpcy5fTG9hZEJpdG1hcFNwbGFzaEltYWdlKCJzcGxhc2gtaW1hZ2VzL3NwbGFzaC1wb3dlcmVkYnktNTEyLnBuZyIpLnRoZW4odGV4ID0+IHsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fc3BsYXNoU3RhdGUgPT09ICJkb25lIikgcmVuZGVyZXIuRGVsZXRlVGV4dHVyZSh0ZXgpOwogICAgICAgICAgICAgICAgICAgIGVsc2UgdGhpcy5fc3BsYXNoVGV4dHVyZXMucG93ZXJlZCA9IHRleAogICAgICAgICAgICAgICAgfSkuY2F0Y2goZXJyID0+IGNvbnNvbGUud2FybigiRmFpbGVkIHRvIGxvYWQgc3BsYXNoIGltYWdlOiAiLCBlcnIpKTsKICAgICAgICAgICAgICAgIHRoaXMuX0xvYWRCaXRtYXBTcGxhc2hJbWFnZSgic3BsYXNoLWltYWdlcy9zcGxhc2gtd2Vic2l0ZS01MTIucG5nIikudGhlbih0ZXggPT4gewogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9zcGxhc2hTdGF0ZSA9PT0gImRvbmUiKSByZW5kZXJlci5EZWxldGVUZXh0dXJlKHRleCk7CiAgICAgICAgICAgICAgICAgICAgZWxzZSB0aGlzLl9zcGxhc2hUZXh0dXJlcy53ZWJzaXRlID0gdGV4CiAgICAgICAgICAgICAgICB9KS5jYXRjaChlcnIgPT4gY29uc29sZS53YXJuKCJGYWlsZWQgdG8gbG9hZCBzcGxhc2ggaW1hZ2U6ICIsIGVycikpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgYXN5bmMgX0xvYWRTdmdTcGxhc2hJbWFnZSh1cmwpIHsKICAgICAgICAgICAgdXJsID0gKG5ldyBVUkwodXJsLCB0aGlzLl9ydW50aW1lLkdldFJ1bnRpbWVCYXNlVVJMKCkpKS50b1N0cmluZygpOwogICAgICAgICAgICBjb25zdCBibG9iID0KICAgICAgICAgICAgICAgIGF3YWl0IEMzLkZldGNoQmxvYih1cmwpOwogICAgICAgICAgICBjb25zdCBkcmF3YWJsZSA9IGF3YWl0IHRoaXMuX3J1bnRpbWUuUmFzdGVyU3ZnSW1hZ2UoYmxvYiwgMjA0OCwgMjA0OCk7CiAgICAgICAgICAgIHJldHVybiBhd2FpdCB0aGlzLkdldFJlbmRlcmVyKCkuQ3JlYXRlU3RhdGljVGV4dHVyZUFzeW5jKGRyYXdhYmxlLCB7CiAgICAgICAgICAgICAgICBtaXBNYXBRdWFsaXR5OiAiaGlnaCIKICAgICAgICAgICAgfSkKICAgICAgICB9CiAgICAgICAgYXN5bmMgX0xvYWRCaXRtYXBTcGxhc2hJbWFnZSh1cmwpIHsKICAgICAgICAgICAgdXJsID0gKG5ldyBVUkwodXJsLCB0aGlzLl9ydW50aW1lLkdldFJ1bnRpbWVCYXNlVVJMKCkpKS50b1N0cmluZygpOwogICAgICAgICAgICBjb25zdCBibG9iID0gYXdhaXQgQzMuRmV0Y2hCbG9iKHVybCk7CiAgICAgICAgICAgIHJldHVybiBhd2FpdCB0aGlzLkdldFJlbmRlcmVyKCkuQ3JlYXRlU3RhdGljVGV4dHVyZUFzeW5jKGJsb2IsIHsKICAgICAgICAgICAgICAgIG1pcE1hcFF1YWxpdHk6ICJoaWdoIgogICAgICAgICAgICB9KQogICAgICAgIH0KICAgICAgICBIaWRlQ29yZG92YVNwbGFzaFNjcmVlbigpIHsKICAgICAgICAgICAgdGhpcy5fcnVudGltZS5Qb3N0Q29tcG9uZW50TWVzc2FnZVRvRE9NKCJydW50aW1lIiwgImhpZGUtY29yZG92YS1zcGxhc2giKQogICAgICAgIH0KICAgICAgICBTdGFydExvYWRpbmdTY3JlZW4oKSB7CiAgICAgICAgICAgIHRoaXMuX2xvYWRlclN0YXJ0VGltZSA9CiAgICAgICAgICAgICAgICBEYXRlLm5vdygpOwogICAgICAgICAgICB0aGlzLl9ydW50aW1lLkRpc3BhdGNoZXIoKS5hZGRFdmVudExpc3RlbmVyKCJsb2FkaW5ncHJvZ3Jlc3MiLCB0aGlzLl9sb2FkaW5ncHJvZ3Jlc3NfaGFuZGxlcik7CiAgICAgICAgICAgIHRoaXMuX3JhZklkID0gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHRoaXMuX0RyYXdMb2FkaW5nU2NyZWVuKCkpOwogICAgICAgICAgICBjb25zdCBsb2FkZXJTdHlsZSA9IHRoaXMuX3J1bnRpbWUuR2V0TG9hZGVyU3R5bGUoKTsKICAgICAgICAgICAgaWYgKGxvYWRlclN0eWxlICE9PSAzKSB0aGlzLkhpZGVDb3Jkb3ZhU3BsYXNoU2NyZWVuKCkKICAgICAgICB9CiAgICAgICAgYXN5bmMgRW5kTG9hZGluZ1NjcmVlbigpIHsKICAgICAgICAgICAgY29uc3QgcmVuZGVyZXIgPSB0aGlzLkdldFJlbmRlcmVyKCk7CiAgICAgICAgICAgIHRoaXMuX2xvYWRpbmdQcm9ncmVzcyA9IDE7CiAgICAgICAgICAgIGNvbnN0IGxvYWRlclN0eWxlID0gdGhpcy5fcnVudGltZS5HZXRMb2FkZXJTdHlsZSgpOwogICAgICAgICAgICBpZiAobG9hZGVyU3R5bGUgPT09IDQpIGF3YWl0IHRoaXMuX3NwbGFzaERvbmVQcm9taXNlOwogICAgICAgICAgICB0aGlzLl9zcGxhc2hEb25lUmVzb2x2ZSA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3NwbGFzaERvbmVQcm9taXNlID0KICAgICAgICAgICAgICAgIG51bGw7CiAgICAgICAgICAgIGlmICh0aGlzLl9yYWZJZCAhPT0gLTEpIHsKICAgICAgICAgICAgICAgIGNhbmNlbEFuaW1hdGlvbkZyYW1lKHRoaXMuX3JhZklkKTsKICAgICAgICAgICAgICAgIHRoaXMuX3JhZklkID0gLTEKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLl9ydW50aW1lLkRpc3BhdGNoZXIoKS5yZW1vdmVFdmVudExpc3RlbmVyKCJsb2FkaW5ncHJvZ3Jlc3MiLCB0aGlzLl9sb2FkaW5ncHJvZ3Jlc3NfaGFuZGxlcik7CiAgICAgICAgICAgIHRoaXMuX2xvYWRpbmdwcm9ncmVzc19oYW5kbGVyID0gbnVsbDsKICAgICAgICAgICAgaWYgKHRoaXMuX3BlcmNlbnRUZXh0KSB7CiAgICAgICAgICAgICAgICB0aGlzLl9wZXJjZW50VGV4dC5SZWxlYXNlKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9wZXJjZW50VGV4dCA9IG51bGwKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLl9ydW50aW1lLlJlbGVhc2VMb2FkaW5nTG9nb0Fzc2V0KCk7CiAgICAgICAgICAgIHJlbmRlcmVyLlN0YXJ0KCk7CiAgICAgICAgICAgIGlmICh0aGlzLl9zcGxhc2hUZXh0dXJlcy5sb2dvKSB7CiAgICAgICAgICAgICAgICByZW5kZXJlci5EZWxldGVUZXh0dXJlKHRoaXMuX3NwbGFzaFRleHR1cmVzLmxvZ28pOwogICAgICAgICAgICAgICAgdGhpcy5fc3BsYXNoVGV4dHVyZXMubG9nbyA9IG51bGwKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGhpcy5fc3BsYXNoVGV4dHVyZXMucG93ZXJlZCkgewogICAgICAgICAgICAgICAgcmVuZGVyZXIuRGVsZXRlVGV4dHVyZSh0aGlzLl9zcGxhc2hUZXh0dXJlcy5wb3dlcmVkKTsKICAgICAgICAgICAgICAgIHRoaXMuX3NwbGFzaFRleHR1cmVzLnBvd2VyZWQgPSBudWxsCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHRoaXMuX3NwbGFzaFRleHR1cmVzLndlYnNpdGUpIHsKICAgICAgICAgICAgICAgIHJlbmRlcmVyLkRlbGV0ZVRleHR1cmUodGhpcy5fc3BsYXNoVGV4dHVyZXMud2Vic2l0ZSk7CiAgICAgICAgICAgICAgICB0aGlzLl9zcGxhc2hUZXh0dXJlcy53ZWJzaXRlID0gbnVsbAogICAgICAgICAgICB9CiAgICAgICAgICAgIHJlbmRlcmVyLkNsZWFyUmdiYSgwLCAwLCAwLCAwKTsKICAgICAgICAgICAgcmVuZGVyZXIuRmluaXNoKCk7CiAgICAgICAgICAgIHRoaXMuX3NwbGFzaFN0YXRlID0gImRvbmUiOwogICAgICAgICAgICB0aGlzLl9ncHVUaW1lU3RhcnRGcmFtZSA9IHJlbmRlcmVyLkdldEZyYW1lTnVtYmVyKCk7CiAgICAgICAgICAgIGlmIChsb2FkZXJTdHlsZSA9PT0gMykgdGhpcy5IaWRlQ29yZG92YVNwbGFzaFNjcmVlbigpCiAgICAgICAgfQogICAgICAgIF9EcmF3TG9hZGluZ1NjcmVlbigpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX3JhZklkID09PSAtMSkgcmV0dXJuOwogICAgICAgICAgICBjb25zdCByZW5kZXJlciA9IHRoaXMuR2V0UmVuZGVyZXIoKTsKICAgICAgICAgICAgcmVuZGVyZXIuU3RhcnQoKTsKICAgICAgICAgICAgdGhpcy5fcmFmSWQgPSAtMTsKICAgICAgICAgICAgY29uc3QgaGFzSGFkRXJyb3IgPSB0aGlzLl9ydW50aW1lLkdldEFzc2V0TWFuYWdlcigpLkhhc0hhZEVycm9yTG9hZGluZygpOwogICAgICAgICAgICBjb25zdCBsb2FkZXJTdHlsZSA9IHRoaXMuX3J1bnRpbWUuR2V0TG9hZGVyU3R5bGUoKTsKICAgICAgICAgICAgaWYgKGxvYWRlclN0eWxlICE9PSAzKSB7CiAgICAgICAgICAgICAgICB0aGlzLlNldENzc1RyYW5zZm9ybShyZW5kZXJlcik7CiAgICAgICAgICAgICAgICByZW5kZXJlci5DbGVhclJnYmEoMCwgMCwgMCwgMCk7CiAgICAgICAgICAgICAgICByZW5kZXJlci5SZXNldENvbG9yKCk7CiAgICAgICAgICAgICAgICByZW5kZXJlci5TZXRUZXh0dXJlRmlsbE1vZGUoKTsKICAgICAgICAgICAgICAgIHJlbmRlcmVyLlNldFRleHR1cmUobnVsbCkKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAobG9hZGVyU3R5bGUgPT09IDApIHRoaXMuX0RyYXdQcm9ncmVzc0JhckFuZExvZ29Mb2FkaW5nU2NyZWVuKGhhc0hhZEVycm9yKTsKICAgICAgICAgICAgZWxzZSBpZiAobG9hZGVyU3R5bGUgPT09IDEpIHRoaXMuX0RyYXdQcm9ncmVzc0JhckxvYWRpbmdTY3JlZW4oaGFzSGFkRXJyb3IsIFBST0dSRVNTQkFSX1dJRFRILCAwKTsKICAgICAgICAgICAgZWxzZSBpZiAobG9hZGVyU3R5bGUgPT09IDIpIHRoaXMuX0RyYXdQZXJjZW50VGV4dExvYWRpbmdTY3JlZW4oaGFzSGFkRXJyb3IpOwogICAgICAgICAgICBlbHNlIGlmIChsb2FkZXJTdHlsZSA9PT0gMykgQzMubm9vcCgpOwogICAgICAgICAgICBlbHNlIGlmIChsb2FkZXJTdHlsZSA9PT0gNCkgdGhpcy5fRHJhd1NwbGFzaExvYWRpbmdTY3JlZW4oaGFzSGFkRXJyb3IpOwogICAgICAgICAgICBlbHNlIHRocm93IG5ldyBFcnJvcigiaW52YWxpZCBsb2FkZXIgc3R5bGUiKTsKICAgICAgICAgICAgcmVuZGVyZXIuRmluaXNoKCk7CiAgICAgICAgICAgIHRoaXMuX3JhZklkID0gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHRoaXMuX0RyYXdMb2FkaW5nU2NyZWVuKCkpCiAgICAgICAgfQogICAgICAgIF9EcmF3UGVyY2VudFRleHRMb2FkaW5nU2NyZWVuKGhhc0hhZEVycm9yKSB7CiAgICAgICAgICAgIGlmIChoYXNIYWRFcnJvcikgdGhpcy5fcGVyY2VudFRleHQuU2V0Q29sb3JSZ2IoMSwgMCwgMCk7CiAgICAgICAgICAgIGVsc2UgdGhpcy5fcGVyY2VudFRleHQuU2V0Q29sb3JSZ2IoLjYsIC42LCAuNik7CiAgICAgICAgICAgIHRoaXMuX3BlcmNlbnRUZXh0LlNldFRleHQoTWF0aC5yb3VuZCh0aGlzLl9sb2FkaW5nUHJvZ3Jlc3MgKiAxMDApICsgIiUiKTsKICAgICAgICAgICAgY29uc3QgbWlkWCA9IHRoaXMuX2NhbnZhc0Nzc1dpZHRoIC8gMjsKICAgICAgICAgICAgY29uc3QgbWlkWSA9IHRoaXMuX2NhbnZhc0Nzc0hlaWdodCAvIDI7CiAgICAgICAgICAgIGNvbnN0IGh3ID0gUEVSQ0VOVFRFWFRfV0lEVEggLyAyOwogICAgICAgICAgICBjb25zdCBoaCA9IFBFUkNFTlRURVhUX0hFSUdIVCAvIDI7CiAgICAgICAgICAgIHRlbXBRdWFkLnNldFJlY3QobWlkWCAtIGh3LCBtaWRZIC0gaGgsIG1pZFggKwogICAgICAgICAgICAgICAgaHcsIG1pZFkgKyBoaCk7CiAgICAgICAgICAgIGNvbnN0IHJlbmRlcmVyID0gdGhpcy5HZXRSZW5kZXJlcigpOwogICAgICAgICAgICByZW5kZXJlci5TZXRUZXh0dXJlKHRoaXMuX3BlcmNlbnRUZXh0LkdldFRleHR1cmUoKSk7CiAgICAgICAgICAgIHJlbmRlcmVyLlF1YWQzKHRlbXBRdWFkLCB0aGlzLl9wZXJjZW50VGV4dC5HZXRUZXhSZWN0KCkpCiAgICAgICAgfQogICAgICAgIF9EcmF3UHJvZ3Jlc3NCYXJMb2FkaW5nU2NyZWVuKGhhc0hhZEVycm9yLCB3aWR0aCwgeU9mZikgewogICAgICAgICAgICBjb25zdCByZW5kZXJlciA9IHRoaXMuR2V0UmVuZGVyZXIoKTsKICAgICAgICAgICAgY29uc3QgaGVpZ2h0ID0gUFJPR1JFU1NCQVJfSEVJR0hUOwogICAgICAgICAgICByZW5kZXJlci5TZXRDb2xvckZpbGxNb2RlKCk7CiAgICAgICAgICAgIGlmIChoYXNIYWRFcnJvcikgcmVuZGVyZXIuU2V0Q29sb3JSZ2JhKDEsIDAsIDAsIDEpOwogICAgICAgICAgICBlbHNlIHJlbmRlcmVyLlNldENvbG9yUmdiYSguMTE4LCAuNTY1LCAxLCAxKTsKICAgICAgICAgICAgY29uc3QgbWlkWCA9IHRoaXMuX2NhbnZhc0Nzc1dpZHRoIC8gMjsKICAgICAgICAgICAgY29uc3QgbWlkWSA9IHRoaXMuX2NhbnZhc0Nzc0hlaWdodCAvIDI7CiAgICAgICAgICAgIGNvbnN0IGh3ID0gd2lkdGggLyAyOwogICAgICAgICAgICBjb25zdCBoaCA9IGhlaWdodCAvIDI7CiAgICAgICAgICAgIHRlbXBSZWN0LnNldFdIKG1pZFggLQogICAgICAgICAgICAgICAgaHcsIG1pZFkgLSBoaCArIHlPZmYsIE1hdGguZmxvb3Iod2lkdGggKiB0aGlzLl9sb2FkaW5nUHJvZ3Jlc3MpLCBoZWlnaHQpOwogICAgICAgICAgICByZW5kZXJlci5SZWN0KHRlbXBSZWN0KTsKICAgICAgICAgICAgdGVtcFJlY3Quc2V0V0gobWlkWCAtIGh3LCBtaWRZIC0gaGggKyB5T2ZmLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgICAgICAgdGVtcFJlY3Qub2Zmc2V0KC0uNSwgLS41KTsKICAgICAgICAgICAgdGVtcFJlY3QuaW5mbGF0ZSguNSwgLjUpOwogICAgICAgICAgICByZW5kZXJlci5TZXRDb2xvclJnYmEoMCwgMCwgMCwgMSk7CiAgICAgICAgICAgIHJlbmRlcmVyLkxpbmVSZWN0Mih0ZW1wUmVjdCk7CiAgICAgICAgICAgIHRlbXBSZWN0LmluZmxhdGUoMSwgMSk7CiAgICAgICAgICAgIHJlbmRlcmVyLlNldENvbG9yUmdiYSgxLCAxLCAxLCAxKTsKICAgICAgICAgICAgcmVuZGVyZXIuTGluZVJlY3QyKHRlbXBSZWN0KQogICAgICAgIH0KICAgICAgICBfRHJhd1Byb2dyZXNzQmFyQW5kTG9nb0xvYWRpbmdTY3JlZW4oaGFzSGFkRXJyb3IpIHsKICAgICAgICAgICAgY29uc3QgcmVuZGVyZXIgPSB0aGlzLkdldFJlbmRlcmVyKCk7CiAgICAgICAgICAgIGNvbnN0IGxvYWRpbmdMb2dvQXNzZXQgPSB0aGlzLl9ydW50aW1lLkdldExvYWRpbmdMb2dvQXNzZXQoKTsKICAgICAgICAgICAgaWYgKCFsb2FkaW5nTG9nb0Fzc2V0KSB7CiAgICAgICAgICAgICAgICB0aGlzLl9EcmF3UHJvZ3Jlc3NCYXJMb2FkaW5nU2NyZWVuKGhhc0hhZEVycm9yLAogICAgICAgICAgICAgICAgICAgIFBST0dSRVNTQkFSX1dJRFRILCAwKTsKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IGxvZ29UZXh0dXJlID0gbG9hZGluZ0xvZ29Bc3NldC5HZXRUZXh0dXJlKCk7CiAgICAgICAgICAgIGlmICghbG9nb1RleHR1cmUpIHsKICAgICAgICAgICAgICAgIHRoaXMuX0RyYXdQcm9ncmVzc0JhckxvYWRpbmdTY3JlZW4oaGFzSGFkRXJyb3IsIFBST0dSRVNTQkFSX1dJRFRILCAwKTsKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IGxvZ29XID0gbG9nb1RleHR1cmUuR2V0V2lkdGgoKTsKICAgICAgICAgICAgY29uc3QgbG9nb0ggPSBsb2dvVGV4dHVyZS5HZXRIZWlnaHQoKTsKICAgICAgICAgICAgY29uc3QgbWlkWCA9IHRoaXMuX2NhbnZhc0Nzc1dpZHRoIC8gMjsKICAgICAgICAgICAgY29uc3QgbWlkWSA9IHRoaXMuX2NhbnZhc0Nzc0hlaWdodCAvIDI7CiAgICAgICAgICAgIGNvbnN0IGh3ID0gbG9nb1cgLyAyOwogICAgICAgICAgICBjb25zdCBoaCA9IGxvZ29IIC8gMjsKICAgICAgICAgICAgdGVtcFF1YWQuc2V0UmVjdChtaWRYIC0gaHcsIG1pZFkgLSBoaCwgbWlkWCArIGh3LCBtaWRZICsgaGgpOwogICAgICAgICAgICByZW5kZXJlci5TZXRUZXh0dXJlKGxvZ29UZXh0dXJlKTsKICAgICAgICAgICAgcmVuZGVyZXIuUXVhZCh0ZW1wUXVhZCk7CiAgICAgICAgICAgIHRoaXMuX0RyYXdQcm9ncmVzc0JhckxvYWRpbmdTY3JlZW4oaGFzSGFkRXJyb3IsIGxvZ29XLAogICAgICAgICAgICAgICAgaGggKyAxNikKICAgICAgICB9CiAgICAgICAgX0RyYXdTcGxhc2hMb2FkaW5nU2NyZWVuKGhhc0hhZEVycm9yKSB7CiAgICAgICAgICAgIGNvbnN0IHJlbmRlcmVyID0gdGhpcy5HZXRSZW5kZXJlcigpOwogICAgICAgICAgICBjb25zdCBsb2dvVGV4ID0gdGhpcy5fc3BsYXNoVGV4dHVyZXMubG9nbzsKICAgICAgICAgICAgY29uc3QgcG93ZXJlZFRleCA9IHRoaXMuX3NwbGFzaFRleHR1cmVzLnBvd2VyZWQ7CiAgICAgICAgICAgIGNvbnN0IHdlYnNpdGVUZXggPSB0aGlzLl9zcGxhc2hUZXh0dXJlcy53ZWJzaXRlOwogICAgICAgICAgICBjb25zdCBub3dUaW1lID0gRGF0ZS5ub3coKTsKICAgICAgICAgICAgaWYgKHRoaXMuX3NwbGFzaEZyYW1lTnVtYmVyID09PSAwKSB0aGlzLl9sb2FkZXJTdGFydFRpbWUgPSBub3dUaW1lOwogICAgICAgICAgICBjb25zdCBhbGxvd1F1aWNrU3BsYXNoID0gdGhpcy5fcnVudGltZS5Jc1ByZXZpZXcoKSB8fCB0aGlzLl9ydW50aW1lLklzRkJJbnN0YW50QXZhaWxhYmxlKCkgJiYgIXRoaXMuX3J1bnRpbWUuSXNDb3Jkb3ZhKCk7CiAgICAgICAgICAgIGNvbnN0IHNwbGFzaEFmdGVyRmFkZU91dFdhaXQgPSBhbGxvd1F1aWNrU3BsYXNoID8gMCA6IFNQTEFTSF9BRlRFUl9GQURFT1VUX1dBSVRfVElNRTsKICAgICAgICAgICAgY29uc3Qgc3BsYXNoTWluRGlzcGxheVRpbWUgPQogICAgICAgICAgICAgICAgYWxsb3dRdWlja1NwbGFzaCA/IDAgOiBTUExBU0hfTUlOX0RJU1BMQVlfVElNRTsKICAgICAgICAgICAgbGV0IGEgPSAxOwogICAgICAgICAgICBpZiAodGhpcy5fc3BsYXNoU3RhdGUgPT09ICJmYWRlLWluIikgYSA9IE1hdGgubWluKChub3dUaW1lIC0gdGhpcy5fbG9hZGVyU3RhcnRUaW1lKSAvIFNQTEFTSF9GQURFX0RVUkFUSU9OLCAxKTsKICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5fc3BsYXNoU3RhdGUgPT09ICJmYWRlLW91dCIpIGEgPSBNYXRoLm1heCgxIC0gKG5vd1RpbWUgLSB0aGlzLl9zcGxhc2hGYWRlT3V0U3RhcnRUaW1lKSAvIFNQTEFTSF9GQURFX0RVUkFUSU9OLCAwKTsKICAgICAgICAgICAgcmVuZGVyZXIuU2V0Q29sb3JGaWxsTW9kZSgpOwogICAgICAgICAgICByZW5kZXJlci5TZXRDb2xvclJnYmEoLjIzMSAqIGEsIC4yNTEgKiBhLCAuMjcxICogYSwgYSk7CiAgICAgICAgICAgIHRlbXBSZWN0LnNldCgwLCAwLCB0aGlzLl9jYW52YXNDc3NXaWR0aCwgdGhpcy5fY2FudmFzQ3NzSGVpZ2h0KTsKICAgICAgICAgICAgcmVuZGVyZXIuUmVjdCh0ZW1wUmVjdCk7CiAgICAgICAgICAgIGNvbnN0IHcgPSBNYXRoLmNlaWwodGhpcy5fY2FudmFzQ3NzV2lkdGgpOwogICAgICAgICAgICBjb25zdCBoID0gTWF0aC5jZWlsKHRoaXMuX2NhbnZhc0Nzc0hlaWdodCk7CiAgICAgICAgICAgIGxldCBkcmF3VywgZHJhd0g7CiAgICAgICAgICAgIGlmICh0aGlzLl9jYW52YXNDc3NIZWlnaHQgPiAyNTYpIHsKICAgICAgICAgICAgICAgIHJlbmRlcmVyLlNldENvbG9yUmdiYSguMzAyICogYSwgLjMzNCAqIGEsIC4zNjUgKiBhLCBhKTsKICAgICAgICAgICAgICAgIGRyYXdXID0gdzsKICAgICAgICAgICAgICAgIGRyYXdIID0gTWF0aC5tYXgoaCAqIC4wMDUsIDIpOwogICAgICAgICAgICAgICAgdGVtcFJlY3Quc2V0V0goMCwgaCAqIC44IC0gZHJhd0ggLyAyLCBkcmF3VywgZHJhd0gpOwogICAgICAgICAgICAgICAgcmVuZGVyZXIuUmVjdCh0ZW1wUmVjdCk7CiAgICAgICAgICAgICAgICBpZiAoaGFzSGFkRXJyb3IpIHJlbmRlcmVyLlNldENvbG9yUmdiYShhLCAwLCAwLCBhKTsKICAgICAgICAgICAgICAgIGVsc2UgcmVuZGVyZXIuU2V0Q29sb3JSZ2JhKC4xNjEgKiBhLCAuOTUzICogYSwgLjgxNiAqIGEsIGEpOwogICAgICAgICAgICAgICAgZHJhd1cgPSB3ICogdGhpcy5fbG9hZGluZ1Byb2dyZXNzOwogICAgICAgICAgICAgICAgdGVtcFJlY3Quc2V0V0godyAqIC41IC0gZHJhd1cgLyAyLCBoICogLjggLSBkcmF3SCAvIDIsIGRyYXdXLCBkcmF3SCk7CiAgICAgICAgICAgICAgICByZW5kZXJlci5SZWN0KHRlbXBSZWN0KTsKICAgICAgICAgICAgICAgIHJlbmRlcmVyLlNldENvbG9yUmdiYShhLCBhLCBhLCBhKTsKICAgICAgICAgICAgICAgIHJlbmRlcmVyLlNldFRleHR1cmVGaWxsTW9kZSgpOwogICAgICAgICAgICAgICAgaWYgKHBvd2VyZWRUZXgpIHsKICAgICAgICAgICAgICAgICAgICBkcmF3VyA9IEMzLmNsYW1wKGggKiAuMjIsIDEwNSwgdyAqIC42KSAqCiAgICAgICAgICAgICAgICAgICAgICAgIDEuNTsKICAgICAgICAgICAgICAgICAgICBkcmF3SCA9IGRyYXdXIC8gODsKICAgICAgICAgICAgICAgICAgICB0ZW1wUmVjdC5zZXRXSCh3ICogLjUgLSBkcmF3VyAvIDIsIGggKiAuMiAtIGRyYXdIIC8gMiwgZHJhd1csIGRyYXdIKTsKICAgICAgICAgICAgICAgICAgICByZW5kZXJlci5TZXRUZXh0dXJlKHBvd2VyZWRUZXgpOwogICAgICAgICAgICAgICAgICAgIHJlbmRlcmVyLlJlY3QodGVtcFJlY3QpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAobG9nb1RleCkgewogICAgICAgICAgICAgICAgICAgIGRyYXdXID0gTWF0aC5taW4oaCAqIC4zOTUsIHcgKiAuOTUpOwogICAgICAgICAgICAgICAgICAgIGRyYXdIID0gZHJhd1c7CiAgICAgICAgICAgICAgICAgICAgdGVtcFJlY3Quc2V0V0godyAqIC41IC0gZHJhd1cgLyAyLCBoICogLjQ4NSAtIGRyYXdIIC8gMiwgZHJhd1csIGRyYXdIKTsKICAgICAgICAgICAgICAgICAgICByZW5kZXJlci5TZXRUZXh0dXJlKGxvZ29UZXgpOwogICAgICAgICAgICAgICAgICAgIHJlbmRlcmVyLlJlY3QodGVtcFJlY3QpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAod2Vic2l0ZVRleCkgewogICAgICAgICAgICAgICAgICAgIGRyYXdXID0gQzMuY2xhbXAoaCAqIC4yMiwgMTA1LCB3ICogLjYpICogMS41OwogICAgICAgICAgICAgICAgICAgIGRyYXdIID0gZHJhd1cgLyA4OwogICAgICAgICAgICAgICAgICAgIHRlbXBSZWN0LnNldFdIKHcgKiAuNSAtIGRyYXdXIC8gMiwgaCAqIC44NjggLSBkcmF3SCAvIDIsIGRyYXdXLCBkcmF3SCk7CiAgICAgICAgICAgICAgICAgICAgcmVuZGVyZXIuU2V0VGV4dHVyZSh3ZWJzaXRlVGV4KTsKICAgICAgICAgICAgICAgICAgICByZW5kZXJlci5SZWN0KHRlbXBSZWN0KQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmVuZGVyZXIuU2V0Q29sb3JSZ2JhKC4zMDIgKiBhLAogICAgICAgICAgICAgICAgICAgIC4zMzQgKiBhLCAuMzY1ICogYSwgYSk7CiAgICAgICAgICAgICAgICBkcmF3VyA9IHc7CiAgICAgICAgICAgICAgICBkcmF3SCA9IE1hdGgubWF4KGggKiAuMDA1LCAyKTsKICAgICAgICAgICAgICAgIHRlbXBSZWN0LnNldFdIKDAsIGggKiAuODUgLSBkcmF3SCAvIDIsIGRyYXdXLCBkcmF3SCk7CiAgICAgICAgICAgICAgICByZW5kZXJlci5SZWN0KHRlbXBSZWN0KTsKICAgICAgICAgICAgICAgIGlmIChoYXNIYWRFcnJvcikgcmVuZGVyZXIuU2V0Q29sb3JSZ2JhKGEsIDAsIDAsIGEpOwogICAgICAgICAgICAgICAgZWxzZSByZW5kZXJlci5TZXRDb2xvclJnYmEoLjE2MSAqIGEsIC45NTMgKiBhLCAuODE2ICogYSwgYSk7CiAgICAgICAgICAgICAgICBkcmF3VyA9IHcgKiB0aGlzLl9sb2FkaW5nUHJvZ3Jlc3M7CiAgICAgICAgICAgICAgICB0ZW1wUmVjdC5zZXRXSCh3ICogLjUgLSBkcmF3VyAvIDIsIGggKiAuODUgLSBkcmF3SCAvIDIsIGRyYXdXLCBkcmF3SCk7CiAgICAgICAgICAgICAgICByZW5kZXJlci5SZWN0KHRlbXBSZWN0KTsKICAgICAgICAgICAgICAgIHJlbmRlcmVyLlNldENvbG9yUmdiYShhLCBhLCBhLCBhKTsKICAgICAgICAgICAgICAgIHJlbmRlcmVyLlNldFRleHR1cmVGaWxsTW9kZSgpOwogICAgICAgICAgICAgICAgaWYgKGxvZ29UZXgpIHsKICAgICAgICAgICAgICAgICAgICBkcmF3VyA9IGggKiAuNTU7CiAgICAgICAgICAgICAgICAgICAgZHJhd0ggPSBkcmF3VzsKICAgICAgICAgICAgICAgICAgICB0ZW1wUmVjdC5zZXRXSCh3ICogLjUgLSBkcmF3VyAvIDIsIGggKiAuNDUgLSBkcmF3SCAvIDIsIGRyYXdXLCBkcmF3SCk7CiAgICAgICAgICAgICAgICAgICAgcmVuZGVyZXIuU2V0VGV4dHVyZShsb2dvVGV4KTsKICAgICAgICAgICAgICAgICAgICByZW5kZXJlci5SZWN0KHRlbXBSZWN0KQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuX3NwbGFzaEZyYW1lTnVtYmVyKys7CiAgICAgICAgICAgIGlmICh0aGlzLl9zcGxhc2hTdGF0ZSA9PT0gImZhZGUtaW4iICYmIG5vd1RpbWUgLSB0aGlzLl9sb2FkZXJTdGFydFRpbWUgPj0gU1BMQVNIX0ZBREVfRFVSQVRJT04gJiYgdGhpcy5fc3BsYXNoRnJhbWVOdW1iZXIgPj0gMikgewogICAgICAgICAgICAgICAgdGhpcy5fc3BsYXNoU3RhdGUgPSAid2FpdCI7CiAgICAgICAgICAgICAgICB0aGlzLl9zcGxhc2hGYWRlSW5GaW5pc2hUaW1lID0gbm93VGltZQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLl9zcGxhc2hTdGF0ZSA9PT0gIndhaXQiICYmIG5vd1RpbWUgLSB0aGlzLl9zcGxhc2hGYWRlSW5GaW5pc2hUaW1lID49IHNwbGFzaE1pbkRpc3BsYXlUaW1lICYmIHRoaXMuX2xvYWRpbmdQcm9ncmVzcyA+PSAxKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9zcGxhc2hTdGF0ZSA9ICJmYWRlLW91dCI7CiAgICAgICAgICAgICAgICB0aGlzLl9zcGxhc2hGYWRlT3V0U3RhcnRUaW1lID0gbm93VGltZQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLl9zcGxhc2hTdGF0ZSA9PT0gImZhZGUtb3V0IiAmJiBub3dUaW1lIC0gdGhpcy5fc3BsYXNoRmFkZU91dFN0YXJ0VGltZSA+PSBTUExBU0hfRkFERV9EVVJBVElPTiArCiAgICAgICAgICAgICAgICBzcGxhc2hBZnRlckZhZGVPdXRXYWl0IHx8IGFsbG93UXVpY2tTcGxhc2ggJiYgdGhpcy5fbG9hZGluZ1Byb2dyZXNzID49IDEgJiYgbm93VGltZSAtIHRoaXMuX2xvYWRlclN0YXJ0VGltZSA8IDUwMCkgdGhpcy5fc3BsYXNoRG9uZVJlc29sdmUoKQogICAgICAgIH0KICAgIH07Cgp9CgovLyBydW50aW1lLmpzCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIGNvbnN0IEMzRGVidWdnZXIgPSBzZWxmLkMzRGVidWdnZXI7CiAgICBjb25zdCBhc3NlcnQgPSBzZWxmLmFzc2VydDsKICAgIGNvbnN0IERFRkFVTFRfUlVOVElNRV9PUFRTID0gewogICAgICAgICJtZXNzYWdlUG9ydCI6IG51bGwsCiAgICAgICAgInJ1bnRpbWVCYXNlVXJsIjogIiIsCiAgICAgICAgImhlYWRsZXNzIjogZmFsc2UsCiAgICAgICAgImhhc0RvbSI6IHRydWUsCiAgICAgICAgImlzSW5Xb3JrZXIiOiBmYWxzZSwKICAgICAgICAidXNlQXVkaW8iOiB0cnVlLAogICAgICAgICJwcm9qZWN0RGF0YSI6ICIiLAogICAgICAgICJleHBvcnRUeXBlIjogIiIKICAgIH07CiAgICBsZXQgaWZlID0gdHJ1ZTsKICAgIEMzLlJ1bnRpbWUgPSBjbGFzcyBDM1J1bnRpbWUgZXh0ZW5kcyBDMy5EZWZlbmRlZEJhc2UgewogICAgICAgIGNvbnN0cnVjdG9yKG9wdHMpIHsKICAgICAgICAgICAgb3B0cyA9IE9iamVjdC5hc3NpZ24oe30sIERFRkFVTFRfUlVOVElNRV9PUFRTLCBvcHRzKTsKICAgICAgICAgICAgc3VwZXIoKTsKICAgICAgICAgICAgdGhpcy5fbWVzc2FnZVBvcnQgPSBvcHRzWyJtZXNzYWdlUG9ydCJdOwogICAgICAgICAgICB0aGlzLl9ydW50aW1lQmFzZVVybCA9IG9wdHNbInJ1bnRpbWVCYXNlVXJsIl07CiAgICAgICAgICAgIHRoaXMuX3ByZXZpZXdVcmwgPSBvcHRzWyJwcmV2aWV3VXJsIl07CiAgICAgICAgICAgIHRoaXMuX2lzSGVhZGxlc3MgPSAhIW9wdHNbImhlYWRsZXNzIl07CiAgICAgICAgICAgIHRoaXMuX2hhc0RvbSA9ICEhb3B0c1siaGFzRG9tIl07CiAgICAgICAgICAgIHRoaXMuX2lzSW5Xb3JrZXIgPSAhIW9wdHNbImlzSW5Xb3JrZXIiXTsKICAgICAgICAgICAgaWZlID0gb3B0c1siaWZlIl07CiAgICAgICAgICAgIHRoaXMuX3VzZUF1ZGlvID0gISFvcHRzWyJ1c2VBdWRpbyJdOwogICAgICAgICAgICB0aGlzLl9leHBvcnRUeXBlID0gb3B0c1siZXhwb3J0VHlwZSJdOwogICAgICAgICAgICB0aGlzLl9pc2lPU0NvcmRvdmEgPSAhIW9wdHNbImlzaU9TQ29yZG92YSJdOwogICAgICAgICAgICB0aGlzLl9pc2lPU1dlYlZpZXcgPSAhIW9wdHNbImlzaU9TV2ViVmlldyJdOwogICAgICAgICAgICB0aGlzLl9pc0ZCSW5zdGFudEF2YWlsYWJsZSA9ICEhb3B0c1siaXNGQkluc3RhbnRBdmFpbGFibGUiXTsKICAgICAgICAgICAgdGhpcy5fb3B1c1dhc21TY3JpcHRVcmwgPSBvcHRzWyJvcHVzV2FzbVNjcmlwdFVybCJdOwogICAgICAgICAgICB0aGlzLl9vcHVzV2FzbUJpbmFyeVVybCA9IG9wdHNbIm9wdXNXYXNtQmluYXJ5VXJsIl07CiAgICAgICAgICAgIHRoaXMuX2lzRGVidWcgPSAhISh0aGlzLl9leHBvcnRUeXBlID09PSAicHJldmlldyIgJiYgb3B0c1siaXNEZWJ1ZyJdKTsKICAgICAgICAgICAgdGhpcy5fYnJlYWtwb2ludHNFbmFibGVkID0gdGhpcy5faXNEZWJ1ZzsKICAgICAgICAgICAgdGhpcy5faXNEZWJ1Z2dpbmcgPSB0aGlzLl9pc0RlYnVnOwogICAgICAgICAgICB0aGlzLl9kZWJ1Z2dpbmdEaXNhYmxlZCA9IDA7CiAgICAgICAgICAgIHRoaXMuX2FkZGl0aW9uYWxMb2FkUHJvbWlzZXMgPSBbXTsKICAgICAgICAgICAgdGhpcy5fYWRkaXRpb25hbENyZWF0ZVByb21pc2VzID0gW107CiAgICAgICAgICAgIHRoaXMuX2lzVXNpbmdDcmVhdGVQcm9taXNlcyA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl9wcm9qZWN0TmFtZSA9ICIiOwogICAgICAgICAgICB0aGlzLl9wcm9qZWN0VmVyc2lvbiA9ICIiOwogICAgICAgICAgICB0aGlzLl9wcm9qZWN0VW5pcXVlSWQgPSAiIjsKICAgICAgICAgICAgdGhpcy5fYXBwSWQgPQogICAgICAgICAgICAgICAgIiI7CiAgICAgICAgICAgIHRoaXMuX29yaWdpbmFsVmlld3BvcnRXaWR0aCA9IDA7CiAgICAgICAgICAgIHRoaXMuX29yaWdpbmFsVmlld3BvcnRIZWlnaHQgPSAwOwogICAgICAgICAgICB0aGlzLl9kZXZpY2VQaXhlbFJhdGlvID0gc2VsZi5kZXZpY2VQaXhlbFJhdGlvOwogICAgICAgICAgICB0aGlzLl9wYXJhbGxheFhvcmlnaW4gPSAwOwogICAgICAgICAgICB0aGlzLl9wYXJhbGxheFlvcmlnaW4gPSAwOwogICAgICAgICAgICB0aGlzLl92aWV3cG9ydFdpZHRoID0gMDsKICAgICAgICAgICAgdGhpcy5fdmlld3BvcnRIZWlnaHQgPSAwOwogICAgICAgICAgICB0aGlzLl9sb2FkZXJTdHlsZSA9IDA7CiAgICAgICAgICAgIHRoaXMuX3VzZXNMb2FkZXJMYXlvdXQgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5faXNMb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgdGhpcy5fdXNlc0FueUJhY2tncm91bmRCbGVuZGluZyA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl91c2VzQW55Q3Jvc3NTYW1wbGluZyA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl91c2VzQW55RGVwdGhTYW1wbGluZyA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl9sb2FkaW5nTG9nb0Fzc2V0ID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fYXNzZXRNYW5hZ2VyID0gQzMuTmV3KEMzLkFzc2V0TWFuYWdlciwgdGhpcywgb3B0cyk7CiAgICAgICAgICAgIHRoaXMuX2xheW91dE1hbmFnZXIgPSBDMy5OZXcoQzMuTGF5b3V0TWFuYWdlciwKICAgICAgICAgICAgICAgIHRoaXMpOwogICAgICAgICAgICB0aGlzLl9ldmVudFNoZWV0TWFuYWdlciA9IEMzLk5ldyhDMy5FdmVudFNoZWV0TWFuYWdlciwgdGhpcyk7CiAgICAgICAgICAgIHRoaXMuX3BsdWdpbk1hbmFnZXIgPSBDMy5OZXcoQzMuUGx1Z2luTWFuYWdlciwgdGhpcyk7CiAgICAgICAgICAgIHRoaXMuX2NvbGxpc2lvbkVuZ2luZSA9IEMzLk5ldyhDMy5Db2xsaXNpb25FbmdpbmUsIHRoaXMpOwogICAgICAgICAgICB0aGlzLl90aW1lbGluZU1hbmFnZXIgPSBDMy5OZXcoQzMuVGltZWxpbmVNYW5hZ2VyLCB0aGlzKTsKICAgICAgICAgICAgdGhpcy5fdHJhbnNpdGlvbk1hbmFnZXIgPSBDMy5OZXcoQzMuVHJhbnNpdGlvbk1hbmFnZXIsIHRoaXMpOwogICAgICAgICAgICB0aGlzLl90ZW1wbGF0ZU1hbmFnZXIgPSBDMy5OZXcoQzMuVGVtcGxhdGVNYW5hZ2VyLCB0aGlzKTsKICAgICAgICAgICAgdGhpcy5fYWxsT2JqZWN0Q2xhc3NlcyA9IFtdOwogICAgICAgICAgICB0aGlzLl9vYmplY3RDbGFzc2VzQnlOYW1lID0gbmV3IE1hcDsKICAgICAgICAgICAgdGhpcy5fb2JqZWN0Q2xhc3Nlc0J5U2lkID0gbmV3IE1hcDsKICAgICAgICAgICAgdGhpcy5fZmFtaWx5Q291bnQgPSAwOwogICAgICAgICAgICB0aGlzLl9hbGxDb250YWluZXJzID0gW107CiAgICAgICAgICAgIHRoaXMuX2FsbEVmZmVjdExpc3RzID0gW107CiAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRMYXlvdXRTdGFjayA9IFtdOwogICAgICAgICAgICB0aGlzLl9pbnN0YW5jZXNQZW5kaW5nQ3JlYXRlID0gW107CiAgICAgICAgICAgIHRoaXMuX2luc3RhbmNlc1BlbmRpbmdEZXN0cm95ID0gbmV3IE1hcDsKICAgICAgICAgICAgdGhpcy5faGFzUGVuZGluZ0luc3RhbmNlcyA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl9pc0ZsdXNoaW5nUGVuZGluZ0luc3RhbmNlcyA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl9vYmplY3RDb3VudCA9IDA7CiAgICAgICAgICAgIHRoaXMuX25leHRVaWQgPSAwOwogICAgICAgICAgICB0aGlzLl9pbnN0YW5jZXNCeVVpZCA9IG5ldyBNYXA7CiAgICAgICAgICAgIHRoaXMuX2luc3RhbmNlc1RvUmVsZWFzZUF0RW5kT2ZUaWNrID0gbmV3IFNldDsKICAgICAgICAgICAgdGhpcy5faW5zdGFuY2VzVG9SZWxlYXNlQWZmZWN0ZWRPYmplY3RDbGFzc2VzID0gbmV3IFNldDsKICAgICAgICAgICAgdGhpcy5fb2JqZWN0UmVmZXJlbmNlVGFibGUgPSBbXTsKICAgICAgICAgICAgdGhpcy5fanNQcm9wTmFtZVRhYmxlID0gW107CiAgICAgICAgICAgIHRoaXMuX2NhbnZhc01hbmFnZXIgPSBudWxsOwogICAgICAgICAgICB0aGlzLl91c2VzM2RGZWF0dXJlcyA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl9mcmFtZXJhdGVNb2RlID0gInZzeW5jIjsKICAgICAgICAgICAgdGhpcy5fY29tcG9zaXRpbmdNb2RlID0gInN0YW5kYXJkIjsKICAgICAgICAgICAgdGhpcy5fc2FtcGxpbmcgPSAidHJpbGluZWFyIjsKICAgICAgICAgICAgdGhpcy5faXNQaXhlbFJvdW5kaW5nRW5hYmxlZCA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl9uZWVkUmVuZGVyID0gdHJ1ZTsKICAgICAgICAgICAgdGhpcy5fcGF1c2VPbkJsdXIgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5faXNQYXVzZWRPbkJsdXIgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5fZXhwb3J0VG9WaWRlbyA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3RpY2tDYWxsYmFja3MgPSB7CiAgICAgICAgICAgICAgICBub3JtYWw6IHRpbWVzdGFtcCA9PiB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmFmSWQgPSAtMTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9ydWFmSWQgPSAtMTsKICAgICAgICAgICAgICAgICAgICB0aGlzLlRpY2sodGltZXN0YW1wKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHRpY2tPbmx5OiB0aW1lc3RhbXAgPT4gewogICAgICAgICAgICAgICAgICAgIHRoaXMuX3J1YWZJZCA9IC0xOwogICAgICAgICAgICAgICAgICAgIHRoaXMuVGljayh0aW1lc3RhbXAsIGZhbHNlLCAic2tpcC1yZW5kZXIiKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHJlbmRlck9ubHk6ICgpID0+IHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9yYWZJZCA9IC0xOwogICAgICAgICAgICAgICAgICAgIHRoaXMuUmVuZGVyKCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICAgICAgdGhpcy5fcmFmSWQgPSAtMTsKICAgICAgICAgICAgdGhpcy5fcnVhZklkID0gLTE7CiAgICAgICAgICAgIHRoaXMuX3RpY2tDb3VudCA9IDA7CiAgICAgICAgICAgIHRoaXMuX3RpY2tDb3VudE5vU2F2ZSA9IDA7CiAgICAgICAgICAgIHRoaXMuX2hhc1N0YXJ0ZWQgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5faXNJblRpY2sgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5faGFzU3RhcnRlZFRpY2tpbmcgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5faXNMYXlvdXRGaXJzdFRpY2sgPQogICAgICAgICAgICAgICAgdHJ1ZTsKICAgICAgICAgICAgdGhpcy5fc3VzcGVuZENvdW50ID0gMDsKICAgICAgICAgICAgdGhpcy5fc2NoZWR1bGVUcmlnZ2Vyc1Rocm90dGxlID0gbmV3IEMzLlByb21pc2VUaHJvdHRsZSgxKTsKICAgICAgICAgICAgdGhpcy5fcmFuZG9tTnVtYmVyQ2FsbGJhY2sgPSAoKSA9PiBNYXRoLnJhbmRvbSgpOwogICAgICAgICAgICB0aGlzLl9zdGFydFRpbWUgPSAwOwogICAgICAgICAgICB0aGlzLl9sYXN0VGlja1RpbWUgPSAwOwogICAgICAgICAgICB0aGlzLl9kdFJhdyA9IDA7CiAgICAgICAgICAgIHRoaXMuX2R0MSA9IDA7CiAgICAgICAgICAgIHRoaXMuX2R0ID0gMDsKICAgICAgICAgICAgdGhpcy5fdGltZVNjYWxlID0gMTsKICAgICAgICAgICAgdGhpcy5fbWluaW11bUZyYW1lcmF0ZSA9IDMwOwogICAgICAgICAgICB0aGlzLl9nYW1lVGltZSA9IEMzLk5ldyhDMy5LYWhhblN1bSk7CiAgICAgICAgICAgIHRoaXMuX2dhbWVUaW1lUmF3ID0gQzMuTmV3KEMzLkthaGFuU3VtKTsKICAgICAgICAgICAgdGhpcy5fd2FsbFRpbWUgPSBDMy5OZXcoQzMuS2FoYW5TdW0pOwogICAgICAgICAgICB0aGlzLl9pbnN0YW5jZVRpbWVzID0gbmV3IE1hcDsKICAgICAgICAgICAgdGhpcy5fZnBzRnJhbWVDb3VudCA9IC0xOwogICAgICAgICAgICB0aGlzLl9mcHNMYXN0VGltZSA9IDA7CiAgICAgICAgICAgIHRoaXMuX2ZwcyA9IDA7CiAgICAgICAgICAgIHRoaXMuX21haW5UaHJlYWRUaW1lQ291bnRlciA9IDA7CiAgICAgICAgICAgIHRoaXMuX21haW5UaHJlYWRUaW1lID0gMDsKICAgICAgICAgICAgdGhpcy5faXNMb2FkaW5nU3RhdGUgPQogICAgICAgICAgICAgICAgZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX3NhdmVUb1Nsb3ROYW1lID0gIiI7CiAgICAgICAgICAgIHRoaXMuX2xvYWRGcm9tU2xvdE5hbWUgPSAiIjsKICAgICAgICAgICAgdGhpcy5fbG9hZEZyb21Kc29uID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fbGFzdFNhdmVKc29uID0gIiI7CiAgICAgICAgICAgIHRoaXMuX3Byb2plY3RTdG9yYWdlID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fc2F2ZWdhbWVzU3RvcmFnZSA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX2Rpc3BhdGNoZXIgPSBDMy5OZXcoQzMuRXZlbnQuRGlzcGF0Y2hlcik7CiAgICAgICAgICAgIHRoaXMuX2RvbUV2ZW50SGFuZGxlcnMgPSBuZXcgTWFwOwogICAgICAgICAgICB0aGlzLl9wZW5kaW5nUmVzcG9uc2VQcm9taXNlcyA9IG5ldyBNYXA7CiAgICAgICAgICAgIHRoaXMuX25leHREb21SZXNwb25zZUlkID0gMDsKICAgICAgICAgICAgdGhpcy5fZGlkUmVxdWVzdERldmljZU9yaWVudGF0aW9uRXZlbnQgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5fZGlkUmVxdWVzdERldmljZU1vdGlvbkV2ZW50ID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX2lzUmVhZHlUb0hhbmRsZUV2ZW50cyA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl93YWl0aW5nVG9IYW5kbGVFdmVudHMgPSBbXTsKICAgICAgICAgICAgdGhpcy5fZXZlbnRPYmplY3RzID0gewogICAgICAgICAgICAgICAgInByZXRpY2siOiBDMy5OZXcoQzMuRXZlbnQsICJwcmV0aWNrIiwKICAgICAgICAgICAgICAgICAgICBmYWxzZSksCiAgICAgICAgICAgICAgICAidGljayI6IEMzLk5ldyhDMy5FdmVudCwgInRpY2siLCBmYWxzZSksCiAgICAgICAgICAgICAgICAidGljazIiOiBDMy5OZXcoQzMuRXZlbnQsICJ0aWNrMiIsIGZhbHNlKSwKICAgICAgICAgICAgICAgICJpbnN0YW5jZWRlc3Ryb3kiOiBDMy5OZXcoQzMuRXZlbnQsICJpbnN0YW5jZWRlc3Ryb3kiLCBmYWxzZSksCiAgICAgICAgICAgICAgICAiYmVmb3JlbGF5b3V0Y2hhbmdlIjogQzMuTmV3KEMzLkV2ZW50LCAiYmVmb3JlbGF5b3V0Y2hhbmdlIiwgZmFsc2UpLAogICAgICAgICAgICAgICAgImxheW91dGNoYW5nZSI6IEMzLk5ldyhDMy5FdmVudCwgImxheW91dGNoYW5nZSIsIGZhbHNlKQogICAgICAgICAgICB9OwogICAgICAgICAgICB0aGlzLl9ldmVudE9iamVjdHNbImluc3RhbmNlZGVzdHJveSJdLmluc3RhbmNlID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fdXNlclNjcmlwdERpc3BhdGNoZXIgPSBDMy5OZXcoQzMuRXZlbnQuRGlzcGF0Y2hlcik7CiAgICAgICAgICAgIHRoaXMuX3VzZXJTY3JpcHRFdmVudE9iamVjdHMgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9iZWhJbnN0c1RvVGljayA9IEMzLk5ldyhDMy5SZWRCbGFja1NldCwgQzMuQmVoYXZpb3JJbnN0YW5jZS5Tb3J0QnlUaWNrU2VxdWVuY2UpOwogICAgICAgICAgICB0aGlzLl9iZWhJbnN0c1RvUG9zdFRpY2sgPQogICAgICAgICAgICAgICAgQzMuTmV3KEMzLlJlZEJsYWNrU2V0LCBDMy5CZWhhdmlvckluc3RhbmNlLlNvcnRCeVRpY2tTZXF1ZW5jZSk7CiAgICAgICAgICAgIHRoaXMuX2JlaEluc3RzVG9UaWNrMiA9IEMzLk5ldyhDMy5SZWRCbGFja1NldCwgQzMuQmVoYXZpb3JJbnN0YW5jZS5Tb3J0QnlUaWNrU2VxdWVuY2UpOwogICAgICAgICAgICB0aGlzLl9qb2JTY2hlZHVsZXIgPSBDMy5OZXcoQzMuSm9iU2NoZWR1bGVyUnVudGltZSwgdGhpcywgb3B0c1siam9iU2NoZWR1bGVyIl0pOwogICAgICAgICAgICBpZiAob3B0c1siY2FudmFzIl0pIHRoaXMuX2NhbnZhc01hbmFnZXIgPSBDMy5OZXcoQzMuQ2FudmFzTWFuYWdlciwgdGhpcyk7CiAgICAgICAgICAgIHRoaXMuX21lc3NhZ2VQb3J0Lm9ubWVzc2FnZSA9IGUgPT4gdGhpc1siX09uTWVzc2FnZUZyb21ET00iXShlLmRhdGEpOwogICAgICAgICAgICB0aGlzLkFkZERPTUNvbXBvbmVudE1lc3NhZ2VIYW5kbGVyKCJydW50aW1lIiwgInZpc2liaWxpdHljaGFuZ2UiLCBlID0+IHRoaXMuX09uVmlzaWJpbGl0eUNoYW5nZShlKSk7CiAgICAgICAgICAgIHRoaXMuQWRkRE9NQ29tcG9uZW50TWVzc2FnZUhhbmRsZXIoInJ1bnRpbWUiLCAib3B1cy1kZWNvZGUiLAogICAgICAgICAgICAgICAgZSA9PiB0aGlzLl9XYXNtRGVjb2RlV2ViTU9wdXMoZVsiYXJyYXlCdWZmZXIiXSkpOwogICAgICAgICAgICB0aGlzLkFkZERPTUNvbXBvbmVudE1lc3NhZ2VIYW5kbGVyKCJydW50aW1lIiwgImdldC1yZW1vdGUtcHJldmlldy1zdGF0dXMtaW5mbyIsICgpID0+IHRoaXMuX0dldFJlbW90ZVByZXZpZXdTdGF0dXNJbmZvKCkpOwogICAgICAgICAgICB0aGlzLkFkZERPTUNvbXBvbmVudE1lc3NhZ2VIYW5kbGVyKCJydW50aW1lIiwgImpzLWludm9rZS1mdW5jdGlvbiIsIGUgPT4gdGhpcy5fSW52b2tlRnVuY3Rpb25Gcm9tSlMoZSkpOwogICAgICAgICAgICB0aGlzLkFkZERPTUNvbXBvbmVudE1lc3NhZ2VIYW5kbGVyKCJydW50aW1lIiwgImdvLXRvLWxhc3QtZXJyb3Itc2NyaXB0Iiwgc2VsZlsiZ29Ub0xhc3RFcnJvclNjcmlwdCJdKTsKICAgICAgICAgICAgdGhpcy5BZGRET01Db21wb25lbnRNZXNzYWdlSGFuZGxlcigicnVudGltZSIsICJvZmZsaW5lLWF1ZGlvLXJlbmRlci1jb21wbGV0ZWQiLCBlID0+IHRoaXMuX09uT2ZmbGluZUF1ZGlvUmVuZGVyQ29tcGxldGVkKGUpKTsKICAgICAgICAgICAgdGhpcy5fZGlzcGF0Y2hlci5hZGRFdmVudExpc3RlbmVyKCJ3aW5kb3ctYmx1ciIsCiAgICAgICAgICAgICAgICBlID0+IHRoaXMuX09uV2luZG93Qmx1cihlKSk7CiAgICAgICAgICAgIHRoaXMuX2Rpc3BhdGNoZXIuYWRkRXZlbnRMaXN0ZW5lcigid2luZG93LWZvY3VzIiwgKCkgPT4gdGhpcy5fT25XaW5kb3dGb2N1cygpKTsKICAgICAgICAgICAgdGhpcy5fdGltZWxpbmVNYW5hZ2VyLkFkZFJ1bnRpbWVMaXN0ZW5lcnMoKTsKICAgICAgICAgICAgdGhpcy5fdGVtcGxhdGVNYW5hZ2VyLkFkZFJ1bnRpbWVMaXN0ZW5lcnMoKTsKICAgICAgICAgICAgdGhpcy5faVJ1bnRpbWUgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9pbnRlcmZhY2VNYXAgPSBuZXcgV2Vha01hcDsKICAgICAgICAgICAgdGhpcy5fY29tbW9uU2NyaXB0SW50ZXJmYWNlcyA9IHsKICAgICAgICAgICAgICAgIGtleWJvYXJkOiBudWxsLAogICAgICAgICAgICAgICAgbW91c2U6IG51bGwsCiAgICAgICAgICAgICAgICB0b3VjaDogbnVsbAogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHN0YXRpYyBDcmVhdGUob3B0cykgewogICAgICAgICAgICByZXR1cm4gQzMuTmV3KEMzLlJ1bnRpbWUsIG9wdHMpCiAgICAgICAgfQogICAgICAgIFJlbGVhc2UoKSB7CiAgICAgICAgICAgIEMzLmNsZWFyQXJyYXkodGhpcy5fYWxsT2JqZWN0Q2xhc3Nlcyk7CiAgICAgICAgICAgIHRoaXMuX29iamVjdENsYXNzZXNCeU5hbWUuY2xlYXIoKTsKICAgICAgICAgICAgdGhpcy5fb2JqZWN0Q2xhc3Nlc0J5U2lkLmNsZWFyKCk7CiAgICAgICAgICAgIHRoaXMuX2xheW91dE1hbmFnZXIuUmVsZWFzZSgpOwogICAgICAgICAgICB0aGlzLl9sYXlvdXRNYW5hZ2VyID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fZXZlbnRTaGVldE1hbmFnZXIuUmVsZWFzZSgpOwogICAgICAgICAgICB0aGlzLl9ldmVudFNoZWV0TWFuYWdlciA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3BsdWdpbk1hbmFnZXIuUmVsZWFzZSgpOwogICAgICAgICAgICB0aGlzLl9wbHVnaW5NYW5hZ2VyID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fYXNzZXRNYW5hZ2VyLlJlbGVhc2UoKTsKICAgICAgICAgICAgdGhpcy5fYXNzZXRNYW5hZ2VyID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fY29sbGlzaW9uRW5naW5lLlJlbGVhc2UoKTsKICAgICAgICAgICAgdGhpcy5fY29sbGlzaW9uRW5naW5lID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fdGltZWxpbmVNYW5hZ2VyLlJlbGVhc2UoKTsKICAgICAgICAgICAgdGhpcy5fdGltZWxpbmVNYW5hZ2VyID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fdHJhbnNpdGlvbk1hbmFnZXIuUmVsZWFzZSgpOwogICAgICAgICAgICB0aGlzLl90cmFuc2l0aW9uTWFuYWdlciA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3RlbXBsYXRlTWFuYWdlci5SZWxlYXNlKCk7CiAgICAgICAgICAgIHRoaXMuX3RlbXBsYXRlTWFuYWdlciA9IG51bGw7CiAgICAgICAgICAgIGlmICh0aGlzLl9jYW52YXNNYW5hZ2VyKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9jYW52YXNNYW5hZ2VyLlJlbGVhc2UoKTsKICAgICAgICAgICAgICAgIHRoaXMuX2NhbnZhc01hbmFnZXIgPQogICAgICAgICAgICAgICAgICAgIG51bGwKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLl9kaXNwYXRjaGVyLlJlbGVhc2UoKTsKICAgICAgICAgICAgdGhpcy5fZGlzcGF0Y2hlciA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3RpY2tFdmVudCA9IG51bGwKICAgICAgICB9WyJfT25NZXNzYWdlRnJvbURPTSJdKGRhdGEpIHsKICAgICAgICAgICAgY29uc3QgdHlwZSA9IGRhdGFbInR5cGUiXTsKICAgICAgICAgICAgaWYgKHR5cGUgPT09ICJldmVudCIpIHRoaXMuX09uRXZlbnRGcm9tRE9NKGRhdGEpOwogICAgICAgICAgICBlbHNlIGlmICh0eXBlID09PSAicmVzdWx0IikgdGhpcy5fT25SZXN1bHRGcm9tRE9NKGRhdGEpOwogICAgICAgICAgICBlbHNlIHRocm93IG5ldyBFcnJvcihgdW5rbm93biBtZXNzYWdlICcke3R5cGV9J2ApOwogICAgICAgIH0KICAgICAgICBfT25FdmVudEZyb21ET00oZSkgewogICAgICAgICAgICBpZiAoIXRoaXMuX2lzUmVhZHlUb0hhbmRsZUV2ZW50cykgewogICAgICAgICAgICAgICAgdGhpcy5fd2FpdGluZ1RvSGFuZGxlRXZlbnRzLnB1c2goZSk7CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBjb21wb25lbnQgPSBlWyJjb21wb25lbnQiXTsKICAgICAgICAgICAgY29uc3QgaGFuZGxlciA9IGVbImhhbmRsZXIiXTsKICAgICAgICAgICAgY29uc3QgZGF0YSA9IGVbImRhdGEiXTsKICAgICAgICAgICAgY29uc3QgZGlzcGF0Y2hPcHRzID0gZVsiZGlzcGF0Y2hPcHRzIl07CiAgICAgICAgICAgIGNvbnN0IGRpc3BhdGNoUnVudGltZUV2ZW50ID0gISEoZGlzcGF0Y2hPcHRzICYmIGRpc3BhdGNoT3B0c1siZGlzcGF0Y2hSdW50aW1lRXZlbnQiXSk7CiAgICAgICAgICAgIGNvbnN0IGRpc3BhdGNoVXNlclNjcmlwdEV2ZW50ID0gISEoZGlzcGF0Y2hPcHRzICYmIGRpc3BhdGNoT3B0c1siZGlzcGF0Y2hVc2VyU2NyaXB0RXZlbnQiXSk7CiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlSWQgPSBlWyJyZXNwb25zZUlkIl07CiAgICAgICAgICAgIGlmIChjb21wb25lbnQgPT09ICJydW50aW1lIikgewogICAgICAgICAgICAgICAgaWYgKGRpc3BhdGNoUnVudGltZUV2ZW50KSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZXZlbnQgPSBuZXcgQzMuRXZlbnQoaGFuZGxlcik7CiAgICAgICAgICAgICAgICAgICAgZXZlbnQuZGF0YSA9IGRhdGE7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZGlzcGF0Y2hlci5kaXNwYXRjaEV2ZW50QW5kV2FpdEFzeW5jU2VxdWVudGlhbChldmVudCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChkaXNwYXRjaFVzZXJTY3JpcHRFdmVudCkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGV2ZW50ID0gbmV3IEMzLkV2ZW50KGhhbmRsZXIsIHRydWUpOwogICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKGRhdGEpKSBldmVudFtrZXldID0gdmFsdWU7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5EaXNwYXRjaFVzZXJTY3JpcHRFdmVudChldmVudCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBoYW5kbGVyTWFwID0KICAgICAgICAgICAgICAgIHRoaXMuX2RvbUV2ZW50SGFuZGxlcnMuZ2V0KGNvbXBvbmVudCk7CiAgICAgICAgICAgIGlmICghaGFuZGxlck1hcCkgewogICAgICAgICAgICAgICAgaWYgKCFkaXNwYXRjaFJ1bnRpbWVFdmVudCAmJiAhZGlzcGF0Y2hVc2VyU2NyaXB0RXZlbnQpIGNvbnNvbGUud2FybihgW1J1bnRpbWVdIE5vIERPTSBldmVudCBoYW5kbGVycyBmb3IgY29tcG9uZW50ICcke2NvbXBvbmVudH0nYCk7CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBmdW5jID0gaGFuZGxlck1hcC5nZXQoaGFuZGxlcik7CiAgICAgICAgICAgIGlmICghZnVuYykgewogICAgICAgICAgICAgICAgaWYgKCFkaXNwYXRjaFJ1bnRpbWVFdmVudCAmJiAhZGlzcGF0Y2hVc2VyU2NyaXB0RXZlbnQpIGNvbnNvbGUud2FybihgW1J1bnRpbWVdIE5vIERPTSBoYW5kbGVyICcke2hhbmRsZXJ9JyBmb3IgY29tcG9uZW50ICcke2NvbXBvbmVudH0nYCk7CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBsZXQgcmV0ID0gbnVsbDsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHJldCA9IGZ1bmMoZGF0YSkKICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGBFeGNlcHRpb24gaW4gJyR7Y29tcG9uZW50fScgaGFuZGxlciAnJHtoYW5kbGVyfSc6YCwgZXJyKTsKICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZUlkICE9PQogICAgICAgICAgICAgICAgICAgIG51bGwpIHRoaXMuX1Bvc3RSZXN1bHRUb0RPTShyZXNwb25zZUlkLCBmYWxzZSwgIiIgKyBlcnIpOwogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHJlc3BvbnNlSWQgIT09IG51bGwpCiAgICAgICAgICAgICAgICBpZiAocmV0ICYmIHJldC50aGVuKSByZXQudGhlbihyZXN1bHQgPT4gdGhpcy5fUG9zdFJlc3VsdFRvRE9NKHJlc3BvbnNlSWQsIHRydWUsIHJlc3VsdCkpLmNhdGNoKGVyciA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihgUmVqZWN0aW9uIGZyb20gJyR7Y29tcG9uZW50fScgaGFuZGxlciAnJHtoYW5kbGVyfSc6YCwgZXJyKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9Qb3N0UmVzdWx0VG9ET00ocmVzcG9uc2VJZCwgZmFsc2UsICIiICsgZXJyKQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBlbHNlIHRoaXMuX1Bvc3RSZXN1bHRUb0RPTShyZXNwb25zZUlkLCB0cnVlLCByZXQpCiAgICAgICAgfQogICAgICAgIF9Qb3N0UmVzdWx0VG9ET00ocmVzcG9uc2VJZCwgaXNPaywgcmVzdWx0KSB7CiAgICAgICAgICAgIHRoaXMuX21lc3NhZ2VQb3J0LnBvc3RNZXNzYWdlKHsKICAgICAgICAgICAgICAgICJ0eXBlIjogInJlc3VsdCIsCiAgICAgICAgICAgICAgICAicmVzcG9uc2VJZCI6IHJlc3BvbnNlSWQsCiAgICAgICAgICAgICAgICAiaXNPayI6IGlzT2ssCiAgICAgICAgICAgICAgICAicmVzdWx0IjogcmVzdWx0CiAgICAgICAgICAgIH0pCiAgICAgICAgfQogICAgICAgIF9PblJlc3VsdEZyb21ET00oZGF0YSkgewogICAgICAgICAgICBjb25zdCByZXNwb25zZUlkID0KICAgICAgICAgICAgICAgIGRhdGFbInJlc3BvbnNlSWQiXTsKICAgICAgICAgICAgY29uc3QgaXNPayA9IGRhdGFbImlzT2siXTsKICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gZGF0YVsicmVzdWx0Il07CiAgICAgICAgICAgIGNvbnN0IHBlbmRpbmdQcm9taXNlID0gdGhpcy5fcGVuZGluZ1Jlc3BvbnNlUHJvbWlzZXMuZ2V0KHJlc3BvbnNlSWQpOwogICAgICAgICAgICBpZiAoaXNPaykgcGVuZGluZ1Byb21pc2UucmVzb2x2ZShyZXN1bHQpOwogICAgICAgICAgICBlbHNlIHBlbmRpbmdQcm9taXNlLnJlamVjdChyZXN1bHQpOwogICAgICAgICAgICB0aGlzLl9wZW5kaW5nUmVzcG9uc2VQcm9taXNlcy5kZWxldGUocmVzcG9uc2VJZCkKICAgICAgICB9CiAgICAgICAgQWRkRE9NQ29tcG9uZW50TWVzc2FnZUhhbmRsZXIoY29tcG9uZW50LCBoYW5kbGVyLCBmdW5jKSB7CiAgICAgICAgICAgIGxldCBoYW5kbGVyTWFwID0gdGhpcy5fZG9tRXZlbnRIYW5kbGVycy5nZXQoY29tcG9uZW50KTsKICAgICAgICAgICAgaWYgKCFoYW5kbGVyTWFwKSB7CiAgICAgICAgICAgICAgICBoYW5kbGVyTWFwID0gbmV3IE1hcDsKICAgICAgICAgICAgICAgIHRoaXMuX2RvbUV2ZW50SGFuZGxlcnMuc2V0KGNvbXBvbmVudCwgaGFuZGxlck1hcCkKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoaGFuZGxlck1hcC5oYXMoaGFuZGxlcikpIHRocm93IG5ldyBFcnJvcihgW1J1bnRpbWVdIENvbXBvbmVudCAnJHtjb21wb25lbnR9JyBhbHJlYWR5IGhhcyBoYW5kbGVyICcke2hhbmRsZXJ9J2ApOwogICAgICAgICAgICBoYW5kbGVyTWFwLnNldChoYW5kbGVyLCBmdW5jKQogICAgICAgIH0KICAgICAgICBQb3N0Q29tcG9uZW50TWVzc2FnZVRvRE9NKGNvbXBvbmVudCwgaGFuZGxlciwgZGF0YSwgdHJhbnNmZXIpIHsKICAgICAgICAgICAgdGhpcy5fbWVzc2FnZVBvcnQucG9zdE1lc3NhZ2UoewogICAgICAgICAgICAgICAgInR5cGUiOiAiZXZlbnQiLAogICAgICAgICAgICAgICAgImNvbXBvbmVudCI6IGNvbXBvbmVudCwKICAgICAgICAgICAgICAgICJoYW5kbGVyIjogaGFuZGxlciwKICAgICAgICAgICAgICAgICJkYXRhIjogZGF0YSwKICAgICAgICAgICAgICAgICJyZXNwb25zZUlkIjogbnVsbAogICAgICAgICAgICB9LCB0cmFuc2ZlcikKICAgICAgICB9CiAgICAgICAgUG9zdENvbXBvbmVudE1lc3NhZ2VUb0RPTUFzeW5jKGNvbXBvbmVudCwgaGFuZGxlciwgZGF0YSwgdHJhbnNmZXIpIHsKICAgICAgICAgICAgY29uc3QgcmVzcG9uc2VJZCA9IHRoaXMuX25leHREb21SZXNwb25zZUlkKys7CiAgICAgICAgICAgIGNvbnN0IHJldCA9IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKICAgICAgICAgICAgICAgIHRoaXMuX3BlbmRpbmdSZXNwb25zZVByb21pc2VzLnNldChyZXNwb25zZUlkLCB7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSwKICAgICAgICAgICAgICAgICAgICByZWplY3QKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0aGlzLl9tZXNzYWdlUG9ydC5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgICAgICAidHlwZSI6ICJldmVudCIsCiAgICAgICAgICAgICAgICAiY29tcG9uZW50IjogY29tcG9uZW50LAogICAgICAgICAgICAgICAgImhhbmRsZXIiOiBoYW5kbGVyLAogICAgICAgICAgICAgICAgImRhdGEiOiBkYXRhLAogICAgICAgICAgICAgICAgInJlc3BvbnNlSWQiOiByZXNwb25zZUlkCiAgICAgICAgICAgIH0sIHRyYW5zZmVyKTsKICAgICAgICAgICAgcmV0dXJuIHJldAogICAgICAgIH0KICAgICAgICBQb3N0VG9EZWJ1Z2dlcihkYXRhKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5Jc0RlYnVnKCkpIHRocm93IG5ldyBFcnJvcigibm90IGluIGRlYnVnIG1vZGUiKTsKICAgICAgICAgICAgdGhpcy5Qb3N0Q29tcG9uZW50TWVzc2FnZVRvRE9NKCJydW50aW1lIiwgInBvc3QtdG8tZGVidWdnZXIiLCBkYXRhKQogICAgICAgIH0KICAgICAgICBhc3luYyBJbml0KG9wdHMpIHsKICAgICAgICAgICAgaWYgKHRoaXMuSXNEZWJ1ZygpKSBhd2FpdCBDM0RlYnVnZ2VyLkluaXQodGhpcyk7CiAgICAgICAgICAgIGVsc2UgaWYgKHNlbGYuQzNEZWJ1Z2dlcikgc2VsZi5DM0RlYnVnZ2VyLkluaXRQcmV2aWV3KHRoaXMpOwogICAgICAgICAgICBjb25zdCBbb10gPSBhd2FpdCBQcm9taXNlLmFsbChbdGhpcy5fYXNzZXRNYW5hZ2VyLkZldGNoSnNvbigiZGF0YS5qc29uIiksIHRoaXMuX01heWJlTG9hZE9wdXNEZWNvZGVyKCksIHRoaXMuX2pvYlNjaGVkdWxlci5Jbml0KCldKTsKICAgICAgICAgICAgYXdhaXQgdGhpcy5fTG9hZERhdGFKc29uKG8pOwogICAgICAgICAgICBhd2FpdCB0aGlzLl9Jbml0aWFsaXNlQ2FudmFzKG9wdHMpOwogICAgICAgICAgICBpZiAoIXRoaXMuSXNQcmV2aWV3KCkpIGNvbnNvbGUuaW5mbygiTWFkZSB3aXRoIENvbnN0cnVjdCwgdGhlIGdhbWUgYW5kIGFwcCBjcmVhdG9yIDo6IGh0dHBzOi8vd3d3LmNvbnN0cnVjdC5uZXQiKTsKICAgICAgICAgICAgaWYgKHRoaXMuR2V0V2ViR0xSZW5kZXJlcigpKSB7CiAgICAgICAgICAgICAgICBjb25zdCB3ZWJnbFJlbmRlcmVyID0gdGhpcy5HZXRXZWJHTFJlbmRlcmVyKCk7CiAgICAgICAgICAgICAgICBjb25zb2xlLmluZm8oYFtDMyBydW50aW1lXSBIb3N0ZWQgaW4gJHt0aGlzLklzSW5Xb3JrZXIoKT8id29ya2VyIjoiRE9NIn0sIHJlbmRlcmluZyB3aXRoIFdlYkdMICR7d2ViZ2xSZW5kZXJlci5HZXRXZWJHTFZlcnNpb25OdW1iZXIoKX0gWyR7d2ViZ2xSZW5kZXJlci5HZXRVbm1hc2tlZFJlbmRlcmVyKCl9XSAoJHt3ZWJnbFJlbmRlcmVyLklzRGVzeW5jaHJvbml6ZWQoKT8iZGVzeW5jaHJvbml6ZWQiOiJzdGFuZGFyZCJ9IGNvbXBvc2l0aW5nKWApCiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5HZXRXZWJHUFVSZW5kZXJlcigpKSBjb25zb2xlLmluZm8oYFtDMyBydW50aW1lXSBIb3N0ZWQgaW4gJHt0aGlzLklzSW5Xb3JrZXIoKT8KIndvcmtlciI6IkRPTSJ9LCByZW5kZXJpbmcgd2l0aCBleHBlcmltZW50YWwgV2ViR1BVIFske3RoaXMuR2V0V2ViR1BVUmVuZGVyZXIoKS5HZXRCYXNpY0FkYXB0ZXJJbmZvU3RyaW5nKCl9XWApOwogICAgICAgICAgICBpZiAodGhpcy5HZXRSZW5kZXJlcigpLkhhc01ham9yUGVyZm9ybWFuY2VDYXZlYXQoKSkgY29uc29sZS53YXJuKCJbQzMgcnVudGltZV0gVGhlIHJlbmRlcmVyIGluZGljYXRlcyBhIG1ham9yIHBlcmZvcm1hbmNlIGNhdmVhdC4gU29mdHdhcmUgcmVuZGVyaW5nIG1heSBiZSBpbiB1c2UuIFRoaXMgY2FuIHJlc3VsdCBpbiBzaWduaWZpY2FudGx5IGRlZ3JhZGVkIHBlcmZvcm1hbmNlLiIpOwogICAgICAgICAgICB0aGlzLl9pc1JlYWR5VG9IYW5kbGVFdmVudHMgPSB0cnVlOwogICAgICAgICAgICBmb3IgKGNvbnN0IGUgb2YgdGhpcy5fd2FpdGluZ1RvSGFuZGxlRXZlbnRzKSB0aGlzLl9PbkV2ZW50RnJvbURPTShlKTsKICAgICAgICAgICAgQzMuY2xlYXJBcnJheSh0aGlzLl93YWl0aW5nVG9IYW5kbGVFdmVudHMpOwogICAgICAgICAgICBpZiAodGhpcy5fY2FudmFzTWFuYWdlcikgdGhpcy5fY2FudmFzTWFuYWdlci5TdGFydExvYWRpbmdTY3JlZW4oKTsKICAgICAgICAgICAgZm9yIChjb25zdCBmIG9mIG9wdHNbInJ1bk9uU3RhcnR1cEZ1bmN0aW9ucyJdKSB0aGlzLl9hZGRpdGlvbmFsTG9hZFByb21pc2VzLnB1c2godGhpcy5fUnVuT25TdGFydHVwRnVuY3Rpb24oZikpOwogICAgICAgICAgICBhd2FpdCBQcm9taXNlLmFsbChbdGhpcy5fYXNzZXRNYW5hZ2VyLldhaXRGb3JBbGxUb0xvYWQoKSwgLi4udGhpcy5fYWRkaXRpb25hbExvYWRQcm9taXNlc10pOwogICAgICAgICAgICBDMy5jbGVhckFycmF5KHRoaXMuX2FkZGl0aW9uYWxMb2FkUHJvbWlzZXMpOwogICAgICAgICAgICBpZiAodGhpcy5fYXNzZXRNYW5hZ2VyLkhhc0hhZEVycm9yTG9hZGluZygpKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fY2FudmFzTWFuYWdlcikgdGhpcy5fY2FudmFzTWFuYWdlci5IaWRlQ29yZG92YVNwbGFzaFNjcmVlbigpOwogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHRoaXMuX2NhbnZhc01hbmFnZXIpIGF3YWl0IHRoaXMuX2NhbnZhc01hbmFnZXIuRW5kTG9hZGluZ1NjcmVlbigpOwogICAgICAgICAgICBhd2FpdCB0aGlzLl9kaXNwYXRjaGVyLmRpc3BhdGNoRXZlbnRBbmRXYWl0QXN5bmMobmV3IEMzLkV2ZW50KCJiZWZvcmVydW50aW1lc3RhcnQiKSk7CiAgICAgICAgICAgIGF3YWl0IHRoaXMuU3RhcnQoKTsKICAgICAgICAgICAgdGhpcy5fbWVzc2FnZVBvcnQucG9zdE1lc3NhZ2UoewogICAgICAgICAgICAgICAgInR5cGUiOiAicnVudGltZS1yZWFkeSIKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiB0aGlzCiAgICAgICAgfQogICAgICAgIGFzeW5jIF9SdW5PblN0YXJ0dXBGdW5jdGlvbihmKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBhd2FpdCBmKHRoaXMuX2lSdW50aW1lKQogICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIltDMyBydW50aW1lXSBFcnJvciBpbiBydW5PblN0YXJ0dXAgZnVuY3Rpb246ICIsIGVycikKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBhc3luYyBfTG9hZERhdGFKc29uKG8pIHsKICAgICAgICAgICAgY29uc3QgcHJvamVjdERhdGEgPSBvWyJwcm9qZWN0Il07CiAgICAgICAgICAgIHRoaXMuX3Byb2plY3ROYW1lID0gcHJvamVjdERhdGFbMF07CiAgICAgICAgICAgIHRoaXMuX3Byb2plY3RWZXJzaW9uID0gcHJvamVjdERhdGFbMTZdOwogICAgICAgICAgICB0aGlzLl9wcm9qZWN0VW5pcXVlSWQgPSBwcm9qZWN0RGF0YVszMV07CiAgICAgICAgICAgIHRoaXMuX2FwcElkID0gcHJvamVjdERhdGFbMzhdOwogICAgICAgICAgICBjb25zdCBsb2FkaW5nTG9nb0ZpbGVuYW1lID0gcHJvamVjdERhdGFbMzldIHx8ICJsb2FkaW5nLWxvZ28ucG5nIjsKICAgICAgICAgICAgdGhpcy5faXNQaXhlbFJvdW5kaW5nRW5hYmxlZCA9ICEhcHJvamVjdERhdGFbOV07CiAgICAgICAgICAgIHRoaXMuX29yaWdpbmFsVmlld3BvcnRXaWR0aCA9IHRoaXMuX3ZpZXdwb3J0V2lkdGggPSBwcm9qZWN0RGF0YVsxMF07CiAgICAgICAgICAgIHRoaXMuX29yaWdpbmFsVmlld3BvcnRIZWlnaHQgPSB0aGlzLl92aWV3cG9ydEhlaWdodCA9IHByb2plY3REYXRhWzExXTsKICAgICAgICAgICAgdGhpcy5fcGFyYWxsYXhYb3JpZ2luID0gdGhpcy5fb3JpZ2luYWxWaWV3cG9ydFdpZHRoIC8gMjsKICAgICAgICAgICAgdGhpcy5fcGFyYWxsYXhZb3JpZ2luID0gdGhpcy5fb3JpZ2luYWxWaWV3cG9ydEhlaWdodCAvIDI7CiAgICAgICAgICAgIHRoaXMuX2NvbXBvc2l0aW5nTW9kZSA9IHByb2plY3REYXRhWzM2XTsKICAgICAgICAgICAgdGhpcy5fZnJhbWVyYXRlTW9kZSA9IHByb2plY3REYXRhWzM3XTsKICAgICAgICAgICAgaWYgKHRoaXMuX2NvbXBvc2l0aW5nTW9kZSA9PT0gImxvdy1sYXRlbmN5IiAmJiB0aGlzLklzQW5kcm9pZFdlYlZpZXcoKSAmJiBDMy5QbGF0Zm9ybS5Ccm93c2VyVmVyc2lvbk51bWJlciA8PSA3NykgewogICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCJbQzMgcnVudGltZV0gRGVzeW5jaHJvbml6ZWQgKGxvdy1sYXRlbmN5KSBjb21wb3NpdGluZyBpcyBlbmFibGVkLCBidXQgaXMgZGlzYWJsZWQgaW4gdGhlIEFuZHJvaWQgV2ViVmlldyA8PTc3IGR1ZSB0byBjcmJ1Zy5jb20vMTAwODg0Mi4gUmV2ZXJ0aW5nIHRvIHN5bmNocm9uaXplZCAoc3RhbmRhcmQpIGNvbXBvc2l0aW5nLiIpOwogICAgICAgICAgICAgICAgdGhpcy5fY29tcG9zaXRpbmdNb2RlID0gInN0YW5kYXJkIgogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuX3VzZXMzZEZlYXR1cmVzID0gISFwcm9qZWN0RGF0YVs0MF07CiAgICAgICAgICAgIHRoaXMuX3NhbXBsaW5nID0gcHJvamVjdERhdGFbMTRdOwogICAgICAgICAgICB0aGlzLl91c2VzQW55QmFja2dyb3VuZEJsZW5kaW5nID0gcHJvamVjdERhdGFbMTVdOwogICAgICAgICAgICB0aGlzLl91c2VzQW55Q3Jvc3NTYW1wbGluZyA9IHByb2plY3REYXRhWzQyXTsKICAgICAgICAgICAgdGhpcy5fdXNlc0FueURlcHRoU2FtcGxpbmcgPSBwcm9qZWN0RGF0YVsxN107CiAgICAgICAgICAgIHRoaXMuX3VzZXNMb2FkZXJMYXlvdXQgPSAhIXByb2plY3REYXRhWzE4XTsKICAgICAgICAgICAgdGhpcy5fbG9hZGVyU3R5bGUgPSBwcm9qZWN0RGF0YVsxOV07CiAgICAgICAgICAgIHRoaXMuX25leHRVaWQgPSBwcm9qZWN0RGF0YVsyMV07CiAgICAgICAgICAgIHRoaXMuX3BhdXNlT25CbHVyID0gcHJvamVjdERhdGFbMjJdOwogICAgICAgICAgICBjb25zdCBhc3NldE1hbmFnZXIgPSB0aGlzLl9hc3NldE1hbmFnZXI7CiAgICAgICAgICAgIGFzc2V0TWFuYWdlci5fU2V0RmlsZVN0cnVjdHVyZShwcm9qZWN0RGF0YVs0NV0pOwogICAgICAgICAgICBhc3NldE1hbmFnZXIuX1NldEF1ZGlvRmlsZXMocHJvamVjdERhdGFbN10sCiAgICAgICAgICAgICAgICBwcm9qZWN0RGF0YVsyNV0pOwogICAgICAgICAgICBhc3NldE1hbmFnZXIuX1NldE1lZGlhU3ViZm9sZGVyKHByb2plY3REYXRhWzhdKTsKICAgICAgICAgICAgYXNzZXRNYW5hZ2VyLl9TZXRGb250c1N1YmZvbGRlcihwcm9qZWN0RGF0YVszMl0pOwogICAgICAgICAgICBhc3NldE1hbmFnZXIuX1NldEljb25zU3ViZm9sZGVyKHByb2plY3REYXRhWzI4XSk7CiAgICAgICAgICAgIGFzc2V0TWFuYWdlci5fU2V0V2ViRm9udHMocHJvamVjdERhdGFbMjldKTsKICAgICAgICAgICAgaWYgKHRoaXMuX2xvYWRlclN0eWxlID09PSAwKSB7CiAgICAgICAgICAgICAgICBsZXQgdXJsID0gIiI7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5Jc1ByZXZpZXcoKSkgewogICAgICAgICAgICAgICAgICAgIGlmIChhc3NldE1hbmFnZXIuX0hhc0xvY2FsVXJsQmxvYihsb2FkaW5nTG9nb0ZpbGVuYW1lKSkgdXJsID0gYXNzZXRNYW5hZ2VyLkdldExvY2FsVXJsQXNCbG9iVXJsKGxvYWRpbmdMb2dvRmlsZW5hbWUpCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFzc2V0TWFuYWdlci5HZXRGaWxlU3RydWN0dXJlKCkgPT09ICJmbGF0IikgdXJsID0gYXNzZXRNYW5hZ2VyLkdldEljb25zU3ViZm9sZGVyKCkgKyBsb2FkaW5nTG9nb0ZpbGVuYW1lOwogICAgICAgICAgICAgICAgZWxzZSB1cmwgPSBsb2FkaW5nTG9nb0ZpbGVuYW1lOwogICAgICAgICAgICAgICAgaWYgKHVybCkgdGhpcy5fbG9hZGluZ0xvZ29Bc3NldCA9IGFzc2V0TWFuYWdlci5Mb2FkSW1hZ2UoewogICAgICAgICAgICAgICAgICAgIHVybAogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGhpcy5fY2FudmFzTWFuYWdlcikgewogICAgICAgICAgICAgICAgdGhpcy5fY2FudmFzTWFuYWdlci5TZXRGdWxsc2NyZWVuTW9kZShDMy5DYW52YXNNYW5hZ2VyLl9GdWxsc2NyZWVuTW9kZU51bWJlclRvU3RyaW5nKHByb2plY3REYXRhWzEyXSkpOwogICAgICAgICAgICAgICAgdGhpcy5fY2FudmFzTWFuYWdlci5TZXRGdWxsc2NyZWVuU2NhbGluZ1F1YWxpdHkocHJvamVjdERhdGFbMjNdID8gImhpZ2giIDogImxvdyIpOwogICAgICAgICAgICAgICAgdGhpcy5fY2FudmFzTWFuYWdlci5TZXRNaXBtYXBzRW5hYmxlZChwcm9qZWN0RGF0YVsyNF0gIT09IDApOwogICAgICAgICAgICAgICAgdGhpcy5fY2FudmFzTWFuYWdlci5fU2V0R1BVUG93ZXJQcmVmZXJlbmNlKHByb2plY3REYXRhWzM0XSk7CiAgICAgICAgICAgICAgICB0aGlzLl9jYW52YXNNYW5hZ2VyLl9TZXRUZXh0dXJlQW5pc290cm9weShwcm9qZWN0RGF0YVs0MV0pOwogICAgICAgICAgICAgICAgdGhpcy5fY2FudmFzTWFuYWdlci5fU2V0V2ViR1BVRW5hYmxlZChwcm9qZWN0RGF0YVsxM10pOwogICAgICAgICAgICAgICAgdGhpcy5fY2FudmFzTWFuYWdlci5fU2V0WkF4aXNTY2FsZShwcm9qZWN0RGF0YVszMF0pOwogICAgICAgICAgICAgICAgdGhpcy5fY2FudmFzTWFuYWdlci5fU2V0WkRpc3RhbmNlcyhwcm9qZWN0RGF0YVs0Nl0sIHByb2plY3REYXRhWzQ3XSk7CiAgICAgICAgICAgICAgICB0aGlzLl9jYW52YXNNYW5hZ2VyLl9TZXRGaWVsZE9mVmlldyhwcm9qZWN0RGF0YVsyNl0pOwogICAgICAgICAgICAgICAgdGhpcy5fY2FudmFzTWFuYWdlci5fU2V0TGltaXRlZFRvV2ViR0wxKHByb2plY3REYXRhWzQ4XSkKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBleHBvcnRUb1ZpZGVvT3B0cyA9IHByb2plY3REYXRhWzQzXTsKICAgICAgICAgICAgaWYgKGV4cG9ydFRvVmlkZW9PcHRzKSBhd2FpdCB0aGlzLl9Mb2FkRXhwb3J0VG9WaWRlb0RhdGEoZXhwb3J0VG9WaWRlb09wdHMpOwogICAgICAgICAgICB0aGlzLl9wbHVnaW5NYW5hZ2VyLkNyZWF0ZVN5c3RlbVBsdWdpbigpOwogICAgICAgICAgICB0aGlzLl9vYmplY3RSZWZlcmVuY2VUYWJsZSA9IHNlbGYuQzNfR2V0T2JqZWN0UmVmVGFibGUoKTsKICAgICAgICAgICAgZm9yIChjb25zdCBwbHVnaW5EYXRhIG9mIHByb2plY3REYXRhWzJdKSB0aGlzLl9wbHVnaW5NYW5hZ2VyLkNyZWF0ZVBsdWdpbihwbHVnaW5EYXRhKTsKICAgICAgICAgICAgdGhpcy5fb2JqZWN0UmVmZXJlbmNlVGFibGUgPSBzZWxmLkMzX0dldE9iamVjdFJlZlRhYmxlKCk7CiAgICAgICAgICAgIHRoaXMuX0xvYWRKc1Byb3BOYW1lVGFibGUoKTsKICAgICAgICAgICAgZm9yIChjb25zdCBvYmplY3RDbGFzc0RhdGEgb2YgcHJvamVjdERhdGFbM10pIHsKICAgICAgICAgICAgICAgIGNvbnN0IG9iamVjdENsYXNzID0gQzMuT2JqZWN0Q2xhc3MuQ3JlYXRlKHRoaXMsIHRoaXMuX2FsbE9iamVjdENsYXNzZXMubGVuZ3RoLCBvYmplY3RDbGFzc0RhdGEpOwogICAgICAgICAgICAgICAgdGhpcy5fYWxsT2JqZWN0Q2xhc3Nlcy5wdXNoKG9iamVjdENsYXNzKTsKICAgICAgICAgICAgICAgIHRoaXMuX29iamVjdENsYXNzZXNCeU5hbWUuc2V0KG9iamVjdENsYXNzLkdldE5hbWUoKS50b0xvd2VyQ2FzZSgpLCBvYmplY3RDbGFzcyk7CiAgICAgICAgICAgICAgICB0aGlzLl9vYmplY3RDbGFzc2VzQnlTaWQuc2V0KG9iamVjdENsYXNzLkdldFNJRCgpLCBvYmplY3RDbGFzcykKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IgKGNvbnN0IGZhbWlseURhdGEgb2YgcHJvamVjdERhdGFbNF0pIHsKICAgICAgICAgICAgICAgIGNvbnN0IGZhbWlseVR5cGUgPSB0aGlzLl9hbGxPYmplY3RDbGFzc2VzW2ZhbWlseURhdGFbMF1dOwogICAgICAgICAgICAgICAgZmFtaWx5VHlwZS5fTG9hZEZhbWlseShmYW1pbHlEYXRhKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciAoY29uc3QgY29udGFpbmVyRGF0YSBvZiBwcm9qZWN0RGF0YVsyN10pIHsKICAgICAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5lclR5cGVzID0KICAgICAgICAgICAgICAgICAgICBjb250YWluZXJEYXRhLm1hcChpbmRleCA9PiB0aGlzLl9hbGxPYmplY3RDbGFzc2VzW2luZGV4XSk7CiAgICAgICAgICAgICAgICB0aGlzLl9hbGxDb250YWluZXJzLnB1c2goQzMuTmV3KEMzLkNvbnRhaW5lciwgdGhpcywgY29udGFpbmVyVHlwZXMpKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciAoY29uc3Qgb2JqZWN0Q2xhc3Mgb2YgdGhpcy5fYWxsT2JqZWN0Q2xhc3Nlcykgb2JqZWN0Q2xhc3MuX09uQWZ0ZXJDcmVhdGUoKTsKICAgICAgICAgICAgZm9yIChjb25zdCBsYXlvdXREYXRhIG9mIHByb2plY3REYXRhWzVdKSB0aGlzLl9sYXlvdXRNYW5hZ2VyLkNyZWF0ZShsYXlvdXREYXRhKTsKICAgICAgICAgICAgY29uc3QgZmlyc3RMYXlvdXROYW1lID0gcHJvamVjdERhdGFbMV07CiAgICAgICAgICAgIGlmIChmaXJzdExheW91dE5hbWUpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGZpcnN0TGF5b3V0ID0gdGhpcy5fbGF5b3V0TWFuYWdlci5HZXRMYXlvdXRCeU5hbWUoZmlyc3RMYXlvdXROYW1lKTsKICAgICAgICAgICAgICAgIGlmIChmaXJzdExheW91dCkgdGhpcy5fbGF5b3V0TWFuYWdlci5TZXRGaXJzdExheW91dChmaXJzdExheW91dCkKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IgKGNvbnN0IHRpbWVsaW5lRGF0YSBvZiBwcm9qZWN0RGF0YVszM10pIHRoaXMuX3RpbWVsaW5lTWFuYWdlci5DcmVhdGUodGltZWxpbmVEYXRhKTsKICAgICAgICAgICAgZm9yIChjb25zdCB0cmFuc2l0aW9uRGF0YSBvZiBwcm9qZWN0RGF0YVszNV0pIHRoaXMuX3RyYW5zaXRpb25NYW5hZ2VyLkNyZWF0ZSh0cmFuc2l0aW9uRGF0YSk7CiAgICAgICAgICAgIGZvciAoY29uc3QgdGVtcGxhdGVJbnN0YW5jZURhdGEgb2YgcHJvamVjdERhdGFbNDRdKSB0aGlzLl90ZW1wbGF0ZU1hbmFnZXIuQ3JlYXRlKHRlbXBsYXRlSW5zdGFuY2VEYXRhKTsKICAgICAgICAgICAgaWYgKCF0aGlzLl90ZW1wbGF0ZU1hbmFnZXIuSGFzVGVtcGxhdGVzKCkpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3RlbXBsYXRlTWFuYWdlci5SZWxlYXNlKCk7CiAgICAgICAgICAgICAgICB0aGlzLl90ZW1wbGF0ZU1hbmFnZXIgPSBudWxsCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5fSW5pdFNjcmlwdEludGVyZmFjZXMoKTsKICAgICAgICAgICAgZm9yIChjb25zdCBldmVudFNoZWV0RGF0YSBvZiBwcm9qZWN0RGF0YVs2XSkgdGhpcy5fZXZlbnRTaGVldE1hbmFnZXIuQ3JlYXRlKGV2ZW50U2hlZXREYXRhKTsKICAgICAgICAgICAgdGhpcy5fZXZlbnRTaGVldE1hbmFnZXIuX1Bvc3RJbml0KCk7CiAgICAgICAgICAgIHRoaXMuX0luaXRHbG9iYWxWYXJpYWJsZVNjcmlwdEludGVyZmFjZSgpOwogICAgICAgICAgICBDMy5jbGVhckFycmF5KHRoaXMuX29iamVjdFJlZmVyZW5jZVRhYmxlKTsKICAgICAgICAgICAgdGhpcy5GbHVzaFBlbmRpbmdJbnN0YW5jZXMoKTsKICAgICAgICAgICAgbGV0IHRhcmdldE9yaWVudGF0aW9uID0gImFueSI7CiAgICAgICAgICAgIGNvbnN0IG9yaWVudGF0aW9ucyA9IHByb2plY3REYXRhWzIwXTsKICAgICAgICAgICAgaWYgKG9yaWVudGF0aW9ucyA9PT0gMSkgdGFyZ2V0T3JpZW50YXRpb24gPSAicG9ydHJhaXQiOwogICAgICAgICAgICBlbHNlIGlmIChvcmllbnRhdGlvbnMgPT09IDIpIHRhcmdldE9yaWVudGF0aW9uID0gImxhbmRzY2FwZSI7CiAgICAgICAgICAgIHRoaXMuUG9zdENvbXBvbmVudE1lc3NhZ2VUb0RPTSgicnVudGltZSIsICJzZXQtdGFyZ2V0LW9yaWVudGF0aW9uIiwgewogICAgICAgICAgICAgICAgInRhcmdldE9yaWVudGF0aW9uIjogdGFyZ2V0T3JpZW50YXRpb24KICAgICAgICAgICAgfSkKICAgICAgICB9CiAgICAgICAgYXN5bmMgX0xvYWRFeHBvcnRUb1ZpZGVvRGF0YShleHBvcnRUb1ZpZGVvT3B0cykgewogICAgICAgICAgICBjb25zdCBmb3JtYXQgPSBleHBvcnRUb1ZpZGVvT3B0c1siZm9ybWF0Il07CiAgICAgICAgICAgIGlmIChmb3JtYXQgPT09ICJpbWFnZS1zZXF1ZW5jZSIpIHRoaXMuX2V4cG9ydFRvVmlkZW8gPSBuZXcgc2VsZi5DM0V4cG9ydFRvSW1hZ2VTZXF1ZW5jZSh0aGlzLCBleHBvcnRUb1ZpZGVvT3B0cyk7CiAgICAgICAgICAgIGVsc2UgaWYgKGZvcm1hdCA9PT0KICAgICAgICAgICAgICAgICJpbWFnZS1zZXF1ZW5jZS1naWYiKSB0aGlzLl9leHBvcnRUb1ZpZGVvID0gbmV3IHNlbGYuQzNFeHBvcnRUb0dJRih0aGlzLCBleHBvcnRUb1ZpZGVvT3B0cyk7CiAgICAgICAgICAgIGVsc2UgaWYgKGZvcm1hdCA9PT0gIndlYm0iKSB0aGlzLl9leHBvcnRUb1ZpZGVvID0gbmV3IHNlbGYuQzNFeHBvcnRUb1dlYk1WaWRlbyh0aGlzLCBleHBvcnRUb1ZpZGVvT3B0cyk7CiAgICAgICAgICAgIGVsc2UgaWYgKGZvcm1hdCA9PT0gIm1wNCIpIHRoaXMuX2V4cG9ydFRvVmlkZW8gPSBuZXcgc2VsZi5DM0V4cG9ydFRvTVA0VmlkZW8odGhpcywgZXhwb3J0VG9WaWRlb09wdHMpOwogICAgICAgICAgICBlbHNlOwogICAgICAgICAgICB0aGlzLl9mcmFtZXJhdGVNb2RlID0gInVubGltaXRlZC1mcmFtZSI7CiAgICAgICAgICAgIHRoaXMuX2NhbnZhc01hbmFnZXIuU2V0RnVsbHNjcmVlbk1vZGUoIm9mZiIpOwogICAgICAgICAgICB0aGlzLl9kZXZpY2VQaXhlbFJhdGlvID0gMTsKICAgICAgICAgICAgc2VsZi5kZXZpY2VQaXhlbFJhdGlvID0gMTsKICAgICAgICAgICAgYXdhaXQgdGhpcy5Qb3N0Q29tcG9uZW50TWVzc2FnZVRvRE9NQXN5bmMoInJ1bnRpbWUiLCAic2V0LWV4cG9ydGluZy10by12aWRlbyIsIHsKICAgICAgICAgICAgICAgICJtZXNzYWdlIjogdGhpcy5fZXhwb3J0VG9WaWRlby5HZXRFeHBvcnRpbmdNZXNzYWdlRm9yUGVyY2VudCgwKSwKICAgICAgICAgICAgICAgICJkdXJhdGlvbiI6IHRoaXMuX2V4cG9ydFRvVmlkZW8uR2V0RHVyYXRpb24oKQogICAgICAgICAgICB9KQogICAgICAgIH0KICAgICAgICBHZXRMb2FkZXJTdHlsZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2xvYWRlclN0eWxlCiAgICAgICAgfQogICAgICAgIElzRXhwb3J0VG9WaWRlbygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2V4cG9ydFRvVmlkZW8gIT09IG51bGwKICAgICAgICB9CiAgICAgICAgR2V0RXhwb3J0VmlkZW9EdXJhdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2V4cG9ydFRvVmlkZW8uR2V0RHVyYXRpb24oKQogICAgICAgIH0KICAgICAgICBHZXRFeHBvcnRWaWRlb0ZyYW1lcmF0ZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2V4cG9ydFRvVmlkZW8uR2V0RnJhbWVyYXRlKCkKICAgICAgICB9CiAgICAgICAgX0luaXRFeHBvcnRUb1ZpZGVvKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZXhwb3J0VG9WaWRlby5Jbml0KHsKICAgICAgICAgICAgICAgIHdpZHRoOiB0aGlzLl9jYW52YXNNYW5hZ2VyLkdldERldmljZVdpZHRoKCksCiAgICAgICAgICAgICAgICBoZWlnaHQ6IHRoaXMuX2NhbnZhc01hbmFnZXIuR2V0RGV2aWNlSGVpZ2h0KCkKICAgICAgICAgICAgfSkKICAgICAgICB9CiAgICAgICAgX0V4cG9ydFRvVmlkZW9BZGRGcmFtZSgpIHsKICAgICAgICAgICAgY29uc3QgdGltZSA9IHRoaXMuX3RpY2tDb3VudCAvIHRoaXMuR2V0RXhwb3J0VmlkZW9GcmFtZXJhdGUoKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2V4cG9ydFRvVmlkZW8uQWRkRnJhbWUodGhpcy5fY2FudmFzTWFuYWdlci5HZXRDYW52YXMoKSwgdGltZSkKICAgICAgICB9CiAgICAgICAgX0V4cG9ydFRvVmlkZW9BZGRLZXlmcmFtZSgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX2V4cG9ydFRvVmlkZW8pIHRoaXMuX2V4cG9ydFRvVmlkZW8uQWRkS2V5ZnJhbWUoKQogICAgICAgIH0KICAgICAgICBfT25PZmZsaW5lQXVkaW9SZW5kZXJDb21wbGV0ZWQoZSkgewogICAgICAgICAgICB0aGlzLl9leHBvcnRUb1ZpZGVvLk9uT2ZmbGluZUF1ZGlvUmVuZGVyQ29tcGxldGVkKGUpCiAgICAgICAgfQogICAgICAgIF9FeHBvcnRUb1ZpZGVvRmluaXNoKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZXhwb3J0VG9WaWRlby5GaW5pc2goKQogICAgICAgIH0KICAgICAgICBJc0ZCSW5zdGFudEF2YWlsYWJsZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2lzRkJJbnN0YW50QXZhaWxhYmxlCiAgICAgICAgfQogICAgICAgIElzTG9hZGluZygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2lzTG9hZGluZwogICAgICAgIH0KICAgICAgICBBZGRMb2FkUHJvbWlzZShwcm9taXNlKSB7CiAgICAgICAgICAgIHRoaXMuX2FkZGl0aW9uYWxMb2FkUHJvbWlzZXMucHVzaChwcm9taXNlKQogICAgICAgIH0KICAgICAgICBTZXRVc2luZ0NyZWF0ZVByb21pc2VzKGUpIHsKICAgICAgICAgICAgdGhpcy5faXNVc2luZ0NyZWF0ZVByb21pc2VzID0gISFlCiAgICAgICAgfQogICAgICAgIEFkZENyZWF0ZVByb21pc2UocHJvbWlzZSkgewogICAgICAgICAgICBpZiAoIXRoaXMuX2lzVXNpbmdDcmVhdGVQcm9taXNlcykgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl9hZGRpdGlvbmFsQ3JlYXRlUHJvbWlzZXMucHVzaChwcm9taXNlKQogICAgICAgIH0KICAgICAgICBHZXRDcmVhdGVQcm9taXNlcygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2FkZGl0aW9uYWxDcmVhdGVQcm9taXNlcwogICAgICAgIH0KICAgICAgICBfR2V0TmV4dEZhbWlseUluZGV4KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZmFtaWx5Q291bnQrKwogICAgICAgIH0KICAgICAgICBHZXRGYW1pbHlDb3VudCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2ZhbWlseUNvdW50CiAgICAgICAgfQogICAgICAgIF9BZGRFZmZlY3RMaXN0KGVsKSB7CiAgICAgICAgICAgIHRoaXMuX2FsbEVmZmVjdExpc3RzLnB1c2goZWwpCiAgICAgICAgfQogICAgICAgIF9HZXRBbGxFZmZlY3RMaXN0cygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2FsbEVmZmVjdExpc3RzCiAgICAgICAgfQogICAgICAgIGFzeW5jIF9Jbml0aWFsaXNlQ2FudmFzKG9wdHMpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLl9jYW52YXNNYW5hZ2VyKSByZXR1cm47CiAgICAgICAgICAgIGF3YWl0IHRoaXMuX2NhbnZhc01hbmFnZXIuQ3JlYXRlQ2FudmFzKG9wdHMpOwogICAgICAgICAgICB0aGlzLl9jYW52YXNNYW5hZ2VyLkluaXRMb2FkaW5nU2NyZWVuKHRoaXMuX2xvYWRlclN0eWxlKQogICAgICAgIH0KICAgICAgICBhc3luYyBfTWF5YmVMb2FkT3B1c0RlY29kZXIoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9hc3NldE1hbmFnZXIuSXNBdWRpb0Zvcm1hdFN1cHBvcnRlZCgiYXVkaW8vd2VibTsgY29kZWNzPW9wdXMiKSkgcmV0dXJuOwogICAgICAgICAgICBsZXQgd2FzbUJsb2IgPSBudWxsOwogICAgICAgICAgICBsZXQgd2FzbUJ1ZmZlciA9IG51bGw7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5Jc2lPU0NvcmRvdmEoKSAmJiB0aGlzLl9hc3NldE1hbmFnZXIuSXNGaWxlUHJvdG9jb2woKSkgd2FzbUJ1ZmZlciA9IGF3YWl0IHRoaXMuX2Fzc2V0TWFuYWdlci5Db3Jkb3ZhRmV0Y2hMb2NhbEZpbGVBc0FycmF5QnVmZmVyKHRoaXMuX29wdXNXYXNtQmluYXJ5VXJsKTsKICAgICAgICAgICAgICAgIGVsc2Ugd2FzbUJ1ZmZlciA9IGF3YWl0IHRoaXMuX2Fzc2V0TWFuYWdlci5GZXRjaEFycmF5QnVmZmVyKHRoaXMuX29wdXNXYXNtQmluYXJ5VXJsKQogICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuaW5mbygiRmFpbGVkIHRvIGZldGNoIE9wdXMgZGVjb2RlciBXQVNNOyBhc3N1bWluZyBwcm9qZWN0IGhhcyBubyBPcHVzIGF1ZGlvLiIsIGVycik7CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAod2FzbUJ1ZmZlcikgdGhpcy5BZGRKb2JXb3JrZXJCdWZmZXIod2FzbUJ1ZmZlciwgIm9wdXMtZGVjb2Rlci13YXNtIik7CiAgICAgICAgICAgIGVsc2UgdGhpcy5BZGRKb2JXb3JrZXJCbG9iKHdhc21CbG9iLCAib3B1cy1kZWNvZGVyLXdhc20iKTsKICAgICAgICAgICAgYXdhaXQgdGhpcy5BZGRKb2JXb3JrZXJTY3JpcHRzKFt0aGlzLl9vcHVzV2FzbVNjcmlwdFVybF0pCiAgICAgICAgfQogICAgICAgIGFzeW5jIF9XYXNtRGVjb2RlV2ViTU9wdXMoYXJyYXlCdWZmZXIpIHsKICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5BZGRKb2IoIk9wdXNEZWNvZGUiLCB7CiAgICAgICAgICAgICAgICAiYXJyYXlCdWZmZXIiOiBhcnJheUJ1ZmZlcgogICAgICAgICAgICB9LCBbYXJyYXlCdWZmZXJdKTsKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdAogICAgICAgIH0KICAgICAgICBhc3luYyBTdGFydCgpIHsKICAgICAgICAgICAgdGhpcy5faGFzU3RhcnRlZCA9IHRydWU7CiAgICAgICAgICAgIHRoaXMuX3N0YXJ0VGltZSA9IERhdGUubm93KCk7CiAgICAgICAgICAgIGlmICh0aGlzLl91c2VzTG9hZGVyTGF5b3V0KSB7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IG9iamVjdENsYXNzIG9mIHRoaXMuX2FsbE9iamVjdENsYXNzZXMpCiAgICAgICAgICAgICAgICAgICAgaWYgKCFvYmplY3RDbGFzcy5Jc0ZhbWlseSgpICYmICFvYmplY3RDbGFzcy5Jc09uTG9hZGVyTGF5b3V0KCkgJiYgb2JqZWN0Q2xhc3MuSXNXb3JsZFR5cGUoKSkgb2JqZWN0Q2xhc3MuT25DcmVhdGUoKTsKICAgICAgICAgICAgICAgIHRoaXMuX2Fzc2V0TWFuYWdlci5XYWl0Rm9yQWxsVG9Mb2FkKCkudGhlbigoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5faXNMb2FkaW5nID0KICAgICAgICAgICAgICAgICAgICAgICAgZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fT25Mb2FkRmluaXNoZWQoKQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSBlbHNlIHRoaXMuX2lzTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl9hc3NldE1hbmFnZXIuU2V0SW5pdGlhbExvYWRGaW5pc2hlZCgpOwogICAgICAgICAgICBpZiAodGhpcy5Jc0RlYnVnKCkpIEMzRGVidWdnZXIuUnVudGltZUluaXQoaWZlKTsKICAgICAgICAgICAgZm9yIChjb25zdCBsYXlvdXQgb2YgdGhpcy5fbGF5b3V0TWFuYWdlci5HZXRBbGxMYXlvdXRzKCkpIGxheW91dC5fQ3JlYXRlR2xvYmFsTm9uV29ybGRzKCk7CiAgICAgICAgICAgIGlmICh0aGlzLklzRXhwb3J0VG9WaWRlbygpKSBhd2FpdCB0aGlzLl9Jbml0RXhwb3J0VG9WaWRlbygpOwogICAgICAgICAgICBjb25zdCBmaXJzdExheW91dCA9IHRoaXMuX2xheW91dE1hbmFnZXIuR2V0Rmlyc3RMYXlvdXQoKTsKICAgICAgICAgICAgYXdhaXQgZmlyc3RMYXlvdXQuX0xvYWQobnVsbCwgdGhpcy5HZXRSZW5kZXJlcigpKTsKICAgICAgICAgICAgYXdhaXQgZmlyc3RMYXlvdXQuX1N0YXJ0UnVubmluZyh0cnVlKTsKICAgICAgICAgICAgdGhpcy5fZnBzTGFzdFRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKTsKICAgICAgICAgICAgaWYgKCF0aGlzLl91c2VzTG9hZGVyTGF5b3V0KSB0aGlzLl9PbkxvYWRGaW5pc2hlZCgpOwogICAgICAgICAgICBjb25zdCBzdGF0ZSA9IGF3YWl0IHRoaXMuUG9zdENvbXBvbmVudE1lc3NhZ2VUb0RPTUFzeW5jKCJydW50aW1lIiwgImJlZm9yZS1zdGFydC10aWNraW5nIik7CiAgICAgICAgICAgIGlmIChzdGF0ZVsiaXNTdXNwZW5kZWQiXSAmJiAhdGhpcy5Jc0V4cG9ydFRvVmlkZW8oKSkgdGhpcy5fc3VzcGVuZENvdW50Kys7CiAgICAgICAgICAgIGVsc2UgdGhpcy5UaWNrKCkKICAgICAgICB9CiAgICAgICAgX09uTG9hZEZpbmlzaGVkKCkgewogICAgICAgICAgICB0aGlzLlRyaWdnZXIoQzMuUGx1Z2lucy5TeXN0ZW0uQ25kcy5PbkxvYWRGaW5pc2hlZCwgbnVsbCwgbnVsbCk7CiAgICAgICAgICAgIHRoaXMuUG9zdENvbXBvbmVudE1lc3NhZ2VUb0RPTSgicnVudGltZSIsICJyZWdpc3Rlci1zdyIpCiAgICAgICAgfQogICAgICAgIEdldE9iamVjdFJlZmVyZW5jZShpbmRleCkgewogICAgICAgICAgICBpbmRleCA9IE1hdGguZmxvb3IoaW5kZXgpOwogICAgICAgICAgICBjb25zdCBvYmpSZWZUYWJsZSA9IHRoaXMuX29iamVjdFJlZmVyZW5jZVRhYmxlOwogICAgICAgICAgICBpZiAoaW5kZXggPCAwIHx8IGluZGV4ID49IG9ialJlZlRhYmxlLmxlbmd0aCkgdGhyb3cgbmV3IEVycm9yKCJpbnZhbGlkIG9iamVjdCByZWZlcmVuY2UiKTsKICAgICAgICAgICAgcmV0dXJuIG9ialJlZlRhYmxlW2luZGV4XQogICAgICAgIH0KICAgICAgICBfTG9hZEpzUHJvcE5hbWVUYWJsZSgpIHsKICAgICAgICAgICAgZm9yIChjb25zdCBlbnRyeSBvZiBzZWxmLkMzX0pzUHJvcE5hbWVUYWJsZSkgewogICAgICAgICAgICAgICAgY29uc3QgcHJvcE5hbWUgPQogICAgICAgICAgICAgICAgICAgIEMzLmZpcnN0KE9iamVjdC5rZXlzKGVudHJ5KSk7CiAgICAgICAgICAgICAgICB0aGlzLl9qc1Byb3BOYW1lVGFibGUucHVzaChwcm9wTmFtZSkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBHZXRKc1Byb3BOYW1lKGluZGV4KSB7CiAgICAgICAgICAgIGluZGV4ID0gTWF0aC5mbG9vcihpbmRleCk7CiAgICAgICAgICAgIGNvbnN0IGpzUHJvcE5hbWVUYWJsZSA9IHRoaXMuX2pzUHJvcE5hbWVUYWJsZTsKICAgICAgICAgICAgaWYgKGluZGV4IDwgMCB8fCBpbmRleCA+PSBqc1Byb3BOYW1lVGFibGUubGVuZ3RoKSB0aHJvdyBuZXcgRXJyb3IoImludmFsaWQgcHJvcCByZWZlcmVuY2UiKTsKICAgICAgICAgICAgcmV0dXJuIGpzUHJvcE5hbWVUYWJsZVtpbmRleF0KICAgICAgICB9CiAgICAgICAgSGFzRE9NKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faGFzRG9tCiAgICAgICAgfQogICAgICAgIElzSGVhZGxlc3MoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pc0hlYWRsZXNzCiAgICAgICAgfQogICAgICAgIElzSW5Xb3JrZXIoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pc0luV29ya2VyCiAgICAgICAgfQogICAgICAgIEdldFJ1bnRpbWVCYXNlVVJMKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fcnVudGltZUJhc2VVcmwKICAgICAgICB9CiAgICAgICAgR2V0UHJldmlld1VSTCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3ByZXZpZXdVcmwKICAgICAgICB9CiAgICAgICAgR2V0RXZlbnRTaGVldE1hbmFnZXIoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9ldmVudFNoZWV0TWFuYWdlcgogICAgICAgIH0KICAgICAgICBHZXRFdmVudFN0YWNrKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZXZlbnRTaGVldE1hbmFnZXIuR2V0RXZlbnRTdGFjaygpCiAgICAgICAgfQogICAgICAgIEdldEN1cnJlbnRFdmVudFN0YWNrRnJhbWUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9ldmVudFNoZWV0TWFuYWdlci5HZXRDdXJyZW50RXZlbnRTdGFja0ZyYW1lKCkKICAgICAgICB9CiAgICAgICAgR2V0Q3VycmVudEV2ZW50KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZXZlbnRTaGVldE1hbmFnZXIuR2V0Q3VycmVudEV2ZW50KCkKICAgICAgICB9CiAgICAgICAgR2V0Q3VycmVudENvbmRpdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2V2ZW50U2hlZXRNYW5hZ2VyLkdldEN1cnJlbnRDb25kaXRpb24oKQogICAgICAgIH0KICAgICAgICBJc0N1cnJlbnRDb25kaXRpb25GaXJzdCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuR2V0Q3VycmVudEV2ZW50U3RhY2tGcmFtZSgpLkdldENvbmRpdGlvbkluZGV4KCkgPT09CiAgICAgICAgICAgICAgICAwCiAgICAgICAgfQogICAgICAgIEdldEN1cnJlbnRBY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9ldmVudFNoZWV0TWFuYWdlci5HZXRDdXJyZW50QWN0aW9uKCkKICAgICAgICB9CiAgICAgICAgR2V0UGx1Z2luTWFuYWdlcigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3BsdWdpbk1hbmFnZXIKICAgICAgICB9CiAgICAgICAgR2V0U3lzdGVtUGx1Z2luKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fcGx1Z2luTWFuYWdlci5HZXRTeXN0ZW1QbHVnaW4oKQogICAgICAgIH0KICAgICAgICBHZXRPYmplY3RDbGFzc0J5SW5kZXgoaSkgewogICAgICAgICAgICBpID0gTWF0aC5mbG9vcihpKTsKICAgICAgICAgICAgaWYgKGkgPCAwIHx8IGkgPj0gdGhpcy5fYWxsT2JqZWN0Q2xhc3Nlcy5sZW5ndGgpIHRocm93IG5ldyBSYW5nZUVycm9yKCJpbnZhbGlkIGluZGV4Iik7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9hbGxPYmplY3RDbGFzc2VzW2ldCiAgICAgICAgfQogICAgICAgIEdldE9iamVjdENsYXNzQnlOYW1lKG5hbWUpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX29iamVjdENsYXNzZXNCeU5hbWUuZ2V0KG5hbWUudG9Mb3dlckNhc2UoKSkgfHwgbnVsbAogICAgICAgIH0KICAgICAgICBHZXRPYmplY3RDbGFzc0J5U0lEKHNpZCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fb2JqZWN0Q2xhc3Nlc0J5U2lkLmdldChzaWQpIHx8IG51bGwKICAgICAgICB9CiAgICAgICAgR2V0U2luZ2xlR2xvYmFsT2JqZWN0Q2xhc3NCeUN0b3IoY3RvcikgewogICAgICAgICAgICBjb25zdCBwbHVnaW4gPQogICAgICAgICAgICAgICAgdGhpcy5fcGx1Z2luTWFuYWdlci5HZXRQbHVnaW5CeUNvbnN0cnVjdG9yRnVuY3Rpb24oY3Rvcik7CiAgICAgICAgICAgIGlmICghcGx1Z2luKSByZXR1cm4gbnVsbDsKICAgICAgICAgICAgcmV0dXJuIHBsdWdpbi5HZXRTaW5nbGVHbG9iYWxPYmplY3RDbGFzcygpCiAgICAgICAgfQogICAgICAgIEdldEFsbE9iamVjdENsYXNzZXMoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9hbGxPYmplY3RDbGFzc2VzCiAgICAgICAgfSogYWxsSW5zdGFuY2VzKCkgewogICAgICAgICAgICBmb3IgKGNvbnN0IG9iamVjdENsYXNzIG9mIHRoaXMuX2FsbE9iamVjdENsYXNzZXMpIHsKICAgICAgICAgICAgICAgIGlmIChvYmplY3RDbGFzcy5Jc0ZhbWlseSgpKSBjb250aW51ZTsKICAgICAgICAgICAgICAgIHlpZWxkKiBvYmplY3RDbGFzcy5pbnN0YW5jZXMoKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIERpc3BhdGNoZXIoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9kaXNwYXRjaGVyCiAgICAgICAgfQogICAgICAgIFVzZXJTY3JpcHREaXNwYXRjaGVyKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fdXNlclNjcmlwdERpc3BhdGNoZXIKICAgICAgICB9CiAgICAgICAgRGlzcGF0Y2hVc2VyU2NyaXB0RXZlbnQoZSkgewogICAgICAgICAgICBlLnJ1bnRpbWUgPSB0aGlzLkdldElSdW50aW1lKCk7CiAgICAgICAgICAgIGNvbnN0IHNob3VsZFRpbWUgPSB0aGlzLklzRGVidWcoKSAmJiAhdGhpcy5fZXZlbnRTaGVldE1hbmFnZXIuSXNJbkV2ZW50RW5naW5lKCk7CiAgICAgICAgICAgIGlmIChzaG91bGRUaW1lKSBDM0RlYnVnZ2VyLlN0YXJ0TWVhc3VyaW5nU2NyaXB0VGltZSgpOwogICAgICAgICAgICB0aGlzLl91c2VyU2NyaXB0RGlzcGF0Y2hlci5kaXNwYXRjaEV2ZW50KGUpOwogICAgICAgICAgICBpZiAoc2hvdWxkVGltZSkgQzNEZWJ1Z2dlci5BZGRTY3JpcHRUaW1lKCkKICAgICAgICB9CiAgICAgICAgRGlzcGF0Y2hVc2VyU2NyaXB0RXZlbnRBc3luY1dhaXQoZSkgewogICAgICAgICAgICBlLnJ1bnRpbWUgPSB0aGlzLkdldElSdW50aW1lKCk7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl91c2VyU2NyaXB0RGlzcGF0Y2hlci5kaXNwYXRjaEV2ZW50QW5kV2FpdEFzeW5jKGUpCiAgICAgICAgfQogICAgICAgIEdldE9yaWdpbmFsVmlld3BvcnRXaWR0aCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX29yaWdpbmFsVmlld3BvcnRXaWR0aAogICAgICAgIH0KICAgICAgICBHZXRPcmlnaW5hbFZpZXdwb3J0SGVpZ2h0KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fb3JpZ2luYWxWaWV3cG9ydEhlaWdodAogICAgICAgIH0KICAgICAgICBTZXRPcmlnaW5hbFZpZXdwb3J0U2l6ZSh3LCBoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9vcmlnaW5hbFZpZXdwb3J0V2lkdGggPT09IHcgJiYgdGhpcy5fb3JpZ2luYWxWaWV3cG9ydEhlaWdodCA9PT0gaCkgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl9vcmlnaW5hbFZpZXdwb3J0V2lkdGggPQogICAgICAgICAgICAgICAgdzsKICAgICAgICAgICAgdGhpcy5fb3JpZ2luYWxWaWV3cG9ydEhlaWdodCA9IGg7CiAgICAgICAgICAgIGNvbnN0IGxheW91dE1hbmFnZXIgPSB0aGlzLkdldExheW91dE1hbmFnZXIoKTsKICAgICAgICAgICAgbGF5b3V0TWFuYWdlci5TZXRBbGxMYXllclByb2plY3Rpb25DaGFuZ2VkKCk7CiAgICAgICAgICAgIGxheW91dE1hbmFnZXIuU2V0QWxsTGF5ZXJNVkNoYW5nZWQoKQogICAgICAgIH0KICAgICAgICBHZXRWaWV3cG9ydFdpZHRoKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fdmlld3BvcnRXaWR0aAogICAgICAgIH0KICAgICAgICBHZXRWaWV3cG9ydEhlaWdodCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3ZpZXdwb3J0SGVpZ2h0CiAgICAgICAgfQogICAgICAgIFNldFZpZXdwb3J0U2l6ZSh3LCBoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl92aWV3cG9ydFdpZHRoID09PSB3ICYmIHRoaXMuX3ZpZXdwb3J0SGVpZ2h0ID09PSBoKSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuX3ZpZXdwb3J0V2lkdGggPSB3OwogICAgICAgICAgICB0aGlzLl92aWV3cG9ydEhlaWdodCA9IGg7CiAgICAgICAgICAgIGNvbnN0IGxheW91dE1hbmFnZXIgPSB0aGlzLkdldExheW91dE1hbmFnZXIoKTsKICAgICAgICAgICAgbGF5b3V0TWFuYWdlci5TZXRBbGxMYXllclByb2plY3Rpb25DaGFuZ2VkKCk7CiAgICAgICAgICAgIGxheW91dE1hbmFnZXIuU2V0QWxsTGF5ZXJNVkNoYW5nZWQoKQogICAgICAgIH0KICAgICAgICBfU2V0RGV2aWNlUGl4ZWxSYXRpbyhyKSB7CiAgICAgICAgICAgIGlmICh0aGlzLklzRXhwb3J0VG9WaWRlbygpKSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuX2RldmljZVBpeGVsUmF0aW8gPSByCiAgICAgICAgfQogICAgICAgIEdldERldmljZVBpeGVsUmF0aW8oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9kZXZpY2VQaXhlbFJhdGlvCiAgICAgICAgfQogICAgICAgIEdldFBhcmFsbGF4WE9yaWdpbigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3BhcmFsbGF4WG9yaWdpbgogICAgICAgIH0KICAgICAgICBHZXRQYXJhbGxheFlPcmlnaW4oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9wYXJhbGxheFlvcmlnaW4KICAgICAgICB9CiAgICAgICAgR2V0Q2FudmFzTWFuYWdlcigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NhbnZhc01hbmFnZXIKICAgICAgICB9CiAgICAgICAgR2V0RHJhd1dpZHRoKCkgewogICAgICAgICAgICBpZiAoIXRoaXMuX2NhbnZhc01hbmFnZXIpIHJldHVybiB0aGlzLl92aWV3cG9ydFdpZHRoOwogICAgICAgICAgICByZXR1cm4gdGhpcy5fY2FudmFzTWFuYWdlci5HZXREcmF3V2lkdGgoKQogICAgICAgIH0KICAgICAgICBHZXREcmF3SGVpZ2h0KCkgewogICAgICAgICAgICBpZiAoIXRoaXMuX2NhbnZhc01hbmFnZXIpIHJldHVybiB0aGlzLl92aWV3cG9ydEhlaWdodDsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NhbnZhc01hbmFnZXIuR2V0RHJhd0hlaWdodCgpCiAgICAgICAgfQogICAgICAgIEdldFJlbmRlclNjYWxlKCkgewogICAgICAgICAgICBpZiAoIXRoaXMuX2NhbnZhc01hbmFnZXIpIHJldHVybiAxOwogICAgICAgICAgICByZXR1cm4gdGhpcy5fY2FudmFzTWFuYWdlci5HZXRSZW5kZXJTY2FsZSgpCiAgICAgICAgfQogICAgICAgIEdldERpc3BsYXlTY2FsZSgpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLl9jYW52YXNNYW5hZ2VyKSByZXR1cm4gMTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NhbnZhc01hbmFnZXIuR2V0RGlzcGxheVNjYWxlKCkKICAgICAgICB9CiAgICAgICAgR2V0RWZmZWN0TGF5ZXJTY2FsZVBhcmFtKCkgewogICAgICAgICAgICBpZiAoIXRoaXMuX2NhbnZhc01hbmFnZXIpIHJldHVybiAxOwogICAgICAgICAgICByZXR1cm4gdGhpcy5fY2FudmFzTWFuYWdlci5HZXRFZmZlY3RMYXllclNjYWxlUGFyYW0oKQogICAgICAgIH0KICAgICAgICBHZXRFZmZlY3REZXZpY2VQaXhlbFJhdGlvUGFyYW0oKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5fY2FudmFzTWFuYWdlcikgcmV0dXJuIDE7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9jYW52YXNNYW5hZ2VyLkdldEVmZmVjdERldmljZVBpeGVsUmF0aW9QYXJhbSgpCiAgICAgICAgfQogICAgICAgIEdldENhbnZhc0NsaWVudFgoKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5fY2FudmFzTWFuYWdlcikgcmV0dXJuIDA7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9jYW52YXNNYW5hZ2VyLkdldENhbnZhc0NsaWVudFgoKQogICAgICAgIH0KICAgICAgICBHZXRDYW52YXNDbGllbnRZKCkgewogICAgICAgICAgICBpZiAoIXRoaXMuX2NhbnZhc01hbmFnZXIpIHJldHVybiAwOwogICAgICAgICAgICByZXR1cm4gdGhpcy5fY2FudmFzTWFuYWdlci5HZXRDYW52YXNDbGllbnRZKCkKICAgICAgICB9CiAgICAgICAgR2V0Q2FudmFzQ3NzV2lkdGgoKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5fY2FudmFzTWFuYWdlcikgcmV0dXJuIDA7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9jYW52YXNNYW5hZ2VyLkdldENzc1dpZHRoKCkKICAgICAgICB9CiAgICAgICAgR2V0Q2FudmFzQ3NzSGVpZ2h0KCkgewogICAgICAgICAgICBpZiAoIXRoaXMuX2NhbnZhc01hbmFnZXIpIHJldHVybiAwOwogICAgICAgICAgICByZXR1cm4gdGhpcy5fY2FudmFzTWFuYWdlci5HZXRDc3NIZWlnaHQoKQogICAgICAgIH0KICAgICAgICBHZXRGdWxsc2NyZWVuTW9kZSgpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLl9jYW52YXNNYW5hZ2VyKSByZXR1cm4gIm9mZiI7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9jYW52YXNNYW5hZ2VyLkdldEZ1bGxzY3JlZW5Nb2RlKCkKICAgICAgICB9CiAgICAgICAgR2V0QWRkaXRpb25hbFJlbmRlclRhcmdldChvcHRzKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5fY2FudmFzTWFuYWdlcikgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9jYW52YXNNYW5hZ2VyLkdldEFkZGl0aW9uYWxSZW5kZXJUYXJnZXQob3B0cykKICAgICAgICB9CiAgICAgICAgUmVsZWFzZUFkZGl0aW9uYWxSZW5kZXJUYXJnZXQocmVuZGVyVGFyZ2V0KSB7CiAgICAgICAgICAgIGlmICghdGhpcy5fY2FudmFzTWFuYWdlcikgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl9jYW52YXNNYW5hZ2VyLlJlbGVhc2VBZGRpdGlvbmFsUmVuZGVyVGFyZ2V0KHJlbmRlclRhcmdldCkKICAgICAgICB9CiAgICAgICAgVXNlc0FueUJhY2tncm91bmRCbGVuZGluZygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3VzZXNBbnlCYWNrZ3JvdW5kQmxlbmRpbmcKICAgICAgICB9CiAgICAgICAgVXNlc0FueUNyb3NzU2FtcGxpbmcoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl91c2VzQW55Q3Jvc3NTYW1wbGluZwogICAgICAgIH0KICAgICAgICBVc2VzQW55RGVwdGhTYW1wbGluZygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3VzZXNBbnlEZXB0aFNhbXBsaW5nCiAgICAgICAgfQogICAgICAgIEdldEdQVVV0aWxpc2F0aW9uKCkgewogICAgICAgICAgICBpZiAoIXRoaXMuX2NhbnZhc01hbmFnZXIpIHJldHVybiBOYU47CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9jYW52YXNNYW5hZ2VyLkdldEdQVVV0aWxpc2F0aW9uKCkKICAgICAgICB9CiAgICAgICAgSXNMaW5lYXJTYW1wbGluZygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuR2V0U2FtcGxpbmcoKSAhPT0gIm5lYXJlc3QiCiAgICAgICAgfQogICAgICAgIEdldEZyYW1lcmF0ZU1vZGUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9mcmFtZXJhdGVNb2RlCiAgICAgICAgfQogICAgICAgIEdldENvbXBvc2l0aW5nTW9kZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NvbXBvc2l0aW5nTW9kZQogICAgICAgIH0KICAgICAgICBHZXRTYW1wbGluZygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NhbXBsaW5nCiAgICAgICAgfQogICAgICAgIFVzZXNMb2FkZXJMYXlvdXQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl91c2VzTG9hZGVyTGF5b3V0CiAgICAgICAgfQogICAgICAgIEdldExvYWRpbmdMb2dvQXNzZXQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9sb2FkaW5nTG9nb0Fzc2V0CiAgICAgICAgfQogICAgICAgIFJlbGVhc2VMb2FkaW5nTG9nb0Fzc2V0KCkgewogICAgICAgICAgICBpZiAodGhpcy5fbG9hZGluZ0xvZ29Bc3NldCkgewogICAgICAgICAgICAgICAgdGhpcy5fbG9hZGluZ0xvZ29Bc3NldC5SZWxlYXNlKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9sb2FkaW5nTG9nb0Fzc2V0ID0gbnVsbAogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIEdldExheW91dE1hbmFnZXIoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9sYXlvdXRNYW5hZ2VyCiAgICAgICAgfQogICAgICAgIEdldE1haW5SdW5uaW5nTGF5b3V0KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fbGF5b3V0TWFuYWdlci5HZXRNYWluUnVubmluZ0xheW91dCgpCiAgICAgICAgfQogICAgICAgIEdldFRpbWVsaW5lTWFuYWdlcigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RpbWVsaW5lTWFuYWdlcgogICAgICAgIH0KICAgICAgICBHZXRUcmFuc2l0aW9uTWFuYWdlcigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RyYW5zaXRpb25NYW5hZ2VyCiAgICAgICAgfQogICAgICAgIEdldFRlbXBsYXRlTWFuYWdlcigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RlbXBsYXRlTWFuYWdlcgogICAgICAgIH0KICAgICAgICBHZXRBc3NldE1hbmFnZXIoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9hc3NldE1hbmFnZXIKICAgICAgICB9CiAgICAgICAgTG9hZEltYWdlKG9wdHMpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2Fzc2V0TWFuYWdlci5Mb2FkSW1hZ2Uob3B0cykKICAgICAgICB9CiAgICAgICAgQ3JlYXRlSW5zdGFuY2Uob2JqZWN0Q2xhc3MsCiAgICAgICAgICAgIGxheWVyLCB4LCB5LCBjcmVhdGVIaWVyYXJjaHksIHRlbXBsYXRlTmFtZSkgewogICAgICAgICAgICBpZiAodGVtcGxhdGVOYW1lICYmIHRoaXMuX3RlbXBsYXRlTWFuYWdlcikgewogICAgICAgICAgICAgICAgY29uc3QgdGVtcGxhdGVEYXRhID0gdGhpcy5fdGVtcGxhdGVNYW5hZ2VyLkdldFRlbXBsYXRlRGF0YShvYmplY3RDbGFzcywgdGVtcGxhdGVOYW1lKTsKICAgICAgICAgICAgICAgIGlmICh0ZW1wbGF0ZURhdGEpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBpbnN0ID0gdGhpcy5DcmVhdGVJbnN0YW5jZUZyb21EYXRhKHRlbXBsYXRlRGF0YSwgbGF5ZXIsIGZhbHNlLCB4LCB5LCBmYWxzZSwgY3JlYXRlSGllcmFyY2h5LCB1bmRlZmluZWQsIGNyZWF0ZUhpZXJhcmNoeSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVtcGxhdGVNYW5hZ2VyLk1hcEluc3RhbmNlVG9UZW1wbGF0ZU5hbWUoaW5zdCwgdGVtcGxhdGVOYW1lKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW5zdAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0aGlzLkNyZWF0ZUluc3RhbmNlRnJvbURhdGEob2JqZWN0Q2xhc3MsIGxheWVyLCBmYWxzZSwgeCwgeSwgZmFsc2UsIGNyZWF0ZUhpZXJhcmNoeSwgdW5kZWZpbmVkLCBjcmVhdGVIaWVyYXJjaHkpCiAgICAgICAgfQogICAgICAgIENyZWF0ZUluc3RhbmNlRnJvbURhdGEoaW5zdERhdGFfb3Jfb2JqZWN0Q2xhc3MsCiAgICAgICAgICAgIGxheWVyLCBpc1N0YXJ0dXBJbnN0YW5jZSwgeCwgeSwgc2tpcFNpYmxpbmdzLCBjcmVhdGVIaWVyYXJjaHksIHByZXZpb3VzSW5zdGFuY2UsIGNyZWF0aW5nSGllcmFyY2h5KSB7CiAgICAgICAgICAgIGxldCBpbnN0RGF0YSA9IG51bGw7CiAgICAgICAgICAgIGxldCBvYmplY3RDbGFzcyA9IG51bGw7CiAgICAgICAgICAgIGlmIChpbnN0RGF0YV9vcl9vYmplY3RDbGFzcyBpbnN0YW5jZW9mIEMzLk9iamVjdENsYXNzKSB7CiAgICAgICAgICAgICAgICBvYmplY3RDbGFzcyA9IGluc3REYXRhX29yX29iamVjdENsYXNzOwogICAgICAgICAgICAgICAgaWYgKG9iamVjdENsYXNzLklzRmFtaWx5KCkpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBtZW1iZXJzID0gb2JqZWN0Q2xhc3MuR2V0RmFtaWx5TWVtYmVycygpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGkgPSBNYXRoLmZsb29yKHRoaXMuUmFuZG9tKCkgKiBtZW1iZXJzLmxlbmd0aCk7CiAgICAgICAgICAgICAgICAgICAgb2JqZWN0Q2xhc3MgPSBtZW1iZXJzW2ldCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpbnN0RGF0YSA9IG9iamVjdENsYXNzLkdldERlZmF1bHRJbnN0YW5jZURhdGEoKQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaW5zdERhdGEgPSBpbnN0RGF0YV9vcl9vYmplY3RDbGFzczsKICAgICAgICAgICAgICAgIG9iamVjdENsYXNzID0gdGhpcy5HZXRPYmplY3RDbGFzc0J5SW5kZXgoaW5zdERhdGFbMV0pCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgaXNXb3JsZCA9CiAgICAgICAgICAgICAgICBvYmplY3RDbGFzcy5HZXRQbHVnaW4oKS5Jc1dvcmxkVHlwZSgpOwogICAgICAgICAgICBpZiAodGhpcy5faXNMb2FkaW5nICYmIGlzV29ybGQgJiYgIW9iamVjdENsYXNzLklzT25Mb2FkZXJMYXlvdXQoKSkgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIGNvbnN0IG9yaWdpbmFsTGF5ZXIgPSBsYXllcjsKICAgICAgICAgICAgaWYgKCFpc1dvcmxkKSBsYXllciA9IG51bGw7CiAgICAgICAgICAgIGxldCB1aWQ7CiAgICAgICAgICAgIGlmIChpc1N0YXJ0dXBJbnN0YW5jZSAmJiAhc2tpcFNpYmxpbmdzICYmIGluc3REYXRhICYmICF0aGlzLl9pbnN0YW5jZXNCeVVpZC5oYXMoaW5zdERhdGFbMl0pKSB1aWQgPSBpbnN0RGF0YVsyXTsKICAgICAgICAgICAgZWxzZSB1aWQgPSB0aGlzLl9uZXh0VWlkKys7CiAgICAgICAgICAgIGNvbnN0IHdvcmxkRGF0YSA9IGluc3REYXRhID8gaW5zdERhdGFbMF0gOiBudWxsOwogICAgICAgICAgICBjb25zdCBpbnN0ID0gQzMuTmV3KEMzLkluc3RhbmNlLCB7CiAgICAgICAgICAgICAgICBydW50aW1lOiB0aGlzLAogICAgICAgICAgICAgICAgb2JqZWN0VHlwZTogb2JqZWN0Q2xhc3MsCiAgICAgICAgICAgICAgICBsYXllcjogbGF5ZXIsCiAgICAgICAgICAgICAgICB3b3JsZERhdGEsCiAgICAgICAgICAgICAgICBpbnN0VmFyRGF0YTogaW5zdERhdGEgPyBpbnN0RGF0YVszXSA6IG51bGwsCiAgICAgICAgICAgICAgICB1aWQ6IHVpZAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdGhpcy5faW5zdGFuY2VzQnlVaWQuc2V0KHVpZCwKICAgICAgICAgICAgICAgIGluc3QpOwogICAgICAgICAgICBsZXQgd2kgPSBudWxsOwogICAgICAgICAgICBpZiAoaXNXb3JsZCkgewogICAgICAgICAgICAgICAgd2kgPSBpbnN0LkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB4ICE9PSAidW5kZWZpbmVkIiAmJiB0eXBlb2YgeSAhPT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgICAgICAgICAgICB3aS5TZXRYKHgpOwogICAgICAgICAgICAgICAgICAgIHdpLlNldFkoeSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIG9iamVjdENsYXNzLl9TZXRBbnlDb2xsaXNpb25DZWxsQ2hhbmdlZCh0cnVlKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChsYXllcikgewogICAgICAgICAgICAgICAgaWYgKCFjcmVhdGluZ0hpZXJhcmNoeSkgbGF5ZXIuX0FkZEluc3RhbmNlKGluc3QsIHRydWUpOwogICAgICAgICAgICAgICAgaWYgKGxheWVyLkdldFBhcmFsbGF4WCgpICE9PSAxIHx8IGxheWVyLkdldFBhcmFsbGF4WSgpICE9PSAxKSBvYmplY3RDbGFzcy5fU2V0QW55SW5zdGFuY2VQYXJhbGxheGVkKHRydWUpOwogICAgICAgICAgICAgICAgbGF5ZXIuR2V0TGF5b3V0KCkuTWF5YmVMb2FkVGV4dHVyZXNGb3Iob2JqZWN0Q2xhc3MpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5fb2JqZWN0Q291bnQrKzsKICAgICAgICAgICAgbGV0IG5lZWRzU2libGluZ0NyZWF0aW9uID0gdHJ1ZTsKICAgICAgICAgICAgaWYgKHByZXZpb3VzSW5zdGFuY2UpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHByZXZpb3VzT2JqZWN0Q2xhc3MgPSBwcmV2aW91c0luc3RhbmNlLkdldE9iamVjdENsYXNzKCk7CiAgICAgICAgICAgICAgICBpZiAocHJldmlvdXNPYmplY3RDbGFzcy5Jc0luQ29udGFpbmVyKCkgJiYgb2JqZWN0Q2xhc3MuSXNJbkNvbnRhaW5lcigpKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29udGFpbmVyID0gb2JqZWN0Q2xhc3MuR2V0Q29udGFpbmVyKCk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJldmlvdXNDb250YWluZXIgPSBwcmV2aW91c09iamVjdENsYXNzLkdldENvbnRhaW5lcigpOwogICAgICAgICAgICAgICAgICAgIGlmIChjb250YWluZXIgPT09IHByZXZpb3VzQ29udGFpbmVyKSBuZWVkc1NpYmxpbmdDcmVhdGlvbiA9IGZhbHNlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG9iamVjdENsYXNzLklzSW5Db250YWluZXIoKSAmJiAhaXNTdGFydHVwSW5zdGFuY2UgJiYgIXNraXBTaWJsaW5ncyAmJiBuZWVkc1NpYmxpbmdDcmVhdGlvbikgewogICAgICAgICAgICAgICAgZm9yIChjb25zdCBjb250YWluZXJUeXBlIG9mIG9iamVjdENsYXNzLkdldENvbnRhaW5lcigpLm9iamVjdFR5cGVzKCkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoY29udGFpbmVyVHlwZSA9PT0gb2JqZWN0Q2xhc3MpIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNpYmxpbmdJbnN0ID0gdGhpcy5DcmVhdGVJbnN0YW5jZUZyb21EYXRhKGNvbnRhaW5lclR5cGUsIG9yaWdpbmFsTGF5ZXIsCiAgICAgICAgICAgICAgICAgICAgICAgIGZhbHNlLCB3aSA/IHdpLkdldFgoKSA6IHgsIHdpID8gd2kuR2V0WSgpIDogeSwgdHJ1ZSwgZmFsc2UsIHVuZGVmaW5lZCwgY3JlYXRpbmdIaWVyYXJjaHkpOwogICAgICAgICAgICAgICAgICAgIGluc3QuX0FkZFNpYmxpbmcoc2libGluZ0luc3QpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHMgb2YgaW5zdC5zaWJsaW5ncygpKSB7CiAgICAgICAgICAgICAgICAgICAgcy5fQWRkU2libGluZyhpbnN0KTsKICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHMyIG9mIGluc3Quc2libGluZ3MoKSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHMgIT09IHMyKSBzLl9BZGRTaWJsaW5nKHMyKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChpc1dvcmxkICYmICFpc1N0YXJ0dXBJbnN0YW5jZSAmJiAhIWNyZWF0ZUhpZXJhcmNoeSkgdGhpcy5fQ3JlYXRlQ2hpbGRJbnN0YW5jZXNGcm9tRGF0YShpbnN0LCB3b3JsZERhdGEsIHdpLCBsYXllciwgeCwgeSwgY3JlYXRpbmdIaWVyYXJjaHkpOwogICAgICAgICAgICBpZiAob2JqZWN0Q2xhc3MuSXNJbkNvbnRhaW5lcigpICYmICFpc1N0YXJ0dXBJbnN0YW5jZSAmJiAhc2tpcFNpYmxpbmdzICYmICEhY3JlYXRlSGllcmFyY2h5KQogICAgICAgICAgICAgICAgZm9yIChjb25zdCBzaWJsaW5nIG9mIGluc3Quc2libGluZ3MoKSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHN3aSA9IHNpYmxpbmcuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFzd2kpIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNpYmxpbmdQbHVnaW4gPSBzaWJsaW5nLkdldFBsdWdpbigpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNXb3JsZERhdGEgPSBzaWJsaW5nLkdldE9iamVjdENsYXNzKCkuR2V0RGVmYXVsdEluc3RhbmNlRGF0YSgpWzBdOwogICAgICAgICAgICAgICAgICAgIGlmIChzaWJsaW5nUGx1Z2luLklzV29ybGRUeXBlKCkpIHRoaXMuX0NyZWF0ZUNoaWxkSW5zdGFuY2VzRnJvbURhdGEoc2libGluZywgc1dvcmxkRGF0YSwgc3dpLCBsYXllciwgc3dpLkdldFgoKSwgc3dpLkdldFkoKSwgY3JlYXRpbmdIaWVyYXJjaHkpOwogICAgICAgICAgICAgICAgICAgIGVsc2UgdGhpcy5fQ3JlYXRlQ2hpbGRJbnN0YW5jZXNGcm9tRGF0YShzaWJsaW5nLCBzV29ybGREYXRhLCBzd2ksIGxheWVyLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgY3JlYXRpbmdIaWVyYXJjaHkpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghc2tpcFNpYmxpbmdzICYmICEhY3JlYXRlSGllcmFyY2h5KSB7CiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHggPT09ICJ1bmRlZmluZWQiKSB4ID0gd29ybGREYXRhWzBdOwogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB5ID09PSAidW5kZWZpbmVkIikgeSA9IHdvcmxkRGF0YVsxXTsKICAgICAgICAgICAgICAgIGNvbnN0IHB3aSA9IHdpLkdldFRvcFBhcmVudCgpOwogICAgICAgICAgICAgICAgY29uc3QgbmV3WCA9IHggLSB3aS5HZXRYKCkgKyBwd2kuR2V0WCgpOwogICAgICAgICAgICAgICAgY29uc3QgbmV3WSA9IHkgLSB3aS5HZXRZKCkgKyBwd2kuR2V0WSgpOwogICAgICAgICAgICAgICAgcHdpLlNldFhZKG5ld1gsIG5ld1kpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgb2JqZWN0Q2xhc3MuX1NldElJRHNTdGFsZSgpOwogICAgICAgICAgICBjb25zdCBpbnN0UHJvcGVydHlEYXRhID0gaW5zdERhdGEgPyBDMy5jbG9uZUFycmF5KGluc3REYXRhWzVdKSA6IG51bGw7CiAgICAgICAgICAgIGNvbnN0IGJlaFByb3BlcnR5RGF0YSA9IGluc3REYXRhID8gaW5zdERhdGFbNF0ubWFwKGJwID0+IEMzLmNsb25lQXJyYXkoYnApKSA6IG51bGw7CiAgICAgICAgICAgIGNvbnN0IGhhc1RpbGVtYXAgPSBpc1dvcmxkICYmIHdvcmxkRGF0YSAmJiB3b3JsZERhdGFbMTNdOwogICAgICAgICAgICBpZiAoaGFzVGlsZW1hcCkgaW5zdC5fU2V0SGFzVGlsZW1hcCgpOwogICAgICAgICAgICBpbnN0Ll9DcmVhdGVTZGtJbnN0YW5jZShpbnN0UHJvcGVydHlEYXRhLCBiZWhQcm9wZXJ0eURhdGEpOwogICAgICAgICAgICBpZiAoaGFzVGlsZW1hcCkgewogICAgICAgICAgICAgICAgY29uc3QgdGlsZW1hcERhdGEgPSB3b3JsZERhdGFbMTNdOwogICAgICAgICAgICAgICAgaW5zdC5HZXRTZGtJbnN0YW5jZSgpLkxvYWRUaWxlbWFwRGF0YSh0aWxlbWFwRGF0YVsyXSwKICAgICAgICAgICAgICAgICAgICB0aWxlbWFwRGF0YVswXSwgdGlsZW1hcERhdGFbMV0pCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5faW5zdGFuY2VzUGVuZGluZ0NyZWF0ZS5wdXNoKGluc3QpOwogICAgICAgICAgICB0aGlzLl9oYXNQZW5kaW5nSW5zdGFuY2VzID0gdHJ1ZTsKICAgICAgICAgICAgaWYgKHRoaXMuSXNEZWJ1ZygpKSBDM0RlYnVnZ2VyLkluc3RhbmNlQ3JlYXRlZChpbnN0KTsKICAgICAgICAgICAgcmV0dXJuIGluc3QKICAgICAgICB9CiAgICAgICAgX0NyZWF0ZUNoaWxkSW5zdGFuY2VzRnJvbURhdGEocGFyZW50SW5zdGFuY2UsIHBhcmVudFdvcmxkRGF0YSwgcGFyZW50V29ybGRJbmZvLCBsYXllciwgeCwgeSwgY3JlYXRpbmdIaWVyYXJjaHkpIHsKICAgICAgICAgICAgY29uc3QgcGFyZW50WkluZGV4ID0gcGFyZW50V29ybGRJbmZvLkdldFNjZW5lR3JhcGhaSW5kZXhFeHBvcnREYXRhKCk7CiAgICAgICAgICAgIGNvbnN0IGNoaWxkcmVuRGF0YSA9IHBhcmVudFdvcmxkSW5mby5HZXRTY2VuZUdyYXBoQ2hpbGRyZW5FeHBvcnREYXRhKCk7CiAgICAgICAgICAgIHBhcmVudEluc3RhbmNlLkdldFdvcmxkSW5mbygpLlNldFNjZW5lR3JhcGhaSW5kZXgocGFyZW50WkluZGV4KTsKICAgICAgICAgICAgaWYgKCFjaGlsZHJlbkRhdGEpIHJldHVybjsKICAgICAgICAgICAgaWYgKHR5cGVvZiB4ID09PQogICAgICAgICAgICAgICAgInVuZGVmaW5lZCIpIHggPSBwYXJlbnRXb3JsZERhdGFbMF07CiAgICAgICAgICAgIGlmICh0eXBlb2YgeSA9PT0gInVuZGVmaW5lZCIpIHkgPSBwYXJlbnRXb3JsZERhdGFbMV07CiAgICAgICAgICAgIGNvbnN0IHNjZW5lR3JhcGhTaWJsaW5ncyA9IG5ldyBTZXQ7CiAgICAgICAgICAgIGNvbnN0IHBhcmVudFggPSBwYXJlbnRXb3JsZERhdGFbMF07CiAgICAgICAgICAgIGNvbnN0IHBhcmVudFkgPSBwYXJlbnRXb3JsZERhdGFbMV07CiAgICAgICAgICAgIGZvciAoY29uc3QgY2hpbGREYXRhIG9mIGNoaWxkcmVuRGF0YSkgewogICAgICAgICAgICAgICAgY29uc3QgY2hpbGRMYXlvdXRTSUQgPSBjaGlsZERhdGFbMF07CiAgICAgICAgICAgICAgICBjb25zdCBjaGlsZExheWVySW5kZXggPSBjaGlsZERhdGFbMV07CiAgICAgICAgICAgICAgICBjb25zdCBjaGlsZFVJRCA9IGNoaWxkRGF0YVsyXTsKICAgICAgICAgICAgICAgIGNvbnN0IGNoaWxkRmxhZ3MgPSBjaGlsZERhdGFbM107CiAgICAgICAgICAgICAgICBjb25zdCBjaGlsZElzSW5Db250YWluZXIgPSAhIWNoaWxkRGF0YVs0XTsKICAgICAgICAgICAgICAgIGNvbnN0IGNoaWxkWkluZGV4ID0gY2hpbGREYXRhWzVdOwogICAgICAgICAgICAgICAgY29uc3QgdW5pcXVlSW5zdGFuY2VEYXRhID0gY2hpbGREYXRhWzZdOwogICAgICAgICAgICAgICAgbGV0IGNoaWxkSW5zdERhdGE7CiAgICAgICAgICAgICAgICBpZiAodW5pcXVlSW5zdGFuY2VEYXRhKSBjaGlsZEluc3REYXRhID0KICAgICAgICAgICAgICAgICAgICB1bmlxdWVJbnN0YW5jZURhdGE7CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBsYXlvdXQgPSB0aGlzLl9sYXlvdXRNYW5hZ2VyLkdldExheW91dEJ5U0lEKGNoaWxkTGF5b3V0U0lEKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBsID0gbGF5b3V0LkdldExheWVyKGNoaWxkTGF5ZXJJbmRleCk7CiAgICAgICAgICAgICAgICAgICAgY2hpbGRJbnN0RGF0YSA9IGwuR2V0SW5pdGlhbEluc3RhbmNlRGF0YShjaGlsZFVJRCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNvbnN0IGNoaWxkT2JqZWN0Q2xhc3MgPSB0aGlzLkdldE9iamVjdENsYXNzQnlJbmRleChjaGlsZEluc3REYXRhWzFdKTsKICAgICAgICAgICAgICAgIGNvbnN0IGhhc1NpYmxpbmcgPSBwYXJlbnRJbnN0YW5jZS5IYXNTaWJsaW5nKGNoaWxkT2JqZWN0Q2xhc3MpOwogICAgICAgICAgICAgICAgY29uc3Qgc2libGluZ1Byb2Nlc3NlZCA9IHNjZW5lR3JhcGhTaWJsaW5ncy5oYXMoY2hpbGRPYmplY3RDbGFzcyk7CiAgICAgICAgICAgICAgICBpZiAoaGFzU2libGluZyAmJiAhc2libGluZ1Byb2Nlc3NlZCAmJiBjaGlsZElzSW5Db250YWluZXIpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBjaGlsZEluc3QgPSBwYXJlbnRJbnN0YW5jZS5HZXRTaWJsaW5nKGNoaWxkT2JqZWN0Q2xhc3MpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGNoaWxkWCA9IHggKyBjaGlsZEluc3REYXRhWzBdWzBdIC0KICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50WDsKICAgICAgICAgICAgICAgICAgICBjb25zdCBjaGlsZFkgPSB5ICsgY2hpbGRJbnN0RGF0YVswXVsxXSAtIHBhcmVudFk7CiAgICAgICAgICAgICAgICAgICAgY2hpbGRJbnN0LkdldFdvcmxkSW5mbygpLlNldFhZKGNoaWxkWCwgY2hpbGRZKTsKICAgICAgICAgICAgICAgICAgICBjaGlsZEluc3QuR2V0V29ybGRJbmZvKCkuU2V0U2NlbmVHcmFwaFpJbmRleChjaGlsZFpJbmRleCk7CiAgICAgICAgICAgICAgICAgICAgcGFyZW50SW5zdGFuY2UuQWRkQ2hpbGQoY2hpbGRJbnN0LCB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zZm9ybVg6ICEhKGNoaWxkRmxhZ3MgPj4gMCAmIDEpLAogICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2Zvcm1ZOiAhIShjaGlsZEZsYWdzID4+IDEgJiAxKSwKICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNmb3JtV2lkdGg6ICEhKGNoaWxkRmxhZ3MgPj4gMiAmIDEpLAogICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2Zvcm1IZWlnaHQ6ICEhKGNoaWxkRmxhZ3MgPj4gMyAmIDEpLAogICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2Zvcm1BbmdsZTogISEoY2hpbGRGbGFncyA+PiA0ICYgMSksCiAgICAgICAgICAgICAgICAgICAgICAgIGRlc3Ryb3lXaXRoUGFyZW50OiAhIShjaGlsZEZsYWdzID4+IDUgJiAxKSwKICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNmb3JtWkVsZXZhdGlvbjogISEoY2hpbGRGbGFncyA+PiA2ICYgMSksCiAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zZm9ybU9wYWNpdHk6ICEhKGNoaWxkRmxhZ3MgPj4gNyAmIDEpLAogICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2Zvcm1WaXNpYmlsaXR5OiAhIShjaGlsZEZsYWdzID4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA4ICYgMSkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBzY2VuZUdyYXBoU2libGluZ3MuYWRkKGNoaWxkT2JqZWN0Q2xhc3MpCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGNoaWxkWCA9IHggKyBjaGlsZEluc3REYXRhWzBdWzBdIC0gcGFyZW50WDsKICAgICAgICAgICAgICAgICAgICBjb25zdCBjaGlsZFkgPSB5ICsgY2hpbGRJbnN0RGF0YVswXVsxXSAtIHBhcmVudFk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgY2hpbGRJbnN0ID0gdGhpcy5DcmVhdGVJbnN0YW5jZUZyb21EYXRhKGNoaWxkSW5zdERhdGEsIGxheWVyLCBmYWxzZSwgY2hpbGRYLCBjaGlsZFksIGZhbHNlLCB0cnVlLCBwYXJlbnRJbnN0YW5jZSwgY3JlYXRpbmdIaWVyYXJjaHkpOwogICAgICAgICAgICAgICAgICAgIGNoaWxkSW5zdC5HZXRXb3JsZEluZm8oKS5TZXRTY2VuZUdyYXBoWkluZGV4KGNoaWxkWkluZGV4KTsKICAgICAgICAgICAgICAgICAgICBwYXJlbnRJbnN0YW5jZS5BZGRDaGlsZChjaGlsZEluc3QsIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNmb3JtWDogISEoY2hpbGRGbGFncyA+PiAwICYgMSksCiAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zZm9ybVk6ICEhKGNoaWxkRmxhZ3MgPj4gMSAmIDEpLAogICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2Zvcm1XaWR0aDogISEoY2hpbGRGbGFncyA+PiAyICYgMSksCiAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zZm9ybUhlaWdodDogISEoY2hpbGRGbGFncyA+PiAzICYgMSksCiAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zZm9ybUFuZ2xlOiAhIShjaGlsZEZsYWdzID4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA0ICYgMSksCiAgICAgICAgICAgICAgICAgICAgICAgIGRlc3Ryb3lXaXRoUGFyZW50OiAhIShjaGlsZEZsYWdzID4+IDUgJiAxKSwKICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNmb3JtWkVsZXZhdGlvbjogISEoY2hpbGRGbGFncyA+PiA2ICYgMSksCiAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zZm9ybU9wYWNpdHk6ICEhKGNoaWxkRmxhZ3MgPj4gNyAmIDEpLAogICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2Zvcm1WaXNpYmlsaXR5OiAhIShjaGlsZEZsYWdzID4+IDggJiAxKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgRGVzdHJveUluc3RhbmNlKGluc3QpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX2luc3RhbmNlc1RvUmVsZWFzZUF0RW5kT2ZUaWNrLmhhcyhpbnN0KSkgcmV0dXJuOwogICAgICAgICAgICBjb25zdCBvYmplY3RDbGFzcyA9IGluc3QuR2V0T2JqZWN0Q2xhc3MoKTsKICAgICAgICAgICAgbGV0IHMgPSB0aGlzLl9pbnN0YW5jZXNQZW5kaW5nRGVzdHJveS5nZXQob2JqZWN0Q2xhc3MpOwogICAgICAgICAgICBpZiAocykgewogICAgICAgICAgICAgICAgaWYgKHMuaGFzKGluc3QpKSByZXR1cm47CiAgICAgICAgICAgICAgICBzLmFkZChpbnN0KQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcyA9IG5ldyBTZXQ7CiAgICAgICAgICAgICAgICBzLmFkZChpbnN0KTsKICAgICAgICAgICAgICAgIHRoaXMuX2luc3RhbmNlc1BlbmRpbmdEZXN0cm95LnNldChvYmplY3RDbGFzcywgcykKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGhpcy5Jc0RlYnVnKCkpIEMzRGVidWdnZXIuSW5zdGFuY2VEZXN0cm95ZWQoaW5zdCk7CiAgICAgICAgICAgIGluc3QuX01hcmtEZXN0cm95ZWQoKTsKICAgICAgICAgICAgdGhpcy5faGFzUGVuZGluZ0luc3RhbmNlcyA9IHRydWU7CiAgICAgICAgICAgIGlmIChpbnN0LklzSW5Db250YWluZXIoKSkKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgcyBvZiBpbnN0LnNpYmxpbmdzKCkpIHRoaXMuRGVzdHJveUluc3RhbmNlKHMpOwogICAgICAgICAgICBmb3IgKGNvbnN0IGMgb2YgaW5zdC5jaGlsZHJlbigpKQogICAgICAgICAgICAgICAgaWYgKGMuR2V0RGVzdHJveVdpdGhQYXJlbnQoKSkgdGhpcy5EZXN0cm95SW5zdGFuY2UoYyk7CiAgICAgICAgICAgIGlmICghdGhpcy5fbGF5b3V0TWFuYWdlci5Jc0VuZGluZ0xheW91dCgpICYmICF0aGlzLl9pc0xvYWRpbmdTdGF0ZSkgewogICAgICAgICAgICAgICAgY29uc3QgZXZlbnRTaGVldE1hbmFnZXIgPSB0aGlzLkdldEV2ZW50U2hlZXRNYW5hZ2VyKCk7CiAgICAgICAgICAgICAgICBldmVudFNoZWV0TWFuYWdlci5CbG9ja0ZsdXNoaW5nSW5zdGFuY2VzKHRydWUpOwogICAgICAgICAgICAgICAgaW5zdC5fVHJpZ2dlck9uRGVzdHJveWVkKCk7CiAgICAgICAgICAgICAgICBldmVudFNoZWV0TWFuYWdlci5CbG9ja0ZsdXNoaW5nSW5zdGFuY2VzKGZhbHNlKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGluc3QuX0ZpcmVEZXN0cm95ZWRTY3JpcHRFdmVudHModGhpcy5fbGF5b3V0TWFuYWdlci5Jc0VuZGluZ0xheW91dCgpKQogICAgICAgIH0KICAgICAgICBGbHVzaFBlbmRpbmdJbnN0YW5jZXMoKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5faGFzUGVuZGluZ0luc3RhbmNlcykgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl9pc0ZsdXNoaW5nUGVuZGluZ0luc3RhbmNlcyA9IHRydWU7CiAgICAgICAgICAgIHRoaXMuX0ZsdXNoSW5zdGFuY2VzUGVuZGluZ0NyZWF0ZSgpOwogICAgICAgICAgICB0aGlzLl9GbHVzaEluc3RhbmNlc1BlbmRpbmdEZXN0cm95KCk7CiAgICAgICAgICAgIHRoaXMuX2lzRmx1c2hpbmdQZW5kaW5nSW5zdGFuY2VzID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX2hhc1BlbmRpbmdJbnN0YW5jZXMgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5VcGRhdGVSZW5kZXIoKQogICAgICAgIH0KICAgICAgICBfRmx1c2hJbnN0YW5jZXNQZW5kaW5nQ3JlYXRlKCkgewogICAgICAgICAgICBmb3IgKGNvbnN0IGluc3Qgb2YgdGhpcy5faW5zdGFuY2VzUGVuZGluZ0NyZWF0ZSkgewogICAgICAgICAgICAgICAgY29uc3Qgb2JqZWN0VHlwZSA9IGluc3QuR2V0T2JqZWN0Q2xhc3MoKTsKICAgICAgICAgICAgICAgIG9iamVjdFR5cGUuX0FkZEluc3RhbmNlKGluc3QpOwogICAgICAgICAgICAgICAgZm9yIChjb25zdCBmYW1pbHkgb2Ygb2JqZWN0VHlwZS5HZXRGYW1pbGllcygpKSB7CiAgICAgICAgICAgICAgICAgICAgZmFtaWx5Ll9BZGRJbnN0YW5jZShpbnN0KTsKICAgICAgICAgICAgICAgICAgICBmYW1pbHkuX1NldElJRHNTdGFsZSgpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgQzMuY2xlYXJBcnJheSh0aGlzLl9pbnN0YW5jZXNQZW5kaW5nQ3JlYXRlKQogICAgICAgIH0KICAgICAgICBfRmx1c2hJbnN0YW5jZXNQZW5kaW5nRGVzdHJveSgpIHsKICAgICAgICAgICAgdGhpcy5fZGlzcGF0Y2hlci5TZXREZWxheVJlbW92ZUV2ZW50c0VuYWJsZWQodHJ1ZSk7CiAgICAgICAgICAgIGZvciAoY29uc3QgW29iamVjdENsYXNzLCBzXSBvZiB0aGlzLl9pbnN0YW5jZXNQZW5kaW5nRGVzdHJveS5lbnRyaWVzKCkpIHsKICAgICAgICAgICAgICAgIHRoaXMuX0ZsdXNoSW5zdGFuY2VzUGVuZGluZ0Rlc3Ryb3lGb3JPYmplY3RDbGFzcyhvYmplY3RDbGFzcywgcyk7CiAgICAgICAgICAgICAgICBzLmNsZWFyKCkKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLl9pbnN0YW5jZXNQZW5kaW5nRGVzdHJveS5jbGVhcigpOwogICAgICAgICAgICB0aGlzLl9kaXNwYXRjaGVyLlNldERlbGF5UmVtb3ZlRXZlbnRzRW5hYmxlZChmYWxzZSkKICAgICAgICB9CiAgICAgICAgX0ZsdXNoSW5zdGFuY2VzUGVuZGluZ0Rlc3Ryb3lGb3JPYmplY3RDbGFzcyhvYmplY3RDbGFzcywgcykgewogICAgICAgICAgICBmb3IgKGNvbnN0IGluc3Qgb2YgcykgewogICAgICAgICAgICAgICAgY29uc3QgaW5zdGFuY2VEZXN0cm95RXZlbnQgPSB0aGlzLl9ldmVudE9iamVjdHNbImluc3RhbmNlZGVzdHJveSJdOwogICAgICAgICAgICAgICAgaW5zdGFuY2VEZXN0cm95RXZlbnQuaW5zdGFuY2UgPSBpbnN0OwogICAgICAgICAgICAgICAgdGhpcy5fZGlzcGF0Y2hlci5kaXNwYXRjaEV2ZW50KGluc3RhbmNlRGVzdHJveUV2ZW50KTsKICAgICAgICAgICAgICAgIHRoaXMuX2luc3RhbmNlc0J5VWlkLmRlbGV0ZShpbnN0LkdldFVJRCgpKTsKICAgICAgICAgICAgICAgIHRoaXMuX2luc3RhbmNlVGltZXMuZGVsZXRlKGluc3QpOwogICAgICAgICAgICAgICAgY29uc3Qgd2kgPSBpbnN0LkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICAgICAgaWYgKHdpKSB7CiAgICAgICAgICAgICAgICAgICAgd2kuX1JlbW92ZUZyb21Db2xsaXNpb25DZWxscygpOwogICAgICAgICAgICAgICAgICAgIHdpLl9SZW1vdmVGcm9tUmVuZGVyQ2VsbHMoKTsKICAgICAgICAgICAgICAgICAgICB3aS5fTWFya0Rlc3Ryb3llZCgpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLl9pbnN0YW5jZXNUb1JlbGVhc2VBdEVuZE9mVGljay5hZGQoaW5zdCk7CiAgICAgICAgICAgICAgICB0aGlzLl9vYmplY3RDb3VudC0tCiAgICAgICAgICAgIH0KICAgICAgICAgICAgQzMuYXJyYXlSZW1vdmVBbGxJblNldChvYmplY3RDbGFzcy5HZXRJbnN0YW5jZXMoKSwgcyk7CiAgICAgICAgICAgIG9iamVjdENsYXNzLl9TZXRJSURzU3RhbGUoKTsKICAgICAgICAgICAgdGhpcy5faW5zdGFuY2VzVG9SZWxlYXNlQWZmZWN0ZWRPYmplY3RDbGFzc2VzLmFkZChvYmplY3RDbGFzcyk7CiAgICAgICAgICAgIGlmIChvYmplY3RDbGFzcy5HZXRJbnN0YW5jZXMoKS5sZW5ndGggPT09IDApIG9iamVjdENsYXNzLl9TZXRBbnlJbnN0YW5jZVBhcmFsbGF4ZWQoZmFsc2UpOwogICAgICAgICAgICBmb3IgKGNvbnN0IGZhbWlseSBvZiBvYmplY3RDbGFzcy5HZXRGYW1pbGllcygpKSB7CiAgICAgICAgICAgICAgICBDMy5hcnJheVJlbW92ZUFsbEluU2V0KGZhbWlseS5HZXRJbnN0YW5jZXMoKSwKICAgICAgICAgICAgICAgICAgICBzKTsKICAgICAgICAgICAgICAgIGZhbWlseS5fU2V0SUlEc1N0YWxlKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9pbnN0YW5jZXNUb1JlbGVhc2VBZmZlY3RlZE9iamVjdENsYXNzZXMuYWRkKGZhbWlseSkKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAob2JqZWN0Q2xhc3MuR2V0UGx1Z2luKCkuSXNXb3JsZFR5cGUoKSkgewogICAgICAgICAgICAgICAgY29uc3QgbGF5ZXJzID0gbmV3IFNldChbLi4uc10ubWFwKGkgPT4gaS5HZXRXb3JsZEluZm8oKS5HZXRMYXllcigpKSk7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGxheWVyIG9mIGxheWVycykgbGF5ZXIuX1JlbW92ZUFsbEluc3RhbmNlc0luU2V0KHMpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgX0dldEluc3RhbmNlc1BlbmRpbmdDcmVhdGUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pbnN0YW5jZXNQZW5kaW5nQ3JlYXRlCiAgICAgICAgfSogaW5zdGFuY2VzUGVuZGluZ0NyZWF0ZUZvck9iamVjdENsYXNzKG9iamVjdENsYXNzKSB7CiAgICAgICAgICAgIGZvciAoY29uc3QgaW5zdCBvZiB0aGlzLl9HZXRJbnN0YW5jZXNQZW5kaW5nQ3JlYXRlKCkpCiAgICAgICAgICAgICAgICBpZiAob2JqZWN0Q2xhc3MuSXNGYW1pbHkoKSkgewogICAgICAgICAgICAgICAgICAgIGlmIChpbnN0LkdldE9iamVjdENsYXNzKCkuQmVsb25nc1RvRmFtaWx5KG9iamVjdENsYXNzKSkgeWllbGQgaW5zdAogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpbnN0LkdldE9iamVjdENsYXNzKCkgPT09CiAgICAgICAgICAgICAgICBvYmplY3RDbGFzcykgeWllbGQgaW5zdAogICAgICAgIH0KICAgICAgICBfR2V0TmV3VUlEKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fbmV4dFVpZCsrCiAgICAgICAgfQogICAgICAgIF9NYXBJbnN0YW5jZUJ5VUlEKHVpZCwgaW5zdCkgewogICAgICAgICAgICB0aGlzLl9pbnN0YW5jZXNCeVVpZC5zZXQodWlkLCBpbnN0KQogICAgICAgIH0KICAgICAgICBfT25SZW5kZXJlckNvbnRleHRMb3N0KCkgewogICAgICAgICAgICB0aGlzLl9kaXNwYXRjaGVyLmRpc3BhdGNoRXZlbnQoQzMuTmV3KEMzLkV2ZW50LCAicmVuZGVyZXJjb250ZXh0bG9zdCIpKTsKICAgICAgICAgICAgdGhpcy5TZXRTdXNwZW5kZWQodHJ1ZSk7CiAgICAgICAgICAgIGZvciAoY29uc3Qgb2JqZWN0Q2xhc3Mgb2YgdGhpcy5fYWxsT2JqZWN0Q2xhc3NlcykKICAgICAgICAgICAgICAgIGlmICghb2JqZWN0Q2xhc3MuSXNGYW1pbHkoKSAmJiBvYmplY3RDbGFzcy5IYXNMb2FkZWRUZXh0dXJlcygpKSBvYmplY3RDbGFzcy5SZWxlYXNlVGV4dHVyZXMoKTsKICAgICAgICAgICAgY29uc3QgcnVubmluZ0xheW91dCA9IHRoaXMuR2V0TWFpblJ1bm5pbmdMYXlvdXQoKTsKICAgICAgICAgICAgaWYgKHJ1bm5pbmdMYXlvdXQpIHJ1bm5pbmdMYXlvdXQuX09uUmVuZGVyZXJDb250ZXh0TG9zdCgpOwogICAgICAgICAgICBDMy5JbWFnZUluZm8uT25SZW5kZXJlckNvbnRleHRMb3N0KCk7CiAgICAgICAgICAgIEMzLkltYWdlQXNzZXQuT25SZW5kZXJlckNvbnRleHRMb3N0KCkKICAgICAgICB9CiAgICAgICAgYXN5bmMgX09uUmVuZGVyZXJDb250ZXh0UmVzdG9yZWQoKSB7CiAgICAgICAgICAgIGF3YWl0IHRoaXMuR2V0TWFpblJ1bm5pbmdMYXlvdXQoKS5fTG9hZChudWxsLCB0aGlzLkdldFJlbmRlcmVyKCkpOwogICAgICAgICAgICB0aGlzLl9kaXNwYXRjaGVyLmRpc3BhdGNoRXZlbnQoQzMuTmV3KEMzLkV2ZW50LCAicmVuZGVyZXJjb250ZXh0cmVzdG9yZWQiKSk7CiAgICAgICAgICAgIHRoaXMuU2V0U3VzcGVuZGVkKGZhbHNlKTsKICAgICAgICAgICAgdGhpcy5VcGRhdGVSZW5kZXIoKQogICAgICAgIH0KICAgICAgICBfT25WaXNpYmlsaXR5Q2hhbmdlKGUpIHsKICAgICAgICAgICAgdGhpcy5TZXRTdXNwZW5kZWQoZVsiaGlkZGVuIl0pCiAgICAgICAgfQogICAgICAgIF9PbldpbmRvd0JsdXIoZSkgewogICAgICAgICAgICBpZiAoIXRoaXMuSXNQcmV2aWV3KCkgfHwgIXRoaXMuX3BhdXNlT25CbHVyIHx8IEMzLlBsYXRmb3JtLklzTW9iaWxlKSByZXR1cm47CiAgICAgICAgICAgIGlmICghZS5kYXRhWyJwYXJlbnRIYXNGb2N1cyJdKSB7CiAgICAgICAgICAgICAgICB0aGlzLlNldFN1c3BlbmRlZCh0cnVlKTsKICAgICAgICAgICAgICAgIHRoaXMuX2lzUGF1c2VkT25CbHVyID0gdHJ1ZQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIF9PbldpbmRvd0ZvY3VzKCkgewogICAgICAgICAgICBpZiAoIXRoaXMuX2lzUGF1c2VkT25CbHVyKSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuU2V0U3VzcGVuZGVkKGZhbHNlKTsKICAgICAgICAgICAgdGhpcy5faXNQYXVzZWRPbkJsdXIgPSBmYWxzZQogICAgICAgIH0KICAgICAgICBfUmVxdWVzdEFuaW1hdGlvbkZyYW1lKCkgewogICAgICAgICAgICBjb25zdCB0aWNrQ2FsbGJhY2tzID0gdGhpcy5fdGlja0NhbGxiYWNrczsKICAgICAgICAgICAgaWYgKHRoaXMuX2ZyYW1lcmF0ZU1vZGUgPT09ICJ2c3luYyIpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9yYWZJZCA9PT0gLTEpIHRoaXMuX3JhZklkID0gc2VsZi5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUodGlja0NhbGxiYWNrcy5ub3JtYWwpCiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5fZnJhbWVyYXRlTW9kZSA9PT0gInVubGltaXRlZC10aWNrIikgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuX3J1YWZJZCA9PT0gLTEpIHRoaXMuX3J1YWZJZCA9IEMzLlJlcXVlc3RVbmxpbWl0ZWRBbmltYXRpb25GcmFtZSh0aWNrQ2FsbGJhY2tzLnRpY2tPbmx5KTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9yYWZJZCA9PT0gLTEpIHRoaXMuX3JhZklkID0gc2VsZi5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUodGlja0NhbGxiYWNrcy5yZW5kZXJPbmx5KQogICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuX3J1YWZJZCA9PT0gLTEpIHRoaXMuX3J1YWZJZCA9IEMzLlJlcXVlc3RVbmxpbWl0ZWRBbmltYXRpb25GcmFtZSh0aWNrQ2FsbGJhY2tzLm5vcm1hbCkKICAgICAgICB9CiAgICAgICAgX0NhbmNlbEFuaW1hdGlvbkZyYW1lKCkgewogICAgICAgICAgICBpZiAodGhpcy5fcmFmSWQgIT09CiAgICAgICAgICAgICAgICAtMSkgewogICAgICAgICAgICAgICAgc2VsZi5jYW5jZWxBbmltYXRpb25GcmFtZSh0aGlzLl9yYWZJZCk7CiAgICAgICAgICAgICAgICB0aGlzLl9yYWZJZCA9IC0xCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHRoaXMuX3J1YWZJZCAhPT0gLTEpIHsKICAgICAgICAgICAgICAgIEMzLkNhbmNlbFVubGltaXRlZEFuaW1hdGlvbkZyYW1lKHRoaXMuX3J1YWZJZCk7CiAgICAgICAgICAgICAgICB0aGlzLl9ydWFmSWQgPSAtMQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIElzU3VzcGVuZGVkKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fc3VzcGVuZENvdW50ID4gMAogICAgICAgIH0KICAgICAgICBTZXRTdXNwZW5kZWQocykgewogICAgICAgICAgICBpZiAodGhpcy5Jc0V4cG9ydFRvVmlkZW8oKSkgcmV0dXJuOwogICAgICAgICAgICBjb25zdCB3YXNTdXNwZW5kZWQgPSB0aGlzLklzU3VzcGVuZGVkKCk7CiAgICAgICAgICAgIHRoaXMuX3N1c3BlbmRDb3VudCArPSBzID8gMSA6IC0xOwogICAgICAgICAgICBpZiAodGhpcy5fc3VzcGVuZENvdW50IDwgMCkgdGhpcy5fc3VzcGVuZENvdW50ID0gMDsKICAgICAgICAgICAgY29uc3QgaXNTdXNwZW5kZWQgPSB0aGlzLklzU3VzcGVuZGVkKCk7CiAgICAgICAgICAgIGlmICghd2FzU3VzcGVuZGVkICYmIGlzU3VzcGVuZGVkKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiW0NvbnN0cnVjdF0gU3VzcGVuZGluZyIpOwogICAgICAgICAgICAgICAgdGhpcy5fQ2FuY2VsQW5pbWF0aW9uRnJhbWUoKTsKICAgICAgICAgICAgICAgIHRoaXMuX2Rpc3BhdGNoZXIuZGlzcGF0Y2hFdmVudChDMy5OZXcoQzMuRXZlbnQsCiAgICAgICAgICAgICAgICAgICAgInN1c3BlbmQiKSk7CiAgICAgICAgICAgICAgICB0aGlzLlRyaWdnZXIoQzMuUGx1Z2lucy5TeXN0ZW0uQ25kcy5PblN1c3BlbmQsIG51bGwsIG51bGwpCiAgICAgICAgICAgIH0gZWxzZSBpZiAod2FzU3VzcGVuZGVkICYmICFpc1N1c3BlbmRlZCkgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coIltDb25zdHJ1Y3RdIFJlc3VtaW5nIik7CiAgICAgICAgICAgICAgICBjb25zdCBub3cgPSBwZXJmb3JtYW5jZS5ub3coKTsKICAgICAgICAgICAgICAgIHRoaXMuX2xhc3RUaWNrVGltZSA9IG5vdzsKICAgICAgICAgICAgICAgIHRoaXMuX2Zwc0xhc3RUaW1lID0gbm93OwogICAgICAgICAgICAgICAgdGhpcy5fZnBzRnJhbWVDb3VudCA9IDA7CiAgICAgICAgICAgICAgICB0aGlzLl9mcHMgPSAwOwogICAgICAgICAgICAgICAgdGhpcy5fbWFpblRocmVhZFRpbWUgPSAwOwogICAgICAgICAgICAgICAgdGhpcy5fbWFpblRocmVhZFRpbWVDb3VudGVyID0gMDsKICAgICAgICAgICAgICAgIHRoaXMuX2Rpc3BhdGNoZXIuZGlzcGF0Y2hFdmVudChDMy5OZXcoQzMuRXZlbnQsICJyZXN1bWUiKSk7CiAgICAgICAgICAgICAgICB0aGlzLlRyaWdnZXIoQzMuUGx1Z2lucy5TeXN0ZW0uQ25kcy5PblJlc3VtZSwgbnVsbCwgbnVsbCk7CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuSGl0QnJlYWtwb2ludCgpKSB0aGlzLlRpY2sobm93KQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIF9BZGRCZWhJbnN0VG9UaWNrKGJlaFNka0luc3QpIHsKICAgICAgICAgICAgdGhpcy5fYmVoSW5zdHNUb1RpY2suQWRkKGJlaFNka0luc3QpCiAgICAgICAgfQogICAgICAgIF9BZGRCZWhJbnN0VG9Qb3N0VGljayhiZWhTZGtJbnN0KSB7CiAgICAgICAgICAgIHRoaXMuX2JlaEluc3RzVG9Qb3N0VGljay5BZGQoYmVoU2RrSW5zdCkKICAgICAgICB9CiAgICAgICAgX0FkZEJlaEluc3RUb1RpY2syKGJlaFNka0luc3QpIHsKICAgICAgICAgICAgdGhpcy5fYmVoSW5zdHNUb1RpY2syLkFkZChiZWhTZGtJbnN0KQogICAgICAgIH0KICAgICAgICBfUmVtb3ZlQmVoSW5zdFRvVGljayhiZWhTZGtJbnN0KSB7CiAgICAgICAgICAgIHRoaXMuX2JlaEluc3RzVG9UaWNrLlJlbW92ZShiZWhTZGtJbnN0KQogICAgICAgIH0KICAgICAgICBfUmVtb3ZlQmVoSW5zdFRvUG9zdFRpY2soYmVoU2RrSW5zdCkgewogICAgICAgICAgICB0aGlzLl9iZWhJbnN0c1RvUG9zdFRpY2suUmVtb3ZlKGJlaFNka0luc3QpCiAgICAgICAgfQogICAgICAgIF9SZW1vdmVCZWhJbnN0VG9UaWNrMihiZWhTZGtJbnN0KSB7CiAgICAgICAgICAgIHRoaXMuX2JlaEluc3RzVG9UaWNrMi5SZW1vdmUoYmVoU2RrSW5zdCkKICAgICAgICB9CiAgICAgICAgX0JlaGF2aW9yVGljaygpIHsKICAgICAgICAgICAgdGhpcy5fYmVoSW5zdHNUb1RpY2suU2V0UXVldWVpbmdFbmFibGVkKHRydWUpOwogICAgICAgICAgICBmb3IgKGNvbnN0IGJpIG9mIHRoaXMuX2JlaEluc3RzVG9UaWNrKSBiaS5UaWNrKCk7CiAgICAgICAgICAgIHRoaXMuX2JlaEluc3RzVG9UaWNrLlNldFF1ZXVlaW5nRW5hYmxlZChmYWxzZSkKICAgICAgICB9CiAgICAgICAgX0JlaGF2aW9yUG9zdFRpY2soKSB7CiAgICAgICAgICAgIHRoaXMuX2JlaEluc3RzVG9Qb3N0VGljay5TZXRRdWV1ZWluZ0VuYWJsZWQodHJ1ZSk7CiAgICAgICAgICAgIGZvciAoY29uc3QgYmkgb2YgdGhpcy5fYmVoSW5zdHNUb1Bvc3RUaWNrKSBiaS5Qb3N0VGljaygpOwogICAgICAgICAgICB0aGlzLl9iZWhJbnN0c1RvUG9zdFRpY2suU2V0UXVldWVpbmdFbmFibGVkKGZhbHNlKQogICAgICAgIH0KICAgICAgICBfQmVoYXZpb3JUaWNrMigpIHsKICAgICAgICAgICAgdGhpcy5fYmVoSW5zdHNUb1RpY2syLlNldFF1ZXVlaW5nRW5hYmxlZCh0cnVlKTsKICAgICAgICAgICAgZm9yIChjb25zdCBiaSBvZiB0aGlzLl9iZWhJbnN0c1RvVGljazIpIGJpLlRpY2syKCk7CiAgICAgICAgICAgIHRoaXMuX2JlaEluc3RzVG9UaWNrMi5TZXRRdWV1ZWluZ0VuYWJsZWQoZmFsc2UpCiAgICAgICAgfSogX0RlYnVnQmVoYXZpb3JUaWNrKCkgewogICAgICAgICAgICB0aGlzLl9iZWhJbnN0c1RvVGljay5TZXRRdWV1ZWluZ0VuYWJsZWQodHJ1ZSk7CiAgICAgICAgICAgIGZvciAoY29uc3QgYmkgb2YgdGhpcy5fYmVoSW5zdHNUb1RpY2spIHsKICAgICAgICAgICAgICAgIGNvbnN0IHJldCA9CiAgICAgICAgICAgICAgICAgICAgYmkuVGljaygpOwogICAgICAgICAgICAgICAgaWYgKEMzLklzSXRlcmF0b3IocmV0KSkgeWllbGQqIHJldAogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuX2JlaEluc3RzVG9UaWNrLlNldFF1ZXVlaW5nRW5hYmxlZChmYWxzZSkKICAgICAgICB9KiBfRGVidWdCZWhhdmlvclBvc3RUaWNrKCkgewogICAgICAgICAgICB0aGlzLl9iZWhJbnN0c1RvUG9zdFRpY2suU2V0UXVldWVpbmdFbmFibGVkKHRydWUpOwogICAgICAgICAgICBmb3IgKGNvbnN0IGJpIG9mIHRoaXMuX2JlaEluc3RzVG9Qb3N0VGljaykgewogICAgICAgICAgICAgICAgY29uc3QgcmV0ID0gYmkuUG9zdFRpY2soKTsKICAgICAgICAgICAgICAgIGlmIChDMy5Jc0l0ZXJhdG9yKHJldCkpIHlpZWxkKiByZXQKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLl9iZWhJbnN0c1RvUG9zdFRpY2suU2V0UXVldWVpbmdFbmFibGVkKGZhbHNlKQogICAgICAgIH0qIF9EZWJ1Z0JlaGF2aW9yVGljazIoKSB7CiAgICAgICAgICAgIHRoaXMuX2JlaEluc3RzVG9UaWNrMi5TZXRRdWV1ZWluZ0VuYWJsZWQodHJ1ZSk7CiAgICAgICAgICAgIGZvciAoY29uc3QgYmkgb2YgdGhpcy5fYmVoSW5zdHNUb1RpY2syKSB7CiAgICAgICAgICAgICAgICBjb25zdCByZXQgPSBiaS5UaWNrMigpOwogICAgICAgICAgICAgICAgaWYgKEMzLklzSXRlcmF0b3IocmV0KSkgeWllbGQqIHJldAogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuX2JlaEluc3RzVG9UaWNrMi5TZXRRdWV1ZWluZ0VuYWJsZWQoZmFsc2UpCiAgICAgICAgfQogICAgICAgIGFzeW5jIFRpY2sodGltZXN0YW1wLAogICAgICAgICAgICBpc0RlYnVnU3RlcCwgbW9kZSkgewogICAgICAgICAgICB0aGlzLl9oYXNTdGFydGVkVGlja2luZyA9IHRydWU7CiAgICAgICAgICAgIGNvbnN0IGlzQmFja2dyb3VuZFdha2UgPSBtb2RlID09PSAiYmFja2dyb3VuZC13YWtlIjsKICAgICAgICAgICAgY29uc3Qgc2hvdWxkUmVuZGVyID0gbW9kZSAhPT0gImJhY2tncm91bmQtd2FrZSIgJiYgbW9kZSAhPT0gInNraXAtcmVuZGVyIjsKICAgICAgICAgICAgaWYgKCF0aGlzLl9oYXNTdGFydGVkIHx8IHRoaXMuSXNTdXNwZW5kZWQoKSAmJiAhaXNEZWJ1Z1N0ZXAgJiYgIWlzQmFja2dyb3VuZFdha2UpIHJldHVybjsKICAgICAgICAgICAgY29uc3Qgc3RhcnRUaW1lID0gcGVyZm9ybWFuY2Uubm93KCk7CiAgICAgICAgICAgIHRoaXMuX2lzSW5UaWNrID0gdHJ1ZTsKICAgICAgICAgICAgdGhpcy5fTWVhc3VyZUR0KHRpbWVzdGFtcCB8fCAwKTsKICAgICAgICAgICAgY29uc3QgYmVmb3JlUHJlVGlja1JldCA9IHRoaXMuU3RlcF9CZWZvcmVQcmVUaWNrKCk7CiAgICAgICAgICAgIGlmICh0aGlzLklzRGVidWdnaW5nKCkpIGF3YWl0IGJlZm9yZVByZVRpY2tSZXQ7CiAgICAgICAgICAgIGNvbnN0IHByZXRpY2tSZXQgPSB0aGlzLl9kaXNwYXRjaGVyLmRpc3BhdGNoRXZlbnRBbmRXYWl0X0FzeW5jT3B0aW9uYWwodGhpcy5fZXZlbnRPYmplY3RzWyJwcmV0aWNrIl0pOwogICAgICAgICAgICBpZiAocHJldGlja1JldCBpbnN0YW5jZW9mIFByb21pc2UpIGF3YWl0IHByZXRpY2tSZXQ7CiAgICAgICAgICAgIGNvbnN0IGFmdGVyUHJlVGlja1JldCA9IHRoaXMuU3RlcF9BZnRlclByZVRpY2soKTsKICAgICAgICAgICAgaWYgKHRoaXMuSXNEZWJ1Z2dpbmcoKSkgYXdhaXQgYWZ0ZXJQcmVUaWNrUmV0OwogICAgICAgICAgICBpZiAodGhpcy5fTmVlZHNIYW5kbGVTYXZlT3JMb2FkKCkpIGF3YWl0IHRoaXMuX0hhbmRsZVNhdmVPckxvYWQoKTsKICAgICAgICAgICAgaWYgKHRoaXMuR2V0TGF5b3V0TWFuYWdlcigpLklzUGVuZGluZ0NoYW5nZU1haW5MYXlvdXQoKSkgYXdhaXQgdGhpcy5fTWF5YmVDaGFuZ2VMYXlvdXQoKTsKICAgICAgICAgICAgY29uc3QgcnVuRXZlbnRzUmV0ID0gdGhpcy5TdGVwX1J1bkV2ZW50c0V0YygpOwogICAgICAgICAgICBpZiAodGhpcy5Jc0RlYnVnZ2luZygpKSBhd2FpdCBydW5FdmVudHNSZXQ7CiAgICAgICAgICAgIGlmIChzaG91bGRSZW5kZXIpIHRoaXMuUmVuZGVyKCk7CiAgICAgICAgICAgIGlmICh0aGlzLklzRXhwb3J0VG9WaWRlbygpKSB7CiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLl9FeHBvcnRUb1ZpZGVvQWRkRnJhbWUoKTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLkdldEdhbWVUaW1lKCkgPj0gdGhpcy5HZXRFeHBvcnRWaWRlb0R1cmF0aW9uKCkpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9FeHBvcnRUb1ZpZGVvRmluaXNoKCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCF0aGlzLklzU3VzcGVuZGVkKCkgJiYgIWlzQmFja2dyb3VuZFdha2UpIHRoaXMuX1JlcXVlc3RBbmltYXRpb25GcmFtZSgpOwogICAgICAgICAgICB0aGlzLl90aWNrQ291bnQrKzsKICAgICAgICAgICAgdGhpcy5fdGlja0NvdW50Tm9TYXZlKys7CiAgICAgICAgICAgIHRoaXMuX2lzSW5UaWNrID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX21haW5UaHJlYWRUaW1lQ291bnRlciArPSBwZXJmb3JtYW5jZS5ub3coKSAtIHN0YXJ0VGltZQogICAgICAgIH0KICAgICAgICBhc3luYyBTdGVwX0JlZm9yZVByZVRpY2soKSB7CiAgICAgICAgICAgIGNvbnN0IGV2ZW50U2hlZXRNYW5hZ2VyID0gdGhpcy5fZXZlbnRTaGVldE1hbmFnZXI7CiAgICAgICAgICAgIGNvbnN0IGlzRGVidWcgPSB0aGlzLklzRGVidWcoKTsKICAgICAgICAgICAgdGhpcy5GbHVzaFBlbmRpbmdJbnN0YW5jZXMoKTsKICAgICAgICAgICAgZXZlbnRTaGVldE1hbmFnZXIuQmxvY2tGbHVzaGluZ0luc3RhbmNlcyh0cnVlKTsKICAgICAgICAgICAgdGhpcy5QdXNoQ3VycmVudExheW91dCh0aGlzLkdldE1haW5SdW5uaW5nTGF5b3V0KCkpOwogICAgICAgICAgICBpZiAoaXNEZWJ1ZykgQzNEZWJ1Z2dlci5TdGFydE1lYXN1cmluZ1RpbWUoKTsKICAgICAgICAgICAgaWYgKHRoaXMuSXNEZWJ1Z2dpbmcoKSkgYXdhaXQgZXZlbnRTaGVldE1hbmFnZXIuRGVidWdSdW5TY2hlZHVsZWRXYWl0cygpOwogICAgICAgICAgICBlbHNlIGV2ZW50U2hlZXRNYW5hZ2VyLlJ1blNjaGVkdWxlZFdhaXRzKCk7CiAgICAgICAgICAgIGlmIChpc0RlYnVnKSBDM0RlYnVnZ2VyLkFkZEV2ZW50c1RpbWUoKTsKICAgICAgICAgICAgdGhpcy5Qb3BDdXJyZW50TGF5b3V0KCk7CiAgICAgICAgICAgIGV2ZW50U2hlZXRNYW5hZ2VyLkJsb2NrRmx1c2hpbmdJbnN0YW5jZXMoZmFsc2UpOwogICAgICAgICAgICB0aGlzLkZsdXNoUGVuZGluZ0luc3RhbmNlcygpOwogICAgICAgICAgICBldmVudFNoZWV0TWFuYWdlci5CbG9ja0ZsdXNoaW5nSW5zdGFuY2VzKHRydWUpCiAgICAgICAgfQogICAgICAgIGFzeW5jIFN0ZXBfQWZ0ZXJQcmVUaWNrKCkgewogICAgICAgICAgICBjb25zdCBpc0RlYnVnID0gdGhpcy5Jc0RlYnVnKCk7CiAgICAgICAgICAgIGNvbnN0IGlzRGVidWdnaW5nID0gdGhpcy5Jc0RlYnVnZ2luZygpOwogICAgICAgICAgICBjb25zdCBkaXNwYXRjaGVyID0gdGhpcy5fZGlzcGF0Y2hlcjsKICAgICAgICAgICAgY29uc3QgZXZlbnRPYmplY3RzID0gdGhpcy5fZXZlbnRPYmplY3RzOwogICAgICAgICAgICBjb25zdCB1c2VyU2NyaXB0RXZlbnRPYmplY3RzID0gdGhpcy5fdXNlclNjcmlwdEV2ZW50T2JqZWN0czsKICAgICAgICAgICAgaWYgKGlzRGVidWcpIEMzRGVidWdnZXIuU3RhcnRNZWFzdXJpbmdUaW1lKCk7CiAgICAgICAgICAgIGlmIChpc0RlYnVnZ2luZykgYXdhaXQgdGhpcy5EZWJ1Z0l0ZXJhdGVBbmRCcmVhayh0aGlzLl9EZWJ1Z0JlaGF2aW9yVGljaygpKTsKICAgICAgICAgICAgZWxzZSB0aGlzLl9CZWhhdmlvclRpY2soKTsKICAgICAgICAgICAgaWYgKGlzRGVidWdnaW5nKSBhd2FpdCB0aGlzLkRlYnVnSXRlcmF0ZUFuZEJyZWFrKHRoaXMuX0RlYnVnQmVoYXZpb3JQb3N0VGljaygpKTsKICAgICAgICAgICAgZWxzZSB0aGlzLl9CZWhhdmlvclBvc3RUaWNrKCk7CiAgICAgICAgICAgIGlmIChpc0RlYnVnKSBDM0RlYnVnZ2VyLkFkZEJlaGF2aW9yVGlja1RpbWUoKTsKICAgICAgICAgICAgaWYgKGlzRGVidWcpIEMzRGVidWdnZXIuU3RhcnRNZWFzdXJpbmdUaW1lKCk7CiAgICAgICAgICAgIGlmIChpc0RlYnVnZ2luZykgYXdhaXQgdGhpcy5EZWJ1Z0ZpcmVHZW5lcmF0b3JFdmVudEFuZEJyZWFrKGV2ZW50T2JqZWN0c1sidGljayJdKTsKICAgICAgICAgICAgZWxzZSBkaXNwYXRjaGVyLmRpc3BhdGNoRXZlbnQoZXZlbnRPYmplY3RzWyJ0aWNrIl0pOwogICAgICAgICAgICBpZiAoaXNEZWJ1ZykgQzNEZWJ1Z2dlci5BZGRQbHVnaW5UaWNrVGltZSgpOwogICAgICAgICAgICB0aGlzLl9ldmVudFNoZWV0TWFuYWdlci5CbG9ja0ZsdXNoaW5nSW5zdGFuY2VzKGZhbHNlKTsKICAgICAgICAgICAgdGhpcy5EaXNwYXRjaFVzZXJTY3JpcHRFdmVudCh1c2VyU2NyaXB0RXZlbnRPYmplY3RzWyJ0aWNrIl0pCiAgICAgICAgfQogICAgICAgIGFzeW5jIFN0ZXBfUnVuRXZlbnRzRXRjKCkgewogICAgICAgICAgICBjb25zdCBldmVudFNoZWV0TWFuYWdlciA9CiAgICAgICAgICAgICAgICB0aGlzLl9ldmVudFNoZWV0TWFuYWdlcjsKICAgICAgICAgICAgY29uc3QgZGlzcGF0Y2hlciA9IHRoaXMuX2Rpc3BhdGNoZXI7CiAgICAgICAgICAgIGNvbnN0IGV2ZW50T2JqZWN0cyA9IHRoaXMuX2V2ZW50T2JqZWN0czsKICAgICAgICAgICAgY29uc3QgaXNEZWJ1ZyA9IHRoaXMuSXNEZWJ1ZygpOwogICAgICAgICAgICBjb25zdCBpc0RlYnVnZ2luZyA9IHRoaXMuSXNEZWJ1Z2dpbmcoKTsKICAgICAgICAgICAgaWYgKGlzRGVidWcpIEMzRGVidWdnZXIuU3RhcnRNZWFzdXJpbmdUaW1lKCk7CiAgICAgICAgICAgIGlmIChpc0RlYnVnZ2luZykgYXdhaXQgZXZlbnRTaGVldE1hbmFnZXIuRGVidWdSdW5FdmVudHModGhpcy5fbGF5b3V0TWFuYWdlcik7CiAgICAgICAgICAgIGVsc2UgZXZlbnRTaGVldE1hbmFnZXIuUnVuRXZlbnRzKHRoaXMuX2xheW91dE1hbmFnZXIpOwogICAgICAgICAgICBpZiAoaXNEZWJ1ZykgQzNEZWJ1Z2dlci5BZGRFdmVudHNUaW1lKCk7CiAgICAgICAgICAgIHRoaXMuX2NvbGxpc2lvbkVuZ2luZS5DbGVhclJlZ2lzdGVyZWRDb2xsaXNpb25zKCk7CiAgICAgICAgICAgIHRoaXMuX1JlbGVhc2VJbnN0YW5jZXNBdEVuZE9mVGljaygpOwogICAgICAgICAgICB0aGlzLl9pc0xheW91dEZpcnN0VGljayA9IGZhbHNlOwogICAgICAgICAgICBldmVudFNoZWV0TWFuYWdlci5CbG9ja0ZsdXNoaW5nSW5zdGFuY2VzKHRydWUpOwogICAgICAgICAgICBpZiAoaXNEZWJ1ZykgQzNEZWJ1Z2dlci5TdGFydE1lYXN1cmluZ1RpbWUoKTsKICAgICAgICAgICAgaWYgKGlzRGVidWdnaW5nKSBhd2FpdCB0aGlzLkRlYnVnSXRlcmF0ZUFuZEJyZWFrKHRoaXMuX0RlYnVnQmVoYXZpb3JUaWNrMigpKTsKICAgICAgICAgICAgZWxzZSB0aGlzLl9CZWhhdmlvclRpY2syKCk7CiAgICAgICAgICAgIGlmIChpc0RlYnVnKSBDM0RlYnVnZ2VyLkFkZEJlaGF2aW9yVGlja1RpbWUoKTsKICAgICAgICAgICAgaWYgKGlzRGVidWcpIEMzRGVidWdnZXIuU3RhcnRNZWFzdXJpbmdUaW1lKCk7CiAgICAgICAgICAgIGlmIChpc0RlYnVnZ2luZykgYXdhaXQgdGhpcy5EZWJ1Z0ZpcmVHZW5lcmF0b3JFdmVudEFuZEJyZWFrKGV2ZW50T2JqZWN0c1sidGljazIiXSk7CiAgICAgICAgICAgIGVsc2UgZGlzcGF0Y2hlci5kaXNwYXRjaEV2ZW50KGV2ZW50T2JqZWN0c1sidGljazIiXSk7CiAgICAgICAgICAgIGlmIChpc0RlYnVnKSBDM0RlYnVnZ2VyLkFkZFBsdWdpblRpY2tUaW1lKCk7CiAgICAgICAgICAgIGV2ZW50U2hlZXRNYW5hZ2VyLkJsb2NrRmx1c2hpbmdJbnN0YW5jZXMoZmFsc2UpOwogICAgICAgICAgICBpZiAoaXNEZWJ1Z2dpbmcpIGF3YWl0IGV2ZW50U2hlZXRNYW5hZ2VyLlJ1blF1ZXVlZERlYnVnVHJpZ2dlcnNBc3luYygpCiAgICAgICAgfQogICAgICAgIF9SZWxlYXNlSW5zdGFuY2VzQXRFbmRPZlRpY2soKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9pbnN0YW5jZXNUb1JlbGVhc2VBdEVuZE9mVGljay5zaXplID09PQogICAgICAgICAgICAgICAgMCkgcmV0dXJuOwogICAgICAgICAgICBjb25zdCBkaXNwYXRjaGVyID0gdGhpcy5fZGlzcGF0Y2hlcjsKICAgICAgICAgICAgZGlzcGF0Y2hlci5TZXREZWxheVJlbW92ZUV2ZW50c0VuYWJsZWQodHJ1ZSk7CiAgICAgICAgICAgIGZvciAoY29uc3Qgb2JqZWN0Q2xhc3Mgb2YgdGhpcy5faW5zdGFuY2VzVG9SZWxlYXNlQWZmZWN0ZWRPYmplY3RDbGFzc2VzKSBvYmplY3RDbGFzcy5HZXRTb2xTdGFjaygpLlJlbW92ZUluc3RhbmNlcyh0aGlzLl9pbnN0YW5jZXNUb1JlbGVhc2VBdEVuZE9mVGljayk7CiAgICAgICAgICAgIHRoaXMuX2luc3RhbmNlc1RvUmVsZWFzZUFmZmVjdGVkT2JqZWN0Q2xhc3Nlcy5jbGVhcigpOwogICAgICAgICAgICB0aGlzLl9ldmVudFNoZWV0TWFuYWdlci5SZW1vdmVJbnN0YW5jZXNGcm9tU2NoZWR1bGVkV2FpdHModGhpcy5faW5zdGFuY2VzVG9SZWxlYXNlQXRFbmRPZlRpY2spOwogICAgICAgICAgICBmb3IgKGNvbnN0IGluc3Qgb2YgdGhpcy5faW5zdGFuY2VzVG9SZWxlYXNlQXRFbmRPZlRpY2spIGluc3QuUmVsZWFzZSgpOwogICAgICAgICAgICB0aGlzLl9pbnN0YW5jZXNUb1JlbGVhc2VBdEVuZE9mVGljay5jbGVhcigpOwogICAgICAgICAgICBkaXNwYXRjaGVyLlNldERlbGF5UmVtb3ZlRXZlbnRzRW5hYmxlZChmYWxzZSkKICAgICAgICB9CiAgICAgICAgYXN5bmMgX01heWJlQ2hhbmdlTGF5b3V0KCkgewogICAgICAgICAgICBjb25zdCBsYXlvdXRNYW5hZ2VyID0KICAgICAgICAgICAgICAgIHRoaXMuR2V0TGF5b3V0TWFuYWdlcigpOwogICAgICAgICAgICBsZXQgaSA9IDA7CiAgICAgICAgICAgIHdoaWxlIChsYXlvdXRNYW5hZ2VyLklzUGVuZGluZ0NoYW5nZU1haW5MYXlvdXQoKSAmJiBpKysgPCAxMCkgYXdhaXQgdGhpcy5fRG9DaGFuZ2VMYXlvdXQobGF5b3V0TWFuYWdlci5HZXRQZW5kaW5nQ2hhbmdlTWFpbkxheW91dCgpKQogICAgICAgIH0KICAgICAgICBfTWVhc3VyZUR0KHRpbWVzdGFtcCkgewogICAgICAgICAgICBsZXQgZHRSYXcgPSAwOwogICAgICAgICAgICBpZiAodGhpcy5Jc0V4cG9ydFRvVmlkZW8oKSkgewogICAgICAgICAgICAgICAgZHRSYXcgPSAxIC8gdGhpcy5HZXRFeHBvcnRWaWRlb0ZyYW1lcmF0ZSgpOwogICAgICAgICAgICAgICAgdGhpcy5fZHRSYXcgPSBkdFJhdzsKICAgICAgICAgICAgICAgIHRoaXMuX2R0MSA9IGR0UmF3CiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5fbGFzdFRpY2tUaW1lICE9PSAwKSB7CiAgICAgICAgICAgICAgICBjb25zdCBtc0RpZmYgPSBNYXRoLm1heCh0aW1lc3RhbXAgLSB0aGlzLl9sYXN0VGlja1RpbWUsIDApOwogICAgICAgICAgICAgICAgZHRSYXcgPSBtc0RpZmYgLyAxRTM7CiAgICAgICAgICAgICAgICBpZiAoZHRSYXcgPiAuNSkgZHRSYXcgPSAwOwogICAgICAgICAgICAgICAgdGhpcy5fZHRSYXcgPSBkdFJhdzsKICAgICAgICAgICAgICAgIGNvbnN0IG1heER0MSA9IDEgLyB0aGlzLl9taW5pbXVtRnJhbWVyYXRlOwogICAgICAgICAgICAgICAgdGhpcy5fZHQxID0gTWF0aC5taW4oZHRSYXcsIG1heER0MSkKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLl9sYXN0VGlja1RpbWUgPQogICAgICAgICAgICAgICAgdGltZXN0YW1wOwogICAgICAgICAgICB0aGlzLl9kdCA9IHRoaXMuX2R0MSAqIHRoaXMuX3RpbWVTY2FsZTsKICAgICAgICAgICAgdGhpcy5fZ2FtZVRpbWUuQWRkKHRoaXMuX2R0KTsKICAgICAgICAgICAgdGhpcy5fZ2FtZVRpbWVSYXcuQWRkKGR0UmF3ICogdGhpcy5fdGltZVNjYWxlKTsKICAgICAgICAgICAgdGhpcy5fd2FsbFRpbWUuQWRkKHRoaXMuX2R0MSk7CiAgICAgICAgICAgIGZvciAoY29uc3QgW2luc3QsIGluc3RUaW1lXSBvZiB0aGlzLl9pbnN0YW5jZVRpbWVzKSBpbnN0VGltZS5BZGQodGhpcy5fZHQxICogaW5zdC5HZXRUaW1lU2NhbGUoKSk7CiAgICAgICAgICAgIGlmICh0aGlzLl9jYW52YXNNYW5hZ2VyKSB0aGlzLl9jYW52YXNNYW5hZ2VyLl9VcGRhdGVUaWNrKCk7CiAgICAgICAgICAgIGlmICh0aW1lc3RhbXAgLSB0aGlzLl9mcHNMYXN0VGltZSA+PSAxRTMpIHsKICAgICAgICAgICAgICAgIHRoaXMuX2Zwc0xhc3RUaW1lICs9IDFFMzsKICAgICAgICAgICAgICAgIGlmICh0aW1lc3RhbXAgLSB0aGlzLl9mcHNMYXN0VGltZSA+PSAxRTMpIHRoaXMuX2Zwc0xhc3RUaW1lID0gdGltZXN0YW1wOwogICAgICAgICAgICAgICAgdGhpcy5fZnBzID0gdGhpcy5fZnBzRnJhbWVDb3VudDsKICAgICAgICAgICAgICAgIHRoaXMuX2Zwc0ZyYW1lQ291bnQgPSAwOwogICAgICAgICAgICAgICAgdGhpcy5fbWFpblRocmVhZFRpbWUgPSBNYXRoLm1pbih0aGlzLl9tYWluVGhyZWFkVGltZUNvdW50ZXIgLwogICAgICAgICAgICAgICAgICAgIDFFMywgMSk7CiAgICAgICAgICAgICAgICB0aGlzLl9tYWluVGhyZWFkVGltZUNvdW50ZXIgPSAwOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuX2NhbnZhc01hbmFnZXIpIHRoaXMuX2NhbnZhc01hbmFnZXIuX1VwZGF0ZTFzRnJhbWVSYW5nZSgpOwogICAgICAgICAgICAgICAgdGhpcy5fY29sbGlzaW9uRW5naW5lLl9VcGRhdGUxc1N0YXRzKCk7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5Jc0RlYnVnKCkpIEMzRGVidWdnZXIuVXBkYXRlMXNQZXJmU3RhdHMoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuX2Zwc0ZyYW1lQ291bnQrKwogICAgICAgIH0KICAgICAgICBfU2V0VHJhY2tpbmdJbnN0YW5jZVRpbWUoaW5zdCwgZW5hYmxlKSB7CiAgICAgICAgICAgIGlmIChlbmFibGUpIHsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5faW5zdGFuY2VUaW1lcy5oYXMoaW5zdCkpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBpbnN0VGltZSA9IEMzLk5ldyhDMy5LYWhhblN1bSk7CiAgICAgICAgICAgICAgICAgICAgaW5zdFRpbWUuQ29weSh0aGlzLl9nYW1lVGltZSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5faW5zdGFuY2VUaW1lcy5zZXQoaW5zdCwgaW5zdFRpbWUpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB0aGlzLl9pbnN0YW5jZVRpbWVzLmRlbGV0ZShpbnN0KQogICAgICAgIH0KICAgICAgICBfR2V0SW5zdGFuY2VHYW1lVGltZShpbnN0KSB7CiAgICAgICAgICAgIGNvbnN0IGluc3RUaW1lID0gdGhpcy5faW5zdGFuY2VUaW1lcy5nZXQoaW5zdCk7CiAgICAgICAgICAgIHJldHVybiBpbnN0VGltZSA/IGluc3RUaW1lLkdldCgpIDogdGhpcy5HZXRHYW1lVGltZSgpCiAgICAgICAgfQogICAgICAgIGFzeW5jIF9Eb0NoYW5nZUxheW91dChjaGFuZ2VUb0xheW91dCkgewogICAgICAgICAgICBjb25zdCBkaXNwYXRjaGVyID0gdGhpcy5fZGlzcGF0Y2hlcjsKICAgICAgICAgICAgY29uc3QgbGF5b3V0TWFuYWdlciA9IHRoaXMuR2V0TGF5b3V0TWFuYWdlcigpOwogICAgICAgICAgICBjb25zdCBwcmV2TGF5b3V0ID0gbGF5b3V0TWFuYWdlci5HZXRNYWluUnVubmluZ0xheW91dCgpOwogICAgICAgICAgICBhd2FpdCBwcmV2TGF5b3V0Ll9TdG9wUnVubmluZygpOwogICAgICAgICAgICBwcmV2TGF5b3V0Ll9VbmxvYWQoY2hhbmdlVG9MYXlvdXQsIHRoaXMuR2V0UmVuZGVyZXIoKSk7CiAgICAgICAgICAgIGlmIChwcmV2TGF5b3V0ID09PSBjaGFuZ2VUb0xheW91dCkgdGhpcy5fZXZlbnRTaGVldE1hbmFnZXIuQ2xlYXJBbGxTY2hlZHVsZWRXYWl0cygpOwogICAgICAgICAgICB0aGlzLl9jb2xsaXNpb25FbmdpbmUuQ2xlYXJSZWdpc3RlcmVkQ29sbGlzaW9ucygpOwogICAgICAgICAgICB0aGlzLl9SZWxlYXNlSW5zdGFuY2VzQXRFbmRPZlRpY2soKTsKICAgICAgICAgICAgZGlzcGF0Y2hlci5kaXNwYXRjaEV2ZW50KHRoaXMuX2V2ZW50T2JqZWN0c1siYmVmb3JlbGF5b3V0Y2hhbmdlIl0pOwogICAgICAgICAgICBDMy5Bc3luY2lmeS5TZXRIaWdoVGhyb3VnaHB1dE1vZGUodHJ1ZSk7CiAgICAgICAgICAgIGF3YWl0IGNoYW5nZVRvTGF5b3V0Ll9Mb2FkKHByZXZMYXlvdXQsIHRoaXMuR2V0UmVuZGVyZXIoKSk7CiAgICAgICAgICAgIEMzLkFzeW5jaWZ5LlNldEhpZ2hUaHJvdWdocHV0TW9kZShmYWxzZSk7CiAgICAgICAgICAgIGF3YWl0IGNoYW5nZVRvTGF5b3V0Ll9TdGFydFJ1bm5pbmcoZmFsc2UpOwogICAgICAgICAgICBkaXNwYXRjaGVyLmRpc3BhdGNoRXZlbnQodGhpcy5fZXZlbnRPYmplY3RzWyJsYXlvdXRjaGFuZ2UiXSk7CiAgICAgICAgICAgIHRoaXMuVXBkYXRlUmVuZGVyKCk7CiAgICAgICAgICAgIHRoaXMuX2lzTGF5b3V0Rmlyc3RUaWNrID0gdHJ1ZTsKICAgICAgICAgICAgdGhpcy5GbHVzaFBlbmRpbmdJbnN0YW5jZXMoKTsKICAgICAgICAgICAgdGhpcy5fRXhwb3J0VG9WaWRlb0FkZEtleWZyYW1lKCkKICAgICAgICB9CiAgICAgICAgVXBkYXRlUmVuZGVyKCkgewogICAgICAgICAgICB0aGlzLl9uZWVkUmVuZGVyID0gdHJ1ZQogICAgICAgIH0KICAgICAgICBHZXRXZWJHTFJlbmRlcmVyKCkgewogICAgICAgICAgICBpZiAoIXRoaXMuX2NhbnZhc01hbmFnZXIpIHJldHVybiBudWxsOwogICAgICAgICAgICByZXR1cm4gdGhpcy5fY2FudmFzTWFuYWdlci5HZXRXZWJHTFJlbmRlcmVyKCkKICAgICAgICB9CiAgICAgICAgR2V0V2ViR1BVUmVuZGVyZXIoKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5fY2FudmFzTWFuYWdlcikgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9jYW52YXNNYW5hZ2VyLkdldFdlYkdQVVJlbmRlcmVyKCkKICAgICAgICB9CiAgICAgICAgR2V0UmVuZGVyZXIoKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5fY2FudmFzTWFuYWdlcikgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9jYW52YXNNYW5hZ2VyLkdldFJlbmRlcmVyKCkKICAgICAgICB9CiAgICAgICAgUmVuZGVyKCkgewogICAgICAgICAgICBjb25zdCBjYW52YXNNYW5hZ2VyID0gdGhpcy5fY2FudmFzTWFuYWdlcjsKICAgICAgICAgICAgaWYgKCFjYW52YXNNYW5hZ2VyIHx8IGNhbnZhc01hbmFnZXIuSXNSZW5kZXJlckNvbnRleHRMb3N0KCkpIHJldHVybjsKICAgICAgICAgICAgY29uc3QgcmVuZGVyZXIgPSB0aGlzLkdldFJlbmRlcmVyKCk7CiAgICAgICAgICAgIGNvbnN0IHN1cHBvcnRzR1BVUHJvZmlsaW5nID0gcmVuZGVyZXIuU3VwcG9ydHNHUFVQcm9maWxpbmcoKTsKICAgICAgICAgICAgY29uc3QgaXNXZWJHTFByb2ZpbGluZyA9IHN1cHBvcnRzR1BVUHJvZmlsaW5nICYmIHJlbmRlcmVyLklzV2ViR0woKTsKICAgICAgICAgICAgY29uc3QgaXNXZWJHUFVQcm9maWxpbmcgPSBzdXBwb3J0c0dQVVByb2ZpbGluZyAmJiByZW5kZXJlci5Jc1dlYkdQVSgpOwogICAgICAgICAgICBpZiAoaXNXZWJHTFByb2ZpbGluZykgcmVuZGVyZXIuQ2hlY2tGb3JRdWVyeVJlc3VsdHMoKTsKICAgICAgICAgICAgaWYgKCF0aGlzLl9uZWVkUmVuZGVyICYmICF0aGlzLklzRXhwb3J0VG9WaWRlbygpKSB7CiAgICAgICAgICAgICAgICByZW5kZXJlci5JbmNyZW1lbnRGcmFtZU51bWJlcigpOwogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgbGF5b3V0ID0gdGhpcy5fbGF5b3V0TWFuYWdlci5HZXRNYWluUnVubmluZ0xheW91dCgpOwogICAgICAgICAgICByZW5kZXJlci5TdGFydCgpOwogICAgICAgICAgICBjb25zdCBpc0RlYnVnID0gdGhpcy5Jc0RlYnVnKCk7CiAgICAgICAgICAgIGlmIChpc0RlYnVnKSBDM0RlYnVnZ2VyLlN0YXJ0TWVhc3VyaW5nVGltZSgpOwogICAgICAgICAgICB0aGlzLl9uZWVkUmVuZGVyID0gZmFsc2U7CiAgICAgICAgICAgIGxldCB3ZWJnbEZyYW1lUXVlcnkgPSBudWxsOwogICAgICAgICAgICBpZiAoaXNXZWJHTFByb2ZpbGluZykgewogICAgICAgICAgICAgICAgd2ViZ2xGcmFtZVF1ZXJ5ID0gY2FudmFzTWFuYWdlci5HZXRHUFVGcmFtZVRpbWluZ3NCdWZmZXIoKS5BZGRUaW1lRWxhcHNlZFF1ZXJ5KCk7CiAgICAgICAgICAgICAgICByZW5kZXJlci5TdGFydFF1ZXJ5KHdlYmdsRnJhbWVRdWVyeSkKICAgICAgICAgICAgfQogICAgICAgICAgICBsZXQgd2ViZ3B1RnJhbWVUaW1pbmdzID0gbnVsbDsKICAgICAgICAgICAgaWYgKGlzV2ViR1BVUHJvZmlsaW5nKSB7CiAgICAgICAgICAgICAgICB3ZWJncHVGcmFtZVRpbWluZ3MgPSByZW5kZXJlci5TdGFydEZyYW1lVGltaW5nKCgxICsKICAgICAgICAgICAgICAgICAgICBsYXlvdXQuR2V0TGF5ZXJDb3VudCgpKSAqIDIpOwogICAgICAgICAgICAgICAgcmVuZGVyZXIuV3JpdGVUaW1lc3RhbXAoMCkKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGhpcy5Vc2VzM0RGZWF0dXJlcygpICYmIGNhbnZhc01hbmFnZXIuR2V0Q3VycmVudEZ1bGxzY3JlZW5TY2FsaW5nUXVhbGl0eSgpID09PSAibG93IikgcmVuZGVyZXIuU2V0Rml4ZWRTaXplRGVwdGhCdWZmZXIoY2FudmFzTWFuYWdlci5HZXREcmF3V2lkdGgoKSwgY2FudmFzTWFuYWdlci5HZXREcmF3SGVpZ2h0KCkpOwogICAgICAgICAgICBlbHNlIHJlbmRlcmVyLlNldEF1dG9TaXplRGVwdGhCdWZmZXIoKTsKICAgICAgICAgICAgdGhpcy5fUmVuZGVyKHRoaXMuR2V0UmVuZGVyZXIoKSwgbGF5b3V0KTsKICAgICAgICAgICAgaWYgKHdlYmdsRnJhbWVRdWVyeSkgcmVuZGVyZXIuRW5kUXVlcnkod2ViZ2xGcmFtZVF1ZXJ5KTsKICAgICAgICAgICAgaWYgKGlzV2ViR1BVUHJvZmlsaW5nKSB7CiAgICAgICAgICAgICAgICByZW5kZXJlci5Xcml0ZVRpbWVzdGFtcCgxKTsKICAgICAgICAgICAgICAgIHRoaXMuX2NhbnZhc01hbmFnZXIuX0FkZFdlYkdQVUZyYW1lVGltaW5nKHdlYmdwdUZyYW1lVGltaW5ncykKICAgICAgICAgICAgfQogICAgICAgICAgICByZW5kZXJlci5GaW5pc2goKTsKICAgICAgICAgICAgaWYgKGlzRGVidWcpIHsKICAgICAgICAgICAgICAgIEMzRGVidWdnZXIuQWRkRHJhd0NhbGxzVGltZSgpOwogICAgICAgICAgICAgICAgQzNEZWJ1Z2dlci5VcGRhdGVJbnNwZWN0SGlnaGxpZ2h0KCkKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoY2FudmFzTWFuYWdlcikgY2FudmFzTWFuYWdlci5fTWF5YmVUYWtlU25hcHNob3QoKQogICAgICAgIH0KICAgICAgICBfUmVuZGVyKHJlbmRlcmVyLCBsYXlvdXQpIHsKICAgICAgICAgICAgcmVuZGVyZXIuU2V0VGV4dHVyZUZpbGxNb2RlKCk7CiAgICAgICAgICAgIHJlbmRlcmVyLlNldEFscGhhQmxlbmQoKTsKICAgICAgICAgICAgcmVuZGVyZXIuU2V0Q29sb3JSZ2JhKDEsIDEsIDEsIDEpOwogICAgICAgICAgICByZW5kZXJlci5TZXRSZW5kZXJUYXJnZXQobnVsbCk7CiAgICAgICAgICAgIHJlbmRlcmVyLlNldFRleHR1cmUobnVsbCk7CiAgICAgICAgICAgIHJlbmRlcmVyLlNldERlcHRoRW5hYmxlZCh0aGlzLlVzZXMzREZlYXR1cmVzKCkpOwogICAgICAgICAgICBsYXlvdXQuRHJhdyhyZW5kZXJlcikKICAgICAgICB9CiAgICAgICAgVHJpZ2dlcihtZXRob2QsIGluc3QsIGJlaGF2aW9yVHlwZSkgewogICAgICAgICAgICBpZiAoIXRoaXMuX2hhc1N0YXJ0ZWQpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgY29uc3QgaXNUb3BMZXZlbCA9ICF0aGlzLl9pc0luVGljayAmJiAhdGhpcy5fZXZlbnRTaGVldE1hbmFnZXIuSXNJblRyaWdnZXIoKTsKICAgICAgICAgICAgbGV0IHN0YXJ0VGltZSA9IDA7CiAgICAgICAgICAgIGlmIChpc1RvcExldmVsKSBzdGFydFRpbWUgPQogICAgICAgICAgICAgICAgcGVyZm9ybWFuY2Uubm93KCk7CiAgICAgICAgICAgIGNvbnN0IGlzRGVidWcgPSB0aGlzLklzRGVidWcoKTsKICAgICAgICAgICAgaWYgKGlzRGVidWcpIHRoaXMuU2V0RGVidWdnaW5nRW5hYmxlZChmYWxzZSk7CiAgICAgICAgICAgIGNvbnN0IHJldCA9IHRoaXMuX2V2ZW50U2hlZXRNYW5hZ2VyLl9UcmlnZ2VyKHRoaXMuX2xheW91dE1hbmFnZXIsIG1ldGhvZCwgaW5zdCwgYmVoYXZpb3JUeXBlKTsKICAgICAgICAgICAgaWYgKGlzVG9wTGV2ZWwpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHRyaWdnZXJUaW1lID0gcGVyZm9ybWFuY2Uubm93KCkgLSBzdGFydFRpbWU7CiAgICAgICAgICAgICAgICB0aGlzLl9tYWluVGhyZWFkVGltZUNvdW50ZXIgKz0gdHJpZ2dlclRpbWU7CiAgICAgICAgICAgICAgICBpZiAoaXNEZWJ1ZykgQzNEZWJ1Z2dlci5BZGRUcmlnZ2Vyc1RpbWUodHJpZ2dlclRpbWUpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGlzRGVidWcpIHRoaXMuU2V0RGVidWdnaW5nRW5hYmxlZCh0cnVlKTsKICAgICAgICAgICAgcmV0dXJuIHJldAogICAgICAgIH0KICAgICAgICBEZWJ1Z1RyaWdnZXIobWV0aG9kLCBpbnN0LCBiZWhhdmlvclR5cGUpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLklzRGVidWcoKSkgcmV0dXJuIHRoaXMuVHJpZ2dlcihtZXRob2QsIGluc3QsIGJlaGF2aW9yVHlwZSk7CiAgICAgICAgICAgIGlmICh0aGlzLkhpdEJyZWFrcG9pbnQoKSkgdGhyb3cgbmV3IEVycm9yKCJjYWxsZWQgRGVidWdUcmlnZ2VyKCkgd2hpbGUgc3RvcHBlZCBvbiBicmVha3BvaW50Iik7CiAgICAgICAgICAgIGlmICghdGhpcy5faXNJblRpY2sgJiYgIXRoaXMuX2V2ZW50U2hlZXRNYW5hZ2VyLklzSW5UcmlnZ2VyKCkpIHRocm93IG5ldyBFcnJvcigiY2FsbGVkIERlYnVnVHJpZ2dlcigpIG91dHNpZGUgb2YgZXZlbnQgY29kZSAtIHVzZSBUcmlnZ2VyQXN5bmMoKSBpbnN0ZWFkIik7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9ldmVudFNoZWV0TWFuYWdlci5fRGVidWdUcmlnZ2VyKHRoaXMuX2xheW91dE1hbmFnZXIsIG1ldGhvZCwgaW5zdCwgYmVoYXZpb3JUeXBlKQogICAgICAgIH0KICAgICAgICBhc3luYyBUcmlnZ2VyQXN5bmMobWV0aG9kLCBpbnN0LCBiZWhhdmlvclR5cGUpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLklzRGVidWdnaW5nKCkpIHJldHVybiB0aGlzLlRyaWdnZXIobWV0aG9kLCBpbnN0LCBiZWhhdmlvclR5cGUpOwogICAgICAgICAgICBpZiAoIXRoaXMuX2hhc1N0YXJ0ZWQpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgaWYgKHRoaXMuSGl0QnJlYWtwb2ludCgpKSByZXR1cm4gdGhpcy5fZXZlbnRTaGVldE1hbmFnZXIuUXVldWVEZWJ1Z1RyaWdnZXIobWV0aG9kLCBpbnN0LCBiZWhhdmlvclR5cGUpOwogICAgICAgICAgICBpZiAoIXRoaXMuR2V0TWFpblJ1bm5pbmdMYXlvdXQoKSkgcmV0dXJuIHRoaXMuX2V2ZW50U2hlZXRNYW5hZ2VyLlF1ZXVlVHJpZ2dlcihtZXRob2QsCiAgICAgICAgICAgICAgICBpbnN0LCBiZWhhdmlvclR5cGUpOwogICAgICAgICAgICBjb25zdCBzdGFydFRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKTsKICAgICAgICAgICAgY29uc3QgaXRlciA9IHRoaXMuX2V2ZW50U2hlZXRNYW5hZ2VyLl9EZWJ1Z1RyaWdnZXIodGhpcy5fbGF5b3V0TWFuYWdlciwgbWV0aG9kLCBpbnN0LCBiZWhhdmlvclR5cGUpOwogICAgICAgICAgICBsZXQgcmVzdWx0ID0gaXRlci5uZXh0KCk7CiAgICAgICAgICAgIHdoaWxlICghcmVzdWx0LmRvbmUpIHsKICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuRGVidWdCcmVhayhyZXN1bHQudmFsdWUpOwogICAgICAgICAgICAgICAgcmVzdWx0ID0gaXRlci5uZXh0KCkKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIXRoaXMuSXNTdXNwZW5kZWQoKSAmJiAhdGhpcy5fZXZlbnRTaGVldE1hbmFnZXIuSXNJblRyaWdnZXIoKSkgewogICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5fZXZlbnRTaGVldE1hbmFnZXIuUnVuUXVldWVkRGVidWdUcmlnZ2Vyc0FzeW5jKCk7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5faGFzU3RhcnRlZFRpY2tpbmcgJiYgIXRoaXMuX2lzSW5UaWNrKSB0aGlzLl9SZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuX21haW5UaHJlYWRUaW1lQ291bnRlciArPSBwZXJmb3JtYW5jZS5ub3coKSAtIHN0YXJ0VGltZTsKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdC52YWx1ZQogICAgICAgIH0KICAgICAgICBGYXN0VHJpZ2dlcihtZXRob2QsIGluc3QsIHZhbHVlKSB7CiAgICAgICAgICAgIGNvbnN0IGlzRGVidWcgPSB0aGlzLklzRGVidWcoKTsKICAgICAgICAgICAgaWYgKGlzRGVidWcpIHRoaXMuU2V0RGVidWdnaW5nRW5hYmxlZChmYWxzZSk7CiAgICAgICAgICAgIGNvbnN0IHJldCA9IHRoaXMuX2V2ZW50U2hlZXRNYW5hZ2VyLl9GYXN0VHJpZ2dlcih0aGlzLl9sYXlvdXRNYW5hZ2VyLCBtZXRob2QsIGluc3QsIHZhbHVlKTsKICAgICAgICAgICAgaWYgKGlzRGVidWcpIHRoaXMuU2V0RGVidWdnaW5nRW5hYmxlZCh0cnVlKTsKICAgICAgICAgICAgcmV0dXJuIHJldAogICAgICAgIH0KICAgICAgICBEZWJ1Z0Zhc3RUcmlnZ2VyKG1ldGhvZCwgaW5zdCwgdmFsdWUpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2V2ZW50U2hlZXRNYW5hZ2VyLl9EZWJ1Z0Zhc3RUcmlnZ2VyKHRoaXMuX2xheW91dE1hbmFnZXIsIG1ldGhvZCwgaW5zdCwgdmFsdWUpCiAgICAgICAgfQogICAgICAgIFNjaGVkdWxlVHJpZ2dlcnMoZikgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fc2NoZWR1bGVUcmlnZ2Vyc1Rocm90dGxlLkFkZChmKQogICAgICAgIH0KICAgICAgICBQdXNoQ3VycmVudExheW91dChsYXlvdXQpIHsKICAgICAgICAgICAgdGhpcy5fY3VycmVudExheW91dFN0YWNrLnB1c2gobGF5b3V0KQogICAgICAgIH0KICAgICAgICBQb3BDdXJyZW50TGF5b3V0KCkgewogICAgICAgICAgICBpZiAoIXRoaXMuX2N1cnJlbnRMYXlvdXRTdGFjay5sZW5ndGgpIHRocm93IG5ldyBFcnJvcigibGF5b3V0IHN0YWNrIGVtcHR5Iik7CiAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRMYXlvdXRTdGFjay5wb3AoKQogICAgICAgIH0KICAgICAgICBHZXRDdXJyZW50TGF5b3V0KCkgewogICAgICAgICAgICBpZiAoIXRoaXMuX2N1cnJlbnRMYXlvdXRTdGFjay5sZW5ndGgpIHJldHVybiB0aGlzLkdldE1haW5SdW5uaW5nTGF5b3V0KCk7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9jdXJyZW50TGF5b3V0U3RhY2suYXQoLTEpCiAgICAgICAgfQogICAgICAgIEdldER0KGluc3QpIHsKICAgICAgICAgICAgaWYgKCFpbnN0IHx8IGluc3QuR2V0VGltZVNjYWxlKCkgPT09IC0xKSByZXR1cm4gdGhpcy5fZHQ7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9kdDEgKiBpbnN0LkdldFRpbWVTY2FsZSgpCiAgICAgICAgfQogICAgICAgIF9HZXREdEZhc3QoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9kdAogICAgICAgIH0KICAgICAgICBHZXREdDEoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9kdDEKICAgICAgICB9CiAgICAgICAgR2V0RHRSYXcoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9kdFJhdwogICAgICAgIH0KICAgICAgICBHZXRUaW1lU2NhbGUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl90aW1lU2NhbGUKICAgICAgICB9CiAgICAgICAgU2V0VGltZVNjYWxlKHRzKSB7CiAgICAgICAgICAgIGlmIChpc05hTih0cykgfHwgdHMgPCAwKSB0cyA9IDA7CiAgICAgICAgICAgIHRoaXMuX3RpbWVTY2FsZSA9IHRzCiAgICAgICAgfQogICAgICAgIFNldE1pbmltdW1GcmFtZXJhdGUoZnBzKSB7CiAgICAgICAgICAgIHRoaXMuX21pbmltdW1GcmFtZXJhdGUgPSBDMy5jbGFtcChmcHMsCiAgICAgICAgICAgICAgICAxLCAxMjApCiAgICAgICAgfQogICAgICAgIEdldE1pbmltdW1GcmFtZXJhdGUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9taW5pbXVtRnJhbWVyYXRlCiAgICAgICAgfQogICAgICAgIEdldEZQUygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2ZwcwogICAgICAgIH0KICAgICAgICBHZXRNYWluVGhyZWFkVGltZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX21haW5UaHJlYWRUaW1lCiAgICAgICAgfQogICAgICAgIEdldFN0YXJ0VGltZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3N0YXJ0VGltZQogICAgICAgIH0KICAgICAgICBHZXRHYW1lVGltZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2dhbWVUaW1lLkdldCgpCiAgICAgICAgfQogICAgICAgIEdldEdhbWVUaW1lUmF3KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZ2FtZVRpbWVSYXcuR2V0KCkKICAgICAgICB9CiAgICAgICAgR2V0V2FsbFRpbWUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl93YWxsVGltZS5HZXQoKQogICAgICAgIH0KICAgICAgICBHZXRUaWNrQ291bnQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl90aWNrQ291bnQKICAgICAgICB9CiAgICAgICAgR2V0VGlja0NvdW50Tm9TYXZlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fdGlja0NvdW50Tm9TYXZlCiAgICAgICAgfQogICAgICAgIEdldE9iamVjdENvdW50KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fb2JqZWN0Q291bnQKICAgICAgICB9CiAgICAgICAgR2V0UHJvamVjdE5hbWUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9wcm9qZWN0TmFtZQogICAgICAgIH0KICAgICAgICBHZXRQcm9qZWN0VmVyc2lvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3Byb2plY3RWZXJzaW9uCiAgICAgICAgfQogICAgICAgIEdldFByb2plY3RVbmlxdWVJZCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3Byb2plY3RVbmlxdWVJZAogICAgICAgIH0KICAgICAgICBHZXRBcHBJZCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2FwcElkCiAgICAgICAgfQogICAgICAgIEdldEluc3RhbmNlQnlVSUQodWlkKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9pc0xvYWRpbmdTdGF0ZSkgdGhyb3cgbmV3IEVycm9yKCJjYW5ub3QgY2FsbCB3aGlsZSBsb2FkaW5nIHN0YXRlIC0gd2FpdCB1bnRpbCBhZnRlcmxvYWQgZXZlbnQiKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2luc3RhbmNlc0J5VWlkLmdldCh1aWQpIHx8IG51bGwKICAgICAgICB9CiAgICAgICAgX1JlZnJlc2hVaWRNYXAoKSB7CiAgICAgICAgICAgIHRoaXMuX2luc3RhbmNlc0J5VWlkLmNsZWFyKCk7CiAgICAgICAgICAgIGZvciAoY29uc3Qgb2JqZWN0Q2xhc3Mgb2YgdGhpcy5fYWxsT2JqZWN0Q2xhc3NlcykgewogICAgICAgICAgICAgICAgaWYgKG9iamVjdENsYXNzLklzRmFtaWx5KCkpIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgZm9yIChjb25zdCBpbnN0IG9mIG9iamVjdENsYXNzLkdldEluc3RhbmNlcygpKSB0aGlzLl9pbnN0YW5jZXNCeVVpZC5zZXQoaW5zdC5HZXRVSUQoKSwgaW5zdCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBJc1ByZXZpZXcoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9leHBvcnRUeXBlID09PSAicHJldmlldyIKICAgICAgICB9CiAgICAgICAgSXNEZWJ1ZygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2lzRGVidWcKICAgICAgICB9CiAgICAgICAgR2V0RXhwb3J0VHlwZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2V4cG9ydFR5cGUKICAgICAgICB9CiAgICAgICAgSXNDb3Jkb3ZhKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZXhwb3J0VHlwZSA9PT0gImNvcmRvdmEiCiAgICAgICAgfQogICAgICAgIElzQW5kcm9pZFdlYlZpZXcoKSB7CiAgICAgICAgICAgIHJldHVybiBDMy5QbGF0Zm9ybS5PUyA9PT0gIkFuZHJvaWQiICYmICh0aGlzLl9leHBvcnRUeXBlID09PQogICAgICAgICAgICAgICAgImNvcmRvdmEiIHx8IHRoaXMuX2V4cG9ydFR5cGUgPT09ICJwbGF5YWJsZS1hZCIgfHwgdGhpcy5fZXhwb3J0VHlwZSA9PT0gImluc3RhbnQtZ2FtZXMiKQogICAgICAgIH0KICAgICAgICBJc2lPU0NvcmRvdmEoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pc2lPU0NvcmRvdmEKICAgICAgICB9CiAgICAgICAgSXNpT1NXZWJWaWV3KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faXNpT1NXZWJWaWV3CiAgICAgICAgfQogICAgICAgIEdldENvbGxpc2lvbkVuZ2luZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NvbGxpc2lvbkVuZ2luZQogICAgICAgIH0KICAgICAgICBHZXRTb2xpZEJlaGF2aW9yKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fcGx1Z2luTWFuYWdlci5HZXRTb2xpZEJlaGF2aW9yKCkKICAgICAgICB9CiAgICAgICAgR2V0SnVtcHRocnVCZWhhdmlvcigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3BsdWdpbk1hbmFnZXIuR2V0SnVtcHRocnVCZWhhdmlvcigpCiAgICAgICAgfQogICAgICAgIFVzZXMzREZlYXR1cmVzKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fdXNlczNkRmVhdHVyZXMKICAgICAgICB9CiAgICAgICAgR2V0WlNjYWxlRmFjdG9yKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5HZXRSZW5kZXJlcigpLkdldFpBeGlzU2NhbGVGYWN0b3IodGhpcy5HZXRWaWV3cG9ydEhlaWdodCgpKQogICAgICAgIH0KICAgICAgICBHZXREZWZhdWx0Q2FtZXJhWih2aWV3SCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5HZXRSZW5kZXJlcigpLkdldERlZmF1bHRDYW1lcmFaKHZpZXdIIHx8CiAgICAgICAgICAgICAgICB0aGlzLkdldFZpZXdwb3J0SGVpZ2h0KCkpCiAgICAgICAgfQogICAgICAgIElzTGF5b3V0Rmlyc3RUaWNrKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faXNMYXlvdXRGaXJzdFRpY2sKICAgICAgICB9CiAgICAgICAgU2V0UGl4ZWxSb3VuZGluZ0VuYWJsZWQoZSkgewogICAgICAgICAgICBlID0gISFlOwogICAgICAgICAgICBpZiAodGhpcy5faXNQaXhlbFJvdW5kaW5nRW5hYmxlZCA9PT0gZSkgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl9pc1BpeGVsUm91bmRpbmdFbmFibGVkID0gZTsKICAgICAgICAgICAgdGhpcy5HZXRMYXlvdXRNYW5hZ2VyKCkuU2V0QWxsTGF5ZXJNVkNoYW5nZWQoKTsKICAgICAgICAgICAgdGhpcy5VcGRhdGVSZW5kZXIoKQogICAgICAgIH0KICAgICAgICBJc1BpeGVsUm91bmRpbmdFbmFibGVkKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faXNQaXhlbFJvdW5kaW5nRW5hYmxlZAogICAgICAgIH0KICAgICAgICBTYXZlVG9TbG90KHNsb3ROYW1lKSB7CiAgICAgICAgICAgIHRoaXMuX3NhdmVUb1Nsb3ROYW1lID0gc2xvdE5hbWUKICAgICAgICB9CiAgICAgICAgTG9hZEZyb21TbG90KHNsb3ROYW1lKSB7CiAgICAgICAgICAgIHRoaXMuX2xvYWRGcm9tU2xvdE5hbWUgPSBzbG90TmFtZQogICAgICAgIH0KICAgICAgICBMb2FkRnJvbUpzb25TdHJpbmcoc3RyKSB7CiAgICAgICAgICAgIHRoaXMuX2xvYWRGcm9tSnNvbiA9IHN0cgogICAgICAgIH0KICAgICAgICBHZXRMYXN0U2F2ZUpzb25TdHJpbmcoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9sYXN0U2F2ZUpzb24KICAgICAgICB9CiAgICAgICAgX05lZWRzSGFuZGxlU2F2ZU9yTG9hZCgpIHsKICAgICAgICAgICAgcmV0dXJuICEhKHRoaXMuX3NhdmVUb1Nsb3ROYW1lIHx8CiAgICAgICAgICAgICAgICB0aGlzLl9sb2FkRnJvbVNsb3ROYW1lIHx8IHRoaXMuX2xvYWRGcm9tSnNvbiAhPT0gbnVsbCkKICAgICAgICB9CiAgICAgICAgYXN5bmMgX0hhbmRsZVNhdmVPckxvYWQoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9zYXZlVG9TbG90TmFtZSkgewogICAgICAgICAgICAgICAgdGhpcy5GbHVzaFBlbmRpbmdJbnN0YW5jZXMoKTsKICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuX0RvU2F2ZVRvU2xvdCh0aGlzLl9zYXZlVG9TbG90TmFtZSk7CiAgICAgICAgICAgICAgICB0aGlzLl9DbGVhclNhdmVPckxvYWQoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLl9sb2FkRnJvbVNsb3ROYW1lKSB7CiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLl9Eb0xvYWRGcm9tU2xvdCh0aGlzLl9sb2FkRnJvbVNsb3ROYW1lKTsKICAgICAgICAgICAgICAgIHRoaXMuX0NsZWFyU2F2ZU9yTG9hZCgpOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuSXNEZWJ1ZygpKSBDM0RlYnVnZ2VyLlN0ZXBJZlBhdXNlZEluRGVidWdnZXIoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLl9sb2FkRnJvbUpzb24gIT09IG51bGwpIHsKICAgICAgICAgICAgICAgIHRoaXMuRmx1c2hQZW5kaW5nSW5zdGFuY2VzKCk7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuX0RvTG9hZEZyb21Kc29uU3RyaW5nKHRoaXMuX2xvYWRGcm9tSnNvbik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbGFzdFNhdmVKc29uID0gdGhpcy5fbG9hZEZyb21Kc29uOwogICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuVHJpZ2dlckFzeW5jKEMzLlBsdWdpbnMuU3lzdGVtLkNuZHMuT25Mb2FkQ29tcGxldGUsIG51bGwpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2xhc3RTYXZlSnNvbiA9ICIiCiAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCJbQ29uc3RydWN0XSBGYWlsZWQgdG8gbG9hZCBzdGF0ZSBmcm9tIEpTT04gc3RyaW5nOiAiLCBlcnIpOwogICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuVHJpZ2dlckFzeW5jKEMzLlBsdWdpbnMuU3lzdGVtLkNuZHMuT25Mb2FkRmFpbGVkLCBudWxsKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5fQ2xlYXJTYXZlT3JMb2FkKCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBfQ2xlYXJTYXZlT3JMb2FkKCkgewogICAgICAgICAgICB0aGlzLl9zYXZlVG9TbG90TmFtZSA9ICIiOwogICAgICAgICAgICB0aGlzLl9sb2FkRnJvbVNsb3ROYW1lID0gIiI7CiAgICAgICAgICAgIHRoaXMuX2xvYWRGcm9tSnNvbiA9IG51bGwKICAgICAgICB9CiAgICAgICAgX0dldFByb2plY3RTdG9yYWdlKCkgewogICAgICAgICAgICBpZiAoIXRoaXMuX3Byb2plY3RTdG9yYWdlKSB0aGlzLl9wcm9qZWN0U3RvcmFnZSA9IGxvY2FsZm9yYWdlLmNyZWF0ZUluc3RhbmNlKHsKICAgICAgICAgICAgICAgIG5hbWU6ICJjMy1sb2NhbHN0b3JhZ2UtIiArIHRoaXMuR2V0UHJvamVjdFVuaXF1ZUlkKCksCiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogdGhpcy5HZXRQcm9qZWN0TmFtZSgpCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXR1cm4gdGhpcy5fcHJvamVjdFN0b3JhZ2UKICAgICAgICB9CiAgICAgICAgX0dldFNhdmVnYW1lc1N0b3JhZ2UoKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5fc2F2ZWdhbWVzU3RvcmFnZSkgdGhpcy5fc2F2ZWdhbWVzU3RvcmFnZSA9IGxvY2FsZm9yYWdlLmNyZWF0ZUluc3RhbmNlKHsKICAgICAgICAgICAgICAgIG5hbWU6ICJjMy1zYXZlZ2FtZXMtIiArIHRoaXMuR2V0UHJvamVjdFVuaXF1ZUlkKCksCiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogdGhpcy5HZXRQcm9qZWN0TmFtZSgpCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXR1cm4gdGhpcy5fc2F2ZWdhbWVzU3RvcmFnZQogICAgICAgIH0KICAgICAgICBhc3luYyBfRG9TYXZlVG9TbG90KHNsb3ROYW1lKSB7CiAgICAgICAgICAgIGNvbnN0IHNhdmVKc29uID0gYXdhaXQgdGhpcy5fU2F2ZVRvSnNvblN0cmluZygpOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5fR2V0U2F2ZWdhbWVzU3RvcmFnZSgpLnNldEl0ZW0oc2xvdE5hbWUsIHNhdmVKc29uKTsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJbQ29uc3RydWN0XSBTYXZlZCBzdGF0ZSB0byBzdG9yYWdlICgiICsgc2F2ZUpzb24ubGVuZ3RoICsgIiBjaGFycykiKTsKICAgICAgICAgICAgICAgIHRoaXMuX2xhc3RTYXZlSnNvbiA9CiAgICAgICAgICAgICAgICAgICAgc2F2ZUpzb247CiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLlRyaWdnZXJBc3luYyhDMy5QbHVnaW5zLlN5c3RlbS5DbmRzLk9uU2F2ZUNvbXBsZXRlLCBudWxsKTsKICAgICAgICAgICAgICAgIHRoaXMuX2xhc3RTYXZlSnNvbiA9ICIiCiAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcigiW0NvbnN0cnVjdF0gRmFpbGVkIHRvIHNhdmUgc3RhdGUgdG8gc3RvcmFnZTogIiwgZXJyKTsKICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuVHJpZ2dlckFzeW5jKEMzLlBsdWdpbnMuU3lzdGVtLkNuZHMuT25TYXZlRmFpbGVkLCBudWxsKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGFzeW5jIF9Eb0xvYWRGcm9tU2xvdChzbG90TmFtZSkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgY29uc3QgbG9hZEpzb24gPSBhd2FpdCB0aGlzLl9HZXRTYXZlZ2FtZXNTdG9yYWdlKCkuZ2V0SXRlbShzbG90TmFtZSk7CiAgICAgICAgICAgICAgICBpZiAoIWxvYWRKc29uKSB0aHJvdyBuZXcgRXJyb3IoImVtcHR5IHNsb3QiKTsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJbQ29uc3RydWN0XSBMb2FkZWQgc3RhdGUgZnJvbSBzdG9yYWdlICgiICsgbG9hZEpzb24ubGVuZ3RoICsgIiBjaGFycykiKTsKICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuX0RvTG9hZEZyb21Kc29uU3RyaW5nKGxvYWRKc29uKTsKICAgICAgICAgICAgICAgIHRoaXMuX2xhc3RTYXZlSnNvbiA9IGxvYWRKc29uOwogICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5UcmlnZ2VyQXN5bmMoQzMuUGx1Z2lucy5TeXN0ZW0uQ25kcy5PbkxvYWRDb21wbGV0ZSwgbnVsbCk7CiAgICAgICAgICAgICAgICB0aGlzLl9sYXN0U2F2ZUpzb24gPSAiIgogICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIltDb25zdHJ1Y3RdIEZhaWxlZCB0byBsb2FkIHN0YXRlIGZyb20gc3RvcmFnZTogIiwgZXJyKTsKICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuVHJpZ2dlckFzeW5jKEMzLlBsdWdpbnMuU3lzdGVtLkNuZHMuT25Mb2FkRmFpbGVkLCBudWxsKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGFzeW5jIF9TYXZlVG9Kc29uU3RyaW5nKCkgewogICAgICAgICAgICBjb25zdCBvID0gewogICAgICAgICAgICAgICAgImMzc2F2ZSI6IHRydWUsCiAgICAgICAgICAgICAgICAidmVyc2lvbiI6IDEsCiAgICAgICAgICAgICAgICAicnQiOiB7CiAgICAgICAgICAgICAgICAgICAgInRpbWUiOiB0aGlzLkdldEdhbWVUaW1lKCksCiAgICAgICAgICAgICAgICAgICAgInRpbWVSYXciOiB0aGlzLkdldEdhbWVUaW1lUmF3KCksCiAgICAgICAgICAgICAgICAgICAgIndhbGx0aW1lIjogdGhpcy5HZXRXYWxsVGltZSgpLAogICAgICAgICAgICAgICAgICAgICJ0aW1lc2NhbGUiOiB0aGlzLkdldFRpbWVTY2FsZSgpLAogICAgICAgICAgICAgICAgICAgICJ0aWNrY291bnQiOiB0aGlzLkdldFRpY2tDb3VudCgpLAogICAgICAgICAgICAgICAgICAgICJuZXh0X3VpZCI6IHRoaXMuX25leHRVaWQsCiAgICAgICAgICAgICAgICAgICAgInJ1bm5pbmdfbGF5b3V0IjogdGhpcy5HZXRNYWluUnVubmluZ0xheW91dCgpLkdldFNJRCgpLAogICAgICAgICAgICAgICAgICAgICJzdGFydF90aW1lX29mZnNldCI6IERhdGUubm93KCkgLSB0aGlzLl9zdGFydFRpbWUKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAidHlwZXMiOiB7fSwKICAgICAgICAgICAgICAgICJsYXlvdXRzIjoge30sCiAgICAgICAgICAgICAgICAiZXZlbnRzIjogdGhpcy5fZXZlbnRTaGVldE1hbmFnZXIuX1NhdmVUb0pzb24oKSwKICAgICAgICAgICAgICAgICJ0aW1lbGluZXMiOiB0aGlzLl90aW1lbGluZU1hbmFnZXIuX1NhdmVUb0pzb24oKSwKICAgICAgICAgICAgICAgICJ1c2VyX3NjcmlwdF9kYXRhIjogbnVsbAogICAgICAgICAgICB9OwogICAgICAgICAgICBmb3IgKGNvbnN0IG9iamVjdENsYXNzIG9mIHRoaXMuX2FsbE9iamVjdENsYXNzZXMpIHsKICAgICAgICAgICAgICAgIGlmIChvYmplY3RDbGFzcy5Jc0ZhbWlseSgpIHx8IG9iamVjdENsYXNzLkhhc05vU2F2ZUJlaGF2aW9yKCkpIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgb1sidHlwZXMiXVtvYmplY3RDbGFzcy5HZXRTSUQoKS50b1N0cmluZygpXSA9IG9iamVjdENsYXNzLl9TYXZlVG9Kc29uKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IgKGNvbnN0IGxheW91dCBvZiB0aGlzLl9sYXlvdXRNYW5hZ2VyLkdldEFsbExheW91dHMoKSkgb1sibGF5b3V0cyJdW2xheW91dC5HZXRTSUQoKS50b1N0cmluZygpXSA9CiAgICAgICAgICAgICAgICBsYXlvdXQuX1NhdmVUb0pzb24oKTsKICAgICAgICAgICAgY29uc3Qgc2F2ZUV2ZW50ID0gdGhpcy5fQ3JlYXRlVXNlclNjcmlwdEV2ZW50KCJzYXZlIik7CiAgICAgICAgICAgIHNhdmVFdmVudC5zYXZlRGF0YSA9IG51bGw7CiAgICAgICAgICAgIGF3YWl0IHRoaXMuRGlzcGF0Y2hVc2VyU2NyaXB0RXZlbnRBc3luY1dhaXQoc2F2ZUV2ZW50KTsKICAgICAgICAgICAgb1sidXNlcl9zY3JpcHRfZGF0YSJdID0gc2F2ZUV2ZW50LnNhdmVEYXRhOwogICAgICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkobykKICAgICAgICB9CiAgICAgICAgSXNMb2FkaW5nU3RhdGUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pc0xvYWRpbmdTdGF0ZQogICAgICAgIH0KICAgICAgICBhc3luYyBfRG9Mb2FkRnJvbUpzb25TdHJpbmcoanNvblN0cikgewogICAgICAgICAgICBjb25zdCBsYXlvdXRNYW5hZ2VyID0gdGhpcy5HZXRMYXlvdXRNYW5hZ2VyKCk7CiAgICAgICAgICAgIGNvbnN0IG8gPSBKU09OLnBhcnNlKGpzb25TdHIpOwogICAgICAgICAgICBpZiAob1siYzJzYXZlIl0pIHRocm93IG5ldyBFcnJvcigiQzIgc2F2ZXMgYXJlIGluY29tcGF0aWJsZSB3aXRoIEMzIHJ1bnRpbWUiKTsKICAgICAgICAgICAgaWYgKCFvWyJjM3NhdmUiXSkgdGhyb3cgbmV3IEVycm9yKCJub3QgdmFsaWQgQzMgc2F2ZSBkYXRhIik7CiAgICAgICAgICAgIGlmIChvWyJ2ZXJzaW9uIl0gPiAxKSB0aHJvdyBuZXcgRXJyb3IoIkMzIHNhdmUgZGF0YSBmcm9tIGZ1dHVyZSB2ZXJzaW9uIik7CiAgICAgICAgICAgIHRoaXMuX2Rpc3BhdGNoZXIuZGlzcGF0Y2hFdmVudChDMy5OZXcoQzMuRXZlbnQsICJiZWZvcmVsb2FkIikpOwogICAgICAgICAgICBmb3IgKGNvbnN0IGluc3Qgb2YgdGhpcy5hbGxJbnN0YW5jZXMoKSkgewogICAgICAgICAgICAgICAgY29uc3Qgb2JqZWN0Q2xhc3MgPSBpbnN0LkdldE9iamVjdENsYXNzKCk7CiAgICAgICAgICAgICAgICBpZiAob2JqZWN0Q2xhc3MuSGFzTm9TYXZlQmVoYXZpb3IoKSkgY29udGludWU7CiAgICAgICAgICAgICAgICBpbnN0Ll9PbkJlZm9yZUxvYWQoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IHJ0ID0gb1sicnQiXTsKICAgICAgICAgICAgdGhpcy5fZ2FtZVRpbWUuU2V0KHJ0WyJ0aW1lIl0pOwogICAgICAgICAgICBpZiAocnQuaGFzT3duUHJvcGVydHkoInRpbWVSYXciKSkgdGhpcy5fZ2FtZVRpbWVSYXcuU2V0KHJ0WyJ0aW1lUmF3Il0pOwogICAgICAgICAgICB0aGlzLl93YWxsVGltZS5TZXQocnRbIndhbGx0aW1lIl0pOwogICAgICAgICAgICB0aGlzLl90aW1lU2NhbGUgPSBydFsidGltZXNjYWxlIl07CiAgICAgICAgICAgIHRoaXMuX3RpY2tDb3VudCA9IHJ0WyJ0aWNrY291bnQiXTsKICAgICAgICAgICAgdGhpcy5fc3RhcnRUaW1lID0KICAgICAgICAgICAgICAgIERhdGUubm93KCkgLSBydFsic3RhcnRfdGltZV9vZmZzZXQiXTsKICAgICAgICAgICAgY29uc3QgbGF5b3V0U2lkID0gcnRbInJ1bm5pbmdfbGF5b3V0Il07CiAgICAgICAgICAgIHRoaXMuX2lzTG9hZGluZ1N0YXRlID0gdHJ1ZTsKICAgICAgICAgICAgbGV0IGNoYW5nZWRMYXlvdXQgPSBmYWxzZTsKICAgICAgICAgICAgaWYgKGxheW91dFNpZCAhPT0gdGhpcy5HZXRNYWluUnVubmluZ0xheW91dCgpLkdldFNJRCgpKSB7CiAgICAgICAgICAgICAgICBjb25zdCBjaGFuZ2VUb0xheW91dCA9IGxheW91dE1hbmFnZXIuR2V0TGF5b3V0QnlTSUQobGF5b3V0U2lkKTsKICAgICAgICAgICAgICAgIGlmIChjaGFuZ2VUb0xheW91dCkgewogICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuX0RvQ2hhbmdlTGF5b3V0KGNoYW5nZVRvTGF5b3V0KTsKICAgICAgICAgICAgICAgICAgICBjaGFuZ2VkTGF5b3V0ID0gdHJ1ZQogICAgICAgICAgICAgICAgfSBlbHNlIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciAoY29uc3QgW3NpZFN0ciwgZGF0YV0gb2YgT2JqZWN0LmVudHJpZXMob1sidHlwZXMiXSkpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHNpZCA9IHBhcnNlSW50KHNpZFN0ciwgMTApOwogICAgICAgICAgICAgICAgY29uc3Qgb2JqZWN0Q2xhc3MgPSB0aGlzLkdldE9iamVjdENsYXNzQnlTSUQoc2lkKTsKICAgICAgICAgICAgICAgIGlmICghb2JqZWN0Q2xhc3MgfHwgb2JqZWN0Q2xhc3MuSXNGYW1pbHkoKSB8fAogICAgICAgICAgICAgICAgICAgIG9iamVjdENsYXNzLkhhc05vU2F2ZUJlaGF2aW9yKCkpIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgb2JqZWN0Q2xhc3MuX0xvYWRGcm9tSnNvbihkYXRhKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuRmx1c2hQZW5kaW5nSW5zdGFuY2VzKCk7CiAgICAgICAgICAgIHRoaXMuX1JlZnJlc2hVaWRNYXAoKTsKICAgICAgICAgICAgdGhpcy5faXNMb2FkaW5nU3RhdGUgPSBmYWxzZTsKICAgICAgICAgICAgaWYgKGNoYW5nZWRMYXlvdXQpIHsKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgaW5zdCBvZiB0aGlzLmFsbEluc3RhbmNlcygpKSBpbnN0LlNldHVwSW5pdGlhbFNjZW5lR3JhcGhDb25uZWN0aW9ucygpOwogICAgICAgICAgICAgICAgZm9yIChjb25zdCBbc2lkU3RyLCBkYXRhXSBvZiBPYmplY3QuZW50cmllcyhvWyJ0eXBlcyJdKSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNpZCA9IHBhcnNlSW50KHNpZFN0ciwgMTApOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IG9iamVjdENsYXNzID0gdGhpcy5HZXRPYmplY3RDbGFzc0J5U0lEKHNpZCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFvYmplY3RDbGFzcyB8fCBvYmplY3RDbGFzcy5Jc0ZhbWlseSgpIHx8IG9iamVjdENsYXNzLkhhc05vU2F2ZUJlaGF2aW9yKCkpIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgIG9iamVjdENsYXNzLl9TZXR1cFNjZW5lR3JhcGhDb25uZWN0aW9uc09uQ2hhbmdlT2ZMYXlvdXQoZGF0YSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLl9uZXh0VWlkID0KICAgICAgICAgICAgICAgIHJ0WyJuZXh0X3VpZCJdOwogICAgICAgICAgICBmb3IgKGNvbnN0IFtzaWRTdHIsIGRhdGFdIG9mIE9iamVjdC5lbnRyaWVzKG9bImxheW91dHMiXSkpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHNpZCA9IHBhcnNlSW50KHNpZFN0ciwgMTApOwogICAgICAgICAgICAgICAgY29uc3QgbGF5b3V0ID0gbGF5b3V0TWFuYWdlci5HZXRMYXlvdXRCeVNJRChzaWQpOwogICAgICAgICAgICAgICAgaWYgKCFsYXlvdXQpIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgbGF5b3V0Ll9Mb2FkRnJvbUpzb24oZGF0YSkKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLl9ldmVudFNoZWV0TWFuYWdlci5fTG9hZEZyb21Kc29uKG9bImV2ZW50cyJdKTsKICAgICAgICAgICAgZm9yIChjb25zdCBvYmplY3RDbGFzcyBvZiB0aGlzLl9hbGxPYmplY3RDbGFzc2VzKSB7CiAgICAgICAgICAgICAgICBpZiAob2JqZWN0Q2xhc3MuSXNGYW1pbHkoKSB8fCAhb2JqZWN0Q2xhc3MuSXNJbkNvbnRhaW5lcigpKSBjb250aW51ZTsKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgaW5zdCBvZiBvYmplY3RDbGFzcy5HZXRJbnN0YW5jZXMoKSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGlpZCA9IGluc3QuR2V0SUlEKCk7CiAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBvdGhlclR5cGUgb2Ygb2JqZWN0Q2xhc3MuR2V0Q29udGFpbmVyKCkub2JqZWN0VHlwZXMoKSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAob3RoZXJUeXBlID09PQogICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0Q2xhc3MpIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBvdGhlckluc3RhbmNlcyA9IG90aGVyVHlwZS5HZXRJbnN0YW5jZXMoKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlpZCA8IDAgfHwgaWlkID49IG90aGVySW5zdGFuY2VzLmxlbmd0aCkgdGhyb3cgbmV3IEVycm9yKCJtaXNzaW5nIHNpYmxpbmcgaW5zdGFuY2UiKTsKICAgICAgICAgICAgICAgICAgICAgICAgaW5zdC5fQWRkU2libGluZyhvdGhlckluc3RhbmNlc1tpaWRdKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLl90aW1lbGluZU1hbmFnZXIuX0xvYWRGcm9tSnNvbihvWyJ0aW1lbGluZXMiXSk7CiAgICAgICAgICAgIGxheW91dE1hbmFnZXIuU2V0QWxsTGF5ZXJQcm9qZWN0aW9uQ2hhbmdlZCgpOwogICAgICAgICAgICBsYXlvdXRNYW5hZ2VyLlNldEFsbExheWVyTVZDaGFuZ2VkKCk7CiAgICAgICAgICAgIHRoaXMuX2Rpc3BhdGNoZXIuZGlzcGF0Y2hFdmVudChDMy5OZXcoQzMuRXZlbnQsICJhZnRlcmxvYWQiKSk7CiAgICAgICAgICAgIGZvciAoY29uc3QgW3NpZFN0ciwgZGF0YV0gb2YgT2JqZWN0LmVudHJpZXMob1sidHlwZXMiXSkpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHNpZCA9IHBhcnNlSW50KHNpZFN0ciwgMTApOwogICAgICAgICAgICAgICAgY29uc3Qgb2JqZWN0Q2xhc3MgPSB0aGlzLkdldE9iamVjdENsYXNzQnlTSUQoc2lkKTsKICAgICAgICAgICAgICAgIGlmIChvYmplY3RDbGFzcykgb2JqZWN0Q2xhc3MuX0NsZWFyTG9hZEluc3RhbmNlc0pzb24oKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IGxvYWRFdmVudCA9IHRoaXMuX0NyZWF0ZVVzZXJTY3JpcHRFdmVudCgibG9hZCIpOwogICAgICAgICAgICBsb2FkRXZlbnQuc2F2ZURhdGEgPSBvWyJ1c2VyX3NjcmlwdF9kYXRhIl07CiAgICAgICAgICAgIGF3YWl0IHRoaXMuRGlzcGF0Y2hVc2VyU2NyaXB0RXZlbnRBc3luY1dhaXQobG9hZEV2ZW50KTsKICAgICAgICAgICAgdGhpcy5VcGRhdGVSZW5kZXIoKQogICAgICAgIH0KICAgICAgICBhc3luYyBBZGRKb2JXb3JrZXJTY3JpcHRzKHNjcmlwdHMpIHsKICAgICAgICAgICAgY29uc3QgbG9hZFVybHMgPSBhd2FpdCBQcm9taXNlLmFsbChzY3JpcHRzLm1hcChhc3luYyB1cmwgPT4gewogICAgICAgICAgICAgICAgY29uc3QgaXNDcm9zc09yaWdpbiA9IEMzLklzQWJzb2x1dGVVUkwodXJsKSAmJiAobmV3IFVSTCh1cmwpKS5vcmlnaW4gIT09IGxvY2F0aW9uLm9yaWdpbjsKICAgICAgICAgICAgICAgIGNvbnN0IGlzQ29yZG92YUZpbGVQcm90b2NvbCA9IHRoaXMuSXNDb3Jkb3ZhKCkgJiYgdGhpcy5fYXNzZXRNYW5hZ2VyLklzRmlsZVByb3RvY29sKCk7CiAgICAgICAgICAgICAgICBpZiAoaXNDcm9zc09yaWdpbiB8fCBpc0NvcmRvdmFGaWxlUHJvdG9jb2wgfHwKICAgICAgICAgICAgICAgICAgICB0aGlzLklzUHJldmlldygpIHx8IHRoaXMuR2V0RXhwb3J0VHlwZSgpID09PSAicGxheWFibGUtYWQiKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYmxvYiA9IGF3YWl0IHRoaXMuX2Fzc2V0TWFuYWdlci5GZXRjaEJsb2IodXJsKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKQogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChDMy5Jc1JlbGF0aXZlVVJMKHVybCkpIHJldHVybiAobmV3IFVSTCh1cmwsIHRoaXMuX3J1bnRpbWVCYXNlVXJsKSkudG9TdHJpbmcoKTsKICAgICAgICAgICAgICAgIGVsc2UgcmV0dXJuIHVybAogICAgICAgICAgICB9KSk7CiAgICAgICAgICAgIHRoaXMuX2pvYlNjaGVkdWxlci5JbXBvcnRTY3JpcHRzVG9Kb2JXb3JrZXJzKGxvYWRVcmxzKQogICAgICAgIH0KICAgICAgICBBZGRKb2JXb3JrZXJCbG9iKGJsb2IsIGlkKSB7CiAgICAgICAgICAgIHRoaXMuX2pvYlNjaGVkdWxlci5TZW5kQmxvYlRvSm9iV29ya2VycyhibG9iLCBpZCkKICAgICAgICB9CiAgICAgICAgQWRkSm9iV29ya2VyQnVmZmVyKGJ1ZmZlciwgaWQpIHsKICAgICAgICAgICAgdGhpcy5fam9iU2NoZWR1bGVyLlNlbmRCdWZmZXJUb0pvYldvcmtlcnMoYnVmZmVyLCBpZCkKICAgICAgICB9CiAgICAgICAgQWRkSm9iKHR5cGUsIHBhcmFtcywgdHJhbnNmZXJhYmxlcywgbWF4V29ya2VyTnVtKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9qb2JTY2hlZHVsZXIuQWRkSm9iKHR5cGUsCiAgICAgICAgICAgICAgICBwYXJhbXMsIHRyYW5zZmVyYWJsZXMsIG51bGwsIG51bGwsIG1heFdvcmtlck51bSkKICAgICAgICB9CiAgICAgICAgQnJvYWRjYXN0Sm9iKHR5cGUsIHBhcmFtcywgdHJhbnNmZXJhYmxlcywgbWF4V29ya2VyTnVtKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9qb2JTY2hlZHVsZXIuQnJvYWRjYXN0Sm9iKHR5cGUsIHBhcmFtcywgdHJhbnNmZXJhYmxlcywgbWF4V29ya2VyTnVtKQogICAgICAgIH0KICAgICAgICBHZXRNYXhOdW1Kb2JXb3JrZXJzKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fam9iU2NoZWR1bGVyLkdldE1heE51bVdvcmtlcnMoKQogICAgICAgIH0KICAgICAgICBJbnZva2VEb3dubG9hZCh1cmwsIGZpbGVuYW1lKSB7CiAgICAgICAgICAgIHRoaXMuUG9zdENvbXBvbmVudE1lc3NhZ2VUb0RPTSgicnVudGltZSIsICJpbnZva2UtZG93bmxvYWQiLCB7CiAgICAgICAgICAgICAgICAidXJsIjogdXJsLAogICAgICAgICAgICAgICAgImZpbGVuYW1lIjogZmlsZW5hbWUKICAgICAgICAgICAgfSkKICAgICAgICB9CiAgICAgICAgYXN5bmMgUmFzdGVyU3ZnSW1hZ2UoYmxvYiwgaW1hZ2VXaWR0aCwgaW1hZ2VIZWlnaHQsIHN1cmZhY2VXaWR0aCwgc3VyZmFjZUhlaWdodCwgaW1hZ2VCaXRtYXBPcHRzKSB7CiAgICAgICAgICAgIHN1cmZhY2VXaWR0aCA9IHN1cmZhY2VXaWR0aCB8fCBpbWFnZVdpZHRoOwogICAgICAgICAgICBzdXJmYWNlSGVpZ2h0ID0KICAgICAgICAgICAgICAgIHN1cmZhY2VIZWlnaHQgfHwgaW1hZ2VIZWlnaHQ7CiAgICAgICAgICAgIGlmICh0aGlzLklzSW5Xb3JrZXIoKSkgewogICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5Qb3N0Q29tcG9uZW50TWVzc2FnZVRvRE9NQXN5bmMoInJ1bnRpbWUiLCAicmFzdGVyLXN2Zy1pbWFnZSIsIHsKICAgICAgICAgICAgICAgICAgICAiYmxvYiI6IGJsb2IsCiAgICAgICAgICAgICAgICAgICAgImltYWdlV2lkdGgiOiBpbWFnZVdpZHRoLAogICAgICAgICAgICAgICAgICAgICJpbWFnZUhlaWdodCI6IGltYWdlSGVpZ2h0LAogICAgICAgICAgICAgICAgICAgICJzdXJmYWNlV2lkdGgiOiBzdXJmYWNlV2lkdGgsCiAgICAgICAgICAgICAgICAgICAgInN1cmZhY2VIZWlnaHQiOiBzdXJmYWNlSGVpZ2h0LAogICAgICAgICAgICAgICAgICAgICJpbWFnZUJpdG1hcE9wdHMiOiBpbWFnZUJpdG1hcE9wdHMKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdFsiaW1hZ2VCaXRtYXAiXQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29uc3QgY2FudmFzID0gYXdhaXQgc2VsZlsiQzNfUmFzdGVyU3ZnSW1hZ2VCbG9iIl0oYmxvYiwgaW1hZ2VXaWR0aCwgaW1hZ2VIZWlnaHQsIHN1cmZhY2VXaWR0aCwgc3VyZmFjZUhlaWdodCk7CiAgICAgICAgICAgICAgICBpZiAoaW1hZ2VCaXRtYXBPcHRzKSByZXR1cm4gYXdhaXQgc2VsZi5jcmVhdGVJbWFnZUJpdG1hcChjYW52YXMsIGltYWdlQml0bWFwT3B0cyk7CiAgICAgICAgICAgICAgICBlbHNlIHJldHVybiBjYW52YXMKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBhc3luYyBHZXRTdmdJbWFnZVNpemUoYmxvYikgewogICAgICAgICAgICBpZiAodGhpcy5Jc0luV29ya2VyKCkpIHJldHVybiBhd2FpdCB0aGlzLlBvc3RDb21wb25lbnRNZXNzYWdlVG9ET01Bc3luYygicnVudGltZSIsICJnZXQtc3ZnLWltYWdlLXNpemUiLCB7CiAgICAgICAgICAgICAgICAiYmxvYiI6IGJsb2IKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGVsc2UgcmV0dXJuIGF3YWl0IHNlbGZbIkMzX0dldFN2Z0ltYWdlU2l6ZSJdKGJsb2IpCiAgICAgICAgfQogICAgICAgIFJlcXVlc3REZXZpY2VPcmllbnRhdGlvbkV2ZW50KCkgewogICAgICAgICAgICBpZiAodGhpcy5fZGlkUmVxdWVzdERldmljZU9yaWVudGF0aW9uRXZlbnQpIHJldHVybjsKICAgICAgICAgICAgdGhpcy5fZGlkUmVxdWVzdERldmljZU9yaWVudGF0aW9uRXZlbnQgPSB0cnVlOwogICAgICAgICAgICB0aGlzLlBvc3RDb21wb25lbnRNZXNzYWdlVG9ET00oInJ1bnRpbWUiLCAiZW5hYmxlLWRldmljZS1vcmllbnRhdGlvbiIpCiAgICAgICAgfQogICAgICAgIFJlcXVlc3REZXZpY2VNb3Rpb25FdmVudCgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX2RpZFJlcXVlc3REZXZpY2VNb3Rpb25FdmVudCkgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl9kaWRSZXF1ZXN0RGV2aWNlTW90aW9uRXZlbnQgPQogICAgICAgICAgICAgICAgdHJ1ZTsKICAgICAgICAgICAgdGhpcy5Qb3N0Q29tcG9uZW50TWVzc2FnZVRvRE9NKCJydW50aW1lIiwgImVuYWJsZS1kZXZpY2UtbW90aW9uIikKICAgICAgICB9CiAgICAgICAgUmFuZG9tKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fcmFuZG9tTnVtYmVyQ2FsbGJhY2soKQogICAgICAgIH0KICAgICAgICBTZXRSYW5kb21OdW1iZXJHZW5lcmF0b3JDYWxsYmFjayhmKSB7CiAgICAgICAgICAgIHRoaXMuX3JhbmRvbU51bWJlckNhbGxiYWNrID0gZgogICAgICAgIH0KICAgICAgICBfR2V0UmVtb3RlUHJldmlld1N0YXR1c0luZm8oKSB7CiAgICAgICAgICAgIGNvbnN0IHJlbmRlcmVyID0gdGhpcy5HZXRSZW5kZXJlcigpOwogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgImZwcyI6IHRoaXMuR2V0RlBTKCksCiAgICAgICAgICAgICAgICAiY3B1IjogdGhpcy5HZXRNYWluVGhyZWFkVGltZSgpLAogICAgICAgICAgICAgICAgImdwdSI6IHRoaXMuR2V0R1BVVXRpbGlzYXRpb24oKSwKICAgICAgICAgICAgICAgICJsYXlvdXQiOiB0aGlzLkdldE1haW5SdW5uaW5nTGF5b3V0KCkgPyB0aGlzLkdldE1haW5SdW5uaW5nTGF5b3V0KCkuR2V0TmFtZSgpIDogIiIsCiAgICAgICAgICAgICAgICAicmVuZGVyZXIiOiByZW5kZXJlci5Jc1dlYkdMKCkgPyByZW5kZXJlci5HZXRVbm1hc2tlZFJlbmRlcmVyKCkgOiByZW5kZXJlci5HZXRCYXNpY0FkYXB0ZXJJbmZvU3RyaW5nKCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBIaXRCcmVha3BvaW50KCkgewogICAgICAgICAgICBpZiAoIXRoaXMuSXNEZWJ1ZygpKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIHJldHVybiBDM0RlYnVnZ2VyLkhpdEJyZWFrcG9pbnQoKQogICAgICAgIH0KICAgICAgICBEZWJ1Z0JyZWFrKGV2ZW50T2JqZWN0KSB7CiAgICAgICAgICAgIGlmICghdGhpcy5Jc0RlYnVnZ2luZygpKSByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7CiAgICAgICAgICAgIHJldHVybiBDM0RlYnVnZ2VyLkRlYnVnQnJlYWsoZXZlbnRPYmplY3QpCiAgICAgICAgfQogICAgICAgIERlYnVnQnJlYWtOZXh0KCkgewogICAgICAgICAgICBpZiAoIXRoaXMuSXNEZWJ1Z2dpbmcoKSkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICByZXR1cm4gQzNEZWJ1Z2dlci5CcmVha05leHQoKQogICAgICAgIH0KICAgICAgICBTZXREZWJ1Z0JyZWFrcG9pbnRzRW5hYmxlZChlKSB7CiAgICAgICAgICAgIHRoaXMuX2JyZWFrcG9pbnRzRW5hYmxlZCA9ICEhZTsKICAgICAgICAgICAgdGhpcy5fVXBkYXRlRGVidWdnaW5nRmxhZygpCiAgICAgICAgfQogICAgICAgIEFyZURlYnVnQnJlYWtwb2ludHNFbmFibGVkKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fYnJlYWtwb2ludHNFbmFibGVkCiAgICAgICAgfQogICAgICAgIElzRGVidWdnaW5nKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faXNEZWJ1Z2dpbmcKICAgICAgICB9CiAgICAgICAgU2V0RGVidWdnaW5nRW5hYmxlZChkKSB7CiAgICAgICAgICAgIGlmIChkKSB0aGlzLl9kZWJ1Z2dpbmdEaXNhYmxlZC0tOwogICAgICAgICAgICBlbHNlIHRoaXMuX2RlYnVnZ2luZ0Rpc2FibGVkKys7CiAgICAgICAgICAgIHRoaXMuX1VwZGF0ZURlYnVnZ2luZ0ZsYWcoKQogICAgICAgIH0KICAgICAgICBfVXBkYXRlRGVidWdnaW5nRmxhZygpIHsKICAgICAgICAgICAgdGhpcy5faXNEZWJ1Z2dpbmcgPSB0aGlzLklzRGVidWcoKSAmJiB0aGlzLl9icmVha3BvaW50c0VuYWJsZWQgJiYgdGhpcy5fZGVidWdnaW5nRGlzYWJsZWQgPT09IDAKICAgICAgICB9CiAgICAgICAgSXNDUFVQcm9maWxpbmcoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLklzRGVidWcoKSAmJiBDM0RlYnVnZ2VyLklzQ1BVUHJvZmlsaW5nKCkKICAgICAgICB9CiAgICAgICAgSXNHUFVQcm9maWxpbmcoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLklzRGVidWcoKSAmJiB0aGlzLkdldFJlbmRlcmVyKCkuU3VwcG9ydHNHUFVQcm9maWxpbmcoKSAmJiBDM0RlYnVnZ2VyLklzR1BVUHJvZmlsaW5nKCkKICAgICAgICB9CiAgICAgICAgYXN5bmMgRGVidWdJdGVyYXRlQW5kQnJlYWsoaXRlcikgewogICAgICAgICAgICBpZiAoIWl0ZXIpIHJldHVybjsKICAgICAgICAgICAgZm9yIChjb25zdCBicmVha0V2ZW50T2JqZWN0IG9mIGl0ZXIpIGF3YWl0IHRoaXMuRGVidWdCcmVhayhicmVha0V2ZW50T2JqZWN0KQogICAgICAgIH0KICAgICAgICBEZWJ1Z0ZpcmVHZW5lcmF0b3JFdmVudEFuZEJyZWFrKGV2ZW50KSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLkRlYnVnSXRlcmF0ZUFuZEJyZWFrKHRoaXMuX2Rpc3BhdGNoZXIuZGlzcGF0Y2hHZW5lcmF0b3JFdmVudChldmVudCkpCiAgICAgICAgfQogICAgICAgIF9JbnZva2VGdW5jdGlvbkZyb21KUyhlKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9ldmVudFNoZWV0TWFuYWdlci5fSW52b2tlRnVuY3Rpb25Gcm9tSlMoZVsibmFtZSJdLAogICAgICAgICAgICAgICAgZVsicGFyYW1zIl0pCiAgICAgICAgfQogICAgICAgIEdldElSdW50aW1lKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faVJ1bnRpbWUKICAgICAgICB9CiAgICAgICAgX0NyZWF0ZVVzZXJTY3JpcHRFdmVudChuYW1lKSB7CiAgICAgICAgICAgIGNvbnN0IGUgPSBDMy5OZXcoQzMuRXZlbnQsIG5hbWUsIGZhbHNlKTsKICAgICAgICAgICAgZS5ydW50aW1lID0gdGhpcy5faVJ1bnRpbWU7CiAgICAgICAgICAgIHJldHVybiBlCiAgICAgICAgfQogICAgICAgIF9Jbml0U2NyaXB0SW50ZXJmYWNlcygpIHsKICAgICAgICAgICAgY29uc3Qgb2JqZWN0RGVzY3JpcHRvcnMgPSB7fTsKICAgICAgICAgICAgZm9yIChjb25zdCBvYmplY3RDbGFzcyBvZiB0aGlzLl9hbGxPYmplY3RDbGFzc2VzKSBvYmplY3REZXNjcmlwdG9yc1tvYmplY3RDbGFzcy5HZXRKc1Byb3BOYW1lKCldID0gewogICAgICAgICAgICAgICAgdmFsdWU6IG9iamVjdENsYXNzLkdldElPYmplY3RDbGFzcygpLAogICAgICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICAgICAgICAgIHdyaXRhYmxlOiBmYWxzZQogICAgICAgICAgICB9OwogICAgICAgICAgICBjb25zdCBvYmplY3RzID0gT2JqZWN0LmNyZWF0ZShPYmplY3QucHJvdG90eXBlLCBvYmplY3REZXNjcmlwdG9ycyk7CiAgICAgICAgICAgIHRoaXMuX2lSdW50aW1lID0gbmV3IHNlbGYuSVJ1bnRpbWUodGhpcywgb2JqZWN0cyk7CiAgICAgICAgICAgIHRoaXMuX3VzZXJTY3JpcHRFdmVudE9iamVjdHMgPSB7CiAgICAgICAgICAgICAgICAidGljayI6IHRoaXMuX0NyZWF0ZVVzZXJTY3JpcHRFdmVudCgidGljayIpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgX0luaXRHbG9iYWxWYXJpYWJsZVNjcmlwdEludGVyZmFjZSgpIHsKICAgICAgICAgICAgY29uc3QgZ2xvYmFsVmFyRGVzY3JpcHRvcnMgPSB7fTsKICAgICAgICAgICAgZm9yIChjb25zdCBnbG9iYWxWYXIgb2YgdGhpcy5HZXRFdmVudFNoZWV0TWFuYWdlcigpLkdldEFsbEdsb2JhbFZhcmlhYmxlcygpKSBnbG9iYWxWYXJEZXNjcmlwdG9yc1tnbG9iYWxWYXIuR2V0SnNQcm9wTmFtZSgpXSA9IGdsb2JhbFZhci5fR2V0U2NyaXB0SW50ZXJmYWNlRGVzY3JpcHRvcigpOwogICAgICAgICAgICB0aGlzLl9pUnVudGltZS5fSW5pdEdsb2JhbFZhcnMoZ2xvYmFsVmFyRGVzY3JpcHRvcnMpCiAgICAgICAgfQogICAgICAgIF9HZXRDb21tb25TY3JpcHRJbnRlcmZhY2VzKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fY29tbW9uU2NyaXB0SW50ZXJmYWNlcwogICAgICAgIH0KICAgICAgICBfTWFwU2NyaXB0SW50ZXJmYWNlKGludGVyZmFjZV8sIGNsYXNzXykgewogICAgICAgICAgICB0aGlzLl9pbnRlcmZhY2VNYXAuc2V0KGludGVyZmFjZV8sIGNsYXNzXykKICAgICAgICB9CiAgICAgICAgX1Vud3JhcFNjcmlwdEludGVyZmFjZShpbnRlcmZhY2VfKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pbnRlcmZhY2VNYXAuZ2V0KGludGVyZmFjZV8pCiAgICAgICAgfQogICAgICAgIF9VbndyYXBJT2JqZWN0Q2xhc3MoaU9iamVjdENsYXNzKSB7CiAgICAgICAgICAgIGlmICghKGlPYmplY3RDbGFzcyBpbnN0YW5jZW9mIHNlbGYuSU9iamVjdENsYXNzKSkgdGhyb3cgbmV3IFR5cGVFcnJvcigiZXhwZWN0ZWQgSU9iamVjdENsYXNzIik7CiAgICAgICAgICAgIGNvbnN0IG9iamVjdENsYXNzID0gdGhpcy5fVW53cmFwU2NyaXB0SW50ZXJmYWNlKGlPYmplY3RDbGFzcyk7CiAgICAgICAgICAgIGlmICghb2JqZWN0Q2xhc3MgfHwgIShvYmplY3RDbGFzcyBpbnN0YW5jZW9mIEMzLk9iamVjdENsYXNzKSkgdGhyb3cgbmV3IEVycm9yKCJpbnZhbGlkIElPYmplY3RDbGFzcyIpOwogICAgICAgICAgICByZXR1cm4gb2JqZWN0Q2xhc3MKICAgICAgICB9CiAgICAgICAgX1Vud3JhcElXb3JsZEluc3RhbmNlKGlpbnN0KSB7CiAgICAgICAgICAgIGlmICghKGlpbnN0IGluc3RhbmNlb2Ygc2VsZi5JV29ybGRJbnN0YW5jZSkpIHRocm93IG5ldyBUeXBlRXJyb3IoImV4cGVjdGVkIElXb3JsZEluc3RhbmNlIik7CiAgICAgICAgICAgIGNvbnN0IGluc3QgPSB0aGlzLl9VbndyYXBTY3JpcHRJbnRlcmZhY2UoaWluc3QpOwogICAgICAgICAgICBpZiAoIWluc3QgfHwgIShpbnN0IGluc3RhbmNlb2YgQzMuSW5zdGFuY2UpKSB0aHJvdyBuZXcgRXJyb3IoImludmFsaWQgSUluc3RhbmNlIik7CiAgICAgICAgICAgIHJldHVybiBpbnN0CiAgICAgICAgfQogICAgfTsKICAgIHNlbGZbIkMzX0NyZWF0ZVJ1bnRpbWUiXSA9IEMzLlJ1bnRpbWUuQ3JlYXRlOwogICAgc2VsZlsiQzNfSW5pdFJ1bnRpbWUiXSA9IChydW50aW1lLCBvcHRzKSA9PiBydW50aW1lLkluaXQob3B0cyk7Cgp9CgovLyB3b3JrZXJzL2pvYlNjaGVkdWxlclJ1bnRpbWUuanMKewogICAgJ3VzZSBzdHJpY3QnOwogICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgQzMuSm9iU2NoZWR1bGVyUnVudGltZSA9IGNsYXNzIEpvYlNjaGVkdWxlclJ1bnRpbWUgZXh0ZW5kcyBDMy5EZWZlbmRlZEJhc2UgewogICAgICAgIGNvbnN0cnVjdG9yKHJ1bnRpbWUsIGRhdGEpIHsKICAgICAgICAgICAgc3VwZXIoKTsKICAgICAgICAgICAgdGhpcy5fcnVudGltZSA9IHJ1bnRpbWU7CiAgICAgICAgICAgIHRoaXMuX2pvYlByb21pc2VzID0gbmV3IE1hcDsKICAgICAgICAgICAgdGhpcy5fbmV4dEpvYklkID0gMDsKICAgICAgICAgICAgdGhpcy5faW5wdXRQb3J0ID0gZGF0YVsiaW5wdXRQb3J0Il07CiAgICAgICAgICAgIGRhdGFbIm91dHB1dFBvcnQiXS5vbm1lc3NhZ2UgPSBlID0+IHRoaXMuX09uSm9iV29ya2VyTWVzc2FnZShlKTsKICAgICAgICAgICAgdGhpcy5fbWF4TnVtV29ya2VycyA9IGRhdGFbIm1heE51bVdvcmtlcnMiXTsKICAgICAgICAgICAgdGhpcy5fam9iV29ya2VyQ291bnQgPSAxOwogICAgICAgICAgICB0aGlzLl9pc0NyZWF0aW5nV29ya2VyID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX2hhZEVycm9yQ3JlYXRpbmdXb3JrZXIgPSBmYWxzZQogICAgICAgIH0KICAgICAgICBhc3luYyBJbml0KCkge30KICAgICAgICBHZXRNYXhOdW1Xb3JrZXJzKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fbWF4TnVtV29ya2VycwogICAgICAgIH0KICAgICAgICBJbXBvcnRTY3JpcHRzVG9Kb2JXb3JrZXJzKHNjcmlwdHMpIHsKICAgICAgICAgICAgdGhpcy5faW5wdXRQb3J0LnBvc3RNZXNzYWdlKHsKICAgICAgICAgICAgICAgICJ0eXBlIjogIl9pbXBvcnRfc2NyaXB0cyIsCiAgICAgICAgICAgICAgICAic2NyaXB0cyI6IHNjcmlwdHMKICAgICAgICAgICAgfSkKICAgICAgICB9CiAgICAgICAgU2VuZEJsb2JUb0pvYldvcmtlcnMoYmxvYiwKICAgICAgICAgICAgaWQpIHsKICAgICAgICAgICAgdGhpcy5faW5wdXRQb3J0LnBvc3RNZXNzYWdlKHsKICAgICAgICAgICAgICAgICJ0eXBlIjogIl9zZW5kX2Jsb2IiLAogICAgICAgICAgICAgICAgImJsb2IiOiBibG9iLAogICAgICAgICAgICAgICAgImlkIjogaWQKICAgICAgICAgICAgfSkKICAgICAgICB9CiAgICAgICAgU2VuZEJ1ZmZlclRvSm9iV29ya2VycyhidWZmZXIsIGlkKSB7CiAgICAgICAgICAgIHRoaXMuX2lucHV0UG9ydC5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgICAgICAidHlwZSI6ICJfc2VuZF9idWZmZXIiLAogICAgICAgICAgICAgICAgImJ1ZmZlciI6IGJ1ZmZlciwKICAgICAgICAgICAgICAgICJpZCI6IGlkCiAgICAgICAgICAgIH0sIFtidWZmZXJdKQogICAgICAgIH0KICAgICAgICBBZGRKb2IodHlwZSwgcGFyYW1zLCB0cmFuc2ZlcmFibGVzLCBwcm9ncmVzc0hhbmRsZXIsIGFib3J0RGlzcG9zYWJsZSwgbWF4V29ya2VyTnVtKSB7CiAgICAgICAgICAgIGlmICghdHJhbnNmZXJhYmxlcykgdHJhbnNmZXJhYmxlcyA9IFtdOwogICAgICAgICAgICBpZiAodHlwZW9mIG1heFdvcmtlck51bSA9PT0gIm51bWJlciIpIHsKICAgICAgICAgICAgICAgIG1heFdvcmtlck51bSA9IE1hdGguZmxvb3IobWF4V29ya2VyTnVtKTsKICAgICAgICAgICAgICAgIGlmIChtYXhXb3JrZXJOdW0gPD0gMCkgdGhyb3cgbmV3IEVycm9yKCJpbnZhbGlkIG1heFdvcmtlck51bSIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IGpvYklkID0gdGhpcy5fbmV4dEpvYklkKys7CiAgICAgICAgICAgIGNvbnN0IGpvYiA9IHsKICAgICAgICAgICAgICAgICJ0eXBlIjogdHlwZSwKICAgICAgICAgICAgICAgICJpc0Jyb2FkY2FzdCI6IGZhbHNlLAogICAgICAgICAgICAgICAgIm1heFdvcmtlck51bSI6IG1heFdvcmtlck51bSwKICAgICAgICAgICAgICAgICJqb2JJZCI6IGpvYklkLAogICAgICAgICAgICAgICAgInBhcmFtcyI6IHBhcmFtcywKICAgICAgICAgICAgICAgICJ0cmFuc2ZlcmFibGVzIjogdHJhbnNmZXJhYmxlcwogICAgICAgICAgICB9OwogICAgICAgICAgICBjb25zdCBwcm9taXNlID0gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewogICAgICAgICAgICAgICAgdGhpcy5fam9iUHJvbWlzZXMuc2V0KGpvYklkLCB7CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZTogcmVzb2x2ZSwKICAgICAgICAgICAgICAgICAgICBwcm9ncmVzczogcHJvZ3Jlc3NIYW5kbGVyLAogICAgICAgICAgICAgICAgICAgIHJlamVjdDogcmVqZWN0LAogICAgICAgICAgICAgICAgICAgIGNhbmNlbGxlZDogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgbWF4V29ya2VyTnVtCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgaWYgKGFib3J0RGlzcG9zYWJsZSkgYWJvcnREaXNwb3NhYmxlLlNldEFjdGlvbigoKSA9PiB0aGlzLl9DYW5jZWxKb2Ioam9iSWQpKTsKICAgICAgICAgICAgdGhpcy5faW5wdXRQb3J0LnBvc3RNZXNzYWdlKGpvYiwgdHJhbnNmZXJhYmxlcyk7CiAgICAgICAgICAgIHRoaXMuX01heWJlQ3JlYXRlRXh0cmFXb3JrZXIoKTsKICAgICAgICAgICAgcmV0dXJuIHByb21pc2UKICAgICAgICB9CiAgICAgICAgQnJvYWRjYXN0Sm9iKHR5cGUsIHBhcmFtcywgdHJhbnNmZXJhYmxlcywgbWF4V29ya2VyTnVtKSB7CiAgICAgICAgICAgIGlmICghdHJhbnNmZXJhYmxlcykgdHJhbnNmZXJhYmxlcyA9IFtdOwogICAgICAgICAgICBpZiAodHlwZW9mIG1heFdvcmtlck51bSA9PT0gIm51bWJlciIpIHsKICAgICAgICAgICAgICAgIG1heFdvcmtlck51bSA9IE1hdGguZmxvb3IobWF4V29ya2VyTnVtKTsKICAgICAgICAgICAgICAgIGlmIChtYXhXb3JrZXJOdW0gPD0gMCkgdGhyb3cgbmV3IEVycm9yKCJpbnZhbGlkIG1heFdvcmtlck51bSIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IGpvYklkID0gdGhpcy5fbmV4dEpvYklkKys7CiAgICAgICAgICAgIGNvbnN0IGpvYiA9IHsKICAgICAgICAgICAgICAgICJ0eXBlIjogdHlwZSwKICAgICAgICAgICAgICAgICJpc0Jyb2FkY2FzdCI6IHRydWUsCiAgICAgICAgICAgICAgICAibWF4V29ya2VyTnVtIjogbWF4V29ya2VyTnVtLAogICAgICAgICAgICAgICAgImpvYklkIjogam9iSWQsCiAgICAgICAgICAgICAgICAicGFyYW1zIjogcGFyYW1zLAogICAgICAgICAgICAgICAgInRyYW5zZmVyYWJsZXMiOiB0cmFuc2ZlcmFibGVzCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHRoaXMuX2lucHV0UG9ydC5wb3N0TWVzc2FnZShqb2IsIHRyYW5zZmVyYWJsZXMpCiAgICAgICAgfQogICAgICAgIF9DYW5jZWxKb2Ioam9iSWQpIHsKICAgICAgICAgICAgY29uc3Qgam9iID0gdGhpcy5fam9iUHJvbWlzZXMuZ2V0KGpvYklkKTsKICAgICAgICAgICAgaWYgKGpvYikgewogICAgICAgICAgICAgICAgam9iLmNhbmNlbGxlZCA9IHRydWU7CiAgICAgICAgICAgICAgICBqb2IucmVzb2x2ZSA9IG51bGw7CiAgICAgICAgICAgICAgICBqb2IucHJvZ3Jlc3MgPSBudWxsOwogICAgICAgICAgICAgICAgam9iLnJlamVjdCA9IG51bGw7CiAgICAgICAgICAgICAgICB0aGlzLl9pbnB1dFBvcnQucG9zdE1lc3NhZ2UoewogICAgICAgICAgICAgICAgICAgICJ0eXBlIjogIl9jYW5jZWwiLAogICAgICAgICAgICAgICAgICAgICJqb2JJZCI6IGpvYklkCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIF9PbkpvYldvcmtlck1lc3NhZ2UoZSkgewogICAgICAgICAgICBjb25zdCBtc2cgPSBlLmRhdGE7CiAgICAgICAgICAgIGNvbnN0IHR5cGUgPSBtc2dbInR5cGUiXTsKICAgICAgICAgICAgY29uc3QgaWQgPSBtc2dbImpvYklkIl07CiAgICAgICAgICAgIHN3aXRjaCAodHlwZSkgewogICAgICAgICAgICAgICAgY2FzZSAicmVzdWx0IjoKICAgICAgICAgICAgICAgICAgICB0aGlzLl9PbkpvYlJlc3VsdChpZCwgbXNnWyJyZXN1bHQiXSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICJwcm9ncmVzcyI6CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fT25Kb2JQcm9ncmVzcyhpZCwgbXNnWyJwcm9ncmVzcyJdKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgImVycm9yIjoKICAgICAgICAgICAgICAgICAgICB0aGlzLl9PbkpvYkVycm9yKGlkLCBtc2dbImVycm9yIl0pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAicmVhZHkiOgogICAgICAgICAgICAgICAgICAgIHRoaXMuX09uSm9iV29ya2VyUmVhZHkoKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGB1bmtub3duIG1lc3NhZ2UgZnJvbSB3b3JrZXIgJyR7dHlwZX0nYCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgX09uSm9iUmVzdWx0KGpvYklkLCByZXN1bHQpIHsKICAgICAgICAgICAgY29uc3QgcCA9IHRoaXMuX2pvYlByb21pc2VzLmdldChqb2JJZCk7CiAgICAgICAgICAgIGlmICghcCkgdGhyb3cgbmV3IEVycm9yKCJpbnZhbGlkIGpvYiBJRCIpOwogICAgICAgICAgICBpZiAoIXAuY2FuY2VsbGVkKSBwLnJlc29sdmUocmVzdWx0KTsKICAgICAgICAgICAgdGhpcy5fam9iUHJvbWlzZXMuZGVsZXRlKGpvYklkKQogICAgICAgIH0KICAgICAgICBfT25Kb2JQcm9ncmVzcyhqb2JJZCwgcHJvZ3Jlc3MpIHsKICAgICAgICAgICAgY29uc3QgcCA9IHRoaXMuX2pvYlByb21pc2VzLmdldChqb2JJZCk7CiAgICAgICAgICAgIGlmICghcCkgdGhyb3cgbmV3IEVycm9yKCJpbnZhbGlkIGpvYiBJRCIpOwogICAgICAgICAgICBpZiAoIXAuY2FuY2VsbGVkICYmIHAucHJvZ3Jlc3MpIHAucHJvZ3Jlc3MocHJvZ3Jlc3MpCiAgICAgICAgfQogICAgICAgIF9PbkpvYkVycm9yKGpvYklkLCBlcnJvcikgewogICAgICAgICAgICBjb25zdCBwID0gdGhpcy5fam9iUHJvbWlzZXMuZ2V0KGpvYklkKTsKICAgICAgICAgICAgaWYgKCFwKSB0aHJvdyBuZXcgRXJyb3IoImludmFsaWQgam9iIElEIik7CiAgICAgICAgICAgIGlmICghcC5jYW5jZWxsZWQpIHAucmVqZWN0KGVycm9yKTsKICAgICAgICAgICAgdGhpcy5fam9iUHJvbWlzZXMuZGVsZXRlKGpvYklkKQogICAgICAgIH0KICAgICAgICBfT25Kb2JXb3JrZXJSZWFkeSgpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLl9pc0NyZWF0aW5nV29ya2VyKSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuX2lzQ3JlYXRpbmdXb3JrZXIgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5fam9iV29ya2VyQ291bnQrKzsKICAgICAgICAgICAgaWYgKHRoaXMuX2pvYldvcmtlckNvdW50IDwKICAgICAgICAgICAgICAgIHRoaXMuX21heE51bVdvcmtlcnMpIHRoaXMuX01heWJlQ3JlYXRlRXh0cmFXb3JrZXIoKTsKICAgICAgICAgICAgZWxzZSB0aGlzLl9pbnB1dFBvcnQucG9zdE1lc3NhZ2UoewogICAgICAgICAgICAgICAgInR5cGUiOiAiX25vX21vcmVfd29ya2VycyIKICAgICAgICAgICAgfSkKICAgICAgICB9CiAgICAgICAgX0dldFdvcmtlckNvdW50TmVlZGVkRm9yUGVuZGluZ0pvYnMoKSB7CiAgICAgICAgICAgIGxldCBuZWVkV29ya2VyQ291bnQgPSAwOwogICAgICAgICAgICBjb25zdCBzb3J0ZWRKb2JMaXN0ID0gWy4uLnRoaXMuX2pvYlByb21pc2VzLnZhbHVlcygpXS5zb3J0KChhLCBiKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBhbiA9IGEubWF4V29ya2VyTnVtIHx8IEluZmluaXR5OwogICAgICAgICAgICAgICAgY29uc3QgYm4gPSBiLm1heFdvcmtlck51bSB8fCBJbmZpbml0eTsKICAgICAgICAgICAgICAgIHJldHVybiBhbiAtIGJuCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBmb3IgKGNvbnN0IGpvYiBvZiBzb3J0ZWRKb2JMaXN0KSB7CiAgICAgICAgICAgICAgICBjb25zdCBtYXhXb3JrZXJOdW0gPSBqb2IubWF4V29ya2VyTnVtIHx8IEluZmluaXR5OwogICAgICAgICAgICAgICAgaWYgKG5lZWRXb3JrZXJDb3VudCA8IG1heFdvcmtlck51bSkgbmVlZFdvcmtlckNvdW50KysKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gbmVlZFdvcmtlckNvdW50CiAgICAgICAgfQogICAgICAgIGFzeW5jIF9NYXliZUNyZWF0ZUV4dHJhV29ya2VyKCkgewogICAgICAgICAgICBpZiAodGhpcy5fam9iV29ya2VyQ291bnQgPj0KICAgICAgICAgICAgICAgIHRoaXMuX21heE51bVdvcmtlcnMgfHwgdGhpcy5faXNDcmVhdGluZ1dvcmtlciB8fCB0aGlzLl9oYWRFcnJvckNyZWF0aW5nV29ya2VyIHx8IHRoaXMuX0dldFdvcmtlckNvdW50TmVlZGVkRm9yUGVuZGluZ0pvYnMoKSA8PSB0aGlzLl9qb2JXb3JrZXJDb3VudCkgcmV0dXJuOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgdGhpcy5faXNDcmVhdGluZ1dvcmtlciA9IHRydWU7CiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLl9ydW50aW1lLlBvc3RDb21wb25lbnRNZXNzYWdlVG9ET01Bc3luYygicnVudGltZSIsICJjcmVhdGUtam9iLXdvcmtlciIpOwogICAgICAgICAgICAgICAgcmVzdWx0WyJvdXRwdXRQb3J0Il0ub25tZXNzYWdlID0gZSA9PiB0aGlzLl9PbkpvYldvcmtlck1lc3NhZ2UoZSkKICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9oYWRFcnJvckNyZWF0aW5nV29ya2VyID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHRoaXMuX2lzQ3JlYXRpbmdXb3JrZXIgPSBmYWxzZTsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYFtDb25zdHJ1Y3RdIEZhaWxlZCB0byBjcmVhdGUgam9iIHdvcmtlcjsgc3RvcHBpbmcgY3JlYXRpbmcgYW55IG1vcmUgKGNyZWF0ZWQgJHt0aGlzLl9qb2JXb3JrZXJDb3VudH0gc28gZmFyKWAsCiAgICAgICAgICAgICAgICAgICAgZXJyKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKCn0KCnsKICAgIHNlbGZbIkMzX1NoYWRlcnMiXSA9IHt9OwogICAgc2VsZlsiQzNfU2hhZGVycyJdWyJpbnZlcnNlIl0gPSB7CiAgICAgICAgZ2xzbDogInZhcnlpbmcgbWVkaXVtcCB2ZWMyIHZUZXg7XG51bmlmb3JtIGxvd3Agc2FtcGxlcjJEIHNhbXBsZXJGcm9udDtcbnVuaWZvcm0gbG93cCBmbG9hdCBpbnRlbnNpdHk7XG52b2lkIG1haW4odm9pZClcbntcbmxvd3AgdmVjNCBmcm9udCA9IHRleHR1cmUyRChzYW1wbGVyRnJvbnQsIHZUZXgpO1xubG93cCB2ZWMzIGludmVyc2UgPSB2ZWMzKGZyb250LmEgLSBmcm9udC5yZ2IpO1xuZ2xfRnJhZ0NvbG9yID0gdmVjNChtaXgoZnJvbnQucmdiLCBpbnZlcnNlLCBpbnRlbnNpdHkpLCBmcm9udC5hKTtcbn0iLAogICAgICAgIGdsc2xXZWJHTDI6ICIiLAogICAgICAgIHdnc2w6ICIlJVNBTVBMRVJGUk9OVF9CSU5ESU5HJSUgdmFyIHNhbXBsZXJGcm9udCA6IHNhbXBsZXI7XG4lJVRFWFRVUkVGUk9OVF9CSU5ESU5HJSUgdmFyIHRleHR1cmVGcm9udCA6IHRleHR1cmVfMmQ8ZjMyPjtcbnN0cnVjdCBTaGFkZXJQYXJhbXMge1xuaW50ZW5zaXR5IDogZjMyXG59O1xuJSVTSEFERVJQQVJBTVNfQklORElORyUlIHZhcjx1bmlmb3JtPiBzaGFkZXJQYXJhbXMgOiBTaGFkZXJQYXJhbXM7XG4lJUZSQUdNRU5USU5QVVRfU1RSVUNUJSVcbiUlRlJBR01FTlRPVVRQVVRfU1RSVUNUJSVcbkBmcmFnbWVudFxuZm4gbWFpbihpbnB1dCA6IEZyYWdtZW50SW5wdXQpIC0+IEZyYWdtZW50T3V0cHV0XG57XG52YXIgZnJvbnQgOiB2ZWM0PGYzMj4gPSB0ZXh0dXJlU2FtcGxlKHRleHR1cmVGcm9udCwgc2FtcGxlckZyb250LCBpbnB1dC5mcmFnVVYpO1xudmFyIGludmVyc2UgOiB2ZWMzPGYzMj4gPSB2ZWMzPGYzMj4oZnJvbnQuYSkgLSBmcm9udC5yZ2I7XG52YXIgb3V0cHV0IDogRnJhZ21lbnRPdXRwdXQ7XG5vdXRwdXQuY29sb3IgPSB2ZWM0PGYzMj4obWl4KGZyb250LnJnYiwgaW52ZXJzZSwgc2hhZGVyUGFyYW1zLmludGVuc2l0eSksIGZyb250LmEpO1xucmV0dXJuIG91dHB1dDtcbn0iLAogICAgICAgIGJsZW5kc0JhY2tncm91bmQ6IGZhbHNlLAogICAgICAgIHVzZXNEZXB0aDogZmFsc2UsCiAgICAgICAgZXh0ZW5kQm94SG9yaXpvbnRhbDogMCwKICAgICAgICBleHRlbmRCb3hWZXJ0aWNhbDogMCwKICAgICAgICBjcm9zc1NhbXBsaW5nOiBmYWxzZSwKICAgICAgICBtdXN0UHJlRHJhdzogZmFsc2UsCiAgICAgICAgcHJlc2VydmVzT3BhcXVlbmVzczogdHJ1ZSwKICAgICAgICBhbmltYXRlZDogZmFsc2UsCiAgICAgICAgcGFyYW1ldGVyczogWwogICAgICAgICAgICBbImludGVuc2l0eSIsIDAsICJwZXJjZW50Il0KICAgICAgICBdCiAgICB9OwogICAgc2VsZlsiQzNfU2hhZGVycyJdWyJ0aW50Il0gPSB7CiAgICAgICAgZ2xzbDogInZhcnlpbmcgbWVkaXVtcCB2ZWMyIHZUZXg7XG51bmlmb3JtIGxvd3Agc2FtcGxlcjJEIHNhbXBsZXJGcm9udDtcbnVuaWZvcm0gbG93cCB2ZWMzIHRpbnRDb2xvcjtcbnZvaWQgbWFpbih2b2lkKVxue1xubG93cCB2ZWM0IGZyb250ID0gdGV4dHVyZTJEKHNhbXBsZXJGcm9udCwgdlRleCk7XG5nbF9GcmFnQ29sb3IgPSBmcm9udCAqIHZlYzQodGludENvbG9yLnIsIHRpbnRDb2xvci5nLCB0aW50Q29sb3IuYiwgMS4wKTtcbn0iLAogICAgICAgIGdsc2xXZWJHTDI6ICIiLAogICAgICAgIHdnc2w6ICIlJVNBTVBMRVJGUk9OVF9CSU5ESU5HJSUgdmFyIHNhbXBsZXJGcm9udCA6IHNhbXBsZXI7XG4lJVRFWFRVUkVGUk9OVF9CSU5ESU5HJSUgdmFyIHRleHR1cmVGcm9udCA6IHRleHR1cmVfMmQ8ZjMyPjtcbnN0cnVjdCBTaGFkZXJQYXJhbXMge1xudGludENvbG9yIDogdmVjMzxmMzI+XG59O1xuJSVTSEFERVJQQVJBTVNfQklORElORyUlIHZhcjx1bmlmb3JtPiBzaGFkZXJQYXJhbXMgOiBTaGFkZXJQYXJhbXM7XG4lJUZSQUdNRU5USU5QVVRfU1RSVUNUJSVcbiUlRlJBR01FTlRPVVRQVVRfU1RSVUNUJSVcbkBmcmFnbWVudFxuZm4gbWFpbihpbnB1dCA6IEZyYWdtZW50SW5wdXQpIC0+IEZyYWdtZW50T3V0cHV0IHtcbnZhciBmcm9udCA6IHZlYzQ8ZjMyPiA9IHRleHR1cmVTYW1wbGUodGV4dHVyZUZyb250LCBzYW1wbGVyRnJvbnQsIGlucHV0LmZyYWdVVik7XG52YXIgb3V0cHV0IDogRnJhZ21lbnRPdXRwdXQ7XG5vdXRwdXQuY29sb3IgPSBmcm9udCAqIHZlYzQ8ZjMyPihzaGFkZXJQYXJhbXMudGludENvbG9yLCAxLjApO1xucmV0dXJuIG91dHB1dDtcbn0iLAogICAgICAgIGJsZW5kc0JhY2tncm91bmQ6IGZhbHNlLAogICAgICAgIHVzZXNEZXB0aDogZmFsc2UsCiAgICAgICAgZXh0ZW5kQm94SG9yaXpvbnRhbDogMCwKICAgICAgICBleHRlbmRCb3hWZXJ0aWNhbDogMCwKICAgICAgICBjcm9zc1NhbXBsaW5nOiBmYWxzZSwKICAgICAgICBtdXN0UHJlRHJhdzogZmFsc2UsCiAgICAgICAgcHJlc2VydmVzT3BhcXVlbmVzczogdHJ1ZSwKICAgICAgICBhbmltYXRlZDogZmFsc2UsCiAgICAgICAgcGFyYW1ldGVyczogWwogICAgICAgICAgICBbInRpbnRDb2xvciIsIDAsICJjb2xvciJdCiAgICAgICAgXQogICAgfTsKICAgIHNlbGZbIkMzX1NoYWRlcnMiXVsiaGFyZGxpZ2h0Il0gPSB7CiAgICAgICAgZ2xzbDogInZhcnlpbmcgbWVkaXVtcCB2ZWMyIHZUZXg7XG51bmlmb3JtIGxvd3Agc2FtcGxlcjJEIHNhbXBsZXJGcm9udDtcbnVuaWZvcm0gbWVkaXVtcCB2ZWMyIHNyY1N0YXJ0O1xudW5pZm9ybSBtZWRpdW1wIHZlYzIgc3JjRW5kO1xudW5pZm9ybSBsb3dwIHNhbXBsZXIyRCBzYW1wbGVyQmFjaztcbnVuaWZvcm0gbWVkaXVtcCB2ZWMyIGRlc3RTdGFydDtcbnVuaWZvcm0gbWVkaXVtcCB2ZWMyIGRlc3RFbmQ7XG52b2lkIG1haW4odm9pZClcbntcbmxvd3AgdmVjNCBmcm9udCA9IHRleHR1cmUyRChzYW1wbGVyRnJvbnQsIHZUZXgpO1xubWVkaXVtcCB2ZWMyIHRleCA9ICh2VGV4IC0gc3JjU3RhcnQpIC8gKHNyY0VuZCAtIHNyY1N0YXJ0KTtcbmxvd3AgdmVjNCBiYWNrID0gdGV4dHVyZTJEKHNhbXBsZXJCYWNrLCBtaXgoZGVzdFN0YXJ0LCBkZXN0RW5kLCB0ZXgpKTtcbmlmIChmcm9udC5yICogMC4yOTkgKyBmcm9udC5nICogMC41ODcgKyBmcm9udC5iICogMC4xMTQgPD0gMC41KVxue1xuZnJvbnQgKj0gYmFjayAqIDIuMDtcbn1cbmVsc2VcbntcbmZyb250LnJnYiA9IDEuMCAtICgoMS4wIC0gKDIuMCAqIGZyb250LnJnYiAtIDEuMCkpICogKDEuMCAtIGJhY2sucmdiICogZnJvbnQuYSkpO1xufVxuZ2xfRnJhZ0NvbG9yID0gZnJvbnQ7XG59IiwKICAgICAgICBnbHNsV2ViR0wyOiAiIiwKICAgICAgICB3Z3NsOiAiJSVTQU1QTEVSRlJPTlRfQklORElORyUlIHZhciBzYW1wbGVyRnJvbnQgOiBzYW1wbGVyO1xuJSVURVhUVVJFRlJPTlRfQklORElORyUlIHZhciB0ZXh0dXJlRnJvbnQgOiB0ZXh0dXJlXzJkPGYzMj47XG4lJVNBTVBMRVJCQUNLX0JJTkRJTkclJSB2YXIgc2FtcGxlckJhY2sgOiBzYW1wbGVyO1xuJSVURVhUVVJFQkFDS19CSU5ESU5HJSUgdmFyIHRleHR1cmVCYWNrIDogdGV4dHVyZV8yZDxmMzI+O1xuJSVDM19VVElMSVRZX0ZVTkNUSU9OUyUlXG4lJUZSQUdNRU5USU5QVVRfU1RSVUNUJSVcbiUlRlJBR01FTlRPVVRQVVRfU1RSVUNUJSVcbkBmcmFnbWVudFxuZm4gbWFpbihpbnB1dCA6IEZyYWdtZW50SW5wdXQpIC0+IEZyYWdtZW50T3V0cHV0XG57XG52YXIgZnJvbnQgOiB2ZWM0PGYzMj4gPSB0ZXh0dXJlU2FtcGxlKHRleHR1cmVGcm9udCwgc2FtcGxlckZyb250LCBpbnB1dC5mcmFnVVYpO1xudmFyIGJhY2sgOiB2ZWM0PGYzMj4gPSB0ZXh0dXJlU2FtcGxlKHRleHR1cmVCYWNrLCBzYW1wbGVyQmFjaywgYzNfZ2V0QmFja1VWKGlucHV0LmZyYWdQb3MueHksIHRleHR1cmVCYWNrKSk7XG52YXIgb3V0cHV0IDogRnJhZ21lbnRPdXRwdXQ7XG5vdXRwdXQuY29sb3IgPSBzZWxlY3QoXG52ZWM0PGYzMj4oXG4xLjAgLSAoKDEuMCAtICgyLjAgKiBmcm9udC5yZ2IgLSAxLjApKSAqICgxLjAgLSBiYWNrLnJnYiAqIGZyb250LmEpKSxcbmZyb250LmFcbiksXG5mcm9udCAqIGJhY2sgKiAyLjAsXG5jM19ncmF5c2NhbGUoZnJvbnQucmdiKSA8PSAwLjVcbik7XG5yZXR1cm4gb3V0cHV0O1xufSIsCiAgICAgICAgYmxlbmRzQmFja2dyb3VuZDogdHJ1ZSwKICAgICAgICB1c2VzRGVwdGg6IGZhbHNlLAogICAgICAgIGV4dGVuZEJveEhvcml6b250YWw6IDAsCiAgICAgICAgZXh0ZW5kQm94VmVydGljYWw6IDAsCiAgICAgICAgY3Jvc3NTYW1wbGluZzogZmFsc2UsCiAgICAgICAgbXVzdFByZURyYXc6IGZhbHNlLAogICAgICAgIHByZXNlcnZlc09wYXF1ZW5lc3M6IGZhbHNlLAogICAgICAgIGFuaW1hdGVkOiBmYWxzZSwKICAgICAgICBwYXJhbWV0ZXJzOiBbXQogICAgfTsKCn0KCnsKICAgICd1c2Ugc3RyaWN0JzsgewogICAgICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgICAgICBsZXQgY2FjaGVSZWdleCA9IG51bGw7CiAgICAgICAgbGV0IGxhc3RSZWdleCA9ICIiOwogICAgICAgIGxldCBsYXN0RmxhZ3MgPSAiIjsKICAgICAgICBsZXQgcmVnZXhNYXRjaGVzID0gW107CiAgICAgICAgbGV0IGxhc3RNYXRjaGVzU3RyID0gIiI7CiAgICAgICAgbGV0IGxhc3RNYXRjaGVzUmVnZXggPSAiIjsKICAgICAgICBsZXQgbGFzdE1hdGNoZXNGbGFncyA9ICIiOwogICAgICAgIGNvbnN0IGZvckVhY2hTdGFjayA9IEMzLk5ldyhDMy5BcnJheVN0YWNrKTsKCiAgICAgICAgZnVuY3Rpb24gRm9yRWFjaE9yZGVyZWRfU29ydEluc3RhbmNlcyhhLCBiKSB7CiAgICAgICAgICAgIGNvbnN0IHZhID0gYVsxXTsKICAgICAgICAgICAgY29uc3QgdmIgPSBiWzFdOwogICAgICAgICAgICBpZiAodHlwZW9mIHZhID09PSAibnVtYmVyIiAmJiB0eXBlb2YgdmIgPT09ICJudW1iZXIiKSByZXR1cm4gdmEgLSB2YjsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBjb25zdCBzYSA9ICIiICsgdmE7CiAgICAgICAgICAgICAgICBjb25zdCBzYiA9ICIiICsgdmI7CiAgICAgICAgICAgICAgICBpZiAoc2EgPCBzYikgcmV0dXJuIC0xOwogICAgICAgICAgICAgICAgZWxzZSBpZiAoc2EgPiBzYikgcmV0dXJuIDE7CiAgICAgICAgICAgICAgICBlbHNlIHJldHVybiAwCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgQzMuUGx1Z2lucy5TeXN0ZW0gPSBjbGFzcyBTeXN0ZW1QbHVnaW4gZXh0ZW5kcyBDMy5TREtQbHVnaW5CYXNlIHsKICAgICAgICAgICAgY29uc3RydWN0b3Iob3B0cykgewogICAgICAgICAgICAgICAgc3VwZXIob3B0cyk7CiAgICAgICAgICAgICAgICB0aGlzLl9sb29wU3RhY2sgPSB0aGlzLl9ydW50aW1lLkdldEV2ZW50U2hlZXRNYW5hZ2VyKCkuR2V0TG9vcFN0YWNrKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9ldmVudFN0YWNrID0gdGhpcy5fcnVudGltZS5HZXRFdmVudFNoZWV0TWFuYWdlcigpLkdldEV2ZW50U3RhY2soKTsKICAgICAgICAgICAgICAgIHRoaXMuX2ltYWdlc0xvYWRpbmdUb3RhbCA9IDA7CiAgICAgICAgICAgICAgICB0aGlzLl9pbWFnZXNMb2FkaW5nQ29tcGxldGUgPSAwOwogICAgICAgICAgICAgICAgdGhpcy5fZnVuY3Rpb25NYXBzID0gbmV3IE1hcDsKICAgICAgICAgICAgICAgIHRoaXMuX3NpZ25hbFRhZ3MgPSBbXQogICAgICAgICAgICB9CiAgICAgICAgICAgIFJlbGVhc2UoKSB7CiAgICAgICAgICAgICAgICBzdXBlci5SZWxlYXNlKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBVcGRhdGVSZW5kZXIoKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9ydW50aW1lLlVwZGF0ZVJlbmRlcigpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgVHJpZ2dlcihtZXRob2QpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuVHJpZ2dlcihtZXRob2QsIG51bGwsIG51bGwpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgR2V0UmVnZXgocmVnZXgsIGZsYWdzKSB7CiAgICAgICAgICAgICAgICBpZiAoIWNhY2hlUmVnZXggfHwgcmVnZXggIT09IGxhc3RSZWdleCB8fCBmbGFncyAhPT0gbGFzdEZsYWdzKSB7CiAgICAgICAgICAgICAgICAgICAgY2FjaGVSZWdleCA9IG5ldyBSZWdFeHAocmVnZXgsIGZsYWdzKTsKICAgICAgICAgICAgICAgICAgICBsYXN0UmVnZXggPSByZWdleDsKICAgICAgICAgICAgICAgICAgICBsYXN0RmxhZ3MgPQogICAgICAgICAgICAgICAgICAgICAgICBmbGFncwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2FjaGVSZWdleC5sYXN0SW5kZXggPSAwOwogICAgICAgICAgICAgICAgcmV0dXJuIGNhY2hlUmVnZXgKICAgICAgICAgICAgfQogICAgICAgICAgICBHZXRSZWdleE1hdGNoZXMoc3RyLCByZWdleCwgZmxhZ3MpIHsKICAgICAgICAgICAgICAgIGlmIChzdHIgPT09IGxhc3RNYXRjaGVzU3RyICYmIHJlZ2V4ID09PSBsYXN0TWF0Y2hlc1JlZ2V4ICYmIGZsYWdzID09PSBsYXN0TWF0Y2hlc0ZsYWdzKSByZXR1cm4gcmVnZXhNYXRjaGVzOwogICAgICAgICAgICAgICAgY29uc3QgY2FjaGVSZWdleCA9IHRoaXMuR2V0UmVnZXgocmVnZXgsIGZsYWdzKTsKICAgICAgICAgICAgICAgIHJlZ2V4TWF0Y2hlcyA9IHN0ci5tYXRjaChjYWNoZVJlZ2V4KTsKICAgICAgICAgICAgICAgIGxhc3RNYXRjaGVzU3RyID0gc3RyOwogICAgICAgICAgICAgICAgbGFzdE1hdGNoZXNSZWdleCA9IHJlZ2V4OwogICAgICAgICAgICAgICAgbGFzdE1hdGNoZXNGbGFncyA9IGZsYWdzOwogICAgICAgICAgICAgICAgcmV0dXJuIHJlZ2V4TWF0Y2hlcwogICAgICAgICAgICB9CiAgICAgICAgICAgIGFzeW5jIF9Mb2FkVGV4dHVyZXNGb3JPYmplY3RDbGFzc2VzKGxheW91dCwgb2JqZWN0Q2xhc3NlcykgewogICAgICAgICAgICAgICAgaWYgKCFvYmplY3RDbGFzc2VzLmxlbmd0aCkgcmV0dXJuOwogICAgICAgICAgICAgICAgdGhpcy5faW1hZ2VzTG9hZGluZ1RvdGFsICs9IG9iamVjdENsYXNzZXMubGVuZ3RoOwogICAgICAgICAgICAgICAgY29uc3QgcHJvbWlzZXMgPSBbXTsKICAgICAgICAgICAgICAgIGZvciAoY29uc3Qgb2Mgb2Ygb2JqZWN0Q2xhc3NlcykgcHJvbWlzZXMucHVzaChsYXlvdXQuTWF5YmVMb2FkVGV4dHVyZXNGb3Iob2MpKTsKICAgICAgICAgICAgICAgIGF3YWl0IEMzLlByb21pc2VBbGxXaXRoUHJvZ3Jlc3MocHJvbWlzZXMsICgpID0+IHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9pbWFnZXNMb2FkaW5nQ29tcGxldGUrKwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB0aGlzLl9pbWFnZXNMb2FkaW5nQ29tcGxldGUrKzsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9pbWFnZXNMb2FkaW5nQ29tcGxldGUgPT09IHRoaXMuX2ltYWdlc0xvYWRpbmdUb3RhbCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX2ltYWdlc0xvYWRpbmdDb21wbGV0ZSA9IDA7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5faW1hZ2VzTG9hZGluZ1RvdGFsID0gMDsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9ydW50aW1lLlRyaWdnZXIoQzMuUGx1Z2lucy5TeXN0ZW0uQ25kcy5PbkltYWdlTG9hZGluZ0NvbXBsZXRlLCBudWxsLCBudWxsKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9VbmxvYWRUZXh0dXJlc0Zvck9iamVjdENsYXNzZXMobGF5b3V0LCBvYmplY3RDbGFzc2VzKSB7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IG9jIG9mIG9iamVjdENsYXNzZXMpCiAgICAgICAgICAgICAgICAgICAgaWYgKG9jLkdldEluc3RhbmNlQ291bnQoKSA9PT0gMCkgbGF5b3V0Lk1heWJlVW5sb2FkVGV4dHVyZXNGb3Iob2MpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX0dldEZvckVhY2hTdGFjaygpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmb3JFYWNoU3RhY2sKICAgICAgICAgICAgfQogICAgICAgICAgICBfUmVwZWF0KGNvdW50KSB7CiAgICAgICAgICAgICAgICBjb25zdCBldmVudFNoZWV0TWFuYWdlciA9CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcnVudGltZS5HZXRFdmVudFNoZWV0TWFuYWdlcigpOwogICAgICAgICAgICAgICAgY29uc3QgZXZlbnRTdGFjayA9IGV2ZW50U2hlZXRNYW5hZ2VyLkdldEV2ZW50U3RhY2soKTsKICAgICAgICAgICAgICAgIGNvbnN0IG9sZEZyYW1lID0gZXZlbnRTdGFjay5HZXRDdXJyZW50U3RhY2tGcmFtZSgpOwogICAgICAgICAgICAgICAgY29uc3QgY3VycmVudEV2ZW50ID0gb2xkRnJhbWUuR2V0Q3VycmVudEV2ZW50KCk7CiAgICAgICAgICAgICAgICBjb25zdCBzb2xNb2RpZmllcnMgPSBjdXJyZW50RXZlbnQuR2V0U29sTW9kaWZpZXJzKCk7CiAgICAgICAgICAgICAgICBjb25zdCBpc1NvbE1vZGlmaWVyQWZ0ZXJDbmRzID0gb2xkRnJhbWUuSXNTb2xNb2RpZmllckFmdGVyQ25kcygpOwogICAgICAgICAgICAgICAgY29uc3QgbmV3RnJhbWUgPSBldmVudFN0YWNrLlB1c2goY3VycmVudEV2ZW50KTsKICAgICAgICAgICAgICAgIGNvbnN0IGxvb3BTdGFjayA9IGV2ZW50U2hlZXRNYW5hZ2VyLkdldExvb3BTdGFjaygpOwogICAgICAgICAgICAgICAgY29uc3QgbG9vcCA9IGxvb3BTdGFjay5QdXNoKCk7CiAgICAgICAgICAgICAgICBsb29wLlNldEVuZChjb3VudCk7CiAgICAgICAgICAgICAgICBpZiAoaXNTb2xNb2RpZmllckFmdGVyQ25kcykKICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50ICYmICFsb29wLklzU3RvcHBlZCgpOyArK2kpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnRTaGVldE1hbmFnZXIuUHVzaENvcHlTb2woc29sTW9kaWZpZXJzKTsKICAgICAgICAgICAgICAgICAgICAgICAgbG9vcC5TZXRJbmRleChpKTsKICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudEV2ZW50LlJldHJpZ2dlcihvbGRGcmFtZSwgbmV3RnJhbWUpOwogICAgICAgICAgICAgICAgICAgICAgICBldmVudFNoZWV0TWFuYWdlci5Qb3BTb2woc29sTW9kaWZpZXJzKQogICAgICAgICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50ICYmICFsb29wLklzU3RvcHBlZCgpOyArK2kpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvb3AuU2V0SW5kZXgoaSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50RXZlbnQuUmV0cmlnZ2VyKG9sZEZyYW1lLCBuZXdGcmFtZSkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZXZlbnRTdGFjay5Qb3AoKTsKICAgICAgICAgICAgICAgIGxvb3BTdGFjay5Qb3AoKTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZQogICAgICAgICAgICB9KiBfRGVidWdSZXBlYXQoY291bnQpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGV2ZW50U2hlZXRNYW5hZ2VyID0gdGhpcy5fcnVudGltZS5HZXRFdmVudFNoZWV0TWFuYWdlcigpOwogICAgICAgICAgICAgICAgY29uc3QgZXZlbnRTdGFjayA9IGV2ZW50U2hlZXRNYW5hZ2VyLkdldEV2ZW50U3RhY2soKTsKICAgICAgICAgICAgICAgIGNvbnN0IG9sZEZyYW1lID0gZXZlbnRTdGFjay5HZXRDdXJyZW50U3RhY2tGcmFtZSgpOwogICAgICAgICAgICAgICAgY29uc3QgY3VycmVudEV2ZW50ID0gb2xkRnJhbWUuR2V0Q3VycmVudEV2ZW50KCk7CiAgICAgICAgICAgICAgICBjb25zdCBzb2xNb2RpZmllcnMgPSBjdXJyZW50RXZlbnQuR2V0U29sTW9kaWZpZXJzKCk7CiAgICAgICAgICAgICAgICBjb25zdCBpc1NvbE1vZGlmaWVyQWZ0ZXJDbmRzID0gb2xkRnJhbWUuSXNTb2xNb2RpZmllckFmdGVyQ25kcygpOwogICAgICAgICAgICAgICAgY29uc3QgbmV3RnJhbWUgPSBldmVudFN0YWNrLlB1c2goY3VycmVudEV2ZW50KTsKICAgICAgICAgICAgICAgIGNvbnN0IGxvb3BTdGFjayA9IGV2ZW50U2hlZXRNYW5hZ2VyLkdldExvb3BTdGFjaygpOwogICAgICAgICAgICAgICAgY29uc3QgbG9vcCA9IGxvb3BTdGFjay5QdXNoKCk7CiAgICAgICAgICAgICAgICBsb29wLlNldEVuZChjb3VudCk7CiAgICAgICAgICAgICAgICBpZiAoaXNTb2xNb2RpZmllckFmdGVyQ25kcykKICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50ICYmICFsb29wLklzU3RvcHBlZCgpOyArK2kpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnRTaGVldE1hbmFnZXIuUHVzaENvcHlTb2woc29sTW9kaWZpZXJzKTsKICAgICAgICAgICAgICAgICAgICAgICAgbG9vcC5TZXRJbmRleChpKTsKICAgICAgICAgICAgICAgICAgICAgICAgeWllbGQqIGN1cnJlbnRFdmVudC5EZWJ1Z1JldHJpZ2dlcihvbGRGcmFtZSwgbmV3RnJhbWUpOwogICAgICAgICAgICAgICAgICAgICAgICBldmVudFNoZWV0TWFuYWdlci5Qb3BTb2woc29sTW9kaWZpZXJzKQogICAgICAgICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50ICYmICFsb29wLklzU3RvcHBlZCgpOyArK2kpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvb3AuU2V0SW5kZXgoaSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB5aWVsZCogY3VycmVudEV2ZW50LkRlYnVnUmV0cmlnZ2VyKG9sZEZyYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld0ZyYW1lKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBldmVudFN0YWNrLlBvcCgpOwogICAgICAgICAgICAgICAgbG9vcFN0YWNrLlBvcCgpOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX1doaWxlKCkgewogICAgICAgICAgICAgICAgY29uc3QgZXZlbnRTaGVldE1hbmFnZXIgPSB0aGlzLl9ydW50aW1lLkdldEV2ZW50U2hlZXRNYW5hZ2VyKCk7CiAgICAgICAgICAgICAgICBjb25zdCBldmVudFN0YWNrID0gZXZlbnRTaGVldE1hbmFnZXIuR2V0RXZlbnRTdGFjaygpOwogICAgICAgICAgICAgICAgY29uc3Qgb2xkRnJhbWUgPSBldmVudFN0YWNrLkdldEN1cnJlbnRTdGFja0ZyYW1lKCk7CiAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50RXZlbnQgPSBvbGRGcmFtZS5HZXRDdXJyZW50RXZlbnQoKTsKICAgICAgICAgICAgICAgIGNvbnN0IHNvbE1vZGlmaWVycyA9IGN1cnJlbnRFdmVudC5HZXRTb2xNb2RpZmllcnMoKTsKICAgICAgICAgICAgICAgIGNvbnN0IGlzU29sTW9kaWZpZXJBZnRlckNuZHMgPSBvbGRGcmFtZS5Jc1NvbE1vZGlmaWVyQWZ0ZXJDbmRzKCk7CiAgICAgICAgICAgICAgICBjb25zdCBuZXdGcmFtZSA9IGV2ZW50U3RhY2suUHVzaChjdXJyZW50RXZlbnQpOwogICAgICAgICAgICAgICAgY29uc3QgbG9vcFN0YWNrID0gZXZlbnRTaGVldE1hbmFnZXIuR2V0TG9vcFN0YWNrKCk7CiAgICAgICAgICAgICAgICBjb25zdCBsb29wID0gbG9vcFN0YWNrLlB1c2goKTsKICAgICAgICAgICAgICAgIGlmIChpc1NvbE1vZGlmaWVyQWZ0ZXJDbmRzKQogICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyAhbG9vcC5Jc1N0b3BwZWQoKTsgKytpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50U2hlZXRNYW5hZ2VyLlB1c2hDb3B5U29sKHNvbE1vZGlmaWVycyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvb3AuU2V0SW5kZXgoaSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghY3VycmVudEV2ZW50LlJldHJpZ2dlcihvbGRGcmFtZSwgbmV3RnJhbWUpKSBsb29wLlN0b3AoKTsKICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnRTaGVldE1hbmFnZXIuUG9wU29sKHNvbE1vZGlmaWVycykKICAgICAgICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7ICFsb29wLklzU3RvcHBlZCgpOyArK2kpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvb3AuU2V0SW5kZXgoaSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWN1cnJlbnRFdmVudC5SZXRyaWdnZXIob2xkRnJhbWUsIG5ld0ZyYW1lKSkgbG9vcC5TdG9wKCkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZXZlbnRTdGFjay5Qb3AoKTsKICAgICAgICAgICAgICAgIGxvb3BTdGFjay5Qb3AoKTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZQogICAgICAgICAgICB9KiBfRGVidWdXaGlsZSgpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGV2ZW50U2hlZXRNYW5hZ2VyID0gdGhpcy5fcnVudGltZS5HZXRFdmVudFNoZWV0TWFuYWdlcigpOwogICAgICAgICAgICAgICAgY29uc3QgZXZlbnRTdGFjayA9IGV2ZW50U2hlZXRNYW5hZ2VyLkdldEV2ZW50U3RhY2soKTsKICAgICAgICAgICAgICAgIGNvbnN0IG9sZEZyYW1lID0gZXZlbnRTdGFjay5HZXRDdXJyZW50U3RhY2tGcmFtZSgpOwogICAgICAgICAgICAgICAgY29uc3QgY3VycmVudEV2ZW50ID0gb2xkRnJhbWUuR2V0Q3VycmVudEV2ZW50KCk7CiAgICAgICAgICAgICAgICBjb25zdCBzb2xNb2RpZmllcnMgPSBjdXJyZW50RXZlbnQuR2V0U29sTW9kaWZpZXJzKCk7CiAgICAgICAgICAgICAgICBjb25zdCBpc1NvbE1vZGlmaWVyQWZ0ZXJDbmRzID0gb2xkRnJhbWUuSXNTb2xNb2RpZmllckFmdGVyQ25kcygpOwogICAgICAgICAgICAgICAgY29uc3QgbmV3RnJhbWUgPSBldmVudFN0YWNrLlB1c2goY3VycmVudEV2ZW50KTsKICAgICAgICAgICAgICAgIGNvbnN0IGxvb3BTdGFjayA9IGV2ZW50U2hlZXRNYW5hZ2VyLkdldExvb3BTdGFjaygpOwogICAgICAgICAgICAgICAgY29uc3QgbG9vcCA9IGxvb3BTdGFjay5QdXNoKCk7CiAgICAgICAgICAgICAgICBpZiAoaXNTb2xNb2RpZmllckFmdGVyQ25kcykKICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgIWxvb3AuSXNTdG9wcGVkKCk7ICsraSkgewogICAgICAgICAgICAgICAgICAgICAgICBldmVudFNoZWV0TWFuYWdlci5QdXNoQ29weVNvbChzb2xNb2RpZmllcnMpOwogICAgICAgICAgICAgICAgICAgICAgICBsb29wLlNldEluZGV4KGkpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByZXQgPSB5aWVsZCogY3VycmVudEV2ZW50LkRlYnVnUmV0cmlnZ2VyKG9sZEZyYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3RnJhbWUpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXJldCkgbG9vcC5TdG9wKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50U2hlZXRNYW5hZ2VyLlBvcFNvbChzb2xNb2RpZmllcnMpCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyAhbG9vcC5Jc1N0b3BwZWQoKTsgKytpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb29wLlNldEluZGV4KGkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmV0ID0geWllbGQqIGN1cnJlbnRFdmVudC5EZWJ1Z1JldHJpZ2dlcihvbGRGcmFtZSwgbmV3RnJhbWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFyZXQpIGxvb3AuU3RvcCgpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGV2ZW50U3RhY2suUG9wKCk7CiAgICAgICAgICAgICAgICBsb29wU3RhY2suUG9wKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICAgICAgfQogICAgICAgICAgICBfRm9yKG5hbWUsIHN0YXJ0LCBlbmQpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGV2ZW50U2hlZXRNYW5hZ2VyID0gdGhpcy5fcnVudGltZS5HZXRFdmVudFNoZWV0TWFuYWdlcigpOwogICAgICAgICAgICAgICAgY29uc3QgZXZlbnRTdGFjayA9IGV2ZW50U2hlZXRNYW5hZ2VyLkdldEV2ZW50U3RhY2soKTsKICAgICAgICAgICAgICAgIGNvbnN0IG9sZEZyYW1lID0gZXZlbnRTdGFjay5HZXRDdXJyZW50U3RhY2tGcmFtZSgpOwogICAgICAgICAgICAgICAgY29uc3QgY3VycmVudEV2ZW50ID0gb2xkRnJhbWUuR2V0Q3VycmVudEV2ZW50KCk7CiAgICAgICAgICAgICAgICBjb25zdCBzb2xNb2RpZmllcnMgPQogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRFdmVudC5HZXRTb2xNb2RpZmllcnMoKTsKICAgICAgICAgICAgICAgIGNvbnN0IGlzU29sTW9kaWZpZXJBZnRlckNuZHMgPSBvbGRGcmFtZS5Jc1NvbE1vZGlmaWVyQWZ0ZXJDbmRzKCk7CiAgICAgICAgICAgICAgICBjb25zdCBuZXdGcmFtZSA9IGV2ZW50U3RhY2suUHVzaChjdXJyZW50RXZlbnQpOwogICAgICAgICAgICAgICAgY29uc3QgbG9vcFN0YWNrID0gZXZlbnRTaGVldE1hbmFnZXIuR2V0TG9vcFN0YWNrKCk7CiAgICAgICAgICAgICAgICBjb25zdCBsb29wID0gbG9vcFN0YWNrLlB1c2goKTsKICAgICAgICAgICAgICAgIGxvb3AuU2V0TmFtZShuYW1lKTsKICAgICAgICAgICAgICAgIGxvb3AuU2V0RW5kKGVuZCk7CiAgICAgICAgICAgICAgICBpZiAoZW5kIDwgc3RhcnQpCiAgICAgICAgICAgICAgICAgICAgaWYgKGlzU29sTW9kaWZpZXJBZnRlckNuZHMpCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSBzdGFydDsgaSA+PSBlbmQgJiYgIWxvb3AuSXNTdG9wcGVkKCk7IC0taSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnRTaGVldE1hbmFnZXIuUHVzaENvcHlTb2woc29sTW9kaWZpZXJzKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvb3AuU2V0SW5kZXgoaSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50RXZlbnQuUmV0cmlnZ2VyKG9sZEZyYW1lLCBuZXdGcmFtZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudFNoZWV0TWFuYWdlci5Qb3BTb2woc29sTW9kaWZpZXJzKQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSBzdGFydDsgaSA+PQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZCAmJiAhbG9vcC5Jc1N0b3BwZWQoKTsgLS1pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9vcC5TZXRJbmRleChpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50RXZlbnQuUmV0cmlnZ2VyKG9sZEZyYW1lLCBuZXdGcmFtZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNTb2xNb2RpZmllckFmdGVyQ25kcykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gc3RhcnQ7IGkgPD0gZW5kICYmICFsb29wLklzU3RvcHBlZCgpOyArK2kpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnRTaGVldE1hbmFnZXIuUHVzaENvcHlTb2woc29sTW9kaWZpZXJzKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9vcC5TZXRJbmRleChpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudEV2ZW50LlJldHJpZ2dlcihvbGRGcmFtZSwgbmV3RnJhbWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudFNoZWV0TWFuYWdlci5Qb3BTb2woc29sTW9kaWZpZXJzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gc3RhcnQ7IGkgPD0gZW5kICYmICFsb29wLklzU3RvcHBlZCgpOyArK2kpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvb3AuU2V0SW5kZXgoaSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50RXZlbnQuUmV0cmlnZ2VyKG9sZEZyYW1lLCBuZXdGcmFtZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZXZlbnRTdGFjay5Qb3AoKTsKICAgICAgICAgICAgICAgIGxvb3BTdGFjay5Qb3AoKTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZQogICAgICAgICAgICB9KiBfRGVidWdGb3IobmFtZSwgc3RhcnQsIGVuZCkgewogICAgICAgICAgICAgICAgY29uc3QgZXZlbnRTaGVldE1hbmFnZXIgPQogICAgICAgICAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuR2V0RXZlbnRTaGVldE1hbmFnZXIoKTsKICAgICAgICAgICAgICAgIGNvbnN0IGV2ZW50U3RhY2sgPSBldmVudFNoZWV0TWFuYWdlci5HZXRFdmVudFN0YWNrKCk7CiAgICAgICAgICAgICAgICBjb25zdCBvbGRGcmFtZSA9IGV2ZW50U3RhY2suR2V0Q3VycmVudFN0YWNrRnJhbWUoKTsKICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRFdmVudCA9IG9sZEZyYW1lLkdldEN1cnJlbnRFdmVudCgpOwogICAgICAgICAgICAgICAgY29uc3Qgc29sTW9kaWZpZXJzID0gY3VycmVudEV2ZW50LkdldFNvbE1vZGlmaWVycygpOwogICAgICAgICAgICAgICAgY29uc3QgaXNTb2xNb2RpZmllckFmdGVyQ25kcyA9IG9sZEZyYW1lLklzU29sTW9kaWZpZXJBZnRlckNuZHMoKTsKICAgICAgICAgICAgICAgIGNvbnN0IG5ld0ZyYW1lID0gZXZlbnRTdGFjay5QdXNoKGN1cnJlbnRFdmVudCk7CiAgICAgICAgICAgICAgICBjb25zdCBsb29wU3RhY2sgPSBldmVudFNoZWV0TWFuYWdlci5HZXRMb29wU3RhY2soKTsKICAgICAgICAgICAgICAgIGNvbnN0IGxvb3AgPSBsb29wU3RhY2suUHVzaCgpOwogICAgICAgICAgICAgICAgbG9vcC5TZXROYW1lKG5hbWUpOwogICAgICAgICAgICAgICAgbG9vcC5TZXRFbmQoZW5kKTsKICAgICAgICAgICAgICAgIGlmIChlbmQgPCBzdGFydCkKICAgICAgICAgICAgICAgICAgICBpZiAoaXNTb2xNb2RpZmllckFmdGVyQ25kcykKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnQ7IGkgPj0gZW5kICYmICFsb29wLklzU3RvcHBlZCgpOyAtLWkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50U2hlZXRNYW5hZ2VyLlB1c2hDb3B5U29sKHNvbE1vZGlmaWVycyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb29wLlNldEluZGV4KGkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgeWllbGQqIGN1cnJlbnRFdmVudC5EZWJ1Z1JldHJpZ2dlcihvbGRGcmFtZSwgbmV3RnJhbWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnRTaGVldE1hbmFnZXIuUG9wU29sKHNvbE1vZGlmaWVycykKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gc3RhcnQ7IGkgPj0gZW5kICYmICFsb29wLklzU3RvcHBlZCgpOyAtLWkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb29wLlNldEluZGV4KGkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHlpZWxkKiBjdXJyZW50RXZlbnQuRGVidWdSZXRyaWdnZXIob2xkRnJhbWUsIG5ld0ZyYW1lKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpc1NvbE1vZGlmaWVyQWZ0ZXJDbmRzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSBzdGFydDsgaSA8PSBlbmQgJiYgIWxvb3AuSXNTdG9wcGVkKCk7ICsraSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudFNoZWV0TWFuYWdlci5QdXNoQ29weVNvbChzb2xNb2RpZmllcnMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb29wLlNldEluZGV4KGkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB5aWVsZCogY3VycmVudEV2ZW50LkRlYnVnUmV0cmlnZ2VyKG9sZEZyYW1lLCBuZXdGcmFtZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50U2hlZXRNYW5hZ2VyLlBvcFNvbChzb2xNb2RpZmllcnMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSBzdGFydDsgaSA8PSBlbmQgJiYgIWxvb3AuSXNTdG9wcGVkKCk7ICsraSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9vcC5TZXRJbmRleChpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHlpZWxkKiBjdXJyZW50RXZlbnQuRGVidWdSZXRyaWdnZXIob2xkRnJhbWUsIG5ld0ZyYW1lKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBldmVudFN0YWNrLlBvcCgpOwogICAgICAgICAgICAgICAgbG9vcFN0YWNrLlBvcCgpOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX0ZvckVhY2gob2JqZWN0Q2xhc3MpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGV2ZW50U2hlZXRNYW5hZ2VyID0gdGhpcy5fcnVudGltZS5HZXRFdmVudFNoZWV0TWFuYWdlcigpOwogICAgICAgICAgICAgICAgY29uc3QgZXZlbnRTdGFjayA9IGV2ZW50U2hlZXRNYW5hZ2VyLkdldEV2ZW50U3RhY2soKTsKICAgICAgICAgICAgICAgIGNvbnN0IG9sZEZyYW1lID0gZXZlbnRTdGFjay5HZXRDdXJyZW50U3RhY2tGcmFtZSgpOwogICAgICAgICAgICAgICAgY29uc3QgY3VycmVudEV2ZW50ID0gb2xkRnJhbWUuR2V0Q3VycmVudEV2ZW50KCk7CiAgICAgICAgICAgICAgICBjb25zdCBzb2xNb2RpZmllcnMgPSBjdXJyZW50RXZlbnQuR2V0U29sTW9kaWZpZXJzKCk7CiAgICAgICAgICAgICAgICBjb25zdCBpc1NvbE1vZGlmaWVyQWZ0ZXJDbmRzID0KICAgICAgICAgICAgICAgICAgICBvbGRGcmFtZS5Jc1NvbE1vZGlmaWVyQWZ0ZXJDbmRzKCk7CiAgICAgICAgICAgICAgICBjb25zdCBuZXdGcmFtZSA9IGV2ZW50U3RhY2suUHVzaChjdXJyZW50RXZlbnQpOwogICAgICAgICAgICAgICAgY29uc3QgbG9vcFN0YWNrID0gZXZlbnRTaGVldE1hbmFnZXIuR2V0TG9vcFN0YWNrKCk7CiAgICAgICAgICAgICAgICBjb25zdCBsb29wID0gbG9vcFN0YWNrLlB1c2goKTsKICAgICAgICAgICAgICAgIGNvbnN0IGlzSW5Db250YWluZXIgPSBvYmplY3RDbGFzcy5Jc0luQ29udGFpbmVyKCk7CiAgICAgICAgICAgICAgICBjb25zdCBzb2wgPSBvYmplY3RDbGFzcy5HZXRDdXJyZW50U29sKCk7CiAgICAgICAgICAgICAgICBjb25zdCBpbnN0YW5jZXMgPSBmb3JFYWNoU3RhY2suUHVzaCgpOwogICAgICAgICAgICAgICAgQzMuc2hhbGxvd0Fzc2lnbkFycmF5KGluc3RhbmNlcywgc29sLkdldEluc3RhbmNlcygpKTsKICAgICAgICAgICAgICAgIGxvb3AuU2V0RW5kKGluc3RhbmNlcy5sZW5ndGgpOwogICAgICAgICAgICAgICAgaWYgKGlzU29sTW9kaWZpZXJBZnRlckNuZHMpCiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IGluc3RhbmNlcy5sZW5ndGg7IGkgPCBsZW4gJiYgIWxvb3AuSXNTdG9wcGVkKCk7ICsraSkgewogICAgICAgICAgICAgICAgICAgICAgICBldmVudFNoZWV0TWFuYWdlci5QdXNoQ29weVNvbChzb2xNb2RpZmllcnMpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpbnN0ID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluc3RhbmNlc1tpXTsKICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0Q2xhc3MuR2V0Q3VycmVudFNvbCgpLlNldFNpbmdsZVBpY2tlZChpbnN0KTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzSW5Db250YWluZXIpIGluc3QuU2V0U2libGluZ3NTaW5nbGVQaWNrZWQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgbG9vcC5TZXRJbmRleChpKTsKICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudEV2ZW50LlJldHJpZ2dlcihvbGRGcmFtZSwgbmV3RnJhbWUpOwogICAgICAgICAgICAgICAgICAgICAgICBldmVudFNoZWV0TWFuYWdlci5Qb3BTb2woc29sTW9kaWZpZXJzKQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNvbC5fU2V0U2VsZWN0QWxsKGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc29sSW5zdGFuY2VzID0gc29sLl9HZXRPd25JbnN0YW5jZXMoKTsKICAgICAgICAgICAgICAgICAgICAgICAgQzMuY2xlYXJBcnJheShzb2xJbnN0YW5jZXMpOwogICAgICAgICAgICAgICAgICAgICAgICBzb2xJbnN0YW5jZXMucHVzaChudWxsKTsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IGluc3RhbmNlcy5sZW5ndGg7IGkgPCBsZW4gJiYgIWxvb3AuSXNTdG9wcGVkKCk7ICsraSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5zdCA9IGluc3RhbmNlc1tpXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvbEluc3RhbmNlc1swXSA9IGluc3Q7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNJbkNvbnRhaW5lcikgaW5zdC5TZXRTaWJsaW5nc1NpbmdsZVBpY2tlZCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9vcC5TZXRJbmRleChpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRFdmVudC5SZXRyaWdnZXIob2xkRnJhbWUsIG5ld0ZyYW1lKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZXZlbnRTdGFjay5Qb3AoKTsKICAgICAgICAgICAgICAgIGxvb3BTdGFjay5Qb3AoKTsKICAgICAgICAgICAgICAgIEMzLmNsZWFyQXJyYXkoaW5zdGFuY2VzKTsKICAgICAgICAgICAgICAgIGZvckVhY2hTdGFjay5Qb3AoKTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZQogICAgICAgICAgICB9KiBfRGVidWdGb3JFYWNoKG9iamVjdENsYXNzKSB7CiAgICAgICAgICAgICAgICBjb25zdCBldmVudFNoZWV0TWFuYWdlciA9IHRoaXMuX3J1bnRpbWUuR2V0RXZlbnRTaGVldE1hbmFnZXIoKTsKICAgICAgICAgICAgICAgIGNvbnN0IGV2ZW50U3RhY2sgPSBldmVudFNoZWV0TWFuYWdlci5HZXRFdmVudFN0YWNrKCk7CiAgICAgICAgICAgICAgICBjb25zdCBvbGRGcmFtZSA9IGV2ZW50U3RhY2suR2V0Q3VycmVudFN0YWNrRnJhbWUoKTsKICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRFdmVudCA9IG9sZEZyYW1lLkdldEN1cnJlbnRFdmVudCgpOwogICAgICAgICAgICAgICAgY29uc3Qgc29sTW9kaWZpZXJzID0gY3VycmVudEV2ZW50LkdldFNvbE1vZGlmaWVycygpOwogICAgICAgICAgICAgICAgY29uc3QgaXNTb2xNb2RpZmllckFmdGVyQ25kcyA9IG9sZEZyYW1lLklzU29sTW9kaWZpZXJBZnRlckNuZHMoKTsKICAgICAgICAgICAgICAgIGNvbnN0IG5ld0ZyYW1lID0gZXZlbnRTdGFjay5QdXNoKGN1cnJlbnRFdmVudCk7CiAgICAgICAgICAgICAgICBjb25zdCBsb29wU3RhY2sgPSBldmVudFNoZWV0TWFuYWdlci5HZXRMb29wU3RhY2soKTsKICAgICAgICAgICAgICAgIGNvbnN0IGxvb3AgPSBsb29wU3RhY2suUHVzaCgpOwogICAgICAgICAgICAgICAgY29uc3QgaXNJbkNvbnRhaW5lciA9IG9iamVjdENsYXNzLklzSW5Db250YWluZXIoKTsKICAgICAgICAgICAgICAgIGNvbnN0IHNvbCA9IG9iamVjdENsYXNzLkdldEN1cnJlbnRTb2woKTsKICAgICAgICAgICAgICAgIGNvbnN0IGluc3RhbmNlcyA9IGZvckVhY2hTdGFjay5QdXNoKCk7CiAgICAgICAgICAgICAgICBDMy5zaGFsbG93QXNzaWduQXJyYXkoaW5zdGFuY2VzLCBzb2wuR2V0SW5zdGFuY2VzKCkpOwogICAgICAgICAgICAgICAgbG9vcC5TZXRFbmQoaW5zdGFuY2VzLmxlbmd0aCk7CiAgICAgICAgICAgICAgICBpZiAoaXNTb2xNb2RpZmllckFmdGVyQ25kcykKICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gaW5zdGFuY2VzLmxlbmd0aDsgaSA8IGxlbiAmJiAhbG9vcC5Jc1N0b3BwZWQoKTsgKytpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50U2hlZXRNYW5hZ2VyLlB1c2hDb3B5U29sKHNvbE1vZGlmaWVycyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGluc3QgPSBpbnN0YW5jZXNbaV07CiAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdENsYXNzLkdldEN1cnJlbnRTb2woKS5TZXRTaW5nbGVQaWNrZWQoaW5zdCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc0luQ29udGFpbmVyKSBpbnN0LlNldFNpYmxpbmdzU2luZ2xlUGlja2VkKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvb3AuU2V0SW5kZXgoaSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHlpZWxkKiBjdXJyZW50RXZlbnQuRGVidWdSZXRyaWdnZXIob2xkRnJhbWUsIG5ld0ZyYW1lKTsKICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnRTaGVldE1hbmFnZXIuUG9wU29sKHNvbE1vZGlmaWVycykKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBzb2wuX1NldFNlbGVjdEFsbChmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHNvbEluc3RhbmNlcyA9IHNvbC5fR2V0T3duSW5zdGFuY2VzKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIEMzLmNsZWFyQXJyYXkoc29sSW5zdGFuY2VzKTsKICAgICAgICAgICAgICAgICAgICAgICAgc29sSW5zdGFuY2VzLnB1c2gobnVsbCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBpbnN0YW5jZXMubGVuZ3RoOyBpIDwgbGVuICYmICFsb29wLklzU3RvcHBlZCgpOyArK2kpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGluc3QgPSBpbnN0YW5jZXNbaV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb2xJbnN0YW5jZXNbMF0gPSBpbnN0OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzSW5Db250YWluZXIpIGluc3QuU2V0U2libGluZ3NTaW5nbGVQaWNrZWQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvb3AuU2V0SW5kZXgoaSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB5aWVsZCogY3VycmVudEV2ZW50LkRlYnVnUmV0cmlnZ2VyKG9sZEZyYW1lLCBuZXdGcmFtZSkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGV2ZW50U3RhY2suUG9wKCk7CiAgICAgICAgICAgICAgICBsb29wU3RhY2suUG9wKCk7CiAgICAgICAgICAgICAgICBDMy5jbGVhckFycmF5KGluc3RhbmNlcyk7CiAgICAgICAgICAgICAgICBmb3JFYWNoU3RhY2suUG9wKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICAgICAgfQogICAgICAgICAgICBfRm9yRWFjaE9yZGVyZWQob2JqZWN0Q2xhc3MsIG9yZGVyKSB7CiAgICAgICAgICAgICAgICBjb25zdCBldmVudFNoZWV0TWFuYWdlciA9IHRoaXMuX3J1bnRpbWUuR2V0RXZlbnRTaGVldE1hbmFnZXIoKTsKICAgICAgICAgICAgICAgIGNvbnN0IGV2ZW50U3RhY2sgPSBldmVudFNoZWV0TWFuYWdlci5HZXRFdmVudFN0YWNrKCk7CiAgICAgICAgICAgICAgICBjb25zdCBjbmQgPSBldmVudFNoZWV0TWFuYWdlci5HZXRDdXJyZW50Q29uZGl0aW9uKCk7CiAgICAgICAgICAgICAgICBjb25zdCBvbGRGcmFtZSA9IGV2ZW50U3RhY2suR2V0Q3VycmVudFN0YWNrRnJhbWUoKTsKICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRFdmVudCA9IG9sZEZyYW1lLkdldEN1cnJlbnRFdmVudCgpOwogICAgICAgICAgICAgICAgY29uc3Qgc29sTW9kaWZpZXJzID0gY3VycmVudEV2ZW50LkdldFNvbE1vZGlmaWVycygpOwogICAgICAgICAgICAgICAgY29uc3QgaXNTb2xNb2RpZmllckFmdGVyQ25kcyA9IG9sZEZyYW1lLklzU29sTW9kaWZpZXJBZnRlckNuZHMoKTsKICAgICAgICAgICAgICAgIGNvbnN0IG5ld0ZyYW1lID0gZXZlbnRTdGFjay5QdXNoKGN1cnJlbnRFdmVudCk7CiAgICAgICAgICAgICAgICBjb25zdCBsb29wU3RhY2sgPSBldmVudFNoZWV0TWFuYWdlci5HZXRMb29wU3RhY2soKTsKICAgICAgICAgICAgICAgIGNvbnN0IGxvb3AgPSBsb29wU3RhY2suUHVzaCgpOwogICAgICAgICAgICAgICAgY29uc3QgaXNJbkNvbnRhaW5lciA9IG9iamVjdENsYXNzLklzSW5Db250YWluZXIoKTsKICAgICAgICAgICAgICAgIGNvbnN0IHNvbCA9IG9iamVjdENsYXNzLkdldEN1cnJlbnRTb2woKTsKICAgICAgICAgICAgICAgIGNvbnN0IGluc3RhbmNlc0RhdGEgPSBmb3JFYWNoU3RhY2suUHVzaCgpOwogICAgICAgICAgICAgICAgQzMuY2xlYXJBcnJheShpbnN0YW5jZXNEYXRhKTsKICAgICAgICAgICAgICAgIGNvbnN0IGl0ZXJJbnN0YW5jZXMgPSBzb2wuR2V0SW5zdGFuY2VzKCk7CiAgICAgICAgICAgICAgICBsb29wLlNldEVuZChpdGVySW5zdGFuY2VzLmxlbmd0aCk7CiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gaXRlckluc3RhbmNlcy5sZW5ndGg7IGkgPCBsZW47ICsraSkgaW5zdGFuY2VzRGF0YS5wdXNoKFtpdGVySW5zdGFuY2VzW2ldLCBjbmQuUmVldmFsdWF0ZVBhcmFtZXRlcigxLCBpKV0pOwogICAgICAgICAgICAgICAgaW5zdGFuY2VzRGF0YS5zb3J0KEZvckVhY2hPcmRlcmVkX1NvcnRJbnN0YW5jZXMpOwogICAgICAgICAgICAgICAgaWYgKG9yZGVyID09PSAxKSBpbnN0YW5jZXNEYXRhLnJldmVyc2UoKTsKICAgICAgICAgICAgICAgIGlmIChpc1NvbE1vZGlmaWVyQWZ0ZXJDbmRzKQogICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBpbnN0YW5jZXNEYXRhLmxlbmd0aDsgaSA8CiAgICAgICAgICAgICAgICAgICAgICAgIGxlbiAmJiAhbG9vcC5Jc1N0b3BwZWQoKTsgKytpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50U2hlZXRNYW5hZ2VyLlB1c2hDb3B5U29sKHNvbE1vZGlmaWVycyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGluc3QgPSBpbnN0YW5jZXNEYXRhW2ldWzBdOwogICAgICAgICAgICAgICAgICAgICAgICBvYmplY3RDbGFzcy5HZXRDdXJyZW50U29sKCkuU2V0U2luZ2xlUGlja2VkKGluc3QpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNJbkNvbnRhaW5lcikgaW5zdC5TZXRTaWJsaW5nc1NpbmdsZVBpY2tlZCgpOwogICAgICAgICAgICAgICAgICAgICAgICBsb29wLlNldEluZGV4KGkpOwogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50RXZlbnQuUmV0cmlnZ2VyKG9sZEZyYW1lLCBuZXdGcmFtZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50U2hlZXRNYW5hZ2VyLlBvcFNvbChzb2xNb2RpZmllcnMpCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgc29sLl9TZXRTZWxlY3RBbGwoZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzb2xJbnN0YW5jZXMgPSBzb2wuX0dldE93bkluc3RhbmNlcygpOwogICAgICAgICAgICAgICAgICAgICAgICBDMy5jbGVhckFycmF5KHNvbEluc3RhbmNlcyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHNvbEluc3RhbmNlcy5wdXNoKG51bGwpOwogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gaW5zdGFuY2VzRGF0YS5sZW5ndGg7IGkgPCBsZW4gJiYgIWxvb3AuSXNTdG9wcGVkKCk7ICsraSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5zdCA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5zdGFuY2VzRGF0YVtpXVswXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvbEluc3RhbmNlc1swXSA9IGluc3Q7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNJbkNvbnRhaW5lcikgaW5zdC5TZXRTaWJsaW5nc1NpbmdsZVBpY2tlZCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9vcC5TZXRJbmRleChpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRFdmVudC5SZXRyaWdnZXIob2xkRnJhbWUsIG5ld0ZyYW1lKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZXZlbnRTdGFjay5Qb3AoKTsKICAgICAgICAgICAgICAgIGxvb3BTdGFjay5Qb3AoKTsKICAgICAgICAgICAgICAgIEMzLmNsZWFyQXJyYXkoaW5zdGFuY2VzRGF0YSk7CiAgICAgICAgICAgICAgICBmb3JFYWNoU3RhY2suUG9wKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICAgICAgfSogX0RlYnVnRm9yRWFjaE9yZGVyZWQob2JqZWN0Q2xhc3MsIG9yZGVyKSB7CiAgICAgICAgICAgICAgICBjb25zdCBldmVudFNoZWV0TWFuYWdlciA9IHRoaXMuX3J1bnRpbWUuR2V0RXZlbnRTaGVldE1hbmFnZXIoKTsKICAgICAgICAgICAgICAgIGNvbnN0IGV2ZW50U3RhY2sgPSBldmVudFNoZWV0TWFuYWdlci5HZXRFdmVudFN0YWNrKCk7CiAgICAgICAgICAgICAgICBjb25zdCBjbmQgPSBldmVudFNoZWV0TWFuYWdlci5HZXRDdXJyZW50Q29uZGl0aW9uKCk7CiAgICAgICAgICAgICAgICBjb25zdCBvbGRGcmFtZSA9IGV2ZW50U3RhY2suR2V0Q3VycmVudFN0YWNrRnJhbWUoKTsKICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRFdmVudCA9CiAgICAgICAgICAgICAgICAgICAgb2xkRnJhbWUuR2V0Q3VycmVudEV2ZW50KCk7CiAgICAgICAgICAgICAgICBjb25zdCBzb2xNb2RpZmllcnMgPSBjdXJyZW50RXZlbnQuR2V0U29sTW9kaWZpZXJzKCk7CiAgICAgICAgICAgICAgICBjb25zdCBpc1NvbE1vZGlmaWVyQWZ0ZXJDbmRzID0gb2xkRnJhbWUuSXNTb2xNb2RpZmllckFmdGVyQ25kcygpOwogICAgICAgICAgICAgICAgY29uc3QgbmV3RnJhbWUgPSBldmVudFN0YWNrLlB1c2goY3VycmVudEV2ZW50KTsKICAgICAgICAgICAgICAgIGNvbnN0IGxvb3BTdGFjayA9IGV2ZW50U2hlZXRNYW5hZ2VyLkdldExvb3BTdGFjaygpOwogICAgICAgICAgICAgICAgY29uc3QgbG9vcCA9IGxvb3BTdGFjay5QdXNoKCk7CiAgICAgICAgICAgICAgICBjb25zdCBpc0luQ29udGFpbmVyID0gb2JqZWN0Q2xhc3MuSXNJbkNvbnRhaW5lcigpOwogICAgICAgICAgICAgICAgY29uc3Qgc29sID0gb2JqZWN0Q2xhc3MuR2V0Q3VycmVudFNvbCgpOwogICAgICAgICAgICAgICAgY29uc3QgaW5zdGFuY2VzRGF0YSA9IGZvckVhY2hTdGFjay5QdXNoKCk7CiAgICAgICAgICAgICAgICBDMy5jbGVhckFycmF5KGluc3RhbmNlc0RhdGEpOwogICAgICAgICAgICAgICAgY29uc3QgaXRlckluc3RhbmNlcyA9IHNvbC5HZXRJbnN0YW5jZXMoKTsKICAgICAgICAgICAgICAgIGxvb3AuU2V0RW5kKGl0ZXJJbnN0YW5jZXMubGVuZ3RoKTsKICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLAogICAgICAgICAgICAgICAgICAgICAgICBsZW4gPSBpdGVySW5zdGFuY2VzLmxlbmd0aDsgaSA8IGxlbjsgKytpKSBpbnN0YW5jZXNEYXRhLnB1c2goW2l0ZXJJbnN0YW5jZXNbaV0sIGNuZC5SZWV2YWx1YXRlUGFyYW1ldGVyKDEsIGkpXSk7CiAgICAgICAgICAgICAgICBpbnN0YW5jZXNEYXRhLnNvcnQoRm9yRWFjaE9yZGVyZWRfU29ydEluc3RhbmNlcyk7CiAgICAgICAgICAgICAgICBpZiAob3JkZXIgPT09IDEpIGluc3RhbmNlc0RhdGEucmV2ZXJzZSgpOwogICAgICAgICAgICAgICAgaWYgKGlzU29sTW9kaWZpZXJBZnRlckNuZHMpCiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IGluc3RhbmNlc0RhdGEubGVuZ3RoOyBpIDwgbGVuICYmICFsb29wLklzU3RvcHBlZCgpOyArK2kpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnRTaGVldE1hbmFnZXIuUHVzaENvcHlTb2woc29sTW9kaWZpZXJzKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5zdCA9IGluc3RhbmNlc0RhdGFbaV1bMF07CiAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdENsYXNzLkdldEN1cnJlbnRTb2woKS5TZXRTaW5nbGVQaWNrZWQoaW5zdCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc0luQ29udGFpbmVyKSBpbnN0LlNldFNpYmxpbmdzU2luZ2xlUGlja2VkKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvb3AuU2V0SW5kZXgoaSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHlpZWxkKiBjdXJyZW50RXZlbnQuRGVidWdSZXRyaWdnZXIob2xkRnJhbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdGcmFtZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50U2hlZXRNYW5hZ2VyLlBvcFNvbChzb2xNb2RpZmllcnMpCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgc29sLl9TZXRTZWxlY3RBbGwoZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzb2xJbnN0YW5jZXMgPSBzb2wuX0dldE93bkluc3RhbmNlcygpOwogICAgICAgICAgICAgICAgICAgICAgICBDMy5jbGVhckFycmF5KHNvbEluc3RhbmNlcyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHNvbEluc3RhbmNlcy5wdXNoKG51bGwpOwogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gaW5zdGFuY2VzRGF0YS5sZW5ndGg7IGkgPCBsZW4gJiYgIWxvb3AuSXNTdG9wcGVkKCk7ICsraSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5zdCA9IGluc3RhbmNlc0RhdGFbaV1bMF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb2xJbnN0YW5jZXNbMF0gPSBpbnN0OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzSW5Db250YWluZXIpIGluc3QuU2V0U2libGluZ3NTaW5nbGVQaWNrZWQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvb3AuU2V0SW5kZXgoaSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB5aWVsZCogY3VycmVudEV2ZW50LkRlYnVnUmV0cmlnZ2VyKG9sZEZyYW1lLCBuZXdGcmFtZSkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGV2ZW50U3RhY2suUG9wKCk7CiAgICAgICAgICAgICAgICBsb29wU3RhY2suUG9wKCk7CiAgICAgICAgICAgICAgICBDMy5jbGVhckFycmF5KGluc3RhbmNlc0RhdGEpOwogICAgICAgICAgICAgICAgZm9yRWFjaFN0YWNrLlBvcCgpOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX0dldEZ1bmN0aW9uTWFwKG5hbWUsCiAgICAgICAgICAgICAgICBjcmVhdGVJZk1pc3NpbmcpIHsKICAgICAgICAgICAgICAgIGxldCByZXQgPSB0aGlzLl9mdW5jdGlvbk1hcHMuZ2V0KG5hbWUpOwogICAgICAgICAgICAgICAgaWYgKHJldCkgcmV0dXJuIHJldDsKICAgICAgICAgICAgICAgIGlmICghY3JlYXRlSWZNaXNzaW5nKSByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICAgIHJldCA9IHsKICAgICAgICAgICAgICAgICAgICBkZWZhdWx0RnVuYzogbnVsbCwKICAgICAgICAgICAgICAgICAgICBzdHJNYXA6IG5ldyBNYXAKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB0aGlzLl9mdW5jdGlvbk1hcHMuc2V0KG5hbWUsIHJldCk7CiAgICAgICAgICAgICAgICByZXR1cm4gcmV0CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX0RvQ2FsbE1hcHBlZEZ1bmN0aW9uKGV2ZW50U2hlZXRNYW5hZ2VyLCBmdW5jdGlvbkJsb2NrLCBwYXJhbVJlc3VsdHMsIGhhc0FueVNvbE1vZGlmaWVycywgc29sTW9kaWZpZXJzKSB7CiAgICAgICAgICAgICAgICBmdW5jdGlvbkJsb2NrLkdldEV2ZW50QmxvY2soKS5SdW5Bc01hcHBlZEZ1bmN0aW9uQ2FsbChwYXJhbVJlc3VsdHMsIGZ1bmN0aW9uQmxvY2suSXNDb3B5UGlja2VkKCkpOwogICAgICAgICAgICAgICAgaWYgKGhhc0FueVNvbE1vZGlmaWVycykgZXZlbnRTaGVldE1hbmFnZXIuUG9wU29sKHNvbE1vZGlmaWVycykKICAgICAgICAgICAgfSogX0RlYnVnRG9DYWxsTWFwcGVkRnVuY3Rpb24oZXZlbnRTaGVldE1hbmFnZXIsIGZ1bmN0aW9uQmxvY2ssCiAgICAgICAgICAgICAgICBwYXJhbVJlc3VsdHMsIGhhc0FueVNvbE1vZGlmaWVycywgc29sTW9kaWZpZXJzKSB7CiAgICAgICAgICAgICAgICB5aWVsZCogZnVuY3Rpb25CbG9jay5HZXRFdmVudEJsb2NrKCkuRGVidWdSdW5Bc01hcHBlZEZ1bmN0aW9uQ2FsbChwYXJhbVJlc3VsdHMsIGZ1bmN0aW9uQmxvY2suSXNDb3B5UGlja2VkKCkpOwogICAgICAgICAgICAgICAgaWYgKGhhc0FueVNvbE1vZGlmaWVycykgZXZlbnRTaGVldE1hbmFnZXIuUG9wU29sKHNvbE1vZGlmaWVycykKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gewogICAgICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgICAgICBDMy5QbHVnaW5zLlN5c3RlbS5UeXBlID0gY2xhc3MgU3lzdGVtVHlwZSBleHRlbmRzIEMzLkRlZmVuZGVkQmFzZSB7CiAgICAgICAgICAgIGNvbnN0cnVjdG9yKG9iamVjdENsYXNzKSB7CiAgICAgICAgICAgICAgICBzdXBlcigpOwogICAgICAgICAgICAgICAgdGhpcy5fb2JqZWN0Q2xhc3MgPSBvYmplY3RDbGFzczsKICAgICAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUgPSBvYmplY3RDbGFzcy5HZXRSdW50aW1lKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9wbHVnaW4gPSBvYmplY3RDbGFzcy5HZXRQbHVnaW4oKQogICAgICAgICAgICB9CiAgICAgICAgICAgIE9uQ3JlYXRlKCkge30KICAgICAgICAgICAgUmVsZWFzZSgpIHsKICAgICAgICAgICAgICAgIHRoaXMuX29iamVjdENsYXNzID0gbnVsbDsKICAgICAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUgPSBudWxsOwogICAgICAgICAgICAgICAgdGhpcy5fcGx1Z2luID0gbnVsbAogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSB7CiAgICAgICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgICAgIEMzLlBsdWdpbnMuU3lzdGVtLkluc3RhbmNlID0gY2xhc3MgU3lzdGVtSW5zdGFuY2UgZXh0ZW5kcyBDMy5EZWZlbmRlZEJhc2UgewogICAgICAgICAgICBjb25zdHJ1Y3RvcihpbnN0LCBwcm9wZXJ0aWVzKSB7CiAgICAgICAgICAgICAgICBzdXBlcigpOwogICAgICAgICAgICAgICAgdGhpcy5faW5zdCA9IGluc3Q7CiAgICAgICAgICAgICAgICB0aGlzLl9vYmplY3RDbGFzcyA9IHRoaXMuX2luc3QuR2V0T2JqZWN0Q2xhc3MoKTsKICAgICAgICAgICAgICAgIHRoaXMuX3Nka1R5cGUgPSB0aGlzLl9vYmplY3RDbGFzcy5HZXRTZGtUeXBlKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9ydW50aW1lID0gdGhpcy5faW5zdC5HZXRSdW50aW1lKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBSZWxlYXNlKCkgewogICAgICAgICAgICAgICAgdGhpcy5faW5zdCA9IG51bGw7CiAgICAgICAgICAgICAgICB0aGlzLl9vYmplY3RDbGFzcyA9IG51bGw7CiAgICAgICAgICAgICAgICB0aGlzLl9zZGtUeXBlID0gbnVsbDsKICAgICAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUgPSBudWxsCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IHsKICAgICAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICAgICAgY29uc3QgdG1wUGlja0FycmF5ID0gW107CiAgICAgICAgQzMuUGx1Z2lucy5TeXN0ZW0uQ25kcyA9IHsKICAgICAgICAgICAgRXZlcnlUaWNrKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgT25MYXlvdXRTdGFydCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIE9uTGF5b3V0RW5kKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgT25TdXNwZW5kKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgT25SZXN1bWUoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgICAgICB9LAogICAgICAgICAgICBJc1N1c3BlbmRlZCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lLklzU3VzcGVuZGVkKCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgRWxzZSgpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGZyYW1lID0gdGhpcy5fcnVudGltZS5HZXRDdXJyZW50RXZlbnRTdGFja0ZyYW1lKCk7CiAgICAgICAgICAgICAgICBpZiAoZnJhbWUuR2V0RWxzZUJyYW5jaFJhbigpKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICBlbHNlIHJldHVybiAhZnJhbWUuR2V0TGFzdEV2ZW50VHJ1ZSgpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFRyaWdnZXJPbmNlKCkgewogICAgICAgICAgICAgICAgY29uc3QgY25kID0gdGhpcy5fcnVudGltZS5HZXRDdXJyZW50Q29uZGl0aW9uKCk7CiAgICAgICAgICAgICAgICBjb25zdCBjbmRTYXZlZERhdGEgPSBjbmQuR2V0U2F2ZWREYXRhTWFwKCk7CiAgICAgICAgICAgICAgICBsZXQgbGFzdFRpY2sgPSBjbmRTYXZlZERhdGEuZ2V0KCJUcmlnZ2VyT25jZV9sYXN0VGljayIpOwogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBsYXN0VGljayA9PT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgICAgICAgICAgICBsYXN0VGljayA9IC0xOwogICAgICAgICAgICAgICAgICAgIGNuZFNhdmVkRGF0YS5zZXQoIlRyaWdnZXJPbmNlX2xhc3RUaWNrIiwgLTEpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjb25zdCBjdXJUaWNrID0gdGhpcy5fcnVudGltZS5HZXRUaWNrQ291bnQoKTsKICAgICAgICAgICAgICAgIGNuZFNhdmVkRGF0YS5zZXQoIlRyaWdnZXJPbmNlX2xhc3RUaWNrIiwgY3VyVGljayk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcnVudGltZS5Jc0xheW91dEZpcnN0VGljaygpIHx8IGxhc3RUaWNrICE9PSBjdXJUaWNrIC0gMQogICAgICAgICAgICB9LAogICAgICAgICAgICBFdmVyeShzZWNvbmRzKSB7CiAgICAgICAgICAgICAgICBjb25zdCBjbmQgPSB0aGlzLl9ydW50aW1lLkdldEN1cnJlbnRDb25kaXRpb24oKTsKICAgICAgICAgICAgICAgIGNvbnN0IGNuZFNhdmVkRGF0YSA9IGNuZC5HZXRTYXZlZERhdGFNYXAoKTsKICAgICAgICAgICAgICAgIGNvbnN0IGxhc3RUaW1lID0gY25kU2F2ZWREYXRhLmdldCgiRXZlcnlfbGFzdFRpbWUiKSB8fCAwOwogICAgICAgICAgICAgICAgY29uc3QgY3VyVGltZSA9IHRoaXMuX3J1bnRpbWUuR2V0R2FtZVRpbWUoKTsKICAgICAgICAgICAgICAgIGlmICghY25kU2F2ZWREYXRhLmhhcygiRXZlcnlfc2Vjb25kcyIpKSBjbmRTYXZlZERhdGEuc2V0KCJFdmVyeV9zZWNvbmRzIiwKICAgICAgICAgICAgICAgICAgICBzZWNvbmRzKTsKICAgICAgICAgICAgICAgIGNvbnN0IHRoaXNTZWNvbmRzID0gY25kU2F2ZWREYXRhLmdldCgiRXZlcnlfc2Vjb25kcyIpOwogICAgICAgICAgICAgICAgaWYgKGN1clRpbWUgPj0gbGFzdFRpbWUgKyB0aGlzU2Vjb25kcykgewogICAgICAgICAgICAgICAgICAgIGNuZFNhdmVkRGF0YS5zZXQoIkV2ZXJ5X2xhc3RUaW1lIiwgbGFzdFRpbWUgKyB0aGlzU2Vjb25kcyk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGN1clRpbWUgPj0gY25kU2F2ZWREYXRhLmdldCgiRXZlcnlfbGFzdFRpbWUiKSArIC4wNCkgY25kU2F2ZWREYXRhLnNldCgiRXZlcnlfbGFzdFRpbWUiLCBjdXJUaW1lKTsKICAgICAgICAgICAgICAgICAgICBjbmRTYXZlZERhdGEuc2V0KCJFdmVyeV9zZWNvbmRzIiwgc2Vjb25kcyk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoY3VyVGltZSA8IGxhc3RUaW1lIC0gLjEpIGNuZFNhdmVkRGF0YS5zZXQoIkV2ZXJ5X2xhc3RUaW1lIiwgY3VyVGltZSk7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICAgICAgfSwKICAgICAgICAgICAgSXNHcm91cEFjdGl2ZShncm91cE5hbWUpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGV2ZW50R3JvdXAgPSB0aGlzLl9ydW50aW1lLkdldEV2ZW50U2hlZXRNYW5hZ2VyKCkuR2V0RXZlbnRHcm91cEJ5TmFtZShncm91cE5hbWUpOwogICAgICAgICAgICAgICAgcmV0dXJuIGV2ZW50R3JvdXAgJiYKICAgICAgICAgICAgICAgICAgICBldmVudEdyb3VwLklzR3JvdXBBY3RpdmUoKQogICAgICAgICAgICB9LAogICAgICAgICAgICBJc1ByZXZpZXcoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcnVudGltZS5Jc1ByZXZpZXcoKQogICAgICAgICAgICB9LAogICAgICAgICAgICBJc01vYmlsZSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBDMy5QbGF0Zm9ybS5Jc01vYmlsZQogICAgICAgICAgICB9LAogICAgICAgICAgICBPbkxvYWRGaW5pc2hlZCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIE9uQ2FudmFzU25hcHNob3QoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgICAgICB9LAogICAgICAgICAgICBFZmZlY3RzU3VwcG9ydGVkKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgT25TYXZlQ29tcGxldGUoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgICAgICB9LAogICAgICAgICAgICBPblNhdmVGYWlsZWQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgICAgICB9LAogICAgICAgICAgICBPbkxvYWRDb21wbGV0ZSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIE9uTG9hZEZhaWxlZCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIE9iamVjdFVJREV4aXN0cyh1aWQpIHsKICAgICAgICAgICAgICAgIHJldHVybiAhIXRoaXMuX3J1bnRpbWUuR2V0SW5zdGFuY2VCeVVJRCh1aWQpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIElzT25QbGF0Zm9ybShwKSB7CiAgICAgICAgICAgICAgICBzd2l0Y2ggKHApIHsKICAgICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBDMy5QbGF0Zm9ybS5Db250ZXh0ID09PSAiYnJvd3NlciI7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gQzMuUGxhdGZvcm0uT1MgPT09ICJpT1MiOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEMzLlBsYXRmb3JtLk9TID09PQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIkFuZHJvaWQiOwogICAgICAgICAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEMzLlBsYXRmb3JtLkNvbnRleHQgPT09ICJjb3Jkb3ZhIjsKICAgICAgICAgICAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lLkdldEV4cG9ydFR5cGUoKSA9PT0gInNjaXJyYS1hcmNhZGUiOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBDMy5QbGF0Zm9ybS5Db250ZXh0ID09PSAibndqcyI7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMzoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUuR2V0RXhwb3J0VHlwZSgpID09PSAid2luZG93cy11d3AiOwogICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBSZWdleFRlc3Qoc3RyLCByZWdleCwgZmxhZ3MpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGNhY2hlUmVnZXggPSB0aGlzLkdldFJlZ2V4KHJlZ2V4LCBmbGFncyk7CiAgICAgICAgICAgICAgICByZXR1cm4gY2FjaGVSZWdleC50ZXN0KHN0cikKICAgICAgICAgICAgfSwKICAgICAgICAgICAgQ29tcGFyZSh4LCBjbXAsIHkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBDMy5jb21wYXJlKHgsIGNtcCwgeSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgQ29tcGFyZUJldHdlZW4oeCwgYSwgYikgewogICAgICAgICAgICAgICAgcmV0dXJuIHggPj0gYSAmJiB4IDw9IGIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgQ29tcGFyZVZhcihldiwgY21wLCB2YWwpIHsKICAgICAgICAgICAgICAgIHJldHVybiBDMy5jb21wYXJlKGV2LkdldFZhbHVlKCksIGNtcCwgdmFsKQogICAgICAgICAgICB9LAogICAgICAgICAgICBDb21wYXJlQm9vbFZhcihldikgewogICAgICAgICAgICAgICAgcmV0dXJuICEhZXYuR2V0VmFsdWUoKQogICAgICAgICAgICB9LAogICAgICAgICAgICBDb21wYXJlVGltZShjbXAsIHQpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGdhbWVUaW1lID0gdGhpcy5fcnVudGltZS5HZXRHYW1lVGltZSgpOwogICAgICAgICAgICAgICAgaWYgKGNtcCA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGNuZCA9IHRoaXMuX3J1bnRpbWUuR2V0Q3VycmVudENvbmRpdGlvbigpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGNuZFNhdmVkRGF0YSA9IGNuZC5HZXRTYXZlZERhdGFNYXAoKTsKICAgICAgICAgICAgICAgICAgICBpZiAoIWNuZFNhdmVkRGF0YS5nZXQoIkNvbXBhcmVUaW1lX2V4ZWN1dGVkIikpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChnYW1lVGltZSA+PSB0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbmRTYXZlZERhdGEuc2V0KCJDb21wYXJlVGltZV9leGVjdXRlZCIsIHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZQogICAgICAgICAgICAgICAgfSBlbHNlIHJldHVybiBDMy5jb21wYXJlKGdhbWVUaW1lLCBjbXAsIHQpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIElzTmFOKG4pIHsKICAgICAgICAgICAgICAgIHJldHVybiBpc05hTihuKQogICAgICAgICAgICB9LAogICAgICAgICAgICBBbmdsZVdpdGhpbihhMSwgd2l0aGluLCBhMikgewogICAgICAgICAgICAgICAgcmV0dXJuIEMzLmFuZ2xlRGlmZihDMy50b1JhZGlhbnMoYTEpLCBDMy50b1JhZGlhbnMoYTIpKSA8PSBDMy50b1JhZGlhbnMod2l0aGluKQogICAgICAgICAgICB9LAogICAgICAgICAgICBJc0Nsb2Nrd2lzZUZyb20oYTEsIGEyKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gQzMuYW5nbGVDbG9ja3dpc2UoQzMudG9SYWRpYW5zKGExKSwKICAgICAgICAgICAgICAgICAgICBDMy50b1JhZGlhbnMoYTIpKQogICAgICAgICAgICB9LAogICAgICAgICAgICBJc0JldHdlZW5BbmdsZXMoYSwgbGEsIHVhKSB7CiAgICAgICAgICAgICAgICBsZXQgYW5nbGUgPSBDMy50b1JhZGlhbnMoYSk7CiAgICAgICAgICAgICAgICBsZXQgbG93ZXIgPSBDMy50b1JhZGlhbnMobGEpOwogICAgICAgICAgICAgICAgbGV0IHVwcGVyID0gQzMudG9SYWRpYW5zKHVhKTsKICAgICAgICAgICAgICAgIGxldCBvYnR1c2UgPSAhQzMuYW5nbGVDbG9ja3dpc2UodXBwZXIsIGxvd2VyKTsKICAgICAgICAgICAgICAgIGlmIChvYnR1c2UpIHJldHVybiAhKCFDMy5hbmdsZUNsb2Nrd2lzZShhbmdsZSwgbG93ZXIpICYmIEMzLmFuZ2xlQ2xvY2t3aXNlKGFuZ2xlLCB1cHBlcikpOwogICAgICAgICAgICAgICAgZWxzZSByZXR1cm4gQzMuYW5nbGVDbG9ja3dpc2UoYW5nbGUsIGxvd2VyKSAmJiAhQzMuYW5nbGVDbG9ja3dpc2UoYW5nbGUsIHVwcGVyKQogICAgICAgICAgICB9LAogICAgICAgICAgICBJc1ZhbHVlVHlwZSh2LCB0KSB7CiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHYgPT09ICJudW1iZXIiKSByZXR1cm4gdCA9PT0gMDsKICAgICAgICAgICAgICAgIGVsc2UgcmV0dXJuIHQgPT09IDEKICAgICAgICAgICAgfSwKICAgICAgICAgICAgRXZhbHVhdGVFeHByZXNzaW9uKHYpIHsKICAgICAgICAgICAgICAgIHJldHVybiAhIXYKICAgICAgICAgICAgfSwKICAgICAgICAgICAgT25TaWduYWwodGFnKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGFnLnRvTG93ZXJDYXNlKCkgPT09IHRoaXMuX3NpZ25hbFRhZ3MuYXQoLTEpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFBpY2tCeUNvbXBhcmlzb24ob2JqZWN0Q2xhc3MsCiAgICAgICAgICAgICAgICBleHAsIGNtcCwgdmFsKSB7CiAgICAgICAgICAgICAgICBpZiAoIW9iamVjdENsYXNzKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICBjb25zdCBmb3JFYWNoU3RhY2sgPSB0aGlzLl9HZXRGb3JFYWNoU3RhY2soKTsKICAgICAgICAgICAgICAgIGNvbnN0IHRlbXBJbnN0YW5jZXMgPSBmb3JFYWNoU3RhY2suUHVzaCgpOwogICAgICAgICAgICAgICAgY29uc3Qgc29sID0gb2JqZWN0Q2xhc3MuR2V0Q3VycmVudFNvbCgpOwogICAgICAgICAgICAgICAgQzMuc2hhbGxvd0Fzc2lnbkFycmF5KHRlbXBJbnN0YW5jZXMsIHNvbC5HZXRJbnN0YW5jZXMoKSk7CiAgICAgICAgICAgICAgICBpZiAoc29sLklzU2VsZWN0QWxsKCkpIEMzLmNsZWFyQXJyYXkoc29sLl9HZXRPd25FbHNlSW5zdGFuY2VzKCkpOwogICAgICAgICAgICAgICAgY29uc3QgY25kID0gdGhpcy5fcnVudGltZS5HZXRDdXJyZW50Q29uZGl0aW9uKCk7CiAgICAgICAgICAgICAgICBsZXQgayA9IDA7CiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gdGVtcEluc3RhbmNlcy5sZW5ndGg7IGkgPCBsZW47ICsraSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGluc3QgPSB0ZW1wSW5zdGFuY2VzW2ldOwogICAgICAgICAgICAgICAgICAgIHRlbXBJbnN0YW5jZXNba10gPSBpbnN0OwogICAgICAgICAgICAgICAgICAgIGV4cCA9IGNuZC5SZWV2YWx1YXRlUGFyYW1ldGVyKDEsIGkpOwogICAgICAgICAgICAgICAgICAgIHZhbCA9IGNuZC5SZWV2YWx1YXRlUGFyYW1ldGVyKDMsIGkpOwogICAgICAgICAgICAgICAgICAgIGlmIChDMy5jb21wYXJlKGV4cCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNtcCwgdmFsKSkgKytrOwogICAgICAgICAgICAgICAgICAgIGVsc2Ugc29sLl9QdXNoRWxzZUluc3RhbmNlKGluc3QpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBDMy50cnVuY2F0ZUFycmF5KHRlbXBJbnN0YW5jZXMsIGspOwogICAgICAgICAgICAgICAgc29sLlNldEFycmF5UGlja2VkKHRlbXBJbnN0YW5jZXMpOwogICAgICAgICAgICAgICAgY29uc3QgcmV0ID0gISF0ZW1wSW5zdGFuY2VzLmxlbmd0aDsKICAgICAgICAgICAgICAgIEMzLmNsZWFyQXJyYXkodGVtcEluc3RhbmNlcyk7CiAgICAgICAgICAgICAgICBmb3JFYWNoU3RhY2suUG9wKCk7CiAgICAgICAgICAgICAgICBvYmplY3RDbGFzcy5BcHBseVNvbFRvQ29udGFpbmVyKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gcmV0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFBpY2tCeUV2YWx1YXRlKG9iamVjdENsYXNzLCBleHApIHsKICAgICAgICAgICAgICAgIGlmICghb2JqZWN0Q2xhc3MpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIGNvbnN0IGZvckVhY2hTdGFjayA9IHRoaXMuX0dldEZvckVhY2hTdGFjaygpOwogICAgICAgICAgICAgICAgY29uc3QgdGVtcEluc3RhbmNlcyA9IGZvckVhY2hTdGFjay5QdXNoKCk7CiAgICAgICAgICAgICAgICBjb25zdCBzb2wgPSBvYmplY3RDbGFzcy5HZXRDdXJyZW50U29sKCk7CiAgICAgICAgICAgICAgICBDMy5zaGFsbG93QXNzaWduQXJyYXkodGVtcEluc3RhbmNlcywgc29sLkdldEluc3RhbmNlcygpKTsKICAgICAgICAgICAgICAgIGlmIChzb2wuSXNTZWxlY3RBbGwoKSkgQzMuY2xlYXJBcnJheShzb2wuX0dldE93bkVsc2VJbnN0YW5jZXMoKSk7CiAgICAgICAgICAgICAgICBjb25zdCBjbmQgPSB0aGlzLl9ydW50aW1lLkdldEN1cnJlbnRDb25kaXRpb24oKTsKICAgICAgICAgICAgICAgIGxldCBrID0gMDsKICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSB0ZW1wSW5zdGFuY2VzLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5zdCA9IHRlbXBJbnN0YW5jZXNbaV07CiAgICAgICAgICAgICAgICAgICAgdGVtcEluc3RhbmNlc1trXSA9IGluc3Q7CiAgICAgICAgICAgICAgICAgICAgZXhwID0gY25kLlJlZXZhbHVhdGVQYXJhbWV0ZXIoMSwgaSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGV4cCkgKytrOwogICAgICAgICAgICAgICAgICAgIGVsc2Ugc29sLl9QdXNoRWxzZUluc3RhbmNlKGluc3QpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBDMy50cnVuY2F0ZUFycmF5KHRlbXBJbnN0YW5jZXMsIGspOwogICAgICAgICAgICAgICAgc29sLlNldEFycmF5UGlja2VkKHRlbXBJbnN0YW5jZXMpOwogICAgICAgICAgICAgICAgY29uc3QgcmV0ID0gISF0ZW1wSW5zdGFuY2VzLmxlbmd0aDsKICAgICAgICAgICAgICAgIEMzLmNsZWFyQXJyYXkodGVtcEluc3RhbmNlcyk7CiAgICAgICAgICAgICAgICBmb3JFYWNoU3RhY2suUG9wKCk7CiAgICAgICAgICAgICAgICBvYmplY3RDbGFzcy5BcHBseVNvbFRvQ29udGFpbmVyKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gcmV0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFBpY2tOdGgob2JqZWN0Q2xhc3MsIGluZGV4KSB7CiAgICAgICAgICAgICAgICBpZiAoIW9iamVjdENsYXNzKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICBjb25zdCBzb2wgPSBvYmplY3RDbGFzcy5HZXRDdXJyZW50U29sKCk7CiAgICAgICAgICAgICAgICBjb25zdCBpbnN0YW5jZXMgPSBzb2wuR2V0SW5zdGFuY2VzKCk7CiAgICAgICAgICAgICAgICBpbmRleCA9IE1hdGguZmxvb3IoaW5kZXgpOwogICAgICAgICAgICAgICAgaWYgKGluZGV4ID49IGluc3RhbmNlcy5sZW5ndGgpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIGNvbnN0IGluc3QgPSBpbnN0YW5jZXNbaW5kZXhdOwogICAgICAgICAgICAgICAgc29sLlBpY2tPbmUoaW5zdCk7CiAgICAgICAgICAgICAgICBvYmplY3RDbGFzcy5BcHBseVNvbFRvQ29udGFpbmVyKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgICAgICB9LAogICAgICAgICAgICBQaWNrUmFuZG9tKG9iamVjdENsYXNzKSB7CiAgICAgICAgICAgICAgICBpZiAoIW9iamVjdENsYXNzKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICBjb25zdCBzb2wgPSBvYmplY3RDbGFzcy5HZXRDdXJyZW50U29sKCk7CiAgICAgICAgICAgICAgICBjb25zdCBpbnN0YW5jZXMgPSBzb2wuR2V0SW5zdGFuY2VzKCk7CiAgICAgICAgICAgICAgICBjb25zdCBpbmRleCA9IE1hdGguZmxvb3IodGhpcy5fcnVudGltZS5SYW5kb20oKSAqIGluc3RhbmNlcy5sZW5ndGgpOwogICAgICAgICAgICAgICAgaWYgKGluZGV4ID49IGluc3RhbmNlcy5sZW5ndGgpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIGNvbnN0IGluc3QgPSBpbnN0YW5jZXNbaW5kZXhdOwogICAgICAgICAgICAgICAgc29sLlBpY2tPbmUoaW5zdCk7CiAgICAgICAgICAgICAgICBvYmplY3RDbGFzcy5BcHBseVNvbFRvQ29udGFpbmVyKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgICAgICB9LAogICAgICAgICAgICBQaWNrQWxsKG9iamVjdENsYXNzKSB7CiAgICAgICAgICAgICAgICBpZiAoIW9iamVjdENsYXNzKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICBpZiAoIW9iamVjdENsYXNzLkdldEluc3RhbmNlQ291bnQoKSkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgY29uc3Qgc29sID0gb2JqZWN0Q2xhc3MuR2V0Q3VycmVudFNvbCgpOwogICAgICAgICAgICAgICAgc29sLl9TZXRTZWxlY3RBbGwodHJ1ZSk7CiAgICAgICAgICAgICAgICBvYmplY3RDbGFzcy5BcHBseVNvbFRvQ29udGFpbmVyKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgICAgICB9LAogICAgICAgICAgICBQaWNrT3ZlcmxhcHBpbmdQb2ludChvYmplY3RDbGFzcywgeCwgeSkgewogICAgICAgICAgICAgICAgaWYgKCFvYmplY3RDbGFzcykgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgY29uc3Qgc29sID0gb2JqZWN0Q2xhc3MuR2V0Q3VycmVudFNvbCgpOwogICAgICAgICAgICAgICAgY29uc3QgaW5zdGFuY2VzID0gc29sLkdldEluc3RhbmNlcygpOwogICAgICAgICAgICAgICAgY29uc3QgY3VycmVudEV2ZW50ID0gdGhpcy5fcnVudGltZS5HZXRDdXJyZW50RXZlbnQoKTsKICAgICAgICAgICAgICAgIGNvbnN0IGlzT3JCbG9jayA9IGN1cnJlbnRFdmVudC5Jc09yQmxvY2soKTsKICAgICAgICAgICAgICAgIGNvbnN0IGlzSW52ZXJ0ZWQgPSB0aGlzLl9ydW50aW1lLkdldEN1cnJlbnRDb25kaXRpb24oKS5Jc0ludmVydGVkKCk7CiAgICAgICAgICAgICAgICBpZiAoc29sLklzU2VsZWN0QWxsKCkpIHsKICAgICAgICAgICAgICAgICAgICBDMy5zaGFsbG93QXNzaWduQXJyYXkodG1wUGlja0FycmF5LCBpbnN0YW5jZXMpOwogICAgICAgICAgICAgICAgICAgIHNvbC5DbGVhckFycmF5cygpOwogICAgICAgICAgICAgICAgICAgIHNvbC5fU2V0U2VsZWN0QWxsKGZhbHNlKQogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpc09yQmxvY2spIHsKICAgICAgICAgICAgICAgICAgICBDMy5zaGFsbG93QXNzaWduQXJyYXkodG1wUGlja0FycmF5LCBzb2wuX0dldE93bkVsc2VJbnN0YW5jZXMoKSk7CiAgICAgICAgICAgICAgICAgICAgQzMuY2xlYXJBcnJheShzb2wuX0dldE93bkVsc2VJbnN0YW5jZXMoKSkKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgQzMuc2hhbGxvd0Fzc2lnbkFycmF5KHRtcFBpY2tBcnJheSwgc29sLl9HZXRPd25JbnN0YW5jZXMoKSk7CiAgICAgICAgICAgICAgICAgICAgQzMuY2xlYXJBcnJheShzb2wuX0dldE93bkluc3RhbmNlcygpKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IHRtcFBpY2tBcnJheS5sZW5ndGg7IGkgPCBsZW47ICsraSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGluc3QgPSB0bXBQaWNrQXJyYXlbaV07CiAgICAgICAgICAgICAgICAgICAgaWYgKEMzLnhvcihpbnN0LkdldFdvcmxkSW5mbygpLkNvbnRhaW5zUG9pbnQoeCwgeSksIGlzSW52ZXJ0ZWQpKSBzb2wuX1B1c2hJbnN0YW5jZShpbnN0KTsKICAgICAgICAgICAgICAgICAgICBlbHNlIHNvbC5fUHVzaEVsc2VJbnN0YW5jZShpbnN0KQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgb2JqZWN0Q2xhc3MuQXBwbHlTb2xUb0NvbnRhaW5lcigpOwogICAgICAgICAgICAgICAgcmV0dXJuIEMzLnhvcighIXNvbC5fR2V0T3duSW5zdGFuY2VzKCkubGVuZ3RoLCBpc0ludmVydGVkKQogICAgICAgICAgICB9LAogICAgICAgICAgICBQaWNrTGFzdENyZWF0ZWQob2JqZWN0Q2xhc3MpIHsKICAgICAgICAgICAgICAgIGlmICghb2JqZWN0Q2xhc3MpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIGNvbnN0IGlzRmFtaWx5ID0gb2JqZWN0Q2xhc3MuSXNGYW1pbHkoKTsKICAgICAgICAgICAgICAgIGxldCBwaWNrID0gbnVsbDsKICAgICAgICAgICAgICAgIGNvbnN0IGluc3RhbmNlc1BlbmRpbmdDcmVhdGUgPSB0aGlzLl9ydW50aW1lLl9HZXRJbnN0YW5jZXNQZW5kaW5nQ3JlYXRlKCk7CiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gaW5zdGFuY2VzUGVuZGluZ0NyZWF0ZS5sZW5ndGggLSAxOyBpID49IDA7IC0taSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGluc3QgPSBpbnN0YW5jZXNQZW5kaW5nQ3JlYXRlW2ldOwogICAgICAgICAgICAgICAgICAgIGlmIChpc0ZhbWlseSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5zdC5HZXRPYmplY3RDbGFzcygpLkJlbG9uZ3NUb0ZhbWlseShvYmplY3RDbGFzcykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBpY2sgPSBpbnN0OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaW5zdC5HZXRPYmplY3RDbGFzcygpID09PSBvYmplY3RDbGFzcykgewogICAgICAgICAgICAgICAgICAgICAgICBwaWNrID0gaW5zdDsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoIXBpY2spIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBpbnN0YW5jZXMgPQogICAgICAgICAgICAgICAgICAgICAgICBvYmplY3RDbGFzcy5HZXRJbnN0YW5jZXMoKTsKICAgICAgICAgICAgICAgICAgICBpZiAoaW5zdGFuY2VzLmxlbmd0aCkgcGljayA9IGluc3RhbmNlcy5hdCgtMSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICghcGljaykgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgY29uc3Qgc29sID0gb2JqZWN0Q2xhc3MuR2V0Q3VycmVudFNvbCgpOwogICAgICAgICAgICAgICAgc29sLlBpY2tPbmUocGljayk7CiAgICAgICAgICAgICAgICBvYmplY3RDbGFzcy5BcHBseVNvbFRvQ29udGFpbmVyKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgICAgICB9LAogICAgICAgICAgICBSZXBlYXQoY291bnQpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9ydW50aW1lLklzRGVidWdnaW5nKCkpIHJldHVybiB0aGlzLl9EZWJ1Z1JlcGVhdChjb3VudCk7CiAgICAgICAgICAgICAgICBlbHNlIHJldHVybiB0aGlzLl9SZXBlYXQoY291bnQpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFdoaWxlKCkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuX3J1bnRpbWUuSXNEZWJ1Z2dpbmcoKSkgcmV0dXJuIHRoaXMuX0RlYnVnV2hpbGUoKTsKICAgICAgICAgICAgICAgIGVsc2UgcmV0dXJuIHRoaXMuX1doaWxlKCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgRm9yKG5hbWUsIHN0YXJ0LCBlbmQpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9ydW50aW1lLklzRGVidWdnaW5nKCkpIHJldHVybiB0aGlzLl9EZWJ1Z0ZvcihuYW1lLCBzdGFydCwgZW5kKTsKICAgICAgICAgICAgICAgIGVsc2UgcmV0dXJuIHRoaXMuX0ZvcihuYW1lLAogICAgICAgICAgICAgICAgICAgIHN0YXJ0LCBlbmQpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIEZvckVhY2gob2JqZWN0Q2xhc3MpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9ydW50aW1lLklzRGVidWdnaW5nKCkpIHJldHVybiB0aGlzLl9EZWJ1Z0ZvckVhY2gob2JqZWN0Q2xhc3MpOwogICAgICAgICAgICAgICAgZWxzZSByZXR1cm4gdGhpcy5fRm9yRWFjaChvYmplY3RDbGFzcykKICAgICAgICAgICAgfSwKICAgICAgICAgICAgRm9yRWFjaE9yZGVyZWQob2JqZWN0Q2xhc3MsIGV4cHJlc3Npb24sIG9yZGVyKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fcnVudGltZS5Jc0RlYnVnZ2luZygpKSByZXR1cm4gdGhpcy5fRGVidWdGb3JFYWNoT3JkZXJlZChvYmplY3RDbGFzcywgb3JkZXIpOwogICAgICAgICAgICAgICAgZWxzZSByZXR1cm4gdGhpcy5fRm9yRWFjaE9yZGVyZWQob2JqZWN0Q2xhc3MsIG9yZGVyKQogICAgICAgICAgICB9LAogICAgICAgICAgICBMYXllclZpc2libGUobGF5ZXIpIHsKICAgICAgICAgICAgICAgIHJldHVybiBsYXllciA/IGxheWVyLklzVmlzaWJsZSgpIDogZmFsc2UKICAgICAgICAgICAgfSwKICAgICAgICAgICAgTGF5ZXJJbnRlcmFjdGl2ZShsYXllcikgewogICAgICAgICAgICAgICAgcmV0dXJuIGxheWVyID8gbGF5ZXIuSXNTZWxmQW5kUGFyZW50c0ludGVyYWN0aXZlKCkgOiBmYWxzZQogICAgICAgICAgICB9LAogICAgICAgICAgICBMYXllckVtcHR5KGxheWVyKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbGF5ZXIgPyAhbGF5ZXIuR2V0SW5zdGFuY2VDb3VudCgpIDoKICAgICAgICAgICAgICAgICAgICBmYWxzZQogICAgICAgICAgICB9LAogICAgICAgICAgICBMYXllckNtcE9wYWNpdHkobGF5ZXIsIGNtcCwgbykgewogICAgICAgICAgICAgICAgaWYgKCFsYXllcikgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgcmV0dXJuIEMzLmNvbXBhcmUobGF5ZXIuR2V0T3BhY2l0eSgpICogMTAwLCBjbXAsIG8pCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIE9uSW1hZ2VMb2FkaW5nQ29tcGxldGUoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgICAgICB9LAogICAgICAgICAgICBJc0xvYWRpbmdJbWFnZXMoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5faW1hZ2VzTG9hZGluZ1RvdGFsID4gMAogICAgICAgICAgICB9LAogICAgICAgICAgICBUZW1wbGF0ZUV4aXN0cyhvYmplY3RDbGFzcywgdGVtcGxhdGUpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHRlbXBsYXRlTWFuYWdlciA9IHRoaXMuX3J1bnRpbWUuR2V0VGVtcGxhdGVNYW5hZ2VyKCk7CiAgICAgICAgICAgICAgICBpZiAoIXRlbXBsYXRlTWFuYWdlcikgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgaWYgKCF0ZW1wbGF0ZSkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgcmV0dXJuICEhdGVtcGxhdGVNYW5hZ2VyLkdldFRlbXBsYXRlRGF0YShvYmplY3RDbGFzcywgdGVtcGxhdGUpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IHsKICAgICAgICBjb25zdCBDMyA9IHNlbGYuQzM7CgogICAgICAgIGZ1bmN0aW9uIFNvcnRaT3JkZXJMaXN0KGEsIGIpIHsKICAgICAgICAgICAgY29uc3QgbGF5ZXJBID0gYVswXTsKICAgICAgICAgICAgY29uc3QgbGF5ZXJCID0gYlswXTsKICAgICAgICAgICAgY29uc3QgZGlmZiA9IGxheWVyQSAtIGxheWVyQjsKICAgICAgICAgICAgaWYgKGRpZmYgIT09IDApIHJldHVybiBkaWZmOwogICAgICAgICAgICBjb25zdCBpbmRleEEgPSBhWzFdOwogICAgICAgICAgICBjb25zdCBpbmRleEIgPSBiWzFdOwogICAgICAgICAgICByZXR1cm4gaW5kZXhBIC0gaW5kZXhCCiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBTb3J0SW5zdGFuY2VzQnlWYWx1ZShhLCBiKSB7CiAgICAgICAgICAgIHJldHVybiBhWzFdIC0gYlsxXQogICAgICAgIH0KICAgICAgICBjb25zdCB0ZW1wWk9yZGVyTGlzdCA9IFtdOwogICAgICAgIGNvbnN0IHRlbXBJbnN0VmFsdWVzID0gW107CiAgICAgICAgY29uc3QgdGVtcFJlY3QgPSBDMy5OZXcoQzMuUmVjdCk7CiAgICAgICAgY29uc3QgdGVtcENvbG9yID0gQzMuTmV3KEMzLkNvbG9yKTsKICAgICAgICBDMy5QbHVnaW5zLlN5c3RlbS5BY3RzID0gewogICAgICAgICAgICBTZXRWYXIoZXYsIHgpIHsKICAgICAgICAgICAgICAgIGV2LlNldFZhbHVlKHgpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIEFkZFZhcihldiwgeCkgewogICAgICAgICAgICAgICAgaWYgKGV2LklzTnVtYmVyKCkgJiYgdHlwZW9mIHggIT09ICJudW1iZXIiKSB4ID0gcGFyc2VGbG9hdCh4KTsKICAgICAgICAgICAgICAgIGV2LlNldFZhbHVlKGV2LkdldFZhbHVlKCkgKyB4KQogICAgICAgICAgICB9LAogICAgICAgICAgICBTdWJWYXIoZXYsIHgpIHsKICAgICAgICAgICAgICAgIGlmICghZXYuSXNOdW1iZXIoKSkgcmV0dXJuOwogICAgICAgICAgICAgICAgZXYuU2V0VmFsdWUoZXYuR2V0VmFsdWUoKSAtIHgpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFNldEJvb2xWYXIoZXYsIHgpIHsKICAgICAgICAgICAgICAgIGV2LlNldFZhbHVlKCEheCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgVG9nZ2xlQm9vbFZhcihldikgewogICAgICAgICAgICAgICAgZXYuU2V0VmFsdWUoIWV2LkdldFZhbHVlKCkpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFJlc2V0R2xvYmFscygpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuR2V0RXZlbnRTaGVldE1hbmFnZXIoKS5SZXNldEFsbEdsb2JhbHNUb0luaXRpYWxWYWx1ZSgpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIENyZWF0ZU9iamVjdChvYmplY3RDbGFzcywgbGF5ZXIsIHgsIHksIGNyZWF0ZUhpZXJhcmNoeSwgdGVtcGxhdGUpIHsKICAgICAgICAgICAgICAgIGlmICghb2JqZWN0Q2xhc3MgfHwgIWxheWVyKSByZXR1cm47CiAgICAgICAgICAgICAgICBjb25zdCBpbnN0ID0gdGhpcy5fcnVudGltZS5DcmVhdGVJbnN0YW5jZShvYmplY3RDbGFzcywgbGF5ZXIsIHgsIHksIGNyZWF0ZUhpZXJhcmNoeSwgdGVtcGxhdGUpOwogICAgICAgICAgICAgICAgaWYgKCFpbnN0KSByZXR1cm47CiAgICAgICAgICAgICAgICBpZiAoY3JlYXRlSGllcmFyY2h5KSBsYXllci5Tb3J0QW5kQWRkSW5zdGFuY2VzQnlaSW5kZXgoaW5zdCk7CiAgICAgICAgICAgICAgICBjb25zdCBldmVudFNoZWV0TWFuYWdlciA9CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcnVudGltZS5HZXRFdmVudFNoZWV0TWFuYWdlcigpOwogICAgICAgICAgICAgICAgZXZlbnRTaGVldE1hbmFnZXIuQmxvY2tGbHVzaGluZ0luc3RhbmNlcyh0cnVlKTsKICAgICAgICAgICAgICAgIGluc3QuX1RyaWdnZXJPbkNyZWF0ZWRPblNlbGZBbmRSZWxhdGVkKCk7CiAgICAgICAgICAgICAgICBldmVudFNoZWV0TWFuYWdlci5CbG9ja0ZsdXNoaW5nSW5zdGFuY2VzKGZhbHNlKTsKICAgICAgICAgICAgICAgIGNvbnN0IHBpY2tNYXAgPSBuZXcgTWFwOwogICAgICAgICAgICAgICAgaW5zdC5Db2xsZWN0SW5zdGFuY2VzVG9QaWNrKHBpY2tNYXAsIG9iamVjdENsYXNzLCBjcmVhdGVIaWVyYXJjaHkpOwogICAgICAgICAgICAgICAgZm9yIChjb25zdCBbcGlja09iamVjdENsYXNzLCBpbnN0U2V0XSBvZiBwaWNrTWFwKSBwaWNrT2JqZWN0Q2xhc3MuR2V0Q3VycmVudFNvbCgpLlNldFNldFBpY2tlZChpbnN0U2V0KQogICAgICAgICAgICB9LAogICAgICAgICAgICBDcmVhdGVPYmplY3RCeU5hbWUob2JqZWN0Q2xhc3NOYW1lLCBsYXllciwgeCwgeSwgY3JlYXRlSGllcmFyY2h5LCB0ZW1wbGF0ZSkgewogICAgICAgICAgICAgICAgaWYgKCFvYmplY3RDbGFzc05hbWUgfHwgIWxheWVyKSByZXR1cm47CiAgICAgICAgICAgICAgICBjb25zdCBvYmplY3RDbGFzcyA9IHRoaXMuX3J1bnRpbWUuR2V0T2JqZWN0Q2xhc3NCeU5hbWUob2JqZWN0Q2xhc3NOYW1lKTsKICAgICAgICAgICAgICAgIGlmICghb2JqZWN0Q2xhc3MpIHJldHVybjsKICAgICAgICAgICAgICAgIEMzLlBsdWdpbnMuU3lzdGVtLkFjdHMuQ3JlYXRlT2JqZWN0LmNhbGwodGhpcywgb2JqZWN0Q2xhc3MsIGxheWVyLCB4LCB5LCBjcmVhdGVIaWVyYXJjaHksIHRlbXBsYXRlKQogICAgICAgICAgICB9LAogICAgICAgICAgICBSZWNyZWF0ZUluaXRpYWxPYmplY3RzKG9iamVjdENsYXNzLCB4MSwgeTEsIHgyLCB5Miwgc291cmNlTGF5b3V0TmFtZSwgc291cmNlTGF5ZXJQYXJhbSwgb2Zmc2V0WCwgb2Zmc2V0WSwgY3JlYXRlSGllcmFyY2h5KSB7CiAgICAgICAgICAgICAgICBpZiAoIW9iamVjdENsYXNzKSByZXR1cm47CiAgICAgICAgICAgICAgICBsZXQgc291cmNlTGF5b3V0ID0gdGhpcy5fcnVudGltZS5HZXRDdXJyZW50TGF5b3V0KCk7CiAgICAgICAgICAgICAgICBpZiAoc291cmNlTGF5b3V0TmFtZSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGxvb2t1cExheW91dCA9IHRoaXMuX3J1bnRpbWUuR2V0TGF5b3V0TWFuYWdlcigpLkdldExheW91dEJ5TmFtZShzb3VyY2VMYXlvdXROYW1lKTsKICAgICAgICAgICAgICAgICAgICBpZiAobG9va3VwTGF5b3V0KSBzb3VyY2VMYXlvdXQgPSBsb29rdXBMYXlvdXQ7CiAgICAgICAgICAgICAgICAgICAgZWxzZSByZXR1cm4KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGxldCBzb3VyY2VMYXllciA9IG51bGw7CiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHNvdXJjZUxheWVyUGFyYW0gIT09CiAgICAgICAgICAgICAgICAgICAgIm51bWJlciIgfHwgc291cmNlTGF5ZXJQYXJhbSA+PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgc291cmNlTGF5ZXIgPSBzb3VyY2VMYXlvdXQuR2V0TGF5ZXIoc291cmNlTGF5ZXJQYXJhbSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFzb3VyY2VMYXllcikgcmV0dXJuCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0ZW1wUmVjdC5zZXQoeDEsIHkxLCB4MiwgeTIpOwogICAgICAgICAgICAgICAgY29uc3QgYWxsQ3JlYXRlZEluc3RhbmNlcyA9IHNvdXJjZUxheW91dC5SZWNyZWF0ZUluaXRpYWxPYmplY3RzKG9iamVjdENsYXNzLCB0ZW1wUmVjdCwgc291cmNlTGF5ZXIsIG9mZnNldFgsIG9mZnNldFksIGNyZWF0ZUhpZXJhcmNoeSk7CiAgICAgICAgICAgICAgICBvYmplY3RDbGFzcy5HZXRDdXJyZW50U29sKCkuU2V0QXJyYXlQaWNrZWQoYWxsQ3JlYXRlZEluc3RhbmNlcyk7CiAgICAgICAgICAgICAgICBvYmplY3RDbGFzcy5BcHBseVNvbFRvQ29udGFpbmVyKCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgU3RvcExvb3AoKSB7CiAgICAgICAgICAgICAgICBjb25zdCBsb29wU3RhY2sgPSB0aGlzLl9sb29wU3RhY2s7CiAgICAgICAgICAgICAgICBpZiAoIWxvb3BTdGFjay5Jc0luTG9vcCgpKSByZXR1cm47CiAgICAgICAgICAgICAgICBsb29wU3RhY2suR2V0Q3VycmVudCgpLlN0b3AoKQogICAgICAgICAgICB9LAogICAgICAgICAgICBTZXRHcm91cEFjdGl2ZShncm91cE5hbWUsIGEpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGdyb3VwID0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9ydW50aW1lLkdldEV2ZW50U2hlZXRNYW5hZ2VyKCkuR2V0RXZlbnRHcm91cEJ5TmFtZShncm91cE5hbWUpOwogICAgICAgICAgICAgICAgaWYgKCFncm91cCkgcmV0dXJuOwogICAgICAgICAgICAgICAgaWYgKGEgPT09IDApIGdyb3VwLlNldEdyb3VwQWN0aXZlKGZhbHNlKTsKICAgICAgICAgICAgICAgIGVsc2UgaWYgKGEgPT09IDEpIGdyb3VwLlNldEdyb3VwQWN0aXZlKHRydWUpOwogICAgICAgICAgICAgICAgZWxzZSBncm91cC5TZXRHcm91cEFjdGl2ZSghZ3JvdXAuSXNHcm91cEFjdGl2ZSgpKQogICAgICAgICAgICB9LAogICAgICAgICAgICBTZXRUaW1lc2NhbGUodHMpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuU2V0VGltZVNjYWxlKHRzKQogICAgICAgICAgICB9LAogICAgICAgICAgICBTZXRPYmplY3RUaW1lc2NhbGUob2JqZWN0Q2xhc3MsIHRzKSB7CiAgICAgICAgICAgICAgICBpZiAodHMgPCAwKSB0cyA9IDA7CiAgICAgICAgICAgICAgICBpZiAoIW9iamVjdENsYXNzKSByZXR1cm47CiAgICAgICAgICAgICAgICBjb25zdCBzb2wgPSBvYmplY3RDbGFzcy5HZXRDdXJyZW50U29sKCk7CiAgICAgICAgICAgICAgICBjb25zdCBpbnN0YW5jZXMgPSBzb2wuR2V0SW5zdGFuY2VzKCk7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGluc3Qgb2YgaW5zdGFuY2VzKSBpbnN0LlNldFRpbWVTY2FsZSh0cykKICAgICAgICAgICAgfSwKICAgICAgICAgICAgUmVzdG9yZU9iamVjdFRpbWVzY2FsZShvYmplY3RDbGFzcykgewogICAgICAgICAgICAgICAgaWYgKCFvYmplY3RDbGFzcykgcmV0dXJuOwogICAgICAgICAgICAgICAgY29uc3Qgc29sID0gb2JqZWN0Q2xhc3MuR2V0Q3VycmVudFNvbCgpOwogICAgICAgICAgICAgICAgY29uc3QgaW5zdGFuY2VzID0gc29sLkdldEluc3RhbmNlcygpOwogICAgICAgICAgICAgICAgZm9yIChjb25zdCBpbnN0IG9mIGluc3RhbmNlcykgaW5zdC5SZXN0b3JlVGltZVNjYWxlKCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgV2FpdChzZWNvbmRzKSB7CiAgICAgICAgICAgICAgICBpZiAoc2Vjb25kcyA8IDApIHJldHVybjsKICAgICAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuR2V0RXZlbnRTaGVldE1hbmFnZXIoKS5BZGRTY2hlZHVsZWRXYWl0KCkuSW5pdFRpbWVyKHNlY29uZHMpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgV2FpdEZvclNpZ25hbCh0YWcpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuR2V0RXZlbnRTaGVldE1hbmFnZXIoKS5BZGRTY2hlZHVsZWRXYWl0KCkuSW5pdFNpZ25hbCh0YWcpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgV2FpdEZvclByZXZpb3VzQWN0aW9ucygpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGV2ZW50U2hlZXRNYW5hZ2VyID0gdGhpcy5fcnVudGltZS5HZXRFdmVudFNoZWV0TWFuYWdlcigpOwogICAgICAgICAgICAgICAgZXZlbnRTaGVldE1hbmFnZXIuQWRkU2NoZWR1bGVkV2FpdCgpLkluaXRQcm9taXNlKGV2ZW50U2hlZXRNYW5hZ2VyLkdldFByb21pc2VGb3JBbGxBc3luY0FjdGlvbnMoKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgICAgICB9LAogICAgICAgICAgICBTaWduYWwodGFnKSB7CiAgICAgICAgICAgICAgICBjb25zdCBsb3dlclRhZyA9IHRhZy50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgICAgdGhpcy5fc2lnbmFsVGFncy5wdXNoKGxvd2VyVGFnKTsKICAgICAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuVHJpZ2dlcihDMy5QbHVnaW5zLlN5c3RlbS5DbmRzLk9uU2lnbmFsLCBudWxsKTsKICAgICAgICAgICAgICAgIHRoaXMuX3NpZ25hbFRhZ3MucG9wKCk7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHcgb2YgdGhpcy5fcnVudGltZS5HZXRFdmVudFNoZWV0TWFuYWdlcigpLnNjaGVkdWxlZFdhaXRzKCkpCiAgICAgICAgICAgICAgICAgICAgaWYgKHcuSXNTaWduYWwoKSAmJiB3LkdldFNpZ25hbFRhZygpID09PSBsb3dlclRhZykgdy5TZXRTaWduYWxsZWQoKQogICAgICAgICAgICB9LAogICAgICAgICAgICBhc3luYyBTbmFwc2hvdENhbnZhcyhmb3JtYXQsIHF1YWxpdHksIHgsIHksIHdpZHRoLCBoZWlnaHQpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGNhbnZhc01hbmFnZXIgPSB0aGlzLl9ydW50aW1lLkdldENhbnZhc01hbmFnZXIoKTsKICAgICAgICAgICAgICAgIGlmICghY2FudmFzTWFuYWdlcikgcmV0dXJuOwogICAgICAgICAgICAgICAgdGhpcy5VcGRhdGVSZW5kZXIoKTsKICAgICAgICAgICAgICAgIGF3YWl0IGNhbnZhc01hbmFnZXIuU25hcHNob3RDYW52YXMoZm9ybWF0ID09PQogICAgICAgICAgICAgICAgICAgIDAgPyAiaW1hZ2UvcG5nIiA6ICJpbWFnZS9qcGVnIiwgcXVhbGl0eSAvIDEwMCwgeCwgeSwgd2lkdGgsIGhlaWdodCk7CiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLl9ydW50aW1lLlRyaWdnZXJBc3luYyhDMy5QbHVnaW5zLlN5c3RlbS5DbmRzLk9uQ2FudmFzU25hcHNob3QsIG51bGwpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFNldENhbnZhc1NpemUodywgaCkgewogICAgICAgICAgICAgICAgaWYgKHcgPD0gMCB8fCBoIDw9IDApIHJldHVybjsKICAgICAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuU2V0Vmlld3BvcnRTaXplKHcsIGgpOwogICAgICAgICAgICAgICAgdGhpcy5fcnVudGltZS5HZXRDdXJyZW50TGF5b3V0KCkuQm91bmRTY3JvbGxpbmcoKTsKICAgICAgICAgICAgICAgIGNvbnN0IGNhbnZhc01hbmFnZXIgPSB0aGlzLl9ydW50aW1lLkdldENhbnZhc01hbmFnZXIoKTsKICAgICAgICAgICAgICAgIGlmICghY2FudmFzTWFuYWdlcikgcmV0dXJuOwogICAgICAgICAgICAgICAgaWYgKGNhbnZhc01hbmFnZXIuR2V0Q3VycmVudEZ1bGxzY3JlZW5Nb2RlKCkgPT09ICJvZmYiKSBjYW52YXNNYW5hZ2VyLlNldFNpemUoY2FudmFzTWFuYWdlci5HZXRMYXN0V2lkdGgoKSwgY2FudmFzTWFuYWdlci5HZXRMYXN0SGVpZ2h0KCksIHRydWUpOwogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcnVudGltZS5TZXRPcmlnaW5hbFZpZXdwb3J0U2l6ZSh3LAogICAgICAgICAgICAgICAgICAgICAgICBoKTsKICAgICAgICAgICAgICAgICAgICBjYW52YXNNYW5hZ2VyLlNldFNpemUoY2FudmFzTWFuYWdlci5HZXRMYXN0V2lkdGgoKSwgY2FudmFzTWFuYWdlci5HZXRMYXN0SGVpZ2h0KCksIHRydWUpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLl9ydW50aW1lLlVwZGF0ZVJlbmRlcigpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFNldEZ1bGxzY3JlZW5RdWFsaXR5KHEpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGNhbnZhc01hbmFnZXIgPSB0aGlzLl9ydW50aW1lLkdldENhbnZhc01hbmFnZXIoKTsKICAgICAgICAgICAgICAgIGlmICghY2FudmFzTWFuYWdlcikgcmV0dXJuOwogICAgICAgICAgICAgICAgaWYgKGNhbnZhc01hbmFnZXIuR2V0Q3VycmVudEZ1bGxzY3JlZW5Nb2RlKCkgPT09ICJvZmYiKSByZXR1cm47CiAgICAgICAgICAgICAgICBjYW52YXNNYW5hZ2VyLlNldEZ1bGxzY3JlZW5TY2FsaW5nUXVhbGl0eShxICE9PSAwID8gImhpZ2giIDogImxvdyIpOwogICAgICAgICAgICAgICAgY2FudmFzTWFuYWdlci5TZXRTaXplKGNhbnZhc01hbmFnZXIuR2V0TGFzdFdpZHRoKCksIGNhbnZhc01hbmFnZXIuR2V0TGFzdEhlaWdodCgpLCB0cnVlKQogICAgICAgICAgICB9LAogICAgICAgICAgICBTYXZlU3RhdGUoc2xvdCkgewogICAgICAgICAgICAgICAgdGhpcy5fcnVudGltZS5TYXZlVG9TbG90KHNsb3QpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIExvYWRTdGF0ZShzbG90KSB7CiAgICAgICAgICAgICAgICB0aGlzLl9ydW50aW1lLkxvYWRGcm9tU2xvdChzbG90KQogICAgICAgICAgICB9LAogICAgICAgICAgICBMb2FkU3RhdGVKU09OKGpzb25TdHIpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuTG9hZEZyb21Kc29uU3RyaW5nKGpzb25TdHIpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFNldEhhbGZGcmFtZXJhdGVNb2RlKG0pIHt9LAogICAgICAgICAgICBSZXNldFBlcnNpc3RlZCgpIHsKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgbGF5b3V0IG9mIHRoaXMuX3J1bnRpbWUuR2V0TGF5b3V0TWFuYWdlcigpLkdldEFsbExheW91dHMoKSkgbGF5b3V0LlJlc2V0UGVyc2lzdERhdGEoKQogICAgICAgICAgICB9LAogICAgICAgICAgICBTZXRQaXhlbFJvdW5kaW5nKG0pIHsKICAgICAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuU2V0UGl4ZWxSb3VuZGluZ0VuYWJsZWQobSAhPT0gMCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgU2V0TWluaW11bUZyYW1lcmF0ZShmcHMpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuU2V0TWluaW11bUZyYW1lcmF0ZShmcHMpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFNvcnRaT3JkZXJCeUluc3RWYXIob2JqZWN0Q2xhc3MsIGluc3RWYXIpIHsKICAgICAgICAgICAgICAgIGlmICghb2JqZWN0Q2xhc3MpIHJldHVybjsKICAgICAgICAgICAgICAgIGNvbnN0IHNvbCA9IG9iamVjdENsYXNzLkdldEN1cnJlbnRTb2woKTsKICAgICAgICAgICAgICAgIGNvbnN0IHBpY2tlZEluc3RhbmNlcyA9IHNvbC5HZXRJbnN0YW5jZXMoKTsKICAgICAgICAgICAgICAgIGNvbnN0IHpPcmRlckxpc3QgPSB0ZW1wWk9yZGVyTGlzdDsKICAgICAgICAgICAgICAgIGNvbnN0IGluc3RWYWx1ZXMgPSB0ZW1wSW5zdFZhbHVlczsKICAgICAgICAgICAgICAgIGNvbnN0IGxheW91dCA9IHRoaXMuX3J1bnRpbWUuR2V0Q3VycmVudExheW91dCgpOwogICAgICAgICAgICAgICAgY29uc3QgaXNGYW1pbHkgPSBvYmplY3RDbGFzcy5Jc0ZhbWlseSgpOwogICAgICAgICAgICAgICAgY29uc3QgZmFtaWx5SW5kZXggPSBvYmplY3RDbGFzcy5HZXRGYW1pbHlJbmRleCgpOwogICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IHBpY2tlZEluc3RhbmNlcy5sZW5ndGg7IGkgPCBsZW47ICsraSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGluc3QgPSBwaWNrZWRJbnN0YW5jZXNbaV07CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgd2kgPSBpbnN0LkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICAgICAgICAgIGlmICghd2kpIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgIGxldCB2YWx1ZTsKICAgICAgICAgICAgICAgICAgICBpZiAoaXNGYW1pbHkpIHZhbHVlID0gaW5zdC5HZXRJbnN0YW5jZVZhcmlhYmxlVmFsdWUoaW5zdFZhciArIGluc3QuR2V0T2JqZWN0Q2xhc3MoKS5HZXRGYW1pbHlJbnN0YW5jZVZhcmlhYmxlT2Zmc2V0KGZhbWlseUluZGV4KSk7CiAgICAgICAgICAgICAgICAgICAgZWxzZSB2YWx1ZSA9IGluc3QuR2V0SW5zdGFuY2VWYXJpYWJsZVZhbHVlKGluc3RWYXIpOwogICAgICAgICAgICAgICAgICAgIHpPcmRlckxpc3QucHVzaChbd2kuR2V0TGF5ZXIoKS5HZXRJbmRleCgpLAogICAgICAgICAgICAgICAgICAgICAgICB3aS5HZXRaSW5kZXgoKQogICAgICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICAgICAgICAgIGluc3RWYWx1ZXMucHVzaChbaW5zdCwgdmFsdWVdKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKCF6T3JkZXJMaXN0Lmxlbmd0aCkgcmV0dXJuOwogICAgICAgICAgICAgICAgek9yZGVyTGlzdC5zb3J0KFNvcnRaT3JkZXJMaXN0KTsKICAgICAgICAgICAgICAgIGluc3RWYWx1ZXMuc29ydChTb3J0SW5zdGFuY2VzQnlWYWx1ZSk7CiAgICAgICAgICAgICAgICBsZXQgYW55Q2hhbmdlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IHpPcmRlckxpc3QubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBpbnN0ID0gaW5zdFZhbHVlc1tpXVswXTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBsYXllciA9IGxheW91dC5HZXRMYXllckJ5SW5kZXgoek9yZGVyTGlzdFtpXVswXSk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdG9aID0gek9yZGVyTGlzdFtpXVsxXTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBsYXllckluc3RhbmNlcyA9IGxheWVyLl9HZXRJbnN0YW5jZXMoKTsKICAgICAgICAgICAgICAgICAgICBpZiAobGF5ZXJJbnN0YW5jZXNbdG9aXSAhPT0gaW5zdCkgewogICAgICAgICAgICAgICAgICAgICAgICBsYXllckluc3RhbmNlc1t0b1pdID0gaW5zdDsKICAgICAgICAgICAgICAgICAgICAgICAgaW5zdC5HZXRXb3JsZEluZm8oKS5fU2V0TGF5ZXIobGF5ZXIsIHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICBsYXllci5TZXRaSW5kaWNlc0NoYW5nZWQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgYW55Q2hhbmdlZCA9IHRydWUKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoYW55Q2hhbmdlZCkgdGhpcy5fcnVudGltZS5VcGRhdGVSZW5kZXIoKTsKICAgICAgICAgICAgICAgIEMzLmNsZWFyQXJyYXkodGVtcFpPcmRlckxpc3QpOwogICAgICAgICAgICAgICAgQzMuY2xlYXJBcnJheSh0ZW1wSW5zdFZhbHVlcykKICAgICAgICAgICAgfSwKICAgICAgICAgICAgR29Ub0xheW91dChsYXlvdXQpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9ydW50aW1lLklzTG9hZGluZygpKSByZXR1cm47CiAgICAgICAgICAgICAgICBjb25zdCBsYXlvdXRNYW5hZ2VyID0gdGhpcy5fcnVudGltZS5HZXRMYXlvdXRNYW5hZ2VyKCk7CiAgICAgICAgICAgICAgICBpZiAobGF5b3V0TWFuYWdlci5Jc1BlbmRpbmdDaGFuZ2VNYWluTGF5b3V0KCkpIHJldHVybjsKICAgICAgICAgICAgICAgIGxheW91dE1hbmFnZXIuQ2hhbmdlTWFpbkxheW91dChsYXlvdXQpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIEdvVG9MYXlvdXRCeU5hbWUobGF5b3V0TmFtZSkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuX3J1bnRpbWUuSXNMb2FkaW5nKCkpIHJldHVybjsKICAgICAgICAgICAgICAgIGNvbnN0IGxheW91dE1hbmFnZXIgPSB0aGlzLl9ydW50aW1lLkdldExheW91dE1hbmFnZXIoKTsKICAgICAgICAgICAgICAgIGlmIChsYXlvdXRNYW5hZ2VyLklzUGVuZGluZ0NoYW5nZU1haW5MYXlvdXQoKSkgcmV0dXJuOwogICAgICAgICAgICAgICAgY29uc3QgdG9MYXlvdXQgPSBsYXlvdXRNYW5hZ2VyLkdldExheW91dEJ5TmFtZShsYXlvdXROYW1lKTsKICAgICAgICAgICAgICAgIGlmICh0b0xheW91dCkgbGF5b3V0TWFuYWdlci5DaGFuZ2VNYWluTGF5b3V0KHRvTGF5b3V0KQogICAgICAgICAgICB9LAogICAgICAgICAgICBOZXh0UHJldkxheW91dChwcmV2KSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fcnVudGltZS5Jc0xvYWRpbmcoKSkgcmV0dXJuOwogICAgICAgICAgICAgICAgY29uc3QgbGF5b3V0TWFuYWdlciA9IHRoaXMuX3J1bnRpbWUuR2V0TGF5b3V0TWFuYWdlcigpOwogICAgICAgICAgICAgICAgaWYgKGxheW91dE1hbmFnZXIuSXNQZW5kaW5nQ2hhbmdlTWFpbkxheW91dCgpKSByZXR1cm47CiAgICAgICAgICAgICAgICBjb25zdCBhbGxMYXlvdXRzID0gbGF5b3V0TWFuYWdlci5HZXRBbGxMYXlvdXRzKCk7CiAgICAgICAgICAgICAgICBjb25zdCBpbmRleCA9IGFsbExheW91dHMuaW5kZXhPZihsYXlvdXRNYW5hZ2VyLkdldE1haW5SdW5uaW5nTGF5b3V0KCkpOwogICAgICAgICAgICAgICAgaWYgKHByZXYgJiYgaW5kZXggPT09IDApIHJldHVybjsKICAgICAgICAgICAgICAgIGlmICghcHJldiAmJiBpbmRleCA9PT0gYWxsTGF5b3V0cy5sZW5ndGggLSAxKSByZXR1cm47CiAgICAgICAgICAgICAgICBjb25zdCB0b0xheW91dCA9IGFsbExheW91dHNbaW5kZXggKyAocHJldiA/IC0xIDogMSldOwogICAgICAgICAgICAgICAgbGF5b3V0TWFuYWdlci5DaGFuZ2VNYWluTGF5b3V0KHRvTGF5b3V0KQogICAgICAgICAgICB9LAogICAgICAgICAgICBSZXN0YXJ0TGF5b3V0KCkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuX3J1bnRpbWUuSXNMb2FkaW5nKCkpIHJldHVybjsKICAgICAgICAgICAgICAgIGNvbnN0IGxheW91dE1hbmFnZXIgPQogICAgICAgICAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuR2V0TGF5b3V0TWFuYWdlcigpOwogICAgICAgICAgICAgICAgaWYgKGxheW91dE1hbmFnZXIuSXNQZW5kaW5nQ2hhbmdlTWFpbkxheW91dCgpKSByZXR1cm47CiAgICAgICAgICAgICAgICBsYXlvdXRNYW5hZ2VyLkNoYW5nZU1haW5MYXlvdXQobGF5b3V0TWFuYWdlci5HZXRNYWluUnVubmluZ0xheW91dCgpKTsKICAgICAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuR2V0RXZlbnRTaGVldE1hbmFnZXIoKS5SZXNldEFsbEdyb3Vwc0luaXRpYWxBY3RpdmF0aW9uKCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgU2V0TGF5ZXJWaXNpYmxlKGxheWVyLCB2KSB7CiAgICAgICAgICAgICAgICBpZiAoIWxheWVyKSByZXR1cm47CiAgICAgICAgICAgICAgICBsYXllci5TZXRWaXNpYmxlKHYpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFNldExheWVySW50ZXJhY3RpdmUobGF5ZXIsIGkpIHsKICAgICAgICAgICAgICAgIGlmICghbGF5ZXIpIHJldHVybjsKICAgICAgICAgICAgICAgIGxheWVyLlNldEludGVyYWN0aXZlKGkpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFNldExheWVyT3BhY2l0eShsYXllciwgbykgewogICAgICAgICAgICAgICAgaWYgKCFsYXllcikgcmV0dXJuOwogICAgICAgICAgICAgICAgbGF5ZXIuU2V0T3BhY2l0eShvIC8gMTAwKQogICAgICAgICAgICB9LAogICAgICAgICAgICBTZXRMYXllclNjYWxlKGxheWVyLCBzKSB7CiAgICAgICAgICAgICAgICBpZiAoIWxheWVyKSByZXR1cm47CiAgICAgICAgICAgICAgICBsYXllci5TZXRPd25TY2FsZShzKQogICAgICAgICAgICB9LAogICAgICAgICAgICBTZXRMYXllclNjYWxlUmF0ZShsYXllciwKICAgICAgICAgICAgICAgIHIpIHsKICAgICAgICAgICAgICAgIGlmICghbGF5ZXIpIHJldHVybjsKICAgICAgICAgICAgICAgIGxheWVyLlNldFNjYWxlUmF0ZShyKQogICAgICAgICAgICB9LAogICAgICAgICAgICBTZXRMYXllckFuZ2xlKGxheWVyLCBhKSB7CiAgICAgICAgICAgICAgICBpZiAoIWxheWVyKSByZXR1cm47CiAgICAgICAgICAgICAgICBsYXllci5TZXRBbmdsZShDMy50b1JhZGlhbnMoK2EpKQogICAgICAgICAgICB9LAogICAgICAgICAgICBTZXRMYXllclNjcm9sbChsYXllciwgc2Nyb2xsWCwgc2Nyb2xsWSkgewogICAgICAgICAgICAgICAgaWYgKCFsYXllcikgcmV0dXJuOwogICAgICAgICAgICAgICAgbGF5ZXIuU2V0T3duU2Nyb2xsUG9zaXRpb25FbmFibGVkKHRydWUpOwogICAgICAgICAgICAgICAgbGF5ZXIuU2V0U2Nyb2xsWChzY3JvbGxYKTsKICAgICAgICAgICAgICAgIGxheWVyLlNldFNjcm9sbFkoc2Nyb2xsWSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgUmVzdG9yZUxheWVyU2Nyb2xsKGxheWVyKSB7CiAgICAgICAgICAgICAgICBpZiAoIWxheWVyKSByZXR1cm47CiAgICAgICAgICAgICAgICBsYXllci5TZXRPd25TY3JvbGxQb3NpdGlvbkVuYWJsZWQoZmFsc2UpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFNldExheWVyUGFyYWxsYXgobGF5ZXIsIHB4LCBweSkgewogICAgICAgICAgICAgICAgaWYgKCFsYXllcikgcmV0dXJuOwogICAgICAgICAgICAgICAgbGF5ZXIuU2V0UGFyYWxsYXgocHggLyAxMDAsIHB5IC8gMTAwKQogICAgICAgICAgICB9LAogICAgICAgICAgICBTZXRMYXllclpFbGV2YXRpb24obGF5ZXIsIHopIHsKICAgICAgICAgICAgICAgIGlmICghbGF5ZXIpIHJldHVybjsKICAgICAgICAgICAgICAgIGxheWVyLlNldFpFbGV2YXRpb24oK3opCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFNldExheWVyQmFja2dyb3VuZChsYXllciwgcmdiKSB7CiAgICAgICAgICAgICAgICBpZiAoIWxheWVyKSByZXR1cm47CiAgICAgICAgICAgICAgICB0ZW1wQ29sb3Iuc2V0RnJvbVJnYlZhbHVlKHJnYik7CiAgICAgICAgICAgICAgICB0ZW1wQ29sb3IuY2xhbXAoKTsKICAgICAgICAgICAgICAgIGNvbnN0IGxheWVyQmdDb2xvciA9IGxheWVyLkdldEJhY2tncm91bmRDb2xvcigpOwogICAgICAgICAgICAgICAgaWYgKGxheWVyQmdDb2xvci5lcXVhbHNJZ25vcmluZ0FscGhhKHRlbXBDb2xvcikpIHJldHVybjsKICAgICAgICAgICAgICAgIGxheWVyQmdDb2xvci5jb3B5UmdiKHRlbXBDb2xvcik7CiAgICAgICAgICAgICAgICB0aGlzLlVwZGF0ZVJlbmRlcigpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFNldExheWVyVHJhbnNwYXJlbnQobGF5ZXIsIHQpIHsKICAgICAgICAgICAgICAgIGlmICghbGF5ZXIpIHJldHVybjsKICAgICAgICAgICAgICAgIGxheWVyLlNldFRyYW5zcGFyZW50KHQpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFNldExheWVyQmxlbmRNb2RlKGxheWVyLCBibSkgewogICAgICAgICAgICAgICAgaWYgKCFsYXllcikgcmV0dXJuOwogICAgICAgICAgICAgICAgbGF5ZXIuU2V0QmxlbmRNb2RlKGJtKQogICAgICAgICAgICB9LAogICAgICAgICAgICBTZXRMYXllckVmZmVjdEVuYWJsZWQobGF5ZXIsIGVuYWJsZWQsIGVmZmVjdE5hbWUpIHsKICAgICAgICAgICAgICAgIGlmICghbGF5ZXIpIHJldHVybjsKICAgICAgICAgICAgICAgIGNvbnN0IGVmZmVjdExpc3QgPSBsYXllci5HZXRFZmZlY3RMaXN0KCk7CiAgICAgICAgICAgICAgICBjb25zdCBlZmZlY3RUeXBlID0KICAgICAgICAgICAgICAgICAgICBlZmZlY3RMaXN0LkdldEVmZmVjdFR5cGVCeU5hbWUoZWZmZWN0TmFtZSk7CiAgICAgICAgICAgICAgICBpZiAoIWVmZmVjdFR5cGUpIHJldHVybjsKICAgICAgICAgICAgICAgIGNvbnN0IGUgPSBlbmFibGVkID09PSAxOwogICAgICAgICAgICAgICAgaWYgKGVmZmVjdFR5cGUuSXNBY3RpdmUoKSA9PT0gZSkgcmV0dXJuOwogICAgICAgICAgICAgICAgZWZmZWN0VHlwZS5TZXRBY3RpdmUoZSk7CiAgICAgICAgICAgICAgICBsYXllci5VcGRhdGVBY3RpdmVFZmZlY3RzKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9ydW50aW1lLlVwZGF0ZVJlbmRlcigpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFNldExheWVyRWZmZWN0UGFyYW0obGF5ZXIsIGVmZmVjdE5hbWUsIHBhcmFtSW5kZXgsIHZhbHVlKSB7CiAgICAgICAgICAgICAgICBpZiAoIWxheWVyKSByZXR1cm47CiAgICAgICAgICAgICAgICBjb25zdCBlZmZlY3RMaXN0ID0gbGF5ZXIuR2V0RWZmZWN0TGlzdCgpOwogICAgICAgICAgICAgICAgY29uc3QgZWZmZWN0VHlwZSA9IGVmZmVjdExpc3QuR2V0RWZmZWN0VHlwZUJ5TmFtZShlZmZlY3ROYW1lKTsKICAgICAgICAgICAgICAgIGlmICghZWZmZWN0VHlwZSkgcmV0dXJuOwogICAgICAgICAgICAgICAgcGFyYW1JbmRleCA9IE1hdGguZmxvb3IocGFyYW1JbmRleCk7CiAgICAgICAgICAgICAgICBjb25zdCBwYXJhbVR5cGUgPSBlZmZlY3RUeXBlLkdldFNoYWRlclByb2dyYW0oKS5HZXRQYXJhbWV0ZXJUeXBlKHBhcmFtSW5kZXgpOwogICAgICAgICAgICAgICAgaWYgKCFwYXJhbVR5cGUpIHJldHVybjsKICAgICAgICAgICAgICAgIGlmIChwYXJhbVR5cGUgPT09ICJjb2xvciIpIHsKICAgICAgICAgICAgICAgICAgICB0ZW1wQ29sb3Iuc2V0RnJvbVJnYlZhbHVlKHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHRlbXBDb2xvcgogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChwYXJhbVR5cGUgPT09ICJwZXJjZW50IikgdmFsdWUgLz0gMTAwOwogICAgICAgICAgICAgICAgY29uc3QgZGlkQ2hhbmdlID0gZWZmZWN0TGlzdC5TZXRFZmZlY3RQYXJhbWV0ZXIoZWZmZWN0VHlwZS5HZXRJbmRleCgpLCBwYXJhbUluZGV4LCB2YWx1ZSk7CiAgICAgICAgICAgICAgICBpZiAoZGlkQ2hhbmdlICYmIGVmZmVjdFR5cGUuSXNBY3RpdmUoKSkgdGhpcy5fcnVudGltZS5VcGRhdGVSZW5kZXIoKQogICAgICAgICAgICB9LAogICAgICAgICAgICBTZXRMYXllckZvcmNlT3duVGV4dHVyZShsYXllciwgZikgewogICAgICAgICAgICAgICAgaWYgKCFsYXllcikgcmV0dXJuOwogICAgICAgICAgICAgICAgbGF5ZXIuU2V0Rm9yY2VPd25UZXh0dXJlKGYpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFNldExheW91dFNjYWxlKHMpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuR2V0Q3VycmVudExheW91dCgpLlNldFNjYWxlKCtzKQogICAgICAgICAgICB9LAogICAgICAgICAgICBTZXRMYXlvdXRBbmdsZShhKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9ydW50aW1lLkdldEN1cnJlbnRMYXlvdXQoKS5TZXRBbmdsZShDMy50b1JhZGlhbnMoK2EpKQogICAgICAgICAgICB9LAogICAgICAgICAgICBTZXRMYXlvdXRFZmZlY3RFbmFibGVkKGVuYWJsZWQsIGVmZmVjdE5hbWUpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGxheW91dCA9IHRoaXMuX3J1bnRpbWUuR2V0Q3VycmVudExheW91dCgpOwogICAgICAgICAgICAgICAgY29uc3QgZWZmZWN0TGlzdCA9IGxheW91dC5HZXRFZmZlY3RMaXN0KCk7CiAgICAgICAgICAgICAgICBjb25zdCBlZmZlY3RUeXBlID0gZWZmZWN0TGlzdC5HZXRFZmZlY3RUeXBlQnlOYW1lKGVmZmVjdE5hbWUpOwogICAgICAgICAgICAgICAgaWYgKCFlZmZlY3RUeXBlKSByZXR1cm47CiAgICAgICAgICAgICAgICBjb25zdCBlID0gZW5hYmxlZCA9PT0gMTsKICAgICAgICAgICAgICAgIGlmIChlZmZlY3RUeXBlLklzQWN0aXZlKCkgPT09IGUpIHJldHVybjsKICAgICAgICAgICAgICAgIGVmZmVjdFR5cGUuU2V0QWN0aXZlKGUpOwogICAgICAgICAgICAgICAgbGF5b3V0LlVwZGF0ZUFjdGl2ZUVmZmVjdHMoKTsKICAgICAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuVXBkYXRlUmVuZGVyKCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgU2V0TGF5b3V0RWZmZWN0UGFyYW0oZWZmZWN0TmFtZSwgcGFyYW1JbmRleCwgdmFsdWUpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGxheW91dCA9IHRoaXMuX3J1bnRpbWUuR2V0Q3VycmVudExheW91dCgpOwogICAgICAgICAgICAgICAgY29uc3QgZWZmZWN0TGlzdCA9IGxheW91dC5HZXRFZmZlY3RMaXN0KCk7CiAgICAgICAgICAgICAgICBjb25zdCBlZmZlY3RUeXBlID0KICAgICAgICAgICAgICAgICAgICBlZmZlY3RMaXN0LkdldEVmZmVjdFR5cGVCeU5hbWUoZWZmZWN0TmFtZSk7CiAgICAgICAgICAgICAgICBpZiAoIWVmZmVjdFR5cGUpIHJldHVybjsKICAgICAgICAgICAgICAgIHBhcmFtSW5kZXggPSBNYXRoLmZsb29yKHBhcmFtSW5kZXgpOwogICAgICAgICAgICAgICAgY29uc3QgcGFyYW1UeXBlID0gZWZmZWN0VHlwZS5HZXRTaGFkZXJQcm9ncmFtKCkuR2V0UGFyYW1ldGVyVHlwZShwYXJhbUluZGV4KTsKICAgICAgICAgICAgICAgIGlmICghcGFyYW1UeXBlKSByZXR1cm47CiAgICAgICAgICAgICAgICBpZiAocGFyYW1UeXBlID09PSAiY29sb3IiKSB7CiAgICAgICAgICAgICAgICAgICAgdGVtcENvbG9yLnNldEZyb21SZ2JWYWx1ZSh2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSB0ZW1wQ29sb3IKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocGFyYW1UeXBlID09PSAicGVyY2VudCIpIHZhbHVlIC89IDEwMDsKICAgICAgICAgICAgICAgIGNvbnN0IGRpZENoYW5nZSA9IGVmZmVjdExpc3QuU2V0RWZmZWN0UGFyYW1ldGVyKGVmZmVjdFR5cGUuR2V0SW5kZXgoKSwgcGFyYW1JbmRleCwgdmFsdWUpOwogICAgICAgICAgICAgICAgaWYgKGRpZENoYW5nZSAmJiBlZmZlY3RUeXBlLklzQWN0aXZlKCkpIHRoaXMuX3J1bnRpbWUuVXBkYXRlUmVuZGVyKCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgU2V0TGF5b3V0VmFuaXNoaW5nUG9pbnQodnBYLCB2cFkpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGxheW91dCA9CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcnVudGltZS5HZXRDdXJyZW50TGF5b3V0KCk7CiAgICAgICAgICAgICAgICBsYXlvdXQuU2V0VmFuaXNoaW5nUG9pbnRYWSh2cFggLyAxMDAsIHZwWSAvIDEwMCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgU2V0TGF5b3V0UHJvamVjdGlvbihwKSB7CiAgICAgICAgICAgICAgICBjb25zdCBsYXlvdXQgPSB0aGlzLl9ydW50aW1lLkdldEN1cnJlbnRMYXlvdXQoKTsKICAgICAgICAgICAgICAgIGlmIChwID09PSAwKSBsYXlvdXQuU2V0UGVyc3BlY3RpdmVQcm9qZWN0aW9uKCk7CiAgICAgICAgICAgICAgICBlbHNlIGxheW91dC5TZXRPcnRob2dyYXBoaWNQcm9qZWN0aW9uKCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgU2Nyb2xsWCh4KSB7CiAgICAgICAgICAgICAgICBjb25zdCBsYXlvdXQgPSB0aGlzLl9ydW50aW1lLkdldEN1cnJlbnRMYXlvdXQoKTsKICAgICAgICAgICAgICAgIGxheW91dC5TZXRTY3JvbGxYKHgpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFNjcm9sbFkoeSkgewogICAgICAgICAgICAgICAgY29uc3QgbGF5b3V0ID0gdGhpcy5fcnVudGltZS5HZXRDdXJyZW50TGF5b3V0KCk7CiAgICAgICAgICAgICAgICBsYXlvdXQuU2V0U2Nyb2xsWSh5KQogICAgICAgICAgICB9LAogICAgICAgICAgICBTY3JvbGwoeCwgeSkgewogICAgICAgICAgICAgICAgY29uc3QgbGF5b3V0ID0gdGhpcy5fcnVudGltZS5HZXRDdXJyZW50TGF5b3V0KCk7CiAgICAgICAgICAgICAgICBsYXlvdXQuU2V0U2Nyb2xsWCh4KTsKICAgICAgICAgICAgICAgIGxheW91dC5TZXRTY3JvbGxZKHkpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFNjcm9sbFRvT2JqZWN0KG9iamVjdENsYXNzKSB7CiAgICAgICAgICAgICAgICBpZiAoIW9iamVjdENsYXNzKSByZXR1cm47CiAgICAgICAgICAgICAgICBjb25zdCBpbnN0ID0gb2JqZWN0Q2xhc3MuR2V0Rmlyc3RQaWNrZWQoKTsKICAgICAgICAgICAgICAgIGlmICghaW5zdCkgcmV0dXJuOwogICAgICAgICAgICAgICAgY29uc3Qgd2kgPSBpbnN0LkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICAgICAgaWYgKCF3aSkgcmV0dXJuOwogICAgICAgICAgICAgICAgY29uc3QgbGF5b3V0ID0gdGhpcy5fcnVudGltZS5HZXRDdXJyZW50TGF5b3V0KCk7CiAgICAgICAgICAgICAgICBsYXlvdXQuU2V0U2Nyb2xsWCh3aS5HZXRYKCkpOwogICAgICAgICAgICAgICAgbGF5b3V0LlNldFNjcm9sbFkod2kuR2V0WSgpKQogICAgICAgICAgICB9LAogICAgICAgICAgICBhc3luYyBMb2FkT2JqZWN0VGV4dHVyZXMob2JqZWN0Q2xhc3MpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGxheW91dCA9IHRoaXMuX3J1bnRpbWUuR2V0TWFpblJ1bm5pbmdMYXlvdXQoKTsKICAgICAgICAgICAgICAgIGlmICghbGF5b3V0IHx8ICFvYmplY3RDbGFzcyB8fCB0aGlzLl9ydW50aW1lLklzTG9hZGluZygpKSByZXR1cm47CiAgICAgICAgICAgICAgICBjb25zdCBvYmplY3RDbGFzc2VzID0gb2JqZWN0Q2xhc3MuSXNGYW1pbHkoKSA/IG9iamVjdENsYXNzLkdldEZhbWlseU1lbWJlcnMoKSA6IFtvYmplY3RDbGFzc107CiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLl9Mb2FkVGV4dHVyZXNGb3JPYmplY3RDbGFzc2VzKGxheW91dCwgb2JqZWN0Q2xhc3NlcykKICAgICAgICAgICAgfSwKICAgICAgICAgICAgYXN5bmMgTG9hZE9iamVjdFRleHR1cmVzQnlOYW1lKG9iamVjdENsYXNzTmFtZSkgewogICAgICAgICAgICAgICAgYXdhaXQgQzMuUGx1Z2lucy5TeXN0ZW0uQWN0cy5Mb2FkT2JqZWN0VGV4dHVyZXMuY2FsbCh0aGlzLCB0aGlzLl9ydW50aW1lLkdldE9iamVjdENsYXNzQnlOYW1lKG9iamVjdENsYXNzTmFtZSkpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFVubG9hZE9iamVjdFRleHR1cmVzKG9iamVjdENsYXNzKSB7CiAgICAgICAgICAgICAgICBjb25zdCBsYXlvdXQgPSB0aGlzLl9ydW50aW1lLkdldE1haW5SdW5uaW5nTGF5b3V0KCk7CiAgICAgICAgICAgICAgICBpZiAoIWxheW91dCB8fCAhb2JqZWN0Q2xhc3MpIHJldHVybjsKICAgICAgICAgICAgICAgIGNvbnN0IG9iamVjdENsYXNzZXMgPSBvYmplY3RDbGFzcy5Jc0ZhbWlseSgpID8gb2JqZWN0Q2xhc3MuR2V0RmFtaWx5TWVtYmVycygpIDogW29iamVjdENsYXNzXTsKICAgICAgICAgICAgICAgIHRoaXMuX1VubG9hZFRleHR1cmVzRm9yT2JqZWN0Q2xhc3NlcyhsYXlvdXQsIG9iamVjdENsYXNzZXMpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFVubG9hZE9iamVjdFRleHR1cmVzQnlOYW1lKG9iamVjdENsYXNzTmFtZSkgewogICAgICAgICAgICAgICAgQzMuUGx1Z2lucy5TeXN0ZW0uQWN0cy5VbmxvYWRPYmplY3RUZXh0dXJlcy5jYWxsKHRoaXMsCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcnVudGltZS5HZXRPYmplY3RDbGFzc0J5TmFtZShvYmplY3RDbGFzc05hbWUpKQogICAgICAgICAgICB9LAogICAgICAgICAgICBVbmxvYWRVbnVzZWRUZXh0dXJlcygpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGxheW91dCA9IHRoaXMuX3J1bnRpbWUuR2V0TWFpblJ1bm5pbmdMYXlvdXQoKTsKICAgICAgICAgICAgICAgIGlmICghbGF5b3V0KSByZXR1cm47CiAgICAgICAgICAgICAgICBjb25zdCBvYmplY3RDbGFzc2VzID0gbGF5b3V0Ll9HZXRUZXh0dXJlTG9hZGVkT2JqZWN0VHlwZXMoKTsKICAgICAgICAgICAgICAgIHRoaXMuX1VubG9hZFRleHR1cmVzRm9yT2JqZWN0Q2xhc3NlcyhsYXlvdXQsIG9iamVjdENsYXNzZXMpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGFzeW5jIExvYWRMYXlvdXRUZXh0dXJlcyhsb2FkTGF5b3V0KSB7CiAgICAgICAgICAgICAgICBjb25zdCBjdXJMYXlvdXQgPSB0aGlzLl9ydW50aW1lLkdldE1haW5SdW5uaW5nTGF5b3V0KCk7CiAgICAgICAgICAgICAgICBpZiAoIWxvYWRMYXlvdXQgfHwgIWN1ckxheW91dCB8fCB0aGlzLl9ydW50aW1lLklzTG9hZGluZygpKSByZXR1cm47CiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLl9Mb2FkVGV4dHVyZXNGb3JPYmplY3RDbGFzc2VzKGN1ckxheW91dCwgbG9hZExheW91dC5fR2V0SW5pdGlhbE9iamVjdENsYXNzZXMoKSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgYXN5bmMgTG9hZExheW91dFRleHR1cmVzQnlOYW1lKGxheW91dE5hbWUpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGN1ckxheW91dCA9IHRoaXMuX3J1bnRpbWUuR2V0TWFpblJ1bm5pbmdMYXlvdXQoKTsKICAgICAgICAgICAgICAgIGNvbnN0IGxvYWRMYXlvdXQgPSB0aGlzLl9ydW50aW1lLkdldExheW91dE1hbmFnZXIoKS5HZXRMYXlvdXRCeU5hbWUobGF5b3V0TmFtZSk7CiAgICAgICAgICAgICAgICBpZiAoIWxvYWRMYXlvdXQgfHwgIWN1ckxheW91dCB8fCB0aGlzLl9ydW50aW1lLklzTG9hZGluZygpKSByZXR1cm47CiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLl9Mb2FkVGV4dHVyZXNGb3JPYmplY3RDbGFzc2VzKGN1ckxheW91dCwgbG9hZExheW91dC5fR2V0SW5pdGlhbE9iamVjdENsYXNzZXMoKSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgU2V0RnVuY3Rpb25SZXR1cm5WYWx1ZSh2KSB7CiAgICAgICAgICAgICAgICBjb25zdCBmcmFtZSA9IHRoaXMuX2V2ZW50U3RhY2suR2V0Q3VycmVudEV4cEZ1bmNTdGFja0ZyYW1lKCk7CiAgICAgICAgICAgICAgICBpZiAoIWZyYW1lKSByZXR1cm47CiAgICAgICAgICAgICAgICBzd2l0Y2ggKGZyYW1lLkdldEZ1bmN0aW9uUmV0dXJuVHlwZSgpKSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHYgPT09ICJudW1iZXIiKSBmcmFtZS5TZXRGdW5jdGlvblJldHVyblZhbHVlKHYpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdiA9PT0gInN0cmluZyIpIGZyYW1lLlNldEZ1bmN0aW9uUmV0dXJuVmFsdWUodik7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgICAgICAgICAgZnJhbWUuU2V0RnVuY3Rpb25SZXR1cm5WYWx1ZSh2KTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgTWFwRnVuY3Rpb24obmFtZSwgc3RyLCBmdW5jdGlvbkJsb2NrKSB7CiAgICAgICAgICAgICAgICBjb25zdCBtYXBFbnRyeSA9IHRoaXMuX0dldEZ1bmN0aW9uTWFwKG5hbWUudG9Mb3dlckNhc2UoKSwgdHJ1ZSk7CiAgICAgICAgICAgICAgICBjb25zdCBzdHJNYXAgPSBtYXBFbnRyeS5zdHJNYXA7CiAgICAgICAgICAgICAgICBjb25zdCBsb3dlclN0ciA9IHN0ci50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgICAgaWYgKHN0ck1hcC5oYXMobG93ZXJTdHIpKSBjb25zb2xlLndhcm4oYFtDb25zdHJ1Y3RdIEZ1bmN0aW9uIG1hcCAnJHtuYW1lfScgc3RyaW5nICcke3N0cn0nIGFscmVhZHkgaW4gbWFwOyBvdmVyd3JpdGluZyBlbnRyeWApOwogICAgICAgICAgICAgICAgY29uc3QgZmlyc3RGdW5jdGlvbkJsb2NrID0gQzMuZmlyc3Qoc3RyTWFwLnZhbHVlcygpKSB8fCBtYXBFbnRyeS5kZWZhdWx0RnVuYzsKICAgICAgICAgICAgICAgIGlmIChmaXJzdEZ1bmN0aW9uQmxvY2spIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBmaXJzdFJldHVybnNWYWx1ZSA9CiAgICAgICAgICAgICAgICAgICAgICAgIGZpcnN0RnVuY3Rpb25CbG9jay5HZXRSZXR1cm5UeXBlKCkgIT09IDA7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VyUmV0dXJuc1ZhbHVlID0gZnVuY3Rpb25CbG9jay5HZXRSZXR1cm5UeXBlKCkgIT09IDA7CiAgICAgICAgICAgICAgICAgICAgaWYgKGZpcnN0UmV0dXJuc1ZhbHVlICE9PSBjdXJSZXR1cm5zVmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihgW0NvbnN0cnVjdF0gRnVuY3Rpb24gbWFwICcke25hbWV9JyBzdHJpbmcgJyR7c3RyfScgZnVuY3Rpb24gcmV0dXJuIHR5cGUgbm90IGNvbXBhdGlibGUgd2l0aCBvdGhlciBmdW5jdGlvbnMgaW4gdGhlIG1hcDsgZW50cnkgaWdub3JlZGApOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzdHJNYXAuc2V0KGxvd2VyU3RyLCBmdW5jdGlvbkJsb2NrKQogICAgICAgICAgICB9LAogICAgICAgICAgICBNYXBGdW5jdGlvbkRlZmF1bHQobmFtZSwgZnVuY3Rpb25CbG9jaykgewogICAgICAgICAgICAgICAgY29uc3QgbWFwRW50cnkgPSB0aGlzLl9HZXRGdW5jdGlvbk1hcChuYW1lLnRvTG93ZXJDYXNlKCksIHRydWUpOwogICAgICAgICAgICAgICAgaWYgKG1hcEVudHJ5LmRlZmF1bHRGdW5jKSBjb25zb2xlLndhcm4oYFtDb25zdHJ1Y3RdIEZ1bmN0aW9uIG1hcCAnJHtuYW1lfScgYWxyZWFkeSBoYXMgYSBkZWZhdWx0OyBvdmVyd3JpdGluZyBlbnRyeWApOwogICAgICAgICAgICAgICAgY29uc3QgZmlyc3RGdW5jdGlvbkJsb2NrID0gQzMuZmlyc3QobWFwRW50cnkuc3RyTWFwLnZhbHVlcygpKSB8fCBtYXBFbnRyeS5kZWZhdWx0RnVuYzsKICAgICAgICAgICAgICAgIGlmIChmaXJzdEZ1bmN0aW9uQmxvY2spIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBmaXJzdFJldHVybnNWYWx1ZSA9IGZpcnN0RnVuY3Rpb25CbG9jay5HZXRSZXR1cm5UeXBlKCkgIT09IDA7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VyUmV0dXJuc1ZhbHVlID0gZnVuY3Rpb25CbG9jay5HZXRSZXR1cm5UeXBlKCkgIT09IDA7CiAgICAgICAgICAgICAgICAgICAgaWYgKGZpcnN0UmV0dXJuc1ZhbHVlICE9PSBjdXJSZXR1cm5zVmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihgW0NvbnN0cnVjdF0gRnVuY3Rpb24gbWFwICcke25hbWV9JyBkZWZhdWx0OiBmdW5jdGlvbiByZXR1cm4gdHlwZSBub3QgY29tcGF0aWJsZSB3aXRoIG90aGVyIGZ1bmN0aW9ucyBpbiB0aGUgbWFwOyBlbnRyeSBpZ25vcmVkYCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIG1hcEVudHJ5LmRlZmF1bHRGdW5jID0gZnVuY3Rpb25CbG9jawogICAgICAgICAgICB9LAogICAgICAgICAgICBDYWxsTWFwcGVkRnVuY3Rpb24obmFtZSwgc3RyLCBmb3J3YXJkUGFyYW1zKSB7CiAgICAgICAgICAgICAgICBmb3J3YXJkUGFyYW1zID0KICAgICAgICAgICAgICAgICAgICBNYXRoLmZsb29yKGZvcndhcmRQYXJhbXMpOwogICAgICAgICAgICAgICAgY29uc3QgbWFwRW50cnkgPSB0aGlzLl9HZXRGdW5jdGlvbk1hcChuYW1lLnRvTG93ZXJDYXNlKCksIGZhbHNlKTsKICAgICAgICAgICAgICAgIGlmICghbWFwRW50cnkpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oYFtDb25zdHJ1Y3RdIENhbGwgbWFwcGVkIGZ1bmN0aW9uOiBtYXAgbmFtZSAnJHtuYW1lfScgbm90IGZvdW5kOyBjYWxsIGlnbm9yZWRgKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGxldCBmdW5jdGlvbkJsb2NrID0gbWFwRW50cnkuc3RyTWFwLmdldChzdHIudG9Mb3dlckNhc2UoKSk7CiAgICAgICAgICAgICAgICBpZiAoIWZ1bmN0aW9uQmxvY2spCiAgICAgICAgICAgICAgICAgICAgaWYgKG1hcEVudHJ5LmRlZmF1bHRGdW5jKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uQmxvY2sgPSBtYXBFbnRyeS5kZWZhdWx0RnVuYzsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yd2FyZFBhcmFtcyA9IDAKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oYFtDb25zdHJ1Y3RdIENhbGwgbWFwcGVkIGZ1bmN0aW9uOiBubyBmdW5jdGlvbiBhc3NvY2lhdGVkIHdpdGggbWFwICcke25hbWV9JyBzdHJpbmcgJyR7c3RyfSc7IGNhbGwgaWdub3JlZCAoY29uc2lkZXIgc2V0dGluZyBhIGRlZmF1bHQpYCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICghZnVuY3Rpb25CbG9jay5Jc0VuYWJsZWQoKSkgcmV0dXJuOwogICAgICAgICAgICAgICAgaWYgKGZ1bmN0aW9uQmxvY2suR2V0UmV0dXJuVHlwZSgpICE9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKGBbQ29uc3RydWN0XSBDYWxsIG1hcHBlZCBmdW5jdGlvbjogbWFwICcke25hbWV9JyBzdHJpbmcgJyR7c3RyfScgaGFzIGEgcmV0dXJuIHR5cGUgc28gY2Fubm90IGJlIGNhbGxlZGApOwogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY29uc3QgcnVudGltZSA9IHRoaXMuX3J1bnRpbWU7CiAgICAgICAgICAgICAgICBjb25zdCBldmVudFNoZWV0TWFuYWdlciA9IHJ1bnRpbWUuR2V0RXZlbnRTaGVldE1hbmFnZXIoKTsKICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRFdmVudCA9IGV2ZW50U2hlZXRNYW5hZ2VyLkdldEN1cnJlbnRFdmVudCgpOwogICAgICAgICAgICAgICAgY29uc3Qgc29sTW9kaWZpZXJzID0gY3VycmVudEV2ZW50LkdldFNvbE1vZGlmaWVyc0luY2x1ZGluZ1BhcmVudHMoKTsKICAgICAgICAgICAgICAgIGNvbnN0IGhhc0FueVNvbE1vZGlmaWVycyA9IHNvbE1vZGlmaWVycy5sZW5ndGggPiAwOwogICAgICAgICAgICAgICAgaWYgKGhhc0FueVNvbE1vZGlmaWVycykKICAgICAgICAgICAgICAgICAgICBpZiAoZnVuY3Rpb25CbG9jay5Jc0NvcHlQaWNrZWQoKSkgZXZlbnRTaGVldE1hbmFnZXIuUHVzaENvcHlTb2woc29sTW9kaWZpZXJzKTsKICAgICAgICAgICAgICAgICAgICBlbHNlIGV2ZW50U2hlZXRNYW5hZ2VyLlB1c2hDbGVhblNvbChzb2xNb2RpZmllcnMpOwogICAgICAgICAgICAgICAgY29uc3QgcGFyYW1SZXN1bHRzID0gW107CiAgICAgICAgICAgICAgICBjb25zdCBjYWxsZXJGdW5jdGlvbkJsb2NrID0gZXZlbnRTaGVldE1hbmFnZXIuRmluZEZpcnN0RnVuY3Rpb25CbG9ja1BhcmVudChjdXJyZW50RXZlbnQpOwogICAgICAgICAgICAgICAgaWYgKGNhbGxlckZ1bmN0aW9uQmxvY2spIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBjYWxsZXJQYXJhbWV0ZXJzID0gY2FsbGVyRnVuY3Rpb25CbG9jay5HZXRGdW5jdGlvblBhcmFtZXRlcnMoKTsKICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gZm9yd2FyZFBhcmFtcywgbGVuID0gY2FsbGVyUGFyYW1ldGVycy5sZW5ndGg7IGkgPCBsZW47ICsraSkgcGFyYW1SZXN1bHRzLnB1c2goY2FsbGVyUGFyYW1ldGVyc1tpXS5HZXRWYWx1ZSgpKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY29uc3QgY2FsbGVlUGFyYW1ldGVycyA9IGZ1bmN0aW9uQmxvY2suR2V0RnVuY3Rpb25QYXJhbWV0ZXJzKCk7CiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gcGFyYW1SZXN1bHRzLmxlbmd0aCwgbGVuID0gY2FsbGVlUGFyYW1ldGVycy5sZW5ndGg7IGkgPCBsZW47ICsraSkgcGFyYW1SZXN1bHRzLnB1c2goY2FsbGVlUGFyYW1ldGVyc1tpXS5HZXRJbml0aWFsVmFsdWUoKSk7CiAgICAgICAgICAgICAgICBpZiAocnVudGltZS5Jc0RlYnVnZ2luZygpKSByZXR1cm4gdGhpcy5fRGVidWdEb0NhbGxNYXBwZWRGdW5jdGlvbihldmVudFNoZWV0TWFuYWdlciwgZnVuY3Rpb25CbG9jaywgcGFyYW1SZXN1bHRzLCBoYXNBbnlTb2xNb2RpZmllcnMsIHNvbE1vZGlmaWVycyk7CiAgICAgICAgICAgICAgICBlbHNlIHJldHVybiB0aGlzLl9Eb0NhbGxNYXBwZWRGdW5jdGlvbihldmVudFNoZWV0TWFuYWdlciwgZnVuY3Rpb25CbG9jaywgcGFyYW1SZXN1bHRzLCBoYXNBbnlTb2xNb2RpZmllcnMsIHNvbE1vZGlmaWVycykKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gewogICAgICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgICAgICBDMy5QbHVnaW5zLlN5c3RlbS5FeHBzID0gewogICAgICAgICAgICBpbnQ6IGZ1bmN0aW9uKHgpIHsKICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgeCA9PT0gInN0cmluZyIpIHsKICAgICAgICAgICAgICAgICAgICB4ID0gcGFyc2VJbnQoeCwgMTApOwogICAgICAgICAgICAgICAgICAgIGlmIChpc05hTih4KSkgeCA9IDAKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBNYXRoLmZsb29yKHgpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGZsb2F0OiBmdW5jdGlvbih4KSB7CiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHggPT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgICAgICAgICAgeCA9IHBhcnNlRmxvYXQoeCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTmFOKHgpKSB4ID0gMAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHgKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc3RyKHgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB4LnRvU3RyaW5nKCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgbGVuKHgpIHsKICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgeCA9PT0gInN0cmluZyIpIHJldHVybiB4Lmxlbmd0aDsKICAgICAgICAgICAgICAgIGVsc2UgcmV0dXJuIDAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgcmFuZG9tKGEsIGIpIHsKICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgYiA9PT0gInVuZGVmaW5lZCIpIHJldHVybiB0aGlzLl9ydW50aW1lLlJhbmRvbSgpICogYTsKICAgICAgICAgICAgICAgIGVsc2UgcmV0dXJuIHRoaXMuX3J1bnRpbWUuUmFuZG9tKCkgKiAoYiAtIGEpICsgYQogICAgICAgICAgICB9LAogICAgICAgICAgICBjaG9vc2UoLi4uYXJncykgewogICAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSBNYXRoLmZsb29yKHRoaXMuX3J1bnRpbWUuUmFuZG9tKCkgKiBhcmdzLmxlbmd0aCk7CiAgICAgICAgICAgICAgICByZXR1cm4gYXJnc1tpbmRleF0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgY2hvb3NlaW5kZXgoaW5kZXgsIC4uLmFyZ3MpIHsKICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgaW5kZXggIT09ICJudW1iZXIiKSBpbmRleCA9IDA7CiAgICAgICAgICAgICAgICBpbmRleCA9IEMzLmNsYW1wKE1hdGguZmxvb3IoaW5kZXgpLCAwLCBhcmdzLmxlbmd0aCAtIDEpOwogICAgICAgICAgICAgICAgcmV0dXJuIGFyZ3NbaW5kZXhdCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHBpKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIE1hdGguUEkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgaW5maW5pdHkoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gSW5maW5pdHkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc3FydCh2KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gTWF0aC5zcXJ0KHYpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGFicyh2KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gTWF0aC5hYnModikKICAgICAgICAgICAgfSwKICAgICAgICAgICAgcm91bmQodikgewogICAgICAgICAgICAgICAgcmV0dXJuIE1hdGgucm91bmQodikKICAgICAgICAgICAgfSwKICAgICAgICAgICAgcm91bmR0b2RwKHYsIGRwKSB7CiAgICAgICAgICAgICAgICBkcCA9IE1hdGgubWF4KE1hdGguZmxvb3IoZHApLCAwKTsKICAgICAgICAgICAgICAgIGNvbnN0IG0gPSBNYXRoLnBvdygxMCwgZHApOwogICAgICAgICAgICAgICAgcmV0dXJuIE1hdGgucm91bmQoKHYgKyBOdW1iZXIuRVBTSUxPTikgKiBtKSAvIG0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgZmxvb3IodikgewogICAgICAgICAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IodikKICAgICAgICAgICAgfSwKICAgICAgICAgICAgY2VpbCh2KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gTWF0aC5jZWlsKHYpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNpZ24odikgewogICAgICAgICAgICAgICAgcmV0dXJuIE1hdGguc2lnbih2KQogICAgICAgICAgICB9LAogICAgICAgICAgICBzaW4oeCkgewogICAgICAgICAgICAgICAgcmV0dXJuIE1hdGguc2luKEMzLnRvUmFkaWFucyh4KSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgY29zKHgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBNYXRoLmNvcyhDMy50b1JhZGlhbnMoeCkpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHRhbih4KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gTWF0aC50YW4oQzMudG9SYWRpYW5zKHgpKQogICAgICAgICAgICB9LAogICAgICAgICAgICBhc2luKHgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBDMy50b0RlZ3JlZXMoTWF0aC5hc2luKHgpKQogICAgICAgICAgICB9LAogICAgICAgICAgICBhY29zKHgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBDMy50b0RlZ3JlZXMoTWF0aC5hY29zKHgpKQogICAgICAgICAgICB9LAogICAgICAgICAgICBhdGFuKHgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBDMy50b0RlZ3JlZXMoTWF0aC5hdGFuKHgpKQogICAgICAgICAgICB9LAogICAgICAgICAgICBleHAoeCkgewogICAgICAgICAgICAgICAgcmV0dXJuIE1hdGguZXhwKHgpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGxuKHgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBNYXRoLmxvZyh4KQogICAgICAgICAgICB9LAogICAgICAgICAgICBsb2cxMCh4KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gTWF0aC5sb2coeCkgLyBNYXRoLkxOMTAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgbWF4KC4uLmFyZ3MpIHsKICAgICAgICAgICAgICAgIGxldCByZXQgPSBhcmdzWzBdOwogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiByZXQgIT09ICJudW1iZXIiKSByZXQgPSAwOwogICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDEsIGxlbiA9IGFyZ3MubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHsKICAgICAgICAgICAgICAgICAgICBsZXQgbiA9IGFyZ3NbaV07CiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBuICE9PSAibnVtYmVyIikgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJldCA8IG4pIHJldCA9IG4KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiByZXQKICAgICAgICAgICAgfSwKICAgICAgICAgICAgbWluKC4uLmFyZ3MpIHsKICAgICAgICAgICAgICAgIGxldCByZXQgPSBhcmdzWzBdOwogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiByZXQgIT09ICJudW1iZXIiKSByZXQgPSAwOwogICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDEsIGxlbiA9IGFyZ3MubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHsKICAgICAgICAgICAgICAgICAgICBsZXQgbiA9IGFyZ3NbaV07CiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBuICE9PSAibnVtYmVyIikgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJldCA+IG4pIHJldCA9IG4KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiByZXQKICAgICAgICAgICAgfSwKICAgICAgICAgICAgY2xhbXAoeCwgbCwgdSkgewogICAgICAgICAgICAgICAgcmV0dXJuIEMzLmNsYW1wKHgsIGwsIHUpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGRpc3RhbmNlKHgxLCB5MSwgeDIsIHkyKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gQzMuZGlzdGFuY2VUbyh4MSwgeTEsIHgyLCB5MikKICAgICAgICAgICAgfSwKICAgICAgICAgICAgYW5nbGUoeDEsIHkxLCB4MiwgeTIpIHsKICAgICAgICAgICAgICAgIHJldHVybiBDMy50b0RlZ3JlZXMoQzMuYW5nbGVUbyh4MSwgeTEsIHgyLCB5MikpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGxlcnAoYSwgYiwgeCkgewogICAgICAgICAgICAgICAgcmV0dXJuIEMzLmxlcnAoYSwgYiwgeCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgdW5sZXJwKGEsIGIsIHkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBDMy51bmxlcnAoYSwgYiwgeSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgcWFycChhLCBiLCBjLCB4KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gQzMucWFycChhLCBiLCBjLCB4KQogICAgICAgICAgICB9LAogICAgICAgICAgICBjdWJpYyhhLCBiLCBjLCBkLCB4KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gQzMuY3ViaWMoYSwgYiwgYywgZCwgeCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgY29zcChhLCBiLCB4KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gQzMuY29zcChhLCBiLCB4KQogICAgICAgICAgICB9LAogICAgICAgICAgICBhbmdsZWRpZmYoYSwKICAgICAgICAgICAgICAgIGIpIHsKICAgICAgICAgICAgICAgIHJldHVybiBDMy50b0RlZ3JlZXMoQzMuYW5nbGVEaWZmKEMzLnRvUmFkaWFucyhhKSwgQzMudG9SYWRpYW5zKGIpKSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgYW5nbGVsZXJwKGEsIGIsIHgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBDMy50b0RlZ3JlZXMoQzMuYW5nbGVMZXJwKEMzLnRvUmFkaWFucyhhKSwgQzMudG9SYWRpYW5zKGIpLCB4KSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgYW5nbGVyb3RhdGUoYSwgYiwgYykgewogICAgICAgICAgICAgICAgcmV0dXJuIEMzLnRvRGVncmVlcyhDMy5hbmdsZVJvdGF0ZShDMy50b1JhZGlhbnMoYSksIEMzLnRvUmFkaWFucyhiKSwgQzMudG9SYWRpYW5zKGMpKSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2V0Yml0KG4sIGIsIHYpIHsKICAgICAgICAgICAgICAgIG4gPSBuIHwgMDsKICAgICAgICAgICAgICAgIGIgPSBiIHwgMDsKICAgICAgICAgICAgICAgIHYgPSB2ICE9PSAwID8gMSA6IDA7CiAgICAgICAgICAgICAgICByZXR1cm4gbiAmIH4oMSA8PCBiKSB8IHYgPDwgYgogICAgICAgICAgICB9LAogICAgICAgICAgICB0b2dnbGViaXQobiwgYikgewogICAgICAgICAgICAgICAgbiA9IG4gfCAwOwogICAgICAgICAgICAgICAgYiA9IGIgfCAwOwogICAgICAgICAgICAgICAgcmV0dXJuIG4gXiAxIDw8IGIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZ2V0Yml0KG4sIGIpIHsKICAgICAgICAgICAgICAgIG4gPSBuIHwgMDsKICAgICAgICAgICAgICAgIGIgPSBiIHwgMDsKICAgICAgICAgICAgICAgIHJldHVybiBuICYgMSA8PCBiID8gMSA6IDAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgbmV3bGluZSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiAiXG4iCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHVwcGVyY2FzZShzKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHlwZW9mIHMgPT09ICJzdHJpbmciID8gcy50b1VwcGVyQ2FzZSgpIDogIiIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgbG93ZXJjYXNlKHMpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0eXBlb2YgcyA9PT0KICAgICAgICAgICAgICAgICAgICAic3RyaW5nIiA/IHMudG9Mb3dlckNhc2UoKSA6ICIiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGxlZnQodGV4dCwgbikgewogICAgICAgICAgICAgICAgcmV0dXJuIHR5cGVvZiB0ZXh0ID09PSAic3RyaW5nIiA/IHRleHQuc3Vic3RyKDAsIG4pIDogIiIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgbWlkKHRleHQsIGluZGV4LCBjb3VudCkgewogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB0ZXh0ICE9PSAic3RyaW5nIikgcmV0dXJuICIiOwogICAgICAgICAgICAgICAgaWYgKGNvdW50IDwgMCkgcmV0dXJuIHRleHQuc3Vic3RyKGluZGV4KTsKICAgICAgICAgICAgICAgIGVsc2UgcmV0dXJuIHRleHQuc3Vic3RyKGluZGV4LCBjb3VudCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgcmlnaHQodGV4dCwgbikgewogICAgICAgICAgICAgICAgcmV0dXJuIHR5cGVvZiB0ZXh0ID09PSAic3RyaW5nIiA/IHRleHQuc3Vic3RyKE1hdGgubWF4KHRleHQubGVuZ3RoIC0gbiwgMCkpIDogIiIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgdHJpbSh0ZXh0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHlwZW9mIHRleHQgPT09ICJzdHJpbmciID8gdGV4dC50cmltKCkgOiAiIgogICAgICAgICAgICB9LAogICAgICAgICAgICB0b2tlbmF0KHRleHQsIGluZGV4LCBzZXApIHsKICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdGV4dCAhPT0gInN0cmluZyIgfHwgdHlwZW9mIHNlcCAhPT0gInN0cmluZyIpIHJldHVybiAiIjsKICAgICAgICAgICAgICAgIGxldCBhcnIgPSB0ZXh0LnNwbGl0KHNlcCk7CiAgICAgICAgICAgICAgICBpbmRleCA9IE1hdGguZmxvb3IoaW5kZXgpOwogICAgICAgICAgICAgICAgaWYgKGluZGV4IDwKICAgICAgICAgICAgICAgICAgICAwIHx8IGluZGV4ID49IGFyci5sZW5ndGgpIHJldHVybiAiIjsKICAgICAgICAgICAgICAgIHJldHVybiBhcnJbaW5kZXhdCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHRva2VuY291bnQodGV4dCwgc2VwKSB7CiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHRleHQgIT09ICJzdHJpbmciIHx8IHR5cGVvZiBzZXAgIT09ICJzdHJpbmciIHx8ICF0ZXh0Lmxlbmd0aCkgcmV0dXJuIDA7CiAgICAgICAgICAgICAgICByZXR1cm4gdGV4dC5zcGxpdChzZXApLmxlbmd0aAogICAgICAgICAgICB9LAogICAgICAgICAgICBmaW5kKHRleHQsIHNlYXJjaFN0cikgewogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB0ZXh0ID09PSAic3RyaW5nIiAmJiB0eXBlb2Ygc2VhcmNoU3RyID09PSAic3RyaW5nIikgcmV0dXJuIHRleHQuc2VhcmNoKG5ldyBSZWdFeHAoQzMuRXNjYXBlUmVnZXgoc2VhcmNoU3RyKSwgImkiKSk7CiAgICAgICAgICAgICAgICBlbHNlIHJldHVybiAtMQogICAgICAgICAgICB9LAogICAgICAgICAgICBmaW5kY2FzZSh0ZXh0LCBzZWFyY2hTdHIpIHsKICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdGV4dCA9PT0gInN0cmluZyIgJiYgdHlwZW9mIHNlYXJjaFN0ciA9PT0gInN0cmluZyIpIHJldHVybiB0ZXh0LnNlYXJjaChuZXcgUmVnRXhwKEMzLkVzY2FwZVJlZ2V4KHNlYXJjaFN0ciksICIiKSk7CiAgICAgICAgICAgICAgICBlbHNlIHJldHVybiAtMQogICAgICAgICAgICB9LAogICAgICAgICAgICByZXBsYWNlKHRleHQsIGZpbmQsIHJlcGxhY2UpIHsKICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdGV4dCA9PT0KICAgICAgICAgICAgICAgICAgICAic3RyaW5nIiAmJiB0eXBlb2YgZmluZCA9PT0gInN0cmluZyIgJiYgdHlwZW9mIHJlcGxhY2UgPT09ICJzdHJpbmciKSByZXR1cm4gdGV4dC5yZXBsYWNlKG5ldyBSZWdFeHAoQzMuRXNjYXBlUmVnZXgoZmluZCksICJnaSIpLCByZXBsYWNlKTsKICAgICAgICAgICAgICAgIGVsc2UgcmV0dXJuIHR5cGVvZiB0ZXh0ID09PSAic3RyaW5nIiA/IHRleHQgOiAiIgogICAgICAgICAgICB9LAogICAgICAgICAgICByZWdleHNlYXJjaCh0ZXh0LCByZWdleCwgZmxhZ3MpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGNhY2hlUmVnZXggPSB0aGlzLkdldFJlZ2V4KHJlZ2V4LCBmbGFncyk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGV4dCA/IHRleHQuc2VhcmNoKGNhY2hlUmVnZXgpIDogLTEKICAgICAgICAgICAgfSwKICAgICAgICAgICAgcmVnZXhyZXBsYWNlKHRleHQsIHJlZ2V4LCBmbGFncywgcmVwbGFjZSkgewogICAgICAgICAgICAgICAgY29uc3QgY2FjaGVSZWdleCA9IHRoaXMuR2V0UmVnZXgocmVnZXgsIGZsYWdzKTsKICAgICAgICAgICAgICAgIHJldHVybiB0ZXh0ID8gdGV4dC5yZXBsYWNlKGNhY2hlUmVnZXgsIHJlcGxhY2UpIDogIiIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgcmVnZXhtYXRjaGNvdW50KHRleHQsIHJlZ2V4LCBmbGFncykgewogICAgICAgICAgICAgICAgY29uc3QgbWF0Y2hlcyA9IHRoaXMuR2V0UmVnZXhNYXRjaGVzKHRleHQudG9TdHJpbmcoKSwKICAgICAgICAgICAgICAgICAgICByZWdleCwgZmxhZ3MpOwogICAgICAgICAgICAgICAgcmV0dXJuIG1hdGNoZXMgPyBtYXRjaGVzLmxlbmd0aCA6IDAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgcmVnZXhtYXRjaGF0KHRleHQsIHJlZ2V4LCBmbGFncywgaW5kZXgpIHsKICAgICAgICAgICAgICAgIGluZGV4ID0gTWF0aC5mbG9vcihpbmRleCk7CiAgICAgICAgICAgICAgICBjb25zdCBtYXRjaGVzID0gdGhpcy5HZXRSZWdleE1hdGNoZXModGV4dC50b1N0cmluZygpLCByZWdleCwgZmxhZ3MpOwogICAgICAgICAgICAgICAgaWYgKCFtYXRjaGVzIHx8IGluZGV4IDwgMCB8fCBpbmRleCA+PSBtYXRjaGVzLmxlbmd0aCkgcmV0dXJuICIiOwogICAgICAgICAgICAgICAgZWxzZSByZXR1cm4gbWF0Y2hlc1tpbmRleF0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgemVyb3BhZChuLCBkKSB7CiAgICAgICAgICAgICAgICBsZXQgcyA9IG4gPCAwID8gIi0iIDogIiI7CiAgICAgICAgICAgICAgICBpZiAobiA8IDApIG4gPSAtbjsKICAgICAgICAgICAgICAgIGNvbnN0IHplcm9lcyA9IGQgLSBuLnRvU3RyaW5nKCkubGVuZ3RoOwogICAgICAgICAgICAgICAgcyArPSAiMCIucmVwZWF0KE1hdGgubWF4KHplcm9lcywgMCkpOwogICAgICAgICAgICAgICAgcmV0dXJuIHMgKyBuLnRvU3RyaW5nKCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgdXJsZW5jb2RlKHMpIHsKICAgICAgICAgICAgICAgIHJldHVybiBlbmNvZGVVUklDb21wb25lbnQocykKICAgICAgICAgICAgfSwKICAgICAgICAgICAgdXJsZGVjb2RlKHMpIHsKICAgICAgICAgICAgICAgIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQocykKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZHQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcnVudGltZS5fR2V0RHRGYXN0KCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgdGltZXNjYWxlKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUuR2V0VGltZVNjYWxlKCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgd2FsbGNsb2NrdGltZSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiAoRGF0ZS5ub3coKSAtIHRoaXMuX3J1bnRpbWUuR2V0U3RhcnRUaW1lKCkpIC8gMUUzCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHVuaXh0aW1lKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIERhdGUubm93KCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgdGltZSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lLkdldEdhbWVUaW1lKCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgdGlja2NvdW50KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUuR2V0VGlja0NvdW50KCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgb2JqZWN0Y291bnQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcnVudGltZS5HZXRPYmplY3RDb3VudCgpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGZwcygpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lLkdldEZQUygpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNwdXV0aWxpc2F0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUuR2V0TWFpblRocmVhZFRpbWUoKQogICAgICAgICAgICB9LAogICAgICAgICAgICBncHV1dGlsaXNhdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lLkdldEdQVVV0aWxpc2F0aW9uKCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgd2luZG93d2lkdGgoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcnVudGltZS5HZXRDYW52YXNNYW5hZ2VyKCkuR2V0RGV2aWNlV2lkdGgoKQogICAgICAgICAgICB9LAogICAgICAgICAgICB3aW5kb3doZWlnaHQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcnVudGltZS5HZXRDYW52YXNNYW5hZ2VyKCkuR2V0RGV2aWNlSGVpZ2h0KCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgb3JpZ2luYWx3aW5kb3d3aWR0aCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lLkdldE9yaWdpbmFsVmlld3BvcnRXaWR0aCgpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG9yaWdpbmFsd2luZG93aGVpZ2h0KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUuR2V0T3JpZ2luYWxWaWV3cG9ydEhlaWdodCgpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG9yaWdpbmFsdmlld3BvcnR3aWR0aCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lLkdldE9yaWdpbmFsVmlld3BvcnRXaWR0aCgpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG9yaWdpbmFsdmlld3BvcnRoZWlnaHQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcnVudGltZS5HZXRPcmlnaW5hbFZpZXdwb3J0SGVpZ2h0KCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2Nyb2xseCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lLkdldEN1cnJlbnRMYXlvdXQoKS5HZXRTY3JvbGxYKCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2Nyb2xseSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lLkdldEN1cnJlbnRMYXlvdXQoKS5HZXRTY3JvbGxZKCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgbGF5b3V0bmFtZSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lLkdldEN1cnJlbnRMYXlvdXQoKS5HZXROYW1lKCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgbGF5b3V0c2NhbGUoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcnVudGltZS5HZXRDdXJyZW50TGF5b3V0KCkuR2V0U2NhbGUoKQogICAgICAgICAgICB9LAogICAgICAgICAgICBsYXlvdXRhbmdsZSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBDMy50b0RlZ3JlZXModGhpcy5fcnVudGltZS5HZXRDdXJyZW50TGF5b3V0KCkuR2V0QW5nbGUoKSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgbGF5b3V0d2lkdGgoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcnVudGltZS5HZXRDdXJyZW50TGF5b3V0KCkuR2V0V2lkdGgoKQogICAgICAgICAgICB9LAogICAgICAgICAgICBsYXlvdXRoZWlnaHQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcnVudGltZS5HZXRDdXJyZW50TGF5b3V0KCkuR2V0SGVpZ2h0KCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgdmFuaXNoaW5ncG9pbnR4KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUuR2V0Q3VycmVudExheW91dCgpLkdldFZhbmlzaGluZ1BvaW50WCgpICogMTAwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHZhbmlzaGluZ3BvaW50eSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lLkdldEN1cnJlbnRMYXlvdXQoKS5HZXRWYW5pc2hpbmdQb2ludFkoKSAqIDEwMAogICAgICAgICAgICB9LAogICAgICAgICAgICB2aWV3cG9ydGxlZnQobGF5ZXJQYXJhbSkgewogICAgICAgICAgICAgICAgY29uc3QgbGF5ZXIgPSB0aGlzLl9ydW50aW1lLkdldEN1cnJlbnRMYXlvdXQoKS5HZXRMYXllcihsYXllclBhcmFtKTsKICAgICAgICAgICAgICAgIHJldHVybiBsYXllciA/IGxheWVyLkdldFZpZXdwb3J0M0QoKS5nZXRMZWZ0KCkgOiAwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHZpZXdwb3J0dG9wKGxheWVyUGFyYW0pIHsKICAgICAgICAgICAgICAgIGNvbnN0IGxheWVyID0gdGhpcy5fcnVudGltZS5HZXRDdXJyZW50TGF5b3V0KCkuR2V0TGF5ZXIobGF5ZXJQYXJhbSk7CiAgICAgICAgICAgICAgICByZXR1cm4gbGF5ZXIgPyBsYXllci5HZXRWaWV3cG9ydDNEKCkuZ2V0VG9wKCkgOiAwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHZpZXdwb3J0cmlnaHQobGF5ZXJQYXJhbSkgewogICAgICAgICAgICAgICAgY29uc3QgbGF5ZXIgPSB0aGlzLl9ydW50aW1lLkdldEN1cnJlbnRMYXlvdXQoKS5HZXRMYXllcihsYXllclBhcmFtKTsKICAgICAgICAgICAgICAgIHJldHVybiBsYXllciA/IGxheWVyLkdldFZpZXdwb3J0M0QoKS5nZXRSaWdodCgpIDogMAogICAgICAgICAgICB9LAogICAgICAgICAgICB2aWV3cG9ydGJvdHRvbShsYXllclBhcmFtKSB7CiAgICAgICAgICAgICAgICBjb25zdCBsYXllciA9IHRoaXMuX3J1bnRpbWUuR2V0Q3VycmVudExheW91dCgpLkdldExheWVyKGxheWVyUGFyYW0pOwogICAgICAgICAgICAgICAgcmV0dXJuIGxheWVyID8gbGF5ZXIuR2V0Vmlld3BvcnQzRCgpLmdldEJvdHRvbSgpIDogMAogICAgICAgICAgICB9LAogICAgICAgICAgICB2aWV3cG9ydHdpZHRoKGxheWVyUGFyYW0pIHsKICAgICAgICAgICAgICAgIGNvbnN0IGxheWVyID0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9ydW50aW1lLkdldEN1cnJlbnRMYXlvdXQoKS5HZXRMYXllcihsYXllclBhcmFtKTsKICAgICAgICAgICAgICAgIHJldHVybiBsYXllciA/IGxheWVyLkdldFZpZXdwb3J0M0QoKS53aWR0aCgpIDogMAogICAgICAgICAgICB9LAogICAgICAgICAgICB2aWV3cG9ydGhlaWdodChsYXllclBhcmFtKSB7CiAgICAgICAgICAgICAgICBjb25zdCBsYXllciA9IHRoaXMuX3J1bnRpbWUuR2V0Q3VycmVudExheW91dCgpLkdldExheWVyKGxheWVyUGFyYW0pOwogICAgICAgICAgICAgICAgcmV0dXJuIGxheWVyID8gbGF5ZXIuR2V0Vmlld3BvcnQzRCgpLmhlaWdodCgpIDogMAogICAgICAgICAgICB9LAogICAgICAgICAgICB2aWV3cG9ydG1pZHgobGF5ZXJQYXJhbSkgewogICAgICAgICAgICAgICAgY29uc3QgbGF5ZXIgPSB0aGlzLl9ydW50aW1lLkdldEN1cnJlbnRMYXlvdXQoKS5HZXRMYXllcihsYXllclBhcmFtKTsKICAgICAgICAgICAgICAgIGlmIChsYXllcikgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHZwID0gbGF5ZXIuR2V0Vmlld3BvcnQzRCgpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiAodnAuZ2V0TGVmdCgpICsgdnAuZ2V0UmlnaHQoKSkgLyAyCiAgICAgICAgICAgICAgICB9IGVsc2UgcmV0dXJuIDAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgdmlld3BvcnRtaWR5KGxheWVyUGFyYW0pIHsKICAgICAgICAgICAgICAgIGNvbnN0IGxheWVyID0gdGhpcy5fcnVudGltZS5HZXRDdXJyZW50TGF5b3V0KCkuR2V0TGF5ZXIobGF5ZXJQYXJhbSk7CiAgICAgICAgICAgICAgICBpZiAobGF5ZXIpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCB2cCA9IGxheWVyLkdldFZpZXdwb3J0M0QoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gKHZwLmdldFRvcCgpICsgdnAuZ2V0Qm90dG9tKCkpIC8gMgogICAgICAgICAgICAgICAgfSBlbHNlIHJldHVybiAwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNhbnZhc3RvbGF5ZXJ4KGxheWVyUGFyYW0sIHgsIHkpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGxheWVyID0gdGhpcy5fcnVudGltZS5HZXRDdXJyZW50TGF5b3V0KCkuR2V0TGF5ZXIobGF5ZXJQYXJhbSk7CiAgICAgICAgICAgICAgICByZXR1cm4gbGF5ZXIgPyBsYXllci5DYW52YXNDc3NUb0xheWVyKHgsIHkpWzBdIDogMAogICAgICAgICAgICB9LAogICAgICAgICAgICBjYW52YXN0b2xheWVyeShsYXllclBhcmFtLCB4LCB5KSB7CiAgICAgICAgICAgICAgICBjb25zdCBsYXllciA9IHRoaXMuX3J1bnRpbWUuR2V0Q3VycmVudExheW91dCgpLkdldExheWVyKGxheWVyUGFyYW0pOwogICAgICAgICAgICAgICAgcmV0dXJuIGxheWVyID8gbGF5ZXIuQ2FudmFzQ3NzVG9MYXllcih4LCB5KVsxXSA6IDAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgbGF5ZXJ0b2NhbnZhc3gobGF5ZXJQYXJhbSwgeCwgeSkgewogICAgICAgICAgICAgICAgY29uc3QgbGF5ZXIgPSB0aGlzLl9ydW50aW1lLkdldEN1cnJlbnRMYXlvdXQoKS5HZXRMYXllcihsYXllclBhcmFtKTsKICAgICAgICAgICAgICAgIHJldHVybiBsYXllciA/IGxheWVyLkxheWVyVG9DYW52YXNDc3MoeCwKICAgICAgICAgICAgICAgICAgICB5KVswXSA6IDAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgbGF5ZXJ0b2NhbnZhc3kobGF5ZXJQYXJhbSwgeCwgeSkgewogICAgICAgICAgICAgICAgY29uc3QgbGF5ZXIgPSB0aGlzLl9ydW50aW1lLkdldEN1cnJlbnRMYXlvdXQoKS5HZXRMYXllcihsYXllclBhcmFtKTsKICAgICAgICAgICAgICAgIHJldHVybiBsYXllciA/IGxheWVyLkxheWVyVG9DYW52YXNDc3MoeCwgeSlbMV0gOiAwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGxheWVydG9sYXllcngoZnJvbUxheWVyUGFyYW0sIHRvTGF5ZXJQYXJhbSwgeCwgeSkgewogICAgICAgICAgICAgICAgY29uc3QgbGF5b3V0ID0gdGhpcy5fcnVudGltZS5HZXRDdXJyZW50TGF5b3V0KCk7CiAgICAgICAgICAgICAgICBjb25zdCBmcm9tTGF5ZXIgPSBsYXlvdXQuR2V0TGF5ZXIoZnJvbUxheWVyUGFyYW0pOwogICAgICAgICAgICAgICAgY29uc3QgdG9MYXllciA9IGxheW91dC5HZXRMYXllcih0b0xheWVyUGFyYW0pOwogICAgICAgICAgICAgICAgaWYgKCFmcm9tTGF5ZXIgfHwgIXRvTGF5ZXIgfHwgZnJvbUxheWVyID09PSB0b0xheWVyKSByZXR1cm4geDsKICAgICAgICAgICAgICAgIGNvbnN0IFtjYW52YXNYLCBjYW52YXNZXSA9IGZyb21MYXllci5MYXllclRvQ2FudmFzQ3NzKHgsIHkpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRvTGF5ZXIuQ2FudmFzQ3NzVG9MYXllcihjYW52YXNYLCBjYW52YXNZKVswXQogICAgICAgICAgICB9LAogICAgICAgICAgICBsYXllcnRvbGF5ZXJ5KGZyb21MYXllclBhcmFtLCB0b0xheWVyUGFyYW0sIHgsIHkpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGxheW91dCA9IHRoaXMuX3J1bnRpbWUuR2V0Q3VycmVudExheW91dCgpOwogICAgICAgICAgICAgICAgY29uc3QgZnJvbUxheWVyID0gbGF5b3V0LkdldExheWVyKGZyb21MYXllclBhcmFtKTsKICAgICAgICAgICAgICAgIGNvbnN0IHRvTGF5ZXIgPSBsYXlvdXQuR2V0TGF5ZXIodG9MYXllclBhcmFtKTsKICAgICAgICAgICAgICAgIGlmICghZnJvbUxheWVyIHx8ICF0b0xheWVyIHx8IGZyb21MYXllciA9PT0gdG9MYXllcikgcmV0dXJuIHk7CiAgICAgICAgICAgICAgICBjb25zdCBbY2FudmFzWCwgY2FudmFzWV0gPSBmcm9tTGF5ZXIuTGF5ZXJUb0NhbnZhc0Nzcyh4LCB5KTsKICAgICAgICAgICAgICAgIHJldHVybiB0b0xheWVyLkNhbnZhc0Nzc1RvTGF5ZXIoY2FudmFzWCwgY2FudmFzWSlbMV0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgbGF5ZXJzY2FsZShsYXllclBhcmFtKSB7CiAgICAgICAgICAgICAgICBjb25zdCBsYXllciA9IHRoaXMuX3J1bnRpbWUuR2V0Q3VycmVudExheW91dCgpLkdldExheWVyKGxheWVyUGFyYW0pOwogICAgICAgICAgICAgICAgcmV0dXJuIGxheWVyID8gbGF5ZXIuR2V0T3duU2NhbGUoKSA6IDAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgbGF5ZXJhbmdsZShsYXllclBhcmFtKSB7CiAgICAgICAgICAgICAgICBjb25zdCBsYXllciA9CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcnVudGltZS5HZXRDdXJyZW50TGF5b3V0KCkuR2V0TGF5ZXIobGF5ZXJQYXJhbSk7CiAgICAgICAgICAgICAgICByZXR1cm4gbGF5ZXIgPyBDMy50b0RlZ3JlZXMobGF5ZXIuR2V0T3duQW5nbGUoKSkgOiAwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGxheWVyb3BhY2l0eShsYXllclBhcmFtKSB7CiAgICAgICAgICAgICAgICBjb25zdCBsYXllciA9IHRoaXMuX3J1bnRpbWUuR2V0Q3VycmVudExheW91dCgpLkdldExheWVyKGxheWVyUGFyYW0pOwogICAgICAgICAgICAgICAgcmV0dXJuIGxheWVyID8gbGF5ZXIuR2V0T3BhY2l0eSgpICogMTAwIDogMAogICAgICAgICAgICB9LAogICAgICAgICAgICBsYXllcnNjYWxlcmF0ZShsYXllclBhcmFtKSB7CiAgICAgICAgICAgICAgICBjb25zdCBsYXllciA9IHRoaXMuX3J1bnRpbWUuR2V0Q3VycmVudExheW91dCgpLkdldExheWVyKGxheWVyUGFyYW0pOwogICAgICAgICAgICAgICAgcmV0dXJuIGxheWVyID8gbGF5ZXIuR2V0U2NhbGVSYXRlKCkgOiAwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGxheWVyc2Nyb2xseChsYXllclBhcmFtKSB7CiAgICAgICAgICAgICAgICBjb25zdCBsYXllciA9IHRoaXMuX3J1bnRpbWUuR2V0Q3VycmVudExheW91dCgpLkdldExheWVyKGxheWVyUGFyYW0pOwogICAgICAgICAgICAgICAgcmV0dXJuIGxheWVyID8gbGF5ZXIuR2V0U2Nyb2xsWCgpIDogMAogICAgICAgICAgICB9LAogICAgICAgICAgICBsYXllcnNjcm9sbHkobGF5ZXJQYXJhbSkgewogICAgICAgICAgICAgICAgY29uc3QgbGF5ZXIgPQogICAgICAgICAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuR2V0Q3VycmVudExheW91dCgpLkdldExheWVyKGxheWVyUGFyYW0pOwogICAgICAgICAgICAgICAgcmV0dXJuIGxheWVyID8gbGF5ZXIuR2V0U2Nyb2xsWSgpIDogMAogICAgICAgICAgICB9LAogICAgICAgICAgICBsYXllcnBhcmFsbGF4eChsYXllclBhcmFtKSB7CiAgICAgICAgICAgICAgICBjb25zdCBsYXllciA9IHRoaXMuX3J1bnRpbWUuR2V0Q3VycmVudExheW91dCgpLkdldExheWVyKGxheWVyUGFyYW0pOwogICAgICAgICAgICAgICAgcmV0dXJuIGxheWVyID8gbGF5ZXIuR2V0UGFyYWxsYXhYKCkgKiAxMDAgOiAwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGxheWVycGFyYWxsYXh5KGxheWVyUGFyYW0pIHsKICAgICAgICAgICAgICAgIGNvbnN0IGxheWVyID0gdGhpcy5fcnVudGltZS5HZXRDdXJyZW50TGF5b3V0KCkuR2V0TGF5ZXIobGF5ZXJQYXJhbSk7CiAgICAgICAgICAgICAgICByZXR1cm4gbGF5ZXIgPyBsYXllci5HZXRQYXJhbGxheFkoKSAqIDEwMCA6IDAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgbGF5ZXJ6ZWxldmF0aW9uKGxheWVyUGFyYW0pIHsKICAgICAgICAgICAgICAgIGNvbnN0IGxheWVyID0gdGhpcy5fcnVudGltZS5HZXRDdXJyZW50TGF5b3V0KCkuR2V0TGF5ZXIobGF5ZXJQYXJhbSk7CiAgICAgICAgICAgICAgICByZXR1cm4gbGF5ZXIgPyBsYXllci5HZXRaRWxldmF0aW9uKCkgOiAwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGxheWVyaW5kZXgobGF5ZXJQYXJhbSkgewogICAgICAgICAgICAgICAgY29uc3QgbGF5ZXIgPQogICAgICAgICAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuR2V0Q3VycmVudExheW91dCgpLkdldExheWVyKGxheWVyUGFyYW0pOwogICAgICAgICAgICAgICAgcmV0dXJuIGxheWVyID8gbGF5ZXIuR2V0SW5kZXgoKSA6IC0xCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNhbnZhc3NuYXBzaG90KCkgewogICAgICAgICAgICAgICAgY29uc3QgY2FudmFzTWFuYWdlciA9IHRoaXMuX3J1bnRpbWUuR2V0Q2FudmFzTWFuYWdlcigpOwogICAgICAgICAgICAgICAgaWYgKCFjYW52YXNNYW5hZ2VyKSByZXR1cm4gIiI7CiAgICAgICAgICAgICAgICByZXR1cm4gY2FudmFzTWFuYWdlci5HZXRDYW52YXNTbmFwc2hvdFVybCgpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGxvb3BpbmRleChuYW1lKSB7CiAgICAgICAgICAgICAgICBjb25zdCBsb29wU3RhY2sgPSB0aGlzLl9sb29wU3RhY2s7CiAgICAgICAgICAgICAgICBpZiAoIWxvb3BTdGFjay5Jc0luTG9vcCgpKSByZXR1cm4gMDsKICAgICAgICAgICAgICAgIGlmIChuYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgbG9vcCA9IGxvb3BTdGFjay5GaW5kQnlOYW1lKG5hbWUpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBsb29wID8gbG9vcC5HZXRJbmRleCgpIDogMAogICAgICAgICAgICAgICAgfSBlbHNlIHJldHVybiBsb29wU3RhY2suR2V0Q3VycmVudCgpLkdldEluZGV4KCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2F2ZXN0YXRlanNvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lLkdldExhc3RTYXZlSnNvblN0cmluZygpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNhbGxtYXBwZWQobmFtZSwKICAgICAgICAgICAgICAgIHN0ciwgLi4ucGFyYW1SZXN1bHRzKSB7CiAgICAgICAgICAgICAgICBjb25zdCBtYXBFbnRyeSA9IHRoaXMuX0dldEZ1bmN0aW9uTWFwKG5hbWUudG9Mb3dlckNhc2UoKSwgZmFsc2UpOwogICAgICAgICAgICAgICAgaWYgKCFtYXBFbnRyeSkgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihgW0NvbnN0cnVjdF0gQ2FsbCBtYXBwZWQgZnVuY3Rpb246IG1hcCBuYW1lICcke25hbWV9JyBub3QgZm91bmQ7IHJldHVybmluZyAwYCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDAKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGxldCBmdW5jdGlvbkJsb2NrID0gbWFwRW50cnkuc3RyTWFwLmdldChzdHIudG9Mb3dlckNhc2UoKSk7CiAgICAgICAgICAgICAgICBpZiAoIWZ1bmN0aW9uQmxvY2spCiAgICAgICAgICAgICAgICAgICAgaWYgKG1hcEVudHJ5LmRlZmF1bHRGdW5jKSBmdW5jdGlvbkJsb2NrID0gbWFwRW50cnkuZGVmYXVsdEZ1bmM7CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihgW0NvbnN0cnVjdF0gQ2FsbCBtYXBwZWQgZnVuY3Rpb246IG5vIGZ1bmN0aW9uIGFzc29jaWF0ZWQgd2l0aCBtYXAgJyR7bmFtZX0nIHN0cmluZyAnJHtzdHJ9JzsgcmV0dXJuaW5nIDAgKGNvbnNpZGVyIHNldHRpbmcgYSBkZWZhdWx0KWApOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNvbnN0IHJldHVyblR5cGUgPQogICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uQmxvY2suR2V0UmV0dXJuVHlwZSgpOwogICAgICAgICAgICAgICAgY29uc3QgZGVmYXVsdFJldHVyblZhbHVlID0gZnVuY3Rpb25CbG9jay5HZXREZWZhdWx0UmV0dXJuVmFsdWUoKTsKICAgICAgICAgICAgICAgIGlmIChyZXR1cm5UeXBlID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKGBbQ29uc3RydWN0XSBDYWxsIG1hcHBlZCBmdW5jdGlvbjogbWFwICcke25hbWV9JyBzdHJpbmcgJyR7c3RyfScgaGFzIG5vIHJldHVybiB0eXBlIHNvIGNhbm5vdCBiZSBjYWxsZWQgZnJvbSBhbiBleHByZXNzaW9uOyByZXR1cm5pbmcgMGApOwogICAgICAgICAgICAgICAgICAgIHJldHVybiAwCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoIWZ1bmN0aW9uQmxvY2suSXNFbmFibGVkKCkpIHJldHVybiBkZWZhdWx0UmV0dXJuVmFsdWU7CiAgICAgICAgICAgICAgICBjb25zdCBydW50aW1lID0gdGhpcy5fcnVudGltZTsKICAgICAgICAgICAgICAgIGNvbnN0IGV2ZW50U2hlZXRNYW5hZ2VyID0gcnVudGltZS5HZXRFdmVudFNoZWV0TWFuYWdlcigpOwogICAgICAgICAgICAgICAgY29uc3QgY3VycmVudEV2ZW50ID0gZXZlbnRTaGVldE1hbmFnZXIuR2V0Q3VycmVudEV2ZW50KCk7CiAgICAgICAgICAgICAgICBjb25zdCBzb2xNb2RpZmllcnMgPSBjdXJyZW50RXZlbnQuR2V0U29sTW9kaWZpZXJzSW5jbHVkaW5nUGFyZW50cygpOwogICAgICAgICAgICAgICAgY29uc3QgaGFzQW55U29sTW9kaWZpZXJzID0gc29sTW9kaWZpZXJzLmxlbmd0aCA+IDA7CiAgICAgICAgICAgICAgICBpZiAoaGFzQW55U29sTW9kaWZpZXJzKQogICAgICAgICAgICAgICAgICAgIGlmIChmdW5jdGlvbkJsb2NrLklzQ29weVBpY2tlZCgpKSBldmVudFNoZWV0TWFuYWdlci5QdXNoQ29weVNvbChzb2xNb2RpZmllcnMpOwogICAgICAgICAgICAgICAgICAgIGVsc2UgZXZlbnRTaGVldE1hbmFnZXIuUHVzaENsZWFuU29sKHNvbE1vZGlmaWVycyk7CiAgICAgICAgICAgICAgICBjb25zdCBjYWxsZWVQYXJhbWV0ZXJzID0gZnVuY3Rpb25CbG9jay5HZXRGdW5jdGlvblBhcmFtZXRlcnMoKTsKICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSBwYXJhbVJlc3VsdHMubGVuZ3RoLCBsZW4gPSBjYWxsZWVQYXJhbWV0ZXJzLmxlbmd0aDsgaSA8IGxlbjsgKytpKSBwYXJhbVJlc3VsdHMucHVzaChjYWxsZWVQYXJhbWV0ZXJzW2ldLkdldEluaXRpYWxWYWx1ZSgpKTsKICAgICAgICAgICAgICAgIGNvbnN0IGNhbGxFdmVudEJsb2NrID0gZnVuY3Rpb25CbG9jay5HZXRFdmVudEJsb2NrKCk7CiAgICAgICAgICAgICAgICBjb25zdCByZXR1cm5WYWx1ZSA9IGNhbGxFdmVudEJsb2NrLlJ1bkFzRXhwcmVzc2lvbkZ1bmN0aW9uQ2FsbChjYWxsRXZlbnRCbG9jay5HZXRTb2xNb2RpZmllcnNJbmNsdWRpbmdQYXJlbnRzKCksCiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb25CbG9jay5Jc0NvcHlQaWNrZWQoKSwgcmV0dXJuVHlwZSwgZGVmYXVsdFJldHVyblZhbHVlLCAuLi5wYXJhbVJlc3VsdHMpOwogICAgICAgICAgICAgICAgaWYgKGhhc0FueVNvbE1vZGlmaWVycykgZXZlbnRTaGVldE1hbmFnZXIuUG9wU29sKHNvbE1vZGlmaWVycyk7CiAgICAgICAgICAgICAgICByZXR1cm4gcmV0dXJuVmFsdWUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgbG9hZGluZ3Byb2dyZXNzKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUuR2V0QXNzZXRNYW5hZ2VyKCkuR2V0TG9hZFByb2dyZXNzKCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgaW1hZ2Vsb2FkaW5ncHJvZ3Jlc3MoKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5faW1hZ2VzTG9hZGluZ1RvdGFsID09PSAwKSByZXR1cm4gMTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9pbWFnZXNMb2FkaW5nQ29tcGxldGUgLyB0aGlzLl9pbWFnZXNMb2FkaW5nVG90YWwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgcmVuZGVyZXIoKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fcnVudGltZS5HZXRXZWJHUFVSZW5kZXJlcigpKSByZXR1cm4gIndlYmdwdSI7CiAgICAgICAgICAgICAgICBlbHNlIHJldHVybiAid2ViZ2wiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHJlbmRlcmVyZGV0YWlsKCkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuX3J1bnRpbWUuR2V0V2ViR1BVUmVuZGVyZXIoKSkgcmV0dXJuIHRoaXMuX3J1bnRpbWUuR2V0V2ViR1BVUmVuZGVyZXIoKS5HZXRCYXNpY0FkYXB0ZXJJbmZvU3RyaW5nKCk7CiAgICAgICAgICAgICAgICBlbHNlIHJldHVybiB0aGlzLl9ydW50aW1lLkdldFdlYkdMUmVuZGVyZXIoKS5HZXRVbm1hc2tlZFJlbmRlcmVyKCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgaW1hZ2VtZW1vcnl1c2FnZSgpIHsKICAgICAgICAgICAgICAgIGxldCByZXQgPSB0aGlzLl9ydW50aW1lLkdldFJlbmRlcmVyKCkuR2V0RXN0aW1hdGVkVGV4dHVyZU1lbW9yeVVzYWdlKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gTWF0aC5yb3VuZCgxMDAgKiByZXQgLyAoMTAyNCAqIDEwMjQpKSAvIDEwMAogICAgICAgICAgICB9LAogICAgICAgICAgICByZ2IociwgZywgYikgewogICAgICAgICAgICAgICAgcmV0dXJuIEMzLlBhY2tSR0IociwgZywgYikKICAgICAgICAgICAgfSwKICAgICAgICAgICAgcmdiZXgociwgZywgYikgewogICAgICAgICAgICAgICAgcmV0dXJuIEMzLlBhY2tSR0JFeChyIC8gMTAwLCBnIC8gMTAwLCBiIC8gMTAwKQogICAgICAgICAgICB9LAogICAgICAgICAgICByZ2JhKHIsIGcsIGIsIGEpIHsKICAgICAgICAgICAgICAgIHJldHVybiBDMy5QYWNrUkdCQUV4KHIgLyAxMDAsIGcgLyAxMDAsIGIgLyAxMDAsIGEgLyAxMDApCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHJnYmV4MjU1KHIsIGcsIGIpIHsKICAgICAgICAgICAgICAgIHJldHVybiBDMy5QYWNrUkdCRXgociAvIDI1NSwgZyAvIDI1NSwgYiAvIDI1NSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgcmdiYTI1NShyLCBnLCBiLCBhKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gQzMuUGFja1JHQkFFeChyIC8gMjU1LCBnIC8gMjU1LCBiIC8gMjU1LCBhIC8gMjU1KQogICAgICAgICAgICB9LAogICAgICAgICAgICBwcm9qZWN0bmFtZSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lLkdldFByb2plY3ROYW1lKCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgcHJvamVjdHZlcnNpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcnVudGltZS5HZXRQcm9qZWN0VmVyc2lvbigpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGN1cnJlbnRldmVudHNoZWV0bmFtZSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lLkdldEN1cnJlbnRFdmVudCgpLkdldEV2ZW50U2hlZXQoKS5HZXROYW1lKCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgY3VycmVudGV2ZW50bnVtYmVyKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUuR2V0Q3VycmVudEV2ZW50KCkuR2V0RGlzcGxheU51bWJlcigpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwoKfQoKewogICAgJ3VzZSBzdHJpY3QnOyB7CiAgICAgICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgICAgIEMzLlBsdWdpbnMuQXJyID0gY2xhc3MgQXJyYXlQbHVnaW4gZXh0ZW5kcyBDMy5TREtQbHVnaW5CYXNlIHsKICAgICAgICAgICAgY29uc3RydWN0b3Iob3B0cykgewogICAgICAgICAgICAgICAgc3VwZXIob3B0cykKICAgICAgICAgICAgfQogICAgICAgICAgICBSZWxlYXNlKCkgewogICAgICAgICAgICAgICAgc3VwZXIuUmVsZWFzZSgpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IHsKICAgICAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICAgICAgQzMuUGx1Z2lucy5BcnIuVHlwZSA9IGNsYXNzIEFycmF5VHlwZSBleHRlbmRzIEMzLlNES1R5cGVCYXNlIHsKICAgICAgICAgICAgY29uc3RydWN0b3Iob2JqZWN0Q2xhc3MpIHsKICAgICAgICAgICAgICAgIHN1cGVyKG9iamVjdENsYXNzKQogICAgICAgICAgICB9CiAgICAgICAgICAgIFJlbGVhc2UoKSB7CiAgICAgICAgICAgICAgICBzdXBlci5SZWxlYXNlKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBPbkNyZWF0ZSgpIHt9CiAgICAgICAgfQogICAgfSB7CiAgICAgICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgICAgIGNvbnN0IEMzWCA9IHNlbGYuQzNYOwogICAgICAgIGNvbnN0IElJbnN0YW5jZSA9IHNlbGYuSUluc3RhbmNlOwoKICAgICAgICBmdW5jdGlvbiBSZXNpemVBcnJheShhcnIsIGxlbiwgZGF0YSkgewogICAgICAgICAgICBpZiAobGVuIDwgYXJyLmxlbmd0aCkgQzMudHJ1bmNhdGVBcnJheShhcnIsIGxlbik7CiAgICAgICAgICAgIGVsc2UgaWYgKGxlbiA+IGFyci5sZW5ndGgpCiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGRhdGEgPT09ICJmdW5jdGlvbiIpCiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IGFyci5sZW5ndGg7IGkgPCBsZW47ICsraSkgYXJyLnB1c2goZGF0YSgpKTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gYXJyLmxlbmd0aDsgaSA8IGxlbjsgKytpKSBhcnIucHVzaChkYXRhKQogICAgICAgIH0KICAgICAgICBDMy5QbHVnaW5zLkFyci5JbnN0YW5jZSA9IGNsYXNzIEFycmF5SW5zdGFuY2UgZXh0ZW5kcyBDMy5TREtJbnN0YW5jZUJhc2UgewogICAgICAgICAgICBjb25zdHJ1Y3RvcihpbnN0LCBwcm9wZXJ0aWVzKSB7CiAgICAgICAgICAgICAgICBzdXBlcihpbnN0KTsKICAgICAgICAgICAgICAgIHRoaXMuX2N4ID0gMTA7CiAgICAgICAgICAgICAgICB0aGlzLl9jeSA9IDE7CiAgICAgICAgICAgICAgICB0aGlzLl9jeiA9IDE7CiAgICAgICAgICAgICAgICB0aGlzLl9hcnIgPSBudWxsOwogICAgICAgICAgICAgICAgdGhpcy5fZm9yWCA9IFtdOwogICAgICAgICAgICAgICAgdGhpcy5fZm9yWSA9IFtdOwogICAgICAgICAgICAgICAgdGhpcy5fZm9yWiA9IFtdOwogICAgICAgICAgICAgICAgdGhpcy5fZm9yRGVwdGggPSAtMTsKICAgICAgICAgICAgICAgIGlmIChwcm9wZXJ0aWVzKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY3ggPSBwcm9wZXJ0aWVzWzBdOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2N5ID0gcHJvcGVydGllc1sxXTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9jeiA9IHByb3BlcnRpZXNbMl0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMuX2FyciA9IEMzLk1ha2VGaWxsZWRBcnJheSh0aGlzLl9jeCwgKCkgPT4gQzMuTWFrZUZpbGxlZEFycmF5KHRoaXMuX2N5LCAoKSA9PiBDMy5NYWtlRmlsbGVkQXJyYXkodGhpcy5fY3osIDApKSkKICAgICAgICAgICAgfQogICAgICAgICAgICBSZWxlYXNlKCkgewogICAgICAgICAgICAgICAgdGhpcy5fYXJyID0gbnVsbDsKICAgICAgICAgICAgICAgIHN1cGVyLlJlbGVhc2UoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIEF0KHgsIHksIHopIHsKICAgICAgICAgICAgICAgIHggPSBNYXRoLmZsb29yKHgpOwogICAgICAgICAgICAgICAgeSA9IE1hdGguZmxvb3IoeSk7CiAgICAgICAgICAgICAgICB6ID0gTWF0aC5mbG9vcih6KTsKICAgICAgICAgICAgICAgIGlmICh4ID49IDAgJiYgeCA8IHRoaXMuX2N4ICYmIHkgPj0gMCAmJiB5IDwgdGhpcy5fY3kgJiYgeiA+PSAwICYmIHogPCB0aGlzLl9jeikgcmV0dXJuIHRoaXMuX2Fyclt4XVt5XVt6XTsKICAgICAgICAgICAgICAgIGVsc2UgcmV0dXJuIDAKICAgICAgICAgICAgfQogICAgICAgICAgICBTZXQoeCwgeSwgeiwgdmFsKSB7CiAgICAgICAgICAgICAgICB4ID0gTWF0aC5mbG9vcih4KTsKICAgICAgICAgICAgICAgIHkgPSBNYXRoLmZsb29yKHkpOwogICAgICAgICAgICAgICAgeiA9IE1hdGguZmxvb3Ioeik7CiAgICAgICAgICAgICAgICBpZiAoeCA+PSAwICYmIHggPCB0aGlzLl9jeCAmJiB5ID49IDAgJiYgeSA8IHRoaXMuX2N5ICYmIHogPj0gMCAmJiB6IDwgdGhpcy5fY3opIHRoaXMuX2Fyclt4XVt5XVt6XSA9CiAgICAgICAgICAgICAgICAgICAgdmFsCiAgICAgICAgICAgIH0KICAgICAgICAgICAgU2V0U2l6ZSh3LCBoLCBkKSB7CiAgICAgICAgICAgICAgICB3ID0gTWF0aC5mbG9vcih3KTsKICAgICAgICAgICAgICAgIGggPSBNYXRoLmZsb29yKGgpOwogICAgICAgICAgICAgICAgZCA9IE1hdGguZmxvb3IoZCk7CiAgICAgICAgICAgICAgICBpZiAodyA8IDApIHcgPSAwOwogICAgICAgICAgICAgICAgaWYgKGggPCAwKSBoID0gMDsKICAgICAgICAgICAgICAgIGlmIChkIDwgMCkgZCA9IDA7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fY3ggPT09IHcgJiYgdGhpcy5fY3kgPT09IGggJiYgdGhpcy5fY3ogPT09IGQpIHJldHVybjsKICAgICAgICAgICAgICAgIHRoaXMuX2N4ID0gdzsKICAgICAgICAgICAgICAgIHRoaXMuX2N5ID0gaDsKICAgICAgICAgICAgICAgIHRoaXMuX2N6ID0gZDsKICAgICAgICAgICAgICAgIGNvbnN0IGFyciA9IHRoaXMuX2FycjsKICAgICAgICAgICAgICAgIFJlc2l6ZUFycmF5KGFyciwgdywgKCkgPT4gQzMuTWFrZUZpbGxlZEFycmF5KGgsICgpID0+IEMzLk1ha2VGaWxsZWRBcnJheShkLCAwKSkpOwogICAgICAgICAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCB3OyArK3gpIHsKICAgICAgICAgICAgICAgICAgICBSZXNpemVBcnJheShhcnJbeF0sIGgsICgpID0+IEMzLk1ha2VGaWxsZWRBcnJheShkLCAwKSk7CiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgeSA9IDA7IHkgPCBoOyArK3kpIFJlc2l6ZUFycmF5KGFyclt4XVt5XSwgZCwgMCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBHZXRXaWR0aCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9jeAogICAgICAgICAgICB9CiAgICAgICAgICAgIEdldEhlaWdodCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9jeQogICAgICAgICAgICB9CiAgICAgICAgICAgIEdldERlcHRoKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2N6CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX1NodWZmbGVIZWxwZXIoYXhpcywgbGVuLAogICAgICAgICAgICAgICAgeCwgeSwgeikgewogICAgICAgICAgICAgICAgd2hpbGUgKGxlbiA+IDApIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBpID0gTWF0aC5mbG9vcih0aGlzLl9ydW50aW1lLlJhbmRvbSgpICogbGVuKTsKICAgICAgICAgICAgICAgICAgICAtLWxlbjsKICAgICAgICAgICAgICAgICAgICBpZiAoYXhpcyA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB2MSA9IHRoaXMuQXQobGVuLCB5LCB6KTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdjIgPSB0aGlzLkF0KGksIHksIHopOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLlNldChsZW4sIHksIHosIHYyKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5TZXQoaSwgeSwgeiwgdjEpCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChheGlzID09PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHYxID0gdGhpcy5BdCh4LCBsZW4sIHopOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB2MiA9IHRoaXMuQXQoeCwgaSwgeik7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuU2V0KHgsIGxlbiwgeiwgdjIpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLlNldCh4LCBpLCB6LCB2MSkKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGF4aXMgPT09IDIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdjEgPSB0aGlzLkF0KHgsIHksIGxlbik7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHYyID0gdGhpcy5BdCh4LCB5LCBpKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5TZXQoeCwgeSwgbGVuLCB2Mik7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuU2V0KHgsIHksIGksIHYxKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBHZXREZWJ1Z2dlclByb3BlcnRpZXMoKSB7CiAgICAgICAgICAgICAgICBjb25zdCBwcmVmaXggPSAicGx1Z2lucy5hcnIuZGVidWdnZXIiOwogICAgICAgICAgICAgICAgY29uc3QgcHJvcHNQcmVmaXggPSAicGx1Z2lucy5hcnIucHJvcGVydGllcyI7CiAgICAgICAgICAgICAgICBjb25zdCByZXQgPSBbewogICAgICAgICAgICAgICAgICAgIHRpdGxlOiBwcmVmaXggKyAiLmFycmF5LXByb3BlcnRpZXMudGl0bGUiLAogICAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IFt7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHByb3BzUHJlZml4ICsgIi53aWR0aC5uYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuX2N4LAogICAgICAgICAgICAgICAgICAgICAgICBvbmVkaXQ6IHYgPT4gdGhpcy5TZXRTaXplKHYsIHRoaXMuX2N5LCB0aGlzLl9jeikKICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHByb3BzUHJlZml4ICsgIi5oZWlnaHQubmFtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLl9jeSwKICAgICAgICAgICAgICAgICAgICAgICAgb25lZGl0OiB2ID0+IHRoaXMuU2V0U2l6ZSh0aGlzLl9jeCwgdiwgdGhpcy5fY3opCiAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBwcm9wc1ByZWZpeCArICIuZGVwdGgubmFtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLl9jeiwKICAgICAgICAgICAgICAgICAgICAgICAgb25lZGl0OiB2ID0+IHRoaXMuU2V0U2l6ZSh0aGlzLl9jeCwgdGhpcy5fY3ksIHYpCiAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBwcm9wc1ByZWZpeCArICIuZWxlbWVudHMubmFtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLl9jeCAqIHRoaXMuX2N5ICogdGhpcy5fY3oKICAgICAgICAgICAgICAgICAgICB9XQogICAgICAgICAgICAgICAgfV07CiAgICAgICAgICAgICAgICBjb25zdCBkYXRhUHJvcHMgPSBbXTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9jeSA9PT0gMSAmJiB0aGlzLl9jeiA9PT0gMSkKICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IHRoaXMuX2N4OyArK3gpIGRhdGFQcm9wcy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIiQiICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHgsCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLl9hcnJbeF1bMF1bMF0sCiAgICAgICAgICAgICAgICAgICAgICAgIG9uZWRpdDogdiA9PiB0aGlzLl9hcnJbeF1bMF1bMF0gPSB2CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCB0aGlzLl9jeDsgKyt4KSBkYXRhUHJvcHMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICIkIiArIHgsCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLl9hcnJbeF0udG9TdHJpbmcoKQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgaWYgKGRhdGFQcm9wcy5sZW5ndGgpIHJldC5wdXNoKHsKICAgICAgICAgICAgICAgICAgICB0aXRsZTogcHJlZml4ICsgIi5hcnJheS1kYXRhLnRpdGxlIiwKICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiBkYXRhUHJvcHMKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgcmV0dXJuIHJldAogICAgICAgICAgICB9CiAgICAgICAgICAgIEdldEFzSnNvblN0cmluZygpIHsKICAgICAgICAgICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeSh7CiAgICAgICAgICAgICAgICAgICAgImMyYXJyYXkiOiB0cnVlLAogICAgICAgICAgICAgICAgICAgICJzaXplIjogW3RoaXMuX2N4LCB0aGlzLl9jeSwgdGhpcy5fY3pdLAogICAgICAgICAgICAgICAgICAgICJkYXRhIjogdGhpcy5fYXJyCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9CiAgICAgICAgICAgIFNhdmVUb0pzb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICJzaXplIjogW3RoaXMuX2N4LCB0aGlzLl9jeSwgdGhpcy5fY3pdLAogICAgICAgICAgICAgICAgICAgICJkYXRhIjogdGhpcy5fYXJyCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgTG9hZEZyb21Kc29uKG8pIHsKICAgICAgICAgICAgICAgIGNvbnN0IHN6ID0gb1sic2l6ZSJdOwogICAgICAgICAgICAgICAgdGhpcy5fY3ggPSBzelswXTsKICAgICAgICAgICAgICAgIHRoaXMuX2N5ID0gc3pbMV07CiAgICAgICAgICAgICAgICB0aGlzLl9jeiA9CiAgICAgICAgICAgICAgICAgICAgc3pbMl07CiAgICAgICAgICAgICAgICB0aGlzLl9hcnIgPSBvWyJkYXRhIl0KICAgICAgICAgICAgfQogICAgICAgICAgICBfR2V0Rm9yWCgpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9mb3JEZXB0aCA+PSAwICYmIHRoaXMuX2ZvckRlcHRoIDwgdGhpcy5fZm9yWC5sZW5ndGgpIHJldHVybiB0aGlzLl9mb3JYW3RoaXMuX2ZvckRlcHRoXTsKICAgICAgICAgICAgICAgIGVsc2UgcmV0dXJuIDAKICAgICAgICAgICAgfQogICAgICAgICAgICBfR2V0Rm9yWSgpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9mb3JEZXB0aCA+PSAwICYmIHRoaXMuX2ZvckRlcHRoIDwgdGhpcy5fZm9yWS5sZW5ndGgpIHJldHVybiB0aGlzLl9mb3JZW3RoaXMuX2ZvckRlcHRoXTsKICAgICAgICAgICAgICAgIGVsc2UgcmV0dXJuIDAKICAgICAgICAgICAgfQogICAgICAgICAgICBfR2V0Rm9yWigpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9mb3JEZXB0aCA+PSAwICYmIHRoaXMuX2ZvckRlcHRoIDwgdGhpcy5fZm9yWi5sZW5ndGgpIHJldHVybiB0aGlzLl9mb3JaW3RoaXMuX2ZvckRlcHRoXTsKICAgICAgICAgICAgICAgIGVsc2UgcmV0dXJuIDAKICAgICAgICAgICAgfQogICAgICAgICAgICBHZXRTY3JpcHRJbnRlcmZhY2VDbGFzcygpIHsKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLklBcnJheUluc3RhbmNlCiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIGNvbnN0IG1hcCA9IG5ldyBXZWFrTWFwOwogICAgICAgIHNlbGYuSUFycmF5SW5zdGFuY2UgPSBjbGFzcyBJQXJyYXlJbnN0YW5jZSBleHRlbmRzIElJbnN0YW5jZSB7CiAgICAgICAgICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgICAgICAgICAgc3VwZXIoKTsKICAgICAgICAgICAgICAgIG1hcC5zZXQodGhpcywgSUluc3RhbmNlLl9HZXRJbml0SW5zdCgpLkdldFNka0luc3RhbmNlKCkpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZ2V0IHdpZHRoKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIG1hcC5nZXQodGhpcykuR2V0V2lkdGgoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGdldCBoZWlnaHQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbWFwLmdldCh0aGlzKS5HZXRIZWlnaHQoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGdldCBkZXB0aCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBtYXAuZ2V0KHRoaXMpLkdldERlcHRoKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBzZXRTaXplKHcsIGggPSAxLCBkID0gMSkgewogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVGaW5pdGVOdW1iZXIodyk7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcihoKTsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlRmluaXRlTnVtYmVyKGQpOwogICAgICAgICAgICAgICAgbWFwLmdldCh0aGlzKS5TZXRTaXplKHcsIGgsIGQpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZ2V0QXQoeCwgeSA9IDAsIHogPSAwKSB7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcih4KTsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlRmluaXRlTnVtYmVyKHkpOwogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVGaW5pdGVOdW1iZXIoeik7CiAgICAgICAgICAgICAgICByZXR1cm4gbWFwLmdldCh0aGlzKS5BdCh4LCB5LCB6KQogICAgICAgICAgICB9CiAgICAgICAgICAgIHNldEF0KHZhbCwgeCwgeSA9IDAsIHogPSAwKSB7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcih4KTsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlRmluaXRlTnVtYmVyKHkpOwogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVGaW5pdGVOdW1iZXIoeik7CiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHZhbCAhPT0gIm51bWJlciIgJiYgdHlwZW9mIHZhbCAhPT0gInN0cmluZyIpIHRocm93IG5ldyBUeXBlRXJyb3IoImludmFsaWQgdHlwZSIpOwogICAgICAgICAgICAgICAgbWFwLmdldCh0aGlzKS5TZXQoeCwgeSwgeiwgdmFsKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSB7CiAgICAgICAgY29uc3QgQzMgPSBzZWxmLkMzOwoKICAgICAgICBmdW5jdGlvbiBEb0ZvckVhY2hUcmlnZ2VyKGV2ZW50U2hlZXRNYW5hZ2VyLCBjdXJyZW50RXZlbnQsIHNvbE1vZGlmaWVycywgb2xkRnJhbWUsIG5ld0ZyYW1lKSB7CiAgICAgICAgICAgIGV2ZW50U2hlZXRNYW5hZ2VyLlB1c2hDb3B5U29sKHNvbE1vZGlmaWVycyk7CiAgICAgICAgICAgIGN1cnJlbnRFdmVudC5SZXRyaWdnZXIob2xkRnJhbWUsIG5ld0ZyYW1lKTsKICAgICAgICAgICAgZXZlbnRTaGVldE1hbmFnZXIuUG9wU29sKHNvbE1vZGlmaWVycykKICAgICAgICB9CiAgICAgICAgQzMuUGx1Z2lucy5BcnIuQ25kcyA9IHsKICAgICAgICAgICAgQ29tcGFyZVgoeCwgY21wLCB2YWwpIHsKICAgICAgICAgICAgICAgIHJldHVybiBDMy5jb21wYXJlKHRoaXMuQXQoeCwgMCwgMCksIGNtcCwgdmFsKQogICAgICAgICAgICB9LAogICAgICAgICAgICBDb21wYXJlWFkoeCwgeSwgY21wLCB2YWwpIHsKICAgICAgICAgICAgICAgIHJldHVybiBDMy5jb21wYXJlKHRoaXMuQXQoeCwgeSwgMCksIGNtcCwgdmFsKQogICAgICAgICAgICB9LAogICAgICAgICAgICBDb21wYXJlWFlaKHgsIHksIHosIGNtcCwgdmFsKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gQzMuY29tcGFyZSh0aGlzLkF0KHgsIHksIHopLCBjbXAsIHZhbCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgQXJyRm9yRWFjaChkaW1zKSB7CiAgICAgICAgICAgICAgICBjb25zdCBydW50aW1lID0gdGhpcy5fcnVudGltZTsKICAgICAgICAgICAgICAgIGNvbnN0IGV2ZW50U2hlZXRNYW5hZ2VyID0KICAgICAgICAgICAgICAgICAgICBydW50aW1lLkdldEV2ZW50U2hlZXRNYW5hZ2VyKCk7CiAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50RXZlbnQgPSBydW50aW1lLkdldEN1cnJlbnRFdmVudCgpOwogICAgICAgICAgICAgICAgY29uc3Qgc29sTW9kaWZpZXJzID0gY3VycmVudEV2ZW50LkdldFNvbE1vZGlmaWVycygpOwogICAgICAgICAgICAgICAgY29uc3QgZXZlbnRTdGFjayA9IHJ1bnRpbWUuR2V0RXZlbnRTdGFjaygpOwogICAgICAgICAgICAgICAgY29uc3Qgb2xkRnJhbWUgPSBldmVudFN0YWNrLkdldEN1cnJlbnRTdGFja0ZyYW1lKCk7CiAgICAgICAgICAgICAgICBjb25zdCBuZXdGcmFtZSA9IGV2ZW50U3RhY2suUHVzaChjdXJyZW50RXZlbnQpOwogICAgICAgICAgICAgICAgY29uc3QgZm9yRGVwdGggPSArK3RoaXMuX2ZvckRlcHRoOwogICAgICAgICAgICAgICAgY29uc3QgZm9yWCA9IHRoaXMuX2Zvclg7CiAgICAgICAgICAgICAgICBjb25zdCBmb3JZID0gdGhpcy5fZm9yWTsKICAgICAgICAgICAgICAgIGNvbnN0IGZvclogPSB0aGlzLl9mb3JaOwogICAgICAgICAgICAgICAgY29uc3QgY3ggPSB0aGlzLl9jeDsKICAgICAgICAgICAgICAgIGNvbnN0IGN5ID0gdGhpcy5fY3k7CiAgICAgICAgICAgICAgICBjb25zdCBjeiA9IHRoaXMuX2N6OwogICAgICAgICAgICAgICAgaWYgKGZvckRlcHRoID09PSB0aGlzLl9mb3JYLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgIGZvclgucHVzaCgwKTsKICAgICAgICAgICAgICAgICAgICBmb3JZLnB1c2goMCk7CiAgICAgICAgICAgICAgICAgICAgZm9yWi5wdXNoKDApCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGZvclhbZm9yRGVwdGhdID0KICAgICAgICAgICAgICAgICAgICAgICAgMDsKICAgICAgICAgICAgICAgICAgICBmb3JZW2ZvckRlcHRoXSA9IDA7CiAgICAgICAgICAgICAgICAgICAgZm9yWltmb3JEZXB0aF0gPSAwCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBydW50aW1lLlNldERlYnVnZ2luZ0VuYWJsZWQoZmFsc2UpOwogICAgICAgICAgICAgICAgaWYgKGRpbXMgPT09IDApCiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCBjeDsgKyt4KQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCB5ID0gMDsgeSA8IGN5OyArK3kpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCB6ID0gMDsgeiA8IGN6OyArK3opIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JYW2ZvckRlcHRoXSA9IHg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yWVtmb3JEZXB0aF0gPSB5OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvclpbZm9yRGVwdGhdID0gejsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEb0ZvckVhY2hUcmlnZ2VyKGV2ZW50U2hlZXRNYW5hZ2VyLCBjdXJyZW50RXZlbnQsIHNvbE1vZGlmaWVycywgb2xkRnJhbWUsIG5ld0ZyYW1lKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChkaW1zID09PSAxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgY3g7ICsreCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgeSA9IDA7IHkgPCBjeTsgKyt5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JYW2ZvckRlcHRoXSA9IHg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JZW2ZvckRlcHRoXSA9IHk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEb0ZvckVhY2hUcmlnZ2VyKGV2ZW50U2hlZXRNYW5hZ2VyLCBjdXJyZW50RXZlbnQsIHNvbE1vZGlmaWVycywgb2xkRnJhbWUsIG5ld0ZyYW1lKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgY3g7ICsreCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvclhbZm9yRGVwdGhdID0geDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEb0ZvckVhY2hUcmlnZ2VyKGV2ZW50U2hlZXRNYW5hZ2VyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50RXZlbnQsIHNvbE1vZGlmaWVycywgb2xkRnJhbWUsIG5ld0ZyYW1lKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcnVudGltZS5TZXREZWJ1Z2dpbmdFbmFibGVkKHRydWUpOwogICAgICAgICAgICAgICAgdGhpcy5fZm9yRGVwdGgtLTsKICAgICAgICAgICAgICAgIGV2ZW50U3RhY2suUG9wKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICAgICAgfSwKICAgICAgICAgICAgQ29tcGFyZUN1cnJlbnQoY21wLCB2YWwpIHsKICAgICAgICAgICAgICAgIHJldHVybiBDMy5jb21wYXJlKHRoaXMuQXQodGhpcy5fR2V0Rm9yWCgpLCB0aGlzLl9HZXRGb3JZKCksIHRoaXMuX0dldEZvclooKSksIGNtcCwgdmFsKQogICAgICAgICAgICB9LAogICAgICAgICAgICBDb250YWlucyh2YWwpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGN4ID0gdGhpcy5fY3g7CiAgICAgICAgICAgICAgICBjb25zdCBjeSA9IHRoaXMuX2N5OwogICAgICAgICAgICAgICAgY29uc3QgY3ogPSB0aGlzLl9jejsKICAgICAgICAgICAgICAgIGNvbnN0IGFyciA9IHRoaXMuX2FycjsKICAgICAgICAgICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgY3g7ICsreCkKICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCB5ID0gMDsgeSA8IGN5OyArK3kpCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IHogPSAwOyB6IDwgY3o7ICsreikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhcnJbeF1beV1bel0gPT09IHZhbCkgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICAgICAgfSwKICAgICAgICAgICAgSXNFbXB0eSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9jeCA9PT0gMCB8fCB0aGlzLl9jeSA9PT0gMCB8fCB0aGlzLl9jeiA9PT0gMAogICAgICAgICAgICB9LAogICAgICAgICAgICBDb21wYXJlU2l6ZShheGlzLAogICAgICAgICAgICAgICAgY21wLCB2YWwpIHsKICAgICAgICAgICAgICAgIGxldCBzID0gMDsKICAgICAgICAgICAgICAgIHN3aXRjaCAoYXhpcykgewogICAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgICAgcyA9IHRoaXMuX2N4OwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICAgICAgICAgIHMgPSB0aGlzLl9jeTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgICAgICAgICBzID0gdGhpcy5fY3o7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gQzMuY29tcGFyZShzLCBjbXAsIHZhbCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gewogICAgICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKCiAgICAgICAgZnVuY3Rpb24gQ29tcGFyZVZhbHVlcyh2YSwgdmIpIHsKICAgICAgICAgICAgaWYgKHR5cGVvZiB2YSA9PT0gIm51bWJlciIgJiYgdHlwZW9mIHZiID09PSAibnVtYmVyIikgcmV0dXJuIHZhIC0gdmI7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgY29uc3Qgc2EgPSB2YS50b1N0cmluZygpOwogICAgICAgICAgICAgICAgY29uc3Qgc2IgPSB2Yi50b1N0cmluZygpOwogICAgICAgICAgICAgICAgaWYgKHNhIDwgc2IpIHJldHVybiAtMTsKICAgICAgICAgICAgICAgIGVsc2UgaWYgKHNhID4gc2IpIHJldHVybiAxOwogICAgICAgICAgICAgICAgZWxzZSByZXR1cm4gMAogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIEMzLlBsdWdpbnMuQXJyLkFjdHMgPSB7CiAgICAgICAgICAgIENsZWFyKHYpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGN4ID0gdGhpcy5fY3g7CiAgICAgICAgICAgICAgICBjb25zdCBjeSA9IHRoaXMuX2N5OwogICAgICAgICAgICAgICAgY29uc3QgY3ogPSB0aGlzLl9jejsKICAgICAgICAgICAgICAgIGNvbnN0IGFyciA9IHRoaXMuX2FycjsKICAgICAgICAgICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgY3g7ICsreCkKICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCB5ID0gMDsgeSA8IGN5OyArK3kpCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IHogPSAwOyB6IDwgY3o7ICsreikgYXJyW3hdW3ldW3pdID0gdgogICAgICAgICAgICB9LAogICAgICAgICAgICBTZXRTaXplKHcsIGgsIGQpIHsKICAgICAgICAgICAgICAgIHRoaXMuU2V0U2l6ZSh3LCBoLCBkKQogICAgICAgICAgICB9LAogICAgICAgICAgICBTZXRYKHgsIHZhbCkgewogICAgICAgICAgICAgICAgdGhpcy5TZXQoeCwgMCwgMCwgdmFsKQogICAgICAgICAgICB9LAogICAgICAgICAgICBTZXRYWSh4LCB5LCB2YWwpIHsKICAgICAgICAgICAgICAgIHRoaXMuU2V0KHgsIHksIDAsIHZhbCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgU2V0WFlaKHgsIHksIHosIHZhbCkgewogICAgICAgICAgICAgICAgdGhpcy5TZXQoeCwgeSwgeiwgdmFsKQogICAgICAgICAgICB9LAogICAgICAgICAgICBQdXNoKHdoZXJlLCB2YWx1ZSwgYXhpcykgewogICAgICAgICAgICAgICAgY29uc3QgY3ggPSB0aGlzLl9jeDsKICAgICAgICAgICAgICAgIGNvbnN0IGN5ID0gdGhpcy5fY3k7CiAgICAgICAgICAgICAgICBjb25zdCBjeiA9IHRoaXMuX2N6OwogICAgICAgICAgICAgICAgY29uc3QgYXJyID0gdGhpcy5fYXJyOwogICAgICAgICAgICAgICAgaWYgKGF4aXMgPT09IDApIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBhZGQgPSBDMy5NYWtlRmlsbGVkQXJyYXkoY3ksICgpID0+IEMzLk1ha2VGaWxsZWRBcnJheShjeiwgdmFsdWUpKTsKICAgICAgICAgICAgICAgICAgICBpZiAod2hlcmUgPT09IDApIGFyci5wdXNoKGFkZCk7CiAgICAgICAgICAgICAgICAgICAgZWxzZSBhcnIudW5zaGlmdChhZGQpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2N4KysKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYXhpcyA9PT0gMSkgewogICAgICAgICAgICAgICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgY3g7ICsreCkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhZGQgPSBDMy5NYWtlRmlsbGVkQXJyYXkoY3osIHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHdoZXJlID09PSAwKSBhcnJbeF0ucHVzaChhZGQpOwogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGFyclt4XS51bnNoaWZ0KGFkZCkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY3krKwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IGN4OyArK3gpCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IHkgPSAwOyB5IDwgY3k7ICsreSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh3aGVyZSA9PT0gMCkgYXJyW3hdW3ldLnB1c2godmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBhcnJbeF1beV0udW5zaGlmdCh2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY3orKwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBQb3Aod2hlcmUsIGF4aXMpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGN4ID0gdGhpcy5fY3g7CiAgICAgICAgICAgICAgICBjb25zdCBjeSA9IHRoaXMuX2N5OwogICAgICAgICAgICAgICAgY29uc3QgY3ogPSB0aGlzLl9jejsKICAgICAgICAgICAgICAgIGNvbnN0IGFyciA9IHRoaXMuX2FycjsKICAgICAgICAgICAgICAgIGlmIChheGlzID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGN4ID09PSAwKSByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgaWYgKHdoZXJlID09PSAwKSBhcnIucG9wKCk7CiAgICAgICAgICAgICAgICAgICAgZWxzZSBhcnIuc2hpZnQoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9jeC0tCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGF4aXMgPT09IDEpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoY3kgPT09IDApIHJldHVybjsKICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IGN4OyArK3gpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh3aGVyZSA9PT0gMCkgYXJyW3hdLnBvcCgpOwogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGFyclt4XS5zaGlmdCgpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2N5LS0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGN6ID09PSAwKSByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCBjeDsgKyt4KQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCB5ID0gMDsgeSA8IGN5OyArK3kpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAod2hlcmUgPT09IDApIGFyclt4XVt5XS5wb3AoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgYXJyW3hdW3ldLnNoaWZ0KCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY3otLQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBSZXZlcnNlKGF4aXMpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGN4ID0gdGhpcy5fY3g7CiAgICAgICAgICAgICAgICBjb25zdCBjeSA9IHRoaXMuX2N5OwogICAgICAgICAgICAgICAgY29uc3QgY3ogPSB0aGlzLl9jejsKICAgICAgICAgICAgICAgIGNvbnN0IGFyciA9IHRoaXMuX2FycjsKICAgICAgICAgICAgICAgIGlmIChjeCA9PT0gMCB8fCBjeSA9PT0gMCB8fCBjeiA9PT0gMCkgcmV0dXJuOwogICAgICAgICAgICAgICAgaWYgKGF4aXMgPT09IDApIGFyci5yZXZlcnNlKCk7CiAgICAgICAgICAgICAgICBlbHNlIGlmIChheGlzID09PSAxKQogICAgICAgICAgICAgICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgY3g7ICsreCkgYXJyW3hdLnJldmVyc2UoKTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IGN4OyArK3gpCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IHkgPSAwOyB5IDwgY3k7ICsreSkgYXJyW3hdW3ldLnJldmVyc2UoKQogICAgICAgICAgICB9LAogICAgICAgICAgICBTb3J0KGF4aXMpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGN4ID0gdGhpcy5fY3g7CiAgICAgICAgICAgICAgICBjb25zdCBjeSA9IHRoaXMuX2N5OwogICAgICAgICAgICAgICAgY29uc3QgY3ogPSB0aGlzLl9jejsKICAgICAgICAgICAgICAgIGNvbnN0IGFyciA9IHRoaXMuX2FycjsKICAgICAgICAgICAgICAgIGlmIChjeCA9PT0gMCB8fCBjeSA9PT0gMCB8fCBjeiA9PT0gMCkgcmV0dXJuOwogICAgICAgICAgICAgICAgaWYgKGF4aXMgPT09IDApIGFyci5zb3J0KChhLCBiKSA9PiBDb21wYXJlVmFsdWVzKGFbMF1bMF0sIGJbMF1bMF0pKTsKICAgICAgICAgICAgICAgIGVsc2UgaWYgKGF4aXMgPT09IDEpCiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCBjeDsgKyt4KSBhcnJbeF0uc29ydCgoYSwgYikgPT4gQ29tcGFyZVZhbHVlcyhhWzBdLCBiWzBdKSk7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCBjeDsgKyt4KQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCB5ID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAwOyB5IDwgY3k7ICsreSkgYXJyW3hdW3ldLnNvcnQoQ29tcGFyZVZhbHVlcykKICAgICAgICAgICAgfSwKICAgICAgICAgICAgU2h1ZmZsZShheGlzKSB7CiAgICAgICAgICAgICAgICBjb25zdCBjeCA9IHRoaXMuX2N4OwogICAgICAgICAgICAgICAgY29uc3QgY3kgPSB0aGlzLl9jeTsKICAgICAgICAgICAgICAgIGNvbnN0IGN6ID0gdGhpcy5fY3o7CiAgICAgICAgICAgICAgICBpZiAoY3ggPT09IDAgfHwgY3kgPT09IDAgfHwgY3ogPT09IDApIHJldHVybjsKICAgICAgICAgICAgICAgIGlmIChheGlzID09PSAwKQogICAgICAgICAgICAgICAgICAgIGZvciAobGV0IHkgPSAwOyB5IDwgY3k7ICsreSkKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgeiA9IDA7IHogPCBjejsgKyt6KSB0aGlzLl9TaHVmZmxlSGVscGVyKGF4aXMsIGN4LCAwLCB5LCB6KTsKICAgICAgICAgICAgICAgIGVsc2UgaWYgKGF4aXMgPT09IDEpCiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCBjeDsgKyt4KQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCB6ID0gMDsgeiA8IGN6OyArK3opIHRoaXMuX1NodWZmbGVIZWxwZXIoYXhpcywgY3ksIHgsIDAsIHopOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgY3g7ICsreCkKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgeSA9IDA7IHkgPCBjeTsgKyt5KSB0aGlzLl9TaHVmZmxlSGVscGVyKGF4aXMsIGN6LCB4LCB5LCAwKQogICAgICAgICAgICB9LAogICAgICAgICAgICBEZWxldGUoaW5kZXgsIGF4aXMpIHsKICAgICAgICAgICAgICAgIGluZGV4ID0gTWF0aC5mbG9vcihpbmRleCk7CiAgICAgICAgICAgICAgICBpZiAoaW5kZXggPCAwKSByZXR1cm47CiAgICAgICAgICAgICAgICBjb25zdCBjeCA9IHRoaXMuX2N4OwogICAgICAgICAgICAgICAgY29uc3QgY3kgPSB0aGlzLl9jeTsKICAgICAgICAgICAgICAgIGNvbnN0IGN6ID0gdGhpcy5fY3o7CiAgICAgICAgICAgICAgICBjb25zdCBhcnIgPSB0aGlzLl9hcnI7CiAgICAgICAgICAgICAgICBpZiAoYXhpcyA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgIGlmIChpbmRleCA+PSBjeCkgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIGFyci5zcGxpY2UoaW5kZXgsIDEpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2N4LS0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYXhpcyA9PT0gMSkgewogICAgICAgICAgICAgICAgICAgIGlmIChpbmRleCA+PSBjeSkgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgY3g7ICsreCkgYXJyW3hdLnNwbGljZShpbmRleCwgMSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY3ktLQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBpZiAoaW5kZXggPj0gY3opIHJldHVybjsKICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IGN4OyArK3gpCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IHkgPSAwOyB5IDwgY3k7ICsreSkgYXJyW3hdW3ldLnNwbGljZShpbmRleCwgMSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY3otLQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBJbnNlcnQodmFsdWUsIGluZGV4LCBheGlzKSB7CiAgICAgICAgICAgICAgICBpbmRleCA9IE1hdGguZmxvb3IoaW5kZXgpOwogICAgICAgICAgICAgICAgaWYgKGluZGV4IDwgMCkgcmV0dXJuOwogICAgICAgICAgICAgICAgY29uc3QgY3ggPSB0aGlzLl9jeDsKICAgICAgICAgICAgICAgIGNvbnN0IGN5ID0gdGhpcy5fY3k7CiAgICAgICAgICAgICAgICBjb25zdCBjeiA9IHRoaXMuX2N6OwogICAgICAgICAgICAgICAgY29uc3QgYXJyID0gdGhpcy5fYXJyOwogICAgICAgICAgICAgICAgaWYgKGF4aXMgPT09IDApIHsKICAgICAgICAgICAgICAgICAgICBpZiAoaW5kZXggPiBjeCkgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIGFyci5zcGxpY2UoaW5kZXgsIDAsIEMzLk1ha2VGaWxsZWRBcnJheShjeSwKICAgICAgICAgICAgICAgICAgICAgICAgKCkgPT4gQzMuTWFrZUZpbGxlZEFycmF5KGN6LCB2YWx1ZSkpKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9jeCsrCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGF4aXMgPT09IDEpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoaW5kZXggPiBjeSkgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgY3g7ICsreCkgYXJyW3hdLnNwbGljZShpbmRleCwgMCwgQzMuTWFrZUZpbGxlZEFycmF5KGN6LCB2YWx1ZSkpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2N5KysKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGluZGV4ID4gY3opIHJldHVybjsKICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IGN4OyArK3gpCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IHkgPSAwOyB5IDwgY3k7ICsreSkgYXJyW3hdW3ldLnNwbGljZShpbmRleCwgMCwgdmFsdWUpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2N6KysKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgU3BsaXRTdHJpbmcoc3RyLCBzZXAsIHR5cGUpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHBhcnRzID0gc3RyLnNwbGl0KHNlcCk7CiAgICAgICAgICAgICAgICB0aGlzLlNldFNpemUocGFydHMubGVuZ3RoLCAxLCAxKTsKICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBwYXJ0cy5sZW5ndGg7IGkgPCBsZW47ICsraSkgewogICAgICAgICAgICAgICAgICAgIGxldCB2ID0gcGFydHNbaV07CiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGUgPT09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFN0cmluZyhOdW1iZXIodikpID09PSB2KSB2ID0gTnVtYmVyKHYpCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAyKSB2ID0gTnVtYmVyKHYpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuU2V0KGksCiAgICAgICAgICAgICAgICAgICAgICAgIDAsIDAsIHYpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIEpTT05Mb2FkKGpzb24pIHsKICAgICAgICAgICAgICAgIGxldCBvID0gbnVsbDsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgbyA9IEpTT04ucGFyc2UoanNvbikKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIltDb25zdHJ1Y3RdIEZhaWxlZCB0byBwYXJzZSBKU09OOiAiLCBlcnIpOwogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKCFvWyJjMmFycmF5Il0pIHJldHVybjsKICAgICAgICAgICAgICAgIGNvbnN0IHN6ID0gb1sic2l6ZSJdOwogICAgICAgICAgICAgICAgdGhpcy5fY3ggPSBzelswXTsKICAgICAgICAgICAgICAgIHRoaXMuX2N5ID0gc3pbMV07CiAgICAgICAgICAgICAgICB0aGlzLl9jeiA9IHN6WzJdOwogICAgICAgICAgICAgICAgdGhpcy5fYXJyID0gb1siZGF0YSJdCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIEpTT05Eb3dubG9hZChmaWxlbmFtZSkgewogICAgICAgICAgICAgICAgY29uc3QgdXJsID0gVVJMLmNyZWF0ZU9iamVjdFVSTChuZXcgQmxvYihbdGhpcy5HZXRBc0pzb25TdHJpbmcoKV0sIHsKICAgICAgICAgICAgICAgICAgICB0eXBlOiAiYXBwbGljYXRpb24vanNvbiIKICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuSW52b2tlRG93bmxvYWQodXJsLCBmaWxlbmFtZSkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gewogICAgICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgICAgICBDMy5QbHVnaW5zLkFyci5FeHBzID0gewogICAgICAgICAgICBBdCh4LCB5LCB6KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5BdCh4LCB5IHx8IDAsIHogfHwgMCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgV2lkdGgoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fY3gKICAgICAgICAgICAgfSwKICAgICAgICAgICAgSGVpZ2h0KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2N5CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIERlcHRoKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2N6CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIEN1clgoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fR2V0Rm9yWCgpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIEN1clkoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fR2V0Rm9yWSgpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIEN1clooKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fR2V0Rm9yWigpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIEN1clZhbHVlKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuQXQodGhpcy5fR2V0Rm9yWCgpLCB0aGlzLl9HZXRGb3JZKCksIHRoaXMuX0dldEZvclooKSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgRnJvbnQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5BdCgwLCAwLCAwKQogICAgICAgICAgICB9LAogICAgICAgICAgICBCYWNrKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuQXQodGhpcy5fY3ggLSAxLCAwLCAwKQogICAgICAgICAgICB9LAogICAgICAgICAgICBJbmRleE9mKHYpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGFyciA9IHRoaXMuX2FycjsKICAgICAgICAgICAgICAgIGZvciAobGV0IHggPSAwLCBsZW4gPSB0aGlzLl9jeDsgeCA8IGxlbjsgKyt4KQogICAgICAgICAgICAgICAgICAgIGlmIChhcnJbeF1bMF1bMF0gPT09IHYpIHJldHVybiB4OwogICAgICAgICAgICAgICAgcmV0dXJuIC0xCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIExhc3RJbmRleE9mKHYpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGFyciA9CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYXJyOwogICAgICAgICAgICAgICAgZm9yIChsZXQgeCA9IHRoaXMuX2N4IC0gMTsgeCA+PSAwOyAtLXgpCiAgICAgICAgICAgICAgICAgICAgaWYgKGFyclt4XVswXVswXSA9PT0gdikgcmV0dXJuIHg7CiAgICAgICAgICAgICAgICByZXR1cm4gLTEKICAgICAgICAgICAgfSwKICAgICAgICAgICAgSm9pblN0cmluZyhzZXApIHsKICAgICAgICAgICAgICAgIGxldCBhcnIgPSBbXTsKICAgICAgICAgICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgdGhpcy5fY3g7ICsreCkgYXJyLnB1c2godGhpcy5BdCh4LCAwLCAwKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gYXJyLmpvaW4oc2VwKQogICAgICAgICAgICB9LAogICAgICAgICAgICBBc0pTT04oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5HZXRBc0pzb25TdHJpbmcoKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKCn0KCnsKICAgICd1c2Ugc3RyaWN0JzsgewogICAgICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgICAgICBjb25zdCBhY3Rpb25Qcm9taXNlcyA9IFtdOwogICAgICAgIEMzLlBsdWdpbnMuQXVkaW8gPSBjbGFzcyBBdWRpb1BsdWdpbiBleHRlbmRzIEMzLlNES1BsdWdpbkJhc2UgewogICAgICAgICAgICBjb25zdHJ1Y3RvcihvcHRzKSB7CiAgICAgICAgICAgICAgICBzdXBlcihvcHRzKQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9BZGRBY3Rpb25Qcm9taXNlKHByb21pc2UpIHsKICAgICAgICAgICAgICAgIGFjdGlvblByb21pc2VzLnB1c2gocHJvbWlzZSkKICAgICAgICAgICAgfQogICAgICAgICAgICBzdGF0aWMgYXN5bmMgV2FpdEZvckFsbEFjdGlvblByb21pc2VzKCkgewogICAgICAgICAgICAgICAgYXdhaXQgUHJvbWlzZS5hbGwoYWN0aW9uUHJvbWlzZXMpOwogICAgICAgICAgICAgICAgQzMuY2xlYXJBcnJheShhY3Rpb25Qcm9taXNlcykKICAgICAgICAgICAgfQogICAgICAgICAgICBSZWxlYXNlKCkgewogICAgICAgICAgICAgICAgc3VwZXIuUmVsZWFzZSgpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IHsKICAgICAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICAgICAgY29uc3QgQzNYID0gc2VsZi5DM1g7CiAgICAgICAgQzMuUGx1Z2lucy5BdWRpby5UeXBlID0gY2xhc3MgQXVkaW9UeXBlIGV4dGVuZHMgQzMuU0RLVHlwZUJhc2UgewogICAgICAgICAgICBjb25zdHJ1Y3RvcihvYmplY3RDbGFzcykgewogICAgICAgICAgICAgICAgc3VwZXIob2JqZWN0Q2xhc3MpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgUmVsZWFzZSgpIHsKICAgICAgICAgICAgICAgIHN1cGVyLlJlbGVhc2UoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIE9uQ3JlYXRlKCkge30KICAgICAgICAgICAgR2V0U2NyaXB0SW50ZXJmYWNlQ2xhc3MoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5JQXVkaW9PYmplY3RUeXBlCiAgICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICBmdW5jdGlvbiBHZXRBdWRpb0RPTUludGVyZmFjZSgpIHsKICAgICAgICAgICAgaWYgKHNlbGZbIkMzQXVkaW9fRE9NSW50ZXJmYWNlIl0pIHJldHVybiBzZWxmWyJDM0F1ZGlvX0RPTUludGVyZmFjZSJdOwogICAgICAgICAgICBlbHNlIHRocm93IG5ldyBFcnJvcigiYXVkaW8gc2NyaXB0aW5nIEFQSSBjYW5ub3QgYmUgdXNlZCBoZXJlIC0gbWFrZSBzdXJlIHRoZSBwcm9qZWN0IGlzIHVzaW5nIERPTSBtb2RlLCBub3Qgd29ya2VyIG1vZGUiKTsKICAgICAgICB9CiAgICAgICAgc2VsZi5JQXVkaW9PYmplY3RUeXBlID0gY2xhc3MgSUF1ZGlvT2JqZWN0VHlwZSBleHRlbmRzIHNlbGYuSU9iamVjdENsYXNzIHsKICAgICAgICAgICAgY29uc3RydWN0b3Iob2JqZWN0VHlwZSkgewogICAgICAgICAgICAgICAgc3VwZXIob2JqZWN0VHlwZSkKICAgICAgICAgICAgfQogICAgICAgICAgICBnZXQgYXVkaW9Db250ZXh0KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIEdldEF1ZGlvRE9NSW50ZXJmYWNlKCkuR2V0QXVkaW9Db250ZXh0KCkKICAgICAgICAgICAgfQogICAgICAgICAgICBnZXQgZGVzdGluYXRpb25Ob2RlKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIEdldEF1ZGlvRE9NSW50ZXJmYWNlKCkuR2V0RGVzdGluYXRpb25Ob2RlKCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gewogICAgICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgICAgICBjb25zdCBET01fQ09NUE9ORU5UX0lEID0gImF1ZGlvIjsKICAgICAgICBjb25zdCBMQVRFTkNZX0hJTlRTID0gWyJpbnRlcmFjdGl2ZSIsICJiYWxhbmNlZCIsICJwbGF5YmFjayJdOwogICAgICAgIEMzLlBsdWdpbnMuQXVkaW8uSW5zdGFuY2UgPSBjbGFzcyBBdWRpb0luc3RhbmNlIGV4dGVuZHMgQzMuU0RLSW5zdGFuY2VCYXNlIHsKICAgICAgICAgICAgY29uc3RydWN0b3IoaW5zdCwgcHJvcGVydGllcykgewogICAgICAgICAgICAgICAgc3VwZXIoaW5zdCwgRE9NX0NPTVBPTkVOVF9JRCk7CiAgICAgICAgICAgICAgICB0aGlzLl9uZXh0UGxheVRpbWUgPSAwOwogICAgICAgICAgICAgICAgdGhpcy5fdHJpZ2dlclRhZ3MgPSBbXTsKICAgICAgICAgICAgICAgIHRoaXMuX2VuYWJsZU11bHRpVGFncyA9IHRydWU7CiAgICAgICAgICAgICAgICB0aGlzLl90aW1lU2NhbGVNb2RlID0gMDsKICAgICAgICAgICAgICAgIHRoaXMuX3NhdmVMb2FkTW9kZSA9IDA7CiAgICAgICAgICAgICAgICB0aGlzLl9wbGF5SW5CYWNrZ3JvdW5kID0gZmFsc2U7CiAgICAgICAgICAgICAgICB0aGlzLl9wYW5uaW5nTW9kZWwgPSAxOwogICAgICAgICAgICAgICAgdGhpcy5fZGlzdGFuY2VNb2RlbCA9IDE7CiAgICAgICAgICAgICAgICB0aGlzLl9saXN0ZW5lclBvcyA9IFt0aGlzLl9ydW50aW1lLkdldFZpZXdwb3J0V2lkdGgoKSAvIDIsIHRoaXMuX3J1bnRpbWUuR2V0Vmlld3BvcnRIZWlnaHQoKSAvCiAgICAgICAgICAgICAgICAgICAgMiwgNjAwCiAgICAgICAgICAgICAgICBdOwogICAgICAgICAgICAgICAgdGhpcy5fbGlzdGVuZXJGb3J3YXJkVmVjID0gWzAsIDAsIC0xXTsKICAgICAgICAgICAgICAgIHRoaXMuX2xpc3RlbmVyVXBWZWMgPSBbMCwgMSwgMF07CiAgICAgICAgICAgICAgICB0aGlzLl9yZWZlcmVuY2VEaXN0YW5jZSA9IDYwMDsKICAgICAgICAgICAgICAgIHRoaXMuX21heERpc3RhbmNlID0gMUU0OwogICAgICAgICAgICAgICAgdGhpcy5fcm9sbG9mZkZhY3RvciA9IDE7CiAgICAgICAgICAgICAgICB0aGlzLl9saXN0ZW5lckluc3QgPSBudWxsOwogICAgICAgICAgICAgICAgdGhpcy5fbG9hZExpc3RlbmVyVWlkID0gLTE7CiAgICAgICAgICAgICAgICB0aGlzLl9tYXN0ZXJWb2x1bWUgPSAxOwogICAgICAgICAgICAgICAgdGhpcy5faXNTaWxlbnQgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHRoaXMuX3NhbXBsZVJhdGUgPSAwOwogICAgICAgICAgICAgICAgdGhpcy5fYXVkaW9Db250ZXh0U3RhdGUgPSAic3VzcGVuZGVkIjsKICAgICAgICAgICAgICAgIHRoaXMuX291dHB1dExhdGVuY3kgPSAwOwogICAgICAgICAgICAgICAgdGhpcy5fZWZmZWN0Q291bnQgPSBuZXcgTWFwOwogICAgICAgICAgICAgICAgdGhpcy5fcHJlbG9hZFRvdGFsID0gMDsKICAgICAgICAgICAgICAgIHRoaXMuX3ByZWxvYWRDb3VudCA9IDA7CiAgICAgICAgICAgICAgICB0aGlzLl9idWZmZXJNZXRhZGF0YSA9IG5ldyBNYXA7CiAgICAgICAgICAgICAgICB0aGlzLl9yZW1vdGVVcmxzID0gbmV3IE1hcDsKICAgICAgICAgICAgICAgIGxldCBsYXRlbmN5SGludCA9ICJpbnRlcmFjdGl2ZSI7CiAgICAgICAgICAgICAgICBpZiAocHJvcGVydGllcykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX3RpbWVTY2FsZU1vZGUgPSBwcm9wZXJ0aWVzWzBdOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3NhdmVMb2FkTW9kZSA9IHByb3BlcnRpZXNbMV07CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcGxheUluQmFja2dyb3VuZCA9IHByb3BlcnRpZXNbMl07CiAgICAgICAgICAgICAgICAgICAgbGF0ZW5jeUhpbnQgPSBMQVRFTkNZX0hJTlRTW3Byb3BlcnRpZXNbM11dOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2VuYWJsZU11bHRpVGFncyA9IHByb3BlcnRpZXNbNF07CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcGFubmluZ01vZGVsID0gcHJvcGVydGllc1s1XTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9kaXN0YW5jZU1vZGVsID0gcHJvcGVydGllc1s2XTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9saXN0ZW5lclBvc1syXSA9IHByb3BlcnRpZXNbN107CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVmZXJlbmNlRGlzdGFuY2UgPSBwcm9wZXJ0aWVzWzhdOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX21heERpc3RhbmNlID0gcHJvcGVydGllc1s5XTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9yb2xsb2ZmRmFjdG9yID0gcHJvcGVydGllc1sxMF0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMuX2xhc3RBSVN0YXRlID0gW107CiAgICAgICAgICAgICAgICB0aGlzLl9sYXN0RnhTdGF0ZSA9IFtdOwogICAgICAgICAgICAgICAgdGhpcy5fbGFzdEFuYWx5c2Vyc0RhdGEgPSBbXTsKICAgICAgICAgICAgICAgIHRoaXMuQWRkRE9NTWVzc2FnZUhhbmRsZXJzKFsKICAgICAgICAgICAgICAgICAgICBbInN0YXRlIiwgZSA9PiB0aGlzLl9PblVwZGF0ZVN0YXRlKGUpXSwKICAgICAgICAgICAgICAgICAgICBbImF1ZGlvY29udGV4dC1zdGF0ZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIGUgPT4gdGhpcy5fT25BdWRpb0NvbnRleHRTdGF0ZUNoYW5nZWQoZSkKICAgICAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgICAgIFsiZnhzdGF0ZSIsIGUgPT4gdGhpcy5fT25VcGRhdGVGeFN0YXRlKGUpXSwKICAgICAgICAgICAgICAgICAgICBbInRyaWdnZXIiLCBlID0+IHRoaXMuX09uVHJpZ2dlcihlKV0sCiAgICAgICAgICAgICAgICAgICAgWyJidWZmZXItbWV0YWRhdGEiLCBlID0+IHRoaXMuX09uQnVmZmVyTWV0YWRhdGEoZSldCiAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgIGNvbnN0IHJ0ID0gdGhpcy5HZXRSdW50aW1lKCkuRGlzcGF0Y2hlcigpOwogICAgICAgICAgICAgICAgdGhpcy5fZGlzcG9zYWJsZXMgPSBuZXcgQzMuQ29tcG9zaXRlRGlzcG9zYWJsZShDMy5EaXNwb3NhYmxlLkZyb20ocnQsICJpbnN0YW5jZWRlc3Ryb3kiLCBlID0+IHRoaXMuX09uSW5zdGFuY2VEZXN0cm95ZWQoZS5pbnN0YW5jZSkpLCBDMy5EaXNwb3NhYmxlLkZyb20ocnQsICJhZnRlcmxvYWQiLCAoKSA9PiB0aGlzLl9PbkFmdGVyTG9hZCgpKSwgQzMuRGlzcG9zYWJsZS5Gcm9tKHJ0LCAic3VzcGVuZCIsICgpID0+IHRoaXMuX09uU3VzcGVuZCgpKSwgQzMuRGlzcG9zYWJsZS5Gcm9tKHJ0LCAicmVzdW1lIiwgKCkgPT4gdGhpcy5fT25SZXN1bWUoKSkpOwogICAgICAgICAgICAgICAgdGhpcy5fcnVudGltZS5BZGRMb2FkUHJvbWlzZSh0aGlzLlBvc3RUb0RPTUFzeW5jKCJjcmVhdGUtYXVkaW8tY29udGV4dCIsIHsKICAgICAgICAgICAgICAgICAgICAicHJlbG9hZExpc3QiOiB0aGlzLl9ydW50aW1lLkdldEFzc2V0TWFuYWdlcigpLkdldEF1ZGlvVG9QcmVsb2FkKCkubWFwKG8gPT4gKHsKICAgICAgICAgICAgICAgICAgICAgICAgIm9yaWdpbmFsVXJsIjogby5vcmlnaW5hbFVybCwKICAgICAgICAgICAgICAgICAgICAgICAgInVybCI6IG8udXJsLAogICAgICAgICAgICAgICAgICAgICAgICAidHlwZSI6IG8udHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgImZpbGVTaXplIjogby5maWxlU2l6ZQogICAgICAgICAgICAgICAgICAgIH0pKSwKICAgICAgICAgICAgICAgICAgICAiaXNpT1NDb3Jkb3ZhIjogdGhpcy5fcnVudGltZS5Jc2lPU0NvcmRvdmEoKSwKICAgICAgICAgICAgICAgICAgICAiaXNTYWZhcmkiOiBDMy5QbGF0Zm9ybS5Ccm93c2VyID09PSAiU2FmYXJpIiwKICAgICAgICAgICAgICAgICAgICAidGltZVNjYWxlTW9kZSI6IHRoaXMuX3RpbWVTY2FsZU1vZGUsCiAgICAgICAgICAgICAgICAgICAgImxhdGVuY3lIaW50IjogbGF0ZW5jeUhpbnQsCiAgICAgICAgICAgICAgICAgICAgInBhbm5pbmdNb2RlbCI6IHRoaXMuX3Bhbm5pbmdNb2RlbCwKICAgICAgICAgICAgICAgICAgICAiZGlzdGFuY2VNb2RlbCI6IHRoaXMuX2Rpc3RhbmNlTW9kZWwsCiAgICAgICAgICAgICAgICAgICAgInJlZkRpc3RhbmNlIjogdGhpcy5fcmVmZXJlbmNlRGlzdGFuY2UsCiAgICAgICAgICAgICAgICAgICAgIm1heERpc3RhbmNlIjogdGhpcy5fbWF4RGlzdGFuY2UsCiAgICAgICAgICAgICAgICAgICAgInJvbGxvZmZGYWN0b3IiOiB0aGlzLl9yb2xsb2ZmRmFjdG9yLAogICAgICAgICAgICAgICAgICAgICJsaXN0ZW5lclBvcyI6IHRoaXMuX2xpc3RlbmVyUG9zCiAgICAgICAgICAgICAgICB9KS50aGVuKGluZm8gPT4gewogICAgICAgICAgICAgICAgICAgIHRoaXMuX3NhbXBsZVJhdGUgPSBpbmZvWyJzYW1wbGVSYXRlIl07CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYXVkaW9Db250ZXh0U3RhdGUgPSBpbmZvWyJhdWRpb0NvbnRleHRTdGF0ZSJdOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX291dHB1dExhdGVuY3kgPSBpbmZvWyJvdXRwdXRMYXRlbmN5Il0KICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgIHRoaXMuX1N0YXJ0VGlja2luZygpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgUmVsZWFzZSgpIHsKICAgICAgICAgICAgICAgIHRoaXMuX2xpc3RlbmVySW5zdCA9IG51bGw7CiAgICAgICAgICAgICAgICBzdXBlci5SZWxlYXNlKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBfU3BsaXRUYWdzKHRhZ1N0cikgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuX2VuYWJsZU11bHRpVGFncykgcmV0dXJuIHRhZ1N0ci5zcGxpdCgiICIpLmZpbHRlcihzID0+ICEhcyk7CiAgICAgICAgICAgICAgICBlbHNlIHJldHVybiB0YWdTdHIgPyBbdGFnU3RyXSA6IFtdCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX01hdGNoVGFnTGlzdHModGFnQXJyMSwgdGFnQXJyMikgewogICAgICAgICAgICAgICAgZm9yIChjb25zdCB0MiBvZiB0YWdBcnIyKSB7CiAgICAgICAgICAgICAgICAgICAgbGV0IGZvdW5kID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCB0MSBvZiB0YWdBcnIxKQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoQzMuZXF1YWxzTm9DYXNlKHQxLCB0MikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoIWZvdW5kKSByZXR1cm4gZmFsc2UKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX01hdGNoVGFnTGlzdFRvU3RyKHRhZ0FyciwKICAgICAgICAgICAgICAgIHRhZ1N0cikgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX01hdGNoVGFnTGlzdHModGFnQXJyLCB0aGlzLl9TcGxpdFRhZ3ModGFnU3RyKSkKICAgICAgICAgICAgfQogICAgICAgICAgICBfQWRkQWN0aW9uUHJvbWlzZShwcm9taXNlKSB7CiAgICAgICAgICAgICAgICB0aGlzLkdldFBsdWdpbigpLl9BZGRBY3Rpb25Qcm9taXNlKHByb21pc2UpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX09uSW5zdGFuY2VEZXN0cm95ZWQoaW5zdCkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuX2xpc3RlbmVySW5zdCA9PT0gaW5zdCkgdGhpcy5fbGlzdGVuZXJJbnN0ID0gbnVsbAogICAgICAgICAgICB9CiAgICAgICAgICAgIERiVG9MaW5lYXJOb0NhcCh4KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gTWF0aC5wb3coMTAsIHggLyAyMCkKICAgICAgICAgICAgfQogICAgICAgICAgICBEYlRvTGluZWFyKHgpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHYgPSB0aGlzLkRiVG9MaW5lYXJOb0NhcCh4KTsKICAgICAgICAgICAgICAgIGlmICghaXNGaW5pdGUodikpIHJldHVybiAwOwogICAgICAgICAgICAgICAgcmV0dXJuIE1hdGgubWF4KE1hdGgubWluKHYsIDEpLCAwKQogICAgICAgICAgICB9CiAgICAgICAgICAgIExpbmVhclRvRGJOb0NhcCh4KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gTWF0aC5sb2coeCkgLyBNYXRoLmxvZygxMCkgKiAyMAogICAgICAgICAgICB9CiAgICAgICAgICAgIExpbmVhclRvRGIoeCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuTGluZWFyVG9EYk5vQ2FwKE1hdGgubWF4KE1hdGgubWluKHgsIDEpLCAwKSkKICAgICAgICAgICAgfQogICAgICAgICAgICBfT25TdXNwZW5kKCkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuX3BsYXlJbkJhY2tncm91bmQpIHJldHVybjsKICAgICAgICAgICAgICAgIHRoaXMuUG9zdFRvRE9NKCJzZXQtc3VzcGVuZGVkIiwgewogICAgICAgICAgICAgICAgICAgICJpc1N1c3BlbmRlZCI6IHRydWUKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX09uUmVzdW1lKCkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuX3BsYXlJbkJhY2tncm91bmQpIHJldHVybjsKICAgICAgICAgICAgICAgIHRoaXMuUG9zdFRvRE9NKCJzZXQtc3VzcGVuZGVkIiwgewogICAgICAgICAgICAgICAgICAgICJpc1N1c3BlbmRlZCI6IGZhbHNlCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9PblVwZGF0ZVN0YXRlKGUpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHRpY2tDb3VudCA9IGVbInRpY2tDb3VudCJdOwogICAgICAgICAgICAgICAgdGhpcy5fb3V0cHV0TGF0ZW5jeSA9IGVbIm91dHB1dExhdGVuY3kiXTsKICAgICAgICAgICAgICAgIGNvbnN0IHByZXNlcnZlUGxhY2Vob2xkZXJzID0gdGhpcy5fbGFzdEFJU3RhdGUuZmlsdGVyKGFpID0+IGFpLmhhc093blByb3BlcnR5KCJwbGFjZWhvbGRlciIpICYmIChhaVsicGxhY2Vob2xkZXIiXSA+IHRpY2tDb3VudCB8fCBhaVsicGxhY2Vob2xkZXIiXSA9PT0gLTEpKTsKICAgICAgICAgICAgICAgIHRoaXMuX2xhc3RBSVN0YXRlID0gZVsiYXVkaW9JbnN0YW5jZXMiXTsKICAgICAgICAgICAgICAgIHRoaXMuX2xhc3RBbmFseXNlcnNEYXRhID0gZVsiYW5hbHlzZXJzIl07CiAgICAgICAgICAgICAgICBpZiAocHJlc2VydmVQbGFjZWhvbGRlcnMubGVuZ3RoID4gMCkgQzMuYXBwZW5kQXJyYXkodGhpcy5fbGFzdEFJU3RhdGUsCiAgICAgICAgICAgICAgICAgICAgcHJlc2VydmVQbGFjZWhvbGRlcnMpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX09uQnVmZmVyTWV0YWRhdGEoZSkgewogICAgICAgICAgICAgICAgdGhpcy5fYnVmZmVyTWV0YWRhdGEuc2V0KGVbIm9yaWdpbmFsVXJsIl0sIHsKICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogZVsiZHVyYXRpb24iXQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfQogICAgICAgICAgICBfT25BdWRpb0NvbnRleHRTdGF0ZUNoYW5nZWQoZSkgewogICAgICAgICAgICAgICAgdGhpcy5fYXVkaW9Db250ZXh0U3RhdGUgPSBlWyJhdWRpb0NvbnRleHRTdGF0ZSJdCiAgICAgICAgICAgIH0KICAgICAgICAgICAgR2V0QXVkaW9Db250ZXh0U3RhdGUoKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fcnVudGltZS5Jc0V4cG9ydFRvVmlkZW8oKSkgcmV0dXJuICJydW5uaW5nIjsKICAgICAgICAgICAgICAgIGVsc2UgcmV0dXJuIHRoaXMuX2F1ZGlvQ29udGV4dFN0YXRlCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX09uVXBkYXRlRnhTdGF0ZShlKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9sYXN0RnhTdGF0ZSA9IGVbImZ4c3RhdGUiXQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9HZXRGaXJzdEF1ZGlvU3RhdGVCeVRhZ3ModGFnU3RyKSB7CiAgICAgICAgICAgICAgICBjb25zdCB0YWdBcnIgPSB0aGlzLl9TcGxpdFRhZ3ModGFnU3RyKTsKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgYSBvZiB0aGlzLl9sYXN0QUlTdGF0ZSkKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fTWF0Y2hUYWdMaXN0cyhhWyJ0YWdzIl0sIHRhZ0FycikpIHJldHVybiBhOwogICAgICAgICAgICAgICAgcmV0dXJuIG51bGwKICAgICAgICAgICAgfQogICAgICAgICAgICBfSXNUYWdQbGF5aW5nKHRhZ1N0cikgewogICAgICAgICAgICAgICAgY29uc3QgdGFnQXJyID0gdGhpcy5fU3BsaXRUYWdzKHRhZ1N0cik7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fbGFzdEFJU3RhdGUuc29tZShhaSA9PiB0aGlzLl9NYXRjaFRhZ0xpc3RzKGFpWyJ0YWdzIl0sIHRhZ0FycikgJiYgYWlbImlzUGxheWluZyJdKQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9NYXliZU1hcmtBc1BsYXlpbmcob3JpZ2luYWxVcmwsIHRhZ1N0ciwgaXNNdXNpYywgaXNMb29waW5nLCB2b2wpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9Jc1RhZ1BsYXlpbmcodGFnU3RyKSkgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgICBjb25zdCBidWZmZXJNZXRhID0gdGhpcy5fYnVmZmVyTWV0YWRhdGEuZ2V0KG9yaWdpbmFsVXJsKTsKICAgICAgICAgICAgICAgIGNvbnN0IHN0YXRlID0gewogICAgICAgICAgICAgICAgICAgICJ0YWdzIjogdGhpcy5fU3BsaXRUYWdzKHRhZ1N0ciksCiAgICAgICAgICAgICAgICAgICAgImR1cmF0aW9uIjogYnVmZmVyTWV0YSA/IGJ1ZmZlck1ldGEuZHVyYXRpb24gOiAwLAogICAgICAgICAgICAgICAgICAgICJ2b2x1bWUiOiB2b2wsCiAgICAgICAgICAgICAgICAgICAgImlzUGxheWluZyI6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgInBsYXliYWNrVGltZSI6IDAsCiAgICAgICAgICAgICAgICAgICAgInBsYXliYWNrUmF0ZSI6IDEsCiAgICAgICAgICAgICAgICAgICAgInVpZCI6IC0xLAogICAgICAgICAgICAgICAgICAgICJidWZmZXJPcmlnaW5hbFVybCI6IG9yaWdpbmFsVXJsLAogICAgICAgICAgICAgICAgICAgICJidWZmZXJVcmwiOiAiIiwKICAgICAgICAgICAgICAgICAgICAiYnVmZmVyVHlwZSI6ICIiLAogICAgICAgICAgICAgICAgICAgICJpc011c2ljIjogaXNNdXNpYywKICAgICAgICAgICAgICAgICAgICAiaXNMb29waW5nIjogaXNMb29waW5nLAogICAgICAgICAgICAgICAgICAgICJpc011dGVkIjogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgInJlc3VtZVBvc2l0aW9uIjogMCwKICAgICAgICAgICAgICAgICAgICAicGFuIjogbnVsbCwKICAgICAgICAgICAgICAgICAgICAicGxhY2Vob2xkZXIiOiAtMQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIHRoaXMuX2xhc3RBSVN0YXRlLnB1c2goc3RhdGUpOwogICAgICAgICAgICAgICAgcmV0dXJuIHN0YXRlCiAgICAgICAgICAgIH0KICAgICAgICAgICAgYXN5bmMgX09uVHJpZ2dlcihlKSB7CiAgICAgICAgICAgICAgICBjb25zdCB0eXBlID0gZVsidHlwZSJdOwogICAgICAgICAgICAgICAgdGhpcy5fdHJpZ2dlclRhZ3MgPSBlWyJ0YWdzIl07CiAgICAgICAgICAgICAgICBjb25zdCBhaUlkID0gZVsiYWlpZCJdOwogICAgICAgICAgICAgICAgaWYgKHR5cGUgPT09ICJlbmRlZCIpIHsKICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGFpU3RhdGUgb2YgdGhpcy5fbGFzdEFJU3RhdGUpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhaVN0YXRlWyJhaWlkIl0gPT09IGFpSWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFpU3RhdGVbImlzUGxheWluZyJdID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5UcmlnZ2VyQXN5bmMoQzMuUGx1Z2lucy5BdWRpby5DbmRzLk9uRW5kZWQpCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICJmYWRlLWVuZGVkIikgYXdhaXQgdGhpcy5UcmlnZ2VyQXN5bmMoQzMuUGx1Z2lucy5BdWRpby5DbmRzLk9uRmFkZUVuZGVkKQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9NYXRjaFRyaWdnZXJUYWcodGFnU3RyKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fTWF0Y2hUYWdMaXN0VG9TdHIodGhpcy5fdHJpZ2dlclRhZ3MsCiAgICAgICAgICAgICAgICAgICAgdGFnU3RyKQogICAgICAgICAgICB9CiAgICAgICAgICAgIFRpY2soKSB7CiAgICAgICAgICAgICAgICBjb25zdCBvID0gewogICAgICAgICAgICAgICAgICAgICJ0aW1lU2NhbGUiOiB0aGlzLl9ydW50aW1lLkdldFRpbWVTY2FsZSgpLAogICAgICAgICAgICAgICAgICAgICJnYW1lVGltZSI6IHRoaXMuX3J1bnRpbWUuR2V0R2FtZVRpbWVSYXcoKSwKICAgICAgICAgICAgICAgICAgICAiaW5zdFBhbnMiOiB0aGlzLkdldEluc3RhbmNlUGFucygpLAogICAgICAgICAgICAgICAgICAgICJ0aWNrQ291bnQiOiB0aGlzLl9ydW50aW1lLkdldFRpY2tDb3VudE5vU2F2ZSgpCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgaWYgKHRoaXMuX2xpc3RlbmVySW5zdCkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHdpID0gdGhpcy5fbGlzdGVuZXJJbnN0LkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2xpc3RlbmVyUG9zWzBdID0gd2kuR2V0WCgpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2xpc3RlbmVyUG9zWzFdID0gd2kuR2V0WSgpOwogICAgICAgICAgICAgICAgICAgIG9bImxpc3RlbmVyUG9zIl0gPSB0aGlzLl9saXN0ZW5lclBvczsKICAgICAgICAgICAgICAgICAgICBvWyJsaXN0ZW5lck9yaWVudGF0aW9uIl0gPSBbLi4udGhpcy5fbGlzdGVuZXJGb3J3YXJkVmVjLCAuLi50aGlzLl9saXN0ZW5lclVwVmVjXQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5Qb3N0VG9ET00oInRpY2siLCBvKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJvdGF0ZVB0QXJvdW5kKHB4LCBweSwgYSwgb3gsIG95KSB7CiAgICAgICAgICAgICAgICBpZiAoYSA9PT0gMCkgcmV0dXJuIFtweCwKICAgICAgICAgICAgICAgICAgICBweQogICAgICAgICAgICAgICAgXTsKICAgICAgICAgICAgICAgIGNvbnN0IHNpbl9hID0gTWF0aC5zaW4oYSk7CiAgICAgICAgICAgICAgICBjb25zdCBjb3NfYSA9IE1hdGguY29zKGEpOwogICAgICAgICAgICAgICAgcHggLT0gb3g7CiAgICAgICAgICAgICAgICBweSAtPSBveTsKICAgICAgICAgICAgICAgIGNvbnN0IGxlZnRfc2luX2EgPSBweCAqIHNpbl9hOwogICAgICAgICAgICAgICAgY29uc3QgdG9wX3Npbl9hID0gcHkgKiBzaW5fYTsKICAgICAgICAgICAgICAgIGNvbnN0IGxlZnRfY29zX2EgPSBweCAqIGNvc19hOwogICAgICAgICAgICAgICAgY29uc3QgdG9wX2Nvc19hID0gcHkgKiBjb3NfYTsKICAgICAgICAgICAgICAgIHB4ID0gbGVmdF9jb3NfYSAtIHRvcF9zaW5fYTsKICAgICAgICAgICAgICAgIHB5ID0gdG9wX2Nvc19hICsgbGVmdF9zaW5fYTsKICAgICAgICAgICAgICAgIHB4ICs9IG94OwogICAgICAgICAgICAgICAgcHkgKz0gb3k7CiAgICAgICAgICAgICAgICByZXR1cm4gW3B4LCBweV0KICAgICAgICAgICAgfQogICAgICAgICAgICBHZXRJbnN0YW5jZVBhbnMoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fbGFzdEFJU3RhdGUuZmlsdGVyKGFpID0+IGFpWyJ1aWQiXSAhPT0gLTEpLm1hcChhaSA9PiB0aGlzLl9ydW50aW1lLkdldEluc3RhbmNlQnlVSUQoYWlbInVpZCJdKSkuZmlsdGVyKGluc3QgPT4gaW5zdCkubWFwKGluc3QgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHdpID0gaW5zdC5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBsYXllckFuZ2xlID0gd2kuR2V0TGF5ZXIoKS5HZXRBbmdsZSgpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IFt4LCB5XSA9IHRoaXMucm90YXRlUHRBcm91bmQod2kuR2V0WCgpLAogICAgICAgICAgICAgICAgICAgICAgICB3aS5HZXRZKCksIC1sYXllckFuZ2xlLCB0aGlzLl9saXN0ZW5lclBvc1swXSwgdGhpcy5fbGlzdGVuZXJQb3NbMV0pOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICJ1aWQiOiBpbnN0LkdldFVJRCgpLAogICAgICAgICAgICAgICAgICAgICAgICAieCI6IHgsCiAgICAgICAgICAgICAgICAgICAgICAgICJ5IjogeSwKICAgICAgICAgICAgICAgICAgICAgICAgInoiOiB3aS5HZXRUb3RhbFpFbGV2YXRpb24oKSwKICAgICAgICAgICAgICAgICAgICAgICAgImFuZ2xlIjogd2kuR2V0QW5nbGUoKSAtIGxheWVyQW5nbGUKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9CiAgICAgICAgICAgIEdldEFuYWx5c2VyRGF0YSh0YWdTdHIsIGluZGV4KSB7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IG8gb2YgdGhpcy5fbGFzdEFuYWx5c2Vyc0RhdGEpCiAgICAgICAgICAgICAgICAgICAgaWYgKG8uaW5kZXggPT09IGluZGV4ICYmIEMzLmVxdWFsc05vQ2FzZShvWyJ0YWciXSwgdGFnU3RyKSkgcmV0dXJuIG87CiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbAogICAgICAgICAgICB9CiAgICAgICAgICAgIF9JbmNyZW1lbnRFZmZlY3RDb3VudCh0YWdTdHIpIHsKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgdGFnIG9mIHRoaXMuX1NwbGl0VGFncyh0YWdTdHIpKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgbG93ZXJUYWcgPSB0YWcudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9lZmZlY3RDb3VudC5zZXQobG93ZXJUYWcsICh0aGlzLl9lZmZlY3RDb3VudC5nZXQobG93ZXJUYWcpIHx8IDApICsgMSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBfU2hvdWxkU2F2ZShhaSkgewogICAgICAgICAgICAgICAgaWYgKGFpLmhhc093blByb3BlcnR5KCJwbGFjZWhvbGRlciIpKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fc2F2ZUxvYWRNb2RlID09PSAzKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICBlbHNlIGlmIChhaVsiaXNNdXNpYyJdICYmIHRoaXMuX3NhdmVMb2FkTW9kZSA9PT0gMSkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgZWxzZSBpZiAoIWFpWyJpc011c2ljIl0gJiYgdGhpcy5fc2F2ZUxvYWRNb2RlID09PSAyKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICBlbHNlIHJldHVybiB0cnVlCiAgICAgICAgICAgIH0KICAgICAgICAgICAgU2F2ZVRvSnNvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgImlzU2lsZW50IjogdGhpcy5faXNTaWxlbnQsCiAgICAgICAgICAgICAgICAgICAgIm1hc3RlclZvbHVtZSI6IHRoaXMuX21hc3RlclZvbHVtZSwKICAgICAgICAgICAgICAgICAgICAibGlzdGVuZXJaIjogdGhpcy5fbGlzdGVuZXJQb3NbMl0sCiAgICAgICAgICAgICAgICAgICAgImxpc3RlbmVyRm9yd2FyZFZlYyI6IHRoaXMuX2xpc3RlbmVyRm9yd2FyZFZlYywKICAgICAgICAgICAgICAgICAgICAibGlzdGVuZXJVcFZlYyI6IHRoaXMuX2xpc3RlbmVyVXBWZWMsCiAgICAgICAgICAgICAgICAgICAgImxpc3RlbmVyVWlkIjogdGhpcy5fbGlzdGVuZXJJbnN0ID8gdGhpcy5fbGlzdGVuZXJJbnN0LkdldFVJRCgpIDogLTEsCiAgICAgICAgICAgICAgICAgICAgInJlbW90ZVVybHMiOiBbLi4udGhpcy5fcmVtb3RlVXJscy5lbnRyaWVzKCldLAogICAgICAgICAgICAgICAgICAgICJwbGF5aW5nIjogdGhpcy5fbGFzdEFJU3RhdGUuZmlsdGVyKGFpID0+CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX1Nob3VsZFNhdmUoYWkpKSwKICAgICAgICAgICAgICAgICAgICAiZWZmZWN0cyI6IHRoaXMuX2xhc3RGeFN0YXRlLAogICAgICAgICAgICAgICAgICAgICJhbmFseXNlcnMiOiB0aGlzLl9sYXN0QW5hbHlzZXJzRGF0YQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIExvYWRGcm9tSnNvbihvKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9pc1NpbGVudCA9IG9bImlzU2lsZW50Il07CiAgICAgICAgICAgICAgICB0aGlzLl9tYXN0ZXJWb2x1bWUgPSBvWyJtYXN0ZXJWb2x1bWUiXTsKICAgICAgICAgICAgICAgIHRoaXMuX2xpc3RlbmVyUG9zWzJdID0gb1sibGlzdGVuZXJaIl07CiAgICAgICAgICAgICAgICB0aGlzLl9saXN0ZW5lckluc3QgPSBudWxsOwogICAgICAgICAgICAgICAgdGhpcy5fbG9hZExpc3RlbmVyVWlkID0gb1sibGlzdGVuZXJVaWQiXTsKICAgICAgICAgICAgICAgIGlmIChvLmhhc093blByb3BlcnR5KCJsaXN0ZW5lckZvcndhcmRWZWMiKSkgdGhpcy5fbGlzdGVuZXJGb3J3YXJkVmVjID0gb1sibGlzdGVuZXJGb3J3YXJkVmVjIl07CiAgICAgICAgICAgICAgICBlbHNlIHRoaXMuX2xpc3RlbmVyRm9yd2FyZFZlYyA9IFswLCAwLCAtMV07CiAgICAgICAgICAgICAgICBpZiAoby5oYXNPd25Qcm9wZXJ0eSgibGlzdGVuZXJVcFZlYyIpKSB0aGlzLl9saXN0ZW5lclVwVmVjID0gb1sibGlzdGVuZXJVcFZlYyJdOwogICAgICAgICAgICAgICAgZWxzZSB0aGlzLl9saXN0ZW5lclVwVmVjID0gWzAsCiAgICAgICAgICAgICAgICAgICAgMSwgMAogICAgICAgICAgICAgICAgXTsKICAgICAgICAgICAgICAgIHRoaXMuX3JlbW90ZVVybHMuY2xlYXIoKTsKICAgICAgICAgICAgICAgIGlmIChvWyJyZW1vdGVVcmxzIl0pCiAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBbaywgdl0gb2Ygb1sicmVtb3RlVXJscyJdKSB0aGlzLl9yZW1vdGVVcmxzLnNldChrLCB2KTsKICAgICAgICAgICAgICAgIHRoaXMuX2xhc3RBSVN0YXRlID0gb1sicGxheWluZyJdOwogICAgICAgICAgICAgICAgZm9yIChjb25zdCBhIG9mIHRoaXMuX2xhc3RBSVN0YXRlKQogICAgICAgICAgICAgICAgICAgIGlmIChhLmhhc093blByb3BlcnR5KCJ0YWciKSAmJiAhYS5oYXNPd25Qcm9wZXJ0eSgidGFncyIpKSBhWyJ0YWdzIl0gPSBbYVsidGFnIl1dLmZpbHRlcihzID0+ICEhcyk7CiAgICAgICAgICAgICAgICB0aGlzLl9sYXN0RnhTdGF0ZSA9IG9bImVmZmVjdHMiXTsKICAgICAgICAgICAgICAgIHRoaXMuX2xhc3RBbmFseXNlcnNEYXRhID0gb1siYW5hbHlzZXJzIl0KICAgICAgICAgICAgfQogICAgICAgICAgICBfT25BZnRlckxvYWQoKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fbG9hZExpc3RlbmVyVWlkICE9PSAtMSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX2xpc3RlbmVySW5zdCA9IHRoaXMuX3J1bnRpbWUuR2V0SW5zdGFuY2VCeVVJRCh0aGlzLl9sb2FkTGlzdGVuZXJVaWQpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2xvYWRMaXN0ZW5lclVpZCA9IC0xOwogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9saXN0ZW5lckluc3QpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgd2kgPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fbGlzdGVuZXJJbnN0LkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9saXN0ZW5lclBvc1swXSA9IHdpLkdldFgoKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fbGlzdGVuZXJQb3NbMV0gPSB3aS5HZXRZKCkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGFpIG9mIHRoaXMuX2xhc3RBSVN0YXRlKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5mbyA9IHRoaXMuX3J1bnRpbWUuR2V0QXNzZXRNYW5hZ2VyKCkuR2V0UHJvamVjdEF1ZGlvRmlsZVVybChhaVsiYnVmZmVyT3JpZ2luYWxVcmwiXSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGluZm8pIHsKICAgICAgICAgICAgICAgICAgICAgICAgYWlbImJ1ZmZlclVybCJdID0gaW5mby51cmw7CiAgICAgICAgICAgICAgICAgICAgICAgIGFpWyJidWZmZXJUeXBlIl0gPSBpbmZvLnR5cGUKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgYWlbImJ1ZmZlclVybCJdID0gbnVsbAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZm9yIChjb25zdCBmeENoYWluRGF0YSBvZiBPYmplY3QudmFsdWVzKHRoaXMuX2xhc3RGeFN0YXRlKSkKICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGZ4RGF0YSBvZiBmeENoYWluRGF0YSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZ4RGF0YS5oYXNPd25Qcm9wZXJ0eSgiYnVmZmVyT3JpZ2luYWxVcmwiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5mbyA9IHRoaXMuX3J1bnRpbWUuR2V0QXNzZXRNYW5hZ2VyKCkuR2V0UHJvamVjdEF1ZGlvRmlsZVVybChmeERhdGFbImJ1ZmZlck9yaWdpbmFsVXJsIl0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluZm8pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmeERhdGFbImJ1ZmZlclVybCJdID0gaW5mby51cmw7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnhEYXRhWyJidWZmZXJUeXBlIl0gPSBpbmZvLnR5cGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5Qb3N0VG9ET00oImxvYWQtc3RhdGUiLCB7CiAgICAgICAgICAgICAgICAgICAgInNhdmVMb2FkTW9kZSI6IHRoaXMuX3NhdmVMb2FkTW9kZSwKICAgICAgICAgICAgICAgICAgICAidGltZVNjYWxlIjogdGhpcy5fcnVudGltZS5HZXRUaW1lU2NhbGUoKSwKICAgICAgICAgICAgICAgICAgICAiZ2FtZVRpbWUiOiB0aGlzLl9ydW50aW1lLkdldEdhbWVUaW1lUmF3KCksCiAgICAgICAgICAgICAgICAgICAgImxpc3RlbmVyUG9zIjogdGhpcy5fbGlzdGVuZXJQb3MsCiAgICAgICAgICAgICAgICAgICAgImxpc3RlbmVyT3JpZW50YXRpb24iOiBbLi4udGhpcy5fbGlzdGVuZXJGb3J3YXJkVmVjLCAuLi50aGlzLl9saXN0ZW5lclVwVmVjXSwKICAgICAgICAgICAgICAgICAgICAiaXNTaWxlbnQiOiB0aGlzLl9pc1NpbGVudCwKICAgICAgICAgICAgICAgICAgICAibWFzdGVyVm9sdW1lIjogdGhpcy5fbWFzdGVyVm9sdW1lLAogICAgICAgICAgICAgICAgICAgICJwbGF5aW5nIjogdGhpcy5fbGFzdEFJU3RhdGUuZmlsdGVyKGFpID0+IGFpWyJidWZmZXJVcmwiXSAhPT0gbnVsbCksCiAgICAgICAgICAgICAgICAgICAgImVmZmVjdHMiOiB0aGlzLl9sYXN0RnhTdGF0ZQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfQogICAgICAgICAgICBHZXREZWJ1Z2dlclByb3BlcnRpZXMoKSB7CiAgICAgICAgICAgICAgICBjb25zdCBmeFByb3BzID0gW107CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IFt0YWcsIGZ4Q2hhaW5EYXRhXSBvZiBPYmplY3QuZW50cmllcyh0aGlzLl9sYXN0RnhTdGF0ZSkpIGZ4UHJvcHMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgbmFtZTogIiQiICsgdGFnLAogICAgICAgICAgICAgICAgICAgIHZhbHVlOiBmeENoYWluRGF0YS5tYXAoZCA9PiBkWyJ0eXBlIl0pLmpvaW4oIiwgIikKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgY29uc3QgcHJlZml4ID0gInBsdWdpbnMuYXVkaW8uZGVidWdnZXIiOwogICAgICAgICAgICAgICAgcmV0dXJuIFt7CiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHByZWZpeCArICIudGFnLWVmZmVjdHMiLAogICAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IGZ4UHJvcHMKICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICB0aXRsZTogcHJlZml4ICsgIi5jdXJyZW50bHktcGxheWluZyIsCiAgICAgICAgICAgICAgICAgICAgcHJvcGVydGllczogW3sKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogcHJlZml4ICsgIi5jdXJyZW50bHktcGxheWluZy1jb3VudCIsCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLl9sYXN0QUlTdGF0ZS5sZW5ndGgKICAgICAgICAgICAgICAgICAgICB9LCAuLi50aGlzLl9sYXN0QUlTdGF0ZS5tYXAoKHMsIGluZGV4KSA9PiAoewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiJCMiICsgaW5kZXgsCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBgJHtzWyJidWZmZXJPcmlnaW5hbFVybCJdfSAoIiR7c1sidGFncyJdfSIpICR7TWF0aC5yb3VuZChzWyJwbGF5YmFja1RpbWUiXSoxMCkvMTB9IC8gJHtNYXRoLnJvdW5kKHNbImR1cmF0aW9uIl0qCjEwKS8xMH1gCiAgICAgICAgICAgICAgICAgICAgfSkpXQogICAgICAgICAgICAgICAgfV0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gewogICAgICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgICAgICBDMy5QbHVnaW5zLkF1ZGlvLkNuZHMgPSB7CiAgICAgICAgICAgIE9uRW5kZWQodGFnU3RyKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fTWF0Y2hUcmlnZ2VyVGFnKHRhZ1N0cikKICAgICAgICAgICAgfSwKICAgICAgICAgICAgT25GYWRlRW5kZWQodGFnU3RyKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fTWF0Y2hUcmlnZ2VyVGFnKHRhZ1N0cikKICAgICAgICAgICAgfSwKICAgICAgICAgICAgUHJlbG9hZHNDb21wbGV0ZSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9wcmVsb2FkQ291bnQgPT09IHRoaXMuX3ByZWxvYWRUb3RhbAogICAgICAgICAgICB9LAogICAgICAgICAgICBBZHZhbmNlZEF1ZGlvU3VwcG9ydGVkKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgSXNTaWxlbnQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5faXNTaWxlbnQKICAgICAgICAgICAgfSwKICAgICAgICAgICAgSXNBbnlQbGF5aW5nKCkgewogICAgICAgICAgICAgICAgZm9yIChjb25zdCBhaSBvZiB0aGlzLl9sYXN0QUlTdGF0ZSkKICAgICAgICAgICAgICAgICAgICBpZiAoYWlbImlzUGxheWluZyJdKSByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZQogICAgICAgICAgICB9LAogICAgICAgICAgICBJc1RhZ1BsYXlpbmcodGFnU3RyKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fSXNUYWdQbGF5aW5nKHRhZ1N0cikKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gewogICAgICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgICAgICBjb25zdCBGSUxURVJfVFlQRVMgPSBbImxvd3Bhc3MiLCAiaGlnaHBhc3MiLCAiYmFuZHBhc3MiLCAibG93c2hlbGYiLCAiaGlnaHNoZWxmIiwgInBlYWtpbmciLCAibm90Y2giLCAiYWxscGFzcyJdOwogICAgICAgIEMzLlBsdWdpbnMuQXVkaW8uQWN0cyA9IHsKICAgICAgICAgICAgUGxheShmaWxlLCBsb29waW5nLCB2b2wsIHN0ZXJlb1BhbiwgdGFnU3RyKSB7CiAgICAgICAgICAgICAgICBjb25zdCByZXQgPSBDMy5QbHVnaW5zLkF1ZGlvLkFjdHMuX0RvUGxheS5jYWxsKHRoaXMsIGZpbGUsIGxvb3BpbmcsIHZvbCwgc3RlcmVvUGFuLCB0YWdTdHIpOwogICAgICAgICAgICAgICAgdGhpcy5fQWRkQWN0aW9uUHJvbWlzZShyZXQpOwogICAgICAgICAgICAgICAgcmV0dXJuIHJldAogICAgICAgICAgICB9LAogICAgICAgICAgICBQbGF5RnJvbVRpbWVsaW5lKGZpbGUsIHZvbCwgdGFnU3RyLCBzdGFydE9mZnNldCkgewogICAgICAgICAgICAgICAgQzMuUGx1Z2lucy5BdWRpby5BY3RzLl9Eb1BsYXkuY2FsbCh0aGlzLCBmaWxlLCAwLCB2b2wsIDAsIHRhZ1N0ciwgc3RhcnRPZmZzZXQpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGFzeW5jIF9Eb1BsYXkoZmlsZSwgbG9vcGluZywgdm9sLCBzdGVyZW9QYW4sIHRhZ1N0ciwgc3RhcnRPZmZzZXQpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9pc1NpbGVudCkgcmV0dXJuOwogICAgICAgICAgICAgICAgY29uc3QgaXNNdXNpYyA9IGZpbGVbMV07CiAgICAgICAgICAgICAgICBjb25zdCBpbmZvID0gdGhpcy5fcnVudGltZS5HZXRBc3NldE1hbmFnZXIoKS5HZXRQcm9qZWN0QXVkaW9GaWxlVXJsKGZpbGVbMF0pOwogICAgICAgICAgICAgICAgaWYgKCFpbmZvKSByZXR1cm47CiAgICAgICAgICAgICAgICBjb25zdCBuZXh0UGxheVRpbWUgPSB0aGlzLl9uZXh0UGxheVRpbWU7CiAgICAgICAgICAgICAgICB0aGlzLl9uZXh0UGxheVRpbWUgPSAwOwogICAgICAgICAgICAgICAgY29uc3Qgc3RhdGUgPSB0aGlzLl9NYXliZU1hcmtBc1BsYXlpbmcoZmlsZVswXSwgdGFnU3RyLCBpc011c2ljLCBsb29waW5nICE9PSAwLCB0aGlzLkRiVG9MaW5lYXIodm9sKSk7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuUG9zdFRvRE9NQXN5bmMoInBsYXkiLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICJvcmlnaW5hbFVybCI6IGZpbGVbMF0sCiAgICAgICAgICAgICAgICAgICAgICAgICJ1cmwiOiBpbmZvLnVybCwKICAgICAgICAgICAgICAgICAgICAgICAgInR5cGUiOiBpbmZvLnR5cGUsCiAgICAgICAgICAgICAgICAgICAgICAgICJpc011c2ljIjogaXNNdXNpYywKICAgICAgICAgICAgICAgICAgICAgICAgInRhZ3MiOiB0aGlzLl9TcGxpdFRhZ3ModGFnU3RyKSwKICAgICAgICAgICAgICAgICAgICAgICAgImlzTG9vcGluZyI6IGxvb3BpbmcgIT09IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICJ2b2wiOiB0aGlzLkRiVG9MaW5lYXIodm9sKSwKICAgICAgICAgICAgICAgICAgICAgICAgInN0ZXJlb1BhbiI6IEMzLmNsYW1wKHN0ZXJlb1BhbiAvIDEwMCwgLTEsIDEpLAogICAgICAgICAgICAgICAgICAgICAgICAicG9zIjogc3RhcnRPZmZzZXQgfHwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDAsCiAgICAgICAgICAgICAgICAgICAgICAgICJvZmYiOiBuZXh0UGxheVRpbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICJ0cnVlQ2xvY2siOiAhIXNlbGZbIkMzX0dldEF1ZGlvQ29udGV4dEN1cnJlbnRUaW1lIl0KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICAgICBpZiAoc3RhdGUpIHN0YXRlWyJwbGFjZWhvbGRlciJdID0gdGhpcy5fcnVudGltZS5HZXRUaWNrQ291bnROb1NhdmUoKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBhc3luYyBQbGF5QXRQb3NpdGlvbihmaWxlLCBsb29waW5nLCB2b2wsIHgsIHksIHosIGFuZ2xlLCBpbm5lckFuZ2xlLCBvdXRlckFuZ2xlLCBvdXRlckdhaW4sIHRhZ1N0cikgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuX2lzU2lsZW50KSByZXR1cm47CiAgICAgICAgICAgICAgICBjb25zdCBpc011c2ljID0gZmlsZVsxXTsKICAgICAgICAgICAgICAgIGNvbnN0IGluZm8gPSB0aGlzLl9ydW50aW1lLkdldEFzc2V0TWFuYWdlcigpLkdldFByb2plY3RBdWRpb0ZpbGVVcmwoZmlsZVswXSk7CiAgICAgICAgICAgICAgICBpZiAoIWluZm8pIHJldHVybjsKICAgICAgICAgICAgICAgIGNvbnN0IG5leHRQbGF5VGltZSA9IHRoaXMuX25leHRQbGF5VGltZTsKICAgICAgICAgICAgICAgIHRoaXMuX25leHRQbGF5VGltZSA9IDA7CiAgICAgICAgICAgICAgICBjb25zdCBzdGF0ZSA9IHRoaXMuX01heWJlTWFya0FzUGxheWluZyhmaWxlWzBdLCB0YWdTdHIsIGlzTXVzaWMsIGxvb3BpbmcgIT09CiAgICAgICAgICAgICAgICAgICAgMCwgdGhpcy5EYlRvTGluZWFyKHZvbCkpOwogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLlBvc3RUb0RPTUFzeW5jKCJwbGF5IiwgewogICAgICAgICAgICAgICAgICAgICAgICAib3JpZ2luYWxVcmwiOiBmaWxlWzBdLAogICAgICAgICAgICAgICAgICAgICAgICAidXJsIjogaW5mby51cmwsCiAgICAgICAgICAgICAgICAgICAgICAgICJ0eXBlIjogaW5mby50eXBlLAogICAgICAgICAgICAgICAgICAgICAgICAiaXNNdXNpYyI6IGlzTXVzaWMsCiAgICAgICAgICAgICAgICAgICAgICAgICJ0YWdzIjogdGhpcy5fU3BsaXRUYWdzKHRhZ1N0ciksCiAgICAgICAgICAgICAgICAgICAgICAgICJpc0xvb3BpbmciOiBsb29waW5nICE9PSAwLAogICAgICAgICAgICAgICAgICAgICAgICAidm9sIjogdGhpcy5EYlRvTGluZWFyKHZvbCksCiAgICAgICAgICAgICAgICAgICAgICAgICJwb3MiOiAwLAogICAgICAgICAgICAgICAgICAgICAgICAib2ZmIjogbmV4dFBsYXlUaW1lLAogICAgICAgICAgICAgICAgICAgICAgICAidHJ1ZUNsb2NrIjogISFzZWxmWyJDM19HZXRBdWRpb0NvbnRleHRDdXJyZW50VGltZSJdLAogICAgICAgICAgICAgICAgICAgICAgICAicGFubmluZyI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ4IjogeCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ5IjogeSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ6IjogeiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJhbmdsZSI6IEMzLnRvUmFkaWFucyhhbmdsZSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiaW5uZXJBbmdsZSI6IEMzLnRvUmFkaWFucyhpbm5lckFuZ2xlKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJvdXRlckFuZ2xlIjogQzMudG9SYWRpYW5zKG91dGVyQW5nbGUpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIm91dGVyR2FpbiI6IHRoaXMuRGJUb0xpbmVhcihvdXRlckdhaW4pCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICAgICBpZiAoc3RhdGUpIHN0YXRlWyJwbGFjZWhvbGRlciJdID0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcnVudGltZS5HZXRUaWNrQ291bnROb1NhdmUoKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBhc3luYyBQbGF5QXRPYmplY3QoZmlsZSwgbG9vcGluZywgdm9sLCBvYmplY3RDbGFzcywgaW5uZXJBbmdsZSwgb3V0ZXJBbmdsZSwgb3V0ZXJHYWluLCB0YWdTdHIpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9pc1NpbGVudCkgcmV0dXJuOwogICAgICAgICAgICAgICAgaWYgKCFvYmplY3RDbGFzcykgcmV0dXJuOwogICAgICAgICAgICAgICAgY29uc3QgaW5zdCA9IG9iamVjdENsYXNzLkdldEZpcnN0UGlja2VkKCk7CiAgICAgICAgICAgICAgICBpZiAoIWluc3QgfHwgIWluc3QuR2V0V29ybGRJbmZvKCkpIHJldHVybjsKICAgICAgICAgICAgICAgIGNvbnN0IHdpID0gaW5zdC5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgICAgIGNvbnN0IGxheWVyQW5nbGUgPSB3aS5HZXRMYXllcigpLkdldEFuZ2xlKCk7CiAgICAgICAgICAgICAgICBjb25zdCBbeCwgeV0gPSB0aGlzLnJvdGF0ZVB0QXJvdW5kKHdpLkdldFgoKSwgd2kuR2V0WSgpLCAtbGF5ZXJBbmdsZSwgdGhpcy5fbGlzdGVuZXJQb3NbMF0sIHRoaXMuX2xpc3RlbmVyUG9zWzFdKTsKICAgICAgICAgICAgICAgIGNvbnN0IGlzTXVzaWMgPSBmaWxlWzFdOwogICAgICAgICAgICAgICAgY29uc3QgaW5mbyA9IHRoaXMuX3J1bnRpbWUuR2V0QXNzZXRNYW5hZ2VyKCkuR2V0UHJvamVjdEF1ZGlvRmlsZVVybChmaWxlWzBdKTsKICAgICAgICAgICAgICAgIGlmICghaW5mbykgcmV0dXJuOwogICAgICAgICAgICAgICAgY29uc3QgbmV4dFBsYXlUaW1lID0gdGhpcy5fbmV4dFBsYXlUaW1lOwogICAgICAgICAgICAgICAgdGhpcy5fbmV4dFBsYXlUaW1lID0gMDsKICAgICAgICAgICAgICAgIGNvbnN0IHN0YXRlID0gdGhpcy5fTWF5YmVNYXJrQXNQbGF5aW5nKGZpbGVbMF0sIHRhZ1N0ciwgaXNNdXNpYywgbG9vcGluZyAhPT0gMCwgdGhpcy5EYlRvTGluZWFyKHZvbCkpOwogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLlBvc3RUb0RPTUFzeW5jKCJwbGF5IiwgewogICAgICAgICAgICAgICAgICAgICAgICAib3JpZ2luYWxVcmwiOiBmaWxlWzBdLAogICAgICAgICAgICAgICAgICAgICAgICAidXJsIjogaW5mby51cmwsCiAgICAgICAgICAgICAgICAgICAgICAgICJ0eXBlIjogaW5mby50eXBlLAogICAgICAgICAgICAgICAgICAgICAgICAiaXNNdXNpYyI6IGlzTXVzaWMsCiAgICAgICAgICAgICAgICAgICAgICAgICJ0YWdzIjogdGhpcy5fU3BsaXRUYWdzKHRhZ1N0ciksCiAgICAgICAgICAgICAgICAgICAgICAgICJpc0xvb3BpbmciOiBsb29waW5nICE9PSAwLAogICAgICAgICAgICAgICAgICAgICAgICAidm9sIjogdGhpcy5EYlRvTGluZWFyKHZvbCksCiAgICAgICAgICAgICAgICAgICAgICAgICJwb3MiOiAwLAogICAgICAgICAgICAgICAgICAgICAgICAib2ZmIjogbmV4dFBsYXlUaW1lLAogICAgICAgICAgICAgICAgICAgICAgICAidHJ1ZUNsb2NrIjogISFzZWxmWyJDM19HZXRBdWRpb0NvbnRleHRDdXJyZW50VGltZSJdLAogICAgICAgICAgICAgICAgICAgICAgICAicGFubmluZyI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ4IjogeCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ5IjogeSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ6Ijogd2kuR2V0VG90YWxaRWxldmF0aW9uKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiYW5nbGUiOiB3aS5HZXRBbmdsZSgpIC0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXllckFuZ2xlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgImlubmVyQW5nbGUiOiBDMy50b1JhZGlhbnMoaW5uZXJBbmdsZSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAib3V0ZXJBbmdsZSI6IEMzLnRvUmFkaWFucyhvdXRlckFuZ2xlKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJvdXRlckdhaW4iOiB0aGlzLkRiVG9MaW5lYXIob3V0ZXJHYWluKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ1aWQiOiBpbnN0LkdldFVJRCgpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICAgICBpZiAoc3RhdGUpIHN0YXRlWyJwbGFjZWhvbGRlciJdID0gdGhpcy5fcnVudGltZS5HZXRUaWNrQ291bnROb1NhdmUoKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBhc3luYyBQbGF5QnlOYW1lKGZvbGRlciwgZmlsZW5hbWUsIGxvb3BpbmcsIHZvbCwgc3RlcmVvUGFuLCB0YWdTdHIpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9pc1NpbGVudCkgcmV0dXJuOwogICAgICAgICAgICAgICAgY29uc3QgaXNNdXNpYyA9IGZvbGRlciA9PT0gMTsKICAgICAgICAgICAgICAgIGNvbnN0IGluZm8gPSB0aGlzLl9ydW50aW1lLkdldEFzc2V0TWFuYWdlcigpLkdldFByb2plY3RBdWRpb0ZpbGVVcmwoZmlsZW5hbWUpIHx8IHRoaXMuX3JlbW90ZVVybHMuZ2V0KGZpbGVuYW1lLnRvTG93ZXJDYXNlKCkpOwogICAgICAgICAgICAgICAgaWYgKCFpbmZvKSByZXR1cm47CiAgICAgICAgICAgICAgICBjb25zdCBuZXh0UGxheVRpbWUgPSB0aGlzLl9uZXh0UGxheVRpbWU7CiAgICAgICAgICAgICAgICB0aGlzLl9uZXh0UGxheVRpbWUgPSAwOwogICAgICAgICAgICAgICAgY29uc3Qgc3RhdGUgPSB0aGlzLl9NYXliZU1hcmtBc1BsYXlpbmcoZmlsZW5hbWUsIHRhZ1N0ciwgaXNNdXNpYywgbG9vcGluZyAhPT0gMCwgdGhpcy5EYlRvTGluZWFyKHZvbCkpOwogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLlBvc3RUb0RPTUFzeW5jKCJwbGF5IiwgewogICAgICAgICAgICAgICAgICAgICAgICAib3JpZ2luYWxVcmwiOiBmaWxlbmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgInVybCI6IGluZm8udXJsLAogICAgICAgICAgICAgICAgICAgICAgICAidHlwZSI6IGluZm8udHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgImlzTXVzaWMiOiBpc011c2ljLAogICAgICAgICAgICAgICAgICAgICAgICAidGFncyI6IHRoaXMuX1NwbGl0VGFncyh0YWdTdHIpLAogICAgICAgICAgICAgICAgICAgICAgICAiaXNMb29waW5nIjogbG9vcGluZyAhPT0gMCwKICAgICAgICAgICAgICAgICAgICAgICAgInZvbCI6IHRoaXMuRGJUb0xpbmVhcih2b2wpLAogICAgICAgICAgICAgICAgICAgICAgICAic3RlcmVvUGFuIjogQzMuY2xhbXAoc3RlcmVvUGFuIC8gMTAwLCAtMSwgMSksCiAgICAgICAgICAgICAgICAgICAgICAgICJwb3MiOiAwLAogICAgICAgICAgICAgICAgICAgICAgICAib2ZmIjogbmV4dFBsYXlUaW1lLAogICAgICAgICAgICAgICAgICAgICAgICAidHJ1ZUNsb2NrIjogISFzZWxmWyJDM19HZXRBdWRpb0NvbnRleHRDdXJyZW50VGltZSJdCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXRlKSBzdGF0ZVsicGxhY2Vob2xkZXIiXSA9IHRoaXMuX3J1bnRpbWUuR2V0VGlja0NvdW50Tm9TYXZlKCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgYXN5bmMgUGxheUF0UG9zaXRpb25CeU5hbWUoZm9sZGVyLCBmaWxlbmFtZSwgbG9vcGluZywgdm9sLCB4LCB5LCB6LCBhbmdsZSwgaW5uZXJBbmdsZSwgb3V0ZXJBbmdsZSwgb3V0ZXJHYWluLCB0YWdTdHIpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9pc1NpbGVudCkgcmV0dXJuOwogICAgICAgICAgICAgICAgY29uc3QgaXNNdXNpYyA9IGZvbGRlciA9PT0gMTsKICAgICAgICAgICAgICAgIGNvbnN0IGluZm8gPSB0aGlzLl9ydW50aW1lLkdldEFzc2V0TWFuYWdlcigpLkdldFByb2plY3RBdWRpb0ZpbGVVcmwoZmlsZW5hbWUpIHx8IHRoaXMuX3JlbW90ZVVybHMuZ2V0KGZpbGVuYW1lLnRvTG93ZXJDYXNlKCkpOwogICAgICAgICAgICAgICAgaWYgKCFpbmZvKSByZXR1cm47CiAgICAgICAgICAgICAgICBjb25zdCBuZXh0UGxheVRpbWUgPSB0aGlzLl9uZXh0UGxheVRpbWU7CiAgICAgICAgICAgICAgICB0aGlzLl9uZXh0UGxheVRpbWUgPSAwOwogICAgICAgICAgICAgICAgY29uc3Qgc3RhdGUgPSB0aGlzLl9NYXliZU1hcmtBc1BsYXlpbmcoZmlsZW5hbWUsIHRhZ1N0ciwgaXNNdXNpYywgbG9vcGluZyAhPT0gMCwgdGhpcy5EYlRvTGluZWFyKHZvbCkpOwogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLlBvc3RUb0RPTUFzeW5jKCJwbGF5IiwgewogICAgICAgICAgICAgICAgICAgICAgICAib3JpZ2luYWxVcmwiOiBmaWxlbmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgInVybCI6IGluZm8udXJsLAogICAgICAgICAgICAgICAgICAgICAgICAidHlwZSI6IGluZm8udHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgImlzTXVzaWMiOiBpc011c2ljLAogICAgICAgICAgICAgICAgICAgICAgICAidGFncyI6IHRoaXMuX1NwbGl0VGFncyh0YWdTdHIpLAogICAgICAgICAgICAgICAgICAgICAgICAiaXNMb29waW5nIjogbG9vcGluZyAhPT0gMCwKICAgICAgICAgICAgICAgICAgICAgICAgInZvbCI6IHRoaXMuRGJUb0xpbmVhcih2b2wpLAogICAgICAgICAgICAgICAgICAgICAgICAicG9zIjogMCwKICAgICAgICAgICAgICAgICAgICAgICAgIm9mZiI6IG5leHRQbGF5VGltZSwKICAgICAgICAgICAgICAgICAgICAgICAgInRydWVDbG9jayI6ICEhc2VsZlsiQzNfR2V0QXVkaW9Db250ZXh0Q3VycmVudFRpbWUiXSwKICAgICAgICAgICAgICAgICAgICAgICAgInBhbm5pbmciOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAieCI6IHgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAieSI6IHksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAieiI6IHosCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiYW5nbGUiOiBDMy50b1JhZGlhbnMoYW5nbGUpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgImlubmVyQW5nbGUiOiBDMy50b1JhZGlhbnMoaW5uZXJBbmdsZSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAib3V0ZXJBbmdsZSI6IEMzLnRvUmFkaWFucyhvdXRlckFuZ2xlKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJvdXRlckdhaW4iOiB0aGlzLkRiVG9MaW5lYXIob3V0ZXJHYWluKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXRlKSBzdGF0ZVsicGxhY2Vob2xkZXIiXSA9IHRoaXMuX3J1bnRpbWUuR2V0VGlja0NvdW50Tm9TYXZlKCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgYXN5bmMgUGxheUF0T2JqZWN0QnlOYW1lKGZvbGRlciwgZmlsZW5hbWUsCiAgICAgICAgICAgICAgICBsb29waW5nLCB2b2wsIG9iamVjdENsYXNzLCBpbm5lckFuZ2xlLCBvdXRlckFuZ2xlLCBvdXRlckdhaW4sIHRhZ1N0cikgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuX2lzU2lsZW50KSByZXR1cm47CiAgICAgICAgICAgICAgICBpZiAodGhpcy5faXNTaWxlbnQpIHJldHVybjsKICAgICAgICAgICAgICAgIGlmICghb2JqZWN0Q2xhc3MpIHJldHVybjsKICAgICAgICAgICAgICAgIGNvbnN0IGluc3QgPSBvYmplY3RDbGFzcy5HZXRGaXJzdFBpY2tlZCgpOwogICAgICAgICAgICAgICAgaWYgKCFpbnN0IHx8ICFpbnN0LkdldFdvcmxkSW5mbygpKSByZXR1cm47CiAgICAgICAgICAgICAgICBjb25zdCB3aSA9IGluc3QuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgICAgICBjb25zdCBsYXllckFuZ2xlID0gd2kuR2V0TGF5ZXIoKS5HZXRBbmdsZSgpOwogICAgICAgICAgICAgICAgY29uc3QgW3gsIHldID0gdGhpcy5yb3RhdGVQdEFyb3VuZCh3aS5HZXRYKCksIHdpLkdldFkoKSwgLWxheWVyQW5nbGUsIHRoaXMuX2xpc3RlbmVyUG9zWzBdLCB0aGlzLl9saXN0ZW5lclBvc1sxXSk7CiAgICAgICAgICAgICAgICBjb25zdCBpc011c2ljID0gZm9sZGVyID09PSAxOwogICAgICAgICAgICAgICAgY29uc3QgaW5mbyA9IHRoaXMuX3J1bnRpbWUuR2V0QXNzZXRNYW5hZ2VyKCkuR2V0UHJvamVjdEF1ZGlvRmlsZVVybChmaWxlbmFtZSkgfHwgdGhpcy5fcmVtb3RlVXJscy5nZXQoZmlsZW5hbWUudG9Mb3dlckNhc2UoKSk7CiAgICAgICAgICAgICAgICBpZiAoIWluZm8pIHJldHVybjsKICAgICAgICAgICAgICAgIGNvbnN0IG5leHRQbGF5VGltZSA9IHRoaXMuX25leHRQbGF5VGltZTsKICAgICAgICAgICAgICAgIHRoaXMuX25leHRQbGF5VGltZSA9IDA7CiAgICAgICAgICAgICAgICBjb25zdCBzdGF0ZSA9IHRoaXMuX01heWJlTWFya0FzUGxheWluZyhmaWxlbmFtZSwgdGFnU3RyLCBpc011c2ljLCBsb29waW5nICE9PSAwLCB0aGlzLkRiVG9MaW5lYXIodm9sKSk7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuUG9zdFRvRE9NQXN5bmMoInBsYXkiLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICJvcmlnaW5hbFVybCI6IGZpbGVuYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAidXJsIjogaW5mby51cmwsCiAgICAgICAgICAgICAgICAgICAgICAgICJ0eXBlIjogaW5mby50eXBlLAogICAgICAgICAgICAgICAgICAgICAgICAiaXNNdXNpYyI6IGlzTXVzaWMsCiAgICAgICAgICAgICAgICAgICAgICAgICJ0YWdzIjogdGhpcy5fU3BsaXRUYWdzKHRhZ1N0ciksCiAgICAgICAgICAgICAgICAgICAgICAgICJpc0xvb3BpbmciOiBsb29waW5nICE9PSAwLAogICAgICAgICAgICAgICAgICAgICAgICAidm9sIjogdGhpcy5EYlRvTGluZWFyKHZvbCksCiAgICAgICAgICAgICAgICAgICAgICAgICJwb3MiOiAwLAogICAgICAgICAgICAgICAgICAgICAgICAib2ZmIjogbmV4dFBsYXlUaW1lLAogICAgICAgICAgICAgICAgICAgICAgICAidHJ1ZUNsb2NrIjogISFzZWxmWyJDM19HZXRBdWRpb0NvbnRleHRDdXJyZW50VGltZSJdLAogICAgICAgICAgICAgICAgICAgICAgICAicGFubmluZyI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ4IjogeCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ5IjogeSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ6Ijogd2kuR2V0VG90YWxaRWxldmF0aW9uKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiYW5nbGUiOiB3aS5HZXRBbmdsZSgpIC0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXllckFuZ2xlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgImlubmVyQW5nbGUiOiBDMy50b1JhZGlhbnMoaW5uZXJBbmdsZSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAib3V0ZXJBbmdsZSI6IEMzLnRvUmFkaWFucyhvdXRlckFuZ2xlKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJvdXRlckdhaW4iOiB0aGlzLkRiVG9MaW5lYXIob3V0ZXJHYWluKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ1aWQiOiBpbnN0LkdldFVJRCgpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICAgICBpZiAoc3RhdGUpIHN0YXRlWyJwbGFjZWhvbGRlciJdID0gdGhpcy5fcnVudGltZS5HZXRUaWNrQ291bnROb1NhdmUoKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBTZXRMb29waW5nKHRhZ1N0ciwgbG9vcGluZykgewogICAgICAgICAgICAgICAgdGhpcy5Qb3N0VG9ET00oInNldC1sb29waW5nIiwgewogICAgICAgICAgICAgICAgICAgICJ0YWdzIjogdGhpcy5fU3BsaXRUYWdzKHRhZ1N0ciksCiAgICAgICAgICAgICAgICAgICAgImlzTG9vcGluZyI6IGxvb3BpbmcgPT09IDAKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFNldE11dGVkKHRhZ1N0ciwgbXV0ZWQpIHsKICAgICAgICAgICAgICAgIHRoaXMuUG9zdFRvRE9NKCJzZXQtbXV0ZWQiLCB7CiAgICAgICAgICAgICAgICAgICAgInRhZ3MiOiB0aGlzLl9TcGxpdFRhZ3ModGFnU3RyKSwKICAgICAgICAgICAgICAgICAgICAiaXNNdXRlZCI6IG11dGVkID09PSAwCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9LAogICAgICAgICAgICBTZXRWb2x1bWUodGFnU3RyLCB2b2wpIHsKICAgICAgICAgICAgICAgIHRoaXMuUG9zdFRvRE9NKCJzZXQtdm9sdW1lIiwgewogICAgICAgICAgICAgICAgICAgICJ0YWdzIjogdGhpcy5fU3BsaXRUYWdzKHRhZ1N0ciksCiAgICAgICAgICAgICAgICAgICAgInZvbCI6IHRoaXMuRGJUb0xpbmVhcih2b2wpCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9LAogICAgICAgICAgICBGYWRlVm9sdW1lKHRhZ1N0ciwgdm9sLCBkdXJhdGlvbiwgZW5kaW5nKSB7CiAgICAgICAgICAgICAgICB0aGlzLlBvc3RUb0RPTSgiZmFkZS12b2x1bWUiLCB7CiAgICAgICAgICAgICAgICAgICAgInRhZ3MiOiB0aGlzLl9TcGxpdFRhZ3ModGFnU3RyKSwKICAgICAgICAgICAgICAgICAgICAidm9sIjogdGhpcy5EYlRvTGluZWFyKHZvbCksCiAgICAgICAgICAgICAgICAgICAgImR1cmF0aW9uIjogZHVyYXRpb24sCiAgICAgICAgICAgICAgICAgICAgInN0b3BPbkVuZCI6IGVuZGluZyA9PT0gMAogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgU2V0U3RlcmVvUGFuKHRhZ1N0ciwgcCkgewogICAgICAgICAgICAgICAgdGhpcy5Qb3N0VG9ET00oInNldC1zdGVyZW8tcGFuIiwgewogICAgICAgICAgICAgICAgICAgICJ0YWdzIjogdGhpcy5fU3BsaXRUYWdzKHRhZ1N0ciksCiAgICAgICAgICAgICAgICAgICAgInAiOiBDMy5jbGFtcChwIC8gMTAwLCAtMSwgMSkKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGFzeW5jIFByZWxvYWQoZmlsZSkgewogICAgICAgICAgICAgICAgY29uc3QgaXNNdXNpYyA9IGZpbGVbMV07CiAgICAgICAgICAgICAgICBjb25zdCBpbmZvID0gdGhpcy5fcnVudGltZS5HZXRBc3NldE1hbmFnZXIoKS5HZXRQcm9qZWN0QXVkaW9GaWxlVXJsKGZpbGVbMF0pOwogICAgICAgICAgICAgICAgaWYgKCFpbmZvKSByZXR1cm47CiAgICAgICAgICAgICAgICB0aGlzLl9wcmVsb2FkVG90YWwrKzsKICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuUG9zdFRvRE9NQXN5bmMoInByZWxvYWQiLCB7CiAgICAgICAgICAgICAgICAgICAgIm9yaWdpbmFsVXJsIjogZmlsZVswXSwKICAgICAgICAgICAgICAgICAgICAidXJsIjogaW5mby51cmwsCiAgICAgICAgICAgICAgICAgICAgInR5cGUiOiBpbmZvLnR5cGUsCiAgICAgICAgICAgICAgICAgICAgImlzTXVzaWMiOiBpc011c2ljCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHRoaXMuX3ByZWxvYWRDb3VudCsrCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGFzeW5jIFByZWxvYWRCeU5hbWUoZm9sZGVyLCBmaWxlbmFtZSkgewogICAgICAgICAgICAgICAgY29uc3QgaXNNdXNpYyA9IGZvbGRlciA9PT0gMTsKICAgICAgICAgICAgICAgIGNvbnN0IGluZm8gPSB0aGlzLl9ydW50aW1lLkdldEFzc2V0TWFuYWdlcigpLkdldFByb2plY3RBdWRpb0ZpbGVVcmwoZmlsZW5hbWUpIHx8IHRoaXMuX3JlbW90ZVVybHMuZ2V0KGZpbGVuYW1lLnRvTG93ZXJDYXNlKCkpOwogICAgICAgICAgICAgICAgaWYgKCFpbmZvKSByZXR1cm47CiAgICAgICAgICAgICAgICB0aGlzLl9wcmVsb2FkVG90YWwrKzsKICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuUG9zdFRvRE9NQXN5bmMoInByZWxvYWQiLCB7CiAgICAgICAgICAgICAgICAgICAgIm9yaWdpbmFsVXJsIjogZmlsZW5hbWUsCiAgICAgICAgICAgICAgICAgICAgInVybCI6IGluZm8udXJsLAogICAgICAgICAgICAgICAgICAgICJ0eXBlIjogaW5mby50eXBlLAogICAgICAgICAgICAgICAgICAgICJpc011c2ljIjogaXNNdXNpYwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB0aGlzLl9wcmVsb2FkQ291bnQrKwogICAgICAgICAgICB9LAogICAgICAgICAgICBTZXRQbGF5YmFja1JhdGUodGFnU3RyLCByYXRlKSB7CiAgICAgICAgICAgICAgICB0aGlzLlBvc3RUb0RPTSgic2V0LXBsYXliYWNrLXJhdGUiLCB7CiAgICAgICAgICAgICAgICAgICAgInRhZ3MiOiB0aGlzLl9TcGxpdFRhZ3ModGFnU3RyKSwKICAgICAgICAgICAgICAgICAgICAicmF0ZSI6IE1hdGgubWF4KHJhdGUsIDApCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9LAogICAgICAgICAgICBTdG9wKHRhZ1N0cikgewogICAgICAgICAgICAgICAgdGhpcy5Qb3N0VG9ET00oInN0b3AiLCB7CiAgICAgICAgICAgICAgICAgICAgInRhZ3MiOiB0aGlzLl9TcGxpdFRhZ3ModGFnU3RyKQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgU3RvcEFsbCgpIHsKICAgICAgICAgICAgICAgIHRoaXMuUG9zdFRvRE9NKCJzdG9wLWFsbCIpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFNldFBhdXNlZCh0YWdTdHIsIHN0YXRlKSB7CiAgICAgICAgICAgICAgICB0aGlzLlBvc3RUb0RPTSgic2V0LXBhdXNlZCIsIHsKICAgICAgICAgICAgICAgICAgICAidGFncyI6IHRoaXMuX1NwbGl0VGFncyh0YWdTdHIpLAogICAgICAgICAgICAgICAgICAgICJwYXVzZWQiOiBzdGF0ZSA9PT0gMAogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgU2Vlayh0YWdTdHIsIHBvcykgewogICAgICAgICAgICAgICAgdGhpcy5Qb3N0VG9ET00oInNlZWsiLCB7CiAgICAgICAgICAgICAgICAgICAgInRhZ3MiOiB0aGlzLl9TcGxpdFRhZ3ModGFnU3RyKSwKICAgICAgICAgICAgICAgICAgICAicG9zIjogcG9zCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9LAogICAgICAgICAgICBTZXRTaWxlbnQocykgewogICAgICAgICAgICAgICAgaWYgKHMgPT09IDIpIHMgPSB0aGlzLl9pc1NpbGVudCA/IDEgOiAwOwogICAgICAgICAgICAgICAgcyA9IHMgPT09IDA7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5faXNTaWxlbnQgPT09IHMpIHJldHVybjsKICAgICAgICAgICAgICAgIHRoaXMuX2lzU2lsZW50ID0gczsKICAgICAgICAgICAgICAgIHRoaXMuUG9zdFRvRE9NKCJzZXQtc2lsZW50IiwgewogICAgICAgICAgICAgICAgICAgICJpc1NpbGVudCI6IHMKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFNldE1hc3RlclZvbHVtZSh2b2wpIHsKICAgICAgICAgICAgICAgIGNvbnN0IG12ID0KICAgICAgICAgICAgICAgICAgICB0aGlzLkRiVG9MaW5lYXIodm9sKTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9tYXN0ZXJWb2x1bWUgPT09IG12KSByZXR1cm47CiAgICAgICAgICAgICAgICB0aGlzLl9tYXN0ZXJWb2x1bWUgPSBtdjsKICAgICAgICAgICAgICAgIHRoaXMuUG9zdFRvRE9NKCJzZXQtbWFzdGVyLXZvbHVtZSIsIHsKICAgICAgICAgICAgICAgICAgICAidm9sIjogbXYKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIEFkZEZpbHRlckVmZmVjdCh0YWdTdHIsIHR5cGUsIGZyZXEsIGRldHVuZSwgcSwgZ2FpbiwgbWl4KSB7CiAgICAgICAgICAgICAgICBjb25zdCB0eXBlU3RyID0gRklMVEVSX1RZUEVTW3R5cGVdOwogICAgICAgICAgICAgICAgdGhpcy5fSW5jcmVtZW50RWZmZWN0Q291bnQodGFnU3RyKTsKICAgICAgICAgICAgICAgIHRoaXMuUG9zdFRvRE9NKCJhZGQtZWZmZWN0IiwgewogICAgICAgICAgICAgICAgICAgICJ0eXBlIjogImZpbHRlciIsCiAgICAgICAgICAgICAgICAgICAgInRhZ3MiOiB0aGlzLl9TcGxpdFRhZ3ModGFnU3RyKSwKICAgICAgICAgICAgICAgICAgICAicGFyYW1zIjogW3R5cGVTdHIsIGZyZXEsIGRldHVuZSwgcSwgZ2FpbiwgQzMuY2xhbXAobWl4IC8gMTAwLCAwLCAxKV0KICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIEFkZERlbGF5RWZmZWN0KHRhZ1N0ciwgZGVsYXksIGdhaW4sIG1peCkgewogICAgICAgICAgICAgICAgdGhpcy5fSW5jcmVtZW50RWZmZWN0Q291bnQodGFnU3RyKTsKICAgICAgICAgICAgICAgIHRoaXMuUG9zdFRvRE9NKCJhZGQtZWZmZWN0IiwgewogICAgICAgICAgICAgICAgICAgICJ0eXBlIjogImRlbGF5IiwKICAgICAgICAgICAgICAgICAgICAidGFncyI6IHRoaXMuX1NwbGl0VGFncyh0YWdTdHIpLAogICAgICAgICAgICAgICAgICAgICJwYXJhbXMiOiBbZGVsYXksIHRoaXMuRGJUb0xpbmVhcihnYWluKSwgQzMuY2xhbXAobWl4IC8gMTAwLCAwLCAxKV0KICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIEFkZEZsYW5nZXJFZmZlY3QodGFnU3RyLCBkZWxheSwgbW9kdWxhdGlvbiwgZnJlcSwgZmVlZGJhY2ssIG1peCkgewogICAgICAgICAgICAgICAgdGhpcy5fSW5jcmVtZW50RWZmZWN0Q291bnQodGFnU3RyKTsKICAgICAgICAgICAgICAgIHRoaXMuUG9zdFRvRE9NKCJhZGQtZWZmZWN0IiwgewogICAgICAgICAgICAgICAgICAgICJ0eXBlIjogImZsYW5nZXIiLAogICAgICAgICAgICAgICAgICAgICJ0YWdzIjogdGhpcy5fU3BsaXRUYWdzKHRhZ1N0ciksCiAgICAgICAgICAgICAgICAgICAgInBhcmFtcyI6IFtkZWxheSAvIDFFMywgbW9kdWxhdGlvbiAvIDFFMywgZnJlcSwgZmVlZGJhY2sgLyAxMDAsIEMzLmNsYW1wKG1peCAvIDEwMCwgMCwgMSldCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9LAogICAgICAgICAgICBBZGRQaGFzZXJFZmZlY3QodGFnU3RyLCBmcmVxLCBkZXR1bmUsIHEsIG1vZCwgbW9kZnJlcSwgbWl4KSB7CiAgICAgICAgICAgICAgICB0aGlzLl9JbmNyZW1lbnRFZmZlY3RDb3VudCh0YWdTdHIpOwogICAgICAgICAgICAgICAgdGhpcy5Qb3N0VG9ET00oImFkZC1lZmZlY3QiLCB7CiAgICAgICAgICAgICAgICAgICAgInR5cGUiOiAicGhhc2VyIiwKICAgICAgICAgICAgICAgICAgICAidGFncyI6IHRoaXMuX1NwbGl0VGFncyh0YWdTdHIpLAogICAgICAgICAgICAgICAgICAgICJwYXJhbXMiOiBbZnJlcSwgZGV0dW5lLCBxLCBtb2QsIG1vZGZyZXEsIEMzLmNsYW1wKG1peCAvIDEwMCwgMCwgMSldCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9LAogICAgICAgICAgICBBZGRDb252b2x1dGlvbkVmZmVjdCh0YWdTdHIsIGZpbGUsIG5vcm0sIG1peCkgewogICAgICAgICAgICAgICAgY29uc3QgaW5mbyA9IHRoaXMuX3J1bnRpbWUuR2V0QXNzZXRNYW5hZ2VyKCkuR2V0UHJvamVjdEF1ZGlvRmlsZVVybChmaWxlWzBdKTsKICAgICAgICAgICAgICAgIGlmICghaW5mbykgcmV0dXJuOwogICAgICAgICAgICAgICAgdGhpcy5fSW5jcmVtZW50RWZmZWN0Q291bnQodGFnU3RyKTsKICAgICAgICAgICAgICAgIHRoaXMuUG9zdFRvRE9NKCJhZGQtZWZmZWN0IiwgewogICAgICAgICAgICAgICAgICAgICJ0eXBlIjogImNvbnZvbHV0aW9uIiwKICAgICAgICAgICAgICAgICAgICAidGFncyI6IHRoaXMuX1NwbGl0VGFncyh0YWdTdHIpLAogICAgICAgICAgICAgICAgICAgICJidWZmZXJPcmlnaW5hbFVybCI6IGZpbGVbMF0sCiAgICAgICAgICAgICAgICAgICAgImJ1ZmZlclVybCI6IGluZm8udXJsLAogICAgICAgICAgICAgICAgICAgICJidWZmZXJUeXBlIjogaW5mby50eXBlLAogICAgICAgICAgICAgICAgICAgICJwYXJhbXMiOiBbbm9ybSA9PT0gMCwgQzMuY2xhbXAobWl4IC8gMTAwLCAwLCAxKV0KICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIEFkZEdhaW5FZmZlY3QodGFnU3RyLCBnKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9JbmNyZW1lbnRFZmZlY3RDb3VudCh0YWdTdHIpOwogICAgICAgICAgICAgICAgdGhpcy5Qb3N0VG9ET00oImFkZC1lZmZlY3QiLCB7CiAgICAgICAgICAgICAgICAgICAgInR5cGUiOiAiZ2FpbiIsCiAgICAgICAgICAgICAgICAgICAgInRhZ3MiOiB0aGlzLl9TcGxpdFRhZ3ModGFnU3RyKSwKICAgICAgICAgICAgICAgICAgICAicGFyYW1zIjogW3RoaXMuRGJUb0xpbmVhcihnKV0KICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIEFkZFN0ZXJlb1BhbkVmZmVjdCh0YWdTdHIsIGcpIHsKICAgICAgICAgICAgICAgIHRoaXMuX0luY3JlbWVudEVmZmVjdENvdW50KHRhZ1N0cik7CiAgICAgICAgICAgICAgICB0aGlzLlBvc3RUb0RPTSgiYWRkLWVmZmVjdCIsIHsKICAgICAgICAgICAgICAgICAgICAidHlwZSI6ICJzdGVyZW9wYW4iLAogICAgICAgICAgICAgICAgICAgICJ0YWdzIjogdGhpcy5fU3BsaXRUYWdzKHRhZ1N0ciksCiAgICAgICAgICAgICAgICAgICAgInBhcmFtcyI6IFtDMy5jbGFtcChnIC8gMTAwLCAtMSwgMSldCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9LAogICAgICAgICAgICBBZGRNdXRlRWZmZWN0KHRhZ1N0cikgewogICAgICAgICAgICAgICAgdGhpcy5fSW5jcmVtZW50RWZmZWN0Q291bnQodGFnU3RyKTsKICAgICAgICAgICAgICAgIHRoaXMuUG9zdFRvRE9NKCJhZGQtZWZmZWN0IiwgewogICAgICAgICAgICAgICAgICAgICJ0eXBlIjogImdhaW4iLAogICAgICAgICAgICAgICAgICAgICJ0YWdzIjogdGhpcy5fU3BsaXRUYWdzKHRhZ1N0ciksCiAgICAgICAgICAgICAgICAgICAgInBhcmFtcyI6IFswXQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgQWRkVHJlbW9sb0VmZmVjdCh0YWdTdHIsIGZyZXEsIG1peCkgewogICAgICAgICAgICAgICAgdGhpcy5fSW5jcmVtZW50RWZmZWN0Q291bnQodGFnU3RyKTsKICAgICAgICAgICAgICAgIHRoaXMuUG9zdFRvRE9NKCJhZGQtZWZmZWN0IiwgewogICAgICAgICAgICAgICAgICAgICJ0eXBlIjogInRyZW1vbG8iLAogICAgICAgICAgICAgICAgICAgICJ0YWdzIjogdGhpcy5fU3BsaXRUYWdzKHRhZ1N0ciksCiAgICAgICAgICAgICAgICAgICAgInBhcmFtcyI6IFtmcmVxLCBDMy5jbGFtcChtaXggLyAxMDAsIDAsIDEpXQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgQWRkUmluZ01vZEVmZmVjdCh0YWdTdHIsIGZyZXEsIG1peCkgewogICAgICAgICAgICAgICAgdGhpcy5fSW5jcmVtZW50RWZmZWN0Q291bnQodGFnU3RyKTsKICAgICAgICAgICAgICAgIHRoaXMuUG9zdFRvRE9NKCJhZGQtZWZmZWN0IiwgewogICAgICAgICAgICAgICAgICAgICJ0eXBlIjogInJpbmdtb2QiLAogICAgICAgICAgICAgICAgICAgICJ0YWdzIjogdGhpcy5fU3BsaXRUYWdzKHRhZ1N0ciksCiAgICAgICAgICAgICAgICAgICAgInBhcmFtcyI6IFtmcmVxLCBDMy5jbGFtcChtaXggLyAxMDAsIDAsIDEpXQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgQWRkRGlzdG9ydGlvbkVmZmVjdCh0YWdTdHIsIHRocmVzaG9sZCwgaGVhZHJvb20sIGRyaXZlLCBtYWtldXBnYWluLCBtaXgpIHsKICAgICAgICAgICAgICAgIHRoaXMuX0luY3JlbWVudEVmZmVjdENvdW50KHRhZ1N0cik7CiAgICAgICAgICAgICAgICB0aGlzLlBvc3RUb0RPTSgiYWRkLWVmZmVjdCIsIHsKICAgICAgICAgICAgICAgICAgICAidHlwZSI6ICJkaXN0b3J0aW9uIiwKICAgICAgICAgICAgICAgICAgICAidGFncyI6IHRoaXMuX1NwbGl0VGFncyh0YWdTdHIpLAogICAgICAgICAgICAgICAgICAgICJwYXJhbXMiOiBbdGhpcy5EYlRvTGluZWFyTm9DYXAodGhyZXNob2xkKSwKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5EYlRvTGluZWFyTm9DYXAoaGVhZHJvb20pLCBkcml2ZSwgdGhpcy5EYlRvTGluZWFyTm9DYXAobWFrZXVwZ2FpbiksIEMzLmNsYW1wKG1peCAvIDEwMCwgMCwgMSkKICAgICAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9LAogICAgICAgICAgICBBZGRDb21wcmVzc29yRWZmZWN0KHRhZ1N0ciwgdGhyZXNob2xkLCBrbmVlLCByYXRpbywgYXR0YWNrLCByZWxlYXNlKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9JbmNyZW1lbnRFZmZlY3RDb3VudCh0YWdTdHIpOwogICAgICAgICAgICAgICAgdGhpcy5Qb3N0VG9ET00oImFkZC1lZmZlY3QiLCB7CiAgICAgICAgICAgICAgICAgICAgInR5cGUiOiAiY29tcHJlc3NvciIsCiAgICAgICAgICAgICAgICAgICAgInRhZ3MiOiB0aGlzLl9TcGxpdFRhZ3ModGFnU3RyKSwKICAgICAgICAgICAgICAgICAgICAicGFyYW1zIjogW3RocmVzaG9sZCwga25lZSwgcmF0aW8sIGF0dGFjayAvIDFFMywgcmVsZWFzZSAvIDFFM10KICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIEFkZEFuYWx5c2VyRWZmZWN0KHRhZ1N0ciwgZmZ0U2l6ZSwgc21vb3RoaW5nKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9JbmNyZW1lbnRFZmZlY3RDb3VudCh0YWdTdHIpOwogICAgICAgICAgICAgICAgdGhpcy5Qb3N0VG9ET00oImFkZC1lZmZlY3QiLCB7CiAgICAgICAgICAgICAgICAgICAgInR5cGUiOiAiYW5hbHlzZXIiLAogICAgICAgICAgICAgICAgICAgICJ0YWdzIjogdGhpcy5fU3BsaXRUYWdzKHRhZ1N0ciksCiAgICAgICAgICAgICAgICAgICAgInBhcmFtcyI6IFtmZnRTaXplLAogICAgICAgICAgICAgICAgICAgICAgICBzbW9vdGhpbmcKICAgICAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9LAogICAgICAgICAgICBSZW1vdmVFZmZlY3RzKHRhZ1N0cikgewogICAgICAgICAgICAgICAgY29uc3QgdGFnQXJyID0gdGhpcy5fU3BsaXRUYWdzKHRhZ1N0cik7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHRhZyBvZiB0YWdBcnIpIHRoaXMuX2VmZmVjdENvdW50LnNldCh0YWcudG9Mb3dlckNhc2UoKSwgMCk7CiAgICAgICAgICAgICAgICB0aGlzLlBvc3RUb0RPTSgicmVtb3ZlLWVmZmVjdHMiLCB7CiAgICAgICAgICAgICAgICAgICAgInRhZ3MiOiB0YWdBcnIKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgdGhpcy5fbGFzdEZ4U3RhdGUgPSB7fQogICAgICAgICAgICB9LAogICAgICAgICAgICBTZXRFZmZlY3RQYXJhbWV0ZXIodGFnU3RyLCBpbmRleCwgcGFyYW0sIHZhbHVlLCByYW1wLCB0aW1lKSB7CiAgICAgICAgICAgICAgICB0aGlzLlBvc3RUb0RPTSgic2V0LWVmZmVjdC1wYXJhbSIsIHsKICAgICAgICAgICAgICAgICAgICAidGFncyI6IHRoaXMuX1NwbGl0VGFncyh0YWdTdHIpLAogICAgICAgICAgICAgICAgICAgICJpbmRleCI6IE1hdGguZmxvb3IoaW5kZXgpLAogICAgICAgICAgICAgICAgICAgICJwYXJhbSI6IHBhcmFtLAogICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6IHZhbHVlLAogICAgICAgICAgICAgICAgICAgICJyYW1wIjogcmFtcCwKICAgICAgICAgICAgICAgICAgICAidGltZSI6IHRpbWUKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFNldExpc3RlbmVyT2JqZWN0KG9iamVjdENsYXNzKSB7CiAgICAgICAgICAgICAgICBpZiAoIW9iamVjdENsYXNzKSByZXR1cm47CiAgICAgICAgICAgICAgICBjb25zdCBpbnN0ID0gb2JqZWN0Q2xhc3MuR2V0Rmlyc3RQaWNrZWQoKTsKICAgICAgICAgICAgICAgIGlmICghaW5zdCB8fCAhaW5zdC5HZXRXb3JsZEluZm8oKSkgcmV0dXJuOwogICAgICAgICAgICAgICAgdGhpcy5fbGlzdGVuZXJJbnN0ID0gaW5zdAogICAgICAgICAgICB9LAogICAgICAgICAgICBTZXRMaXN0ZW5lclooeikgewogICAgICAgICAgICAgICAgdGhpcy5fbGlzdGVuZXJQb3NbMl0gPSB6CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFNldExpc3RlbmVyT3JpZW50YXRpb24oZngsIGZ5LCBmeiwgdXgsIHV5LCB1eikgewogICAgICAgICAgICAgICAgdGhpcy5fbGlzdGVuZXJGb3J3YXJkVmVjWzBdID0gZng7CiAgICAgICAgICAgICAgICB0aGlzLl9saXN0ZW5lckZvcndhcmRWZWNbMV0gPSBmeTsKICAgICAgICAgICAgICAgIHRoaXMuX2xpc3RlbmVyRm9yd2FyZFZlY1syXSA9IC1mejsKICAgICAgICAgICAgICAgIHRoaXMuX2xpc3RlbmVyVXBWZWNbMF0gPSB1eDsKICAgICAgICAgICAgICAgIHRoaXMuX2xpc3RlbmVyVXBWZWNbMV0gPSB1eTsKICAgICAgICAgICAgICAgIHRoaXMuX2xpc3RlbmVyVXBWZWNbMl0gPSAtdXoKICAgICAgICAgICAgfSwKICAgICAgICAgICAgU2NoZWR1bGVOZXh0UGxheSh0KSB7CiAgICAgICAgICAgICAgICB0aGlzLl9uZXh0UGxheVRpbWUgPSBNYXRoLm1heCh0LCAwKQogICAgICAgICAgICB9LAogICAgICAgICAgICBVbmxvYWRBdWRpbyhmaWxlKSB7CiAgICAgICAgICAgICAgICBjb25zdCBpc011c2ljID0gZmlsZVsxXTsKICAgICAgICAgICAgICAgIGNvbnN0IGluZm8gPSB0aGlzLl9ydW50aW1lLkdldEFzc2V0TWFuYWdlcigpLkdldFByb2plY3RBdWRpb0ZpbGVVcmwoZmlsZVswXSk7CiAgICAgICAgICAgICAgICBpZiAoIWluZm8pIHJldHVybjsKICAgICAgICAgICAgICAgIHRoaXMuUG9zdFRvRE9NKCJ1bmxvYWQiLCB7CiAgICAgICAgICAgICAgICAgICAgInVybCI6IGluZm8udXJsLAogICAgICAgICAgICAgICAgICAgICJ0eXBlIjogaW5mby50eXBlLAogICAgICAgICAgICAgICAgICAgICJpc011c2ljIjogaXNNdXNpYwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgVW5sb2FkQXVkaW9CeU5hbWUoZm9sZGVyLCBmaWxlbmFtZSkgewogICAgICAgICAgICAgICAgY29uc3QgaXNNdXNpYyA9IGZvbGRlciA9PT0gMTsKICAgICAgICAgICAgICAgIGNvbnN0IGluZm8gPSB0aGlzLl9ydW50aW1lLkdldEFzc2V0TWFuYWdlcigpLkdldFByb2plY3RBdWRpb0ZpbGVVcmwoZmlsZW5hbWUpIHx8IHRoaXMuX3JlbW90ZVVybHMuZ2V0KGZpbGVuYW1lLnRvTG93ZXJDYXNlKCkpOwogICAgICAgICAgICAgICAgaWYgKCFpbmZvKSByZXR1cm47CiAgICAgICAgICAgICAgICB0aGlzLlBvc3RUb0RPTSgidW5sb2FkIiwgewogICAgICAgICAgICAgICAgICAgICJ1cmwiOiBpbmZvLnVybCwKICAgICAgICAgICAgICAgICAgICAidHlwZSI6IGluZm8udHlwZSwKICAgICAgICAgICAgICAgICAgICAiaXNNdXNpYyI6IGlzTXVzaWMKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFVubG9hZEFsbCgpIHsKICAgICAgICAgICAgICAgIHRoaXMuUG9zdFRvRE9NKCJ1bmxvYWQtYWxsIikKICAgICAgICAgICAgfSwKICAgICAgICAgICAgQWRkUmVtb3RlVVJMKHVybCwgdHlwZSwgbmFtZSkgewogICAgICAgICAgICAgICAgdGhpcy5fcmVtb3RlVXJscy5zZXQobmFtZS50b0xvd2VyQ2FzZSgpLCB7CiAgICAgICAgICAgICAgICAgICAgdXJsLAogICAgICAgICAgICAgICAgICAgIHR5cGUKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IHsKICAgICAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICAgICAgQzMuUGx1Z2lucy5BdWRpby5FeHBzID0gewogICAgICAgICAgICBEdXJhdGlvbih0YWdTdHIpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGEgPSB0aGlzLl9HZXRGaXJzdEF1ZGlvU3RhdGVCeVRhZ3ModGFnU3RyKTsKICAgICAgICAgICAgICAgIHJldHVybiBhID8gYVsiZHVyYXRpb24iXSA6IDAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgUGxheWJhY2tUaW1lKHRhZ1N0cikgewogICAgICAgICAgICAgICAgY29uc3QgYSA9IHRoaXMuX0dldEZpcnN0QXVkaW9TdGF0ZUJ5VGFncyh0YWdTdHIpOwogICAgICAgICAgICAgICAgcmV0dXJuIGEgPyBhWyJwbGF5YmFja1RpbWUiXSA6IDAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgUGxheWJhY2tSYXRlKHRhZ1N0cikgewogICAgICAgICAgICAgICAgY29uc3QgYSA9IHRoaXMuX0dldEZpcnN0QXVkaW9TdGF0ZUJ5VGFncyh0YWdTdHIpOwogICAgICAgICAgICAgICAgcmV0dXJuIGEgPyBhWyJwbGF5YmFja1JhdGUiXSA6IDAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgVm9sdW1lKHRhZ1N0cikgewogICAgICAgICAgICAgICAgY29uc3QgYSA9IHRoaXMuX0dldEZpcnN0QXVkaW9TdGF0ZUJ5VGFncyh0YWdTdHIpOwogICAgICAgICAgICAgICAgcmV0dXJuIGEgPyB0aGlzLkxpbmVhclRvRGIoYVsidm9sdW1lIl0pIDogMAogICAgICAgICAgICB9LAogICAgICAgICAgICBNYXN0ZXJWb2x1bWUoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5MaW5lYXJUb0RiKHRoaXMuX21hc3RlclZvbHVtZSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgRWZmZWN0Q291bnQodGFnKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZWZmZWN0Q291bnQuZ2V0KHRhZy50b0xvd2VyQ2FzZSgpKSB8fAogICAgICAgICAgICAgICAgICAgIDAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgQW5hbHlzZXJGcmVxQmluQ291bnQodGFnU3RyLCBpbmRleCkgewogICAgICAgICAgICAgICAgY29uc3QgbyA9IHRoaXMuR2V0QW5hbHlzZXJEYXRhKHRhZ1N0ciwgTWF0aC5mbG9vcihpbmRleCkpOwogICAgICAgICAgICAgICAgcmV0dXJuIG8gPyBvWyJiaW5Db3VudCJdIDogMAogICAgICAgICAgICB9LAogICAgICAgICAgICBBbmFseXNlckZyZXFCaW5BdCh0YWdTdHIsIGluZGV4LCBiaW4pIHsKICAgICAgICAgICAgICAgIGNvbnN0IG8gPSB0aGlzLkdldEFuYWx5c2VyRGF0YSh0YWdTdHIsIE1hdGguZmxvb3IoaW5kZXgpKTsKICAgICAgICAgICAgICAgIGlmICghbykgcmV0dXJuIDA7CiAgICAgICAgICAgICAgICBiaW4gPSBNYXRoLmZsb29yKGJpbik7CiAgICAgICAgICAgICAgICBpZiAoYmluIDwgMCB8fCBiaW4gPj0gb1siYmluQ291bnQiXSkgcmV0dXJuIDA7CiAgICAgICAgICAgICAgICByZXR1cm4gb1siZnJlcUJpbnMiXVtiaW5dCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIEFuYWx5c2VyUGVha0xldmVsKHRhZ1N0ciwgaW5kZXgpIHsKICAgICAgICAgICAgICAgIGNvbnN0IG8gPSB0aGlzLkdldEFuYWx5c2VyRGF0YSh0YWdTdHIsIE1hdGguZmxvb3IoaW5kZXgpKTsKICAgICAgICAgICAgICAgIHJldHVybiBvID8gb1sicGVhayJdIDogMAogICAgICAgICAgICB9LAogICAgICAgICAgICBBbmFseXNlclJNU0xldmVsKHRhZ1N0ciwgaW5kZXgpIHsKICAgICAgICAgICAgICAgIGNvbnN0IG8gPSB0aGlzLkdldEFuYWx5c2VyRGF0YSh0YWdTdHIsIE1hdGguZmxvb3IoaW5kZXgpKTsKICAgICAgICAgICAgICAgIHJldHVybiBvID8gb1sicm1zIl0gOiAwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFNhbXBsZVJhdGUoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fc2FtcGxlUmF0ZQogICAgICAgICAgICB9LAogICAgICAgICAgICBDdXJyZW50VGltZSgpIHsKICAgICAgICAgICAgICAgIGlmIChzZWxmWyJDM19HZXRBdWRpb0NvbnRleHRDdXJyZW50VGltZSJdKSByZXR1cm4gc2VsZlsiQzNfR2V0QXVkaW9Db250ZXh0Q3VycmVudFRpbWUiXSgpOwogICAgICAgICAgICAgICAgZWxzZSByZXR1cm4gcGVyZm9ybWFuY2Uubm93KCkgLyAxRTMKICAgICAgICAgICAgfSwKICAgICAgICAgICAgT3V0cHV0TGF0ZW5jeSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9vdXRwdXRMYXRlbmN5CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwoKfQoKewogICAgJ3VzZSBzdHJpY3QnOyB7CiAgICAgICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgICAgIEMzLlBsdWdpbnMuQnJvd3NlciA9IGNsYXNzIEJyb3dzZXJQbHVnaW4gZXh0ZW5kcyBDMy5TREtQbHVnaW5CYXNlIHsKICAgICAgICAgICAgY29uc3RydWN0b3Iob3B0cykgewogICAgICAgICAgICAgICAgc3VwZXIob3B0cykKICAgICAgICAgICAgfQogICAgICAgICAgICBSZWxlYXNlKCkgewogICAgICAgICAgICAgICAgc3VwZXIuUmVsZWFzZSgpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IHsKICAgICAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICAgICAgQzMuUGx1Z2lucy5Ccm93c2VyLlR5cGUgPSBjbGFzcyBCcm93c2VyVHlwZSBleHRlbmRzIEMzLlNES1R5cGVCYXNlIHsKICAgICAgICAgICAgY29uc3RydWN0b3Iob2JqZWN0Q2xhc3MpIHsKICAgICAgICAgICAgICAgIHN1cGVyKG9iamVjdENsYXNzKQogICAgICAgICAgICB9CiAgICAgICAgICAgIFJlbGVhc2UoKSB7CiAgICAgICAgICAgICAgICBzdXBlci5SZWxlYXNlKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBPbkNyZWF0ZSgpIHt9CiAgICAgICAgfQogICAgfSB7CiAgICAgICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgICAgIGNvbnN0IERPTV9DT01QT05FTlRfSUQgPSAiYnJvd3NlciI7CiAgICAgICAgQzMuUGx1Z2lucy5Ccm93c2VyLkluc3RhbmNlID0gY2xhc3MgQnJvd3Nlckluc3RhbmNlIGV4dGVuZHMgQzMuU0RLSW5zdGFuY2VCYXNlIHsKICAgICAgICAgICAgY29uc3RydWN0b3IoaW5zdCwgcHJvcGVydGllcykgewogICAgICAgICAgICAgICAgc3VwZXIoaW5zdCwgRE9NX0NPTVBPTkVOVF9JRCk7CiAgICAgICAgICAgICAgICB0aGlzLl9pbml0TG9jYXRpb25TdHIgPSAiIjsKICAgICAgICAgICAgICAgIHRoaXMuX2lzT25saW5lID0gZmFsc2U7CiAgICAgICAgICAgICAgICB0aGlzLl9yZWZlcnJlciA9ICIiOwogICAgICAgICAgICAgICAgdGhpcy5fZG9jVGl0bGUgPSAiIjsKICAgICAgICAgICAgICAgIHRoaXMuX2lzQ29va2llRW5hYmxlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgdGhpcy5fc2NyZWVuV2lkdGggPSAwOwogICAgICAgICAgICAgICAgdGhpcy5fc2NyZWVuSGVpZ2h0ID0gMDsKICAgICAgICAgICAgICAgIHRoaXMuX3dpbmRvd091dGVyV2lkdGggPSAwOwogICAgICAgICAgICAgICAgdGhpcy5fd2luZG93T3V0ZXJIZWlnaHQgPSAwOwogICAgICAgICAgICAgICAgdGhpcy5faXNDb25zdHJ1Y3RBcmNhZGUgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHRoaXMuX2Nzc1N0eWxlTWFwID0gbmV3IE1hcDsKICAgICAgICAgICAgICAgIHRoaXMuQWRkRE9NTWVzc2FnZUhhbmRsZXJzKFsKICAgICAgICAgICAgICAgICAgICBbIm9ubGluZS1zdGF0ZSIsIGUgPT4gdGhpcy5fT25PbmxpbmVTdGF0ZUNoYW5nZWQoZSldLAogICAgICAgICAgICAgICAgICAgIFsiYmFja2J1dHRvbiIsICgpID0+IHRoaXMuX09uQmFja0J1dHRvbigpXSwKICAgICAgICAgICAgICAgICAgICBbInN3LW1lc3NhZ2UiLCBlID0+IHRoaXMuX09uU1dNZXNzYWdlKGUpXSwKICAgICAgICAgICAgICAgICAgICBbImhhc2hjaGFuZ2UiLCBlID0+IHRoaXMuX09uSGFzaENoYW5nZShlKV0KICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICAgICAgY29uc3QgcnQgPSB0aGlzLkdldFJ1bnRpbWUoKS5EaXNwYXRjaGVyKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9kaXNwb3NhYmxlcyA9IG5ldyBDMy5Db21wb3NpdGVEaXNwb3NhYmxlKEMzLkRpc3Bvc2FibGUuRnJvbShydCwgImFmdGVyZmlyc3RsYXlvdXRzdGFydCIsICgpID0+IHRoaXMuX09uQWZ0ZXJGaXJzdExheW91dFN0YXJ0KCkpLCBDMy5EaXNwb3NhYmxlLkZyb20ocnQsICJ3aW5kb3ctcmVzaXplIiwgKCkgPT4gdGhpcy5fT25XaW5kb3dSZXNpemUoKSksIEMzLkRpc3Bvc2FibGUuRnJvbShydCwgInN1c3BlbmQiLCAoKSA9PiB0aGlzLl9PblN1c3BlbmQoKSksIEMzLkRpc3Bvc2FibGUuRnJvbShydCwgInJlc3VtZSIsICgpID0+IHRoaXMuX09uUmVzdW1lKCkpKTsKICAgICAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuQWRkTG9hZFByb21pc2UodGhpcy5Qb3N0VG9ET01Bc3luYygiZ2V0LWluaXRpYWwtc3RhdGUiLCB7CiAgICAgICAgICAgICAgICAgICAgImV4cG9ydFR5cGUiOiB0aGlzLl9ydW50aW1lLkdldEV4cG9ydFR5cGUoKQogICAgICAgICAgICAgICAgfSkudGhlbihkYXRhID0+IHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9pbml0TG9jYXRpb25TdHIgPSBkYXRhWyJsb2NhdGlvbiJdOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2lzT25saW5lID0gZGF0YVsiaXNPbmxpbmUiXTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZWZlcnJlciA9IGRhdGFbInJlZmVycmVyIl07CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZG9jVGl0bGUgPSBkYXRhWyJ0aXRsZSJdOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2lzQ29va2llRW5hYmxlZCA9IGRhdGFbImlzQ29va2llRW5hYmxlZCJdOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3NjcmVlbldpZHRoID0gZGF0YVsic2NyZWVuV2lkdGgiXTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9zY3JlZW5IZWlnaHQgPSBkYXRhWyJzY3JlZW5IZWlnaHQiXTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl93aW5kb3dPdXRlcldpZHRoID0gZGF0YVsid2luZG93T3V0ZXJXaWR0aCJdOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3dpbmRvd091dGVySGVpZ2h0ID0gZGF0YVsid2luZG93T3V0ZXJIZWlnaHQiXTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9pc0NvbnN0cnVjdEFyY2FkZSA9IGRhdGFbImlzQ29uc3RydWN0QXJjYWRlIl0KICAgICAgICAgICAgICAgIH0pKQogICAgICAgICAgICB9CiAgICAgICAgICAgIFJlbGVhc2UoKSB7CiAgICAgICAgICAgICAgICBzdXBlci5SZWxlYXNlKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBfT25BZnRlckZpcnN0TGF5b3V0U3RhcnQoKSB7CiAgICAgICAgICAgICAgICB0aGlzLlBvc3RUb0RPTSgicmVhZHktZm9yLXN3LW1lc3NhZ2VzIikKICAgICAgICAgICAgfQogICAgICAgICAgICBhc3luYyBfT25PbmxpbmVTdGF0ZUNoYW5nZWQoZSkgewogICAgICAgICAgICAgICAgY29uc3QgaXNPbmxpbmUgPSAhIWVbImlzT25saW5lIl07CiAgICAgICAgICAgICAgICBpZiAodGhpcy5faXNPbmxpbmUgPT09IGlzT25saW5lKSByZXR1cm47CiAgICAgICAgICAgICAgICB0aGlzLl9pc09ubGluZSA9IGlzT25saW5lOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuX2lzT25saW5lKSBhd2FpdCB0aGlzLlRyaWdnZXJBc3luYyhDMy5QbHVnaW5zLkJyb3dzZXIuQ25kcy5Pbk9ubGluZSk7CiAgICAgICAgICAgICAgICBlbHNlIGF3YWl0IHRoaXMuVHJpZ2dlckFzeW5jKEMzLlBsdWdpbnMuQnJvd3Nlci5DbmRzLk9uT2ZmbGluZSkKICAgICAgICAgICAgfQogICAgICAgICAgICBhc3luYyBfT25XaW5kb3dSZXNpemUoKSB7CiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLlRyaWdnZXJBc3luYyhDMy5QbHVnaW5zLkJyb3dzZXIuQ25kcy5PblJlc2l6ZSkKICAgICAgICAgICAgfQogICAgICAgICAgICBfT25TdXNwZW5kKCkgewogICAgICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKEMzLlBsdWdpbnMuQnJvd3Nlci5DbmRzLk9uUGFnZUhpZGRlbikKICAgICAgICAgICAgfQogICAgICAgICAgICBfT25SZXN1bWUoKSB7CiAgICAgICAgICAgICAgICB0aGlzLlRyaWdnZXIoQzMuUGx1Z2lucy5Ccm93c2VyLkNuZHMuT25QYWdlVmlzaWJsZSkKICAgICAgICAgICAgfQogICAgICAgICAgICBhc3luYyBfT25CYWNrQnV0dG9uKCkgewogICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5UcmlnZ2VyQXN5bmMoQzMuUGx1Z2lucy5Ccm93c2VyLkNuZHMuT25CYWNrQnV0dG9uKQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9PblNXTWVzc2FnZShlKSB7CiAgICAgICAgICAgICAgICBjb25zdCBtZXNzYWdlVHlwZSA9CiAgICAgICAgICAgICAgICAgICAgZVsidHlwZSJdOwogICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2VUeXBlID09PSAiZG93bmxvYWRpbmctdXBkYXRlIikgdGhpcy5UcmlnZ2VyKEMzLlBsdWdpbnMuQnJvd3Nlci5DbmRzLk9uVXBkYXRlRm91bmQpOwogICAgICAgICAgICAgICAgZWxzZSBpZiAobWVzc2FnZVR5cGUgPT09ICJ1cGRhdGUtcmVhZHkiIHx8IG1lc3NhZ2VUeXBlID09PSAidXBkYXRlLXBlbmRpbmciKSB0aGlzLlRyaWdnZXIoQzMuUGx1Z2lucy5Ccm93c2VyLkNuZHMuT25VcGRhdGVSZWFkeSk7CiAgICAgICAgICAgICAgICBlbHNlIGlmIChtZXNzYWdlVHlwZSA9PT0gIm9mZmxpbmUtcmVhZHkiKSB0aGlzLlRyaWdnZXIoQzMuUGx1Z2lucy5Ccm93c2VyLkNuZHMuT25PZmZsaW5lUmVhZHkpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX09uSGFzaENoYW5nZShlKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9pbml0TG9jYXRpb25TdHIgPSBlWyJsb2NhdGlvbiJdOwogICAgICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKEMzLlBsdWdpbnMuQnJvd3Nlci5DbmRzLk9uSGFzaENoYW5nZSkKICAgICAgICAgICAgfQogICAgICAgICAgICBHZXREZWJ1Z2dlclByb3BlcnRpZXMoKSB7CiAgICAgICAgICAgICAgICBjb25zdCBwcmVmaXggPSAicGx1Z2lucy5icm93c2VyLmRlYnVnZ2VyIjsKICAgICAgICAgICAgICAgIHJldHVybiBbewogICAgICAgICAgICAgICAgICAgIHRpdGxlOiAicGx1Z2lucy5icm93c2VyLm5hbWUiLAogICAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IFt7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHByZWZpeCArICIudXNlci1hZ2VudCIsCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBuYXZpZ2F0b3IudXNlckFnZW50CiAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBwcmVmaXggKyAiLmlzLW9ubGluZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLl9pc09ubGluZQogICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogcHJlZml4ICsgIi5pcy1mdWxsc2NyZWVuIiwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuX3J1bnRpbWUuR2V0Q2FudmFzTWFuYWdlcigpLklzRG9jdW1lbnRGdWxsc2NyZWVuKCkKICAgICAgICAgICAgICAgICAgICB9XQogICAgICAgICAgICAgICAgfV0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gewogICAgICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgICAgICBDMy5QbHVnaW5zLkJyb3dzZXIuQ25kcyA9IHsKICAgICAgICAgICAgSXNPbmxpbmUoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5faXNPbmxpbmUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgT25PbmxpbmUoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgICAgICB9LAogICAgICAgICAgICBPbk9mZmxpbmUoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgICAgICB9LAogICAgICAgICAgICBPblJlc2l6ZSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIENvb2tpZXNFbmFibGVkKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2lzQ29va2llRW5hYmxlZAogICAgICAgICAgICB9LAogICAgICAgICAgICBJc0Z1bGxzY3JlZW4oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcnVudGltZS5HZXRDYW52YXNNYW5hZ2VyKCkuSXNEb2N1bWVudEZ1bGxzY3JlZW4oKQogICAgICAgICAgICB9LAogICAgICAgICAgICBPbkJhY2tCdXR0b24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgICAgICB9LAogICAgICAgICAgICBJc1BvcnRyYWl0TGFuZHNjYXBlKHApIHsKICAgICAgICAgICAgICAgIGNvbnN0IGxhc3RJbm5lcldpZHRoID0gdGhpcy5fcnVudGltZS5HZXRDYW52YXNNYW5hZ2VyKCkuR2V0TGFzdFdpZHRoKCk7CiAgICAgICAgICAgICAgICBjb25zdCBsYXN0SW5uZXJIZWlnaHQgPSB0aGlzLl9ydW50aW1lLkdldENhbnZhc01hbmFnZXIoKS5HZXRMYXN0SGVpZ2h0KCk7CiAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50ID0gbGFzdElubmVyV2lkdGggPD0gbGFzdElubmVySGVpZ2h0ID8KICAgICAgICAgICAgICAgICAgICAwIDogMTsKICAgICAgICAgICAgICAgIHJldHVybiBjdXJyZW50ID09PSBwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIE9uVXBkYXRlRm91bmQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgICAgICB9LAogICAgICAgICAgICBPblVwZGF0ZVJlYWR5KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgT25PZmZsaW5lUmVhZHkoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgICAgICB9LAogICAgICAgICAgICBPbkhhc2hDaGFuZ2UoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgICAgICB9LAogICAgICAgICAgICBQYWdlVmlzaWJsZSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiAhdGhpcy5fcnVudGltZS5Jc1N1c3BlbmRlZCgpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIE9uUGFnZUhpZGRlbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIE9uUGFnZVZpc2libGUoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgICAgICB9LAogICAgICAgICAgICBIYXNKYXZhKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIElzRG93bmxvYWRpbmdVcGRhdGUoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICAgICAgfSwKICAgICAgICAgICAgT25NZW51QnV0dG9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIE9uU2VhcmNoQnV0dG9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIElzTWV0ZXJlZCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZQogICAgICAgICAgICB9LAogICAgICAgICAgICBJc0NoYXJnaW5nKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgU3VwcG9ydHNGdWxsc2NyZWVuKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gewogICAgICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgICAgICBjb25zdCBPUklFTlRBVElPTlMgPSBbInBvcnRyYWl0IiwgImxhbmRzY2FwZSIsICJwb3J0cmFpdC1wcmltYXJ5IiwgInBvcnRyYWl0LXNlY29uZGFyeSIsICJsYW5kc2NhcGUtcHJpbWFyeSIsICJsYW5kc2NhcGUtc2Vjb25kYXJ5Il07CiAgICAgICAgQzMuUGx1Z2lucy5Ccm93c2VyLkFjdHMgPSB7CiAgICAgICAgICAgIEFsZXJ0KG1lc3NhZ2UpIHsKICAgICAgICAgICAgICAgIHRoaXMuUG9zdFRvRE9NKCJhbGVydCIsIHsKICAgICAgICAgICAgICAgICAgICAibWVzc2FnZSI6IG1lc3NhZ2UudG9TdHJpbmcoKQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgQ2xvc2UoKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5faXNDb25zdHJ1Y3RBcmNhZGUpIHJldHVybjsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9ydW50aW1lLklzRGVidWcoKSkgc2VsZi5DM0RlYnVnZ2VyLkNsb3NlV2luZG93KCk7CiAgICAgICAgICAgICAgICBlbHNlIHRoaXMuUG9zdFRvRE9NKCJjbG9zZSIpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIEZvY3VzKCkgewogICAgICAgICAgICAgICAgdGhpcy5Qb3N0VG9ET00oInNldC1mb2N1cyIsIHsKICAgICAgICAgICAgICAgICAgICAiaXNGb2N1cyI6IHRydWUKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIEJsdXIoKSB7CiAgICAgICAgICAgICAgICB0aGlzLlBvc3RUb0RPTSgic2V0LWZvY3VzIiwgewogICAgICAgICAgICAgICAgICAgICJpc0ZvY3VzIjogZmFsc2UKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIEdvQmFjaygpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9pc0NvbnN0cnVjdEFyY2FkZSkgcmV0dXJuOwogICAgICAgICAgICAgICAgdGhpcy5Qb3N0VG9ET00oIm5hdmlnYXRlIiwgewogICAgICAgICAgICAgICAgICAgICJ0eXBlIjogImJhY2siCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9LAogICAgICAgICAgICBHb0ZvcndhcmQoKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5faXNDb25zdHJ1Y3RBcmNhZGUpIHJldHVybjsKICAgICAgICAgICAgICAgIHRoaXMuUG9zdFRvRE9NKCJuYXZpZ2F0ZSIsIHsKICAgICAgICAgICAgICAgICAgICAidHlwZSI6ICJmb3J3YXJkIgogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgR29Ib21lKCkge30sCiAgICAgICAgICAgIFJlbG9hZCgpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9pc0NvbnN0cnVjdEFyY2FkZSkgcmV0dXJuOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuX3J1bnRpbWUuSXNEZWJ1ZygpKSB0aGlzLl9ydW50aW1lLlBvc3RUb0RlYnVnZ2VyKHsKICAgICAgICAgICAgICAgICAgICAidHlwZSI6ICJyZWxvYWQiCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGVsc2UgdGhpcy5Qb3N0VG9ET00oIm5hdmlnYXRlIiwgewogICAgICAgICAgICAgICAgICAgICJ0eXBlIjogInJlbG9hZCIKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIEdvVG9VUkwodXJsLCB0YXJnZXQpIHsKICAgICAgICAgICAgICAgIHRoaXMuX1Bvc3RUb0RPTU1heWJlU3luYygibmF2aWdhdGUiLCB7CiAgICAgICAgICAgICAgICAgICAgInR5cGUiOiAidXJsIiwKICAgICAgICAgICAgICAgICAgICAidXJsIjogdXJsLAogICAgICAgICAgICAgICAgICAgICJ0YXJnZXQiOiB0YXJnZXQsCiAgICAgICAgICAgICAgICAgICAgImV4cG9ydFR5cGUiOiB0aGlzLl9ydW50aW1lLkdldEV4cG9ydFR5cGUoKQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgR29Ub1VSTFdpbmRvdyh1cmwsIHRhZykgewogICAgICAgICAgICAgICAgdGhpcy5fUG9zdFRvRE9NTWF5YmVTeW5jKCJuYXZpZ2F0ZSIsIHsKICAgICAgICAgICAgICAgICAgICAidHlwZSI6ICJuZXctd2luZG93IiwKICAgICAgICAgICAgICAgICAgICAidXJsIjogdXJsLAogICAgICAgICAgICAgICAgICAgICJ0YWciOiB0YWcsCiAgICAgICAgICAgICAgICAgICAgImV4cG9ydFR5cGUiOiB0aGlzLl9ydW50aW1lLkdldEV4cG9ydFR5cGUoKQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgUmVxdWVzdEZ1bGxTY3JlZW4obW9kZSwgbmF2VWkpIHsKICAgICAgICAgICAgICAgIGlmIChtb2RlID49IDIpIG1vZGUgKz0gMTsKICAgICAgICAgICAgICAgIGlmIChtb2RlID09PSA2KSBtb2RlID0gMjsKICAgICAgICAgICAgICAgIGlmIChtb2RlID09PSAxKSBtb2RlID0gMDsKICAgICAgICAgICAgICAgIGNvbnN0IG1vZGVTdHIgPSBDMy5DYW52YXNNYW5hZ2VyLl9GdWxsc2NyZWVuTW9kZU51bWJlclRvU3RyaW5nKG1vZGUpOwogICAgICAgICAgICAgICAgdGhpcy5fcnVudGltZS5HZXRDYW52YXNNYW5hZ2VyKCkuU2V0RG9jdW1lbnRGdWxsc2NyZWVuTW9kZShtb2RlU3RyKTsKICAgICAgICAgICAgICAgIHRoaXMuX1Bvc3RUb0RPTU1heWJlU3luYygicmVxdWVzdC1mdWxsc2NyZWVuIiwgewogICAgICAgICAgICAgICAgICAgICJuYXZVSSI6IG5hdlVpCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9LAogICAgICAgICAgICBDYW5jZWxGdWxsU2NyZWVuKCkgewogICAgICAgICAgICAgICAgdGhpcy5fUG9zdFRvRE9NTWF5YmVTeW5jKCJleGl0LWZ1bGxzY3JlZW4iKQogICAgICAgICAgICB9LAogICAgICAgICAgICBWaWJyYXRlKHBhdHRlcm4pIHsKICAgICAgICAgICAgICAgIGNvbnN0IGFyciA9IHBhdHRlcm4uc3BsaXQoIiwiKTsKICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBhcnIubGVuZ3RoOyBpIDwKICAgICAgICAgICAgICAgICAgICBsZW47ICsraSkgYXJyW2ldID0gcGFyc2VJbnQoYXJyW2ldLCAxMCk7CiAgICAgICAgICAgICAgICB0aGlzLl9Qb3N0VG9ET01NYXliZVN5bmMoInZpYnJhdGUiLCB7CiAgICAgICAgICAgICAgICAgICAgInBhdHRlcm4iOiBhcnIKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGFzeW5jIEludm9rZURvd25sb2FkKHVybCwgZmlsZW5hbWUpIHsKICAgICAgICAgICAgICAgIGlmICghdXJsIHx8ICFmaWxlbmFtZSkgcmV0dXJuOwogICAgICAgICAgICAgICAgY29uc3QgdXJsVG9Eb3dubG9hZCA9IGF3YWl0IHRoaXMuX3J1bnRpbWUuR2V0QXNzZXRNYW5hZ2VyKCkuR2V0UHJvamVjdEZpbGVVcmwodXJsKTsKICAgICAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuSW52b2tlRG93bmxvYWQodXJsVG9Eb3dubG9hZCwgZmlsZW5hbWUpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIEludm9rZURvd25sb2FkU3RyaW5nKHN0ciwgbWltZVR5cGUsIGZpbGVuYW1lKSB7CiAgICAgICAgICAgICAgICBpZiAoIWZpbGVuYW1lKSByZXR1cm47CiAgICAgICAgICAgICAgICBjb25zdCBkYXRhVXJpID0gYGRhdGE6JHttaW1lVHlwZX0sJHtlbmNvZGVVUklDb21wb25lbnQoc3RyKX1gOwogICAgICAgICAgICAgICAgdGhpcy5fcnVudGltZS5JbnZva2VEb3dubG9hZChkYXRhVXJpLCBmaWxlbmFtZSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgQ29uc29sZUxvZyh0eXBlLCBtc2cpIHsKICAgICAgICAgICAgICAgIG1zZyA9IG1zZy50b1N0cmluZygpOwogICAgICAgICAgICAgICAgaWYgKHR5cGUgPT09CiAgICAgICAgICAgICAgICAgICAgMCkgY29uc29sZS5sb2cobXNnKTsKICAgICAgICAgICAgICAgIGVsc2UgaWYgKHR5cGUgPT09IDEpIGNvbnNvbGUud2Fybihtc2cpOwogICAgICAgICAgICAgICAgZWxzZSBpZiAodHlwZSA9PT0gMikgY29uc29sZS5lcnJvcihtc2cpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIENvbnNvbGVHcm91cChuYW1lKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmdyb3VwKG5hbWUpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIENvbnNvbGVHcm91cEVuZCgpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZ3JvdXBFbmQoKQogICAgICAgICAgICB9LAogICAgICAgICAgICBFeGVjSnMoanNTdHIpIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgZXZhbChqc1N0cikKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIGV4ZWN1dGluZyBKYXZhU2NyaXB0OiAiLCBlcnIpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIExvY2tPcmllbnRhdGlvbihvKSB7CiAgICAgICAgICAgICAgICBvID0gTWF0aC5mbG9vcihvKTsKICAgICAgICAgICAgICAgIGlmIChvIDwgMCB8fCBvID49IE9SSUVOVEFUSU9OUy5sZW5ndGgpIHJldHVybjsKICAgICAgICAgICAgICAgIGNvbnN0IG9yaWVudGF0aW9uID0gT1JJRU5UQVRJT05TW29dOwogICAgICAgICAgICAgICAgdGhpcy5fUG9zdFRvRE9NTWF5YmVTeW5jKCJsb2NrLW9yaWVudGF0aW9uIiwgewogICAgICAgICAgICAgICAgICAgICJvcmllbnRhdGlvbiI6IG9yaWVudGF0aW9uCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9LAogICAgICAgICAgICBVbmxvY2tPcmllbnRhdGlvbigpIHsKICAgICAgICAgICAgICAgIHRoaXMuX1Bvc3RUb0RPTU1heWJlU3luYygidW5sb2NrLW9yaWVudGF0aW9uIikKICAgICAgICAgICAgfSwKICAgICAgICAgICAgTG9hZFN0eWxlU2hlZXQodXJsKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9ydW50aW1lLkdldEFzc2V0TWFuYWdlcigpLkxvYWRTdHlsZVNoZWV0KHVybCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgYXN5bmMgU2V0RG9jdW1lbnRDU1NTdHlsZShwcm9wTmFtZSwgdmFsdWUsIHNlbGVjdG9yLCB0eXBlKSB7CiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLlBvc3RUb0RPTUFzeW5jKCJzZXQtZG9jdW1lbnQtY3NzLXN0eWxlIiwgewogICAgICAgICAgICAgICAgICAgICJwcm9wIjogQzMuQ1NTVG9DYW1lbENhc2UocHJvcE5hbWUpLAogICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6IHZhbHVlLAogICAgICAgICAgICAgICAgICAgICJzZWxlY3RvciI6IHNlbGVjdG9yLAogICAgICAgICAgICAgICAgICAgICJpcy1hbGwiOiB0eXBlICE9PSAwCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9LAogICAgICAgICAgICBhc3luYyBHZXREb2N1bWVudENTU1N0eWxlKHByb3BOYW1lLCBzZWxlY3RvciwgdGFnKSB7CiAgICAgICAgICAgICAgICBjb25zdCByZXQgPSBhd2FpdCB0aGlzLlBvc3RUb0RPTUFzeW5jKCJnZXQtZG9jdW1lbnQtY3NzLXN0eWxlIiwgewogICAgICAgICAgICAgICAgICAgICJwcm9wIjogcHJvcE5hbWUsCiAgICAgICAgICAgICAgICAgICAgInNlbGVjdG9yIjogc2VsZWN0b3IKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgaWYgKHJldFsiaXNPayJdKSB0aGlzLl9jc3NTdHlsZU1hcC5zZXQodGFnLnRvTG93ZXJDYXNlKCksIHJldFsicmVzdWx0Il0udHJpbSgpKQogICAgICAgICAgICB9LAogICAgICAgICAgICBTZXRIYXNoKGgpIHsKICAgICAgICAgICAgICAgIHRoaXMuUG9zdFRvRE9NKCJzZXQtaGFzaCIsIHsKICAgICAgICAgICAgICAgICAgICAiaGFzaCI6IGgKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IHsKICAgICAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICAgICAgQzMuUGx1Z2lucy5Ccm93c2VyLkV4cHMgPSB7CiAgICAgICAgICAgIFVSTCgpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9ydW50aW1lLklzSW5Xb3JrZXIoKSkgcmV0dXJuIHRoaXMuX2luaXRMb2NhdGlvblN0cjsKICAgICAgICAgICAgICAgIGVsc2UgcmV0dXJuIGxvY2F0aW9uLnRvU3RyaW5nKCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgUHJvdG9jb2woKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fcnVudGltZS5Jc0luV29ya2VyKCkpIHJldHVybiAobmV3IFVSTCh0aGlzLl9pbml0TG9jYXRpb25TdHIpKS5wcm90b2NvbDsKICAgICAgICAgICAgICAgIGVsc2UgcmV0dXJuIGxvY2F0aW9uLnByb3RvY29sCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIERvbWFpbigpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9ydW50aW1lLklzSW5Xb3JrZXIoKSkgcmV0dXJuIChuZXcgVVJMKHRoaXMuX2luaXRMb2NhdGlvblN0cikpLmhvc3RuYW1lOwogICAgICAgICAgICAgICAgZWxzZSByZXR1cm4gbG9jYXRpb24uaG9zdG5hbWUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgUG9ydCgpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9ydW50aW1lLklzSW5Xb3JrZXIoKSkgcmV0dXJuIChuZXcgVVJMKHRoaXMuX2luaXRMb2NhdGlvblN0cikpLnBvcnQ7CiAgICAgICAgICAgICAgICBlbHNlIHJldHVybiBsb2NhdGlvbi5wb3J0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFBhdGhOYW1lKCkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuX3J1bnRpbWUuSXNJbldvcmtlcigpKSByZXR1cm4gKG5ldyBVUkwodGhpcy5faW5pdExvY2F0aW9uU3RyKSkucGF0aG5hbWU7CiAgICAgICAgICAgICAgICBlbHNlIHJldHVybiBsb2NhdGlvbi5wYXRobmFtZQogICAgICAgICAgICB9LAogICAgICAgICAgICBIYXNoKCkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuX3J1bnRpbWUuSXNJbldvcmtlcigpKSByZXR1cm4gKG5ldyBVUkwodGhpcy5faW5pdExvY2F0aW9uU3RyKSkuaGFzaDsKICAgICAgICAgICAgICAgIGVsc2UgcmV0dXJuIGxvY2F0aW9uLmhhc2gKICAgICAgICAgICAgfSwKICAgICAgICAgICAgUXVlcnlTdHJpbmcoKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fcnVudGltZS5Jc0luV29ya2VyKCkpIHJldHVybiAobmV3IFVSTCh0aGlzLl9pbml0TG9jYXRpb25TdHIpKS5zZWFyY2g7CiAgICAgICAgICAgICAgICBlbHNlIHJldHVybiBsb2NhdGlvbi5zZWFyY2gKICAgICAgICAgICAgfSwKICAgICAgICAgICAgUXVlcnlQYXJhbShwYXJhbSkgewogICAgICAgICAgICAgICAgY29uc3Qgc2VhcmNoID0gdGhpcy5fcnVudGltZS5Jc0luV29ya2VyKCkgPyAobmV3IFVSTCh0aGlzLl9pbml0TG9jYXRpb25TdHIpKS5zZWFyY2ggOiBsb2NhdGlvbi5zZWFyY2g7CiAgICAgICAgICAgICAgICBjb25zdCBtYXRjaCA9IFJlZ0V4cCgiWz8mXSIgKyBwYXJhbSArICI9KFteJl0qKSIpLmV4ZWMoc2VhcmNoKTsKICAgICAgICAgICAgICAgIGlmIChtYXRjaCkgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChtYXRjaFsxXS5yZXBsYWNlKC9cKy9nLCAiICIpKTsKICAgICAgICAgICAgICAgIGVsc2UgcmV0dXJuICIiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFJlZmVycmVyKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3JlZmVycmVyCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFRpdGxlKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2RvY1RpdGxlCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIExhbmd1YWdlKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIG5hdmlnYXRvci5sYW5ndWFnZQogICAgICAgICAgICB9LAogICAgICAgICAgICBQbGF0Zm9ybSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBuYXZpZ2F0b3IucGxhdGZvcm0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgVXNlckFnZW50KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIG5hdmlnYXRvci51c2VyQWdlbnQKICAgICAgICAgICAgfSwKICAgICAgICAgICAgRXhlY0pTKGpzU3RyKSB7CiAgICAgICAgICAgICAgICBsZXQgcmVzdWx0ID0gMDsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gZXZhbChqc1N0cikKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIGV4ZWN1dGluZyBKYXZhU2NyaXB0OiAiLCBlcnIpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHJlc3VsdCA9PT0gIm51bWJlciIgfHwgdHlwZW9mIHJlc3VsdCA9PT0gInN0cmluZyIpIHJldHVybiByZXN1bHQ7CiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHJlc3VsdCA9PT0gImJvb2xlYW4iKSByZXR1cm4gcmVzdWx0ID8gMSA6IDA7CiAgICAgICAgICAgICAgICBlbHNlIHJldHVybiAwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIENTU1N0eWxlVmFsdWUodGFnKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fY3NzU3R5bGVNYXAuZ2V0KHRhZykgfHwgIiIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgTmFtZSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBuYXZpZ2F0b3IuYXBwTmFtZQogICAgICAgICAgICB9LAogICAgICAgICAgICBWZXJzaW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIG5hdmlnYXRvci5hcHBWZXJzaW9uCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFByb2R1Y3QoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbmF2aWdhdG9yLnByb2R1Y3QKICAgICAgICAgICAgfSwKICAgICAgICAgICAgVmVuZG9yKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIG5hdmlnYXRvci52ZW5kb3IKICAgICAgICAgICAgfSwKICAgICAgICAgICAgQmF0dGVyeUxldmVsKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIDEKICAgICAgICAgICAgfSwKICAgICAgICAgICAgQmF0dGVyeVRpbWVMZWZ0KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIEluZmluaXR5CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIEJhbmR3aWR0aCgpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGNvbm5lY3Rpb24gPSBuYXZpZ2F0b3JbImNvbm5lY3Rpb24iXTsKICAgICAgICAgICAgICAgIGlmIChjb25uZWN0aW9uKSByZXR1cm4gY29ubmVjdGlvblsiZG93bmxpbmsiXSB8fCBjb25uZWN0aW9uWyJkb3dubGlua01heCJdIHx8IGNvbm5lY3Rpb25bImJhbmR3aWR0aCJdIHx8IEluZmluaXR5OwogICAgICAgICAgICAgICAgZWxzZSByZXR1cm4gSW5maW5pdHkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgQ29ubmVjdGlvblR5cGUoKSB7CiAgICAgICAgICAgICAgICBjb25zdCBjb25uZWN0aW9uID0gbmF2aWdhdG9yWyJjb25uZWN0aW9uIl07CiAgICAgICAgICAgICAgICBpZiAoY29ubmVjdGlvbikgcmV0dXJuIGNvbm5lY3Rpb25bInR5cGUiXSB8fCAidW5rbm93biI7CiAgICAgICAgICAgICAgICBlbHNlIHJldHVybiAidW5rbm93biIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgRGV2aWNlUGl4ZWxSYXRpbygpIHsKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLmRldmljZVBpeGVsUmF0aW8KICAgICAgICAgICAgfSwKICAgICAgICAgICAgU2NyZWVuV2lkdGgoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fc2NyZWVuV2lkdGgKICAgICAgICAgICAgfSwKICAgICAgICAgICAgU2NyZWVuSGVpZ2h0KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NjcmVlbkhlaWdodAogICAgICAgICAgICB9LAogICAgICAgICAgICBXaW5kb3dJbm5lcldpZHRoKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUuR2V0Q2FudmFzTWFuYWdlcigpLkdldExhc3RXaWR0aCgpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFdpbmRvd0lubmVySGVpZ2h0KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUuR2V0Q2FudmFzTWFuYWdlcigpLkdldExhc3RIZWlnaHQoKQogICAgICAgICAgICB9LAogICAgICAgICAgICBXaW5kb3dPdXRlcldpZHRoKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3dpbmRvd091dGVyV2lkdGgKICAgICAgICAgICAgfSwKICAgICAgICAgICAgV2luZG93T3V0ZXJIZWlnaHQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fd2luZG93T3V0ZXJXaWR0aAogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKCn0KCnsKICAgICJ1c2Ugc3RyaWN0IjsKICAgIEMzLlBsdWdpbnMuRXBvbmVzaF9HYW1lU2NvcmUgPSBjbGFzcyBleHRlbmRzIEMzLlNES1BsdWdpbkJhc2UgewogICAgICAgIGNvbnN0cnVjdG9yKGUpIHsKICAgICAgICAgICAgc3VwZXIoZSwgIkVwb25lc2hfR2FtZVNjb3JlIikKICAgICAgICB9CiAgICAgICAgUmVsZWFzZSgpIHsKICAgICAgICAgICAgc3VwZXIuUmVsZWFzZSgpCiAgICAgICAgfQogICAgfTsKfQoKewogICAgInVzZSBzdHJpY3QiOwogICAgQzMuUGx1Z2lucy5FcG9uZXNoX0dhbWVTY29yZS5UeXBlID0gY2xhc3MgZXh0ZW5kcyBDMy5TREtUeXBlQmFzZSB7CiAgICAgICAgY29uc3RydWN0b3IoZSkgewogICAgICAgICAgICBzdXBlcihlKQogICAgICAgIH0KICAgICAgICBSZWxlYXNlKCkgewogICAgICAgICAgICBzdXBlci5SZWxlYXNlKCkKICAgICAgICB9CiAgICAgICAgT25DcmVhdGUoKSB7fQogICAgfTsKfQoKewogICAgInVzZSBzdHJpY3QiOyB7CiAgICAgICAgY29uc3QgYSA9ICJodHRwczovL2dzLmVwb25lc2guY29tL3NkayI7CiAgICAgICAgQzMuUGx1Z2lucy5FcG9uZXNoX0dhbWVTY29yZS5JbnN0YW5jZSA9IGNsYXNzIGV4dGVuZHMgQzMuU0RLSW5zdGFuY2VCYXNlIHsKICAgICAgICAgICAgY29uc3RydWN0b3IoZSwgdCkgewogICAgICAgICAgICAgICAgaWYgKHN1cGVyKGUpLCB0aGlzLm1hcHBlcnMgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxhbmd1YWdlOiBbImVuIiwgInJ1IiwgImZyIiwgIml0IiwgImRlIiwgImVzIiwgInpoIiwgInB0IiwgImtvIiwgImphIiwgInRyIiwgImFyIiwgImhpIiwgImlkIl0sCiAgICAgICAgICAgICAgICAgICAgICAgIGF2YXRhckdlbmVyYXRvcjogWyJkaWNlYmVhcl9yZXRybyIsICJkaWNlYmVhcl9pZGVudGljb24iLCAiZGljZWJlYXJfaHVtYW4iLCAiZGljZWJlYXJfbWljYWgiLCAiZGljZWJlYXJfYm90dHRzIiwgImljb3RhciIsICJyb2JvaGFzaF9yb2JvdHMiLCAicm9ib2hhc2hfY2F0cyJdLAogICAgICAgICAgICAgICAgICAgICAgICBvcmRlcjogWyJkZWZhdWx0IiwgIkRFU0MiLCAiQVNDIl0sCiAgICAgICAgICAgICAgICAgICAgICAgIHdpdGhNZTogWyJub25lIiwgImZpcnN0IiwgImxhc3QiXSwKICAgICAgICAgICAgICAgICAgICAgICAgcGxhdGZvcm06IFsiWUFOREVYIiwgIlZLIiwgIk5PTkUiLCAiT0siLCAiR0FNRV9NT05FVElaRSIsICJDUkFaWV9HQU1FUyIsICJHQU1FX0RJU1RSSUJVVElPTiIsICJTTUFSVE1BUktFVCIsICJHQU1FUElYIiwgIlBPS0kiLCAiVktfUExBWSJdLAogICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudFR5cGVzOiBbIlBMQVlFUl9QUklWQUNZX1BPTElDWSJdLAogICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudEZvcm1hdDogWyJIVE1MIiwgIlRYVCIsICJSQVciXSwKICAgICAgICAgICAgICAgICAgICAgICAgdmFyaWFibGVzVHlwZXM6IFsic3RhdHMiLCAiZGF0YSIsICJmbGFnIiwgImltYWdlIiwgImZpbGUiLCAiZG9jX2h0bWwiXSwKICAgICAgICAgICAgICAgICAgICAgICAgY29tcGFyZTogWyhlLCB0KSA9PiBlID09PSB0LCAoZSwgdCkgPT4gZSAhPT0gdCwgKGUsIHQpID0+IGUgPCB0LCAoZSwgdCkgPT4gZSA8PSB0LCAoZSwgdCkgPT4gdCA8IGUsIChlLCB0KSA9PiB0IDw9IGVdCiAgICAgICAgICAgICAgICAgICAgfSwgdGhpcy5ldG9zID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gInN0cmluZyIgPT0gdHlwZW9mIGUgPyBlIDogIm1lc3NhZ2UiIGluIGUgPyBlLm1lc3NhZ2UgOiBTdHJpbmcoZSkKICAgICAgICAgICAgICAgICAgICB9LCB0aGlzLmNvbmRpdGlvbnMgPSBDMy5QbHVnaW5zLkVwb25lc2hfR2FtZVNjb3JlLkNuZHMsIHRoaXMuYWN0aW9ucyA9IEMzLlBsdWdpbnMuRXBvbmVzaF9HYW1lU2NvcmUuQWN0cywgdGhpcy5oYW5kbGVSZXN1bHQgPSAoZSwgdCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlzTGFzdEFjdGlvblN1Y2Nlc3MgPSAhIWUsIHQgJiYgKHRoaXMubGFzdEVycm9yID0gdGhpcy5ldG9zKHQpLCBjb25zb2xlLndhcm4odCkpCiAgICAgICAgICAgICAgICAgICAgfSwgdGhpcy5hd2FpdGVycyA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVyOiB7fSwKICAgICAgICAgICAgICAgICAgICAgICAgZ3A6IHt9CiAgICAgICAgICAgICAgICAgICAgfSwgdGhpcy5hd2FpdGVycy5ncC5yZWFkeSA9IG5ldyBQcm9taXNlKChlLCB0KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYXdhaXRlcnMuZ3AuZG9uZSA9IGUsIHRoaXMuYXdhaXRlcnMuZ3AuYWJvcnQgPSB0CiAgICAgICAgICAgICAgICAgICAgfSksIHRoaXMuYXdhaXRlcnMucGxheWVyLnJlYWR5ID0gbmV3IFByb21pc2UoKGUsIHQpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hd2FpdGVycy5wbGF5ZXIuZG9uZSA9IGUsIHRoaXMuYXdhaXRlcnMucGxheWVyLmFib3J0ID0gdAogICAgICAgICAgICAgICAgICAgIH0pLCB0aGlzLmxlYWRlcmJvYXJkID0gW10sIHRoaXMubGVhZGVyYm9hcmRJbmZvID0ge30sIHRoaXMubGVhZGVyYm9hcmRSZWNvcmRzID0ge30sIHRoaXMuY3VycmVudExlYWRlcmJvYXJkSW5kZXggPSAwLCB0aGlzLmN1cnJlbnRMZWFkZXJib2FyZFBsYXllciA9IHt9LCB0aGlzLmxhc3RMZWFkZXJib2FyZFRhZyA9ICIiLCB0aGlzLmxhc3RMZWFkZXJib2FyZFZhcmlhbnQgPSAiIiwgdGhpcy5sYXN0TGVhZGVyYm9hcmRQbGF5ZXJSYXRpbmdUYWcgPSAiIiwgdGhpcy5sZWFkZXJib2FyZFBsYXllclBvc2l0aW9uID0gMCwgdGhpcy5jdXJyZW50UGxheWVyRmllbGRLZXkgPSAiIiwgdGhpcy5jdXJyZW50UGxheWVyRmllbGRUeXBlID0gIiIsIHRoaXMuY3VycmVudFBsYXllckZpZWxkTmFtZSA9ICIiLCB0aGlzLmN1cnJlbnRQbGF5ZXJGaWVsZFZhbHVlID0gIiIsIHRoaXMuY3VycmVudFBsYXllckZpZWxkVmFyaWFudFZhbHVlID0gIiIsIHRoaXMuY3VycmVudFBsYXllckZpZWxkVmFyaWFudE5hbWUgPSAiIiwgdGhpcy5jdXJyZW50UGxheWVyRmllbGRWYXJpYW50SW5kZXggPSAwLCB0aGlzLmFjaGlldmVtZW50cyA9IFtdLCB0aGlzLmFjaGlldmVtZW50c0dyb3VwcyA9IFtdLCB0aGlzLnBsYXllckFjaGlldmVtZW50cyA9IFtdLCB0aGlzLmN1cnJlbnRBY2hpZXZlbWVudEluZGV4ID0gMCwgdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnQgPSB7fSwgdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnRzR3JvdXBJbmRleCA9IDAsIHRoaXMuY3VycmVudEFjaGlldmVtZW50c0dyb3VwSWQgPSAwLCB0aGlzLmN1cnJlbnRBY2hpZXZlbWVudHNHcm91cFRhZyA9ICIiLCB0aGlzLmN1cnJlbnRBY2hpZXZlbWVudHNHcm91cE5hbWUgPSAiIiwgdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnRzR3JvdXBEZXNjcmlwdGlvbiA9ICIiLCB0aGlzLmN1cnJlbnRQbGF5ZXJBY2hpZXZlbWVudEluZGV4ID0gMCwgdGhpcy5jdXJyZW50UGxheWVyQWNoaWV2ZW1lbnRJZCA9IDAsIHRoaXMuY3VycmVudFBsYXllckFjaGlldmVtZW50VW5sb2NrRGF0ZSA9ICIiLCB0aGlzLmlzVW5sb2NrQWNoaWV2ZW1lbnRTdWNjZXNzID0gITEsIHRoaXMudW5sb2NrQWNoaWV2ZW1lbnRFcnJvciA9ICIiLCB0aGlzLmlzU2V0UHJvZ3Jlc3NBY2hpZXZlbWVudFN1Y2Nlc3MgPSAhMSwgdGhpcy5zZXRQcm9ncmVzc0FjaGlldmVtZW50RXJyb3IgPSAiIiwgdGhpcy5wcm9kdWN0cyA9IFtdLCB0aGlzLnBsYXllclB1cmNoYXNlcyA9IFtdLCB0aGlzLmN1cnJlbnRQcm9kdWN0SW5kZXggPSAwLCB0aGlzLmN1cnJlbnRQcm9kdWN0ID0gewogICAgICAgICAgICAgICAgICAgICAgICBpZDogMCwKICAgICAgICAgICAgICAgICAgICAgICAgdGFnOiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgaWNvbjogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgIGljb25TbWFsbDogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgIHByaWNlOiAwLAogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeTogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbmN5U3ltYm9sOiAiIgogICAgICAgICAgICAgICAgICAgIH0sIHRoaXMuY3VycmVudFByb2R1Y3RQdXJjaGFzZXMgPSAwLCB0aGlzLmN1cnJlbnRQdXJjaGFzZUluZGV4ID0gMCwgdGhpcy5jdXJyZW50UHVyY2hhc2UgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiAwLAogICAgICAgICAgICAgICAgICAgICAgICB0YWc6ICIiLAogICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVkQXQ6ICIiLAogICAgICAgICAgICAgICAgICAgICAgICBleHBpcmVkQXQ6ICIiLAogICAgICAgICAgICAgICAgICAgICAgICBzdWJzY3JpYmVkOiAhMQogICAgICAgICAgICAgICAgICAgIH0sIHRoaXMuaXNTdWJzY3JpYmVQcm9kdWN0U3VjY2VzcyA9ICExLCB0aGlzLmlzVW5zdWJzY3JpYmVQcm9kdWN0U3VjY2VzcyA9ICExLCB0aGlzLmlzUHVyY2hhc2VQcm9kdWN0U3VjY2VzcyA9ICExLCB0aGlzLnB1cmNoYXNlUHJvZHVjdEVycm9yID0gIiIsIHRoaXMucHVyY2hhc2VkUHJvZHVjdElkID0gMCwgdGhpcy5wdXJjaGFzZWRQcm9kdWN0VGFnID0gIiIsIHRoaXMuaXNDb25zdW1lUHJvZHVjdFN1Y2Nlc3MgPSAhMSwgdGhpcy5jb25zdW1lUHJvZHVjdEVycm9yID0gIiIsIHRoaXMuY29uc3VtZWRQcm9kdWN0SWQgPSAwLCB0aGlzLmNvbnN1bWVkUHJvZHVjdFRhZyA9ICIiLCB0aGlzLmlzTGFzdEFkU3VjY2VzcyA9ICExLCB0aGlzLmlzTGFzdFNoYXJlU3VjY2VzcyA9ICExLCB0aGlzLmlzTGFzdENvbW11bml0eUpvaW5TdWNjZXNzID0gITEsIHRoaXMuaXNMYXN0QWRkU2hvcnRjdXRTdWNjZXNzID0gITEsIHRoaXMuaXNSZWFkeSA9ICExLCB0aGlzLmlzUGxheWVyUmVhZHkgPSAhMSwgdGhpcy5nYW1lc0NvbGxlY3Rpb24gPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiAwLAogICAgICAgICAgICAgICAgICAgICAgICB0YWc6ICIiLAogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICIiLAogICAgICAgICAgICAgICAgICAgICAgICBnYW1lczogW10KICAgICAgICAgICAgICAgICAgICB9LCB0aGlzLmN1cnJlbnRHYW1lSW5kZXggPSAwLCB0aGlzLmN1cnJlbnRHYW1lSWQgPSAwLCB0aGlzLmN1cnJlbnRHYW1lTmFtZSA9ICIiLCB0aGlzLmN1cnJlbnRHYW1lRGVzY3JpcHRpb24gPSAiIiwgdGhpcy5jdXJyZW50R2FtZUljb24gPSAiIiwgdGhpcy5jdXJyZW50R2FtZVVybCA9ICIiLCB0aGlzLmdhbWVzQ29sbGVjdGlvbkZldGNoRXJyb3IgPSAiIiwgdGhpcy5sYXN0R2FtZXNDb2xsZWN0aW9uSWRPclRhZyA9ICIiLCB0aGlzLmRvY3VtZW50ID0gewogICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudDogIiIKICAgICAgICAgICAgICAgICAgICB9LCB0aGlzLmxhc3REb2N1bWVudFR5cGUgPSAiIiwgdGhpcy5kb2N1bWVudEZldGNoRXJyb3IgPSAiIiwgdGhpcy5sYXN0RXJyb3IgPSAiIiwgdGhpcy5pc0xhc3RBY3Rpb25TdWNjZXNzID0gITEsIHRoaXMuc2hhcmVMaW5rID0gIiIsIHRoaXMuc2hhcmVQYXJhbXMgPSB7fSwgdGhpcy5pbWFnZXMgPSBbXSwgdGhpcy5jYW5Mb2FkTW9yZUltYWdlcyA9ICExLCB0aGlzLmN1cnJlbnRJbWFnZUluZGV4ID0gMCwgdGhpcy5jdXJyZW50SW1hZ2VUYWdJbmRleCA9IDAsIHRoaXMuY3VycmVudEltYWdlVGFnID0gIiIsIHRoaXMubGFzdEltYWdlVGVtcFVybCA9ICIiLCB0aGlzLmN1cnJlbnRJbWFnZSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgaWQ6ICIiLAogICAgICAgICAgICAgICAgICAgICAgICBwbGF5ZXJJZDogMCwKICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogMCwKICAgICAgICAgICAgICAgICAgICAgICAgc3JjOiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgdGFnczogW10KICAgICAgICAgICAgICAgICAgICB9LCB0aGlzLmZpbGVzID0gW10sIHRoaXMubGFzdEZpbGVDb250ZW50ID0gIiIsIHRoaXMuY2FuTG9hZE1vcmVGaWxlcyA9ICExLCB0aGlzLmN1cnJlbnRGaWxlSW5kZXggPSAwLCB0aGlzLmN1cnJlbnRGaWxlVGFnSW5kZXggPSAwLCB0aGlzLmN1cnJlbnRGaWxlVGFnID0gIiIsIHRoaXMubGFzdEZpbGVUZW1wVXJsID0gIiIsIHRoaXMuY3VycmVudEZpbGUgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVySWQ6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICIiLAogICAgICAgICAgICAgICAgICAgICAgICBzaXplOiAwLAogICAgICAgICAgICAgICAgICAgICAgICBzcmM6ICIiLAogICAgICAgICAgICAgICAgICAgICAgICB0YWdzOiBbXQogICAgICAgICAgICAgICAgICAgIH0sIHRoaXMuY3VycmVudFZhcmlhYmxlSW5kZXggPSAwLCB0aGlzLmN1cnJlbnRWYXJpYWJsZSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAga2V5OiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiAiIgogICAgICAgICAgICAgICAgICAgIH0sIHRoaXMuY3VycmVudFBsYXllcnNJbmRleCA9IDAsIHRoaXMubGFzdFBsYXllcnNUYWcgPSAiIiwgdGhpcy5jdXJyZW50UGxheWVyc1BsYXllciA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGU6IHt9LAogICAgICAgICAgICAgICAgICAgICAgICBhY2hpZXZlbWVudHM6IFtdLAogICAgICAgICAgICAgICAgICAgICAgICBwdXJjaGFzZXM6IFtdCiAgICAgICAgICAgICAgICAgICAgfSwgdGhpcy5wcm9qZWN0SWQgPSBOdW1iZXIodFswXSB8fCAwKSwgdGhpcy5wdWJsaWNUb2tlbiA9IHRbMV0sIHRoaXMuc2hvd1ByZWxvYWRlck9uU3RhcnQgPSB0WzJdLCB0aGlzLnNob3VsZFdhaXRQbGF5ZXJPbkxvYWQgPSB0WzNdLCB0aGlzLmlzRW5hYmxlZCA9IHRbNF0sIHRoaXMuX3J1bnRpbWUuQWRkTG9hZFByb21pc2UodGhpcy5hd2FpdGVycy5ncC5yZWFkeSksIHRoaXMuc2hvdWxkV2FpdFBsYXllck9uTG9hZCAmJiB0aGlzLl9ydW50aW1lLkFkZExvYWRQcm9taXNlKHRoaXMuYXdhaXRlcnMucGxheWVyLnJlYWR5KSwgIXRoaXMuaXNFbmFibGVkKSByZXR1cm4gdGhpcy5vbkVycm9yKCJbR2FtZVB1c2hdIGRpc2FibGVkIiksIHRoaXMuYXdhaXRlcnMuZ3AuZG9uZSgpLCB2b2lkIHRoaXMuYXdhaXRlcnMucGxheWVyLmRvbmUoKTsKICAgICAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuRGlzcGF0Y2hlcigpLmFkZEV2ZW50TGlzdGVuZXIoImFmdGVyZmlyc3RsYXlvdXRzdGFydCIsICgpID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBlID0gdGhpcy5fcnVudGltZS5HZXRJUnVudGltZSgpOwogICAgICAgICAgICAgICAgICAgIGUgJiYgKGUuR2FtZVNjb3JlID0gdGhpcy5ncCwgZS5HYW1lUHVzaCA9IHRoaXMuZ3ApLCB0aGlzLmlzUmVhZHkgJiYgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PblJlYWR5KSwgdGhpcy5pc1BsYXllclJlYWR5ICYmIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25QbGF5ZXJSZWFkeSksIHRoaXMuZ3AuZ2FtZVN0YXJ0KCkKICAgICAgICAgICAgICAgIH0pLCB0aGlzLmxvYWRMaWIoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIG9uRXJyb3IoZSkgewogICAgICAgICAgICAgICAgY29uc29sZS53YXJuKGUpOwogICAgICAgICAgICAgICAgZSA9ICgpID0+IFByb21pc2UucmVzb2x2ZSh7fSk7CiAgICAgICAgICAgICAgICB0aGlzLmF3YWl0ZXJzLmdwLmRvbmUoKSwgdGhpcy5hd2FpdGVycy5wbGF5ZXIuZG9uZSgpLCB0aGlzLmdwID0gewogICAgICAgICAgICAgICAgICAgIG9uKCkge30sCiAgICAgICAgICAgICAgICAgICAgY2hhbmdlTGFuZ3VhZ2U6IGUsCiAgICAgICAgICAgICAgICAgICAgY2hhbmdlQXZhdGFyR2VuZXJhdG9yOiBlLAogICAgICAgICAgICAgICAgICAgIGxvYWRPdmVybGF5OiBlLAogICAgICAgICAgICAgICAgICAgIHBhdXNlOiBlLAogICAgICAgICAgICAgICAgICAgIHJlc3VtZTogZSwKICAgICAgICAgICAgICAgICAgICBnYW1lU3RhcnQ6IGUsCiAgICAgICAgICAgICAgICAgICAgZ2FtZXBsYXlTdGFydDogZSwKICAgICAgICAgICAgICAgICAgICBnYW1lcGxheVN0b3A6IGUsCiAgICAgICAgICAgICAgICAgICAgaXNEZXY6ICExLAogICAgICAgICAgICAgICAgICAgIGlzUGF1c2VkOiAhMSwKICAgICAgICAgICAgICAgICAgICBpc0dhbWVwbGF5OiAhMSwKICAgICAgICAgICAgICAgICAgICBsYW5ndWFnZTogImVuIiwKICAgICAgICAgICAgICAgICAgICBhdmF0YXJHZW5lcmF0b3I6ICJkaWNlYmVhcl9yZXRybyIsCiAgICAgICAgICAgICAgICAgICAgYXBwOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9uKCkge30sCiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICIiLAogICAgICAgICAgICAgICAgICAgICAgICBpbWFnZTogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgIHVybDogIiIsCiAgICAgICAgICAgICAgICAgICAgICAgIGNhbkFkZFNob3J0Y3V0OiAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgYWRkU2hvcnRjdXQ6IGUKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIGFuYWx5dGljczogewogICAgICAgICAgICAgICAgICAgICAgICBvbigpIHt9LAogICAgICAgICAgICAgICAgICAgICAgICBoaXQoKSB7fSwKICAgICAgICAgICAgICAgICAgICAgICAgZ29hbCgpIHt9CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBwbGF0Zm9ybTogewogICAgICAgICAgICAgICAgICAgICAgICBvbigpIHt9LAogICAgICAgICAgICAgICAgICAgICAgICBoYXNJbnRlZ3JhdGVkQXV0aDogITEsCiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICJOT05FIgogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc29jaWFsczogewogICAgICAgICAgICAgICAgICAgICAgICBpc1N1cHBvcnRzTmF0aXZlU2hhcmU6ICExLAogICAgICAgICAgICAgICAgICAgICAgICBpc1N1cHBvcnRzTmF0aXZlUG9zdHM6ICExLAogICAgICAgICAgICAgICAgICAgICAgICBpc1N1cHBvcnRzTmF0aXZlSW52aXRlOiAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgc2hhcmU6IGUsCiAgICAgICAgICAgICAgICAgICAgICAgIHBvc3Q6IGUsCiAgICAgICAgICAgICAgICAgICAgICAgIGludml0ZTogZQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgbGVhZGVyYm9hcmQ6IHsKICAgICAgICAgICAgICAgICAgICAgICAgb24oKSB7fSwKICAgICAgICAgICAgICAgICAgICAgICAgb3BlbjogZSwKICAgICAgICAgICAgICAgICAgICAgICAgZmV0Y2g6IGUsCiAgICAgICAgICAgICAgICAgICAgICAgIGZldGNoU2NvcGVkOiBlLAogICAgICAgICAgICAgICAgICAgICAgICBmZXRjaFBsYXllclJhdGluZzogZSwKICAgICAgICAgICAgICAgICAgICAgICAgZmV0Y2hQbGF5ZXJSYXRpbmdTY29wZWQ6IGUKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIGFjaGlldmVtZW50czogewogICAgICAgICAgICAgICAgICAgICAgICBvbigpIHt9LAogICAgICAgICAgICAgICAgICAgICAgICBoYXMoKSB7fSwKICAgICAgICAgICAgICAgICAgICAgICAgb3BlbjogZSwKICAgICAgICAgICAgICAgICAgICAgICAgZmV0Y2g6IGUsCiAgICAgICAgICAgICAgICAgICAgICAgIHVubG9jazogZSwKICAgICAgICAgICAgICAgICAgICAgICAgc2V0UHJvZ3Jlc3M6IGUKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIGdhbWVzQ29sbGVjdGlvbnM6IHsKICAgICAgICAgICAgICAgICAgICAgICAgb24oKSB7fSwKICAgICAgICAgICAgICAgICAgICAgICAgb3BlbjogZSwKICAgICAgICAgICAgICAgICAgICAgICAgZmV0Y2g6IGUKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50czogewogICAgICAgICAgICAgICAgICAgICAgICBvbigpIHt9LAogICAgICAgICAgICAgICAgICAgICAgICBvcGVuOiBlLAogICAgICAgICAgICAgICAgICAgICAgICBmZXRjaDogZQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgdmFyaWFibGVzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxpc3Q6IFtdLAogICAgICAgICAgICAgICAgICAgICAgICBvbigpIHt9LAogICAgICAgICAgICAgICAgICAgICAgICBmZXRjaDogZSwKICAgICAgICAgICAgICAgICAgICAgICAgZ2V0OiBlLAogICAgICAgICAgICAgICAgICAgICAgICBoYXM6IGUsCiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IGUKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIGltYWdlczogewogICAgICAgICAgICAgICAgICAgICAgICBjYW5VcGxvYWQ6ICExLAogICAgICAgICAgICAgICAgICAgICAgICBsaXN0OiBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgb24oKSB7fSwKICAgICAgICAgICAgICAgICAgICAgICAgdXBsb2FkOiBlLAogICAgICAgICAgICAgICAgICAgICAgICB1cGxvYWRVcmw6IGUsCiAgICAgICAgICAgICAgICAgICAgICAgIGZldGNoOiBlLAogICAgICAgICAgICAgICAgICAgICAgICBmZXRjaE1vcmU6IGUsCiAgICAgICAgICAgICAgICAgICAgICAgIGNob29zZUZpbGU6IGUsCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc2l6ZTogZQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgZmlsZXM6IHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FuVXBsb2FkOiAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgbGlzdDogW10sCiAgICAgICAgICAgICAgICAgICAgICAgIG9uKCkge30sCiAgICAgICAgICAgICAgICAgICAgICAgIHVwbG9hZDogZSwKICAgICAgICAgICAgICAgICAgICAgICAgdXBsb2FkVXJsOiBlLAogICAgICAgICAgICAgICAgICAgICAgICB1cGxvYWRDb250ZW50OiBlLAogICAgICAgICAgICAgICAgICAgICAgICBsb2FkQ29udGVudDogZSwKICAgICAgICAgICAgICAgICAgICAgICAgZmV0Y2g6IGUsCiAgICAgICAgICAgICAgICAgICAgICAgIGZldGNoTW9yZTogZSwKICAgICAgICAgICAgICAgICAgICAgICAgY2hvb3NlRmlsZTogZQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgcGF5bWVudHM6IHsKICAgICAgICAgICAgICAgICAgICAgICAgaXNBdmFpbGFibGU6ICExLAogICAgICAgICAgICAgICAgICAgICAgICBwdXJjaGFzZXM6IFtdLAogICAgICAgICAgICAgICAgICAgICAgICBvbigpIHt9LAogICAgICAgICAgICAgICAgICAgICAgICBoYXMoKSB7fSwKICAgICAgICAgICAgICAgICAgICAgICAgZmV0Y2hQcm9kdWN0czogZSwKICAgICAgICAgICAgICAgICAgICAgICAgcHVyY2hhc2U6IGUsCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN1bWU6IGUKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIGZ1bGxzY3JlZW46IHsKICAgICAgICAgICAgICAgICAgICAgICAgaXNFbmFibGVkOiAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgb24oKSB7fSwKICAgICAgICAgICAgICAgICAgICAgICAgb3BlbigpIHt9LAogICAgICAgICAgICAgICAgICAgICAgICBjbG9zZSgpIHt9LAogICAgICAgICAgICAgICAgICAgICAgICB0b2dnbGUoKSB7fQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgYWRzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlzRnVsbHNjcmVlbkF2YWlsYWJsZTogITEsCiAgICAgICAgICAgICAgICAgICAgICAgIGlzUmV3YXJkZWRBdmFpbGFibGU6ICExLAogICAgICAgICAgICAgICAgICAgICAgICBpc1ByZWxvYWRlckF2YWlsYWJsZTogITEsCiAgICAgICAgICAgICAgICAgICAgICAgIGlzU3RpY2t5QXZhaWxhYmxlOiAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgaXNBZGJsb2NrRW5hYmxlZDogITEsCiAgICAgICAgICAgICAgICAgICAgICAgIG9uKCkge30sCiAgICAgICAgICAgICAgICAgICAgICAgIHNob3dGdWxsc2NyZWVuOiBlLAogICAgICAgICAgICAgICAgICAgICAgICBzaG93UmV3YXJkZWRWaWRlbzogZSwKICAgICAgICAgICAgICAgICAgICAgICAgc2hvd1ByZWxvYWRlcjogZSwKICAgICAgICAgICAgICAgICAgICAgICAgc2hvd1N0aWNreTogZSwKICAgICAgICAgICAgICAgICAgICAgICAgY2xvc2VTdGlja3k6IGUsCiAgICAgICAgICAgICAgICAgICAgICAgIHJlZnJlc2hTdGlja3k6IGUKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHBsYXllcjogewogICAgICAgICAgICAgICAgICAgICAgICBpc1N0dWI6ICEwLAogICAgICAgICAgICAgICAgICAgICAgICBpc0xvZ2dlZEluOiAhMSwKICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICIiLAogICAgICAgICAgICAgICAgICAgICAgICBhdmF0YXI6ICIiLAogICAgICAgICAgICAgICAgICAgICAgICBvbigpIHt9LAogICAgICAgICAgICAgICAgICAgICAgICBzeW5jOiBlLAogICAgICAgICAgICAgICAgICAgICAgICBsb2FkOiBlLAogICAgICAgICAgICAgICAgICAgICAgICBsb2dpbjogZSwKICAgICAgICAgICAgICAgICAgICAgICAgZmV0Y2hGaWVsZHM6IGUsCiAgICAgICAgICAgICAgICAgICAgICAgIGdldEZpZWxkOiBlLAogICAgICAgICAgICAgICAgICAgICAgICBnZXRGaWVsZE5hbWU6IGUsCiAgICAgICAgICAgICAgICAgICAgICAgIGdldEZpZWxkVmFyaWFudE5hbWU6IGUsCiAgICAgICAgICAgICAgICAgICAgICAgIGFkZDogZSwKICAgICAgICAgICAgICAgICAgICAgICAgaGFzOiBlLAogICAgICAgICAgICAgICAgICAgICAgICBnZXQ6IGUsCiAgICAgICAgICAgICAgICAgICAgICAgIHNldDogZSwKICAgICAgICAgICAgICAgICAgICAgICAgdG9nZ2xlOiBlLAogICAgICAgICAgICAgICAgICAgICAgICByZXNldDogZSwKICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3ZlOiBlLAogICAgICAgICAgICAgICAgICAgICAgICB0b0pTT046ICgpID0+ICh7fSksCiAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkczogW10KICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHBsYXllcnM6IHsKICAgICAgICAgICAgICAgICAgICAgICAgb24oKSB7fSwKICAgICAgICAgICAgICAgICAgICAgICAgZmV0Y2g6IGUKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCB0aGlzLmlzUmVhZHkgPSAhMCwgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PblJlYWR5KSwgdGhpcy5pc1BsYXllclJlYWR5ID0gITAsIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25QbGF5ZXJSZWFkeSkKICAgICAgICAgICAgfQogICAgICAgICAgICBsb2FkTGliKCkgewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cub25HUEluaXQgPSBlID0+IGUucmVhZHkudGhlbigoKSA9PiB0aGlzLmluaXQoZSkpLmNhdGNoKGUgPT4gdGhpcy5vbkVycm9yKGUpKSwgZSA9IGRvY3VtZW50LCB0ID0gZS5nZXRFbGVtZW50c0J5VGFnTmFtZSgic2NyaXB0IilbMF0sIChlID0gZS5jcmVhdGVFbGVtZW50KCJzY3JpcHQiKSkuc3JjID0gYCR7YX0vZ2FtZXB1c2guanM/cHJvamVjdElkPSR7dGhpcy5wcm9qZWN0SWR9JnB1YmxpY1Rva2VuPSR7dGhpcy5wdWJsaWNUb2tlbn0mY2FsbGJhY2s9b25HUEluaXRgLCBlLmFzeW5jID0gITAsIGUub25lcnJvciA9IGUgPT4gdGhpcy5vbkVycm9yKGUpLCB0LnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGUsIHQpCiAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlKSwgdGhpcy5vbkVycm9yKGUpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB2YXIgZSwgdAogICAgICAgICAgICB9CiAgICAgICAgICAgIGluaXQoZSkgewogICAgICAgICAgICAgICAgdGhpcy5ncCA9IGU7CiAgICAgICAgICAgICAgICBjb25zdCB0ID0gdGhpcy5fcnVudGltZS5HZXRJUnVudGltZSgpOwogICAgICAgICAgICAgICAgdCAmJiAodC5HYW1lU2NvcmUgPSB0aGlzLmdwLCB0LkdhbWVQdXNoID0gdGhpcy5ncCksIHRoaXMuZ3AucGxheWVyLm9uKCJyZWFkeSIsICgpID0+IHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmlzUGxheWVyUmVhZHkgPSAhMCwgdGhpcy5hd2FpdGVycy5wbGF5ZXIuZG9uZSgpLCB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uUGxheWVyUmVhZHkpCiAgICAgICAgICAgICAgICB9KSwgdGhpcy5ncC5wbGF5ZXIub24oImNoYW5nZSIsICgpID0+IHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25QbGF5ZXJDaGFuZ2UpKSwgdGhpcy5ncC5wbGF5ZXIub24oInN5bmMiLCBlID0+IHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZVJlc3VsdChlKSwgdGhpcy5UcmlnZ2VyKGUgPyB0aGlzLmNvbmRpdGlvbnMuT25QbGF5ZXJTeW5jQ29tcGxldGUgOiB0aGlzLmNvbmRpdGlvbnMuT25QbGF5ZXJTeW5jRXJyb3IpCiAgICAgICAgICAgICAgICB9KSwgdGhpcy5ncC5wbGF5ZXIub24oImxvYWQiLCBlID0+IHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZVJlc3VsdChlKSwgdGhpcy5UcmlnZ2VyKGUgPyB0aGlzLmNvbmRpdGlvbnMuT25QbGF5ZXJMb2FkQ29tcGxldGUgOiB0aGlzLmNvbmRpdGlvbnMuT25QbGF5ZXJMb2FkRXJyb3IpCiAgICAgICAgICAgICAgICB9KSwgdGhpcy5ncC5wbGF5ZXIub24oImxvZ2luIiwgZSA9PiB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVSZXN1bHQoZSksIHRoaXMuVHJpZ2dlcihlID8gdGhpcy5jb25kaXRpb25zLk9uUGxheWVyTG9naW5Db21wbGV0ZSA6IHRoaXMuY29uZGl0aW9ucy5PblBsYXllckxvZ2luRXJyb3IpCiAgICAgICAgICAgICAgICB9KSwgdGhpcy5ncC5wbGF5ZXIub24oImZldGNoRmllbGRzIiwgZSA9PiB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVSZXN1bHQoZSksIHRoaXMuVHJpZ2dlcihlID8gdGhpcy5jb25kaXRpb25zLk9uUGxheWVyRmV0Y2hGaWVsZHNDb21wbGV0ZSA6IHRoaXMuY29uZGl0aW9ucy5PblBsYXllckZldGNoRmllbGRzRXJyb3IpCiAgICAgICAgICAgICAgICB9KSwgdGhpcy5ncC5zb2NpYWxzLm1ha2VTaGFyZVVybCAmJiAodGhpcy5zaGFyZUxpbmsgPSB0aGlzLmdwLnNvY2lhbHMubWFrZVNoYXJlVXJsKHt9KSksIHRoaXMuZ3AubGVhZGVyYm9hcmQub24oIm9wZW4iLCAoKSA9PiB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uTGVhZGVyYm9hcmRPcGVuKSksIHRoaXMuZ3AuYWNoaWV2ZW1lbnRzLm9uKCJvcGVuIiwgKCkgPT4gdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkFjaGlldmVtZW50c09wZW4pKSwgdGhpcy5ncC5hY2hpZXZlbWVudHMub24oImNsb3NlIiwgKCkgPT4gdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkFjaGlldmVtZW50c0Nsb3NlKSksIHRoaXMuZ3AuZ2FtZXNDb2xsZWN0aW9ucy5vbigib3BlbiIsICgpID0+IHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25HYW1lc0NvbGxlY3Rpb25zT3BlbikpLCB0aGlzLmdwLmdhbWVzQ29sbGVjdGlvbnMub24oImNsb3NlIiwgKCkgPT4gdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkdhbWVzQ29sbGVjdGlvbnNDbG9zZSkpLCB0aGlzLmdwLmRvY3VtZW50cy5vbigib3BlbiIsICgpID0+IHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25Eb2N1bWVudHNPcGVuKSksIHRoaXMuZ3AuZG9jdW1lbnRzLm9uKCJjbG9zZSIsICgpID0+IHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25Eb2N1bWVudHNDbG9zZSkpLCB0aGlzLmdwLmZ1bGxzY3JlZW4ub24oIm9wZW4iLCAoKSA9PiB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uRnVsbHNjcmVlbk9wZW4pKSwgdGhpcy5ncC5mdWxsc2NyZWVuLm9uKCJjbG9zZSIsICgpID0+IHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25GdWxsc2NyZWVuQ2xvc2UpKSwgdGhpcy5ncC5mdWxsc2NyZWVuLm9uKCJjaGFuZ2UiLCAoKSA9PiB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uRnVsbHNjcmVlbkNoYW5nZSkpLCB0aGlzLmdwLmFkcy5vbigic3RhcnQiLCAoKSA9PiB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uQWRzU3RhcnQpKSwgdGhpcy5ncC5hZHMub24oImNsb3NlIiwgZSA9PiB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVSZXN1bHQoZSksIHRoaXMuaXNMYXN0QWRTdWNjZXNzID0gZSwgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkFkc0Nsb3NlKQogICAgICAgICAgICAgICAgfSksIHRoaXMuZ3AuYWRzLm9uKCJmdWxsc2NyZWVuOnN0YXJ0IiwgKCkgPT4gdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkFkc0Z1bGxzY3JlZW5TdGFydCkpLCB0aGlzLmdwLmFkcy5vbigiZnVsbHNjcmVlbjpjbG9zZSIsICgpID0+IHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25BZHNGdWxsc2NyZWVuQ2xvc2UpKSwgdGhpcy5ncC5hZHMub24oInByZWxvYWRlcjpzdGFydCIsICgpID0+IHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25BZHNQcmVsb2FkZXJTdGFydCkpLCB0aGlzLmdwLmFkcy5vbigicHJlbG9hZGVyOmNsb3NlIiwgKCkgPT4gdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkFkc1ByZWxvYWRlckNsb3NlKSksIHRoaXMuZ3AuYWRzLm9uKCJyZXdhcmRlZDpzdGFydCIsICgpID0+IHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25BZHNSZXdhcmRlZFN0YXJ0KSksIHRoaXMuZ3AuYWRzLm9uKCJyZXdhcmRlZDpjbG9zZSIsICgpID0+IHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25BZHNSZXdhcmRlZENsb3NlKSksIHRoaXMuZ3AuYWRzLm9uKCJyZXdhcmRlZDpyZXdhcmQiLCAoKSA9PiB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uQWRzUmV3YXJkZWRSZXdhcmQpKSwgdGhpcy5ncC5hZHMub24oInN0aWNreTpzdGFydCIsICgpID0+IHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25BZHNTdGlja3lTdGFydCkpLCB0aGlzLmdwLmFkcy5vbigic3RpY2t5OmNsb3NlIiwgKCkgPT4gdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkFkc1N0aWNreUNsb3NlKSksIHRoaXMuZ3AuYWRzLm9uKCJzdGlja3k6cmVmcmVzaCIsICgpID0+IHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25BZHNTdGlja3lSZWZyZXNoKSksIHRoaXMuZ3AuYWRzLm9uKCJzdGlja3k6cmVuZGVyIiwgKCkgPT4gdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkFkc1N0aWNreVJlbmRlcikpLCB0aGlzLmdwLnNvY2lhbHMub24oInNoYXJlIiwgZSA9PiB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVSZXN1bHQoZSksIHRoaXMuaXNMYXN0U2hhcmVTdWNjZXNzID0gZSwgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PblNvY2lhbHNTaGFyZSkKICAgICAgICAgICAgICAgIH0pLCB0aGlzLmdwLnNvY2lhbHMub24oInBvc3QiLCBlID0+IHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZVJlc3VsdChlKSwgdGhpcy5pc0xhc3RTaGFyZVN1Y2Nlc3MgPSBlLCB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uU29jaWFsc1Bvc3QpCiAgICAgICAgICAgICAgICB9KSwgdGhpcy5ncC5zb2NpYWxzLm9uKCJpbnZpdGUiLCBlID0+IHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZVJlc3VsdChlKSwgdGhpcy5pc0xhc3RTaGFyZVN1Y2Nlc3MgPSBlLCB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uU29jaWFsc0ludml0ZSkKICAgICAgICAgICAgICAgIH0pLCB0aGlzLmdwLnNvY2lhbHMub24oImpvaW5Db21tdW5pdHkiLCBlID0+IHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZVJlc3VsdChlKSwgdGhpcy5pc0xhc3RDb21tdW5pdHlKb2luU3VjY2VzcyA9IGUsIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25Tb2NpYWxzSm9pbkNvbW11bml0eSkKICAgICAgICAgICAgICAgIH0pLCB0aGlzLmdwLmFwcC5vbigiYWRkU2hvcnRjdXQiLCBlID0+IHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZVJlc3VsdChlKSwgdGhpcy5pc0xhc3RBZGRTaG9ydGN1dFN1Y2Nlc3MgPSBlLCB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uQXBwQWRkU2hvcnRjdXQpCiAgICAgICAgICAgICAgICB9KSwgdGhpcy5ncC5vbigiY2hhbmdlOmxhbmd1YWdlIiwgKCkgPT4gdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkNoYW5nZUxhbmd1YWdlKSksIHRoaXMuZ3Aub24oImNoYW5nZTphdmF0YXJHZW5lcmF0b3IiLCAoKSA9PiB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uQ2hhbmdlQXZhdGFyR2VuZXJhdG9yKSksIHRoaXMuZ3Aub24oIm92ZXJsYXk6cmVhZHkiLCAoKSA9PiB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uT3ZlcmxheVJlYWR5KSksIHRoaXMuZ3Aub24oInBhdXNlIiwgKCkgPT4gdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PblBhdXNlKSksIHRoaXMuZ3Aub24oInJlc3VtZSIsICgpID0+IHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25SZXN1bWUpKSwgdGhpcy5ncC5vbigiZ2FtZXBsYXlTdGFydCIsICgpID0+IHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25HYW1lcGxheVN0YXJ0KSksIHRoaXMuZ3Aub24oImdhbWVwbGF5U3RvcCIsICgpID0+IHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25HYW1lcGxheVN0b3ApKSwgdGhpcy5ncC5jaGFubmVscy5vbigiZXZlbnQiLCBlID0+IHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmN1ckV2ZW50ID0gZQogICAgICAgICAgICAgICAgfSksIHRoaXMuZ3AuY2hhbm5lbHMub24oImV2ZW50OmNvbm5lY3QiLCAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkV2ZW50KSwgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkV2ZW50Q29ubmVjdCkKICAgICAgICAgICAgICAgIH0pLCB0aGlzLmlzUmVhZHkgPSAhMCwgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PblJlYWR5KSwgdGhpcy5hd2FpdGVycy5ncC5kb25lKCksIHRoaXMuc2hvd1ByZWxvYWRlck9uU3RhcnQgJiYgdGhpcy5ncC5hZHMuc2hvd1ByZWxvYWRlcigpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgUmVsZWFzZSgpIHsKICAgICAgICAgICAgICAgIHN1cGVyLlJlbGVhc2UoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIFNhdmVUb0pzb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgIGxlYWRlcmJvYXJkOiB0aGlzLmxlYWRlcmJvYXJkLAogICAgICAgICAgICAgICAgICAgIGxlYWRlcmJvYXJkSW5mbzogdGhpcy5sZWFkZXJib2FyZEluZm8sCiAgICAgICAgICAgICAgICAgICAgbGVhZGVyYm9hcmRSZWNvcmRzOiB0aGlzLmxlYWRlcmJvYXJkUmVjb3JkcywKICAgICAgICAgICAgICAgICAgICBjdXJyZW50TGVhZGVyYm9hcmRJbmRleDogdGhpcy5jdXJyZW50TGVhZGVyYm9hcmRJbmRleCwKICAgICAgICAgICAgICAgICAgICBjdXJyZW50TGVhZGVyYm9hcmRQbGF5ZXI6IHRoaXMuY3VycmVudExlYWRlcmJvYXJkUGxheWVyLAogICAgICAgICAgICAgICAgICAgIGxhc3RMZWFkZXJib2FyZFRhZzogdGhpcy5sYXN0TGVhZGVyYm9hcmRUYWcsCiAgICAgICAgICAgICAgICAgICAgbGFzdExlYWRlcmJvYXJkVmFyaWFudDogdGhpcy5sYXN0TGVhZGVyYm9hcmRWYXJpYW50LAogICAgICAgICAgICAgICAgICAgIGxhc3RMZWFkZXJib2FyZFBsYXllclJhdGluZ1RhZzogdGhpcy5sYXN0TGVhZGVyYm9hcmRQbGF5ZXJSYXRpbmdUYWcsCiAgICAgICAgICAgICAgICAgICAgbGVhZGVyYm9hcmRQbGF5ZXJQb3NpdGlvbjogdGhpcy5sZWFkZXJib2FyZFBsYXllclBvc2l0aW9uLAogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRQbGF5ZXJGaWVsZEtleTogdGhpcy5jdXJyZW50UGxheWVyRmllbGRLZXksCiAgICAgICAgICAgICAgICAgICAgY3VycmVudFBsYXllckZpZWxkVHlwZTogdGhpcy5jdXJyZW50UGxheWVyRmllbGRUeXBlLAogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRQbGF5ZXJGaWVsZE5hbWU6IHRoaXMuY3VycmVudFBsYXllckZpZWxkTmFtZSwKICAgICAgICAgICAgICAgICAgICBjdXJyZW50UGxheWVyRmllbGRWYWx1ZTogdGhpcy5jdXJyZW50UGxheWVyRmllbGRWYWx1ZSwKICAgICAgICAgICAgICAgICAgICBjdXJyZW50UGxheWVyRmllbGRWYXJpYW50VmFsdWU6IHRoaXMuY3VycmVudFBsYXllckZpZWxkVmFyaWFudFZhbHVlLAogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRQbGF5ZXJGaWVsZFZhcmlhbnROYW1lOiB0aGlzLmN1cnJlbnRQbGF5ZXJGaWVsZFZhcmlhbnROYW1lLAogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRQbGF5ZXJGaWVsZFZhcmlhbnRJbmRleDogdGhpcy5jdXJyZW50UGxheWVyRmllbGRWYXJpYW50SW5kZXgsCiAgICAgICAgICAgICAgICAgICAgaXNMYXN0QWRTdWNjZXNzOiB0aGlzLmlzTGFzdEFkU3VjY2VzcywKICAgICAgICAgICAgICAgICAgICBpc0xhc3RTaGFyZVN1Y2Nlc3M6IHRoaXMuaXNMYXN0U2hhcmVTdWNjZXNzLAogICAgICAgICAgICAgICAgICAgIGlzTGFzdENvbW11bml0eUpvaW5TdWNjZXNzOiB0aGlzLmlzTGFzdENvbW11bml0eUpvaW5TdWNjZXNzLAogICAgICAgICAgICAgICAgICAgIGlzTGFzdEFkZFNob3J0Y3V0U3VjY2VzczogdGhpcy5pc0xhc3RBZGRTaG9ydGN1dFN1Y2Nlc3MsCiAgICAgICAgICAgICAgICAgICAgaXNSZWFkeTogdGhpcy5pc1JlYWR5LAogICAgICAgICAgICAgICAgICAgIGlzUGxheWVyUmVhZHk6IHRoaXMuaXNQbGF5ZXJSZWFkeSwKICAgICAgICAgICAgICAgICAgICBhY2hpZXZlbWVudHM6IHRoaXMuYWNoaWV2ZW1lbnRzLAogICAgICAgICAgICAgICAgICAgIGFjaGlldmVtZW50c0dyb3VwczogdGhpcy5hY2hpZXZlbWVudHNHcm91cHMsCiAgICAgICAgICAgICAgICAgICAgcGxheWVyQWNoaWV2ZW1lbnRzOiB0aGlzLnBsYXllckFjaGlldmVtZW50cywKICAgICAgICAgICAgICAgICAgICBjdXJyZW50QWNoaWV2ZW1lbnRJbmRleDogdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnRJbmRleCwKICAgICAgICAgICAgICAgICAgICBjdXJyZW50QWNoaWV2ZW1lbnQ6IHRoaXMuY3VycmVudEFjaGlldmVtZW50LAogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRBY2hpZXZlbWVudHNHcm91cEluZGV4OiB0aGlzLmN1cnJlbnRBY2hpZXZlbWVudHNHcm91cEluZGV4LAogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRBY2hpZXZlbWVudHNHcm91cElkOiB0aGlzLmN1cnJlbnRBY2hpZXZlbWVudHNHcm91cElkLAogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRBY2hpZXZlbWVudHNHcm91cFRhZzogdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnRzR3JvdXBUYWcsCiAgICAgICAgICAgICAgICAgICAgY3VycmVudEFjaGlldmVtZW50c0dyb3VwTmFtZTogdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnRzR3JvdXBOYW1lLAogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRBY2hpZXZlbWVudHNHcm91cERlc2NyaXB0aW9uOiB0aGlzLmN1cnJlbnRBY2hpZXZlbWVudHNHcm91cERlc2NyaXB0aW9uLAogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRQbGF5ZXJBY2hpZXZlbWVudEluZGV4OiB0aGlzLmN1cnJlbnRQbGF5ZXJBY2hpZXZlbWVudEluZGV4LAogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRQbGF5ZXJBY2hpZXZlbWVudElkOiB0aGlzLmN1cnJlbnRQbGF5ZXJBY2hpZXZlbWVudElkLAogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRQbGF5ZXJBY2hpZXZlbWVudFVubG9ja0RhdGU6IHRoaXMuY3VycmVudFBsYXllckFjaGlldmVtZW50VW5sb2NrRGF0ZSwKICAgICAgICAgICAgICAgICAgICBpc1VubG9ja0FjaGlldmVtZW50U3VjY2VzczogdGhpcy5pc1VubG9ja0FjaGlldmVtZW50U3VjY2VzcywKICAgICAgICAgICAgICAgICAgICB1bmxvY2tBY2hpZXZlbWVudEVycm9yOiB0aGlzLnVubG9ja0FjaGlldmVtZW50RXJyb3IsCiAgICAgICAgICAgICAgICAgICAgcHJvZHVjdHM6IHRoaXMucHJvZHVjdHMsCiAgICAgICAgICAgICAgICAgICAgcGxheWVyUHVyY2hhc2VzOiB0aGlzLnBsYXllclB1cmNoYXNlcywKICAgICAgICAgICAgICAgICAgICBjdXJyZW50UHJvZHVjdEluZGV4OiB0aGlzLmN1cnJlbnRQcm9kdWN0SW5kZXgsCiAgICAgICAgICAgICAgICAgICAgY3VycmVudFByb2R1Y3Q6IHRoaXMuY3VycmVudFByb2R1Y3QsCiAgICAgICAgICAgICAgICAgICAgY3VycmVudFByb2R1Y3RQdXJjaGFzZXM6IHRoaXMuY3VycmVudFByb2R1Y3RQdXJjaGFzZXMsCiAgICAgICAgICAgICAgICAgICAgY3VycmVudFB1cmNoYXNlSW5kZXg6IHRoaXMuY3VycmVudFB1cmNoYXNlSW5kZXgsCiAgICAgICAgICAgICAgICAgICAgY3VycmVudFB1cmNoYXNlOiB0aGlzLmN1cnJlbnRQdXJjaGFzZSwKICAgICAgICAgICAgICAgICAgICBsYXN0UGxheWVyc1RhZzogdGhpcy5sYXN0UGxheWVyc1RhZywKICAgICAgICAgICAgICAgICAgICBjdXJyZW50UGxheWVyc0luZGV4OiB0aGlzLmN1cnJlbnRQbGF5ZXJzSW5kZXgsCiAgICAgICAgICAgICAgICAgICAgY3VycmVudFBsYXllcnNQbGF5ZXI6IHRoaXMuY3VycmVudFBsYXllcnNQbGF5ZXIsCiAgICAgICAgICAgICAgICAgICAgaXNTdWJzY3JpYmVQcm9kdWN0U3VjY2VzczogdGhpcy5pc1N1YnNjcmliZVByb2R1Y3RTdWNjZXNzLAogICAgICAgICAgICAgICAgICAgIGlzVW5zdWJzY3JpYmVQcm9kdWN0U3VjY2VzczogdGhpcy5pc1Vuc3Vic2NyaWJlUHJvZHVjdFN1Y2Nlc3MsCiAgICAgICAgICAgICAgICAgICAgaXNQdXJjaGFzZVByb2R1Y3RTdWNjZXNzOiB0aGlzLmlzUHVyY2hhc2VQcm9kdWN0U3VjY2VzcywKICAgICAgICAgICAgICAgICAgICBwdXJjaGFzZVByb2R1Y3RFcnJvcjogdGhpcy5wdXJjaGFzZVByb2R1Y3RFcnJvciwKICAgICAgICAgICAgICAgICAgICBwdXJjaGFzZWRQcm9kdWN0SWQ6IHRoaXMucHVyY2hhc2VkUHJvZHVjdElkLAogICAgICAgICAgICAgICAgICAgIHB1cmNoYXNlZFByb2R1Y3RUYWc6IHRoaXMucHVyY2hhc2VkUHJvZHVjdFRhZywKICAgICAgICAgICAgICAgICAgICBpc0NvbnN1bWVQcm9kdWN0U3VjY2VzczogdGhpcy5pc0NvbnN1bWVQcm9kdWN0U3VjY2VzcywKICAgICAgICAgICAgICAgICAgICBjb25zdW1lUHJvZHVjdEVycm9yOiB0aGlzLmNvbnN1bWVQcm9kdWN0RXJyb3IsCiAgICAgICAgICAgICAgICAgICAgY29uc3VtZWRQcm9kdWN0SWQ6IHRoaXMuY29uc3VtZWRQcm9kdWN0SWQsCiAgICAgICAgICAgICAgICAgICAgY29uc3VtZWRQcm9kdWN0VGFnOiB0aGlzLmNvbnN1bWVkUHJvZHVjdFRhZywKICAgICAgICAgICAgICAgICAgICBnYW1lc0NvbGxlY3Rpb246IHRoaXMuZ2FtZXNDb2xsZWN0aW9uLAogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRHYW1lSW5kZXg6IHRoaXMuY3VycmVudEdhbWVJbmRleCwKICAgICAgICAgICAgICAgICAgICBjdXJyZW50R2FtZUlkOiB0aGlzLmN1cnJlbnRHYW1lSWQsCiAgICAgICAgICAgICAgICAgICAgY3VycmVudEdhbWVOYW1lOiB0aGlzLmN1cnJlbnRHYW1lTmFtZSwKICAgICAgICAgICAgICAgICAgICBjdXJyZW50R2FtZURlc2NyaXB0aW9uOiB0aGlzLmN1cnJlbnRHYW1lRGVzY3JpcHRpb24sCiAgICAgICAgICAgICAgICAgICAgY3VycmVudEdhbWVJY29uOiB0aGlzLmN1cnJlbnRHYW1lSWNvbiwKICAgICAgICAgICAgICAgICAgICBjdXJyZW50R2FtZVVybDogdGhpcy5jdXJyZW50R2FtZVVybCwKICAgICAgICAgICAgICAgICAgICBnYW1lc0NvbGxlY3Rpb25GZXRjaEVycm9yOiB0aGlzLmdhbWVzQ29sbGVjdGlvbkZldGNoRXJyb3IsCiAgICAgICAgICAgICAgICAgICAgbGFzdEdhbWVzQ29sbGVjdGlvbklkT3JUYWc6IHRoaXMubGFzdEdhbWVzQ29sbGVjdGlvbklkT3JUYWcsCiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQ6IHRoaXMuZG9jdW1lbnQsCiAgICAgICAgICAgICAgICAgICAgbGFzdERvY3VtZW50VHlwZTogdGhpcy5sYXN0RG9jdW1lbnRUeXBlLAogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50RmV0Y2hFcnJvcjogdGhpcy5kb2N1bWVudEZldGNoRXJyb3IsCiAgICAgICAgICAgICAgICAgICAgbGFzdEVycm9yOiB0aGlzLmxhc3RFcnJvciwKICAgICAgICAgICAgICAgICAgICBpc0xhc3RBY3Rpb25TdWNjZXNzOiB0aGlzLmlzTGFzdEFjdGlvblN1Y2Nlc3MsCiAgICAgICAgICAgICAgICAgICAgaW1hZ2VzOiB0aGlzLmltYWdlcywKICAgICAgICAgICAgICAgICAgICBjYW5Mb2FkTW9yZUltYWdlczogdGhpcy5jYW5Mb2FkTW9yZUltYWdlcywKICAgICAgICAgICAgICAgICAgICBjdXJyZW50SW1hZ2U6IHRoaXMuY3VycmVudEltYWdlLAogICAgICAgICAgICAgICAgICAgIGxhc3RJbWFnZVRlbXBVcmw6IHRoaXMubGFzdEltYWdlVGVtcFVybCwKICAgICAgICAgICAgICAgICAgICBjdXJyZW50SW1hZ2VJbmRleDogdGhpcy5jdXJyZW50SW1hZ2VJbmRleCwKICAgICAgICAgICAgICAgICAgICBjdXJyZW50SW1hZ2VUYWdJbmRleDogdGhpcy5jdXJyZW50SW1hZ2VUYWdJbmRleCwKICAgICAgICAgICAgICAgICAgICBjdXJyZW50SW1hZ2VUYWc6IHRoaXMuY3VycmVudEltYWdlVGFnLAogICAgICAgICAgICAgICAgICAgIGZpbGVzOiB0aGlzLmZpbGVzLAogICAgICAgICAgICAgICAgICAgIGxhc3RGaWxlQ29udGVudDogdGhpcy5sYXN0RmlsZUNvbnRlbnQsCiAgICAgICAgICAgICAgICAgICAgY2FuTG9hZE1vcmVGaWxlczogdGhpcy5jYW5Mb2FkTW9yZUZpbGVzLAogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRGaWxlOiB0aGlzLmN1cnJlbnRGaWxlLAogICAgICAgICAgICAgICAgICAgIGxhc3RGaWxlVGVtcFVybDogdGhpcy5sYXN0RmlsZVRlbXBVcmwsCiAgICAgICAgICAgICAgICAgICAgY3VycmVudEZpbGVJbmRleDogdGhpcy5jdXJyZW50RmlsZUluZGV4LAogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRGaWxlVGFnSW5kZXg6IHRoaXMuY3VycmVudEZpbGVUYWdJbmRleCwKICAgICAgICAgICAgICAgICAgICBjdXJyZW50RmlsZVRhZzogdGhpcy5jdXJyZW50RmlsZVRhZywKICAgICAgICAgICAgICAgICAgICBjdXJyZW50VmFyaWFibGVJbmRleDogdGhpcy5jdXJyZW50VmFyaWFibGVJbmRleCwKICAgICAgICAgICAgICAgICAgICBjdXJyZW50VmFyaWFibGU6IHRoaXMuY3VycmVudFZhcmlhYmxlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgTG9hZEZyb21Kc29uKGUpIHsKICAgICAgICAgICAgICAgIHRoaXMubGVhZGVyYm9hcmQgPSBlLmxlYWRlcmJvYXJkLCB0aGlzLmxlYWRlcmJvYXJkSW5mbyA9IGUubGVhZGVyYm9hcmRJbmZvIHx8IHt9LCB0aGlzLmxlYWRlcmJvYXJkUmVjb3JkcyA9IGUubGVhZGVyYm9hcmRSZWNvcmRzIHx8IHt9LCB0aGlzLmN1cnJlbnRMZWFkZXJib2FyZEluZGV4ID0gZS5jdXJyZW50TGVhZGVyYm9hcmRJbmRleCwgdGhpcy5jdXJyZW50TGVhZGVyYm9hcmRQbGF5ZXIgPSBlLmN1cnJlbnRMZWFkZXJib2FyZFBsYXllciB8fCB7fSwgdGhpcy5sYXN0TGVhZGVyYm9hcmRUYWcgPSBlLmxhc3RMZWFkZXJib2FyZFRhZywgdGhpcy5sYXN0TGVhZGVyYm9hcmRWYXJpYW50ID0gZS5sYXN0TGVhZGVyYm9hcmRWYXJpYW50LCB0aGlzLmxhc3RMZWFkZXJib2FyZFBsYXllclJhdGluZ1RhZyA9IGUubGFzdExlYWRlcmJvYXJkUGxheWVyUmF0aW5nVGFnLCB0aGlzLmxlYWRlcmJvYXJkUGxheWVyUG9zaXRpb24gPSBlLmxlYWRlcmJvYXJkUGxheWVyUG9zaXRpb24gfHwgMCwgdGhpcy5jdXJyZW50UGxheWVyRmllbGRLZXkgPSBlLmN1cnJlbnRQbGF5ZXJGaWVsZEtleSwgdGhpcy5jdXJyZW50UGxheWVyRmllbGRUeXBlID0gZS5jdXJyZW50UGxheWVyRmllbGRUeXBlLCB0aGlzLmN1cnJlbnRQbGF5ZXJGaWVsZE5hbWUgPSBlLmN1cnJlbnRQbGF5ZXJGaWVsZE5hbWUsIHRoaXMuY3VycmVudFBsYXllckZpZWxkVmFsdWUgPSBlLmN1cnJlbnRQbGF5ZXJGaWVsZFZhbHVlLCB0aGlzLmN1cnJlbnRQbGF5ZXJGaWVsZFZhcmlhbnRWYWx1ZSA9IGUuY3VycmVudFBsYXllckZpZWxkVmFyaWFudFZhbHVlLCB0aGlzLmN1cnJlbnRQbGF5ZXJGaWVsZFZhcmlhbnROYW1lID0gZS5jdXJyZW50UGxheWVyRmllbGRWYXJpYW50TmFtZSwgdGhpcy5jdXJyZW50UGxheWVyRmllbGRWYXJpYW50SW5kZXggPSBlLmN1cnJlbnRQbGF5ZXJGaWVsZFZhcmlhbnRJbmRleCwgdGhpcy5pc0xhc3RBZFN1Y2Nlc3MgPSBlLmlzTGFzdEFkU3VjY2VzcywgdGhpcy5pc0xhc3RTaGFyZVN1Y2Nlc3MgPSBlLmlzTGFzdFNoYXJlU3VjY2VzcywgdGhpcy5pc0xhc3RDb21tdW5pdHlKb2luU3VjY2VzcyA9IGUuaXNMYXN0Q29tbXVuaXR5Sm9pblN1Y2Nlc3MsIHRoaXMuaXNMYXN0QWRkU2hvcnRjdXRTdWNjZXNzID0gZS5pc0xhc3RBZGRTaG9ydGN1dFN1Y2Nlc3MsIHRoaXMuaXNSZWFkeSA9IGUuaXNSZWFkeSwgdGhpcy5pc1BsYXllclJlYWR5ID0gZS5pc1BsYXllclJlYWR5LCB0aGlzLmFjaGlldmVtZW50cyA9IGUuYWNoaWV2ZW1lbnRzIHx8IFtdLCB0aGlzLmFjaGlldmVtZW50c0dyb3VwcyA9IGUuYWNoaWV2ZW1lbnRzR3JvdXBzIHx8IFtdLCB0aGlzLnBsYXllckFjaGlldmVtZW50cyA9IGUucGxheWVyQWNoaWV2ZW1lbnRzIHx8IFtdLCB0aGlzLmN1cnJlbnRBY2hpZXZlbWVudEluZGV4ID0gZS5jdXJyZW50QWNoaWV2ZW1lbnRJbmRleCB8fCAwLCB0aGlzLmN1cnJlbnRBY2hpZXZlbWVudCA9IGUuY3VycmVudEFjaGlldmVtZW50IHx8IHt9LCB0aGlzLmN1cnJlbnRBY2hpZXZlbWVudHNHcm91cEluZGV4ID0gZS5jdXJyZW50QWNoaWV2ZW1lbnRzR3JvdXBJbmRleCB8fCAwLCB0aGlzLmN1cnJlbnRBY2hpZXZlbWVudHNHcm91cElkID0gZS5jdXJyZW50QWNoaWV2ZW1lbnRzR3JvdXBJZCB8fCAwLCB0aGlzLmN1cnJlbnRBY2hpZXZlbWVudHNHcm91cFRhZyA9IGUuY3VycmVudEFjaGlldmVtZW50c0dyb3VwVGFnIHx8ICIiLCB0aGlzLmN1cnJlbnRBY2hpZXZlbWVudHNHcm91cE5hbWUgPSBlLmN1cnJlbnRBY2hpZXZlbWVudHNHcm91cE5hbWUgfHwgIiIsIHRoaXMuY3VycmVudEFjaGlldmVtZW50c0dyb3VwRGVzY3JpcHRpb24gPSBlLmN1cnJlbnRBY2hpZXZlbWVudHNHcm91cERlc2NyaXB0aW9uIHx8ICIiLCB0aGlzLmN1cnJlbnRQbGF5ZXJBY2hpZXZlbWVudEluZGV4ID0gZS5jdXJyZW50UGxheWVyQWNoaWV2ZW1lbnRJbmRleCB8fCAwLCB0aGlzLmN1cnJlbnRQbGF5ZXJBY2hpZXZlbWVudElkID0gZS5jdXJyZW50UGxheWVyQWNoaWV2ZW1lbnRJZCB8fCAwLCB0aGlzLmN1cnJlbnRQbGF5ZXJBY2hpZXZlbWVudFVubG9ja0RhdGUgPSBlLmN1cnJlbnRQbGF5ZXJBY2hpZXZlbWVudFVubG9ja0RhdGUgfHwgIiIsIHRoaXMuaXNVbmxvY2tBY2hpZXZlbWVudFN1Y2Nlc3MgPSBlLmlzVW5sb2NrQWNoaWV2ZW1lbnRTdWNjZXNzIHx8ICExLCB0aGlzLnVubG9ja0FjaGlldmVtZW50RXJyb3IgPSBlLnVubG9ja0FjaGlldmVtZW50RXJyb3IgfHwgIiIsIHRoaXMucHJvZHVjdHMgPSBlLnByb2R1Y3RzIHx8IFtdLCB0aGlzLnBsYXllclB1cmNoYXNlcyA9IGUucGxheWVyUHVyY2hhc2VzIHx8IFtdLCB0aGlzLmN1cnJlbnRQcm9kdWN0SW5kZXggPSBlLmN1cnJlbnRQcm9kdWN0SW5kZXggfHwgMCwgdGhpcy5jdXJyZW50UHJvZHVjdCA9IGUuY3VycmVudFByb2R1Y3QgfHwgewogICAgICAgICAgICAgICAgICAgIGlkOiBlLmN1cnJlbnRQcm9kdWN0LmlkIHx8IDAsCiAgICAgICAgICAgICAgICAgICAgdGFnOiBlLmN1cnJlbnRQcm9kdWN0LnRhZyB8fCAiIiwKICAgICAgICAgICAgICAgICAgICBuYW1lOiBlLmN1cnJlbnRQcm9kdWN0Lm5hbWUgfHwgIiIsCiAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IGUuY3VycmVudFByb2R1Y3QuZGVzY3JpcHRpb24gfHwgIiIsCiAgICAgICAgICAgICAgICAgICAgaWNvbjogZS5jdXJyZW50UHJvZHVjdC5pY29uIHx8ICIiLAogICAgICAgICAgICAgICAgICAgIGljb25TbWFsbDogZS5jdXJyZW50UHJvZHVjdC5pY29uU21hbGwgfHwgIiIsCiAgICAgICAgICAgICAgICAgICAgcHJpY2U6IGUuY3VycmVudFByb2R1Y3QucHJpY2UgfHwgMCwKICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeTogZS5jdXJyZW50UHJvZHVjdC5jdXJyZW5jeSB8fCAiIiwKICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeVN5bWJvbDogZS5jdXJyZW50UHJvZHVjdC5jdXJyZW5jeVN5bWJvbCB8fCAiIgogICAgICAgICAgICAgICAgfSwgdGhpcy5jdXJyZW50UHJvZHVjdFB1cmNoYXNlcyA9IGUuY3VycmVudFByb2R1Y3RQdXJjaGFzZXMgfHwgMCwgdGhpcy5jdXJyZW50UHVyY2hhc2VJbmRleCA9IGUuY3VycmVudFB1cmNoYXNlSW5kZXggfHwgMCwgdGhpcy5jdXJyZW50UHVyY2hhc2UgPSBlLmN1cnJlbnRQdXJjaGFzZSB8fCB7CiAgICAgICAgICAgICAgICAgICAgaWQ6IDAsCiAgICAgICAgICAgICAgICAgICAgdGFnOiAiIiwKICAgICAgICAgICAgICAgICAgICBjcmVhdGVkQXQ6ICIiCiAgICAgICAgICAgICAgICB9LCB0aGlzLmxhc3RQbGF5ZXJzVGFnID0gZS5sYXN0UGxheWVyc1RhZywgdGhpcy5jdXJyZW50UGxheWVyc0luZGV4ID0gZS5jdXJyZW5QbGF5ZXJzSW5kZXggfHwgMCwgdGhpcy5jdXJyZW50UGxheWVyc1BsYXllciA9IGUuY3VycmVudFBsYXllcnNQbGF5ZXIgfHwgewogICAgICAgICAgICAgICAgICAgIHN0YXRlOiB7fSwKICAgICAgICAgICAgICAgICAgICBhY2hpZXZlbWVudHM6IFtdLAogICAgICAgICAgICAgICAgICAgIHB1cmNoYXNlczogW10KICAgICAgICAgICAgICAgIH0sIHRoaXMuaXNTdWJzY3JpYmVQcm9kdWN0U3VjY2VzcyA9IGUuaXNTdWJzY3JpYmVQcm9kdWN0U3VjY2VzcyB8fCAhMSwgdGhpcy5pc1Vuc3Vic2NyaWJlUHJvZHVjdFN1Y2Nlc3MgPSBlLmlzVW5zdWJzY3JpYmVQcm9kdWN0U3VjY2VzcyB8fCAhMSwgdGhpcy5pc1B1cmNoYXNlUHJvZHVjdFN1Y2Nlc3MgPSBlLmlzUHVyY2hhc2VQcm9kdWN0U3VjY2VzcyB8fCAhMSwgdGhpcy5wdXJjaGFzZVByb2R1Y3RFcnJvciA9IGUucHVyY2hhc2VQcm9kdWN0RXJyb3IgfHwgIiIsIHRoaXMucHVyY2hhc2VkUHJvZHVjdElkID0gZS5wdXJjaGFzZWRQcm9kdWN0SWQgfHwgMCwgdGhpcy5wdXJjaGFzZWRQcm9kdWN0VGFnID0gZS5wdXJjaGFzZWRQcm9kdWN0VGFnIHx8ICIiLCB0aGlzLmlzQ29uc3VtZVByb2R1Y3RTdWNjZXNzID0gZS5pc0NvbnN1bWVQcm9kdWN0U3VjY2VzcyB8fCAhMSwgdGhpcy5jb25zdW1lUHJvZHVjdEVycm9yID0gZS5jb25zdW1lUHJvZHVjdEVycm9yIHx8ICIiLCB0aGlzLmNvbnN1bWVkUHJvZHVjdElkID0gZS5jb25zdW1lZFByb2R1Y3RJZCB8fCAwLCB0aGlzLmNvbnN1bWVkUHJvZHVjdFRhZyA9IGUuY29uc3VtZWRQcm9kdWN0VGFnIHx8ICIiLCB0aGlzLmdhbWVzQ29sbGVjdGlvbiA9IGUuZ2FtZXNDb2xsZWN0aW9uIHx8IHsKICAgICAgICAgICAgICAgICAgICBpZDogMCwKICAgICAgICAgICAgICAgICAgICB0YWc6ICIiLAogICAgICAgICAgICAgICAgICAgIG5hbWU6ICIiLAogICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAiIiwKICAgICAgICAgICAgICAgICAgICBnYW1lczogW10KICAgICAgICAgICAgICAgIH0sIHRoaXMuY3VycmVudEdhbWVJbmRleCA9IGUuY3VycmVudEdhbWVJbmRleCB8fCAwLCB0aGlzLmN1cnJlbnRHYW1lSWQgPSBlLmN1cnJlbnRHYW1lSWQgfHwgMCwgdGhpcy5jdXJyZW50R2FtZU5hbWUgPSBlLmN1cnJlbnRHYW1lTmFtZSB8fCAiIiwgdGhpcy5jdXJyZW50R2FtZURlc2NyaXB0aW9uID0gZS5jdXJyZW50R2FtZURlc2NyaXB0aW9uIHx8ICIiLCB0aGlzLmN1cnJlbnRHYW1lSWNvbiA9IGUuY3VycmVudEdhbWVJY29uIHx8ICIiLCB0aGlzLmN1cnJlbnRHYW1lVXJsID0gZS5jdXJyZW50R2FtZVVybCB8fCAiIiwgdGhpcy5nYW1lc0NvbGxlY3Rpb25GZXRjaEVycm9yID0gZS5nYW1lc0NvbGxlY3Rpb25GZXRjaEVycm9yIHx8ICIiLCB0aGlzLmxhc3RHYW1lc0NvbGxlY3Rpb25JZE9yVGFnID0gZS5sYXN0R2FtZXNDb2xsZWN0aW9uSWRPclRhZyB8fCAiIiwgdGhpcy5kb2N1bWVudCA9IGUuZG9jdW1lbnQgfHwgewogICAgICAgICAgICAgICAgICAgIHR5cGU6ICIiLAogICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6ICIiCiAgICAgICAgICAgICAgICB9LCB0aGlzLmxhc3REb2N1bWVudFR5cGUgPSBlLmxhc3REb2N1bWVudFR5cGUgfHwgIiIsIHRoaXMuZG9jdW1lbnRGZXRjaEVycm9yID0gZS5kb2N1bWVudEZldGNoRXJyb3IgfHwgIiIsIHRoaXMubGFzdEVycm9yID0gZS5sYXN0RXJyb3IgfHwgIiIsIHRoaXMuaXNMYXN0QWN0aW9uU3VjY2VzcyA9IGUuaXNMYXN0QWN0aW9uU3VjY2VzcyB8fCAhMSwgdGhpcy5pbWFnZXMgPSBlLmltYWdlcyB8fCBbXSwgdGhpcy5jYW5Mb2FkTW9yZUltYWdlcyA9IGUuY2FuTG9hZE1vcmVJbWFnZXMgfHwgITEsIHRoaXMuY3VycmVudEltYWdlSW5kZXggPSBlLmN1cnJlbnRJbWFnZUluZGV4IHx8IDAsIHRoaXMuY3VycmVudEltYWdlVGFnSW5kZXggPSBlLmN1cnJlbnRJbWFnZVRhZ0luZGV4IHx8IDAsIHRoaXMuY3VycmVudEltYWdlVGFnID0gZS5jdXJyZW50SW1hZ2VUYWcgfHwgIiIsIHRoaXMuY3VycmVudEltYWdlID0gZS5jdXJyZW50SW1hZ2UgfHwgewogICAgICAgICAgICAgICAgICAgIGlkOiAiIiwKICAgICAgICAgICAgICAgICAgICBwbGF5ZXJJZDogMCwKICAgICAgICAgICAgICAgICAgICB3aWR0aDogMCwKICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDAsCiAgICAgICAgICAgICAgICAgICAgc3JjOiAiIiwKICAgICAgICAgICAgICAgICAgICB0YWdzOiBbXQogICAgICAgICAgICAgICAgfSwgdGhpcy5maWxlcyA9IGUuZmlsZXMgfHwgW10sIHRoaXMubGFzdEZpbGVDb250ZW50ID0gZS5sYXN0RmlsZUNvbnRlbnQgfHwgIiIsIHRoaXMuY2FuTG9hZE1vcmVGaWxlcyA9IGUuY2FuTG9hZE1vcmVGaWxlcyB8fCAhMSwgdGhpcy5jdXJyZW50RmlsZUluZGV4ID0gZS5jdXJyZW50RmlsZUluZGV4IHx8IDAsIHRoaXMuY3VycmVudEZpbGVUYWdJbmRleCA9IGUuY3VycmVudEZpbGVUYWdJbmRleCB8fCAwLCB0aGlzLmN1cnJlbnRGaWxlVGFnID0gZS5jdXJyZW50RmlsZVRhZyB8fCAiIiwgdGhpcy5jdXJyZW50RmlsZSA9IGUuY3VycmVudEZpbGUgfHwgewogICAgICAgICAgICAgICAgICAgIGlkOiAiIiwKICAgICAgICAgICAgICAgICAgICBwbGF5ZXJJZDogMCwKICAgICAgICAgICAgICAgICAgICBuYW1lOiAiIiwKICAgICAgICAgICAgICAgICAgICBzaXplOiAwLAogICAgICAgICAgICAgICAgICAgIHNyYzogIiIsCiAgICAgICAgICAgICAgICAgICAgdGFnczogW10KICAgICAgICAgICAgICAgIH0sIHRoaXMuY3VycmVudFZhcmlhYmxlSW5kZXggPSBlLmN1cnJlbnRWYXJpYWJsZUluZGV4IHx8IDAsIHRoaXMuY3VycmVudFZhcmlhYmxlID0gZS5jdXJyZW50VmFyaWFibGUgfHwgewogICAgICAgICAgICAgICAgICAgIGtleTogIiIsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogIiIsCiAgICAgICAgICAgICAgICAgICAgdmFsdWU6ICIiCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgR2V0RGVidWdnZXJQcm9wZXJ0aWVzKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaXNQbGF5ZXJSZWFkeSA/IFt7CiAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICJHUyAtIEJhc2UiLAogICAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IFt7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJMYW5ndWFnZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLmdwLmxhbmd1YWdlCiAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiQXZhdGFyIEdlbmVyYXRvciIsCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLmdwLmF2YXRhckdlbmVyYXRvcgogICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlBsYXRmb3JtIiwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuZ3AucGxhdGZvcm0udHlwZQogICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkxhc3QgRXJyb3IiLAogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5sYXN0RXJyb3IKICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJJcyBMYXN0IEFjdGlvbiBTdWNjZXNzIiwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuaXNMYXN0QWN0aW9uU3VjY2VzcwogICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIklzIE1vYmlsZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLmdwLmlzTW9iaWxlCiAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiSXMgRGV2IiwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuZ3AuaXNEZXYKICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJJcyBQYXVzZWQiLAogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5ncC5pc1BhdXNlZAogICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIklzIEdhbWVwbGF5IiwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuZ3AuaXNHYW1lcGxheQogICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIklzIEFsbG93ZWQgT3JpZ2luIiwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuZ3AuaXNBbGxvd2VkT3JpZ2luCiAgICAgICAgICAgICAgICAgICAgfV0KICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICB0aXRsZTogIkdTIC0gQWRzIiwKICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiBbewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiTGFzdCBBZCBTdWNjZXNzIiwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuaXNMYXN0QWRTdWNjZXNzCiAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiQWRibG9jayBFbmFibGVkIiwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuZ3AuYWRzLmlzQWRibG9ja0VuYWJsZWQKICAgICAgICAgICAgICAgICAgICB9XQogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgIHRpdGxlOiAiR1MgLSBMZWFkZXJib2FyZHMiLAogICAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IFt7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJQbGF5ZXIgUG9zaXRpb24iLAogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5sZWFkZXJib2FyZFBsYXllclBvc2l0aW9uCiAgICAgICAgICAgICAgICAgICAgfV0KICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICB0aXRsZTogIkdTIC0gUGxheWVyIiwKICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiBbewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiSUQiLAogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5ncC5wbGF5ZXIuaWQKICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJMb2dnZWQgSW4gQnkgUGxhdGZvcm0iLAogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5ncC5wbGF5ZXIuaXNMb2dnZWRJbkJ5UGxhdGZvcm0KICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJJcyBTdHViIiwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuZ3AucGxheWVyLmlzU3R1YgogICAgICAgICAgICAgICAgICAgIH0sIC4uLnRoaXMuZ3AucGxheWVyLmZpZWxkcy5tYXAodCA9PiAoewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiB0aGlzLmdwLnBsYXllci5nZXRGaWVsZE5hbWUodC5rZXkpLAogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5ncC5wbGF5ZXIuZ2V0KHQua2V5KSwKICAgICAgICAgICAgICAgICAgICAgICAgb25lZGl0OiBlID0+IHRoaXMuQ2FsbEFjdGlvbih0aGlzLmFjdGlvbnMuUGxheWVyU2V0LCB0LmtleSwgZSkKICAgICAgICAgICAgICAgICAgICB9KSldCiAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICJHUyAtIEFjaGlldmVtZW50cyAtIEN1cnJlbnQiLAogICAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IFt7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJJbmRleCIsCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLmN1cnJlbnRBY2hpZXZlbWVudEluZGV4CiAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiSUQiLAogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnQuaWQKICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJUYWciLAogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnQudGFnCiAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiTmFtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLmN1cnJlbnRBY2hpZXZlbWVudC5uYW1lCiAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiRGVzY3JpcHRpb24iLAogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnQuZGVzY3JpcHRpb24KICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJSYXJlIiwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuY3VycmVudEFjaGlldmVtZW50LnJhcmUKICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJVbmxvY2tlZCIsCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLmN1cnJlbnRBY2hpZXZlbWVudC51bmxvY2tlZAogICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkljb24iLAogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnQuaWNvbgogICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkljb24gU21hbGwiLAogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnQuaWNvblNtYWxsCiAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiTG9ja2VkIEljb24iLAogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnQubG9ja2VkSWNvbgogICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkxvY2tlZCBJY29uIFNtYWxsIiwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuY3VycmVudEFjaGlldmVtZW50LmxvY2tlZEljb25TbWFsbAogICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlByb2dyZXNzIiwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuY3VycmVudEFjaGlldmVtZW50LnByb2dyZXNzCiAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiTWF4IFByb2dyZXNzIiwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuY3VycmVudEFjaGlldmVtZW50Lm1heFByb2dyZXNzCiAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiUHJvZ3Jlc3MgU3RlcCIsCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLmN1cnJlbnRBY2hpZXZlbWVudC5wcm9ncmVzc1N0ZXAKICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJMb2NrZWQgVmlzaWJsZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLmN1cnJlbnRBY2hpZXZlbWVudC5sb2NrZWRWaXNpYmxlCiAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiTG9ja2VkIERlc2NyaXB0aW9uIFZpc2libGUiLAogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnQubG9ja2VkRGVzY3JpcHRpb25WaXNpYmxlCiAgICAgICAgICAgICAgICAgICAgfV0KICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICB0aXRsZTogIkdTIC0gQWNoaWV2ZW1lbnRzIEdyb3VwcyBMb29wIiwKICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiBbewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiQ3VycmVudCBBY2hpZXZlbWVudHMgR3JvdXAgSW5kZXgiLAogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnRzR3JvdXBJbmRleAogICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkN1cnJlbnQgQWNoaWV2ZW1lbnRzIEdyb3VwIElEIiwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuY3VycmVudEFjaGlldmVtZW50c0dyb3VwSWQKICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJDdXJyZW50IEFjaGlldmVtZW50cyBHcm91cCBUYWciLAogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnRzR3JvdXBUYWcKICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJDdXJyZW50IEFjaGlldmVtZW50cyBHcm91cCBOYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuY3VycmVudEFjaGlldmVtZW50c0dyb3VwTmFtZQogICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkN1cnJlbnQgQWNoaWV2ZW1lbnRzIEdyb3VwIERlc2NyaXB0aW9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuY3VycmVudEFjaGlldmVtZW50c0dyb3VwRGVzY3JpcHRpb24KICAgICAgICAgICAgICAgICAgICB9XQogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgIHRpdGxlOiAiR1MgLSBQbGF5ZXIgQWNoaWV2ZW1lbnRzIExvb3AiLAogICAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IFt7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJDdXJyZW50IFBsYXllciBBY2hpZXZlbWVudCBJbmRleCIsCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLmN1cnJlbnRQbGF5ZXJBY2hpZXZlbWVudEluZGV4CiAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiQ3VycmVudCBQbGF5ZXIgQWNoaWV2ZW1lbnQgSUQiLAogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5jdXJyZW50UGxheWVyQWNoaWV2ZW1lbnRJZAogICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkN1cnJlbnQgUGxheWVyIEFjaGlldmVtZW50IFVubG9jayBEYXRlIiwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuY3VycmVudFBsYXllckFjaGlldmVtZW50VW5sb2NrRGF0ZQogICAgICAgICAgICAgICAgICAgIH1dCiAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICJHUyAtIFByb2R1Y3RzIExvb3AiLAogICAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IFt7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJDdXJyZW50IFByb2R1Y3QgSW5kZXgiLAogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5jdXJyZW50UHJvZHVjdEluZGV4CiAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiQ3VycmVudCBQcm9kdWN0IElEIiwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuY3VycmVudFByb2R1Y3QuaWQKICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJDdXJyZW50IFByb2R1Y3QgVGFnIiwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuY3VycmVudFByb2R1Y3QudGFnCiAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiQ3VycmVudCBQcm9kdWN0IE5hbWUiLAogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5jdXJyZW50UHJvZHVjdC5uYW1lCiAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiQ3VycmVudCBQcm9kdWN0IERlc2NyaXB0aW9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuY3VycmVudFByb2R1Y3QuZGVzY3JpcHRpb24KICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJDdXJyZW50IFByb2R1Y3QgSWNvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLmN1cnJlbnRQcm9kdWN0Lmljb24KICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJDdXJyZW50IFByb2R1Y3QgSWNvbiBTbWFsbCIsCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLmN1cnJlbnRQcm9kdWN0Lmljb25TbWFsbAogICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkN1cnJlbnQgUHJvZHVjdCBJY29uIiwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuY3VycmVudFByb2R1Y3QuaWNvbgogICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkN1cnJlbnQgUHJvZHVjdCBQcmljZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLmN1cnJlbnRQcm9kdWN0LnByaWNlCiAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiQ3VycmVudCBQcm9kdWN0IEN1cnJlbmN5IiwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuY3VycmVudFByb2R1Y3QuY3VycmVuY3kKICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJDdXJyZW50IFByb2R1Y3QgQ3VycmVuY3lTeW1ib2wiLAogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5jdXJyZW50UHJvZHVjdC5jdXJyZW5jeVN5bWJvbAogICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkN1cnJlbnQgUHJvZHVjdCBQdXJjaGFzZXMiLAogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5jdXJyZW50UHJvZHVjdFB1cmNoYXNlcwogICAgICAgICAgICAgICAgICAgIH1dCiAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICJHUyAtIFB1cmNoYXNlZCBQcm9kdWN0IiwKICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiBbewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiSXMgcHVyY2hhc2Ugc3VjY2Vzc2Z1bCIsCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLmlzUHVyY2hhc2VQcm9kdWN0U3VjY2VzcwogICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlB1cmNoYXNlIGVycm9yIiwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMucHVyY2hhc2VQcm9kdWN0RXJyb3IKICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJQdXJjaGFzZWQgUHJvZHVjdCBJRCIsCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLnB1cmNoYXNlZFByb2R1Y3RJZAogICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIlB1cmNoYXNlZCBQcm9kdWN0IFRhZyIsCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLnB1cmNoYXNlZFByb2R1Y3RUYWcKICAgICAgICAgICAgICAgICAgICB9XQogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgIHRpdGxlOiAiR1MgLSBDb25zdW1lZCBQcm9kdWN0IiwKICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiBbewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiSXMgY29uc3VtZSBzdWNjZXNzZnVsIiwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuaXNDb25zdW1lUHJvZHVjdFN1Y2Nlc3MKICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJDb25zdW1lIGVycm9yIiwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuY29uc3VtZVByb2R1Y3RFcnJvcgogICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkNvbnN1bWVkIFByb2R1Y3QgSUQiLAogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5jb25zdW1lZFByb2R1Y3RJZAogICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkNvbnN1bWVkIFByb2R1Y3QgVGFnIiwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuY29uc3VtZWRQcm9kdWN0VGFnCiAgICAgICAgICAgICAgICAgICAgfV0KICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICB0aXRsZTogIkdTIC0gTGFzdCBHYW1lcyBDb2xsZWN0aW9uIiwKICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiBbewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiQ29sbGVjdGlvbiBJRCIsCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLmdhbWVzQ29sbGVjdGlvbi5pZAogICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkNvbGxlY3Rpb24gVGFnIiwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuZ2FtZXNDb2xsZWN0aW9uLnRhZwogICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkNvbGxlY3Rpb24gTmFtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLmdhbWVzQ29sbGVjdGlvbi5uYW1lCiAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiQ29sbGVjdGlvbiBEZXNjcmlwdGlvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLmdhbWVzQ29sbGVjdGlvbi5kZXNjcmlwdGlvbgogICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkZldGNoIEVycm9yIiwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuZ2FtZXNDb2xsZWN0aW9uRmV0Y2hFcnJvcgogICAgICAgICAgICAgICAgICAgIH1dCiAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICJHUyAtIEdhbWVzIGluIENvbGxlY3Rpb24iLAogICAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IFt7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJDdXJyZW50IEdhbWUgSW5kZXgiLAogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5jdXJyZW50R2FtZUluZGV4CiAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiQ3VycmVudCBHYW1lIElEIiwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuY3VycmVudEdhbWVJZAogICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkN1cnJlbnQgR2FtZSBOYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuY3VycmVudEdhbWVOYW1lCiAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiQ3VycmVudCBHYW1lIERlc2NyaXB0aW9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuY3VycmVudEdhbWVEZXNjcmlwdGlvbgogICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkN1cnJlbnQgR2FtZSBJY29uIiwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuY3VycmVudEdhbWVJY29uCiAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiQ3VycmVudCBHYW1lIFVybCIsCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLmN1cnJlbnRHYW1lVXJsCiAgICAgICAgICAgICAgICAgICAgfV0KICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICB0aXRsZTogIkdTIC0gRG9jdW1lbnRzIiwKICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiBbewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAiRG9jdW1lbnQgVHlwZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLmRvY3VtZW50LnR5cGUKICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJEb2N1bWVudCBDb250ZW50IiwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuZG9jdW1lbnQuY29udGVudAogICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIkZldGNoIEVycm9yIiwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuZG9jdW1lbnRGZXRjaEVycm9yCiAgICAgICAgICAgICAgICAgICAgfV0KICAgICAgICAgICAgICAgIH1dIDogW10KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQoKewogICAgInVzZSBzdHJpY3QiOwoKICAgIGZ1bmN0aW9uIGVhY2goZSwgciwgdCkgewogICAgICAgIGNvbnN0IHMgPSBlLkdldEV2ZW50U2hlZXRNYW5hZ2VyKCksCiAgICAgICAgICAgIG4gPSBlLkdldEN1cnJlbnRFdmVudCgpLAogICAgICAgICAgICBhID0gbi5HZXRTb2xNb2RpZmllcnMoKSwKICAgICAgICAgICAgaSA9IGUuR2V0RXZlbnRTdGFjaygpLAogICAgICAgICAgICB1ID0gaS5HZXRDdXJyZW50U3RhY2tGcmFtZSgpLAogICAgICAgICAgICBjID0gaS5QdXNoKG4pOwogICAgICAgIHIuZm9yRWFjaCgoZSwgcikgPT4gewogICAgICAgICAgICB0KGUsIHIpLCBzLlB1c2hDb3B5U29sKGEpLCBuLlJldHJpZ2dlcih1LCBjKSwgcy5Qb3BTb2woYSkKICAgICAgICB9KSwgaS5Qb3AoKQogICAgfQogICAgQzMuUGx1Z2lucy5FcG9uZXNoX0dhbWVTY29yZS5DbmRzID0gewogICAgICAgIE9uUGxheWVyQ2hhbmdlKCkgewogICAgICAgICAgICByZXR1cm4gITAKICAgICAgICB9LAogICAgICAgIE9uUGxheWVyU3luY0NvbXBsZXRlKCkgewogICAgICAgICAgICByZXR1cm4gITAKICAgICAgICB9LAogICAgICAgIE9uUGxheWVyU3luY0Vycm9yKCkgewogICAgICAgICAgICByZXR1cm4gITAKICAgICAgICB9LAogICAgICAgIE9uUGxheWVyTG9hZENvbXBsZXRlKCkgewogICAgICAgICAgICByZXR1cm4gITAKICAgICAgICB9LAogICAgICAgIE9uUGxheWVyTG9hZEVycm9yKCkgewogICAgICAgICAgICByZXR1cm4gITAKICAgICAgICB9LAogICAgICAgIE9uUGxheWVyTG9naW5Db21wbGV0ZSgpIHsKICAgICAgICAgICAgcmV0dXJuICEwCiAgICAgICAgfSwKICAgICAgICBPblBsYXllckxvZ2luRXJyb3IoKSB7CiAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgIH0sCiAgICAgICAgT25QbGF5ZXJGZXRjaEZpZWxkc0NvbXBsZXRlKCkgewogICAgICAgICAgICByZXR1cm4gITAKICAgICAgICB9LAogICAgICAgIE9uUGxheWVyRmV0Y2hGaWVsZHNFcnJvcigpIHsKICAgICAgICAgICAgcmV0dXJuICEwCiAgICAgICAgfSwKICAgICAgICBPblBsYXllclJlYWR5KCkgewogICAgICAgICAgICByZXR1cm4gITAKICAgICAgICB9LAogICAgICAgIElzUGxheWVyUmVhZHkoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmlzUGxheWVyUmVhZHkKICAgICAgICB9LAogICAgICAgIElzUGxheWVyU3R1YigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ3AucGxheWVyLmlzU3R1YgogICAgICAgIH0sCiAgICAgICAgSXNQbGF5ZXJMb2dnZWRJbigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ3AucGxheWVyLmlzTG9nZ2VkSW4KICAgICAgICB9LAogICAgICAgIFBsYXllckhhc0tleShlKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdwLnBsYXllci5oYXMoZSkKICAgICAgICB9LAogICAgICAgIFBsYXllckZpZWxkSXNFbnVtKGUpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ3AucGxheWVyLmdldEZpZWxkKGUpLnZhcmlhbnRzLmxlbmd0aAogICAgICAgIH0sCiAgICAgICAgUGxheWVyQ29tcGFyZVNjb3JlKGUsIHIpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMubWFwcGVycy5jb21wYXJlW2VdKHRoaXMuZ3AucGxheWVyLnNjb3JlLCByKQogICAgICAgIH0sCiAgICAgICAgUGxheWVyQ29tcGFyZShlLCByLCB0KSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLm1hcHBlcnMuY29tcGFyZVtyXSh0aGlzLmdwLnBsYXllci5nZXQoZSksIHQpCiAgICAgICAgfSwKICAgICAgICBQbGF5ZXJFYWNoRmllbGQoKSB7CiAgICAgICAgICAgIHJldHVybiBlYWNoKHRoaXMuX3J1bnRpbWUsIHRoaXMuZ3AucGxheWVyLmZpZWxkcywgZSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRQbGF5ZXJGaWVsZEtleSA9IGUua2V5LCB0aGlzLmN1cnJlbnRQbGF5ZXJGaWVsZFR5cGUgPSBlLnR5cGUsIHRoaXMuY3VycmVudFBsYXllckZpZWxkTmFtZSA9IGUubmFtZSwgdGhpcy5jdXJyZW50UGxheWVyRmllbGRWYWx1ZSA9IHRoaXMuZ3AucGxheWVyLmdldChlLmtleSkKICAgICAgICAgICAgfSksICExCiAgICAgICAgfSwKICAgICAgICBQbGF5ZXJFYWNoRmllbGRWYXJpYW50KGUpIHsKICAgICAgICAgICAgcmV0dXJuIGVhY2godGhpcy5fcnVudGltZSwgdGhpcy5ncC5wbGF5ZXIuZ2V0RmllbGQoZSkudmFyaWFudHMsIChlLCByKSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRQbGF5ZXJGaWVsZFZhcmlhbnRWYWx1ZSA9IGUudmFsdWUsIHRoaXMuY3VycmVudFBsYXllckZpZWxkVmFyaWFudE5hbWUgPSBlLm5hbWUsIHRoaXMuY3VycmVudFBsYXllckZpZWxkVmFyaWFudEluZGV4ID0gcgogICAgICAgICAgICB9KSwgITEKICAgICAgICB9LAogICAgICAgIE9uTGVhZGVyYm9hcmRPcGVuKCkgewogICAgICAgICAgICByZXR1cm4gITAKICAgICAgICB9LAogICAgICAgIE9uTGVhZGVyYm9hcmRGZXRjaChlKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmxhc3RMZWFkZXJib2FyZFRhZyA9PT0gZQogICAgICAgIH0sCiAgICAgICAgT25MZWFkZXJib2FyZEFueUZldGNoKCkgewogICAgICAgICAgICByZXR1cm4gITAKICAgICAgICB9LAogICAgICAgIE9uTGVhZGVyYm9hcmRGZXRjaEVycm9yKGUpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMubGFzdExlYWRlcmJvYXJkVGFnID09PSBlCiAgICAgICAgfSwKICAgICAgICBPbkxlYWRlcmJvYXJkQW55RmV0Y2hFcnJvcigpIHsKICAgICAgICAgICAgcmV0dXJuICEwCiAgICAgICAgfSwKICAgICAgICBPbkxlYWRlcmJvYXJkRmV0Y2hQbGF5ZXIoZSkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5sYXN0TGVhZGVyYm9hcmRQbGF5ZXJSYXRpbmdUYWcgPT09IGUKICAgICAgICB9LAogICAgICAgIE9uTGVhZGVyYm9hcmRBbnlGZXRjaFBsYXllcigpIHsKICAgICAgICAgICAgcmV0dXJuICEwCiAgICAgICAgfSwKICAgICAgICBPbkxlYWRlcmJvYXJkRmV0Y2hQbGF5ZXJFcnJvcihlKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmxhc3RMZWFkZXJib2FyZFBsYXllclJhdGluZ1RhZyA9PT0gZQogICAgICAgIH0sCiAgICAgICAgT25MZWFkZXJib2FyZEFueUZldGNoUGxheWVyRXJyb3IoKSB7CiAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgIH0sCiAgICAgICAgT25MZWFkZXJib2FyZFB1Ymxpc2hSZWNvcmQoKSB7CiAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgIH0sCiAgICAgICAgT25MZWFkZXJib2FyZFB1Ymxpc2hSZWNvcmRFcnJvcigpIHsKICAgICAgICAgICAgcmV0dXJuICEwCiAgICAgICAgfSwKICAgICAgICBMZWFkZXJib2FyZEVhY2hQbGF5ZXIoKSB7CiAgICAgICAgICAgIHJldHVybiBlYWNoKHRoaXMuX3J1bnRpbWUsIHRoaXMubGVhZGVyYm9hcmQsIChlLCByKSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRMZWFkZXJib2FyZEluZGV4ID0gciwgdGhpcy5jdXJyZW50TGVhZGVyYm9hcmRQbGF5ZXIgPSBlCiAgICAgICAgICAgIH0pLCAhMQogICAgICAgIH0sCiAgICAgICAgT25BY2hpZXZlbWVudHNPcGVuKCkgewogICAgICAgICAgICByZXR1cm4gITAKICAgICAgICB9LAogICAgICAgIE9uQWNoaWV2ZW1lbnRzQ2xvc2UoKSB7CiAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgIH0sCiAgICAgICAgT25BY2hpZXZlbWVudHNGZXRjaCgpIHsKICAgICAgICAgICAgcmV0dXJuICEwCiAgICAgICAgfSwKICAgICAgICBPbkFjaGlldmVtZW50c0ZldGNoRXJyb3IoKSB7CiAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgIH0sCiAgICAgICAgT25BY2hpZXZlbWVudHNVbmxvY2soZSkgewogICAgICAgICAgICB2YXIgciA9IHBhcnNlSW50KGUsIDEwKSB8fCAwOwogICAgICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnQudGFnID09PSBlIHx8IHRoaXMuY3VycmVudEFjaGlldmVtZW50LmlkID09PSByCiAgICAgICAgfSwKICAgICAgICBPbkFjaGlldmVtZW50c0FueVVubG9jaygpIHsKICAgICAgICAgICAgcmV0dXJuICEwCiAgICAgICAgfSwKICAgICAgICBPbkFjaGlldmVtZW50c0FueVVubG9ja0Vycm9yKCkgewogICAgICAgICAgICByZXR1cm4gITAKICAgICAgICB9LAogICAgICAgIE9uQWNoaWV2ZW1lbnRzU2V0UHJvZ3Jlc3MoZSkgewogICAgICAgICAgICB2YXIgciA9IHBhcnNlSW50KGUsIDEwKSB8fCAwOwogICAgICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnQudGFnID09PSBlIHx8IHRoaXMuY3VycmVudEFjaGlldmVtZW50LmlkID09PSByCiAgICAgICAgfSwKICAgICAgICBPbkFjaGlldmVtZW50c0FueVNldFByb2dyZXNzKCkgewogICAgICAgICAgICByZXR1cm4gITAKICAgICAgICB9LAogICAgICAgIE9uQWNoaWV2ZW1lbnRzQW55U2V0UHJvZ3Jlc3NFcnJvcigpIHsKICAgICAgICAgICAgcmV0dXJuICEwCiAgICAgICAgfSwKICAgICAgICBBY2hpZXZlbWVudHNFYWNoQWNoaWV2ZW1lbnQoKSB7CiAgICAgICAgICAgIHJldHVybiBlYWNoKHRoaXMuX3J1bnRpbWUsIHRoaXMuYWNoaWV2ZW1lbnRzLCAociwgZSkgPT4gewogICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnRJbmRleCA9IGUsIHRoaXMuY3VycmVudEFjaGlldmVtZW50ID0gcjsKICAgICAgICAgICAgICAgIGUgPSB0aGlzLnBsYXllckFjaGlldmVtZW50cy5maW5kKGUgPT4gZS5hY2hpZXZlbWVudElkID09PSByLmlkKTsKICAgICAgICAgICAgICAgIGUgJiYgKHRoaXMuY3VycmVudEFjaGlldmVtZW50LnVubG9ja2VkID0gZS51bmxvY2tlZCwgdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnQucHJvZ3Jlc3MgPSBlLnByb2dyZXNzKQogICAgICAgICAgICB9KSwgITEKICAgICAgICB9LAogICAgICAgIEFjaGlldmVtZW50c0VhY2hBY2hpZXZlbWVudEluR3JvdXAocikgewogICAgICAgICAgICBjb25zdCB0ID0gcGFyc2VJbnQociwgMTApIHx8IDAsCiAgICAgICAgICAgICAgICBlID0gdGhpcy5hY2hpZXZlbWVudHNHcm91cHMuZmluZChlID0+IGUudGFnID09PSByIHx8IGUuaWQgPT09IHQpOwogICAgICAgICAgICB2YXIgcyA9IGUgPyBlLmFjaGlldmVtZW50cy5yZWR1Y2UoKGUsIHIpID0+IHsKICAgICAgICAgICAgICAgIHZhciB0ID0gdGhpcy5hY2hpZXZlbWVudHMuZmluZChlID0+IGUuaWQgPT09IHIpOwogICAgICAgICAgICAgICAgcmV0dXJuIHQgJiYgZS5wdXNoKHQpLCBlCiAgICAgICAgICAgIH0sIFtdKSA6IFtdOwogICAgICAgICAgICByZXR1cm4gZWFjaCh0aGlzLl9ydW50aW1lLCBzLCAociwgZSkgPT4gewogICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnRJbmRleCA9IGUsIHRoaXMuY3VycmVudEFjaGlldmVtZW50ID0gcjsKICAgICAgICAgICAgICAgIGUgPSB0aGlzLnBsYXllckFjaGlldmVtZW50cy5maW5kKGUgPT4gZS5hY2hpZXZlbWVudElkID09PSByLmlkKTsKICAgICAgICAgICAgICAgIGUgJiYgKHRoaXMuY3VycmVudEFjaGlldmVtZW50LnVubG9ja2VkID0gZS51bmxvY2tlZCwgdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnQucHJvZ3Jlc3MgPSBlLnByb2dyZXNzKQogICAgICAgICAgICB9KSwgITEKICAgICAgICB9LAogICAgICAgIEFjaGlldmVtZW50c0VhY2hBY2hpZXZlbWVudHNHcm91cCgpIHsKICAgICAgICAgICAgcmV0dXJuIGVhY2godGhpcy5fcnVudGltZSwgdGhpcy5hY2hpZXZlbWVudHNHcm91cHMsIChlLCByKSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRBY2hpZXZlbWVudHNHcm91cEluZGV4ID0gciwgdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnRzR3JvdXBJZCA9IGUuaWQsIHRoaXMuY3VycmVudEFjaGlldmVtZW50c0dyb3VwVGFnID0gZS50YWcsIHRoaXMuY3VycmVudEFjaGlldmVtZW50c0dyb3VwTmFtZSA9IGUubmFtZSwgdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnRzR3JvdXBEZXNjcmlwdGlvbiA9IGUuZGVzY3JpcHRpb24KICAgICAgICAgICAgfSksICExCiAgICAgICAgfSwKICAgICAgICBBY2hpZXZlbWVudHNFYWNoUGxheWVyQWNoaWV2ZW1lbnRzKCkgewogICAgICAgICAgICByZXR1cm4gZWFjaCh0aGlzLl9ydW50aW1lLCB0aGlzLmdwLmFjaGlldmVtZW50cy51bmxvY2tlZExpc3QsIChlLCByKSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRQbGF5ZXJBY2hpZXZlbWVudEluZGV4ID0gciwgdGhpcy5jdXJyZW50UGxheWVyQWNoaWV2ZW1lbnRJZCA9IGUuaWQsIHRoaXMuY3VycmVudFBsYXllckFjaGlldmVtZW50VW5sb2NrRGF0ZSA9IGUuY3JlYXRlZEF0CiAgICAgICAgICAgIH0pLCAhMQogICAgICAgIH0sCiAgICAgICAgSXNBY2hpZXZlbWVudHNDdXJBY2hpZXZlbWVudFVubG9ja2VkKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnQudW5sb2NrZWQKICAgICAgICB9LAogICAgICAgIElzQWNoaWV2ZW1lbnRzQ3VyQWNoaWV2ZW1lbnRMb2NrZWRWaXNpYmxlKCkgewogICAgICAgICAgICByZXR1cm4gISF0aGlzLmN1cnJlbnRBY2hpZXZlbWVudC5pc0xvY2tlZFZpc2libGUKICAgICAgICB9LAogICAgICAgIElzQWNoaWV2ZW1lbnRzQ3VyQWNoaWV2ZW1lbnRMb2NrZWREZXNjcmlwdGlvblZpc2libGUoKSB7CiAgICAgICAgICAgIHJldHVybiAhIXRoaXMuY3VycmVudEFjaGlldmVtZW50LmlzTG9ja2VkRGVzY3JpcHRpb25WaXNpYmxlCiAgICAgICAgfSwKICAgICAgICBJc0FjaGlldmVtZW50c1VubG9ja1N1Y2Nlc3NmdWwoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmlzVW5sb2NrQWNoaWV2ZW1lbnRTdWNjZXNzCiAgICAgICAgfSwKICAgICAgICBBY2hpZXZlbWVudHNJc1VubG9ja2VkKGUpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ3AuYWNoaWV2ZW1lbnRzLmhhcyhlKQogICAgICAgIH0sCiAgICAgICAgT25QYXltZW50c0ZldGNoUHJvZHVjdHMoKSB7CiAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgIH0sCiAgICAgICAgT25QYXltZW50c0ZldGNoUHJvZHVjdHNFcnJvcigpIHsKICAgICAgICAgICAgcmV0dXJuICEwCiAgICAgICAgfSwKICAgICAgICBPbkV2ZW50Q29ubmVjdCgpIHsKICAgICAgICAgICAgcmV0dXJuICEwCiAgICAgICAgfSwKICAgICAgICBPblBheW1lbnRzUHVyY2hhc2UoZSkgewogICAgICAgICAgICB2YXIgciA9IHBhcnNlSW50KGUsIDEwKSB8fCAwOwogICAgICAgICAgICByZXR1cm4gdGhpcy5wdXJjaGFzZWRQcm9kdWN0VGFnID09PSBlIHx8IHRoaXMucHVyY2hhc2VkUHJvZHVjdElkID09PSByCiAgICAgICAgfSwKICAgICAgICBPblBheW1lbnRzUHVyY2hhc2VFcnJvcihlKSB7CiAgICAgICAgICAgIHZhciByID0gcGFyc2VJbnQoZSwgMTApIHx8IDA7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnB1cmNoYXNlZFByb2R1Y3RUYWcgPT09IGUgfHwgdGhpcy5wdXJjaGFzZWRQcm9kdWN0SWQgPT09IHIKICAgICAgICB9LAogICAgICAgIE9uUGF5bWVudHNBbnlQdXJjaGFzZSgpIHsKICAgICAgICAgICAgcmV0dXJuICEwCiAgICAgICAgfSwKICAgICAgICBPblBheW1lbnRzQW55UHVyY2hhc2VFcnJvcigpIHsKICAgICAgICAgICAgcmV0dXJuICEwCiAgICAgICAgfSwKICAgICAgICBPblBheW1lbnRzQ29uc3VtZShlKSB7CiAgICAgICAgICAgIHZhciByID0gcGFyc2VJbnQoZSwgMTApIHx8IDA7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbnN1bWVkUHJvZHVjdFRhZyA9PT0gZSB8fCB0aGlzLmNvbnN1bWVkUHJvZHVjdElkID09PSByCiAgICAgICAgfSwKICAgICAgICBPblBheW1lbnRzQ29uc3VtZUVycm9yKGUpIHsKICAgICAgICAgICAgdmFyIHIgPSBwYXJzZUludChlLCAxMCkgfHwgMDsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29uc3VtZWRQcm9kdWN0VGFnID09PSBlIHx8IHRoaXMuY29uc3VtZWRQcm9kdWN0SWQgPT09IHIKICAgICAgICB9LAogICAgICAgIE9uUGF5bWVudHNBbnlDb25zdW1lKCkgewogICAgICAgICAgICByZXR1cm4gITAKICAgICAgICB9LAogICAgICAgIE9uUGF5bWVudHNBbnlDb25zdW1lRXJyb3IoKSB7CiAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgIH0sCiAgICAgICAgT25QYXltZW50c1N1YnNjcmliZShlKSB7CiAgICAgICAgICAgIHZhciByID0gcGFyc2VJbnQoZSwgMTApIHx8IDA7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnB1cmNoYXNlZFByb2R1Y3RUYWcgPT09IGUgfHwgdGhpcy5wdXJjaGFzZWRQcm9kdWN0SWQgPT09IHIKICAgICAgICB9LAogICAgICAgIE9uUGF5bWVudHNTdWJzY3JpYmVFcnJvcihlKSB7CiAgICAgICAgICAgIHZhciByID0gcGFyc2VJbnQoZSwgMTApIHx8IDA7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnB1cmNoYXNlZFByb2R1Y3RUYWcgPT09IGUgfHwgdGhpcy5wdXJjaGFzZWRQcm9kdWN0SWQgPT09IHIKICAgICAgICB9LAogICAgICAgIE9uUGF5bWVudHNBbnlTdWJzY3JpYmUoKSB7CiAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgIH0sCiAgICAgICAgT25QYXltZW50c0FueVN1YnNjcmliZUVycm9yKCkgewogICAgICAgICAgICByZXR1cm4gITAKICAgICAgICB9LAogICAgICAgIE9uUGF5bWVudHNVbnN1YnNjcmliZShlKSB7CiAgICAgICAgICAgIHZhciByID0gcGFyc2VJbnQoZSwgMTApIHx8IDA7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnB1cmNoYXNlZFByb2R1Y3RUYWcgPT09IGUgfHwgdGhpcy5wdXJjaGFzZWRQcm9kdWN0SWQgPT09IHIKICAgICAgICB9LAogICAgICAgIE9uUGF5bWVudHNVbnN1YnNjcmliZUVycm9yKGUpIHsKICAgICAgICAgICAgdmFyIHIgPSBwYXJzZUludChlLCAxMCkgfHwgMDsKICAgICAgICAgICAgcmV0dXJuIHRoaXMucHVyY2hhc2VkUHJvZHVjdFRhZyA9PT0gZSB8fCB0aGlzLnB1cmNoYXNlZFByb2R1Y3RJZCA9PT0gcgogICAgICAgIH0sCiAgICAgICAgT25QYXltZW50c0FueVVuc3Vic2NyaWJlKCkgewogICAgICAgICAgICByZXR1cm4gITAKICAgICAgICB9LAogICAgICAgIE9uUGF5bWVudHNBbnlVbnN1YnNjcmliZUVycm9yKCkgewogICAgICAgICAgICByZXR1cm4gITAKICAgICAgICB9LAogICAgICAgIFBheW1lbnRzRWFjaFByb2R1Y3QoKSB7CiAgICAgICAgICAgIHJldHVybiBlYWNoKHRoaXMuX3J1bnRpbWUsIHRoaXMucHJvZHVjdHMsIChyLCBlKSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRQcm9kdWN0SW5kZXggPSBlLCB0aGlzLmN1cnJlbnRQcm9kdWN0ID0gciwgdGhpcy5jdXJyZW50UHJvZHVjdFB1cmNoYXNlcyA9IHRoaXMucGxheWVyUHVyY2hhc2VzLmZpbHRlcihlID0+IGUucHJvZHVjdElkID09PSByLmlkKS5sZW5ndGgKICAgICAgICAgICAgfSksICExCiAgICAgICAgfSwKICAgICAgICBQYXltZW50c0VhY2hQdXJjaGFzZSgpIHsKICAgICAgICAgICAgcmV0dXJuIGVhY2godGhpcy5fcnVudGltZSwgdGhpcy5ncC5wYXltZW50cy5wdXJjaGFzZXMsIChlLCByKSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRQdXJjaGFzZUluZGV4ID0gciwgdGhpcy5jdXJyZW50UHVyY2hhc2UgPSBlCiAgICAgICAgICAgIH0pLCAhMQogICAgICAgIH0sCiAgICAgICAgSXNQYXltZW50c0N1clByb2R1Y3RQdXJjaGFzZWQoKSB7CiAgICAgICAgICAgIHJldHVybiAwIDwgdGhpcy5jdXJyZW50UHJvZHVjdFB1cmNoYXNlcwogICAgICAgIH0sCiAgICAgICAgSXNQYXltZW50c1B1cmNoYXNlU3VjY2Vzc2Z1bCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuaXNQdXJjaGFzZVByb2R1Y3RTdWNjZXNzCiAgICAgICAgfSwKICAgICAgICBJc1BheW1lbnRzQ29uc3VtZVN1Y2Nlc3NmdWwoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmlzQ29uc3VtZVByb2R1Y3RTdWNjZXNzCiAgICAgICAgfSwKICAgICAgICBJc1BheW1lbnRzU3Vic2NyaWJlU3VjY2Vzc2Z1bCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuaXNTdWJzY3JpYmVQcm9kdWN0U3VjY2VzcwogICAgICAgIH0sCiAgICAgICAgSXNQYXltZW50c1Vuc3Vic2NyaWJlU3VjY2Vzc2Z1bCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuaXNVbnN1YnNjcmliZVByb2R1Y3RTdWNjZXNzCiAgICAgICAgfSwKICAgICAgICBQYXltZW50c0lzUHVyY2hhc2VkKGUpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ3AucGF5bWVudHMuaGFzKGUpCiAgICAgICAgfSwKICAgICAgICBQYXltZW50c0lzU3Vic2NyaWJlZChlKSB7CiAgICAgICAgICAgIGUgPSB0aGlzLmdwLnBheW1lbnRzLmdldFB1cmNoYXNlKGUpOwogICAgICAgICAgICByZXR1cm4gZSAmJiBlLnN1YnNjcmliZWQgfHwgITEKICAgICAgICB9LAogICAgICAgIElzUGF5bWVudHNBdmFpbGFibGUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdwLnBheW1lbnRzLmlzQXZhaWxhYmxlCiAgICAgICAgfSwKICAgICAgICBJc1N1YnNjcmlwdGlvbnNBdmFpbGFibGUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdwLnBheW1lbnRzLmlzU3Vic2NyaXB0aW9uc0F2YWlsYWJsZQogICAgICAgIH0sCiAgICAgICAgT25JbWFnZXNGZXRjaCgpIHsKICAgICAgICAgICAgcmV0dXJuICEwCiAgICAgICAgfSwKICAgICAgICBPbkltYWdlc0ZldGNoRXJyb3IoKSB7CiAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgIH0sCiAgICAgICAgT25JbWFnZXNGZXRjaE1vcmUoKSB7CiAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgIH0sCiAgICAgICAgT25JbWFnZXNGZXRjaE1vcmVFcnJvcigpIHsKICAgICAgICAgICAgcmV0dXJuICEwCiAgICAgICAgfSwKICAgICAgICBPbkltYWdlc1VwbG9hZCgpIHsKICAgICAgICAgICAgcmV0dXJuICEwCiAgICAgICAgfSwKICAgICAgICBPbkltYWdlc1VwbG9hZEVycm9yKCkgewogICAgICAgICAgICByZXR1cm4gITAKICAgICAgICB9LAogICAgICAgIE9uSW1hZ2VzQ2hvb3NlKCkgewogICAgICAgICAgICByZXR1cm4gITAKICAgICAgICB9LAogICAgICAgIE9uSW1hZ2VzQ2hvb3NlRXJyb3IoKSB7CiAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgIH0sCiAgICAgICAgSW1hZ2VzRWFjaEltYWdlKCkgewogICAgICAgICAgICByZXR1cm4gZWFjaCh0aGlzLl9ydW50aW1lLCB0aGlzLmltYWdlcywgKGUsIHIpID0+IHsKICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudEltYWdlSW5kZXggPSByLCB0aGlzLmN1cnJlbnRJbWFnZSA9IGUKICAgICAgICAgICAgfSksICExCiAgICAgICAgfSwKICAgICAgICBJbWFnZXNFYWNoVGFnKHIpIHsKICAgICAgICAgICAgdmFyIGUgPSB0aGlzLmltYWdlcy5maW5kKGUgPT4gZS5pZCA9PT0gciksCiAgICAgICAgICAgICAgICBlID0gZSA/IGUudGFncyA6IFtdOwogICAgICAgICAgICByZXR1cm4gZWFjaCh0aGlzLl9ydW50aW1lLCBlIHx8IFtdLCAoZSwgcikgPT4gewogICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50SW1hZ2VUYWdJbmRleCA9IHIsIHRoaXMuY3VycmVudEltYWdlVGFnID0gZQogICAgICAgICAgICB9KSwgITEKICAgICAgICB9LAogICAgICAgIEltYWdlc0NhbkxvYWRNb3JlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jYW5Mb2FkTW9yZUltYWdlcwogICAgICAgIH0sCiAgICAgICAgSW1hZ2VzQ2FuVXBsb2FkKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5ncC5pbWFnZXMuY2FuVXBsb2FkCiAgICAgICAgfSwKICAgICAgICBPbkZpbGVzRmV0Y2goKSB7CiAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgIH0sCiAgICAgICAgT25GaWxlc0ZldGNoRXJyb3IoKSB7CiAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgIH0sCiAgICAgICAgT25GaWxlc0ZldGNoTW9yZSgpIHsKICAgICAgICAgICAgcmV0dXJuICEwCiAgICAgICAgfSwKICAgICAgICBPbkZpbGVzRmV0Y2hNb3JlRXJyb3IoKSB7CiAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgIH0sCiAgICAgICAgT25GaWxlc1VwbG9hZCgpIHsKICAgICAgICAgICAgcmV0dXJuICEwCiAgICAgICAgfSwKICAgICAgICBPbkZpbGVzVXBsb2FkRXJyb3IoKSB7CiAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgIH0sCiAgICAgICAgT25GaWxlc0xvYWRDb250ZW50KCkgewogICAgICAgICAgICByZXR1cm4gITAKICAgICAgICB9LAogICAgICAgIE9uRmlsZXNMb2FkQ29udGVudEVycm9yKCkgewogICAgICAgICAgICByZXR1cm4gITAKICAgICAgICB9LAogICAgICAgIE9uRmlsZXNDaG9vc2UoKSB7CiAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgIH0sCiAgICAgICAgT25GaWxlc0Nob29zZUVycm9yKCkgewogICAgICAgICAgICByZXR1cm4gITAKICAgICAgICB9LAogICAgICAgIEZpbGVzRWFjaEZpbGUoKSB7CiAgICAgICAgICAgIHJldHVybiBlYWNoKHRoaXMuX3J1bnRpbWUsIHRoaXMuZmlsZXMsIChlLCByKSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRGaWxlSW5kZXggPSByLCB0aGlzLmN1cnJlbnRGaWxlID0gZQogICAgICAgICAgICB9KSwgITEKICAgICAgICB9LAogICAgICAgIEZpbGVzRWFjaFRhZyhyKSB7CiAgICAgICAgICAgIHZhciBlID0gdGhpcy5maWxlcy5maW5kKGUgPT4gZS5pZCA9PT0gciksCiAgICAgICAgICAgICAgICBlID0gZSA/IGUudGFncyA6IFtdOwogICAgICAgICAgICByZXR1cm4gZWFjaCh0aGlzLl9ydW50aW1lLCBlIHx8IFtdLCAoZSwgcikgPT4gewogICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50RmlsZVRhZ0luZGV4ID0gciwgdGhpcy5jdXJyZW50RmlsZVRhZyA9IGUKICAgICAgICAgICAgfSksICExCiAgICAgICAgfSwKICAgICAgICBGaWxlc0NhbkxvYWRNb3JlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jYW5Mb2FkTW9yZUZpbGVzCiAgICAgICAgfSwKICAgICAgICBGaWxlc0NhblVwbG9hZCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ3AuZmlsZXMuY2FuVXBsb2FkCiAgICAgICAgfSwKICAgICAgICBPblZhcmlhYmxlc0ZldGNoKCkgewogICAgICAgICAgICByZXR1cm4gITAKICAgICAgICB9LAogICAgICAgIE9uVmFyaWFibGVzRmV0Y2hFcnJvcigpIHsKICAgICAgICAgICAgcmV0dXJuICEwCiAgICAgICAgfSwKICAgICAgICBWYXJpYWJsZXNFYWNoVmFyaWFibGUoKSB7CiAgICAgICAgICAgIHJldHVybiBlYWNoKHRoaXMuX3J1bnRpbWUsIHRoaXMuZ3AudmFyaWFibGVzLmxpc3QsIChlLCByKSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRWYXJpYWJsZUluZGV4ID0gciwgdGhpcy5jdXJyZW50VmFyaWFibGUgPSBlCiAgICAgICAgICAgIH0pLCAhMQogICAgICAgIH0sCiAgICAgICAgVmFyaWFibGVzQ29tcGFyZShlLCByLCB0KSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLm1hcHBlcnMuY29tcGFyZVtyXSh0aGlzLmdwLnZhcmlhYmxlcy5nZXQoZSksIHQpCiAgICAgICAgfSwKICAgICAgICBWYXJpYWJsZXNDb21wYXJlVHlwZShlLCByKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdwLnZhcmlhYmxlcy50eXBlKGUpID09PSB0aGlzLm1hcHBlcnMudmFyaWFibGVzVHlwZXNbcl0KICAgICAgICB9LAogICAgICAgIFZhcmlhYmxlc0hhcyhlKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdwLnZhcmlhYmxlcy5oYXMoZSkKICAgICAgICB9LAogICAgICAgIE9uRnVsbHNjcmVlbk9wZW4oKSB7CiAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgIH0sCiAgICAgICAgT25GdWxsc2NyZWVuQ2xvc2UoKSB7CiAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgIH0sCiAgICAgICAgT25GdWxsc2NyZWVuQ2hhbmdlKCkgewogICAgICAgICAgICByZXR1cm4gITAKICAgICAgICB9LAogICAgICAgIElzRnVsbHNjcmVlbk1vZGUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdwLmZ1bGxzY3JlZW4uaXNFbmFibGVkCiAgICAgICAgfSwKICAgICAgICBPbkFkc1N0YXJ0KCkgewogICAgICAgICAgICByZXR1cm4gITAKICAgICAgICB9LAogICAgICAgIE9uQWRzQ2xvc2UoKSB7CiAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgIH0sCiAgICAgICAgT25BZHNGdWxsc2NyZWVuU3RhcnQoKSB7CiAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgIH0sCiAgICAgICAgT25BZHNGdWxsc2NyZWVuQ2xvc2UoKSB7CiAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgIH0sCiAgICAgICAgT25BZHNQcmVsb2FkZXJTdGFydCgpIHsKICAgICAgICAgICAgcmV0dXJuICEwCiAgICAgICAgfSwKICAgICAgICBPbkFkc1ByZWxvYWRlckNsb3NlKCkgewogICAgICAgICAgICByZXR1cm4gITAKICAgICAgICB9LAogICAgICAgIE9uQWRzUmV3YXJkZWRTdGFydCgpIHsKICAgICAgICAgICAgcmV0dXJuICEwCiAgICAgICAgfSwKICAgICAgICBPbkFkc1Jld2FyZGVkQ2xvc2UoKSB7CiAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgIH0sCiAgICAgICAgT25BZHNSZXdhcmRlZFJld2FyZCgpIHsKICAgICAgICAgICAgcmV0dXJuICEwCiAgICAgICAgfSwKICAgICAgICBPbkFkc1N0aWNreVN0YXJ0KCkgewogICAgICAgICAgICByZXR1cm4gITAKICAgICAgICB9LAogICAgICAgIE9uQWRzU3RpY2t5Q2xvc2UoKSB7CiAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgIH0sCiAgICAgICAgT25BZHNTdGlja3lSZWZyZXNoKCkgewogICAgICAgICAgICByZXR1cm4gITAKICAgICAgICB9LAogICAgICAgIE9uQWRzU3RpY2t5UmVuZGVyKCkgewogICAgICAgICAgICByZXR1cm4gITAKICAgICAgICB9LAogICAgICAgIElzQWRzRnVsbHNjcmVlbkF2YWlsYWJsZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ3AuYWRzLmlzRnVsbHNjcmVlbkF2YWlsYWJsZQogICAgICAgIH0sCiAgICAgICAgSXNBZHNSZXdhcmRlZEF2YWlsYWJsZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ3AuYWRzLmlzUmV3YXJkZWRBdmFpbGFibGUKICAgICAgICB9LAogICAgICAgIElzQWRzUHJlbG9hZGVyQXZhaWxhYmxlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5ncC5hZHMuaXNQcmVsb2FkZXJBdmFpbGFibGUKICAgICAgICB9LAogICAgICAgIElzQWRzU3RpY2t5QXZhaWxhYmxlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5ncC5hZHMuaXNTdGlja3lBdmFpbGFibGUKICAgICAgICB9LAogICAgICAgIElzQWRzRnVsbHNjcmVlblBsYXlpbmcoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdwLmFkcy5pc0Z1bGxzY3JlZW5QbGF5aW5nCiAgICAgICAgfSwKICAgICAgICBJc0Fkc1Jld2FyZGVkUGxheWluZygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ3AuYWRzLmlzUmV3YXJkZWRQbGF5aW5nCiAgICAgICAgfSwKICAgICAgICBJc0Fkc1ByZWxvYWRlclBsYXlpbmcoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdwLmFkcy5pc1ByZWxvYWRlclBsYXlpbmcKICAgICAgICB9LAogICAgICAgIElzQWRzU3RpY2t5UGxheWluZygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ3AuYWRzLmlzU3RpY2t5UGxheWluZwogICAgICAgIH0sCiAgICAgICAgSXNBZHNBZGJsb2NrRW5hYmxlZCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ3AuYWRzLmlzQWRibG9ja0VuYWJsZWQKICAgICAgICB9LAogICAgICAgIElzQWRzTGFzdEFkU3VjY2VzcygpIHsKICAgICAgICAgICAgcmV0dXJuIEJvb2xlYW4odGhpcy5pc0xhc3RBZFN1Y2Nlc3MpCiAgICAgICAgfSwKICAgICAgICBPbkNoYW5nZUxhbmd1YWdlKCkgewogICAgICAgICAgICByZXR1cm4gITAKICAgICAgICB9LAogICAgICAgIE9uQ2hhbmdlQXZhdGFyR2VuZXJhdG9yKCkgewogICAgICAgICAgICByZXR1cm4gITAKICAgICAgICB9LAogICAgICAgIE9uT3ZlcmxheVJlYWR5KCkgewogICAgICAgICAgICByZXR1cm4gITAKICAgICAgICB9LAogICAgICAgIElzRGV2KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5ncC5pc0RldgogICAgICAgIH0sCiAgICAgICAgSXNNb2JpbGUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdwLmlzTW9iaWxlCiAgICAgICAgfSwKICAgICAgICBJc0FsbG93ZWRPcmlnaW4oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdwLmlzQWxsb3dlZE9yaWdpbgogICAgICAgIH0sCiAgICAgICAgTGFuZ3VhZ2UoZSkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5ncC5sYW5ndWFnZSA9PT0gdGhpcy5tYXBwZXJzLmxhbmd1YWdlW2VdCiAgICAgICAgfSwKICAgICAgICBPblBhdXNlKCkgewogICAgICAgICAgICByZXR1cm4gITAKICAgICAgICB9LAogICAgICAgIE9uUmVzdW1lKCkgewogICAgICAgICAgICByZXR1cm4gITAKICAgICAgICB9LAogICAgICAgIElzUGF1c2VkKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5ncC5pc1BhdXNlZAogICAgICAgIH0sCiAgICAgICAgT25HYW1lcGxheVN0YXJ0KCkgewogICAgICAgICAgICByZXR1cm4gITAKICAgICAgICB9LAogICAgICAgIE9uR2FtZXBsYXlTdG9wKCkgewogICAgICAgICAgICByZXR1cm4gITAKICAgICAgICB9LAogICAgICAgIElzR2FtZXBsYXkoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdwLmlzR2FtZXBsYXkKICAgICAgICB9LAogICAgICAgIEhhc1BsYXRmb3JtSW50ZWdyYXRlZEF1dGgoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdwLnBsYXRmb3JtLmhhc0ludGVncmF0ZWRBdXRoCiAgICAgICAgfSwKICAgICAgICBQbGF0Zm9ybVR5cGUoZSkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5ncC5wbGF0Zm9ybS50eXBlID09PSB0aGlzLm1hcHBlcnMucGxhdGZvcm1bZV0KICAgICAgICB9LAogICAgICAgIElzRXh0ZXJuYWxMaW5rc0FsbG93ZWRPblBsYXRmb3JtKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5ncC5wbGF0Zm9ybS5pc0V4dGVybmFsTGlua3NBbGxvd2VkCiAgICAgICAgfSwKICAgICAgICBPblNvY2lhbHNTaGFyZSgpIHsKICAgICAgICAgICAgcmV0dXJuICEwCiAgICAgICAgfSwKICAgICAgICBPblNvY2lhbHNQb3N0KCkgewogICAgICAgICAgICByZXR1cm4gITAKICAgICAgICB9LAogICAgICAgIE9uU29jaWFsc0ludml0ZSgpIHsKICAgICAgICAgICAgcmV0dXJuICEwCiAgICAgICAgfSwKICAgICAgICBPblNvY2lhbHNKb2luQ29tbXVuaXR5KCkgewogICAgICAgICAgICByZXR1cm4gITAKICAgICAgICB9LAogICAgICAgIElzU29jaWFsc0xhc3RTaGFyZVN1Y2Nlc3MoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmlzTGFzdFNoYXJlU3VjY2VzcwogICAgICAgIH0sCiAgICAgICAgSXNTb2NpYWxzTGFzdENvbW11bml0eUpvaW5TdWNjZXNzKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5pc0xhc3RDb21tdW5pdHlKb2luU3VjY2VzcwogICAgICAgIH0sCiAgICAgICAgSXNTb2NpYWxzU3VwcG9ydHNTaGFyZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ3Auc29jaWFscy5pc1N1cHBvcnRzU2hhcmUKICAgICAgICB9LAogICAgICAgIElzU29jaWFsc1N1cHBvcnRzTmF0aXZlU2hhcmUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdwLnNvY2lhbHMuaXNTdXBwb3J0c05hdGl2ZVNoYXJlCiAgICAgICAgfSwKICAgICAgICBJc1NvY2lhbHNTdXBwb3J0c05hdGl2ZVBvc3RzKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5ncC5zb2NpYWxzLmlzU3VwcG9ydHNOYXRpdmVQb3N0cwogICAgICAgIH0sCiAgICAgICAgSXNTb2NpYWxzU3VwcG9ydHNOYXRpdmVJbnZpdGUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdwLnNvY2lhbHMuaXNTdXBwb3J0c05hdGl2ZUludml0ZQogICAgICAgIH0sCiAgICAgICAgSXNTb2NpYWxzU3VwcG9ydHNOYXRpdmVDb21tdW5pdHlKb2luKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5ncC5zb2NpYWxzLmlzU3VwcG9ydHNOYXRpdmVDb21tdW5pdHlKb2luCiAgICAgICAgfSwKICAgICAgICBTb2NpYWxzQ2FuSm9pbkNvbW11bml0eSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ3Auc29jaWFscy5jYW5Kb2luQ29tbXVuaXR5CiAgICAgICAgfSwKICAgICAgICBPbkFwcEFkZFNob3J0Y3V0KCkgewogICAgICAgICAgICByZXR1cm4gITAKICAgICAgICB9LAogICAgICAgIElzQXBwTGFzdEFkZFNob3J0Y3V0U3VjY2VzcygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuaXNMYXN0QWRkU2hvcnRjdXRTdWNjZXNzCiAgICAgICAgfSwKICAgICAgICBBcHBDYW5BZGRTaG9ydGN1dCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ3AuYXBwLmNhbkFkZFNob3J0Y3V0CiAgICAgICAgfSwKICAgICAgICBPbkdhbWVzQ29sbGVjdGlvbnNPcGVuKCkgewogICAgICAgICAgICByZXR1cm4gITAKICAgICAgICB9LAogICAgICAgIE9uR2FtZXNDb2xsZWN0aW9uc0Nsb3NlKCkgewogICAgICAgICAgICByZXR1cm4gITAKICAgICAgICB9LAogICAgICAgIE9uR2FtZXNDb2xsZWN0aW9uc0ZldGNoQW55KCkgewogICAgICAgICAgICByZXR1cm4gITAKICAgICAgICB9LAogICAgICAgIE9uR2FtZXNDb2xsZWN0aW9uc0ZldGNoQW55RXJyb3IoKSB7CiAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgIH0sCiAgICAgICAgT25HYW1lc0NvbGxlY3Rpb25zRmV0Y2goZSkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5sYXN0R2FtZXNDb2xsZWN0aW9uSWRPclRhZyA9PT0gZQogICAgICAgIH0sCiAgICAgICAgT25HYW1lc0NvbGxlY3Rpb25zRmV0Y2hFcnJvcihlKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmxhc3RHYW1lc0NvbGxlY3Rpb25JZE9yVGFnID09PSBlCiAgICAgICAgfSwKICAgICAgICBHYW1lc0NvbGxlY3Rpb25zRWFjaEdhbWUoKSB7CiAgICAgICAgICAgIHJldHVybiBlYWNoKHRoaXMuX3J1bnRpbWUsIHRoaXMuZ2FtZXNDb2xsZWN0aW9uLmdhbWVzLCAoZSwgcikgPT4gewogICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50R2FtZUluZGV4ID0gciwgdGhpcy5jdXJyZW50R2FtZUlkID0gZS5pZCwgdGhpcy5jdXJyZW50R2FtZU5hbWUgPSBlLm5hbWUsIHRoaXMuY3VycmVudEdhbWVEZXNjcmlwdGlvbiA9IGUuZGVzY3JpcHRpb24sIHRoaXMuY3VycmVudEdhbWVJY29uID0gZS5pY29uLCB0aGlzLmN1cnJlbnRHYW1lVXJsID0gZS51cmwKICAgICAgICAgICAgfSksICExCiAgICAgICAgfSwKICAgICAgICBJc0dhbWVzQ29sbGVjdGlvbnNBdmFpbGFibGUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdwLmdhbWVzQ29sbGVjdGlvbnMuaXNBdmFpbGFibGUKICAgICAgICB9LAogICAgICAgIE9uRG9jdW1lbnRzT3BlbigpIHsKICAgICAgICAgICAgcmV0dXJuICEwCiAgICAgICAgfSwKICAgICAgICBPbkRvY3VtZW50c0Nsb3NlKCkgewogICAgICAgICAgICByZXR1cm4gITAKICAgICAgICB9LAogICAgICAgIE9uRG9jdW1lbnRzRmV0Y2hBbnkoKSB7CiAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgIH0sCiAgICAgICAgT25Eb2N1bWVudHNGZXRjaEFueUVycm9yKCkgewogICAgICAgICAgICByZXR1cm4gITAKICAgICAgICB9LAogICAgICAgIE9uRG9jdW1lbnRzRmV0Y2goZSkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5sYXN0RG9jdW1lbnRUeXBlID09PSB0aGlzLm1hcHBlcnMuZG9jdW1lbnRUeXBlc1tlXQogICAgICAgIH0sCiAgICAgICAgT25Eb2N1bWVudHNGZXRjaEVycm9yKGUpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMubGFzdERvY3VtZW50VHlwZSA9PT0gdGhpcy5tYXBwZXJzLmRvY3VtZW50VHlwZXNbZV0KICAgICAgICB9LAogICAgICAgIE9uUGxheWVyc0ZldGNoKGUpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMubGFzdFBsYXllcnNUYWcgPT09IGUKICAgICAgICB9LAogICAgICAgIE9uUGxheWVyc0FueUZldGNoKCkgewogICAgICAgICAgICByZXR1cm4gITAKICAgICAgICB9LAogICAgICAgIE9uUGxheWVyc0ZldGNoRXJyb3IoZSkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5sYXN0UGxheWVyc1RhZyA9PT0gZQogICAgICAgIH0sCiAgICAgICAgT25QbGF5ZXJzQW55RmV0Y2hFcnJvcigpIHsKICAgICAgICAgICAgcmV0dXJuICEwCiAgICAgICAgfSwKICAgICAgICBQbGF5ZXJzRWFjaFBsYXllcigpIHsKICAgICAgICAgICAgcmV0dXJuIGVhY2godGhpcy5fcnVudGltZSwgdGhpcy5wbGF5ZXJzTGlzdCwgKGUsIHIpID0+IHsKICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFBsYXllcnNJbmRleCA9IHIsIHRoaXMuY3VycmVudFBsYXllcnNQbGF5ZXIgPSBlCiAgICAgICAgICAgIH0pLCAhMQogICAgICAgIH0sCiAgICAgICAgUGxheWVyc0VhY2hQbGF5ZXJBY2hpZXZlbWVudCgpIHsKICAgICAgICAgICAgcmV0dXJuIGVhY2godGhpcy5fcnVudGltZSwgdGhpcy5jdXJyZW50UGxheWVyc1BsYXllci5hY2hpZXZlbWVudHMsIChlLCByKSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRQbGF5ZXJBY2hpZXZlbWVudEluZGV4ID0gciwgdGhpcy5jdXJyZW50UGxheWVyQWNoaWV2ZW1lbnRJZCA9IGUuaWQsIHRoaXMuY3VycmVudFBsYXllckFjaGlldmVtZW50VW5sb2NrRGF0ZSA9IGUuY3JlYXRlZEF0CiAgICAgICAgICAgIH0pLCAhMQogICAgICAgIH0sCiAgICAgICAgUGxheWVyc0VhY2hQbGF5ZXJQdXJjaGFzZSgpIHsKICAgICAgICAgICAgcmV0dXJuIGVhY2godGhpcy5fcnVudGltZSwgdGhpcy5jdXJyZW50UGxheWVyc1BsYXllci5wdXJjaGFzZXMsIChlLCByKSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRQdXJjaGFzZUluZGV4ID0gciwgdGhpcy5jdXJyZW50UHVyY2hhc2UgPSBlCiAgICAgICAgICAgIH0pLCAhMQogICAgICAgIH0sCiAgICAgICAgSXNMYXN0QWN0aW9uU3VjY2VzcygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuaXNMYXN0QWN0aW9uU3VjY2VzcwogICAgICAgIH0sCiAgICAgICAgT25Mb2FkSnNvbkVycm9yKCkgewogICAgICAgICAgICByZXR1cm4gITAKICAgICAgICB9CiAgICB9Owp9Cgp7CiAgICAidXNlIHN0cmljdCI7CgogICAgZnVuY3Rpb24gc3RvYXJyKGUgPSAiIiwgdCA9IFN0cmluZykgewogICAgICAgIHJldHVybiBTdHJpbmcoZSkuc3BsaXQoIiwiKS5tYXAoZSA9PiB0KGUudHJpbSgpKSkuZmlsdGVyKGUgPT4gZSkKICAgIH0KICAgIEMzLlBsdWdpbnMuRXBvbmVzaF9HYW1lU2NvcmUuQWN0cyA9IHsKICAgICAgICBQbGF5ZXJTZXROYW1lKGUpIHsKICAgICAgICAgICAgdGhpcy5ncC5wbGF5ZXIubmFtZSA9IGUKICAgICAgICB9LAogICAgICAgIFBsYXllclNldEF2YXRhcihlKSB7CiAgICAgICAgICAgIHRoaXMuZ3AucGxheWVyLmF2YXRhciA9IGUKICAgICAgICB9LAogICAgICAgIFBsYXllclNldFNjb3JlKGUpIHsKICAgICAgICAgICAgdGhpcy5ncC5wbGF5ZXIuc2NvcmUgPSBlCiAgICAgICAgfSwKICAgICAgICBQbGF5ZXJBZGRTY29yZShlKSB7CiAgICAgICAgICAgIHRoaXMuZ3AucGxheWVyLnNjb3JlICs9IGUKICAgICAgICB9LAogICAgICAgIFBsYXllclNldChlLCB0KSB7CiAgICAgICAgICAgIHRoaXMuZ3AucGxheWVyLnNldChlLCB0KQogICAgICAgIH0sCiAgICAgICAgUGxheWVyU2V0RmxhZyhlLCB0KSB7CiAgICAgICAgICAgIHRoaXMuZ3AucGxheWVyLnNldChlLCAhdCkKICAgICAgICB9LAogICAgICAgIFBsYXllckFkZChlLCB0KSB7CiAgICAgICAgICAgIHRoaXMuZ3AucGxheWVyLmFkZChlLCB0KQogICAgICAgIH0sCiAgICAgICAgUGxheWVyVG9nZ2xlKGUpIHsKICAgICAgICAgICAgdGhpcy5ncC5wbGF5ZXIudG9nZ2xlKGUpCiAgICAgICAgfSwKICAgICAgICBQbGF5ZXJSZXNldCgpIHsKICAgICAgICAgICAgdGhpcy5ncC5wbGF5ZXIucmVzZXQoKQogICAgICAgIH0sCiAgICAgICAgUGxheWVyUmVtb3ZlKCkgewogICAgICAgICAgICB0aGlzLmdwLnBsYXllci5yZW1vdmUoKQogICAgICAgIH0sCiAgICAgICAgUGxheWVyU3luYyhlID0gITEpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ3AucGxheWVyLnN5bmMoewogICAgICAgICAgICAgICAgb3ZlcnJpZGU6IGUKICAgICAgICAgICAgfSkKICAgICAgICB9LAogICAgICAgIFBsYXllckxvYWQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdwLnBsYXllci5sb2FkKCkKICAgICAgICB9LAogICAgICAgIFBsYXllckxvZ2luKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5ncC5wbGF5ZXIubG9naW4oKQogICAgICAgIH0sCiAgICAgICAgUGxheWVyRmV0Y2hGaWVsZHMoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdwLnBsYXllci5mZXRjaEZpZWxkcygpCiAgICAgICAgfSwKICAgICAgICBQbGF5ZXJXYWl0Rm9yUmVhZHkoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmF3YWl0ZXJzLnBsYXllci5yZWFkeQogICAgICAgIH0sCiAgICAgICAgTGVhZGVyYm9hcmRPcGVuKGUsIHQsIHMsIHIsIGksIGEpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ3AubGVhZGVyYm9hcmQub3Blbih7CiAgICAgICAgICAgICAgICBpZDogdGhpcy5ncC5wbGF5ZXIuaWQsCiAgICAgICAgICAgICAgICBvcmRlckJ5OiBzdG9hcnIoZSksCiAgICAgICAgICAgICAgICBvcmRlcjogMCA9PT0gdCA/ICJERVNDIiA6ICJBU0MiLAogICAgICAgICAgICAgICAgbGltaXQ6IHMsCiAgICAgICAgICAgICAgICB3aXRoTWU6IHRoaXMubWFwcGVycy53aXRoTWVbcl0sCiAgICAgICAgICAgICAgICBpbmNsdWRlRmllbGRzOiBzdG9hcnIoaSksCiAgICAgICAgICAgICAgICBkaXNwbGF5RmllbGRzOiBzdG9hcnIoYSkKICAgICAgICAgICAgfSkuY2F0Y2goZSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZVJlc3VsdCghMSwgZSkKICAgICAgICAgICAgfSkKICAgICAgICB9LAogICAgICAgIExlYWRlcmJvYXJkRmV0Y2godCwgZSwgcywgciwgaSwgYSkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5ncC5sZWFkZXJib2FyZC5mZXRjaCh7CiAgICAgICAgICAgICAgICBpZDogdGhpcy5ncC5wbGF5ZXIuaWQsCiAgICAgICAgICAgICAgICBvcmRlckJ5OiBzdG9hcnIoZSksCiAgICAgICAgICAgICAgICBvcmRlcjogMCA9PT0gcyA/ICJERVNDIiA6ICJBU0MiLAogICAgICAgICAgICAgICAgbGltaXQ6IHIsCiAgICAgICAgICAgICAgICB3aXRoTWU6IHRoaXMubWFwcGVycy53aXRoTWVbaV0sCiAgICAgICAgICAgICAgICBpbmNsdWRlRmllbGRzOiBzdG9hcnIoYSkKICAgICAgICAgICAgfSkudGhlbihlID0+IHsKICAgICAgICAgICAgICAgIHRoaXMubGFzdExlYWRlcmJvYXJkVGFnID0gdCwgdGhpcy5sYXN0TGVhZGVyYm9hcmRWYXJpYW50ID0gImRlZmF1bHQiLCB0aGlzLmxlYWRlcmJvYXJkSW5mbyA9IGUubGVhZGVyYm9hcmQsIHRoaXMubGVhZGVyYm9hcmQgPSBlLnBsYXllcnMsIHRoaXMuaGFuZGxlUmVzdWx0KCEwKSwgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkxlYWRlcmJvYXJkRmV0Y2gpLCB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uTGVhZGVyYm9hcmRBbnlGZXRjaCkKICAgICAgICAgICAgfSkuY2F0Y2goZSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZVJlc3VsdCghMSwgZSksIHRoaXMubGFzdExlYWRlcmJvYXJkVGFnID0gdCwgdGhpcy5sYXN0TGVhZGVyYm9hcmRWYXJpYW50ID0gImRlZmF1bHQiLCB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uTGVhZGVyYm9hcmRGZXRjaEVycm9yKSwgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkxlYWRlcmJvYXJkQW55RmV0Y2hFcnJvcikKICAgICAgICAgICAgfSkKICAgICAgICB9LAogICAgICAgIExlYWRlcmJvYXJkRmV0Y2hQbGF5ZXJSYXRpbmcodCwgZSwgcykgewogICAgICAgICAgICByZXR1cm4gdGhpcy5ncC5sZWFkZXJib2FyZC5mZXRjaFBsYXllclJhdGluZyh7CiAgICAgICAgICAgICAgICBpZDogdGhpcy5ncC5wbGF5ZXIuaWQsCiAgICAgICAgICAgICAgICBvcmRlckJ5OiBzdG9hcnIoZSksCiAgICAgICAgICAgICAgICBvcmRlcjogMCA9PT0gcyA/ICJERVNDIiA6ICJBU0MiCiAgICAgICAgICAgIH0pLnRoZW4oZSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLmxhc3RMZWFkZXJib2FyZFRhZyA9IHQsIHRoaXMubGFzdExlYWRlcmJvYXJkVmFyaWFudCA9ICJkZWZhdWx0IiwgdGhpcy5sYXN0TGVhZGVyYm9hcmRQbGF5ZXJSYXRpbmdUYWcgPSB0LCB0aGlzLmN1cnJlbnRMZWFkZXJib2FyZFBsYXllciA9IE9iamVjdC5hc3NpZ24odGhpcy5ncC5wbGF5ZXIudG9KU09OKCksIGUucGxheWVyKSwgdGhpcy5sZWFkZXJib2FyZFBsYXllclBvc2l0aW9uID0gZS5wbGF5ZXIucG9zaXRpb24sIHRoaXMuaGFuZGxlUmVzdWx0KCEwKSwgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkxlYWRlcmJvYXJkRmV0Y2hQbGF5ZXIpLCB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uTGVhZGVyYm9hcmRBbnlGZXRjaFBsYXllcikKICAgICAgICAgICAgfSkuY2F0Y2goZSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZVJlc3VsdCghMSwgZSksIHRoaXMubGFzdExlYWRlcmJvYXJkVGFnID0gdCwgdGhpcy5sYXN0TGVhZGVyYm9hcmRWYXJpYW50ID0gImRlZmF1bHQiLCB0aGlzLmxhc3RMZWFkZXJib2FyZFBsYXllclJhdGluZ1RhZyA9IHQsIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25MZWFkZXJib2FyZEZldGNoUGxheWVyRXJyb3IpLCB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uTGVhZGVyYm9hcmRBbnlGZXRjaFBsYXllckVycm9yKQogICAgICAgICAgICB9KQogICAgICAgIH0sCiAgICAgICAgTGVhZGVyYm9hcmRPcGVuU2NvcGVkKGUsIHQsIHMsIHIsIGksIGEsIGgpIHsKICAgICAgICAgICAgZSA9IHsKICAgICAgICAgICAgICAgIGlkOiBwYXJzZUludChlLCAxMCkgfHwgMCwKICAgICAgICAgICAgICAgIHRhZzogZSwKICAgICAgICAgICAgICAgIHZhcmlhbnQ6IHQsCiAgICAgICAgICAgICAgICBsaW1pdDogciwKICAgICAgICAgICAgICAgIG9yZGVyOiB0aGlzLm1hcHBlcnMub3JkZXJbc10sCiAgICAgICAgICAgICAgICB3aXRoTWU6IHRoaXMubWFwcGVycy53aXRoTWVbaV0sCiAgICAgICAgICAgICAgICBpbmNsdWRlRmllbGRzOiBzdG9hcnIoYSksCiAgICAgICAgICAgICAgICBkaXNwbGF5RmllbGRzOiBzdG9hcnIoaCkKICAgICAgICAgICAgfTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ3AubGVhZGVyYm9hcmQub3BlblNjb3BlZChlKS5jYXRjaChjb25zb2xlLndhcm4pCiAgICAgICAgfSwKICAgICAgICBMZWFkZXJib2FyZEZldGNoU2NvcGVkKHQsIHMsIGUsIHIsIGksIGEpIHsKICAgICAgICAgICAgciA9IHsKICAgICAgICAgICAgICAgIGlkOiBwYXJzZUludCh0LCAxMCkgfHwgMCwKICAgICAgICAgICAgICAgIHRhZzogdCwKICAgICAgICAgICAgICAgIHZhcmlhbnQ6IHMsCiAgICAgICAgICAgICAgICBsaW1pdDogciwKICAgICAgICAgICAgICAgIG9yZGVyOiB0aGlzLm1hcHBlcnMub3JkZXJbZV0sCiAgICAgICAgICAgICAgICB3aXRoTWU6IHRoaXMubWFwcGVycy53aXRoTWVbaV0sCiAgICAgICAgICAgICAgICBpbmNsdWRlRmllbGRzOiBzdG9hcnIoYSkKICAgICAgICAgICAgfTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ3AubGVhZGVyYm9hcmQuZmV0Y2hTY29wZWQocikudGhlbihlID0+IHsKICAgICAgICAgICAgICAgIHRoaXMubGFzdExlYWRlcmJvYXJkVGFnID0gdCwgdGhpcy5sYXN0TGVhZGVyYm9hcmRWYXJpYW50ID0gcywgdGhpcy5sZWFkZXJib2FyZEluZm8gPSBlLmxlYWRlcmJvYXJkLCB0aGlzLmxlYWRlcmJvYXJkID0gZS5wbGF5ZXJzLCB0aGlzLmhhbmRsZVJlc3VsdCghMCksIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25MZWFkZXJib2FyZEZldGNoKSwgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkxlYWRlcmJvYXJkQW55RmV0Y2gpCiAgICAgICAgICAgIH0pLmNhdGNoKGUgPT4gewogICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVSZXN1bHQoITEsIGUpLCB0aGlzLmxhc3RMZWFkZXJib2FyZFRhZyA9IHQsIHRoaXMubGFzdExlYWRlcmJvYXJkVmFyaWFudCA9IHMsIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25MZWFkZXJib2FyZEZldGNoRXJyb3IpLCB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uTGVhZGVyYm9hcmRBbnlGZXRjaEVycm9yKQogICAgICAgICAgICB9KQogICAgICAgIH0sCiAgICAgICAgTGVhZGVyYm9hcmRGZXRjaFBsYXllclJhdGluZ1Njb3BlZCh0LCBzLCBlKSB7CiAgICAgICAgICAgIGUgPSB7CiAgICAgICAgICAgICAgICBpZDogcGFyc2VJbnQodCwgMTApIHx8IDAsCiAgICAgICAgICAgICAgICB0YWc6IHQsCiAgICAgICAgICAgICAgICB2YXJpYW50OiBzLAogICAgICAgICAgICAgICAgb3JkZXI6IHRoaXMubWFwcGVycy5vcmRlcltlXQogICAgICAgICAgICB9OwogICAgICAgICAgICByZXR1cm4gdGhpcy5ncC5sZWFkZXJib2FyZC5mZXRjaFBsYXllclJhdGluZ1Njb3BlZChlKS50aGVuKGUgPT4gewogICAgICAgICAgICAgICAgdGhpcy5sYXN0TGVhZGVyYm9hcmRQbGF5ZXJSYXRpbmdUYWcgPSB0LCB0aGlzLmxhc3RMZWFkZXJib2FyZFRhZyA9IHQsIHRoaXMubGFzdExlYWRlcmJvYXJkVmFyaWFudCA9IHMsIHRoaXMuY3VycmVudExlYWRlcmJvYXJkUGxheWVyID0gT2JqZWN0LmFzc2lnbih0aGlzLmdwLnBsYXllci50b0pTT04oKSwgZS5wbGF5ZXIpLCB0aGlzLmxlYWRlcmJvYXJkUGxheWVyUG9zaXRpb24gPSBlLnBsYXllci5wb3NpdGlvbiwgdGhpcy5oYW5kbGVSZXN1bHQoITApLCB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uTGVhZGVyYm9hcmRGZXRjaFBsYXllciksIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25MZWFkZXJib2FyZEFueUZldGNoUGxheWVyKQogICAgICAgICAgICB9KS5jYXRjaChlID0+IHsKICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlUmVzdWx0KCExLCBlKSwgdGhpcy5sYXN0TGVhZGVyYm9hcmRQbGF5ZXJSYXRpbmdUYWcgPSB0LCB0aGlzLmxhc3RMZWFkZXJib2FyZFRhZyA9IHQsIHRoaXMubGFzdExlYWRlcmJvYXJkVmFyaWFudCA9IHMsIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25MZWFkZXJib2FyZEZldGNoUGxheWVyRXJyb3IpLCB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uTGVhZGVyYm9hcmRBbnlGZXRjaFBsYXllckVycm9yKQogICAgICAgICAgICB9KQogICAgICAgIH0sCiAgICAgICAgTGVhZGVyYm9hcmRQdWJsaXNoUmVjb3JkKHQsIHMsIGUpIHsKICAgICAgICAgICAgdmFyIHIgPSB0aGlzLmxlYWRlcmJvYXJkUmVjb3Jkc1t0XSwKICAgICAgICAgICAgICAgIHIgPSByID8gcltzXSA6IG51bGwsCiAgICAgICAgICAgICAgICBpID0gcGFyc2VJbnQodCwgMTApIHx8IDA7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdwLmxlYWRlcmJvYXJkLnB1Ymxpc2hSZWNvcmQoewogICAgICAgICAgICAgICAgaWQ6IGksCiAgICAgICAgICAgICAgICB0YWc6IHQsCiAgICAgICAgICAgICAgICB2YXJpYW50OiBzLAogICAgICAgICAgICAgICAgb3ZlcnJpZGU6IGUsCiAgICAgICAgICAgICAgICByZWNvcmQ6IHIKICAgICAgICAgICAgfSkudGhlbihlID0+IHsKICAgICAgICAgICAgICAgIHRoaXMubGFzdExlYWRlcmJvYXJkVGFnID0gdCwgdGhpcy5sYXN0TGVhZGVyYm9hcmRWYXJpYW50ID0gcywgdGhpcy5sYXN0TGVhZGVyYm9hcmRQbGF5ZXJSYXRpbmdUYWcgPSB0LCB0aGlzLmxlYWRlcmJvYXJkUGxheWVyUG9zaXRpb24gPSBlLnBsYXllci5wb3NpdGlvbiwgdGhpcy5jdXJyZW50TGVhZGVyYm9hcmRQbGF5ZXIgPSBPYmplY3QuYXNzaWduKHRoaXMuZ3AucGxheWVyLnRvSlNPTigpLCBlLnBsYXllciksIHRoaXMuaGFuZGxlUmVzdWx0KCEwKSwgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkxlYWRlcmJvYXJkUHVibGlzaFJlY29yZCkKICAgICAgICAgICAgfSkuY2F0Y2goZSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZVJlc3VsdCghMSwgZSksIHRoaXMubGFzdExlYWRlcmJvYXJkVGFnID0gdCwgdGhpcy5sYXN0TGVhZGVyYm9hcmRWYXJpYW50ID0gcywgdGhpcy5sYXN0TGVhZGVyYm9hcmRQbGF5ZXJSYXRpbmdUYWcgPSB0LCB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uTGVhZGVyYm9hcmRQdWJsaXNoUmVjb3JkRXJyb3IpCiAgICAgICAgICAgIH0pCiAgICAgICAgfSwKICAgICAgICBMZWFkZXJib2FyZFNldFJlY29yZChlLCB0LCBzLCByKSB7CiAgICAgICAgICAgIHRoaXMubGVhZGVyYm9hcmRSZWNvcmRzW2VdIHx8ICh0aGlzLmxlYWRlcmJvYXJkUmVjb3Jkc1tlXSA9IHt9KSwgdGhpcy5sZWFkZXJib2FyZFJlY29yZHNbZV1bdF0gfHwgKHRoaXMubGVhZGVyYm9hcmRSZWNvcmRzW2VdW3RdID0ge30pLCB0aGlzLmxlYWRlcmJvYXJkUmVjb3Jkc1tlXVt0XVtzXSA9IHIKICAgICAgICB9LAogICAgICAgIEFjaGlldmVtZW50c09wZW4oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdwLmFjaGlldmVtZW50cy5vcGVuKCkuY2F0Y2goY29uc29sZS53YXJuKQogICAgICAgIH0sCiAgICAgICAgQWNoaWV2ZW1lbnRzRmV0Y2goKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdwLmFjaGlldmVtZW50cy5mZXRjaCgpLnRoZW4oZSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLmFjaGlldmVtZW50cyA9IGUuYWNoaWV2ZW1lbnRzLCB0aGlzLmFjaGlldmVtZW50c0dyb3VwcyA9IGUuYWNoaWV2ZW1lbnRzR3JvdXBzLCB0aGlzLnBsYXllckFjaGlldmVtZW50cyA9IGUucGxheWVyQWNoaWV2ZW1lbnRzLCB0aGlzLmhhbmRsZVJlc3VsdCghMCksIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25BY2hpZXZlbWVudHNGZXRjaCkKICAgICAgICAgICAgfSkuY2F0Y2goZSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZVJlc3VsdCghMSwgZSksIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25BY2hpZXZlbWVudHNGZXRjaEVycm9yKQogICAgICAgICAgICB9KQogICAgICAgIH0sCiAgICAgICAgQWNoaWV2ZW1lbnRzVW5sb2NrKGUpIHsKICAgICAgICAgICAgdmFyIHQgPSBwYXJzZUludChlLCAxMCkgfHwgMDsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ3AuYWNoaWV2ZW1lbnRzLnVubG9jaygwIDwgdCA/IHsKICAgICAgICAgICAgICAgIGlkOiB0CiAgICAgICAgICAgIH0gOiB7CiAgICAgICAgICAgICAgICB0YWc6IGUKICAgICAgICAgICAgfSkudGhlbihlID0+IHsKICAgICAgICAgICAgICAgIHRoaXMuaXNVbmxvY2tBY2hpZXZlbWVudFN1Y2Nlc3MgPSBlLnN1Y2Nlc3MsIHRoaXMudW5sb2NrQWNoaWV2ZW1lbnRFcnJvciA9IGUuZXJyb3IgfHwgIiIsIHRoaXMuaGFuZGxlUmVzdWx0KGUuc3VjY2VzcywgZS5lcnJvcik7CiAgICAgICAgICAgICAgICB2YXIgdCA9IGUuYWNoaWV2ZW1lbnQgfHwge307CiAgICAgICAgICAgICAgICBpZiAodGhpcy5jdXJyZW50QWNoaWV2ZW1lbnRJbmRleCA9IDAsIHRoaXMuY3VycmVudEFjaGlldmVtZW50ID0gdCwgZS5zdWNjZXNzKSByZXR1cm4gdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkFjaGlldmVtZW50c1VubG9jayksIHZvaWQgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkFjaGlldmVtZW50c0FueVVubG9jayk7CiAgICAgICAgICAgICAgICB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uQWNoaWV2ZW1lbnRzQW55VW5sb2NrRXJyb3IpCiAgICAgICAgICAgIH0pLmNhdGNoKGUgPT4gewogICAgICAgICAgICAgICAgdGhpcy5pc1VubG9ja0FjaGlldmVtZW50U3VjY2VzcyA9ICExLCB0aGlzLnVubG9ja0FjaGlldmVtZW50RXJyb3IgPSB0aGlzLmV0b3MoZSksIHRoaXMuaGFuZGxlUmVzdWx0KCExLCBlKSwgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkFjaGlldmVtZW50c0FueVVubG9ja0Vycm9yKQogICAgICAgICAgICB9KQogICAgICAgIH0sCiAgICAgICAgQWNoaWV2ZW1lbnRzU2V0UHJvZ3Jlc3MoZSwgdCkgewogICAgICAgICAgICB0ID0gTnVtYmVyKHQpOwogICAgICAgICAgICB2YXIgcyA9IHBhcnNlSW50KGUsIDEwKSB8fCAwOwogICAgICAgICAgICByZXR1cm4gdGhpcy5ncC5hY2hpZXZlbWVudHMuc2V0UHJvZ3Jlc3MoMCA8IHMgPyB7CiAgICAgICAgICAgICAgICBpZDogcywKICAgICAgICAgICAgICAgIHByb2dyZXNzOiB0CiAgICAgICAgICAgIH0gOiB7CiAgICAgICAgICAgICAgICB0YWc6IGUsCiAgICAgICAgICAgICAgICBwcm9ncmVzczogdAogICAgICAgICAgICB9KS50aGVuKGUgPT4gewogICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVSZXN1bHQoZS5zdWNjZXNzLCBlLmVycm9yKTsKICAgICAgICAgICAgICAgIHZhciB0ID0gZS5hY2hpZXZlbWVudCB8fCB7fTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnRBY2hpZXZlbWVudEluZGV4ID0gMCwgdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnQgPSB0LCBlLnN1Y2Nlc3MpIHJldHVybiB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uQWNoaWV2ZW1lbnRzU2V0UHJvZ3Jlc3MpLCB2b2lkIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25BY2hpZXZlbWVudHNBbnlTZXRQcm9ncmVzcyk7CiAgICAgICAgICAgICAgICB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uQWNoaWV2ZW1lbnRzQW55U2V0UHJvZ3Jlc3NFcnJvcikKICAgICAgICAgICAgfSkuY2F0Y2goZSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZVJlc3VsdCghMSwgZSksIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25BY2hpZXZlbWVudHNBbnlTZXRQcm9ncmVzc0Vycm9yKQogICAgICAgICAgICB9KQogICAgICAgIH0sCiAgICAgICAgUGF5bWVudHNGZXRjaFByb2R1Y3RzKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5ncC5wYXltZW50cy5mZXRjaFByb2R1Y3RzKCkudGhlbihlID0+IHsKICAgICAgICAgICAgICAgIHRoaXMucHJvZHVjdHMgPSBlLnByb2R1Y3RzLCB0aGlzLnBsYXllclB1cmNoYXNlcyA9IGUucGxheWVyUHVyY2hhc2VzLCB0aGlzLmhhbmRsZVJlc3VsdCghMCksIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25QYXltZW50c0ZldGNoUHJvZHVjdHMpCiAgICAgICAgICAgIH0pLmNhdGNoKGUgPT4gewogICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVSZXN1bHQoITEsIGUpLCB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uUGF5bWVudHNGZXRjaFByb2R1Y3RzRXJyb3IpCiAgICAgICAgICAgIH0pCiAgICAgICAgfSwKICAgICAgICBQYXltZW50c1B1cmNoYXNlKGUpIHsKICAgICAgICAgICAgdmFyIHQgPSBwYXJzZUludChlLCAxMCkgfHwgMDsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ3AucGF5bWVudHMucHVyY2hhc2UoMCA8IHQgPyB7CiAgICAgICAgICAgICAgICBpZDogdAogICAgICAgICAgICB9IDogewogICAgICAgICAgICAgICAgdGFnOiBlCiAgICAgICAgICAgIH0pLnRoZW4oZSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLmlzUHVyY2hhc2VQcm9kdWN0U3VjY2VzcyA9IGUuc3VjY2VzcywgdGhpcy5wdXJjaGFzZVByb2R1Y3RFcnJvciA9IGUuZXJyb3IgfHwgIiIsIHRoaXMuaGFuZGxlUmVzdWx0KGUuc3VjY2VzcywgZS5lcnJvcik7CiAgICAgICAgICAgICAgICB2YXIgdCA9IGUucHJvZHVjdCB8fCB7fTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLnB1cmNoYXNlZFByb2R1Y3RJZCA9IHQuaWQgfHwgMCwgdGhpcy5wdXJjaGFzZWRQcm9kdWN0VGFnID0gdC50YWcgfHwgIiIsIGUuc3VjY2VzcykgcmV0dXJuIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25QYXltZW50c1B1cmNoYXNlKSwgdm9pZCB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uUGF5bWVudHNBbnlQdXJjaGFzZSk7CiAgICAgICAgICAgICAgICB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uUGF5bWVudHNQdXJjaGFzZUVycm9yKSwgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PblBheW1lbnRzQW55UHVyY2hhc2VFcnJvcikKICAgICAgICAgICAgfSkuY2F0Y2goZSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLmlzUHVyY2hhc2VQcm9kdWN0U3VjY2VzcyA9ICExLCB0aGlzLnB1cmNoYXNlUHJvZHVjdEVycm9yID0gdGhpcy5ldG9zKGUpLCB0aGlzLmhhbmRsZVJlc3VsdCghMSwgZSksIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25QYXltZW50c1B1cmNoYXNlRXJyb3IpLCB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uUGF5bWVudHNBbnlQdXJjaGFzZUVycm9yKQogICAgICAgICAgICB9KQogICAgICAgIH0sCiAgICAgICAgUGF5bWVudHNDb25zdW1lKGUpIHsKICAgICAgICAgICAgdmFyIHQgPSBwYXJzZUludChlLCAxMCkgfHwgMDsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ3AucGF5bWVudHMuY29uc3VtZSgwIDwgdCA/IHsKICAgICAgICAgICAgICAgIGlkOiB0CiAgICAgICAgICAgIH0gOiB7CiAgICAgICAgICAgICAgICB0YWc6IGUKICAgICAgICAgICAgfSkudGhlbihlID0+IHsKICAgICAgICAgICAgICAgIHRoaXMuaXNDb25zdW1lUHJvZHVjdFN1Y2Nlc3MgPSBlLnN1Y2Nlc3MsIHRoaXMuY29uc3VtZVByb2R1Y3RFcnJvciA9IGUuZXJyb3IgfHwgIiIsIHRoaXMuaGFuZGxlUmVzdWx0KGUuc3VjY2VzcywgZS5lcnJvcik7CiAgICAgICAgICAgICAgICB2YXIgdCA9IGUucHJvZHVjdCB8fCB7fTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmNvbnN1bWVkUHJvZHVjdElkID0gdC5pZCB8fCAwLCB0aGlzLmNvbnN1bWVkUHJvZHVjdFRhZyA9IHQudGFnIHx8ICIiLCBlLnN1Y2Nlc3MpIHJldHVybiB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uUGF5bWVudHNDb25zdW1lKSwgdm9pZCB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uUGF5bWVudHNBbnlDb25zdW1lKTsKICAgICAgICAgICAgICAgIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25QYXltZW50c0NvbnN1bWVFcnJvciksIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25QYXltZW50c0FueUNvbnN1bWVFcnJvcikKICAgICAgICAgICAgfSkuY2F0Y2goZSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLmlzQ29uc3VtZVByb2R1Y3RTdWNjZXNzID0gITEsIHRoaXMuY29uc3VtZVByb2R1Y3RFcnJvciA9IHRoaXMuZXRvcyhlKSwgdGhpcy5oYW5kbGVSZXN1bHQoITEsIGUpLCB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uUGF5bWVudHNDb25zdW1lRXJyb3IpLCB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uUGF5bWVudHNBbnlDb25zdW1lRXJyb3IpCiAgICAgICAgICAgIH0pCiAgICAgICAgfSwKICAgICAgICBQYXltZW50c1N1YnNjcmliZShlKSB7CiAgICAgICAgICAgIHZhciB0ID0gcGFyc2VJbnQoZSwgMTApIHx8IDA7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdwLnBheW1lbnRzLnN1YnNjcmliZSgwIDwgdCA/IHsKICAgICAgICAgICAgICAgIGlkOiB0CiAgICAgICAgICAgIH0gOiB7CiAgICAgICAgICAgICAgICB0YWc6IGUKICAgICAgICAgICAgfSkudGhlbihlID0+IHsKICAgICAgICAgICAgICAgIHRoaXMuaXNTdWJzY3JpYmVQcm9kdWN0U3VjY2VzcyA9IGUuc3VjY2VzcywgdGhpcy5oYW5kbGVSZXN1bHQoZS5zdWNjZXNzLCBlLmVycm9yKTsKICAgICAgICAgICAgICAgIHZhciB0ID0gZS5wcm9kdWN0IHx8IHt9LAogICAgICAgICAgICAgICAgICAgIHMgPSBlLnB1cmNoYXNlIHx8IHt9OwogICAgICAgICAgICAgICAgaWYgKHRoaXMuY3VycmVudFB1cmNoYXNlID0gcywgdGhpcy5jdXJyZW50UHJvZHVjdCA9IHQsIHRoaXMuY3VycmVudFByb2R1Y3RQdXJjaGFzZXMgPSAxLCB0aGlzLnB1cmNoYXNlZFByb2R1Y3RJZCA9IHQuaWQgfHwgMCwgdGhpcy5wdXJjaGFzZWRQcm9kdWN0VGFnID0gdC50YWcgfHwgIiIsIGUuc3VjY2VzcykgcmV0dXJuIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25QYXltZW50c1N1YnNjcmliZSksIHZvaWQgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PblBheW1lbnRzQW55U3Vic2NyaWJlKTsKICAgICAgICAgICAgICAgIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25QYXltZW50c1N1YnNjcmliZUVycm9yKSwgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PblBheW1lbnRzQW55U3Vic2NyaWJlRXJyb3IpCiAgICAgICAgICAgIH0pLmNhdGNoKGUgPT4gewogICAgICAgICAgICAgICAgdGhpcy5pc1N1YnNjcmliZVByb2R1Y3RTdWNjZXNzID0gITEsIHRoaXMuaGFuZGxlUmVzdWx0KCExLCBlKSwgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PblBheW1lbnRzU3Vic2NyaWJlRXJyb3IpLCB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uUGF5bWVudHNBbnlTdWJzY3JpYmVFcnJvcikKICAgICAgICAgICAgfSkKICAgICAgICB9LAogICAgICAgIFBheW1lbnRzVW5zdWJzY3JpYmUoZSkgewogICAgICAgICAgICB2YXIgdCA9IHBhcnNlSW50KGUsIDEwKSB8fCAwOwogICAgICAgICAgICByZXR1cm4gdGhpcy5ncC5wYXltZW50cy51bnN1YnNjcmliZSgwIDwgdCA/IHsKICAgICAgICAgICAgICAgIGlkOiB0CiAgICAgICAgICAgIH0gOiB7CiAgICAgICAgICAgICAgICB0YWc6IGUKICAgICAgICAgICAgfSkudGhlbihlID0+IHsKICAgICAgICAgICAgICAgIHRoaXMuaXNVbnN1YnNjcmliZVByb2R1Y3RTdWNjZXNzID0gZS5zdWNjZXNzLCB0aGlzLmhhbmRsZVJlc3VsdChlLnN1Y2Nlc3MsIGUuZXJyb3IpOwogICAgICAgICAgICAgICAgdmFyIHQgPSBlLnByb2R1Y3QgfHwge30sCiAgICAgICAgICAgICAgICAgICAgcyA9IGUucHVyY2hhc2UgfHwge307CiAgICAgICAgICAgICAgICBpZiAodGhpcy5jdXJyZW50UHVyY2hhc2UgPSBzLCB0aGlzLmN1cnJlbnRQcm9kdWN0ID0gdCwgdGhpcy5jdXJyZW50UHJvZHVjdFB1cmNoYXNlcyA9IDEsIHRoaXMucHVyY2hhc2VkUHJvZHVjdElkID0gdC5pZCB8fCAwLCB0aGlzLnB1cmNoYXNlZFByb2R1Y3RUYWcgPSB0LnRhZyB8fCAiIiwgZS5zdWNjZXNzKSByZXR1cm4gdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PblBheW1lbnRzVW5zdWJzY3JpYmUpLCB2b2lkIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25QYXltZW50c0FueVVuc3Vic2NyaWJlKTsKICAgICAgICAgICAgICAgIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25QYXltZW50c1Vuc3Vic2NyaWJlRXJyb3IpLCB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uUGF5bWVudHNBbnlVbnN1YnNjcmliZUVycm9yKQogICAgICAgICAgICB9KS5jYXRjaChlID0+IHsKICAgICAgICAgICAgICAgIHRoaXMuaXNVbnN1YnNjcmliZVByb2R1Y3RTdWNjZXNzID0gITEsIHRoaXMuaGFuZGxlUmVzdWx0KCExLCBlKSwgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PblBheW1lbnRzVW5zdWJzY3JpYmVFcnJvciksIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25QYXltZW50c0FueVN1YnNjcmliZUVycm9yKQogICAgICAgICAgICB9KQogICAgICAgIH0sCiAgICAgICAgSW1hZ2VzRmV0Y2goZSwgdCwgcywgcikgewogICAgICAgICAgICByZXR1cm4gdGhpcy5ncC5pbWFnZXMuZmV0Y2goewogICAgICAgICAgICAgICAgcGxheWVySWQ6IHQsCiAgICAgICAgICAgICAgICBsaW1pdDogcywKICAgICAgICAgICAgICAgIG9mZnNldDogciwKICAgICAgICAgICAgICAgIHRhZ3M6IHN0b2FycihlKQogICAgICAgICAgICB9KS50aGVuKGUgPT4gewogICAgICAgICAgICAgICAgdGhpcy5pbWFnZXMgPSBlLml0ZW1zLCB0aGlzLmNhbkxvYWRNb3JlSW1hZ2VzID0gZS5jYW5Mb2FkTW9yZSwgdGhpcy5oYW5kbGVSZXN1bHQoITApLCB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uSW1hZ2VzRmV0Y2gpCiAgICAgICAgICAgIH0pLmNhdGNoKGUgPT4gewogICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVSZXN1bHQoITEsIGUpLCB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uSW1hZ2VzRmV0Y2hFcnJvcikKICAgICAgICAgICAgfSkKICAgICAgICB9LAogICAgICAgIEltYWdlc0ZldGNoTW9yZShlLCB0LCBzKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdwLmltYWdlcy5mZXRjaE1vcmUoewogICAgICAgICAgICAgICAgcGxheWVySWQ6IHQsCiAgICAgICAgICAgICAgICBsaW1pdDogcywKICAgICAgICAgICAgICAgIHRhZ3M6IHN0b2FycihlKQogICAgICAgICAgICB9KS50aGVuKGUgPT4gewogICAgICAgICAgICAgICAgdGhpcy5pbWFnZXMgPSBlLml0ZW1zLCB0aGlzLmNhbkxvYWRNb3JlSW1hZ2VzID0gZS5jYW5Mb2FkTW9yZSwgdGhpcy5oYW5kbGVSZXN1bHQoITApLCB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uSW1hZ2VzRmV0Y2hNb3JlKQogICAgICAgICAgICB9KS5jYXRjaChlID0+IHsKICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlUmVzdWx0KCExLCBlKSwgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkltYWdlc0ZldGNoTW9yZUVycm9yKQogICAgICAgICAgICB9KQogICAgICAgIH0sCiAgICAgICAgSW1hZ2VzVXBsb2FkKGUpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ3AuaW1hZ2VzLnVwbG9hZCh7CiAgICAgICAgICAgICAgICB0YWdzOiBzdG9hcnIoZSkKICAgICAgICAgICAgfSkudGhlbihlID0+IHsKICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudEltYWdlID0gZSB8fCB7fSwgdGhpcy5oYW5kbGVSZXN1bHQoITApLCB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uSW1hZ2VzVXBsb2FkKQogICAgICAgICAgICB9KS5jYXRjaChlID0+IHsKICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlUmVzdWx0KCExLCBlKSwgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkltYWdlc1VwbG9hZEVycm9yKQogICAgICAgICAgICB9KQogICAgICAgIH0sCiAgICAgICAgSW1hZ2VzVXBsb2FkVXJsKGUsIHQpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ3AuaW1hZ2VzLnVwbG9hZFVybCh7CiAgICAgICAgICAgICAgICB1cmw6IGUsCiAgICAgICAgICAgICAgICB0YWdzOiBzdG9hcnIodCkKICAgICAgICAgICAgfSkudGhlbihlID0+IHsKICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudEltYWdlID0gZSB8fCB7fSwgdGhpcy5oYW5kbGVSZXN1bHQoITApLCB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uSW1hZ2VzVXBsb2FkKQogICAgICAgICAgICB9KS5jYXRjaChlID0+IHsKICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlUmVzdWx0KCExLCBlKSwgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkltYWdlc1VwbG9hZEVycm9yKQogICAgICAgICAgICB9KQogICAgICAgIH0sCiAgICAgICAgSW1hZ2VzQ2hvb3NlRmlsZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ3AuaW1hZ2VzLmNob29zZUZpbGUoKS50aGVuKGUgPT4gewogICAgICAgICAgICAgICAgdGhpcy5sYXN0SW1hZ2VUZW1wVXJsID0gZS50ZW1wVXJsLCB0aGlzLmhhbmRsZVJlc3VsdCghMCksIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25JbWFnZXNDaG9vc2UpCiAgICAgICAgICAgIH0pLmNhdGNoKGUgPT4gewogICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVSZXN1bHQoITEsIGUpLCB0aGlzLmxhc3RJbWFnZVRlbXBVcmwgPSAiIiwgdGhpcy5pc0xhc3RBY3Rpb25TdWNjZXNzID0gITEsIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25JbWFnZXNDaG9vc2VFcnJvcikKICAgICAgICAgICAgfSkKICAgICAgICB9LAogICAgICAgIEZpbGVzRmV0Y2goZSwgdCwgcywgcikgewogICAgICAgICAgICByZXR1cm4gdGhpcy5ncC5maWxlcy5mZXRjaCh7CiAgICAgICAgICAgICAgICBwbGF5ZXJJZDogdCwKICAgICAgICAgICAgICAgIGxpbWl0OiBzLAogICAgICAgICAgICAgICAgb2Zmc2V0OiByLAogICAgICAgICAgICAgICAgdGFnczogc3RvYXJyKGUpCiAgICAgICAgICAgIH0pLnRoZW4oZSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLmZpbGVzID0gZS5pdGVtcywgdGhpcy5jYW5Mb2FkTW9yZUZpbGVzID0gZS5jYW5Mb2FkTW9yZSwgdGhpcy5oYW5kbGVSZXN1bHQoITApLCB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uRmlsZXNGZXRjaCkKICAgICAgICAgICAgfSkuY2F0Y2goZSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZVJlc3VsdCghMSwgZSksIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25GaWxlc0ZldGNoRXJyb3IpCiAgICAgICAgICAgIH0pCiAgICAgICAgfSwKICAgICAgICBGaWxlc0ZldGNoTW9yZShlLCB0LCBzKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdwLmZpbGVzLmZldGNoTW9yZSh7CiAgICAgICAgICAgICAgICBwbGF5ZXJJZDogdCwKICAgICAgICAgICAgICAgIGxpbWl0OiBzLAogICAgICAgICAgICAgICAgdGFnczogc3RvYXJyKGUpCiAgICAgICAgICAgIH0pLnRoZW4oZSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLmZpbGVzID0gZS5pdGVtcywgdGhpcy5jYW5Mb2FkTW9yZUZpbGVzID0gZS5jYW5Mb2FkTW9yZSwgdGhpcy5oYW5kbGVSZXN1bHQoITApLCB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uRmlsZXNGZXRjaE1vcmUpCiAgICAgICAgICAgIH0pLmNhdGNoKGUgPT4gewogICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVSZXN1bHQoITEsIGUpLCB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uRmlsZXNGZXRjaE1vcmVFcnJvcikKICAgICAgICAgICAgfSkKICAgICAgICB9LAogICAgICAgIEZpbGVzVXBsb2FkKGUpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ3AuZmlsZXMudXBsb2FkKHsKICAgICAgICAgICAgICAgIHRhZ3M6IHN0b2FycihlKQogICAgICAgICAgICB9KS50aGVuKGUgPT4gewogICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50RmlsZSA9IGUgfHwge30sIHRoaXMuaGFuZGxlUmVzdWx0KCEwKSwgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkZpbGVzVXBsb2FkKQogICAgICAgICAgICB9KS5jYXRjaChlID0+IHsKICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlUmVzdWx0KCExLCBlKSwgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkZpbGVzVXBsb2FkRXJyb3IpCiAgICAgICAgICAgIH0pCiAgICAgICAgfSwKICAgICAgICBGaWxlc1VwbG9hZFVybChlLCB0LCBzKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdwLmZpbGVzLnVwbG9hZFVybCh7CiAgICAgICAgICAgICAgICB1cmw6IGUsCiAgICAgICAgICAgICAgICBmaWxlbmFtZTogdCwKICAgICAgICAgICAgICAgIHRhZ3M6IHN0b2FycihzKQogICAgICAgICAgICB9KS50aGVuKGUgPT4gewogICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50RmlsZSA9IGUgfHwge30sIHRoaXMuaGFuZGxlUmVzdWx0KCEwKSwgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkZpbGVzVXBsb2FkKQogICAgICAgICAgICB9KS5jYXRjaChlID0+IHsKICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlUmVzdWx0KCExLCBlKSwgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkZpbGVzVXBsb2FkRXJyb3IpCiAgICAgICAgICAgIH0pCiAgICAgICAgfSwKICAgICAgICBGaWxlc1VwbG9hZENvbnRlbnQoZSwgdCwgcykgewogICAgICAgICAgICByZXR1cm4gdGhpcy5ncC5maWxlcy51cGxvYWRDb250ZW50KHsKICAgICAgICAgICAgICAgIGNvbnRlbnQ6IGUsCiAgICAgICAgICAgICAgICBmaWxlbmFtZTogdCwKICAgICAgICAgICAgICAgIHRhZ3M6IHN0b2FycihzKQogICAgICAgICAgICB9KS50aGVuKGUgPT4gewogICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50RmlsZSA9IGUgfHwge30sIHRoaXMuaGFuZGxlUmVzdWx0KCEwKSwgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkZpbGVzVXBsb2FkKQogICAgICAgICAgICB9KS5jYXRjaChlID0+IHsKICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlUmVzdWx0KCExLCBlKSwgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkZpbGVzVXBsb2FkRXJyb3IpCiAgICAgICAgICAgIH0pCiAgICAgICAgfSwKICAgICAgICBGaWxlc0xvYWRDb250ZW50KGUpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ3AuZmlsZXMubG9hZENvbnRlbnQoZSkudGhlbihlID0+IHsKICAgICAgICAgICAgICAgIHRoaXMubGFzdEZpbGVDb250ZW50ID0gZSwgdGhpcy5oYW5kbGVSZXN1bHQoITApLCB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uRmlsZXNMb2FkQ29udGVudCkKICAgICAgICAgICAgfSkuY2F0Y2goZSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLmxhc3RGaWxlQ29udGVudCA9ICIiLCB0aGlzLmhhbmRsZVJlc3VsdCghMSwgZSksIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25GaWxlc0xvYWRDb250ZW50RXJyb3IpCiAgICAgICAgICAgIH0pCiAgICAgICAgfSwKICAgICAgICBGaWxlc0Nob29zZUZpbGUoZSkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5ncC5maWxlcy5jaG9vc2VGaWxlKGUpLnRoZW4oZSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLmxhc3RGaWxlVGVtcFVybCA9IGUudGVtcFVybCwgdGhpcy5oYW5kbGVSZXN1bHQoITApLCB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uRmlsZXNDaG9vc2UpCiAgICAgICAgICAgIH0pLmNhdGNoKGUgPT4gewogICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVSZXN1bHQoITEsIGUpLCB0aGlzLmxhc3RGaWxlVGVtcFVybCA9ICIiLCB0aGlzLmlzTGFzdEFjdGlvblN1Y2Nlc3MgPSAhMSwgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkZpbGVzQ2hvb3NlRXJyb3IpCiAgICAgICAgICAgIH0pCiAgICAgICAgfSwKICAgICAgICBWYXJpYWJsZXNGZXRjaCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ3AudmFyaWFibGVzLmZldGNoKCkudGhlbigoKSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZVJlc3VsdCghMCksIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25WYXJpYWJsZXNGZXRjaCkKICAgICAgICAgICAgfSkuY2F0Y2goZSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZVJlc3VsdCghMSwgZSksIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25WYXJpYWJsZXNGZXRjaEVycm9yKQogICAgICAgICAgICB9KQogICAgICAgIH0sCiAgICAgICAgRnVsbHNjcmVlbk9wZW4oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdwLmZ1bGxzY3JlZW4ub3BlbigpCiAgICAgICAgfSwKICAgICAgICBGdWxsc2NyZWVuQ2xvc2UoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdwLmZ1bGxzY3JlZW4uY2xvc2UoKQogICAgICAgIH0sCiAgICAgICAgRnVsbHNjcmVlblRvZ2dsZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ3AuZnVsbHNjcmVlbi50b2dnbGUoKQogICAgICAgIH0sCiAgICAgICAgQWRzU2hvd0Z1bGxzY3JlZW4oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdwLmFkcy5zaG93RnVsbHNjcmVlbigpCiAgICAgICAgfSwKICAgICAgICBBZHNTaG93UmV3YXJkZWQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdwLmFkcy5zaG93UmV3YXJkZWRWaWRlbygpCiAgICAgICAgfSwKICAgICAgICBBZHNTaG93UHJlbG9hZGVyKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5ncC5hZHMuc2hvd1ByZWxvYWRlcigpCiAgICAgICAgfSwKICAgICAgICBBZHNTaG93U3RpY2t5KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5ncC5hZHMuc2hvd1N0aWNreSgpCiAgICAgICAgfSwKICAgICAgICBBZHNDbG9zZVN0aWNreSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ3AuYWRzLmNsb3NlU3RpY2t5KCkKICAgICAgICB9LAogICAgICAgIEFkc1JlZnJlc2hTdGlja3koKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdwLmFkcy5yZWZyZXNoU3RpY2t5KCkKICAgICAgICB9LAogICAgICAgIEFuYWx5dGljc0hpdChlKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdwLmFuYWx5dGljcy5oaXQoZSkKICAgICAgICB9LAogICAgICAgIEFuYWx5dGljc0dvYWwoZSwgdCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5ncC5hbmFseXRpY3MuZ29hbChlLCB0KQogICAgICAgIH0sCiAgICAgICAgU29jaWFsc1NoYXJlKGUsIHQsIHMpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ3Auc29jaWFscy5zaGFyZSh7CiAgICAgICAgICAgICAgICB0ZXh0OiBlLAogICAgICAgICAgICAgICAgdXJsOiB0LAogICAgICAgICAgICAgICAgaW1hZ2U6IHMKICAgICAgICAgICAgfSkKICAgICAgICB9LAogICAgICAgIFNvY2lhbHNQb3N0KGUsIHQsIHMpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ3Auc29jaWFscy5wb3N0KHsKICAgICAgICAgICAgICAgIHRleHQ6IGUsCiAgICAgICAgICAgICAgICB1cmw6IHQsCiAgICAgICAgICAgICAgICBpbWFnZTogcwogICAgICAgICAgICB9KQogICAgICAgIH0sCiAgICAgICAgU29jaWFsc0ludml0ZShlLCB0LCBzKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdwLnNvY2lhbHMuaW52aXRlKHsKICAgICAgICAgICAgICAgIHRleHQ6IGUsCiAgICAgICAgICAgICAgICB1cmw6IHQsCiAgICAgICAgICAgICAgICBpbWFnZTogcwogICAgICAgICAgICB9KQogICAgICAgIH0sCiAgICAgICAgU29jaWFsc0pvaW5Db21tdW5pdHkoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdwLnNvY2lhbHMuam9pbkNvbW11bml0eSgpCiAgICAgICAgfSwKICAgICAgICBHYW1lc0NvbGxlY3Rpb25zT3BlbihlKSB7CiAgICAgICAgICAgIHZhciB0ID0gcGFyc2VJbnQoZSwgMTApIHx8IDA7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdwLmdhbWVzQ29sbGVjdGlvbnMub3BlbigwIDwgdCA/IHsKICAgICAgICAgICAgICAgIGlkOiB0CiAgICAgICAgICAgIH0gOiB7CiAgICAgICAgICAgICAgICB0YWc6IGUgfHwgIkFOWSIKICAgICAgICAgICAgfSkKICAgICAgICB9LAogICAgICAgIEdhbWVzQ29sbGVjdGlvbnNGZXRjaCh0KSB7CiAgICAgICAgICAgIHZhciBlID0gcGFyc2VJbnQodCwgMTApIHx8IDA7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdwLmdhbWVzQ29sbGVjdGlvbnMuZmV0Y2goMCA8IGUgPyB7CiAgICAgICAgICAgICAgICBpZDogZQogICAgICAgICAgICB9IDogewogICAgICAgICAgICAgICAgdGFnOiB0CiAgICAgICAgICAgIH0pLnRoZW4oZSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLmxhc3RHYW1lc0NvbGxlY3Rpb25JZE9yVGFnID0gdCwgdGhpcy5nYW1lc0NvbGxlY3Rpb24gPSBlLCB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uR2FtZXNDb2xsZWN0aW9uc0ZldGNoKSwgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkdhbWVzQ29sbGVjdGlvbnNGZXRjaEFueSkKICAgICAgICAgICAgfSkuY2F0Y2goZSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZVJlc3VsdCghMSwgZSksIHRoaXMubGFzdEdhbWVzQ29sbGVjdGlvbklkT3JUYWcgPSB0LCB0aGlzLmdhbWVzQ29sbGVjdGlvbkZldGNoRXJyb3IgPSBlICYmIGUubWVzc2FnZSB8fCAiIiwgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkdhbWVzQ29sbGVjdGlvbnNGZXRjaEVycm9yKSwgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkdhbWVzQ29sbGVjdGlvbnNGZXRjaEFueUVycm9yKQogICAgICAgICAgICB9KQogICAgICAgIH0sCiAgICAgICAgRG9jdW1lbnRzT3BlbihlKSB7CiAgICAgICAgICAgIGUgPSB0aGlzLm1hcHBlcnMuZG9jdW1lbnRUeXBlc1tlXTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ3AuZG9jdW1lbnRzLm9wZW4oewogICAgICAgICAgICAgICAgdHlwZTogZQogICAgICAgICAgICB9KQogICAgICAgIH0sCiAgICAgICAgRG9jdW1lbnRzRmV0Y2goZSwgdCkgewogICAgICAgICAgICBjb25zdCBzID0gdGhpcy5tYXBwZXJzLmRvY3VtZW50VHlwZXNbZV07CiAgICAgICAgICAgIGUgPSB0aGlzLm1hcHBlcnMuZG9jdW1lbnRGb3JtYXRbdF07CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdwLmRvY3VtZW50cy5mZXRjaCh7CiAgICAgICAgICAgICAgICB0eXBlOiBzLAogICAgICAgICAgICAgICAgZm9ybWF0OiBlCiAgICAgICAgICAgIH0pLnRoZW4oZSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLmxhc3REb2N1bWVudFR5cGUgPSBzLCB0aGlzLmRvY3VtZW50ID0gZSwgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkRvY3VtZW50c0ZldGNoKSwgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkRvY3VtZW50c0ZldGNoQW55KQogICAgICAgICAgICB9KS5jYXRjaChlID0+IHsKICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlUmVzdWx0KCExLCBlKSwgdGhpcy5kb2N1bWVudEZldGNoRXJyb3IgPSB0aGlzLmV0b3MoZSksIHRoaXMubGFzdERvY3VtZW50VHlwZSA9IHMsIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25Eb2N1bWVudHNGZXRjaEVycm9yKSwgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkRvY3VtZW50c0ZldGNoQW55RXJyb3IpCiAgICAgICAgICAgIH0pCiAgICAgICAgfSwKICAgICAgICBQbGF5ZXJzRmV0Y2godCwgZSkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5ncC5wbGF5ZXJzLmZldGNoKHsKICAgICAgICAgICAgICAgIGlkczogc3RvYXJyKGUsIE51bWJlcikKICAgICAgICAgICAgfSkudGhlbihlID0+IHsKICAgICAgICAgICAgICAgIHRoaXMubGFzdFBsYXllcnNUYWcgPSB0LCB0aGlzLnBsYXllcnNMaXN0ID0gZS5wbGF5ZXJzLCB0aGlzLmhhbmRsZVJlc3VsdCghMCksIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25QbGF5ZXJzRmV0Y2gpLCB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uUGxheWVyc0FueUZldGNoKQogICAgICAgICAgICB9KS5jYXRjaChlID0+IHsKICAgICAgICAgICAgICAgIHRoaXMubGFzdFBsYXllcnNUYWcgPSB0LCB0aGlzLmhhbmRsZVJlc3VsdCghMSwgZSksIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25QbGF5ZXJzRmV0Y2hFcnJvciksIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25QbGF5ZXJzQW55RmV0Y2hFcnJvcikKICAgICAgICAgICAgfSkKICAgICAgICB9LAogICAgICAgIFBsYXllcnNGZXRjaE9uZSh0LCBlKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdwLnBsYXllcnMuZmV0Y2goewogICAgICAgICAgICAgICAgaWRzOiBbTnVtYmVyKGUpXQogICAgICAgICAgICB9KS50aGVuKGUgPT4gewogICAgICAgICAgICAgICAgdGhpcy5sYXN0UGxheWVyc1RhZyA9IHQsIGUucGxheWVyc1swXSA/ICh0aGlzLnBsYXllcnNMaXN0ID0gZS5wbGF5ZXJzLCB0aGlzLmN1cnJlbnRQbGF5ZXJzSW5kZXggPSAwLCB0aGlzLmN1cnJlbnRQbGF5ZXJzUGxheWVyID0gZS5wbGF5ZXJzWzBdLCB0aGlzLmhhbmRsZVJlc3VsdCghMCksIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25QbGF5ZXJzRmV0Y2gpLCB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uUGxheWVyc0FueUZldGNoKSkgOiAodGhpcy5oYW5kbGVSZXN1bHQoITEsIG5ldyBFcnJvcigicGxheWVyX25vdF9mb3VuZCIpKSwgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PblBsYXllcnNGZXRjaEVycm9yKSwgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PblBsYXllcnNBbnlGZXRjaEVycm9yKSkKICAgICAgICAgICAgfSkuY2F0Y2goZSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLmxhc3RQbGF5ZXJzVGFnID0gdCwgdGhpcy5oYW5kbGVSZXN1bHQoITEsIGUpLCB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uUGxheWVyc0ZldGNoRXJyb3IpLCB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uUGxheWVyc0FueUZldGNoRXJyb3IpCiAgICAgICAgICAgIH0pCiAgICAgICAgfSwKICAgICAgICBBcHBBZGRTaG9ydGN1dCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ3AuYXBwLmFkZFNob3J0Y3V0KCkKICAgICAgICB9LAogICAgICAgIENoYW5nZUxhbmd1YWdlKGUpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ3AuY2hhbmdlTGFuZ3VhZ2UodGhpcy5tYXBwZXJzLmxhbmd1YWdlW2VdKQogICAgICAgIH0sCiAgICAgICAgQ2hhbmdlTGFuZ3VhZ2VCeUNvZGUoZSA9ICIiKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdwLmNoYW5nZUxhbmd1YWdlKGUudG9Mb3dlckNhc2UoKSkKICAgICAgICB9LAogICAgICAgIENoYW5nZUF2YXRhckdlbmVyYXRvcihlKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdwLmNoYW5nZUF2YXRhckdlbmVyYXRvcih0aGlzLm1hcHBlcnMuYXZhdGFyR2VuZXJhdG9yW2VdKQogICAgICAgIH0sCiAgICAgICAgU2V0QmFja2dyb3VuZChlLCB0LCBzKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdwLnNldEJhY2tncm91bmQoewogICAgICAgICAgICAgICAgdXJsOiBlLAogICAgICAgICAgICAgICAgYmx1cjogdCwKICAgICAgICAgICAgICAgIGZhZGU6IHMKICAgICAgICAgICAgfSkKICAgICAgICB9LAogICAgICAgIExvYWRPdmVybGF5KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5ncC5sb2FkT3ZlcmxheSgpCiAgICAgICAgfSwKICAgICAgICBQYXVzZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ3AucGF1c2UoKQogICAgICAgIH0sCiAgICAgICAgUmVzdW1lKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5ncC5yZXN1bWUoKQogICAgICAgIH0sCiAgICAgICAgR2FtZXBsYXlTdGFydCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ3AuZ2FtZXBsYXlTdGFydCgpCiAgICAgICAgfSwKICAgICAgICBHYW1lcGxheVN0b3AoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdwLmdhbWVwbGF5U3RvcCgpCiAgICAgICAgfSwKICAgICAgICBTb2NpYWxzQWRkU2hhcmVVcmxQYXJhbShlLCB0KSB7CiAgICAgICAgICAgIHRoaXMuc2hhcmVQYXJhbXNbZV0gPSB0LCB0aGlzLnNoYXJlTGluayA9IHRoaXMuZ3Auc29jaWFscy5tYWtlU2hhcmVVcmwodGhpcy5zaGFyZVBhcmFtcykKICAgICAgICB9LAogICAgICAgIFNvY2lhbHNSZXNldFNoYXJlUGFyYW1zKCkgewogICAgICAgICAgICB0aGlzLnNoYXJlUGFyYW1zID0ge30sIHRoaXMuc2hhcmVMaW5rID0gdGhpcy5ncC5zb2NpYWxzLm1ha2VTaGFyZVVybCh0aGlzLnNoYXJlUGFyYW1zKQogICAgICAgIH0sCiAgICAgICAgTG9hZEZyb21KU09OKGUpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHZhciB0ID0gSlNPTi5wYXJzZShlKTsKICAgICAgICAgICAgICAgIGlmICghKCJpc1JlYWR5IiBpbiB0KSkgdGhyb3cgbmV3IEVycm9yKCJEYXRhIHdhcyBjb3JydXB0ZWQiKTsKICAgICAgICAgICAgICAgIHRoaXMuTG9hZEZyb21Kc29uKHQpCiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25Mb2FkSnNvbkVycm9yKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKfQoKewogICAgInVzZSBzdHJpY3QiOwogICAgQzMuUGx1Z2lucy5FcG9uZXNoX0dhbWVTY29yZS5FeHBzID0gewogICAgICAgIFBsYXllcklEKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5ncC5wbGF5ZXIuaWQKICAgICAgICB9LAogICAgICAgIFBsYXllclNjb3JlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5ncC5wbGF5ZXIuc2NvcmUKICAgICAgICB9LAogICAgICAgIFBsYXllck5hbWUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdwLnBsYXllci5uYW1lCiAgICAgICAgfSwKICAgICAgICBQbGF5ZXJBdmF0YXIoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdwLnBsYXllci5hdmF0YXIKICAgICAgICB9LAogICAgICAgIFBsYXllckdldChlKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdwLnBsYXllci5nZXQoZSkKICAgICAgICB9LAogICAgICAgIFBsYXllckhhcyhlKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdwLnBsYXllci5pcyhlKQogICAgICAgIH0sCiAgICAgICAgUGxheWVyRmllbGROYW1lKGUpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ3AucGxheWVyLmdldEZpZWxkTmFtZShlKQogICAgICAgIH0sCiAgICAgICAgUGxheWVyRmllbGRWYXJpYW50TmFtZShlLCByKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdwLnBsYXllci5nZXRGaWVsZFZhcmlhbnROYW1lKGUsIHIpCiAgICAgICAgfSwKICAgICAgICBQbGF5ZXJHZXRGaWVsZFZhcmlhbnRBdChlLCByKSB7CiAgICAgICAgICAgIGUgPSB0aGlzLmdwLnBsYXllci5nZXRGaWVsZChlKS52YXJpYW50c1tyXTsKICAgICAgICAgICAgcmV0dXJuIGUgPyBlLnZhbHVlIDogIiIKICAgICAgICB9LAogICAgICAgIFBsYXllckdldEZpZWxkVmFyaWFudEluZGV4KGUsIHIpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ3AucGxheWVyLmdldEZpZWxkKGUpLnZhcmlhbnRzLmZpbmRJbmRleChlID0+IGUudmFsdWUgPT09IHIpCiAgICAgICAgfSwKICAgICAgICBQbGF5ZXJDdXJGaWVsZEtleSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudFBsYXllckZpZWxkS2V5IHx8ICIiCiAgICAgICAgfSwKICAgICAgICBQbGF5ZXJDdXJGaWVsZFR5cGUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRQbGF5ZXJGaWVsZFR5cGUgfHwgIiIKICAgICAgICB9LAogICAgICAgIFBsYXllckN1ckZpZWxkTmFtZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudFBsYXllckZpZWxkTmFtZSB8fCAiIgogICAgICAgIH0sCiAgICAgICAgUGxheWVyQ3VyRmllbGRWYWx1ZSgpIHsKICAgICAgICAgICAgcmV0dXJuICJzdHJpbmciID09IHR5cGVvZiB0aGlzLmN1cnJlbnRQbGF5ZXJGaWVsZFZhbHVlID8gdGhpcy5jdXJyZW50UGxheWVyRmllbGRWYWx1ZSA6IE51bWJlcih0aGlzLmN1cnJlbnRQbGF5ZXJGaWVsZFZhbHVlIHx8IDApCiAgICAgICAgfSwKICAgICAgICBQbGF5ZXJDdXJGaWVsZFZhcmlhbnRWYWx1ZSgpIHsKICAgICAgICAgICAgcmV0dXJuICJzdHJpbmciID09IHR5cGVvZiB0aGlzLmN1cnJlbnRQbGF5ZXJGaWVsZFZhcmlhbnRWYWx1ZSA/IHRoaXMuY3VycmVudFBsYXllckZpZWxkVmFyaWFudFZhbHVlIDogTnVtYmVyKHRoaXMuY3VycmVudFBsYXllckZpZWxkVmFyaWFudFZhbHVlIHx8IDApCiAgICAgICAgfSwKICAgICAgICBQbGF5ZXJDdXJGaWVsZFZhcmlhbnROYW1lKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50UGxheWVyRmllbGRWYXJpYW50TmFtZSB8fCAiIgogICAgICAgIH0sCiAgICAgICAgUGxheWVyQ3VyRmllbGRWYXJpYW50SW5kZXgoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRQbGF5ZXJGaWVsZFZhcmlhbnRJbmRleCB8fCAwCiAgICAgICAgfSwKICAgICAgICBMZWFkZXJib2FyZEN1clBsYXllck5hbWUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRMZWFkZXJib2FyZFBsYXllci5uYW1lIHx8ICIiCiAgICAgICAgfSwKICAgICAgICBMZWFkZXJib2FyZEN1clBsYXllckF2YXRhcigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudExlYWRlcmJvYXJkUGxheWVyLmF2YXRhciB8fCAiIgogICAgICAgIH0sCiAgICAgICAgTGVhZGVyYm9hcmRDdXJQbGF5ZXJJRCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudExlYWRlcmJvYXJkUGxheWVyLmlkIHx8IDAKICAgICAgICB9LAogICAgICAgIExlYWRlcmJvYXJkQ3VyUGxheWVyU2NvcmUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRMZWFkZXJib2FyZFBsYXllci5zY29yZSB8fCAwCiAgICAgICAgfSwKICAgICAgICBMZWFkZXJib2FyZEN1clBsYXllclBvc2l0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50TGVhZGVyYm9hcmRQbGF5ZXIucG9zaXRpb24gfHwgMAogICAgICAgIH0sCiAgICAgICAgTGVhZGVyYm9hcmRDdXJQbGF5ZXJJbmRleCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudExlYWRlcmJvYXJkSW5kZXggfHwgMAogICAgICAgIH0sCiAgICAgICAgTGVhZGVyYm9hcmRDdXJQbGF5ZXJGaWVsZChlKSB7CiAgICAgICAgICAgIHJldHVybiBlIGluIHRoaXMuY3VycmVudExlYWRlcmJvYXJkUGxheWVyID8gdGhpcy5jdXJyZW50TGVhZGVyYm9hcmRQbGF5ZXJbZV0gOiAwCiAgICAgICAgfSwKICAgICAgICBMZWFkZXJib2FyZFBsYXllckZpZWxkQXQoZSwgcikgewogICAgICAgICAgICBlID0gdGhpcy5sZWFkZXJib2FyZFtlXTsKICAgICAgICAgICAgcmV0dXJuIGUgJiYgciBpbiBlID8gZVtyXSA6IDAKICAgICAgICB9LAogICAgICAgIExlYWRlcmJvYXJkUGxheWVyUG9zaXRpb24oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmxlYWRlcmJvYXJkUGxheWVyUG9zaXRpb24gfHwgMAogICAgICAgIH0sCiAgICAgICAgTGFzdExlYWRlcmJvYXJkVGFnKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5sYXN0TGVhZGVyYm9hcmRUYWcKICAgICAgICB9LAogICAgICAgIExhc3RMZWFkZXJib2FyZFZhcmlhbnQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmxhc3RMZWFkZXJib2FyZFZhcmlhbnQKICAgICAgICB9LAogICAgICAgIElzRnVsbHNjcmVlbk1vZGUoKSB7CiAgICAgICAgICAgIHJldHVybiBOdW1iZXIodGhpcy5ncC5mdWxsc2NyZWVuLmlzRW5hYmxlZCkKICAgICAgICB9LAogICAgICAgIExhbmd1YWdlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5ncC5sYW5ndWFnZQogICAgICAgIH0sCiAgICAgICAgQXZhdGFyR2VuZXJhdG9yKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5ncC5hdmF0YXJHZW5lcmF0b3IKICAgICAgICB9LAogICAgICAgIFNlcnZlclRpbWUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdwLnNlcnZlclRpbWUKICAgICAgICB9LAogICAgICAgIFNlcnZlclRpbWVVbml4KCkgewogICAgICAgICAgICByZXR1cm4gbmV3IERhdGUodGhpcy5ncC5zZXJ2ZXJUaW1lKS5nZXRUaW1lKCkKICAgICAgICB9LAogICAgICAgIElzUGF1c2VkKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5ncC5pc1BhdXNlZAogICAgICAgIH0sCiAgICAgICAgSXNHYW1lcGxheSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ3AuaXNHYW1lcGxheQogICAgICAgIH0sCiAgICAgICAgUGxhdGZvcm1UeXBlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5ncC5wbGF0Zm9ybS50eXBlCiAgICAgICAgfSwKICAgICAgICBBcHBUaXRsZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ3AuYXBwLnRpdGxlCiAgICAgICAgfSwKICAgICAgICBBcHBEZXNjcmlwdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ3AuYXBwLmRlc2NyaXB0aW9uCiAgICAgICAgfSwKICAgICAgICBBcHBJbWFnZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ3AuYXBwLmltYWdlCiAgICAgICAgfSwKICAgICAgICBBcHBVcmwoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdwLmFwcC51cmwKICAgICAgICB9LAogICAgICAgIEFjaGlldmVtZW50c1RvdGFsQWNoaWV2ZW1lbnRzKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5hY2hpZXZlbWVudHMubGVuZ3RoCiAgICAgICAgfSwKICAgICAgICBBY2hpZXZlbWVudHNUb3RhbEFjaGlldmVtZW50c0dyb3VwcygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuYWNoaWV2ZW1lbnRzR3JvdXBzLmxlbmd0aAogICAgICAgIH0sCiAgICAgICAgQWNoaWV2ZW1lbnRzVG90YWxQbGF5ZXJBY2hpZXZlbWVudHMoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnBsYXllckFjaGlldmVtZW50cy5sZW5ndGgKICAgICAgICB9LAogICAgICAgIEFjaGlldmVtZW50c0N1ckFjaGlldmVtZW50SW5kZXgoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRBY2hpZXZlbWVudEluZGV4CiAgICAgICAgfSwKICAgICAgICBBY2hpZXZlbWVudHNDdXJBY2hpZXZlbWVudElEKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnQuaWQKICAgICAgICB9LAogICAgICAgIEFjaGlldmVtZW50c0N1ckFjaGlldmVtZW50VGFnKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnQudGFnCiAgICAgICAgfSwKICAgICAgICBBY2hpZXZlbWVudHNDdXJBY2hpZXZlbWVudE5hbWUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRBY2hpZXZlbWVudC5uYW1lCiAgICAgICAgfSwKICAgICAgICBBY2hpZXZlbWVudHNDdXJBY2hpZXZlbWVudERlc2NyaXB0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnQuZGVzY3JpcHRpb24KICAgICAgICB9LAogICAgICAgIEFjaGlldmVtZW50c0N1ckFjaGlldmVtZW50SWNvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudEFjaGlldmVtZW50Lmljb24KICAgICAgICB9LAogICAgICAgIEFjaGlldmVtZW50c0N1ckFjaGlldmVtZW50SWNvblNtYWxsKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnQuaWNvblNtYWxsCiAgICAgICAgfSwKICAgICAgICBBY2hpZXZlbWVudHNDdXJBY2hpZXZlbWVudFJhcmUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRBY2hpZXZlbWVudC5yYXJlCiAgICAgICAgfSwKICAgICAgICBBY2hpZXZlbWVudHNDdXJBY2hpZXZlbWVudFVubG9ja2VkKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnQudW5sb2NrZWQKICAgICAgICB9LAogICAgICAgIEFjaGlldmVtZW50c0N1ckFjaGlldmVtZW50TG9ja2VkSWNvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudEFjaGlldmVtZW50LmxvY2tlZEljb24KICAgICAgICB9LAogICAgICAgIEFjaGlldmVtZW50c0N1ckFjaGlldmVtZW50TG9ja2VkSWNvblNtYWxsKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnQubG9ja2VkSWNvblNtYWxsCiAgICAgICAgfSwKICAgICAgICBBY2hpZXZlbWVudHNDdXJBY2hpZXZlbWVudFByb2dyZXNzKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnQucHJvZ3Jlc3MKICAgICAgICB9LAogICAgICAgIEFjaGlldmVtZW50c0N1ckFjaGlldmVtZW50TWF4UHJvZ3Jlc3MoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRBY2hpZXZlbWVudC5tYXhQcm9ncmVzcwogICAgICAgIH0sCiAgICAgICAgQWNoaWV2ZW1lbnRzQ3VyQWNoaWV2ZW1lbnRQcm9ncmVzc1N0ZXAoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRBY2hpZXZlbWVudC5wcm9ncmVzc1N0ZXAKICAgICAgICB9LAogICAgICAgIEFjaGlldmVtZW50c0N1ckFjaGlldmVtZW50c0dyb3VwSW5kZXgoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRBY2hpZXZlbWVudHNHcm91cEluZGV4CiAgICAgICAgfSwKICAgICAgICBBY2hpZXZlbWVudHNDdXJBY2hpZXZlbWVudHNHcm91cElEKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnRzR3JvdXBJRAogICAgICAgIH0sCiAgICAgICAgQWNoaWV2ZW1lbnRzQ3VyQWNoaWV2ZW1lbnRzR3JvdXBUYWcoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRBY2hpZXZlbWVudHNHcm91cFRhZwogICAgICAgIH0sCiAgICAgICAgQWNoaWV2ZW1lbnRzQ3VyQWNoaWV2ZW1lbnRzR3JvdXBOYW1lKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnRzR3JvdXBOYW1lCiAgICAgICAgfSwKICAgICAgICBBY2hpZXZlbWVudHNDdXJBY2hpZXZlbWVudHNHcm91cERlc2NyaXB0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnRzR3JvdXBEZXNjcmlwdGlvbgogICAgICAgIH0sCiAgICAgICAgQWNoaWV2ZW1lbnRzQ3VyUGxheWVyQWNoaWV2ZW1lbnRJbmRleCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudFBsYXllckFjaGlldmVtZW50SW5kZXgKICAgICAgICB9LAogICAgICAgIEFjaGlldmVtZW50c0N1clBsYXllckFjaGlldmVtZW50SUQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRQbGF5ZXJBY2hpZXZlbWVudElkCiAgICAgICAgfSwKICAgICAgICBBY2hpZXZlbWVudHNDdXJQbGF5ZXJBY2hpZXZlbWVudFVubG9ja0RhdGUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRQbGF5ZXJBY2hpZXZlbWVudFVubG9ja0RhdGUKICAgICAgICB9LAogICAgICAgIEFjaGlldmVtZW50c1VubG9ja2VkQWNoaWV2ZW1lbnRTdWNjZXNzKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5pc1VubG9ja0FjaGlldmVtZW50U3VjY2VzcwogICAgICAgIH0sCiAgICAgICAgQWNoaWV2ZW1lbnRzVW5sb2NrZWRBY2hpZXZlbWVudEVycm9yKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy51bmxvY2tBY2hpZXZlbWVudEVycm9yCiAgICAgICAgfSwKICAgICAgICBBY2hpZXZlbWVudHNVbmxvY2tlZEFjaGlldmVtZW50SUQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRBY2hpZXZlbWVudC5pZAogICAgICAgIH0sCiAgICAgICAgQWNoaWV2ZW1lbnRzVW5sb2NrZWRBY2hpZXZlbWVudFRhZygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudEFjaGlldmVtZW50LnRhZwogICAgICAgIH0sCiAgICAgICAgQWNoaWV2ZW1lbnRzVW5sb2NrZWRBY2hpZXZlbWVudE5hbWUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRBY2hpZXZlbWVudC5uYW1lCiAgICAgICAgfSwKICAgICAgICBBY2hpZXZlbWVudHNVbmxvY2tlZEFjaGlldmVtZW50RGVzY3JpcHRpb24oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRBY2hpZXZlbWVudC5kZXNjcmlwdGlvbgogICAgICAgIH0sCiAgICAgICAgQWNoaWV2ZW1lbnRzVW5sb2NrZWRBY2hpZXZlbWVudEljb24oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRBY2hpZXZlbWVudC5pY29uCiAgICAgICAgfSwKICAgICAgICBBY2hpZXZlbWVudHNVbmxvY2tlZEFjaGlldmVtZW50SWNvblNtYWxsKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50QWNoaWV2ZW1lbnQuaWNvblNtYWxsCiAgICAgICAgfSwKICAgICAgICBBY2hpZXZlbWVudHNVbmxvY2tlZEFjaGlldmVtZW50UmFyZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudEFjaGlldmVtZW50LnJhcmUKICAgICAgICB9LAogICAgICAgIEFjaGlldmVtZW50c0dldFByb2dyZXNzKGUpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ3AuYWNoaWV2ZW1lbnRzLmdldFByb2dyZXNzKGUpCiAgICAgICAgfSwKICAgICAgICBTb2NpYWxzQ29tbXVuaXR5TGluaygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ3Auc29jaWFscy5jb21tdW5pdHlMaW5rCiAgICAgICAgfSwKICAgICAgICBTb2NpYWxzR2V0U2hhcmVQYXJhbShlKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdwLnNvY2lhbHMuZ2V0U2hhcmVQYXJhbShlKQogICAgICAgIH0sCiAgICAgICAgU29jaWFsc1NoYXJlTGluaygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2hhcmVMaW5rCiAgICAgICAgfSwKICAgICAgICBQYXltZW50c0N1clByb2R1Y3RJbmRleCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudFByb2R1Y3RJbmRleAogICAgICAgIH0sCiAgICAgICAgUGF5bWVudHNDdXJQcm9kdWN0SUQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRQcm9kdWN0LmlkCiAgICAgICAgfSwKICAgICAgICBQYXltZW50c0N1clByb2R1Y3RUYWcoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRQcm9kdWN0LnRhZwogICAgICAgIH0sCiAgICAgICAgUGF5bWVudHNDdXJQcm9kdWN0TmFtZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudFByb2R1Y3QubmFtZQogICAgICAgIH0sCiAgICAgICAgUGF5bWVudHNDdXJQcm9kdWN0RGVzY3JpcHRpb24oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRQcm9kdWN0LmRlc2NyaXB0aW9uCiAgICAgICAgfSwKICAgICAgICBQYXltZW50c0N1clByb2R1Y3RJY29uKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50UHJvZHVjdC5pY29uCiAgICAgICAgfSwKICAgICAgICBQYXltZW50c0N1clByb2R1Y3RJY29uU21hbGwoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRQcm9kdWN0Lmljb25TbWFsbAogICAgICAgIH0sCiAgICAgICAgUGF5bWVudHNDdXJQcm9kdWN0UHJpY2UoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRQcm9kdWN0LnByaWNlCiAgICAgICAgfSwKICAgICAgICBQYXltZW50c0N1clByb2R1Y3RDdXJyZW5jeSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudFByb2R1Y3QuY3VycmVuY3kKICAgICAgICB9LAogICAgICAgIFBheW1lbnRzQ3VyUHJvZHVjdEN1cnJlbmN5U3ltYm9sKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50UHJvZHVjdC5jdXJyZW5jeVN5bWJvbAogICAgICAgIH0sCiAgICAgICAgUGF5bWVudHNDdXJQcm9kdWN0UHVyY2hhc2VzKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50UHJvZHVjdFB1cmNoYXNlcwogICAgICAgIH0sCiAgICAgICAgUGF5bWVudHNDdXJQdXJjaGFzZUluZGV4KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50UHVyY2hhc2VJbmRleAogICAgICAgIH0sCiAgICAgICAgUGF5bWVudHNDdXJQdXJjaGFzZUlEKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50UHVyY2hhc2UuaWQgfHwgMAogICAgICAgIH0sCiAgICAgICAgUGF5bWVudHNDdXJQdXJjaGFzZVRhZygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudFB1cmNoYXNlLnRhZyB8fCAiIgogICAgICAgIH0sCiAgICAgICAgUGF5bWVudHNDdXJQdXJjaGFzZURhdGUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRQdXJjaGFzZS5jcmVhdGVkQXQgfHwgIiIKICAgICAgICB9LAogICAgICAgIFBheW1lbnRzQ3VyUHVyY2hhc2VFeHBpcmF0aW9uRGF0ZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudFB1cmNoYXNlLmV4cGlyZWRBdCB8fCAiIgogICAgICAgIH0sCiAgICAgICAgUGF5bWVudHNDdXJQdXJjaGFzZVN1YnNjcmliZWQoKSB7CiAgICAgICAgICAgIHJldHVybiBOdW1iZXIodGhpcy5jdXJyZW50UHVyY2hhc2Uuc3Vic2NyaWJlZCB8fCAhMSkgfHwgMAogICAgICAgIH0sCiAgICAgICAgUGF5bWVudHNQdXJjaGFzZWRQcm9kdWN0U3VjY2VzcygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuaXNQdXJjaGFzZVByb2R1Y3RTdWNjZXNzCiAgICAgICAgfSwKICAgICAgICBQYXltZW50c1B1cmNoYXNlZFByb2R1Y3RFcnJvcigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMucHVyY2hhc2VQcm9kdWN0RXJyb3IKICAgICAgICB9LAogICAgICAgIFBheW1lbnRzUHVyY2hhc2VkUHJvZHVjdElEKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5wdXJjaGFzZWRQcm9kdWN0SUQKICAgICAgICB9LAogICAgICAgIFBheW1lbnRzUHVyY2hhc2VkUHJvZHVjdFRhZygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMucHVyY2hhc2VkUHJvZHVjdFRhZwogICAgICAgIH0sCiAgICAgICAgUGF5bWVudHNDb25zdW1lZFByb2R1Y3RTdWNjZXNzKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5pc0NvbnN1bWVQcm9kdWN0U3VjY2VzcwogICAgICAgIH0sCiAgICAgICAgUGF5bWVudHNDb25zdW1lZFByb2R1Y3RFcnJvcigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29uc3VtZVByb2R1Y3RFcnJvcgogICAgICAgIH0sCiAgICAgICAgUGF5bWVudHNDb25zdW1lZFByb2R1Y3RJRCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29uc3VtZWRQcm9kdWN0SUQKICAgICAgICB9LAogICAgICAgIFBheW1lbnRzQ29uc3VtZWRQcm9kdWN0VGFnKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jb25zdW1lZFByb2R1Y3RUYWcKICAgICAgICB9LAogICAgICAgIFBheW1lbnRzUHVyY2hhc2VEYXRlKGUpIHsKICAgICAgICAgICAgZSA9IHRoaXMuZ3AucGF5bWVudHMuZ2V0UHVyY2hhc2UoZSk7CiAgICAgICAgICAgIHJldHVybiBlICYmIGUuY3JlYXRlZEF0IHx8ICIiCiAgICAgICAgfSwKICAgICAgICBQYXltZW50c0V4cGlyYXRpb25EYXRlKGUpIHsKICAgICAgICAgICAgZSA9IHRoaXMuZ3AucGF5bWVudHMuZ2V0UHVyY2hhc2UoZSk7CiAgICAgICAgICAgIHJldHVybiBlICYmIGUuZXhwaXJlZEF0IHx8ICIiCiAgICAgICAgfSwKICAgICAgICBJbWFnZXNDdXJJbWFnZUluZGV4KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50SW1hZ2VJbmRleAogICAgICAgIH0sCiAgICAgICAgSW1hZ2VzQ3VySW1hZ2VJRCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudEltYWdlLmlkIHx8ICIiCiAgICAgICAgfSwKICAgICAgICBJbWFnZXNDdXJJbWFnZVNyYygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudEltYWdlLnNyYyB8fCAiIgogICAgICAgIH0sCiAgICAgICAgSW1hZ2VzQ3VySW1hZ2VXaWR0aCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudEltYWdlLndpZHRoIHx8IDAKICAgICAgICB9LAogICAgICAgIEltYWdlc0N1ckltYWdlSGVpZ2h0KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50SW1hZ2UuaGVpZ2h0IHx8IDAKICAgICAgICB9LAogICAgICAgIEltYWdlc0N1ckltYWdlUGxheWVySUQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRJbWFnZS5wbGF5ZXJJZCB8fCAwCiAgICAgICAgfSwKICAgICAgICBJbWFnZXNDdXJJbWFnZVRhZ0luZGV4KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50SW1hZ2VUYWdJbmRleAogICAgICAgIH0sCiAgICAgICAgSW1hZ2VzQ3VySW1hZ2VUYWcoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRJbWFnZVRhZyB8fCAiIgogICAgICAgIH0sCiAgICAgICAgSW1hZ2VzVGVtcEZpbGVVcmwoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmxhc3RJbWFnZVRlbXBVcmwgfHwgIiIKICAgICAgICB9LAogICAgICAgIEltYWdlc1Jlc2l6ZShlLCByLCB0LCBuKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdwLmltYWdlcy5yZXNpemUoZSwgciwgdCwgbikKICAgICAgICB9LAogICAgICAgIEZpbGVzQ3VyRmlsZUluZGV4KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50RmlsZUluZGV4CiAgICAgICAgfSwKICAgICAgICBGaWxlc0N1ckZpbGVJRCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudEZpbGUuaWQgfHwgIiIKICAgICAgICB9LAogICAgICAgIEZpbGVzQ3VyRmlsZVNyYygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudEZpbGUuc3JjIHx8ICIiCiAgICAgICAgfSwKICAgICAgICBGaWxlc0N1ckZpbGVOYW1lKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50RmlsZS5uYW1lIHx8ICIiCiAgICAgICAgfSwKICAgICAgICBGaWxlc0N1ckZpbGVTaXplKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50RmlsZS5zaXplIHx8IDAKICAgICAgICB9LAogICAgICAgIEZpbGVzQ3VyRmlsZVBsYXllcklEKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50RmlsZS5wbGF5ZXJJZCB8fCAwCiAgICAgICAgfSwKICAgICAgICBGaWxlc0N1ckZpbGVUYWdJbmRleCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudEZpbGVUYWdJbmRleAogICAgICAgIH0sCiAgICAgICAgRmlsZXNDdXJGaWxlVGFnKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50RmlsZVRhZyB8fCAiIgogICAgICAgIH0sCiAgICAgICAgRmlsZXNUZW1wRmlsZVVybCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMubGFzdEZpbGVUZW1wVXJsIHx8ICIiCiAgICAgICAgfSwKICAgICAgICBGaWxlc0xhc3RGaWxlQ29udGVudCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMubGFzdEZpbGVDb250ZW50IHx8ICIiCiAgICAgICAgfSwKICAgICAgICBHYW1lc0NvbGxlY3Rpb25zQ29sbGVjdGlvbklEKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5nYW1lc0NvbGxlY3Rpb24uaWQKICAgICAgICB9LAogICAgICAgIEdhbWVzQ29sbGVjdGlvbnNDb2xsZWN0aW9uVGFnKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5nYW1lc0NvbGxlY3Rpb24udGFnCiAgICAgICAgfSwKICAgICAgICBHYW1lc0NvbGxlY3Rpb25zQ29sbGVjdGlvbk5hbWUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdhbWVzQ29sbGVjdGlvbi5uYW1lCiAgICAgICAgfSwKICAgICAgICBHYW1lc0NvbGxlY3Rpb25zQ29sbGVjdGlvbkRlc2NyaXB0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5nYW1lc0NvbGxlY3Rpb24uZGVzY3JpcHRpb24KICAgICAgICB9LAogICAgICAgIEdhbWVzQ29sbGVjdGlvbnNDdXJHYW1lSW5kZXgoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRHYW1lSW5kZXgKICAgICAgICB9LAogICAgICAgIEdhbWVzQ29sbGVjdGlvbnNDdXJHYW1lSUQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRHYW1lSWQKICAgICAgICB9LAogICAgICAgIEdhbWVzQ29sbGVjdGlvbnNDdXJHYW1lVGFnKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50R2FtZVRhZwogICAgICAgIH0sCiAgICAgICAgR2FtZXNDb2xsZWN0aW9uc0N1ckdhbWVOYW1lKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50R2FtZU5hbWUKICAgICAgICB9LAogICAgICAgIEdhbWVzQ29sbGVjdGlvbnNDdXJHYW1lRGVzY3JpcHRpb24oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRHYW1lRGVzY3JpcHRpb24KICAgICAgICB9LAogICAgICAgIEdhbWVzQ29sbGVjdGlvbnNDdXJHYW1lSWNvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudEdhbWVJY29uCiAgICAgICAgfSwKICAgICAgICBHYW1lc0NvbGxlY3Rpb25zQ3VyR2FtZVVybCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudEdhbWVVcmwKICAgICAgICB9LAogICAgICAgIEdhbWVzQ29sbGVjdGlvbnNGZXRjaEVycm9yKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5nYW1lc0NvbGxlY3Rpb25GZXRjaEVycm9yCiAgICAgICAgfSwKICAgICAgICBEb2N1bWVudHNEb2N1bWVudFR5cGUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmRvY3VtZW50LnR5cGUKICAgICAgICB9LAogICAgICAgIERvY3VtZW50c0RvY3VtZW50Q29udGVudCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZG9jdW1lbnQuY29udGVudAogICAgICAgIH0sCiAgICAgICAgRG9jdW1lbnRzRmV0Y2hFcnJvcigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZG9jdW1lbnRGZXRjaEVycm9yCiAgICAgICAgfSwKICAgICAgICBWYXJpYWJsZXNHZXQoZSkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5ncC52YXJpYWJsZXMuZ2V0KGUpCiAgICAgICAgfSwKICAgICAgICBWYXJpYWJsZXNIYXMoZSkgewogICAgICAgICAgICByZXR1cm4gTnVtYmVyKHRoaXMuZ3AudmFyaWFibGVzLmhhcyhlKSkKICAgICAgICB9LAogICAgICAgIFZhcmlhYmxlc1R5cGUoZSkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5ncC52YXJpYWJsZXMudHlwZShlKQogICAgICAgIH0sCiAgICAgICAgVmFyaWFibGVzQ3VySW5kZXgoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRWYXJpYWJsZUluZGV4IHx8IDAKICAgICAgICB9LAogICAgICAgIFZhcmlhYmxlc0N1cktleSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudFZhcmlhYmxlLmtleSB8fCAiIgogICAgICAgIH0sCiAgICAgICAgVmFyaWFibGVzQ3VyVHlwZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudFZhcmlhYmxlLnR5cGUgfHwgIiIKICAgICAgICB9LAogICAgICAgIFZhcmlhYmxlc0N1clZhbHVlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50VmFyaWFibGUudmFsdWUgfHwgIiIKICAgICAgICB9LAogICAgICAgIFBsYXllcnNDdXJQbGF5ZXJOYW1lKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50UGxheWVyc1BsYXllci5zdGF0ZS5uYW1lIHx8ICIiCiAgICAgICAgfSwKICAgICAgICBQbGF5ZXJzQ3VyUGxheWVyQXZhdGFyKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50UGxheWVyc1BsYXllci5zdGF0ZS5hdmF0YXIgfHwgIiIKICAgICAgICB9LAogICAgICAgIFBsYXllcnNDdXJQbGF5ZXJJRCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudFBsYXllcnNQbGF5ZXIuc3RhdGUuaWQgfHwgMAogICAgICAgIH0sCiAgICAgICAgUGxheWVyc0N1clBsYXllclNjb3JlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50UGxheWVyc1BsYXllci5zdGF0ZS5zY29yZSB8fCAwCiAgICAgICAgfSwKICAgICAgICBQbGF5ZXJzQ3VyUGxheWVySW5kZXgoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRQbGF5ZXJzSW5kZXggfHwgMAogICAgICAgIH0sCiAgICAgICAgUGxheWVyc0N1clBsYXllckZpZWxkKGUpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudFBsYXllcnNQbGF5ZXIgJiYgZSBpbiB0aGlzLmN1cnJlbnRQbGF5ZXJzUGxheWVyLnN0YXRlID8gdGhpcy5jdXJyZW50UGxheWVyc1BsYXllci5zdGF0ZVtlXSA6IDAKICAgICAgICB9LAogICAgICAgIFBsYXllcnNQbGF5ZXJGaWVsZEF0KGUsIHIpIHsKICAgICAgICAgICAgZSA9IHRoaXMucGxheWVyc0xpc3RbZV07CiAgICAgICAgICAgIHJldHVybiBlICYmIHIgaW4gZS5zdGF0ZSA/IGUuc3RhdGVbcl0gOiAwCiAgICAgICAgfSwKICAgICAgICBMYXN0UGxheWVyc1RhZygpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMubGFzdFBsYXllcnNUYWcKICAgICAgICB9LAogICAgICAgIExhc3RFcnJvcigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMubGFzdEVycm9yCiAgICAgICAgfSwKICAgICAgICBJc0xhc3RBY3Rpb25TdWNjZXNzKCkgewogICAgICAgICAgICByZXR1cm4gTnVtYmVyKHRoaXMuaXNMYXN0QWN0aW9uU3VjY2VzcykKICAgICAgICB9LAogICAgICAgIEFzSlNPTigpIHsKICAgICAgICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHRoaXMuU2F2ZVRvSnNvbigpKQogICAgICAgIH0KICAgIH07Cn0KCnsKICAgICd1c2Ugc3RyaWN0JzsgewogICAgICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgICAgICBDMy5QbHVnaW5zLktleWJvYXJkID0gY2xhc3MgS2V5Ym9hcmRQbHVnaW4gZXh0ZW5kcyBDMy5TREtQbHVnaW5CYXNlIHsKICAgICAgICAgICAgY29uc3RydWN0b3Iob3B0cykgewogICAgICAgICAgICAgICAgc3VwZXIob3B0cykKICAgICAgICAgICAgfQogICAgICAgICAgICBSZWxlYXNlKCkgewogICAgICAgICAgICAgICAgc3VwZXIuUmVsZWFzZSgpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IHsKICAgICAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICAgICAgY29uc3QgQzNYID0gc2VsZi5DM1g7CiAgICAgICAgQzMuUGx1Z2lucy5LZXlib2FyZC5UeXBlID0gY2xhc3MgS2V5Ym9hcmRUeXBlIGV4dGVuZHMgQzMuU0RLVHlwZUJhc2UgewogICAgICAgICAgICBjb25zdHJ1Y3RvcihvYmplY3RDbGFzcykgewogICAgICAgICAgICAgICAgc3VwZXIob2JqZWN0Q2xhc3MpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgUmVsZWFzZSgpIHsKICAgICAgICAgICAgICAgIHN1cGVyLlJlbGVhc2UoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIE9uQ3JlYXRlKCkge30KICAgICAgICAgICAgR2V0U2NyaXB0SW50ZXJmYWNlQ2xhc3MoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5JS2V5Ym9hcmRPYmplY3RUeXBlCiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIGxldCBrZXlib2FyZE9iamVjdFR5cGUgPSBudWxsOwoKICAgICAgICBmdW5jdGlvbiBHZXRLZXlib2FyZFNka0luc3RhbmNlKCkgewogICAgICAgICAgICByZXR1cm4ga2V5Ym9hcmRPYmplY3RUeXBlLkdldFNpbmdsZUdsb2JhbEluc3RhbmNlKCkuR2V0U2RrSW5zdGFuY2UoKQogICAgICAgIH0KICAgICAgICBzZWxmLklLZXlib2FyZE9iamVjdFR5cGUgPSBjbGFzcyBJS2V5Ym9hcmRPYmplY3RUeXBlIGV4dGVuZHMgc2VsZi5JT2JqZWN0Q2xhc3MgewogICAgICAgICAgICBjb25zdHJ1Y3RvcihvYmplY3RUeXBlKSB7CiAgICAgICAgICAgICAgICBzdXBlcihvYmplY3RUeXBlKTsKICAgICAgICAgICAgICAgIGtleWJvYXJkT2JqZWN0VHlwZSA9CiAgICAgICAgICAgICAgICAgICAgb2JqZWN0VHlwZTsKICAgICAgICAgICAgICAgIG9iamVjdFR5cGUuR2V0UnVudGltZSgpLl9HZXRDb21tb25TY3JpcHRJbnRlcmZhY2VzKCkua2V5Ym9hcmQgPSB0aGlzCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaXNLZXlEb3duKGtleU9yQ29kZSkgewogICAgICAgICAgICAgICAgY29uc3Qga2V5Ym9hcmRJbnN0ID0gR2V0S2V5Ym9hcmRTZGtJbnN0YW5jZSgpOwogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBrZXlPckNvZGUgPT09ICJzdHJpbmciKSByZXR1cm4ga2V5Ym9hcmRJbnN0LklzS2V5RG93bihrZXlPckNvZGUpOwogICAgICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIGtleU9yQ29kZSA9PT0gIm51bWJlciIpIHJldHVybiBrZXlib2FyZEluc3QuSXNLZXlDb2RlRG93bihrZXlPckNvZGUpOwogICAgICAgICAgICAgICAgZWxzZSB0aHJvdyBuZXcgVHlwZUVycm9yKCJleHBlY3RlZCBzdHJpbmcgb3IgbnVtYmVyIik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IHsKICAgICAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICAgICAgQzMuUGx1Z2lucy5LZXlib2FyZC5JbnN0YW5jZSA9IGNsYXNzIEtleWJvYXJkSW5zdGFuY2UgZXh0ZW5kcyBDMy5TREtJbnN0YW5jZUJhc2UgewogICAgICAgICAgICBjb25zdHJ1Y3RvcihpbnN0LCBwcm9wZXJ0aWVzKSB7CiAgICAgICAgICAgICAgICBzdXBlcihpbnN0KTsKICAgICAgICAgICAgICAgIHRoaXMuX2tleXNEb3duQnlTdHJpbmcgPSBuZXcgU2V0OwogICAgICAgICAgICAgICAgdGhpcy5fa2V5c0Rvd25CeVdoaWNoID0gbmV3IFNldDsKICAgICAgICAgICAgICAgIHRoaXMuX3RyaWdnZXJXaGljaCA9IDA7CiAgICAgICAgICAgICAgICB0aGlzLl90cmlnZ2VyU3RyaW5nID0gIiI7CiAgICAgICAgICAgICAgICB0aGlzLl90cmlnZ2VyVHlwZWRLZXkgPSAiIjsKICAgICAgICAgICAgICAgIGNvbnN0IHJ0ID0gdGhpcy5HZXRSdW50aW1lKCkuRGlzcGF0Y2hlcigpOwogICAgICAgICAgICAgICAgdGhpcy5fZGlzcG9zYWJsZXMgPSBuZXcgQzMuQ29tcG9zaXRlRGlzcG9zYWJsZShDMy5EaXNwb3NhYmxlLkZyb20ocnQsICJrZXlkb3duIiwgZSA9PiB0aGlzLl9PbktleURvd24oZS5kYXRhKSksIEMzLkRpc3Bvc2FibGUuRnJvbShydCwgImtleXVwIiwgZSA9PiB0aGlzLl9PbktleVVwKGUuZGF0YSkpLCBDMy5EaXNwb3NhYmxlLkZyb20ocnQsICJ3aW5kb3ctYmx1ciIsCiAgICAgICAgICAgICAgICAgICAgKCkgPT4gdGhpcy5fT25XaW5kb3dPcktleWJvYXJkQmx1cigpKSwgQzMuRGlzcG9zYWJsZS5Gcm9tKHJ0LCAia2V5Ym9hcmQtYmx1ciIsICgpID0+IHRoaXMuX09uV2luZG93T3JLZXlib2FyZEJsdXIoKSkpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgUmVsZWFzZSgpIHsKICAgICAgICAgICAgICAgIHN1cGVyLlJlbGVhc2UoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9PbktleURvd24oZSkgewogICAgICAgICAgICAgICAgY29uc3Qgd2hpY2ggPSBlWyJ3aGljaCJdOwogICAgICAgICAgICAgICAgY29uc3Qga2V5U3RyaW5nID0gZVsiY29kZSJdIHx8IHdoaWNoLnRvU3RyaW5nKCk7CiAgICAgICAgICAgICAgICBjb25zdCB0eXBlZEtleSA9IGVbImtleSJdOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuX2tleXNEb3duQnlTdHJpbmcuaGFzKGtleVN0cmluZykpIHJldHVybjsKICAgICAgICAgICAgICAgIHRoaXMuX2tleXNEb3duQnlTdHJpbmcuYWRkKGtleVN0cmluZyk7CiAgICAgICAgICAgICAgICB0aGlzLl9rZXlzRG93bkJ5V2hpY2guYWRkKHdoaWNoKTsKICAgICAgICAgICAgICAgIHRoaXMuX3RyaWdnZXJTdHJpbmcgPSBrZXlTdHJpbmc7CiAgICAgICAgICAgICAgICB0aGlzLl90cmlnZ2VyV2hpY2ggPSB3aGljaDsKICAgICAgICAgICAgICAgIHRoaXMuX3RyaWdnZXJUeXBlZEtleSA9IHR5cGVkS2V5OwogICAgICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKEMzLlBsdWdpbnMuS2V5Ym9hcmQuQ25kcy5PbkFueUtleSk7CiAgICAgICAgICAgICAgICB0aGlzLlRyaWdnZXIoQzMuUGx1Z2lucy5LZXlib2FyZC5DbmRzLk9uS2V5KTsKICAgICAgICAgICAgICAgIHRoaXMuVHJpZ2dlcihDMy5QbHVnaW5zLktleWJvYXJkLkNuZHMuT25MZWZ0UmlnaHRLZXlQcmVzc2VkKTsKICAgICAgICAgICAgICAgIHRoaXMuVHJpZ2dlcihDMy5QbHVnaW5zLktleWJvYXJkLkNuZHMuT25LZXlDb2RlKQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9PbktleVVwKGUpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHdoaWNoID0gZVsid2hpY2giXTsKICAgICAgICAgICAgICAgIGNvbnN0IGtleVN0cmluZyA9IGVbImNvZGUiXSB8fCB3aGljaC50b1N0cmluZygpOwogICAgICAgICAgICAgICAgY29uc3QgdHlwZWRLZXkgPSBlWyJrZXkiXTsKICAgICAgICAgICAgICAgIHRoaXMuX2tleXNEb3duQnlTdHJpbmcuZGVsZXRlKGtleVN0cmluZyk7CiAgICAgICAgICAgICAgICB0aGlzLl9rZXlzRG93bkJ5V2hpY2guZGVsZXRlKHdoaWNoKTsKICAgICAgICAgICAgICAgIHRoaXMuX3RyaWdnZXJTdHJpbmcgPSBrZXlTdHJpbmc7CiAgICAgICAgICAgICAgICB0aGlzLl90cmlnZ2VyV2hpY2ggPSB3aGljaDsKICAgICAgICAgICAgICAgIHRoaXMuX3RyaWdnZXJUeXBlZEtleSA9IHR5cGVkS2V5OwogICAgICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKEMzLlBsdWdpbnMuS2V5Ym9hcmQuQ25kcy5PbkFueUtleVJlbGVhc2VkKTsKICAgICAgICAgICAgICAgIHRoaXMuVHJpZ2dlcihDMy5QbHVnaW5zLktleWJvYXJkLkNuZHMuT25LZXlSZWxlYXNlZCk7CiAgICAgICAgICAgICAgICB0aGlzLlRyaWdnZXIoQzMuUGx1Z2lucy5LZXlib2FyZC5DbmRzLk9uTGVmdFJpZ2h0S2V5UmVsZWFzZWQpOwogICAgICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKEMzLlBsdWdpbnMuS2V5Ym9hcmQuQ25kcy5PbktleUNvZGVSZWxlYXNlZCkKICAgICAgICAgICAgfQogICAgICAgICAgICBfT25XaW5kb3dPcktleWJvYXJkQmx1cigpIHsKICAgICAgICAgICAgICAgIGZvciAoY29uc3Qgd2hpY2ggb2YgdGhpcy5fa2V5c0Rvd25CeVdoaWNoKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fa2V5c0Rvd25CeVdoaWNoLmRlbGV0ZSh3aGljaCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdHJpZ2dlcldoaWNoID0gd2hpY2g7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKEMzLlBsdWdpbnMuS2V5Ym9hcmQuQ25kcy5PbkFueUtleVJlbGVhc2VkKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLlRyaWdnZXIoQzMuUGx1Z2lucy5LZXlib2FyZC5DbmRzLk9uS2V5UmVsZWFzZWQpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuVHJpZ2dlcihDMy5QbHVnaW5zLktleWJvYXJkLkNuZHMuT25LZXlDb2RlUmVsZWFzZWQpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLl9rZXlzRG93bkJ5U3RyaW5nLmNsZWFyKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBJc0tleURvd24oc3RyKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fa2V5c0Rvd25CeVN0cmluZy5oYXMoc3RyKQogICAgICAgICAgICB9CiAgICAgICAgICAgIElzS2V5Q29kZURvd24od2hpY2gpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9rZXlzRG93bkJ5V2hpY2guaGFzKHdoaWNoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIFNhdmVUb0pzb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICJ0ayI6IHRoaXMuX3RyaWdnZXJXaGljaCwKICAgICAgICAgICAgICAgICAgICAidGtrIjogdGhpcy5fdHJpZ2dlclR5cGVkS2V5CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgTG9hZEZyb21Kc29uKG8pIHsKICAgICAgICAgICAgICAgIHRoaXMuX3RyaWdnZXJXaGljaCA9IG9bInRrIl07CiAgICAgICAgICAgICAgICBpZiAoby5oYXNPd25Qcm9wZXJ0eSgidGtrIikpIHRoaXMuX3RyaWdnZXJUeXBlZEtleSA9IG9bInRrayJdCiAgICAgICAgICAgIH0KICAgICAgICAgICAgR2V0RGVidWdnZXJQcm9wZXJ0aWVzKCkgewogICAgICAgICAgICAgICAgY29uc3QgcHJlZml4ID0gInBsdWdpbnMua2V5Ym9hcmQiOwogICAgICAgICAgICAgICAgcmV0dXJuIFt7CiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHByZWZpeCArICIubmFtZSIsCiAgICAgICAgICAgICAgICAgICAgcHJvcGVydGllczogW3sKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogcHJlZml4ICsgIi5kZWJ1Z2dlci5sYXN0LWtleS1jb2RlIiwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuX3RyaWdnZXJXaGljaAogICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogcHJlZml4ICsgIi5kZWJ1Z2dlci5sYXN0LWtleS1zdHJpbmciLAogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogQzMuUGx1Z2lucy5LZXlib2FyZC5FeHBzLlN0cmluZ0Zyb21LZXlDb2RlKHRoaXMuX3RyaWdnZXJXaGljaCkKICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHByZWZpeCArICIuZGVidWdnZXIubGFzdC10eXBlZC1rZXkiLAogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5fdHJpZ2dlclR5cGVkS2V5CiAgICAgICAgICAgICAgICAgICAgfV0KICAgICAgICAgICAgICAgIH1dCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IHsKICAgICAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICAgICAgY29uc3QgTEVGVFJJR0hUX0tFWV9TVFJJTkdTID0gWyJTaGlmdExlZnQiLCAiU2hpZnRSaWdodCIsICJDb250cm9sTGVmdCIsICJDb250cm9sUmlnaHQiLCAiQWx0TGVmdCIsICJBbHRSaWdodCIsICJNZXRhTGVmdCIsICJNZXRhUmlnaHQiXTsKICAgICAgICBDMy5QbHVnaW5zLktleWJvYXJkLkNuZHMgPSB7CiAgICAgICAgICAgIElzS2V5RG93bih3aGljaCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2tleXNEb3duQnlXaGljaC5oYXMod2hpY2gpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIE9uS2V5KHdoaWNoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fdHJpZ2dlcldoaWNoID09PSB3aGljaAogICAgICAgICAgICB9LAogICAgICAgICAgICBPbkFueUtleSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIE9uQW55S2V5UmVsZWFzZWQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgICAgICB9LAogICAgICAgICAgICBPbktleVJlbGVhc2VkKHdoaWNoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fdHJpZ2dlcldoaWNoID09PSB3aGljaAogICAgICAgICAgICB9LAogICAgICAgICAgICBJc0tleUNvZGVEb3duKHdoaWNoKSB7CiAgICAgICAgICAgICAgICB3aGljaCA9IE1hdGguZmxvb3Iod2hpY2gpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2tleXNEb3duQnlXaGljaC5oYXMod2hpY2gpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIE9uS2V5Q29kZSh3aGljaCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RyaWdnZXJXaGljaCA9PT0KICAgICAgICAgICAgICAgICAgICB3aGljaAogICAgICAgICAgICB9LAogICAgICAgICAgICBPbktleUNvZGVSZWxlYXNlZCh3aGljaCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RyaWdnZXJXaGljaCA9PT0gd2hpY2gKICAgICAgICAgICAgfSwKICAgICAgICAgICAgT25MZWZ0UmlnaHRLZXlQcmVzc2VkKGluZGV4KSB7CiAgICAgICAgICAgICAgICBjb25zdCBrZXlTdHJpbmcgPSBMRUZUUklHSFRfS0VZX1NUUklOR1NbaW5kZXhdOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RyaWdnZXJTdHJpbmcgPT09IGtleVN0cmluZwogICAgICAgICAgICB9LAogICAgICAgICAgICBPbkxlZnRSaWdodEtleVJlbGVhc2VkKGluZGV4KSB7CiAgICAgICAgICAgICAgICBjb25zdCBrZXlTdHJpbmcgPSBMRUZUUklHSFRfS0VZX1NUUklOR1NbaW5kZXhdOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RyaWdnZXJTdHJpbmcgPT09IGtleVN0cmluZwogICAgICAgICAgICB9LAogICAgICAgICAgICBJc0xlZnRSaWdodEtleURvd24oaW5kZXgpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGtleVN0cmluZyA9IExFRlRSSUdIVF9LRVlfU1RSSU5HU1tpbmRleF07CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fa2V5c0Rvd25CeVN0cmluZy5oYXMoa2V5U3RyaW5nKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSB7CiAgICAgICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgICAgIEMzLlBsdWdpbnMuS2V5Ym9hcmQuQWN0cyA9IHt9CiAgICB9IHsKICAgICAgICBjb25zdCBDMyA9IHNlbGYuQzM7CgogICAgICAgIGZ1bmN0aW9uIFN0cmluZ0Zyb21DaGFyQ29kZShrYykgewogICAgICAgICAgICBrYyA9IE1hdGguZmxvb3Ioa2MpOwogICAgICAgICAgICBzd2l0Y2ggKGtjKSB7CiAgICAgICAgICAgICAgICBjYXNlIDg6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJiYWNrc3BhY2UiOwogICAgICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgICAgICAgIHJldHVybiAidGFiIjsKICAgICAgICAgICAgICAgIGNhc2UgMTM6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJlbnRlciI7CiAgICAgICAgICAgICAgICBjYXNlIDE2OgogICAgICAgICAgICAgICAgICAgIHJldHVybiAic2hpZnQiOwogICAgICAgICAgICAgICAgY2FzZSAxNzoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gImNvbnRyb2wiOwogICAgICAgICAgICAgICAgY2FzZSAxODoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gImFsdCI7CiAgICAgICAgICAgICAgICBjYXNlIDE5OgogICAgICAgICAgICAgICAgICAgIHJldHVybiAicGF1c2UiOwogICAgICAgICAgICAgICAgY2FzZSAyMDoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gImNhcHNsb2NrIjsKICAgICAgICAgICAgICAgIGNhc2UgMjc6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJlc2MiOwogICAgICAgICAgICAgICAgY2FzZSAzMzoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gInBhZ2V1cCI7CiAgICAgICAgICAgICAgICBjYXNlIDM0OgogICAgICAgICAgICAgICAgICAgIHJldHVybiAicGFnZWRvd24iOwogICAgICAgICAgICAgICAgY2FzZSAzNToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gImVuZCI7CiAgICAgICAgICAgICAgICBjYXNlIDM2OgogICAgICAgICAgICAgICAgICAgIHJldHVybiAiaG9tZSI7CiAgICAgICAgICAgICAgICBjYXNlIDM3OgogICAgICAgICAgICAgICAgICAgIHJldHVybiAiXHUyMTkwIjsKICAgICAgICAgICAgICAgIGNhc2UgMzg6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJcdTIxOTEiOwogICAgICAgICAgICAgICAgY2FzZSAzOToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gIlx1MjE5MiI7CiAgICAgICAgICAgICAgICBjYXNlIDQwOgogICAgICAgICAgICAgICAgICAgIHJldHVybiAiXHUyMTkzIjsKICAgICAgICAgICAgICAgIGNhc2UgNDU6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJpbnNlcnQiOwogICAgICAgICAgICAgICAgY2FzZSA0NjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gImRlbCI7CiAgICAgICAgICAgICAgICBjYXNlIDkxOgogICAgICAgICAgICAgICAgICAgIHJldHVybiAibGVmdCB3aW5kb3cga2V5IjsKICAgICAgICAgICAgICAgIGNhc2UgOTI6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJyaWdodCB3aW5kb3cga2V5IjsKICAgICAgICAgICAgICAgIGNhc2UgOTM6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJzZWxlY3QiOwogICAgICAgICAgICAgICAgY2FzZSA5NjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gIm51bXBhZCAwIjsKICAgICAgICAgICAgICAgIGNhc2UgOTc6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJudW1wYWQgMSI7CiAgICAgICAgICAgICAgICBjYXNlIDk4OgogICAgICAgICAgICAgICAgICAgIHJldHVybiAibnVtcGFkIDIiOwogICAgICAgICAgICAgICAgY2FzZSA5OToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gIm51bXBhZCAzIjsKICAgICAgICAgICAgICAgIGNhc2UgMTAwOgogICAgICAgICAgICAgICAgICAgIHJldHVybiAibnVtcGFkIDQiOwogICAgICAgICAgICAgICAgY2FzZSAxMDE6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJudW1wYWQgNSI7CiAgICAgICAgICAgICAgICBjYXNlIDEwMjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gIm51bXBhZCA2IjsKICAgICAgICAgICAgICAgIGNhc2UgMTAzOgogICAgICAgICAgICAgICAgICAgIHJldHVybiAibnVtcGFkIDciOwogICAgICAgICAgICAgICAgY2FzZSAxMDQ6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJudW1wYWQgOCI7CiAgICAgICAgICAgICAgICBjYXNlIDEwNToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gIm51bXBhZCA5IjsKICAgICAgICAgICAgICAgIGNhc2UgMTA2OgogICAgICAgICAgICAgICAgICAgIHJldHVybiAibnVtcGFkICoiOwogICAgICAgICAgICAgICAgY2FzZSAxMDc6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJudW1wYWQgKyI7CiAgICAgICAgICAgICAgICBjYXNlIDEwOToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gIm51bXBhZCAtIjsKICAgICAgICAgICAgICAgIGNhc2UgMTEwOgogICAgICAgICAgICAgICAgICAgIHJldHVybiAibnVtcGFkIC4iOwogICAgICAgICAgICAgICAgY2FzZSAxMTE6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJudW1wYWQgLyI7CiAgICAgICAgICAgICAgICBjYXNlIDExMjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gIkYxIjsKICAgICAgICAgICAgICAgIGNhc2UgMTEzOgogICAgICAgICAgICAgICAgICAgIHJldHVybiAiRjIiOwogICAgICAgICAgICAgICAgY2FzZSAxMTQ6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJGMyI7CiAgICAgICAgICAgICAgICBjYXNlIDExNToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gIkY0IjsKICAgICAgICAgICAgICAgIGNhc2UgMTE2OgogICAgICAgICAgICAgICAgICAgIHJldHVybiAiRjUiOwogICAgICAgICAgICAgICAgY2FzZSAxMTc6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJGNiI7CiAgICAgICAgICAgICAgICBjYXNlIDExODoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gIkY3IjsKICAgICAgICAgICAgICAgIGNhc2UgMTE5OgogICAgICAgICAgICAgICAgICAgIHJldHVybiAiRjgiOwogICAgICAgICAgICAgICAgY2FzZSAxMjA6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJGOSI7CiAgICAgICAgICAgICAgICBjYXNlIDEyMToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gIkYxMCI7CiAgICAgICAgICAgICAgICBjYXNlIDEyMjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gIkYxMSI7CiAgICAgICAgICAgICAgICBjYXNlIDEyMzoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gIkYxMiI7CiAgICAgICAgICAgICAgICBjYXNlIDE0NDoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gIm51bWxvY2siOwogICAgICAgICAgICAgICAgY2FzZSAxNDU6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJzY3JvbGwgbG9jayI7CiAgICAgICAgICAgICAgICBjYXNlIDE4NjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gIjsiOwogICAgICAgICAgICAgICAgY2FzZSAxODc6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICI9IjsKICAgICAgICAgICAgICAgIGNhc2UgMTg4OgogICAgICAgICAgICAgICAgICAgIHJldHVybiAiLCI7CiAgICAgICAgICAgICAgICBjYXNlIDE4OToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gIi0iOwogICAgICAgICAgICAgICAgY2FzZSAxOTA6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICIuIjsKICAgICAgICAgICAgICAgIGNhc2UgMTkxOgogICAgICAgICAgICAgICAgICAgIHJldHVybiAiLyI7CiAgICAgICAgICAgICAgICBjYXNlIDE5MjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gIiciOwogICAgICAgICAgICAgICAgY2FzZSAyMTk6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJbIjsKICAgICAgICAgICAgICAgIGNhc2UgMjIwOgogICAgICAgICAgICAgICAgICAgIHJldHVybiAiXFwiOwogICAgICAgICAgICAgICAgY2FzZSAyMjE6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJdIjsKICAgICAgICAgICAgICAgIGNhc2UgMjIyOgogICAgICAgICAgICAgICAgICAgIHJldHVybiAiIyI7CiAgICAgICAgICAgICAgICBjYXNlIDIyMzoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gImAiOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZShrYykKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBDMy5QbHVnaW5zLktleWJvYXJkLkV4cHMgPSB7CiAgICAgICAgICAgIExhc3RLZXlDb2RlKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RyaWdnZXJXaGljaAogICAgICAgICAgICB9LAogICAgICAgICAgICBTdHJpbmdGcm9tS2V5Q29kZShrYykgewogICAgICAgICAgICAgICAgcmV0dXJuIFN0cmluZ0Zyb21DaGFyQ29kZShrYykKICAgICAgICAgICAgfSwKICAgICAgICAgICAgVHlwZWRLZXkoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fdHJpZ2dlclR5cGVkS2V5CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwoKfQoKewogICAgJ3VzZSBzdHJpY3QnOyB7CiAgICAgICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgICAgIEMzLlBsdWdpbnMuUGxhdGZvcm1JbmZvID0gY2xhc3MgUGxhdGZvcm1JbmZvUGx1Z2luIGV4dGVuZHMgQzMuU0RLUGx1Z2luQmFzZSB7CiAgICAgICAgICAgIGNvbnN0cnVjdG9yKG9wdHMpIHsKICAgICAgICAgICAgICAgIHN1cGVyKG9wdHMpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgUmVsZWFzZSgpIHsKICAgICAgICAgICAgICAgIHN1cGVyLlJlbGVhc2UoKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSB7CiAgICAgICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgICAgIEMzLlBsdWdpbnMuUGxhdGZvcm1JbmZvLlR5cGUgPSBjbGFzcyBQbGF0Zm9ybUluZm9UeXBlIGV4dGVuZHMgQzMuU0RLVHlwZUJhc2UgewogICAgICAgICAgICBjb25zdHJ1Y3RvcihvYmplY3RDbGFzcykgewogICAgICAgICAgICAgICAgc3VwZXIob2JqZWN0Q2xhc3MpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgUmVsZWFzZSgpIHsKICAgICAgICAgICAgICAgIHN1cGVyLlJlbGVhc2UoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIE9uQ3JlYXRlKCkge30KICAgICAgICB9CiAgICB9IHsKICAgICAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICAgICAgY29uc3QgRE9NX0NPTVBPTkVOVF9JRCA9ICJwbGF0Zm9ybS1pbmZvIjsKICAgICAgICBDMy5QbHVnaW5zLlBsYXRmb3JtSW5mby5JbnN0YW5jZSA9IGNsYXNzIFBsYXRmb3JtSW5mb0luc3RhbmNlIGV4dGVuZHMgQzMuU0RLSW5zdGFuY2VCYXNlIHsKICAgICAgICAgICAgY29uc3RydWN0b3IoaW5zdCwgcHJvcGVydGllcykgewogICAgICAgICAgICAgICAgc3VwZXIoaW5zdCwgRE9NX0NPTVBPTkVOVF9JRCk7CiAgICAgICAgICAgICAgICB0aGlzLl9zY3JlZW5XaWR0aCA9IDA7CiAgICAgICAgICAgICAgICB0aGlzLl9zY3JlZW5IZWlnaHQgPSAwOwogICAgICAgICAgICAgICAgdGhpcy5fd2luZG93T3V0ZXJXaWR0aCA9IDA7CiAgICAgICAgICAgICAgICB0aGlzLl93aW5kb3dPdXRlckhlaWdodCA9IDA7CiAgICAgICAgICAgICAgICB0aGlzLl9zYWZlQXJlYUluc2V0ID0gWzAsIDAsIDAsIDBdOwogICAgICAgICAgICAgICAgdGhpcy5fc3VwcG9ydHNXYWtlTG9jayA9IGZhbHNlOwogICAgICAgICAgICAgICAgdGhpcy5faXNXYWtlTG9ja0FjdGl2ZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgdGhpcy5faXNOd2pzID0gZmFsc2U7CiAgICAgICAgICAgICAgICB0aGlzLkFkZERPTU1lc3NhZ2VIYW5kbGVycyhbCiAgICAgICAgICAgICAgICAgICAgWyJ3aW5kb3ctcmVzaXplIiwgZSA9PiB0aGlzLl9PbldpbmRvd1Jlc2l6ZShlKV0sCiAgICAgICAgICAgICAgICAgICAgWyJ3YWtlLWxvY2stYWNxdWlyZWQiLCBlID0+IHRoaXMuX09uV2FrZUxvY2tBY3F1aXJlZChlKV0sCiAgICAgICAgICAgICAgICAgICAgWyJ3YWtlLWxvY2stZXJyb3IiLCBlID0+IHRoaXMuX09uV2FrZUxvY2tFcnJvcihlKV0sCiAgICAgICAgICAgICAgICAgICAgWyJ3YWtlLWxvY2stcmVsZWFzZWQiLCBlID0+IHRoaXMuX09uV2FrZUxvY2tSZWxlYXNlZChlKV0KICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICAgICAgaWYgKG5hdmlnYXRvci5jb25uZWN0aW9uKSBuYXZpZ2F0b3IuY29ubmVjdGlvbi5hZGRFdmVudExpc3RlbmVyKCJjaGFuZ2UiLCAoKSA9PiB0aGlzLl9Pbk5ldHdvcmtDaGFuZ2UoKSk7CiAgICAgICAgICAgICAgICB0aGlzLl9ydW50aW1lLkFkZExvYWRQcm9taXNlKHRoaXMuUG9zdFRvRE9NQXN5bmMoImdldC1pbml0aWFsLXN0YXRlIikudGhlbihkYXRhID0+IHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9zY3JlZW5XaWR0aCA9IGRhdGFbInNjcmVlbldpZHRoIl07CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2NyZWVuSGVpZ2h0ID0gZGF0YVsic2NyZWVuSGVpZ2h0Il07CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fd2luZG93T3V0ZXJXaWR0aCA9IGRhdGFbIndpbmRvd091dGVyV2lkdGgiXTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl93aW5kb3dPdXRlckhlaWdodCA9IGRhdGFbIndpbmRvd091dGVySGVpZ2h0Il07CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2FmZUFyZWFJbnNldCA9IGRhdGFbInNhZmVBcmVhSW5zZXQiXTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9zdXBwb3J0c1dha2VMb2NrID0gZGF0YVsic3VwcG9ydHNXYWtlTG9jayJdOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2lzTndqcyA9IGRhdGFbImlzTndqcyJdCiAgICAgICAgICAgICAgICB9KSkKICAgICAgICAgICAgfQogICAgICAgICAgICBSZWxlYXNlKCkgewogICAgICAgICAgICAgICAgc3VwZXIuUmVsZWFzZSgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX09uV2luZG93UmVzaXplKGUpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3dpbmRvd091dGVyV2lkdGggPSBlWyJ3aW5kb3dPdXRlcldpZHRoIl07CiAgICAgICAgICAgICAgICB0aGlzLl93aW5kb3dPdXRlckhlaWdodCA9IGVbIndpbmRvd091dGVySGVpZ2h0Il07CiAgICAgICAgICAgICAgICB0aGlzLl9zYWZlQXJlYUluc2V0ID0gZVsic2FmZUFyZWFJbnNldCJdCiAgICAgICAgICAgIH0KICAgICAgICAgICAgYXN5bmMgX09uTmV0d29ya0NoYW5nZSgpIHsKICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuVHJpZ2dlckFzeW5jKEMzLlBsdWdpbnMuUGxhdGZvcm1JbmZvLkNuZHMuT25OZXR3b3JrQ2hhbmdlKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGFzeW5jIF9Pbldha2VMb2NrQWNxdWlyZWQoKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9pc1dha2VMb2NrQWN0aXZlID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuVHJpZ2dlckFzeW5jKEMzLlBsdWdpbnMuUGxhdGZvcm1JbmZvLkNuZHMuT25XYWtlTG9ja0FjcXVpcmVkKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGFzeW5jIF9Pbldha2VMb2NrRXJyb3IoKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9pc1dha2VMb2NrQWN0aXZlID0KICAgICAgICAgICAgICAgICAgICBmYWxzZTsKICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuVHJpZ2dlckFzeW5jKEMzLlBsdWdpbnMuUGxhdGZvcm1JbmZvLkNuZHMuT25XYWtlTG9ja0Vycm9yKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGFzeW5jIF9Pbldha2VMb2NrUmVsZWFzZWQoKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9pc1dha2VMb2NrQWN0aXZlID0gZmFsc2U7CiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLlRyaWdnZXJBc3luYyhDMy5QbHVnaW5zLlBsYXRmb3JtSW5mby5DbmRzLk9uV2FrZUxvY2tSZWxlYXNlZCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gewogICAgICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgICAgICBDMy5QbHVnaW5zLlBsYXRmb3JtSW5mby5DbmRzID0gewogICAgICAgICAgICBJc09uTW9iaWxlKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIEMzLlBsYXRmb3JtLklzTW9iaWxlCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIElzT25XaW5kb3dzKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIEMzLlBsYXRmb3JtLk9TID09PSAiV2luZG93cyIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgSXNPbk1hY09TKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIEMzLlBsYXRmb3JtLk9TID09PSAibWFjT1MiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIElzT25MaW51eCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBDMy5QbGF0Zm9ybS5PUyA9PT0gIkxpbnV4IgogICAgICAgICAgICB9LAogICAgICAgICAgICBJc09uQ2hyb21lT1MoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gQzMuUGxhdGZvcm0uT1MgPT09ICJDaHJvbWUgT1MiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIElzT25BbmRyb2lkKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIEMzLlBsYXRmb3JtLk9TID09PSAiQW5kcm9pZCIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgSXNPbmlPUygpIHsKICAgICAgICAgICAgICAgIHJldHVybiBDMy5QbGF0Zm9ybS5PUyA9PT0gImlPUyIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgSXNXZWJFeHBvcnQoKSB7CiAgICAgICAgICAgICAgICBjb25zdCBleHBvcnRUeXBlID0gdGhpcy5fcnVudGltZS5HZXRFeHBvcnRUeXBlKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gZXhwb3J0VHlwZSA9PT0gImh0bWw1IiB8fCBleHBvcnRUeXBlID09PSAic2NpcnJhLWFyY2FkZSIgfHwgZXhwb3J0VHlwZSA9PT0KICAgICAgICAgICAgICAgICAgICAicHJldmlldyIgfHwgZXhwb3J0VHlwZSA9PT0gImluc3RhbnQtZ2FtZXMiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIElzQ29yZG92YUV4cG9ydCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lLklzQ29yZG92YSgpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIElzTldqc0V4cG9ydCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lLkdldEV4cG9ydFR5cGUoKSA9PT0gIm53anMiIHx8IHRoaXMuX2lzTndqcwogICAgICAgICAgICB9LAogICAgICAgICAgICBJc1dpbmRvd3NVV1BFeHBvcnQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcnVudGltZS5HZXRFeHBvcnRUeXBlKCkgPT09ICJ3aW5kb3dzLXV3cCIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgSXNXaW5kb3dzV2ViVmlldzJFeHBvcnQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcnVudGltZS5HZXRFeHBvcnRUeXBlKCkgPT09ICJ3aW5kb3dzLXdlYnZpZXcyIgogICAgICAgICAgICB9LAogICAgICAgICAgICBJc01hY09TV0tXZWJWaWV3MkV4cG9ydCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lLkdldEV4cG9ydFR5cGUoKSA9PT0gIm1hY29zLXdrd2VidmlldyIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgT25OZXR3b3JrQ2hhbmdlKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgT25XYWtlTG9ja0FjcXVpcmVkKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgT25XYWtlTG9ja0Vycm9yKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgT25XYWtlTG9ja1JlbGVhc2VkKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgSXNXYWtlTG9ja0FjdGl2ZSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9pc1dha2VMb2NrQWN0aXZlCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIElzV2FrZUxvY2tTdXBwb3J0ZWQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fc3VwcG9ydHNXYWtlTG9jawogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSB7CiAgICAgICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgICAgIEMzLlBsdWdpbnMuUGxhdGZvcm1JbmZvLkFjdHMgPSB7CiAgICAgICAgICAgIFJlcXVlc3RXYWtlTG9jaygpIHsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5fc3VwcG9ydHNXYWtlTG9jaykgcmV0dXJuOwogICAgICAgICAgICAgICAgdGhpcy5fUG9zdFRvRE9NTWF5YmVTeW5jKCJyZXF1ZXN0LXdha2UtbG9jayIpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFJlbGVhc2VXYWtlTG9jaygpIHsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5fc3VwcG9ydHNXYWtlTG9jaykgcmV0dXJuOwogICAgICAgICAgICAgICAgdGhpcy5faXNXYWtlTG9ja0FjdGl2ZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgdGhpcy5Qb3N0VG9ET00oInJlbGVhc2Utd2FrZS1sb2NrIikKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gewogICAgICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgICAgICBDMy5QbHVnaW5zLlBsYXRmb3JtSW5mby5FeHBzID0gewogICAgICAgICAgICBSZW5kZXJlcigpIHsKICAgICAgICAgICAgICAgIGxldCByZXQgPSAiIjsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9ydW50aW1lLkdldFdlYkdQVVJlbmRlcmVyKCkpIHJldCA9ICJ3ZWJncHUiOwogICAgICAgICAgICAgICAgZWxzZSByZXQgPSAid2ViZ2wiICsgdGhpcy5fcnVudGltZS5HZXRXZWJHTFJlbmRlcmVyKCkuR2V0V2ViR0xWZXJzaW9uTnVtYmVyKCk7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fcnVudGltZS5HZXRSZW5kZXJlcigpLkhhc01ham9yUGVyZm9ybWFuY2VDYXZlYXQoKSkgcmV0ICs9ICItc29mdHdhcmUiOwogICAgICAgICAgICAgICAgcmV0dXJuIHJldAogICAgICAgICAgICB9LAogICAgICAgICAgICBSZW5kZXJlckRldGFpbCgpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9ydW50aW1lLkdldFdlYkdQVVJlbmRlcmVyKCkpIHJldHVybiB0aGlzLl9ydW50aW1lLkdldFdlYkdQVVJlbmRlcmVyKCkuR2V0QmFzaWNBZGFwdGVySW5mb1N0cmluZygpOwogICAgICAgICAgICAgICAgZWxzZSByZXR1cm4gdGhpcy5fcnVudGltZS5HZXRXZWJHTFJlbmRlcmVyKCkuR2V0VW5tYXNrZWRSZW5kZXJlcigpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIERldmljZVBpeGVsUmF0aW8oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5kZXZpY2VQaXhlbFJhdGlvCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFNjcmVlbldpZHRoKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NjcmVlbldpZHRoCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFNjcmVlbkhlaWdodCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9zY3JlZW5IZWlnaHQKICAgICAgICAgICAgfSwKICAgICAgICAgICAgV2luZG93SW5uZXJXaWR0aCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lLkdldENhbnZhc01hbmFnZXIoKS5HZXRMYXN0V2lkdGgoKQogICAgICAgICAgICB9LAogICAgICAgICAgICBXaW5kb3dJbm5lckhlaWdodCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lLkdldENhbnZhc01hbmFnZXIoKS5HZXRMYXN0SGVpZ2h0KCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgV2luZG93T3V0ZXJXaWR0aCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl93aW5kb3dPdXRlcldpZHRoCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFdpbmRvd091dGVySGVpZ2h0KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3dpbmRvd091dGVySGVpZ2h0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIENhbnZhc0Nzc1dpZHRoKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUuR2V0Q2FudmFzTWFuYWdlcigpLkdldENzc1dpZHRoKCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgQ2FudmFzQ3NzSGVpZ2h0KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUuR2V0Q2FudmFzTWFuYWdlcigpLkdldENzc0hlaWdodCgpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIENhbnZhc0RldmljZVdpZHRoKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUuR2V0Q2FudmFzTWFuYWdlcigpLkdldERldmljZVdpZHRoKCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgQ2FudmFzRGV2aWNlSGVpZ2h0KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3J1bnRpbWUuR2V0Q2FudmFzTWFuYWdlcigpLkdldERldmljZUhlaWdodCgpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIERvd25saW5rKCkgewogICAgICAgICAgICAgICAgaWYgKG5hdmlnYXRvci5jb25uZWN0aW9uKSByZXR1cm4gbmF2aWdhdG9yLmNvbm5lY3Rpb25bImRvd25saW5rIl0gfHwgMDsKICAgICAgICAgICAgICAgIGVsc2UgcmV0dXJuIDAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgRG93bmxpbmtNYXgoKSB7CiAgICAgICAgICAgICAgICBpZiAobmF2aWdhdG9yLmNvbm5lY3Rpb24pIHJldHVybiBuYXZpZ2F0b3IuY29ubmVjdGlvblsiZG93bmxpbmtNYXgiXSB8fCAwOwogICAgICAgICAgICAgICAgZWxzZSByZXR1cm4gMAogICAgICAgICAgICB9LAogICAgICAgICAgICBDb25uZWN0aW9uVHlwZSgpIHsKICAgICAgICAgICAgICAgIGlmIChuYXZpZ2F0b3IuY29ubmVjdGlvbikgcmV0dXJuIG5hdmlnYXRvci5jb25uZWN0aW9uWyJ0eXBlIl0gfHwgInVua25vd24iOwogICAgICAgICAgICAgICAgZWxzZSByZXR1cm4gInVua25vd24iCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIENvbm5lY3Rpb25FZmZlY3RpdmVUeXBlKCkgewogICAgICAgICAgICAgICAgaWYgKG5hdmlnYXRvci5jb25uZWN0aW9uKSByZXR1cm4gbmF2aWdhdG9yLmNvbm5lY3Rpb25bImVmZmVjdGl2ZVR5cGUiXSB8fCAidW5rbm93biI7CiAgICAgICAgICAgICAgICBlbHNlIHJldHVybiAidW5rbm93biIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgQ29ubmVjdGlvblJUVCgpIHsKICAgICAgICAgICAgICAgIGlmIChuYXZpZ2F0b3IuY29ubmVjdGlvbikgcmV0dXJuIG5hdmlnYXRvci5jb25uZWN0aW9uWyJydHQiXSB8fCAwOwogICAgICAgICAgICAgICAgZWxzZSByZXR1cm4gMAogICAgICAgICAgICB9LAogICAgICAgICAgICBIYXJkd2FyZUNvbmN1cnJlbmN5KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIG5hdmlnYXRvci5oYXJkd2FyZUNvbmN1cnJlbmN5IHx8IDAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgRGV2aWNlTWVtb3J5KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIG5hdmlnYXRvci5kZXZpY2VNZW1vcnkgfHwgMAogICAgICAgICAgICB9LAogICAgICAgICAgICBTYWZlQXJlYUluc2V0VG9wKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NhZmVBcmVhSW5zZXRbMF0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgU2FmZUFyZWFJbnNldFJpZ2h0KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NhZmVBcmVhSW5zZXRbMV0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgU2FmZUFyZWFJbnNldEJvdHRvbSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9zYWZlQXJlYUluc2V0WzJdCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFNhZmVBcmVhSW5zZXRMZWZ0KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NhZmVBcmVhSW5zZXRbM10KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07Cgp9Cgp7CiAgICAndXNlIHN0cmljdCc7IHsKICAgICAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICAgICAgQzMuUGx1Z2lucy5TcHJpdGVmb250MiA9IGNsYXNzIFNwcml0ZUZvbnRQbHVnaW4gZXh0ZW5kcyBDMy5TREtQbHVnaW5CYXNlIHsKICAgICAgICAgICAgY29uc3RydWN0b3Iob3B0cykgewogICAgICAgICAgICAgICAgc3VwZXIob3B0cykKICAgICAgICAgICAgfQogICAgICAgICAgICBSZWxlYXNlKCkgewogICAgICAgICAgICAgICAgc3VwZXIuUmVsZWFzZSgpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IHsKICAgICAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICAgICAgQzMuUGx1Z2lucy5TcHJpdGVmb250Mi5UeXBlID0gY2xhc3MgU3ByaXRlRm9udFR5cGUgZXh0ZW5kcyBDMy5TREtUeXBlQmFzZSB7CiAgICAgICAgICAgIGNvbnN0cnVjdG9yKG9iamVjdENsYXNzKSB7CiAgICAgICAgICAgICAgICBzdXBlcihvYmplY3RDbGFzcyk7CiAgICAgICAgICAgICAgICB0aGlzLl9zcHJpdGVGb250ID0gQzMuTmV3KHNlbGYuU3ByaXRlRm9udCkKICAgICAgICAgICAgfQogICAgICAgICAgICBSZWxlYXNlKCkgewogICAgICAgICAgICAgICAgc3VwZXIuUmVsZWFzZSgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgT25DcmVhdGUoKSB7CiAgICAgICAgICAgICAgICB0aGlzLkdldEltYWdlSW5mbygpLkxvYWRBc3NldCh0aGlzLl9ydW50aW1lKQogICAgICAgICAgICB9CiAgICAgICAgICAgIExvYWRUZXh0dXJlcyhyZW5kZXJlcikgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuR2V0SW1hZ2VJbmZvKCkuTG9hZFN0YXRpY1RleHR1cmUocmVuZGVyZXIsIHsKICAgICAgICAgICAgICAgICAgICBzYW1wbGluZzogdGhpcy5fcnVudGltZS5HZXRTYW1wbGluZygpCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9CiAgICAgICAgICAgIFJlbGVhc2VUZXh0dXJlcygpIHsKICAgICAgICAgICAgICAgIHRoaXMuR2V0SW1hZ2VJbmZvKCkuUmVsZWFzZVRleHR1cmUoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIEdldFNwcml0ZUZvbnQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fc3ByaXRlRm9udAogICAgICAgICAgICB9CiAgICAgICAgICAgIFVwZGF0ZVNldHRpbmdzKGNoYXJhY3RlcldpZHRoLCBjaGFyYWN0ZXJIZWlnaHQsCiAgICAgICAgICAgICAgICBjaGFyYWN0ZXJTZXQsIHNwYWNpbmdEYXRhKSB7CiAgICAgICAgICAgICAgICBjb25zdCBpbWFnZUluZm8gPSB0aGlzLkdldEltYWdlSW5mbygpOwogICAgICAgICAgICAgICAgY29uc3Qgc2YgPSB0aGlzLl9zcHJpdGVGb250OwogICAgICAgICAgICAgICAgc2YuU2V0V2lkdGgoaW1hZ2VJbmZvLkdldFdpZHRoKCkpOwogICAgICAgICAgICAgICAgc2YuU2V0SGVpZ2h0KGltYWdlSW5mby5HZXRIZWlnaHQoKSk7CiAgICAgICAgICAgICAgICBzZi5TZXRDaGFyYWN0ZXJXaWR0aChjaGFyYWN0ZXJXaWR0aCk7CiAgICAgICAgICAgICAgICBzZi5TZXRDaGFyYWN0ZXJIZWlnaHQoY2hhcmFjdGVySGVpZ2h0KTsKICAgICAgICAgICAgICAgIHNmLlNldENoYXJhY3RlclNldChjaGFyYWN0ZXJTZXQpOwogICAgICAgICAgICAgICAgc2YuU2V0U3BhY2luZ0RhdGEoc3BhY2luZ0RhdGEpOwogICAgICAgICAgICAgICAgc2YuVXBkYXRlQ2hhcmFjdGVyTWFwKCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gewogICAgICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgICAgICBjb25zdCBDM1ggPSBzZWxmLkMzWDsKICAgICAgICBjb25zdCB0ZW1wVmVjMiA9IEMzLk5ldyhDMy5WZWN0b3IyKTsKICAgICAgICBjb25zdCBURVhUID0gMDsKICAgICAgICBjb25zdCBFTkFCTEVfQkJDT0RFID0gMTsKICAgICAgICBjb25zdCBDSEFSQUNURVJfV0lEVEggPSAyOwogICAgICAgIGNvbnN0IENIQVJBQ1RFUl9IRUlHSFQgPSAzOwogICAgICAgIGNvbnN0IENIQVJBQ1RFUl9TRVQgPSA0OwogICAgICAgIGNvbnN0IFNQQUNJTkdfREFUQSA9IDU7CiAgICAgICAgY29uc3QgU0NBTEUgPSA2OwogICAgICAgIGNvbnN0IENIQVJBQ1RFUl9TUEFDSU5HID0gNzsKICAgICAgICBjb25zdCBMSU5FX0hFSUdIVCA9IDg7CiAgICAgICAgY29uc3QgSE9SSVpPTlRBTF9BTElHTk1FTlQgPSA5OwogICAgICAgIGNvbnN0IFZFUlRJQ0FMX0FMSUdOTUVOVCA9IDEwOwogICAgICAgIGNvbnN0IFdSQVBQSU5HID0gMTE7CiAgICAgICAgY29uc3QgSU5JVElBTExZX1ZJU0lCTEUgPSAxMjsKICAgICAgICBjb25zdCBPUklHSU4gPSAxMzsKICAgICAgICBjb25zdCBSRUFEX0FMT1VEID0gMTQ7CiAgICAgICAgY29uc3QgSE9SSVpPTlRBTF9BTElHTk1FTlRTID0gWyJsZWZ0IiwgImNlbnRlciIsICJyaWdodCJdOwogICAgICAgIGNvbnN0IFZFUlRJQ0FMX0FMSUdOTUVOVFMgPSBbInRvcCIsICJjZW50ZXIiLCAiYm90dG9tIl07CiAgICAgICAgY29uc3QgV09SRF9XUkFQID0gMDsKICAgICAgICBjb25zdCBDSEFSQUNURVJfV1JBUCA9IDE7CiAgICAgICAgQzMuUGx1Z2lucy5TcHJpdGVmb250Mi5JbnN0YW5jZSA9IGNsYXNzIFNwcml0ZUZvbnRJbnN0YW5jZSBleHRlbmRzIEMzLlNES1dvcmxkSW5zdGFuY2VCYXNlIHsKICAgICAgICAgICAgY29uc3RydWN0b3IoaW5zdCwgcHJvcGVydGllcykgewogICAgICAgICAgICAgICAgc3VwZXIoaW5zdCk7CiAgICAgICAgICAgICAgICB0aGlzLl90ZXh0ID0gIiI7CiAgICAgICAgICAgICAgICB0aGlzLl9lbmFibGVCQmNvZGUgPSB0cnVlOwogICAgICAgICAgICAgICAgdGhpcy5fY2hhcmFjdGVyV2lkdGggPSAxNjsKICAgICAgICAgICAgICAgIHRoaXMuX2NoYXJhY3RlckhlaWdodCA9IDE2OwogICAgICAgICAgICAgICAgdGhpcy5fY2hhcmFjdGVyU2V0ID0gIkFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5Liw7Oj8hLV9+I1wiJyYoKVtdfGBcXC9AXHUwMGIwKz0qJFx1MDBhM1x1MjBhYzw+IjsKICAgICAgICAgICAgICAgIGxldCBzcGFjaW5nRGF0YSA9ICIiOwogICAgICAgICAgICAgICAgdGhpcy5fY2hhcmFjdGVyU2NhbGUgPSAxOwogICAgICAgICAgICAgICAgdGhpcy5fY2hhcmFjdGVyU3BhY2luZyA9IDA7CiAgICAgICAgICAgICAgICB0aGlzLl9saW5lSGVpZ2h0ID0gMDsKICAgICAgICAgICAgICAgIHRoaXMuX2hvcml6b250YWxBbGlnbiA9IDA7CiAgICAgICAgICAgICAgICB0aGlzLl92ZXJ0aWNhbEFsaWduID0KICAgICAgICAgICAgICAgICAgICAwOwogICAgICAgICAgICAgICAgdGhpcy5fd3JhcEJ5V29yZCA9IHRydWU7CiAgICAgICAgICAgICAgICB0aGlzLl9yZWFkQWxvdWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHRoaXMuX3NjcmVlblJlYWRlclRleHQgPSBudWxsOwogICAgICAgICAgICAgICAgdGhpcy5fc3ByaXRlRm9udFRleHQgPSBudWxsOwogICAgICAgICAgICAgICAgdGhpcy5fdHlwZXdyaXRlclN0YXJ0VGltZSA9IC0xOwogICAgICAgICAgICAgICAgdGhpcy5fdHlwZXdyaXRlckVuZFRpbWUgPSAtMTsKICAgICAgICAgICAgICAgIHRoaXMuX3R5cGV3cml0ZXJMZW5ndGggPSAwOwogICAgICAgICAgICAgICAgaWYgKHByb3BlcnRpZXMpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZXh0ID0gcHJvcGVydGllc1swXTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9lbmFibGVCQmNvZGUgPSBwcm9wZXJ0aWVzWzFdOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2NoYXJhY3RlcldpZHRoID0gcHJvcGVydGllc1syXTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9jaGFyYWN0ZXJIZWlnaHQgPSBwcm9wZXJ0aWVzWzNdOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2NoYXJhY3RlclNldCA9IHByb3BlcnRpZXNbNF07CiAgICAgICAgICAgICAgICAgICAgc3BhY2luZ0RhdGEgPSBwcm9wZXJ0aWVzWzVdOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2NoYXJhY3RlclNjYWxlID0gcHJvcGVydGllc1s2XTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9jaGFyYWN0ZXJTcGFjaW5nID0gcHJvcGVydGllc1s3XTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9saW5lSGVpZ2h0ID0gcHJvcGVydGllc1s4XTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9ob3Jpem9udGFsQWxpZ24gPQogICAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzWzldOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3ZlcnRpY2FsQWxpZ24gPSBwcm9wZXJ0aWVzWzEwXTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl93cmFwQnlXb3JkID0gcHJvcGVydGllc1sxMV0gPT09IDA7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgd2kgPSB0aGlzLkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICAgICAgICAgIHdpLlNldFZpc2libGUocHJvcGVydGllc1sxMl0pOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlYWRBbG91ZCA9ICEhcHJvcGVydGllc1tSRUFEX0FMT1VEXQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5fc2RrVHlwZS5VcGRhdGVTZXR0aW5ncyh0aGlzLl9jaGFyYWN0ZXJXaWR0aCwgdGhpcy5fY2hhcmFjdGVySGVpZ2h0LCB0aGlzLl9jaGFyYWN0ZXJTZXQsIHNwYWNpbmdEYXRhKTsKICAgICAgICAgICAgICAgIHRoaXMuX3Nwcml0ZUZvbnRUZXh0ID0gQzMuTmV3KHNlbGYuU3ByaXRlRm9udFRleHQsIHRoaXMuX3Nka1R5cGUuR2V0U3ByaXRlRm9udCgpKTsKICAgICAgICAgICAgICAgIGNvbnN0IHdpID0gdGhpcy5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgICAgIHRoaXMuX3Nwcml0ZUZvbnRUZXh0LlNldFNpemUod2kuR2V0V2lkdGgoKSwgd2kuR2V0SGVpZ2h0KCkpOwogICAgICAgICAgICAgICAgdGhpcy5fVXBkYXRlU2V0dGluZ3MoKTsKICAgICAgICAgICAgICAgIHRoaXMuX1VwZGF0ZVNjcmVlblJlYWRlclRleHQoKTsKICAgICAgICAgICAgICAgIHRoaXMuX2luc3QuU2V0TXVzdE1pdGlnYXRlWkZpZ2h0aW5nKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBSZWxlYXNlKCkgewogICAgICAgICAgICAgICAgdGhpcy5fQ2FuY2VsVHlwZXdyaXRlcigpOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuX3NjcmVlblJlYWRlclRleHQpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9zY3JlZW5SZWFkZXJUZXh0LlJlbGVhc2UoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9zY3JlZW5SZWFkZXJUZXh0ID0gbnVsbAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5fc3ByaXRlRm9udFRleHQuUmVsZWFzZSgpOwogICAgICAgICAgICAgICAgdGhpcy5fc3ByaXRlRm9udFRleHQgPSBudWxsOwogICAgICAgICAgICAgICAgc3VwZXIuUmVsZWFzZSgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX1VwZGF0ZVNldHRpbmdzKCkgewogICAgICAgICAgICAgICAgY29uc3Qgc2Z0ID0gdGhpcy5fc3ByaXRlRm9udFRleHQ7CiAgICAgICAgICAgICAgICBpZiAoIXNmdCkgcmV0dXJuOwogICAgICAgICAgICAgICAgc2Z0LlNldEJCQ29kZUVuYWJsZWQodGhpcy5fZW5hYmxlQkJjb2RlKTsKICAgICAgICAgICAgICAgIHNmdC5TZXRUZXh0KHRoaXMuX3RleHQpOwogICAgICAgICAgICAgICAgc2Z0LlNldFdvcmRXcmFwTW9kZSh0aGlzLl93cmFwQnlXb3JkID8gIndvcmQiIDogImNoYXJhY3RlciIpOwogICAgICAgICAgICAgICAgc2Z0LlNldEhvcml6b250YWxBbGlnbihIT1JJWk9OVEFMX0FMSUdOTUVOVFNbdGhpcy5faG9yaXpvbnRhbEFsaWduXSk7CiAgICAgICAgICAgICAgICBzZnQuU2V0VmVydGljYWxBbGlnbihWRVJUSUNBTF9BTElHTk1FTlRTW3RoaXMuX3ZlcnRpY2FsQWxpZ25dKTsKICAgICAgICAgICAgICAgIHNmdC5TZXRTcGFjaW5nKHRoaXMuX2NoYXJhY3RlclNwYWNpbmcpOwogICAgICAgICAgICAgICAgc2Z0LlNldExpbmVIZWlnaHQodGhpcy5fbGluZUhlaWdodCkKICAgICAgICAgICAgfQogICAgICAgICAgICBfVXBkYXRlU2NyZWVuUmVhZGVyVGV4dCgpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9yZWFkQWxvdWQpIHsKICAgICAgICAgICAgICAgICAgICBsZXQgdGV4dCA9IHRoaXMuX3RleHQ7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX2VuYWJsZUJCY29kZSkgdGV4dCA9IEMzLkJCU3RyaW5nLlN0cmlwQW55VGFncyh0ZXh0KTsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fc2NyZWVuUmVhZGVyVGV4dCkgdGhpcy5fc2NyZWVuUmVhZGVyVGV4dC5TZXRUZXh0KHRleHQpOwogICAgICAgICAgICAgICAgICAgIGVsc2UgdGhpcy5fc2NyZWVuUmVhZGVyVGV4dCA9IEMzLk5ldyhDMy5TY3JlZW5SZWFkZXJUZXh0LCB0aGlzLl9ydW50aW1lLCB0ZXh0KQogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLl9zY3JlZW5SZWFkZXJUZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2NyZWVuUmVhZGVyVGV4dC5SZWxlYXNlKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2NyZWVuUmVhZGVyVGV4dCA9IG51bGwKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBEcmF3KHJlbmRlcmVyKSB7CiAgICAgICAgICAgICAgICBjb25zdCBpbWFnZUluZm8gPSB0aGlzLl9vYmplY3RDbGFzcy5HZXRJbWFnZUluZm8oKTsKICAgICAgICAgICAgICAgIGNvbnN0IHRleHR1cmUgPQogICAgICAgICAgICAgICAgICAgIGltYWdlSW5mby5HZXRUZXh0dXJlKCk7CiAgICAgICAgICAgICAgICBpZiAoIXRleHR1cmUpIHJldHVybjsKICAgICAgICAgICAgICAgIHJlbmRlcmVyLlNldFRleHR1cmUodGV4dHVyZSk7CiAgICAgICAgICAgICAgICBjb25zdCB3aSA9IHRoaXMuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgICAgICBsZXQgcSA9IHdpLkdldEJvdW5kaW5nUXVhZCgpOwogICAgICAgICAgICAgICAgY29uc3Qgc2Z0ID0gdGhpcy5fc3ByaXRlRm9udFRleHQ7CiAgICAgICAgICAgICAgICBzZnQuU2V0U2NhbGUodGhpcy5fY2hhcmFjdGVyU2NhbGUpOwogICAgICAgICAgICAgICAgc2Z0LlNldFNjZW5lR3JhcGhTY2FsZSh3aS5HZXRTY2VuZUdyYXBoU2NhbGUoKSk7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fcnVudGltZS5Jc1BpeGVsUm91bmRpbmdFbmFibGVkKCkpIHEgPSB3aS5QaXhlbFJvdW5kUXVhZChxKTsKICAgICAgICAgICAgICAgIHNmdC5TZXRTaXplKHdpLkdldFdpZHRoKCksIHdpLkdldEhlaWdodCgpKTsKICAgICAgICAgICAgICAgIHNmdC5HZXRTcHJpdGVGb250KCkuU2V0VGV4UmVjdChpbWFnZUluZm8uR2V0VGV4UmVjdCgpKTsKICAgICAgICAgICAgICAgIHNmdC5TZXRDb2xvcih3aS5HZXRVbnByZW11bHRpcGxpZWRDb2xvcigpKTsKICAgICAgICAgICAgICAgIHNmdC5EcmF3KHJlbmRlcmVyLCBxLmdldFRseCgpLCBxLmdldFRseSgpLCB3aS5HZXRBbmdsZSgpKQogICAgICAgICAgICB9CiAgICAgICAgICAgIFNhdmVUb0pzb24oKSB7CiAgICAgICAgICAgICAgICBjb25zdCByZXQgPSB7CiAgICAgICAgICAgICAgICAgICAgInQiOiB0aGlzLl90ZXh0LAogICAgICAgICAgICAgICAgICAgICJlYmJjIjogdGhpcy5fZW5hYmxlQkJjb2RlLAogICAgICAgICAgICAgICAgICAgICJjc2MiOiB0aGlzLl9jaGFyYWN0ZXJTY2FsZSwKICAgICAgICAgICAgICAgICAgICAiY3NwIjogdGhpcy5fY2hhcmFjdGVyU3BhY2luZywKICAgICAgICAgICAgICAgICAgICAibGgiOiB0aGlzLl9saW5lSGVpZ2h0LAogICAgICAgICAgICAgICAgICAgICJoYSI6IHRoaXMuX2hvcml6b250YWxBbGlnbiwKICAgICAgICAgICAgICAgICAgICAidmEiOiB0aGlzLl92ZXJ0aWNhbEFsaWduLAogICAgICAgICAgICAgICAgICAgICJ3IjogdGhpcy5fd3JhcEJ5V29yZCwKICAgICAgICAgICAgICAgICAgICAiY3ciOiB0aGlzLl9zZGtUeXBlLkdldFNwcml0ZUZvbnQoKS5HZXRDaGFyYWN0ZXJXaWR0aCgpLAogICAgICAgICAgICAgICAgICAgICJjaCI6IHRoaXMuX3Nka1R5cGUuR2V0U3ByaXRlRm9udCgpLkdldENoYXJhY3RlckhlaWdodCgpLAogICAgICAgICAgICAgICAgICAgICJjcyI6IHRoaXMuX3Nka1R5cGUuR2V0U3ByaXRlRm9udCgpLkdldENoYXJhY3RlclNldCgpLAogICAgICAgICAgICAgICAgICAgICJzZCI6IHRoaXMuX3Nka1R5cGUuR2V0U3ByaXRlRm9udCgpLkdldFNwYWNpbmdEYXRhKCkKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fdHlwZXdyaXRlckVuZFRpbWUgIT09IC0xKSByZXRbInR3Il0gPSB7CiAgICAgICAgICAgICAgICAgICAgInN0IjogdGhpcy5fdHlwZXdyaXRlclN0YXJ0VGltZSwKICAgICAgICAgICAgICAgICAgICAiZW4iOiB0aGlzLl90eXBld3JpdGVyRW5kVGltZSwKICAgICAgICAgICAgICAgICAgICAibCI6IHRoaXMuX3R5cGV3cml0ZXJMZW5ndGgKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICByZXR1cm4gcmV0CiAgICAgICAgICAgIH0KICAgICAgICAgICAgTG9hZEZyb21Kc29uKG8pIHsKICAgICAgICAgICAgICAgIHRoaXMuX0NhbmNlbFR5cGV3cml0ZXIoKTsKICAgICAgICAgICAgICAgIHRoaXMuX3RleHQgPSBvWyJ0Il07CiAgICAgICAgICAgICAgICB0aGlzLl9lbmFibGVCQmNvZGUgPSBvWyJlYmJjIl07CiAgICAgICAgICAgICAgICB0aGlzLl9jaGFyYWN0ZXJTY2FsZSA9IG9bImNzYyJdOwogICAgICAgICAgICAgICAgdGhpcy5fY2hhcmFjdGVyU3BhY2luZyA9IG9bImNzcCJdOwogICAgICAgICAgICAgICAgdGhpcy5fbGluZUhlaWdodCA9IG9bImxoIl07CiAgICAgICAgICAgICAgICB0aGlzLl9ob3Jpem9udGFsQWxpZ24gPSBvWyJoYSJdOwogICAgICAgICAgICAgICAgdGhpcy5fdmVydGljYWxBbGlnbiA9IG9bInZhIl07CiAgICAgICAgICAgICAgICB0aGlzLl93cmFwQnlXb3JkID0gb1sidyJdOwogICAgICAgICAgICAgICAgaWYgKG8uaGFzT3duUHJvcGVydHkoInR3IikpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCB0dyA9IG9bInR3Il07CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdHlwZXdyaXRlclN0YXJ0VGltZSA9IHR3WyJzdCJdOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3R5cGV3cml0ZXJFbmRUaW1lID0gdHdbImVuIl07CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdHlwZXdyaXRlckxlbmd0aCA9IG9bImwiXQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY29uc3Qgc3ByaXRlRm9udCA9IHRoaXMuX3Nka1R5cGUuR2V0U3ByaXRlRm9udCgpOwogICAgICAgICAgICAgICAgc3ByaXRlRm9udC5TZXRDaGFyYWN0ZXJXaWR0aChvWyJjdyJdKTsKICAgICAgICAgICAgICAgIHNwcml0ZUZvbnQuU2V0Q2hhcmFjdGVySGVpZ2h0KG9bImNoIl0pOwogICAgICAgICAgICAgICAgc3ByaXRlRm9udC5TZXRDaGFyYWN0ZXJTZXQob1siY3MiXSk7CiAgICAgICAgICAgICAgICBzcHJpdGVGb250LlNldFNwYWNpbmdEYXRhKG9bInNkIl0pOwogICAgICAgICAgICAgICAgdGhpcy5fVXBkYXRlU2V0dGluZ3MoKTsKICAgICAgICAgICAgICAgIHRoaXMuX1VwZGF0ZVNjcmVlblJlYWRlclRleHQoKTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl90eXBld3JpdGVyRW5kVGltZSAhPT0gLTEpIHRoaXMuX1N0YXJ0VGlja2luZygpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgR2V0UHJvcGVydHlWYWx1ZUJ5SW5kZXgoaW5kZXgpIHsKICAgICAgICAgICAgICAgIHN3aXRjaCAoaW5kZXgpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlIFRFWFQ6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLkdldFRleHQoKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIEVOQUJMRV9CQkNPREU6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9lbmFibGVCQmNvZGU7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBDSEFSQUNURVJfV0lEVEg6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9zZGtUeXBlLkdldFNwcml0ZUZvbnQoKS5HZXRDaGFyYWN0ZXJXaWR0aCgpOwogICAgICAgICAgICAgICAgICAgIGNhc2UgQ0hBUkFDVEVSX0hFSUdIVDoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3Nka1R5cGUuR2V0U3ByaXRlRm9udCgpLkdldENoYXJhY3RlckhlaWdodCgpOwogICAgICAgICAgICAgICAgICAgIGNhc2UgQ0hBUkFDVEVSX1NFVDoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3Nka1R5cGUuR2V0U3ByaXRlRm9udCgpLkdldENoYXJhY3RlclNldCgpOwogICAgICAgICAgICAgICAgICAgIGNhc2UgU1BBQ0lOR19EQVRBOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fc2RrVHlwZS5HZXRTcHJpdGVGb250KCkuR2V0U3BhY2luZ0RhdGEoKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIFNDQUxFOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fR2V0U2NhbGUoKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIENIQVJBQ1RFUl9TUEFDSU5HOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fR2V0Q2hhcmFjdGVyU3BhY2luZygpOwogICAgICAgICAgICAgICAgICAgIGNhc2UgTElORV9IRUlHSFQ6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9HZXRMaW5lSGVpZ2h0KCk7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBIT1JJWk9OVEFMX0FMSUdOTUVOVDoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX0dldEhBbGlnbigpOwogICAgICAgICAgICAgICAgICAgIGNhc2UgVkVSVElDQUxfQUxJR05NRU5UOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fR2V0VkFsaWduKCk7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBXUkFQUElORzoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX0lzV3JhcEJ5V29yZCgpID8gQ0hBUkFDVEVSX1dSQVAgOiBXT1JEX1dSQVAKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBTZXRQcm9wZXJ0eVZhbHVlQnlJbmRleChpbmRleCwgdmFsdWUpIHsKICAgICAgICAgICAgICAgIHN3aXRjaCAoaW5kZXgpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlIFRFWFQ6CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX1NldFRleHQodmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIEVOQUJMRV9CQkNPREU6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9lbmFibGVCQmNvZGUgPT09CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAhIXZhbHVlKSByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2VuYWJsZUJCY29kZSA9ICEhdmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX1VwZGF0ZVNldHRpbmdzKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgQ0hBUkFDVEVSX1dJRFRIOgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9zZGtUeXBlLkdldFNwcml0ZUZvbnQoKS5TZXRDaGFyYWN0ZXJXaWR0aCh2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgQ0hBUkFDVEVSX0hFSUdIVDoKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2RrVHlwZS5HZXRTcHJpdGVGb250KCkuU2V0Q2hhcmFjdGVySGVpZ2h0KHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBDSEFSQUNURVJfU0VUOgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9zZGtUeXBlLkdldFNwcml0ZUZvbnQoKS5TZXRDaGFyYWN0ZXJTZXQodmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIFNQQUNJTkdfREFUQToKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2RrVHlwZS5HZXRTcHJpdGVGb250KCkuU2V0U3BhY2luZ0RhdGEodmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIFNDQUxFOgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9TZXRTY2FsZSh2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgQ0hBUkFDVEVSX1NQQUNJTkc6CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX1NldENoYXJhY3RlclNwYWNpbmcodmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIExJTkVfSEVJR0hUOgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9TZXRMaW5lSGVpZ2h0KHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBIT1JJWk9OVEFMX0FMSUdOTUVOVDoKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fU2V0SEFsaWduKHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBWRVJUSUNBTF9BTElHTk1FTlQ6CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX1NldFZBbGlnbih2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgV1JBUFBJTkc6CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX1NldFdyYXBCeVdvcmQodmFsdWUgPT09IFdPUkRfV1JBUCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX1NldFRleHQodGV4dCkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuX3RleHQgPT09IHRleHQpIHJldHVybjsKICAgICAgICAgICAgICAgIHRoaXMuX3RleHQgPSB0ZXh0OwogICAgICAgICAgICAgICAgdGhpcy5fc3ByaXRlRm9udFRleHQuU2V0VGV4dCh0ZXh0KTsKICAgICAgICAgICAgICAgIHRoaXMuX1VwZGF0ZVNjcmVlblJlYWRlclRleHQoKTsKICAgICAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuVXBkYXRlUmVuZGVyKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBHZXRUZXh0KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RleHQKICAgICAgICAgICAgfQogICAgICAgICAgICBfU3RhcnRUeXBld3JpdGVyKHRleHQsIGR1cmF0aW9uKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9TZXRUZXh0KHRleHQpOwogICAgICAgICAgICAgICAgdGhpcy5fdHlwZXdyaXRlclN0YXJ0VGltZSA9IHRoaXMuX3J1bnRpbWUuR2V0V2FsbFRpbWUoKTsKICAgICAgICAgICAgICAgIHRoaXMuX3R5cGV3cml0ZXJFbmRUaW1lID0gdGhpcy5fdHlwZXdyaXRlclN0YXJ0VGltZSArCiAgICAgICAgICAgICAgICAgICAgZHVyYXRpb24gLyB0aGlzLkdldEluc3RhbmNlKCkuR2V0QWN0aXZlVGltZVNjYWxlKCk7CiAgICAgICAgICAgICAgICB0aGlzLl90eXBld3JpdGVyTGVuZ3RoID0gQzMuQ291bnRHcmFwaGVtZXMoQzMuQkJTdHJpbmcuU3RyaXBBbnlUYWdzKHRleHQpKTsKICAgICAgICAgICAgICAgIHRoaXMuX3Nwcml0ZUZvbnRUZXh0LlNldERyYXdNYXhDaGFyYWN0ZXJDb3VudCgwKTsKICAgICAgICAgICAgICAgIHRoaXMuX1N0YXJ0VGlja2luZygpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX0NhbmNlbFR5cGV3cml0ZXIoKSB7CiAgICAgICAgICAgICAgICB0aGlzLl90eXBld3JpdGVyU3RhcnRUaW1lID0gLTE7CiAgICAgICAgICAgICAgICB0aGlzLl90eXBld3JpdGVyRW5kVGltZSA9IC0xOwogICAgICAgICAgICAgICAgdGhpcy5fdHlwZXdyaXRlckxlbmd0aCA9IDA7CiAgICAgICAgICAgICAgICB0aGlzLl9zcHJpdGVGb250VGV4dC5TZXREcmF3TWF4Q2hhcmFjdGVyQ291bnQoLTEpOwogICAgICAgICAgICAgICAgdGhpcy5fU3RvcFRpY2tpbmcoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9GaW5pc2hUeXBld3JpdGVyKCkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuX3R5cGV3cml0ZXJFbmRUaW1lID09PSAtMSkgcmV0dXJuOwogICAgICAgICAgICAgICAgdGhpcy5fQ2FuY2VsVHlwZXdyaXRlcigpOwogICAgICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKEMzLlBsdWdpbnMuU3ByaXRlZm9udDIuQ25kcy5PblR5cGV3cml0ZXJUZXh0RmluaXNoZWQpOwogICAgICAgICAgICAgICAgdGhpcy5fcnVudGltZS5VcGRhdGVSZW5kZXIoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9TZXRTY2FsZShzKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fY2hhcmFjdGVyU2NhbGUgPT09IHMpIHJldHVybjsKICAgICAgICAgICAgICAgIHRoaXMuX2NoYXJhY3RlclNjYWxlID0gczsKICAgICAgICAgICAgICAgIHRoaXMuX3Nwcml0ZUZvbnRUZXh0LlNldFNjYWxlKHRoaXMuX2NoYXJhY3RlclNjYWxlKTsKICAgICAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuVXBkYXRlUmVuZGVyKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBfR2V0U2NhbGUoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fY2hhcmFjdGVyU2NhbGUKICAgICAgICAgICAgfQogICAgICAgICAgICBfU2V0Q2hhcmFjdGVyU3BhY2luZyhzKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fY2hhcmFjdGVyU3BhY2luZyA9PT0gcykgcmV0dXJuOwogICAgICAgICAgICAgICAgdGhpcy5fY2hhcmFjdGVyU3BhY2luZyA9IHM7CiAgICAgICAgICAgICAgICB0aGlzLl9zcHJpdGVGb250VGV4dC5TZXRTcGFjaW5nKHRoaXMuX2NoYXJhY3RlclNwYWNpbmcpOwogICAgICAgICAgICAgICAgdGhpcy5fcnVudGltZS5VcGRhdGVSZW5kZXIoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9HZXRDaGFyYWN0ZXJTcGFjaW5nKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NoYXJhY3RlclNwYWNpbmcKICAgICAgICAgICAgfQogICAgICAgICAgICBfU2V0TGluZUhlaWdodChoKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fbGluZUhlaWdodCA9PT0gaCkgcmV0dXJuOwogICAgICAgICAgICAgICAgdGhpcy5fbGluZUhlaWdodCA9CiAgICAgICAgICAgICAgICAgICAgaDsKICAgICAgICAgICAgICAgIHRoaXMuX3Nwcml0ZUZvbnRUZXh0LlNldExpbmVIZWlnaHQodGhpcy5fbGluZUhlaWdodCk7CiAgICAgICAgICAgICAgICB0aGlzLl9ydW50aW1lLlVwZGF0ZVJlbmRlcigpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX0dldExpbmVIZWlnaHQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fbGluZUhlaWdodAogICAgICAgICAgICB9CiAgICAgICAgICAgIF9TZXRIQWxpZ24oaCkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuX2hvcml6b250YWxBbGlnbiA9PT0gaCkgcmV0dXJuOwogICAgICAgICAgICAgICAgdGhpcy5faG9yaXpvbnRhbEFsaWduID0gaDsKICAgICAgICAgICAgICAgIHRoaXMuX1VwZGF0ZVNldHRpbmdzKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9ydW50aW1lLlVwZGF0ZVJlbmRlcigpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX0dldEhBbGlnbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9ob3Jpem9udGFsQWxpZ24KICAgICAgICAgICAgfQogICAgICAgICAgICBfU2V0VkFsaWduKHYpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl92ZXJ0aWNhbEFsaWduID09PSB2KSByZXR1cm47CiAgICAgICAgICAgICAgICB0aGlzLl92ZXJ0aWNhbEFsaWduID0gdjsKICAgICAgICAgICAgICAgIHRoaXMuX1VwZGF0ZVNldHRpbmdzKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9ydW50aW1lLlVwZGF0ZVJlbmRlcigpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX0dldFZBbGlnbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl92ZXJ0aWNhbEFsaWduCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX1NldFdyYXBCeVdvcmQodykgewogICAgICAgICAgICAgICAgdyA9ICEhdzsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl93cmFwQnlXb3JkID09PQogICAgICAgICAgICAgICAgICAgIHcpIHJldHVybjsKICAgICAgICAgICAgICAgIHRoaXMuX3dyYXBCeVdvcmQgPSB3OwogICAgICAgICAgICAgICAgdGhpcy5fVXBkYXRlU2V0dGluZ3MoKTsKICAgICAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuVXBkYXRlUmVuZGVyKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBfSXNXcmFwQnlXb3JkKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3dyYXBCeVdvcmQKICAgICAgICAgICAgfQogICAgICAgICAgICBfU2V0UmVhZEFsb3VkKHIpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3JlYWRBbG91ZCA9ICEhcjsKICAgICAgICAgICAgICAgIHRoaXMuX1VwZGF0ZVNjcmVlblJlYWRlclRleHQoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9Jc1JlYWRBbG91ZCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9yZWFkQWxvdWQKICAgICAgICAgICAgfQogICAgICAgICAgICBfR2V0VGV4dFdpZHRoKCkgewogICAgICAgICAgICAgICAgY29uc3Qgd2kgPSB0aGlzLkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICAgICAgdGhpcy5fc3ByaXRlRm9udFRleHQuU2V0U2l6ZSh3aS5HZXRXaWR0aCgpLCB3aS5HZXRIZWlnaHQoKSk7CiAgICAgICAgICAgICAgICB0aGlzLl9zcHJpdGVGb250VGV4dC5TZXRTY2FsZSh0aGlzLl9jaGFyYWN0ZXJTY2FsZSk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fc3ByaXRlRm9udFRleHQuR2V0VGV4dFdpZHRoKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBfR2V0VGV4dEhlaWdodCgpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHdpID0gdGhpcy5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgICAgIHRoaXMuX3Nwcml0ZUZvbnRUZXh0LlNldFNpemUod2kuR2V0V2lkdGgoKSwKICAgICAgICAgICAgICAgICAgICB3aS5HZXRIZWlnaHQoKSk7CiAgICAgICAgICAgICAgICB0aGlzLl9zcHJpdGVGb250VGV4dC5TZXRTY2FsZSh0aGlzLl9jaGFyYWN0ZXJTY2FsZSk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fc3ByaXRlRm9udFRleHQuR2V0VGV4dEhlaWdodCgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX0dldFRhZ0F0UG9zaXRpb24oeCwgeSkgewogICAgICAgICAgICAgICAgY29uc3Qgd2kgPSB0aGlzLkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICAgICAgdGVtcFZlYzIuc2V0KHggLSB3aS5HZXRYKCksIHkgLSB3aS5HZXRZKCkpOwogICAgICAgICAgICAgICAgdGVtcFZlYzIucm90YXRlKC13aS5HZXRBbmdsZSgpKTsKICAgICAgICAgICAgICAgIHRlbXBWZWMyLm9mZnNldCh3aS5HZXRXaWR0aCgpICogd2kuR2V0T3JpZ2luWCgpLCB3aS5HZXRIZWlnaHQoKSAqIHdpLkdldE9yaWdpblkoKSk7CiAgICAgICAgICAgICAgICBjb25zdCBmcmFnID0gdGhpcy5fc3ByaXRlRm9udFRleHQuSGl0VGVzdEZyYWdtZW50KHRlbXBWZWMyLmdldFgoKSwgdGVtcFZlYzIuZ2V0WSgpKTsKICAgICAgICAgICAgICAgIGlmIChmcmFnKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZnJhZ1RhZ1N0eWxlID0gdGhpcy5fc3ByaXRlRm9udFRleHQuX0dldFN0eWxlVGFnKGZyYWcuc3R5bGVzLCAidGFnIik7CiAgICAgICAgICAgICAgICAgICAgaWYgKGZyYWdUYWdTdHlsZSkgcmV0dXJuIGZyYWdUYWdTdHlsZS5wYXJhbQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuICIiCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX0hhc1RhZ0F0UG9zaXRpb24odGFnLAogICAgICAgICAgICAgICAgeCwgeSkgewogICAgICAgICAgICAgICAgY29uc3QgaGl0VGFnID0gdGhpcy5fR2V0VGFnQXRQb3NpdGlvbih4LCB5KTsKICAgICAgICAgICAgICAgIHJldHVybiBoaXRUYWcgJiYgQzMuZXF1YWxzTm9DYXNlKHRhZywgaGl0VGFnKQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9HZXRUYWdQb3NpdGlvbih0YWcsIGluZGV4KSB7CiAgICAgICAgICAgICAgICBpbmRleCA9IE1hdGguZmxvb3IoaW5kZXgpOwogICAgICAgICAgICAgICAgY29uc3QgZnJhZyA9IHRoaXMuX3Nwcml0ZUZvbnRUZXh0LkZpbmRGcmFnbWVudFdpdGhUYWcodGFnLCBpbmRleCk7CiAgICAgICAgICAgICAgICBpZiAoIWZyYWcpIHJldHVybiBudWxsOwogICAgICAgICAgICAgICAgY29uc3Qgd2kgPSB0aGlzLkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICAgICAgdGVtcFZlYzIuc2V0KGZyYWcucGVuWCwgZnJhZy5wZW5ZKTsKICAgICAgICAgICAgICAgIHRlbXBWZWMyLm9mZnNldCgtd2kuR2V0V2lkdGgoKSAqIHdpLkdldE9yaWdpblgoKSwgLXdpLkdldEhlaWdodCgpICogd2kuR2V0T3JpZ2luWSgpKTsKICAgICAgICAgICAgICAgIHRlbXBWZWMyLnJvdGF0ZSh3aS5HZXRBbmdsZSgpKTsKICAgICAgICAgICAgICAgIHRlbXBWZWMyLm9mZnNldCh3aS5HZXRYKCksIHdpLkdldFkoKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgIHg6IHRlbXBWZWMyLmdldFgoKSwKICAgICAgICAgICAgICAgICAgICB5OiB0ZW1wVmVjMi5nZXRZKCksCiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IGZyYWcud2lkdGgsCiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBmcmFnLmhlaWdodAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9HZXRUYWdDb3VudCh0YWcpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9zcHJpdGVGb250VGV4dC5Db3VudEZyYWdtZW50c1dpdGhUYWcodGFnKQogICAgICAgICAgICB9CiAgICAgICAgICAgIFRpY2soKSB7CiAgICAgICAgICAgICAgICBjb25zdCB3YWxsVGltZSA9CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcnVudGltZS5HZXRXYWxsVGltZSgpOwogICAgICAgICAgICAgICAgaWYgKHdhbGxUaW1lID49IHRoaXMuX3R5cGV3cml0ZXJFbmRUaW1lKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fQ2FuY2VsVHlwZXdyaXRlcigpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuVHJpZ2dlcihDMy5QbHVnaW5zLlNwcml0ZWZvbnQyLkNuZHMuT25UeXBld3JpdGVyVGV4dEZpbmlzaGVkKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9ydW50aW1lLlVwZGF0ZVJlbmRlcigpCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGxldCBkaXNwbGF5TGVuZ3RoID0gQzMucmVsZXJwKHRoaXMuX3R5cGV3cml0ZXJTdGFydFRpbWUsIHRoaXMuX3R5cGV3cml0ZXJFbmRUaW1lLCB3YWxsVGltZSwgMCwgdGhpcy5fdHlwZXdyaXRlckxlbmd0aCk7CiAgICAgICAgICAgICAgICAgICAgZGlzcGxheUxlbmd0aCA9IE1hdGguZmxvb3IoZGlzcGxheUxlbmd0aCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGRpc3BsYXlMZW5ndGggIT09IHRoaXMuX3Nwcml0ZUZvbnRUZXh0LkdldERyYXdNYXhDaGFyYWN0ZXJDb3VudCgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3Nwcml0ZUZvbnRUZXh0LlNldERyYXdNYXhDaGFyYWN0ZXJDb3VudChkaXNwbGF5TGVuZ3RoKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcnVudGltZS5VcGRhdGVSZW5kZXIoKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBHZXREZWJ1Z2dlclByb3BlcnRpZXMoKSB7CiAgICAgICAgICAgICAgICBjb25zdCBwcmVmaXggPQogICAgICAgICAgICAgICAgICAgICJwbHVnaW5zLnNwcml0ZWZvbnQyIjsKICAgICAgICAgICAgICAgIHJldHVybiBbewogICAgICAgICAgICAgICAgICAgIHRpdGxlOiBwcmVmaXggKyAiLm5hbWUiLAogICAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IFt7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHByZWZpeCArICIucHJvcGVydGllcy50ZXh0Lm5hbWUiLAogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5HZXRUZXh0KCksCiAgICAgICAgICAgICAgICAgICAgICAgIG9uZWRpdDogdiA9PiB0aGlzLl9TZXRUZXh0KHYpCiAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBwcmVmaXggKyAiLnByb3BlcnRpZXMuc2NhbGUubmFtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLl9HZXRTY2FsZSgpLAogICAgICAgICAgICAgICAgICAgICAgICBvbmVkaXQ6IHYgPT4gdGhpcy5fU2V0U2NhbGUodikKICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHByZWZpeCArICIucHJvcGVydGllcy5jaGFyYWN0ZXItc3BhY2luZy5uYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuX0dldENoYXJhY3RlclNwYWNpbmcoKSwKICAgICAgICAgICAgICAgICAgICAgICAgb25lZGl0OiB2ID0+IHRoaXMuX1NldENoYXJhY3RlclNwYWNpbmcodikKICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHByZWZpeCArICIucHJvcGVydGllcy5saW5lLWhlaWdodC5uYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuX0dldExpbmVIZWlnaHQoKSwKICAgICAgICAgICAgICAgICAgICAgICAgb25lZGl0OiB2ID0+IHRoaXMuX1NldExpbmVIZWlnaHQodikKICAgICAgICAgICAgICAgICAgICB9XQogICAgICAgICAgICAgICAgfV0KICAgICAgICAgICAgfQogICAgICAgICAgICBHZXRTY3JpcHRJbnRlcmZhY2VDbGFzcygpIHsKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLklTcHJpdGVGb250SW5zdGFuY2UKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgY29uc3QgbWFwID0gbmV3IFdlYWtNYXA7CiAgICAgICAgY29uc3QgU0NSSVBUX0hPUklaT05UQUxfQUxJR05NRU5UUyA9IG5ldyBNYXAoWwogICAgICAgICAgICBbImxlZnQiLCAwXSwKICAgICAgICAgICAgWyJjZW50ZXIiLCAxXSwKICAgICAgICAgICAgWyJyaWdodCIsIDJdCiAgICAgICAgXSk7CiAgICAgICAgY29uc3QgU0NSSVBUX1ZFUlRJQ0FMX0FMSUdOTUVOVFMgPSBuZXcgTWFwKFsKICAgICAgICAgICAgWyJ0b3AiLCAwXSwKICAgICAgICAgICAgWyJjZW50ZXIiLCAxXSwKICAgICAgICAgICAgWyJib3R0b20iLCAyXQogICAgICAgIF0pOwogICAgICAgIGNvbnN0IFNDUklQVF9XUkFQX01PREVTID0gbmV3IE1hcChbCiAgICAgICAgICAgIFsid29yZCIsIHRydWVdLAogICAgICAgICAgICBbImNoYXJhY3RlciIsIGZhbHNlXQogICAgICAgIF0pOwogICAgICAgIHNlbGYuSVNwcml0ZUZvbnRJbnN0YW5jZSA9IGNsYXNzIElTcHJpdGVGb250SW5zdGFuY2UgZXh0ZW5kcyBzZWxmLklXb3JsZEluc3RhbmNlIHsKICAgICAgICAgICAgY29uc3RydWN0b3IoKSB7CiAgICAgICAgICAgICAgICBzdXBlcigpOwogICAgICAgICAgICAgICAgbWFwLnNldCh0aGlzLCBzZWxmLklJbnN0YW5jZS5fR2V0SW5pdEluc3QoKS5HZXRTZGtJbnN0YW5jZSgpKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGdldCB0ZXh0KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIG1hcC5nZXQodGhpcykuR2V0VGV4dCgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2V0IHRleHQoc3RyKSB7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZVN0cmluZyhzdHIpOwogICAgICAgICAgICAgICAgY29uc3QgaW5zdCA9CiAgICAgICAgICAgICAgICAgICAgbWFwLmdldCh0aGlzKTsKICAgICAgICAgICAgICAgIGluc3QuX0NhbmNlbFR5cGV3cml0ZXIoKTsKICAgICAgICAgICAgICAgIGluc3QuX1NldFRleHQoc3RyKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHR5cGV3cml0ZXJUZXh0KHN0ciwgZHVyYXRpb24pIHsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlU3RyaW5nKHN0cik7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcihkdXJhdGlvbik7CiAgICAgICAgICAgICAgICBjb25zdCBpbnN0ID0gbWFwLmdldCh0aGlzKTsKICAgICAgICAgICAgICAgIGluc3QuX0NhbmNlbFR5cGV3cml0ZXIoKTsKICAgICAgICAgICAgICAgIGluc3QuX1N0YXJ0VHlwZXdyaXRlcihzdHIsIGR1cmF0aW9uKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHR5cGV3cml0ZXJGaW5pc2goKSB7CiAgICAgICAgICAgICAgICBtYXAuZ2V0KHRoaXMpLl9GaW5pc2hUeXBld3JpdGVyKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBzZXQgY2hhcmFjdGVyU2NhbGUocykgewogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVGaW5pdGVOdW1iZXIocyk7CiAgICAgICAgICAgICAgICBtYXAuZ2V0KHRoaXMpLl9TZXRTY2FsZShzKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGdldCBjaGFyYWN0ZXJTY2FsZSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBtYXAuZ2V0KHRoaXMpLl9HZXRTY2FsZSgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2V0IGNoYXJhY3RlclNwYWNpbmcocykgewogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVGaW5pdGVOdW1iZXIocyk7CiAgICAgICAgICAgICAgICBtYXAuZ2V0KHRoaXMpLl9TZXRDaGFyYWN0ZXJTcGFjaW5nKHMpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZ2V0IGNoYXJhY3RlclNwYWNpbmcoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbWFwLmdldCh0aGlzKS5fR2V0Q2hhcmFjdGVyU3BhY2luZygpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2V0IGxpbmVIZWlnaHQobGhvKSB7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcihsaG8pOwogICAgICAgICAgICAgICAgbWFwLmdldCh0aGlzKS5fU2V0TGluZUhlaWdodChsaG8pCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZ2V0IGxpbmVIZWlnaHQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbWFwLmdldCh0aGlzKS5fR2V0TGluZUhlaWdodCgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2V0IGhvcml6b250YWxBbGlnbihzdHIpIHsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlU3RyaW5nKHN0cik7CiAgICAgICAgICAgICAgICBjb25zdCBoID0gU0NSSVBUX0hPUklaT05UQUxfQUxJR05NRU5UUy5nZXQoc3RyKTsKICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgaCA9PT0gInVuZGVmaW5lZCIpIHRocm93IG5ldyBFcnJvcigiaW52YWxpZCBtb2RlIik7CiAgICAgICAgICAgICAgICBtYXAuZ2V0KHRoaXMpLl9TZXRIQWxpZ24oaCkKICAgICAgICAgICAgfQogICAgICAgICAgICBnZXQgaG9yaXpvbnRhbEFsaWduKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIEhPUklaT05UQUxfQUxJR05NRU5UU1ttYXAuZ2V0KHRoaXMpLl9HZXRIQWxpZ24oKV0KICAgICAgICAgICAgfQogICAgICAgICAgICBzZXQgdmVydGljYWxBbGlnbihzdHIpIHsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlU3RyaW5nKHN0cik7CiAgICAgICAgICAgICAgICBjb25zdCB2ID0gU0NSSVBUX1ZFUlRJQ0FMX0FMSUdOTUVOVFMuZ2V0KHN0cik7CiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHYgPT09ICJ1bmRlZmluZWQiKSB0aHJvdyBuZXcgRXJyb3IoImludmFsaWQgbW9kZSIpOwogICAgICAgICAgICAgICAgbWFwLmdldCh0aGlzKS5fU2V0VkFsaWduKHYpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZ2V0IHZlcnRpY2FsQWxpZ24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gVkVSVElDQUxfQUxJR05NRU5UU1ttYXAuZ2V0KHRoaXMpLl9HZXRWQWxpZ24oKV0KICAgICAgICAgICAgfQogICAgICAgICAgICBzZXQgd29yZFdyYXBNb2RlKHN0cikgewogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVTdHJpbmcoc3RyKTsKICAgICAgICAgICAgICAgIGNvbnN0IGlzV3JhcEJ5V29yZCA9IFNDUklQVF9XUkFQX01PREVTLmdldChzdHIpOwogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBpc1dyYXBCeVdvcmQgPT09ICJ1bmRlZmluZWQiKSB0aHJvdyBuZXcgRXJyb3IoImludmFsaWQgbW9kZSIpOwogICAgICAgICAgICAgICAgbWFwLmdldCh0aGlzKS5fU2V0V3JhcEJ5V29yZChpc1dyYXBCeVdvcmQpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZ2V0IHdvcmRXcmFwTW9kZSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBtYXAuZ2V0KHRoaXMpLl9Jc1dyYXBCeVdvcmQoKSA/ICJ3b3JkIiA6ICJjaGFyYWN0ZXIiCiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2V0IHJlYWRBbG91ZChyKSB7CiAgICAgICAgICAgICAgICBtYXAuZ2V0KHRoaXMpLl9TZXRSZWFkQWxvdWQoISFyKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGdldCByZWFkQWxvdWQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbWFwLmdldCh0aGlzKS5fSXNSZWFkQWxvdWQoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGdldCB0ZXh0V2lkdGgoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbWFwLmdldCh0aGlzKS5fR2V0VGV4dFdpZHRoKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBnZXQgdGV4dEhlaWdodCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBtYXAuZ2V0KHRoaXMpLl9HZXRUZXh0SGVpZ2h0KCkKICAgICAgICAgICAgfQogICAgICAgICAgICBnZXRUZXh0U2l6ZSgpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGluc3QgPSBtYXAuZ2V0KHRoaXMpOwogICAgICAgICAgICAgICAgcmV0dXJuIFtpbnN0Ll9HZXRUZXh0V2lkdGgoKSwKICAgICAgICAgICAgICAgICAgICBpbnN0Ll9HZXRUZXh0SGVpZ2h0KCkKICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgfQogICAgICAgICAgICBoYXNUYWdBdFBvc2l0aW9uKHRhZywgeCwgeSkgewogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVTdHJpbmcodGFnKTsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlRmluaXRlTnVtYmVyKHgpOwogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVGaW5pdGVOdW1iZXIoeSk7CiAgICAgICAgICAgICAgICByZXR1cm4gbWFwLmdldCh0aGlzKS5fSGFzVGFnQXRQb3NpdGlvbih0YWcsIHgsIHkpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZ2V0VGFnQXRQb3NpdGlvbih4LCB5KSB7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcih4KTsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlRmluaXRlTnVtYmVyKHkpOwogICAgICAgICAgICAgICAgcmV0dXJuIG1hcC5nZXQodGhpcykuX0dldFRhZ0F0UG9zaXRpb24oeCwgeSkKICAgICAgICAgICAgfQogICAgICAgICAgICBnZXRUYWdQb3NpdGlvbkFuZFNpemUodGFnLCBpbmRleCA9IDApIHsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlU3RyaW5nKHRhZyk7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcihpbmRleCk7CiAgICAgICAgICAgICAgICByZXR1cm4gbWFwLmdldCh0aGlzKS5fR2V0VGFnUG9zaXRpb24odGFnLCBpbmRleCkKICAgICAgICAgICAgfQogICAgICAgICAgICBnZXRUYWdDb3VudCh0YWcpIHsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlU3RyaW5nKHRhZyk7CiAgICAgICAgICAgICAgICByZXR1cm4gbWFwLmdldCh0aGlzKS5fR2V0VGFnQ291bnQodGFnKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSB7CiAgICAgICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgICAgIEMzLlBsdWdpbnMuU3ByaXRlZm9udDIuQ25kcyA9IHsKICAgICAgICAgICAgQ29tcGFyZVRleHQodGV4dCwgY2FzZVNlbnNpdGl2ZSkgewogICAgICAgICAgICAgICAgaWYgKGNhc2VTZW5zaXRpdmUpIHJldHVybiB0aGlzLl90ZXh0ID09PSB0ZXh0OwogICAgICAgICAgICAgICAgZWxzZSByZXR1cm4gQzMuZXF1YWxzTm9DYXNlKHRoaXMuX3RleHQsIHRleHQpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIElzUnVubmluZ1R5cGV3cml0ZXJUZXh0KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3R5cGV3cml0ZXJFbmRUaW1lICE9PSAtMQogICAgICAgICAgICB9LAogICAgICAgICAgICBPblR5cGV3cml0ZXJUZXh0RmluaXNoZWQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgICAgICB9LAogICAgICAgICAgICBIYXNUYWdBdFBvc2l0aW9uKHRhZywgeCwgeSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX0hhc1RhZ0F0UG9zaXRpb24odGFnLCB4LCB5KQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSB7CiAgICAgICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgICAgIEMzLlBsdWdpbnMuU3ByaXRlZm9udDIuQWN0cyA9IHsKICAgICAgICAgICAgU2V0VGV4dChwYXJhbSkgewogICAgICAgICAgICAgICAgdGhpcy5fQ2FuY2VsVHlwZXdyaXRlcigpOwogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBwYXJhbSA9PT0gIm51bWJlciIgJiYgcGFyYW0gPCAxRTkpIHBhcmFtID0gTWF0aC5yb3VuZChwYXJhbSAqIDFFMTApIC8gMUUxMDsKICAgICAgICAgICAgICAgIHRoaXMuX1NldFRleHQocGFyYW0udG9TdHJpbmcoKSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgQXBwZW5kVGV4dChwYXJhbSkgewogICAgICAgICAgICAgICAgdGhpcy5fQ2FuY2VsVHlwZXdyaXRlcigpOwogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBwYXJhbSA9PT0gIm51bWJlciIgJiYgcGFyYW0gPCAxRTkpIHBhcmFtID0gTWF0aC5yb3VuZChwYXJhbSAqIDFFMTApIC8gMUUxMDsKICAgICAgICAgICAgICAgIHBhcmFtID0gcGFyYW0udG9TdHJpbmcoKTsKICAgICAgICAgICAgICAgIGlmICghcGFyYW0pIHJldHVybjsKICAgICAgICAgICAgICAgIHRoaXMuX1NldFRleHQodGhpcy5fdGV4dCArIHBhcmFtKQogICAgICAgICAgICB9LAogICAgICAgICAgICBUeXBld3JpdGVyVGV4dChwYXJhbSwgZHVyYXRpb24pIHsKICAgICAgICAgICAgICAgIHRoaXMuX0NhbmNlbFR5cGV3cml0ZXIoKTsKICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgcGFyYW0gPT09ICJudW1iZXIiICYmIHBhcmFtIDwgMUU5KSBwYXJhbSA9IE1hdGgucm91bmQocGFyYW0gKiAxRTEwKSAvCiAgICAgICAgICAgICAgICAgICAgMUUxMDsKICAgICAgICAgICAgICAgIHRoaXMuX1N0YXJ0VHlwZXdyaXRlcihwYXJhbS50b1N0cmluZygpLCBkdXJhdGlvbikKICAgICAgICAgICAgfSwKICAgICAgICAgICAgVHlwZXdyaXRlckZpbmlzaCgpIHsKICAgICAgICAgICAgICAgIHRoaXMuX0ZpbmlzaFR5cGV3cml0ZXIoKQogICAgICAgICAgICB9LAogICAgICAgICAgICBTZXRTY2FsZShzKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9TZXRTY2FsZShzKQogICAgICAgICAgICB9LAogICAgICAgICAgICBTZXRDaGFyYWN0ZXJTcGFjaW5nKHMpIHsKICAgICAgICAgICAgICAgIHRoaXMuX1NldENoYXJhY3RlclNwYWNpbmcocykKICAgICAgICAgICAgfSwKICAgICAgICAgICAgU2V0TGluZUhlaWdodChoKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9TZXRMaW5lSGVpZ2h0KGgpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFNldENoYXJhY3RlcldpZHRoKGNoYXJzLCB3aWR0aCkgewogICAgICAgICAgICAgICAgbGV0IGRpZEFueUNoYW5nZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgY29uc3Qgc3ByaXRlRm9udCA9IHRoaXMuX3Nka1R5cGUuR2V0U3ByaXRlRm9udCgpOwogICAgICAgICAgICAgICAgZm9yIChjb25zdCBjaCBvZiBjaGFycykKICAgICAgICAgICAgICAgICAgICBpZiAoY2ggPT09ICIgIikgewogICAgICAgICAgICAgICAgICAgICAgICBzcHJpdGVGb250LlNldFNwYWNlV2lkdGgod2lkdGgpOwogICAgICAgICAgICAgICAgICAgICAgICBkaWRBbnlDaGFuZ2UgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2ZjID0gc3ByaXRlRm9udC5HZXRDaGFyYWN0ZXIoY2gpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2ZjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZmMuU2V0RGlzcGxheVdpZHRoKHdpZHRoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpZEFueUNoYW5nZSA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGRpZEFueUNoYW5nZSkgc3ByaXRlRm9udC5TZXRDaGFyYWN0ZXJXaWR0aHNDaGFuZ2VkKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9ydW50aW1lLlVwZGF0ZVJlbmRlcigpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFNldEVmZmVjdChlZmZlY3QpIHsKICAgICAgICAgICAgICAgIHRoaXMuR2V0V29ybGRJbmZvKCkuU2V0QmxlbmRNb2RlKGVmZmVjdCk7CiAgICAgICAgICAgICAgICB0aGlzLl9ydW50aW1lLlVwZGF0ZVJlbmRlcigpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFNldEhBbGlnbihoKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9TZXRIQWxpZ24oaCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgU2V0VkFsaWduKHYpIHsKICAgICAgICAgICAgICAgIHRoaXMuX1NldFZBbGlnbih2KQogICAgICAgICAgICB9LAogICAgICAgICAgICBTZXRXcmFwcGluZyh3KSB7CiAgICAgICAgICAgICAgICB0aGlzLl9TZXRXcmFwQnlXb3JkKHcgPT09IDApCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFNldFJlYWRBbG91ZChyKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9TZXRSZWFkQWxvdWQocikKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gewogICAgICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgICAgICBDMy5QbHVnaW5zLlNwcml0ZWZvbnQyLkV4cHMgPSB7CiAgICAgICAgICAgIENoYXJhY3RlcldpZHRoKGNoKSB7CiAgICAgICAgICAgICAgICBjb25zdCBzZmMgPSB0aGlzLl9zZGtUeXBlLkdldFNwcml0ZUZvbnQoKS5HZXRDaGFyYWN0ZXIoY2gpOwogICAgICAgICAgICAgICAgaWYgKHNmYykgcmV0dXJuIHNmYy5HZXREaXNwbGF5V2lkdGgoKTsKICAgICAgICAgICAgICAgIGVsc2UgcmV0dXJuIHRoaXMuX3Nka1R5cGUuR2V0U3ByaXRlRm9udCgpLkdldENoYXJhY3RlcldpZHRoKCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgQ2hhcmFjdGVySGVpZ2h0KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NoYXJhY3RlckhlaWdodAogICAgICAgICAgICB9LAogICAgICAgICAgICBDaGFyYWN0ZXJTY2FsZSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9jaGFyYWN0ZXJTY2FsZQogICAgICAgICAgICB9LAogICAgICAgICAgICBDaGFyYWN0ZXJTcGFjaW5nKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NoYXJhY3RlclNwYWNpbmcKICAgICAgICAgICAgfSwKICAgICAgICAgICAgTGluZUhlaWdodCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9saW5lSGVpZ2h0CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFRleHQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fdGV4dAogICAgICAgICAgICB9LAogICAgICAgICAgICBQbGFpblRleHQoKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fZW5hYmxlQkJjb2RlKSByZXR1cm4gQzMuQkJTdHJpbmcuU3RyaXBBbnlUYWdzKHRoaXMuX3RleHQpOwogICAgICAgICAgICAgICAgZWxzZSByZXR1cm4gdGhpcy5fdGV4dAogICAgICAgICAgICB9LAogICAgICAgICAgICBUZXh0V2lkdGgoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fR2V0VGV4dFdpZHRoKCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgVGV4dEhlaWdodCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9HZXRUZXh0SGVpZ2h0KCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgVGFnQXRQb3NpdGlvbih4LCB5KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fR2V0VGFnQXRQb3NpdGlvbih4LCB5KQogICAgICAgICAgICB9LAogICAgICAgICAgICBUYWdDb3VudCh0YWcpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9HZXRUYWdDb3VudCh0YWcpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFRhZ1godGFnLCBpbmRleCkgewogICAgICAgICAgICAgICAgY29uc3QgcmV0ID0gdGhpcy5fR2V0VGFnUG9zaXRpb24odGFnLCBpbmRleCk7CiAgICAgICAgICAgICAgICByZXR1cm4gcmV0ID8gcmV0LnggOiAwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFRhZ1kodGFnLCBpbmRleCkgewogICAgICAgICAgICAgICAgY29uc3QgcmV0ID0gdGhpcy5fR2V0VGFnUG9zaXRpb24odGFnLCBpbmRleCk7CiAgICAgICAgICAgICAgICByZXR1cm4gcmV0ID8gcmV0LnkgOiAwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFRhZ1dpZHRoKHRhZywgaW5kZXgpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHJldCA9IHRoaXMuX0dldFRhZ1Bvc2l0aW9uKHRhZywgaW5kZXgpOwogICAgICAgICAgICAgICAgcmV0dXJuIHJldCA/IHJldC53aWR0aCA6IDAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgVGFnSGVpZ2h0KHRhZywgaW5kZXgpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHJldCA9IHRoaXMuX0dldFRhZ1Bvc2l0aW9uKHRhZywKICAgICAgICAgICAgICAgICAgICBpbmRleCk7CiAgICAgICAgICAgICAgICByZXR1cm4gcmV0ID8gcmV0LmhlaWdodCA6IDAKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07Cgp9Cgp7CiAgICAndXNlIHN0cmljdCc7CiAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICBzZWxmLlNwcml0ZUZvbnRDaGFyYWN0ZXIgPSBjbGFzcyBTcHJpdGVGb250Q2hhcmFjdGVyIHsKICAgICAgICBjb25zdHJ1Y3RvcihzcHJpdGVGb250LCBjaGFyLCB4LCB5KSB7CiAgICAgICAgICAgIGxldCBjaGFyV2lkdGggPSBzcHJpdGVGb250LkdldENoYXJhY3RlcldpZHRoKCk7CiAgICAgICAgICAgIGxldCBjaGFySGVpZ2h0ID0gc3ByaXRlRm9udC5HZXRDaGFyYWN0ZXJIZWlnaHQoKTsKICAgICAgICAgICAgdGhpcy5fc3ByaXRlRm9udCA9IHNwcml0ZUZvbnQ7CiAgICAgICAgICAgIHRoaXMuX2NoYXIgPSBjaGFyOwogICAgICAgICAgICB0aGlzLl9weFJlY3QgPSBuZXcgQzMuUmVjdCh4LCB5LCB4ICsgY2hhcldpZHRoLCB5ICsgY2hhckhlaWdodCk7CiAgICAgICAgICAgIHRoaXMuX3RleFJlY3QgPSBuZXcgQzMuUmVjdDsKICAgICAgICAgICAgdGhpcy5fZGlzcGxheVdpZHRoID0gLTE7CiAgICAgICAgICAgIHRoaXMuX1VwZGF0ZVRleFJlY3QoKQogICAgICAgIH0KICAgICAgICBSZWxlYXNlKCkgewogICAgICAgICAgICB0aGlzLl9zcHJpdGVGb250ID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fcHhSZWN0ID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fdGV4UmVjdCA9IG51bGwKICAgICAgICB9CiAgICAgICAgX1VwZGF0ZVRleFJlY3QoKSB7CiAgICAgICAgICAgIGxldCB3ID0gdGhpcy5fc3ByaXRlRm9udC5HZXRXaWR0aCgpOwogICAgICAgICAgICBsZXQgaCA9IHRoaXMuX3Nwcml0ZUZvbnQuR2V0SGVpZ2h0KCk7CiAgICAgICAgICAgIHRoaXMuX3RleFJlY3QuY29weSh0aGlzLl9weFJlY3QpOwogICAgICAgICAgICB0aGlzLl90ZXhSZWN0LmRpdmlkZSh3LCBoKTsKICAgICAgICAgICAgdGhpcy5fdGV4UmVjdC5sZXJwSW50byh0aGlzLl9zcHJpdGVGb250LkdldFRleFJlY3QoKSkKICAgICAgICB9CiAgICAgICAgR2V0U3ByaXRlRm9udCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3Nwcml0ZUZvbnQKICAgICAgICB9CiAgICAgICAgR2V0Q2hhcigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NoYXIKICAgICAgICB9CiAgICAgICAgR2V0VGV4UmVjdCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RleFJlY3QKICAgICAgICB9CiAgICAgICAgU2V0RGlzcGxheVdpZHRoKHcpIHsKICAgICAgICAgICAgdGhpcy5fZGlzcGxheVdpZHRoID0gdwogICAgICAgIH0KICAgICAgICBHZXREaXNwbGF5V2lkdGgoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9kaXNwbGF5V2lkdGggPCAwKSByZXR1cm4gdGhpcy5fc3ByaXRlRm9udC5HZXRDaGFyYWN0ZXJXaWR0aCgpOwogICAgICAgICAgICBlbHNlIHJldHVybiB0aGlzLl9kaXNwbGF5V2lkdGgKICAgICAgICB9CiAgICB9OwoKfQoKewogICAgJ3VzZSBzdHJpY3QnOwogICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgY29uc3QgdG1wUmVjdCA9IG5ldyBDMy5SZWN0OwogICAgY29uc3QgdG1wUXVhZCA9IG5ldyBDMy5RdWFkOwogICAgY29uc3QgdG1wQ29sb3IgPSBuZXcgQzMuQ29sb3I7CiAgICBjb25zdCBWQUxJRF9IT1JJWl9BTElHTk1FTlRTID0gbmV3IFNldChbImxlZnQiLCAiY2VudGVyIiwgInJpZ2h0Il0pOwogICAgY29uc3QgVkFMSURfVkVSVF9BTElHTk1FTlRTID0gbmV3IFNldChbInRvcCIsICJjZW50ZXIiLCAiYm90dG9tIl0pOwogICAgY29uc3QgVkFMSURfV09SRF9XUkFQX01PREVTID0gbmV3IFNldChbIndvcmQiLCAiY2hhcmFjdGVyIl0pOwogICAgc2VsZi5TcHJpdGVGb250VGV4dCA9IGNsYXNzIFNwcml0ZUZvbnRUZXh0IHsKICAgICAgICBjb25zdHJ1Y3RvcihzcHJpdGVGb250KSB7CiAgICAgICAgICAgIHRoaXMuX3Nwcml0ZUZvbnQgPSBzcHJpdGVGb250OwogICAgICAgICAgICB0aGlzLl9jc3NXaWR0aCA9IDA7CiAgICAgICAgICAgIHRoaXMuX2Nzc0hlaWdodCA9IDA7CiAgICAgICAgICAgIHRoaXMuX3RleHQgPSAiIjsKICAgICAgICAgICAgdGhpcy5faXNCQmNvZGVFbmFibGVkID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX2JiU3RyaW5nID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fd3JhcHBlZFRleHQgPSBDMy5OZXcoQzMuV29yZFdyYXApOwogICAgICAgICAgICB0aGlzLl93cmFwTW9kZSA9ICJ3b3JkIjsKICAgICAgICAgICAgdGhpcy5fd3JhcENoYW5nZWQgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5faG9yaXpvbnRhbEFsaWduID0gImxlZnQiOwogICAgICAgICAgICB0aGlzLl92ZXJ0aWNhbEFsaWduID0gInRvcCI7CiAgICAgICAgICAgIHRoaXMuX3NjYWxlID0gMTsKICAgICAgICAgICAgdGhpcy5fc2NlbmVHcmFwaFNjYWxlID0gMTsKICAgICAgICAgICAgdGhpcy5fc3BhY2luZyA9IDA7CiAgICAgICAgICAgIHRoaXMuX2xpbmVIZWlnaHQgPSAwOwogICAgICAgICAgICB0aGlzLl9jb2xvciA9IEMzLk5ldyhDMy5Db2xvcik7CiAgICAgICAgICAgIHRoaXMuX2RyYXdNYXhDaGFyQ291bnQgPSAtMTsKICAgICAgICAgICAgdGhpcy5fZHJhd0NoYXJDb3VudCA9IDA7CiAgICAgICAgICAgIHRoaXMuX21lYXN1cmVUZXh0Q2FsbGJhY2sgPQogICAgICAgICAgICAgICAgKHN0ciwgc3R5bGVzKSA9PiB0aGlzLl9NZWFzdXJlVGV4dChzdHIsIHN0eWxlcyk7CiAgICAgICAgICAgIHRoaXMuX3Nwcml0ZUZvbnQuX0FkZFNwcml0ZUZvbnRUZXh0KHRoaXMpCiAgICAgICAgfQogICAgICAgIFJlbGVhc2UoKSB7CiAgICAgICAgICAgIHRoaXMuX3Nwcml0ZUZvbnQuX1JlbW92ZVNwcml0ZUZvbnRUZXh0KHRoaXMpOwogICAgICAgICAgICB0aGlzLl9jb2xvciA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX21lYXN1cmVUZXh0Q2FsbGJhY2sgPSBudWxsOwogICAgICAgICAgICB0aGlzLl93cmFwcGVkVGV4dC5DbGVhcigpOwogICAgICAgICAgICB0aGlzLl93cmFwcGVkVGV4dCA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX3Nwcml0ZUZvbnQgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9iYlN0cmluZyA9IG51bGwKICAgICAgICB9CiAgICAgICAgX01lYXN1cmVUZXh0KGNoQXJyLCBzdHlsZXMpIHsKICAgICAgICAgICAgY29uc3Qgc2NhbGVTdHlsZSA9IHRoaXMuX0dldFN0eWxlVGFnKHN0eWxlcywgInNjYWxlIik7CiAgICAgICAgICAgIGNvbnN0IHNjYWxlID0gKHNjYWxlU3R5bGUgPyBwYXJzZUZsb2F0KHNjYWxlU3R5bGUucGFyYW0pIDogdGhpcy5fc2NhbGUpICogdGhpcy5fc2NlbmVHcmFwaFNjYWxlOwogICAgICAgICAgICBjb25zdCBzY2FsZVhTdHlsZSA9IHRoaXMuX0dldFN0eWxlVGFnKHN0eWxlcywgInNjYWxleCIpOwogICAgICAgICAgICBjb25zdCBzY2FsZVggPQogICAgICAgICAgICAgICAgKHNjYWxlWFN0eWxlID8gcGFyc2VGbG9hdChzY2FsZVhTdHlsZS5wYXJhbSkgOiAxKSAqIHNjYWxlOwogICAgICAgICAgICBjb25zdCBzY2FsZVlTdHlsZSA9IHRoaXMuX0dldFN0eWxlVGFnKHN0eWxlcywgInNjYWxleSIpOwogICAgICAgICAgICBjb25zdCBzY2FsZVkgPSAoc2NhbGVZU3R5bGUgPyBwYXJzZUZsb2F0KHNjYWxlWVN0eWxlLnBhcmFtKSA6IDEpICogc2NhbGU7CiAgICAgICAgICAgIGNvbnN0IGxpbmVUb3RhbEhlaWdodCA9IHRoaXMuX3Nwcml0ZUZvbnQuR2V0Q2hhcmFjdGVySGVpZ2h0KCkgKiBzY2FsZVkgKyB0aGlzLl9saW5lSGVpZ2h0OwogICAgICAgICAgICBjb25zdCBzcHJpdGVGb250ID0gdGhpcy5HZXRTcHJpdGVGb250KCk7CiAgICAgICAgICAgIGNvbnN0IGRlZmF1bHRDaGFyV2lkdGggPSBzcHJpdGVGb250LkdldENoYXJhY3RlcldpZHRoKCkgKiBzY2FsZVg7CiAgICAgICAgICAgIGNvbnN0IHNwYWNpbmcgPSB0aGlzLkdldFNwYWNpbmcoKTsKICAgICAgICAgICAgaWYgKHNwcml0ZUZvbnQuSGFzQW55Q3VzdG9tV2lkdGhzKCkpIHsKICAgICAgICAgICAgICAgIGxldCBzdHJMZW4gPSAwOwogICAgICAgICAgICAgICAgbGV0IHRvdGFsV2lkdGggPSAwOwogICAgICAgICAgICAgICAgZm9yIChjb25zdCBjaCBvZiBjaEFycikgewogICAgICAgICAgICAgICAgICAgIGxldCBjaGFyV2lkdGggPSBkZWZhdWx0Q2hhcldpZHRoOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNmYyA9IHNwcml0ZUZvbnQuR2V0Q2hhcmFjdGVyKGNoKTsKICAgICAgICAgICAgICAgICAgICBpZiAoc2ZjKSBjaGFyV2lkdGggPSBzZmMuR2V0RGlzcGxheVdpZHRoKCkgKiBzY2FsZVg7CiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoY2ggPT09ICIgIikgY2hhcldpZHRoID0gc3ByaXRlRm9udC5HZXRTcGFjZVdpZHRoKCkgKiBzY2FsZVg7CiAgICAgICAgICAgICAgICAgICAgdG90YWxXaWR0aCArPSBjaGFyV2lkdGg7CiAgICAgICAgICAgICAgICAgICAgKytzdHJMZW4KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IHRvdGFsV2lkdGggKyBzdHJMZW4gKiBzcGFjaW5nLAogICAgICAgICAgICAgICAgICAgIGhlaWdodDogbGluZVRvdGFsSGVpZ2h0CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjb25zdCBzdHJMZW4gPSBjaEFyci5sZW5ndGg7CiAgICAgICAgICAgICAgICBjb25zdCBzcGFjZUNvdW50ID0gTWF0aC5tYXgoc3RyTGVuLCAwKTsKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IGRlZmF1bHRDaGFyV2lkdGggKiBzdHJMZW4gKyBzcGFjZUNvdW50ICogc3BhY2luZywKICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IGxpbmVUb3RhbEhlaWdodAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIF9TZXRXcmFwQ2hhbmdlZCgpIHsKICAgICAgICAgICAgdGhpcy5fd3JhcENoYW5nZWQgPSB0cnVlOwogICAgICAgICAgICB0aGlzLl93cmFwcGVkVGV4dC5DbGVhcigpCiAgICAgICAgfQogICAgICAgIFNldFNpemUoY3NzV2lkdGgsIGNzc0hlaWdodCkgewogICAgICAgICAgICBpZiAoY3NzV2lkdGggPD0gMCB8fCBjc3NIZWlnaHQgPD0KICAgICAgICAgICAgICAgIDApIHJldHVybjsKICAgICAgICAgICAgaWYgKHRoaXMuX2Nzc1dpZHRoID09PSBjc3NXaWR0aCAmJiB0aGlzLl9jc3NIZWlnaHQgPT09IGNzc0hlaWdodCkgcmV0dXJuOwogICAgICAgICAgICBpZiAodGhpcy5fY3NzV2lkdGggIT09IGNzc1dpZHRoKSB0aGlzLl9TZXRXcmFwQ2hhbmdlZCgpOwogICAgICAgICAgICB0aGlzLl9jc3NXaWR0aCA9IGNzc1dpZHRoOwogICAgICAgICAgICB0aGlzLl9jc3NIZWlnaHQgPSBjc3NIZWlnaHQKICAgICAgICB9CiAgICAgICAgU2V0RHJhd01heENoYXJhY3RlckNvdW50KG4pIHsKICAgICAgICAgICAgdGhpcy5fZHJhd01heENoYXJDb3VudCA9IE1hdGguZmxvb3IobikKICAgICAgICB9CiAgICAgICAgR2V0RHJhd01heENoYXJhY3RlckNvdW50KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZHJhd01heENoYXJDb3VudAogICAgICAgIH0KICAgICAgICBfR2V0U3R5bGVUYWcoc3R5bGVzLCB0YWcpIHsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IHN0eWxlcy5sZW5ndGggLSAxOyBpID49IDA7IC0taSkgewogICAgICAgICAgICAgICAgY29uc3QgcyA9IHN0eWxlc1tpXTsKICAgICAgICAgICAgICAgIGlmIChzLnRhZyA9PT0gdGFnKSByZXR1cm4gcwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBudWxsCiAgICAgICAgfQogICAgICAgIF9IYXNTdHlsZVRhZyhzdHlsZXMsIHRhZykgewogICAgICAgICAgICByZXR1cm4gISF0aGlzLl9HZXRTdHlsZVRhZyhzdHlsZXMsIHRhZykKICAgICAgICB9CiAgICAgICAgSGl0VGVzdEZyYWdtZW50KHgsIHkpIHsKICAgICAgICAgICAgY29uc3QgbGluZXMgPQogICAgICAgICAgICAgICAgdGhpcy5fd3JhcHBlZFRleHQuR2V0TGluZXMoKTsKICAgICAgICAgICAgZm9yIChjb25zdCBsaW5lIG9mIGxpbmVzKQogICAgICAgICAgICAgICAgaWYgKHkgPiBsaW5lLnBlblkgJiYgeSA8IGxpbmUucGVuWSArIGxpbmUuaGVpZ2h0KQogICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgZnJhZyBvZiBsaW5lLmZyYWdtZW50cykKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHggPj0gZnJhZy5wZW5YICYmIHggPCBmcmFnLnBlblggKyBmcmFnLndpZHRoKSByZXR1cm4gZnJhZzsKICAgICAgICAgICAgcmV0dXJuIG51bGwKICAgICAgICB9KiBmcmFnbWVudHNXaXRoVGFnKHRhZykgewogICAgICAgICAgICBjb25zdCBsaW5lcyA9IHRoaXMuX3dyYXBwZWRUZXh0LkdldExpbmVzKCk7CiAgICAgICAgICAgIGZvciAoY29uc3QgbGluZSBvZiBsaW5lcykKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgZnJhZyBvZiBsaW5lLmZyYWdtZW50cykgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHRhZ1N0eWxlID0gdGhpcy5fR2V0U3R5bGVUYWcoZnJhZy5zdHlsZXMsICJ0YWciKTsKICAgICAgICAgICAgICAgICAgICBpZiAodGFnU3R5bGUgJiYgQzMuZXF1YWxzTm9DYXNlKHRhZ1N0eWxlLnBhcmFtLCB0YWcpKSB5aWVsZCBmcmFnCiAgICAgICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIEZpbmRGcmFnbWVudFdpdGhUYWcodGFnLCBpbmRleCkgewogICAgICAgICAgICBmb3IgKGNvbnN0IGZyYWcgb2YgdGhpcy5mcmFnbWVudHNXaXRoVGFnKHRhZykpCiAgICAgICAgICAgICAgICBpZiAoaW5kZXggPT09CiAgICAgICAgICAgICAgICAgICAgMCkgcmV0dXJuIGZyYWc7CiAgICAgICAgICAgICAgICBlbHNlIC0taW5kZXg7CiAgICAgICAgICAgIHJldHVybiBudWxsCiAgICAgICAgfQogICAgICAgIENvdW50RnJhZ21lbnRzV2l0aFRhZyh0YWcpIHsKICAgICAgICAgICAgbGV0IGNvdW50ID0gMDsKICAgICAgICAgICAgZm9yIChjb25zdCBmcmFnIG9mIHRoaXMuZnJhZ21lbnRzV2l0aFRhZyh0YWcpKSArK2NvdW50OwogICAgICAgICAgICByZXR1cm4gY291bnQKICAgICAgICB9CiAgICAgICAgX01heWJlV3JhcFRleHQoKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5fd3JhcENoYW5nZWQpIHJldHVybjsKICAgICAgICAgICAgaWYgKHRoaXMuX2lzQkJjb2RlRW5hYmxlZCAmJiAoIXRoaXMuX2JiU3RyaW5nIHx8IHRoaXMuX2JiU3RyaW5nLnRvU3RyaW5nKCkgIT09IHRoaXMuX3RleHQpKSB0aGlzLl9iYlN0cmluZyA9IG5ldyBDMy5CQlN0cmluZyh0aGlzLl90ZXh0LCB7CiAgICAgICAgICAgICAgICBub0VzY2FwZTogdHJ1ZQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgY29uc3QgZW5kT2ZMaW5lTWFyZ2luID0gLXRoaXMuR2V0U3BhY2luZygpOwogICAgICAgICAgICB0aGlzLl93cmFwcGVkVGV4dC5Xb3JkV3JhcCh0aGlzLl9pc0JCY29kZUVuYWJsZWQgPyB0aGlzLl9iYlN0cmluZy50b0ZyYWdtZW50TGlzdCgpIDogdGhpcy5fdGV4dCwgdGhpcy5fbWVhc3VyZVRleHRDYWxsYmFjaywgdGhpcy5fY3NzV2lkdGgsCiAgICAgICAgICAgICAgICB0aGlzLl93cmFwTW9kZSwgZW5kT2ZMaW5lTWFyZ2luKTsKICAgICAgICAgICAgdGhpcy5fd3JhcENoYW5nZWQgPSBmYWxzZQogICAgICAgIH0KICAgICAgICBEcmF3KHJlbmRlcmVyLCBvZmZYLCBvZmZZLCBhbmdsZSkgewogICAgICAgICAgICB0aGlzLl9NYXliZVdyYXBUZXh0KCk7CiAgICAgICAgICAgIHRoaXMuX2RyYXdDaGFyQ291bnQgPSAwOwogICAgICAgICAgICBsZXQgcGVuWSA9IDA7CiAgICAgICAgICAgIGNvbnN0IGxpbmVTcGFjZUhlaWdodCA9IHRoaXMuX2xpbmVIZWlnaHQ7CiAgICAgICAgICAgIGNvbnN0IGxpbmVzID0gQzMuY2xvbmVBcnJheSh0aGlzLl93cmFwcGVkVGV4dC5HZXRMaW5lcygpKTsKICAgICAgICAgICAgY29uc3Qgc2luX2EgPSBNYXRoLnNpbihhbmdsZSk7CiAgICAgICAgICAgIGNvbnN0IGNvc19hID0gTWF0aC5jb3MoYW5nbGUpOwogICAgICAgICAgICBjb25zdCBsaW5lc1RvdGFsSGVpZ2h0ID0gbGluZXMucmVkdWNlKChhLCB2KSA9PiBhICsgdi5oZWlnaHQsIDApIC0gbGluZVNwYWNlSGVpZ2h0OwogICAgICAgICAgICBpZiAodGhpcy5fdmVydGljYWxBbGlnbiA9PT0gImNlbnRlciIpIHBlblkgPSBNYXRoLm1heChNYXRoLmZsb29yKHRoaXMuX2Nzc0hlaWdodCAvIDIgLSBsaW5lc1RvdGFsSGVpZ2h0IC8gMiksIDApOwogICAgICAgICAgICBlbHNlIGlmICh0aGlzLl92ZXJ0aWNhbEFsaWduID09PSAiYm90dG9tIikgcGVuWSA9CiAgICAgICAgICAgICAgICBNYXRoLmZsb29yKHRoaXMuX2Nzc0hlaWdodCAtIGxpbmVzVG90YWxIZWlnaHQpOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gbGluZXMubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGxpbmUgPSBsaW5lc1tpXTsKICAgICAgICAgICAgICAgIGNvbnN0IGN1ckxpbmVUZXh0SGVpZ2h0ID0gbGluZS5oZWlnaHQ7CiAgICAgICAgICAgICAgICBpZiAoaSA+IDAgJiYgcGVuWSA+IHRoaXMuX2Nzc0hlaWdodCAtIChjdXJMaW5lVGV4dEhlaWdodCAtIGxpbmVTcGFjZUhlaWdodCkpIGJyZWFrOwogICAgICAgICAgICAgICAgaWYgKHBlblkgPj0gMCkgdGhpcy5fRHJhd0xpbmUocmVuZGVyZXIsIGxpbmUsIG9mZlgsIG9mZlksIHBlblksIHNpbl9hLCBjb3NfYSk7CiAgICAgICAgICAgICAgICBwZW5ZICs9IGN1ckxpbmVUZXh0SGVpZ2h0CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgX0RyYXdMaW5lKHJlbmRlcmVyLCBsaW5lLCBvZmZYLCBvZmZZLCBwZW5ZLCBzaW5fYSwgY29zX2EpIHsKICAgICAgICAgICAgY29uc3QgbGluZUhlaWdodCA9IGxpbmUuaGVpZ2h0OwogICAgICAgICAgICBsZXQgcGVuWCA9IDA7CiAgICAgICAgICAgIGlmICh0aGlzLl9ob3Jpem9udGFsQWxpZ24gPT09ICJjZW50ZXIiKSBwZW5YID0gTWF0aC5tYXgoTWF0aC5mbG9vcigodGhpcy5fY3NzV2lkdGggLSBsaW5lLndpZHRoKSAvIDIpLCAwKTsKICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5faG9yaXpvbnRhbEFsaWduID09PQogICAgICAgICAgICAgICAgInJpZ2h0IikgcGVuWCA9IE1hdGgubWF4KE1hdGguZmxvb3IodGhpcy5fY3NzV2lkdGggLSBsaW5lLndpZHRoKSwgMCk7CiAgICAgICAgICAgIGxpbmUucGVuWCA9IHBlblg7CiAgICAgICAgICAgIGxpbmUucGVuWSA9IHBlblk7CiAgICAgICAgICAgIGZvciAoY29uc3QgZnJhZyBvZiBsaW5lLmZyYWdtZW50cykgewogICAgICAgICAgICAgICAgdGhpcy5fRHJhd0ZyYWdtZW50KHJlbmRlcmVyLCBmcmFnLCBvZmZYLCBvZmZZLCBwZW5YLCBwZW5ZLCBzaW5fYSwgY29zX2EsIGxpbmVIZWlnaHQpOwogICAgICAgICAgICAgICAgcGVuWCArPSBmcmFnLndpZHRoCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgX0RyYXdGcmFnbWVudChyZW5kZXJlciwgZnJhZywgb2ZmWCwgb2ZmWSwgcGVuWCwgcGVuWSwgc2luX2EsIGNvc19hLCBsaW5lSGVpZ2h0KSB7CiAgICAgICAgICAgIGZyYWcucGVuWCA9IHBlblg7CiAgICAgICAgICAgIGZyYWcucGVuWSA9IHBlblk7CiAgICAgICAgICAgIGxldCBjaEFyciA9IGZyYWcuY2hBcnI7CiAgICAgICAgICAgIGxldCBmcmFnV2lkdGggPSBmcmFnLndpZHRoOwogICAgICAgICAgICBjb25zdCBzdHlsZXMgPSBmcmFnLnN0eWxlczsKICAgICAgICAgICAgaWYgKHRoaXMuX2RyYXdNYXhDaGFyQ291bnQgIT09IC0xKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fZHJhd0NoYXJDb3VudCA+PSB0aGlzLl9kcmF3TWF4Q2hhckNvdW50KSByZXR1cm47CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fZHJhd0NoYXJDb3VudCArCiAgICAgICAgICAgICAgICAgICAgY2hBcnIubGVuZ3RoID4gdGhpcy5fZHJhd01heENoYXJDb3VudCkgewogICAgICAgICAgICAgICAgICAgIGNoQXJyID0gY2hBcnIuc2xpY2UoMCwgdGhpcy5fZHJhd01heENoYXJDb3VudCAtIHRoaXMuX2RyYXdDaGFyQ291bnQpOwogICAgICAgICAgICAgICAgICAgIGZyYWdXaWR0aCA9IHRoaXMuX01lYXN1cmVUZXh0KGNoQXJyLCBzdHlsZXMpLndpZHRoCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLl9kcmF3Q2hhckNvdW50ICs9IGNoQXJyLmxlbmd0aAogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IGJhY2tncm91bmRTdHlsZSA9IHRoaXMuX0dldFN0eWxlVGFnKHN0eWxlcywgImJhY2tncm91bmQiKTsKICAgICAgICAgICAgaWYgKEMzLklzQ2hhckFycmF5QWxsV2hpdGVzcGFjZShjaEFycikgJiYgIWJhY2tncm91bmRTdHlsZSB8fCB0aGlzLl9IYXNTdHlsZVRhZyhzdHlsZXMsICJoaWRlIikpIHJldHVybjsKICAgICAgICAgICAgY29uc3Qgc2NhbGVTdHlsZSA9IHRoaXMuX0dldFN0eWxlVGFnKHN0eWxlcywgInNjYWxlIik7CiAgICAgICAgICAgIGNvbnN0IHNjYWxlID0gKHNjYWxlU3R5bGUgPyBwYXJzZUZsb2F0KHNjYWxlU3R5bGUucGFyYW0pIDogdGhpcy5fc2NhbGUpICogdGhpcy5fc2NlbmVHcmFwaFNjYWxlOwogICAgICAgICAgICBjb25zdCBzY2FsZVhTdHlsZSA9IHRoaXMuX0dldFN0eWxlVGFnKHN0eWxlcywKICAgICAgICAgICAgICAgICJzY2FsZXgiKTsKICAgICAgICAgICAgY29uc3Qgc2NhbGVYID0gKHNjYWxlWFN0eWxlID8gcGFyc2VGbG9hdChzY2FsZVhTdHlsZS5wYXJhbSkgOiAxKSAqIHNjYWxlOwogICAgICAgICAgICBjb25zdCBzY2FsZVlTdHlsZSA9IHRoaXMuX0dldFN0eWxlVGFnKHN0eWxlcywgInNjYWxleSIpOwogICAgICAgICAgICBjb25zdCBzY2FsZVkgPSAoc2NhbGVZU3R5bGUgPyBwYXJzZUZsb2F0KHNjYWxlWVN0eWxlLnBhcmFtKSA6IDEpICogc2NhbGU7CiAgICAgICAgICAgIGNvbnN0IGNoYXJIZWlnaHQgPSB0aGlzLl9zcHJpdGVGb250LkdldENoYXJhY3RlckhlaWdodCgpICogc2NhbGVZOwogICAgICAgICAgICBjb25zdCBsaW5lU3BhY2VIZWlnaHQgPSB0aGlzLl9saW5lSGVpZ2h0OwogICAgICAgICAgICBwZW5ZICs9IGxpbmVIZWlnaHQgLSBsaW5lU3BhY2VIZWlnaHQgLSBjaGFySGVpZ2h0OwogICAgICAgICAgICBjb25zdCBvZmZzZXRYU3R5bGUgPSB0aGlzLl9HZXRTdHlsZVRhZyhzdHlsZXMsICJvZmZzZXR4Iik7CiAgICAgICAgICAgIHBlblggKz0gb2Zmc2V0WFN0eWxlID8gcGFyc2VGbG9hdChvZmZzZXRYU3R5bGUucGFyYW0pIDogMDsKICAgICAgICAgICAgY29uc3Qgb2Zmc2V0WVN0eWxlID0gdGhpcy5fR2V0U3R5bGVUYWcoc3R5bGVzLCAib2Zmc2V0eSIpOwogICAgICAgICAgICBwZW5ZICs9CiAgICAgICAgICAgICAgICBvZmZzZXRZU3R5bGUgPyBwYXJzZUZsb2F0KG9mZnNldFlTdHlsZS5wYXJhbSkgOiAwOwogICAgICAgICAgICBpZiAoYmFja2dyb3VuZFN0eWxlKSB7CiAgICAgICAgICAgICAgICByZW5kZXJlci5TZXRDb2xvckZpbGxNb2RlKCk7CiAgICAgICAgICAgICAgICB0bXBDb2xvci5wYXJzZVN0cmluZyhiYWNrZ3JvdW5kU3R5bGUucGFyYW0pOwogICAgICAgICAgICAgICAgdG1wQ29sb3Iuc2V0QSgxKTsKICAgICAgICAgICAgICAgIHJlbmRlcmVyLlNldENvbG9yKHRtcENvbG9yKTsKICAgICAgICAgICAgICAgIHRtcFJlY3Quc2V0KHBlblgsIHBlblksIHBlblggKyBmcmFnV2lkdGgsIHBlblkgKyBjaGFySGVpZ2h0KTsKICAgICAgICAgICAgICAgIGlmICh0bXBSZWN0LmdldFJpZ2h0KCkgPiB0aGlzLl9jc3NXaWR0aCkgdG1wUmVjdC5zZXRSaWdodCh0aGlzLl9jc3NXaWR0aCk7CiAgICAgICAgICAgICAgICB0bXBRdWFkLnNldEZyb21Sb3RhdGVkUmVjdFByZWNhbGModG1wUmVjdCwgc2luX2EsIGNvc19hKTsKICAgICAgICAgICAgICAgIHRtcFF1YWQub2Zmc2V0KG9mZlgsIG9mZlkpOwogICAgICAgICAgICAgICAgcmVuZGVyZXIuUXVhZCh0bXBRdWFkKTsKICAgICAgICAgICAgICAgIHJlbmRlcmVyLlNldFRleHR1cmVGaWxsTW9kZSgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgY29sb3JTdHlsZSA9IHRoaXMuX0dldFN0eWxlVGFnKHN0eWxlcywgImNvbG9yIik7CiAgICAgICAgICAgIGlmIChjb2xvclN0eWxlKSB7CiAgICAgICAgICAgICAgICB0bXBDb2xvci5wYXJzZVN0cmluZyhjb2xvclN0eWxlLnBhcmFtKTsKICAgICAgICAgICAgICAgIHRtcENvbG9yLnNldEEodGhpcy5fY29sb3IuZ2V0QSgpKQogICAgICAgICAgICB9IGVsc2UgdG1wQ29sb3IuY29weSh0aGlzLl9jb2xvcik7CiAgICAgICAgICAgIGNvbnN0IG9wYWNpdHlTdHlsZSA9IHRoaXMuX0dldFN0eWxlVGFnKHN0eWxlcywgIm9wYWNpdHkiKTsKICAgICAgICAgICAgaWYgKG9wYWNpdHlTdHlsZSkgdG1wQ29sb3Iuc2V0QSh0bXBDb2xvci5nZXRBKCkgKiBwYXJzZUZsb2F0KG9wYWNpdHlTdHlsZS5wYXJhbSkgLyAxMDApOwogICAgICAgICAgICB0bXBDb2xvci5wcmVtdWx0aXBseSgpOwogICAgICAgICAgICByZW5kZXJlci5TZXRDb2xvcih0bXBDb2xvcik7CiAgICAgICAgICAgIGNvbnN0IGRyYXdDaGFyV2lkdGggPSB0aGlzLl9zcHJpdGVGb250LkdldENoYXJhY3RlcldpZHRoKCkgKiBzY2FsZVg7CiAgICAgICAgICAgIGNvbnN0IGVuZE9mTGluZU1hcmdpbiA9IE1hdGguYWJzKHRoaXMuR2V0U3BhY2luZygpKTsKICAgICAgICAgICAgZm9yIChjb25zdCBjaCBvZiBjaEFycikgewogICAgICAgICAgICAgICAgY29uc3Qgc2ZjID0gdGhpcy5fc3ByaXRlRm9udC5HZXRDaGFyYWN0ZXIoY2gpOwogICAgICAgICAgICAgICAgaWYgKHNmYykgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGxheW91dENoYXJXaWR0aCA9IHNmYy5HZXREaXNwbGF5V2lkdGgoKSAqIHNjYWxlWDsKICAgICAgICAgICAgICAgICAgICBpZiAocGVuWCArCiAgICAgICAgICAgICAgICAgICAgICAgIGxheW91dENoYXJXaWR0aCA+IHRoaXMuX2Nzc1dpZHRoICsgZW5kT2ZMaW5lTWFyZ2luICsgMUUtNSkgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIHRtcFJlY3Quc2V0KHBlblgsIHBlblksIHBlblggKyBkcmF3Q2hhcldpZHRoLCBwZW5ZICsgY2hhckhlaWdodCk7CiAgICAgICAgICAgICAgICAgICAgdG1wUXVhZC5zZXRGcm9tUm90YXRlZFJlY3RQcmVjYWxjKHRtcFJlY3QsIHNpbl9hLCBjb3NfYSk7CiAgICAgICAgICAgICAgICAgICAgdG1wUXVhZC5vZmZzZXQob2ZmWCwgb2ZmWSk7CiAgICAgICAgICAgICAgICAgICAgcmVuZGVyZXIuUXVhZDModG1wUXVhZCwgc2ZjLkdldFRleFJlY3QoKSk7CiAgICAgICAgICAgICAgICAgICAgcGVuWCArPSBsYXlvdXRDaGFyV2lkdGggKyB0aGlzLl9zcGFjaW5nCiAgICAgICAgICAgICAgICB9IGVsc2UgcGVuWCArPSB0aGlzLl9zcHJpdGVGb250LkdldFNwYWNlV2lkdGgoKSAqIHNjYWxlWCArIHRoaXMuX3NwYWNpbmcKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBHZXRTcHJpdGVGb250KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fc3ByaXRlRm9udAogICAgICAgIH0KICAgICAgICBTZXRCQkNvZGVFbmFibGVkKGUpIHsKICAgICAgICAgICAgZSA9ICEhZTsKICAgICAgICAgICAgaWYgKHRoaXMuX2lzQkJjb2RlRW5hYmxlZCA9PT0gZSkgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl9pc0JCY29kZUVuYWJsZWQgPSBlOwogICAgICAgICAgICB0aGlzLl9TZXRXcmFwQ2hhbmdlZCgpCiAgICAgICAgfQogICAgICAgIElzQkJDb2RlRW5hYmxlZCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2lzQkJjb2RlRW5hYmxlZAogICAgICAgIH0KICAgICAgICBTZXRUZXh0KHRleHQpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX3RleHQgPT09CiAgICAgICAgICAgICAgICB0ZXh0KSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuX3RleHQgPSB0ZXh0OwogICAgICAgICAgICB0aGlzLl9TZXRXcmFwQ2hhbmdlZCgpCiAgICAgICAgfQogICAgICAgIFNldFdvcmRXcmFwTW9kZSh3KSB7CiAgICAgICAgICAgIGlmICghVkFMSURfV09SRF9XUkFQX01PREVTLmhhcyh3KSkgdGhyb3cgbmV3IEVycm9yKCJpbnZhbGlkIHdvcmQgd3JhcCBtb2RlIik7CiAgICAgICAgICAgIGlmICh0aGlzLl93cmFwTW9kZSA9PT0gdykgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl93cmFwTW9kZSA9IHc7CiAgICAgICAgICAgIHRoaXMuX1NldFdyYXBDaGFuZ2VkKCkKICAgICAgICB9CiAgICAgICAgU2V0SG9yaXpvbnRhbEFsaWduKGEpIHsKICAgICAgICAgICAgaWYgKCFWQUxJRF9IT1JJWl9BTElHTk1FTlRTLmhhcyhhKSkgdGhyb3cgbmV3IEVycm9yKCJpbnZhbGlkIGFsaWdubWVudCIpOwogICAgICAgICAgICB0aGlzLl9ob3Jpem9udGFsQWxpZ24gPSBhCiAgICAgICAgfQogICAgICAgIFNldFZlcnRpY2FsQWxpZ24oYSkgewogICAgICAgICAgICBpZiAoIVZBTElEX1ZFUlRfQUxJR05NRU5UUy5oYXMoYSkpIHRocm93IG5ldyBFcnJvcigiaW52YWxpZCBhbGlnbm1lbnQiKTsKICAgICAgICAgICAgdGhpcy5fdmVydGljYWxBbGlnbiA9IGEKICAgICAgICB9CiAgICAgICAgU2V0U2NhbGUocykgewogICAgICAgICAgICBpZiAodGhpcy5fc2NhbGUgPT09IHMpIHJldHVybjsKICAgICAgICAgICAgdGhpcy5fc2NhbGUgPSBzOwogICAgICAgICAgICB0aGlzLl9TZXRXcmFwQ2hhbmdlZCgpCiAgICAgICAgfQogICAgICAgIEdldFNjYWxlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fc2NhbGUKICAgICAgICB9CiAgICAgICAgU2V0U2NlbmVHcmFwaFNjYWxlKHMpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX3NjZW5lR3JhcGhTY2FsZSA9PT0KICAgICAgICAgICAgICAgIHMpIHJldHVybjsKICAgICAgICAgICAgdGhpcy5fc2NlbmVHcmFwaFNjYWxlID0gczsKICAgICAgICAgICAgdGhpcy5fU2V0V3JhcENoYW5nZWQoKQogICAgICAgIH0KICAgICAgICBHZXRTY2VuZUdyYXBoU2NhbGUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zY2VuZUdyYXBoU2NhbGUKICAgICAgICB9CiAgICAgICAgU2V0U3BhY2luZyhzKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9zcGFjaW5nID09PSBzKSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuX3NwYWNpbmcgPSBzOwogICAgICAgICAgICB0aGlzLl9TZXRXcmFwQ2hhbmdlZCgpCiAgICAgICAgfQogICAgICAgIEdldFNwYWNpbmcoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zcGFjaW5nCiAgICAgICAgfQogICAgICAgIFNldExpbmVIZWlnaHQoaCkgewogICAgICAgICAgICB0aGlzLl9saW5lSGVpZ2h0ID0gaDsKICAgICAgICAgICAgdGhpcy5fU2V0V3JhcENoYW5nZWQoKQogICAgICAgIH0KICAgICAgICBHZXRMaW5lSGVpZ2h0KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fbGluZUhlaWdodAogICAgICAgIH0KICAgICAgICBTZXRPcGFjaXR5KG8pIHsKICAgICAgICAgICAgbyA9IEMzLmNsYW1wKG8sIDAsIDEpOwogICAgICAgICAgICB0aGlzLl9jb2xvci5hID0gbwogICAgICAgIH0KICAgICAgICBTZXRDb2xvcihjKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9jb2xvci5lcXVhbHMoYykpIHJldHVybjsKICAgICAgICAgICAgdGhpcy5fY29sb3IuY29weShjKQogICAgICAgIH0KICAgICAgICBHZXRDb2xvcigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NvbG9yCiAgICAgICAgfQogICAgICAgIEdldFRleHRXaWR0aCgpIHsKICAgICAgICAgICAgdGhpcy5fTWF5YmVXcmFwVGV4dCgpOwogICAgICAgICAgICByZXR1cm4gdGhpcy5fd3JhcHBlZFRleHQuR2V0TWF4TGluZVdpZHRoKCkKICAgICAgICB9CiAgICAgICAgR2V0VGV4dEhlaWdodCgpIHsKICAgICAgICAgICAgdGhpcy5fTWF5YmVXcmFwVGV4dCgpOwogICAgICAgICAgICBjb25zdCBsaW5lVGV4dEhlaWdodCA9IHRoaXMuX3Nwcml0ZUZvbnQuR2V0Q2hhcmFjdGVySGVpZ2h0KCkgKiB0aGlzLl9zY2FsZTsKICAgICAgICAgICAgY29uc3QgbGluZVNwYWNlSGVpZ2h0ID0gdGhpcy5fbGluZUhlaWdodDsKICAgICAgICAgICAgY29uc3QgbGluZVRvdGFsSGVpZ2h0ID0gbGluZVRleHRIZWlnaHQgKyBsaW5lU3BhY2VIZWlnaHQ7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl93cmFwcGVkVGV4dC5HZXRMaW5lQ291bnQoKSAqIGxpbmVUb3RhbEhlaWdodCAtIGxpbmVTcGFjZUhlaWdodAogICAgICAgIH0KICAgIH07Cgp9Cgp7CiAgICAndXNlIHN0cmljdCc7CiAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICBjb25zdCBTcHJpdGVGb250VGV4dCA9IHNlbGYuU3ByaXRlRm9udFRleHQ7CiAgICBjb25zdCBERUZBVUxUX1NQUklURUZPTlRfT1BUUyA9IHsKICAgICAgICB3aWR0aDogMjU2LAogICAgICAgIGhlaWdodDogMjU2LAogICAgICAgIGNoYXJhY3RlcldpZHRoOiAxNiwKICAgICAgICBjaGFyYWN0ZXJIZWlnaHQ6IDE2LAogICAgICAgIGNoYXJhY3RlclNldDogIiIKICAgIH07CiAgICBzZWxmLlNwcml0ZUZvbnQgPSBjbGFzcyBTcHJpdGVGb250IHsKICAgICAgICBjb25zdHJ1Y3RvcihvcHRzKSB7CiAgICAgICAgICAgIG9wdHMgPSBPYmplY3QuYXNzaWduKHt9LCBERUZBVUxUX1NQUklURUZPTlRfT1BUUywgb3B0cyk7CiAgICAgICAgICAgIGlmIChvcHRzLndpZHRoIDw9IDAgfHwgb3B0cy5oZWlnaHQgPD0gMCB8fCBvcHRzLmNoYXJhY3RlcldpZHRoIDw9IDAgfHwgb3B0cy5jaGFyYWN0ZXJIZWlnaHQgPD0gMCkgdGhyb3cgbmV3IEVycm9yKCJpbnZhbGlkIHNpemUiKTsKICAgICAgICAgICAgdGhpcy5fd2lkdGggPSBvcHRzLndpZHRoOwogICAgICAgICAgICB0aGlzLl9oZWlnaHQgPSBvcHRzLmhlaWdodDsKICAgICAgICAgICAgdGhpcy5fY2hhcmFjdGVyV2lkdGggPSBvcHRzLmNoYXJhY3RlcldpZHRoOwogICAgICAgICAgICB0aGlzLl9jaGFyYWN0ZXJIZWlnaHQgPSBvcHRzLmNoYXJhY3RlckhlaWdodDsKICAgICAgICAgICAgdGhpcy5fY2hhcmFjdGVyU2V0ID0gb3B0cy5jaGFyYWN0ZXJTZXQ7CiAgICAgICAgICAgIHRoaXMuX3NwYWNpbmdEYXRhID0gIiI7CiAgICAgICAgICAgIHRoaXMuX3NwYWNpbmdQYXJzZWQgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9oYXNBbnlDdXN0b21XaWR0aHMgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5fc3BhY2VXaWR0aCA9IC0xOwogICAgICAgICAgICB0aGlzLl90ZXhSZWN0ID0gbmV3IEMzLlJlY3QoMCwKICAgICAgICAgICAgICAgIDAsIDEsIDEpOwogICAgICAgICAgICB0aGlzLl9jaGFyYWN0ZXJNYXAgPSBuZXcgTWFwOwogICAgICAgICAgICB0aGlzLl9tYXBDaGFuZ2VkID0gdHJ1ZTsKICAgICAgICAgICAgdGhpcy5fYWxsVGV4dHMgPSBuZXcgU2V0CiAgICAgICAgfQogICAgICAgIFJlbGVhc2UoKSB7CiAgICAgICAgICAgIHRoaXMuX3RleFJlY3QgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9SZWxlYXNlQ2hhcmFjdGVycygpOwogICAgICAgICAgICB0aGlzLl9jaGFyYWN0ZXJNYXAgPSBudWxsOwogICAgICAgICAgICBpZiAodGhpcy5fYWxsVGV4dHMpIHRoaXMuX2FsbFRleHRzLmNsZWFyKCk7CiAgICAgICAgICAgIHRoaXMuX2FsbFRleHRzID0gbnVsbAogICAgICAgIH0KICAgICAgICBfUmVsZWFzZUNoYXJhY3RlcnMoKSB7CiAgICAgICAgICAgIGZvciAobGV0IGMgb2YgdGhpcy5fY2hhcmFjdGVyTWFwLnZhbHVlcygpKSBjLlJlbGVhc2UoKTsKICAgICAgICAgICAgdGhpcy5fY2hhcmFjdGVyTWFwLmNsZWFyKCkKICAgICAgICB9CiAgICAgICAgX0FkZFNwcml0ZUZvbnRUZXh0KHNmdCkgewogICAgICAgICAgICB0aGlzLl9hbGxUZXh0cy5hZGQoc2Z0KQogICAgICAgIH0KICAgICAgICBfUmVtb3ZlU3ByaXRlRm9udFRleHQoc2Z0KSB7CiAgICAgICAgICAgIHRoaXMuX2FsbFRleHRzLmRlbGV0ZShzZnQpCiAgICAgICAgfQogICAgICAgIFVwZGF0ZUNoYXJhY3Rlck1hcCgpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLl9tYXBDaGFuZ2VkKSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuX1JlbGVhc2VDaGFyYWN0ZXJzKCk7CiAgICAgICAgICAgIGxldCBjaGFyU2V0QXJyID0KICAgICAgICAgICAgICAgIEMzLlNwbGl0R3JhcGhlbWVzKHRoaXMuX2NoYXJhY3RlclNldCk7CiAgICAgICAgICAgIGxldCBjb2xzID0gTWF0aC5mbG9vcih0aGlzLl93aWR0aCAvIHRoaXMuX2NoYXJhY3RlcldpZHRoKTsKICAgICAgICAgICAgbGV0IHJvd3MgPSBNYXRoLmZsb29yKHRoaXMuX2hlaWdodCAvIHRoaXMuX2NoYXJhY3RlckhlaWdodCk7CiAgICAgICAgICAgIGxldCBsYXN0ID0gY29scyAqIHJvd3M7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBjaGFyU2V0QXJyLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7CiAgICAgICAgICAgICAgICBpZiAoaSA+PSBsYXN0KSBicmVhazsKICAgICAgICAgICAgICAgIGxldCBjaGFyID0gY2hhclNldEFycltpXTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9jaGFyYWN0ZXJNYXAuaGFzKGNoYXIpKSBjb250aW51ZTsKICAgICAgICAgICAgICAgIGxldCB4ID0gaSAlIGNvbHM7CiAgICAgICAgICAgICAgICBsZXQgeSA9IE1hdGguZmxvb3IoaSAvIGNvbHMpOwogICAgICAgICAgICAgICAgdGhpcy5fY2hhcmFjdGVyTWFwLnNldChjaGFyLCBDMy5OZXcoc2VsZi5TcHJpdGVGb250Q2hhcmFjdGVyLCB0aGlzLCBjaGFyLCB4ICogdGhpcy5fY2hhcmFjdGVyV2lkdGgsIHkgKiB0aGlzLl9jaGFyYWN0ZXJIZWlnaHQpKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuX2hhc0FueUN1c3RvbVdpZHRocyA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl9zcGFjZVdpZHRoID0gLTE7CiAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHRoaXMuX3NwYWNpbmdQYXJzZWQpKQogICAgICAgICAgICAgICAgZm9yIChsZXQgZW50cnkgb2YgdGhpcy5fc3BhY2luZ1BhcnNlZCkgewogICAgICAgICAgICAgICAgICAgIGlmICghQXJyYXkuaXNBcnJheShlbnRyeSkpIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgIGlmIChlbnRyeS5sZW5ndGggIT09IDIpIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgIGxldCBjaGFyV2lkdGggPSBlbnRyeVswXTsKICAgICAgICAgICAgICAgICAgICBsZXQgc3RyID0gZW50cnlbMV07CiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBjaGFyV2lkdGggIT09ICJudW1iZXIiIHx8ICFpc0Zpbml0ZShjaGFyV2lkdGgpIHx8IHR5cGVvZiBzdHIgIT09ICJzdHJpbmciKSBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICBpZiAoY2hhcldpZHRoID09PSB0aGlzLl9jaGFyYWN0ZXJXaWR0aCkgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgY2ggb2Ygc3RyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBzZmMgPSB0aGlzLl9jaGFyYWN0ZXJNYXAuZ2V0KGNoKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNmYykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2ZjLlNldERpc3BsYXlXaWR0aChjaGFyV2lkdGgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5faGFzQW55Q3VzdG9tV2lkdGhzID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNoID09PSAiICIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3NwYWNlV2lkdGggPSBjaGFyV2lkdGg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9oYXNBbnlDdXN0b21XaWR0aHMgPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5fbWFwQ2hhbmdlZCA9IGZhbHNlOwogICAgICAgICAgICBmb3IgKGxldCBzZnQgb2YgdGhpcy5fYWxsVGV4dHMpIHNmdC5fU2V0V3JhcENoYW5nZWQoKQogICAgICAgIH0KICAgICAgICBTZXRDaGFyYWN0ZXJXaWR0aHNDaGFuZ2VkKCkgewogICAgICAgICAgICB0aGlzLl9oYXNBbnlDdXN0b21XaWR0aHMgPSB0cnVlOwogICAgICAgICAgICBmb3IgKGNvbnN0IHNmdCBvZiB0aGlzLl9hbGxUZXh0cykgc2Z0Ll9TZXRXcmFwQ2hhbmdlZCgpCiAgICAgICAgfQogICAgICAgIEdldENoYXJhY3RlcihjaCkgewogICAgICAgICAgICB0aGlzLlVwZGF0ZUNoYXJhY3Rlck1hcCgpOwogICAgICAgICAgICByZXR1cm4gdGhpcy5fY2hhcmFjdGVyTWFwLmdldChjaCkgfHwgbnVsbAogICAgICAgIH0KICAgICAgICBIYXNBbnlDdXN0b21XaWR0aHMoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9oYXNBbnlDdXN0b21XaWR0aHMKICAgICAgICB9CiAgICAgICAgU2V0V2lkdGgodykgewogICAgICAgICAgICB3ID0gTWF0aC5mbG9vcih3KTsKICAgICAgICAgICAgaWYgKHcgPD0gMCkgdGhyb3cgbmV3IEVycm9yKCJpbnZhbGlkIHNpemUiKTsKICAgICAgICAgICAgaWYgKHRoaXMuX3dpZHRoID09PSB3KSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuX3dpZHRoID0gdzsKICAgICAgICAgICAgdGhpcy5fbWFwQ2hhbmdlZCA9IHRydWUKICAgICAgICB9CiAgICAgICAgR2V0V2lkdGgoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl93aWR0aAogICAgICAgIH0KICAgICAgICBTZXRIZWlnaHQoaCkgewogICAgICAgICAgICBoID0KICAgICAgICAgICAgICAgIE1hdGguZmxvb3IoaCk7CiAgICAgICAgICAgIGlmIChoIDw9IDApIHRocm93IG5ldyBFcnJvcigiaW52YWxpZCBzaXplIik7CiAgICAgICAgICAgIGlmICh0aGlzLl9oZWlnaHQgPT09IGgpIHJldHVybjsKICAgICAgICAgICAgdGhpcy5faGVpZ2h0ID0gaDsKICAgICAgICAgICAgdGhpcy5fbWFwQ2hhbmdlZCA9IHRydWUKICAgICAgICB9CiAgICAgICAgR2V0SGVpZ2h0KCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faGVpZ2h0CiAgICAgICAgfQogICAgICAgIFNldFRleFJlY3QocmMpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX3RleFJlY3QuZXF1YWxzKHJjKSkgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl90ZXhSZWN0LmNvcHkocmMpOwogICAgICAgICAgICBmb3IgKGNvbnN0IHNmYyBvZiB0aGlzLl9jaGFyYWN0ZXJNYXAudmFsdWVzKCkpIHNmYy5fVXBkYXRlVGV4UmVjdCgpCiAgICAgICAgfQogICAgICAgIEdldFRleFJlY3QoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl90ZXhSZWN0CiAgICAgICAgfQogICAgICAgIFNldENoYXJhY3RlcldpZHRoKHcpIHsKICAgICAgICAgICAgdyA9IE1hdGguZmxvb3Iodyk7CiAgICAgICAgICAgIGlmICh3IDw9IDApIHRocm93IG5ldyBFcnJvcigiaW52YWxpZCBzaXplIik7CiAgICAgICAgICAgIGlmICh0aGlzLl9jaGFyYWN0ZXJXaWR0aCA9PT0gdykgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl9jaGFyYWN0ZXJXaWR0aCA9IHc7CiAgICAgICAgICAgIHRoaXMuX21hcENoYW5nZWQgPSB0cnVlCiAgICAgICAgfQogICAgICAgIEdldENoYXJhY3RlcldpZHRoKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fY2hhcmFjdGVyV2lkdGgKICAgICAgICB9CiAgICAgICAgU2V0Q2hhcmFjdGVySGVpZ2h0KGgpIHsKICAgICAgICAgICAgaCA9CiAgICAgICAgICAgICAgICBNYXRoLmZsb29yKGgpOwogICAgICAgICAgICBpZiAoaCA8PSAwKSB0aHJvdyBuZXcgRXJyb3IoImludmFsaWQgc2l6ZSIpOwogICAgICAgICAgICBpZiAodGhpcy5fY2hhcmFjdGVySGVpZ2h0ID09PSBoKSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuX2NoYXJhY3RlckhlaWdodCA9IGg7CiAgICAgICAgICAgIHRoaXMuX21hcENoYW5nZWQgPSB0cnVlCiAgICAgICAgfQogICAgICAgIEdldENoYXJhY3RlckhlaWdodCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NoYXJhY3RlckhlaWdodAogICAgICAgIH0KICAgICAgICBTZXRDaGFyYWN0ZXJTZXQocykgewogICAgICAgICAgICBpZiAodGhpcy5fY2hhcmFjdGVyU2V0ID09PSBzKSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuX2NoYXJhY3RlclNldCA9IHM7CiAgICAgICAgICAgIHRoaXMuX21hcENoYW5nZWQgPSB0cnVlCiAgICAgICAgfQogICAgICAgIEdldENoYXJhY3RlclNldCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NoYXJhY3RlclNldAogICAgICAgIH0KICAgICAgICBTZXRTcGFjaW5nRGF0YShzKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9zcGFjaW5nRGF0YSA9PT0gcykgcmV0dXJuOwogICAgICAgICAgICB0aGlzLl9zcGFjaW5nRGF0YSA9IHM7CiAgICAgICAgICAgIHRoaXMuX21hcENoYW5nZWQgPSB0cnVlOwogICAgICAgICAgICB0aGlzLl9zcGFjaW5nUGFyc2VkID0gbnVsbDsKICAgICAgICAgICAgaWYgKHRoaXMuX3NwYWNpbmdEYXRhLmxlbmd0aCkgdHJ5IHsKICAgICAgICAgICAgICAgIHRoaXMuX3NwYWNpbmdQYXJzZWQgPSBKU09OLnBhcnNlKHRoaXMuX3NwYWNpbmdEYXRhKQogICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9zcGFjaW5nUGFyc2VkID0KICAgICAgICAgICAgICAgICAgICBudWxsCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgR2V0U3BhY2luZ0RhdGEoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zcGFjaW5nRGF0YQogICAgICAgIH0KICAgICAgICBTZXRTcGFjZVdpZHRoKHcpIHsKICAgICAgICAgICAgaWYgKHcgPCAwKSB3ID0gLTE7CiAgICAgICAgICAgIGlmICh0aGlzLl9zcGFjZVdpZHRoID09PSB3KSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuX3NwYWNlV2lkdGggPSB3OwogICAgICAgICAgICBpZiAodGhpcy5fc3BhY2VXaWR0aCA+PSAwKSB0aGlzLl9oYXNBbnlDdXN0b21XaWR0aHMgPSB0cnVlCiAgICAgICAgfQogICAgICAgIEdldFNwYWNlV2lkdGgoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLl9zcGFjZVdpZHRoIDwgMCkgcmV0dXJuIHRoaXMuX2NoYXJhY3RlcldpZHRoOwogICAgICAgICAgICBlbHNlIHJldHVybiB0aGlzLl9zcGFjZVdpZHRoCiAgICAgICAgfQogICAgfTsKCn0KCnsKICAgICd1c2Ugc3RyaWN0JzsgewogICAgICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgICAgICBDMy5QbHVnaW5zLlRvdWNoID0gY2xhc3MgVG91Y2hQbHVnaW4gZXh0ZW5kcyBDMy5TREtQbHVnaW5CYXNlIHsKICAgICAgICAgICAgY29uc3RydWN0b3Iob3B0cykgewogICAgICAgICAgICAgICAgc3VwZXIob3B0cykKICAgICAgICAgICAgfQogICAgICAgICAgICBSZWxlYXNlKCkgewogICAgICAgICAgICAgICAgc3VwZXIuUmVsZWFzZSgpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IHsKICAgICAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICAgICAgY29uc3QgQzNYID0gc2VsZi5DM1g7CiAgICAgICAgQzMuUGx1Z2lucy5Ub3VjaC5UeXBlID0gY2xhc3MgVG91Y2hUeXBlIGV4dGVuZHMgQzMuU0RLVHlwZUJhc2UgewogICAgICAgICAgICBjb25zdHJ1Y3RvcihvYmplY3RDbGFzcykgewogICAgICAgICAgICAgICAgc3VwZXIob2JqZWN0Q2xhc3MpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgUmVsZWFzZSgpIHsKICAgICAgICAgICAgICAgIHN1cGVyLlJlbGVhc2UoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIE9uQ3JlYXRlKCkge30KICAgICAgICAgICAgR2V0U2NyaXB0SW50ZXJmYWNlQ2xhc3MoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5JVG91Y2hPYmplY3RUeXBlCiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIGxldCB0b3VjaE9iamVjdFR5cGUgPSBudWxsOwoKICAgICAgICBmdW5jdGlvbiBHZXRUb3VjaFNka0luc3RhbmNlKCkgewogICAgICAgICAgICByZXR1cm4gdG91Y2hPYmplY3RUeXBlLkdldFNpbmdsZUdsb2JhbEluc3RhbmNlKCkuR2V0U2RrSW5zdGFuY2UoKQogICAgICAgIH0KICAgICAgICBzZWxmLklUb3VjaE9iamVjdFR5cGUgPSBjbGFzcyBJVG91Y2hPYmplY3RUeXBlIGV4dGVuZHMgc2VsZi5JT2JqZWN0Q2xhc3MgewogICAgICAgICAgICBjb25zdHJ1Y3RvcihvYmplY3RUeXBlKSB7CiAgICAgICAgICAgICAgICBzdXBlcihvYmplY3RUeXBlKTsKICAgICAgICAgICAgICAgIHRvdWNoT2JqZWN0VHlwZSA9IG9iamVjdFR5cGU7CiAgICAgICAgICAgICAgICBvYmplY3RUeXBlLkdldFJ1bnRpbWUoKS5fR2V0Q29tbW9uU2NyaXB0SW50ZXJmYWNlcygpLnRvdWNoID0KICAgICAgICAgICAgICAgICAgICB0aGlzCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmVxdWVzdFBlcm1pc3Npb24odHlwZSkgewogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVTdHJpbmcodHlwZSk7CiAgICAgICAgICAgICAgICBjb25zdCB0b3VjaEluc3QgPSBHZXRUb3VjaFNka0luc3RhbmNlKCk7CiAgICAgICAgICAgICAgICBpZiAodHlwZSA9PT0gIm9yaWVudGF0aW9uIikgcmV0dXJuIHRvdWNoSW5zdC5fUmVxdWVzdFBlcm1pc3Npb24oMCk7CiAgICAgICAgICAgICAgICBlbHNlIGlmICh0eXBlID09PSAibW90aW9uIikgcmV0dXJuIHRvdWNoSW5zdC5fUmVxdWVzdFBlcm1pc3Npb24oMSk7CiAgICAgICAgICAgICAgICBlbHNlIHRocm93IG5ldyBFcnJvcigiaW52YWxpZCB0eXBlIik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IHsKICAgICAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICAgICAgY29uc3QgRE9NX0NPTVBPTkVOVF9JRCA9ICJ0b3VjaCI7CiAgICAgICAgQzMuUGx1Z2lucy5Ub3VjaC5JbnN0YW5jZSA9IGNsYXNzIFRvdWNoSW5zdGFuY2UgZXh0ZW5kcyBDMy5TREtJbnN0YW5jZUJhc2UgewogICAgICAgICAgICBjb25zdHJ1Y3RvcihpbnN0LCBwcm9wZXJ0aWVzKSB7CiAgICAgICAgICAgICAgICBzdXBlcihpbnN0LCBET01fQ09NUE9ORU5UX0lEKTsKICAgICAgICAgICAgICAgIHRoaXMuX3RvdWNoZXMgPSBuZXcgTWFwOwogICAgICAgICAgICAgICAgdGhpcy5fdXNlTW91c2VJbnB1dCA9IGZhbHNlOwogICAgICAgICAgICAgICAgdGhpcy5faXNNb3VzZURvd24gPSBmYWxzZTsKICAgICAgICAgICAgICAgIHRoaXMuX29yaWVudENvbXBhc3NIZWFkaW5nID0gMDsKICAgICAgICAgICAgICAgIHRoaXMuX29yaWVudEFscGhhID0gMDsKICAgICAgICAgICAgICAgIHRoaXMuX29yaWVudEJldGEgPSAwOwogICAgICAgICAgICAgICAgdGhpcy5fb3JpZW50R2FtbWEgPSAwOwogICAgICAgICAgICAgICAgdGhpcy5fYWNjWCA9IDA7CiAgICAgICAgICAgICAgICB0aGlzLl9hY2NZID0gMDsKICAgICAgICAgICAgICAgIHRoaXMuX2FjY1ogPSAwOwogICAgICAgICAgICAgICAgdGhpcy5fYWNjV2l0aEdYID0gMDsKICAgICAgICAgICAgICAgIHRoaXMuX2FjY1dpdGhHWSA9IDA7CiAgICAgICAgICAgICAgICB0aGlzLl9hY2NXaXRoR1ogPSAwOwogICAgICAgICAgICAgICAgdGhpcy5fdHJpZ2dlckluZGV4ID0gMDsKICAgICAgICAgICAgICAgIHRoaXMuX3RyaWdnZXJJZCA9IDA7CiAgICAgICAgICAgICAgICB0aGlzLl90cmlnZ2VyUGVybWlzc2lvbiA9IDA7CiAgICAgICAgICAgICAgICB0aGlzLl9jdXJUb3VjaFggPQogICAgICAgICAgICAgICAgICAgIDA7CiAgICAgICAgICAgICAgICB0aGlzLl9jdXJUb3VjaFkgPSAwOwogICAgICAgICAgICAgICAgdGhpcy5fZ2V0VG91Y2hJbmRleCA9IDA7CiAgICAgICAgICAgICAgICB0aGlzLl9wZXJtaXNzaW9uUHJvbWlzZXMgPSBbXTsKICAgICAgICAgICAgICAgIGlmIChwcm9wZXJ0aWVzKSB0aGlzLl91c2VNb3VzZUlucHV0ID0gcHJvcGVydGllc1swXTsKICAgICAgICAgICAgICAgIHRoaXMuQWRkRE9NTWVzc2FnZUhhbmRsZXIoInBlcm1pc3Npb24tcmVzdWx0IiwgZSA9PiB0aGlzLl9PblBlcm1pc3Npb25SZXN1bHQoZSkpOwogICAgICAgICAgICAgICAgY29uc3QgcnQgPSB0aGlzLkdldFJ1bnRpbWUoKS5EaXNwYXRjaGVyKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9kaXNwb3NhYmxlcyA9IG5ldyBDMy5Db21wb3NpdGVEaXNwb3NhYmxlKEMzLkRpc3Bvc2FibGUuRnJvbShydCwgInBvaW50ZXJkb3duIiwgZSA9PiB0aGlzLl9PblBvaW50ZXJEb3duKGUuZGF0YSkpLCBDMy5EaXNwb3NhYmxlLkZyb20ocnQsICJwb2ludGVybW92ZSIsIGUgPT4gdGhpcy5fT25Qb2ludGVyTW92ZShlLmRhdGEpKSwgQzMuRGlzcG9zYWJsZS5Gcm9tKHJ0LCAicG9pbnRlcnVwIiwgZSA9PiB0aGlzLl9PblBvaW50ZXJVcChlLmRhdGEsIGZhbHNlKSksIEMzLkRpc3Bvc2FibGUuRnJvbShydCwKICAgICAgICAgICAgICAgICAgICAicG9pbnRlcmNhbmNlbCIsIGUgPT4gdGhpcy5fT25Qb2ludGVyVXAoZS5kYXRhLCB0cnVlKSksIEMzLkRpc3Bvc2FibGUuRnJvbShydCwgImRldmljZW9yaWVudGF0aW9uIiwgZSA9PiB0aGlzLl9PbkRldmljZU9yaWVudGF0aW9uKGUuZGF0YSkpLCBDMy5EaXNwb3NhYmxlLkZyb20ocnQsICJkZXZpY2VvcmllbnRhdGlvbmFic29sdXRlIiwgZSA9PiB0aGlzLl9PbkRldmljZU9yaWVudGF0aW9uQWJzb2x1dGUoZS5kYXRhKSksIEMzLkRpc3Bvc2FibGUuRnJvbShydCwgImRldmljZW1vdGlvbiIsIGUgPT4gdGhpcy5fT25EZXZpY2VNb3Rpb24oZS5kYXRhKSksIEMzLkRpc3Bvc2FibGUuRnJvbShydCwgInRpY2syIiwgZSA9PiB0aGlzLl9PblRpY2syKCkpKQogICAgICAgICAgICB9CiAgICAgICAgICAgIFJlbGVhc2UoKSB7CiAgICAgICAgICAgICAgICB0aGlzLl90b3VjaGVzLmNsZWFyKCk7CiAgICAgICAgICAgICAgICBzdXBlci5SZWxlYXNlKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBfT25Qb2ludGVyRG93bihlKSB7CiAgICAgICAgICAgICAgICBpZiAoZVsicG9pbnRlclR5cGUiXSA9PT0gIm1vdXNlIikKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fdXNlTW91c2VJbnB1dCkgdGhpcy5faXNNb3VzZURvd24gPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGVsc2UgcmV0dXJuOwogICAgICAgICAgICAgICAgY29uc3QgcG9pbnRlcklkID0gZVsicG9pbnRlcklkIl07CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fdG91Y2hlcy5oYXMocG9pbnRlcklkKSkgcmV0dXJuOwogICAgICAgICAgICAgICAgY29uc3QgeCA9IGVbInBhZ2VYIl0gLSB0aGlzLl9ydW50aW1lLkdldENhbnZhc0NsaWVudFgoKTsKICAgICAgICAgICAgICAgIGNvbnN0IHkgPSBlWyJwYWdlWSJdIC0gdGhpcy5fcnVudGltZS5HZXRDYW52YXNDbGllbnRZKCk7CiAgICAgICAgICAgICAgICBjb25zdCBub3dUaW1lID0gcGVyZm9ybWFuY2Uubm93KCk7CiAgICAgICAgICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMuX3RvdWNoZXMuc2l6ZTsKICAgICAgICAgICAgICAgIHRoaXMuX3RyaWdnZXJJbmRleCA9IGluZGV4OwogICAgICAgICAgICAgICAgdGhpcy5fdHJpZ2dlcklkID0gcG9pbnRlcklkOwogICAgICAgICAgICAgICAgY29uc3QgdG91Y2hJbmZvID0gQzMuTmV3KEMzLlBsdWdpbnMuVG91Y2guVG91Y2hJbmZvKTsKICAgICAgICAgICAgICAgIHRvdWNoSW5mby5Jbml0KG5vd1RpbWUsIHgsIHksIHBvaW50ZXJJZCwgaW5kZXgpOwogICAgICAgICAgICAgICAgdGhpcy5fdG91Y2hlcy5zZXQocG9pbnRlcklkLCB0b3VjaEluZm8pOwogICAgICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKEMzLlBsdWdpbnMuVG91Y2guQ25kcy5Pbk50aFRvdWNoU3RhcnQpOwogICAgICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKEMzLlBsdWdpbnMuVG91Y2guQ25kcy5PblRvdWNoU3RhcnQpOwogICAgICAgICAgICAgICAgdGhpcy5fY3VyVG91Y2hYID0geDsKICAgICAgICAgICAgICAgIHRoaXMuX2N1clRvdWNoWSA9IHk7CiAgICAgICAgICAgICAgICB0aGlzLlRyaWdnZXIoQzMuUGx1Z2lucy5Ub3VjaC5DbmRzLk9uVG91Y2hPYmplY3QpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX09uUG9pbnRlck1vdmUoZSkgewogICAgICAgICAgICAgICAgaWYgKGVbInBvaW50ZXJUeXBlIl0gPT09ICJtb3VzZSIgJiYgIXRoaXMuX2lzTW91c2VEb3duKSByZXR1cm47CiAgICAgICAgICAgICAgICBjb25zdCB0b3VjaEluZm8gPSB0aGlzLl90b3VjaGVzLmdldChlWyJwb2ludGVySWQiXSk7CiAgICAgICAgICAgICAgICBpZiAoIXRvdWNoSW5mbykgcmV0dXJuOwogICAgICAgICAgICAgICAgY29uc3Qgbm93VGltZSA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICAgICAgICAgICAgaWYgKG5vd1RpbWUgLSB0b3VjaEluZm8uR2V0VGltZSgpIDwgMikgcmV0dXJuOwogICAgICAgICAgICAgICAgY29uc3QgeCA9IGVbInBhZ2VYIl0gLSB0aGlzLl9ydW50aW1lLkdldENhbnZhc0NsaWVudFgoKTsKICAgICAgICAgICAgICAgIGNvbnN0IHkgPSBlWyJwYWdlWSJdIC0gdGhpcy5fcnVudGltZS5HZXRDYW52YXNDbGllbnRZKCk7CiAgICAgICAgICAgICAgICB0b3VjaEluZm8uVXBkYXRlKG5vd1RpbWUsIHgsIHksIGVbIndpZHRoIl0sIGVbImhlaWdodCJdLCBlWyJwcmVzc3VyZSJdKQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9PblBvaW50ZXJVcChlLCBpc0NhbmNlbCkgewogICAgICAgICAgICAgICAgaWYgKGVbInBvaW50ZXJUeXBlIl0gPT09CiAgICAgICAgICAgICAgICAgICAgIm1vdXNlIikKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5faXNNb3VzZURvd24pIHRoaXMuX2lzTW91c2VEb3duID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgZWxzZSByZXR1cm47CiAgICAgICAgICAgICAgICBjb25zdCBub3dUaW1lID0gcGVyZm9ybWFuY2Uubm93KCk7CiAgICAgICAgICAgICAgICBjb25zdCBwb2ludGVySWQgPSBlWyJwb2ludGVySWQiXTsKICAgICAgICAgICAgICAgIGNvbnN0IHRvdWNoSW5mbyA9IHRoaXMuX3RvdWNoZXMuZ2V0KHBvaW50ZXJJZCk7CiAgICAgICAgICAgICAgICBpZiAoIXRvdWNoSW5mbykgcmV0dXJuOwogICAgICAgICAgICAgICAgdGhpcy5fdHJpZ2dlckluZGV4ID0gdG91Y2hJbmZvLkdldFN0YXJ0SW5kZXgoKTsKICAgICAgICAgICAgICAgIHRoaXMuX3RyaWdnZXJJZCA9IHRvdWNoSW5mby5HZXRJZCgpOwogICAgICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKEMzLlBsdWdpbnMuVG91Y2guQ25kcy5Pbk50aFRvdWNoRW5kKTsKICAgICAgICAgICAgICAgIHRoaXMuVHJpZ2dlcihDMy5QbHVnaW5zLlRvdWNoLkNuZHMuT25Ub3VjaEVuZCk7CiAgICAgICAgICAgICAgICBpZiAoIWlzQ2FuY2VsKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdGFwID0gdG91Y2hJbmZvLlNob3VsZFRyaWdnZXJUYXAobm93VGltZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRhcCA9PT0gInNpbmdsZS10YXAiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuVHJpZ2dlcihDMy5QbHVnaW5zLlRvdWNoLkNuZHMuT25UYXBHZXN0dXJlKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fY3VyVG91Y2hYID0gdG91Y2hJbmZvLkdldFgoKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fY3VyVG91Y2hZID0gdG91Y2hJbmZvLkdldFkoKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKEMzLlBsdWdpbnMuVG91Y2guQ25kcy5PblRhcEdlc3R1cmVPYmplY3QpCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0YXAgPT09ICJkb3VibGUtdGFwIikgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLlRyaWdnZXIoQzMuUGx1Z2lucy5Ub3VjaC5DbmRzLk9uRG91YmxlVGFwR2VzdHVyZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2N1clRvdWNoWCA9IHRvdWNoSW5mby5HZXRYKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2N1clRvdWNoWSA9IHRvdWNoSW5mby5HZXRZKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuVHJpZ2dlcihDMy5QbHVnaW5zLlRvdWNoLkNuZHMuT25Eb3VibGVUYXBHZXN0dXJlT2JqZWN0KQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRvdWNoSW5mby5SZWxlYXNlKCk7CiAgICAgICAgICAgICAgICB0aGlzLl90b3VjaGVzLmRlbGV0ZShwb2ludGVySWQpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX1JlcXVlc3RQZXJtaXNzaW9uKHR5cGUpIHsKICAgICAgICAgICAgICAgIHRoaXMuX1Bvc3RUb0RPTU1heWJlU3luYygicmVxdWVzdC1wZXJtaXNzaW9uIiwgewogICAgICAgICAgICAgICAgICAgICJ0eXBlIjogdHlwZQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewogICAgICAgICAgICAgICAgICAgIHRoaXMuX3Blcm1pc3Npb25Qcm9taXNlcy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSwKICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX09uUGVybWlzc2lvblJlc3VsdChlKSB7CiAgICAgICAgICAgICAgICBjb25zdCBpc0dyYW50ZWQgPSBlWyJyZXN1bHQiXTsKICAgICAgICAgICAgICAgIGNvbnN0IHR5cGUgPSBlWyJ0eXBlIl07CiAgICAgICAgICAgICAgICB0aGlzLl90cmlnZ2VyUGVybWlzc2lvbiA9IHR5cGU7CiAgICAgICAgICAgICAgICBjb25zdCB0b1Jlc29sdmUgPSB0aGlzLl9wZXJtaXNzaW9uUHJvbWlzZXMuZmlsdGVyKG8gPT4gby50eXBlID09PSB0eXBlKTsKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgbyBvZiB0b1Jlc29sdmUpIG8ucmVzb2x2ZShpc0dyYW50ZWQgPyAiZ3JhbnRlZCIgOiAiZGVuaWVkIik7CiAgICAgICAgICAgICAgICB0aGlzLl9wZXJtaXNzaW9uUHJvbWlzZXMgPSB0aGlzLl9wZXJtaXNzaW9uUHJvbWlzZXMuZmlsdGVyKG8gPT4gby50eXBlICE9PSB0eXBlKTsKICAgICAgICAgICAgICAgIGlmIChpc0dyYW50ZWQpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLlRyaWdnZXIoQzMuUGx1Z2lucy5Ub3VjaC5DbmRzLk9uUGVybWlzc2lvbkdyYW50ZWQpOwogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlID09PSAwKSB0aGlzLl9ydW50aW1lLlJlcXVlc3REZXZpY2VPcmllbnRhdGlvbkV2ZW50KCk7CiAgICAgICAgICAgICAgICAgICAgZWxzZSB0aGlzLl9ydW50aW1lLlJlcXVlc3REZXZpY2VNb3Rpb25FdmVudCgpCiAgICAgICAgICAgICAgICB9IGVsc2UgdGhpcy5UcmlnZ2VyKEMzLlBsdWdpbnMuVG91Y2guQ25kcy5PblBlcm1pc3Npb25EZW5pZWQpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX09uRGV2aWNlT3JpZW50YXRpb24oZSkgewogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBlWyJ3ZWJraXRDb21wYXNzSGVhZGluZyJdID09PQogICAgICAgICAgICAgICAgICAgICJudW1iZXIiKSB0aGlzLl9vcmllbnRDb21wYXNzSGVhZGluZyA9IGVbIndlYmtpdENvbXBhc3NIZWFkaW5nIl07CiAgICAgICAgICAgICAgICBlbHNlIGlmIChlWyJhYnNvbHV0ZSJdKSB0aGlzLl9vcmllbnRDb21wYXNzSGVhZGluZyA9IGVbImFscGhhIl07CiAgICAgICAgICAgICAgICB0aGlzLl9vcmllbnRBbHBoYSA9IGVbImFscGhhIl07CiAgICAgICAgICAgICAgICB0aGlzLl9vcmllbnRCZXRhID0gZVsiYmV0YSJdOwogICAgICAgICAgICAgICAgdGhpcy5fb3JpZW50R2FtbWEgPSBlWyJnYW1tYSJdCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX09uRGV2aWNlT3JpZW50YXRpb25BYnNvbHV0ZShlKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9vcmllbnRDb21wYXNzSGVhZGluZyA9IGVbImFscGhhIl0KICAgICAgICAgICAgfQogICAgICAgICAgICBfT25EZXZpY2VNb3Rpb24oZSkgewogICAgICAgICAgICAgICAgY29uc3QgYWNjID0gZVsiYWNjZWxlcmF0aW9uIl07CiAgICAgICAgICAgICAgICBpZiAoYWNjKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYWNjWCA9IGFjY1sieCJdOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2FjY1kgPSBhY2NbInkiXTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9hY2NaID0gYWNjWyJ6Il0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNvbnN0IHdpdGhHID0gZVsiYWNjZWxlcmF0aW9uSW5jbHVkaW5nR3Jhdml0eSJdOwogICAgICAgICAgICAgICAgaWYgKHdpdGhHKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYWNjV2l0aEdYID0gd2l0aEdbIngiXTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9hY2NXaXRoR1kgPSB3aXRoR1sieSJdOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2FjY1dpdGhHWiA9IHdpdGhHWyJ6Il0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBfT25UaWNrMigpIHsKICAgICAgICAgICAgICAgIGNvbnN0IG5vd1RpbWUgPSBwZXJmb3JtYW5jZS5ub3coKTsKICAgICAgICAgICAgICAgIGxldCBpbmRleCA9IDA7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHRvdWNoSW5mbyBvZiB0aGlzLl90b3VjaGVzLnZhbHVlcygpKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRvdWNoSW5mby5HZXRUaW1lKCkgPD0gbm93VGltZSAtIDUwKSB0b3VjaEluZm8uX1NldExhc3RUaW1lKG5vd1RpbWUpOwogICAgICAgICAgICAgICAgICAgIGlmICh0b3VjaEluZm8uU2hvdWxkVHJpZ2dlckhvbGQobm93VGltZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fdHJpZ2dlckluZGV4ID0gdG91Y2hJbmZvLkdldFN0YXJ0SW5kZXgoKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fdHJpZ2dlcklkID0gdG91Y2hJbmZvLkdldElkKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2dldFRvdWNoSW5kZXggPSBpbmRleDsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKEMzLlBsdWdpbnMuVG91Y2guQ25kcy5PbkhvbGRHZXN0dXJlKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fY3VyVG91Y2hYID0gdG91Y2hJbmZvLkdldFgoKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fY3VyVG91Y2hZID0gdG91Y2hJbmZvLkdldFkoKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKEMzLlBsdWdpbnMuVG91Y2guQ25kcy5PbkhvbGRHZXN0dXJlT2JqZWN0KTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fZ2V0VG91Y2hJbmRleCA9IDAKICAgICAgICAgICAgICAgICAgICB9KytpbmRleAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9HZXRUb3VjaEJ5SW5kZXgoaW5kZXgpIHsKICAgICAgICAgICAgICAgIGluZGV4ID0gTWF0aC5mbG9vcihpbmRleCk7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHRvdWNoSW5mbyBvZiB0aGlzLl90b3VjaGVzLnZhbHVlcygpKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGluZGV4ID09PSAwKSByZXR1cm4gdG91Y2hJbmZvOwogICAgICAgICAgICAgICAgICAgIC0taW5kZXgKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBudWxsCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX0lzQ2xpZW50UG9zT25DYW52YXModG91Y2hYLCB0b3VjaFkpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0b3VjaFggPj0gMCAmJiB0b3VjaFkgPj0gMCAmJiB0b3VjaFggPCB0aGlzLl9ydW50aW1lLkdldENhbnZhc0Nzc1dpZHRoKCkgJiYgdG91Y2hZIDwgdGhpcy5fcnVudGltZS5HZXRDYW52YXNDc3NIZWlnaHQoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIEdldERlYnVnZ2VyUHJvcGVydGllcygpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHByZWZpeCA9ICJwbHVnaW5zLnRvdWNoLmRlYnVnZ2VyIjsKICAgICAgICAgICAgICAgIHJldHVybiBbewogICAgICAgICAgICAgICAgICAgIHRpdGxlOiBwcmVmaXggKyAiLnRvdWNoZXMiLAogICAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IFsuLi50aGlzLl90b3VjaGVzLnZhbHVlcygpXS5tYXAodGkgPT4gKHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIiQiICsgdGkuR2V0SWQoKSwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRpLkdldFgoKSArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiLCAiICsgdGkuR2V0WSgpCiAgICAgICAgICAgICAgICAgICAgfSkpCiAgICAgICAgICAgICAgICB9XQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSB7CiAgICAgICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgICAgIGNvbnN0IHRlbXBBcnIgPSBbXTsKICAgICAgICBDMy5QbHVnaW5zLlRvdWNoLkNuZHMgPSB7CiAgICAgICAgICAgIE9uVG91Y2hTdGFydCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIE9uVG91Y2hFbmQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgICAgICB9LAogICAgICAgICAgICBJc0luVG91Y2goKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fdG91Y2hlcy5zaXplID4gMAogICAgICAgICAgICB9LAogICAgICAgICAgICBPblRvdWNoT2JqZWN0KG9iamVjdENsYXNzKSB7CiAgICAgICAgICAgICAgICBpZiAoIW9iamVjdENsYXNzKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX0lzQ2xpZW50UG9zT25DYW52YXModGhpcy5fY3VyVG91Y2hYLCB0aGlzLl9jdXJUb3VjaFkpKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcnVudGltZS5HZXRDb2xsaXNpb25FbmdpbmUoKS5UZXN0QW5kU2VsZWN0Q2FudmFzUG9pbnRPdmVybGFwKG9iamVjdENsYXNzLCB0aGlzLl9jdXJUb3VjaFgsIHRoaXMuX2N1clRvdWNoWSwgZmFsc2UpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIElzVG91Y2hpbmdPYmplY3Qob2JqZWN0Q2xhc3MpIHsKICAgICAgICAgICAgICAgIGlmICghb2JqZWN0Q2xhc3MpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIGNvbnN0IGludGVyYWN0aXZlTGF5ZXJzQ2FjaGUgPSBuZXcgTWFwOwogICAgICAgICAgICAgICAgY29uc3QgaXNMYXllckludGVyYWN0aXZlID0gbGF5ZXIgPT4gewogICAgICAgICAgICAgICAgICAgIGxldCByZXQgPSBpbnRlcmFjdGl2ZUxheWVyc0NhY2hlLmdldChsYXllcik7CiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiByZXQgPT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldCA9IGxheWVyLklzU2VsZkFuZFBhcmVudHNJbnRlcmFjdGl2ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICBpbnRlcmFjdGl2ZUxheWVyc0NhY2hlLnNldChsYXllciwgcmV0KQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgY29uc3Qgc29sID0gb2JqZWN0Q2xhc3MuR2V0Q3VycmVudFNvbCgpOwogICAgICAgICAgICAgICAgY29uc3QgaW5zdGFuY2VzID0gc29sLkdldEluc3RhbmNlcygpOwogICAgICAgICAgICAgICAgZm9yIChjb25zdCBpbnN0IG9mIGluc3RhbmNlcykgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHdpID0gaW5zdC5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBsYXllciA9IHdpLkdldExheWVyKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFpc0xheWVySW50ZXJhY3RpdmUobGF5ZXIpIHx8ICF3aS5Jc0luVmlld3BvcnQyKCkpIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgdG91Y2hJbmZvIG9mIHRoaXMuX3RvdWNoZXMudmFsdWVzKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9Jc0NsaWVudFBvc09uQ2FudmFzKHRvdWNoSW5mby5HZXRYKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG91Y2hJbmZvLkdldFkoKSkpIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBbcHgsIHB5XSA9IGxheWVyLkNhbnZhc0Nzc1RvTGF5ZXIodG91Y2hJbmZvLkdldFgoKSwgdG91Y2hJbmZvLkdldFkoKSwgd2kuR2V0VG90YWxaRWxldmF0aW9uKCkpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAod2kuQ29udGFpbnNQb2ludChweCwgcHkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wQXJyLnB1c2goaW5zdCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaW50ZXJhY3RpdmVMYXllcnNDYWNoZS5jbGVhcigpOwogICAgICAgICAgICAgICAgaWYgKHRlbXBBcnIubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgc29sLlNldEFycmF5UGlja2VkKHRlbXBBcnIpOwogICAgICAgICAgICAgICAgICAgIG9iamVjdENsYXNzLkFwcGx5U29sVG9Db250YWluZXIoKTsKICAgICAgICAgICAgICAgICAgICBDMy5jbGVhckFycmF5KHRlbXBBcnIpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgICAgICAgICB9IGVsc2UgcmV0dXJuIGZhbHNlCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIENvbXBhcmVUb3VjaFNwZWVkKGluZGV4LCBjbXAsIHMpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHRvdWNoSW5mbyA9IHRoaXMuX0dldFRvdWNoQnlJbmRleChpbmRleCk7CiAgICAgICAgICAgICAgICBpZiAoIXRvdWNoSW5mbykgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgcmV0dXJuIEMzLmNvbXBhcmUodG91Y2hJbmZvLkdldFNwZWVkKCksIGNtcCwgcykKICAgICAgICAgICAgfSwKICAgICAgICAgICAgT3JpZW50YXRpb25TdXBwb3J0ZWQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgICAgICB9LAogICAgICAgICAgICBNb3Rpb25TdXBwb3J0ZWQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgICAgICB9LAogICAgICAgICAgICBDb21wYXJlT3JpZW50YXRpb24ob3JpZW50YXRpb24sIGNtcCwgYSkgewogICAgICAgICAgICAgICAgdGhpcy5fcnVudGltZS5SZXF1ZXN0RGV2aWNlT3JpZW50YXRpb25FdmVudCgpOwogICAgICAgICAgICAgICAgbGV0IHYgPSAwOwogICAgICAgICAgICAgICAgaWYgKG9yaWVudGF0aW9uID09PSAwKSB2ID0gdGhpcy5fb3JpZW50QWxwaGE7CiAgICAgICAgICAgICAgICBlbHNlIGlmIChvcmllbnRhdGlvbiA9PT0gMSkgdiA9IHRoaXMuX29yaWVudEJldGE7CiAgICAgICAgICAgICAgICBlbHNlIHYgPSB0aGlzLl9vcmllbnRHYW1tYTsKICAgICAgICAgICAgICAgIHJldHVybiBDMy5jb21wYXJlKHYsIGNtcCwgYSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgQ29tcGFyZUFjY2VsZXJhdGlvbihhLCBjbXAsIHgpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuUmVxdWVzdERldmljZU1vdGlvbkV2ZW50KCk7CiAgICAgICAgICAgICAgICBsZXQgdiA9IDA7CiAgICAgICAgICAgICAgICBpZiAoYSA9PT0gMCkgdiA9IHRoaXMuX2FjY1dpdGhHWDsKICAgICAgICAgICAgICAgIGVsc2UgaWYgKGEgPT09IDEpIHYgPSB0aGlzLl9hY2NXaXRoR1k7CiAgICAgICAgICAgICAgICBlbHNlIGlmIChhID09PSAyKSB2ID0gdGhpcy5fYWNjV2l0aEdaOwogICAgICAgICAgICAgICAgZWxzZSBpZiAoYSA9PT0gMykgdiA9IHRoaXMuX2FjY1g7CiAgICAgICAgICAgICAgICBlbHNlIGlmIChhID09PSA0KSB2ID0gdGhpcy5fYWNjWTsKICAgICAgICAgICAgICAgIGVsc2UgdiA9IHRoaXMuX2FjY1o7CiAgICAgICAgICAgICAgICByZXR1cm4gQzMuY29tcGFyZSh2LAogICAgICAgICAgICAgICAgICAgIGNtcCwgeCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgT25OdGhUb3VjaFN0YXJ0KGluZGV4KSB7CiAgICAgICAgICAgICAgICBpbmRleCA9IE1hdGguZmxvb3IoaW5kZXgpOwogICAgICAgICAgICAgICAgcmV0dXJuIGluZGV4ID09PSB0aGlzLl90cmlnZ2VySW5kZXgKICAgICAgICAgICAgfSwKICAgICAgICAgICAgT25OdGhUb3VjaEVuZChpbmRleCkgewogICAgICAgICAgICAgICAgaW5kZXggPSBNYXRoLmZsb29yKGluZGV4KTsKICAgICAgICAgICAgICAgIHJldHVybiBpbmRleCA9PT0gdGhpcy5fdHJpZ2dlckluZGV4CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIEhhc050aFRvdWNoKGluZGV4KSB7CiAgICAgICAgICAgICAgICBpbmRleCA9IE1hdGguZmxvb3IoaW5kZXgpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RvdWNoZXMuc2l6ZSA+PSBpbmRleCArIDEKICAgICAgICAgICAgfSwKICAgICAgICAgICAgT25Ib2xkR2VzdHVyZSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIE9uVGFwR2VzdHVyZSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIE9uRG91YmxlVGFwR2VzdHVyZSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIE9uSG9sZEdlc3R1cmVPYmplY3Qob2JqZWN0Q2xhc3MpIHsKICAgICAgICAgICAgICAgIGlmICghb2JqZWN0Q2xhc3MpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5fSXNDbGllbnRQb3NPbkNhbnZhcyh0aGlzLl9jdXJUb3VjaFgsIHRoaXMuX2N1clRvdWNoWSkpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lLkdldENvbGxpc2lvbkVuZ2luZSgpLlRlc3RBbmRTZWxlY3RDYW52YXNQb2ludE92ZXJsYXAob2JqZWN0Q2xhc3MsCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY3VyVG91Y2hYLCB0aGlzLl9jdXJUb3VjaFksIGZhbHNlKQogICAgICAgICAgICB9LAogICAgICAgICAgICBPblRhcEdlc3R1cmVPYmplY3Qob2JqZWN0Q2xhc3MpIHsKICAgICAgICAgICAgICAgIGlmICghb2JqZWN0Q2xhc3MpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5fSXNDbGllbnRQb3NPbkNhbnZhcyh0aGlzLl9jdXJUb3VjaFgsIHRoaXMuX2N1clRvdWNoWSkpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9ydW50aW1lLkdldENvbGxpc2lvbkVuZ2luZSgpLlRlc3RBbmRTZWxlY3RDYW52YXNQb2ludE92ZXJsYXAob2JqZWN0Q2xhc3MsIHRoaXMuX2N1clRvdWNoWCwgdGhpcy5fY3VyVG91Y2hZLCBmYWxzZSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgT25Eb3VibGVUYXBHZXN0dXJlT2JqZWN0KG9iamVjdENsYXNzKSB7CiAgICAgICAgICAgICAgICBpZiAoIW9iamVjdENsYXNzKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX0lzQ2xpZW50UG9zT25DYW52YXModGhpcy5fY3VyVG91Y2hYLCB0aGlzLl9jdXJUb3VjaFkpKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcnVudGltZS5HZXRDb2xsaXNpb25FbmdpbmUoKS5UZXN0QW5kU2VsZWN0Q2FudmFzUG9pbnRPdmVybGFwKG9iamVjdENsYXNzLAogICAgICAgICAgICAgICAgICAgIHRoaXMuX2N1clRvdWNoWCwgdGhpcy5fY3VyVG91Y2hZLCBmYWxzZSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgT25QZXJtaXNzaW9uR3JhbnRlZCh0eXBlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fdHJpZ2dlclBlcm1pc3Npb24gPT09IHR5cGUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgT25QZXJtaXNzaW9uRGVuaWVkKHR5cGUpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl90cmlnZ2VyUGVybWlzc2lvbiA9PT0gdHlwZQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSB7CiAgICAgICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgICAgIEMzLlBsdWdpbnMuVG91Y2guQWN0cyA9IHsKICAgICAgICAgICAgUmVxdWVzdFBlcm1pc3Npb24odHlwZSkgewogICAgICAgICAgICAgICAgdGhpcy5fUmVxdWVzdFBlcm1pc3Npb24odHlwZSkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gewogICAgICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgICAgICBDMy5QbHVnaW5zLlRvdWNoLkV4cHMgPSB7CiAgICAgICAgICAgIFRvdWNoQ291bnQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fdG91Y2hlcy5zaXplCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFgobGF5ZXJQYXJhbSkgewogICAgICAgICAgICAgICAgY29uc3QgdG91Y2hJbmZvID0gdGhpcy5fR2V0VG91Y2hCeUluZGV4KHRoaXMuX2dldFRvdWNoSW5kZXgpOwogICAgICAgICAgICAgICAgaWYgKCF0b3VjaEluZm8pIHJldHVybiAwOwogICAgICAgICAgICAgICAgcmV0dXJuIHRvdWNoSW5mby5HZXRQb3NpdGlvbkZvckxheWVyKHRoaXMuX3J1bnRpbWUuR2V0Q3VycmVudExheW91dCgpLCBsYXllclBhcmFtLCB0cnVlKQogICAgICAgICAgICB9LAogICAgICAgICAgICBZKGxheWVyUGFyYW0pIHsKICAgICAgICAgICAgICAgIGNvbnN0IHRvdWNoSW5mbyA9IHRoaXMuX0dldFRvdWNoQnlJbmRleCh0aGlzLl9nZXRUb3VjaEluZGV4KTsKICAgICAgICAgICAgICAgIGlmICghdG91Y2hJbmZvKSByZXR1cm4gMDsKICAgICAgICAgICAgICAgIHJldHVybiB0b3VjaEluZm8uR2V0UG9zaXRpb25Gb3JMYXllcih0aGlzLl9ydW50aW1lLkdldEN1cnJlbnRMYXlvdXQoKSwgbGF5ZXJQYXJhbSwgZmFsc2UpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFhBdChpbmRleCwgbGF5ZXJQYXJhbSkgewogICAgICAgICAgICAgICAgY29uc3QgdG91Y2hJbmZvID0gdGhpcy5fR2V0VG91Y2hCeUluZGV4KGluZGV4KTsKICAgICAgICAgICAgICAgIGlmICghdG91Y2hJbmZvKSByZXR1cm4gMDsKICAgICAgICAgICAgICAgIHJldHVybiB0b3VjaEluZm8uR2V0UG9zaXRpb25Gb3JMYXllcih0aGlzLl9ydW50aW1lLkdldEN1cnJlbnRMYXlvdXQoKSwgbGF5ZXJQYXJhbSwgdHJ1ZSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgWUF0KGluZGV4LCBsYXllclBhcmFtKSB7CiAgICAgICAgICAgICAgICBjb25zdCB0b3VjaEluZm8gPSB0aGlzLl9HZXRUb3VjaEJ5SW5kZXgoaW5kZXgpOwogICAgICAgICAgICAgICAgaWYgKCF0b3VjaEluZm8pIHJldHVybiAwOwogICAgICAgICAgICAgICAgcmV0dXJuIHRvdWNoSW5mby5HZXRQb3NpdGlvbkZvckxheWVyKHRoaXMuX3J1bnRpbWUuR2V0Q3VycmVudExheW91dCgpLCBsYXllclBhcmFtLCBmYWxzZSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgWEZvcklEKGlkLCBsYXllclBhcmFtKSB7CiAgICAgICAgICAgICAgICBjb25zdCB0b3VjaEluZm8gPSB0aGlzLl90b3VjaGVzLmdldChpZCk7CiAgICAgICAgICAgICAgICBpZiAoIXRvdWNoSW5mbykgcmV0dXJuIDA7CiAgICAgICAgICAgICAgICByZXR1cm4gdG91Y2hJbmZvLkdldFBvc2l0aW9uRm9yTGF5ZXIodGhpcy5fcnVudGltZS5HZXRDdXJyZW50TGF5b3V0KCksIGxheWVyUGFyYW0sIHRydWUpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFlGb3JJRChpZCwgbGF5ZXJQYXJhbSkgewogICAgICAgICAgICAgICAgY29uc3QgdG91Y2hJbmZvID0gdGhpcy5fdG91Y2hlcy5nZXQoaWQpOwogICAgICAgICAgICAgICAgaWYgKCF0b3VjaEluZm8pIHJldHVybiAwOwogICAgICAgICAgICAgICAgcmV0dXJuIHRvdWNoSW5mby5HZXRQb3NpdGlvbkZvckxheWVyKHRoaXMuX3J1bnRpbWUuR2V0Q3VycmVudExheW91dCgpLCBsYXllclBhcmFtLCBmYWxzZSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgQWJzb2x1dGVYKCkgewogICAgICAgICAgICAgICAgY29uc3QgdG91Y2hJbmZvID0gdGhpcy5fR2V0VG91Y2hCeUluZGV4KDApOwogICAgICAgICAgICAgICAgaWYgKHRvdWNoSW5mbykgcmV0dXJuIHRvdWNoSW5mby5HZXRYKCk7CiAgICAgICAgICAgICAgICBlbHNlIHJldHVybiAwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIEFic29sdXRlWSgpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHRvdWNoSW5mbyA9IHRoaXMuX0dldFRvdWNoQnlJbmRleCgwKTsKICAgICAgICAgICAgICAgIGlmICh0b3VjaEluZm8pIHJldHVybiB0b3VjaEluZm8uR2V0WSgpOwogICAgICAgICAgICAgICAgZWxzZSByZXR1cm4gMAogICAgICAgICAgICB9LAogICAgICAgICAgICBBYnNvbHV0ZVhBdChpbmRleCkgewogICAgICAgICAgICAgICAgY29uc3QgdG91Y2hJbmZvID0gdGhpcy5fR2V0VG91Y2hCeUluZGV4KGluZGV4KTsKICAgICAgICAgICAgICAgIGlmICh0b3VjaEluZm8pIHJldHVybiB0b3VjaEluZm8uR2V0WCgpOwogICAgICAgICAgICAgICAgZWxzZSByZXR1cm4gMAogICAgICAgICAgICB9LAogICAgICAgICAgICBBYnNvbHV0ZVlBdChpbmRleCkgewogICAgICAgICAgICAgICAgY29uc3QgdG91Y2hJbmZvID0gdGhpcy5fR2V0VG91Y2hCeUluZGV4KGluZGV4KTsKICAgICAgICAgICAgICAgIGlmICh0b3VjaEluZm8pIHJldHVybiB0b3VjaEluZm8uR2V0WSgpOwogICAgICAgICAgICAgICAgZWxzZSByZXR1cm4gMAogICAgICAgICAgICB9LAogICAgICAgICAgICBBYnNvbHV0ZVhGb3JJRChpZCkgewogICAgICAgICAgICAgICAgY29uc3QgdG91Y2hJbmZvID0gdGhpcy5fdG91Y2hlcy5nZXQoaWQpOwogICAgICAgICAgICAgICAgaWYgKHRvdWNoSW5mbykgcmV0dXJuIHRvdWNoSW5mby5HZXRYKCk7CiAgICAgICAgICAgICAgICBlbHNlIHJldHVybiAwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIEFic29sdXRlWUZvcklEKGlkKSB7CiAgICAgICAgICAgICAgICBjb25zdCB0b3VjaEluZm8gPSB0aGlzLl90b3VjaGVzLmdldChpZCk7CiAgICAgICAgICAgICAgICBpZiAodG91Y2hJbmZvKSByZXR1cm4gdG91Y2hJbmZvLkdldFkoKTsKICAgICAgICAgICAgICAgIGVsc2UgcmV0dXJuIDAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgU3BlZWRBdChpbmRleCkgewogICAgICAgICAgICAgICAgY29uc3QgdG91Y2hJbmZvID0gdGhpcy5fR2V0VG91Y2hCeUluZGV4KGluZGV4KTsKICAgICAgICAgICAgICAgIGlmICh0b3VjaEluZm8pIHJldHVybiB0b3VjaEluZm8uR2V0U3BlZWQoKTsKICAgICAgICAgICAgICAgIGVsc2UgcmV0dXJuIDAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgU3BlZWRGb3JJRChpZCkgewogICAgICAgICAgICAgICAgY29uc3QgdG91Y2hJbmZvID0gdGhpcy5fdG91Y2hlcy5nZXQoaWQpOwogICAgICAgICAgICAgICAgaWYgKHRvdWNoSW5mbykgcmV0dXJuIHRvdWNoSW5mby5HZXRTcGVlZCgpOwogICAgICAgICAgICAgICAgZWxzZSByZXR1cm4gMAogICAgICAgICAgICB9LAogICAgICAgICAgICBBbmdsZUF0KGluZGV4KSB7CiAgICAgICAgICAgICAgICBjb25zdCB0b3VjaEluZm8gPQogICAgICAgICAgICAgICAgICAgIHRoaXMuX0dldFRvdWNoQnlJbmRleChpbmRleCk7CiAgICAgICAgICAgICAgICBpZiAodG91Y2hJbmZvKSByZXR1cm4gQzMudG9EZWdyZWVzKHRvdWNoSW5mby5HZXRBbmdsZSgpKTsKICAgICAgICAgICAgICAgIGVsc2UgcmV0dXJuIDAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgQW5nbGVGb3JJRChpZCkgewogICAgICAgICAgICAgICAgY29uc3QgdG91Y2hJbmZvID0gdGhpcy5fdG91Y2hlcy5nZXQoaWQpOwogICAgICAgICAgICAgICAgaWYgKHRvdWNoSW5mbykgcmV0dXJuIEMzLnRvRGVncmVlcyh0b3VjaEluZm8uR2V0QW5nbGUoKSk7CiAgICAgICAgICAgICAgICBlbHNlIHJldHVybiAwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIENvbXBhc3NIZWFkaW5nKCkgewogICAgICAgICAgICAgICAgdGhpcy5fcnVudGltZS5SZXF1ZXN0RGV2aWNlT3JpZW50YXRpb25FdmVudCgpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX29yaWVudENvbXBhc3NIZWFkaW5nCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIEFscGhhKCkgewogICAgICAgICAgICAgICAgdGhpcy5fcnVudGltZS5SZXF1ZXN0RGV2aWNlT3JpZW50YXRpb25FdmVudCgpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX29yaWVudEFscGhhCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIEJldGEoKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9ydW50aW1lLlJlcXVlc3REZXZpY2VPcmllbnRhdGlvbkV2ZW50KCk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fb3JpZW50QmV0YQogICAgICAgICAgICB9LAogICAgICAgICAgICBHYW1tYSgpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuUmVxdWVzdERldmljZU9yaWVudGF0aW9uRXZlbnQoKTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9vcmllbnRHYW1tYQogICAgICAgICAgICB9LAogICAgICAgICAgICBBY2NlbGVyYXRpb25YV2l0aEcoKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9ydW50aW1lLlJlcXVlc3REZXZpY2VNb3Rpb25FdmVudCgpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2FjY1dpdGhHWAogICAgICAgICAgICB9LAogICAgICAgICAgICBBY2NlbGVyYXRpb25ZV2l0aEcoKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9ydW50aW1lLlJlcXVlc3REZXZpY2VNb3Rpb25FdmVudCgpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2FjY1dpdGhHWQogICAgICAgICAgICB9LAogICAgICAgICAgICBBY2NlbGVyYXRpb25aV2l0aEcoKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9ydW50aW1lLlJlcXVlc3REZXZpY2VNb3Rpb25FdmVudCgpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2FjY1dpdGhHWgogICAgICAgICAgICB9LAogICAgICAgICAgICBBY2NlbGVyYXRpb25YKCkgewogICAgICAgICAgICAgICAgdGhpcy5fcnVudGltZS5SZXF1ZXN0RGV2aWNlTW90aW9uRXZlbnQoKTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9hY2NYCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIEFjY2VsZXJhdGlvblkoKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9ydW50aW1lLlJlcXVlc3REZXZpY2VNb3Rpb25FdmVudCgpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2FjY1kKICAgICAgICAgICAgfSwKICAgICAgICAgICAgQWNjZWxlcmF0aW9uWigpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuUmVxdWVzdERldmljZU1vdGlvbkV2ZW50KCk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fYWNjWgogICAgICAgICAgICB9LAogICAgICAgICAgICBUb3VjaEluZGV4KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RyaWdnZXJJbmRleAogICAgICAgICAgICB9LAogICAgICAgICAgICBUb3VjaElEKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RyaWdnZXJJZAogICAgICAgICAgICB9LAogICAgICAgICAgICBXaWR0aEZvcklEKGlkKSB7CiAgICAgICAgICAgICAgICBjb25zdCB0b3VjaEluZm8gPSB0aGlzLl90b3VjaGVzLmdldChpZCk7CiAgICAgICAgICAgICAgICBpZiAodG91Y2hJbmZvKSByZXR1cm4gdG91Y2hJbmZvLkdldFdpZHRoKCk7CiAgICAgICAgICAgICAgICBlbHNlIHJldHVybiAwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIEhlaWdodEZvcklEKGlkKSB7CiAgICAgICAgICAgICAgICBjb25zdCB0b3VjaEluZm8gPSB0aGlzLl90b3VjaGVzLmdldChpZCk7CiAgICAgICAgICAgICAgICBpZiAodG91Y2hJbmZvKSByZXR1cm4gdG91Y2hJbmZvLkdldEhlaWdodCgpOwogICAgICAgICAgICAgICAgZWxzZSByZXR1cm4gMAogICAgICAgICAgICB9LAogICAgICAgICAgICBQcmVzc3VyZUZvcklEKGlkKSB7CiAgICAgICAgICAgICAgICBjb25zdCB0b3VjaEluZm8gPSB0aGlzLl90b3VjaGVzLmdldChpZCk7CiAgICAgICAgICAgICAgICBpZiAodG91Y2hJbmZvKSByZXR1cm4gdG91Y2hJbmZvLkdldFByZXNzdXJlKCk7CiAgICAgICAgICAgICAgICBlbHNlIHJldHVybiAwCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwoKfQoKewogICAgJ3VzZSBzdHJpY3QnOwogICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgY29uc3QgR0VTVFVSRV9IT0xEX1RIUkVTSE9MRCA9IDE1OwogICAgY29uc3QgR0VTVFVSRV9IT0xEX1RJTUVPVVQgPSA1MDA7CiAgICBjb25zdCBHRVNUVVJFX1RBUF9USU1FT1VUID0gMzMzOwogICAgY29uc3QgR0VTVFVSRV9ET1VCTEVUQVBfVEhSRVNIT0xEID0gMjU7CiAgICBsZXQgbGFzdFRhcFggPSAtMUUzOwogICAgbGV0IGxhc3RUYXBZID0gLTFFMzsKICAgIGxldCBsYXN0VGFwVGltZSA9IC0xRTQ7CiAgICBDMy5QbHVnaW5zLlRvdWNoLlRvdWNoSW5mbyA9IGNsYXNzIFRvdWNoSW5mbyBleHRlbmRzIEMzLkRlZmVuZGVkQmFzZSB7CiAgICAgICAgY29uc3RydWN0b3IoKSB7CiAgICAgICAgICAgIHN1cGVyKCk7CiAgICAgICAgICAgIHRoaXMuX3BvaW50ZXJJZCA9IDA7CiAgICAgICAgICAgIHRoaXMuX3N0YXJ0SW5kZXggPSAwOwogICAgICAgICAgICB0aGlzLl9zdGFydFRpbWUgPSAwOwogICAgICAgICAgICB0aGlzLl90aW1lID0gMDsKICAgICAgICAgICAgdGhpcy5fbGFzdFRpbWUgPSAwOwogICAgICAgICAgICB0aGlzLl9zdGFydFggPSAwOwogICAgICAgICAgICB0aGlzLl9zdGFydFkgPSAwOwogICAgICAgICAgICB0aGlzLl94ID0gMDsKICAgICAgICAgICAgdGhpcy5feSA9IDA7CiAgICAgICAgICAgIHRoaXMuX2xhc3RYID0gMDsKICAgICAgICAgICAgdGhpcy5fbGFzdFkgPSAwOwogICAgICAgICAgICB0aGlzLl93aWR0aCA9IDA7CiAgICAgICAgICAgIHRoaXMuX2hlaWdodCA9IDA7CiAgICAgICAgICAgIHRoaXMuX3ByZXNzdXJlID0gMDsKICAgICAgICAgICAgdGhpcy5faGFzVHJpZ2dlcmVkSG9sZCA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl9pc1Rvb0ZhckZvckhvbGQgPSBmYWxzZQogICAgICAgIH0KICAgICAgICBSZWxlYXNlKCkge30KICAgICAgICBJbml0KG5vd1RpbWUsIHgsIHksIGlkLCBpbmRleCkgewogICAgICAgICAgICB0aGlzLl9wb2ludGVySWQgPSBpZDsKICAgICAgICAgICAgdGhpcy5fc3RhcnRJbmRleCA9IGluZGV4OwogICAgICAgICAgICB0aGlzLl90aW1lID0gbm93VGltZTsKICAgICAgICAgICAgdGhpcy5fbGFzdFRpbWUgPSBub3dUaW1lOwogICAgICAgICAgICB0aGlzLl9zdGFydFRpbWUgPSBub3dUaW1lOwogICAgICAgICAgICB0aGlzLl9zdGFydFggPSB4OwogICAgICAgICAgICB0aGlzLl9zdGFydFkgPSB5OwogICAgICAgICAgICB0aGlzLl94ID0geDsKICAgICAgICAgICAgdGhpcy5feSA9IHk7CiAgICAgICAgICAgIHRoaXMuX2xhc3RYID0geDsKICAgICAgICAgICAgdGhpcy5fbGFzdFkgPSB5CiAgICAgICAgfQogICAgICAgIFVwZGF0ZShub3dUaW1lLCB4LCB5LCB3aWR0aCwgaGVpZ2h0LCBwcmVzc3VyZSkgewogICAgICAgICAgICB0aGlzLl9sYXN0VGltZSA9IHRoaXMuX3RpbWU7CiAgICAgICAgICAgIHRoaXMuX3RpbWUgPSBub3dUaW1lOwogICAgICAgICAgICB0aGlzLl9sYXN0WCA9IHRoaXMuX3g7CiAgICAgICAgICAgIHRoaXMuX2xhc3RZID0gdGhpcy5feTsKICAgICAgICAgICAgdGhpcy5feCA9IHg7CiAgICAgICAgICAgIHRoaXMuX3kgPSB5OwogICAgICAgICAgICB0aGlzLl93aWR0aCA9IHdpZHRoOwogICAgICAgICAgICB0aGlzLl9oZWlnaHQgPSBoZWlnaHQ7CiAgICAgICAgICAgIHRoaXMuX3ByZXNzdXJlID0gcHJlc3N1cmU7CiAgICAgICAgICAgIGlmICghdGhpcy5faXNUb29GYXJGb3JIb2xkICYmIEMzLmRpc3RhbmNlVG8odGhpcy5fc3RhcnRYLCB0aGlzLl9zdGFydFksIHRoaXMuX3gsIHRoaXMuX3kpID49IEdFU1RVUkVfSE9MRF9USFJFU0hPTEQpIHRoaXMuX2lzVG9vRmFyRm9ySG9sZCA9IHRydWUKICAgICAgICB9CiAgICAgICAgR2V0SWQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9wb2ludGVySWQKICAgICAgICB9CiAgICAgICAgR2V0U3RhcnRJbmRleCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3N0YXJ0SW5kZXgKICAgICAgICB9CiAgICAgICAgR2V0VGltZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RpbWUKICAgICAgICB9CiAgICAgICAgX1NldExhc3RUaW1lKHQpIHsKICAgICAgICAgICAgdGhpcy5fbGFzdFRpbWUgPQogICAgICAgICAgICAgICAgdAogICAgICAgIH0KICAgICAgICBHZXRYKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5feAogICAgICAgIH0KICAgICAgICBHZXRZKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5feQogICAgICAgIH0KICAgICAgICBHZXRTcGVlZCgpIHsKICAgICAgICAgICAgY29uc3QgZGlzdCA9IEMzLmRpc3RhbmNlVG8odGhpcy5feCwgdGhpcy5feSwgdGhpcy5fbGFzdFgsIHRoaXMuX2xhc3RZKTsKICAgICAgICAgICAgY29uc3QgZHQgPSAodGhpcy5fdGltZSAtIHRoaXMuX2xhc3RUaW1lKSAvIDFFMzsKICAgICAgICAgICAgaWYgKGR0ID4gMCkgcmV0dXJuIGRpc3QgLyBkdDsKICAgICAgICAgICAgZWxzZSByZXR1cm4gMAogICAgICAgIH0KICAgICAgICBHZXRBbmdsZSgpIHsKICAgICAgICAgICAgcmV0dXJuIEMzLmFuZ2xlVG8odGhpcy5fbGFzdFgsIHRoaXMuX2xhc3RZLCB0aGlzLl94LCB0aGlzLl95KQogICAgICAgIH0KICAgICAgICBHZXRXaWR0aCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3dpZHRoCiAgICAgICAgfQogICAgICAgIEdldEhlaWdodCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2hlaWdodAogICAgICAgIH0KICAgICAgICBHZXRQcmVzc3VyZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3ByZXNzdXJlCiAgICAgICAgfQogICAgICAgIFNob3VsZFRyaWdnZXJIb2xkKG5vd1RpbWUpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX2hhc1RyaWdnZXJlZEhvbGQpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgaWYgKG5vd1RpbWUgLSB0aGlzLl9zdGFydFRpbWUgPj0gR0VTVFVSRV9IT0xEX1RJTUVPVVQgJiYgIXRoaXMuX2lzVG9vRmFyRm9ySG9sZCAmJgogICAgICAgICAgICAgICAgQzMuZGlzdGFuY2VUbyh0aGlzLl9zdGFydFgsIHRoaXMuX3N0YXJ0WSwgdGhpcy5feCwgdGhpcy5feSkgPCBHRVNUVVJFX0hPTERfVEhSRVNIT0xEKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9oYXNUcmlnZ2VyZWRIb2xkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgfQogICAgICAgIFNob3VsZFRyaWdnZXJUYXAobm93VGltZSkgewogICAgICAgICAgICBpZiAodGhpcy5faGFzVHJpZ2dlcmVkSG9sZCkgcmV0dXJuICIiOwogICAgICAgICAgICBpZiAobm93VGltZSAtIHRoaXMuX3N0YXJ0VGltZSA8PSBHRVNUVVJFX1RBUF9USU1FT1VUICYmICF0aGlzLl9pc1Rvb0ZhckZvckhvbGQgJiYgQzMuZGlzdGFuY2VUbyh0aGlzLl9zdGFydFgsIHRoaXMuX3N0YXJ0WSwgdGhpcy5feCwgdGhpcy5feSkgPCBHRVNUVVJFX0hPTERfVEhSRVNIT0xEKQogICAgICAgICAgICAgICAgaWYgKG5vd1RpbWUgLSBsYXN0VGFwVGltZSA8PSBHRVNUVVJFX1RBUF9USU1FT1VUICogMiAmJiBDMy5kaXN0YW5jZVRvKGxhc3RUYXBYLCBsYXN0VGFwWSwgdGhpcy5feCwgdGhpcy5feSkgPCBHRVNUVVJFX0RPVUJMRVRBUF9USFJFU0hPTEQpIHsKICAgICAgICAgICAgICAgICAgICBsYXN0VGFwWCA9IC0xRTM7CiAgICAgICAgICAgICAgICAgICAgbGFzdFRhcFkgPSAtMUUzOwogICAgICAgICAgICAgICAgICAgIGxhc3RUYXBUaW1lID0gLTFFNDsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gImRvdWJsZS10YXAiCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGxhc3RUYXBYID0gdGhpcy5feDsKICAgICAgICAgICAgICAgICAgICBsYXN0VGFwWSA9IHRoaXMuX3k7CiAgICAgICAgICAgICAgICAgICAgbGFzdFRhcFRpbWUgPSBub3dUaW1lOwogICAgICAgICAgICAgICAgICAgIHJldHVybiAic2luZ2xlLXRhcCIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuICIiCiAgICAgICAgfQogICAgICAgIEdldFBvc2l0aW9uRm9yTGF5ZXIobGF5b3V0LCBsYXllck5hbWVPck51bWJlciwgZ2V0eCkgewogICAgICAgICAgICBpZiAodHlwZW9mIGxheWVyTmFtZU9yTnVtYmVyID09PSAidW5kZWZpbmVkIikgewogICAgICAgICAgICAgICAgY29uc3QgbGF5ZXIgPSBsYXlvdXQuR2V0TGF5ZXJCeUluZGV4KDApOwogICAgICAgICAgICAgICAgcmV0dXJuIGxheWVyLkNhbnZhc0Nzc1RvTGF5ZXJfRGVmYXVsdFRyYW5zZm9ybSh0aGlzLl94LCB0aGlzLl95KVtnZXR4ID8gMCA6IDFdCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjb25zdCBsYXllciA9IGxheW91dC5HZXRMYXllcihsYXllck5hbWVPck51bWJlcik7CiAgICAgICAgICAgICAgICBpZiAobGF5ZXIpIHJldHVybiBsYXllci5DYW52YXNDc3NUb0xheWVyKHRoaXMuX3gsIHRoaXMuX3kpW2dldHggPyAwIDogMV07CiAgICAgICAgICAgICAgICBlbHNlIHJldHVybiAwCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwoKfQoKewogICAgJ3VzZSBzdHJpY3QnOyB7CiAgICAgICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgICAgIEMzLlBsdWdpbnMuVGlsZWRCZyA9IGNsYXNzIFRpbGVkQmdQbHVnaW4gZXh0ZW5kcyBDMy5TREtQbHVnaW5CYXNlIHsKICAgICAgICAgICAgY29uc3RydWN0b3Iob3B0cykgewogICAgICAgICAgICAgICAgc3VwZXIob3B0cykKICAgICAgICAgICAgfQogICAgICAgICAgICBSZWxlYXNlKCkgewogICAgICAgICAgICAgICAgc3VwZXIuUmVsZWFzZSgpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IHsKICAgICAgICBjb25zdCBDMyA9IHNlbGYuQzM7CgogICAgICAgIGZ1bmN0aW9uIFdyYXBNb2RlVG9TdHIod3JhcE1vZGUpIHsKICAgICAgICAgICAgc3dpdGNoICh3cmFwTW9kZSkgewogICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgIHJldHVybiAiY2xhbXAtdG8tZWRnZSI7CiAgICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJyZXBlYXQiOwogICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgICAgIHJldHVybiAibWlycm9yLXJlcGVhdCIKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gInJlcGVhdCIKICAgICAgICB9CiAgICAgICAgQzMuUGx1Z2lucy5UaWxlZEJnLlR5cGUgPSBjbGFzcyBUaWxlZEJnVHlwZSBleHRlbmRzIEMzLlNES1R5cGVCYXNlIHsKICAgICAgICAgICAgY29uc3RydWN0b3Iob2JqZWN0Q2xhc3MsIGV4cG9ydERhdGEpIHsKICAgICAgICAgICAgICAgIHN1cGVyKG9iamVjdENsYXNzKTsKICAgICAgICAgICAgICAgIHRoaXMuX3dyYXBYID0gInJlcGVhdCI7CiAgICAgICAgICAgICAgICB0aGlzLl93cmFwWSA9ICJyZXBlYXQiOwogICAgICAgICAgICAgICAgaWYgKGV4cG9ydERhdGEpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl93cmFwWCA9IFdyYXBNb2RlVG9TdHIoZXhwb3J0RGF0YVswXSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fd3JhcFkgPSBXcmFwTW9kZVRvU3RyKGV4cG9ydERhdGFbMV0pCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgUmVsZWFzZSgpIHsKICAgICAgICAgICAgICAgIHN1cGVyLlJlbGVhc2UoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIE9uQ3JlYXRlKCkgewogICAgICAgICAgICAgICAgdGhpcy5HZXRJbWFnZUluZm8oKS5Mb2FkQXNzZXQodGhpcy5fcnVudGltZSkKICAgICAgICAgICAgfQogICAgICAgICAgICBMb2FkVGV4dHVyZXMocmVuZGVyZXIpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLkdldEltYWdlSW5mbygpLkxvYWRTdGF0aWNUZXh0dXJlKHJlbmRlcmVyLCB7CiAgICAgICAgICAgICAgICAgICAgc2FtcGxpbmc6IHRoaXMuX3J1bnRpbWUuR2V0U2FtcGxpbmcoKSwKICAgICAgICAgICAgICAgICAgICB3cmFwWDogdGhpcy5fd3JhcFgsCiAgICAgICAgICAgICAgICAgICAgd3JhcFk6IHRoaXMuX3dyYXBZCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9CiAgICAgICAgICAgIFJlbGVhc2VUZXh0dXJlcygpIHsKICAgICAgICAgICAgICAgIHRoaXMuR2V0SW1hZ2VJbmZvKCkuUmVsZWFzZVRleHR1cmUoKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSB7CiAgICAgICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgICAgIGNvbnN0IEMzWCA9IHNlbGYuQzNYOwogICAgICAgIGNvbnN0IElOSVRJQUxMWV9WSVNJQkxFID0gMDsKICAgICAgICBjb25zdCBPUklHSU4gPSAxOwogICAgICAgIGNvbnN0IElNQUdFX09GRlNFVF9YID0gNDsKICAgICAgICBjb25zdCBJTUFHRV9PRkZTRVRfWSA9IDU7CiAgICAgICAgY29uc3QgSU1BR0VfU0NBTEVfWCA9IDY7CiAgICAgICAgY29uc3QgSU1BR0VfU0NBTEVfWSA9IDc7CiAgICAgICAgY29uc3QgSU1BR0VfQU5HTEUgPSA4OwogICAgICAgIGNvbnN0IEVOQUJMRV9USUxFX1JBTkRPTUlaQVRJT04gPSA5OwogICAgICAgIGNvbnN0IFRJTEVfWFJBTkRPTSA9IDEwOwogICAgICAgIGNvbnN0IFRJTEVfWVJBTkRPTSA9IDExOwogICAgICAgIGNvbnN0IFRJTEVfQU5HTEVSQU5ET00gPSAxMjsKICAgICAgICBjb25zdCBUSUxFX0JMRU5ETUFSR0lOWCA9IDEzOwogICAgICAgIGNvbnN0IFRJTEVfQkxFTkRNQVJHSU5ZID0gMTQ7CiAgICAgICAgY29uc3QgdGVtcFJlY3QgPSBDMy5OZXcoQzMuUmVjdCk7CiAgICAgICAgY29uc3QgdGVtcFF1YWQgPSBDMy5OZXcoQzMuUXVhZCk7CiAgICAgICAgY29uc3QgcmNUZXggPSBDMy5OZXcoQzMuUmVjdCk7CiAgICAgICAgY29uc3QgcVRleCA9IEMzLk5ldyhDMy5RdWFkKTsKICAgICAgICBDMy5QbHVnaW5zLlRpbGVkQmcuSW5zdGFuY2UgPSBjbGFzcyBUaWxlZEJnSW5zdGFuY2UgZXh0ZW5kcyBDMy5TREtXb3JsZEluc3RhbmNlQmFzZSB7CiAgICAgICAgICAgIGNvbnN0cnVjdG9yKGluc3QsCiAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzKSB7CiAgICAgICAgICAgICAgICBzdXBlcihpbnN0KTsKICAgICAgICAgICAgICAgIHRoaXMuX2ltYWdlT2Zmc2V0WCA9IDA7CiAgICAgICAgICAgICAgICB0aGlzLl9pbWFnZU9mZnNldFkgPSAwOwogICAgICAgICAgICAgICAgdGhpcy5faW1hZ2VTY2FsZVggPSAxOwogICAgICAgICAgICAgICAgdGhpcy5faW1hZ2VTY2FsZVkgPSAxOwogICAgICAgICAgICAgICAgdGhpcy5faW1hZ2VBbmdsZSA9IDA7CiAgICAgICAgICAgICAgICB0aGlzLl9lbmFibGVUaWxlUmFuZG9taXphdGlvbiA9IGZhbHNlOwogICAgICAgICAgICAgICAgdGhpcy5fdGlsZVhSYW5kb20gPSAwOwogICAgICAgICAgICAgICAgdGhpcy5fdGlsZVlSYW5kb20gPSAwOwogICAgICAgICAgICAgICAgdGhpcy5fdGlsZUFuZ2xlUmFuZG9tID0gMDsKICAgICAgICAgICAgICAgIHRoaXMuX3RpbGVCbGVuZE1hcmdpblggPSAwOwogICAgICAgICAgICAgICAgdGhpcy5fdGlsZUJsZW5kTWFyZ2luWSA9IDA7CiAgICAgICAgICAgICAgICB0aGlzLl9vd25JbWFnZUluZm8gPSBudWxsOwogICAgICAgICAgICAgICAgaWYgKHByb3BlcnRpZXMpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLkdldFdvcmxkSW5mbygpLlNldFZpc2libGUoISFwcm9wZXJ0aWVzW0lOSVRJQUxMWV9WSVNJQkxFXSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5faW1hZ2VPZmZzZXRYID0gcHJvcGVydGllc1tJTUFHRV9PRkZTRVRfWF07CiAgICAgICAgICAgICAgICAgICAgdGhpcy5faW1hZ2VPZmZzZXRZID0gcHJvcGVydGllc1tJTUFHRV9PRkZTRVRfWV07CiAgICAgICAgICAgICAgICAgICAgdGhpcy5faW1hZ2VTY2FsZVggPSBwcm9wZXJ0aWVzW0lNQUdFX1NDQUxFX1hdOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2ltYWdlU2NhbGVZID0gcHJvcGVydGllc1tJTUFHRV9TQ0FMRV9ZXTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9pbWFnZUFuZ2xlID0gQzMudG9SYWRpYW5zKHByb3BlcnRpZXNbSU1BR0VfQU5HTEVdKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9lbmFibGVUaWxlUmFuZG9taXphdGlvbiA9ICEhcHJvcGVydGllc1tFTkFCTEVfVElMRV9SQU5ET01JWkFUSU9OXTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl90aWxlWFJhbmRvbSA9IHByb3BlcnRpZXNbVElMRV9YUkFORE9NXTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl90aWxlWVJhbmRvbSA9IHByb3BlcnRpZXNbVElMRV9ZUkFORE9NXTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl90aWxlQW5nbGVSYW5kb20gPSBwcm9wZXJ0aWVzW1RJTEVfQU5HTEVSQU5ET01dOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3RpbGVCbGVuZE1hcmdpblggPSBwcm9wZXJ0aWVzW1RJTEVfQkxFTkRNQVJHSU5YXTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl90aWxlQmxlbmRNYXJnaW5ZID0gcHJvcGVydGllc1tUSUxFX0JMRU5ETUFSR0lOWV0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBSZWxlYXNlKCkgewogICAgICAgICAgICAgICAgdGhpcy5fUmVsZWFzZU93bkltYWdlKCk7CiAgICAgICAgICAgICAgICBzdXBlci5SZWxlYXNlKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBfUmVsZWFzZU93bkltYWdlKCkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuX293bkltYWdlSW5mbykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX293bkltYWdlSW5mby5SZWxlYXNlKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fb3duSW1hZ2VJbmZvID0gbnVsbAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIENhbGN1bGF0ZVRleHR1cmVDb29yZHNGb3IzREZhY2UoYXJlYVdpZHRoLCBhcmVhSGVpZ2h0LCBvdXRRdWFkKSB7CiAgICAgICAgICAgICAgICBjb25zdCBpbWFnZUluZm8gPSB0aGlzLkdldEN1cnJlbnRJbWFnZUluZm8oKTsKICAgICAgICAgICAgICAgIGNvbnN0IGltYWdlV2lkdGggPSBpbWFnZUluZm8uR2V0V2lkdGgoKTsKICAgICAgICAgICAgICAgIGNvbnN0IGltYWdlSGVpZ2h0ID0gaW1hZ2VJbmZvLkdldEhlaWdodCgpOwogICAgICAgICAgICAgICAgY29uc3QgaW1hZ2VPZmZzZXRYID0gdGhpcy5faW1hZ2VPZmZzZXRYIC8gaW1hZ2VXaWR0aDsKICAgICAgICAgICAgICAgIGNvbnN0IGltYWdlT2Zmc2V0WSA9IHRoaXMuX2ltYWdlT2Zmc2V0WSAvIGltYWdlSGVpZ2h0OwogICAgICAgICAgICAgICAgY29uc3QgaW1hZ2VBbmdsZSA9IHRoaXMuX2ltYWdlQW5nbGU7CiAgICAgICAgICAgICAgICByY1RleC5zZXQoMCwgMCwgYXJlYVdpZHRoIC8gKGltYWdlV2lkdGggKiB0aGlzLl9pbWFnZVNjYWxlWCksIGFyZWFIZWlnaHQgLyAoaW1hZ2VIZWlnaHQgKiB0aGlzLl9pbWFnZVNjYWxlWSkpOwogICAgICAgICAgICAgICAgcmNUZXgub2Zmc2V0KC1pbWFnZU9mZnNldFgsIC1pbWFnZU9mZnNldFkpOwogICAgICAgICAgICAgICAgaWYgKGltYWdlQW5nbGUgPT09IDApIG91dFF1YWQuc2V0RnJvbVJlY3QocmNUZXgpOwogICAgICAgICAgICAgICAgZWxzZSBvdXRRdWFkLnNldEZyb21Sb3RhdGVkUmVjdChyY1RleCwgLWltYWdlQW5nbGUpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgU2V0VGlsaW5nU2hhZGVyUHJvZ3JhbShyZW5kZXJlcikgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuX2VuYWJsZVRpbGVSYW5kb21pemF0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgaW1hZ2VJbmZvID0gdGhpcy5HZXRDdXJyZW50SW1hZ2VJbmZvKCk7CiAgICAgICAgICAgICAgICAgICAgcmVuZGVyZXIuU2V0VGlsZVJhbmRvbWl6YXRpb25Nb2RlKCk7CiAgICAgICAgICAgICAgICAgICAgcmVuZGVyZXIuU2V0VGlsZVJhbmRvbWl6YXRpb25JbmZvKGltYWdlSW5mby5HZXRXaWR0aCgpICogdGhpcy5faW1hZ2VTY2FsZVgsIGltYWdlSW5mby5HZXRIZWlnaHQoKSAqIHRoaXMuX2ltYWdlU2NhbGVZLCB0aGlzLl90aWxlWFJhbmRvbSwgdGhpcy5fdGlsZVlSYW5kb20sIHRoaXMuX3RpbGVBbmdsZVJhbmRvbSwgdGhpcy5fdGlsZUJsZW5kTWFyZ2luWCwgdGhpcy5fdGlsZUJsZW5kTWFyZ2luWSkKICAgICAgICAgICAgICAgIH0gZWxzZSByZW5kZXJlci5TZXRUZXh0dXJlRmlsbE1vZGUoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIERyYXcocmVuZGVyZXIpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGltYWdlSW5mbyA9IHRoaXMuR2V0Q3VycmVudEltYWdlSW5mbygpOwogICAgICAgICAgICAgICAgY29uc3QgdGV4dHVyZSA9IGltYWdlSW5mby5HZXRUZXh0dXJlKCk7CiAgICAgICAgICAgICAgICBpZiAodGV4dHVyZSA9PT0gbnVsbCkgcmV0dXJuOwogICAgICAgICAgICAgICAgdGhpcy5TZXRUaWxpbmdTaGFkZXJQcm9ncmFtKHJlbmRlcmVyKTsKICAgICAgICAgICAgICAgIHJlbmRlcmVyLlNldFRleHR1cmUodGV4dHVyZSk7CiAgICAgICAgICAgICAgICBjb25zdCBpbWFnZVdpZHRoID0gaW1hZ2VJbmZvLkdldFdpZHRoKCk7CiAgICAgICAgICAgICAgICBjb25zdCBpbWFnZUhlaWdodCA9IGltYWdlSW5mby5HZXRIZWlnaHQoKTsKICAgICAgICAgICAgICAgIGNvbnN0IGltYWdlT2Zmc2V0WCA9IHRoaXMuX2ltYWdlT2Zmc2V0WCAvIGltYWdlV2lkdGg7CiAgICAgICAgICAgICAgICBjb25zdCBpbWFnZU9mZnNldFkgPSB0aGlzLl9pbWFnZU9mZnNldFkgLyBpbWFnZUhlaWdodDsKICAgICAgICAgICAgICAgIGNvbnN0IHdpID0gdGhpcy5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgICAgIHJjVGV4LnNldCgwLCAwLCB3aS5HZXRXaWR0aCgpIC8gKGltYWdlV2lkdGggKiB0aGlzLl9pbWFnZVNjYWxlWCksIHdpLkdldEhlaWdodCgpIC8gKGltYWdlSGVpZ2h0ICogdGhpcy5faW1hZ2VTY2FsZVkpKTsKICAgICAgICAgICAgICAgIHJjVGV4Lm9mZnNldCgtaW1hZ2VPZmZzZXRYLCAtaW1hZ2VPZmZzZXRZKTsKICAgICAgICAgICAgICAgIGlmICh3aS5IYXNNZXNoKCkpIHRoaXMuX0RyYXdNZXNoKHdpLAogICAgICAgICAgICAgICAgICAgIHJlbmRlcmVyKTsKICAgICAgICAgICAgICAgIGVsc2UgdGhpcy5fRHJhd1N0YW5kYXJkKHdpLCByZW5kZXJlcikKICAgICAgICAgICAgfQogICAgICAgICAgICBfRHJhd1N0YW5kYXJkKHdpLCByZW5kZXJlcikgewogICAgICAgICAgICAgICAgbGV0IHF1YWQgPSB3aS5HZXRCb3VuZGluZ1F1YWQoKTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9ydW50aW1lLklzUGl4ZWxSb3VuZGluZ0VuYWJsZWQoKSkgcXVhZCA9IHdpLlBpeGVsUm91bmRRdWFkKHF1YWQpOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuX2ltYWdlQW5nbGUgPT09IDApIHJlbmRlcmVyLlF1YWQzKHF1YWQsIHJjVGV4KTsKICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIHFUZXguc2V0RnJvbVJvdGF0ZWRSZWN0KHJjVGV4LCAtdGhpcy5faW1hZ2VBbmdsZSk7CiAgICAgICAgICAgICAgICAgICAgcmVuZGVyZXIuUXVhZDQocXVhZCwgcVRleCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBfRHJhd01lc2god2ksIHJlbmRlcmVyKSB7CiAgICAgICAgICAgICAgICBjb25zdCB0cmFuc2Zvcm1lZE1lc2ggPSB3aS5HZXRUcmFuc2Zvcm1lZE1lc2goKTsKICAgICAgICAgICAgICAgIGlmICh3aS5Jc01lc2hDaGFuZ2VkKCkpIHsKICAgICAgICAgICAgICAgICAgICB3aS5DYWxjdWxhdGVCYm94KHRlbXBSZWN0LCB0ZW1wUXVhZCwgZmFsc2UpOwogICAgICAgICAgICAgICAgICAgIGxldCBxdWFkID0gdGVtcFF1YWQ7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX3J1bnRpbWUuSXNQaXhlbFJvdW5kaW5nRW5hYmxlZCgpKSBxdWFkID0KICAgICAgICAgICAgICAgICAgICAgICAgd2kuUGl4ZWxSb3VuZFF1YWQocXVhZCk7CiAgICAgICAgICAgICAgICAgICAgbGV0IHRleENvb3JkcyA9IHJjVGV4OwogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9pbWFnZUFuZ2xlICE9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHFUZXguc2V0RnJvbVJvdGF0ZWRSZWN0KHJjVGV4LCAtdGhpcy5faW1hZ2VBbmdsZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRleENvb3JkcyA9IHFUZXgKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdHJhbnNmb3JtZWRNZXNoLkNhbGN1bGF0ZVRyYW5zZm9ybWVkTWVzaCh3aS5HZXRTb3VyY2VNZXNoKCksIHF1YWQsIHRleENvb3Jkcyk7CiAgICAgICAgICAgICAgICAgICAgd2kuU2V0TWVzaENoYW5nZWQoZmFsc2UpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0cmFuc2Zvcm1lZE1lc2guRHJhdyhyZW5kZXJlcikKICAgICAgICAgICAgfQogICAgICAgICAgICBHZXRDdXJyZW50SW1hZ2VJbmZvKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX293bkltYWdlSW5mbyB8fCB0aGlzLl9vYmplY3RDbGFzcy5HZXRJbWFnZUluZm8oKQogICAgICAgICAgICB9CiAgICAgICAgICAgIElzT3JpZ2luYWxTaXplS25vd24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgICAgICB9CiAgICAgICAgICAgIEdldFRleHR1cmUoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5HZXRDdXJyZW50SW1hZ2VJbmZvKCkuR2V0VGV4dHVyZSgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX1NldE1lc2hDaGFuZ2VkKCkgewogICAgICAgICAgICAgICAgdGhpcy5HZXRXb3JsZEluZm8oKS5TZXRNZXNoQ2hhbmdlZCh0cnVlKQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9TZXRJbWFnZU9mZnNldFgoeCkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuX2ltYWdlT2Zmc2V0WCA9PT0KICAgICAgICAgICAgICAgICAgICB4KSByZXR1cm47CiAgICAgICAgICAgICAgICB0aGlzLl9pbWFnZU9mZnNldFggPSB4OwogICAgICAgICAgICAgICAgdGhpcy5fcnVudGltZS5VcGRhdGVSZW5kZXIoKTsKICAgICAgICAgICAgICAgIHRoaXMuX1NldE1lc2hDaGFuZ2VkKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBfR2V0SW1hZ2VPZmZzZXRYKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2ltYWdlT2Zmc2V0WAogICAgICAgICAgICB9CiAgICAgICAgICAgIF9TZXRJbWFnZU9mZnNldFkoeSkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuX2ltYWdlT2Zmc2V0WSA9PT0geSkgcmV0dXJuOwogICAgICAgICAgICAgICAgdGhpcy5faW1hZ2VPZmZzZXRZID0geTsKICAgICAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuVXBkYXRlUmVuZGVyKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9TZXRNZXNoQ2hhbmdlZCgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX0dldEltYWdlT2Zmc2V0WSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9pbWFnZU9mZnNldFkKICAgICAgICAgICAgfQogICAgICAgICAgICBfU2V0SW1hZ2VTY2FsZVgoeCkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuX2ltYWdlU2NhbGVYID09PSB4KSByZXR1cm47CiAgICAgICAgICAgICAgICB0aGlzLl9pbWFnZVNjYWxlWCA9IHg7CiAgICAgICAgICAgICAgICB0aGlzLl9ydW50aW1lLlVwZGF0ZVJlbmRlcigpOwogICAgICAgICAgICAgICAgdGhpcy5fU2V0TWVzaENoYW5nZWQoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9HZXRJbWFnZVNjYWxlWCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9pbWFnZVNjYWxlWAogICAgICAgICAgICB9CiAgICAgICAgICAgIF9TZXRJbWFnZVNjYWxlWSh5KSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5faW1hZ2VTY2FsZVkgPT09CiAgICAgICAgICAgICAgICAgICAgeSkgcmV0dXJuOwogICAgICAgICAgICAgICAgdGhpcy5faW1hZ2VTY2FsZVkgPSB5OwogICAgICAgICAgICAgICAgdGhpcy5fcnVudGltZS5VcGRhdGVSZW5kZXIoKTsKICAgICAgICAgICAgICAgIHRoaXMuX1NldE1lc2hDaGFuZ2VkKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBfR2V0SW1hZ2VTY2FsZVkoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5faW1hZ2VTY2FsZVkKICAgICAgICAgICAgfQogICAgICAgICAgICBfU2V0SW1hZ2VBbmdsZShhKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5faW1hZ2VBbmdsZSA9PT0gYSkgcmV0dXJuOwogICAgICAgICAgICAgICAgdGhpcy5faW1hZ2VBbmdsZSA9IGE7CiAgICAgICAgICAgICAgICB0aGlzLl9ydW50aW1lLlVwZGF0ZVJlbmRlcigpOwogICAgICAgICAgICAgICAgdGhpcy5fU2V0TWVzaENoYW5nZWQoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9HZXRJbWFnZUFuZ2xlKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2ltYWdlQW5nbGUKICAgICAgICAgICAgfQogICAgICAgICAgICBfU2V0VGlsZVJhbmRvbWl6YXRpb25FbmFibGVkKGUpIHsKICAgICAgICAgICAgICAgIGUgPSAhIWU7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fZW5hYmxlVGlsZVJhbmRvbWl6YXRpb24gPT09IGUpIHJldHVybjsKICAgICAgICAgICAgICAgIHRoaXMuX2VuYWJsZVRpbGVSYW5kb21pemF0aW9uID0gZTsKICAgICAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuVXBkYXRlUmVuZGVyKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBfSXNUaWxlUmFuZG9taXphdGlvbkVuYWJsZWQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZW5hYmxlVGlsZVJhbmRvbWl6YXRpb24KICAgICAgICAgICAgfQogICAgICAgICAgICBfU2V0VGlsZVhSYW5kb20oeCkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuX3RpbGVYUmFuZG9tID09PQogICAgICAgICAgICAgICAgICAgIHgpIHJldHVybjsKICAgICAgICAgICAgICAgIHRoaXMuX3RpbGVYUmFuZG9tID0geDsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9Jc1RpbGVSYW5kb21pemF0aW9uRW5hYmxlZCgpKSB0aGlzLl9ydW50aW1lLlVwZGF0ZVJlbmRlcigpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX0dldFRpbGVYUmFuZG9tKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RpbGVYUmFuZG9tCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX1NldFRpbGVZUmFuZG9tKHkpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl90aWxlWVJhbmRvbSA9PT0geSkgcmV0dXJuOwogICAgICAgICAgICAgICAgdGhpcy5fdGlsZVlSYW5kb20gPSB5OwogICAgICAgICAgICAgICAgaWYgKHRoaXMuX0lzVGlsZVJhbmRvbWl6YXRpb25FbmFibGVkKCkpIHRoaXMuX3J1bnRpbWUuVXBkYXRlUmVuZGVyKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBfR2V0VGlsZVlSYW5kb20oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fdGlsZVlSYW5kb20KICAgICAgICAgICAgfQogICAgICAgICAgICBfU2V0VGlsZUFuZ2xlUmFuZG9tKGEpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl90aWxlQW5nbGVSYW5kb20gPT09IGEpIHJldHVybjsKICAgICAgICAgICAgICAgIHRoaXMuX3RpbGVBbmdsZVJhbmRvbSA9IGE7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fSXNUaWxlUmFuZG9taXphdGlvbkVuYWJsZWQoKSkgdGhpcy5fcnVudGltZS5VcGRhdGVSZW5kZXIoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9HZXRUaWxlQW5nbGVSYW5kb20oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fdGlsZUFuZ2xlUmFuZG9tCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX1NldFRpbGVCbGVuZE1hcmdpblgoeCkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuX3RpbGVCbGVuZE1hcmdpblggPT09CiAgICAgICAgICAgICAgICAgICAgeCkgcmV0dXJuOwogICAgICAgICAgICAgICAgdGhpcy5fdGlsZUJsZW5kTWFyZ2luWCA9IHg7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fSXNUaWxlUmFuZG9taXphdGlvbkVuYWJsZWQoKSkgdGhpcy5fcnVudGltZS5VcGRhdGVSZW5kZXIoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9HZXRUaWxlQmxlbmRNYXJnaW5YKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RpbGVCbGVuZE1hcmdpblgKICAgICAgICAgICAgfQogICAgICAgICAgICBfU2V0VGlsZUJsZW5kTWFyZ2luWSh5KSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fdGlsZUJsZW5kTWFyZ2luWSA9PT0geSkgcmV0dXJuOwogICAgICAgICAgICAgICAgdGhpcy5fdGlsZUJsZW5kTWFyZ2luWSA9IHk7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fSXNUaWxlUmFuZG9taXphdGlvbkVuYWJsZWQoKSkgdGhpcy5fcnVudGltZS5VcGRhdGVSZW5kZXIoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9HZXRUaWxlQmxlbmRNYXJnaW5ZKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RpbGVCbGVuZE1hcmdpblkKICAgICAgICAgICAgfQogICAgICAgICAgICBHZXREZWJ1Z2dlclByb3BlcnRpZXMoKSB7CiAgICAgICAgICAgICAgICBjb25zdCBwcm9wc1ByZWZpeCA9ICJwbHVnaW5zLnRpbGVkYmcucHJvcGVydGllcyI7CiAgICAgICAgICAgICAgICByZXR1cm4gW3sKICAgICAgICAgICAgICAgICAgICB0aXRsZTogcHJvcHNQcmVmaXggKyAiLmltYWdlLXRyYW5zZm9ybS5uYW1lIiwKICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiBbewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBwcm9wc1ByZWZpeCArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiLmltYWdlLW9mZnNldC14Lm5hbWUiLAogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5fR2V0SW1hZ2VPZmZzZXRYKCksCiAgICAgICAgICAgICAgICAgICAgICAgIG9uZWRpdDogdiA9PiB0aGlzLl9TZXRJbWFnZU9mZnNldFgodikKICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHByb3BzUHJlZml4ICsgIi5pbWFnZS1vZmZzZXQteS5uYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuX0dldEltYWdlT2Zmc2V0WSgpLAogICAgICAgICAgICAgICAgICAgICAgICBvbmVkaXQ6IHYgPT4gdGhpcy5fU2V0SW1hZ2VPZmZzZXRZKHYpCiAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBwcm9wc1ByZWZpeCArICIuaW1hZ2Utc2NhbGUteC5uYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuX0dldEltYWdlU2NhbGVYKCkgKiAxMDAsCiAgICAgICAgICAgICAgICAgICAgICAgIG9uZWRpdDogdiA9PiB0aGlzLl9TZXRJbWFnZVNjYWxlWCh2IC8gMTAwKQogICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogcHJvcHNQcmVmaXggKyAiLmltYWdlLXNjYWxlLXkubmFtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLl9HZXRJbWFnZVNjYWxlWSgpICogMTAwLAogICAgICAgICAgICAgICAgICAgICAgICBvbmVkaXQ6IHYgPT4gdGhpcy5fU2V0SW1hZ2VTY2FsZVkodiAvIDEwMCkKICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHByb3BzUHJlZml4ICsgIi5pbWFnZS1hbmdsZS5uYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IEMzLnRvRGVncmVlcyh0aGlzLl9HZXRJbWFnZUFuZ2xlKCkpLAogICAgICAgICAgICAgICAgICAgICAgICBvbmVkaXQ6IHYgPT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX1NldEltYWdlQW5nbGUoQzMudG9SYWRpYW5zKHYpKQogICAgICAgICAgICAgICAgICAgIH1dCiAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHByb3BzUHJlZml4ICsgIi50aWxlLXJhbmRvbWl6YXRpb24ubmFtZSIsCiAgICAgICAgICAgICAgICAgICAgcHJvcGVydGllczogW3sKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogcHJvcHNQcmVmaXggKyAiLmVuYWJsZS10aWxlLXJhbmRvbWl6YXRpb24ubmFtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLl9Jc1RpbGVSYW5kb21pemF0aW9uRW5hYmxlZCgpLAogICAgICAgICAgICAgICAgICAgICAgICBvbmVkaXQ6IHYgPT4gdGhpcy5fU2V0VGlsZVJhbmRvbWl6YXRpb25FbmFibGVkKHYpCiAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBwcm9wc1ByZWZpeCArICIueC1yYW5kb20ubmFtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLl9HZXRUaWxlWFJhbmRvbSgpICogMTAwLAogICAgICAgICAgICAgICAgICAgICAgICBvbmVkaXQ6IHYgPT4gdGhpcy5fU2V0VGlsZVhSYW5kb20odiAvIDEwMCkKICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHByb3BzUHJlZml4ICsgIi55LXJhbmRvbS5uYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuX0dldFRpbGVZUmFuZG9tKCkgKiAxMDAsCiAgICAgICAgICAgICAgICAgICAgICAgIG9uZWRpdDogdiA9PiB0aGlzLl9TZXRUaWxlWVJhbmRvbSh2IC8gMTAwKQogICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogcHJvcHNQcmVmaXggKyAiLmFuZ2xlLXJhbmRvbS5uYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuX0dldFRpbGVBbmdsZVJhbmRvbSgpICoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDEwMCwKICAgICAgICAgICAgICAgICAgICAgICAgb25lZGl0OiB2ID0+IHRoaXMuX1NldFRpbGVBbmdsZVJhbmRvbSh2IC8gMTAwKQogICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogcHJvcHNQcmVmaXggKyAiLmJsZW5kLW1hcmdpbi14Lm5hbWUiLAogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5fR2V0VGlsZUJsZW5kTWFyZ2luWCgpICogMTAwLAogICAgICAgICAgICAgICAgICAgICAgICBvbmVkaXQ6IHYgPT4gdGhpcy5fU2V0VGlsZUJsZW5kTWFyZ2luWCh2IC8gMTAwKQogICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogcHJvcHNQcmVmaXggKyAiLmJsZW5kLW1hcmdpbi15Lm5hbWUiLAogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5fR2V0VGlsZUJsZW5kTWFyZ2luWSgpICogMTAwLAogICAgICAgICAgICAgICAgICAgICAgICBvbmVkaXQ6IHYgPT4gdGhpcy5fU2V0VGlsZUJsZW5kTWFyZ2luWSh2IC8gMTAwKQogICAgICAgICAgICAgICAgICAgIH1dCiAgICAgICAgICAgICAgICB9XQogICAgICAgICAgICB9CiAgICAgICAgICAgIEdldFByb3BlcnR5VmFsdWVCeUluZGV4KGluZGV4KSB7CiAgICAgICAgICAgICAgICBzd2l0Y2ggKGluZGV4KSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBJTUFHRV9PRkZTRVRfWDoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX0dldEltYWdlT2Zmc2V0WCgpOwogICAgICAgICAgICAgICAgICAgIGNhc2UgSU1BR0VfT0ZGU0VUX1k6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9HZXRJbWFnZU9mZnNldFkoKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIElNQUdFX1NDQUxFX1g6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9HZXRJbWFnZVNjYWxlWCgpOwogICAgICAgICAgICAgICAgICAgIGNhc2UgSU1BR0VfU0NBTEVfWToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX0dldEltYWdlU2NhbGVZKCk7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBJTUFHRV9BTkdMRToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX0dldEltYWdlQW5nbGUoKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIEVOQUJMRV9USUxFX1JBTkRPTUlaQVRJT046CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9Jc1RpbGVSYW5kb21pemF0aW9uRW5hYmxlZCgpOwogICAgICAgICAgICAgICAgICAgIGNhc2UgVElMRV9YUkFORE9NOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fR2V0VGlsZVhSYW5kb20oKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIFRJTEVfWVJBTkRPTToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX0dldFRpbGVZUmFuZG9tKCk7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBUSUxFX0FOR0xFUkFORE9NOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fR2V0VGlsZUFuZ2xlUmFuZG9tKCk7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBUSUxFX0JMRU5ETUFSR0lOWDoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX0dldFRpbGVCbGVuZE1hcmdpblgoKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIFRJTEVfQkxFTkRNQVJHSU5ZOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fR2V0VGlsZUJsZW5kTWFyZ2luWSgpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgU2V0UHJvcGVydHlWYWx1ZUJ5SW5kZXgoaW5kZXgsIHZhbHVlKSB7CiAgICAgICAgICAgICAgICBzd2l0Y2ggKGluZGV4KSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBJTUFHRV9PRkZTRVRfWDoKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fU2V0SW1hZ2VPZmZzZXRYKHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBJTUFHRV9PRkZTRVRfWToKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fU2V0SW1hZ2VPZmZzZXRZKHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBJTUFHRV9TQ0FMRV9YOgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9TZXRJbWFnZVNjYWxlWCh2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgSU1BR0VfU0NBTEVfWToKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fU2V0SW1hZ2VTY2FsZVkodmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIElNQUdFX0FOR0xFOgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9TZXRJbWFnZUFuZ2xlKHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBFTkFCTEVfVElMRV9SQU5ET01JWkFUSU9OOgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9TZXRUaWxlUmFuZG9taXphdGlvbkVuYWJsZWQoISF2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgVElMRV9YUkFORE9NOgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9TZXRUaWxlWFJhbmRvbSh2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgVElMRV9ZUkFORE9NOgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9TZXRUaWxlWVJhbmRvbSh2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgVElMRV9BTkdMRVJBTkRPTToKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fU2V0VGlsZUFuZ2xlUmFuZG9tKHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBUSUxFX0JMRU5ETUFSR0lOWDoKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fU2V0VGlsZUJsZW5kTWFyZ2luWCh2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgVElMRV9CTEVORE1BUkdJTlk6CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX1NldFRpbGVCbGVuZE1hcmdpblkodmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIEdldFNjcmlwdEludGVyZmFjZUNsYXNzKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuSVRpbGVkQmFja2dyb3VuZEluc3RhbmNlCiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIGNvbnN0IG1hcCA9IG5ldyBXZWFrTWFwOwogICAgICAgIHNlbGYuSVRpbGVkQmFja2dyb3VuZEluc3RhbmNlID0gY2xhc3MgSVRpbGVkQmFja2dyb3VuZEluc3RhbmNlIGV4dGVuZHMgc2VsZi5JV29ybGRJbnN0YW5jZSB7CiAgICAgICAgICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgICAgICAgICAgc3VwZXIoKTsKICAgICAgICAgICAgICAgIG1hcC5zZXQodGhpcywgc2VsZi5JSW5zdGFuY2UuX0dldEluaXRJbnN0KCkuR2V0U2RrSW5zdGFuY2UoKSkKICAgICAgICAgICAgfQogICAgICAgICAgICBzZXQgaW1hZ2VPZmZzZXRYKHgpIHsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlRmluaXRlTnVtYmVyKHgpOwogICAgICAgICAgICAgICAgbWFwLmdldCh0aGlzKS5fU2V0SW1hZ2VPZmZzZXRYKHgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZ2V0IGltYWdlT2Zmc2V0WCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBtYXAuZ2V0KHRoaXMpLl9HZXRJbWFnZU9mZnNldFgoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHNldCBpbWFnZU9mZnNldFkoeSkgewogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVGaW5pdGVOdW1iZXIoeSk7CiAgICAgICAgICAgICAgICBtYXAuZ2V0KHRoaXMpLl9TZXRJbWFnZU9mZnNldFkoeSkKICAgICAgICAgICAgfQogICAgICAgICAgICBnZXQgaW1hZ2VPZmZzZXRZKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIG1hcC5nZXQodGhpcykuX0dldEltYWdlT2Zmc2V0WSgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2V0SW1hZ2VPZmZzZXQoeCwKICAgICAgICAgICAgICAgIHkpIHsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlRmluaXRlTnVtYmVyKHgpOwogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVGaW5pdGVOdW1iZXIoeSk7CiAgICAgICAgICAgICAgICBjb25zdCBpbnN0ID0gbWFwLmdldCh0aGlzKTsKICAgICAgICAgICAgICAgIGluc3QuX1NldEltYWdlT2Zmc2V0WCh4KTsKICAgICAgICAgICAgICAgIGluc3QuX1NldEltYWdlT2Zmc2V0WSh5KQogICAgICAgICAgICB9CiAgICAgICAgICAgIGdldEltYWdlT2Zmc2V0KCkgewogICAgICAgICAgICAgICAgY29uc3QgaW5zdCA9IG1hcC5nZXQodGhpcyk7CiAgICAgICAgICAgICAgICByZXR1cm4gW2luc3QuX0dldEltYWdlT2Zmc2V0WCgpLCBpbnN0Ll9HZXRJbWFnZU9mZnNldFkoKV0KICAgICAgICAgICAgfQogICAgICAgICAgICBzZXQgaW1hZ2VTY2FsZVgoeCkgewogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVGaW5pdGVOdW1iZXIoeCk7CiAgICAgICAgICAgICAgICBtYXAuZ2V0KHRoaXMpLl9TZXRJbWFnZVNjYWxlWCh4KQogICAgICAgICAgICB9CiAgICAgICAgICAgIGdldCBpbWFnZVNjYWxlWCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBtYXAuZ2V0KHRoaXMpLl9HZXRJbWFnZVNjYWxlWCgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2V0IGltYWdlU2NhbGVZKHkpIHsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlRmluaXRlTnVtYmVyKHkpOwogICAgICAgICAgICAgICAgbWFwLmdldCh0aGlzKS5fU2V0SW1hZ2VTY2FsZVkoeSkKICAgICAgICAgICAgfQogICAgICAgICAgICBnZXQgaW1hZ2VTY2FsZVkoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbWFwLmdldCh0aGlzKS5fR2V0SW1hZ2VTY2FsZVkoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHNldEltYWdlU2NhbGUoeCwKICAgICAgICAgICAgICAgIHkpIHsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlRmluaXRlTnVtYmVyKHgpOwogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVGaW5pdGVOdW1iZXIoeSk7CiAgICAgICAgICAgICAgICBjb25zdCBpbnN0ID0gbWFwLmdldCh0aGlzKTsKICAgICAgICAgICAgICAgIGluc3QuX1NldEltYWdlU2NhbGVYKHgpOwogICAgICAgICAgICAgICAgaW5zdC5fU2V0SW1hZ2VTY2FsZVkoeSkKICAgICAgICAgICAgfQogICAgICAgICAgICBnZXRJbWFnZVNjYWxlKCkgewogICAgICAgICAgICAgICAgY29uc3QgaW5zdCA9IG1hcC5nZXQodGhpcyk7CiAgICAgICAgICAgICAgICByZXR1cm4gW2luc3QuX0dldEltYWdlU2NhbGVYKCksIGluc3QuX0dldEltYWdlU2NhbGVZKCldCiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2V0IGltYWdlQW5nbGUoYSkgewogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVGaW5pdGVOdW1iZXIoYSk7CiAgICAgICAgICAgICAgICBtYXAuZ2V0KHRoaXMpLl9TZXRJbWFnZUFuZ2xlKGEpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZ2V0IGltYWdlQW5nbGUoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbWFwLmdldCh0aGlzKS5fR2V0SW1hZ2VBbmdsZSgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2V0IGltYWdlQW5nbGVEZWdyZWVzKGEpIHsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlRmluaXRlTnVtYmVyKGEpOwogICAgICAgICAgICAgICAgbWFwLmdldCh0aGlzKS5fU2V0SW1hZ2VBbmdsZShDMy50b1JhZGlhbnMoYSkpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZ2V0IGltYWdlQW5nbGVEZWdyZWVzKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIEMzLnRvRGVncmVlcyhtYXAuZ2V0KHRoaXMpLl9HZXRJbWFnZUFuZ2xlKCkpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZ2V0IGltYWdlV2lkdGgoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbWFwLmdldCh0aGlzKS5HZXRDdXJyZW50SW1hZ2VJbmZvKCkuR2V0V2lkdGgoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGdldCBpbWFnZUhlaWdodCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBtYXAuZ2V0KHRoaXMpLkdldEN1cnJlbnRJbWFnZUluZm8oKS5HZXRIZWlnaHQoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGdldEltYWdlU2l6ZSgpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGltYWdlSW5mbyA9CiAgICAgICAgICAgICAgICAgICAgbWFwLmdldCh0aGlzKS5HZXRDdXJyZW50SW1hZ2VJbmZvKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gW2ltYWdlSW5mby5HZXRXaWR0aCgpLCBpbWFnZUluZm8uR2V0SGVpZ2h0KCldCiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2V0IGVuYWJsZVRpbGVSYW5kb21pemF0aW9uKGUpIHsKICAgICAgICAgICAgICAgIG1hcC5nZXQodGhpcykuX1NldFRpbGVSYW5kb21pemF0aW9uRW5hYmxlZCghIWUpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZ2V0IGVuYWJsZVRpbGVSYW5kb21pemF0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIG1hcC5nZXQodGhpcykuX0lzVGlsZVJhbmRvbWl6YXRpb25FbmFibGVkKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBzZXQgdGlsZVhSYW5kb20oeCkgewogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVGaW5pdGVOdW1iZXIoeCk7CiAgICAgICAgICAgICAgICBtYXAuZ2V0KHRoaXMpLl9TZXRUaWxlWFJhbmRvbSh4KQogICAgICAgICAgICB9CiAgICAgICAgICAgIGdldCB0aWxlWFJhbmRvbSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBtYXAuZ2V0KHRoaXMpLl9HZXRUaWxlWFJhbmRvbSgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2V0IHRpbGVZUmFuZG9tKHkpIHsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlRmluaXRlTnVtYmVyKHkpOwogICAgICAgICAgICAgICAgbWFwLmdldCh0aGlzKS5fU2V0VGlsZVlSYW5kb20oeSkKICAgICAgICAgICAgfQogICAgICAgICAgICBnZXQgdGlsZVlSYW5kb20oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbWFwLmdldCh0aGlzKS5fR2V0VGlsZVlSYW5kb20oKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHNldFRpbGVSYW5kb20oeCwKICAgICAgICAgICAgICAgIHkpIHsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlRmluaXRlTnVtYmVyKHgpOwogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVGaW5pdGVOdW1iZXIoeSk7CiAgICAgICAgICAgICAgICBjb25zdCBpbnN0ID0gbWFwLmdldCh0aGlzKTsKICAgICAgICAgICAgICAgIGluc3QuX1NldFRpbGVYUmFuZG9tKHgpOwogICAgICAgICAgICAgICAgaW5zdC5fU2V0VGlsZVlSYW5kb20oeSkKICAgICAgICAgICAgfQogICAgICAgICAgICBnZXRUaWxlUmFuZG9tKCkgewogICAgICAgICAgICAgICAgY29uc3QgaW5zdCA9IG1hcC5nZXQodGhpcyk7CiAgICAgICAgICAgICAgICByZXR1cm4gW2luc3QuX0dldFRpbGVYUmFuZG9tKCksIGluc3QuX0dldFRpbGVZUmFuZG9tKCldCiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2V0IHRpbGVBbmdsZVJhbmRvbShhKSB7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcihhKTsKICAgICAgICAgICAgICAgIG1hcC5nZXQodGhpcykuX1NldFRpbGVBbmdsZVJhbmRvbShhKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGdldCB0aWxlQW5nbGVSYW5kb20oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbWFwLmdldCh0aGlzKS5fR2V0VGlsZUFuZ2xlUmFuZG9tKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBzZXQgdGlsZUJsZW5kTWFyZ2luWCh4KSB7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcih4KTsKICAgICAgICAgICAgICAgIG1hcC5nZXQodGhpcykuX1NldFRpbGVCbGVuZE1hcmdpblgoeCkKICAgICAgICAgICAgfQogICAgICAgICAgICBnZXQgdGlsZUJsZW5kTWFyZ2luWCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBtYXAuZ2V0KHRoaXMpLl9HZXRUaWxlQmxlbmRNYXJnaW5YKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBzZXQgdGlsZUJsZW5kTWFyZ2luWSh5KSB7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcih5KTsKICAgICAgICAgICAgICAgIG1hcC5nZXQodGhpcykuX1NldFRpbGVCbGVuZE1hcmdpblkoeSkKICAgICAgICAgICAgfQogICAgICAgICAgICBnZXQgdGlsZUJsZW5kTWFyZ2luWSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBtYXAuZ2V0KHRoaXMpLl9HZXRUaWxlQmxlbmRNYXJnaW5ZKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBzZXRUaWxlQmxlbmRNYXJnaW4oeCwgeSkgewogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVGaW5pdGVOdW1iZXIoeCk7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcih5KTsKICAgICAgICAgICAgICAgIGNvbnN0IGluc3QgPSBtYXAuZ2V0KHRoaXMpOwogICAgICAgICAgICAgICAgaW5zdC5fU2V0VGlsZUJsZW5kTWFyZ2luWCh4KTsKICAgICAgICAgICAgICAgIGluc3QuX1NldFRpbGVCbGVuZE1hcmdpblkoeSkKICAgICAgICAgICAgfQogICAgICAgICAgICBnZXRUaWxlQmxlbmRNYXJnaW4oKSB7CiAgICAgICAgICAgICAgICBjb25zdCBpbnN0ID0gbWFwLmdldCh0aGlzKTsKICAgICAgICAgICAgICAgIHJldHVybiBbaW5zdC5fR2V0VGlsZUJsZW5kTWFyZ2luWCgpLCBpbnN0Ll9HZXRUaWxlQmxlbmRNYXJnaW5ZKCldCiAgICAgICAgICAgIH0KICAgICAgICAgICAgYXN5bmMgcmVwbGFjZUltYWdlKGJsb2IpIHsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlSW5zdGFuY2VPZihibG9iLCBCbG9iKTsKICAgICAgICAgICAgICAgIGNvbnN0IHNka0luc3QgPSBtYXAuZ2V0KHRoaXMpOwogICAgICAgICAgICAgICAgY29uc3QgcnVudGltZSA9IHNka0luc3QuR2V0UnVudGltZSgpOwogICAgICAgICAgICAgICAgY29uc3QgaW1hZ2VJbmZvID0KICAgICAgICAgICAgICAgICAgICBDMy5OZXcoQzMuSW1hZ2VJbmZvKTsKICAgICAgICAgICAgICAgIGltYWdlSW5mby5Mb2FkRHluYW1pY0Jsb2JBc3NldChydW50aW1lLCBibG9iKTsKICAgICAgICAgICAgICAgIGF3YWl0IGltYWdlSW5mby5Mb2FkU3RhdGljVGV4dHVyZShydW50aW1lLkdldFJlbmRlcmVyKCksIHsKICAgICAgICAgICAgICAgICAgICBzYW1wbGluZzogcnVudGltZS5HZXRTYW1wbGluZygpLAogICAgICAgICAgICAgICAgICAgIHdyYXBYOiAicmVwZWF0IiwKICAgICAgICAgICAgICAgICAgICB3cmFwWTogInJlcGVhdCIKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgaWYgKHNka0luc3QuV2FzUmVsZWFzZWQoKSkgewogICAgICAgICAgICAgICAgICAgIGltYWdlSW5mby5SZWxlYXNlKCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzZGtJbnN0Ll9SZWxlYXNlT3duSW1hZ2UoKTsKICAgICAgICAgICAgICAgIHNka0luc3QuX293bkltYWdlSW5mbyA9IGltYWdlSW5mbzsKICAgICAgICAgICAgICAgIHJ1bnRpbWUuVXBkYXRlUmVuZGVyKCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gewogICAgICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgICAgICBDMy5QbHVnaW5zLlRpbGVkQmcuQ25kcyA9IHsKICAgICAgICAgICAgT25VUkxMb2FkZWQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgICAgICB9LAogICAgICAgICAgICBPblVSTEZhaWxlZCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIElzVGlsZVJhbmRvbWl6YXRpb25FbmFibGVkKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX0lzVGlsZVJhbmRvbWl6YXRpb25FbmFibGVkKCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gewogICAgICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgICAgICBDMy5QbHVnaW5zLlRpbGVkQmcuQWN0cyA9IHsKICAgICAgICAgICAgU2V0SW1hZ2VPZmZzZXRYKHgpIHsKICAgICAgICAgICAgICAgIHRoaXMuX1NldEltYWdlT2Zmc2V0WCh4KQogICAgICAgICAgICB9LAogICAgICAgICAgICBTZXRJbWFnZU9mZnNldFkoeSkgewogICAgICAgICAgICAgICAgdGhpcy5fU2V0SW1hZ2VPZmZzZXRZKHkpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFNldEltYWdlU2NhbGVYKHgpIHsKICAgICAgICAgICAgICAgIHRoaXMuX1NldEltYWdlU2NhbGVYKHggLyAxMDApCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFNldEltYWdlU2NhbGVZKHkpIHsKICAgICAgICAgICAgICAgIHRoaXMuX1NldEltYWdlU2NhbGVZKHkgLyAxMDApCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFNldEltYWdlQW5nbGUoYSkgewogICAgICAgICAgICAgICAgdGhpcy5fU2V0SW1hZ2VBbmdsZShDMy50b1JhZGlhbnMoYSkpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFNldFRpbGVSYW5kb21pemF0aW9uRW5hYmxlZChlKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9TZXRUaWxlUmFuZG9taXphdGlvbkVuYWJsZWQoZSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgU2V0VGlsZVBvc1JhbmRvbSh4LCB5KSB7CiAgICAgICAgICAgICAgICB0aGlzLl9TZXRUaWxlWFJhbmRvbSh4IC8gMTAwKTsKICAgICAgICAgICAgICAgIHRoaXMuX1NldFRpbGVZUmFuZG9tKHkgLyAxMDApCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFNldFRpbGVBbmdsZVJhbmRvbShhKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9TZXRUaWxlQW5nbGVSYW5kb20oYSAvIDEwMCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgU2V0VGlsZUJsZW5kTWFyZ2luKHgsCiAgICAgICAgICAgICAgICB5KSB7CiAgICAgICAgICAgICAgICB0aGlzLl9TZXRUaWxlQmxlbmRNYXJnaW5YKHggLyAxMDApOwogICAgICAgICAgICAgICAgdGhpcy5fU2V0VGlsZUJsZW5kTWFyZ2luWSh5IC8gMTAwKQogICAgICAgICAgICB9LAogICAgICAgICAgICBTZXRFZmZlY3QoZWZmZWN0KSB7CiAgICAgICAgICAgICAgICB0aGlzLkdldFdvcmxkSW5mbygpLlNldEJsZW5kTW9kZShlZmZlY3QpOwogICAgICAgICAgICAgICAgdGhpcy5fcnVudGltZS5VcGRhdGVSZW5kZXIoKQogICAgICAgICAgICB9LAogICAgICAgICAgICBhc3luYyBMb2FkVVJMKHVybCwgY3Jvc3NPcmlnaW4pIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9vd25JbWFnZUluZm8gJiYgdGhpcy5fb3duSW1hZ2VJbmZvLkdldFVSTCgpID09PSB1cmwpIHJldHVybjsKICAgICAgICAgICAgICAgIGNvbnN0IHJ1bnRpbWUgPSB0aGlzLl9ydW50aW1lOwogICAgICAgICAgICAgICAgY29uc3QgaW1hZ2VJbmZvID0gQzMuTmV3KEMzLkltYWdlSW5mbyk7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGF3YWl0IGltYWdlSW5mby5Mb2FkRHluYW1pY0Fzc2V0KHJ1bnRpbWUsIHVybCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFpbWFnZUluZm8uSXNMb2FkZWQoKSkgdGhyb3cgbmV3IEVycm9yKCJpbWFnZSBmYWlsZWQgdG8gbG9hZCIpOwogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLldhc1JlbGVhc2VkKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaW1hZ2VJbmZvLlJlbGVhc2UoKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGwKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdGV4dHVyZSA9CiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IGltYWdlSW5mby5Mb2FkU3RhdGljVGV4dHVyZShydW50aW1lLkdldFJlbmRlcmVyKCksIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhbXBsaW5nOiBydW50aW1lLkdldFNhbXBsaW5nKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3cmFwWDogInJlcGVhdCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3cmFwWTogInJlcGVhdCIKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCF0ZXh0dXJlKSByZXR1cm4KICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkxvYWQgaW1hZ2UgZnJvbSBVUkwgZmFpbGVkOiAiLCBlcnIpOwogICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5XYXNSZWxlYXNlZCgpKSB0aGlzLlRyaWdnZXIoQzMuUGx1Z2lucy5UaWxlZEJnLkNuZHMuT25VUkxGYWlsZWQpOwogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHRoaXMuV2FzUmVsZWFzZWQoKSkgewogICAgICAgICAgICAgICAgICAgIGltYWdlSW5mby5SZWxlYXNlKCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLl9SZWxlYXNlT3duSW1hZ2UoKTsKICAgICAgICAgICAgICAgIHRoaXMuX293bkltYWdlSW5mbyA9IGltYWdlSW5mbzsKICAgICAgICAgICAgICAgIHJ1bnRpbWUuVXBkYXRlUmVuZGVyKCk7CiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLlRyaWdnZXJBc3luYyhDMy5QbHVnaW5zLlRpbGVkQmcuQ25kcy5PblVSTExvYWRlZCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gewogICAgICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgICAgICBDMy5QbHVnaW5zLlRpbGVkQmcuRXhwcyA9IHsKICAgICAgICAgICAgSW1hZ2VXaWR0aCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLkdldEN1cnJlbnRJbWFnZUluZm8oKS5HZXRXaWR0aCgpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIEltYWdlSGVpZ2h0KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuR2V0Q3VycmVudEltYWdlSW5mbygpLkdldEhlaWdodCgpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIEltYWdlT2Zmc2V0WCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9pbWFnZU9mZnNldFgKICAgICAgICAgICAgfSwKICAgICAgICAgICAgSW1hZ2VPZmZzZXRZKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2ltYWdlT2Zmc2V0WQogICAgICAgICAgICB9LAogICAgICAgICAgICBJbWFnZVNjYWxlWCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9pbWFnZVNjYWxlWCAqIDEwMAogICAgICAgICAgICB9LAogICAgICAgICAgICBJbWFnZVNjYWxlWSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9pbWFnZVNjYWxlWSAqIDEwMAogICAgICAgICAgICB9LAogICAgICAgICAgICBJbWFnZUFuZ2xlKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIEMzLnRvRGVncmVlcyh0aGlzLl9pbWFnZUFuZ2xlKQogICAgICAgICAgICB9LAogICAgICAgICAgICBUaWxlWFJhbmRvbSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9HZXRUaWxlWFJhbmRvbSgpICogMTAwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFRpbGVZUmFuZG9tKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX0dldFRpbGVZUmFuZG9tKCkgKiAxMDAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgVGlsZUFuZ2xlUmFuZG9tKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX0dldFRpbGVBbmdsZVJhbmRvbSgpICoKICAgICAgICAgICAgICAgICAgICAxMDAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgVGlsZUJsZW5kTWFyZ2luWCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9HZXRUaWxlQmxlbmRNYXJnaW5YKCkgKiAxMDAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgVGlsZUJsZW5kTWFyZ2luWSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9HZXRUaWxlQmxlbmRNYXJnaW5ZKCkgKiAxMDAKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07Cgp9Cgp7CiAgICAndXNlIHN0cmljdCc7IHsKICAgICAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICAgICAgQzMuUGx1Z2lucy5TcHJpdGUgPSBjbGFzcyBTcHJpdGVQbHVnaW4gZXh0ZW5kcyBDMy5TREtQbHVnaW5CYXNlIHsKICAgICAgICAgICAgY29uc3RydWN0b3Iob3B0cykgewogICAgICAgICAgICAgICAgc3VwZXIob3B0cykKICAgICAgICAgICAgfQogICAgICAgICAgICBSZWxlYXNlKCkgewogICAgICAgICAgICAgICAgc3VwZXIuUmVsZWFzZSgpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IHsKICAgICAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICAgICAgY29uc3Qgc3Bhd25QaWNrU3RhY2sgPSBbXTsKICAgICAgICBDMy5QbHVnaW5zLlNwcml0ZS5UeXBlID0gY2xhc3MgU3ByaXRlVHlwZSBleHRlbmRzIEMzLlNES1R5cGVCYXNlIHsKICAgICAgICAgICAgY29uc3RydWN0b3Iob2JqZWN0Q2xhc3MpIHsKICAgICAgICAgICAgICAgIHN1cGVyKG9iamVjdENsYXNzKTsKICAgICAgICAgICAgICAgIHRoaXMuX2FuaW1hdGlvbnMgPSBvYmplY3RDbGFzcy5HZXRBbmltYXRpb25zKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBSZWxlYXNlKCkgewogICAgICAgICAgICAgICAgQzMuY2xlYXJBcnJheSh0aGlzLl9hbmltYXRpb25zKTsKICAgICAgICAgICAgICAgIHN1cGVyLlJlbGVhc2UoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIE9uQ3JlYXRlKCkgewogICAgICAgICAgICAgICAgZm9yIChjb25zdCBhIG9mIHRoaXMuX2FuaW1hdGlvbnMpIGEuTG9hZEFsbEFzc2V0cyh0aGlzLl9ydW50aW1lKQogICAgICAgICAgICB9CiAgICAgICAgICAgIExvYWRUZXh0dXJlcyhyZW5kZXJlcikgewogICAgICAgICAgICAgICAgY29uc3Qgb3B0cyA9IHsKICAgICAgICAgICAgICAgICAgICBzYW1wbGluZzogdGhpcy5fcnVudGltZS5HZXRTYW1wbGluZygpCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UuYWxsKHRoaXMuX2FuaW1hdGlvbnMubWFwKGEgPT4gYS5Mb2FkQWxsVGV4dHVyZXMocmVuZGVyZXIsIG9wdHMpKSkKICAgICAgICAgICAgfQogICAgICAgICAgICBSZWxlYXNlVGV4dHVyZXMoKSB7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGEgb2YgdGhpcy5fYW5pbWF0aW9ucykgYS5SZWxlYXNlQWxsVGV4dHVyZXMoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIE9uRHluYW1pY1RleHR1cmVMb2FkQ29tcGxldGUoKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9VcGRhdGVBbGxDdXJyZW50VGV4dHVyZSgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX1VwZGF0ZUFsbEN1cnJlbnRUZXh0dXJlKCkgewogICAgICAgICAgICAgICAgZm9yIChjb25zdCBpbnN0IG9mIHRoaXMuX29iamVjdENsYXNzLmluc3RhbmNlc0luY2x1ZGluZ1BlbmRpbmdDcmVhdGUoKSkgaW5zdC5HZXRTZGtJbnN0YW5jZSgpLl9VcGRhdGVDdXJyZW50VGV4dHVyZSgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgRmluaXNoQ29uZGl0aW9uKGRvUGljaykgewogICAgICAgICAgICAgICAgQzMuUGx1Z2lucy5TcHJpdGUuRmluaXNoQ29sbGlzaW9uQ29uZGl0aW9uKHRoaXMsCiAgICAgICAgICAgICAgICAgICAgZG9QaWNrKQogICAgICAgICAgICB9CiAgICAgICAgICAgIEJlZm9yZVJ1bkFjdGlvbihtZXRob2QpIHsKICAgICAgICAgICAgICAgIHNwYXduUGlja1N0YWNrLnB1c2goewogICAgICAgICAgICAgICAgICAgIG9iamVjdENsYXNzOiBudWxsLAogICAgICAgICAgICAgICAgICAgIGNyZWF0ZUhpZXJhcmNoeTogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgaW5zdGFuY2VzOiBbXQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfQogICAgICAgICAgICBfU3Bhd25QaWNrSW5zdGFuY2Uob2JqZWN0Q2xhc3MsIGluc3QsIGNyZWF0ZUhpZXJhcmNoeSkgewogICAgICAgICAgICAgICAgY29uc3QgZW50cnkgPSBzcGF3blBpY2tTdGFjay5hdCgtMSk7CiAgICAgICAgICAgICAgICBlbnRyeS5vYmplY3RDbGFzcyA9IG9iamVjdENsYXNzOwogICAgICAgICAgICAgICAgZW50cnkuY3JlYXRlSGllcmFyY2h5ID0gY3JlYXRlSGllcmFyY2h5OwogICAgICAgICAgICAgICAgZW50cnkuaW5zdGFuY2VzLnB1c2goaW5zdCkKICAgICAgICAgICAgfQogICAgICAgICAgICBBZnRlclJ1bkFjdGlvbihtZXRob2QpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGVudHJ5ID0gc3Bhd25QaWNrU3RhY2sucG9wKCk7CiAgICAgICAgICAgICAgICBjb25zdCBvYmplY3RDbGFzcyA9IGVudHJ5Lm9iamVjdENsYXNzOwogICAgICAgICAgICAgICAgY29uc3QgY3JlYXRlSGllcmFyY2h5ID0gZW50cnkuY3JlYXRlSGllcmFyY2h5OwogICAgICAgICAgICAgICAgaWYgKCFvYmplY3RDbGFzcykgcmV0dXJuOwogICAgICAgICAgICAgICAgY29uc3QgcGlja01hcCA9IG5ldyBNYXA7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGluc3Qgb2YgZW50cnkuaW5zdGFuY2VzKSBpbnN0LkNvbGxlY3RJbnN0YW5jZXNUb1BpY2socGlja01hcCwKICAgICAgICAgICAgICAgICAgICBvYmplY3RDbGFzcywgY3JlYXRlSGllcmFyY2h5KTsKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgW3BpY2tPYmplY3RDbGFzcywgaW5zdFNldF0gb2YgcGlja01hcCkgcGlja09iamVjdENsYXNzLkdldEN1cnJlbnRTb2woKS5TZXRTZXRQaWNrZWQoaW5zdFNldCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gewogICAgICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgICAgICBjb25zdCBDM1ggPSBzZWxmLkMzWDsKICAgICAgICBjb25zdCBJTklUSUFMTFlfVklTSUJMRSA9IDA7CiAgICAgICAgY29uc3QgSU5JVElBTF9BTklNQVRJT04gPSAxOwogICAgICAgIGNvbnN0IElOSVRJQUxfRlJBTUUgPSAyOwogICAgICAgIGNvbnN0IEVOQUJMRV9DT0xMSVNJT05TID0gMzsKICAgICAgICBjb25zdCB0ZW1wUmVjdCA9IEMzLk5ldyhDMy5SZWN0KTsKICAgICAgICBjb25zdCB0ZW1wUXVhZCA9IEMzLk5ldyhDMy5RdWFkKTsKICAgICAgICBjb25zdCB0ZW1wVmVjMiA9IEMzLk5ldyhDMy5WZWN0b3IyKTsKICAgICAgICBjb25zdCBGTEFHX1BMQVlJTkdfRk9SV0FSRFMgPSAxIDw8IDA7CiAgICAgICAgY29uc3QgRkxBR19BTklNQVRJT05fUExBWUlORyA9IDEgPDwgMTsKICAgICAgICBjb25zdCBGTEFHX0FOSU1BVElPTl9UUklHR0VSID0gMSA8PCAyOwogICAgICAgIEMzLlBsdWdpbnMuU3ByaXRlLkluc3RhbmNlID0gY2xhc3MgU3ByaXRlSW5zdGFuY2UgZXh0ZW5kcyBDMy5TREtXb3JsZEluc3RhbmNlQmFzZSB7CiAgICAgICAgICAgIGNvbnN0cnVjdG9yKGluc3QsIHByb3BlcnRpZXMpIHsKICAgICAgICAgICAgICAgIHN1cGVyKGluc3QpOwogICAgICAgICAgICAgICAgbGV0IGluaXRpYWxseVZpc2libGUgPSB0cnVlOwogICAgICAgICAgICAgICAgbGV0IGluaXRpYWxBbmltYXRpb24gPQogICAgICAgICAgICAgICAgICAgICIiOwogICAgICAgICAgICAgICAgbGV0IGluaXRpYWxGcmFtZSA9IDA7CiAgICAgICAgICAgICAgICBsZXQgY29sbGlzaW9uRW5hYmxlZCA9IHRydWU7CiAgICAgICAgICAgICAgICBpZiAocHJvcGVydGllcykgewogICAgICAgICAgICAgICAgICAgIGluaXRpYWxseVZpc2libGUgPSAhIXByb3BlcnRpZXNbSU5JVElBTExZX1ZJU0lCTEVdOwogICAgICAgICAgICAgICAgICAgIGluaXRpYWxBbmltYXRpb24gPSBwcm9wZXJ0aWVzW0lOSVRJQUxfQU5JTUFUSU9OXTsKICAgICAgICAgICAgICAgICAgICBpbml0aWFsRnJhbWUgPSBwcm9wZXJ0aWVzW0lOSVRJQUxfRlJBTUVdOwogICAgICAgICAgICAgICAgICAgIGNvbGxpc2lvbkVuYWJsZWQgPSBwcm9wZXJ0aWVzW0VOQUJMRV9DT0xMSVNJT05TXQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudEFuaW1hdGlvbiA9IHRoaXMuX29iamVjdENsYXNzLkdldEFuaW1hdGlvbkJ5TmFtZShpbml0aWFsQW5pbWF0aW9uKSB8fCB0aGlzLl9vYmplY3RDbGFzcy5HZXRBbmltYXRpb25zKClbMF07CiAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50RnJhbWVJbmRleCA9IEMzLmNsYW1wKGluaXRpYWxGcmFtZSwgMCwgdGhpcy5fY3VycmVudEFuaW1hdGlvbi5HZXRGcmFtZUNvdW50KCkgLSAxKTsKICAgICAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRBbmltYXRpb25GcmFtZSA9IHRoaXMuX2N1cnJlbnRBbmltYXRpb24uR2V0RnJhbWVBdCh0aGlzLl9jdXJyZW50RnJhbWVJbmRleCk7CiAgICAgICAgICAgICAgICBjb25zdCBpbml0aWFsSW1hZ2VJbmZvID0gdGhpcy5fY3VycmVudEFuaW1hdGlvbkZyYW1lLkdldEltYWdlSW5mbygpOwogICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudFRleHR1cmUgPSBpbml0aWFsSW1hZ2VJbmZvLkdldFRleHR1cmUoKTsKICAgICAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRSY1RleCA9IGluaXRpYWxJbWFnZUluZm8uR2V0VGV4UmVjdCgpOwogICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudFF1YWRUZXggPSBpbml0aWFsSW1hZ2VJbmZvLkdldFRleFF1YWQoKTsKICAgICAgICAgICAgICAgIHRoaXMuSGFuZGxlUmVuZGVyZXJDb250ZXh0TG9zcygpOwogICAgICAgICAgICAgICAgaW5zdC5TZXRGbGFnKEZMQUdfQU5JTUFUSU9OX1BMQVlJTkcsIHRydWUpOwogICAgICAgICAgICAgICAgaW5zdC5TZXRGbGFnKEZMQUdfUExBWUlOR19GT1JXQVJEUywgdGhpcy5fY3VycmVudEFuaW1hdGlvbi5HZXRTcGVlZCgpID49IDApOwogICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudEFuaW1hdGlvblNwZWVkID0gTWF0aC5hYnModGhpcy5fY3VycmVudEFuaW1hdGlvbi5HZXRTcGVlZCgpKTsKICAgICAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRBbmltYXRpb25SZXBlYXRUbyA9IHRoaXMuX2N1cnJlbnRBbmltYXRpb24uR2V0UmVwZWF0VG8oKTsKICAgICAgICAgICAgICAgIHRoaXMuX2FuaW1hdGlvblRpbWVyID0gQzMuTmV3KEMzLkthaGFuU3VtKTsKICAgICAgICAgICAgICAgIHRoaXMuX2ZyYW1lU3RhcnRUaW1lID0gMDsKICAgICAgICAgICAgICAgIHRoaXMuX2FuaW1hdGlvblJlcGVhdHMgPSAwOwogICAgICAgICAgICAgICAgdGhpcy5fYW5pbVRyaWdnZXJOYW1lID0gIiI7CiAgICAgICAgICAgICAgICB0aGlzLl9jaGFuZ2VBbmltRnJhbWVJbmRleCA9IC0xOwogICAgICAgICAgICAgICAgdGhpcy5fY2hhbmdlQW5pbWF0aW9uTmFtZSA9ICIiOwogICAgICAgICAgICAgICAgdGhpcy5fY2hhbmdlQW5pbWF0aW9uRnJvbSA9IDA7CiAgICAgICAgICAgICAgICBjb25zdCB3aSA9IHRoaXMuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9icXVhZFJlZiA9IHdpLkdldEJvdW5kaW5nUXVhZCgpOwogICAgICAgICAgICAgICAgd2kuU2V0VmlzaWJsZShpbml0aWFsbHlWaXNpYmxlKTsKICAgICAgICAgICAgICAgIHdpLlNldENvbGxpc2lvbkVuYWJsZWQoY29sbGlzaW9uRW5hYmxlZCk7CiAgICAgICAgICAgICAgICB3aS5TZXRPcmlnaW5YKHRoaXMuX2N1cnJlbnRBbmltYXRpb25GcmFtZS5HZXRPcmlnaW5YKCkpOwogICAgICAgICAgICAgICAgd2kuU2V0T3JpZ2luWSh0aGlzLl9jdXJyZW50QW5pbWF0aW9uRnJhbWUuR2V0T3JpZ2luWSgpKTsKICAgICAgICAgICAgICAgIHdpLlNldFNvdXJjZUNvbGxpc2lvblBvbHkodGhpcy5fY3VycmVudEFuaW1hdGlvbkZyYW1lLkdldENvbGxpc2lvblBvbHkoKSk7CiAgICAgICAgICAgICAgICB3aS5TZXRCYm94Q2hhbmdlZCgpOwogICAgICAgICAgICAgICAgaWYgKCh0aGlzLl9vYmplY3RDbGFzcy5HZXRBbmltYXRpb25Db3VudCgpICE9PSAxIHx8IHRoaXMuX29iamVjdENsYXNzLkdldEFuaW1hdGlvbnMoKVswXS5HZXRGcmFtZUNvdW50KCkgIT09IDEpICYmIHRoaXMuX2N1cnJlbnRBbmltYXRpb25TcGVlZCAhPT0gMCkgdGhpcy5fU3RhcnRUaWNraW5nKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBSZWxlYXNlKCkgewogICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudEFuaW1hdGlvbiA9IG51bGw7CiAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50QW5pbWF0aW9uRnJhbWUgPSBudWxsOwogICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudFRleHR1cmUgPSBudWxsOwogICAgICAgICAgICAgICAgdGhpcy5fYW5pbWF0aW9uVGltZXIgPSBudWxsOwogICAgICAgICAgICAgICAgc3VwZXIuUmVsZWFzZSgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgR2V0Q3VycmVudEltYWdlSW5mbygpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9jdXJyZW50QW5pbWF0aW9uRnJhbWUuR2V0SW1hZ2VJbmZvKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBJc09yaWdpbmFsU2l6ZUtub3duKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICAgICAgfQogICAgICAgICAgICBPblJlbmRlcmVyQ29udGV4dExvc3QoKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50VGV4dHVyZSA9IG51bGwKICAgICAgICAgICAgfQogICAgICAgICAgICBPblJlbmRlcmVyQ29udGV4dFJlc3RvcmVkKCkgewogICAgICAgICAgICAgICAgdGhpcy5fVXBkYXRlQ3VycmVudFRleHR1cmUoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIERyYXcocmVuZGVyZXIpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHRleHR1cmUgPQogICAgICAgICAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRUZXh0dXJlOwogICAgICAgICAgICAgICAgaWYgKHRleHR1cmUgPT09IG51bGwpIHJldHVybjsKICAgICAgICAgICAgICAgIHJlbmRlcmVyLlNldFRleHR1cmUodGV4dHVyZSk7CiAgICAgICAgICAgICAgICBjb25zdCB3aSA9IHRoaXMuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgICAgICBpZiAod2kuSGFzTWVzaCgpKSB0aGlzLl9EcmF3TWVzaCh3aSwgcmVuZGVyZXIpOwogICAgICAgICAgICAgICAgZWxzZSB0aGlzLl9EcmF3U3RhbmRhcmQod2ksIHJlbmRlcmVyKQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9EcmF3U3RhbmRhcmQod2ksIHJlbmRlcmVyKSB7CiAgICAgICAgICAgICAgICBsZXQgcXVhZCA9IHRoaXMuX2JxdWFkUmVmOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuX3J1bnRpbWUuSXNQaXhlbFJvdW5kaW5nRW5hYmxlZCgpKSBxdWFkID0gd2kuUGl4ZWxSb3VuZFF1YWQocXVhZCk7CiAgICAgICAgICAgICAgICByZW5kZXJlci5RdWFkNChxdWFkLCB0aGlzLl9jdXJyZW50UXVhZFRleCkKICAgICAgICAgICAgfQogICAgICAgICAgICBfRHJhd01lc2god2ksIHJlbmRlcmVyKSB7CiAgICAgICAgICAgICAgICBjb25zdCB0cmFuc2Zvcm1lZE1lc2ggPSB3aS5HZXRUcmFuc2Zvcm1lZE1lc2goKTsKICAgICAgICAgICAgICAgIGlmICh3aS5Jc01lc2hDaGFuZ2VkKCkpIHsKICAgICAgICAgICAgICAgICAgICB3aS5DYWxjdWxhdGVCYm94KHRlbXBSZWN0LCB0ZW1wUXVhZCwgZmFsc2UpOwogICAgICAgICAgICAgICAgICAgIGxldCBxdWFkID0gdGVtcFF1YWQ7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX3J1bnRpbWUuSXNQaXhlbFJvdW5kaW5nRW5hYmxlZCgpKSBxdWFkID0gd2kuUGl4ZWxSb3VuZFF1YWQocXVhZCk7CiAgICAgICAgICAgICAgICAgICAgdHJhbnNmb3JtZWRNZXNoLkNhbGN1bGF0ZVRyYW5zZm9ybWVkTWVzaCh3aS5HZXRTb3VyY2VNZXNoKCksIHF1YWQsIHRoaXMuX2N1cnJlbnRRdWFkVGV4KTsKICAgICAgICAgICAgICAgICAgICB3aS5TZXRNZXNoQ2hhbmdlZChmYWxzZSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRyYW5zZm9ybWVkTWVzaC5EcmF3KHJlbmRlcmVyKQogICAgICAgICAgICB9CiAgICAgICAgICAgIEdldEFuaW1hdGlvblRpbWUoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fYW5pbWF0aW9uVGltZXIuR2V0KCkKICAgICAgICAgICAgfQogICAgICAgICAgICBJc0FuaW1hdGlvblBsYXlpbmcoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5faW5zdC5HZXRGbGFnKEZMQUdfQU5JTUFUSU9OX1BMQVlJTkcpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgU2V0QW5pbWF0aW9uUGxheWluZyhlKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9pbnN0LlNldEZsYWcoRkxBR19BTklNQVRJT05fUExBWUlORywgZSkKICAgICAgICAgICAgfQogICAgICAgICAgICBJc1BsYXlpbmdGb3J3YXJkcygpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9pbnN0LkdldEZsYWcoRkxBR19QTEFZSU5HX0ZPUldBUkRTKQogICAgICAgICAgICB9CiAgICAgICAgICAgIFNldFBsYXlpbmdGb3J3YXJkcyhlKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9pbnN0LlNldEZsYWcoRkxBR19QTEFZSU5HX0ZPUldBUkRTLAogICAgICAgICAgICAgICAgICAgIGUpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgSXNJbkFuaW1hdGlvblRyaWdnZXIoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5faW5zdC5HZXRGbGFnKEZMQUdfQU5JTUFUSU9OX1RSSUdHRVIpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgU2V0SW5BbmltYXRpb25UcmlnZ2VyKGUpIHsKICAgICAgICAgICAgICAgIHRoaXMuX2luc3QuU2V0RmxhZyhGTEFHX0FOSU1BVElPTl9UUklHR0VSLCBlKQogICAgICAgICAgICB9CiAgICAgICAgICAgIFRpY2soKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fY2hhbmdlQW5pbWF0aW9uTmFtZSkgdGhpcy5fRG9DaGFuZ2VBbmltYXRpb24oKTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9jaGFuZ2VBbmltRnJhbWVJbmRleCA+PSAwKSB0aGlzLl9Eb0NoYW5nZUFuaW1GcmFtZSgpOwogICAgICAgICAgICAgICAgY29uc3QgY3VycmVudEFuaW1hdGlvblNwZWVkID0gdGhpcy5fY3VycmVudEFuaW1hdGlvblNwZWVkOwogICAgICAgICAgICAgICAgaWYgKCF0aGlzLklzQW5pbWF0aW9uUGxheWluZygpIHx8IGN1cnJlbnRBbmltYXRpb25TcGVlZCA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX1N0b3BUaWNraW5nKCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjb25zdCBkdCA9IHRoaXMuX3J1bnRpbWUuR2V0RHQodGhpcy5faW5zdCk7CiAgICAgICAgICAgICAgICB0aGlzLl9hbmltYXRpb25UaW1lci5BZGQoZHQpOwogICAgICAgICAgICAgICAgY29uc3Qgbm93ID0gdGhpcy5HZXRBbmltYXRpb25UaW1lKCk7CiAgICAgICAgICAgICAgICBjb25zdCBwcmV2RnJhbWUgPSB0aGlzLl9jdXJyZW50QW5pbWF0aW9uRnJhbWU7CiAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50RnJhbWVUaW1lID0gcHJldkZyYW1lLkdldER1cmF0aW9uKCkgLyBjdXJyZW50QW5pbWF0aW9uU3BlZWQ7CiAgICAgICAgICAgICAgICBpZiAobm93IDwgdGhpcy5fZnJhbWVTdGFydFRpbWUgKyBjdXJyZW50RnJhbWVUaW1lKSByZXR1cm47CiAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50QW5pbWF0aW9uID0gdGhpcy5fY3VycmVudEFuaW1hdGlvbjsKICAgICAgICAgICAgICAgIGNvbnN0IHJlcGVhdFRvID0gdGhpcy5fY3VycmVudEFuaW1hdGlvblJlcGVhdFRvOwogICAgICAgICAgICAgICAgY29uc3QgZnJhbWVDb3VudCA9IGN1cnJlbnRBbmltYXRpb24uR2V0RnJhbWVDb3VudCgpOwogICAgICAgICAgICAgICAgY29uc3QgcmVwZWF0Q291bnQgPSBjdXJyZW50QW5pbWF0aW9uLkdldFJlcGVhdENvdW50KCk7CiAgICAgICAgICAgICAgICBjb25zdCBpc0xvb3BpbmcgPSBjdXJyZW50QW5pbWF0aW9uLklzTG9vcGluZygpOwogICAgICAgICAgICAgICAgY29uc3QgaXNQaW5nUG9uZyA9IGN1cnJlbnRBbmltYXRpb24uSXNQaW5nUG9uZygpOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuSXNQbGF5aW5nRm9yd2FyZHMoKSkgdGhpcy5fY3VycmVudEZyYW1lSW5kZXgrKzsKICAgICAgICAgICAgICAgIGVsc2UgdGhpcy5fY3VycmVudEZyYW1lSW5kZXgtLTsKICAgICAgICAgICAgICAgIHRoaXMuX2ZyYW1lU3RhcnRUaW1lICs9IGN1cnJlbnRGcmFtZVRpbWU7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fY3VycmVudEZyYW1lSW5kZXggPj0gZnJhbWVDb3VudCkKICAgICAgICAgICAgICAgICAgICBpZiAoaXNQaW5nUG9uZykgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLlNldFBsYXlpbmdGb3J3YXJkcyhmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRGcmFtZUluZGV4ID0gZnJhbWVDb3VudCAtIDIKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGlzTG9vcGluZykgdGhpcy5fY3VycmVudEZyYW1lSW5kZXggPSByZXBlYXRUbzsKICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX2FuaW1hdGlvblJlcGVhdHMrKzsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fYW5pbWF0aW9uUmVwZWF0cyA+PSByZXBlYXRDb3VudCkgdGhpcy5fRmluaXNoQW5pbWF0aW9uKGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICBlbHNlIHRoaXMuX2N1cnJlbnRGcmFtZUluZGV4ID0gcmVwZWF0VG8KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh0aGlzLl9jdXJyZW50RnJhbWVJbmRleCA8IDApCiAgICAgICAgICAgICAgICAgICAgaWYgKGlzUGluZ1BvbmcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudEZyYW1lSW5kZXggPSAxOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLlNldFBsYXlpbmdGb3J3YXJkcyh0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFpc0xvb3BpbmcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2FuaW1hdGlvblJlcGVhdHMrKzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9hbmltYXRpb25SZXBlYXRzID49IHJlcGVhdENvdW50KSB0aGlzLl9GaW5pc2hBbmltYXRpb24odHJ1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNMb29waW5nKSB0aGlzLl9jdXJyZW50RnJhbWVJbmRleCA9IHJlcGVhdFRvOwogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYW5pbWF0aW9uUmVwZWF0cysrOwogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9hbmltYXRpb25SZXBlYXRzID49IHJlcGVhdENvdW50KSB0aGlzLl9GaW5pc2hBbmltYXRpb24odHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgZWxzZSB0aGlzLl9jdXJyZW50RnJhbWVJbmRleCA9IHJlcGVhdFRvCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50RnJhbWVJbmRleCA9IEMzLmNsYW1wKHRoaXMuX2N1cnJlbnRGcmFtZUluZGV4LCAwLCBmcmFtZUNvdW50IC0gMSk7CiAgICAgICAgICAgICAgICBjb25zdCBuZXh0RnJhbWUgPSBjdXJyZW50QW5pbWF0aW9uLkdldEZyYW1lQXQodGhpcy5fY3VycmVudEZyYW1lSW5kZXgpOwogICAgICAgICAgICAgICAgaWYgKG5vdyA+IHRoaXMuX2ZyYW1lU3RhcnRUaW1lICsgbmV4dEZyYW1lLkdldER1cmF0aW9uKCkgLyBjdXJyZW50QW5pbWF0aW9uU3BlZWQpIHRoaXMuX2ZyYW1lU3RhcnRUaW1lID0gbm93OwogICAgICAgICAgICAgICAgdGhpcy5fT25GcmFtZUNoYW5nZWQocHJldkZyYW1lLAogICAgICAgICAgICAgICAgICAgIG5leHRGcmFtZSkKICAgICAgICAgICAgfQogICAgICAgICAgICBfRmluaXNoQW5pbWF0aW9uKHJldmVyc2UpIHsKICAgICAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRGcmFtZUluZGV4ID0gcmV2ZXJzZSA/IDAgOiB0aGlzLl9jdXJyZW50QW5pbWF0aW9uLkdldEZyYW1lQ291bnQoKSAtIDE7CiAgICAgICAgICAgICAgICB0aGlzLlNldEFuaW1hdGlvblBsYXlpbmcoZmFsc2UpOwogICAgICAgICAgICAgICAgdGhpcy5fYW5pbVRyaWdnZXJOYW1lID0gdGhpcy5fY3VycmVudEFuaW1hdGlvbi5HZXROYW1lKCk7CiAgICAgICAgICAgICAgICB0aGlzLlNldEluQW5pbWF0aW9uVHJpZ2dlcih0cnVlKTsKICAgICAgICAgICAgICAgIHRoaXMuRGlzcGF0Y2hTY3JpcHRFdmVudCgiYW5pbWF0aW9uZW5kIiwgZmFsc2UsIHsKICAgICAgICAgICAgICAgICAgICBhbmltYXRpb25OYW1lOiB0aGlzLl9hbmltVHJpZ2dlck5hbWUKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKEMzLlBsdWdpbnMuU3ByaXRlLkNuZHMuT25BbnlBbmltRmluaXNoZWQpOwogICAgICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKEMzLlBsdWdpbnMuU3ByaXRlLkNuZHMuT25BbmltRmluaXNoZWQpOwogICAgICAgICAgICAgICAgdGhpcy5TZXRJbkFuaW1hdGlvblRyaWdnZXIoZmFsc2UpOwogICAgICAgICAgICAgICAgdGhpcy5fYW5pbWF0aW9uUmVwZWF0cyA9IDAKICAgICAgICAgICAgfQogICAgICAgICAgICBfT25GcmFtZUNoYW5nZWQocHJldkZyYW1lLAogICAgICAgICAgICAgICAgbmV4dEZyYW1lLCBvcHRzKSB7CiAgICAgICAgICAgICAgICBpZiAocHJldkZyYW1lID09PSBuZXh0RnJhbWUpIHJldHVybjsKICAgICAgICAgICAgICAgIGNvbnN0IHdpID0gdGhpcy5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgICAgIGNvbnN0IHByZXZJbWFnZSA9IHByZXZGcmFtZS5HZXRJbWFnZUluZm8oKTsKICAgICAgICAgICAgICAgIGNvbnN0IG5leHRJbWFnZSA9IG5leHRGcmFtZS5HZXRJbWFnZUluZm8oKTsKICAgICAgICAgICAgICAgIGNvbnN0IG9sZFcgPSBwcmV2SW1hZ2UuR2V0V2lkdGgoKTsKICAgICAgICAgICAgICAgIGNvbnN0IG9sZEggPSBwcmV2SW1hZ2UuR2V0SGVpZ2h0KCk7CiAgICAgICAgICAgICAgICBjb25zdCBuZXdXID0gbmV4dEltYWdlLkdldFdpZHRoKCk7CiAgICAgICAgICAgICAgICBjb25zdCBuZXdIID0gbmV4dEltYWdlLkdldEhlaWdodCgpOwogICAgICAgICAgICAgICAgaWYgKG9wdHMgJiYgb3B0cy5vbkZyYW1lQ2hhbmdlKSBvcHRzLm9uRnJhbWVDaGFuZ2Uod2ksIG9sZFcsIG9sZEgsIG5ld1csIG5ld0gpOwogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKG9sZFcgIT09IG5ld1cpIHdpLlNldFdpZHRoKHdpLkdldFdpZHRoKCkgKiAobmV3VyAvIG9sZFcpKTsKICAgICAgICAgICAgICAgICAgICBpZiAob2xkSCAhPT0gbmV3SCkgd2kuU2V0SGVpZ2h0KHdpLkdldEhlaWdodCgpICogKG5ld0ggLyBvbGRIKSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHdpLlNldE9yaWdpblgobmV4dEZyYW1lLkdldE9yaWdpblgoKSk7CiAgICAgICAgICAgICAgICB3aS5TZXRPcmlnaW5ZKG5leHRGcmFtZS5HZXRPcmlnaW5ZKCkpOwogICAgICAgICAgICAgICAgd2kuU2V0U291cmNlQ29sbGlzaW9uUG9seShuZXh0RnJhbWUuR2V0Q29sbGlzaW9uUG9seSgpKTsKICAgICAgICAgICAgICAgIHdpLlNldEJib3hDaGFuZ2VkKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50QW5pbWF0aW9uRnJhbWUgPSBuZXh0RnJhbWU7CiAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50VGV4dHVyZSA9IG5leHRJbWFnZS5HZXRUZXh0dXJlKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50UmNUZXggPSBuZXh0SW1hZ2UuR2V0VGV4UmVjdCgpOwogICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudFF1YWRUZXggPSBuZXh0SW1hZ2UuR2V0VGV4UXVhZCgpOwogICAgICAgICAgICAgICAgY29uc3QgYmVoYXZpb3JJbnN0YW5jZXMgPSB0aGlzLkdldEluc3RhbmNlKCkuR2V0QmVoYXZpb3JJbnN0YW5jZXMoKTsKICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBiZWhhdmlvckluc3RhbmNlcy5sZW5ndGg7IGkgPCBsZW47ICsraSkgYmVoYXZpb3JJbnN0YW5jZXNbaV0uT25TcHJpdGVGcmFtZUNoYW5nZWQocHJldkZyYW1lLCBuZXh0RnJhbWUpOwogICAgICAgICAgICAgICAgdGhpcy5EaXNwYXRjaFNjcmlwdEV2ZW50KCJmcmFtZWNoYW5nZSIsCiAgICAgICAgICAgICAgICAgICAgZmFsc2UsIHsKICAgICAgICAgICAgICAgICAgICAgICAgYW5pbWF0aW9uTmFtZTogdGhpcy5fY3VycmVudEFuaW1hdGlvbi5HZXROYW1lKCksCiAgICAgICAgICAgICAgICAgICAgICAgIGFuaW1hdGlvbkZyYW1lOiB0aGlzLl9jdXJyZW50RnJhbWVJbmRleAogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKEMzLlBsdWdpbnMuU3ByaXRlLkNuZHMuT25GcmFtZUNoYW5nZWQpOwogICAgICAgICAgICAgICAgdGhpcy5fcnVudGltZS5VcGRhdGVSZW5kZXIoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9TdGFydEFuaW0oZnJvbSkgewogICAgICAgICAgICAgICAgdGhpcy5TZXRBbmltYXRpb25QbGF5aW5nKHRydWUpOwogICAgICAgICAgICAgICAgdGhpcy5fZnJhbWVTdGFydFRpbWUgPSB0aGlzLkdldEFuaW1hdGlvblRpbWUoKTsKICAgICAgICAgICAgICAgIGlmIChmcm9tID09PSAxICYmIHRoaXMuX2N1cnJlbnRGcmFtZUluZGV4ICE9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY2hhbmdlQW5pbUZyYW1lSW5kZXggPSAwOwogICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5Jc0luQW5pbWF0aW9uVHJpZ2dlcigpKSB0aGlzLl9Eb0NoYW5nZUFuaW1GcmFtZSgpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLl9TdGFydFRpY2tpbmcoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9TZXRBbmltKGFuaW1OYW1lLCBmcm9tKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9jaGFuZ2VBbmltYXRpb25OYW1lID0gYW5pbU5hbWU7CiAgICAgICAgICAgICAgICB0aGlzLl9jaGFuZ2VBbmltYXRpb25Gcm9tID0KICAgICAgICAgICAgICAgICAgICBmcm9tOwogICAgICAgICAgICAgICAgdGhpcy5fU3RhcnRUaWNraW5nKCk7CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuSXNJbkFuaW1hdGlvblRyaWdnZXIoKSkgdGhpcy5fRG9DaGFuZ2VBbmltYXRpb24oKQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9HZXRDdXJyZW50QW5pbWF0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2N1cnJlbnRBbmltYXRpb24KICAgICAgICAgICAgfQogICAgICAgICAgICBfR2V0Q3VycmVudEFuaW1hdGlvbk5hbWUoKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fY2hhbmdlQW5pbWF0aW9uTmFtZSkgcmV0dXJuIHRoaXMuX2NoYW5nZUFuaW1hdGlvbk5hbWU7CiAgICAgICAgICAgICAgICBlbHNlIHJldHVybiB0aGlzLl9jdXJyZW50QW5pbWF0aW9uLkdldE5hbWUoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9TZXRBbmltRnJhbWUoZnJhbWVOdW0pIHsKICAgICAgICAgICAgICAgIGlmICghaXNGaW5pdGUoZnJhbWVOdW0pKSByZXR1cm47CiAgICAgICAgICAgICAgICB0aGlzLl9jaGFuZ2VBbmltRnJhbWVJbmRleCA9IGZyYW1lTnVtOwogICAgICAgICAgICAgICAgaWYgKCF0aGlzLklzSW5BbmltYXRpb25UcmlnZ2VyKCkpIHRoaXMuX0RvQ2hhbmdlQW5pbUZyYW1lKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBfR2V0QW5pbUZyYW1lKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2N1cnJlbnRGcmFtZUluZGV4CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX1NldEFuaW1TcGVlZChzKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50QW5pbWF0aW9uU3BlZWQgPQogICAgICAgICAgICAgICAgICAgIE1hdGguYWJzKHMpOwogICAgICAgICAgICAgICAgdGhpcy5TZXRQbGF5aW5nRm9yd2FyZHMocyA+PSAwKTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9jdXJyZW50QW5pbWF0aW9uU3BlZWQgPiAwKSB0aGlzLl9TdGFydFRpY2tpbmcoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9HZXRBbmltU3BlZWQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5Jc1BsYXlpbmdGb3J3YXJkcygpID8gdGhpcy5fY3VycmVudEFuaW1hdGlvblNwZWVkIDogLXRoaXMuX2N1cnJlbnRBbmltYXRpb25TcGVlZAogICAgICAgICAgICB9CiAgICAgICAgICAgIF9TZXRBbmltUmVwZWF0VG9GcmFtZShmKSB7CiAgICAgICAgICAgICAgICBmID0gQzMuY2xhbXAoTWF0aC5mbG9vcihmKSwgMCwgdGhpcy5fY3VycmVudEFuaW1hdGlvbi5HZXRGcmFtZUNvdW50KCkgLSAxKTsKICAgICAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRBbmltYXRpb25SZXBlYXRUbyA9IGYKICAgICAgICAgICAgfQogICAgICAgICAgICBfR2V0QW5pbVJlcGVhdFRvRnJhbWUoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fY3VycmVudEFuaW1hdGlvblJlcGVhdFRvCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX0RvQ2hhbmdlQW5pbWF0aW9uKG9wdHMpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHByZXZGcmFtZSA9IHRoaXMuX2N1cnJlbnRBbmltYXRpb25GcmFtZTsKICAgICAgICAgICAgICAgIGNvbnN0IGFuaW1hdGlvbiA9IHRoaXMuX29iamVjdENsYXNzLkdldEFuaW1hdGlvbkJ5TmFtZSh0aGlzLl9jaGFuZ2VBbmltYXRpb25OYW1lKTsKICAgICAgICAgICAgICAgIHRoaXMuX2NoYW5nZUFuaW1hdGlvbk5hbWUgPSAiIjsKICAgICAgICAgICAgICAgIGlmICghYW5pbWF0aW9uKSByZXR1cm47CiAgICAgICAgICAgICAgICBpZiAoYW5pbWF0aW9uID09PSB0aGlzLl9jdXJyZW50QW5pbWF0aW9uICYmIHRoaXMuSXNBbmltYXRpb25QbGF5aW5nKCkpIHJldHVybjsKICAgICAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRBbmltYXRpb24gPSBhbmltYXRpb247CiAgICAgICAgICAgICAgICB0aGlzLlNldFBsYXlpbmdGb3J3YXJkcyhhbmltYXRpb24uR2V0U3BlZWQoKSA+PSAwKTsKICAgICAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRBbmltYXRpb25TcGVlZCA9IE1hdGguYWJzKGFuaW1hdGlvbi5HZXRTcGVlZCgpKTsKICAgICAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRBbmltYXRpb25SZXBlYXRUbyA9IGFuaW1hdGlvbi5HZXRSZXBlYXRUbygpOwogICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudEZyYW1lSW5kZXggPSBDMy5jbGFtcCh0aGlzLl9jdXJyZW50RnJhbWVJbmRleCwgMCwgdGhpcy5fY3VycmVudEFuaW1hdGlvbi5HZXRGcmFtZUNvdW50KCkgLSAxKTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9jaGFuZ2VBbmltYXRpb25Gcm9tID09PSAxKSB0aGlzLl9jdXJyZW50RnJhbWVJbmRleCA9IDA7CiAgICAgICAgICAgICAgICB0aGlzLlNldEFuaW1hdGlvblBsYXlpbmcodHJ1ZSk7CiAgICAgICAgICAgICAgICB0aGlzLl9mcmFtZVN0YXJ0VGltZSA9IHRoaXMuR2V0QW5pbWF0aW9uVGltZSgpOwogICAgICAgICAgICAgICAgY29uc3QgbmV4dEZyYW1lID0gdGhpcy5fY3VycmVudEFuaW1hdGlvbi5HZXRGcmFtZUF0KHRoaXMuX2N1cnJlbnRGcmFtZUluZGV4KTsKICAgICAgICAgICAgICAgIHRoaXMuX09uRnJhbWVDaGFuZ2VkKHByZXZGcmFtZSwgbmV4dEZyYW1lLCBvcHRzKQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9Eb0NoYW5nZUFuaW1GcmFtZSgpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHByZXZGcmFtZSA9IHRoaXMuX2N1cnJlbnRBbmltYXRpb25GcmFtZTsKICAgICAgICAgICAgICAgIGNvbnN0IHByZXZGcmFtZUluZGV4ID0gdGhpcy5fY3VycmVudEZyYW1lSW5kZXg7CiAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50RnJhbWVJbmRleCA9IEMzLmNsYW1wKE1hdGguZmxvb3IodGhpcy5fY2hhbmdlQW5pbUZyYW1lSW5kZXgpLCAwLCB0aGlzLl9jdXJyZW50QW5pbWF0aW9uLkdldEZyYW1lQ291bnQoKSAtIDEpOwogICAgICAgICAgICAgICAgdGhpcy5fY2hhbmdlQW5pbUZyYW1lSW5kZXggPSAtMTsKICAgICAgICAgICAgICAgIGlmIChwcmV2RnJhbWVJbmRleCA9PT0gdGhpcy5fY3VycmVudEZyYW1lSW5kZXgpIHJldHVybjsKICAgICAgICAgICAgICAgIGNvbnN0IG5leHRGcmFtZSA9IHRoaXMuX2N1cnJlbnRBbmltYXRpb24uR2V0RnJhbWVBdCh0aGlzLl9jdXJyZW50RnJhbWVJbmRleCk7CiAgICAgICAgICAgICAgICB0aGlzLl9PbkZyYW1lQ2hhbmdlZChwcmV2RnJhbWUsIG5leHRGcmFtZSk7CiAgICAgICAgICAgICAgICB0aGlzLl9mcmFtZVN0YXJ0VGltZSA9IHRoaXMuR2V0QW5pbWF0aW9uVGltZSgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX1VwZGF0ZUN1cnJlbnRUZXh0dXJlKCkgewogICAgICAgICAgICAgICAgY29uc3QgY3VySW1hZ2VJbmZvID0gdGhpcy5fY3VycmVudEFuaW1hdGlvbkZyYW1lLkdldEltYWdlSW5mbygpOwogICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudFRleHR1cmUgPSBjdXJJbWFnZUluZm8uR2V0VGV4dHVyZSgpOwogICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudFJjVGV4ID0gY3VySW1hZ2VJbmZvLkdldFRleFJlY3QoKTsKICAgICAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRRdWFkVGV4ID0gY3VySW1hZ2VJbmZvLkdldFRleFF1YWQoKTsKICAgICAgICAgICAgICAgIHRoaXMuR2V0V29ybGRJbmZvKCkuU2V0TWVzaENoYW5nZWQodHJ1ZSkKICAgICAgICAgICAgfQogICAgICAgICAgICBHZXRUZXh0dXJlKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2N1cnJlbnRUZXh0dXJlCiAgICAgICAgICAgIH0KICAgICAgICAgICAgR2V0VGV4UmVjdCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9jdXJyZW50UmNUZXgKICAgICAgICAgICAgfQogICAgICAgICAgICBHZXRUZXhRdWFkKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2N1cnJlbnRRdWFkVGV4CiAgICAgICAgICAgIH0KICAgICAgICAgICAgR2V0SW1hZ2VQb2ludENvdW50KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2N1cnJlbnRBbmltYXRpb25GcmFtZS5HZXRJbWFnZVBvaW50Q291bnQoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIEdldEltYWdlUG9pbnQobmFtZU9ySW5kZXgpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGZyYW1lID0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50QW5pbWF0aW9uRnJhbWU7CiAgICAgICAgICAgICAgICBjb25zdCB3aSA9IHRoaXMuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgICAgICBsZXQgaXAgPSBudWxsOwogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBuYW1lT3JJbmRleCA9PT0gInN0cmluZyIpIGlwID0gZnJhbWUuR2V0SW1hZ2VQb2ludEJ5TmFtZShuYW1lT3JJbmRleCk7CiAgICAgICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgbmFtZU9ySW5kZXggPT09ICJudW1iZXIiKSBpcCA9IGZyYW1lLkdldEltYWdlUG9pbnRCeUluZGV4KG5hbWVPckluZGV4IC0gMSk7CiAgICAgICAgICAgICAgICBlbHNlIHRocm93IG5ldyBUeXBlRXJyb3IoImV4cGVjdGVkIHN0cmluZyBvciBudW1iZXIiKTsKICAgICAgICAgICAgICAgIGxldCBwdFogPSB3aS5HZXRUb3RhbFpFbGV2YXRpb24oKTsKICAgICAgICAgICAgICAgIGlmICghaXApIHJldHVybiBbd2kuR2V0WCgpLCB3aS5HZXRZKCksIHB0Wl07CiAgICAgICAgICAgICAgICB0ZW1wVmVjMi5jb3B5KGlwLkdldFZlYzIoKSk7CiAgICAgICAgICAgICAgICBpZiAod2kuSGFzTWVzaCgpKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgW3R4LCB0eSwgdHpdID0gd2kuR2V0U291cmNlTWVzaCgpLlRyYW5zZm9ybVBvaW50KHRlbXBWZWMyLmdldFgoKSwgdGVtcFZlYzIuZ2V0WSgpKTsKICAgICAgICAgICAgICAgICAgICB0ZW1wVmVjMi5zZXQodHgsIHR5KTsKICAgICAgICAgICAgICAgICAgICBwdFogKz0gdHoKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRlbXBWZWMyLm9mZnNldCgtZnJhbWUuR2V0T3JpZ2luWCgpLCAtZnJhbWUuR2V0T3JpZ2luWSgpKTsKICAgICAgICAgICAgICAgIHRlbXBWZWMyLnNjYWxlKHdpLkdldFdpZHRoKCksIHdpLkdldEhlaWdodCgpKTsKICAgICAgICAgICAgICAgIHRlbXBWZWMyLnJvdGF0ZSh3aS5HZXRBbmdsZSgpKTsKICAgICAgICAgICAgICAgIHRlbXBWZWMyLm9mZnNldCh3aS5HZXRYKCksIHdpLkdldFkoKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gW3RlbXBWZWMyLmdldFgoKSwgdGVtcFZlYzIuZ2V0WSgpLCBwdFpdCiAgICAgICAgICAgIH0KICAgICAgICAgICAgR2V0Q29sbGlzaW9uUG9seVBvaW50Q291bnQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5HZXRXb3JsZEluZm8oKS5HZXRUcmFuc2Zvcm1lZENvbGxpc2lvblBvbHkoKS5wb2ludENvdW50KCkKICAgICAgICAgICAgfQogICAgICAgICAgICBHZXRDb2xsaXNpb25Qb2x5UG9pbnQoaW5kZXgpIHsKICAgICAgICAgICAgICAgIGluZGV4ID0gTWF0aC5mbG9vcihpbmRleCk7CiAgICAgICAgICAgICAgICBjb25zdCB3aSA9IHRoaXMuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgICAgICBjb25zdCBwb2x5ID0gd2kuR2V0VHJhbnNmb3JtZWRDb2xsaXNpb25Qb2x5KCk7CiAgICAgICAgICAgICAgICBjb25zdCBwb2ludENvdW50ID0gcG9seS5wb2ludENvdW50KCk7CiAgICAgICAgICAgICAgICBpZiAoaW5kZXggPT09IHBvaW50Q291bnQpIGluZGV4ID0KICAgICAgICAgICAgICAgICAgICAwOwogICAgICAgICAgICAgICAgaWYgKGluZGV4IDwgMCB8fCBpbmRleCA+PSBwb2ludENvdW50KSByZXR1cm4gWzAsIDBdOwogICAgICAgICAgICAgICAgY29uc3QgcG9pbnRzQXJyID0gcG9seS5wb2ludHNBcnIoKTsKICAgICAgICAgICAgICAgIHJldHVybiBbcG9pbnRzQXJyW2luZGV4ICogMiArIDBdICsgd2kuR2V0WCgpLCBwb2ludHNBcnJbaW5kZXggKiAyICsgMV0gKyB3aS5HZXRZKCldCiAgICAgICAgICAgIH0KICAgICAgICAgICAgR2V0RGVidWdnZXJQcm9wZXJ0aWVzKCkgewogICAgICAgICAgICAgICAgY29uc3QgQWN0cyA9IEMzLlBsdWdpbnMuU3ByaXRlLkFjdHM7CiAgICAgICAgICAgICAgICBjb25zdCBwcmVmaXggPSAicGx1Z2lucy5zcHJpdGUuZGVidWdnZXIuYW5pbWF0aW9uLXByb3BlcnRpZXMiOwogICAgICAgICAgICAgICAgcmV0dXJuIFt7CiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHByZWZpeCArICIudGl0bGUiLAogICAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IFt7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHByZWZpeCArICIuY3VycmVudC1hbmltYXRpb24iLAogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5fY3VycmVudEFuaW1hdGlvbi5HZXROYW1lKCksCiAgICAgICAgICAgICAgICAgICAgICAgIG9uZWRpdDogdiA9PiB0aGlzLkNhbGxBY3Rpb24oQWN0cy5TZXRBbmltLCB2LCAwKQogICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogcHJlZml4ICsgIi5jdXJyZW50LWZyYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuX2N1cnJlbnRGcmFtZUluZGV4LAogICAgICAgICAgICAgICAgICAgICAgICBvbmVkaXQ6IHYgPT4gdGhpcy5DYWxsQWN0aW9uKEFjdHMuU2V0QW5pbUZyYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdikKICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHByZWZpeCArICIuaXMtcGxheWluZyIsCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLklzQW5pbWF0aW9uUGxheWluZygpLAogICAgICAgICAgICAgICAgICAgICAgICBvbmVkaXQ6IHYgPT4gdiA/IHRoaXMuQ2FsbEFjdGlvbihBY3RzLlN0YXJ0QW5pbSwgMCkgOiB0aGlzLkNhbGxBY3Rpb24oQWN0cy5TdG9wQW5pbSkKICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHByZWZpeCArICIuc3BlZWQiLAogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5fY3VycmVudEFuaW1hdGlvblNwZWVkLAogICAgICAgICAgICAgICAgICAgICAgICBvbmVkaXQ6IHYgPT4gdGhpcy5DYWxsQWN0aW9uKEFjdHMuU2V0QW5pbVNwZWVkLCB2KQogICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogcHJlZml4ICsgIi5yZXBlYXRzIiwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuX2FuaW1hdGlvblJlcGVhdHMsCiAgICAgICAgICAgICAgICAgICAgICAgIG9uZWRpdDogdiA9PiB0aGlzLl9hbmltYXRpb25SZXBlYXRzID0gdgogICAgICAgICAgICAgICAgICAgIH1dCiAgICAgICAgICAgICAgICB9XQogICAgICAgICAgICB9CiAgICAgICAgICAgIFNhdmVUb0pzb24oKSB7CiAgICAgICAgICAgICAgICBjb25zdCBvID0gewogICAgICAgICAgICAgICAgICAgICJhIjogdGhpcy5fY3VycmVudEFuaW1hdGlvbi5HZXRTSUQoKQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9mcmFtZVN0YXJ0VGltZSAhPT0gMCkgb1siZnMiXSA9IHRoaXMuX2ZyYW1lU3RhcnRUaW1lOwogICAgICAgICAgICAgICAgY29uc3QgYW5pbVRpbWUgPSB0aGlzLkdldEFuaW1hdGlvblRpbWUoKTsKICAgICAgICAgICAgICAgIGlmIChhbmltVGltZSAhPT0KICAgICAgICAgICAgICAgICAgICAwKSBvWyJhdCJdID0gYW5pbVRpbWU7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fY3VycmVudEZyYW1lSW5kZXggIT09IDApIG9bImYiXSA9IHRoaXMuX2N1cnJlbnRGcmFtZUluZGV4OwogICAgICAgICAgICAgICAgaWYgKHRoaXMuX2N1cnJlbnRBbmltYXRpb25TcGVlZCAhPT0gMCkgb1siY2FzIl0gPSB0aGlzLl9jdXJyZW50QW5pbWF0aW9uU3BlZWQ7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fYW5pbWF0aW9uUmVwZWF0cyAhPT0gMSkgb1siYXIiXSA9IHRoaXMuX2FuaW1hdGlvblJlcGVhdHM7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fY3VycmVudEFuaW1hdGlvblJlcGVhdFRvICE9PSAwKSBvWyJydCJdID0gdGhpcy5fY3VycmVudEFuaW1hdGlvblJlcGVhdFRvOwogICAgICAgICAgICAgICAgaWYgKCF0aGlzLklzQW5pbWF0aW9uUGxheWluZygpKSBvWyJhcCJdID0gdGhpcy5Jc0FuaW1hdGlvblBsYXlpbmcoKTsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5Jc1BsYXlpbmdGb3J3YXJkcygpKSBvWyJhZiJdID0gdGhpcy5Jc1BsYXlpbmdGb3J3YXJkcygpOwogICAgICAgICAgICAgICAgY29uc3Qgd2kgPSB0aGlzLkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICAgICAgaWYgKHdpLklzQ29sbGlzaW9uRW5hYmxlZCgpKSBvWyJjZSJdID0gd2kuSXNDb2xsaXNpb25FbmFibGVkKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gbwogICAgICAgICAgICB9CiAgICAgICAgICAgIExvYWRGcm9tSnNvbihvKSB7CiAgICAgICAgICAgICAgICBjb25zdCBhbmltID0gdGhpcy5HZXRPYmplY3RDbGFzcygpLkdldEFuaW1hdGlvbkJ5U0lEKG9bImEiXSk7CiAgICAgICAgICAgICAgICBpZiAoYW5pbSkgdGhpcy5fY3VycmVudEFuaW1hdGlvbiA9IGFuaW07CiAgICAgICAgICAgICAgICB0aGlzLl9mcmFtZVN0YXJ0VGltZSA9IG8uaGFzT3duUHJvcGVydHkoImZzIikgPyBvWyJmcyJdIDogMDsKICAgICAgICAgICAgICAgIHRoaXMuX2FuaW1hdGlvblRpbWVyLlNldChvLmhhc093blByb3BlcnR5KCJhdCIpID8gb1siYXQiXSA6IDApOwogICAgICAgICAgICAgICAgY29uc3QgZnJhbWVJbmRleCA9IG8uaGFzT3duUHJvcGVydHkoImYiKSA/IG9bImYiXSA6IDA7CiAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50RnJhbWVJbmRleCA9IEMzLmNsYW1wKGZyYW1lSW5kZXgsIDAsIHRoaXMuX2N1cnJlbnRBbmltYXRpb24uR2V0RnJhbWVDb3VudCgpIC0gMSk7CiAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50QW5pbWF0aW9uU3BlZWQgPSBvLmhhc093blByb3BlcnR5KCJjYXMiKSA/IG9bImNhcyJdIDogMDsKICAgICAgICAgICAgICAgIHRoaXMuX2FuaW1hdGlvblJlcGVhdHMgPSBvLmhhc093blByb3BlcnR5KCJhciIpID8gb1siYXIiXSA6IDE7CiAgICAgICAgICAgICAgICBjb25zdCByZXBlYXRUb0luZGV4ID0KICAgICAgICAgICAgICAgICAgICBvLmhhc093blByb3BlcnR5KCJydCIpID8gb1sicnQiXSA6IDA7CiAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50QW5pbWF0aW9uUmVwZWF0VG8gPSBDMy5jbGFtcChyZXBlYXRUb0luZGV4LCAwLCB0aGlzLl9jdXJyZW50QW5pbWF0aW9uLkdldEZyYW1lQ291bnQoKSAtIDEpOwogICAgICAgICAgICAgICAgdGhpcy5TZXRBbmltYXRpb25QbGF5aW5nKG8uaGFzT3duUHJvcGVydHkoImFwIikgPyAhIW9bImFwIl0gOiB0cnVlKTsKICAgICAgICAgICAgICAgIHRoaXMuU2V0UGxheWluZ0ZvcndhcmRzKG8uaGFzT3duUHJvcGVydHkoImFmIikgPyAhIW9bImFmIl0gOiB0cnVlKTsKICAgICAgICAgICAgICAgIGNvbnN0IG5leHRGcmFtZSA9IHRoaXMuX2N1cnJlbnRBbmltYXRpb24uR2V0RnJhbWVBdCh0aGlzLl9jdXJyZW50RnJhbWVJbmRleCk7CiAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50QW5pbWF0aW9uRnJhbWUgPSBuZXh0RnJhbWU7CiAgICAgICAgICAgICAgICB0aGlzLl9VcGRhdGVDdXJyZW50VGV4dHVyZSgpOwogICAgICAgICAgICAgICAgY29uc3Qgd2kgPSB0aGlzLkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICAgICAgd2kuU2V0T3JpZ2luWChuZXh0RnJhbWUuR2V0T3JpZ2luWCgpKTsKICAgICAgICAgICAgICAgIHdpLlNldE9yaWdpblkobmV4dEZyYW1lLkdldE9yaWdpblkoKSk7CiAgICAgICAgICAgICAgICB3aS5TZXRTb3VyY2VDb2xsaXNpb25Qb2x5KG5leHRGcmFtZS5HZXRDb2xsaXNpb25Qb2x5KCkpOwogICAgICAgICAgICAgICAgd2kuU2V0Q29sbGlzaW9uRW5hYmxlZCghIW9bImNlIl0pOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuSXNBbmltYXRpb25QbGF5aW5nKCkpIHRoaXMuX1N0YXJ0VGlja2luZygpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgR2V0UHJvcGVydHlWYWx1ZUJ5SW5kZXgoaW5kZXgpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHdpID0gdGhpcy5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgICAgIHN3aXRjaCAoaW5kZXgpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlIEVOQUJMRV9DT0xMSVNJT05TOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gd2kuSXNDb2xsaXNpb25FbmFibGVkKCk7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBJTklUSUFMX0ZSQU1FOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gQzMuY2xhbXAodGhpcy5fY3VycmVudEZyYW1lSW5kZXgsIDAsIHRoaXMuX2N1cnJlbnRBbmltYXRpb24uR2V0RnJhbWVDb3VudCgpIC0gMSk7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBJTklUSUFMX0FOSU1BVElPTjoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2N1cnJlbnRBbmltYXRpb24uR2V0TmFtZSgpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgU2V0UHJvcGVydHlWYWx1ZUJ5SW5kZXgoaW5kZXgsIHZhbHVlLCBvcHRzKSB7CiAgICAgICAgICAgICAgICBjb25zdCB3aSA9IHRoaXMuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgICAgICBzd2l0Y2ggKGluZGV4KSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBFTkFCTEVfQ09MTElTSU9OUzoKICAgICAgICAgICAgICAgICAgICAgICAgd2kuU2V0Q29sbGlzaW9uRW5hYmxlZCghIXZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBJTklUSUFMX0ZSQU1FOgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLlNldEFuaW1hdGlvblBsYXlpbmcoZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0b3RhbEZyYW1lcyA9IHRoaXMuX2N1cnJlbnRBbmltYXRpb24uR2V0RnJhbWVDb3VudCgpIC0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbmV4dEluZGV4ID0gdmFsdWUgPSBDMy5jbGFtcCh2YWx1ZSwgMCwgdG90YWxGcmFtZXMpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwcmV2RnJhbWUgPSB0aGlzLl9jdXJyZW50QW5pbWF0aW9uLkdldEZyYW1lQXQodGhpcy5fY3VycmVudEZyYW1lSW5kZXgpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXh0RnJhbWUgPSB0aGlzLl9jdXJyZW50QW5pbWF0aW9uLkdldEZyYW1lQXQobmV4dEluZGV4KTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fT25GcmFtZUNoYW5nZWQocHJldkZyYW1lLCBuZXh0RnJhbWUsIG9wdHMpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50RnJhbWVJbmRleCA9IEMzLmNsYW1wKG5leHRJbmRleCwgMCwgdG90YWxGcmFtZXMpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIElOSVRJQUxfQU5JTUFUSU9OOgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9jaGFuZ2VBbmltYXRpb25OYW1lID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9Eb0NoYW5nZUFuaW1hdGlvbihvcHRzKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBHZXRTY3JpcHRJbnRlcmZhY2VDbGFzcygpIHsKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLklTcHJpdGVJbnN0YW5jZQogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICBjb25zdCBtYXAgPSBuZXcgV2Vha01hcDsKICAgICAgICBjb25zdCBBTklNX0ZST01fTU9ERVMgPSBuZXcgTWFwKFsKICAgICAgICAgICAgWyJjdXJyZW50LWZyYW1lIiwgMF0sCiAgICAgICAgICAgIFsiYmVnaW5uaW5nIiwgMV0KICAgICAgICBdKTsKICAgICAgICBzZWxmLklTcHJpdGVJbnN0YW5jZSA9IGNsYXNzIElTcHJpdGVJbnN0YW5jZSBleHRlbmRzIHNlbGYuSVdvcmxkSW5zdGFuY2UgewogICAgICAgICAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgICAgICAgICAgIHN1cGVyKCk7CiAgICAgICAgICAgICAgICBtYXAuc2V0KHRoaXMsIHNlbGYuSUluc3RhbmNlLl9HZXRJbml0SW5zdCgpLkdldFNka0luc3RhbmNlKCkpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZ2V0SW1hZ2VQb2ludENvdW50KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIG1hcC5nZXQodGhpcykuR2V0SW1hZ2VQb2ludENvdW50KCkKICAgICAgICAgICAgfQogICAgICAgICAgICBnZXRJbWFnZVBvaW50WChuYW1lT3JJbmRleCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0SW1hZ2VQb2ludChuYW1lT3JJbmRleClbMF0KICAgICAgICAgICAgfQogICAgICAgICAgICBnZXRJbWFnZVBvaW50WShuYW1lT3JJbmRleCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0SW1hZ2VQb2ludChuYW1lT3JJbmRleClbMV0KICAgICAgICAgICAgfQogICAgICAgICAgICBnZXRJbWFnZVBvaW50WihuYW1lT3JJbmRleCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0SW1hZ2VQb2ludChuYW1lT3JJbmRleClbMl0KICAgICAgICAgICAgfQogICAgICAgICAgICBnZXRJbWFnZVBvaW50KG5hbWVPckluZGV4KSB7CiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIG5hbWVPckluZGV4ICE9PQogICAgICAgICAgICAgICAgICAgICJzdHJpbmciICYmIHR5cGVvZiBuYW1lT3JJbmRleCAhPT0gIm51bWJlciIpIHRocm93IG5ldyBUeXBlRXJyb3IoImV4cGVjdGVkIHN0cmluZyBvciBudW1iZXIiKTsKICAgICAgICAgICAgICAgIHJldHVybiBtYXAuZ2V0KHRoaXMpLkdldEltYWdlUG9pbnQobmFtZU9ySW5kZXgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZ2V0UG9seVBvaW50Q291bnQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbWFwLmdldCh0aGlzKS5HZXRDb2xsaXNpb25Qb2x5UG9pbnRDb3VudCgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZ2V0UG9seVBvaW50WChpbmRleCkgewogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVGaW5pdGVOdW1iZXIoaW5kZXgpOwogICAgICAgICAgICAgICAgcmV0dXJuIG1hcC5nZXQodGhpcykuR2V0Q29sbGlzaW9uUG9seVBvaW50KGluZGV4KVswXQogICAgICAgICAgICB9CiAgICAgICAgICAgIGdldFBvbHlQb2ludFkoaW5kZXgpIHsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlRmluaXRlTnVtYmVyKGluZGV4KTsKICAgICAgICAgICAgICAgIHJldHVybiBtYXAuZ2V0KHRoaXMpLkdldENvbGxpc2lvblBvbHlQb2ludChpbmRleClbMV0KICAgICAgICAgICAgfQogICAgICAgICAgICBnZXRQb2x5UG9pbnQoaW5kZXgpIHsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlRmluaXRlTnVtYmVyKGluZGV4KTsKICAgICAgICAgICAgICAgIHJldHVybiBtYXAuZ2V0KHRoaXMpLkdldENvbGxpc2lvblBvbHlQb2ludChpbmRleCkKICAgICAgICAgICAgfQogICAgICAgICAgICBzdG9wQW5pbWF0aW9uKCkgewogICAgICAgICAgICAgICAgbWFwLmdldCh0aGlzKS5TZXRBbmltYXRpb25QbGF5aW5nKGZhbHNlKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHN0YXJ0QW5pbWF0aW9uKGZyb20gPQogICAgICAgICAgICAgICAgImN1cnJlbnQtZnJhbWUiKSB7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZVN0cmluZyhmcm9tKTsKICAgICAgICAgICAgICAgIGNvbnN0IGYgPSBBTklNX0ZST01fTU9ERVMuZ2V0KGZyb20pOwogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBmID09PSAidW5kZWZpbmVkIikgdGhyb3cgbmV3IEVycm9yKCJpbnZhbGlkIG1vZGUiKTsKICAgICAgICAgICAgICAgIG1hcC5nZXQodGhpcykuX1N0YXJ0QW5pbShmKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHNldEFuaW1hdGlvbihuYW1lLCBmcm9tID0gImJlZ2lubmluZyIpIHsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlU3RyaW5nKG5hbWUpOwogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVTdHJpbmcoZnJvbSk7CiAgICAgICAgICAgICAgICBjb25zdCBmID0gQU5JTV9GUk9NX01PREVTLmdldChmcm9tKTsKICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZiA9PT0gInVuZGVmaW5lZCIpIHRocm93IG5ldyBFcnJvcigiaW52YWxpZCBtb2RlIik7CiAgICAgICAgICAgICAgICBjb25zdCBpbnN0ID0gbWFwLmdldCh0aGlzKTsKICAgICAgICAgICAgICAgIGlmICghaW5zdC5HZXRPYmplY3RDbGFzcygpLkdldEFuaW1hdGlvbkJ5TmFtZShuYW1lKSkgdGhyb3cgbmV3IEVycm9yKGBhbmltYXRpb24gbmFtZSAiJHtuYW1lfSIgZG9lcyBub3QgZXhpc3RgKTsKICAgICAgICAgICAgICAgIGluc3QuX1NldEFuaW0obmFtZSwgZikKICAgICAgICAgICAgfQogICAgICAgICAgICBnZXRBbmltYXRpb24obmFtZSkgewogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVTdHJpbmcobmFtZSk7CiAgICAgICAgICAgICAgICBjb25zdCBhID0gbWFwLmdldCh0aGlzKS5HZXRPYmplY3RDbGFzcygpLkdldEFuaW1hdGlvbkJ5TmFtZShuYW1lKTsKICAgICAgICAgICAgICAgIHJldHVybiBhID8gYS5HZXRJQW5pbWF0aW9uKCkgOiBudWxsCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZ2V0IGFuaW1hdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBtYXAuZ2V0KHRoaXMpLl9HZXRDdXJyZW50QW5pbWF0aW9uKCkuR2V0SUFuaW1hdGlvbigpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZ2V0IGFuaW1hdGlvbk5hbWUoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbWFwLmdldCh0aGlzKS5fR2V0Q3VycmVudEFuaW1hdGlvbk5hbWUoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHNldCBhbmltYXRpb25GcmFtZShmcmFtZUluZGV4KSB7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcihmcmFtZUluZGV4KTsKICAgICAgICAgICAgICAgIG1hcC5nZXQodGhpcykuX1NldEFuaW1GcmFtZShmcmFtZUluZGV4KQogICAgICAgICAgICB9CiAgICAgICAgICAgIGdldCBhbmltYXRpb25GcmFtZSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBtYXAuZ2V0KHRoaXMpLl9HZXRBbmltRnJhbWUoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHNldCBhbmltYXRpb25TcGVlZChzKSB7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcihzKTsKICAgICAgICAgICAgICAgIG1hcC5nZXQodGhpcykuX1NldEFuaW1TcGVlZChzKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGdldCBhbmltYXRpb25TcGVlZCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBtYXAuZ2V0KHRoaXMpLl9HZXRBbmltU3BlZWQoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHNldCBhbmltYXRpb25SZXBlYXRUb0ZyYW1lKGYpIHsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlRmluaXRlTnVtYmVyKGYpOwogICAgICAgICAgICAgICAgbWFwLmdldCh0aGlzKS5fU2V0QW5pbVJlcGVhdFRvRnJhbWUoZikKICAgICAgICAgICAgfQogICAgICAgICAgICBnZXQgYW5pbWF0aW9uUmVwZWF0VG9GcmFtZSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBtYXAuZ2V0KHRoaXMpLl9HZXRBbmltUmVwZWF0VG9GcmFtZSgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZ2V0IGltYWdlV2lkdGgoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbWFwLmdldCh0aGlzKS5HZXRDdXJyZW50SW1hZ2VJbmZvKCkuR2V0V2lkdGgoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGdldCBpbWFnZUhlaWdodCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBtYXAuZ2V0KHRoaXMpLkdldEN1cnJlbnRJbWFnZUluZm8oKS5HZXRIZWlnaHQoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGdldEltYWdlU2l6ZSgpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGltYWdlSW5mbyA9IG1hcC5nZXQodGhpcykuR2V0Q3VycmVudEltYWdlSW5mbygpOwogICAgICAgICAgICAgICAgcmV0dXJuIFtpbWFnZUluZm8uR2V0V2lkdGgoKSwgaW1hZ2VJbmZvLkdldEhlaWdodCgpXQogICAgICAgICAgICB9CiAgICAgICAgICAgIGFzeW5jIHJlcGxhY2VDdXJyZW50QW5pbWF0aW9uRnJhbWUoYmxvYikgewogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVJbnN0YW5jZU9mKGJsb2IsIEJsb2IpOwogICAgICAgICAgICAgICAgY29uc3Qgc2RrSW5zdCA9IG1hcC5nZXQodGhpcyk7CiAgICAgICAgICAgICAgICBjb25zdCBydW50aW1lID0gc2RrSW5zdC5HZXRSdW50aW1lKCk7CiAgICAgICAgICAgICAgICBjb25zdCBjdXJJbWFnZUluZm8gPSBzZGtJbnN0LkdldEN1cnJlbnRJbWFnZUluZm8oKTsKICAgICAgICAgICAgICAgIGNvbnN0IGltYWdlSW5mbyA9IEMzLk5ldyhDMy5JbWFnZUluZm8pOwogICAgICAgICAgICAgICAgaW1hZ2VJbmZvLkxvYWREeW5hbWljQmxvYkFzc2V0KHJ1bnRpbWUsIGJsb2IpOwogICAgICAgICAgICAgICAgYXdhaXQgaW1hZ2VJbmZvLkxvYWRTdGF0aWNUZXh0dXJlKHJ1bnRpbWUuR2V0UmVuZGVyZXIoKSwgewogICAgICAgICAgICAgICAgICAgIHNhbXBsaW5nOiBydW50aW1lLkdldFNhbXBsaW5nKCkKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgaWYgKHNka0luc3QuV2FzUmVsZWFzZWQoKSkgewogICAgICAgICAgICAgICAgICAgIGltYWdlSW5mby5SZWxlYXNlKCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjdXJJbWFnZUluZm8uUmVwbGFjZVdpdGgoaW1hZ2VJbmZvKTsKICAgICAgICAgICAgICAgIHNka0luc3QuR2V0U2RrVHlwZSgpLl9VcGRhdGVBbGxDdXJyZW50VGV4dHVyZSgpOwogICAgICAgICAgICAgICAgcnVudGltZS5VcGRhdGVSZW5kZXIoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHNldFNvbGlkQ29sbGlzaW9uRmlsdGVyKGlzSW5jbHVzaXZlLCB0YWdzKSB7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZVN0cmluZyh0YWdzKTsKICAgICAgICAgICAgICAgIG1hcC5nZXQodGhpcykuR2V0V29ybGRJbmZvKCkuU2V0U29saWRDb2xsaXNpb25GaWx0ZXIoISFpc0luY2x1c2l2ZSwKICAgICAgICAgICAgICAgICAgICB0YWdzKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSB7CiAgICAgICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgICAgIEMzLlBsdWdpbnMuU3ByaXRlLkNuZHMgPSB7CiAgICAgICAgICAgIElzQW5pbVBsYXlpbmcoYW5pbU5hbWUpIHsKICAgICAgICAgICAgICAgIHJldHVybiBDMy5lcXVhbHNOb0Nhc2UodGhpcy5fR2V0Q3VycmVudEFuaW1hdGlvbk5hbWUoKSwgYW5pbU5hbWUpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIENvbXBhcmVGcmFtZShjbXAsIGZyYW1lTnVtKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gQzMuY29tcGFyZSh0aGlzLl9jdXJyZW50RnJhbWVJbmRleCwgY21wLCBmcmFtZU51bSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgQ29tcGFyZUFuaW1TcGVlZChjbXAsIHgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBDMy5jb21wYXJlKHRoaXMuX0dldEFuaW1TcGVlZCgpLCBjbXAsIHgpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIE9uQW5pbUZpbmlzaGVkKGFuaW1OYW1lKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gQzMuZXF1YWxzTm9DYXNlKHRoaXMuX2FuaW1UcmlnZ2VyTmFtZSwgYW5pbU5hbWUpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIE9uQW55QW5pbUZpbmlzaGVkKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgT25GcmFtZUNoYW5nZWQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgICAgICB9LAogICAgICAgICAgICBJc01pcnJvcmVkKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuR2V0V29ybGRJbmZvKCkuR2V0V2lkdGgoKSA8IDAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgSXNGbGlwcGVkKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuR2V0V29ybGRJbmZvKCkuR2V0SGVpZ2h0KCkgPCAwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIE9uVVJMTG9hZGVkKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgT25VUkxGYWlsZWQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgICAgICB9LAogICAgICAgICAgICBJc0NvbGxpc2lvbkVuYWJsZWQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5HZXRXb3JsZEluZm8oKS5Jc0NvbGxpc2lvbkVuYWJsZWQoKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSB7CiAgICAgICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgICAgIEMzLlBsdWdpbnMuU3ByaXRlLkFjdHMgPSB7CiAgICAgICAgICAgIFNwYXduKG9iamVjdENsYXNzLCBsYXllciwgaW1nUHQsIGNyZWF0ZUhpZXJhcmNoeSkgewogICAgICAgICAgICAgICAgaWYgKCFvYmplY3RDbGFzcyB8fCAhbGF5ZXIpIHJldHVybjsKICAgICAgICAgICAgICAgIGNvbnN0IFtpbWdQdFgsIGltZ1B0WV0gPSB0aGlzLkdldEltYWdlUG9pbnQoaW1nUHQpOwogICAgICAgICAgICAgICAgY29uc3QgaW5zdCA9IHRoaXMuX3J1bnRpbWUuQ3JlYXRlSW5zdGFuY2Uob2JqZWN0Q2xhc3MsIGxheWVyLCBpbWdQdFgsIGltZ1B0WSwgY3JlYXRlSGllcmFyY2h5KTsKICAgICAgICAgICAgICAgIGlmICghaW5zdCkgcmV0dXJuOwogICAgICAgICAgICAgICAgaWYgKGNyZWF0ZUhpZXJhcmNoeSkgbGF5ZXIuU29ydEFuZEFkZEluc3RhbmNlc0J5WkluZGV4KGluc3QpOwogICAgICAgICAgICAgICAgaWYgKG9iamVjdENsYXNzLkdldFBsdWdpbigpLklzUm90YXRhYmxlKCkpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBpbnN0V2kgPSBpbnN0LkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICAgICAgICAgIGluc3RXaS5TZXRBbmdsZSh0aGlzLkdldFdvcmxkSW5mbygpLkdldEFuZ2xlKCkpOwogICAgICAgICAgICAgICAgICAgIGluc3RXaS5TZXRCYm94Q2hhbmdlZCgpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjb25zdCBldmVudFNoZWV0TWFuYWdlciA9CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcnVudGltZS5HZXRFdmVudFNoZWV0TWFuYWdlcigpOwogICAgICAgICAgICAgICAgZXZlbnRTaGVldE1hbmFnZXIuQmxvY2tGbHVzaGluZ0luc3RhbmNlcyh0cnVlKTsKICAgICAgICAgICAgICAgIGluc3QuX1RyaWdnZXJPbkNyZWF0ZWRPblNlbGZBbmRSZWxhdGVkKCk7CiAgICAgICAgICAgICAgICBldmVudFNoZWV0TWFuYWdlci5CbG9ja0ZsdXNoaW5nSW5zdGFuY2VzKGZhbHNlKTsKICAgICAgICAgICAgICAgIGlmIChvYmplY3RDbGFzcyAhPT0gdGhpcy5HZXRPYmplY3RDbGFzcygpKSB0aGlzLl9zZGtUeXBlLl9TcGF3blBpY2tJbnN0YW5jZShvYmplY3RDbGFzcywgaW5zdCwgY3JlYXRlSGllcmFyY2h5KQogICAgICAgICAgICB9LAogICAgICAgICAgICBTdG9wQW5pbSgpIHsKICAgICAgICAgICAgICAgIHRoaXMuU2V0QW5pbWF0aW9uUGxheWluZyhmYWxzZSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgU3RhcnRBbmltKGZyb20pIHsKICAgICAgICAgICAgICAgIHRoaXMuX1N0YXJ0QW5pbShmcm9tKQogICAgICAgICAgICB9LAogICAgICAgICAgICBTZXRBbmltKGFuaW1OYW1lLCBmcm9tKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9TZXRBbmltKGFuaW1OYW1lLCBmcm9tKQogICAgICAgICAgICB9LAogICAgICAgICAgICBTZXRBbmltRnJhbWUoZnJhbWVOdW0pIHsKICAgICAgICAgICAgICAgIHRoaXMuX1NldEFuaW1GcmFtZShmcmFtZU51bSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgU2V0QW5pbVNwZWVkKHMpIHsKICAgICAgICAgICAgICAgIHRoaXMuX1NldEFuaW1TcGVlZChzKQogICAgICAgICAgICB9LAogICAgICAgICAgICBTZXRBbmltUmVwZWF0VG9GcmFtZShmKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9TZXRBbmltUmVwZWF0VG9GcmFtZShmKQogICAgICAgICAgICB9LAogICAgICAgICAgICBTZXRNaXJyb3JlZChtKSB7CiAgICAgICAgICAgICAgICBjb25zdCB3aSA9IHRoaXMuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgICAgICBjb25zdCBvbGRXID0gd2kuR2V0V2lkdGgoKTsKICAgICAgICAgICAgICAgIGNvbnN0IG5ld1cgPSBNYXRoLmFicyhvbGRXKSAqIChtID09PSAwID8gLTEgOiAxKTsKICAgICAgICAgICAgICAgIGlmIChvbGRXID09PSBuZXdXKSByZXR1cm47CiAgICAgICAgICAgICAgICB3aS5TZXRXaWR0aChuZXdXKTsKICAgICAgICAgICAgICAgIHdpLlNldEJib3hDaGFuZ2VkKCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgU2V0RmxpcHBlZChmKSB7CiAgICAgICAgICAgICAgICBjb25zdCB3aSA9IHRoaXMuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgICAgICBjb25zdCBvbGRIID0gd2kuR2V0SGVpZ2h0KCk7CiAgICAgICAgICAgICAgICBjb25zdCBuZXdIID0gTWF0aC5hYnMob2xkSCkgKiAoZiA9PT0gMCA/IC0xIDogMSk7CiAgICAgICAgICAgICAgICBpZiAob2xkSCA9PT0gbmV3SCkgcmV0dXJuOwogICAgICAgICAgICAgICAgd2kuU2V0SGVpZ2h0KG5ld0gpOwogICAgICAgICAgICAgICAgd2kuU2V0QmJveENoYW5nZWQoKQogICAgICAgICAgICB9LAogICAgICAgICAgICBTZXRTY2FsZShzKSB7CiAgICAgICAgICAgICAgICBjb25zdCBmcmFtZSA9IHRoaXMuX2N1cnJlbnRBbmltYXRpb25GcmFtZTsKICAgICAgICAgICAgICAgIGNvbnN0IGltYWdlSW5mbyA9IGZyYW1lLkdldEltYWdlSW5mbygpOwogICAgICAgICAgICAgICAgY29uc3Qgd2kgPSB0aGlzLkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICAgICAgY29uc3QgbWlycm9yRmFjdG9yID0gd2kuR2V0V2lkdGgoKSA8IDAgPyAtMSA6IDE7CiAgICAgICAgICAgICAgICBjb25zdCBmbGlwRmFjdG9yID0gd2kuR2V0SGVpZ2h0KCkgPCAwID8gLTEgOiAxOwogICAgICAgICAgICAgICAgY29uc3QgbmV3V2lkdGggPSBpbWFnZUluZm8uR2V0V2lkdGgoKSAqIHMgKiBtaXJyb3JGYWN0b3I7CiAgICAgICAgICAgICAgICBjb25zdCBuZXdIZWlnaHQgPSBpbWFnZUluZm8uR2V0SGVpZ2h0KCkgKiBzICogZmxpcEZhY3RvcjsKICAgICAgICAgICAgICAgIGlmICh3aS5HZXRXaWR0aCgpICE9PSBuZXdXaWR0aCB8fCB3aS5HZXRIZWlnaHQoKSAhPT0gbmV3SGVpZ2h0KSB7CiAgICAgICAgICAgICAgICAgICAgd2kuU2V0U2l6ZShuZXdXaWR0aCwgbmV3SGVpZ2h0KTsKICAgICAgICAgICAgICAgICAgICB3aS5TZXRCYm94Q2hhbmdlZCgpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGFzeW5jIExvYWRVUkwodXJsLCByZXNpemUsIGNyb3NzT3JpZ2luKSB7CiAgICAgICAgICAgICAgICBjb25zdCBjdXJBbmltRnJhbWUgPSB0aGlzLl9jdXJyZW50QW5pbWF0aW9uRnJhbWU7CiAgICAgICAgICAgICAgICBjb25zdCBjdXJJbWFnZUluZm8gPSBjdXJBbmltRnJhbWUuR2V0SW1hZ2VJbmZvKCk7CiAgICAgICAgICAgICAgICBjb25zdCB3aSA9IHRoaXMuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgICAgICBjb25zdCBydW50aW1lID0gdGhpcy5fcnVudGltZTsKICAgICAgICAgICAgICAgIGNvbnN0IHNka1R5cGUgPSB0aGlzLl9zZGtUeXBlOwogICAgICAgICAgICAgICAgaWYgKGN1ckltYWdlSW5mby5HZXRVUkwoKSA9PT0gdXJsKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc2l6ZSA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICB3aS5TZXRTaXplKGN1ckltYWdlSW5mby5HZXRXaWR0aCgpLCBjdXJJbWFnZUluZm8uR2V0SGVpZ2h0KCkpOwogICAgICAgICAgICAgICAgICAgICAgICB3aS5TZXRCYm94Q2hhbmdlZCgpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHRoaXMuVHJpZ2dlcihDMy5QbHVnaW5zLlNwcml0ZS5DbmRzLk9uVVJMTG9hZGVkKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNvbnN0IGltYWdlSW5mbyA9IEMzLk5ldyhDMy5JbWFnZUluZm8pOwogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBhd2FpdCBpbWFnZUluZm8uTG9hZER5bmFtaWNBc3NldChydW50aW1lLCB1cmwpOwogICAgICAgICAgICAgICAgICAgIGlmICghaW1hZ2VJbmZvLklzTG9hZGVkKCkpIHRocm93IG5ldyBFcnJvcigiaW1hZ2UgZmFpbGVkIHRvIGxvYWQiKTsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5XYXNSZWxlYXNlZCgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGltYWdlSW5mby5SZWxlYXNlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBhd2FpdCBpbWFnZUluZm8uTG9hZFN0YXRpY1RleHR1cmUocnVudGltZS5HZXRSZW5kZXJlcigpLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNhbXBsaW5nOiBydW50aW1lLkdldFNhbXBsaW5nKCkKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcigiTG9hZCBpbWFnZSBmcm9tIFVSTCBmYWlsZWQ6ICIsCiAgICAgICAgICAgICAgICAgICAgICAgIGVycik7CiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLldhc1JlbGVhc2VkKCkpIHRoaXMuVHJpZ2dlcihDMy5QbHVnaW5zLlNwcml0ZS5DbmRzLk9uVVJMRmFpbGVkKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh0aGlzLldhc1JlbGVhc2VkKCkpIHsKICAgICAgICAgICAgICAgICAgICBpbWFnZUluZm8uUmVsZWFzZSgpOwogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY3VySW1hZ2VJbmZvLlJlcGxhY2VXaXRoKGltYWdlSW5mbyk7CiAgICAgICAgICAgICAgICBzZGtUeXBlLl9VcGRhdGVBbGxDdXJyZW50VGV4dHVyZSgpOwogICAgICAgICAgICAgICAgcnVudGltZS5VcGRhdGVSZW5kZXIoKTsKICAgICAgICAgICAgICAgIGlmIChyZXNpemUgPT09IDApIHsKICAgICAgICAgICAgICAgICAgICB3aS5TZXRTaXplKGN1ckltYWdlSW5mby5HZXRXaWR0aCgpLCBjdXJJbWFnZUluZm8uR2V0SGVpZ2h0KCkpOwogICAgICAgICAgICAgICAgICAgIHdpLlNldEJib3hDaGFuZ2VkKCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuVHJpZ2dlckFzeW5jKEMzLlBsdWdpbnMuU3ByaXRlLkNuZHMuT25VUkxMb2FkZWQpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFNldENvbGxpc2lvbnMoZSkgewogICAgICAgICAgICAgICAgdGhpcy5HZXRXb3JsZEluZm8oKS5TZXRDb2xsaXNpb25FbmFibGVkKGUpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFNldFNvbGlkQ29sbGlzaW9uRmlsdGVyKG1vZGUsIHRhZ3MpIHsKICAgICAgICAgICAgICAgIHRoaXMuR2V0V29ybGRJbmZvKCkuU2V0U29saWRDb2xsaXNpb25GaWx0ZXIobW9kZSA9PT0KICAgICAgICAgICAgICAgICAgICAwLCB0YWdzKQogICAgICAgICAgICB9LAogICAgICAgICAgICBTZXRFZmZlY3QoZWZmZWN0KSB7CiAgICAgICAgICAgICAgICB0aGlzLkdldFdvcmxkSW5mbygpLlNldEJsZW5kTW9kZShlZmZlY3QpOwogICAgICAgICAgICAgICAgdGhpcy5fcnVudGltZS5VcGRhdGVSZW5kZXIoKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSB7CiAgICAgICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgICAgIEMzLlBsdWdpbnMuU3ByaXRlLkV4cHMgPSB7CiAgICAgICAgICAgIEFuaW1hdGlvbkZyYW1lKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2N1cnJlbnRGcmFtZUluZGV4CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIEFuaW1hdGlvbkZyYW1lQ291bnQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fY3VycmVudEFuaW1hdGlvbi5HZXRGcmFtZUNvdW50KCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgQW5pbWF0aW9uTmFtZSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9jdXJyZW50QW5pbWF0aW9uLkdldE5hbWUoKQogICAgICAgICAgICB9LAogICAgICAgICAgICBBbmltYXRpb25TcGVlZCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9HZXRBbmltU3BlZWQoKQogICAgICAgICAgICB9LAogICAgICAgICAgICBPcmlnaW5hbEFuaW1hdGlvblNwZWVkKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2N1cnJlbnRBbmltYXRpb24uR2V0U3BlZWQoKQogICAgICAgICAgICB9LAogICAgICAgICAgICBJbWFnZVBvaW50WChpbWdwdCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuR2V0SW1hZ2VQb2ludChpbWdwdClbMF0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgSW1hZ2VQb2ludFkoaW1ncHQpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLkdldEltYWdlUG9pbnQoaW1ncHQpWzFdCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIEltYWdlUG9pbnRaKGltZ3B0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5HZXRJbWFnZVBvaW50KGltZ3B0KVsyXQogICAgICAgICAgICB9LAogICAgICAgICAgICBJbWFnZVBvaW50Q291bnQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5HZXRJbWFnZVBvaW50Q291bnQoKQogICAgICAgICAgICB9LAogICAgICAgICAgICBJbWFnZVdpZHRoKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuR2V0Q3VycmVudEltYWdlSW5mbygpLkdldFdpZHRoKCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgSW1hZ2VIZWlnaHQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5HZXRDdXJyZW50SW1hZ2VJbmZvKCkuR2V0SGVpZ2h0KCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgUG9seVBvaW50WEF0KGkpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLkdldENvbGxpc2lvblBvbHlQb2ludChpKVswXQogICAgICAgICAgICB9LAogICAgICAgICAgICBQb2x5UG9pbnRZQXQoaSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuR2V0Q29sbGlzaW9uUG9seVBvaW50KGkpWzFdCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFBvbHlQb2ludENvdW50KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuR2V0Q29sbGlzaW9uUG9seVBvaW50Q291bnQoKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKCn0KCnsKICAgICd1c2Ugc3RyaWN0JzsgewogICAgICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgICAgICBDMy5QbHVnaW5zLlBhcnRpY2xlcyA9IGNsYXNzIFBhcnRpY2xlc1BsdWdpbiBleHRlbmRzIEMzLlNES1BsdWdpbkJhc2UgewogICAgICAgICAgICBjb25zdHJ1Y3RvcihvcHRzKSB7CiAgICAgICAgICAgICAgICBzdXBlcihvcHRzKQogICAgICAgICAgICB9CiAgICAgICAgICAgIFJlbGVhc2UoKSB7CiAgICAgICAgICAgICAgICBzdXBlci5SZWxlYXNlKCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gewogICAgICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgICAgICBDMy5QbHVnaW5zLlBhcnRpY2xlcy5UeXBlID0gY2xhc3MgUGFydGljbGVzVHlwZSBleHRlbmRzIEMzLlNES1R5cGVCYXNlIHsKICAgICAgICAgICAgY29uc3RydWN0b3Iob2JqZWN0Q2xhc3MpIHsKICAgICAgICAgICAgICAgIHN1cGVyKG9iamVjdENsYXNzKQogICAgICAgICAgICB9CiAgICAgICAgICAgIFJlbGVhc2UoKSB7CiAgICAgICAgICAgICAgICBzdXBlci5SZWxlYXNlKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBPbkNyZWF0ZSgpIHsKICAgICAgICAgICAgICAgIHRoaXMuR2V0SW1hZ2VJbmZvKCkuTG9hZEFzc2V0KHRoaXMuX3J1bnRpbWUpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgTG9hZFRleHR1cmVzKHJlbmRlcmVyKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5HZXRJbWFnZUluZm8oKS5Mb2FkU3RhdGljVGV4dHVyZShyZW5kZXJlciwgewogICAgICAgICAgICAgICAgICAgIHNhbXBsaW5nOiB0aGlzLl9ydW50aW1lLkdldFNhbXBsaW5nKCkKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0KICAgICAgICAgICAgUmVsZWFzZVRleHR1cmVzKCkgewogICAgICAgICAgICAgICAgdGhpcy5HZXRJbWFnZUluZm8oKS5SZWxlYXNlVGV4dHVyZSgpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IHsKICAgICAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICAgICAgY29uc3QgQzNYID0gc2VsZi5DM1g7CiAgICAgICAgY29uc3QgUkFURSA9IDA7CiAgICAgICAgY29uc3QgU1BSQVlfQ09ORSA9IDE7CiAgICAgICAgY29uc3QgVFlQRSA9IDI7CiAgICAgICAgY29uc3QgU1BBV05PQkpFQ1RDTEFTUyA9IDM7CiAgICAgICAgY29uc3QgSU5JVElBTExZX1ZJU0lCTEUgPSA0OwogICAgICAgIGNvbnN0IFNQRUVEID0gNTsKICAgICAgICBjb25zdCBTSVpFID0gNjsKICAgICAgICBjb25zdCBPUEFDSVRZID0gNzsKICAgICAgICBjb25zdCBHUk9XX1JBVEUgPSA4OwogICAgICAgIGNvbnN0IFhfUkFORE9NSVNFUiA9IDk7CiAgICAgICAgY29uc3QgWV9SQU5ET01JU0VSID0gMTA7CiAgICAgICAgY29uc3QgSU5JVElBTF9TUEVFRF9SQU5ET01JU0VSID0gMTE7CiAgICAgICAgY29uc3QgU0laRV9SQU5ET01JU0VSID0gMTI7CiAgICAgICAgY29uc3QgR1JPV19SQVRFX1JBTkRPTUlTRVIgPSAxMzsKICAgICAgICBjb25zdCBBQ0NFTEVSQVRJT04gPSAxNDsKICAgICAgICBjb25zdCBHUkFWSVRZID0gMTU7CiAgICAgICAgY29uc3QgQU5HTEVfUkFORE9NSVNFUiA9IDE2OwogICAgICAgIGNvbnN0IExJRkVfU1BFRURfUkFORE9NSVNFUiA9IDE3OwogICAgICAgIGNvbnN0IE9QQUNJVFlfUkFORE9NSVNFUiA9IDE4OwogICAgICAgIGNvbnN0IERFU1RST1lfTU9ERSA9IDE5OwogICAgICAgIGNvbnN0IFRJTUVPVVQgPSAyMDsKICAgICAgICBjb25zdCBDT05USU5VT1VTID0KICAgICAgICAgICAgMDsKICAgICAgICBjb25zdCBPTkVfU0hPVCA9IDE7CiAgICAgICAgY29uc3QgdGVtcFJlY3QgPSBDMy5OZXcoQzMuUmVjdCk7CiAgICAgICAgQzMuUGx1Z2lucy5QYXJ0aWNsZXMuSW5zdGFuY2UgPSBjbGFzcyBQYXJ0aWNsZXNJbnN0YW5jZSBleHRlbmRzIEMzLlNES1dvcmxkSW5zdGFuY2VCYXNlIHsKICAgICAgICAgICAgY29uc3RydWN0b3IoaW5zdCwgcHJvcGVydGllcykgewogICAgICAgICAgICAgICAgc3VwZXIoaW5zdCk7CiAgICAgICAgICAgICAgICB0aGlzLl9pc0ZpcnN0VGljayA9IHRydWU7CiAgICAgICAgICAgICAgICBjb25zdCBwZSA9IEMzLk5ldyhzZWxmLlBhcnRpY2xlRW5naW5lKTsKICAgICAgICAgICAgICAgIHRoaXMuX3BhcnRpY2xlRW5naW5lID0gcGU7CiAgICAgICAgICAgICAgICBwZS5vbm9uZXNob3RmaW5pc2ggPSAoKSA9PiB0aGlzLl9Pbk9uZVNob3RGaW5pc2goKTsKICAgICAgICAgICAgICAgIHRoaXMuX3NwYXduT2JqZWN0Q2xhc3MgPSBudWxsOwogICAgICAgICAgICAgICAgdGhpcy5fcGFydGljbGVVcGRhdGVDYWxsYmFjayA9IChpbnN0LCBkeCwgZHksIGRTaXplLCBkQW5nbGUsIGRPcGFjaXR5KSA9PiB0aGlzLl9PblBhcnRpY2xlVXBkYXRlKGluc3QsIGR4LCBkeSwgZFNpemUsIGRBbmdsZSwgZE9wYWNpdHkpOwogICAgICAgICAgICAgICAgdGhpcy5fcGFydGljbGVEZXN0cm95Q2FsbGJhY2sgPSBpbnN0ID0+IHRoaXMuX09uUGFydGljbGVEZXN0cm95KGluc3QpOwogICAgICAgICAgICAgICAgdGhpcy5faGFzQW55RGVmYXVsdFBhcnRpY2xlID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGxldCBpc0luaXRpYWxseVZpc2libGUgPSB0cnVlOwogICAgICAgICAgICAgICAgaWYgKHByb3BlcnRpZXMpIHsKICAgICAgICAgICAgICAgICAgICBwZS5TZXRSYXRlKHByb3BlcnRpZXNbUkFURV0pOwogICAgICAgICAgICAgICAgICAgIHBlLlNldFNwcmF5Q29uZShDMy50b1JhZGlhbnMocHJvcGVydGllc1tTUFJBWV9DT05FXSkpOwogICAgICAgICAgICAgICAgICAgIHBlLlNldFNwcmF5VHlwZShwcm9wZXJ0aWVzW1RZUEVdID8gIm9uZS1zaG90IiA6ICJjb250aW51b3VzLXNwcmF5Iik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fU2V0UGFydGljbGVPYmplY3RDbGFzcyh0aGlzLl9ydW50aW1lLkdldE9iamVjdENsYXNzQnlTSUQocHJvcGVydGllc1tTUEFXTk9CSkVDVENMQVNTXSkpOwogICAgICAgICAgICAgICAgICAgIGlzSW5pdGlhbGx5VmlzaWJsZSA9IHByb3BlcnRpZXNbSU5JVElBTExZX1ZJU0lCTEVdOwogICAgICAgICAgICAgICAgICAgIHBlLlNldEluaXRTcGVlZChwcm9wZXJ0aWVzW1NQRUVEXSk7CiAgICAgICAgICAgICAgICAgICAgcGUuU2V0SW5pdFNpemUocHJvcGVydGllc1tTSVpFXSk7CiAgICAgICAgICAgICAgICAgICAgcGUuU2V0SW5pdE9wYWNpdHkocHJvcGVydGllc1tPUEFDSVRZXSAvIDEwMCk7CiAgICAgICAgICAgICAgICAgICAgcGUuU2V0R3Jvd1JhdGUocHJvcGVydGllc1tHUk9XX1JBVEVdKTsKICAgICAgICAgICAgICAgICAgICBwZS5TZXRJbml0WFJhbmRvbShwcm9wZXJ0aWVzW1hfUkFORE9NSVNFUl0pOwogICAgICAgICAgICAgICAgICAgIHBlLlNldEluaXRZUmFuZG9tKHByb3BlcnRpZXNbWV9SQU5ET01JU0VSXSk7CiAgICAgICAgICAgICAgICAgICAgcGUuU2V0SW5pdFNwZWVkUmFuZG9tKHByb3BlcnRpZXNbSU5JVElBTF9TUEVFRF9SQU5ET01JU0VSXSk7CiAgICAgICAgICAgICAgICAgICAgcGUuU2V0SW5pdFNpemVSYW5kb20ocHJvcGVydGllc1tTSVpFX1JBTkRPTUlTRVJdKTsKICAgICAgICAgICAgICAgICAgICBwZS5TZXRHcm93UmFuZG9tKHByb3BlcnRpZXNbR1JPV19SQVRFX1JBTkRPTUlTRVJdKTsKICAgICAgICAgICAgICAgICAgICBwZS5TZXRBY2NlbGVyYXRpb24ocHJvcGVydGllc1tBQ0NFTEVSQVRJT05dKTsKICAgICAgICAgICAgICAgICAgICBwZS5TZXRHcmF2aXR5KHByb3BlcnRpZXNbR1JBVklUWV0pOwogICAgICAgICAgICAgICAgICAgIHBlLlNldExpZmVBbmdsZVJhbmRvbShwcm9wZXJ0aWVzW0FOR0xFX1JBTkRPTUlTRVJdKTsKICAgICAgICAgICAgICAgICAgICBwZS5TZXRMaWZlU3BlZWRSYW5kb20ocHJvcGVydGllc1tMSUZFX1NQRUVEX1JBTkRPTUlTRVJdKTsKICAgICAgICAgICAgICAgICAgICBwZS5TZXRMaWZlT3BhY2l0eVJhbmRvbShwcm9wZXJ0aWVzW09QQUNJVFlfUkFORE9NSVNFUl0pOwogICAgICAgICAgICAgICAgICAgIHBlLlNldERlc3Ryb3lNb2RlSW5kZXgocHJvcGVydGllc1tERVNUUk9ZX01PREVdKTsKICAgICAgICAgICAgICAgICAgICBwZS5TZXRUaW1lb3V0KHByb3BlcnRpZXNbVElNRU9VVF0pCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLl9VcGRhdGVFbmdpbmVQYXJhbWV0ZXJzKCk7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fc3Bhd25PYmplY3RDbGFzcykgdGhpcy5faGFzQW55RGVmYXVsdFBhcnRpY2xlID0gZmFsc2U7CiAgICAgICAgICAgICAgICBpZiAocGUuR2V0U3ByYXlUeXBlKCkgPT09ICJvbmUtc2hvdCIpIHBlLkNyZWF0ZU9uZVNob3RTcHJheSgpOwogICAgICAgICAgICAgICAgZWxzZSBwZS5TZXRTcHJheWluZyh0cnVlKTsKICAgICAgICAgICAgICAgIGNvbnN0IHdpID0gdGhpcy5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgICAgIHdpLlNldFZpc2libGUoaXNJbml0aWFsbHlWaXNpYmxlKTsKICAgICAgICAgICAgICAgIHdpLlNldEJib3hDaGFuZ2VFdmVudEVuYWJsZWQodHJ1ZSk7CiAgICAgICAgICAgICAgICB0aGlzLl9pbnN0LkRpc3BhdGNoZXIoKS5hZGRFdmVudExpc3RlbmVyKCJiYm94Y2hhbmdlIiwgKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHdpLk92ZXJ3cml0ZUJvdW5kaW5nQm94KHRoaXMuX3BhcnRpY2xlRW5naW5lLkdldEJvdW5kaW5nQm94KCkpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLkdldFJ1bnRpbWUoKS5HZXRSZW5kZXJlcigpLklzV2ViR1BVKCkpIHdpLlNldFVzZVBvaW50c1NoYWRlclByb2dyYW0oKTsKICAgICAgICAgICAgICAgIHRoaXMuX2FmdGVyTG9hZCA9IGUgPT4gdGhpcy5fT25BZnRlckxvYWQoZSk7CiAgICAgICAgICAgICAgICB0aGlzLkdldFJ1bnRpbWUoKS5EaXNwYXRjaGVyKCkuYWRkRXZlbnRMaXN0ZW5lcigiYWZ0ZXJsb2FkIiwgdGhpcy5fYWZ0ZXJMb2FkKTsKICAgICAgICAgICAgICAgIHRoaXMuX1N0YXJ0VGlja2luZygpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgUmVsZWFzZSgpIHsKICAgICAgICAgICAgICAgIHRoaXMuR2V0UnVudGltZSgpLkRpc3BhdGNoZXIoKS5yZW1vdmVFdmVudExpc3RlbmVyKCJhZnRlcmxvYWQiLCB0aGlzLl9hZnRlckxvYWQpOwogICAgICAgICAgICAgICAgdGhpcy5fYWZ0ZXJMb2FkID0gbnVsbDsKICAgICAgICAgICAgICAgIHRoaXMuX3BhcnRpY2xlRW5naW5lLlJlbGVhc2UoKTsKICAgICAgICAgICAgICAgIHRoaXMuX3BhcnRpY2xlRW5naW5lID0gbnVsbDsKICAgICAgICAgICAgICAgIHRoaXMuX3BhcnRpY2xlVXBkYXRlQ2FsbGJhY2sgPSBudWxsOwogICAgICAgICAgICAgICAgdGhpcy5fcGFydGljbGVEZXN0cm95Q2FsbGJhY2sgPSBudWxsOwogICAgICAgICAgICAgICAgc3VwZXIuUmVsZWFzZSgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgR2V0UGFydGljbGVFbmdpbmUoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcGFydGljbGVFbmdpbmUKICAgICAgICAgICAgfQogICAgICAgICAgICBfU2V0UmF0ZShyKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9wYXJ0aWNsZUVuZ2luZS5TZXRSYXRlKHIpOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuX3BhcnRpY2xlRW5naW5lLkdldFNwcmF5VHlwZSgpID09PQogICAgICAgICAgICAgICAgICAgICJvbmUtc2hvdCIgJiYgdGhpcy5faXNGaXJzdFRpY2spIHRoaXMuX3BhcnRpY2xlRW5naW5lLlNldFBhcnRpY2xlQ291bnQocikKICAgICAgICAgICAgfQogICAgICAgICAgICBfU2V0UGFydGljbGVPYmplY3RDbGFzcyhvYmplY3RDbGFzcykgewogICAgICAgICAgICAgICAgaWYgKG9iamVjdENsYXNzID09PSB0aGlzLkdldE9iamVjdENsYXNzKCkpIG9iamVjdENsYXNzID0gbnVsbDsKICAgICAgICAgICAgICAgIGlmIChvYmplY3RDbGFzcyA9PT0gdGhpcy5fc3Bhd25PYmplY3RDbGFzcykgcmV0dXJuOwogICAgICAgICAgICAgICAgdGhpcy5fc3Bhd25PYmplY3RDbGFzcyA9IG9iamVjdENsYXNzOwogICAgICAgICAgICAgICAgdGhpcy5fcGFydGljbGVFbmdpbmUub25wYXJ0aWNsZWNyZWF0ZSA9IG9iamVjdENsYXNzID8gcCA9PiB0aGlzLl9PblBhcnRpY2xlQ3JlYXRlKHApIDogbnVsbDsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5fc3Bhd25PYmplY3RDbGFzcykgdGhpcy5faGFzQW55RGVmYXVsdFBhcnRpY2xlID0gdHJ1ZQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9VcGRhdGVFbmdpbmVQYXJhbWV0ZXJzKCkgewogICAgICAgICAgICAgICAgY29uc3QgcGUgPSB0aGlzLl9wYXJ0aWNsZUVuZ2luZTsKICAgICAgICAgICAgICAgIGNvbnN0IHdpID0gdGhpcy5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgICAgIHBlLlNldE1hc3Rlck9wYWNpdHkod2kuR2V0T3BhY2l0eSgpKTsKICAgICAgICAgICAgICAgIHBlLlNldFBpeGVsUm91bmRpbmcodGhpcy5fcnVudGltZS5Jc1BpeGVsUm91bmRpbmdFbmFibGVkKCkpOwogICAgICAgICAgICAgICAgcGUuU2V0U3Bhd25YKHdpLkdldFgoKSk7CiAgICAgICAgICAgICAgICBwZS5TZXRTcGF3blkod2kuR2V0WSgpKTsKICAgICAgICAgICAgICAgIHBlLlNldFNwYXduQW5nbGUod2kuR2V0QW5nbGUoKSk7CiAgICAgICAgICAgICAgICBwZS5TZXRJbml0U2l6ZVNjYWxlKE1hdGguYWJzKHdpLkdldFNjZW5lR3JhcGhTY2FsZSgpKSkKICAgICAgICAgICAgfQogICAgICAgICAgICBfT25PbmVTaG90RmluaXNoKCkgewogICAgICAgICAgICAgICAgdGhpcy5fcnVudGltZS5EZXN0cm95SW5zdGFuY2UodGhpcy5faW5zdCkKICAgICAgICAgICAgfQogICAgICAgICAgICBEcmF3KHJlbmRlcmVyKSB7CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX2hhc0FueURlZmF1bHRQYXJ0aWNsZSkgcmV0dXJuOwogICAgICAgICAgICAgICAgY29uc3QgaW1hZ2VJbmZvID0gdGhpcy5fb2JqZWN0Q2xhc3MuR2V0SW1hZ2VJbmZvKCk7CiAgICAgICAgICAgICAgICBjb25zdCB0ZXh0dXJlID0gaW1hZ2VJbmZvLkdldFRleHR1cmUoKTsKICAgICAgICAgICAgICAgIGlmICghdGV4dHVyZSkgcmV0dXJuOwogICAgICAgICAgICAgICAgY29uc3Qgd2kgPSB0aGlzLkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICAgICAgY29uc3QgbGF5ZXIgPSB3aS5HZXRMYXllcigpOwogICAgICAgICAgICAgICAgY29uc3Qgdmlld3BvcnQgPSB0ZW1wUmVjdDsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9ydW50aW1lLkdldENhbnZhc01hbmFnZXIoKS5Jc1Bhc3RpbmdUb0RyYXdpbmdDYW52YXMoKSkgdmlld3BvcnQuc2V0KC1JbmZpbml0eSwgLUluZmluaXR5LCBJbmZpbml0eSwgSW5maW5pdHkpOwogICAgICAgICAgICAgICAgZWxzZSBpZiAobGF5ZXIuSGFzM0RDYW1lcmEoKSkgbGF5ZXIuQ2FsY3VsYXRlVmlld3BvcnQzRCh3aS5HZXRUb3RhbFpFbGV2YXRpb24oKSwgdmlld3BvcnQpOwogICAgICAgICAgICAgICAgZWxzZSBsYXllci5HZXRWaWV3cG9ydEZvclood2kuR2V0VG90YWxaRWxldmF0aW9uKCksIHZpZXdwb3J0KTsKICAgICAgICAgICAgICAgIHJlbmRlcmVyLlNldFRleHR1cmUodGV4dHVyZSk7CiAgICAgICAgICAgICAgICBjb25zdCB6U2NhbGVGYWN0b3IgPSBsYXllci5HZXQyRFNjYWxlRmFjdG9yVG9aKHdpLkdldFRvdGFsWkVsZXZhdGlvbigpKTsKICAgICAgICAgICAgICAgIHRoaXMuX3BhcnRpY2xlRW5naW5lLlNldFBhcnRpY2xlU2NhbGUobGF5ZXIuR2V0UmVuZGVyU2NhbGUoKSAqIHpTY2FsZUZhY3Rvcik7CiAgICAgICAgICAgICAgICB0aGlzLl9wYXJ0aWNsZUVuZ2luZS5EcmF3KHJlbmRlcmVyLCBpbWFnZUluZm8uR2V0VGV4UXVhZCgpLCB2aWV3cG9ydCwgbGF5ZXIuSGFzM0RDYW1lcmEoKSkKICAgICAgICAgICAgfQogICAgICAgICAgICBTYXZlVG9Kc29uKCkgewogICAgICAgICAgICAgICAgY29uc3QgcGUgPSB0aGlzLl9wYXJ0aWNsZUVuZ2luZTsKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgInIiOiBwZS5HZXRSYXRlKCksCiAgICAgICAgICAgICAgICAgICAgInNjIjogcGUuR2V0U3ByYXlDb25lKCksCiAgICAgICAgICAgICAgICAgICAgInN0IjogcGUuR2V0U3ByYXlUeXBlKCksCiAgICAgICAgICAgICAgICAgICAgImlzcCI6IHBlLkdldEluaXRTcGVlZCgpLAogICAgICAgICAgICAgICAgICAgICJpc3oiOiBwZS5HZXRJbml0U2l6ZSgpLAogICAgICAgICAgICAgICAgICAgICJpbyI6IHBlLkdldEluaXRPcGFjaXR5KCksCiAgICAgICAgICAgICAgICAgICAgImdyIjogcGUuR2V0R3Jvd1JhdGUoKSwKICAgICAgICAgICAgICAgICAgICAieHIiOiBwZS5HZXRJbml0WFJhbmRvbSgpLAogICAgICAgICAgICAgICAgICAgICJ5ciI6IHBlLkdldEluaXRZUmFuZG9tKCksCiAgICAgICAgICAgICAgICAgICAgInNwciI6IHBlLkdldEluaXRTcGVlZFJhbmRvbSgpLAogICAgICAgICAgICAgICAgICAgICJzenIiOiBwZS5HZXRJbml0U2l6ZVJhbmRvbSgpLAogICAgICAgICAgICAgICAgICAgICJncm5kIjogcGUuR2V0R3Jvd1JhbmRvbSgpLAogICAgICAgICAgICAgICAgICAgICJhY2MiOiBwZS5HZXRBY2NlbGVyYXRpb24oKSwKICAgICAgICAgICAgICAgICAgICAiZyI6IHBlLkdldEdyYXZpdHkoKSwKICAgICAgICAgICAgICAgICAgICAibGFyIjogcGUuR2V0TGlmZUFuZ2xlUmFuZG9tKCksCiAgICAgICAgICAgICAgICAgICAgImxzciI6IHBlLkdldExpZmVTcGVlZFJhbmRvbSgpLAogICAgICAgICAgICAgICAgICAgICJsb3IiOiBwZS5HZXRMaWZlT3BhY2l0eVJhbmRvbSgpLAogICAgICAgICAgICAgICAgICAgICJkbSI6IHBlLkdldERlc3Ryb3lNb2RlSW5kZXgoKSwKICAgICAgICAgICAgICAgICAgICAidG8iOiBwZS5HZXRUaW1lb3V0KCksCiAgICAgICAgICAgICAgICAgICAgInMiOiBwZS5Jc1NwcmF5aW5nKCksCiAgICAgICAgICAgICAgICAgICAgInBjYyI6IHBlLl9HZXRDcmVhdGVDb3VudGVyKCksCiAgICAgICAgICAgICAgICAgICAgImZ0IjogdGhpcy5faXNGaXJzdFRpY2ssCiAgICAgICAgICAgICAgICAgICAgInNvYyI6IHRoaXMuX3NwYXduT2JqZWN0Q2xhc3MgPyB0aGlzLl9zcGF3bk9iamVjdENsYXNzLkdldFNJRCgpIDogbnVsbCwKICAgICAgICAgICAgICAgICAgICAicCI6IHBlLkdldFBhcnRpY2xlcygpLm1hcChwID0+IHAudG9KU09OKCkpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgTG9hZEZyb21Kc29uKG8sIG1vZGUpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHBlID0gdGhpcy5fcGFydGljbGVFbmdpbmU7CiAgICAgICAgICAgICAgICBwZS5TZXRSYXRlKG9bInIiXSk7CiAgICAgICAgICAgICAgICBwZS5TZXRTcHJheUNvbmUob1sic2MiXSk7CiAgICAgICAgICAgICAgICBwZS5TZXRTcHJheVR5cGUob1sic3QiXSk7CiAgICAgICAgICAgICAgICBwZS5TZXRJbml0U3BlZWQob1siaXNwIl0pOwogICAgICAgICAgICAgICAgcGUuU2V0SW5pdFNpemUob1siaXN6Il0pOwogICAgICAgICAgICAgICAgcGUuU2V0SW5pdE9wYWNpdHkob1siaW8iXSk7CiAgICAgICAgICAgICAgICBwZS5TZXRHcm93UmF0ZShvWyJnciJdKTsKICAgICAgICAgICAgICAgIHBlLlNldEluaXRYUmFuZG9tKG9bInhyIl0pOwogICAgICAgICAgICAgICAgcGUuU2V0SW5pdFlSYW5kb20ob1sieXIiXSk7CiAgICAgICAgICAgICAgICBwZS5TZXRJbml0U3BlZWRSYW5kb20ob1sic3ByIl0pOwogICAgICAgICAgICAgICAgcGUuU2V0SW5pdFNpemVSYW5kb20ob1sic3pyIl0pOwogICAgICAgICAgICAgICAgcGUuU2V0R3Jvd1JhbmRvbShvWyJncm5kIl0pOwogICAgICAgICAgICAgICAgcGUuU2V0QWNjZWxlcmF0aW9uKG9bImFjYyJdKTsKICAgICAgICAgICAgICAgIHBlLlNldEdyYXZpdHkob1siZyJdKTsKICAgICAgICAgICAgICAgIHBlLlNldExpZmVBbmdsZVJhbmRvbShvWyJsYXIiXSk7CiAgICAgICAgICAgICAgICBwZS5TZXRMaWZlU3BlZWRSYW5kb20ob1sibHNyIl0pOwogICAgICAgICAgICAgICAgcGUuU2V0TGlmZU9wYWNpdHlSYW5kb20ob1sibG9yIl0pOwogICAgICAgICAgICAgICAgcGUuU2V0RGVzdHJveU1vZGVJbmRleChvWyJkbSJdKTsKICAgICAgICAgICAgICAgIHBlLlNldFRpbWVvdXQob1sidG8iXSk7CiAgICAgICAgICAgICAgICBwZS5TZXRTcHJheWluZyhvWyJzIl0pOwogICAgICAgICAgICAgICAgcGUuX1NldENyZWF0ZUNvdW50ZXIob1sicGNjIl0pOwogICAgICAgICAgICAgICAgdGhpcy5faXNGaXJzdFRpY2sgPSBvWyJmdCJdOwogICAgICAgICAgICAgICAgaWYgKG8uaGFzT3duUHJvcGVydHkoInNvYyIpKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgb2JqZWN0Q2xhc3MgPSB0aGlzLkdldFJ1bnRpbWUoKS5HZXRPYmplY3RDbGFzc0J5U0lEKG9bInNvYyJdKTsKICAgICAgICAgICAgICAgICAgICBpZiAob2JqZWN0Q2xhc3MpIHRoaXMuX1NldFBhcnRpY2xlT2JqZWN0Q2xhc3Mob2JqZWN0Q2xhc3MpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjb25zdCBwYXJ0aWNsZXNEYXRhID0gb1sicCJdOwogICAgICAgICAgICAgICAgcGUuU2V0UGFydGljbGVDb3VudChwYXJ0aWNsZXNEYXRhLmxlbmd0aCk7CiAgICAgICAgICAgICAgICBjb25zdCBwYXJ0aWNsZXMgPSBwZS5HZXRQYXJ0aWNsZXMoKTsKICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBwYXJ0aWNsZXMubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHBhcnRpY2xlc1tpXS5zZXRGcm9tSlNPTihwYXJ0aWNsZXNEYXRhW2ldKTsKICAgICAgICAgICAgICAgIGlmIChtb2RlID09PSAic3RhdGUiICYmIHRoaXMuX3NwYXduT2JqZWN0Q2xhc3MpIHsKICAgICAgICAgICAgICAgICAgICBwZS5VcGRhdGVBbGxQYXJ0aWNsZXNVc2VyRGF0YSgpOwogICAgICAgICAgICAgICAgICAgIHBlLkFwcGx5UGFydGljbGVEYXRhVG9Vc2VyRGF0YSh0aGlzKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9PbkFmdGVyTG9hZCgpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHBlID0gdGhpcy5fcGFydGljbGVFbmdpbmU7CiAgICAgICAgICAgICAgICBwZS5VcGRhdGVBbGxQYXJ0aWNsZXNVc2VyRGF0YSgpOwogICAgICAgICAgICAgICAgcGUuQXBwbHlQYXJ0aWNsZURhdGFUb1VzZXJEYXRhKHRoaXMpOwogICAgICAgICAgICAgICAgaWYgKHBlLkdldFNwcmF5VHlwZSgpICE9PSAib25lLXNob3QiKSByZXR1cm47CiAgICAgICAgICAgICAgICBjb25zdCBwYXJ0aWNsZXMgPSBwZS5HZXRQYXJ0aWNsZXMoKTsKICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBwYXJ0aWNsZXMubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBwYXJ0aWNsZSA9IHBhcnRpY2xlc1tpXTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50VXNlckRhdGEgPSBwYXJ0aWNsZS5HZXRVc2VyRGF0YSgpOwogICAgICAgICAgICAgICAgICAgIGlmICghY3VycmVudFVzZXJEYXRhKSBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICBjb25zdCB3b3JsZEluZm8gPSBjdXJyZW50VXNlckRhdGEuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCF3b3JsZEluZm8pIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGluc3RhbmNlID0gd29ybGRJbmZvLkdldEluc3RhbmNlKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFpbnN0YW5jZSkgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2F2ZWRVaWQgPSBwYXJ0aWNsZS5HZXRVc2VyRGF0YVVJRCgpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRVaWQgPSBpbnN0YW5jZS5HZXRVSUQoKTsKICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHNhdmVkVWlkID09PSAibnVtYmVyIiAmJiB0eXBlb2YgY3VycmVudFVpZCA9PT0gIm51bWJlciIgJiYgc2F2ZWRVaWQgPT09IGN1cnJlbnRVaWQpIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJ1bnRpbWUgPSB0aGlzLkdldFJ1bnRpbWUoKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBpbnN0ID0gcnVudGltZS5HZXRJbnN0YW5jZUJ5VUlEKHNhdmVkVWlkKTsKICAgICAgICAgICAgICAgICAgICBpZiAoaW5zdCkgcnVudGltZS5EZXN0cm95SW5zdGFuY2UoaW5zdCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBUaWNrKCkgewogICAgICAgICAgICAgICAgY29uc3QgZHQgPSB0aGlzLl9ydW50aW1lLkdldER0KHRoaXMuX2luc3QpOwogICAgICAgICAgICAgICAgdGhpcy5fVXBkYXRlRW5naW5lUGFyYW1ldGVycygpOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuX2lzRmlyc3RUaWNrICYmIHRoaXMuX3BhcnRpY2xlRW5naW5lLkdldFNwcmF5VHlwZSgpID09PSAib25lLXNob3QiKSB0aGlzLl9wYXJ0aWNsZUVuZ2luZS5SZUluaXRBbGxQYXJ0aWNsZXMoKTsKICAgICAgICAgICAgICAgIHRoaXMuX3BhcnRpY2xlRW5naW5lLlRpY2soZHQpOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuX3BhcnRpY2xlRW5naW5lLklzU3ByYXlpbmcoKSkgdGhpcy5fcnVudGltZS5VcGRhdGVSZW5kZXIoKTsKICAgICAgICAgICAgICAgIHRoaXMuR2V0V29ybGRJbmZvKCkuU2V0QmJveENoYW5nZWQoKTsKICAgICAgICAgICAgICAgIHRoaXMuX2lzRmlyc3RUaWNrID0gZmFsc2UKICAgICAgICAgICAgfQogICAgICAgICAgICBfRmFzdEZvcndhcmQodGltZSkgewogICAgICAgICAgICAgICAgY29uc3QgRkZfRFQgPSAxIC8gNjA7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5faXNGaXJzdFRpY2sgJiYgdGhpcy5fcGFydGljbGVFbmdpbmUuR2V0U3ByYXlUeXBlKCkgPT09ICJvbmUtc2hvdCIpIHRoaXMuX3BhcnRpY2xlRW5naW5lLlJlSW5pdEFsbFBhcnRpY2xlcygpOwogICAgICAgICAgICAgICAgd2hpbGUgKHRpbWUgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcGFydGljbGVFbmdpbmUuVGljayhGRl9EVCk7CiAgICAgICAgICAgICAgICAgICAgdGltZSAtPSBGRl9EVAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHRoaXMuX3BhcnRpY2xlRW5naW5lLklzU3ByYXlpbmcoKSkgdGhpcy5fcnVudGltZS5VcGRhdGVSZW5kZXIoKTsKICAgICAgICAgICAgICAgIHRoaXMuR2V0V29ybGRJbmZvKCkuU2V0QmJveENoYW5nZWQoKTsKICAgICAgICAgICAgICAgIHRoaXMuX2lzRmlyc3RUaWNrID0gZmFsc2UKICAgICAgICAgICAgfQogICAgICAgICAgICBfT25QYXJ0aWNsZUNyZWF0ZShwKSB7CiAgICAgICAgICAgICAgICBjb25zdCBpbnN0ID0gdGhpcy5fcnVudGltZS5DcmVhdGVJbnN0YW5jZSh0aGlzLl9zcGF3bk9iamVjdENsYXNzLCB0aGlzLkdldFdvcmxkSW5mbygpLkdldExheWVyKCksIHAuR2V0WCgpLCBwLkdldFkoKSk7CiAgICAgICAgICAgICAgICBjb25zdCB3aSA9IGluc3QuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgICAgICB3aS5TZXRTaXplKHAuR2V0U2l6ZSgpLCBwLkdldFNpemUoKSk7CiAgICAgICAgICAgICAgICB3aS5TZXRBbmdsZShwLkdldEFuZ2xlKCkpOwogICAgICAgICAgICAgICAgd2kuU2V0T3BhY2l0eShwLkdldE9wYWNpdHkoKSk7CiAgICAgICAgICAgICAgICB3aS5TZXRVbnByZW11bHRpcGxpZWRDb2xvcih0aGlzLkdldFdvcmxkSW5mbygpLkdldFVucHJlbXVsdGlwbGllZENvbG9yKCkpOwogICAgICAgICAgICAgICAgd2kuU2V0QmJveENoYW5nZWQoKTsKICAgICAgICAgICAgICAgIHdpLlpPcmRlck1vdmVBZGphY2VudFRvSW5zdGFuY2UodGhpcy5HZXRJbnN0YW5jZSgpLCB0cnVlKTsKICAgICAgICAgICAgICAgIGluc3QuX1RyaWdnZXJPbkNyZWF0ZWQoKTsKICAgICAgICAgICAgICAgIHAuU2V0VXBkYXRlQ2FsbGJhY2sodGhpcy5fcGFydGljbGVVcGRhdGVDYWxsYmFjayk7CiAgICAgICAgICAgICAgICBwLlNldERlc3Ryb3lDYWxsYmFjayh0aGlzLl9wYXJ0aWNsZURlc3Ryb3lDYWxsYmFjayk7CiAgICAgICAgICAgICAgICByZXR1cm4gaW5zdAogICAgICAgICAgICB9CiAgICAgICAgICAgIF9PblBhcnRpY2xlVXBkYXRlKGluc3QsIGR4LCBkeSwgZFNpemUsIGRBbmdsZSwgZE9wYWNpdHkpIHsKICAgICAgICAgICAgICAgIGlmIChpbnN0LklzRGVzdHJveWVkKCkpIHJldHVybjsKICAgICAgICAgICAgICAgIGNvbnN0IHdpID0gaW5zdC5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgICAgIHdpLk9mZnNldFhZKGR4LCBkeSk7CiAgICAgICAgICAgICAgICB3aS5TZXRTaXplKHdpLkdldFdpZHRoKCkgKyBkU2l6ZSwgd2kuR2V0SGVpZ2h0KCkgKyBkU2l6ZSk7CiAgICAgICAgICAgICAgICB3aS5TZXRBbmdsZSh3aS5HZXRBbmdsZSgpICsgZEFuZ2xlKTsKICAgICAgICAgICAgICAgIHdpLlNldE9wYWNpdHkod2kuR2V0T3BhY2l0eSgpICsgZE9wYWNpdHkpOwogICAgICAgICAgICAgICAgd2kuU2V0QmJveENoYW5nZWQoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9PblBhcnRpY2xlRGVzdHJveShpbnN0KSB7CiAgICAgICAgICAgICAgICBpZiAoaW5zdC5Jc0Rlc3Ryb3llZCgpKSByZXR1cm47CiAgICAgICAgICAgICAgICB0aGlzLl9ydW50aW1lLkRlc3Ryb3lJbnN0YW5jZShpbnN0KQogICAgICAgICAgICB9CiAgICAgICAgICAgIEdldFByb3BlcnR5VmFsdWVCeUluZGV4KGluZGV4KSB7CiAgICAgICAgICAgICAgICBjb25zdCBwZSA9IHRoaXMuX3BhcnRpY2xlRW5naW5lOwogICAgICAgICAgICAgICAgc3dpdGNoIChpbmRleCkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgUkFURToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBlLkdldFJhdGUoKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIFNQUkFZX0NPTkU6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBDMy50b0RlZ3JlZXMocGUuR2V0U3ByYXlDb25lKCkpOwogICAgICAgICAgICAgICAgICAgIGNhc2UgVFlQRToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBlLkdldFNwcmF5VHlwZSgpID09PSAib25lLXNob3QiID8gT05FX1NIT1QgOiBDT05USU5VT1VTOwogICAgICAgICAgICAgICAgICAgIGNhc2UgU1BFRUQ6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwZS5HZXRJbml0U3BlZWQoKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIFNJWkU6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwZS5HZXRJbml0U2l6ZSgpOwogICAgICAgICAgICAgICAgICAgIGNhc2UgT1BBQ0lUWToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBlLkdldEluaXRPcGFjaXR5KCkgKiAxMDA7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBHUk9XX1JBVEU6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwZS5HZXRHcm93UmF0ZSgpOwogICAgICAgICAgICAgICAgICAgIGNhc2UgWF9SQU5ET01JU0VSOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGUuR2V0SW5pdFhSYW5kb20oKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIFlfUkFORE9NSVNFUjoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBlLkdldEluaXRZUmFuZG9tKCk7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBJTklUSUFMX1NQRUVEX1JBTkRPTUlTRVI6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwZS5HZXRJbml0U3BlZWRSYW5kb20oKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIFNJWkVfUkFORE9NSVNFUjoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBlLkdldEluaXRTaXplUmFuZG9tKCk7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBHUk9XX1JBVEVfUkFORE9NSVNFUjoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBlLkdldEdyb3dSYW5kb20oKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIEFDQ0VMRVJBVElPTjoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBlLkdldEFjY2VsZXJhdGlvbigpOwogICAgICAgICAgICAgICAgICAgIGNhc2UgR1JBVklUWToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBlLkdldEdyYXZpdHkoKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIEFOR0xFX1JBTkRPTUlTRVI6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwZS5HZXRMaWZlQW5nbGVSYW5kb20oKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIExJRkVfU1BFRURfUkFORE9NSVNFUjoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBlLkdldExpZmVTcGVlZFJhbmRvbSgpOwogICAgICAgICAgICAgICAgICAgIGNhc2UgT1BBQ0lUWV9SQU5ET01JU0VSOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGUuR2V0TGlmZU9wYWNpdHlSYW5kb20oKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIERFU1RST1lfTU9ERToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBlLkdldERlc3Ryb3lNb2RlSW5kZXgoKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIFRJTUVPVVQ6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwZS5HZXRUaW1lb3V0KCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBTZXRQcm9wZXJ0eVZhbHVlQnlJbmRleChpbmRleCwgdmFsdWUpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHBlID0gdGhpcy5fcGFydGljbGVFbmdpbmU7CiAgICAgICAgICAgICAgICBzd2l0Y2ggKGluZGV4KSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBSQVRFOgogICAgICAgICAgICAgICAgICAgICAgICBwZS5TZXRSYXRlKHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBTUFJBWV9DT05FOgogICAgICAgICAgICAgICAgICAgICAgICBwZS5TZXRTcHJheUNvbmUoQzMudG9SYWRpYW5zKHZhbHVlKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgVFlQRToKICAgICAgICAgICAgICAgICAgICAgICAgcGUuU2V0U3ByYXlUeXBlKHZhbHVlID8gIm9uZS1zaG90IiA6ICJjb250aW51b3VzLXNwcmF5Iik7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgU1BFRUQ6CiAgICAgICAgICAgICAgICAgICAgICAgIHBlLlNldEluaXRTcGVlZCh2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgU0laRToKICAgICAgICAgICAgICAgICAgICAgICAgcGUuU2V0SW5pdFNpemUodmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIE9QQUNJVFk6CiAgICAgICAgICAgICAgICAgICAgICAgIHBlLlNldEluaXRPcGFjaXR5KHZhbHVlIC8gMTAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBHUk9XX1JBVEU6CiAgICAgICAgICAgICAgICAgICAgICAgIHBlLlNldEdyb3dSYXRlKHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBYX1JBTkRPTUlTRVI6CiAgICAgICAgICAgICAgICAgICAgICAgIHBlLlNldEluaXRYUmFuZG9tKHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBZX1JBTkRPTUlTRVI6CiAgICAgICAgICAgICAgICAgICAgICAgIHBlLlNldEluaXRZUmFuZG9tKHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBJTklUSUFMX1NQRUVEX1JBTkRPTUlTRVI6CiAgICAgICAgICAgICAgICAgICAgICAgIHBlLlNldEluaXRTcGVlZFJhbmRvbSh2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgU0laRV9SQU5ET01JU0VSOgogICAgICAgICAgICAgICAgICAgICAgICBwZS5TZXRJbml0U2l6ZVJhbmRvbSh2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgR1JPV19SQVRFX1JBTkRPTUlTRVI6CiAgICAgICAgICAgICAgICAgICAgICAgIHBlLlNldEdyb3dSYW5kb20odmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIEFDQ0VMRVJBVElPTjoKICAgICAgICAgICAgICAgICAgICAgICAgcGUuU2V0QWNjZWxlcmF0aW9uKHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBHUkFWSVRZOgogICAgICAgICAgICAgICAgICAgICAgICBwZS5TZXRHcmF2aXR5KHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBBTkdMRV9SQU5ET01JU0VSOgogICAgICAgICAgICAgICAgICAgICAgICBwZS5TZXRMaWZlQW5nbGVSYW5kb20odmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIExJRkVfU1BFRURfUkFORE9NSVNFUjoKICAgICAgICAgICAgICAgICAgICAgICAgcGUuU2V0TGlmZVNwZWVkUmFuZG9tKHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBPUEFDSVRZX1JBTkRPTUlTRVI6CiAgICAgICAgICAgICAgICAgICAgICAgIHBlLlNldExpZmVPcGFjaXR5UmFuZG9tKHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBERVNUUk9ZX01PREU6CiAgICAgICAgICAgICAgICAgICAgICAgIHBlLlNldERlc3Ryb3lNb2RlSW5kZXgodmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIFRJTUVPVVQ6CiAgICAgICAgICAgICAgICAgICAgICAgIHBlLlNldFRpbWVvdXQodmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIEdldERlYnVnZ2VyUHJvcGVydGllcygpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHByZWZpeCA9ICJwbHVnaW5zLnBhcnRpY2xlcyI7CiAgICAgICAgICAgICAgICBjb25zdCBwcm9wUHJlZml4ID0gcHJlZml4ICsgIi5wcm9wZXJ0aWVzIjsKICAgICAgICAgICAgICAgIGNvbnN0IGRiZ1ByZWZpeCA9IHByZWZpeCArICIuZGVidWdnZXIiOwogICAgICAgICAgICAgICAgY29uc3QgcGUgPSB0aGlzLl9wYXJ0aWNsZUVuZ2luZTsKICAgICAgICAgICAgICAgIHJldHVybiBbewogICAgICAgICAgICAgICAgICAgIHRpdGxlOiBwcmVmaXggKyAiLm5hbWUiLAogICAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IFt7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBkYmdQcmVmaXggKyAiLnBhcnRpY2xlLWNvdW50IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBwZS5HZXRQYXJ0aWNsZUNvdW50KCkKICAgICAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogcHJvcFByZWZpeCArICIudHlwZS5uYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBbcHJvcFByZWZpeCArICIudHlwZS5pdGVtcy4iICsgcGUuR2V0U3ByYXlUeXBlKCldCiAgICAgICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGRiZ1ByZWZpeCArICIuaXMtc3ByYXlpbmciLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHBlLklzU3ByYXlpbmcoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uZWRpdDogdiA9PiBwZS5TZXRTcHJheWluZyh2KQogICAgICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBwcm9wUHJlZml4ICsgIi5yYXRlLm5hbWUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHBlLkdldFJhdGUoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uZWRpdDogdiA9PiBwZS5TZXRSYXRlKHYpCiAgICAgICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHByb3BQcmVmaXggKyAiLnNwcmF5LWNvbmUubmFtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogQzMudG9EZWdyZWVzKHBlLkdldFNwcmF5Q29uZSgpKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uZWRpdDogdiA9PiBwZS5TZXRTcHJheUNvbmUoQzMudG9SYWRpYW5zKHYpKQogICAgICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBwcm9wUHJlZml4ICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiLnNwZWVkLm5hbWUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHBlLkdldEluaXRTcGVlZCgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgb25lZGl0OiB2ID0+IHBlLlNldEluaXRTcGVlZCh2KQogICAgICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBwcm9wUHJlZml4ICsgIi5zaXplLm5hbWUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHBlLkdldEluaXRTaXplKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbmVkaXQ6IHYgPT4gcGUuU2V0SW5pdFNpemUodikKICAgICAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogcHJvcFByZWZpeCArICIub3BhY2l0eS5uYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBwZS5HZXRJbml0T3BhY2l0eSgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgb25lZGl0OiB2ID0+IHBlLlNldEluaXRPcGFjaXR5KHYpCiAgICAgICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHByb3BQcmVmaXggKyAiLmdyb3ctcmF0ZS5uYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBwZS5HZXRHcm93UmF0ZSgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgb25lZGl0OiB2ID0+IHBlLlNldEdyb3dSYXRlKHYpCiAgICAgICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHByb3BQcmVmaXggKyAiLngtcmFuZG9taXNlci5uYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBwZS5HZXRJbml0WFJhbmRvbSgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgb25lZGl0OiB2ID0+IHBlLlNldEluaXRYUmFuZG9tKHYpCiAgICAgICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHByb3BQcmVmaXggKyAiLnktcmFuZG9taXNlci5uYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBwZS5HZXRJbml0WVJhbmRvbSgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgb25lZGl0OiB2ID0+IHBlLlNldEluaXRZUmFuZG9tKHYpCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHByb3BQcmVmaXggKyAiLmluaXRpYWwtc3BlZWQtcmFuZG9taXNlci5uYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBwZS5HZXRJbml0U3BlZWRSYW5kb20oKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uZWRpdDogdiA9PiBwZS5TZXRJbml0U3BlZWRSYW5kb20odikKICAgICAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogcHJvcFByZWZpeCArICIuc2l6ZS1yYW5kb21pc2VyLm5hbWUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHBlLkdldEluaXRTaXplUmFuZG9tKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbmVkaXQ6IHYgPT4gcGUuU2V0SW5pdFNpemVSYW5kb20odikKICAgICAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogcHJvcFByZWZpeCArICIuZ3Jvdy1yYXRlLXJhbmRvbWlzZXIubmFtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogcGUuR2V0R3Jvd1JhbmRvbSgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgb25lZGl0OiB2ID0+IHBlLlNldEdyb3dSYW5kb20odikKICAgICAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogcHJvcFByZWZpeCArICIuYWNjZWxlcmF0aW9uLm5hbWUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHBlLkdldEFjY2VsZXJhdGlvbigpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgb25lZGl0OiB2ID0+IHBlLlNldEFjY2VsZXJhdGlvbih2KQogICAgICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBwcm9wUHJlZml4ICsgIi5ncmF2aXR5Lm5hbWUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHBlLkdldEdyYXZpdHkoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uZWRpdDogdiA9PiBwZS5TZXRHcmF2aXR5KHYpCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHByb3BQcmVmaXggKyAiLmFuZ2xlLXJhbmRvbWlzZXIubmFtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogcGUuR2V0TGlmZUFuZ2xlUmFuZG9tKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbmVkaXQ6IHYgPT4gcGUuU2V0TGlmZUFuZ2xlUmFuZG9tKHYpCiAgICAgICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHByb3BQcmVmaXggKyAiLmxpZmUtc3BlZWQtcmFuZG9taXNlci5uYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBwZS5HZXRMaWZlU3BlZWRSYW5kb20oKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uZWRpdDogdiA9PiBwZS5TZXRMaWZlU3BlZWRSYW5kb20odikKICAgICAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogcHJvcFByZWZpeCArICIub3BhY2l0eS1yYW5kb21pc2VyLm5hbWUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHBlLkdldExpZmVPcGFjaXR5UmFuZG9tKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbmVkaXQ6IHYgPT4gcGUuU2V0TGlmZU9wYWNpdHlSYW5kb20odikKICAgICAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogcHJvcFByZWZpeCArICIudGltZW91dC5uYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBwZS5HZXRUaW1lb3V0KCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbmVkaXQ6IHYgPT4gcGUuU2V0VGltZW91dCh2KQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgXQogICAgICAgICAgICAgICAgfV0KICAgICAgICAgICAgfQogICAgICAgICAgICBHZXRTY3JpcHRJbnRlcmZhY2VDbGFzcygpIHsKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLklQYXJ0aWNsZXNJbnN0YW5jZQogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICBjb25zdCBtYXAgPSBuZXcgV2Vha01hcDsKCiAgICAgICAgZnVuY3Rpb24gR2V0UGFydGljbGVFbmdpbmUoaWluc3QpIHsKICAgICAgICAgICAgcmV0dXJuIG1hcC5nZXQoaWluc3QpLkdldFBhcnRpY2xlRW5naW5lKCkKICAgICAgICB9CiAgICAgICAgc2VsZi5JUGFydGljbGVzSW5zdGFuY2UgPSBjbGFzcyBJUGFydGljbGVzSW5zdGFuY2UgZXh0ZW5kcyBzZWxmLklXb3JsZEluc3RhbmNlIHsKICAgICAgICAgICAgY29uc3RydWN0b3IoKSB7CiAgICAgICAgICAgICAgICBzdXBlcigpOwogICAgICAgICAgICAgICAgbWFwLnNldCh0aGlzLCBzZWxmLklJbnN0YW5jZS5fR2V0SW5pdEluc3QoKS5HZXRTZGtJbnN0YW5jZSgpKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHNldCBpc1NwcmF5aW5nKHMpIHsKICAgICAgICAgICAgICAgIEdldFBhcnRpY2xlRW5naW5lKHRoaXMpLlNldFNwcmF5aW5nKCEhcykKICAgICAgICAgICAgfQogICAgICAgICAgICBnZXQgaXNTcHJheWluZygpIHsKICAgICAgICAgICAgICAgIHJldHVybiBHZXRQYXJ0aWNsZUVuZ2luZSh0aGlzKS5Jc1NwcmF5aW5nKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBzZXQgcmF0ZShyKSB7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcihyKTsKICAgICAgICAgICAgICAgIG1hcC5nZXQodGhpcykuX1NldFJhdGUocikKICAgICAgICAgICAgfQogICAgICAgICAgICBnZXQgcmF0ZSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBHZXRQYXJ0aWNsZUVuZ2luZSh0aGlzKS5HZXRSYXRlKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBzZXQgc3ByYXlDb25lKGMpIHsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlRmluaXRlTnVtYmVyKGMpOwogICAgICAgICAgICAgICAgR2V0UGFydGljbGVFbmdpbmUodGhpcykuU2V0U3ByYXlDb25lKGMpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZ2V0IHNwcmF5Q29uZSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBHZXRQYXJ0aWNsZUVuZ2luZSh0aGlzKS5HZXRTcHJheUNvbmUoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHNldCBpbml0U3BlZWQocykgewogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVGaW5pdGVOdW1iZXIocyk7CiAgICAgICAgICAgICAgICBHZXRQYXJ0aWNsZUVuZ2luZSh0aGlzKS5TZXRJbml0U3BlZWQocykKICAgICAgICAgICAgfQogICAgICAgICAgICBnZXQgaW5pdFNwZWVkKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIEdldFBhcnRpY2xlRW5naW5lKHRoaXMpLkdldEluaXRTcGVlZCgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2V0IGluaXRTaXplKHMpIHsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlRmluaXRlTnVtYmVyKHMpOwogICAgICAgICAgICAgICAgR2V0UGFydGljbGVFbmdpbmUodGhpcykuU2V0SW5pdFNpemUocykKICAgICAgICAgICAgfQogICAgICAgICAgICBnZXQgaW5pdFNpemUoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gR2V0UGFydGljbGVFbmdpbmUodGhpcykuR2V0SW5pdFNpemUoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHNldCBpbml0T3BhY2l0eShvKSB7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcihvKTsKICAgICAgICAgICAgICAgIEdldFBhcnRpY2xlRW5naW5lKHRoaXMpLlNldEluaXRPcGFjaXR5KG8pCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZ2V0IGluaXRPcGFjaXR5KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIEdldFBhcnRpY2xlRW5naW5lKHRoaXMpLkdldEluaXRPcGFjaXR5KCkKICAgICAgICAgICAgfQogICAgICAgICAgICBzZXQgaW5pdFhSYW5kb20oeCkgewogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVGaW5pdGVOdW1iZXIoeCk7CiAgICAgICAgICAgICAgICBHZXRQYXJ0aWNsZUVuZ2luZSh0aGlzKS5TZXRJbml0WFJhbmRvbSh4KQogICAgICAgICAgICB9CiAgICAgICAgICAgIGdldCBpbml0WFJhbmRvbSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBHZXRQYXJ0aWNsZUVuZ2luZSh0aGlzKS5HZXRJbml0WFJhbmRvbSgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2V0IGluaXRZUmFuZG9tKHkpIHsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlRmluaXRlTnVtYmVyKHkpOwogICAgICAgICAgICAgICAgR2V0UGFydGljbGVFbmdpbmUodGhpcykuU2V0SW5pdFlSYW5kb20oeSkKICAgICAgICAgICAgfQogICAgICAgICAgICBnZXQgaW5pdFlSYW5kb20oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gR2V0UGFydGljbGVFbmdpbmUodGhpcykuR2V0SW5pdFlSYW5kb20oKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHNldCBpbml0U3BlZWRSYW5kb20ocykgewogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVGaW5pdGVOdW1iZXIocyk7CiAgICAgICAgICAgICAgICBHZXRQYXJ0aWNsZUVuZ2luZSh0aGlzKS5TZXRJbml0U3BlZWRSYW5kb20ocykKICAgICAgICAgICAgfQogICAgICAgICAgICBnZXQgaW5pdFNwZWVkUmFuZG9tKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIEdldFBhcnRpY2xlRW5naW5lKHRoaXMpLkdldEluaXRTcGVlZFJhbmRvbSgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2V0IGluaXRTaXplUmFuZG9tKHMpIHsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlRmluaXRlTnVtYmVyKHMpOwogICAgICAgICAgICAgICAgR2V0UGFydGljbGVFbmdpbmUodGhpcykuU2V0SW5pdFNpemVSYW5kb20ocykKICAgICAgICAgICAgfQogICAgICAgICAgICBnZXQgaW5pdFNpemVSYW5kb20oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gR2V0UGFydGljbGVFbmdpbmUodGhpcykuR2V0SW5pdFNpemVSYW5kb20oKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHNldCBpbml0R3Jvd1JhdGUocikgewogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVGaW5pdGVOdW1iZXIocik7CiAgICAgICAgICAgICAgICBHZXRQYXJ0aWNsZUVuZ2luZSh0aGlzKS5TZXRHcm93UmF0ZShyKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGdldCBpbml0R3Jvd1JhdGUoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gR2V0UGFydGljbGVFbmdpbmUodGhpcykuR2V0R3Jvd1JhdGUoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHNldCBpbml0R3Jvd1JhbmRvbShyKSB7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcihyKTsKICAgICAgICAgICAgICAgIEdldFBhcnRpY2xlRW5naW5lKHRoaXMpLlNldEdyb3dSYW5kb20ocikKICAgICAgICAgICAgfQogICAgICAgICAgICBnZXQgaW5pdEdyb3dSYW5kb20oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gR2V0UGFydGljbGVFbmdpbmUodGhpcykuR2V0R3Jvd1JhbmRvbSgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2V0IGFjY2VsZXJhdGlvbihhKSB7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcihhKTsKICAgICAgICAgICAgICAgIEdldFBhcnRpY2xlRW5naW5lKHRoaXMpLlNldEFjY2VsZXJhdGlvbihhKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGdldCBhY2NlbGVyYXRpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gR2V0UGFydGljbGVFbmdpbmUodGhpcykuR2V0QWNjZWxlcmF0aW9uKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBzZXQgZ3Jhdml0eShnKSB7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcihnKTsKICAgICAgICAgICAgICAgIEdldFBhcnRpY2xlRW5naW5lKHRoaXMpLlNldEdyYXZpdHkoZykKICAgICAgICAgICAgfQogICAgICAgICAgICBnZXQgZ3Jhdml0eSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBHZXRQYXJ0aWNsZUVuZ2luZSh0aGlzKS5HZXRHcmF2aXR5KCkKICAgICAgICAgICAgfQogICAgICAgICAgICBzZXQgbGlmZUFuZ2xlUmFuZG9tKHIpIHsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlRmluaXRlTnVtYmVyKHIpOwogICAgICAgICAgICAgICAgR2V0UGFydGljbGVFbmdpbmUodGhpcykuU2V0TGlmZUFuZ2xlUmFuZG9tKHIpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZ2V0IGxpZmVBbmdsZVJhbmRvbSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBHZXRQYXJ0aWNsZUVuZ2luZSh0aGlzKS5HZXRMaWZlQW5nbGVSYW5kb20oKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHNldCBsaWZlU3BlZWRSYW5kb20ocikgewogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVGaW5pdGVOdW1iZXIocik7CiAgICAgICAgICAgICAgICBHZXRQYXJ0aWNsZUVuZ2luZSh0aGlzKS5TZXRMaWZlU3BlZWRSYW5kb20ocikKICAgICAgICAgICAgfQogICAgICAgICAgICBnZXQgbGlmZVNwZWVkUmFuZG9tKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIEdldFBhcnRpY2xlRW5naW5lKHRoaXMpLkdldExpZmVTcGVlZFJhbmRvbSgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2V0IGxpZmVPcGFjaXR5UmFuZG9tKHIpIHsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlRmluaXRlTnVtYmVyKHIpOwogICAgICAgICAgICAgICAgR2V0UGFydGljbGVFbmdpbmUodGhpcykuU2V0TGlmZU9wYWNpdHlSYW5kb20ocikKICAgICAgICAgICAgfQogICAgICAgICAgICBnZXQgbGlmZU9wYWNpdHlSYW5kb20oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gR2V0UGFydGljbGVFbmdpbmUodGhpcykuR2V0TGlmZU9wYWNpdHlSYW5kb20oKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHNldCB0aW1lb3V0KHQpIHsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlRmluaXRlTnVtYmVyKHQpOwogICAgICAgICAgICAgICAgR2V0UGFydGljbGVFbmdpbmUodGhpcykuU2V0VGltZW91dCh0KQogICAgICAgICAgICB9CiAgICAgICAgICAgIGdldCB0aW1lb3V0KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIEdldFBhcnRpY2xlRW5naW5lKHRoaXMpLkdldFRpbWVvdXQoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZhc3RGb3J3YXJkKHRpbWUpIHsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlRmluaXRlTnVtYmVyKHRpbWUpOwogICAgICAgICAgICAgICAgbWFwLmdldCh0aGlzKS5fRmFzdEZvcndhcmQodGltZSkKICAgICAgICAgICAgfQogICAgICAgICAgICBzZXRQYXJ0aWNsZU9iamVjdENsYXNzKGlPYmplY3RDbGFzcykgewogICAgICAgICAgICAgICAgY29uc3QgaW5zdCA9IG1hcC5nZXQodGhpcyk7CiAgICAgICAgICAgICAgICBpZiAoaU9iamVjdENsYXNzKSBpbnN0Ll9TZXRQYXJ0aWNsZU9iamVjdENsYXNzKGluc3QuR2V0UnVudGltZSgpLl9VbndyYXBJT2JqZWN0Q2xhc3MoaU9iamVjdENsYXNzKSk7CiAgICAgICAgICAgICAgICBlbHNlIGluc3QuX1NldFBhcnRpY2xlT2JqZWN0Q2xhc3MobnVsbCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gewogICAgICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgICAgICBDMy5QbHVnaW5zLlBhcnRpY2xlcy5DbmRzID0gewogICAgICAgICAgICBJc1NwcmF5aW5nKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3BhcnRpY2xlRW5naW5lLklzU3ByYXlpbmcoKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSB7CiAgICAgICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgICAgIEMzLlBsdWdpbnMuUGFydGljbGVzLkFjdHMgPSB7CiAgICAgICAgICAgIFNldFNwcmF5aW5nKHMpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3BhcnRpY2xlRW5naW5lLlNldFNwcmF5aW5nKHMgIT09IDApCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFNldFJhdGUocikgewogICAgICAgICAgICAgICAgdGhpcy5fU2V0UmF0ZShyKQogICAgICAgICAgICB9LAogICAgICAgICAgICBTZXRQYXJ0aWNsZU9iamVjdChvYmplY3RDbGFzcykgewogICAgICAgICAgICAgICAgdGhpcy5fU2V0UGFydGljbGVPYmplY3RDbGFzcyhvYmplY3RDbGFzcykKICAgICAgICAgICAgfSwKICAgICAgICAgICAgVW5zZXRQYXJ0aWNsZU9iamVjdCgpIHsKICAgICAgICAgICAgICAgIHRoaXMuX1NldFBhcnRpY2xlT2JqZWN0Q2xhc3MobnVsbCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgU2V0U3ByYXlDb25lKGMpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3BhcnRpY2xlRW5naW5lLlNldFNwcmF5Q29uZShDMy50b1JhZGlhbnMoYykpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFNldEluaXRTcGVlZCh4KSB7CiAgICAgICAgICAgICAgICB0aGlzLl9wYXJ0aWNsZUVuZ2luZS5TZXRJbml0U3BlZWQoeCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgU2V0SW5pdFNpemUoeCkgewogICAgICAgICAgICAgICAgdGhpcy5fcGFydGljbGVFbmdpbmUuU2V0SW5pdFNpemUoeCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgU2V0SW5pdE9wYWNpdHkoeCkgewogICAgICAgICAgICAgICAgdGhpcy5fcGFydGljbGVFbmdpbmUuU2V0SW5pdE9wYWNpdHkoeCAvIDEwMCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgU2V0R3Jvd1JhdGUoeCkgewogICAgICAgICAgICAgICAgdGhpcy5fcGFydGljbGVFbmdpbmUuU2V0R3Jvd1JhdGUoeCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgU2V0WFJhbmRvbWlzZXIoeCkgewogICAgICAgICAgICAgICAgdGhpcy5fcGFydGljbGVFbmdpbmUuU2V0SW5pdFhSYW5kb20oeCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgU2V0WVJhbmRvbWlzZXIoeCkgewogICAgICAgICAgICAgICAgdGhpcy5fcGFydGljbGVFbmdpbmUuU2V0SW5pdFlSYW5kb20oeCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgU2V0U3BlZWRSYW5kb21pc2VyKHgpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3BhcnRpY2xlRW5naW5lLlNldEluaXRTcGVlZFJhbmRvbSh4KQogICAgICAgICAgICB9LAogICAgICAgICAgICBTZXRTaXplUmFuZG9taXNlcih4KSB7CiAgICAgICAgICAgICAgICB0aGlzLl9wYXJ0aWNsZUVuZ2luZS5TZXRJbml0U2l6ZVJhbmRvbSh4KQogICAgICAgICAgICB9LAogICAgICAgICAgICBTZXRHcm93UmF0ZVJhbmRvbWlzZXIoeCkgewogICAgICAgICAgICAgICAgdGhpcy5fcGFydGljbGVFbmdpbmUuU2V0R3Jvd1JhbmRvbSh4KQogICAgICAgICAgICB9LAogICAgICAgICAgICBTZXRQYXJ0aWNsZUFjYyh4KSB7CiAgICAgICAgICAgICAgICB0aGlzLl9wYXJ0aWNsZUVuZ2luZS5TZXRBY2NlbGVyYXRpb24oeCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgU2V0R3Jhdml0eSh4KSB7CiAgICAgICAgICAgICAgICB0aGlzLl9wYXJ0aWNsZUVuZ2luZS5TZXRHcmF2aXR5KHgpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFNldEFuZ2xlUmFuZG9taXNlcih4KSB7CiAgICAgICAgICAgICAgICB0aGlzLl9wYXJ0aWNsZUVuZ2luZS5TZXRMaWZlQW5nbGVSYW5kb20oeCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgU2V0TGlmZVNwZWVkUmFuZG9taXNlcih4KSB7CiAgICAgICAgICAgICAgICB0aGlzLl9wYXJ0aWNsZUVuZ2luZS5TZXRMaWZlU3BlZWRSYW5kb20oeCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgU2V0T3BhY2l0eVJhbmRvbWlzZXIoeCkgewogICAgICAgICAgICAgICAgdGhpcy5fcGFydGljbGVFbmdpbmUuU2V0TGlmZU9wYWNpdHlSYW5kb20oeCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgU2V0VGltZW91dCh4KSB7CiAgICAgICAgICAgICAgICB0aGlzLl9wYXJ0aWNsZUVuZ2luZS5TZXRUaW1lb3V0KHgpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIEZhc3RGb3J3YXJkKHRpbWUpIHsKICAgICAgICAgICAgICAgIHRoaXMuX0Zhc3RGb3J3YXJkKHRpbWUpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFNldEVmZmVjdChlZmZlY3QpIHsKICAgICAgICAgICAgICAgIHRoaXMuR2V0V29ybGRJbmZvKCkuU2V0QmxlbmRNb2RlKGVmZmVjdCk7CiAgICAgICAgICAgICAgICB0aGlzLl9ydW50aW1lLlVwZGF0ZVJlbmRlcigpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IHsKICAgICAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICAgICAgQzMuUGx1Z2lucy5QYXJ0aWNsZXMuRXhwcyA9IHsKICAgICAgICAgICAgUGFydGljbGVDb3VudCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9wYXJ0aWNsZUVuZ2luZS5HZXRQYXJ0aWNsZUNvdW50KCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgUmF0ZSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9wYXJ0aWNsZUVuZ2luZS5HZXRSYXRlKCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgU3ByYXlDb25lKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIEMzLnRvRGVncmVlcyh0aGlzLl9wYXJ0aWNsZUVuZ2luZS5HZXRTcHJheUNvbmUoKSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgSW5pdFNwZWVkKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3BhcnRpY2xlRW5naW5lLkdldEluaXRTcGVlZCgpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIEluaXRTaXplKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3BhcnRpY2xlRW5naW5lLkdldEluaXRTaXplKCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgSW5pdE9wYWNpdHkoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcGFydGljbGVFbmdpbmUuR2V0SW5pdE9wYWNpdHkoKSAqIDEwMAogICAgICAgICAgICB9LAogICAgICAgICAgICBJbml0R3Jvd1JhdGUoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcGFydGljbGVFbmdpbmUuR2V0R3Jvd1JhdGUoKQogICAgICAgICAgICB9LAogICAgICAgICAgICBYUmFuZG9tKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3BhcnRpY2xlRW5naW5lLkdldEluaXRYUmFuZG9tKCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgWVJhbmRvbSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9wYXJ0aWNsZUVuZ2luZS5HZXRJbml0WVJhbmRvbSgpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIEluaXRTaXplUmFuZG9tKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3BhcnRpY2xlRW5naW5lLkdldEluaXRTaXplUmFuZG9tKCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgSW5pdFNwZWVkUmFuZG9tKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3BhcnRpY2xlRW5naW5lLkdldEluaXRTcGVlZFJhbmRvbSgpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIEluaXRHcm93UmFuZG9tKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3BhcnRpY2xlRW5naW5lLkdldEdyb3dSYW5kb20oKQogICAgICAgICAgICB9LAogICAgICAgICAgICBQYXJ0aWNsZUFjY2VsZXJhdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9wYXJ0aWNsZUVuZ2luZS5HZXRBY2NlbGVyYXRpb24oKQogICAgICAgICAgICB9LAogICAgICAgICAgICBHcmF2aXR5KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3BhcnRpY2xlRW5naW5lLkdldEdyYXZpdHkoKQogICAgICAgICAgICB9LAogICAgICAgICAgICBQYXJ0aWNsZUFuZ2xlUmFuZG9tKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3BhcnRpY2xlRW5naW5lLkdldExpZmVBbmdsZVJhbmRvbSgpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFBhcnRpY2xlU3BlZWRSYW5kb20oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcGFydGljbGVFbmdpbmUuR2V0TGlmZVNwZWVkUmFuZG9tKCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgUGFydGljbGVPcGFjaXR5UmFuZG9tKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3BhcnRpY2xlRW5naW5lLkdldExpZmVPcGFjaXR5UmFuZG9tKCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgVGltZW91dCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9wYXJ0aWNsZUVuZ2luZS5HZXRUaW1lb3V0KCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07Cgp9Cgp7CiAgICAndXNlIHN0cmljdCc7CiAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICBjb25zdCBpbmFjdGl2ZVBhcnRpY2xlcyA9IFtdOwogICAgY29uc3QgTUFYX1JFQ1lDTEVfUEFSVElDTEVTID0gMUUzOwogICAgY29uc3QgVkFMSURfU1BSQVlfVFlQRVMgPSBuZXcgU2V0KFsiY29udGludW91cy1zcHJheSIsICJvbmUtc2hvdCJdKTsKICAgIGNvbnN0IERFU1RST1lfTU9ERVMgPSBbImZhZGUtdG8taW52aXNpYmxlIiwgInRpbWVvdXQtZXhwaXJlZCIsICJwYXJ0aWNsZS1zdG9wcGVkIl07CiAgICBjb25zdCB0ZW1wUmVjdCA9IEMzLk5ldyhDMy5SZWN0KTsKICAgIHNlbGYuUGFydGljbGVFbmdpbmUgPSBjbGFzcyBQYXJ0aWNsZUVuZ2luZSB7CiAgICAgICAgY29uc3RydWN0b3IoKSB7CiAgICAgICAgICAgIHRoaXMuX3JhdGUgPSAwOwogICAgICAgICAgICB0aGlzLl9zcHJheUNvbmUgPSAwOwogICAgICAgICAgICB0aGlzLl9zcHJheVR5cGUgPSAiY29udGludW91cy1zcHJheSI7CiAgICAgICAgICAgIHRoaXMuX2lzU3ByYXlpbmcgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5fbWFzdGVyT3BhY2l0eSA9IDA7CiAgICAgICAgICAgIHRoaXMuX2lzUGl4ZWxSb3VuZGluZyA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLl9zcGF3blggPSAwOwogICAgICAgICAgICB0aGlzLl9zcGF3blkgPSAwOwogICAgICAgICAgICB0aGlzLl9zcGF3bkFuZ2xlID0gMDsKICAgICAgICAgICAgdGhpcy5faW5pdFNwZWVkID0gMDsKICAgICAgICAgICAgdGhpcy5faW5pdFNpemUgPSAwOwogICAgICAgICAgICB0aGlzLl9pbml0U2l6ZVNjYWxlID0gMTsKICAgICAgICAgICAgdGhpcy5faW5pdE9wYWNpdHkgPSAwOwogICAgICAgICAgICB0aGlzLl9ncm93UmF0ZSA9IDA7CiAgICAgICAgICAgIHRoaXMuX3hSYW5kb20gPSAwOwogICAgICAgICAgICB0aGlzLl95UmFuZG9tID0gMDsKICAgICAgICAgICAgdGhpcy5faW5pdFNwZWVkUmFuZG9tID0gMDsKICAgICAgICAgICAgdGhpcy5faW5pdFNpemVSYW5kb20gPSAwOwogICAgICAgICAgICB0aGlzLl9ncm93UmFuZG9tID0gMDsKICAgICAgICAgICAgdGhpcy5fYWNjZWxlcmF0aW9uID0gMDsKICAgICAgICAgICAgdGhpcy5fZ3Jhdml0eSA9IDA7CiAgICAgICAgICAgIHRoaXMuX2xpZmVBbmdsZVJhbmRvbSA9IDA7CiAgICAgICAgICAgIHRoaXMuX2xpZmVTcGVlZFJhbmRvbSA9CiAgICAgICAgICAgICAgICAwOwogICAgICAgICAgICB0aGlzLl9saWZlT3BhY2l0eVJhbmRvbSA9IDA7CiAgICAgICAgICAgIHRoaXMuX2Rlc3Ryb3lNb2RlID0gMDsKICAgICAgICAgICAgdGhpcy5fdGltZW91dCA9IDA7CiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZUNvdW50ZXIgPSAwOwogICAgICAgICAgICB0aGlzLl9wYXJ0aWNsZVNjYWxlID0gMTsKICAgICAgICAgICAgdGhpcy5vbm9uZXNob3RmaW5pc2ggPSBudWxsOwogICAgICAgICAgICB0aGlzLm9ucGFydGljbGVjcmVhdGUgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9wYXJ0aWNsZXMgPSBbXTsKICAgICAgICAgICAgdGhpcy5fYm91bmRpbmdCb3ggPSBuZXcgQzMuUmVjdDsKICAgICAgICAgICAgdGhpcy5fY29sb3IgPSBuZXcgQzMuQ29sb3IKICAgICAgICB9CiAgICAgICAgUmVsZWFzZSgpIHsKICAgICAgICAgICAgdGhpcy5DYW5jZWwoKTsKICAgICAgICAgICAgQzMuY2xlYXJBcnJheSh0aGlzLl9wYXJ0aWNsZXMpOwogICAgICAgICAgICB0aGlzLl9wYXJ0aWNsZXMgPSBudWxsOwogICAgICAgICAgICB0aGlzLm9ub25lc2hvdGZpbmlzaCA9IG51bGw7CiAgICAgICAgICAgIHRoaXMub25wYXJ0aWNsZWNyZWF0ZSA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX2JvdW5kaW5nQm94ID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5fY29sb3IgPSBudWxsCiAgICAgICAgfQogICAgICAgIENhbmNlbCgpIHsKICAgICAgICAgICAgY29uc3QgcGFydGljbGVzID0gdGhpcy5fcGFydGljbGVzOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gcGFydGljbGVzLmxlbmd0aDsgaSA8IGxlbjsgKytpKSBwYXJ0aWNsZXNbaV0uRGVzdHJveSgpOwogICAgICAgICAgICBDMy5hcHBlbmRBcnJheShpbmFjdGl2ZVBhcnRpY2xlcywgcGFydGljbGVzKTsKICAgICAgICAgICAgQzMuY2xlYXJBcnJheShwYXJ0aWNsZXMpOwogICAgICAgICAgICBpZiAoaW5hY3RpdmVQYXJ0aWNsZXMubGVuZ3RoID4gTUFYX1JFQ1lDTEVfUEFSVElDTEVTKSBDMy50cnVuY2F0ZUFycmF5KGluYWN0aXZlUGFydGljbGVzLCBNQVhfUkVDWUNMRV9QQVJUSUNMRVMpOwogICAgICAgICAgICB0aGlzLl9pc1NwcmF5aW5nID0gZmFsc2UKICAgICAgICB9CiAgICAgICAgQ3JlYXRlT25lU2hvdFNwcmF5KCkgewogICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gdGhpcy5fcmF0ZTsgaSA8IGxlbjsgKytpKSB0aGlzLl9DcmVhdGVQYXJ0aWNsZSgpOwogICAgICAgICAgICBpZiAodGhpcy5fcGFydGljbGVzLmxlbmd0aCkgdGhpcy5faXNTcHJheWluZyA9IHRydWUKICAgICAgICB9CiAgICAgICAgX0NyZWF0ZVBhcnRpY2xlKCkgewogICAgICAgICAgICBsZXQgcmV0ID0gbnVsbDsKICAgICAgICAgICAgaWYgKGluYWN0aXZlUGFydGljbGVzLmxlbmd0aCkgewogICAgICAgICAgICAgICAgcmV0ID0gaW5hY3RpdmVQYXJ0aWNsZXMucG9wKCk7CiAgICAgICAgICAgICAgICByZXQuU2V0RW5naW5lKHRoaXMpCiAgICAgICAgICAgIH0gZWxzZSByZXQgPSBDMy5OZXcoc2VsZi5QYXJ0aWNsZSwgdGhpcyk7CiAgICAgICAgICAgIHRoaXMuX3BhcnRpY2xlcy5wdXNoKHJldCk7CiAgICAgICAgICAgIHJldC5Jbml0KHRoaXMub25wYXJ0aWNsZWNyZWF0ZSk7CiAgICAgICAgICAgIHJldHVybiByZXQKICAgICAgICB9CiAgICAgICAgUmVJbml0QWxsUGFydGljbGVzKCkgewogICAgICAgICAgICBjb25zdCBwYXJ0aWNsZXMgPSB0aGlzLl9wYXJ0aWNsZXM7CiAgICAgICAgICAgIGNvbnN0IG9ucGFydGljbGVjcmVhdGUgPSB0aGlzLm9ucGFydGljbGVjcmVhdGU7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBwYXJ0aWNsZXMubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHBhcnRpY2xlc1tpXS5Jbml0KG9ucGFydGljbGVjcmVhdGUpCiAgICAgICAgfQogICAgICAgIFVwZGF0ZUFsbFBhcnRpY2xlc1VzZXJEYXRhKCkgewogICAgICAgICAgICBjb25zdCBwYXJ0aWNsZXMgPSB0aGlzLl9wYXJ0aWNsZXM7CiAgICAgICAgICAgIGNvbnN0IG9ucGFydGljbGVjcmVhdGUgPSB0aGlzLm9ucGFydGljbGVjcmVhdGU7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBwYXJ0aWNsZXMubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHBhcnRpY2xlc1tpXS5VcGRhdGVVc2VyRGF0YShvbnBhcnRpY2xlY3JlYXRlKQogICAgICAgIH0KICAgICAgICBBcHBseVBhcnRpY2xlRGF0YVRvVXNlckRhdGEoaW5zdCkgewogICAgICAgICAgICBjb25zdCBwYXJ0aWNsZXMgPSB0aGlzLl9wYXJ0aWNsZXM7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBwYXJ0aWNsZXMubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHBhcnRpY2xlID0KICAgICAgICAgICAgICAgICAgICBwYXJ0aWNsZXNbaV07CiAgICAgICAgICAgICAgICBjb25zdCB1c2VyRGF0YSA9IHBhcnRpY2xlLkdldFVzZXJEYXRhKCk7CiAgICAgICAgICAgICAgICBpZiAodXNlckRhdGEpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCB3aSA9IHVzZXJEYXRhLkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICAgICAgICAgIHdpLlNldFgocGFydGljbGUuR2V0WCgpKTsKICAgICAgICAgICAgICAgICAgICB3aS5TZXRZKHBhcnRpY2xlLkdldFkoKSk7CiAgICAgICAgICAgICAgICAgICAgd2kuU2V0U2l6ZShwYXJ0aWNsZS5HZXRTaXplKCksIHBhcnRpY2xlLkdldFNpemUoKSk7CiAgICAgICAgICAgICAgICAgICAgd2kuU2V0T3BhY2l0eShwYXJ0aWNsZS5HZXRPcGFjaXR5KCkpOwogICAgICAgICAgICAgICAgICAgIHdpLlNldEFuZ2xlKHBhcnRpY2xlLkdldEFuZ2xlKCkpOwogICAgICAgICAgICAgICAgICAgIHdpLlNldFVucHJlbXVsdGlwbGllZENvbG9yKGluc3QuR2V0V29ybGRJbmZvKCkuR2V0VW5wcmVtdWx0aXBsaWVkQ29sb3IoKSk7CiAgICAgICAgICAgICAgICAgICAgd2kuU2V0QmJveENoYW5nZWQoKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIFNldFBhcnRpY2xlQ291bnQoYykgewogICAgICAgICAgICBjb25zdCBwYXJ0aWNsZXMgPSB0aGlzLl9wYXJ0aWNsZXM7CiAgICAgICAgICAgIGlmIChjIDwgcGFydGljbGVzLmxlbmd0aCkgewogICAgICAgICAgICAgICAgY29uc3QgZGlmZiA9IHBhcnRpY2xlcy5sZW5ndGggLSBjOwogICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkaWZmOyArK2kpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBwID0gcGFydGljbGVzLnBvcCgpOwogICAgICAgICAgICAgICAgICAgIHAuRGVzdHJveSgpOwogICAgICAgICAgICAgICAgICAgIGluYWN0aXZlUGFydGljbGVzLnB1c2gocCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChpbmFjdGl2ZVBhcnRpY2xlcy5sZW5ndGggPiBNQVhfUkVDWUNMRV9QQVJUSUNMRVMpIEMzLnRydW5jYXRlQXJyYXkoaW5hY3RpdmVQYXJ0aWNsZXMsIE1BWF9SRUNZQ0xFX1BBUlRJQ0xFUykKICAgICAgICAgICAgfSBlbHNlIGlmIChjID4gcGFydGljbGVzLmxlbmd0aCkgewogICAgICAgICAgICAgICAgY29uc3QgZGlmZiA9IGMgLSBwYXJ0aWNsZXMubGVuZ3RoOwogICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkaWZmOyArK2kpIHRoaXMuX0NyZWF0ZVBhcnRpY2xlKCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBHZXRQYXJ0aWNsZXMoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9wYXJ0aWNsZXMKICAgICAgICB9CiAgICAgICAgR2V0UGFydGljbGVDb3VudCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3BhcnRpY2xlcy5sZW5ndGgKICAgICAgICB9CiAgICAgICAgVGljayhkdCkgewogICAgICAgICAgICB0aGlzLl9TcGF3bkNvbnRpbnVvdXMoZHQpOwogICAgICAgICAgICB0aGlzLl9UaWNrUGFydGljbGVzKGR0KTsKICAgICAgICAgICAgdGhpcy5fTWF5YmVGaW5pc2hPbmVTaG90KCkKICAgICAgICB9CiAgICAgICAgX1NwYXduQ29udGludW91cyhkdCkgewogICAgICAgICAgICBpZiAodGhpcy5fc3ByYXlUeXBlID09PSAiY29udGludW91cy1zcHJheSIgJiYgdGhpcy5faXNTcHJheWluZykgewogICAgICAgICAgICAgICAgdGhpcy5fY3JlYXRlQ291bnRlciArPQogICAgICAgICAgICAgICAgICAgIGR0ICogdGhpcy5fcmF0ZTsKICAgICAgICAgICAgICAgIGNvbnN0IG4gPSBNYXRoLmZsb29yKHRoaXMuX2NyZWF0ZUNvdW50ZXIpOwogICAgICAgICAgICAgICAgdGhpcy5fY3JlYXRlQ291bnRlciAtPSBuOwogICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBuOyArK2kpIHRoaXMuX0NyZWF0ZVBhcnRpY2xlKCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBfU2V0Q3JlYXRlQ291bnRlcihjKSB7CiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZUNvdW50ZXIgPSBjCiAgICAgICAgfQogICAgICAgIF9HZXRDcmVhdGVDb3VudGVyKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fY3JlYXRlQ291bnRlcgogICAgICAgIH0KICAgICAgICBfVGlja1BhcnRpY2xlcyhkdCkgewogICAgICAgICAgICBjb25zdCBiYm94ID0gdGhpcy5fYm91bmRpbmdCb3g7CiAgICAgICAgICAgIGJib3guc2V0KHRoaXMuX3NwYXduWCwgdGhpcy5fc3Bhd25ZLCB0aGlzLl9zcGF3blgsIHRoaXMuX3NwYXduWSk7CiAgICAgICAgICAgIGNvbnN0IHBhcnRpY2xlcyA9IHRoaXMuX3BhcnRpY2xlczsKICAgICAgICAgICAgbGV0IGogPSAwOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gcGFydGljbGVzLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7CiAgICAgICAgICAgICAgICBjb25zdCBwID0gcGFydGljbGVzW2ldOwogICAgICAgICAgICAgICAgcGFydGljbGVzW2pdID0gcDsKICAgICAgICAgICAgICAgIHAuVGljayhkdCk7CiAgICAgICAgICAgICAgICBpZiAocC5Jc0FjdGl2ZSgpKSB7CiAgICAgICAgICAgICAgICAgICAgKytqOwogICAgICAgICAgICAgICAgICAgIGJib3guZXhwYW5kVG9Db250YWluKHAuR2V0Qm91bmRpbmdCb3goKSkKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcC5EZXN0cm95KCk7CiAgICAgICAgICAgICAgICAgICAgaW5hY3RpdmVQYXJ0aWNsZXMucHVzaChwKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIEMzLnRydW5jYXRlQXJyYXkocGFydGljbGVzLCBqKTsKICAgICAgICAgICAgaWYgKGluYWN0aXZlUGFydGljbGVzLmxlbmd0aCA+IE1BWF9SRUNZQ0xFX1BBUlRJQ0xFUykgQzMudHJ1bmNhdGVBcnJheShpbmFjdGl2ZVBhcnRpY2xlcywgTUFYX1JFQ1lDTEVfUEFSVElDTEVTKQogICAgICAgIH0KICAgICAgICBfTWF5YmVGaW5pc2hPbmVTaG90KCkgewogICAgICAgICAgICBpZiAodGhpcy5fc3ByYXlUeXBlID09PSAib25lLXNob3QiICYmIHRoaXMuX3BhcnRpY2xlcy5sZW5ndGggPT09IDAgJiYgdGhpcy5faXNTcHJheWluZykgewogICAgICAgICAgICAgICAgaWYgKHRoaXMub25vbmVzaG90ZmluaXNoKSB0aGlzLm9ub25lc2hvdGZpbmlzaCgpOwogICAgICAgICAgICAgICAgdGhpcy5faXNTcHJheWluZyA9IGZhbHNlCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgRHJhdyhyZW5kZXJlciwgdGV4UXVhZCwgdmlld3BvcnQsIGZvcmNlUXVhZHMpIHsKICAgICAgICAgICAgdGVtcFJlY3Quc2V0KHRleFF1YWQuZ2V0VGx4KCksIHRleFF1YWQuZ2V0VGx5KCksIHRleFF1YWQuZ2V0QnJ4KCksIHRleFF1YWQuZ2V0QnJ5KCkpOwogICAgICAgICAgICByZW5kZXJlci5TdGFydFJlbmRlcmluZ1BvaW50cyh0ZW1wUmVjdCk7CiAgICAgICAgICAgIHRoaXMuX2NvbG9yLmNvcHkocmVuZGVyZXIuR2V0Q29sb3IoKSk7CiAgICAgICAgICAgIGNvbnN0IHBhcnRpY2xlcyA9IHRoaXMuX3BhcnRpY2xlczsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IHBhcnRpY2xlcy5sZW5ndGg7IGkgPCBsZW47ICsraSkgewogICAgICAgICAgICAgICAgY29uc3QgcCA9IHBhcnRpY2xlc1tpXTsKICAgICAgICAgICAgICAgIGlmICh2aWV3cG9ydC5pbnRlcnNlY3RzUmVjdChwLkdldEJvdW5kaW5nQm94KCkpKSBwLkRyYXcocmVuZGVyZXIsIHRleFF1YWQsIGZvcmNlUXVhZHMpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmVuZGVyZXIuRmluaXNoUmVuZGVyaW5nUG9pbnRzKCkKICAgICAgICB9CiAgICAgICAgR2V0Q29sb3IoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9jb2xvcgogICAgICAgIH0KICAgICAgICBTZXRSYXRlKHIpIHsKICAgICAgICAgICAgdGhpcy5fcmF0ZSA9ICtyCiAgICAgICAgfQogICAgICAgIEdldFJhdGUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9yYXRlCiAgICAgICAgfQogICAgICAgIFNldFNwcmF5Q29uZShjKSB7CiAgICAgICAgICAgIHRoaXMuX3NwcmF5Q29uZSA9ICtjCiAgICAgICAgfQogICAgICAgIEdldFNwcmF5Q29uZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NwcmF5Q29uZQogICAgICAgIH0KICAgICAgICBTZXRTcHJheVR5cGUodHlwZSkgewogICAgICAgICAgICBpZiAoIVZBTElEX1NQUkFZX1RZUEVTLmhhcyh0eXBlKSkgdGhyb3cgbmV3IEVycm9yKCJpbnZhbGlkIHNwcmF5IHR5cGUiKTsKICAgICAgICAgICAgdGhpcy5fc3ByYXlUeXBlID0KICAgICAgICAgICAgICAgIHR5cGUKICAgICAgICB9CiAgICAgICAgR2V0U3ByYXlUeXBlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fc3ByYXlUeXBlCiAgICAgICAgfQogICAgICAgIFNldFNwcmF5aW5nKHMpIHsKICAgICAgICAgICAgdGhpcy5faXNTcHJheWluZyA9ICEhcwogICAgICAgIH0KICAgICAgICBJc1NwcmF5aW5nKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faXNTcHJheWluZwogICAgICAgIH0KICAgICAgICBTZXRNYXN0ZXJPcGFjaXR5KG8pIHsKICAgICAgICAgICAgdGhpcy5fbWFzdGVyT3BhY2l0eSA9ICtvCiAgICAgICAgfQogICAgICAgIEdldE1hc3Rlck9wYWNpdHkoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9tYXN0ZXJPcGFjaXR5CiAgICAgICAgfQogICAgICAgIFNldFBpeGVsUm91bmRpbmcocikgewogICAgICAgICAgICB0aGlzLl9pc1BpeGVsUm91bmRpbmcgPSAhIXIKICAgICAgICB9CiAgICAgICAgSXNQaXhlbFJvdW5kaW5nKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faXNQaXhlbFJvdW5kaW5nCiAgICAgICAgfQogICAgICAgIFNldFNwYXduWCh4KSB7CiAgICAgICAgICAgIHRoaXMuX3NwYXduWCA9ICt4CiAgICAgICAgfQogICAgICAgIEdldFNwYXduWCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NwYXduWAogICAgICAgIH0KICAgICAgICBTZXRTcGF3blkoeSkgewogICAgICAgICAgICB0aGlzLl9zcGF3blkgPSAreQogICAgICAgIH0KICAgICAgICBHZXRTcGF3blkoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zcGF3blkKICAgICAgICB9CiAgICAgICAgU2V0U3Bhd25BbmdsZShhKSB7CiAgICAgICAgICAgIHRoaXMuX3NwYXduQW5nbGUgPSArYQogICAgICAgIH0KICAgICAgICBHZXRJbml0QW5nbGUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zcGF3bkFuZ2xlCiAgICAgICAgfQogICAgICAgIFNldEluaXRTcGVlZChzKSB7CiAgICAgICAgICAgIHRoaXMuX2luaXRTcGVlZCA9ICtzCiAgICAgICAgfQogICAgICAgIEdldEluaXRTcGVlZCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2luaXRTcGVlZAogICAgICAgIH0KICAgICAgICBTZXRJbml0U2l6ZShzKSB7CiAgICAgICAgICAgIHRoaXMuX2luaXRTaXplID0gK3MKICAgICAgICB9CiAgICAgICAgR2V0SW5pdFNpemUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pbml0U2l6ZQogICAgICAgIH0KICAgICAgICBTZXRJbml0U2l6ZVNjYWxlKHMpIHsKICAgICAgICAgICAgdGhpcy5faW5pdFNpemVTY2FsZSA9ICtzCiAgICAgICAgfQogICAgICAgIEdldEluaXRTaXplU2NhbGUoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pbml0U2l6ZVNjYWxlCiAgICAgICAgfQogICAgICAgIFNldEluaXRPcGFjaXR5KG8pIHsKICAgICAgICAgICAgdGhpcy5faW5pdE9wYWNpdHkgPSArbwogICAgICAgIH0KICAgICAgICBHZXRJbml0T3BhY2l0eSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2luaXRPcGFjaXR5CiAgICAgICAgfQogICAgICAgIFNldEdyb3dSYXRlKGcpIHsKICAgICAgICAgICAgdGhpcy5fZ3Jvd1JhdGUgPSArZwogICAgICAgIH0KICAgICAgICBHZXRHcm93UmF0ZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2dyb3dSYXRlCiAgICAgICAgfQogICAgICAgIFNldEluaXRYUmFuZG9tKHgpIHsKICAgICAgICAgICAgdGhpcy5feFJhbmRvbSA9ICt4CiAgICAgICAgfQogICAgICAgIEdldEluaXRYUmFuZG9tKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5feFJhbmRvbQogICAgICAgIH0KICAgICAgICBTZXRJbml0WVJhbmRvbSh5KSB7CiAgICAgICAgICAgIHRoaXMuX3lSYW5kb20gPSAreQogICAgICAgIH0KICAgICAgICBHZXRJbml0WVJhbmRvbSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3lSYW5kb20KICAgICAgICB9CiAgICAgICAgU2V0SW5pdFNwZWVkUmFuZG9tKHMpIHsKICAgICAgICAgICAgdGhpcy5faW5pdFNwZWVkUmFuZG9tID0gK3MKICAgICAgICB9CiAgICAgICAgR2V0SW5pdFNwZWVkUmFuZG9tKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faW5pdFNwZWVkUmFuZG9tCiAgICAgICAgfQogICAgICAgIFNldEluaXRTaXplUmFuZG9tKHMpIHsKICAgICAgICAgICAgdGhpcy5faW5pdFNpemVSYW5kb20gPSArcwogICAgICAgIH0KICAgICAgICBHZXRJbml0U2l6ZVJhbmRvbSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2luaXRTaXplUmFuZG9tCiAgICAgICAgfQogICAgICAgIFNldEdyb3dSYW5kb20oZykgewogICAgICAgICAgICB0aGlzLl9ncm93UmFuZG9tID0gK2cKICAgICAgICB9CiAgICAgICAgR2V0R3Jvd1JhbmRvbSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2dyb3dSYW5kb20KICAgICAgICB9CiAgICAgICAgU2V0QWNjZWxlcmF0aW9uKGEpIHsKICAgICAgICAgICAgdGhpcy5fYWNjZWxlcmF0aW9uID0gK2EKICAgICAgICB9CiAgICAgICAgR2V0QWNjZWxlcmF0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fYWNjZWxlcmF0aW9uCiAgICAgICAgfQogICAgICAgIFNldEdyYXZpdHkoZykgewogICAgICAgICAgICB0aGlzLl9ncmF2aXR5ID0gK2cKICAgICAgICB9CiAgICAgICAgR2V0R3Jhdml0eSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2dyYXZpdHkKICAgICAgICB9CiAgICAgICAgU2V0TGlmZUFuZ2xlUmFuZG9tKGEpIHsKICAgICAgICAgICAgdGhpcy5fbGlmZUFuZ2xlUmFuZG9tID0gK2EKICAgICAgICB9CiAgICAgICAgR2V0TGlmZUFuZ2xlUmFuZG9tKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fbGlmZUFuZ2xlUmFuZG9tCiAgICAgICAgfQogICAgICAgIFNldExpZmVTcGVlZFJhbmRvbShzKSB7CiAgICAgICAgICAgIHRoaXMuX2xpZmVTcGVlZFJhbmRvbSA9ICtzCiAgICAgICAgfQogICAgICAgIEdldExpZmVTcGVlZFJhbmRvbSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2xpZmVTcGVlZFJhbmRvbQogICAgICAgIH0KICAgICAgICBTZXRMaWZlT3BhY2l0eVJhbmRvbShvKSB7CiAgICAgICAgICAgIHRoaXMuX2xpZmVPcGFjaXR5UmFuZG9tID0gK28KICAgICAgICB9CiAgICAgICAgR2V0TGlmZU9wYWNpdHlSYW5kb20oKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9saWZlT3BhY2l0eVJhbmRvbQogICAgICAgIH0KICAgICAgICBTZXREZXN0cm95TW9kZShtKSB7CiAgICAgICAgICAgIGxldCBpID0gREVTVFJPWV9NT0RFUy5pbmRleE9mKG0pOwogICAgICAgICAgICBpZiAoaSA9PT0gLTEpIHRocm93IG5ldyBFcnJvcigiaW52YWxpZCBkZXN0cm95IG1vZGUiKTsKICAgICAgICAgICAgdGhpcy5fZGVzdHJveU1vZGUgPSBpCiAgICAgICAgfQogICAgICAgIFNldERlc3Ryb3lNb2RlSW5kZXgoaSkgewogICAgICAgICAgICB0aGlzLlNldERlc3Ryb3lNb2RlKERFU1RST1lfTU9ERVNbaV0pCiAgICAgICAgfQogICAgICAgIEdldERlc3Ryb3lNb2RlKCkgewogICAgICAgICAgICByZXR1cm4gREVTVFJPWV9NT0RFU1t0aGlzLl9kZXN0cm95TW9kZV0KICAgICAgICB9CiAgICAgICAgR2V0RGVzdHJveU1vZGVJbmRleCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2Rlc3Ryb3lNb2RlCiAgICAgICAgfQogICAgICAgIFNldFRpbWVvdXQodCkgewogICAgICAgICAgICB0aGlzLl90aW1lb3V0ID0gK3QKICAgICAgICB9CiAgICAgICAgR2V0VGltZW91dCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RpbWVvdXQKICAgICAgICB9CiAgICAgICAgU2V0UGFydGljbGVTY2FsZShzKSB7CiAgICAgICAgICAgIHRoaXMuX3BhcnRpY2xlU2NhbGUgPSArcwogICAgICAgIH0KICAgICAgICBHZXRQYXJ0aWNsZVNjYWxlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fcGFydGljbGVTY2FsZQogICAgICAgIH0KICAgICAgICBHZXRCb3VuZGluZ0JveCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2JvdW5kaW5nQm94CiAgICAgICAgfQogICAgfTsKCn0KCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIGNvbnN0IFBhcnRpY2xlRW5naW5lID0gc2VsZi5QYXJ0aWNsZUVuZ2luZTsKCiAgICBmdW5jdGlvbiByYW5kb21PZmZzZXQoeCkgewogICAgICAgIHJldHVybiBNYXRoLnJhbmRvbSgpICogeCAtIHggLyAyCiAgICB9CiAgICBjb25zdCB0bXBRdWFkID0gbmV3IEMzLlF1YWQ7CiAgICBjb25zdCB0bXBDb2xvciA9IG5ldyBDMy5Db2xvcjsKICAgIGNvbnN0IERQUiA9IHNlbGYuZGV2aWNlUGl4ZWxSYXRpbyB8fCAxOwogICAgbGV0IGRpZENoYW5nZUNvbG9yID0gZmFsc2U7CiAgICBzZWxmLlBhcnRpY2xlID0gY2xhc3MgUGFydGljbGUgewogICAgICAgIGNvbnN0cnVjdG9yKGVuZ2luZSkgewogICAgICAgICAgICB0aGlzLl9lbmdpbmUgPSBlbmdpbmU7CiAgICAgICAgICAgIHRoaXMuX2lzQWN0aXZlID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuX3ggPSAwOwogICAgICAgICAgICB0aGlzLl95ID0gMDsKICAgICAgICAgICAgdGhpcy5fc3BlZWQgPSAwOwogICAgICAgICAgICB0aGlzLl9hbmdsZSA9IDA7CiAgICAgICAgICAgIHRoaXMuX29wYWNpdHkgPSAxOwogICAgICAgICAgICB0aGlzLl9sYXN0T3BhY2l0eSA9IDA7CiAgICAgICAgICAgIHRoaXMuX2dyb3cgPSAwOwogICAgICAgICAgICB0aGlzLl9zaXplID0gMDsKICAgICAgICAgICAgdGhpcy5faGFsZlNpemUgPSAwOwogICAgICAgICAgICB0aGlzLl9ncyA9IDA7CiAgICAgICAgICAgIHRoaXMuX2FnZSA9IDA7CiAgICAgICAgICAgIHRoaXMuX2Jib3ggPSBuZXcgQzMuUmVjdDsKICAgICAgICAgICAgdGhpcy5fdXNlckRhdGEgPSBudWxsOwogICAgICAgICAgICB0aGlzLl91c2VyRGF0YVVpZCA9IE5hTjsKICAgICAgICAgICAgdGhpcy5fdXBkYXRlQ2FsbGJhY2sgPSBudWxsOwogICAgICAgICAgICB0aGlzLl9kZXN0cm95Q2FsbGJhY2sgPSBudWxsCiAgICAgICAgfQogICAgICAgIFNldEVuZ2luZShlbmdpbmUpIHsKICAgICAgICAgICAgdGhpcy5fZW5naW5lID0gZW5naW5lCiAgICAgICAgfQogICAgICAgIEluaXQocGFydGljbGVDcmVhdGVDYWxsYmFjaykgewogICAgICAgICAgICBjb25zdCBlbmdpbmUgPSB0aGlzLl9lbmdpbmU7CiAgICAgICAgICAgIHRoaXMuX2lzQWN0aXZlID0gdHJ1ZTsKICAgICAgICAgICAgdGhpcy5feCA9IGVuZ2luZS5HZXRTcGF3blgoKSArIHJhbmRvbU9mZnNldChlbmdpbmUuR2V0SW5pdFhSYW5kb20oKSk7CiAgICAgICAgICAgIHRoaXMuX3kgPSBlbmdpbmUuR2V0U3Bhd25ZKCkgKyByYW5kb21PZmZzZXQoZW5naW5lLkdldEluaXRZUmFuZG9tKCkpOwogICAgICAgICAgICB0aGlzLl9zcGVlZCA9IGVuZ2luZS5HZXRJbml0U3BlZWQoKSArIHJhbmRvbU9mZnNldChlbmdpbmUuR2V0SW5pdFNwZWVkUmFuZG9tKCkpOwogICAgICAgICAgICB0aGlzLl9hbmdsZSA9IGVuZ2luZS5HZXRJbml0QW5nbGUoKSArIHJhbmRvbU9mZnNldChlbmdpbmUuR2V0U3ByYXlDb25lKCkpOwogICAgICAgICAgICB0aGlzLl9vcGFjaXR5ID0gZW5naW5lLkdldEluaXRPcGFjaXR5KCk7CiAgICAgICAgICAgIHRoaXMuX2xhc3RPcGFjaXR5ID0gdGhpcy5fb3BhY2l0eTsKICAgICAgICAgICAgdGhpcy5fc2l6ZSA9IChlbmdpbmUuR2V0SW5pdFNpemUoKSArIHJhbmRvbU9mZnNldChlbmdpbmUuR2V0SW5pdFNpemVSYW5kb20oKSkpICogZW5naW5lLkdldEluaXRTaXplU2NhbGUoKTsKICAgICAgICAgICAgdGhpcy5faGFsZlNpemUgPSB0aGlzLl9zaXplIC8gMjsKICAgICAgICAgICAgdGhpcy5fZ3JvdyA9IGVuZ2luZS5HZXRHcm93UmF0ZSgpICsgcmFuZG9tT2Zmc2V0KGVuZ2luZS5HZXRHcm93UmFuZG9tKCkpOwogICAgICAgICAgICB0aGlzLl9ncyA9IDA7CiAgICAgICAgICAgIHRoaXMuX2FnZSA9IDA7CiAgICAgICAgICAgIHRoaXMuX1VwZGF0ZUJvdW5kaW5nQm94KCk7CiAgICAgICAgICAgIGlmIChwYXJ0aWNsZUNyZWF0ZUNhbGxiYWNrKSB7CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX3VzZXJEYXRhKSB0aGlzLl91c2VyRGF0YSA9IHBhcnRpY2xlQ3JlYXRlQ2FsbGJhY2sodGhpcykKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuX3VzZXJEYXRhID0gbnVsbDsKICAgICAgICAgICAgICAgIHRoaXMuX3VwZGF0ZUNhbGxiYWNrID0gbnVsbDsKICAgICAgICAgICAgICAgIHRoaXMuX2Rlc3Ryb3lDYWxsYmFjayA9IG51bGwKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBVcGRhdGVVc2VyRGF0YShwYXJ0aWNsZUNyZWF0ZUNhbGxiYWNrKSB7CiAgICAgICAgICAgIGlmIChwYXJ0aWNsZUNyZWF0ZUNhbGxiYWNrKSB7CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX3VzZXJEYXRhIHx8IHRoaXMuX3VzZXJEYXRhLklzRGVzdHJveWVkKCkpIHRoaXMuX3VzZXJEYXRhID0gcGFydGljbGVDcmVhdGVDYWxsYmFjayh0aGlzKQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5fdXNlckRhdGEgPSBudWxsOwogICAgICAgICAgICAgICAgdGhpcy5fdXBkYXRlQ2FsbGJhY2sgPSBudWxsOwogICAgICAgICAgICAgICAgdGhpcy5fZGVzdHJveUNhbGxiYWNrID0gbnVsbAogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIFNldFVwZGF0ZUNhbGxiYWNrKGYpIHsKICAgICAgICAgICAgdGhpcy5fdXBkYXRlQ2FsbGJhY2sgPSBmCiAgICAgICAgfQogICAgICAgIFNldERlc3Ryb3lDYWxsYmFjayhmKSB7CiAgICAgICAgICAgIHRoaXMuX2Rlc3Ryb3lDYWxsYmFjayA9CiAgICAgICAgICAgICAgICBmCiAgICAgICAgfQogICAgICAgIERlc3Ryb3koKSB7CiAgICAgICAgICAgIGNvbnN0IHBhcnRpY2xlRGVzdHJveUNhbGxiYWNrID0gdGhpcy5fZGVzdHJveUNhbGxiYWNrOwogICAgICAgICAgICBpZiAocGFydGljbGVEZXN0cm95Q2FsbGJhY2spIHBhcnRpY2xlRGVzdHJveUNhbGxiYWNrKHRoaXMuX3VzZXJEYXRhKTsKICAgICAgICAgICAgdGhpcy5fdXNlckRhdGEgPSBudWxsOwogICAgICAgICAgICB0aGlzLl91cGRhdGVDYWxsYmFjayA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuX2Rlc3Ryb3lDYWxsYmFjayA9IG51bGwKICAgICAgICB9CiAgICAgICAgdG9KU09OKCkgewogICAgICAgICAgICBsZXQgdWlkOwogICAgICAgICAgICBpZiAodGhpcy5fdXNlckRhdGEpIHVpZCA9IHRoaXMuX3VzZXJEYXRhLkdldFdvcmxkSW5mbygpLkdldEluc3RhbmNlKCkuR2V0VUlEKCk7CiAgICAgICAgICAgIHJldHVybiBbdGhpcy5feCwgdGhpcy5feSwgdGhpcy5fc3BlZWQsIHRoaXMuX2FuZ2xlLCB0aGlzLl9vcGFjaXR5LCB0aGlzLl9ncm93LCB0aGlzLl9zaXplLCB0aGlzLl9ncywgdGhpcy5fYWdlLCB1aWRdCiAgICAgICAgfQogICAgICAgIHNldEZyb21KU09OKG8pIHsKICAgICAgICAgICAgdGhpcy5feCA9IG9bMF07CiAgICAgICAgICAgIHRoaXMuX3kgPSBvWzFdOwogICAgICAgICAgICB0aGlzLl9zcGVlZCA9IG9bMl07CiAgICAgICAgICAgIHRoaXMuX2FuZ2xlID0gb1szXTsKICAgICAgICAgICAgdGhpcy5fb3BhY2l0eSA9IG9bNF07CiAgICAgICAgICAgIHRoaXMuX2dyb3cgPQogICAgICAgICAgICAgICAgb1s1XTsKICAgICAgICAgICAgdGhpcy5fc2l6ZSA9IG9bNl07CiAgICAgICAgICAgIHRoaXMuX2dzID0gb1s3XTsKICAgICAgICAgICAgdGhpcy5fYWdlID0gb1s4XTsKICAgICAgICAgICAgdGhpcy5fdXNlckRhdGFVaWQgPSBvWzldOwogICAgICAgICAgICB0aGlzLl9oYWxmU2l6ZSA9IHRoaXMuX3NpemUgLyAyOwogICAgICAgICAgICB0aGlzLl9VcGRhdGVCb3VuZGluZ0JveCgpCiAgICAgICAgfQogICAgICAgIFRpY2soZHQpIHsKICAgICAgICAgICAgY29uc3QgZW5naW5lID0gdGhpcy5fZW5naW5lOwogICAgICAgICAgICBjb25zdCBkaXN0ID0gdGhpcy5fc3BlZWQgKiBkdDsKICAgICAgICAgICAgY29uc3QgYSA9IHRoaXMuX2FuZ2xlOwogICAgICAgICAgICBjb25zdCBkeCA9IE1hdGguY29zKGEpICogZGlzdDsKICAgICAgICAgICAgY29uc3QgZHkgPSBNYXRoLnNpbihhKSAqIGRpc3QgKyB0aGlzLl9ncyAqIGR0OwogICAgICAgICAgICB0aGlzLl94ICs9IGR4OwogICAgICAgICAgICB0aGlzLl95ICs9IGR5OwogICAgICAgICAgICBjb25zdCBkU2l6ZSA9IHRoaXMuX2dyb3cgKiBkdDsKICAgICAgICAgICAgdGhpcy5fc2l6ZSArPSBkU2l6ZTsKICAgICAgICAgICAgdGhpcy5faGFsZlNpemUgPSB0aGlzLl9zaXplIC8gMjsKICAgICAgICAgICAgdGhpcy5fc3BlZWQgKz0gZW5naW5lLkdldEFjY2VsZXJhdGlvbigpICogZHQ7CiAgICAgICAgICAgIHRoaXMuX2dzICs9IGVuZ2luZS5HZXRHcmF2aXR5KCkgKiBkdDsKICAgICAgICAgICAgdGhpcy5fYWdlICs9IGR0OwogICAgICAgICAgICB0aGlzLl9VcGRhdGVCb3VuZGluZ0JveCgpOwogICAgICAgICAgICBjb25zdCBsaWZlQW5nbGVSYW5kb20gPQogICAgICAgICAgICAgICAgZW5naW5lLkdldExpZmVBbmdsZVJhbmRvbSgpOwogICAgICAgICAgICBjb25zdCBsaWZlU3BlZWRSYW5kb20gPSBlbmdpbmUuR2V0TGlmZVNwZWVkUmFuZG9tKCk7CiAgICAgICAgICAgIGNvbnN0IGxpZmVPcGFjaXR5UmFuZG9tID0gZW5naW5lLkdldExpZmVPcGFjaXR5UmFuZG9tKCk7CiAgICAgICAgICAgIGxldCBkQW5nbGUgPSAwOwogICAgICAgICAgICBpZiAobGlmZUFuZ2xlUmFuZG9tICE9PSAwKSB7CiAgICAgICAgICAgICAgICBkQW5nbGUgPSByYW5kb21PZmZzZXQobGlmZUFuZ2xlUmFuZG9tICogZHQpOwogICAgICAgICAgICAgICAgdGhpcy5fYW5nbGUgKz0gZEFuZ2xlCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGxpZmVTcGVlZFJhbmRvbSAhPT0gMCkgdGhpcy5fc3BlZWQgKz0gcmFuZG9tT2Zmc2V0KGxpZmVTcGVlZFJhbmRvbSAqIGR0KTsKICAgICAgICAgICAgaWYgKGxpZmVPcGFjaXR5UmFuZG9tICE9PSAwKSB0aGlzLl9vcGFjaXR5ID0gQzMuY2xhbXAodGhpcy5fb3BhY2l0eSArIHJhbmRvbU9mZnNldChsaWZlT3BhY2l0eVJhbmRvbSAqIGR0KSwgMCwgMSk7CiAgICAgICAgICAgIGNvbnN0IGlzQWN0aXZlID0gdGhpcy5fc2l6ZSA+PSAxICYmIChlbmdpbmUuR2V0RGVzdHJveU1vZGVJbmRleCgpID09PSAyID8gdGhpcy5fc3BlZWQgPiAwIDogdGhpcy5fYWdlIDwgZW5naW5lLkdldFRpbWVvdXQoKSk7CiAgICAgICAgICAgIGNvbnN0IHBhcnRpY2xlVXBkYXRlQ2FsbGJhY2sgPSB0aGlzLl91cGRhdGVDYWxsYmFjazsKICAgICAgICAgICAgaWYgKHBhcnRpY2xlVXBkYXRlQ2FsbGJhY2sgJiYgaXNBY3RpdmUpIHsKICAgICAgICAgICAgICAgIGxldCBjdXJPcGFjaXR5ID0gZW5naW5lLkdldE1hc3Rlck9wYWNpdHkoKSAqIHRoaXMuX29wYWNpdHk7CiAgICAgICAgICAgICAgICBpZiAoZW5naW5lLkdldERlc3Ryb3lNb2RlSW5kZXgoKSA9PT0gMCkgY3VyT3BhY2l0eSAqPSAxIC0gdGhpcy5fYWdlIC8gZW5naW5lLkdldFRpbWVvdXQoKTsKICAgICAgICAgICAgICAgIGNvbnN0IGRPcGFjaXR5ID0gY3VyT3BhY2l0eSAtIHRoaXMuX2xhc3RPcGFjaXR5OwogICAgICAgICAgICAgICAgdGhpcy5fbGFzdE9wYWNpdHkgPSBjdXJPcGFjaXR5OwogICAgICAgICAgICAgICAgcGFydGljbGVVcGRhdGVDYWxsYmFjayh0aGlzLl91c2VyRGF0YSwgZHgsIGR5LCBkU2l6ZSwgZEFuZ2xlLCBkT3BhY2l0eSkKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLl9pc0FjdGl2ZSA9IGlzQWN0aXZlCiAgICAgICAgfQogICAgICAgIElzQWN0aXZlKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faXNBY3RpdmUKICAgICAgICB9CiAgICAgICAgR2V0Qm91bmRpbmdCb3goKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9iYm94CiAgICAgICAgfQogICAgICAgIF9VcGRhdGVCb3VuZGluZ0JveCgpIHsKICAgICAgICAgICAgY29uc3QgeCA9IHRoaXMuX3g7CiAgICAgICAgICAgIGNvbnN0IHkgPSB0aGlzLl95OwogICAgICAgICAgICBjb25zdCBoYWxmU2l6ZSA9IHRoaXMuX2hhbGZTaXplOwogICAgICAgICAgICB0aGlzLl9iYm94LnNldCh4IC0gaGFsZlNpemUsIHkgLSBoYWxmU2l6ZSwgeCArIGhhbGZTaXplLCB5ICsgaGFsZlNpemUpCiAgICAgICAgfQogICAgICAgIERyYXcocmVuZGVyZXIsIHRleFF1YWQsIGZvcmNlUXVhZHMpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX3VzZXJEYXRhKSByZXR1cm47CiAgICAgICAgICAgIGNvbnN0IGVuZ2luZSA9IHRoaXMuX2VuZ2luZTsKICAgICAgICAgICAgbGV0IG9wYWNpdHkgPSBlbmdpbmUuR2V0TWFzdGVyT3BhY2l0eSgpICogdGhpcy5fb3BhY2l0eTsKICAgICAgICAgICAgaWYgKGVuZ2luZS5HZXREZXN0cm95TW9kZUluZGV4KCkgPT09IDApIG9wYWNpdHkgKj0gMSAtIHRoaXMuX2FnZSAvIGVuZ2luZS5HZXRUaW1lb3V0KCk7CiAgICAgICAgICAgIGlmIChvcGFjaXR5IDw9IDApIHJldHVybjsKICAgICAgICAgICAgY29uc3Qgc2l6ZSA9IHRoaXMuX3NpemU7CiAgICAgICAgICAgIGNvbnN0IHNjYWxlZFNpemUgPSBzaXplICogZW5naW5lLkdldFBhcnRpY2xlU2NhbGUoKSAqIERQUjsKICAgICAgICAgICAgaWYgKHNjYWxlZFNpemUgPCAxKSByZXR1cm47CiAgICAgICAgICAgIGxldCB4ID0gdGhpcy5feDsKICAgICAgICAgICAgbGV0IHkgPSB0aGlzLl95OwogICAgICAgICAgICBpZiAoZW5naW5lLklzUGl4ZWxSb3VuZGluZygpKSB7CiAgICAgICAgICAgICAgICB4ID0geCArIC41IHwgMDsKICAgICAgICAgICAgICAgIHkgPSB5ICsgLjUgfCAwCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHJlbmRlcmVyLklzV2ViR1BVKCkpIHJlbmRlcmVyLlBvaW50KHgsCiAgICAgICAgICAgICAgICB5LCBzaXplLCBvcGFjaXR5KTsKICAgICAgICAgICAgZWxzZSBpZiAoZm9yY2VRdWFkcyB8fCBzY2FsZWRTaXplID4gcmVuZGVyZXIuR2V0TWF4UG9pbnRTaXplKCkgfHwgc2NhbGVkU2l6ZSA8IHJlbmRlcmVyLkdldE1pblBvaW50U2l6ZSgpKSB7CiAgICAgICAgICAgICAgICB0bXBDb2xvci5jb3B5KGVuZ2luZS5HZXRDb2xvcigpKTsKICAgICAgICAgICAgICAgIHRtcENvbG9yLm11bHRpcGx5QWxwaGEob3BhY2l0eSk7CiAgICAgICAgICAgICAgICByZW5kZXJlci5TZXRDb2xvcih0bXBDb2xvcik7CiAgICAgICAgICAgICAgICBkaWRDaGFuZ2VDb2xvciA9IHRydWU7CiAgICAgICAgICAgICAgICB0bXBRdWFkLnNldEZyb21SZWN0KHRoaXMuX2Jib3gpOwogICAgICAgICAgICAgICAgcmVuZGVyZXIuUXVhZDQodG1wUXVhZCwgdGV4UXVhZCkKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlmIChkaWRDaGFuZ2VDb2xvcikgewogICAgICAgICAgICAgICAgICAgIHJlbmRlcmVyLlNldENvbG9yKGVuZ2luZS5HZXRDb2xvcigpKTsKICAgICAgICAgICAgICAgICAgICBkaWRDaGFuZ2VDb2xvciA9IGZhbHNlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZW5kZXJlci5Qb2ludCh4LCB5LCBzY2FsZWRTaXplLCBvcGFjaXR5KQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIEdldFVzZXJEYXRhKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fdXNlckRhdGEKICAgICAgICB9CiAgICAgICAgR2V0VXNlckRhdGFVSUQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl91c2VyRGF0YVVpZAogICAgICAgIH0KICAgICAgICBHZXRYKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5feAogICAgICAgIH0KICAgICAgICBHZXRZKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5feQogICAgICAgIH0KICAgICAgICBHZXRTaXplKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fc2l6ZQogICAgICAgIH0KICAgICAgICBHZXRBbmdsZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2FuZ2xlCiAgICAgICAgfQogICAgICAgIEdldE9wYWNpdHkoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9vcGFjaXR5CiAgICAgICAgfQogICAgfTsKCn0KCnsKICAgICJ1c2Ugc3RyaWN0IjsgewogICAgICAgIEMzLlBsdWdpbnMuRXBvbmVzaF9ZYW5kZXhTREsgPSBjbGFzcyBZYW5kZXhTREtQbHVnaW4gZXh0ZW5kcyBDMy5TREtET01QbHVnaW5CYXNlIHsKICAgICAgICAgICAgY29uc3RydWN0b3Iob3B0cykgewogICAgICAgICAgICAgICAgc3VwZXIob3B0cywgJ0Vwb25lc2hfWWFuZGV4U0RLJyk7CgogICAgICAgICAgICAgICAgdGhpcy5hZGRIYW5kbGVyKCdZU0RLX0FEU19SRVdBUkRFRF9PUEVOJywgKGluc3QsIGUpID0+IGluc3Qub25SZXdhcmRlZE9wZW4oZSkpOwogICAgICAgICAgICAgICAgdGhpcy5hZGRIYW5kbGVyKCdZU0RLX0FEU19SRVdBUkRFRF9SRVdBUkQnLCAoaW5zdCwgZSkgPT4gaW5zdC5vblJld2FyZGVkUmV3YXJkKGUpKTsKICAgICAgICAgICAgICAgIHRoaXMuYWRkSGFuZGxlcignWVNES19BRFNfUkVXQVJERURfQ0xPU0UnLCAoaW5zdCwgZSkgPT4gaW5zdC5vblJld2FyZGVkQ2xvc2UoZSkpOwogICAgICAgICAgICAgICAgdGhpcy5hZGRIYW5kbGVyKCdZU0RLX0FEU19SRVdBUkRFRF9FUlJPUicsIChpbnN0LCBlKSA9PiBpbnN0Lm9uUmV3YXJkZWRFcnJvcihlKSk7CgogICAgICAgICAgICAgICAgdGhpcy5hZGRIYW5kbGVyKCdTREtfQURTX0NMT1NFRCcsIChpbnN0LCBlKSA9PiBpbnN0Lm9uQWR2Q2xvc2VkKGUpKTsKICAgICAgICAgICAgICAgIHRoaXMuYWRkSGFuZGxlcignU0RLX1JUQl9SRU5ERVInLCAoaW5zdCwgZSkgPT4gaW5zdC5vblJUQlJlbmRlcihlKSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGFkZEhhbmRsZXIoaGFuZGxlciwgY2IpIHsKICAgICAgICAgICAgICAgIHRoaXMuQWRkRWxlbWVudE1lc3NhZ2VIYW5kbGVyKGhhbmRsZXIsIChfLCBlKSA9PiBjYih0aGlzLkdldFNpbmdsZUdsb2JhbEluc3RhbmNlKCkuR2V0U2RrSW5zdGFuY2UoKSwgZSkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBSZWxlYXNlKCkgewogICAgICAgICAgICAgICAgc3VwZXIuUmVsZWFzZSgpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgIH0KCn0KCnsKICAgICJ1c2Ugc3RyaWN0IjsgewogICAgICAgIEMzLlBsdWdpbnMuRXBvbmVzaF9ZYW5kZXhTREsuVHlwZSA9IGNsYXNzIFlhbmRleFNES1R5cGUgZXh0ZW5kcyBDMy5TREtUeXBlQmFzZSB7CiAgICAgICAgICAgIGNvbnN0cnVjdG9yKG9iamVjdENsYXNzKSB7CiAgICAgICAgICAgICAgICBzdXBlcihvYmplY3RDbGFzcyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIFJlbGVhc2UoKSB7CiAgICAgICAgICAgICAgICBzdXBlci5SZWxlYXNlKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIE9uQ3JlYXRlKCkge30KICAgICAgICB9OwogICAgfQoKfQoKewogICAgInVzZSBzdHJpY3QiOyB7CiAgICAgICAgdmFyIFNES0RPTUluc3RhbmNlQmFzZSA9IGdsb2JhbFRoaXMuQzMgPyBnbG9iYWxUaGlzLkMzLlNES0RPTUluc3RhbmNlQmFzZSA6IGNsYXNzIHt9CiAgICAgICAgdmFyIEluc3RhbmNlID0gY2xhc3MgWWFuZGV4U0RLSW5zdGFuY2UgZXh0ZW5kcyBTREtET01JbnN0YW5jZUJhc2UgewogICAgICAgICAgICBjb25zdHJ1Y3RvcihpbnN0LCBwcm9wZXJ0aWVzID0gW10pIHsKICAgICAgICAgICAgICAgIHN1cGVyKGluc3QsICdFcG9uZXNoX1lhbmRleFNESycpOwogICAgICAgICAgICAgICAgaWYgKCFnbG9iYWxUaGlzLkMzKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5jb25kaXRpb25zID0gQzMuUGx1Z2lucy5FcG9uZXNoX1lhbmRleFNESy5DbmRzOwogICAgICAgICAgICAgICAgdGhpcy5pbml0KHByb3BlcnRpZXMpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBhc3luYyBpbml0KHByb3BlcnRpZXMpIHsKICAgICAgICAgICAgICAgIHRoaXMuZW5hYmxlRnVsbHNjcmVlbk9uU3RhcnQgPSBwcm9wZXJ0aWVzWzBdOwogICAgICAgICAgICAgICAgdGhpcy5zZXRPcmllbnRhdGlvbihwcm9wZXJ0aWVzWzFdKTsKICAgICAgICAgICAgICAgIHRoaXMuaXNPcmllbnRhdGlvbkxvY2tlZCA9IHByb3BlcnRpZXNbMl07CgogICAgICAgICAgICAgICAgdGhpcy5tZXRyaWNhSWQgPSBwcm9wZXJ0aWVzWzNdOwogICAgICAgICAgICAgICAgdGhpcy5lbmFibGVSVEIgPSBwcm9wZXJ0aWVzWzRdOwoKICAgICAgICAgICAgICAgIHRoaXMuYmFubmVycyA9IHt9OwogICAgICAgICAgICAgICAgdGhpcy5pc1Jld2FyZGVkVmlkZW9QbGF5aW5nID0gZmFsc2U7CgogICAgICAgICAgICAgICAgdGhpcy5wdXJjaGFzZXMgPSBbXTsKICAgICAgICAgICAgICAgIHRoaXMucHJvZHVjdHMgPSBbXTsKCiAgICAgICAgICAgICAgICB0aGlzLnBsYXllckRhdGEgPSB7fTsKICAgICAgICAgICAgICAgIHRoaXMucGxheWVyU3RhdHMgPSB7fTsKCiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRQcm9kdWN0SUQgPSAnJzsKICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFByb2R1Y3RUaXRsZSA9ICcnOwogICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50UHJvZHVjdEltYWdlID0gJyc7CiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRQcm9kdWN0RGVzY3JpcHRpb24gPSAnJzsKICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFByb2R1Y3RQcmljZSA9IDA7CgogICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50UHVyY2hhc2VJRCA9ICcnOwogICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50UHVyY2hhc2VUb2tlbiA9ICcnOwogICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50UHVyY2hhc2VTaWduID0gJyc7CgogICAgICAgICAgICAgICAgdGhpcy5sYXN0UHVyY2hhc2VJRCA9ICcnOwogICAgICAgICAgICAgICAgdGhpcy5sYXN0UHVyY2hhc2VUb2tlbiA9ICcnOwoKICAgICAgICAgICAgICAgIHRoaXMubGFzdFN0YXRlS2V5ID0gJyc7CiAgICAgICAgICAgICAgICB0aGlzLmxhc3REYXRhS2V5ID0gJyc7CgogICAgICAgICAgICAgICAgdGhpcy5wbGF5ZXIgPSB7CiAgICAgICAgICAgICAgICAgICAgbmFtZTogJycsCiAgICAgICAgICAgICAgICAgICAgaWQ6ICcnLAogICAgICAgICAgICAgICAgICAgIHBob3RvU21hbGw6ICcnLAogICAgICAgICAgICAgICAgICAgIHBob3RvTWVkaXVtOiAnJywKICAgICAgICAgICAgICAgICAgICBwaG90b0xhcmdlOiAnJwogICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICBpZiAodGhpcy5tZXRyaWNhSWQpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLm1ldHJpY2FSZWFkeSA9IHRoaXMuUG9zdFRvRE9NRWxlbWVudEFzeW5jKCdJTklUX01FVFJJQ0EnLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIG1ldHJpY2FJZDogdGhpcy5tZXRyaWNhSWQKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAodGhpcy5lbmFibGVSVEIpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnJ0YlJlYWR5ID0gdGhpcy5Qb3N0VG9ET01FbGVtZW50QXN5bmMoJ0lOSVRfUlRCJyk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgY29uc3Qgc2NyZWVuID0gewogICAgICAgICAgICAgICAgICAgIGZ1bGxzY3JlZW46IHRoaXMuZW5hYmxlRnVsbHNjcmVlbk9uU3RhcnQKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBpZiAodGhpcy5mdWxsc2NyZWVuT3JpZW50YXRpb24gIT09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBzY3JlZW4ub3JpZW50YXRpb24gPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLmZ1bGxzY3JlZW5PcmllbnRhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgbG9jazogdGhpcy5pc09yaWVudGF0aW9uTG9ja2VkCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0aGlzLnJlYWR5ID0gdGhpcy5Qb3N0VG9ET01FbGVtZW50QXN5bmMoJ0lOSVRfU0RLJywgewogICAgICAgICAgICAgICAgICAgIHNjcmVlbgogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnJlYWR5OwogICAgICAgICAgICAgICAgdGhpcy5wYXltZW50c1JlYWR5ID0gdGhpcy5fZ2V0UGF5bWVudHMoewogICAgICAgICAgICAgICAgICAgIHNpZ25lZDogdHJ1ZQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIFJlbGVhc2UoKSB7CiAgICAgICAgICAgICAgICBzdXBlci5SZWxlYXNlKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIFNhdmVUb0pzb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgIC8vIGRhdGEgdG8gYmUgc2F2ZWQgZm9yIHNhdmVnYW1lcwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgTG9hZEZyb21Kc29uKG8pIHsKICAgICAgICAgICAgICAgIC8vIGxvYWQgc3RhdGUgZm9yIHNhdmVnYW1lcwogICAgICAgICAgICB9CgogICAgICAgICAgICBHZXREZWJ1Z2dlclByb3BlcnRpZXMoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gW3sKICAgICAgICAgICAgICAgICAgICB0aXRsZTogIllhbmRleFNESyIsCiAgICAgICAgICAgICAgICAgICAgcHJvcGVydGllczogW10KICAgICAgICAgICAgICAgIH1dOwogICAgICAgICAgICB9CgogICAgICAgICAgICBzZXRPcmllbnRhdGlvbihvcmllbnRhdGlvbikgewogICAgICAgICAgICAgICAgc3dpdGNoIChvcmllbnRhdGlvbikgewogICAgICAgICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5mdWxsc2NyZWVuT3JpZW50YXRpb24gPSAncG9ydHJhaXQnOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZnVsbHNjcmVlbk9yaWVudGF0aW9uID0gJ2xhbmRzY2FwZSc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZnVsbHNjcmVlbk9yaWVudGF0aW9uID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBvbkFkdkNsb3NlZCh7CiAgICAgICAgICAgICAgICB3YXNTaG93bgogICAgICAgICAgICB9KSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnQWR2IHdhcyBjbG9zZWQsIHNob3duOicsIHdhc1Nob3duKTsKICAgICAgICAgICAgICAgIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25BZHZDbG9zZWQpOwoKICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzRmlyc3RBZHZDbG9zZWQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhpcy5pc0ZpcnN0QWR2Q2xvc2VkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25GaXJzdEFkdkNsb3NlZCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGFzeW5jIGdldFBsYXllcigpIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcGxheWVyID0gYXdhaXQgdGhpcy5fZ2V0UGxheWVyKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRQbGF5ZXIocGxheWVyKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuX29wZW5BdXRoRGlhbG9nKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHBsYXllciA9IGF3YWl0IHRoaXMuX2dldFBsYXllcigpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFBsYXllcihwbGF5ZXIpOwogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uU2lnbkluRmFpbGVkKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGFzeW5jIHNldFBsYXllcihwbGF5ZXIpIHsKICAgICAgICAgICAgICAgIHRoaXMucGxheWVyID0gcGxheWVyOwogICAgICAgICAgICAgICAgdGhpcy5wbGF5ZXJTdGF0cyA9IHt9OwogICAgICAgICAgICAgICAgdGhpcy5wbGF5ZXJEYXRhID0ge307CiAgICAgICAgICAgICAgICB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uU2lnbkluU3VjY2Vzcyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGdldFB1cmNoYXNlKGlkKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wdXJjaGFzZXMuZmluZChwID0+IHAucHJvZHVjdElEID09PSBpZCkgfHwge307CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGdldFByb2R1Y3QoaWQpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnByb2R1Y3RzLmZpbmQocCA9PiBwLnByb2R1Y3RJRCA9PT0gaWQpIHx8IHt9OwogICAgICAgICAgICB9CgogICAgICAgICAgICBvblJld2FyZGVkT3BlbigpIHsKICAgICAgICAgICAgICAgIHRoaXMuaXNSZXdhcmRlZFZpZGVvUGxheWluZyA9IHRydWU7CiAgICAgICAgICAgICAgICB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uUmV3YXJkZWRWaWRlb09wZW4pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBvblJld2FyZGVkUmV3YXJkKCkgewogICAgICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PblJld2FyZGVkVmlkZW9SZXdhcmQpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBvblJld2FyZGVkQ2xvc2UoKSB7CiAgICAgICAgICAgICAgICB0aGlzLmlzUmV3YXJkZWRWaWRlb1BsYXlpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25SZXdhcmRlZFZpZGVvQ2xvc2UpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBvblJld2FyZGVkRXJyb3IoKSB7CiAgICAgICAgICAgICAgICB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uUmV3YXJkZWRWaWRlb0Vycm9yKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgb25SVEJSZW5kZXIoewogICAgICAgICAgICAgICAgaWQKICAgICAgICAgICAgfSkgewogICAgICAgICAgICAgICAgdGhpcy5iYW5uZXJzW2lkXS5kaXNwbGF5ZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgdGhpcy5sYXN0QmFubmVySUQgPSBpZDsKICAgICAgICAgICAgICAgIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25CYW5uZXJEaXNwbGF5ZWQpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBfZ2V0UGF5bWVudHMob3B0aW9ucykgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuUG9zdFRvRE9NRWxlbWVudEFzeW5jKCdZU0RLX1BBWU1FTlRTX0dFVCcsIG9wdGlvbnMpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBfZ2V0UHVyY2hhc2VzKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuUG9zdFRvRE9NRWxlbWVudEFzeW5jKCdZU0RLX1BBWU1FTlRTX0dFVF9QVVJDSEFTRVMnKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgX2dldENhdGFsb2coKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5Qb3N0VG9ET01FbGVtZW50QXN5bmMoJ1lTREtfUEFZTUVOVFNfR0VUX0NBVEFMT0cnKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgX3B1cmNoYXNlKG9wdGlvbnMpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLlBvc3RUb0RPTUVsZW1lbnRBc3luYygnWVNES19QQVlNRU5UU19QVVJDSEFTRScsIG9wdGlvbnMpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBfY29uc3VtZVB1cmNoYXNlKG9wdGlvbnMpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLlBvc3RUb0RPTUVsZW1lbnRBc3luYygnWVNES19QQVlNRU5UU19DT05TVU1FX1BVUkNIQVNFJywgb3B0aW9ucyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIF9vcGVuQXV0aERpYWxvZygpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLlBvc3RUb0RPTUVsZW1lbnRBc3luYygnWVNES19BVVRIX09QRU4nKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgX2dldFBsYXllcigpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLlBvc3RUb0RPTUVsZW1lbnRBc3luYygnWVNES19QTEFZRVJfR0VUJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIF9zaG93RnVsbHNjcmVlbkFkdigpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLlBvc3RUb0RPTUVsZW1lbnRBc3luYygnWVNES19BRFNfU0hPV19GVUxMU0NSRUVOJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIF9zaG93UmV3YXJkZWRWaWRlbygpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLlBvc3RUb0RPTUVsZW1lbnRBc3luYygnWVNES19BRFNfU0hPV19SRVdBUkRFRCcpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBfZ2V0UGxheWVyRnVsbFN0YXRzKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuUG9zdFRvRE9NRWxlbWVudEFzeW5jKCdZU0RLX1BMQVlFUl9HRVRfRlVMTF9TVEFUUycpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBfZ2V0UGxheWVyU3RhdHMocGF5bG9hZCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuUG9zdFRvRE9NRWxlbWVudEFzeW5jKCdZU0RLX1BMQVlFUl9HRVRfU1RBVFMnLCBwYXlsb2FkKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgX3NldFBsYXllclN0YXRzKHBheWxvYWQpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLlBvc3RUb0RPTUVsZW1lbnRBc3luYygnWVNES19QTEFZRVJfU0VUX1NUQVRTJywgcGF5bG9hZCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIF9pbmNyZW1lbnRQbGF5ZXJTdGF0cyhwYXlsb2FkKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5Qb3N0VG9ET01FbGVtZW50QXN5bmMoJ1lTREtfUExBWUVSX0lOQ1JFTUVOVF9TVEFUUycsIHBheWxvYWQpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBfZ2V0UGxheWVyRnVsbERhdGEoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5Qb3N0VG9ET01FbGVtZW50QXN5bmMoJ1lTREtfUExBWUVSX0dFVF9GVUxMX0RBVEEnKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgX2dldFBsYXllckRhdGEocGF5bG9hZCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuUG9zdFRvRE9NRWxlbWVudEFzeW5jKCdZU0RLX1BMQVlFUl9HRVRfREFUQScsIHBheWxvYWQpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBfc2V0UGxheWVyRGF0YShwYXlsb2FkKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5Qb3N0VG9ET01FbGVtZW50QXN5bmMoJ1lTREtfUExBWUVSX1NFVF9EQVRBJywgcGF5bG9hZCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIF9yZWFjaEdvYWwocGF5bG9hZCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuUG9zdFRvRE9NRWxlbWVudCgnWVNES19NRVRSSUNBX1JFQUNIX0dPQUwnLCBwYXlsb2FkKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgX3J0YkNyZWF0ZUJhbm5lcihwYXlsb2FkKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5Qb3N0VG9ET01FbGVtZW50KCdZU0RLX1JUQl9DUkVBVEVfQkFOTkVSJywgcGF5bG9hZCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIF9ydGJDcmVhdGVTdGlja3lCYW5uZXIocGF5bG9hZCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuUG9zdFRvRE9NRWxlbWVudCgnWVNES19SVEJfQ1JFQVRFX1NUSUNLWV9CQU5ORVInLCBwYXlsb2FkKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgX3J0YkRlc3Ryb3lCYW5uZXIocGF5bG9hZCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuUG9zdFRvRE9NRWxlbWVudCgnWVNES19SVEJfREVTVFJPWV9CQU5ORVInLCBwYXlsb2FkKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgX3J0YlJlZnJlc2hCYW5uZXIocGF5bG9hZCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuUG9zdFRvRE9NRWxlbWVudCgnWVNES19SVEJfUkVGUkVTSF9CQU5ORVInLCBwYXlsb2FkKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIEBvdmVycmlkZQogICAgICAgICAgICAgKiBQbHVnaW4gbXVzdCBiZSByZWdpc3RlcmVkIGFzIHdvcmxkIGluc3RhbmNlCiAgICAgICAgICAgICAqIGFuZCByZXF1aXJlZCB0byBiZSByZW5kZXJlZCBvbiBsYXlvdXQsIGJ1dCA6KSBqdXN0IGlnbm9yZSBpdAogICAgICAgICAgICAgKi8KICAgICAgICAgICAgVGljaygpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIGlmIChnbG9iYWxUaGlzLkMzKSB7CiAgICAgICAgICAgIEMzLlBsdWdpbnMuRXBvbmVzaF9ZYW5kZXhTREsuSW5zdGFuY2UgPSBJbnN0YW5jZTsKICAgICAgICB9CgogICAgICAgIEluc3RhbmNlOwogICAgfQoKfQoKewogICAgInVzZSBzdHJpY3QiOyB7CiAgICAgICAgZnVuY3Rpb24gZWFjaChydW50aW1lLCBhcnJheSwgY2IpIHsKICAgICAgICAgICAgY29uc3QgZXZlbnRTaGVldE1hbmFnZXIgPSBydW50aW1lLkdldEV2ZW50U2hlZXRNYW5hZ2VyKCk7CiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRFdmVudCA9IHJ1bnRpbWUuR2V0Q3VycmVudEV2ZW50KCk7CiAgICAgICAgICAgIGNvbnN0IHNvbE1vZGlmaWVycyA9IGN1cnJlbnRFdmVudC5HZXRTb2xNb2RpZmllcnMoKTsKICAgICAgICAgICAgY29uc3QgZXZlbnRTdGFjayA9IHJ1bnRpbWUuR2V0RXZlbnRTdGFjaygpOwogICAgICAgICAgICAvLyBHZXQgY3VycmVudCBzdGFjayBmcmFtZSBhbmQgcHVzaCBuZXcgb25lCiAgICAgICAgICAgIGNvbnN0IG9sZEZyYW1lID0gZXZlbnRTdGFjay5HZXRDdXJyZW50U3RhY2tGcmFtZSgpOwogICAgICAgICAgICBjb25zdCBuZXdGcmFtZSA9IGV2ZW50U3RhY2suUHVzaChjdXJyZW50RXZlbnQpOwoKICAgICAgICAgICAgYXJyYXkuZm9yRWFjaCgoaXRlbSkgPT4gewogICAgICAgICAgICAgICAgY2IoaXRlbSk7CgogICAgICAgICAgICAgICAgLy8gUHVzaCBhIGNvcHkgb2YgdGhlIGN1cnJlbnQgU09MCiAgICAgICAgICAgICAgICBldmVudFNoZWV0TWFuYWdlci5QdXNoQ29weVNvbChzb2xNb2RpZmllcnMpOwogICAgICAgICAgICAgICAgLy8gUmV0cmlnZ2VyIHRoZSBjdXJyZW50IGV2ZW50LCBydW5uaW5nIGEgc2luZ2xlIGxvb3AgaXRlcmF0aW9uCiAgICAgICAgICAgICAgICBjdXJyZW50RXZlbnQuUmV0cmlnZ2VyKG9sZEZyYW1lLCBuZXdGcmFtZSk7CiAgICAgICAgICAgICAgICAvLyBQb3AgdGhlIGN1cnJlbnQgU09MCiAgICAgICAgICAgICAgICBldmVudFNoZWV0TWFuYWdlci5Qb3BTb2woc29sTW9kaWZpZXJzKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAvLyBQb3AgdGhlIGV2ZW50IHN0YWNrIGZyYW1lCiAgICAgICAgICAgIGV2ZW50U3RhY2suUG9wKCk7CiAgICAgICAgfQoKICAgICAgICB2YXIgQ25kcyA9IHsKICAgICAgICAgICAgT25BZHZDbG9zZWQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIE9uRmlyc3RBZHZDbG9zZWQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIE9uU2lnbkluRmFpbGVkKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBPblNpZ25JblN1Y2Nlc3MoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIElzU2lnbmVkSW4oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gISF0aGlzLnBsYXllcjsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIElzUHVyY2hhc2VzQXZhaWxhYmxlKCkgewogICAgICAgICAgICAgICAgcmV0dXJuICEhdGhpcy5wYXltZW50czsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIEhhc0FueVB1cmNoYXNlKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucHVyY2hhc2VzLmxlbmd0aCA+IDA7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBPbkJ1eVN1Y2Nlc3MocHVyY2hhc2VJZCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHB1cmNoYXNlSWQgPT09IHRoaXMubGFzdFB1cmNoYXNlSUQ7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBPbkJ1eUZhaWxlZChwdXJjaGFzZUlkKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcHVyY2hhc2VJZCA9PT0gdGhpcy5sYXN0UHVyY2hhc2VJRDsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIE9uQW55QnV5U3VjY2VzcygpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgT25BbnlCdXlGYWlsZWQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIE9uUHVyY2hhc2VzTG9hZFN1Y2Nlc3MoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIE9uUHVyY2hhc2VzTG9hZEZhaWxlZCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgT25DYXRhbG9nTG9hZFN1Y2Nlc3MoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIE9uQ2F0YWxvZ0xvYWRGYWlsZWQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIEhhc1B1cmNoYXNlKHByb2R1Y3RJZCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucHVyY2hhc2VzLnNvbWUocCA9PiBwLnByb2R1Y3RJRCA9PT0gcHJvZHVjdElkKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIEVhY2hQcm9kdWN0KCkgewogICAgICAgICAgICAgICAgZWFjaCh0aGlzLl9ydW50aW1lLCB0aGlzLnByb2R1Y3RzLCAocHJvZHVjdCkgPT4gewogICAgICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFByb2R1Y3RJRCA9IHByb2R1Y3QucHJvZHVjdElEOwogICAgICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFByb2R1Y3RUaXRsZSA9IHByb2R1Y3QudGl0bGU7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50UHJvZHVjdERlc2NyaXB0aW9uID0gcHJvZHVjdC5kZXNjcmlwdGlvbjsKICAgICAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRQcm9kdWN0SW1hZ2UgPSBwcm9kdWN0LmltYWdlVVJJOwogICAgICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFByb2R1Y3RQcmljZSA9IHByb2R1Y3QucHJpY2U7CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBFYWNoUHVyY2hhc2UoKSB7CiAgICAgICAgICAgICAgICBlYWNoKHRoaXMuX3J1bnRpbWUsIHRoaXMucHVyY2hhc2VzLCAocHVyY2hhc2UpID0+IHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRQdXJjaGFzZUlEID0gcHVyY2hhc2UucHJvZHVjdElEOwogICAgICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFB1cmNoYXNlVG9rZW4gPSBwdXJjaGFzZS5wdXJjaGFzZVRva2VuOwogICAgICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFB1cmNoYXNlU2lnbiA9IHB1cmNoYXNlLnNpZ25hdHVyZTsKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIE9uUmV3YXJkZWRWaWRlb09wZW4oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIE9uUmV3YXJkZWRWaWRlb0Nsb3NlKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBPblJld2FyZGVkVmlkZW9FcnJvcigpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgT25SZXdhcmRlZFZpZGVvUmV3YXJkKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBJc1Jld2FyZGVkVmlkZW9QbGF5aW5nKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaXNSZXdhcmRlZFZpZGVvUGxheWluZzsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIE9uSW5jcmVtZW50UGxheWVyU3RhdGVGYWlsZWQoa2V5KSB7CiAgICAgICAgICAgICAgICByZXR1cm4ga2V5ID09PSB0aGlzLmxhc3RTdGF0ZUtleTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIE9uU2V0UGxheWVyU3RhdGVGYWlsZWQoa2V5KSB7CiAgICAgICAgICAgICAgICByZXR1cm4ga2V5ID09PSB0aGlzLmxhc3RTdGF0ZUtleTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIE9uU2V0UGxheWVyRGF0YUZhaWxlZChrZXkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBrZXkgPT09IHRoaXMubGFzdERhdGFLZXk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBPbkxvYWRQbGF5ZXJTdGF0c1N1Y2Nlc3MoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIE9uTG9hZFBsYXllclN0YXRzRmFpbGVkKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBPbkxvYWRQbGF5ZXJEYXRhU3VjY2VzcygpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgT25Mb2FkUGxheWVyRGF0YUZhaWxlZCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgT25Db25zdW1lU3VjY2VzcyhwdXJjaGFzZUlkKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcHVyY2hhc2VJZCA9PT0gdGhpcy5sYXN0UHVyY2hhc2VJRDsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIE9uQ29uc3VtZUZhaWxlZChwdXJjaGFzZUlkKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcHVyY2hhc2VJZCA9PT0gdGhpcy5sYXN0UHVyY2hhc2VJRDsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIE9uQW55Q29uc3VtZVN1Y2Nlc3MoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIE9uQW55Q29uc3VtZUZhaWxlZCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgT25CYW5uZXJEaXNwbGF5ZWQoYmFubmVySUQpIHsKICAgICAgICAgICAgICAgIHJldHVybiBiYW5uZXJJRCA9PT0gdGhpcy5sYXN0QmFubmVySUQ7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBPbkJhbm5lckRlc3Ryb3llZChiYW5uZXJJRCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGJhbm5lcklEID09PSB0aGlzLmxhc3RCYW5uZXJJRDsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIElzQmFubmVyRGlzcGxheWluZyhiYW5uZXJJRCkgewogICAgICAgICAgICAgICAgY29uc3QgYmFubmVyID0gdGhpcy5iYW5uZXJzW2Jhbm5lcklEXTsKICAgICAgICAgICAgICAgIHJldHVybiAhIShiYW5uZXIgJiYgYmFubmVyLmRpc3BsYXllZCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgfTsKCiAgICAgICAgaWYgKGdsb2JhbFRoaXMuQzMpIHsKICAgICAgICAgICAgQzMuUGx1Z2lucy5FcG9uZXNoX1lhbmRleFNESy5DbmRzID0gQ25kczsKICAgICAgICB9CgogICAgICAgIENuZHM7CiAgICB9Cgp9Cgp7CiAgICAidXNlIHN0cmljdCI7IHsKICAgICAgICB2YXIgQWN0cyA9IHsKICAgICAgICAgICAgYXN5bmMgU2hvd0Z1bGxzY3JlZW4oKSB7CiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnJlYWR5OwogICAgICAgICAgICAgICAgdGhpcy5fc2hvd0Z1bGxzY3JlZW5BZHYoKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGFzeW5jIENyZWF0ZUJhbm5lcihpZCwgeCA9IDAsIHkgPSAwLCB3aWR0aCA9IDAsIGhlaWdodCA9IDAsIHN0eWxlcykgewogICAgICAgICAgICAgICAgaWYgKCF0aGlzLmJhbm5lcnNbaWRdKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5iYW5uZXJzW2lkXSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheWVkOiBmYWxzZQogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5ydGJSZWFkeTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9ydGJDcmVhdGVCYW5uZXIoewogICAgICAgICAgICAgICAgICAgICAgICBpZCwKICAgICAgICAgICAgICAgICAgICAgICAgeCwKICAgICAgICAgICAgICAgICAgICAgICAgeSwKICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGgsCiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodCwKICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGVzCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBhc3luYyBDcmVhdGVTdGlja3lCYW5uZXIoaWQsIHBvc2l0aW9uID0gMCwgd2lkdGggPSAwLCBoZWlnaHQgPSAwLCBzdHlsZXMpIHsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5iYW5uZXJzW2lkXSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuYmFubmVyc1tpZF0gPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXllZDogZmFsc2UKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucnRiUmVhZHk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcnRiQ3JlYXRlU3RpY2t5QmFubmVyKHsKICAgICAgICAgICAgICAgICAgICAgICAgaWQsCiAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICB3aWR0aCwKICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0LAogICAgICAgICAgICAgICAgICAgICAgICBzdHlsZXMKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGFzeW5jIERpc3BsYXlCYW5uZXIoaWQpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmJhbm5lcnNbaWRdKSB7CiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5ydGJSZWFkeTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9ydGJEaXNwbGF5QmFubmVyKHsKICAgICAgICAgICAgICAgICAgICAgICAgaWQKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGFzeW5jIFJlZnJlc2hCYW5uZXIoaWQpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmJhbm5lcnNbaWRdKSB7CiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5ydGJSZWFkeTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmJhbm5lcnNbaWRdLmRpc3BsYXllZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3J0YlJlZnJlc2hCYW5uZXIoewogICAgICAgICAgICAgICAgICAgICAgICBpZAogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgYXN5bmMgRGVzdHJveUJhbm5lcihpZCkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuYmFubmVyc1tpZF0pIHsKICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnJ0YlJlYWR5OwogICAgICAgICAgICAgICAgICAgIHRoaXMuYmFubmVyc1tpZF0uZGlzcGxheWVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5sYXN0QmFubmVySUQgPSBpZDsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9ydGJEZXN0cm95QmFubmVyKHsKICAgICAgICAgICAgICAgICAgICAgICAgaWQKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uQmFubmVyRGVzdHJveWVkKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGFzeW5jIFJlYWNoR29hbCh0YXJnZXQpIHsKICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMubWV0cmljYVJlYWR5OwogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1JlYWNoIEdvYWw6ICcsIHRhcmdldCk7CiAgICAgICAgICAgICAgICB0aGlzLl9yZWFjaEdvYWwoewogICAgICAgICAgICAgICAgICAgIHRhcmdldAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBhc3luYyBTaWduSW4oKSB7CiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmdldFBsYXllcigpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgYXN5bmMgTG9hZENhdGFsb2coKSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGF5bWVudHNSZWFkeTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnByb2R1Y3RzID0gYXdhaXQgdGhpcy5fZ2V0Q2F0YWxvZygpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25DYXRhbG9nTG9hZFN1Y2Nlc3MpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkNhdGFsb2dMb2FkRmFpbGVkKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGFzeW5jIExvYWRQdXJjaGFzZXMoaXNBdXRvU2lnbkluKSB7CiAgICAgICAgICAgICAgICBpZiAoaXNBdXRvU2lnbkluKSB7CiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5nZXRQbGF5ZXIoKTsKICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PblB1cmNoYXNlc0xvYWRGYWlsZWQpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGF5bWVudHNSZWFkeTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnB1cmNoYXNlcyA9IGF3YWl0IHRoaXMuX2dldFB1cmNoYXNlcygpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25QdXJjaGFzZXNMb2FkU3VjY2Vzcyk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uUHVyY2hhc2VzTG9hZEZhaWxlZCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBhc3luYyBCdXkocHVyY2hhc2VJZCkgewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBheW1lbnRzUmVhZHk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcHVyY2hhc2UgPSBhd2FpdCB0aGlzLl9wdXJjaGFzZSh7CiAgICAgICAgICAgICAgICAgICAgICAgIHB1cmNoYXNlSWQKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnB1cmNoYXNlcy5wdXNoKHB1cmNoYXNlKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmxhc3RQdXJjaGFzZUlEID0gcHVyY2hhc2VJZDsKICAgICAgICAgICAgICAgICAgICB0aGlzLmxhc3RQdXJjaGFzZVRva2VuID0gcHVyY2hhc2UucHVyY2hhc2VUb2tlbjsKICAgICAgICAgICAgICAgICAgICB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uQW55QnV5U3VjY2Vzcyk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkJ1eVN1Y2Nlc3MpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5sYXN0UHVyY2hhc2VJRCA9IHB1cmNoYXNlSWQ7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkFueUJ1eUZhaWxlZCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkJ1eUZhaWxlZCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBhc3luYyBTaG93UmV3YXJkZWRWaWRlbygpIHsKICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucmVhZHk7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuX3Nob3dSZXdhcmRlZFZpZGVvKCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICAgICAgICAgIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25SZXdhcmRlZFZpZGVvRXJyb3IpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgYXN5bmMgQ29uc3VtZVB1cmNoYXNlKGlkKSB7CiAgICAgICAgICAgICAgICBjb25zdCBwdXJjaGFzZSA9IHRoaXMucHVyY2hhc2VzLmZpbmQocCA9PiBwLnByb2R1Y3RJRCA9PT0gaWQpOwogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBheW1lbnRzUmVhZHk7CiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5fY29uc3VtZVB1cmNoYXNlKHsKICAgICAgICAgICAgICAgICAgICAgICAgcHVyY2hhc2VUb2tlbjogcHVyY2hhc2UucHVyY2hhc2VUb2tlbgogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIHRoaXMucHVyY2hhc2VzID0gdGhpcy5wdXJjaGFzZXMuZmlsdGVyKHAgPT4gcC5wcm9kdWN0SUQgIT09IGlkKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmxhc3RQdXJjaGFzZUlEID0gaWQ7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5sYXN0UHVyY2hhc2VUb2tlbiA9IHB1cmNoYXNlID8gcHVyY2hhc2UudG9rZW4gOiAnJzsKICAgICAgICAgICAgICAgICAgICB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uQW55Q29uc3VtZVN1Y2Nlc3MpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25Db25zdW1lU3VjY2Vzcyk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmxhc3RQdXJjaGFzZUlEID0gaWQ7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5sYXN0UHVyY2hhc2VUb2tlbiA9IHB1cmNoYXNlID8gcHVyY2hhc2UudG9rZW4gOiAnJzsKICAgICAgICAgICAgICAgICAgICB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uQW55Q29uc3VtZUZhaWxlZCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkNvbnN1bWVGYWlsZWQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgYXN5bmMgSW5jcmVtZW50U3RhdGUoa2V5LCB2YWx1ZSkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMucGxheWVyU3RhdHNba2V5XSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMucGxheWVyU3RhdHNba2V5XSArPSB2YWx1ZTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5ZXJTdGF0c1trZXldID0gdmFsdWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLl9pbmNyZW1lbnRQbGF5ZXJTdGF0cyh7CiAgICAgICAgICAgICAgICAgICAgICAgIFtrZXldOiB2YWx1ZQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0YXRzID0gYXdhaXQgdGhpcy5fZ2V0UGxheWVyU3RhdHMoW2tleV0pOwogICAgICAgICAgICAgICAgICAgIHRoaXMucGxheWVyU3RhdHNba2V5XSA9IHN0YXRzW2tleV0gfHwgMDsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5sYXN0U3RhdGVLZXkgPSBrZXk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PbkluY3JlbWVudFBsYXllclN0YXRlRmFpbGVkKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGFzeW5jIFNldFN0YXRlKGtleSwgdmFsdWUpIHsKICAgICAgICAgICAgICAgIHRoaXMucGxheWVyU3RhdHNba2V5XSA9IHZhbHVlOwogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLl9zZXRQbGF5ZXJTdGF0cyh7CiAgICAgICAgICAgICAgICAgICAgICAgIFtrZXldOiB2YWx1ZQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0YXRzID0gYXdhaXQgdGhpcy5fZ2V0UGxheWVyU3RhdHMoW2tleV0pOwogICAgICAgICAgICAgICAgICAgIHRoaXMucGxheWVyU3RhdHNba2V5XSA9IHN0YXRzW2tleV0gfHwgMDsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5sYXN0U3RhdGVLZXkgPSBrZXk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKHRoaXMuY29uZGl0aW9ucy5PblNldFBsYXllclN0YXRlRmFpbGVkKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGFzeW5jIFNldERhdGEoa2V5LCB2YWx1ZSkgewogICAgICAgICAgICAgICAgdGhpcy5wbGF5ZXJEYXRhW2tleV0gPSB2YWx1ZTsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5fc2V0UGxheWVyRGF0YSh7CiAgICAgICAgICAgICAgICAgICAgICAgIFtrZXldOiB2YWx1ZQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCB0aGlzLl9nZXRQbGF5ZXJEYXRhKFtrZXldKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnBsYXllckRhdGFba2V5XSA9IGRhdGFba2V5XSB8fCAnJzsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5sYXN0RGF0YUtleSA9IGtleTsKICAgICAgICAgICAgICAgICAgICB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uU2V0UGxheWVyRGF0YUZhaWxlZCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBhc3luYyBMb2FkU3RhdHMoKSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIHRoaXMucGxheWVyU3RhdHMgPSAoYXdhaXQgdGhpcy5fZ2V0UGxheWVyRnVsbFN0YXRzKCkpIHx8IHt9OwogICAgICAgICAgICAgICAgICAgIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25Mb2FkUGxheWVyU3RhdHNTdWNjZXNzKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgICAgIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25Mb2FkUGxheWVyU3RhdHNGYWlsZWQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgYXN5bmMgTG9hZERhdGEoKSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIHRoaXMucGxheWVyRGF0YSA9IChhd2FpdCB0aGlzLl9nZXRQbGF5ZXJGdWxsRGF0YSgpKSB8fCB7fTsKICAgICAgICAgICAgICAgICAgICB0aGlzLlRyaWdnZXIodGhpcy5jb25kaXRpb25zLk9uTG9hZFBsYXllckRhdGFTdWNjZXNzKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgICAgIHRoaXMuVHJpZ2dlcih0aGlzLmNvbmRpdGlvbnMuT25Mb2FkUGxheWVyRGF0YUZhaWxlZCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICBpZiAoZ2xvYmFsVGhpcy5DMykgewogICAgICAgICAgICBDMy5QbHVnaW5zLkVwb25lc2hfWWFuZGV4U0RLLkFjdHMgPSBBY3RzOwogICAgICAgIH0KCiAgICAgICAgQWN0czsKICAgIH0KCn0KCnsKICAgICJ1c2Ugc3RyaWN0IjsgewogICAgICAgIHZhciBFeHBzID0gewogICAgICAgICAgICBQbGF5ZXJOYW1lKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGxheWVyLm5hbWU7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBQbGF5ZXJJZCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnBsYXllci5pZDsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIFBsYXllclBob3RvU21hbGwoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wbGF5ZXIucGhvdG9TbWFsbDsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIFBsYXllclBob3RvTWVkaXVtKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGxheWVyLnBob3RvTWVkaXVtOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgUGxheWVyUGhvdG9MYXJnZSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnBsYXllci5waG90b0xhcmdlOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgQ3VycmVudFByb2R1Y3RJRCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRQcm9kdWN0SUQgfHwgJyc7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBDdXJyZW50UHJvZHVjdFRpdGxlKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudFByb2R1Y3RUaXRsZSB8fCAnJzsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIEN1cnJlbnRQcm9kdWN0SW1hZ2UoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50UHJvZHVjdEltYWdlIHx8ICcnOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgQ3VycmVudFByb2R1Y3REZXNjcmlwdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRQcm9kdWN0RGVzY3JpcHRpb24gfHwgJyc7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBDdXJyZW50UHJvZHVjdFByaWNlKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudFByb2R1Y3RQcmljZSB8fCAwOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgQ3VycmVudFB1cmNoYXNlSUQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50UHVyY2hhc2VJRCB8fCAnJzsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIEN1cnJlbnRQdXJjaGFzZVRva2VuKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudFB1cmNoYXNlVG9rZW4gfHwgJyc7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBDdXJyZW50UHVyY2hhc2VTaWduKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudFB1cmNoYXNlU2lnbiB8fCAnJzsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIEdldFB1cmNoYXNlVG9rZW4ocHJvZHVjdElkKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRQdXJjaGFzZShwcm9kdWN0SWQpLnB1cmNoYXNlVG9rZW4gfHwgJyc7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBMYXN0UHVyY2hhc2VJZCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmxhc3RQdXJjaGFzZUlEIHx8ICcnOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgTGFzdFB1cmNoYXNlVG9rZW4oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5sYXN0UHVyY2hhc2VUb2tlbiB8fCAnJzsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIEdldFByb2R1Y3RUaXRsZShwcm9kdWN0SWQpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldFByb2R1Y3QocHJvZHVjdElkKS50aXRsZSB8fCAnJzsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIEdldFByb2R1Y3REZXNjcmlwdGlvbihwcm9kdWN0SWQpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldFByb2R1Y3QocHJvZHVjdElkKS5kZXNjcmlwdGlvbiB8fCAnJzsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIEdldFByb2R1Y3RJbWFnZShwcm9kdWN0SWQpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldFByb2R1Y3QocHJvZHVjdElkKS5pbWFnZVVSSSB8fCAnJzsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIEdldFByb2R1Y3RQcmljZShwcm9kdWN0SWQpIHsKICAgICAgICAgICAgICAgIHJldHVybiBwYXJzZUZsb2F0KHRoaXMuZ2V0UHJvZHVjdChwcm9kdWN0SWQpLnByaWNlIHx8IDApOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgTGFzdFBsYXllclN0YXRlS2V5KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubGFzdFN0YXRlS2V5IHx8ICcnOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgTGFzdFBsYXllckRhdGFLZXkoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5sYXN0RGF0YUtleSB8fCAnJzsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIEdldFBsYXllclN0YXRlKGtleSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGxheWVyU3RhdHNba2V5XSB8fCAwOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgR2V0UGxheWVyRGF0YShrZXkpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnBsYXllckRhdGFba2V5XSB8fCAnJzsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIExhc3RCYW5uZXIoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5sYXN0QmFubmVySUQ7CiAgICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICBpZiAoZ2xvYmFsVGhpcy5DMykgewogICAgICAgICAgICBDMy5QbHVnaW5zLkVwb25lc2hfWWFuZGV4U0RLLkV4cHMgPSBFeHBzOwogICAgICAgIH0KCiAgICAgICAgRXhwczsKICAgIH0KCn0KCnsKICAgICd1c2Ugc3RyaWN0JzsgewogICAgICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgICAgICBDMy5QbHVnaW5zLkRyYXdpbmdDYW52YXMgPSBjbGFzcyBEcmF3aW5nQ2FudmFzUGx1Z2luIGV4dGVuZHMgQzMuU0RLUGx1Z2luQmFzZSB7CiAgICAgICAgICAgIGNvbnN0cnVjdG9yKG9wdHMpIHsKICAgICAgICAgICAgICAgIHN1cGVyKG9wdHMpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgUmVsZWFzZSgpIHsKICAgICAgICAgICAgICAgIHN1cGVyLlJlbGVhc2UoKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSB7CiAgICAgICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgICAgIEMzLlBsdWdpbnMuRHJhd2luZ0NhbnZhcy5UeXBlID0gY2xhc3MgRHJhd2luZ0NhbnZhc1R5cGUgZXh0ZW5kcyBDMy5TREtUeXBlQmFzZSB7CiAgICAgICAgICAgIGNvbnN0cnVjdG9yKG9iamVjdENsYXNzKSB7CiAgICAgICAgICAgICAgICBzdXBlcihvYmplY3RDbGFzcykKICAgICAgICAgICAgfQogICAgICAgICAgICBSZWxlYXNlKCkgewogICAgICAgICAgICAgICAgc3VwZXIuUmVsZWFzZSgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgT25DcmVhdGUoKSB7fQogICAgICAgIH0KICAgIH0gewogICAgICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgICAgICBjb25zdCBDM1ggPSBzZWxmLkMzWDsKICAgICAgICBjb25zdCBSRVNPTFVUSU9OX01PREUgPSAwOwogICAgICAgIGNvbnN0IElOSVRJQUxMWV9WSVNJQkxFID0gMTsKICAgICAgICBjb25zdCBPUklHSU4gPSAyOwogICAgICAgIGNvbnN0IE1VTFRJU0FNUExJTkcgPSAzOwogICAgICAgIGNvbnN0IHRlbXBDb2xvciA9IEMzLk5ldyhDMy5Db2xvcik7CiAgICAgICAgY29uc3QgdGVtcENvbG9yMiA9IEMzLk5ldyhDMy5Db2xvcik7CiAgICAgICAgY29uc3QgdGVtcFJlY3QgPSBDMy5OZXcoQzMuUmVjdCk7CiAgICAgICAgY29uc3QgdGVtcFF1YWQgPSBDMy5OZXcoQzMuUXVhZCk7CgogICAgICAgIGZ1bmN0aW9uIENsb25lUG9seUFycmF5KGFycikgewogICAgICAgICAgICByZXR1cm4gYXJyLm1hcChwID0+IHAuc2xpY2UoMCkpCiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBTb3J0QnlJbnN0YW5jZVpJbmRleChhLCBiKSB7CiAgICAgICAgICAgIHJldHVybiBhLkdldFdvcmxkSW5mbygpLkdldFpJbmRleCgpIC0gYi5HZXRXb3JsZEluZm8oKS5HZXRaSW5kZXgoKQogICAgICAgIH0KICAgICAgICBsZXQgZHJhd0RlcHRoID0gMDsKICAgICAgICBDMy5QbHVnaW5zLkRyYXdpbmdDYW52YXMuSW5zdGFuY2UgPSBjbGFzcyBEcmF3aW5nQ2FudmFzSW5zdGFuY2UgZXh0ZW5kcyBDMy5TREtXb3JsZEluc3RhbmNlQmFzZSB7CiAgICAgICAgICAgIGNvbnN0cnVjdG9yKGluc3QsCiAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzKSB7CiAgICAgICAgICAgICAgICBzdXBlcihpbnN0KTsKICAgICAgICAgICAgICAgIHRoaXMuX3JlbmRlclRhcmdldCA9IG51bGw7CiAgICAgICAgICAgICAgICB0aGlzLl9yY1RleCA9IEMzLk5ldyhDMy5SZWN0KTsKICAgICAgICAgICAgICAgIGNvbnN0IHdpID0gdGhpcy5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgICAgIHRoaXMuX2lzRml4ZWRSZXNvbHV0aW9uID0gZmFsc2U7CiAgICAgICAgICAgICAgICB0aGlzLl9maXhlZFJlc29sdXRpb25XaWR0aCA9IE1hdGguZmxvb3Iod2kuR2V0V2lkdGgoKSk7CiAgICAgICAgICAgICAgICB0aGlzLl9maXhlZFJlc29sdXRpb25IZWlnaHQgPSBNYXRoLmZsb29yKHdpLkdldEhlaWdodCgpKTsKICAgICAgICAgICAgICAgIHRoaXMuX211bHRpc2FtcGxpbmcgPSAwOwogICAgICAgICAgICAgICAgdGhpcy5fdGV4UmVuZGVyVGFyZ2V0ID0gbnVsbDsKICAgICAgICAgICAgICAgIHRoaXMuX2RyYXdDb21tYW5kcyA9IFtdOwogICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudFBvbHkgPSBbXTsKICAgICAgICAgICAgICAgIHRoaXMuX2RyYXdCbGVuZE1vZGUgPSAwOwogICAgICAgICAgICAgICAgdGhpcy5fZHJhd1NjYWxlID0gMTsKICAgICAgICAgICAgICAgIHRoaXMuX3RleFNjYWxlID0gMTsKICAgICAgICAgICAgICAgIHRoaXMuX2xpbmVEYXNoVGV4dHVyZSA9IG51bGw7CiAgICAgICAgICAgICAgICB0aGlzLl9zYXZlZEltYWdlVXJsID0gIiI7CiAgICAgICAgICAgICAgICB0aGlzLl9zbmFwc2hvdCA9IG51bGw7CiAgICAgICAgICAgICAgICB0aGlzLl90ZW1wUmVjdCA9IEMzLk5ldyhDMy5SZWN0KTsKICAgICAgICAgICAgICAgIHRoaXMuX2RldmljZVF1YWRVbnJvdGF0ZWQgPQogICAgICAgICAgICAgICAgICAgIEMzLk5ldyhDMy5RdWFkKTsKICAgICAgICAgICAgICAgIHRoaXMuX2RldmljZVF1YWRSb3RhdGVkID0gQzMuTmV3KEMzLlF1YWQpOwogICAgICAgICAgICAgICAgaWYgKHByb3BlcnRpZXMpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9pc0ZpeGVkUmVzb2x1dGlvbiA9IHByb3BlcnRpZXNbUkVTT0xVVElPTl9NT0RFXSA9PT0gMTsKICAgICAgICAgICAgICAgICAgICB3aS5TZXRWaXNpYmxlKCEhcHJvcGVydGllc1tJTklUSUFMTFlfVklTSUJMRV0pOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX211bHRpc2FtcGxpbmcgPSBbMCwgMiwgNCwgOF1bcHJvcGVydGllc1tNVUxUSVNBTVBMSU5HXV0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNvbnN0IHJlbmRlcmVyID0gdGhpcy5fcnVudGltZS5HZXRSZW5kZXJlcigpOwogICAgICAgICAgICAgICAgdGhpcy5fU2V0RHJhd2luZ0JsZW5kTW9kZSgwKTsKICAgICAgICAgICAgICAgIGlmIChyZW5kZXJlci5Jc1dlYkdMKCkgJiYgcmVuZGVyZXIuR2V0V2ViR0xWZXJzaW9uTnVtYmVyKCkgPCAyKSB0aGlzLl9tdWx0aXNhbXBsaW5nID0gMDsKICAgICAgICAgICAgICAgIHRoaXMuX1N0YXJ0VGlja2luZzIoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIFJlbGVhc2UoKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fcmVuZGVyVGFyZ2V0KSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVuZGVyVGFyZ2V0LkdldFJlbmRlcmVyKCkuRGVsZXRlUmVuZGVyVGFyZ2V0KHRoaXMuX3JlbmRlclRhcmdldCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVuZGVyVGFyZ2V0ID0gbnVsbAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHRoaXMuX3RleFJlbmRlclRhcmdldCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX3RleFJlbmRlclRhcmdldC5HZXRSZW5kZXJlcigpLkRlbGV0ZVJlbmRlclRhcmdldCh0aGlzLl90ZXhSZW5kZXJUYXJnZXQpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3RleFJlbmRlclRhcmdldCA9IG51bGwKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIEMzLmNsZWFyQXJyYXkodGhpcy5fZHJhd0NvbW1hbmRzKTsKICAgICAgICAgICAgICAgIHN1cGVyLlJlbGVhc2UoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIElzRml4ZWRSZXNvbHV0aW9uTW9kZSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9pc0ZpeGVkUmVzb2x1dGlvbgogICAgICAgICAgICB9CiAgICAgICAgICAgIF9HZXRMaW5lRGFzaFRleHR1cmUoKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9NYXliZUNyZWF0ZUxpbmVEYXNoVGV4dHVyZSgpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2xpbmVEYXNoVGV4dHVyZQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9NYXliZUNyZWF0ZUxpbmVEYXNoVGV4dHVyZSgpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9saW5lRGFzaFRleHR1cmUpIHJldHVybjsKICAgICAgICAgICAgICAgIGNvbnN0IGNhbnZhcyA9IEMzLkNyZWF0ZUNhbnZhcyg1MTIsIDgpOwogICAgICAgICAgICAgICAgY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoIjJkIik7CiAgICAgICAgICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIDUxMiwgOCk7CiAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gIndoaXRlIjsKICAgICAgICAgICAgICAgIGN0eC5maWxsUmVjdCgwLCAwLCAyNTYsIDgpOwogICAgICAgICAgICAgICAgdGhpcy5fbGluZURhc2hUZXh0dXJlID0gdGhpcy5fcnVudGltZS5HZXRSZW5kZXJlcigpLkNyZWF0ZVN0YXRpY1RleHR1cmUoY2FudmFzLCB7CiAgICAgICAgICAgICAgICAgICAgd3JhcFg6ICJyZXBlYXQiLAogICAgICAgICAgICAgICAgICAgIHNhbXBsaW5nOiB0aGlzLl9ydW50aW1lLkdldFNhbXBsaW5nKCkKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX1NldERyYXdpbmdCbGVuZE1vZGUoYm0pIHsKICAgICAgICAgICAgICAgIHRoaXMuX2RyYXdCbGVuZE1vZGUgPSBibQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9BcHBseUN1cnJlbnREcmF3aW5nQmxlbmRNb2RlKHJlbmRlcmVyKSB7CiAgICAgICAgICAgICAgICByZW5kZXJlci5TZXRCbGVuZE1vZGUodGhpcy5fZHJhd0JsZW5kTW9kZSkKICAgICAgICAgICAgfQogICAgICAgICAgICBfQWRkRHJhd0NvbW1hbmQoY21kKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9kcmF3Q29tbWFuZHMucHVzaChjbWQpOwogICAgICAgICAgICAgICAgdGhpcy5fcnVudGltZS5VcGRhdGVSZW5kZXIoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9TZXRGaXhlZFJlc29sdXRpb25Nb2RlKGZpeGVkV2lkdGgsIGZpeGVkSGVpZ2h0KSB7CiAgICAgICAgICAgICAgICB0aGlzLl9pc0ZpeGVkUmVzb2x1dGlvbiA9IHRydWU7CiAgICAgICAgICAgICAgICB0aGlzLl9maXhlZFJlc29sdXRpb25XaWR0aCA9IE1hdGguZmxvb3IoZml4ZWRXaWR0aCk7CiAgICAgICAgICAgICAgICB0aGlzLl9maXhlZFJlc29sdXRpb25IZWlnaHQgPSBNYXRoLmZsb29yKGZpeGVkSGVpZ2h0KQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9TZXRBdXRvUmVzb2x1dGlvbk1vZGUoKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9pc0ZpeGVkUmVzb2x1dGlvbiA9IGZhbHNlCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX0NsZWFyQ2FudmFzKGNvbG9yKSB7CiAgICAgICAgICAgICAgICBDMy5jbGVhckFycmF5KHRoaXMuX2RyYXdDb21tYW5kcyk7CiAgICAgICAgICAgICAgICB0aGlzLl9BZGREcmF3Q29tbWFuZChuZXcgQzMuUGx1Z2lucy5EcmF3aW5nQ2FudmFzLkRyYXdDb21tYW5kLkNsZWFyQ2FudmFzKGNvbG9yKSkKICAgICAgICAgICAgfQogICAgICAgICAgICBfQ2xlYXJSZWN0KGxlZnQsIHRvcCwgcmlnaHQsIGJvdHRvbSwgY29sb3IpIHsKICAgICAgICAgICAgICAgIGlmIChsZWZ0ID09PSByaWdodCB8fCB0b3AgPT09IGJvdHRvbSkgcmV0dXJuOwogICAgICAgICAgICAgICAgdGhpcy5fQWRkRHJhd0NvbW1hbmQobmV3IEMzLlBsdWdpbnMuRHJhd2luZ0NhbnZhcy5EcmF3Q29tbWFuZC5DbGVhclJlY3QobGVmdCwgdG9wLCByaWdodCwgYm90dG9tLCBjb2xvcikpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX0ZpbGxSZWN0KGxlZnQsIHRvcCwgcmlnaHQsIGJvdHRvbSwgY29sb3IpIHsKICAgICAgICAgICAgICAgIGlmIChsZWZ0ID09PSByaWdodCB8fCB0b3AgPT09IGJvdHRvbSkgcmV0dXJuOwogICAgICAgICAgICAgICAgdGhpcy5fQWRkRHJhd0NvbW1hbmQobmV3IEMzLlBsdWdpbnMuRHJhd2luZ0NhbnZhcy5EcmF3Q29tbWFuZC5GaWxsUmVjdChsZWZ0LAogICAgICAgICAgICAgICAgICAgIHRvcCwgcmlnaHQsIGJvdHRvbSwgY29sb3IpKQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9GaWxsTGluZWFyR3JhZGllbnQobGVmdCwgdG9wLCByaWdodCwgYm90dG9tLCBjb2xvcjEsIGNvbG9yMiwgZGlyKSB7CiAgICAgICAgICAgICAgICBpZiAobGVmdCA9PT0gcmlnaHQgfHwgdG9wID09PSBib3R0b20pIHJldHVybjsKICAgICAgICAgICAgICAgIHRoaXMuX0FkZERyYXdDb21tYW5kKG5ldyBDMy5QbHVnaW5zLkRyYXdpbmdDYW52YXMuRHJhd0NvbW1hbmQuRmlsbExpbmVhckdyYWRpZW50KGxlZnQsIHRvcCwgcmlnaHQsIGJvdHRvbSwgY29sb3IxLCBjb2xvcjIsIGRpcikpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX0ZpbGxFbGxpcHNlKHgsIHksIHJhZGl1c1gsIHJhZGl1c1ksIGNvbG9yLCBpc1Ntb290aCkgewogICAgICAgICAgICAgICAgaWYgKHJhZGl1c1ggPD0gMCB8fCByYWRpdXNZIDw9IDApIHJldHVybjsKICAgICAgICAgICAgICAgIHRoaXMuX0FkZERyYXdDb21tYW5kKG5ldyBDMy5QbHVnaW5zLkRyYXdpbmdDYW52YXMuRHJhd0NvbW1hbmQuRmlsbEVsbGlwc2UoeCwgeSwgcmFkaXVzWCwgcmFkaXVzWSwgY29sb3IsIGlzU21vb3RoKSkKICAgICAgICAgICAgfQogICAgICAgICAgICBfT3V0bGluZUVsbGlwc2UoeCwgeSwgcmFkaXVzWCwgcmFkaXVzWSwgY29sb3IsIHRoaWNrbmVzcywgaXNTbW9vdGgpIHsKICAgICAgICAgICAgICAgIGlmIChyYWRpdXNYIDw9CiAgICAgICAgICAgICAgICAgICAgMCB8fCByYWRpdXNZIDw9IDAgfHwgdGhpY2tuZXNzIDw9IDApIHJldHVybjsKICAgICAgICAgICAgICAgIHRoaXMuX0FkZERyYXdDb21tYW5kKG5ldyBDMy5QbHVnaW5zLkRyYXdpbmdDYW52YXMuRHJhd0NvbW1hbmQuT3V0bGluZUVsbGlwc2UoeCwgeSwgcmFkaXVzWCwgcmFkaXVzWSwgY29sb3IsIHRoaWNrbmVzcywgaXNTbW9vdGgpKQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9PdXRsaW5lUmVjdChsZWZ0LCB0b3AsIHJpZ2h0LCBib3R0b20sIGNvbG9yLCB0aGlja25lc3MpIHsKICAgICAgICAgICAgICAgIGlmIChsZWZ0ID09PSByaWdodCB8fCB0b3AgPT09IGJvdHRvbSB8fCB0aGlja25lc3MgPD0gMCkgcmV0dXJuOwogICAgICAgICAgICAgICAgdGhpcy5fQWRkRHJhd0NvbW1hbmQobmV3IEMzLlBsdWdpbnMuRHJhd2luZ0NhbnZhcy5EcmF3Q29tbWFuZC5PdXRsaW5lUmVjdChsZWZ0LCB0b3AsIHJpZ2h0LCBib3R0b20sIGNvbG9yLCB0aGlja25lc3MpKQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9MaW5lKHgxLCB5MSwgeDIsIHkyLCBjb2xvciwgdGhpY2tuZXNzLCBjYXBTdHIpIHsKICAgICAgICAgICAgICAgIGlmICh4MSA9PT0geDIgJiYgeTEgPT09IHkyIHx8IHRoaWNrbmVzcyA8PSAwKSByZXR1cm47CiAgICAgICAgICAgICAgICB0aGlzLl9BZGREcmF3Q29tbWFuZChuZXcgQzMuUGx1Z2lucy5EcmF3aW5nQ2FudmFzLkRyYXdDb21tYW5kLkxpbmUoeDEsCiAgICAgICAgICAgICAgICAgICAgeTEsIHgyLCB5MiwgY29sb3IsIHRoaWNrbmVzcywgY2FwU3RyKSkKICAgICAgICAgICAgfQogICAgICAgICAgICBfTGluZURhc2hlZCh4MSwgeTEsIHgyLCB5MiwgY29sb3IsIHRoaWNrbmVzcywgZGFzaExlbmd0aCwgY2FwU3RyKSB7CiAgICAgICAgICAgICAgICBpZiAoeDEgPT09IHgyICYmIHkxID09PSB5MiB8fCB0aGlja25lc3MgPD0gMCB8fCBkYXNoTGVuZ3RoIDw9IDApIHJldHVybjsKICAgICAgICAgICAgICAgIGNvbnN0IGRhc2hUZXggPSB0aGlzLl9HZXRMaW5lRGFzaFRleHR1cmUoKTsKICAgICAgICAgICAgICAgIHRoaXMuX0FkZERyYXdDb21tYW5kKG5ldyBDMy5QbHVnaW5zLkRyYXdpbmdDYW52YXMuRHJhd0NvbW1hbmQuTGluZURhc2hlZCh4MSwgeTEsIHgyLCB5MiwgY29sb3IsIHRoaWNrbmVzcywgZGFzaExlbmd0aCwgZGFzaFRleCwgY2FwU3RyKSkKICAgICAgICAgICAgfQogICAgICAgICAgICBfTGluZVBvbHkocG9seUFyciwgY29sb3IsIHRoaWNrbmVzcywgY2FwU3RyKSB7CiAgICAgICAgICAgICAgICBpZiAocG9seUFyci5sZW5ndGggPCAyIHx8IHRoaWNrbmVzcyA8PSAwKSByZXR1cm47CiAgICAgICAgICAgICAgICB0aGlzLl9BZGREcmF3Q29tbWFuZChuZXcgQzMuUGx1Z2lucy5EcmF3aW5nQ2FudmFzLkRyYXdDb21tYW5kLkxpbmVQb2x5KENsb25lUG9seUFycmF5KHBvbHlBcnIpLCBjb2xvciwKICAgICAgICAgICAgICAgICAgICB0aGlja25lc3MsIGNhcFN0cikpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX0xpbmVEYXNoZWRQb2x5KHBvbHlBcnIsIGNvbG9yLCB0aGlja25lc3MsIGRhc2hMZW5ndGgsIGNhcFN0cikgewogICAgICAgICAgICAgICAgaWYgKHBvbHlBcnIubGVuZ3RoIDwgMiB8fCB0aGlja25lc3MgPD0gMCB8fCBkYXNoTGVuZ3RoIDw9IDApIHJldHVybjsKICAgICAgICAgICAgICAgIGNvbnN0IGRhc2hUZXggPSB0aGlzLl9HZXRMaW5lRGFzaFRleHR1cmUoKTsKICAgICAgICAgICAgICAgIHRoaXMuX0FkZERyYXdDb21tYW5kKG5ldyBDMy5QbHVnaW5zLkRyYXdpbmdDYW52YXMuRHJhd0NvbW1hbmQuTGluZURhc2hlZFBvbHkoQ2xvbmVQb2x5QXJyYXkocG9seUFyciksIGNvbG9yLCB0aGlja25lc3MsIGRhc2hMZW5ndGgsIGRhc2hUZXgsIGNhcFN0cikpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX0ZpbGxQb2x5KHBvbHlBcnIsIGNvbG9yKSB7CiAgICAgICAgICAgICAgICBpZiAocG9seUFyci5sZW5ndGggPCAzKSByZXR1cm47CiAgICAgICAgICAgICAgICB0aGlzLl9BZGREcmF3Q29tbWFuZChuZXcgQzMuUGx1Z2lucy5EcmF3aW5nQ2FudmFzLkRyYXdDb21tYW5kLkZpbGxQb2x5KENsb25lUG9seUFycmF5KHBvbHlBcnIpLCBjb2xvcikpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX1NldERyYXdCbGVuZChibGVuZE1vZGUpIHsKICAgICAgICAgICAgICAgIHRoaXMuX0FkZERyYXdDb21tYW5kKG5ldyBDMy5QbHVnaW5zLkRyYXdpbmdDYW52YXMuRHJhd0NvbW1hbmQuU2V0RHJhd0JsZW5kKGJsZW5kTW9kZSkpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX1Bhc3RlSW5zdGFuY2VzKGluc3RhbmNlQXJyLAogICAgICAgICAgICAgICAgaW5jbHVkZUZ4KSB7CiAgICAgICAgICAgICAgICBjb25zdCBteVdpID0gdGhpcy5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgICAgIGNvbnN0IG15QmJveCA9IG15V2kuR2V0Qm91bmRpbmdCb3goKTsKICAgICAgICAgICAgICAgIGNvbnN0IG15UXVhZCA9IG15V2kuR2V0Qm91bmRpbmdRdWFkKCk7CiAgICAgICAgICAgICAgICBjb25zdCBpbnN0YW5jZXMgPSBpbnN0YW5jZUFyci5maWx0ZXIoaW5zdCA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5zdFdpID0gaW5zdC5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW5zdFdpICYmIG15QmJveC5pbnRlcnNlY3RzUmVjdChpbnN0V2kuR2V0Qm91bmRpbmdCb3goKSkgJiYgKG15V2kuR2V0QW5nbGUoKSA9PT0gMCB8fCBteVF1YWQuaW50ZXJzZWN0c1F1YWQoaW5zdFdpLkdldEJvdW5kaW5nUXVhZCgpKSkKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgaWYgKGluc3RhbmNlcy5sZW5ndGggPT09IDApIHJldHVybjsKICAgICAgICAgICAgICAgIGluc3RhbmNlcy5zb3J0KFNvcnRCeUluc3RhbmNlWkluZGV4KTsKICAgICAgICAgICAgICAgIGxldCByZXNvbHZlID0gbnVsbDsKICAgICAgICAgICAgICAgIGNvbnN0IHJldCA9IG5ldyBQcm9taXNlKHIgPT4gcmVzb2x2ZSA9IHIpOwogICAgICAgICAgICAgICAgdGhpcy5fQWRkRHJhd0NvbW1hbmQobmV3IEMzLlBsdWdpbnMuRHJhd2luZ0NhbnZhcy5EcmF3Q29tbWFuZC5EcmF3SW5zdGFuY2VzKGluc3RhbmNlcywKICAgICAgICAgICAgICAgICAgICBpbmNsdWRlRngsIG15V2ksIHJlc29sdmUpKTsKICAgICAgICAgICAgICAgIHJldHVybiByZXQKICAgICAgICAgICAgfQogICAgICAgICAgICBfR2V0UGl4ZWxTY2FsZSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiAxIC8gKHRoaXMuX2RyYXdTY2FsZSAqIHRoaXMuX3RleFNjYWxlKQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9VcGRhdGVSZW5kZXJUYXJnZXRTaXplKHJlbmRlcmVyLCBydFdpZHRoLCBydEhlaWdodCkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuX3JlbmRlclRhcmdldCkgcmVuZGVyZXIuRGVsZXRlUmVuZGVyVGFyZ2V0KHRoaXMuX3JlbmRlclRhcmdldCk7CiAgICAgICAgICAgICAgICB0aGlzLl9yZW5kZXJUYXJnZXQgPSByZW5kZXJlci5DcmVhdGVSZW5kZXJUYXJnZXQoewogICAgICAgICAgICAgICAgICAgIHdpZHRoOiBydFdpZHRoLAogICAgICAgICAgICAgICAgICAgIGhlaWdodDogcnRIZWlnaHQsCiAgICAgICAgICAgICAgICAgICAgc2FtcGxpbmc6IHRoaXMuX3J1bnRpbWUuR2V0U2FtcGxpbmcoKSwKICAgICAgICAgICAgICAgICAgICBpc1NhbXBsZWQ6IHRoaXMuX211bHRpc2FtcGxpbmcgPT09IDAsCiAgICAgICAgICAgICAgICAgICAgY2FuUmVhZFBpeGVsczogdGhpcy5fbXVsdGlzYW1wbGluZyA9PT0gMCwKICAgICAgICAgICAgICAgICAgICBjYW5VcGRhdGU6IHRoaXMuX211bHRpc2FtcGxpbmcgPT09IDAsCiAgICAgICAgICAgICAgICAgICAgbXVsdGlzYW1wbGluZzogdGhpcy5fbXVsdGlzYW1wbGluZwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fbXVsdGlzYW1wbGluZyA+IDApIHsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fdGV4UmVuZGVyVGFyZ2V0KSByZW5kZXJlci5EZWxldGVSZW5kZXJUYXJnZXQodGhpcy5fdGV4UmVuZGVyVGFyZ2V0KTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZXhSZW5kZXJUYXJnZXQgPSByZW5kZXJlci5DcmVhdGVSZW5kZXJUYXJnZXQoewogICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogcnRXaWR0aCwKICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBydEhlaWdodCwKICAgICAgICAgICAgICAgICAgICAgICAgc2FtcGxpbmc6IHRoaXMuX3J1bnRpbWUuR2V0U2FtcGxpbmcoKSwKICAgICAgICAgICAgICAgICAgICAgICAgaXNTYW1wbGVkOiB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgICBjYW5SZWFkUGl4ZWxzOiB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgICBjYW5VcGRhdGU6IHRydWUKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmVuZGVyZXIuU2V0VGV4dHVyZShudWxsKQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9HZXRSZW5kZXJUYXJnZXQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcmVuZGVyVGFyZ2V0CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX0dldFRleFJlbmRlclRhcmdldCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl90ZXhSZW5kZXJUYXJnZXQKICAgICAgICAgICAgfQogICAgICAgICAgICBHZXRNdWx0aXNhbXBsaW5nKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX211bHRpc2FtcGxpbmcKICAgICAgICAgICAgfQogICAgICAgICAgICBfU2V0UmVuZGVyVGFyZ2V0RGV2aWNlVHJhbnNmb3JtKHJlbmRlcmVyKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9ydW50aW1lLkdldENhbnZhc01hbmFnZXIoKS5TZXREZXZpY2VUcmFuc2Zvcm0ocmVuZGVyZXIsIHRoaXMuX3JlbmRlclRhcmdldC5HZXRXaWR0aCgpLCB0aGlzLl9yZW5kZXJUYXJnZXQuR2V0SGVpZ2h0KCksCiAgICAgICAgICAgICAgICAgICAgZmFsc2UpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgSGFzQW55RHJhd2luZ0NvbW1hbmRJblF1ZXVlKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2RyYXdDb21tYW5kcy5zb21lKGMgPT4gIShjIGluc3RhbmNlb2YgQzMuUGx1Z2lucy5EcmF3aW5nQ2FudmFzLkRyYXdDb21tYW5kLlNhdmVJbWFnZSkpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX0NhbGN1bGF0ZVVucm90YXRlZERldmljZUNvb3JkcyhvdXRSZWN0LCBvdXRRdWFkKSB7CiAgICAgICAgICAgICAgICBjb25zdCB3aSA9IHRoaXMuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgICAgICBjb25zdCBsYXllciA9IHdpLkdldExheWVyKCk7CiAgICAgICAgICAgICAgICBjb25zdCBsYXlvdXQgPSBsYXllci5HZXRMYXlvdXQoKTsKICAgICAgICAgICAgICAgIGNvbnN0IGFuZ2xlID0gd2kuR2V0QW5nbGUoKTsKICAgICAgICAgICAgICAgIGNvbnN0IGxheWVyQW5nbGUgPSBsYXllci5HZXRPd25BbmdsZSgpOwogICAgICAgICAgICAgICAgY29uc3QgbGF5b3V0QW5nbGUgPSBsYXlvdXQuR2V0QW5nbGUoKTsKICAgICAgICAgICAgICAgIGlmIChhbmdsZSAhPT0gMCB8fCBsYXllckFuZ2xlICE9PSAwIHx8IGxheW91dEFuZ2xlICE9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgbGF5b3V0LlNldEFuZ2xlKDApOwogICAgICAgICAgICAgICAgICAgIGxheWVyLlNldEFuZ2xlKDApOwogICAgICAgICAgICAgICAgICAgIHdpLlNldEFuZ2xlKDApOwogICAgICAgICAgICAgICAgICAgIHdpLlNldEJib3hDaGFuZ2VkKCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNvbnN0IHF1YWQgPSB3aS5HZXRCb3VuZGluZ1F1YWQoKTsKICAgICAgICAgICAgICAgIGNvbnN0IFtkbCwgZHRdID0gbGF5ZXIuTGF5ZXJUb0RyYXdTdXJmYWNlKHF1YWQuZ2V0VGx4KCksIHF1YWQuZ2V0VGx5KCkpOwogICAgICAgICAgICAgICAgY29uc3QgW2RyLCBkYl0gPSBsYXllci5MYXllclRvRHJhd1N1cmZhY2UocXVhZC5nZXRCcngoKSwgcXVhZC5nZXRCcnkoKSk7CiAgICAgICAgICAgICAgICBjb25zdCBvZmZYID0gZGwgLSBNYXRoLnJvdW5kKGRsKTsKICAgICAgICAgICAgICAgIGNvbnN0IG9mZlkgPSBkdCAtIE1hdGgucm91bmQoZHQpOwogICAgICAgICAgICAgICAgb3V0UmVjdC5zZXQoZGwsIGR0LCBkciwgZGIpOwogICAgICAgICAgICAgICAgb3V0UmVjdC5vZmZzZXQoLW9mZlgsIC1vZmZZKTsKICAgICAgICAgICAgICAgIG91dFJlY3Qubm9ybWFsaXplKCk7CiAgICAgICAgICAgICAgICBvdXRRdWFkLnNldEZyb21SZWN0KG91dFJlY3QpOwogICAgICAgICAgICAgICAgaWYgKGFuZ2xlICE9PSAwIHx8IGxheWVyQW5nbGUgIT09IDAgfHwgbGF5b3V0QW5nbGUgIT09IDApIHsKICAgICAgICAgICAgICAgICAgICBsYXlvdXQuU2V0QW5nbGUobGF5b3V0QW5nbGUpOwogICAgICAgICAgICAgICAgICAgIGxheWVyLlNldEFuZ2xlKGxheWVyQW5nbGUpOwogICAgICAgICAgICAgICAgICAgIHdpLlNldEFuZ2xlKGFuZ2xlKTsKICAgICAgICAgICAgICAgICAgICB3aS5TZXRCYm94Q2hhbmdlZCgpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX0NhbGN1bGF0ZVJvdGF0ZWREZXZpY2VDb29yZHMob3V0UXVhZCkgewogICAgICAgICAgICAgICAgY29uc3Qgd2kgPSB0aGlzLkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICAgICAgY29uc3QgbGF5ZXIgPSB3aS5HZXRMYXllcigpOwogICAgICAgICAgICAgICAgY29uc3QgbGF5b3V0ID0gbGF5ZXIuR2V0TGF5b3V0KCk7CiAgICAgICAgICAgICAgICBjb25zdCBsYXllckFuZ2xlID0gbGF5ZXIuR2V0T3duQW5nbGUoKTsKICAgICAgICAgICAgICAgIGNvbnN0IGxheW91dEFuZ2xlID0gbGF5b3V0LkdldEFuZ2xlKCk7CiAgICAgICAgICAgICAgICBpZiAobGF5ZXJBbmdsZSAhPT0gMCB8fCBsYXlvdXRBbmdsZSAhPT0gMCkgewogICAgICAgICAgICAgICAgICAgIGxheW91dC5TZXRBbmdsZSgwKTsKICAgICAgICAgICAgICAgICAgICBsYXllci5TZXRBbmdsZSgwKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY29uc3QgcXVhZCA9IHdpLkdldEJvdW5kaW5nUXVhZCgpOwogICAgICAgICAgICAgICAgY29uc3QgW2R0bHgsIGR0bHldID0gbGF5ZXIuTGF5ZXJUb0RyYXdTdXJmYWNlKHF1YWQuZ2V0VGx4KCksIHF1YWQuZ2V0VGx5KCkpOwogICAgICAgICAgICAgICAgY29uc3QgW2R0cngsIGR0cnldID0gbGF5ZXIuTGF5ZXJUb0RyYXdTdXJmYWNlKHF1YWQuZ2V0VHJ4KCksIHF1YWQuZ2V0VHJ5KCkpOwogICAgICAgICAgICAgICAgY29uc3QgW2RicngsIGRicnldID0gbGF5ZXIuTGF5ZXJUb0RyYXdTdXJmYWNlKHF1YWQuZ2V0QnJ4KCksIHF1YWQuZ2V0QnJ5KCkpOwogICAgICAgICAgICAgICAgY29uc3QgW2RibHgsIGRibHldID0gbGF5ZXIuTGF5ZXJUb0RyYXdTdXJmYWNlKHF1YWQuZ2V0Qmx4KCksCiAgICAgICAgICAgICAgICAgICAgcXVhZC5nZXRCbHkoKSk7CiAgICAgICAgICAgICAgICBjb25zdCBvZmZYID0gZHRseCAtIE1hdGgucm91bmQoZHRseCk7CiAgICAgICAgICAgICAgICBjb25zdCBvZmZZID0gZHRseSAtIE1hdGgucm91bmQoZHRseSk7CiAgICAgICAgICAgICAgICBvdXRRdWFkLnNldChkdGx4LCBkdGx5LCBkdHJ4LCBkdHJ5LCBkYnJ4LCBkYnJ5LCBkYmx4LCBkYmx5KTsKICAgICAgICAgICAgICAgIG91dFF1YWQub2Zmc2V0KG9mZlgsIG9mZlkpOwogICAgICAgICAgICAgICAgaWYgKGxheWVyQW5nbGUgIT09IDAgfHwgbGF5b3V0QW5nbGUgIT09IDApIHsKICAgICAgICAgICAgICAgICAgICBsYXlvdXQuU2V0QW5nbGUobGF5b3V0QW5nbGUpOwogICAgICAgICAgICAgICAgICAgIGxheWVyLlNldEFuZ2xlKGxheWVyQW5nbGUpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX0NhbGN1bGF0ZVN1cmZhY2VEZXZpY2VTaXplKCkgewogICAgICAgICAgICAgICAgY29uc3QgcmVuZGVyZXIgPSB0aGlzLl9ydW50aW1lLkdldFJlbmRlcmVyKCk7CiAgICAgICAgICAgICAgICBjb25zdCB0ZW1wUmVjdCA9IHRoaXMuX3RlbXBSZWN0OwogICAgICAgICAgICAgICAgdGhpcy5fQ2FsY3VsYXRlVW5yb3RhdGVkRGV2aWNlQ29vcmRzKHRlbXBSZWN0LCB0aGlzLl9kZXZpY2VRdWFkVW5yb3RhdGVkKTsKICAgICAgICAgICAgICAgIHRoaXMuX0NhbGN1bGF0ZVJvdGF0ZWREZXZpY2VDb29yZHModGhpcy5fZGV2aWNlUXVhZFJvdGF0ZWQpOwogICAgICAgICAgICAgICAgbGV0IHJ0V2lkdGggPQogICAgICAgICAgICAgICAgICAgIDA7CiAgICAgICAgICAgICAgICBsZXQgcnRIZWlnaHQgPSAwOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuX2lzRml4ZWRSZXNvbHV0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgcnRXaWR0aCA9IHRoaXMuX2ZpeGVkUmVzb2x1dGlvbldpZHRoOwogICAgICAgICAgICAgICAgICAgIHJ0SGVpZ2h0ID0gdGhpcy5fZml4ZWRSZXNvbHV0aW9uSGVpZ2h0OwogICAgICAgICAgICAgICAgICAgIGlmIChyZW5kZXJlci5Jc1dlYkdMKCkpIHRoaXMuX3JjVGV4LnNldCgwLCAxLCAxLCAwKTsKICAgICAgICAgICAgICAgICAgICBlbHNlIHRoaXMuX3JjVGV4LnNldCgwLCAwLCAxLCAxKQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBFUFNJTE9OID0gLjAwMTsKICAgICAgICAgICAgICAgICAgICBydFdpZHRoID0gTWF0aC5jZWlsKHRlbXBSZWN0LndpZHRoKCkgKyBFUFNJTE9OKTsKICAgICAgICAgICAgICAgICAgICBydEhlaWdodCA9IE1hdGguY2VpbCh0ZW1wUmVjdC5oZWlnaHQoKSArIEVQU0lMT04pOwogICAgICAgICAgICAgICAgICAgIGlmIChyZW5kZXJlci5Jc1dlYkdMKCkpIHRoaXMuX3JjVGV4LnNldCgwLCAxLCB0ZW1wUmVjdC53aWR0aCgpIC8gcnRXaWR0aCwgMSAtIHRlbXBSZWN0LmhlaWdodCgpIC8gcnRIZWlnaHQpOwogICAgICAgICAgICAgICAgICAgIGVsc2UgdGhpcy5fcmNUZXguc2V0KDAsIDAsIHRlbXBSZWN0LndpZHRoKCkgLyBydFdpZHRoLCB0ZW1wUmVjdC5oZWlnaHQoKSAvIHJ0SGVpZ2h0KQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY29uc3QgbWF4VGV4dHVyZVNpemUgPQogICAgICAgICAgICAgICAgICAgIHJlbmRlcmVyLkdldE1heFRleHR1cmVTaXplKCk7CiAgICAgICAgICAgICAgICBjb25zdCBtYXhSdERpbSA9IE1hdGgubWF4KHJ0V2lkdGgsIHJ0SGVpZ2h0KTsKICAgICAgICAgICAgICAgIGlmIChtYXhSdERpbSA+IG1heFRleHR1cmVTaXplKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGV4U2NhbGUgPSBtYXhUZXh0dXJlU2l6ZSAvIG1heFJ0RGltOwogICAgICAgICAgICAgICAgICAgIHJ0V2lkdGggPSBNYXRoLnJvdW5kKHJ0V2lkdGggKiB0aGlzLl90ZXhTY2FsZSk7CiAgICAgICAgICAgICAgICAgICAgcnRIZWlnaHQgPSBNYXRoLnJvdW5kKHJ0SGVpZ2h0ICogdGhpcy5fdGV4U2NhbGUpCiAgICAgICAgICAgICAgICB9IGVsc2UgdGhpcy5fdGV4U2NhbGUgPSAxOwogICAgICAgICAgICAgICAgcmV0dXJuIFtydFdpZHRoLCBydEhlaWdodF0KICAgICAgICAgICAgfQogICAgICAgICAgICBfT25SZXNvbHV0aW9uQ2hhbmdlZCgpIHsKICAgICAgICAgICAgICAgIHRoaXMuRGlzcGF0Y2hTY3JpcHRFdmVudCgicmVzb2x1dGlvbmNoYW5nZSIpOwogICAgICAgICAgICAgICAgdGhpcy5UcmlnZ2VyKEMzLlBsdWdpbnMuRHJhd2luZ0NhbnZhcy5DbmRzLk9uUmVzb2x1dGlvbkNoYW5nZWQpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX01heWJlQ3JlYXRlUmVuZGVyVGFyZ2V0KCkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuX3JlbmRlclRhcmdldCkgcmV0dXJuOwogICAgICAgICAgICAgICAgY29uc3QgW3J0V2lkdGgsIHJ0SGVpZ2h0XSA9IHRoaXMuX0NhbGN1bGF0ZVN1cmZhY2VEZXZpY2VTaXplKCk7CiAgICAgICAgICAgICAgICBpZiAocnRXaWR0aCA8PSAwIHx8IHJ0SGVpZ2h0IDw9IDApIHJldHVybjsKICAgICAgICAgICAgICAgIHRoaXMuX2RyYXdTY2FsZSA9IHRlbXBSZWN0LndpZHRoKCkgLyB0aGlzLkdldFdvcmxkSW5mbygpLkdldFdpZHRoKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9VcGRhdGVSZW5kZXJUYXJnZXRTaXplKHRoaXMuX3J1bnRpbWUuR2V0UmVuZGVyZXIoKSwgcnRXaWR0aCwgcnRIZWlnaHQpOwogICAgICAgICAgICAgICAgdGhpcy5fT25SZXNvbHV0aW9uQ2hhbmdlZCgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgVGljazIoKSB7CiAgICAgICAgICAgICAgICBjb25zdCByZW5kZXJlciA9IHRoaXMuX3J1bnRpbWUuR2V0UmVuZGVyZXIoKTsKICAgICAgICAgICAgICAgIGNvbnN0IHdpID0gdGhpcy5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgICAgIGNvbnN0IHRlbXBSZWN0ID0gdGhpcy5fdGVtcFJlY3Q7CiAgICAgICAgICAgICAgICArK2RyYXdEZXB0aDsKICAgICAgICAgICAgICAgIGNvbnN0IFtydFdpZHRoLCBydEhlaWdodF0gPSB0aGlzLl9DYWxjdWxhdGVTdXJmYWNlRGV2aWNlU2l6ZSgpOwogICAgICAgICAgICAgICAgaWYgKHJ0V2lkdGggPD0gMCB8fCBydEhlaWdodCA8PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgLS1kcmF3RGVwdGg7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLl9kcmF3U2NhbGUgPSB0aGlzLl9pc0ZpeGVkUmVzb2x1dGlvbiA/IDEgOiB0ZW1wUmVjdC53aWR0aCgpIC8gd2kuR2V0V2lkdGgoKTsKICAgICAgICAgICAgICAgIGNvbnN0IGRyYXdTY2FsZSA9IHRoaXMuX2RyYXdTY2FsZSAqIHRoaXMuX3RleFNjYWxlOwogICAgICAgICAgICAgICAgY29uc3QgZGlkUmVuZGVyVGFyZ2V0Q2hhbmdlID0gIXRoaXMuX3JlbmRlclRhcmdldCB8fCB0aGlzLl9yZW5kZXJUYXJnZXQuR2V0V2lkdGgoKSAhPT0gcnRXaWR0aCB8fCB0aGlzLl9yZW5kZXJUYXJnZXQuR2V0SGVpZ2h0KCkgIT09IHJ0SGVpZ2h0OwogICAgICAgICAgICAgICAgaWYgKGRpZFJlbmRlclRhcmdldENoYW5nZSkgdGhpcy5fT25SZXNvbHV0aW9uQ2hhbmdlZCgpOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuX2RyYXdDb21tYW5kcy5sZW5ndGggPiAwIHx8ICF0aGlzLl9yZW5kZXJUYXJnZXQpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX3JlbmRlclRhcmdldCB8fCBkaWRSZW5kZXJUYXJnZXRDaGFuZ2UgJiYgdGhpcy5IYXNBbnlEcmF3aW5nQ29tbWFuZEluUXVldWUoKSkgdGhpcy5fVXBkYXRlUmVuZGVyVGFyZ2V0U2l6ZShyZW5kZXJlciwgcnRXaWR0aCwgcnRIZWlnaHQpOwogICAgICAgICAgICAgICAgICAgIHJlbmRlcmVyLlNldFJlbmRlclRhcmdldCh0aGlzLl9yZW5kZXJUYXJnZXQpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX1NldFJlbmRlclRhcmdldERldmljZVRyYW5zZm9ybShyZW5kZXJlcik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fQXBwbHlDdXJyZW50RHJhd2luZ0JsZW5kTW9kZShyZW5kZXJlcik7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlbmRlcmVyLklzV2ViR1BVKCkgJiYgdGhpcy5fbXVsdGlzYW1wbGluZyA+IDApIHJlbmRlcmVyLlNldFJlbmRlcmluZ1RvTXVsdGlzYW1wbGVDb3VudCh0aGlzLl9tdWx0aXNhbXBsaW5nKTsKICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGRjIG9mIHRoaXMuX2RyYXdDb21tYW5kcykgZGMuRG8ocmVuZGVyZXIsIGRyYXdTY2FsZSwgdGhpcyk7CiAgICAgICAgICAgICAgICAgICAgQzMuY2xlYXJBcnJheSh0aGlzLl9kcmF3Q29tbWFuZHMpOwogICAgICAgICAgICAgICAgICAgIHJlbmRlcmVyLlNldEFscGhhQmxlbmQoKTsKICAgICAgICAgICAgICAgICAgICBpZiAocmVuZGVyZXIuSXNXZWJHUFUoKSAmJiB0aGlzLl9tdWx0aXNhbXBsaW5nID4gMCkgcmVuZGVyZXIuU2V0UmVuZGVyaW5nVG9NdWx0aXNhbXBsZUNvdW50KDApOwogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9tdWx0aXNhbXBsaW5nID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICByZW5kZXJlci5TZXRSZW5kZXJUYXJnZXQodGhpcy5fdGV4UmVuZGVyVGFyZ2V0KTsKICAgICAgICAgICAgICAgICAgICAgICAgcmVuZGVyZXIuQ29weVJlbmRlclRhcmdldCh0aGlzLl9yZW5kZXJUYXJnZXQsICJjcm9wIikKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LS1kcmF3RGVwdGgKICAgICAgICAgICAgfQogICAgICAgICAgICBEcmF3KHJlbmRlcmVyKSB7CiAgICAgICAgICAgICAgICBjb25zdCB3aSA9CiAgICAgICAgICAgICAgICAgICAgdGhpcy5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgICAgIGNvbnN0IGxheWVyID0gd2kuR2V0TGF5ZXIoKTsKICAgICAgICAgICAgICAgIGNvbnN0IGNhbnZhc01hbmFnZXIgPSB0aGlzLl9ydW50aW1lLkdldENhbnZhc01hbmFnZXIoKTsKICAgICAgICAgICAgICAgIGNvbnN0IGxhc3RSZW5kZXJUYXJnZXQgPSByZW5kZXJlci5HZXRSZW5kZXJUYXJnZXQoKTsKICAgICAgICAgICAgICAgIGxldCBxdWFkID0gdGhpcy5fZGV2aWNlUXVhZFVucm90YXRlZDsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5fcmVuZGVyVGFyZ2V0KSByZXR1cm47CiAgICAgICAgICAgICAgICBpZiAocmVuZGVyZXIuSXNXZWJHUFUoKSkgcmVuZGVyZXIuX01heWJlRG9QZW5kaW5nQ2xlYXJSZW5kZXJQYXNzKHRoaXMuX3JlbmRlclRhcmdldCk7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fbXVsdGlzYW1wbGluZyA9PT0gMCkgcmVuZGVyZXIuU2V0VGV4dHVyZSh0aGlzLl9yZW5kZXJUYXJnZXQuR2V0VGV4dHVyZSgpKTsKICAgICAgICAgICAgICAgIGVsc2UgcmVuZGVyZXIuU2V0VGV4dHVyZSh0aGlzLl90ZXhSZW5kZXJUYXJnZXQuR2V0VGV4dHVyZSgpKTsKICAgICAgICAgICAgICAgIGxldCBkaWRDaGFuZ2VUcmFuc2Zvcm0gPSBmYWxzZTsKICAgICAgICAgICAgICAgIGlmIChkcmF3RGVwdGggPiAwKQogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9pbnN0Ll9Jc0RyYXdpbmdXaXRoRWZmZWN0cygpKSBxdWFkID0KICAgICAgICAgICAgICAgICAgICAgICAgd2kuR2V0Qm91bmRpbmdRdWFkKCk7CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhbnZhc01hbmFnZXIuU2V0RGV2aWNlVHJhbnNmb3JtKHJlbmRlcmVyLCBsYXN0UmVuZGVyVGFyZ2V0LkdldFdpZHRoKCksIGxhc3RSZW5kZXJUYXJnZXQuR2V0SGVpZ2h0KCksIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgZGlkQ2hhbmdlVHJhbnNmb3JtID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgcXVhZCA9IHRoaXMuX2RldmljZVF1YWRSb3RhdGVkCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSBpZiAod2kuR2V0QW5nbGUoKSA9PT0gMCAmJiBsYXllci5HZXRBbmdsZSgpID09PSAwICYmICF3aS5IYXNNZXNoKCkgJiYgbGF5ZXIuUmVuZGVyc0luMkRNb2RlKCkpIHsKICAgICAgICAgICAgICAgICAgICBjYW52YXNNYW5hZ2VyLlNldERldmljZVRyYW5zZm9ybShyZW5kZXJlcik7CiAgICAgICAgICAgICAgICAgICAgZGlkQ2hhbmdlVHJhbnNmb3JtID0gdHJ1ZQogICAgICAgICAgICAgICAgfSBlbHNlIHF1YWQgPSB3aS5HZXRCb3VuZGluZ1F1YWQoKTsKICAgICAgICAgICAgICAgIGlmICh3aS5IYXNNZXNoKCkpIHRoaXMuX0RyYXdNZXNoKHJlbmRlcmVyLCB3aSk7CiAgICAgICAgICAgICAgICBlbHNlIHJlbmRlcmVyLlF1YWQzKHF1YWQsIHRoaXMuX3JjVGV4KTsKICAgICAgICAgICAgICAgIGlmIChkaWRDaGFuZ2VUcmFuc2Zvcm0pIGxheWVyLl9TZXRUcmFuc2Zvcm0ocmVuZGVyZXIsCiAgICAgICAgICAgICAgICAgICAgZmFsc2UpOwogICAgICAgICAgICAgICAgcmVuZGVyZXIuU2V0VGV4dHVyZShudWxsKQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9EcmF3TWVzaChyZW5kZXJlciwgd2kpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5zZm9ybWVkTWVzaCA9IHdpLkdldFRyYW5zZm9ybWVkTWVzaCgpOwogICAgICAgICAgICAgICAgaWYgKHdpLklzTWVzaENoYW5nZWQoKSkgewogICAgICAgICAgICAgICAgICAgIHdpLkNhbGN1bGF0ZUJib3godGVtcFJlY3QsIHRlbXBRdWFkLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgdHJhbnNmb3JtZWRNZXNoLkNhbGN1bGF0ZVRyYW5zZm9ybWVkTWVzaCh3aS5HZXRTb3VyY2VNZXNoKCksIHRlbXBRdWFkLCB0aGlzLl9yY1RleCk7CiAgICAgICAgICAgICAgICAgICAgd2kuU2V0TWVzaENoYW5nZWQoZmFsc2UpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0cmFuc2Zvcm1lZE1lc2guRHJhdyhyZW5kZXJlcikKICAgICAgICAgICAgfQogICAgICAgICAgICBHZXRTbmFwc2hvdFBpeGVsKHgsIHkpIHsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5fc25hcHNob3QpIHJldHVybiBbMCwgMCwgMCwgMF07CiAgICAgICAgICAgICAgICBjb25zdCB3aWR0aCA9IHRoaXMuX3NuYXBzaG90LndpZHRoOwogICAgICAgICAgICAgICAgY29uc3QgaGVpZ2h0ID0gdGhpcy5fc25hcHNob3QuaGVpZ2h0OwogICAgICAgICAgICAgICAgeCA9IE1hdGguZmxvb3IoeCk7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fcnVudGltZS5HZXRSZW5kZXJlcigpLklzV2ViR0woKSkgeSA9IGhlaWdodCAtIDEgLSBNYXRoLmZsb29yKHkpOwogICAgICAgICAgICAgICAgZWxzZSB5ID0gTWF0aC5mbG9vcih5KTsKICAgICAgICAgICAgICAgIGlmICh4IDwgMCB8fCB5IDwgMCB8fCB4ID49IHdpZHRoIHx8IHkgPj0gaGVpZ2h0KSByZXR1cm4gWzAsIDAsIDAsIDBdOwogICAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IHRoaXMuX3NuYXBzaG90LmRhdGE7CiAgICAgICAgICAgICAgICBjb25zdCBwdHIgPSB5ICogd2lkdGggKiA0ICsgeCAqIDQ7CiAgICAgICAgICAgICAgICBsZXQgciA9IGRhdGFbcHRyXSAvIDI1NTsKICAgICAgICAgICAgICAgIGxldCBnID0gZGF0YVtwdHIgKyAxXSAvIDI1NTsKICAgICAgICAgICAgICAgIGxldCBiID0gZGF0YVtwdHIgKyAyXSAvIDI1NTsKICAgICAgICAgICAgICAgIGxldCBhID0gZGF0YVtwdHIgKyAzXSAvIDI1NTsKICAgICAgICAgICAgICAgIGlmIChhICE9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgciAvPSBhOwogICAgICAgICAgICAgICAgICAgIGcgLz0gYTsKICAgICAgICAgICAgICAgICAgICBiIC89IGEKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBbciAqIDEwMCwgZyAqIDEwMCwgYiAqIDEwMCwgYSAqIDEwMF0KICAgICAgICAgICAgfQogICAgICAgICAgICBTZXRTbmFwc2hvdFBpeGVsKHgsIHksIHJnYikgewogICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9zbmFwc2hvdCkgcmV0dXJuIFswLCAwLCAwLCAwXTsKICAgICAgICAgICAgICAgIHRlbXBDb2xvci5zZXRGcm9tUmdiVmFsdWUocmdiKTsKICAgICAgICAgICAgICAgIHRlbXBDb2xvci5wcmVtdWx0aXBseSgpOwogICAgICAgICAgICAgICAgY29uc3Qgd2lkdGggPSB0aGlzLl9zbmFwc2hvdC53aWR0aDsKICAgICAgICAgICAgICAgIGNvbnN0IGhlaWdodCA9IHRoaXMuX3NuYXBzaG90LmhlaWdodDsKICAgICAgICAgICAgICAgIHggPSBNYXRoLmZsb29yKHgpOwogICAgICAgICAgICAgICAgeSA9IGhlaWdodCAtIDEgLSBNYXRoLmZsb29yKHkpOwogICAgICAgICAgICAgICAgaWYgKHggPCAwIHx8CiAgICAgICAgICAgICAgICAgICAgeSA8IDAgfHwgeCA+PSB3aWR0aCB8fCB5ID49IGhlaWdodCkgcmV0dXJuOwogICAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IHRoaXMuX3NuYXBzaG90LmRhdGE7CiAgICAgICAgICAgICAgICBjb25zdCBwdHIgPSB5ICogd2lkdGggKiA0ICsgeCAqIDQ7CiAgICAgICAgICAgICAgICBkYXRhW3B0cl0gPSBNYXRoLmZsb29yKHRlbXBDb2xvci5nZXRSKCkgKiAyNTUpOwogICAgICAgICAgICAgICAgZGF0YVtwdHIgKyAxXSA9IE1hdGguZmxvb3IodGVtcENvbG9yLmdldEcoKSAqIDI1NSk7CiAgICAgICAgICAgICAgICBkYXRhW3B0ciArIDJdID0gTWF0aC5mbG9vcih0ZW1wQ29sb3IuZ2V0QigpICogMjU1KTsKICAgICAgICAgICAgICAgIGRhdGFbcHRyICsgM10gPSBNYXRoLmZsb29yKHRlbXBDb2xvci5nZXRBKCkgKiAyNTUpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgR2V0SW1hZ2VQaXhlbERhdGEoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fQWRkRHJhd0NvbW1hbmQobmV3IEMzLlBsdWdpbnMuRHJhd2luZ0NhbnZhcy5EcmF3Q29tbWFuZC5TYXZlSW1hZ2UoYXN5bmMgaW1hZ2VEYXRhID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaW1nRGF0YUJ1ZmZlciA9IGltYWdlRGF0YS5kYXRhLmJ1ZmZlcjsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgd2lkdGggPSBpbWFnZURhdGEud2lkdGg7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGhlaWdodCA9IGltYWdlRGF0YS5oZWlnaHQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHByb2Nlc3NlZEJ1ZmZlciA9IGF3YWl0IHRoaXMuX3J1bnRpbWUuQWRkSm9iKCJQcm9jZXNzSW1hZ2VEYXRhIiwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgImJ1ZmZlciI6IGltZ0RhdGFCdWZmZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAid2lkdGgiOiB3aWR0aCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJoZWlnaHQiOiBoZWlnaHQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAidW5wcmVtdWx0aXBseSI6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZmxpcFkiOiB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgIH0sIFtpbWdEYXRhQnVmZmVyXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUobmV3IEltYWdlRGF0YShuZXcgVWludDhDbGFtcGVkQXJyYXkocHJvY2Vzc2VkQnVmZmVyKSwgd2lkdGgsIGhlaWdodCkpCiAgICAgICAgICAgICAgICAgICAgfSkpCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9CiAgICAgICAgICAgIExvYWRJbWFnZVBpeGVsRGF0YShpbWFnZURhdGEsIHByZW11bHRpcGx5QWxwaGEsIGZsaXBZKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9NYXliZUNyZWF0ZVJlbmRlclRhcmdldCgpOwogICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9yZW5kZXJUYXJnZXQpIHRocm93IG5ldyBFcnJvcigiaW52YWxpZCBjYW52YXMgc2l6ZSIpOwogICAgICAgICAgICAgICAgaWYgKGltYWdlRGF0YS53aWR0aCAhPT0gdGhpcy5fcmVuZGVyVGFyZ2V0LkdldFdpZHRoKCkgfHwgaW1hZ2VEYXRhLmhlaWdodCAhPT0gdGhpcy5fcmVuZGVyVGFyZ2V0LkdldEhlaWdodCgpKSB0aHJvdyBuZXcgRXJyb3IoYHdyb25nIHNpemUgSW1hZ2VEYXRhOiBleHBlY3RlZCAke3RoaXMuX3JlbmRlclRhcmdldC5HZXRXaWR0aCgpfSB4ICR7dGhpcy5fcmVuZGVyVGFyZ2V0LkdldEhlaWdodCgpfSwgZ290ICR7aW1hZ2VEYXRhLndpZHRofSB4ICR7aW1hZ2VEYXRhLmhlaWdodH1gKTsKICAgICAgICAgICAgICAgIEMzLmNsZWFyQXJyYXkodGhpcy5fZHJhd0NvbW1hbmRzKTsKICAgICAgICAgICAgICAgIGNvbnN0IHJlbmRlcmVyID0gdGhpcy5fcnVudGltZS5HZXRSZW5kZXJlcigpOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuX3RleFJlbmRlclRhcmdldCkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGxhc3RSZW5kZXJUYXJnZXQgPSByZW5kZXJlci5HZXRSZW5kZXJUYXJnZXQoKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCB0ZXh0dXJlID0gdGhpcy5fdGV4UmVuZGVyVGFyZ2V0LkdldFRleHR1cmUoKTsKICAgICAgICAgICAgICAgICAgICByZW5kZXJlci5VcGRhdGVUZXh0dXJlKGltYWdlRGF0YSwgdGV4dHVyZSwgewogICAgICAgICAgICAgICAgICAgICAgICBwcmVtdWx0aXBseUFscGhhOiAhIXByZW11bHRpcGx5QWxwaGEsCiAgICAgICAgICAgICAgICAgICAgICAgIGZsaXBZOiAhIWZsaXBZCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgcmVuZGVyZXIuU2V0UmVuZGVyVGFyZ2V0KHRoaXMuX3JlbmRlclRhcmdldCk7CiAgICAgICAgICAgICAgICAgICAgcmVuZGVyZXIuQ29weVJlbmRlclRhcmdldCh0aGlzLl90ZXhSZW5kZXJUYXJnZXQsICJjcm9wIik7CiAgICAgICAgICAgICAgICAgICAgcmVuZGVyZXIuU2V0UmVuZGVyVGFyZ2V0KGxhc3RSZW5kZXJUYXJnZXQpCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHRleHR1cmUgPSB0aGlzLl9yZW5kZXJUYXJnZXQuR2V0VGV4dHVyZSgpOwogICAgICAgICAgICAgICAgICAgIHJlbmRlcmVyLlVwZGF0ZVRleHR1cmUoaW1hZ2VEYXRhLAogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0dXJlLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmVtdWx0aXBseUFscGhhOiAhIXByZW11bHRpcGx5QWxwaGEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbGlwWTogISFmbGlwWQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5fcnVudGltZS5VcGRhdGVSZW5kZXIoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIEdldFNjcmlwdEludGVyZmFjZUNsYXNzKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuSURyYXdpbmdDYW52YXNJbnN0YW5jZQogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICBjb25zdCBtYXAgPSBuZXcgV2Vha01hcDsKCiAgICAgICAgZnVuY3Rpb24gYXJyVG9Db2xvcihhcnIpIHsKICAgICAgICAgICAgdGVtcENvbG9yLnNldEZyb21KU09OKGFycik7CiAgICAgICAgICAgIHJldHVybiB0ZW1wQ29sb3IKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGFyclRvQ29sb3IyKGFycikgewogICAgICAgICAgICB0ZW1wQ29sb3IyLnNldEZyb21KU09OKGFycik7CiAgICAgICAgICAgIHJldHVybiB0ZW1wQ29sb3IyCiAgICAgICAgfQogICAgICAgIGNvbnN0IFZBTElEX0dSQURJRU5UX0RJUkVDVElPTlMgPSBbImhvcml6b250YWwiLCAidmVydGljYWwiXTsKICAgICAgICBjb25zdCBWQUxJRF9MSU5FX0NBUFMgPSBuZXcgU2V0KFsiYnV0dCIsICJzcXVhcmUiXSk7CgogICAgICAgIGZ1bmN0aW9uIFZhbGlkYXRlTGluZUNhcChjYXBTdHIpIHsKICAgICAgICAgICAgaWYgKCFWQUxJRF9MSU5FX0NBUFMuaGFzKGNhcFN0cikpIHRocm93IG5ldyBFcnJvcigiaW52YWxpZCBsaW5lIGNhcCIpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gVmFsaWRhdGVQb2x5KHBvbHlBcnIpIHsKICAgICAgICAgICAgQzNYLlJlcXVpcmVBcnJheShwb2x5QXJyKTsKICAgICAgICAgICAgZm9yIChjb25zdCBwIG9mIHBvbHlBcnIpIHsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlQXJyYXkocCk7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcihwWzBdKTsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlRmluaXRlTnVtYmVyKHBbMV0pCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY29uc3QgQkxFTkRfTU9ERV9UT19JTkRFWCA9IG5ldyBNYXAoWwogICAgICAgICAgICBbIm5vcm1hbCIsIDBdLAogICAgICAgICAgICBbImFkZGl0aXZlIiwgMV0sCiAgICAgICAgICAgIFsiY29weSIsIDNdLAogICAgICAgICAgICBbImRlc3RpbmF0aW9uLW92ZXIiLCA0XSwKICAgICAgICAgICAgWyJzb3VyY2UtaW4iLCA1XSwKICAgICAgICAgICAgWyJkZXN0aW5hdGlvbi1pbiIsIDZdLAogICAgICAgICAgICBbInNvdXJjZS1vdXQiLCA3XSwKICAgICAgICAgICAgWyJkZXN0aW5hdGlvbi1vdXQiLCA4XSwKICAgICAgICAgICAgWyJzb3VyY2UtYXRvcCIsIDldLAogICAgICAgICAgICBbImRlc3RpbmF0aW9uLWF0b3AiLCAxMF0KICAgICAgICBdKTsKICAgICAgICBzZWxmLklEcmF3aW5nQ2FudmFzSW5zdGFuY2UgPSBjbGFzcyBJRHJhd2luZ0NhbnZhc0luc3RhbmNlIGV4dGVuZHMgc2VsZi5JV29ybGRJbnN0YW5jZSB7CiAgICAgICAgICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgICAgICAgICAgc3VwZXIoKTsKICAgICAgICAgICAgICAgIG1hcC5zZXQodGhpcywgc2VsZi5JSW5zdGFuY2UuX0dldEluaXRJbnN0KCkuR2V0U2RrSW5zdGFuY2UoKSkKICAgICAgICAgICAgfQogICAgICAgICAgICBzZXRGaXhlZFJlc29sdXRpb25Nb2RlKGZpeGVkV2lkdGgsCiAgICAgICAgICAgICAgICBmaXhlZEhlaWdodCkgewogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVGaW5pdGVOdW1iZXIoZml4ZWRXaWR0aCk7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcihmaXhlZEhlaWdodCk7CiAgICAgICAgICAgICAgICBtYXAuZ2V0KHRoaXMpLl9TZXRGaXhlZFJlc29sdXRpb25Nb2RlKGZpeGVkV2lkdGgsIGZpeGVkSGVpZ2h0KQogICAgICAgICAgICB9CiAgICAgICAgICAgIHNldEF1dG9SZXNvbHV0aW9uTW9kZSgpIHsKICAgICAgICAgICAgICAgIG1hcC5nZXQodGhpcykuX1NldEF1dG9SZXNvbHV0aW9uTW9kZSgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2xlYXJDYW52YXMocmdiQXJyKSB7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUFycmF5KHJnYkFycik7CiAgICAgICAgICAgICAgICBtYXAuZ2V0KHRoaXMpLl9DbGVhckNhbnZhcyhhcnJUb0NvbG9yKHJnYkFycikpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2xlYXJSZWN0KGxlZnQsIHRvcCwgcmlnaHQsIGJvdHRvbSwgcmdiQXJyKSB7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcihsZWZ0KTsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlRmluaXRlTnVtYmVyKHRvcCk7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcihyaWdodCk7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcihib3R0b20pOwogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVBcnJheShyZ2JBcnIpOwogICAgICAgICAgICAgICAgbWFwLmdldCh0aGlzKS5fQ2xlYXJSZWN0KGxlZnQsCiAgICAgICAgICAgICAgICAgICAgdG9wLCByaWdodCwgYm90dG9tLCBhcnJUb0NvbG9yKHJnYkFycikpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZmlsbFJlY3QobGVmdCwgdG9wLCByaWdodCwgYm90dG9tLCByZ2JBcnIpIHsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlRmluaXRlTnVtYmVyKGxlZnQpOwogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVGaW5pdGVOdW1iZXIodG9wKTsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlRmluaXRlTnVtYmVyKHJpZ2h0KTsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlRmluaXRlTnVtYmVyKGJvdHRvbSk7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUFycmF5KHJnYkFycik7CiAgICAgICAgICAgICAgICBtYXAuZ2V0KHRoaXMpLl9GaWxsUmVjdChsZWZ0LCB0b3AsIHJpZ2h0LCBib3R0b20sIGFyclRvQ29sb3IocmdiQXJyKSkKICAgICAgICAgICAgfQogICAgICAgICAgICBmaWxsTGluZWFyR3JhZGllbnQobGVmdCwgdG9wLCByaWdodCwgYm90dG9tLCByZ2JBcnIxLCByZ2JBcnIyLCBkaXJTdHIgPSAiaG9yaXpvbnRhbCIpIHsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlRmluaXRlTnVtYmVyKGxlZnQpOwogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVGaW5pdGVOdW1iZXIodG9wKTsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlRmluaXRlTnVtYmVyKHJpZ2h0KTsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlRmluaXRlTnVtYmVyKGJvdHRvbSk7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUFycmF5KHJnYkFycjEpOwogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVBcnJheShyZ2JBcnIyKTsKICAgICAgICAgICAgICAgIGNvbnN0IGRpciA9IFZBTElEX0dSQURJRU5UX0RJUkVDVElPTlMuaW5kZXhPZihkaXJTdHIpOwogICAgICAgICAgICAgICAgaWYgKGRpciA8IDApIHRocm93IG5ldyBFcnJvcigiaW52YWxpZCBncmFkaWVudCBkaXJlY3Rpb24iKTsKICAgICAgICAgICAgICAgIG1hcC5nZXQodGhpcykuX0ZpbGxMaW5lYXJHcmFkaWVudChsZWZ0LCB0b3AsIHJpZ2h0LCBib3R0b20sIGFyclRvQ29sb3IocmdiQXJyMSksIGFyclRvQ29sb3IyKHJnYkFycjIpLCBkaXIpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZmlsbEVsbGlwc2UoeCwgeSwgcmFkaXVzWCwgcmFkaXVzWSwgcmdiQXJyLCBpc1Ntb290aCA9IHRydWUpIHsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlRmluaXRlTnVtYmVyKHgpOwogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVGaW5pdGVOdW1iZXIoeSk7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcihyYWRpdXNYKTsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlRmluaXRlTnVtYmVyKHJhZGl1c1kpOwogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVBcnJheShyZ2JBcnIpOwogICAgICAgICAgICAgICAgbWFwLmdldCh0aGlzKS5fRmlsbEVsbGlwc2UoeCwgeSwgcmFkaXVzWCwgcmFkaXVzWSwgYXJyVG9Db2xvcihyZ2JBcnIpLCAhIWlzU21vb3RoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIG91dGxpbmVFbGxpcHNlKHgsCiAgICAgICAgICAgICAgICB5LCByYWRpdXNYLCByYWRpdXNZLCByZ2JBcnIsIHRoaWNrbmVzcywgaXNTbW9vdGggPSB0cnVlKSB7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcih4KTsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlRmluaXRlTnVtYmVyKHkpOwogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVGaW5pdGVOdW1iZXIocmFkaXVzWCk7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcihyYWRpdXNZKTsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlQXJyYXkocmdiQXJyKTsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlRmluaXRlTnVtYmVyKHRoaWNrbmVzcyk7CiAgICAgICAgICAgICAgICBtYXAuZ2V0KHRoaXMpLl9PdXRsaW5lRWxsaXBzZSh4LCB5LCByYWRpdXNYLCByYWRpdXNZLCBhcnJUb0NvbG9yKHJnYkFyciksIHRoaWNrbmVzcywgISFpc1Ntb290aCkKICAgICAgICAgICAgfQogICAgICAgICAgICBvdXRsaW5lUmVjdChsZWZ0LCB0b3AsIHJpZ2h0LCBib3R0b20sIHJnYkFyciwgdGhpY2tuZXNzKSB7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcihsZWZ0KTsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlRmluaXRlTnVtYmVyKHRvcCk7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcihyaWdodCk7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcihib3R0b20pOwogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVBcnJheShyZ2JBcnIpOwogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVGaW5pdGVOdW1iZXIodGhpY2tuZXNzKTsKICAgICAgICAgICAgICAgIG1hcC5nZXQodGhpcykuX091dGxpbmVSZWN0KGxlZnQsIHRvcCwgcmlnaHQsIGJvdHRvbSwgYXJyVG9Db2xvcihyZ2JBcnIpLCB0aGlja25lc3MpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGluZSh4MSwgeTEsIHgyLCB5MiwgcmdiQXJyLCB0aGlja25lc3MsIGNhcFN0ciA9ICJidXR0IikgewogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVGaW5pdGVOdW1iZXIoeDEpOwogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVGaW5pdGVOdW1iZXIoeTEpOwogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVGaW5pdGVOdW1iZXIoeDIpOwogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVGaW5pdGVOdW1iZXIoeTIpOwogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVBcnJheShyZ2JBcnIpOwogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVGaW5pdGVOdW1iZXIodGhpY2tuZXNzKTsKICAgICAgICAgICAgICAgIFZhbGlkYXRlTGluZUNhcChjYXBTdHIpOwogICAgICAgICAgICAgICAgbWFwLmdldCh0aGlzKS5fTGluZSh4MSwgeTEsIHgyLCB5MiwgYXJyVG9Db2xvcihyZ2JBcnIpLCB0aGlja25lc3MsIGNhcFN0cikKICAgICAgICAgICAgfQogICAgICAgICAgICBsaW5lRGFzaGVkKHgxLCB5MSwgeDIsIHkyLCByZ2JBcnIsIHRoaWNrbmVzcywgZGFzaExlbmd0aCwgY2FwU3RyID0gImJ1dHQiKSB7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcih4MSk7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcih5MSk7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcih4Mik7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcih5Mik7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUFycmF5KHJnYkFycik7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcih0aGlja25lc3MpOwogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVGaW5pdGVOdW1iZXIoZGFzaExlbmd0aCk7CiAgICAgICAgICAgICAgICBWYWxpZGF0ZUxpbmVDYXAoY2FwU3RyKTsKICAgICAgICAgICAgICAgIG1hcC5nZXQodGhpcykuX0xpbmVEYXNoZWQoeDEsIHkxLCB4MiwgeTIsIGFyclRvQ29sb3IocmdiQXJyKSwgdGhpY2tuZXNzLCBkYXNoTGVuZ3RoLCBjYXBTdHIpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGluZVBvbHkocG9seUFyciwgcmdiQXJyLCB0aGlja25lc3MsIGNhcFN0ciA9ICJidXR0IikgewogICAgICAgICAgICAgICAgVmFsaWRhdGVQb2x5KHBvbHlBcnIpOwogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVBcnJheShyZ2JBcnIpOwogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVGaW5pdGVOdW1iZXIodGhpY2tuZXNzKTsKICAgICAgICAgICAgICAgIFZhbGlkYXRlTGluZUNhcChjYXBTdHIpOwogICAgICAgICAgICAgICAgbWFwLmdldCh0aGlzKS5fTGluZVBvbHkocG9seUFyciwgYXJyVG9Db2xvcihyZ2JBcnIpLCB0aGlja25lc3MsCiAgICAgICAgICAgICAgICAgICAgY2FwU3RyKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGxpbmVEYXNoZWRQb2x5KHBvbHlBcnIsIHJnYkFyciwgdGhpY2tuZXNzLCBkYXNoTGVuZ3RoLCBjYXBTdHIgPSAiYnV0dCIpIHsKICAgICAgICAgICAgICAgIFZhbGlkYXRlUG9seShwb2x5QXJyKTsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlQXJyYXkocmdiQXJyKTsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlRmluaXRlTnVtYmVyKHRoaWNrbmVzcyk7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcihkYXNoTGVuZ3RoKTsKICAgICAgICAgICAgICAgIFZhbGlkYXRlTGluZUNhcChjYXBTdHIpOwogICAgICAgICAgICAgICAgbWFwLmdldCh0aGlzKS5fTGluZURhc2hlZFBvbHkocG9seUFyciwgYXJyVG9Db2xvcihyZ2JBcnIpLCB0aGlja25lc3MsIGRhc2hMZW5ndGgsIGNhcFN0cikKICAgICAgICAgICAgfQogICAgICAgICAgICBmaWxsUG9seShwb2x5QXJyLCByZ2JBcnIpIHsKICAgICAgICAgICAgICAgIFZhbGlkYXRlUG9seShwb2x5QXJyKTsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlQXJyYXkocmdiQXJyKTsKICAgICAgICAgICAgICAgIG1hcC5nZXQodGhpcykuX0ZpbGxQb2x5KHBvbHlBcnIsIGFyclRvQ29sb3IocmdiQXJyKSkKICAgICAgICAgICAgfQogICAgICAgICAgICBzZXREcmF3QmxlbmQoYmxlbmRNb2RlKSB7CiAgICAgICAgICAgICAgICBjb25zdCBibUluZGV4ID0gQkxFTkRfTU9ERV9UT19JTkRFWC5nZXQoYmxlbmRNb2RlKTsKICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgYm1JbmRleCAhPT0KICAgICAgICAgICAgICAgICAgICAibnVtYmVyIikgdGhyb3cgbmV3IEVycm9yKCJpbnZhbGlkIGJsZW5kIG1vZGUiKTsKICAgICAgICAgICAgICAgIG1hcC5nZXQodGhpcykuX1NldERyYXdCbGVuZChibUluZGV4KQogICAgICAgICAgICB9CiAgICAgICAgICAgIHBhc3RlSW5zdGFuY2VzKGluc3RhbmNlQXJyLCBpbmNsdWRlRnggPSB0cnVlKSB7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUFycmF5KGluc3RhbmNlQXJyKTsKICAgICAgICAgICAgICAgIGNvbnN0IGluc3QgPSBtYXAuZ2V0KHRoaXMpOwogICAgICAgICAgICAgICAgY29uc3QgcnVudGltZSA9IGluc3QuR2V0UnVudGltZSgpOwogICAgICAgICAgICAgICAgcmV0dXJuIGluc3QuX1Bhc3RlSW5zdGFuY2VzKGluc3RhbmNlQXJyLm1hcChpID0+IHJ1bnRpbWUuX1Vud3JhcElXb3JsZEluc3RhbmNlKGkpKSwgISFpbmNsdWRlRngpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZ2V0SW1hZ2VQaXhlbERhdGEoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbWFwLmdldCh0aGlzKS5HZXRJbWFnZVBpeGVsRGF0YSgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgbG9hZEltYWdlUGl4ZWxEYXRhKGltYWdlRGF0YSwgcHJlbXVsdGlwbHlBbHBoYSA9IGZhbHNlKSB7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUluc3RhbmNlT2YoaW1hZ2VEYXRhLCBJbWFnZURhdGEpOwogICAgICAgICAgICAgICAgbWFwLmdldCh0aGlzKS5Mb2FkSW1hZ2VQaXhlbERhdGEoaW1hZ2VEYXRhLAogICAgICAgICAgICAgICAgICAgIHByZW11bHRpcGx5QWxwaGEsIHRydWUpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZ2V0IHN1cmZhY2VEZXZpY2VXaWR0aCgpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGluc3QgPSBtYXAuZ2V0KHRoaXMpOwogICAgICAgICAgICAgICAgaW5zdC5fTWF5YmVDcmVhdGVSZW5kZXJUYXJnZXQoKTsKICAgICAgICAgICAgICAgIGNvbnN0IHJ0ID0gaW5zdC5fR2V0UmVuZGVyVGFyZ2V0KCk7CiAgICAgICAgICAgICAgICBpZiAoIXJ0KSB0aHJvdyBuZXcgRXJyb3IoImludmFsaWQgY2FudmFzIHNpemUiKTsKICAgICAgICAgICAgICAgIHJldHVybiBydC5HZXRXaWR0aCgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZ2V0IHN1cmZhY2VEZXZpY2VIZWlnaHQoKSB7CiAgICAgICAgICAgICAgICBjb25zdCBpbnN0ID0gbWFwLmdldCh0aGlzKTsKICAgICAgICAgICAgICAgIGluc3QuX01heWJlQ3JlYXRlUmVuZGVyVGFyZ2V0KCk7CiAgICAgICAgICAgICAgICBjb25zdCBydCA9IGluc3QuX0dldFJlbmRlclRhcmdldCgpOwogICAgICAgICAgICAgICAgaWYgKCFydCkgdGhyb3cgbmV3IEVycm9yKCJpbnZhbGlkIGNhbnZhcyBzaXplIik7CiAgICAgICAgICAgICAgICByZXR1cm4gcnQuR2V0SGVpZ2h0KCkKICAgICAgICAgICAgfQogICAgICAgICAgICBnZXRTdXJmYWNlRGV2aWNlU2l6ZSgpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGluc3QgPSBtYXAuZ2V0KHRoaXMpOwogICAgICAgICAgICAgICAgaW5zdC5fTWF5YmVDcmVhdGVSZW5kZXJUYXJnZXQoKTsKICAgICAgICAgICAgICAgIGNvbnN0IHJ0ID0gaW5zdC5fR2V0UmVuZGVyVGFyZ2V0KCk7CiAgICAgICAgICAgICAgICBpZiAoIXJ0KSB0aHJvdyBuZXcgRXJyb3IoImludmFsaWQgY2FudmFzIHNpemUiKTsKICAgICAgICAgICAgICAgIHJldHVybiBbcnQuR2V0V2lkdGgoKSwgcnQuR2V0SGVpZ2h0KCldCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZ2V0IHBpeGVsU2NhbGUoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbWFwLmdldCh0aGlzKS5fR2V0UGl4ZWxTY2FsZSgpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IHsKICAgICAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICAgICAgQzMuUGx1Z2lucy5EcmF3aW5nQ2FudmFzLkNuZHMgPSB7CiAgICAgICAgICAgIE9uU2F2ZWRJbWFnZSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIE9uU25hcHNob3QoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgICAgICB9LAogICAgICAgICAgICBPblJlc29sdXRpb25DaGFuZ2VkKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gewogICAgICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgICAgICBjb25zdCB0ZW1wQ29sb3IxID0gQzMuTmV3KEMzLkNvbG9yKTsKICAgICAgICBjb25zdCB0ZW1wQ29sb3IyID0gQzMuTmV3KEMzLkNvbG9yKTsKCiAgICAgICAgZnVuY3Rpb24gUmdiVG9Db2xvcihyZ2IpIHsKICAgICAgICAgICAgdGVtcENvbG9yMS5zZXRGcm9tUmdiVmFsdWUocmdiKTsKICAgICAgICAgICAgcmV0dXJuIHRlbXBDb2xvcjEKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIFJnYlRvQ29sb3IyKHJnYikgewogICAgICAgICAgICB0ZW1wQ29sb3IyLnNldEZyb21SZ2JWYWx1ZShyZ2IpOwogICAgICAgICAgICByZXR1cm4gdGVtcENvbG9yMgogICAgICAgIH0KICAgICAgICBDMy5QbHVnaW5zLkRyYXdpbmdDYW52YXMuQWN0cyA9IHsKICAgICAgICAgICAgU2V0RWZmZWN0KGVmZmVjdCkgewogICAgICAgICAgICAgICAgdGhpcy5HZXRXb3JsZEluZm8oKS5TZXRCbGVuZE1vZGUoZWZmZWN0KTsKICAgICAgICAgICAgICAgIHRoaXMuX3J1bnRpbWUuVXBkYXRlUmVuZGVyKCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgU2V0UmVzb2x1dGlvbk1vZGUobW9kZSwgZml4ZWRXaWR0aCwgZml4ZWRIZWlnaHQpIHsKICAgICAgICAgICAgICAgIGlmIChtb2RlID09PSAxKSB0aGlzLl9TZXRGaXhlZFJlc29sdXRpb25Nb2RlKGZpeGVkV2lkdGgsIGZpeGVkSGVpZ2h0KTsKICAgICAgICAgICAgICAgIGVsc2UgdGhpcy5fU2V0QXV0b1Jlc29sdXRpb25Nb2RlKCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgQ2xlYXJDYW52YXMocmdiKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9DbGVhckNhbnZhcyhSZ2JUb0NvbG9yKHJnYikpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIENsZWFyUmVjdChsZWZ0LCB0b3AsIHJpZ2h0LCBib3R0b20sIHJnYikgewogICAgICAgICAgICAgICAgdGhpcy5fQ2xlYXJSZWN0KGxlZnQsIHRvcCwgcmlnaHQsIGJvdHRvbSwgUmdiVG9Db2xvcihyZ2IpKQogICAgICAgICAgICB9LAogICAgICAgICAgICBGaWxsUmVjdChsZWZ0LCB0b3AsIHJpZ2h0LCBib3R0b20sIHJnYikgewogICAgICAgICAgICAgICAgdGhpcy5fRmlsbFJlY3QobGVmdCwgdG9wLCByaWdodCwgYm90dG9tLCBSZ2JUb0NvbG9yKHJnYikpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIEZpbGxMaW5lYXJHcmFkaWVudChsZWZ0LCB0b3AsIHJpZ2h0LCBib3R0b20sIHJnYjEsIHJnYjIsIGRpcikgewogICAgICAgICAgICAgICAgdGhpcy5fRmlsbExpbmVhckdyYWRpZW50KGxlZnQsIHRvcCwgcmlnaHQsIGJvdHRvbSwgUmdiVG9Db2xvcihyZ2IxKSwgUmdiVG9Db2xvcjIocmdiMiksIGRpcikKICAgICAgICAgICAgfSwKICAgICAgICAgICAgRmlsbEVsbGlwc2UoeCwgeSwgcmFkaXVzWCwgcmFkaXVzWSwgcmdiLCBlZGdlKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9GaWxsRWxsaXBzZSh4LCB5LCByYWRpdXNYLCByYWRpdXNZLCBSZ2JUb0NvbG9yKHJnYiksIGVkZ2UgIT09IDApCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIE91dGxpbmVFbGxpcHNlKHgsCiAgICAgICAgICAgICAgICB5LCByYWRpdXNYLCByYWRpdXNZLCByZ2IsIHRoaWNrbmVzcywgZWRnZSkgewogICAgICAgICAgICAgICAgdGhpcy5fT3V0bGluZUVsbGlwc2UoeCwgeSwgcmFkaXVzWCwgcmFkaXVzWSwgUmdiVG9Db2xvcihyZ2IpLCB0aGlja25lc3MsIGVkZ2UgIT09IDApCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIE91dGxpbmVSZWN0KGxlZnQsIHRvcCwgcmlnaHQsIGJvdHRvbSwgcmdiLCB0aGlja25lc3MpIHsKICAgICAgICAgICAgICAgIHRoaXMuX091dGxpbmVSZWN0KGxlZnQsIHRvcCwgcmlnaHQsIGJvdHRvbSwgUmdiVG9Db2xvcihyZ2IpLCB0aGlja25lc3MpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIExpbmUoeDEsIHkxLCB4MiwgeTIsIHJnYiwgdGhpY2tuZXNzLCBjYXApIHsKICAgICAgICAgICAgICAgIGNvbnN0IGNhcFN0ciA9IGNhcCA9PT0gMCA/ICJidXR0IiA6ICJzcXVhcmUiOwogICAgICAgICAgICAgICAgdGhpcy5fTGluZSh4MSwgeTEsIHgyLCB5MiwgUmdiVG9Db2xvcihyZ2IpLCB0aGlja25lc3MsIGNhcFN0cikKICAgICAgICAgICAgfSwKICAgICAgICAgICAgTGluZURhc2hlZCh4MSwgeTEsIHgyLCB5MiwgcmdiLCB0aGlja25lc3MsIGRhc2hMZW5ndGgsIGNhcCkgewogICAgICAgICAgICAgICAgY29uc3QgY2FwU3RyID0gY2FwID09PSAwID8gImJ1dHQiIDogInNxdWFyZSI7CiAgICAgICAgICAgICAgICB0aGlzLl9MaW5lRGFzaGVkKHgxLCB5MSwgeDIsIHkyLCBSZ2JUb0NvbG9yKHJnYiksIHRoaWNrbmVzcywKICAgICAgICAgICAgICAgICAgICBkYXNoTGVuZ3RoLCBjYXBTdHIpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIEFkZFBvbHlQb2ludCh4LCB5KSB7CiAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50UG9seS5wdXNoKFt4LCB5XSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgUmVzZXRQb2x5KCkgewogICAgICAgICAgICAgICAgQzMuY2xlYXJBcnJheSh0aGlzLl9jdXJyZW50UG9seSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgTGluZVBvbHkocmdiLCB0aGlja25lc3MsIGNhcCkgewogICAgICAgICAgICAgICAgY29uc3QgY2FwU3RyID0gY2FwID09PSAwID8gImJ1dHQiIDogInNxdWFyZSI7CiAgICAgICAgICAgICAgICB0aGlzLl9MaW5lUG9seSh0aGlzLl9jdXJyZW50UG9seSwgUmdiVG9Db2xvcihyZ2IpLCB0aGlja25lc3MsIGNhcFN0cikKICAgICAgICAgICAgfSwKICAgICAgICAgICAgTGluZURhc2hlZFBvbHkocmdiLCB0aGlja25lc3MsIGRhc2hMZW5ndGgsIGNhcCkgewogICAgICAgICAgICAgICAgY29uc3QgY2FwU3RyID0gY2FwID09PSAwID8gImJ1dHQiIDogInNxdWFyZSI7CiAgICAgICAgICAgICAgICB0aGlzLl9MaW5lRGFzaGVkUG9seSh0aGlzLl9jdXJyZW50UG9seSwgUmdiVG9Db2xvcihyZ2IpLCB0aGlja25lc3MsIGRhc2hMZW5ndGgsIGNhcFN0cikKICAgICAgICAgICAgfSwKICAgICAgICAgICAgRmlsbFBvbHkocmdiKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9GaWxsUG9seSh0aGlzLl9jdXJyZW50UG9seSwgUmdiVG9Db2xvcihyZ2IpKQogICAgICAgICAgICB9LAogICAgICAgICAgICBTZXREcmF3QmxlbmQoYmxlbmRNb2RlKSB7CiAgICAgICAgICAgICAgICBpZiAoYmxlbmRNb2RlID49CiAgICAgICAgICAgICAgICAgICAgMikgYmxlbmRNb2RlKys7CiAgICAgICAgICAgICAgICB0aGlzLl9TZXREcmF3QmxlbmQoYmxlbmRNb2RlKQogICAgICAgICAgICB9LAogICAgICAgICAgICBQYXN0ZU9iamVjdChvYmplY3RDbGFzcywgaW5jbHVkZUZ4KSB7CiAgICAgICAgICAgICAgICBpZiAoIW9iamVjdENsYXNzKSByZXR1cm47CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fUGFzdGVJbnN0YW5jZXMob2JqZWN0Q2xhc3MuR2V0Q3VycmVudFNvbCgpLkdldEluc3RhbmNlcygpLCBpbmNsdWRlRnggIT09IDApCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFNhdmVJbWFnZShmb3JtYXQsIHF1YWxpdHksIHgsIHksIHdpZHRoLCBoZWlnaHQpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGZvcm1hdFN0ciA9IGZvcm1hdCA9PT0gMCA/ICJpbWFnZS9wbmciIDogImltYWdlL2pwZWciOwogICAgICAgICAgICAgICAgcXVhbGl0eSAvPSAxMDA7CiAgICAgICAgICAgICAgICBjb25zdCBhcmVhUmVjdCA9IEMzLk5ldyhDMy5SZWN0KTsKICAgICAgICAgICAgICAgIGFyZWFSZWN0LnNldFdIKHgsIHksIHdpZHRoLCBoZWlnaHQpOwogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4gewogICAgICAgICAgICAgICAgICAgIHRoaXMuX0FkZERyYXdDb21tYW5kKG5ldyBDMy5QbHVnaW5zLkRyYXdpbmdDYW52YXMuRHJhd0NvbW1hbmQuU2F2ZUltYWdlKGFzeW5jIGltYWdlRGF0YSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGltZ0RhdGFCdWZmZXIgPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW1hZ2VEYXRhLmRhdGEuYnVmZmVyOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB3aWR0aCA9IGltYWdlRGF0YS53aWR0aDsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaGVpZ2h0ID0gaW1hZ2VEYXRhLmhlaWdodDsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbmVlZEZsaXBZID0gdGhpcy5fcnVudGltZS5HZXRSZW5kZXJlcigpLklzV2ViR0woKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJvY2Vzc2VkQnVmZmVyID0gYXdhaXQgdGhpcy5fcnVudGltZS5BZGRKb2IoIlByb2Nlc3NJbWFnZURhdGEiLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiYnVmZmVyIjogaW1nRGF0YUJ1ZmZlciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ3aWR0aCI6IHdpZHRoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgImhlaWdodCI6IGhlaWdodCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ1bnByZW11bHRpcGx5IjogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJmbGlwWSI6IG5lZWRGbGlwWSAmJiAhQzMuU3VwcG9ydHMuSW1hZ2VCaXRtYXBPcHRpb25zCiAgICAgICAgICAgICAgICAgICAgICAgIH0sIFtpbWdEYXRhQnVmZmVyXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGltYWdlRGF0YSA9IG5ldyBJbWFnZURhdGEobmV3IFVpbnQ4Q2xhbXBlZEFycmF5KHByb2Nlc3NlZEJ1ZmZlciksIHdpZHRoLCBoZWlnaHQpOwogICAgICAgICAgICAgICAgICAgICAgICBsZXQgYmxvYjsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEMzLlN1cHBvcnRzLkltYWdlQml0bWFwT3B0aW9ucykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaW1hZ2VCaXRtYXAgPSBhd2FpdCBjcmVhdGVJbWFnZUJpdG1hcChpbWFnZURhdGEsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAicHJlbXVsdGlwbHlBbHBoYSI6ICJub25lIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiaW1hZ2VPcmllbnRhdGlvbiI6IG5lZWRGbGlwWSA/ICJmbGlwWSIgOiAibm9uZSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYmxvYiA9IGF3YWl0IEMzLkRyYXdhYmxlVG9CbG9iKGltYWdlQml0bWFwLCBmb3JtYXRTdHIsIHF1YWxpdHkpCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBibG9iID0gYXdhaXQgQzMuSW1hZ2VEYXRhVG9CbG9iKGltYWdlRGF0YSwgZm9ybWF0U3RyLCBxdWFsaXR5KTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX3NhdmVkSW1hZ2VVcmwpIFVSTC5yZXZva2VPYmplY3RVUkwodGhpcy5fc2F2ZWRJbWFnZVVybCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3NhdmVkSW1hZ2VVcmwgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLlRyaWdnZXIoQzMuUGx1Z2lucy5EcmF3aW5nQ2FudmFzLkNuZHMuT25TYXZlZEltYWdlKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgpCiAgICAgICAgICAgICAgICAgICAgfSwgYXJlYVJlY3QpKQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgU2F2ZVNuYXBzaG90KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4gewogICAgICAgICAgICAgICAgICAgIHRoaXMuX0FkZERyYXdDb21tYW5kKG5ldyBDMy5QbHVnaW5zLkRyYXdpbmdDYW52YXMuRHJhd0NvbW1hbmQuU2F2ZUltYWdlKGltYWdlRGF0YSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3NuYXBzaG90ID0gaW1hZ2VEYXRhOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLlRyaWdnZXIoQzMuUGx1Z2lucy5EcmF3aW5nQ2FudmFzLkNuZHMuT25TbmFwc2hvdCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoKQogICAgICAgICAgICAgICAgICAgIH0pKQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgQ2xlYXJTbmFwc2hvdCgpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3NuYXBzaG90ID0gbnVsbAogICAgICAgICAgICB9LAogICAgICAgICAgICBTbmFwc2hvdFNldFBpeGVsKHgsIHksIHJnYikgewogICAgICAgICAgICAgICAgdGhpcy5TZXRTbmFwc2hvdFBpeGVsKHgsIHksIHJnYikKICAgICAgICAgICAgfSwKICAgICAgICAgICAgTG9hZFNuYXBzaG90KCkgewogICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9zbmFwc2hvdCB8fCAhdGhpcy5fcmVuZGVyVGFyZ2V0KSByZXR1cm47CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fc25hcHNob3Qud2lkdGggIT09IHRoaXMuX3JlbmRlclRhcmdldC5HZXRXaWR0aCgpIHx8IHRoaXMuX3NuYXBzaG90LmhlaWdodCAhPT0gdGhpcy5fcmVuZGVyVGFyZ2V0LkdldEhlaWdodCgpKSByZXR1cm47CiAgICAgICAgICAgICAgICB0aGlzLkxvYWRJbWFnZVBpeGVsRGF0YSh0aGlzLl9zbmFwc2hvdCwgZmFsc2UpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IHsKICAgICAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICAgICAgQzMuUGx1Z2lucy5EcmF3aW5nQ2FudmFzLkV4cHMgPSB7CiAgICAgICAgICAgIFNhdmVkSW1hZ2VVUkwoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fc2F2ZWRJbWFnZVVybAogICAgICAgICAgICB9LAogICAgICAgICAgICBTbmFwc2hvdFJlZEF0KHgsIHkpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLkdldFNuYXBzaG90UGl4ZWwoeCwgeSlbMF0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgU25hcHNob3RHcmVlbkF0KHgsIHkpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLkdldFNuYXBzaG90UGl4ZWwoeCwgeSlbMV0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgU25hcHNob3RCbHVlQXQoeCwgeSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuR2V0U25hcHNob3RQaXhlbCh4LCB5KVsyXQogICAgICAgICAgICB9LAogICAgICAgICAgICBTbmFwc2hvdEFscGhhQXQoeCwgeSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuR2V0U25hcHNob3RQaXhlbCh4LCB5KVszXQogICAgICAgICAgICB9LAogICAgICAgICAgICBTbmFwc2hvdFdpZHRoKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NuYXBzaG90ID8gdGhpcy5fc25hcHNob3Qud2lkdGggOiAwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFNuYXBzaG90SGVpZ2h0KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NuYXBzaG90ID8gdGhpcy5fc25hcHNob3QuaGVpZ2h0IDogMAogICAgICAgICAgICB9LAogICAgICAgICAgICBQaXhlbFNjYWxlKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX0dldFBpeGVsU2NhbGUoKQogICAgICAgICAgICB9LAogICAgICAgICAgICBTdXJmYWNlRGV2aWNlV2lkdGgoKSB7CiAgICAgICAgICAgICAgICBjb25zdCBydCA9CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fR2V0UmVuZGVyVGFyZ2V0KCk7CiAgICAgICAgICAgICAgICByZXR1cm4gcnQgPyBydC5HZXRXaWR0aCgpIDogMAogICAgICAgICAgICB9LAogICAgICAgICAgICBTdXJmYWNlRGV2aWNlSGVpZ2h0KCkgewogICAgICAgICAgICAgICAgY29uc3QgcnQgPSB0aGlzLl9HZXRSZW5kZXJUYXJnZXQoKTsKICAgICAgICAgICAgICAgIHJldHVybiBydCA/IHJ0LkdldEhlaWdodCgpIDogMAogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKCn0KCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIGNvbnN0IHRlbXBRdWFkID0gQzMuTmV3KEMzLlF1YWQpOwogICAgY29uc3QgdGVtcFV2UXVhZCA9IEMzLk5ldyhDMy5RdWFkKTsKICAgIGNvbnN0IHRlbXBWZWN0b3IyID0gQzMuTmV3KEMzLlZlY3RvcjIpOwogICAgQzMuUGx1Z2lucy5EcmF3aW5nQ2FudmFzLkRyYXdDb21tYW5kID0gY2xhc3MgRHJhd0NvbW1hbmQgewogICAgICAgIGNvbnN0cnVjdG9yKCkge30KICAgICAgICBEbyhyZW5kZXJlcikgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoInJlcXVpcmVkIG92ZXJyaWRlIik7CiAgICAgICAgfQogICAgfTsKICAgIGNvbnN0IERyYXdDb21tYW5kID0gQzMuUGx1Z2lucy5EcmF3aW5nQ2FudmFzLkRyYXdDb21tYW5kOwogICAgRHJhd0NvbW1hbmQuU2F2ZUltYWdlID0gY2xhc3MgU2F2ZUltYWdlQ29tbWFuZCBleHRlbmRzIERyYXdDb21tYW5kIHsKICAgICAgICBjb25zdHJ1Y3RvcihjYWxsYmFjaywgYXJlYVJlY3QpIHsKICAgICAgICAgICAgc3VwZXIoKTsKICAgICAgICAgICAgdGhpcy5fY2FsbGJhY2sgPSBjYWxsYmFjazsKICAgICAgICAgICAgdGhpcy5fYXJlYVJlY3QgPSBhcmVhUmVjdAogICAgICAgIH0KICAgICAgICBEbyhyZW5kZXJlciwgc2NhbGUsIGNhbnZhc0luc3QpIHsKICAgICAgICAgICAgbGV0IHJlYWRSZW5kZXJUYXJnZXQgPSByZW5kZXJlci5HZXRSZW5kZXJUYXJnZXQoKTsKICAgICAgICAgICAgaWYgKHJlYWRSZW5kZXJUYXJnZXQuR2V0TXVsdGlzYW1wbGluZygpID49IDIpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHRleFJlbmRlclRhcmdldCA9IGNhbnZhc0luc3QuX0dldFRleFJlbmRlclRhcmdldCgpOwogICAgICAgICAgICAgICAgcmVuZGVyZXIuU2V0UmVuZGVyVGFyZ2V0KHRleFJlbmRlclRhcmdldCk7CiAgICAgICAgICAgICAgICByZW5kZXJlci5Db3B5UmVuZGVyVGFyZ2V0KHJlYWRSZW5kZXJUYXJnZXQsICJjcm9wIik7CiAgICAgICAgICAgICAgICByZW5kZXJlci5TZXRSZW5kZXJUYXJnZXQocmVhZFJlbmRlclRhcmdldCk7CiAgICAgICAgICAgICAgICByZWFkUmVuZGVyVGFyZ2V0ID0gdGV4UmVuZGVyVGFyZ2V0CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmVuZGVyZXIuUmVhZEJhY2tSZW5kZXJUYXJnZXRUb0ltYWdlRGF0YShyZWFkUmVuZGVyVGFyZ2V0LAogICAgICAgICAgICAgICAgZmFsc2UsIHRoaXMuX2FyZWFSZWN0KS50aGVuKHRoaXMuX2NhbGxiYWNrKQogICAgICAgIH0KICAgIH07CiAgICBEcmF3Q29tbWFuZC5DbGVhckNhbnZhcyA9IGNsYXNzIENsZWFyQ2FudmFzQ29tbWFuZCBleHRlbmRzIERyYXdDb21tYW5kIHsKICAgICAgICBjb25zdHJ1Y3Rvcihjb2xvcikgewogICAgICAgICAgICBzdXBlcigpOwogICAgICAgICAgICB0aGlzLl9jb2xvciA9IEMzLk5ldyhDMy5Db2xvciwgY29sb3IpOwogICAgICAgICAgICB0aGlzLl9jb2xvci5wcmVtdWx0aXBseSgpCiAgICAgICAgfQogICAgICAgIERvKHJlbmRlcmVyKSB7CiAgICAgICAgICAgIHJlbmRlcmVyLkNsZWFyKHRoaXMuX2NvbG9yKQogICAgICAgIH0KICAgIH07CiAgICBEcmF3Q29tbWFuZC5DbGVhclJlY3QgPSBjbGFzcyBDbGVhclJlY3RDb21tYW5kIGV4dGVuZHMgRHJhd0NvbW1hbmQgewogICAgICAgIGNvbnN0cnVjdG9yKGxlZnQsIHRvcCwgcmlnaHQsIGJvdHRvbSwgY29sb3IpIHsKICAgICAgICAgICAgc3VwZXIoKTsKICAgICAgICAgICAgdGhpcy5fcmVjdCA9IEMzLk5ldyhDMy5SZWN0KTsKICAgICAgICAgICAgdGhpcy5fcmVjdC5zZXQobGVmdCwgdG9wLCByaWdodCwgYm90dG9tKTsKICAgICAgICAgICAgdGhpcy5fY29sb3IgPSBDMy5OZXcoQzMuQ29sb3IsIGNvbG9yKTsKICAgICAgICAgICAgdGhpcy5fY29sb3IucHJlbXVsdGlwbHkoKQogICAgICAgIH0KICAgICAgICBEbyhyZW5kZXJlciwgc2NhbGUsIGNhbnZhc0luc3QpIHsKICAgICAgICAgICAgdGhpcy5fcmVjdC5tdWx0aXBseShzY2FsZSwgc2NhbGUpOwogICAgICAgICAgICByZW5kZXJlci5TZXRDb2xvckZpbGxNb2RlKCk7CiAgICAgICAgICAgIHJlbmRlcmVyLlNldENvbG9yKHRoaXMuX2NvbG9yKTsKICAgICAgICAgICAgcmVuZGVyZXIuU2V0QmxlbmRNb2RlKDMpOwogICAgICAgICAgICByZW5kZXJlci5SZWN0KHRoaXMuX3JlY3QpOwogICAgICAgICAgICBjYW52YXNJbnN0Ll9BcHBseUN1cnJlbnREcmF3aW5nQmxlbmRNb2RlKHJlbmRlcmVyKQogICAgICAgIH0KICAgIH07CiAgICBEcmF3Q29tbWFuZC5GaWxsUmVjdCA9IGNsYXNzIEZpbGxSZWN0Q29tbWFuZCBleHRlbmRzIERyYXdDb21tYW5kIHsKICAgICAgICBjb25zdHJ1Y3RvcihsZWZ0LCB0b3AsIHJpZ2h0LCBib3R0b20sIGNvbG9yKSB7CiAgICAgICAgICAgIHN1cGVyKCk7CiAgICAgICAgICAgIHRoaXMuX3JlY3QgPSBDMy5OZXcoQzMuUmVjdCk7CiAgICAgICAgICAgIHRoaXMuX3JlY3Quc2V0KGxlZnQsIHRvcCwgcmlnaHQsIGJvdHRvbSk7CiAgICAgICAgICAgIHRoaXMuX2NvbG9yID0gQzMuTmV3KEMzLkNvbG9yLCBjb2xvcik7CiAgICAgICAgICAgIHRoaXMuX2NvbG9yLnByZW11bHRpcGx5KCkKICAgICAgICB9CiAgICAgICAgRG8ocmVuZGVyZXIsIHNjYWxlKSB7CiAgICAgICAgICAgIHJlbmRlcmVyLlNldENvbG9yRmlsbE1vZGUoKTsKICAgICAgICAgICAgcmVuZGVyZXIuU2V0Q29sb3IodGhpcy5fY29sb3IpOwogICAgICAgICAgICB0aGlzLl9yZWN0Lm11bHRpcGx5KHNjYWxlLCBzY2FsZSk7CiAgICAgICAgICAgIHJlbmRlcmVyLlJlY3QodGhpcy5fcmVjdCkKICAgICAgICB9CiAgICB9OwogICAgRHJhd0NvbW1hbmQuRmlsbExpbmVhckdyYWRpZW50ID0gY2xhc3MgRmlsbExpbmVhckdyYWRpZW50Q29tbWFuZCBleHRlbmRzIERyYXdDb21tYW5kIHsKICAgICAgICBjb25zdHJ1Y3RvcihsZWZ0LCB0b3AsIHJpZ2h0LCBib3R0b20sIGNvbG9yMSwgY29sb3IyLCBkaXIpIHsKICAgICAgICAgICAgc3VwZXIoKTsKICAgICAgICAgICAgdGhpcy5fcmVjdCA9IEMzLk5ldyhDMy5SZWN0KTsKICAgICAgICAgICAgdGhpcy5fcmVjdC5zZXQobGVmdCwgdG9wLCByaWdodCwgYm90dG9tKTsKICAgICAgICAgICAgdGhpcy5fY29sb3IxID0gQzMuTmV3KEMzLkNvbG9yLCBjb2xvcjEpOwogICAgICAgICAgICB0aGlzLl9jb2xvcjIgPSBDMy5OZXcoQzMuQ29sb3IsIGNvbG9yMik7CiAgICAgICAgICAgIHRoaXMuX2RpciA9IGRpcgogICAgICAgIH0KICAgICAgICBEbyhyZW5kZXJlciwgc2NhbGUpIHsKICAgICAgICAgICAgcmVuZGVyZXIuU2V0TGluZWFyR3JhZGllbnRGaWxsTW9kZSgpOwogICAgICAgICAgICByZW5kZXJlci5TZXRDb2xvcih0aGlzLl9jb2xvcjEpOwogICAgICAgICAgICByZW5kZXJlci5TZXRHcmFkaWVudENvbG9yKHRoaXMuX2NvbG9yMik7CiAgICAgICAgICAgIHRoaXMuX3JlY3QubXVsdGlwbHkoc2NhbGUsIHNjYWxlKTsKICAgICAgICAgICAgdGVtcFF1YWQuc2V0RnJvbVJlY3QodGhpcy5fcmVjdCk7CiAgICAgICAgICAgIGlmICh0aGlzLl9kaXIgPT09CiAgICAgICAgICAgICAgICAwKSB0ZW1wVXZRdWFkLnNldCgwLCAwLCAxLCAwLCAxLCAxLCAwLCAxKTsKICAgICAgICAgICAgZWxzZSB0ZW1wVXZRdWFkLnNldCgwLCAxLCAwLCAwLCAxLCAwLCAxLCAxKTsKICAgICAgICAgICAgcmVuZGVyZXIuUXVhZDQodGVtcFF1YWQsIHRlbXBVdlF1YWQpCiAgICAgICAgfQogICAgfTsKICAgIERyYXdDb21tYW5kLkZpbGxFbGxpcHNlID0gY2xhc3MgRmlsbEVsbGlwc2VDb21tYW5kIGV4dGVuZHMgRHJhd0NvbW1hbmQgewogICAgICAgIGNvbnN0cnVjdG9yKHgsIHksIHJhZGl1c1gsIHJhZGl1c1ksIGNvbG9yLCBpc1Ntb290aCkgewogICAgICAgICAgICBzdXBlcigpOwogICAgICAgICAgICB0aGlzLl9yZWN0ID0gQzMuTmV3KEMzLlJlY3QpOwogICAgICAgICAgICB0aGlzLl9yZWN0LnNldCh4IC0gcmFkaXVzWCwgeSAtIHJhZGl1c1ksIHggKyByYWRpdXNYLCB5ICsgcmFkaXVzWSk7CiAgICAgICAgICAgIHRoaXMuX2NvbG9yID0gQzMuTmV3KEMzLkNvbG9yLCBjb2xvcik7CiAgICAgICAgICAgIHRoaXMuX2NvbG9yLnByZW11bHRpcGx5KCk7CiAgICAgICAgICAgIHRoaXMuX2lzU21vb3RoID0gaXNTbW9vdGgKICAgICAgICB9CiAgICAgICAgRG8ocmVuZGVyZXIsIHNjYWxlKSB7CiAgICAgICAgICAgIHRoaXMuX3JlY3QubXVsdGlwbHkoc2NhbGUsIHNjYWxlKTsKICAgICAgICAgICAgaWYgKHRoaXMuX2lzU21vb3RoKSB7CiAgICAgICAgICAgICAgICByZW5kZXJlci5TZXRTbW9vdGhFbGxpcHNlRmlsbE1vZGUoKTsKICAgICAgICAgICAgICAgIHJlbmRlcmVyLlNldENvbG9yKHRoaXMuX2NvbG9yKTsKICAgICAgICAgICAgICAgIHRoaXMuX3JlY3QuaW5mbGF0ZSguNSwgLjUpOwogICAgICAgICAgICAgICAgcmVuZGVyZXIuU2V0RWxsaXBzZVBhcmFtcygxIC8gdGhpcy5fcmVjdC53aWR0aCgpLAogICAgICAgICAgICAgICAgICAgIDEgLyB0aGlzLl9yZWN0LmhlaWdodCgpKTsKICAgICAgICAgICAgICAgIHJlbmRlcmVyLlJlY3QodGhpcy5fcmVjdCkKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJlbmRlcmVyLlNldEhhcmRFbGxpcHNlRmlsbE1vZGUoKTsKICAgICAgICAgICAgICAgIHJlbmRlcmVyLlNldENvbG9yKHRoaXMuX2NvbG9yKTsKICAgICAgICAgICAgICAgIHJlbmRlcmVyLlJlY3QodGhpcy5fcmVjdCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICBEcmF3Q29tbWFuZC5PdXRsaW5lRWxsaXBzZSA9IGNsYXNzIE91dGxpbmVsbGlwc2VDb21tYW5kIGV4dGVuZHMgRHJhd0NvbW1hbmQgewogICAgICAgIGNvbnN0cnVjdG9yKHgsIHksIHJhZGl1c1gsIHJhZGl1c1ksIGNvbG9yLCB0aGlja25lc3MsIGlzU21vb3RoKSB7CiAgICAgICAgICAgIHN1cGVyKCk7CiAgICAgICAgICAgIHRoaXMuX3JlY3QgPSBDMy5OZXcoQzMuUmVjdCk7CiAgICAgICAgICAgIHRoaXMuX3JlY3Quc2V0KHggLSByYWRpdXNYLCB5IC0gcmFkaXVzWSwgeCArIHJhZGl1c1gsIHkgKyByYWRpdXNZKTsKICAgICAgICAgICAgdGhpcy5fY29sb3IgPSBDMy5OZXcoQzMuQ29sb3IsIGNvbG9yKTsKICAgICAgICAgICAgdGhpcy5fY29sb3IucHJlbXVsdGlwbHkoKTsKICAgICAgICAgICAgdGhpcy5fdGhpY2tuZXNzID0gdGhpY2tuZXNzOwogICAgICAgICAgICB0aGlzLl9pc1Ntb290aCA9IGlzU21vb3RoCiAgICAgICAgfQogICAgICAgIERvKHJlbmRlcmVyLCBzY2FsZSkgewogICAgICAgICAgICB0aGlzLl9yZWN0Lm11bHRpcGx5KHNjYWxlLCBzY2FsZSk7CiAgICAgICAgICAgIGlmICh0aGlzLl9pc1Ntb290aCkgewogICAgICAgICAgICAgICAgcmVuZGVyZXIuU2V0U21vb3RoRWxsaXBzZU91dGxpbmVNb2RlKCk7CiAgICAgICAgICAgICAgICByZW5kZXJlci5TZXRDb2xvcih0aGlzLl9jb2xvcik7CiAgICAgICAgICAgICAgICB0aGlzLl9yZWN0LmluZmxhdGUoLjUsIC41KTsKICAgICAgICAgICAgICAgIHJlbmRlcmVyLlNldEVsbGlwc2VQYXJhbXMoMSAvIHRoaXMuX3JlY3Qud2lkdGgoKSwgMSAvIHRoaXMuX3JlY3QuaGVpZ2h0KCksIHRoaXMuX3RoaWNrbmVzcyAqIHNjYWxlKTsKICAgICAgICAgICAgICAgIHJlbmRlcmVyLlJlY3QodGhpcy5fcmVjdCkKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJlbmRlcmVyLlNldEhhcmRFbGxpcHNlT3V0bGluZU1vZGUoKTsKICAgICAgICAgICAgICAgIHJlbmRlcmVyLlNldEVsbGlwc2VQYXJhbXMoMSAvIHRoaXMuX3JlY3Qud2lkdGgoKSwgMSAvIHRoaXMuX3JlY3QuaGVpZ2h0KCksIHRoaXMuX3RoaWNrbmVzcyAqIHNjYWxlKTsKICAgICAgICAgICAgICAgIHJlbmRlcmVyLlNldENvbG9yKHRoaXMuX2NvbG9yKTsKICAgICAgICAgICAgICAgIHJlbmRlcmVyLlJlY3QodGhpcy5fcmVjdCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICBEcmF3Q29tbWFuZC5PdXRsaW5lUmVjdCA9IGNsYXNzIE91dGxpbmVSZWN0Q29tbWFuZCBleHRlbmRzIERyYXdDb21tYW5kIHsKICAgICAgICBjb25zdHJ1Y3RvcihsZWZ0LCB0b3AsIHJpZ2h0LCBib3R0b20sIGNvbG9yLCB0aGlja25lc3MpIHsKICAgICAgICAgICAgc3VwZXIoKTsKICAgICAgICAgICAgdGhpcy5fcmVjdCA9IEMzLk5ldyhDMy5SZWN0KTsKICAgICAgICAgICAgdGhpcy5fcmVjdC5zZXQobGVmdCwgdG9wLCByaWdodCwgYm90dG9tKTsKICAgICAgICAgICAgdGhpcy5fY29sb3IgPSBDMy5OZXcoQzMuQ29sb3IsIGNvbG9yKTsKICAgICAgICAgICAgdGhpcy5fY29sb3IucHJlbXVsdGlwbHkoKTsKICAgICAgICAgICAgdGhpcy5fdGhpY2tuZXNzID0gdGhpY2tuZXNzCiAgICAgICAgfQogICAgICAgIERvKHJlbmRlcmVyLCBzY2FsZSkgewogICAgICAgICAgICByZW5kZXJlci5TZXRDb2xvckZpbGxNb2RlKCk7CiAgICAgICAgICAgIHJlbmRlcmVyLlNldENvbG9yKHRoaXMuX2NvbG9yKTsKICAgICAgICAgICAgcmVuZGVyZXIuUHVzaExpbmVDYXBaYWcoKTsKICAgICAgICAgICAgcmVuZGVyZXIuUHVzaExpbmVXaWR0aCh0aGlzLl90aGlja25lc3MgKiBzY2FsZSk7CiAgICAgICAgICAgIHRoaXMuX3JlY3QubXVsdGlwbHkoc2NhbGUsIHNjYWxlKTsKICAgICAgICAgICAgcmVuZGVyZXIuTGluZVJlY3QyKHRoaXMuX3JlY3QpOwogICAgICAgICAgICByZW5kZXJlci5Qb3BMaW5lQ2FwKCk7CiAgICAgICAgICAgIHJlbmRlcmVyLlBvcExpbmVXaWR0aCgpCiAgICAgICAgfQogICAgfTsKICAgIERyYXdDb21tYW5kLkxpbmUgPSBjbGFzcyBMaW5lQ29tbWFuZCBleHRlbmRzIERyYXdDb21tYW5kIHsKICAgICAgICBjb25zdHJ1Y3Rvcih4MSwgeTEsIHgyLCB5MiwgY29sb3IsIHRoaWNrbmVzcywgY2FwKSB7CiAgICAgICAgICAgIHN1cGVyKCk7CiAgICAgICAgICAgIHRoaXMuX3JlY3QgPSBDMy5OZXcoQzMuUmVjdCk7CiAgICAgICAgICAgIHRoaXMuX3JlY3Quc2V0KHgxLCB5MSwgeDIsIHkyKTsKICAgICAgICAgICAgdGhpcy5fY29sb3IgPSBDMy5OZXcoQzMuQ29sb3IsIGNvbG9yKTsKICAgICAgICAgICAgdGhpcy5fY29sb3IucHJlbXVsdGlwbHkoKTsKICAgICAgICAgICAgdGhpcy5fdGhpY2tuZXNzID0gdGhpY2tuZXNzOwogICAgICAgICAgICB0aGlzLl9jYXAgPSBjYXAKICAgICAgICB9CiAgICAgICAgRG8ocmVuZGVyZXIsIHNjYWxlKSB7CiAgICAgICAgICAgIHJlbmRlcmVyLlNldENvbG9yRmlsbE1vZGUoKTsKICAgICAgICAgICAgcmVuZGVyZXIuU2V0Q29sb3IodGhpcy5fY29sb3IpOwogICAgICAgICAgICByZW5kZXJlci5QdXNoTGluZUNhcCh0aGlzLl9jYXApOwogICAgICAgICAgICByZW5kZXJlci5QdXNoTGluZVdpZHRoKHRoaXMuX3RoaWNrbmVzcyAqIHNjYWxlKTsKICAgICAgICAgICAgY29uc3QgcmMgPSB0aGlzLl9yZWN0OwogICAgICAgICAgICByYy5tdWx0aXBseShzY2FsZSwgc2NhbGUpOwogICAgICAgICAgICByZW5kZXJlci5MaW5lKHJjLmdldExlZnQoKSwgcmMuZ2V0VG9wKCksCiAgICAgICAgICAgICAgICByYy5nZXRSaWdodCgpLCByYy5nZXRCb3R0b20oKSk7CiAgICAgICAgICAgIHJlbmRlcmVyLlBvcExpbmVDYXAoKTsKICAgICAgICAgICAgcmVuZGVyZXIuUG9wTGluZVdpZHRoKCkKICAgICAgICB9CiAgICB9OwogICAgRHJhd0NvbW1hbmQuTGluZVBvbHkgPSBjbGFzcyBMaW5lUG9seUNvbW1hbmQgZXh0ZW5kcyBEcmF3Q29tbWFuZCB7CiAgICAgICAgY29uc3RydWN0b3IocG9seSwgY29sb3IsIHRoaWNrbmVzcywgY2FwKSB7CiAgICAgICAgICAgIHN1cGVyKCk7CiAgICAgICAgICAgIHRoaXMuX3BvbHkgPSBwb2x5OwogICAgICAgICAgICB0aGlzLl9jb2xvciA9IEMzLk5ldyhDMy5Db2xvciwgY29sb3IpOwogICAgICAgICAgICB0aGlzLl9jb2xvci5wcmVtdWx0aXBseSgpOwogICAgICAgICAgICB0aGlzLl90aGlja25lc3MgPSB0aGlja25lc3M7CiAgICAgICAgICAgIHRoaXMuX2NhcCA9IGNhcAogICAgICAgIH0KICAgICAgICBEbyhyZW5kZXJlciwgc2NhbGUpIHsKICAgICAgICAgICAgcmVuZGVyZXIuU2V0Q29sb3JGaWxsTW9kZSgpOwogICAgICAgICAgICByZW5kZXJlci5TZXRDb2xvcih0aGlzLl9jb2xvcik7CiAgICAgICAgICAgIHJlbmRlcmVyLlB1c2hMaW5lQ2FwKHRoaXMuX2NhcCk7CiAgICAgICAgICAgIHJlbmRlcmVyLlB1c2hMaW5lV2lkdGgodGhpcy5fdGhpY2tuZXNzICogc2NhbGUpOwogICAgICAgICAgICBjb25zdCBwb2x5ID0gdGhpcy5fcG9seTsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IHBvbHkubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGogPSAoaSArIDEpICUgbGVuOwogICAgICAgICAgICAgICAgY29uc3QgeDEgPSBwb2x5W2ldWzBdICogc2NhbGU7CiAgICAgICAgICAgICAgICBjb25zdCB5MSA9IHBvbHlbaV1bMV0gKgogICAgICAgICAgICAgICAgICAgIHNjYWxlOwogICAgICAgICAgICAgICAgY29uc3QgeDIgPSBwb2x5W2pdWzBdICogc2NhbGU7CiAgICAgICAgICAgICAgICBjb25zdCB5MiA9IHBvbHlbal1bMV0gKiBzY2FsZTsKICAgICAgICAgICAgICAgIHJlbmRlcmVyLkxpbmUoeDEsIHkxLCB4MiwgeTIpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmVuZGVyZXIuUG9wTGluZUNhcCgpOwogICAgICAgICAgICByZW5kZXJlci5Qb3BMaW5lV2lkdGgoKQogICAgICAgIH0KICAgIH07CiAgICBEcmF3Q29tbWFuZC5MaW5lRGFzaGVkID0gY2xhc3MgTGluZURhc2hlZENvbW1hbmQgZXh0ZW5kcyBEcmF3Q29tbWFuZCB7CiAgICAgICAgY29uc3RydWN0b3IoeDEsIHkxLCB4MiwgeTIsIGNvbG9yLCB0aGlja25lc3MsIGRhc2hMZW5ndGgsIGRhc2hUZXgsIGNhcCkgewogICAgICAgICAgICBzdXBlcigpOwogICAgICAgICAgICB0aGlzLl9yZWN0ID0gQzMuTmV3KEMzLlJlY3QpOwogICAgICAgICAgICB0aGlzLl9yZWN0LnNldCh4MSwgeTEsIHgyLCB5Mik7CiAgICAgICAgICAgIHRoaXMuX2NvbG9yID0gQzMuTmV3KEMzLkNvbG9yLCBjb2xvcik7CiAgICAgICAgICAgIHRoaXMuX2NvbG9yLnByZW11bHRpcGx5KCk7CiAgICAgICAgICAgIHRoaXMuX3RoaWNrbmVzcyA9IHRoaWNrbmVzczsKICAgICAgICAgICAgdGhpcy5fZGFzaExlbmd0aCA9IGRhc2hMZW5ndGg7CiAgICAgICAgICAgIHRoaXMuX2Rhc2hUZXggPSBkYXNoVGV4OwogICAgICAgICAgICB0aGlzLl9jYXAgPSBjYXAKICAgICAgICB9CiAgICAgICAgRG8ocmVuZGVyZXIsIHNjYWxlKSB7CiAgICAgICAgICAgIHJlbmRlcmVyLlNldFRleHR1cmVGaWxsTW9kZSgpOwogICAgICAgICAgICByZW5kZXJlci5TZXRUZXh0dXJlKHRoaXMuX2Rhc2hUZXgpOwogICAgICAgICAgICByZW5kZXJlci5TZXRDb2xvcih0aGlzLl9jb2xvcik7CiAgICAgICAgICAgIHJlbmRlcmVyLlB1c2hMaW5lQ2FwKHRoaXMuX2NhcCk7CiAgICAgICAgICAgIHJlbmRlcmVyLlB1c2hMaW5lV2lkdGgodGhpcy5fdGhpY2tuZXNzICoKICAgICAgICAgICAgICAgIHNjYWxlKTsKICAgICAgICAgICAgY29uc3QgcmMgPSB0aGlzLl9yZWN0OwogICAgICAgICAgICBjb25zdCBudW1EYXNoZXMgPSBDMy5kaXN0YW5jZVRvKHJjLmdldExlZnQoKSwgcmMuZ2V0VG9wKCksIHJjLmdldFJpZ2h0KCksIHJjLmdldEJvdHRvbSgpKSAvICh0aGlzLl9kYXNoTGVuZ3RoICogMik7CiAgICAgICAgICAgIHJjLm11bHRpcGx5KHNjYWxlLCBzY2FsZSk7CiAgICAgICAgICAgIHJlbmRlcmVyLlRleHR1cmVkTGluZShyYy5nZXRMZWZ0KCksIHJjLmdldFRvcCgpLCByYy5nZXRSaWdodCgpLCByYy5nZXRCb3R0b20oKSwgMCwgbnVtRGFzaGVzKTsKICAgICAgICAgICAgcmVuZGVyZXIuUG9wTGluZUNhcCgpOwogICAgICAgICAgICByZW5kZXJlci5Qb3BMaW5lV2lkdGgoKQogICAgICAgIH0KICAgIH07CiAgICBEcmF3Q29tbWFuZC5MaW5lRGFzaGVkUG9seSA9IGNsYXNzIExpbmVEYXNoZWRQb2x5Q29tbWFuZCBleHRlbmRzIERyYXdDb21tYW5kIHsKICAgICAgICBjb25zdHJ1Y3Rvcihwb2x5LCBjb2xvciwgdGhpY2tuZXNzLCBkYXNoTGVuZ3RoLCBkYXNoVGV4LCBjYXApIHsKICAgICAgICAgICAgc3VwZXIoKTsKICAgICAgICAgICAgdGhpcy5fcG9seSA9IHBvbHk7CiAgICAgICAgICAgIHRoaXMuX2NvbG9yID0gQzMuTmV3KEMzLkNvbG9yLCBjb2xvcik7CiAgICAgICAgICAgIHRoaXMuX2NvbG9yLnByZW11bHRpcGx5KCk7CiAgICAgICAgICAgIHRoaXMuX3RoaWNrbmVzcyA9IHRoaWNrbmVzczsKICAgICAgICAgICAgdGhpcy5fZGFzaExlbmd0aCA9IGRhc2hMZW5ndGg7CiAgICAgICAgICAgIHRoaXMuX2Rhc2hUZXggPSBkYXNoVGV4OwogICAgICAgICAgICB0aGlzLl9jYXAgPSBjYXAKICAgICAgICB9CiAgICAgICAgRG8ocmVuZGVyZXIsIHNjYWxlKSB7CiAgICAgICAgICAgIHJlbmRlcmVyLlNldFRleHR1cmVGaWxsTW9kZSgpOwogICAgICAgICAgICByZW5kZXJlci5TZXRUZXh0dXJlKHRoaXMuX2Rhc2hUZXgpOwogICAgICAgICAgICByZW5kZXJlci5TZXRDb2xvcih0aGlzLl9jb2xvcik7CiAgICAgICAgICAgIHJlbmRlcmVyLlB1c2hMaW5lQ2FwKHRoaXMuX2NhcCk7CiAgICAgICAgICAgIHJlbmRlcmVyLlB1c2hMaW5lV2lkdGgodGhpcy5fdGhpY2tuZXNzICogc2NhbGUpOwogICAgICAgICAgICBsZXQgdSA9CiAgICAgICAgICAgICAgICAwOwogICAgICAgICAgICBjb25zdCBwb2x5ID0gdGhpcy5fcG9seTsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IHBvbHkubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGogPSAoaSArIDEpICUgbGVuOwogICAgICAgICAgICAgICAgY29uc3QgeDEgPSBwb2x5W2ldWzBdOwogICAgICAgICAgICAgICAgY29uc3QgeTEgPSBwb2x5W2ldWzFdOwogICAgICAgICAgICAgICAgY29uc3QgeDIgPSBwb2x5W2pdWzBdOwogICAgICAgICAgICAgICAgY29uc3QgeTIgPSBwb2x5W2pdWzFdOwogICAgICAgICAgICAgICAgY29uc3QgdiA9IHUgKyBDMy5kaXN0YW5jZVRvKHgxLCB5MSwgeDIsIHkyKSAvICh0aGlzLl9kYXNoTGVuZ3RoICogMik7CiAgICAgICAgICAgICAgICByZW5kZXJlci5UZXh0dXJlZExpbmUoeDEgKiBzY2FsZSwgeTEgKiBzY2FsZSwgeDIgKiBzY2FsZSwgeTIgKiBzY2FsZSwgdSwgdik7CiAgICAgICAgICAgICAgICB1ID0gdiAtIE1hdGguZmxvb3IodikKICAgICAgICAgICAgfQogICAgICAgICAgICByZW5kZXJlci5Qb3BMaW5lQ2FwKCk7CiAgICAgICAgICAgIHJlbmRlcmVyLlBvcExpbmVXaWR0aCgpCiAgICAgICAgfQogICAgfTsKICAgIERyYXdDb21tYW5kLkZpbGxQb2x5ID0gY2xhc3MgRmlsbFBvbHlDb21tYW5kIGV4dGVuZHMgRHJhd0NvbW1hbmQgewogICAgICAgIGNvbnN0cnVjdG9yKHBvbHksIGNvbG9yKSB7CiAgICAgICAgICAgIHN1cGVyKCk7CiAgICAgICAgICAgIHRoaXMuX3BvbHkgPSBwb2x5OwogICAgICAgICAgICB0aGlzLl9jb2xvciA9IEMzLk5ldyhDMy5Db2xvciwgY29sb3IpOwogICAgICAgICAgICB0aGlzLl9jb2xvci5wcmVtdWx0aXBseSgpCiAgICAgICAgfQogICAgICAgIERvKHJlbmRlcmVyLCBzY2FsZSkgewogICAgICAgICAgICByZW5kZXJlci5TZXRDb2xvckZpbGxNb2RlKCk7CiAgICAgICAgICAgIHJlbmRlcmVyLlNldENvbG9yKHRoaXMuX2NvbG9yKTsKICAgICAgICAgICAgY29uc3QgcG9seSA9IHRoaXMuX3BvbHk7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBwb2x5Lmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7CiAgICAgICAgICAgICAgICBjb25zdCBwID0gcG9seVtpXTsKICAgICAgICAgICAgICAgIHBbMF0gKj0gc2NhbGU7CiAgICAgICAgICAgICAgICBwWzFdICo9IHNjYWxlCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgcG9seURlY29tcCA9IHNlbGYucG9seURlY29tcDsKICAgICAgICAgICAgaWYgKCFwb2x5RGVjb21wLmlzU2ltcGxlKHBvbHkpKSByZXR1cm47CiAgICAgICAgICAgIHBvbHlEZWNvbXAubWFrZUNDVyhwb2x5KTsKICAgICAgICAgICAgcG9seURlY29tcC5yZW1vdmVDb2xsaW5lYXJQb2ludHMocG9seSwgQzMudG9SYWRpYW5zKC4xKSk7CiAgICAgICAgICAgIGNvbnN0IGNvbnZleFBvbHlnb25zID0gcG9seURlY29tcC5xdWlja0RlY29tcChwb2x5KTsKICAgICAgICAgICAgZm9yIChjb25zdCBjb252ZXhQb2x5IG9mIGNvbnZleFBvbHlnb25zKSByZW5kZXJlci5Db252ZXhQb2x5KGNvbnZleFBvbHkuZmxhdCgpKQogICAgICAgIH0KICAgIH07CiAgICBEcmF3Q29tbWFuZC5TZXREcmF3QmxlbmQgPSBjbGFzcyBTZXREcmF3QmxlbmQgZXh0ZW5kcyBEcmF3Q29tbWFuZCB7CiAgICAgICAgY29uc3RydWN0b3IoYm0pIHsKICAgICAgICAgICAgc3VwZXIoKTsKICAgICAgICAgICAgdGhpcy5fYmxlbmRJbmRleCA9IGJtCiAgICAgICAgfQogICAgICAgIERvKHJlbmRlcmVyLCBzY2FsZSwgY2FudmFzSW5zdCkgewogICAgICAgICAgICBjYW52YXNJbnN0Ll9TZXREcmF3aW5nQmxlbmRNb2RlKHRoaXMuX2JsZW5kSW5kZXgpOwogICAgICAgICAgICBjYW52YXNJbnN0Ll9BcHBseUN1cnJlbnREcmF3aW5nQmxlbmRNb2RlKHJlbmRlcmVyKQogICAgICAgIH0KICAgIH07CiAgICBEcmF3Q29tbWFuZC5EcmF3SW5zdGFuY2VzID0gY2xhc3MgRHJhd0luc3RhbmNlc0NvbW1hbmQgZXh0ZW5kcyBEcmF3Q29tbWFuZCB7CiAgICAgICAgY29uc3RydWN0b3IoaW5zdGFuY2VzLCBpbmNsdWRlRngsIGNhbnZhc1dpLCByZXNvbHZlKSB7CiAgICAgICAgICAgIHN1cGVyKCk7CiAgICAgICAgICAgIGNvbnN0IG93bkxheWVyID0gY2FudmFzV2kuR2V0TGF5ZXIoKTsKICAgICAgICAgICAgdGhpcy5faW5jbHVkZUZ4ID0gaW5jbHVkZUZ4OwogICAgICAgICAgICB0aGlzLl9yZXNvbHZlID0gcmVzb2x2ZTsKICAgICAgICAgICAgdGhpcy5fbGF5b3V0VHJhbnNmb3JtID0gb3duTGF5ZXIuR2V0TGF5b3V0KCkuU2F2ZVRyYW5zZm9ybSgpOwogICAgICAgICAgICB0aGlzLl9sYXllclRyYW5zZm9ybXMgPSBuZXcgTWFwOwogICAgICAgICAgICB0aGlzLl9sYXllclRyYW5zZm9ybXMuc2V0KG93bkxheWVyLCBvd25MYXllci5TYXZlVHJhbnNmb3JtKCkpOwogICAgICAgICAgICB0aGlzLl9pbnN0YW5jZXMgPSBpbnN0YW5jZXMubWFwKGluc3QgPT4gdGhpcy5fU2F2ZUluc3RhbmNlU3RhdGUoaW5zdCwgY2FudmFzV2kpKQogICAgICAgIH0KICAgICAgICBfU2F2ZUluc3RhbmNlU3RhdGUoaW5zdCwgY2FudmFzV2kpIHsKICAgICAgICAgICAgY29uc3QgY2FudmFzQW5nbGUgPSBjYW52YXNXaS5HZXRBbmdsZSgpOwogICAgICAgICAgICBjb25zdCBjYW52YXNMYXllciA9IGNhbnZhc1dpLkdldExheWVyKCk7CiAgICAgICAgICAgIGNvbnN0IGluc3RXaSA9IGluc3QuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgIGNvbnN0IGluc3RMYXllciA9IGluc3RXaS5HZXRMYXllcigpOwogICAgICAgICAgICBjb25zdCBvbGRYID0gaW5zdFdpLkdldFgoKTsKICAgICAgICAgICAgY29uc3Qgb2xkWSA9IGluc3RXaS5HZXRZKCk7CiAgICAgICAgICAgIGNvbnN0IG9sZFdpZHRoID0gaW5zdFdpLkdldFdpZHRoKCk7CiAgICAgICAgICAgIGNvbnN0IG9sZEhlaWdodCA9IGluc3RXaS5HZXRIZWlnaHQoKTsKICAgICAgICAgICAgY29uc3Qgb2xkQW5nbGUgPSBpbnN0V2kuR2V0QW5nbGUoKTsKICAgICAgICAgICAgaWYgKCF0aGlzLl9sYXllclRyYW5zZm9ybXMuaGFzKGluc3RMYXllcikpIHRoaXMuX2xheWVyVHJhbnNmb3Jtcy5zZXQoaW5zdExheWVyLCBpbnN0TGF5ZXIuU2F2ZVRyYW5zZm9ybSgpKTsKICAgICAgICAgICAgY29uc3QgYXJlTGF5ZXJUcmFuc2Zvcm1zQ29tcGF0aWJsZSA9IGNhbnZhc0xheWVyLklzVHJhbnNmb3JtQ29tcGF0aWJsZVdpdGgoaW5zdExheWVyKTsKICAgICAgICAgICAgaWYgKCFhcmVMYXllclRyYW5zZm9ybXNDb21wYXRpYmxlKSB7CiAgICAgICAgICAgICAgICBjb25zdCBbZHN4LCBkc3ldID0gaW5zdExheWVyLkxheWVyVG9EcmF3U3VyZmFjZShvbGRYLAogICAgICAgICAgICAgICAgICAgIG9sZFkpOwogICAgICAgICAgICAgICAgY29uc3QgW3R4LCB0eV0gPSBjYW52YXNMYXllci5EcmF3U3VyZmFjZVRvTGF5ZXIoZHN4LCBkc3kpOwogICAgICAgICAgICAgICAgaW5zdFdpLlNldFhZKHR4LCB0eSk7CiAgICAgICAgICAgICAgICBjb25zdCBzY2FsZUZhY3RvciA9IGluc3RMYXllci5HZXROb3JtYWxTY2FsZSgpIC8gY2FudmFzTGF5ZXIuR2V0Tm9ybWFsU2NhbGUoKTsKICAgICAgICAgICAgICAgIGluc3RXaS5TZXRTaXplKG9sZFdpZHRoICogc2NhbGVGYWN0b3IsIG9sZEhlaWdodCAqIHNjYWxlRmFjdG9yKTsKICAgICAgICAgICAgICAgIGNvbnN0IGFuZ2xlT2Zmc2V0ID0gY2FudmFzTGF5ZXIuR2V0T3duQW5nbGUoKSAtIGluc3RMYXllci5HZXRPd25BbmdsZSgpOwogICAgICAgICAgICAgICAgaW5zdFdpLk9mZnNldEFuZ2xlKGFuZ2xlT2Zmc2V0KQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChjYW52YXNBbmdsZSAhPT0gMCkgewogICAgICAgICAgICAgICAgY29uc3QgY2FudmFzUXVhZCA9IGNhbnZhc1dpLkdldEJvdW5kaW5nUXVhZCgpOwogICAgICAgICAgICAgICAgY29uc3QgY2FudmFzTWlkWCA9IGNhbnZhc1F1YWQubWlkWCgpOwogICAgICAgICAgICAgICAgY29uc3QgY2FudmFzTWlkWSA9IGNhbnZhc1F1YWQubWlkWSgpOwogICAgICAgICAgICAgICAgY29uc3Qgc2luQSA9IC1jYW52YXNXaS5HZXRTaW5BbmdsZSgpOwogICAgICAgICAgICAgICAgY29uc3QgY29zQSA9IGNhbnZhc1dpLkdldENvc0FuZ2xlKCk7CiAgICAgICAgICAgICAgICB0ZW1wVmVjdG9yMi5zZXQob2xkWCwgb2xkWSk7CiAgICAgICAgICAgICAgICB0ZW1wVmVjdG9yMi5vZmZzZXQoLWNhbnZhc01pZFgsIC1jYW52YXNNaWRZKTsKICAgICAgICAgICAgICAgIHRlbXBWZWN0b3IyLnJvdGF0ZVByZWNhbGMoc2luQSwgY29zQSk7CiAgICAgICAgICAgICAgICB0ZW1wVmVjdG9yMi5vZmZzZXQoY2FudmFzTWlkWCwgY2FudmFzTWlkWSk7CiAgICAgICAgICAgICAgICBpbnN0V2kuU2V0WFkodGVtcFZlY3RvcjIuZ2V0WCgpLCB0ZW1wVmVjdG9yMi5nZXRZKCkpOwogICAgICAgICAgICAgICAgaW5zdFdpLk9mZnNldEFuZ2xlKC1jYW52YXNBbmdsZSkKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoY2FudmFzQW5nbGUgIT09IDAgfHwgIWFyZUxheWVyVHJhbnNmb3Jtc0NvbXBhdGlibGUpIGluc3RXaS5TZXRCYm94Q2hhbmdlZCgpOwogICAgICAgICAgICBjb25zdCByZXQgPSBbaW5zdCwgaW5zdC5TYXZlVG9Kc29uKCJ2aXN1YWwtc3RhdGUiKV07CiAgICAgICAgICAgIGlmIChjYW52YXNBbmdsZSAhPT0gMCB8fCAhYXJlTGF5ZXJUcmFuc2Zvcm1zQ29tcGF0aWJsZSkgewogICAgICAgICAgICAgICAgaW5zdFdpLlNldFhZKG9sZFgsIG9sZFkpOwogICAgICAgICAgICAgICAgaW5zdFdpLlNldFNpemUob2xkV2lkdGgsIG9sZEhlaWdodCk7CiAgICAgICAgICAgICAgICBpbnN0V2kuU2V0QW5nbGUob2xkQW5nbGUpOwogICAgICAgICAgICAgICAgaW5zdFdpLlNldEJib3hDaGFuZ2VkKCkKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcmV0CiAgICAgICAgfQogICAgICAgIERvKHJlbmRlcmVyLAogICAgICAgICAgICBzY2FsZSwgY2FudmFzSW5zdCkgewogICAgICAgICAgICBjb25zdCBjYW52YXNNYW5hZ2VyID0gY2FudmFzSW5zdC5HZXRSdW50aW1lKCkuR2V0Q2FudmFzTWFuYWdlcigpOwogICAgICAgICAgICBjb25zdCBsYXllciA9IGNhbnZhc0luc3QuR2V0V29ybGRJbmZvKCkuR2V0TGF5ZXIoKTsKICAgICAgICAgICAgY29uc3QgbGF5b3V0ID0gbGF5ZXIuR2V0TGF5b3V0KCk7CiAgICAgICAgICAgIGNvbnN0IHZpZXdwb3J0ID0gbGF5ZXIuR2V0Vmlld3BvcnQoKTsKICAgICAgICAgICAgY29uc3QgY2FudmFzQmJveCA9IGNhbnZhc0luc3QuR2V0V29ybGRJbmZvKCkuR2V0Qm91bmRpbmdCb3goKTsKICAgICAgICAgICAgY29uc3QgcmVuZGVyVGFyZ2V0ID0gY2FudmFzSW5zdC5fR2V0UmVuZGVyVGFyZ2V0KCk7CiAgICAgICAgICAgIGNvbnN0IGlzTXVsdGlzYW1wbG5nID0gY2FudmFzSW5zdC5HZXRNdWx0aXNhbXBsaW5nKCkgPj0gMjsKICAgICAgICAgICAgY29uc3QgaW5jbHVkZUZ4ID0gdGhpcy5faW5jbHVkZUZ4OwogICAgICAgICAgICBjb25zdCByZXN0b3JlTGF5b3V0VHJhbnNmb3JtID0gbGF5b3V0LlNhdmVUcmFuc2Zvcm0oKTsKICAgICAgICAgICAgbGF5b3V0LlJlc3RvcmVUcmFuc2Zvcm0odGhpcy5fbGF5b3V0VHJhbnNmb3JtKTsKICAgICAgICAgICAgY29uc3QgcmVzdG9yZUxheWVyVHJhbnNmb3JtcyA9CiAgICAgICAgICAgICAgICBuZXcgTWFwOwogICAgICAgICAgICBmb3IgKGNvbnN0IFtsYXllciwgdHJhbnNmb3JtXSBvZiB0aGlzLl9sYXllclRyYW5zZm9ybXMpIHsKICAgICAgICAgICAgICAgIHJlc3RvcmVMYXllclRyYW5zZm9ybXMuc2V0KGxheWVyLCBsYXllci5TYXZlVHJhbnNmb3JtKCkpOwogICAgICAgICAgICAgICAgbGF5ZXIuUmVzdG9yZVRyYW5zZm9ybSh0cmFuc2Zvcm0pCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FudmFzTWFuYWdlci5TZXRJc1Bhc3RpbmdUb0RyYXdpbmdDYW52YXModHJ1ZSk7CiAgICAgICAgICAgIGNvbnN0IHZpZXdPZmZYID0gKHZpZXdwb3J0LndpZHRoKCkgLSBjYW52YXNCYm94LndpZHRoKCkpIC8gLTI7CiAgICAgICAgICAgIGNvbnN0IHZpZXdPZmZZID0gKHZpZXdwb3J0LmhlaWdodCgpIC0gY2FudmFzQmJveC5oZWlnaHQoKSkgLyAtMjsKICAgICAgICAgICAgY29uc3QgW2NhbnZhc0RldmljZUxlZnQsIGNhbnZhc0RldmljZVRvcF0gPSBsYXllci5MYXllclRvRHJhd1N1cmZhY2UoY2FudmFzQmJveC5nZXRMZWZ0KCksIGNhbnZhc0Jib3guZ2V0VG9wKCkpOwogICAgICAgICAgICBjYW52YXNNYW5hZ2VyLlNldERldmljZVRyYW5zZm9ybU9mZnNldChjYW52YXNEZXZpY2VMZWZ0LCBjYW52YXNEZXZpY2VUb3ApOwogICAgICAgICAgICBjb25zdCBjYW52YXNPZmZYID0KICAgICAgICAgICAgICAgIGNhbnZhc0Jib3guZ2V0TGVmdCgpIC0gdmlld3BvcnQuZ2V0TGVmdCgpOwogICAgICAgICAgICBjb25zdCBjYW52YXNPZmZZID0gY2FudmFzQmJveC5nZXRUb3AoKSAtIHZpZXdwb3J0LmdldFRvcCgpOwogICAgICAgICAgICBjb25zdCBvZmZYID0gdmlld09mZlggKyBjYW52YXNPZmZYOwogICAgICAgICAgICBjb25zdCBvZmZZID0gdmlld09mZlkgKyBjYW52YXNPZmZZOwogICAgICAgICAgICBjb25zdCB2aWV3SCA9IHJlbmRlclRhcmdldC5HZXRIZWlnaHQoKTsKICAgICAgICAgICAgbGV0IGVmZmVjdGl2ZVNjYWxlID0gMTsKICAgICAgICAgICAgaWYgKGNhbnZhc0luc3QuSXNGaXhlZFJlc29sdXRpb25Nb2RlKCkpIGVmZmVjdGl2ZVNjYWxlID0gcmVuZGVyVGFyZ2V0LkdldFdpZHRoKCkgLyBNYXRoLmZsb29yKGNhbnZhc0Jib3gud2lkdGgoKSkgLyBsYXllci5HZXROb3JtYWxTY2FsZSgpOwogICAgICAgICAgICBlbHNlIGVmZmVjdGl2ZVNjYWxlID0gY2FudmFzTWFuYWdlci5HZXRSZW5kZXJTY2FsZSgpICogc2VsZi5kZXZpY2VQaXhlbFJhdGlvOwogICAgICAgICAgICBjb25zdCBlZmZlY3RpdmVWaWV3SCA9IHZpZXdIIC8gZWZmZWN0aXZlU2NhbGU7CiAgICAgICAgICAgIGNvbnN0IHB4T2ZmID0gLjUgLyBlZmZlY3RpdmVTY2FsZTsKICAgICAgICAgICAgcmVuZGVyZXIuU2V0UHJvamVjdGlvbk1hdHJpeChyZW5kZXJUYXJnZXQuR2V0UHJvamVjdGlvbk1hdHJpeCgpKTsKICAgICAgICAgICAgbGF5ZXIuX1NldFRyYW5zZm9ybShyZW5kZXJlciwgZmFsc2UsIG9mZlggKyBweE9mZiwgb2ZmWSArIHB4T2ZmLCBlZmZlY3RpdmVWaWV3SCk7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSB0aGlzLl9pbnN0YW5jZXMubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGluZm8gPSB0aGlzLl9pbnN0YW5jZXNbaV07CiAgICAgICAgICAgICAgICBjb25zdCBpbnN0ID0gaW5mb1swXTsKICAgICAgICAgICAgICAgIGNvbnN0IGluc3RTdGF0ZSA9IGluZm9bMV07CiAgICAgICAgICAgICAgICBpZiAoaW5zdC5Jc0Rlc3Ryb3llZCgpKSBjb250aW51ZTsKICAgICAgICAgICAgICAgIGNvbnN0IHdpID0gaW5zdC5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgICAgIGNvbnN0IG9sZFN0YXRlID0gaW5zdC5TYXZlVG9Kc29uKCJ2aXN1YWwtc3RhdGUiKTsKICAgICAgICAgICAgICAgIGluc3QuTG9hZEZyb21Kc29uKGluc3RTdGF0ZSwgInZpc3VhbC1zdGF0ZSIpOwogICAgICAgICAgICAgICAgd2kuR2V0Qm91bmRpbmdCb3goKTsKICAgICAgICAgICAgICAgIGlmIChpbmNsdWRlRnggJiYgd2kuSGFzQW55QWN0aXZlRWZmZWN0KCkgJiYgKCFpc011bHRpc2FtcGxuZyB8fCAhd2kuR2V0SW5zdGFuY2VFZmZlY3RMaXN0KCkuSGFzQW55QWN0aXZlQmFja2dyb3VuZEJsZW5kaW5nRWZmZWN0KCkpKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3B0cyA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgZHJhd0NvbnRlbnRIb29rOiAoZWZmZWN0Q2hhaW4sIHJlbmRlcmVyLCBkcmF3Q29udGVudCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGF5ZXIuX1NldFRyYW5zZm9ybShyZW5kZXJlcik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkcmF3Q29udGVudCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWZmZWN0Q2hhaW4uX1NldERldmljZVRyYW5zZm9ybShyZW5kZXJlcikKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgY29tcG9zaXRPZmZYOiBjYW52YXNEZXZpY2VMZWZ0LAogICAgICAgICAgICAgICAgICAgICAgICBjb21wb3NpdE9mZlk6IGNhbnZhc0RldmljZVRvcCwKICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlT3duUHJvamVjdGlvbjogdHJ1ZQogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgaW5zdC5fU2V0SXNEcmF3aW5nV2l0aEVmZmVjdHModHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGxheWVyLl9EcmF3SW5zdGFuY2VXaXRoRWZmZWN0cyhpbnN0LCB3aSwgcmVuZGVyZXIsIHJlbmRlclRhcmdldCwgb3B0cykpIGxheWVyLl9TZXRUcmFuc2Zvcm0ocmVuZGVyZXIsIGZhbHNlLCBvZmZYICsgcHhPZmYsIG9mZlkgKyBweE9mZiwgZWZmZWN0aXZlVmlld0gpOwogICAgICAgICAgICAgICAgICAgIGluc3QuX1NldElzRHJhd2luZ1dpdGhFZmZlY3RzKGZhbHNlKQogICAgICAgICAgICAgICAgfSBlbHNlIGxheWVyLl9EcmF3SW5zdGFuY2UoaW5zdCwgd2ksIHJlbmRlcmVyKTsKICAgICAgICAgICAgICAgIGluc3QuTG9hZEZyb21Kc29uKG9sZFN0YXRlLAogICAgICAgICAgICAgICAgICAgICJ2aXN1YWwtc3RhdGUiKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhbnZhc01hbmFnZXIuU2V0RGV2aWNlVHJhbnNmb3JtT2Zmc2V0KDAsIDApOwogICAgICAgICAgICBjYW52YXNNYW5hZ2VyLlNldElzUGFzdGluZ1RvRHJhd2luZ0NhbnZhcyhmYWxzZSk7CiAgICAgICAgICAgIGNhbnZhc0luc3QuX1NldFJlbmRlclRhcmdldERldmljZVRyYW5zZm9ybShyZW5kZXJlcik7CiAgICAgICAgICAgIGNhbnZhc0luc3QuX0FwcGx5Q3VycmVudERyYXdpbmdCbGVuZE1vZGUocmVuZGVyZXIpOwogICAgICAgICAgICBsYXlvdXQuUmVzdG9yZVRyYW5zZm9ybShyZXN0b3JlTGF5b3V0VHJhbnNmb3JtKTsKICAgICAgICAgICAgZm9yIChjb25zdCBbbGF5ZXIsIHRyYW5zZm9ybV0gb2YgcmVzdG9yZUxheWVyVHJhbnNmb3JtcykgbGF5ZXIuUmVzdG9yZVRyYW5zZm9ybSh0cmFuc2Zvcm0pOwogICAgICAgICAgICB0aGlzLl9yZXNvbHZlKCkKICAgICAgICB9CiAgICB9OwoKfQoKewogICAgJ3VzZSBzdHJpY3QnOyB7CiAgICAgICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgICAgIEMzLkJlaGF2aW9ycy5BbmNob3IgPSBjbGFzcyBBbmNob3JCZWhhdmlvciBleHRlbmRzIEMzLlNES0JlaGF2aW9yQmFzZSB7CiAgICAgICAgICAgIGNvbnN0cnVjdG9yKG9wdHMpIHsKICAgICAgICAgICAgICAgIHN1cGVyKG9wdHMpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgUmVsZWFzZSgpIHsKICAgICAgICAgICAgICAgIHN1cGVyLlJlbGVhc2UoKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSB7CiAgICAgICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgICAgIEMzLkJlaGF2aW9ycy5BbmNob3IuVHlwZSA9IGNsYXNzIEFuY2hvclR5cGUgZXh0ZW5kcyBDMy5TREtCZWhhdmlvclR5cGVCYXNlIHsKICAgICAgICAgICAgY29uc3RydWN0b3IoYmVoYXZpb3JUeXBlKSB7CiAgICAgICAgICAgICAgICBzdXBlcihiZWhhdmlvclR5cGUpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgUmVsZWFzZSgpIHsKICAgICAgICAgICAgICAgIHN1cGVyLlJlbGVhc2UoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIE9uQ3JlYXRlKCkge30KICAgICAgICB9CiAgICB9IHsKICAgICAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICAgICAgY29uc3QgQzNYID0gc2VsZi5DM1g7CiAgICAgICAgY29uc3QgSUJlaGF2aW9ySW5zdGFuY2UgPSBzZWxmLklCZWhhdmlvckluc3RhbmNlOwogICAgICAgIGNvbnN0IEFOQ0hPUl9MRUZUID0gMDsKICAgICAgICBjb25zdCBBTkNIT1JfVE9QID0gMTsKICAgICAgICBjb25zdCBBTkNIT1JfUklHSFQgPSAyOwogICAgICAgIGNvbnN0IEFOQ0hPUl9CT1RUT00gPSAzOwogICAgICAgIGNvbnN0IEVOQUJMRSA9IDQ7CiAgICAgICAgQzMuQmVoYXZpb3JzLkFuY2hvci5JbnN0YW5jZSA9IGNsYXNzIEFuY2hvckluc3RhbmNlIGV4dGVuZHMgQzMuU0RLQmVoYXZpb3JJbnN0YW5jZUJhc2UgewogICAgICAgICAgICBjb25zdHJ1Y3RvcihiZWhJbnN0LCBwcm9wZXJ0aWVzKSB7CiAgICAgICAgICAgICAgICBzdXBlcihiZWhJbnN0KTsKICAgICAgICAgICAgICAgIHRoaXMuX2FuY2hvckxlZnQgPSAyOwogICAgICAgICAgICAgICAgdGhpcy5fYW5jaG9yVG9wID0gMjsKICAgICAgICAgICAgICAgIHRoaXMuX2FuY2hvclJpZ2h0ID0gMDsKICAgICAgICAgICAgICAgIHRoaXMuX2FuY2hvckJvdHRvbSA9IDA7CiAgICAgICAgICAgICAgICB0aGlzLl9pc0VuYWJsZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgY29uc3QgYmJveCA9IHRoaXMuX2luc3QuR2V0V29ybGRJbmZvKCkuR2V0Qm91bmRpbmdCb3goKTsKICAgICAgICAgICAgICAgIHRoaXMuX3hMZWZ0ID0gYmJveC5nZXRMZWZ0KCk7CiAgICAgICAgICAgICAgICB0aGlzLl95VG9wID0KICAgICAgICAgICAgICAgICAgICBiYm94LmdldFRvcCgpOwogICAgICAgICAgICAgICAgdGhpcy5feFJpZ2h0ID0gdGhpcy5fcnVudGltZS5HZXRPcmlnaW5hbFZpZXdwb3J0V2lkdGgoKSAtIGJib3guZ2V0TGVmdCgpOwogICAgICAgICAgICAgICAgdGhpcy5feUJvdHRvbSA9IHRoaXMuX3J1bnRpbWUuR2V0T3JpZ2luYWxWaWV3cG9ydEhlaWdodCgpIC0gYmJveC5nZXRUb3AoKTsKICAgICAgICAgICAgICAgIHRoaXMuX3JEaWZmID0gdGhpcy5fcnVudGltZS5HZXRPcmlnaW5hbFZpZXdwb3J0V2lkdGgoKSAtIGJib3guZ2V0UmlnaHQoKTsKICAgICAgICAgICAgICAgIHRoaXMuX2JEaWZmID0gdGhpcy5fcnVudGltZS5HZXRPcmlnaW5hbFZpZXdwb3J0SGVpZ2h0KCkgLSBiYm94LmdldEJvdHRvbSgpOwogICAgICAgICAgICAgICAgaWYgKHByb3BlcnRpZXMpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9hbmNob3JMZWZ0ID0gcHJvcGVydGllc1tBTkNIT1JfTEVGVF07CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYW5jaG9yVG9wID0gcHJvcGVydGllc1tBTkNIT1JfVE9QXTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9hbmNob3JSaWdodCA9IHByb3BlcnRpZXNbQU5DSE9SX1JJR0hUXTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9hbmNob3JCb3R0b20gPSBwcm9wZXJ0aWVzW0FOQ0hPUl9CT1RUT01dOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2lzRW5hYmxlZCA9ICEhcHJvcGVydGllc1tFTkFCTEVdCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjb25zdCBydCA9CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcnVudGltZS5EaXNwYXRjaGVyKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9kaXNwb3NhYmxlcyA9IG5ldyBDMy5Db21wb3NpdGVEaXNwb3NhYmxlKEMzLkRpc3Bvc2FibGUuRnJvbShydCwgImxheW91dGNoYW5nZSIsICgpID0+IHRoaXMuX09uTGF5b3V0Q2hhbmdlKCkpKTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9pc0VuYWJsZWQpIHRoaXMuX1N0YXJ0VGlja2luZygpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgUmVsZWFzZSgpIHsKICAgICAgICAgICAgICAgIHN1cGVyLlJlbGVhc2UoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIFNhdmVUb0pzb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICJ4bCI6IHRoaXMuX3hMZWZ0LAogICAgICAgICAgICAgICAgICAgICJ5dCI6IHRoaXMuX3lUb3AsCiAgICAgICAgICAgICAgICAgICAgInhyIjogdGhpcy5feFJpZ2h0LAogICAgICAgICAgICAgICAgICAgICJ5YiI6IHRoaXMuX3lCb3R0b20sCiAgICAgICAgICAgICAgICAgICAgInJkIjogdGhpcy5fckRpZmYsCiAgICAgICAgICAgICAgICAgICAgImJkIjogdGhpcy5fYkRpZmYsCiAgICAgICAgICAgICAgICAgICAgImFsIjogdGhpcy5fYW5jaG9yTGVmdCwKICAgICAgICAgICAgICAgICAgICAiYXQiOiB0aGlzLl9hbmNob3JUb3AsCiAgICAgICAgICAgICAgICAgICAgImFyIjogdGhpcy5fYW5jaG9yUmlnaHQsCiAgICAgICAgICAgICAgICAgICAgImFiIjogdGhpcy5fYW5jaG9yQm90dG9tLAogICAgICAgICAgICAgICAgICAgICJlIjogdGhpcy5faXNFbmFibGVkCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgTG9hZEZyb21Kc29uKG8pIHsKICAgICAgICAgICAgICAgIHRoaXMuX3hMZWZ0ID0gb1sieGwiXTsKICAgICAgICAgICAgICAgIHRoaXMuX3lUb3AgPSBvWyJ5dCJdOwogICAgICAgICAgICAgICAgdGhpcy5feFJpZ2h0ID0KICAgICAgICAgICAgICAgICAgICBvWyJ4ciJdOwogICAgICAgICAgICAgICAgdGhpcy5feUJvdHRvbSA9IG9bInliIl07CiAgICAgICAgICAgICAgICB0aGlzLl9yRGlmZiA9IG9bInJkIl07CiAgICAgICAgICAgICAgICB0aGlzLl9iRGlmZiA9IG9bImJkIl07CiAgICAgICAgICAgICAgICB0aGlzLl9hbmNob3JMZWZ0ID0gb1siYWwiXTsKICAgICAgICAgICAgICAgIHRoaXMuX2FuY2hvclRvcCA9IG9bImF0Il07CiAgICAgICAgICAgICAgICB0aGlzLl9hbmNob3JSaWdodCA9IG9bImFyIl07CiAgICAgICAgICAgICAgICB0aGlzLl9hbmNob3JCb3R0b20gPSBvWyJhYiJdOwogICAgICAgICAgICAgICAgdGhpcy5faXNFbmFibGVkID0gb1siZSJdOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuX2lzRW5hYmxlZCkgdGhpcy5fU3RhcnRUaWNraW5nKCk7CiAgICAgICAgICAgICAgICBlbHNlIHRoaXMuX1N0b3BUaWNraW5nKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBfU2V0RW5hYmxlZChlKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5faXNFbmFibGVkICYmICFlKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5faXNFbmFibGVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fU3RvcFRpY2tpbmcoKQogICAgICAgICAgICAgICAgfSBlbHNlIGlmICghdGhpcy5faXNFbmFibGVkICYmIGUpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBiYm94ID0gdGhpcy5faW5zdC5HZXRXb3JsZEluZm8oKS5HZXRCb3VuZGluZ0JveCgpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3hMZWZ0ID0gYmJveC5nZXRMZWZ0KCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5feVRvcCA9IGJib3guZ2V0VG9wKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5feFJpZ2h0ID0gdGhpcy5fcnVudGltZS5HZXRPcmlnaW5hbFZpZXdwb3J0V2lkdGgoKSAtCiAgICAgICAgICAgICAgICAgICAgICAgIGJib3guZ2V0TGVmdCgpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3lCb3R0b20gPSB0aGlzLl9ydW50aW1lLkdldE9yaWdpbmFsVmlld3BvcnRIZWlnaHQoKSAtIGJib3guZ2V0VG9wKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fckRpZmYgPSB0aGlzLl9ydW50aW1lLkdldE9yaWdpbmFsVmlld3BvcnRXaWR0aCgpIC0gYmJveC5nZXRSaWdodCgpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2JEaWZmID0gdGhpcy5fcnVudGltZS5HZXRPcmlnaW5hbFZpZXdwb3J0SGVpZ2h0KCkgLSBiYm94LmdldEJvdHRvbSgpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2lzRW5hYmxlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fU3RhcnRUaWNraW5nKCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBfSXNFbmFibGVkKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2lzRW5hYmxlZAogICAgICAgICAgICB9CiAgICAgICAgICAgIF9VcGRhdGVQb3NpdGlvbigpIHsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5faXNFbmFibGVkKSByZXR1cm47CiAgICAgICAgICAgICAgICBjb25zdCB3aSA9IHRoaXMuX2luc3QuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgICAgICBjb25zdCB2aWV3cG9ydCA9IHdpLkdldExheWVyKCkuR2V0Vmlld3BvcnQoKTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9hbmNob3JMZWZ0ID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgbiA9IHZpZXdwb3J0LmdldExlZnQoKSArIHRoaXMuX3hMZWZ0IC0gd2kuR2V0Qm91bmRpbmdCb3goKS5nZXRMZWZ0KCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKG4gIT09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgd2kuT2Zmc2V0WChuKTsKICAgICAgICAgICAgICAgICAgICAgICAgd2kuU2V0QmJveENoYW5nZWQoKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5fYW5jaG9yTGVmdCA9PT0gMSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IG4gPSB2aWV3cG9ydC5nZXRSaWdodCgpIC0gdGhpcy5feFJpZ2h0IC0gd2kuR2V0Qm91bmRpbmdCb3goKS5nZXRMZWZ0KCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKG4gIT09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgd2kuT2Zmc2V0WChuKTsKICAgICAgICAgICAgICAgICAgICAgICAgd2kuU2V0QmJveENoYW5nZWQoKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh0aGlzLl9hbmNob3JUb3AgPT09IDApIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBuID0gdmlld3BvcnQuZ2V0VG9wKCkgKyB0aGlzLl95VG9wIC0gd2kuR2V0Qm91bmRpbmdCb3goKS5nZXRUb3AoKTsKICAgICAgICAgICAgICAgICAgICBpZiAobiAhPT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICB3aS5PZmZzZXRZKG4pOwogICAgICAgICAgICAgICAgICAgICAgICB3aS5TZXRCYm94Q2hhbmdlZCgpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLl9hbmNob3JUb3AgPT09IDEpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBuID0gdmlld3BvcnQuZ2V0Qm90dG9tKCkgLSB0aGlzLl95Qm90dG9tIC0gd2kuR2V0Qm91bmRpbmdCb3goKS5nZXRUb3AoKTsKICAgICAgICAgICAgICAgICAgICBpZiAobiAhPT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICB3aS5PZmZzZXRZKG4pOwogICAgICAgICAgICAgICAgICAgICAgICB3aS5TZXRCYm94Q2hhbmdlZCgpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHRoaXMuX2FuY2hvclJpZ2h0ID09PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgbiA9CiAgICAgICAgICAgICAgICAgICAgICAgIHZpZXdwb3J0LmdldFJpZ2h0KCkgLSB0aGlzLl9yRGlmZiAtIHdpLkdldEJvdW5kaW5nQm94KCkuZ2V0UmlnaHQoKTsKICAgICAgICAgICAgICAgICAgICBpZiAobiAhPT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICB3aS5PZmZzZXRYKHdpLkdldE9yaWdpblgoKSAqIG4pOwogICAgICAgICAgICAgICAgICAgICAgICB3aS5TZXRXaWR0aChNYXRoLm1heCh3aS5HZXRXaWR0aCgpICsgbiksIDApOwogICAgICAgICAgICAgICAgICAgICAgICB3aS5TZXRCYm94Q2hhbmdlZCgpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9yRGlmZiA9IHZpZXdwb3J0LmdldFJpZ2h0KCkgLSB3aS5HZXRCb3VuZGluZ0JveCgpLmdldFJpZ2h0KCkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fYW5jaG9yQm90dG9tID09PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgbiA9IHZpZXdwb3J0LmdldEJvdHRvbSgpIC0gdGhpcy5fYkRpZmYgLSB3aS5HZXRCb3VuZGluZ0JveCgpLmdldEJvdHRvbSgpOwogICAgICAgICAgICAgICAgICAgIGlmIChuICE9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpLk9mZnNldFkod2kuR2V0T3JpZ2luWSgpICogbik7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpLlNldEhlaWdodChNYXRoLm1heCh3aS5HZXRIZWlnaHQoKSArIG4sIDApKTsKICAgICAgICAgICAgICAgICAgICAgICAgd2kuU2V0QmJveENoYW5nZWQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fYkRpZmYgPSB2aWV3cG9ydC5nZXRCb3R0b20oKSAtIHdpLkdldEJvdW5kaW5nQm94KCkuZ2V0Qm90dG9tKCkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgVGljaygpIHsKICAgICAgICAgICAgICAgIHRoaXMuX1VwZGF0ZVBvc2l0aW9uKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBfT25MYXlvdXRDaGFuZ2UoKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9VcGRhdGVQb3NpdGlvbigpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgR2V0UHJvcGVydHlWYWx1ZUJ5SW5kZXgoaW5kZXgpIHsKICAgICAgICAgICAgICAgIHN3aXRjaCAoaW5kZXgpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlIEFOQ0hPUl9MRUZUOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fYW5jaG9yTGVmdDsKICAgICAgICAgICAgICAgICAgICBjYXNlIEFOQ0hPUl9UT1A6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9hbmNob3JUb3A7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBBTkNIT1JfUklHSFQ6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9hbmNob3JSaWdodDsKICAgICAgICAgICAgICAgICAgICBjYXNlIEFOQ0hPUl9CT1RUT006CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9hbmNob3JCb3R0b207CiAgICAgICAgICAgICAgICAgICAgY2FzZSBFTkFCTEU6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9pc0VuYWJsZWQKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBTZXRQcm9wZXJ0eVZhbHVlQnlJbmRleChpbmRleCwgdmFsdWUpIHsKICAgICAgICAgICAgICAgIHN3aXRjaCAoaW5kZXgpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlIEFOQ0hPUl9MRUZUOgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9hbmNob3JMZWZ0ID0gdmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgQU5DSE9SX1RPUDoKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fYW5jaG9yVG9wID0gdmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgQU5DSE9SX1JJR0hUOgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9hbmNob3JSaWdodCA9IHZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIEFOQ0hPUl9CT1RUT006CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2FuY2hvckJvdHRvbSA9IHZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIEVOQUJMRToKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5faXNFbmFibGVkID0gISF2YWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX2lzRW5hYmxlZCkgdGhpcy5fU3RhcnRUaWNraW5nKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgdGhpcy5fU3RvcFRpY2tpbmcoKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBHZXREZWJ1Z2dlclByb3BlcnRpZXMoKSB7CiAgICAgICAgICAgICAgICBjb25zdCBwcmVmaXggPSAiYmVoYXZpb3JzLmFuY2hvciI7CiAgICAgICAgICAgICAgICByZXR1cm4gW3sKICAgICAgICAgICAgICAgICAgICB0aXRsZTogIiQiICsgdGhpcy5HZXRCZWhhdmlvclR5cGUoKS5HZXROYW1lKCksCiAgICAgICAgICAgICAgICAgICAgcHJvcGVydGllczogW3sKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogcHJlZml4ICsgIi5wcm9wZXJ0aWVzLmVuYWJsZWQubmFtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLl9Jc0VuYWJsZWQoKSwKICAgICAgICAgICAgICAgICAgICAgICAgb25lZGl0OiB2ID0+IHRoaXMuX1NldEVuYWJsZWQodikKICAgICAgICAgICAgICAgICAgICB9XQogICAgICAgICAgICAgICAgfV0KICAgICAgICAgICAgfQogICAgICAgICAgICBHZXRTY3JpcHRJbnRlcmZhY2VDbGFzcygpIHsKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLklBbmNob3JCZWhhdmlvckluc3RhbmNlCiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIGNvbnN0IG1hcCA9IG5ldyBXZWFrTWFwOwogICAgICAgIHNlbGYuSUFuY2hvckJlaGF2aW9ySW5zdGFuY2UgPSBjbGFzcyBJQW5jaG9yQmVoYXZpb3JJbnN0YW5jZSBleHRlbmRzIElCZWhhdmlvckluc3RhbmNlIHsKICAgICAgICAgICAgY29uc3RydWN0b3IoKSB7CiAgICAgICAgICAgICAgICBzdXBlcigpOwogICAgICAgICAgICAgICAgbWFwLnNldCh0aGlzLCBJQmVoYXZpb3JJbnN0YW5jZS5fR2V0SW5pdEluc3QoKS5HZXRTZGtJbnN0YW5jZSgpKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGdldCBpc0VuYWJsZWQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbWFwLmdldCh0aGlzKS5fSXNFbmFibGVkKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBzZXQgaXNFbmFibGVkKGUpIHsKICAgICAgICAgICAgICAgIG1hcC5nZXQodGhpcykuX1NldEVuYWJsZWQoZSkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gewogICAgICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgICAgICBDMy5CZWhhdmlvcnMuQW5jaG9yLkNuZHMgPSB7CiAgICAgICAgICAgIElzRW5hYmxlZCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9Jc0VuYWJsZWQoKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSB7CiAgICAgICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgICAgIEMzLkJlaGF2aW9ycy5BbmNob3IuQWN0cyA9IHsKICAgICAgICAgICAgU2V0RW5hYmxlZChlKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9TZXRFbmFibGVkKGUgIT09IDApCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IHsKICAgICAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICAgICAgQzMuQmVoYXZpb3JzLkFuY2hvci5FeHBzID0ge30KICAgIH07Cgp9Cgp7CiAgICAndXNlIHN0cmljdCc7IHsKICAgICAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICAgICAgY29uc3QgQzNYID0gc2VsZi5DM1g7CiAgICAgICAgbGV0IHRlbXBWZWMyYSA9IG51bGw7CiAgICAgICAgbGV0IHRlbXBWZWMyYiA9IG51bGw7CiAgICAgICAgbGV0IHZlYzJSZWN5Y2xlQ2FjaGUgPSBbXTsKICAgICAgICBsZXQgQm94MkQgPSBudWxsOwogICAgICAgIGxldCBwaHlzaWNzQmVoYXZpb3IgPSBudWxsOwogICAgICAgIGNvbnN0IFBIWVNJQ1NfQ09MTElTSU9OU19LRVkgPSAiUGh5c2ljc19EaXNhYmxlZENvbGxpc2lvbnMiOwoKICAgICAgICBmdW5jdGlvbiBTZXRPYmplY3RUeXBlQ29sbGlzaW9uc0VuYWJsZWQodHlwZUEsIHR5cGVCLCBzdGF0ZSkgewogICAgICAgICAgICBjb25zdCBzYXZlZEEgPSB0eXBlQS5HZXRTYXZlZERhdGFNYXAoKTsKICAgICAgICAgICAgY29uc3Qgc2F2ZWRCID0gdHlwZUIuR2V0U2F2ZWREYXRhTWFwKCk7CiAgICAgICAgICAgIGlmIChzdGF0ZSkgewogICAgICAgICAgICAgICAgY29uc3Qgc2V0QSA9IHNhdmVkQS5nZXQoUEhZU0lDU19DT0xMSVNJT05TX0tFWSk7CiAgICAgICAgICAgICAgICBpZiAoc2V0QSkgc2V0QS5kZWxldGUodHlwZUIuR2V0U0lEKCkpOwogICAgICAgICAgICAgICAgY29uc3Qgc2V0QiA9IHNhdmVkQi5nZXQoUEhZU0lDU19DT0xMSVNJT05TX0tFWSk7CiAgICAgICAgICAgICAgICBpZiAoc2V0Qikgc2V0Qi5kZWxldGUodHlwZUEuR2V0U0lEKCkpCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBsZXQgc2V0QSA9CiAgICAgICAgICAgICAgICAgICAgc2F2ZWRBLmdldChQSFlTSUNTX0NPTExJU0lPTlNfS0VZKTsKICAgICAgICAgICAgICAgIGlmICghc2V0QSkgewogICAgICAgICAgICAgICAgICAgIHNldEEgPSBuZXcgU2V0OwogICAgICAgICAgICAgICAgICAgIHNhdmVkQS5zZXQoUEhZU0lDU19DT0xMSVNJT05TX0tFWSwgc2V0QSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGxldCBzZXRCID0gc2F2ZWRCLmdldChQSFlTSUNTX0NPTExJU0lPTlNfS0VZKTsKICAgICAgICAgICAgICAgIGlmICghc2V0QikgewogICAgICAgICAgICAgICAgICAgIHNldEIgPSBuZXcgU2V0OwogICAgICAgICAgICAgICAgICAgIHNhdmVkQi5zZXQoUEhZU0lDU19DT0xMSVNJT05TX0tFWSwgc2V0QikKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHNldEEuYWRkKHR5cGVCLkdldFNJRCgpKTsKICAgICAgICAgICAgICAgIHNldEIuYWRkKHR5cGVBLkdldFNJRCgpKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIEMzLkJlaGF2aW9ycy5QaHlzaWNzID0gY2xhc3MgUGh5c2ljc0JlaGF2aW9yIGV4dGVuZHMgQzMuU0RLQmVoYXZpb3JCYXNlIHsKICAgICAgICAgICAgY29uc3RydWN0b3Iob3B0cykgewogICAgICAgICAgICAgICAgb3B0cy5zY3JpcHRJbnRlcmZhY2VDbGFzcyA9IHNlbGYuSVBoeXNpY3NCZWhhdmlvcjsKICAgICAgICAgICAgICAgIHN1cGVyKG9wdHMpOwogICAgICAgICAgICAgICAgdGhpcy5fd29ybGQgPSBudWxsOwogICAgICAgICAgICAgICAgdGhpcy5fd29ybGRHID0gMTA7CiAgICAgICAgICAgICAgICB0aGlzLl93b3JsZFNjYWxlID0gLjAyOwogICAgICAgICAgICAgICAgdGhpcy5fd29ybGRNYW5pZm9sZCA9IG51bGw7CiAgICAgICAgICAgICAgICB0aGlzLl9sYXN0VXBkYXRlVGljayA9IC0xOwogICAgICAgICAgICAgICAgdGhpcy5fc3RlcHBpbmdNb2RlID0gMTsKICAgICAgICAgICAgICAgIHRoaXMuX3ZlbG9jaXR5SXRlcmF0aW9ucyA9IDg7CiAgICAgICAgICAgICAgICB0aGlzLl9wb3NpdGlvbkl0ZXJhdGlvbnMgPSAzOwogICAgICAgICAgICAgICAgdGhpcy5fYWxsQ29sbGlzaW9uc0VuYWJsZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgdGhpcy5fcnVudGltZS5BZGRMb2FkUHJvbWlzZSh0aGlzLl9Mb2FkQm94MkRXYXNtKCkpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgYXN5bmMgX0xvYWRCb3gyRFdhc20oKSB7CiAgICAgICAgICAgICAgICBjb25zdCBib3gyZFdhc21VcmwgPSBhd2FpdCB0aGlzLl9ydW50aW1lLkdldEFzc2V0TWFuYWdlcigpLkdldFByb2plY3RGaWxlVXJsKCJib3gyZC53YXNtIik7CiAgICAgICAgICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHsKICAgICAgICAgICAgICAgICAgICBzZWxmWyJCb3gyRFdhc21Nb2R1bGUiXSh7CiAgICAgICAgICAgICAgICAgICAgICAgICJ3YXNtQmluYXJ5RmlsZSI6IGJveDJkV2FzbVVybAogICAgICAgICAgICAgICAgICAgIH0pLnRoZW4oYm94MmQgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBCb3gyRCA9IGJveDJkOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9Jbml0Qm94MkRXb3JsZCgpOwogICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCkKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfQogICAgICAgICAgICBfSW5pdEJveDJEV29ybGQoKSB7CiAgICAgICAgICAgICAgICBjb25zdCBjb2xsaXNpb25FbmdpbmUgPSB0aGlzLl9ydW50aW1lLkdldENvbGxpc2lvbkVuZ2luZSgpOwogICAgICAgICAgICAgICAgdGVtcFZlYzJhID0KICAgICAgICAgICAgICAgICAgICBDMy5CZWhhdmlvcnMuUGh5c2ljcy5HZXRWZWMyKDAsIDApOwogICAgICAgICAgICAgICAgdGVtcFZlYzJiID0gQzMuQmVoYXZpb3JzLlBoeXNpY3MuR2V0VmVjMigwLCAwKTsKICAgICAgICAgICAgICAgIHRoaXMuX3dvcmxkID0gbmV3IEJveDJEWyJiMldvcmxkIl0oQzMuQmVoYXZpb3JzLlBoeXNpY3MuR2V0VGVtcFZlYzJBKDAsIHRoaXMuX3dvcmxkRyksIHRydWUpOwogICAgICAgICAgICAgICAgY29uc3QgbGlzdGVuZXIgPSBuZXcgQm94MkRbIkpTQ29udGFjdExpc3RlbmVyIl07CiAgICAgICAgICAgICAgICBsaXN0ZW5lclsiQmVnaW5Db250YWN0Il0gPSBjb250YWN0UHRyID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBjb250YWN0ID0gQm94MkRbIndyYXBQb2ludGVyIl0oY29udGFjdFB0ciwgQm94MkRbImIyQ29udGFjdCJdKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBiZWhBID0gQzMuQmVoYXZpb3JzLlBoeXNpY3MuSW5zdGFuY2UuTG9va3VwQmVoSW5zdEZyb21Cb2R5KGNvbnRhY3RbIkdldEZpeHR1cmVBIl0oKVsiR2V0Qm9keSJdKCkpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGJlaEIgPSBDMy5CZWhhdmlvcnMuUGh5c2ljcy5JbnN0YW5jZS5Mb29rdXBCZWhJbnN0RnJvbUJvZHkoY29udGFjdFsiR2V0Rml4dHVyZUIiXSgpWyJHZXRCb2R5Il0oKSk7CiAgICAgICAgICAgICAgICAgICAgY29sbGlzaW9uRW5naW5lLlJlZ2lzdGVyQ29sbGlzaW9uKGJlaEEuR2V0T2JqZWN0SW5zdGFuY2UoKSwgYmVoQi5HZXRPYmplY3RJbnN0YW5jZSgpKQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIGxpc3RlbmVyWyJFbmRDb250YWN0Il0gPSAoKSA9PiB7fTsKICAgICAgICAgICAgICAgIGxpc3RlbmVyWyJQcmVTb2x2ZSJdID0gKCkgPT4ge307CiAgICAgICAgICAgICAgICBsaXN0ZW5lclsiUG9zdFNvbHZlIl0gPSAoKSA9PiB7fTsKICAgICAgICAgICAgICAgIHRoaXMuX3dvcmxkWyJTZXRDb250YWN0TGlzdGVuZXIiXShsaXN0ZW5lcik7CiAgICAgICAgICAgICAgICBjb25zdCBmaWx0ZXIgPSBuZXcgQm94MkRbIkpTQ29udGFjdEZpbHRlciJdOwogICAgICAgICAgICAgICAgZmlsdGVyWyJTaG91bGRDb2xsaWRlIl0gPSAoZml4QVB0ciwgZml4QlB0cikgPT4gewogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9hbGxDb2xsaXNpb25zRW5hYmxlZCkgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZml4dHVyZUEgPSBCb3gyRFsid3JhcFBvaW50ZXIiXShmaXhBUHRyLCBCb3gyRFsiYjJGaXh0dXJlIl0pOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGZpeHR1cmVCID0gQm94MkRbIndyYXBQb2ludGVyIl0oZml4QlB0ciwgQm94MkRbImIyRml4dHVyZSJdKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBiZWhBID0gQzMuQmVoYXZpb3JzLlBoeXNpY3MuSW5zdGFuY2UuTG9va3VwQmVoSW5zdEZyb21Cb2R5KGZpeHR1cmVBWyJHZXRCb2R5Il0oKSk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYmVoQiA9IEMzLkJlaGF2aW9ycy5QaHlzaWNzLkluc3RhbmNlLkxvb2t1cEJlaEluc3RGcm9tQm9keShmaXh0dXJlQlsiR2V0Qm9keSJdKCkpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHR5cGVBID0gYmVoQS5HZXRPYmplY3RJbnN0YW5jZSgpLkdldE9iamVjdENsYXNzKCk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdHlwZUIgPSBiZWhCLkdldE9iamVjdEluc3RhbmNlKCkuR2V0T2JqZWN0Q2xhc3MoKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBzaWRBID0gdHlwZUEuR2V0U0lEKCk7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2lkQiA9IHR5cGVCLkdldFNJRCgpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNldEEgPSB0eXBlQS5HZXRTYXZlZERhdGFNYXAoKS5nZXQoUEhZU0lDU19DT0xMSVNJT05TX0tFWSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHNldEEgJiYgc2V0QS5oYXMoc2lkQikpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBzZXRCID0gdHlwZUIuR2V0U2F2ZWREYXRhTWFwKCkuZ2V0KFBIWVNJQ1NfQ09MTElTSU9OU19LRVkpOwogICAgICAgICAgICAgICAgICAgIGlmIChzZXRCICYmIHNldEIuaGFzKHNpZEEpKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB0aGlzLl93b3JsZFsiU2V0Q29udGFjdEZpbHRlciJdKGZpbHRlcik7CiAgICAgICAgICAgICAgICB0aGlzLl93b3JsZE1hbmlmb2xkID0KICAgICAgICAgICAgICAgICAgICBuZXcgQm94MkRbImIyV29ybGRNYW5pZm9sZCJdCiAgICAgICAgICAgIH0KICAgICAgICAgICAgUmVsZWFzZSgpIHsKICAgICAgICAgICAgICAgIHN1cGVyLlJlbGVhc2UoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIEdldEJveDJEKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIEJveDJECiAgICAgICAgICAgIH0KICAgICAgICAgICAgR2V0V29ybGQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fd29ybGQKICAgICAgICAgICAgfQogICAgICAgICAgICBHZXRXb3JsZFNjYWxlKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3dvcmxkU2NhbGUKICAgICAgICAgICAgfQogICAgICAgICAgICBHZXRTdGVwcGluZ01vZGUoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fc3RlcHBpbmdNb2RlCiAgICAgICAgICAgIH0KICAgICAgICAgICAgU2V0U3RlcHBpbmdNb2RlKG0pIHsKICAgICAgICAgICAgICAgIHRoaXMuX3N0ZXBwaW5nTW9kZSA9IG0KICAgICAgICAgICAgfQogICAgICAgICAgICBTZXRMYXN0VXBkYXRlVGljayh0KSB7CiAgICAgICAgICAgICAgICB0aGlzLl9sYXN0VXBkYXRlVGljayA9IHQKICAgICAgICAgICAgfQogICAgICAgICAgICBHZXRMYXN0VXBkYXRlVGljaygpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9sYXN0VXBkYXRlVGljawogICAgICAgICAgICB9CiAgICAgICAgICAgIFNldFZlbG9jaXR5SXRlcmF0aW9ucyh2KSB7CiAgICAgICAgICAgICAgICB0aGlzLl92ZWxvY2l0eUl0ZXJhdGlvbnMgPSBNYXRoLm1heCh2LCAxKQogICAgICAgICAgICB9CiAgICAgICAgICAgIEdldFZlbG9jaXR5SXRlcmF0aW9ucygpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl92ZWxvY2l0eUl0ZXJhdGlvbnMKICAgICAgICAgICAgfQogICAgICAgICAgICBTZXRQb3NpdGlvbkl0ZXJhdGlvbnMocCkgewogICAgICAgICAgICAgICAgdGhpcy5fcG9zaXRpb25JdGVyYXRpb25zID0gTWF0aC5tYXgocCwKICAgICAgICAgICAgICAgICAgICAxKQogICAgICAgICAgICB9CiAgICAgICAgICAgIEdldFBvc2l0aW9uSXRlcmF0aW9ucygpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9wb3NpdGlvbkl0ZXJhdGlvbnMKICAgICAgICAgICAgfQogICAgICAgICAgICBTZXRJdGVyYXRpb25zKHYsIHApIHsKICAgICAgICAgICAgICAgIHRoaXMuU2V0VmVsb2NpdHlJdGVyYXRpb25zKHYpOwogICAgICAgICAgICAgICAgdGhpcy5TZXRQb3NpdGlvbkl0ZXJhdGlvbnMocCkKICAgICAgICAgICAgfQogICAgICAgICAgICBHZXRHcmF2aXR5KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3dvcmxkRwogICAgICAgICAgICB9CiAgICAgICAgICAgIFNldEdyYXZpdHkoZykgewogICAgICAgICAgICAgICAgaWYgKGcgPT09IHRoaXMuX3dvcmxkRykgcmV0dXJuOwogICAgICAgICAgICAgICAgdGhpcy5fd29ybGRbIlNldEdyYXZpdHkiXShDMy5CZWhhdmlvcnMuUGh5c2ljcy5HZXRUZW1wVmVjMkEoMCwgZykpOwogICAgICAgICAgICAgICAgdGhpcy5fd29ybGRHID0gZzsKICAgICAgICAgICAgICAgIHRoaXMuX1dha2VVcEFsbFBoeXNpY3NCb2RpZXMoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9XYWtlVXBBbGxQaHlzaWNzQm9kaWVzKCkgewogICAgICAgICAgICAgICAgZm9yIChjb25zdCBpbnN0IG9mIHRoaXMuR2V0SW5zdGFuY2VzKCkpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBiZWhJbnN0ID0gQzMuQmVoYXZpb3JzLlBoeXNpY3MuSW5zdGFuY2UuTG9va3VwQmVoSW5zdEZyb21JbnN0KGluc3QpOwogICAgICAgICAgICAgICAgICAgIGlmICghYmVoSW5zdCkgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYm9keSA9IGJlaEluc3QuR2V0Qm9keSgpOwogICAgICAgICAgICAgICAgICAgIGlmICghYm9keSkgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgYm9keVsiU2V0QXdha2UiXSh0cnVlKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIERpc2FibGVTaG91bGRDb2xsaWRlRmFzdFBhdGgoKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9hbGxDb2xsaXNpb25zRW5hYmxlZCA9IGZhbHNlCiAgICAgICAgICAgIH0KICAgICAgICAgICAgU2V0Q29sbGlzaW9uc0VuYWJsZWQodHlwZUEsIHR5cGVCLCBzdGF0ZSkgewogICAgICAgICAgICAgICAgc3RhdGUgPSAhIXN0YXRlOwogICAgICAgICAgICAgICAgaWYgKCF0eXBlQSB8fCAhdHlwZUIpIHJldHVybjsKICAgICAgICAgICAgICAgIGlmICh0eXBlQi5Jc0ZhbWlseSgpKQogICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgbWVtYmVyIG9mIHR5cGVCLkdldEZhbWlseU1lbWJlcnMoKSkgU2V0T2JqZWN0VHlwZUNvbGxpc2lvbnNFbmFibGVkKHR5cGVBLCBtZW1iZXIsIHN0YXRlKTsKICAgICAgICAgICAgICAgIGVsc2UgU2V0T2JqZWN0VHlwZUNvbGxpc2lvbnNFbmFibGVkKHR5cGVBLCB0eXBlQiwgc3RhdGUpOwogICAgICAgICAgICAgICAgdGhpcy5EaXNhYmxlU2hvdWxkQ29sbGlkZUZhc3RQYXRoKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBHZXRXb3JsZE1hbmlmb2xkKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3dvcmxkTWFuaWZvbGQKICAgICAgICAgICAgfQogICAgICAgICAgICBzdGF0aWMgR2V0UGh5c2ljc0NvbGxpc2lvbktleSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBQSFlTSUNTX0NPTExJU0lPTlNfS0VZCiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3RhdGljIEdldFZlYzIoeCwKICAgICAgICAgICAgICAgIHkpIHsKICAgICAgICAgICAgICAgIGlmICh2ZWMyUmVjeWNsZUNhY2hlLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJldCA9IHZlYzJSZWN5Y2xlQ2FjaGUucG9wKCk7CiAgICAgICAgICAgICAgICAgICAgcmV0WyJzZXRfeCJdKHgpOwogICAgICAgICAgICAgICAgICAgIHJldFsic2V0X3kiXSh5KTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGIyVmVjMiA9IEJveDJEWyJiMlZlYzIiXTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IGIyVmVjMih4LCB5KQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHN0YXRpYyBGcmVlVmVjMih2KSB7CiAgICAgICAgICAgICAgICB2ZWMyUmVjeWNsZUNhY2hlLnB1c2godikKICAgICAgICAgICAgfQogICAgICAgICAgICBzdGF0aWMgR2V0VGVtcFZlYzJBKHgsIHkpIHsKICAgICAgICAgICAgICAgIHRlbXBWZWMyYVsic2V0X3giXSh4KTsKICAgICAgICAgICAgICAgIHRlbXBWZWMyYVsic2V0X3kiXSh5KTsKICAgICAgICAgICAgICAgIHJldHVybiB0ZW1wVmVjMmEKICAgICAgICAgICAgfQogICAgICAgICAgICBzdGF0aWMgR2V0VGVtcFZlYzJCKHgsIHkpIHsKICAgICAgICAgICAgICAgIHRlbXBWZWMyYlsic2V0X3giXSh4KTsKICAgICAgICAgICAgICAgIHRlbXBWZWMyYlsic2V0X3kiXSh5KTsKICAgICAgICAgICAgICAgIHJldHVybiB0ZW1wVmVjMmIKICAgICAgICAgICAgfQogICAgICAgICAgICBzdGF0aWMgQ3JlYXRlUG9seWdvblNoYXBlKHZlcnRpY2VzKSB7CiAgICAgICAgICAgICAgICBjb25zdCBiMlBvbHlnb25TaGFwZSA9IEJveDJEWyJiMlBvbHlnb25TaGFwZSJdOwogICAgICAgICAgICAgICAgY29uc3Qgc2hhcGUgPSBuZXcgYjJQb2x5Z29uU2hhcGU7CiAgICAgICAgICAgICAgICBjb25zdCBidWZmZXIgPQogICAgICAgICAgICAgICAgICAgIEJveDJEWyJfbWFsbG9jIl0odmVydGljZXMubGVuZ3RoICogOCk7CiAgICAgICAgICAgICAgICBsZXQgb2Zmc2V0ID0gMDsKICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmVydGljZXMubGVuZ3RoOyArK2kpIHsKICAgICAgICAgICAgICAgICAgICBCb3gyRFsiSEVBUEYzMiJdW2J1ZmZlciArIG9mZnNldCA+PiAyXSA9IHZlcnRpY2VzW2ldWyJnZXRfeCJdKCk7CiAgICAgICAgICAgICAgICAgICAgQm94MkRbIkhFQVBGMzIiXVtidWZmZXIgKyAob2Zmc2V0ICsgNCkgPj4gMl0gPSB2ZXJ0aWNlc1tpXVsiZ2V0X3kiXSgpOwogICAgICAgICAgICAgICAgICAgIG9mZnNldCArPSA4CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjb25zdCBwdHJfd3JhcHBlZCA9IEJveDJEWyJ3cmFwUG9pbnRlciJdKGJ1ZmZlciwgQm94MkRbImIyVmVjMiJdKTsKICAgICAgICAgICAgICAgIHNoYXBlWyJTZXQiXShwdHJfd3JhcHBlZCwgdmVydGljZXMubGVuZ3RoKTsKICAgICAgICAgICAgICAgIEJveDJEWyJfZnJlZSJdKGJ1ZmZlcik7CiAgICAgICAgICAgICAgICByZXR1cm4gc2hhcGUKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgY29uc3QgU1RFUFBJTkdfTU9ERVMgPSBbImZpeGVkIiwgInZhcmlhYmxlIl07CiAgICAgICAgc2VsZi5JUGh5c2ljc0JlaGF2aW9yID0gY2xhc3MgSVBoeXNpY3NCZWhhdmlvciBleHRlbmRzIHNlbGYuSUJlaGF2aW9yIHsKICAgICAgICAgICAgY29uc3RydWN0b3IoYmVoYXZpb3IpIHsKICAgICAgICAgICAgICAgIHN1cGVyKGJlaGF2aW9yKTsKICAgICAgICAgICAgICAgIHBoeXNpY3NCZWhhdmlvciA9IGJlaGF2aW9yCiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2V0IHdvcmxkR3Jhdml0eShnKSB7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcihnKTsKICAgICAgICAgICAgICAgIHBoeXNpY3NCZWhhdmlvci5TZXRHcmF2aXR5KGcpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZ2V0IHdvcmxkR3Jhdml0eSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBwaHlzaWNzQmVoYXZpb3IuR2V0R3Jhdml0eSgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2V0IHN0ZXBwaW5nTW9kZShzKSB7CiAgICAgICAgICAgICAgICBjb25zdCBpID0gU1RFUFBJTkdfTU9ERVMuaW5kZXhPZihzKTsKICAgICAgICAgICAgICAgIGlmIChpIDwgMCkgdGhyb3cgbmV3IEVycm9yKCJpbnZhbGlkIHN0ZXBwaW5nIG1vZGUiKTsKICAgICAgICAgICAgICAgIHBoeXNpY3NCZWhhdmlvci5TZXRTdGVwcGluZ01vZGUoU1RFUFBJTkdfTU9ERVNbaV0pCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZ2V0IHN0ZXBwaW5nTW9kZSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBTVEVQUElOR19NT0RFU1twaHlzaWNzQmVoYXZpb3IuR2V0U3RlcHBpbmdNb2RlKCldCiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2V0IHZlbG9jaXR5SXRlcmF0aW9ucyh2KSB7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcih2KTsKICAgICAgICAgICAgICAgIHBoeXNpY3NCZWhhdmlvci5TZXRWZWxvY2l0eUl0ZXJhdGlvbnModikKICAgICAgICAgICAgfQogICAgICAgICAgICBnZXQgdmVsb2NpdHlJdGVyYXRpb25zKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHBoeXNpY3NCZWhhdmlvci5HZXRWZWxvY2l0eUl0ZXJhdGlvbnMoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHNldCBwb3NpdGlvbkl0ZXJhdGlvbnMocCkgewogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVGaW5pdGVOdW1iZXIocCk7CiAgICAgICAgICAgICAgICBwaHlzaWNzQmVoYXZpb3IuU2V0UG9zaXRpb25JdGVyYXRpb25zKHApCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZ2V0IHBvc2l0aW9uSXRlcmF0aW9ucygpIHsKICAgICAgICAgICAgICAgIHJldHVybiBwaHlzaWNzQmVoYXZpb3IuR2V0UG9zaXRpb25JdGVyYXRpb25zKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBzZXRDb2xsaXNpb25zRW5hYmxlZChpT2JqZWN0Q2xhc3NBLCBpT2JqZWN0Q2xhc3NCLCBzdGF0ZSkgewogICAgICAgICAgICAgICAgY29uc3QgcnVudGltZSA9IHBoeXNpY3NCZWhhdmlvci5HZXRSdW50aW1lKCk7CiAgICAgICAgICAgICAgICBjb25zdCBvYmplY3RDbGFzc0EgPSBydW50aW1lLl9VbndyYXBJT2JqZWN0Q2xhc3MoaU9iamVjdENsYXNzQSk7CiAgICAgICAgICAgICAgICBjb25zdCBvYmplY3RDbGFzc0IgPSBydW50aW1lLl9VbndyYXBJT2JqZWN0Q2xhc3MoaU9iamVjdENsYXNzQik7CiAgICAgICAgICAgICAgICBzdGF0ZSA9ICEhc3RhdGU7CiAgICAgICAgICAgICAgICBwaHlzaWNzQmVoYXZpb3IuU2V0Q29sbGlzaW9uc0VuYWJsZWQob2JqZWN0Q2xhc3NBLCBvYmplY3RDbGFzc0IsIHN0YXRlKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSB7CiAgICAgICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgICAgIEMzLkJlaGF2aW9ycy5QaHlzaWNzLlR5cGUgPSBjbGFzcyBQaHlzaWNzVHlwZSBleHRlbmRzIEMzLlNES0JlaGF2aW9yVHlwZUJhc2UgewogICAgICAgICAgICBjb25zdHJ1Y3RvcihiZWhhdmlvclR5cGUpIHsKICAgICAgICAgICAgICAgIHN1cGVyKGJlaGF2aW9yVHlwZSkKICAgICAgICAgICAgfQogICAgICAgICAgICBSZWxlYXNlKCkgewogICAgICAgICAgICAgICAgc3VwZXIuUmVsZWFzZSgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgT25DcmVhdGUoKSB7fQogICAgICAgIH0KICAgIH0gewogICAgICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgICAgICBjb25zdCBDM1ggPSBzZWxmLkMzWDsKICAgICAgICBjb25zdCBJQmVoYXZpb3JJbnN0YW5jZSA9IHNlbGYuSUJlaGF2aW9ySW5zdGFuY2U7CiAgICAgICAgY29uc3QgYXNzZXJ0ID0gc2VsZi5hc3NlcnQ7CiAgICAgICAgY29uc3QgSU1NT1ZBQkxFID0gMDsKICAgICAgICBjb25zdCBDT0xMSVNJT05fTUFTSyA9IDE7CiAgICAgICAgY29uc3QgUFJFVkVOVF9ST1RBVElPTiA9IDI7CiAgICAgICAgY29uc3QgREVOU0lUWSA9IDM7CiAgICAgICAgY29uc3QgRlJJQ1RJT04gPSA0OwogICAgICAgIGNvbnN0IEVMQVNUSUNJVFkgPSA1OwogICAgICAgIGNvbnN0IExJTkVBUl9EQU1QSU5HID0gNjsKICAgICAgICBjb25zdCBBTkdVTEFSX0RBTVBJTkcgPSA3OwogICAgICAgIGNvbnN0IEJVTExFVCA9IDg7CiAgICAgICAgY29uc3QgRU5BQkxFID0gOTsKICAgICAgICBjb25zdCBib2R5MmJlaCA9IG5ldyBXZWFrTWFwOwogICAgICAgIGNvbnN0IGluc3QyYmVoID0gbmV3IFdlYWtNYXA7CiAgICAgICAgY29uc3QgdGlsZUNvbnZleFBvbHlDYWNoZSA9IG5ldyBXZWFrTWFwOwogICAgICAgIGNvbnN0IFRJTEVfRkxJUFBFRF9IT1JJWk9OVEFMID0gLTIxNDc0ODM2NDg7CiAgICAgICAgY29uc3QgVElMRV9GTElQUEVEX1ZFUlRJQ0FMID0gMTA3Mzc0MTgyNDsKICAgICAgICBjb25zdCBUSUxFX0ZMSVBQRURfRElBR09OQUwgPQogICAgICAgICAgICA1MzY4NzA5MTI7CiAgICAgICAgY29uc3QgVElMRV9GTEFHU19NQVNLID0gMzc1ODA5NjM4NDsKICAgICAgICBjb25zdCBUSUxFX0lEX01BU0sgPSA1MzY4NzA5MTE7CiAgICAgICAgY29uc3QgR2V0VGVtcFZlYzJBID0gQzMuQmVoYXZpb3JzLlBoeXNpY3MuR2V0VGVtcFZlYzJBOwogICAgICAgIGNvbnN0IEdldFRlbXBWZWMyQiA9IEMzLkJlaGF2aW9ycy5QaHlzaWNzLkdldFRlbXBWZWMyQjsKICAgICAgICBjb25zdCB0ZW1wUmVjdCA9IEMzLk5ldyhDMy5SZWN0KTsKICAgICAgICBjb25zdCB0ZW1wUXVhZCA9IEMzLk5ldyhDMy5RdWFkKTsKICAgICAgICBDMy5CZWhhdmlvcnMuUGh5c2ljcy5JbnN0YW5jZSA9IGNsYXNzIFBoeXNpY3NJbnN0YW5jZSBleHRlbmRzIEMzLlNES0JlaGF2aW9ySW5zdGFuY2VCYXNlIHsKICAgICAgICAgICAgY29uc3RydWN0b3IoYmVoSW5zdCwgcHJvcGVydGllcykgewogICAgICAgICAgICAgICAgc3VwZXIoYmVoSW5zdCk7CiAgICAgICAgICAgICAgICBjb25zdCBiZWhhdmlvciA9IHRoaXMuR2V0QmVoYXZpb3IoKTsKICAgICAgICAgICAgICAgIGNvbnN0IHdpID0gdGhpcy5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgICAgIHRoaXMuX2JveDJkID0gYmVoYXZpb3IuR2V0Qm94MkQoKTsKICAgICAgICAgICAgICAgIHRoaXMuX3dvcmxkID0gYmVoYXZpb3IuR2V0V29ybGQoKTsKICAgICAgICAgICAgICAgIHRoaXMuX3dvcmxkU2NhbGUgPSBiZWhhdmlvci5HZXRXb3JsZFNjYWxlKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9pc0ltbW92YWJsZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgdGhpcy5fY29sbGlzaW9uTWFzayA9IDA7CiAgICAgICAgICAgICAgICB0aGlzLl9hY3R1YWxDb2xsaXNpb25NYXNrID0gMDsKICAgICAgICAgICAgICAgIHRoaXMuX3ByZXZlbnRSb3RhdGlvbiA9IGZhbHNlOwogICAgICAgICAgICAgICAgdGhpcy5fZGVuc2l0eSA9IDE7CiAgICAgICAgICAgICAgICB0aGlzLl9mcmljdGlvbiA9IC41OwogICAgICAgICAgICAgICAgdGhpcy5fcmVzdGl0dXRpb24gPSAuMjsKICAgICAgICAgICAgICAgIHRoaXMuX2xpbmVhckRhbXBpbmcgPSAwOwogICAgICAgICAgICAgICAgdGhpcy5fYW5ndWxhckRhbXBpbmcgPSAuMDE7CiAgICAgICAgICAgICAgICB0aGlzLl9pc0J1bGxldCA9IGZhbHNlOwogICAgICAgICAgICAgICAgdGhpcy5faXNFbmFibGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHRoaXMuX2JvZHkgPSBudWxsOwogICAgICAgICAgICAgICAgdGhpcy5fZml4dHVyZXMgPSBbXTsKICAgICAgICAgICAgICAgIHRoaXMuX215Sm9pbnRzID0gW107CiAgICAgICAgICAgICAgICB0aGlzLl9teUNyZWF0ZWRKb2ludHMgPSBbXTsKICAgICAgICAgICAgICAgIHRoaXMuX2pvaW5pbmdNZSA9IG5ldyBTZXQ7CiAgICAgICAgICAgICAgICB0aGlzLl9sYXN0S25vd25YID0gd2kuR2V0WCgpOwogICAgICAgICAgICAgICAgdGhpcy5fbGFzdEtub3duWSA9IHdpLkdldFkoKTsKICAgICAgICAgICAgICAgIHRoaXMuX2xhc3RLbm93bkFuZ2xlID0gd2kuR2V0QW5nbGUoKTsKICAgICAgICAgICAgICAgIHRoaXMuX2xhc3RXaWR0aCA9IDA7CiAgICAgICAgICAgICAgICB0aGlzLl9sYXN0SGVpZ2h0ID0KICAgICAgICAgICAgICAgICAgICAwOwogICAgICAgICAgICAgICAgdGhpcy5fbGFzdFRpY2tPdmVycmlkZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgaWYgKHByb3BlcnRpZXMpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9pc0ltbW92YWJsZSA9ICEhcHJvcGVydGllc1tJTU1PVkFCTEVdOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2NvbGxpc2lvbk1hc2sgPSBwcm9wZXJ0aWVzW0NPTExJU0lPTl9NQVNLXTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9wcmV2ZW50Um90YXRpb24gPSAhIXByb3BlcnRpZXNbUFJFVkVOVF9ST1RBVElPTl07CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZGVuc2l0eSA9IHByb3BlcnRpZXNbREVOU0lUWV07CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZnJpY3Rpb24gPSBwcm9wZXJ0aWVzW0ZSSUNUSU9OXTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZXN0aXR1dGlvbiA9IHByb3BlcnRpZXNbRUxBU1RJQ0lUWV07CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbGluZWFyRGFtcGluZyA9IHByb3BlcnRpZXNbTElORUFSX0RBTVBJTkddOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2FuZ3VsYXJEYW1waW5nID0gcHJvcGVydGllc1tBTkdVTEFSX0RBTVBJTkddOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2lzQnVsbGV0ID0gISFwcm9wZXJ0aWVzW0JVTExFVF07CiAgICAgICAgICAgICAgICAgICAgdGhpcy5faXNFbmFibGVkID0gISFwcm9wZXJ0aWVzW0VOQUJMRV0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNvbnN0IHJ0ID0gdGhpcy5fcnVudGltZS5EaXNwYXRjaGVyKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9kaXNwb3NhYmxlcyA9IG5ldyBDMy5Db21wb3NpdGVEaXNwb3NhYmxlKEMzLkRpc3Bvc2FibGUuRnJvbShydCwgImluc3RhbmNlZGVzdHJveSIsIGUgPT4gdGhpcy5fT25JbnN0YW5jZURlc3Ryb3llZChlLmluc3RhbmNlKSksIEMzLkRpc3Bvc2FibGUuRnJvbShydCwgImJlZm9yZWxvYWQiLCAoKSA9PiB0aGlzLl9PbkJlZm9yZUxvYWQoKSksIEMzLkRpc3Bvc2FibGUuRnJvbShydCwgImFmdGVybG9hZCIsICgpID0+IHRoaXMuX09uQWZ0ZXJMb2FkKCkpKTsKICAgICAgICAgICAgICAgIGluc3QyYmVoLnNldCh0aGlzLl9pbnN0LCB0aGlzKTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9pc0VuYWJsZWQpIHRoaXMuX1N0YXJ0VGlja2luZygpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgUG9zdENyZWF0ZSgpIHsKICAgICAgICAgICAgICAgIHRoaXMuX0NyZWF0ZUJvZHkoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIFJlbGVhc2UoKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9EZXN0cm95TXlKb2ludHMoKTsKICAgICAgICAgICAgICAgIEMzLmNsZWFyQXJyYXkodGhpcy5fbXlDcmVhdGVkSm9pbnRzKTsKICAgICAgICAgICAgICAgIHRoaXMuX2pvaW5pbmdNZS5jbGVhcigpOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuX2JvZHkpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9EZXN0cm95Rml4dHVyZXMoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl93b3JsZFsiRGVzdHJveUJvZHkiXSh0aGlzLl9ib2R5KTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9ib2R5ID0gbnVsbAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgc3VwZXIuUmVsZWFzZSgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX0NyZWF0ZUZpeHR1cmUoZml4RGVmKSB7CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX2JvZHkpIHJldHVybjsKICAgICAgICAgICAgICAgIGNvbnN0IGZpeHR1cmUgPSB0aGlzLl9ib2R5WyJDcmVhdGVGaXh0dXJlIl0oZml4RGVmKTsKICAgICAgICAgICAgICAgIHRoaXMuX2ZpeHR1cmVzLnB1c2goZml4dHVyZSk7CiAgICAgICAgICAgICAgICByZXR1cm4gZml4dHVyZQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9EZXN0cm95Rml4dHVyZXMoKSB7CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX2JvZHkpIHJldHVybjsKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgZml4dHVyZSBvZiB0aGlzLl9maXh0dXJlcykgdGhpcy5fYm9keVsiRGVzdHJveUZpeHR1cmUiXShmaXh0dXJlKTsKICAgICAgICAgICAgICAgIEMzLmNsZWFyQXJyYXkodGhpcy5fZml4dHVyZXMpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX0dldEJvdW5kaW5nUXVhZEV4Y2x1ZGluZ01lc2goKSB7CiAgICAgICAgICAgICAgICBjb25zdCB3aSA9IHRoaXMuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgICAgICBpZiAod2kuSGFzTWVzaCgpKSB7CiAgICAgICAgICAgICAgICAgICAgd2kuQ2FsY3VsYXRlQmJveCh0ZW1wUmVjdCwgdGVtcFF1YWQsIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGVtcFF1YWQKICAgICAgICAgICAgICAgIH0gZWxzZSByZXR1cm4gd2kuR2V0Qm91bmRpbmdRdWFkKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBfRGVzdHJveShvKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9ib3gyZFsiZGVzdHJveSJdKG8pCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX0NyZWF0ZUJvZHkoKSB7CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX2lzRW5hYmxlZCkgcmV0dXJuOwogICAgICAgICAgICAgICAgY29uc3QgYjJGaXh0dXJlRGVmID0gdGhpcy5fYm94MmRbImIyRml4dHVyZURlZiJdOwogICAgICAgICAgICAgICAgY29uc3QgYjJCb2R5RGVmID0gdGhpcy5fYm94MmRbImIyQm9keURlZiJdOwogICAgICAgICAgICAgICAgY29uc3Qgd2kgPSB0aGlzLkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICAgICAgY29uc3QgaGFzUG9seSA9IHdpLkhhc093bkNvbGxpc2lvblBvbHkoKTsKICAgICAgICAgICAgICAgIHRoaXMuX2FjdHVhbENvbGxpc2lvbk1hc2sgPSB0aGlzLl9jb2xsaXNpb25NYXNrOwogICAgICAgICAgICAgICAgaWYgKCFoYXNQb2x5ICYmICF0aGlzLl9pbnN0Lkhhc1RpbGVtYXAoKSAmJiB0aGlzLl9hY3R1YWxDb2xsaXNpb25NYXNrID09PSAwKSB0aGlzLl9hY3R1YWxDb2xsaXNpb25NYXNrID0gMTsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5fYm9keSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGJvZHlEZWYgPSBuZXcgYjJCb2R5RGVmOwogICAgICAgICAgICAgICAgICAgIGJvZHlEZWZbInNldF90eXBlIl0odGhpcy5faXNJbW1vdmFibGUgPyAwIDogMik7CiAgICAgICAgICAgICAgICAgICAgbGV0IGJvZHlYID0gd2kuR2V0WCgpICogdGhpcy5fd29ybGRTY2FsZTsKICAgICAgICAgICAgICAgICAgICBsZXQgYm9keVkgPSB3aS5HZXRZKCkgKiB0aGlzLl93b3JsZFNjYWxlOwogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9hY3R1YWxDb2xsaXNpb25NYXNrID09PSAyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGJxdWFkID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX0dldEJvdW5kaW5nUXVhZEV4Y2x1ZGluZ01lc2goKTsKICAgICAgICAgICAgICAgICAgICAgICAgYm9keVggPSBicXVhZC5taWRYKCkgKiB0aGlzLl93b3JsZFNjYWxlOwogICAgICAgICAgICAgICAgICAgICAgICBib2R5WSA9IGJxdWFkLm1pZFkoKSAqIHRoaXMuX3dvcmxkU2NhbGUKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYm9keURlZlsic2V0X3Bvc2l0aW9uIl0oR2V0VGVtcFZlYzJCKGJvZHlYLCBib2R5WSkpOwogICAgICAgICAgICAgICAgICAgIGJvZHlEZWZbInNldF9hbmdsZSJdKHdpLkdldEFuZ2xlKCkpOwogICAgICAgICAgICAgICAgICAgIGJvZHlEZWZbInNldF9maXhlZFJvdGF0aW9uIl0odGhpcy5fcHJldmVudFJvdGF0aW9uKTsKICAgICAgICAgICAgICAgICAgICBib2R5RGVmWyJzZXRfbGluZWFyRGFtcGluZyJdKHRoaXMuX2xpbmVhckRhbXBpbmcpOwogICAgICAgICAgICAgICAgICAgIGJvZHlEZWZbInNldF9hbmd1bGFyRGFtcGluZyJdKHRoaXMuX2FuZ3VsYXJEYW1waW5nKTsKICAgICAgICAgICAgICAgICAgICBib2R5RGVmWyJzZXRfYnVsbGV0Il0odGhpcy5faXNCdWxsZXQpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2JvZHkgPSB0aGlzLl93b3JsZFsiQ3JlYXRlQm9keSJdKGJvZHlEZWYpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX0Rlc3Ryb3koYm9keURlZik7CiAgICAgICAgICAgICAgICAgICAgYm9keTJiZWguc2V0KHRoaXMuX2JvZHksIHRoaXMpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLl9EZXN0cm95Rml4dHVyZXMoKTsKICAgICAgICAgICAgICAgIGNvbnN0IGZpeERlZiA9IG5ldyBiMkZpeHR1cmVEZWY7CiAgICAgICAgICAgICAgICBmaXhEZWZbInNldF9kZW5zaXR5Il0odGhpcy5fZGVuc2l0eSk7CiAgICAgICAgICAgICAgICBmaXhEZWZbInNldF9mcmljdGlvbiJdKHRoaXMuX2ZyaWN0aW9uKTsKICAgICAgICAgICAgICAgIGZpeERlZlsic2V0X3Jlc3RpdHV0aW9uIl0odGhpcy5fcmVzdGl0dXRpb24pOwogICAgICAgICAgICAgICAgY29uc3QgaW5zdFcgPSBNYXRoLm1heChNYXRoLmFicyh3aS5HZXRXaWR0aCgpKSwgMSk7CiAgICAgICAgICAgICAgICBjb25zdCBpbnN0SCA9IE1hdGgubWF4KE1hdGguYWJzKHdpLkdldEhlaWdodCgpKSwgMSk7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fYWN0dWFsQ29sbGlzaW9uTWFzayA9PT0gMCkKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5faW5zdC5IYXNUaWxlbWFwKCkpIHRoaXMuX0NyZWF0ZVRpbGVtYXBGaXh0dXJlcyhmaXhEZWYpOwogICAgICAgICAgICAgICAgICAgIGVsc2UgdGhpcy5fQ3JlYXRlUG9seWdvbkZpeHR1cmUoZml4RGVmLCBpbnN0VywgaW5zdEgpOwogICAgICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5fYWN0dWFsQ29sbGlzaW9uTWFzayA9PT0gMSkgdGhpcy5fQ3JlYXRlQm91bmRpbmdCb3hGaXh0dXJlKGZpeERlZiwgd2ksIGluc3RXLCBpbnN0SCk7CiAgICAgICAgICAgICAgICBlbHNlIHRoaXMuX0NyZWF0ZUNpcmNsZUZpeHR1cmUoZml4RGVmLAogICAgICAgICAgICAgICAgICAgIGluc3RXLCBpbnN0SCk7CiAgICAgICAgICAgICAgICB0aGlzLl9sYXN0V2lkdGggPSB3aS5HZXRXaWR0aCgpOwogICAgICAgICAgICAgICAgdGhpcy5fbGFzdEhlaWdodCA9IHdpLkdldEhlaWdodCgpOwogICAgICAgICAgICAgICAgd2kuU2V0UGh5c2ljc0JvZHlDaGFuZ2VkKGZhbHNlKTsKICAgICAgICAgICAgICAgIHRoaXMuX0Rlc3Ryb3koZml4RGVmKQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9DcmVhdGVCb3VuZGluZ0JveEZpeHR1cmUoZml4RGVmLCB3aSwgaW5zdFcsIGluc3RIKSB7CiAgICAgICAgICAgICAgICBjb25zdCBiMlBvbHlnb25TaGFwZSA9IHRoaXMuX2JveDJkWyJiMlBvbHlnb25TaGFwZSJdOwogICAgICAgICAgICAgICAgY29uc3Qgc2hhcGUgPSBuZXcgYjJQb2x5Z29uU2hhcGU7CiAgICAgICAgICAgICAgICBjb25zdCBmaXhXaWR0aCA9IGluc3RXICogdGhpcy5fd29ybGRTY2FsZTsKICAgICAgICAgICAgICAgIGNvbnN0IGZpeEhlaWdodCA9IGluc3RIICogdGhpcy5fd29ybGRTY2FsZTsKICAgICAgICAgICAgICAgIGxldCBvcmlnaW5YID0gd2kuR2V0T3JpZ2luWCgpOwogICAgICAgICAgICAgICAgbGV0IG9yaWdpblkgPSB3aS5HZXRPcmlnaW5ZKCk7CiAgICAgICAgICAgICAgICBpZiAod2kuR2V0V2lkdGgoKSA8IDApIG9yaWdpblggPSAxIC0gb3JpZ2luWDsKICAgICAgICAgICAgICAgIGlmICh3aS5HZXRIZWlnaHQoKSA8IDApIG9yaWdpblkgPSAxIC0gb3JpZ2luWTsKICAgICAgICAgICAgICAgIGNvbnN0IGZpeE9yaWdpblggPSAoLjUgLSBvcmlnaW5YKSAqIGZpeFdpZHRoOwogICAgICAgICAgICAgICAgY29uc3QgZml4T3JpZ2luWSA9ICguNSAtIG9yaWdpblkpICogZml4SGVpZ2h0OwogICAgICAgICAgICAgICAgY29uc3Qgb3JpZ2luVmVjID0gQzMuQmVoYXZpb3JzLlBoeXNpY3MuR2V0VmVjMihmaXhPcmlnaW5YLCBmaXhPcmlnaW5ZKTsKICAgICAgICAgICAgICAgIHNoYXBlWyJTZXRBc0JveCJdKGZpeFdpZHRoIC8gMiwgZml4SGVpZ2h0IC8gMiwgb3JpZ2luVmVjLCAwKTsKICAgICAgICAgICAgICAgIGZpeERlZlsic2V0X3NoYXBlIl0oc2hhcGUpOwogICAgICAgICAgICAgICAgdGhpcy5fQ3JlYXRlRml4dHVyZShmaXhEZWYpOwogICAgICAgICAgICAgICAgdGhpcy5fRGVzdHJveShzaGFwZSk7CiAgICAgICAgICAgICAgICBDMy5CZWhhdmlvcnMuUGh5c2ljcy5GcmVlVmVjMihvcmlnaW5WZWMpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX0NyZWF0ZUNpcmNsZUZpeHR1cmUoZml4RGVmLCBpbnN0VywgaW5zdEgpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGIyQ2lyY2xlU2hhcGUgPSB0aGlzLl9ib3gyZFsiYjJDaXJjbGVTaGFwZSJdOwogICAgICAgICAgICAgICAgY29uc3Qgc2hhcGUgPSBuZXcgYjJDaXJjbGVTaGFwZTsKICAgICAgICAgICAgICAgIHNoYXBlWyJzZXRfbV9yYWRpdXMiXShNYXRoLm1pbihpbnN0VywgaW5zdEgpICogdGhpcy5fd29ybGRTY2FsZSAqIC41KTsKICAgICAgICAgICAgICAgIGZpeERlZlsic2V0X3NoYXBlIl0oc2hhcGUpOwogICAgICAgICAgICAgICAgdGhpcy5fQ3JlYXRlRml4dHVyZShmaXhEZWYpOwogICAgICAgICAgICAgICAgdGhpcy5fRGVzdHJveShzaGFwZSkKICAgICAgICAgICAgfQogICAgICAgICAgICBfQ3JlYXRlUG9seWdvbkZpeHR1cmUoZml4RGVmLCBpbnN0VywgaW5zdEgpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHdpID0gdGhpcy5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgICAgIGNvbnN0IGlzTWlycm9yZWQgPSB3aS5HZXRXaWR0aCgpIDwgMDsKICAgICAgICAgICAgICAgIGNvbnN0IGlzRmxpcHBlZCA9IHdpLkdldEhlaWdodCgpIDwgMDsKICAgICAgICAgICAgICAgIGNvbnN0IHdvcmxkU2NhbGUgPSB0aGlzLl93b3JsZFNjYWxlOwogICAgICAgICAgICAgICAgY29uc3QgdHJhbnNmb3JtZWRQb2x5ID0gd2kuR2V0Q3VzdG9tVHJhbnNmb3JtZWRDb2xsaXNpb25Qb2x5KGlzTWlycm9yZWQgPyAtaW5zdFcgOiBpbnN0VywgaXNGbGlwcGVkID8gLWluc3RIIDogaW5zdEgsIDApOwogICAgICAgICAgICAgICAgY29uc3QgcHRzQXJyID0gdHJhbnNmb3JtZWRQb2x5LnBvaW50c0FycigpOwogICAgICAgICAgICAgICAgY29uc3QgcHRzQ291bnQgPSBwdHNBcnIubGVuZ3RoIC8gMjsKICAgICAgICAgICAgICAgIGNvbnN0IGFyciA9IFtdOwogICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwdHNDb3VudDsgKytpKSBhcnIucHVzaChDMy5CZWhhdmlvcnMuUGh5c2ljcy5HZXRWZWMyKHB0c0FycltpICogMl0sIHB0c0FycltpICogMiArIDFdKSk7CiAgICAgICAgICAgICAgICBpZiAoaXNNaXJyb3JlZCAhPT0gaXNGbGlwcGVkKSBhcnIucmV2ZXJzZSgpOwogICAgICAgICAgICAgICAgY29uc3QgY29udmV4UG9seXMgPSBDMy5CZWhhdmlvcnMuUGh5c2ljcy5TZXBhcmF0b3IuU2VwYXJhdGUoYXJyLCBpbnN0VyAqIGluc3RIKTsKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgdiBvZiBhcnIpIEMzLkJlaGF2aW9ycy5QaHlzaWNzLkZyZWVWZWMyKHYpOwogICAgICAgICAgICAgICAgaWYgKGNvbnZleFBvbHlzLmxlbmd0aCkKICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGFycjIgb2YgY29udmV4UG9seXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCB2ZWMgb2YgYXJyMikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmVjWyJzZXRfeCJdKHZlY1siZ2V0X3giXSgpICogd29ybGRTY2FsZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2ZWNbInNldF95Il0odmVjWyJnZXRfeSJdKCkgKiB3b3JsZFNjYWxlKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHNoYXBlID0gQzMuQmVoYXZpb3JzLlBoeXNpY3MuQ3JlYXRlUG9seWdvblNoYXBlKGFycjIpOwogICAgICAgICAgICAgICAgICAgICAgICBmaXhEZWZbInNldF9zaGFwZSJdKHNoYXBlKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fQ3JlYXRlRml4dHVyZShmaXhEZWYpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9EZXN0cm95KHNoYXBlKTsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCB2IG9mIGFycjIpIEMzLkJlaGF2aW9ycy5QaHlzaWNzLkZyZWVWZWMyKHYpCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHRoaXMuX0NyZWF0ZUJvdW5kaW5nQm94Rml4dHVyZShmaXhEZWYsCiAgICAgICAgICAgICAgICAgICAgICAgIHdpLCBpbnN0VywgaW5zdEgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX0NyZWF0ZVRpbGVtYXBGaXh0dXJlcyhmaXhEZWYpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHdvcmxkU2NhbGUgPSB0aGlzLl93b3JsZFNjYWxlOwogICAgICAgICAgICAgICAgY29uc3QgR2V0VmVjMiA9IEMzLkJlaGF2aW9ycy5QaHlzaWNzLkdldFZlYzI7CiAgICAgICAgICAgICAgICBjb25zdCBGcmVlVmVjMiA9IEMzLkJlaGF2aW9ycy5QaHlzaWNzLkZyZWVWZWMyOwogICAgICAgICAgICAgICAgY29uc3QgY29sbFJlY3RzID0gW107CiAgICAgICAgICAgICAgICB0aGlzLl9pbnN0LkdldFNka0luc3RhbmNlKCkuR2V0QWxsQ29sbGlzaW9uUmVjdHMoY29sbFJlY3RzKTsKICAgICAgICAgICAgICAgIGNvbnN0IGFyciA9IFtdOwogICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IGNvbGxSZWN0cy5sZW5ndGg7IGkgPCBsZW47ICsraSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGMgPSBjb2xsUmVjdHNbaV07CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmMgPSBjLkdldFJlY3QoKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBwb2x5ID0gYy5HZXRQb2x5KCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHBvbHkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGNvbnZleFBvbHlzID0gdGlsZUNvbnZleFBvbHlDYWNoZS5nZXQocG9seSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghY29udmV4UG9seXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHB0c0FyciA9IHBvbHkucG9pbnRzQXJyKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwdHNDb3VudCA9IHBvbHkucG9pbnRDb3VudCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBwdHNDb3VudDsgKytqKSBhcnIucHVzaChHZXRWZWMyKHB0c0FycltqICogMl0sIHB0c0FycltqICogMiArIDFdKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmbGFncyA9IGMuR2V0VGlsZUlkKCkgJiBUSUxFX0ZMQUdTX01BU0s7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmxhZ3MgPT09IFRJTEVfRkxJUFBFRF9IT1JJWk9OVEFMIHx8IGZsYWdzID09PSBUSUxFX0ZMSVBQRURfVkVSVElDQUwgfHwgZmxhZ3MgPT09IFRJTEVfRkxJUFBFRF9ESUFHT05BTCB8fCBmbGFncyAmIFRJTEVfRkxJUFBFRF9IT1JJWk9OVEFMICYmIGZsYWdzICYgVElMRV9GTElQUEVEX1ZFUlRJQ0FMICYmIGZsYWdzICYgVElMRV9GTElQUEVEX0RJQUdPTkFMKSBhcnIucmV2ZXJzZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udmV4UG9seXMgPSBDMy5CZWhhdmlvcnMuUGh5c2ljcy5TZXBhcmF0b3IuU2VwYXJhdGUoYXJyLCByYy53aWR0aCgpICogcmMuaGVpZ2h0KCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGlsZUNvbnZleFBvbHlDYWNoZS5zZXQocG9seSwgY29udmV4UG9seXMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCB2IG9mIGFycikgRnJlZVZlYzIodik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDMy5jbGVhckFycmF5KGFycikKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBqID0gMCwgbGVuaiA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udmV4UG9seXMubGVuZ3RoOyBqIDwgbGVuajsgKytqKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjcCA9IGNvbnZleFBvbHlzW2pdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgayA9IDAsIGxlbmsgPSBjcC5sZW5ndGg7IGsgPCBsZW5rOyArK2spIGFyci5wdXNoKEdldFZlYzIoKHJjLmdldExlZnQoKSArIGNwW2tdWyJnZXRfeCJdKCkpICogd29ybGRTY2FsZSwgKHJjLmdldFRvcCgpICsgY3Bba11bImdldF95Il0oKSkgKiB3b3JsZFNjYWxlKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzaGFwZSA9IEMzLkJlaGF2aW9ycy5QaHlzaWNzLkNyZWF0ZVBvbHlnb25TaGFwZShhcnIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZml4RGVmWyJzZXRfc2hhcGUiXShzaGFwZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9DcmVhdGVGaXh0dXJlKGZpeERlZik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9EZXN0cm95KHNoYXBlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgdiBvZiBhcnIpIEZyZWVWZWMyKHYpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgQzMuY2xlYXJBcnJheShhcnIpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBhcnIucHVzaChHZXRWZWMyKHJjLmdldExlZnQoKSAqIHdvcmxkU2NhbGUsIHJjLmdldFRvcCgpICogd29ybGRTY2FsZSkpOwogICAgICAgICAgICAgICAgICAgICAgICBhcnIucHVzaChHZXRWZWMyKHJjLmdldFJpZ2h0KCkgKiB3b3JsZFNjYWxlLCByYy5nZXRUb3AoKSAqCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3b3JsZFNjYWxlKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGFyci5wdXNoKEdldFZlYzIocmMuZ2V0UmlnaHQoKSAqIHdvcmxkU2NhbGUsIHJjLmdldEJvdHRvbSgpICogd29ybGRTY2FsZSkpOwogICAgICAgICAgICAgICAgICAgICAgICBhcnIucHVzaChHZXRWZWMyKHJjLmdldExlZnQoKSAqIHdvcmxkU2NhbGUsIHJjLmdldEJvdHRvbSgpICogd29ybGRTY2FsZSkpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzaGFwZSA9IEMzLkJlaGF2aW9ycy5QaHlzaWNzLkNyZWF0ZVBvbHlnb25TaGFwZShhcnIpOwogICAgICAgICAgICAgICAgICAgICAgICBmaXhEZWZbInNldF9zaGFwZSJdKHNoYXBlKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fQ3JlYXRlRml4dHVyZShmaXhEZWYpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9EZXN0cm95KHNoYXBlKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHYgb2YgYXJyKSBGcmVlVmVjMih2KTsKICAgICAgICAgICAgICAgICAgICBDMy5jbGVhckFycmF5KGFycikKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBfRGVzdHJveUJvZHkoKSB7CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX2JvZHkpIHJldHVybjsKICAgICAgICAgICAgICAgIHRoaXMuX0Rlc3Ryb3lNeUpvaW50cygpOwogICAgICAgICAgICAgICAgYm9keTJiZWguZGVsZXRlKHRoaXMuX2JvZHkpOwogICAgICAgICAgICAgICAgdGhpcy5fRGVzdHJveUZpeHR1cmVzKCk7CiAgICAgICAgICAgICAgICB0aGlzLl93b3JsZFsiRGVzdHJveUJvZHkiXSh0aGlzLl9ib2R5KTsKICAgICAgICAgICAgICAgIHRoaXMuX2JvZHkgPSBudWxsCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX0Rlc3Ryb3lNeUpvaW50cygpIHsKICAgICAgICAgICAgICAgIGZvciAoY29uc3Qgam9pbnQgb2YgdGhpcy5fbXlKb2ludHMpIHRoaXMuX3dvcmxkWyJEZXN0cm95Sm9pbnQiXShqb2ludCk7CiAgICAgICAgICAgICAgICBDMy5jbGVhckFycmF5KHRoaXMuX215Sm9pbnRzKQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9SZWNyZWF0ZU15Sm9pbnRzKCkgewogICAgICAgICAgICAgICAgZm9yIChjb25zdCBqIG9mIHRoaXMuX215Q3JlYXRlZEpvaW50cykgc3dpdGNoIChqLnR5cGUpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX0RvQ3JlYXRlRGlzdGFuY2VKb2ludCguLi5qLnBhcmFtcyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fRG9DcmVhdGVSZXZvbHV0ZUpvaW50KC4uLmoucGFyYW1zKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9Eb0NyZWF0ZUxpbWl0ZWRSZXZvbHV0ZUpvaW50KC4uLmoucGFyYW1zKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9Eb0NyZWF0ZVByaXNtYXRpY0pvaW50KC4uLmoucGFyYW1zKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBfR2V0SW5zdEltYWdlUG9pbnQoaW1nUHQpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHdpID0gdGhpcy5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgICAgIGlmIChpbWdQdCA9PT0gLTEpIHJldHVybiBbd2kuR2V0WCgpLCB3aS5HZXRZKCldOwogICAgICAgICAgICAgICAgaWYgKGltZ1B0ID09PSAwICYmIHRoaXMuX2JvZHkpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBwb3MgPSB0aGlzLl9ib2R5WyJHZXRQb3NpdGlvbiJdKCk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgbGMgPQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9ib2R5WyJHZXRMb2NhbENlbnRlciJdKCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsocG9zWyJnZXRfeCJdKCkgKyBsY1siZ2V0X3giXSgpKSAvIHRoaXMuX3dvcmxkU2NhbGUsIChwb3NbImdldF95Il0oKSArIGxjWyJnZXRfeSJdKCkpIC8gdGhpcy5fd29ybGRTY2FsZV0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9pbnN0LkdldEltYWdlUG9pbnQoaW1nUHQpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX0NyZWF0ZURpc3RhbmNlSm9pbnQoaW1nUHQsIG90aGVySW5zdCwgb3RoZXJJbWdQdCwgZGFtcGluZywgZnJlcSkgewogICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9pc0VuYWJsZWQgfHwgIW90aGVySW5zdCB8fCBvdGhlckluc3QgPT09IHRoaXMuX2luc3QpIHJldHVybjsKICAgICAgICAgICAgICAgIGNvbnN0IG90aGVyQmVoSW5zdCA9IEMzLkJlaGF2aW9ycy5QaHlzaWNzLkluc3RhbmNlLkxvb2t1cEJlaEluc3RGcm9tSW5zdChvdGhlckluc3QpOwogICAgICAgICAgICAgICAgaWYgKCFvdGhlckJlaEluc3QgfHwgIW90aGVyQmVoSW5zdC5fSXNFbmFibGVkKCkpIHJldHVybjsKICAgICAgICAgICAgICAgIHRoaXMuX215Q3JlYXRlZEpvaW50cy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICB0eXBlOiAwLAogICAgICAgICAgICAgICAgICAgIHBhcmFtczogW2ltZ1B0LCBvdGhlckluc3QuR2V0VUlEKCksCiAgICAgICAgICAgICAgICAgICAgICAgIG90aGVySW1nUHQsIGRhbXBpbmcsIGZyZXEKICAgICAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHRoaXMuX0RvQ3JlYXRlRGlzdGFuY2VKb2ludChpbWdQdCwgb3RoZXJJbnN0LkdldFVJRCgpLCBvdGhlckltZ1B0LCBkYW1waW5nLCBmcmVxKQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9Eb0NyZWF0ZURpc3RhbmNlSm9pbnQoaW1nUHQsIG90aGVySW5zdFVpZCwgb3RoZXJJbWdQdCwgZGFtcGluZywgZnJlcSkgewogICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9pc0VuYWJsZWQpIHJldHVybjsKICAgICAgICAgICAgICAgIGNvbnN0IG90aGVySW5zdCA9IHRoaXMuX3J1bnRpbWUuR2V0SW5zdGFuY2VCeVVJRChvdGhlckluc3RVaWQpOwogICAgICAgICAgICAgICAgaWYgKCFvdGhlckluc3QgfHwgb3RoZXJJbnN0ID09PSB0aGlzLl9pbnN0KSByZXR1cm47CiAgICAgICAgICAgICAgICBjb25zdCBvdGhlckJlaEluc3QgPSBDMy5CZWhhdmlvcnMuUGh5c2ljcy5JbnN0YW5jZS5Mb29rdXBCZWhJbnN0RnJvbUluc3Qob3RoZXJJbnN0KTsKICAgICAgICAgICAgICAgIGlmICghb3RoZXJCZWhJbnN0IHx8ICFvdGhlckJlaEluc3QuX0lzRW5hYmxlZCgpKSByZXR1cm47CiAgICAgICAgICAgICAgICBvdGhlckJlaEluc3QuX2pvaW5pbmdNZS5hZGQodGhpcy5faW5zdCk7CiAgICAgICAgICAgICAgICB0aGlzLl9VcGRhdGVCb2R5VG9NYXRjaEluc3RhbmNlKGZhbHNlKTsKICAgICAgICAgICAgICAgIG90aGVyQmVoSW5zdC5fVXBkYXRlQm9keVRvTWF0Y2hJbnN0YW5jZShmYWxzZSk7CiAgICAgICAgICAgICAgICBjb25zdCBbbXlYLCBteVldID0gdGhpcy5fR2V0SW5zdEltYWdlUG9pbnQoaW1nUHQpOwogICAgICAgICAgICAgICAgY29uc3QgW3RoZWlyWCwgdGhlaXJZXSA9IG90aGVySW5zdC5HZXRJbWFnZVBvaW50KG90aGVySW1nUHQpOwogICAgICAgICAgICAgICAgY29uc3QgZHggPSBteVggLSB0aGVpclg7CiAgICAgICAgICAgICAgICBjb25zdCBkeSA9IG15WSAtIHRoZWlyWTsKICAgICAgICAgICAgICAgIGNvbnN0IGIyRGlzdGFuY2VKb2ludERlZiA9IHRoaXMuX2JveDJkWyJiMkRpc3RhbmNlSm9pbnREZWYiXTsKICAgICAgICAgICAgICAgIGNvbnN0IHdvcmxkU2NhbGUgPSB0aGlzLl93b3JsZFNjYWxlOwogICAgICAgICAgICAgICAgY29uc3Qgam9pbnREZWYgPSBuZXcgYjJEaXN0YW5jZUpvaW50RGVmOwogICAgICAgICAgICAgICAgam9pbnREZWZbIkluaXRpYWxpemUiXSh0aGlzLl9ib2R5LCBvdGhlckJlaEluc3QuR2V0Qm9keSgpLCBHZXRUZW1wVmVjMkEobXlYICogd29ybGRTY2FsZSwgbXlZICogd29ybGRTY2FsZSksIEdldFRlbXBWZWMyQih0aGVpclggKiB3b3JsZFNjYWxlLCB0aGVpclkgKiB3b3JsZFNjYWxlKSk7CiAgICAgICAgICAgICAgICBqb2ludERlZlsic2V0X2xlbmd0aCJdKE1hdGguaHlwb3QoZHgsCiAgICAgICAgICAgICAgICAgICAgZHkpICogd29ybGRTY2FsZSk7CiAgICAgICAgICAgICAgICBqb2ludERlZlsic2V0X2RhbXBpbmdSYXRpbyJdKGRhbXBpbmcpOwogICAgICAgICAgICAgICAgam9pbnREZWZbInNldF9mcmVxdWVuY3lIeiJdKGZyZXEpOwogICAgICAgICAgICAgICAgdGhpcy5fbXlKb2ludHMucHVzaCh0aGlzLl93b3JsZFsiQ3JlYXRlSm9pbnQiXShqb2ludERlZikpOwogICAgICAgICAgICAgICAgdGhpcy5fRGVzdHJveShqb2ludERlZikKICAgICAgICAgICAgfQogICAgICAgICAgICBfQ3JlYXRlUmV2b2x1dGVKb2ludChpbWdQdCwgb3RoZXJJbnN0KSB7CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX2lzRW5hYmxlZCB8fCAhb3RoZXJJbnN0IHx8IG90aGVySW5zdCA9PT0gdGhpcy5faW5zdCkgcmV0dXJuOwogICAgICAgICAgICAgICAgY29uc3Qgb3RoZXJCZWhJbnN0ID0gQzMuQmVoYXZpb3JzLlBoeXNpY3MuSW5zdGFuY2UuTG9va3VwQmVoSW5zdEZyb21JbnN0KG90aGVySW5zdCk7CiAgICAgICAgICAgICAgICBpZiAoIW90aGVyQmVoSW5zdCB8fCAhb3RoZXJCZWhJbnN0Ll9Jc0VuYWJsZWQoKSkgcmV0dXJuOwogICAgICAgICAgICAgICAgdGhpcy5fbXlDcmVhdGVkSm9pbnRzLnB1c2goewogICAgICAgICAgICAgICAgICAgIHR5cGU6IDEsCiAgICAgICAgICAgICAgICAgICAgcGFyYW1zOiBbaW1nUHQsIG90aGVySW5zdC5HZXRVSUQoKV0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgdGhpcy5fRG9DcmVhdGVSZXZvbHV0ZUpvaW50KGltZ1B0LAogICAgICAgICAgICAgICAgICAgIG90aGVySW5zdC5HZXRVSUQoKSkKICAgICAgICAgICAgfQogICAgICAgICAgICBfRG9DcmVhdGVSZXZvbHV0ZUpvaW50KGltZ1B0LCBvdGhlckluc3RVaWQpIHsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5faXNFbmFibGVkKSByZXR1cm47CiAgICAgICAgICAgICAgICBjb25zdCBvdGhlckluc3QgPSB0aGlzLl9ydW50aW1lLkdldEluc3RhbmNlQnlVSUQob3RoZXJJbnN0VWlkKTsKICAgICAgICAgICAgICAgIGlmICghb3RoZXJJbnN0IHx8IG90aGVySW5zdCA9PT0gdGhpcy5faW5zdCkgcmV0dXJuOwogICAgICAgICAgICAgICAgY29uc3Qgb3RoZXJCZWhJbnN0ID0gQzMuQmVoYXZpb3JzLlBoeXNpY3MuSW5zdGFuY2UuTG9va3VwQmVoSW5zdEZyb21JbnN0KG90aGVySW5zdCk7CiAgICAgICAgICAgICAgICBpZiAoIW90aGVyQmVoSW5zdCB8fCAhb3RoZXJCZWhJbnN0Ll9Jc0VuYWJsZWQoKSkgcmV0dXJuOwogICAgICAgICAgICAgICAgb3RoZXJCZWhJbnN0Ll9qb2luaW5nTWUuYWRkKHRoaXMuX2luc3QpOwogICAgICAgICAgICAgICAgdGhpcy5fVXBkYXRlQm9keVRvTWF0Y2hJbnN0YW5jZShmYWxzZSk7CiAgICAgICAgICAgICAgICBvdGhlckJlaEluc3QuX1VwZGF0ZUJvZHlUb01hdGNoSW5zdGFuY2UoZmFsc2UpOwogICAgICAgICAgICAgICAgY29uc3QgW215WCwgbXlZXSA9IHRoaXMuX0dldEluc3RJbWFnZVBvaW50KGltZ1B0KTsKICAgICAgICAgICAgICAgIGNvbnN0IGIyUmV2b2x1dGVKb2ludERlZiA9IHRoaXMuX2JveDJkWyJiMlJldm9sdXRlSm9pbnREZWYiXTsKICAgICAgICAgICAgICAgIGNvbnN0IHdvcmxkU2NhbGUgPSB0aGlzLl93b3JsZFNjYWxlOwogICAgICAgICAgICAgICAgY29uc3Qgam9pbnREZWYgPSBuZXcgYjJSZXZvbHV0ZUpvaW50RGVmOwogICAgICAgICAgICAgICAgam9pbnREZWZbIkluaXRpYWxpemUiXSh0aGlzLl9ib2R5LCBvdGhlckJlaEluc3QuR2V0Qm9keSgpLCBHZXRUZW1wVmVjMkEobXlYICogd29ybGRTY2FsZSwgbXlZICogd29ybGRTY2FsZSkpOwogICAgICAgICAgICAgICAgdGhpcy5fbXlKb2ludHMucHVzaCh0aGlzLl93b3JsZFsiQ3JlYXRlSm9pbnQiXShqb2ludERlZikpOwogICAgICAgICAgICAgICAgdGhpcy5fRGVzdHJveShqb2ludERlZikKICAgICAgICAgICAgfQogICAgICAgICAgICBfQ3JlYXRlTGltaXRlZFJldm9sdXRlSm9pbnQoaW1nUHQsIG90aGVySW5zdCwgbG93ZXIsIHVwcGVyKSB7CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX2lzRW5hYmxlZCB8fCAhb3RoZXJJbnN0IHx8IG90aGVySW5zdCA9PT0gdGhpcy5faW5zdCkgcmV0dXJuOwogICAgICAgICAgICAgICAgY29uc3Qgb3RoZXJCZWhJbnN0ID0gQzMuQmVoYXZpb3JzLlBoeXNpY3MuSW5zdGFuY2UuTG9va3VwQmVoSW5zdEZyb21JbnN0KG90aGVySW5zdCk7CiAgICAgICAgICAgICAgICBpZiAoIW90aGVyQmVoSW5zdCB8fCAhb3RoZXJCZWhJbnN0Ll9Jc0VuYWJsZWQoKSkgcmV0dXJuOwogICAgICAgICAgICAgICAgbG93ZXIgPSBDMy50b0RlZ3JlZXMobG93ZXIpOwogICAgICAgICAgICAgICAgdXBwZXIgPSBDMy50b0RlZ3JlZXModXBwZXIpOwogICAgICAgICAgICAgICAgdGhpcy5fbXlDcmVhdGVkSm9pbnRzLnB1c2goewogICAgICAgICAgICAgICAgICAgIHR5cGU6IDIsCiAgICAgICAgICAgICAgICAgICAgcGFyYW1zOiBbaW1nUHQsIG90aGVySW5zdC5HZXRVSUQoKSwgbG93ZXIsIHVwcGVyXQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB0aGlzLl9Eb0NyZWF0ZUxpbWl0ZWRSZXZvbHV0ZUpvaW50KGltZ1B0LCBvdGhlckluc3QuR2V0VUlEKCksIGxvd2VyLCB1cHBlcikKICAgICAgICAgICAgfQogICAgICAgICAgICBfRG9DcmVhdGVMaW1pdGVkUmV2b2x1dGVKb2ludChpbWdQdCwgb3RoZXJJbnN0VWlkLCBsb3dlciwgdXBwZXIpIHsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5faXNFbmFibGVkKSByZXR1cm47CiAgICAgICAgICAgICAgICBjb25zdCBvdGhlckluc3QgPSB0aGlzLl9ydW50aW1lLkdldEluc3RhbmNlQnlVSUQob3RoZXJJbnN0VWlkKTsKICAgICAgICAgICAgICAgIGlmICghb3RoZXJJbnN0IHx8IG90aGVySW5zdCA9PT0gdGhpcy5faW5zdCkgcmV0dXJuOwogICAgICAgICAgICAgICAgY29uc3Qgb3RoZXJCZWhJbnN0ID0gQzMuQmVoYXZpb3JzLlBoeXNpY3MuSW5zdGFuY2UuTG9va3VwQmVoSW5zdEZyb21JbnN0KG90aGVySW5zdCk7CiAgICAgICAgICAgICAgICBpZiAoIW90aGVyQmVoSW5zdCB8fCAhb3RoZXJCZWhJbnN0Ll9Jc0VuYWJsZWQoKSkgcmV0dXJuOwogICAgICAgICAgICAgICAgb3RoZXJCZWhJbnN0Ll9qb2luaW5nTWUuYWRkKHRoaXMuX2luc3QpOwogICAgICAgICAgICAgICAgdGhpcy5fVXBkYXRlQm9keVRvTWF0Y2hJbnN0YW5jZShmYWxzZSk7CiAgICAgICAgICAgICAgICBvdGhlckJlaEluc3QuX1VwZGF0ZUJvZHlUb01hdGNoSW5zdGFuY2UoZmFsc2UpOwogICAgICAgICAgICAgICAgY29uc3QgW215WCwgbXlZXSA9IHRoaXMuX0dldEluc3RJbWFnZVBvaW50KGltZ1B0KTsKICAgICAgICAgICAgICAgIGNvbnN0IGIyUmV2b2x1dGVKb2ludERlZiA9IHRoaXMuX2JveDJkWyJiMlJldm9sdXRlSm9pbnREZWYiXTsKICAgICAgICAgICAgICAgIGNvbnN0IHdvcmxkU2NhbGUgPSB0aGlzLl93b3JsZFNjYWxlOwogICAgICAgICAgICAgICAgY29uc3Qgam9pbnREZWYgPSBuZXcgYjJSZXZvbHV0ZUpvaW50RGVmOwogICAgICAgICAgICAgICAgam9pbnREZWZbIkluaXRpYWxpemUiXSh0aGlzLl9ib2R5LCBvdGhlckJlaEluc3QuR2V0Qm9keSgpLCBHZXRUZW1wVmVjMkEobXlYICogd29ybGRTY2FsZSwgbXlZICogd29ybGRTY2FsZSkpOwogICAgICAgICAgICAgICAgam9pbnREZWZbInNldF9lbmFibGVMaW1pdCJdKHRydWUpOwogICAgICAgICAgICAgICAgam9pbnREZWZbInNldF9sb3dlckFuZ2xlIl0oQzMudG9SYWRpYW5zKGxvd2VyKSk7CiAgICAgICAgICAgICAgICBqb2ludERlZlsic2V0X3VwcGVyQW5nbGUiXShDMy50b1JhZGlhbnModXBwZXIpKTsKICAgICAgICAgICAgICAgIHRoaXMuX215Sm9pbnRzLnB1c2godGhpcy5fd29ybGRbIkNyZWF0ZUpvaW50Il0oam9pbnREZWYpKTsKICAgICAgICAgICAgICAgIHRoaXMuX0Rlc3Ryb3koam9pbnREZWYpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX0NyZWF0ZVByaXNtYXRpY0pvaW50KGltZ1B0LCBvdGhlckluc3QsIGF4aXNBbmdsZSwgZW5hYmxlTGltaXQsIGxvd2VyVHJhbnNsYXRpb24sIHVwcGVyVHJhbnNsYXRpb24sIGVuYWJsZU1vdG9yLCBtb3RvclNwZWVkLCBtYXhNb3RvckZvcmNlKSB7CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX2lzRW5hYmxlZCB8fCAhb3RoZXJJbnN0IHx8IG90aGVySW5zdCA9PT0gdGhpcy5faW5zdCkgcmV0dXJuOwogICAgICAgICAgICAgICAgY29uc3Qgb3RoZXJCZWhJbnN0ID0gQzMuQmVoYXZpb3JzLlBoeXNpY3MuSW5zdGFuY2UuTG9va3VwQmVoSW5zdEZyb21JbnN0KG90aGVySW5zdCk7CiAgICAgICAgICAgICAgICBpZiAoIW90aGVyQmVoSW5zdCB8fCAhb3RoZXJCZWhJbnN0Ll9Jc0VuYWJsZWQoKSkgcmV0dXJuOwogICAgICAgICAgICAgICAgYXhpc0FuZ2xlID0gQzMudG9EZWdyZWVzKGF4aXNBbmdsZSk7CiAgICAgICAgICAgICAgICBtb3RvclNwZWVkID0KICAgICAgICAgICAgICAgICAgICBDMy50b0RlZ3JlZXMobW90b3JTcGVlZCk7CiAgICAgICAgICAgICAgICB0aGlzLl9teUNyZWF0ZWRKb2ludHMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgdHlwZTogMywKICAgICAgICAgICAgICAgICAgICBwYXJhbXM6IFtpbWdQdCwgb3RoZXJJbnN0LkdldFVJRCgpLCBheGlzQW5nbGUsIGVuYWJsZUxpbWl0LCBsb3dlclRyYW5zbGF0aW9uLCB1cHBlclRyYW5zbGF0aW9uLCBlbmFibGVNb3RvciwgbW90b3JTcGVlZCwgbWF4TW90b3JGb3JjZV0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgdGhpcy5fRG9DcmVhdGVQcmlzbWF0aWNKb2ludChpbWdQdCwgb3RoZXJJbnN0LkdldFVJRCgpLCBheGlzQW5nbGUsIGVuYWJsZUxpbWl0LCBsb3dlclRyYW5zbGF0aW9uLCB1cHBlclRyYW5zbGF0aW9uLCBlbmFibGVNb3RvciwgbW90b3JTcGVlZCwgbWF4TW90b3JGb3JjZSkKICAgICAgICAgICAgfQogICAgICAgICAgICBfRG9DcmVhdGVQcmlzbWF0aWNKb2ludChpbWdQdCwgb3RoZXJJbnN0VWlkLCBheGlzQW5nbGUsIGVuYWJsZUxpbWl0LCBsb3dlclRyYW5zbGF0aW9uLCB1cHBlclRyYW5zbGF0aW9uLCBlbmFibGVNb3RvciwgbW90b3JTcGVlZCwgbWF4TW90b3JGb3JjZSkgewogICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9pc0VuYWJsZWQpIHJldHVybjsKICAgICAgICAgICAgICAgIGNvbnN0IG90aGVySW5zdCA9IHRoaXMuX3J1bnRpbWUuR2V0SW5zdGFuY2VCeVVJRChvdGhlckluc3RVaWQpOwogICAgICAgICAgICAgICAgaWYgKCFvdGhlckluc3QgfHwgb3RoZXJJbnN0ID09PSB0aGlzLl9pbnN0KSByZXR1cm47CiAgICAgICAgICAgICAgICBjb25zdCBvdGhlckJlaEluc3QgPSBDMy5CZWhhdmlvcnMuUGh5c2ljcy5JbnN0YW5jZS5Mb29rdXBCZWhJbnN0RnJvbUluc3Qob3RoZXJJbnN0KTsKICAgICAgICAgICAgICAgIGlmICghb3RoZXJCZWhJbnN0IHx8ICFvdGhlckJlaEluc3QuX0lzRW5hYmxlZCgpKSByZXR1cm47CiAgICAgICAgICAgICAgICBvdGhlckJlaEluc3QuX2pvaW5pbmdNZS5hZGQodGhpcy5faW5zdCk7CiAgICAgICAgICAgICAgICB0aGlzLl9VcGRhdGVCb2R5VG9NYXRjaEluc3RhbmNlKGZhbHNlKTsKICAgICAgICAgICAgICAgIG90aGVyQmVoSW5zdC5fVXBkYXRlQm9keVRvTWF0Y2hJbnN0YW5jZShmYWxzZSk7CiAgICAgICAgICAgICAgICBjb25zdCBbbXlYLCBteVldID0gdGhpcy5fR2V0SW5zdEltYWdlUG9pbnQoaW1nUHQpOwogICAgICAgICAgICAgICAgYXhpc0FuZ2xlID0gQzMudG9SYWRpYW5zKGF4aXNBbmdsZSk7CiAgICAgICAgICAgICAgICBjb25zdCBheGlzWCA9IE1hdGguY29zKGF4aXNBbmdsZSk7CiAgICAgICAgICAgICAgICBjb25zdCBheGlzWSA9IE1hdGguc2luKGF4aXNBbmdsZSk7CiAgICAgICAgICAgICAgICBjb25zdCBiMlByaXNtYXRpY0pvaW50RGVmID0gdGhpcy5fYm94MmRbImIyUHJpc21hdGljSm9pbnREZWYiXTsKICAgICAgICAgICAgICAgIGNvbnN0IHdvcmxkU2NhbGUgPSB0aGlzLl93b3JsZFNjYWxlOwogICAgICAgICAgICAgICAgY29uc3Qgam9pbnREZWYgPSBuZXcgYjJQcmlzbWF0aWNKb2ludERlZjsKICAgICAgICAgICAgICAgIGpvaW50RGVmWyJJbml0aWFsaXplIl0odGhpcy5fYm9keSwgb3RoZXJCZWhJbnN0LkdldEJvZHkoKSwgR2V0VGVtcFZlYzJBKG15WCAqIHdvcmxkU2NhbGUsIG15WSAqIHdvcmxkU2NhbGUpLCBHZXRUZW1wVmVjMkIoYXhpc1gsIGF4aXNZKSk7CiAgICAgICAgICAgICAgICBqb2ludERlZlsic2V0X2VuYWJsZUxpbWl0Il0oISFlbmFibGVMaW1pdCk7CiAgICAgICAgICAgICAgICBqb2ludERlZlsic2V0X2xvd2VyVHJhbnNsYXRpb24iXShsb3dlclRyYW5zbGF0aW9uICogd29ybGRTY2FsZSk7CiAgICAgICAgICAgICAgICBqb2ludERlZlsic2V0X3VwcGVyVHJhbnNsYXRpb24iXSh1cHBlclRyYW5zbGF0aW9uICogd29ybGRTY2FsZSk7CiAgICAgICAgICAgICAgICBqb2ludERlZlsic2V0X2VuYWJsZU1vdG9yIl0oISFlbmFibGVNb3Rvcik7CiAgICAgICAgICAgICAgICBqb2ludERlZlsic2V0X21vdG9yU3BlZWQiXShDMy50b1JhZGlhbnMobW90b3JTcGVlZCkpOwogICAgICAgICAgICAgICAgam9pbnREZWZbInNldF9tYXhNb3RvckZvcmNlIl0obWF4TW90b3JGb3JjZSk7CiAgICAgICAgICAgICAgICB0aGlzLl9teUpvaW50cy5wdXNoKHRoaXMuX3dvcmxkWyJDcmVhdGVKb2ludCJdKGpvaW50RGVmKSk7CiAgICAgICAgICAgICAgICB0aGlzLl9EZXN0cm95KGpvaW50RGVmKQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9SZW1vdmVKb2ludHMoKSB7CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX2lzRW5hYmxlZCkgcmV0dXJuOwogICAgICAgICAgICAgICAgdGhpcy5fRGVzdHJveU15Sm9pbnRzKCk7CiAgICAgICAgICAgICAgICBDMy5jbGVhckFycmF5KHRoaXMuX215Q3JlYXRlZEpvaW50cyk7CiAgICAgICAgICAgICAgICB0aGlzLl9qb2luaW5nTWUuY2xlYXIoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9SZW1vdmVPdGhlckluc3RhbmNlSm9pbnRzVG9NZSgpIHsKICAgICAgICAgICAgICAgIGZvciAoY29uc3Qgb3RoZXJJbnN0IG9mIHRoaXMuX2pvaW5pbmdNZSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IG90aGVyQmVoSW5zdCA9IEMzLkJlaGF2aW9ycy5QaHlzaWNzLkluc3RhbmNlLkxvb2t1cEJlaEluc3RGcm9tSW5zdChvdGhlckluc3QpOwogICAgICAgICAgICAgICAgICAgIGlmICghb3RoZXJCZWhJbnN0IHx8ICFvdGhlckJlaEluc3QuX0lzRW5hYmxlZCgpKSByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgb3RoZXJCZWhJbnN0Ll9EZXN0cm95Sm9pbnRzRm9ySW5zdGFuY2UodGhpcy5faW5zdCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMuX2pvaW5pbmdNZS5jbGVhcigpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX09uSW5zdGFuY2VEZXN0cm95ZWQoaW5zdCkgewogICAgICAgICAgICAgICAgdGhpcy5fRGVzdHJveUpvaW50c0Zvckluc3RhbmNlKGluc3QpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX0Rlc3Ryb3lKb2ludHNGb3JJbnN0YW5jZShpbnN0KSB7CiAgICAgICAgICAgICAgICBjb25zdCBpbnN0VWlkID0KICAgICAgICAgICAgICAgICAgICBpbnN0LkdldFVJRCgpOwogICAgICAgICAgICAgICAgbGV0IGogPSAwOwogICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IHRoaXMuX215Q3JlYXRlZEpvaW50cy5sZW5ndGg7IGkgPCBsZW47ICsraSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX215Q3JlYXRlZEpvaW50c1tqXSA9IHRoaXMuX215Q3JlYXRlZEpvaW50c1tpXTsKICAgICAgICAgICAgICAgICAgICBpZiAoaiA8IHRoaXMuX215Sm9pbnRzLmxlbmd0aCkgdGhpcy5fbXlKb2ludHNbal0gPSB0aGlzLl9teUpvaW50c1tpXTsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fbXlDcmVhdGVkSm9pbnRzW2ldLnBhcmFtc1sxXSA9PT0gaW5zdFVpZCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaSA8IHRoaXMuX215Sm9pbnRzLmxlbmd0aCkgdGhpcy5fd29ybGRbIkRlc3Ryb3lKb2ludCJdKHRoaXMuX215Sm9pbnRzW2ldKQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSArK2oKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIEMzLnRydW5jYXRlQXJyYXkodGhpcy5fbXlDcmVhdGVkSm9pbnRzLCBqKTsKICAgICAgICAgICAgICAgIGlmIChqIDwgdGhpcy5fbXlKb2ludHMubGVuZ3RoKSBDMy50cnVuY2F0ZUFycmF5KHRoaXMuX215Sm9pbnRzLCBqKTsKICAgICAgICAgICAgICAgIHRoaXMuX2pvaW5pbmdNZS5kZWxldGUoaW5zdCkKICAgICAgICAgICAgfQogICAgICAgICAgICBHZXRCb2R5KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2JvZHkKICAgICAgICAgICAgfQogICAgICAgICAgICBzdGF0aWMgTG9va3VwQmVoSW5zdEZyb21Cb2R5KGJvZHkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBib2R5MmJlaC5nZXQoYm9keSkgfHwKICAgICAgICAgICAgICAgICAgICBudWxsCiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3RhdGljIExvb2t1cEJlaEluc3RGcm9tSW5zdChpbnN0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gaW5zdDJiZWguZ2V0KGluc3QpIHx8IG51bGwKICAgICAgICAgICAgfQogICAgICAgICAgICBTYXZlVG9Kc29uKCkgewogICAgICAgICAgICAgICAgY29uc3QgcmV0ID0gewogICAgICAgICAgICAgICAgICAgICJlIjogdGhpcy5faXNFbmFibGVkLAogICAgICAgICAgICAgICAgICAgICJpbSI6IHRoaXMuX2lzSW1tb3ZhYmxlLAogICAgICAgICAgICAgICAgICAgICJwciI6IHRoaXMuX3ByZXZlbnRSb3RhdGlvbiwKICAgICAgICAgICAgICAgICAgICAiZCI6IHRoaXMuX2RlbnNpdHksCiAgICAgICAgICAgICAgICAgICAgImZyIjogdGhpcy5fZnJpY3Rpb24sCiAgICAgICAgICAgICAgICAgICAgInJlIjogdGhpcy5fcmVzdGl0dXRpb24sCiAgICAgICAgICAgICAgICAgICAgImxkIjogdGhpcy5fbGluZWFyRGFtcGluZywKICAgICAgICAgICAgICAgICAgICAiYWQiOiB0aGlzLl9hbmd1bGFyRGFtcGluZywKICAgICAgICAgICAgICAgICAgICAiYiI6IHRoaXMuX2lzQnVsbGV0LAogICAgICAgICAgICAgICAgICAgICJtY2oiOiB0aGlzLl9teUNyZWF0ZWRKb2ludHMKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBpZiAodGhpcy5faXNFbmFibGVkKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdiA9IHRoaXMuX2JvZHlbIkdldExpbmVhclZlbG9jaXR5Il0oKTsKICAgICAgICAgICAgICAgICAgICByZXRbInZ4Il0gPSB2WyJnZXRfeCJdKCk7CiAgICAgICAgICAgICAgICAgICAgcmV0WyJ2eSJdID0gdlsiZ2V0X3kiXSgpOwogICAgICAgICAgICAgICAgICAgIHJldFsib20iXSA9IHRoaXMuX2JvZHlbIkdldEFuZ3VsYXJWZWxvY2l0eSJdKCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiByZXQKICAgICAgICAgICAgfQogICAgICAgICAgICBfT25CZWZvcmVMb2FkKCkgewogICAgICAgICAgICAgICAgdGhpcy5fRGVzdHJveU15Sm9pbnRzKCk7CiAgICAgICAgICAgICAgICBDMy5jbGVhckFycmF5KHRoaXMuX215Q3JlYXRlZEpvaW50cyk7CiAgICAgICAgICAgICAgICB0aGlzLl9qb2luaW5nTWUuY2xlYXIoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIExvYWRGcm9tSnNvbihvKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9EZXN0cm95Qm9keSgpOwogICAgICAgICAgICAgICAgdGhpcy5faXNFbmFibGVkID0gb1siZSJdOwogICAgICAgICAgICAgICAgaWYgKG8uaGFzT3duUHJvcGVydHkoImltIikpIHRoaXMuX2lzSW1tb3ZhYmxlID0gISFvWyJpbSJdOwogICAgICAgICAgICAgICAgdGhpcy5fcHJldmVudFJvdGF0aW9uID0gb1sicHIiXTsKICAgICAgICAgICAgICAgIHRoaXMuX2RlbnNpdHkgPSBvWyJkIl07CiAgICAgICAgICAgICAgICB0aGlzLl9mcmljdGlvbiA9IG9bImZyIl07CiAgICAgICAgICAgICAgICB0aGlzLl9yZXN0aXR1dGlvbiA9IG9bInJlIl07CiAgICAgICAgICAgICAgICB0aGlzLl9saW5lYXJEYW1waW5nID0gb1sibGQiXTsKICAgICAgICAgICAgICAgIHRoaXMuX2FuZ3VsYXJEYW1waW5nID0gb1siYWQiXTsKICAgICAgICAgICAgICAgIHRoaXMuX2lzQnVsbGV0ID0gb1siYiJdOwogICAgICAgICAgICAgICAgdGhpcy5fbXlDcmVhdGVkSm9pbnRzID0gb1sibWNqIl07CiAgICAgICAgICAgICAgICBjb25zdCB3aSA9IHRoaXMuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9sYXN0S25vd25YID0gd2kuR2V0WCgpOwogICAgICAgICAgICAgICAgdGhpcy5fbGFzdEtub3duWSA9IHdpLkdldFkoKTsKICAgICAgICAgICAgICAgIHRoaXMuX2xhc3RLbm93bkFuZ2xlID0gd2kuR2V0QW5nbGUoKTsKICAgICAgICAgICAgICAgIHRoaXMuX2xhc3RXaWR0aCA9IHdpLkdldFdpZHRoKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9sYXN0SGVpZ2h0ID0gd2kuR2V0SGVpZ2h0KCk7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5faXNFbmFibGVkKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fQ3JlYXRlQm9keSgpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2JvZHlbIlNldExpbmVhclZlbG9jaXR5Il0oR2V0VGVtcFZlYzJBKG9bInZ4Il0sIG9bInZ5Il0pKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9ib2R5WyJTZXRBbmd1bGFyVmVsb2NpdHkiXShvWyJvbSJdKTsKICAgICAgICAgICAgICAgICAgICBpZiAob1sidngiXSAhPT0gMCB8fCBvWyJ2eSJdICE9PSAwIHx8IG9bIm9tIl0gIT09IDApIHRoaXMuX2JvZHlbIlNldEF3YWtlIl0odHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbXlDcmVhdGVkSm9pbnRzID0gb1sibWNqIl0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh0aGlzLl9pc0VuYWJsZWQpIHRoaXMuX1N0YXJ0VGlja2luZygpOwogICAgICAgICAgICAgICAgZWxzZSB0aGlzLl9TdG9wVGlja2luZygpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX09uQWZ0ZXJMb2FkKCkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuX2lzRW5hYmxlZCkgdGhpcy5fUmVjcmVhdGVNeUpvaW50cygpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgVGljaygpIHsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5faXNFbmFibGVkKSByZXR1cm47CiAgICAgICAgICAgICAgICBjb25zdCBydW50aW1lID0gdGhpcy5fcnVudGltZTsKICAgICAgICAgICAgICAgIGNvbnN0IGJlaGF2aW9yID0KICAgICAgICAgICAgICAgICAgICB0aGlzLkdldEJlaGF2aW9yKCk7CiAgICAgICAgICAgICAgICBsZXQgZHQgPSAwOwogICAgICAgICAgICAgICAgaWYgKGJlaGF2aW9yLkdldFN0ZXBwaW5nTW9kZSgpID09PSAwKSBkdCA9IHJ1bnRpbWUuR2V0VGltZVNjYWxlKCkgLyA2MDsKICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIGR0ID0gcnVudGltZS5HZXREdCh0aGlzLl9pbnN0KTsKICAgICAgICAgICAgICAgICAgICBpZiAoZHQgPiAxIC8gMzApIGR0ID0gMSAvIDMwCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjb25zdCB0aWNrQ291bnQgPSBydW50aW1lLkdldFRpY2tDb3VudE5vU2F2ZSgpOwogICAgICAgICAgICAgICAgaWYgKHRpY2tDb3VudCA+IGJlaGF2aW9yLkdldExhc3RVcGRhdGVUaWNrKCkgJiYgcnVudGltZS5HZXRUaW1lU2NhbGUoKSA+IDApIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBpc0RlYnVnID0gdGhpcy5fcnVudGltZS5Jc0RlYnVnKCk7CiAgICAgICAgICAgICAgICAgICAgbGV0IHN0YXJ0VGltZSA9IDA7CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzRGVidWcpIHN0YXJ0VGltZSA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICAgICAgICAgICAgICAgIGlmIChkdCAhPT0gMCkgdGhpcy5fd29ybGRbIlN0ZXAiXShkdCwgYmVoYXZpb3IuR2V0VmVsb2NpdHlJdGVyYXRpb25zKCksIGJlaGF2aW9yLkdldFBvc2l0aW9uSXRlcmF0aW9ucygpKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl93b3JsZFsiQ2xlYXJGb3JjZXMiXSgpOwogICAgICAgICAgICAgICAgICAgIGlmIChpc0RlYnVnKSBzZWxmLkMzRGVidWdnZXIuQWRkUGh5c2ljc1RpbWUocGVyZm9ybWFuY2Uubm93KCkgLQogICAgICAgICAgICAgICAgICAgICAgICBzdGFydFRpbWUpOwogICAgICAgICAgICAgICAgICAgIGJlaGF2aW9yLlNldExhc3RVcGRhdGVUaWNrKHRpY2tDb3VudCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMuX1VwZGF0ZUJvZHlUb01hdGNoSW5zdGFuY2UodHJ1ZSkKICAgICAgICAgICAgfQogICAgICAgICAgICBfVXBkYXRlQm9keVRvTWF0Y2hJbnN0YW5jZShpc1RpY2tVcGRhdGUpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGluc3QgPSB0aGlzLl9pbnN0OwogICAgICAgICAgICAgICAgY29uc3Qgd2kgPSBpbnN0LkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICAgICAgY29uc3Qgd29ybGRTY2FsZSA9IHRoaXMuX3dvcmxkU2NhbGU7CiAgICAgICAgICAgICAgICBpZiAod2kuR2V0V2lkdGgoKSAhPT0gdGhpcy5fbGFzdFdpZHRoIHx8IHdpLkdldEhlaWdodCgpICE9PSB0aGlzLl9sYXN0SGVpZ2h0IHx8IHdpLklzUGh5c2ljc0JvZHlDaGFuZ2VkKCkpIHRoaXMuX0NyZWF0ZUJvZHkoKTsKICAgICAgICAgICAgICAgIGNvbnN0IGJvZHkgPSB0aGlzLl9ib2R5OwogICAgICAgICAgICAgICAgY29uc3QgY3VyWCA9IHdpLkdldFgoKTsKICAgICAgICAgICAgICAgIGNvbnN0IGN1clkgPSB3aS5HZXRZKCk7CiAgICAgICAgICAgICAgICBjb25zdCBkaWZmWCA9IGN1clggLSB0aGlzLl9sYXN0S25vd25YOwogICAgICAgICAgICAgICAgY29uc3QgZGlmZlkgPSBjdXJZIC0gdGhpcy5fbGFzdEtub3duWTsKICAgICAgICAgICAgICAgIGNvbnN0IFBPU19FUFNJTE9OID0gLjAwMTsKICAgICAgICAgICAgICAgIGNvbnN0IHBvc0NoYW5nZWQgPQogICAgICAgICAgICAgICAgICAgIE1hdGguYWJzKGRpZmZYKSA+IFBPU19FUFNJTE9OIHx8IE1hdGguYWJzKGRpZmZZKSA+IFBPU19FUFNJTE9OOwogICAgICAgICAgICAgICAgY29uc3QgYW5nbGVDaGFuZ2VkID0gd2kuR2V0QW5nbGUoKSAhPT0gdGhpcy5fbGFzdEtub3duQW5nbGU7CiAgICAgICAgICAgICAgICBsZXQgbmV3Qm9keVggPSBjdXJYOwogICAgICAgICAgICAgICAgbGV0IG5ld0JvZHlZID0gY3VyWTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9hY3R1YWxDb2xsaXNpb25NYXNrID09PSAyKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYnF1YWQgPSB0aGlzLl9HZXRCb3VuZGluZ1F1YWRFeGNsdWRpbmdNZXNoKCk7CiAgICAgICAgICAgICAgICAgICAgbmV3Qm9keVggPSBicXVhZC5taWRYKCk7CiAgICAgICAgICAgICAgICAgICAgbmV3Qm9keVkgPSBicXVhZC5taWRZKCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChwb3NDaGFuZ2VkKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGFuZ2xlQ2hhbmdlZCkgYm9keVsiU2V0VHJhbnNmb3JtIl0oR2V0VGVtcFZlYzJBKG5ld0JvZHlYICogd29ybGRTY2FsZSwgbmV3Qm9keVkgKiB3b3JsZFNjYWxlKSwgd2kuR2V0QW5nbGUoKSk7CiAgICAgICAgICAgICAgICAgICAgZWxzZSBib2R5WyJTZXRUcmFuc2Zvcm0iXShHZXRUZW1wVmVjMkEobmV3Qm9keVggKiB3b3JsZFNjYWxlLCBuZXdCb2R5WSAqIHdvcmxkU2NhbGUpLCBib2R5WyJHZXRBbmdsZSJdKCkpOwogICAgICAgICAgICAgICAgICAgIGlmIChpc1RpY2tVcGRhdGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYm9keVsiU2V0TGluZWFyVmVsb2NpdHkiXShHZXRUZW1wVmVjMkEoZGlmZlgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaWZmWSkpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9sYXN0VGlja092ZXJyaWRlID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBib2R5WyJTZXRBd2FrZSJdKHRydWUpCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGlzVGlja1VwZGF0ZSAmJiB0aGlzLl9sYXN0VGlja092ZXJyaWRlKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbGFzdFRpY2tPdmVycmlkZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIGJvZHlbIlNldExpbmVhclZlbG9jaXR5Il0oR2V0VGVtcFZlYzJBKDAsIDApKTsKICAgICAgICAgICAgICAgICAgICBib2R5WyJTZXRUcmFuc2Zvcm0iXShHZXRUZW1wVmVjMkEobmV3Qm9keVggKiB3b3JsZFNjYWxlLCBuZXdCb2R5WSAqIHdvcmxkU2NhbGUpLCBib2R5WyJHZXRBbmdsZSJdKCkpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoIXBvc0NoYW5nZWQgJiYgYW5nbGVDaGFuZ2VkKSB7CiAgICAgICAgICAgICAgICAgICAgYm9keVsiU2V0VHJhbnNmb3JtIl0oYm9keVsiR2V0UG9zaXRpb24iXSgpLCB3aS5HZXRBbmdsZSgpKTsKICAgICAgICAgICAgICAgICAgICBib2R5WyJTZXRBd2FrZSJdKHRydWUpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjb25zdCBwb3MgPSBib2R5WyJHZXRQb3NpdGlvbiJdKCk7CiAgICAgICAgICAgICAgICBjb25zdCBuZXdYID0gcG9zWyJnZXRfeCJdKCkgLyB3b3JsZFNjYWxlOwogICAgICAgICAgICAgICAgY29uc3QgbmV3WSA9IHBvc1siZ2V0X3kiXSgpIC8gd29ybGRTY2FsZTsKICAgICAgICAgICAgICAgIGNvbnN0IG5ld0FuZ2xlID0KICAgICAgICAgICAgICAgICAgICBib2R5WyJHZXRBbmdsZSJdKCk7CiAgICAgICAgICAgICAgICBpZiAobmV3WCAhPT0gd2kuR2V0WCgpIHx8IG5ld1kgIT09IHdpLkdldFkoKSB8fCBuZXdBbmdsZSAhPT0gd2kuR2V0QW5nbGUoKSkgewogICAgICAgICAgICAgICAgICAgIHdpLlNldFhZKG5ld1gsIG5ld1kpOwogICAgICAgICAgICAgICAgICAgIHdpLlNldEFuZ2xlKG5ld0FuZ2xlKTsKICAgICAgICAgICAgICAgICAgICB3aS5TZXRCYm94Q2hhbmdlZCgpOwogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9hY3R1YWxDb2xsaXNpb25NYXNrID09PSAyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGJxdWFkID0gdGhpcy5fR2V0Qm91bmRpbmdRdWFkRXhjbHVkaW5nTWVzaCgpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkeCA9IGJxdWFkLm1pZFgoKSAtIHdpLkdldFgoKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZHkgPSBicXVhZC5taWRZKCkgLSB3aS5HZXRZKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkeCAhPT0gMCB8fCBkeSAhPT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2kuT2Zmc2V0WFkoLWR4LCAtZHkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2kuU2V0QmJveENoYW5nZWQoKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5fbGFzdEtub3duWCA9IHdpLkdldFgoKTsKICAgICAgICAgICAgICAgIHRoaXMuX2xhc3RLbm93blkgPSB3aS5HZXRZKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9sYXN0S25vd25BbmdsZSA9IHdpLkdldEFuZ2xlKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBHZXRQcm9wZXJ0eVZhbHVlQnlJbmRleChpbmRleCkgewogICAgICAgICAgICAgICAgc3dpdGNoIChpbmRleCkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgUFJFVkVOVF9ST1RBVElPTjoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX0lzUHJldmVudFJvdGF0ZSgpOwogICAgICAgICAgICAgICAgICAgIGNhc2UgREVOU0lUWToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX0dldERlbnNpdHkoKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIEZSSUNUSU9OOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fR2V0RnJpY3Rpb24oKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIEVMQVNUSUNJVFk6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9HZXRFbGFzdGljaXR5KCk7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBMSU5FQVJfREFNUElORzoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX0dldExpbmVhckRhbXBpbmcoKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIEFOR1VMQVJfREFNUElORzoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX0dldEFuZ3VsYXJEYW1waW5nKCk7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBCVUxMRVQ6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9Jc0J1bGxldCgpOwogICAgICAgICAgICAgICAgICAgIGNhc2UgRU5BQkxFOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fSXNFbmFibGVkKCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBTZXRQcm9wZXJ0eVZhbHVlQnlJbmRleChpbmRleCwgdmFsdWUpIHsKICAgICAgICAgICAgICAgIHN3aXRjaCAoaW5kZXgpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlIFBSRVZFTlRfUk9UQVRJT046CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX1NldFByZXZlbnRSb3RhdGUodmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIERFTlNJVFk6CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX1NldERlbnNpdHkodmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIEZSSUNUSU9OOgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9TZXRGcmljdGlvbih2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgRUxBU1RJQ0lUWToKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fU2V0RWxhc3RpY2l0eSh2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgTElORUFSX0RBTVBJTkc6CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX1NldExpbmVhckRhbXBpbmcodmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIEFOR1VMQVJfREFNUElORzoKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fU2V0QW5ndWxhckRhbXBpbmcodmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIEJVTExFVDoKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fU2V0QnVsbGV0KHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBFTkFCTEU6CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX1NldEVuYWJsZWQodmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9TZXRFbmFibGVkKGUpIHsKICAgICAgICAgICAgICAgIGUgPSAhIWU7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5faXNFbmFibGVkICYmICFlKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fUmVtb3ZlT3RoZXJJbnN0YW5jZUpvaW50c1RvTWUoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9EZXN0cm95Qm9keSgpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2lzRW5hYmxlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX1N0b3BUaWNraW5nKCkKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIXRoaXMuX2lzRW5hYmxlZCAmJiBlKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5faXNFbmFibGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9DcmVhdGVCb2R5KCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fU3RhcnRUaWNraW5nKCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBfSXNFbmFibGVkKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2lzRW5hYmxlZAogICAgICAgICAgICB9CiAgICAgICAgICAgIEdldERlYnVnZ2VyUHJvcGVydGllcygpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHByZWZpeCA9CiAgICAgICAgICAgICAgICAgICAgImJlaGF2aW9ycy5waHlzaWNzIjsKICAgICAgICAgICAgICAgIGNvbnN0IHByb3BzID0gW3sKICAgICAgICAgICAgICAgICAgICBuYW1lOiBwcmVmaXggKyAiLnByb3BlcnRpZXMuZW5hYmxlZC5uYW1lIiwKICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5fSXNFbmFibGVkKCksCiAgICAgICAgICAgICAgICAgICAgb25lZGl0OiB2ID0+IHRoaXMuX1NldEVuYWJsZWQodikKICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICBuYW1lOiBwcmVmaXggKyAiLnByb3BlcnRpZXMuaW1tb3ZhYmxlLm5hbWUiLAogICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLl9Jc0ltbW92YWJsZSgpLAogICAgICAgICAgICAgICAgICAgIG9uZWRpdDogdiA9PiB0aGlzLl9TZXRJbW1vdmFibGUodikKICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICBuYW1lOiBwcmVmaXggKyAiLnByb3BlcnRpZXMuZGVuc2l0eS5uYW1lIiwKICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5fR2V0RGVuc2l0eSgpLAogICAgICAgICAgICAgICAgICAgIG9uZWRpdDogdiA9PiB0aGlzLl9TZXREZW5zaXR5KHYpCiAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgbmFtZTogcHJlZml4ICsgIi5wcm9wZXJ0aWVzLmZyaWN0aW9uLm5hbWUiLAogICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLl9HZXRGcmljdGlvbigpLAogICAgICAgICAgICAgICAgICAgIG9uZWRpdDogdiA9PiB0aGlzLl9TZXRGcmljdGlvbih2KQogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgIG5hbWU6IHByZWZpeCArICIucHJvcGVydGllcy5lbGFzdGljaXR5Lm5hbWUiLAogICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLl9HZXRFbGFzdGljaXR5KCksCiAgICAgICAgICAgICAgICAgICAgb25lZGl0OiB2ID0+CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX1NldEVsYXN0aWNpdHkodikKICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICBuYW1lOiBwcmVmaXggKyAiLnByb3BlcnRpZXMubGluZWFyLWRhbXBpbmcubmFtZSIsCiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuX0dldExpbmVhckRhbXBpbmcoKSwKICAgICAgICAgICAgICAgICAgICBvbmVkaXQ6IHYgPT4gdGhpcy5fU2V0TGluZWFyRGFtcGluZyh2KQogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgIG5hbWU6IHByZWZpeCArICIucHJvcGVydGllcy5hbmd1bGFyLWRhbXBpbmcubmFtZSIsCiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuX0dldEFuZ3VsYXJEYW1waW5nKCksCiAgICAgICAgICAgICAgICAgICAgb25lZGl0OiB2ID0+IHRoaXMuX1NldEFuZ3VsYXJEYW1waW5nKHYpCiAgICAgICAgICAgICAgICB9XTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9pc0VuYWJsZWQpIHsKICAgICAgICAgICAgICAgICAgICBwcm9wcy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogcHJlZml4ICsgIi5kZWJ1Z2dlci5pcy1zbGVlcGluZyIsCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLl9Jc1NsZWVwaW5nKCkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBwcm9wcy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogcHJlZml4ICsgIi5kZWJ1Z2dlci52ZWxvY2l0eS14IiwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuX0dldFZlbG9jaXR5WCgpLAogICAgICAgICAgICAgICAgICAgICAgICBvbmVkaXQ6IHYgPT4gdGhpcy5fU2V0VmVsb2NpdHkodiwgdGhpcy5fR2V0VmVsb2NpdHlZKCkpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgcHJvcHMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHByZWZpeCArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiLmRlYnVnZ2VyLnZlbG9jaXR5LXkiLAogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5fR2V0VmVsb2NpdHlZKCksCiAgICAgICAgICAgICAgICAgICAgICAgIG9uZWRpdDogdiA9PiB0aGlzLl9TZXRWZWxvY2l0eSh0aGlzLl9HZXRWZWxvY2l0eVgoKSwgdikKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBwcm9wcy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogcHJlZml4ICsgIi5kZWJ1Z2dlci5hbmd1bGFyLXZlbG9jaXR5IiwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IEMzLnRvRGVncmVlcyh0aGlzLl9HZXRBbmd1bGFyVmVsb2NpdHkoKSksCiAgICAgICAgICAgICAgICAgICAgICAgIG9uZWRpdDogdiA9PiB0aGlzLl9TZXRBbmd1bGFyVmVsb2NpdHkoQzMudG9SYWRpYW5zKHYpKQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIHByb3BzLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBwcmVmaXggKyAiLmRlYnVnZ2VyLm1hc3MiLAogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5fR2V0TWFzcygpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBbewogICAgICAgICAgICAgICAgICAgIHRpdGxlOiAiJCIgKyB0aGlzLkdldEJlaGF2aW9yVHlwZSgpLkdldE5hbWUoKSwKICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiBwcm9wcwogICAgICAgICAgICAgICAgfV0KICAgICAgICAgICAgfQogICAgICAgICAgICBfQXBwbHlGb3JjZShmeCwgZnksIGltZ1B0KSB7CiAgICAgICAgICAgICAgICBjb25zdCBbeCwgeV0gPSB0aGlzLl9HZXRJbnN0SW1hZ2VQb2ludChpbWdQdCk7CiAgICAgICAgICAgICAgICB0aGlzLl9Eb0FwcGx5Rm9yY2UoZngsIGZ5LCB4LCB5KQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9BcHBseUZvcmNlVG93YXJkKGYsCiAgICAgICAgICAgICAgICBweCwgcHksIGltZ1B0KSB7CiAgICAgICAgICAgICAgICBjb25zdCBbeCwgeV0gPSB0aGlzLl9HZXRJbnN0SW1hZ2VQb2ludChpbWdQdCk7CiAgICAgICAgICAgICAgICBjb25zdCBhID0gQzMuYW5nbGVUbyh4LCB5LCBweCwgcHkpOwogICAgICAgICAgICAgICAgdGhpcy5fRG9BcHBseUZvcmNlKE1hdGguY29zKGEpICogZiwgTWF0aC5zaW4oYSkgKiBmLCB4LCB5KQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9BcHBseUZvcmNlQXRBbmdsZShmLCBhLCBpbWdQdCkgewogICAgICAgICAgICAgICAgY29uc3QgW3gsIHldID0gdGhpcy5fR2V0SW5zdEltYWdlUG9pbnQoaW1nUHQpOwogICAgICAgICAgICAgICAgdGhpcy5fRG9BcHBseUZvcmNlKE1hdGguY29zKGEpICogZiwgTWF0aC5zaW4oYSkgKiBmLCB4LCB5KQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9Eb0FwcGx5Rm9yY2UoZngsIGZ5LCBveCwgb3kpIHsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5faXNFbmFibGVkKSByZXR1cm47CiAgICAgICAgICAgICAgICBjb25zdCB3b3JsZFNjYWxlID0gdGhpcy5fd29ybGRTY2FsZTsKICAgICAgICAgICAgICAgIHRoaXMuX2JvZHlbIkFwcGx5Rm9yY2UiXShHZXRUZW1wVmVjMkEoZngsIGZ5KSwgR2V0VGVtcFZlYzJCKG94ICogd29ybGRTY2FsZSwgb3kgKiB3b3JsZFNjYWxlKSwgdHJ1ZSkKICAgICAgICAgICAgfQogICAgICAgICAgICBfQXBwbHlJbXB1bHNlKGZ4LCBmeSwgaW1nUHQpIHsKICAgICAgICAgICAgICAgIGNvbnN0IFt4LCB5XSA9IHRoaXMuX0dldEluc3RJbWFnZVBvaW50KGltZ1B0KTsKICAgICAgICAgICAgICAgIHRoaXMuX0RvQXBwbHlJbXB1bHNlKGZ4LCBmeSwgeCwgeSkKICAgICAgICAgICAgfQogICAgICAgICAgICBfQXBwbHlJbXB1bHNlVG93YXJkKGYsIHB4LCBweSwgaW1nUHQpIHsKICAgICAgICAgICAgICAgIGNvbnN0IFt4LCB5XSA9IHRoaXMuX0dldEluc3RJbWFnZVBvaW50KGltZ1B0KTsKICAgICAgICAgICAgICAgIGNvbnN0IGEgPSBDMy5hbmdsZVRvKHgsIHksIHB4LCBweSk7CiAgICAgICAgICAgICAgICB0aGlzLl9Eb0FwcGx5SW1wdWxzZShNYXRoLmNvcyhhKSAqIGYsIE1hdGguc2luKGEpICogZiwgeCwgeSkKICAgICAgICAgICAgfQogICAgICAgICAgICBfQXBwbHlJbXB1bHNlQXRBbmdsZShmLCBhLCBpbWdQdCkgewogICAgICAgICAgICAgICAgY29uc3QgW3gsIHldID0gdGhpcy5fR2V0SW5zdEltYWdlUG9pbnQoaW1nUHQpOwogICAgICAgICAgICAgICAgdGhpcy5fRG9BcHBseUltcHVsc2UoTWF0aC5jb3MoYSkgKiBmLCBNYXRoLnNpbihhKSAqIGYsIHgsIHkpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX0RvQXBwbHlJbXB1bHNlKGZ4LCBmeSwgb3gsIG95KSB7CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX2lzRW5hYmxlZCkgcmV0dXJuOwogICAgICAgICAgICAgICAgY29uc3Qgd29ybGRTY2FsZSA9IHRoaXMuX3dvcmxkU2NhbGU7CiAgICAgICAgICAgICAgICB0aGlzLl9ib2R5WyJBcHBseUxpbmVhckltcHVsc2UiXShHZXRUZW1wVmVjMkEoZngsIGZ5KSwgR2V0VGVtcFZlYzJCKG94ICogd29ybGRTY2FsZSwgb3kgKiB3b3JsZFNjYWxlKSwKICAgICAgICAgICAgICAgICAgICB0cnVlKTsKICAgICAgICAgICAgICAgIGNvbnN0IHdpID0gdGhpcy5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgICAgIHRoaXMuX2xhc3RLbm93blggPSB3aS5HZXRYKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9sYXN0S25vd25ZID0gd2kuR2V0WSgpOwogICAgICAgICAgICAgICAgdGhpcy5fbGFzdFRpY2tPdmVycmlkZSA9IGZhbHNlCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX0FwcGx5VG9ycXVlKG0pIHsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5faXNFbmFibGVkKSByZXR1cm47CiAgICAgICAgICAgICAgICB0aGlzLl9ib2R5WyJBcHBseVRvcnF1ZSJdKG0sIHRydWUpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX0FwcGx5VG9ycXVlVG9BbmdsZShtLCBhKSB7CiAgICAgICAgICAgICAgICBjb25zdCBmID0gQzMuYW5nbGVDbG9ja3dpc2UodGhpcy5HZXRXb3JsZEluZm8oKS5HZXRBbmdsZSgpLCBhKSA/IC0xIDogMTsKICAgICAgICAgICAgICAgIHRoaXMuX0FwcGx5VG9ycXVlKG0gKiBmKQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9BcHBseVRvcnF1ZVRvUG9zaXRpb24obSwgeCwgeSkgewogICAgICAgICAgICAgICAgY29uc3Qgd2kgPSB0aGlzLkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICAgICAgY29uc3QgYSA9IEMzLmFuZ2xlVG8od2kuR2V0WCgpLCB3aS5HZXRZKCksIHgsIHkpOwogICAgICAgICAgICAgICAgY29uc3QgZiA9IEMzLmFuZ2xlQ2xvY2t3aXNlKHdpLkdldEFuZ2xlKCksIGEpID8gLTEgOiAxOwogICAgICAgICAgICAgICAgdGhpcy5fQXBwbHlUb3JxdWUobSAqIGYpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX1NldEFuZ3VsYXJWZWxvY2l0eSh2KSB7CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX2lzRW5hYmxlZCkgcmV0dXJuOwogICAgICAgICAgICAgICAgdGhpcy5fYm9keVsiU2V0QW5ndWxhclZlbG9jaXR5Il0odik7CiAgICAgICAgICAgICAgICB0aGlzLl9ib2R5WyJTZXRBd2FrZSJdKHRydWUpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX0dldEFuZ3VsYXJWZWxvY2l0eSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9pc0VuYWJsZWQgPyB0aGlzLl9ib2R5WyJHZXRBbmd1bGFyVmVsb2NpdHkiXSgpIDogMAogICAgICAgICAgICB9CiAgICAgICAgICAgIF9TZXRWZWxvY2l0eSh2eCwgdnkpIHsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5faXNFbmFibGVkKSByZXR1cm47CiAgICAgICAgICAgICAgICBjb25zdCB3b3JsZFNjYWxlID0gdGhpcy5fd29ybGRTY2FsZTsKICAgICAgICAgICAgICAgIHRoaXMuX2JvZHlbIlNldExpbmVhclZlbG9jaXR5Il0oR2V0VGVtcFZlYzJBKHZ4ICogd29ybGRTY2FsZSwgdnkgKiB3b3JsZFNjYWxlKSk7CiAgICAgICAgICAgICAgICB0aGlzLl9ib2R5WyJTZXRBd2FrZSJdKHRydWUpOwogICAgICAgICAgICAgICAgY29uc3Qgd2kgPSB0aGlzLkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICAgICAgdGhpcy5fbGFzdEtub3duWCA9IHdpLkdldFgoKTsKICAgICAgICAgICAgICAgIHRoaXMuX2xhc3RLbm93blkgPSB3aS5HZXRZKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9sYXN0VGlja092ZXJyaWRlID0gZmFsc2UKICAgICAgICAgICAgfQogICAgICAgICAgICBfR2V0VmVsb2NpdHkoKSB7CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX2lzRW5hYmxlZCkgcmV0dXJuIFswLCAwXTsKICAgICAgICAgICAgICAgIGNvbnN0IHdvcmxkU2NhbGUgPQogICAgICAgICAgICAgICAgICAgIHRoaXMuX3dvcmxkU2NhbGU7CiAgICAgICAgICAgICAgICBjb25zdCB2ZWMgPSB0aGlzLl9ib2R5WyJHZXRMaW5lYXJWZWxvY2l0eSJdKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gW3ZlY1siZ2V0X3giXSgpIC8gd29ybGRTY2FsZSwgdmVjWyJnZXRfeSJdKCkgLyB3b3JsZFNjYWxlXQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9HZXRWZWxvY2l0eVgoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5faXNFbmFibGVkID8gdGhpcy5fYm9keVsiR2V0TGluZWFyVmVsb2NpdHkiXSgpWyJnZXRfeCJdKCkgLyB0aGlzLl93b3JsZFNjYWxlIDogMAogICAgICAgICAgICB9CiAgICAgICAgICAgIF9HZXRWZWxvY2l0eVkoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5faXNFbmFibGVkID8gdGhpcy5fYm9keVsiR2V0TGluZWFyVmVsb2NpdHkiXSgpWyJnZXRfeSJdKCkgLyB0aGlzLl93b3JsZFNjYWxlIDogMAogICAgICAgICAgICB9CiAgICAgICAgICAgIF9TZXREZW5zaXR5KGQpIHsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5faXNFbmFibGVkKSByZXR1cm47CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fZGVuc2l0eSA9PT0gZCkgcmV0dXJuOwogICAgICAgICAgICAgICAgdGhpcy5fZGVuc2l0eSA9IGQ7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGZpeHR1cmUgb2YgdGhpcy5fZml4dHVyZXMpIGZpeHR1cmVbIlNldERlbnNpdHkiXShkKTsKICAgICAgICAgICAgICAgIHRoaXMuX2JvZHlbIlJlc2V0TWFzc0RhdGEiXSgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX0dldERlbnNpdHkoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5faXNFbmFibGVkID8KICAgICAgICAgICAgICAgICAgICB0aGlzLl9kZW5zaXR5IDogMAogICAgICAgICAgICB9CiAgICAgICAgICAgIF9TZXRGcmljdGlvbihmKSB7CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX2lzRW5hYmxlZCkgcmV0dXJuOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuX2ZyaWN0aW9uID09PSBmKSByZXR1cm47CiAgICAgICAgICAgICAgICB0aGlzLl9mcmljdGlvbiA9IGY7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGZpeHR1cmUgb2YgdGhpcy5fZml4dHVyZXMpIGZpeHR1cmVbIlNldEZyaWN0aW9uIl0oZik7CiAgICAgICAgICAgICAgICBmb3IgKGxldCBjb250YWN0RWRnZSA9IHRoaXMuX2JvZHlbIkdldENvbnRhY3RMaXN0Il0oKTsgdGhpcy5fYm94MmRbImdldFBvaW50ZXIiXShjb250YWN0RWRnZSk7IGNvbnRhY3RFZGdlID0gY29udGFjdEVkZ2VbImdldF9uZXh0Il0oKSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbnRhY3QgPSBjb250YWN0RWRnZVsiZ2V0X2NvbnRhY3QiXSgpOwogICAgICAgICAgICAgICAgICAgIGlmIChjb250YWN0KSBjb250YWN0WyJSZXNldEZyaWN0aW9uIl0oKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9HZXRGcmljdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9pc0VuYWJsZWQgPyB0aGlzLl9mcmljdGlvbiA6IDAKICAgICAgICAgICAgfQogICAgICAgICAgICBfU2V0RWxhc3RpY2l0eShlKSB7CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX2lzRW5hYmxlZCkgcmV0dXJuOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuX3Jlc3RpdHV0aW9uID09PQogICAgICAgICAgICAgICAgICAgIGUpIHJldHVybjsKICAgICAgICAgICAgICAgIHRoaXMuX3Jlc3RpdHV0aW9uID0gZTsKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgZml4dHVyZSBvZiB0aGlzLl9maXh0dXJlcykgZml4dHVyZVsiU2V0UmVzdGl0dXRpb24iXShlKQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9HZXRFbGFzdGljaXR5KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2lzRW5hYmxlZCA/IHRoaXMuX3Jlc3RpdHV0aW9uIDogMAogICAgICAgICAgICB9CiAgICAgICAgICAgIF9TZXRMaW5lYXJEYW1waW5nKGxkKSB7CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX2lzRW5hYmxlZCkgcmV0dXJuOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuX2xpbmVhckRhbXBpbmcgPT09IGxkKSByZXR1cm47CiAgICAgICAgICAgICAgICB0aGlzLl9saW5lYXJEYW1waW5nID0gbGQ7CiAgICAgICAgICAgICAgICB0aGlzLl9ib2R5WyJTZXRMaW5lYXJEYW1waW5nIl0obGQpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX0dldExpbmVhckRhbXBpbmcoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5faXNFbmFibGVkID8gdGhpcy5fbGluZWFyRGFtcGluZyA6IDAKICAgICAgICAgICAgfQogICAgICAgICAgICBfU2V0QW5ndWxhckRhbXBpbmcoYWQpIHsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5faXNFbmFibGVkKSByZXR1cm47CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fYW5ndWxhckRhbXBpbmcgPT09IGFkKSByZXR1cm47CiAgICAgICAgICAgICAgICB0aGlzLl9hbmd1bGFyRGFtcGluZyA9IGFkOwogICAgICAgICAgICAgICAgdGhpcy5fYm9keVsiU2V0QW5ndWxhckRhbXBpbmciXShhZCkKICAgICAgICAgICAgfQogICAgICAgICAgICBfR2V0QW5ndWxhckRhbXBpbmcoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5faXNFbmFibGVkID8KICAgICAgICAgICAgICAgICAgICB0aGlzLl9hbmd1bGFyRGFtcGluZyA6IDAKICAgICAgICAgICAgfQogICAgICAgICAgICBfU2V0SW1tb3ZhYmxlKGkpIHsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5faXNFbmFibGVkKSByZXR1cm47CiAgICAgICAgICAgICAgICBpID0gISFpOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuX2lzSW1tb3ZhYmxlID09PSBpKSByZXR1cm47CiAgICAgICAgICAgICAgICB0aGlzLl9pc0ltbW92YWJsZSA9IGk7CiAgICAgICAgICAgICAgICB0aGlzLl9ib2R5WyJTZXRUeXBlIl0odGhpcy5faXNJbW1vdmFibGUgPyAwIDogMik7CiAgICAgICAgICAgICAgICB0aGlzLl9ib2R5WyJTZXRBd2FrZSJdKHRydWUpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX0lzSW1tb3ZhYmxlKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2lzSW1tb3ZhYmxlCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX1NldFByZXZlbnRSb3RhdGUoaSkgewogICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9pc0VuYWJsZWQpIHJldHVybjsKICAgICAgICAgICAgICAgIGkgPSAhIWk7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fcHJldmVudFJvdGF0aW9uID09PSBpKSByZXR1cm47CiAgICAgICAgICAgICAgICB0aGlzLl9wcmV2ZW50Um90YXRpb24gPSBpOwogICAgICAgICAgICAgICAgdGhpcy5fYm9keVsiU2V0Rml4ZWRSb3RhdGlvbiJdKHRoaXMuX3ByZXZlbnRSb3RhdGlvbik7CiAgICAgICAgICAgICAgICB0aGlzLl9ib2R5WyJTZXRBbmd1bGFyVmVsb2NpdHkiXSgwKTsKICAgICAgICAgICAgICAgIHRoaXMuX2JvZHlbIlNldEF3YWtlIl0odHJ1ZSkKICAgICAgICAgICAgfQogICAgICAgICAgICBfSXNQcmV2ZW50Um90YXRlKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3ByZXZlbnRSb3RhdGlvbgogICAgICAgICAgICB9CiAgICAgICAgICAgIF9TZXRCdWxsZXQoaSkgewogICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9pc0VuYWJsZWQpIHJldHVybjsKICAgICAgICAgICAgICAgIGkgPSAhIWk7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5faXNCdWxsZXQgPT09IGkpIHJldHVybjsKICAgICAgICAgICAgICAgIHRoaXMuX2lzQnVsbGV0ID0gaTsKICAgICAgICAgICAgICAgIHRoaXMuX2JvZHlbIlNldEJ1bGxldCJdKHRoaXMuX2lzQnVsbGV0KTsKICAgICAgICAgICAgICAgIHRoaXMuX2JvZHlbIlNldEF3YWtlIl0odHJ1ZSkKICAgICAgICAgICAgfQogICAgICAgICAgICBfSXNCdWxsZXQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5faXNCdWxsZXQKICAgICAgICAgICAgfQogICAgICAgICAgICBfR2V0TWFzcygpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9pc0VuYWJsZWQgPyB0aGlzLl9ib2R5WyJHZXRNYXNzIl0oKSAvIHRoaXMuX3dvcmxkU2NhbGUgOiAwCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX0dldENlbnRlck9mTWFzc1goKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5faXNFbmFibGVkID8gKHRoaXMuX2JvZHlbIkdldFBvc2l0aW9uIl0oKVsiZ2V0X3giXSgpICsgdGhpcy5fYm9keVsiR2V0TG9jYWxDZW50ZXIiXSgpWyJnZXRfeCJdKCkpIC8gdGhpcy5fd29ybGRTY2FsZSA6IDAKICAgICAgICAgICAgfQogICAgICAgICAgICBfR2V0Q2VudGVyT2ZNYXNzWSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9pc0VuYWJsZWQgPyAodGhpcy5fYm9keVsiR2V0UG9zaXRpb24iXSgpWyJnZXRfeSJdKCkgKyB0aGlzLl9ib2R5WyJHZXRMb2NhbENlbnRlciJdKClbImdldF95Il0oKSkgLwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3dvcmxkU2NhbGUgOiAwCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX0dldENlbnRlck9mTWFzcygpIHsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5faXNFbmFibGVkKSByZXR1cm4gWzAsIDBdOwogICAgICAgICAgICAgICAgY29uc3QgcG9zVmVjID0gdGhpcy5fYm9keVsiR2V0UG9zaXRpb24iXSgpOwogICAgICAgICAgICAgICAgY29uc3QgY2VudGVyVmVjID0gdGhpcy5fYm9keVsiR2V0TG9jYWxDZW50ZXIiXSgpOwogICAgICAgICAgICAgICAgY29uc3Qgd29ybGRTY2FsZSA9IHRoaXMuX3dvcmxkU2NhbGU7CiAgICAgICAgICAgICAgICByZXR1cm4gWyhwb3NWZWNbImdldF94Il0oKSArIGNlbnRlclZlY1siZ2V0X3giXSgpKSAvIHdvcmxkU2NhbGUsIChwb3NWZWNbImdldF95Il0oKSArIGNlbnRlclZlY1siZ2V0X3kiXSgpKSAvIHdvcmxkU2NhbGVdCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX0lzU2xlZXBpbmcoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5faXNFbmFibGVkID8gIXRoaXMuX2JvZHlbIklzQXdha2UiXSgpIDogZmFsc2UKICAgICAgICAgICAgfQogICAgICAgICAgICBfR2V0Q29udGFjdENvdW50KCkgewogICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9pc0VuYWJsZWQpIHJldHVybiAwOwogICAgICAgICAgICAgICAgbGV0IGNvdW50ID0gMDsKICAgICAgICAgICAgICAgIGZvciAobGV0IGNvbnRhY3RFZGdlID0gdGhpcy5fYm9keVsiR2V0Q29udGFjdExpc3QiXSgpOyB0aGlzLl9ib3gyZFsiZ2V0UG9pbnRlciJdKGNvbnRhY3RFZGdlKTsgY29udGFjdEVkZ2UgPQogICAgICAgICAgICAgICAgICAgIGNvbnRhY3RFZGdlWyJnZXRfbmV4dCJdKCkpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBjb250YWN0ID0gY29udGFjdEVkZ2VbImdldF9jb250YWN0Il0oKTsKICAgICAgICAgICAgICAgICAgICBpZiAoIWNvbnRhY3QpIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IG1hbmlmb2xkID0gY29udGFjdFsiR2V0TWFuaWZvbGQiXSgpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHBvaW50Q291bnQgPSBtYW5pZm9sZFsiZ2V0X3BvaW50Q291bnQiXSgpOwogICAgICAgICAgICAgICAgICAgIGNvdW50ICs9IHBvaW50Q291bnQKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBjb3VudAogICAgICAgICAgICB9CiAgICAgICAgICAgIF9HZXRDb250YWN0UG9zaXRpb25BdChpbmRleCkgewogICAgICAgICAgICAgICAgaW5kZXggPSBNYXRoLmZsb29yKGluZGV4KTsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5faXNFbmFibGVkKSByZXR1cm4gWzAsIDBdOwogICAgICAgICAgICAgICAgbGV0IGNvdW50ID0gMDsKICAgICAgICAgICAgICAgIGZvciAobGV0IGNvbnRhY3RFZGdlID0gdGhpcy5fYm9keVsiR2V0Q29udGFjdExpc3QiXSgpOyB0aGlzLl9ib3gyZFsiZ2V0UG9pbnRlciJdKGNvbnRhY3RFZGdlKTsgY29udGFjdEVkZ2UgPSBjb250YWN0RWRnZVsiZ2V0X25leHQiXSgpKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29udGFjdCA9IGNvbnRhY3RFZGdlWyJnZXRfY29udGFjdCJdKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFjb250YWN0KSBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBtYW5pZm9sZCA9CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhY3RbIkdldE1hbmlmb2xkIl0oKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBwb2ludENvdW50ID0gbWFuaWZvbGRbImdldF9wb2ludENvdW50Il0oKTsKICAgICAgICAgICAgICAgICAgICBpZiAoaW5kZXggPj0gY291bnQgJiYgaW5kZXggPCBjb3VudCArIHBvaW50Q291bnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaSA9IGluZGV4IC0gY291bnQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHdvcmxkTWFuaWZvbGQgPSB0aGlzLkdldEJlaGF2aW9yKCkuR2V0V29ybGRNYW5pZm9sZCgpOwogICAgICAgICAgICAgICAgICAgICAgICBjb250YWN0WyJHZXRXb3JsZE1hbmlmb2xkIl0od29ybGRNYW5pZm9sZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHZlYyA9IHdvcmxkTWFuaWZvbGRbImdldF9wb2ludHMiXShpKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFt2ZWNbImdldF94Il0oKSAvIHRoaXMuX3dvcmxkU2NhbGUsIHZlY1siZ2V0X3kiXSgpIC8gdGhpcy5fd29ybGRTY2FsZV0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgY291bnQgKz0gcG9pbnRDb3VudAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIFswLCAwXQogICAgICAgICAgICB9CiAgICAgICAgICAgIEdldFNjcmlwdEludGVyZmFjZUNsYXNzKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuSVBoeXNpY3NCZWhhdmlvckluc3RhbmNlCiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIGNvbnN0IG1hcCA9IG5ldyBXZWFrTWFwOwoKICAgICAgICBmdW5jdGlvbiBVbndyYXBJV29ybGRJbnN0YW5jZSh0aGlzXywKICAgICAgICAgICAgaWluc3QpIHsKICAgICAgICAgICAgY29uc3QgcnVudGltZSA9IG1hcC5nZXQodGhpc18pLkdldFJ1bnRpbWUoKTsKICAgICAgICAgICAgcmV0dXJuIHJ1bnRpbWUuX1Vud3JhcElXb3JsZEluc3RhbmNlKGlpbnN0KQogICAgICAgIH0KICAgICAgICBzZWxmLklQaHlzaWNzQmVoYXZpb3JJbnN0YW5jZSA9IGNsYXNzIElQaHlzaWNzQmVoYXZpb3JJbnN0YW5jZSBleHRlbmRzIElCZWhhdmlvckluc3RhbmNlIHsKICAgICAgICAgICAgY29uc3RydWN0b3IoKSB7CiAgICAgICAgICAgICAgICBzdXBlcigpOwogICAgICAgICAgICAgICAgbWFwLnNldCh0aGlzLCBJQmVoYXZpb3JJbnN0YW5jZS5fR2V0SW5pdEluc3QoKS5HZXRTZGtJbnN0YW5jZSgpKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGdldCBpc0VuYWJsZWQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbWFwLmdldCh0aGlzKS5fSXNFbmFibGVkKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBzZXQgaXNFbmFibGVkKGUpIHsKICAgICAgICAgICAgICAgIG1hcC5nZXQodGhpcykuX1NldEVuYWJsZWQoZSkKICAgICAgICAgICAgfQogICAgICAgICAgICBhcHBseUZvcmNlKGZ4LCBmeSwgaW1nUHQgPSAwKSB7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcihmeCk7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcihmeSk7CiAgICAgICAgICAgICAgICBtYXAuZ2V0KHRoaXMpLl9BcHBseUZvcmNlKGZ4LCBmeSwgaW1nUHQpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgYXBwbHlGb3JjZVRvd2FyZFBvc2l0aW9uKGYsCiAgICAgICAgICAgICAgICBweCwgcHksIGltZ1B0ID0gMCkgewogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVGaW5pdGVOdW1iZXIoZik7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcihweCk7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcihweSk7CiAgICAgICAgICAgICAgICBtYXAuZ2V0KHRoaXMpLl9BcHBseUZvcmNlVG93YXJkKGYsIHB4LCBweSwgaW1nUHQpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgYXBwbHlGb3JjZUF0QW5nbGUoZiwgYSwgaW1nUHQgPSAwKSB7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcihmKTsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlRmluaXRlTnVtYmVyKGEpOwogICAgICAgICAgICAgICAgbWFwLmdldCh0aGlzKS5fQXBwbHlGb3JjZUF0QW5nbGUoZiwgYSwgaW1nUHQpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgYXBwbHlJbXB1bHNlKGl4LCBpeSwgaW1nUHQgPSAwKSB7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcihpeCk7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcihpeSk7CiAgICAgICAgICAgICAgICBtYXAuZ2V0KHRoaXMpLl9BcHBseUltcHVsc2UoaXgsIGl5LCBpbWdQdCkKICAgICAgICAgICAgfQogICAgICAgICAgICBhcHBseUltcHVsc2VUb3dhcmRQb3NpdGlvbihpLCBweCwgcHksIGltZ1B0ID0gMCkgewogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVGaW5pdGVOdW1iZXIoaSk7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcihweCk7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcihweSk7CiAgICAgICAgICAgICAgICBtYXAuZ2V0KHRoaXMpLl9BcHBseUltcHVsc2VUb3dhcmQoaSwgcHgsIHB5LCBpbWdQdCkKICAgICAgICAgICAgfQogICAgICAgICAgICBhcHBseUltcHVsc2VBdEFuZ2xlKGksIGEsIGltZ1B0ID0gMCkgewogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVGaW5pdGVOdW1iZXIoaSk7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcihhKTsKICAgICAgICAgICAgICAgIG1hcC5nZXQodGhpcykuX0FwcGx5SW1wdWxzZUF0QW5nbGUoaSwgYSwgaW1nUHQpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgYXBwbHlUb3JxdWUobSkgewogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVGaW5pdGVOdW1iZXIobSk7CiAgICAgICAgICAgICAgICBtYXAuZ2V0KHRoaXMpLl9BcHBseVRvcnF1ZShtKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGFwcGx5VG9ycXVlVG9BbmdsZShtLCBhKSB7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcihtKTsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlRmluaXRlTnVtYmVyKGEpOwogICAgICAgICAgICAgICAgbWFwLmdldCh0aGlzKS5fQXBwbHlUb3JxdWVUb0FuZ2xlKG0sIGEpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgYXBwbHlUb3JxdWVUb1Bvc2l0aW9uKG0sIHB4LCBweSkgewogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVGaW5pdGVOdW1iZXIobSk7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcihweCk7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcihweSk7CiAgICAgICAgICAgICAgICBtYXAuZ2V0KHRoaXMpLl9BcHBseVRvcnF1ZVRvUG9zaXRpb24obSwKICAgICAgICAgICAgICAgICAgICBweCwgcHkpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2V0IGFuZ3VsYXJWZWxvY2l0eSh2KSB7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcih2KTsKICAgICAgICAgICAgICAgIG1hcC5nZXQodGhpcykuX1NldEFuZ3VsYXJWZWxvY2l0eSh2KQogICAgICAgICAgICB9CiAgICAgICAgICAgIGdldCBhbmd1bGFyVmVsb2NpdHkoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbWFwLmdldCh0aGlzKS5fR2V0QW5ndWxhclZlbG9jaXR5KCkKICAgICAgICAgICAgfQogICAgICAgICAgICBzZXRWZWxvY2l0eSh2eCwgdnkpIHsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlRmluaXRlTnVtYmVyKHZ4KTsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlRmluaXRlTnVtYmVyKHZ5KTsKICAgICAgICAgICAgICAgIG1hcC5nZXQodGhpcykuX1NldFZlbG9jaXR5KHZ4LCB2eSkKICAgICAgICAgICAgfQogICAgICAgICAgICBnZXRWZWxvY2l0eVgoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbWFwLmdldCh0aGlzKS5fR2V0VmVsb2NpdHlYKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBnZXRWZWxvY2l0eVkoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbWFwLmdldCh0aGlzKS5fR2V0VmVsb2NpdHlZKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBnZXRWZWxvY2l0eSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBtYXAuZ2V0KHRoaXMpLl9HZXRWZWxvY2l0eSgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2V0IGRlbnNpdHkoZCkgewogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVGaW5pdGVOdW1iZXIoZCk7CiAgICAgICAgICAgICAgICBtYXAuZ2V0KHRoaXMpLl9TZXREZW5zaXR5KGQpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZ2V0IGRlbnNpdHkoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbWFwLmdldCh0aGlzKS5fR2V0RGVuc2l0eSgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2V0IGZyaWN0aW9uKGYpIHsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlRmluaXRlTnVtYmVyKGYpOwogICAgICAgICAgICAgICAgbWFwLmdldCh0aGlzKS5fU2V0RnJpY3Rpb24oZikKICAgICAgICAgICAgfQogICAgICAgICAgICBnZXQgZnJpY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbWFwLmdldCh0aGlzKS5fR2V0RnJpY3Rpb24oKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHNldCBlbGFzdGljaXR5KGUpIHsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlRmluaXRlTnVtYmVyKGUpOwogICAgICAgICAgICAgICAgbWFwLmdldCh0aGlzKS5fU2V0RWxhc3RpY2l0eShlKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGdldCBlbGFzdGljaXR5KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIG1hcC5nZXQodGhpcykuX0dldEVsYXN0aWNpdHkoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHNldCBsaW5lYXJEYW1waW5nKGxkKSB7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcihsZCk7CiAgICAgICAgICAgICAgICBtYXAuZ2V0KHRoaXMpLl9TZXRMaW5lYXJEYW1waW5nKGxkKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGdldCBsaW5lYXJEYW1waW5nKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIG1hcC5nZXQodGhpcykuX0dldExpbmVhckRhbXBpbmcoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHNldCBhbmd1bGFyRGFtcGluZyhhZCkgewogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVGaW5pdGVOdW1iZXIoYWQpOwogICAgICAgICAgICAgICAgbWFwLmdldCh0aGlzKS5fU2V0QW5ndWxhckRhbXBpbmcoYWQpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZ2V0IGFuZ3VsYXJEYW1waW5nKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIG1hcC5nZXQodGhpcykuX0dldEFuZ3VsYXJEYW1waW5nKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBzZXQgaXNJbW1vdmFibGUoaSkgewogICAgICAgICAgICAgICAgbWFwLmdldCh0aGlzKS5fU2V0SW1tb3ZhYmxlKGkpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZ2V0IGlzSW1tb3ZhYmxlKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIG1hcC5nZXQodGhpcykuX0lzSW1tb3ZhYmxlKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBzZXQgaXNQcmV2ZW50Um90YXRpb24ocCkgewogICAgICAgICAgICAgICAgbWFwLmdldCh0aGlzKS5fU2V0UHJldmVudFJvdGF0ZShwKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGdldCBpc1ByZXZlbnRSb3RhdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBtYXAuZ2V0KHRoaXMpLl9Jc1ByZXZlbnRSb3RhdGUoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHNldCBpc0J1bGxldChiKSB7CiAgICAgICAgICAgICAgICBtYXAuZ2V0KHRoaXMpLl9TZXRCdWxsZXQoYikKICAgICAgICAgICAgfQogICAgICAgICAgICBnZXQgaXNCdWxsZXQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbWFwLmdldCh0aGlzKS5fSXNCdWxsZXQoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGdldCBtYXNzKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIG1hcC5nZXQodGhpcykuX0dldE1hc3MoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGdldENlbnRlck9mTWFzc1goKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbWFwLmdldCh0aGlzKS5fR2V0Q2VudGVyT2ZNYXNzWCgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZ2V0Q2VudGVyT2ZNYXNzWSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBtYXAuZ2V0KHRoaXMpLl9HZXRDZW50ZXJPZk1hc3NZKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBnZXRDZW50ZXJPZk1hc3MoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbWFwLmdldCh0aGlzKS5fR2V0Q2VudGVyT2ZNYXNzKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBnZXRDb250YWN0Q291bnQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbWFwLmdldCh0aGlzKS5fR2V0Q29udGFjdENvdW50KCkKICAgICAgICAgICAgfQogICAgICAgICAgICBnZXRDb250YWN0WChpbmRleCkgewogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVGaW5pdGVOdW1iZXIoaW5kZXgpOwogICAgICAgICAgICAgICAgcmV0dXJuIG1hcC5nZXQodGhpcykuX0dldENvbnRhY3RQb3NpdGlvbkF0KGluZGV4KVswXQogICAgICAgICAgICB9CiAgICAgICAgICAgIGdldENvbnRhY3RZKGluZGV4KSB7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcihpbmRleCk7CiAgICAgICAgICAgICAgICByZXR1cm4gbWFwLmdldCh0aGlzKS5fR2V0Q29udGFjdFBvc2l0aW9uQXQoaW5kZXgpWzFdCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZ2V0Q29udGFjdChpbmRleCkgewogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVGaW5pdGVOdW1iZXIoaW5kZXgpOwogICAgICAgICAgICAgICAgcmV0dXJuIG1hcC5nZXQodGhpcykuX0dldENvbnRhY3RQb3NpdGlvbkF0KGluZGV4KQogICAgICAgICAgICB9CiAgICAgICAgICAgIGdldCBpc1NsZWVwaW5nKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIG1hcC5nZXQodGhpcykuX0lzU2xlZXBpbmcoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNyZWF0ZURpc3RhbmNlSm9pbnQoaW1nUHQsIGlPdGhlckluc3QsIG90aGVySW1nUHQsIGRhbXBpbmcsIGZyZXEpIHsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlRmluaXRlTnVtYmVyKGRhbXBpbmcpOwogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVGaW5pdGVOdW1iZXIoZnJlcSk7CiAgICAgICAgICAgICAgICBjb25zdCBvdGhlckluc3QgPSBVbndyYXBJV29ybGRJbnN0YW5jZSh0aGlzLCBpT3RoZXJJbnN0KTsKICAgICAgICAgICAgICAgIG1hcC5nZXQodGhpcykuX0NyZWF0ZURpc3RhbmNlSm9pbnQoaW1nUHQsCiAgICAgICAgICAgICAgICAgICAgb3RoZXJJbnN0LCBvdGhlckltZ1B0LCBkYW1waW5nLCBmcmVxKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNyZWF0ZVJldm9sdXRlSm9pbnQoaW1nUHQsIGlPdGhlckluc3QpIHsKICAgICAgICAgICAgICAgIGNvbnN0IG90aGVySW5zdCA9IFVud3JhcElXb3JsZEluc3RhbmNlKHRoaXMsIGlPdGhlckluc3QpOwogICAgICAgICAgICAgICAgbWFwLmdldCh0aGlzKS5fQ3JlYXRlUmV2b2x1dGVKb2ludChpbWdQdCwgb3RoZXJJbnN0KQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNyZWF0ZUxpbWl0ZWRSZXZvbHV0ZUpvaW50KGltZ1B0LCBpT3RoZXJJbnN0LCBsb3dlciwgdXBwZXIpIHsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlRmluaXRlTnVtYmVyKGxvd2VyKTsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlRmluaXRlTnVtYmVyKHVwcGVyKTsKICAgICAgICAgICAgICAgIGNvbnN0IG90aGVySW5zdCA9IFVud3JhcElXb3JsZEluc3RhbmNlKHRoaXMsIGlPdGhlckluc3QpOwogICAgICAgICAgICAgICAgbWFwLmdldCh0aGlzKS5fQ3JlYXRlTGltaXRlZFJldm9sdXRlSm9pbnQoaW1nUHQsIG90aGVySW5zdCwgbG93ZXIsIHVwcGVyKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNyZWF0ZVByaXNtYXRpY0pvaW50KGltZ1B0LCBpT3RoZXJJbnN0LCBheGlzQW5nbGUsIGVuYWJsZUxpbWl0LCBsb3dlclRyYW5zbGF0aW9uLCB1cHBlclRyYW5zbGF0aW9uLAogICAgICAgICAgICAgICAgZW5hYmxlTW90b3IsIG1vdG9yU3BlZWQsIG1heE1vdG9yRm9yY2UpIHsKICAgICAgICAgICAgICAgIGNvbnN0IG90aGVySW5zdCA9IFVud3JhcElXb3JsZEluc3RhbmNlKHRoaXMsIGlPdGhlckluc3QpOwogICAgICAgICAgICAgICAgbWFwLmdldCh0aGlzKS5fQ3JlYXRlUHJpc21hdGljSm9pbnQoaW1nUHQsIG90aGVySW5zdCwgYXhpc0FuZ2xlLCBlbmFibGVMaW1pdCwgbG93ZXJUcmFuc2xhdGlvbiwgdXBwZXJUcmFuc2xhdGlvbiwgZW5hYmxlTW90b3IsIG1vdG9yU3BlZWQsIG1heE1vdG9yRm9yY2UpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmVtb3ZlQWxsSm9pbnRzKCkgewogICAgICAgICAgICAgICAgbWFwLmdldCh0aGlzKS5fUmVtb3ZlSm9pbnRzKCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gewogICAgICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgICAgICBDMy5CZWhhdmlvcnMuUGh5c2ljcy5DbmRzID0gewogICAgICAgICAgICBJc1NsZWVwaW5nKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX0lzU2xlZXBpbmcoKQogICAgICAgICAgICB9LAogICAgICAgICAgICBDb21wYXJlVmVsb2NpdHkod2hpY2gsIGNtcCwgeCkgewogICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9pc0VuYWJsZWQpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIGxldCB2YWx1ZSA9IDA7CiAgICAgICAgICAgICAgICBpZiAod2hpY2ggPT09IDApIHZhbHVlID0gdGhpcy5fR2V0VmVsb2NpdHlYKCk7CiAgICAgICAgICAgICAgICBlbHNlIGlmICh3aGljaCA9PT0gMSkgdmFsdWUgPSB0aGlzLl9HZXRWZWxvY2l0eVkoKTsKICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IFt2eCwgdnldID0gdGhpcy5fR2V0VmVsb2NpdHkoKTsKICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IE1hdGguaHlwb3QodngsIHZ5KQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIEMzLmNvbXBhcmUodmFsdWUsIGNtcCwgeCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgQ29tcGFyZUFuZ3VsYXJWZWxvY2l0eShjbXAsIHgpIHsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5faXNFbmFibGVkKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICBjb25zdCBhdiA9IEMzLnRvRGVncmVlcyh0aGlzLl9HZXRBbmd1bGFyVmVsb2NpdHkoKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gQzMuY29tcGFyZShhdiwgY21wLCB4KQogICAgICAgICAgICB9LAogICAgICAgICAgICBDb21wYXJlTWFzcyhjbXAsIHgpIHsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5faXNFbmFibGVkKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICBjb25zdCBtYXNzID0gdGhpcy5fR2V0TWFzcygpOwogICAgICAgICAgICAgICAgcmV0dXJuIEMzLmNvbXBhcmUobWFzcywgY21wLCB4KQogICAgICAgICAgICB9LAogICAgICAgICAgICBJc0VuYWJsZWQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fSXNFbmFibGVkKCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gewogICAgICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgICAgICBDMy5CZWhhdmlvcnMuUGh5c2ljcy5BY3RzID0gewogICAgICAgICAgICBBcHBseUZvcmNlKGZ4LCBmeSwgaW1nUHQpIHsKICAgICAgICAgICAgICAgIHRoaXMuX0FwcGx5Rm9yY2UoZngsIGZ5LCBpbWdQdCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgQXBwbHlGb3JjZVRvd2FyZChmLCBweCwgcHksIGltZ1B0KSB7CiAgICAgICAgICAgICAgICB0aGlzLl9BcHBseUZvcmNlVG93YXJkKGYsIHB4LCBweSwgaW1nUHQpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIEFwcGx5Rm9yY2VBdEFuZ2xlKGYsIGEsIGltZ1B0KSB7CiAgICAgICAgICAgICAgICB0aGlzLl9BcHBseUZvcmNlQXRBbmdsZShmLCBDMy50b1JhZGlhbnMoYSksIGltZ1B0KQogICAgICAgICAgICB9LAogICAgICAgICAgICBBcHBseUltcHVsc2UoZngsIGZ5LCBpbWdQdCkgewogICAgICAgICAgICAgICAgdGhpcy5fQXBwbHlJbXB1bHNlKGZ4LCBmeSwgaW1nUHQpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIEFwcGx5SW1wdWxzZVRvd2FyZChmLCBweCwgcHksIGltZ1B0KSB7CiAgICAgICAgICAgICAgICB0aGlzLl9BcHBseUltcHVsc2VUb3dhcmQoZiwgcHgsIHB5LCBpbWdQdCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgQXBwbHlJbXB1bHNlQXRBbmdsZShmLCBhLCBpbWdQdCkgewogICAgICAgICAgICAgICAgdGhpcy5fQXBwbHlJbXB1bHNlQXRBbmdsZShmLCBDMy50b1JhZGlhbnMoYSksIGltZ1B0KQogICAgICAgICAgICB9LAogICAgICAgICAgICBBcHBseVRvcnF1ZShtKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9BcHBseVRvcnF1ZShDMy50b1JhZGlhbnMobSkpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIEFwcGx5VG9ycXVlVG9BbmdsZShtLCBhKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9BcHBseVRvcnF1ZVRvQW5nbGUoQzMudG9SYWRpYW5zKG0pLCBDMy50b1JhZGlhbnMoYSkpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIEFwcGx5VG9ycXVlVG9Qb3NpdGlvbihtLCB4LCB5KSB7CiAgICAgICAgICAgICAgICB0aGlzLl9BcHBseVRvcnF1ZVRvUG9zaXRpb24oQzMudG9SYWRpYW5zKG0pLCB4LCB5KQogICAgICAgICAgICB9LAogICAgICAgICAgICBTZXRBbmd1bGFyVmVsb2NpdHkodikgewogICAgICAgICAgICAgICAgdGhpcy5fU2V0QW5ndWxhclZlbG9jaXR5KEMzLnRvUmFkaWFucyh2KSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgQ3JlYXRlRGlzdGFuY2VKb2ludChpbWdQdCwgb2JqZWN0Q2xhc3MsIG90aGVySW1nUHQsIGRhbXBpbmcsIGZyZXEpIHsKICAgICAgICAgICAgICAgIGlmICghb2JqZWN0Q2xhc3MpIHJldHVybjsKICAgICAgICAgICAgICAgIGNvbnN0IG90aGVySW5zdCA9IG9iamVjdENsYXNzLkdldEZpcnN0UGlja2VkKHRoaXMuX2luc3QpOwogICAgICAgICAgICAgICAgdGhpcy5fQ3JlYXRlRGlzdGFuY2VKb2ludChpbWdQdCwgb3RoZXJJbnN0LCBvdGhlckltZ1B0LCBkYW1waW5nLCBmcmVxKQogICAgICAgICAgICB9LAogICAgICAgICAgICBDcmVhdGVSZXZvbHV0ZUpvaW50KGltZ1B0LCBvYmplY3RDbGFzcykgewogICAgICAgICAgICAgICAgaWYgKCFvYmplY3RDbGFzcykgcmV0dXJuOwogICAgICAgICAgICAgICAgY29uc3Qgb3RoZXJJbnN0ID0KICAgICAgICAgICAgICAgICAgICBvYmplY3RDbGFzcy5HZXRGaXJzdFBpY2tlZCh0aGlzLl9pbnN0KTsKICAgICAgICAgICAgICAgIHRoaXMuX0NyZWF0ZVJldm9sdXRlSm9pbnQoaW1nUHQsIG90aGVySW5zdCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgQ3JlYXRlTGltaXRlZFJldm9sdXRlSm9pbnQoaW1nUHQsIG9iamVjdENsYXNzLCBsb3dlciwgdXBwZXIpIHsKICAgICAgICAgICAgICAgIGlmICghb2JqZWN0Q2xhc3MpIHJldHVybjsKICAgICAgICAgICAgICAgIGNvbnN0IG90aGVySW5zdCA9IG9iamVjdENsYXNzLkdldEZpcnN0UGlja2VkKHRoaXMuX2luc3QpOwogICAgICAgICAgICAgICAgdGhpcy5fQ3JlYXRlTGltaXRlZFJldm9sdXRlSm9pbnQoaW1nUHQsIG90aGVySW5zdCwgQzMudG9SYWRpYW5zKGxvd2VyKSwgQzMudG9SYWRpYW5zKHVwcGVyKSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgQ3JlYXRlUHJpc21hdGljSm9pbnQoaW1nUHQsIG9iamVjdENsYXNzLCBheGlzQW5nbGUsIGVuYWJsZUxpbWl0LCBsb3dlclRyYW5zbGF0aW9uLCB1cHBlclRyYW5zbGF0aW9uLCBlbmFibGVNb3RvciwgbW90b3JTcGVlZCwgbWF4TW90b3JGb3JjZSkgewogICAgICAgICAgICAgICAgaWYgKCFvYmplY3RDbGFzcykgcmV0dXJuOwogICAgICAgICAgICAgICAgY29uc3Qgb3RoZXJJbnN0ID0gb2JqZWN0Q2xhc3MuR2V0Rmlyc3RQaWNrZWQodGhpcy5faW5zdCk7CiAgICAgICAgICAgICAgICB0aGlzLl9DcmVhdGVQcmlzbWF0aWNKb2ludChpbWdQdCwgb3RoZXJJbnN0LCBDMy50b1JhZGlhbnMoYXhpc0FuZ2xlKSwgZW5hYmxlTGltaXQsIGxvd2VyVHJhbnNsYXRpb24sIHVwcGVyVHJhbnNsYXRpb24sIGVuYWJsZU1vdG9yLCBDMy50b1JhZGlhbnMobW90b3JTcGVlZCksIG1heE1vdG9yRm9yY2UpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFJlbW92ZUpvaW50cygpIHsKICAgICAgICAgICAgICAgIHRoaXMuX1JlbW92ZUpvaW50cygpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFNldFdvcmxkR3Jhdml0eShnKSB7CiAgICAgICAgICAgICAgICB0aGlzLkdldEJlaGF2aW9yKCkuU2V0R3Jhdml0eShnKQogICAgICAgICAgICB9LAogICAgICAgICAgICBTZXRTdGVwcGluZ01vZGUobSkgewogICAgICAgICAgICAgICAgdGhpcy5HZXRCZWhhdmlvcigpLlNldFN0ZXBwaW5nTW9kZShtKQogICAgICAgICAgICB9LAogICAgICAgICAgICBTZXRJdGVyYXRpb25zKHZlbCwgcG9zKSB7CiAgICAgICAgICAgICAgICB0aGlzLkdldEJlaGF2aW9yKCkuU2V0SXRlcmF0aW9ucyh2ZWwsIHBvcykKICAgICAgICAgICAgfSwKICAgICAgICAgICAgU2V0VmVsb2NpdHkodngsIHZ5KSB7CiAgICAgICAgICAgICAgICB0aGlzLl9TZXRWZWxvY2l0eSh2eCwgdnkpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFNldERlbnNpdHkoZCkgewogICAgICAgICAgICAgICAgdGhpcy5fU2V0RGVuc2l0eShkKQogICAgICAgICAgICB9LAogICAgICAgICAgICBTZXRGcmljdGlvbihmKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9TZXRGcmljdGlvbihmKQogICAgICAgICAgICB9LAogICAgICAgICAgICBTZXRFbGFzdGljaXR5KGUpIHsKICAgICAgICAgICAgICAgIHRoaXMuX1NldEVsYXN0aWNpdHkoZSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgU2V0TGluZWFyRGFtcGluZyhsZCkgewogICAgICAgICAgICAgICAgdGhpcy5fU2V0TGluZWFyRGFtcGluZyhsZCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgU2V0QW5ndWxhckRhbXBpbmcoYWQpIHsKICAgICAgICAgICAgICAgIHRoaXMuX1NldEFuZ3VsYXJEYW1waW5nKGFkKQogICAgICAgICAgICB9LAogICAgICAgICAgICBTZXRJbW1vdmFibGUoaSkgewogICAgICAgICAgICAgICAgdGhpcy5fU2V0SW1tb3ZhYmxlKGkpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIEVuYWJsZUNvbGxpc2lvbnMob2JqZWN0Q2xhc3MsIHN0YXRlKSB7CiAgICAgICAgICAgICAgICB0aGlzLkdldEJlaGF2aW9yKCkuU2V0Q29sbGlzaW9uc0VuYWJsZWQodGhpcy5HZXRPYmplY3RDbGFzcygpLCBvYmplY3RDbGFzcywgc3RhdGUgIT09IDApCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFNldFByZXZlbnRSb3RhdGUoaSkgewogICAgICAgICAgICAgICAgdGhpcy5fU2V0UHJldmVudFJvdGF0ZShpICE9PSAwKQogICAgICAgICAgICB9LAogICAgICAgICAgICBTZXRCdWxsZXQoaSkgewogICAgICAgICAgICAgICAgdGhpcy5fU2V0QnVsbGV0KGkgIT09IDApCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFNldEVuYWJsZWQoZSkgewogICAgICAgICAgICAgICAgdGhpcy5fU2V0RW5hYmxlZChlICE9PSAwKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSB7CiAgICAgICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgICAgIEMzLkJlaGF2aW9ycy5QaHlzaWNzLkV4cHMgPSB7CiAgICAgICAgICAgIFZlbG9jaXR5WCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9HZXRWZWxvY2l0eVgoKQogICAgICAgICAgICB9LAogICAgICAgICAgICBWZWxvY2l0eVkoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fR2V0VmVsb2NpdHlZKCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgQW5ndWxhclZlbG9jaXR5KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIEMzLnRvRGVncmVlcyh0aGlzLl9HZXRBbmd1bGFyVmVsb2NpdHkoKSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgTWFzcygpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9HZXRNYXNzKCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgQ2VudGVyT2ZNYXNzWCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9HZXRDZW50ZXJPZk1hc3NYKCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgQ2VudGVyT2ZNYXNzWSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9HZXRDZW50ZXJPZk1hc3NZKCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgRGVuc2l0eSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9HZXREZW5zaXR5KCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgRnJpY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fR2V0RnJpY3Rpb24oKQogICAgICAgICAgICB9LAogICAgICAgICAgICBFbGFzdGljaXR5KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX0dldEVsYXN0aWNpdHkoKQogICAgICAgICAgICB9LAogICAgICAgICAgICBMaW5lYXJEYW1waW5nKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX0dldExpbmVhckRhbXBpbmcoKQogICAgICAgICAgICB9LAogICAgICAgICAgICBBbmd1bGFyRGFtcGluZygpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9HZXRBbmd1bGFyRGFtcGluZygpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIENvbnRhY3RDb3VudCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9HZXRDb250YWN0Q291bnQoKQogICAgICAgICAgICB9LAogICAgICAgICAgICBDb250YWN0WEF0KGkpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9HZXRDb250YWN0UG9zaXRpb25BdChpKVswXQogICAgICAgICAgICB9LAogICAgICAgICAgICBDb250YWN0WUF0KGkpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9HZXRDb250YWN0UG9zaXRpb25BdChpKVsxXQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKCn0KCnsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgIGNvbnN0IGIyU2VwYXJhdG9yID0ge307CiAgICBDMy5CZWhhdmlvcnMuUGh5c2ljcy5TZXBhcmF0b3IgPSBiMlNlcGFyYXRvcjsKICAgIGNvbnN0IEdldFZlYzIgPSBDMy5CZWhhdmlvcnMuUGh5c2ljcy5HZXRWZWMyOwogICAgY29uc3QgRnJlZVZlYzIgPSBDMy5CZWhhdmlvcnMuUGh5c2ljcy5GcmVlVmVjMjsKCiAgICBmdW5jdGlvbiBDbG9uZVZlYzIodikgewogICAgICAgIHJldHVybiBHZXRWZWMyKHZbImdldF94Il0oKSwgdlsiZ2V0X3kiXSgpKQogICAgfQogICAgYjJTZXBhcmF0b3IuZGV0ID0gZnVuY3Rpb24oeDEsIHkxLCB4MiwgeTIsIHgzLCB5MykgewogICAgICAgIHJldHVybiB4MSAqIHkyICsgeDIgKiB5MyArIHgzICogeTEgLSB5MSAqIHgyIC0geTIgKiB4MyAtIHkzICogeDEKICAgIH07CiAgICBiMlNlcGFyYXRvci5oaXRSYXkgPSBmdW5jdGlvbih4MSwgeTEsIHgyLCB5MiwgeDMsIHkzLCB4NCwgeTQpIHsKICAgICAgICBjb25zdCB0MSA9IHgzIC0geDEsCiAgICAgICAgICAgIHQyID0geTMgLSB5MSwKICAgICAgICAgICAgdDMgPSB4MiAtIHgxLAogICAgICAgICAgICB0NCA9IHkyIC0geTEsCiAgICAgICAgICAgIHQ1ID0geDQgLSB4MywKICAgICAgICAgICAgdDYgPSB5NCAtIHkzLAogICAgICAgICAgICB0NyA9IHQ0ICogdDUgLSB0MyAqIHQ2OwogICAgICAgIGNvbnN0IGEgPSAodDUgKiB0MiAtIHQ2ICogdDEpIC8gdDc7CiAgICAgICAgY29uc3QgcHggPSB4MSArIGEgKiB0MywKICAgICAgICAgICAgcHkgPSB5MSArIGEgKiB0NDsKICAgICAgICBjb25zdCBiMSA9IGIyU2VwYXJhdG9yLmlzT25TZWdtZW50KHgyLCB5MiwgeDEsIHkxLCBweCwgcHkpOwogICAgICAgIGNvbnN0IGIyID0gYjJTZXBhcmF0b3IuaXNPblNlZ21lbnQocHgsIHB5LCB4MywgeTMsIHg0LCB5NCk7CiAgICAgICAgaWYgKGIxICYmIGIyKSByZXR1cm4gR2V0VmVjMihweCwgcHkpOwogICAgICAgIGVsc2UgcmV0dXJuIG51bGwKICAgIH07CiAgICBiMlNlcGFyYXRvci5pc09uU2VnbWVudCA9IGZ1bmN0aW9uKHB4LCBweSwgeDEsIHkxLCB4MiwgeTIpIHsKICAgICAgICBjb25zdCBiMSA9IHgxICsgLjEgPj0gcHggJiYgcHggPj0geDIgLSAuMSB8fCB4MSAtIC4xIDw9IHB4ICYmIHB4IDw9IHgyICsgLjE7CiAgICAgICAgY29uc3QgYjIgPSB5MSArIC4xID49IHB5ICYmIHB5ID49IHkyIC0gLjEgfHwgeTEgLSAuMSA8PSBweSAmJiBweSA8PSB5MiArIC4xOwogICAgICAgIHJldHVybiBiMSAmJiBiMiAmJiBiMlNlcGFyYXRvci5pc09uTGluZShweCwgcHksIHgxLCB5MSwgeDIsIHkyKQogICAgfTsKICAgIGIyU2VwYXJhdG9yLmlzT25MaW5lID0gZnVuY3Rpb24ocHgsIHB5LCB4MSwgeTEsIHgyLCB5MikgewogICAgICAgIGlmIChNYXRoLmFicyh4MiAtIHgxKSA+IC4xKSB7CiAgICAgICAgICAgIGNvbnN0IGEgPSAoeTIgLSB5MSkgLyAoeDIgLSB4MSk7CiAgICAgICAgICAgIGNvbnN0IHBvc3NpYmxlWSA9IGEgKiAocHggLSB4MSkgKyB5MTsKICAgICAgICAgICAgY29uc3QgZGlmZiA9IE1hdGguYWJzKHBvc3NpYmxlWSAtIHB5KTsKICAgICAgICAgICAgcmV0dXJuIGRpZmYgPCAuMQogICAgICAgIH0KICAgICAgICByZXR1cm4gTWF0aC5hYnMocHggLSB4MSkgPCAuMQogICAgfTsKICAgIGIyU2VwYXJhdG9yLnBvaW50c01hdGNoID0gZnVuY3Rpb24oeDEsIHkxLCB4MiwgeTIpIHsKICAgICAgICByZXR1cm4gTWF0aC5hYnMoeDIgLSB4MSkgPCAuMSAmJiBNYXRoLmFicyh5MiAtIHkxKSA8IC4xCiAgICB9OwogICAgYjJTZXBhcmF0b3IuU2VwYXJhdGUgPSBmdW5jdGlvbih2ZXJ0aWNlc1ZlYywgb2JqYXJlYSkgewogICAgICAgIGNvbnN0IGNhbGNlZCA9IGIyU2VwYXJhdG9yLmNhbGNTaGFwZXModmVydGljZXNWZWMpOwogICAgICAgIGxldCByZXQgPSBbXTsKICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gY2FsY2VkLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7CiAgICAgICAgICAgIGNvbnN0IGEgPSBjYWxjZWRbaV07CiAgICAgICAgICAgIGNvbnN0IHBvbHkgPSBbXTsKICAgICAgICAgICAgbGV0IGFyZWFzdW0gPSAwOwogICAgICAgICAgICBmb3IgKGxldCBqID0gMCwgbGVuaiA9IGEubGVuZ3RoOyBqIDwgbGVuajsgKytqKSB7CiAgICAgICAgICAgICAgICBjb25zdCBiID0gYVtqXTsKICAgICAgICAgICAgICAgIGNvbnN0IGMgPSBhWyhqICsgMSkgJSBsZW5qXTsKICAgICAgICAgICAgICAgIGFyZWFzdW0gKz0gYlsiZ2V0X3giXSgpICogY1siZ2V0X3kiXSgpIC0gYlsiZ2V0X3kiXSgpICogY1siZ2V0X3giXSgpOwogICAgICAgICAgICAgICAgcG9seS5wdXNoKEdldFZlYzIoYlsiZ2V0X3giXSgpLCBiWyJnZXRfeSJdKCkpKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGFyZWFzdW0gPSBNYXRoLmFicyhhcmVhc3VtIC8gMik7CiAgICAgICAgICAgIGlmIChhcmVhc3VtID49IG9iamFyZWEgKiAuMDAxKSByZXQucHVzaChwb2x5KTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgZm9yIChsZXQgaiA9IDAsIGxlbmogPSBwb2x5Lmxlbmd0aDsgaiA8IGxlbmo7IGorKykgRnJlZVZlYzIocG9seVtqXSkKICAgICAgICB9CiAgICAgICAgcmV0ID0KICAgICAgICAgICAgU3BsaXRDb252ZXhQb2x5c092ZXI4UG9pbnRzKHJldCk7CiAgICAgICAgcmV0dXJuIHJldAogICAgfTsKICAgIGIyU2VwYXJhdG9yLmNhbGNTaGFwZXMgPSBmdW5jdGlvbih2ZXJ0aWNlc1ZlYykgewogICAgICAgIGxldCB2ZWMgPSBbXTsKICAgICAgICBsZXQgaSA9IDAsCiAgICAgICAgICAgIG4gPSAwLAogICAgICAgICAgICBqID0gMDsKICAgICAgICBsZXQgZCA9IDAsCiAgICAgICAgICAgIHQgPSAwLAogICAgICAgICAgICBkeCA9IDAsCiAgICAgICAgICAgIGR5ID0gMCwKICAgICAgICAgICAgbWluTGVuID0gMDsKICAgICAgICBsZXQgaTEgPSAwLAogICAgICAgICAgICBpMiA9IDAsCiAgICAgICAgICAgIGkzID0gMDsKICAgICAgICBsZXQgcDEsIHAyLCBwMywgdjEsIHYyLCB2LCBoaXRWOwogICAgICAgIGxldCBqMSA9IDAsCiAgICAgICAgICAgIGoyID0gMCwKICAgICAgICAgICAgayA9IDAsCiAgICAgICAgICAgIGggPSAwOwogICAgICAgIGxldCB2ZWMxID0gW10sCiAgICAgICAgICAgIHZlYzIgPSBbXTsKICAgICAgICBsZXQgaXNDb252ZXggPSBmYWxzZTsKICAgICAgICBsZXQgZmlnc1ZlYyA9IFtdLAogICAgICAgICAgICBxdWV1ZSA9IFtdOwogICAgICAgIGxldCBwdXNoZWQgPSBmYWxzZTsKICAgICAgICBxdWV1ZS5wdXNoKHZlcnRpY2VzVmVjKTsKICAgICAgICB3aGlsZSAocXVldWUubGVuZ3RoKSB7CiAgICAgICAgICAgIHZlYyA9IHF1ZXVlWzBdOwogICAgICAgICAgICBuID0gdmVjLmxlbmd0aDsKICAgICAgICAgICAgaXNDb252ZXggPSB0cnVlOwogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbjsgaSsrKSB7CiAgICAgICAgICAgICAgICBpMSA9IGk7CiAgICAgICAgICAgICAgICBpMiA9IGkgPCBuIC0gMSA/IGkgKyAxIDogaSArIDEgLSBuOwogICAgICAgICAgICAgICAgaTMgPSBpIDwgbiAtIDIgPyBpICsgMiA6IGkgKyAyIC0gbjsKICAgICAgICAgICAgICAgIHAxID0gdmVjW2kxXTsKICAgICAgICAgICAgICAgIHAyID0gdmVjW2kyXTsKICAgICAgICAgICAgICAgIHAzID0gdmVjW2kzXTsKICAgICAgICAgICAgICAgIGQgPSBiMlNlcGFyYXRvci5kZXQocDFbImdldF94Il0oKSwgcDFbImdldF95Il0oKSwgcDJbImdldF94Il0oKSwgcDJbImdldF95Il0oKSwKICAgICAgICAgICAgICAgICAgICBwM1siZ2V0X3giXSgpLCBwM1siZ2V0X3kiXSgpKTsKICAgICAgICAgICAgICAgIGlmIChkIDwgMCkgewogICAgICAgICAgICAgICAgICAgIGlzQ29udmV4ID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgbWluTGVuID0gMUU5OwogICAgICAgICAgICAgICAgICAgIGZvciAoaiA9IDA7IGogPCBuOyBqKyspCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChqICE9PSBpMSAmJiBqICE9PSBpMikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgajEgPSBqOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgajIgPSBqIDwgbiAtIDEgPyBqICsgMSA6IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2MSA9IHZlY1tqMV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2MiA9IHZlY1tqMl07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2ID0gYjJTZXBhcmF0b3IuaGl0UmF5KHAxWyJnZXRfeCJdKCksIHAxWyJnZXRfeSJdKCksIHAyWyJnZXRfeCJdKCksIHAyWyJnZXRfeSJdKCksIHYxWyJnZXRfeCJdKCksIHYxWyJnZXRfeSJdKCksIHYyWyJnZXRfeCJdKCksIHYyWyJnZXRfeSJdKCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkeCA9IHAyWyJnZXRfeCJdKCkgLSB2WyJnZXRfeCJdKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZHkgPSBwMlsiZ2V0X3kiXSgpIC0gdlsiZ2V0X3kiXSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQgPSBkeCAqIGR4ICsgZHkgKiBkeTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodCA8IG1pbkxlbikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoID0gajE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGsgPSBqMjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGl0ViA9IHY7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1pbkxlbiA9IHQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgRnJlZVZlYzIodikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChtaW5MZW4gPT09IDFFOSkgcmV0dXJuIFtdOwogICAgICAgICAgICAgICAgICAgIHZlYzEgPSBbXTsKICAgICAgICAgICAgICAgICAgICB2ZWMyID0gW107CiAgICAgICAgICAgICAgICAgICAgajEgPSBoOwogICAgICAgICAgICAgICAgICAgIGoyID0gazsKICAgICAgICAgICAgICAgICAgICB2MSA9IHZlY1tqMV07CiAgICAgICAgICAgICAgICAgICAgdjIgPSB2ZWNbajJdOwogICAgICAgICAgICAgICAgICAgIHB1c2hlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIGlmICghYjJTZXBhcmF0b3IucG9pbnRzTWF0Y2goaGl0VlsiZ2V0X3giXSgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGl0VlsiZ2V0X3kiXSgpLCB2MlsiZ2V0X3giXSgpLCB2MlsiZ2V0X3kiXSgpKSkgewogICAgICAgICAgICAgICAgICAgICAgICB2ZWMxLnB1c2goaGl0Vik7CiAgICAgICAgICAgICAgICAgICAgICAgIHB1c2hlZCA9IHRydWUKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKCFiMlNlcGFyYXRvci5wb2ludHNNYXRjaChoaXRWWyJnZXRfeCJdKCksIGhpdFZbImdldF95Il0oKSwgdjFbImdldF94Il0oKSwgdjFbImdldF95Il0oKSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmVjMi5wdXNoKGhpdFYpOwogICAgICAgICAgICAgICAgICAgICAgICBwdXNoZWQgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICghcHVzaGVkKSBGcmVlVmVjMihoaXRWKTsKICAgICAgICAgICAgICAgICAgICBoID0gLTE7CiAgICAgICAgICAgICAgICAgICAgayA9IGkxOwogICAgICAgICAgICAgICAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChrICE9PSBqMikgdmVjMS5wdXNoKHZlY1trXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGggPCAwIHx8IGggPj0gbikgcmV0dXJuIFtdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFiMlNlcGFyYXRvci5pc09uU2VnbWVudCh2MlsiZ2V0X3giXSgpLCB2MlsiZ2V0X3kiXSgpLCB2ZWNbaF1bImdldF94Il0oKSwgdmVjW2hdWyJnZXRfeSJdKCksIHAxWyJnZXRfeCJdKCksIHAxWyJnZXRfeSJdKCkpKSB2ZWMxLnB1c2godmVjW2tdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgaCA9IGs7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChrIC0gMSA8IDApIGsgPSBuIC0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBrLS0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdmVjMS5yZXZlcnNlKCk7CiAgICAgICAgICAgICAgICAgICAgaCA9IC0xOwogICAgICAgICAgICAgICAgICAgIGsgPSBpMjsKICAgICAgICAgICAgICAgICAgICB3aGlsZSAodHJ1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoayAhPT0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGoxKSB2ZWMyLnB1c2godmVjW2tdKTsKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaCA8IDAgfHwgaCA+PSBuKSByZXR1cm4gW107CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoayA9PT0gajEgJiYgIWIyU2VwYXJhdG9yLmlzT25TZWdtZW50KHYxWyJnZXRfeCJdKCksIHYxWyJnZXRfeSJdKCksIHZlY1toXVsiZ2V0X3giXSgpLCB2ZWNbaF1bImdldF95Il0oKSwgcDJbImdldF94Il0oKSwgcDJbImdldF95Il0oKSkpIHZlYzIucHVzaCh2ZWNba10pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBoID0gazsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGsgKyAxID4gbiAtIDEpIGsgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGsrKwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBxdWV1ZS5wdXNoKHZlYzEsIHZlYzIpOwogICAgICAgICAgICAgICAgICAgIHF1ZXVlLnNoaWZ0KCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoaXNDb252ZXgpIGZpZ3NWZWMucHVzaChxdWV1ZS5zaGlmdCgpKQogICAgICAgIH0KICAgICAgICByZXR1cm4gZmlnc1ZlYwogICAgfTsKCiAgICBmdW5jdGlvbiBTcGxpdENvbnZleFBvbHlzT3ZlcjhQb2ludHMoY29udmV4UG9seXMpIHsKICAgICAgICBjb25zdCByZXQgPSBbXTsKICAgICAgICBmb3IgKGNvbnN0IGFyciBvZiBjb252ZXhQb2x5cykKICAgICAgICAgICAgaWYgKGFyci5sZW5ndGggPD0gOCkgcmV0LnB1c2goYXJyKTsKICAgICAgICAgICAgZWxzZSByZXQucHVzaC5hcHBseShyZXQsIFNwbGl0Q29udmV4UG9seShhcnIpKTsKICAgICAgICByZXR1cm4gcmV0CiAgICB9CgogICAgZnVuY3Rpb24gU3BsaXRDb252ZXhQb2x5KGFycikgewogICAgICAgIGNvbnN0IHJldCA9IFtdOwogICAgICAgIHJldC5wdXNoKGFyci5zcGxpY2UoMCwgOCkpOwogICAgICAgIGNvbnN0IGZpcnN0ID0gcmV0WzBdWzBdOwogICAgICAgIGxldCBsYXN0ID0gcmV0WzBdWzddOwogICAgICAgIHdoaWxlIChhcnIubGVuZ3RoKSB7CiAgICAgICAgICAgIGNvbnN0IHBvbHkgPSBhcnIuc3BsaWNlKDAsIE1hdGgubWluKGFyci5sZW5ndGgsIDYpKTsKICAgICAgICAgICAgbGV0IG5leHRMYXN0ID0gcG9seS5hdCgtMSk7CiAgICAgICAgICAgIHBvbHkucHVzaChDbG9uZVZlYzIoZmlyc3QpKTsKICAgICAgICAgICAgcG9seS5wdXNoKENsb25lVmVjMihsYXN0KSk7CiAgICAgICAgICAgIHJldC5wdXNoKHBvbHkpOwogICAgICAgICAgICBsYXN0ID0gbmV4dExhc3QKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJldAogICAgfTsKCn0KCnsKICAgICd1c2Ugc3RyaWN0JzsgewogICAgICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgICAgICBDMy5CZWhhdmlvcnMuc2Nyb2xsdG8gPSBjbGFzcyBTY3JvbGxUb0JlaGF2aW9yIGV4dGVuZHMgQzMuU0RLQmVoYXZpb3JCYXNlIHsKICAgICAgICAgICAgY29uc3RydWN0b3Iob3B0cykgewogICAgICAgICAgICAgICAgc3VwZXIob3B0cyk7CiAgICAgICAgICAgICAgICB0aGlzLl9zaGFrZU1hZyA9IDA7CiAgICAgICAgICAgICAgICB0aGlzLl9zaGFrZVN0YXJ0ID0gMDsKICAgICAgICAgICAgICAgIHRoaXMuX3NoYWtlRW5kID0gMDsKICAgICAgICAgICAgICAgIHRoaXMuX3NoYWtlTW9kZSA9IDAKICAgICAgICAgICAgfQogICAgICAgICAgICBSZWxlYXNlKCkgewogICAgICAgICAgICAgICAgc3VwZXIuUmVsZWFzZSgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgU2V0U2hha2VNYWduaXR1ZGUobSkgewogICAgICAgICAgICAgICAgdGhpcy5fc2hha2VNYWcgPSBtCiAgICAgICAgICAgIH0KICAgICAgICAgICAgR2V0U2hha2VNYWduaXR1ZGUoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fc2hha2VNYWcKICAgICAgICAgICAgfQogICAgICAgICAgICBTZXRTaGFrZVN0YXJ0KHMpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3NoYWtlU3RhcnQgPSBzCiAgICAgICAgICAgIH0KICAgICAgICAgICAgR2V0U2hha2VTdGFydCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9zaGFrZVN0YXJ0CiAgICAgICAgICAgIH0KICAgICAgICAgICAgU2V0U2hha2VFbmQocykgewogICAgICAgICAgICAgICAgdGhpcy5fc2hha2VFbmQgPSBzCiAgICAgICAgICAgIH0KICAgICAgICAgICAgR2V0U2hha2VFbmQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fc2hha2VFbmQKICAgICAgICAgICAgfQogICAgICAgICAgICBTZXRTaGFrZU1vZGUobSkgewogICAgICAgICAgICAgICAgdGhpcy5fc2hha2VNb2RlID0gbQogICAgICAgICAgICB9CiAgICAgICAgICAgIEdldFNoYWtlTW9kZSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9zaGFrZU1vZGUKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gewogICAgICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgICAgICBDMy5CZWhhdmlvcnMuc2Nyb2xsdG8uVHlwZSA9IGNsYXNzIFNjcm9sbFRvVHlwZSBleHRlbmRzIEMzLlNES0JlaGF2aW9yVHlwZUJhc2UgewogICAgICAgICAgICBjb25zdHJ1Y3RvcihvYmplY3RDbGFzcykgewogICAgICAgICAgICAgICAgc3VwZXIob2JqZWN0Q2xhc3MpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgUmVsZWFzZSgpIHsKICAgICAgICAgICAgICAgIHN1cGVyLlJlbGVhc2UoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIE9uQ3JlYXRlKCkge30KICAgICAgICB9CiAgICB9IHsKICAgICAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICAgICAgY29uc3QgRU5BQkxFID0gMDsKICAgICAgICBDMy5CZWhhdmlvcnMuc2Nyb2xsdG8uSW5zdGFuY2UgPSBjbGFzcyBTY3JvbGxUb0luc3RhbmNlIGV4dGVuZHMgQzMuU0RLQmVoYXZpb3JJbnN0YW5jZUJhc2UgewogICAgICAgICAgICBjb25zdHJ1Y3RvcihpbnN0LCBwcm9wZXJ0aWVzKSB7CiAgICAgICAgICAgICAgICBzdXBlcihpbnN0KTsKICAgICAgICAgICAgICAgIHRoaXMuX2lzRW5hYmxlZCA9IHRydWU7CiAgICAgICAgICAgICAgICBpZiAocHJvcGVydGllcykgdGhpcy5faXNFbmFibGVkID0gcHJvcGVydGllc1tFTkFCTEVdOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuX2lzRW5hYmxlZCkgdGhpcy5fU3RhcnRUaWNraW5nMigpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgUmVsZWFzZSgpIHsKICAgICAgICAgICAgICAgIHN1cGVyLlJlbGVhc2UoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIFNhdmVUb0pzb24oKSB7CiAgICAgICAgICAgICAgICBjb25zdCBiZWhhdmlvciA9IHRoaXMuR2V0QmVoYXZpb3IoKTsKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgImUiOiB0aGlzLl9pc0VuYWJsZWQsCiAgICAgICAgICAgICAgICAgICAgInNtZyI6IGJlaGF2aW9yLkdldFNoYWtlTWFnbml0dWRlKCksCiAgICAgICAgICAgICAgICAgICAgInNzIjogYmVoYXZpb3IuR2V0U2hha2VTdGFydCgpLAogICAgICAgICAgICAgICAgICAgICJzZSI6IGJlaGF2aW9yLkdldFNoYWtlRW5kKCksCiAgICAgICAgICAgICAgICAgICAgInNtZCI6IGJlaGF2aW9yLkdldFNoYWtlTW9kZSgpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgTG9hZEZyb21Kc29uKG8pIHsKICAgICAgICAgICAgICAgIGNvbnN0IGJlaGF2aW9yID0KICAgICAgICAgICAgICAgICAgICB0aGlzLkdldEJlaGF2aW9yKCk7CiAgICAgICAgICAgICAgICBiZWhhdmlvci5TZXRTaGFrZU1hZ25pdHVkZShvWyJzbWciXSk7CiAgICAgICAgICAgICAgICBiZWhhdmlvci5TZXRTaGFrZVN0YXJ0KG9bInNzIl0pOwogICAgICAgICAgICAgICAgYmVoYXZpb3IuU2V0U2hha2VFbmQob1sic2UiXSk7CiAgICAgICAgICAgICAgICBiZWhhdmlvci5TZXRTaGFrZU1vZGUob1sic21kIl0pOwogICAgICAgICAgICAgICAgdGhpcy5faXNFbmFibGVkID0gb1siZSJdOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuX2lzRW5hYmxlZCkgdGhpcy5fU3RhcnRUaWNraW5nMigpOwogICAgICAgICAgICAgICAgZWxzZSB0aGlzLl9TdG9wVGlja2luZzIoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9TZXRFbmFibGVkKGUpIHsKICAgICAgICAgICAgICAgIHRoaXMuX2lzRW5hYmxlZCA9ICEhZTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9pc0VuYWJsZWQpIHRoaXMuX1N0YXJ0VGlja2luZzIoKTsKICAgICAgICAgICAgICAgIGVsc2UgdGhpcy5fU3RvcFRpY2tpbmcyKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBJc0VuYWJsZWQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5faXNFbmFibGVkCiAgICAgICAgICAgIH0KICAgICAgICAgICAgVGljazIoKSB7CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuSXNFbmFibGVkKCkpIHJldHVybjsKICAgICAgICAgICAgICAgIGNvbnN0IGR0ID0gdGhpcy5fcnVudGltZS5HZXREdCh0aGlzLl9pbnN0KTsKICAgICAgICAgICAgICAgIGNvbnN0IGJlaGF2aW9yID0gdGhpcy5HZXRCZWhhdmlvcigpOwogICAgICAgICAgICAgICAgY29uc3QgYWxsSW5zdGFuY2VzID0KICAgICAgICAgICAgICAgICAgICBiZWhhdmlvci5HZXRJbnN0YW5jZXMoKTsKICAgICAgICAgICAgICAgIGxldCBzdW1YID0gMDsKICAgICAgICAgICAgICAgIGxldCBzdW1ZID0gMDsKICAgICAgICAgICAgICAgIGxldCBjb3VudCA9IDA7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGluc3Qgb2YgYWxsSW5zdGFuY2VzKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYmVoSW5zdCA9IGluc3QuR2V0QmVoYXZpb3JJbnN0YW5jZUZyb21DdG9yKEMzLkJlaGF2aW9ycy5zY3JvbGx0byk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFiZWhJbnN0IHx8ICFiZWhJbnN0LkdldFNka0luc3RhbmNlKCkuSXNFbmFibGVkKCkpIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHdpID0gaW5zdC5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgICAgICAgICBzdW1YICs9IHdpLkdldFgoKTsKICAgICAgICAgICAgICAgICAgICBzdW1ZICs9IHdpLkdldFkoKTsKICAgICAgICAgICAgICAgICAgICArK2NvdW50CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjb25zdCBsYXlvdXQgPSB0aGlzLl9pbnN0LkdldFdvcmxkSW5mbygpLkdldExheW91dCgpOwogICAgICAgICAgICAgICAgY29uc3Qgbm93ID0gdGhpcy5fcnVudGltZS5HZXRHYW1lVGltZSgpOwogICAgICAgICAgICAgICAgbGV0IG9mZlggPSAwOwogICAgICAgICAgICAgICAgbGV0IG9mZlkgPSAwOwogICAgICAgICAgICAgICAgaWYgKG5vdyA+PSBiZWhhdmlvci5HZXRTaGFrZVN0YXJ0KCkgJiYgbm93IDwgYmVoYXZpb3IuR2V0U2hha2VFbmQoKSkgewogICAgICAgICAgICAgICAgICAgIGxldCBtYWcgPSBiZWhhdmlvci5HZXRTaGFrZU1hZ25pdHVkZSgpICogTWF0aC5taW4odGhpcy5fcnVudGltZS5HZXRUaW1lU2NhbGUoKSwKICAgICAgICAgICAgICAgICAgICAgICAgMSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGJlaGF2aW9yLkdldFNoYWtlTW9kZSgpID09PSAwKSBtYWcgKj0gMSAtIChub3cgLSBiZWhhdmlvci5HZXRTaGFrZVN0YXJ0KCkpIC8gKGJlaGF2aW9yLkdldFNoYWtlRW5kKCkgLSBiZWhhdmlvci5HZXRTaGFrZVN0YXJ0KCkpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGEgPSB0aGlzLl9ydW50aW1lLlJhbmRvbSgpICogTWF0aC5QSSAqIDI7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZCA9IHRoaXMuX3J1bnRpbWUuUmFuZG9tKCkgKiBtYWc7CiAgICAgICAgICAgICAgICAgICAgb2ZmWCA9IE1hdGguY29zKGEpICogZDsKICAgICAgICAgICAgICAgICAgICBvZmZZID0gTWF0aC5zaW4oYSkgKiBkCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBsYXlvdXQuU2V0U2Nyb2xsWChzdW1YIC8gY291bnQgKyBvZmZYKTsKICAgICAgICAgICAgICAgIGxheW91dC5TZXRTY3JvbGxZKHN1bVkgLyBjb3VudCArIG9mZlkpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgR2V0UHJvcGVydHlWYWx1ZUJ5SW5kZXgoaW5kZXgpIHsKICAgICAgICAgICAgICAgIHN3aXRjaCAoaW5kZXgpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlIEVOQUJMRToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2lzRW5hYmxlZAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIFNldFByb3BlcnR5VmFsdWVCeUluZGV4KGluZGV4LCB2YWx1ZSkgewogICAgICAgICAgICAgICAgc3dpdGNoIChpbmRleCkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgRU5BQkxFOgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9pc0VuYWJsZWQgPSAhIXZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9pc0VuYWJsZWQgPyB0aGlzLl9TdGFydFRpY2tpbmcyKCkgOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fU3RvcFRpY2tpbmcyKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgR2V0RGVidWdnZXJQcm9wZXJ0aWVzKCkgewogICAgICAgICAgICAgICAgY29uc3QgcHJlZml4ID0gImJlaGF2aW9ycy5zY3JvbGx0byI7CiAgICAgICAgICAgICAgICByZXR1cm4gW3sKICAgICAgICAgICAgICAgICAgICB0aXRsZTogIiQiICsgdGhpcy5HZXRCZWhhdmlvclR5cGUoKS5HZXROYW1lKCksCiAgICAgICAgICAgICAgICAgICAgcHJvcGVydGllczogW3sKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogcHJlZml4ICsgIi5wcm9wZXJ0aWVzLmVuYWJsZWQubmFtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLklzRW5hYmxlZCgpLAogICAgICAgICAgICAgICAgICAgICAgICBvbmVkaXQ6IHYgPT4gdGhpcy5fU2V0RW5hYmxlZCh2KQogICAgICAgICAgICAgICAgICAgIH1dCiAgICAgICAgICAgICAgICB9XQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSB7CiAgICAgICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgICAgIEMzLkJlaGF2aW9ycy5zY3JvbGx0by5DbmRzID0gewogICAgICAgICAgICBJc0VuYWJsZWQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5Jc0VuYWJsZWQoKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSB7CiAgICAgICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgICAgIEMzLkJlaGF2aW9ycy5zY3JvbGx0by5BY3RzID0gewogICAgICAgICAgICBTaGFrZShtYWcsIGR1ciwgbW9kZSkgewogICAgICAgICAgICAgICAgY29uc3QgYmVoYXZpb3IgPSB0aGlzLkdldEJlaGF2aW9yKCk7CiAgICAgICAgICAgICAgICBiZWhhdmlvci5TZXRTaGFrZU1hZ25pdHVkZShtYWcpOwogICAgICAgICAgICAgICAgYmVoYXZpb3IuU2V0U2hha2VTdGFydCh0aGlzLl9ydW50aW1lLkdldEdhbWVUaW1lKCkpOwogICAgICAgICAgICAgICAgYmVoYXZpb3IuU2V0U2hha2VFbmQodGhpcy5fcnVudGltZS5HZXRHYW1lVGltZSgpICsgZHVyKTsKICAgICAgICAgICAgICAgIGJlaGF2aW9yLlNldFNoYWtlTW9kZShtb2RlKQogICAgICAgICAgICB9LAogICAgICAgICAgICBTZXRFbmFibGVkKGUpIHsKICAgICAgICAgICAgICAgIHRoaXMuX1NldEVuYWJsZWQoZSAhPT0gMCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gewogICAgICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgICAgICBDMy5CZWhhdmlvcnMuc2Nyb2xsdG8uRXhwcyA9IHt9CiAgICB9OwoKfQoKewogICAgJ3VzZSBzdHJpY3QnOyB7CiAgICAgICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgICAgIEMzLkJlaGF2aW9ycy5UaW1lciA9IGNsYXNzIFRpbWVyQmVoYXZpb3IgZXh0ZW5kcyBDMy5TREtCZWhhdmlvckJhc2UgewogICAgICAgICAgICBjb25zdHJ1Y3RvcihvcHRzKSB7CiAgICAgICAgICAgICAgICBzdXBlcihvcHRzKQogICAgICAgICAgICB9CiAgICAgICAgICAgIFJlbGVhc2UoKSB7CiAgICAgICAgICAgICAgICBzdXBlci5SZWxlYXNlKCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gewogICAgICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgICAgICBDMy5CZWhhdmlvcnMuVGltZXIuVHlwZSA9IGNsYXNzIFRpbWVyVHlwZSBleHRlbmRzIEMzLlNES0JlaGF2aW9yVHlwZUJhc2UgewogICAgICAgICAgICBjb25zdHJ1Y3RvcihiZWhhdmlvclR5cGUpIHsKICAgICAgICAgICAgICAgIHN1cGVyKGJlaGF2aW9yVHlwZSkKICAgICAgICAgICAgfQogICAgICAgICAgICBSZWxlYXNlKCkgewogICAgICAgICAgICAgICAgc3VwZXIuUmVsZWFzZSgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgT25DcmVhdGUoKSB7fQogICAgICAgIH0KICAgIH0gewogICAgICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgICAgICBjb25zdCBDM1ggPSBzZWxmLkMzWDsKICAgICAgICBjb25zdCBJQmVoYXZpb3JJbnN0YW5jZSA9IHNlbGYuSUJlaGF2aW9ySW5zdGFuY2U7CiAgICAgICAgQzMuQmVoYXZpb3JzLlRpbWVyLlNpbmdsZVRpbWVyID0gY2xhc3MgU2luZ2xlVGltZXIgewogICAgICAgICAgICBjb25zdHJ1Y3RvcihjdXJyZW50LCB0b3RhbCwgZHVyYXRpb24sIGlzUmVndWxhcikgewogICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudCA9IEMzLk5ldyhDMy5LYWhhblN1bSk7CiAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50LlNldChjdXJyZW50IHx8IDApOwogICAgICAgICAgICAgICAgdGhpcy5fdG90YWwgPSBDMy5OZXcoQzMuS2FoYW5TdW0pOwogICAgICAgICAgICAgICAgdGhpcy5fdG90YWwuU2V0KHRvdGFsIHx8IDApOwogICAgICAgICAgICAgICAgdGhpcy5fZHVyYXRpb24gPSBkdXJhdGlvbiB8fCAwOwogICAgICAgICAgICAgICAgdGhpcy5faXNSZWd1bGFyID0gISFpc1JlZ3VsYXI7CiAgICAgICAgICAgICAgICB0aGlzLl9pc1BhdXNlZCA9IGZhbHNlCiAgICAgICAgICAgIH0KICAgICAgICAgICAgR2V0Q3VycmVudFRpbWUoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fY3VycmVudC5HZXQoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIEdldFRvdGFsVGltZSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl90b3RhbC5HZXQoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIEdldER1cmF0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2R1cmF0aW9uCiAgICAgICAgICAgIH0KICAgICAgICAgICAgU2V0UGF1c2VkKHApIHsKICAgICAgICAgICAgICAgIHRoaXMuX2lzUGF1c2VkID0gISFwCiAgICAgICAgICAgIH0KICAgICAgICAgICAgSXNQYXVzZWQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5faXNQYXVzZWQKICAgICAgICAgICAgfQogICAgICAgICAgICBBZGQodCkgewogICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudC5BZGQodCk7CiAgICAgICAgICAgICAgICB0aGlzLl90b3RhbC5BZGQodCkKICAgICAgICAgICAgfQogICAgICAgICAgICBIYXNGaW5pc2hlZCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9jdXJyZW50LkdldCgpID49IHRoaXMuX2R1cmF0aW9uCiAgICAgICAgICAgIH0KICAgICAgICAgICAgVXBkYXRlKCkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuSGFzRmluaXNoZWQoKSkKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5faXNSZWd1bGFyKSB0aGlzLl9jdXJyZW50LlN1YnRyYWN0KHRoaXMuX2R1cmF0aW9uKTsKICAgICAgICAgICAgICAgICAgICBlbHNlIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgICAgIH0KICAgICAgICAgICAgU2F2ZVRvSnNvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgImMiOiB0aGlzLl9jdXJyZW50LkdldCgpLAogICAgICAgICAgICAgICAgICAgICJ0IjogdGhpcy5fdG90YWwuR2V0KCksCiAgICAgICAgICAgICAgICAgICAgImQiOiB0aGlzLl9kdXJhdGlvbiwKICAgICAgICAgICAgICAgICAgICAiciI6IHRoaXMuX2lzUmVndWxhciwKICAgICAgICAgICAgICAgICAgICAicCI6IHRoaXMuX2lzUGF1c2VkCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgTG9hZEZyb21Kc29uKG8pIHsKICAgICAgICAgICAgICAgIHRoaXMuX2N1cnJlbnQuU2V0KG9bImMiXSk7CiAgICAgICAgICAgICAgICB0aGlzLl90b3RhbC5TZXQob1sidCJdKTsKICAgICAgICAgICAgICAgIHRoaXMuX2R1cmF0aW9uID0gb1siZCJdOwogICAgICAgICAgICAgICAgdGhpcy5faXNSZWd1bGFyID0gISFvWyJyIl07CiAgICAgICAgICAgICAgICB0aGlzLl9pc1BhdXNlZCA9ICEhb1sicCJdCiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIEMzLkJlaGF2aW9ycy5UaW1lci5JbnN0YW5jZSA9IGNsYXNzIFRpbWVySW5zdGFuY2UgZXh0ZW5kcyBDMy5TREtCZWhhdmlvckluc3RhbmNlQmFzZSB7CiAgICAgICAgICAgIGNvbnN0cnVjdG9yKGJlaEluc3QsIHByb3BlcnRpZXMpIHsKICAgICAgICAgICAgICAgIHN1cGVyKGJlaEluc3QpOwogICAgICAgICAgICAgICAgdGhpcy5fdGltZXJzID0gbmV3IE1hcAogICAgICAgICAgICB9CiAgICAgICAgICAgIFJlbGVhc2UoKSB7CiAgICAgICAgICAgICAgICB0aGlzLl90aW1lcnMuY2xlYXIoKTsKICAgICAgICAgICAgICAgIHN1cGVyLlJlbGVhc2UoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9TdGFydFRpbWVyKGR1cmF0aW9uLCBuYW1lLCBpc1JlZ3VsYXIpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHRpbWVyID0gbmV3IEMzLkJlaGF2aW9ycy5UaW1lci5TaW5nbGVUaW1lcigwLCAwLCBkdXJhdGlvbiwgaXNSZWd1bGFyKTsKICAgICAgICAgICAgICAgIHRoaXMuX3RpbWVycy5zZXQobmFtZS50b0xvd2VyQ2FzZSgpLCB0aW1lcik7CiAgICAgICAgICAgICAgICB0aGlzLl9VcGRhdGVUaWNrU3RhdGUoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9TdG9wVGltZXIobmFtZSkgewogICAgICAgICAgICAgICAgdGhpcy5fdGltZXJzLmRlbGV0ZShuYW1lLnRvTG93ZXJDYXNlKCkpOwogICAgICAgICAgICAgICAgdGhpcy5fVXBkYXRlVGlja1N0YXRlKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBfU3RvcEFsbFRpbWVycygpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3RpbWVycy5jbGVhcigpOwogICAgICAgICAgICAgICAgdGhpcy5fVXBkYXRlVGlja1N0YXRlKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBfSXNUaW1lclJ1bm5pbmcobmFtZSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RpbWVycy5oYXMobmFtZS50b0xvd2VyQ2FzZSgpKQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9HZXRUaW1lckN1cnJlbnRUaW1lKG5hbWUpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHRpbWVyID0gdGhpcy5fdGltZXJzLmdldChuYW1lLnRvTG93ZXJDYXNlKCkpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRpbWVyID8gdGltZXIuR2V0Q3VycmVudFRpbWUoKSA6IDAKICAgICAgICAgICAgfQogICAgICAgICAgICBfR2V0VGltZXJUb3RhbFRpbWUobmFtZSkgewogICAgICAgICAgICAgICAgY29uc3QgdGltZXIgPSB0aGlzLl90aW1lcnMuZ2V0KG5hbWUudG9Mb3dlckNhc2UoKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGltZXIgPyB0aW1lci5HZXRUb3RhbFRpbWUoKSA6IDAKICAgICAgICAgICAgfQogICAgICAgICAgICBfR2V0VGltZXJEdXJhdGlvbihuYW1lKSB7CiAgICAgICAgICAgICAgICBjb25zdCB0aW1lciA9IHRoaXMuX3RpbWVycy5nZXQobmFtZS50b0xvd2VyQ2FzZSgpKTsKICAgICAgICAgICAgICAgIHJldHVybiB0aW1lciA/IHRpbWVyLkdldER1cmF0aW9uKCkgOiAwCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX0hhc1RpbWVyRmluaXNoZWQobmFtZSkgewogICAgICAgICAgICAgICAgY29uc3QgdGltZXIgPSB0aGlzLl90aW1lcnMuZ2V0KG5hbWUudG9Mb3dlckNhc2UoKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGltZXIgPwogICAgICAgICAgICAgICAgICAgIHRpbWVyLkhhc0ZpbmlzaGVkKCkgOiBmYWxzZQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9TZXRUaW1lclBhdXNlZChuYW1lLCBpc1BhdXNlZCkgewogICAgICAgICAgICAgICAgY29uc3QgdGltZXIgPSB0aGlzLl90aW1lcnMuZ2V0KG5hbWUudG9Mb3dlckNhc2UoKSk7CiAgICAgICAgICAgICAgICBpZiAodGltZXIpIHRpbWVyLlNldFBhdXNlZChpc1BhdXNlZCkKICAgICAgICAgICAgfQogICAgICAgICAgICBfSXNUaW1lclBhdXNlZChuYW1lKSB7CiAgICAgICAgICAgICAgICBjb25zdCB0aW1lciA9IHRoaXMuX3RpbWVycy5nZXQobmFtZS50b0xvd2VyQ2FzZSgpKTsKICAgICAgICAgICAgICAgIHJldHVybiB0aW1lciA/IHRpbWVyLklzUGF1c2VkKCkgOiBmYWxzZQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9VcGRhdGVUaWNrU3RhdGUoKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fdGltZXJzLnNpemUgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fU3RhcnRUaWNraW5nKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fU3RhcnRUaWNraW5nMigpCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX1N0b3BUaWNraW5nKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fU3RvcFRpY2tpbmcyKCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBTYXZlVG9Kc29uKCkgewogICAgICAgICAgICAgICAgY29uc3QgcmV0ID0ge307CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IFtuYW1lLCB0aW1lcl0gb2YgdGhpcy5fdGltZXJzLmVudHJpZXMoKSkgcmV0W25hbWVdID0gdGltZXIuU2F2ZVRvSnNvbigpOwogICAgICAgICAgICAgICAgcmV0dXJuIHJldAogICAgICAgICAgICB9CiAgICAgICAgICAgIExvYWRGcm9tSnNvbihvKSB7CiAgICAgICAgICAgICAgICB0aGlzLl90aW1lcnMuY2xlYXIoKTsKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgW25hbWUsIGRhdGFdIG9mIE9iamVjdC5lbnRyaWVzKG8pKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdGltZXIgPSBuZXcgQzMuQmVoYXZpb3JzLlRpbWVyLlNpbmdsZVRpbWVyOwogICAgICAgICAgICAgICAgICAgIHRpbWVyLkxvYWRGcm9tSnNvbihkYXRhKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl90aW1lcnMuc2V0KG5hbWUsIHRpbWVyKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5fVXBkYXRlVGlja1N0YXRlKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBUaWNrKCkgewogICAgICAgICAgICAgICAgY29uc3QgZHQgPSB0aGlzLl9ydW50aW1lLkdldER0KHRoaXMuX2luc3QpOwogICAgICAgICAgICAgICAgZm9yIChjb25zdCBbbmFtZSwgdGltZXJdIG9mIHRoaXMuX3RpbWVycykKICAgICAgICAgICAgICAgICAgICBpZiAoIXRpbWVyLklzUGF1c2VkKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGltZXIuQWRkKGR0KTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRpbWVyLkhhc0ZpbmlzaGVkKCkpIHRoaXMuRGlzcGF0Y2hTY3JpcHRFdmVudCgidGltZXIiLCBmYWxzZSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFnOiBuYW1lCiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIFRpY2syKCkgewogICAgICAgICAgICAgICAgZm9yIChjb25zdCBbbmFtZSwgdGltZXJdIG9mIHRoaXMuX3RpbWVycy5lbnRyaWVzKCkpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBzaG91bGREZWxldGUgPSB0aW1lci5VcGRhdGUoKTsKICAgICAgICAgICAgICAgICAgICBpZiAoc2hvdWxkRGVsZXRlKSB0aGlzLl90aW1lcnMuZGVsZXRlKG5hbWUpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgR2V0RGVidWdnZXJQcm9wZXJ0aWVzKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIFt7CiAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICJiZWhhdmlvcnMudGltZXIuZGVidWdnZXIudGltZXJzIiwKICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiBbLi4udGhpcy5fdGltZXJzLmVudHJpZXMoKV0ubWFwKGVudHJ5ID0+ICh7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICIkIiArIGVudHJ5WzBdLAogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogYCR7TWF0aC5yb3VuZChlbnRyeVsxXS5HZXRDdXJyZW50VGltZSgpKjEwKS8xMH0gLyAke01hdGgucm91bmQoZW50cnlbMV0uR2V0RHVyYXRpb24oKSoxMCkvMTB9YAogICAgICAgICAgICAgICAgICAgIH0pKQogICAgICAgICAgICAgICAgfV0KICAgICAgICAgICAgfQogICAgICAgICAgICBHZXRTY3JpcHRJbnRlcmZhY2VDbGFzcygpIHsKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLklUaW1lckJlaGF2aW9ySW5zdGFuY2UKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgY29uc3QgbWFwID0gbmV3IFdlYWtNYXA7CiAgICAgICAgY29uc3QgVkFMSURfVElNRVJfVFlQRVMgPSBbIm9uY2UiLCAicmVndWxhciJdOwogICAgICAgIHNlbGYuSVRpbWVyQmVoYXZpb3JJbnN0YW5jZSA9IGNsYXNzIElUaW1lckJlaGF2aW9ySW5zdGFuY2UgZXh0ZW5kcyBJQmVoYXZpb3JJbnN0YW5jZSB7CiAgICAgICAgICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgICAgICAgICAgc3VwZXIoKTsKICAgICAgICAgICAgICAgIG1hcC5zZXQodGhpcywgSUJlaGF2aW9ySW5zdGFuY2UuX0dldEluaXRJbnN0KCkuR2V0U2RrSW5zdGFuY2UoKSkKICAgICAgICAgICAgfQogICAgICAgICAgICBzdGFydFRpbWVyKGR1cmF0aW9uLCBuYW1lLCB0eXBlID0KICAgICAgICAgICAgICAgICJvbmNlIikgewogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVGaW5pdGVOdW1iZXIoZHVyYXRpb24pOwogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVTdHJpbmcobmFtZSk7CiAgICAgICAgICAgICAgICBjb25zdCBpID0gVkFMSURfVElNRVJfVFlQRVMuaW5kZXhPZih0eXBlKTsKICAgICAgICAgICAgICAgIGlmIChpID09PSAtMSkgdGhyb3cgbmV3IEVycm9yKCJpbnZhbGlkIHR5cGUiKTsKICAgICAgICAgICAgICAgIG1hcC5nZXQodGhpcykuX1N0YXJ0VGltZXIoZHVyYXRpb24sIG5hbWUsIGkgPT09IDEpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2V0VGltZXJQYXVzZWQobmFtZSwgaXNQYXVzZWQpIHsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlU3RyaW5nKG5hbWUpOwogICAgICAgICAgICAgICAgbWFwLmdldCh0aGlzKS5fU2V0VGltZXJQYXVzZWQobmFtZSwgISFpc1BhdXNlZCkKICAgICAgICAgICAgfQogICAgICAgICAgICBzdG9wVGltZXIobmFtZSkgewogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVTdHJpbmcobmFtZSk7CiAgICAgICAgICAgICAgICBtYXAuZ2V0KHRoaXMpLl9TdG9wVGltZXIobmFtZSkKICAgICAgICAgICAgfQogICAgICAgICAgICBzdG9wQWxsVGltZXJzKCkgewogICAgICAgICAgICAgICAgbWFwLmdldCh0aGlzKS5fU3RvcEFsbFRpbWVycygpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaXNUaW1lclJ1bm5pbmcobmFtZSkgewogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVTdHJpbmcobmFtZSk7CiAgICAgICAgICAgICAgICByZXR1cm4gbWFwLmdldCh0aGlzKS5fSXNUaW1lclJ1bm5pbmcobmFtZSkKICAgICAgICAgICAgfQogICAgICAgICAgICBpc1RpbWVyUGF1c2VkKG5hbWUpIHsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlU3RyaW5nKG5hbWUpOwogICAgICAgICAgICAgICAgcmV0dXJuIG1hcC5nZXQodGhpcykuX0lzVGltZXJQYXVzZWQobmFtZSkKICAgICAgICAgICAgfQogICAgICAgICAgICBnZXRDdXJyZW50VGltZShuYW1lKSB7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZVN0cmluZyhuYW1lKTsKICAgICAgICAgICAgICAgIHJldHVybiBtYXAuZ2V0KHRoaXMpLl9HZXRUaW1lckN1cnJlbnRUaW1lKG5hbWUpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZ2V0VG90YWxUaW1lKG5hbWUpIHsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlU3RyaW5nKG5hbWUpOwogICAgICAgICAgICAgICAgcmV0dXJuIG1hcC5nZXQodGhpcykuX0dldFRpbWVyVG90YWxUaW1lKG5hbWUpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZ2V0RHVyYXRpb24obmFtZSkgewogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVTdHJpbmcobmFtZSk7CiAgICAgICAgICAgICAgICByZXR1cm4gbWFwLmdldCh0aGlzKS5fR2V0VGltZXJEdXJhdGlvbihuYW1lKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGhhc0ZpbmlzaGVkKG5hbWUpIHsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlU3RyaW5nKG5hbWUpOwogICAgICAgICAgICAgICAgcmV0dXJuIG1hcC5nZXQodGhpcykuX0hhc1RpbWVyRmluaXNoZWQobmFtZSkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gewogICAgICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgICAgICBDMy5CZWhhdmlvcnMuVGltZXIuQ25kcyA9IHsKICAgICAgICAgICAgT25UaW1lcihuYW1lKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fSGFzVGltZXJGaW5pc2hlZChuYW1lKQogICAgICAgICAgICB9LAogICAgICAgICAgICBJc1RpbWVyUnVubmluZyhuYW1lKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fSXNUaW1lclJ1bm5pbmcobmFtZSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgSXNUaW1lclBhdXNlZChuYW1lKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fSXNUaW1lclBhdXNlZChuYW1lKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSB7CiAgICAgICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgICAgIEMzLkJlaGF2aW9ycy5UaW1lci5BY3RzID0gewogICAgICAgICAgICBTdGFydFRpbWVyKGR1cmF0aW9uLCB0eXBlLCBuYW1lKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9TdGFydFRpbWVyKGR1cmF0aW9uLCBuYW1lLCB0eXBlID09PSAxKQogICAgICAgICAgICB9LAogICAgICAgICAgICBTdG9wVGltZXIobmFtZSkgewogICAgICAgICAgICAgICAgdGhpcy5fU3RvcFRpbWVyKG5hbWUpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFN0b3BBbGxUaW1lcnMoKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9TdG9wQWxsVGltZXJzKCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgUGF1c2VSZXN1bWVUaW1lcihuYW1lLCBzdGF0ZSkgewogICAgICAgICAgICAgICAgdGhpcy5fU2V0VGltZXJQYXVzZWQobmFtZSwgc3RhdGUgPT09IDApCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IHsKICAgICAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICAgICAgQzMuQmVoYXZpb3JzLlRpbWVyLkV4cHMgPSB7CiAgICAgICAgICAgIEN1cnJlbnRUaW1lKG5hbWUpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9HZXRUaW1lckN1cnJlbnRUaW1lKG5hbWUpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFRvdGFsVGltZShuYW1lKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fR2V0VGltZXJUb3RhbFRpbWUobmFtZSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgRHVyYXRpb24obmFtZSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX0dldFRpbWVyRHVyYXRpb24obmFtZSkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07Cgp9Cgp7CiAgICAndXNlIHN0cmljdCc7IHsKICAgICAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICAgICAgQzMuQmVoYXZpb3JzLkJ1bGxldCA9IGNsYXNzIEJ1bGxldEJlaGF2aW9yIGV4dGVuZHMgQzMuU0RLQmVoYXZpb3JCYXNlIHsKICAgICAgICAgICAgY29uc3RydWN0b3Iob3B0cykgewogICAgICAgICAgICAgICAgc3VwZXIob3B0cykKICAgICAgICAgICAgfQogICAgICAgICAgICBSZWxlYXNlKCkgewogICAgICAgICAgICAgICAgc3VwZXIuUmVsZWFzZSgpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IHsKICAgICAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICAgICAgQzMuQmVoYXZpb3JzLkJ1bGxldC5UeXBlID0gY2xhc3MgQnVsbGV0VHlwZSBleHRlbmRzIEMzLlNES0JlaGF2aW9yVHlwZUJhc2UgewogICAgICAgICAgICBjb25zdHJ1Y3RvcihiZWhhdmlvclR5cGUpIHsKICAgICAgICAgICAgICAgIHN1cGVyKGJlaGF2aW9yVHlwZSkKICAgICAgICAgICAgfQogICAgICAgICAgICBSZWxlYXNlKCkgewogICAgICAgICAgICAgICAgc3VwZXIuUmVsZWFzZSgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgT25DcmVhdGUoKSB7fQogICAgICAgIH0KICAgIH0gewogICAgICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgICAgICBjb25zdCBDM1ggPSBzZWxmLkMzWDsKICAgICAgICBjb25zdCBJQmVoYXZpb3JJbnN0YW5jZSA9IHNlbGYuSUJlaGF2aW9ySW5zdGFuY2U7CiAgICAgICAgY29uc3QgU1BFRUQgPSAwOwogICAgICAgIGNvbnN0IEFDQ0VMRVJBVElPTiA9IDE7CiAgICAgICAgY29uc3QgR1JBVklUWSA9IDI7CiAgICAgICAgY29uc3QgQk9VTkNFX09GRl9TT0xJRFMgPSAzOwogICAgICAgIGNvbnN0IFNFVF9BTkdMRSA9IDQ7CiAgICAgICAgY29uc3QgU1RFUFBJTkcgPSA1OwogICAgICAgIGNvbnN0IEVOQUJMRSA9IDY7CiAgICAgICAgQzMuQmVoYXZpb3JzLkJ1bGxldC5JbnN0YW5jZSA9IGNsYXNzIEJ1bGxldEluc3RhbmNlIGV4dGVuZHMgQzMuU0RLQmVoYXZpb3JJbnN0YW5jZUJhc2UgewogICAgICAgICAgICBjb25zdHJ1Y3RvcihiZWhJbnN0LCBwcm9wZXJ0aWVzKSB7CiAgICAgICAgICAgICAgICBzdXBlcihiZWhJbnN0KTsKICAgICAgICAgICAgICAgIGNvbnN0IHdpID0gdGhpcy5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgICAgIHRoaXMuX3NwZWVkID0gMDsKICAgICAgICAgICAgICAgIHRoaXMuX2FjYyA9IDA7CiAgICAgICAgICAgICAgICB0aGlzLl9nID0gMDsKICAgICAgICAgICAgICAgIHRoaXMuX2JvdW5jZU9mZlNvbGlkID0gZmFsc2U7CiAgICAgICAgICAgICAgICB0aGlzLl9zZXRBbmdsZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgdGhpcy5faXNTdGVwcGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgdGhpcy5faXNFbmFibGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHRoaXMuX2R4ID0KICAgICAgICAgICAgICAgICAgICAwOwogICAgICAgICAgICAgICAgdGhpcy5fZHkgPSAwOwogICAgICAgICAgICAgICAgdGhpcy5fbGFzdFggPSB3aS5HZXRYKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9sYXN0WSA9IHdpLkdldFkoKTsKICAgICAgICAgICAgICAgIHRoaXMuX2xhc3RLbm93bkFuZ2xlID0gd2kuR2V0QW5nbGUoKTsKICAgICAgICAgICAgICAgIHRoaXMuX3RyYXZlbGxlZCA9IDA7CiAgICAgICAgICAgICAgICB0aGlzLl9zdGVwU2l6ZSA9IE1hdGgubWluKE1hdGguYWJzKHdpLkdldFdpZHRoKCkpLCBNYXRoLmFicyh3aS5HZXRIZWlnaHQoKSkgLyAyKTsKICAgICAgICAgICAgICAgIHRoaXMuX3N0b3BTdGVwcGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgaWYgKHByb3BlcnRpZXMpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9zcGVlZCA9IHByb3BlcnRpZXNbU1BFRURdOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2FjYyA9IHByb3BlcnRpZXNbQUNDRUxFUkFUSU9OXTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9nID0gcHJvcGVydGllc1tHUkFWSVRZXTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9ib3VuY2VPZmZTb2xpZCA9ICEhcHJvcGVydGllc1tCT1VOQ0VfT0ZGX1NPTElEU107CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2V0QW5nbGUgPSAhIXByb3BlcnRpZXNbU0VUX0FOR0xFXTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9pc1N0ZXBwaW5nID0gISFwcm9wZXJ0aWVzW1NURVBQSU5HXTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9pc0VuYWJsZWQgPSAhIXByb3BlcnRpZXNbRU5BQkxFXQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY29uc3QgYSA9IHdpLkdldEFuZ2xlKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9keCA9IE1hdGguY29zKGEpICogdGhpcy5fc3BlZWQ7CiAgICAgICAgICAgICAgICB0aGlzLl9keSA9IE1hdGguc2luKGEpICogdGhpcy5fc3BlZWQ7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5faXNFbmFibGVkKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fU3RhcnRUaWNraW5nKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX2JvdW5jZU9mZlNvbGlkKSB0aGlzLl9TdGFydFBvc3RUaWNraW5nKCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBSZWxlYXNlKCkgewogICAgICAgICAgICAgICAgc3VwZXIuUmVsZWFzZSgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgU2F2ZVRvSnNvbigpIHsKICAgICAgICAgICAgICAgIGNvbnN0IG8gPSB7CiAgICAgICAgICAgICAgICAgICAgImR4IjogdGhpcy5fZHgsCiAgICAgICAgICAgICAgICAgICAgImR5IjogdGhpcy5fZHksCiAgICAgICAgICAgICAgICAgICAgImx4IjogdGhpcy5fbGFzdFgsCiAgICAgICAgICAgICAgICAgICAgImx5IjogdGhpcy5fbGFzdFksCiAgICAgICAgICAgICAgICAgICAgImxrYSI6IHRoaXMuX2xhc3RLbm93bkFuZ2xlLAogICAgICAgICAgICAgICAgICAgICJ0IjogdGhpcy5fdHJhdmVsbGVkCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgaWYgKHRoaXMuX2FjYyAhPT0gMCkgb1siYWNjIl0gPSB0aGlzLl9hY2M7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fZyAhPT0gMCkgb1siZyJdID0gdGhpcy5fZzsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9pc1N0ZXBwaW5nKSBvWyJzdCJdID0gdGhpcy5faXNTdGVwcGluZzsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5faXNFbmFibGVkKSBvWyJlIl0gPSB0aGlzLl9pc0VuYWJsZWQ7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fYm91bmNlT2ZmU29saWQpIG9bImJvcyJdID0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9ib3VuY2VPZmZTb2xpZDsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9zZXRBbmdsZSkgb1sic2EiXSA9IHRoaXMuX3NldEFuZ2xlOwogICAgICAgICAgICAgICAgcmV0dXJuIG8KICAgICAgICAgICAgfQogICAgICAgICAgICBMb2FkRnJvbUpzb24obykgewogICAgICAgICAgICAgICAgdGhpcy5fZHggPSBvWyJkeCJdOwogICAgICAgICAgICAgICAgdGhpcy5fZHkgPSBvWyJkeSJdOwogICAgICAgICAgICAgICAgdGhpcy5fbGFzdFggPSBvWyJseCJdOwogICAgICAgICAgICAgICAgdGhpcy5fbGFzdFkgPSBvWyJseSJdOwogICAgICAgICAgICAgICAgdGhpcy5fbGFzdEtub3duQW5nbGUgPSBvWyJsa2EiXTsKICAgICAgICAgICAgICAgIHRoaXMuX3RyYXZlbGxlZCA9IG9bInQiXTsKICAgICAgICAgICAgICAgIHRoaXMuX2FjYyA9IG8uaGFzT3duUHJvcGVydHkoImFjYyIpID8gb1siYWNjIl0gOiAwOwogICAgICAgICAgICAgICAgdGhpcy5fZyA9IG8uaGFzT3duUHJvcGVydHkoImciKSA/IG9bImciXSA6IDA7CiAgICAgICAgICAgICAgICB0aGlzLl9pc1N0ZXBwaW5nID0gby5oYXNPd25Qcm9wZXJ0eSgic3QiKSA/IG9bInN0Il0gOiBmYWxzZTsKICAgICAgICAgICAgICAgIHRoaXMuX2JvdW5jZU9mZlNvbGlkID0gby5oYXNPd25Qcm9wZXJ0eSgiYm9zIikgPyBvWyJib3MiXSA6IGZhbHNlOwogICAgICAgICAgICAgICAgdGhpcy5fc2V0QW5nbGUgPSBvLmhhc093blByb3BlcnR5KCJzYSIpID8gb1sic2EiXSA6IGZhbHNlOwogICAgICAgICAgICAgICAgdGhpcy5fU2V0RW5hYmxlZChvLmhhc093blByb3BlcnR5KCJlIikgPwogICAgICAgICAgICAgICAgICAgIG9bImUiXSA6IHRydWUpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgVGljaygpIHsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5faXNFbmFibGVkKSByZXR1cm47CiAgICAgICAgICAgICAgICBjb25zdCBkdCA9IHRoaXMuX3J1bnRpbWUuR2V0RHQodGhpcy5faW5zdCk7CiAgICAgICAgICAgICAgICBjb25zdCB3aSA9IHRoaXMuX2luc3QuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgICAgICBpZiAod2kuR2V0QW5nbGUoKSAhPT0gdGhpcy5fbGFzdEtub3duQW5nbGUpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBhbmdsZSA9IHdpLkdldEFuZ2xlKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX3NldEFuZ2xlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHMgPSBDMy5kaXN0YW5jZVRvKDAsIDAsIHRoaXMuX2R4LCB0aGlzLl9keSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2R4ID0gTWF0aC5jb3MoYW5nbGUpICogczsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fZHkgPSBNYXRoLnNpbihhbmdsZSkgKiBzCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHRoaXMuX2xhc3RLbm93bkFuZ2xlID0gYW5nbGUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGxldCB4YWNjID0gMDsKICAgICAgICAgICAgICAgIGxldCB5YWNjID0gMDsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9hY2MgIT09IDApIHsKICAgICAgICAgICAgICAgICAgICBsZXQgcyA9IEMzLmRpc3RhbmNlVG8oMCwgMCwgdGhpcy5fZHgsIHRoaXMuX2R5KTsKICAgICAgICAgICAgICAgICAgICBsZXQgYSA9IDA7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX2R4ID09PSAwICYmIHRoaXMuX2R5ID09PSAwKSBhID0gd2kuR2V0QW5nbGUoKTsKICAgICAgICAgICAgICAgICAgICBlbHNlIGEgPSBDMy5hbmdsZVRvKDAsIDAsIHRoaXMuX2R4LAogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9keSk7CiAgICAgICAgICAgICAgICAgICAgcyArPSB0aGlzLl9hY2MgKiBkdDsKICAgICAgICAgICAgICAgICAgICB4YWNjID0gTWF0aC5jb3MoYSkgKiB0aGlzLl9hY2M7CiAgICAgICAgICAgICAgICAgICAgeWFjYyA9IE1hdGguc2luKGEpICogdGhpcy5fYWNjOwogICAgICAgICAgICAgICAgICAgIGlmIChzIDwgMCkgewogICAgICAgICAgICAgICAgICAgICAgICBzID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgeGFjYyA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIHlhY2MgPSAwCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHRoaXMuX2R4ID0gTWF0aC5jb3MoYSkgKiBzOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2R5ID0gTWF0aC5zaW4oYSkgKiBzCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fZyAhPT0gMCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX2R5ICs9IHRoaXMuX2cgKiBkdDsKICAgICAgICAgICAgICAgICAgICB5YWNjICs9IHRoaXMuX2cKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMuX2xhc3RYID0gd2kuR2V0WCgpOwogICAgICAgICAgICAgICAgdGhpcy5fbGFzdFkgPSB3aS5HZXRZKCk7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fZHggIT09IDAgfHwgdGhpcy5fZHkgIT09IDApIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBteCA9IHRoaXMuX2R4ICogZHQgKyAuNSAqIHhhY2MgKiBkdCAqIGR0OwogICAgICAgICAgICAgICAgICAgIGNvbnN0IG15ID0gdGhpcy5fZHkgKiBkdCArIC41ICogeWFjYyAqIGR0ICogZHQ7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RlcERpc3QgPSBDMy5kaXN0YW5jZVRvKDAsIDAsIG14LCBteSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fTW92ZUJ5KG14LCBteSwgc3RlcERpc3QpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3RyYXZlbGxlZCArPSBzdGVwRGlzdDsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fc2V0QW5nbGUgJiYgKG14ICE9PSAwIHx8IG15ICE9PSAwKSkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhID0gQzMuYW5nbGVUbygwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgMCwgbXgsIG15KTsKICAgICAgICAgICAgICAgICAgICAgICAgd2kuU2V0QW5nbGUoYSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2xhc3RLbm93bkFuZ2xlID0gd2kuR2V0QW5nbGUoKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB3aS5TZXRCYm94Q2hhbmdlZCgpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX01vdmVCeShteCwgbXksIHN0ZXBEaXN0KSB7CiAgICAgICAgICAgICAgICBjb25zdCB3aSA9IHRoaXMuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX2lzU3RlcHBpbmcgfHwgc3RlcERpc3QgPD0gdGhpcy5fc3RlcFNpemUpIHsKICAgICAgICAgICAgICAgICAgICB3aS5PZmZzZXRYWShteCwgbXkpOwogICAgICAgICAgICAgICAgICAgIHdpLlNldEJib3hDaGFuZ2VkKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX2lzU3RlcHBpbmcpIHRoaXMuVHJpZ2dlcihDMy5CZWhhdmlvcnMuQnVsbGV0LkNuZHMuT25TdGVwKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMuX3N0b3BTdGVwcGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgY29uc3Qgc3RhcnRYID0gd2kuR2V0WCgpOwogICAgICAgICAgICAgICAgY29uc3Qgc3RhcnRZID0gd2kuR2V0WSgpOwogICAgICAgICAgICAgICAgY29uc3QgZW5kWCA9IHN0YXJ0WCArIG14OwogICAgICAgICAgICAgICAgY29uc3QgZW5kWSA9IHN0YXJ0WSArIG15OwogICAgICAgICAgICAgICAgY29uc3QgYSA9IEMzLmFuZ2xlVG8oMCwgMCwgbXgsIG15KTsKICAgICAgICAgICAgICAgIGNvbnN0IHN0ZXBYID0gTWF0aC5jb3MoYSkgKiB0aGlzLl9zdGVwU2l6ZTsKICAgICAgICAgICAgICAgIGNvbnN0IHN0ZXBZID0gTWF0aC5zaW4oYSkgKiB0aGlzLl9zdGVwU2l6ZTsKICAgICAgICAgICAgICAgIGNvbnN0IHN0ZXBDb3VudCA9IE1hdGguZmxvb3Ioc3RlcERpc3QgLyB0aGlzLl9zdGVwU2l6ZSk7CiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8PSBzdGVwQ291bnQ7ICsraSkgewogICAgICAgICAgICAgICAgICAgIHdpLlNldFhZKHN0YXJ0WCArIHN0ZXBYICogaSwgc3RhcnRZICsgc3RlcFkgKiBpKTsKICAgICAgICAgICAgICAgICAgICB3aS5TZXRCYm94Q2hhbmdlZCgpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuVHJpZ2dlcihDMy5CZWhhdmlvcnMuQnVsbGV0LkNuZHMuT25TdGVwKTsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5faW5zdC5Jc0Rlc3Ryb3llZCgpIHx8IHRoaXMuX3N0b3BTdGVwcGluZykgcmV0dXJuCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB3aS5TZXRYWShlbmRYLCBlbmRZKTsKICAgICAgICAgICAgICAgIHdpLlNldEJib3hDaGFuZ2VkKCk7CiAgICAgICAgICAgICAgICB0aGlzLlRyaWdnZXIoQzMuQmVoYXZpb3JzLkJ1bGxldC5DbmRzLk9uU3RlcCkKICAgICAgICAgICAgfQogICAgICAgICAgICBQb3N0VGljaygpIHsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5faXNFbmFibGVkIHx8ICF0aGlzLl9ib3VuY2VPZmZTb2xpZCB8fCB0aGlzLl9keCA9PT0gMCAmJiB0aGlzLl9keSA9PT0gMCkgcmV0dXJuOwogICAgICAgICAgICAgICAgY29uc3QgZHQgPSB0aGlzLl9ydW50aW1lLkdldER0KHRoaXMuX2luc3QpOwogICAgICAgICAgICAgICAgY29uc3Qgd2kgPSB0aGlzLl9pbnN0LkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICAgICAgY29uc3QgY29sbGlzaW9uRW5naW5lID0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9ydW50aW1lLkdldENvbGxpc2lvbkVuZ2luZSgpOwogICAgICAgICAgICAgICAgY29uc3QgYm91bmNlU29saWQgPSBjb2xsaXNpb25FbmdpbmUuVGVzdE92ZXJsYXBTb2xpZCh0aGlzLl9pbnN0KTsKICAgICAgICAgICAgICAgIGlmIChib3VuY2VTb2xpZCkgewogICAgICAgICAgICAgICAgICAgIGNvbGxpc2lvbkVuZ2luZS5SZWdpc3RlckNvbGxpc2lvbih0aGlzLl9pbnN0LCBib3VuY2VTb2xpZCk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcyA9IEMzLmRpc3RhbmNlVG8oMCwgMCwgdGhpcy5fZHgsIHRoaXMuX2R5KTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBib3VuY2VBbmdsZSA9IGNvbGxpc2lvbkVuZ2luZS5DYWxjdWxhdGVCb3VuY2VBbmdsZSh0aGlzLl9pbnN0LCB0aGlzLl9sYXN0WCwgdGhpcy5fbGFzdFkpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2R4ID0gTWF0aC5jb3MoYm91bmNlQW5nbGUpICogczsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9keSA9IE1hdGguc2luKGJvdW5jZUFuZ2xlKSAqIHM7CiAgICAgICAgICAgICAgICAgICAgd2kuT2Zmc2V0WFkodGhpcy5fZHggKiBkdCwgdGhpcy5fZHkgKiBkdCk7CiAgICAgICAgICAgICAgICAgICAgd2kuU2V0QmJveENoYW5nZWQoKTsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fc2V0QW5nbGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgd2kuU2V0QW5nbGUoYm91bmNlQW5nbGUpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9sYXN0S25vd25BbmdsZSA9IHdpLkdldEFuZ2xlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpLlNldEJib3hDaGFuZ2VkKCkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKCFjb2xsaXNpb25FbmdpbmUuUHVzaE91dFNvbGlkKHRoaXMuX2luc3QsIHRoaXMuX2R4IC8gcywgdGhpcy5fZHkgLyBzLCBNYXRoLm1heChzICogMi41ICogZHQsIDMwKSkpIGNvbGxpc2lvbkVuZ2luZS5QdXNoT3V0U29saWROZWFyZXN0KHRoaXMuX2luc3QsIDEwMCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBHZXRQcm9wZXJ0eVZhbHVlQnlJbmRleChpbmRleCkgewogICAgICAgICAgICAgICAgc3dpdGNoIChpbmRleCkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgU1BFRUQ6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9HZXRTcGVlZCgpOwogICAgICAgICAgICAgICAgICAgIGNhc2UgQUNDRUxFUkFUSU9OOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fR2V0QWNjZWxlcmF0aW9uKCk7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBHUkFWSVRZOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fR2V0R3Jhdml0eSgpOwogICAgICAgICAgICAgICAgICAgIGNhc2UgU0VUX0FOR0xFOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fc2V0QW5nbGU7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBTVEVQUElORzoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2lzU3RlcHBpbmc7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBFTkFCTEU6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9Jc0VuYWJsZWQoKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIFNldFByb3BlcnR5VmFsdWVCeUluZGV4KGluZGV4LCB2YWx1ZSkgewogICAgICAgICAgICAgICAgc3dpdGNoIChpbmRleCkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgU1BFRUQ6CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX1NldFNwZWVkKHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBBQ0NFTEVSQVRJT046CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2FjYyA9IHZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIEdSQVZJVFk6CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2cgPSB2YWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBTRVRfQU5HTEU6CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3NldEFuZ2xlID0gISF2YWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBTVEVQUElORzoKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5faXNTdGVwcGluZyA9ICEhdmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgRU5BQkxFOgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9TZXRFbmFibGVkKCEhdmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9TZXRTcGVlZChzKSB7CiAgICAgICAgICAgICAgICBjb25zdCBhID0gQzMuYW5nbGVUbygwLCAwLCB0aGlzLl9keCwgdGhpcy5fZHkpOwogICAgICAgICAgICAgICAgdGhpcy5fZHggPSBNYXRoLmNvcyhhKSAqIHM7CiAgICAgICAgICAgICAgICB0aGlzLl9keSA9IE1hdGguc2luKGEpICogcwogICAgICAgICAgICB9CiAgICAgICAgICAgIF9HZXRTcGVlZCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBDMy5yb3VuZFRvRHAoQzMuZGlzdGFuY2VUbygwLCAwLCB0aGlzLl9keCwgdGhpcy5fZHkpLCA2KQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9TZXRBY2NlbGVyYXRpb24oYSkgewogICAgICAgICAgICAgICAgdGhpcy5fYWNjID0gYQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9HZXRBY2NlbGVyYXRpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fYWNjCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX1NldEdyYXZpdHkoZykgewogICAgICAgICAgICAgICAgdGhpcy5fZyA9IGcKICAgICAgICAgICAgfQogICAgICAgICAgICBfR2V0R3Jhdml0eSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX1NldEFuZ2xlT2ZNb3Rpb24oYSkgewogICAgICAgICAgICAgICAgY29uc3QgcyA9CiAgICAgICAgICAgICAgICAgICAgQzMuZGlzdGFuY2VUbygwLCAwLCB0aGlzLl9keCwgdGhpcy5fZHkpOwogICAgICAgICAgICAgICAgdGhpcy5fZHggPSBNYXRoLmNvcyhhKSAqIHM7CiAgICAgICAgICAgICAgICB0aGlzLl9keSA9IE1hdGguc2luKGEpICogcwogICAgICAgICAgICB9CiAgICAgICAgICAgIF9HZXRBbmdsZU9mTW90aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIEMzLmFuZ2xlVG8oMCwgMCwgdGhpcy5fZHgsIHRoaXMuX2R5KQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9TZXRCb3VuY2VPZmZTb2xpZHMoYikgewogICAgICAgICAgICAgICAgYiA9ICEhYjsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9ib3VuY2VPZmZTb2xpZCA9PT0gYikgcmV0dXJuOwogICAgICAgICAgICAgICAgdGhpcy5fYm91bmNlT2ZmU29saWQgPSBiOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuX2lzRW5hYmxlZCkKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fYm91bmNlT2ZmU29saWQpIHRoaXMuX1N0YXJ0UG9zdFRpY2tpbmcoKTsKICAgICAgICAgICAgICAgICAgICBlbHNlIHRoaXMuX1N0b3BQb3N0VGlja2luZygpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX0lzQm91bmNlT2ZmU29saWRzKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2JvdW5jZU9mZlNvbGlkCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX1NldERpc3RhbmNlVHJhdmVsbGVkKGQpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3RyYXZlbGxlZCA9IGQKICAgICAgICAgICAgfQogICAgICAgICAgICBfR2V0RGlzdGFuY2VUcmF2ZWxsZWQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fdHJhdmVsbGVkCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX1NldEVuYWJsZWQoZSkgewogICAgICAgICAgICAgICAgdGhpcy5faXNFbmFibGVkID0gISFlOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuX2lzRW5hYmxlZCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX1N0YXJ0VGlja2luZygpOwogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9ib3VuY2VPZmZTb2xpZCkgdGhpcy5fU3RhcnRQb3N0VGlja2luZygpCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX1N0b3BUaWNraW5nKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fU3RvcFBvc3RUaWNraW5nKCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBfSXNFbmFibGVkKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2lzRW5hYmxlZAogICAgICAgICAgICB9CiAgICAgICAgICAgIEdldERlYnVnZ2VyUHJvcGVydGllcygpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHByZWZpeCA9ICJiZWhhdmlvcnMuYnVsbGV0IjsKICAgICAgICAgICAgICAgIHJldHVybiBbewogICAgICAgICAgICAgICAgICAgIHRpdGxlOiAiJCIgKyB0aGlzLkdldEJlaGF2aW9yVHlwZSgpLkdldE5hbWUoKSwKICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiBbewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBwcmVmaXggKyAiLmRlYnVnZ2VyLnZlY3Rvci14IiwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuX2R4LAogICAgICAgICAgICAgICAgICAgICAgICBvbmVkaXQ6IHYgPT4gdGhpcy5fZHggPSB2CiAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBwcmVmaXggKyAiLmRlYnVnZ2VyLnZlY3Rvci15IiwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuX2R5LAogICAgICAgICAgICAgICAgICAgICAgICBvbmVkaXQ6IHYgPT4gdGhpcy5fZHkgPSB2CiAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBwcmVmaXggKyAiLnByb3BlcnRpZXMuc3BlZWQubmFtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLl9HZXRTcGVlZCgpLAogICAgICAgICAgICAgICAgICAgICAgICBvbmVkaXQ6IHYgPT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX1NldFNwZWVkKHYpCiAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBwcmVmaXggKyAiLmRlYnVnZ2VyLmFuZ2xlLW9mLW1vdGlvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBDMy50b0RlZ3JlZXModGhpcy5fR2V0QW5nbGVPZk1vdGlvbigpKQogICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogcHJlZml4ICsgIi5wcm9wZXJ0aWVzLmdyYXZpdHkubmFtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLl9HZXRHcmF2aXR5KCksCiAgICAgICAgICAgICAgICAgICAgICAgIG9uZWRpdDogdiA9PiB0aGlzLl9TZXRHcmF2aXR5KHYpCiAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBwcmVmaXggKyAiLnByb3BlcnRpZXMuYWNjZWxlcmF0aW9uLm5hbWUiLAogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5fR2V0QWNjZWxlcmF0aW9uKCksCiAgICAgICAgICAgICAgICAgICAgICAgIG9uZWRpdDogdiA9PiB0aGlzLl9TZXRBY2NlbGVyYXRpb24odikKICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHByZWZpeCArICIuZGVidWdnZXIuZGlzdGFuY2UtdHJhdmVsbGVkIiwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuX0dldERpc3RhbmNlVHJhdmVsbGVkKCkKICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHByZWZpeCArICIucHJvcGVydGllcy5lbmFibGVkLm5hbWUiLAogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5fSXNFbmFibGVkKCksCiAgICAgICAgICAgICAgICAgICAgICAgIG9uZWRpdDogdiA9PiB0aGlzLl9TZXRFbmFibGVkKHYpCiAgICAgICAgICAgICAgICAgICAgfV0KICAgICAgICAgICAgICAgIH1dCiAgICAgICAgICAgIH0KICAgICAgICAgICAgR2V0U2NyaXB0SW50ZXJmYWNlQ2xhc3MoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5JQnVsbGV0QmVoYXZpb3JJbnN0YW5jZQogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICBjb25zdCBtYXAgPSBuZXcgV2Vha01hcDsKICAgICAgICBzZWxmLklCdWxsZXRCZWhhdmlvckluc3RhbmNlID0gY2xhc3MgSUJ1bGxldEJlaGF2aW9ySW5zdGFuY2UgZXh0ZW5kcyBJQmVoYXZpb3JJbnN0YW5jZSB7CiAgICAgICAgICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgICAgICAgICAgc3VwZXIoKTsKICAgICAgICAgICAgICAgIG1hcC5zZXQodGhpcywgSUJlaGF2aW9ySW5zdGFuY2UuX0dldEluaXRJbnN0KCkuR2V0U2RrSW5zdGFuY2UoKSkKICAgICAgICAgICAgfQogICAgICAgICAgICBnZXQgc3BlZWQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbWFwLmdldCh0aGlzKS5fR2V0U3BlZWQoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHNldCBzcGVlZChzKSB7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcihzKTsKICAgICAgICAgICAgICAgIG1hcC5nZXQodGhpcykuX1NldFNwZWVkKHMpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZ2V0IGFjY2VsZXJhdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBtYXAuZ2V0KHRoaXMpLl9HZXRBY2NlbGVyYXRpb24oKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHNldCBhY2NlbGVyYXRpb24oYSkgewogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVGaW5pdGVOdW1iZXIoYSk7CiAgICAgICAgICAgICAgICBtYXAuZ2V0KHRoaXMpLl9TZXRBY2NlbGVyYXRpb24oYSkKICAgICAgICAgICAgfQogICAgICAgICAgICBnZXQgZ3Jhdml0eSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBtYXAuZ2V0KHRoaXMpLl9HZXRHcmF2aXR5KCkKICAgICAgICAgICAgfQogICAgICAgICAgICBzZXQgZ3Jhdml0eShnKSB7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcihnKTsKICAgICAgICAgICAgICAgIG1hcC5nZXQodGhpcykuX1NldEdyYXZpdHkoZykKICAgICAgICAgICAgfQogICAgICAgICAgICBnZXQgYW5nbGVPZk1vdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBtYXAuZ2V0KHRoaXMpLl9HZXRBbmdsZU9mTW90aW9uKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBzZXQgYW5nbGVPZk1vdGlvbihhKSB7CiAgICAgICAgICAgICAgICBDM1guUmVxdWlyZUZpbml0ZU51bWJlcihhKTsKICAgICAgICAgICAgICAgIG1hcC5nZXQodGhpcykuX1NldEFuZ2xlT2ZNb3Rpb24oYSkKICAgICAgICAgICAgfQogICAgICAgICAgICBnZXQgYm91bmNlT2ZmU29saWRzKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIG1hcC5nZXQodGhpcykuX0lzQm91bmNlT2ZmU29saWRzKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBzZXQgYm91bmNlT2ZmU29saWRzKGIpIHsKICAgICAgICAgICAgICAgIG1hcC5nZXQodGhpcykuX1NldEJvdW5jZU9mZlNvbGlkcyghIWIpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZ2V0IGRpc3RhbmNlVHJhdmVsbGVkKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIG1hcC5nZXQodGhpcykuX0dldERpc3RhbmNlVHJhdmVsbGVkKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBzZXQgZGlzdGFuY2VUcmF2ZWxsZWQoZCkgewogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVGaW5pdGVOdW1iZXIoZCk7CiAgICAgICAgICAgICAgICBtYXAuZ2V0KHRoaXMpLl9TZXREaXN0YW5jZVRyYXZlbGxlZChkKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGdldCBpc0VuYWJsZWQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbWFwLmdldCh0aGlzKS5fSXNFbmFibGVkKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBzZXQgaXNFbmFibGVkKGUpIHsKICAgICAgICAgICAgICAgIG1hcC5nZXQodGhpcykuX1NldEVuYWJsZWQoZSkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gewogICAgICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgICAgICBDMy5CZWhhdmlvcnMuQnVsbGV0LkNuZHMgPSB7CiAgICAgICAgICAgIENvbXBhcmVTcGVlZChjbXAsIHMpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHNwZWVkID0gTWF0aC5oeXBvdCh0aGlzLl9keCwgdGhpcy5fZHkpOwogICAgICAgICAgICAgICAgcmV0dXJuIEMzLmNvbXBhcmUoc3BlZWQsIGNtcCwgcykKICAgICAgICAgICAgfSwKICAgICAgICAgICAgQ29tcGFyZVRyYXZlbGxlZChjbXAsIGQpIHsKICAgICAgICAgICAgICAgIHJldHVybiBDMy5jb21wYXJlKHRoaXMuX0dldERpc3RhbmNlVHJhdmVsbGVkKCksIGNtcCwgZCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgT25TdGVwKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICAgICAgfSwKICAgICAgICAgICAgSXNFbmFibGVkKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX0lzRW5hYmxlZCgpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IHsKICAgICAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICAgICAgQzMuQmVoYXZpb3JzLkJ1bGxldC5BY3RzID0gewogICAgICAgICAgICBTZXRTcGVlZChzKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9TZXRTcGVlZChzKQogICAgICAgICAgICB9LAogICAgICAgICAgICBTZXRBY2NlbGVyYXRpb24oYSkgewogICAgICAgICAgICAgICAgdGhpcy5fU2V0QWNjZWxlcmF0aW9uKGEpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFNldEdyYXZpdHkoZykgewogICAgICAgICAgICAgICAgdGhpcy5fU2V0R3Jhdml0eShnKQogICAgICAgICAgICB9LAogICAgICAgICAgICBTZXRBbmdsZU9mTW90aW9uKGEpIHsKICAgICAgICAgICAgICAgIHRoaXMuX1NldEFuZ2xlT2ZNb3Rpb24oQzMudG9SYWRpYW5zKGEpKQogICAgICAgICAgICB9LAogICAgICAgICAgICBCb3VuY2Uob2JqZWN0Q2xhc3MpIHsKICAgICAgICAgICAgICAgIGlmICghb2JqZWN0Q2xhc3MpIHJldHVybjsKICAgICAgICAgICAgICAgIGNvbnN0IG90aGVySW5zdCA9IG9iamVjdENsYXNzLkdldEZpcnN0UGlja2VkKHRoaXMuX2luc3QpOwogICAgICAgICAgICAgICAgaWYgKCFvdGhlckluc3QpIHJldHVybjsKICAgICAgICAgICAgICAgIGNvbnN0IHdpID0gdGhpcy5faW5zdC5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgICAgIGNvbnN0IGNvbGxpc2lvbkVuZ2luZSA9IHRoaXMuX3J1bnRpbWUuR2V0Q29sbGlzaW9uRW5naW5lKCk7CiAgICAgICAgICAgICAgICBjb25zdCBkdCA9IHRoaXMuX3J1bnRpbWUuR2V0RHQodGhpcy5faW5zdCk7CiAgICAgICAgICAgICAgICBjb25zdCBzID0gQzMuZGlzdGFuY2VUbygwLCAwLCB0aGlzLl9keCwKICAgICAgICAgICAgICAgICAgICB0aGlzLl9keSk7CiAgICAgICAgICAgICAgICBjb25zdCBib3VuY2VBbmdsZSA9IGNvbGxpc2lvbkVuZ2luZS5DYWxjdWxhdGVCb3VuY2VBbmdsZSh0aGlzLl9pbnN0LCB0aGlzLl9sYXN0WCwgdGhpcy5fbGFzdFksIG90aGVySW5zdCk7CiAgICAgICAgICAgICAgICB0aGlzLl9keCA9IE1hdGguY29zKGJvdW5jZUFuZ2xlKSAqIHM7CiAgICAgICAgICAgICAgICB0aGlzLl9keSA9IE1hdGguc2luKGJvdW5jZUFuZ2xlKSAqIHM7CiAgICAgICAgICAgICAgICB3aS5PZmZzZXRYWSh0aGlzLl9keCAqIGR0LCB0aGlzLl9keSAqIGR0KTsKICAgICAgICAgICAgICAgIHdpLlNldEJib3hDaGFuZ2VkKCk7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fc2V0QW5nbGUpIHsKICAgICAgICAgICAgICAgICAgICB3aS5TZXRBbmdsZShib3VuY2VBbmdsZSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbGFzdEtub3duQW5nbGUgPSB3aS5HZXRBbmdsZSgpOwogICAgICAgICAgICAgICAgICAgIHdpLlNldEJib3hDaGFuZ2VkKCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChzICE9PSAwKQogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9ib3VuY2VPZmZTb2xpZCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWNvbGxpc2lvbkVuZ2luZS5QdXNoT3V0U29saWQodGhpcy5faW5zdCwgdGhpcy5fZHggLyBzLCB0aGlzLl9keSAvIHMsIE1hdGgubWF4KHMgKiAyLjUgKiBkdCwgMzApKSkgY29sbGlzaW9uRW5naW5lLlB1c2hPdXRTb2xpZE5lYXJlc3QodGhpcy5faW5zdCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDEwMCkKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgY29sbGlzaW9uRW5naW5lLlB1c2hPdXQodGhpcy5faW5zdCwgdGhpcy5fZHggLyBzLCB0aGlzLl9keSAvIHMsIE1hdGgubWF4KHMgKiAyLjUgKiBkdCwgMzApLCBvdGhlckluc3QpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFNldEJvdW5jZU9mZlNvbGlkcyhiKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9TZXRCb3VuY2VPZmZTb2xpZHMoYikKICAgICAgICAgICAgfSwKICAgICAgICAgICAgU2V0RGlzdGFuY2VUcmF2ZWxsZWQoZCkgewogICAgICAgICAgICAgICAgdGhpcy5fU2V0RGlzdGFuY2VUcmF2ZWxsZWQoZCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgU2V0RW5hYmxlZChlKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9TZXRFbmFibGVkKGUpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFN0b3BTdGVwcGluZygpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3N0b3BTdGVwcGluZyA9IHRydWUKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gewogICAgICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgICAgICBDMy5CZWhhdmlvcnMuQnVsbGV0LkV4cHMgPSB7CiAgICAgICAgICAgIFNwZWVkKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX0dldFNwZWVkKCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgQWNjZWxlcmF0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX0dldEFjY2VsZXJhdGlvbigpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIEFuZ2xlT2ZNb3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gQzMudG9EZWdyZWVzKHRoaXMuX0dldEFuZ2xlT2ZNb3Rpb24oKSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgRGlzdGFuY2VUcmF2ZWxsZWQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fR2V0RGlzdGFuY2VUcmF2ZWxsZWQoKQogICAgICAgICAgICB9LAogICAgICAgICAgICBHcmF2aXR5KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX0dldEdyYXZpdHkoKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKCn0KCnsKICAgICd1c2Ugc3RyaWN0JzsgewogICAgICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgICAgICBDMy5CZWhhdmlvcnMuU2luID0gY2xhc3MgU2luQmVoYXZpb3IgZXh0ZW5kcyBDMy5TREtCZWhhdmlvckJhc2UgewogICAgICAgICAgICBjb25zdHJ1Y3RvcihvcHRzKSB7CiAgICAgICAgICAgICAgICBzdXBlcihvcHRzKQogICAgICAgICAgICB9CiAgICAgICAgICAgIFJlbGVhc2UoKSB7CiAgICAgICAgICAgICAgICBzdXBlci5SZWxlYXNlKCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gewogICAgICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgICAgICBDMy5CZWhhdmlvcnMuU2luLlR5cGUgPSBjbGFzcyBTaW5UeXBlIGV4dGVuZHMgQzMuU0RLQmVoYXZpb3JUeXBlQmFzZSB7CiAgICAgICAgICAgIGNvbnN0cnVjdG9yKGJlaGF2aW9yVHlwZSkgewogICAgICAgICAgICAgICAgc3VwZXIoYmVoYXZpb3JUeXBlKQogICAgICAgICAgICB9CiAgICAgICAgICAgIFJlbGVhc2UoKSB7CiAgICAgICAgICAgICAgICBzdXBlci5SZWxlYXNlKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBPbkNyZWF0ZSgpIHt9CiAgICAgICAgfQogICAgfSB7CiAgICAgICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgICAgIGNvbnN0IEMzWCA9IHNlbGYuQzNYOwogICAgICAgIGNvbnN0IElCZWhhdmlvckluc3RhbmNlID0gc2VsZi5JQmVoYXZpb3JJbnN0YW5jZTsKICAgICAgICBjb25zdCBNT1ZFTUVOVCA9IDA7CiAgICAgICAgY29uc3QgV0FWRSA9IDE7CiAgICAgICAgY29uc3QgUEVSSU9EID0gMjsKICAgICAgICBjb25zdCBQRVJJT0RfUkFORE9NID0gMzsKICAgICAgICBjb25zdCBQRVJJT0RfT0ZGU0VUID0gNDsKICAgICAgICBjb25zdCBQRVJJT0RfT0ZGU0VUX1JBTkRPTSA9IDU7CiAgICAgICAgY29uc3QgTUFHTklUVURFID0gNjsKICAgICAgICBjb25zdCBNQUdOSVRVREVfUkFORE9NID0gNzsKICAgICAgICBjb25zdCBFTkFCTEUgPSA4OwogICAgICAgIGNvbnN0IEhPUklaT05UQUwgPSAwOwogICAgICAgIGNvbnN0IFZFUlRJQ0FMID0gMTsKICAgICAgICBjb25zdCBTSVpFID0gMjsKICAgICAgICBjb25zdCBXSURUSCA9IDM7CiAgICAgICAgY29uc3QgSEVJR0hUID0gNDsKICAgICAgICBjb25zdCBBTkdMRSA9IDU7CiAgICAgICAgY29uc3QgT1BBQ0lUWSA9IDY7CiAgICAgICAgY29uc3QgVkFMVUUgPSA3OwogICAgICAgIGNvbnN0IEZPUldBUkRTX0JBQ0tXQVJEUyA9IDg7CiAgICAgICAgY29uc3QgWkVMRVZBVElPTiA9IDk7CiAgICAgICAgY29uc3QgU0lORSA9IDA7CiAgICAgICAgY29uc3QgVFJJQU5HTEUgPSAxOwogICAgICAgIGNvbnN0IFNBV1RPT1RIID0gMjsKICAgICAgICBjb25zdCBSRVZFUlNFX1NBV1RPT1RIID0gMzsKICAgICAgICBjb25zdCBTUVVBUkUgPQogICAgICAgICAgICA0OwogICAgICAgIGNvbnN0IF8ycGkgPSAyICogTWF0aC5QSTsKICAgICAgICBjb25zdCBfcGlfMiA9IE1hdGguUEkgLyAyOwogICAgICAgIGNvbnN0IF8zcGlfMiA9IDMgKiBNYXRoLlBJIC8gMjsKICAgICAgICBjb25zdCBNT1ZFTUVOVF9MT09LVVAgPSBbMCwgMSwgOCwgMywgNCwgMiwgNSwgNiwgOSwgN107CiAgICAgICAgQzMuQmVoYXZpb3JzLlNpbi5JbnN0YW5jZSA9IGNsYXNzIFNpbkluc3RhbmNlIGV4dGVuZHMgQzMuU0RLQmVoYXZpb3JJbnN0YW5jZUJhc2UgewogICAgICAgICAgICBjb25zdHJ1Y3RvcihiZWhJbnN0LCBwcm9wZXJ0aWVzKSB7CiAgICAgICAgICAgICAgICBzdXBlcihiZWhJbnN0KTsKICAgICAgICAgICAgICAgIHRoaXMuX2kgPSAwOwogICAgICAgICAgICAgICAgdGhpcy5fbW92ZW1lbnQgPSAwOwogICAgICAgICAgICAgICAgdGhpcy5fd2F2ZSA9IDA7CiAgICAgICAgICAgICAgICB0aGlzLl9wZXJpb2QgPSAwOwogICAgICAgICAgICAgICAgdGhpcy5fbWFnID0gMDsKICAgICAgICAgICAgICAgIHRoaXMuX2lzRW5hYmxlZCA9IHRydWU7CiAgICAgICAgICAgICAgICB0aGlzLl9iYXNlUGVyaW9kID0gMDsKICAgICAgICAgICAgICAgIHRoaXMuX2Jhc2VQZXJpb2RPZmZzZXQgPSAwOwogICAgICAgICAgICAgICAgdGhpcy5fYmFzZU1hZyA9IDA7CiAgICAgICAgICAgICAgICB0aGlzLl9wZXJpb2RSYW5kb20gPSAwOwogICAgICAgICAgICAgICAgdGhpcy5fcGVyaW9kT2Zmc2V0UmFuZG9tID0gMDsKICAgICAgICAgICAgICAgIHRoaXMuX21hZ25pdHVkZVJhbmRvbSA9IDA7CiAgICAgICAgICAgICAgICB0aGlzLl9pbml0aWFsVmFsdWUgPSAwOwogICAgICAgICAgICAgICAgdGhpcy5faW5pdGlhbFZhbHVlMiA9CiAgICAgICAgICAgICAgICAgICAgMDsKICAgICAgICAgICAgICAgIHRoaXMuX2xhc3RLbm93blZhbHVlID0gMDsKICAgICAgICAgICAgICAgIHRoaXMuX2xhc3RLbm93blZhbHVlMiA9IDA7CiAgICAgICAgICAgICAgICB0aGlzLl9yYXRpbyA9IDA7CiAgICAgICAgICAgICAgICBpZiAocHJvcGVydGllcykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX21vdmVtZW50ID0gTU9WRU1FTlRfTE9PS1VQW3Byb3BlcnRpZXNbTU9WRU1FTlRdXTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl93YXZlID0gcHJvcGVydGllc1tXQVZFXTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9wZXJpb2RSYW5kb20gPSB0aGlzLl9ydW50aW1lLlJhbmRvbSgpICogcHJvcGVydGllc1tQRVJJT0RfUkFORE9NXTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9iYXNlUGVyaW9kID0gcHJvcGVydGllc1tQRVJJT0RdOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3BlcmlvZCA9IHByb3BlcnRpZXNbUEVSSU9EXTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9wZXJpb2QgKz0gdGhpcy5fcGVyaW9kUmFuZG9tOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2Jhc2VQZXJpb2RPZmZzZXQgPSBwcm9wZXJ0aWVzW1BFUklPRF9PRkZTRVRdOwogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9wZXJpb2QgIT09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcGVyaW9kT2Zmc2V0UmFuZG9tID0gdGhpcy5fcnVudGltZS5SYW5kb20oKSAqIHByb3BlcnRpZXNbUEVSSU9EX09GRlNFVF9SQU5ET01dOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9pID0gcHJvcGVydGllc1tQRVJJT0RfT0ZGU0VUXSAvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9wZXJpb2QgKiBfMnBpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9pICs9IHRoaXMuX3BlcmlvZE9mZnNldFJhbmRvbSAvIHRoaXMuX3BlcmlvZCAqIF8ycGkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbWFnbml0dWRlUmFuZG9tID0gdGhpcy5fcnVudGltZS5SYW5kb20oKSAqIHByb3BlcnRpZXNbTUFHTklUVURFX1JBTkRPTV07CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYmFzZU1hZyA9IHByb3BlcnRpZXNbTUFHTklUVURFXTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9tYWcgPSBwcm9wZXJ0aWVzW01BR05JVFVERV07CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbWFnICs9IHRoaXMuX21hZ25pdHVkZVJhbmRvbTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9pc0VuYWJsZWQgPSAhIXByb3BlcnRpZXNbRU5BQkxFXQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHRoaXMuX21vdmVtZW50ID09PSBBTkdMRSkgdGhpcy5fbWFnID0gQzMudG9SYWRpYW5zKHRoaXMuX21hZyk7CiAgICAgICAgICAgICAgICB0aGlzLkluaXQoKTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9pc0VuYWJsZWQpIHRoaXMuX1N0YXJ0VGlja2luZygpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgUmVsZWFzZSgpIHsKICAgICAgICAgICAgICAgIHN1cGVyLlJlbGVhc2UoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIFNhdmVUb0pzb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICJpIjogdGhpcy5faSwKICAgICAgICAgICAgICAgICAgICAiZSI6IHRoaXMuX2lzRW5hYmxlZCwKICAgICAgICAgICAgICAgICAgICAibXYiOiB0aGlzLl9tb3ZlbWVudCwKICAgICAgICAgICAgICAgICAgICAidyI6IHRoaXMuX3dhdmUsCiAgICAgICAgICAgICAgICAgICAgInAiOiB0aGlzLl9wZXJpb2QsCiAgICAgICAgICAgICAgICAgICAgIm1hZyI6IHRoaXMuX21hZywKICAgICAgICAgICAgICAgICAgICAiaXYiOiB0aGlzLl9pbml0aWFsVmFsdWUsCiAgICAgICAgICAgICAgICAgICAgIml2MiI6IHRoaXMuX2luaXRpYWxWYWx1ZTIsCiAgICAgICAgICAgICAgICAgICAgInIiOiB0aGlzLl9yYXRpbywKICAgICAgICAgICAgICAgICAgICAibGt2IjogdGhpcy5fbGFzdEtub3duVmFsdWUsCiAgICAgICAgICAgICAgICAgICAgImxrdjIiOiB0aGlzLl9sYXN0S25vd25WYWx1ZTIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBMb2FkRnJvbUpzb24obykgewogICAgICAgICAgICAgICAgdGhpcy5faSA9IG9bImkiXTsKICAgICAgICAgICAgICAgIHRoaXMuX1NldEVuYWJsZWQob1siZSJdKTsKICAgICAgICAgICAgICAgIHRoaXMuX21vdmVtZW50ID0gb1sibXYiXTsKICAgICAgICAgICAgICAgIHRoaXMuX3dhdmUgPSBvWyJ3Il07CiAgICAgICAgICAgICAgICB0aGlzLl9wZXJpb2QgPSBvWyJwIl07CiAgICAgICAgICAgICAgICB0aGlzLl9tYWcgPSBvWyJtYWciXTsKICAgICAgICAgICAgICAgIHRoaXMuX2luaXRpYWxWYWx1ZSA9IG9bIml2Il07CiAgICAgICAgICAgICAgICB0aGlzLl9pbml0aWFsVmFsdWUyID0gb1siaXYyIl07CiAgICAgICAgICAgICAgICB0aGlzLl9yYXRpbyA9IG9bInIiXTsKICAgICAgICAgICAgICAgIHRoaXMuX2xhc3RLbm93blZhbHVlID0gb1sibGt2Il07CiAgICAgICAgICAgICAgICB0aGlzLl9sYXN0S25vd25WYWx1ZTIgPSBvWyJsa3YyIl0KICAgICAgICAgICAgfQogICAgICAgICAgICBJbml0KCkgewogICAgICAgICAgICAgICAgY29uc3Qgd2kgPSB0aGlzLl9pbnN0LkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICAgICAgc3dpdGNoICh0aGlzLl9tb3ZlbWVudCkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgSE9SSVpPTlRBTDoKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5faW5pdGlhbFZhbHVlID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpLkdldFgoKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBWRVJUSUNBTDoKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5faW5pdGlhbFZhbHVlID0gd2kuR2V0WSgpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIFNJWkU6CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2luaXRpYWxWYWx1ZSA9IHdpLkdldFdpZHRoKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3JhdGlvID0gd2kuR2V0SGVpZ2h0KCkgLyB3aS5HZXRXaWR0aCgpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIFdJRFRIOgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9pbml0aWFsVmFsdWUgPSB3aS5HZXRXaWR0aCgpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIEhFSUdIVDoKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5faW5pdGlhbFZhbHVlID0gd2kuR2V0SGVpZ2h0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgQU5HTEU6CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2luaXRpYWxWYWx1ZSA9IHdpLkdldEFuZ2xlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgT1BBQ0lUWToKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5faW5pdGlhbFZhbHVlID0gd2kuR2V0T3BhY2l0eSgpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIFZBTFVFOgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9pbml0aWFsVmFsdWUgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIEZPUldBUkRTX0JBQ0tXQVJEUzoKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5faW5pdGlhbFZhbHVlID0gd2kuR2V0WCgpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9pbml0aWFsVmFsdWUyID0gd2kuR2V0WSgpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIFpFTEVWQVRJT046CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2luaXRpYWxWYWx1ZSA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aS5HZXRaRWxldmF0aW9uKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLl9sYXN0S25vd25WYWx1ZSA9IHRoaXMuX2luaXRpYWxWYWx1ZTsKICAgICAgICAgICAgICAgIHRoaXMuX2xhc3RLbm93blZhbHVlMiA9IHRoaXMuX2luaXRpYWxWYWx1ZTIKICAgICAgICAgICAgfQogICAgICAgICAgICBXYXZlRnVuYyh4KSB7CiAgICAgICAgICAgICAgICB4ID0geCAlIF8ycGk7CiAgICAgICAgICAgICAgICBzd2l0Y2ggKHRoaXMuX3dhdmUpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlIFNJTkU6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBNYXRoLnNpbih4KTsKICAgICAgICAgICAgICAgICAgICBjYXNlIFRSSUFOR0xFOgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoeCA8PSBfcGlfMikgcmV0dXJuIHggLyBfcGlfMjsKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoeCA8PSBfM3BpXzIpIHJldHVybiAxIC0gMiAqICh4IC0gX3BpXzIpIC8gTWF0aC5QSTsKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSByZXR1cm4gKHggLSBfM3BpXzIpIC8gX3BpXzIgLSAxOwogICAgICAgICAgICAgICAgICAgIGNhc2UgU0FXVE9PVEg6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAyICogeCAvIF8ycGkgLSAxOwogICAgICAgICAgICAgICAgICAgIGNhc2UgUkVWRVJTRV9TQVdUT09USDoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC0yICogeCAvIF8ycGkgKyAxOwogICAgICAgICAgICAgICAgICAgIGNhc2UgU1FVQVJFOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4geCA8IE1hdGguUEkgPyAtMSA6IDEKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiAwCiAgICAgICAgICAgIH0KICAgICAgICAgICAgVGljaygpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGR0ID0gdGhpcy5fcnVudGltZS5HZXREdCh0aGlzLl9pbnN0KTsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5faXNFbmFibGVkIHx8IGR0ID09PSAwKSByZXR1cm47CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fcGVyaW9kID09PSAwKSB0aGlzLl9pID0gMDsKICAgICAgICAgICAgICAgIGVsc2UgdGhpcy5faSA9ICh0aGlzLl9pICsgZHQgLyB0aGlzLl9wZXJpb2QgKiBfMnBpKSAlIF8ycGk7CiAgICAgICAgICAgICAgICB0aGlzLl9VcGRhdGVGcm9tUGhhc2UoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9VcGRhdGVGcm9tUGhhc2UoKSB7CiAgICAgICAgICAgICAgICBjb25zdCB3aSA9IHRoaXMuX2luc3QuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgICAgICBzd2l0Y2ggKHRoaXMuX21vdmVtZW50KSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBIT1JJWk9OVEFMOgogICAgICAgICAgICAgICAgICAgICAgICBpZiAod2kuR2V0WCgpICE9PSB0aGlzLl9sYXN0S25vd25WYWx1ZSkgdGhpcy5faW5pdGlhbFZhbHVlICs9IHdpLkdldFgoKSAtIHRoaXMuX2xhc3RLbm93blZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICB3aS5TZXRYKHRoaXMuX2luaXRpYWxWYWx1ZSArIHRoaXMuV2F2ZUZ1bmModGhpcy5faSkgKiB0aGlzLl9tYWcpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9sYXN0S25vd25WYWx1ZSA9IHdpLkdldFgoKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBWRVJUSUNBTDoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHdpLkdldFkoKSAhPT0gdGhpcy5fbGFzdEtub3duVmFsdWUpIHRoaXMuX2luaXRpYWxWYWx1ZSArPSB3aS5HZXRZKCkgLSB0aGlzLl9sYXN0S25vd25WYWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgd2kuU2V0WSh0aGlzLl9pbml0aWFsVmFsdWUgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5XYXZlRnVuYyh0aGlzLl9pKSAqIHRoaXMuX21hZyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2xhc3RLbm93blZhbHVlID0gd2kuR2V0WSgpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIFNJWkU6CiAgICAgICAgICAgICAgICAgICAgICAgIHdpLlNldFdpZHRoKHRoaXMuX2luaXRpYWxWYWx1ZSArIHRoaXMuV2F2ZUZ1bmModGhpcy5faSkgKiB0aGlzLl9tYWcpOwogICAgICAgICAgICAgICAgICAgICAgICB3aS5TZXRIZWlnaHQod2kuR2V0V2lkdGgoKSAqIHRoaXMuX3JhdGlvKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBXSURUSDoKICAgICAgICAgICAgICAgICAgICAgICAgd2kuU2V0V2lkdGgodGhpcy5faW5pdGlhbFZhbHVlICsgdGhpcy5XYXZlRnVuYyh0aGlzLl9pKSAqIHRoaXMuX21hZyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgSEVJR0hUOgogICAgICAgICAgICAgICAgICAgICAgICB3aS5TZXRIZWlnaHQodGhpcy5faW5pdGlhbFZhbHVlICsgdGhpcy5XYXZlRnVuYyh0aGlzLl9pKSAqIHRoaXMuX21hZyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgQU5HTEU6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh3aS5HZXRBbmdsZSgpICE9PSB0aGlzLl9sYXN0S25vd25WYWx1ZSkgdGhpcy5faW5pdGlhbFZhbHVlID0gQzMuY2xhbXBBbmdsZSh0aGlzLl9pbml0aWFsVmFsdWUgKyAod2kuR2V0QW5nbGUoKSAtIHRoaXMuX2xhc3RLbm93blZhbHVlKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpLlNldEFuZ2xlKHRoaXMuX2luaXRpYWxWYWx1ZSArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLldhdmVGdW5jKHRoaXMuX2kpICogdGhpcy5fbWFnKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fbGFzdEtub3duVmFsdWUgPSB3aS5HZXRBbmdsZSgpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIE9QQUNJVFk6CiAgICAgICAgICAgICAgICAgICAgICAgIHdpLlNldE9wYWNpdHkodGhpcy5faW5pdGlhbFZhbHVlICsgdGhpcy5XYXZlRnVuYyh0aGlzLl9pKSAqIHRoaXMuX21hZyAvIDEwMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgRk9SV0FSRFNfQkFDS1dBUkRTOgogICAgICAgICAgICAgICAgICAgICAgICBpZiAod2kuR2V0WCgpICE9PSB0aGlzLl9sYXN0S25vd25WYWx1ZSkgdGhpcy5faW5pdGlhbFZhbHVlICs9IHdpLkdldFgoKSAtIHRoaXMuX2xhc3RLbm93blZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAod2kuR2V0WSgpICE9PSB0aGlzLl9sYXN0S25vd25WYWx1ZTIpIHRoaXMuX2luaXRpYWxWYWx1ZTIgKz0gd2kuR2V0WSgpIC0gdGhpcy5fbGFzdEtub3duVmFsdWUyOwogICAgICAgICAgICAgICAgICAgICAgICB3aS5TZXRYKHRoaXMuX2luaXRpYWxWYWx1ZSArIE1hdGguY29zKHdpLkdldEFuZ2xlKCkpICogdGhpcy5XYXZlRnVuYyh0aGlzLl9pKSAqIHRoaXMuX21hZyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpLlNldFkodGhpcy5faW5pdGlhbFZhbHVlMiArIE1hdGguc2luKHdpLkdldEFuZ2xlKCkpICoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuV2F2ZUZ1bmModGhpcy5faSkgKiB0aGlzLl9tYWcpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9sYXN0S25vd25WYWx1ZSA9IHdpLkdldFgoKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fbGFzdEtub3duVmFsdWUyID0gd2kuR2V0WSgpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIFpFTEVWQVRJT046CiAgICAgICAgICAgICAgICAgICAgICAgIHdpLlNldFpFbGV2YXRpb24odGhpcy5faW5pdGlhbFZhbHVlICsgdGhpcy5XYXZlRnVuYyh0aGlzLl9pKSAqIHRoaXMuX21hZyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB3aS5TZXRCYm94Q2hhbmdlZCgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX09uU3ByaXRlRnJhbWVDaGFuZ2VkKHByZXZGcmFtZSwgbmV4dEZyYW1lKSB7fQogICAgICAgICAgICBfU2V0UGVyaW9kKHgpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3BlcmlvZCA9IHgKICAgICAgICAgICAgfQogICAgICAgICAgICBfR2V0UGVyaW9kKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3BlcmlvZAogICAgICAgICAgICB9CiAgICAgICAgICAgIF9TZXRNYWduaXR1ZGUoeCkgewogICAgICAgICAgICAgICAgdGhpcy5fbWFnID0geAogICAgICAgICAgICB9CiAgICAgICAgICAgIF9TZXRNYWduaXR1ZGVfQ29udmVydEFuZ2xlKHgpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9tb3ZlbWVudCA9PT0gNSkgeCA9IEMzLnRvUmFkaWFucyh4KTsKICAgICAgICAgICAgICAgIHRoaXMuX1NldE1hZ25pdHVkZSh4KQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9HZXRNYWduaXR1ZGUoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fbWFnCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX0dldE1hZ25pdHVkZV9Db252ZXJ0QW5nbGUoKSB7CiAgICAgICAgICAgICAgICBsZXQgbSA9CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fR2V0TWFnbml0dWRlKCk7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fbW92ZW1lbnQgPT09IDUpIG0gPSBDMy50b0RlZ3JlZXMobSk7CiAgICAgICAgICAgICAgICByZXR1cm4gbQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9TZXRNb3ZlbWVudChtKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fbW92ZW1lbnQgPT09IDUgJiYgbSAhPT0gNSkgdGhpcy5fbWFnID0gQzMudG9EZWdyZWVzKHRoaXMuX21hZyk7CiAgICAgICAgICAgICAgICB0aGlzLl9tb3ZlbWVudCA9IG07CiAgICAgICAgICAgICAgICB0aGlzLkluaXQoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9HZXRNb3ZlbWVudCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9tb3ZlbWVudAogICAgICAgICAgICB9CiAgICAgICAgICAgIF9TZXRXYXZlKHcpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3dhdmUgPSB3CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX0dldFdhdmUoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fd2F2ZQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9TZXRQaGFzZSh4KSB7CiAgICAgICAgICAgICAgICB0aGlzLl9pID0gQzMuY2xhbXAoeCwgMCwgTWF0aC5QSSAqIDIpOwogICAgICAgICAgICAgICAgdGhpcy5fVXBkYXRlRnJvbVBoYXNlKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBfR2V0UGhhc2UoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5faQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9TZXRFbmFibGVkKGUpIHsKICAgICAgICAgICAgICAgIHRoaXMuX2lzRW5hYmxlZCA9ICEhZTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9pc0VuYWJsZWQpIHRoaXMuX1N0YXJ0VGlja2luZygpOwogICAgICAgICAgICAgICAgZWxzZSB0aGlzLl9TdG9wVGlja2luZygpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX0lzRW5hYmxlZCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9pc0VuYWJsZWQKICAgICAgICAgICAgfQogICAgICAgICAgICBHZXRQcm9wZXJ0eVZhbHVlQnlJbmRleChpbmRleCkgewogICAgICAgICAgICAgICAgc3dpdGNoIChpbmRleCkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgTU9WRU1FTlQ6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9tb3ZlbWVudDsKICAgICAgICAgICAgICAgICAgICBjYXNlIFdBVkU6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl93YXZlOwogICAgICAgICAgICAgICAgICAgIGNhc2UgUEVSSU9EOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fYmFzZVBlcmlvZDsKICAgICAgICAgICAgICAgICAgICBjYXNlIE1BR05JVFVERToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2Jhc2VNYWc7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBFTkFCTEU6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9pc0VuYWJsZWQKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBTZXRQcm9wZXJ0eVZhbHVlQnlJbmRleChpbmRleCwgdmFsdWUpIHsKICAgICAgICAgICAgICAgIHN3aXRjaCAoaW5kZXgpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlIE1PVkVNRU5UOgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9tb3ZlbWVudCA9IE1PVkVNRU5UX0xPT0tVUFt2YWx1ZV07CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuSW5pdCgpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIFdBVkU6CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3dhdmUgPSB2YWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBQRVJJT0Q6CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2Jhc2VQZXJpb2QgPSB2YWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcGVyaW9kID0gdGhpcy5fYmFzZVBlcmlvZCArIHRoaXMuX3BlcmlvZFJhbmRvbTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9pc0VuYWJsZWQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fcGVyaW9kICE9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5faSA9IHRoaXMuX2Jhc2VQZXJpb2RPZmZzZXQgLyB0aGlzLl9wZXJpb2QgKiBfMnBpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2kgKz0gdGhpcy5fcGVyaW9kT2Zmc2V0UmFuZG9tIC8gdGhpcy5fcGVyaW9kICoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXzJwaQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHRoaXMuX2kgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIE1BR05JVFVERToKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fYmFzZU1hZyA9IHZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9tYWcgPSB0aGlzLl9iYXNlTWFnICsgdGhpcy5fbWFnbml0dWRlUmFuZG9tOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fbW92ZW1lbnQgPT09IEFOR0xFKSB0aGlzLl9tYWcgPSBDMy50b1JhZGlhbnModGhpcy5fbWFnKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSBFTkFCTEU6CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2lzRW5hYmxlZCA9ICEhdmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgR2V0RGVidWdnZXJQcm9wZXJ0aWVzKCkgewogICAgICAgICAgICAgICAgY29uc3QgcHJlZml4ID0gImJlaGF2aW9ycy5zaW4iOwogICAgICAgICAgICAgICAgcmV0dXJuIFt7CiAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICIkIiArIHRoaXMuR2V0QmVoYXZpb3JUeXBlKCkuR2V0TmFtZSgpLAogICAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IFt7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBwcmVmaXggKyAiLnByb3BlcnRpZXMuZW5hYmxlZC5uYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLl9Jc0VuYWJsZWQoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uZWRpdDogdiA9PiB0aGlzLl9TZXRFbmFibGVkKHYpCiAgICAgICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHByZWZpeCArICIucHJvcGVydGllcy5wZXJpb2QubmFtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5fR2V0UGVyaW9kKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbmVkaXQ6IHYgPT4gdGhpcy5fU2V0UGVyaW9kKHYpCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHByZWZpeCArICIucHJvcGVydGllcy5tYWduaXR1ZGUubmFtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5fR2V0TWFnbml0dWRlX0NvbnZlcnRBbmdsZSgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgb25lZGl0OiB2ID0+IHRoaXMuX1NldE1hZ25pdHVkZV9Db252ZXJ0QW5nbGUodikKICAgICAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogcHJlZml4ICsgIi5kZWJ1Z2dlci52YWx1ZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5XYXZlRnVuYyh0aGlzLl9HZXRQaGFzZSgpKSAqIHRoaXMuX0dldE1hZ25pdHVkZV9Db252ZXJ0QW5nbGUoKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgXQogICAgICAgICAgICAgICAgfV0KICAgICAgICAgICAgfQogICAgICAgICAgICBHZXRTY3JpcHRJbnRlcmZhY2VDbGFzcygpIHsKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLklTaW5lQmVoYXZpb3JJbnN0YW5jZQogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICBjb25zdCBtYXAgPSBuZXcgV2Vha01hcDsKICAgICAgICBjb25zdCBWQUxJRF9NT1ZFTUVOVFMgPSBbImhvcml6b250YWwiLCAidmVydGljYWwiLCAic2l6ZSIsICJ3aWR0aCIsICJoZWlnaHQiLCAiYW5nbGUiLCAib3BhY2l0eSIsICJ2YWx1ZS1vbmx5IiwgImZvcndhcmRzLWJhY2t3YXJkcyIsICJ6LWVsZXZhdGlvbiJdOwogICAgICAgIGNvbnN0IFZBTElEX1dBVkVTID0gWyJzaW5lIiwgInRyaWFuZ2xlIiwgInNhd3Rvb3RoIiwKICAgICAgICAgICAgInJldmVyc2Utc2F3dG9vdGgiLCAic3F1YXJlIgogICAgICAgIF07CiAgICAgICAgc2VsZi5JU2luZUJlaGF2aW9ySW5zdGFuY2UgPSBjbGFzcyBJU2luZUJlaGF2aW9ySW5zdGFuY2UgZXh0ZW5kcyBJQmVoYXZpb3JJbnN0YW5jZSB7CiAgICAgICAgICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgICAgICAgICAgc3VwZXIoKTsKICAgICAgICAgICAgICAgIG1hcC5zZXQodGhpcywgSUJlaGF2aW9ySW5zdGFuY2UuX0dldEluaXRJbnN0KCkuR2V0U2RrSW5zdGFuY2UoKSkKICAgICAgICAgICAgfQogICAgICAgICAgICBzZXQgcGVyaW9kKHgpIHsKICAgICAgICAgICAgICAgIEMzWC5SZXF1aXJlRmluaXRlTnVtYmVyKHgpOwogICAgICAgICAgICAgICAgbWFwLmdldCh0aGlzKS5fU2V0UGVyaW9kKHgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZ2V0IHBlcmlvZCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBtYXAuZ2V0KHRoaXMpLl9HZXRQZXJpb2QoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHNldCBtYWduaXR1ZGUobSkgewogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVGaW5pdGVOdW1iZXIobSk7CiAgICAgICAgICAgICAgICBtYXAuZ2V0KHRoaXMpLl9TZXRNYWduaXR1ZGUobSkKICAgICAgICAgICAgfQogICAgICAgICAgICBnZXQgbWFnbml0dWRlKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIG1hcC5nZXQodGhpcykuX0dldE1hZ25pdHVkZSgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2V0IHBoYXNlKHApIHsKICAgICAgICAgICAgICAgIG1hcC5nZXQodGhpcykuX1NldFBoYXNlKHApCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZ2V0IHBoYXNlKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIG1hcC5nZXQodGhpcykuX0dldFBoYXNlKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBzZXQgbW92ZW1lbnQobSkgewogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVTdHJpbmcobSk7CiAgICAgICAgICAgICAgICBjb25zdCBpID0gVkFMSURfTU9WRU1FTlRTLmluZGV4T2YobSk7CiAgICAgICAgICAgICAgICBpZiAoaSA9PT0gLTEpIHRocm93IG5ldyBFcnJvcigiaW52YWxpZCBtb3ZlbWVudCIpOwogICAgICAgICAgICAgICAgbWFwLmdldCh0aGlzKS5fU2V0TW92ZW1lbnQoaSkKICAgICAgICAgICAgfQogICAgICAgICAgICBnZXQgbW92ZW1lbnQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gVkFMSURfTU9WRU1FTlRTW21hcC5nZXQodGhpcykuX0dldE1vdmVtZW50KCldCiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2V0IHdhdmUodykgewogICAgICAgICAgICAgICAgQzNYLlJlcXVpcmVTdHJpbmcodyk7CiAgICAgICAgICAgICAgICBjb25zdCBpID0gVkFMSURfV0FWRVMuaW5kZXhPZih3KTsKICAgICAgICAgICAgICAgIGlmIChpID09PSAtMSkgdGhyb3cgbmV3IEVycm9yKCJpbnZhbGlkIHdhdmUiKTsKICAgICAgICAgICAgICAgIG1hcC5nZXQodGhpcykuX1NldFdhdmUoaSkKICAgICAgICAgICAgfQogICAgICAgICAgICBnZXQgd2F2ZSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBWQUxJRF9XQVZFU1ttYXAuZ2V0KHRoaXMpLl9HZXRXYXZlKCldCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZ2V0IHZhbHVlKCkgewogICAgICAgICAgICAgICAgY29uc3QgaW5zdCA9IG1hcC5nZXQodGhpcyk7CiAgICAgICAgICAgICAgICByZXR1cm4gaW5zdC5XYXZlRnVuYyhpbnN0Ll9HZXRQaGFzZSgpKSAqIGluc3QuX0dldE1hZ25pdHVkZSgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdXBkYXRlSW5pdGlhbFN0YXRlKCkgewogICAgICAgICAgICAgICAgbWFwLmdldCh0aGlzKS5Jbml0KCkKICAgICAgICAgICAgfQogICAgICAgICAgICBzZXQgaXNFbmFibGVkKGUpIHsKICAgICAgICAgICAgICAgIG1hcC5nZXQodGhpcykuX1NldEVuYWJsZWQoISFlKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGdldCBpc0VuYWJsZWQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbWFwLmdldCh0aGlzKS5fSXNFbmFibGVkKCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0gewogICAgICAgIGNvbnN0IEMzID0gc2VsZi5DMzsKICAgICAgICBDMy5CZWhhdmlvcnMuU2luLkNuZHMgPSB7CiAgICAgICAgICAgIElzRW5hYmxlZCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9Jc0VuYWJsZWQoKQogICAgICAgICAgICB9LAogICAgICAgICAgICBDb21wYXJlTW92ZW1lbnQobSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX0dldE1vdmVtZW50KCkgPT09IG0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgQ29tcGFyZVBlcmlvZChjbXAsIHYpIHsKICAgICAgICAgICAgICAgIHJldHVybiBDMy5jb21wYXJlKHRoaXMuX0dldFBlcmlvZCgpLCBjbXAsIHYpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIENvbXBhcmVNYWduaXR1ZGUoY21wLCB2KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gQzMuY29tcGFyZSh0aGlzLl9HZXRNYWduaXR1ZGVfQ29udmVydEFuZ2xlKCksIGNtcCwgdikKICAgICAgICAgICAgfSwKICAgICAgICAgICAgQ29tcGFyZVdhdmUodykgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX0dldFdhdmUoKSA9PT0gdwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSB7CiAgICAgICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgICAgIEMzLkJlaGF2aW9ycy5TaW4uQWN0cyA9IHsKICAgICAgICAgICAgU2V0RW5hYmxlZChlKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9TZXRFbmFibGVkKGUgIT09IDApCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFNldFBlcmlvZCh4KSB7CiAgICAgICAgICAgICAgICB0aGlzLl9TZXRQZXJpb2QoeCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgU2V0TWFnbml0dWRlKHgpIHsKICAgICAgICAgICAgICAgIHRoaXMuX1NldE1hZ25pdHVkZV9Db252ZXJ0QW5nbGUoeCkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgU2V0TW92ZW1lbnQobSkgewogICAgICAgICAgICAgICAgdGhpcy5fU2V0TW92ZW1lbnQobSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgU2V0V2F2ZSh3KSB7CiAgICAgICAgICAgICAgICB0aGlzLl93YXZlID0gdwogICAgICAgICAgICB9LAogICAgICAgICAgICBTZXRQaGFzZSh4KSB7CiAgICAgICAgICAgICAgICBjb25zdCBfMnBpID0gTWF0aC5QSSAqIDI7CiAgICAgICAgICAgICAgICB0aGlzLl9TZXRQaGFzZSh4ICogXzJwaSAlIF8ycGkpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFVwZGF0ZUluaXRpYWxTdGF0ZSgpIHsKICAgICAgICAgICAgICAgIHRoaXMuSW5pdCgpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IHsKICAgICAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICAgICAgQzMuQmVoYXZpb3JzLlNpbi5FeHBzID0gewogICAgICAgICAgICBDeWNsZVBvc2l0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX0dldFBoYXNlKCkgLyAoMiAqIE1hdGguUEkpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFBlcmlvZCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9HZXRQZXJpb2QoKQogICAgICAgICAgICB9LAogICAgICAgICAgICBNYWduaXR1ZGUoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fR2V0TWFnbml0dWRlX0NvbnZlcnRBbmdsZSgpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFZhbHVlKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuV2F2ZUZ1bmModGhpcy5fR2V0UGhhc2UoKSkgKiB0aGlzLl9HZXRNYWduaXR1ZGVfQ29udmVydEFuZ2xlKCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07Cgp9Cgp7CiAgICAndXNlIHN0cmljdCc7IHsKICAgICAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICAgICAgQzMuQmVoYXZpb3JzLkRyYWduRHJvcCA9IGNsYXNzIERyYWduRHJvcEJlaGF2aW9yIGV4dGVuZHMgQzMuU0RLQmVoYXZpb3JCYXNlIHsKICAgICAgICAgICAgY29uc3RydWN0b3Iob3B0cykgewogICAgICAgICAgICAgICAgc3VwZXIob3B0cyk7CiAgICAgICAgICAgICAgICBjb25zdCBydCA9IHRoaXMuX3J1bnRpbWUuRGlzcGF0Y2hlcigpOwogICAgICAgICAgICAgICAgdGhpcy5fZGlzcG9zYWJsZXMgPSBuZXcgQzMuQ29tcG9zaXRlRGlzcG9zYWJsZShDMy5EaXNwb3NhYmxlLkZyb20ocnQsICJwb2ludGVyZG93biIsIGUgPT4gdGhpcy5fT25Qb2ludGVyRG93bihlLmRhdGEpKSwgQzMuRGlzcG9zYWJsZS5Gcm9tKHJ0LCAicG9pbnRlcm1vdmUiLCBlID0+IHRoaXMuX09uUG9pbnRlck1vdmUoZS5kYXRhKSksIEMzLkRpc3Bvc2FibGUuRnJvbShydCwgInBvaW50ZXJ1cCIsIGUgPT4gdGhpcy5fT25Qb2ludGVyVXAoZS5kYXRhLCBmYWxzZSkpLCBDMy5EaXNwb3NhYmxlLkZyb20ocnQsICJwb2ludGVyY2FuY2VsIiwgZSA9PiB0aGlzLl9PblBvaW50ZXJVcChlLmRhdGEsIHRydWUpKSkKICAgICAgICAgICAgfQogICAgICAgICAgICBSZWxlYXNlKCkgewogICAgICAgICAgICAgICAgdGhpcy5fZGlzcG9zYWJsZXMuUmVsZWFzZSgpOwogICAgICAgICAgICAgICAgdGhpcy5fZGlzcG9zYWJsZXMgPSBudWxsOwogICAgICAgICAgICAgICAgc3VwZXIuUmVsZWFzZSgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX09uUG9pbnRlckRvd24oZSkgewogICAgICAgICAgICAgICAgaWYgKGVbInBvaW50ZXJUeXBlIl0gPT09ICJtb3VzZSIgJiYgZVsiYnV0dG9uIl0gIT09IDApIHJldHVybjsKICAgICAgICAgICAgICAgIHRoaXMuX09uSW5wdXREb3duKGVbInBvaW50ZXJJZCJdLnRvU3RyaW5nKCksIGVbInBhZ2VYIl0gLSB0aGlzLl9ydW50aW1lLkdldENhbnZhc0NsaWVudFgoKSwgZVsicGFnZVkiXSAtIHRoaXMuX3J1bnRpbWUuR2V0Q2FudmFzQ2xpZW50WSgpKQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9PblBvaW50ZXJNb3ZlKGUpIHsKICAgICAgICAgICAgICAgIGlmICgoZVsibGFzdEJ1dHRvbnMiXSAmIDEpICE9PSAwICYmIChlWyJidXR0b25zIl0gJiAxKSA9PT0gMCkgdGhpcy5fT25JbnB1dFVwKGVbInBvaW50ZXJJZCJdLnRvU3RyaW5nKCkpOwogICAgICAgICAgICAgICAgZWxzZSB0aGlzLl9PbklucHV0TW92ZShlWyJwb2ludGVySWQiXS50b1N0cmluZygpLCBlWyJwYWdlWCJdIC0gdGhpcy5fcnVudGltZS5HZXRDYW52YXNDbGllbnRYKCksIGVbInBhZ2VZIl0gLSB0aGlzLl9ydW50aW1lLkdldENhbnZhc0NsaWVudFkoKSkKICAgICAgICAgICAgfQogICAgICAgICAgICBfT25Qb2ludGVyVXAoZSwKICAgICAgICAgICAgICAgIGlzQ2FuY2VsKSB7CiAgICAgICAgICAgICAgICBpZiAoZVsicG9pbnRlclR5cGUiXSA9PT0gIm1vdXNlIiAmJiBlWyJidXR0b24iXSAhPT0gMCkgcmV0dXJuOwogICAgICAgICAgICAgICAgdGhpcy5fT25JbnB1dFVwKGVbInBvaW50ZXJJZCJdLnRvU3RyaW5nKCkpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgYXN5bmMgX09uSW5wdXREb3duKHNyYywgY2xpZW50WCwgY2xpZW50WSkgewogICAgICAgICAgICAgICAgY29uc3QgbXlJbnN0YW5jZXMgPSB0aGlzLkdldEluc3RhbmNlcygpOwogICAgICAgICAgICAgICAgbGV0IHRvcE1vc3QgPSBudWxsOwogICAgICAgICAgICAgICAgbGV0IHRvcEJlaEluc3QgPSBudWxsOwogICAgICAgICAgICAgICAgbGV0IHRvcFggPSAwOwogICAgICAgICAgICAgICAgbGV0IHRvcFkgPSAwOwogICAgICAgICAgICAgICAgZm9yIChjb25zdCBpbnN0IG9mIG15SW5zdGFuY2VzKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYmVoSW5zdCA9IGluc3QuR2V0QmVoYXZpb3JTZGtJbnN0YW5jZUZyb21DdG9yKEMzLkJlaGF2aW9ycy5EcmFnbkRyb3ApOwogICAgICAgICAgICAgICAgICAgIGlmICghYmVoSW5zdC5Jc0VuYWJsZWQoKSB8fCBiZWhJbnN0LklzRHJhZ2dpbmcoKSB8fCBpbnN0LklzRGVzdHJveWVkKCkpIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHdpID0gaW5zdC5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBsYXllciA9IHdpLkdldExheWVyKCk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgW2x4LCBseV0gPSBsYXllci5DYW52YXNDc3NUb0xheWVyKGNsaWVudFgsCiAgICAgICAgICAgICAgICAgICAgICAgIGNsaWVudFksIHdpLkdldFRvdGFsWkVsZXZhdGlvbigpKTsKICAgICAgICAgICAgICAgICAgICBpZiAoIWxheWVyLklzU2VsZkFuZFBhcmVudHNJbnRlcmFjdGl2ZSgpIHx8ICF3aS5Db250YWluc1BvaW50KGx4LCBseSkpIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgIGlmICghdG9wTW9zdCkgewogICAgICAgICAgICAgICAgICAgICAgICB0b3BNb3N0ID0gaW5zdDsKICAgICAgICAgICAgICAgICAgICAgICAgdG9wQmVoSW5zdCA9IGJlaEluc3Q7CiAgICAgICAgICAgICAgICAgICAgICAgIHRvcFggPSBseDsKICAgICAgICAgICAgICAgICAgICAgICAgdG9wWSA9IGx5OwogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBjb25zdCB0b3BXaSA9IHRvcE1vc3QuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGxheWVyLkdldEluZGV4KCkgPiB0b3BXaS5HZXRMYXllcigpLkdldEluZGV4KCkgfHwgbGF5ZXIuR2V0SW5kZXgoKSA9PT0gdG9wV2kuR2V0TGF5ZXIoKS5HZXRJbmRleCgpICYmIHdpLkdldFpJbmRleCgpID4gdG9wV2kuR2V0WkluZGV4KCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdG9wTW9zdCA9IGluc3Q7CiAgICAgICAgICAgICAgICAgICAgICAgIHRvcEJlaEluc3QgPSBiZWhJbnN0OwogICAgICAgICAgICAgICAgICAgICAgICB0b3BYID0gbHg7CiAgICAgICAgICAgICAgICAgICAgICAgIHRvcFkgPSBseQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh0b3BNb3N0KSBhd2FpdCB0b3BCZWhJbnN0Ll9PbkRvd24oc3JjLCB0b3BYLCB0b3BZKQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9PbklucHV0TW92ZShzcmMsIGNsaWVudFgsIGNsaWVudFkpIHsKICAgICAgICAgICAgICAgIGNvbnN0IG15SW5zdGFuY2VzID0gdGhpcy5HZXRJbnN0YW5jZXMoKTsKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgaW5zdCBvZiBteUluc3RhbmNlcykgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGJlaEluc3QgPSBpbnN0LkdldEJlaGF2aW9yU2RrSW5zdGFuY2VGcm9tQ3RvcihDMy5CZWhhdmlvcnMuRHJhZ25Ecm9wKTsKICAgICAgICAgICAgICAgICAgICBpZiAoIWJlaEluc3QuSXNFbmFibGVkKCkgfHwgIWJlaEluc3QuSXNEcmFnZ2luZygpIHx8IGJlaEluc3QuSXNEcmFnZ2luZygpICYmIGJlaEluc3QuR2V0RHJhZ1NvdXJjZSgpICE9PSBzcmMpIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHdpID0gaW5zdC5HZXRXb3JsZEluZm8oKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBsYXllciA9IHdpLkdldExheWVyKCk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgW2x4LCBseV0gPSBsYXllci5DYW52YXNDc3NUb0xheWVyKGNsaWVudFgsIGNsaWVudFksIHdpLkdldFRvdGFsWkVsZXZhdGlvbigpKTsKICAgICAgICAgICAgICAgICAgICBiZWhJbnN0Ll9Pbk1vdmUobHgsIGx5KQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGFzeW5jIF9PbklucHV0VXAoc3JjKSB7CiAgICAgICAgICAgICAgICBjb25zdCBteUluc3RhbmNlcyA9IHRoaXMuR2V0SW5zdGFuY2VzKCk7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGluc3Qgb2YgbXlJbnN0YW5jZXMpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBiZWhJbnN0ID0gaW5zdC5HZXRCZWhhdmlvclNka0luc3RhbmNlRnJvbUN0b3IoQzMuQmVoYXZpb3JzLkRyYWduRHJvcCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGJlaEluc3QuSXNEcmFnZ2luZygpICYmIGJlaEluc3QuR2V0RHJhZ1NvdXJjZSgpID09PSBzcmMpIGF3YWl0IGJlaEluc3QuX09uVXAoKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSB7CiAgICAgICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgICAgIEMzLkJlaGF2aW9ycy5EcmFnbkRyb3AuVHlwZSA9IGNsYXNzIERyYWduRHJvcFR5cGUgZXh0ZW5kcyBDMy5TREtCZWhhdmlvclR5cGVCYXNlIHsKICAgICAgICAgICAgY29uc3RydWN0b3IoYmVoYXZpb3JUeXBlKSB7CiAgICAgICAgICAgICAgICBzdXBlcihiZWhhdmlvclR5cGUpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgUmVsZWFzZSgpIHsKICAgICAgICAgICAgICAgIHN1cGVyLlJlbGVhc2UoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIE9uQ3JlYXRlKCkge30KICAgICAgICB9CiAgICB9IHsKICAgICAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICAgICAgY29uc3QgQzNYID0gc2VsZi5DM1g7CiAgICAgICAgY29uc3QgSUJlaGF2aW9ySW5zdGFuY2UgPSBzZWxmLklCZWhhdmlvckluc3RhbmNlOwogICAgICAgIGNvbnN0IEFYRVMgPSAwOwogICAgICAgIGNvbnN0IEVOQUJMRSA9IDE7CiAgICAgICAgQzMuQmVoYXZpb3JzLkRyYWduRHJvcC5JbnN0YW5jZSA9IGNsYXNzIERyYWduRHJvcEluc3RhbmNlIGV4dGVuZHMgQzMuU0RLQmVoYXZpb3JJbnN0YW5jZUJhc2UgewogICAgICAgICAgICBjb25zdHJ1Y3RvcihiZWhJbnN0LCBwcm9wZXJ0aWVzKSB7CiAgICAgICAgICAgICAgICBzdXBlcihiZWhJbnN0KTsKICAgICAgICAgICAgICAgIHRoaXMuX2lzRHJhZ2dpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHRoaXMuX2R4ID0gMDsKICAgICAgICAgICAgICAgIHRoaXMuX2R5ID0gMDsKICAgICAgICAgICAgICAgIHRoaXMuX2RyYWdTb3VyY2UgPSAiPG5vbmU+IjsKICAgICAgICAgICAgICAgIHRoaXMuX2F4ZXMgPSAwOwogICAgICAgICAgICAgICAgdGhpcy5faXNFbmFibGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGlmIChwcm9wZXJ0aWVzKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYXhlcyA9IHByb3BlcnRpZXNbQVhFU107CiAgICAgICAgICAgICAgICAgICAgdGhpcy5faXNFbmFibGVkID0gcHJvcGVydGllc1tFTkFCTEVdCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgUmVsZWFzZSgpIHsKICAgICAgICAgICAgICAgIHN1cGVyLlJlbGVhc2UoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIFNhdmVUb0pzb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICJhIjogdGhpcy5fYXhlcywKICAgICAgICAgICAgICAgICAgICAiZSI6IHRoaXMuX2lzRW5hYmxlZAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIExvYWRGcm9tSnNvbihvKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9heGVzID0KICAgICAgICAgICAgICAgICAgICBvWyJhIl07CiAgICAgICAgICAgICAgICB0aGlzLl9pc0VuYWJsZWQgPSBvWyJlIl07CiAgICAgICAgICAgICAgICB0aGlzLl9pc0RyYWdnaW5nID0gZmFsc2UKICAgICAgICAgICAgfQogICAgICAgICAgICBfU2V0RW5hYmxlZChlKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9pc0VuYWJsZWQgPSAhIWU7CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX2lzRW5hYmxlZCkgdGhpcy5faXNEcmFnZ2luZyA9IGZhbHNlCiAgICAgICAgICAgIH0KICAgICAgICAgICAgSXNFbmFibGVkKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2lzRW5hYmxlZAogICAgICAgICAgICB9CiAgICAgICAgICAgIF9TZXRBeGVzKGEpIHsKICAgICAgICAgICAgICAgIHRoaXMuX2F4ZXMgPSBhCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX0dldEF4ZXMoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fYXhlcwogICAgICAgICAgICB9CiAgICAgICAgICAgIF9Ecm9wKCkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuX2lzRHJhZ2dpbmcpIHRoaXMuX09uVXAoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIElzRHJhZ2dpbmcoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5faXNEcmFnZ2luZwogICAgICAgICAgICB9CiAgICAgICAgICAgIEdldERyYWdTb3VyY2UoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZHJhZ1NvdXJjZQogICAgICAgICAgICB9CiAgICAgICAgICAgIGFzeW5jIF9PbkRvd24oc3JjLCB4LCB5KSB7CiAgICAgICAgICAgICAgICBjb25zdCB3aSA9IHRoaXMuR2V0V29ybGRJbmZvKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9keCA9IHggLSB3aS5HZXRYKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9keSA9IHkgLSB3aS5HZXRZKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9pc0RyYWdnaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHRoaXMuX2RyYWdTb3VyY2UgPSBzcmM7CiAgICAgICAgICAgICAgICB0aGlzLkRpc3BhdGNoU2NyaXB0RXZlbnQoImRyYWdzdGFydCIpOwogICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5UcmlnZ2VyQXN5bmMoQzMuQmVoYXZpb3JzLkRyYWduRHJvcC5DbmRzLk9uRHJhZ1N0YXJ0KQogICAgICAgICAgICB9CiAgICAgICAgICAgIF9Pbk1vdmUoeCwgeSkgewogICAgICAgICAgICAgICAgY29uc3Qgd2kgPSB0aGlzLkdldFdvcmxkSW5mbygpOwogICAgICAgICAgICAgICAgY29uc3QgbmV3WCA9IHggLSB0aGlzLl9keDsKICAgICAgICAgICAgICAgIGNvbnN0IG5ld1kgPSB5IC0gdGhpcy5fZHk7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fYXhlcyA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgIGlmICh3aS5HZXRYKCkgIT09IG5ld1ggfHwgd2kuR2V0WSgpICE9PSBuZXdZKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpLlNldFhZKG5ld1gsIG5ld1kpOwogICAgICAgICAgICAgICAgICAgICAgICB3aS5TZXRCYm94Q2hhbmdlZCgpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLl9heGVzID09PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHdpLkdldFgoKSAhPT0gbmV3WCkgewogICAgICAgICAgICAgICAgICAgICAgICB3aS5TZXRYKG5ld1gpOwogICAgICAgICAgICAgICAgICAgICAgICB3aS5TZXRCYm94Q2hhbmdlZCgpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLl9heGVzID09PSAyKQogICAgICAgICAgICAgICAgICAgIGlmICh3aS5HZXRZKCkgIT09IG5ld1kpIHsKICAgICAgICAgICAgICAgICAgICAgICAgd2kuU2V0WShuZXdZKTsKICAgICAgICAgICAgICAgICAgICAgICAgd2kuU2V0QmJveENoYW5nZWQoKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBhc3luYyBfT25VcCgpIHsKICAgICAgICAgICAgICAgIHRoaXMuX2lzRHJhZ2dpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHRoaXMuRGlzcGF0Y2hTY3JpcHRFdmVudCgiZHJvcCIpOwogICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5UcmlnZ2VyQXN5bmMoQzMuQmVoYXZpb3JzLkRyYWduRHJvcC5DbmRzLk9uRHJvcCkKICAgICAgICAgICAgfQogICAgICAgICAgICBHZXRQcm9wZXJ0eVZhbHVlQnlJbmRleChpbmRleCkgewogICAgICAgICAgICAgICAgc3dpdGNoIChpbmRleCkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgQVhFUzoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX0dldEF4ZXMoKTsKICAgICAgICAgICAgICAgICAgICBjYXNlIEVOQUJMRToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuSXNFbmFibGVkKCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBTZXRQcm9wZXJ0eVZhbHVlQnlJbmRleChpbmRleCwgdmFsdWUpIHsKICAgICAgICAgICAgICAgIHN3aXRjaCAoaW5kZXgpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlIEFYRVM6CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX1NldEF4ZXModmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIEVOQUJMRToKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fU2V0RW5hYmxlZCghIXZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBHZXREZWJ1Z2dlclByb3BlcnRpZXMoKSB7CiAgICAgICAgICAgICAgICBjb25zdCBwcmVmaXggPSAiYmVoYXZpb3JzLmRyYWduZHJvcCI7CiAgICAgICAgICAgICAgICBjb25zdCBheGVzUHJlZml4ID0gcHJlZml4ICsgIi5wcm9wZXJ0aWVzLmF4ZXMiOwogICAgICAgICAgICAgICAgbGV0IGF4ZXNOYW1lID0gIiI7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fYXhlcyA9PT0gMCkgYXhlc05hbWUgPSBheGVzUHJlZml4ICsgIi5pdGVtcy5ib3RoIjsKICAgICAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuX2F4ZXMgPT09IDEpIGF4ZXNOYW1lID0gYXhlc1ByZWZpeCArICIuaXRlbXMuaG9yaXpvbnRhbC1vbmx5IjsKICAgICAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuX2F4ZXMgPT09IDIpIGF4ZXNOYW1lID0gYXhlc1ByZWZpeCArICIuaXRlbXMudmVydGljYWwtb25seSI7CiAgICAgICAgICAgICAgICByZXR1cm4gW3sKICAgICAgICAgICAgICAgICAgICB0aXRsZTogIiQiICsgdGhpcy5HZXRCZWhhdmlvclR5cGUoKS5HZXROYW1lKCksCiAgICAgICAgICAgICAgICAgICAgcHJvcGVydGllczogW3sKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogcHJlZml4ICsgIi5kZWJ1Z2dlci5pcy1kcmFnZ2luZyIsCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLklzRHJhZ2dpbmcoKQogICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogYXhlc1ByZWZpeCArICIubmFtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBbYXhlc05hbWVdCiAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBwcmVmaXggKyAiLnByb3BlcnRpZXMuZW5hYmxlZC5uYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuSXNFbmFibGVkKCksCiAgICAgICAgICAgICAgICAgICAgICAgIG9uZWRpdDogdiA9PiB0aGlzLl9TZXRFbmFibGVkKHYpCiAgICAgICAgICAgICAgICAgICAgfV0KICAgICAgICAgICAgICAgIH1dCiAgICAgICAgICAgIH0KICAgICAgICAgICAgR2V0U2NyaXB0SW50ZXJmYWNlQ2xhc3MoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5JRHJhZ0Ryb3BCZWhhdmlvckluc3RhbmNlCiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIGNvbnN0IG1hcCA9IG5ldyBXZWFrTWFwOwogICAgICAgIGNvbnN0IFZBTElEX0FYRVMgPSBbImJvdGgiLCAiaG9yaXpvbnRhbCIsICJ2ZXJ0aWNhbCJdOwogICAgICAgIHNlbGYuSURyYWdEcm9wQmVoYXZpb3JJbnN0YW5jZSA9IGNsYXNzIElEcmFnRHJvcEJlaGF2aW9ySW5zdGFuY2UgZXh0ZW5kcyBJQmVoYXZpb3JJbnN0YW5jZSB7CiAgICAgICAgICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgICAgICAgICAgc3VwZXIoKTsKICAgICAgICAgICAgICAgIG1hcC5zZXQodGhpcywgSUJlaGF2aW9ySW5zdGFuY2UuX0dldEluaXRJbnN0KCkuR2V0U2RrSW5zdGFuY2UoKSkKICAgICAgICAgICAgfQogICAgICAgICAgICBzZXQgYXhlcyhzdHIpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGEgPQogICAgICAgICAgICAgICAgICAgIFZBTElEX0FYRVMuaW5kZXhPZihzdHIpOwogICAgICAgICAgICAgICAgaWYgKGEgPT09IC0xKSB0aHJvdyBuZXcgRXJyb3IoImludmFsaWQgYXhlcyIpOwogICAgICAgICAgICAgICAgbWFwLmdldCh0aGlzKS5fU2V0QXhlcyhhKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGdldCBheGVzKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIFZBTElEX0FYRVNbbWFwLmdldCh0aGlzKS5fR2V0QXhlcygpXQogICAgICAgICAgICB9CiAgICAgICAgICAgIGRyb3AoKSB7CiAgICAgICAgICAgICAgICBtYXAuZ2V0KHRoaXMpLl9Ecm9wKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBnZXQgaXNEcmFnZ2luZygpIHsKICAgICAgICAgICAgICAgIHJldHVybiBtYXAuZ2V0KHRoaXMpLklzRHJhZ2dpbmcoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGdldCBpc0VuYWJsZWQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbWFwLmdldCh0aGlzKS5Jc0VuYWJsZWQoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHNldCBpc0VuYWJsZWQoZSkgewogICAgICAgICAgICAgICAgbWFwLmdldCh0aGlzKS5fU2V0RW5hYmxlZChlKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSB7CiAgICAgICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgICAgIEMzLkJlaGF2aW9ycy5EcmFnbkRyb3AuQ25kcyA9IHsKICAgICAgICAgICAgSXNEcmFnZ2luZygpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLklzRHJhZ2dpbmcoKQogICAgICAgICAgICB9LAogICAgICAgICAgICBPbkRyYWdTdGFydCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIE9uRHJvcCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIElzRW5hYmxlZCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLklzRW5hYmxlZCgpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IHsKICAgICAgICBjb25zdCBDMyA9IHNlbGYuQzM7CiAgICAgICAgQzMuQmVoYXZpb3JzLkRyYWduRHJvcC5BY3RzID0gewogICAgICAgICAgICBTZXRFbmFibGVkKGUpIHsKICAgICAgICAgICAgICAgIHRoaXMuX1NldEVuYWJsZWQoISFlKQogICAgICAgICAgICB9LAogICAgICAgICAgICBTZXRBeGVzKGEpIHsKICAgICAgICAgICAgICAgIHRoaXMuX1NldEF4ZXMoYSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgRHJvcCgpIHsKICAgICAgICAgICAgICAgIHRoaXMuX0Ryb3AoKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSB7CiAgICAgICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgICAgIEMzLkJlaGF2aW9ycy5EcmFnbkRyb3AuRXhwcyA9IHt9CiAgICB9OwoKfQoKewogICAgY29uc3QgQzMgPSBzZWxmLkMzOwogICAgc2VsZi5DM19HZXRPYmplY3RSZWZUYWJsZSA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBbCiAgICAgICAgICAgIEMzLlBsdWdpbnMuQXJyLAogICAgICAgICAgICBDMy5QbHVnaW5zLkF1ZGlvLAogICAgICAgICAgICBDMy5QbHVnaW5zLkJyb3dzZXIsCiAgICAgICAgICAgIEMzLlBsdWdpbnMuRXBvbmVzaF9HYW1lU2NvcmUsCiAgICAgICAgICAgIEMzLlBsdWdpbnMuS2V5Ym9hcmQsCiAgICAgICAgICAgIEMzLlBsdWdpbnMuUGxhdGZvcm1JbmZvLAogICAgICAgICAgICBDMy5QbHVnaW5zLlNwcml0ZWZvbnQyLAogICAgICAgICAgICBDMy5CZWhhdmlvcnMuQW5jaG9yLAogICAgICAgICAgICBDMy5QbHVnaW5zLlRvdWNoLAogICAgICAgICAgICBDMy5QbHVnaW5zLlRpbGVkQmcsCiAgICAgICAgICAgIEMzLlBsdWdpbnMuU3ByaXRlLAogICAgICAgICAgICBDMy5CZWhhdmlvcnMuUGh5c2ljcywKICAgICAgICAgICAgQzMuQmVoYXZpb3JzLnNjcm9sbHRvLAogICAgICAgICAgICBDMy5CZWhhdmlvcnMuVGltZXIsCiAgICAgICAgICAgIEMzLkJlaGF2aW9ycy5CdWxsZXQsCiAgICAgICAgICAgIEMzLkJlaGF2aW9ycy5TaW4sCiAgICAgICAgICAgIEMzLlBsdWdpbnMuUGFydGljbGVzLAogICAgICAgICAgICBDMy5CZWhhdmlvcnMuRHJhZ25Ecm9wLAogICAgICAgICAgICBDMy5QbHVnaW5zLkVwb25lc2hfWWFuZGV4U0RLLAogICAgICAgICAgICBDMy5QbHVnaW5zLkRyYXdpbmdDYW52YXMsCiAgICAgICAgICAgIEMzLlBsdWdpbnMuU3lzdGVtLkNuZHMuSXNHcm91cEFjdGl2ZSwKICAgICAgICAgICAgQzMuUGx1Z2lucy5TeXN0ZW0uQ25kcy5UcmlnZ2VyT25jZSwKICAgICAgICAgICAgQzMuUGx1Z2lucy5TeXN0ZW0uQWN0cy5TZXRMYXllck9wYWNpdHksCiAgICAgICAgICAgIEMzLlBsdWdpbnMuU3ByaXRlLkFjdHMuU2V0RWZmZWN0RW5hYmxlZCwKICAgICAgICAgICAgQzMuUGx1Z2lucy5TcHJpdGUuQWN0cy5EZXN0cm95LAogICAgICAgICAgICBDMy5QbHVnaW5zLlNwcml0ZS5BY3RzLk1vdmVUb1RvcCwKICAgICAgICAgICAgQzMuUGx1Z2lucy5QYXJ0aWNsZXMuQWN0cy5TZXRTcHJheWluZywKICAgICAgICAgICAgQzMuUGx1Z2lucy5QYXJ0aWNsZXMuQWN0cy5TZXRYLAogICAgICAgICAgICBDMy5QbHVnaW5zLlN5c3RlbS5FeHBzLnZpZXdwb3J0cmlnaHQsCiAgICAgICAgICAgIEMzLlBsdWdpbnMuU3lzdGVtLkV4cHMudmlld3BvcnRsZWZ0LAogICAgICAgICAgICBDMy5QbHVnaW5zLlBhcnRpY2xlcy5BY3RzLlNldFhSYW5kb21pc2VyLAogICAgICAgICAgICBDMy5QbHVnaW5zLlBhcnRpY2xlcy5DbmRzLkNvbXBhcmVJbnN0YW5jZVZhciwKICAgICAgICAgICAgQzMuUGx1Z2lucy5TeXN0ZW0uQ25kcy5Db21wYXJlVmFyLAogICAgICAgICAgICBDMy5QbHVnaW5zLlNwcml0ZS5DbmRzLlBpY2tCeVVJRCwKICAgICAgICAgICAgQzMuUGx1Z2lucy5TcHJpdGUuQWN0cy5TZXRWaXNpYmxlLAogICAgICAgICAgICBDMy5QbHVnaW5zLlNwcml0ZS5BY3RzLlNldEFuaW1GcmFtZSwKICAgICAgICAgICAgQzMuUGx1Z2lucy5TcHJpdGUuQWN0cy5TZXRIZWlnaHQsCiAgICAgICAgICAgIEMzLlBsdWdpbnMuU3ByaXRlZm9udDIuQ25kcy5QaWNrQnlVSUQsCiAgICAgICAgICAgIEMzLlBsdWdpbnMuU3ByaXRlZm9udDIuQWN0cy5TZXRQb3MsCiAgICAgICAgICAgIEMzLlBsdWdpbnMuU3ByaXRlZm9udDIuRXhwcy5ZLAogICAgICAgICAgICBDMy5QbHVnaW5zLlN5c3RlbS5DbmRzLk9uTGF5b3V0U3RhcnQsCiAgICAgICAgICAgIEMzLlBsdWdpbnMuU3ByaXRlLkNuZHMuT25DcmVhdGVkLAogICAgICAgICAgICBDMy5QbHVnaW5zLlN5c3RlbS5BY3RzLkNyZWF0ZU9iamVjdCwKICAgICAgICAgICAgQzMuUGx1Z2lucy5TcHJpdGUuRXhwcy5YLAogICAgICAgICAgICBDMy5QbHVnaW5zLlNwcml0ZS5FeHBzLlksCiAgICAgICAgICAgIEMzLlBsdWdpbnMuU3lzdGVtLkFjdHMuV2FpdEZvclByZXZpb3VzQWN0aW9ucywKICAgICAgICAgICAgQzMuUGx1Z2lucy5EcmF3aW5nQ2FudmFzLkFjdHMuUGFzdGVPYmplY3QsCiAgICAgICAgICAgIEMzLlBsdWdpbnMuRHJhd2luZ0NhbnZhcy5BY3RzLk1vdmVUb0xheWVyLAogICAgICAgICAgICBDMy5QbHVnaW5zLkRyYXdpbmdDYW52YXMuQWN0cy5TZXRJbnN0YW5jZVZhciwKICAgICAgICAgICAgQzMuUGx1Z2lucy5TcHJpdGUuQ25kcy5Db21wYXJlSW5zdGFuY2VWYXIsCiAgICAgICAgICAgIEMzLlBsdWdpbnMuRHJhd2luZ0NhbnZhcy5BY3RzLlNldFBvcywKICAgICAgICAgICAgQzMuUGx1Z2lucy5TcHJpdGUuQWN0cy5BZGRDaGlsZCwKICAgICAgICAgICAgQzMuUGx1Z2lucy5EcmF3aW5nQ2FudmFzLkFjdHMuRGVzdHJveSwKICAgICAgICAgICAgQzMuUGx1Z2lucy5TeXN0ZW0uQ25kcy5Gb3JFYWNoLAogICAgICAgICAgICBDMy5QbHVnaW5zLkRyYXdpbmdDYW52YXMuQ25kcy5PbkNyZWF0ZWQsCiAgICAgICAgICAgIEMzLlBsdWdpbnMuVGlsZWRCZy5DbmRzLkNvbXBhcmVJbnN0YW5jZVZhciwKICAgICAgICAgICAgQzMuUGx1Z2lucy5UaWxlZEJnLkFjdHMuU2V0WSwKICAgICAgICAgICAgQzMuUGx1Z2lucy5TeXN0ZW0uRXhwcy52aWV3cG9ydHRvcCwKICAgICAgICAgICAgQzMuUGx1Z2lucy5TeXN0ZW0uQ25kcy5FdmVyeSwKICAgICAgICAgICAgQzMuUGx1Z2lucy5TeXN0ZW0uQWN0cy5TZXRWYXIsCiAgICAgICAgICAgIEMzLlBsdWdpbnMuU3lzdGVtLkV4cHMuY2hvb3NlLAogICAgICAgICAgICBDMy5QbHVnaW5zLlN5c3RlbS5DbmRzLkNvbXBhcmUsCiAgICAgICAgICAgIEMzLlBsdWdpbnMuU3ByaXRlLkNuZHMuQ29tcGFyZVksCiAgICAgICAgICAgIEMzLlBsdWdpbnMuVGlsZWRCZy5FeHBzLlksCiAgICAgICAgICAgIEMzLkJlaGF2aW9ycy5QaHlzaWNzLkFjdHMuQXBwbHlJbXB1bHNlQXRBbmdsZSwKICAgICAgICAgICAgQzMuUGx1Z2lucy5TcHJpdGUuRXhwcy5BbmdsZSwKICAgICAgICAgICAgQzMuUGx1Z2lucy5BdWRpby5BY3RzLlBsYXksCiAgICAgICAgICAgIEMzLkJlaGF2aW9ycy5QaHlzaWNzLkNuZHMuSXNFbmFibGVkLAogICAgICAgICAgICBDMy5CZWhhdmlvcnMuUGh5c2ljcy5BY3RzLkFwcGx5Rm9yY2UsCiAgICAgICAgICAgIEMzLlBsdWdpbnMuU3ByaXRlLkNuZHMuSXNCZXR3ZWVuQW5nbGVzLAogICAgICAgICAgICBDMy5CZWhhdmlvcnMuUGh5c2ljcy5BY3RzLkFwcGx5Rm9yY2VBdEFuZ2xlLAogICAgICAgICAgICBDMy5QbHVnaW5zLktleWJvYXJkLkNuZHMuT25LZXksCiAgICAgICAgICAgIEMzLlBsdWdpbnMuU3lzdGVtLkFjdHMuV2FpdCwKICAgICAgICAgICAgQzMuUGx1Z2lucy5TeXN0ZW0uQWN0cy5SZXN0YXJ0TGF5b3V0LAogICAgICAgICAgICBDMy5QbHVnaW5zLlRvdWNoLkNuZHMuT25Ub3VjaE9iamVjdCwKICAgICAgICAgICAgQzMuUGx1Z2lucy5TcHJpdGUuQ25kcy5BbmdsZVdpdGhpbiwKICAgICAgICAgICAgQzMuQmVoYXZpb3JzLlBoeXNpY3MuQWN0cy5DcmVhdGVMaW1pdGVkUmV2b2x1dGVKb2ludCwKICAgICAgICAgICAgQzMuQmVoYXZpb3JzLlBoeXNpY3MuQWN0cy5TZXRXb3JsZEdyYXZpdHksCiAgICAgICAgICAgIEMzLlBsdWdpbnMuU3ByaXRlLkNuZHMuQ29tcGFyZVgsCiAgICAgICAgICAgIEMzLlBsdWdpbnMuU3ByaXRlLkFjdHMuU2V0WCwKICAgICAgICAgICAgQzMuUGx1Z2lucy5Ub3VjaC5DbmRzLk9uVG91Y2hTdGFydCwKICAgICAgICAgICAgQzMuUGx1Z2lucy5Ub3VjaC5DbmRzLklzVG91Y2hpbmdPYmplY3QsCiAgICAgICAgICAgIEMzLlBsdWdpbnMuU3ByaXRlLkNuZHMuQ29tcGFyZUZyYW1lLAogICAgICAgICAgICBDMy5QbHVnaW5zLlRvdWNoLkNuZHMuT25Ub3VjaEVuZCwKICAgICAgICAgICAgQzMuUGx1Z2lucy5FcG9uZXNoX0dhbWVTY29yZS5BY3RzLkFkc1Nob3dGdWxsc2NyZWVuLAogICAgICAgICAgICBDMy5QbHVnaW5zLlN5c3RlbS5BY3RzLkdvVG9MYXlvdXQsCiAgICAgICAgICAgIEMzLlBsdWdpbnMuQXVkaW8uQWN0cy5TdG9wLAogICAgICAgICAgICBDMy5QbHVnaW5zLlN5c3RlbS5FeHBzLnJhbmRvbSwKICAgICAgICAgICAgQzMuUGx1Z2lucy5TcHJpdGUuQWN0cy5TcGF3biwKICAgICAgICAgICAgQzMuUGx1Z2lucy5TcHJpdGUuQWN0cy5aTW92ZVRvT2JqZWN0LAogICAgICAgICAgICBDMy5CZWhhdmlvcnMuUGh5c2ljcy5BY3RzLlNldERlbnNpdHksCiAgICAgICAgICAgIEMzLkJlaGF2aW9ycy5QaHlzaWNzLkFjdHMuU2V0RWxhc3RpY2l0eSwKICAgICAgICAgICAgQzMuUGx1Z2lucy5UaWxlZEJnLkFjdHMuU2V0VmlzaWJsZSwKICAgICAgICAgICAgQzMuQmVoYXZpb3JzLlBoeXNpY3MuQWN0cy5TZXRGcmljdGlvbiwKICAgICAgICAgICAgQzMuUGx1Z2lucy5TcHJpdGUuQWN0cy5TZXRBbmltLAogICAgICAgICAgICBDMy5CZWhhdmlvcnMuQnVsbGV0LkFjdHMuU2V0U3BlZWQsCiAgICAgICAgICAgIEMzLlBsdWdpbnMuUGFydGljbGVzLkFjdHMuU2V0SW5zdGFuY2VWYXIsCiAgICAgICAgICAgIEMzLlBsdWdpbnMuUGFydGljbGVzLkFjdHMuU2V0SW5pdFNwZWVkLAogICAgICAgICAgICBDMy5QbHVnaW5zLlNwcml0ZS5BY3RzLlNldEluc3RhbmNlVmFyLAogICAgICAgICAgICBDMy5QbHVnaW5zLlNwcml0ZWZvbnQyLkFjdHMuU2V0VGV4dCwKICAgICAgICAgICAgQzMuQmVoYXZpb3JzLlRpbWVyLkNuZHMuT25UaW1lciwKICAgICAgICAgICAgQzMuUGx1Z2lucy5TcHJpdGUuQ25kcy5PbkNvbGxpc2lvbiwKICAgICAgICAgICAgQzMuQmVoYXZpb3JzLlRpbWVyLkFjdHMuU3RvcFRpbWVyLAogICAgICAgICAgICBDMy5CZWhhdmlvcnMuVGltZXIuQWN0cy5TdGFydFRpbWVyLAogICAgICAgICAgICBDMy5QbHVnaW5zLlN5c3RlbS5BY3RzLlNjcm9sbFRvT2JqZWN0LAogICAgICAgICAgICBDMy5QbHVnaW5zLlNwcml0ZS5BY3RzLlNldENvbGxpc2lvbnMsCiAgICAgICAgICAgIEMzLlBsdWdpbnMuU3lzdGVtLkFjdHMuU2V0VGltZXNjYWxlLAogICAgICAgICAgICBDMy5QbHVnaW5zLlN5c3RlbS5BY3RzLlNldE9iamVjdFRpbWVzY2FsZSwKICAgICAgICAgICAgQzMuUGx1Z2lucy5TeXN0ZW0uQWN0cy5BZGRWYXIsCiAgICAgICAgICAgIEMzLlBsdWdpbnMuU3lzdGVtLkFjdHMuU2V0TGF5b3V0U2NhbGUsCiAgICAgICAgICAgIEMzLlBsdWdpbnMuU3lzdGVtLkNuZHMuRXZlcnlUaWNrLAogICAgICAgICAgICBDMy5QbHVnaW5zLlNwcml0ZS5BY3RzLlNldFBvcywKICAgICAgICAgICAgQzMuUGx1Z2lucy5TeXN0ZW0uRXhwcy5sYXlvdXRzY2FsZSwKICAgICAgICAgICAgQzMuUGx1Z2lucy5TcHJpdGUuQ25kcy5Jc09uU2NyZWVuLAogICAgICAgICAgICBDMy5CZWhhdmlvcnMuUGh5c2ljcy5DbmRzLkNvbXBhcmVWZWxvY2l0eSwKICAgICAgICAgICAgQzMuUGx1Z2lucy5TeXN0ZW0uQ25kcy5MYXllclZpc2libGUsCiAgICAgICAgICAgIEMzLlBsdWdpbnMuRXBvbmVzaF9HYW1lU2NvcmUuQWN0cy5QbGF5ZXJTZXRTY29yZSwKICAgICAgICAgICAgQzMuUGx1Z2lucy5FcG9uZXNoX0dhbWVTY29yZS5BY3RzLlBsYXllclN5bmMsCiAgICAgICAgICAgIEMzLlBsdWdpbnMuQXVkaW8uQWN0cy5TdG9wQWxsLAogICAgICAgICAgICBDMy5QbHVnaW5zLlN5c3RlbS5FeHBzLmxlZnQsCiAgICAgICAgICAgIEMzLlBsdWdpbnMuQnJvd3Nlci5FeHBzLkxhbmd1YWdlLAogICAgICAgICAgICBDMy5QbHVnaW5zLlBsYXRmb3JtSW5mby5DbmRzLklzT25Nb2JpbGUsCiAgICAgICAgICAgIEMzLlBsdWdpbnMuRXBvbmVzaF9HYW1lU2NvcmUuRXhwcy5WYXJpYWJsZXNHZXQsCiAgICAgICAgICAgIEMzLlBsdWdpbnMuRXBvbmVzaF9HYW1lU2NvcmUuRXhwcy5QbGF5ZXJTY29yZSwKICAgICAgICAgICAgQzMuUGx1Z2lucy5BdWRpby5BY3RzLlNldFNpbGVudCwKICAgICAgICAgICAgQzMuUGx1Z2lucy5FcG9uZXNoX0dhbWVTY29yZS5BY3RzLkxlYWRlcmJvYXJkT3BlbiwKICAgICAgICAgICAgQzMuUGx1Z2lucy5TcHJpdGVmb250Mi5DbmRzLk9uQ3JlYXRlZCwKICAgICAgICAgICAgQzMuUGx1Z2lucy5BcnIuQWN0cy5KU09OTG9hZCwKICAgICAgICAgICAgQzMuUGx1Z2lucy5TcHJpdGVmb250Mi5BY3RzLlNldENoYXJhY3RlcldpZHRoLAogICAgICAgICAgICBDMy5QbHVnaW5zLlN5c3RlbS5DbmRzLkZvciwKICAgICAgICAgICAgQzMuUGx1Z2lucy5BcnIuRXhwcy5IZWlnaHQsCiAgICAgICAgICAgIEMzLlBsdWdpbnMuQXJyLkV4cHMuQXQsCiAgICAgICAgICAgIEMzLlBsdWdpbnMuU3lzdGVtLkV4cHMubG9vcGluZGV4LAogICAgICAgICAgICBDMy5QbHVnaW5zLkVwb25lc2hfR2FtZVNjb3JlLkNuZHMuT25QYXVzZSwKICAgICAgICAgICAgQzMuUGx1Z2lucy5FcG9uZXNoX0dhbWVTY29yZS5DbmRzLk9uUmVzdW1lLAogICAgICAgICAgICBDMy5QbHVnaW5zLkJyb3dzZXIuQ25kcy5PblJlc2l6ZSwKICAgICAgICAgICAgQzMuUGx1Z2lucy5Ccm93c2VyLkNuZHMuSXNGdWxsc2NyZWVuLAogICAgICAgICAgICBDMy5QbHVnaW5zLkJyb3dzZXIuQWN0cy5DYW5jZWxGdWxsU2NyZWVuLAogICAgICAgICAgICBDMy5QbHVnaW5zLkJyb3dzZXIuQWN0cy5SZXF1ZXN0RnVsbFNjcmVlbgogICAgICAgIF07CiAgICB9OwogICAgc2VsZi5DM19Kc1Byb3BOYW1lVGFibGUgPSBbewogICAgICAgICAgICBBcnJheTogMAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBBdWRpbzogMAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBCcm93c2VyOiAwCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIEdhbWVQdXNoOiAwCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIEtleWJvYXJkOiAwCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIFBsYXRmb3JtSW5mbzogMAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBBbmNob3I6IDAKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgU3ByaXRlRm9udDogMAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBUb3VjaDogMAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBiYWNrZ3JvdW5nOiAwCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGJhY2tncm91bmcyOiAwCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGJhY2tncm91bmczOiAwCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGJhY2tncm91bmc0OiAwCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIFBoeXNpY3M6IDAKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgYmFsbDogMAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBib2R5OiAwCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGJ1dHRvbnM6IDAKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgU2Nyb2xsVG86IDAKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgVGltZXI6IDAKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgY2FtOiAwCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGFuZ2xlb2Ztb3Rpb246IDAKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgQnVsbGV0OiAwCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGNsb3VkOiAwCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGdhbGw6IDAKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgZ2xhc3M6IDAKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgZ2xhc3MyOiAwCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGdsYXNzMzogMAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBnbGFzczQ6IDAKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgcGxheWVyOiAwCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGhlYWQ6IDAKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgU2luZTogMAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBTaW5lMjogMAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBtYWlubmFtZTogMAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBtZW51YmFjazogMAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBtZW51YnV0dG9uOiAwCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIG1lbnVnbGFzczogMAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBQYXJ0aWNsZXM6IDAKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgc2lkZTogMAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICB3aW5kOiAwCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIHN0cmVuZ3RoOiAwCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIFBhcnRpY2xlczI6IDAKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgcGxhbmV0OiAwCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIHNoYWRvdzogMAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBzcGF3bmVyOiAwCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIFNwcml0ZTogMAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBTcHJpdGUxMDogMAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBTcHJpdGUzOiAwCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIFNwcml0ZTQ6IDAKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgU3ByaXRlNTogMAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBTcHJpdGU2OiAwCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIERyYWdEcm9wOiAwCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIFNwcml0ZTk6IDAKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgWWFuZGV4U0RLOiAwCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIFNwcml0ZTI6IDAKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgU3ByaXRlNzogMAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICB0b3A6IDAKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgdGFnOiAwCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGdsYXNzNTogMAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBEcmF3aW5nQ2FudmFzOiAwCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGlzcGxheWluZzogMAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICB3b3JsZGdyYXZpdHk6IDAKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgaGl0OiAwCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGhpdDI6IDAKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgZ2FtZTogMAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBtYWlubWVudTogMAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBzY29yZWJsdWU6IDAKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgc2NvcmVyZWQ6IDAKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgcmFuZG9tYmFsbDogMAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICByYW5kb21jZXRjYTogMAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICByYW5kb21ucGM6IDAKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgcmFuZG9tYmFja2dyb3VuZDogMAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBzY3JvbGw6IDAKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgc3RhcnQxOiAwCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIHdpbjogMAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBnYWw6IDAKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgcmFuZG9tYmFsbHZpczogMAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBzZXR0b3VjaDogMAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICB3aXRocGM6IDAKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgYmVoYXZpb3I6IDAKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgYmVoYXZpb3IyOiAwCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIHNvdW5kbWFpbjogMAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICByYW5kb21oZWFkOiAwCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIHJhbmRvbXdpbmQ6IDAKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgZmlyc3R0aW1lOiAwCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGxhbmd1YWdlMjogMAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBBRFM6IDAKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgbW9iaWxlOiAwCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIHNjb3JlOiAwCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGxvYWQ6IDAKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgc3RhcnQ6IDAKICAgICAgICB9CiAgICBdOwp9Cgp7CgogICAgY29uc3QgQzMgPSBzZWxmLkMzOwoKICAgIGZ1bmN0aW9uIHVuYXJ5bWludXMobikgewogICAgICAgIHJldHVybiAodHlwZW9mIG4gPT09ICJudW1iZXIiID8gLW4gOiBuKTsKICAgIH0KCiAgICBmdW5jdGlvbiBib3RoTnVtYmVycyhhLCBiKSB7CiAgICAgICAgcmV0dXJuIHR5cGVvZiBhID09PSAibnVtYmVyIiAmJiB0eXBlb2YgYiA9PT0gIm51bWJlciI7CiAgICB9CgogICAgZnVuY3Rpb24gYWRkKGwsIHIpIHsKICAgICAgICBpZiAoYm90aE51bWJlcnMobCwgcikpCiAgICAgICAgICAgIHJldHVybiBsICsgcjsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHJldHVybiBsOwogICAgfQoKICAgIGZ1bmN0aW9uIHN1YnRyYWN0KGwsIHIpIHsKICAgICAgICBpZiAoYm90aE51bWJlcnMobCwgcikpCiAgICAgICAgICAgIHJldHVybiBsIC0gcjsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHJldHVybiBsOwogICAgfQoKICAgIGZ1bmN0aW9uIG11bHRpcGx5KGwsIHIpIHsKICAgICAgICBpZiAoYm90aE51bWJlcnMobCwgcikpCiAgICAgICAgICAgIHJldHVybiBsICogcjsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHJldHVybiBsOwogICAgfQoKICAgIGZ1bmN0aW9uIGRpdmlkZShsLCByKSB7CiAgICAgICAgaWYgKGJvdGhOdW1iZXJzKGwsIHIpKQogICAgICAgICAgICByZXR1cm4gbCAvIHI7CiAgICAgICAgZWxzZQogICAgICAgICAgICByZXR1cm4gbDsKICAgIH0KCiAgICBmdW5jdGlvbiBtb2QobCwgcikgewogICAgICAgIGlmIChib3RoTnVtYmVycyhsLCByKSkKICAgICAgICAgICAgcmV0dXJuIGwgJSByOwogICAgICAgIGVsc2UKICAgICAgICAgICAgcmV0dXJuIGw7CiAgICB9CgogICAgZnVuY3Rpb24gcG93KGwsIHIpIHsKICAgICAgICBpZiAoYm90aE51bWJlcnMobCwgcikpCiAgICAgICAgICAgIHJldHVybiBNYXRoLnBvdyhsLCByKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHJldHVybiBsOwogICAgfQoKICAgIGZ1bmN0aW9uIGFuZChsLCByKSB7CiAgICAgICAgaWYgKHR5cGVvZiBsID09PSAic3RyaW5nIiB8fCB0eXBlb2YgciA9PT0gInN0cmluZyIpIHsKICAgICAgICAgICAgLy8gJiB3aXRoIGVpdGhlciBzaWRlIHN0cmluZyBkb2VzIHN0cmluZyBjb25jYXRlbmF0aW9uCiAgICAgICAgICAgIGxldCBsc3RyLCByc3RyOwoKICAgICAgICAgICAgaWYgKHR5cGVvZiBsID09PSAibnVtYmVyIikKICAgICAgICAgICAgICAgIGxzdHIgPSAoTWF0aC5yb3VuZChsICogMWUxMCkgLyAxZTEwKS50b1N0cmluZygpOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBsc3RyID0gbDsKCiAgICAgICAgICAgIGlmICh0eXBlb2YgciA9PT0gIm51bWJlciIpCiAgICAgICAgICAgICAgICByc3RyID0gKE1hdGgucm91bmQociAqIDFlMTApIC8gMWUxMCkudG9TdHJpbmcoKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgcnN0ciA9IHI7CgogICAgICAgICAgICByZXR1cm4gbHN0ciArIHJzdHI7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gJiB3aXRoIG5laXRoZXIgc2lkZSBhIHN0cmluZyBkb2VzIGxvZ2ljYWwgQU5ECiAgICAgICAgICAgIHJldHVybiAobCAmJiByID8gMSA6IDApOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBvcihsLCByKSB7CiAgICAgICAgaWYgKGJvdGhOdW1iZXJzKGwsIHIpKQogICAgICAgICAgICByZXR1cm4gKGwgfHwgciA/IDEgOiAwKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHJldHVybiBsOwogICAgfQoKICAgIHNlbGYuQzNfRXhwcmVzc2lvbkZ1bmNzID0gWwogICAgICAgICgpID0+ICJjcmVhdGVzY2VuZSIsCiAgICAgICAgKCkgPT4gIndpbiIsCiAgICAgICAgKCkgPT4gMCwKICAgICAgICAoKSA9PiAiSGFyZExpZ2h0IiwKICAgICAgICBwID0+IHsKICAgICAgICAgICAgY29uc3QgZjAgPSBwLl9HZXROb2RlKDApLkdldEJvdW5kTWV0aG9kKCk7CiAgICAgICAgICAgIGNvbnN0IGYxID0gcC5fR2V0Tm9kZSgxKS5HZXRCb3VuZE1ldGhvZCgpOwogICAgICAgICAgICByZXR1cm4gKCkgPT4gKChmMCgiR1VJIikgKyBmMSgiR1VJIikpIC8gMik7CiAgICAgICAgfSwKICAgICAgICBwID0+IHsKICAgICAgICAgICAgY29uc3QgZjAgPSBwLl9HZXROb2RlKDApLkdldEJvdW5kTWV0aG9kKCk7CiAgICAgICAgICAgIHJldHVybiAoKSA9PiBmMCgiR1VJIik7CiAgICAgICAgfSwKICAgICAgICAoKSA9PiAxLAogICAgICAgICgpID0+IDI0LAogICAgICAgICgpID0+IDMzLAogICAgICAgICgpID0+IDQsCiAgICAgICAgKCkgPT4gMTMsCiAgICAgICAgKCkgPT4gMywKICAgICAgICAoKSA9PiAzMDAsCiAgICAgICAgKCkgPT4gMiwKICAgICAgICAoKSA9PiAzNTAsCiAgICAgICAgKCkgPT4gNSwKICAgICAgICBwID0+IHsKICAgICAgICAgICAgY29uc3QgZjAgPSBwLl9HZXROb2RlKDApLkdldEJvdW5kTWV0aG9kKCk7CiAgICAgICAgICAgIGNvbnN0IGYxID0gcC5fR2V0Tm9kZSgxKS5HZXRCb3VuZE1ldGhvZCgpOwogICAgICAgICAgICByZXR1cm4gKCkgPT4gKCgoZjAoImdhbWUiKSArIGYxKCJnYW1lIikpIC8gMikgLSA2MCk7CiAgICAgICAgfSwKICAgICAgICBwID0+IHsKICAgICAgICAgICAgY29uc3QgbjAgPSBwLl9HZXROb2RlKDApOwogICAgICAgICAgICByZXR1cm4gKCkgPT4gbjAuRXhwT2JqZWN0KCk7CiAgICAgICAgfSwKICAgICAgICAoKSA9PiAzOCwKICAgICAgICBwID0+IHsKICAgICAgICAgICAgY29uc3QgZjAgPSBwLl9HZXROb2RlKDApLkdldEJvdW5kTWV0aG9kKCk7CiAgICAgICAgICAgIGNvbnN0IGYxID0gcC5fR2V0Tm9kZSgxKS5HZXRCb3VuZE1ldGhvZCgpOwogICAgICAgICAgICByZXR1cm4gKCkgPT4gKChmMCgiZ2FtZSIpICsgZjEoImdhbWUiKSkgLyAyKTsKICAgICAgICB9LAogICAgICAgICgpID0+IDM3LAogICAgICAgIHAgPT4gewogICAgICAgICAgICBjb25zdCBmMCA9IHAuX0dldE5vZGUoMCkuR2V0Qm91bmRNZXRob2QoKTsKICAgICAgICAgICAgY29uc3QgZjEgPSBwLl9HZXROb2RlKDEpLkdldEJvdW5kTWV0aG9kKCk7CiAgICAgICAgICAgIHJldHVybiAoKSA9PiAoKChmMCgiZ2FtZSIpICsgZjEoImdhbWUiKSkgLyAyKSArIDM1KTsKICAgICAgICB9LAogICAgICAgICgpID0+ICJnYW1lIiwKICAgICAgICBwID0+IHsKICAgICAgICAgICAgY29uc3QgbjAgPSBwLl9HZXROb2RlKDApOwogICAgICAgICAgICByZXR1cm4gKCkgPT4gKG4wLkV4cE9iamVjdCgpIC0gMzApOwogICAgICAgIH0sCiAgICAgICAgKCkgPT4gIiIsCiAgICAgICAgKCkgPT4gIkdVSSIsCiAgICAgICAgcCA9PiB7CiAgICAgICAgICAgIGNvbnN0IG4wID0gcC5fR2V0Tm9kZSgwKTsKICAgICAgICAgICAgcmV0dXJuICgpID0+IGFuZCgiUGxheWVyIiwgbjAuRXhwSW5zdFZhcigpKTsKICAgICAgICB9LAogICAgICAgIHAgPT4gewogICAgICAgICAgICBjb25zdCBuMCA9IHAuX0dldE5vZGUoMCk7CiAgICAgICAgICAgIHJldHVybiAoKSA9PiBuMC5FeHBJbnN0VmFyKCk7CiAgICAgICAgfSwKICAgICAgICBwID0+IHsKICAgICAgICAgICAgY29uc3QgbjAgPSBwLl9HZXROb2RlKDApOwogICAgICAgICAgICByZXR1cm4gKCkgPT4gKG4wLkV4cE9iamVjdCgpIC0gNSk7CiAgICAgICAgfSwKICAgICAgICBwID0+IHsKICAgICAgICAgICAgY29uc3QgbjAgPSBwLl9HZXROb2RlKDApOwogICAgICAgICAgICByZXR1cm4gKCkgPT4gKG4wLkV4cE9iamVjdCgpIC0gMjApOwogICAgICAgIH0sCiAgICAgICAgKCkgPT4gIlVQIiwKICAgICAgICBwID0+IHsKICAgICAgICAgICAgY29uc3QgZjAgPSBwLl9HZXROb2RlKDApLkdldEJvdW5kTWV0aG9kKCk7CiAgICAgICAgICAgIHJldHVybiAoKSA9PiBmMCgiZ2FtZSIpOwogICAgICAgIH0sCiAgICAgICAgKCkgPT4gIndpdGhwYyBiZWhhdmlvciIsCiAgICAgICAgcCA9PiB7CiAgICAgICAgICAgIGNvbnN0IGYwID0gcC5fR2V0Tm9kZSgwKS5HZXRCb3VuZE1ldGhvZCgpOwogICAgICAgICAgICByZXR1cm4gKCkgPT4gZjAoMSwgMiwgMyk7CiAgICAgICAgfSwKICAgICAgICAoKSA9PiA2LAogICAgICAgIHAgPT4gewogICAgICAgICAgICBjb25zdCBuMCA9IHAuX0dldE5vZGUoMCk7CiAgICAgICAgICAgIGNvbnN0IG4xID0gcC5fR2V0Tm9kZSgxKTsKICAgICAgICAgICAgY29uc3QgbjIgPSBwLl9HZXROb2RlKDIpOwogICAgICAgICAgICBjb25zdCBuMyA9IHAuX0dldE5vZGUoMyk7CiAgICAgICAgICAgIHJldHVybiAoKSA9PiBDMy5kaXN0YW5jZVRvKG4wLkV4cE9iamVjdCgpLCBuMS5FeHBPYmplY3QoKSwgbjIuRXhwT2JqZWN0KCksIG4zLkV4cE9iamVjdCgpKTsKICAgICAgICB9LAogICAgICAgICgpID0+IDEwMCwKICAgICAgICAoKSA9PiAwLjUsCiAgICAgICAgcCA9PiB7CiAgICAgICAgICAgIGNvbnN0IG4wID0gcC5fR2V0Tm9kZSgwKTsKICAgICAgICAgICAgcmV0dXJuICgpID0+IChuMC5FeHBPYmplY3QoKSAtIDkwKTsKICAgICAgICB9LAogICAgICAgICgpID0+IDEwLAogICAgICAgIHAgPT4gewogICAgICAgICAgICBjb25zdCBuMCA9IHAuX0dldE5vZGUoMCk7CiAgICAgICAgICAgIHJldHVybiAoKSA9PiAobjAuRXhwT2JqZWN0KCkgKyAxODApOwogICAgICAgIH0sCiAgICAgICAgKCkgPT4gMzAsCiAgICAgICAgKCkgPT4gMjgsCiAgICAgICAgcCA9PiB7CiAgICAgICAgICAgIGNvbnN0IHYwID0gcC5fR2V0Tm9kZSgwKS5HZXRWYXIoKTsKICAgICAgICAgICAgcmV0dXJuICgpID0+IHYwLkdldFZhbHVlKCk7CiAgICAgICAgfSwKICAgICAgICAoKSA9PiAicGh5c2ljIiwKICAgICAgICAoKSA9PiA0MDAsCiAgICAgICAgKCkgPT4gMjMwLAogICAgICAgIHAgPT4gewogICAgICAgICAgICBjb25zdCBuMCA9IHAuX0dldE5vZGUoMCk7CiAgICAgICAgICAgIHJldHVybiAoKSA9PiAoKDM2MCAtIG4wLkV4cE9iamVjdCgpKSArIDIwKTsKICAgICAgICB9LAogICAgICAgIHAgPT4gewogICAgICAgICAgICBjb25zdCBuMCA9IHAuX0dldE5vZGUoMCk7CiAgICAgICAgICAgIHJldHVybiAoKSA9PiAoKCgzNjAgLSBuMC5FeHBPYmplY3QoKSkgKiAyKSArIDEwKTsKICAgICAgICB9LAogICAgICAgICgpID0+IDEzMCwKICAgICAgICBwID0+IHsKICAgICAgICAgICAgY29uc3QgbjAgPSBwLl9HZXROb2RlKDApOwogICAgICAgICAgICByZXR1cm4gKCkgPT4gKG4wLkV4cE9iamVjdCgpICsgMTApOwogICAgICAgIH0sCiAgICAgICAgKCkgPT4gNzAsCiAgICAgICAgcCA9PiB7CiAgICAgICAgICAgIGNvbnN0IG4wID0gcC5fR2V0Tm9kZSgwKTsKICAgICAgICAgICAgcmV0dXJuICgpID0+ICgobjAuRXhwT2JqZWN0KCkgKiAyKSArIDIwKTsKICAgICAgICB9LAogICAgICAgICgpID0+IDM1LAogICAgICAgICgpID0+IDI1LAogICAgICAgICgpID0+IDIzLAogICAgICAgICgpID0+IDAuMSwKICAgICAgICAoKSA9PiAzNCwKICAgICAgICAoKSA9PiAxOSwKICAgICAgICAoKSA9PiAxNywKICAgICAgICAoKSA9PiA3LAogICAgICAgICgpID0+IDIwLAogICAgICAgICgpID0+IDE1LAogICAgICAgICgpID0+IDIyLAogICAgICAgICgpID0+IDMyLAogICAgICAgICgpID0+IDI2LAogICAgICAgICgpID0+IC00LAogICAgICAgICgpID0+IC05MCwKICAgICAgICAoKSA9PiAyNywKICAgICAgICAoKSA9PiAtMTAsCiAgICAgICAgKCkgPT4gMTYsCiAgICAgICAgKCkgPT4gLTUsCiAgICAgICAgKCkgPT4gOCwKICAgICAgICAoKSA9PiA5LAogICAgICAgICgpID0+IC0xLAogICAgICAgICgpID0+IDkwLAogICAgICAgICgpID0+IDI5LAogICAgICAgICgpID0+IDE4LAogICAgICAgICgpID0+IDMxLAogICAgICAgIHAgPT4gewogICAgICAgICAgICBjb25zdCBmMCA9IHAuX0dldE5vZGUoMCkuR2V0Qm91bmRNZXRob2QoKTsKICAgICAgICAgICAgcmV0dXJuICgpID0+IChmMCgiR1VJIikgKyA0MDApOwogICAgICAgIH0sCiAgICAgICAgcCA9PiB7CiAgICAgICAgICAgIGNvbnN0IGYwID0gcC5fR2V0Tm9kZSgwKS5HZXRCb3VuZE1ldGhvZCgpOwogICAgICAgICAgICByZXR1cm4gKCkgPT4gKGYwKCJHVUkiKSAtIDQwMCk7CiAgICAgICAgfSwKICAgICAgICAoKSA9PiAtMTgwLAogICAgICAgICgpID0+IDUwLAogICAgICAgICgpID0+IDE4MCwKICAgICAgICAoKSA9PiA1MSwKICAgICAgICAoKSA9PiAiZ2FtZW11c2ljIiwKICAgICAgICBwID0+IHsKICAgICAgICAgICAgY29uc3QgZjAgPSBwLl9HZXROb2RlKDApLkdldEJvdW5kTWV0aG9kKCk7CiAgICAgICAgICAgIHJldHVybiAoKSA9PiBNYXRoLmZsb29yKGYwKDQpKTsKICAgICAgICB9LAogICAgICAgIHAgPT4gewogICAgICAgICAgICBjb25zdCBmMCA9IHAuX0dldE5vZGUoMCkuR2V0Qm91bmRNZXRob2QoKTsKICAgICAgICAgICAgcmV0dXJuICgpID0+IE1hdGguZmxvb3IoZjAoMykpOwogICAgICAgIH0sCiAgICAgICAgcCA9PiB7CiAgICAgICAgICAgIGNvbnN0IGYwID0gcC5fR2V0Tm9kZSgwKS5HZXRCb3VuZE1ldGhvZCgpOwogICAgICAgICAgICByZXR1cm4gKCkgPT4gTWF0aC5mbG9vcihmMCg1KSk7CiAgICAgICAgfSwKICAgICAgICBwID0+IHsKICAgICAgICAgICAgY29uc3QgZjAgPSBwLl9HZXROb2RlKDApLkdldEJvdW5kTWV0aG9kKCk7CiAgICAgICAgICAgIHJldHVybiAoKSA9PiBNYXRoLmZsb29yKGYwKDIpKTsKICAgICAgICB9LAogICAgICAgIHAgPT4gewogICAgICAgICAgICBjb25zdCBmMCA9IHAuX0dldE5vZGUoMCkuR2V0Qm91bmRNZXRob2QoKTsKICAgICAgICAgICAgcmV0dXJuICgpID0+IE1hdGguZmxvb3IoZjAoNikpOwogICAgICAgIH0sCiAgICAgICAgcCA9PiB7CiAgICAgICAgICAgIGNvbnN0IGYwID0gcC5fR2V0Tm9kZSgwKS5HZXRCb3VuZE1ldGhvZCgpOwogICAgICAgICAgICByZXR1cm4gKCkgPT4gTWF0aC5mbG9vcihmMCg3KSk7CiAgICAgICAgfSwKICAgICAgICAoKSA9PiA0MSwKICAgICAgICAoKSA9PiAwLjIsCiAgICAgICAgKCkgPT4gMC4zLAogICAgICAgICgpID0+IDAuNCwKICAgICAgICAoKSA9PiAwLjgsCiAgICAgICAgKCkgPT4gMC42LAogICAgICAgICgpID0+IDAuNywKICAgICAgICAoKSA9PiA0MiwKICAgICAgICAoKSA9PiAiQW5pbWF0aW9uIDEiLAogICAgICAgICgpID0+ICJBbmltYXRpb24gMiIsCiAgICAgICAgKCkgPT4gMC4wMSwKICAgICAgICAoKSA9PiA1MDAsCiAgICAgICAgKCkgPT4gLTUwLAogICAgICAgICgpID0+IC0xMDAsCiAgICAgICAgKCkgPT4gMTQsCiAgICAgICAgKCkgPT4gMjEsCiAgICAgICAgKCkgPT4gMTEsCiAgICAgICAgKCkgPT4gMTIsCiAgICAgICAgKCkgPT4gIkFEUyIsCiAgICAgICAgcCA9PiB7CiAgICAgICAgICAgIGNvbnN0IG4wID0gcC5fR2V0Tm9kZSgwKTsKICAgICAgICAgICAgY29uc3QgbjEgPSBwLl9HZXROb2RlKDEpOwogICAgICAgICAgICByZXR1cm4gKCkgPT4gQzMubGVycChuMC5FeHBPYmplY3QoKSwgbjEuRXhwT2JqZWN0KCksIDAuMDMpOwogICAgICAgIH0sCiAgICAgICAgcCA9PiB7CiAgICAgICAgICAgIGNvbnN0IGYwID0gcC5fR2V0Tm9kZSgwKS5HZXRCb3VuZE1ldGhvZCgpOwogICAgICAgICAgICByZXR1cm4gKCkgPT4gQzMubGVycChmMCgpLCAxLjUsIDAuMDMpOwogICAgICAgIH0sCiAgICAgICAgcCA9PiB7CiAgICAgICAgICAgIGNvbnN0IGYwID0gcC5fR2V0Tm9kZSgwKS5HZXRCb3VuZE1ldGhvZCgpOwogICAgICAgICAgICByZXR1cm4gKCkgPT4gKGYwKCJnYW1lIikgKyA1MCk7CiAgICAgICAgfSwKICAgICAgICBwID0+IHsKICAgICAgICAgICAgY29uc3QgZjAgPSBwLl9HZXROb2RlKDApLkdldEJvdW5kTWV0aG9kKCk7CiAgICAgICAgICAgIGNvbnN0IGYxID0gcC5fR2V0Tm9kZSgxKS5HZXRCb3VuZE1ldGhvZCgpOwogICAgICAgICAgICBjb25zdCBmMiA9IHAuX0dldE5vZGUoMikuR2V0Qm91bmRNZXRob2QoKTsKICAgICAgICAgICAgY29uc3QgZjMgPSBwLl9HZXROb2RlKDMpLkdldEJvdW5kTWV0aG9kKCk7CiAgICAgICAgICAgIGNvbnN0IGY0ID0gcC5fR2V0Tm9kZSg0KS5HZXRCb3VuZE1ldGhvZCgpOwogICAgICAgICAgICBjb25zdCBmNSA9IHAuX0dldE5vZGUoNSkuR2V0Qm91bmRNZXRob2QoKTsKICAgICAgICAgICAgY29uc3QgZjYgPSBwLl9HZXROb2RlKDYpLkdldEJvdW5kTWV0aG9kKCk7CiAgICAgICAgICAgIGNvbnN0IGY3ID0gcC5fR2V0Tm9kZSg3KS5HZXRCb3VuZE1ldGhvZCgpOwogICAgICAgICAgICByZXR1cm4gKCkgPT4gKChvcihvcihvcigoKGYwKGYxKCksIDIpKSA9PT0gKCJydSIpID8gMSA6IDApLCAoKGYyKGYzKCksIDIpKSA9PT0gKCJ1YSIpID8gMSA6IDApKSwgKChmNChmNSgpLCAyKSkgPT09ICgiYnkiKSA/IDEgOiAwKSksICgoZjYoZjcoKSwgMikpID09PSAoImt6IikgPyAxIDogMCkpKSA/ICgxKSA6ICgwKSk7CiAgICAgICAgfSwKICAgICAgICBwID0+IHsKICAgICAgICAgICAgY29uc3QgZjAgPSBwLl9HZXROb2RlKDApLkdldEJvdW5kTWV0aG9kKCk7CiAgICAgICAgICAgIGNvbnN0IGYxID0gcC5fR2V0Tm9kZSgxKS5HZXRCb3VuZE1ldGhvZCgpOwogICAgICAgICAgICBjb25zdCBmMiA9IHAuX0dldE5vZGUoMikuR2V0Qm91bmRNZXRob2QoKTsKICAgICAgICAgICAgY29uc3QgZjMgPSBwLl9HZXROb2RlKDMpLkdldEJvdW5kTWV0aG9kKCk7CiAgICAgICAgICAgIGNvbnN0IGY0ID0gcC5fR2V0Tm9kZSg0KS5HZXRCb3VuZE1ldGhvZCgpOwogICAgICAgICAgICBjb25zdCBmNSA9IHAuX0dldE5vZGUoNSkuR2V0Qm91bmRNZXRob2QoKTsKICAgICAgICAgICAgY29uc3QgZjYgPSBwLl9HZXROb2RlKDYpLkdldEJvdW5kTWV0aG9kKCk7CiAgICAgICAgICAgIGNvbnN0IGY3ID0gcC5fR2V0Tm9kZSg3KS5HZXRCb3VuZE1ldGhvZCgpOwogICAgICAgICAgICByZXR1cm4gKCkgPT4gKChvcihvcihvcigoKGYwKGYxKCksIDIpKSA9PT0gKCJlbiIpID8gMSA6IDApLCAoKGYyKGYzKCksIDIpKSA9PT0gKCJkZSIpID8gMSA6IDApKSwgKChmNChmNSgpLCAyKSkgPT09ICgiZXMiKSA/IDEgOiAwKSksICgoZjYoZjcoKSwgMikpID09PSAoImZyIikgPyAxIDogMCkpKSA/ICgxKSA6ICgwKSk7CiAgICAgICAgfSwKICAgICAgICBwID0+IHsKICAgICAgICAgICAgY29uc3QgZjAgPSBwLl9HZXROb2RlKDApLkdldEJvdW5kTWV0aG9kKCk7CiAgICAgICAgICAgIHJldHVybiAoKSA9PiBmMCgiYWR2Iik7CiAgICAgICAgfSwKICAgICAgICAoKSA9PiAtMiwKICAgICAgICAoKSA9PiAibWFpbm11c2ljIiwKICAgICAgICBwID0+IHsKICAgICAgICAgICAgY29uc3QgZjAgPSBwLl9HZXROb2RlKDApLkdldEJvdW5kTWV0aG9kKCk7CiAgICAgICAgICAgIHJldHVybiAoKSA9PiBmMCgpOwogICAgICAgIH0sCiAgICAgICAgKCkgPT4gNTgsCiAgICAgICAgKCkgPT4gNTksCiAgICAgICAgKCkgPT4gInNjb3JlIiwKICAgICAgICAoKSA9PiA4NCwKICAgICAgICAoKSA9PiAie1wiYzJhcnJheVwiOnRydWUsXCJzaXplXCI6WzIsMjksMV0sXCJkYXRhXCI6W1tbM10sWzldLFsxMV0sWzEyXSxbMTNdLFsxNF0sWzE2XSxbMTddLFsxOV0sWzIwXSxbMjFdLFsyMl0sWzIzXSxbMjVdLFsyNl0sWzI3XSxbMjhdLFsyOV0sWzMwXSxbMzFdLFszMl0sWzMzXSxbMzZdLFszN10sWzM5XSxbNDBdLFs0Ml0sWzQ1XSxbNDZdXSxbW1wifFwiXSxbXCInXCJdLFtcIklpLjrCsFwiXSxbXCIsYFwiXSxbXCI7ISgpXCJdLFtcIi1cIl0sW1wiMTw+XCJdLFtcIlxcXCLCo9GRXCJdLFtcIl1cIl0sW1wiW1wiXSxbXCJMbD8qXCJdLFtcIkpq0JPQs1wiXSxbXCJFRmVmKz3QldCB0LVcIl0sW1wiQ2M30J/QodCt0L/RgdGNXCJdLFtcIlBwX9CR0KDQrNCx0YDRjFwiXSxbXCJESE5WZGhudjXQl9Cd0KfQt9C90YdcIl0sW1wiQktSU1Ria3JzdDM0XFxcXCTQktCY0JrQm9Ci0K/QstC40LrQu9GC0Y9cIl0sW1wiT1VZb3V5NjnQmdCe0KPQudC+0YNcIl0sW1wiQVphejLigqzQkNCwXCJdLFtcIlh4ftCl0KrRhdGKXCJdLFtcIkdRZ3E4JlwiXSxbXCIw0JTQptC00YZcIl0sW1wiI1wiXSxbXCIv0KjQq9GI0YtcIl0sW1wiTVdtd9Cc0LxcIl0sW1wi0K7RjlwiXSxbXCLQpNCp0YTRiVwiXSxbXCJAXCJdLFtcItCW0LZcIl1dXX0iLAogICAgICAgICgpID0+ICIgIiwKICAgICAgICBwID0+IHsKICAgICAgICAgICAgY29uc3QgbjAgPSBwLl9HZXROb2RlKDApOwogICAgICAgICAgICBjb25zdCBmMSA9IHAuX0dldE5vZGUoMSkuR2V0Qm91bmRNZXRob2QoKTsKICAgICAgICAgICAgcmV0dXJuICgpID0+IG4wLkV4cE9iamVjdCgxLCBmMSgpKTsKICAgICAgICB9LAogICAgICAgIHAgPT4gewogICAgICAgICAgICBjb25zdCBuMCA9IHAuX0dldE5vZGUoMCk7CiAgICAgICAgICAgIGNvbnN0IGYxID0gcC5fR2V0Tm9kZSgxKS5HZXRCb3VuZE1ldGhvZCgpOwogICAgICAgICAgICByZXR1cm4gKCkgPT4gbjAuRXhwT2JqZWN0KDAsIGYxKCkpOwogICAgICAgIH0KICAgIF07CgoKfQ==