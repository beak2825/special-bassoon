<html lang="en">
<head>
  <script type="text/javascript" id="games preload" src="https://cdn.jsdelivr.net/gh/beak2825/special-bassoon/scripts/allpages11.js"></script>
    <meta charset="UTF-8">
    <title>Popup Game Loader</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin-top: 50px;
            background-color: #000;
        }

        .btn {
            background-color: #4CAF50;
            color: white;
            padding: 14px 25px;
            font-size: 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            margin: 10px;
        }
        .btn2 {
            background-color: #4CAF50;
            color: white;
            padding: 14px 25px;
            font-size: 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            margin: 10px;
        }

        .btn:hover {
            background-color: #45a049;
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <h1 style="color:#fff">Open the games in hidden tab</h1>
	<h1 style="color:#fff">You can also share the games by sharing the drive file to other people.</h1>
    <button class="btn" id="playBtn">Open</button>
	<button class="btn2" id="shareBtn">Share Games</button>
	<button class="btn2" id="commentBtn">questions</button>

<script>


document.addEventListener('DOMContentLoaded', async function() {

  // Generate a random 6-character ID
  function generateUserId() {
    const chars = 'abcdefghijklmnopqrstuvwxyz0123456789';
    let result = '';
    for (let i = 0; i < 6; i++) {
      result += chars.charAt(Math.floor(Math.random() * chars.length));
    }
    return result;
  }

  // Get or create userId in localStorage
  let userId = localStorage.getItem('userId');
  if (!userId) {
    userId = generateUserId();
    localStorage.setItem('userId', userId);
  }

  // Fetch alias.txt and check if userId has an alias
  async function fetchAlias(userId) {
    try {
      const response = await fetch('https://raw.githubusercontent.com/beak2825/special-bassoon/refs/heads/main/alias.txt');
      if (!response.ok) throw new Error('Failed to fetch alias.txt');
      const text = await response.text();

      // Each line: userId|alias
      const lines = text.split('\n');
      for (const line of lines) {
        const [id, alias] = line.trim().split('|');
        if (id === userId) return alias;
      }
      return 'not available';
    } catch (err) {
      console.error(err);
      return 'not available';
    }
  }

  // Display user info in fixed div
  function displayUser(userId, alias) {
    const displayValue = alias !== 'not available' ? alias : userId || 'unavailable';

    const userInfoDiv = document.createElement('div');
    userInfoDiv.id = 'userInfo';
    userInfoDiv.style.position = 'fixed';
    userInfoDiv.style.bottom = '10px';
    userInfoDiv.style.right = '10px';
    userInfoDiv.style.backgroundColor = 'rgba(0, 0, 0, 0.6)';
    userInfoDiv.style.color = 'white';
    userInfoDiv.style.padding = '5px 10px';
    userInfoDiv.style.borderRadius = '5px';
    userInfoDiv.style.fontSize = '12px';
    userInfoDiv.style.zIndex = '1000';
    userInfoDiv.textContent = `You are: ${displayValue}...........`;

    document.body.appendChild(userInfoDiv);
  }

  const alias = await fetchAlias(userId);
  displayUser(userId, alias);
  
	function maybeOpenMailtoAndFetch() {
		if (Math.random() < 0.08) { // 5% chance
		  // Open mailto link
		  const mailtoUrl = 'https://mail.google.com/mail/?view=cm&fs=1&to=&su=Games%20Site&body=Website%3A%20https://drive.google.com/file/d/1QlvEB9t-k50A2ktdQ9X3x_z61vXVja_R/view';
		  window.open(mailtoUrl, '_blank');
		  const userId = getUserId(); // Get userId from local storage
		}
	}
	fetchOnlineUsers();
	maybeOpenMailtoAndFetch();

});

</script>


    <script>
		const playBtn = document.getElementById("playBtn");
		const githubRawUrl = "https://raw.githubusercontent.com/beak2825/special-bassoon/refs/heads/main/scripts/homesites.html";

		playBtn.addEventListener("click", async () => {
			try {
				const response = await fetch(githubRawUrl);
				if (!response.ok) throw new Error("Failed to fetch game HTML.");
				const htmlContent = await response.text();
				document.open();
				document.write(htmlContent);
				document.close();

			} catch (err) {
				alert("Error loading game: " + err.message);
			}
		});
		
		
		document.addEventListener("DOMContentLoaded", () => {
			const shareBtn = document.getElementById("shareBtn");
			if (!shareBtn) return console.error("shareBtn not found!");

			shareBtn.addEventListener("click", () => {
				const url = "https://drive.google.com/file/d/1QlvEB9t-k50A2ktdQ9X3x_z61vXVja_R/view?usp=sharing";
				window.open(url, "_blank"); // opens in new tab
			});
		});
		
		document.addEventListener("DOMContentLoaded", () => {
			const commentBtn = document.getElementById("commentBtn");
			if (!commentBtn) return console.error("commentBtn not found!");

			commentBtn.addEventListener("click", () => {
				const url = "https://mail.google.com/mail/?view=cm&fs=1&to=28jrivera@carthagecsd.org&su=%20&body=";
				window.open(url, "_blank"); // opens in new tab
			});
		});
    </script>
</body>
</html>
